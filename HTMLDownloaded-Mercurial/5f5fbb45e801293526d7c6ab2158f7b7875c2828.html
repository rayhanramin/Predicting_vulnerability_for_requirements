<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en-US" lang="en-US">
<head>
<link rel="icon" href="/static/35f393d6769a/hgicon.png" type="image/png" />
<meta name="robots" content="index, nofollow"/>
<link rel="stylesheet" href="/static/35f393d6769a/style-gitweb.css" type="text/css" />

<style type="text/css">
div.feed {
  float: right;
}
a img {
  border-width: 0px;
}
div.log_link {
  width: 80px;
  background-color: white;
}

div.log_body {
  padding-left: 96px;
}
</style>
<script type="text/javascript" src="/static/35f393d6769a/mercurial.js"></script>

<meta property="og:image" content="/static/35f393d6769a/moz-logo-bw-rgb.svg"/>
<meta property="og:type" content="website"/>

<title>comm-central: changeset 22453:5f5fbb45e801293526d7c6ab2158f7b7875c2828</title>
<link rel="alternate" type="application/atom+xml"
   href="/comm-central/atom-log" title="Atom feed for comm-central"/>
<link rel="alternate" type="application/rss+xml"
   href="/comm-central/rss-log" title="RSS feed for comm-central"/>

<meta property="og:title" content="comm-central @ 5f5fbb45e801293526d7c6ab2158f7b7875c2828" />
<meta property="og:url" content="/comm-central/rev/5f5fbb45e801293526d7c6ab2158f7b7875c2828" />
<meta property="og:description" content="Bug 1410794 - Update comm-central for nsIPrefBranch.idl changes. r=jorgk" />

</head>
<body>

<div class="page_header">
<div class="logo">
    <a href="https://developer.mozilla.org/en/docs/Mercurial">
        <img src="/static/35f393d6769a/moz-logo-bw-rgb.svg" alt="mercurial" />
    </a>
</div>
<a href="/">Mercurial</a> &gt; <a href="/comm-central">comm-central</a>  / changeset / 5f5fbb45e801293526d7c6ab2158f7b7875c2828 
</div>

<div class="page_nav">
<div>
<a href="/comm-central/summary">summary</a> |
<a href="/comm-central/shortlog/5f5fbb45e801293526d7c6ab2158f7b7875c2828">shortlog</a> |
<a href="/comm-central/log/5f5fbb45e801293526d7c6ab2158f7b7875c2828">changelog</a> |
<a href="/comm-central/pushloghtml">pushlog</a> |
<a href="/comm-central/graph/5f5fbb45e801293526d7c6ab2158f7b7875c2828">graph</a> |
<a href="/comm-central/tags">tags</a> |
<a href="/comm-central/bookmarks">bookmarks</a> |
<a href="/comm-central/branches">branches</a> |
<a href="/comm-central/file/5f5fbb45e801293526d7c6ab2158f7b7875c2828">files</a> |
changeset |
<a href="/comm-central/raw-rev/5f5fbb45e801293526d7c6ab2158f7b7875c2828">raw</a>  | <a href="/comm-central/archive/5f5fbb45e801293526d7c6ab2158f7b7875c2828.zip">zip</a>  |
<a href="/comm-central/help">help</a>
</div>

<div class="search">
<form id="searchform" action="/comm-central/log">

<input name="rev" type="text" value="" size="40" />
<div id="hint">Find changesets by keywords (author, files, the commit message), revision
number or hash, or <a href="/comm-central/help/revsets">revset expression</a>.</div>
</form>
</div>
</div>

<div class="title">
<a href="https://bugzilla.mozilla.org/show_bug.cgi?id=1410794">Bug 1410794</a> - Update comm-central for nsIPrefBranch.idl changes. r=jorgk
<span class="logtags"></span>
</div>
<div class="title_text">
<table cellspacing="0">

<tr><td>author</td><td>&#78;&#105;&#99;&#104;&#111;&#108;&#97;&#115;&#32;&#78;&#101;&#116;&#104;&#101;&#114;&#99;&#111;&#116;&#101;&#32;&#60;&#110;&#110;&#101;&#116;&#104;&#101;&#114;&#99;&#111;&#116;&#101;&#64;&#109;&#111;&#122;&#105;&#108;&#108;&#97;&#46;&#99;&#111;&#109;&#62;</td></tr>
<tr><td></td><td class="date age">Tue, 24 Oct 2017 11:52:11 +1100</td></tr>

<tr>
 <td>changeset 22453</td>
 <td style="font-family:monospace"><a class="list" href="/comm-central/rev/5f5fbb45e801293526d7c6ab2158f7b7875c2828">5f5fbb45e801293526d7c6ab2158f7b7875c2828</a></td>
</tr>



<tr>
<td>parent 22452</td>
<td style="font-family:monospace">
<a class="list" href="/comm-central/rev/1c73b7308c85927524207fbd0015b91a0b04deb8">1c73b7308c85927524207fbd0015b91a0b04deb8</a>
</td>
</tr>

<tr>
<td>child 22454</td>
<td style="font-family:monospace">
<a class="list" href="/comm-central/rev/97bf29612932b32707ddd6838047d364947eca13">97bf29612932b32707ddd6838047d364947eca13</a>
</td>
</tr>
<tr><td>push id</td><td><a href="/comm-central/pushloghtml?changeset=5f5fbb45e801293526d7c6ab2158f7b7875c2828">13687</a></td></tr>
<tr><td>push user</td><td>mozilla@jorgk.com</td></tr>
<tr><td>push date</td><td class="date age">Mon, 30 Oct 2017 12:13:49 +0000</td></tr>

<tr><td>treeherder</td><td>comm-central@97bf29612932 [<a href="https://treeherder.mozilla.org/#/jobs?repo=comm-central&revision=97bf29612932b32707ddd6838047d364947eca13">default view</a>] [<a href="https://treeherder.mozilla.org/#/jobs?repo=comm-central&revision=97bf29612932b32707ddd6838047d364947eca13&filter-resultStatus=testfailed&filter-resultStatus=busted&filter-resultStatus=exception">failures only]</td></tr>
<tr><td>perfherder</td><td>[<a href="https://treeherder.mozilla.org/perf.html#/compare?originalProject=comm-central&originalRevision=97bf29612932b32707ddd6838047d364947eca13&newProject=comm-central&newRevision=5f5fbb45e801293526d7c6ab2158f7b7875c2828&framework=1" target="_blank">talos</a>] [<a href="https://treeherder.mozilla.org/perf.html#/compare?originalProject=comm-central&originalRevision=97bf29612932b32707ddd6838047d364947eca13&newProject=comm-central&newRevision=5f5fbb45e801293526d7c6ab2158f7b7875c2828&framework=2" target="_blank">build metrics</a>] [<a href="https://treeherder.mozilla.org/perf.html#/compare?originalProject=comm-central&originalRevision=97bf29612932b32707ddd6838047d364947eca13&newProject=comm-central&newRevision=5f5fbb45e801293526d7c6ab2158f7b7875c2828&framework=6" target="_blank">platform microbench</a>] (compared to previous push)</td></tr>
<tr><td>reviewers</td><td><a href="/comm-central/log?rev=reviewer%28jorgk%29&revcount=50">jorgk</a></td></tr>
<tr><td>bugs</td><td><a href="https://bugzilla.mozilla.org/show_bug.cgi?id=1410794">1410794</a></td></tr>




</table></div>

<div class="page_body description"><a href="https://bugzilla.mozilla.org/show_bug.cgi?id=1410794">Bug 1410794</a> - Update comm-central for nsIPrefBranch.idl changes. r=jorgk

This mostly involves removing getter_Copies() and get() calls. There are a few
functions that have char* arguments changed to nsACString&amp;, and a couple of
members that are changed to nsCString. Finally, for a few places none of those
approaches worked and I had to use moz_xstrdup().</div>
<div class="list_head"></div>
<div class="title_text">
<table cellspacing="0">

<tr class="parity0">
<td><a class="list" href="/comm-central/diff/5f5fbb45e801293526d7c6ab2158f7b7875c2828/mail/components/migration/src/nsMailProfileMigratorUtils.cpp">mail/components/migration/src/nsMailProfileMigratorUtils.cpp</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/5f5fbb45e801293526d7c6ab2158f7b7875c2828/mail/components/migration/src/nsMailProfileMigratorUtils.cpp">file</a> |
<a href="/comm-central/annotate/5f5fbb45e801293526d7c6ab2158f7b7875c2828/mail/components/migration/src/nsMailProfileMigratorUtils.cpp">annotate</a> |
<a href="/comm-central/diff/5f5fbb45e801293526d7c6ab2158f7b7875c2828/mail/components/migration/src/nsMailProfileMigratorUtils.cpp">diff</a> |
<a href="/comm-central/comparison/5f5fbb45e801293526d7c6ab2158f7b7875c2828/mail/components/migration/src/nsMailProfileMigratorUtils.cpp">comparison</a> |
<a href="/comm-central/log/5f5fbb45e801293526d7c6ab2158f7b7875c2828/mail/components/migration/src/nsMailProfileMigratorUtils.cpp">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/5f5fbb45e801293526d7c6ab2158f7b7875c2828/mail/components/migration/src/nsNetscapeProfileMigratorBase.cpp">mail/components/migration/src/nsNetscapeProfileMigratorBase.cpp</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/5f5fbb45e801293526d7c6ab2158f7b7875c2828/mail/components/migration/src/nsNetscapeProfileMigratorBase.cpp">file</a> |
<a href="/comm-central/annotate/5f5fbb45e801293526d7c6ab2158f7b7875c2828/mail/components/migration/src/nsNetscapeProfileMigratorBase.cpp">annotate</a> |
<a href="/comm-central/diff/5f5fbb45e801293526d7c6ab2158f7b7875c2828/mail/components/migration/src/nsNetscapeProfileMigratorBase.cpp">diff</a> |
<a href="/comm-central/comparison/5f5fbb45e801293526d7c6ab2158f7b7875c2828/mail/components/migration/src/nsNetscapeProfileMigratorBase.cpp">comparison</a> |
<a href="/comm-central/log/5f5fbb45e801293526d7c6ab2158f7b7875c2828/mail/components/migration/src/nsNetscapeProfileMigratorBase.cpp">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/5f5fbb45e801293526d7c6ab2158f7b7875c2828/mail/components/migration/src/nsNetscapeProfileMigratorBase.h">mail/components/migration/src/nsNetscapeProfileMigratorBase.h</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/5f5fbb45e801293526d7c6ab2158f7b7875c2828/mail/components/migration/src/nsNetscapeProfileMigratorBase.h">file</a> |
<a href="/comm-central/annotate/5f5fbb45e801293526d7c6ab2158f7b7875c2828/mail/components/migration/src/nsNetscapeProfileMigratorBase.h">annotate</a> |
<a href="/comm-central/diff/5f5fbb45e801293526d7c6ab2158f7b7875c2828/mail/components/migration/src/nsNetscapeProfileMigratorBase.h">diff</a> |
<a href="/comm-central/comparison/5f5fbb45e801293526d7c6ab2158f7b7875c2828/mail/components/migration/src/nsNetscapeProfileMigratorBase.h">comparison</a> |
<a href="/comm-central/log/5f5fbb45e801293526d7c6ab2158f7b7875c2828/mail/components/migration/src/nsNetscapeProfileMigratorBase.h">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/5f5fbb45e801293526d7c6ab2158f7b7875c2828/mail/components/migration/src/nsProfileMigrator.cpp">mail/components/migration/src/nsProfileMigrator.cpp</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/5f5fbb45e801293526d7c6ab2158f7b7875c2828/mail/components/migration/src/nsProfileMigrator.cpp">file</a> |
<a href="/comm-central/annotate/5f5fbb45e801293526d7c6ab2158f7b7875c2828/mail/components/migration/src/nsProfileMigrator.cpp">annotate</a> |
<a href="/comm-central/diff/5f5fbb45e801293526d7c6ab2158f7b7875c2828/mail/components/migration/src/nsProfileMigrator.cpp">diff</a> |
<a href="/comm-central/comparison/5f5fbb45e801293526d7c6ab2158f7b7875c2828/mail/components/migration/src/nsProfileMigrator.cpp">comparison</a> |
<a href="/comm-central/log/5f5fbb45e801293526d7c6ab2158f7b7875c2828/mail/components/migration/src/nsProfileMigrator.cpp">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/5f5fbb45e801293526d7c6ab2158f7b7875c2828/mail/components/migration/src/nsSeamonkeyProfileMigrator.cpp">mail/components/migration/src/nsSeamonkeyProfileMigrator.cpp</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/5f5fbb45e801293526d7c6ab2158f7b7875c2828/mail/components/migration/src/nsSeamonkeyProfileMigrator.cpp">file</a> |
<a href="/comm-central/annotate/5f5fbb45e801293526d7c6ab2158f7b7875c2828/mail/components/migration/src/nsSeamonkeyProfileMigrator.cpp">annotate</a> |
<a href="/comm-central/diff/5f5fbb45e801293526d7c6ab2158f7b7875c2828/mail/components/migration/src/nsSeamonkeyProfileMigrator.cpp">diff</a> |
<a href="/comm-central/comparison/5f5fbb45e801293526d7c6ab2158f7b7875c2828/mail/components/migration/src/nsSeamonkeyProfileMigrator.cpp">comparison</a> |
<a href="/comm-central/log/5f5fbb45e801293526d7c6ab2158f7b7875c2828/mail/components/migration/src/nsSeamonkeyProfileMigrator.cpp">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/5f5fbb45e801293526d7c6ab2158f7b7875c2828/mail/components/shell/DirectoryProvider.cpp">mail/components/shell/DirectoryProvider.cpp</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/5f5fbb45e801293526d7c6ab2158f7b7875c2828/mail/components/shell/DirectoryProvider.cpp">file</a> |
<a href="/comm-central/annotate/5f5fbb45e801293526d7c6ab2158f7b7875c2828/mail/components/shell/DirectoryProvider.cpp">annotate</a> |
<a href="/comm-central/diff/5f5fbb45e801293526d7c6ab2158f7b7875c2828/mail/components/shell/DirectoryProvider.cpp">diff</a> |
<a href="/comm-central/comparison/5f5fbb45e801293526d7c6ab2158f7b7875c2828/mail/components/shell/DirectoryProvider.cpp">comparison</a> |
<a href="/comm-central/log/5f5fbb45e801293526d7c6ab2158f7b7875c2828/mail/components/shell/DirectoryProvider.cpp">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/5f5fbb45e801293526d7c6ab2158f7b7875c2828/mailnews/addrbook/src/nsAbAddressCollector.cpp">mailnews/addrbook/src/nsAbAddressCollector.cpp</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/5f5fbb45e801293526d7c6ab2158f7b7875c2828/mailnews/addrbook/src/nsAbAddressCollector.cpp">file</a> |
<a href="/comm-central/annotate/5f5fbb45e801293526d7c6ab2158f7b7875c2828/mailnews/addrbook/src/nsAbAddressCollector.cpp">annotate</a> |
<a href="/comm-central/diff/5f5fbb45e801293526d7c6ab2158f7b7875c2828/mailnews/addrbook/src/nsAbAddressCollector.cpp">diff</a> |
<a href="/comm-central/comparison/5f5fbb45e801293526d7c6ab2158f7b7875c2828/mailnews/addrbook/src/nsAbAddressCollector.cpp">comparison</a> |
<a href="/comm-central/log/5f5fbb45e801293526d7c6ab2158f7b7875c2828/mailnews/addrbook/src/nsAbAddressCollector.cpp">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/5f5fbb45e801293526d7c6ab2158f7b7875c2828/mailnews/addrbook/src/nsAbDirProperty.cpp">mailnews/addrbook/src/nsAbDirProperty.cpp</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/5f5fbb45e801293526d7c6ab2158f7b7875c2828/mailnews/addrbook/src/nsAbDirProperty.cpp">file</a> |
<a href="/comm-central/annotate/5f5fbb45e801293526d7c6ab2158f7b7875c2828/mailnews/addrbook/src/nsAbDirProperty.cpp">annotate</a> |
<a href="/comm-central/diff/5f5fbb45e801293526d7c6ab2158f7b7875c2828/mailnews/addrbook/src/nsAbDirProperty.cpp">diff</a> |
<a href="/comm-central/comparison/5f5fbb45e801293526d7c6ab2158f7b7875c2828/mailnews/addrbook/src/nsAbDirProperty.cpp">comparison</a> |
<a href="/comm-central/log/5f5fbb45e801293526d7c6ab2158f7b7875c2828/mailnews/addrbook/src/nsAbDirProperty.cpp">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/5f5fbb45e801293526d7c6ab2158f7b7875c2828/mailnews/addrbook/src/nsAbLDAPDirectory.cpp">mailnews/addrbook/src/nsAbLDAPDirectory.cpp</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/5f5fbb45e801293526d7c6ab2158f7b7875c2828/mailnews/addrbook/src/nsAbLDAPDirectory.cpp">file</a> |
<a href="/comm-central/annotate/5f5fbb45e801293526d7c6ab2158f7b7875c2828/mailnews/addrbook/src/nsAbLDAPDirectory.cpp">annotate</a> |
<a href="/comm-central/diff/5f5fbb45e801293526d7c6ab2158f7b7875c2828/mailnews/addrbook/src/nsAbLDAPDirectory.cpp">diff</a> |
<a href="/comm-central/comparison/5f5fbb45e801293526d7c6ab2158f7b7875c2828/mailnews/addrbook/src/nsAbLDAPDirectory.cpp">comparison</a> |
<a href="/comm-central/log/5f5fbb45e801293526d7c6ab2158f7b7875c2828/mailnews/addrbook/src/nsAbLDAPDirectory.cpp">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/5f5fbb45e801293526d7c6ab2158f7b7875c2828/mailnews/addrbook/src/nsAbMDBDirectory.cpp">mailnews/addrbook/src/nsAbMDBDirectory.cpp</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/5f5fbb45e801293526d7c6ab2158f7b7875c2828/mailnews/addrbook/src/nsAbMDBDirectory.cpp">file</a> |
<a href="/comm-central/annotate/5f5fbb45e801293526d7c6ab2158f7b7875c2828/mailnews/addrbook/src/nsAbMDBDirectory.cpp">annotate</a> |
<a href="/comm-central/diff/5f5fbb45e801293526d7c6ab2158f7b7875c2828/mailnews/addrbook/src/nsAbMDBDirectory.cpp">diff</a> |
<a href="/comm-central/comparison/5f5fbb45e801293526d7c6ab2158f7b7875c2828/mailnews/addrbook/src/nsAbMDBDirectory.cpp">comparison</a> |
<a href="/comm-central/log/5f5fbb45e801293526d7c6ab2158f7b7875c2828/mailnews/addrbook/src/nsAbMDBDirectory.cpp">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/5f5fbb45e801293526d7c6ab2158f7b7875c2828/mailnews/addrbook/src/nsDirPrefs.cpp">mailnews/addrbook/src/nsDirPrefs.cpp</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/5f5fbb45e801293526d7c6ab2158f7b7875c2828/mailnews/addrbook/src/nsDirPrefs.cpp">file</a> |
<a href="/comm-central/annotate/5f5fbb45e801293526d7c6ab2158f7b7875c2828/mailnews/addrbook/src/nsDirPrefs.cpp">annotate</a> |
<a href="/comm-central/diff/5f5fbb45e801293526d7c6ab2158f7b7875c2828/mailnews/addrbook/src/nsDirPrefs.cpp">diff</a> |
<a href="/comm-central/comparison/5f5fbb45e801293526d7c6ab2158f7b7875c2828/mailnews/addrbook/src/nsDirPrefs.cpp">comparison</a> |
<a href="/comm-central/log/5f5fbb45e801293526d7c6ab2158f7b7875c2828/mailnews/addrbook/src/nsDirPrefs.cpp">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/5f5fbb45e801293526d7c6ab2158f7b7875c2828/mailnews/base/search/src/nsMsgSearchAdapter.cpp">mailnews/base/search/src/nsMsgSearchAdapter.cpp</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/5f5fbb45e801293526d7c6ab2158f7b7875c2828/mailnews/base/search/src/nsMsgSearchAdapter.cpp">file</a> |
<a href="/comm-central/annotate/5f5fbb45e801293526d7c6ab2158f7b7875c2828/mailnews/base/search/src/nsMsgSearchAdapter.cpp">annotate</a> |
<a href="/comm-central/diff/5f5fbb45e801293526d7c6ab2158f7b7875c2828/mailnews/base/search/src/nsMsgSearchAdapter.cpp">diff</a> |
<a href="/comm-central/comparison/5f5fbb45e801293526d7c6ab2158f7b7875c2828/mailnews/base/search/src/nsMsgSearchAdapter.cpp">comparison</a> |
<a href="/comm-central/log/5f5fbb45e801293526d7c6ab2158f7b7875c2828/mailnews/base/search/src/nsMsgSearchAdapter.cpp">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/5f5fbb45e801293526d7c6ab2158f7b7875c2828/mailnews/base/search/src/nsMsgSearchTerm.cpp">mailnews/base/search/src/nsMsgSearchTerm.cpp</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/5f5fbb45e801293526d7c6ab2158f7b7875c2828/mailnews/base/search/src/nsMsgSearchTerm.cpp">file</a> |
<a href="/comm-central/annotate/5f5fbb45e801293526d7c6ab2158f7b7875c2828/mailnews/base/search/src/nsMsgSearchTerm.cpp">annotate</a> |
<a href="/comm-central/diff/5f5fbb45e801293526d7c6ab2158f7b7875c2828/mailnews/base/search/src/nsMsgSearchTerm.cpp">diff</a> |
<a href="/comm-central/comparison/5f5fbb45e801293526d7c6ab2158f7b7875c2828/mailnews/base/search/src/nsMsgSearchTerm.cpp">comparison</a> |
<a href="/comm-central/log/5f5fbb45e801293526d7c6ab2158f7b7875c2828/mailnews/base/search/src/nsMsgSearchTerm.cpp">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/5f5fbb45e801293526d7c6ab2158f7b7875c2828/mailnews/base/src/nsMsgAccount.cpp">mailnews/base/src/nsMsgAccount.cpp</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/5f5fbb45e801293526d7c6ab2158f7b7875c2828/mailnews/base/src/nsMsgAccount.cpp">file</a> |
<a href="/comm-central/annotate/5f5fbb45e801293526d7c6ab2158f7b7875c2828/mailnews/base/src/nsMsgAccount.cpp">annotate</a> |
<a href="/comm-central/diff/5f5fbb45e801293526d7c6ab2158f7b7875c2828/mailnews/base/src/nsMsgAccount.cpp">diff</a> |
<a href="/comm-central/comparison/5f5fbb45e801293526d7c6ab2158f7b7875c2828/mailnews/base/src/nsMsgAccount.cpp">comparison</a> |
<a href="/comm-central/log/5f5fbb45e801293526d7c6ab2158f7b7875c2828/mailnews/base/src/nsMsgAccount.cpp">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/5f5fbb45e801293526d7c6ab2158f7b7875c2828/mailnews/base/src/nsMsgAccountManager.cpp">mailnews/base/src/nsMsgAccountManager.cpp</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/5f5fbb45e801293526d7c6ab2158f7b7875c2828/mailnews/base/src/nsMsgAccountManager.cpp">file</a> |
<a href="/comm-central/annotate/5f5fbb45e801293526d7c6ab2158f7b7875c2828/mailnews/base/src/nsMsgAccountManager.cpp">annotate</a> |
<a href="/comm-central/diff/5f5fbb45e801293526d7c6ab2158f7b7875c2828/mailnews/base/src/nsMsgAccountManager.cpp">diff</a> |
<a href="/comm-central/comparison/5f5fbb45e801293526d7c6ab2158f7b7875c2828/mailnews/base/src/nsMsgAccountManager.cpp">comparison</a> |
<a href="/comm-central/log/5f5fbb45e801293526d7c6ab2158f7b7875c2828/mailnews/base/src/nsMsgAccountManager.cpp">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/5f5fbb45e801293526d7c6ab2158f7b7875c2828/mailnews/base/src/nsMsgContentPolicy.cpp">mailnews/base/src/nsMsgContentPolicy.cpp</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/5f5fbb45e801293526d7c6ab2158f7b7875c2828/mailnews/base/src/nsMsgContentPolicy.cpp">file</a> |
<a href="/comm-central/annotate/5f5fbb45e801293526d7c6ab2158f7b7875c2828/mailnews/base/src/nsMsgContentPolicy.cpp">annotate</a> |
<a href="/comm-central/diff/5f5fbb45e801293526d7c6ab2158f7b7875c2828/mailnews/base/src/nsMsgContentPolicy.cpp">diff</a> |
<a href="/comm-central/comparison/5f5fbb45e801293526d7c6ab2158f7b7875c2828/mailnews/base/src/nsMsgContentPolicy.cpp">comparison</a> |
<a href="/comm-central/log/5f5fbb45e801293526d7c6ab2158f7b7875c2828/mailnews/base/src/nsMsgContentPolicy.cpp">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/5f5fbb45e801293526d7c6ab2158f7b7875c2828/mailnews/base/src/nsMsgTagService.cpp">mailnews/base/src/nsMsgTagService.cpp</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/5f5fbb45e801293526d7c6ab2158f7b7875c2828/mailnews/base/src/nsMsgTagService.cpp">file</a> |
<a href="/comm-central/annotate/5f5fbb45e801293526d7c6ab2158f7b7875c2828/mailnews/base/src/nsMsgTagService.cpp">annotate</a> |
<a href="/comm-central/diff/5f5fbb45e801293526d7c6ab2158f7b7875c2828/mailnews/base/src/nsMsgTagService.cpp">diff</a> |
<a href="/comm-central/comparison/5f5fbb45e801293526d7c6ab2158f7b7875c2828/mailnews/base/src/nsMsgTagService.cpp">comparison</a> |
<a href="/comm-central/log/5f5fbb45e801293526d7c6ab2158f7b7875c2828/mailnews/base/src/nsMsgTagService.cpp">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/5f5fbb45e801293526d7c6ab2158f7b7875c2828/mailnews/base/src/nsSpamSettings.cpp">mailnews/base/src/nsSpamSettings.cpp</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/5f5fbb45e801293526d7c6ab2158f7b7875c2828/mailnews/base/src/nsSpamSettings.cpp">file</a> |
<a href="/comm-central/annotate/5f5fbb45e801293526d7c6ab2158f7b7875c2828/mailnews/base/src/nsSpamSettings.cpp">annotate</a> |
<a href="/comm-central/diff/5f5fbb45e801293526d7c6ab2158f7b7875c2828/mailnews/base/src/nsSpamSettings.cpp">diff</a> |
<a href="/comm-central/comparison/5f5fbb45e801293526d7c6ab2158f7b7875c2828/mailnews/base/src/nsSpamSettings.cpp">comparison</a> |
<a href="/comm-central/log/5f5fbb45e801293526d7c6ab2158f7b7875c2828/mailnews/base/src/nsSpamSettings.cpp">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/5f5fbb45e801293526d7c6ab2158f7b7875c2828/mailnews/base/src/nsStatusBarBiffManager.cpp">mailnews/base/src/nsStatusBarBiffManager.cpp</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/5f5fbb45e801293526d7c6ab2158f7b7875c2828/mailnews/base/src/nsStatusBarBiffManager.cpp">file</a> |
<a href="/comm-central/annotate/5f5fbb45e801293526d7c6ab2158f7b7875c2828/mailnews/base/src/nsStatusBarBiffManager.cpp">annotate</a> |
<a href="/comm-central/diff/5f5fbb45e801293526d7c6ab2158f7b7875c2828/mailnews/base/src/nsStatusBarBiffManager.cpp">diff</a> |
<a href="/comm-central/comparison/5f5fbb45e801293526d7c6ab2158f7b7875c2828/mailnews/base/src/nsStatusBarBiffManager.cpp">comparison</a> |
<a href="/comm-central/log/5f5fbb45e801293526d7c6ab2158f7b7875c2828/mailnews/base/src/nsStatusBarBiffManager.cpp">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/5f5fbb45e801293526d7c6ab2158f7b7875c2828/mailnews/base/util/nsMsgIdentity.cpp">mailnews/base/util/nsMsgIdentity.cpp</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/5f5fbb45e801293526d7c6ab2158f7b7875c2828/mailnews/base/util/nsMsgIdentity.cpp">file</a> |
<a href="/comm-central/annotate/5f5fbb45e801293526d7c6ab2158f7b7875c2828/mailnews/base/util/nsMsgIdentity.cpp">annotate</a> |
<a href="/comm-central/diff/5f5fbb45e801293526d7c6ab2158f7b7875c2828/mailnews/base/util/nsMsgIdentity.cpp">diff</a> |
<a href="/comm-central/comparison/5f5fbb45e801293526d7c6ab2158f7b7875c2828/mailnews/base/util/nsMsgIdentity.cpp">comparison</a> |
<a href="/comm-central/log/5f5fbb45e801293526d7c6ab2158f7b7875c2828/mailnews/base/util/nsMsgIdentity.cpp">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/5f5fbb45e801293526d7c6ab2158f7b7875c2828/mailnews/base/util/nsMsgIncomingServer.cpp">mailnews/base/util/nsMsgIncomingServer.cpp</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/5f5fbb45e801293526d7c6ab2158f7b7875c2828/mailnews/base/util/nsMsgIncomingServer.cpp">file</a> |
<a href="/comm-central/annotate/5f5fbb45e801293526d7c6ab2158f7b7875c2828/mailnews/base/util/nsMsgIncomingServer.cpp">annotate</a> |
<a href="/comm-central/diff/5f5fbb45e801293526d7c6ab2158f7b7875c2828/mailnews/base/util/nsMsgIncomingServer.cpp">diff</a> |
<a href="/comm-central/comparison/5f5fbb45e801293526d7c6ab2158f7b7875c2828/mailnews/base/util/nsMsgIncomingServer.cpp">comparison</a> |
<a href="/comm-central/log/5f5fbb45e801293526d7c6ab2158f7b7875c2828/mailnews/base/util/nsMsgIncomingServer.cpp">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/5f5fbb45e801293526d7c6ab2158f7b7875c2828/mailnews/compose/public/nsISmtpServer.idl">mailnews/compose/public/nsISmtpServer.idl</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/5f5fbb45e801293526d7c6ab2158f7b7875c2828/mailnews/compose/public/nsISmtpServer.idl">file</a> |
<a href="/comm-central/annotate/5f5fbb45e801293526d7c6ab2158f7b7875c2828/mailnews/compose/public/nsISmtpServer.idl">annotate</a> |
<a href="/comm-central/diff/5f5fbb45e801293526d7c6ab2158f7b7875c2828/mailnews/compose/public/nsISmtpServer.idl">diff</a> |
<a href="/comm-central/comparison/5f5fbb45e801293526d7c6ab2158f7b7875c2828/mailnews/compose/public/nsISmtpServer.idl">comparison</a> |
<a href="/comm-central/log/5f5fbb45e801293526d7c6ab2158f7b7875c2828/mailnews/compose/public/nsISmtpServer.idl">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/5f5fbb45e801293526d7c6ab2158f7b7875c2828/mailnews/compose/src/nsMsgCompUtils.cpp">mailnews/compose/src/nsMsgCompUtils.cpp</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/5f5fbb45e801293526d7c6ab2158f7b7875c2828/mailnews/compose/src/nsMsgCompUtils.cpp">file</a> |
<a href="/comm-central/annotate/5f5fbb45e801293526d7c6ab2158f7b7875c2828/mailnews/compose/src/nsMsgCompUtils.cpp">annotate</a> |
<a href="/comm-central/diff/5f5fbb45e801293526d7c6ab2158f7b7875c2828/mailnews/compose/src/nsMsgCompUtils.cpp">diff</a> |
<a href="/comm-central/comparison/5f5fbb45e801293526d7c6ab2158f7b7875c2828/mailnews/compose/src/nsMsgCompUtils.cpp">comparison</a> |
<a href="/comm-central/log/5f5fbb45e801293526d7c6ab2158f7b7875c2828/mailnews/compose/src/nsMsgCompUtils.cpp">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/5f5fbb45e801293526d7c6ab2158f7b7875c2828/mailnews/compose/src/nsMsgCompose.cpp">mailnews/compose/src/nsMsgCompose.cpp</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/5f5fbb45e801293526d7c6ab2158f7b7875c2828/mailnews/compose/src/nsMsgCompose.cpp">file</a> |
<a href="/comm-central/annotate/5f5fbb45e801293526d7c6ab2158f7b7875c2828/mailnews/compose/src/nsMsgCompose.cpp">annotate</a> |
<a href="/comm-central/diff/5f5fbb45e801293526d7c6ab2158f7b7875c2828/mailnews/compose/src/nsMsgCompose.cpp">diff</a> |
<a href="/comm-central/comparison/5f5fbb45e801293526d7c6ab2158f7b7875c2828/mailnews/compose/src/nsMsgCompose.cpp">comparison</a> |
<a href="/comm-central/log/5f5fbb45e801293526d7c6ab2158f7b7875c2828/mailnews/compose/src/nsMsgCompose.cpp">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/5f5fbb45e801293526d7c6ab2158f7b7875c2828/mailnews/compose/src/nsMsgComposeService.cpp">mailnews/compose/src/nsMsgComposeService.cpp</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/5f5fbb45e801293526d7c6ab2158f7b7875c2828/mailnews/compose/src/nsMsgComposeService.cpp">file</a> |
<a href="/comm-central/annotate/5f5fbb45e801293526d7c6ab2158f7b7875c2828/mailnews/compose/src/nsMsgComposeService.cpp">annotate</a> |
<a href="/comm-central/diff/5f5fbb45e801293526d7c6ab2158f7b7875c2828/mailnews/compose/src/nsMsgComposeService.cpp">diff</a> |
<a href="/comm-central/comparison/5f5fbb45e801293526d7c6ab2158f7b7875c2828/mailnews/compose/src/nsMsgComposeService.cpp">comparison</a> |
<a href="/comm-central/log/5f5fbb45e801293526d7c6ab2158f7b7875c2828/mailnews/compose/src/nsMsgComposeService.cpp">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/5f5fbb45e801293526d7c6ab2158f7b7875c2828/mailnews/compose/src/nsSmtpProtocol.cpp">mailnews/compose/src/nsSmtpProtocol.cpp</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/5f5fbb45e801293526d7c6ab2158f7b7875c2828/mailnews/compose/src/nsSmtpProtocol.cpp">file</a> |
<a href="/comm-central/annotate/5f5fbb45e801293526d7c6ab2158f7b7875c2828/mailnews/compose/src/nsSmtpProtocol.cpp">annotate</a> |
<a href="/comm-central/diff/5f5fbb45e801293526d7c6ab2158f7b7875c2828/mailnews/compose/src/nsSmtpProtocol.cpp">diff</a> |
<a href="/comm-central/comparison/5f5fbb45e801293526d7c6ab2158f7b7875c2828/mailnews/compose/src/nsSmtpProtocol.cpp">comparison</a> |
<a href="/comm-central/log/5f5fbb45e801293526d7c6ab2158f7b7875c2828/mailnews/compose/src/nsSmtpProtocol.cpp">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/5f5fbb45e801293526d7c6ab2158f7b7875c2828/mailnews/compose/src/nsSmtpServer.cpp">mailnews/compose/src/nsSmtpServer.cpp</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/5f5fbb45e801293526d7c6ab2158f7b7875c2828/mailnews/compose/src/nsSmtpServer.cpp">file</a> |
<a href="/comm-central/annotate/5f5fbb45e801293526d7c6ab2158f7b7875c2828/mailnews/compose/src/nsSmtpServer.cpp">annotate</a> |
<a href="/comm-central/diff/5f5fbb45e801293526d7c6ab2158f7b7875c2828/mailnews/compose/src/nsSmtpServer.cpp">diff</a> |
<a href="/comm-central/comparison/5f5fbb45e801293526d7c6ab2158f7b7875c2828/mailnews/compose/src/nsSmtpServer.cpp">comparison</a> |
<a href="/comm-central/log/5f5fbb45e801293526d7c6ab2158f7b7875c2828/mailnews/compose/src/nsSmtpServer.cpp">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/5f5fbb45e801293526d7c6ab2158f7b7875c2828/mailnews/compose/src/nsSmtpService.cpp">mailnews/compose/src/nsSmtpService.cpp</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/5f5fbb45e801293526d7c6ab2158f7b7875c2828/mailnews/compose/src/nsSmtpService.cpp">file</a> |
<a href="/comm-central/annotate/5f5fbb45e801293526d7c6ab2158f7b7875c2828/mailnews/compose/src/nsSmtpService.cpp">annotate</a> |
<a href="/comm-central/diff/5f5fbb45e801293526d7c6ab2158f7b7875c2828/mailnews/compose/src/nsSmtpService.cpp">diff</a> |
<a href="/comm-central/comparison/5f5fbb45e801293526d7c6ab2158f7b7875c2828/mailnews/compose/src/nsSmtpService.cpp">comparison</a> |
<a href="/comm-central/log/5f5fbb45e801293526d7c6ab2158f7b7875c2828/mailnews/compose/src/nsSmtpService.cpp">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/5f5fbb45e801293526d7c6ab2158f7b7875c2828/mailnews/extensions/bayesian-spam-filter/src/nsBayesianFilter.cpp">mailnews/extensions/bayesian-spam-filter/src/nsBayesianFilter.cpp</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/5f5fbb45e801293526d7c6ab2158f7b7875c2828/mailnews/extensions/bayesian-spam-filter/src/nsBayesianFilter.cpp">file</a> |
<a href="/comm-central/annotate/5f5fbb45e801293526d7c6ab2158f7b7875c2828/mailnews/extensions/bayesian-spam-filter/src/nsBayesianFilter.cpp">annotate</a> |
<a href="/comm-central/diff/5f5fbb45e801293526d7c6ab2158f7b7875c2828/mailnews/extensions/bayesian-spam-filter/src/nsBayesianFilter.cpp">diff</a> |
<a href="/comm-central/comparison/5f5fbb45e801293526d7c6ab2158f7b7875c2828/mailnews/extensions/bayesian-spam-filter/src/nsBayesianFilter.cpp">comparison</a> |
<a href="/comm-central/log/5f5fbb45e801293526d7c6ab2158f7b7875c2828/mailnews/extensions/bayesian-spam-filter/src/nsBayesianFilter.cpp">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/5f5fbb45e801293526d7c6ab2158f7b7875c2828/mailnews/imap/src/nsImapMailFolder.cpp">mailnews/imap/src/nsImapMailFolder.cpp</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/5f5fbb45e801293526d7c6ab2158f7b7875c2828/mailnews/imap/src/nsImapMailFolder.cpp">file</a> |
<a href="/comm-central/annotate/5f5fbb45e801293526d7c6ab2158f7b7875c2828/mailnews/imap/src/nsImapMailFolder.cpp">annotate</a> |
<a href="/comm-central/diff/5f5fbb45e801293526d7c6ab2158f7b7875c2828/mailnews/imap/src/nsImapMailFolder.cpp">diff</a> |
<a href="/comm-central/comparison/5f5fbb45e801293526d7c6ab2158f7b7875c2828/mailnews/imap/src/nsImapMailFolder.cpp">comparison</a> |
<a href="/comm-central/log/5f5fbb45e801293526d7c6ab2158f7b7875c2828/mailnews/imap/src/nsImapMailFolder.cpp">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/5f5fbb45e801293526d7c6ab2158f7b7875c2828/mailnews/imap/src/nsImapProtocol.cpp">mailnews/imap/src/nsImapProtocol.cpp</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/5f5fbb45e801293526d7c6ab2158f7b7875c2828/mailnews/imap/src/nsImapProtocol.cpp">file</a> |
<a href="/comm-central/annotate/5f5fbb45e801293526d7c6ab2158f7b7875c2828/mailnews/imap/src/nsImapProtocol.cpp">annotate</a> |
<a href="/comm-central/diff/5f5fbb45e801293526d7c6ab2158f7b7875c2828/mailnews/imap/src/nsImapProtocol.cpp">diff</a> |
<a href="/comm-central/comparison/5f5fbb45e801293526d7c6ab2158f7b7875c2828/mailnews/imap/src/nsImapProtocol.cpp">comparison</a> |
<a href="/comm-central/log/5f5fbb45e801293526d7c6ab2158f7b7875c2828/mailnews/imap/src/nsImapProtocol.cpp">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/5f5fbb45e801293526d7c6ab2158f7b7875c2828/mailnews/import/text/src/nsTextImport.cpp">mailnews/import/text/src/nsTextImport.cpp</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/5f5fbb45e801293526d7c6ab2158f7b7875c2828/mailnews/import/text/src/nsTextImport.cpp">file</a> |
<a href="/comm-central/annotate/5f5fbb45e801293526d7c6ab2158f7b7875c2828/mailnews/import/text/src/nsTextImport.cpp">annotate</a> |
<a href="/comm-central/diff/5f5fbb45e801293526d7c6ab2158f7b7875c2828/mailnews/import/text/src/nsTextImport.cpp">diff</a> |
<a href="/comm-central/comparison/5f5fbb45e801293526d7c6ab2158f7b7875c2828/mailnews/import/text/src/nsTextImport.cpp">comparison</a> |
<a href="/comm-central/log/5f5fbb45e801293526d7c6ab2158f7b7875c2828/mailnews/import/text/src/nsTextImport.cpp">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/5f5fbb45e801293526d7c6ab2158f7b7875c2828/mailnews/local/src/nsLocalMailFolder.cpp">mailnews/local/src/nsLocalMailFolder.cpp</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/5f5fbb45e801293526d7c6ab2158f7b7875c2828/mailnews/local/src/nsLocalMailFolder.cpp">file</a> |
<a href="/comm-central/annotate/5f5fbb45e801293526d7c6ab2158f7b7875c2828/mailnews/local/src/nsLocalMailFolder.cpp">annotate</a> |
<a href="/comm-central/diff/5f5fbb45e801293526d7c6ab2158f7b7875c2828/mailnews/local/src/nsLocalMailFolder.cpp">diff</a> |
<a href="/comm-central/comparison/5f5fbb45e801293526d7c6ab2158f7b7875c2828/mailnews/local/src/nsLocalMailFolder.cpp">comparison</a> |
<a href="/comm-central/log/5f5fbb45e801293526d7c6ab2158f7b7875c2828/mailnews/local/src/nsLocalMailFolder.cpp">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/5f5fbb45e801293526d7c6ab2158f7b7875c2828/mailnews/local/src/nsParseMailbox.cpp">mailnews/local/src/nsParseMailbox.cpp</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/5f5fbb45e801293526d7c6ab2158f7b7875c2828/mailnews/local/src/nsParseMailbox.cpp">file</a> |
<a href="/comm-central/annotate/5f5fbb45e801293526d7c6ab2158f7b7875c2828/mailnews/local/src/nsParseMailbox.cpp">annotate</a> |
<a href="/comm-central/diff/5f5fbb45e801293526d7c6ab2158f7b7875c2828/mailnews/local/src/nsParseMailbox.cpp">diff</a> |
<a href="/comm-central/comparison/5f5fbb45e801293526d7c6ab2158f7b7875c2828/mailnews/local/src/nsParseMailbox.cpp">comparison</a> |
<a href="/comm-central/log/5f5fbb45e801293526d7c6ab2158f7b7875c2828/mailnews/local/src/nsParseMailbox.cpp">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/5f5fbb45e801293526d7c6ab2158f7b7875c2828/mailnews/mime/cthandlers/pgpmime/nsPgpMimeProxy.cpp">mailnews/mime/cthandlers/pgpmime/nsPgpMimeProxy.cpp</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/5f5fbb45e801293526d7c6ab2158f7b7875c2828/mailnews/mime/cthandlers/pgpmime/nsPgpMimeProxy.cpp">file</a> |
<a href="/comm-central/annotate/5f5fbb45e801293526d7c6ab2158f7b7875c2828/mailnews/mime/cthandlers/pgpmime/nsPgpMimeProxy.cpp">annotate</a> |
<a href="/comm-central/diff/5f5fbb45e801293526d7c6ab2158f7b7875c2828/mailnews/mime/cthandlers/pgpmime/nsPgpMimeProxy.cpp">diff</a> |
<a href="/comm-central/comparison/5f5fbb45e801293526d7c6ab2158f7b7875c2828/mailnews/mime/cthandlers/pgpmime/nsPgpMimeProxy.cpp">comparison</a> |
<a href="/comm-central/log/5f5fbb45e801293526d7c6ab2158f7b7875c2828/mailnews/mime/cthandlers/pgpmime/nsPgpMimeProxy.cpp">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/5f5fbb45e801293526d7c6ab2158f7b7875c2828/mailnews/mime/emitters/nsMimeHtmlEmitter.cpp">mailnews/mime/emitters/nsMimeHtmlEmitter.cpp</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/5f5fbb45e801293526d7c6ab2158f7b7875c2828/mailnews/mime/emitters/nsMimeHtmlEmitter.cpp">file</a> |
<a href="/comm-central/annotate/5f5fbb45e801293526d7c6ab2158f7b7875c2828/mailnews/mime/emitters/nsMimeHtmlEmitter.cpp">annotate</a> |
<a href="/comm-central/diff/5f5fbb45e801293526d7c6ab2158f7b7875c2828/mailnews/mime/emitters/nsMimeHtmlEmitter.cpp">diff</a> |
<a href="/comm-central/comparison/5f5fbb45e801293526d7c6ab2158f7b7875c2828/mailnews/mime/emitters/nsMimeHtmlEmitter.cpp">comparison</a> |
<a href="/comm-central/log/5f5fbb45e801293526d7c6ab2158f7b7875c2828/mailnews/mime/emitters/nsMimeHtmlEmitter.cpp">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/5f5fbb45e801293526d7c6ab2158f7b7875c2828/mailnews/mime/src/mimedrft.cpp">mailnews/mime/src/mimedrft.cpp</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/5f5fbb45e801293526d7c6ab2158f7b7875c2828/mailnews/mime/src/mimedrft.cpp">file</a> |
<a href="/comm-central/annotate/5f5fbb45e801293526d7c6ab2158f7b7875c2828/mailnews/mime/src/mimedrft.cpp">annotate</a> |
<a href="/comm-central/diff/5f5fbb45e801293526d7c6ab2158f7b7875c2828/mailnews/mime/src/mimedrft.cpp">diff</a> |
<a href="/comm-central/comparison/5f5fbb45e801293526d7c6ab2158f7b7875c2828/mailnews/mime/src/mimedrft.cpp">comparison</a> |
<a href="/comm-central/log/5f5fbb45e801293526d7c6ab2158f7b7875c2828/mailnews/mime/src/mimedrft.cpp">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/5f5fbb45e801293526d7c6ab2158f7b7875c2828/mailnews/mime/src/mimemoz2.cpp">mailnews/mime/src/mimemoz2.cpp</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/5f5fbb45e801293526d7c6ab2158f7b7875c2828/mailnews/mime/src/mimemoz2.cpp">file</a> |
<a href="/comm-central/annotate/5f5fbb45e801293526d7c6ab2158f7b7875c2828/mailnews/mime/src/mimemoz2.cpp">annotate</a> |
<a href="/comm-central/diff/5f5fbb45e801293526d7c6ab2158f7b7875c2828/mailnews/mime/src/mimemoz2.cpp">diff</a> |
<a href="/comm-central/comparison/5f5fbb45e801293526d7c6ab2158f7b7875c2828/mailnews/mime/src/mimemoz2.cpp">comparison</a> |
<a href="/comm-central/log/5f5fbb45e801293526d7c6ab2158f7b7875c2828/mailnews/mime/src/mimemoz2.cpp">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/5f5fbb45e801293526d7c6ab2158f7b7875c2828/mailnews/mime/src/mimetpfl.cpp">mailnews/mime/src/mimetpfl.cpp</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/5f5fbb45e801293526d7c6ab2158f7b7875c2828/mailnews/mime/src/mimetpfl.cpp">file</a> |
<a href="/comm-central/annotate/5f5fbb45e801293526d7c6ab2158f7b7875c2828/mailnews/mime/src/mimetpfl.cpp">annotate</a> |
<a href="/comm-central/diff/5f5fbb45e801293526d7c6ab2158f7b7875c2828/mailnews/mime/src/mimetpfl.cpp">diff</a> |
<a href="/comm-central/comparison/5f5fbb45e801293526d7c6ab2158f7b7875c2828/mailnews/mime/src/mimetpfl.cpp">comparison</a> |
<a href="/comm-central/log/5f5fbb45e801293526d7c6ab2158f7b7875c2828/mailnews/mime/src/mimetpfl.cpp">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/5f5fbb45e801293526d7c6ab2158f7b7875c2828/mailnews/mime/src/mimetpfl.h">mailnews/mime/src/mimetpfl.h</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/5f5fbb45e801293526d7c6ab2158f7b7875c2828/mailnews/mime/src/mimetpfl.h">file</a> |
<a href="/comm-central/annotate/5f5fbb45e801293526d7c6ab2158f7b7875c2828/mailnews/mime/src/mimetpfl.h">annotate</a> |
<a href="/comm-central/diff/5f5fbb45e801293526d7c6ab2158f7b7875c2828/mailnews/mime/src/mimetpfl.h">diff</a> |
<a href="/comm-central/comparison/5f5fbb45e801293526d7c6ab2158f7b7875c2828/mailnews/mime/src/mimetpfl.h">comparison</a> |
<a href="/comm-central/log/5f5fbb45e801293526d7c6ab2158f7b7875c2828/mailnews/mime/src/mimetpfl.h">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/5f5fbb45e801293526d7c6ab2158f7b7875c2828/mailnews/mime/src/mimetpla.cpp">mailnews/mime/src/mimetpla.cpp</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/5f5fbb45e801293526d7c6ab2158f7b7875c2828/mailnews/mime/src/mimetpla.cpp">file</a> |
<a href="/comm-central/annotate/5f5fbb45e801293526d7c6ab2158f7b7875c2828/mailnews/mime/src/mimetpla.cpp">annotate</a> |
<a href="/comm-central/diff/5f5fbb45e801293526d7c6ab2158f7b7875c2828/mailnews/mime/src/mimetpla.cpp">diff</a> |
<a href="/comm-central/comparison/5f5fbb45e801293526d7c6ab2158f7b7875c2828/mailnews/mime/src/mimetpla.cpp">comparison</a> |
<a href="/comm-central/log/5f5fbb45e801293526d7c6ab2158f7b7875c2828/mailnews/mime/src/mimetpla.cpp">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/5f5fbb45e801293526d7c6ab2158f7b7875c2828/mailnews/mime/src/mimetpla.h">mailnews/mime/src/mimetpla.h</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/5f5fbb45e801293526d7c6ab2158f7b7875c2828/mailnews/mime/src/mimetpla.h">file</a> |
<a href="/comm-central/annotate/5f5fbb45e801293526d7c6ab2158f7b7875c2828/mailnews/mime/src/mimetpla.h">annotate</a> |
<a href="/comm-central/diff/5f5fbb45e801293526d7c6ab2158f7b7875c2828/mailnews/mime/src/mimetpla.h">diff</a> |
<a href="/comm-central/comparison/5f5fbb45e801293526d7c6ab2158f7b7875c2828/mailnews/mime/src/mimetpla.h">comparison</a> |
<a href="/comm-central/log/5f5fbb45e801293526d7c6ab2158f7b7875c2828/mailnews/mime/src/mimetpla.h">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/5f5fbb45e801293526d7c6ab2158f7b7875c2828/suite/profile/migration/src/nsNetscapeProfileMigratorBase.cpp">suite/profile/migration/src/nsNetscapeProfileMigratorBase.cpp</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/5f5fbb45e801293526d7c6ab2158f7b7875c2828/suite/profile/migration/src/nsNetscapeProfileMigratorBase.cpp">file</a> |
<a href="/comm-central/annotate/5f5fbb45e801293526d7c6ab2158f7b7875c2828/suite/profile/migration/src/nsNetscapeProfileMigratorBase.cpp">annotate</a> |
<a href="/comm-central/diff/5f5fbb45e801293526d7c6ab2158f7b7875c2828/suite/profile/migration/src/nsNetscapeProfileMigratorBase.cpp">diff</a> |
<a href="/comm-central/comparison/5f5fbb45e801293526d7c6ab2158f7b7875c2828/suite/profile/migration/src/nsNetscapeProfileMigratorBase.cpp">comparison</a> |
<a href="/comm-central/log/5f5fbb45e801293526d7c6ab2158f7b7875c2828/suite/profile/migration/src/nsNetscapeProfileMigratorBase.cpp">revisions</a>
</td>
</tr>
</table></div>

<div class="page_body diffblocks"><div class="diffblock"><pre class="sourcelines">
<a href="#l1.1"></a><span id="l1.1" class="difflineminus">--- a/mail/components/migration/src/nsMailProfileMigratorUtils.cpp</span>
<a href="#l1.2"></a><span id="l1.2" class="difflineplus">+++ b/mail/components/migration/src/nsMailProfileMigratorUtils.cpp</span>
<a href="#l1.3"></a><span id="l1.3" class="difflineat">@@ -17,23 +17,23 @@ void SetProxyPref(const nsACString&amp; aHos</span>
<a href="#l1.4"></a><span id="l1.4"> {</span>
<a href="#l1.5"></a><span id="l1.5">   nsAutoCString hostPort(aHostPort);</span>
<a href="#l1.6"></a><span id="l1.6">   int32_t portDelimOffset = hostPort.RFindChar(':');</span>
<a href="#l1.7"></a><span id="l1.7">   if (portDelimOffset &gt; 0) {</span>
<a href="#l1.8"></a><span id="l1.8">     nsAutoCString host(Substring(hostPort, 0, portDelimOffset));</span>
<a href="#l1.9"></a><span id="l1.9">     nsAutoCString port(Substring(hostPort, portDelimOffset + 1,</span>
<a href="#l1.10"></a><span id="l1.10">                                  hostPort.Length() - (portDelimOffset + 1)));</span>
<a href="#l1.11"></a><span id="l1.11"> </span>
<a href="#l1.12"></a><span id="l1.12" class="difflineminus">-    aPrefs-&gt;SetCharPref(aPref, host.get());</span>
<a href="#l1.13"></a><span id="l1.13" class="difflineplus">+    aPrefs-&gt;SetCharPref(aPref, host);</span>
<a href="#l1.14"></a><span id="l1.14">     nsresult stringErr;</span>
<a href="#l1.15"></a><span id="l1.15">     int32_t portValue = port.ToInteger(&amp;stringErr);</span>
<a href="#l1.16"></a><span id="l1.16">     aPrefs-&gt;SetIntPref(aPortPref, portValue);</span>
<a href="#l1.17"></a><span id="l1.17">   }</span>
<a href="#l1.18"></a><span id="l1.18">   else</span>
<a href="#l1.19"></a><span id="l1.19" class="difflineminus">-    aPrefs-&gt;SetCharPref(aPref, hostPort.get());</span>
<a href="#l1.20"></a><span id="l1.20" class="difflineplus">+    aPrefs-&gt;SetCharPref(aPref, hostPort);</span>
<a href="#l1.21"></a><span id="l1.21"> }</span>
<a href="#l1.22"></a><span id="l1.22"> </span>
<a href="#l1.23"></a><span id="l1.23"> void ParseOverrideServers(const char* aServers, nsIPrefBranch* aBranch)</span>
<a href="#l1.24"></a><span id="l1.24"> {</span>
<a href="#l1.25"></a><span id="l1.25">   // Windows (and Opera) formats its proxy override list in the form:</span>
<a href="#l1.26"></a><span id="l1.26">   // server;server;server where server is a server name or ip address,</span>
<a href="#l1.27"></a><span id="l1.27">   // or &quot;&lt;local&gt;&quot;. Mozilla's format is server,server,server, and &lt;local&gt;</span>
<a href="#l1.28"></a><span id="l1.28">   // must be translated to &quot;localhost,127.0.0.1&quot;</span>
<a href="#l1.29"></a><span id="l1.29" class="difflineat">@@ -45,17 +45,17 @@ void ParseOverrideServers(const char* aS</span>
<a href="#l1.30"></a><span id="l1.30">                                        (right &lt; 0 ? override.Length() : right) - left);</span>
<a href="#l1.31"></a><span id="l1.31">     if (host.Equals(&quot;&lt;local&gt;&quot;))</span>
<a href="#l1.32"></a><span id="l1.32">       override.Replace(left, 7, NS_LITERAL_CSTRING(&quot;localhost,127.0.0.1&quot;));</span>
<a href="#l1.33"></a><span id="l1.33">     if (right &lt; 0)</span>
<a href="#l1.34"></a><span id="l1.34">       break;</span>
<a href="#l1.35"></a><span id="l1.35">     left = right + 1;</span>
<a href="#l1.36"></a><span id="l1.36">     override.Replace(right, 1, NS_LITERAL_CSTRING(&quot;,&quot;));</span>
<a href="#l1.37"></a><span id="l1.37">   }</span>
<a href="#l1.38"></a><span id="l1.38" class="difflineminus">-  aBranch-&gt;SetCharPref(&quot;network.proxy.no_proxies_on&quot;, override.get());</span>
<a href="#l1.39"></a><span id="l1.39" class="difflineplus">+  aBranch-&gt;SetCharPref(&quot;network.proxy.no_proxies_on&quot;, override);</span>
<a href="#l1.40"></a><span id="l1.40"> }</span>
<a href="#l1.41"></a><span id="l1.41"> </span>
<a href="#l1.42"></a><span id="l1.42"> void GetMigrateDataFromArray(MigrationData* aDataArray, int32_t aDataArrayLength,</span>
<a href="#l1.43"></a><span id="l1.43">                              bool aReplace, nsIFile* aSourceProfile,</span>
<a href="#l1.44"></a><span id="l1.44">                              uint16_t* aResult)</span>
<a href="#l1.45"></a><span id="l1.45"> {</span>
<a href="#l1.46"></a><span id="l1.46">   nsCOMPtr&lt;nsIFile&gt; sourceFile;</span>
<a href="#l1.47"></a><span id="l1.47">   bool exists;</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l2.1"></a><span id="l2.1" class="difflineminus">--- a/mail/components/migration/src/nsNetscapeProfileMigratorBase.cpp</span>
<a href="#l2.2"></a><span id="l2.2" class="difflineplus">+++ b/mail/components/migration/src/nsNetscapeProfileMigratorBase.cpp</span>
<a href="#l2.3"></a><span id="l2.3" class="difflineat">@@ -127,25 +127,27 @@ nsNetscapeProfileMigratorBase::GetProfil</span>
<a href="#l2.4"></a><span id="l2.4">   } \</span>
<a href="#l2.5"></a><span id="l2.5">   return NS_OK;</span>
<a href="#l2.6"></a><span id="l2.6"> </span>
<a href="#l2.7"></a><span id="l2.7"> nsresult</span>
<a href="#l2.8"></a><span id="l2.8"> nsNetscapeProfileMigratorBase::GetString(PrefTransform* aTransform,</span>
<a href="#l2.9"></a><span id="l2.9">                                          nsIPrefBranch* aBranch)</span>
<a href="#l2.10"></a><span id="l2.10"> {</span>
<a href="#l2.11"></a><span id="l2.11">   PrefTransform* xform = (PrefTransform*)aTransform;</span>
<a href="#l2.12"></a><span id="l2.12" class="difflineminus">-  GETPREF(xform, GetCharPref, &amp;xform-&gt;stringValue);</span>
<a href="#l2.13"></a><span id="l2.13" class="difflineplus">+  nsCString str;</span>
<a href="#l2.14"></a><span id="l2.14" class="difflineplus">+  GETPREF(xform, GetCharPref, str);</span>
<a href="#l2.15"></a><span id="l2.15" class="difflineplus">+  xform-&gt;stringValue = moz_xstrdup(str.get());</span>
<a href="#l2.16"></a><span id="l2.16"> }</span>
<a href="#l2.17"></a><span id="l2.17"> </span>
<a href="#l2.18"></a><span id="l2.18"> nsresult</span>
<a href="#l2.19"></a><span id="l2.19"> nsNetscapeProfileMigratorBase::SetString(PrefTransform* aTransform,</span>
<a href="#l2.20"></a><span id="l2.20">                                          nsIPrefBranch* aBranch)</span>
<a href="#l2.21"></a><span id="l2.21"> {</span>
<a href="#l2.22"></a><span id="l2.22">   PrefTransform* xform = (PrefTransform*)aTransform;</span>
<a href="#l2.23"></a><span id="l2.23" class="difflineminus">-  SETPREF(xform, SetCharPref, xform-&gt;stringValue);</span>
<a href="#l2.24"></a><span id="l2.24" class="difflineplus">+  SETPREF(xform, SetCharPref, nsDependentCString(xform-&gt;stringValue));</span>
<a href="#l2.25"></a><span id="l2.25"> }</span>
<a href="#l2.26"></a><span id="l2.26"> </span>
<a href="#l2.27"></a><span id="l2.27"> nsresult</span>
<a href="#l2.28"></a><span id="l2.28"> nsNetscapeProfileMigratorBase::GetBool(PrefTransform* aTransform,</span>
<a href="#l2.29"></a><span id="l2.29">                                        nsIPrefBranch* aBranch)</span>
<a href="#l2.30"></a><span id="l2.30"> {</span>
<a href="#l2.31"></a><span id="l2.31">   PrefTransform* xform = (PrefTransform*)aTransform;</span>
<a href="#l2.32"></a><span id="l2.32">   GETPREF(xform, GetBoolPref, &amp;xform-&gt;boolValue);</span>
<a href="#l2.33"></a><span id="l2.33" class="difflineat">@@ -194,17 +196,17 @@ nsNetscapeProfileMigratorBase::CopyFile(</span>
<a href="#l2.34"></a><span id="l2.34">   targetFile-&gt;Exists(&amp;exists);</span>
<a href="#l2.35"></a><span id="l2.35">   if (exists)</span>
<a href="#l2.36"></a><span id="l2.36">     targetFile-&gt;Remove(false);</span>
<a href="#l2.37"></a><span id="l2.37"> </span>
<a href="#l2.38"></a><span id="l2.38">   return sourceFile-&gt;CopyTo(mTargetProfile, aTargetFileName);</span>
<a href="#l2.39"></a><span id="l2.39"> }</span>
<a href="#l2.40"></a><span id="l2.40"> </span>
<a href="#l2.41"></a><span id="l2.41"> nsresult</span>
<a href="#l2.42"></a><span id="l2.42" class="difflineminus">-nsNetscapeProfileMigratorBase::GetSignonFileName(bool aReplace, char** aFileName)</span>
<a href="#l2.43"></a><span id="l2.43" class="difflineplus">+nsNetscapeProfileMigratorBase::GetSignonFileName(bool aReplace, nsACString&amp; aFileName)</span>
<a href="#l2.44"></a><span id="l2.44"> {</span>
<a href="#l2.45"></a><span id="l2.45">   nsresult rv;</span>
<a href="#l2.46"></a><span id="l2.46">   if (aReplace) {</span>
<a href="#l2.47"></a><span id="l2.47">     // Find out what the signons file was called, this is stored in a pref</span>
<a href="#l2.48"></a><span id="l2.48">     // in Seamonkey.</span>
<a href="#l2.49"></a><span id="l2.49">     nsCOMPtr&lt;nsIPrefService&gt; psvc(do_GetService(NS_PREFSERVICE_CONTRACTID));</span>
<a href="#l2.50"></a><span id="l2.50">     psvc-&gt;ResetPrefs();</span>
<a href="#l2.51"></a><span id="l2.51"> </span>
<a href="#l2.52"></a><span id="l2.52" class="difflineat">@@ -217,17 +219,17 @@ nsNetscapeProfileMigratorBase::GetSignon</span>
<a href="#l2.53"></a><span id="l2.53">     rv = branch-&gt;GetCharPref(&quot;signon.SignonFileName&quot;, aFileName);</span>
<a href="#l2.54"></a><span id="l2.54">   }</span>
<a href="#l2.55"></a><span id="l2.55">   else</span>
<a href="#l2.56"></a><span id="l2.56">     rv = LocateSignonsFile(aFileName);</span>
<a href="#l2.57"></a><span id="l2.57">   return rv;</span>
<a href="#l2.58"></a><span id="l2.58"> }</span>
<a href="#l2.59"></a><span id="l2.59"> </span>
<a href="#l2.60"></a><span id="l2.60"> nsresult</span>
<a href="#l2.61"></a><span id="l2.61" class="difflineminus">-nsNetscapeProfileMigratorBase::LocateSignonsFile(char** aResult)</span>
<a href="#l2.62"></a><span id="l2.62" class="difflineplus">+nsNetscapeProfileMigratorBase::LocateSignonsFile(nsACString&amp; aResult)</span>
<a href="#l2.63"></a><span id="l2.63"> {</span>
<a href="#l2.64"></a><span id="l2.64">   nsCOMPtr&lt;nsISimpleEnumerator&gt; entries;</span>
<a href="#l2.65"></a><span id="l2.65">   nsresult rv = mSourceProfile-&gt;GetDirectoryEntries(getter_AddRefs(entries));</span>
<a href="#l2.66"></a><span id="l2.66">   if (NS_FAILED(rv)) return rv;</span>
<a href="#l2.67"></a><span id="l2.67"> </span>
<a href="#l2.68"></a><span id="l2.68">   nsAutoCString fileName;</span>
<a href="#l2.69"></a><span id="l2.69">   do {</span>
<a href="#l2.70"></a><span id="l2.70">     bool hasMore = false;</span>
<a href="#l2.71"></a><span id="l2.71" class="difflineat">@@ -250,17 +252,17 @@ nsNetscapeProfileMigratorBase::LocateSig</span>
<a href="#l2.72"></a><span id="l2.72"> </span>
<a href="#l2.73"></a><span id="l2.73">     if (extn.EqualsIgnoreCase(&quot;s&quot;)) {</span>
<a href="#l2.74"></a><span id="l2.74">       url-&gt;GetFileName(fileName);</span>
<a href="#l2.75"></a><span id="l2.75">       break;</span>
<a href="#l2.76"></a><span id="l2.76">     }</span>
<a href="#l2.77"></a><span id="l2.77">   }</span>
<a href="#l2.78"></a><span id="l2.78">   while (1);</span>
<a href="#l2.79"></a><span id="l2.79"> </span>
<a href="#l2.80"></a><span id="l2.80" class="difflineminus">-  *aResult = ToNewCString(fileName);</span>
<a href="#l2.81"></a><span id="l2.81" class="difflineplus">+  aResult = fileName;</span>
<a href="#l2.82"></a><span id="l2.82"> </span>
<a href="#l2.83"></a><span id="l2.83">   return NS_OK;</span>
<a href="#l2.84"></a><span id="l2.84"> }</span>
<a href="#l2.85"></a><span id="l2.85"> </span>
<a href="#l2.86"></a><span id="l2.86"> // helper function, copies the contents of srcDir into destDir.</span>
<a href="#l2.87"></a><span id="l2.87"> // destDir will be created if it doesn't exist.</span>
<a href="#l2.88"></a><span id="l2.88"> </span>
<a href="#l2.89"></a><span id="l2.89"> nsresult nsNetscapeProfileMigratorBase::RecursiveCopy(nsIFile* srcDir, nsIFile* destDir)</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l3.1"></a><span id="l3.1" class="difflineminus">--- a/mail/components/migration/src/nsNetscapeProfileMigratorBase.h</span>
<a href="#l3.2"></a><span id="l3.2" class="difflineplus">+++ b/mail/components/migration/src/nsNetscapeProfileMigratorBase.h</span>
<a href="#l3.3"></a><span id="l3.3" class="difflineat">@@ -87,18 +87,18 @@ protected:</span>
<a href="#l3.4"></a><span id="l3.4">   void EndCopyFolders();</span>
<a href="#l3.5"></a><span id="l3.5"> </span>
<a href="#l3.6"></a><span id="l3.6">   nsresult GetProfileDataFromProfilesIni(nsIFile* aDataDir,</span>
<a href="#l3.7"></a><span id="l3.7">                                          nsIMutableArray* aProfileNames,</span>
<a href="#l3.8"></a><span id="l3.8">                                          nsIMutableArray* aProfileLocations);</span>
<a href="#l3.9"></a><span id="l3.9"> </span>
<a href="#l3.10"></a><span id="l3.10">   nsresult CopyFile(const nsAString&amp; aSourceFileName, const nsAString&amp; aTargetFileName);</span>
<a href="#l3.11"></a><span id="l3.11"> </span>
<a href="#l3.12"></a><span id="l3.12" class="difflineminus">-  nsresult GetSignonFileName(bool aReplace, char** aFileName);</span>
<a href="#l3.13"></a><span id="l3.13" class="difflineminus">-  nsresult LocateSignonsFile(char** aResult);</span>
<a href="#l3.14"></a><span id="l3.14" class="difflineplus">+  nsresult GetSignonFileName(bool aReplace, nsACString&amp; aFileName);</span>
<a href="#l3.15"></a><span id="l3.15" class="difflineplus">+  nsresult LocateSignonsFile(nsACString&amp; aResult);</span>
<a href="#l3.16"></a><span id="l3.16"> </span>
<a href="#l3.17"></a><span id="l3.17">   nsCOMPtr&lt;nsIFile&gt; mSourceProfile;</span>
<a href="#l3.18"></a><span id="l3.18">   nsCOMPtr&lt;nsIFile&gt; mTargetProfile;</span>
<a href="#l3.19"></a><span id="l3.19"> </span>
<a href="#l3.20"></a><span id="l3.20">   // List of src/destination files we still have to copy into the new profile</span>
<a href="#l3.21"></a><span id="l3.21">   // directory.</span>
<a href="#l3.22"></a><span id="l3.22">   nsTArray&lt;fileTransactionEntry&gt; mFileCopyTransactions;</span>
<a href="#l3.23"></a><span id="l3.23">   uint32_t mFileCopyTransactionIndex;</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l4.1"></a><span id="l4.1" class="difflineminus">--- a/mail/components/migration/src/nsProfileMigrator.cpp</span>
<a href="#l4.2"></a><span id="l4.2" class="difflineplus">+++ b/mail/components/migration/src/nsProfileMigrator.cpp</span>
<a href="#l4.3"></a><span id="l4.3" class="difflineat">@@ -77,17 +77,17 @@ nsProfileMigrator::GetDefaultMailMigrato</span>
<a href="#l4.4"></a><span id="l4.4"> {</span>
<a href="#l4.5"></a><span id="l4.5">   // look up the value of profile.force.migration in case we are supposed to force migration using a particular</span>
<a href="#l4.6"></a><span id="l4.6">   // migrator....</span>
<a href="#l4.7"></a><span id="l4.7">   nsresult rv = NS_OK;</span>
<a href="#l4.8"></a><span id="l4.8">   nsCOMPtr&lt;nsIPrefBranch&gt; prefs(do_GetService(NS_PREFSERVICE_CONTRACTID, &amp;rv));</span>
<a href="#l4.9"></a><span id="l4.9">   NS_ENSURE_SUCCESS(rv, rv);</span>
<a href="#l4.10"></a><span id="l4.10"> </span>
<a href="#l4.11"></a><span id="l4.11">   nsCString forceMigrationType;</span>
<a href="#l4.12"></a><span id="l4.12" class="difflineminus">-  prefs-&gt;GetCharPref(&quot;profile.force.migration&quot;, getter_Copies(forceMigrationType));</span>
<a href="#l4.13"></a><span id="l4.13" class="difflineplus">+  prefs-&gt;GetCharPref(&quot;profile.force.migration&quot;, forceMigrationType);</span>
<a href="#l4.14"></a><span id="l4.14"> </span>
<a href="#l4.15"></a><span id="l4.15">   // if we are being forced to migrate to a particular migration type, then create an instance of that migrator</span>
<a href="#l4.16"></a><span id="l4.16">   // and return it.</span>
<a href="#l4.17"></a><span id="l4.17">   NS_NAMED_LITERAL_CSTRING(migratorPrefix,</span>
<a href="#l4.18"></a><span id="l4.18">                            NS_MAILPROFILEMIGRATOR_CONTRACTID_PREFIX);</span>
<a href="#l4.19"></a><span id="l4.19">   nsAutoCString migratorID;</span>
<a href="#l4.20"></a><span id="l4.20">   if (!forceMigrationType.IsEmpty())</span>
<a href="#l4.21"></a><span id="l4.21">   {</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l5.1"></a><span id="l5.1" class="difflineminus">--- a/mail/components/migration/src/nsSeamonkeyProfileMigrator.cpp</span>
<a href="#l5.2"></a><span id="l5.2" class="difflineplus">+++ b/mail/components/migration/src/nsSeamonkeyProfileMigrator.cpp</span>
<a href="#l5.3"></a><span id="l5.3" class="difflineat">@@ -133,17 +133,17 @@ nsSeamonkeyProfileMigrator::GetMigrateDa</span>
<a href="#l5.4"></a><span id="l5.4">                           };</span>
<a href="#l5.5"></a><span id="l5.5"> </span>
<a href="#l5.6"></a><span id="l5.6">   // Frees file name strings allocated above.</span>
<a href="#l5.7"></a><span id="l5.7">   GetMigrateDataFromArray(data, sizeof(data)/sizeof(MigrationData),</span>
<a href="#l5.8"></a><span id="l5.8">                           aReplace, mSourceProfile, aResult);</span>
<a href="#l5.9"></a><span id="l5.9"> </span>
<a href="#l5.10"></a><span id="l5.10">   // Now locate passwords</span>
<a href="#l5.11"></a><span id="l5.11">   nsCString signonsFileName;</span>
<a href="#l5.12"></a><span id="l5.12" class="difflineminus">-  GetSignonFileName(aReplace, getter_Copies(signonsFileName));</span>
<a href="#l5.13"></a><span id="l5.13" class="difflineplus">+  GetSignonFileName(aReplace, signonsFileName);</span>
<a href="#l5.14"></a><span id="l5.14"> </span>
<a href="#l5.15"></a><span id="l5.15">   if (!signonsFileName.IsEmpty()) {</span>
<a href="#l5.16"></a><span id="l5.16">     nsAutoString fileName;</span>
<a href="#l5.17"></a><span id="l5.17">     CopyASCIItoUTF16(signonsFileName, fileName);</span>
<a href="#l5.18"></a><span id="l5.18">     nsCOMPtr&lt;nsIFile&gt; sourcePasswordsFile;</span>
<a href="#l5.19"></a><span id="l5.19">     mSourceProfile-&gt;Clone(getter_AddRefs(sourcePasswordsFile));</span>
<a href="#l5.20"></a><span id="l5.20">     sourcePasswordsFile-&gt;Append(fileName);</span>
<a href="#l5.21"></a><span id="l5.21"> </span>
<a href="#l5.22"></a><span id="l5.22" class="difflineat">@@ -496,17 +496,17 @@ nsSeamonkeyProfileMigrator::CopyMailFold</span>
<a href="#l5.23"></a><span id="l5.23"> </span>
<a href="#l5.24"></a><span id="l5.24">       nsCOMPtr&lt;nsIPrefBranch&gt; serverBranch;</span>
<a href="#l5.25"></a><span id="l5.25">       aPrefService-&gt;GetBranch(prefName.get(), getter_AddRefs(serverBranch));</span>
<a href="#l5.26"></a><span id="l5.26"> </span>
<a href="#l5.27"></a><span id="l5.27">       if (!serverBranch)</span>
<a href="#l5.28"></a><span id="l5.28">         break; // should we clear out this server pref from aMailServers?</span>
<a href="#l5.29"></a><span id="l5.29"> </span>
<a href="#l5.30"></a><span id="l5.30">       nsCString serverType;</span>
<a href="#l5.31"></a><span id="l5.31" class="difflineminus">-      serverBranch-&gt;GetCharPref(&quot;type&quot;, getter_Copies(serverType));</span>
<a href="#l5.32"></a><span id="l5.32" class="difflineplus">+      serverBranch-&gt;GetCharPref(&quot;type&quot;, serverType);</span>
<a href="#l5.33"></a><span id="l5.33"> </span>
<a href="#l5.34"></a><span id="l5.34">       nsCOMPtr&lt;nsIFile&gt; sourceMailFolder;</span>
<a href="#l5.35"></a><span id="l5.35">       serverBranch-&gt;GetComplexValue(&quot;directory&quot;, NS_GET_IID(nsIFile), getter_AddRefs(sourceMailFolder));</span>
<a href="#l5.36"></a><span id="l5.36"> </span>
<a href="#l5.37"></a><span id="l5.37">       // now based on type, we need to build a new destination path for the mail folders for this server</span>
<a href="#l5.38"></a><span id="l5.38">       nsCOMPtr&lt;nsIFile&gt; targetMailFolder;</span>
<a href="#l5.39"></a><span id="l5.39">       if (serverType.Equals(&quot;imap&quot;))</span>
<a href="#l5.40"></a><span id="l5.40">       {</span>
<a href="#l5.41"></a><span id="l5.41" class="difflineat">@@ -524,17 +524,17 @@ nsSeamonkeyProfileMigrator::CopyMailFold</span>
<a href="#l5.42"></a><span id="l5.42">         mTargetProfile-&gt;Clone(getter_AddRefs(targetMailFolder));</span>
<a href="#l5.43"></a><span id="l5.43">         targetMailFolder-&gt;Append(NEWS_DIR_50_NAME);</span>
<a href="#l5.44"></a><span id="l5.44">       }</span>
<a href="#l5.45"></a><span id="l5.45"> </span>
<a href="#l5.46"></a><span id="l5.46">       if (targetMailFolder)</span>
<a href="#l5.47"></a><span id="l5.47">       {</span>
<a href="#l5.48"></a><span id="l5.48">         // for all of our server types, append the host name to the directory as part of the new location</span>
<a href="#l5.49"></a><span id="l5.49">         nsCString hostName;</span>
<a href="#l5.50"></a><span id="l5.50" class="difflineminus">-        serverBranch-&gt;GetCharPref(&quot;hostname&quot;, getter_Copies(hostName));</span>
<a href="#l5.51"></a><span id="l5.51" class="difflineplus">+        serverBranch-&gt;GetCharPref(&quot;hostname&quot;, hostName);</span>
<a href="#l5.52"></a><span id="l5.52">         targetMailFolder-&gt;Append(NS_ConvertASCIItoUTF16(hostName));</span>
<a href="#l5.53"></a><span id="l5.53"> </span>
<a href="#l5.54"></a><span id="l5.54">         // we should make sure the host name based directory we are going to migrate</span>
<a href="#l5.55"></a><span id="l5.55">         // the accounts into is unique. This protects against the case where the user</span>
<a href="#l5.56"></a><span id="l5.56">         // has multiple servers with the same host name.</span>
<a href="#l5.57"></a><span id="l5.57">         rv = targetMailFolder-&gt;CreateUnique(nsIFile::DIRECTORY_TYPE, 0777);</span>
<a href="#l5.58"></a><span id="l5.58">         NS_ENSURE_SUCCESS(rv, rv);</span>
<a href="#l5.59"></a><span id="l5.59"> </span>
<a href="#l5.60"></a><span id="l5.60" class="difflineat">@@ -651,19 +651,22 @@ nsSeamonkeyProfileMigrator::ReadBranch(c</span>
<a href="#l5.61"></a><span id="l5.61">     // Save each pref's value into an array</span>
<a href="#l5.62"></a><span id="l5.62">     char* currPref = prefs[i];</span>
<a href="#l5.63"></a><span id="l5.63">     int32_t type;</span>
<a href="#l5.64"></a><span id="l5.64">     branch-&gt;GetPrefType(currPref, &amp;type);</span>
<a href="#l5.65"></a><span id="l5.65">     PrefBranchStruct* pref = new PrefBranchStruct;</span>
<a href="#l5.66"></a><span id="l5.66">     pref-&gt;prefName = currPref;</span>
<a href="#l5.67"></a><span id="l5.67">     pref-&gt;type = type;</span>
<a href="#l5.68"></a><span id="l5.68">     switch (type) {</span>
<a href="#l5.69"></a><span id="l5.69" class="difflineminus">-    case nsIPrefBranch::PREF_STRING:</span>
<a href="#l5.70"></a><span id="l5.70" class="difflineminus">-      rv = branch-&gt;GetCharPref(currPref, &amp;pref-&gt;stringValue);</span>
<a href="#l5.71"></a><span id="l5.71" class="difflineplus">+    case nsIPrefBranch::PREF_STRING: {</span>
<a href="#l5.72"></a><span id="l5.72" class="difflineplus">+      nsCString str;</span>
<a href="#l5.73"></a><span id="l5.73" class="difflineplus">+      rv = branch-&gt;GetCharPref(currPref, str);</span>
<a href="#l5.74"></a><span id="l5.74" class="difflineplus">+      pref-&gt;stringValue = moz_xstrdup(str.get());</span>
<a href="#l5.75"></a><span id="l5.75">       break;</span>
<a href="#l5.76"></a><span id="l5.76" class="difflineplus">+    }</span>
<a href="#l5.77"></a><span id="l5.77">     case nsIPrefBranch::PREF_BOOL:</span>
<a href="#l5.78"></a><span id="l5.78">       rv = branch-&gt;GetBoolPref(currPref, &amp;pref-&gt;boolValue);</span>
<a href="#l5.79"></a><span id="l5.79">       break;</span>
<a href="#l5.80"></a><span id="l5.80">     case nsIPrefBranch::PREF_INT:</span>
<a href="#l5.81"></a><span id="l5.81">       rv = branch-&gt;GetIntPref(currPref, &amp;pref-&gt;intValue);</span>
<a href="#l5.82"></a><span id="l5.82">       break;</span>
<a href="#l5.83"></a><span id="l5.83">     default:</span>
<a href="#l5.84"></a><span id="l5.84">       NS_WARNING(&quot;Invalid Pref Type in &quot;</span>
<a href="#l5.85"></a><span id="l5.85" class="difflineat">@@ -685,17 +688,18 @@ nsSeamonkeyProfileMigrator::WriteBranch(</span>
<a href="#l5.86"></a><span id="l5.86">   nsCOMPtr&lt;nsIPrefBranch&gt; branch;</span>
<a href="#l5.87"></a><span id="l5.87">   aPrefService-&gt;GetBranch(branchName, getter_AddRefs(branch));</span>
<a href="#l5.88"></a><span id="l5.88"> </span>
<a href="#l5.89"></a><span id="l5.89">   uint32_t count = aPrefs.Length();</span>
<a href="#l5.90"></a><span id="l5.90">   for (uint32_t i = 0; i &lt; count; ++i) {</span>
<a href="#l5.91"></a><span id="l5.91">     PrefBranchStruct* pref = aPrefs.ElementAt(i);</span>
<a href="#l5.92"></a><span id="l5.92">     switch (pref-&gt;type) {</span>
<a href="#l5.93"></a><span id="l5.93">     case nsIPrefBranch::PREF_STRING:</span>
<a href="#l5.94"></a><span id="l5.94" class="difflineminus">-      (void) branch-&gt;SetCharPref(pref-&gt;prefName, pref-&gt;stringValue);</span>
<a href="#l5.95"></a><span id="l5.95" class="difflineplus">+      (void) branch-&gt;SetCharPref(pref-&gt;prefName,</span>
<a href="#l5.96"></a><span id="l5.96" class="difflineplus">+                                 nsDependentCString(pref-&gt;stringValue));</span>
<a href="#l5.97"></a><span id="l5.97">       free(pref-&gt;stringValue);</span>
<a href="#l5.98"></a><span id="l5.98">       pref-&gt;stringValue = nullptr;</span>
<a href="#l5.99"></a><span id="l5.99">       break;</span>
<a href="#l5.100"></a><span id="l5.100">     case nsIPrefBranch::PREF_BOOL:</span>
<a href="#l5.101"></a><span id="l5.101">       (void) branch-&gt;SetBoolPref(pref-&gt;prefName, pref-&gt;boolValue);</span>
<a href="#l5.102"></a><span id="l5.102">       break;</span>
<a href="#l5.103"></a><span id="l5.103">     case nsIPrefBranch::PREF_INT:</span>
<a href="#l5.104"></a><span id="l5.104">       (void) branch-&gt;SetIntPref(pref-&gt;prefName, pref-&gt;intValue);</span>
<a href="#l5.105"></a><span id="l5.105" class="difflineat">@@ -726,17 +730,17 @@ nsSeamonkeyProfileMigrator::CopyJunkTrai</span>
<a href="#l5.106"></a><span id="l5.106"> }</span>
<a href="#l5.107"></a><span id="l5.107"> </span>
<a href="#l5.108"></a><span id="l5.108"> nsresult</span>
<a href="#l5.109"></a><span id="l5.109"> nsSeamonkeyProfileMigrator::CopyPasswords(bool aReplace)</span>
<a href="#l5.110"></a><span id="l5.110"> {</span>
<a href="#l5.111"></a><span id="l5.111">   nsresult rv = NS_OK;</span>
<a href="#l5.112"></a><span id="l5.112"> </span>
<a href="#l5.113"></a><span id="l5.113">   nsCString signonsFileName;</span>
<a href="#l5.114"></a><span id="l5.114" class="difflineminus">-  GetSignonFileName(aReplace, getter_Copies(signonsFileName));</span>
<a href="#l5.115"></a><span id="l5.115" class="difflineplus">+  GetSignonFileName(aReplace, signonsFileName);</span>
<a href="#l5.116"></a><span id="l5.116"> </span>
<a href="#l5.117"></a><span id="l5.117">   if (signonsFileName.IsEmpty())</span>
<a href="#l5.118"></a><span id="l5.118">     return NS_ERROR_FILE_NOT_FOUND;</span>
<a href="#l5.119"></a><span id="l5.119"> </span>
<a href="#l5.120"></a><span id="l5.120">   nsAutoString fileName;</span>
<a href="#l5.121"></a><span id="l5.121">   CopyASCIItoUTF16(signonsFileName, fileName);</span>
<a href="#l5.122"></a><span id="l5.122">   if (aReplace)</span>
<a href="#l5.123"></a><span id="l5.123">     rv = CopyFile(fileName, fileName);</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l6.1"></a><span id="l6.1" class="difflineminus">--- a/mail/components/shell/DirectoryProvider.cpp</span>
<a href="#l6.2"></a><span id="l6.2" class="difflineplus">+++ b/mail/components/shell/DirectoryProvider.cpp</span>
<a href="#l6.3"></a><span id="l6.3" class="difflineat">@@ -115,17 +115,17 @@ AppendDistroSearchDirs(nsIProperties* aD</span>
<a href="#l6.4"></a><span id="l6.4">     if (NS_SUCCEEDED(rv))</span>
<a href="#l6.5"></a><span id="l6.5">     {</span>
<a href="#l6.6"></a><span id="l6.6">       nsAutoString wLocale;</span>
<a href="#l6.7"></a><span id="l6.7">       prefString-&gt;GetData(wLocale);</span>
<a href="#l6.8"></a><span id="l6.8">       CopyUTF16toUTF8(wLocale, locale);</span>
<a href="#l6.9"></a><span id="l6.9">     }</span>
<a href="#l6.10"></a><span id="l6.10">     else</span>
<a href="#l6.11"></a><span id="l6.11">     {</span>
<a href="#l6.12"></a><span id="l6.12" class="difflineminus">-      rv = prefs-&gt;GetCharPref(&quot;general.useragent.locale&quot;, getter_Copies(locale));</span>
<a href="#l6.13"></a><span id="l6.13" class="difflineplus">+      rv = prefs-&gt;GetCharPref(&quot;general.useragent.locale&quot;, locale);</span>
<a href="#l6.14"></a><span id="l6.14">     }</span>
<a href="#l6.15"></a><span id="l6.15"> </span>
<a href="#l6.16"></a><span id="l6.16">     if (NS_SUCCEEDED(rv))</span>
<a href="#l6.17"></a><span id="l6.17">     {</span>
<a href="#l6.18"></a><span id="l6.18">       nsCOMPtr&lt;nsIFile&gt; curLocalePlugins;</span>
<a href="#l6.19"></a><span id="l6.19">       rv = localePlugins-&gt;Clone(getter_AddRefs(curLocalePlugins));</span>
<a href="#l6.20"></a><span id="l6.20">       if (NS_SUCCEEDED(rv))</span>
<a href="#l6.21"></a><span id="l6.21">       {</span>
<a href="#l6.22"></a><span id="l6.22" class="difflineat">@@ -137,17 +137,17 @@ AppendDistroSearchDirs(nsIProperties* aD</span>
<a href="#l6.23"></a><span id="l6.23">           return; // all done</span>
<a href="#l6.24"></a><span id="l6.24">         }</span>
<a href="#l6.25"></a><span id="l6.25">       }</span>
<a href="#l6.26"></a><span id="l6.26">     }</span>
<a href="#l6.27"></a><span id="l6.27"> </span>
<a href="#l6.28"></a><span id="l6.28">     // we didn't append the locale dir - try the default one</span>
<a href="#l6.29"></a><span id="l6.29">     nsCString defLocale;</span>
<a href="#l6.30"></a><span id="l6.30">     rv = prefs-&gt;GetCharPref(&quot;distribution.searchplugins.defaultLocale&quot;,</span>
<a href="#l6.31"></a><span id="l6.31" class="difflineminus">-                            getter_Copies(defLocale));</span>
<a href="#l6.32"></a><span id="l6.32" class="difflineplus">+                            defLocale);</span>
<a href="#l6.33"></a><span id="l6.33">     if (NS_SUCCEEDED(rv))</span>
<a href="#l6.34"></a><span id="l6.34">     {</span>
<a href="#l6.35"></a><span id="l6.35">       nsCOMPtr&lt;nsIFile&gt; defLocalePlugins;</span>
<a href="#l6.36"></a><span id="l6.36">       rv = localePlugins-&gt;Clone(getter_AddRefs(defLocalePlugins));</span>
<a href="#l6.37"></a><span id="l6.37">       if (NS_SUCCEEDED(rv))</span>
<a href="#l6.38"></a><span id="l6.38">       {</span>
<a href="#l6.39"></a><span id="l6.39">         defLocalePlugins-&gt;AppendNative(defLocale);</span>
<a href="#l6.40"></a><span id="l6.40">         rv = defLocalePlugins-&gt;Exists(&amp;exists);</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l7.1"></a><span id="l7.1" class="difflineminus">--- a/mailnews/addrbook/src/nsAbAddressCollector.cpp</span>
<a href="#l7.2"></a><span id="l7.2" class="difflineplus">+++ b/mailnews/addrbook/src/nsAbAddressCollector.cpp</span>
<a href="#l7.3"></a><span id="l7.3" class="difflineat">@@ -292,18 +292,17 @@ nsAbAddressCollector::Init(void)</span>
<a href="#l7.4"></a><span id="l7.4"> }</span>
<a href="#l7.5"></a><span id="l7.5"> </span>
<a href="#l7.6"></a><span id="l7.6"> // Performs the necessary changes to set up the collector for the specified</span>
<a href="#l7.7"></a><span id="l7.7"> // collected address book.</span>
<a href="#l7.8"></a><span id="l7.8"> void</span>
<a href="#l7.9"></a><span id="l7.9"> nsAbAddressCollector::SetUpAbFromPrefs(nsIPrefBranch *aPrefBranch)</span>
<a href="#l7.10"></a><span id="l7.10"> {</span>
<a href="#l7.11"></a><span id="l7.11">   nsCString abURI;</span>
<a href="#l7.12"></a><span id="l7.12" class="difflineminus">-  aPrefBranch-&gt;GetCharPref(PREF_MAIL_COLLECT_ADDRESSBOOK,</span>
<a href="#l7.13"></a><span id="l7.13" class="difflineminus">-                           getter_Copies(abURI));</span>
<a href="#l7.14"></a><span id="l7.14" class="difflineplus">+  aPrefBranch-&gt;GetCharPref(PREF_MAIL_COLLECT_ADDRESSBOOK, abURI);</span>
<a href="#l7.15"></a><span id="l7.15"> </span>
<a href="#l7.16"></a><span id="l7.16">   if (abURI.IsEmpty())</span>
<a href="#l7.17"></a><span id="l7.17">     abURI.AssignLiteral(kPersonalAddressbookUri);</span>
<a href="#l7.18"></a><span id="l7.18"> </span>
<a href="#l7.19"></a><span id="l7.19">   if (abURI == mABURI)</span>
<a href="#l7.20"></a><span id="l7.20">     return;</span>
<a href="#l7.21"></a><span id="l7.21"> </span>
<a href="#l7.22"></a><span id="l7.22">   mDirectory = nullptr;</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l8.1"></a><span id="l8.1" class="difflineminus">--- a/mailnews/addrbook/src/nsAbDirProperty.cpp</span>
<a href="#l8.2"></a><span id="l8.2" class="difflineplus">+++ b/mailnews/addrbook/src/nsAbDirProperty.cpp</span>
<a href="#l8.3"></a><span id="l8.3" class="difflineat">@@ -498,17 +498,17 @@ NS_IMETHODIMP nsAbDirProperty::GetString</span>
<a href="#l8.4"></a><span id="l8.4">                                               nsACString &amp;aResult)</span>
<a href="#l8.5"></a><span id="l8.5"> {</span>
<a href="#l8.6"></a><span id="l8.6">   if (!m_DirectoryPrefs &amp;&amp; NS_FAILED(InitDirectoryPrefs()))</span>
<a href="#l8.7"></a><span id="l8.7">     return NS_ERROR_NOT_INITIALIZED;</span>
<a href="#l8.8"></a><span id="l8.8"> </span>
<a href="#l8.9"></a><span id="l8.9">   nsCString value;</span>
<a href="#l8.10"></a><span id="l8.10"> </span>
<a href="#l8.11"></a><span id="l8.11">     /* unfortunately, there may be some prefs out there which look like (null) */</span>
<a href="#l8.12"></a><span id="l8.12" class="difflineminus">-  if (NS_SUCCEEDED(m_DirectoryPrefs-&gt;GetCharPref(aName, getter_Copies(value))) &amp;&amp;</span>
<a href="#l8.13"></a><span id="l8.13" class="difflineplus">+  if (NS_SUCCEEDED(m_DirectoryPrefs-&gt;GetCharPref(aName, value)) &amp;&amp;</span>
<a href="#l8.14"></a><span id="l8.14">       !value.EqualsLiteral(&quot;(null&quot;))</span>
<a href="#l8.15"></a><span id="l8.15">     aResult = value;</span>
<a href="#l8.16"></a><span id="l8.16">   else</span>
<a href="#l8.17"></a><span id="l8.17">     aResult = aDefaultValue;</span>
<a href="#l8.18"></a><span id="l8.18"> </span>
<a href="#l8.19"></a><span id="l8.19">   return NS_OK;</span>
<a href="#l8.20"></a><span id="l8.20"> }</span>
<a href="#l8.21"></a><span id="l8.21"> /*</span>
<a href="#l8.22"></a><span id="l8.22" class="difflineat">@@ -564,17 +564,17 @@ NS_IMETHODIMP nsAbDirProperty::SetBoolVa</span>
<a href="#l8.23"></a><span id="l8.23"> }</span>
<a href="#l8.24"></a><span id="l8.24"> </span>
<a href="#l8.25"></a><span id="l8.25"> NS_IMETHODIMP nsAbDirProperty::SetStringValue(const char *aName,</span>
<a href="#l8.26"></a><span id="l8.26">                                               const nsACString &amp;aValue)</span>
<a href="#l8.27"></a><span id="l8.27"> {</span>
<a href="#l8.28"></a><span id="l8.28">   if (!m_DirectoryPrefs &amp;&amp; NS_FAILED(InitDirectoryPrefs()))</span>
<a href="#l8.29"></a><span id="l8.29">     return NS_ERROR_NOT_INITIALIZED;</span>
<a href="#l8.30"></a><span id="l8.30"> </span>
<a href="#l8.31"></a><span id="l8.31" class="difflineminus">-  return m_DirectoryPrefs-&gt;SetCharPref(aName, nsCString(aValue).get());</span>
<a href="#l8.32"></a><span id="l8.32" class="difflineplus">+  return m_DirectoryPrefs-&gt;SetCharPref(aName, aValue);</span>
<a href="#l8.33"></a><span id="l8.33"> }</span>
<a href="#l8.34"></a><span id="l8.34"> </span>
<a href="#l8.35"></a><span id="l8.35"> NS_IMETHODIMP nsAbDirProperty::SetLocalizedStringValue(const char *aName,</span>
<a href="#l8.36"></a><span id="l8.36">                                                        const nsACString &amp;aValue)</span>
<a href="#l8.37"></a><span id="l8.37"> {</span>
<a href="#l8.38"></a><span id="l8.38">   if (!m_DirectoryPrefs &amp;&amp; NS_FAILED(InitDirectoryPrefs()))</span>
<a href="#l8.39"></a><span id="l8.39">     return NS_ERROR_NOT_INITIALIZED;</span>
<a href="#l8.40"></a><span id="l8.40"> </span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l9.1"></a><span id="l9.1" class="difflineminus">--- a/mailnews/addrbook/src/nsAbLDAPDirectory.cpp</span>
<a href="#l9.2"></a><span id="l9.2" class="difflineplus">+++ b/mailnews/addrbook/src/nsAbLDAPDirectory.cpp</span>
<a href="#l9.3"></a><span id="l9.3" class="difflineat">@@ -507,17 +507,17 @@ NS_IMETHODIMP nsAbLDAPDirectory::UseForA</span>
<a href="#l9.4"></a><span id="l9.4">       return NS_OK;</span>
<a href="#l9.5"></a><span id="l9.5">   }</span>
<a href="#l9.6"></a><span id="l9.6"> </span>
<a href="#l9.7"></a><span id="l9.7">   // If we failed to get the identity preference, or the pref name is empty</span>
<a href="#l9.8"></a><span id="l9.8">   // try the global preference.</span>
<a href="#l9.9"></a><span id="l9.9">   if (prefName.IsEmpty())</span>
<a href="#l9.10"></a><span id="l9.10">   {</span>
<a href="#l9.11"></a><span id="l9.11">     nsresult rv = prefs-&gt;GetCharPref(&quot;ldap_2.autoComplete.directoryServer&quot;,</span>
<a href="#l9.12"></a><span id="l9.12" class="difflineminus">-                                     getter_Copies(prefName));</span>
<a href="#l9.13"></a><span id="l9.13" class="difflineplus">+                                     prefName);</span>
<a href="#l9.14"></a><span id="l9.14">     NS_ENSURE_SUCCESS(rv,rv);</span>
<a href="#l9.15"></a><span id="l9.15">   }</span>
<a href="#l9.16"></a><span id="l9.16"> </span>
<a href="#l9.17"></a><span id="l9.17">   // Now see if the pref name matches our pref id.</span>
<a href="#l9.18"></a><span id="l9.18">   if (prefName.Equals(m_DirPrefId))</span>
<a href="#l9.19"></a><span id="l9.19">   {</span>
<a href="#l9.20"></a><span id="l9.20">     // Yes it does, one last check - does the replication file exist?</span>
<a href="#l9.21"></a><span id="l9.21">     nsresult rv;</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l10.1"></a><span id="l10.1" class="difflineminus">--- a/mailnews/addrbook/src/nsAbMDBDirectory.cpp</span>
<a href="#l10.2"></a><span id="l10.2" class="difflineplus">+++ b/mailnews/addrbook/src/nsAbMDBDirectory.cpp</span>
<a href="#l10.3"></a><span id="l10.3" class="difflineat">@@ -97,18 +97,17 @@ NS_IMETHODIMP nsAbMDBDirectory::Init(con</span>
<a href="#l10.4"></a><span id="l10.4">     NS_ENSURE_SUCCESS(rv, rv);</span>
<a href="#l10.5"></a><span id="l10.5"> </span>
<a href="#l10.6"></a><span id="l10.6">     for (i = 0; i &lt; childCount; ++i)</span>
<a href="#l10.7"></a><span id="l10.7">     {</span>
<a href="#l10.8"></a><span id="l10.8">       child.Assign(childArray[i]);</span>
<a href="#l10.9"></a><span id="l10.9"> </span>
<a href="#l10.10"></a><span id="l10.10">       if (StringEndsWith(child, NS_LITERAL_CSTRING(&quot;.filename&quot;)))</span>
<a href="#l10.11"></a><span id="l10.11">       {</span>
<a href="#l10.12"></a><span id="l10.12" class="difflineminus">-        if (NS_SUCCEEDED(prefBranch-&gt;GetCharPref(child.get(),</span>
<a href="#l10.13"></a><span id="l10.13" class="difflineminus">-                                                 getter_Copies(childValue))))</span>
<a href="#l10.14"></a><span id="l10.14" class="difflineplus">+        if (NS_SUCCEEDED(prefBranch-&gt;GetCharPref(child.get(), childValue)))</span>
<a href="#l10.15"></a><span id="l10.15">         {</span>
<a href="#l10.16"></a><span id="l10.16">           if (childValue == filename)</span>
<a href="#l10.17"></a><span id="l10.17">           {</span>
<a href="#l10.18"></a><span id="l10.18">             dotOffset = child.RFindChar('.');</span>
<a href="#l10.19"></a><span id="l10.19">             if (dotOffset != -1)</span>
<a href="#l10.20"></a><span id="l10.20">             {</span>
<a href="#l10.21"></a><span id="l10.21">               nsAutoCString prefName(StringHead(child, dotOffset));</span>
<a href="#l10.22"></a><span id="l10.22">               m_DirPrefId.AssignLiteral(PREF_LDAP_SERVER_TREE_NAME &quot;.&quot;);</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l11.1"></a><span id="l11.1" class="difflineminus">--- a/mailnews/addrbook/src/nsDirPrefs.cpp</span>
<a href="#l11.2"></a><span id="l11.2" class="difflineplus">+++ b/mailnews/addrbook/src/nsDirPrefs.cpp</span>
<a href="#l11.3"></a><span id="l11.3" class="difflineat">@@ -770,30 +770,30 @@ static char *DIR_GetStringPref(const cha</span>
<a href="#l11.4"></a><span id="l11.4">         return nullptr;</span>
<a href="#l11.5"></a><span id="l11.5"> </span>
<a href="#l11.6"></a><span id="l11.6">     nsCString value;</span>
<a href="#l11.7"></a><span id="l11.7">     nsAutoCString prefLocation(prefRoot);</span>
<a href="#l11.8"></a><span id="l11.8"> </span>
<a href="#l11.9"></a><span id="l11.9">     prefLocation.Append('.');</span>
<a href="#l11.10"></a><span id="l11.10">     prefLocation.Append(prefLeaf);</span>
<a href="#l11.11"></a><span id="l11.11"> </span>
<a href="#l11.12"></a><span id="l11.12" class="difflineminus">-    if (NS_SUCCEEDED(pPref-&gt;GetCharPref(prefLocation.get(), getter_Copies(value))))</span>
<a href="#l11.13"></a><span id="l11.13" class="difflineplus">+    if (NS_SUCCEEDED(pPref-&gt;GetCharPref(prefLocation.get(), value)))</span>
<a href="#l11.14"></a><span id="l11.14">     {</span>
<a href="#l11.15"></a><span id="l11.15">         /* unfortunately, there may be some prefs out there which look like this */</span>
<a href="#l11.16"></a><span id="l11.16">         if (value.EqualsLiteral(&quot;(null)&quot;))</span>
<a href="#l11.17"></a><span id="l11.17">         {</span>
<a href="#l11.18"></a><span id="l11.18">             if (defaultValue)</span>
<a href="#l11.19"></a><span id="l11.19">                 value = defaultValue;</span>
<a href="#l11.20"></a><span id="l11.20">             else</span>
<a href="#l11.21"></a><span id="l11.21">                 value.Truncate();</span>
<a href="#l11.22"></a><span id="l11.22">         }</span>
<a href="#l11.23"></a><span id="l11.23"> </span>
<a href="#l11.24"></a><span id="l11.24">         if (value.IsEmpty())</span>
<a href="#l11.25"></a><span id="l11.25">         {</span>
<a href="#l11.26"></a><span id="l11.26" class="difflineminus">-          rv = pPref-&gt;GetCharPref(prefLocation.get(), getter_Copies(value));</span>
<a href="#l11.27"></a><span id="l11.27" class="difflineplus">+          rv = pPref-&gt;GetCharPref(prefLocation.get(), value);</span>
<a href="#l11.28"></a><span id="l11.28">         }</span>
<a href="#l11.29"></a><span id="l11.29">     }</span>
<a href="#l11.30"></a><span id="l11.30">     else</span>
<a href="#l11.31"></a><span id="l11.31">         value = defaultValue;</span>
<a href="#l11.32"></a><span id="l11.32"> </span>
<a href="#l11.33"></a><span id="l11.33">     return ToNewCString(value);</span>
<a href="#l11.34"></a><span id="l11.34"> }</span>
<a href="#l11.35"></a><span id="l11.35"> </span>
<a href="#l11.36"></a><span id="l11.36" class="difflineat">@@ -820,41 +820,41 @@ static char *DIR_GetLocalizedStringPref(</span>
<a href="#l11.37"></a><span id="l11.37"> </span>
<a href="#l11.38"></a><span id="l11.38">   nsString wvalue;</span>
<a href="#l11.39"></a><span id="l11.39">   nsCOMPtr&lt;nsIPrefLocalizedString&gt; locStr;</span>
<a href="#l11.40"></a><span id="l11.40"> </span>
<a href="#l11.41"></a><span id="l11.41">   rv = pPref-&gt;GetComplexValue(prefLocation.get(), NS_GET_IID(nsIPrefLocalizedString), getter_AddRefs(locStr));</span>
<a href="#l11.42"></a><span id="l11.42">   if (NS_SUCCEEDED(rv))</span>
<a href="#l11.43"></a><span id="l11.43">     rv = locStr-&gt;ToString(getter_Copies(wvalue));</span>
<a href="#l11.44"></a><span id="l11.44"> </span>
<a href="#l11.45"></a><span id="l11.45" class="difflineminus">-  char *value = nullptr;</span>
<a href="#l11.46"></a><span id="l11.46" class="difflineplus">+  nsCString value;</span>
<a href="#l11.47"></a><span id="l11.47">   if (!wvalue.IsEmpty())</span>
<a href="#l11.48"></a><span id="l11.48">   {</span>
<a href="#l11.49"></a><span id="l11.49" class="difflineminus">-    value = ToNewCString(NS_ConvertUTF16toUTF8(wvalue));</span>
<a href="#l11.50"></a><span id="l11.50" class="difflineplus">+    value = NS_ConvertUTF16toUTF8(wvalue);</span>
<a href="#l11.51"></a><span id="l11.51">   }</span>
<a href="#l11.52"></a><span id="l11.52">   else</span>
<a href="#l11.53"></a><span id="l11.53">   {</span>
<a href="#l11.54"></a><span id="l11.54">     // In TB 2 only some prefs had chrome:// URIs. We had code in place that would</span>
<a href="#l11.55"></a><span id="l11.55">     // only get the localized string pref for the particular address books that</span>
<a href="#l11.56"></a><span id="l11.56">     // were built-in.</span>
<a href="#l11.57"></a><span id="l11.57">     // Additionally, nsIPrefBranch::getComplexValue will only get a non-user-set,</span>
<a href="#l11.58"></a><span id="l11.58">     // non-locked pref value if it is a chrome:// URI and will get the string</span>
<a href="#l11.59"></a><span id="l11.59">     // value at that chrome URI. This breaks extensions/autoconfig that want to</span>
<a href="#l11.60"></a><span id="l11.60">     // set default pref values and allow users to change directory names.</span>
<a href="#l11.61"></a><span id="l11.61">     //</span>
<a href="#l11.62"></a><span id="l11.62">     // Now we have to support this, and so if for whatever reason we fail to get</span>
<a href="#l11.63"></a><span id="l11.63">     // the localized version, then we try and get the non-localized version</span>
<a href="#l11.64"></a><span id="l11.64">     // instead. If the string value is empty, then we'll just get the empty value</span>
<a href="#l11.65"></a><span id="l11.65">     // back here.</span>
<a href="#l11.66"></a><span id="l11.66" class="difflineminus">-    rv = pPref-&gt;GetCharPref(prefLocation.get(), &amp;value);</span>
<a href="#l11.67"></a><span id="l11.67" class="difflineplus">+    rv = pPref-&gt;GetCharPref(prefLocation.get(), value);</span>
<a href="#l11.68"></a><span id="l11.68">     if (NS_FAILED(rv))</span>
<a href="#l11.69"></a><span id="l11.69" class="difflineminus">-      value = nullptr;</span>
<a href="#l11.70"></a><span id="l11.70" class="difflineplus">+      value.Truncate();</span>
<a href="#l11.71"></a><span id="l11.71">   }</span>
<a href="#l11.72"></a><span id="l11.72"> </span>
<a href="#l11.73"></a><span id="l11.73" class="difflineminus">-  return value;</span>
<a href="#l11.74"></a><span id="l11.74" class="difflineplus">+  return moz_xstrdup(value.get());</span>
<a href="#l11.75"></a><span id="l11.75"> }</span>
<a href="#l11.76"></a><span id="l11.76"> </span>
<a href="#l11.77"></a><span id="l11.77"> static int32_t DIR_GetIntPref(const char *prefRoot, const char *prefLeaf, int32_t defaultValue)</span>
<a href="#l11.78"></a><span id="l11.78"> {</span>
<a href="#l11.79"></a><span id="l11.79">   nsresult rv;</span>
<a href="#l11.80"></a><span id="l11.80">   nsCOMPtr&lt;nsIPrefBranch&gt; pPref(do_GetService(NS_PREFSERVICE_CONTRACTID, &amp;rv));</span>
<a href="#l11.81"></a><span id="l11.81"> </span>
<a href="#l11.82"></a><span id="l11.82">   if (NS_FAILED(rv))</span>
<a href="#l11.83"></a><span id="l11.83" class="difflineat">@@ -1233,43 +1233,43 @@ static void DIR_SetStringPref(const char</span>
<a href="#l11.84"></a><span id="l11.84">     return;</span>
<a href="#l11.85"></a><span id="l11.85"> </span>
<a href="#l11.86"></a><span id="l11.86">   nsCString defaultPref;</span>
<a href="#l11.87"></a><span id="l11.87">   nsAutoCString prefLocation(prefRoot);</span>
<a href="#l11.88"></a><span id="l11.88"> </span>
<a href="#l11.89"></a><span id="l11.89">   prefLocation.Append('.');</span>
<a href="#l11.90"></a><span id="l11.90">   prefLocation.Append(prefLeaf);</span>
<a href="#l11.91"></a><span id="l11.91"> </span>
<a href="#l11.92"></a><span id="l11.92" class="difflineminus">-  if (NS_SUCCEEDED(pPref-&gt;GetCharPref(prefLocation.get(), getter_Copies(defaultPref))))</span>
<a href="#l11.93"></a><span id="l11.93" class="difflineplus">+  if (NS_SUCCEEDED(pPref-&gt;GetCharPref(prefLocation.get(), defaultPref)))</span>
<a href="#l11.94"></a><span id="l11.94">   {</span>
<a href="#l11.95"></a><span id="l11.95">     /* If there's a default pref, just set ours in and let libpref worry</span>
<a href="#l11.96"></a><span id="l11.96">      * about potential defaults in all.js</span>
<a href="#l11.97"></a><span id="l11.97">      */</span>
<a href="#l11.98"></a><span id="l11.98">     if (value) /* added this check to make sure we have a value before we try to set it..*/</span>
<a href="#l11.99"></a><span id="l11.99" class="difflineminus">-      rv = pPref-&gt;SetCharPref (prefLocation.get(), value);</span>
<a href="#l11.100"></a><span id="l11.100" class="difflineplus">+      rv = pPref-&gt;SetCharPref(prefLocation.get(), nsDependentCString(value));</span>
<a href="#l11.101"></a><span id="l11.101">     else</span>
<a href="#l11.102"></a><span id="l11.102">       rv = pPref-&gt;ClearUserPref(prefLocation.get());</span>
<a href="#l11.103"></a><span id="l11.103">   }</span>
<a href="#l11.104"></a><span id="l11.104">   else</span>
<a href="#l11.105"></a><span id="l11.105">   {</span>
<a href="#l11.106"></a><span id="l11.106">     /* If there's no default pref, look for a user pref, and only set our value in</span>
<a href="#l11.107"></a><span id="l11.107">      * if the user pref is different than one of them.</span>
<a href="#l11.108"></a><span id="l11.108">      */</span>
<a href="#l11.109"></a><span id="l11.109">     nsCString userPref;</span>
<a href="#l11.110"></a><span id="l11.110" class="difflineminus">-    if (NS_SUCCEEDED(pPref-&gt;GetCharPref (prefLocation.get(), getter_Copies(userPref))))</span>
<a href="#l11.111"></a><span id="l11.111" class="difflineplus">+    if (NS_SUCCEEDED(pPref-&gt;GetCharPref(prefLocation.get(), userPref)))</span>
<a href="#l11.112"></a><span id="l11.112">     {</span>
<a href="#l11.113"></a><span id="l11.113">       if (value &amp;&amp; (defaultValue ? PL_strcasecmp(value, defaultValue) : value != defaultValue))</span>
<a href="#l11.114"></a><span id="l11.114" class="difflineminus">-        rv = pPref-&gt;SetCharPref (prefLocation.get(), value);</span>
<a href="#l11.115"></a><span id="l11.115" class="difflineplus">+        rv = pPref-&gt;SetCharPref(prefLocation.get(), nsDependentCString(value));</span>
<a href="#l11.116"></a><span id="l11.116">       else</span>
<a href="#l11.117"></a><span id="l11.117">         rv = pPref-&gt;ClearUserPref(prefLocation.get());</span>
<a href="#l11.118"></a><span id="l11.118">     }</span>
<a href="#l11.119"></a><span id="l11.119">     else</span>
<a href="#l11.120"></a><span id="l11.120">     {</span>
<a href="#l11.121"></a><span id="l11.121">       if (value &amp;&amp; (defaultValue ? PL_strcasecmp(value, defaultValue) : value != defaultValue))</span>
<a href="#l11.122"></a><span id="l11.122" class="difflineminus">-        rv = pPref-&gt;SetCharPref (prefLocation.get(), value);</span>
<a href="#l11.123"></a><span id="l11.123" class="difflineplus">+        rv = pPref-&gt;SetCharPref(prefLocation.get(), nsDependentCString(value));</span>
<a href="#l11.124"></a><span id="l11.124">     }</span>
<a href="#l11.125"></a><span id="l11.125">   }</span>
<a href="#l11.126"></a><span id="l11.126"> </span>
<a href="#l11.127"></a><span id="l11.127">   NS_ASSERTION(NS_SUCCEEDED(rv), &quot;Could not set pref in DIR_SetStringPref&quot;);</span>
<a href="#l11.128"></a><span id="l11.128"> }</span>
<a href="#l11.129"></a><span id="l11.129"> </span>
<a href="#l11.130"></a><span id="l11.130"> static void DIR_SetLocalizedStringPref</span>
<a href="#l11.131"></a><span id="l11.131"> (const char *prefRoot, const char *prefLeaf, const char *value)</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l12.1"></a><span id="l12.1" class="difflineminus">--- a/mailnews/base/search/src/nsMsgSearchAdapter.cpp</span>
<a href="#l12.2"></a><span id="l12.2" class="difflineplus">+++ b/mailnews/base/search/src/nsMsgSearchAdapter.cpp</span>
<a href="#l12.3"></a><span id="l12.3" class="difflineat">@@ -958,17 +958,17 @@ NS_IMETHODIMP nsMsgSearchValidityManager</span>
<a href="#l12.4"></a><span id="l12.4">   NS_ENSURE_ARG_POINTER(ppOutTable);</span>
<a href="#l12.5"></a><span id="l12.5"> </span>
<a href="#l12.6"></a><span id="l12.6">   nsresult rv;</span>
<a href="#l12.7"></a><span id="l12.7">   *ppOutTable = nullptr;</span>
<a href="#l12.8"></a><span id="l12.8"> </span>
<a href="#l12.9"></a><span id="l12.9">   nsCOMPtr&lt;nsIPrefBranch&gt; pref(do_GetService(NS_PREFSERVICE_CONTRACTID, &amp;rv));</span>
<a href="#l12.10"></a><span id="l12.10">   nsCString customHeaders;</span>
<a href="#l12.11"></a><span id="l12.11">   if (NS_SUCCEEDED(rv))</span>
<a href="#l12.12"></a><span id="l12.12" class="difflineminus">-    pref-&gt;GetCharPref(PREF_CUSTOM_HEADERS, getter_Copies(customHeaders));</span>
<a href="#l12.13"></a><span id="l12.13" class="difflineplus">+    pref-&gt;GetCharPref(PREF_CUSTOM_HEADERS, customHeaders);</span>
<a href="#l12.14"></a><span id="l12.14"> </span>
<a href="#l12.15"></a><span id="l12.15">   switch (whichTable)</span>
<a href="#l12.16"></a><span id="l12.16">   {</span>
<a href="#l12.17"></a><span id="l12.17">   case nsMsgSearchScope::offlineMail:</span>
<a href="#l12.18"></a><span id="l12.18">     if (!m_offlineMailTable)</span>
<a href="#l12.19"></a><span id="l12.19">       rv = InitOfflineMailTable ();</span>
<a href="#l12.20"></a><span id="l12.20">     if (m_offlineMailTable)</span>
<a href="#l12.21"></a><span id="l12.21">       rv = SetOtherHeadersInTable(m_offlineMailTable, customHeaders.get());</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l13.1"></a><span id="l13.1" class="difflineminus">--- a/mailnews/base/search/src/nsMsgSearchTerm.cpp</span>
<a href="#l13.2"></a><span id="l13.2" class="difflineplus">+++ b/mailnews/base/search/src/nsMsgSearchTerm.cpp</span>
<a href="#l13.3"></a><span id="l13.3" class="difflineat">@@ -144,17 +144,17 @@ nsresult NS_MsgGetAttributeFromString(co</span>
<a href="#l13.4"></a><span id="l13.4">     nsCOMPtr&lt;nsIPrefService&gt; prefService = do_GetService(NS_PREFSERVICE_CONTRACTID, &amp;rv);</span>
<a href="#l13.5"></a><span id="l13.5">     NS_ENSURE_SUCCESS(rv, rv);</span>
<a href="#l13.6"></a><span id="l13.6"> </span>
<a href="#l13.7"></a><span id="l13.7">     nsCOMPtr&lt;nsIPrefBranch&gt; prefBranch;</span>
<a href="#l13.8"></a><span id="l13.8">     rv = prefService-&gt;GetBranch(nullptr, getter_AddRefs(prefBranch));</span>
<a href="#l13.9"></a><span id="l13.9">     NS_ENSURE_SUCCESS(rv, rv);</span>
<a href="#l13.10"></a><span id="l13.10"> </span>
<a href="#l13.11"></a><span id="l13.11">     nsCString headers;</span>
<a href="#l13.12"></a><span id="l13.12" class="difflineminus">-    prefBranch-&gt;GetCharPref(MAILNEWS_CUSTOM_HEADERS, getter_Copies(headers));</span>
<a href="#l13.13"></a><span id="l13.13" class="difflineplus">+    prefBranch-&gt;GetCharPref(MAILNEWS_CUSTOM_HEADERS, headers);</span>
<a href="#l13.14"></a><span id="l13.14"> </span>
<a href="#l13.15"></a><span id="l13.15">     if (!headers.IsEmpty())</span>
<a href="#l13.16"></a><span id="l13.16">     {</span>
<a href="#l13.17"></a><span id="l13.17">       nsAutoCString hdrStr(headers);</span>
<a href="#l13.18"></a><span id="l13.18">       hdrStr.StripWhitespace();  //remove whitespace before parsing</span>
<a href="#l13.19"></a><span id="l13.19"> </span>
<a href="#l13.20"></a><span id="l13.20">       char *newStr= hdrStr.BeginWriting();</span>
<a href="#l13.21"></a><span id="l13.21">       char *token = NS_strtok(&quot;:&quot;, &amp;newStr);</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l14.1"></a><span id="l14.1" class="difflineminus">--- a/mailnews/base/src/nsMsgAccount.cpp</span>
<a href="#l14.2"></a><span id="l14.2" class="difflineplus">+++ b/mailnews/base/src/nsMsgAccount.cpp</span>
<a href="#l14.3"></a><span id="l14.3" class="difflineat">@@ -87,17 +87,17 @@ nsMsgAccount::createIncomingServer()</span>
<a href="#l14.4"></a><span id="l14.4">   //</span>
<a href="#l14.5"></a><span id="l14.5">   // ex) mail.account.myaccount.server = &quot;myserver&quot;</span>
<a href="#l14.6"></a><span id="l14.6"> </span>
<a href="#l14.7"></a><span id="l14.7">   nsresult rv = getPrefService();</span>
<a href="#l14.8"></a><span id="l14.8">   NS_ENSURE_SUCCESS(rv, rv);</span>
<a href="#l14.9"></a><span id="l14.9"> </span>
<a href="#l14.10"></a><span id="l14.10">   // get the &quot;server&quot; pref</span>
<a href="#l14.11"></a><span id="l14.11">   nsCString serverKey;</span>
<a href="#l14.12"></a><span id="l14.12" class="difflineminus">-  rv = m_prefs-&gt;GetCharPref(&quot;server&quot;, getter_Copies(serverKey));</span>
<a href="#l14.13"></a><span id="l14.13" class="difflineplus">+  rv = m_prefs-&gt;GetCharPref(&quot;server&quot;, serverKey);</span>
<a href="#l14.14"></a><span id="l14.14">   NS_ENSURE_SUCCESS(rv, rv);</span>
<a href="#l14.15"></a><span id="l14.15"> </span>
<a href="#l14.16"></a><span id="l14.16">   // get the server from the account manager</span>
<a href="#l14.17"></a><span id="l14.17">   nsCOMPtr&lt;nsIMsgAccountManager&gt; accountManager =</span>
<a href="#l14.18"></a><span id="l14.18">            do_GetService(NS_MSGACCOUNTMANAGER_CONTRACTID, &amp;rv);</span>
<a href="#l14.19"></a><span id="l14.19">   NS_ENSURE_SUCCESS(rv, rv);</span>
<a href="#l14.20"></a><span id="l14.20"> </span>
<a href="#l14.21"></a><span id="l14.21">   nsCOMPtr&lt;nsIMsgIncomingServer&gt; server;</span>
<a href="#l14.22"></a><span id="l14.22" class="difflineat">@@ -118,17 +118,17 @@ nsMsgAccount::SetIncomingServer(nsIMsgIn</span>
<a href="#l14.23"></a><span id="l14.23">   NS_ENSURE_ARG_POINTER(aIncomingServer);</span>
<a href="#l14.24"></a><span id="l14.24"> </span>
<a href="#l14.25"></a><span id="l14.25">   nsCString key;</span>
<a href="#l14.26"></a><span id="l14.26">   nsresult rv = aIncomingServer-&gt;GetKey(key);</span>
<a href="#l14.27"></a><span id="l14.27"> </span>
<a href="#l14.28"></a><span id="l14.28">   if (NS_SUCCEEDED(rv)) {</span>
<a href="#l14.29"></a><span id="l14.29">     rv = getPrefService();</span>
<a href="#l14.30"></a><span id="l14.30">     NS_ENSURE_SUCCESS(rv, rv);</span>
<a href="#l14.31"></a><span id="l14.31" class="difflineminus">-    m_prefs-&gt;SetCharPref(&quot;server&quot;, key.get());</span>
<a href="#l14.32"></a><span id="l14.32" class="difflineplus">+    m_prefs-&gt;SetCharPref(&quot;server&quot;, key);</span>
<a href="#l14.33"></a><span id="l14.33">   }</span>
<a href="#l14.34"></a><span id="l14.34"> </span>
<a href="#l14.35"></a><span id="l14.35">   m_incomingServer = aIncomingServer;</span>
<a href="#l14.36"></a><span id="l14.36"> </span>
<a href="#l14.37"></a><span id="l14.37">   bool serverValid;</span>
<a href="#l14.38"></a><span id="l14.38">   (void) aIncomingServer-&gt;GetValid(&amp;serverValid);</span>
<a href="#l14.39"></a><span id="l14.39">   // only notify server loaded if server is valid so</span>
<a href="#l14.40"></a><span id="l14.40">   // account manager only gets told about finished accounts.</span>
<a href="#l14.41"></a><span id="l14.41" class="difflineat">@@ -195,17 +195,17 @@ nsMsgAccount::createIdentities()</span>
<a href="#l14.42"></a><span id="l14.42">   nsresult rv;</span>
<a href="#l14.43"></a><span id="l14.43">   m_identities = do_CreateInstance(NS_ARRAY_CONTRACTID, &amp;rv);</span>
<a href="#l14.44"></a><span id="l14.44">   NS_ENSURE_SUCCESS(rv, rv);</span>
<a href="#l14.45"></a><span id="l14.45"> </span>
<a href="#l14.46"></a><span id="l14.46">   nsCString identityKey;</span>
<a href="#l14.47"></a><span id="l14.47">   rv = getPrefService();</span>
<a href="#l14.48"></a><span id="l14.48">   NS_ENSURE_SUCCESS(rv, rv);</span>
<a href="#l14.49"></a><span id="l14.49"> </span>
<a href="#l14.50"></a><span id="l14.50" class="difflineminus">-  m_prefs-&gt;GetCharPref(&quot;identities&quot;, getter_Copies(identityKey));</span>
<a href="#l14.51"></a><span id="l14.51" class="difflineplus">+  m_prefs-&gt;GetCharPref(&quot;identities&quot;, identityKey);</span>
<a href="#l14.52"></a><span id="l14.52">   if (identityKey.IsEmpty())    // not an error if no identities, but</span>
<a href="#l14.53"></a><span id="l14.53">     return NS_OK;               // strtok will be unhappy</span>
<a href="#l14.54"></a><span id="l14.54">   // get the server from the account manager</span>
<a href="#l14.55"></a><span id="l14.55">   nsCOMPtr&lt;nsIMsgAccountManager&gt; accountManager =</span>
<a href="#l14.56"></a><span id="l14.56">            do_GetService(NS_MSGACCOUNTMANAGER_CONTRACTID, &amp;rv);</span>
<a href="#l14.57"></a><span id="l14.57">   NS_ENSURE_SUCCESS(rv, rv);</span>
<a href="#l14.58"></a><span id="l14.58"> </span>
<a href="#l14.59"></a><span id="l14.59">   char* newStr = identityKey.BeginWriting();</span>
<a href="#l14.60"></a><span id="l14.60" class="difflineat">@@ -294,17 +294,17 @@ nsMsgAccount::AddIdentity(nsIMsgIdentity</span>
<a href="#l14.61"></a><span id="l14.61">   // hack hack - need to add this to the list of identities.</span>
<a href="#l14.62"></a><span id="l14.62">   // for now just treat this as a Setxxx accessor</span>
<a href="#l14.63"></a><span id="l14.63">   // when this is actually implemented, don't refcount the default identity</span>
<a href="#l14.64"></a><span id="l14.64">   nsCString key;</span>
<a href="#l14.65"></a><span id="l14.65">   nsresult rv = identity-&gt;GetKey(key);</span>
<a href="#l14.66"></a><span id="l14.66"> </span>
<a href="#l14.67"></a><span id="l14.67">   if (NS_SUCCEEDED(rv)) {</span>
<a href="#l14.68"></a><span id="l14.68">     nsCString identityList;</span>
<a href="#l14.69"></a><span id="l14.69" class="difflineminus">-    m_prefs-&gt;GetCharPref(&quot;identities&quot;, getter_Copies(identityList));</span>
<a href="#l14.70"></a><span id="l14.70" class="difflineplus">+    m_prefs-&gt;GetCharPref(&quot;identities&quot;, identityList);</span>
<a href="#l14.71"></a><span id="l14.71"> </span>
<a href="#l14.72"></a><span id="l14.72">     nsAutoCString newIdentityList(identityList);</span>
<a href="#l14.73"></a><span id="l14.73"> </span>
<a href="#l14.74"></a><span id="l14.74">     nsAutoCString testKey;      // temporary to strip whitespace</span>
<a href="#l14.75"></a><span id="l14.75">     bool foundIdentity = false; // if the input identity is found</span>
<a href="#l14.76"></a><span id="l14.76"> </span>
<a href="#l14.77"></a><span id="l14.77">     if (!identityList.IsEmpty()) {</span>
<a href="#l14.78"></a><span id="l14.78">       char *newStr = identityList.BeginWriting();</span>
<a href="#l14.79"></a><span id="l14.79" class="difflineat">@@ -327,17 +327,17 @@ nsMsgAccount::AddIdentity(nsIMsgIdentity</span>
<a href="#l14.80"></a><span id="l14.80">       if (newIdentityList.IsEmpty())</span>
<a href="#l14.81"></a><span id="l14.81">         newIdentityList = key;</span>
<a href="#l14.82"></a><span id="l14.82">       else {</span>
<a href="#l14.83"></a><span id="l14.83">         newIdentityList.Append(',');</span>
<a href="#l14.84"></a><span id="l14.84">         newIdentityList.Append(key);</span>
<a href="#l14.85"></a><span id="l14.85">       }</span>
<a href="#l14.86"></a><span id="l14.86">     }</span>
<a href="#l14.87"></a><span id="l14.87"> </span>
<a href="#l14.88"></a><span id="l14.88" class="difflineminus">-    m_prefs-&gt;SetCharPref(&quot;identities&quot;, newIdentityList.get());</span>
<a href="#l14.89"></a><span id="l14.89" class="difflineplus">+    m_prefs-&gt;SetCharPref(&quot;identities&quot;, newIdentityList);</span>
<a href="#l14.90"></a><span id="l14.90">   }</span>
<a href="#l14.91"></a><span id="l14.91"> </span>
<a href="#l14.92"></a><span id="l14.92">   // now add it to the in-memory list</span>
<a href="#l14.93"></a><span id="l14.93">   return addIdentityInternal(identity);</span>
<a href="#l14.94"></a><span id="l14.94"> }</span>
<a href="#l14.95"></a><span id="l14.95"> </span>
<a href="#l14.96"></a><span id="l14.96"> /* void removeIdentity (in nsIMsgIdentity identity); */</span>
<a href="#l14.97"></a><span id="l14.97"> NS_IMETHODIMP</span>
<a href="#l14.98"></a><span id="l14.98" class="difflineat">@@ -390,17 +390,17 @@ nsMsgAccount::saveIdentitiesPref()</span>
<a href="#l14.99"></a><span id="l14.99">       {</span>
<a href="#l14.100"></a><span id="l14.100">         newIdentityList.Append(',');</span>
<a href="#l14.101"></a><span id="l14.101">         newIdentityList.Append(key);</span>
<a href="#l14.102"></a><span id="l14.102">       }</span>
<a href="#l14.103"></a><span id="l14.103">     }</span>
<a href="#l14.104"></a><span id="l14.104">   }</span>
<a href="#l14.105"></a><span id="l14.105"> </span>
<a href="#l14.106"></a><span id="l14.106">   // Save the pref.</span>
<a href="#l14.107"></a><span id="l14.107" class="difflineminus">-  m_prefs-&gt;SetCharPref(&quot;identities&quot;, newIdentityList.get());</span>
<a href="#l14.108"></a><span id="l14.108" class="difflineplus">+  m_prefs-&gt;SetCharPref(&quot;identities&quot;, newIdentityList);</span>
<a href="#l14.109"></a><span id="l14.109"> </span>
<a href="#l14.110"></a><span id="l14.110">   return NS_OK;</span>
<a href="#l14.111"></a><span id="l14.111"> }</span>
<a href="#l14.112"></a><span id="l14.112"> </span>
<a href="#l14.113"></a><span id="l14.113"> NS_IMETHODIMP nsMsgAccount::GetKey(nsACString&amp; accountKey)</span>
<a href="#l14.114"></a><span id="l14.114"> {</span>
<a href="#l14.115"></a><span id="l14.115">   accountKey = m_accountKey;</span>
<a href="#l14.116"></a><span id="l14.116">   return NS_OK;</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l15.1"></a><span id="l15.1" class="difflineminus">--- a/mailnews/base/src/nsMsgAccountManager.cpp</span>
<a href="#l15.2"></a><span id="l15.2" class="difflineplus">+++ b/mailnews/base/src/nsMsgAccountManager.cpp</span>
<a href="#l15.3"></a><span id="l15.3" class="difflineat">@@ -342,17 +342,17 @@ nsMsgAccountManager::GetUniqueServerKey(</span>
<a href="#l15.4"></a><span id="l15.4">     nsAutoCString type;</span>
<a href="#l15.5"></a><span id="l15.5">     nsAutoCString typeKey;</span>
<a href="#l15.6"></a><span id="l15.6">     for (uint32_t lastKey = 1; ; lastKey++)</span>
<a href="#l15.7"></a><span id="l15.7">     {</span>
<a href="#l15.8"></a><span id="l15.8">       aResult.AssignLiteral(SERVER_PREFIX);</span>
<a href="#l15.9"></a><span id="l15.9">       aResult.AppendInt(lastKey);</span>
<a href="#l15.10"></a><span id="l15.10">       typeKey.Assign(aResult);</span>
<a href="#l15.11"></a><span id="l15.11">       typeKey.AppendLiteral(&quot;.type&quot;);</span>
<a href="#l15.12"></a><span id="l15.12" class="difflineminus">-      prefBranchServer-&gt;GetCharPref(typeKey.get(), getter_Copies(type));</span>
<a href="#l15.13"></a><span id="l15.13" class="difflineplus">+      prefBranchServer-&gt;GetCharPref(typeKey.get(), type);</span>
<a href="#l15.14"></a><span id="l15.14">       if (type.IsEmpty()) // a server slot with no type is considered empty</span>
<a href="#l15.15"></a><span id="l15.15">         return;</span>
<a href="#l15.16"></a><span id="l15.16">     }</span>
<a href="#l15.17"></a><span id="l15.17">   }</span>
<a href="#l15.18"></a><span id="l15.18">   else</span>
<a href="#l15.19"></a><span id="l15.19">   {</span>
<a href="#l15.20"></a><span id="l15.20">     // If pref service fails, try to find a free serverX key</span>
<a href="#l15.21"></a><span id="l15.21">     // by checking which keys exist.</span>
<a href="#l15.22"></a><span id="l15.22" class="difflineat">@@ -437,17 +437,17 @@ nsMsgAccountManager::CreateIncomingServe</span>
<a href="#l15.23"></a><span id="l15.23">   NS_ENSURE_SUCCESS(rv, rv);</span>
<a href="#l15.24"></a><span id="l15.24"> </span>
<a href="#l15.25"></a><span id="l15.25">   nsAutoCString key;</span>
<a href="#l15.26"></a><span id="l15.26">   GetUniqueServerKey(key);</span>
<a href="#l15.27"></a><span id="l15.27">   rv = createKeyedServer(key, username, hostname, type, _retval);</span>
<a href="#l15.28"></a><span id="l15.28">   if (*_retval)</span>
<a href="#l15.29"></a><span id="l15.29">   {</span>
<a href="#l15.30"></a><span id="l15.30">     nsCString defaultStore;</span>
<a href="#l15.31"></a><span id="l15.31" class="difflineminus">-    m_prefs-&gt;GetCharPref(&quot;mail.serverDefaultStoreContractID&quot;, getter_Copies(defaultStore));</span>
<a href="#l15.32"></a><span id="l15.32" class="difflineplus">+    m_prefs-&gt;GetCharPref(&quot;mail.serverDefaultStoreContractID&quot;, defaultStore);</span>
<a href="#l15.33"></a><span id="l15.33">     (*_retval)-&gt;SetCharValue(&quot;storeContractID&quot;, defaultStore);</span>
<a href="#l15.34"></a><span id="l15.34"> </span>
<a href="#l15.35"></a><span id="l15.35">     // From when we first create the account until we have created some folders,</span>
<a href="#l15.36"></a><span id="l15.36">     // we can change the store type.</span>
<a href="#l15.37"></a><span id="l15.37">     (*_retval)-&gt;SetBoolValue(&quot;canChangeStoreType&quot;, true);</span>
<a href="#l15.38"></a><span id="l15.38">   }</span>
<a href="#l15.39"></a><span id="l15.39">   return rv;</span>
<a href="#l15.40"></a><span id="l15.40"> }</span>
<a href="#l15.41"></a><span id="l15.41" class="difflineat">@@ -471,31 +471,31 @@ nsMsgAccountManager::GetIncomingServer(c</span>
<a href="#l15.42"></a><span id="l15.42">   // in order to create the right kind of server, we have to look</span>
<a href="#l15.43"></a><span id="l15.43">   // at the pref for this server to get the username, hostname, and type</span>
<a href="#l15.44"></a><span id="l15.44">   nsAutoCString serverPrefPrefix(PREF_MAIL_SERVER_PREFIX);</span>
<a href="#l15.45"></a><span id="l15.45">   serverPrefPrefix.Append(key);</span>
<a href="#l15.46"></a><span id="l15.46"> </span>
<a href="#l15.47"></a><span id="l15.47">   nsCString serverType;</span>
<a href="#l15.48"></a><span id="l15.48">   nsAutoCString serverPref (serverPrefPrefix);</span>
<a href="#l15.49"></a><span id="l15.49">   serverPref.AppendLiteral(&quot;.type&quot;);</span>
<a href="#l15.50"></a><span id="l15.50" class="difflineminus">-  rv = m_prefs-&gt;GetCharPref(serverPref.get(), getter_Copies(serverType));</span>
<a href="#l15.51"></a><span id="l15.51" class="difflineplus">+  rv = m_prefs-&gt;GetCharPref(serverPref.get(), serverType);</span>
<a href="#l15.52"></a><span id="l15.52">   NS_ENSURE_SUCCESS(rv, NS_ERROR_NOT_INITIALIZED);</span>
<a href="#l15.53"></a><span id="l15.53"> </span>
<a href="#l15.54"></a><span id="l15.54">   //</span>
<a href="#l15.55"></a><span id="l15.55">   // .userName</span>
<a href="#l15.56"></a><span id="l15.56">   serverPref = serverPrefPrefix;</span>
<a href="#l15.57"></a><span id="l15.57">   serverPref.AppendLiteral(&quot;.userName&quot;);</span>
<a href="#l15.58"></a><span id="l15.58">   nsCString username;</span>
<a href="#l15.59"></a><span id="l15.59" class="difflineminus">-  rv = m_prefs-&gt;GetCharPref(serverPref.get(), getter_Copies(username));</span>
<a href="#l15.60"></a><span id="l15.60" class="difflineplus">+  rv = m_prefs-&gt;GetCharPref(serverPref.get(), username);</span>
<a href="#l15.61"></a><span id="l15.61"> </span>
<a href="#l15.62"></a><span id="l15.62">   // .hostname</span>
<a href="#l15.63"></a><span id="l15.63">   serverPref = serverPrefPrefix;</span>
<a href="#l15.64"></a><span id="l15.64">   serverPref.AppendLiteral(&quot;.hostname&quot;);</span>
<a href="#l15.65"></a><span id="l15.65">   nsCString hostname;</span>
<a href="#l15.66"></a><span id="l15.66" class="difflineminus">-  rv = m_prefs-&gt;GetCharPref(serverPref.get(), getter_Copies(hostname));</span>
<a href="#l15.67"></a><span id="l15.67" class="difflineplus">+  rv = m_prefs-&gt;GetCharPref(serverPref.get(), hostname);</span>
<a href="#l15.68"></a><span id="l15.68">   NS_ENSURE_SUCCESS(rv, NS_ERROR_NOT_INITIALIZED);</span>
<a href="#l15.69"></a><span id="l15.69"> </span>
<a href="#l15.70"></a><span id="l15.70">   return createKeyedServer(key, username, hostname, serverType, _retval);</span>
<a href="#l15.71"></a><span id="l15.71"> }</span>
<a href="#l15.72"></a><span id="l15.72"> </span>
<a href="#l15.73"></a><span id="l15.73"> NS_IMETHODIMP</span>
<a href="#l15.74"></a><span id="l15.74"> nsMsgAccountManager::RemoveIncomingServer(nsIMsgIncomingServer *aServer,</span>
<a href="#l15.75"></a><span id="l15.75">                                           bool aRemoveFiles)</span>
<a href="#l15.76"></a><span id="l15.76" class="difflineat">@@ -714,17 +714,17 @@ nsMsgAccountManager::OutputAccountsPref(</span>
<a href="#l15.77"></a><span id="l15.77">   for (uint32_t index = 0; index &lt; m_accounts.Length(); index++)</span>
<a href="#l15.78"></a><span id="l15.78">   {</span>
<a href="#l15.79"></a><span id="l15.79">     m_accounts[index]-&gt;GetKey(accountKey);</span>
<a href="#l15.80"></a><span id="l15.80">     if (index)</span>
<a href="#l15.81"></a><span id="l15.81">       mAccountKeyList.Append(ACCOUNT_DELIMITER);</span>
<a href="#l15.82"></a><span id="l15.82">     mAccountKeyList.Append(accountKey);</span>
<a href="#l15.83"></a><span id="l15.83">   }</span>
<a href="#l15.84"></a><span id="l15.84">   return m_prefs-&gt;SetCharPref(PREF_MAIL_ACCOUNTMANAGER_ACCOUNTS,</span>
<a href="#l15.85"></a><span id="l15.85" class="difflineminus">-                                mAccountKeyList.get());</span>
<a href="#l15.86"></a><span id="l15.86" class="difflineplus">+                              mAccountKeyList);</span>
<a href="#l15.87"></a><span id="l15.87"> }</span>
<a href="#l15.88"></a><span id="l15.88"> </span>
<a href="#l15.89"></a><span id="l15.89"> /* get the default account. If no default account, pick the first account */</span>
<a href="#l15.90"></a><span id="l15.90"> NS_IMETHODIMP</span>
<a href="#l15.91"></a><span id="l15.91"> nsMsgAccountManager::GetDefaultAccount(nsIMsgAccount **aDefaultAccount)</span>
<a href="#l15.92"></a><span id="l15.92"> {</span>
<a href="#l15.93"></a><span id="l15.93">   NS_ENSURE_ARG_POINTER(aDefaultAccount);</span>
<a href="#l15.94"></a><span id="l15.94"> </span>
<a href="#l15.95"></a><span id="l15.95" class="difflineat">@@ -734,17 +734,17 @@ nsMsgAccountManager::GetDefaultAccount(n</span>
<a href="#l15.96"></a><span id="l15.96">   if (!m_defaultAccount) {</span>
<a href="#l15.97"></a><span id="l15.97">     uint32_t count = m_accounts.Length();</span>
<a href="#l15.98"></a><span id="l15.98">     if (!count) {</span>
<a href="#l15.99"></a><span id="l15.99">       *aDefaultAccount = nullptr;</span>
<a href="#l15.100"></a><span id="l15.100">       return NS_ERROR_FAILURE;</span>
<a href="#l15.101"></a><span id="l15.101">     }</span>
<a href="#l15.102"></a><span id="l15.102"> </span>
<a href="#l15.103"></a><span id="l15.103">     nsCString defaultKey;</span>
<a href="#l15.104"></a><span id="l15.104" class="difflineminus">-    rv = m_prefs-&gt;GetCharPref(PREF_MAIL_ACCOUNTMANAGER_DEFAULTACCOUNT, getter_Copies(defaultKey));</span>
<a href="#l15.105"></a><span id="l15.105" class="difflineplus">+    rv = m_prefs-&gt;GetCharPref(PREF_MAIL_ACCOUNTMANAGER_DEFAULTACCOUNT, defaultKey);</span>
<a href="#l15.106"></a><span id="l15.106"> </span>
<a href="#l15.107"></a><span id="l15.107">     if (NS_SUCCEEDED(rv))</span>
<a href="#l15.108"></a><span id="l15.108">       rv = GetAccount(defaultKey, getter_AddRefs(m_defaultAccount));</span>
<a href="#l15.109"></a><span id="l15.109"> </span>
<a href="#l15.110"></a><span id="l15.110">     if (NS_FAILED(rv) || !m_defaultAccount) {</span>
<a href="#l15.111"></a><span id="l15.111">       nsCOMPtr&lt;nsIMsgAccount&gt; firstAccount;</span>
<a href="#l15.112"></a><span id="l15.112">       uint32_t index;</span>
<a href="#l15.113"></a><span id="l15.113">       bool foundValidDefaultAccount = false;</span>
<a href="#l15.114"></a><span id="l15.114" class="difflineat">@@ -857,17 +857,17 @@ nsMsgAccountManager::setDefaultAccountPr</span>
<a href="#l15.115"></a><span id="l15.115"> {</span>
<a href="#l15.116"></a><span id="l15.116">   nsresult rv;</span>
<a href="#l15.117"></a><span id="l15.117"> </span>
<a href="#l15.118"></a><span id="l15.118">   if (aDefaultAccount) {</span>
<a href="#l15.119"></a><span id="l15.119">     nsCString key;</span>
<a href="#l15.120"></a><span id="l15.120">     rv = aDefaultAccount-&gt;GetKey(key);</span>
<a href="#l15.121"></a><span id="l15.121">     NS_ENSURE_SUCCESS(rv, rv);</span>
<a href="#l15.122"></a><span id="l15.122"> </span>
<a href="#l15.123"></a><span id="l15.123" class="difflineminus">-    rv = m_prefs-&gt;SetCharPref(PREF_MAIL_ACCOUNTMANAGER_DEFAULTACCOUNT, key.get());</span>
<a href="#l15.124"></a><span id="l15.124" class="difflineplus">+    rv = m_prefs-&gt;SetCharPref(PREF_MAIL_ACCOUNTMANAGER_DEFAULTACCOUNT, key);</span>
<a href="#l15.125"></a><span id="l15.125">     NS_ENSURE_SUCCESS(rv,rv);</span>
<a href="#l15.126"></a><span id="l15.126">   }</span>
<a href="#l15.127"></a><span id="l15.127">   else</span>
<a href="#l15.128"></a><span id="l15.128">     m_prefs-&gt;ClearUserPref(PREF_MAIL_ACCOUNTMANAGER_DEFAULTACCOUNT);</span>
<a href="#l15.129"></a><span id="l15.129"> </span>
<a href="#l15.130"></a><span id="l15.130">   return NS_OK;</span>
<a href="#l15.131"></a><span id="l15.131"> }</span>
<a href="#l15.132"></a><span id="l15.132"> </span>
<a href="#l15.133"></a><span id="l15.133" class="difflineat">@@ -1065,17 +1065,17 @@ nsMsgAccountManager::LoadAccounts()</span>
<a href="#l15.134"></a><span id="l15.134">   // Ensure messenger OS integration service has started</span>
<a href="#l15.135"></a><span id="l15.135">   // note, you can't expect the integrationService to be there</span>
<a href="#l15.136"></a><span id="l15.136">   // we don't have OS integration on all platforms.</span>
<a href="#l15.137"></a><span id="l15.137">   nsCOMPtr&lt;nsIMessengerOSIntegration&gt; integrationService =</span>
<a href="#l15.138"></a><span id="l15.138">            do_GetService(NS_MESSENGEROSINTEGRATION_CONTRACTID, &amp;rv);</span>
<a href="#l15.139"></a><span id="l15.139"> </span>
<a href="#l15.140"></a><span id="l15.140">   // mail.accountmanager.accounts is the main entry point for all accounts</span>
<a href="#l15.141"></a><span id="l15.141">   nsCString accountList;</span>
<a href="#l15.142"></a><span id="l15.142" class="difflineminus">-  rv = m_prefs-&gt;GetCharPref(PREF_MAIL_ACCOUNTMANAGER_ACCOUNTS, getter_Copies(accountList));</span>
<a href="#l15.143"></a><span id="l15.143" class="difflineplus">+  rv = m_prefs-&gt;GetCharPref(PREF_MAIL_ACCOUNTMANAGER_ACCOUNTS, accountList);</span>
<a href="#l15.144"></a><span id="l15.144"> </span>
<a href="#l15.145"></a><span id="l15.145">   /**</span>
<a href="#l15.146"></a><span id="l15.146">    * Check to see if we need to add pre-configured accounts.</span>
<a href="#l15.147"></a><span id="l15.147">    * Following prefs are important to note in understanding the procedure here.</span>
<a href="#l15.148"></a><span id="l15.148">    *</span>
<a href="#l15.149"></a><span id="l15.149">    * 1. pref(&quot;mailnews.append_preconfig_accounts.version&quot;, version number);</span>
<a href="#l15.150"></a><span id="l15.150">    * This pref registers the current version in the user prefs file. A default value</span>
<a href="#l15.151"></a><span id="l15.151">    * is stored in mailnews.js file. If a given vendor needs to add more preconfigured</span>
<a href="#l15.152"></a><span id="l15.152" class="difflineat">@@ -1104,17 +1104,17 @@ nsMsgAccountManager::LoadAccounts()</span>
<a href="#l15.153"></a><span id="l15.153">   NS_ENSURE_SUCCESS(rv, rv);</span>
<a href="#l15.154"></a><span id="l15.154"> </span>
<a href="#l15.155"></a><span id="l15.155">   // Update the account list if needed</span>
<a href="#l15.156"></a><span id="l15.156">   if ((appendAccountsCurrentVersion &lt;= appendAccountsDefaultVersion)) {</span>
<a href="#l15.157"></a><span id="l15.157"> </span>
<a href="#l15.158"></a><span id="l15.158">     // Get a list of pre-configured accounts</span>
<a href="#l15.159"></a><span id="l15.159">     nsCString appendAccountList;</span>
<a href="#l15.160"></a><span id="l15.160">     rv = m_prefs-&gt;GetCharPref(PREF_MAIL_ACCOUNTMANAGER_APPEND_ACCOUNTS,</span>
<a href="#l15.161"></a><span id="l15.161" class="difflineminus">-                              getter_Copies(appendAccountList));</span>
<a href="#l15.162"></a><span id="l15.162" class="difflineplus">+                              appendAccountList);</span>
<a href="#l15.163"></a><span id="l15.163">     appendAccountList.StripWhitespace();</span>
<a href="#l15.164"></a><span id="l15.164"> </span>
<a href="#l15.165"></a><span id="l15.165">     // If there are pre-configured accounts, we need to add them to the</span>
<a href="#l15.166"></a><span id="l15.166">     // existing list.</span>
<a href="#l15.167"></a><span id="l15.167">     if (!appendAccountList.IsEmpty())</span>
<a href="#l15.168"></a><span id="l15.168">     {</span>
<a href="#l15.169"></a><span id="l15.169">       if (!accountList.IsEmpty())</span>
<a href="#l15.170"></a><span id="l15.170">       {</span>
<a href="#l15.171"></a><span id="l15.171" class="difflineat">@@ -1181,17 +1181,17 @@ nsMsgAccountManager::LoadAccounts()</span>
<a href="#l15.172"></a><span id="l15.172"> </span>
<a href="#l15.173"></a><span id="l15.173">     nsCOMPtr&lt;nsIPrefBranch&gt; accountPrefBranch;</span>
<a href="#l15.174"></a><span id="l15.174">     rv = prefservice-&gt;GetBranch(serverKeyPref.get(),</span>
<a href="#l15.175"></a><span id="l15.175">                                 getter_AddRefs(accountPrefBranch));</span>
<a href="#l15.176"></a><span id="l15.176">     NS_ENSURE_SUCCESS(rv,rv);</span>
<a href="#l15.177"></a><span id="l15.177"> </span>
<a href="#l15.178"></a><span id="l15.178">     serverKeyPref += &quot;.server&quot;;</span>
<a href="#l15.179"></a><span id="l15.179">     nsCString serverKey;</span>
<a href="#l15.180"></a><span id="l15.180" class="difflineminus">-    rv = m_prefs-&gt;GetCharPref(serverKeyPref.get(), getter_Copies(serverKey));</span>
<a href="#l15.181"></a><span id="l15.181" class="difflineplus">+    rv = m_prefs-&gt;GetCharPref(serverKeyPref.get(), serverKey);</span>
<a href="#l15.182"></a><span id="l15.182">     if (NS_FAILED(rv))</span>
<a href="#l15.183"></a><span id="l15.183">       continue;</span>
<a href="#l15.184"></a><span id="l15.184"> </span>
<a href="#l15.185"></a><span id="l15.185">     nsCOMPtr&lt;nsIMsgAccount&gt; serverAccount;</span>
<a href="#l15.186"></a><span id="l15.186">     findAccountByServerKey(serverKey, getter_AddRefs(serverAccount));</span>
<a href="#l15.187"></a><span id="l15.187">     // If we have an existing account with the same server, ignore this account</span>
<a href="#l15.188"></a><span id="l15.188">     if (serverAccount)</span>
<a href="#l15.189"></a><span id="l15.189">       continue;</span>
<a href="#l15.190"></a><span id="l15.190" class="difflineat">@@ -1310,35 +1310,35 @@ nsMsgAccountManager::LoadAccounts()</span>
<a href="#l15.191"></a><span id="l15.191">               continue;</span>
<a href="#l15.192"></a><span id="l15.192">             }</span>
<a href="#l15.193"></a><span id="l15.193">             nsCOMPtr&lt;nsIPrefBranch&gt; prefBranch(</span>
<a href="#l15.194"></a><span id="l15.194">               do_GetService(NS_PREFSERVICE_CONTRACTID, &amp;rv));</span>
<a href="#l15.195"></a><span id="l15.195">             if (NS_FAILED(rv)) {</span>
<a href="#l15.196"></a><span id="l15.196">               continue;</span>
<a href="#l15.197"></a><span id="l15.197">             }</span>
<a href="#l15.198"></a><span id="l15.198">             rv = prefBranch-&gt;GetCharPref(accountPref.get(),</span>
<a href="#l15.199"></a><span id="l15.199" class="difflineminus">-                                         getter_Copies(dupAccountServerKey));</span>
<a href="#l15.200"></a><span id="l15.200" class="difflineplus">+                                         dupAccountServerKey);</span>
<a href="#l15.201"></a><span id="l15.201">             if (NS_FAILED(rv)) {</span>
<a href="#l15.202"></a><span id="l15.202">               continue;</span>
<a href="#l15.203"></a><span id="l15.203">             }</span>
<a href="#l15.204"></a><span id="l15.204">             nsCOMPtr&lt;nsIPrefBranch&gt; serverPrefBranch;</span>
<a href="#l15.205"></a><span id="l15.205">             nsCString serverKeyPref(PREF_MAIL_SERVER_PREFIX);</span>
<a href="#l15.206"></a><span id="l15.206">             serverKeyPref.Append(dupAccountServerKey);</span>
<a href="#l15.207"></a><span id="l15.207">             serverKeyPref.Append('.');</span>
<a href="#l15.208"></a><span id="l15.208">             rv = prefservice-&gt;GetBranch(serverKeyPref.get(),</span>
<a href="#l15.209"></a><span id="l15.209">                                         getter_AddRefs(serverPrefBranch));</span>
<a href="#l15.210"></a><span id="l15.210">             if (NS_FAILED(rv)) {</span>
<a href="#l15.211"></a><span id="l15.211">               continue;</span>
<a href="#l15.212"></a><span id="l15.212">             }</span>
<a href="#l15.213"></a><span id="l15.213">             nsCString userName;</span>
<a href="#l15.214"></a><span id="l15.214">             nsCString hostName;</span>
<a href="#l15.215"></a><span id="l15.215">             nsCString type;</span>
<a href="#l15.216"></a><span id="l15.216" class="difflineminus">-            serverPrefBranch-&gt;GetCharPref(&quot;userName&quot;, getter_Copies(userName));</span>
<a href="#l15.217"></a><span id="l15.217" class="difflineminus">-            serverPrefBranch-&gt;GetCharPref(&quot;hostname&quot;, getter_Copies(hostName));</span>
<a href="#l15.218"></a><span id="l15.218" class="difflineminus">-            serverPrefBranch-&gt;GetCharPref(&quot;type&quot;, getter_Copies(type));</span>
<a href="#l15.219"></a><span id="l15.219" class="difflineplus">+            serverPrefBranch-&gt;GetCharPref(&quot;userName&quot;, userName);</span>
<a href="#l15.220"></a><span id="l15.220" class="difflineplus">+            serverPrefBranch-&gt;GetCharPref(&quot;hostname&quot;, hostName);</span>
<a href="#l15.221"></a><span id="l15.221" class="difflineplus">+            serverPrefBranch-&gt;GetCharPref(&quot;type&quot;, type);</span>
<a href="#l15.222"></a><span id="l15.222">             // Find a server with the same info.</span>
<a href="#l15.223"></a><span id="l15.223">             nsCOMPtr&lt;nsIMsgAccountManager&gt; accountManager =</span>
<a href="#l15.224"></a><span id="l15.224">                      do_GetService(NS_MSGACCOUNTMANAGER_CONTRACTID, &amp;rv);</span>
<a href="#l15.225"></a><span id="l15.225">             if (NS_FAILED(rv)) {</span>
<a href="#l15.226"></a><span id="l15.226">               continue;</span>
<a href="#l15.227"></a><span id="l15.227">             }</span>
<a href="#l15.228"></a><span id="l15.228">             nsCOMPtr&lt;nsIMsgIncomingServer&gt; server;</span>
<a href="#l15.229"></a><span id="l15.229">             accountManager-&gt;FindServer(userName, hostName, type,</span>
<a href="#l15.230"></a><span id="l15.230" class="difflineat">@@ -1373,17 +1373,17 @@ nsMsgAccountManager::LoadAccounts()</span>
<a href="#l15.231"></a><span id="l15.231">                                 getter_AddRefs(accountPrefBranch));</span>
<a href="#l15.232"></a><span id="l15.232">     if (accountPrefBranch)</span>
<a href="#l15.233"></a><span id="l15.233">       accountPrefBranch-&gt;DeleteBranch(&quot;&quot;);</span>
<a href="#l15.234"></a><span id="l15.234">   }</span>
<a href="#l15.235"></a><span id="l15.235"> </span>
<a href="#l15.236"></a><span id="l15.236">   // Make sure we have an account that points at the local folders server</span>
<a href="#l15.237"></a><span id="l15.237">   nsCString localFoldersServerKey;</span>
<a href="#l15.238"></a><span id="l15.238">   rv = m_prefs-&gt;GetCharPref(PREF_MAIL_ACCOUNTMANAGER_LOCALFOLDERSSERVER,</span>
<a href="#l15.239"></a><span id="l15.239" class="difflineminus">-                            getter_Copies(localFoldersServerKey));</span>
<a href="#l15.240"></a><span id="l15.240" class="difflineplus">+                            localFoldersServerKey);</span>
<a href="#l15.241"></a><span id="l15.241"> </span>
<a href="#l15.242"></a><span id="l15.242">   if (!localFoldersServerKey.IsEmpty())</span>
<a href="#l15.243"></a><span id="l15.243">   {</span>
<a href="#l15.244"></a><span id="l15.244">     nsCOMPtr&lt;nsIMsgIncomingServer&gt; server;</span>
<a href="#l15.245"></a><span id="l15.245">     rv = GetIncomingServer(localFoldersServerKey, getter_AddRefs(server));</span>
<a href="#l15.246"></a><span id="l15.246">     if (server)</span>
<a href="#l15.247"></a><span id="l15.247">     {</span>
<a href="#l15.248"></a><span id="l15.248">       nsCOMPtr&lt;nsIMsgAccount&gt; localFoldersAccount;</span>
<a href="#l15.249"></a><span id="l15.249" class="difflineat">@@ -1729,17 +1729,17 @@ nsMsgAccountManager::createKeyedAccount(</span>
<a href="#l15.250"></a><span id="l15.250">   // add to string list</span>
<a href="#l15.251"></a><span id="l15.251">   if (mAccountKeyList.IsEmpty())</span>
<a href="#l15.252"></a><span id="l15.252">     mAccountKeyList = key;</span>
<a href="#l15.253"></a><span id="l15.253">   else {</span>
<a href="#l15.254"></a><span id="l15.254">     mAccountKeyList.Append(',');</span>
<a href="#l15.255"></a><span id="l15.255">     mAccountKeyList.Append(key);</span>
<a href="#l15.256"></a><span id="l15.256">   }</span>
<a href="#l15.257"></a><span id="l15.257"> </span>
<a href="#l15.258"></a><span id="l15.258" class="difflineminus">-  m_prefs-&gt;SetCharPref(PREF_MAIL_ACCOUNTMANAGER_ACCOUNTS, mAccountKeyList.get());</span>
<a href="#l15.259"></a><span id="l15.259" class="difflineplus">+  m_prefs-&gt;SetCharPref(PREF_MAIL_ACCOUNTMANAGER_ACCOUNTS, mAccountKeyList);</span>
<a href="#l15.260"></a><span id="l15.260">   account.forget(aAccount);</span>
<a href="#l15.261"></a><span id="l15.261">   return NS_OK;</span>
<a href="#l15.262"></a><span id="l15.262"> }</span>
<a href="#l15.263"></a><span id="l15.263"> </span>
<a href="#l15.264"></a><span id="l15.264"> NS_IMETHODIMP</span>
<a href="#l15.265"></a><span id="l15.265"> nsMsgAccountManager::CreateAccount(nsIMsgAccount **_retval)</span>
<a href="#l15.266"></a><span id="l15.266"> {</span>
<a href="#l15.267"></a><span id="l15.267">   NS_ENSURE_ARG_POINTER(_retval);</span>
<a href="#l15.268"></a><span id="l15.268" class="difflineat">@@ -2227,26 +2227,26 @@ nsMsgAccountManager::RemoveRootFolderLis</span>
<a href="#l15.269"></a><span id="l15.269"> </span>
<a href="#l15.270"></a><span id="l15.270"> NS_IMETHODIMP nsMsgAccountManager::SetLocalFoldersServer(nsIMsgIncomingServer *aServer)</span>
<a href="#l15.271"></a><span id="l15.271"> {</span>
<a href="#l15.272"></a><span id="l15.272">   NS_ENSURE_ARG_POINTER(aServer);</span>
<a href="#l15.273"></a><span id="l15.273">   nsCString key;</span>
<a href="#l15.274"></a><span id="l15.274">   nsresult rv = aServer-&gt;GetKey(key);</span>
<a href="#l15.275"></a><span id="l15.275">   NS_ENSURE_SUCCESS(rv, rv);</span>
<a href="#l15.276"></a><span id="l15.276"> </span>
<a href="#l15.277"></a><span id="l15.277" class="difflineminus">-  return m_prefs-&gt;SetCharPref(PREF_MAIL_ACCOUNTMANAGER_LOCALFOLDERSSERVER, key.get());</span>
<a href="#l15.278"></a><span id="l15.278" class="difflineplus">+  return m_prefs-&gt;SetCharPref(PREF_MAIL_ACCOUNTMANAGER_LOCALFOLDERSSERVER, key);</span>
<a href="#l15.279"></a><span id="l15.279"> }</span>
<a href="#l15.280"></a><span id="l15.280"> </span>
<a href="#l15.281"></a><span id="l15.281"> NS_IMETHODIMP nsMsgAccountManager::GetLocalFoldersServer(nsIMsgIncomingServer **aServer)</span>
<a href="#l15.282"></a><span id="l15.282"> {</span>
<a href="#l15.283"></a><span id="l15.283">   NS_ENSURE_ARG_POINTER(aServer);</span>
<a href="#l15.284"></a><span id="l15.284"> </span>
<a href="#l15.285"></a><span id="l15.285">   nsCString serverKey;</span>
<a href="#l15.286"></a><span id="l15.286"> </span>
<a href="#l15.287"></a><span id="l15.287" class="difflineminus">-  nsresult rv = m_prefs-&gt;GetCharPref(PREF_MAIL_ACCOUNTMANAGER_LOCALFOLDERSSERVER, getter_Copies(serverKey));</span>
<a href="#l15.288"></a><span id="l15.288" class="difflineplus">+  nsresult rv = m_prefs-&gt;GetCharPref(PREF_MAIL_ACCOUNTMANAGER_LOCALFOLDERSSERVER, serverKey);</span>
<a href="#l15.289"></a><span id="l15.289"> </span>
<a href="#l15.290"></a><span id="l15.290">   if (NS_SUCCEEDED(rv) &amp;&amp; !serverKey.IsEmpty())</span>
<a href="#l15.291"></a><span id="l15.291">   {</span>
<a href="#l15.292"></a><span id="l15.292">     rv = GetIncomingServer(serverKey, aServer);</span>
<a href="#l15.293"></a><span id="l15.293">     if (NS_SUCCEEDED(rv))</span>
<a href="#l15.294"></a><span id="l15.294">       return rv;</span>
<a href="#l15.295"></a><span id="l15.295">     // otherwise, we're going to fall through to looking for an existing local</span>
<a href="#l15.296"></a><span id="l15.296">     // folders account, because now we fail creating one if one already exists.</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l16.1"></a><span id="l16.1" class="difflineminus">--- a/mailnews/base/src/nsMsgContentPolicy.cpp</span>
<a href="#l16.2"></a><span id="l16.2" class="difflineplus">+++ b/mailnews/base/src/nsMsgContentPolicy.cpp</span>
<a href="#l16.3"></a><span id="l16.3" class="difflineat">@@ -68,17 +68,17 @@ nsresult nsMsgContentPolicy::Init()</span>
<a href="#l16.4"></a><span id="l16.4">   nsresult rv;</span>
<a href="#l16.5"></a><span id="l16.5"> </span>
<a href="#l16.6"></a><span id="l16.6">   // register ourself as an observer on the mail preference to block remote images</span>
<a href="#l16.7"></a><span id="l16.7">   nsCOMPtr&lt;nsIPrefBranch&gt; prefInternal = do_GetService(NS_PREFSERVICE_CONTRACTID, &amp;rv);</span>
<a href="#l16.8"></a><span id="l16.8">   NS_ENSURE_SUCCESS(rv, rv);</span>
<a href="#l16.9"></a><span id="l16.9"> </span>
<a href="#l16.10"></a><span id="l16.10">   prefInternal-&gt;AddObserver(kBlockRemoteImages, this, true);</span>
<a href="#l16.11"></a><span id="l16.11"> </span>
<a href="#l16.12"></a><span id="l16.12" class="difflineminus">-  prefInternal-&gt;GetCharPref(kTrustedDomains, getter_Copies(mTrustedMailDomains));</span>
<a href="#l16.13"></a><span id="l16.13" class="difflineplus">+  prefInternal-&gt;GetCharPref(kTrustedDomains, mTrustedMailDomains);</span>
<a href="#l16.14"></a><span id="l16.14">   prefInternal-&gt;GetBoolPref(kBlockRemoteImages, &amp;mBlockRemoteImages);</span>
<a href="#l16.15"></a><span id="l16.15"> </span>
<a href="#l16.16"></a><span id="l16.16">   // Grab a handle on the PermissionManager service for managing allowed remote</span>
<a href="#l16.17"></a><span id="l16.17">   // content senders.</span>
<a href="#l16.18"></a><span id="l16.18">   mPermissionManager = do_GetService(NS_PERMISSIONMANAGER_CONTRACTID, &amp;rv);</span>
<a href="#l16.19"></a><span id="l16.19">   NS_ENSURE_SUCCESS(rv, rv);</span>
<a href="#l16.20"></a><span id="l16.20"> </span>
<a href="#l16.21"></a><span id="l16.21">   return NS_OK;</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l17.1"></a><span id="l17.1" class="difflineminus">--- a/mailnews/base/src/nsMsgTagService.cpp</span>
<a href="#l17.2"></a><span id="l17.2" class="difflineplus">+++ b/mailnews/base/src/nsMsgTagService.cpp</span>
<a href="#l17.3"></a><span id="l17.3" class="difflineat">@@ -273,61 +273,61 @@ NS_IMETHODIMP nsMsgTagService::AddTag(co</span>
<a href="#l17.4"></a><span id="l17.4"> /* long getColorForKey (in string key); */</span>
<a href="#l17.5"></a><span id="l17.5"> NS_IMETHODIMP nsMsgTagService::GetColorForKey(const nsACString &amp;key, nsACString  &amp;_retval)</span>
<a href="#l17.6"></a><span id="l17.6"> {</span>
<a href="#l17.7"></a><span id="l17.7">   nsAutoCString prefName(key);</span>
<a href="#l17.8"></a><span id="l17.8">   if (!gMigratingKeys)</span>
<a href="#l17.9"></a><span id="l17.9">     ToLowerCase(prefName);</span>
<a href="#l17.10"></a><span id="l17.10">   prefName.AppendLiteral(TAG_PREF_SUFFIX_COLOR);</span>
<a href="#l17.11"></a><span id="l17.11">   nsCString color;</span>
<a href="#l17.12"></a><span id="l17.12" class="difflineminus">-  nsresult rv = m_tagPrefBranch-&gt;GetCharPref(prefName.get(), getter_Copies(color));</span>
<a href="#l17.13"></a><span id="l17.13" class="difflineplus">+  nsresult rv = m_tagPrefBranch-&gt;GetCharPref(prefName.get(), color);</span>
<a href="#l17.14"></a><span id="l17.14">   if (NS_SUCCEEDED(rv))</span>
<a href="#l17.15"></a><span id="l17.15">     _retval = color;</span>
<a href="#l17.16"></a><span id="l17.16">   return NS_OK;</span>
<a href="#l17.17"></a><span id="l17.17"> }</span>
<a href="#l17.18"></a><span id="l17.18"> </span>
<a href="#l17.19"></a><span id="l17.19"> /* void setColorForKey (in ACString key, in ACString color); */</span>
<a href="#l17.20"></a><span id="l17.20"> NS_IMETHODIMP nsMsgTagService::SetColorForKey(const nsACString &amp; key, const nsACString &amp; color)</span>
<a href="#l17.21"></a><span id="l17.21"> {</span>
<a href="#l17.22"></a><span id="l17.22">   nsAutoCString prefName(key);</span>
<a href="#l17.23"></a><span id="l17.23">   ToLowerCase(prefName);</span>
<a href="#l17.24"></a><span id="l17.24">   prefName.AppendLiteral(TAG_PREF_SUFFIX_COLOR);</span>
<a href="#l17.25"></a><span id="l17.25">   if (color.IsEmpty())</span>
<a href="#l17.26"></a><span id="l17.26">   {</span>
<a href="#l17.27"></a><span id="l17.27">     m_tagPrefBranch-&gt;ClearUserPref(prefName.get());</span>
<a href="#l17.28"></a><span id="l17.28">     return NS_OK;</span>
<a href="#l17.29"></a><span id="l17.29">   }</span>
<a href="#l17.30"></a><span id="l17.30" class="difflineminus">-  return m_tagPrefBranch-&gt;SetCharPref(prefName.get(), nsCString(color).get());</span>
<a href="#l17.31"></a><span id="l17.31" class="difflineplus">+  return m_tagPrefBranch-&gt;SetCharPref(prefName.get(), color);</span>
<a href="#l17.32"></a><span id="l17.32"> }</span>
<a href="#l17.33"></a><span id="l17.33"> </span>
<a href="#l17.34"></a><span id="l17.34"> /* ACString getOrdinalForKey (in ACString key); */</span>
<a href="#l17.35"></a><span id="l17.35"> NS_IMETHODIMP nsMsgTagService::GetOrdinalForKey(const nsACString &amp; key, nsACString &amp; _retval)</span>
<a href="#l17.36"></a><span id="l17.36"> {</span>
<a href="#l17.37"></a><span id="l17.37">   nsAutoCString prefName(key);</span>
<a href="#l17.38"></a><span id="l17.38">   if (!gMigratingKeys)</span>
<a href="#l17.39"></a><span id="l17.39">     ToLowerCase(prefName);</span>
<a href="#l17.40"></a><span id="l17.40">   prefName.AppendLiteral(TAG_PREF_SUFFIX_ORDINAL);</span>
<a href="#l17.41"></a><span id="l17.41">   nsCString ordinal;</span>
<a href="#l17.42"></a><span id="l17.42" class="difflineminus">-  nsresult rv = m_tagPrefBranch-&gt;GetCharPref(prefName.get(), getter_Copies(ordinal));</span>
<a href="#l17.43"></a><span id="l17.43" class="difflineplus">+  nsresult rv = m_tagPrefBranch-&gt;GetCharPref(prefName.get(), ordinal);</span>
<a href="#l17.44"></a><span id="l17.44">   _retval = ordinal;</span>
<a href="#l17.45"></a><span id="l17.45">   return rv;</span>
<a href="#l17.46"></a><span id="l17.46"> }</span>
<a href="#l17.47"></a><span id="l17.47"> </span>
<a href="#l17.48"></a><span id="l17.48"> /* void setOrdinalForKey (in ACString key, in ACString ordinal); */</span>
<a href="#l17.49"></a><span id="l17.49"> NS_IMETHODIMP nsMsgTagService::SetOrdinalForKey(const nsACString &amp; key, const nsACString &amp; ordinal)</span>
<a href="#l17.50"></a><span id="l17.50"> {</span>
<a href="#l17.51"></a><span id="l17.51">   nsAutoCString prefName(key);</span>
<a href="#l17.52"></a><span id="l17.52">   ToLowerCase(prefName);</span>
<a href="#l17.53"></a><span id="l17.53">   prefName.AppendLiteral(TAG_PREF_SUFFIX_ORDINAL);</span>
<a href="#l17.54"></a><span id="l17.54">   if (ordinal.IsEmpty())</span>
<a href="#l17.55"></a><span id="l17.55">   {</span>
<a href="#l17.56"></a><span id="l17.56">     m_tagPrefBranch-&gt;ClearUserPref(prefName.get());</span>
<a href="#l17.57"></a><span id="l17.57">     return NS_OK;</span>
<a href="#l17.58"></a><span id="l17.58">   }</span>
<a href="#l17.59"></a><span id="l17.59" class="difflineminus">-  return m_tagPrefBranch-&gt;SetCharPref(prefName.get(), nsCString(ordinal).get());</span>
<a href="#l17.60"></a><span id="l17.60" class="difflineplus">+  return m_tagPrefBranch-&gt;SetCharPref(prefName.get(), ordinal);</span>
<a href="#l17.61"></a><span id="l17.61"> }</span>
<a href="#l17.62"></a><span id="l17.62"> </span>
<a href="#l17.63"></a><span id="l17.63"> /* void deleteTag (in wstring tag); */</span>
<a href="#l17.64"></a><span id="l17.64"> NS_IMETHODIMP nsMsgTagService::DeleteKey(const nsACString &amp;key)</span>
<a href="#l17.65"></a><span id="l17.65"> {</span>
<a href="#l17.66"></a><span id="l17.66">   // clear the associated prefs</span>
<a href="#l17.67"></a><span id="l17.67">   nsAutoCString prefName(key);</span>
<a href="#l17.68"></a><span id="l17.68">   if (!gMigratingKeys)</span>
<a href="#l17.69"></a><span id="l17.69" class="difflineat">@@ -508,17 +508,17 @@ nsresult nsMsgTagService::MigrateLabelsT</span>
<a href="#l17.70"></a><span id="l17.70">                                      NS_GET_IID(nsIPrefLocalizedString),</span>
<a href="#l17.71"></a><span id="l17.71">                                      getter_AddRefs(pls));</span>
<a href="#l17.72"></a><span id="l17.72">       NS_ENSURE_SUCCESS(rv, rv);</span>
<a href="#l17.73"></a><span id="l17.73">       pls-&gt;ToString(getter_Copies(ucsval));</span>
<a href="#l17.74"></a><span id="l17.74"> </span>
<a href="#l17.75"></a><span id="l17.75">       prefString.Assign(PREF_LABELS_COLOR);</span>
<a href="#l17.76"></a><span id="l17.76">       prefString.AppendInt(i + 1);</span>
<a href="#l17.77"></a><span id="l17.77">       nsCString csval;</span>
<a href="#l17.78"></a><span id="l17.78" class="difflineminus">-      rv = prefRoot-&gt;GetCharPref(prefString.get(), getter_Copies(csval));</span>
<a href="#l17.79"></a><span id="l17.79" class="difflineplus">+      rv = prefRoot-&gt;GetCharPref(prefString.get(), csval);</span>
<a href="#l17.80"></a><span id="l17.80">       NS_ENSURE_SUCCESS(rv, rv);</span>
<a href="#l17.81"></a><span id="l17.81"> </span>
<a href="#l17.82"></a><span id="l17.82">       rv = AddTagForKey(labelKey, ucsval, csval, EmptyCString());</span>
<a href="#l17.83"></a><span id="l17.83">       NS_ENSURE_SUCCESS(rv, rv);</span>
<a href="#l17.84"></a><span id="l17.84">       labelKey.SetCharAt(++i + '1', 6);</span>
<a href="#l17.85"></a><span id="l17.85">     }</span>
<a href="#l17.86"></a><span id="l17.86">   }</span>
<a href="#l17.87"></a><span id="l17.87">   m_tagPrefBranch-&gt;SetIntPref(TAG_PREF_VERSION, 2);</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l18.1"></a><span id="l18.1" class="difflineminus">--- a/mailnews/base/src/nsSpamSettings.cpp</span>
<a href="#l18.2"></a><span id="l18.2" class="difflineplus">+++ b/mailnews/base/src/nsSpamSettings.cpp</span>
<a href="#l18.3"></a><span id="l18.3" class="difflineat">@@ -305,18 +305,17 @@ NS_IMETHODIMP nsSpamSettings::Initialize</span>
<a href="#l18.4"></a><span id="l18.4">   int32_t serverFilterTrustFlags = 0;</span>
<a href="#l18.5"></a><span id="l18.5">   rv = aServer-&gt;GetIntValue(&quot;serverFilterTrustFlags&quot;, &amp;serverFilterTrustFlags);</span>
<a href="#l18.6"></a><span id="l18.6">   NS_ENSURE_SUCCESS(rv, rv);</span>
<a href="#l18.7"></a><span id="l18.7">   rv = SetServerFilterTrustFlags(serverFilterTrustFlags);</span>
<a href="#l18.8"></a><span id="l18.8">   NS_ENSURE_SUCCESS(rv, rv);</span>
<a href="#l18.9"></a><span id="l18.9"> </span>
<a href="#l18.10"></a><span id="l18.10">   nsCOMPtr&lt;nsIPrefBranch&gt; prefBranch(do_GetService(NS_PREFSERVICE_CONTRACTID, &amp;rv));</span>
<a href="#l18.11"></a><span id="l18.11">   if (prefBranch)</span>
<a href="#l18.12"></a><span id="l18.12" class="difflineminus">-    prefBranch-&gt;GetCharPref(&quot;mail.trusteddomains&quot;,</span>
<a href="#l18.13"></a><span id="l18.13" class="difflineminus">-                            getter_Copies(mTrustedMailDomains));</span>
<a href="#l18.14"></a><span id="l18.14" class="difflineplus">+    prefBranch-&gt;GetCharPref(&quot;mail.trusteddomains&quot;, mTrustedMailDomains);</span>
<a href="#l18.15"></a><span id="l18.15"> </span>
<a href="#l18.16"></a><span id="l18.16">   mWhiteListDirArray.Clear();</span>
<a href="#l18.17"></a><span id="l18.17">   if (!mWhiteListAbURI.IsEmpty())</span>
<a href="#l18.18"></a><span id="l18.18">   {</span>
<a href="#l18.19"></a><span id="l18.19">     nsCOMPtr&lt;nsIAbManager&gt; abManager(do_GetService(NS_ABMANAGER_CONTRACTID, &amp;rv));</span>
<a href="#l18.20"></a><span id="l18.20">     NS_ENSURE_SUCCESS(rv, rv);</span>
<a href="#l18.21"></a><span id="l18.21"> </span>
<a href="#l18.22"></a><span id="l18.22">     nsTArray&lt;nsCString&gt; whiteListArray;</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l19.1"></a><span id="l19.1" class="difflineminus">--- a/mailnews/base/src/nsStatusBarBiffManager.cpp</span>
<a href="#l19.2"></a><span id="l19.2" class="difflineplus">+++ b/mailnews/base/src/nsStatusBarBiffManager.cpp</span>
<a href="#l19.3"></a><span id="l19.3" class="difflineat">@@ -108,17 +108,17 @@ nsresult nsStatusBarBiffManager::PlayBif</span>
<a href="#l19.4"></a><span id="l19.4">   int32_t soundType = SYSTEM_SOUND_TYPE;</span>
<a href="#l19.5"></a><span id="l19.5">   rv = pref-&gt;GetIntPref(PREF_SOUND_TYPE, &amp;soundType);</span>
<a href="#l19.6"></a><span id="l19.6">   NS_ENSURE_SUCCESS(rv, rv);</span>
<a href="#l19.7"></a><span id="l19.7"> </span>
<a href="#l19.8"></a><span id="l19.8">   bool customSoundPlayed = false;</span>
<a href="#l19.9"></a><span id="l19.9"> </span>
<a href="#l19.10"></a><span id="l19.10">   if (soundType == CUSTOM_SOUND_TYPE) {</span>
<a href="#l19.11"></a><span id="l19.11">     nsCString soundURLSpec;</span>
<a href="#l19.12"></a><span id="l19.12" class="difflineminus">-    rv = pref-&gt;GetCharPref(PREF_SOUND_URL, getter_Copies(soundURLSpec));</span>
<a href="#l19.13"></a><span id="l19.13" class="difflineplus">+    rv = pref-&gt;GetCharPref(PREF_SOUND_URL, soundURLSpec);</span>
<a href="#l19.14"></a><span id="l19.14"> </span>
<a href="#l19.15"></a><span id="l19.15">     if (NS_SUCCEEDED(rv) &amp;&amp; !soundURLSpec.IsEmpty()) {</span>
<a href="#l19.16"></a><span id="l19.16">       if (!strncmp(soundURLSpec.get(), &quot;file://&quot;, 7)) {</span>
<a href="#l19.17"></a><span id="l19.17">         nsCOMPtr&lt;nsIURI&gt; fileURI;</span>
<a href="#l19.18"></a><span id="l19.18">         rv = NS_NewURI(getter_AddRefs(fileURI), soundURLSpec);</span>
<a href="#l19.19"></a><span id="l19.19">         NS_ENSURE_SUCCESS(rv,rv);</span>
<a href="#l19.20"></a><span id="l19.20">         nsCOMPtr&lt;nsIFileURL&gt; soundURL = do_QueryInterface(fileURI,&amp;rv);</span>
<a href="#l19.21"></a><span id="l19.21">         if (NS_SUCCEEDED(rv)) {</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l20.1"></a><span id="l20.1" class="difflineminus">--- a/mailnews/base/util/nsMsgIdentity.cpp</span>
<a href="#l20.2"></a><span id="l20.2" class="difflineplus">+++ b/mailnews/base/util/nsMsgIdentity.cpp</span>
<a href="#l20.3"></a><span id="l20.3" class="difflineat">@@ -221,17 +221,17 @@ nsMsgIdentity::SetDoBcc(bool aValue)</span>
<a href="#l20.4"></a><span id="l20.4"> </span>
<a href="#l20.5"></a><span id="l20.5"> NS_IMETHODIMP</span>
<a href="#l20.6"></a><span id="l20.6"> nsMsgIdentity::GetDoBccList(nsACString&amp; aValue)</span>
<a href="#l20.7"></a><span id="l20.7"> {</span>
<a href="#l20.8"></a><span id="l20.8">   if (!mPrefBranch)</span>
<a href="#l20.9"></a><span id="l20.9">     return NS_ERROR_NOT_INITIALIZED;</span>
<a href="#l20.10"></a><span id="l20.10"> </span>
<a href="#l20.11"></a><span id="l20.11">   nsCString val;</span>
<a href="#l20.12"></a><span id="l20.12" class="difflineminus">-  nsresult rv = mPrefBranch-&gt;GetCharPref(&quot;doBccList&quot;, getter_Copies(val));</span>
<a href="#l20.13"></a><span id="l20.13" class="difflineplus">+  nsresult rv = mPrefBranch-&gt;GetCharPref(&quot;doBccList&quot;, val);</span>
<a href="#l20.14"></a><span id="l20.14">   aValue = val;</span>
<a href="#l20.15"></a><span id="l20.15">   if (NS_SUCCEEDED(rv))</span>
<a href="#l20.16"></a><span id="l20.16">     return rv;</span>
<a href="#l20.17"></a><span id="l20.17"> </span>
<a href="#l20.18"></a><span id="l20.18">   bool bccSelf = false;</span>
<a href="#l20.19"></a><span id="l20.19">   rv = GetBccSelf(&amp;bccSelf);</span>
<a href="#l20.20"></a><span id="l20.20">   NS_ENSURE_SUCCESS(rv,rv);</span>
<a href="#l20.21"></a><span id="l20.21"> </span>
<a href="#l20.22"></a><span id="l20.22" class="difflineat">@@ -278,17 +278,17 @@ NS_IMPL_IDPREF_BOOL(Valid, &quot;valid&quot;)</span>
<a href="#l20.23"></a><span id="l20.23"> </span>
<a href="#l20.24"></a><span id="l20.24"> nsresult</span>
<a href="#l20.25"></a><span id="l20.25"> nsMsgIdentity::getFolderPref(const char *prefname, nsCString&amp; retval,</span>
<a href="#l20.26"></a><span id="l20.26">                              const char *folderName, uint32_t folderflag)</span>
<a href="#l20.27"></a><span id="l20.27"> {</span>
<a href="#l20.28"></a><span id="l20.28">   if (!mPrefBranch)</span>
<a href="#l20.29"></a><span id="l20.29">     return NS_ERROR_NOT_INITIALIZED;</span>
<a href="#l20.30"></a><span id="l20.30"> </span>
<a href="#l20.31"></a><span id="l20.31" class="difflineminus">-  nsresult rv = mPrefBranch-&gt;GetCharPref(prefname, getter_Copies(retval));</span>
<a href="#l20.32"></a><span id="l20.32" class="difflineplus">+  nsresult rv = mPrefBranch-&gt;GetCharPref(prefname, retval);</span>
<a href="#l20.33"></a><span id="l20.33">   if (NS_SUCCEEDED(rv) &amp;&amp; !retval.IsEmpty()) {</span>
<a href="#l20.34"></a><span id="l20.34">     // get the corresponding RDF resource</span>
<a href="#l20.35"></a><span id="l20.35">     // RDF will create the folder resource if it doesn't already exist</span>
<a href="#l20.36"></a><span id="l20.36">     nsCOMPtr&lt;nsIRDFService&gt; rdf(do_GetService(kRDFServiceCID, &amp;rv));</span>
<a href="#l20.37"></a><span id="l20.37">     if (NS_FAILED(rv)) return rv;</span>
<a href="#l20.38"></a><span id="l20.38">     nsCOMPtr&lt;nsIRDFResource&gt; resource;</span>
<a href="#l20.39"></a><span id="l20.39">     rdf-&gt;GetResource(retval, getter_AddRefs(resource));</span>
<a href="#l20.40"></a><span id="l20.40"> </span>
<a href="#l20.41"></a><span id="l20.41" class="difflineat">@@ -313,17 +313,17 @@ nsMsgIdentity::getFolderPref(const char </span>
<a href="#l20.42"></a><span id="l20.42">           rv = server-&gt;GetMsgFolderFromURI(folderResource, retval, getter_AddRefs(msgFolder));</span>
<a href="#l20.43"></a><span id="l20.43">           return NS_SUCCEEDED(rv) ? msgFolder-&gt;GetURI(retval) : rv;</span>
<a href="#l20.44"></a><span id="l20.44">         }</span>
<a href="#l20.45"></a><span id="l20.45">       }</span>
<a href="#l20.46"></a><span id="l20.46">     }</span>
<a href="#l20.47"></a><span id="l20.47">   }</span>
<a href="#l20.48"></a><span id="l20.48"> </span>
<a href="#l20.49"></a><span id="l20.49">   // if the server doesn't exist, fall back to the default pref.</span>
<a href="#l20.50"></a><span id="l20.50" class="difflineminus">-  rv = mDefPrefBranch-&gt;GetCharPref(prefname, getter_Copies(retval));</span>
<a href="#l20.51"></a><span id="l20.51" class="difflineplus">+  rv = mDefPrefBranch-&gt;GetCharPref(prefname, retval);</span>
<a href="#l20.52"></a><span id="l20.52">   if (NS_SUCCEEDED(rv) &amp;&amp; !retval.IsEmpty())</span>
<a href="#l20.53"></a><span id="l20.53">     return setFolderPref(prefname, retval, folderflag);</span>
<a href="#l20.54"></a><span id="l20.54"> </span>
<a href="#l20.55"></a><span id="l20.55">   // here I think we need to create a uri for the folder on the</span>
<a href="#l20.56"></a><span id="l20.56">   // default server for this identity.</span>
<a href="#l20.57"></a><span id="l20.57">   nsCOMPtr&lt;nsIMsgAccountManager&gt; accountManager =</span>
<a href="#l20.58"></a><span id="l20.58">   do_GetService(NS_MSGACCOUNTMANAGER_CONTRACTID, &amp;rv);</span>
<a href="#l20.59"></a><span id="l20.59">   NS_ENSURE_SUCCESS(rv,rv);</span>
<a href="#l20.60"></a><span id="l20.60" class="difflineat">@@ -390,17 +390,17 @@ nsMsgIdentity::setFolderPref(const char </span>
<a href="#l20.61"></a><span id="l20.61">     {</span>
<a href="#l20.62"></a><span id="l20.62">       nsCOMPtr&lt;nsIMsgIncomingServer&gt; server(do_QueryElementAt(servers, 0, &amp;rv));</span>
<a href="#l20.63"></a><span id="l20.63">       if (NS_SUCCEEDED(rv))</span>
<a href="#l20.64"></a><span id="l20.64">         server-&gt;ClearTemporaryReturnReceiptsFilter(); // okay to fail; no need to check for return code</span>
<a href="#l20.65"></a><span id="l20.65">     }</span>
<a href="#l20.66"></a><span id="l20.66">   }</span>
<a href="#l20.67"></a><span id="l20.67"> </span>
<a href="#l20.68"></a><span id="l20.68">   // get the old folder, and clear the special folder flag on it</span>
<a href="#l20.69"></a><span id="l20.69" class="difflineminus">-  rv = mPrefBranch-&gt;GetCharPref(prefname, getter_Copies(oldpref));</span>
<a href="#l20.70"></a><span id="l20.70" class="difflineplus">+  rv = mPrefBranch-&gt;GetCharPref(prefname, oldpref);</span>
<a href="#l20.71"></a><span id="l20.71">   if (NS_SUCCEEDED(rv) &amp;&amp; !oldpref.IsEmpty())</span>
<a href="#l20.72"></a><span id="l20.72">   {</span>
<a href="#l20.73"></a><span id="l20.73">     rv = rdf-&gt;GetResource(oldpref, getter_AddRefs(res));</span>
<a href="#l20.74"></a><span id="l20.74">     if (NS_SUCCEEDED(rv) &amp;&amp; res)</span>
<a href="#l20.75"></a><span id="l20.75">     {</span>
<a href="#l20.76"></a><span id="l20.76">       folder = do_QueryInterface(res, &amp;rv);</span>
<a href="#l20.77"></a><span id="l20.77">       if (NS_SUCCEEDED(rv))</span>
<a href="#l20.78"></a><span id="l20.78">         rv = folder-&gt;ClearFlag(folderflag);</span>
<a href="#l20.79"></a><span id="l20.79" class="difflineat">@@ -466,30 +466,30 @@ NS_IMETHODIMP nsMsgIdentity::GetUnicharA</span>
<a href="#l20.80"></a><span id="l20.80"> }</span>
<a href="#l20.81"></a><span id="l20.81"> </span>
<a href="#l20.82"></a><span id="l20.82"> NS_IMETHODIMP nsMsgIdentity::SetCharAttribute(const char *aName, const nsACString&amp; val)</span>
<a href="#l20.83"></a><span id="l20.83"> {</span>
<a href="#l20.84"></a><span id="l20.84">   if (!mPrefBranch)</span>
<a href="#l20.85"></a><span id="l20.85">     return NS_ERROR_NOT_INITIALIZED;</span>
<a href="#l20.86"></a><span id="l20.86"> </span>
<a href="#l20.87"></a><span id="l20.87">   if (!val.IsEmpty())</span>
<a href="#l20.88"></a><span id="l20.88" class="difflineminus">-    return mPrefBranch-&gt;SetCharPref(aName, nsCString(val).get());</span>
<a href="#l20.89"></a><span id="l20.89" class="difflineplus">+    return mPrefBranch-&gt;SetCharPref(aName, val);</span>
<a href="#l20.90"></a><span id="l20.90"> </span>
<a href="#l20.91"></a><span id="l20.91">   mPrefBranch-&gt;ClearUserPref(aName);</span>
<a href="#l20.92"></a><span id="l20.92">   return NS_OK;</span>
<a href="#l20.93"></a><span id="l20.93"> }</span>
<a href="#l20.94"></a><span id="l20.94"> </span>
<a href="#l20.95"></a><span id="l20.95"> NS_IMETHODIMP nsMsgIdentity::GetCharAttribute(const char *aName, nsACString&amp; val)</span>
<a href="#l20.96"></a><span id="l20.96"> {</span>
<a href="#l20.97"></a><span id="l20.97">   if (!mPrefBranch)</span>
<a href="#l20.98"></a><span id="l20.98">     return NS_ERROR_NOT_INITIALIZED;</span>
<a href="#l20.99"></a><span id="l20.99"> </span>
<a href="#l20.100"></a><span id="l20.100">   nsCString tmpVal;</span>
<a href="#l20.101"></a><span id="l20.101" class="difflineminus">-  if (NS_FAILED(mPrefBranch-&gt;GetCharPref(aName, getter_Copies(tmpVal))))</span>
<a href="#l20.102"></a><span id="l20.102" class="difflineminus">-    mDefPrefBranch-&gt;GetCharPref(aName, getter_Copies(tmpVal));</span>
<a href="#l20.103"></a><span id="l20.103" class="difflineplus">+  if (NS_FAILED(mPrefBranch-&gt;GetCharPref(aName, tmpVal)))</span>
<a href="#l20.104"></a><span id="l20.104" class="difflineplus">+    mDefPrefBranch-&gt;GetCharPref(aName, tmpVal);</span>
<a href="#l20.105"></a><span id="l20.105">   val = tmpVal;</span>
<a href="#l20.106"></a><span id="l20.106">   return NS_OK;</span>
<a href="#l20.107"></a><span id="l20.107"> }</span>
<a href="#l20.108"></a><span id="l20.108"> </span>
<a href="#l20.109"></a><span id="l20.109"> NS_IMETHODIMP nsMsgIdentity::SetBoolAttribute(const char *aName, bool val)</span>
<a href="#l20.110"></a><span id="l20.110"> {</span>
<a href="#l20.111"></a><span id="l20.111">   if (!mPrefBranch)</span>
<a href="#l20.112"></a><span id="l20.112">     return NS_ERROR_NOT_INITIALIZED;</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l21.1"></a><span id="l21.1" class="difflineminus">--- a/mailnews/base/util/nsMsgIncomingServer.cpp</span>
<a href="#l21.2"></a><span id="l21.2" class="difflineplus">+++ b/mailnews/base/util/nsMsgIncomingServer.cpp</span>
<a href="#l21.3"></a><span id="l21.3" class="difflineat">@@ -504,18 +504,18 @@ nsMsgIncomingServer::SetIntValue(const c</span>
<a href="#l21.4"></a><span id="l21.4"> NS_IMETHODIMP</span>
<a href="#l21.5"></a><span id="l21.5"> nsMsgIncomingServer::GetCharValue(const char *prefname,</span>
<a href="#l21.6"></a><span id="l21.6">                                   nsACString&amp; val)</span>
<a href="#l21.7"></a><span id="l21.7"> {</span>
<a href="#l21.8"></a><span id="l21.8">   if (!mPrefBranch)</span>
<a href="#l21.9"></a><span id="l21.9">     return NS_ERROR_NOT_INITIALIZED;</span>
<a href="#l21.10"></a><span id="l21.10"> </span>
<a href="#l21.11"></a><span id="l21.11">   nsCString tmpVal;</span>
<a href="#l21.12"></a><span id="l21.12" class="difflineminus">-  if (NS_FAILED(mPrefBranch-&gt;GetCharPref(prefname, getter_Copies(tmpVal))))</span>
<a href="#l21.13"></a><span id="l21.13" class="difflineminus">-    mDefPrefBranch-&gt;GetCharPref(prefname, getter_Copies(tmpVal));</span>
<a href="#l21.14"></a><span id="l21.14" class="difflineplus">+  if (NS_FAILED(mPrefBranch-&gt;GetCharPref(prefname, tmpVal)))</span>
<a href="#l21.15"></a><span id="l21.15" class="difflineplus">+    mDefPrefBranch-&gt;GetCharPref(prefname, tmpVal);</span>
<a href="#l21.16"></a><span id="l21.16">   val = tmpVal;</span>
<a href="#l21.17"></a><span id="l21.17">   return NS_OK;</span>
<a href="#l21.18"></a><span id="l21.18"> }</span>
<a href="#l21.19"></a><span id="l21.19"> </span>
<a href="#l21.20"></a><span id="l21.20"> NS_IMETHODIMP</span>
<a href="#l21.21"></a><span id="l21.21"> nsMsgIncomingServer::GetUnicharValue(const char *prefname,</span>
<a href="#l21.22"></a><span id="l21.22">                                      nsAString&amp; val)</span>
<a href="#l21.23"></a><span id="l21.23"> {</span>
<a href="#l21.24"></a><span id="l21.24" class="difflineat">@@ -544,22 +544,22 @@ nsMsgIncomingServer::SetCharValue(const </span>
<a href="#l21.25"></a><span id="l21.25">     return NS_ERROR_NOT_INITIALIZED;</span>
<a href="#l21.26"></a><span id="l21.26"> </span>
<a href="#l21.27"></a><span id="l21.27">   if (val.IsEmpty()) {</span>
<a href="#l21.28"></a><span id="l21.28">     mPrefBranch-&gt;ClearUserPref(prefname);</span>
<a href="#l21.29"></a><span id="l21.29">     return NS_OK;</span>
<a href="#l21.30"></a><span id="l21.30">   }</span>
<a href="#l21.31"></a><span id="l21.31"> </span>
<a href="#l21.32"></a><span id="l21.32">   nsCString defaultVal;</span>
<a href="#l21.33"></a><span id="l21.33" class="difflineminus">-  nsresult rv = mDefPrefBranch-&gt;GetCharPref(prefname, getter_Copies(defaultVal));</span>
<a href="#l21.34"></a><span id="l21.34" class="difflineplus">+  nsresult rv = mDefPrefBranch-&gt;GetCharPref(prefname, defaultVal);</span>
<a href="#l21.35"></a><span id="l21.35"> </span>
<a href="#l21.36"></a><span id="l21.36">   if (NS_SUCCEEDED(rv) &amp;&amp; defaultVal.Equals(val))</span>
<a href="#l21.37"></a><span id="l21.37">     mPrefBranch-&gt;ClearUserPref(prefname);</span>
<a href="#l21.38"></a><span id="l21.38">   else</span>
<a href="#l21.39"></a><span id="l21.39" class="difflineminus">-    rv = mPrefBranch-&gt;SetCharPref(prefname, nsCString(val).get());</span>
<a href="#l21.40"></a><span id="l21.40" class="difflineplus">+    rv = mPrefBranch-&gt;SetCharPref(prefname, val);</span>
<a href="#l21.41"></a><span id="l21.41"> </span>
<a href="#l21.42"></a><span id="l21.42">   return rv;</span>
<a href="#l21.43"></a><span id="l21.43"> }</span>
<a href="#l21.44"></a><span id="l21.44"> </span>
<a href="#l21.45"></a><span id="l21.45"> NS_IMETHODIMP</span>
<a href="#l21.46"></a><span id="l21.46"> nsMsgIncomingServer::SetUnicharValue(const char *prefname,</span>
<a href="#l21.47"></a><span id="l21.47">                                      const nsAString&amp; val)</span>
<a href="#l21.48"></a><span id="l21.48"> {</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l22.1"></a><span id="l22.1" class="difflineminus">--- a/mailnews/compose/public/nsISmtpServer.idl</span>
<a href="#l22.2"></a><span id="l22.2" class="difflineplus">+++ b/mailnews/compose/public/nsISmtpServer.idl</span>
<a href="#l22.3"></a><span id="l22.3" class="difflineat">@@ -68,17 +68,17 @@ interface nsISmtpServer : nsISupports {</span>
<a href="#l22.4"></a><span id="l22.4"> </span>
<a href="#l22.5"></a><span id="l22.5">   /**</span>
<a href="#l22.6"></a><span id="l22.6">    * May contain an alternative argument to EHLO or HELO to provide to the</span>
<a href="#l22.7"></a><span id="l22.7">    * server. Reflects the value of the mail.smtpserver.*.hello_argument pref.</span>
<a href="#l22.8"></a><span id="l22.8">    * This is mainly useful where ISPs don't bother providing PTR records for</span>
<a href="#l22.9"></a><span id="l22.9">    * their servers and therefore users get an error on sending. See bug 244030</span>
<a href="#l22.10"></a><span id="l22.10">    * for more discussion.</span>
<a href="#l22.11"></a><span id="l22.11">    */</span>
<a href="#l22.12"></a><span id="l22.12" class="difflineminus">-  readonly attribute string helloArgument;</span>
<a href="#l22.13"></a><span id="l22.13" class="difflineplus">+  readonly attribute ACString helloArgument;</span>
<a href="#l22.14"></a><span id="l22.14"> </span>
<a href="#l22.15"></a><span id="l22.15">   /// Returns the URI of the server (smtp:///)</span>
<a href="#l22.16"></a><span id="l22.16">   readonly attribute ACString serverURI;</span>
<a href="#l22.17"></a><span id="l22.17"> </span>
<a href="#l22.18"></a><span id="l22.18">   /**</span>
<a href="#l22.19"></a><span id="l22.19">    * Gets a password for this server, using a UI prompt if necessary.</span>
<a href="#l22.20"></a><span id="l22.20">    *</span>
<a href="#l22.21"></a><span id="l22.21">    * @param promptString  The string to prompt the user with when asking for</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l23.1"></a><span id="l23.1" class="difflineminus">--- a/mailnews/compose/src/nsMsgCompUtils.cpp</span>
<a href="#l23.2"></a><span id="l23.2" class="difflineplus">+++ b/mailnews/compose/src/nsMsgCompUtils.cpp</span>
<a href="#l23.3"></a><span id="l23.3" class="difflineat">@@ -1736,26 +1736,26 @@ GetFolderURIFromUserPrefs(nsMsgDeliverMo</span>
<a href="#l23.4"></a><span id="l23.4"> </span>
<a href="#l23.5"></a><span id="l23.5">   // QueueForLater (Outbox)</span>
<a href="#l23.6"></a><span id="l23.6">   if (aMode == nsIMsgSend::nsMsgQueueForLater ||</span>
<a href="#l23.7"></a><span id="l23.7">       aMode == nsIMsgSend::nsMsgDeliverBackground)</span>
<a href="#l23.8"></a><span id="l23.8">   {</span>
<a href="#l23.9"></a><span id="l23.9">     nsCOMPtr&lt;nsIPrefBranch&gt; prefs(do_GetService(NS_PREFSERVICE_CONTRACTID, &amp;rv));</span>
<a href="#l23.10"></a><span id="l23.10">     if (NS_FAILED(rv))</span>
<a href="#l23.11"></a><span id="l23.11">       return;</span>
<a href="#l23.12"></a><span id="l23.12" class="difflineminus">-    rv = prefs-&gt;GetCharPref(&quot;mail.default_sendlater_uri&quot;, getter_Copies(uri));</span>
<a href="#l23.13"></a><span id="l23.13" class="difflineplus">+    rv = prefs-&gt;GetCharPref(&quot;mail.default_sendlater_uri&quot;, uri);</span>
<a href="#l23.14"></a><span id="l23.14">     if (NS_FAILED(rv) || uri.IsEmpty())</span>
<a href="#l23.15"></a><span id="l23.15">       uri.AssignLiteral(ANY_SERVER);</span>
<a href="#l23.16"></a><span id="l23.16">     else</span>
<a href="#l23.17"></a><span id="l23.17">     {</span>
<a href="#l23.18"></a><span id="l23.18">       // check if uri is unescaped, and if so, escape it and reset the pef.</span>
<a href="#l23.19"></a><span id="l23.19">       if (uri.FindChar(' ') != kNotFound)</span>
<a href="#l23.20"></a><span id="l23.20">       {</span>
<a href="#l23.21"></a><span id="l23.21">         MsgReplaceSubstring(uri, &quot; &quot;, &quot;%20&quot;);</span>
<a href="#l23.22"></a><span id="l23.22" class="difflineminus">-        prefs-&gt;SetCharPref(&quot;mail.default_sendlater_uri&quot;, uri.get());</span>
<a href="#l23.23"></a><span id="l23.23" class="difflineplus">+        prefs-&gt;SetCharPref(&quot;mail.default_sendlater_uri&quot;, uri);</span>
<a href="#l23.24"></a><span id="l23.24">       }</span>
<a href="#l23.25"></a><span id="l23.25">     }</span>
<a href="#l23.26"></a><span id="l23.26">     return;</span>
<a href="#l23.27"></a><span id="l23.27">   }</span>
<a href="#l23.28"></a><span id="l23.28"> </span>
<a href="#l23.29"></a><span id="l23.29">   if (!identity)</span>
<a href="#l23.30"></a><span id="l23.30">     return;</span>
<a href="#l23.31"></a><span id="l23.31"> </span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l24.1"></a><span id="l24.1" class="difflineminus">--- a/mailnews/compose/src/nsMsgCompose.cpp</span>
<a href="#l24.2"></a><span id="l24.2" class="difflineplus">+++ b/mailnews/compose/src/nsMsgCompose.cpp</span>
<a href="#l24.3"></a><span id="l24.3" class="difflineat">@@ -2189,17 +2189,17 @@ nsresult nsMsgCompose::CreateMessage(con</span>
<a href="#l24.4"></a><span id="l24.4">               attachment-&gt;SetName(sanitizedSubj);</span>
<a href="#l24.5"></a><span id="l24.5">               attachment-&gt;SetUrl(nsDependentCString(uri));</span>
<a href="#l24.6"></a><span id="l24.6">               m_compFields-&gt;AddAttachment(attachment);</span>
<a href="#l24.7"></a><span id="l24.7">             }</span>
<a href="#l24.8"></a><span id="l24.8"> </span>
<a href="#l24.9"></a><span id="l24.9">             if (isFirstPass)</span>
<a href="#l24.10"></a><span id="l24.10">             {</span>
<a href="#l24.11"></a><span id="l24.11">               nsCString fwdPrefix;</span>
<a href="#l24.12"></a><span id="l24.12" class="difflineminus">-              prefs-&gt;GetCharPref(&quot;mail.forward_subject_prefix&quot;, getter_Copies(fwdPrefix));</span>
<a href="#l24.13"></a><span id="l24.13" class="difflineplus">+              prefs-&gt;GetCharPref(&quot;mail.forward_subject_prefix&quot;, fwdPrefix);</span>
<a href="#l24.14"></a><span id="l24.14">               if (!fwdPrefix.IsEmpty())</span>
<a href="#l24.15"></a><span id="l24.15">               {</span>
<a href="#l24.16"></a><span id="l24.16">                 nsString unicodeFwdPrefix;</span>
<a href="#l24.17"></a><span id="l24.17">                 CopyUTF8toUTF16(fwdPrefix, unicodeFwdPrefix);</span>
<a href="#l24.18"></a><span id="l24.18">                 unicodeFwdPrefix.AppendLiteral(&quot;: &quot;);</span>
<a href="#l24.19"></a><span id="l24.19">                 subject.Insert(unicodeFwdPrefix, 0);</span>
<a href="#l24.20"></a><span id="l24.20">               }</span>
<a href="#l24.21"></a><span id="l24.21">               else</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l25.1"></a><span id="l25.1" class="difflineminus">--- a/mailnews/compose/src/nsMsgComposeService.cpp</span>
<a href="#l25.2"></a><span id="l25.2" class="difflineplus">+++ b/mailnews/compose/src/nsMsgComposeService.cpp</span>
<a href="#l25.3"></a><span id="l25.3" class="difflineat">@@ -277,17 +277,17 @@ nsMsgComposeService::GetOrigWindowSelect</span>
<a href="#l25.4"></a><span id="l25.4">   NS_ENSURE_TRUE(domWindow, NS_ERROR_FAILURE);</span>
<a href="#l25.5"></a><span id="l25.5">   nsCOMPtr&lt;nsPIDOMWindowOuter&gt; privateWindow = nsPIDOMWindowOuter::From(domWindow);</span>
<a href="#l25.6"></a><span id="l25.6">   nsCOMPtr&lt;nsISelection&gt; sel = privateWindow-&gt;GetSelection();</span>
<a href="#l25.7"></a><span id="l25.7">   NS_ENSURE_TRUE(sel, NS_ERROR_FAILURE);</span>
<a href="#l25.8"></a><span id="l25.8"> </span>
<a href="#l25.9"></a><span id="l25.9">   bool requireMultipleWords = true;</span>
<a href="#l25.10"></a><span id="l25.10">   nsAutoCString charsOnlyIf;</span>
<a href="#l25.11"></a><span id="l25.11">   prefs-&gt;GetBoolPref(PREF_MAILNEWS_REPLY_QUOTING_SELECTION_MULTI_WORD, &amp;requireMultipleWords);</span>
<a href="#l25.12"></a><span id="l25.12" class="difflineminus">-  prefs-&gt;GetCharPref(PREF_MAILNEWS_REPLY_QUOTING_SELECTION_ONLY_IF, getter_Copies(charsOnlyIf));</span>
<a href="#l25.13"></a><span id="l25.13" class="difflineplus">+  prefs-&gt;GetCharPref(PREF_MAILNEWS_REPLY_QUOTING_SELECTION_ONLY_IF, charsOnlyIf);</span>
<a href="#l25.14"></a><span id="l25.14">   if (sel &amp;&amp; (requireMultipleWords || !charsOnlyIf.IsEmpty()))</span>
<a href="#l25.15"></a><span id="l25.15">   {</span>
<a href="#l25.16"></a><span id="l25.16">     nsAutoString selPlain;</span>
<a href="#l25.17"></a><span id="l25.17">     rv = sel-&gt;ToString(selPlain);</span>
<a href="#l25.18"></a><span id="l25.18">     NS_ENSURE_SUCCESS(rv, rv);</span>
<a href="#l25.19"></a><span id="l25.19"> </span>
<a href="#l25.20"></a><span id="l25.20">     // If &quot;mailnews.reply_quoting_selection.multi_word&quot; is on, then there must be at least</span>
<a href="#l25.21"></a><span id="l25.21">     // two words selected in order to quote just the selected text</span>
<a href="#l25.22"></a><span id="l25.22" class="difflineat">@@ -1115,33 +1115,33 @@ nsresult nsMsgComposeService::AddGlobalH</span>
<a href="#l25.23"></a><span id="l25.23"> </span>
<a href="#l25.24"></a><span id="l25.24">   rv = defaultsPrefBranch-&gt;GetIntPref(HTMLDOMAINUPDATE_VERSION_PREF_NAME, &amp;htmlDomainListDefaultVersion);</span>
<a href="#l25.25"></a><span id="l25.25">   NS_ENSURE_SUCCESS(rv,rv);</span>
<a href="#l25.26"></a><span id="l25.26"> </span>
<a href="#l25.27"></a><span id="l25.27">   // Update the list as needed</span>
<a href="#l25.28"></a><span id="l25.28">   if (htmlDomainListCurrentVersion &lt;= htmlDomainListDefaultVersion) {</span>
<a href="#l25.29"></a><span id="l25.29">     // Get list of global domains need to be added</span>
<a href="#l25.30"></a><span id="l25.30">     nsCString globalHtmlDomainList;</span>
<a href="#l25.31"></a><span id="l25.31" class="difflineminus">-    rv = prefBranch-&gt;GetCharPref(HTMLDOMAINUPDATE_DOMAINLIST_PREF_NAME, getter_Copies(globalHtmlDomainList));</span>
<a href="#l25.32"></a><span id="l25.32" class="difflineplus">+    rv = prefBranch-&gt;GetCharPref(HTMLDOMAINUPDATE_DOMAINLIST_PREF_NAME, globalHtmlDomainList);</span>
<a href="#l25.33"></a><span id="l25.33"> </span>
<a href="#l25.34"></a><span id="l25.34">     if (NS_SUCCEEDED(rv) &amp;&amp; !globalHtmlDomainList.IsEmpty()) {</span>
<a href="#l25.35"></a><span id="l25.35">       nsTArray&lt;nsCString&gt; domainArray;</span>
<a href="#l25.36"></a><span id="l25.36"> </span>
<a href="#l25.37"></a><span id="l25.37">       // Get user's current HTML domain set for send format</span>
<a href="#l25.38"></a><span id="l25.38">       nsCString currentHtmlDomainList;</span>
<a href="#l25.39"></a><span id="l25.39" class="difflineminus">-      rv = prefBranch-&gt;GetCharPref(USER_CURRENT_HTMLDOMAINLIST_PREF_NAME, getter_Copies(currentHtmlDomainList));</span>
<a href="#l25.40"></a><span id="l25.40" class="difflineplus">+      rv = prefBranch-&gt;GetCharPref(USER_CURRENT_HTMLDOMAINLIST_PREF_NAME, currentHtmlDomainList);</span>
<a href="#l25.41"></a><span id="l25.41">       NS_ENSURE_SUCCESS(rv,rv);</span>
<a href="#l25.42"></a><span id="l25.42"> </span>
<a href="#l25.43"></a><span id="l25.43">       nsAutoCString newHtmlDomainList(currentHtmlDomainList);</span>
<a href="#l25.44"></a><span id="l25.44">       // Get the current html domain list into new list var</span>
<a href="#l25.45"></a><span id="l25.45">       ParseString(currentHtmlDomainList, DOMAIN_DELIMITER, domainArray);</span>
<a href="#l25.46"></a><span id="l25.46"> </span>
<a href="#l25.47"></a><span id="l25.47">       // Get user's current Plaintext domain set for send format</span>
<a href="#l25.48"></a><span id="l25.48">       nsCString currentPlaintextDomainList;</span>
<a href="#l25.49"></a><span id="l25.49" class="difflineminus">-      rv = prefBranch-&gt;GetCharPref(USER_CURRENT_PLAINTEXTDOMAINLIST_PREF_NAME, getter_Copies(currentPlaintextDomainList));</span>
<a href="#l25.50"></a><span id="l25.50" class="difflineplus">+      rv = prefBranch-&gt;GetCharPref(USER_CURRENT_PLAINTEXTDOMAINLIST_PREF_NAME, currentPlaintextDomainList);</span>
<a href="#l25.51"></a><span id="l25.51">       NS_ENSURE_SUCCESS(rv,rv);</span>
<a href="#l25.52"></a><span id="l25.52"> </span>
<a href="#l25.53"></a><span id="l25.53">       // Get the current plaintext domain list into new list var</span>
<a href="#l25.54"></a><span id="l25.54">       ParseString(currentPlaintextDomainList, DOMAIN_DELIMITER, domainArray);</span>
<a href="#l25.55"></a><span id="l25.55"> </span>
<a href="#l25.56"></a><span id="l25.56">       size_t i = domainArray.Length();</span>
<a href="#l25.57"></a><span id="l25.57">       if (i &gt; 0) {</span>
<a href="#l25.58"></a><span id="l25.58">         // Append each domain in the preconfigured html domain list</span>
<a href="#l25.59"></a><span id="l25.59" class="difflineat">@@ -1161,17 +1161,17 @@ nsresult nsMsgComposeService::AddGlobalH</span>
<a href="#l25.60"></a><span id="l25.60">       else</span>
<a href="#l25.61"></a><span id="l25.61">       {</span>
<a href="#l25.62"></a><span id="l25.62">         // User has no domains listed either in html or plain text category.</span>
<a href="#l25.63"></a><span id="l25.63">         // Assign the global list to be the user's current html domain list</span>
<a href="#l25.64"></a><span id="l25.64">         newHtmlDomainList = globalHtmlDomainList;</span>
<a href="#l25.65"></a><span id="l25.65">       }</span>
<a href="#l25.66"></a><span id="l25.66"> </span>
<a href="#l25.67"></a><span id="l25.67">       // Set user's html domain pref with the updated list</span>
<a href="#l25.68"></a><span id="l25.68" class="difflineminus">-      rv = prefBranch-&gt;SetCharPref(USER_CURRENT_HTMLDOMAINLIST_PREF_NAME, newHtmlDomainList.get());</span>
<a href="#l25.69"></a><span id="l25.69" class="difflineplus">+      rv = prefBranch-&gt;SetCharPref(USER_CURRENT_HTMLDOMAINLIST_PREF_NAME, newHtmlDomainList);</span>
<a href="#l25.70"></a><span id="l25.70">       NS_ENSURE_SUCCESS(rv,rv);</span>
<a href="#l25.71"></a><span id="l25.71"> </span>
<a href="#l25.72"></a><span id="l25.72">       // Increase the version to avoid running the update code unless needed (based on default version)</span>
<a href="#l25.73"></a><span id="l25.73">       rv = prefBranch-&gt;SetIntPref(HTMLDOMAINUPDATE_VERSION_PREF_NAME, htmlDomainListCurrentVersion + 1);</span>
<a href="#l25.74"></a><span id="l25.74">       NS_ENSURE_SUCCESS(rv,rv);</span>
<a href="#l25.75"></a><span id="l25.75">     }</span>
<a href="#l25.76"></a><span id="l25.76">   }</span>
<a href="#l25.77"></a><span id="l25.77">   return NS_OK;</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l26.1"></a><span id="l26.1" class="difflineminus">--- a/mailnews/compose/src/nsSmtpProtocol.cpp</span>
<a href="#l26.2"></a><span id="l26.2" class="difflineplus">+++ b/mailnews/compose/src/nsSmtpProtocol.cpp</span>
<a href="#l26.3"></a><span id="l26.3" class="difflineat">@@ -283,17 +283,17 @@ nsresult nsSmtpProtocol::Initialize(nsIU</span>
<a href="#l26.4"></a><span id="l26.4">     // ** may want to consider caching the server capability to save lots of</span>
<a href="#l26.5"></a><span id="l26.5">     // round trip communication between the client and server</span>
<a href="#l26.6"></a><span id="l26.6">     int32_t authMethod = 0;</span>
<a href="#l26.7"></a><span id="l26.7">     nsCOMPtr&lt;nsISmtpServer&gt; smtpServer;</span>
<a href="#l26.8"></a><span id="l26.8">     m_runningURL-&gt;GetSmtpServer(getter_AddRefs(smtpServer));</span>
<a href="#l26.9"></a><span id="l26.9">     if (smtpServer) {</span>
<a href="#l26.10"></a><span id="l26.10">         smtpServer-&gt;GetAuthMethod(&amp;authMethod);</span>
<a href="#l26.11"></a><span id="l26.11">         smtpServer-&gt;GetSocketType(&amp;m_prefSocketType);</span>
<a href="#l26.12"></a><span id="l26.12" class="difflineminus">-        smtpServer-&gt;GetHelloArgument(getter_Copies(m_helloArgument));</span>
<a href="#l26.13"></a><span id="l26.13" class="difflineplus">+        smtpServer-&gt;GetHelloArgument(m_helloArgument);</span>
<a href="#l26.14"></a><span id="l26.14"> </span>
<a href="#l26.15"></a><span id="l26.15">         // Query for OAuth2 support. If the SMTP server preferences don't allow</span>
<a href="#l26.16"></a><span id="l26.16">         // for OAuth2, then don't carry around the OAuth2 module any longer</span>
<a href="#l26.17"></a><span id="l26.17">         // since we won't need it.</span>
<a href="#l26.18"></a><span id="l26.18">         mOAuth2Support = do_CreateInstance(MSGIOAUTH2MODULE_CONTRACTID);</span>
<a href="#l26.19"></a><span id="l26.19">         if (mOAuth2Support)</span>
<a href="#l26.20"></a><span id="l26.20">         {</span>
<a href="#l26.21"></a><span id="l26.21">           bool supportsOAuth = false;</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l27.1"></a><span id="l27.1" class="difflineminus">--- a/mailnews/compose/src/nsSmtpServer.cpp</span>
<a href="#l27.2"></a><span id="l27.2" class="difflineplus">+++ b/mailnews/compose/src/nsSmtpServer.cpp</span>
<a href="#l27.3"></a><span id="l27.3" class="difflineat">@@ -80,51 +80,51 @@ nsresult nsSmtpServer::getPrefs()</span>
<a href="#l27.4"></a><span id="l27.4"> </span>
<a href="#l27.5"></a><span id="l27.5">     return NS_OK;</span>
<a href="#l27.6"></a><span id="l27.6"> }</span>
<a href="#l27.7"></a><span id="l27.7"> </span>
<a href="#l27.8"></a><span id="l27.8"> NS_IMETHODIMP</span>
<a href="#l27.9"></a><span id="l27.9"> nsSmtpServer::GetHostname(nsACString &amp;aHostname)</span>
<a href="#l27.10"></a><span id="l27.10"> {</span>
<a href="#l27.11"></a><span id="l27.11">   nsCString result;</span>
<a href="#l27.12"></a><span id="l27.12" class="difflineminus">-  nsresult rv = mPrefBranch-&gt;GetCharPref(&quot;hostname&quot;, getter_Copies(result));</span>
<a href="#l27.13"></a><span id="l27.13" class="difflineplus">+  nsresult rv = mPrefBranch-&gt;GetCharPref(&quot;hostname&quot;, result);</span>
<a href="#l27.14"></a><span id="l27.14">   if (NS_FAILED(rv))</span>
<a href="#l27.15"></a><span id="l27.15">     aHostname.Truncate();</span>
<a href="#l27.16"></a><span id="l27.16">   else</span>
<a href="#l27.17"></a><span id="l27.17">     aHostname = result;</span>
<a href="#l27.18"></a><span id="l27.18"> </span>
<a href="#l27.19"></a><span id="l27.19">   return NS_OK;</span>
<a href="#l27.20"></a><span id="l27.20"> }</span>
<a href="#l27.21"></a><span id="l27.21"> </span>
<a href="#l27.22"></a><span id="l27.22"> NS_IMETHODIMP</span>
<a href="#l27.23"></a><span id="l27.23"> nsSmtpServer::SetHostname(const nsACString &amp;aHostname)</span>
<a href="#l27.24"></a><span id="l27.24"> {</span>
<a href="#l27.25"></a><span id="l27.25">   if (!aHostname.IsEmpty())</span>
<a href="#l27.26"></a><span id="l27.26" class="difflineminus">-    return mPrefBranch-&gt;SetCharPref(&quot;hostname&quot;, PromiseFlatCString(aHostname).get());</span>
<a href="#l27.27"></a><span id="l27.27" class="difflineplus">+    return mPrefBranch-&gt;SetCharPref(&quot;hostname&quot;, aHostname);</span>
<a href="#l27.28"></a><span id="l27.28"> </span>
<a href="#l27.29"></a><span id="l27.29">   // If the pref value is already empty, ClearUserPref will return</span>
<a href="#l27.30"></a><span id="l27.30">   // NS_ERROR_UNEXPECTED, so don't check the rv here.</span>
<a href="#l27.31"></a><span id="l27.31">   mPrefBranch-&gt;ClearUserPref(&quot;hostname&quot;);</span>
<a href="#l27.32"></a><span id="l27.32">   return NS_OK;</span>
<a href="#l27.33"></a><span id="l27.33"> }</span>
<a href="#l27.34"></a><span id="l27.34"> </span>
<a href="#l27.35"></a><span id="l27.35"> NS_IMETHODIMP</span>
<a href="#l27.36"></a><span id="l27.36"> nsSmtpServer::GetDescription(nsACString &amp;aDescription)</span>
<a href="#l27.37"></a><span id="l27.37"> {</span>
<a href="#l27.38"></a><span id="l27.38">     nsCString temp;</span>
<a href="#l27.39"></a><span id="l27.39" class="difflineminus">-    mPrefBranch-&gt;GetCharPref(&quot;description&quot;, getter_Copies(temp));</span>
<a href="#l27.40"></a><span id="l27.40" class="difflineplus">+    mPrefBranch-&gt;GetCharPref(&quot;description&quot;, temp);</span>
<a href="#l27.41"></a><span id="l27.41">     aDescription.Assign(temp);</span>
<a href="#l27.42"></a><span id="l27.42">     return NS_OK;</span>
<a href="#l27.43"></a><span id="l27.43"> }</span>
<a href="#l27.44"></a><span id="l27.44"> </span>
<a href="#l27.45"></a><span id="l27.45"> NS_IMETHODIMP</span>
<a href="#l27.46"></a><span id="l27.46"> nsSmtpServer::SetDescription(const nsACString &amp;aDescription)</span>
<a href="#l27.47"></a><span id="l27.47"> {</span>
<a href="#l27.48"></a><span id="l27.48">     if (!aDescription.IsEmpty())</span>
<a href="#l27.49"></a><span id="l27.49" class="difflineminus">-        return mPrefBranch-&gt;SetCharPref(&quot;description&quot;, PromiseFlatCString(aDescription).get());</span>
<a href="#l27.50"></a><span id="l27.50" class="difflineplus">+        return mPrefBranch-&gt;SetCharPref(&quot;description&quot;, aDescription);</span>
<a href="#l27.51"></a><span id="l27.51">     else</span>
<a href="#l27.52"></a><span id="l27.52">         mPrefBranch-&gt;ClearUserPref(&quot;description&quot;);</span>
<a href="#l27.53"></a><span id="l27.53">     return NS_OK;</span>
<a href="#l27.54"></a><span id="l27.54"> }</span>
<a href="#l27.55"></a><span id="l27.55"> </span>
<a href="#l27.56"></a><span id="l27.56"> // if GetPort returns 0, it means default port</span>
<a href="#l27.57"></a><span id="l27.57"> NS_IMETHODIMP</span>
<a href="#l27.58"></a><span id="l27.58"> nsSmtpServer::GetPort(int32_t *aPort)</span>
<a href="#l27.59"></a><span id="l27.59" class="difflineat">@@ -147,17 +147,17 @@ nsSmtpServer::SetPort(int32_t aPort)</span>
<a href="#l27.60"></a><span id="l27.60"> </span>
<a href="#l27.61"></a><span id="l27.61"> NS_IMETHODIMP</span>
<a href="#l27.62"></a><span id="l27.62"> nsSmtpServer::GetDisplayname(char * *aDisplayname)</span>
<a href="#l27.63"></a><span id="l27.63"> {</span>
<a href="#l27.64"></a><span id="l27.64">     nsresult rv;</span>
<a href="#l27.65"></a><span id="l27.65">     NS_ENSURE_ARG_POINTER(aDisplayname);</span>
<a href="#l27.66"></a><span id="l27.66"> </span>
<a href="#l27.67"></a><span id="l27.67">     nsCString hostname;</span>
<a href="#l27.68"></a><span id="l27.68" class="difflineminus">-    rv = mPrefBranch-&gt;GetCharPref(&quot;hostname&quot;, getter_Copies(hostname));</span>
<a href="#l27.69"></a><span id="l27.69" class="difflineplus">+    rv = mPrefBranch-&gt;GetCharPref(&quot;hostname&quot;, hostname);</span>
<a href="#l27.70"></a><span id="l27.70">     if (NS_FAILED(rv)) {</span>
<a href="#l27.71"></a><span id="l27.71">         *aDisplayname=nullptr;</span>
<a href="#l27.72"></a><span id="l27.72">         return NS_OK;</span>
<a href="#l27.73"></a><span id="l27.73">     }</span>
<a href="#l27.74"></a><span id="l27.74">     int32_t port;</span>
<a href="#l27.75"></a><span id="l27.75">     rv = mPrefBranch-&gt;GetIntPref(&quot;port&quot;, &amp;port);</span>
<a href="#l27.76"></a><span id="l27.76">     if (NS_FAILED(rv))</span>
<a href="#l27.77"></a><span id="l27.77">         port = 0;</span>
<a href="#l27.78"></a><span id="l27.78" class="difflineat">@@ -181,26 +181,25 @@ nsSmtpServer::GetSocketType(int32_t *soc</span>
<a href="#l27.79"></a><span id="l27.79"> </span>
<a href="#l27.80"></a><span id="l27.80"> NS_IMETHODIMP</span>
<a href="#l27.81"></a><span id="l27.81"> nsSmtpServer::SetSocketType(int32_t socketType)</span>
<a href="#l27.82"></a><span id="l27.82"> {</span>
<a href="#l27.83"></a><span id="l27.83">     return mPrefBranch-&gt;SetIntPref(&quot;try_ssl&quot;, socketType);</span>
<a href="#l27.84"></a><span id="l27.84"> }</span>
<a href="#l27.85"></a><span id="l27.85"> </span>
<a href="#l27.86"></a><span id="l27.86"> NS_IMETHODIMP</span>
<a href="#l27.87"></a><span id="l27.87" class="difflineminus">-nsSmtpServer::GetHelloArgument(char * *aHelloArgument)</span>
<a href="#l27.88"></a><span id="l27.88" class="difflineplus">+nsSmtpServer::GetHelloArgument(nsACString&amp; aHelloArgument)</span>
<a href="#l27.89"></a><span id="l27.89"> {</span>
<a href="#l27.90"></a><span id="l27.90">     nsresult rv;</span>
<a href="#l27.91"></a><span id="l27.91" class="difflineminus">-    NS_ENSURE_ARG_POINTER(aHelloArgument);</span>
<a href="#l27.92"></a><span id="l27.92">     rv = mPrefBranch-&gt;GetCharPref(&quot;hello_argument&quot;, aHelloArgument);</span>
<a href="#l27.93"></a><span id="l27.93">     if (NS_FAILED(rv))</span>
<a href="#l27.94"></a><span id="l27.94">     {</span>
<a href="#l27.95"></a><span id="l27.95">         rv = mDefPrefBranch-&gt;GetCharPref(&quot;hello_argument&quot;, aHelloArgument);</span>
<a href="#l27.96"></a><span id="l27.96">         if (NS_FAILED(rv))</span>
<a href="#l27.97"></a><span id="l27.97" class="difflineminus">-            *aHelloArgument = nullptr;</span>
<a href="#l27.98"></a><span id="l27.98" class="difflineplus">+            aHelloArgument.Truncate();</span>
<a href="#l27.99"></a><span id="l27.99">     }</span>
<a href="#l27.100"></a><span id="l27.100">     return NS_OK;</span>
<a href="#l27.101"></a><span id="l27.101"> }</span>
<a href="#l27.102"></a><span id="l27.102"> </span>
<a href="#l27.103"></a><span id="l27.103"> NS_IMETHODIMP</span>
<a href="#l27.104"></a><span id="l27.104"> nsSmtpServer::GetAuthMethod(int32_t *authMethod)</span>
<a href="#l27.105"></a><span id="l27.105"> {</span>
<a href="#l27.106"></a><span id="l27.106">   NS_ENSURE_ARG_POINTER(authMethod);</span>
<a href="#l27.107"></a><span id="l27.107" class="difflineat">@@ -228,29 +227,29 @@ nsSmtpServer::SetAuthMethod(int32_t auth</span>
<a href="#l27.108"></a><span id="l27.108"> {</span>
<a href="#l27.109"></a><span id="l27.109">     return mPrefBranch-&gt;SetIntPref(&quot;authMethod&quot;, authMethod);</span>
<a href="#l27.110"></a><span id="l27.110"> }</span>
<a href="#l27.111"></a><span id="l27.111"> </span>
<a href="#l27.112"></a><span id="l27.112"> NS_IMETHODIMP</span>
<a href="#l27.113"></a><span id="l27.113"> nsSmtpServer::GetUsername(nsACString &amp;aUsername)</span>
<a href="#l27.114"></a><span id="l27.114"> {</span>
<a href="#l27.115"></a><span id="l27.115">   nsCString result;</span>
<a href="#l27.116"></a><span id="l27.116" class="difflineminus">-  nsresult rv = mPrefBranch-&gt;GetCharPref(&quot;username&quot;, getter_Copies(result));</span>
<a href="#l27.117"></a><span id="l27.117" class="difflineplus">+  nsresult rv = mPrefBranch-&gt;GetCharPref(&quot;username&quot;, result);</span>
<a href="#l27.118"></a><span id="l27.118">   if (NS_FAILED(rv))</span>
<a href="#l27.119"></a><span id="l27.119">     aUsername.Truncate();</span>
<a href="#l27.120"></a><span id="l27.120">   else</span>
<a href="#l27.121"></a><span id="l27.121">     aUsername = result;</span>
<a href="#l27.122"></a><span id="l27.122">   return NS_OK;</span>
<a href="#l27.123"></a><span id="l27.123"> }</span>
<a href="#l27.124"></a><span id="l27.124"> </span>
<a href="#l27.125"></a><span id="l27.125"> NS_IMETHODIMP</span>
<a href="#l27.126"></a><span id="l27.126"> nsSmtpServer::SetUsername(const nsACString &amp;aUsername)</span>
<a href="#l27.127"></a><span id="l27.127"> {</span>
<a href="#l27.128"></a><span id="l27.128">   if (!aUsername.IsEmpty())</span>
<a href="#l27.129"></a><span id="l27.129" class="difflineminus">-    return mPrefBranch-&gt;SetCharPref(&quot;username&quot;, PromiseFlatCString(aUsername).get());</span>
<a href="#l27.130"></a><span id="l27.130" class="difflineplus">+    return mPrefBranch-&gt;SetCharPref(&quot;username&quot;, aUsername);</span>
<a href="#l27.131"></a><span id="l27.131"> </span>
<a href="#l27.132"></a><span id="l27.132">   // If the pref value is already empty, ClearUserPref will return</span>
<a href="#l27.133"></a><span id="l27.133">   // NS_ERROR_UNEXPECTED, so don't check the rv here.</span>
<a href="#l27.134"></a><span id="l27.134">   mPrefBranch-&gt;ClearUserPref(&quot;username&quot;);</span>
<a href="#l27.135"></a><span id="l27.135">   return NS_OK;</span>
<a href="#l27.136"></a><span id="l27.136"> }</span>
<a href="#l27.137"></a><span id="l27.137"> </span>
<a href="#l27.138"></a><span id="l27.138"> NS_IMETHODIMP</span>
<a href="#l27.139"></a><span id="l27.139" class="difflineat">@@ -271,17 +270,17 @@ nsSmtpServer::GetPassword(nsAString&amp; aPa</span>
<a href="#l27.140"></a><span id="l27.140">       // if this is set, and we don't find an exact match of user and host name,</span>
<a href="#l27.141"></a><span id="l27.141">       // we'll accept a match of username and domain, where domain</span>
<a href="#l27.142"></a><span id="l27.142">       // is everything after the first '.'</span>
<a href="#l27.143"></a><span id="l27.143">       // user_pref(&quot;mail.smtp.useMatchingDomainServer&quot;, true);</span>
<a href="#l27.144"></a><span id="l27.144"> </span>
<a href="#l27.145"></a><span id="l27.145">       nsCString accountKey;</span>
<a href="#l27.146"></a><span id="l27.146">       bool useMatchingHostNameServer = false;</span>
<a href="#l27.147"></a><span id="l27.147">       bool useMatchingDomainServer = false;</span>
<a href="#l27.148"></a><span id="l27.148" class="difflineminus">-      mPrefBranch-&gt;GetCharPref(&quot;incomingAccount&quot;, getter_Copies(accountKey));</span>
<a href="#l27.149"></a><span id="l27.149" class="difflineplus">+      mPrefBranch-&gt;GetCharPref(&quot;incomingAccount&quot;, accountKey);</span>
<a href="#l27.150"></a><span id="l27.150"> </span>
<a href="#l27.151"></a><span id="l27.151">       nsCOMPtr&lt;nsIMsgAccountManager&gt; accountManager = do_GetService(NS_MSGACCOUNTMANAGER_CONTRACTID);</span>
<a href="#l27.152"></a><span id="l27.152">       nsCOMPtr&lt;nsIMsgIncomingServer&gt; incomingServerToUse;</span>
<a href="#l27.153"></a><span id="l27.153">       if (accountManager)</span>
<a href="#l27.154"></a><span id="l27.154">       {</span>
<a href="#l27.155"></a><span id="l27.155">         if (!accountKey.IsEmpty())</span>
<a href="#l27.156"></a><span id="l27.156">           accountManager-&gt;GetIncomingServer(accountKey, getter_AddRefs(incomingServerToUse));</span>
<a href="#l27.157"></a><span id="l27.157">         else</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l28.1"></a><span id="l28.1" class="difflineminus">--- a/mailnews/compose/src/nsSmtpService.cpp</span>
<a href="#l28.2"></a><span id="l28.2" class="difflineplus">+++ b/mailnews/compose/src/nsSmtpService.cpp</span>
<a href="#l28.3"></a><span id="l28.3" class="difflineat">@@ -391,17 +391,17 @@ nsSmtpService::loadSmtpServers()</span>
<a href="#l28.4"></a><span id="l28.4">   if (NS_FAILED(rv))</span>
<a href="#l28.5"></a><span id="l28.5">     return rv;</span>
<a href="#l28.6"></a><span id="l28.6">   nsCOMPtr&lt;nsIPrefBranch&gt; prefRootBranch;</span>
<a href="#l28.7"></a><span id="l28.7">   prefService-&gt;GetBranch(nullptr, getter_AddRefs(prefRootBranch));</span>
<a href="#l28.8"></a><span id="l28.8">   if (NS_FAILED(rv))</span>
<a href="#l28.9"></a><span id="l28.9">     return rv;</span>
<a href="#l28.10"></a><span id="l28.10"> </span>
<a href="#l28.11"></a><span id="l28.11">   nsCString serverList;</span>
<a href="#l28.12"></a><span id="l28.12" class="difflineminus">-  rv = prefRootBranch-&gt;GetCharPref(PREF_MAIL_SMTPSERVERS, getter_Copies(serverList));</span>
<a href="#l28.13"></a><span id="l28.13" class="difflineplus">+  rv = prefRootBranch-&gt;GetCharPref(PREF_MAIL_SMTPSERVERS, serverList);</span>
<a href="#l28.14"></a><span id="l28.14">   serverList.StripWhitespace();</span>
<a href="#l28.15"></a><span id="l28.15"> </span>
<a href="#l28.16"></a><span id="l28.16">   nsTArray&lt;nsCString&gt; servers;</span>
<a href="#l28.17"></a><span id="l28.17">   ParseString(serverList, SERVER_DELIMITER, servers);</span>
<a href="#l28.18"></a><span id="l28.18"> </span>
<a href="#l28.19"></a><span id="l28.19">   /**</span>
<a href="#l28.20"></a><span id="l28.20">    * Check to see if we need to add pre-configured smtp servers.</span>
<a href="#l28.21"></a><span id="l28.21">    * Following prefs are important to note in understanding the procedure here.</span>
<a href="#l28.22"></a><span id="l28.22" class="difflineat">@@ -432,17 +432,17 @@ nsSmtpService::loadSmtpServers()</span>
<a href="#l28.23"></a><span id="l28.23"> </span>
<a href="#l28.24"></a><span id="l28.24">   rv = defaultsPrefBranch-&gt;GetIntPref(APPEND_SERVERS_VERSION_PREF_NAME, &amp;appendSmtpServersDefaultVersion);</span>
<a href="#l28.25"></a><span id="l28.25">   NS_ENSURE_SUCCESS(rv,rv);</span>
<a href="#l28.26"></a><span id="l28.26"> </span>
<a href="#l28.27"></a><span id="l28.27">   // Update the smtp server list if needed</span>
<a href="#l28.28"></a><span id="l28.28">   if (appendSmtpServersCurrentVersion &lt;= appendSmtpServersDefaultVersion) {</span>
<a href="#l28.29"></a><span id="l28.29">     // If there are pre-configured servers, add them to the existing server list</span>
<a href="#l28.30"></a><span id="l28.30">     nsCString appendServerList;</span>
<a href="#l28.31"></a><span id="l28.31" class="difflineminus">-    rv = prefRootBranch-&gt;GetCharPref(PREF_MAIL_SMTPSERVERS_APPEND_SERVERS, getter_Copies(appendServerList));</span>
<a href="#l28.32"></a><span id="l28.32" class="difflineplus">+    rv = prefRootBranch-&gt;GetCharPref(PREF_MAIL_SMTPSERVERS_APPEND_SERVERS, appendServerList);</span>
<a href="#l28.33"></a><span id="l28.33">     appendServerList.StripWhitespace();</span>
<a href="#l28.34"></a><span id="l28.34">     ParseString(appendServerList, SERVER_DELIMITER, servers);</span>
<a href="#l28.35"></a><span id="l28.35"> </span>
<a href="#l28.36"></a><span id="l28.36">     // Increase the version number so that updates will happen as and when needed</span>
<a href="#l28.37"></a><span id="l28.37">     prefBranch-&gt;SetIntPref(APPEND_SERVERS_VERSION_PREF_NAME, appendSmtpServersCurrentVersion + 1);</span>
<a href="#l28.38"></a><span id="l28.38">   }</span>
<a href="#l28.39"></a><span id="l28.39"> </span>
<a href="#l28.40"></a><span id="l28.40">   // use GetServerByKey to check if the key (pref) is already in</span>
<a href="#l28.41"></a><span id="l28.41" class="difflineat">@@ -462,17 +462,17 @@ nsSmtpService::loadSmtpServers()</span>
<a href="#l28.42"></a><span id="l28.42"> // save the list of keys</span>
<a href="#l28.43"></a><span id="l28.43"> nsresult</span>
<a href="#l28.44"></a><span id="l28.44"> nsSmtpService::saveKeyList()</span>
<a href="#l28.45"></a><span id="l28.45"> {</span>
<a href="#l28.46"></a><span id="l28.46">     nsresult rv;</span>
<a href="#l28.47"></a><span id="l28.47">     nsCOMPtr&lt;nsIPrefBranch&gt; prefBranch(do_GetService(NS_PREFSERVICE_CONTRACTID, &amp;rv));</span>
<a href="#l28.48"></a><span id="l28.48">     if (NS_FAILED(rv)) return rv;</span>
<a href="#l28.49"></a><span id="l28.49"> </span>
<a href="#l28.50"></a><span id="l28.50" class="difflineminus">-    return prefBranch-&gt;SetCharPref(PREF_MAIL_SMTPSERVERS, mServerKeyList.get());</span>
<a href="#l28.51"></a><span id="l28.51" class="difflineplus">+    return prefBranch-&gt;SetCharPref(PREF_MAIL_SMTPSERVERS, mServerKeyList);</span>
<a href="#l28.52"></a><span id="l28.52"> }</span>
<a href="#l28.53"></a><span id="l28.53"> </span>
<a href="#l28.54"></a><span id="l28.54"> nsresult</span>
<a href="#l28.55"></a><span id="l28.55"> nsSmtpService::createKeyedServer(const char *key, nsISmtpServer** aResult)</span>
<a href="#l28.56"></a><span id="l28.56"> {</span>
<a href="#l28.57"></a><span id="l28.57">     if (!key) return NS_ERROR_NULL_POINTER;</span>
<a href="#l28.58"></a><span id="l28.58"> </span>
<a href="#l28.59"></a><span id="l28.59">     nsresult rv;</span>
<a href="#l28.60"></a><span id="l28.60" class="difflineat">@@ -525,17 +525,17 @@ nsSmtpService::GetDefaultServer(nsISmtpS</span>
<a href="#l28.61"></a><span id="l28.61">   // always returns NS_OK, just leaving *aServer at nullptr</span>
<a href="#l28.62"></a><span id="l28.62">   if (!mDefaultSmtpServer) {</span>
<a href="#l28.63"></a><span id="l28.63">       nsresult rv;</span>
<a href="#l28.64"></a><span id="l28.64">       nsCOMPtr&lt;nsIPrefBranch&gt; prefBranch(do_GetService(NS_PREFSERVICE_CONTRACTID, &amp;rv));</span>
<a href="#l28.65"></a><span id="l28.65">       if (NS_FAILED(rv)) return rv;</span>
<a href="#l28.66"></a><span id="l28.66"> </span>
<a href="#l28.67"></a><span id="l28.67">       // try to get it from the prefs</span>
<a href="#l28.68"></a><span id="l28.68">       nsCString defaultServerKey;</span>
<a href="#l28.69"></a><span id="l28.69" class="difflineminus">-      rv = prefBranch-&gt;GetCharPref(PREF_MAIL_SMTP_DEFAULTSERVER, getter_Copies(defaultServerKey));</span>
<a href="#l28.70"></a><span id="l28.70" class="difflineplus">+      rv = prefBranch-&gt;GetCharPref(PREF_MAIL_SMTP_DEFAULTSERVER, defaultServerKey);</span>
<a href="#l28.71"></a><span id="l28.71">       if (NS_SUCCEEDED(rv) &amp;&amp;</span>
<a href="#l28.72"></a><span id="l28.72">           !defaultServerKey.IsEmpty()) {</span>
<a href="#l28.73"></a><span id="l28.73"> </span>
<a href="#l28.74"></a><span id="l28.74">           nsCOMPtr&lt;nsISmtpServer&gt; server;</span>
<a href="#l28.75"></a><span id="l28.75">           rv = GetServerByKey(defaultServerKey.get(),</span>
<a href="#l28.76"></a><span id="l28.76">                               getter_AddRefs(mDefaultSmtpServer));</span>
<a href="#l28.77"></a><span id="l28.77">       } else {</span>
<a href="#l28.78"></a><span id="l28.78">         // no pref set, so just return the first one, and set the pref</span>
<a href="#l28.79"></a><span id="l28.79" class="difflineat">@@ -551,17 +551,17 @@ nsSmtpService::GetDefaultServer(nsISmtpS</span>
<a href="#l28.80"></a><span id="l28.80"> </span>
<a href="#l28.81"></a><span id="l28.81">         mDefaultSmtpServer = mSmtpServers[0];</span>
<a href="#l28.82"></a><span id="l28.82">         NS_ENSURE_TRUE(mDefaultSmtpServer, NS_ERROR_NULL_POINTER);</span>
<a href="#l28.83"></a><span id="l28.83"> </span>
<a href="#l28.84"></a><span id="l28.84">         // now we have a default server, set the prefs correctly</span>
<a href="#l28.85"></a><span id="l28.85">         nsCString serverKey;</span>
<a href="#l28.86"></a><span id="l28.86">         mDefaultSmtpServer-&gt;GetKey(getter_Copies(serverKey));</span>
<a href="#l28.87"></a><span id="l28.87">         if (NS_SUCCEEDED(rv))</span>
<a href="#l28.88"></a><span id="l28.88" class="difflineminus">-          prefBranch-&gt;SetCharPref(PREF_MAIL_SMTP_DEFAULTSERVER, serverKey.get());</span>
<a href="#l28.89"></a><span id="l28.89" class="difflineplus">+          prefBranch-&gt;SetCharPref(PREF_MAIL_SMTP_DEFAULTSERVER, serverKey);</span>
<a href="#l28.90"></a><span id="l28.90">       }</span>
<a href="#l28.91"></a><span id="l28.91">   }</span>
<a href="#l28.92"></a><span id="l28.92"> </span>
<a href="#l28.93"></a><span id="l28.93">   // at this point:</span>
<a href="#l28.94"></a><span id="l28.94">   // * mDefaultSmtpServer has a valid server</span>
<a href="#l28.95"></a><span id="l28.95">   // * the key has been set in the prefs</span>
<a href="#l28.96"></a><span id="l28.96"> </span>
<a href="#l28.97"></a><span id="l28.97">   NS_IF_ADDREF(*aServer = mDefaultSmtpServer);</span>
<a href="#l28.98"></a><span id="l28.98" class="difflineat">@@ -577,17 +577,17 @@ nsSmtpService::SetDefaultServer(nsISmtpS</span>
<a href="#l28.99"></a><span id="l28.99">     mDefaultSmtpServer = aServer;</span>
<a href="#l28.100"></a><span id="l28.100"> </span>
<a href="#l28.101"></a><span id="l28.101">     nsCString serverKey;</span>
<a href="#l28.102"></a><span id="l28.102">     nsresult rv = aServer-&gt;GetKey(getter_Copies(serverKey));</span>
<a href="#l28.103"></a><span id="l28.103">     NS_ENSURE_SUCCESS(rv,rv);</span>
<a href="#l28.104"></a><span id="l28.104"> </span>
<a href="#l28.105"></a><span id="l28.105">     nsCOMPtr&lt;nsIPrefBranch&gt; prefBranch(do_GetService(NS_PREFSERVICE_CONTRACTID, &amp;rv));</span>
<a href="#l28.106"></a><span id="l28.106">     NS_ENSURE_SUCCESS(rv,rv);</span>
<a href="#l28.107"></a><span id="l28.107" class="difflineminus">-    prefBranch-&gt;SetCharPref(PREF_MAIL_SMTP_DEFAULTSERVER, serverKey.get());</span>
<a href="#l28.108"></a><span id="l28.108" class="difflineplus">+    prefBranch-&gt;SetCharPref(PREF_MAIL_SMTP_DEFAULTSERVER, serverKey);</span>
<a href="#l28.109"></a><span id="l28.109">     return NS_OK;</span>
<a href="#l28.110"></a><span id="l28.110"> }</span>
<a href="#l28.111"></a><span id="l28.111"> </span>
<a href="#l28.112"></a><span id="l28.112"> bool</span>
<a href="#l28.113"></a><span id="l28.113"> nsSmtpService::findServerByKey(nsISmtpServer *aServer, void *aData)</span>
<a href="#l28.114"></a><span id="l28.114"> {</span>
<a href="#l28.115"></a><span id="l28.115">   findServerByKeyEntry *entry = (findServerByKeyEntry*) aData;</span>
<a href="#l28.116"></a><span id="l28.116"> </span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l29.1"></a><span id="l29.1" class="difflineminus">--- a/mailnews/extensions/bayesian-spam-filter/src/nsBayesianFilter.cpp</span>
<a href="#l29.2"></a><span id="l29.2" class="difflineplus">+++ b/mailnews/extensions/bayesian-spam-filter/src/nsBayesianFilter.cpp</span>
<a href="#l29.3"></a><span id="l29.3" class="difflineat">@@ -249,23 +249,23 @@ Tokenizer::Tokenizer() :</span>
<a href="#l29.4"></a><span id="l29.4">    * set with the following preferences for the body and header</span>
<a href="#l29.5"></a><span id="l29.5">    * separately.</span>
<a href="#l29.6"></a><span id="l29.6">    *</span>
<a href="#l29.7"></a><span id="l29.7">    * \t, \n, \v, \f, \r, and \\ will be escaped to their normal</span>
<a href="#l29.8"></a><span id="l29.8">    * C-library values, all other two-letter combinations beginning with \</span>
<a href="#l29.9"></a><span id="l29.9">    * will be ignored.</span>
<a href="#l29.10"></a><span id="l29.10">    */</span>
<a href="#l29.11"></a><span id="l29.11"> </span>
<a href="#l29.12"></a><span id="l29.12" class="difflineminus">-  prefBranch-&gt;GetCharPref(&quot;body_delimiters&quot;, getter_Copies(mBodyDelimiters));</span>
<a href="#l29.13"></a><span id="l29.13" class="difflineplus">+  prefBranch-&gt;GetCharPref(&quot;body_delimiters&quot;, mBodyDelimiters);</span>
<a href="#l29.14"></a><span id="l29.14">   if (!mBodyDelimiters.IsEmpty())</span>
<a href="#l29.15"></a><span id="l29.15">     UnescapeCString(mBodyDelimiters);</span>
<a href="#l29.16"></a><span id="l29.16">   else // prefBranch empties the result when it fails :(</span>
<a href="#l29.17"></a><span id="l29.17">     mBodyDelimiters.Assign(kBayesianFilterTokenDelimiters);</span>
<a href="#l29.18"></a><span id="l29.18"> </span>
<a href="#l29.19"></a><span id="l29.19" class="difflineminus">-  prefBranch-&gt;GetCharPref(&quot;header_delimiters&quot;, getter_Copies(mHeaderDelimiters));</span>
<a href="#l29.20"></a><span id="l29.20" class="difflineplus">+  prefBranch-&gt;GetCharPref(&quot;header_delimiters&quot;, mHeaderDelimiters);</span>
<a href="#l29.21"></a><span id="l29.21">   if (!mHeaderDelimiters.IsEmpty())</span>
<a href="#l29.22"></a><span id="l29.22">     UnescapeCString(mHeaderDelimiters);</span>
<a href="#l29.23"></a><span id="l29.23">   else</span>
<a href="#l29.24"></a><span id="l29.24">     mHeaderDelimiters.Assign(kBayesianFilterTokenDelimiters);</span>
<a href="#l29.25"></a><span id="l29.25"> </span>
<a href="#l29.26"></a><span id="l29.26">   /*</span>
<a href="#l29.27"></a><span id="l29.27">    * Extensions may wish to enable or disable tokenization of certain headers.</span>
<a href="#l29.28"></a><span id="l29.28">    * Define any headers to enable/disable in a string preference like this:</span>
<a href="#l29.29"></a><span id="l29.29" class="difflineat">@@ -309,17 +309,17 @@ Tokenizer::Tokenizer() :</span>
<a href="#l29.30"></a><span id="l29.30">     rv = prefBranch-&gt;GetChildList(&quot;&quot;, &amp;count, &amp;headers);</span>
<a href="#l29.31"></a><span id="l29.31"> </span>
<a href="#l29.32"></a><span id="l29.32">   if (NS_SUCCEEDED(rv))</span>
<a href="#l29.33"></a><span id="l29.33">   {</span>
<a href="#l29.34"></a><span id="l29.34">     mCustomHeaderTokenization = true;</span>
<a href="#l29.35"></a><span id="l29.35">     for (uint32_t i = 0; i &lt; count; i++)</span>
<a href="#l29.36"></a><span id="l29.36">     {</span>
<a href="#l29.37"></a><span id="l29.37">       nsCString value;</span>
<a href="#l29.38"></a><span id="l29.38" class="difflineminus">-      prefBranch-&gt;GetCharPref(headers[i], getter_Copies(value));</span>
<a href="#l29.39"></a><span id="l29.39" class="difflineplus">+      prefBranch-&gt;GetCharPref(headers[i], value);</span>
<a href="#l29.40"></a><span id="l29.40">       if (value.EqualsLiteral(&quot;false&quot;))</span>
<a href="#l29.41"></a><span id="l29.41">       {</span>
<a href="#l29.42"></a><span id="l29.42">         mDisabledHeaders.AppendElement(headers[i]);</span>
<a href="#l29.43"></a><span id="l29.43">         continue;</span>
<a href="#l29.44"></a><span id="l29.44">       }</span>
<a href="#l29.45"></a><span id="l29.45">       mEnabledHeaders.AppendElement(headers[i]);</span>
<a href="#l29.46"></a><span id="l29.46">       if (value.EqualsLiteral(&quot;standard&quot;))</span>
<a href="#l29.47"></a><span id="l29.47">         value.SetIsVoid(true); // Void means use default delimiter</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l30.1"></a><span id="l30.1" class="difflineminus">--- a/mailnews/imap/src/nsImapMailFolder.cpp</span>
<a href="#l30.2"></a><span id="l30.2" class="difflineplus">+++ b/mailnews/imap/src/nsImapMailFolder.cpp</span>
<a href="#l30.3"></a><span id="l30.3" class="difflineat">@@ -7441,20 +7441,20 @@ void nsImapMailFolder::SetPendingAttribu</span>
<a href="#l30.4"></a><span id="l30.4"> </span>
<a href="#l30.5"></a><span id="l30.5">   nsCString dontPreserve;</span>
<a href="#l30.6"></a><span id="l30.6"> </span>
<a href="#l30.7"></a><span id="l30.7">   // These preferences exist so that extensions can control which properties</span>
<a href="#l30.8"></a><span id="l30.8">   // are preserved in the database when a message is moved or copied. All</span>
<a href="#l30.9"></a><span id="l30.9">   // properties are preserved except those listed in these preferences</span>
<a href="#l30.10"></a><span id="l30.10">   if (aIsMove)</span>
<a href="#l30.11"></a><span id="l30.11">     prefBranch-&gt;GetCharPref(&quot;mailnews.database.summary.dontPreserveOnMove&quot;,</span>
<a href="#l30.12"></a><span id="l30.12" class="difflineminus">-                            getter_Copies(dontPreserve));</span>
<a href="#l30.13"></a><span id="l30.13" class="difflineplus">+                            dontPreserve);</span>
<a href="#l30.14"></a><span id="l30.14">   else</span>
<a href="#l30.15"></a><span id="l30.15">     prefBranch-&gt;GetCharPref(&quot;mailnews.database.summary.dontPreserveOnCopy&quot;,</span>
<a href="#l30.16"></a><span id="l30.16" class="difflineminus">-                            getter_Copies(dontPreserve));</span>
<a href="#l30.17"></a><span id="l30.17" class="difflineplus">+                            dontPreserve);</span>
<a href="#l30.18"></a><span id="l30.18"> </span>
<a href="#l30.19"></a><span id="l30.19">   // We'll add spaces at beginning and end so we can search for space-name-space</span>
<a href="#l30.20"></a><span id="l30.20">   nsCString dontPreserveEx(NS_LITERAL_CSTRING(&quot; &quot;));</span>
<a href="#l30.21"></a><span id="l30.21">   dontPreserveEx.Append(dontPreserve);</span>
<a href="#l30.22"></a><span id="l30.22">   dontPreserveEx.Append(' ');</span>
<a href="#l30.23"></a><span id="l30.23"> </span>
<a href="#l30.24"></a><span id="l30.24">   // these properties are set as integers below, so don't set them again</span>
<a href="#l30.25"></a><span id="l30.25">   // in the iteration through the properties</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l31.1"></a><span id="l31.1" class="difflineminus">--- a/mailnews/imap/src/nsImapProtocol.cpp</span>
<a href="#l31.2"></a><span id="l31.2" class="difflineplus">+++ b/mailnews/imap/src/nsImapProtocol.cpp</span>
<a href="#l31.3"></a><span id="l31.3" class="difflineat">@@ -363,17 +363,17 @@ nsresult nsImapProtocol::GlobalInitializ</span>
<a href="#l31.4"></a><span id="l31.4">                              &amp;gExpungeAfterDelete);</span>
<a href="#l31.5"></a><span id="l31.5">     aPrefBranch-&gt;GetBoolPref(&quot;mail.imap.check_deleted_before_expunge&quot;,</span>
<a href="#l31.6"></a><span id="l31.6">                              &amp;gCheckDeletedBeforeExpunge);</span>
<a href="#l31.7"></a><span id="l31.7">     aPrefBranch-&gt;GetIntPref(&quot;mail.imap.expunge_option&quot;, &amp;gExpungeOption);</span>
<a href="#l31.8"></a><span id="l31.8">     aPrefBranch-&gt;GetIntPref(&quot;mail.imap.expunge_threshold_number&quot;,</span>
<a href="#l31.9"></a><span id="l31.9">                             &amp;gExpungeThreshold);</span>
<a href="#l31.10"></a><span id="l31.10">     aPrefBranch-&gt;GetIntPref(&quot;mailnews.tcptimeout&quot;, &amp;gResponseTimeout);</span>
<a href="#l31.11"></a><span id="l31.11">     aPrefBranch-&gt;GetCharPref(&quot;mail.imap.force_select_detect&quot;,</span>
<a href="#l31.12"></a><span id="l31.12" class="difflineminus">-                             getter_Copies(gForceSelectDetect));</span>
<a href="#l31.13"></a><span id="l31.13" class="difflineplus">+                             gForceSelectDetect);</span>
<a href="#l31.14"></a><span id="l31.14">     ParseString(gForceSelectDetect, ';', gForceSelectServersArray);</span>
<a href="#l31.15"></a><span id="l31.15"> </span>
<a href="#l31.16"></a><span id="l31.16">     nsCOMPtr&lt;nsIXULAppInfo&gt; appInfo(do_GetService(XULAPPINFO_SERVICE_CONTRACTID));</span>
<a href="#l31.17"></a><span id="l31.17"> </span>
<a href="#l31.18"></a><span id="l31.18">     if (appInfo)</span>
<a href="#l31.19"></a><span id="l31.19">     {</span>
<a href="#l31.20"></a><span id="l31.20">       nsCString appName, appVersion;</span>
<a href="#l31.21"></a><span id="l31.21">       appInfo-&gt;GetName(appName);</span>
<a href="#l31.22"></a><span id="l31.22" class="difflineat">@@ -426,25 +426,23 @@ nsImapProtocol::nsImapProtocol() : nsMsg</span>
<a href="#l31.23"></a><span id="l31.23">     nsCOMPtr&lt;nsIPrefLocalizedString&gt; prefString;</span>
<a href="#l31.24"></a><span id="l31.24">     prefBranch-&gt;GetComplexValue(&quot;intl.accept_languages&quot;,</span>
<a href="#l31.25"></a><span id="l31.25">                                 NS_GET_IID(nsIPrefLocalizedString),</span>
<a href="#l31.26"></a><span id="l31.26">                                 getter_AddRefs(prefString));</span>
<a href="#l31.27"></a><span id="l31.27">     if (prefString)</span>
<a href="#l31.28"></a><span id="l31.28">       prefString-&gt;ToString(getter_Copies(mAcceptLanguages));</span>
<a href="#l31.29"></a><span id="l31.29"> </span>
<a href="#l31.30"></a><span id="l31.30">     nsCString customDBHeaders;</span>
<a href="#l31.31"></a><span id="l31.31" class="difflineminus">-    prefBranch-&gt;GetCharPref(&quot;mailnews.customDBHeaders&quot;,</span>
<a href="#l31.32"></a><span id="l31.32" class="difflineminus">-                            getter_Copies(customDBHeaders));</span>
<a href="#l31.33"></a><span id="l31.33" class="difflineplus">+    prefBranch-&gt;GetCharPref(&quot;mailnews.customDBHeaders&quot;, customDBHeaders);</span>
<a href="#l31.34"></a><span id="l31.34"> </span>
<a href="#l31.35"></a><span id="l31.35">     ParseString(customDBHeaders, ' ', mCustomDBHeaders);</span>
<a href="#l31.36"></a><span id="l31.36">     prefBranch-&gt;GetBoolPref(&quot;mailnews.display.prefer_plaintext&quot;, &amp;m_preferPlainText);</span>
<a href="#l31.37"></a><span id="l31.37"> </span>
<a href="#l31.38"></a><span id="l31.38" class="difflineminus">-    nsAutoCString customHeaders;;</span>
<a href="#l31.39"></a><span id="l31.39" class="difflineminus">-    prefBranch-&gt;GetCharPref(&quot;mailnews.customHeaders&quot;,</span>
<a href="#l31.40"></a><span id="l31.40" class="difflineminus">-                            getter_Copies(customHeaders));</span>
<a href="#l31.41"></a><span id="l31.41" class="difflineplus">+    nsAutoCString customHeaders;</span>
<a href="#l31.42"></a><span id="l31.42" class="difflineplus">+    prefBranch-&gt;GetCharPref(&quot;mailnews.customHeaders&quot;, customHeaders);</span>
<a href="#l31.43"></a><span id="l31.43">     customHeaders.StripWhitespace();</span>
<a href="#l31.44"></a><span id="l31.44">     ParseString(customHeaders, ':', mCustomHeaders);</span>
<a href="#l31.45"></a><span id="l31.45">   }</span>
<a href="#l31.46"></a><span id="l31.46"> </span>
<a href="#l31.47"></a><span id="l31.47">     // ***** Thread support *****</span>
<a href="#l31.48"></a><span id="l31.48">   m_thread = nullptr;</span>
<a href="#l31.49"></a><span id="l31.49">   m_imapThreadIsRunning = false;</span>
<a href="#l31.50"></a><span id="l31.50">   m_currentServerCommandTagNumber = 0;</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l32.1"></a><span id="l32.1" class="difflineminus">--- a/mailnews/import/text/src/nsTextImport.cpp</span>
<a href="#l32.2"></a><span id="l32.2" class="difflineplus">+++ b/mailnews/import/text/src/nsTextImport.cpp</span>
<a href="#l32.3"></a><span id="l32.3" class="difflineat">@@ -598,18 +598,18 @@ NS_IMETHODIMP ImportAddressImpl::InitFie</span>
<a href="#l32.4"></a><span id="l32.4"> {</span>
<a href="#l32.5"></a><span id="l32.5">   // Let's remember the last one the user used!</span>
<a href="#l32.6"></a><span id="l32.6">   // This should be normal for someone importing multiple times, it's usually</span>
<a href="#l32.7"></a><span id="l32.7">   // from the same file format.</span>
<a href="#l32.8"></a><span id="l32.8"> </span>
<a href="#l32.9"></a><span id="l32.9">   nsresult rv;</span>
<a href="#l32.10"></a><span id="l32.10">   nsCOMPtr&lt;nsIPrefBranch&gt; prefs(do_GetService(NS_PREFSERVICE_CONTRACTID, &amp;rv));</span>
<a href="#l32.11"></a><span id="l32.11">   if (NS_SUCCEEDED(rv)) {</span>
<a href="#l32.12"></a><span id="l32.12" class="difflineminus">-    nsCString  prefStr;</span>
<a href="#l32.13"></a><span id="l32.13" class="difflineminus">-    rv = prefs-&gt;GetCharPref(&quot;mailnews.import.text.fieldmap&quot;, getter_Copies(prefStr));</span>
<a href="#l32.14"></a><span id="l32.14" class="difflineplus">+    nsCString prefStr;</span>
<a href="#l32.15"></a><span id="l32.15" class="difflineplus">+    rv = prefs-&gt;GetCharPref(&quot;mailnews.import.text.fieldmap&quot;, prefStr);</span>
<a href="#l32.16"></a><span id="l32.16">     if (NS_SUCCEEDED(rv)) {</span>
<a href="#l32.17"></a><span id="l32.17">       const char *pStr = prefStr.get();</span>
<a href="#l32.18"></a><span id="l32.18">       if (pStr) {</span>
<a href="#l32.19"></a><span id="l32.19">         fieldMap-&gt;SetFieldMapSize(0);</span>
<a href="#l32.20"></a><span id="l32.20">         long fNum;</span>
<a href="#l32.21"></a><span id="l32.21">         bool active;</span>
<a href="#l32.22"></a><span id="l32.22">         long fIndex = 0;</span>
<a href="#l32.23"></a><span id="l32.23">         while (*pStr) {</span>
<a href="#l32.24"></a><span id="l32.24" class="difflineat">@@ -683,19 +683,19 @@ void ImportAddressImpl::SaveFieldMap(nsI</span>
<a href="#l32.25"></a><span id="l32.25">     str.Append(',');</span>
<a href="#l32.26"></a><span id="l32.26">   }</span>
<a href="#l32.27"></a><span id="l32.27"> </span>
<a href="#l32.28"></a><span id="l32.28">   nsresult rv;</span>
<a href="#l32.29"></a><span id="l32.29">   nsCOMPtr&lt;nsIPrefBranch&gt; prefs(do_GetService(NS_PREFSERVICE_CONTRACTID, &amp;rv));</span>
<a href="#l32.30"></a><span id="l32.30"> </span>
<a href="#l32.31"></a><span id="l32.31">   if (NS_SUCCEEDED(rv)) {</span>
<a href="#l32.32"></a><span id="l32.32">     nsCString prefStr;</span>
<a href="#l32.33"></a><span id="l32.33" class="difflineminus">-    rv = prefs-&gt;GetCharPref(&quot;mailnews.import.text.fieldmap&quot;, getter_Copies(prefStr));</span>
<a href="#l32.34"></a><span id="l32.34" class="difflineplus">+    rv = prefs-&gt;GetCharPref(&quot;mailnews.import.text.fieldmap&quot;, prefStr);</span>
<a href="#l32.35"></a><span id="l32.35">     if (NS_FAILED(rv) || !str.Equals(prefStr))</span>
<a href="#l32.36"></a><span id="l32.36" class="difflineminus">-      rv = prefs-&gt;SetCharPref(&quot;mailnews.import.text.fieldmap&quot;, str.get());</span>
<a href="#l32.37"></a><span id="l32.37" class="difflineplus">+      rv = prefs-&gt;SetCharPref(&quot;mailnews.import.text.fieldmap&quot;, str);</span>
<a href="#l32.38"></a><span id="l32.38">   }</span>
<a href="#l32.39"></a><span id="l32.39"> </span>
<a href="#l32.40"></a><span id="l32.40">   // Now also save last used skip first record value.</span>
<a href="#l32.41"></a><span id="l32.41">   bool skipFirstRecord = false;</span>
<a href="#l32.42"></a><span id="l32.42">   rv = pMap-&gt;GetSkipFirstRecord(&amp;skipFirstRecord);</span>
<a href="#l32.43"></a><span id="l32.43">   if (NS_SUCCEEDED(rv))</span>
<a href="#l32.44"></a><span id="l32.44">     prefs-&gt;SetBoolPref(&quot;mailnews.import.text.skipfirstrecord&quot;, skipFirstRecord);</span>
<a href="#l32.45"></a><span id="l32.45"> }</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l33.1"></a><span id="l33.1" class="difflineminus">--- a/mailnews/local/src/nsLocalMailFolder.cpp</span>
<a href="#l33.2"></a><span id="l33.2" class="difflineplus">+++ b/mailnews/local/src/nsLocalMailFolder.cpp</span>
<a href="#l33.3"></a><span id="l33.3" class="difflineat">@@ -2279,20 +2279,20 @@ void nsMsgLocalMailFolder::CopyPropertie</span>
<a href="#l33.4"></a><span id="l33.4"> </span>
<a href="#l33.5"></a><span id="l33.5">   nsCString dontPreserve;</span>
<a href="#l33.6"></a><span id="l33.6"> </span>
<a href="#l33.7"></a><span id="l33.7">   // These preferences exist so that extensions can control which properties</span>
<a href="#l33.8"></a><span id="l33.8">   // are preserved in the database when a message is moved or copied. All</span>
<a href="#l33.9"></a><span id="l33.9">   // properties are preserved except those listed in these preferences</span>
<a href="#l33.10"></a><span id="l33.10">   if (aIsMove)</span>
<a href="#l33.11"></a><span id="l33.11">     prefBranch-&gt;GetCharPref(&quot;mailnews.database.summary.dontPreserveOnMove&quot;,</span>
<a href="#l33.12"></a><span id="l33.12" class="difflineminus">-                            getter_Copies(dontPreserve));</span>
<a href="#l33.13"></a><span id="l33.13" class="difflineplus">+                            dontPreserve);</span>
<a href="#l33.14"></a><span id="l33.14">   else</span>
<a href="#l33.15"></a><span id="l33.15">     prefBranch-&gt;GetCharPref(&quot;mailnews.database.summary.dontPreserveOnCopy&quot;,</span>
<a href="#l33.16"></a><span id="l33.16" class="difflineminus">-                            getter_Copies(dontPreserve));</span>
<a href="#l33.17"></a><span id="l33.17" class="difflineplus">+                            dontPreserve);</span>
<a href="#l33.18"></a><span id="l33.18"> </span>
<a href="#l33.19"></a><span id="l33.19">   CopyHdrPropertiesWithSkipList(destHdr, srcHdr, dontPreserve);</span>
<a href="#l33.20"></a><span id="l33.20"> }</span>
<a href="#l33.21"></a><span id="l33.21"> </span>
<a href="#l33.22"></a><span id="l33.22"> void</span>
<a href="#l33.23"></a><span id="l33.23"> nsMsgLocalMailFolder::CopyHdrPropertiesWithSkipList(nsIMsgDBHdr *destHdr,</span>
<a href="#l33.24"></a><span id="l33.24">                                                     nsIMsgDBHdr *srcHdr,</span>
<a href="#l33.25"></a><span id="l33.25">                                                     const nsCString &amp;skipList)</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l34.1"></a><span id="l34.1" class="difflineminus">--- a/mailnews/local/src/nsParseMailbox.cpp</span>
<a href="#l34.2"></a><span id="l34.2" class="difflineplus">+++ b/mailnews/local/src/nsParseMailbox.cpp</span>
<a href="#l34.3"></a><span id="l34.3" class="difflineat">@@ -524,26 +524,26 @@ nsParseMailMessageState::nsParseMailMess</span>
<a href="#l34.4"></a><span id="l34.4">   // E.g., if mailnews.customDBHeaders is &quot;X-Spam-Score&quot;, and we're parsing</span>
<a href="#l34.5"></a><span id="l34.5">   // a mail message with the X-Spam-Score header, we'll set the</span>
<a href="#l34.6"></a><span id="l34.6">   // &quot;x-spam-score&quot; property of nsMsgHdr to the value of the header.</span>
<a href="#l34.7"></a><span id="l34.7">   m_customDBHeaderValues = nullptr;</span>
<a href="#l34.8"></a><span id="l34.8">   nsCString customDBHeaders; // not shown in search UI</span>
<a href="#l34.9"></a><span id="l34.9">   nsCOMPtr&lt;nsIPrefBranch&gt; pPrefBranch(do_GetService(NS_PREFSERVICE_CONTRACTID));</span>
<a href="#l34.10"></a><span id="l34.10">   if (pPrefBranch)</span>
<a href="#l34.11"></a><span id="l34.11">   {</span>
<a href="#l34.12"></a><span id="l34.12" class="difflineminus">-     pPrefBranch-&gt;GetCharPref(&quot;mailnews.customDBHeaders&quot;,  getter_Copies(customDBHeaders));</span>
<a href="#l34.13"></a><span id="l34.13" class="difflineplus">+     pPrefBranch-&gt;GetCharPref(&quot;mailnews.customDBHeaders&quot;, customDBHeaders);</span>
<a href="#l34.14"></a><span id="l34.14">      ToLowerCase(customDBHeaders);</span>
<a href="#l34.15"></a><span id="l34.15">      if (customDBHeaders.Find(&quot;content-base&quot;) == -1)</span>
<a href="#l34.16"></a><span id="l34.16">       customDBHeaders.InsertLiteral(&quot;content-base &quot;, 0);</span>
<a href="#l34.17"></a><span id="l34.17">      ParseString(customDBHeaders, ' ', m_customDBHeaders);</span>
<a href="#l34.18"></a><span id="l34.18"> </span>
<a href="#l34.19"></a><span id="l34.19">      // now add customHeaders</span>
<a href="#l34.20"></a><span id="l34.20">      nsCString customHeadersString; // shown in search UI</span>
<a href="#l34.21"></a><span id="l34.21">      nsTArray&lt;nsCString&gt; customHeadersArray;</span>
<a href="#l34.22"></a><span id="l34.22" class="difflineminus">-     pPrefBranch-&gt;GetCharPref(&quot;mailnews.customHeaders&quot;, getter_Copies(customHeadersString));</span>
<a href="#l34.23"></a><span id="l34.23" class="difflineplus">+     pPrefBranch-&gt;GetCharPref(&quot;mailnews.customHeaders&quot;, customHeadersString);</span>
<a href="#l34.24"></a><span id="l34.24">      ToLowerCase(customHeadersString);</span>
<a href="#l34.25"></a><span id="l34.25">      customHeadersString.StripWhitespace();</span>
<a href="#l34.26"></a><span id="l34.26">      ParseString(customHeadersString, ':', customHeadersArray);</span>
<a href="#l34.27"></a><span id="l34.27">      for (uint32_t i = 0; i &lt; customHeadersArray.Length(); i++)</span>
<a href="#l34.28"></a><span id="l34.28">      {</span>
<a href="#l34.29"></a><span id="l34.29">        if (!m_customDBHeaders.Contains(customHeadersArray[i]))</span>
<a href="#l34.30"></a><span id="l34.30">          m_customDBHeaders.AppendElement(customHeadersArray[i]);</span>
<a href="#l34.31"></a><span id="l34.31">      }</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l35.1"></a><span id="l35.1" class="difflineminus">--- a/mailnews/mime/cthandlers/pgpmime/nsPgpMimeProxy.cpp</span>
<a href="#l35.2"></a><span id="l35.2" class="difflineplus">+++ b/mailnews/mime/cthandlers/pgpmime/nsPgpMimeProxy.cpp</span>
<a href="#l35.3"></a><span id="l35.3" class="difflineat">@@ -95,18 +95,17 @@ static void PgpMimeGetNeedsAddonString(n</span>
<a href="#l35.4"></a><span id="l35.4">   if (NS_FAILED(rv))</span>
<a href="#l35.5"></a><span id="l35.5">     return;</span>
<a href="#l35.6"></a><span id="l35.6"> </span>
<a href="#l35.7"></a><span id="l35.7">   nsCOMPtr&lt;nsIPrefBranch&gt; prefs(do_GetService(NS_PREFSERVICE_CONTRACTID, &amp;rv));</span>
<a href="#l35.8"></a><span id="l35.8">   if (NS_FAILED(rv))</span>
<a href="#l35.9"></a><span id="l35.9">     return;</span>
<a href="#l35.10"></a><span id="l35.10"> </span>
<a href="#l35.11"></a><span id="l35.11">   nsCString url;</span>
<a href="#l35.12"></a><span id="l35.12" class="difflineminus">-  if (NS_FAILED(prefs-&gt;GetCharPref(&quot;mail.pgpmime.addon_url&quot;,</span>
<a href="#l35.13"></a><span id="l35.13" class="difflineminus">-                                   getter_Copies(url))))</span>
<a href="#l35.14"></a><span id="l35.14" class="difflineplus">+  if (NS_FAILED(prefs-&gt;GetCharPref(&quot;mail.pgpmime.addon_url&quot;, url)))</span>
<a href="#l35.15"></a><span id="l35.15">     return;</span>
<a href="#l35.16"></a><span id="l35.16"> </span>
<a href="#l35.17"></a><span id="l35.17">   NS_ConvertUTF8toUTF16 url16(url);</span>
<a href="#l35.18"></a><span id="l35.18">   const char16_t *formatStrings[] = { url16.get() };</span>
<a href="#l35.19"></a><span id="l35.19"> </span>
<a href="#l35.20"></a><span id="l35.20">   nsString result;</span>
<a href="#l35.21"></a><span id="l35.21">   rv = stringBundle-&gt;FormatStringFromName(PGPMIME_STR_NOT_SUPPORTED_ID,</span>
<a href="#l35.22"></a><span id="l35.22">                                           formatStrings, 1, result);</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l36.1"></a><span id="l36.1" class="difflineminus">--- a/mailnews/mime/emitters/nsMimeHtmlEmitter.cpp</span>
<a href="#l36.2"></a><span id="l36.2" class="difflineplus">+++ b/mailnews/mime/emitters/nsMimeHtmlEmitter.cpp</span>
<a href="#l36.3"></a><span id="l36.3" class="difflineat">@@ -169,17 +169,17 @@ nsresult nsMimeHtmlDisplayEmitter::Broad</span>
<a href="#l36.4"></a><span id="l36.4">   nsCString extraExpandedHeaders;</span>
<a href="#l36.5"></a><span id="l36.5">   nsTArray&lt;nsCString&gt; extraExpandedHeadersArray;</span>
<a href="#l36.6"></a><span id="l36.6">   nsAutoCString convertedDateString;</span>
<a href="#l36.7"></a><span id="l36.7"> </span>
<a href="#l36.8"></a><span id="l36.8">   nsresult rv;</span>
<a href="#l36.9"></a><span id="l36.9">   nsCOMPtr&lt;nsIPrefBranch&gt; pPrefBranch(do_GetService(NS_PREFSERVICE_CONTRACTID, &amp;rv));</span>
<a href="#l36.10"></a><span id="l36.10">   if (pPrefBranch)</span>
<a href="#l36.11"></a><span id="l36.11">   {</span>
<a href="#l36.12"></a><span id="l36.12" class="difflineminus">-    pPrefBranch-&gt;GetCharPref(&quot;mailnews.headers.extraExpandedHeaders&quot;, getter_Copies(extraExpandedHeaders));</span>
<a href="#l36.13"></a><span id="l36.13" class="difflineplus">+    pPrefBranch-&gt;GetCharPref(&quot;mailnews.headers.extraExpandedHeaders&quot;, extraExpandedHeaders);</span>
<a href="#l36.14"></a><span id="l36.14">     // todo - should make this upper case</span>
<a href="#l36.15"></a><span id="l36.15">     if (!extraExpandedHeaders.IsEmpty())</span>
<a href="#l36.16"></a><span id="l36.16">     {</span>
<a href="#l36.17"></a><span id="l36.17">       ToLowerCase(extraExpandedHeaders);</span>
<a href="#l36.18"></a><span id="l36.18">       ParseString(extraExpandedHeaders, ' ', extraExpandedHeadersArray);</span>
<a href="#l36.19"></a><span id="l36.19">     }</span>
<a href="#l36.20"></a><span id="l36.20">   }</span>
<a href="#l36.21"></a><span id="l36.21"> </span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l37.1"></a><span id="l37.1" class="difflineminus">--- a/mailnews/mime/src/mimedrft.cpp</span>
<a href="#l37.2"></a><span id="l37.2" class="difflineplus">+++ b/mailnews/mime/src/mimedrft.cpp</span>
<a href="#l37.3"></a><span id="l37.3" class="difflineat">@@ -1323,18 +1323,17 @@ mime_parse_stream_complete(nsMIMESession</span>
<a href="#l37.4"></a><span id="l37.4">     {</span>
<a href="#l37.5"></a><span id="l37.5">       if (subj)</span>
<a href="#l37.6"></a><span id="l37.6">       {</span>
<a href="#l37.7"></a><span id="l37.7">         nsresult rv;</span>
<a href="#l37.8"></a><span id="l37.8">         nsCOMPtr&lt;nsIPrefBranch&gt; prefBranch(do_GetService(NS_PREFSERVICE_CONTRACTID, &amp;rv));</span>
<a href="#l37.9"></a><span id="l37.9">         if (NS_SUCCEEDED(rv))</span>
<a href="#l37.10"></a><span id="l37.10">         {</span>
<a href="#l37.11"></a><span id="l37.11">           nsAutoCString fwdPrefix;</span>
<a href="#l37.12"></a><span id="l37.12" class="difflineminus">-          prefBranch-&gt;GetCharPref(&quot;mail.forward_subject_prefix&quot;,</span>
<a href="#l37.13"></a><span id="l37.13" class="difflineminus">-                                  getter_Copies(fwdPrefix));</span>
<a href="#l37.14"></a><span id="l37.14" class="difflineplus">+          prefBranch-&gt;GetCharPref(&quot;mail.forward_subject_prefix&quot;, fwdPrefix);</span>
<a href="#l37.15"></a><span id="l37.15">           char *newSubj = PR_smprintf(&quot;%s: %s&quot;, !fwdPrefix.IsEmpty() ?</span>
<a href="#l37.16"></a><span id="l37.16">                                                 fwdPrefix.get(): &quot;Fwd&quot;, subj);</span>
<a href="#l37.17"></a><span id="l37.17">           if (newSubj)</span>
<a href="#l37.18"></a><span id="l37.18">           {</span>
<a href="#l37.19"></a><span id="l37.19">             PR_Free(subj);</span>
<a href="#l37.20"></a><span id="l37.20">             subj = newSubj;</span>
<a href="#l37.21"></a><span id="l37.21">           }</span>
<a href="#l37.22"></a><span id="l37.22">         }</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l38.1"></a><span id="l38.1" class="difflineminus">--- a/mailnews/mime/src/mimemoz2.cpp</span>
<a href="#l38.2"></a><span id="l38.2" class="difflineplus">+++ b/mailnews/mime/src/mimemoz2.cpp</span>
<a href="#l38.3"></a><span id="l38.3" class="difflineat">@@ -2092,17 +2092,17 @@ HTMLSanitize(const nsString&amp; inString, n</span>
<a href="#l38.4"></a><span id="l38.4">   nsresult rv = prefs-&gt;GetBoolPref(</span>
<a href="#l38.5"></a><span id="l38.5">     &quot;mailnews.display.html_sanitizer.allowed_tags.migrated&quot;,</span>
<a href="#l38.6"></a><span id="l38.6">     &amp;migrated);</span>
<a href="#l38.7"></a><span id="l38.7">   if (NS_SUCCEEDED(rv) &amp;&amp; !migrated) {</span>
<a href="#l38.8"></a><span id="l38.8">     prefs-&gt;SetBoolPref(&quot;mailnews.display.html_sanitizer.allowed_tags.migrated&quot;,</span>
<a href="#l38.9"></a><span id="l38.9">                        true);</span>
<a href="#l38.10"></a><span id="l38.10">     nsAutoCString legacy;</span>
<a href="#l38.11"></a><span id="l38.11">     rv = prefs-&gt;GetCharPref(&quot;mailnews.display.html_sanitizer.allowed_tags&quot;,</span>
<a href="#l38.12"></a><span id="l38.12" class="difflineminus">-                            getter_Copies(legacy));</span>
<a href="#l38.13"></a><span id="l38.13" class="difflineplus">+                            legacy);</span>
<a href="#l38.14"></a><span id="l38.14">     if (NS_SUCCEEDED(rv)) {</span>
<a href="#l38.15"></a><span id="l38.15">       prefs-&gt;SetBoolPref(&quot;mailnews.display.html_sanitizer.drop_non_css_presentation&quot;,</span>
<a href="#l38.16"></a><span id="l38.16">                          legacy.Find(&quot;font&quot;) &lt; 0);</span>
<a href="#l38.17"></a><span id="l38.17">       prefs-&gt;SetBoolPref(&quot;mailnews.display.html_sanitizer.drop_media&quot;,</span>
<a href="#l38.18"></a><span id="l38.18">                          legacy.Find(&quot;img&quot;) &lt; 0);</span>
<a href="#l38.19"></a><span id="l38.19">     }</span>
<a href="#l38.20"></a><span id="l38.20">   }</span>
<a href="#l38.21"></a><span id="l38.21">   // End pref migration.</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l39.1"></a><span id="l39.1" class="difflineminus">--- a/mailnews/mime/src/mimetpfl.cpp</span>
<a href="#l39.2"></a><span id="l39.2" class="difflineplus">+++ b/mailnews/mime/src/mimetpfl.cpp</span>
<a href="#l39.3"></a><span id="l39.3" class="difflineat">@@ -27,17 +27,17 @@ static int MimeInlineTextPlainFlowed_par</span>
<a href="#l39.4"></a><span id="l39.4"> static int MimeInlineTextPlainFlowed_parse_eof (MimeObject *, bool);</span>
<a href="#l39.5"></a><span id="l39.5"> </span>
<a href="#l39.6"></a><span id="l39.6"> static MimeInlineTextPlainFlowedExData *MimeInlineTextPlainFlowedExDataList = nullptr;</span>
<a href="#l39.7"></a><span id="l39.7"> </span>
<a href="#l39.8"></a><span id="l39.8"> // From mimetpla.cpp</span>
<a href="#l39.9"></a><span id="l39.9"> extern &quot;C&quot; void MimeTextBuildPrefixCSS(</span>
<a href="#l39.10"></a><span id="l39.10">                        int32_t quotedSizeSetting,      // mail.quoted_size</span>
<a href="#l39.11"></a><span id="l39.11">                        int32_t    quotedStyleSetting,  // mail.quoted_style</span>
<a href="#l39.12"></a><span id="l39.12" class="difflineminus">-                       char       *citationColor,      // mail.citation_color</span>
<a href="#l39.13"></a><span id="l39.13" class="difflineplus">+                       nsACString &amp;citationColor,      // mail.citation_color</span>
<a href="#l39.14"></a><span id="l39.14">                        nsACString &amp;style);</span>
<a href="#l39.15"></a><span id="l39.15"> // Definition below</span>
<a href="#l39.16"></a><span id="l39.16"> static</span>
<a href="#l39.17"></a><span id="l39.17"> nsresult Line_convert_whitespace(const nsString&amp; a_line,</span>
<a href="#l39.18"></a><span id="l39.18">                                  const bool a_convert_all_whitespace,</span>
<a href="#l39.19"></a><span id="l39.19">                                  nsString&amp; a_out_line);</span>
<a href="#l39.20"></a><span id="l39.20"> </span>
<a href="#l39.21"></a><span id="l39.21"> static int</span>
<a href="#l39.22"></a><span id="l39.22" class="difflineat">@@ -105,25 +105,25 @@ MimeInlineTextPlainFlowed_parse_begin (M</span>
<a href="#l39.23"></a><span id="l39.23">   PR_Free(content_type_row);</span>
<a href="#l39.24"></a><span id="l39.24"> </span>
<a href="#l39.25"></a><span id="l39.25">   // Get Prefs for viewing</span>
<a href="#l39.26"></a><span id="l39.26"> </span>
<a href="#l39.27"></a><span id="l39.27">   exdata-&gt;fixedwidthfont = false;</span>
<a href="#l39.28"></a><span id="l39.28">   //  Quotes</span>
<a href="#l39.29"></a><span id="l39.29">   text-&gt;mQuotedSizeSetting = 0;   // mail.quoted_size</span>
<a href="#l39.30"></a><span id="l39.30">   text-&gt;mQuotedStyleSetting = 0;  // mail.quoted_style</span>
<a href="#l39.31"></a><span id="l39.31" class="difflineminus">-  text-&gt;mCitationColor = nullptr;  // mail.citation_color</span>
<a href="#l39.32"></a><span id="l39.32" class="difflineplus">+  text-&gt;mCitationColor.Truncate();  // mail.citation_color</span>
<a href="#l39.33"></a><span id="l39.33">   text-&gt;mStripSig = true; // mail.strip_sig_on_reply</span>
<a href="#l39.34"></a><span id="l39.34"> </span>
<a href="#l39.35"></a><span id="l39.35">   nsIPrefBranch *prefBranch = GetPrefBranch(obj-&gt;options);</span>
<a href="#l39.36"></a><span id="l39.36">   if (prefBranch)</span>
<a href="#l39.37"></a><span id="l39.37">   {</span>
<a href="#l39.38"></a><span id="l39.38">     prefBranch-&gt;GetIntPref(&quot;mail.quoted_size&quot;, &amp;(text-&gt;mQuotedSizeSetting));</span>
<a href="#l39.39"></a><span id="l39.39">     prefBranch-&gt;GetIntPref(&quot;mail.quoted_style&quot;, &amp;(text-&gt;mQuotedStyleSetting));</span>
<a href="#l39.40"></a><span id="l39.40" class="difflineminus">-    prefBranch-&gt;GetCharPref(&quot;mail.citation_color&quot;, &amp;(text-&gt;mCitationColor));</span>
<a href="#l39.41"></a><span id="l39.41" class="difflineplus">+    prefBranch-&gt;GetCharPref(&quot;mail.citation_color&quot;, text-&gt;mCitationColor);</span>
<a href="#l39.42"></a><span id="l39.42">     prefBranch-&gt;GetBoolPref(&quot;mail.strip_sig_on_reply&quot;, &amp;(text-&gt;mStripSig));</span>
<a href="#l39.43"></a><span id="l39.43">     mozilla::DebugOnly&lt;nsresult&gt; rv =</span>
<a href="#l39.44"></a><span id="l39.44">       prefBranch-&gt;GetBoolPref(&quot;mail.fixed_width_messages&quot;, &amp;(exdata-&gt;fixedwidthfont));</span>
<a href="#l39.45"></a><span id="l39.45">     NS_ASSERTION(NS_SUCCEEDED(rv), &quot;failed to get pref&quot;);</span>
<a href="#l39.46"></a><span id="l39.46">          // Check at least the success of one</span>
<a href="#l39.47"></a><span id="l39.47">   }</span>
<a href="#l39.48"></a><span id="l39.48"> </span>
<a href="#l39.49"></a><span id="l39.49">   // Get font</span>
<a href="#l39.50"></a><span id="l39.50" class="difflineat">@@ -238,20 +238,19 @@ MimeInlineTextPlainFlowed_parse_eof (Mim</span>
<a href="#l39.51"></a><span id="l39.51">     if (status&lt;0) goto EarlyOut;</span>
<a href="#l39.52"></a><span id="l39.52">   }</span>
<a href="#l39.53"></a><span id="l39.53"> </span>
<a href="#l39.54"></a><span id="l39.54">   status = 0;</span>
<a href="#l39.55"></a><span id="l39.55"> </span>
<a href="#l39.56"></a><span id="l39.56"> EarlyOut:</span>
<a href="#l39.57"></a><span id="l39.57">   PR_Free(exdata);</span>
<a href="#l39.58"></a><span id="l39.58"> </span>
<a href="#l39.59"></a><span id="l39.59" class="difflineminus">-  // Free mCitationColor</span>
<a href="#l39.60"></a><span id="l39.60" class="difflineplus">+  // Clear mCitationColor</span>
<a href="#l39.61"></a><span id="l39.61">   MimeInlineTextPlainFlowed *text = (MimeInlineTextPlainFlowed *) obj;</span>
<a href="#l39.62"></a><span id="l39.62" class="difflineminus">-  PR_FREEIF(text-&gt;mCitationColor);</span>
<a href="#l39.63"></a><span id="l39.63" class="difflineminus">-  text-&gt;mCitationColor = nullptr;</span>
<a href="#l39.64"></a><span id="l39.64" class="difflineplus">+  text-&gt;mCitationColor.Truncate();</span>
<a href="#l39.65"></a><span id="l39.65"> </span>
<a href="#l39.66"></a><span id="l39.66">   return status;</span>
<a href="#l39.67"></a><span id="l39.67"> }</span>
<a href="#l39.68"></a><span id="l39.68"> </span>
<a href="#l39.69"></a><span id="l39.69"> </span>
<a href="#l39.70"></a><span id="l39.70"> static int</span>
<a href="#l39.71"></a><span id="l39.71"> MimeInlineTextPlainFlowed_parse_line (const char *aLine, int32_t length, MimeObject *obj)</span>
<a href="#l39.72"></a><span id="l39.72"> {</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l40.1"></a><span id="l40.1" class="difflineminus">--- a/mailnews/mime/src/mimetpfl.h</span>
<a href="#l40.2"></a><span id="l40.2" class="difflineplus">+++ b/mailnews/mime/src/mimetpfl.h</span>
<a href="#l40.3"></a><span id="l40.3" class="difflineat">@@ -24,17 +24,17 @@ struct MimeInlineTextPlainFlowedClass {</span>
<a href="#l40.4"></a><span id="l40.4"> </span>
<a href="#l40.5"></a><span id="l40.5"> extern MimeInlineTextPlainFlowedClass mimeInlineTextPlainFlowedClass;</span>
<a href="#l40.6"></a><span id="l40.6"> </span>
<a href="#l40.7"></a><span id="l40.7"> struct MimeInlineTextPlainFlowed {</span>
<a href="#l40.8"></a><span id="l40.8">   MimeInlineText  text;</span>
<a href="#l40.9"></a><span id="l40.9">   bool            delSp;                // DelSp=yes (RFC 3676)</span>
<a href="#l40.10"></a><span id="l40.10">   int32_t         mQuotedSizeSetting;   // mail.quoted_size</span>
<a href="#l40.11"></a><span id="l40.11">   int32_t         mQuotedStyleSetting;  // mail.quoted_style</span>
<a href="#l40.12"></a><span id="l40.12" class="difflineminus">-  char            *mCitationColor;      // mail.citation_color</span>
<a href="#l40.13"></a><span id="l40.13" class="difflineplus">+  nsCString       mCitationColor;       // mail.citation_color</span>
<a href="#l40.14"></a><span id="l40.14">   bool            mStripSig;            // mail.strip_sig_on_reply</span>
<a href="#l40.15"></a><span id="l40.15"> };</span>
<a href="#l40.16"></a><span id="l40.16"> </span>
<a href="#l40.17"></a><span id="l40.17"> </span>
<a href="#l40.18"></a><span id="l40.18"> /*</span>
<a href="#l40.19"></a><span id="l40.19">  * Made to contain information to be kept during the whole message parsing.</span>
<a href="#l40.20"></a><span id="l40.20">  */</span>
<a href="#l40.21"></a><span id="l40.21"> struct MimeInlineTextPlainFlowedExData {</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l41.1"></a><span id="l41.1" class="difflineminus">--- a/mailnews/mime/src/mimetpla.cpp</span>
<a href="#l41.2"></a><span id="l41.2" class="difflineplus">+++ b/mailnews/mime/src/mimetpla.cpp</span>
<a href="#l41.3"></a><span id="l41.3" class="difflineat">@@ -36,17 +36,17 @@ MimeInlineTextPlainClassInitialize(MimeI</span>
<a href="#l41.4"></a><span id="l41.4">   oclass-&gt;parse_eof   = MimeInlineTextPlain_parse_eof;</span>
<a href="#l41.5"></a><span id="l41.5">   return 0;</span>
<a href="#l41.6"></a><span id="l41.6"> }</span>
<a href="#l41.7"></a><span id="l41.7"> </span>
<a href="#l41.8"></a><span id="l41.8"> extern &quot;C&quot;</span>
<a href="#l41.9"></a><span id="l41.9"> void</span>
<a href="#l41.10"></a><span id="l41.10"> MimeTextBuildPrefixCSS(int32_t    quotedSizeSetting,   // mail.quoted_size</span>
<a href="#l41.11"></a><span id="l41.11">                        int32_t    quotedStyleSetting,  // mail.quoted_style</span>
<a href="#l41.12"></a><span id="l41.12" class="difflineminus">-                       char       *citationColor,      // mail.citation_color</span>
<a href="#l41.13"></a><span id="l41.13" class="difflineplus">+                       nsACString &amp;citationColor,      // mail.citation_color</span>
<a href="#l41.14"></a><span id="l41.14">                        nsACString &amp;style)</span>
<a href="#l41.15"></a><span id="l41.15"> {</span>
<a href="#l41.16"></a><span id="l41.16">   switch (quotedStyleSetting)</span>
<a href="#l41.17"></a><span id="l41.17">   {</span>
<a href="#l41.18"></a><span id="l41.18">   case 0:     // regular</span>
<a href="#l41.19"></a><span id="l41.19">     break;</span>
<a href="#l41.20"></a><span id="l41.20">   case 1:     // bold</span>
<a href="#l41.21"></a><span id="l41.21">     style.AppendLiteral(&quot;font-weight: bold; &quot;);</span>
<a href="#l41.22"></a><span id="l41.22" class="difflineat">@@ -66,17 +66,17 @@ MimeTextBuildPrefixCSS(int32_t    quoted</span>
<a href="#l41.23"></a><span id="l41.23">   case 1:     // large</span>
<a href="#l41.24"></a><span id="l41.24">     style.AppendLiteral(&quot;font-size: large; &quot;);</span>
<a href="#l41.25"></a><span id="l41.25">     break;</span>
<a href="#l41.26"></a><span id="l41.26">   case 2:     // small</span>
<a href="#l41.27"></a><span id="l41.27">     style.AppendLiteral(&quot;font-size: small; &quot;);</span>
<a href="#l41.28"></a><span id="l41.28">     break;</span>
<a href="#l41.29"></a><span id="l41.29">   }</span>
<a href="#l41.30"></a><span id="l41.30"> </span>
<a href="#l41.31"></a><span id="l41.31" class="difflineminus">-  if (citationColor &amp;&amp; *citationColor)</span>
<a href="#l41.32"></a><span id="l41.32" class="difflineplus">+  if (!citationColor.IsEmpty())</span>
<a href="#l41.33"></a><span id="l41.33">   {</span>
<a href="#l41.34"></a><span id="l41.34">     style += &quot;color: &quot;;</span>
<a href="#l41.35"></a><span id="l41.35">     style += citationColor;</span>
<a href="#l41.36"></a><span id="l41.36">     style += ';';</span>
<a href="#l41.37"></a><span id="l41.37">   }</span>
<a href="#l41.38"></a><span id="l41.38"> }</span>
<a href="#l41.39"></a><span id="l41.39"> </span>
<a href="#l41.40"></a><span id="l41.40"> static int</span>
<a href="#l41.41"></a><span id="l41.41" class="difflineat">@@ -109,26 +109,26 @@ MimeInlineTextPlain_parse_begin (MimeObj</span>
<a href="#l41.42"></a><span id="l41.42">       // Get the prefs</span>
<a href="#l41.43"></a><span id="l41.43"> </span>
<a href="#l41.44"></a><span id="l41.44">       // Quoting</span>
<a href="#l41.45"></a><span id="l41.45">       text-&gt;mBlockquoting = true; // mail.quoteasblock</span>
<a href="#l41.46"></a><span id="l41.46"> </span>
<a href="#l41.47"></a><span id="l41.47">       // Viewing</span>
<a href="#l41.48"></a><span id="l41.48">       text-&gt;mQuotedSizeSetting = 0;   // mail.quoted_size</span>
<a href="#l41.49"></a><span id="l41.49">       text-&gt;mQuotedStyleSetting = 0;  // mail.quoted_style</span>
<a href="#l41.50"></a><span id="l41.50" class="difflineminus">-      text-&gt;mCitationColor = nullptr;  // mail.citation_color</span>
<a href="#l41.51"></a><span id="l41.51" class="difflineplus">+      text-&gt;mCitationColor.Truncate();  // mail.citation_color</span>
<a href="#l41.52"></a><span id="l41.52">       text-&gt;mStripSig = true; // mail.strip_sig_on_reply</span>
<a href="#l41.53"></a><span id="l41.53">       bool graphicalQuote = true; // mail.quoted_graphical</span>
<a href="#l41.54"></a><span id="l41.54"> </span>
<a href="#l41.55"></a><span id="l41.55">       nsIPrefBranch *prefBranch = GetPrefBranch(obj-&gt;options);</span>
<a href="#l41.56"></a><span id="l41.56">       if (prefBranch)</span>
<a href="#l41.57"></a><span id="l41.57">       {</span>
<a href="#l41.58"></a><span id="l41.58">         prefBranch-&gt;GetIntPref(&quot;mail.quoted_size&quot;, &amp;(text-&gt;mQuotedSizeSetting));</span>
<a href="#l41.59"></a><span id="l41.59">         prefBranch-&gt;GetIntPref(&quot;mail.quoted_style&quot;, &amp;(text-&gt;mQuotedStyleSetting));</span>
<a href="#l41.60"></a><span id="l41.60" class="difflineminus">-        prefBranch-&gt;GetCharPref(&quot;mail.citation_color&quot;, &amp;(text-&gt;mCitationColor));</span>
<a href="#l41.61"></a><span id="l41.61" class="difflineplus">+        prefBranch-&gt;GetCharPref(&quot;mail.citation_color&quot;, text-&gt;mCitationColor);</span>
<a href="#l41.62"></a><span id="l41.62">         prefBranch-&gt;GetBoolPref(&quot;mail.strip_sig_on_reply&quot;, &amp;(text-&gt;mStripSig));</span>
<a href="#l41.63"></a><span id="l41.63">         prefBranch-&gt;GetBoolPref(&quot;mail.quoted_graphical&quot;, &amp;graphicalQuote);</span>
<a href="#l41.64"></a><span id="l41.64">         prefBranch-&gt;GetBoolPref(&quot;mail.quoteasblock&quot;, &amp;(text-&gt;mBlockquoting));</span>
<a href="#l41.65"></a><span id="l41.65">       }</span>
<a href="#l41.66"></a><span id="l41.66"> </span>
<a href="#l41.67"></a><span id="l41.67">       if (!rawPlainText)</span>
<a href="#l41.68"></a><span id="l41.68">       {</span>
<a href="#l41.69"></a><span id="l41.69">         // Get font</span>
<a href="#l41.70"></a><span id="l41.70" class="difflineat">@@ -217,18 +217,18 @@ MimeInlineTextPlain_parse_eof (MimeObjec</span>
<a href="#l41.71"></a><span id="l41.71">   int status;</span>
<a href="#l41.72"></a><span id="l41.72"> </span>
<a href="#l41.73"></a><span id="l41.73">   // Has this method already been called for this object?</span>
<a href="#l41.74"></a><span id="l41.74">   // In that case return.</span>
<a href="#l41.75"></a><span id="l41.75">   if (obj-&gt;closed_p) return 0;</span>
<a href="#l41.76"></a><span id="l41.76"> </span>
<a href="#l41.77"></a><span id="l41.77">   nsCString citationColor;</span>
<a href="#l41.78"></a><span id="l41.78">   MimeInlineTextPlain *text = (MimeInlineTextPlain *) obj;</span>
<a href="#l41.79"></a><span id="l41.79" class="difflineminus">-  if (text &amp;&amp; text-&gt;mCitationColor)</span>
<a href="#l41.80"></a><span id="l41.80" class="difflineminus">-    citationColor.Adopt(text-&gt;mCitationColor);</span>
<a href="#l41.81"></a><span id="l41.81" class="difflineplus">+  if (text &amp;&amp; !text-&gt;mCitationColor.IsEmpty())</span>
<a href="#l41.82"></a><span id="l41.82" class="difflineplus">+    citationColor = text-&gt;mCitationColor;</span>
<a href="#l41.83"></a><span id="l41.83"> </span>
<a href="#l41.84"></a><span id="l41.84">   bool quoting = ( obj-&gt;options</span>
<a href="#l41.85"></a><span id="l41.85">     &amp;&amp; ( obj-&gt;options-&gt;format_out == nsMimeOutput::nsMimeMessageQuoting ||</span>
<a href="#l41.86"></a><span id="l41.86">          obj-&gt;options-&gt;format_out == nsMimeOutput::nsMimeMessageBodyQuoting</span>
<a href="#l41.87"></a><span id="l41.87">        )           );  // see above</span>
<a href="#l41.88"></a><span id="l41.88"> </span>
<a href="#l41.89"></a><span id="l41.89">   bool rawPlainText = obj-&gt;options &amp;&amp;</span>
<a href="#l41.90"></a><span id="l41.90">        (obj-&gt;options-&gt;format_out == nsMimeOutput::nsMimeMessageFilterSniffer</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l42.1"></a><span id="l42.1" class="difflineminus">--- a/mailnews/mime/src/mimetpla.h</span>
<a href="#l42.2"></a><span id="l42.2" class="difflineplus">+++ b/mailnews/mime/src/mimetpla.h</span>
<a href="#l42.3"></a><span id="l42.3" class="difflineat">@@ -23,17 +23,17 @@ extern MimeInlineTextPlainClass mimeInli</span>
<a href="#l42.4"></a><span id="l42.4"> </span>
<a href="#l42.5"></a><span id="l42.5"> struct MimeInlineTextPlain {</span>
<a href="#l42.6"></a><span id="l42.6">   MimeInlineText text;</span>
<a href="#l42.7"></a><span id="l42.7">   uint32_t mCiteLevel;</span>
<a href="#l42.8"></a><span id="l42.8">   bool            mBlockquoting;</span>
<a href="#l42.9"></a><span id="l42.9">   //bool            mInsideQuote;</span>
<a href="#l42.10"></a><span id="l42.10">   int32_t         mQuotedSizeSetting;   // mail.quoted_size</span>
<a href="#l42.11"></a><span id="l42.11">   int32_t         mQuotedStyleSetting;  // mail.quoted_style</span>
<a href="#l42.12"></a><span id="l42.12" class="difflineminus">-  char            *mCitationColor;      // mail.citation_color</span>
<a href="#l42.13"></a><span id="l42.13" class="difflineplus">+  nsCString       mCitationColor;       // mail.citation_color</span>
<a href="#l42.14"></a><span id="l42.14">   bool            mStripSig;            // mail.strip_sig_on_reply</span>
<a href="#l42.15"></a><span id="l42.15">   bool            mIsSig;</span>
<a href="#l42.16"></a><span id="l42.16"> };</span>
<a href="#l42.17"></a><span id="l42.17"> </span>
<a href="#l42.18"></a><span id="l42.18"> #define MimeInlineTextPlainClassInitializer(ITYPE,CSUPER) \</span>
<a href="#l42.19"></a><span id="l42.19">   { MimeInlineTextClassInitializer(ITYPE,CSUPER) }</span>
<a href="#l42.20"></a><span id="l42.20"> </span>
<a href="#l42.21"></a><span id="l42.21"> #endif /* _MIMETPLA_H_ */</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l43.1"></a><span id="l43.1" class="difflineminus">--- a/suite/profile/migration/src/nsNetscapeProfileMigratorBase.cpp</span>
<a href="#l43.2"></a><span id="l43.2" class="difflineplus">+++ b/suite/profile/migration/src/nsNetscapeProfileMigratorBase.cpp</span>
<a href="#l43.3"></a><span id="l43.3" class="difflineat">@@ -265,17 +265,17 @@ nsNetscapeProfileMigratorBase::SetFile(P</span>
<a href="#l43.4"></a><span id="l43.4">     if (NS_SUCCEEDED(rv) &amp;&amp; exists)</span>
<a href="#l43.5"></a><span id="l43.5">       rv = file-&gt;IsFile(&amp;exists);</span>
<a href="#l43.6"></a><span id="l43.6"> </span>
<a href="#l43.7"></a><span id="l43.7">     if (NS_SUCCEEDED(rv) &amp;&amp; exists) {</span>
<a href="#l43.8"></a><span id="l43.8">       // After all that let's just get the URL spec and set the pref to it.</span>
<a href="#l43.9"></a><span id="l43.9">       rv = fileHandler-&gt;GetURLSpecFromFile(file, fileURL);</span>
<a href="#l43.10"></a><span id="l43.10">       if (NS_FAILED(rv))</span>
<a href="#l43.11"></a><span id="l43.11">         return NS_OK;</span>
<a href="#l43.12"></a><span id="l43.12" class="difflineminus">-      rv = aBranch-&gt;SetCharPref(aTransform-&gt;sourcePrefName, fileURL.get());</span>
<a href="#l43.13"></a><span id="l43.13" class="difflineplus">+      rv = aBranch-&gt;SetCharPref(aTransform-&gt;sourcePrefName, fileURL);</span>
<a href="#l43.14"></a><span id="l43.14">       if (NS_SUCCEEDED(rv) &amp;&amp; aTransform-&gt;targetPrefName)</span>
<a href="#l43.15"></a><span id="l43.15">         rv = aBranch-&gt;SetIntPref(aTransform-&gt;targetPrefName, 1);</span>
<a href="#l43.16"></a><span id="l43.16">     }</span>
<a href="#l43.17"></a><span id="l43.17">   }</span>
<a href="#l43.18"></a><span id="l43.18">   return rv;</span>
<a href="#l43.19"></a><span id="l43.19"> }</span>
<a href="#l43.20"></a><span id="l43.20"> </span>
<a href="#l43.21"></a><span id="l43.21"> nsresult</span></pre></div></div>

<div class="page_footer">
<div class="page_footer_text">comm-central</div>
<div class="page_footer_text" style="padding-left: 10px">Deployed from <a href="https://hg.mozilla.org/hgcustom/version-control-tools/rev/35f393d6769a">35f393d6769a</a> at 2020-07-16T17:23:43Z.</div>
<div class="rss_logo">
<a href="/comm-central/rss-log">RSS</a>
<a href="/comm-central/atom-log">Atom</a>
</div>
<br />

</div>
</body>
</html>

