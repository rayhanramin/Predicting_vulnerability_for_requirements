<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en-US" lang="en-US">
<head>
<link rel="icon" href="/static/4b0de666d1a4/hgicon.png" type="image/png" />
<meta name="robots" content="index, nofollow"/>
<link rel="stylesheet" href="/static/4b0de666d1a4/style-gitweb.css" type="text/css" />

<style type="text/css">
div.feed {
  float: right;
}
a img {
  border-width: 0px;
}
div.log_link {
  width: 80px;
  background-color: white;
}

div.log_body {
  padding-left: 96px;
}
</style>
<script type="text/javascript" src="/static/4b0de666d1a4/mercurial.js"></script>

<meta property="og:image" content="/static/4b0de666d1a4/moz-logo-bw-rgb.svg"/>
<meta property="og:type" content="website"/>

<title>comm-central: changeset 28519:741493b66b6abddfa227c1dd08c91bf11367a3cb</title>
<link rel="alternate" type="application/atom+xml"
   href="/comm-central/atom-log" title="Atom feed for comm-central"/>
<link rel="alternate" type="application/rss+xml"
   href="/comm-central/rss-log" title="RSS feed for comm-central"/>

<meta property="og:title" content="comm-central @ 741493b66b6abddfa227c1dd08c91bf11367a3cb" />
<meta property="og:url" content="/comm-central/rev/741493b66b6abddfa227c1dd08c91bf11367a3cb" />
<meta property="og:description" content="Bug 1594000 - Convert remaining nsISimpleEnumerator users to use JS iteration in /mail. r=mkmelin" />

</head>
<body>

<div class="page_header">
<div class="logo">
    <a href="https://developer.mozilla.org/en/docs/Mercurial">
        <img src="/static/4b0de666d1a4/moz-logo-bw-rgb.svg" alt="mercurial" />
    </a>
</div>
<a href="/">Mercurial</a> &gt; <a href="/comm-central">comm-central</a>  / changeset / 741493b66b6abddfa227c1dd08c91bf11367a3cb 
</div>

<div class="page_nav">
<div>
<a href="/comm-central/summary">summary</a> |
<a href="/comm-central/shortlog/741493b66b6abddfa227c1dd08c91bf11367a3cb">shortlog</a> |
<a href="/comm-central/log/741493b66b6abddfa227c1dd08c91bf11367a3cb">changelog</a> |
<a href="/comm-central/pushloghtml">pushlog</a> |
<a href="/comm-central/graph/741493b66b6abddfa227c1dd08c91bf11367a3cb">graph</a> |
<a href="/comm-central/tags">tags</a> |
<a href="/comm-central/bookmarks">bookmarks</a> |
<a href="/comm-central/branches">branches</a> |
<a href="/comm-central/file/741493b66b6abddfa227c1dd08c91bf11367a3cb">files</a> |
changeset |
<a href="/comm-central/raw-rev/741493b66b6abddfa227c1dd08c91bf11367a3cb">raw</a>  | <a href="/comm-central/archive/741493b66b6abddfa227c1dd08c91bf11367a3cb.zip">zip</a>  |
<a href="/comm-central/help">help</a>
</div>

<div class="search">
<form id="searchform" action="/comm-central/log">

<input name="rev" type="text" value="" size="40" />
<div id="hint">Find changesets by keywords (author, files, the commit message), revision
number or hash, or <a href="/comm-central/help/revsets">revset expression</a>.</div>
</form>
</div>
</div>

<div class="title">
<a href="https://bugzilla.mozilla.org/show_bug.cgi?id=1594000">Bug 1594000</a> - Convert remaining nsISimpleEnumerator users to use JS iteration in /mail. r=mkmelin
<span class="logtags"></span>
</div>
<div class="title_text">
<table cellspacing="0">

<tr><td>author</td><td>&#75;&#104;&#117;&#115;&#104;&#105;&#108;&#32;&#77;&#105;&#115;&#116;&#114;&#121;&#32;&#60;&#107;&#104;&#117;&#115;&#104;&#105;&#108;&#51;&#50;&#52;&#62;</td></tr>
<tr><td></td><td class="date age">Mon, 13 Jan 2020 09:31:20 +0200</td></tr>

<tr>
 <td>changeset 28519</td>
 <td style="font-family:monospace"><a class="list" href="/comm-central/rev/741493b66b6abddfa227c1dd08c91bf11367a3cb">741493b66b6abddfa227c1dd08c91bf11367a3cb</a></td>
</tr>



<tr>
<td>parent 28518</td>
<td style="font-family:monospace">
<a class="list" href="/comm-central/rev/78ee796295d6bb5dc68db16e5eb199bd6111c378">78ee796295d6bb5dc68db16e5eb199bd6111c378</a>
</td>
</tr>

<tr>
<td>child 28520</td>
<td style="font-family:monospace">
<a class="list" href="/comm-central/rev/216cbe602979218a527744b2879387f1c98e6fe2">216cbe602979218a527744b2879387f1c98e6fe2</a>
</td>
</tr>
<tr><td>push id</td><td><a href="/comm-central/pushloghtml?changeset=741493b66b6abddfa227c1dd08c91bf11367a3cb">16894</a></td></tr>
<tr><td>push user</td><td>mkmelin@iki.fi</td></tr>
<tr><td>push date</td><td class="date age">Mon, 13 Jan 2020 07:35:45 +0000</td></tr>

<tr><td>treeherder</td><td>comm-central@216cbe602979 [<a href="https://treeherder.mozilla.org/#/jobs?repo=comm-central&revision=216cbe602979218a527744b2879387f1c98e6fe2">default view</a>] [<a href="https://treeherder.mozilla.org/#/jobs?repo=comm-central&revision=216cbe602979218a527744b2879387f1c98e6fe2&filter-resultStatus=testfailed&filter-resultStatus=busted&filter-resultStatus=exception">failures only]</td></tr>
<tr><td>perfherder</td><td>[<a href="https://treeherder.mozilla.org/perf.html#/compare?originalProject=comm-central&originalRevision=216cbe602979218a527744b2879387f1c98e6fe2&newProject=comm-central&newRevision=78ee796295d6bb5dc68db16e5eb199bd6111c378&framework=1" target="_blank">talos</a>] [<a href="https://treeherder.mozilla.org/perf.html#/compare?originalProject=comm-central&originalRevision=216cbe602979218a527744b2879387f1c98e6fe2&newProject=comm-central&newRevision=78ee796295d6bb5dc68db16e5eb199bd6111c378&framework=2" target="_blank">build metrics</a>] [<a href="https://treeherder.mozilla.org/perf.html#/compare?originalProject=comm-central&originalRevision=216cbe602979218a527744b2879387f1c98e6fe2&newProject=comm-central&newRevision=78ee796295d6bb5dc68db16e5eb199bd6111c378&framework=6" target="_blank">platform microbench</a>] (compared to previous push)</td></tr>
<tr><td>reviewers</td><td><a href="/comm-central/log?rev=reviewer%28mkmelin%29&revcount=50">mkmelin</a></td></tr>
<tr><td>bugs</td><td><a href="https://bugzilla.mozilla.org/show_bug.cgi?id=1594000">1594000</a></td></tr>




</table></div>

<div class="page_body description"><a href="https://bugzilla.mozilla.org/show_bug.cgi?id=1594000">Bug 1594000</a> - Convert remaining nsISimpleEnumerator users to use JS iteration in /mail. r=mkmelin</div>
<div class="list_head"></div>
<div class="title_text">
<table cellspacing="0">

<tr class="parity0">
<td><a class="list" href="/comm-central/diff/741493b66b6abddfa227c1dd08c91bf11367a3cb/mail/base/content/SearchDialog.js">mail/base/content/SearchDialog.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/741493b66b6abddfa227c1dd08c91bf11367a3cb/mail/base/content/SearchDialog.js">file</a> |
<a href="/comm-central/annotate/741493b66b6abddfa227c1dd08c91bf11367a3cb/mail/base/content/SearchDialog.js">annotate</a> |
<a href="/comm-central/diff/741493b66b6abddfa227c1dd08c91bf11367a3cb/mail/base/content/SearchDialog.js">diff</a> |
<a href="/comm-central/comparison/741493b66b6abddfa227c1dd08c91bf11367a3cb/mail/base/content/SearchDialog.js">comparison</a> |
<a href="/comm-central/log/741493b66b6abddfa227c1dd08c91bf11367a3cb/mail/base/content/SearchDialog.js">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/741493b66b6abddfa227c1dd08c91bf11367a3cb/mail/base/content/folderPane.js">mail/base/content/folderPane.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/741493b66b6abddfa227c1dd08c91bf11367a3cb/mail/base/content/folderPane.js">file</a> |
<a href="/comm-central/annotate/741493b66b6abddfa227c1dd08c91bf11367a3cb/mail/base/content/folderPane.js">annotate</a> |
<a href="/comm-central/diff/741493b66b6abddfa227c1dd08c91bf11367a3cb/mail/base/content/folderPane.js">diff</a> |
<a href="/comm-central/comparison/741493b66b6abddfa227c1dd08c91bf11367a3cb/mail/base/content/folderPane.js">comparison</a> |
<a href="/comm-central/log/741493b66b6abddfa227c1dd08c91bf11367a3cb/mail/base/content/folderPane.js">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/741493b66b6abddfa227c1dd08c91bf11367a3cb/mail/base/content/mailCommands.js">mail/base/content/mailCommands.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/741493b66b6abddfa227c1dd08c91bf11367a3cb/mail/base/content/mailCommands.js">file</a> |
<a href="/comm-central/annotate/741493b66b6abddfa227c1dd08c91bf11367a3cb/mail/base/content/mailCommands.js">annotate</a> |
<a href="/comm-central/diff/741493b66b6abddfa227c1dd08c91bf11367a3cb/mail/base/content/mailCommands.js">diff</a> |
<a href="/comm-central/comparison/741493b66b6abddfa227c1dd08c91bf11367a3cb/mail/base/content/mailCommands.js">comparison</a> |
<a href="/comm-central/log/741493b66b6abddfa227c1dd08c91bf11367a3cb/mail/base/content/mailCommands.js">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/741493b66b6abddfa227c1dd08c91bf11367a3cb/mail/base/content/mailContextMenus.js">mail/base/content/mailContextMenus.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/741493b66b6abddfa227c1dd08c91bf11367a3cb/mail/base/content/mailContextMenus.js">file</a> |
<a href="/comm-central/annotate/741493b66b6abddfa227c1dd08c91bf11367a3cb/mail/base/content/mailContextMenus.js">annotate</a> |
<a href="/comm-central/diff/741493b66b6abddfa227c1dd08c91bf11367a3cb/mail/base/content/mailContextMenus.js">diff</a> |
<a href="/comm-central/comparison/741493b66b6abddfa227c1dd08c91bf11367a3cb/mail/base/content/mailContextMenus.js">comparison</a> |
<a href="/comm-central/log/741493b66b6abddfa227c1dd08c91bf11367a3cb/mail/base/content/mailContextMenus.js">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/741493b66b6abddfa227c1dd08c91bf11367a3cb/mail/base/content/mailCore.js">mail/base/content/mailCore.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/741493b66b6abddfa227c1dd08c91bf11367a3cb/mail/base/content/mailCore.js">file</a> |
<a href="/comm-central/annotate/741493b66b6abddfa227c1dd08c91bf11367a3cb/mail/base/content/mailCore.js">annotate</a> |
<a href="/comm-central/diff/741493b66b6abddfa227c1dd08c91bf11367a3cb/mail/base/content/mailCore.js">diff</a> |
<a href="/comm-central/comparison/741493b66b6abddfa227c1dd08c91bf11367a3cb/mail/base/content/mailCore.js">comparison</a> |
<a href="/comm-central/log/741493b66b6abddfa227c1dd08c91bf11367a3cb/mail/base/content/mailCore.js">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/741493b66b6abddfa227c1dd08c91bf11367a3cb/mail/base/content/msgMail3PaneWindow.js">mail/base/content/msgMail3PaneWindow.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/741493b66b6abddfa227c1dd08c91bf11367a3cb/mail/base/content/msgMail3PaneWindow.js">file</a> |
<a href="/comm-central/annotate/741493b66b6abddfa227c1dd08c91bf11367a3cb/mail/base/content/msgMail3PaneWindow.js">annotate</a> |
<a href="/comm-central/diff/741493b66b6abddfa227c1dd08c91bf11367a3cb/mail/base/content/msgMail3PaneWindow.js">diff</a> |
<a href="/comm-central/comparison/741493b66b6abddfa227c1dd08c91bf11367a3cb/mail/base/content/msgMail3PaneWindow.js">comparison</a> |
<a href="/comm-central/log/741493b66b6abddfa227c1dd08c91bf11367a3cb/mail/base/content/msgMail3PaneWindow.js">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/741493b66b6abddfa227c1dd08c91bf11367a3cb/mail/base/content/msgViewNavigation.js">mail/base/content/msgViewNavigation.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/741493b66b6abddfa227c1dd08c91bf11367a3cb/mail/base/content/msgViewNavigation.js">file</a> |
<a href="/comm-central/annotate/741493b66b6abddfa227c1dd08c91bf11367a3cb/mail/base/content/msgViewNavigation.js">annotate</a> |
<a href="/comm-central/diff/741493b66b6abddfa227c1dd08c91bf11367a3cb/mail/base/content/msgViewNavigation.js">diff</a> |
<a href="/comm-central/comparison/741493b66b6abddfa227c1dd08c91bf11367a3cb/mail/base/content/msgViewNavigation.js">comparison</a> |
<a href="/comm-central/log/741493b66b6abddfa227c1dd08c91bf11367a3cb/mail/base/content/msgViewNavigation.js">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/741493b66b6abddfa227c1dd08c91bf11367a3cb/mail/base/content/sanitize.js">mail/base/content/sanitize.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/741493b66b6abddfa227c1dd08c91bf11367a3cb/mail/base/content/sanitize.js">file</a> |
<a href="/comm-central/annotate/741493b66b6abddfa227c1dd08c91bf11367a3cb/mail/base/content/sanitize.js">annotate</a> |
<a href="/comm-central/diff/741493b66b6abddfa227c1dd08c91bf11367a3cb/mail/base/content/sanitize.js">diff</a> |
<a href="/comm-central/comparison/741493b66b6abddfa227c1dd08c91bf11367a3cb/mail/base/content/sanitize.js">comparison</a> |
<a href="/comm-central/log/741493b66b6abddfa227c1dd08c91bf11367a3cb/mail/base/content/sanitize.js">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/741493b66b6abddfa227c1dd08c91bf11367a3cb/mail/base/modules/MailUtils.jsm">mail/base/modules/MailUtils.jsm</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/741493b66b6abddfa227c1dd08c91bf11367a3cb/mail/base/modules/MailUtils.jsm">file</a> |
<a href="/comm-central/annotate/741493b66b6abddfa227c1dd08c91bf11367a3cb/mail/base/modules/MailUtils.jsm">annotate</a> |
<a href="/comm-central/diff/741493b66b6abddfa227c1dd08c91bf11367a3cb/mail/base/modules/MailUtils.jsm">diff</a> |
<a href="/comm-central/comparison/741493b66b6abddfa227c1dd08c91bf11367a3cb/mail/base/modules/MailUtils.jsm">comparison</a> |
<a href="/comm-central/log/741493b66b6abddfa227c1dd08c91bf11367a3cb/mail/base/modules/MailUtils.jsm">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/741493b66b6abddfa227c1dd08c91bf11367a3cb/mail/base/modules/QuickFilterManager.jsm">mail/base/modules/QuickFilterManager.jsm</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/741493b66b6abddfa227c1dd08c91bf11367a3cb/mail/base/modules/QuickFilterManager.jsm">file</a> |
<a href="/comm-central/annotate/741493b66b6abddfa227c1dd08c91bf11367a3cb/mail/base/modules/QuickFilterManager.jsm">annotate</a> |
<a href="/comm-central/diff/741493b66b6abddfa227c1dd08c91bf11367a3cb/mail/base/modules/QuickFilterManager.jsm">diff</a> |
<a href="/comm-central/comparison/741493b66b6abddfa227c1dd08c91bf11367a3cb/mail/base/modules/QuickFilterManager.jsm">comparison</a> |
<a href="/comm-central/log/741493b66b6abddfa227c1dd08c91bf11367a3cb/mail/base/modules/QuickFilterManager.jsm">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/741493b66b6abddfa227c1dd08c91bf11367a3cb/mail/base/modules/SessionStoreManager.jsm">mail/base/modules/SessionStoreManager.jsm</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/741493b66b6abddfa227c1dd08c91bf11367a3cb/mail/base/modules/SessionStoreManager.jsm">file</a> |
<a href="/comm-central/annotate/741493b66b6abddfa227c1dd08c91bf11367a3cb/mail/base/modules/SessionStoreManager.jsm">annotate</a> |
<a href="/comm-central/diff/741493b66b6abddfa227c1dd08c91bf11367a3cb/mail/base/modules/SessionStoreManager.jsm">diff</a> |
<a href="/comm-central/comparison/741493b66b6abddfa227c1dd08c91bf11367a3cb/mail/base/modules/SessionStoreManager.jsm">comparison</a> |
<a href="/comm-central/log/741493b66b6abddfa227c1dd08c91bf11367a3cb/mail/base/modules/SessionStoreManager.jsm">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/741493b66b6abddfa227c1dd08c91bf11367a3cb/mail/base/modules/TBDistCustomizer.jsm">mail/base/modules/TBDistCustomizer.jsm</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/741493b66b6abddfa227c1dd08c91bf11367a3cb/mail/base/modules/TBDistCustomizer.jsm">file</a> |
<a href="/comm-central/annotate/741493b66b6abddfa227c1dd08c91bf11367a3cb/mail/base/modules/TBDistCustomizer.jsm">annotate</a> |
<a href="/comm-central/diff/741493b66b6abddfa227c1dd08c91bf11367a3cb/mail/base/modules/TBDistCustomizer.jsm">diff</a> |
<a href="/comm-central/comparison/741493b66b6abddfa227c1dd08c91bf11367a3cb/mail/base/modules/TBDistCustomizer.jsm">comparison</a> |
<a href="/comm-central/log/741493b66b6abddfa227c1dd08c91bf11367a3cb/mail/base/modules/TBDistCustomizer.jsm">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/741493b66b6abddfa227c1dd08c91bf11367a3cb/mail/base/modules/TagUtils.jsm">mail/base/modules/TagUtils.jsm</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/741493b66b6abddfa227c1dd08c91bf11367a3cb/mail/base/modules/TagUtils.jsm">file</a> |
<a href="/comm-central/annotate/741493b66b6abddfa227c1dd08c91bf11367a3cb/mail/base/modules/TagUtils.jsm">annotate</a> |
<a href="/comm-central/diff/741493b66b6abddfa227c1dd08c91bf11367a3cb/mail/base/modules/TagUtils.jsm">diff</a> |
<a href="/comm-central/comparison/741493b66b6abddfa227c1dd08c91bf11367a3cb/mail/base/modules/TagUtils.jsm">comparison</a> |
<a href="/comm-central/log/741493b66b6abddfa227c1dd08c91bf11367a3cb/mail/base/modules/TagUtils.jsm">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/741493b66b6abddfa227c1dd08c91bf11367a3cb/mail/base/test/unit/test_mailGlue_distribution.js">mail/base/test/unit/test_mailGlue_distribution.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/741493b66b6abddfa227c1dd08c91bf11367a3cb/mail/base/test/unit/test_mailGlue_distribution.js">file</a> |
<a href="/comm-central/annotate/741493b66b6abddfa227c1dd08c91bf11367a3cb/mail/base/test/unit/test_mailGlue_distribution.js">annotate</a> |
<a href="/comm-central/diff/741493b66b6abddfa227c1dd08c91bf11367a3cb/mail/base/test/unit/test_mailGlue_distribution.js">diff</a> |
<a href="/comm-central/comparison/741493b66b6abddfa227c1dd08c91bf11367a3cb/mail/base/test/unit/test_mailGlue_distribution.js">comparison</a> |
<a href="/comm-central/log/741493b66b6abddfa227c1dd08c91bf11367a3cb/mail/base/test/unit/test_mailGlue_distribution.js">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/741493b66b6abddfa227c1dd08c91bf11367a3cb/mail/components/MessengerContentHandler.jsm">mail/components/MessengerContentHandler.jsm</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/741493b66b6abddfa227c1dd08c91bf11367a3cb/mail/components/MessengerContentHandler.jsm">file</a> |
<a href="/comm-central/annotate/741493b66b6abddfa227c1dd08c91bf11367a3cb/mail/components/MessengerContentHandler.jsm">annotate</a> |
<a href="/comm-central/diff/741493b66b6abddfa227c1dd08c91bf11367a3cb/mail/components/MessengerContentHandler.jsm">diff</a> |
<a href="/comm-central/comparison/741493b66b6abddfa227c1dd08c91bf11367a3cb/mail/components/MessengerContentHandler.jsm">comparison</a> |
<a href="/comm-central/log/741493b66b6abddfa227c1dd08c91bf11367a3cb/mail/components/MessengerContentHandler.jsm">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/741493b66b6abddfa227c1dd08c91bf11367a3cb/mail/components/about-support/content/aboutSupport.js">mail/components/about-support/content/aboutSupport.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/741493b66b6abddfa227c1dd08c91bf11367a3cb/mail/components/about-support/content/aboutSupport.js">file</a> |
<a href="/comm-central/annotate/741493b66b6abddfa227c1dd08c91bf11367a3cb/mail/components/about-support/content/aboutSupport.js">annotate</a> |
<a href="/comm-central/diff/741493b66b6abddfa227c1dd08c91bf11367a3cb/mail/components/about-support/content/aboutSupport.js">diff</a> |
<a href="/comm-central/comparison/741493b66b6abddfa227c1dd08c91bf11367a3cb/mail/components/about-support/content/aboutSupport.js">comparison</a> |
<a href="/comm-central/log/741493b66b6abddfa227c1dd08c91bf11367a3cb/mail/components/about-support/content/aboutSupport.js">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/741493b66b6abddfa227c1dd08c91bf11367a3cb/mail/components/accountcreation/content/createInBackend.js">mail/components/accountcreation/content/createInBackend.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/741493b66b6abddfa227c1dd08c91bf11367a3cb/mail/components/accountcreation/content/createInBackend.js">file</a> |
<a href="/comm-central/annotate/741493b66b6abddfa227c1dd08c91bf11367a3cb/mail/components/accountcreation/content/createInBackend.js">annotate</a> |
<a href="/comm-central/diff/741493b66b6abddfa227c1dd08c91bf11367a3cb/mail/components/accountcreation/content/createInBackend.js">diff</a> |
<a href="/comm-central/comparison/741493b66b6abddfa227c1dd08c91bf11367a3cb/mail/components/accountcreation/content/createInBackend.js">comparison</a> |
<a href="/comm-central/log/741493b66b6abddfa227c1dd08c91bf11367a3cb/mail/components/accountcreation/content/createInBackend.js">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/741493b66b6abddfa227c1dd08c91bf11367a3cb/mail/components/accountcreation/content/emailWizard.js">mail/components/accountcreation/content/emailWizard.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/741493b66b6abddfa227c1dd08c91bf11367a3cb/mail/components/accountcreation/content/emailWizard.js">file</a> |
<a href="/comm-central/annotate/741493b66b6abddfa227c1dd08c91bf11367a3cb/mail/components/accountcreation/content/emailWizard.js">annotate</a> |
<a href="/comm-central/diff/741493b66b6abddfa227c1dd08c91bf11367a3cb/mail/components/accountcreation/content/emailWizard.js">diff</a> |
<a href="/comm-central/comparison/741493b66b6abddfa227c1dd08c91bf11367a3cb/mail/components/accountcreation/content/emailWizard.js">comparison</a> |
<a href="/comm-central/log/741493b66b6abddfa227c1dd08c91bf11367a3cb/mail/components/accountcreation/content/emailWizard.js">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/741493b66b6abddfa227c1dd08c91bf11367a3cb/mail/components/addrbook/content/abTrees.js">mail/components/addrbook/content/abTrees.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/741493b66b6abddfa227c1dd08c91bf11367a3cb/mail/components/addrbook/content/abTrees.js">file</a> |
<a href="/comm-central/annotate/741493b66b6abddfa227c1dd08c91bf11367a3cb/mail/components/addrbook/content/abTrees.js">annotate</a> |
<a href="/comm-central/diff/741493b66b6abddfa227c1dd08c91bf11367a3cb/mail/components/addrbook/content/abTrees.js">diff</a> |
<a href="/comm-central/comparison/741493b66b6abddfa227c1dd08c91bf11367a3cb/mail/components/addrbook/content/abTrees.js">comparison</a> |
<a href="/comm-central/log/741493b66b6abddfa227c1dd08c91bf11367a3cb/mail/components/addrbook/content/abTrees.js">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/741493b66b6abddfa227c1dd08c91bf11367a3cb/mail/components/addrbook/content/addressbook.js">mail/components/addrbook/content/addressbook.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/741493b66b6abddfa227c1dd08c91bf11367a3cb/mail/components/addrbook/content/addressbook.js">file</a> |
<a href="/comm-central/annotate/741493b66b6abddfa227c1dd08c91bf11367a3cb/mail/components/addrbook/content/addressbook.js">annotate</a> |
<a href="/comm-central/diff/741493b66b6abddfa227c1dd08c91bf11367a3cb/mail/components/addrbook/content/addressbook.js">diff</a> |
<a href="/comm-central/comparison/741493b66b6abddfa227c1dd08c91bf11367a3cb/mail/components/addrbook/content/addressbook.js">comparison</a> |
<a href="/comm-central/log/741493b66b6abddfa227c1dd08c91bf11367a3cb/mail/components/addrbook/content/addressbook.js">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/741493b66b6abddfa227c1dd08c91bf11367a3cb/mail/components/addrbook/content/menulist-addrbooks.js">mail/components/addrbook/content/menulist-addrbooks.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/741493b66b6abddfa227c1dd08c91bf11367a3cb/mail/components/addrbook/content/menulist-addrbooks.js">file</a> |
<a href="/comm-central/annotate/741493b66b6abddfa227c1dd08c91bf11367a3cb/mail/components/addrbook/content/menulist-addrbooks.js">annotate</a> |
<a href="/comm-central/diff/741493b66b6abddfa227c1dd08c91bf11367a3cb/mail/components/addrbook/content/menulist-addrbooks.js">diff</a> |
<a href="/comm-central/comparison/741493b66b6abddfa227c1dd08c91bf11367a3cb/mail/components/addrbook/content/menulist-addrbooks.js">comparison</a> |
<a href="/comm-central/log/741493b66b6abddfa227c1dd08c91bf11367a3cb/mail/components/addrbook/content/menulist-addrbooks.js">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/741493b66b6abddfa227c1dd08c91bf11367a3cb/mail/components/compose/content/MsgComposeCommands.js">mail/components/compose/content/MsgComposeCommands.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/741493b66b6abddfa227c1dd08c91bf11367a3cb/mail/components/compose/content/MsgComposeCommands.js">file</a> |
<a href="/comm-central/annotate/741493b66b6abddfa227c1dd08c91bf11367a3cb/mail/components/compose/content/MsgComposeCommands.js">annotate</a> |
<a href="/comm-central/diff/741493b66b6abddfa227c1dd08c91bf11367a3cb/mail/components/compose/content/MsgComposeCommands.js">diff</a> |
<a href="/comm-central/comparison/741493b66b6abddfa227c1dd08c91bf11367a3cb/mail/components/compose/content/MsgComposeCommands.js">comparison</a> |
<a href="/comm-central/log/741493b66b6abddfa227c1dd08c91bf11367a3cb/mail/components/compose/content/MsgComposeCommands.js">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/741493b66b6abddfa227c1dd08c91bf11367a3cb/mail/components/compose/content/editor.js">mail/components/compose/content/editor.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/741493b66b6abddfa227c1dd08c91bf11367a3cb/mail/components/compose/content/editor.js">file</a> |
<a href="/comm-central/annotate/741493b66b6abddfa227c1dd08c91bf11367a3cb/mail/components/compose/content/editor.js">annotate</a> |
<a href="/comm-central/diff/741493b66b6abddfa227c1dd08c91bf11367a3cb/mail/components/compose/content/editor.js">diff</a> |
<a href="/comm-central/comparison/741493b66b6abddfa227c1dd08c91bf11367a3cb/mail/components/compose/content/editor.js">comparison</a> |
<a href="/comm-central/log/741493b66b6abddfa227c1dd08c91bf11367a3cb/mail/components/compose/content/editor.js">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/741493b66b6abddfa227c1dd08c91bf11367a3cb/mail/components/extensions/parent/ext-mail.js">mail/components/extensions/parent/ext-mail.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/741493b66b6abddfa227c1dd08c91bf11367a3cb/mail/components/extensions/parent/ext-mail.js">file</a> |
<a href="/comm-central/annotate/741493b66b6abddfa227c1dd08c91bf11367a3cb/mail/components/extensions/parent/ext-mail.js">annotate</a> |
<a href="/comm-central/diff/741493b66b6abddfa227c1dd08c91bf11367a3cb/mail/components/extensions/parent/ext-mail.js">diff</a> |
<a href="/comm-central/comparison/741493b66b6abddfa227c1dd08c91bf11367a3cb/mail/components/extensions/parent/ext-mail.js">comparison</a> |
<a href="/comm-central/log/741493b66b6abddfa227c1dd08c91bf11367a3cb/mail/components/extensions/parent/ext-mail.js">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/741493b66b6abddfa227c1dd08c91bf11367a3cb/mail/components/im/IMIncomingServer.jsm">mail/components/im/IMIncomingServer.jsm</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/741493b66b6abddfa227c1dd08c91bf11367a3cb/mail/components/im/IMIncomingServer.jsm">file</a> |
<a href="/comm-central/annotate/741493b66b6abddfa227c1dd08c91bf11367a3cb/mail/components/im/IMIncomingServer.jsm">annotate</a> |
<a href="/comm-central/diff/741493b66b6abddfa227c1dd08c91bf11367a3cb/mail/components/im/IMIncomingServer.jsm">diff</a> |
<a href="/comm-central/comparison/741493b66b6abddfa227c1dd08c91bf11367a3cb/mail/components/im/IMIncomingServer.jsm">comparison</a> |
<a href="/comm-central/log/741493b66b6abddfa227c1dd08c91bf11367a3cb/mail/components/im/IMIncomingServer.jsm">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/741493b66b6abddfa227c1dd08c91bf11367a3cb/mail/components/im/content/addbuddy.js">mail/components/im/content/addbuddy.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/741493b66b6abddfa227c1dd08c91bf11367a3cb/mail/components/im/content/addbuddy.js">file</a> |
<a href="/comm-central/annotate/741493b66b6abddfa227c1dd08c91bf11367a3cb/mail/components/im/content/addbuddy.js">annotate</a> |
<a href="/comm-central/diff/741493b66b6abddfa227c1dd08c91bf11367a3cb/mail/components/im/content/addbuddy.js">diff</a> |
<a href="/comm-central/comparison/741493b66b6abddfa227c1dd08c91bf11367a3cb/mail/components/im/content/addbuddy.js">comparison</a> |
<a href="/comm-central/log/741493b66b6abddfa227c1dd08c91bf11367a3cb/mail/components/im/content/addbuddy.js">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/741493b66b6abddfa227c1dd08c91bf11367a3cb/mail/components/im/content/am-im.js">mail/components/im/content/am-im.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/741493b66b6abddfa227c1dd08c91bf11367a3cb/mail/components/im/content/am-im.js">file</a> |
<a href="/comm-central/annotate/741493b66b6abddfa227c1dd08c91bf11367a3cb/mail/components/im/content/am-im.js">annotate</a> |
<a href="/comm-central/diff/741493b66b6abddfa227c1dd08c91bf11367a3cb/mail/components/im/content/am-im.js">diff</a> |
<a href="/comm-central/comparison/741493b66b6abddfa227c1dd08c91bf11367a3cb/mail/components/im/content/am-im.js">comparison</a> |
<a href="/comm-central/log/741493b66b6abddfa227c1dd08c91bf11367a3cb/mail/components/im/content/am-im.js">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/741493b66b6abddfa227c1dd08c91bf11367a3cb/mail/components/im/content/chat-conversation.js">mail/components/im/content/chat-conversation.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/741493b66b6abddfa227c1dd08c91bf11367a3cb/mail/components/im/content/chat-conversation.js">file</a> |
<a href="/comm-central/annotate/741493b66b6abddfa227c1dd08c91bf11367a3cb/mail/components/im/content/chat-conversation.js">annotate</a> |
<a href="/comm-central/diff/741493b66b6abddfa227c1dd08c91bf11367a3cb/mail/components/im/content/chat-conversation.js">diff</a> |
<a href="/comm-central/comparison/741493b66b6abddfa227c1dd08c91bf11367a3cb/mail/components/im/content/chat-conversation.js">comparison</a> |
<a href="/comm-central/log/741493b66b6abddfa227c1dd08c91bf11367a3cb/mail/components/im/content/chat-conversation.js">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/741493b66b6abddfa227c1dd08c91bf11367a3cb/mail/components/im/content/chat-messenger.js">mail/components/im/content/chat-messenger.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/741493b66b6abddfa227c1dd08c91bf11367a3cb/mail/components/im/content/chat-messenger.js">file</a> |
<a href="/comm-central/annotate/741493b66b6abddfa227c1dd08c91bf11367a3cb/mail/components/im/content/chat-messenger.js">annotate</a> |
<a href="/comm-central/diff/741493b66b6abddfa227c1dd08c91bf11367a3cb/mail/components/im/content/chat-messenger.js">diff</a> |
<a href="/comm-central/comparison/741493b66b6abddfa227c1dd08c91bf11367a3cb/mail/components/im/content/chat-messenger.js">comparison</a> |
<a href="/comm-central/log/741493b66b6abddfa227c1dd08c91bf11367a3cb/mail/components/im/content/chat-messenger.js">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/741493b66b6abddfa227c1dd08c91bf11367a3cb/mail/components/im/content/imAccountWizard.js">mail/components/im/content/imAccountWizard.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/741493b66b6abddfa227c1dd08c91bf11367a3cb/mail/components/im/content/imAccountWizard.js">file</a> |
<a href="/comm-central/annotate/741493b66b6abddfa227c1dd08c91bf11367a3cb/mail/components/im/content/imAccountWizard.js">annotate</a> |
<a href="/comm-central/diff/741493b66b6abddfa227c1dd08c91bf11367a3cb/mail/components/im/content/imAccountWizard.js">diff</a> |
<a href="/comm-central/comparison/741493b66b6abddfa227c1dd08c91bf11367a3cb/mail/components/im/content/imAccountWizard.js">comparison</a> |
<a href="/comm-central/log/741493b66b6abddfa227c1dd08c91bf11367a3cb/mail/components/im/content/imAccountWizard.js">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/741493b66b6abddfa227c1dd08c91bf11367a3cb/mail/components/im/content/imAccounts.js">mail/components/im/content/imAccounts.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/741493b66b6abddfa227c1dd08c91bf11367a3cb/mail/components/im/content/imAccounts.js">file</a> |
<a href="/comm-central/annotate/741493b66b6abddfa227c1dd08c91bf11367a3cb/mail/components/im/content/imAccounts.js">annotate</a> |
<a href="/comm-central/diff/741493b66b6abddfa227c1dd08c91bf11367a3cb/mail/components/im/content/imAccounts.js">diff</a> |
<a href="/comm-central/comparison/741493b66b6abddfa227c1dd08c91bf11367a3cb/mail/components/im/content/imAccounts.js">comparison</a> |
<a href="/comm-central/log/741493b66b6abddfa227c1dd08c91bf11367a3cb/mail/components/im/content/imAccounts.js">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/741493b66b6abddfa227c1dd08c91bf11367a3cb/mail/components/im/content/joinchat.js">mail/components/im/content/joinchat.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/741493b66b6abddfa227c1dd08c91bf11367a3cb/mail/components/im/content/joinchat.js">file</a> |
<a href="/comm-central/annotate/741493b66b6abddfa227c1dd08c91bf11367a3cb/mail/components/im/content/joinchat.js">annotate</a> |
<a href="/comm-central/diff/741493b66b6abddfa227c1dd08c91bf11367a3cb/mail/components/im/content/joinchat.js">diff</a> |
<a href="/comm-central/comparison/741493b66b6abddfa227c1dd08c91bf11367a3cb/mail/components/im/content/joinchat.js">comparison</a> |
<a href="/comm-central/log/741493b66b6abddfa227c1dd08c91bf11367a3cb/mail/components/im/content/joinchat.js">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/741493b66b6abddfa227c1dd08c91bf11367a3cb/mail/components/im/modules/chatHandler.jsm">mail/components/im/modules/chatHandler.jsm</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/741493b66b6abddfa227c1dd08c91bf11367a3cb/mail/components/im/modules/chatHandler.jsm">file</a> |
<a href="/comm-central/annotate/741493b66b6abddfa227c1dd08c91bf11367a3cb/mail/components/im/modules/chatHandler.jsm">annotate</a> |
<a href="/comm-central/diff/741493b66b6abddfa227c1dd08c91bf11367a3cb/mail/components/im/modules/chatHandler.jsm">diff</a> |
<a href="/comm-central/comparison/741493b66b6abddfa227c1dd08c91bf11367a3cb/mail/components/im/modules/chatHandler.jsm">comparison</a> |
<a href="/comm-central/log/741493b66b6abddfa227c1dd08c91bf11367a3cb/mail/components/im/modules/chatHandler.jsm">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/741493b66b6abddfa227c1dd08c91bf11367a3cb/mail/components/im/modules/index_im.jsm">mail/components/im/modules/index_im.jsm</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/741493b66b6abddfa227c1dd08c91bf11367a3cb/mail/components/im/modules/index_im.jsm">file</a> |
<a href="/comm-central/annotate/741493b66b6abddfa227c1dd08c91bf11367a3cb/mail/components/im/modules/index_im.jsm">annotate</a> |
<a href="/comm-central/diff/741493b66b6abddfa227c1dd08c91bf11367a3cb/mail/components/im/modules/index_im.jsm">diff</a> |
<a href="/comm-central/comparison/741493b66b6abddfa227c1dd08c91bf11367a3cb/mail/components/im/modules/index_im.jsm">comparison</a> |
<a href="/comm-central/log/741493b66b6abddfa227c1dd08c91bf11367a3cb/mail/components/im/modules/index_im.jsm">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/741493b66b6abddfa227c1dd08c91bf11367a3cb/mail/components/preferences/cookies.js">mail/components/preferences/cookies.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/741493b66b6abddfa227c1dd08c91bf11367a3cb/mail/components/preferences/cookies.js">file</a> |
<a href="/comm-central/annotate/741493b66b6abddfa227c1dd08c91bf11367a3cb/mail/components/preferences/cookies.js">annotate</a> |
<a href="/comm-central/diff/741493b66b6abddfa227c1dd08c91bf11367a3cb/mail/components/preferences/cookies.js">diff</a> |
<a href="/comm-central/comparison/741493b66b6abddfa227c1dd08c91bf11367a3cb/mail/components/preferences/cookies.js">comparison</a> |
<a href="/comm-central/log/741493b66b6abddfa227c1dd08c91bf11367a3cb/mail/components/preferences/cookies.js">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/741493b66b6abddfa227c1dd08c91bf11367a3cb/mail/components/preferences/general.js">mail/components/preferences/general.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/741493b66b6abddfa227c1dd08c91bf11367a3cb/mail/components/preferences/general.js">file</a> |
<a href="/comm-central/annotate/741493b66b6abddfa227c1dd08c91bf11367a3cb/mail/components/preferences/general.js">annotate</a> |
<a href="/comm-central/diff/741493b66b6abddfa227c1dd08c91bf11367a3cb/mail/components/preferences/general.js">diff</a> |
<a href="/comm-central/comparison/741493b66b6abddfa227c1dd08c91bf11367a3cb/mail/components/preferences/general.js">comparison</a> |
<a href="/comm-central/log/741493b66b6abddfa227c1dd08c91bf11367a3cb/mail/components/preferences/general.js">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/741493b66b6abddfa227c1dd08c91bf11367a3cb/mail/components/search/SearchIntegration.jsm">mail/components/search/SearchIntegration.jsm</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/741493b66b6abddfa227c1dd08c91bf11367a3cb/mail/components/search/SearchIntegration.jsm">file</a> |
<a href="/comm-central/annotate/741493b66b6abddfa227c1dd08c91bf11367a3cb/mail/components/search/SearchIntegration.jsm">annotate</a> |
<a href="/comm-central/diff/741493b66b6abddfa227c1dd08c91bf11367a3cb/mail/components/search/SearchIntegration.jsm">diff</a> |
<a href="/comm-central/comparison/741493b66b6abddfa227c1dd08c91bf11367a3cb/mail/components/search/SearchIntegration.jsm">comparison</a> |
<a href="/comm-central/log/741493b66b6abddfa227c1dd08c91bf11367a3cb/mail/components/search/SearchIntegration.jsm">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/741493b66b6abddfa227c1dd08c91bf11367a3cb/mail/extensions/openpgp/content/modules/addrbook.jsm">mail/extensions/openpgp/content/modules/addrbook.jsm</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/741493b66b6abddfa227c1dd08c91bf11367a3cb/mail/extensions/openpgp/content/modules/addrbook.jsm">file</a> |
<a href="/comm-central/annotate/741493b66b6abddfa227c1dd08c91bf11367a3cb/mail/extensions/openpgp/content/modules/addrbook.jsm">annotate</a> |
<a href="/comm-central/diff/741493b66b6abddfa227c1dd08c91bf11367a3cb/mail/extensions/openpgp/content/modules/addrbook.jsm">diff</a> |
<a href="/comm-central/comparison/741493b66b6abddfa227c1dd08c91bf11367a3cb/mail/extensions/openpgp/content/modules/addrbook.jsm">comparison</a> |
<a href="/comm-central/log/741493b66b6abddfa227c1dd08c91bf11367a3cb/mail/extensions/openpgp/content/modules/addrbook.jsm">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/741493b66b6abddfa227c1dd08c91bf11367a3cb/mail/extensions/openpgp/content/modules/autoSetup.jsm">mail/extensions/openpgp/content/modules/autoSetup.jsm</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/741493b66b6abddfa227c1dd08c91bf11367a3cb/mail/extensions/openpgp/content/modules/autoSetup.jsm">file</a> |
<a href="/comm-central/annotate/741493b66b6abddfa227c1dd08c91bf11367a3cb/mail/extensions/openpgp/content/modules/autoSetup.jsm">annotate</a> |
<a href="/comm-central/diff/741493b66b6abddfa227c1dd08c91bf11367a3cb/mail/extensions/openpgp/content/modules/autoSetup.jsm">diff</a> |
<a href="/comm-central/comparison/741493b66b6abddfa227c1dd08c91bf11367a3cb/mail/extensions/openpgp/content/modules/autoSetup.jsm">comparison</a> |
<a href="/comm-central/log/741493b66b6abddfa227c1dd08c91bf11367a3cb/mail/extensions/openpgp/content/modules/autoSetup.jsm">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/741493b66b6abddfa227c1dd08c91bf11367a3cb/mail/extensions/openpgp/content/modules/files.jsm">mail/extensions/openpgp/content/modules/files.jsm</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/741493b66b6abddfa227c1dd08c91bf11367a3cb/mail/extensions/openpgp/content/modules/files.jsm">file</a> |
<a href="/comm-central/annotate/741493b66b6abddfa227c1dd08c91bf11367a3cb/mail/extensions/openpgp/content/modules/files.jsm">annotate</a> |
<a href="/comm-central/diff/741493b66b6abddfa227c1dd08c91bf11367a3cb/mail/extensions/openpgp/content/modules/files.jsm">diff</a> |
<a href="/comm-central/comparison/741493b66b6abddfa227c1dd08c91bf11367a3cb/mail/extensions/openpgp/content/modules/files.jsm">comparison</a> |
<a href="/comm-central/log/741493b66b6abddfa227c1dd08c91bf11367a3cb/mail/extensions/openpgp/content/modules/files.jsm">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/741493b66b6abddfa227c1dd08c91bf11367a3cb/mail/extensions/openpgp/content/modules/funcs.jsm">mail/extensions/openpgp/content/modules/funcs.jsm</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/741493b66b6abddfa227c1dd08c91bf11367a3cb/mail/extensions/openpgp/content/modules/funcs.jsm">file</a> |
<a href="/comm-central/annotate/741493b66b6abddfa227c1dd08c91bf11367a3cb/mail/extensions/openpgp/content/modules/funcs.jsm">annotate</a> |
<a href="/comm-central/diff/741493b66b6abddfa227c1dd08c91bf11367a3cb/mail/extensions/openpgp/content/modules/funcs.jsm">diff</a> |
<a href="/comm-central/comparison/741493b66b6abddfa227c1dd08c91bf11367a3cb/mail/extensions/openpgp/content/modules/funcs.jsm">comparison</a> |
<a href="/comm-central/log/741493b66b6abddfa227c1dd08c91bf11367a3cb/mail/extensions/openpgp/content/modules/funcs.jsm">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/741493b66b6abddfa227c1dd08c91bf11367a3cb/mail/extensions/openpgp/content/modules/keyserver.jsm">mail/extensions/openpgp/content/modules/keyserver.jsm</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/741493b66b6abddfa227c1dd08c91bf11367a3cb/mail/extensions/openpgp/content/modules/keyserver.jsm">file</a> |
<a href="/comm-central/annotate/741493b66b6abddfa227c1dd08c91bf11367a3cb/mail/extensions/openpgp/content/modules/keyserver.jsm">annotate</a> |
<a href="/comm-central/diff/741493b66b6abddfa227c1dd08c91bf11367a3cb/mail/extensions/openpgp/content/modules/keyserver.jsm">diff</a> |
<a href="/comm-central/comparison/741493b66b6abddfa227c1dd08c91bf11367a3cb/mail/extensions/openpgp/content/modules/keyserver.jsm">comparison</a> |
<a href="/comm-central/log/741493b66b6abddfa227c1dd08c91bf11367a3cb/mail/extensions/openpgp/content/modules/keyserver.jsm">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/741493b66b6abddfa227c1dd08c91bf11367a3cb/mail/extensions/openpgp/content/modules/pgpmimeHandler.jsm">mail/extensions/openpgp/content/modules/pgpmimeHandler.jsm</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/741493b66b6abddfa227c1dd08c91bf11367a3cb/mail/extensions/openpgp/content/modules/pgpmimeHandler.jsm">file</a> |
<a href="/comm-central/annotate/741493b66b6abddfa227c1dd08c91bf11367a3cb/mail/extensions/openpgp/content/modules/pgpmimeHandler.jsm">annotate</a> |
<a href="/comm-central/diff/741493b66b6abddfa227c1dd08c91bf11367a3cb/mail/extensions/openpgp/content/modules/pgpmimeHandler.jsm">diff</a> |
<a href="/comm-central/comparison/741493b66b6abddfa227c1dd08c91bf11367a3cb/mail/extensions/openpgp/content/modules/pgpmimeHandler.jsm">comparison</a> |
<a href="/comm-central/log/741493b66b6abddfa227c1dd08c91bf11367a3cb/mail/extensions/openpgp/content/modules/pgpmimeHandler.jsm">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/741493b66b6abddfa227c1dd08c91bf11367a3cb/mail/extensions/openpgp/content/modules/protocolHandler.jsm">mail/extensions/openpgp/content/modules/protocolHandler.jsm</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/741493b66b6abddfa227c1dd08c91bf11367a3cb/mail/extensions/openpgp/content/modules/protocolHandler.jsm">file</a> |
<a href="/comm-central/annotate/741493b66b6abddfa227c1dd08c91bf11367a3cb/mail/extensions/openpgp/content/modules/protocolHandler.jsm">annotate</a> |
<a href="/comm-central/diff/741493b66b6abddfa227c1dd08c91bf11367a3cb/mail/extensions/openpgp/content/modules/protocolHandler.jsm">diff</a> |
<a href="/comm-central/comparison/741493b66b6abddfa227c1dd08c91bf11367a3cb/mail/extensions/openpgp/content/modules/protocolHandler.jsm">comparison</a> |
<a href="/comm-central/log/741493b66b6abddfa227c1dd08c91bf11367a3cb/mail/extensions/openpgp/content/modules/protocolHandler.jsm">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/741493b66b6abddfa227c1dd08c91bf11367a3cb/mail/extensions/openpgp/content/modules/windows.jsm">mail/extensions/openpgp/content/modules/windows.jsm</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/741493b66b6abddfa227c1dd08c91bf11367a3cb/mail/extensions/openpgp/content/modules/windows.jsm">file</a> |
<a href="/comm-central/annotate/741493b66b6abddfa227c1dd08c91bf11367a3cb/mail/extensions/openpgp/content/modules/windows.jsm">annotate</a> |
<a href="/comm-central/diff/741493b66b6abddfa227c1dd08c91bf11367a3cb/mail/extensions/openpgp/content/modules/windows.jsm">diff</a> |
<a href="/comm-central/comparison/741493b66b6abddfa227c1dd08c91bf11367a3cb/mail/extensions/openpgp/content/modules/windows.jsm">comparison</a> |
<a href="/comm-central/log/741493b66b6abddfa227c1dd08c91bf11367a3cb/mail/extensions/openpgp/content/modules/windows.jsm">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/741493b66b6abddfa227c1dd08c91bf11367a3cb/mail/extensions/openpgp/content/ui/enigmailKeyManager.js">mail/extensions/openpgp/content/ui/enigmailKeyManager.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/741493b66b6abddfa227c1dd08c91bf11367a3cb/mail/extensions/openpgp/content/ui/enigmailKeyManager.js">file</a> |
<a href="/comm-central/annotate/741493b66b6abddfa227c1dd08c91bf11367a3cb/mail/extensions/openpgp/content/ui/enigmailKeyManager.js">annotate</a> |
<a href="/comm-central/diff/741493b66b6abddfa227c1dd08c91bf11367a3cb/mail/extensions/openpgp/content/ui/enigmailKeyManager.js">diff</a> |
<a href="/comm-central/comparison/741493b66b6abddfa227c1dd08c91bf11367a3cb/mail/extensions/openpgp/content/ui/enigmailKeyManager.js">comparison</a> |
<a href="/comm-central/log/741493b66b6abddfa227c1dd08c91bf11367a3cb/mail/extensions/openpgp/content/ui/enigmailKeyManager.js">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/741493b66b6abddfa227c1dd08c91bf11367a3cb/mail/test/browser/composition/browser_drafts.js">mail/test/browser/composition/browser_drafts.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/741493b66b6abddfa227c1dd08c91bf11367a3cb/mail/test/browser/composition/browser_drafts.js">file</a> |
<a href="/comm-central/annotate/741493b66b6abddfa227c1dd08c91bf11367a3cb/mail/test/browser/composition/browser_drafts.js">annotate</a> |
<a href="/comm-central/diff/741493b66b6abddfa227c1dd08c91bf11367a3cb/mail/test/browser/composition/browser_drafts.js">diff</a> |
<a href="/comm-central/comparison/741493b66b6abddfa227c1dd08c91bf11367a3cb/mail/test/browser/composition/browser_drafts.js">comparison</a> |
<a href="/comm-central/log/741493b66b6abddfa227c1dd08c91bf11367a3cb/mail/test/browser/composition/browser_drafts.js">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/741493b66b6abddfa227c1dd08c91bf11367a3cb/mail/test/browser/folder-display/browser_messageCommandsOnMsgstore.js">mail/test/browser/folder-display/browser_messageCommandsOnMsgstore.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/741493b66b6abddfa227c1dd08c91bf11367a3cb/mail/test/browser/folder-display/browser_messageCommandsOnMsgstore.js">file</a> |
<a href="/comm-central/annotate/741493b66b6abddfa227c1dd08c91bf11367a3cb/mail/test/browser/folder-display/browser_messageCommandsOnMsgstore.js">annotate</a> |
<a href="/comm-central/diff/741493b66b6abddfa227c1dd08c91bf11367a3cb/mail/test/browser/folder-display/browser_messageCommandsOnMsgstore.js">diff</a> |
<a href="/comm-central/comparison/741493b66b6abddfa227c1dd08c91bf11367a3cb/mail/test/browser/folder-display/browser_messageCommandsOnMsgstore.js">comparison</a> |
<a href="/comm-central/log/741493b66b6abddfa227c1dd08c91bf11367a3cb/mail/test/browser/folder-display/browser_messageCommandsOnMsgstore.js">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/741493b66b6abddfa227c1dd08c91bf11367a3cb/mail/test/browser/quick-filter-bar/browser_filterLogic.js">mail/test/browser/quick-filter-bar/browser_filterLogic.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/741493b66b6abddfa227c1dd08c91bf11367a3cb/mail/test/browser/quick-filter-bar/browser_filterLogic.js">file</a> |
<a href="/comm-central/annotate/741493b66b6abddfa227c1dd08c91bf11367a3cb/mail/test/browser/quick-filter-bar/browser_filterLogic.js">annotate</a> |
<a href="/comm-central/diff/741493b66b6abddfa227c1dd08c91bf11367a3cb/mail/test/browser/quick-filter-bar/browser_filterLogic.js">diff</a> |
<a href="/comm-central/comparison/741493b66b6abddfa227c1dd08c91bf11367a3cb/mail/test/browser/quick-filter-bar/browser_filterLogic.js">comparison</a> |
<a href="/comm-central/log/741493b66b6abddfa227c1dd08c91bf11367a3cb/mail/test/browser/quick-filter-bar/browser_filterLogic.js">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/741493b66b6abddfa227c1dd08c91bf11367a3cb/mail/test/browser/session-store/browser_sessionStore.js">mail/test/browser/session-store/browser_sessionStore.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/741493b66b6abddfa227c1dd08c91bf11367a3cb/mail/test/browser/session-store/browser_sessionStore.js">file</a> |
<a href="/comm-central/annotate/741493b66b6abddfa227c1dd08c91bf11367a3cb/mail/test/browser/session-store/browser_sessionStore.js">annotate</a> |
<a href="/comm-central/diff/741493b66b6abddfa227c1dd08c91bf11367a3cb/mail/test/browser/session-store/browser_sessionStore.js">diff</a> |
<a href="/comm-central/comparison/741493b66b6abddfa227c1dd08c91bf11367a3cb/mail/test/browser/session-store/browser_sessionStore.js">comparison</a> |
<a href="/comm-central/log/741493b66b6abddfa227c1dd08c91bf11367a3cb/mail/test/browser/session-store/browser_sessionStore.js">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/741493b66b6abddfa227c1dd08c91bf11367a3cb/mail/test/browser/shared-modules/AddressBookHelpers.jsm">mail/test/browser/shared-modules/AddressBookHelpers.jsm</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/741493b66b6abddfa227c1dd08c91bf11367a3cb/mail/test/browser/shared-modules/AddressBookHelpers.jsm">file</a> |
<a href="/comm-central/annotate/741493b66b6abddfa227c1dd08c91bf11367a3cb/mail/test/browser/shared-modules/AddressBookHelpers.jsm">annotate</a> |
<a href="/comm-central/diff/741493b66b6abddfa227c1dd08c91bf11367a3cb/mail/test/browser/shared-modules/AddressBookHelpers.jsm">diff</a> |
<a href="/comm-central/comparison/741493b66b6abddfa227c1dd08c91bf11367a3cb/mail/test/browser/shared-modules/AddressBookHelpers.jsm">comparison</a> |
<a href="/comm-central/log/741493b66b6abddfa227c1dd08c91bf11367a3cb/mail/test/browser/shared-modules/AddressBookHelpers.jsm">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/741493b66b6abddfa227c1dd08c91bf11367a3cb/mail/test/browser/shared-modules/WindowHelpers.jsm">mail/test/browser/shared-modules/WindowHelpers.jsm</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/741493b66b6abddfa227c1dd08c91bf11367a3cb/mail/test/browser/shared-modules/WindowHelpers.jsm">file</a> |
<a href="/comm-central/annotate/741493b66b6abddfa227c1dd08c91bf11367a3cb/mail/test/browser/shared-modules/WindowHelpers.jsm">annotate</a> |
<a href="/comm-central/diff/741493b66b6abddfa227c1dd08c91bf11367a3cb/mail/test/browser/shared-modules/WindowHelpers.jsm">diff</a> |
<a href="/comm-central/comparison/741493b66b6abddfa227c1dd08c91bf11367a3cb/mail/test/browser/shared-modules/WindowHelpers.jsm">comparison</a> |
<a href="/comm-central/log/741493b66b6abddfa227c1dd08c91bf11367a3cb/mail/test/browser/shared-modules/WindowHelpers.jsm">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/741493b66b6abddfa227c1dd08c91bf11367a3cb/mail/test/browser/shared-modules/httpd.jsm">mail/test/browser/shared-modules/httpd.jsm</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/741493b66b6abddfa227c1dd08c91bf11367a3cb/mail/test/browser/shared-modules/httpd.jsm">file</a> |
<a href="/comm-central/annotate/741493b66b6abddfa227c1dd08c91bf11367a3cb/mail/test/browser/shared-modules/httpd.jsm">annotate</a> |
<a href="/comm-central/diff/741493b66b6abddfa227c1dd08c91bf11367a3cb/mail/test/browser/shared-modules/httpd.jsm">diff</a> |
<a href="/comm-central/comparison/741493b66b6abddfa227c1dd08c91bf11367a3cb/mail/test/browser/shared-modules/httpd.jsm">comparison</a> |
<a href="/comm-central/log/741493b66b6abddfa227c1dd08c91bf11367a3cb/mail/test/browser/shared-modules/httpd.jsm">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/741493b66b6abddfa227c1dd08c91bf11367a3cb/mail/test/browser/shared-modules/init.jsm">mail/test/browser/shared-modules/init.jsm</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/741493b66b6abddfa227c1dd08c91bf11367a3cb/mail/test/browser/shared-modules/init.jsm">file</a> |
<a href="/comm-central/annotate/741493b66b6abddfa227c1dd08c91bf11367a3cb/mail/test/browser/shared-modules/init.jsm">annotate</a> |
<a href="/comm-central/diff/741493b66b6abddfa227c1dd08c91bf11367a3cb/mail/test/browser/shared-modules/init.jsm">diff</a> |
<a href="/comm-central/comparison/741493b66b6abddfa227c1dd08c91bf11367a3cb/mail/test/browser/shared-modules/init.jsm">comparison</a> |
<a href="/comm-central/log/741493b66b6abddfa227c1dd08c91bf11367a3cb/mail/test/browser/shared-modules/init.jsm">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/741493b66b6abddfa227c1dd08c91bf11367a3cb/mail/test/browser/shared-modules/os.jsm">mail/test/browser/shared-modules/os.jsm</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/741493b66b6abddfa227c1dd08c91bf11367a3cb/mail/test/browser/shared-modules/os.jsm">file</a> |
<a href="/comm-central/annotate/741493b66b6abddfa227c1dd08c91bf11367a3cb/mail/test/browser/shared-modules/os.jsm">annotate</a> |
<a href="/comm-central/diff/741493b66b6abddfa227c1dd08c91bf11367a3cb/mail/test/browser/shared-modules/os.jsm">diff</a> |
<a href="/comm-central/comparison/741493b66b6abddfa227c1dd08c91bf11367a3cb/mail/test/browser/shared-modules/os.jsm">comparison</a> |
<a href="/comm-central/log/741493b66b6abddfa227c1dd08c91bf11367a3cb/mail/test/browser/shared-modules/os.jsm">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/741493b66b6abddfa227c1dd08c91bf11367a3cb/mail/test/browser/shared-modules/utils.jsm">mail/test/browser/shared-modules/utils.jsm</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/741493b66b6abddfa227c1dd08c91bf11367a3cb/mail/test/browser/shared-modules/utils.jsm">file</a> |
<a href="/comm-central/annotate/741493b66b6abddfa227c1dd08c91bf11367a3cb/mail/test/browser/shared-modules/utils.jsm">annotate</a> |
<a href="/comm-central/diff/741493b66b6abddfa227c1dd08c91bf11367a3cb/mail/test/browser/shared-modules/utils.jsm">diff</a> |
<a href="/comm-central/comparison/741493b66b6abddfa227c1dd08c91bf11367a3cb/mail/test/browser/shared-modules/utils.jsm">comparison</a> |
<a href="/comm-central/log/741493b66b6abddfa227c1dd08c91bf11367a3cb/mail/test/browser/shared-modules/utils.jsm">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/741493b66b6abddfa227c1dd08c91bf11367a3cb/mail/test/browser/tabmail/browser_dragndrop.js">mail/test/browser/tabmail/browser_dragndrop.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/741493b66b6abddfa227c1dd08c91bf11367a3cb/mail/test/browser/tabmail/browser_dragndrop.js">file</a> |
<a href="/comm-central/annotate/741493b66b6abddfa227c1dd08c91bf11367a3cb/mail/test/browser/tabmail/browser_dragndrop.js">annotate</a> |
<a href="/comm-central/diff/741493b66b6abddfa227c1dd08c91bf11367a3cb/mail/test/browser/tabmail/browser_dragndrop.js">diff</a> |
<a href="/comm-central/comparison/741493b66b6abddfa227c1dd08c91bf11367a3cb/mail/test/browser/tabmail/browser_dragndrop.js">comparison</a> |
<a href="/comm-central/log/741493b66b6abddfa227c1dd08c91bf11367a3cb/mail/test/browser/tabmail/browser_dragndrop.js">revisions</a>
</td>
</tr>
</table></div>

<div class="page_body diffblocks"><div class="diffblock"><pre class="sourcelines">
<a href="#l1.1"></a><span id="l1.1" class="difflineminus">--- a/mail/base/content/SearchDialog.js</span>
<a href="#l1.2"></a><span id="l1.2" class="difflineplus">+++ b/mail/base/content/SearchDialog.js</span>
<a href="#l1.3"></a><span id="l1.3" class="difflineat">@@ -423,38 +423,31 @@ function getSearchFolders() {</span>
<a href="#l1.4"></a><span id="l1.4">   ) {</span>
<a href="#l1.5"></a><span id="l1.5">     AddSubFolders(gCurrentFolder, searchFolders);</span>
<a href="#l1.6"></a><span id="l1.6">   }</span>
<a href="#l1.7"></a><span id="l1.7"> </span>
<a href="#l1.8"></a><span id="l1.8">   return searchFolders;</span>
<a href="#l1.9"></a><span id="l1.9"> }</span>
<a href="#l1.10"></a><span id="l1.10"> </span>
<a href="#l1.11"></a><span id="l1.11"> function AddSubFolders(folder, outFolders) {</span>
<a href="#l1.12"></a><span id="l1.12" class="difflineminus">-  var subFolders = folder.subFolders;</span>
<a href="#l1.13"></a><span id="l1.13" class="difflineminus">-  while (subFolders.hasMoreElements()) {</span>
<a href="#l1.14"></a><span id="l1.14" class="difflineminus">-    var nextFolder = subFolders.getNext().QueryInterface(Ci.nsIMsgFolder);</span>
<a href="#l1.15"></a><span id="l1.15" class="difflineminus">-</span>
<a href="#l1.16"></a><span id="l1.16" class="difflineplus">+  for (let nextFolder of folder.subFolders) {</span>
<a href="#l1.17"></a><span id="l1.17">     if (!(nextFolder.flags &amp; Ci.nsMsgFolderFlags.Virtual)) {</span>
<a href="#l1.18"></a><span id="l1.18">       if (!nextFolder.noSelect) {</span>
<a href="#l1.19"></a><span id="l1.19">         outFolders.push(nextFolder);</span>
<a href="#l1.20"></a><span id="l1.20">       }</span>
<a href="#l1.21"></a><span id="l1.21"> </span>
<a href="#l1.22"></a><span id="l1.22">       AddSubFolders(nextFolder, outFolders);</span>
<a href="#l1.23"></a><span id="l1.23">     }</span>
<a href="#l1.24"></a><span id="l1.24">   }</span>
<a href="#l1.25"></a><span id="l1.25"> }</span>
<a href="#l1.26"></a><span id="l1.26"> </span>
<a href="#l1.27"></a><span id="l1.27"> function AddSubFoldersToURI(folder) {</span>
<a href="#l1.28"></a><span id="l1.28">   var returnString = &quot;&quot;;</span>
<a href="#l1.29"></a><span id="l1.29"> </span>
<a href="#l1.30"></a><span id="l1.30" class="difflineminus">-  var subFolders = folder.subFolders;</span>
<a href="#l1.31"></a><span id="l1.31" class="difflineminus">-</span>
<a href="#l1.32"></a><span id="l1.32" class="difflineminus">-  while (subFolders.hasMoreElements()) {</span>
<a href="#l1.33"></a><span id="l1.33" class="difflineminus">-    var nextFolder = subFolders.getNext().QueryInterface(Ci.nsIMsgFolder);</span>
<a href="#l1.34"></a><span id="l1.34" class="difflineminus">-</span>
<a href="#l1.35"></a><span id="l1.35" class="difflineplus">+  for (let nextFolder of folder.subFolders) {</span>
<a href="#l1.36"></a><span id="l1.36">     if (!(nextFolder.flags &amp; Ci.nsMsgFolderFlags.Virtual)) {</span>
<a href="#l1.37"></a><span id="l1.37">       if (!nextFolder.noSelect &amp;&amp; !nextFolder.isServer) {</span>
<a href="#l1.38"></a><span id="l1.38">         if (returnString.length &gt; 0) {</span>
<a href="#l1.39"></a><span id="l1.39">           returnString += &quot;|&quot;;</span>
<a href="#l1.40"></a><span id="l1.40">         }</span>
<a href="#l1.41"></a><span id="l1.41">         returnString += nextFolder.URI;</span>
<a href="#l1.42"></a><span id="l1.42">       }</span>
<a href="#l1.43"></a><span id="l1.43">       var subFoldersString = AddSubFoldersToURI(nextFolder);</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l2.1"></a><span id="l2.1" class="difflineminus">--- a/mail/base/content/folderPane.js</span>
<a href="#l2.2"></a><span id="l2.2" class="difflineplus">+++ b/mail/base/content/folderPane.js</span>
<a href="#l2.3"></a><span id="l2.3" class="difflineat">@@ -3141,19 +3141,18 @@ var gFolderTreeController = {</span>
<a href="#l2.4"></a><span id="l2.4">       return;</span>
<a href="#l2.5"></a><span id="l2.5">     }</span>
<a href="#l2.6"></a><span id="l2.6"> </span>
<a href="#l2.7"></a><span id="l2.7">     if (!this._checkConfirmationPrompt(&quot;emptyJunk&quot;, folder)) {</span>
<a href="#l2.8"></a><span id="l2.8">       return;</span>
<a href="#l2.9"></a><span id="l2.9">     }</span>
<a href="#l2.10"></a><span id="l2.10"> </span>
<a href="#l2.11"></a><span id="l2.11">     // Delete any subfolders this folder might have</span>
<a href="#l2.12"></a><span id="l2.12" class="difflineminus">-    let iter = folder.subFolders;</span>
<a href="#l2.13"></a><span id="l2.13" class="difflineminus">-    while (iter.hasMoreElements()) {</span>
<a href="#l2.14"></a><span id="l2.14" class="difflineminus">-      folder.propagateDelete(iter.getNext(), true, msgWindow);</span>
<a href="#l2.15"></a><span id="l2.15" class="difflineplus">+    for (let subFolder of folder.subFolders) {</span>
<a href="#l2.16"></a><span id="l2.16" class="difflineplus">+      folder.propagateDelete(subFolder, true, msgWindow);</span>
<a href="#l2.17"></a><span id="l2.17">     }</span>
<a href="#l2.18"></a><span id="l2.18"> </span>
<a href="#l2.19"></a><span id="l2.19">     // Now delete the messages</span>
<a href="#l2.20"></a><span id="l2.20">     let messages = Array.from(fixIterator(folder.messages));</span>
<a href="#l2.21"></a><span id="l2.21">     let children = toXPCOMArray(messages, Ci.nsIMutableArray);</span>
<a href="#l2.22"></a><span id="l2.22">     folder.deleteMessages(children, msgWindow, true, false, null, false);</span>
<a href="#l2.23"></a><span id="l2.23">   },</span>
<a href="#l2.24"></a><span id="l2.24"> </span>
<a href="#l2.25"></a><span id="l2.25" class="difflineat">@@ -3485,19 +3484,17 @@ var gFolderStatsHelpers = {</span>
<a href="#l2.26"></a><span id="l2.26">   /**</span>
<a href="#l2.27"></a><span id="l2.27">    * Get the total size of all subfolders of the specified folder.</span>
<a href="#l2.28"></a><span id="l2.28">    *</span>
<a href="#l2.29"></a><span id="l2.29">    * @param aFolder  The nsIMsgFolder to analyze.</span>
<a href="#l2.30"></a><span id="l2.30">    */</span>
<a href="#l2.31"></a><span id="l2.31">   getSubfoldersSize(aFolder) {</span>
<a href="#l2.32"></a><span id="l2.32">     let folderSize = 0;</span>
<a href="#l2.33"></a><span id="l2.33">     if (aFolder.hasSubFolders) {</span>
<a href="#l2.34"></a><span id="l2.34" class="difflineminus">-      let subFolders = aFolder.subFolders;</span>
<a href="#l2.35"></a><span id="l2.35" class="difflineminus">-      while (subFolders.hasMoreElements()) {</span>
<a href="#l2.36"></a><span id="l2.36" class="difflineminus">-        let subFolder = subFolders.getNext().QueryInterface(Ci.nsIMsgFolder);</span>
<a href="#l2.37"></a><span id="l2.37" class="difflineplus">+      for (let subFolder of aFolder.subFolders) {</span>
<a href="#l2.38"></a><span id="l2.38">         let subSize = this.getFolderSize(subFolder);</span>
<a href="#l2.39"></a><span id="l2.39">         let subSubSize = this.getSubfoldersSize(subFolder);</span>
<a href="#l2.40"></a><span id="l2.40">         if (subSize == this.kUnknownSize || subSubSize == this.kUnknownSize) {</span>
<a href="#l2.41"></a><span id="l2.41">           return subSize;</span>
<a href="#l2.42"></a><span id="l2.42">         }</span>
<a href="#l2.43"></a><span id="l2.43"> </span>
<a href="#l2.44"></a><span id="l2.44">         folderSize += subSize + subSubSize;</span>
<a href="#l2.45"></a><span id="l2.45">       }</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l3.1"></a><span id="l3.1" class="difflineminus">--- a/mail/base/content/mailCommands.js</span>
<a href="#l3.2"></a><span id="l3.2" class="difflineplus">+++ b/mail/base/content/mailCommands.js</span>
<a href="#l3.3"></a><span id="l3.3" class="difflineat">@@ -115,30 +115,28 @@ function ComposeMessage(type, format, fo</span>
<a href="#l3.4"></a><span id="l3.4">         ignoreQuote = true;</span>
<a href="#l3.5"></a><span id="l3.5">       }</span>
<a href="#l3.6"></a><span id="l3.6">     }</span>
<a href="#l3.7"></a><span id="l3.7">   }</span>
<a href="#l3.8"></a><span id="l3.8"> </span>
<a href="#l3.9"></a><span id="l3.9">   // Check if the draft is already open in another window. If it is, just focus the window.</span>
<a href="#l3.10"></a><span id="l3.10">   if (type == msgComposeType.Draft &amp;&amp; messageArray.length == 1) {</span>
<a href="#l3.11"></a><span id="l3.11">     // We'll search this uri in the opened windows.</span>
<a href="#l3.12"></a><span id="l3.12" class="difflineminus">-    let wenum = Services.wm.getEnumerator(&quot;&quot;);</span>
<a href="#l3.13"></a><span id="l3.13" class="difflineminus">-    while (wenum.hasMoreElements()) {</span>
<a href="#l3.14"></a><span id="l3.14" class="difflineminus">-      let w = wenum.getNext();</span>
<a href="#l3.15"></a><span id="l3.15" class="difflineplus">+    for (let win of Services.wm.getEnumerator(&quot;&quot;)) {</span>
<a href="#l3.16"></a><span id="l3.16">       // Check if it is a compose window.</span>
<a href="#l3.17"></a><span id="l3.17">       if (</span>
<a href="#l3.18"></a><span id="l3.18" class="difflineminus">-        w.document.defaultView.gMsgCompose &amp;&amp;</span>
<a href="#l3.19"></a><span id="l3.19" class="difflineminus">-        w.document.defaultView.gMsgCompose.compFields.draftId</span>
<a href="#l3.20"></a><span id="l3.20" class="difflineplus">+        win.document.defaultView.gMsgCompose &amp;&amp;</span>
<a href="#l3.21"></a><span id="l3.21" class="difflineplus">+        win.document.defaultView.gMsgCompose.compFields.draftId</span>
<a href="#l3.22"></a><span id="l3.22">       ) {</span>
<a href="#l3.23"></a><span id="l3.23">         let wKey = GetMsgKeyFromURI(</span>
<a href="#l3.24"></a><span id="l3.24" class="difflineminus">-          w.document.defaultView.gMsgCompose.compFields.draftId</span>
<a href="#l3.25"></a><span id="l3.25" class="difflineplus">+          win.document.defaultView.gMsgCompose.compFields.draftId</span>
<a href="#l3.26"></a><span id="l3.26">         );</span>
<a href="#l3.27"></a><span id="l3.27">         if (wKey == msgKey) {</span>
<a href="#l3.28"></a><span id="l3.28">           // Found ! just focus it...</span>
<a href="#l3.29"></a><span id="l3.29" class="difflineminus">-          w.focus();</span>
<a href="#l3.30"></a><span id="l3.30" class="difflineplus">+          win.focus();</span>
<a href="#l3.31"></a><span id="l3.31">           // ...and nothing to do anymore.</span>
<a href="#l3.32"></a><span id="l3.32">           return;</span>
<a href="#l3.33"></a><span id="l3.33">         }</span>
<a href="#l3.34"></a><span id="l3.34">       }</span>
<a href="#l3.35"></a><span id="l3.35">     }</span>
<a href="#l3.36"></a><span id="l3.36">   }</span>
<a href="#l3.37"></a><span id="l3.37">   var identity = null;</span>
<a href="#l3.38"></a><span id="l3.38">   var newsgroup = null;</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l4.1"></a><span id="l4.1" class="difflineminus">--- a/mail/base/content/mailContextMenus.js</span>
<a href="#l4.2"></a><span id="l4.2" class="difflineplus">+++ b/mail/base/content/mailContextMenus.js</span>
<a href="#l4.3"></a><span id="l4.3" class="difflineat">@@ -283,27 +283,25 @@ function OpenMessageByHeader(messageHead</span>
<a href="#l4.4"></a><span id="l4.4">     }</span>
<a href="#l4.5"></a><span id="l4.5">   }</span>
<a href="#l4.6"></a><span id="l4.6"> }</span>
<a href="#l4.7"></a><span id="l4.7"> </span>
<a href="#l4.8"></a><span id="l4.8"> // search for message by message id in given folder and its subfolders</span>
<a href="#l4.9"></a><span id="l4.9"> // return message header if message was found</span>
<a href="#l4.10"></a><span id="l4.10"> function SearchForMessageIdInSubFolder(folder, messageId) {</span>
<a href="#l4.11"></a><span id="l4.11">   var messageHeader;</span>
<a href="#l4.12"></a><span id="l4.12" class="difflineminus">-  var subFolders = folder.subFolders;</span>
<a href="#l4.13"></a><span id="l4.13"> </span>
<a href="#l4.14"></a><span id="l4.14">   // search in folder</span>
<a href="#l4.15"></a><span id="l4.15">   if (!folder.isServer) {</span>
<a href="#l4.16"></a><span id="l4.16">     messageHeader = CheckForMessageIdInFolder(folder, messageId);</span>
<a href="#l4.17"></a><span id="l4.17">   }</span>
<a href="#l4.18"></a><span id="l4.18"> </span>
<a href="#l4.19"></a><span id="l4.19">   // search subfolders recursively</span>
<a href="#l4.20"></a><span id="l4.20" class="difflineminus">-  while (subFolders.hasMoreElements() &amp;&amp; !messageHeader) {</span>
<a href="#l4.21"></a><span id="l4.21" class="difflineplus">+  for (let currentFolder of folder.subFolders &amp;&amp; !messageHeader) {</span>
<a href="#l4.22"></a><span id="l4.22">     // search in current folder</span>
<a href="#l4.23"></a><span id="l4.23" class="difflineminus">-    var currentFolder = subFolders.getNext().QueryInterface(Ci.nsIMsgFolder);</span>
<a href="#l4.24"></a><span id="l4.24">     messageHeader = CheckForMessageIdInFolder(currentFolder, messageId);</span>
<a href="#l4.25"></a><span id="l4.25"> </span>
<a href="#l4.26"></a><span id="l4.26">     // search in its subfolder</span>
<a href="#l4.27"></a><span id="l4.27">     if (!messageHeader &amp;&amp; currentFolder.hasSubFolders) {</span>
<a href="#l4.28"></a><span id="l4.28">       messageHeader = SearchForMessageIdInSubFolder(currentFolder, messageId);</span>
<a href="#l4.29"></a><span id="l4.29">     }</span>
<a href="#l4.30"></a><span id="l4.30">   }</span>
<a href="#l4.31"></a><span id="l4.31"> </span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l5.1"></a><span id="l5.1" class="difflineminus">--- a/mail/base/content/mailCore.js</span>
<a href="#l5.2"></a><span id="l5.2" class="difflineplus">+++ b/mail/base/content/mailCore.js</span>
<a href="#l5.3"></a><span id="l5.3" class="difflineat">@@ -694,20 +694,18 @@ function SetBusyCursor(window, enable) {</span>
<a href="#l5.4"></a><span id="l5.4"> </span>
<a href="#l5.5"></a><span id="l5.5">   var numFrames = window.frames.length;</span>
<a href="#l5.6"></a><span id="l5.6">   for (var i = 0; i &lt; numFrames; i++) {</span>
<a href="#l5.7"></a><span id="l5.7">     SetBusyCursor(window.frames[i], enable);</span>
<a href="#l5.8"></a><span id="l5.8">   }</span>
<a href="#l5.9"></a><span id="l5.9"> }</span>
<a href="#l5.10"></a><span id="l5.10"> </span>
<a href="#l5.11"></a><span id="l5.11"> function openAboutDialog() {</span>
<a href="#l5.12"></a><span id="l5.12" class="difflineminus">-  let enumerator = Services.wm.getEnumerator(&quot;Mail:About&quot;);</span>
<a href="#l5.13"></a><span id="l5.13" class="difflineminus">-  while (enumerator.hasMoreElements()) {</span>
<a href="#l5.14"></a><span id="l5.14" class="difflineplus">+  for (let win of Services.wm.getEnumerator(&quot;Mail:About&quot;)) {</span>
<a href="#l5.15"></a><span id="l5.15">     // Only open one about window</span>
<a href="#l5.16"></a><span id="l5.16" class="difflineminus">-    let win = enumerator.getNext();</span>
<a href="#l5.17"></a><span id="l5.17">     win.focus();</span>
<a href="#l5.18"></a><span id="l5.18">     return;</span>
<a href="#l5.19"></a><span id="l5.19">   }</span>
<a href="#l5.20"></a><span id="l5.20"> </span>
<a href="#l5.21"></a><span id="l5.21">   let features;</span>
<a href="#l5.22"></a><span id="l5.22">   if (AppConstants.platform == &quot;win&quot;) {</span>
<a href="#l5.23"></a><span id="l5.23">     features = &quot;chrome,centerscreen,dependent&quot;;</span>
<a href="#l5.24"></a><span id="l5.24">   } else if (AppConstants.platform == &quot;macosx&quot;) {</span>
<a href="#l5.25"></a><span id="l5.25" class="difflineat">@@ -820,20 +818,18 @@ function safeModeRestart() {</span>
<a href="#l5.26"></a><span id="l5.26"> function getMostRecentMailWindow() {</span>
<a href="#l5.27"></a><span id="l5.27">   let win = null;</span>
<a href="#l5.28"></a><span id="l5.28"> </span>
<a href="#l5.29"></a><span id="l5.29">   win = Services.wm.getMostRecentWindow(&quot;mail:3pane&quot;, true);</span>
<a href="#l5.30"></a><span id="l5.30"> </span>
<a href="#l5.31"></a><span id="l5.31">   // If we're lucky, this isn't a popup, and we can just return this.</span>
<a href="#l5.32"></a><span id="l5.32">   if (win &amp;&amp; win.document.documentElement.getAttribute(&quot;chromehidden&quot;)) {</span>
<a href="#l5.33"></a><span id="l5.33">     win = null;</span>
<a href="#l5.34"></a><span id="l5.34" class="difflineminus">-    let windowList = Services.wm.getEnumerator(&quot;mail:3pane&quot;, true);</span>
<a href="#l5.35"></a><span id="l5.35">     // This is oldest to newest, so this gets a bit ugly.</span>
<a href="#l5.36"></a><span id="l5.36" class="difflineminus">-    while (windowList.hasMoreElements()) {</span>
<a href="#l5.37"></a><span id="l5.37" class="difflineminus">-      let nextWin = windowList.getNext();</span>
<a href="#l5.38"></a><span id="l5.38" class="difflineplus">+    for (let nextWin of Services.wm.getEnumerator(&quot;mail:3pane&quot;, true)) {</span>
<a href="#l5.39"></a><span id="l5.39">       if (!nextWin.document.documentElement.getAttribute(&quot;chromehidden&quot;)) {</span>
<a href="#l5.40"></a><span id="l5.40">         win = nextWin;</span>
<a href="#l5.41"></a><span id="l5.41">       }</span>
<a href="#l5.42"></a><span id="l5.42">     }</span>
<a href="#l5.43"></a><span id="l5.43">   }</span>
<a href="#l5.44"></a><span id="l5.44"> </span>
<a href="#l5.45"></a><span id="l5.45">   return win;</span>
<a href="#l5.46"></a><span id="l5.46"> }</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l6.1"></a><span id="l6.1" class="difflineminus">--- a/mail/base/content/msgMail3PaneWindow.js</span>
<a href="#l6.2"></a><span id="l6.2" class="difflineplus">+++ b/mail/base/content/msgMail3PaneWindow.js</span>
<a href="#l6.3"></a><span id="l6.3" class="difflineat">@@ -765,19 +765,17 @@ function HandleAppCommandEvent(evt) {</span>
<a href="#l6.4"></a><span id="l6.4">       break;</span>
<a href="#l6.5"></a><span id="l6.5">   }</span>
<a href="#l6.6"></a><span id="l6.6"> }</span>
<a href="#l6.7"></a><span id="l6.7"> </span>
<a href="#l6.8"></a><span id="l6.8"> /**</span>
<a href="#l6.9"></a><span id="l6.9">  * Look for another 3-pane window.</span>
<a href="#l6.10"></a><span id="l6.10">  */</span>
<a href="#l6.11"></a><span id="l6.11"> function FindOther3PaneWindow() {</span>
<a href="#l6.12"></a><span id="l6.12" class="difflineminus">-  let enumerator = Services.wm.getEnumerator(&quot;mail:3pane&quot;);</span>
<a href="#l6.13"></a><span id="l6.13" class="difflineminus">-  while (enumerator.hasMoreElements()) {</span>
<a href="#l6.14"></a><span id="l6.14" class="difflineminus">-    let win = enumerator.getNext();</span>
<a href="#l6.15"></a><span id="l6.15" class="difflineplus">+  for (let win of Services.wm.getEnumerator(&quot;mail:3pane&quot;)) {</span>
<a href="#l6.16"></a><span id="l6.16">     if (win != window) {</span>
<a href="#l6.17"></a><span id="l6.17">       return win;</span>
<a href="#l6.18"></a><span id="l6.18">     }</span>
<a href="#l6.19"></a><span id="l6.19">   }</span>
<a href="#l6.20"></a><span id="l6.20">   return null;</span>
<a href="#l6.21"></a><span id="l6.21"> }</span>
<a href="#l6.22"></a><span id="l6.22"> </span>
<a href="#l6.23"></a><span id="l6.23"> /**</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l7.1"></a><span id="l7.1" class="difflineminus">--- a/mail/base/content/msgViewNavigation.js</span>
<a href="#l7.2"></a><span id="l7.2" class="difflineplus">+++ b/mail/base/content/msgViewNavigation.js</span>
<a href="#l7.3"></a><span id="l7.3" class="difflineat">@@ -11,25 +11,20 @@</span>
<a href="#l7.4"></a><span id="l7.4"> /* import-globals-from messageDisplay.js */</span>
<a href="#l7.5"></a><span id="l7.5"> </span>
<a href="#l7.6"></a><span id="l7.6"> var { allAccountsSorted } = ChromeUtils.import(</span>
<a href="#l7.7"></a><span id="l7.7">   &quot;resource:///modules/folderUtils.jsm&quot;</span>
<a href="#l7.8"></a><span id="l7.8"> );</span>
<a href="#l7.9"></a><span id="l7.9"> var { Services } = ChromeUtils.import(&quot;resource://gre/modules/Services.jsm&quot;);</span>
<a href="#l7.10"></a><span id="l7.10"> </span>
<a href="#l7.11"></a><span id="l7.11"> function GetSubFoldersInFolderPaneOrder(folder) {</span>
<a href="#l7.12"></a><span id="l7.12" class="difflineminus">-  var subFolders = folder.subFolders;</span>
<a href="#l7.13"></a><span id="l7.13">   var msgFolders = [];</span>
<a href="#l7.14"></a><span id="l7.14"> </span>
<a href="#l7.15"></a><span id="l7.15">   // get all the subfolders</span>
<a href="#l7.16"></a><span id="l7.16" class="difflineminus">-  while (subFolders.hasMoreElements()) {</span>
<a href="#l7.17"></a><span id="l7.17" class="difflineminus">-    msgFolders[msgFolders.length] = subFolders</span>
<a href="#l7.18"></a><span id="l7.18" class="difflineminus">-      .getNext()</span>
<a href="#l7.19"></a><span id="l7.19" class="difflineminus">-      .QueryInterface(Ci.nsIMsgFolder);</span>
<a href="#l7.20"></a><span id="l7.20" class="difflineminus">-  }</span>
<a href="#l7.21"></a><span id="l7.21" class="difflineplus">+  msgFolders = [...folder.subFolders];</span>
<a href="#l7.22"></a><span id="l7.22"> </span>
<a href="#l7.23"></a><span id="l7.23">   function compareFolderSortKey(folder1, folder2) {</span>
<a href="#l7.24"></a><span id="l7.24">     return folder1.compareSortKeys(folder2);</span>
<a href="#l7.25"></a><span id="l7.25">   }</span>
<a href="#l7.26"></a><span id="l7.26"> </span>
<a href="#l7.27"></a><span id="l7.27">   // sort the subfolders</span>
<a href="#l7.28"></a><span id="l7.28">   msgFolders.sort(compareFolderSortKey);</span>
<a href="#l7.29"></a><span id="l7.29">   return msgFolders;</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l8.1"></a><span id="l8.1" class="difflineminus">--- a/mail/base/content/sanitize.js</span>
<a href="#l8.2"></a><span id="l8.2" class="difflineplus">+++ b/mail/base/content/sanitize.js</span>
<a href="#l8.3"></a><span id="l8.3" class="difflineat">@@ -92,20 +92,17 @@ Sanitizer.prototype = {</span>
<a href="#l8.4"></a><span id="l8.4">         return true;</span>
<a href="#l8.5"></a><span id="l8.5">       },</span>
<a href="#l8.6"></a><span id="l8.6">     },</span>
<a href="#l8.7"></a><span id="l8.7"> </span>
<a href="#l8.8"></a><span id="l8.8">     cookies: {</span>
<a href="#l8.9"></a><span id="l8.9">       clear() {</span>
<a href="#l8.10"></a><span id="l8.10">         if (this.range) {</span>
<a href="#l8.11"></a><span id="l8.11">           // Iterate through the cookies and delete any created after our cutoff.</span>
<a href="#l8.12"></a><span id="l8.12" class="difflineminus">-          var cookiesEnum = Services.cookies.enumerator;</span>
<a href="#l8.13"></a><span id="l8.13" class="difflineminus">-          while (cookiesEnum.hasMoreElements()) {</span>
<a href="#l8.14"></a><span id="l8.14" class="difflineminus">-            var cookie = cookiesEnum.getNext().QueryInterface(Ci.nsICookie);</span>
<a href="#l8.15"></a><span id="l8.15" class="difflineminus">-</span>
<a href="#l8.16"></a><span id="l8.16" class="difflineplus">+          for (let cookie of Services.cookies.enumerator) {</span>
<a href="#l8.17"></a><span id="l8.17">             if (cookie.creationTime &gt; this.range[0]) {</span>
<a href="#l8.18"></a><span id="l8.18">               // This cookie was created after our cutoff, clear it</span>
<a href="#l8.19"></a><span id="l8.19">               Services.cookies.remove(</span>
<a href="#l8.20"></a><span id="l8.20">                 cookie.host,</span>
<a href="#l8.21"></a><span id="l8.21">                 cookie.name,</span>
<a href="#l8.22"></a><span id="l8.22">                 cookie.path,</span>
<a href="#l8.23"></a><span id="l8.23">                 false,</span>
<a href="#l8.24"></a><span id="l8.24">                 cookie.originAttributes</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l9.1"></a><span id="l9.1" class="difflineminus">--- a/mail/base/modules/MailUtils.jsm</span>
<a href="#l9.2"></a><span id="l9.2" class="difflineplus">+++ b/mail/base/modules/MailUtils.jsm</span>
<a href="#l9.3"></a><span id="l9.3" class="difflineat">@@ -536,26 +536,19 @@ var MailUtils = {</span>
<a href="#l9.4"></a><span id="l9.4"> </span>
<a href="#l9.5"></a><span id="l9.5">   /**</span>
<a href="#l9.6"></a><span id="l9.6">    * Finds a mailing list anywhere in the address books.</span>
<a href="#l9.7"></a><span id="l9.7">    *</span>
<a href="#l9.8"></a><span id="l9.8">    * @param {string} entryName - Value against which dirName is checked.</span>
<a href="#l9.9"></a><span id="l9.9">    * @returns {nsIAbDirectory|null} - Found list or null.</span>
<a href="#l9.10"></a><span id="l9.10">    */</span>
<a href="#l9.11"></a><span id="l9.11">   findListInAddressBooks(entryName) {</span>
<a href="#l9.12"></a><span id="l9.12" class="difflineminus">-    let allAddressBooks = MailServices.ab.directories;</span>
<a href="#l9.13"></a><span id="l9.13" class="difflineminus">-</span>
<a href="#l9.14"></a><span id="l9.14" class="difflineminus">-    while (allAddressBooks.hasMoreElements()) {</span>
<a href="#l9.15"></a><span id="l9.15" class="difflineminus">-      let abDir = allAddressBooks.getNext().QueryInterface(Ci.nsIAbDirectory);</span>
<a href="#l9.16"></a><span id="l9.16" class="difflineminus">-</span>
<a href="#l9.17"></a><span id="l9.17" class="difflineplus">+    for (let abDir of MailServices.ab.directories) {</span>
<a href="#l9.18"></a><span id="l9.18">       if (abDir.supportsMailingLists) {</span>
<a href="#l9.19"></a><span id="l9.19" class="difflineminus">-        let dirs = abDir.childNodes;</span>
<a href="#l9.20"></a><span id="l9.20" class="difflineminus">-</span>
<a href="#l9.21"></a><span id="l9.21" class="difflineminus">-        while (dirs.hasMoreElements()) {</span>
<a href="#l9.22"></a><span id="l9.22" class="difflineminus">-          let dir = dirs.getNext().QueryInterface(Ci.nsIAbDirectory);</span>
<a href="#l9.23"></a><span id="l9.23" class="difflineplus">+        for (let dir of abDir.childNodes) {</span>
<a href="#l9.24"></a><span id="l9.24">           if (dir.isMailList &amp;&amp; dir.dirName == entryName) {</span>
<a href="#l9.25"></a><span id="l9.25">             return dir;</span>
<a href="#l9.26"></a><span id="l9.26">           }</span>
<a href="#l9.27"></a><span id="l9.27">         }</span>
<a href="#l9.28"></a><span id="l9.28">       }</span>
<a href="#l9.29"></a><span id="l9.29">     }</span>
<a href="#l9.30"></a><span id="l9.30">     return null;</span>
<a href="#l9.31"></a><span id="l9.31">   },</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l10.1"></a><span id="l10.1" class="difflineminus">--- a/mail/base/modules/QuickFilterManager.jsm</span>
<a href="#l10.2"></a><span id="l10.2" class="difflineplus">+++ b/mail/base/modules/QuickFilterManager.jsm</span>
<a href="#l10.3"></a><span id="l10.3" class="difflineat">@@ -619,21 +619,19 @@ QuickFilterManager.defineFilter({</span>
<a href="#l10.4"></a><span id="l10.4"> /**</span>
<a href="#l10.5"></a><span id="l10.5">  * true: sender must be in a local address book, false: sender must not be.</span>
<a href="#l10.6"></a><span id="l10.6">  */</span>
<a href="#l10.7"></a><span id="l10.7"> QuickFilterManager.defineFilter({</span>
<a href="#l10.8"></a><span id="l10.8">   name: &quot;addrBook&quot;,</span>
<a href="#l10.9"></a><span id="l10.9">   domId: &quot;qfb-inaddrbook&quot;,</span>
<a href="#l10.10"></a><span id="l10.10">   appendTerms(aTermCreator, aTerms, aFilterValue) {</span>
<a href="#l10.11"></a><span id="l10.11">     let term, value;</span>
<a href="#l10.12"></a><span id="l10.12" class="difflineminus">-    let enumerator = MailServices.ab.directories;</span>
<a href="#l10.13"></a><span id="l10.13">     let firstBook = true;</span>
<a href="#l10.14"></a><span id="l10.14">     term = null;</span>
<a href="#l10.15"></a><span id="l10.15" class="difflineminus">-    while (enumerator.hasMoreElements()) {</span>
<a href="#l10.16"></a><span id="l10.16" class="difflineminus">-      let addrbook = enumerator.getNext();</span>
<a href="#l10.17"></a><span id="l10.17" class="difflineplus">+    for (let addrbook of MailServices.ab.directories) {</span>
<a href="#l10.18"></a><span id="l10.18">       if (addrbook instanceof Ci.nsIAbDirectory &amp;&amp; !addrbook.isRemote) {</span>
<a href="#l10.19"></a><span id="l10.19">         term = aTermCreator.createTerm();</span>
<a href="#l10.20"></a><span id="l10.20">         term.attrib = Ci.nsMsgSearchAttrib.Sender;</span>
<a href="#l10.21"></a><span id="l10.21">         value = term.value;</span>
<a href="#l10.22"></a><span id="l10.22">         value.attrib = term.attrib;</span>
<a href="#l10.23"></a><span id="l10.23">         value.str = addrbook.URI;</span>
<a href="#l10.24"></a><span id="l10.24">         term.value = value;</span>
<a href="#l10.25"></a><span id="l10.25">         term.op = aFilterValue</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l11.1"></a><span id="l11.1" class="difflineminus">--- a/mail/base/modules/SessionStoreManager.jsm</span>
<a href="#l11.2"></a><span id="l11.2" class="difflineplus">+++ b/mail/base/modules/SessionStoreManager.jsm</span>
<a href="#l11.3"></a><span id="l11.3" class="difflineat">@@ -157,19 +157,17 @@ var SessionStoreManager = {</span>
<a href="#l11.4"></a><span id="l11.4">   /**</span>
<a href="#l11.5"></a><span id="l11.5">    * Writes the state of all currently open 3pane windows to disk.</span>
<a href="#l11.6"></a><span id="l11.6">    */</span>
<a href="#l11.7"></a><span id="l11.7">   _saveState() {</span>
<a href="#l11.8"></a><span id="l11.8">     let state = this._createStateObject();</span>
<a href="#l11.9"></a><span id="l11.9"> </span>
<a href="#l11.10"></a><span id="l11.10">     // XXX we'd like to support other window types in future, but for now</span>
<a href="#l11.11"></a><span id="l11.11">     // only get the 3pane windows.</span>
<a href="#l11.12"></a><span id="l11.12" class="difflineminus">-    let enumerator = Services.wm.getEnumerator(&quot;mail:3pane&quot;);</span>
<a href="#l11.13"></a><span id="l11.13" class="difflineminus">-    while (enumerator.hasMoreElements()) {</span>
<a href="#l11.14"></a><span id="l11.14" class="difflineminus">-      let win = enumerator.getNext();</span>
<a href="#l11.15"></a><span id="l11.15" class="difflineplus">+    for (let win of Services.wm.getEnumerator(&quot;mail:3pane&quot;)) {</span>
<a href="#l11.16"></a><span id="l11.16">       if (</span>
<a href="#l11.17"></a><span id="l11.17">         win &amp;&amp;</span>
<a href="#l11.18"></a><span id="l11.18">         &quot;complete&quot; == win.document.readyState &amp;&amp;</span>
<a href="#l11.19"></a><span id="l11.19">         win.getWindowStateForSessionPersistence</span>
<a href="#l11.20"></a><span id="l11.20">       ) {</span>
<a href="#l11.21"></a><span id="l11.21">         state.windows.push(win.getWindowStateForSessionPersistence());</span>
<a href="#l11.22"></a><span id="l11.22">       }</span>
<a href="#l11.23"></a><span id="l11.23">     }</span>
<a href="#l11.24"></a><span id="l11.24" class="difflineat">@@ -241,19 +239,18 @@ var SessionStoreManager = {</span>
<a href="#l11.25"></a><span id="l11.25">    * Called by each 3pane window instance when it unloads. If aWindow is the</span>
<a href="#l11.26"></a><span id="l11.26">    * last 3pane window, its state is persisted. The last 3pane window unloads</span>
<a href="#l11.27"></a><span id="l11.27">    * first before the &quot;quit-application-granted&quot; event is generated.</span>
<a href="#l11.28"></a><span id="l11.28">    */</span>
<a href="#l11.29"></a><span id="l11.29">   unloadingWindow(aWindow) {</span>
<a href="#l11.30"></a><span id="l11.30">     if (!this._shutdownStateSaved) {</span>
<a href="#l11.31"></a><span id="l11.31">       // determine whether aWindow is the last open window</span>
<a href="#l11.32"></a><span id="l11.32">       let lastWindow = true;</span>
<a href="#l11.33"></a><span id="l11.33" class="difflineminus">-      let enumerator = Services.wm.getEnumerator(&quot;mail:3pane&quot;);</span>
<a href="#l11.34"></a><span id="l11.34" class="difflineminus">-      while (enumerator.hasMoreElements()) {</span>
<a href="#l11.35"></a><span id="l11.35" class="difflineminus">-        if (enumerator.getNext() != aWindow) {</span>
<a href="#l11.36"></a><span id="l11.36" class="difflineplus">+      for (let win of Services.wm.getEnumerator(&quot;mail:3pane&quot;)) {</span>
<a href="#l11.37"></a><span id="l11.37" class="difflineplus">+        if (win != aWindow) {</span>
<a href="#l11.38"></a><span id="l11.38">           lastWindow = false;</span>
<a href="#l11.39"></a><span id="l11.39">         }</span>
<a href="#l11.40"></a><span id="l11.40">       }</span>
<a href="#l11.41"></a><span id="l11.41"> </span>
<a href="#l11.42"></a><span id="l11.42">       if (lastWindow) {</span>
<a href="#l11.43"></a><span id="l11.43">         // last chance to save any state for the current session since</span>
<a href="#l11.44"></a><span id="l11.44">         // aWindow is the last 3pane window and the &quot;quit-application-granted&quot;</span>
<a href="#l11.45"></a><span id="l11.45">         // event is observed AFTER this.</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l12.1"></a><span id="l12.1" class="difflineminus">--- a/mail/base/modules/TBDistCustomizer.jsm</span>
<a href="#l12.2"></a><span id="l12.2" class="difflineplus">+++ b/mail/base/modules/TBDistCustomizer.jsm</span>
<a href="#l12.3"></a><span id="l12.3" class="difflineat">@@ -47,18 +47,17 @@ var TBDistCustomizer = {</span>
<a href="#l12.4"></a><span id="l12.4">       partnerAbout = this._ini.getString(&quot;Global&quot;, &quot;about.&quot; + this._locale);</span>
<a href="#l12.5"></a><span id="l12.5">     } else {</span>
<a href="#l12.6"></a><span id="l12.6">       partnerAbout = this._ini.getString(&quot;Global&quot;, &quot;about&quot;);</span>
<a href="#l12.7"></a><span id="l12.7">     }</span>
<a href="#l12.8"></a><span id="l12.8">     defaults.setStringPref(&quot;distribution.about&quot;, partnerAbout);</span>
<a href="#l12.9"></a><span id="l12.9"> </span>
<a href="#l12.10"></a><span id="l12.10">     if (sections.Preferences) {</span>
<a href="#l12.11"></a><span id="l12.11">       let keys = this._ini.getKeys(&quot;Preferences&quot;);</span>
<a href="#l12.12"></a><span id="l12.12" class="difflineminus">-      while (keys.hasMore()) {</span>
<a href="#l12.13"></a><span id="l12.13" class="difflineminus">-        let key = keys.getNext();</span>
<a href="#l12.14"></a><span id="l12.14" class="difflineplus">+      for (let key of keys) {</span>
<a href="#l12.15"></a><span id="l12.15">         try {</span>
<a href="#l12.16"></a><span id="l12.16">           // Get the string value of the key</span>
<a href="#l12.17"></a><span id="l12.17">           let value = this.parseValue(this._ini.getString(&quot;Preferences&quot;, key));</span>
<a href="#l12.18"></a><span id="l12.18">           // After determining what type it is, set the pref</span>
<a href="#l12.19"></a><span id="l12.19">           switch (typeof value) {</span>
<a href="#l12.20"></a><span id="l12.20">             case &quot;boolean&quot;:</span>
<a href="#l12.21"></a><span id="l12.21">               defaults.setBoolPref(key, value);</span>
<a href="#l12.22"></a><span id="l12.22">               break;</span>
<a href="#l12.23"></a><span id="l12.23" class="difflineat">@@ -81,18 +80,17 @@ var TBDistCustomizer = {</span>
<a href="#l12.24"></a><span id="l12.24"> </span>
<a href="#l12.25"></a><span id="l12.25">     // Set the prefs in the other sections</span>
<a href="#l12.26"></a><span id="l12.26">     let localizedStr = Cc[&quot;@mozilla.org/pref-localizedstring;1&quot;].createInstance(</span>
<a href="#l12.27"></a><span id="l12.27">       Ci.nsIPrefLocalizedString</span>
<a href="#l12.28"></a><span id="l12.28">     );</span>
<a href="#l12.29"></a><span id="l12.29"> </span>
<a href="#l12.30"></a><span id="l12.30">     if (sections.LocalizablePreferences) {</span>
<a href="#l12.31"></a><span id="l12.31">       let keys = this._ini.getKeys(&quot;LocalizablePreferences&quot;);</span>
<a href="#l12.32"></a><span id="l12.32" class="difflineminus">-      while (keys.hasMore()) {</span>
<a href="#l12.33"></a><span id="l12.33" class="difflineminus">-        let key = keys.getNext();</span>
<a href="#l12.34"></a><span id="l12.34" class="difflineplus">+      for (let key of keys) {</span>
<a href="#l12.35"></a><span id="l12.35">         try {</span>
<a href="#l12.36"></a><span id="l12.36">           let value = this.parseValue(</span>
<a href="#l12.37"></a><span id="l12.37">             this._ini.getString(&quot;LocalizablePreferences&quot;, key)</span>
<a href="#l12.38"></a><span id="l12.38">           );</span>
<a href="#l12.39"></a><span id="l12.39">           value = value.replace(/%LOCALE%/g, this._locale);</span>
<a href="#l12.40"></a><span id="l12.40">           localizedStr.data = &quot;data:text/plain,&quot; + key + &quot;=&quot; + value;</span>
<a href="#l12.41"></a><span id="l12.41">           defaults.setComplexValue(</span>
<a href="#l12.42"></a><span id="l12.42">             key,</span>
<a href="#l12.43"></a><span id="l12.43" class="difflineat">@@ -102,18 +100,17 @@ var TBDistCustomizer = {</span>
<a href="#l12.44"></a><span id="l12.44">         } catch (e) {</span>
<a href="#l12.45"></a><span id="l12.45">           Cu.reportError(e);</span>
<a href="#l12.46"></a><span id="l12.46">         }</span>
<a href="#l12.47"></a><span id="l12.47">       }</span>
<a href="#l12.48"></a><span id="l12.48">     }</span>
<a href="#l12.49"></a><span id="l12.49"> </span>
<a href="#l12.50"></a><span id="l12.50">     if (sections[&quot;LocalizablePreferences-&quot; + this._locale]) {</span>
<a href="#l12.51"></a><span id="l12.51">       let keys = this._ini.getKeys(&quot;LocalizablePreferences-&quot; + this._locale);</span>
<a href="#l12.52"></a><span id="l12.52" class="difflineminus">-      while (keys.hasMore()) {</span>
<a href="#l12.53"></a><span id="l12.53" class="difflineminus">-        let key = keys.getNext();</span>
<a href="#l12.54"></a><span id="l12.54" class="difflineplus">+      for (let key of keys) {</span>
<a href="#l12.55"></a><span id="l12.55">         try {</span>
<a href="#l12.56"></a><span id="l12.56">           let value = this.parseValue(</span>
<a href="#l12.57"></a><span id="l12.57">             this._ini.getString(&quot;LocalizablePreferences-&quot; + this._locale, key)</span>
<a href="#l12.58"></a><span id="l12.58">           );</span>
<a href="#l12.59"></a><span id="l12.59">           localizedStr.data = &quot;data:text/plain,&quot; + key + &quot;=&quot; + value;</span>
<a href="#l12.60"></a><span id="l12.60">           defaults.setComplexValue(</span>
<a href="#l12.61"></a><span id="l12.61">             key,</span>
<a href="#l12.62"></a><span id="l12.62">             Ci.nsIPrefLocalizedString,</span>
<a href="#l12.63"></a><span id="l12.63" class="difflineat">@@ -154,13 +151,13 @@ XPCOMUtils.defineLazyGetter(TBDistCustom</span>
<a href="#l12.64"></a><span id="l12.64"> });</span>
<a href="#l12.65"></a><span id="l12.65"> </span>
<a href="#l12.66"></a><span id="l12.66"> XPCOMUtils.defineLazyGetter(TBDistCustomizer, &quot;_locale&quot;, function() {</span>
<a href="#l12.67"></a><span id="l12.67">   return Services.locale.requestedLocale;</span>
<a href="#l12.68"></a><span id="l12.68"> });</span>
<a href="#l12.69"></a><span id="l12.69"> </span>
<a href="#l12.70"></a><span id="l12.70"> function enumToObject(UTF8Enumerator) {</span>
<a href="#l12.71"></a><span id="l12.71">   let ret = {};</span>
<a href="#l12.72"></a><span id="l12.72" class="difflineminus">-  while (UTF8Enumerator.hasMore()) {</span>
<a href="#l12.73"></a><span id="l12.73" class="difflineminus">-    ret[UTF8Enumerator.getNext()] = 1;</span>
<a href="#l12.74"></a><span id="l12.74" class="difflineplus">+  for (let UTF8Obj of UTF8Enumerator) {</span>
<a href="#l12.75"></a><span id="l12.75" class="difflineplus">+    ret[UTF8Obj] = 1;</span>
<a href="#l12.76"></a><span id="l12.76">   }</span>
<a href="#l12.77"></a><span id="l12.77">   return ret;</span>
<a href="#l12.78"></a><span id="l12.78"> }</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l13.1"></a><span id="l13.1" class="difflineminus">--- a/mail/base/modules/TagUtils.jsm</span>
<a href="#l13.2"></a><span id="l13.2" class="difflineplus">+++ b/mail/base/modules/TagUtils.jsm</span>
<a href="#l13.3"></a><span id="l13.3" class="difflineat">@@ -23,25 +23,21 @@ function loadTagsIntoCSS(aDocument) {</span>
<a href="#l13.4"></a><span id="l13.4">     // tag.key is the internal key, like &quot;$label1&quot; for &quot;Important&quot;.</span>
<a href="#l13.5"></a><span id="l13.5">     // For user defined keys with non-ASCII characters, key is</span>
<a href="#l13.6"></a><span id="l13.6">     // the MUTF-7 encoded name.</span>
<a href="#l13.7"></a><span id="l13.7">     addTagToSheet(tag.key, tag.color, tagSheet);</span>
<a href="#l13.8"></a><span id="l13.8">   }</span>
<a href="#l13.9"></a><span id="l13.9"> }</span>
<a href="#l13.10"></a><span id="l13.10"> </span>
<a href="#l13.11"></a><span id="l13.11"> function addTagToAllDocumentSheets(aKey, aColor) {</span>
<a href="#l13.12"></a><span id="l13.12" class="difflineminus">-  let windowList = Services.wm.getEnumerator(&quot;mail:3pane&quot;, true);</span>
<a href="#l13.13"></a><span id="l13.13" class="difflineminus">-  while (windowList.hasMoreElements()) {</span>
<a href="#l13.14"></a><span id="l13.14" class="difflineminus">-    let nextWin = windowList.getNext();</span>
<a href="#l13.15"></a><span id="l13.15" class="difflineplus">+  for (let nextWin of Services.wm.getEnumerator(&quot;mail:3pane&quot;, true)) {</span>
<a href="#l13.16"></a><span id="l13.16">     addTagToSheet(aKey, aColor, findTagColorSheet(nextWin.document));</span>
<a href="#l13.17"></a><span id="l13.17">   }</span>
<a href="#l13.18"></a><span id="l13.18"> </span>
<a href="#l13.19"></a><span id="l13.19" class="difflineminus">-  windowList = Services.wm.getEnumerator(&quot;mailnews:search&quot;, true);</span>
<a href="#l13.20"></a><span id="l13.20" class="difflineminus">-  while (windowList.hasMoreElements()) {</span>
<a href="#l13.21"></a><span id="l13.21" class="difflineminus">-    let nextWin = windowList.getNext();</span>
<a href="#l13.22"></a><span id="l13.22" class="difflineplus">+  for (let nextWin of Services.wm.getEnumerator(&quot;mailnews:search&quot;, true)) {</span>
<a href="#l13.23"></a><span id="l13.23">     addTagToSheet(aKey, aColor, findTagColorSheet(nextWin.document));</span>
<a href="#l13.24"></a><span id="l13.24">   }</span>
<a href="#l13.25"></a><span id="l13.25"> }</span>
<a href="#l13.26"></a><span id="l13.26"> </span>
<a href="#l13.27"></a><span id="l13.27"> function addTagToSheet(aKey, aColor, aSheet) {</span>
<a href="#l13.28"></a><span id="l13.28">   if (!aSheet) {</span>
<a href="#l13.29"></a><span id="l13.29">     return;</span>
<a href="#l13.30"></a><span id="l13.30">   }</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l14.1"></a><span id="l14.1" class="difflineminus">--- a/mail/base/test/unit/test_mailGlue_distribution.js</span>
<a href="#l14.2"></a><span id="l14.2" class="difflineplus">+++ b/mail/base/test/unit/test_mailGlue_distribution.js</span>
<a href="#l14.3"></a><span id="l14.3" class="difflineat">@@ -70,19 +70,17 @@ function run_test() {</span>
<a href="#l14.4"></a><span id="l14.4">     aboutLocale = testIni.getString(&quot;Global&quot;, &quot;about&quot;);</span>
<a href="#l14.5"></a><span id="l14.5">   }</span>
<a href="#l14.6"></a><span id="l14.6"> </span>
<a href="#l14.7"></a><span id="l14.7">   pref = Services.prefs.getCharPref(&quot;distribution.about&quot;);</span>
<a href="#l14.8"></a><span id="l14.8">   Assert.equal(aboutLocale, pref);</span>
<a href="#l14.9"></a><span id="l14.9"> </span>
<a href="#l14.10"></a><span id="l14.10">   // Test Preferences section</span>
<a href="#l14.11"></a><span id="l14.11">   let s = &quot;Preferences&quot;;</span>
<a href="#l14.12"></a><span id="l14.12" class="difflineminus">-  let keys = testIni.getKeys(s);</span>
<a href="#l14.13"></a><span id="l14.13" class="difflineminus">-  while (keys.hasMore()) {</span>
<a href="#l14.14"></a><span id="l14.14" class="difflineminus">-    let key = keys.getNext();</span>
<a href="#l14.15"></a><span id="l14.15" class="difflineplus">+  for (let key of testIni.getKeys(s)) {</span>
<a href="#l14.16"></a><span id="l14.16">     let value = TBDistCustomizer.parseValue(testIni.getString(s, key));</span>
<a href="#l14.17"></a><span id="l14.17">     switch (typeof value) {</span>
<a href="#l14.18"></a><span id="l14.18">       case &quot;boolean&quot;:</span>
<a href="#l14.19"></a><span id="l14.19">         Assert.equal(value, Services.prefs.getBoolPref(key));</span>
<a href="#l14.20"></a><span id="l14.20">         break;</span>
<a href="#l14.21"></a><span id="l14.21">       case &quot;number&quot;:</span>
<a href="#l14.22"></a><span id="l14.22">         Assert.equal(value, Services.prefs.getIntPref(key));</span>
<a href="#l14.23"></a><span id="l14.23">         break;</span>
<a href="#l14.24"></a><span id="l14.24" class="difflineat">@@ -95,32 +93,28 @@ function run_test() {</span>
<a href="#l14.25"></a><span id="l14.25">         );</span>
<a href="#l14.26"></a><span id="l14.26">     }</span>
<a href="#l14.27"></a><span id="l14.27">   }</span>
<a href="#l14.28"></a><span id="l14.28"> </span>
<a href="#l14.29"></a><span id="l14.29">   // Test the LocalizablePreferences-[locale] section</span>
<a href="#l14.30"></a><span id="l14.30">   // Add any prefs found in it to the overrides array</span>
<a href="#l14.31"></a><span id="l14.31">   let overrides = [];</span>
<a href="#l14.32"></a><span id="l14.32">   s = &quot;LocalizablePreferences-en-US&quot;;</span>
<a href="#l14.33"></a><span id="l14.33" class="difflineminus">-  keys = testIni.getKeys(s);</span>
<a href="#l14.34"></a><span id="l14.34" class="difflineminus">-  while (keys.hasMore()) {</span>
<a href="#l14.35"></a><span id="l14.35" class="difflineminus">-    let key = keys.getNext();</span>
<a href="#l14.36"></a><span id="l14.36" class="difflineplus">+  for (let key of testIni.getKeys(s)) {</span>
<a href="#l14.37"></a><span id="l14.37">     let value = TBDistCustomizer.parseValue(testIni.getString(s, key));</span>
<a href="#l14.38"></a><span id="l14.38">     value = &quot;data:text/plain,&quot; + key + &quot;=&quot; + value;</span>
<a href="#l14.39"></a><span id="l14.39">     Assert.equal(value, Services.prefs.getCharPref(key));</span>
<a href="#l14.40"></a><span id="l14.40">     overrides.push(key);</span>
<a href="#l14.41"></a><span id="l14.41">   }</span>
<a href="#l14.42"></a><span id="l14.42"> </span>
<a href="#l14.43"></a><span id="l14.43">   // Test the LocalizablePreferences section</span>
<a href="#l14.44"></a><span id="l14.44">   // Any prefs here that aren't found in overrides are not overridden</span>
<a href="#l14.45"></a><span id="l14.45">   //   by LocalizablePrefs-[locale] and should be tested</span>
<a href="#l14.46"></a><span id="l14.46">   s = &quot;LocalizablePreferences&quot;;</span>
<a href="#l14.47"></a><span id="l14.47" class="difflineminus">-  keys = testIni.getKeys(s);</span>
<a href="#l14.48"></a><span id="l14.48" class="difflineminus">-  while (keys.hasMore()) {</span>
<a href="#l14.49"></a><span id="l14.49" class="difflineminus">-    let key = keys.getNext();</span>
<a href="#l14.50"></a><span id="l14.50" class="difflineplus">+  for (let key of testIni.getKeys(s)) {</span>
<a href="#l14.51"></a><span id="l14.51">     if (!overrides.includes(key)) {</span>
<a href="#l14.52"></a><span id="l14.52">       let value = TBDistCustomizer.parseValue(testIni.getString(s, key));</span>
<a href="#l14.53"></a><span id="l14.53">       value = value.replace(/%LOCALE%/g, &quot;en-US&quot;);</span>
<a href="#l14.54"></a><span id="l14.54">       value = &quot;data:text/plain,&quot; + key + &quot;=&quot; + value;</span>
<a href="#l14.55"></a><span id="l14.55">       Assert.equal(value, Services.prefs.getCharPref(key));</span>
<a href="#l14.56"></a><span id="l14.56">     }</span>
<a href="#l14.57"></a><span id="l14.57">   }</span>
<a href="#l14.58"></a><span id="l14.58">   do_test_finished();</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l15.1"></a><span id="l15.1" class="difflineminus">--- a/mail/components/MessengerContentHandler.jsm</span>
<a href="#l15.2"></a><span id="l15.2" class="difflineplus">+++ b/mail/components/MessengerContentHandler.jsm</span>
<a href="#l15.3"></a><span id="l15.3" class="difflineat">@@ -337,19 +337,17 @@ MailDefaultHandler.prototype = {</span>
<a href="#l15.4"></a><span id="l15.4">     }</span>
<a href="#l15.5"></a><span id="l15.5"> </span>
<a href="#l15.6"></a><span id="l15.6">     if (!uri &amp;&amp; cmdLine.preventDefault) {</span>
<a href="#l15.7"></a><span id="l15.7">       return;</span>
<a href="#l15.8"></a><span id="l15.8">     }</span>
<a href="#l15.9"></a><span id="l15.9"> </span>
<a href="#l15.10"></a><span id="l15.10">     if (!uri &amp;&amp; cmdLine.state != Ci.nsICommandLine.STATE_INITIAL_LAUNCH) {</span>
<a href="#l15.11"></a><span id="l15.11">       try {</span>
<a href="#l15.12"></a><span id="l15.12" class="difflineminus">-        var wlist = Services.wm.getEnumerator(&quot;mail:3pane&quot;);</span>
<a href="#l15.13"></a><span id="l15.13" class="difflineminus">-        if (wlist.hasMoreElements()) {</span>
<a href="#l15.14"></a><span id="l15.14" class="difflineminus">-          var window = wlist.getNext();</span>
<a href="#l15.15"></a><span id="l15.15" class="difflineplus">+        for (let window of Services.wm.getEnumerator(&quot;mail:3pane&quot;)) {</span>
<a href="#l15.16"></a><span id="l15.16">           window.focus();</span>
<a href="#l15.17"></a><span id="l15.17">           return;</span>
<a href="#l15.18"></a><span id="l15.18">         }</span>
<a href="#l15.19"></a><span id="l15.19">       } catch (e) {</span>
<a href="#l15.20"></a><span id="l15.20">         dump(e);</span>
<a href="#l15.21"></a><span id="l15.21">       }</span>
<a href="#l15.22"></a><span id="l15.22">     }</span>
<a href="#l15.23"></a><span id="l15.23">     if (uri) {</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l16.1"></a><span id="l16.1" class="difflineminus">--- a/mail/components/about-support/content/aboutSupport.js</span>
<a href="#l16.2"></a><span id="l16.2" class="difflineplus">+++ b/mail/components/about-support/content/aboutSupport.js</span>
<a href="#l16.3"></a><span id="l16.3" class="difflineat">@@ -942,18 +942,17 @@ var snapshotFormatters = {</span>
<a href="#l16.4"></a><span id="l16.4">           function enumerateDatabase(name) {</span>
<a href="#l16.5"></a><span id="l16.5">             KeyValueService.getOrCreate(path, name)</span>
<a href="#l16.6"></a><span id="l16.6">               .then(database =&gt; {</span>
<a href="#l16.7"></a><span id="l16.7">                 return database.enumerate();</span>
<a href="#l16.8"></a><span id="l16.8">               })</span>
<a href="#l16.9"></a><span id="l16.9">               .then(enumerator =&gt; {</span>
<a href="#l16.10"></a><span id="l16.10">                 var logs = [];</span>
<a href="#l16.11"></a><span id="l16.11">                 logs.push(`${name}:`);</span>
<a href="#l16.12"></a><span id="l16.12" class="difflineminus">-                while (enumerator.hasMoreElements()) {</span>
<a href="#l16.13"></a><span id="l16.13" class="difflineminus">-                  const { key, value } = enumerator.getNext();</span>
<a href="#l16.14"></a><span id="l16.14" class="difflineplus">+                for (let { key, value } of enumerator) {</span>
<a href="#l16.15"></a><span id="l16.15">                   logs.push(`${key}: ${value}`);</span>
<a href="#l16.16"></a><span id="l16.16">                 }</span>
<a href="#l16.17"></a><span id="l16.17">                 $(&quot;enumerate-database-result&quot;).textContent +=</span>
<a href="#l16.18"></a><span id="l16.18">                   logs.join(&quot;\n&quot;) + &quot;\n&quot;;</span>
<a href="#l16.19"></a><span id="l16.19">               })</span>
<a href="#l16.20"></a><span id="l16.20">               .catch(err =&gt; {</span>
<a href="#l16.21"></a><span id="l16.21">                 $(&quot;enumerate-database-result&quot;).textContent += `${name}:\n`;</span>
<a href="#l16.22"></a><span id="l16.22">               });</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l17.1"></a><span id="l17.1" class="difflineminus">--- a/mail/components/accountcreation/content/createInBackend.js</span>
<a href="#l17.2"></a><span id="l17.2" class="difflineplus">+++ b/mail/components/accountcreation/content/createInBackend.js</span>
<a href="#l17.3"></a><span id="l17.3" class="difflineat">@@ -317,19 +317,17 @@ function checkIncomingServerAlreadyExist</span>
<a href="#l17.4"></a><span id="l17.4">  *</span>
<a href="#l17.5"></a><span id="l17.5">  * @param config {AccountConfig} filled in (no placeholders)</span>
<a href="#l17.6"></a><span id="l17.6">  * @return {nsISmtpServer} If it already exists, the server</span>
<a href="#l17.7"></a><span id="l17.7">  *     object is returned.</span>
<a href="#l17.8"></a><span id="l17.8">  *     If it's a new server, |null| is returned.</span>
<a href="#l17.9"></a><span id="l17.9">  */</span>
<a href="#l17.10"></a><span id="l17.10"> function checkOutgoingServerAlreadyExists(config) {</span>
<a href="#l17.11"></a><span id="l17.11">   assert(config instanceof AccountConfig);</span>
<a href="#l17.12"></a><span id="l17.12" class="difflineminus">-  let smtpServers = MailServices.smtp.servers;</span>
<a href="#l17.13"></a><span id="l17.13" class="difflineminus">-  while (smtpServers.hasMoreElements()) {</span>
<a href="#l17.14"></a><span id="l17.14" class="difflineminus">-    let existingServer = smtpServers.getNext().QueryInterface(Ci.nsISmtpServer);</span>
<a href="#l17.15"></a><span id="l17.15" class="difflineplus">+  for (let existingServer of MailServices.smtp.servers) {</span>
<a href="#l17.16"></a><span id="l17.16">     // TODO check username with full email address, too, like for incoming</span>
<a href="#l17.17"></a><span id="l17.17">     if (</span>
<a href="#l17.18"></a><span id="l17.18">       existingServer.hostname == config.outgoing.hostname &amp;&amp;</span>
<a href="#l17.19"></a><span id="l17.19">       existingServer.port == config.outgoing.port &amp;&amp;</span>
<a href="#l17.20"></a><span id="l17.20">       existingServer.username == config.outgoing.username</span>
<a href="#l17.21"></a><span id="l17.21">     ) {</span>
<a href="#l17.22"></a><span id="l17.22">       return existingServer;</span>
<a href="#l17.23"></a><span id="l17.23">     }</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l18.1"></a><span id="l18.1" class="difflineminus">--- a/mail/components/accountcreation/content/emailWizard.js</span>
<a href="#l18.2"></a><span id="l18.2" class="difflineplus">+++ b/mail/components/accountcreation/content/emailWizard.js</span>
<a href="#l18.3"></a><span id="l18.3" class="difflineat">@@ -264,19 +264,17 @@ EmailConfigWizard.prototype = {</span>
<a href="#l18.4"></a><span id="l18.4"> </span>
<a href="#l18.5"></a><span id="l18.5">     let menulist = e(&quot;outgoing_hostname&quot;);</span>
<a href="#l18.6"></a><span id="l18.6">     // Add the entry for the new host to the menulist</span>
<a href="#l18.7"></a><span id="l18.7">     let menuitem = menulist.appendItem(&quot;&quot;, &quot;-new-&quot;); // label,value</span>
<a href="#l18.8"></a><span id="l18.8">     menuitem.serverKey = null;</span>
<a href="#l18.9"></a><span id="l18.9"> </span>
<a href="#l18.10"></a><span id="l18.10">     // Populate SMTP server dropdown with already configured SMTP servers from</span>
<a href="#l18.11"></a><span id="l18.11">     // other accounts.</span>
<a href="#l18.12"></a><span id="l18.12" class="difflineminus">-    let smtpServers = MailServices.smtp.servers;</span>
<a href="#l18.13"></a><span id="l18.13" class="difflineminus">-    while (smtpServers.hasMoreElements()) {</span>
<a href="#l18.14"></a><span id="l18.14" class="difflineminus">-      let server = smtpServers.getNext().QueryInterface(Ci.nsISmtpServer);</span>
<a href="#l18.15"></a><span id="l18.15" class="difflineplus">+    for (let server of MailServices.smtp.servers) {</span>
<a href="#l18.16"></a><span id="l18.16">       let label = server.displayname;</span>
<a href="#l18.17"></a><span id="l18.17">       let key = server.key;</span>
<a href="#l18.18"></a><span id="l18.18">       if (</span>
<a href="#l18.19"></a><span id="l18.19">         MailServices.smtp.defaultServer &amp;&amp;</span>
<a href="#l18.20"></a><span id="l18.20">         MailServices.smtp.defaultServer.key == key</span>
<a href="#l18.21"></a><span id="l18.21">       ) {</span>
<a href="#l18.22"></a><span id="l18.22">         label += &quot; &quot; + gStringsBundle.getString(&quot;default_server_tag&quot;);</span>
<a href="#l18.23"></a><span id="l18.23">       }</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l19.1"></a><span id="l19.1" class="difflineminus">--- a/mail/components/addrbook/content/abTrees.js</span>
<a href="#l19.2"></a><span id="l19.2" class="difflineplus">+++ b/mail/components/addrbook/content/abTrees.js</span>
<a href="#l19.3"></a><span id="l19.3" class="difflineat">@@ -118,20 +118,18 @@ abDirTreeItem.prototype = {</span>
<a href="#l19.4"></a><span id="l19.4">       this._children = [];</span>
<a href="#l19.5"></a><span id="l19.5">       let myEnum;</span>
<a href="#l19.6"></a><span id="l19.6">       if (this._directory.URI == kAllDirectoryRoot + &quot;?&quot;) {</span>
<a href="#l19.7"></a><span id="l19.7">         myEnum = MailServices.ab.directories;</span>
<a href="#l19.8"></a><span id="l19.8">       } else {</span>
<a href="#l19.9"></a><span id="l19.9">         myEnum = this._directory.childNodes;</span>
<a href="#l19.10"></a><span id="l19.10">       }</span>
<a href="#l19.11"></a><span id="l19.11"> </span>
<a href="#l19.12"></a><span id="l19.12" class="difflineminus">-      while (myEnum.hasMoreElements()) {</span>
<a href="#l19.13"></a><span id="l19.13" class="difflineminus">-        var abItem = new abDirTreeItem(</span>
<a href="#l19.14"></a><span id="l19.14" class="difflineminus">-          myEnum.getNext().QueryInterface(Ci.nsIAbDirectory)</span>
<a href="#l19.15"></a><span id="l19.15" class="difflineminus">-        );</span>
<a href="#l19.16"></a><span id="l19.16" class="difflineplus">+      for (let dir of myEnum) {</span>
<a href="#l19.17"></a><span id="l19.17" class="difflineplus">+        var abItem = new abDirTreeItem(dir);</span>
<a href="#l19.18"></a><span id="l19.18">         if (</span>
<a href="#l19.19"></a><span id="l19.19">           gDirectoryTreeView &amp;&amp;</span>
<a href="#l19.20"></a><span id="l19.20">           this.id == kAllDirectoryRoot + &quot;?&quot; &amp;&amp;</span>
<a href="#l19.21"></a><span id="l19.21">           getDirectoryValue(abItem, &quot;ab_type&quot;) == &quot;ldap&quot;</span>
<a href="#l19.22"></a><span id="l19.22">         ) {</span>
<a href="#l19.23"></a><span id="l19.23">           gDirectoryTreeView.hasRemoteAB = true;</span>
<a href="#l19.24"></a><span id="l19.24">         }</span>
<a href="#l19.25"></a><span id="l19.25"> </span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l20.1"></a><span id="l20.1" class="difflineminus">--- a/mail/components/addrbook/content/addressbook.js</span>
<a href="#l20.2"></a><span id="l20.2" class="difflineplus">+++ b/mail/components/addrbook/content/addressbook.js</span>
<a href="#l20.3"></a><span id="l20.3" class="difflineat">@@ -456,20 +456,17 @@ function AbExportSelection() {</span>
<a href="#l20.4"></a><span id="l20.4"> </span>
<a href="#l20.5"></a><span id="l20.5">   AbExport(selectedDirURI);</span>
<a href="#l20.6"></a><span id="l20.6"> }</span>
<a href="#l20.7"></a><span id="l20.7"> </span>
<a href="#l20.8"></a><span id="l20.8"> /**</span>
<a href="#l20.9"></a><span id="l20.9">  * Export all found addressbooks, each in a separate file.</span>
<a href="#l20.10"></a><span id="l20.10">  */</span>
<a href="#l20.11"></a><span id="l20.11"> function AbExportAll() {</span>
<a href="#l20.12"></a><span id="l20.12" class="difflineminus">-  let directories = MailServices.ab.directories;</span>
<a href="#l20.13"></a><span id="l20.13" class="difflineminus">-</span>
<a href="#l20.14"></a><span id="l20.14" class="difflineminus">-  while (directories.hasMoreElements()) {</span>
<a href="#l20.15"></a><span id="l20.15" class="difflineminus">-    let directory = directories.getNext();</span>
<a href="#l20.16"></a><span id="l20.16" class="difflineplus">+  for (let directory of MailServices.ab.directories) {</span>
<a href="#l20.17"></a><span id="l20.17">     // Do not export LDAP ABs.</span>
<a href="#l20.18"></a><span id="l20.18">     if (!directory.URI.startsWith(kLdapUrlPrefix)) {</span>
<a href="#l20.19"></a><span id="l20.19">       AbExport(directory.URI);</span>
<a href="#l20.20"></a><span id="l20.20">     }</span>
<a href="#l20.21"></a><span id="l20.21">   }</span>
<a href="#l20.22"></a><span id="l20.22"> }</span>
<a href="#l20.23"></a><span id="l20.23"> </span>
<a href="#l20.24"></a><span id="l20.24"> /**</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l21.1"></a><span id="l21.1" class="difflineminus">--- a/mail/components/addrbook/content/menulist-addrbooks.js</span>
<a href="#l21.2"></a><span id="l21.2" class="difflineplus">+++ b/mail/components/addrbook/content/menulist-addrbooks.js</span>
<a href="#l21.3"></a><span id="l21.3" class="difflineat">@@ -119,20 +119,18 @@ if (!customElements.get(&quot;menulist&quot;)) {</span>
<a href="#l21.4"></a><span id="l21.4"> </span>
<a href="#l21.5"></a><span id="l21.5">       MailServices.ab.removeAddressBookListener(this.addressBookListener);</span>
<a href="#l21.6"></a><span id="l21.6">       this._teardown();</span>
<a href="#l21.7"></a><span id="l21.7">     }</span>
<a href="#l21.8"></a><span id="l21.8"> </span>
<a href="#l21.9"></a><span id="l21.9">     _rebuild() {</span>
<a href="#l21.10"></a><span id="l21.10">       // Init the address book cache.</span>
<a href="#l21.11"></a><span id="l21.11">       this._directories.length = 0;</span>
<a href="#l21.12"></a><span id="l21.12" class="difflineminus">-      let directories = MailServices.ab.directories;</span>
<a href="#l21.13"></a><span id="l21.13"> </span>
<a href="#l21.14"></a><span id="l21.14" class="difflineminus">-      while (directories &amp;&amp; directories.hasMoreElements()) {</span>
<a href="#l21.15"></a><span id="l21.15" class="difflineminus">-        let ab = directories.getNext();</span>
<a href="#l21.16"></a><span id="l21.16" class="difflineplus">+      for (let ab of MailServices.ab.directories) {</span>
<a href="#l21.17"></a><span id="l21.17">         if (ab instanceof Ci.nsIAbDirectory &amp;&amp; this._matches(ab)) {</span>
<a href="#l21.18"></a><span id="l21.18">           this._directories.push(ab);</span>
<a href="#l21.19"></a><span id="l21.19"> </span>
<a href="#l21.20"></a><span id="l21.20">           if (this.getAttribute(&quot;mailinglists&quot;) == &quot;true&quot;) {</span>
<a href="#l21.21"></a><span id="l21.21">             // Also append contained mailinglists.</span>
<a href="#l21.22"></a><span id="l21.22">             for (let list of fixIterator(ab.childNodes, Ci.nsIAbDirectory)) {</span>
<a href="#l21.23"></a><span id="l21.23">               if (this._matches(list)) {</span>
<a href="#l21.24"></a><span id="l21.24">                 this._directories.push(list);</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l22.1"></a><span id="l22.1" class="difflineminus">--- a/mail/components/compose/content/MsgComposeCommands.js</span>
<a href="#l22.2"></a><span id="l22.2" class="difflineplus">+++ b/mail/components/compose/content/MsgComposeCommands.js</span>
<a href="#l22.3"></a><span id="l22.3" class="difflineat">@@ -4017,22 +4017,17 @@ function CheckValidEmailAddress(aMsgComp</span>
<a href="#l22.4"></a><span id="l22.4">   return true;</span>
<a href="#l22.5"></a><span id="l22.5"> }</span>
<a href="#l22.6"></a><span id="l22.6"> </span>
<a href="#l22.7"></a><span id="l22.7"> function SendMessage() {</span>
<a href="#l22.8"></a><span id="l22.8">   let sendInBackground = Services.prefs.getBoolPref(</span>
<a href="#l22.9"></a><span id="l22.9">     &quot;mailnews.sendInBackground&quot;</span>
<a href="#l22.10"></a><span id="l22.10">   );</span>
<a href="#l22.11"></a><span id="l22.11">   if (sendInBackground &amp;&amp; AppConstants.platform != &quot;macosx&quot;) {</span>
<a href="#l22.12"></a><span id="l22.12" class="difflineminus">-    let enumerator = Services.wm.getEnumerator(null);</span>
<a href="#l22.13"></a><span id="l22.13" class="difflineminus">-    let count = 0;</span>
<a href="#l22.14"></a><span id="l22.14" class="difflineminus">-    while (enumerator.hasMoreElements() &amp;&amp; count &lt; 2) {</span>
<a href="#l22.15"></a><span id="l22.15" class="difflineminus">-      enumerator.getNext();</span>
<a href="#l22.16"></a><span id="l22.16" class="difflineminus">-      count++;</span>
<a href="#l22.17"></a><span id="l22.17" class="difflineminus">-    }</span>
<a href="#l22.18"></a><span id="l22.18" class="difflineplus">+    let count = [...Services.wm.getEnumerator(null)].length;</span>
<a href="#l22.19"></a><span id="l22.19">     if (count == 1) {</span>
<a href="#l22.20"></a><span id="l22.20">       sendInBackground = false;</span>
<a href="#l22.21"></a><span id="l22.21">     }</span>
<a href="#l22.22"></a><span id="l22.22">   }</span>
<a href="#l22.23"></a><span id="l22.23"> </span>
<a href="#l22.24"></a><span id="l22.24">   GenericSendMessage(</span>
<a href="#l22.25"></a><span id="l22.25">     sendInBackground</span>
<a href="#l22.26"></a><span id="l22.26">       ? Ci.nsIMsgCompDeliverMode.Background</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l23.1"></a><span id="l23.1" class="difflineminus">--- a/mail/components/compose/content/editor.js</span>
<a href="#l23.2"></a><span id="l23.2" class="difflineplus">+++ b/mail/components/compose/content/editor.js</span>
<a href="#l23.3"></a><span id="l23.3" class="difflineat">@@ -2389,21 +2389,18 @@ function SwitchInsertCharToThisWindow(wi</span>
<a href="#l23.4"></a><span id="l23.4">     return true;</span>
<a href="#l23.5"></a><span id="l23.5">   }</span>
<a href="#l23.6"></a><span id="l23.6">   return false;</span>
<a href="#l23.7"></a><span id="l23.7"> }</span>
<a href="#l23.8"></a><span id="l23.8"> </span>
<a href="#l23.9"></a><span id="l23.9"> function FindEditorWithInsertCharDialog() {</span>
<a href="#l23.10"></a><span id="l23.10">   try {</span>
<a href="#l23.11"></a><span id="l23.11">     // Find window with an InsertCharsWindow and switch association to this one</span>
<a href="#l23.12"></a><span id="l23.12" class="difflineminus">-    let enumerator = Services.wm.getEnumerator(null);</span>
<a href="#l23.13"></a><span id="l23.13"> </span>
<a href="#l23.14"></a><span id="l23.14" class="difflineminus">-    while (enumerator.hasMoreElements()) {</span>
<a href="#l23.15"></a><span id="l23.15" class="difflineminus">-      var tempWindow = enumerator.getNext();</span>
<a href="#l23.16"></a><span id="l23.16" class="difflineminus">-</span>
<a href="#l23.17"></a><span id="l23.17" class="difflineplus">+    for (let tempWindow of Services.wm.getEnumerator(null)) {</span>
<a href="#l23.18"></a><span id="l23.18">       if (</span>
<a href="#l23.19"></a><span id="l23.19">         !tempWindow.closed &amp;&amp;</span>
<a href="#l23.20"></a><span id="l23.20">         tempWindow != window &amp;&amp;</span>
<a href="#l23.21"></a><span id="l23.21">         &quot;InsertCharWindow&quot; in tempWindow &amp;&amp;</span>
<a href="#l23.22"></a><span id="l23.22">         tempWindow.InsertCharWindow</span>
<a href="#l23.23"></a><span id="l23.23">       ) {</span>
<a href="#l23.24"></a><span id="l23.24">         return tempWindow;</span>
<a href="#l23.25"></a><span id="l23.25">       }</span>
<a href="#l23.26"></a><span id="l23.26" class="difflineat">@@ -2442,18 +2439,17 @@ function SwitchInsertCharToAnotherEditor</span>
<a href="#l23.27"></a><span id="l23.27">       enumerator = Services.wm.getEnumerator(null);</span>
<a href="#l23.28"></a><span id="l23.28">     } catch (e) {}</span>
<a href="#l23.29"></a><span id="l23.29">     if (!enumerator) {</span>
<a href="#l23.30"></a><span id="l23.30">       return;</span>
<a href="#l23.31"></a><span id="l23.31">     }</span>
<a href="#l23.32"></a><span id="l23.32"> </span>
<a href="#l23.33"></a><span id="l23.33">     // TODO: Fix this to search for command controllers and look for &quot;cmd_InsertChars&quot;</span>
<a href="#l23.34"></a><span id="l23.34">     // For now, detect just Web Composer and HTML Mail Composer</span>
<a href="#l23.35"></a><span id="l23.35" class="difflineminus">-    while (enumerator.hasMoreElements()) {</span>
<a href="#l23.36"></a><span id="l23.36" class="difflineminus">-      var tempWindow = enumerator.getNext();</span>
<a href="#l23.37"></a><span id="l23.37" class="difflineplus">+    for (let tempWindow of enumerator) {</span>
<a href="#l23.38"></a><span id="l23.38">       if (</span>
<a href="#l23.39"></a><span id="l23.39">         !tempWindow.closed &amp;&amp;</span>
<a href="#l23.40"></a><span id="l23.40">         tempWindow != window &amp;&amp;</span>
<a href="#l23.41"></a><span id="l23.41">         tempWindow != window.InsertCharWindow &amp;&amp;</span>
<a href="#l23.42"></a><span id="l23.42">         &quot;GetCurrentEditor&quot; in tempWindow &amp;&amp;</span>
<a href="#l23.43"></a><span id="l23.43">         tempWindow.GetCurrentEditor()</span>
<a href="#l23.44"></a><span id="l23.44">       ) {</span>
<a href="#l23.45"></a><span id="l23.45">         tempWindow.InsertCharWindow = window.InsertCharWindow;</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l24.1"></a><span id="l24.1" class="difflineminus">--- a/mail/components/extensions/parent/ext-mail.js</span>
<a href="#l24.2"></a><span id="l24.2" class="difflineplus">+++ b/mail/components/extensions/parent/ext-mail.js</span>
<a href="#l24.3"></a><span id="l24.3" class="difflineat">@@ -235,20 +235,18 @@ class WindowTracker extends WindowTracke</span>
<a href="#l24.4"></a><span id="l24.4">   get topNormalWindow() {</span>
<a href="#l24.5"></a><span id="l24.5">     let win = null;</span>
<a href="#l24.6"></a><span id="l24.6"> </span>
<a href="#l24.7"></a><span id="l24.7">     win = Services.wm.getMostRecentWindow(&quot;mail:3pane&quot;, true);</span>
<a href="#l24.8"></a><span id="l24.8"> </span>
<a href="#l24.9"></a><span id="l24.9">     // If we're lucky, this isn't a popup, and we can just return this.</span>
<a href="#l24.10"></a><span id="l24.10">     if (win &amp;&amp; win.document.documentElement.getAttribute(&quot;chromehidden&quot;)) {</span>
<a href="#l24.11"></a><span id="l24.11">       win = null;</span>
<a href="#l24.12"></a><span id="l24.12" class="difflineminus">-      let windowList = Services.wm.getEnumerator(&quot;mail:3pane&quot;, true);</span>
<a href="#l24.13"></a><span id="l24.13">       // This is oldest to newest, so this gets a bit ugly.</span>
<a href="#l24.14"></a><span id="l24.14" class="difflineminus">-      while (windowList.hasMoreElements()) {</span>
<a href="#l24.15"></a><span id="l24.15" class="difflineminus">-        let nextWin = windowList.getNext();</span>
<a href="#l24.16"></a><span id="l24.16" class="difflineplus">+      for (let nextWin of Services.wm.getEnumerator(&quot;mail:3pane&quot;, true)) {</span>
<a href="#l24.17"></a><span id="l24.17">         if (!nextWin.document.documentElement.getAttribute(&quot;chromehidden&quot;)) {</span>
<a href="#l24.18"></a><span id="l24.18">           win = nextWin;</span>
<a href="#l24.19"></a><span id="l24.19">         }</span>
<a href="#l24.20"></a><span id="l24.20">       }</span>
<a href="#l24.21"></a><span id="l24.21">     }</span>
<a href="#l24.22"></a><span id="l24.22"> </span>
<a href="#l24.23"></a><span id="l24.23">     return win;</span>
<a href="#l24.24"></a><span id="l24.24">   }</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l25.1"></a><span id="l25.1" class="difflineminus">--- a/mail/components/im/IMIncomingServer.jsm</span>
<a href="#l25.2"></a><span id="l25.2" class="difflineplus">+++ b/mail/components/im/IMIncomingServer.jsm</span>
<a href="#l25.3"></a><span id="l25.3" class="difflineat">@@ -196,19 +196,17 @@ IMIncomingServer.prototype = {</span>
<a href="#l25.4"></a><span id="l25.4">     if (aPrefName == &quot;otrAllowMsgLog&quot;) {</span>
<a href="#l25.5"></a><span id="l25.5">       return Services.prefs.getBoolPref(&quot;chat.otr.default.allowMsgLog&quot;);</span>
<a href="#l25.6"></a><span id="l25.6">     }</span>
<a href="#l25.7"></a><span id="l25.7">     if (this._defaultOptionValues) {</span>
<a href="#l25.8"></a><span id="l25.8">       return this._defaultOptionValues[aPrefName];</span>
<a href="#l25.9"></a><span id="l25.9">     }</span>
<a href="#l25.10"></a><span id="l25.10"> </span>
<a href="#l25.11"></a><span id="l25.11">     this._defaultOptionValues = {};</span>
<a href="#l25.12"></a><span id="l25.12" class="difflineminus">-    let options = this.imAccount.protocol.getOptions();</span>
<a href="#l25.13"></a><span id="l25.13" class="difflineminus">-    while (options.hasMoreElements()) {</span>
<a href="#l25.14"></a><span id="l25.14" class="difflineminus">-      let opt = options.getNext();</span>
<a href="#l25.15"></a><span id="l25.15" class="difflineplus">+    for (let opt of this.imAccount.protocol.getOptions()) {</span>
<a href="#l25.16"></a><span id="l25.16">       let type = opt.type;</span>
<a href="#l25.17"></a><span id="l25.17">       if (type == opt.typeBool) {</span>
<a href="#l25.18"></a><span id="l25.18">         this._defaultOptionValues[opt.name] = opt.getBool();</span>
<a href="#l25.19"></a><span id="l25.19">       } else if (type == opt.typeInt) {</span>
<a href="#l25.20"></a><span id="l25.20">         this._defaultOptionValues[opt.name] = opt.getInt();</span>
<a href="#l25.21"></a><span id="l25.21">       } else if (type == opt.typeString) {</span>
<a href="#l25.22"></a><span id="l25.22">         this._defaultOptionValues[opt.name] = opt.getString();</span>
<a href="#l25.23"></a><span id="l25.23">       } else if (type == opt.typeList) {</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l26.1"></a><span id="l26.1" class="difflineminus">--- a/mail/components/im/content/addbuddy.js</span>
<a href="#l26.2"></a><span id="l26.2" class="difflineplus">+++ b/mail/components/im/content/addbuddy.js</span>
<a href="#l26.3"></a><span id="l26.3" class="difflineat">@@ -5,17 +5,17 @@</span>
<a href="#l26.4"></a><span id="l26.4"> var { fixIterator } = ChromeUtils.import(</span>
<a href="#l26.5"></a><span id="l26.5">   &quot;resource:///modules/iteratorUtils.jsm&quot;</span>
<a href="#l26.6"></a><span id="l26.6"> );</span>
<a href="#l26.7"></a><span id="l26.7"> var { Services } = ChromeUtils.import(&quot;resource:///modules/imServices.jsm&quot;);</span>
<a href="#l26.8"></a><span id="l26.8"> </span>
<a href="#l26.9"></a><span id="l26.9"> var addBuddy = {</span>
<a href="#l26.10"></a><span id="l26.10">   onload() {</span>
<a href="#l26.11"></a><span id="l26.11">     let accountList = document.getElementById(&quot;accountlist&quot;);</span>
<a href="#l26.12"></a><span id="l26.12" class="difflineminus">-    for (let acc of fixIterator(Services.accounts.getAccounts())) {</span>
<a href="#l26.13"></a><span id="l26.13" class="difflineplus">+    for (let acc of Services.accounts.getAccounts()) {</span>
<a href="#l26.14"></a><span id="l26.14">       if (!acc.connected) {</span>
<a href="#l26.15"></a><span id="l26.15">         continue;</span>
<a href="#l26.16"></a><span id="l26.16">       }</span>
<a href="#l26.17"></a><span id="l26.17">       let proto = acc.protocol;</span>
<a href="#l26.18"></a><span id="l26.18">       let item = accountList.appendItem(acc.name, acc.id, proto.name);</span>
<a href="#l26.19"></a><span id="l26.19">       item.setAttribute(&quot;image&quot;, proto.iconBaseURI + &quot;icon.png&quot;);</span>
<a href="#l26.20"></a><span id="l26.20">       item.setAttribute(&quot;class&quot;, &quot;menuitem-iconic&quot;);</span>
<a href="#l26.21"></a><span id="l26.21">     }</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l27.1"></a><span id="l27.1" class="difflineminus">--- a/mail/components/im/content/am-im.js</span>
<a href="#l27.2"></a><span id="l27.2" class="difflineplus">+++ b/mail/components/im/content/am-im.js</span>
<a href="#l27.3"></a><span id="l27.3" class="difflineat">@@ -94,19 +94,18 @@ var account = {</span>
<a href="#l27.4"></a><span id="l27.4"> </span>
<a href="#l27.5"></a><span id="l27.5">     this.prefs = Services.prefs.getBranch(</span>
<a href="#l27.6"></a><span id="l27.6">       &quot;messenger.account.&quot; + this.account.id + &quot;.options.&quot;</span>
<a href="#l27.7"></a><span id="l27.7">     );</span>
<a href="#l27.8"></a><span id="l27.8">     this.populateProtoSpecificBox();</span>
<a href="#l27.9"></a><span id="l27.9">   },</span>
<a href="#l27.10"></a><span id="l27.10"> </span>
<a href="#l27.11"></a><span id="l27.11">   *getProtoOptions() {</span>
<a href="#l27.12"></a><span id="l27.12" class="difflineminus">-    let options = this.proto.getOptions();</span>
<a href="#l27.13"></a><span id="l27.13" class="difflineminus">-    while (options.hasMoreElements()) {</span>
<a href="#l27.14"></a><span id="l27.14" class="difflineminus">-      yield options.getNext();</span>
<a href="#l27.15"></a><span id="l27.15" class="difflineplus">+    for (let option of this.proto.getOptions()) {</span>
<a href="#l27.16"></a><span id="l27.16" class="difflineplus">+      yield option;</span>
<a href="#l27.17"></a><span id="l27.17">     }</span>
<a href="#l27.18"></a><span id="l27.18">   },</span>
<a href="#l27.19"></a><span id="l27.19"> </span>
<a href="#l27.20"></a><span id="l27.20">   populateProtoSpecificBox() {</span>
<a href="#l27.21"></a><span id="l27.21">     let attributes = {};</span>
<a href="#l27.22"></a><span id="l27.22">     attributes[Ci.prplIPref.typeBool] = [</span>
<a href="#l27.23"></a><span id="l27.23">       { name: &quot;wsm_persist&quot;, value: &quot;true&quot; },</span>
<a href="#l27.24"></a><span id="l27.24">       { name: &quot;preftype&quot;, value: &quot;bool&quot; },</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l28.1"></a><span id="l28.1" class="difflineminus">--- a/mail/components/im/content/chat-conversation.js</span>
<a href="#l28.2"></a><span id="l28.2" class="difflineplus">+++ b/mail/components/im/content/chat-conversation.js</span>
<a href="#l28.3"></a><span id="l28.3" class="difflineat">@@ -101,40 +101,35 @@</span>
<a href="#l28.4"></a><span id="l28.4">                 this.updateConvStatus();</span>
<a href="#l28.5"></a><span id="l28.5">               }</span>
<a href="#l28.6"></a><span id="l28.6">               break;</span>
<a href="#l28.7"></a><span id="l28.7"> </span>
<a href="#l28.8"></a><span id="l28.8">             case &quot;chat-buddy-add&quot;:</span>
<a href="#l28.9"></a><span id="l28.9">               if (!this._isConversationSelected) {</span>
<a href="#l28.10"></a><span id="l28.10">                 break;</span>
<a href="#l28.11"></a><span id="l28.11">               }</span>
<a href="#l28.12"></a><span id="l28.12" class="difflineminus">-              subject.QueryInterface(Ci.nsISimpleEnumerator);</span>
<a href="#l28.13"></a><span id="l28.13" class="difflineminus">-              while (subject.hasMoreElements()) {</span>
<a href="#l28.14"></a><span id="l28.14" class="difflineminus">-                this.insertBuddy(this.createBuddy(subject.getNext()));</span>
<a href="#l28.15"></a><span id="l28.15" class="difflineplus">+              for (let nick of subject.QueryInterface(Ci.nsISimpleEnumerator)) {</span>
<a href="#l28.16"></a><span id="l28.16" class="difflineplus">+                this.insertBuddy(this.createBuddy(nick));</span>
<a href="#l28.17"></a><span id="l28.17">               }</span>
<a href="#l28.18"></a><span id="l28.18">               this.updateParticipantCount();</span>
<a href="#l28.19"></a><span id="l28.19">               break;</span>
<a href="#l28.20"></a><span id="l28.20"> </span>
<a href="#l28.21"></a><span id="l28.21">             case &quot;chat-buddy-remove&quot;:</span>
<a href="#l28.22"></a><span id="l28.22" class="difflineminus">-              subject.QueryInterface(Ci.nsISimpleEnumerator);</span>
<a href="#l28.23"></a><span id="l28.23">               if (!this._isConversationSelected) {</span>
<a href="#l28.24"></a><span id="l28.24" class="difflineminus">-                while (subject.hasMoreElements()) {</span>
<a href="#l28.25"></a><span id="l28.25" class="difflineminus">-                  let name = subject</span>
<a href="#l28.26"></a><span id="l28.26" class="difflineminus">-                    .getNext()</span>
<a href="#l28.27"></a><span id="l28.27" class="difflineminus">-                    .QueryInterface(Ci.nsISupportsString)</span>
<a href="#l28.28"></a><span id="l28.28" class="difflineminus">-                    .toString();</span>
<a href="#l28.29"></a><span id="l28.29" class="difflineplus">+                for (let nick of subject.QueryInterface(</span>
<a href="#l28.30"></a><span id="l28.30" class="difflineplus">+                  Ci.nsISimpleEnumerator</span>
<a href="#l28.31"></a><span id="l28.31" class="difflineplus">+                )) {</span>
<a href="#l28.32"></a><span id="l28.32" class="difflineplus">+                  let name = nick.toString();</span>
<a href="#l28.33"></a><span id="l28.33">                   if (this._isBuddyActive(name)) {</span>
<a href="#l28.34"></a><span id="l28.34">                     delete this._activeBuddies[name];</span>
<a href="#l28.35"></a><span id="l28.35">                   }</span>
<a href="#l28.36"></a><span id="l28.36">                 }</span>
<a href="#l28.37"></a><span id="l28.37">                 break;</span>
<a href="#l28.38"></a><span id="l28.38">               }</span>
<a href="#l28.39"></a><span id="l28.39" class="difflineminus">-              while (subject.hasMoreElements()) {</span>
<a href="#l28.40"></a><span id="l28.40" class="difflineminus">-                let nick = subject.getNext();</span>
<a href="#l28.41"></a><span id="l28.41" class="difflineminus">-                nick.QueryInterface(Ci.nsISupportsString);</span>
<a href="#l28.42"></a><span id="l28.42" class="difflineplus">+              for (let nick of subject.QueryInterface(Ci.nsISimpleEnumerator)) {</span>
<a href="#l28.43"></a><span id="l28.43">                 this.removeBuddy(nick.toString());</span>
<a href="#l28.44"></a><span id="l28.44">               }</span>
<a href="#l28.45"></a><span id="l28.45">               this.updateParticipantCount();</span>
<a href="#l28.46"></a><span id="l28.46">               break;</span>
<a href="#l28.47"></a><span id="l28.47"> </span>
<a href="#l28.48"></a><span id="l28.48">             case &quot;chat-buddy-update&quot;:</span>
<a href="#l28.49"></a><span id="l28.49">               this.updateBuddy(subject, data);</span>
<a href="#l28.50"></a><span id="l28.50">               break;</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l29.1"></a><span id="l29.1" class="difflineminus">--- a/mail/components/im/content/chat-messenger.js</span>
<a href="#l29.2"></a><span id="l29.2" class="difflineplus">+++ b/mail/components/im/content/chat-messenger.js</span>
<a href="#l29.3"></a><span id="l29.3" class="difflineat">@@ -589,19 +589,17 @@ var chatHandler = {</span>
<a href="#l29.4"></a><span id="l29.4">     }</span>
<a href="#l29.5"></a><span id="l29.5">     Services.obs.addObserver(this, &quot;conversation-loaded&quot;);</span>
<a href="#l29.6"></a><span id="l29.6"> </span>
<a href="#l29.7"></a><span id="l29.7">     // Conversation title may not be set yet if this is a search result.</span>
<a href="#l29.8"></a><span id="l29.8">     let cti = document.getElementById(&quot;conv-top-info&quot;);</span>
<a href="#l29.9"></a><span id="l29.9">     cti.setAttribute(&quot;displayName&quot;, aConversation.title);</span>
<a href="#l29.10"></a><span id="l29.10"> </span>
<a href="#l29.11"></a><span id="l29.11">     // Find and display the contact for this log.</span>
<a href="#l29.12"></a><span id="l29.12" class="difflineminus">-    let accounts = imServices.accounts.getAccounts();</span>
<a href="#l29.13"></a><span id="l29.13" class="difflineminus">-    while (accounts.hasMoreElements()) {</span>
<a href="#l29.14"></a><span id="l29.14" class="difflineminus">-      let account = accounts.getNext();</span>
<a href="#l29.15"></a><span id="l29.15" class="difflineplus">+    for (let account of imServices.accounts.getAccounts()) {</span>
<a href="#l29.16"></a><span id="l29.16">       if (</span>
<a href="#l29.17"></a><span id="l29.17">         account.normalizedName == aConversation.account.normalizedName &amp;&amp;</span>
<a href="#l29.18"></a><span id="l29.18">         account.protocol.normalizedName == aConversation.account.protocol.name</span>
<a href="#l29.19"></a><span id="l29.19">       ) {</span>
<a href="#l29.20"></a><span id="l29.20">         if (aConversation.isChat) {</span>
<a href="#l29.21"></a><span id="l29.21">           // Display information for MUCs.</span>
<a href="#l29.22"></a><span id="l29.22">           let proto = account.protocol;</span>
<a href="#l29.23"></a><span id="l29.23">           cti.setAttribute(&quot;status&quot;, &quot;chat&quot;);</span>
<a href="#l29.24"></a><span id="l29.24" class="difflineat">@@ -1073,17 +1071,17 @@ var chatHandler = {</span>
<a href="#l29.25"></a><span id="l29.25">     return (this._colorCache[aName] = Math.round(res) % 360);</span>
<a href="#l29.26"></a><span id="l29.26">   },</span>
<a href="#l29.27"></a><span id="l29.27"> </span>
<a href="#l29.28"></a><span id="l29.28">   _placeHolderButtonId: &quot;&quot;,</span>
<a href="#l29.29"></a><span id="l29.29">   _updateNoConvPlaceHolder() {</span>
<a href="#l29.30"></a><span id="l29.30">     let connected = false;</span>
<a href="#l29.31"></a><span id="l29.31">     let hasAccount = false;</span>
<a href="#l29.32"></a><span id="l29.32">     let canJoinChat = false;</span>
<a href="#l29.33"></a><span id="l29.33" class="difflineminus">-    for (let account of fixIterator(imServices.accounts.getAccounts())) {</span>
<a href="#l29.34"></a><span id="l29.34" class="difflineplus">+    for (let account of imServices.accounts.getAccounts()) {</span>
<a href="#l29.35"></a><span id="l29.35">       hasAccount = true;</span>
<a href="#l29.36"></a><span id="l29.36">       if (account.connected) {</span>
<a href="#l29.37"></a><span id="l29.37">         connected = true;</span>
<a href="#l29.38"></a><span id="l29.38">         if (account.canJoinChat) {</span>
<a href="#l29.39"></a><span id="l29.39">           canJoinChat = true;</span>
<a href="#l29.40"></a><span id="l29.40">           break;</span>
<a href="#l29.41"></a><span id="l29.41">         }</span>
<a href="#l29.42"></a><span id="l29.42">       }</span>
<a href="#l29.43"></a><span id="l29.43" class="difflineat">@@ -1742,18 +1740,17 @@ chatLogTreeView.prototype = {</span>
<a href="#l29.44"></a><span id="l29.44"> </span>
<a href="#l29.45"></a><span id="l29.45">     // today and yesterday are treated differently, because for JSON logs they</span>
<a href="#l29.46"></a><span id="l29.46">     // represent individual logs, and are not &quot;groups&quot;.</span>
<a href="#l29.47"></a><span id="l29.47">     let today = null,</span>
<a href="#l29.48"></a><span id="l29.48">       yesterday = null;</span>
<a href="#l29.49"></a><span id="l29.49"> </span>
<a href="#l29.50"></a><span id="l29.50">     // Build a chatLogTreeLogItem for each log, and put it in the right group.</span>
<a href="#l29.51"></a><span id="l29.51">     let groups = {};</span>
<a href="#l29.52"></a><span id="l29.52" class="difflineminus">-    while (this._logs.hasMoreElements()) {</span>
<a href="#l29.53"></a><span id="l29.53" class="difflineminus">-      let log = this._logs.getNext();</span>
<a href="#l29.54"></a><span id="l29.54" class="difflineplus">+    for (let log of this._logs) {</span>
<a href="#l29.55"></a><span id="l29.55">       let logDate = new Date(log.time * 1000);</span>
<a href="#l29.56"></a><span id="l29.56">       // Calculate elapsed time between the log and 00:00:00 today.</span>
<a href="#l29.57"></a><span id="l29.57">       let timeFromToday = todayDate - logDate;</span>
<a href="#l29.58"></a><span id="l29.58">       let isJSON = log.format == &quot;json&quot;;</span>
<a href="#l29.59"></a><span id="l29.59">       let title = (isJSON ? formatDate : formatDateTime)(logDate);</span>
<a href="#l29.60"></a><span id="l29.60">       let group;</span>
<a href="#l29.61"></a><span id="l29.61">       if (timeFromToday &lt;= 0) {</span>
<a href="#l29.62"></a><span id="l29.62">         if (isJSON) {</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l30.1"></a><span id="l30.1" class="difflineminus">--- a/mail/components/im/content/imAccountWizard.js</span>
<a href="#l30.2"></a><span id="l30.2" class="difflineplus">+++ b/mail/components/im/content/imAccountWizard.js</span>
<a href="#l30.3"></a><span id="l30.3" class="difflineat">@@ -427,18 +427,18 @@ var accountWizard = {</span>
<a href="#l30.4"></a><span id="l30.4">     }</span>
<a href="#l30.5"></a><span id="l30.5">     // If the groupbox has never been opened, the binding isn't attached</span>
<a href="#l30.6"></a><span id="l30.6">     // so the attributes don't exist. The calling code in showSummary</span>
<a href="#l30.7"></a><span id="l30.7">     // has a special handling of the undefined value for this case.</span>
<a href="#l30.8"></a><span id="l30.8">     return undefined;</span>
<a href="#l30.9"></a><span id="l30.9">   },</span>
<a href="#l30.10"></a><span id="l30.10"> </span>
<a href="#l30.11"></a><span id="l30.11">   *getIter(aEnumerator) {</span>
<a href="#l30.12"></a><span id="l30.12" class="difflineminus">-    while (aEnumerator.hasMoreElements()) {</span>
<a href="#l30.13"></a><span id="l30.13" class="difflineminus">-      yield aEnumerator.getNext();</span>
<a href="#l30.14"></a><span id="l30.14" class="difflineplus">+    for (let iter of aEnumerator) {</span>
<a href="#l30.15"></a><span id="l30.15" class="difflineplus">+      yield iter;</span>
<a href="#l30.16"></a><span id="l30.16">     }</span>
<a href="#l30.17"></a><span id="l30.17">   },</span>
<a href="#l30.18"></a><span id="l30.18">   getProtocols() {</span>
<a href="#l30.19"></a><span id="l30.19">     return this.getIter(Services.core.getProtocols());</span>
<a href="#l30.20"></a><span id="l30.20">   },</span>
<a href="#l30.21"></a><span id="l30.21">   getProtoOptions() {</span>
<a href="#l30.22"></a><span id="l30.22">     return this.getIter(this.proto.getOptions());</span>
<a href="#l30.23"></a><span id="l30.23">   },</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l31.1"></a><span id="l31.1" class="difflineminus">--- a/mail/components/im/content/imAccounts.js</span>
<a href="#l31.2"></a><span id="l31.2" class="difflineplus">+++ b/mail/components/im/content/imAccounts.js</span>
<a href="#l31.3"></a><span id="l31.3" class="difflineat">@@ -557,19 +557,18 @@ var gAccountManager = {</span>
<a href="#l31.4"></a><span id="l31.4">       newIndex = accountList.itemCount - 1;</span>
<a href="#l31.5"></a><span id="l31.5">     }</span>
<a href="#l31.6"></a><span id="l31.6">     array.splice(newIndex, 0, selectedID);</span>
<a href="#l31.7"></a><span id="l31.7"> </span>
<a href="#l31.8"></a><span id="l31.8">     Services.prefs.setCharPref(&quot;messenger.accounts&quot;, array.join(&quot;,&quot;));</span>
<a href="#l31.9"></a><span id="l31.9">   },</span>
<a href="#l31.10"></a><span id="l31.10"> </span>
<a href="#l31.11"></a><span id="l31.11">   *getAccounts() {</span>
<a href="#l31.12"></a><span id="l31.12" class="difflineminus">-    let accounts = Services.accounts.getAccounts();</span>
<a href="#l31.13"></a><span id="l31.13" class="difflineminus">-    while (accounts.hasMoreElements()) {</span>
<a href="#l31.14"></a><span id="l31.14" class="difflineminus">-      yield accounts.getNext();</span>
<a href="#l31.15"></a><span id="l31.15" class="difflineplus">+    for (let account of Services.accounts.getAccounts()) {</span>
<a href="#l31.16"></a><span id="l31.16" class="difflineplus">+      yield account;</span>
<a href="#l31.17"></a><span id="l31.17">     }</span>
<a href="#l31.18"></a><span id="l31.18">   },</span>
<a href="#l31.19"></a><span id="l31.19"> </span>
<a href="#l31.20"></a><span id="l31.20">   openDialog(aUrl, aArgs) {</span>
<a href="#l31.21"></a><span id="l31.21">     this.modalDialog = true;</span>
<a href="#l31.22"></a><span id="l31.22">     window.openDialog(aUrl, &quot;&quot;, &quot;chrome,modal,titlebar,centerscreen&quot;, aArgs);</span>
<a href="#l31.23"></a><span id="l31.23">     this.modalDialog = false;</span>
<a href="#l31.24"></a><span id="l31.24">   },</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l32.1"></a><span id="l32.1" class="difflineminus">--- a/mail/components/im/content/joinchat.js</span>
<a href="#l32.2"></a><span id="l32.2" class="difflineplus">+++ b/mail/components/im/content/joinchat.js</span>
<a href="#l32.3"></a><span id="l32.3" class="difflineat">@@ -7,17 +7,17 @@ var { fixIterator } = ChromeUtils.import</span>
<a href="#l32.4"></a><span id="l32.4"> );</span>
<a href="#l32.5"></a><span id="l32.5"> var { Services } = ChromeUtils.import(&quot;resource:///modules/imServices.jsm&quot;);</span>
<a href="#l32.6"></a><span id="l32.6"> </span>
<a href="#l32.7"></a><span id="l32.7"> var autoJoinPref = &quot;autoJoin&quot;;</span>
<a href="#l32.8"></a><span id="l32.8"> </span>
<a href="#l32.9"></a><span id="l32.9"> var joinChat = {</span>
<a href="#l32.10"></a><span id="l32.10">   onload() {</span>
<a href="#l32.11"></a><span id="l32.11">     var accountList = document.getElementById(&quot;accountlist&quot;);</span>
<a href="#l32.12"></a><span id="l32.12" class="difflineminus">-    for (let acc of fixIterator(Services.accounts.getAccounts())) {</span>
<a href="#l32.13"></a><span id="l32.13" class="difflineplus">+    for (let acc of Services.accounts.getAccounts()) {</span>
<a href="#l32.14"></a><span id="l32.14">       if (!acc.connected || !acc.canJoinChat) {</span>
<a href="#l32.15"></a><span id="l32.15">         continue;</span>
<a href="#l32.16"></a><span id="l32.16">       }</span>
<a href="#l32.17"></a><span id="l32.17">       var proto = acc.protocol;</span>
<a href="#l32.18"></a><span id="l32.18">       var item = accountList.appendItem(acc.name, acc.id, proto.name);</span>
<a href="#l32.19"></a><span id="l32.19">       item.setAttribute(&quot;image&quot;, proto.iconBaseURI + &quot;icon.png&quot;);</span>
<a href="#l32.20"></a><span id="l32.20">       item.setAttribute(&quot;class&quot;, &quot;menuitem-iconic&quot;);</span>
<a href="#l32.21"></a><span id="l32.21">       item.account = acc;</span>
<a href="#l32.22"></a><span id="l32.22" class="difflineat">@@ -44,17 +44,17 @@ var joinChat = {</span>
<a href="#l32.23"></a><span id="l32.23"> </span>
<a href="#l32.24"></a><span id="l32.24">     let protoId = acc.protocol.id;</span>
<a href="#l32.25"></a><span id="l32.25">     document.getElementById(&quot;autojoin&quot;).hidden = !(</span>
<a href="#l32.26"></a><span id="l32.26">       protoId == &quot;prpl-irc&quot; ||</span>
<a href="#l32.27"></a><span id="l32.27">       protoId == &quot;prpl-jabber&quot; ||</span>
<a href="#l32.28"></a><span id="l32.28">       protoId == &quot;prpl-gtalk&quot;</span>
<a href="#l32.29"></a><span id="l32.29">     );</span>
<a href="#l32.30"></a><span id="l32.30"> </span>
<a href="#l32.31"></a><span id="l32.31" class="difflineminus">-    for (let field of fixIterator(acc.getChatRoomFields())) {</span>
<a href="#l32.32"></a><span id="l32.32" class="difflineplus">+    for (let field of acc.getChatRoomFields()) {</span>
<a href="#l32.33"></a><span id="l32.33">       let div1 = document.createElementNS(</span>
<a href="#l32.34"></a><span id="l32.34">         &quot;http://www.w3.org/1999/xhtml&quot;,</span>
<a href="#l32.35"></a><span id="l32.35">         &quot;div&quot;</span>
<a href="#l32.36"></a><span id="l32.36">       );</span>
<a href="#l32.37"></a><span id="l32.37">       let label = document.createXULElement(&quot;label&quot;);</span>
<a href="#l32.38"></a><span id="l32.38">       let text = field.label;</span>
<a href="#l32.39"></a><span id="l32.39">       let match = /_(.)/.exec(text);</span>
<a href="#l32.40"></a><span id="l32.40">       if (match) {</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l33.1"></a><span id="l33.1" class="difflineminus">--- a/mail/components/im/modules/chatHandler.jsm</span>
<a href="#l33.2"></a><span id="l33.2" class="difflineplus">+++ b/mail/components/im/modules/chatHandler.jsm</span>
<a href="#l33.3"></a><span id="l33.3" class="difflineat">@@ -44,17 +44,17 @@ var ChatCore = {</span>
<a href="#l33.4"></a><span id="l33.4">         onPromptStart() {</span>
<a href="#l33.5"></a><span id="l33.5">           Services.core.init();</span>
<a href="#l33.6"></a><span id="l33.6"> </span>
<a href="#l33.7"></a><span id="l33.7">           // Find the accounts that exist in the im account service but</span>
<a href="#l33.8"></a><span id="l33.8">           // not in nsMsgAccountManager. They have probably been lost if</span>
<a href="#l33.9"></a><span id="l33.9">           // the user has used an older version of Thunderbird on a</span>
<a href="#l33.10"></a><span id="l33.10">           // profile with IM accounts. See bug 736035.</span>
<a href="#l33.11"></a><span id="l33.11">           let accountsById = {};</span>
<a href="#l33.12"></a><span id="l33.12" class="difflineminus">-          for (let account of fixIterator(Services.accounts.getAccounts())) {</span>
<a href="#l33.13"></a><span id="l33.13" class="difflineplus">+          for (let account of Services.accounts.getAccounts()) {</span>
<a href="#l33.14"></a><span id="l33.14">             accountsById[account.numericId] = account;</span>
<a href="#l33.15"></a><span id="l33.15">           }</span>
<a href="#l33.16"></a><span id="l33.16">           let mgr = MailServices.accounts;</span>
<a href="#l33.17"></a><span id="l33.17">           for (let account of fixIterator(mgr.accounts, Ci.nsIMsgAccount)) {</span>
<a href="#l33.18"></a><span id="l33.18">             let incomingServer = account.incomingServer;</span>
<a href="#l33.19"></a><span id="l33.19">             if (!incomingServer || incomingServer.type != &quot;im&quot;) {</span>
<a href="#l33.20"></a><span id="l33.20">               continue;</span>
<a href="#l33.21"></a><span id="l33.21">             }</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l34.1"></a><span id="l34.1" class="difflineminus">--- a/mail/components/im/modules/index_im.jsm</span>
<a href="#l34.2"></a><span id="l34.2" class="difflineplus">+++ b/mail/components/im/modules/index_im.jsm</span>
<a href="#l34.3"></a><span id="l34.3" class="difflineat">@@ -777,41 +777,36 @@ var GlodaIMIndexer = {</span>
<a href="#l34.4"></a><span id="l34.4">     let dir = FileUtils.getFile(&quot;ProfD&quot;, [&quot;logs&quot;]);</span>
<a href="#l34.5"></a><span id="l34.5">     if (!dir.exists() || !dir.isDirectory()) {</span>
<a href="#l34.6"></a><span id="l34.6">       // If the folder does not exist, then we are done.</span>
<a href="#l34.7"></a><span id="l34.7">       yield GlodaIndexer.kWorkDone;</span>
<a href="#l34.8"></a><span id="l34.8">     }</span>
<a href="#l34.9"></a><span id="l34.9"> </span>
<a href="#l34.10"></a><span id="l34.10">     // Sweep the logs directory for log files, adding any new entries to the</span>
<a href="#l34.11"></a><span id="l34.11">     // _knownFiles tree as we traverse.</span>
<a href="#l34.12"></a><span id="l34.12" class="difflineminus">-    let children = dir.directoryEntries;</span>
<a href="#l34.13"></a><span id="l34.13" class="difflineminus">-    while (children.hasMoreElements()) {</span>
<a href="#l34.14"></a><span id="l34.14" class="difflineminus">-      let proto = children.nextFile;</span>
<a href="#l34.15"></a><span id="l34.15" class="difflineplus">+    for (let proto of dir.directoryEntries) {</span>
<a href="#l34.16"></a><span id="l34.16">       if (!proto.isDirectory()) {</span>
<a href="#l34.17"></a><span id="l34.17">         continue;</span>
<a href="#l34.18"></a><span id="l34.18">       }</span>
<a href="#l34.19"></a><span id="l34.19">       let protoName = proto.leafName;</span>
<a href="#l34.20"></a><span id="l34.20">       if (!Object.prototype.hasOwnProperty.call(this._knownFiles, protoName)) {</span>
<a href="#l34.21"></a><span id="l34.21">         this._knownFiles[protoName] = {};</span>
<a href="#l34.22"></a><span id="l34.22">       }</span>
<a href="#l34.23"></a><span id="l34.23">       let protoObj = this._knownFiles[protoName];</span>
<a href="#l34.24"></a><span id="l34.24">       let accounts = proto.directoryEntries;</span>
<a href="#l34.25"></a><span id="l34.25" class="difflineminus">-      while (accounts.hasMoreElements()) {</span>
<a href="#l34.26"></a><span id="l34.26" class="difflineminus">-        let account = accounts.nextFile;</span>
<a href="#l34.27"></a><span id="l34.27" class="difflineplus">+      for (let account of accounts) {</span>
<a href="#l34.28"></a><span id="l34.28">         if (!account.isDirectory()) {</span>
<a href="#l34.29"></a><span id="l34.29">           continue;</span>
<a href="#l34.30"></a><span id="l34.30">         }</span>
<a href="#l34.31"></a><span id="l34.31">         let accountName = account.leafName;</span>
<a href="#l34.32"></a><span id="l34.32">         if (!Object.prototype.hasOwnProperty.call(protoObj, accountName)) {</span>
<a href="#l34.33"></a><span id="l34.33">           protoObj[accountName] = {};</span>
<a href="#l34.34"></a><span id="l34.34">         }</span>
<a href="#l34.35"></a><span id="l34.35">         let accountObj = protoObj[accountName];</span>
<a href="#l34.36"></a><span id="l34.36" class="difflineminus">-        let convs = account.directoryEntries;</span>
<a href="#l34.37"></a><span id="l34.37" class="difflineminus">-        while (convs.hasMoreElements()) {</span>
<a href="#l34.38"></a><span id="l34.38" class="difflineminus">-          let conv = convs.nextFile;</span>
<a href="#l34.39"></a><span id="l34.39" class="difflineplus">+        for (let conv of account.directoryEntries) {</span>
<a href="#l34.40"></a><span id="l34.40">           let convName = conv.leafName;</span>
<a href="#l34.41"></a><span id="l34.41">           if (!conv.isDirectory() || convName == &quot;.system&quot;) {</span>
<a href="#l34.42"></a><span id="l34.42">             continue;</span>
<a href="#l34.43"></a><span id="l34.43">           }</span>
<a href="#l34.44"></a><span id="l34.44">           if (!Object.prototype.hasOwnProperty.call(accountObj, convName)) {</span>
<a href="#l34.45"></a><span id="l34.45">             accountObj[convName] = {};</span>
<a href="#l34.46"></a><span id="l34.46">           }</span>
<a href="#l34.47"></a><span id="l34.47">           let job = new IndexingJob(&quot;convFolderSweep&quot;, null);</span>
<a href="#l34.48"></a><span id="l34.48" class="difflineat">@@ -823,19 +818,17 @@ var GlodaIMIndexer = {</span>
<a href="#l34.49"></a><span id="l34.49">     }</span>
<a href="#l34.50"></a><span id="l34.50"> </span>
<a href="#l34.51"></a><span id="l34.51">     yield GlodaIndexer.kWorkDone;</span>
<a href="#l34.52"></a><span id="l34.52">   },</span>
<a href="#l34.53"></a><span id="l34.53"> </span>
<a href="#l34.54"></a><span id="l34.54">   *_worker_convFolderSweep(aJob, aCallbackHandle) {</span>
<a href="#l34.55"></a><span id="l34.55">     let folder = aJob.folder;</span>
<a href="#l34.56"></a><span id="l34.56"> </span>
<a href="#l34.57"></a><span id="l34.57" class="difflineminus">-    let sessions = folder.directoryEntries;</span>
<a href="#l34.58"></a><span id="l34.58" class="difflineminus">-    while (sessions.hasMoreElements()) {</span>
<a href="#l34.59"></a><span id="l34.59" class="difflineminus">-      let file = sessions.nextFile;</span>
<a href="#l34.60"></a><span id="l34.60" class="difflineplus">+    for (let file of folder.directoryEntries) {</span>
<a href="#l34.61"></a><span id="l34.61">       let fileName = file.leafName;</span>
<a href="#l34.62"></a><span id="l34.62">       if (</span>
<a href="#l34.63"></a><span id="l34.63">         !file.isFile() ||</span>
<a href="#l34.64"></a><span id="l34.64">         !file.isReadable() ||</span>
<a href="#l34.65"></a><span id="l34.65">         !fileName.endsWith(&quot;.json&quot;) ||</span>
<a href="#l34.66"></a><span id="l34.66">         (Object.prototype.hasOwnProperty.call(aJob.convObj, fileName) &amp;&amp;</span>
<a href="#l34.67"></a><span id="l34.67">           aJob.convObj[fileName] == file.lastModifiedTime)</span>
<a href="#l34.68"></a><span id="l34.68">       ) {</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l35.1"></a><span id="l35.1" class="difflineminus">--- a/mail/components/preferences/cookies.js</span>
<a href="#l35.2"></a><span id="l35.2" class="difflineplus">+++ b/mail/components/preferences/cookies.js</span>
<a href="#l35.3"></a><span id="l35.3" class="difflineat">@@ -522,22 +522,20 @@ var gCookiesWindow = {</span>
<a href="#l35.4"></a><span id="l35.4">       level: 1,</span>
<a href="#l35.5"></a><span id="l35.5">       container: false,</span>
<a href="#l35.6"></a><span id="l35.6">       originAttributes: aCookie.originAttributes,</span>
<a href="#l35.7"></a><span id="l35.7">     };</span>
<a href="#l35.8"></a><span id="l35.8">     return c;</span>
<a href="#l35.9"></a><span id="l35.9">   },</span>
<a href="#l35.10"></a><span id="l35.10"> </span>
<a href="#l35.11"></a><span id="l35.11">   _loadCookies() {</span>
<a href="#l35.12"></a><span id="l35.12" class="difflineminus">-    var e = Services.cookies.enumerator;</span>
<a href="#l35.13"></a><span id="l35.13">     var hostCount = { value: 0 };</span>
<a href="#l35.14"></a><span id="l35.14">     this._hosts = {};</span>
<a href="#l35.15"></a><span id="l35.15">     this._hostOrder = [];</span>
<a href="#l35.16"></a><span id="l35.16" class="difflineminus">-    while (e.hasMoreElements()) {</span>
<a href="#l35.17"></a><span id="l35.17" class="difflineminus">-      var cookie = e.getNext();</span>
<a href="#l35.18"></a><span id="l35.18" class="difflineplus">+    for (let cookie of Services.cookies.enumerator) {</span>
<a href="#l35.19"></a><span id="l35.19">       if (cookie &amp;&amp; cookie instanceof Ci.nsICookie) {</span>
<a href="#l35.20"></a><span id="l35.20">         var strippedHost = this._makeStrippedHost(cookie.host);</span>
<a href="#l35.21"></a><span id="l35.21">         this._addCookie(strippedHost, cookie, hostCount);</span>
<a href="#l35.22"></a><span id="l35.22">       } else {</span>
<a href="#l35.23"></a><span id="l35.23">         break;</span>
<a href="#l35.24"></a><span id="l35.24">       }</span>
<a href="#l35.25"></a><span id="l35.25">     }</span>
<a href="#l35.26"></a><span id="l35.26">     this._view._rowCount = hostCount.value;</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l36.1"></a><span id="l36.1" class="difflineminus">--- a/mail/components/preferences/general.js</span>
<a href="#l36.2"></a><span id="l36.2" class="difflineplus">+++ b/mail/components/preferences/general.js</span>
<a href="#l36.3"></a><span id="l36.3" class="difflineat">@@ -1532,21 +1532,17 @@ var gGeneralPane = {</span>
<a href="#l36.4"></a><span id="l36.4">   _loadAppHandlerData() {</span>
<a href="#l36.5"></a><span id="l36.5">     this._loadApplicationHandlers();</span>
<a href="#l36.6"></a><span id="l36.6">   },</span>
<a href="#l36.7"></a><span id="l36.7"> </span>
<a href="#l36.8"></a><span id="l36.8">   /**</span>
<a href="#l36.9"></a><span id="l36.9">    * Load the set of handlers defined by the application datastore.</span>
<a href="#l36.10"></a><span id="l36.10">    */</span>
<a href="#l36.11"></a><span id="l36.11">   _loadApplicationHandlers() {</span>
<a href="#l36.12"></a><span id="l36.12" class="difflineminus">-    var wrappedHandlerInfos = gHandlerService.enumerate();</span>
<a href="#l36.13"></a><span id="l36.13" class="difflineminus">-    while (wrappedHandlerInfos.hasMoreElements()) {</span>
<a href="#l36.14"></a><span id="l36.14" class="difflineminus">-      let wrappedHandlerInfo = wrappedHandlerInfos</span>
<a href="#l36.15"></a><span id="l36.15" class="difflineminus">-        .getNext()</span>
<a href="#l36.16"></a><span id="l36.16" class="difflineminus">-        .QueryInterface(Ci.nsIHandlerInfo);</span>
<a href="#l36.17"></a><span id="l36.17" class="difflineplus">+    for (let wrappedHandlerInfo of gHandlerService.enumerate()) {</span>
<a href="#l36.18"></a><span id="l36.18">       let type = wrappedHandlerInfo.type;</span>
<a href="#l36.19"></a><span id="l36.19"> </span>
<a href="#l36.20"></a><span id="l36.20">       let handlerInfoWrapper;</span>
<a href="#l36.21"></a><span id="l36.21">       if (type in this._handledTypes) {</span>
<a href="#l36.22"></a><span id="l36.22">         handlerInfoWrapper = this._handledTypes[type];</span>
<a href="#l36.23"></a><span id="l36.23">       } else {</span>
<a href="#l36.24"></a><span id="l36.24">         handlerInfoWrapper = new HandlerInfoWrapper(type, wrappedHandlerInfo);</span>
<a href="#l36.25"></a><span id="l36.25">         this._handledTypes[type] = handlerInfoWrapper;</span>
<a href="#l36.26"></a><span id="l36.26" class="difflineat">@@ -1651,19 +1647,18 @@ var gGeneralPane = {</span>
<a href="#l36.27"></a><span id="l36.27">    * object.</span>
<a href="#l36.28"></a><span id="l36.28">    *</span>
<a href="#l36.29"></a><span id="l36.29">    * @param aHandlerInfo {nsIHandlerInfo} the type to get the extensions for.</span>
<a href="#l36.30"></a><span id="l36.30">    * @return {string} the extensions for the type</span>
<a href="#l36.31"></a><span id="l36.31">    */</span>
<a href="#l36.32"></a><span id="l36.32">   _typeDetails(aHandlerInfo) {</span>
<a href="#l36.33"></a><span id="l36.33">     let exts = [];</span>
<a href="#l36.34"></a><span id="l36.34">     if (aHandlerInfo.wrappedHandlerInfo instanceof Ci.nsIMIMEInfo) {</span>
<a href="#l36.35"></a><span id="l36.35" class="difflineminus">-      let extIter = aHandlerInfo.wrappedHandlerInfo.getFileExtensions();</span>
<a href="#l36.36"></a><span id="l36.36" class="difflineminus">-      while (extIter.hasMore()) {</span>
<a href="#l36.37"></a><span id="l36.37" class="difflineminus">-        let ext = &quot;.&quot; + extIter.getNext();</span>
<a href="#l36.38"></a><span id="l36.38" class="difflineplus">+      for (let extName of aHandlerInfo.wrappedHandlerInfo.getFileExtensions()) {</span>
<a href="#l36.39"></a><span id="l36.39" class="difflineplus">+        let ext = &quot;.&quot; + extName;</span>
<a href="#l36.40"></a><span id="l36.40">         if (!exts.includes(ext)) {</span>
<a href="#l36.41"></a><span id="l36.41">           exts.push(ext);</span>
<a href="#l36.42"></a><span id="l36.42">         }</span>
<a href="#l36.43"></a><span id="l36.43">       }</span>
<a href="#l36.44"></a><span id="l36.44">     }</span>
<a href="#l36.45"></a><span id="l36.45">     exts.sort();</span>
<a href="#l36.46"></a><span id="l36.46">     exts = exts.join(&quot;, &quot;);</span>
<a href="#l36.47"></a><span id="l36.47">     if (this._visibleDescriptions.has(aHandlerInfo.description)) {</span>
<a href="#l36.48"></a><span id="l36.48" class="difflineat">@@ -1802,20 +1797,18 @@ var gGeneralPane = {</span>
<a href="#l36.49"></a><span id="l36.49">         handlerInfo.iconURLForSystemDefault</span>
<a href="#l36.50"></a><span id="l36.50">       );</span>
<a href="#l36.51"></a><span id="l36.51"> </span>
<a href="#l36.52"></a><span id="l36.52">       menuPopup.appendChild(defaultMenuItem);</span>
<a href="#l36.53"></a><span id="l36.53">     }</span>
<a href="#l36.54"></a><span id="l36.54"> </span>
<a href="#l36.55"></a><span id="l36.55">     // Create menu items for possible handlers.</span>
<a href="#l36.56"></a><span id="l36.56">     let preferredApp = handlerInfo.preferredApplicationHandler;</span>
<a href="#l36.57"></a><span id="l36.57" class="difflineminus">-    let possibleApps = handlerInfo.possibleApplicationHandlers.enumerate();</span>
<a href="#l36.58"></a><span id="l36.58">     var possibleAppMenuItems = [];</span>
<a href="#l36.59"></a><span id="l36.59" class="difflineminus">-    while (possibleApps.hasMoreElements()) {</span>
<a href="#l36.60"></a><span id="l36.60" class="difflineminus">-      let possibleApp = possibleApps.getNext();</span>
<a href="#l36.61"></a><span id="l36.61" class="difflineplus">+    for (let possibleApp of handlerInfo.possibleApplicationHandlers.enumerate()) {</span>
<a href="#l36.62"></a><span id="l36.62">       if (!gGeneralPane.isValidHandlerApp(possibleApp)) {</span>
<a href="#l36.63"></a><span id="l36.63">         continue;</span>
<a href="#l36.64"></a><span id="l36.64">       }</span>
<a href="#l36.65"></a><span id="l36.65"> </span>
<a href="#l36.66"></a><span id="l36.66">       let menuItem = document.createXULElement(&quot;menuitem&quot;);</span>
<a href="#l36.67"></a><span id="l36.67">       menuItem.setAttribute(&quot;action&quot;, Ci.nsIHandlerInfo.useHelperApp);</span>
<a href="#l36.68"></a><span id="l36.68">       let label;</span>
<a href="#l36.69"></a><span id="l36.69">       if (possibleApp instanceof Ci.nsILocalHandlerApp) {</span>
<a href="#l36.70"></a><span id="l36.70" class="difflineat">@@ -2563,19 +2556,18 @@ class HandlerInfoWrapper {</span>
<a href="#l36.71"></a><span id="l36.71">     }</span>
<a href="#l36.72"></a><span id="l36.72">   }</span>
<a href="#l36.73"></a><span id="l36.73"> </span>
<a href="#l36.74"></a><span id="l36.74">   get possibleApplicationHandlers() {</span>
<a href="#l36.75"></a><span id="l36.75">     return this.wrappedHandlerInfo.possibleApplicationHandlers;</span>
<a href="#l36.76"></a><span id="l36.76">   }</span>
<a href="#l36.77"></a><span id="l36.77"> </span>
<a href="#l36.78"></a><span id="l36.78">   addPossibleApplicationHandler(aNewHandler) {</span>
<a href="#l36.79"></a><span id="l36.79" class="difflineminus">-    var possibleApps = this.possibleApplicationHandlers.enumerate();</span>
<a href="#l36.80"></a><span id="l36.80" class="difflineminus">-    while (possibleApps.hasMoreElements()) {</span>
<a href="#l36.81"></a><span id="l36.81" class="difflineminus">-      if (possibleApps.getNext().equals(aNewHandler)) {</span>
<a href="#l36.82"></a><span id="l36.82" class="difflineplus">+    for (let possibleApp of this.possibleApplicationHandlers.enumerate()) {</span>
<a href="#l36.83"></a><span id="l36.83" class="difflineplus">+      if (possibleApp.equals(aNewHandler)) {</span>
<a href="#l36.84"></a><span id="l36.84">         return;</span>
<a href="#l36.85"></a><span id="l36.85">       }</span>
<a href="#l36.86"></a><span id="l36.86">     }</span>
<a href="#l36.87"></a><span id="l36.87">     this.possibleApplicationHandlers.appendElement(aNewHandler);</span>
<a href="#l36.88"></a><span id="l36.88">   }</span>
<a href="#l36.89"></a><span id="l36.89"> </span>
<a href="#l36.90"></a><span id="l36.90">   removePossibleApplicationHandler(aHandler) {</span>
<a href="#l36.91"></a><span id="l36.91">     var defaultApp = this.preferredApplicationHandler;</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l37.1"></a><span id="l37.1" class="difflineminus">--- a/mail/components/search/SearchIntegration.jsm</span>
<a href="#l37.2"></a><span id="l37.2" class="difflineplus">+++ b/mail/components/search/SearchIntegration.jsm</span>
<a href="#l37.3"></a><span id="l37.3" class="difflineat">@@ -410,21 +410,17 @@ var SearchSupport = {</span>
<a href="#l37.4"></a><span id="l37.4">         searchTerm.value = value;</span>
<a href="#l37.5"></a><span id="l37.5">         searchTerms.appendElement(searchTerm);</span>
<a href="#l37.6"></a><span id="l37.6">         this._headerEnumerator = this._currentFolderToIndex.msgDatabase.getFilterEnumerator(</span>
<a href="#l37.7"></a><span id="l37.7">           searchTerms</span>
<a href="#l37.8"></a><span id="l37.8">         );</span>
<a href="#l37.9"></a><span id="l37.9">       }</span>
<a href="#l37.10"></a><span id="l37.10"> </span>
<a href="#l37.11"></a><span id="l37.11">       // iterate over the folder finding the next message to index</span>
<a href="#l37.12"></a><span id="l37.12" class="difflineminus">-      while (this._headerEnumerator.hasMoreElements()) {</span>
<a href="#l37.13"></a><span id="l37.13" class="difflineminus">-        let msgHdr = this._headerEnumerator</span>
<a href="#l37.14"></a><span id="l37.14" class="difflineminus">-          .getNext()</span>
<a href="#l37.15"></a><span id="l37.15" class="difflineminus">-          .QueryInterface(Ci.nsIMsgDBHdr);</span>
<a href="#l37.16"></a><span id="l37.16" class="difflineminus">-</span>
<a href="#l37.17"></a><span id="l37.17" class="difflineplus">+      for (let msgHdr of this._headerEnumerator) {</span>
<a href="#l37.18"></a><span id="l37.18">         // Check if the file exists. If it does, then assume indexing to be</span>
<a href="#l37.19"></a><span id="l37.19">         // complete for this file</span>
<a href="#l37.20"></a><span id="l37.20">         if (this._getSupportFile(msgHdr).exists()) {</span>
<a href="#l37.21"></a><span id="l37.21">           this._log.debug(</span>
<a href="#l37.22"></a><span id="l37.22">             &quot;Message time not set but file exists; setting &quot; +</span>
<a href="#l37.23"></a><span id="l37.23">               &quot;time to &quot; +</span>
<a href="#l37.24"></a><span id="l37.24">               reindexTime</span>
<a href="#l37.25"></a><span id="l37.25">           );</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l38.1"></a><span id="l38.1" class="difflineminus">--- a/mail/extensions/openpgp/content/modules/addrbook.jsm</span>
<a href="#l38.2"></a><span id="l38.2" class="difflineplus">+++ b/mail/extensions/openpgp/content/modules/addrbook.jsm</span>
<a href="#l38.3"></a><span id="l38.3" class="difflineat">@@ -28,20 +28,18 @@ var EnigmailAddrbook = {</span>
<a href="#l38.4"></a><span id="l38.4">    *</span>
<a href="#l38.5"></a><span id="l38.5">    * @return if found: Object:</span>
<a href="#l38.6"></a><span id="l38.6">    *           - card: nsIAbCard for found email address</span>
<a href="#l38.7"></a><span id="l38.7">    *           - directory: nsIAbDirectory of found card</span>
<a href="#l38.8"></a><span id="l38.8">    *         NULL if not found</span>
<a href="#l38.9"></a><span id="l38.9">    */</span>
<a href="#l38.10"></a><span id="l38.10">   lookupEmailAddress: function(emailAddr) {</span>
<a href="#l38.11"></a><span id="l38.11">     let abm = Cc[ABMANAGER].getService(Ci.nsIAbManager);</span>
<a href="#l38.12"></a><span id="l38.12" class="difflineminus">-    let enumerator = abm.directories;</span>
<a href="#l38.13"></a><span id="l38.13"> </span>
<a href="#l38.14"></a><span id="l38.14" class="difflineminus">-    while (enumerator.hasMoreElements()) {</span>
<a href="#l38.15"></a><span id="l38.15" class="difflineminus">-      let abd = enumerator.getNext().QueryInterface(Ci.nsIAbDirectory);</span>
<a href="#l38.16"></a><span id="l38.16" class="difflineplus">+    for (let abd of abm.directories) {</span>
<a href="#l38.17"></a><span id="l38.17">       try {</span>
<a href="#l38.18"></a><span id="l38.18">         let crd = abd.cardForEmailAddress(emailAddr);</span>
<a href="#l38.19"></a><span id="l38.19">         if (crd) return {</span>
<a href="#l38.20"></a><span id="l38.20">           directory: abd,</span>
<a href="#l38.21"></a><span id="l38.21">           card: crd</span>
<a href="#l38.22"></a><span id="l38.22">         };</span>
<a href="#l38.23"></a><span id="l38.23">       }</span>
<a href="#l38.24"></a><span id="l38.24">       catch (x) {}</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l39.1"></a><span id="l39.1" class="difflineminus">--- a/mail/extensions/openpgp/content/modules/autoSetup.jsm</span>
<a href="#l39.2"></a><span id="l39.2" class="difflineplus">+++ b/mail/extensions/openpgp/content/modules/autoSetup.jsm</span>
<a href="#l39.3"></a><span id="l39.3" class="difflineat">@@ -121,21 +121,18 @@ var EnigmailAutoSetup = {</span>
<a href="#l39.4"></a><span id="l39.4">             if ((msgFolder.flags &amp; Ci.nsMsgFolderFlags.Junk) ||</span>
<a href="#l39.5"></a><span id="l39.5">               (msgFolder.flags &amp; Ci.nsMsgFolderFlags.Trash) ||</span>
<a href="#l39.6"></a><span id="l39.6">               (!account.defaultIdentity)) {</span>
<a href="#l39.7"></a><span id="l39.7">               continue;</span>
<a href="#l39.8"></a><span id="l39.8">             }</span>
<a href="#l39.9"></a><span id="l39.9"> </span>
<a href="#l39.10"></a><span id="l39.10">             EnigmailLog.DEBUG(`autoSetup.jsm: determinePreviousInstallType: scanning folder &quot;${msgFolder.name}&quot;\n`);</span>
<a href="#l39.11"></a><span id="l39.11"> </span>
<a href="#l39.12"></a><span id="l39.12" class="difflineminus">-            let msgEnumerator = msgDatabase.ReverseEnumerateMessages();</span>
<a href="#l39.13"></a><span id="l39.13" class="difflineminus">-</span>
<a href="#l39.14"></a><span id="l39.14">             // Iterating through each message in the Folder</span>
<a href="#l39.15"></a><span id="l39.15" class="difflineminus">-            while (msgEnumerator.hasMoreElements()) {</span>
<a href="#l39.16"></a><span id="l39.16" class="difflineminus">-              let msgHeader = msgEnumerator.getNext().QueryInterface(nsIMsgDBHdr);</span>
<a href="#l39.17"></a><span id="l39.17" class="difflineplus">+            for (let msgHeader of msgDatabase.ReverseEnumerateMessages()) {</span>
<a href="#l39.18"></a><span id="l39.18">               let msgURI = msgFolder.getUriForMsg(msgHeader);</span>
<a href="#l39.19"></a><span id="l39.19"> </span>
<a href="#l39.20"></a><span id="l39.20">               let msgAuthor = &quot;&quot;;</span>
<a href="#l39.21"></a><span id="l39.21">               try {</span>
<a href="#l39.22"></a><span id="l39.22">                 msgAuthor = EnigmailFuncs.stripEmail(msgHeader.author);</span>
<a href="#l39.23"></a><span id="l39.23">               }</span>
<a href="#l39.24"></a><span id="l39.24">               catch (x) {}</span>
<a href="#l39.25"></a><span id="l39.25"> </span>
<a href="#l39.26"></a><span id="l39.26" class="difflineat">@@ -445,19 +442,18 @@ var EnigmailAutoSetup = {</span>
<a href="#l39.27"></a><span id="l39.27"> </span>
<a href="#l39.28"></a><span id="l39.28"> function getMsgFolders(folder, msgFolderArr) {</span>
<a href="#l39.29"></a><span id="l39.29">   if (folder.getTotalMessages(false) &gt; 0) {</span>
<a href="#l39.30"></a><span id="l39.30">     msgFolderArr.push(folder);</span>
<a href="#l39.31"></a><span id="l39.31">   }</span>
<a href="#l39.32"></a><span id="l39.32"> </span>
<a href="#l39.33"></a><span id="l39.33">   // add all subfolders</span>
<a href="#l39.34"></a><span id="l39.34">   if (folder.hasSubFolders) {</span>
<a href="#l39.35"></a><span id="l39.35" class="difflineminus">-    let subFolders = folder.subFolders;</span>
<a href="#l39.36"></a><span id="l39.36" class="difflineminus">-    while (subFolders.hasMoreElements()) {</span>
<a href="#l39.37"></a><span id="l39.37" class="difflineminus">-      getMsgFolders(subFolders.getNext().QueryInterface(nsIMsgFolder), msgFolderArr);</span>
<a href="#l39.38"></a><span id="l39.38" class="difflineplus">+    for (let folder of folder.subFolders) {</span>
<a href="#l39.39"></a><span id="l39.39" class="difflineplus">+      getMsgFolders(folder, msgFolderArr);</span>
<a href="#l39.40"></a><span id="l39.40">     }</span>
<a href="#l39.41"></a><span id="l39.41">   }</span>
<a href="#l39.42"></a><span id="l39.42"> }</span>
<a href="#l39.43"></a><span id="l39.43"> </span>
<a href="#l39.44"></a><span id="l39.44"> // Util Function for Extracting manually added Headers</span>
<a href="#l39.45"></a><span id="l39.45"> function streamListener(callback) {</span>
<a href="#l39.46"></a><span id="l39.46">   let streamListener = {</span>
<a href="#l39.47"></a><span id="l39.47">     mAttachments: [],</span>
<a href="#l39.48"></a><span id="l39.48" class="difflineat">@@ -476,19 +472,19 @@ function streamListener(callback) {</span>
<a href="#l39.49"></a><span id="l39.49">     onStopRequest: function(aRequest, aStatusCode) {</span>
<a href="#l39.50"></a><span id="l39.50">       callback();</span>
<a href="#l39.51"></a><span id="l39.51">       this.mBusy = false; // if needed, you can poll this var to see if we are done collecting attachment details</span>
<a href="#l39.52"></a><span id="l39.52">     },</span>
<a href="#l39.53"></a><span id="l39.53">     onDataAvailable: function(aRequest, aInputStream, aOffset, aCount) {},</span>
<a href="#l39.54"></a><span id="l39.54">     onStartHeaders: function() {},</span>
<a href="#l39.55"></a><span id="l39.55">     onEndHeaders: function() {},</span>
<a href="#l39.56"></a><span id="l39.56">     processHeaders: function(aHeaderNameEnumerator, aHeaderValueEnumerator, aDontCollectAddress) {</span>
<a href="#l39.57"></a><span id="l39.57" class="difflineminus">-      while (aHeaderNameEnumerator.hasMore()) {</span>
<a href="#l39.58"></a><span id="l39.58" class="difflineplus">+      for (let headerName of aHeaderNameEnumerator) {</span>
<a href="#l39.59"></a><span id="l39.59">         this.mHeaders.push({</span>
<a href="#l39.60"></a><span id="l39.60" class="difflineminus">-          name: aHeaderNameEnumerator.getNext().toLowerCase(),</span>
<a href="#l39.61"></a><span id="l39.61" class="difflineplus">+          name: headerName.toLowerCase(),</span>
<a href="#l39.62"></a><span id="l39.62">           value: aHeaderValueEnumerator.getNext()</span>
<a href="#l39.63"></a><span id="l39.63">         });</span>
<a href="#l39.64"></a><span id="l39.64">       }</span>
<a href="#l39.65"></a><span id="l39.65">     },</span>
<a href="#l39.66"></a><span id="l39.66">     handleAttachment: function(aContentType, aUrl, aDisplayName, aUri, aIsExternalAttachment) {</span>
<a href="#l39.67"></a><span id="l39.67">       if (aContentType == &quot;text/html&quot;) {</span>
<a href="#l39.68"></a><span id="l39.68">         return;</span>
<a href="#l39.69"></a><span id="l39.69">       }</span>
<a href="#l39.70"></a><span id="l39.70" class="difflineat">@@ -609,18 +605,18 @@ function getStreamedHeaders(msgURI, mms)</span>
<a href="#l39.71"></a><span id="l39.71">     let headerObj = {};</span>
<a href="#l39.72"></a><span id="l39.72">     try {</span>
<a href="#l39.73"></a><span id="l39.73">       mms.streamHeaders(msgURI, EnigmailStreams.newStringStreamListener(aRawString =&gt; {</span>
<a href="#l39.74"></a><span id="l39.74">         try {</span>
<a href="#l39.75"></a><span id="l39.75">           //EnigmailLog.DEBUG(`getStreamedHeaders: ${aRawString}\n`);</span>
<a href="#l39.76"></a><span id="l39.76">           headers.initialize(aRawString);</span>
<a href="#l39.77"></a><span id="l39.77"> </span>
<a href="#l39.78"></a><span id="l39.78">           let i = headers.headerNames;</span>
<a href="#l39.79"></a><span id="l39.79" class="difflineminus">-          while (i.hasMore()) {</span>
<a href="#l39.80"></a><span id="l39.80" class="difflineminus">-            let hdrName = i.getNext().toLowerCase();</span>
<a href="#l39.81"></a><span id="l39.81" class="difflineplus">+          for (let hdr of headers.headerNames) {</span>
<a href="#l39.82"></a><span id="l39.82" class="difflineplus">+            let hdrName = hdr.toLowerCase();</span>
<a href="#l39.83"></a><span id="l39.83"> </span>
<a href="#l39.84"></a><span id="l39.84">             let hdrValue = headers.extractHeader(hdrName, true);</span>
<a href="#l39.85"></a><span id="l39.85">             headerObj[hdrName] = hdrValue;</span>
<a href="#l39.86"></a><span id="l39.86">           }</span>
<a href="#l39.87"></a><span id="l39.87"> </span>
<a href="#l39.88"></a><span id="l39.88">           if (&quot;autocrypt&quot; in headerObj) {</span>
<a href="#l39.89"></a><span id="l39.89">             let acHeader = headers.extractHeader(&quot;autocrypt&quot;, false);</span>
<a href="#l39.90"></a><span id="l39.90">             acHeader = acHeader.replace(/keydata=/i, 'keydata=&quot;') + '&quot;';</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l40.1"></a><span id="l40.1" class="difflineminus">--- a/mail/extensions/openpgp/content/modules/files.jsm</span>
<a href="#l40.2"></a><span id="l40.2" class="difflineplus">+++ b/mail/extensions/openpgp/content/modules/files.jsm</span>
<a href="#l40.3"></a><span id="l40.3" class="difflineat">@@ -493,19 +493,18 @@ var EnigmailFiles = {</span>
<a href="#l40.4"></a><span id="l40.4">       }</span>
<a href="#l40.5"></a><span id="l40.5">       dirObj.create(dirObj.DIRECTORY_TYPE, 493);</span>
<a href="#l40.6"></a><span id="l40.6">     }</span>
<a href="#l40.7"></a><span id="l40.7"> </span>
<a href="#l40.8"></a><span id="l40.8">     try {</span>
<a href="#l40.9"></a><span id="l40.9">       let zipReader = EnigmailFiles.openZipFile(zipFile);</span>
<a href="#l40.10"></a><span id="l40.10">       let f = zipReader.findEntries(&quot;*&quot;);</span>
<a href="#l40.11"></a><span id="l40.11"> </span>
<a href="#l40.12"></a><span id="l40.12" class="difflineminus">-      while (f.hasMore()) {</span>
<a href="#l40.13"></a><span id="l40.13" class="difflineplus">+      for (let i of f) {</span>
<a href="#l40.14"></a><span id="l40.14">         let t = targetDir.clone();</span>
<a href="#l40.15"></a><span id="l40.15" class="difflineminus">-        let i = f.getNext();</span>
<a href="#l40.16"></a><span id="l40.16">         let entry = zipReader.getEntry(i);</span>
<a href="#l40.17"></a><span id="l40.17"> </span>
<a href="#l40.18"></a><span id="l40.18">         if (!EnigmailOS.isDosLike) {</span>
<a href="#l40.19"></a><span id="l40.19">           t.initWithPath(t.path + &quot;/&quot; + i);</span>
<a href="#l40.20"></a><span id="l40.20">         }</span>
<a href="#l40.21"></a><span id="l40.21">         else {</span>
<a href="#l40.22"></a><span id="l40.22">           i = i.replace(/\//g, &quot;\\&quot;);</span>
<a href="#l40.23"></a><span id="l40.23">           t.initWithPath(t.path + &quot;\\&quot; + i);</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l41.1"></a><span id="l41.1" class="difflineminus">--- a/mail/extensions/openpgp/content/modules/funcs.jsm</span>
<a href="#l41.2"></a><span id="l41.2" class="difflineplus">+++ b/mail/extensions/openpgp/content/modules/funcs.jsm</span>
<a href="#l41.3"></a><span id="l41.3" class="difflineat">@@ -358,23 +358,17 @@ var EnigmailFuncs = {</span>
<a href="#l41.4"></a><span id="l41.4">    */</span>
<a href="#l41.5"></a><span id="l41.5">   getNumOfX509Certs: function() {</span>
<a href="#l41.6"></a><span id="l41.6"> </span>
<a href="#l41.7"></a><span id="l41.7">     let certDb = Cc[&quot;@mozilla.org/security/x509certdb;1&quot;].getService(Ci.nsIX509CertDB);</span>
<a href="#l41.8"></a><span id="l41.8">     let certs = certDb.getCerts();</span>
<a href="#l41.9"></a><span id="l41.9">     let nCerts = 0;</span>
<a href="#l41.10"></a><span id="l41.10"> </span>
<a href="#l41.11"></a><span id="l41.11">     if (certs) {</span>
<a href="#l41.12"></a><span id="l41.12" class="difflineminus">-      // FIXME: API Change: what should happen for TB 70 and newer?</span>
<a href="#l41.13"></a><span id="l41.13" class="difflineminus">-      let e = certs.getEnumerator();</span>
<a href="#l41.14"></a><span id="l41.14" class="difflineminus">-</span>
<a href="#l41.15"></a><span id="l41.15" class="difflineminus">-      while (e.hasMoreElements()) {</span>
<a href="#l41.16"></a><span id="l41.16" class="difflineminus">-        nCerts++;</span>
<a href="#l41.17"></a><span id="l41.17" class="difflineminus">-        e.getNext();</span>
<a href="#l41.18"></a><span id="l41.18" class="difflineminus">-      }</span>
<a href="#l41.19"></a><span id="l41.19" class="difflineplus">+      let nCerts = [...certs.getEnumerator()].length;</span>
<a href="#l41.20"></a><span id="l41.20">     }</span>
<a href="#l41.21"></a><span id="l41.21"> </span>
<a href="#l41.22"></a><span id="l41.22">     return nCerts;</span>
<a href="#l41.23"></a><span id="l41.23">   },</span>
<a href="#l41.24"></a><span id="l41.24"> </span>
<a href="#l41.25"></a><span id="l41.25">   /**</span>
<a href="#l41.26"></a><span id="l41.26">    * Get the nsIMsgAccount associated with a given nsIMsgIdentity</span>
<a href="#l41.27"></a><span id="l41.27">    */</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l42.1"></a><span id="l42.1" class="difflineminus">--- a/mail/extensions/openpgp/content/modules/keyserver.jsm</span>
<a href="#l42.2"></a><span id="l42.2" class="difflineplus">+++ b/mail/extensions/openpgp/content/modules/keyserver.jsm</span>
<a href="#l42.3"></a><span id="l42.3" class="difflineat">@@ -369,19 +369,17 @@ const accessHkpInternal = {</span>
<a href="#l42.4"></a><span id="l42.4">   /**</span>
<a href="#l42.5"></a><span id="l42.5">    * Get the CA certificate for the HKPS sks-keyserver pool</span>
<a href="#l42.6"></a><span id="l42.6">    */</span>
<a href="#l42.7"></a><span id="l42.7">   getSksCACert: async function() {</span>
<a href="#l42.8"></a><span id="l42.8">     EnigmailLog.DEBUG(`keyserver.jsm: getSksCACert()\n`);</span>
<a href="#l42.9"></a><span id="l42.9">     let certDb = Cc[&quot;@mozilla.org/security/x509certdb;1&quot;].getService(Ci.nsIX509CertDB);</span>
<a href="#l42.10"></a><span id="l42.10">     let cert = null;</span>
<a href="#l42.11"></a><span id="l42.11"> </span>
<a href="#l42.12"></a><span id="l42.12" class="difflineminus">-    let it = certDb.getCerts().getEnumerator();</span>
<a href="#l42.13"></a><span id="l42.13" class="difflineminus">-    while (it.hasMoreElements()) {</span>
<a href="#l42.14"></a><span id="l42.14" class="difflineminus">-      cert = it.getNext().QueryInterface(Ci.nsIX509Cert);</span>
<a href="#l42.15"></a><span id="l42.15" class="difflineplus">+    for (cert of certDb.getCerts().getEnumerator()) {</span>
<a href="#l42.16"></a><span id="l42.16">       if (cert.subjectName === SKS_CACERT_SUBJECTNAME &amp;&amp; cert.certType === Ci.nsIX509Cert.CA_CERT) {</span>
<a href="#l42.17"></a><span id="l42.17">         return cert;</span>
<a href="#l42.18"></a><span id="l42.18">       }</span>
<a href="#l42.19"></a><span id="l42.19">     }</span>
<a href="#l42.20"></a><span id="l42.20"> </span>
<a href="#l42.21"></a><span id="l42.21">     cert = await this.installSksCACert();</span>
<a href="#l42.22"></a><span id="l42.22">     return cert;</span>
<a href="#l42.23"></a><span id="l42.23">   },</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l43.1"></a><span id="l43.1" class="difflineminus">--- a/mail/extensions/openpgp/content/modules/pgpmimeHandler.jsm</span>
<a href="#l43.2"></a><span id="l43.2" class="difflineplus">+++ b/mail/extensions/openpgp/content/modules/pgpmimeHandler.jsm</span>
<a href="#l43.3"></a><span id="l43.3" class="difflineat">@@ -240,22 +240,19 @@ PgpMimeHandler.prototype = {</span>
<a href="#l43.4"></a><span id="l43.4"> </span>
<a href="#l43.5"></a><span id="l43.5">     let headerSink = EnigmailSingletons.messageReader;</span>
<a href="#l43.6"></a><span id="l43.6">     headerSink.handleSMimeMessage(uri);</span>
<a href="#l43.7"></a><span id="l43.7">   },</span>
<a href="#l43.8"></a><span id="l43.8"> </span>
<a href="#l43.9"></a><span id="l43.9">   getMessengerWindow: function() {</span>
<a href="#l43.10"></a><span id="l43.10">     let windowManager = Cc[&quot;@mozilla.org/appshell/window-mediator;1&quot;].getService(Ci.nsIWindowMediator);</span>
<a href="#l43.11"></a><span id="l43.11"> </span>
<a href="#l43.12"></a><span id="l43.12" class="difflineminus">-    let winEnum = windowManager.getEnumerator(null);</span>
<a href="#l43.13"></a><span id="l43.13" class="difflineminus">-</span>
<a href="#l43.14"></a><span id="l43.14" class="difflineminus">-    while (winEnum.hasMoreElements()) {</span>
<a href="#l43.15"></a><span id="l43.15" class="difflineminus">-      let thisWin = winEnum.getNext();</span>
<a href="#l43.16"></a><span id="l43.16" class="difflineminus">-      if (thisWin.location.href.search(/\/messenger.xhtml$/) &gt; 0) {</span>
<a href="#l43.17"></a><span id="l43.17" class="difflineminus">-        return thisWin;</span>
<a href="#l43.18"></a><span id="l43.18" class="difflineplus">+    for (let win of windowManager.getEnumerator(null)) {</span>
<a href="#l43.19"></a><span id="l43.19" class="difflineplus">+      if (win.location.href.search(/\/messenger.xhtml$/) &gt; 0) {</span>
<a href="#l43.20"></a><span id="l43.20" class="difflineplus">+        return win;</span>
<a href="#l43.21"></a><span id="l43.21">       }</span>
<a href="#l43.22"></a><span id="l43.22">     }</span>
<a href="#l43.23"></a><span id="l43.23"> </span>
<a href="#l43.24"></a><span id="l43.24">     return null;</span>
<a href="#l43.25"></a><span id="l43.25">   }</span>
<a href="#l43.26"></a><span id="l43.26"> };</span>
<a href="#l43.27"></a><span id="l43.27"> </span>
<a href="#l43.28"></a><span id="l43.28"> </span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l44.1"></a><span id="l44.1" class="difflineminus">--- a/mail/extensions/openpgp/content/modules/protocolHandler.jsm</span>
<a href="#l44.2"></a><span id="l44.2" class="difflineplus">+++ b/mail/extensions/openpgp/content/modules/protocolHandler.jsm</span>
<a href="#l44.3"></a><span id="l44.3" class="difflineat">@@ -156,22 +156,20 @@ EnigmailProtocolHandler.prototype = {</span>
<a href="#l44.4"></a><span id="l44.4">     } else {</span>
<a href="#l44.5"></a><span id="l44.5">       // Display Enigmail about page</span>
<a href="#l44.6"></a><span id="l44.6">       winName = &quot;about:enigmail&quot;;</span>
<a href="#l44.7"></a><span id="l44.7">       spec = &quot;chrome://openpgp/content/ui/enigmailAbout.xhtml&quot;;</span>
<a href="#l44.8"></a><span id="l44.8">     }</span>
<a href="#l44.9"></a><span id="l44.9"> </span>
<a href="#l44.10"></a><span id="l44.10">     var windowManager = Cc[WMEDIATOR_CONTRACTID].getService(Ci.nsIWindowMediator);</span>
<a href="#l44.11"></a><span id="l44.11"> </span>
<a href="#l44.12"></a><span id="l44.12" class="difflineminus">-    var winEnum = windowManager.getEnumerator(null);</span>
<a href="#l44.13"></a><span id="l44.13">     var recentWin = null;</span>
<a href="#l44.14"></a><span id="l44.14" class="difflineminus">-    while (winEnum.hasMoreElements() &amp;&amp; !recentWin) {</span>
<a href="#l44.15"></a><span id="l44.15" class="difflineminus">-      var thisWin = winEnum.getNext();</span>
<a href="#l44.16"></a><span id="l44.16" class="difflineminus">-      if (thisWin.location.href == spec) {</span>
<a href="#l44.17"></a><span id="l44.17" class="difflineminus">-        recentWin = thisWin;</span>
<a href="#l44.18"></a><span id="l44.18" class="difflineplus">+    for (let win of windowManager.getEnumerator(null)) {</span>
<a href="#l44.19"></a><span id="l44.19" class="difflineplus">+      if (win.location.href == spec) {</span>
<a href="#l44.20"></a><span id="l44.20" class="difflineplus">+        recentWin = win;</span>
<a href="#l44.21"></a><span id="l44.21">       }</span>
<a href="#l44.22"></a><span id="l44.22">     }</span>
<a href="#l44.23"></a><span id="l44.23"> </span>
<a href="#l44.24"></a><span id="l44.24">     if (recentWin) {</span>
<a href="#l44.25"></a><span id="l44.25">       recentWin.focus();</span>
<a href="#l44.26"></a><span id="l44.26">     } else {</span>
<a href="#l44.27"></a><span id="l44.27">       var appShellSvc = Cc[ASS_CONTRACTID].getService(Ci.nsIAppShellService);</span>
<a href="#l44.28"></a><span id="l44.28">       var domWin = appShellSvc.hiddenDOMWindow;</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l45.1"></a><span id="l45.1" class="difflineminus">--- a/mail/extensions/openpgp/content/modules/windows.jsm</span>
<a href="#l45.2"></a><span id="l45.2" class="difflineplus">+++ b/mail/extensions/openpgp/content/modules/windows.jsm</span>
<a href="#l45.3"></a><span id="l45.3" class="difflineat">@@ -51,26 +51,24 @@ var EnigmailWindows = {</span>
<a href="#l45.4"></a><span id="l45.4">    * @spec      : String - window URL (e.g. chrome://openpgp/content/ui/test.xhtml)</span>
<a href="#l45.5"></a><span id="l45.5">    * @winOptions: String - window options as defined in nsIWindow.open</span>
<a href="#l45.6"></a><span id="l45.6">    * @optObj    : any    - an Object, Array, String, etc. that is passed as parameter</span>
<a href="#l45.7"></a><span id="l45.7">    *                       to the window</span>
<a href="#l45.8"></a><span id="l45.8">    */</span>
<a href="#l45.9"></a><span id="l45.9">   openWin: function(winName, spec, winOptions, optObj) {</span>
<a href="#l45.10"></a><span id="l45.10">     var windowManager = Cc[APPSHELL_MEDIATOR_CONTRACTID].getService(Ci.nsIWindowMediator);</span>
<a href="#l45.11"></a><span id="l45.11"> </span>
<a href="#l45.12"></a><span id="l45.12" class="difflineminus">-    var winEnum = windowManager.getEnumerator(null);</span>
<a href="#l45.13"></a><span id="l45.13">     var recentWin = null;</span>
<a href="#l45.14"></a><span id="l45.14" class="difflineminus">-    while (winEnum.hasMoreElements() &amp;&amp; !recentWin) {</span>
<a href="#l45.15"></a><span id="l45.15" class="difflineminus">-      var thisWin = winEnum.getNext();</span>
<a href="#l45.16"></a><span id="l45.16" class="difflineminus">-      if (thisWin.location.href == spec) {</span>
<a href="#l45.17"></a><span id="l45.17" class="difflineminus">-        recentWin = thisWin;</span>
<a href="#l45.18"></a><span id="l45.18" class="difflineplus">+    for (let win of windowManager.getEnumerator(null)) {</span>
<a href="#l45.19"></a><span id="l45.19" class="difflineplus">+      if (win.location.href == spec) {</span>
<a href="#l45.20"></a><span id="l45.20" class="difflineplus">+        recentWin = win;</span>
<a href="#l45.21"></a><span id="l45.21">         break;</span>
<a href="#l45.22"></a><span id="l45.22">       }</span>
<a href="#l45.23"></a><span id="l45.23" class="difflineminus">-      if (winName &amp;&amp; thisWin.name &amp;&amp; thisWin.name == winName) {</span>
<a href="#l45.24"></a><span id="l45.24" class="difflineminus">-        thisWin.focus();</span>
<a href="#l45.25"></a><span id="l45.25" class="difflineplus">+      if (winName &amp;&amp; win.name &amp;&amp; win.name == winName) {</span>
<a href="#l45.26"></a><span id="l45.26" class="difflineplus">+        win.focus();</span>
<a href="#l45.27"></a><span id="l45.27">         break;</span>
<a href="#l45.28"></a><span id="l45.28">       }</span>
<a href="#l45.29"></a><span id="l45.29"> </span>
<a href="#l45.30"></a><span id="l45.30">     }</span>
<a href="#l45.31"></a><span id="l45.31"> </span>
<a href="#l45.32"></a><span id="l45.32">     if (recentWin) {</span>
<a href="#l45.33"></a><span id="l45.33">       recentWin.focus();</span>
<a href="#l45.34"></a><span id="l45.34">     }</span>
<a href="#l45.35"></a><span id="l45.35" class="difflineat">@@ -91,25 +89,24 @@ var EnigmailWindows = {</span>
<a href="#l45.36"></a><span id="l45.36">    * Determine the best possible window to serve as parent window for dialogs.</span>
<a href="#l45.37"></a><span id="l45.37">    *</span>
<a href="#l45.38"></a><span id="l45.38">    * @return: nsIWindow object</span>
<a href="#l45.39"></a><span id="l45.39">    */</span>
<a href="#l45.40"></a><span id="l45.40">   getBestParentWin: function() {</span>
<a href="#l45.41"></a><span id="l45.41">     var windowManager = Cc[APPSHELL_MEDIATOR_CONTRACTID].getService(Ci.nsIWindowMediator);</span>
<a href="#l45.42"></a><span id="l45.42"> </span>
<a href="#l45.43"></a><span id="l45.43">     var bestFit = null;</span>
<a href="#l45.44"></a><span id="l45.44" class="difflineminus">-    var winEnum = windowManager.getEnumerator(null);</span>
<a href="#l45.45"></a><span id="l45.45" class="difflineplus">+    var winEnum = ;</span>
<a href="#l45.46"></a><span id="l45.46"> </span>
<a href="#l45.47"></a><span id="l45.47" class="difflineminus">-    while (winEnum.hasMoreElements()) {</span>
<a href="#l45.48"></a><span id="l45.48" class="difflineminus">-      var thisWin = winEnum.getNext();</span>
<a href="#l45.49"></a><span id="l45.49" class="difflineminus">-      if (thisWin.location.href.search(/\/messenger.xhtml$/) &gt; 0) {</span>
<a href="#l45.50"></a><span id="l45.50" class="difflineminus">-        bestFit = thisWin;</span>
<a href="#l45.51"></a><span id="l45.51" class="difflineplus">+    for (let win of windowManager.getEnumerator(null)) {</span>
<a href="#l45.52"></a><span id="l45.52" class="difflineplus">+      if (win.location.href.search(/\/messenger.xhtml$/) &gt; 0) {</span>
<a href="#l45.53"></a><span id="l45.53" class="difflineplus">+        bestFit = win;</span>
<a href="#l45.54"></a><span id="l45.54">       }</span>
<a href="#l45.55"></a><span id="l45.55" class="difflineminus">-      if (!bestFit &amp;&amp; thisWin.location.href.search(/\/messengercompose.xhtml$/) &gt; 0) {</span>
<a href="#l45.56"></a><span id="l45.56" class="difflineminus">-        bestFit = thisWin;</span>
<a href="#l45.57"></a><span id="l45.57" class="difflineplus">+      if (!bestFit &amp;&amp; win.location.href.search(/\/messengercompose.xhtml$/) &gt; 0) {</span>
<a href="#l45.58"></a><span id="l45.58" class="difflineplus">+        bestFit = win;</span>
<a href="#l45.59"></a><span id="l45.59">       }</span>
<a href="#l45.60"></a><span id="l45.60">     }</span>
<a href="#l45.61"></a><span id="l45.61"> </span>
<a href="#l45.62"></a><span id="l45.62">     if (!bestFit) {</span>
<a href="#l45.63"></a><span id="l45.63">       winEnum = windowManager.getEnumerator(null);</span>
<a href="#l45.64"></a><span id="l45.64">       bestFit = winEnum.getNext();</span>
<a href="#l45.65"></a><span id="l45.65">     }</span>
<a href="#l45.66"></a><span id="l45.66"> </span>
<a href="#l45.67"></a><span id="l45.67" class="difflineat">@@ -219,20 +216,18 @@ var EnigmailWindows = {</span>
<a href="#l45.68"></a><span id="l45.68">    * manager to refresh the displayed keys</span>
<a href="#l45.69"></a><span id="l45.69">    */</span>
<a href="#l45.70"></a><span id="l45.70"> </span>
<a href="#l45.71"></a><span id="l45.71">   keyManReloadKeys: function() {</span>
<a href="#l45.72"></a><span id="l45.72">     let windowManager = Cc[APPSHELL_MEDIATOR_CONTRACTID].getService(Ci.nsIWindowMediator);</span>
<a href="#l45.73"></a><span id="l45.73">     const winName = &quot;enigmail:KeyManager&quot;;</span>
<a href="#l45.74"></a><span id="l45.74">     const spec = &quot;chrome://openpgp/content/ui/enigmailKeygen.xhtml&quot;;</span>
<a href="#l45.75"></a><span id="l45.75"> </span>
<a href="#l45.76"></a><span id="l45.76" class="difflineminus">-    let winEnum = windowManager.getEnumerator(null);</span>
<a href="#l45.77"></a><span id="l45.77">     let recentWin = null;</span>
<a href="#l45.78"></a><span id="l45.78" class="difflineminus">-    while (winEnum.hasMoreElements() &amp;&amp; !recentWin) {</span>
<a href="#l45.79"></a><span id="l45.79" class="difflineminus">-      let thisWin = winEnum.getNext();</span>
<a href="#l45.80"></a><span id="l45.80" class="difflineplus">+    for (let thisWin of windowManager.getEnumerator(null) &amp;&amp; !recentWin) {</span>
<a href="#l45.81"></a><span id="l45.81">       if (thisWin.location.href == spec) {</span>
<a href="#l45.82"></a><span id="l45.82">         recentWin = thisWin;</span>
<a href="#l45.83"></a><span id="l45.83">         break;</span>
<a href="#l45.84"></a><span id="l45.84">       }</span>
<a href="#l45.85"></a><span id="l45.85">       if (thisWin.name &amp;&amp; thisWin.name == winName) {</span>
<a href="#l45.86"></a><span id="l45.86">         let evt = new thisWin.Event(&quot;reload-keycache&quot;, {</span>
<a href="#l45.87"></a><span id="l45.87">           &quot;bubbles&quot;: true,</span>
<a href="#l45.88"></a><span id="l45.88">           &quot;cancelable&quot;: false</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l46.1"></a><span id="l46.1" class="difflineminus">--- a/mail/extensions/openpgp/content/ui/enigmailKeyManager.js</span>
<a href="#l46.2"></a><span id="l46.2" class="difflineplus">+++ b/mail/extensions/openpgp/content/ui/enigmailKeyManager.js</span>
<a href="#l46.3"></a><span id="l46.3" class="difflineat">@@ -915,53 +915,45 @@ function enigmailRefreshAllKeys() {</span>
<a href="#l46.4"></a><span id="l46.4">   if (userAcceptsRefreshWarning() === true) {</span>
<a href="#l46.5"></a><span id="l46.5">     accessKeyServer(EnigmailConstants.REFRESH_KEY, enigmailReceiveKeyCb);</span>
<a href="#l46.6"></a><span id="l46.6">   }</span>
<a href="#l46.7"></a><span id="l46.7"> }</span>
<a href="#l46.8"></a><span id="l46.8"> </span>
<a href="#l46.9"></a><span id="l46.9"> // Iterate through contact emails and download them</span>
<a href="#l46.10"></a><span id="l46.10"> function enigmailDowloadContactKeysEngine() {</span>
<a href="#l46.11"></a><span id="l46.11">   let abManager = Cc[&quot;@mozilla.org/abmanager;1&quot;].getService(Ci.nsIAbManager);</span>
<a href="#l46.12"></a><span id="l46.12" class="difflineminus">-</span>
<a href="#l46.13"></a><span id="l46.13" class="difflineminus">-  let allAddressBooks = abManager.directories;</span>
<a href="#l46.14"></a><span id="l46.14">   let emails = [];</span>
<a href="#l46.15"></a><span id="l46.15"> </span>
<a href="#l46.16"></a><span id="l46.16" class="difflineminus">-  while (allAddressBooks.hasMoreElements()) {</span>
<a href="#l46.17"></a><span id="l46.17" class="difflineminus">-    let addressBook = allAddressBooks.getNext().QueryInterface(Ci.nsIAbDirectory);</span>
<a href="#l46.18"></a><span id="l46.18" class="difflineminus">-</span>
<a href="#l46.19"></a><span id="l46.19" class="difflineminus">-    if (addressBook instanceof Ci.nsIAbDirectory) { // or nsIAbItem or nsIAbCollection</span>
<a href="#l46.20"></a><span id="l46.20" class="difflineplus">+  for (let addressBook of abManager.directories) {</span>
<a href="#l46.21"></a><span id="l46.21" class="difflineplus">+    if (addressBook instanceof Ci.nsIAbDirectory) {</span>
<a href="#l46.22"></a><span id="l46.22" class="difflineplus">+      // or nsIAbItem or nsIAbCollection</span>
<a href="#l46.23"></a><span id="l46.23">       // ask for confirmation for each address book:</span>
<a href="#l46.24"></a><span id="l46.24" class="difflineminus">-      var doIt = EnigmailDialog.confirmDlg(window,</span>
<a href="#l46.25"></a><span id="l46.25" class="difflineplus">+      var doIt = EnigmailDialog.confirmDlg(</span>
<a href="#l46.26"></a><span id="l46.26" class="difflineplus">+        window,</span>
<a href="#l46.27"></a><span id="l46.27">         EnigGetString(&quot;downloadContactsKeys.importFrom&quot;, addressBook.dirName),</span>
<a href="#l46.28"></a><span id="l46.28">         EnigGetString(&quot;dlgYes&quot;),</span>
<a href="#l46.29"></a><span id="l46.29">         EnigGetString(&quot;dlg.button.skip&quot;));</span>
<a href="#l46.30"></a><span id="l46.30">       if (!doIt) {</span>
<a href="#l46.31"></a><span id="l46.31">         continue; // SKIP this address book</span>
<a href="#l46.32"></a><span id="l46.32">       }</span>
<a href="#l46.33"></a><span id="l46.33"> </span>
<a href="#l46.34"></a><span id="l46.34" class="difflineminus">-      let allChildCards = addressBook.childCards;</span>
<a href="#l46.35"></a><span id="l46.35" class="difflineminus">-</span>
<a href="#l46.36"></a><span id="l46.36" class="difflineminus">-      while (allChildCards.hasMoreElements()) {</span>
<a href="#l46.37"></a><span id="l46.37" class="difflineminus">-</span>
<a href="#l46.38"></a><span id="l46.38" class="difflineminus">-        let card = allChildCards.getNext().QueryInterface(Ci.nsIAbCard);</span>
<a href="#l46.39"></a><span id="l46.39" class="difflineminus">-</span>
<a href="#l46.40"></a><span id="l46.40" class="difflineplus">+      for (let card of addressBook.childCards) {</span>
<a href="#l46.41"></a><span id="l46.41">         try {</span>
<a href="#l46.42"></a><span id="l46.42">           let email = card.getPropertyAsAString(&quot;PrimaryEmail&quot;);</span>
<a href="#l46.43"></a><span id="l46.43">           if (email &amp;&amp; email.indexOf(&quot;@&quot;) &gt;= 0) {</span>
<a href="#l46.44"></a><span id="l46.44">             emails.push(email);</span>
<a href="#l46.45"></a><span id="l46.45">           }</span>
<a href="#l46.46"></a><span id="l46.46">         } catch (e) {}</span>
<a href="#l46.47"></a><span id="l46.47"> </span>
<a href="#l46.48"></a><span id="l46.48">         try {</span>
<a href="#l46.49"></a><span id="l46.49">           let email = card.getPropertyAsAString(&quot;SecondEmail&quot;);</span>
<a href="#l46.50"></a><span id="l46.50">           if (email &amp;&amp; email.indexOf(&quot;@&quot;) &gt;= 0) {</span>
<a href="#l46.51"></a><span id="l46.51">             emails.push(email);</span>
<a href="#l46.52"></a><span id="l46.52">           }</span>
<a href="#l46.53"></a><span id="l46.53">         } catch (e) {}</span>
<a href="#l46.54"></a><span id="l46.54" class="difflineminus">-</span>
<a href="#l46.55"></a><span id="l46.55">       }</span>
<a href="#l46.56"></a><span id="l46.56">     }</span>
<a href="#l46.57"></a><span id="l46.57">   }</span>
<a href="#l46.58"></a><span id="l46.58"> </span>
<a href="#l46.59"></a><span id="l46.59">   // list of emails might be emoty here, in which case we do nothing</span>
<a href="#l46.60"></a><span id="l46.60">   if (emails.length &lt;= 0) {</span>
<a href="#l46.61"></a><span id="l46.61">     return;</span>
<a href="#l46.62"></a><span id="l46.62">   }</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l47.1"></a><span id="l47.1" class="difflineminus">--- a/mail/test/browser/composition/browser_drafts.js</span>
<a href="#l47.2"></a><span id="l47.2" class="difflineplus">+++ b/mail/test/browser/composition/browser_drafts.js</span>
<a href="#l47.3"></a><span id="l47.3" class="difflineat">@@ -60,39 +60,29 @@ add_task(function test_open_draft_again(</span>
<a href="#l47.4"></a><span id="l47.4"> </span>
<a href="#l47.5"></a><span id="l47.5">   // Wait for the notification with the Edit button.</span>
<a href="#l47.6"></a><span id="l47.6">   wait_for_notification_to_show(mc, kBoxId, &quot;draftMsgContent&quot;);</span>
<a href="#l47.7"></a><span id="l47.7"> </span>
<a href="#l47.8"></a><span id="l47.8">   plan_for_new_window(&quot;msgcompose&quot;);</span>
<a href="#l47.9"></a><span id="l47.9">   mc.click(mc.eid(kBoxId, { tagName: &quot;button&quot;, label: &quot;Edit&quot; }));</span>
<a href="#l47.10"></a><span id="l47.10">   let cwc = wait_for_compose_window();</span>
<a href="#l47.11"></a><span id="l47.11"> </span>
<a href="#l47.12"></a><span id="l47.12" class="difflineminus">-  let cwins = 0;</span>
<a href="#l47.13"></a><span id="l47.13" class="difflineminus">-  let e = Services.wm.getEnumerator(&quot;msgcompose&quot;);</span>
<a href="#l47.14"></a><span id="l47.14" class="difflineminus">-  while (e.hasMoreElements()) {</span>
<a href="#l47.15"></a><span id="l47.15" class="difflineminus">-    e.getNext();</span>
<a href="#l47.16"></a><span id="l47.16" class="difflineminus">-    cwins++;</span>
<a href="#l47.17"></a><span id="l47.17" class="difflineminus">-  }</span>
<a href="#l47.18"></a><span id="l47.18" class="difflineplus">+  let cwins = [...Services.wm.getEnumerator(&quot;msgcompose&quot;)].length;</span>
<a href="#l47.19"></a><span id="l47.19"> </span>
<a href="#l47.20"></a><span id="l47.20">   // click edit in main win again</span>
<a href="#l47.21"></a><span id="l47.21">   mc.click(mc.eid(kBoxId, { tagName: &quot;button&quot;, label: &quot;Edit&quot; }));</span>
<a href="#l47.22"></a><span id="l47.22"> </span>
<a href="#l47.23"></a><span id="l47.23">   mc.sleep(1000); // wait a sec to see if it caused a new window</span>
<a href="#l47.24"></a><span id="l47.24"> </span>
<a href="#l47.25"></a><span id="l47.25">   Assert.ok(</span>
<a href="#l47.26"></a><span id="l47.26">     Services.ww.activeWindow == cwc.window,</span>
<a href="#l47.27"></a><span id="l47.27">     &quot;the original draft composition window should have got focus (again)&quot;</span>
<a href="#l47.28"></a><span id="l47.28">   );</span>
<a href="#l47.29"></a><span id="l47.29"> </span>
<a href="#l47.30"></a><span id="l47.30" class="difflineminus">-  let cwins2 = 0;</span>
<a href="#l47.31"></a><span id="l47.31" class="difflineminus">-  let e2 = Services.wm.getEnumerator(&quot;msgcompose&quot;);</span>
<a href="#l47.32"></a><span id="l47.32" class="difflineminus">-  while (e2.hasMoreElements()) {</span>
<a href="#l47.33"></a><span id="l47.33" class="difflineminus">-    e2.getNext();</span>
<a href="#l47.34"></a><span id="l47.34" class="difflineminus">-    cwins2++;</span>
<a href="#l47.35"></a><span id="l47.35" class="difflineminus">-  }</span>
<a href="#l47.36"></a><span id="l47.36" class="difflineplus">+  let cwins2 = [...Services.wm.getEnumerator(&quot;msgcompose&quot;)].length;</span>
<a href="#l47.37"></a><span id="l47.37"> </span>
<a href="#l47.38"></a><span id="l47.38">   Assert.ok(cwins2 &gt; 0, &quot;No compose window open!&quot;);</span>
<a href="#l47.39"></a><span id="l47.39">   Assert.equal(cwins, cwins2, &quot;The number of compose windows changed!&quot;);</span>
<a href="#l47.40"></a><span id="l47.40"> </span>
<a href="#l47.41"></a><span id="l47.41">   // Type something and save, then check that we only have one draft.</span>
<a href="#l47.42"></a><span id="l47.42">   cwc.type(cwc.eid(&quot;content-frame&quot;), &quot;Hello!&quot;);</span>
<a href="#l47.43"></a><span id="l47.43">   cwc.keypress(null, &quot;s&quot;, { shiftKey: false, accelKey: true });</span>
<a href="#l47.44"></a><span id="l47.44">   close_compose_window(cwc);</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l48.1"></a><span id="l48.1" class="difflineminus">--- a/mail/test/browser/folder-display/browser_messageCommandsOnMsgstore.js</span>
<a href="#l48.2"></a><span id="l48.2" class="difflineplus">+++ b/mail/test/browser/folder-display/browser_messageCommandsOnMsgstore.js</span>
<a href="#l48.3"></a><span id="l48.3" class="difflineat">@@ -194,20 +194,19 @@ add_task(function test_mark_messages_fla</span>
<a href="#l48.4"></a><span id="l48.4">     null,</span>
<a href="#l48.5"></a><span id="l48.5">     Ci.nsMsgMessageFlags.Read + Ci.nsMsgMessageFlags.Marked</span>
<a href="#l48.6"></a><span id="l48.6">   );</span>
<a href="#l48.7"></a><span id="l48.7"> });</span>
<a href="#l48.8"></a><span id="l48.8"> </span>
<a href="#l48.9"></a><span id="l48.9"> function subtest_check_queued_message() {</span>
<a href="#l48.10"></a><span id="l48.10">   // Always check the last message in the Outbox for the correct flag.</span>
<a href="#l48.11"></a><span id="l48.11">   be_in_folder(gOutbox);</span>
<a href="#l48.12"></a><span id="l48.12" class="difflineminus">-  let queued = gOutbox.messages;</span>
<a href="#l48.13"></a><span id="l48.13" class="difflineminus">-  while (queued.hasMoreElements()) {</span>
<a href="#l48.14"></a><span id="l48.14" class="difflineminus">-    let msg = queued.getNext().QueryInterface(Ci.nsIMsgDBHdr);</span>
<a href="#l48.15"></a><span id="l48.15" class="difflineminus">-    if (!queued.hasMoreElements()) {</span>
<a href="#l48.16"></a><span id="l48.16" class="difflineplus">+  let messages = gOutbox.messages;</span>
<a href="#l48.17"></a><span id="l48.17" class="difflineplus">+  for (let msg of messages) {</span>
<a href="#l48.18"></a><span id="l48.18" class="difflineplus">+    if (!messages.hasMoreElements()) {</span>
<a href="#l48.19"></a><span id="l48.19">       check_status(msg, null, null, Ci.nsMsgMessageFlags.Queued);</span>
<a href="#l48.20"></a><span id="l48.20">     }</span>
<a href="#l48.21"></a><span id="l48.21">   }</span>
<a href="#l48.22"></a><span id="l48.22"> }</span>
<a href="#l48.23"></a><span id="l48.23"> </span>
<a href="#l48.24"></a><span id="l48.24"> /**</span>
<a href="#l48.25"></a><span id="l48.25">  * Create a reply or forward of a message and queue it for sending later.</span>
<a href="#l48.26"></a><span id="l48.26">  *</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l49.1"></a><span id="l49.1" class="difflineminus">--- a/mail/test/browser/quick-filter-bar/browser_filterLogic.js</span>
<a href="#l49.2"></a><span id="l49.2" class="difflineplus">+++ b/mail/test/browser/quick-filter-bar/browser_filterLogic.js</span>
<a href="#l49.3"></a><span id="l49.3" class="difflineat">@@ -121,19 +121,17 @@ add_task(function test_filter_attachment</span>
<a href="#l49.4"></a><span id="l49.4">  * book we can find.</span>
<a href="#l49.5"></a><span id="l49.5">  */</span>
<a href="#l49.6"></a><span id="l49.6"> function add_email_to_address_book(aEmailAddr) {</span>
<a href="#l49.7"></a><span id="l49.7">   let card = Cc[&quot;@mozilla.org/addressbook/cardproperty;1&quot;].createInstance(</span>
<a href="#l49.8"></a><span id="l49.8">     Ci.nsIAbCard</span>
<a href="#l49.9"></a><span id="l49.9">   );</span>
<a href="#l49.10"></a><span id="l49.10">   card.primaryEmail = aEmailAddr;</span>
<a href="#l49.11"></a><span id="l49.11"> </span>
<a href="#l49.12"></a><span id="l49.12" class="difflineminus">-  let enumerator = MailServices.ab.directories;</span>
<a href="#l49.13"></a><span id="l49.13" class="difflineminus">-  while (enumerator.hasMoreElements()) {</span>
<a href="#l49.14"></a><span id="l49.14" class="difflineminus">-    let addrbook = enumerator.getNext();</span>
<a href="#l49.15"></a><span id="l49.15" class="difflineplus">+  for (let addrbook of MailServices.ab.directories) {</span>
<a href="#l49.16"></a><span id="l49.16">     if (addrbook instanceof Ci.nsIAbDirectory) {</span>
<a href="#l49.17"></a><span id="l49.17">       addrbook.addCard(card);</span>
<a href="#l49.18"></a><span id="l49.18">       return;</span>
<a href="#l49.19"></a><span id="l49.19">     }</span>
<a href="#l49.20"></a><span id="l49.20">   }</span>
<a href="#l49.21"></a><span id="l49.21"> </span>
<a href="#l49.22"></a><span id="l49.22">   throw new Error(&quot;Unable to find any suitable address book.&quot;);</span>
<a href="#l49.23"></a><span id="l49.23"> }</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l50.1"></a><span id="l50.1" class="difflineminus">--- a/mail/test/browser/session-store/browser_sessionStore.js</span>
<a href="#l50.2"></a><span id="l50.2" class="difflineplus">+++ b/mail/test/browser/session-store/browser_sessionStore.js</span>
<a href="#l50.3"></a><span id="l50.3" class="difflineat">@@ -459,19 +459,18 @@ add_task(function test_message_pane_widt</span>
<a href="#l50.4"></a><span id="l50.4"> add_task(function test_multiple_3pane_periodic_session_persistence() {</span>
<a href="#l50.5"></a><span id="l50.5">   // open a few more 3pane windows</span>
<a href="#l50.6"></a><span id="l50.6">   for (var i = 0; i &lt; 3; ++i) {</span>
<a href="#l50.7"></a><span id="l50.7">     open3PaneWindow();</span>
<a href="#l50.8"></a><span id="l50.8">   }</span>
<a href="#l50.9"></a><span id="l50.9"> </span>
<a href="#l50.10"></a><span id="l50.10">   // then get the state objects for each window</span>
<a href="#l50.11"></a><span id="l50.11">   let state = [];</span>
<a href="#l50.12"></a><span id="l50.12" class="difflineminus">-  let enumerator = Services.wm.getEnumerator(&quot;mail:3pane&quot;);</span>
<a href="#l50.13"></a><span id="l50.13" class="difflineminus">-  while (enumerator.hasMoreElements()) {</span>
<a href="#l50.14"></a><span id="l50.14" class="difflineminus">-    state.push(enumerator.getNext().getWindowStateForSessionPersistence());</span>
<a href="#l50.15"></a><span id="l50.15" class="difflineplus">+  for (let window of Services.wm.getEnumerator(&quot;mail:3pane&quot;)) {</span>
<a href="#l50.16"></a><span id="l50.16" class="difflineplus">+    state.push(window.getWindowStateForSessionPersistence());</span>
<a href="#l50.17"></a><span id="l50.17">   }</span>
<a href="#l50.18"></a><span id="l50.18"> </span>
<a href="#l50.19"></a><span id="l50.19">   SessionStoreManager._saveState();</span>
<a href="#l50.20"></a><span id="l50.20">   waitForFileRefresh();</span>
<a href="#l50.21"></a><span id="l50.21"> </span>
<a href="#l50.22"></a><span id="l50.22">   // load the saved state from disk</span>
<a href="#l50.23"></a><span id="l50.23">   let loadedState = readFile();</span>
<a href="#l50.24"></a><span id="l50.24">   Assert.ok(loadedState, &quot;previously saved state should be non-null&quot;);</span>
<a href="#l50.25"></a><span id="l50.25" class="difflineat">@@ -485,19 +484,18 @@ add_task(function test_multiple_3pane_pe</span>
<a href="#l50.26"></a><span id="l50.26">   for (let i = 0; i &lt; state.length; ++i) {</span>
<a href="#l50.27"></a><span id="l50.27">     Assert.ok(</span>
<a href="#l50.28"></a><span id="l50.28">       JSON.stringify(loadedState.windows[i]) == JSON.stringify(state[i]),</span>
<a href="#l50.29"></a><span id="l50.29">       &quot;saved state and loaded state should be equal&quot;</span>
<a href="#l50.30"></a><span id="l50.30">     );</span>
<a href="#l50.31"></a><span id="l50.31">   }</span>
<a href="#l50.32"></a><span id="l50.32"> </span>
<a href="#l50.33"></a><span id="l50.33">   // close all but one 3pane window</span>
<a href="#l50.34"></a><span id="l50.34" class="difflineminus">-  enumerator = Services.wm.getEnumerator(&quot;mail:3pane&quot;);</span>
<a href="#l50.35"></a><span id="l50.35" class="difflineminus">-  while (enumerator.hasMoreElements()) {</span>
<a href="#l50.36"></a><span id="l50.36" class="difflineminus">-    let window = enumerator.getNext();</span>
<a href="#l50.37"></a><span id="l50.37" class="difflineplus">+  let enumerator = Services.wm.getEnumerator(&quot;mail:3pane&quot;);</span>
<a href="#l50.38"></a><span id="l50.38" class="difflineplus">+  for (let window of enumerator) {</span>
<a href="#l50.39"></a><span id="l50.39">     if (enumerator.hasMoreElements()) {</span>
<a href="#l50.40"></a><span id="l50.40">       window.close();</span>
<a href="#l50.41"></a><span id="l50.41">     }</span>
<a href="#l50.42"></a><span id="l50.42">   }</span>
<a href="#l50.43"></a><span id="l50.43"> });</span>
<a href="#l50.44"></a><span id="l50.44"> </span>
<a href="#l50.45"></a><span id="l50.45"> async function test_bad_session_file_simple() {</span>
<a href="#l50.46"></a><span id="l50.46">   // forcefully write a bad session file</span>
<a href="#l50.47"></a><span id="l50.47" class="difflineat">@@ -533,18 +531,17 @@ add_task(function test_clean_shutdown_se</span>
<a href="#l50.48"></a><span id="l50.48"> </span>
<a href="#l50.49"></a><span id="l50.49">   // make sure we have a different window open, so that we don't start shutting</span>
<a href="#l50.50"></a><span id="l50.50">   // down just because the last window was closed</span>
<a href="#l50.51"></a><span id="l50.51">   let abwc = openAddressBook();</span>
<a href="#l50.52"></a><span id="l50.52"> </span>
<a href="#l50.53"></a><span id="l50.53">   // close all the 3pane windows</span>
<a href="#l50.54"></a><span id="l50.54">   let lastWindowState = null;</span>
<a href="#l50.55"></a><span id="l50.55">   let enumerator = Services.wm.getEnumerator(&quot;mail:3pane&quot;);</span>
<a href="#l50.56"></a><span id="l50.56" class="difflineminus">-  while (enumerator.hasMoreElements()) {</span>
<a href="#l50.57"></a><span id="l50.57" class="difflineminus">-    let window = enumerator.getNext();</span>
<a href="#l50.58"></a><span id="l50.58" class="difflineplus">+  for (let window of enumerator) {</span>
<a href="#l50.59"></a><span id="l50.59">     if (!enumerator.hasMoreElements()) {</span>
<a href="#l50.60"></a><span id="l50.60">       lastWindowState = window.getWindowStateForSessionPersistence();</span>
<a href="#l50.61"></a><span id="l50.61">     }</span>
<a href="#l50.62"></a><span id="l50.62"> </span>
<a href="#l50.63"></a><span id="l50.63">     close_window(new mozmill.controller.MozMillController(window));</span>
<a href="#l50.64"></a><span id="l50.64">   }</span>
<a href="#l50.65"></a><span id="l50.65"> </span>
<a href="#l50.66"></a><span id="l50.66">   // Wait for session file to be created (removed in prior test) after</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l51.1"></a><span id="l51.1" class="difflineminus">--- a/mail/test/browser/shared-modules/AddressBookHelpers.jsm</span>
<a href="#l51.2"></a><span id="l51.2" class="difflineplus">+++ b/mail/test/browser/shared-modules/AddressBookHelpers.jsm</span>
<a href="#l51.3"></a><span id="l51.3" class="difflineat">@@ -71,20 +71,17 @@ function ensure_card_exists(emailAddress</span>
<a href="#l51.4"></a><span id="l51.4">   collectedAddresses.addCard(card);</span>
<a href="#l51.5"></a><span id="l51.5"> }</span>
<a href="#l51.6"></a><span id="l51.6"> </span>
<a href="#l51.7"></a><span id="l51.7"> /**</span>
<a href="#l51.8"></a><span id="l51.8">  * Make sure that there is no card for this email address</span>
<a href="#l51.9"></a><span id="l51.9">  * @param emailAddress the address that should have no cards</span>
<a href="#l51.10"></a><span id="l51.10">  */</span>
<a href="#l51.11"></a><span id="l51.11"> function ensure_no_card_exists(emailAddress) {</span>
<a href="#l51.12"></a><span id="l51.12" class="difflineminus">-  var books = MailServices.ab.directories;</span>
<a href="#l51.13"></a><span id="l51.13" class="difflineminus">-</span>
<a href="#l51.14"></a><span id="l51.14" class="difflineminus">-  while (books.hasMoreElements()) {</span>
<a href="#l51.15"></a><span id="l51.15" class="difflineminus">-    var ab = books.getNext().QueryInterface(Ci.nsIAbDirectory);</span>
<a href="#l51.16"></a><span id="l51.16" class="difflineplus">+  for (let ab of MailServices.ab.directories) {</span>
<a href="#l51.17"></a><span id="l51.17">     try {</span>
<a href="#l51.18"></a><span id="l51.18">       var card = ab.cardForEmailAddress(emailAddress);</span>
<a href="#l51.19"></a><span id="l51.19">       if (card) {</span>
<a href="#l51.20"></a><span id="l51.20">         let cardArray = Cc[&quot;@mozilla.org/array;1&quot;].createInstance(</span>
<a href="#l51.21"></a><span id="l51.21">           Ci.nsIMutableArray</span>
<a href="#l51.22"></a><span id="l51.22">         );</span>
<a href="#l51.23"></a><span id="l51.23">         cardArray.appendElement(card);</span>
<a href="#l51.24"></a><span id="l51.24">         ab.deleteCards(cardArray);</span>
<a href="#l51.25"></a><span id="l51.25" class="difflineat">@@ -93,21 +90,19 @@ function ensure_no_card_exists(emailAddr</span>
<a href="#l51.26"></a><span id="l51.26">   }</span>
<a href="#l51.27"></a><span id="l51.27"> }</span>
<a href="#l51.28"></a><span id="l51.28"> </span>
<a href="#l51.29"></a><span id="l51.29"> /**</span>
<a href="#l51.30"></a><span id="l51.30">  * Return all address book cards for a particular email address</span>
<a href="#l51.31"></a><span id="l51.31">  * @param aEmailAddress the address to search for</span>
<a href="#l51.32"></a><span id="l51.32">  */</span>
<a href="#l51.33"></a><span id="l51.33"> function get_cards_in_all_address_books_for_email(aEmailAddress) {</span>
<a href="#l51.34"></a><span id="l51.34" class="difflineminus">-  var books = MailServices.ab.directories;</span>
<a href="#l51.35"></a><span id="l51.35">   var result = [];</span>
<a href="#l51.36"></a><span id="l51.36"> </span>
<a href="#l51.37"></a><span id="l51.37" class="difflineminus">-  while (books.hasMoreElements()) {</span>
<a href="#l51.38"></a><span id="l51.38" class="difflineminus">-    var ab = books.getNext().QueryInterface(Ci.nsIAbDirectory);</span>
<a href="#l51.39"></a><span id="l51.39" class="difflineplus">+  for (let ab of MailServices.ab.directories) {</span>
<a href="#l51.40"></a><span id="l51.40">     var card = ab.cardForEmailAddress(aEmailAddress);</span>
<a href="#l51.41"></a><span id="l51.41">     if (card) {</span>
<a href="#l51.42"></a><span id="l51.42">       result.push(card);</span>
<a href="#l51.43"></a><span id="l51.43">     }</span>
<a href="#l51.44"></a><span id="l51.44">   }</span>
<a href="#l51.45"></a><span id="l51.45"> </span>
<a href="#l51.46"></a><span id="l51.46">   return result;</span>
<a href="#l51.47"></a><span id="l51.47"> }</span>
<a href="#l51.48"></a><span id="l51.48" class="difflineat">@@ -199,19 +194,17 @@ function create_mailing_list(aMailingLis</span>
<a href="#l51.49"></a><span id="l51.49"> }</span>
<a href="#l51.50"></a><span id="l51.50"> </span>
<a href="#l51.51"></a><span id="l51.51"> /* Finds and returns a mailing list with a given dirName within a</span>
<a href="#l51.52"></a><span id="l51.52">  * given address book.</span>
<a href="#l51.53"></a><span id="l51.53">  * @param aAddressBook the address book to search</span>
<a href="#l51.54"></a><span id="l51.54">  * @param aDirName the dirName of the mailing list</span>
<a href="#l51.55"></a><span id="l51.55">  */</span>
<a href="#l51.56"></a><span id="l51.56"> function get_mailing_list_from_address_book(aAddressBook, aDirName) {</span>
<a href="#l51.57"></a><span id="l51.57" class="difflineminus">-  let mailingLists = aAddressBook.childNodes;</span>
<a href="#l51.58"></a><span id="l51.58" class="difflineminus">-  while (mailingLists.hasMoreElements()) {</span>
<a href="#l51.59"></a><span id="l51.59" class="difflineminus">-    let item = mailingLists.getNext();</span>
<a href="#l51.60"></a><span id="l51.60" class="difflineplus">+  for (let item of aAddressBook.childNodes) {</span>
<a href="#l51.61"></a><span id="l51.61">     let list = item.QueryInterface(Ci.nsIAbDirectory);</span>
<a href="#l51.62"></a><span id="l51.62">     if (list &amp;&amp; list.dirName == aDirName) {</span>
<a href="#l51.63"></a><span id="l51.63">       return list;</span>
<a href="#l51.64"></a><span id="l51.64">     }</span>
<a href="#l51.65"></a><span id="l51.65">   }</span>
<a href="#l51.66"></a><span id="l51.66">   throw Error(&quot;Could not find a mailing list with dirName &quot; + aDirName);</span>
<a href="#l51.67"></a><span id="l51.67"> }</span>
<a href="#l51.68"></a><span id="l51.68"> </span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l52.1"></a><span id="l52.1" class="difflineminus">--- a/mail/test/browser/shared-modules/WindowHelpers.jsm</span>
<a href="#l52.2"></a><span id="l52.2" class="difflineplus">+++ b/mail/test/browser/shared-modules/WindowHelpers.jsm</span>
<a href="#l52.3"></a><span id="l52.3" class="difflineat">@@ -1918,21 +1918,18 @@ function screenshotToDataURL(aWindow) {</span>
<a href="#l52.4"></a><span id="l52.4">  * - Is the window active/focused?</span>
<a href="#l52.5"></a><span id="l52.5">  * - The focused element in the window; we leave this up to logHelper to</span>
<a href="#l52.6"></a><span id="l52.6">  *    describe.</span>
<a href="#l52.7"></a><span id="l52.7">  */</span>
<a href="#l52.8"></a><span id="l52.8"> function captureWindowStatesForErrorReporting(normalizeForJsonFunc) {</span>
<a href="#l52.9"></a><span id="l52.9">   let info = {};</span>
<a href="#l52.10"></a><span id="l52.10">   let windows = (info.windows = []);</span>
<a href="#l52.11"></a><span id="l52.11"> </span>
<a href="#l52.12"></a><span id="l52.12" class="difflineminus">-  let enumerator = Services.wm.getEnumerator(null);</span>
<a href="#l52.13"></a><span id="l52.13">   let iWin = 0;</span>
<a href="#l52.14"></a><span id="l52.14" class="difflineminus">-  while (enumerator.hasMoreElements()) {</span>
<a href="#l52.15"></a><span id="l52.15" class="difflineminus">-    let win = enumerator.getNext();</span>
<a href="#l52.16"></a><span id="l52.16" class="difflineminus">-</span>
<a href="#l52.17"></a><span id="l52.17" class="difflineplus">+  for (let win of Services.wm.getEnumerator(null)) {</span>
<a href="#l52.18"></a><span id="l52.18">     let winId =</span>
<a href="#l52.19"></a><span id="l52.19">       getWindowTypeOrId(win.document.documentElement) || &quot;unnamed:&quot; + iWin;</span>
<a href="#l52.20"></a><span id="l52.20"> </span>
<a href="#l52.21"></a><span id="l52.21">     let openPopups = Array.from(</span>
<a href="#l52.22"></a><span id="l52.22">       win.document.documentElement.getElementsByTagName(&quot;menupopup&quot;)</span>
<a href="#l52.23"></a><span id="l52.23">     )</span>
<a href="#l52.24"></a><span id="l52.24">       .filter(x =&gt; x.state != &quot;closed&quot;)</span>
<a href="#l52.25"></a><span id="l52.25">       .map(x =&gt; normalizeForJsonFunc(x));</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l53.1"></a><span id="l53.1" class="difflineminus">--- a/mail/test/browser/shared-modules/httpd.jsm</span>
<a href="#l53.2"></a><span id="l53.2" class="difflineplus">+++ b/mail/test/browser/shared-modules/httpd.jsm</span>
<a href="#l53.3"></a><span id="l53.3" class="difflineat">@@ -1899,19 +1899,17 @@ function defaultIndexHandler(metadata, r</span>
<a href="#l53.4"></a><span id="l53.4">                 &lt;body&gt;</span>
<a href="#l53.5"></a><span id="l53.5">                   &lt;h1&gt;${path}&lt;/h1&gt;</span>
<a href="#l53.6"></a><span id="l53.6">                   &lt;ol style=&quot;list-style-type: none&quot;&gt;`;</span>
<a href="#l53.7"></a><span id="l53.7"> </span>
<a href="#l53.8"></a><span id="l53.8">   var directory = metadata.getProperty(&quot;directory&quot;);</span>
<a href="#l53.9"></a><span id="l53.9">   NS_ASSERT(directory &amp;&amp; directory.isDirectory());</span>
<a href="#l53.10"></a><span id="l53.10"> </span>
<a href="#l53.11"></a><span id="l53.11">   var fileList = [];</span>
<a href="#l53.12"></a><span id="l53.12" class="difflineminus">-  var files = directory.directoryEntries;</span>
<a href="#l53.13"></a><span id="l53.13" class="difflineminus">-  while (files.hasMoreElements()) {</span>
<a href="#l53.14"></a><span id="l53.14" class="difflineminus">-    var f = files.nextFile;</span>
<a href="#l53.15"></a><span id="l53.15" class="difflineplus">+  for (let f of directory.directoryEntries) {</span>
<a href="#l53.16"></a><span id="l53.16">     var name = f.leafName;</span>
<a href="#l53.17"></a><span id="l53.17">     if (</span>
<a href="#l53.18"></a><span id="l53.18">       !f.isHidden() &amp;&amp;</span>
<a href="#l53.19"></a><span id="l53.19">       (name.charAt(name.length - 1) != HIDDEN_CHAR ||</span>
<a href="#l53.20"></a><span id="l53.20">         name.charAt(name.length - 2) == HIDDEN_CHAR)</span>
<a href="#l53.21"></a><span id="l53.21">     ) {</span>
<a href="#l53.22"></a><span id="l53.22">       fileList.push(f);</span>
<a href="#l53.23"></a><span id="l53.23">     }</span>
<a href="#l53.24"></a><span id="l53.24" class="difflineat">@@ -3229,20 +3227,18 @@ ServerHandler.prototype = {</span>
<a href="#l53.25"></a><span id="l53.25">       body += metadata.method + &quot; &quot; + metadata.path;</span>
<a href="#l53.26"></a><span id="l53.26"> </span>
<a href="#l53.27"></a><span id="l53.27">       if (metadata.queryString) {</span>
<a href="#l53.28"></a><span id="l53.28">         body += &quot;?&quot; + metadata.queryString;</span>
<a href="#l53.29"></a><span id="l53.29">       }</span>
<a href="#l53.30"></a><span id="l53.30"> </span>
<a href="#l53.31"></a><span id="l53.31">       body += &quot; HTTP/&quot; + metadata.httpVersion + &quot;\r\n&quot;;</span>
<a href="#l53.32"></a><span id="l53.32"> </span>
<a href="#l53.33"></a><span id="l53.33" class="difflineminus">-      var headEnum = metadata.headers;</span>
<a href="#l53.34"></a><span id="l53.34" class="difflineminus">-      while (headEnum.hasMoreElements()) {</span>
<a href="#l53.35"></a><span id="l53.35" class="difflineminus">-        var fieldName = headEnum.getNext().QueryInterface(Ci.nsISupportsString)</span>
<a href="#l53.36"></a><span id="l53.36" class="difflineminus">-          .data;</span>
<a href="#l53.37"></a><span id="l53.37" class="difflineplus">+      for (let field of metadata.headers) {</span>
<a href="#l53.38"></a><span id="l53.38" class="difflineplus">+        var fieldName = field.data;</span>
<a href="#l53.39"></a><span id="l53.39">         body += fieldName + &quot;: &quot; + metadata.getHeader(fieldName) + &quot;\r\n&quot;;</span>
<a href="#l53.40"></a><span id="l53.40">       }</span>
<a href="#l53.41"></a><span id="l53.41"> </span>
<a href="#l53.42"></a><span id="l53.42">       response.bodyOutputStream.write(body, body.length);</span>
<a href="#l53.43"></a><span id="l53.43">     },</span>
<a href="#l53.44"></a><span id="l53.44">   },</span>
<a href="#l53.45"></a><span id="l53.45"> };</span>
<a href="#l53.46"></a><span id="l53.46"> </span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l54.1"></a><span id="l54.1" class="difflineminus">--- a/mail/test/browser/shared-modules/init.jsm</span>
<a href="#l54.2"></a><span id="l54.2" class="difflineplus">+++ b/mail/test/browser/shared-modules/init.jsm</span>
<a href="#l54.3"></a><span id="l54.3" class="difflineat">@@ -133,19 +133,17 @@ function attachEventListeners(aWindow) {</span>
<a href="#l54.4"></a><span id="l54.4">  * Initialize Mozmill</span>
<a href="#l54.5"></a><span id="l54.5">  */</span>
<a href="#l54.6"></a><span id="l54.6"> function initialize() {</span>
<a href="#l54.7"></a><span id="l54.7">   // Activate observer for new top level windows</span>
<a href="#l54.8"></a><span id="l54.8">   Services.obs.addObserver(windowReadyObserver, &quot;toplevel-window-ready&quot;);</span>
<a href="#l54.9"></a><span id="l54.9">   Services.obs.addObserver(windowCloseObserver, &quot;outer-window-destroyed&quot;);</span>
<a href="#l54.10"></a><span id="l54.10"> </span>
<a href="#l54.11"></a><span id="l54.11">   // Attach event listeners to all open windows</span>
<a href="#l54.12"></a><span id="l54.12" class="difflineminus">-  var enumerator = Services.wm.getEnumerator(&quot;&quot;);</span>
<a href="#l54.13"></a><span id="l54.13" class="difflineminus">-  while (enumerator.hasMoreElements()) {</span>
<a href="#l54.14"></a><span id="l54.14" class="difflineminus">-    var win = enumerator.getNext();</span>
<a href="#l54.15"></a><span id="l54.15" class="difflineplus">+  for (let win of Services.wm.getEnumerator(&quot;&quot;)) {</span>
<a href="#l54.16"></a><span id="l54.16">     attachEventListeners(win);</span>
<a href="#l54.17"></a><span id="l54.17"> </span>
<a href="#l54.18"></a><span id="l54.18">     // For windows or dialogs already open we have to explicitly set the property</span>
<a href="#l54.19"></a><span id="l54.19">     // otherwise windows which load really quick on startup never gets the</span>
<a href="#l54.20"></a><span id="l54.20">     // property set and we fail to create the controller</span>
<a href="#l54.21"></a><span id="l54.21">     controller.windowMap.update(utils.getWindowId(win), &quot;loaded&quot;, true);</span>
<a href="#l54.22"></a><span id="l54.22">   }</span>
<a href="#l54.23"></a><span id="l54.23"> }</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l55.1"></a><span id="l55.1" class="difflineminus">--- a/mail/test/browser/shared-modules/os.jsm</span>
<a href="#l55.2"></a><span id="l55.2" class="difflineplus">+++ b/mail/test/browser/shared-modules/os.jsm</span>
<a href="#l55.3"></a><span id="l55.3" class="difflineat">@@ -41,23 +41,17 @@ var EXPORTED_SYMBOLS = [</span>
<a href="#l55.4"></a><span id="l55.4">   &quot;abspath&quot;,</span>
<a href="#l55.5"></a><span id="l55.5">   &quot;getPlatform&quot;,</span>
<a href="#l55.6"></a><span id="l55.6"> ];</span>
<a href="#l55.7"></a><span id="l55.7"> </span>
<a href="#l55.8"></a><span id="l55.8"> const { Services } = ChromeUtils.import(&quot;resource://gre/modules/Services.jsm&quot;);</span>
<a href="#l55.9"></a><span id="l55.9"> </span>
<a href="#l55.10"></a><span id="l55.10"> function listDirectory(file) {</span>
<a href="#l55.11"></a><span id="l55.11">   // file is the given directory (nsIFile)</span>
<a href="#l55.12"></a><span id="l55.12" class="difflineminus">-  var entries = file.directoryEntries;</span>
<a href="#l55.13"></a><span id="l55.13" class="difflineminus">-  var array = [];</span>
<a href="#l55.14"></a><span id="l55.14" class="difflineminus">-  while (entries.hasMoreElements()) {</span>
<a href="#l55.15"></a><span id="l55.15" class="difflineminus">-    let entry = entries.nextFile;</span>
<a href="#l55.16"></a><span id="l55.16" class="difflineminus">-    array.push(entry);</span>
<a href="#l55.17"></a><span id="l55.17" class="difflineminus">-  }</span>
<a href="#l55.18"></a><span id="l55.18" class="difflineminus">-  return array;</span>
<a href="#l55.19"></a><span id="l55.19" class="difflineplus">+  return [...file.directoryEntries];</span>
<a href="#l55.20"></a><span id="l55.20"> }</span>
<a href="#l55.21"></a><span id="l55.21"> </span>
<a href="#l55.22"></a><span id="l55.22"> function getFileForPath(path) {</span>
<a href="#l55.23"></a><span id="l55.23">   var file = Cc[&quot;@mozilla.org/file/local;1&quot;].createInstance(Ci.nsIFile);</span>
<a href="#l55.24"></a><span id="l55.24">   file.initWithPath(path);</span>
<a href="#l55.25"></a><span id="l55.25">   return file;</span>
<a href="#l55.26"></a><span id="l55.26"> }</span>
<a href="#l55.27"></a><span id="l55.27"> </span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l56.1"></a><span id="l56.1" class="difflineminus">--- a/mail/test/browser/shared-modules/utils.jsm</span>
<a href="#l56.2"></a><span id="l56.2" class="difflineplus">+++ b/mail/test/browser/shared-modules/utils.jsm</span>
<a href="#l56.3"></a><span id="l56.3" class="difflineat">@@ -78,21 +78,17 @@ function Copy(obj) {</span>
<a href="#l56.4"></a><span id="l56.4"> function getChromeWindow(aWindow) {</span>
<a href="#l56.5"></a><span id="l56.5">   return aWindow.docShell.rootTreeItem.domWindow;</span>
<a href="#l56.6"></a><span id="l56.6"> }</span>
<a href="#l56.7"></a><span id="l56.7"> </span>
<a href="#l56.8"></a><span id="l56.8"> function getWindows(type) {</span>
<a href="#l56.9"></a><span id="l56.9">   if (type == undefined) {</span>
<a href="#l56.10"></a><span id="l56.10">     type = &quot;&quot;;</span>
<a href="#l56.11"></a><span id="l56.11">   }</span>
<a href="#l56.12"></a><span id="l56.12" class="difflineminus">-  var windows = [];</span>
<a href="#l56.13"></a><span id="l56.13" class="difflineminus">-  var enumerator = Services.wm.getEnumerator(type);</span>
<a href="#l56.14"></a><span id="l56.14" class="difflineminus">-  while (enumerator.hasMoreElements()) {</span>
<a href="#l56.15"></a><span id="l56.15" class="difflineminus">-    windows.push(enumerator.getNext());</span>
<a href="#l56.16"></a><span id="l56.16" class="difflineminus">-  }</span>
<a href="#l56.17"></a><span id="l56.17" class="difflineplus">+  let windows = [...Services.wm.getEnumerator(type)];</span>
<a href="#l56.18"></a><span id="l56.18">   if (type == &quot;&quot;) {</span>
<a href="#l56.19"></a><span id="l56.19">     windows.push(hwindow);</span>
<a href="#l56.20"></a><span id="l56.20">   }</span>
<a href="#l56.21"></a><span id="l56.21">   return windows;</span>
<a href="#l56.22"></a><span id="l56.22"> }</span>
<a href="#l56.23"></a><span id="l56.23"> </span>
<a href="#l56.24"></a><span id="l56.24"> function getMethodInWindows(methodName) {</span>
<a href="#l56.25"></a><span id="l56.25">   for (var w of getWindows()) {</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l57.1"></a><span id="l57.1" class="difflineminus">--- a/mail/test/browser/tabmail/browser_dragndrop.js</span>
<a href="#l57.2"></a><span id="l57.2" class="difflineplus">+++ b/mail/test/browser/tabmail/browser_dragndrop.js</span>
<a href="#l57.3"></a><span id="l57.3" class="difflineat">@@ -483,20 +483,17 @@ add_task(function test_tab_recentlyClose</span>
<a href="#l57.4"></a><span id="l57.4">   // only 10 items we have to endup with exactly 10 + 2 tabs.</span>
<a href="#l57.5"></a><span id="l57.5">   assert_number_of_tabs_open(12);</span>
<a href="#l57.6"></a><span id="l57.6">   teardownTest();</span>
<a href="#l57.7"></a><span id="l57.7"> });</span>
<a href="#l57.8"></a><span id="l57.8"> </span>
<a href="#l57.9"></a><span id="l57.9"> function teardownTest(test) {</span>
<a href="#l57.10"></a><span id="l57.10">   // Some test cases open new windows, thus we need to ensure all</span>
<a href="#l57.11"></a><span id="l57.11">   // opened windows get closed.</span>
<a href="#l57.12"></a><span id="l57.12" class="difflineminus">-  let en = Services.wm.getEnumerator(&quot;mail:3pane&quot;);</span>
<a href="#l57.13"></a><span id="l57.13" class="difflineminus">-  while (en.hasMoreElements()) {</span>
<a href="#l57.14"></a><span id="l57.14" class="difflineminus">-    var win = en.getNext();</span>
<a href="#l57.15"></a><span id="l57.15" class="difflineminus">-</span>
<a href="#l57.16"></a><span id="l57.16" class="difflineplus">+  for (let win of Services.wm.getEnumerator(&quot;mail:3pane&quot;)) {</span>
<a href="#l57.17"></a><span id="l57.17">     if (win != mc.window) {</span>
<a href="#l57.18"></a><span id="l57.18">       win.close();</span>
<a href="#l57.19"></a><span id="l57.19">     }</span>
<a href="#l57.20"></a><span id="l57.20">   }</span>
<a href="#l57.21"></a><span id="l57.21"> </span>
<a href="#l57.22"></a><span id="l57.22">   // clean up the tabbbar</span>
<a href="#l57.23"></a><span id="l57.23">   mc.tabmail.closeOtherTabs(0);</span>
<a href="#l57.24"></a><span id="l57.24">   assert_number_of_tabs_open(1);</span></pre></div></div>

<div class="page_footer">
<div class="page_footer_text">comm-central</div>
<div class="page_footer_text" style="padding-left: 10px">Deployed from <a href="https://hg.mozilla.org/hgcustom/version-control-tools/rev/4b0de666d1a4">4b0de666d1a4</a> at 2020-07-30T19:32:31Z.</div>
<div class="rss_logo">
<a href="/comm-central/rss-log">RSS</a>
<a href="/comm-central/atom-log">Atom</a>
</div>
<br />

</div>
</body>
</html>

