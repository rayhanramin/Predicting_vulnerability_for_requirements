<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en-US" lang="en-US">
<head>
<link rel="icon" href="/static/4b0de666d1a4/hgicon.png" type="image/png" />
<meta name="robots" content="index, nofollow"/>
<link rel="stylesheet" href="/static/4b0de666d1a4/style-gitweb.css" type="text/css" />

<style type="text/css">
div.feed {
  float: right;
}
a img {
  border-width: 0px;
}
div.log_link {
  width: 80px;
  background-color: white;
}

div.log_body {
  padding-left: 96px;
}
</style>
<script type="text/javascript" src="/static/4b0de666d1a4/mercurial.js"></script>

<meta property="og:image" content="/static/4b0de666d1a4/moz-logo-bw-rgb.svg"/>
<meta property="og:type" content="website"/>

<title>comm-central: changeset 29588:39a884a7b19acd946dedf75a441f0d14631053eb</title>
<link rel="alternate" type="application/atom+xml"
   href="/comm-central/atom-log" title="Atom feed for comm-central"/>
<link rel="alternate" type="application/rss+xml"
   href="/comm-central/rss-log" title="RSS feed for comm-central"/>

<meta property="og:title" content="comm-central @ 39a884a7b19acd946dedf75a441f0d14631053eb" />
<meta property="og:url" content="/comm-central/rev/39a884a7b19acd946dedf75a441f0d14631053eb" />
<meta property="og:description" content="Bug 1634912 - de-xpcom calendar datetime formatter. r=pmorris" />

</head>
<body>

<div class="page_header">
<div class="logo">
    <a href="https://developer.mozilla.org/en/docs/Mercurial">
        <img src="/static/4b0de666d1a4/moz-logo-bw-rgb.svg" alt="mercurial" />
    </a>
</div>
<a href="/">Mercurial</a> &gt; <a href="/comm-central">comm-central</a>  / changeset / 39a884a7b19acd946dedf75a441f0d14631053eb 
</div>

<div class="page_nav">
<div>
<a href="/comm-central/summary">summary</a> |
<a href="/comm-central/shortlog/39a884a7b19acd946dedf75a441f0d14631053eb">shortlog</a> |
<a href="/comm-central/log/39a884a7b19acd946dedf75a441f0d14631053eb">changelog</a> |
<a href="/comm-central/pushloghtml">pushlog</a> |
<a href="/comm-central/graph/39a884a7b19acd946dedf75a441f0d14631053eb">graph</a> |
<a href="/comm-central/tags">tags</a> |
<a href="/comm-central/bookmarks">bookmarks</a> |
<a href="/comm-central/branches">branches</a> |
<a href="/comm-central/file/39a884a7b19acd946dedf75a441f0d14631053eb">files</a> |
changeset |
<a href="/comm-central/raw-rev/39a884a7b19acd946dedf75a441f0d14631053eb">raw</a>  | <a href="/comm-central/archive/39a884a7b19acd946dedf75a441f0d14631053eb.zip">zip</a>  |
<a href="/comm-central/help">help</a>
</div>

<div class="search">
<form id="searchform" action="/comm-central/log">

<input name="rev" type="text" value="" size="40" />
<div id="hint">Find changesets by keywords (author, files, the commit message), revision
number or hash, or <a href="/comm-central/help/revsets">revset expression</a>.</div>
</form>
</div>
</div>

<div class="title">
<a href="https://bugzilla.mozilla.org/show_bug.cgi?id=1634912">Bug 1634912</a> - de-xpcom calendar datetime formatter. r=pmorris
<span class="logtags"></span>
</div>
<div class="title_text">
<table cellspacing="0">

<tr><td>author</td><td>&#80;&#104;&#105;&#108;&#105;&#112;&#112;&#32;&#75;&#101;&#119;&#105;&#115;&#99;&#104;&#32;&#60;&#109;&#111;&#122;&#105;&#108;&#108;&#97;&#64;&#107;&#101;&#119;&#105;&#115;&#46;&#99;&#104;&#62;</td></tr>
<tr><td></td><td class="date age">Sat, 16 May 2020 14:17:45 +0300</td></tr>

<tr>
 <td>changeset 29588</td>
 <td style="font-family:monospace"><a class="list" href="/comm-central/rev/39a884a7b19acd946dedf75a441f0d14631053eb">39a884a7b19acd946dedf75a441f0d14631053eb</a></td>
</tr>



<tr>
<td>parent 29587</td>
<td style="font-family:monospace">
<a class="list" href="/comm-central/rev/7ba221cc0eb4896093aae8b19ab560f92e92e67d">7ba221cc0eb4896093aae8b19ab560f92e92e67d</a>
</td>
</tr>

<tr>
<td>child 29589</td>
<td style="font-family:monospace">
<a class="list" href="/comm-central/rev/94c8faf148df4c428cb3d25fb37fe9d24d63b9dc">94c8faf148df4c428cb3d25fb37fe9d24d63b9dc</a>
</td>
</tr>
<tr><td>push id</td><td><a href="/comm-central/pushloghtml?changeset=39a884a7b19acd946dedf75a441f0d14631053eb">17445</a></td></tr>
<tr><td>push user</td><td>mkmelin@iki.fi</td></tr>
<tr><td>push date</td><td class="date age">Sat, 16 May 2020 11:20:00 +0000</td></tr>

<tr><td>treeherder</td><td>comm-central@39a884a7b19a [<a href="https://treeherder.mozilla.org/#/jobs?repo=comm-central&revision=39a884a7b19acd946dedf75a441f0d14631053eb">default view</a>] [<a href="https://treeherder.mozilla.org/#/jobs?repo=comm-central&revision=39a884a7b19acd946dedf75a441f0d14631053eb&filter-resultStatus=testfailed&filter-resultStatus=busted&filter-resultStatus=exception">failures only]</td></tr>
<tr><td>perfherder</td><td>[<a href="https://treeherder.mozilla.org/perf.html#/compare?originalProject=comm-central&originalRevision=39a884a7b19acd946dedf75a441f0d14631053eb&newProject=comm-central&newRevision=7ba221cc0eb4896093aae8b19ab560f92e92e67d&framework=1" target="_blank">talos</a>] [<a href="https://treeherder.mozilla.org/perf.html#/compare?originalProject=comm-central&originalRevision=39a884a7b19acd946dedf75a441f0d14631053eb&newProject=comm-central&newRevision=7ba221cc0eb4896093aae8b19ab560f92e92e67d&framework=2" target="_blank">build metrics</a>] [<a href="https://treeherder.mozilla.org/perf.html#/compare?originalProject=comm-central&originalRevision=39a884a7b19acd946dedf75a441f0d14631053eb&newProject=comm-central&newRevision=7ba221cc0eb4896093aae8b19ab560f92e92e67d&framework=6" target="_blank">platform microbench</a>] (compared to previous push)</td></tr>
<tr><td>reviewers</td><td><a href="/comm-central/log?rev=reviewer%28pmorris%29&revcount=50">pmorris</a></td></tr>
<tr><td>bugs</td><td><a href="https://bugzilla.mozilla.org/show_bug.cgi?id=1634912">1634912</a></td></tr>




</table></div>

<div class="page_body description"><a href="https://bugzilla.mozilla.org/show_bug.cgi?id=1634912">Bug 1634912</a> - de-xpcom calendar datetime formatter. r=pmorris

Differential Revision: <a href="https://phabricator.services.mozilla.com/D73560">https://phabricator.services.mozilla.com/D73560</a></div>
<div class="list_head"></div>
<div class="title_text">
<table cellspacing="0">

<tr class="parity0">
<td><a class="list" href="/comm-central/diff/39a884a7b19acd946dedf75a441f0d14631053eb/calendar/base/content/agenda-listbox.js">calendar/base/content/agenda-listbox.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/39a884a7b19acd946dedf75a441f0d14631053eb/calendar/base/content/agenda-listbox.js">file</a> |
<a href="/comm-central/annotate/39a884a7b19acd946dedf75a441f0d14631053eb/calendar/base/content/agenda-listbox.js">annotate</a> |
<a href="/comm-central/diff/39a884a7b19acd946dedf75a441f0d14631053eb/calendar/base/content/agenda-listbox.js">diff</a> |
<a href="/comm-central/comparison/39a884a7b19acd946dedf75a441f0d14631053eb/calendar/base/content/agenda-listbox.js">comparison</a> |
<a href="/comm-central/log/39a884a7b19acd946dedf75a441f0d14631053eb/calendar/base/content/agenda-listbox.js">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/39a884a7b19acd946dedf75a441f0d14631053eb/calendar/base/content/calendar-base-view.js">calendar/base/content/calendar-base-view.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/39a884a7b19acd946dedf75a441f0d14631053eb/calendar/base/content/calendar-base-view.js">file</a> |
<a href="/comm-central/annotate/39a884a7b19acd946dedf75a441f0d14631053eb/calendar/base/content/calendar-base-view.js">annotate</a> |
<a href="/comm-central/diff/39a884a7b19acd946dedf75a441f0d14631053eb/calendar/base/content/calendar-base-view.js">diff</a> |
<a href="/comm-central/comparison/39a884a7b19acd946dedf75a441f0d14631053eb/calendar/base/content/calendar-base-view.js">comparison</a> |
<a href="/comm-central/log/39a884a7b19acd946dedf75a441f0d14631053eb/calendar/base/content/calendar-base-view.js">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/39a884a7b19acd946dedf75a441f0d14631053eb/calendar/base/content/calendar-day-label.js">calendar/base/content/calendar-day-label.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/39a884a7b19acd946dedf75a441f0d14631053eb/calendar/base/content/calendar-day-label.js">file</a> |
<a href="/comm-central/annotate/39a884a7b19acd946dedf75a441f0d14631053eb/calendar/base/content/calendar-day-label.js">annotate</a> |
<a href="/comm-central/diff/39a884a7b19acd946dedf75a441f0d14631053eb/calendar/base/content/calendar-day-label.js">diff</a> |
<a href="/comm-central/comparison/39a884a7b19acd946dedf75a441f0d14631053eb/calendar/base/content/calendar-day-label.js">comparison</a> |
<a href="/comm-central/log/39a884a7b19acd946dedf75a441f0d14631053eb/calendar/base/content/calendar-day-label.js">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/39a884a7b19acd946dedf75a441f0d14631053eb/calendar/base/content/calendar-event-column.js">calendar/base/content/calendar-event-column.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/39a884a7b19acd946dedf75a441f0d14631053eb/calendar/base/content/calendar-event-column.js">file</a> |
<a href="/comm-central/annotate/39a884a7b19acd946dedf75a441f0d14631053eb/calendar/base/content/calendar-event-column.js">annotate</a> |
<a href="/comm-central/diff/39a884a7b19acd946dedf75a441f0d14631053eb/calendar/base/content/calendar-event-column.js">diff</a> |
<a href="/comm-central/comparison/39a884a7b19acd946dedf75a441f0d14631053eb/calendar/base/content/calendar-event-column.js">comparison</a> |
<a href="/comm-central/log/39a884a7b19acd946dedf75a441f0d14631053eb/calendar/base/content/calendar-event-column.js">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/39a884a7b19acd946dedf75a441f0d14631053eb/calendar/base/content/calendar-item-bindings.js">calendar/base/content/calendar-item-bindings.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/39a884a7b19acd946dedf75a441f0d14631053eb/calendar/base/content/calendar-item-bindings.js">file</a> |
<a href="/comm-central/annotate/39a884a7b19acd946dedf75a441f0d14631053eb/calendar/base/content/calendar-item-bindings.js">annotate</a> |
<a href="/comm-central/diff/39a884a7b19acd946dedf75a441f0d14631053eb/calendar/base/content/calendar-item-bindings.js">diff</a> |
<a href="/comm-central/comparison/39a884a7b19acd946dedf75a441f0d14631053eb/calendar/base/content/calendar-item-bindings.js">comparison</a> |
<a href="/comm-central/log/39a884a7b19acd946dedf75a441f0d14631053eb/calendar/base/content/calendar-item-bindings.js">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/39a884a7b19acd946dedf75a441f0d14631053eb/calendar/base/content/calendar-month-view.js">calendar/base/content/calendar-month-view.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/39a884a7b19acd946dedf75a441f0d14631053eb/calendar/base/content/calendar-month-view.js">file</a> |
<a href="/comm-central/annotate/39a884a7b19acd946dedf75a441f0d14631053eb/calendar/base/content/calendar-month-view.js">annotate</a> |
<a href="/comm-central/diff/39a884a7b19acd946dedf75a441f0d14631053eb/calendar/base/content/calendar-month-view.js">diff</a> |
<a href="/comm-central/comparison/39a884a7b19acd946dedf75a441f0d14631053eb/calendar/base/content/calendar-month-view.js">comparison</a> |
<a href="/comm-central/log/39a884a7b19acd946dedf75a441f0d14631053eb/calendar/base/content/calendar-month-view.js">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/39a884a7b19acd946dedf75a441f0d14631053eb/calendar/base/content/calendar-multiday-base-view.js">calendar/base/content/calendar-multiday-base-view.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/39a884a7b19acd946dedf75a441f0d14631053eb/calendar/base/content/calendar-multiday-base-view.js">file</a> |
<a href="/comm-central/annotate/39a884a7b19acd946dedf75a441f0d14631053eb/calendar/base/content/calendar-multiday-base-view.js">annotate</a> |
<a href="/comm-central/diff/39a884a7b19acd946dedf75a441f0d14631053eb/calendar/base/content/calendar-multiday-base-view.js">diff</a> |
<a href="/comm-central/comparison/39a884a7b19acd946dedf75a441f0d14631053eb/calendar/base/content/calendar-multiday-base-view.js">comparison</a> |
<a href="/comm-central/log/39a884a7b19acd946dedf75a441f0d14631053eb/calendar/base/content/calendar-multiday-base-view.js">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/39a884a7b19acd946dedf75a441f0d14631053eb/calendar/base/content/calendar-task-tree-view.js">calendar/base/content/calendar-task-tree-view.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/39a884a7b19acd946dedf75a441f0d14631053eb/calendar/base/content/calendar-task-tree-view.js">file</a> |
<a href="/comm-central/annotate/39a884a7b19acd946dedf75a441f0d14631053eb/calendar/base/content/calendar-task-tree-view.js">annotate</a> |
<a href="/comm-central/diff/39a884a7b19acd946dedf75a441f0d14631053eb/calendar/base/content/calendar-task-tree-view.js">diff</a> |
<a href="/comm-central/comparison/39a884a7b19acd946dedf75a441f0d14631053eb/calendar/base/content/calendar-task-tree-view.js">comparison</a> |
<a href="/comm-central/log/39a884a7b19acd946dedf75a441f0d14631053eb/calendar/base/content/calendar-task-tree-view.js">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/39a884a7b19acd946dedf75a441f0d14631053eb/calendar/base/content/calendar-task-view.js">calendar/base/content/calendar-task-view.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/39a884a7b19acd946dedf75a441f0d14631053eb/calendar/base/content/calendar-task-view.js">file</a> |
<a href="/comm-central/annotate/39a884a7b19acd946dedf75a441f0d14631053eb/calendar/base/content/calendar-task-view.js">annotate</a> |
<a href="/comm-central/diff/39a884a7b19acd946dedf75a441f0d14631053eb/calendar/base/content/calendar-task-view.js">diff</a> |
<a href="/comm-central/comparison/39a884a7b19acd946dedf75a441f0d14631053eb/calendar/base/content/calendar-task-view.js">comparison</a> |
<a href="/comm-central/log/39a884a7b19acd946dedf75a441f0d14631053eb/calendar/base/content/calendar-task-view.js">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/39a884a7b19acd946dedf75a441f0d14631053eb/calendar/base/content/calendar-unifinder.js">calendar/base/content/calendar-unifinder.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/39a884a7b19acd946dedf75a441f0d14631053eb/calendar/base/content/calendar-unifinder.js">file</a> |
<a href="/comm-central/annotate/39a884a7b19acd946dedf75a441f0d14631053eb/calendar/base/content/calendar-unifinder.js">annotate</a> |
<a href="/comm-central/diff/39a884a7b19acd946dedf75a441f0d14631053eb/calendar/base/content/calendar-unifinder.js">diff</a> |
<a href="/comm-central/comparison/39a884a7b19acd946dedf75a441f0d14631053eb/calendar/base/content/calendar-unifinder.js">comparison</a> |
<a href="/comm-central/log/39a884a7b19acd946dedf75a441f0d14631053eb/calendar/base/content/calendar-unifinder.js">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/39a884a7b19acd946dedf75a441f0d14631053eb/calendar/base/content/calendar-views-utils.js">calendar/base/content/calendar-views-utils.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/39a884a7b19acd946dedf75a441f0d14631053eb/calendar/base/content/calendar-views-utils.js">file</a> |
<a href="/comm-central/annotate/39a884a7b19acd946dedf75a441f0d14631053eb/calendar/base/content/calendar-views-utils.js">annotate</a> |
<a href="/comm-central/diff/39a884a7b19acd946dedf75a441f0d14631053eb/calendar/base/content/calendar-views-utils.js">diff</a> |
<a href="/comm-central/comparison/39a884a7b19acd946dedf75a441f0d14631053eb/calendar/base/content/calendar-views-utils.js">comparison</a> |
<a href="/comm-central/log/39a884a7b19acd946dedf75a441f0d14631053eb/calendar/base/content/calendar-views-utils.js">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/39a884a7b19acd946dedf75a441f0d14631053eb/calendar/base/content/dialogs/calendar-event-dialog-attendees-custom-elements.js">calendar/base/content/dialogs/calendar-event-dialog-attendees-custom-elements.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/39a884a7b19acd946dedf75a441f0d14631053eb/calendar/base/content/dialogs/calendar-event-dialog-attendees-custom-elements.js">file</a> |
<a href="/comm-central/annotate/39a884a7b19acd946dedf75a441f0d14631053eb/calendar/base/content/dialogs/calendar-event-dialog-attendees-custom-elements.js">annotate</a> |
<a href="/comm-central/diff/39a884a7b19acd946dedf75a441f0d14631053eb/calendar/base/content/dialogs/calendar-event-dialog-attendees-custom-elements.js">diff</a> |
<a href="/comm-central/comparison/39a884a7b19acd946dedf75a441f0d14631053eb/calendar/base/content/dialogs/calendar-event-dialog-attendees-custom-elements.js">comparison</a> |
<a href="/comm-central/log/39a884a7b19acd946dedf75a441f0d14631053eb/calendar/base/content/dialogs/calendar-event-dialog-attendees-custom-elements.js">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/39a884a7b19acd946dedf75a441f0d14631053eb/calendar/base/content/dialogs/calendar-invitations-dialog.js">calendar/base/content/dialogs/calendar-invitations-dialog.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/39a884a7b19acd946dedf75a441f0d14631053eb/calendar/base/content/dialogs/calendar-invitations-dialog.js">file</a> |
<a href="/comm-central/annotate/39a884a7b19acd946dedf75a441f0d14631053eb/calendar/base/content/dialogs/calendar-invitations-dialog.js">annotate</a> |
<a href="/comm-central/diff/39a884a7b19acd946dedf75a441f0d14631053eb/calendar/base/content/dialogs/calendar-invitations-dialog.js">diff</a> |
<a href="/comm-central/comparison/39a884a7b19acd946dedf75a441f0d14631053eb/calendar/base/content/dialogs/calendar-invitations-dialog.js">comparison</a> |
<a href="/comm-central/log/39a884a7b19acd946dedf75a441f0d14631053eb/calendar/base/content/dialogs/calendar-invitations-dialog.js">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/39a884a7b19acd946dedf75a441f0d14631053eb/calendar/base/content/preferences/general.js">calendar/base/content/preferences/general.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/39a884a7b19acd946dedf75a441f0d14631053eb/calendar/base/content/preferences/general.js">file</a> |
<a href="/comm-central/annotate/39a884a7b19acd946dedf75a441f0d14631053eb/calendar/base/content/preferences/general.js">annotate</a> |
<a href="/comm-central/diff/39a884a7b19acd946dedf75a441f0d14631053eb/calendar/base/content/preferences/general.js">diff</a> |
<a href="/comm-central/comparison/39a884a7b19acd946dedf75a441f0d14631053eb/calendar/base/content/preferences/general.js">comparison</a> |
<a href="/comm-central/log/39a884a7b19acd946dedf75a441f0d14631053eb/calendar/base/content/preferences/general.js">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/39a884a7b19acd946dedf75a441f0d14631053eb/calendar/base/content/preferences/views.js">calendar/base/content/preferences/views.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/39a884a7b19acd946dedf75a441f0d14631053eb/calendar/base/content/preferences/views.js">file</a> |
<a href="/comm-central/annotate/39a884a7b19acd946dedf75a441f0d14631053eb/calendar/base/content/preferences/views.js">annotate</a> |
<a href="/comm-central/diff/39a884a7b19acd946dedf75a441f0d14631053eb/calendar/base/content/preferences/views.js">diff</a> |
<a href="/comm-central/comparison/39a884a7b19acd946dedf75a441f0d14631053eb/calendar/base/content/preferences/views.js">comparison</a> |
<a href="/comm-central/log/39a884a7b19acd946dedf75a441f0d14631053eb/calendar/base/content/preferences/views.js">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/39a884a7b19acd946dedf75a441f0d14631053eb/calendar/base/content/today-pane.js">calendar/base/content/today-pane.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/39a884a7b19acd946dedf75a441f0d14631053eb/calendar/base/content/today-pane.js">file</a> |
<a href="/comm-central/annotate/39a884a7b19acd946dedf75a441f0d14631053eb/calendar/base/content/today-pane.js">annotate</a> |
<a href="/comm-central/diff/39a884a7b19acd946dedf75a441f0d14631053eb/calendar/base/content/today-pane.js">diff</a> |
<a href="/comm-central/comparison/39a884a7b19acd946dedf75a441f0d14631053eb/calendar/base/content/today-pane.js">comparison</a> |
<a href="/comm-central/log/39a884a7b19acd946dedf75a441f0d14631053eb/calendar/base/content/today-pane.js">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/39a884a7b19acd946dedf75a441f0d14631053eb/calendar/base/content/widgets/calendar-alarm-widget.js">calendar/base/content/widgets/calendar-alarm-widget.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/39a884a7b19acd946dedf75a441f0d14631053eb/calendar/base/content/widgets/calendar-alarm-widget.js">file</a> |
<a href="/comm-central/annotate/39a884a7b19acd946dedf75a441f0d14631053eb/calendar/base/content/widgets/calendar-alarm-widget.js">annotate</a> |
<a href="/comm-central/diff/39a884a7b19acd946dedf75a441f0d14631053eb/calendar/base/content/widgets/calendar-alarm-widget.js">diff</a> |
<a href="/comm-central/comparison/39a884a7b19acd946dedf75a441f0d14631053eb/calendar/base/content/widgets/calendar-alarm-widget.js">comparison</a> |
<a href="/comm-central/log/39a884a7b19acd946dedf75a441f0d14631053eb/calendar/base/content/widgets/calendar-alarm-widget.js">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/39a884a7b19acd946dedf75a441f0d14631053eb/calendar/base/modules/calRecurrenceUtils.jsm">calendar/base/modules/calRecurrenceUtils.jsm</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/39a884a7b19acd946dedf75a441f0d14631053eb/calendar/base/modules/calRecurrenceUtils.jsm">file</a> |
<a href="/comm-central/annotate/39a884a7b19acd946dedf75a441f0d14631053eb/calendar/base/modules/calRecurrenceUtils.jsm">annotate</a> |
<a href="/comm-central/diff/39a884a7b19acd946dedf75a441f0d14631053eb/calendar/base/modules/calRecurrenceUtils.jsm">diff</a> |
<a href="/comm-central/comparison/39a884a7b19acd946dedf75a441f0d14631053eb/calendar/base/modules/calRecurrenceUtils.jsm">comparison</a> |
<a href="/comm-central/log/39a884a7b19acd946dedf75a441f0d14631053eb/calendar/base/modules/calRecurrenceUtils.jsm">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/39a884a7b19acd946dedf75a441f0d14631053eb/calendar/base/modules/calUtils.jsm">calendar/base/modules/calUtils.jsm</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/39a884a7b19acd946dedf75a441f0d14631053eb/calendar/base/modules/calUtils.jsm">file</a> |
<a href="/comm-central/annotate/39a884a7b19acd946dedf75a441f0d14631053eb/calendar/base/modules/calUtils.jsm">annotate</a> |
<a href="/comm-central/diff/39a884a7b19acd946dedf75a441f0d14631053eb/calendar/base/modules/calUtils.jsm">diff</a> |
<a href="/comm-central/comparison/39a884a7b19acd946dedf75a441f0d14631053eb/calendar/base/modules/calUtils.jsm">comparison</a> |
<a href="/comm-central/log/39a884a7b19acd946dedf75a441f0d14631053eb/calendar/base/modules/calUtils.jsm">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/39a884a7b19acd946dedf75a441f0d14631053eb/calendar/base/modules/moz.build">calendar/base/modules/moz.build</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/39a884a7b19acd946dedf75a441f0d14631053eb/calendar/base/modules/moz.build">file</a> |
<a href="/comm-central/annotate/39a884a7b19acd946dedf75a441f0d14631053eb/calendar/base/modules/moz.build">annotate</a> |
<a href="/comm-central/diff/39a884a7b19acd946dedf75a441f0d14631053eb/calendar/base/modules/moz.build">diff</a> |
<a href="/comm-central/comparison/39a884a7b19acd946dedf75a441f0d14631053eb/calendar/base/modules/moz.build">comparison</a> |
<a href="/comm-central/log/39a884a7b19acd946dedf75a441f0d14631053eb/calendar/base/modules/moz.build">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/39a884a7b19acd946dedf75a441f0d14631053eb/calendar/base/modules/utils/calDateTimeFormatter.jsm">calendar/base/modules/utils/calDateTimeFormatter.jsm</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/39a884a7b19acd946dedf75a441f0d14631053eb/calendar/base/modules/utils/calDateTimeFormatter.jsm">file</a> |
<a href="/comm-central/annotate/39a884a7b19acd946dedf75a441f0d14631053eb/calendar/base/modules/utils/calDateTimeFormatter.jsm">annotate</a> |
<a href="/comm-central/diff/39a884a7b19acd946dedf75a441f0d14631053eb/calendar/base/modules/utils/calDateTimeFormatter.jsm">diff</a> |
<a href="/comm-central/comparison/39a884a7b19acd946dedf75a441f0d14631053eb/calendar/base/modules/utils/calDateTimeFormatter.jsm">comparison</a> |
<a href="/comm-central/log/39a884a7b19acd946dedf75a441f0d14631053eb/calendar/base/modules/utils/calDateTimeFormatter.jsm">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/39a884a7b19acd946dedf75a441f0d14631053eb/calendar/base/modules/utils/calDateTimeUtils.jsm">calendar/base/modules/utils/calDateTimeUtils.jsm</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/39a884a7b19acd946dedf75a441f0d14631053eb/calendar/base/modules/utils/calDateTimeUtils.jsm">file</a> |
<a href="/comm-central/annotate/39a884a7b19acd946dedf75a441f0d14631053eb/calendar/base/modules/utils/calDateTimeUtils.jsm">annotate</a> |
<a href="/comm-central/diff/39a884a7b19acd946dedf75a441f0d14631053eb/calendar/base/modules/utils/calDateTimeUtils.jsm">diff</a> |
<a href="/comm-central/comparison/39a884a7b19acd946dedf75a441f0d14631053eb/calendar/base/modules/utils/calDateTimeUtils.jsm">comparison</a> |
<a href="/comm-central/log/39a884a7b19acd946dedf75a441f0d14631053eb/calendar/base/modules/utils/calDateTimeUtils.jsm">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/39a884a7b19acd946dedf75a441f0d14631053eb/calendar/base/modules/utils/calPrintUtils.jsm">calendar/base/modules/utils/calPrintUtils.jsm</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/39a884a7b19acd946dedf75a441f0d14631053eb/calendar/base/modules/utils/calPrintUtils.jsm">file</a> |
<a href="/comm-central/annotate/39a884a7b19acd946dedf75a441f0d14631053eb/calendar/base/modules/utils/calPrintUtils.jsm">annotate</a> |
<a href="/comm-central/diff/39a884a7b19acd946dedf75a441f0d14631053eb/calendar/base/modules/utils/calPrintUtils.jsm">diff</a> |
<a href="/comm-central/comparison/39a884a7b19acd946dedf75a441f0d14631053eb/calendar/base/modules/utils/calPrintUtils.jsm">comparison</a> |
<a href="/comm-central/log/39a884a7b19acd946dedf75a441f0d14631053eb/calendar/base/modules/utils/calPrintUtils.jsm">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/39a884a7b19acd946dedf75a441f0d14631053eb/calendar/base/public/calIDateTimeFormatter.idl">calendar/base/public/calIDateTimeFormatter.idl</a></td>
<td></td>
<td class="link">
file |
annotate |
<a href="/comm-central/diff/39a884a7b19acd946dedf75a441f0d14631053eb/calendar/base/public/calIDateTimeFormatter.idl">diff</a> |
<a href="/comm-central/comparison/39a884a7b19acd946dedf75a441f0d14631053eb/calendar/base/public/calIDateTimeFormatter.idl">comparison</a> |
<a href="/comm-central/log/39a884a7b19acd946dedf75a441f0d14631053eb/calendar/base/public/calIDateTimeFormatter.idl">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/39a884a7b19acd946dedf75a441f0d14631053eb/calendar/base/public/moz.build">calendar/base/public/moz.build</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/39a884a7b19acd946dedf75a441f0d14631053eb/calendar/base/public/moz.build">file</a> |
<a href="/comm-central/annotate/39a884a7b19acd946dedf75a441f0d14631053eb/calendar/base/public/moz.build">annotate</a> |
<a href="/comm-central/diff/39a884a7b19acd946dedf75a441f0d14631053eb/calendar/base/public/moz.build">diff</a> |
<a href="/comm-central/comparison/39a884a7b19acd946dedf75a441f0d14631053eb/calendar/base/public/moz.build">comparison</a> |
<a href="/comm-central/log/39a884a7b19acd946dedf75a441f0d14631053eb/calendar/base/public/moz.build">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/39a884a7b19acd946dedf75a441f0d14631053eb/calendar/base/src/CalAlarm.jsm">calendar/base/src/CalAlarm.jsm</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/39a884a7b19acd946dedf75a441f0d14631053eb/calendar/base/src/CalAlarm.jsm">file</a> |
<a href="/comm-central/annotate/39a884a7b19acd946dedf75a441f0d14631053eb/calendar/base/src/CalAlarm.jsm">annotate</a> |
<a href="/comm-central/diff/39a884a7b19acd946dedf75a441f0d14631053eb/calendar/base/src/CalAlarm.jsm">diff</a> |
<a href="/comm-central/comparison/39a884a7b19acd946dedf75a441f0d14631053eb/calendar/base/src/CalAlarm.jsm">comparison</a> |
<a href="/comm-central/log/39a884a7b19acd946dedf75a441f0d14631053eb/calendar/base/src/CalAlarm.jsm">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/39a884a7b19acd946dedf75a441f0d14631053eb/calendar/base/src/CalDateTimeFormatter.jsm">calendar/base/src/CalDateTimeFormatter.jsm</a></td>
<td></td>
<td class="link">
file |
annotate |
<a href="/comm-central/diff/39a884a7b19acd946dedf75a441f0d14631053eb/calendar/base/src/CalDateTimeFormatter.jsm">diff</a> |
<a href="/comm-central/comparison/39a884a7b19acd946dedf75a441f0d14631053eb/calendar/base/src/CalDateTimeFormatter.jsm">comparison</a> |
<a href="/comm-central/log/39a884a7b19acd946dedf75a441f0d14631053eb/calendar/base/src/CalDateTimeFormatter.jsm">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/39a884a7b19acd946dedf75a441f0d14631053eb/calendar/base/src/CalIcsParser.jsm">calendar/base/src/CalIcsParser.jsm</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/39a884a7b19acd946dedf75a441f0d14631053eb/calendar/base/src/CalIcsParser.jsm">file</a> |
<a href="/comm-central/annotate/39a884a7b19acd946dedf75a441f0d14631053eb/calendar/base/src/CalIcsParser.jsm">annotate</a> |
<a href="/comm-central/diff/39a884a7b19acd946dedf75a441f0d14631053eb/calendar/base/src/CalIcsParser.jsm">diff</a> |
<a href="/comm-central/comparison/39a884a7b19acd946dedf75a441f0d14631053eb/calendar/base/src/CalIcsParser.jsm">comparison</a> |
<a href="/comm-central/log/39a884a7b19acd946dedf75a441f0d14631053eb/calendar/base/src/CalIcsParser.jsm">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/39a884a7b19acd946dedf75a441f0d14631053eb/calendar/base/src/components.conf">calendar/base/src/components.conf</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/39a884a7b19acd946dedf75a441f0d14631053eb/calendar/base/src/components.conf">file</a> |
<a href="/comm-central/annotate/39a884a7b19acd946dedf75a441f0d14631053eb/calendar/base/src/components.conf">annotate</a> |
<a href="/comm-central/diff/39a884a7b19acd946dedf75a441f0d14631053eb/calendar/base/src/components.conf">diff</a> |
<a href="/comm-central/comparison/39a884a7b19acd946dedf75a441f0d14631053eb/calendar/base/src/components.conf">comparison</a> |
<a href="/comm-central/log/39a884a7b19acd946dedf75a441f0d14631053eb/calendar/base/src/components.conf">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/39a884a7b19acd946dedf75a441f0d14631053eb/calendar/base/src/moz.build">calendar/base/src/moz.build</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/39a884a7b19acd946dedf75a441f0d14631053eb/calendar/base/src/moz.build">file</a> |
<a href="/comm-central/annotate/39a884a7b19acd946dedf75a441f0d14631053eb/calendar/base/src/moz.build">annotate</a> |
<a href="/comm-central/diff/39a884a7b19acd946dedf75a441f0d14631053eb/calendar/base/src/moz.build">diff</a> |
<a href="/comm-central/comparison/39a884a7b19acd946dedf75a441f0d14631053eb/calendar/base/src/moz.build">comparison</a> |
<a href="/comm-central/log/39a884a7b19acd946dedf75a441f0d14631053eb/calendar/base/src/moz.build">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/39a884a7b19acd946dedf75a441f0d14631053eb/calendar/import-export/CalHtmlExport.jsm">calendar/import-export/CalHtmlExport.jsm</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/39a884a7b19acd946dedf75a441f0d14631053eb/calendar/import-export/CalHtmlExport.jsm">file</a> |
<a href="/comm-central/annotate/39a884a7b19acd946dedf75a441f0d14631053eb/calendar/import-export/CalHtmlExport.jsm">annotate</a> |
<a href="/comm-central/diff/39a884a7b19acd946dedf75a441f0d14631053eb/calendar/import-export/CalHtmlExport.jsm">diff</a> |
<a href="/comm-central/comparison/39a884a7b19acd946dedf75a441f0d14631053eb/calendar/import-export/CalHtmlExport.jsm">comparison</a> |
<a href="/comm-central/log/39a884a7b19acd946dedf75a441f0d14631053eb/calendar/import-export/CalHtmlExport.jsm">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/39a884a7b19acd946dedf75a441f0d14631053eb/calendar/import-export/CalWeekPrinter.jsm">calendar/import-export/CalWeekPrinter.jsm</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/39a884a7b19acd946dedf75a441f0d14631053eb/calendar/import-export/CalWeekPrinter.jsm">file</a> |
<a href="/comm-central/annotate/39a884a7b19acd946dedf75a441f0d14631053eb/calendar/import-export/CalWeekPrinter.jsm">annotate</a> |
<a href="/comm-central/diff/39a884a7b19acd946dedf75a441f0d14631053eb/calendar/import-export/CalWeekPrinter.jsm">diff</a> |
<a href="/comm-central/comparison/39a884a7b19acd946dedf75a441f0d14631053eb/calendar/import-export/CalWeekPrinter.jsm">comparison</a> |
<a href="/comm-central/log/39a884a7b19acd946dedf75a441f0d14631053eb/calendar/import-export/CalWeekPrinter.jsm">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/39a884a7b19acd946dedf75a441f0d14631053eb/calendar/lightning/content/lightning-item-iframe.js">calendar/lightning/content/lightning-item-iframe.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/39a884a7b19acd946dedf75a441f0d14631053eb/calendar/lightning/content/lightning-item-iframe.js">file</a> |
<a href="/comm-central/annotate/39a884a7b19acd946dedf75a441f0d14631053eb/calendar/lightning/content/lightning-item-iframe.js">annotate</a> |
<a href="/comm-central/diff/39a884a7b19acd946dedf75a441f0d14631053eb/calendar/lightning/content/lightning-item-iframe.js">diff</a> |
<a href="/comm-central/comparison/39a884a7b19acd946dedf75a441f0d14631053eb/calendar/lightning/content/lightning-item-iframe.js">comparison</a> |
<a href="/comm-central/log/39a884a7b19acd946dedf75a441f0d14631053eb/calendar/lightning/content/lightning-item-iframe.js">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/39a884a7b19acd946dedf75a441f0d14631053eb/calendar/lightning/modules/ltnInvitationUtils.jsm">calendar/lightning/modules/ltnInvitationUtils.jsm</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/39a884a7b19acd946dedf75a441f0d14631053eb/calendar/lightning/modules/ltnInvitationUtils.jsm">file</a> |
<a href="/comm-central/annotate/39a884a7b19acd946dedf75a441f0d14631053eb/calendar/lightning/modules/ltnInvitationUtils.jsm">annotate</a> |
<a href="/comm-central/diff/39a884a7b19acd946dedf75a441f0d14631053eb/calendar/lightning/modules/ltnInvitationUtils.jsm">diff</a> |
<a href="/comm-central/comparison/39a884a7b19acd946dedf75a441f0d14631053eb/calendar/lightning/modules/ltnInvitationUtils.jsm">comparison</a> |
<a href="/comm-central/log/39a884a7b19acd946dedf75a441f0d14631053eb/calendar/lightning/modules/ltnInvitationUtils.jsm">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/39a884a7b19acd946dedf75a441f0d14631053eb/calendar/resources/content/datetimepickers/datetimepickers.js">calendar/resources/content/datetimepickers/datetimepickers.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/39a884a7b19acd946dedf75a441f0d14631053eb/calendar/resources/content/datetimepickers/datetimepickers.js">file</a> |
<a href="/comm-central/annotate/39a884a7b19acd946dedf75a441f0d14631053eb/calendar/resources/content/datetimepickers/datetimepickers.js">annotate</a> |
<a href="/comm-central/diff/39a884a7b19acd946dedf75a441f0d14631053eb/calendar/resources/content/datetimepickers/datetimepickers.js">diff</a> |
<a href="/comm-central/comparison/39a884a7b19acd946dedf75a441f0d14631053eb/calendar/resources/content/datetimepickers/datetimepickers.js">comparison</a> |
<a href="/comm-central/log/39a884a7b19acd946dedf75a441f0d14631053eb/calendar/resources/content/datetimepickers/datetimepickers.js">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/39a884a7b19acd946dedf75a441f0d14631053eb/calendar/resources/content/mouseoverPreviews.js">calendar/resources/content/mouseoverPreviews.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/39a884a7b19acd946dedf75a441f0d14631053eb/calendar/resources/content/mouseoverPreviews.js">file</a> |
<a href="/comm-central/annotate/39a884a7b19acd946dedf75a441f0d14631053eb/calendar/resources/content/mouseoverPreviews.js">annotate</a> |
<a href="/comm-central/diff/39a884a7b19acd946dedf75a441f0d14631053eb/calendar/resources/content/mouseoverPreviews.js">diff</a> |
<a href="/comm-central/comparison/39a884a7b19acd946dedf75a441f0d14631053eb/calendar/resources/content/mouseoverPreviews.js">comparison</a> |
<a href="/comm-central/log/39a884a7b19acd946dedf75a441f0d14631053eb/calendar/resources/content/mouseoverPreviews.js">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/39a884a7b19acd946dedf75a441f0d14631053eb/calendar/test/browser/browser_basicFunctionality.js">calendar/test/browser/browser_basicFunctionality.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/39a884a7b19acd946dedf75a441f0d14631053eb/calendar/test/browser/browser_basicFunctionality.js">file</a> |
<a href="/comm-central/annotate/39a884a7b19acd946dedf75a441f0d14631053eb/calendar/test/browser/browser_basicFunctionality.js">annotate</a> |
<a href="/comm-central/diff/39a884a7b19acd946dedf75a441f0d14631053eb/calendar/test/browser/browser_basicFunctionality.js">diff</a> |
<a href="/comm-central/comparison/39a884a7b19acd946dedf75a441f0d14631053eb/calendar/test/browser/browser_basicFunctionality.js">comparison</a> |
<a href="/comm-central/log/39a884a7b19acd946dedf75a441f0d14631053eb/calendar/test/browser/browser_basicFunctionality.js">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/39a884a7b19acd946dedf75a441f0d14631053eb/calendar/test/browser/browser_eventDisplay.js">calendar/test/browser/browser_eventDisplay.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/39a884a7b19acd946dedf75a441f0d14631053eb/calendar/test/browser/browser_eventDisplay.js">file</a> |
<a href="/comm-central/annotate/39a884a7b19acd946dedf75a441f0d14631053eb/calendar/test/browser/browser_eventDisplay.js">annotate</a> |
<a href="/comm-central/diff/39a884a7b19acd946dedf75a441f0d14631053eb/calendar/test/browser/browser_eventDisplay.js">diff</a> |
<a href="/comm-central/comparison/39a884a7b19acd946dedf75a441f0d14631053eb/calendar/test/browser/browser_eventDisplay.js">comparison</a> |
<a href="/comm-central/log/39a884a7b19acd946dedf75a441f0d14631053eb/calendar/test/browser/browser_eventDisplay.js">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/39a884a7b19acd946dedf75a441f0d14631053eb/calendar/test/browser/browser_todayPane.js">calendar/test/browser/browser_todayPane.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/39a884a7b19acd946dedf75a441f0d14631053eb/calendar/test/browser/browser_todayPane.js">file</a> |
<a href="/comm-central/annotate/39a884a7b19acd946dedf75a441f0d14631053eb/calendar/test/browser/browser_todayPane.js">annotate</a> |
<a href="/comm-central/diff/39a884a7b19acd946dedf75a441f0d14631053eb/calendar/test/browser/browser_todayPane.js">diff</a> |
<a href="/comm-central/comparison/39a884a7b19acd946dedf75a441f0d14631053eb/calendar/test/browser/browser_todayPane.js">comparison</a> |
<a href="/comm-central/log/39a884a7b19acd946dedf75a441f0d14631053eb/calendar/test/browser/browser_todayPane.js">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/39a884a7b19acd946dedf75a441f0d14631053eb/calendar/test/browser/eventDialog/browser_eventDialog.js">calendar/test/browser/eventDialog/browser_eventDialog.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/39a884a7b19acd946dedf75a441f0d14631053eb/calendar/test/browser/eventDialog/browser_eventDialog.js">file</a> |
<a href="/comm-central/annotate/39a884a7b19acd946dedf75a441f0d14631053eb/calendar/test/browser/eventDialog/browser_eventDialog.js">annotate</a> |
<a href="/comm-central/diff/39a884a7b19acd946dedf75a441f0d14631053eb/calendar/test/browser/eventDialog/browser_eventDialog.js">diff</a> |
<a href="/comm-central/comparison/39a884a7b19acd946dedf75a441f0d14631053eb/calendar/test/browser/eventDialog/browser_eventDialog.js">comparison</a> |
<a href="/comm-central/log/39a884a7b19acd946dedf75a441f0d14631053eb/calendar/test/browser/eventDialog/browser_eventDialog.js">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/39a884a7b19acd946dedf75a441f0d14631053eb/calendar/test/browser/recurrence/browser_weeklyUntil.js">calendar/test/browser/recurrence/browser_weeklyUntil.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/39a884a7b19acd946dedf75a441f0d14631053eb/calendar/test/browser/recurrence/browser_weeklyUntil.js">file</a> |
<a href="/comm-central/annotate/39a884a7b19acd946dedf75a441f0d14631053eb/calendar/test/browser/recurrence/browser_weeklyUntil.js">annotate</a> |
<a href="/comm-central/diff/39a884a7b19acd946dedf75a441f0d14631053eb/calendar/test/browser/recurrence/browser_weeklyUntil.js">diff</a> |
<a href="/comm-central/comparison/39a884a7b19acd946dedf75a441f0d14631053eb/calendar/test/browser/recurrence/browser_weeklyUntil.js">comparison</a> |
<a href="/comm-central/log/39a884a7b19acd946dedf75a441f0d14631053eb/calendar/test/browser/recurrence/browser_weeklyUntil.js">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/39a884a7b19acd946dedf75a441f0d14631053eb/calendar/test/browser/views/browser_dayView.js">calendar/test/browser/views/browser_dayView.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/39a884a7b19acd946dedf75a441f0d14631053eb/calendar/test/browser/views/browser_dayView.js">file</a> |
<a href="/comm-central/annotate/39a884a7b19acd946dedf75a441f0d14631053eb/calendar/test/browser/views/browser_dayView.js">annotate</a> |
<a href="/comm-central/diff/39a884a7b19acd946dedf75a441f0d14631053eb/calendar/test/browser/views/browser_dayView.js">diff</a> |
<a href="/comm-central/comparison/39a884a7b19acd946dedf75a441f0d14631053eb/calendar/test/browser/views/browser_dayView.js">comparison</a> |
<a href="/comm-central/log/39a884a7b19acd946dedf75a441f0d14631053eb/calendar/test/browser/views/browser_dayView.js">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/39a884a7b19acd946dedf75a441f0d14631053eb/calendar/test/browser/views/browser_monthView.js">calendar/test/browser/views/browser_monthView.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/39a884a7b19acd946dedf75a441f0d14631053eb/calendar/test/browser/views/browser_monthView.js">file</a> |
<a href="/comm-central/annotate/39a884a7b19acd946dedf75a441f0d14631053eb/calendar/test/browser/views/browser_monthView.js">annotate</a> |
<a href="/comm-central/diff/39a884a7b19acd946dedf75a441f0d14631053eb/calendar/test/browser/views/browser_monthView.js">diff</a> |
<a href="/comm-central/comparison/39a884a7b19acd946dedf75a441f0d14631053eb/calendar/test/browser/views/browser_monthView.js">comparison</a> |
<a href="/comm-central/log/39a884a7b19acd946dedf75a441f0d14631053eb/calendar/test/browser/views/browser_monthView.js">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/39a884a7b19acd946dedf75a441f0d14631053eb/calendar/test/browser/views/browser_multiweekView.js">calendar/test/browser/views/browser_multiweekView.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/39a884a7b19acd946dedf75a441f0d14631053eb/calendar/test/browser/views/browser_multiweekView.js">file</a> |
<a href="/comm-central/annotate/39a884a7b19acd946dedf75a441f0d14631053eb/calendar/test/browser/views/browser_multiweekView.js">annotate</a> |
<a href="/comm-central/diff/39a884a7b19acd946dedf75a441f0d14631053eb/calendar/test/browser/views/browser_multiweekView.js">diff</a> |
<a href="/comm-central/comparison/39a884a7b19acd946dedf75a441f0d14631053eb/calendar/test/browser/views/browser_multiweekView.js">comparison</a> |
<a href="/comm-central/log/39a884a7b19acd946dedf75a441f0d14631053eb/calendar/test/browser/views/browser_multiweekView.js">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/39a884a7b19acd946dedf75a441f0d14631053eb/calendar/test/browser/views/browser_weekView.js">calendar/test/browser/views/browser_weekView.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/39a884a7b19acd946dedf75a441f0d14631053eb/calendar/test/browser/views/browser_weekView.js">file</a> |
<a href="/comm-central/annotate/39a884a7b19acd946dedf75a441f0d14631053eb/calendar/test/browser/views/browser_weekView.js">annotate</a> |
<a href="/comm-central/diff/39a884a7b19acd946dedf75a441f0d14631053eb/calendar/test/browser/views/browser_weekView.js">diff</a> |
<a href="/comm-central/comparison/39a884a7b19acd946dedf75a441f0d14631053eb/calendar/test/browser/views/browser_weekView.js">comparison</a> |
<a href="/comm-central/log/39a884a7b19acd946dedf75a441f0d14631053eb/calendar/test/browser/views/browser_weekView.js">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/39a884a7b19acd946dedf75a441f0d14631053eb/calendar/test/modules/ItemEditingHelpers.jsm">calendar/test/modules/ItemEditingHelpers.jsm</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/39a884a7b19acd946dedf75a441f0d14631053eb/calendar/test/modules/ItemEditingHelpers.jsm">file</a> |
<a href="/comm-central/annotate/39a884a7b19acd946dedf75a441f0d14631053eb/calendar/test/modules/ItemEditingHelpers.jsm">annotate</a> |
<a href="/comm-central/diff/39a884a7b19acd946dedf75a441f0d14631053eb/calendar/test/modules/ItemEditingHelpers.jsm">diff</a> |
<a href="/comm-central/comparison/39a884a7b19acd946dedf75a441f0d14631053eb/calendar/test/modules/ItemEditingHelpers.jsm">comparison</a> |
<a href="/comm-central/log/39a884a7b19acd946dedf75a441f0d14631053eb/calendar/test/modules/ItemEditingHelpers.jsm">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/39a884a7b19acd946dedf75a441f0d14631053eb/calendar/test/unit/test_datetimeformatter.js">calendar/test/unit/test_datetimeformatter.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/39a884a7b19acd946dedf75a441f0d14631053eb/calendar/test/unit/test_datetimeformatter.js">file</a> |
<a href="/comm-central/annotate/39a884a7b19acd946dedf75a441f0d14631053eb/calendar/test/unit/test_datetimeformatter.js">annotate</a> |
<a href="/comm-central/diff/39a884a7b19acd946dedf75a441f0d14631053eb/calendar/test/unit/test_datetimeformatter.js">diff</a> |
<a href="/comm-central/comparison/39a884a7b19acd946dedf75a441f0d14631053eb/calendar/test/unit/test_datetimeformatter.js">comparison</a> |
<a href="/comm-central/log/39a884a7b19acd946dedf75a441f0d14631053eb/calendar/test/unit/test_datetimeformatter.js">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/39a884a7b19acd946dedf75a441f0d14631053eb/calendar/test/unit/test_ltninvitationutils.js">calendar/test/unit/test_ltninvitationutils.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/39a884a7b19acd946dedf75a441f0d14631053eb/calendar/test/unit/test_ltninvitationutils.js">file</a> |
<a href="/comm-central/annotate/39a884a7b19acd946dedf75a441f0d14631053eb/calendar/test/unit/test_ltninvitationutils.js">annotate</a> |
<a href="/comm-central/diff/39a884a7b19acd946dedf75a441f0d14631053eb/calendar/test/unit/test_ltninvitationutils.js">diff</a> |
<a href="/comm-central/comparison/39a884a7b19acd946dedf75a441f0d14631053eb/calendar/test/unit/test_ltninvitationutils.js">comparison</a> |
<a href="/comm-central/log/39a884a7b19acd946dedf75a441f0d14631053eb/calendar/test/unit/test_ltninvitationutils.js">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/39a884a7b19acd946dedf75a441f0d14631053eb/calendar/test/unit/test_recur.js">calendar/test/unit/test_recur.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/39a884a7b19acd946dedf75a441f0d14631053eb/calendar/test/unit/test_recur.js">file</a> |
<a href="/comm-central/annotate/39a884a7b19acd946dedf75a441f0d14631053eb/calendar/test/unit/test_recur.js">annotate</a> |
<a href="/comm-central/diff/39a884a7b19acd946dedf75a441f0d14631053eb/calendar/test/unit/test_recur.js">diff</a> |
<a href="/comm-central/comparison/39a884a7b19acd946dedf75a441f0d14631053eb/calendar/test/unit/test_recur.js">comparison</a> |
<a href="/comm-central/log/39a884a7b19acd946dedf75a441f0d14631053eb/calendar/test/unit/test_recur.js">revisions</a>
</td>
</tr>
</table></div>

<div class="page_body diffblocks"><div class="diffblock"><pre class="sourcelines">
<a href="#l1.1"></a><span id="l1.1" class="difflineminus">--- a/calendar/base/content/agenda-listbox.js</span>
<a href="#l1.2"></a><span id="l1.2" class="difflineplus">+++ b/calendar/base/content/agenda-listbox.js</span>
<a href="#l1.3"></a><span id="l1.3" class="difflineat">@@ -43,17 +43,17 @@</span>
<a href="#l1.4"></a><span id="l1.4">         if (this.id == &quot;nextweek-header&quot;) {</span>
<a href="#l1.5"></a><span id="l1.5">           if (duration &gt; 7) {</span>
<a href="#l1.6"></a><span id="l1.6">             this.kCheckbox.label += &quot; (&quot; + unitPluralForm(duration / 7, &quot;weeks&quot;) + &quot;)&quot;;</span>
<a href="#l1.7"></a><span id="l1.7">           } else {</span>
<a href="#l1.8"></a><span id="l1.8">             this.kCheckbox.label += &quot; (&quot; + unitPluralForm(duration, &quot;days&quot;) + &quot;)&quot;;</span>
<a href="#l1.9"></a><span id="l1.9">           }</span>
<a href="#l1.10"></a><span id="l1.10">         }</span>
<a href="#l1.11"></a><span id="l1.11">       } else if (synthetic.duration == 1) {</span>
<a href="#l1.12"></a><span id="l1.12" class="difflineminus">-        this.kCheckbox.label = cal.getDateFormatter().formatDate(synthetic.start);</span>
<a href="#l1.13"></a><span id="l1.13" class="difflineplus">+        this.kCheckbox.label = cal.dtz.formatter.formatDate(synthetic.start);</span>
<a href="#l1.14"></a><span id="l1.14">       } else {</span>
<a href="#l1.15"></a><span id="l1.15">         this.kCheckbox.label = cal</span>
<a href="#l1.16"></a><span id="l1.16">           .getDateFormatter()</span>
<a href="#l1.17"></a><span id="l1.17">           .formatInterval(synthetic.start, synthetic.end);</span>
<a href="#l1.18"></a><span id="l1.18">       }</span>
<a href="#l1.19"></a><span id="l1.19">     }</span>
<a href="#l1.20"></a><span id="l1.20">     getCheckbox() {</span>
<a href="#l1.21"></a><span id="l1.21">       return this.kCheckbox;</span>
<a href="#l1.22"></a><span id="l1.22" class="difflineat">@@ -135,17 +135,17 @@</span>
<a href="#l1.23"></a><span id="l1.23">       this.mOccurrence = null;</span>
<a href="#l1.24"></a><span id="l1.24">       this.initializeAttributeInheritance();</span>
<a href="#l1.25"></a><span id="l1.25">     }</span>
<a href="#l1.26"></a><span id="l1.26"> </span>
<a href="#l1.27"></a><span id="l1.27">     setOccurrence(aOccurrence, aPeriod) {</span>
<a href="#l1.28"></a><span id="l1.28">       this.mOccurrence = aOccurrence;</span>
<a href="#l1.29"></a><span id="l1.29">       this.mAllDayItem = this.querySelector(&quot;calendar-month-day-box-item&quot;);</span>
<a href="#l1.30"></a><span id="l1.30">       this.mAllDayItem.occurrence = aOccurrence;</span>
<a href="#l1.31"></a><span id="l1.31" class="difflineminus">-      let dateFormatter = cal.getDateFormatter();</span>
<a href="#l1.32"></a><span id="l1.32" class="difflineplus">+      let dateFormatter = cal.dtz.formatter;</span>
<a href="#l1.33"></a><span id="l1.33">       let periodStartDate = aPeriod.start.clone();</span>
<a href="#l1.34"></a><span id="l1.34">       periodStartDate.isDate = true;</span>
<a href="#l1.35"></a><span id="l1.35">       let periodEndDate = aPeriod.end;</span>
<a href="#l1.36"></a><span id="l1.36">       let startDate = this.mOccurrence[cal.dtz.startDateProp(this.mOccurrence)].getInTimezone(</span>
<a href="#l1.37"></a><span id="l1.37">         cal.dtz.defaultTimezone</span>
<a href="#l1.38"></a><span id="l1.38">       );</span>
<a href="#l1.39"></a><span id="l1.39">       let endDate = this.mOccurrence[cal.dtz.endDateProp(this.mOccurrence)].getInTimezone(</span>
<a href="#l1.40"></a><span id="l1.40">         cal.dtz.defaultTimezone</span>
<a href="#l1.41"></a><span id="l1.41" class="difflineat">@@ -266,19 +266,17 @@</span>
<a href="#l1.42"></a><span id="l1.42">         `)</span>
<a href="#l1.43"></a><span id="l1.43">       );</span>
<a href="#l1.44"></a><span id="l1.44">       this.mOccurrence = null;</span>
<a href="#l1.45"></a><span id="l1.45">       this.initializeAttributeInheritance();</span>
<a href="#l1.46"></a><span id="l1.46">     }</span>
<a href="#l1.47"></a><span id="l1.47">     setOccurrence(aItem, aPeriod) {</span>
<a href="#l1.48"></a><span id="l1.48">       this.mOccurrence = aItem;</span>
<a href="#l1.49"></a><span id="l1.49">       this.setAttribute(&quot;status&quot;, aItem.status);</span>
<a href="#l1.50"></a><span id="l1.50" class="difflineminus">-      let dateFormatter = Cc[&quot;@mozilla.org/calendar/datetime-formatter;1&quot;].getService(</span>
<a href="#l1.51"></a><span id="l1.51" class="difflineminus">-        Ci.calIDateTimeFormatter</span>
<a href="#l1.52"></a><span id="l1.52" class="difflineminus">-      );</span>
<a href="#l1.53"></a><span id="l1.53" class="difflineplus">+      let dateFormatter = cal.dtz.formatter;</span>
<a href="#l1.54"></a><span id="l1.54">       let periodStartDate = aPeriod.start.clone();</span>
<a href="#l1.55"></a><span id="l1.55">       periodStartDate.isDate = true;</span>
<a href="#l1.56"></a><span id="l1.56">       let periodEndDate = aPeriod.end.clone();</span>
<a href="#l1.57"></a><span id="l1.57">       periodEndDate.day--;</span>
<a href="#l1.58"></a><span id="l1.58">       let start = this.mOccurrence[cal.dtz.startDateProp(this.mOccurrence)].getInTimezone(</span>
<a href="#l1.59"></a><span id="l1.59">         cal.dtz.defaultTimezone</span>
<a href="#l1.60"></a><span id="l1.60">       );</span>
<a href="#l1.61"></a><span id="l1.61">       let end = this.mOccurrence[cal.dtz.endDateProp(this.mOccurrence)].getInTimezone(</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l2.1"></a><span id="l2.1" class="difflineminus">--- a/calendar/base/content/calendar-base-view.js</span>
<a href="#l2.2"></a><span id="l2.2" class="difflineplus">+++ b/calendar/base/content/calendar-base-view.js</span>
<a href="#l2.3"></a><span id="l2.3" class="difflineat">@@ -910,17 +910,17 @@</span>
<a href="#l2.4"></a><span id="l2.4"> </span>
<a href="#l2.5"></a><span id="l2.5">     // calICalendarView Methods</span>
<a href="#l2.6"></a><span id="l2.6"> </span>
<a href="#l2.7"></a><span id="l2.7">     goToDay(date) {</span>
<a href="#l2.8"></a><span id="l2.8">       this.showDate(date);</span>
<a href="#l2.9"></a><span id="l2.9">     }</span>
<a href="#l2.10"></a><span id="l2.10"> </span>
<a href="#l2.11"></a><span id="l2.11">     getRangeDescription() {</span>
<a href="#l2.12"></a><span id="l2.12" class="difflineminus">-      return cal.getDateFormatter().formatInterval(this.rangeStartDate, this.rangeEndDate);</span>
<a href="#l2.13"></a><span id="l2.13" class="difflineplus">+      return cal.dtz.formatter.formatInterval(this.rangeStartDate, this.rangeEndDate);</span>
<a href="#l2.14"></a><span id="l2.14">     }</span>
<a href="#l2.15"></a><span id="l2.15"> </span>
<a href="#l2.16"></a><span id="l2.16">     removeDropShadows() {</span>
<a href="#l2.17"></a><span id="l2.17">       this.querySelectorAll(&quot;[dropbox='true']&quot;).forEach(dbox =&gt; {</span>
<a href="#l2.18"></a><span id="l2.18">         dbox.setAttribute(&quot;dropbox&quot;, &quot;false&quot;);</span>
<a href="#l2.19"></a><span id="l2.19">       });</span>
<a href="#l2.20"></a><span id="l2.20">     }</span>
<a href="#l2.21"></a><span id="l2.21"> </span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l3.1"></a><span id="l3.1" class="difflineminus">--- a/calendar/base/content/calendar-day-label.js</span>
<a href="#l3.2"></a><span id="l3.2" class="difflineplus">+++ b/calendar/base/content/calendar-day-label.js</span>
<a href="#l3.3"></a><span id="l3.3" class="difflineat">@@ -63,28 +63,28 @@</span>
<a href="#l3.4"></a><span id="l3.4">       } else {</span>
<a href="#l3.5"></a><span id="l3.5">         this.longWeekdayName.removeAttribute(&quot;relation&quot;);</span>
<a href="#l3.6"></a><span id="l3.6">         this.shortWeekdayName.removeAttribute(&quot;relation&quot;);</span>
<a href="#l3.7"></a><span id="l3.7">       }</span>
<a href="#l3.8"></a><span id="l3.8">     }</span>
<a href="#l3.9"></a><span id="l3.9"> </span>
<a href="#l3.10"></a><span id="l3.10">     set weekDay(val) {</span>
<a href="#l3.11"></a><span id="l3.11">       this.mWeekday = val % 7;</span>
<a href="#l3.12"></a><span id="l3.12" class="difflineminus">-      this.longWeekdayName.value = cal.getDateFormatter().dayName(val);</span>
<a href="#l3.13"></a><span id="l3.13" class="difflineminus">-      this.shortWeekdayName.value = cal.getDateFormatter().shortDayName(val);</span>
<a href="#l3.14"></a><span id="l3.14" class="difflineplus">+      this.longWeekdayName.value = cal.dtz.formatter.dayName(val);</span>
<a href="#l3.15"></a><span id="l3.15" class="difflineplus">+      this.shortWeekdayName.value = cal.dtz.formatter.shortDayName(val);</span>
<a href="#l3.16"></a><span id="l3.16">       return this.mWeekday;</span>
<a href="#l3.17"></a><span id="l3.17">     }</span>
<a href="#l3.18"></a><span id="l3.18"> </span>
<a href="#l3.19"></a><span id="l3.19">     get weekDay() {</span>
<a href="#l3.20"></a><span id="l3.20">       return this.mWeekday;</span>
<a href="#l3.21"></a><span id="l3.21">     }</span>
<a href="#l3.22"></a><span id="l3.22"> </span>
<a href="#l3.23"></a><span id="l3.23">     set date(val) {</span>
<a href="#l3.24"></a><span id="l3.24">       this.mDate = val;</span>
<a href="#l3.25"></a><span id="l3.25" class="difflineminus">-      let dateFormatter = cal.getDateFormatter();</span>
<a href="#l3.26"></a><span id="l3.26" class="difflineplus">+      let dateFormatter = cal.dtz.formatter;</span>
<a href="#l3.27"></a><span id="l3.27">       let label = cal.l10n.getCalString(&quot;dayHeaderLabel&quot;, [</span>
<a href="#l3.28"></a><span id="l3.28">         dateFormatter.shortDayName(val.weekday),</span>
<a href="#l3.29"></a><span id="l3.29">         dateFormatter.formatDateWithoutYear(val),</span>
<a href="#l3.30"></a><span id="l3.30">       ]);</span>
<a href="#l3.31"></a><span id="l3.31">       this.shortWeekdayName.setAttribute(&quot;value&quot;, label);</span>
<a href="#l3.32"></a><span id="l3.32">       label = cal.l10n.getCalString(&quot;dayHeaderLabel&quot;, [</span>
<a href="#l3.33"></a><span id="l3.33">         dateFormatter.dayName(val.weekday),</span>
<a href="#l3.34"></a><span id="l3.34">         dateFormatter.formatDateWithoutYear(val),</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l4.1"></a><span id="l4.1" class="difflineminus">--- a/calendar/base/content/calendar-event-column.js</span>
<a href="#l4.2"></a><span id="l4.2" class="difflineplus">+++ b/calendar/base/content/calendar-event-column.js</span>
<a href="#l4.3"></a><span id="l4.3" class="difflineat">@@ -1821,23 +1821,23 @@</span>
<a href="#l4.4"></a><span id="l4.4">       let realstartmin = this.mDragState.startMin + this.mStartMin;</span>
<a href="#l4.5"></a><span id="l4.5">       let realendmin = this.mDragState.endMin + this.mStartMin;</span>
<a href="#l4.6"></a><span id="l4.6">       let starthr = Math.floor(realstartmin / 60);</span>
<a href="#l4.7"></a><span id="l4.7">       let startmin = realstartmin % 60;</span>
<a href="#l4.8"></a><span id="l4.8"> </span>
<a href="#l4.9"></a><span id="l4.9">       let endhr = Math.floor(realendmin / 60);</span>
<a href="#l4.10"></a><span id="l4.10">       let endmin = realendmin % 60;</span>
<a href="#l4.11"></a><span id="l4.11"> </span>
<a href="#l4.12"></a><span id="l4.12" class="difflineminus">-      let timeFormatter = cal.getDateFormatter();</span>
<a href="#l4.13"></a><span id="l4.13" class="difflineplus">+      let formatter = cal.dtz.formatter;</span>
<a href="#l4.14"></a><span id="l4.14"> </span>
<a href="#l4.15"></a><span id="l4.15">       let jsTime = new Date();</span>
<a href="#l4.16"></a><span id="l4.16">       jsTime.setHours(starthr, startmin);</span>
<a href="#l4.17"></a><span id="l4.17" class="difflineminus">-      let startstr = timeFormatter.formatTime(cal.dtz.jsDateToDateTime(jsTime, cal.dtz.floating));</span>
<a href="#l4.18"></a><span id="l4.18" class="difflineplus">+      let startstr = formatter.formatTime(cal.dtz.jsDateToDateTime(jsTime, cal.dtz.floating));</span>
<a href="#l4.19"></a><span id="l4.19">       jsTime.setHours(endhr, endmin);</span>
<a href="#l4.20"></a><span id="l4.20" class="difflineminus">-      let endstr = timeFormatter.formatTime(cal.dtz.jsDateToDateTime(jsTime, cal.dtz.floating));</span>
<a href="#l4.21"></a><span id="l4.21" class="difflineplus">+      let endstr = formatter.formatTime(cal.dtz.jsDateToDateTime(jsTime, cal.dtz.floating));</span>
<a href="#l4.22"></a><span id="l4.22"> </span>
<a href="#l4.23"></a><span id="l4.23">       // Tasks without Entry or Due date have a string as first label</span>
<a href="#l4.24"></a><span id="l4.24">       // instead of the time.</span>
<a href="#l4.25"></a><span id="l4.25">       if (cal.item.isToDo(this.mDragState.dragOccurrence)) {</span>
<a href="#l4.26"></a><span id="l4.26">         if (!this.mDragState.dragOccurrence.dueDate) {</span>
<a href="#l4.27"></a><span id="l4.27">           startstr = cal.l10n.getCalString(&quot;dragLabelTasksWithOnlyEntryDate&quot;);</span>
<a href="#l4.28"></a><span id="l4.28">         } else if (!this.mDragState.dragOccurrence.entryDate) {</span>
<a href="#l4.29"></a><span id="l4.29">           startstr = cal.l10n.getCalString(&quot;dragLabelTasksWithOnlyDueDate&quot;);</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l5.1"></a><span id="l5.1" class="difflineminus">--- a/calendar/base/content/calendar-item-bindings.js</span>
<a href="#l5.2"></a><span id="l5.2" class="difflineplus">+++ b/calendar/base/content/calendar-item-bindings.js</span>
<a href="#l5.3"></a><span id="l5.3" class="difflineat">@@ -46,22 +46,21 @@</span>
<a href="#l5.4"></a><span id="l5.4">         date = this.mItem[cal.dtz.endDateProp(this.mItem)];</span>
<a href="#l5.5"></a><span id="l5.5">       }</span>
<a href="#l5.6"></a><span id="l5.6">       let hideTextbox = date == null;</span>
<a href="#l5.7"></a><span id="l5.7">       if (hideTextbox) {</span>
<a href="#l5.8"></a><span id="l5.8">         this.style.visibility = &quot;collapse&quot;;</span>
<a href="#l5.9"></a><span id="l5.9">       } else {</span>
<a href="#l5.10"></a><span id="l5.10">         const kDefaultTimezone = cal.dtz.defaultTimezone;</span>
<a href="#l5.11"></a><span id="l5.11">         let localTime = date.getInTimezone(kDefaultTimezone);</span>
<a href="#l5.12"></a><span id="l5.12" class="difflineminus">-        let formatter = cal.getDateFormatter();</span>
<a href="#l5.13"></a><span id="l5.13" class="difflineminus">-        this.value = formatter.formatDateTime(localTime);</span>
<a href="#l5.14"></a><span id="l5.14" class="difflineplus">+        this.value = cal.dtz.formatter.formatDateTime(localTime);</span>
<a href="#l5.15"></a><span id="l5.15">         if (!date.timezone.isFloating &amp;&amp; date.timezone.tzid != kDefaultTimezone.tzid) {</span>
<a href="#l5.16"></a><span id="l5.16">           // we additionally display the original datetime with timezone</span>
<a href="#l5.17"></a><span id="l5.17">           let orgTime = cal.l10n.getCalString(&quot;datetimeWithTimezone&quot;, [</span>
<a href="#l5.18"></a><span id="l5.18" class="difflineminus">-            formatter.formatDateTime(date),</span>
<a href="#l5.19"></a><span id="l5.19" class="difflineplus">+            cal.dtz.formatter.formatDateTime(date),</span>
<a href="#l5.20"></a><span id="l5.20">             date.timezone.tzid,</span>
<a href="#l5.21"></a><span id="l5.21">           ]);</span>
<a href="#l5.22"></a><span id="l5.22">           this.value += &quot; (&quot; + orgTime + &quot;)&quot;;</span>
<a href="#l5.23"></a><span id="l5.23">         }</span>
<a href="#l5.24"></a><span id="l5.24">         this.style.visibility = &quot;visible&quot;;</span>
<a href="#l5.25"></a><span id="l5.25">       }</span>
<a href="#l5.26"></a><span id="l5.26">     }</span>
<a href="#l5.27"></a><span id="l5.27"> </span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l6.1"></a><span id="l6.1" class="difflineminus">--- a/calendar/base/content/calendar-month-view.js</span>
<a href="#l6.2"></a><span id="l6.2" class="difflineplus">+++ b/calendar/base/content/calendar-month-view.js</span>
<a href="#l6.3"></a><span id="l6.3" class="difflineat">@@ -118,17 +118,17 @@</span>
<a href="#l6.4"></a><span id="l6.4">         return val;</span>
<a href="#l6.5"></a><span id="l6.5">       }</span>
<a href="#l6.6"></a><span id="l6.6">       this.mShowMonthLabel = val;</span>
<a href="#l6.7"></a><span id="l6.7"> </span>
<a href="#l6.8"></a><span id="l6.8">       if (!this.mDate) {</span>
<a href="#l6.9"></a><span id="l6.9">         return val;</span>
<a href="#l6.10"></a><span id="l6.10">       }</span>
<a href="#l6.11"></a><span id="l6.11">       if (val) {</span>
<a href="#l6.12"></a><span id="l6.12" class="difflineminus">-        this.setAttribute(&quot;value&quot;, cal.getDateFormatter().formatDateWithoutYear(this.mDate));</span>
<a href="#l6.13"></a><span id="l6.13" class="difflineplus">+        this.setAttribute(&quot;value&quot;, cal.dtz.formatter.formatDateWithoutYear(this.mDate));</span>
<a href="#l6.14"></a><span id="l6.14">       } else {</span>
<a href="#l6.15"></a><span id="l6.15">         this.setAttribute(&quot;value&quot;, this.mDate.day);</span>
<a href="#l6.16"></a><span id="l6.16">       }</span>
<a href="#l6.17"></a><span id="l6.17">       return val;</span>
<a href="#l6.18"></a><span id="l6.18">     }</span>
<a href="#l6.19"></a><span id="l6.19"> </span>
<a href="#l6.20"></a><span id="l6.20">     setDate(aDate) {</span>
<a href="#l6.21"></a><span id="l6.21">       if (!aDate) {</span>
<a href="#l6.22"></a><span id="l6.22" class="difflineat">@@ -353,19 +353,17 @@</span>
<a href="#l6.23"></a><span id="l6.23">     }</span>
<a href="#l6.24"></a><span id="l6.24"> </span>
<a href="#l6.25"></a><span id="l6.25">     set occurrence(val) {</span>
<a href="#l6.26"></a><span id="l6.26">       cal.ASSERT(!this.mOccurrence, &quot;Code changes needed to set the occurrence twice&quot;, true);</span>
<a href="#l6.27"></a><span id="l6.27">       this.mOccurrence = val;</span>
<a href="#l6.28"></a><span id="l6.28">       if (cal.item.isEvent(val) &amp;&amp; !val.startDate.isDate) {</span>
<a href="#l6.29"></a><span id="l6.29">         let icon = this.querySelector(&quot;.calendar-item-image&quot;);</span>
<a href="#l6.30"></a><span id="l6.30">         let label = this.querySelector(&quot;.calendar-month-day-box-item-label&quot;);</span>
<a href="#l6.31"></a><span id="l6.31" class="difflineminus">-        let formatter = Cc[&quot;@mozilla.org/calendar/datetime-formatter;1&quot;].getService(</span>
<a href="#l6.32"></a><span id="l6.32" class="difflineminus">-          Ci.calIDateTimeFormatter</span>
<a href="#l6.33"></a><span id="l6.33" class="difflineminus">-        );</span>
<a href="#l6.34"></a><span id="l6.34" class="difflineplus">+        let formatter = cal.dtz.formatter;</span>
<a href="#l6.35"></a><span id="l6.35">         let timezone = this.calendarView ? this.calendarView.mTimezone : cal.dtz.defaultTimezone;</span>
<a href="#l6.36"></a><span id="l6.36">         let parentDate = this.parentBox.date;</span>
<a href="#l6.37"></a><span id="l6.37">         let parentTime = cal.createDateTime();</span>
<a href="#l6.38"></a><span id="l6.38">         parentTime.resetTo(parentDate.year, parentDate.month, parentDate.day, 0, 0, 0, timezone);</span>
<a href="#l6.39"></a><span id="l6.39">         let startTime = val.startDate.getInTimezone(timezone);</span>
<a href="#l6.40"></a><span id="l6.40">         let endTime = val.endDate.getInTimezone(timezone);</span>
<a href="#l6.41"></a><span id="l6.41">         let nextDay = parentTime.clone();</span>
<a href="#l6.42"></a><span id="l6.42">         nextDay.day++;</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l7.1"></a><span id="l7.1" class="difflineminus">--- a/calendar/base/content/calendar-multiday-base-view.js</span>
<a href="#l7.2"></a><span id="l7.2" class="difflineplus">+++ b/calendar/base/content/calendar-multiday-base-view.js</span>
<a href="#l7.3"></a><span id="l7.3" class="difflineat">@@ -134,17 +134,17 @@</span>
<a href="#l7.4"></a><span id="l7.4">     relayout() {</span>
<a href="#l7.5"></a><span id="l7.5">       const topbox = this.querySelector(&quot;.topbox&quot;);</span>
<a href="#l7.6"></a><span id="l7.6"> </span>
<a href="#l7.7"></a><span id="l7.7">       while (topbox.hasChildNodes()) {</span>
<a href="#l7.8"></a><span id="l7.8">         topbox.lastChild.remove();</span>
<a href="#l7.9"></a><span id="l7.9">       }</span>
<a href="#l7.10"></a><span id="l7.10"> </span>
<a href="#l7.11"></a><span id="l7.11">       const orient = topbox.getAttribute(&quot;orient&quot;);</span>
<a href="#l7.12"></a><span id="l7.12" class="difflineminus">-      const timeFormatter = cal.getDateFormatter();</span>
<a href="#l7.13"></a><span id="l7.13" class="difflineplus">+      const formatter = cal.dtz.formatter;</span>
<a href="#l7.14"></a><span id="l7.14">       const jsTime = new Date();</span>
<a href="#l7.15"></a><span id="l7.15"> </span>
<a href="#l7.16"></a><span id="l7.16">       this.getSections().forEach(([startMinute, duration]) =&gt; {</span>
<a href="#l7.17"></a><span id="l7.17">         const box = document.createXULElement(&quot;box&quot;);</span>
<a href="#l7.18"></a><span id="l7.18">         box.setAttribute(&quot;orient&quot;, orient);</span>
<a href="#l7.19"></a><span id="l7.19"> </span>
<a href="#l7.20"></a><span id="l7.20">         // Calculate duration pixel as the difference between</span>
<a href="#l7.21"></a><span id="l7.21">         // start pixel and end pixel to avoid rounding errors.</span>
<a href="#l7.22"></a><span id="l7.22" class="difflineat">@@ -157,17 +157,17 @@</span>
<a href="#l7.23"></a><span id="l7.23">         const hour = Math.floor(startMinute / 60);</span>
<a href="#l7.24"></a><span id="l7.24">         let timeString = &quot;&quot;;</span>
<a href="#l7.25"></a><span id="l7.25"> </span>
<a href="#l7.26"></a><span id="l7.26">         if (duration == 60) {</span>
<a href="#l7.27"></a><span id="l7.27">           jsTime.setHours(hour, 0, 0);</span>
<a href="#l7.28"></a><span id="l7.28"> </span>
<a href="#l7.29"></a><span id="l7.29">           const dateTime = cal.dtz.jsDateToDateTime(jsTime, cal.dtz.floating);</span>
<a href="#l7.30"></a><span id="l7.30"> </span>
<a href="#l7.31"></a><span id="l7.31" class="difflineminus">-          timeString = timeFormatter.formatTime(dateTime);</span>
<a href="#l7.32"></a><span id="l7.32" class="difflineplus">+          timeString = formatter.formatTime(dateTime);</span>
<a href="#l7.33"></a><span id="l7.33">         }</span>
<a href="#l7.34"></a><span id="l7.34"> </span>
<a href="#l7.35"></a><span id="l7.35">         const label = document.createXULElement(&quot;label&quot;);</span>
<a href="#l7.36"></a><span id="l7.36">         label.setAttribute(&quot;value&quot;, timeString);</span>
<a href="#l7.37"></a><span id="l7.37">         label.setAttribute(&quot;class&quot;, &quot;calendar-time-bar-label&quot;);</span>
<a href="#l7.38"></a><span id="l7.38">         label.setAttribute(&quot;align&quot;, &quot;center&quot;);</span>
<a href="#l7.39"></a><span id="l7.39">         box.appendChild(label);</span>
<a href="#l7.40"></a><span id="l7.40"> </span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l8.1"></a><span id="l8.1" class="difflineminus">--- a/calendar/base/content/calendar-task-tree-view.js</span>
<a href="#l8.2"></a><span id="l8.2" class="difflineplus">+++ b/calendar/base/content/calendar-task-tree-view.js</span>
<a href="#l8.3"></a><span id="l8.3" class="difflineat">@@ -483,14 +483,12 @@ class CalendarTaskTreeView {</span>
<a href="#l8.4"></a><span id="l8.4">   /**</span>
<a href="#l8.5"></a><span id="l8.5">    * Format a datetime object for display.</span>
<a href="#l8.6"></a><span id="l8.6">    *</span>
<a href="#l8.7"></a><span id="l8.7">    * @param {Object} dateTime    From a todo object, not a JavaScript date.</span>
<a href="#l8.8"></a><span id="l8.8">    * @return {string}            Formatted string version of the datetime (&quot;&quot; if invalid).</span>
<a href="#l8.9"></a><span id="l8.9">    */</span>
<a href="#l8.10"></a><span id="l8.10">   _formatDateTime(dateTime) {</span>
<a href="#l8.11"></a><span id="l8.11">     return dateTime &amp;&amp; dateTime.isValid</span>
<a href="#l8.12"></a><span id="l8.12" class="difflineminus">-      ? Cc[&quot;@mozilla.org/calendar/datetime-formatter;1&quot;]</span>
<a href="#l8.13"></a><span id="l8.13" class="difflineminus">-          .getService(Ci.calIDateTimeFormatter)</span>
<a href="#l8.14"></a><span id="l8.14" class="difflineminus">-          .formatDateTime(dateTime.getInTimezone(cal.dtz.defaultTimezone))</span>
<a href="#l8.15"></a><span id="l8.15" class="difflineplus">+      ? cal.dtz.formatter.formatDateTime(dateTime.getInTimezone(cal.dtz.defaultTimezone))</span>
<a href="#l8.16"></a><span id="l8.16">       : &quot;&quot;;</span>
<a href="#l8.17"></a><span id="l8.17">   }</span>
<a href="#l8.18"></a><span id="l8.18"> }</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l9.1"></a><span id="l9.1" class="difflineminus">--- a/calendar/base/content/calendar-task-view.js</span>
<a href="#l9.2"></a><span id="l9.2" class="difflineplus">+++ b/calendar/base/content/calendar-task-view.js</span>
<a href="#l9.3"></a><span id="l9.3" class="difflineat">@@ -23,19 +23,17 @@ var taskDetailsView = {</span>
<a href="#l9.4"></a><span id="l9.4">    * its the only function in taskDetailsView.</span>
<a href="#l9.5"></a><span id="l9.5">    */</span>
<a href="#l9.6"></a><span id="l9.6">   onSelect(event) {</span>
<a href="#l9.7"></a><span id="l9.7">     function displayElement(id, flag) {</span>
<a href="#l9.8"></a><span id="l9.8">       setBooleanAttribute(id, &quot;hidden&quot;, !flag);</span>
<a href="#l9.9"></a><span id="l9.9">       return flag;</span>
<a href="#l9.10"></a><span id="l9.10">     }</span>
<a href="#l9.11"></a><span id="l9.11"> </span>
<a href="#l9.12"></a><span id="l9.12" class="difflineminus">-    let dateFormatter = Cc[&quot;@mozilla.org/calendar/datetime-formatter;1&quot;].getService(</span>
<a href="#l9.13"></a><span id="l9.13" class="difflineminus">-      Ci.calIDateTimeFormatter</span>
<a href="#l9.14"></a><span id="l9.14" class="difflineminus">-    );</span>
<a href="#l9.15"></a><span id="l9.15" class="difflineplus">+    let dateFormatter = cal.dtz.formatter;</span>
<a href="#l9.16"></a><span id="l9.16"> </span>
<a href="#l9.17"></a><span id="l9.17">     let item = document.getElementById(&quot;calendar-task-tree&quot;).currentTask;</span>
<a href="#l9.18"></a><span id="l9.18">     if (</span>
<a href="#l9.19"></a><span id="l9.19">       displayElement(&quot;calendar-task-details-container&quot;, item != null) &amp;&amp;</span>
<a href="#l9.20"></a><span id="l9.20">       displayElement(&quot;calendar-task-view-splitter&quot;, item != null)</span>
<a href="#l9.21"></a><span id="l9.21">     ) {</span>
<a href="#l9.22"></a><span id="l9.22">       document.getElementById(&quot;calendar-task-details-title-row&quot;).toggleAttribute(&quot;hidden&quot;, false);</span>
<a href="#l9.23"></a><span id="l9.23">       document.getElementById(&quot;calendar-task-details-title&quot;).textContent = item.title</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l10.1"></a><span id="l10.1" class="difflineminus">--- a/calendar/base/content/calendar-unifinder.js</span>
<a href="#l10.2"></a><span id="l10.2" class="difflineplus">+++ b/calendar/base/content/calendar-unifinder.js</span>
<a href="#l10.3"></a><span id="l10.3" class="difflineat">@@ -285,17 +285,17 @@ function unifinderItemSelect(aEvent) {</span>
<a href="#l10.4"></a><span id="l10.4"> </span>
<a href="#l10.5"></a><span id="l10.5"> /**</span>
<a href="#l10.6"></a><span id="l10.6">  * Helper function to display event datetimes in the unifinder.</span>
<a href="#l10.7"></a><span id="l10.7">  *</span>
<a href="#l10.8"></a><span id="l10.8">  * @param aDatetime     A calIDateTime object to format.</span>
<a href="#l10.9"></a><span id="l10.9">  * @return              The passed date's formatted in the default timezone.</span>
<a href="#l10.10"></a><span id="l10.10">  */</span>
<a href="#l10.11"></a><span id="l10.11"> function formatUnifinderEventDateTime(aDatetime) {</span>
<a href="#l10.12"></a><span id="l10.12" class="difflineminus">-  return cal.getDateFormatter().formatDateTime(aDatetime.getInTimezone(cal.dtz.defaultTimezone));</span>
<a href="#l10.13"></a><span id="l10.13" class="difflineplus">+  return cal.dtz.formatter.formatDateTime(aDatetime.getInTimezone(cal.dtz.defaultTimezone));</span>
<a href="#l10.14"></a><span id="l10.14"> }</span>
<a href="#l10.15"></a><span id="l10.15"> </span>
<a href="#l10.16"></a><span id="l10.16"> /**</span>
<a href="#l10.17"></a><span id="l10.17">  * Handler function for double clicking the unifinder.</span>
<a href="#l10.18"></a><span id="l10.18">  *</span>
<a href="#l10.19"></a><span id="l10.19">  * @param event         The DOM doubleclick event.</span>
<a href="#l10.20"></a><span id="l10.20">  */</span>
<a href="#l10.21"></a><span id="l10.21"> function unifinderDoubleClick(event) {</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l11.1"></a><span id="l11.1" class="difflineminus">--- a/calendar/base/content/calendar-views-utils.js</span>
<a href="#l11.2"></a><span id="l11.2" class="difflineplus">+++ b/calendar/base/content/calendar-views-utils.js</span>
<a href="#l11.3"></a><span id="l11.3" class="difflineat">@@ -608,17 +608,17 @@ var calendarNavigationBar = {</span>
<a href="#l11.4"></a><span id="l11.4">   setDateRange(startDate, endDate) {</span>
<a href="#l11.5"></a><span id="l11.5">     let docTitle = &quot;&quot;;</span>
<a href="#l11.6"></a><span id="l11.6">     if (startDate) {</span>
<a href="#l11.7"></a><span id="l11.7">       let intervalLabel = document.getElementById(&quot;intervalDescription&quot;);</span>
<a href="#l11.8"></a><span id="l11.8">       let firstWeekNo = cal.getWeekInfoService().getWeekTitle(startDate);</span>
<a href="#l11.9"></a><span id="l11.9">       let secondWeekNo = firstWeekNo;</span>
<a href="#l11.10"></a><span id="l11.10">       let weekLabel = document.getElementById(&quot;calendarWeek&quot;);</span>
<a href="#l11.11"></a><span id="l11.11">       if (startDate.nativeTime == endDate.nativeTime) {</span>
<a href="#l11.12"></a><span id="l11.12" class="difflineminus">-        intervalLabel.value = cal.getDateFormatter().formatDate(startDate);</span>
<a href="#l11.13"></a><span id="l11.13" class="difflineplus">+        intervalLabel.value = cal.dtz.formatter.formatDate(startDate);</span>
<a href="#l11.14"></a><span id="l11.14">       } else {</span>
<a href="#l11.15"></a><span id="l11.15">         intervalLabel.value = currentView().getRangeDescription();</span>
<a href="#l11.16"></a><span id="l11.16">         secondWeekNo = cal.getWeekInfoService().getWeekTitle(endDate);</span>
<a href="#l11.17"></a><span id="l11.17">       }</span>
<a href="#l11.18"></a><span id="l11.18">       if (secondWeekNo == firstWeekNo) {</span>
<a href="#l11.19"></a><span id="l11.19">         weekLabel.value = cal.l10n.getCalString(&quot;singleShortCalendarWeek&quot;, [firstWeekNo]);</span>
<a href="#l11.20"></a><span id="l11.20">         weekLabel.tooltipText = cal.l10n.getCalString(&quot;singleLongCalendarWeek&quot;, [firstWeekNo]);</span>
<a href="#l11.21"></a><span id="l11.21">       } else {</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l12.1"></a><span id="l12.1" class="difflineminus">--- a/calendar/base/content/dialogs/calendar-event-dialog-attendees-custom-elements.js</span>
<a href="#l12.2"></a><span id="l12.2" class="difflineplus">+++ b/calendar/base/content/dialogs/calendar-event-dialog-attendees-custom-elements.js</span>
<a href="#l12.3"></a><span id="l12.3" class="difflineat">@@ -1519,19 +1519,17 @@</span>
<a href="#l12.4"></a><span id="l12.4">      */</span>
<a href="#l12.5"></a><span id="l12.5">     onLoad() {</span>
<a href="#l12.6"></a><span id="l12.6">       let numHours = this.endHour - this.startHour;</span>
<a href="#l12.7"></a><span id="l12.7">       this.state = new Array(this.range * numHours);</span>
<a href="#l12.8"></a><span id="l12.8">       for (let i = 0; i &lt; this.state.length; i++) {</span>
<a href="#l12.9"></a><span id="l12.9">         this.state[i] = Ci.calIFreeBusyInterval.UNKNOWN;</span>
<a href="#l12.10"></a><span id="l12.10">       }</span>
<a href="#l12.11"></a><span id="l12.11">       let step_in_minutes = Math.floor((60 * this.zoomFactor) / 100);</span>
<a href="#l12.12"></a><span id="l12.12" class="difflineminus">-      let formatter = Cc[&quot;@mozilla.org/calendar/datetime-formatter;1&quot;].getService(</span>
<a href="#l12.13"></a><span id="l12.13" class="difflineminus">-        Ci.calIDateTimeFormatter</span>
<a href="#l12.14"></a><span id="l12.14" class="difflineminus">-      );</span>
<a href="#l12.15"></a><span id="l12.15" class="difflineplus">+      let formatter = cal.dtz.formatter;</span>
<a href="#l12.16"></a><span id="l12.16">       let date = cal.dtz.jsDateToDateTime(new Date());</span>
<a href="#l12.17"></a><span id="l12.17">       date.hour = this.startHour;</span>
<a href="#l12.18"></a><span id="l12.18">       date.minute = 0;</span>
<a href="#l12.19"></a><span id="l12.19">       if (this.hoursNode.children.length &lt;= 0) {</span>
<a href="#l12.20"></a><span id="l12.20">         let template = document.createXULElement(&quot;label&quot;);</span>
<a href="#l12.21"></a><span id="l12.21">         template.className = &quot;freebusy-grid&quot;;</span>
<a href="#l12.22"></a><span id="l12.22">         // TODO: hardcoded value</span>
<a href="#l12.23"></a><span id="l12.23">         let num_days = Math.max(2, (4 * this.zoomFactor) / 100);</span>
<a href="#l12.24"></a><span id="l12.24" class="difflineat">@@ -1898,47 +1896,40 @@</span>
<a href="#l12.25"></a><span id="l12.25">      * @param {calIDateTime} val        Date object to be modified</span>
<a href="#l12.26"></a><span id="l12.26">      * @returns {calIDateTime}          Modified date object</span>
<a href="#l12.27"></a><span id="l12.27">      */</span>
<a href="#l12.28"></a><span id="l12.28">     set date(val) {</span>
<a href="#l12.29"></a><span id="l12.29">       if (val == null) {</span>
<a href="#l12.30"></a><span id="l12.30">         return null;</span>
<a href="#l12.31"></a><span id="l12.31">       }</span>
<a href="#l12.32"></a><span id="l12.32"> </span>
<a href="#l12.33"></a><span id="l12.33" class="difflineplus">+      let formatter = cal.dtz.formatter;</span>
<a href="#l12.34"></a><span id="l12.34">       let date = val.clone();</span>
<a href="#l12.35"></a><span id="l12.35">       date.hour = 0;</span>
<a href="#l12.36"></a><span id="l12.36">       date.minute = 0;</span>
<a href="#l12.37"></a><span id="l12.37">       date.isDate = false;</span>
<a href="#l12.38"></a><span id="l12.38"> </span>
<a href="#l12.39"></a><span id="l12.39" class="difflineminus">-      if (!this.dateFormatter) {</span>
<a href="#l12.40"></a><span id="l12.40" class="difflineminus">-        this.dateFormatter = Cc[&quot;@mozilla.org/calendar/datetime-formatter;1&quot;].getService(</span>
<a href="#l12.41"></a><span id="l12.41" class="difflineminus">-          Ci.calIDateTimeFormatter</span>
<a href="#l12.42"></a><span id="l12.42" class="difflineminus">-        );</span>
<a href="#l12.43"></a><span id="l12.43" class="difflineminus">-      }</span>
<a href="#l12.44"></a><span id="l12.44" class="difflineminus">-</span>
<a href="#l12.45"></a><span id="l12.45">       // First set the formatted date string as title</span>
<a href="#l12.46"></a><span id="l12.46">       let dateValue =</span>
<a href="#l12.47"></a><span id="l12.47" class="difflineminus">-        this.zoomFactor &gt; 100</span>
<a href="#l12.48"></a><span id="l12.48" class="difflineminus">-          ? this.dateFormatter.formatDateShort(date)</span>
<a href="#l12.49"></a><span id="l12.49" class="difflineminus">-          : this.dateFormatter.formatDateLong(date);</span>
<a href="#l12.50"></a><span id="l12.50" class="difflineplus">+        this.zoomFactor &gt; 100 ? formatter.formatDateShort(date) : formatter.formatDateLong(date);</span>
<a href="#l12.51"></a><span id="l12.51">       this.text.setAttribute(&quot;value&quot;, dateValue);</span>
<a href="#l12.52"></a><span id="l12.52"> </span>
<a href="#l12.53"></a><span id="l12.53">       // Now create as many 'hour' elements as needed</span>
<a href="#l12.54"></a><span id="l12.54">       let step_in_minutes = Math.floor((60 * this.zoomFactor) / 100);</span>
<a href="#l12.55"></a><span id="l12.55">       let hours = this.box;</span>
<a href="#l12.56"></a><span id="l12.56">       date.hour = this.startHour;</span>
<a href="#l12.57"></a><span id="l12.57">       if (hours.children.length &lt;= 0) {</span>
<a href="#l12.58"></a><span id="l12.58">         let template = document.createXULElement(&quot;label&quot;);</span>
<a href="#l12.59"></a><span id="l12.59">         template.className = &quot;freebusy-timebar-hour&quot;;</span>
<a href="#l12.60"></a><span id="l12.60">         let count = Math.ceil(((this.endHour - this.startHour) * 60) / step_in_minutes);</span>
<a href="#l12.61"></a><span id="l12.61">         let remain = count;</span>
<a href="#l12.62"></a><span id="l12.62">         let first = true;</span>
<a href="#l12.63"></a><span id="l12.63">         while (remain--) {</span>
<a href="#l12.64"></a><span id="l12.64">           let newNode = template.cloneNode(false);</span>
<a href="#l12.65"></a><span id="l12.65" class="difflineminus">-          let value = this.dateFormatter.formatTime(date);</span>
<a href="#l12.66"></a><span id="l12.66" class="difflineplus">+          let value = formatter.formatTime(date);</span>
<a href="#l12.67"></a><span id="l12.67">           if (first) {</span>
<a href="#l12.68"></a><span id="l12.68">             newNode.classList.add(&quot;first-in-day&quot;);</span>
<a href="#l12.69"></a><span id="l12.69">             first = false;</span>
<a href="#l12.70"></a><span id="l12.70">           }</span>
<a href="#l12.71"></a><span id="l12.71">           newNode.setAttribute(&quot;value&quot;, value);</span>
<a href="#l12.72"></a><span id="l12.72">           hours.appendChild(newNode);</span>
<a href="#l12.73"></a><span id="l12.73">           date.minute += step_in_minutes;</span>
<a href="#l12.74"></a><span id="l12.74"> </span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l13.1"></a><span id="l13.1" class="difflineminus">--- a/calendar/base/content/dialogs/calendar-invitations-dialog.js</span>
<a href="#l13.2"></a><span id="l13.2" class="difflineplus">+++ b/calendar/base/content/dialogs/calendar-invitations-dialog.js</span>
<a href="#l13.3"></a><span id="l13.3" class="difflineat">@@ -11,21 +11,19 @@ var { cal } = ChromeUtils.import(&quot;resour</span>
<a href="#l13.4"></a><span id="l13.4"> // Wrap in a block to prevent leaking to window scope.</span>
<a href="#l13.5"></a><span id="l13.5"> {</span>
<a href="#l13.6"></a><span id="l13.6">   const { Services } = ChromeUtils.import(&quot;resource://gre/modules/Services.jsm&quot;);</span>
<a href="#l13.7"></a><span id="l13.7"> </span>
<a href="#l13.8"></a><span id="l13.8">   class MozCalendarInvitationsRichlistitem extends MozElements.MozRichlistitem {</span>
<a href="#l13.9"></a><span id="l13.9">     constructor() {</span>
<a href="#l13.10"></a><span id="l13.10">       super();</span>
<a href="#l13.11"></a><span id="l13.11"> </span>
<a href="#l13.12"></a><span id="l13.12" class="difflineminus">-      this.mDateFormatter = null;</span>
<a href="#l13.13"></a><span id="l13.13">       this.mCalendarItem = null;</span>
<a href="#l13.14"></a><span id="l13.14">       this.mInitialParticipationStatus = null;</span>
<a href="#l13.15"></a><span id="l13.15">       this.mParticipationStatus = null;</span>
<a href="#l13.16"></a><span id="l13.16" class="difflineminus">-      this.mDateFormatter = cal.getDateFormatter();</span>
<a href="#l13.17"></a><span id="l13.17">       this.calInvitationsProps = Services.strings.createBundle(</span>
<a href="#l13.18"></a><span id="l13.18">         &quot;chrome://calendar/locale/calendar-invitations-dialog.properties&quot;</span>
<a href="#l13.19"></a><span id="l13.19">       );</span>
<a href="#l13.20"></a><span id="l13.20">     }</span>
<a href="#l13.21"></a><span id="l13.21"> </span>
<a href="#l13.22"></a><span id="l13.22">     getString(propName) {</span>
<a href="#l13.23"></a><span id="l13.23">       return this.calInvitationsProps.GetStringFromName(propName);</span>
<a href="#l13.24"></a><span id="l13.24">     }</span>
<a href="#l13.25"></a><span id="l13.25" class="difflineat">@@ -106,17 +104,17 @@ var { cal } = ChromeUtils.import(&quot;resour</span>
<a href="#l13.26"></a><span id="l13.26">       this.mCalendarItem = item;</span>
<a href="#l13.27"></a><span id="l13.27">       this.mInitialParticipationStatus = this.getCalendarItemParticipationStatus(item);</span>
<a href="#l13.28"></a><span id="l13.28">       this.participationStatus = this.mInitialParticipationStatus;</span>
<a href="#l13.29"></a><span id="l13.29"> </span>
<a href="#l13.30"></a><span id="l13.30">       let titleLabel = this.querySelector(&quot;.calendar-invitations-richlistitem-title&quot;);</span>
<a href="#l13.31"></a><span id="l13.31">       titleLabel.setAttribute(&quot;value&quot;, item.title);</span>
<a href="#l13.32"></a><span id="l13.32"> </span>
<a href="#l13.33"></a><span id="l13.33">       let dateLabel = this.querySelector(&quot;.calendar-invitations-richlistitem-date&quot;);</span>
<a href="#l13.34"></a><span id="l13.34" class="difflineminus">-      let dateString = this.mDateFormatter.formatItemInterval(item);</span>
<a href="#l13.35"></a><span id="l13.35" class="difflineplus">+      let dateString = cal.dtz.formatter.formatItemInterval(item);</span>
<a href="#l13.36"></a><span id="l13.36">       if (item.startDate.isDate) {</span>
<a href="#l13.37"></a><span id="l13.37">         dateString += &quot;, &quot; + this.getString(&quot;alldayEvent&quot;);</span>
<a href="#l13.38"></a><span id="l13.38">       }</span>
<a href="#l13.39"></a><span id="l13.39">       dateLabel.setAttribute(&quot;value&quot;, dateString);</span>
<a href="#l13.40"></a><span id="l13.40"> </span>
<a href="#l13.41"></a><span id="l13.41">       let recurrenceLabel = this.querySelector(&quot;.calendar-invitations-richlistitem-recurrence&quot;);</span>
<a href="#l13.42"></a><span id="l13.42">       if (item.recurrenceInfo) {</span>
<a href="#l13.43"></a><span id="l13.43">         recurrenceLabel.setAttribute(&quot;value&quot;, this.getString(&quot;recurrentEvent&quot;));</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l14.1"></a><span id="l14.1" class="difflineminus">--- a/calendar/base/content/preferences/general.js</span>
<a href="#l14.2"></a><span id="l14.2" class="difflineplus">+++ b/calendar/base/content/preferences/general.js</span>
<a href="#l14.3"></a><span id="l14.3" class="difflineat">@@ -28,20 +28,17 @@ Preferences.addAll([</span>
<a href="#l14.4"></a><span id="l14.4">  * Global Object to hold methods for the general pref pane</span>
<a href="#l14.5"></a><span id="l14.5">  */</span>
<a href="#l14.6"></a><span id="l14.6"> var gCalendarGeneralPane = {</span>
<a href="#l14.7"></a><span id="l14.7">   /**</span>
<a href="#l14.8"></a><span id="l14.8">    * Initialize the general pref pane. Sets up dialog controls to match the</span>
<a href="#l14.9"></a><span id="l14.9">    * values set in prefs.</span>
<a href="#l14.10"></a><span id="l14.10">    */</span>
<a href="#l14.11"></a><span id="l14.11">   init() {</span>
<a href="#l14.12"></a><span id="l14.12" class="difflineminus">-    let formatter = Cc[&quot;@mozilla.org/calendar/datetime-formatter;1&quot;].getService(</span>
<a href="#l14.13"></a><span id="l14.13" class="difflineminus">-      Ci.calIDateTimeFormatter</span>
<a href="#l14.14"></a><span id="l14.14" class="difflineminus">-    );</span>
<a href="#l14.15"></a><span id="l14.15" class="difflineminus">-</span>
<a href="#l14.16"></a><span id="l14.16" class="difflineplus">+    let formatter = cal.dtz.formatter;</span>
<a href="#l14.17"></a><span id="l14.17">     let dateFormattedLong = formatter.formatDateLong(cal.dtz.now());</span>
<a href="#l14.18"></a><span id="l14.18">     let dateFormattedShort = formatter.formatDateShort(cal.dtz.now());</span>
<a href="#l14.19"></a><span id="l14.19"> </span>
<a href="#l14.20"></a><span id="l14.20">     // menu items include examples of current date formats.</span>
<a href="#l14.21"></a><span id="l14.21">     document</span>
<a href="#l14.22"></a><span id="l14.22">       .getElementById(&quot;dateformat-long-menuitem&quot;)</span>
<a href="#l14.23"></a><span id="l14.23">       .setAttribute(&quot;label&quot;, labelLong + &quot;: &quot; + dateFormattedLong);</span>
<a href="#l14.24"></a><span id="l14.24">     document</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l15.1"></a><span id="l15.1" class="difflineminus">--- a/calendar/base/content/preferences/views.js</span>
<a href="#l15.2"></a><span id="l15.2" class="difflineplus">+++ b/calendar/base/content/preferences/views.js</span>
<a href="#l15.3"></a><span id="l15.3" class="difflineat">@@ -41,25 +41,24 @@ var gViewsPane = {</span>
<a href="#l15.4"></a><span id="l15.4"> </span>
<a href="#l15.5"></a><span id="l15.5">   /**</span>
<a href="#l15.6"></a><span id="l15.6">    * Initialize the strings for the  &quot;day starts at&quot; and &quot;day ends at&quot;</span>
<a href="#l15.7"></a><span id="l15.7">    * menulists. This is needed to respect locales that use AM/PM.</span>
<a href="#l15.8"></a><span id="l15.8">    */</span>
<a href="#l15.9"></a><span id="l15.9">   initializeViewStartEndMenus() {</span>
<a href="#l15.10"></a><span id="l15.10">     const { cal } = ChromeUtils.import(&quot;resource:///modules/calendar/calUtils.jsm&quot;);</span>
<a href="#l15.11"></a><span id="l15.11"> </span>
<a href="#l15.12"></a><span id="l15.12" class="difflineplus">+    let formatter = cal.dtz.formatter;</span>
<a href="#l15.13"></a><span id="l15.13">     let calTime = cal.createDateTime();</span>
<a href="#l15.14"></a><span id="l15.14">     calTime.minute = 0;</span>
<a href="#l15.15"></a><span id="l15.15"> </span>
<a href="#l15.16"></a><span id="l15.16" class="difflineminus">-    let timeFormatter = cal.getDateFormatter();</span>
<a href="#l15.17"></a><span id="l15.17" class="difflineminus">-</span>
<a href="#l15.18"></a><span id="l15.18">     // 1 to 23 instead of 0 to 24 to keep midnight &amp; noon as the localized strings</span>
<a href="#l15.19"></a><span id="l15.19">     for (let theHour = 1; theHour &lt;= 23; theHour++) {</span>
<a href="#l15.20"></a><span id="l15.20">       calTime.hour = theHour;</span>
<a href="#l15.21"></a><span id="l15.21" class="difflineminus">-      let time = timeFormatter.formatTime(calTime);</span>
<a href="#l15.22"></a><span id="l15.22" class="difflineplus">+      let time = formatter.formatTime(calTime);</span>
<a href="#l15.23"></a><span id="l15.23"> </span>
<a href="#l15.24"></a><span id="l15.24">       let labelIdStart = &quot;timeStart&quot; + theHour;</span>
<a href="#l15.25"></a><span id="l15.25">       let labelIdEnd = &quot;timeEnd&quot; + theHour;</span>
<a href="#l15.26"></a><span id="l15.26">       // This if block to keep Noon as the localized string, instead of as a number.</span>
<a href="#l15.27"></a><span id="l15.27">       if (theHour != 12) {</span>
<a href="#l15.28"></a><span id="l15.28">         document.getElementById(labelIdStart).setAttribute(&quot;label&quot;, time);</span>
<a href="#l15.29"></a><span id="l15.29">         document.getElementById(labelIdEnd).setAttribute(&quot;label&quot;, time);</span>
<a href="#l15.30"></a><span id="l15.30">       }</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l16.1"></a><span id="l16.1" class="difflineminus">--- a/calendar/base/content/today-pane.js</span>
<a href="#l16.2"></a><span id="l16.2" class="difflineplus">+++ b/calendar/base/content/today-pane.js</span>
<a href="#l16.3"></a><span id="l16.3" class="difflineat">@@ -406,17 +406,17 @@ var TodayPane = {</span>
<a href="#l16.4"></a><span id="l16.4">     // to avoid its selectedIndex being reset to the wrong value.</span>
<a href="#l16.5"></a><span id="l16.5">     setTimeout(() =&gt; {</span>
<a href="#l16.6"></a><span id="l16.6">       let weekdaylabel = document.getElementById(&quot;weekdayNameContainer&quot;);</span>
<a href="#l16.7"></a><span id="l16.7">       weekdaylabel.selectedIndex = this.start.weekday;</span>
<a href="#l16.8"></a><span id="l16.8">     }, 0);</span>
<a href="#l16.9"></a><span id="l16.9"> </span>
<a href="#l16.10"></a><span id="l16.10">     let monthnamelabel = document.getElementById(&quot;monthNameContainer&quot;);</span>
<a href="#l16.11"></a><span id="l16.11">     monthnamelabel.value =</span>
<a href="#l16.12"></a><span id="l16.12" class="difflineminus">-      cal.getDateFormatter().shortMonthName(this.start.month) + &quot; &quot; + this.start.year;</span>
<a href="#l16.13"></a><span id="l16.13" class="difflineplus">+      cal.dtz.formatter.shortMonthName(this.start.month) + &quot; &quot; + this.start.year;</span>
<a href="#l16.14"></a><span id="l16.14"> </span>
<a href="#l16.15"></a><span id="l16.15">     let currentweeklabel = document.getElementById(&quot;currentWeek-label&quot;);</span>
<a href="#l16.16"></a><span id="l16.16">     currentweeklabel.value =</span>
<a href="#l16.17"></a><span id="l16.17">       cal.l10n.getCalString(&quot;shortcalendarweek&quot;) +</span>
<a href="#l16.18"></a><span id="l16.18">       &quot; &quot; +</span>
<a href="#l16.19"></a><span id="l16.19">       cal.getWeekInfoService().getWeekTitle(this.start);</span>
<a href="#l16.20"></a><span id="l16.20"> </span>
<a href="#l16.21"></a><span id="l16.21">     if (!aDontUpdateMinimonth) {</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l17.1"></a><span id="l17.1" class="difflineminus">--- a/calendar/base/content/widgets/calendar-alarm-widget.js</span>
<a href="#l17.2"></a><span id="l17.2" class="difflineplus">+++ b/calendar/base/content/widgets/calendar-alarm-widget.js</span>
<a href="#l17.3"></a><span id="l17.3" class="difflineat">@@ -88,17 +88,17 @@</span>
<a href="#l17.4"></a><span id="l17.4">     /**</span>
<a href="#l17.5"></a><span id="l17.5">      * Refresh UI text (dates, titles, locations) when the data has changed.</span>
<a href="#l17.6"></a><span id="l17.6">      */</span>
<a href="#l17.7"></a><span id="l17.7">     updateLabels() {</span>
<a href="#l17.8"></a><span id="l17.8">       if (!this.mItem || !this.mAlarm) {</span>
<a href="#l17.9"></a><span id="l17.9">         // Setup not complete, do nothing for now.</span>
<a href="#l17.10"></a><span id="l17.10">         return;</span>
<a href="#l17.11"></a><span id="l17.11">       }</span>
<a href="#l17.12"></a><span id="l17.12" class="difflineminus">-      const formatter = cal.getDateFormatter();</span>
<a href="#l17.13"></a><span id="l17.13" class="difflineplus">+      const formatter = cal.dtz.formatter;</span>
<a href="#l17.14"></a><span id="l17.14">       let titleLabel = this.querySelector(&quot;.alarm-title-label&quot;);</span>
<a href="#l17.15"></a><span id="l17.15">       let locationDescription = this.querySelector(&quot;.alarm-location-description&quot;);</span>
<a href="#l17.16"></a><span id="l17.16">       let dateLabel = this.querySelector(&quot;.alarm-date-label&quot;);</span>
<a href="#l17.17"></a><span id="l17.17"> </span>
<a href="#l17.18"></a><span id="l17.18">       // Dates</span>
<a href="#l17.19"></a><span id="l17.19">       if (cal.item.isEvent(this.mItem)) {</span>
<a href="#l17.20"></a><span id="l17.20">         dateLabel.value = formatter.formatItemInterval(this.mItem);</span>
<a href="#l17.21"></a><span id="l17.21">       } else if (cal.item.isToDo(this.mItem)) {</span>
<a href="#l17.22"></a><span id="l17.22" class="difflineat">@@ -141,17 +141,17 @@</span>
<a href="#l17.23"></a><span id="l17.23">         snoozeButton.removeAttribute(&quot;tooltiptext&quot;);</span>
<a href="#l17.24"></a><span id="l17.24">       }</span>
<a href="#l17.25"></a><span id="l17.25">     }</span>
<a href="#l17.26"></a><span id="l17.26"> </span>
<a href="#l17.27"></a><span id="l17.27">     /**</span>
<a href="#l17.28"></a><span id="l17.28">      * Refresh UI text for relative date when the data has changed.</span>
<a href="#l17.29"></a><span id="l17.29">      */</span>
<a href="#l17.30"></a><span id="l17.30">     updateRelativeDateLabel() {</span>
<a href="#l17.31"></a><span id="l17.31" class="difflineminus">-      const formatter = cal.getDateFormatter();</span>
<a href="#l17.32"></a><span id="l17.32" class="difflineplus">+      const formatter = cal.dtz.formatter;</span>
<a href="#l17.33"></a><span id="l17.33">       const item = this.mItem;</span>
<a href="#l17.34"></a><span id="l17.34">       let relativeDateLabel = this.querySelector(&quot;.alarm-relative-date-label&quot;);</span>
<a href="#l17.35"></a><span id="l17.35">       let relativeDateString;</span>
<a href="#l17.36"></a><span id="l17.36">       let startDate = item[cal.dtz.startDateProp(item)] || item[cal.dtz.endDateProp(item)];</span>
<a href="#l17.37"></a><span id="l17.37"> </span>
<a href="#l17.38"></a><span id="l17.38">       if (startDate) {</span>
<a href="#l17.39"></a><span id="l17.39">         startDate = startDate.getInTimezone(cal.dtz.defaultTimezone);</span>
<a href="#l17.40"></a><span id="l17.40">         let currentDate = cal.dtz.now();</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l18.1"></a><span id="l18.1" class="difflineminus">--- a/calendar/base/modules/calRecurrenceUtils.jsm</span>
<a href="#l18.2"></a><span id="l18.2" class="difflineplus">+++ b/calendar/base/modules/calRecurrenceUtils.jsm</span>
<a href="#l18.3"></a><span id="l18.3" class="difflineat">@@ -67,17 +67,17 @@ function recurrenceRule2String(recurrenc</span>
<a href="#l18.4"></a><span id="l18.4">       /* &quot;BYMONTHDAY&quot;, */</span>
<a href="#l18.5"></a><span id="l18.5">       &quot;BYYEARDAY&quot;,</span>
<a href="#l18.6"></a><span id="l18.6">       &quot;BYWEEKNO&quot;,</span>
<a href="#l18.7"></a><span id="l18.7">       /* &quot;BYMONTH&quot;, */</span>
<a href="#l18.8"></a><span id="l18.8">       &quot;BYSETPOS&quot;,</span>
<a href="#l18.9"></a><span id="l18.9">     ];</span>
<a href="#l18.10"></a><span id="l18.10"> </span>
<a href="#l18.11"></a><span id="l18.11">     if (rule &amp;&amp; !checkRecurrenceRule(rule, byparts)) {</span>
<a href="#l18.12"></a><span id="l18.12" class="difflineminus">-      let dateFormatter = cal.getDateFormatter();</span>
<a href="#l18.13"></a><span id="l18.13" class="difflineplus">+      let dateFormatter = cal.dtz.formatter;</span>
<a href="#l18.14"></a><span id="l18.14">       let ruleString;</span>
<a href="#l18.15"></a><span id="l18.15">       if (rule.type == &quot;DAILY&quot;) {</span>
<a href="#l18.16"></a><span id="l18.16">         if (checkRecurrenceRule(rule, [&quot;BYDAY&quot;])) {</span>
<a href="#l18.17"></a><span id="l18.17">           let days = rule.getComponent(&quot;BYDAY&quot;);</span>
<a href="#l18.18"></a><span id="l18.18">           let weekdays = [2, 3, 4, 5, 6];</span>
<a href="#l18.19"></a><span id="l18.19">           if (weekdays.length == days.length) {</span>
<a href="#l18.20"></a><span id="l18.20">             let i;</span>
<a href="#l18.21"></a><span id="l18.21">             for (i = 0; i &lt; weekdays.length; i++) {</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l19.1"></a><span id="l19.1" class="difflineminus">--- a/calendar/base/modules/calUtils.jsm</span>
<a href="#l19.2"></a><span id="l19.2" class="difflineplus">+++ b/calendar/base/modules/calUtils.jsm</span>
<a href="#l19.3"></a><span id="l19.3" class="difflineat">@@ -59,17 +59,16 @@ var cal = {</span>
<a href="#l19.4"></a><span id="l19.4">   getIcsService: _service(&quot;@mozilla.org/calendar/ics-service;1&quot;, &quot;calIICSService&quot;),</span>
<a href="#l19.5"></a><span id="l19.5">   getTimezoneService: _service(&quot;@mozilla.org/calendar/timezone-service;1&quot;, &quot;calITimezoneService&quot;),</span>
<a href="#l19.6"></a><span id="l19.6">   getCalendarSearchService: _service(</span>
<a href="#l19.7"></a><span id="l19.7">     &quot;@mozilla.org/calendar/calendarsearch-service;1&quot;,</span>
<a href="#l19.8"></a><span id="l19.8">     &quot;calICalendarSearchProvider&quot;</span>
<a href="#l19.9"></a><span id="l19.9">   ),</span>
<a href="#l19.10"></a><span id="l19.10">   getFreeBusyService: _service(&quot;@mozilla.org/calendar/freebusy-service;1&quot;, &quot;calIFreeBusyService&quot;),</span>
<a href="#l19.11"></a><span id="l19.11">   getWeekInfoService: _service(&quot;@mozilla.org/calendar/weekinfo-service;1&quot;, &quot;calIWeekInfoService&quot;),</span>
<a href="#l19.12"></a><span id="l19.12" class="difflineminus">-  getDateFormatter: _service(&quot;@mozilla.org/calendar/datetime-formatter;1&quot;, &quot;calIDateTimeFormatter&quot;),</span>
<a href="#l19.13"></a><span id="l19.13">   getDragService: _service(&quot;@mozilla.org/widget/dragservice;1&quot;, &quot;nsIDragService&quot;),</span>
<a href="#l19.14"></a><span id="l19.14"> </span>
<a href="#l19.15"></a><span id="l19.15">   /**</span>
<a href="#l19.16"></a><span id="l19.16">    * The calendar console instance</span>
<a href="#l19.17"></a><span id="l19.17">    */</span>
<a href="#l19.18"></a><span id="l19.18">   console: gCalendarConsole,</span>
<a href="#l19.19"></a><span id="l19.19"> </span>
<a href="#l19.20"></a><span id="l19.20">   /**</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l20.1"></a><span id="l20.1" class="difflineminus">--- a/calendar/base/modules/moz.build</span>
<a href="#l20.2"></a><span id="l20.2" class="difflineplus">+++ b/calendar/base/modules/moz.build</span>
<a href="#l20.3"></a><span id="l20.3" class="difflineat">@@ -5,16 +5,17 @@</span>
<a href="#l20.4"></a><span id="l20.4"> </span>
<a href="#l20.5"></a><span id="l20.5"> EXTRA_JS_MODULES.calendar.utils += [</span>
<a href="#l20.6"></a><span id="l20.6">     'utils/calACLUtils.jsm',</span>
<a href="#l20.7"></a><span id="l20.7">     'utils/calAlarmUtils.jsm',</span>
<a href="#l20.8"></a><span id="l20.8">     'utils/calAsyncUtils.jsm',</span>
<a href="#l20.9"></a><span id="l20.9">     'utils/calAuthUtils.jsm',</span>
<a href="#l20.10"></a><span id="l20.10">     'utils/calCategoryUtils.jsm',</span>
<a href="#l20.11"></a><span id="l20.11">     'utils/calDataUtils.jsm',</span>
<a href="#l20.12"></a><span id="l20.12" class="difflineplus">+    'utils/calDateTimeFormatter.jsm',</span>
<a href="#l20.13"></a><span id="l20.13">     'utils/calDateTimeUtils.jsm',</span>
<a href="#l20.14"></a><span id="l20.14">     'utils/calEmailUtils.jsm',</span>
<a href="#l20.15"></a><span id="l20.15">     'utils/calItemUtils.jsm',</span>
<a href="#l20.16"></a><span id="l20.16">     'utils/calIteratorUtils.jsm',</span>
<a href="#l20.17"></a><span id="l20.17">     'utils/calItipUtils.jsm',</span>
<a href="#l20.18"></a><span id="l20.18">     'utils/calL10NUtils.jsm',</span>
<a href="#l20.19"></a><span id="l20.19">     'utils/calPrintUtils.jsm',</span>
<a href="#l20.20"></a><span id="l20.20">     'utils/calProviderUtils.jsm',</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l21.1"></a><span id="l21.1">rename from calendar/base/src/CalDateTimeFormatter.jsm</span>
<a href="#l21.2"></a><span id="l21.2">rename to calendar/base/modules/utils/calDateTimeFormatter.jsm</span>
<a href="#l21.3"></a><span id="l21.3" class="difflineminus">--- a/calendar/base/src/CalDateTimeFormatter.jsm</span>
<a href="#l21.4"></a><span id="l21.4" class="difflineplus">+++ b/calendar/base/modules/utils/calDateTimeFormatter.jsm</span>
<a href="#l21.5"></a><span id="l21.5" class="difflineat">@@ -1,90 +1,114 @@</span>
<a href="#l21.6"></a><span id="l21.6"> /* This Source Code Form is subject to the terms of the Mozilla Public</span>
<a href="#l21.7"></a><span id="l21.7">  * License, v. 2.0. If a copy of the MPL was not distributed with this</span>
<a href="#l21.8"></a><span id="l21.8">  * file, You can obtain one at http://mozilla.org/MPL/2.0/. */</span>
<a href="#l21.9"></a><span id="l21.9"> </span>
<a href="#l21.10"></a><span id="l21.10" class="difflineminus">-var EXPORTED_SYMBOLS = [&quot;CalDateTimeFormatter&quot;];</span>
<a href="#l21.11"></a><span id="l21.11" class="difflineplus">+var { Services } = ChromeUtils.import(&quot;resource://gre/modules/Services.jsm&quot;);</span>
<a href="#l21.12"></a><span id="l21.12" class="difflineplus">+var { XPCOMUtils } = ChromeUtils.import(&quot;resource://gre/modules/XPCOMUtils.jsm&quot;);</span>
<a href="#l21.13"></a><span id="l21.13" class="difflineplus">+</span>
<a href="#l21.14"></a><span id="l21.14" class="difflineplus">+ChromeUtils.defineModuleGetter(this, &quot;cal&quot;, &quot;resource:///modules/calendar/calUtils.jsm&quot;);</span>
<a href="#l21.15"></a><span id="l21.15"> </span>
<a href="#l21.16"></a><span id="l21.16" class="difflineminus">-var { Services } = ChromeUtils.import(&quot;resource://gre/modules/Services.jsm&quot;);</span>
<a href="#l21.17"></a><span id="l21.17" class="difflineminus">-var { cal } = ChromeUtils.import(&quot;resource:///modules/calendar/calUtils.jsm&quot;);</span>
<a href="#l21.18"></a><span id="l21.18" class="difflineplus">+XPCOMUtils.defineLazyGetter(this, &quot;gDateStringBundle&quot;, () =&gt;</span>
<a href="#l21.19"></a><span id="l21.19" class="difflineplus">+  Services.strings.createBundle(&quot;chrome://calendar/locale/dateFormat.properties&quot;)</span>
<a href="#l21.20"></a><span id="l21.20" class="difflineplus">+);</span>
<a href="#l21.21"></a><span id="l21.21" class="difflineplus">+</span>
<a href="#l21.22"></a><span id="l21.22" class="difflineplus">+/*</span>
<a href="#l21.23"></a><span id="l21.23" class="difflineplus">+ * Date time formatting functions for display.</span>
<a href="#l21.24"></a><span id="l21.24" class="difflineplus">+ */</span>
<a href="#l21.25"></a><span id="l21.25"> </span>
<a href="#l21.26"></a><span id="l21.26" class="difflineminus">-function CalDateTimeFormatter() {</span>
<a href="#l21.27"></a><span id="l21.27" class="difflineminus">-  this.wrappedJSObject = this;</span>
<a href="#l21.28"></a><span id="l21.28" class="difflineminus">-  this.mDateStringBundle = Services.strings.createBundle(</span>
<a href="#l21.29"></a><span id="l21.29" class="difflineminus">-    &quot;chrome://calendar/locale/dateFormat.properties&quot;</span>
<a href="#l21.30"></a><span id="l21.30" class="difflineminus">-  );</span>
<a href="#l21.31"></a><span id="l21.31" class="difflineminus">-}</span>
<a href="#l21.32"></a><span id="l21.32" class="difflineminus">-CalDateTimeFormatter.prototype = {</span>
<a href="#l21.33"></a><span id="l21.33" class="difflineminus">-  QueryInterface: ChromeUtils.generateQI([Ci.calIDateTimeFormatter]),</span>
<a href="#l21.34"></a><span id="l21.34" class="difflineminus">-  classID: Components.ID(&quot;{4123da9a-f047-42da-a7d0-cc4175b9f36a}&quot;),</span>
<a href="#l21.35"></a><span id="l21.35" class="difflineplus">+// NOTE: This module should not be loaded directly, it is available when</span>
<a href="#l21.36"></a><span id="l21.36" class="difflineplus">+// including calUtils.jsm under the cal.dtz.formatter namespace.</span>
<a href="#l21.37"></a><span id="l21.37" class="difflineplus">+</span>
<a href="#l21.38"></a><span id="l21.38" class="difflineplus">+const EXPORTED_SYMBOLS = [&quot;formatter&quot;]; /* exported formatter */</span>
<a href="#l21.39"></a><span id="l21.39"> </span>
<a href="#l21.40"></a><span id="l21.40" class="difflineplus">+var formatter = {</span>
<a href="#l21.41"></a><span id="l21.41" class="difflineplus">+  /**</span>
<a href="#l21.42"></a><span id="l21.42" class="difflineplus">+   * Format a date in either short or long format, depending on the users preference.</span>
<a href="#l21.43"></a><span id="l21.43" class="difflineplus">+   *</span>
<a href="#l21.44"></a><span id="l21.44" class="difflineplus">+   * @param {calIDateTime} aDate    The datetime to format.</span>
<a href="#l21.45"></a><span id="l21.45" class="difflineplus">+   * @return {string}               A string representing the date part of the datetime.</span>
<a href="#l21.46"></a><span id="l21.46" class="difflineplus">+   */</span>
<a href="#l21.47"></a><span id="l21.47">   formatDate(aDate) {</span>
<a href="#l21.48"></a><span id="l21.48">     // Format the date using user's format preference (long or short)</span>
<a href="#l21.49"></a><span id="l21.49">     let format = Services.prefs.getIntPref(&quot;calendar.date.format&quot;, 0);</span>
<a href="#l21.50"></a><span id="l21.50">     return format == 0 ? this.formatDateLong(aDate) : this.formatDateShort(aDate);</span>
<a href="#l21.51"></a><span id="l21.51">   },</span>
<a href="#l21.52"></a><span id="l21.52"> </span>
<a href="#l21.53"></a><span id="l21.53" class="difflineplus">+  /**</span>
<a href="#l21.54"></a><span id="l21.54" class="difflineplus">+   * Format a date into a short format, for example &quot;12/17/2005&quot;.</span>
<a href="#l21.55"></a><span id="l21.55" class="difflineplus">+   *</span>
<a href="#l21.56"></a><span id="l21.56" class="difflineplus">+   * @param {calIDateTime} aDate    The datetime to format.</span>
<a href="#l21.57"></a><span id="l21.57" class="difflineplus">+   * @return {string}               A string representing the date part of the datetime.</span>
<a href="#l21.58"></a><span id="l21.58" class="difflineplus">+   */</span>
<a href="#l21.59"></a><span id="l21.59">   formatDateShort(aDate) {</span>
<a href="#l21.60"></a><span id="l21.60" class="difflineminus">-    return this._inTimezone(aDate, { dateStyle: &quot;short&quot; });</span>
<a href="#l21.61"></a><span id="l21.61" class="difflineplus">+    return inTimezone(aDate, { dateStyle: &quot;short&quot; });</span>
<a href="#l21.62"></a><span id="l21.62">   },</span>
<a href="#l21.63"></a><span id="l21.63"> </span>
<a href="#l21.64"></a><span id="l21.64" class="difflineplus">+  /**</span>
<a href="#l21.65"></a><span id="l21.65" class="difflineplus">+   * Format a date into a long format, for example &quot;Sat Dec 17 2005&quot;.</span>
<a href="#l21.66"></a><span id="l21.66" class="difflineplus">+   *</span>
<a href="#l21.67"></a><span id="l21.67" class="difflineplus">+   * @param {calIDateTime} aDate    The datetime to format.</span>
<a href="#l21.68"></a><span id="l21.68" class="difflineplus">+   * @return {string}               A string representing the date part of the datetime.</span>
<a href="#l21.69"></a><span id="l21.69" class="difflineplus">+   */</span>
<a href="#l21.70"></a><span id="l21.70">   formatDateLong(aDate) {</span>
<a href="#l21.71"></a><span id="l21.71" class="difflineminus">-    return this._inTimezone(aDate, { dateStyle: &quot;full&quot; });</span>
<a href="#l21.72"></a><span id="l21.72" class="difflineplus">+    return inTimezone(aDate, { dateStyle: &quot;full&quot; });</span>
<a href="#l21.73"></a><span id="l21.73">   },</span>
<a href="#l21.74"></a><span id="l21.74"> </span>
<a href="#l21.75"></a><span id="l21.75" class="difflineplus">+  /**</span>
<a href="#l21.76"></a><span id="l21.76" class="difflineplus">+   * Format a date into a short format without mentioning the year, for example &quot;Dec 17&quot;</span>
<a href="#l21.77"></a><span id="l21.77" class="difflineplus">+   *</span>
<a href="#l21.78"></a><span id="l21.78" class="difflineplus">+   * @param {calIDateTime} aDate    The datetime to format.</span>
<a href="#l21.79"></a><span id="l21.79" class="difflineplus">+   * @return {string}               A string representing the date part of the datetime.</span>
<a href="#l21.80"></a><span id="l21.80" class="difflineplus">+   */</span>
<a href="#l21.81"></a><span id="l21.81">   formatDateWithoutYear(aDate) {</span>
<a href="#l21.82"></a><span id="l21.82">     let dtOptions = { month: &quot;short&quot;, day: &quot;numeric&quot; };</span>
<a href="#l21.83"></a><span id="l21.83" class="difflineminus">-    return this._inTimezone(aDate, dtOptions);</span>
<a href="#l21.84"></a><span id="l21.84" class="difflineplus">+    return inTimezone(aDate, dtOptions);</span>
<a href="#l21.85"></a><span id="l21.85">   },</span>
<a href="#l21.86"></a><span id="l21.86"> </span>
<a href="#l21.87"></a><span id="l21.87" class="difflineplus">+  /**</span>
<a href="#l21.88"></a><span id="l21.88" class="difflineplus">+   * Format a time into the format specified by the OS settings. Will omit the seconds from the</span>
<a href="#l21.89"></a><span id="l21.89" class="difflineplus">+   * output.</span>
<a href="#l21.90"></a><span id="l21.90" class="difflineplus">+   *</span>
<a href="#l21.91"></a><span id="l21.91" class="difflineplus">+   * @param {calIDateTime} aDate    The datetime to format.</span>
<a href="#l21.92"></a><span id="l21.92" class="difflineplus">+   * @return {string}               A string representing the time part of the datetime.</span>
<a href="#l21.93"></a><span id="l21.93" class="difflineplus">+   */</span>
<a href="#l21.94"></a><span id="l21.94">   formatTime(aDate) {</span>
<a href="#l21.95"></a><span id="l21.95">     if (aDate.isDate) {</span>
<a href="#l21.96"></a><span id="l21.96" class="difflineminus">-      return this.mDateStringBundle.GetStringFromName(&quot;AllDay&quot;);</span>
<a href="#l21.97"></a><span id="l21.97" class="difflineplus">+      return gDateStringBundle.GetStringFromName(&quot;AllDay&quot;);</span>
<a href="#l21.98"></a><span id="l21.98">     }</span>
<a href="#l21.99"></a><span id="l21.99"> </span>
<a href="#l21.100"></a><span id="l21.100" class="difflineminus">-    return this._inTimezone(aDate, { timeStyle: &quot;short&quot; });</span>
<a href="#l21.101"></a><span id="l21.101" class="difflineplus">+    return inTimezone(aDate, { timeStyle: &quot;short&quot; });</span>
<a href="#l21.102"></a><span id="l21.102">   },</span>
<a href="#l21.103"></a><span id="l21.103"> </span>
<a href="#l21.104"></a><span id="l21.104" class="difflineplus">+  /**</span>
<a href="#l21.105"></a><span id="l21.105" class="difflineplus">+   * Format a datetime into the format specified by the OS settings. Will omit the seconds from the</span>
<a href="#l21.106"></a><span id="l21.106" class="difflineplus">+   * output.</span>
<a href="#l21.107"></a><span id="l21.107" class="difflineplus">+   *</span>
<a href="#l21.108"></a><span id="l21.108" class="difflineplus">+   * @param {calIDateTime} aDate    The datetime to format.</span>
<a href="#l21.109"></a><span id="l21.109" class="difflineplus">+   * @return {string}               A string representing the datetime.</span>
<a href="#l21.110"></a><span id="l21.110" class="difflineplus">+   */</span>
<a href="#l21.111"></a><span id="l21.111">   formatDateTime(aDate) {</span>
<a href="#l21.112"></a><span id="l21.112">     let formattedDate = this.formatDate(aDate);</span>
<a href="#l21.113"></a><span id="l21.113">     let formattedTime = this.formatTime(aDate);</span>
<a href="#l21.114"></a><span id="l21.114"> </span>
<a href="#l21.115"></a><span id="l21.115">     let timeBeforeDate = Services.prefs.getBoolPref(&quot;calendar.date.formatTimeBeforeDate&quot;, false);</span>
<a href="#l21.116"></a><span id="l21.116">     if (timeBeforeDate) {</span>
<a href="#l21.117"></a><span id="l21.117">       return formattedTime + &quot; &quot; + formattedDate;</span>
<a href="#l21.118"></a><span id="l21.118">     }</span>
<a href="#l21.119"></a><span id="l21.119">     return formattedDate + &quot; &quot; + formattedTime;</span>
<a href="#l21.120"></a><span id="l21.120">   },</span>
<a href="#l21.121"></a><span id="l21.121"> </span>
<a href="#l21.122"></a><span id="l21.122">   /**</span>
<a href="#l21.123"></a><span id="l21.123" class="difflineminus">-   * _inTimezone returns a string with date formatted</span>
<a href="#l21.124"></a><span id="l21.124" class="difflineplus">+   * Format a time interval like formatInterval, but show only the time.</span>
<a href="#l21.125"></a><span id="l21.125">    *</span>
<a href="#l21.126"></a><span id="l21.126" class="difflineminus">-   * @param  {calIDateTime} aDate    The date object holding the tz information</span>
<a href="#l21.127"></a><span id="l21.127" class="difflineminus">-   * @param  {JsObject}     aOptions The options object for formatting.</span>
<a href="#l21.128"></a><span id="l21.128" class="difflineminus">-   * @return {String}                The date as a string.</span>
<a href="#l21.129"></a><span id="l21.129" class="difflineplus">+   * @param {calIDateTime} aStartDate   The start of the interval.</span>
<a href="#l21.130"></a><span id="l21.130" class="difflineplus">+   * @param {calIDateTime} aEndDate     The end of the interval.</span>
<a href="#l21.131"></a><span id="l21.131" class="difflineplus">+   * @return {string}                   The formatted time interval.</span>
<a href="#l21.132"></a><span id="l21.132">    */</span>
<a href="#l21.133"></a><span id="l21.133" class="difflineminus">-  _inTimezone(aDate, aOptions) {</span>
<a href="#l21.134"></a><span id="l21.134" class="difflineminus">-    let formatter = new Services.intl.DateTimeFormat(undefined, aOptions);</span>
<a href="#l21.135"></a><span id="l21.135" class="difflineminus">-</span>
<a href="#l21.136"></a><span id="l21.136" class="difflineminus">-    let timezone = aDate.timezone;</span>
<a href="#l21.137"></a><span id="l21.137" class="difflineminus">-    // We set the tz only if we have a valid tz - otherwise localtime will be used on formatting.</span>
<a href="#l21.138"></a><span id="l21.138" class="difflineminus">-    if (timezone &amp;&amp; (timezone.isUTC || timezone.icalComponent)) {</span>
<a href="#l21.139"></a><span id="l21.139" class="difflineminus">-      aOptions.timeZone = timezone.tzid;</span>
<a href="#l21.140"></a><span id="l21.140" class="difflineminus">-      try {</span>
<a href="#l21.141"></a><span id="l21.141" class="difflineminus">-        formatter = new Services.intl.DateTimeFormat(undefined, aOptions);</span>
<a href="#l21.142"></a><span id="l21.142" class="difflineminus">-      } catch (ex) {</span>
<a href="#l21.143"></a><span id="l21.143" class="difflineminus">-        // Non-IANA timezones throw a RangeError.</span>
<a href="#l21.144"></a><span id="l21.144" class="difflineminus">-        cal.WARN(ex);</span>
<a href="#l21.145"></a><span id="l21.145" class="difflineminus">-      }</span>
<a href="#l21.146"></a><span id="l21.146" class="difflineminus">-    }</span>
<a href="#l21.147"></a><span id="l21.147" class="difflineminus">-</span>
<a href="#l21.148"></a><span id="l21.148" class="difflineminus">-    return formatter.format(cal.dtz.dateTimeToJsDate(aDate));</span>
<a href="#l21.149"></a><span id="l21.149" class="difflineminus">-  },</span>
<a href="#l21.150"></a><span id="l21.150" class="difflineminus">-</span>
<a href="#l21.151"></a><span id="l21.151">   formatTimeInterval(aStartDate, aEndDate) {</span>
<a href="#l21.152"></a><span id="l21.152">     if (!aStartDate &amp;&amp; aEndDate) {</span>
<a href="#l21.153"></a><span id="l21.153">       return this.formatTime(aEndDate);</span>
<a href="#l21.154"></a><span id="l21.154">     }</span>
<a href="#l21.155"></a><span id="l21.155">     if (!aEndDate &amp;&amp; aStartDate) {</span>
<a href="#l21.156"></a><span id="l21.156">       return this.formatTime(aStartDate);</span>
<a href="#l21.157"></a><span id="l21.157">     }</span>
<a href="#l21.158"></a><span id="l21.158">     if (!aStartDate &amp;&amp; !aEndDate) {</span>
<a href="#l21.159"></a><span id="l21.159" class="difflineat">@@ -92,16 +116,24 @@ CalDateTimeFormatter.prototype = {</span>
<a href="#l21.160"></a><span id="l21.160">     }</span>
<a href="#l21.161"></a><span id="l21.161"> </span>
<a href="#l21.162"></a><span id="l21.162">     // TODO do we need l10n for this?</span>
<a href="#l21.163"></a><span id="l21.163">     // TODO should we check for the same day? The caller should know what</span>
<a href="#l21.164"></a><span id="l21.164">     // he is doing...</span>
<a href="#l21.165"></a><span id="l21.165">     return this.formatTime(aStartDate) + &quot;\u2013&quot; + this.formatTime(aEndDate);</span>
<a href="#l21.166"></a><span id="l21.166">   },</span>
<a href="#l21.167"></a><span id="l21.167"> </span>
<a href="#l21.168"></a><span id="l21.168" class="difflineplus">+  /**</span>
<a href="#l21.169"></a><span id="l21.169" class="difflineplus">+   * Format a date/time interval. The returned string may assume that the dates are so close to each</span>
<a href="#l21.170"></a><span id="l21.170" class="difflineplus">+   * other, that it can leave out some parts of the part string denoting the end date.</span>
<a href="#l21.171"></a><span id="l21.171" class="difflineplus">+   *</span>
<a href="#l21.172"></a><span id="l21.172" class="difflineplus">+   * @param {calIDateTime} aStartDate        The start of the interval.</span>
<a href="#l21.173"></a><span id="l21.173" class="difflineplus">+   * @param {calIDateTime} aEndDate          The end of the interval.</span>
<a href="#l21.174"></a><span id="l21.174" class="difflineplus">+   * @return {string}                        A string describing the interval in a legible form.</span>
<a href="#l21.175"></a><span id="l21.175" class="difflineplus">+   */</span>
<a href="#l21.176"></a><span id="l21.176">   formatInterval(aStartDate, aEndDate) {</span>
<a href="#l21.177"></a><span id="l21.177">     // Check for tasks without start and/or due date</span>
<a href="#l21.178"></a><span id="l21.178">     if (aEndDate == null &amp;&amp; aStartDate == null) {</span>
<a href="#l21.179"></a><span id="l21.179">       return cal.l10n.getCalString(&quot;datetimeIntervalTaskWithoutDate&quot;);</span>
<a href="#l21.180"></a><span id="l21.180">     } else if (aEndDate == null) {</span>
<a href="#l21.181"></a><span id="l21.181">       let startDateString = this.formatDate(aStartDate);</span>
<a href="#l21.182"></a><span id="l21.182">       let startTime = this.formatTime(aStartDate);</span>
<a href="#l21.183"></a><span id="l21.183">       return cal.l10n.getCalString(&quot;datetimeIntervalTaskWithoutDueDate&quot;, [</span>
<a href="#l21.184"></a><span id="l21.184" class="difflineat">@@ -210,62 +242,137 @@ CalDateTimeFormatter.prototype = {</span>
<a href="#l21.185"></a><span id="l21.185">     return cal.l10n.getCalString(&quot;datetimeIntervalOnSeveralDays&quot;, [</span>
<a href="#l21.186"></a><span id="l21.186">       startDateString,</span>
<a href="#l21.187"></a><span id="l21.187">       startTime,</span>
<a href="#l21.188"></a><span id="l21.188">       endDateString,</span>
<a href="#l21.189"></a><span id="l21.189">       endTime,</span>
<a href="#l21.190"></a><span id="l21.190">     ]);</span>
<a href="#l21.191"></a><span id="l21.191">   },</span>
<a href="#l21.192"></a><span id="l21.192"> </span>
<a href="#l21.193"></a><span id="l21.193" class="difflineplus">+  /**</span>
<a href="#l21.194"></a><span id="l21.194" class="difflineplus">+   * Get the monthday followed by its ordinal symbol in the current locale.</span>
<a href="#l21.195"></a><span id="l21.195" class="difflineplus">+   * e.g.  monthday 1 -&gt; 1st</span>
<a href="#l21.196"></a><span id="l21.196" class="difflineplus">+   *       monthday 2 -&gt; 2nd etc.</span>
<a href="#l21.197"></a><span id="l21.197" class="difflineplus">+   *</span>
<a href="#l21.198"></a><span id="l21.198" class="difflineplus">+   * @param {number} aDay    A number from 1 to 31.</span>
<a href="#l21.199"></a><span id="l21.199" class="difflineplus">+   * @return {string}        The monthday number in ordinal format in the current locale.</span>
<a href="#l21.200"></a><span id="l21.200" class="difflineplus">+   */</span>
<a href="#l21.201"></a><span id="l21.201">   formatDayWithOrdinal(aDay) {</span>
<a href="#l21.202"></a><span id="l21.202" class="difflineminus">-    let ordinalSymbols = this.mDateStringBundle.GetStringFromName(&quot;dayOrdinalSymbol&quot;).split(&quot;,&quot;);</span>
<a href="#l21.203"></a><span id="l21.203" class="difflineplus">+    let ordinalSymbols = gDateStringBundle.GetStringFromName(&quot;dayOrdinalSymbol&quot;).split(&quot;,&quot;);</span>
<a href="#l21.204"></a><span id="l21.204">     let dayOrdinalSymbol = ordinalSymbols[aDay - 1] || ordinalSymbols[0];</span>
<a href="#l21.205"></a><span id="l21.205">     return aDay + dayOrdinalSymbol;</span>
<a href="#l21.206"></a><span id="l21.206">   },</span>
<a href="#l21.207"></a><span id="l21.207"> </span>
<a href="#l21.208"></a><span id="l21.208" class="difflineminus">-  _getItemDates(aItem) {</span>
<a href="#l21.209"></a><span id="l21.209" class="difflineminus">-    let start = aItem[cal.dtz.startDateProp(aItem)];</span>
<a href="#l21.210"></a><span id="l21.210" class="difflineminus">-    let end = aItem[cal.dtz.endDateProp(aItem)];</span>
<a href="#l21.211"></a><span id="l21.211" class="difflineminus">-    let kDefaultTimezone = cal.dtz.defaultTimezone;</span>
<a href="#l21.212"></a><span id="l21.212" class="difflineminus">-    // Check for tasks without start and/or due date</span>
<a href="#l21.213"></a><span id="l21.213" class="difflineminus">-    if (start) {</span>
<a href="#l21.214"></a><span id="l21.214" class="difflineminus">-      start = start.getInTimezone(kDefaultTimezone);</span>
<a href="#l21.215"></a><span id="l21.215" class="difflineminus">-    }</span>
<a href="#l21.216"></a><span id="l21.216" class="difflineminus">-    if (end) {</span>
<a href="#l21.217"></a><span id="l21.217" class="difflineminus">-      end = end.getInTimezone(kDefaultTimezone);</span>
<a href="#l21.218"></a><span id="l21.218" class="difflineminus">-    }</span>
<a href="#l21.219"></a><span id="l21.219" class="difflineminus">-    // EndDate is exclusive. For all-day events, we need to subtract one day,</span>
<a href="#l21.220"></a><span id="l21.220" class="difflineminus">-    // to get into a format that's understandable.</span>
<a href="#l21.221"></a><span id="l21.221" class="difflineminus">-    if (start &amp;&amp; start.isDate &amp;&amp; end) {</span>
<a href="#l21.222"></a><span id="l21.222" class="difflineminus">-      end.day -= 1;</span>
<a href="#l21.223"></a><span id="l21.223" class="difflineminus">-    }</span>
<a href="#l21.224"></a><span id="l21.224" class="difflineplus">+  /**</span>
<a href="#l21.225"></a><span id="l21.225" class="difflineplus">+   * Format an interval that is defined by an item with the default timezone.</span>
<a href="#l21.226"></a><span id="l21.226" class="difflineplus">+   *</span>
<a href="#l21.227"></a><span id="l21.227" class="difflineplus">+   * @param {calIItemBase} aItem      The item describing the interval.</span>
<a href="#l21.228"></a><span id="l21.228" class="difflineplus">+   * @return {string}                 The formatted item interval.</span>
<a href="#l21.229"></a><span id="l21.229" class="difflineplus">+   */</span>
<a href="#l21.230"></a><span id="l21.230" class="difflineplus">+  formatItemInterval(aItem) {</span>
<a href="#l21.231"></a><span id="l21.231" class="difflineplus">+    return this.formatInterval(...getItemDates(aItem));</span>
<a href="#l21.232"></a><span id="l21.232" class="difflineplus">+  },</span>
<a href="#l21.233"></a><span id="l21.233"> </span>
<a href="#l21.234"></a><span id="l21.234" class="difflineminus">-    return [start, end];</span>
<a href="#l21.235"></a><span id="l21.235" class="difflineplus">+  /**</span>
<a href="#l21.236"></a><span id="l21.236" class="difflineplus">+   * Format a time interval like formatItemInterval, but only show times.</span>
<a href="#l21.237"></a><span id="l21.237" class="difflineplus">+   *</span>
<a href="#l21.238"></a><span id="l21.238" class="difflineplus">+   * @param {calIItemBase} aItem      The item describing the interval.</span>
<a href="#l21.239"></a><span id="l21.239" class="difflineplus">+   * @return {string}                 The formatted item interval.</span>
<a href="#l21.240"></a><span id="l21.240" class="difflineplus">+   */</span>
<a href="#l21.241"></a><span id="l21.241" class="difflineplus">+  formatItemTimeInterval(aItem) {</span>
<a href="#l21.242"></a><span id="l21.242" class="difflineplus">+    return this.formatTimeInterval(...getItemDates(aItem));</span>
<a href="#l21.243"></a><span id="l21.243">   },</span>
<a href="#l21.244"></a><span id="l21.244"> </span>
<a href="#l21.245"></a><span id="l21.245" class="difflineminus">-  formatItemInterval(aItem) {</span>
<a href="#l21.246"></a><span id="l21.246" class="difflineminus">-    return this.formatInterval(...this._getItemDates(aItem));</span>
<a href="#l21.247"></a><span id="l21.247" class="difflineplus">+  /**</span>
<a href="#l21.248"></a><span id="l21.248" class="difflineplus">+   * Get the month name.</span>
<a href="#l21.249"></a><span id="l21.249" class="difflineplus">+   *</span>
<a href="#l21.250"></a><span id="l21.250" class="difflineplus">+   * @param {number} aMonthIndex      Zero-based month number (0 is january, 11 is december).</span>
<a href="#l21.251"></a><span id="l21.251" class="difflineplus">+   * @return {string}                 The month name in the current locale.</span>
<a href="#l21.252"></a><span id="l21.252" class="difflineplus">+   */</span>
<a href="#l21.253"></a><span id="l21.253" class="difflineplus">+  monthName(aMonthIndex) {</span>
<a href="#l21.254"></a><span id="l21.254" class="difflineplus">+    let oneBasedMonthIndex = aMonthIndex + 1;</span>
<a href="#l21.255"></a><span id="l21.255" class="difflineplus">+    return gDateStringBundle.GetStringFromName(&quot;month.&quot; + oneBasedMonthIndex + &quot;.name&quot;);</span>
<a href="#l21.256"></a><span id="l21.256" class="difflineplus">+  },</span>
<a href="#l21.257"></a><span id="l21.257" class="difflineplus">+</span>
<a href="#l21.258"></a><span id="l21.258" class="difflineplus">+  /**</span>
<a href="#l21.259"></a><span id="l21.259" class="difflineplus">+   * Get the abbreviation of the month name.</span>
<a href="#l21.260"></a><span id="l21.260" class="difflineplus">+   *</span>
<a href="#l21.261"></a><span id="l21.261" class="difflineplus">+   * @param {number} aMonthIndex      Zero-based month number (0 is january, 11 is december).</span>
<a href="#l21.262"></a><span id="l21.262" class="difflineplus">+   * @return {string}                 The abbreviated month name in the current locale.</span>
<a href="#l21.263"></a><span id="l21.263" class="difflineplus">+   */</span>
<a href="#l21.264"></a><span id="l21.264" class="difflineplus">+  shortMonthName(aMonthIndex) {</span>
<a href="#l21.265"></a><span id="l21.265" class="difflineplus">+    let oneBasedMonthIndex = aMonthIndex + 1;</span>
<a href="#l21.266"></a><span id="l21.266" class="difflineplus">+    return gDateStringBundle.GetStringFromName(&quot;month.&quot; + oneBasedMonthIndex + &quot;.Mmm&quot;);</span>
<a href="#l21.267"></a><span id="l21.267" class="difflineplus">+  },</span>
<a href="#l21.268"></a><span id="l21.268" class="difflineplus">+</span>
<a href="#l21.269"></a><span id="l21.269" class="difflineplus">+  /**</span>
<a href="#l21.270"></a><span id="l21.270" class="difflineplus">+   * Get the day name.</span>
<a href="#l21.271"></a><span id="l21.271" class="difflineplus">+   *</span>
<a href="#l21.272"></a><span id="l21.272" class="difflineplus">+   * @param {number} aMonthIndex      Zero-based day number (0 is sunday, 6 is saturday).</span>
<a href="#l21.273"></a><span id="l21.273" class="difflineplus">+   * @return {string}                 The day name in the current locale.</span>
<a href="#l21.274"></a><span id="l21.274" class="difflineplus">+   */</span>
<a href="#l21.275"></a><span id="l21.275" class="difflineplus">+  dayName(aDayIndex) {</span>
<a href="#l21.276"></a><span id="l21.276" class="difflineplus">+    let oneBasedDayIndex = aDayIndex + 1;</span>
<a href="#l21.277"></a><span id="l21.277" class="difflineplus">+    return gDateStringBundle.GetStringFromName(&quot;day.&quot; + oneBasedDayIndex + &quot;.name&quot;);</span>
<a href="#l21.278"></a><span id="l21.278">   },</span>
<a href="#l21.279"></a><span id="l21.279"> </span>
<a href="#l21.280"></a><span id="l21.280" class="difflineminus">-  formatItemTimeInterval(aItem) {</span>
<a href="#l21.281"></a><span id="l21.281" class="difflineminus">-    return this.formatTimeInterval(...this._getItemDates(aItem));</span>
<a href="#l21.282"></a><span id="l21.282" class="difflineminus">-  },</span>
<a href="#l21.283"></a><span id="l21.283" class="difflineminus">-</span>
<a href="#l21.284"></a><span id="l21.284" class="difflineminus">-  monthName(aMonthIndex) {</span>
<a href="#l21.285"></a><span id="l21.285" class="difflineminus">-    let oneBasedMonthIndex = aMonthIndex + 1;</span>
<a href="#l21.286"></a><span id="l21.286" class="difflineminus">-    return this.mDateStringBundle.GetStringFromName(&quot;month.&quot; + oneBasedMonthIndex + &quot;.name&quot;);</span>
<a href="#l21.287"></a><span id="l21.287" class="difflineminus">-  },</span>
<a href="#l21.288"></a><span id="l21.288" class="difflineminus">-</span>
<a href="#l21.289"></a><span id="l21.289" class="difflineminus">-  shortMonthName(aMonthIndex) {</span>
<a href="#l21.290"></a><span id="l21.290" class="difflineminus">-    let oneBasedMonthIndex = aMonthIndex + 1;</span>
<a href="#l21.291"></a><span id="l21.291" class="difflineminus">-    return this.mDateStringBundle.GetStringFromName(&quot;month.&quot; + oneBasedMonthIndex + &quot;.Mmm&quot;);</span>
<a href="#l21.292"></a><span id="l21.292" class="difflineminus">-  },</span>
<a href="#l21.293"></a><span id="l21.293" class="difflineminus">-</span>
<a href="#l21.294"></a><span id="l21.294" class="difflineminus">-  dayName(aDayIndex) {</span>
<a href="#l21.295"></a><span id="l21.295" class="difflineminus">-    let oneBasedDayIndex = aDayIndex + 1;</span>
<a href="#l21.296"></a><span id="l21.296" class="difflineminus">-    return this.mDateStringBundle.GetStringFromName(&quot;day.&quot; + oneBasedDayIndex + &quot;.name&quot;);</span>
<a href="#l21.297"></a><span id="l21.297" class="difflineminus">-  },</span>
<a href="#l21.298"></a><span id="l21.298" class="difflineminus">-</span>
<a href="#l21.299"></a><span id="l21.299" class="difflineplus">+  /**</span>
<a href="#l21.300"></a><span id="l21.300" class="difflineplus">+   * Get the abbreviation of the day name.</span>
<a href="#l21.301"></a><span id="l21.301" class="difflineplus">+   *</span>
<a href="#l21.302"></a><span id="l21.302" class="difflineplus">+   * @param {number} aMonthIndex      Zero-based day number (0 is sunday, 6 is saturday).</span>
<a href="#l21.303"></a><span id="l21.303" class="difflineplus">+   * @return {string}                 The abbrevidated day name in the current locale.</span>
<a href="#l21.304"></a><span id="l21.304" class="difflineplus">+   */</span>
<a href="#l21.305"></a><span id="l21.305">   shortDayName(aDayIndex) {</span>
<a href="#l21.306"></a><span id="l21.306">     let oneBasedDayIndex = aDayIndex + 1;</span>
<a href="#l21.307"></a><span id="l21.307" class="difflineminus">-    return this.mDateStringBundle.GetStringFromName(&quot;day.&quot; + oneBasedDayIndex + &quot;.Mmm&quot;);</span>
<a href="#l21.308"></a><span id="l21.308" class="difflineplus">+    return gDateStringBundle.GetStringFromName(&quot;day.&quot; + oneBasedDayIndex + &quot;.Mmm&quot;);</span>
<a href="#l21.309"></a><span id="l21.309">   },</span>
<a href="#l21.310"></a><span id="l21.310"> };</span>
<a href="#l21.311"></a><span id="l21.311" class="difflineplus">+</span>
<a href="#l21.312"></a><span id="l21.312" class="difflineplus">+/**</span>
<a href="#l21.313"></a><span id="l21.313" class="difflineplus">+ * inTimezone returns a string with date formatted.</span>
<a href="#l21.314"></a><span id="l21.314" class="difflineplus">+ *</span>
<a href="#l21.315"></a><span id="l21.315" class="difflineplus">+ * @param  {calIDateTime} aDate    The date object holding the tz information.</span>
<a href="#l21.316"></a><span id="l21.316" class="difflineplus">+ * @param  {Object} aOptions       The Intl.DateTimeFormatter options object.</span>
<a href="#l21.317"></a><span id="l21.317" class="difflineplus">+ * @return {string}                The date as a string.</span>
<a href="#l21.318"></a><span id="l21.318" class="difflineplus">+ */</span>
<a href="#l21.319"></a><span id="l21.319" class="difflineplus">+function inTimezone(aDate, aOptions) {</span>
<a href="#l21.320"></a><span id="l21.320" class="difflineplus">+  let formatter = new Services.intl.DateTimeFormat(undefined, aOptions);</span>
<a href="#l21.321"></a><span id="l21.321" class="difflineplus">+</span>
<a href="#l21.322"></a><span id="l21.322" class="difflineplus">+  let timezone = aDate.timezone;</span>
<a href="#l21.323"></a><span id="l21.323" class="difflineplus">+  // We set the tz only if we have a valid tz - otherwise localtime will be used on formatting.</span>
<a href="#l21.324"></a><span id="l21.324" class="difflineplus">+  if (timezone &amp;&amp; (timezone.isUTC || timezone.icalComponent)) {</span>
<a href="#l21.325"></a><span id="l21.325" class="difflineplus">+    aOptions.timeZone = timezone.tzid;</span>
<a href="#l21.326"></a><span id="l21.326" class="difflineplus">+    try {</span>
<a href="#l21.327"></a><span id="l21.327" class="difflineplus">+      formatter = new Services.intl.DateTimeFormat(undefined, aOptions);</span>
<a href="#l21.328"></a><span id="l21.328" class="difflineplus">+    } catch (ex) {</span>
<a href="#l21.329"></a><span id="l21.329" class="difflineplus">+      // Non-IANA timezones throw a RangeError.</span>
<a href="#l21.330"></a><span id="l21.330" class="difflineplus">+      cal.WARN(ex);</span>
<a href="#l21.331"></a><span id="l21.331" class="difflineplus">+    }</span>
<a href="#l21.332"></a><span id="l21.332" class="difflineplus">+  }</span>
<a href="#l21.333"></a><span id="l21.333" class="difflineplus">+</span>
<a href="#l21.334"></a><span id="l21.334" class="difflineplus">+  return formatter.format(cal.dtz.dateTimeToJsDate(aDate));</span>
<a href="#l21.335"></a><span id="l21.335" class="difflineplus">+}</span>
<a href="#l21.336"></a><span id="l21.336" class="difflineplus">+</span>
<a href="#l21.337"></a><span id="l21.337" class="difflineplus">+/**</span>
<a href="#l21.338"></a><span id="l21.338" class="difflineplus">+ * Helper to get the start/end dates for a given item.</span>
<a href="#l21.339"></a><span id="l21.339" class="difflineplus">+ *</span>
<a href="#l21.340"></a><span id="l21.340" class="difflineplus">+ * @param {calIItemBase} aItem              The item to get the dates for.</span>
<a href="#l21.341"></a><span id="l21.341" class="difflineplus">+ * @return {[calIDateTime, calIDateTime]}   An array with start and end date.</span>
<a href="#l21.342"></a><span id="l21.342" class="difflineplus">+ */</span>
<a href="#l21.343"></a><span id="l21.343" class="difflineplus">+function getItemDates(aItem) {</span>
<a href="#l21.344"></a><span id="l21.344" class="difflineplus">+  let start = aItem[cal.dtz.startDateProp(aItem)];</span>
<a href="#l21.345"></a><span id="l21.345" class="difflineplus">+  let end = aItem[cal.dtz.endDateProp(aItem)];</span>
<a href="#l21.346"></a><span id="l21.346" class="difflineplus">+  let kDefaultTimezone = cal.dtz.defaultTimezone;</span>
<a href="#l21.347"></a><span id="l21.347" class="difflineplus">+  // Check for tasks without start and/or due date</span>
<a href="#l21.348"></a><span id="l21.348" class="difflineplus">+  if (start) {</span>
<a href="#l21.349"></a><span id="l21.349" class="difflineplus">+    start = start.getInTimezone(kDefaultTimezone);</span>
<a href="#l21.350"></a><span id="l21.350" class="difflineplus">+  }</span>
<a href="#l21.351"></a><span id="l21.351" class="difflineplus">+  if (end) {</span>
<a href="#l21.352"></a><span id="l21.352" class="difflineplus">+    end = end.getInTimezone(kDefaultTimezone);</span>
<a href="#l21.353"></a><span id="l21.353" class="difflineplus">+  }</span>
<a href="#l21.354"></a><span id="l21.354" class="difflineplus">+  // EndDate is exclusive. For all-day events, we need to subtract one day,</span>
<a href="#l21.355"></a><span id="l21.355" class="difflineplus">+  // to get into a format that's understandable.</span>
<a href="#l21.356"></a><span id="l21.356" class="difflineplus">+  if (start &amp;&amp; start.isDate &amp;&amp; end) {</span>
<a href="#l21.357"></a><span id="l21.357" class="difflineplus">+    end.day -= 1;</span>
<a href="#l21.358"></a><span id="l21.358" class="difflineplus">+  }</span>
<a href="#l21.359"></a><span id="l21.359" class="difflineplus">+</span>
<a href="#l21.360"></a><span id="l21.360" class="difflineplus">+  return [start, end];</span>
<a href="#l21.361"></a><span id="l21.361" class="difflineplus">+}</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l22.1"></a><span id="l22.1" class="difflineminus">--- a/calendar/base/modules/utils/calDateTimeUtils.jsm</span>
<a href="#l22.2"></a><span id="l22.2" class="difflineplus">+++ b/calendar/base/modules/utils/calDateTimeUtils.jsm</span>
<a href="#l22.3"></a><span id="l22.3" class="difflineat">@@ -378,8 +378,14 @@ var caldtz = {</span>
<a href="#l22.4"></a><span id="l22.4">           &quot;calendar.timezone.recent&quot;,</span>
<a href="#l22.5"></a><span id="l22.5">           JSON.stringify(recentTimezones.map(zone =&gt; zone.tzid))</span>
<a href="#l22.6"></a><span id="l22.6">         );</span>
<a href="#l22.7"></a><span id="l22.7">       }</span>
<a href="#l22.8"></a><span id="l22.8">     }</span>
<a href="#l22.9"></a><span id="l22.9">     return recentTimezones;</span>
<a href="#l22.10"></a><span id="l22.10">   },</span>
<a href="#l22.11"></a><span id="l22.11"> };</span>
<a href="#l22.12"></a><span id="l22.12" class="difflineplus">+</span>
<a href="#l22.13"></a><span id="l22.13" class="difflineplus">+ChromeUtils.defineModuleGetter(</span>
<a href="#l22.14"></a><span id="l22.14" class="difflineplus">+  caldtz,</span>
<a href="#l22.15"></a><span id="l22.15" class="difflineplus">+  &quot;formatter&quot;,</span>
<a href="#l22.16"></a><span id="l22.16" class="difflineplus">+  &quot;resource:///modules/calendar/utils/calDateTimeFormatter.jsm&quot;</span>
<a href="#l22.17"></a><span id="l22.17" class="difflineplus">+);</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l23.1"></a><span id="l23.1" class="difflineminus">--- a/calendar/base/modules/utils/calPrintUtils.jsm</span>
<a href="#l23.2"></a><span id="l23.2" class="difflineplus">+++ b/calendar/base/modules/utils/calPrintUtils.jsm</span>
<a href="#l23.3"></a><span id="l23.3" class="difflineat">@@ -118,44 +118,44 @@ var calprint = {</span>
<a href="#l23.4"></a><span id="l23.4">   /**</span>
<a href="#l23.5"></a><span id="l23.5">    * Get time interval string for the given item. Returns an empty string for all-day items.</span>
<a href="#l23.6"></a><span id="l23.6">    *</span>
<a href="#l23.7"></a><span id="l23.7">    * @param aItem     The item providing the interval</span>
<a href="#l23.8"></a><span id="l23.8">    * @return          The string describing the interval</span>
<a href="#l23.9"></a><span id="l23.9">    */</span>
<a href="#l23.10"></a><span id="l23.10">   getItemIntervalString(aItem, aBoxDate) {</span>
<a href="#l23.11"></a><span id="l23.11">     // omit time label for all-day items</span>
<a href="#l23.12"></a><span id="l23.12" class="difflineplus">+    let formatter = cal.dtz.formatter;</span>
<a href="#l23.13"></a><span id="l23.13">     let startDate = aItem[cal.dtz.startDateProp(aItem)];</span>
<a href="#l23.14"></a><span id="l23.14">     let endDate = aItem[cal.dtz.endDateProp(aItem)];</span>
<a href="#l23.15"></a><span id="l23.15">     if ((startDate &amp;&amp; startDate.isDate) || (endDate &amp;&amp; endDate.isDate)) {</span>
<a href="#l23.16"></a><span id="l23.16">       return &quot;&quot;;</span>
<a href="#l23.17"></a><span id="l23.17">     }</span>
<a href="#l23.18"></a><span id="l23.18"> </span>
<a href="#l23.19"></a><span id="l23.19">     // check for tasks without start and/or due date</span>
<a href="#l23.20"></a><span id="l23.20">     if (!startDate || !endDate) {</span>
<a href="#l23.21"></a><span id="l23.21" class="difflineminus">-      return cal.getDateFormatter().formatItemTimeInterval(aItem);</span>
<a href="#l23.22"></a><span id="l23.22" class="difflineplus">+      return formatter.formatItemTimeInterval(aItem);</span>
<a href="#l23.23"></a><span id="l23.23">     }</span>
<a href="#l23.24"></a><span id="l23.24"> </span>
<a href="#l23.25"></a><span id="l23.25" class="difflineminus">-    let dateFormatter = cal.getDateFormatter();</span>
<a href="#l23.26"></a><span id="l23.26">     let defaultTimezone = cal.dtz.defaultTimezone;</span>
<a href="#l23.27"></a><span id="l23.27">     startDate = startDate.getInTimezone(defaultTimezone);</span>
<a href="#l23.28"></a><span id="l23.28">     endDate = endDate.getInTimezone(defaultTimezone);</span>
<a href="#l23.29"></a><span id="l23.29">     let start = startDate.clone();</span>
<a href="#l23.30"></a><span id="l23.30">     let end = endDate.clone();</span>
<a href="#l23.31"></a><span id="l23.31">     start.isDate = true;</span>
<a href="#l23.32"></a><span id="l23.32">     end.isDate = true;</span>
<a href="#l23.33"></a><span id="l23.33">     if (start.compare(end) == 0) {</span>
<a href="#l23.34"></a><span id="l23.34">       // Events that start and end in the same day.</span>
<a href="#l23.35"></a><span id="l23.35" class="difflineminus">-      return dateFormatter.formatTimeInterval(startDate, endDate);</span>
<a href="#l23.36"></a><span id="l23.36" class="difflineplus">+      return formatter.formatTimeInterval(startDate, endDate);</span>
<a href="#l23.37"></a><span id="l23.37">     }</span>
<a href="#l23.38"></a><span id="l23.38">     // Events that span two or more days.</span>
<a href="#l23.39"></a><span id="l23.39">     let compareStart = aBoxDate.compare(start);</span>
<a href="#l23.40"></a><span id="l23.40">     let compareEnd = aBoxDate.compare(end);</span>
<a href="#l23.41"></a><span id="l23.41">     if (compareStart == 0) {</span>
<a href="#l23.42"></a><span id="l23.42" class="difflineminus">-      return &quot;\u21e4 &quot; + dateFormatter.formatTime(startDate); // unicode '⇤'</span>
<a href="#l23.43"></a><span id="l23.43" class="difflineplus">+      return &quot;\u21e4 &quot; + formatter.formatTime(startDate); // unicode '⇤'</span>
<a href="#l23.44"></a><span id="l23.44">     } else if (compareStart &gt; 0 &amp;&amp; compareEnd &lt; 0) {</span>
<a href="#l23.45"></a><span id="l23.45">       return &quot;\u21ff&quot;; // unicode '↔'</span>
<a href="#l23.46"></a><span id="l23.46">     } else if (compareEnd == 0) {</span>
<a href="#l23.47"></a><span id="l23.47" class="difflineminus">-      return &quot;\u21e5 &quot; + dateFormatter.formatTime(endDate); // unicode '⇥'</span>
<a href="#l23.48"></a><span id="l23.48" class="difflineplus">+      return &quot;\u21e5 &quot; + formatter.formatTime(endDate); // unicode '⇥'</span>
<a href="#l23.49"></a><span id="l23.49">     }</span>
<a href="#l23.50"></a><span id="l23.50">     return &quot;&quot;;</span>
<a href="#l23.51"></a><span id="l23.51">   },</span>
<a href="#l23.52"></a><span id="l23.52"> };</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l24.1"></a><span id="l24.1">deleted file mode 100644</span>
<a href="#l24.2"></a><span id="l24.2" class="difflineminus">--- a/calendar/base/public/calIDateTimeFormatter.idl</span>
<a href="#l24.3"></a><span id="l24.3" class="difflineplus">+++ /dev/null</span>
<a href="#l24.4"></a><span id="l24.4" class="difflineat">@@ -1,162 +0,0 @@</span>
<a href="#l24.5"></a><span id="l24.5" class="difflineminus">-/* -*- Mode: idl; tab-width: 2; indent-tabs-mode: nil; c-basic-offset: 2 -*- */</span>
<a href="#l24.6"></a><span id="l24.6" class="difflineminus">-/* This Source Code Form is subject to the terms of the Mozilla Public</span>
<a href="#l24.7"></a><span id="l24.7" class="difflineminus">- * License, v. 2.0. If a copy of the MPL was not distributed with this</span>
<a href="#l24.8"></a><span id="l24.8" class="difflineminus">- * file, You can obtain one at http://mozilla.org/MPL/2.0/. */</span>
<a href="#l24.9"></a><span id="l24.9" class="difflineminus">-</span>
<a href="#l24.10"></a><span id="l24.10" class="difflineminus">-#include &quot;nsISupports.idl&quot;</span>
<a href="#l24.11"></a><span id="l24.11" class="difflineminus">-</span>
<a href="#l24.12"></a><span id="l24.12" class="difflineminus">-interface calIDateTime;</span>
<a href="#l24.13"></a><span id="l24.13" class="difflineminus">-interface calIItemBase;</span>
<a href="#l24.14"></a><span id="l24.14" class="difflineminus">-</span>
<a href="#l24.15"></a><span id="l24.15" class="difflineminus">-[scriptable, uuid(69741510-5f5d-11e4-9803-0800200c9a66)]</span>
<a href="#l24.16"></a><span id="l24.16" class="difflineminus">-interface calIDateTimeFormatter : nsISupports</span>
<a href="#l24.17"></a><span id="l24.17" class="difflineminus">-{</span>
<a href="#l24.18"></a><span id="l24.18" class="difflineminus">-    /**</span>
<a href="#l24.19"></a><span id="l24.19" class="difflineminus">-     * Format a date in either short or long format, depending on the</span>
<a href="#l24.20"></a><span id="l24.20" class="difflineminus">-     * users preference</span>
<a href="#l24.21"></a><span id="l24.21" class="difflineminus">-     *</span>
<a href="#l24.22"></a><span id="l24.22" class="difflineminus">-     * @see</span>
<a href="#l24.23"></a><span id="l24.23" class="difflineminus">-     *     formatDateShort</span>
<a href="#l24.24"></a><span id="l24.24" class="difflineminus">-     *     formatDateLong</span>
<a href="#l24.25"></a><span id="l24.25" class="difflineminus">-     */</span>
<a href="#l24.26"></a><span id="l24.26" class="difflineminus">-    AString formatDate(in calIDateTime aDate);</span>
<a href="#l24.27"></a><span id="l24.27" class="difflineminus">-</span>
<a href="#l24.28"></a><span id="l24.28" class="difflineminus">-    /**</span>
<a href="#l24.29"></a><span id="l24.29" class="difflineminus">-     * Format a date into a short format, for example</span>
<a href="#l24.30"></a><span id="l24.30" class="difflineminus">-     * &quot;12/17/2005&quot;</span>
<a href="#l24.31"></a><span id="l24.31" class="difflineminus">-     *</span>
<a href="#l24.32"></a><span id="l24.32" class="difflineminus">-     * @param aDate</span>
<a href="#l24.33"></a><span id="l24.33" class="difflineminus">-     *      the datetime to format</span>
<a href="#l24.34"></a><span id="l24.34" class="difflineminus">-     * @returns</span>
<a href="#l24.35"></a><span id="l24.35" class="difflineminus">-     *      a string representing the date part of the datetime</span>
<a href="#l24.36"></a><span id="l24.36" class="difflineminus">-     */</span>
<a href="#l24.37"></a><span id="l24.37" class="difflineminus">-    AString formatDateShort(in calIDateTime aDate);</span>
<a href="#l24.38"></a><span id="l24.38" class="difflineminus">-</span>
<a href="#l24.39"></a><span id="l24.39" class="difflineminus">-    /**</span>
<a href="#l24.40"></a><span id="l24.40" class="difflineminus">-     * Format a date into a long format, for example</span>
<a href="#l24.41"></a><span id="l24.41" class="difflineminus">-     * &quot;Sat Dec 17 2005&quot;</span>
<a href="#l24.42"></a><span id="l24.42" class="difflineminus">-     *</span>
<a href="#l24.43"></a><span id="l24.43" class="difflineminus">-     * @param aDate</span>
<a href="#l24.44"></a><span id="l24.44" class="difflineminus">-     *      the datetime to format</span>
<a href="#l24.45"></a><span id="l24.45" class="difflineminus">-     * @returns</span>
<a href="#l24.46"></a><span id="l24.46" class="difflineminus">-     *      a string representing the date part of the datetime</span>
<a href="#l24.47"></a><span id="l24.47" class="difflineminus">-     */</span>
<a href="#l24.48"></a><span id="l24.48" class="difflineminus">-    AString formatDateLong(in calIDateTime aDate);</span>
<a href="#l24.49"></a><span id="l24.49" class="difflineminus">-</span>
<a href="#l24.50"></a><span id="l24.50" class="difflineminus">-    /**</span>
<a href="#l24.51"></a><span id="l24.51" class="difflineminus">-     * Format a date into a short format without mentioning the year, for</span>
<a href="#l24.52"></a><span id="l24.52" class="difflineminus">-     * example &quot;Dec 17&quot;</span>
<a href="#l24.53"></a><span id="l24.53" class="difflineminus">-     *</span>
<a href="#l24.54"></a><span id="l24.54" class="difflineminus">-     * @param aDate</span>
<a href="#l24.55"></a><span id="l24.55" class="difflineminus">-     *      the datetime to format</span>
<a href="#l24.56"></a><span id="l24.56" class="difflineminus">-     * @returns</span>
<a href="#l24.57"></a><span id="l24.57" class="difflineminus">-     *      a string representing the date part of the datetime</span>
<a href="#l24.58"></a><span id="l24.58" class="difflineminus">-     */</span>
<a href="#l24.59"></a><span id="l24.59" class="difflineminus">-    AString formatDateWithoutYear(in calIDateTime aDate);</span>
<a href="#l24.60"></a><span id="l24.60" class="difflineminus">-</span>
<a href="#l24.61"></a><span id="l24.61" class="difflineminus">-    /**</span>
<a href="#l24.62"></a><span id="l24.62" class="difflineminus">-     * Format a time into the format specified by the OS settings.</span>
<a href="#l24.63"></a><span id="l24.63" class="difflineminus">-     * Will omit the seconds from the output.</span>
<a href="#l24.64"></a><span id="l24.64" class="difflineminus">-     *</span>
<a href="#l24.65"></a><span id="l24.65" class="difflineminus">-     * @param aDate</span>
<a href="#l24.66"></a><span id="l24.66" class="difflineminus">-     *      the datetime to format</span>
<a href="#l24.67"></a><span id="l24.67" class="difflineminus">-     * @returns</span>
<a href="#l24.68"></a><span id="l24.68" class="difflineminus">-     *      a string representing the time part of the datetime</span>
<a href="#l24.69"></a><span id="l24.69" class="difflineminus">-     */</span>
<a href="#l24.70"></a><span id="l24.70" class="difflineminus">-    AString formatTime(in calIDateTime aDate);</span>
<a href="#l24.71"></a><span id="l24.71" class="difflineminus">-</span>
<a href="#l24.72"></a><span id="l24.72" class="difflineminus">-    /**</span>
<a href="#l24.73"></a><span id="l24.73" class="difflineminus">-     * Format a datetime into the format specified by the OS settings.</span>
<a href="#l24.74"></a><span id="l24.74" class="difflineminus">-     * Will omit the seconds from the output.</span>
<a href="#l24.75"></a><span id="l24.75" class="difflineminus">-     *</span>
<a href="#l24.76"></a><span id="l24.76" class="difflineminus">-     * @param aDateTime</span>
<a href="#l24.77"></a><span id="l24.77" class="difflineminus">-     *      the datetime to format</span>
<a href="#l24.78"></a><span id="l24.78" class="difflineminus">-     * @returns</span>
<a href="#l24.79"></a><span id="l24.79" class="difflineminus">-     *      a string representing the datetime</span>
<a href="#l24.80"></a><span id="l24.80" class="difflineminus">-     */</span>
<a href="#l24.81"></a><span id="l24.81" class="difflineminus">-    AString formatDateTime(in calIDateTime aDate);</span>
<a href="#l24.82"></a><span id="l24.82" class="difflineminus">-</span>
<a href="#l24.83"></a><span id="l24.83" class="difflineminus">-    /**</span>
<a href="#l24.84"></a><span id="l24.84" class="difflineminus">-     * Format a time interval that is defined by an item with the default</span>
<a href="#l24.85"></a><span id="l24.85" class="difflineminus">-     * timezone Internally it calls &quot;formatInterval&quot; after retrieving</span>
<a href="#l24.86"></a><span id="l24.86" class="difflineminus">-     * the start/entry and end/due date of the item.</span>
<a href="#l24.87"></a><span id="l24.87" class="difflineminus">-     *</span>
<a href="#l24.88"></a><span id="l24.88" class="difflineminus">-     * @param aItem</span>
<a href="#l24.89"></a><span id="l24.89" class="difflineminus">-     *      The item describing the interval</span>
<a href="#l24.90"></a><span id="l24.90" class="difflineminus">-     */</span>
<a href="#l24.91"></a><span id="l24.91" class="difflineminus">-    AUTF8String formatItemInterval(in calIItemBase aItem);</span>
<a href="#l24.92"></a><span id="l24.92" class="difflineminus">-</span>
<a href="#l24.93"></a><span id="l24.93" class="difflineminus">-    /**</span>
<a href="#l24.94"></a><span id="l24.94" class="difflineminus">-     * Format a time interval like formatItemInterval, but only show times.</span>
<a href="#l24.95"></a><span id="l24.95" class="difflineminus">-     *</span>
<a href="#l24.96"></a><span id="l24.96" class="difflineminus">-     * @param aItem     The item providing the interval</span>
<a href="#l24.97"></a><span id="l24.97" class="difflineminus">-     * @return          The string describing the interval</span>
<a href="#l24.98"></a><span id="l24.98" class="difflineminus">-     */</span>
<a href="#l24.99"></a><span id="l24.99" class="difflineminus">-     AUTF8String formatItemTimeInterval(in calIItemBase aItem);</span>
<a href="#l24.100"></a><span id="l24.100" class="difflineminus">-</span>
<a href="#l24.101"></a><span id="l24.101" class="difflineminus">-    /**</span>
<a href="#l24.102"></a><span id="l24.102" class="difflineminus">-     * Format a date/time interval. The returned string may assume that the</span>
<a href="#l24.103"></a><span id="l24.103" class="difflineminus">-     * dates are so close to each other, that it can leave out some parts of the</span>
<a href="#l24.104"></a><span id="l24.104" class="difflineminus">-     * part string denoting the end date.</span>
<a href="#l24.105"></a><span id="l24.105" class="difflineminus">-     *</span>
<a href="#l24.106"></a><span id="l24.106" class="difflineminus">-     * @param aStartDate        The start of the interval</span>
<a href="#l24.107"></a><span id="l24.107" class="difflineminus">-     * @param aEndDate          The end of the interval</span>
<a href="#l24.108"></a><span id="l24.108" class="difflineminus">-     * @return                  A String describing the interval in a legible form</span>
<a href="#l24.109"></a><span id="l24.109" class="difflineminus">-     */</span>
<a href="#l24.110"></a><span id="l24.110" class="difflineminus">-    AUTF8String formatInterval(in calIDateTime aStartDate,</span>
<a href="#l24.111"></a><span id="l24.111" class="difflineminus">-                               in calIDateTime aEndDate);</span>
<a href="#l24.112"></a><span id="l24.112" class="difflineminus">-</span>
<a href="#l24.113"></a><span id="l24.113" class="difflineminus">-    /**</span>
<a href="#l24.114"></a><span id="l24.114" class="difflineminus">-     * Format a time interval like formatInterval, but show only the time.</span>
<a href="#l24.115"></a><span id="l24.115" class="difflineminus">-     *</span>
<a href="#l24.116"></a><span id="l24.116" class="difflineminus">-     * @param aStartDate        The start of the interval.</span>
<a href="#l24.117"></a><span id="l24.117" class="difflineminus">-     * @param aEndDate          The end of the interval.</span>
<a href="#l24.118"></a><span id="l24.118" class="difflineminus">-     * @return                  The formatted time interval.</span>
<a href="#l24.119"></a><span id="l24.119" class="difflineminus">-     */</span>
<a href="#l24.120"></a><span id="l24.120" class="difflineminus">-    AUTF8String formatTimeInterval(in calIDateTime aStartTime,</span>
<a href="#l24.121"></a><span id="l24.121" class="difflineminus">-                                   in calIDateTime aEndTime);</span>
<a href="#l24.122"></a><span id="l24.122" class="difflineminus">-</span>
<a href="#l24.123"></a><span id="l24.123" class="difflineminus">-    /**</span>
<a href="#l24.124"></a><span id="l24.124" class="difflineminus">-     * Get the monthday followed by its ordinal symbol in the current locale.</span>
<a href="#l24.125"></a><span id="l24.125" class="difflineminus">-     * e.g.  monthday 1 -&gt; 1st</span>
<a href="#l24.126"></a><span id="l24.126" class="difflineminus">-     *       monthday 2 -&gt; 2nd etc.</span>
<a href="#l24.127"></a><span id="l24.127" class="difflineminus">-     *</span>
<a href="#l24.128"></a><span id="l24.128" class="difflineminus">-     * @param aMonthdayIndex</span>
<a href="#l24.129"></a><span id="l24.129" class="difflineminus">-     *      a number from 1 to 31</span>
<a href="#l24.130"></a><span id="l24.130" class="difflineminus">-     * @returns</span>
<a href="#l24.131"></a><span id="l24.131" class="difflineminus">-     *      the monthday number in ordinal format in the current locale</span>
<a href="#l24.132"></a><span id="l24.132" class="difflineminus">-     */</span>
<a href="#l24.133"></a><span id="l24.133" class="difflineminus">-    AUTF8String formatDayWithOrdinal(in unsigned long aMonthdayIndex);</span>
<a href="#l24.134"></a><span id="l24.134" class="difflineminus">-</span>
<a href="#l24.135"></a><span id="l24.135" class="difflineminus">-    /**</span>
<a href="#l24.136"></a><span id="l24.136" class="difflineminus">-     * Get the month name</span>
<a href="#l24.137"></a><span id="l24.137" class="difflineminus">-     *</span>
<a href="#l24.138"></a><span id="l24.138" class="difflineminus">-     * @param aMonthIndex</span>
<a href="#l24.139"></a><span id="l24.139" class="difflineminus">-     *     zero-based month number (0 is january, 11 is december)</span>
<a href="#l24.140"></a><span id="l24.140" class="difflineminus">-     * @returns</span>
<a href="#l24.141"></a><span id="l24.141" class="difflineminus">-     *      the month name in the current locale</span>
<a href="#l24.142"></a><span id="l24.142" class="difflineminus">-     */</span>
<a href="#l24.143"></a><span id="l24.143" class="difflineminus">-    AString monthName(in unsigned long aMonthIndex);</span>
<a href="#l24.144"></a><span id="l24.144" class="difflineminus">-</span>
<a href="#l24.145"></a><span id="l24.145" class="difflineminus">-    /**</span>
<a href="#l24.146"></a><span id="l24.146" class="difflineminus">-     * Get the abbreviation of the month name</span>
<a href="#l24.147"></a><span id="l24.147" class="difflineminus">-     *</span>
<a href="#l24.148"></a><span id="l24.148" class="difflineminus">-     * @see monthName</span>
<a href="#l24.149"></a><span id="l24.149" class="difflineminus">-     */</span>
<a href="#l24.150"></a><span id="l24.150" class="difflineminus">-    AString shortMonthName(in unsigned long aMonthIndex);</span>
<a href="#l24.151"></a><span id="l24.151" class="difflineminus">-</span>
<a href="#l24.152"></a><span id="l24.152" class="difflineminus">-    /**</span>
<a href="#l24.153"></a><span id="l24.153" class="difflineminus">-     * Get the day name</span>
<a href="#l24.154"></a><span id="l24.154" class="difflineminus">-     * @param aMonthIndex</span>
<a href="#l24.155"></a><span id="l24.155" class="difflineminus">-     *     zero-based month number (0 is sunday, 6 is saturday)</span>
<a href="#l24.156"></a><span id="l24.156" class="difflineminus">-     * @returns</span>
<a href="#l24.157"></a><span id="l24.157" class="difflineminus">-     *      the day name in the current locale</span>
<a href="#l24.158"></a><span id="l24.158" class="difflineminus">-     */</span>
<a href="#l24.159"></a><span id="l24.159" class="difflineminus">-    AString dayName(in unsigned long aDayIndex);</span>
<a href="#l24.160"></a><span id="l24.160" class="difflineminus">-</span>
<a href="#l24.161"></a><span id="l24.161" class="difflineminus">-    /**</span>
<a href="#l24.162"></a><span id="l24.162" class="difflineminus">-     * Get the abbreviation of the day name</span>
<a href="#l24.163"></a><span id="l24.163" class="difflineminus">-     * @see dayName</span>
<a href="#l24.164"></a><span id="l24.164" class="difflineminus">-     */</span>
<a href="#l24.165"></a><span id="l24.165" class="difflineminus">-    AString shortDayName(in unsigned long aDayIndex);</span>
<a href="#l24.166"></a><span id="l24.166" class="difflineminus">-};</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l25.1"></a><span id="l25.1" class="difflineminus">--- a/calendar/base/public/moz.build</span>
<a href="#l25.2"></a><span id="l25.2" class="difflineplus">+++ b/calendar/base/public/moz.build</span>
<a href="#l25.3"></a><span id="l25.3" class="difflineat">@@ -12,17 +12,16 @@ XPIDL_SOURCES += [</span>
<a href="#l25.4"></a><span id="l25.4">     'calICalendarACLManager.idl',</span>
<a href="#l25.5"></a><span id="l25.5">     'calICalendarManager.idl',</span>
<a href="#l25.6"></a><span id="l25.6">     'calICalendarProvider.idl',</span>
<a href="#l25.7"></a><span id="l25.7">     'calICalendarSearchProvider.idl',</span>
<a href="#l25.8"></a><span id="l25.8">     'calICalendarView.idl',</span>
<a href="#l25.9"></a><span id="l25.9">     'calICalendarViewController.idl',</span>
<a href="#l25.10"></a><span id="l25.10">     'calIChangeLog.idl',</span>
<a href="#l25.11"></a><span id="l25.11">     'calIDateTime.idl',</span>
<a href="#l25.12"></a><span id="l25.12" class="difflineminus">-    'calIDateTimeFormatter.idl',</span>
<a href="#l25.13"></a><span id="l25.13">     'calIDeletedItems.idl',</span>
<a href="#l25.14"></a><span id="l25.14">     'calIDuration.idl',</span>
<a href="#l25.15"></a><span id="l25.15">     'calIErrors.idl',</span>
<a href="#l25.16"></a><span id="l25.16">     'calIEvent.idl',</span>
<a href="#l25.17"></a><span id="l25.17">     'calIFreeBusyProvider.idl',</span>
<a href="#l25.18"></a><span id="l25.18">     'calIIcsParser.idl',</span>
<a href="#l25.19"></a><span id="l25.19">     'calIIcsSerializer.idl',</span>
<a href="#l25.20"></a><span id="l25.20">     'calIICSService.idl',</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l26.1"></a><span id="l26.1" class="difflineminus">--- a/calendar/base/src/CalAlarm.jsm</span>
<a href="#l26.2"></a><span id="l26.2" class="difflineplus">+++ b/calendar/base/src/CalAlarm.jsm</span>
<a href="#l26.3"></a><span id="l26.3" class="difflineat">@@ -608,19 +608,18 @@ CalAlarm.prototype = {</span>
<a href="#l26.4"></a><span id="l26.4">         return aPrefix + &quot;Task&quot;;</span>
<a href="#l26.5"></a><span id="l26.5">       }</span>
<a href="#l26.6"></a><span id="l26.6">       return aPrefix;</span>
<a href="#l26.7"></a><span id="l26.7">     }</span>
<a href="#l26.8"></a><span id="l26.8"> </span>
<a href="#l26.9"></a><span id="l26.9">     if (this.related == ALARM_RELATED_ABSOLUTE &amp;&amp; this.mAbsoluteDate) {</span>
<a href="#l26.10"></a><span id="l26.10">       // this is an absolute alarm. Use the calendar default timezone and</span>
<a href="#l26.11"></a><span id="l26.11">       // format it.</span>
<a href="#l26.12"></a><span id="l26.12" class="difflineminus">-      let formatter = cal.getDateFormatter();</span>
<a href="#l26.13"></a><span id="l26.13">       let formatDate = this.mAbsoluteDate.getInTimezone(cal.dtz.defaultTimezone);</span>
<a href="#l26.14"></a><span id="l26.14" class="difflineminus">-      return formatter.formatDateTime(formatDate);</span>
<a href="#l26.15"></a><span id="l26.15" class="difflineplus">+      return cal.dtz.formatter.formatDateTime(formatDate);</span>
<a href="#l26.16"></a><span id="l26.16">     } else if (this.related != ALARM_RELATED_ABSOLUTE &amp;&amp; this.mOffset) {</span>
<a href="#l26.17"></a><span id="l26.17">       // Relative alarm length</span>
<a href="#l26.18"></a><span id="l26.18">       let alarmlen = Math.abs(this.mOffset.inSeconds / 60);</span>
<a href="#l26.19"></a><span id="l26.19">       if (alarmlen == 0) {</span>
<a href="#l26.20"></a><span id="l26.20">         // No need to get the other information if the alarm is at the start</span>
<a href="#l26.21"></a><span id="l26.21">         // of the event/task.</span>
<a href="#l26.22"></a><span id="l26.22">         if (this.related == ALARM_RELATED_START) {</span>
<a href="#l26.23"></a><span id="l26.23">           return cal.l10n.getString(&quot;calendar-alarms&quot;, alarmString(&quot;reminderTitleAtStart&quot;));</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l27.1"></a><span id="l27.1" class="difflineminus">--- a/calendar/base/src/CalIcsParser.jsm</span>
<a href="#l27.2"></a><span id="l27.2" class="difflineplus">+++ b/calendar/base/src/CalIcsParser.jsm</span>
<a href="#l27.3"></a><span id="l27.3" class="difflineat">@@ -229,17 +229,17 @@ parserState.prototype = {</span>
<a href="#l27.4"></a><span id="l27.4">       let tzid = date.timezone.tzid;</span>
<a href="#l27.5"></a><span id="l27.5">       let hid = item.hashId + &quot;#&quot; + tzid;</span>
<a href="#l27.6"></a><span id="l27.6">       if (!(hid in this.tzErrors)) {</span>
<a href="#l27.7"></a><span id="l27.7">         // For now, publish errors to console and alert user.</span>
<a href="#l27.8"></a><span id="l27.8">         // In future, maybe make them available through an interface method</span>
<a href="#l27.9"></a><span id="l27.9">         // so this UI code can be removed from the parser, and caller can</span>
<a href="#l27.10"></a><span id="l27.10">         // choose whether to alert, or show user the problem items and ask</span>
<a href="#l27.11"></a><span id="l27.11">         // for fixes, or something else.</span>
<a href="#l27.12"></a><span id="l27.12" class="difflineminus">-        let msgArgs = [tzid, item.title, cal.getDateFormatter().formatDateTime(date)];</span>
<a href="#l27.13"></a><span id="l27.13" class="difflineplus">+        let msgArgs = [tzid, item.title, cal.dtz.formatter.formatDateTime(date)];</span>
<a href="#l27.14"></a><span id="l27.14">         let msg = cal.l10n.getCalString(&quot;unknownTimezoneInItem&quot;, msgArgs);</span>
<a href="#l27.15"></a><span id="l27.15"> </span>
<a href="#l27.16"></a><span id="l27.16">         cal.ERROR(msg + &quot;\n&quot; + item.icalString);</span>
<a href="#l27.17"></a><span id="l27.17">         this.tzErrors[hid] = true;</span>
<a href="#l27.18"></a><span id="l27.18">       }</span>
<a href="#l27.19"></a><span id="l27.19">     }</span>
<a href="#l27.20"></a><span id="l27.20">   },</span>
<a href="#l27.21"></a><span id="l27.21"> </span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l28.1"></a><span id="l28.1" class="difflineminus">--- a/calendar/base/src/components.conf</span>
<a href="#l28.2"></a><span id="l28.2" class="difflineplus">+++ b/calendar/base/src/components.conf</span>
<a href="#l28.3"></a><span id="l28.3" class="difflineat">@@ -62,22 +62,16 @@ Classes = [</span>
<a href="#l28.4"></a><span id="l28.4">   },</span>
<a href="#l28.5"></a><span id="l28.5">   {</span>
<a href="#l28.6"></a><span id="l28.6">     'cid': '{f5f743cd-8997-428e-bc1b-644e73f61203}',</span>
<a href="#l28.7"></a><span id="l28.7">     'contract_ids': ['@mozilla.org/calendar/calendarsearch-service;1'],</span>
<a href="#l28.8"></a><span id="l28.8">     'jsm': 'resource:///modules/CalCalendarSearchService.jsm',</span>
<a href="#l28.9"></a><span id="l28.9">     'constructor': 'CalCalendarSearchService',</span>
<a href="#l28.10"></a><span id="l28.10">   },</span>
<a href="#l28.11"></a><span id="l28.11">   {</span>
<a href="#l28.12"></a><span id="l28.12" class="difflineminus">-    'cid': '{4123da9a-f047-42da-a7d0-cc4175b9f36a}',</span>
<a href="#l28.13"></a><span id="l28.13" class="difflineminus">-    'contract_ids': ['@mozilla.org/calendar/datetime-formatter;1'],</span>
<a href="#l28.14"></a><span id="l28.14" class="difflineminus">-    'jsm': 'resource:///modules/CalDateTimeFormatter.jsm',</span>
<a href="#l28.15"></a><span id="l28.15" class="difflineminus">-    'constructor': 'CalDateTimeFormatter',</span>
<a href="#l28.16"></a><span id="l28.16" class="difflineminus">-  },</span>
<a href="#l28.17"></a><span id="l28.17" class="difflineminus">-  {</span>
<a href="#l28.18"></a><span id="l28.18">     'cid': '{8e6799af-e7e9-4e6c-9a82-a2413e86d8c3}',</span>
<a href="#l28.19"></a><span id="l28.19">     'contract_ids': ['@mozilla.org/calendar/deleted-items-manager;1'],</span>
<a href="#l28.20"></a><span id="l28.20">     'jsm': 'resource:///modules/CalDeletedItems.jsm',</span>
<a href="#l28.21"></a><span id="l28.21">     'constructor': 'CalDeletedItems',</span>
<a href="#l28.22"></a><span id="l28.22">     'categories': {'profile-after-change': 'deleted-items-manager'},</span>
<a href="#l28.23"></a><span id="l28.23">   },</span>
<a href="#l28.24"></a><span id="l28.24">   {</span>
<a href="#l28.25"></a><span id="l28.25">     'cid': '{974339d5-ab86-4491-aaaf-2b2ca177c12b}',</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l29.1"></a><span id="l29.1" class="difflineminus">--- a/calendar/base/src/moz.build</span>
<a href="#l29.2"></a><span id="l29.2" class="difflineplus">+++ b/calendar/base/src/moz.build</span>
<a href="#l29.3"></a><span id="l29.3" class="difflineat">@@ -12,17 +12,16 @@ XPIDL_MODULE = 'calbaseinternal'</span>
<a href="#l29.4"></a><span id="l29.4"> EXTRA_JS_MODULES += [</span>
<a href="#l29.5"></a><span id="l29.5">     'CalAlarm.jsm',</span>
<a href="#l29.6"></a><span id="l29.6">     'CalAlarmMonitor.jsm',</span>
<a href="#l29.7"></a><span id="l29.7">     'CalAlarmService.jsm',</span>
<a href="#l29.8"></a><span id="l29.8">     'CalAttachment.jsm',</span>
<a href="#l29.9"></a><span id="l29.9">     'CalAttendee.jsm',</span>
<a href="#l29.10"></a><span id="l29.10">     'CalCalendarManager.jsm',</span>
<a href="#l29.11"></a><span id="l29.11">     'CalCalendarSearchService.jsm',</span>
<a href="#l29.12"></a><span id="l29.12" class="difflineminus">-    'CalDateTimeFormatter.jsm',</span>
<a href="#l29.13"></a><span id="l29.13">     'CalDefaultACLManager.jsm',</span>
<a href="#l29.14"></a><span id="l29.14">     'CalDeletedItems.jsm',</span>
<a href="#l29.15"></a><span id="l29.15">     'CalEvent.jsm',</span>
<a href="#l29.16"></a><span id="l29.16">     'CalFreeBusyService.jsm',</span>
<a href="#l29.17"></a><span id="l29.17">     'CalIcsParser.jsm',</span>
<a href="#l29.18"></a><span id="l29.18">     'CalIcsSerializer.jsm',</span>
<a href="#l29.19"></a><span id="l29.19">     'CalItipItem.jsm',</span>
<a href="#l29.20"></a><span id="l29.20">     'CalProtocolHandler.jsm',</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l30.1"></a><span id="l30.1" class="difflineminus">--- a/calendar/import-export/CalHtmlExport.jsm</span>
<a href="#l30.2"></a><span id="l30.2" class="difflineplus">+++ b/calendar/import-export/CalHtmlExport.jsm</span>
<a href="#l30.3"></a><span id="l30.3" class="difflineat">@@ -72,17 +72,17 @@ CalHtmlExporter.prototype = {</span>
<a href="#l30.4"></a><span id="l30.4">       let startDate = item[cal.dtz.startDateProp(item)];</span>
<a href="#l30.5"></a><span id="l30.5">       let endDate = item[cal.dtz.endDateProp(item)];</span>
<a href="#l30.6"></a><span id="l30.6">       if (startDate || endDate) {</span>
<a href="#l30.7"></a><span id="l30.7">         // This is a task with a start or due date, format accordingly</span>
<a href="#l30.8"></a><span id="l30.8">         let prefixWhen = cal.l10n.getCalString(&quot;htmlPrefixWhen&quot;);</span>
<a href="#l30.9"></a><span id="l30.9">         itemNode.querySelector(&quot;.intervalkey&quot;).textContent = prefixWhen;</span>
<a href="#l30.10"></a><span id="l30.10"> </span>
<a href="#l30.11"></a><span id="l30.11">         let startNode = itemNode.querySelector(&quot;.dtstart&quot;);</span>
<a href="#l30.12"></a><span id="l30.12" class="difflineminus">-        let dateString = cal.getDateFormatter().formatItemInterval(item);</span>
<a href="#l30.13"></a><span id="l30.13" class="difflineplus">+        let dateString = cal.dtz.formatter.formatItemInterval(item);</span>
<a href="#l30.14"></a><span id="l30.14">         startNode.setAttribute(&quot;title&quot;, startDate ? startDate.icalString : &quot;none&quot;);</span>
<a href="#l30.15"></a><span id="l30.15">         startNode.textContent = dateString;</span>
<a href="#l30.16"></a><span id="l30.16">       } else {</span>
<a href="#l30.17"></a><span id="l30.17">         let row = itemNode.querySelector(&quot;.intervalrow&quot;);</span>
<a href="#l30.18"></a><span id="l30.18">         row.remove();</span>
<a href="#l30.19"></a><span id="l30.19">         if (</span>
<a href="#l30.20"></a><span id="l30.20">           row.nextSibling &amp;&amp;</span>
<a href="#l30.21"></a><span id="l30.21">           (row.nextSibling.nodeType == row.nextSibling.TEXT_NODE ||</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l31.1"></a><span id="l31.1" class="difflineminus">--- a/calendar/import-export/CalWeekPrinter.jsm</span>
<a href="#l31.2"></a><span id="l31.2" class="difflineplus">+++ b/calendar/import-export/CalWeekPrinter.jsm</span>
<a href="#l31.3"></a><span id="l31.3" class="difflineat">@@ -113,17 +113,16 @@ CalWeekPrinter.prototype = {</span>
<a href="#l31.4"></a><span id="l31.4"> </span>
<a href="#l31.5"></a><span id="l31.5">     // Clone the template week and make sure it doesn't have an id</span>
<a href="#l31.6"></a><span id="l31.6">     let currentPage = weekTemplate.cloneNode(true);</span>
<a href="#l31.7"></a><span id="l31.7">     currentPage.removeAttribute(&quot;id&quot;);</span>
<a href="#l31.8"></a><span id="l31.8">     currentPage.item = startOfWeek.clone();</span>
<a href="#l31.9"></a><span id="l31.9"> </span>
<a href="#l31.10"></a><span id="l31.10">     // Set up the week number title</span>
<a href="#l31.11"></a><span id="l31.11">     let weekInfo = cal.getWeekInfoService();</span>
<a href="#l31.12"></a><span id="l31.12" class="difflineminus">-    let dateFormatter = cal.getDateFormatter();</span>
<a href="#l31.13"></a><span id="l31.13">     let weekno = weekInfo.getWeekTitle(startOfWeek);</span>
<a href="#l31.14"></a><span id="l31.14">     let weekTitle = cal.l10n.getCalString(&quot;WeekTitle&quot;, [weekno]);</span>
<a href="#l31.15"></a><span id="l31.15">     currentPage.querySelector(&quot;.week-number&quot;).textContent = weekTitle;</span>
<a href="#l31.16"></a><span id="l31.16"> </span>
<a href="#l31.17"></a><span id="l31.17">     // Set up the day boxes</span>
<a href="#l31.18"></a><span id="l31.18">     let endOfWeek = weekInfo.getEndOfWeek(startOfWeek);</span>
<a href="#l31.19"></a><span id="l31.19">     for (</span>
<a href="#l31.20"></a><span id="l31.20">       let currentDate = startOfWeek.clone();</span>
<a href="#l31.21"></a><span id="l31.21" class="difflineat">@@ -133,17 +132,17 @@ CalWeekPrinter.prototype = {</span>
<a href="#l31.22"></a><span id="l31.22">       let weekday = currentDate.weekday;</span>
<a href="#l31.23"></a><span id="l31.23">       let weekdayName = weekdayMap[weekday];</span>
<a href="#l31.24"></a><span id="l31.24">       let dayOffPrefName = &quot;calendar.week.d&quot; + weekday + weekdayName + &quot;soff&quot;;</span>
<a href="#l31.25"></a><span id="l31.25">       dayTable[cal.print.getDateKey(currentDate)] = currentPage.querySelector(</span>
<a href="#l31.26"></a><span id="l31.26">         &quot;.&quot; + weekdayName + &quot;-container&quot;</span>
<a href="#l31.27"></a><span id="l31.27">       );</span>
<a href="#l31.28"></a><span id="l31.28"> </span>
<a href="#l31.29"></a><span id="l31.29">       let titleNode = currentPage.querySelector(&quot;.&quot; + weekdayName + &quot;-title&quot;);</span>
<a href="#l31.30"></a><span id="l31.30" class="difflineminus">-      titleNode.textContent = dateFormatter.formatDateLong(</span>
<a href="#l31.31"></a><span id="l31.31" class="difflineplus">+      titleNode.textContent = cal.dtz.formatter.formatDateLong(</span>
<a href="#l31.32"></a><span id="l31.32">         currentDate.getInTimezone(defaultTimezone)</span>
<a href="#l31.33"></a><span id="l31.33">       );</span>
<a href="#l31.34"></a><span id="l31.34"> </span>
<a href="#l31.35"></a><span id="l31.35">       if (Services.prefs.getBoolPref(dayOffPrefName, false)) {</span>
<a href="#l31.36"></a><span id="l31.36">         let daysOffNode = currentPage.querySelector(&quot;.&quot; + weekdayName + &quot;-box&quot;);</span>
<a href="#l31.37"></a><span id="l31.37">         daysOffNode.className += &quot; day-off&quot;;</span>
<a href="#l31.38"></a><span id="l31.38">       }</span>
<a href="#l31.39"></a><span id="l31.39">     }</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l32.1"></a><span id="l32.1" class="difflineminus">--- a/calendar/lightning/content/lightning-item-iframe.js</span>
<a href="#l32.2"></a><span id="l32.2" class="difflineplus">+++ b/calendar/lightning/content/lightning-item-iframe.js</span>
<a href="#l32.3"></a><span id="l32.3" class="difflineat">@@ -4297,18 +4297,17 @@ function lookupCounterLabel(aProperty) {</span>
<a href="#l32.4"></a><span id="l32.4">  */</span>
<a href="#l32.5"></a><span id="l32.5"> function formatCounterValue(aProperty) {</span>
<a href="#l32.6"></a><span id="l32.6">   const dateProps = [&quot;DTSTART&quot;, &quot;DTEND&quot;];</span>
<a href="#l32.7"></a><span id="l32.7">   const stringProps = [&quot;SUMMARY&quot;, &quot;LOCATION&quot;];</span>
<a href="#l32.8"></a><span id="l32.8"> </span>
<a href="#l32.9"></a><span id="l32.9">   let val;</span>
<a href="#l32.10"></a><span id="l32.10">   if (dateProps.includes(aProperty.property)) {</span>
<a href="#l32.11"></a><span id="l32.11">     let localTime = aProperty.proposed.getInTimezone(cal.dtz.defaultTimezone);</span>
<a href="#l32.12"></a><span id="l32.12" class="difflineminus">-    let formatter = cal.getDateFormatter();</span>
<a href="#l32.13"></a><span id="l32.13" class="difflineminus">-    val = formatter.formatDateTime(localTime);</span>
<a href="#l32.14"></a><span id="l32.14" class="difflineplus">+    val = cal.dtz.formatter.formatDateTime(localTime);</span>
<a href="#l32.15"></a><span id="l32.15">     if (gTimezonesEnabled) {</span>
<a href="#l32.16"></a><span id="l32.16">       let tzone = localTime.timezone.displayName || localTime.timezone.tzid;</span>
<a href="#l32.17"></a><span id="l32.17">       val += &quot; &quot; + tzone;</span>
<a href="#l32.18"></a><span id="l32.18">     }</span>
<a href="#l32.19"></a><span id="l32.19">   } else if (stringProps.includes(aProperty.property)) {</span>
<a href="#l32.20"></a><span id="l32.20">     val = aProperty.proposed;</span>
<a href="#l32.21"></a><span id="l32.21">   } else {</span>
<a href="#l32.22"></a><span id="l32.22">     cal.LOG(</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l33.1"></a><span id="l33.1" class="difflineminus">--- a/calendar/lightning/modules/ltnInvitationUtils.jsm</span>
<a href="#l33.2"></a><span id="l33.2" class="difflineplus">+++ b/calendar/lightning/modules/ltnInvitationUtils.jsm</span>
<a href="#l33.3"></a><span id="l33.3" class="difflineat">@@ -72,17 +72,17 @@ ltn.invitation = {</span>
<a href="#l33.4"></a><span id="l33.4">    *</span>
<a href="#l33.5"></a><span id="l33.5">    * @param  {calIItemBase} aEvent     The event to parse into html.</span>
<a href="#l33.6"></a><span id="l33.6">    * @param  {calItipItem}  aItipItem  The itip item, which contains aEvent.</span>
<a href="#l33.7"></a><span id="l33.7">    * @return {DOM}                     The html representation of aEvent.</span>
<a href="#l33.8"></a><span id="l33.8">    */</span>
<a href="#l33.9"></a><span id="l33.9">   createInvitationOverlay(aEvent, aItipItem) {</span>
<a href="#l33.10"></a><span id="l33.10">     // Creates HTML using the Node strings in the properties file</span>
<a href="#l33.11"></a><span id="l33.11">     let doc = cal.xml.parseFile(&quot;chrome://lightning/content/lightning-invitation.xhtml&quot;);</span>
<a href="#l33.12"></a><span id="l33.12" class="difflineminus">-    let formatter = cal.getDateFormatter();</span>
<a href="#l33.13"></a><span id="l33.13" class="difflineplus">+    let formatter = cal.dtz.formatter;</span>
<a href="#l33.14"></a><span id="l33.14"> </span>
<a href="#l33.15"></a><span id="l33.15">     let linkConverter = Cc[&quot;@mozilla.org/txttohtmlconv;1&quot;].getService(Ci.mozITXTToHTMLConv);</span>
<a href="#l33.16"></a><span id="l33.16"> </span>
<a href="#l33.17"></a><span id="l33.17">     let field = function(aField, aContentText, aConvert) {</span>
<a href="#l33.18"></a><span id="l33.18">       let descr = doc.getElementById(&quot;imipHtml-&quot; + aField + &quot;-descr&quot;);</span>
<a href="#l33.19"></a><span id="l33.19">       if (descr) {</span>
<a href="#l33.20"></a><span id="l33.20">         let labelText = cal.l10n.getLtnString(&quot;imipHtml.&quot; + aField);</span>
<a href="#l33.21"></a><span id="l33.21">         descr.textContent = labelText;</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l34.1"></a><span id="l34.1" class="difflineminus">--- a/calendar/resources/content/datetimepickers/datetimepickers.js</span>
<a href="#l34.2"></a><span id="l34.2" class="difflineplus">+++ b/calendar/resources/content/datetimepickers/datetimepickers.js</span>
<a href="#l34.3"></a><span id="l34.3" class="difflineat">@@ -1494,16 +1494,16 @@</span>
<a href="#l34.4"></a><span id="l34.4">     amRegExp = new RegExp(&quot;^(?:&quot; + amExpr + &quot;)$&quot;);</span>
<a href="#l34.5"></a><span id="l34.5">     pmRegExp = new RegExp(&quot;^(?:&quot; + pmExpr + &quot;)$&quot;);</span>
<a href="#l34.6"></a><span id="l34.6">   }</span>
<a href="#l34.7"></a><span id="l34.7"> </span>
<a href="#l34.8"></a><span id="l34.8">   function formatDate(aDate, aTimezone) {</span>
<a href="#l34.9"></a><span id="l34.9">     // Usually, floating is ok here, so no need to pass aTimezone - we just need to pass</span>
<a href="#l34.10"></a><span id="l34.10">     // it in if we need to make sure formatting happens without a timezone conversion.</span>
<a href="#l34.11"></a><span id="l34.11">     let timezone = aTimezone || cal.dtz.floating;</span>
<a href="#l34.12"></a><span id="l34.12" class="difflineminus">-    return cal.getDateFormatter().formatDateShort(cal.dtz.jsDateToDateTime(aDate, timezone));</span>
<a href="#l34.13"></a><span id="l34.13" class="difflineplus">+    return cal.dtz.formatter.formatDateShort(cal.dtz.jsDateToDateTime(aDate, timezone));</span>
<a href="#l34.14"></a><span id="l34.14">   }</span>
<a href="#l34.15"></a><span id="l34.15"> </span>
<a href="#l34.16"></a><span id="l34.16">   function formatTime(aValue) {</span>
<a href="#l34.17"></a><span id="l34.17">     let formatter = new Services.intl.DateTimeFormat(undefined, { timeStyle: &quot;short&quot; });</span>
<a href="#l34.18"></a><span id="l34.18">     return formatter.format(aValue);</span>
<a href="#l34.19"></a><span id="l34.19">   }</span>
<a href="#l34.20"></a><span id="l34.20"> }</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l35.1"></a><span id="l35.1" class="difflineminus">--- a/calendar/resources/content/mouseoverPreviews.js</span>
<a href="#l35.2"></a><span id="l35.2" class="difflineplus">+++ b/calendar/resources/content/mouseoverPreviews.js</span>
<a href="#l35.3"></a><span id="l35.3" class="difflineat">@@ -321,30 +321,30 @@ function boxAppendBody(box, textString, </span>
<a href="#l35.4"></a><span id="l35.4">  * and to header table append a row containing localized Label: date.</span>
<a href="#l35.5"></a><span id="l35.5">  *</span>
<a href="#l35.6"></a><span id="l35.6">  * @param {Node}         box            The node to add the date label to</span>
<a href="#l35.7"></a><span id="l35.7">  * @param {String}       labelProperty  The label</span>
<a href="#l35.8"></a><span id="l35.8">  * @param {calIDateTime} date           The datetime object to format and add</span>
<a href="#l35.9"></a><span id="l35.9">  */</span>
<a href="#l35.10"></a><span id="l35.10"> function boxAppendLabeledDateTime(box, labelProperty, date) {</span>
<a href="#l35.11"></a><span id="l35.11">   date = date.getInTimezone(cal.dtz.defaultTimezone);</span>
<a href="#l35.12"></a><span id="l35.12" class="difflineminus">-  let formattedDateTime = cal.getDateFormatter().formatDateTime(date);</span>
<a href="#l35.13"></a><span id="l35.13" class="difflineplus">+  let formattedDateTime = cal.dtz.formatter.formatDateTime(date);</span>
<a href="#l35.14"></a><span id="l35.14">   boxAppendLabeledText(box, labelProperty, formattedDateTime);</span>
<a href="#l35.15"></a><span id="l35.15"> }</span>
<a href="#l35.16"></a><span id="l35.16"> </span>
<a href="#l35.17"></a><span id="l35.17"> /**</span>
<a href="#l35.18"></a><span id="l35.18">  * PRIVATE: Use dateFormatter to format date and time interval,</span>
<a href="#l35.19"></a><span id="l35.19">  * and to header table append a row containing localized Label: interval.</span>
<a href="#l35.20"></a><span id="l35.20">  *</span>
<a href="#l35.21"></a><span id="l35.21">  * @param box               contains header table.</span>
<a href="#l35.22"></a><span id="l35.22">  * @param labelProperty     name of property for localized field label.</span>
<a href="#l35.23"></a><span id="l35.23">  * @param item              the event or task</span>
<a href="#l35.24"></a><span id="l35.24">  */</span>
<a href="#l35.25"></a><span id="l35.25"> function boxAppendLabeledDateTimeInterval(box, labelProperty, item) {</span>
<a href="#l35.26"></a><span id="l35.26" class="difflineminus">-  let dateString = cal.getDateFormatter().formatItemInterval(item);</span>
<a href="#l35.27"></a><span id="l35.27" class="difflineplus">+  let dateString = cal.dtz.formatter.formatItemInterval(item);</span>
<a href="#l35.28"></a><span id="l35.28">   boxAppendLabeledText(box, labelProperty, dateString);</span>
<a href="#l35.29"></a><span id="l35.29"> }</span>
<a href="#l35.30"></a><span id="l35.30"> </span>
<a href="#l35.31"></a><span id="l35.31"> /**</span>
<a href="#l35.32"></a><span id="l35.32">  * PRIVATE: create empty 2-column table for header fields, and append it to box.</span>
<a href="#l35.33"></a><span id="l35.33">  *</span>
<a href="#l35.34"></a><span id="l35.34">  * @param  {Node}  box  The node to create a column table for</span>
<a href="#l35.35"></a><span id="l35.35">  */</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l36.1"></a><span id="l36.1" class="difflineminus">--- a/calendar/test/browser/browser_basicFunctionality.js</span>
<a href="#l36.2"></a><span id="l36.2" class="difflineplus">+++ b/calendar/test/browser/browser_basicFunctionality.js</span>
<a href="#l36.3"></a><span id="l36.3" class="difflineat">@@ -54,17 +54,17 @@ add_task(function testBasicFunctionality</span>
<a href="#l36.4"></a><span id="l36.4">   // There should be search field.</span>
<a href="#l36.5"></a><span id="l36.5">   controller.assertNode(eid(&quot;unifinder-search-field&quot;));</span>
<a href="#l36.6"></a><span id="l36.6"> </span>
<a href="#l36.7"></a><span id="l36.7">   switchToView(controller, &quot;day&quot;);</span>
<a href="#l36.8"></a><span id="l36.8"> </span>
<a href="#l36.9"></a><span id="l36.9">   // Default view is day view which should have 09:00 label and box.</span>
<a href="#l36.10"></a><span id="l36.10">   let someTime = cal.createDateTime();</span>
<a href="#l36.11"></a><span id="l36.11">   someTime.resetTo(someTime.year, someTime.month, someTime.day, 9, 0, 0, someTime.timezone);</span>
<a href="#l36.12"></a><span id="l36.12" class="difflineminus">-  let label = cal.getDateFormatter().formatTime(someTime);</span>
<a href="#l36.13"></a><span id="l36.13" class="difflineplus">+  let label = cal.dtz.formatter.formatTime(someTime);</span>
<a href="#l36.14"></a><span id="l36.14">   controller.assertNode(</span>
<a href="#l36.15"></a><span id="l36.15">     lookup(`</span>
<a href="#l36.16"></a><span id="l36.16">         ${DAY_VIEW}/{&quot;class&quot;:&quot;mainbox&quot;}/{&quot;class&quot;:&quot;scrollbox&quot;}/</span>
<a href="#l36.17"></a><span id="l36.17">         {&quot;class&quot;:&quot;timebar&quot;}/{&quot;class&quot;:&quot;timebarboxstack&quot;}/{&quot;class&quot;:&quot;topbox&quot;}/[9]/</span>
<a href="#l36.18"></a><span id="l36.18">         {&quot;class&quot;:&quot;calendar-time-bar-label&quot;,&quot;value&quot;:&quot;${label}&quot;}</span>
<a href="#l36.19"></a><span id="l36.19">     `)</span>
<a href="#l36.20"></a><span id="l36.20">   );</span>
<a href="#l36.21"></a><span id="l36.21">   controller.assertNode(</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l37.1"></a><span id="l37.1" class="difflineminus">--- a/calendar/test/browser/browser_eventDisplay.js</span>
<a href="#l37.2"></a><span id="l37.2" class="difflineplus">+++ b/calendar/test/browser/browser_eventDisplay.js</span>
<a href="#l37.3"></a><span id="l37.3" class="difflineat">@@ -7,17 +7,17 @@ var { CALENDARNAME, createCalendar, dele</span>
<a href="#l37.4"></a><span id="l37.4"> );</span>
<a href="#l37.5"></a><span id="l37.5"> </span>
<a href="#l37.6"></a><span id="l37.6"> var mozmill = ChromeUtils.import(&quot;resource://testing-common/mozmill/mozmill.jsm&quot;);</span>
<a href="#l37.7"></a><span id="l37.7"> var controller = mozmill.getMail3PaneController();</span>
<a href="#l37.8"></a><span id="l37.8"> </span>
<a href="#l37.9"></a><span id="l37.9"> var calendarId = createCalendar(controller, CALENDARNAME);</span>
<a href="#l37.10"></a><span id="l37.10"> var calendar = cal.async.promisifyCalendar(cal.getCalendarManager().getCalendarById(calendarId));</span>
<a href="#l37.11"></a><span id="l37.11"> </span>
<a href="#l37.12"></a><span id="l37.12" class="difflineminus">-let formatter = cal.getDateFormatter();</span>
<a href="#l37.13"></a><span id="l37.13" class="difflineplus">+let formatter = cal.dtz.formatter;</span>
<a href="#l37.14"></a><span id="l37.14"> let startTime = formatter.formatTime(cal.createDateTime(&quot;20190403T123400&quot;));</span>
<a href="#l37.15"></a><span id="l37.15"> let endTime = formatter.formatTime(cal.createDateTime(&quot;20190403T234500&quot;));</span>
<a href="#l37.16"></a><span id="l37.16"> </span>
<a href="#l37.17"></a><span id="l37.17"> Services.prefs.setIntPref(&quot;calendar.week.start&quot;, 1);</span>
<a href="#l37.18"></a><span id="l37.18"> </span>
<a href="#l37.19"></a><span id="l37.19"> /**</span>
<a href="#l37.20"></a><span id="l37.20">  * Test an event that occurs within one day, in the day view.</span>
<a href="#l37.21"></a><span id="l37.21">  */</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l38.1"></a><span id="l38.1" class="difflineminus">--- a/calendar/test/browser/browser_todayPane.js</span>
<a href="#l38.2"></a><span id="l38.2" class="difflineplus">+++ b/calendar/test/browser/browser_todayPane.js</span>
<a href="#l38.3"></a><span id="l38.3" class="difflineat">@@ -101,17 +101,17 @@ add_task(async function testTodayPane() </span>
<a href="#l38.4"></a><span id="l38.4">   let listChildren = agendaListbox.agendaListboxControl.children;</span>
<a href="#l38.5"></a><span id="l38.5">   Assert.equal(listChildren.length, 7);</span>
<a href="#l38.6"></a><span id="l38.6">   Assert.equal(listChildren[0].localName, &quot;menupopup&quot;);</span>
<a href="#l38.7"></a><span id="l38.7">   Assert.equal(listChildren[1].id, &quot;today-header&quot;);</span>
<a href="#l38.8"></a><span id="l38.8">   Assert.equal(listChildren[3].id, &quot;tomorrow-header&quot;);</span>
<a href="#l38.9"></a><span id="l38.9">   Assert.equal(listChildren[5].id, &quot;nextweek-header&quot;);</span>
<a href="#l38.10"></a><span id="l38.10"> </span>
<a href="#l38.11"></a><span id="l38.11">   // Verify events shown in today pane.</span>
<a href="#l38.12"></a><span id="l38.12" class="difflineminus">-  let dateFormatter = cal.getDateFormatter();</span>
<a href="#l38.13"></a><span id="l38.13" class="difflineplus">+  let dateFormatter = cal.dtz.formatter;</span>
<a href="#l38.14"></a><span id="l38.14"> </span>
<a href="#l38.15"></a><span id="l38.15">   let startString = dateFormatter.formatTime(todaysEvent.startDate, cal.dtz.defaultTimezone);</span>
<a href="#l38.16"></a><span id="l38.16">   Assert.equal(</span>
<a href="#l38.17"></a><span id="l38.17">     listChildren[2].querySelector(&quot;.agenda-event-start&quot;).textContent,</span>
<a href="#l38.18"></a><span id="l38.18">     `${startString} Today's Event`</span>
<a href="#l38.19"></a><span id="l38.19">   );</span>
<a href="#l38.20"></a><span id="l38.20"> </span>
<a href="#l38.21"></a><span id="l38.21">   startString = dateFormatter.formatTime(tomorrowsEvent.startDate, cal.dtz.defaultTimezone);</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l39.1"></a><span id="l39.1" class="difflineminus">--- a/calendar/test/browser/eventDialog/browser_eventDialog.js</span>
<a href="#l39.2"></a><span id="l39.2" class="difflineplus">+++ b/calendar/test/browser/eventDialog/browser_eventDialog.js</span>
<a href="#l39.3"></a><span id="l39.3" class="difflineat">@@ -36,17 +36,16 @@ var { eid, lookup, lookupEventBox } = he</span>
<a href="#l39.4"></a><span id="l39.4"> const EVENTTITLE = &quot;Event&quot;;</span>
<a href="#l39.5"></a><span id="l39.5"> const EVENTLOCATION = &quot;Location&quot;;</span>
<a href="#l39.6"></a><span id="l39.6"> const EVENTDESCRIPTION = &quot;Event Description&quot;;</span>
<a href="#l39.7"></a><span id="l39.7"> const EVENTATTENDEE = &quot;foo@bar.com&quot;;</span>
<a href="#l39.8"></a><span id="l39.8"> const EVENTURL = &quot;http://mozilla.org/&quot;;</span>
<a href="#l39.9"></a><span id="l39.9"> var firstDay;</span>
<a href="#l39.10"></a><span id="l39.10"> </span>
<a href="#l39.11"></a><span id="l39.11"> add_task(async function testEventDialog() {</span>
<a href="#l39.12"></a><span id="l39.12" class="difflineminus">-  let dateFormatter = cal.getDateFormatter();</span>
<a href="#l39.13"></a><span id="l39.13">   let now = new Date();</span>
<a href="#l39.14"></a><span id="l39.14"> </span>
<a href="#l39.15"></a><span id="l39.15">   createCalendar(controller, CALENDARNAME);</span>
<a href="#l39.16"></a><span id="l39.16">   // Since from other tests we may be elsewhere, make sure we start today.</span>
<a href="#l39.17"></a><span id="l39.17">   switchToView(controller, &quot;day&quot;);</span>
<a href="#l39.18"></a><span id="l39.18">   goToDate(controller, now.getFullYear(), now.getMonth() + 1, now.getDate());</span>
<a href="#l39.19"></a><span id="l39.19">   viewBack(controller, 1);</span>
<a href="#l39.20"></a><span id="l39.20"> </span>
<a href="#l39.21"></a><span id="l39.21" class="difflineat">@@ -57,27 +56,27 @@ add_task(async function testEventDialog(</span>
<a href="#l39.22"></a><span id="l39.22"> </span>
<a href="#l39.23"></a><span id="l39.23">   // Setup start- &amp; endTime.</span>
<a href="#l39.24"></a><span id="l39.24">   // Next full hour except last hour of the day.</span>
<a href="#l39.25"></a><span id="l39.25">   let hour = now.getHours();</span>
<a href="#l39.26"></a><span id="l39.26">   let startHour = hour == 23 ? hour : (hour + 1) % 24;</span>
<a href="#l39.27"></a><span id="l39.27"> </span>
<a href="#l39.28"></a><span id="l39.28">   let nextHour = cal.dtz.now();</span>
<a href="#l39.29"></a><span id="l39.29">   nextHour.resetTo(firstDay.year, firstDay.month, firstDay.day, startHour, 0, 0, cal.dtz.floating);</span>
<a href="#l39.30"></a><span id="l39.30" class="difflineminus">-  let startTime = dateFormatter.formatTime(nextHour);</span>
<a href="#l39.31"></a><span id="l39.31" class="difflineplus">+  let startTime = cal.dtz.formatter.formatTime(nextHour);</span>
<a href="#l39.32"></a><span id="l39.32">   nextHour.resetTo(</span>
<a href="#l39.33"></a><span id="l39.33">     firstDay.year,</span>
<a href="#l39.34"></a><span id="l39.34">     firstDay.month,</span>
<a href="#l39.35"></a><span id="l39.35">     firstDay.day,</span>
<a href="#l39.36"></a><span id="l39.36">     (startHour + 1) % 24,</span>
<a href="#l39.37"></a><span id="l39.37">     0,</span>
<a href="#l39.38"></a><span id="l39.38">     0,</span>
<a href="#l39.39"></a><span id="l39.39">     cal.dtz.floating</span>
<a href="#l39.40"></a><span id="l39.40">   );</span>
<a href="#l39.41"></a><span id="l39.41" class="difflineminus">-  let endTime = dateFormatter.formatTime(nextHour);</span>
<a href="#l39.42"></a><span id="l39.42" class="difflineplus">+  let endTime = cal.dtz.formatter.formatTime(nextHour);</span>
<a href="#l39.43"></a><span id="l39.43"> </span>
<a href="#l39.44"></a><span id="l39.44">   // Create new event on first day in view.</span>
<a href="#l39.45"></a><span id="l39.45">   controller.click(lookupEventBox(&quot;month&quot;, CANVAS_BOX, 1, 1, null));</span>
<a href="#l39.46"></a><span id="l39.46">   controller.mainMenu.click(&quot;#calendar-new-event-menuitem&quot;);</span>
<a href="#l39.47"></a><span id="l39.47"> </span>
<a href="#l39.48"></a><span id="l39.48">   await invokeEventDialog(controller, null, async (event, iframe) =&gt; {</span>
<a href="#l39.49"></a><span id="l39.49">     let { eid: eventid } = helpersForController(event);</span>
<a href="#l39.50"></a><span id="l39.50">     let { eid: iframeId } = helpersForController(iframe);</span>
<a href="#l39.51"></a><span id="l39.51" class="difflineat">@@ -222,17 +221,17 @@ function checkTooltip(row, col, startTim</span>
<a href="#l39.52"></a><span id="l39.52">   let eventName = lookup(`${toolTipTable}/[0]/[1]`);</span>
<a href="#l39.53"></a><span id="l39.53">   controller.assert(() =&gt; eventName.getNode().textContent == EVENTTITLE);</span>
<a href="#l39.54"></a><span id="l39.54"> </span>
<a href="#l39.55"></a><span id="l39.55">   // Check date and time.</span>
<a href="#l39.56"></a><span id="l39.56">   let dateTime = lookup(`${toolTipTable}/[2]/[1]`);</span>
<a href="#l39.57"></a><span id="l39.57"> </span>
<a href="#l39.58"></a><span id="l39.58">   let currDate = firstDay.clone();</span>
<a href="#l39.59"></a><span id="l39.59">   currDate.addDuration(cal.createDuration(`P${7 * (row - 1) + (col - 1)}D`));</span>
<a href="#l39.60"></a><span id="l39.60" class="difflineminus">-  let startDate = cal.getDateFormatter().formatDate(currDate);</span>
<a href="#l39.61"></a><span id="l39.61" class="difflineplus">+  let startDate = cal.dtz.formatter.formatDate(currDate);</span>
<a href="#l39.62"></a><span id="l39.62"> </span>
<a href="#l39.63"></a><span id="l39.63">   controller.assert(() =&gt; {</span>
<a href="#l39.64"></a><span id="l39.64">     let text = dateTime.getNode().textContent;</span>
<a href="#l39.65"></a><span id="l39.65">     dump(`${text} / ${startDate} ${startTime} -\n`);</span>
<a href="#l39.66"></a><span id="l39.66">     return text.includes(`${startDate} ${startTime} – `);</span>
<a href="#l39.67"></a><span id="l39.67">   });</span>
<a href="#l39.68"></a><span id="l39.68"> </span>
<a href="#l39.69"></a><span id="l39.69">   // This could be on the next day if it is 00:00.</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l40.1"></a><span id="l40.1" class="difflineminus">--- a/calendar/test/browser/recurrence/browser_weeklyUntil.js</span>
<a href="#l40.2"></a><span id="l40.2" class="difflineplus">+++ b/calendar/test/browser/recurrence/browser_weeklyUntil.js</span>
<a href="#l40.3"></a><span id="l40.3" class="difflineat">@@ -144,19 +144,17 @@ function setRecurrence(recurrence) {</span>
<a href="#l40.4"></a><span id="l40.4">   // Set until date.</span>
<a href="#l40.5"></a><span id="l40.5">   recurrence.radio(recid(&quot;recurrence-range-until&quot;));</span>
<a href="#l40.6"></a><span id="l40.6"> </span>
<a href="#l40.7"></a><span id="l40.7">   // Delete previous date.</span>
<a href="#l40.8"></a><span id="l40.8">   let untilInput = reclookup(REC_DLG_UNTIL_INPUT);</span>
<a href="#l40.9"></a><span id="l40.9">   recurrence.keypress(untilInput, &quot;a&quot;, { accelKey: true });</span>
<a href="#l40.10"></a><span id="l40.10">   recurrence.keypress(untilInput, &quot;VK_DELETE&quot;, {});</span>
<a href="#l40.11"></a><span id="l40.11"> </span>
<a href="#l40.12"></a><span id="l40.12" class="difflineminus">-  let dateFormatter = cal.getDateFormatter();</span>
<a href="#l40.13"></a><span id="l40.13" class="difflineminus">-</span>
<a href="#l40.14"></a><span id="l40.14" class="difflineminus">-  let endDateString = dateFormatter.formatDateShort(</span>
<a href="#l40.15"></a><span id="l40.15" class="difflineplus">+  let endDateString = cal.dtz.formatter.formatDateShort(</span>
<a href="#l40.16"></a><span id="l40.16">     cal.dtz.jsDateToDateTime(ENDDATE, cal.dtz.floating)</span>
<a href="#l40.17"></a><span id="l40.17">   );</span>
<a href="#l40.18"></a><span id="l40.18">   recsleep(SHORT_SLEEP);</span>
<a href="#l40.19"></a><span id="l40.19">   recurrence.type(untilInput, endDateString);</span>
<a href="#l40.20"></a><span id="l40.20"> </span>
<a href="#l40.21"></a><span id="l40.21">   recsleep(SHORT_SLEEP);</span>
<a href="#l40.22"></a><span id="l40.22">   // Move focus to ensure the date is selected.</span>
<a href="#l40.23"></a><span id="l40.23">   recurrence.keypress(untilInput, &quot;VK_TAB&quot;, {});</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l41.1"></a><span id="l41.1" class="difflineminus">--- a/calendar/test/browser/views/browser_dayView.js</span>
<a href="#l41.2"></a><span id="l41.2" class="difflineplus">+++ b/calendar/test/browser/views/browser_dayView.js</span>
<a href="#l41.3"></a><span id="l41.3" class="difflineat">@@ -29,18 +29,16 @@ var { cal } = ChromeUtils.import(&quot;resour</span>
<a href="#l41.4"></a><span id="l41.4"> var controller = mozmill.getMail3PaneController();</span>
<a href="#l41.5"></a><span id="l41.5"> var { lookup, lookupEventBox } = helpersForController(controller);</span>
<a href="#l41.6"></a><span id="l41.6"> </span>
<a href="#l41.7"></a><span id="l41.7"> const TITLE1 = &quot;Day View Event&quot;;</span>
<a href="#l41.8"></a><span id="l41.8"> const TITLE2 = &quot;Day View Event Changed&quot;;</span>
<a href="#l41.9"></a><span id="l41.9"> const DESC = &quot;Day View Event Description&quot;;</span>
<a href="#l41.10"></a><span id="l41.10"> </span>
<a href="#l41.11"></a><span id="l41.11"> add_task(async function testDayView() {</span>
<a href="#l41.12"></a><span id="l41.12" class="difflineminus">-  let dateFormatter = cal.getDateFormatter();</span>
<a href="#l41.13"></a><span id="l41.13" class="difflineminus">-</span>
<a href="#l41.14"></a><span id="l41.14">   createCalendar(controller, CALENDARNAME);</span>
<a href="#l41.15"></a><span id="l41.15">   switchToView(controller, &quot;day&quot;);</span>
<a href="#l41.16"></a><span id="l41.16">   goToDate(controller, 2009, 1, 1);</span>
<a href="#l41.17"></a><span id="l41.17"> </span>
<a href="#l41.18"></a><span id="l41.18">   // Verify date in view.</span>
<a href="#l41.19"></a><span id="l41.19">   let day = lookup(`${DAY_VIEW}/${LABELDAYBOX}/{&quot;flex&quot;:&quot;1&quot;}`);</span>
<a href="#l41.20"></a><span id="l41.20">   controller.waitFor(() =&gt; day.getNode().mDate.icalString == &quot;20090101&quot;);</span>
<a href="#l41.21"></a><span id="l41.21"> </span>
<a href="#l41.22"></a><span id="l41.22" class="difflineat">@@ -52,18 +50,18 @@ add_task(async function testDayView() {</span>
<a href="#l41.23"></a><span id="l41.23"> </span>
<a href="#l41.24"></a><span id="l41.24">     let startTimeInput = getDateTimePicker(&quot;STARTTIME&quot;);</span>
<a href="#l41.25"></a><span id="l41.25">     let startDateInput = getDateTimePicker(&quot;STARTDATE&quot;);</span>
<a href="#l41.26"></a><span id="l41.26"> </span>
<a href="#l41.27"></a><span id="l41.27">     // Check that the start time is correct.</span>
<a href="#l41.28"></a><span id="l41.28">     let someDate = cal.createDateTime();</span>
<a href="#l41.29"></a><span id="l41.29">     someDate.resetTo(2009, 0, 1, 8, 0, 0, cal.dtz.floating);</span>
<a href="#l41.30"></a><span id="l41.30">     event.waitForElement(startTimeInput);</span>
<a href="#l41.31"></a><span id="l41.31" class="difflineminus">-    event.assertValue(startTimeInput, dateFormatter.formatTime(someDate));</span>
<a href="#l41.32"></a><span id="l41.32" class="difflineminus">-    event.assertValue(startDateInput, dateFormatter.formatDateShort(someDate));</span>
<a href="#l41.33"></a><span id="l41.33" class="difflineplus">+    event.assertValue(startTimeInput, cal.dtz.formatter.formatTime(someDate));</span>
<a href="#l41.34"></a><span id="l41.34" class="difflineplus">+    event.assertValue(startDateInput, cal.dtz.formatter.formatDateShort(someDate));</span>
<a href="#l41.35"></a><span id="l41.35"> </span>
<a href="#l41.36"></a><span id="l41.36">     // Fill in title, description and calendar.</span>
<a href="#l41.37"></a><span id="l41.37">     await setData(event, iframe, {</span>
<a href="#l41.38"></a><span id="l41.38">       title: TITLE1,</span>
<a href="#l41.39"></a><span id="l41.39">       description: DESC,</span>
<a href="#l41.40"></a><span id="l41.40">       calendar: CALENDARNAME,</span>
<a href="#l41.41"></a><span id="l41.41">     });</span>
<a href="#l41.42"></a><span id="l41.42"> </span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l42.1"></a><span id="l42.1" class="difflineminus">--- a/calendar/test/browser/views/browser_monthView.js</span>
<a href="#l42.2"></a><span id="l42.2" class="difflineplus">+++ b/calendar/test/browser/views/browser_monthView.js</span>
<a href="#l42.3"></a><span id="l42.3" class="difflineat">@@ -27,18 +27,16 @@ var { cal } = ChromeUtils.import(&quot;resour</span>
<a href="#l42.4"></a><span id="l42.4"> var controller = mozmill.getMail3PaneController();</span>
<a href="#l42.5"></a><span id="l42.5"> var { lookup, lookupEventBox } = helpersForController(controller);</span>
<a href="#l42.6"></a><span id="l42.6"> </span>
<a href="#l42.7"></a><span id="l42.7"> const TITLE1 = &quot;Month View Event&quot;;</span>
<a href="#l42.8"></a><span id="l42.8"> const TITLE2 = &quot;Month View Event Changed&quot;;</span>
<a href="#l42.9"></a><span id="l42.9"> const DESC = &quot;Month View Event Description&quot;;</span>
<a href="#l42.10"></a><span id="l42.10"> </span>
<a href="#l42.11"></a><span id="l42.11"> add_task(async function testMonthView() {</span>
<a href="#l42.12"></a><span id="l42.12" class="difflineminus">-  let dateFormatter = cal.getDateFormatter();</span>
<a href="#l42.13"></a><span id="l42.13" class="difflineminus">-</span>
<a href="#l42.14"></a><span id="l42.14">   createCalendar(controller, CALENDARNAME);</span>
<a href="#l42.15"></a><span id="l42.15">   switchToView(controller, &quot;month&quot;);</span>
<a href="#l42.16"></a><span id="l42.16">   goToDate(controller, 2009, 1, 1);</span>
<a href="#l42.17"></a><span id="l42.17"> </span>
<a href="#l42.18"></a><span id="l42.18">   // Verify date.</span>
<a href="#l42.19"></a><span id="l42.19">   let day = lookup(`</span>
<a href="#l42.20"></a><span id="l42.20">         ${MONTH_VIEW}/{&quot;class&quot;:&quot;mainbox&quot;}/{&quot;class&quot;:&quot;monthgrid&quot;}/[0]/{&quot;selected&quot;:&quot;true&quot;}/[0]</span>
<a href="#l42.21"></a><span id="l42.21">     `);</span>
<a href="#l42.22"></a><span id="l42.22" class="difflineat">@@ -56,18 +54,18 @@ add_task(async function testMonthView() </span>
<a href="#l42.23"></a><span id="l42.23">     let startDateInput = getDateTimePicker(&quot;STARTDATE&quot;);</span>
<a href="#l42.24"></a><span id="l42.24"> </span>
<a href="#l42.25"></a><span id="l42.25">     // Check that the start time is correct.</span>
<a href="#l42.26"></a><span id="l42.26">     // Next full hour except last hour hour of the day.</span>
<a href="#l42.27"></a><span id="l42.27">     let nextHour = hour == 23 ? hour : (hour + 1) % 24;</span>
<a href="#l42.28"></a><span id="l42.28">     let someDate = cal.dtz.now();</span>
<a href="#l42.29"></a><span id="l42.29">     someDate.resetTo(2009, 0, 1, nextHour, 0, 0, cal.dtz.floating);</span>
<a href="#l42.30"></a><span id="l42.30">     event.waitForElement(startTimeInput);</span>
<a href="#l42.31"></a><span id="l42.31" class="difflineminus">-    event.assertValue(startTimeInput, dateFormatter.formatTime(someDate));</span>
<a href="#l42.32"></a><span id="l42.32" class="difflineminus">-    event.assertValue(startDateInput, dateFormatter.formatDateShort(someDate));</span>
<a href="#l42.33"></a><span id="l42.33" class="difflineplus">+    event.assertValue(startTimeInput, cal.dtz.formatter.formatTime(someDate));</span>
<a href="#l42.34"></a><span id="l42.34" class="difflineplus">+    event.assertValue(startDateInput, cal.dtz.formatter.formatDateShort(someDate));</span>
<a href="#l42.35"></a><span id="l42.35"> </span>
<a href="#l42.36"></a><span id="l42.36">     // Fill in title, description and calendar.</span>
<a href="#l42.37"></a><span id="l42.37">     await setData(event, iframe, {</span>
<a href="#l42.38"></a><span id="l42.38">       title: TITLE1,</span>
<a href="#l42.39"></a><span id="l42.39">       description: DESC,</span>
<a href="#l42.40"></a><span id="l42.40">       calendar: CALENDARNAME,</span>
<a href="#l42.41"></a><span id="l42.41">     });</span>
<a href="#l42.42"></a><span id="l42.42"> </span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l43.1"></a><span id="l43.1" class="difflineminus">--- a/calendar/test/browser/views/browser_multiweekView.js</span>
<a href="#l43.2"></a><span id="l43.2" class="difflineplus">+++ b/calendar/test/browser/views/browser_multiweekView.js</span>
<a href="#l43.3"></a><span id="l43.3" class="difflineat">@@ -27,18 +27,16 @@ var { cal } = ChromeUtils.import(&quot;resour</span>
<a href="#l43.4"></a><span id="l43.4"> var controller = mozmill.getMail3PaneController();</span>
<a href="#l43.5"></a><span id="l43.5"> var { lookup, lookupEventBox } = helpersForController(controller);</span>
<a href="#l43.6"></a><span id="l43.6"> </span>
<a href="#l43.7"></a><span id="l43.7"> const TITLE1 = &quot;Multiweek View Event&quot;;</span>
<a href="#l43.8"></a><span id="l43.8"> const TITLE2 = &quot;Multiweek View Event Changed&quot;;</span>
<a href="#l43.9"></a><span id="l43.9"> const DESC = &quot;Multiweek View Event Description&quot;;</span>
<a href="#l43.10"></a><span id="l43.10"> </span>
<a href="#l43.11"></a><span id="l43.11"> add_task(async function setupModule(module) {</span>
<a href="#l43.12"></a><span id="l43.12" class="difflineminus">-  let dateFormatter = cal.getDateFormatter();</span>
<a href="#l43.13"></a><span id="l43.13" class="difflineminus">-</span>
<a href="#l43.14"></a><span id="l43.14">   createCalendar(controller, CALENDARNAME);</span>
<a href="#l43.15"></a><span id="l43.15">   switchToView(controller, &quot;multiweek&quot;);</span>
<a href="#l43.16"></a><span id="l43.16">   goToDate(controller, 2009, 1, 1);</span>
<a href="#l43.17"></a><span id="l43.17"> </span>
<a href="#l43.18"></a><span id="l43.18">   // Verify date.</span>
<a href="#l43.19"></a><span id="l43.19">   let day = lookup(`</span>
<a href="#l43.20"></a><span id="l43.20">         ${MULTIWEEK_VIEW}/{&quot;class&quot;:&quot;mainbox&quot;}/{&quot;class&quot;:&quot;monthgrid&quot;}/[0]/{&quot;selected&quot;:&quot;true&quot;}/[0]</span>
<a href="#l43.21"></a><span id="l43.21">     `);</span>
<a href="#l43.22"></a><span id="l43.22" class="difflineat">@@ -56,18 +54,18 @@ add_task(async function setupModule(modu</span>
<a href="#l43.23"></a><span id="l43.23">     let startDateInput = getDateTimePicker(&quot;STARTDATE&quot;);</span>
<a href="#l43.24"></a><span id="l43.24"> </span>
<a href="#l43.25"></a><span id="l43.25">     // Check that the start time is correct.</span>
<a href="#l43.26"></a><span id="l43.26">     // Next full hour except last hour hour of the day.</span>
<a href="#l43.27"></a><span id="l43.27">     let nextHour = hour == 23 ? hour : (hour + 1) % 24;</span>
<a href="#l43.28"></a><span id="l43.28">     let someDate = cal.dtz.now();</span>
<a href="#l43.29"></a><span id="l43.29">     someDate.resetTo(2009, 0, 1, nextHour, 0, 0, cal.dtz.floating);</span>
<a href="#l43.30"></a><span id="l43.30">     event.waitForElement(startTimeInput);</span>
<a href="#l43.31"></a><span id="l43.31" class="difflineminus">-    event.assertValue(startTimeInput, dateFormatter.formatTime(someDate));</span>
<a href="#l43.32"></a><span id="l43.32" class="difflineminus">-    event.assertValue(startDateInput, dateFormatter.formatDateShort(someDate));</span>
<a href="#l43.33"></a><span id="l43.33" class="difflineplus">+    event.assertValue(startTimeInput, cal.dtz.formatter.formatTime(someDate));</span>
<a href="#l43.34"></a><span id="l43.34" class="difflineplus">+    event.assertValue(startDateInput, cal.dtz.formatter.formatDateShort(someDate));</span>
<a href="#l43.35"></a><span id="l43.35"> </span>
<a href="#l43.36"></a><span id="l43.36">     // Fill in title, description and calendar.</span>
<a href="#l43.37"></a><span id="l43.37">     await setData(event, iframe, {</span>
<a href="#l43.38"></a><span id="l43.38">       title: TITLE1,</span>
<a href="#l43.39"></a><span id="l43.39">       description: DESC,</span>
<a href="#l43.40"></a><span id="l43.40">       calendar: CALENDARNAME,</span>
<a href="#l43.41"></a><span id="l43.41">     });</span>
<a href="#l43.42"></a><span id="l43.42"> </span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l44.1"></a><span id="l44.1" class="difflineminus">--- a/calendar/test/browser/views/browser_weekView.js</span>
<a href="#l44.2"></a><span id="l44.2" class="difflineplus">+++ b/calendar/test/browser/views/browser_weekView.js</span>
<a href="#l44.3"></a><span id="l44.3" class="difflineat">@@ -28,18 +28,16 @@ var { cal } = ChromeUtils.import(&quot;resour</span>
<a href="#l44.4"></a><span id="l44.4"> var controller = mozmill.getMail3PaneController();</span>
<a href="#l44.5"></a><span id="l44.5"> var { lookup, lookupEventBox } = helpersForController(controller);</span>
<a href="#l44.6"></a><span id="l44.6"> </span>
<a href="#l44.7"></a><span id="l44.7"> var TITLE1 = &quot;Week View Event&quot;;</span>
<a href="#l44.8"></a><span id="l44.8"> var TITLE2 = &quot;Week View Event Changed&quot;;</span>
<a href="#l44.9"></a><span id="l44.9"> var DESC = &quot;Week View Event Description&quot;;</span>
<a href="#l44.10"></a><span id="l44.10"> </span>
<a href="#l44.11"></a><span id="l44.11"> add_task(async function testWeekView() {</span>
<a href="#l44.12"></a><span id="l44.12" class="difflineminus">-  let dateFormatter = cal.getDateFormatter();</span>
<a href="#l44.13"></a><span id="l44.13" class="difflineminus">-</span>
<a href="#l44.14"></a><span id="l44.14">   createCalendar(controller, CALENDARNAME);</span>
<a href="#l44.15"></a><span id="l44.15">   switchToView(controller, &quot;week&quot;);</span>
<a href="#l44.16"></a><span id="l44.16">   goToDate(controller, 2009, 1, 1);</span>
<a href="#l44.17"></a><span id="l44.17"> </span>
<a href="#l44.18"></a><span id="l44.18">   // Verify date.</span>
<a href="#l44.19"></a><span id="l44.19">   let day = lookup(`</span>
<a href="#l44.20"></a><span id="l44.20">         ${WEEK_VIEW}/{&quot;class&quot;:&quot;mainbox&quot;}/{&quot;class&quot;:&quot;headerbox&quot;}/</span>
<a href="#l44.21"></a><span id="l44.21">         {&quot;class&quot;:&quot;headerdaybox&quot;}/{&quot;selected&quot;:&quot;true&quot;}</span>
<a href="#l44.22"></a><span id="l44.22" class="difflineat">@@ -55,18 +53,18 @@ add_task(async function testWeekView() {</span>
<a href="#l44.23"></a><span id="l44.23"> </span>
<a href="#l44.24"></a><span id="l44.24">     let startTimeInput = getDateTimePicker(&quot;STARTTIME&quot;);</span>
<a href="#l44.25"></a><span id="l44.25">     let startDateInput = getDateTimePicker(&quot;STARTDATE&quot;);</span>
<a href="#l44.26"></a><span id="l44.26"> </span>
<a href="#l44.27"></a><span id="l44.27">     // Check that the start time is correct.</span>
<a href="#l44.28"></a><span id="l44.28">     event.waitForElement(startTimeInput);</span>
<a href="#l44.29"></a><span id="l44.29">     let someDate = cal.createDateTime();</span>
<a href="#l44.30"></a><span id="l44.30">     someDate.resetTo(2009, 0, 1, 8, 0, 0, cal.dtz.floating);</span>
<a href="#l44.31"></a><span id="l44.31" class="difflineminus">-    event.assertValue(startTimeInput, dateFormatter.formatTime(someDate));</span>
<a href="#l44.32"></a><span id="l44.32" class="difflineminus">-    event.assertValue(startDateInput, dateFormatter.formatDateShort(someDate));</span>
<a href="#l44.33"></a><span id="l44.33" class="difflineplus">+    event.assertValue(startTimeInput, cal.dtz.formatter.formatTime(someDate));</span>
<a href="#l44.34"></a><span id="l44.34" class="difflineplus">+    event.assertValue(startDateInput, cal.dtz.formatter.formatDateShort(someDate));</span>
<a href="#l44.35"></a><span id="l44.35"> </span>
<a href="#l44.36"></a><span id="l44.36">     // Fill in title, description and calendar.</span>
<a href="#l44.37"></a><span id="l44.37">     await setData(event, iframe, {</span>
<a href="#l44.38"></a><span id="l44.38">       title: TITLE1,</span>
<a href="#l44.39"></a><span id="l44.39">       description: DESC,</span>
<a href="#l44.40"></a><span id="l44.40">       calendar: CALENDARNAME,</span>
<a href="#l44.41"></a><span id="l44.41">     });</span>
<a href="#l44.42"></a><span id="l44.42"> </span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l45.1"></a><span id="l45.1" class="difflineminus">--- a/calendar/test/modules/ItemEditingHelpers.jsm</span>
<a href="#l45.2"></a><span id="l45.2" class="difflineplus">+++ b/calendar/test/modules/ItemEditingHelpers.jsm</span>
<a href="#l45.3"></a><span id="l45.3" class="difflineat">@@ -215,17 +215,17 @@ async function setData(dialog, iframe, d</span>
<a href="#l45.4"></a><span id="l45.4">   let startdateInput = getDateTimePicker(&quot;STARTDATE&quot;);</span>
<a href="#l45.5"></a><span id="l45.5">   let enddateInput = getDateTimePicker(&quot;ENDDATE&quot;);</span>
<a href="#l45.6"></a><span id="l45.6">   let starttimeInput = getDateTimePicker(&quot;STARTTIME&quot;);</span>
<a href="#l45.7"></a><span id="l45.7">   let endtimeInput = getDateTimePicker(&quot;ENDTIME&quot;);</span>
<a href="#l45.8"></a><span id="l45.8">   let completeddateInput = getDateTimePicker(&quot;COMPLETEDDATE&quot;);</span>
<a href="#l45.9"></a><span id="l45.9">   let percentCompleteInput = iframeLookup(PERCENT_COMPLETE_INPUT);</span>
<a href="#l45.10"></a><span id="l45.10">   let untilDateInput = getDateTimePicker(&quot;UNTILDATE&quot;);</span>
<a href="#l45.11"></a><span id="l45.11"> </span>
<a href="#l45.12"></a><span id="l45.12" class="difflineminus">-  let dateFormatter = cal.getDateFormatter();</span>
<a href="#l45.13"></a><span id="l45.13" class="difflineplus">+  let dateFormatter = cal.dtz.formatter;</span>
<a href="#l45.14"></a><span id="l45.14">   // Wait for input elements' values to be populated.</span>
<a href="#l45.15"></a><span id="l45.15">   await sleep(iframe.window);</span>
<a href="#l45.16"></a><span id="l45.16"> </span>
<a href="#l45.17"></a><span id="l45.17">   // title</span>
<a href="#l45.18"></a><span id="l45.18">   if (data.title !== undefined) {</span>
<a href="#l45.19"></a><span id="l45.19">     let titleInput = iframeid(&quot;item-title&quot;);</span>
<a href="#l45.20"></a><span id="l45.20">     replaceText(titleInput, data.title);</span>
<a href="#l45.21"></a><span id="l45.21">   }</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l46.1"></a><span id="l46.1" class="difflineminus">--- a/calendar/test/unit/test_datetimeformatter.js</span>
<a href="#l46.2"></a><span id="l46.2" class="difflineplus">+++ b/calendar/test/unit/test_datetimeformatter.js</span>
<a href="#l46.3"></a><span id="l46.3" class="difflineat">@@ -1,13 +1,14 @@</span>
<a href="#l46.4"></a><span id="l46.4"> /* This Source Code Form is subject to the terms of the Mozilla Public</span>
<a href="#l46.5"></a><span id="l46.5">  * License, v. 2.0. If a copy of the MPL was not distributed with this</span>
<a href="#l46.6"></a><span id="l46.6">  * file, You can obtain one at http://mozilla.org/MPL/2.0/. */</span>
<a href="#l46.7"></a><span id="l46.7"> </span>
<a href="#l46.8"></a><span id="l46.8"> var { Services } = ChromeUtils.import(&quot;resource://gre/modules/Services.jsm&quot;);</span>
<a href="#l46.9"></a><span id="l46.9" class="difflineplus">+var { formatter } = cal.dtz;</span>
<a href="#l46.10"></a><span id="l46.10"> </span>
<a href="#l46.11"></a><span id="l46.11"> function run_test() {</span>
<a href="#l46.12"></a><span id="l46.12">   do_calendar_startup(run_next_test);</span>
<a href="#l46.13"></a><span id="l46.13"> }</span>
<a href="#l46.14"></a><span id="l46.14"> </span>
<a href="#l46.15"></a><span id="l46.15"> // This test assumes the timezone of your system is not set to Pacific/Fakaofo or equivalent.</span>
<a href="#l46.16"></a><span id="l46.16"> </span>
<a href="#l46.17"></a><span id="l46.17"> // Time format is platform dependent, so we use alternative result sets here in 'expected'.</span>
<a href="#l46.18"></a><span id="l46.18" class="difflineat">@@ -48,20 +49,17 @@ add_task(async function formatDate_test(</span>
<a href="#l46.19"></a><span id="l46.19">   let i = 0;</span>
<a href="#l46.20"></a><span id="l46.20">   for (let test of data) {</span>
<a href="#l46.21"></a><span id="l46.21">     i++;</span>
<a href="#l46.22"></a><span id="l46.22">     Services.prefs.setIntPref(&quot;calendar.date.format&quot;, test.input.dateformat);</span>
<a href="#l46.23"></a><span id="l46.23">     let zone =</span>
<a href="#l46.24"></a><span id="l46.24">       test.input.timezone == &quot;floating&quot; ? cal.dtz.floating : tzs.getTimezone(test.input.timezone);</span>
<a href="#l46.25"></a><span id="l46.25">     let date = cal.createDateTime(test.input.datetime).getInTimezone(zone);</span>
<a href="#l46.26"></a><span id="l46.26"> </span>
<a href="#l46.27"></a><span id="l46.27" class="difflineminus">-    let dtFormatter = Cc[&quot;@mozilla.org/calendar/datetime-formatter;1&quot;].getService(</span>
<a href="#l46.28"></a><span id="l46.28" class="difflineminus">-      Ci.calIDateTimeFormatter</span>
<a href="#l46.29"></a><span id="l46.29" class="difflineminus">-    );</span>
<a href="#l46.30"></a><span id="l46.30" class="difflineminus">-    let formatted = dtFormatter.formatDate(date);</span>
<a href="#l46.31"></a><span id="l46.31" class="difflineplus">+    let formatted = formatter.formatDate(date);</span>
<a href="#l46.32"></a><span id="l46.32">     ok(</span>
<a href="#l46.33"></a><span id="l46.33">       test.expected.includes(formatted),</span>
<a href="#l46.34"></a><span id="l46.34">       &quot;(test #&quot; + i + &quot;: result '&quot; + formatted + &quot;', expected '&quot; + test.expected + &quot;')&quot;</span>
<a href="#l46.35"></a><span id="l46.35">     );</span>
<a href="#l46.36"></a><span id="l46.36">   }</span>
<a href="#l46.37"></a><span id="l46.37">   // let's reset the preferences</span>
<a href="#l46.38"></a><span id="l46.38">   Services.prefs.setStringPref(&quot;calendar.timezone.local&quot;, tzlocal);</span>
<a href="#l46.39"></a><span id="l46.39">   Services.prefs.setIntPref(&quot;calendar.date.format&quot;, dateformat);</span>
<a href="#l46.40"></a><span id="l46.40" class="difflineat">@@ -143,21 +141,17 @@ add_task(async function formatDateShort_</span>
<a href="#l46.41"></a><span id="l46.41">   let i = 0;</span>
<a href="#l46.42"></a><span id="l46.42">   for (let test of data) {</span>
<a href="#l46.43"></a><span id="l46.43">     i++;</span>
<a href="#l46.44"></a><span id="l46.44"> </span>
<a href="#l46.45"></a><span id="l46.45">     let zone =</span>
<a href="#l46.46"></a><span id="l46.46">       test.input.timezone == &quot;floating&quot; ? cal.dtz.floating : tzs.getTimezone(test.input.timezone);</span>
<a href="#l46.47"></a><span id="l46.47">     let date = cal.createDateTime(test.input.datetime).getInTimezone(zone);</span>
<a href="#l46.48"></a><span id="l46.48"> </span>
<a href="#l46.49"></a><span id="l46.49" class="difflineminus">-    let dtFormatter = Cc[&quot;@mozilla.org/calendar/datetime-formatter;1&quot;].getService(</span>
<a href="#l46.50"></a><span id="l46.50" class="difflineminus">-      Ci.calIDateTimeFormatter</span>
<a href="#l46.51"></a><span id="l46.51" class="difflineminus">-    );</span>
<a href="#l46.52"></a><span id="l46.52" class="difflineminus">-</span>
<a href="#l46.53"></a><span id="l46.53" class="difflineminus">-    let formatted = dtFormatter.formatDateShort(date);</span>
<a href="#l46.54"></a><span id="l46.54" class="difflineplus">+    let formatted = formatter.formatDateShort(date);</span>
<a href="#l46.55"></a><span id="l46.55">     ok(</span>
<a href="#l46.56"></a><span id="l46.56">       test.expected.includes(formatted),</span>
<a href="#l46.57"></a><span id="l46.57">       &quot;(test #&quot; + i + &quot;: result '&quot; + formatted + &quot;', expected '&quot; + test.expected + &quot;')&quot;</span>
<a href="#l46.58"></a><span id="l46.58">     );</span>
<a href="#l46.59"></a><span id="l46.59">   }</span>
<a href="#l46.60"></a><span id="l46.60">   // let's reset the preferences</span>
<a href="#l46.61"></a><span id="l46.61">   Services.prefs.setStringPref(&quot;calendar.timezone.local&quot;, tzlocal);</span>
<a href="#l46.62"></a><span id="l46.62">   Services.prefs.setIntPref(&quot;calendar.date.format&quot;, dateformat);</span>
<a href="#l46.63"></a><span id="l46.63" class="difflineat">@@ -239,21 +233,17 @@ add_task(async function formatDateLong_t</span>
<a href="#l46.64"></a><span id="l46.64">   let i = 0;</span>
<a href="#l46.65"></a><span id="l46.65">   for (let test of data) {</span>
<a href="#l46.66"></a><span id="l46.66">     i++;</span>
<a href="#l46.67"></a><span id="l46.67"> </span>
<a href="#l46.68"></a><span id="l46.68">     let zone =</span>
<a href="#l46.69"></a><span id="l46.69">       test.input.timezone == &quot;floating&quot; ? cal.dtz.floating : tzs.getTimezone(test.input.timezone);</span>
<a href="#l46.70"></a><span id="l46.70">     let date = cal.createDateTime(test.input.datetime).getInTimezone(zone);</span>
<a href="#l46.71"></a><span id="l46.71"> </span>
<a href="#l46.72"></a><span id="l46.72" class="difflineminus">-    let dtFormatter = Cc[&quot;@mozilla.org/calendar/datetime-formatter;1&quot;].getService(</span>
<a href="#l46.73"></a><span id="l46.73" class="difflineminus">-      Ci.calIDateTimeFormatter</span>
<a href="#l46.74"></a><span id="l46.74" class="difflineminus">-    );</span>
<a href="#l46.75"></a><span id="l46.75" class="difflineminus">-</span>
<a href="#l46.76"></a><span id="l46.76" class="difflineminus">-    let formatted = dtFormatter.formatDateLong(date);</span>
<a href="#l46.77"></a><span id="l46.77" class="difflineplus">+    let formatted = formatter.formatDateLong(date);</span>
<a href="#l46.78"></a><span id="l46.78">     ok(</span>
<a href="#l46.79"></a><span id="l46.79">       test.expected.includes(formatted),</span>
<a href="#l46.80"></a><span id="l46.80">       &quot;(test #&quot; + i + &quot;: result '&quot; + formatted + &quot;', expected '&quot; + test.expected + &quot;')&quot;</span>
<a href="#l46.81"></a><span id="l46.81">     );</span>
<a href="#l46.82"></a><span id="l46.82">   }</span>
<a href="#l46.83"></a><span id="l46.83">   // let's reset the preferences</span>
<a href="#l46.84"></a><span id="l46.84">   Services.prefs.setStringPref(&quot;calendar.timezone.local&quot;, tzlocal);</span>
<a href="#l46.85"></a><span id="l46.85">   Services.prefs.setIntPref(&quot;calendar.date.format&quot;, dateformat);</span>
<a href="#l46.86"></a><span id="l46.86" class="difflineat">@@ -335,21 +325,17 @@ add_task(async function formatDateWithou</span>
<a href="#l46.87"></a><span id="l46.87">   let i = 0;</span>
<a href="#l46.88"></a><span id="l46.88">   for (let test of data) {</span>
<a href="#l46.89"></a><span id="l46.89">     i++;</span>
<a href="#l46.90"></a><span id="l46.90"> </span>
<a href="#l46.91"></a><span id="l46.91">     let zone =</span>
<a href="#l46.92"></a><span id="l46.92">       test.input.timezone == &quot;floating&quot; ? cal.dtz.floating : tzs.getTimezone(test.input.timezone);</span>
<a href="#l46.93"></a><span id="l46.93">     let date = cal.createDateTime(test.input.datetime).getInTimezone(zone);</span>
<a href="#l46.94"></a><span id="l46.94"> </span>
<a href="#l46.95"></a><span id="l46.95" class="difflineminus">-    let dtFormatter = Cc[&quot;@mozilla.org/calendar/datetime-formatter;1&quot;].getService(</span>
<a href="#l46.96"></a><span id="l46.96" class="difflineminus">-      Ci.calIDateTimeFormatter</span>
<a href="#l46.97"></a><span id="l46.97" class="difflineminus">-    );</span>
<a href="#l46.98"></a><span id="l46.98" class="difflineminus">-</span>
<a href="#l46.99"></a><span id="l46.99" class="difflineminus">-    equal(dtFormatter.formatDateWithoutYear(date), test.expected, &quot;(test #&quot; + i + &quot;)&quot;);</span>
<a href="#l46.100"></a><span id="l46.100" class="difflineplus">+    equal(formatter.formatDateWithoutYear(date), test.expected, &quot;(test #&quot; + i + &quot;)&quot;);</span>
<a href="#l46.101"></a><span id="l46.101">   }</span>
<a href="#l46.102"></a><span id="l46.102">   // let's reset the preferences</span>
<a href="#l46.103"></a><span id="l46.103">   Services.prefs.setStringPref(&quot;calendar.timezone.local&quot;, tzlocal);</span>
<a href="#l46.104"></a><span id="l46.104">   Services.prefs.setIntPref(&quot;calendar.date.format&quot;, dateformat);</span>
<a href="#l46.105"></a><span id="l46.105">   Services.prefs.setBoolPref(&quot;intl.regional_prefs.use_os_locales&quot;, useOsLocale);</span>
<a href="#l46.106"></a><span id="l46.106"> });</span>
<a href="#l46.107"></a><span id="l46.107"> </span>
<a href="#l46.108"></a><span id="l46.108"> add_task(async function formatTime_test() {</span>
<a href="#l46.109"></a><span id="l46.109" class="difflineat">@@ -403,21 +389,17 @@ add_task(async function formatTime_test(</span>
<a href="#l46.110"></a><span id="l46.110">   let i = 0;</span>
<a href="#l46.111"></a><span id="l46.111">   for (let test of data) {</span>
<a href="#l46.112"></a><span id="l46.112">     i++;</span>
<a href="#l46.113"></a><span id="l46.113"> </span>
<a href="#l46.114"></a><span id="l46.114">     let zone =</span>
<a href="#l46.115"></a><span id="l46.115">       test.input.timezone == &quot;floating&quot; ? cal.dtz.floating : tzs.getTimezone(test.input.timezone);</span>
<a href="#l46.116"></a><span id="l46.116">     let date = cal.createDateTime(test.input.datetime).getInTimezone(zone);</span>
<a href="#l46.117"></a><span id="l46.117"> </span>
<a href="#l46.118"></a><span id="l46.118" class="difflineminus">-    let dtFormatter = Cc[&quot;@mozilla.org/calendar/datetime-formatter;1&quot;].getService(</span>
<a href="#l46.119"></a><span id="l46.119" class="difflineminus">-      Ci.calIDateTimeFormatter</span>
<a href="#l46.120"></a><span id="l46.120" class="difflineminus">-    );</span>
<a href="#l46.121"></a><span id="l46.121" class="difflineminus">-</span>
<a href="#l46.122"></a><span id="l46.122" class="difflineminus">-    let formatted = dtFormatter.formatTime(date);</span>
<a href="#l46.123"></a><span id="l46.123" class="difflineplus">+    let formatted = formatter.formatTime(date);</span>
<a href="#l46.124"></a><span id="l46.124">     ok(</span>
<a href="#l46.125"></a><span id="l46.125">       test.expected.includes(formatted),</span>
<a href="#l46.126"></a><span id="l46.126">       &quot;(test #&quot; + i + &quot;: result '&quot; + formatted + &quot;', expected '&quot; + test.expected + &quot;')&quot;</span>
<a href="#l46.127"></a><span id="l46.127">     );</span>
<a href="#l46.128"></a><span id="l46.128">   }</span>
<a href="#l46.129"></a><span id="l46.129">   // let's reset the preferences</span>
<a href="#l46.130"></a><span id="l46.130">   Services.prefs.setStringPref(&quot;calendar.timezone.local&quot;, tzlocal);</span>
<a href="#l46.131"></a><span id="l46.131">   Services.prefs.setBoolPref(&quot;intl.regional_prefs.use_os_locales&quot;, useOsLocale);</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l47.1"></a><span id="l47.1" class="difflineminus">--- a/calendar/test/unit/test_ltninvitationutils.js</span>
<a href="#l47.2"></a><span id="l47.2" class="difflineplus">+++ b/calendar/test/unit/test_ltninvitationutils.js</span>
<a href="#l47.3"></a><span id="l47.3" class="difflineat">@@ -1236,17 +1236,17 @@ add_task(async function parseCounter_tes</span>
<a href="#l47.4"></a><span id="l47.4">         }</span>
<a href="#l47.5"></a><span id="l47.5">       });</span>
<a href="#l47.6"></a><span id="l47.6">     }</span>
<a href="#l47.7"></a><span id="l47.7">     item = item.join(&quot;\r\n&quot;);</span>
<a href="#l47.8"></a><span id="l47.8">     return createEventFromIcalString(item);</span>
<a href="#l47.9"></a><span id="l47.9">   };</span>
<a href="#l47.10"></a><span id="l47.10"> </span>
<a href="#l47.11"></a><span id="l47.11">   let formatDt = function(aDateTime) {</span>
<a href="#l47.12"></a><span id="l47.12" class="difflineminus">-    let datetime = cal.getDateFormatter().formatDateTime(aDateTime);</span>
<a href="#l47.13"></a><span id="l47.13" class="difflineplus">+    let datetime = cal.dtz.formatter.formatDateTime(aDateTime);</span>
<a href="#l47.14"></a><span id="l47.14">     return datetime + &quot; &quot; + aDateTime.timezone.displayName;</span>
<a href="#l47.15"></a><span id="l47.15">   };</span>
<a href="#l47.16"></a><span id="l47.16"> </span>
<a href="#l47.17"></a><span id="l47.17">   for (let i = 1; i &lt;= data.length; i++) {</span>
<a href="#l47.18"></a><span id="l47.18">     let test = data[i - 1];</span>
<a href="#l47.19"></a><span id="l47.19">     let existingItem = getItem(test.input.existing);</span>
<a href="#l47.20"></a><span id="l47.20">     let proposedItem = getItem(test.input.proposed);</span>
<a href="#l47.21"></a><span id="l47.21">     let parsed = ltn.invitation.parseCounter(proposedItem, existingItem);</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l48.1"></a><span id="l48.1" class="difflineminus">--- a/calendar/test/unit/test_recur.js</span>
<a href="#l48.2"></a><span id="l48.2" class="difflineplus">+++ b/calendar/test/unit/test_recur.js</span>
<a href="#l48.3"></a><span id="l48.3" class="difflineat">@@ -35,17 +35,17 @@ function test_rules() {</span>
<a href="#l48.4"></a><span id="l48.4">     let end = createDate(2020, 0, 1);</span>
<a href="#l48.5"></a><span id="l48.5">     let recdates = event.recurrenceInfo.getOccurrenceDates(start, end, 0);</span>
<a href="#l48.6"></a><span id="l48.6">     let occurrences = event.recurrenceInfo.getOccurrences(start, end, 0);</span>
<a href="#l48.7"></a><span id="l48.7"> </span>
<a href="#l48.8"></a><span id="l48.8">     // Check number of items</span>
<a href="#l48.9"></a><span id="l48.9">     dump(&quot;Expected &quot; + expected.length + &quot; occurrences\n&quot;);</span>
<a href="#l48.10"></a><span id="l48.10">     dump(&quot;Got: &quot; + recdates.map(x =&gt; x.toString()) + &quot;\n&quot;);</span>
<a href="#l48.11"></a><span id="l48.11">     equal(recdates.length, expected.length);</span>
<a href="#l48.12"></a><span id="l48.12" class="difflineminus">-    let fmt = cal.getDateFormatter();</span>
<a href="#l48.13"></a><span id="l48.13" class="difflineplus">+    let fmt = cal.dtz.formatter;</span>
<a href="#l48.14"></a><span id="l48.14"> </span>
<a href="#l48.15"></a><span id="l48.15">     for (let i = 0; i &lt; expected.length; i++) {</span>
<a href="#l48.16"></a><span id="l48.16">       // Check each date</span>
<a href="#l48.17"></a><span id="l48.17">       let expectedDate = cal.createDateTime(expected[i]);</span>
<a href="#l48.18"></a><span id="l48.18">       dump(</span>
<a href="#l48.19"></a><span id="l48.19">         &quot;Expecting instance at &quot; + expectedDate + &quot;(&quot; + fmt.dayName(expectedDate.weekday) + &quot;)\n&quot;</span>
<a href="#l48.20"></a><span id="l48.20">       );</span>
<a href="#l48.21"></a><span id="l48.21">       dump(&quot;Recdate:&quot;);</span></pre></div></div>

<div class="page_footer">
<div class="page_footer_text">comm-central</div>
<div class="page_footer_text" style="padding-left: 10px">Deployed from <a href="https://hg.mozilla.org/hgcustom/version-control-tools/rev/4b0de666d1a4">4b0de666d1a4</a> at 2020-07-30T19:32:33Z.</div>
<div class="rss_logo">
<a href="/comm-central/rss-log">RSS</a>
<a href="/comm-central/atom-log">Atom</a>
</div>
<br />

</div>
</body>
</html>

