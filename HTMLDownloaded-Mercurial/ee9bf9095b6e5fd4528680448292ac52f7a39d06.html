<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en-US" lang="en-US">
<head>
<link rel="icon" href="/static/35f393d6769a/hgicon.png" type="image/png" />
<meta name="robots" content="index, nofollow"/>
<link rel="stylesheet" href="/static/35f393d6769a/style-gitweb.css" type="text/css" />

<style type="text/css">
div.feed {
  float: right;
}
a img {
  border-width: 0px;
}
div.log_link {
  width: 80px;
  background-color: white;
}

div.log_body {
  padding-left: 96px;
}
</style>
<script type="text/javascript" src="/static/35f393d6769a/mercurial.js"></script>

<meta property="og:image" content="/static/35f393d6769a/moz-logo-bw-rgb.svg"/>
<meta property="og:type" content="website"/>

<title>comm-central: changeset 10472:ee9bf9095b6e5fd4528680448292ac52f7a39d06</title>
<link rel="alternate" type="application/atom+xml"
   href="/comm-central/atom-log" title="Atom feed for comm-central"/>
<link rel="alternate" type="application/rss+xml"
   href="/comm-central/rss-log" title="RSS feed for comm-central"/>

<meta property="og:title" content="comm-central @ ee9bf9095b6e5fd4528680448292ac52f7a39d06" />
<meta property="og:url" content="/comm-central/rev/ee9bf9095b6e5fd4528680448292ac52f7a39d06" />
<meta property="og:description" content="fix bug 763008, update to YSI v3 API and add custom upgrade UI, r=bienvenu, ur-r=bwinton" />

</head>
<body>

<div class="page_header">
<div class="logo">
    <a href="https://developer.mozilla.org/en/docs/Mercurial">
        <img src="/static/35f393d6769a/moz-logo-bw-rgb.svg" alt="mercurial" />
    </a>
</div>
<a href="/">Mercurial</a> &gt; <a href="/comm-central">comm-central</a>  / changeset / ee9bf9095b6e5fd4528680448292ac52f7a39d06 
</div>

<div class="page_nav">
<div>
<a href="/comm-central/summary">summary</a> |
<a href="/comm-central/shortlog/ee9bf9095b6e5fd4528680448292ac52f7a39d06">shortlog</a> |
<a href="/comm-central/log/ee9bf9095b6e5fd4528680448292ac52f7a39d06">changelog</a> |
<a href="/comm-central/pushloghtml">pushlog</a> |
<a href="/comm-central/graph/ee9bf9095b6e5fd4528680448292ac52f7a39d06">graph</a> |
<a href="/comm-central/tags">tags</a> |
<a href="/comm-central/bookmarks">bookmarks</a> |
<a href="/comm-central/branches">branches</a> |
<a href="/comm-central/file/ee9bf9095b6e5fd4528680448292ac52f7a39d06">files</a> |
changeset |
<a href="/comm-central/raw-rev/ee9bf9095b6e5fd4528680448292ac52f7a39d06">raw</a>  | <a href="/comm-central/archive/ee9bf9095b6e5fd4528680448292ac52f7a39d06.zip">zip</a>  |
<a href="/comm-central/help">help</a>
</div>

<div class="search">
<form id="searchform" action="/comm-central/log">

<input name="rev" type="text" value="" size="40" />
<div id="hint">Find changesets by keywords (author, files, the commit message), revision
number or hash, or <a href="/comm-central/help/revsets">revset expression</a>.</div>
</form>
</div>
</div>

<div class="title">
fix <a href="https://bugzilla.mozilla.org/show_bug.cgi?id=763008">bug 763008</a>, update to YSI v3 API and add custom upgrade UI, r=bienvenu, ur-r=bwinton
<span class="logtags"></span>
</div>
<div class="title_text">
<table cellspacing="0">

<tr><td>author</td><td>&#77;&#97;&#120;&#105;&#109;&#32;&#66;&#97;&#122;&#32;&#60;&#109;&#98;&#97;&#122;&#64;&#99;&#111;&#100;&#101;&#109;&#105;&#110;&#100;&#101;&#114;&#115;&#46;&#99;&#111;&#109;&#62;</td></tr>
<tr><td></td><td class="date age">Tue, 19 Jun 2012 13:34:33 -0700</td></tr>

<tr>
 <td>changeset 10472</td>
 <td style="font-family:monospace"><a class="list" href="/comm-central/rev/ee9bf9095b6e5fd4528680448292ac52f7a39d06">ee9bf9095b6e5fd4528680448292ac52f7a39d06</a></td>
</tr>



<tr>
<td>parent 10471</td>
<td style="font-family:monospace">
<a class="list" href="/comm-central/rev/8c820d9d26126b9e3aa0a999e0ce789659dfacf5">8c820d9d26126b9e3aa0a999e0ce789659dfacf5</a>
</td>
</tr>

<tr>
<td>child 10473</td>
<td style="font-family:monospace">
<a class="list" href="/comm-central/rev/4468b7bdbd889e79fee38891075804ff2735530e">4468b7bdbd889e79fee38891075804ff2735530e</a>
</td>
</tr>
<tr><td>push id</td><td><a href="/comm-central/pushloghtml?changeset=ee9bf9095b6e5fd4528680448292ac52f7a39d06">7921</a></td></tr>
<tr><td>push user</td><td>bienvenu@nventure.com</td></tr>
<tr><td>push date</td><td class="date age">Tue, 19 Jun 2012 20:34:19 +0000</td></tr>

<tr><td>treeherder</td><td>comm-central@ee9bf9095b6e [<a href="https://treeherder.mozilla.org/#/jobs?repo=comm-central&revision=ee9bf9095b6e5fd4528680448292ac52f7a39d06">default view</a>] [<a href="https://treeherder.mozilla.org/#/jobs?repo=comm-central&revision=ee9bf9095b6e5fd4528680448292ac52f7a39d06&filter-resultStatus=testfailed&filter-resultStatus=busted&filter-resultStatus=exception">failures only]</td></tr>
<tr><td>perfherder</td><td>[<a href="https://treeherder.mozilla.org/perf.html#/compare?originalProject=comm-central&originalRevision=ee9bf9095b6e5fd4528680448292ac52f7a39d06&newProject=comm-central&newRevision=ee9bf9095b6e5fd4528680448292ac52f7a39d06&framework=1" target="_blank">talos</a>] [<a href="https://treeherder.mozilla.org/perf.html#/compare?originalProject=comm-central&originalRevision=ee9bf9095b6e5fd4528680448292ac52f7a39d06&newProject=comm-central&newRevision=ee9bf9095b6e5fd4528680448292ac52f7a39d06&framework=2" target="_blank">build metrics</a>] [<a href="https://treeherder.mozilla.org/perf.html#/compare?originalProject=comm-central&originalRevision=ee9bf9095b6e5fd4528680448292ac52f7a39d06&newProject=comm-central&newRevision=ee9bf9095b6e5fd4528680448292ac52f7a39d06&framework=6" target="_blank">platform microbench</a>] (compared to previous push)</td></tr>
<tr><td>reviewers</td><td><a href="/comm-central/log?rev=reviewer%28bienvenu%29&revcount=50">bienvenu</a></td></tr>
<tr><td>bugs</td><td><a href="https://bugzilla.mozilla.org/show_bug.cgi?id=763008">763008</a></td></tr>




</table></div>

<div class="page_body description">fix <a href="https://bugzilla.mozilla.org/show_bug.cgi?id=763008">bug 763008</a>, update to YSI v3 API and add custom upgrade UI, r=bienvenu, ur-r=bwinton</div>
<div class="list_head"></div>
<div class="title_text">
<table cellspacing="0">

<tr class="parity0">
<td><a class="list" href="/comm-central/diff/ee9bf9095b6e5fd4528680448292ac52f7a39d06/mail/components/cloudfile/content/YouSendIt/fileExceeds2GB.xul">mail/components/cloudfile/content/YouSendIt/fileExceeds2GB.xul</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/ee9bf9095b6e5fd4528680448292ac52f7a39d06/mail/components/cloudfile/content/YouSendIt/fileExceeds2GB.xul">file</a> |
<a href="/comm-central/annotate/ee9bf9095b6e5fd4528680448292ac52f7a39d06/mail/components/cloudfile/content/YouSendIt/fileExceeds2GB.xul">annotate</a> |
<a href="/comm-central/diff/ee9bf9095b6e5fd4528680448292ac52f7a39d06/mail/components/cloudfile/content/YouSendIt/fileExceeds2GB.xul">diff</a> |
<a href="/comm-central/comparison/ee9bf9095b6e5fd4528680448292ac52f7a39d06/mail/components/cloudfile/content/YouSendIt/fileExceeds2GB.xul">comparison</a> |
<a href="/comm-central/log/ee9bf9095b6e5fd4528680448292ac52f7a39d06/mail/components/cloudfile/content/YouSendIt/fileExceeds2GB.xul">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/ee9bf9095b6e5fd4528680448292ac52f7a39d06/mail/components/cloudfile/content/YouSendIt/fileExceedsLimit.js">mail/components/cloudfile/content/YouSendIt/fileExceedsLimit.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/ee9bf9095b6e5fd4528680448292ac52f7a39d06/mail/components/cloudfile/content/YouSendIt/fileExceedsLimit.js">file</a> |
<a href="/comm-central/annotate/ee9bf9095b6e5fd4528680448292ac52f7a39d06/mail/components/cloudfile/content/YouSendIt/fileExceedsLimit.js">annotate</a> |
<a href="/comm-central/diff/ee9bf9095b6e5fd4528680448292ac52f7a39d06/mail/components/cloudfile/content/YouSendIt/fileExceedsLimit.js">diff</a> |
<a href="/comm-central/comparison/ee9bf9095b6e5fd4528680448292ac52f7a39d06/mail/components/cloudfile/content/YouSendIt/fileExceedsLimit.js">comparison</a> |
<a href="/comm-central/log/ee9bf9095b6e5fd4528680448292ac52f7a39d06/mail/components/cloudfile/content/YouSendIt/fileExceedsLimit.js">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/ee9bf9095b6e5fd4528680448292ac52f7a39d06/mail/components/cloudfile/content/YouSendIt/fileExceedsLimit.xul">mail/components/cloudfile/content/YouSendIt/fileExceedsLimit.xul</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/ee9bf9095b6e5fd4528680448292ac52f7a39d06/mail/components/cloudfile/content/YouSendIt/fileExceedsLimit.xul">file</a> |
<a href="/comm-central/annotate/ee9bf9095b6e5fd4528680448292ac52f7a39d06/mail/components/cloudfile/content/YouSendIt/fileExceedsLimit.xul">annotate</a> |
<a href="/comm-central/diff/ee9bf9095b6e5fd4528680448292ac52f7a39d06/mail/components/cloudfile/content/YouSendIt/fileExceedsLimit.xul">diff</a> |
<a href="/comm-central/comparison/ee9bf9095b6e5fd4528680448292ac52f7a39d06/mail/components/cloudfile/content/YouSendIt/fileExceedsLimit.xul">comparison</a> |
<a href="/comm-central/log/ee9bf9095b6e5fd4528680448292ac52f7a39d06/mail/components/cloudfile/content/YouSendIt/fileExceedsLimit.xul">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/ee9bf9095b6e5fd4528680448292ac52f7a39d06/mail/components/cloudfile/content/YouSendIt/fileExceedsQuota.js">mail/components/cloudfile/content/YouSendIt/fileExceedsQuota.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/ee9bf9095b6e5fd4528680448292ac52f7a39d06/mail/components/cloudfile/content/YouSendIt/fileExceedsQuota.js">file</a> |
<a href="/comm-central/annotate/ee9bf9095b6e5fd4528680448292ac52f7a39d06/mail/components/cloudfile/content/YouSendIt/fileExceedsQuota.js">annotate</a> |
<a href="/comm-central/diff/ee9bf9095b6e5fd4528680448292ac52f7a39d06/mail/components/cloudfile/content/YouSendIt/fileExceedsQuota.js">diff</a> |
<a href="/comm-central/comparison/ee9bf9095b6e5fd4528680448292ac52f7a39d06/mail/components/cloudfile/content/YouSendIt/fileExceedsQuota.js">comparison</a> |
<a href="/comm-central/log/ee9bf9095b6e5fd4528680448292ac52f7a39d06/mail/components/cloudfile/content/YouSendIt/fileExceedsQuota.js">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/ee9bf9095b6e5fd4528680448292ac52f7a39d06/mail/components/cloudfile/content/YouSendIt/fileExceedsQuota.xul">mail/components/cloudfile/content/YouSendIt/fileExceedsQuota.xul</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/ee9bf9095b6e5fd4528680448292ac52f7a39d06/mail/components/cloudfile/content/YouSendIt/fileExceedsQuota.xul">file</a> |
<a href="/comm-central/annotate/ee9bf9095b6e5fd4528680448292ac52f7a39d06/mail/components/cloudfile/content/YouSendIt/fileExceedsQuota.xul">annotate</a> |
<a href="/comm-central/diff/ee9bf9095b6e5fd4528680448292ac52f7a39d06/mail/components/cloudfile/content/YouSendIt/fileExceedsQuota.xul">diff</a> |
<a href="/comm-central/comparison/ee9bf9095b6e5fd4528680448292ac52f7a39d06/mail/components/cloudfile/content/YouSendIt/fileExceedsQuota.xul">comparison</a> |
<a href="/comm-central/log/ee9bf9095b6e5fd4528680448292ac52f7a39d06/mail/components/cloudfile/content/YouSendIt/fileExceedsQuota.xul">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/ee9bf9095b6e5fd4528680448292ac52f7a39d06/mail/components/cloudfile/content/YouSendIt/settings.xhtml">mail/components/cloudfile/content/YouSendIt/settings.xhtml</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/ee9bf9095b6e5fd4528680448292ac52f7a39d06/mail/components/cloudfile/content/YouSendIt/settings.xhtml">file</a> |
<a href="/comm-central/annotate/ee9bf9095b6e5fd4528680448292ac52f7a39d06/mail/components/cloudfile/content/YouSendIt/settings.xhtml">annotate</a> |
<a href="/comm-central/diff/ee9bf9095b6e5fd4528680448292ac52f7a39d06/mail/components/cloudfile/content/YouSendIt/settings.xhtml">diff</a> |
<a href="/comm-central/comparison/ee9bf9095b6e5fd4528680448292ac52f7a39d06/mail/components/cloudfile/content/YouSendIt/settings.xhtml">comparison</a> |
<a href="/comm-central/log/ee9bf9095b6e5fd4528680448292ac52f7a39d06/mail/components/cloudfile/content/YouSendIt/settings.xhtml">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/ee9bf9095b6e5fd4528680448292ac52f7a39d06/mail/components/cloudfile/jar.mn">mail/components/cloudfile/jar.mn</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/ee9bf9095b6e5fd4528680448292ac52f7a39d06/mail/components/cloudfile/jar.mn">file</a> |
<a href="/comm-central/annotate/ee9bf9095b6e5fd4528680448292ac52f7a39d06/mail/components/cloudfile/jar.mn">annotate</a> |
<a href="/comm-central/diff/ee9bf9095b6e5fd4528680448292ac52f7a39d06/mail/components/cloudfile/jar.mn">diff</a> |
<a href="/comm-central/comparison/ee9bf9095b6e5fd4528680448292ac52f7a39d06/mail/components/cloudfile/jar.mn">comparison</a> |
<a href="/comm-central/log/ee9bf9095b6e5fd4528680448292ac52f7a39d06/mail/components/cloudfile/jar.mn">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/ee9bf9095b6e5fd4528680448292ac52f7a39d06/mail/components/cloudfile/nsIMsgCloudFileProvider.idl">mail/components/cloudfile/nsIMsgCloudFileProvider.idl</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/ee9bf9095b6e5fd4528680448292ac52f7a39d06/mail/components/cloudfile/nsIMsgCloudFileProvider.idl">file</a> |
<a href="/comm-central/annotate/ee9bf9095b6e5fd4528680448292ac52f7a39d06/mail/components/cloudfile/nsIMsgCloudFileProvider.idl">annotate</a> |
<a href="/comm-central/diff/ee9bf9095b6e5fd4528680448292ac52f7a39d06/mail/components/cloudfile/nsIMsgCloudFileProvider.idl">diff</a> |
<a href="/comm-central/comparison/ee9bf9095b6e5fd4528680448292ac52f7a39d06/mail/components/cloudfile/nsIMsgCloudFileProvider.idl">comparison</a> |
<a href="/comm-central/log/ee9bf9095b6e5fd4528680448292ac52f7a39d06/mail/components/cloudfile/nsIMsgCloudFileProvider.idl">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/ee9bf9095b6e5fd4528680448292ac52f7a39d06/mail/components/cloudfile/nsYouSendIt.js">mail/components/cloudfile/nsYouSendIt.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/ee9bf9095b6e5fd4528680448292ac52f7a39d06/mail/components/cloudfile/nsYouSendIt.js">file</a> |
<a href="/comm-central/annotate/ee9bf9095b6e5fd4528680448292ac52f7a39d06/mail/components/cloudfile/nsYouSendIt.js">annotate</a> |
<a href="/comm-central/diff/ee9bf9095b6e5fd4528680448292ac52f7a39d06/mail/components/cloudfile/nsYouSendIt.js">diff</a> |
<a href="/comm-central/comparison/ee9bf9095b6e5fd4528680448292ac52f7a39d06/mail/components/cloudfile/nsYouSendIt.js">comparison</a> |
<a href="/comm-central/log/ee9bf9095b6e5fd4528680448292ac52f7a39d06/mail/components/cloudfile/nsYouSendIt.js">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/ee9bf9095b6e5fd4528680448292ac52f7a39d06/mail/components/compose/content/MsgComposeCommands.js">mail/components/compose/content/MsgComposeCommands.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/ee9bf9095b6e5fd4528680448292ac52f7a39d06/mail/components/compose/content/MsgComposeCommands.js">file</a> |
<a href="/comm-central/annotate/ee9bf9095b6e5fd4528680448292ac52f7a39d06/mail/components/compose/content/MsgComposeCommands.js">annotate</a> |
<a href="/comm-central/diff/ee9bf9095b6e5fd4528680448292ac52f7a39d06/mail/components/compose/content/MsgComposeCommands.js">diff</a> |
<a href="/comm-central/comparison/ee9bf9095b6e5fd4528680448292ac52f7a39d06/mail/components/compose/content/MsgComposeCommands.js">comparison</a> |
<a href="/comm-central/log/ee9bf9095b6e5fd4528680448292ac52f7a39d06/mail/components/compose/content/MsgComposeCommands.js">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/ee9bf9095b6e5fd4528680448292ac52f7a39d06/mail/locales/en-US/chrome/messenger/cloudfile/YouSendIt/fileExceeds2GB.dtd">mail/locales/en-US/chrome/messenger/cloudfile/YouSendIt/fileExceeds2GB.dtd</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/ee9bf9095b6e5fd4528680448292ac52f7a39d06/mail/locales/en-US/chrome/messenger/cloudfile/YouSendIt/fileExceeds2GB.dtd">file</a> |
<a href="/comm-central/annotate/ee9bf9095b6e5fd4528680448292ac52f7a39d06/mail/locales/en-US/chrome/messenger/cloudfile/YouSendIt/fileExceeds2GB.dtd">annotate</a> |
<a href="/comm-central/diff/ee9bf9095b6e5fd4528680448292ac52f7a39d06/mail/locales/en-US/chrome/messenger/cloudfile/YouSendIt/fileExceeds2GB.dtd">diff</a> |
<a href="/comm-central/comparison/ee9bf9095b6e5fd4528680448292ac52f7a39d06/mail/locales/en-US/chrome/messenger/cloudfile/YouSendIt/fileExceeds2GB.dtd">comparison</a> |
<a href="/comm-central/log/ee9bf9095b6e5fd4528680448292ac52f7a39d06/mail/locales/en-US/chrome/messenger/cloudfile/YouSendIt/fileExceeds2GB.dtd">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/ee9bf9095b6e5fd4528680448292ac52f7a39d06/mail/locales/en-US/chrome/messenger/cloudfile/YouSendIt/fileExceedsLimit.dtd">mail/locales/en-US/chrome/messenger/cloudfile/YouSendIt/fileExceedsLimit.dtd</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/ee9bf9095b6e5fd4528680448292ac52f7a39d06/mail/locales/en-US/chrome/messenger/cloudfile/YouSendIt/fileExceedsLimit.dtd">file</a> |
<a href="/comm-central/annotate/ee9bf9095b6e5fd4528680448292ac52f7a39d06/mail/locales/en-US/chrome/messenger/cloudfile/YouSendIt/fileExceedsLimit.dtd">annotate</a> |
<a href="/comm-central/diff/ee9bf9095b6e5fd4528680448292ac52f7a39d06/mail/locales/en-US/chrome/messenger/cloudfile/YouSendIt/fileExceedsLimit.dtd">diff</a> |
<a href="/comm-central/comparison/ee9bf9095b6e5fd4528680448292ac52f7a39d06/mail/locales/en-US/chrome/messenger/cloudfile/YouSendIt/fileExceedsLimit.dtd">comparison</a> |
<a href="/comm-central/log/ee9bf9095b6e5fd4528680448292ac52f7a39d06/mail/locales/en-US/chrome/messenger/cloudfile/YouSendIt/fileExceedsLimit.dtd">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/ee9bf9095b6e5fd4528680448292ac52f7a39d06/mail/locales/en-US/chrome/messenger/cloudfile/YouSendIt/fileExceedsQuota.dtd">mail/locales/en-US/chrome/messenger/cloudfile/YouSendIt/fileExceedsQuota.dtd</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/ee9bf9095b6e5fd4528680448292ac52f7a39d06/mail/locales/en-US/chrome/messenger/cloudfile/YouSendIt/fileExceedsQuota.dtd">file</a> |
<a href="/comm-central/annotate/ee9bf9095b6e5fd4528680448292ac52f7a39d06/mail/locales/en-US/chrome/messenger/cloudfile/YouSendIt/fileExceedsQuota.dtd">annotate</a> |
<a href="/comm-central/diff/ee9bf9095b6e5fd4528680448292ac52f7a39d06/mail/locales/en-US/chrome/messenger/cloudfile/YouSendIt/fileExceedsQuota.dtd">diff</a> |
<a href="/comm-central/comparison/ee9bf9095b6e5fd4528680448292ac52f7a39d06/mail/locales/en-US/chrome/messenger/cloudfile/YouSendIt/fileExceedsQuota.dtd">comparison</a> |
<a href="/comm-central/log/ee9bf9095b6e5fd4528680448292ac52f7a39d06/mail/locales/en-US/chrome/messenger/cloudfile/YouSendIt/fileExceedsQuota.dtd">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/ee9bf9095b6e5fd4528680448292ac52f7a39d06/mail/locales/en-US/chrome/messenger/messengercompose/composeMsgs.properties">mail/locales/en-US/chrome/messenger/messengercompose/composeMsgs.properties</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/ee9bf9095b6e5fd4528680448292ac52f7a39d06/mail/locales/en-US/chrome/messenger/messengercompose/composeMsgs.properties">file</a> |
<a href="/comm-central/annotate/ee9bf9095b6e5fd4528680448292ac52f7a39d06/mail/locales/en-US/chrome/messenger/messengercompose/composeMsgs.properties">annotate</a> |
<a href="/comm-central/diff/ee9bf9095b6e5fd4528680448292ac52f7a39d06/mail/locales/en-US/chrome/messenger/messengercompose/composeMsgs.properties">diff</a> |
<a href="/comm-central/comparison/ee9bf9095b6e5fd4528680448292ac52f7a39d06/mail/locales/en-US/chrome/messenger/messengercompose/composeMsgs.properties">comparison</a> |
<a href="/comm-central/log/ee9bf9095b6e5fd4528680448292ac52f7a39d06/mail/locales/en-US/chrome/messenger/messengercompose/composeMsgs.properties">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/ee9bf9095b6e5fd4528680448292ac52f7a39d06/mail/locales/jar.mn">mail/locales/jar.mn</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/ee9bf9095b6e5fd4528680448292ac52f7a39d06/mail/locales/jar.mn">file</a> |
<a href="/comm-central/annotate/ee9bf9095b6e5fd4528680448292ac52f7a39d06/mail/locales/jar.mn">annotate</a> |
<a href="/comm-central/diff/ee9bf9095b6e5fd4528680448292ac52f7a39d06/mail/locales/jar.mn">diff</a> |
<a href="/comm-central/comparison/ee9bf9095b6e5fd4528680448292ac52f7a39d06/mail/locales/jar.mn">comparison</a> |
<a href="/comm-central/log/ee9bf9095b6e5fd4528680448292ac52f7a39d06/mail/locales/jar.mn">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/ee9bf9095b6e5fd4528680448292ac52f7a39d06/mail/test/mozmill/shared-modules/test-cloudfile-yousendit-helpers.js">mail/test/mozmill/shared-modules/test-cloudfile-yousendit-helpers.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/ee9bf9095b6e5fd4528680448292ac52f7a39d06/mail/test/mozmill/shared-modules/test-cloudfile-yousendit-helpers.js">file</a> |
<a href="/comm-central/annotate/ee9bf9095b6e5fd4528680448292ac52f7a39d06/mail/test/mozmill/shared-modules/test-cloudfile-yousendit-helpers.js">annotate</a> |
<a href="/comm-central/diff/ee9bf9095b6e5fd4528680448292ac52f7a39d06/mail/test/mozmill/shared-modules/test-cloudfile-yousendit-helpers.js">diff</a> |
<a href="/comm-central/comparison/ee9bf9095b6e5fd4528680448292ac52f7a39d06/mail/test/mozmill/shared-modules/test-cloudfile-yousendit-helpers.js">comparison</a> |
<a href="/comm-central/log/ee9bf9095b6e5fd4528680448292ac52f7a39d06/mail/test/mozmill/shared-modules/test-cloudfile-yousendit-helpers.js">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/ee9bf9095b6e5fd4528680448292ac52f7a39d06/mail/themes/gnomestripe/jar.mn">mail/themes/gnomestripe/jar.mn</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/ee9bf9095b6e5fd4528680448292ac52f7a39d06/mail/themes/gnomestripe/jar.mn">file</a> |
<a href="/comm-central/annotate/ee9bf9095b6e5fd4528680448292ac52f7a39d06/mail/themes/gnomestripe/jar.mn">annotate</a> |
<a href="/comm-central/diff/ee9bf9095b6e5fd4528680448292ac52f7a39d06/mail/themes/gnomestripe/jar.mn">diff</a> |
<a href="/comm-central/comparison/ee9bf9095b6e5fd4528680448292ac52f7a39d06/mail/themes/gnomestripe/jar.mn">comparison</a> |
<a href="/comm-central/log/ee9bf9095b6e5fd4528680448292ac52f7a39d06/mail/themes/gnomestripe/jar.mn">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/ee9bf9095b6e5fd4528680448292ac52f7a39d06/mail/themes/gnomestripe/mail/cloudfile/YouSendIt/fileExceedsLimit.css">mail/themes/gnomestripe/mail/cloudfile/YouSendIt/fileExceedsLimit.css</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/ee9bf9095b6e5fd4528680448292ac52f7a39d06/mail/themes/gnomestripe/mail/cloudfile/YouSendIt/fileExceedsLimit.css">file</a> |
<a href="/comm-central/annotate/ee9bf9095b6e5fd4528680448292ac52f7a39d06/mail/themes/gnomestripe/mail/cloudfile/YouSendIt/fileExceedsLimit.css">annotate</a> |
<a href="/comm-central/diff/ee9bf9095b6e5fd4528680448292ac52f7a39d06/mail/themes/gnomestripe/mail/cloudfile/YouSendIt/fileExceedsLimit.css">diff</a> |
<a href="/comm-central/comparison/ee9bf9095b6e5fd4528680448292ac52f7a39d06/mail/themes/gnomestripe/mail/cloudfile/YouSendIt/fileExceedsLimit.css">comparison</a> |
<a href="/comm-central/log/ee9bf9095b6e5fd4528680448292ac52f7a39d06/mail/themes/gnomestripe/mail/cloudfile/YouSendIt/fileExceedsLimit.css">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/ee9bf9095b6e5fd4528680448292ac52f7a39d06/mail/themes/gnomestripe/mail/cloudfile/YouSendIt/settings.css">mail/themes/gnomestripe/mail/cloudfile/YouSendIt/settings.css</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/ee9bf9095b6e5fd4528680448292ac52f7a39d06/mail/themes/gnomestripe/mail/cloudfile/YouSendIt/settings.css">file</a> |
<a href="/comm-central/annotate/ee9bf9095b6e5fd4528680448292ac52f7a39d06/mail/themes/gnomestripe/mail/cloudfile/YouSendIt/settings.css">annotate</a> |
<a href="/comm-central/diff/ee9bf9095b6e5fd4528680448292ac52f7a39d06/mail/themes/gnomestripe/mail/cloudfile/YouSendIt/settings.css">diff</a> |
<a href="/comm-central/comparison/ee9bf9095b6e5fd4528680448292ac52f7a39d06/mail/themes/gnomestripe/mail/cloudfile/YouSendIt/settings.css">comparison</a> |
<a href="/comm-central/log/ee9bf9095b6e5fd4528680448292ac52f7a39d06/mail/themes/gnomestripe/mail/cloudfile/YouSendIt/settings.css">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/ee9bf9095b6e5fd4528680448292ac52f7a39d06/mail/themes/pinstripe/jar.mn">mail/themes/pinstripe/jar.mn</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/ee9bf9095b6e5fd4528680448292ac52f7a39d06/mail/themes/pinstripe/jar.mn">file</a> |
<a href="/comm-central/annotate/ee9bf9095b6e5fd4528680448292ac52f7a39d06/mail/themes/pinstripe/jar.mn">annotate</a> |
<a href="/comm-central/diff/ee9bf9095b6e5fd4528680448292ac52f7a39d06/mail/themes/pinstripe/jar.mn">diff</a> |
<a href="/comm-central/comparison/ee9bf9095b6e5fd4528680448292ac52f7a39d06/mail/themes/pinstripe/jar.mn">comparison</a> |
<a href="/comm-central/log/ee9bf9095b6e5fd4528680448292ac52f7a39d06/mail/themes/pinstripe/jar.mn">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/ee9bf9095b6e5fd4528680448292ac52f7a39d06/mail/themes/pinstripe/mail/cloudfile/YouSendIt/fileExceedsLimit.css">mail/themes/pinstripe/mail/cloudfile/YouSendIt/fileExceedsLimit.css</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/ee9bf9095b6e5fd4528680448292ac52f7a39d06/mail/themes/pinstripe/mail/cloudfile/YouSendIt/fileExceedsLimit.css">file</a> |
<a href="/comm-central/annotate/ee9bf9095b6e5fd4528680448292ac52f7a39d06/mail/themes/pinstripe/mail/cloudfile/YouSendIt/fileExceedsLimit.css">annotate</a> |
<a href="/comm-central/diff/ee9bf9095b6e5fd4528680448292ac52f7a39d06/mail/themes/pinstripe/mail/cloudfile/YouSendIt/fileExceedsLimit.css">diff</a> |
<a href="/comm-central/comparison/ee9bf9095b6e5fd4528680448292ac52f7a39d06/mail/themes/pinstripe/mail/cloudfile/YouSendIt/fileExceedsLimit.css">comparison</a> |
<a href="/comm-central/log/ee9bf9095b6e5fd4528680448292ac52f7a39d06/mail/themes/pinstripe/mail/cloudfile/YouSendIt/fileExceedsLimit.css">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/ee9bf9095b6e5fd4528680448292ac52f7a39d06/mail/themes/pinstripe/mail/cloudfile/YouSendIt/settings.css">mail/themes/pinstripe/mail/cloudfile/YouSendIt/settings.css</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/ee9bf9095b6e5fd4528680448292ac52f7a39d06/mail/themes/pinstripe/mail/cloudfile/YouSendIt/settings.css">file</a> |
<a href="/comm-central/annotate/ee9bf9095b6e5fd4528680448292ac52f7a39d06/mail/themes/pinstripe/mail/cloudfile/YouSendIt/settings.css">annotate</a> |
<a href="/comm-central/diff/ee9bf9095b6e5fd4528680448292ac52f7a39d06/mail/themes/pinstripe/mail/cloudfile/YouSendIt/settings.css">diff</a> |
<a href="/comm-central/comparison/ee9bf9095b6e5fd4528680448292ac52f7a39d06/mail/themes/pinstripe/mail/cloudfile/YouSendIt/settings.css">comparison</a> |
<a href="/comm-central/log/ee9bf9095b6e5fd4528680448292ac52f7a39d06/mail/themes/pinstripe/mail/cloudfile/YouSendIt/settings.css">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/ee9bf9095b6e5fd4528680448292ac52f7a39d06/mail/themes/qute/jar.mn">mail/themes/qute/jar.mn</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/ee9bf9095b6e5fd4528680448292ac52f7a39d06/mail/themes/qute/jar.mn">file</a> |
<a href="/comm-central/annotate/ee9bf9095b6e5fd4528680448292ac52f7a39d06/mail/themes/qute/jar.mn">annotate</a> |
<a href="/comm-central/diff/ee9bf9095b6e5fd4528680448292ac52f7a39d06/mail/themes/qute/jar.mn">diff</a> |
<a href="/comm-central/comparison/ee9bf9095b6e5fd4528680448292ac52f7a39d06/mail/themes/qute/jar.mn">comparison</a> |
<a href="/comm-central/log/ee9bf9095b6e5fd4528680448292ac52f7a39d06/mail/themes/qute/jar.mn">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/ee9bf9095b6e5fd4528680448292ac52f7a39d06/mail/themes/qute/mail/cloudfile/YouSendIt/fileExceedsLimit.css">mail/themes/qute/mail/cloudfile/YouSendIt/fileExceedsLimit.css</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/ee9bf9095b6e5fd4528680448292ac52f7a39d06/mail/themes/qute/mail/cloudfile/YouSendIt/fileExceedsLimit.css">file</a> |
<a href="/comm-central/annotate/ee9bf9095b6e5fd4528680448292ac52f7a39d06/mail/themes/qute/mail/cloudfile/YouSendIt/fileExceedsLimit.css">annotate</a> |
<a href="/comm-central/diff/ee9bf9095b6e5fd4528680448292ac52f7a39d06/mail/themes/qute/mail/cloudfile/YouSendIt/fileExceedsLimit.css">diff</a> |
<a href="/comm-central/comparison/ee9bf9095b6e5fd4528680448292ac52f7a39d06/mail/themes/qute/mail/cloudfile/YouSendIt/fileExceedsLimit.css">comparison</a> |
<a href="/comm-central/log/ee9bf9095b6e5fd4528680448292ac52f7a39d06/mail/themes/qute/mail/cloudfile/YouSendIt/fileExceedsLimit.css">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/ee9bf9095b6e5fd4528680448292ac52f7a39d06/mail/themes/qute/mail/cloudfile/YouSendIt/settings.css">mail/themes/qute/mail/cloudfile/YouSendIt/settings.css</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/ee9bf9095b6e5fd4528680448292ac52f7a39d06/mail/themes/qute/mail/cloudfile/YouSendIt/settings.css">file</a> |
<a href="/comm-central/annotate/ee9bf9095b6e5fd4528680448292ac52f7a39d06/mail/themes/qute/mail/cloudfile/YouSendIt/settings.css">annotate</a> |
<a href="/comm-central/diff/ee9bf9095b6e5fd4528680448292ac52f7a39d06/mail/themes/qute/mail/cloudfile/YouSendIt/settings.css">diff</a> |
<a href="/comm-central/comparison/ee9bf9095b6e5fd4528680448292ac52f7a39d06/mail/themes/qute/mail/cloudfile/YouSendIt/settings.css">comparison</a> |
<a href="/comm-central/log/ee9bf9095b6e5fd4528680448292ac52f7a39d06/mail/themes/qute/mail/cloudfile/YouSendIt/settings.css">revisions</a>
</td>
</tr>
</table></div>

<div class="page_body diffblocks"><div class="diffblock"><pre class="sourcelines">
<a href="#l1.1"></a><span id="l1.1">new file mode 100644</span>
<a href="#l1.2"></a><span id="l1.2" class="difflineminus">--- /dev/null</span>
<a href="#l1.3"></a><span id="l1.3" class="difflineplus">+++ b/mail/components/cloudfile/content/YouSendIt/fileExceeds2GB.xul</span>
<a href="#l1.4"></a><span id="l1.4" class="difflineat">@@ -0,0 +1,22 @@</span>
<a href="#l1.5"></a><span id="l1.5" class="difflineplus">+&lt;?xml version=&quot;1.0&quot;?&gt;</span>
<a href="#l1.6"></a><span id="l1.6" class="difflineplus">+&lt;!DOCTYPE overlay [</span>
<a href="#l1.7"></a><span id="l1.7" class="difflineplus">+&lt;!ENTITY % brandDTD SYSTEM &quot;chrome://branding/locale/brand.dtd&quot; &gt;</span>
<a href="#l1.8"></a><span id="l1.8" class="difflineplus">+%brandDTD;</span>
<a href="#l1.9"></a><span id="l1.9" class="difflineplus">+&lt;!ENTITY % fileExceeds2GBDTD SYSTEM &quot;chrome://messenger/locale/cloudfile/YouSendIt/fileExceeds2GB.dtd&quot; &gt;</span>
<a href="#l1.10"></a><span id="l1.10" class="difflineplus">+%fileExceeds2GBDTD;</span>
<a href="#l1.11"></a><span id="l1.11" class="difflineplus">+]&gt;</span>
<a href="#l1.12"></a><span id="l1.12" class="difflineplus">+</span>
<a href="#l1.13"></a><span id="l1.13" class="difflineplus">+&lt;!-- This Source Code Form is subject to the terms of the Mozilla Public</span>
<a href="#l1.14"></a><span id="l1.14" class="difflineplus">+   - License, v. 2.0. If a copy of the MPL was not distributed with this file,</span>
<a href="#l1.15"></a><span id="l1.15" class="difflineplus">+   - You can obtain one at http://mozilla.org/MPL/2.0/.  --&gt;</span>
<a href="#l1.16"></a><span id="l1.16" class="difflineplus">+&lt;?xml-stylesheet href=&quot;chrome://global/skin/&quot;?&gt;</span>
<a href="#l1.17"></a><span id="l1.17" class="difflineplus">+&lt;?xml-stylesheet href=&quot;chrome://messenger/skin/preferences/preferences.css&quot; type=&quot;text/css&quot;?&gt;</span>
<a href="#l1.18"></a><span id="l1.18" class="difflineplus">+</span>
<a href="#l1.19"></a><span id="l1.19" class="difflineplus">+&lt;dialog id=&quot;fileExceeds2GB&quot;</span>
<a href="#l1.20"></a><span id="l1.20" class="difflineplus">+        xmlns=&quot;http://www.mozilla.org/keymaster/gatekeeper/there.is.only.xul&quot;</span>
<a href="#l1.21"></a><span id="l1.21" class="difflineplus">+        buttons=&quot;cancel&quot;</span>
<a href="#l1.22"></a><span id="l1.22" class="difflineplus">+        buttonlabelcancel=&quot;&amp;fileExceeds2GB.cancel;&quot;</span>
<a href="#l1.23"></a><span id="l1.23" class="difflineplus">+        title=&quot;&amp;fileExceeds2GB.title;&quot;&gt;</span>
<a href="#l1.24"></a><span id="l1.24" class="difflineplus">+</span>
<a href="#l1.25"></a><span id="l1.25" class="difflineplus">+  &lt;description&gt;&amp;fileExceeds2GB.description;&lt;/description&gt;</span>
<a href="#l1.26"></a><span id="l1.26" class="difflineplus">+&lt;/dialog&gt;</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l2.1"></a><span id="l2.1">new file mode 100644</span>
<a href="#l2.2"></a><span id="l2.2" class="difflineminus">--- /dev/null</span>
<a href="#l2.3"></a><span id="l2.3" class="difflineplus">+++ b/mail/components/cloudfile/content/YouSendIt/fileExceedsLimit.js</span>
<a href="#l2.4"></a><span id="l2.4" class="difflineat">@@ -0,0 +1,22 @@</span>
<a href="#l2.5"></a><span id="l2.5" class="difflineplus">+/* This Source Code Form is subject to the terms of the Mozilla Public</span>
<a href="#l2.6"></a><span id="l2.6" class="difflineplus">+ * License, v. 2.0. If a copy of the MPL was not distributed with this file,</span>
<a href="#l2.7"></a><span id="l2.7" class="difflineplus">+ * You can obtain one at http://mozilla.org/MPL/2.0/. */</span>
<a href="#l2.8"></a><span id="l2.8" class="difflineplus">+</span>
<a href="#l2.9"></a><span id="l2.9" class="difflineplus">+const Cc = Components.classes;</span>
<a href="#l2.10"></a><span id="l2.10" class="difflineplus">+const Ci = Components.interfaces;</span>
<a href="#l2.11"></a><span id="l2.11" class="difflineplus">+const Cu = Components.utils;</span>
<a href="#l2.12"></a><span id="l2.12" class="difflineplus">+const Cr = Components.results;</span>
<a href="#l2.13"></a><span id="l2.13" class="difflineplus">+</span>
<a href="#l2.14"></a><span id="l2.14" class="difflineplus">+Cu.import(&quot;resource://gre/modules/Services.jsm&quot;);</span>
<a href="#l2.15"></a><span id="l2.15" class="difflineplus">+Cu.import(&quot;resource://gre/modules/XPCOMUtils.jsm&quot;);</span>
<a href="#l2.16"></a><span id="l2.16" class="difflineplus">+</span>
<a href="#l2.17"></a><span id="l2.17" class="difflineplus">+let fileExceedsLimit = {</span>
<a href="#l2.18"></a><span id="l2.18" class="difflineplus">+  onOK: function AAD_onOK() {</span>
<a href="#l2.19"></a><span id="l2.19" class="difflineplus">+    let href = &quot;https://www.yousendit.com/prosignup?p_code=pro&amp;s=4001636&amp;cid=pm-4001636&quot;;</span>
<a href="#l2.20"></a><span id="l2.20" class="difflineplus">+    gProtocolService.loadUrl(Services.io.newURI(href, &quot;UTF-8&quot;, null));</span>
<a href="#l2.21"></a><span id="l2.21" class="difflineplus">+  },</span>
<a href="#l2.22"></a><span id="l2.22" class="difflineplus">+}</span>
<a href="#l2.23"></a><span id="l2.23" class="difflineplus">+</span>
<a href="#l2.24"></a><span id="l2.24" class="difflineplus">+XPCOMUtils.defineLazyServiceGetter(this, &quot;gProtocolService&quot;,</span>
<a href="#l2.25"></a><span id="l2.25" class="difflineplus">+                                   &quot;@mozilla.org/uriloader/external-protocol-service;1&quot;,</span>
<a href="#l2.26"></a><span id="l2.26" class="difflineplus">+                                   &quot;nsIExternalProtocolService&quot;);</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l3.1"></a><span id="l3.1">new file mode 100644</span>
<a href="#l3.2"></a><span id="l3.2" class="difflineminus">--- /dev/null</span>
<a href="#l3.3"></a><span id="l3.3" class="difflineplus">+++ b/mail/components/cloudfile/content/YouSendIt/fileExceedsLimit.xul</span>
<a href="#l3.4"></a><span id="l3.4" class="difflineat">@@ -0,0 +1,39 @@</span>
<a href="#l3.5"></a><span id="l3.5" class="difflineplus">+&lt;?xml version=&quot;1.0&quot;?&gt;</span>
<a href="#l3.6"></a><span id="l3.6" class="difflineplus">+&lt;!DOCTYPE overlay [</span>
<a href="#l3.7"></a><span id="l3.7" class="difflineplus">+&lt;!ENTITY % brandDTD SYSTEM &quot;chrome://branding/locale/brand.dtd&quot; &gt;</span>
<a href="#l3.8"></a><span id="l3.8" class="difflineplus">+%brandDTD;</span>
<a href="#l3.9"></a><span id="l3.9" class="difflineplus">+&lt;!ENTITY % fileExceedsLimitDTD SYSTEM &quot;chrome://messenger/locale/cloudfile/YouSendIt/fileExceedsLimit.dtd&quot; &gt;</span>
<a href="#l3.10"></a><span id="l3.10" class="difflineplus">+%fileExceedsLimitDTD;</span>
<a href="#l3.11"></a><span id="l3.11" class="difflineplus">+]&gt;</span>
<a href="#l3.12"></a><span id="l3.12" class="difflineplus">+</span>
<a href="#l3.13"></a><span id="l3.13" class="difflineplus">+&lt;!-- This Source Code Form is subject to the terms of the Mozilla Public</span>
<a href="#l3.14"></a><span id="l3.14" class="difflineplus">+   - License, v. 2.0. If a copy of the MPL was not distributed with this file,</span>
<a href="#l3.15"></a><span id="l3.15" class="difflineplus">+   - You can obtain one at http://mozilla.org/MPL/2.0/.  --&gt;</span>
<a href="#l3.16"></a><span id="l3.16" class="difflineplus">+&lt;?xml-stylesheet href=&quot;chrome://global/skin/&quot;?&gt;</span>
<a href="#l3.17"></a><span id="l3.17" class="difflineplus">+&lt;?xml-stylesheet href=&quot;chrome://messenger/skin/preferences/preferences.css&quot; type=&quot;text/css&quot;?&gt;</span>
<a href="#l3.18"></a><span id="l3.18" class="difflineplus">+&lt;?xml-stylesheet href=&quot;chrome://messenger/skin/cloudfile/YouSendIt/fileExceedsLimit.css&quot; type=&quot;text/css&quot;?&gt;</span>
<a href="#l3.19"></a><span id="l3.19" class="difflineplus">+</span>
<a href="#l3.20"></a><span id="l3.20" class="difflineplus">+&lt;dialog id=&quot;fileExceedsLimit&quot;</span>
<a href="#l3.21"></a><span id="l3.21" class="difflineplus">+        xmlns=&quot;http://www.mozilla.org/keymaster/gatekeeper/there.is.only.xul&quot;</span>
<a href="#l3.22"></a><span id="l3.22" class="difflineplus">+        buttons=&quot;accept,cancel&quot;</span>
<a href="#l3.23"></a><span id="l3.23" class="difflineplus">+        buttonlabelaccept=&quot;&amp;fileExceedsLimit.accept;&quot;</span>
<a href="#l3.24"></a><span id="l3.24" class="difflineplus">+        buttonlabelcancel=&quot;&amp;fileExceedsLimit.cancel;&quot;</span>
<a href="#l3.25"></a><span id="l3.25" class="difflineplus">+        ondialogaccept=&quot;return fileExceedsLimit.onOK();&quot;</span>
<a href="#l3.26"></a><span id="l3.26" class="difflineplus">+        title=&quot;&amp;fileExceedsLimit.title;&quot;&gt;</span>
<a href="#l3.27"></a><span id="l3.27" class="difflineplus">+</span>
<a href="#l3.28"></a><span id="l3.28" class="difflineplus">+  &lt;script type=&quot;text/javascript;version=1.8&quot;</span>
<a href="#l3.29"></a><span id="l3.29" class="difflineplus">+          src=&quot;chrome://messenger/content/cloudfile/YouSendIt/fileExceedsLimit.js&quot;/&gt;</span>
<a href="#l3.30"></a><span id="l3.30" class="difflineplus">+</span>
<a href="#l3.31"></a><span id="l3.31" class="difflineplus">+  &lt;description id=&quot;title&quot;&gt;&amp;fileExceedsLimit.thatsBigFile;&lt;/description&gt;</span>
<a href="#l3.32"></a><span id="l3.32" class="difflineplus">+  &lt;description id=&quot;title2&quot;&gt;&amp;fileExceedsLimit.thatsBigFile2;&lt;/description&gt;</span>
<a href="#l3.33"></a><span id="l3.33" class="difflineplus">+  &lt;description id=&quot;proIncludes&quot;&gt;&amp;fileExceedsLimit.proIncludes;&lt;/description&gt;</span>
<a href="#l3.34"></a><span id="l3.34" class="difflineplus">+  &lt;description&gt;</span>
<a href="#l3.35"></a><span id="l3.35" class="difflineplus">+    &lt;image src=&quot;chrome://messenger/skin/cloudfile/YouSendIt/check.png&quot;/&gt;&lt;label&gt;&amp;fileExceedsLimit.pros1;&lt;/label&gt;</span>
<a href="#l3.36"></a><span id="l3.36" class="difflineplus">+  &lt;/description&gt;</span>
<a href="#l3.37"></a><span id="l3.37" class="difflineplus">+  &lt;description&gt;</span>
<a href="#l3.38"></a><span id="l3.38" class="difflineplus">+    &lt;image src=&quot;chrome://messenger/skin/cloudfile/YouSendIt/check.png&quot;/&gt;&lt;label&gt;&amp;fileExceedsLimit.pros2;&lt;/label&gt;</span>
<a href="#l3.39"></a><span id="l3.39" class="difflineplus">+  &lt;/description&gt;</span>
<a href="#l3.40"></a><span id="l3.40" class="difflineplus">+  &lt;description&gt;</span>
<a href="#l3.41"></a><span id="l3.41" class="difflineplus">+    &lt;image src=&quot;chrome://messenger/skin/cloudfile/YouSendIt/check.png&quot;/&gt;&lt;label&gt;&amp;fileExceedsLimit.pros3;&lt;/label&gt;</span>
<a href="#l3.42"></a><span id="l3.42" class="difflineplus">+  &lt;/description&gt;</span>
<a href="#l3.43"></a><span id="l3.43" class="difflineplus">+&lt;/dialog&gt;</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l4.1"></a><span id="l4.1">new file mode 100644</span>
<a href="#l4.2"></a><span id="l4.2" class="difflineminus">--- /dev/null</span>
<a href="#l4.3"></a><span id="l4.3" class="difflineplus">+++ b/mail/components/cloudfile/content/YouSendIt/fileExceedsQuota.js</span>
<a href="#l4.4"></a><span id="l4.4" class="difflineat">@@ -0,0 +1,31 @@</span>
<a href="#l4.5"></a><span id="l4.5" class="difflineplus">+/* This Source Code Form is subject to the terms of the Mozilla Public</span>
<a href="#l4.6"></a><span id="l4.6" class="difflineplus">+ * License, v. 2.0. If a copy of the MPL was not distributed with this file,</span>
<a href="#l4.7"></a><span id="l4.7" class="difflineplus">+ * You can obtain one at http://mozilla.org/MPL/2.0/. */</span>
<a href="#l4.8"></a><span id="l4.8" class="difflineplus">+</span>
<a href="#l4.9"></a><span id="l4.9" class="difflineplus">+const Cc = Components.classes;</span>
<a href="#l4.10"></a><span id="l4.10" class="difflineplus">+const Ci = Components.interfaces;</span>
<a href="#l4.11"></a><span id="l4.11" class="difflineplus">+const Cu = Components.utils;</span>
<a href="#l4.12"></a><span id="l4.12" class="difflineplus">+const Cr = Components.results;</span>
<a href="#l4.13"></a><span id="l4.13" class="difflineplus">+</span>
<a href="#l4.14"></a><span id="l4.14" class="difflineplus">+Cu.import(&quot;resource://gre/modules/Services.jsm&quot;);</span>
<a href="#l4.15"></a><span id="l4.15" class="difflineplus">+Cu.import(&quot;resource://gre/modules/XPCOMUtils.jsm&quot;);</span>
<a href="#l4.16"></a><span id="l4.16" class="difflineplus">+</span>
<a href="#l4.17"></a><span id="l4.17" class="difflineplus">+document.addEventListener(&quot;DOMContentLoaded&quot;, function() {</span>
<a href="#l4.18"></a><span id="l4.18" class="difflineplus">+  if (&quot;wrappedJSObject&quot; in window.arguments[0]) {</span>
<a href="#l4.19"></a><span id="l4.19" class="difflineplus">+    let storage = parseInt(window.arguments[0].wrappedJSObject.storage);</span>
<a href="#l4.20"></a><span id="l4.20" class="difflineplus">+    storage = (storage / 1024 / 1024 / 1024).toFixed(2);</span>
<a href="#l4.21"></a><span id="l4.21" class="difflineplus">+    let currentStorage = document.getElementById('currentStorage');</span>
<a href="#l4.22"></a><span id="l4.22" class="difflineplus">+    currentStorage.textContent = currentStorage.textContent.replace('#XXX', storage);</span>
<a href="#l4.23"></a><span id="l4.23" class="difflineplus">+  }</span>
<a href="#l4.24"></a><span id="l4.24" class="difflineplus">+});</span>
<a href="#l4.25"></a><span id="l4.25" class="difflineplus">+</span>
<a href="#l4.26"></a><span id="l4.26" class="difflineplus">+let fileExceedsQuota = {</span>
<a href="#l4.27"></a><span id="l4.27" class="difflineplus">+  onOK: function AAD_onOK() {</span>
<a href="#l4.28"></a><span id="l4.28" class="difflineplus">+    let href = &quot;https://www.yousendit.com/prosignup?p_code=pro&amp;s=4001637&amp;cid=pm-4001637&quot;;</span>
<a href="#l4.29"></a><span id="l4.29" class="difflineplus">+    gProtocolService.loadUrl(Services.io.newURI(href, &quot;UTF-8&quot;, null));</span>
<a href="#l4.30"></a><span id="l4.30" class="difflineplus">+  },</span>
<a href="#l4.31"></a><span id="l4.31" class="difflineplus">+}</span>
<a href="#l4.32"></a><span id="l4.32" class="difflineplus">+</span>
<a href="#l4.33"></a><span id="l4.33" class="difflineplus">+XPCOMUtils.defineLazyServiceGetter(this, &quot;gProtocolService&quot;,</span>
<a href="#l4.34"></a><span id="l4.34" class="difflineplus">+                                   &quot;@mozilla.org/uriloader/external-protocol-service;1&quot;,</span>
<a href="#l4.35"></a><span id="l4.35" class="difflineplus">+                                   &quot;nsIExternalProtocolService&quot;);</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l5.1"></a><span id="l5.1">new file mode 100644</span>
<a href="#l5.2"></a><span id="l5.2" class="difflineminus">--- /dev/null</span>
<a href="#l5.3"></a><span id="l5.3" class="difflineplus">+++ b/mail/components/cloudfile/content/YouSendIt/fileExceedsQuota.xul</span>
<a href="#l5.4"></a><span id="l5.4" class="difflineat">@@ -0,0 +1,31 @@</span>
<a href="#l5.5"></a><span id="l5.5" class="difflineplus">+&lt;?xml version=&quot;1.0&quot;?&gt;</span>
<a href="#l5.6"></a><span id="l5.6" class="difflineplus">+&lt;!DOCTYPE overlay [</span>
<a href="#l5.7"></a><span id="l5.7" class="difflineplus">+&lt;!ENTITY % brandDTD SYSTEM &quot;chrome://branding/locale/brand.dtd&quot; &gt;</span>
<a href="#l5.8"></a><span id="l5.8" class="difflineplus">+%brandDTD;</span>
<a href="#l5.9"></a><span id="l5.9" class="difflineplus">+&lt;!ENTITY % fileExceedsQuotaDTD SYSTEM &quot;chrome://messenger/locale/cloudfile/YouSendIt/fileExceedsQuota.dtd&quot; &gt;</span>
<a href="#l5.10"></a><span id="l5.10" class="difflineplus">+%fileExceedsQuotaDTD;</span>
<a href="#l5.11"></a><span id="l5.11" class="difflineplus">+]&gt;</span>
<a href="#l5.12"></a><span id="l5.12" class="difflineplus">+</span>
<a href="#l5.13"></a><span id="l5.13" class="difflineplus">+&lt;!-- This Source Code Form is subject to the terms of the Mozilla Public</span>
<a href="#l5.14"></a><span id="l5.14" class="difflineplus">+   - License, v. 2.0. If a copy of the MPL was not distributed with this file,</span>
<a href="#l5.15"></a><span id="l5.15" class="difflineplus">+   - You can obtain one at http://mozilla.org/MPL/2.0/.  --&gt;</span>
<a href="#l5.16"></a><span id="l5.16" class="difflineplus">+&lt;?xml-stylesheet href=&quot;chrome://global/skin/&quot;?&gt;</span>
<a href="#l5.17"></a><span id="l5.17" class="difflineplus">+&lt;?xml-stylesheet href=&quot;chrome://messenger/skin/preferences/preferences.css&quot; type=&quot;text/css&quot;?&gt;</span>
<a href="#l5.18"></a><span id="l5.18" class="difflineplus">+&lt;?xml-stylesheet href=&quot;chrome://messenger/skin/cloudfile/YouSendIt/fileExceedsLimit.css&quot; type=&quot;text/css&quot;?&gt;</span>
<a href="#l5.19"></a><span id="l5.19" class="difflineplus">+</span>
<a href="#l5.20"></a><span id="l5.20" class="difflineplus">+&lt;dialog id=&quot;fileExceedsQuota&quot;</span>
<a href="#l5.21"></a><span id="l5.21" class="difflineplus">+        xmlns=&quot;http://www.mozilla.org/keymaster/gatekeeper/there.is.only.xul&quot;</span>
<a href="#l5.22"></a><span id="l5.22" class="difflineplus">+        buttons=&quot;accept,cancel&quot;</span>
<a href="#l5.23"></a><span id="l5.23" class="difflineplus">+        buttonlabelaccept=&quot;&amp;fileExceedsQuota.accept;&quot;</span>
<a href="#l5.24"></a><span id="l5.24" class="difflineplus">+        buttonlabelcancel=&quot;&amp;fileExceedsQuota.cancel;&quot;</span>
<a href="#l5.25"></a><span id="l5.25" class="difflineplus">+        ondialogaccept=&quot;return fileExceedsQuota.onOK();&quot;</span>
<a href="#l5.26"></a><span id="l5.26" class="difflineplus">+        title=&quot;&amp;fileExceedsQuota.title;&quot;&gt;</span>
<a href="#l5.27"></a><span id="l5.27" class="difflineplus">+</span>
<a href="#l5.28"></a><span id="l5.28" class="difflineplus">+  &lt;script type=&quot;text/javascript;version=1.8&quot;</span>
<a href="#l5.29"></a><span id="l5.29" class="difflineplus">+          src=&quot;chrome://messenger/content/cloudfile/YouSendIt/fileExceedsQuota.js&quot;/&gt;</span>
<a href="#l5.30"></a><span id="l5.30" class="difflineplus">+</span>
<a href="#l5.31"></a><span id="l5.31" class="difflineplus">+  &lt;description id=&quot;title&quot;&gt;&amp;fileExceedsQuota.storageLimitReached;&lt;/description&gt;</span>
<a href="#l5.32"></a><span id="l5.32" class="difflineplus">+  &lt;description id=&quot;currentStorage&quot;&gt;&amp;fileExceedsQuota.description;&lt;/description&gt;</span>
<a href="#l5.33"></a><span id="l5.33" class="difflineplus">+  &lt;description&gt;&amp;fileExceedsQuota.description2;&lt;/description&gt;</span>
<a href="#l5.34"></a><span id="l5.34" class="difflineplus">+  &lt;description&gt;&amp;fileExceedsQuota.description3;&lt;/description&gt;</span>
<a href="#l5.35"></a><span id="l5.35" class="difflineplus">+&lt;/dialog&gt;</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l6.1"></a><span id="l6.1" class="difflineminus">--- a/mail/components/cloudfile/content/YouSendIt/settings.xhtml</span>
<a href="#l6.2"></a><span id="l6.2" class="difflineplus">+++ b/mail/components/cloudfile/content/YouSendIt/settings.xhtml</span>
<a href="#l6.3"></a><span id="l6.3" class="difflineat">@@ -18,13 +18,13 @@</span>
<a href="#l6.4"></a><span id="l6.4">   &lt;body id=&quot;provider-settings&quot;&gt;</span>
<a href="#l6.5"></a><span id="l6.5">     &lt;form id=&quot;provider-form&quot; onsubmit=&quot;return false;&quot;&gt;</span>
<a href="#l6.6"></a><span id="l6.6">       &lt;label for=&quot;username&quot;&gt;&amp;youSendItSettings.username;&lt;/label&gt;</span>
<a href="#l6.7"></a><span id="l6.7">       &lt;input id=&quot;username&quot; type=&quot;text&quot; required=&quot;true&quot;/&gt;</span>
<a href="#l6.8"></a><span id="l6.8">       &lt;div id=&quot;learn-more&quot; class=&quot;float-right&quot;&gt;</span>
<a href="#l6.9"></a><span id="l6.9">         &lt;a href=&quot;https://www.yousendit.com/thunderbird-about-yousendit?s=4001583&amp;amp;cid=pm-4001583&quot;&gt;&amp;youSendItSettings.learnMore;&lt;/a&gt;</span>
<a href="#l6.10"></a><span id="l6.10">       &lt;/div&gt;</span>
<a href="#l6.11"></a><span id="l6.11">       &lt;div&gt;</span>
<a href="#l6.12"></a><span id="l6.12" class="difflineminus">-        &lt;a href=&quot;https://www.yousendit.com/litesignup?s=4001583&amp;amp;id=pm-4001583&quot;&gt;&amp;youSendItSettings.needAnAccount;&lt;/a&gt;</span>
<a href="#l6.13"></a><span id="l6.13" class="difflineplus">+        &lt;a href=&quot;https://www.yousendit.com/litesignup?s=4001583&amp;amp;cid=pm-4001583&quot;&gt;&amp;youSendItSettings.needAnAccount;&lt;/a&gt;</span>
<a href="#l6.14"></a><span id="l6.14">       &lt;/div&gt;</span>
<a href="#l6.15"></a><span id="l6.15">     &lt;/form&gt;</span>
<a href="#l6.16"></a><span id="l6.16">   &lt;/body&gt;</span>
<a href="#l6.17"></a><span id="l6.17"> &lt;/html&gt;</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l7.1"></a><span id="l7.1" class="difflineminus">--- a/mail/components/cloudfile/jar.mn</span>
<a href="#l7.2"></a><span id="l7.2" class="difflineplus">+++ b/mail/components/cloudfile/jar.mn</span>
<a href="#l7.3"></a><span id="l7.3" class="difflineat">@@ -10,8 +10,13 @@ messenger.jar:</span>
<a href="#l7.4"></a><span id="l7.4">     content/messenger/cloudfile/UbuntuOne/management.js (content/UbuntuOne/management.js)</span>
<a href="#l7.5"></a><span id="l7.5">     content/messenger/cloudfile/UbuntuOne/management.xhtml (content/UbuntuOne/management.xhtml)</span>
<a href="#l7.6"></a><span id="l7.6">     content/messenger/cloudfile/UbuntuOne/settings.js (content/UbuntuOne/settings.js)</span>
<a href="#l7.7"></a><span id="l7.7">     content/messenger/cloudfile/UbuntuOne/settings.xhtml (content/UbuntuOne/settings.xhtml)</span>
<a href="#l7.8"></a><span id="l7.8">     content/messenger/cloudfile/YouSendIt/management.xhtml (content/YouSendIt/management.xhtml)</span>
<a href="#l7.9"></a><span id="l7.9">     content/messenger/cloudfile/YouSendIt/management.js (content/YouSendIt/management.js)</span>
<a href="#l7.10"></a><span id="l7.10">     content/messenger/cloudfile/YouSendIt/settings.js (content/YouSendIt/settings.js)</span>
<a href="#l7.11"></a><span id="l7.11">     content/messenger/cloudfile/YouSendIt/settings.xhtml (content/YouSendIt/settings.xhtml)</span>
<a href="#l7.12"></a><span id="l7.12" class="difflineplus">+    content/messenger/cloudfile/YouSendIt/fileExceedsLimit.xul (content/YouSendIt/fileExceedsLimit.xul)</span>
<a href="#l7.13"></a><span id="l7.13" class="difflineplus">+    content/messenger/cloudfile/YouSendIt/fileExceedsLimit.js (content/YouSendIt/fileExceedsLimit.js)</span>
<a href="#l7.14"></a><span id="l7.14" class="difflineplus">+    content/messenger/cloudfile/YouSendIt/fileExceedsQuota.xul (content/YouSendIt/fileExceedsQuota.xul)</span>
<a href="#l7.15"></a><span id="l7.15" class="difflineplus">+    content/messenger/cloudfile/YouSendIt/fileExceedsQuota.js (content/YouSendIt/fileExceedsQuota.js)</span>
<a href="#l7.16"></a><span id="l7.16" class="difflineplus">+    content/messenger/cloudfile/YouSendIt/fileExceeds2GB.xul (content/YouSendIt/fileExceeds2GB.xul)</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l8.1"></a><span id="l8.1" class="difflineminus">--- a/mail/components/cloudfile/nsIMsgCloudFileProvider.idl</span>
<a href="#l8.2"></a><span id="l8.2" class="difflineplus">+++ b/mail/components/cloudfile/nsIMsgCloudFileProvider.idl</span>
<a href="#l8.3"></a><span id="l8.3" class="difflineat">@@ -130,9 +130,10 @@ interface nsIMsgCloudFileProvider : nsIS</span>
<a href="#l8.4"></a><span id="l8.4">   // but it really doesn't matter as long as we only return these</span>
<a href="#l8.5"></a><span id="l8.5">   // errors.</span>
<a href="#l8.6"></a><span id="l8.6">   const unsigned long offlineErr = 0x80550014; // NS_MSG_ERROR_OFFLINE</span>
<a href="#l8.7"></a><span id="l8.7">   const unsigned long authErr = 0x8055001e; // NS_MSG_USER_NOT_AUTHENTICATED</span>
<a href="#l8.8"></a><span id="l8.8">   const unsigned long uploadErr = 0x8055311a; // NS_MSG_ERROR_ATTACHING_FILE</span>
<a href="#l8.9"></a><span id="l8.9">   const unsigned long uploadWouldExceedQuota = 0x8055311b;</span>
<a href="#l8.10"></a><span id="l8.10">   const unsigned long uploadExceedsFileLimit = 0x8055311c;</span>
<a href="#l8.11"></a><span id="l8.11">   const unsigned long uploadCanceled = 0x8055311d;</span>
<a href="#l8.12"></a><span id="l8.12" class="difflineplus">+  const unsigned long uploadExceedsFileNameLimit = 0x8055311e;</span>
<a href="#l8.13"></a><span id="l8.13"> };</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l9.1"></a><span id="l9.1" class="difflineminus">--- a/mail/components/cloudfile/nsYouSendIt.js</span>
<a href="#l9.2"></a><span id="l9.2" class="difflineplus">+++ b/mail/components/cloudfile/nsYouSendIt.js</span>
<a href="#l9.3"></a><span id="l9.3" class="difflineat">@@ -16,19 +16,21 @@ Cu.import(&quot;resource:///modules/gloda/log</span>
<a href="#l9.4"></a><span id="l9.4"> Cu.import(&quot;resource:///modules/cloudFileAccounts.js&quot;);</span>
<a href="#l9.5"></a><span id="l9.5"> </span>
<a href="#l9.6"></a><span id="l9.6"> var gServerUrl = &quot;https://dpi.yousendit.com&quot;; // Production url</span>
<a href="#l9.7"></a><span id="l9.7"> // test url var gServerUrl = &quot;https://test2-api.yousendit.com&quot;;</span>
<a href="#l9.8"></a><span id="l9.8"> </span>
<a href="#l9.9"></a><span id="l9.9"> const kApiKey = &quot;7spvjdt7m4kycr7jyhywrdn2&quot;;</span>
<a href="#l9.10"></a><span id="l9.10"> const kAuthPath = &quot;/dpi/v1/auth&quot;;</span>
<a href="#l9.11"></a><span id="l9.11"> const kUserInfoPath = &quot;/dpi/v2/user&quot;;</span>
<a href="#l9.12"></a><span id="l9.12" class="difflineminus">-const kItemPath = &quot;/dpi/v1/item/&quot;;</span>
<a href="#l9.13"></a><span id="l9.13" class="difflineminus">-const kItemSendPath = kItemPath + &quot;send&quot;;</span>
<a href="#l9.14"></a><span id="l9.14" class="difflineminus">-const kItemCommitPath = kItemPath + &quot;commit&quot;;</span>
<a href="#l9.15"></a><span id="l9.15" class="difflineplus">+const kFolderPath = &quot;/dpi/v1/folder/&quot;;</span>
<a href="#l9.16"></a><span id="l9.16" class="difflineplus">+const kFolderFilePath = &quot;/dpi/v1/folder/file/&quot;;</span>
<a href="#l9.17"></a><span id="l9.17" class="difflineplus">+const kFolderInitUploadPath = kFolderPath + &quot;file/initUpload&quot;;</span>
<a href="#l9.18"></a><span id="l9.18" class="difflineplus">+const kFolderCommitUploadPath = kFolderPath + &quot;file/commitUpload&quot;;</span>
<a href="#l9.19"></a><span id="l9.19" class="difflineplus">+const kUrlTail = &quot;s=4001583&amp;cid=pm-4001583&quot;;</span>
<a href="#l9.20"></a><span id="l9.20"> </span>
<a href="#l9.21"></a><span id="l9.21"> function nsYouSendIt() {</span>
<a href="#l9.22"></a><span id="l9.22">   this.log = Log4Moz.getConfiguredLogger(&quot;YouSendIt&quot;);</span>
<a href="#l9.23"></a><span id="l9.23"> }</span>
<a href="#l9.24"></a><span id="l9.24"> </span>
<a href="#l9.25"></a><span id="l9.25"> nsYouSendIt.prototype = {</span>
<a href="#l9.26"></a><span id="l9.26">   /* nsISupports */</span>
<a href="#l9.27"></a><span id="l9.27">   QueryInterface: XPCOMUtils.generateQI([Ci.nsIMsgCloudFileProvider]),</span>
<a href="#l9.28"></a><span id="l9.28" class="difflineat">@@ -46,16 +48,17 @@ nsYouSendIt.prototype = {</span>
<a href="#l9.29"></a><span id="l9.29"> </span>
<a href="#l9.30"></a><span id="l9.30">   _accountKey: false,</span>
<a href="#l9.31"></a><span id="l9.31">   _prefBranch: null,</span>
<a href="#l9.32"></a><span id="l9.32">   _userName: &quot;&quot;,</span>
<a href="#l9.33"></a><span id="l9.33">   _password: &quot;&quot;,</span>
<a href="#l9.34"></a><span id="l9.34">   _loggedIn: false,</span>
<a href="#l9.35"></a><span id="l9.35">   _userInfo: null,</span>
<a href="#l9.36"></a><span id="l9.36">   _file : null,</span>
<a href="#l9.37"></a><span id="l9.37" class="difflineplus">+  _folderId: &quot;&quot;,</span>
<a href="#l9.38"></a><span id="l9.38">   _requestDate: null,</span>
<a href="#l9.39"></a><span id="l9.39">   _successCallback: null,</span>
<a href="#l9.40"></a><span id="l9.40">   _request: null,</span>
<a href="#l9.41"></a><span id="l9.41">   _maxFileSize : -1,</span>
<a href="#l9.42"></a><span id="l9.42">   _fileSpaceUsed : -1,</span>
<a href="#l9.43"></a><span id="l9.43">   _availableStorage : -1,</span>
<a href="#l9.44"></a><span id="l9.44">   _totalStorage : -1,</span>
<a href="#l9.45"></a><span id="l9.45">   _lastErrorStatus : 0,</span>
<a href="#l9.46"></a><span id="l9.46" class="difflineat">@@ -85,16 +88,55 @@ nsYouSendIt.prototype = {</span>
<a href="#l9.47"></a><span id="l9.47">     this._accountKey = aAccountKey;</span>
<a href="#l9.48"></a><span id="l9.48">     this._prefBranch = Services.prefs.getBranch(&quot;mail.cloud_files.accounts.&quot; +</span>
<a href="#l9.49"></a><span id="l9.49">                                                 aAccountKey + &quot;.&quot;);</span>
<a href="#l9.50"></a><span id="l9.50">     this._userName = this._prefBranch.getCharPref(&quot;username&quot;);</span>
<a href="#l9.51"></a><span id="l9.51">     this._loggedIn = this._cachedAuthToken != &quot;&quot;;</span>
<a href="#l9.52"></a><span id="l9.52">   },</span>
<a href="#l9.53"></a><span id="l9.53"> </span>
<a href="#l9.54"></a><span id="l9.54">   /**</span>
<a href="#l9.55"></a><span id="l9.55" class="difflineplus">+   * Private function for retrieving or creating folder</span>
<a href="#l9.56"></a><span id="l9.56" class="difflineplus">+   * on YouSendIt website for uploading file.</span>
<a href="#l9.57"></a><span id="l9.57" class="difflineplus">+   *</span>
<a href="#l9.58"></a><span id="l9.58" class="difflineplus">+   * @param aCallback called if folder is ready.</span>
<a href="#l9.59"></a><span id="l9.59" class="difflineplus">+   */</span>
<a href="#l9.60"></a><span id="l9.60" class="difflineplus">+  _initFolder: function nsYouSendIt__initFolder(aCallback) {</span>
<a href="#l9.61"></a><span id="l9.61" class="difflineplus">+    this.log.info('_initFolder');</span>
<a href="#l9.62"></a><span id="l9.62" class="difflineplus">+    </span>
<a href="#l9.63"></a><span id="l9.63" class="difflineplus">+    let saveFolderId = function(aFolderId) {</span>
<a href="#l9.64"></a><span id="l9.64" class="difflineplus">+      this.log.info('saveFolderId');</span>
<a href="#l9.65"></a><span id="l9.65" class="difflineplus">+      this._folderId = aFolderId;</span>
<a href="#l9.66"></a><span id="l9.66" class="difflineplus">+      if (aCallback)</span>
<a href="#l9.67"></a><span id="l9.67" class="difflineplus">+        aCallback();</span>
<a href="#l9.68"></a><span id="l9.68" class="difflineplus">+    }.bind(this);</span>
<a href="#l9.69"></a><span id="l9.69" class="difflineplus">+</span>
<a href="#l9.70"></a><span id="l9.70" class="difflineplus">+    let createThunderbirdFolder = function(aParentFolderId) {</span>
<a href="#l9.71"></a><span id="l9.71" class="difflineplus">+      this._createFolder(&quot;Mozilla Thunderbird&quot;, aParentFolderId, saveFolderId);</span>
<a href="#l9.72"></a><span id="l9.72" class="difflineplus">+    }.bind(this);</span>
<a href="#l9.73"></a><span id="l9.73" class="difflineplus">+</span>
<a href="#l9.74"></a><span id="l9.74" class="difflineplus">+    let createAppsFolder = function(aParentFolderId) {</span>
<a href="#l9.75"></a><span id="l9.75" class="difflineplus">+      this._createFolder(&quot;Apps&quot;, aParentFolderId, createThunderbirdFolder);</span>
<a href="#l9.76"></a><span id="l9.76" class="difflineplus">+    }.bind(this);</span>
<a href="#l9.77"></a><span id="l9.77" class="difflineplus">+</span>
<a href="#l9.78"></a><span id="l9.78" class="difflineplus">+    let findThunderbirdFolder = function(aParentFolderId) {</span>
<a href="#l9.79"></a><span id="l9.79" class="difflineplus">+      this._findFolder(&quot;Mozilla Thunderbird&quot;, aParentFolderId,</span>
<a href="#l9.80"></a><span id="l9.80" class="difflineplus">+                       createThunderbirdFolder, saveFolderId);</span>
<a href="#l9.81"></a><span id="l9.81" class="difflineplus">+    }.bind(this);</span>
<a href="#l9.82"></a><span id="l9.82" class="difflineplus">+</span>
<a href="#l9.83"></a><span id="l9.83" class="difflineplus">+    let findAppsFolder = function() {</span>
<a href="#l9.84"></a><span id="l9.84" class="difflineplus">+      this._findFolder(&quot;Apps&quot;, 0, createAppsFolder, findThunderbirdFolder);</span>
<a href="#l9.85"></a><span id="l9.85" class="difflineplus">+    }.bind(this);</span>
<a href="#l9.86"></a><span id="l9.86" class="difflineplus">+</span>
<a href="#l9.87"></a><span id="l9.87" class="difflineplus">+    if (this._folderId == &quot;&quot;)</span>
<a href="#l9.88"></a><span id="l9.88" class="difflineplus">+      findAppsFolder();</span>
<a href="#l9.89"></a><span id="l9.89" class="difflineplus">+    else</span>
<a href="#l9.90"></a><span id="l9.90" class="difflineplus">+      this._checkFolderExist(this._folderId, aCallback, findAppsFolder);</span>
<a href="#l9.91"></a><span id="l9.91" class="difflineplus">+  },</span>
<a href="#l9.92"></a><span id="l9.92" class="difflineplus">+</span>
<a href="#l9.93"></a><span id="l9.93" class="difflineplus">+  /**</span>
<a href="#l9.94"></a><span id="l9.94">    * Private callback function passed to, and called from</span>
<a href="#l9.95"></a><span id="l9.95">    * nsYouSendItFileUploader.</span>
<a href="#l9.96"></a><span id="l9.96">    *</span>
<a href="#l9.97"></a><span id="l9.97">    * @param aRequestObserver a request observer for monitoring the start and</span>
<a href="#l9.98"></a><span id="l9.98">    *                         stop states of a request.</span>
<a href="#l9.99"></a><span id="l9.99">    * @param aStatus the status of the request.</span>
<a href="#l9.100"></a><span id="l9.100">    */</span>
<a href="#l9.101"></a><span id="l9.101">   _uploaderCallback: function nsYouSendIt__uploaderCallback(aRequestObserver,</span>
<a href="#l9.102"></a><span id="l9.102" class="difflineat">@@ -130,93 +172,122 @@ nsYouSendIt.prototype = {</span>
<a href="#l9.103"></a><span id="l9.103">   uploadFile: function nsYouSendIt_uploadFile(aFile, aCallback) {</span>
<a href="#l9.104"></a><span id="l9.104">     if (Services.io.offline)</span>
<a href="#l9.105"></a><span id="l9.105">       throw Ci.nsIMsgCloudFileProvider.offlineErr;</span>
<a href="#l9.106"></a><span id="l9.106"> </span>
<a href="#l9.107"></a><span id="l9.107">     this.log.info(&quot;Preparing to upload a file&quot;);</span>
<a href="#l9.108"></a><span id="l9.108"> </span>
<a href="#l9.109"></a><span id="l9.109">     // if we're uploading a file, queue this request.</span>
<a href="#l9.110"></a><span id="l9.110">     if (this._uploadingFile &amp;&amp; this._uploadingFile != aFile) {</span>
<a href="#l9.111"></a><span id="l9.111" class="difflineplus">+      this.log.info(&quot;Adding file to queue&quot;);</span>
<a href="#l9.112"></a><span id="l9.112">       let uploader = new nsYouSendItFileUploader(this, aFile,</span>
<a href="#l9.113"></a><span id="l9.113">                                                  this._uploaderCallback</span>
<a href="#l9.114"></a><span id="l9.114">                                                      .bind(this),</span>
<a href="#l9.115"></a><span id="l9.115">                                                  aCallback);</span>
<a href="#l9.116"></a><span id="l9.116">       this._uploads.push(uploader);</span>
<a href="#l9.117"></a><span id="l9.117">       return;</span>
<a href="#l9.118"></a><span id="l9.118">     }</span>
<a href="#l9.119"></a><span id="l9.119"> </span>
<a href="#l9.120"></a><span id="l9.120">     this._uploadingFile = aFile;</span>
<a href="#l9.121"></a><span id="l9.121">     this._urlListener = aCallback;</span>
<a href="#l9.122"></a><span id="l9.122"> </span>
<a href="#l9.123"></a><span id="l9.123" class="difflineminus">-    this.log.info(&quot;Checking to see if we're logged in&quot;);</span>
<a href="#l9.124"></a><span id="l9.124" class="difflineplus">+    let finish = function() {</span>
<a href="#l9.125"></a><span id="l9.125" class="difflineplus">+      this._finishUpload(aFile, aCallback);</span>
<a href="#l9.126"></a><span id="l9.126" class="difflineplus">+    }.bind(this);</span>
<a href="#l9.127"></a><span id="l9.127"> </span>
<a href="#l9.128"></a><span id="l9.128">     let onGetUserInfoSuccess = function() {</span>
<a href="#l9.129"></a><span id="l9.129" class="difflineminus">-      this._finishUpload(aFile, aCallback);</span>
<a href="#l9.130"></a><span id="l9.130" class="difflineplus">+      this._initFolder(finish);</span>
<a href="#l9.131"></a><span id="l9.131">     }.bind(this);</span>
<a href="#l9.132"></a><span id="l9.132"> </span>
<a href="#l9.133"></a><span id="l9.133">     let onAuthFailure = function() {</span>
<a href="#l9.134"></a><span id="l9.134">       this._urlListener.onStopRequest(null, null,</span>
<a href="#l9.135"></a><span id="l9.135">                                       Ci.nsIMsgCloudFileProvider.authErr);</span>
<a href="#l9.136"></a><span id="l9.136">     }.bind(this);</span>
<a href="#l9.137"></a><span id="l9.137"> </span>
<a href="#l9.138"></a><span id="l9.138" class="difflineplus">+    this.log.info(&quot;Checking to see if we're logged in&quot;);</span>
<a href="#l9.139"></a><span id="l9.139" class="difflineplus">+    </span>
<a href="#l9.140"></a><span id="l9.140">     if (!this._loggedIn) {</span>
<a href="#l9.141"></a><span id="l9.141">       let onLoginSuccess = function() {</span>
<a href="#l9.142"></a><span id="l9.142">         this._getUserInfo(onGetUserInfoSuccess, onAuthFailure);</span>
<a href="#l9.143"></a><span id="l9.143">       }.bind(this);</span>
<a href="#l9.144"></a><span id="l9.144"> </span>
<a href="#l9.145"></a><span id="l9.145">       return this.logon(onLoginSuccess, onAuthFailure, true);</span>
<a href="#l9.146"></a><span id="l9.146">     }</span>
<a href="#l9.147"></a><span id="l9.147"> </span>
<a href="#l9.148"></a><span id="l9.148">     if (!this._userInfo)</span>
<a href="#l9.149"></a><span id="l9.149">       return this._getUserInfo(onGetUserInfoSuccess, onAuthFailure);</span>
<a href="#l9.150"></a><span id="l9.150"> </span>
<a href="#l9.151"></a><span id="l9.151" class="difflineminus">-    this._finishUpload(aFile, aCallback);</span>
<a href="#l9.152"></a><span id="l9.152" class="difflineplus">+    onGetUserInfoSuccess();</span>
<a href="#l9.153"></a><span id="l9.153">   },</span>
<a href="#l9.154"></a><span id="l9.154"> </span>
<a href="#l9.155"></a><span id="l9.155">   /**</span>
<a href="#l9.156"></a><span id="l9.156">    * A private function called when we're almost ready to kick off the upload</span>
<a href="#l9.157"></a><span id="l9.157">    * for a file. First, ensures that the file size is not too large, and that</span>
<a href="#l9.158"></a><span id="l9.158">    * we won't exceed our storage quota, and then kicks off the upload.</span>
<a href="#l9.159"></a><span id="l9.159">    *</span>
<a href="#l9.160"></a><span id="l9.160">    * @param aFile the nsILocalFile to upload</span>
<a href="#l9.161"></a><span id="l9.161">    * @param aCallback the nsIRequestObserver for monitoring the start and stop</span>
<a href="#l9.162"></a><span id="l9.162">    *                  states of the upload procedure.</span>
<a href="#l9.163"></a><span id="l9.163">    */</span>
<a href="#l9.164"></a><span id="l9.164">   _finishUpload: function nsYouSendIt__finishUpload(aFile, aCallback) {</span>
<a href="#l9.165"></a><span id="l9.165" class="difflineminus">-    let exceedsLimit = Ci.nsIMsgCloudFileProvider.uploadExceedsFileLimit;</span>
<a href="#l9.166"></a><span id="l9.166" class="difflineminus">-    let exceedsQuota = Ci.nsIMsgCloudFileProvider.uploadWouldExceedQuota;</span>
<a href="#l9.167"></a><span id="l9.167" class="difflineminus">-</span>
<a href="#l9.168"></a><span id="l9.168" class="difflineplus">+    if (aFile.fileSize &gt; 2147483648)</span>
<a href="#l9.169"></a><span id="l9.169" class="difflineplus">+      return this._fileExceedsLimit(aCallback, '2GB', 0);</span>
<a href="#l9.170"></a><span id="l9.170">     if (aFile.fileSize &gt; this._maxFileSize)</span>
<a href="#l9.171"></a><span id="l9.171" class="difflineminus">-      return aCallback.onStopRequest(null, null, exceedsLimit);</span>
<a href="#l9.172"></a><span id="l9.172" class="difflineplus">+      return this._fileExceedsLimit(aCallback, 'Limit', 0);</span>
<a href="#l9.173"></a><span id="l9.173">     if (aFile.fileSize &gt; this._availableStorage)</span>
<a href="#l9.174"></a><span id="l9.174" class="difflineminus">-      return aCallback.onStopRequest(null, null, exceedsQuota);</span>
<a href="#l9.175"></a><span id="l9.175" class="difflineplus">+      return this._fileExceedsLimit(aCallback, 'Quota', </span>
<a href="#l9.176"></a><span id="l9.176" class="difflineplus">+                                    aFile.fileSize + this._fileSpaceUsed);</span>
<a href="#l9.177"></a><span id="l9.177"> </span>
<a href="#l9.178"></a><span id="l9.178">     delete this._userInfo; // force us to update userInfo on every upload.</span>
<a href="#l9.179"></a><span id="l9.179"> </span>
<a href="#l9.180"></a><span id="l9.180">     if (!this._uploader) {</span>
<a href="#l9.181"></a><span id="l9.181">       this._uploader = new nsYouSendItFileUploader(this, aFile,</span>
<a href="#l9.182"></a><span id="l9.182">                                                    this._uploaderCallback</span>
<a href="#l9.183"></a><span id="l9.183">                                                        .bind(this),</span>
<a href="#l9.184"></a><span id="l9.184">                                                    aCallback);</span>
<a href="#l9.185"></a><span id="l9.185">       this._uploads.unshift(this._uploader);</span>
<a href="#l9.186"></a><span id="l9.186">     }</span>
<a href="#l9.187"></a><span id="l9.187"> </span>
<a href="#l9.188"></a><span id="l9.188">     this._uploadingFile = aFile;</span>
<a href="#l9.189"></a><span id="l9.189">     this._uploader.startUpload();</span>
<a href="#l9.190"></a><span id="l9.190">   },</span>
<a href="#l9.191"></a><span id="l9.191"> </span>
<a href="#l9.192"></a><span id="l9.192">   /**</span>
<a href="#l9.193"></a><span id="l9.193" class="difflineplus">+   * A private function called when upload exceeds file limit.</span>
<a href="#l9.194"></a><span id="l9.194" class="difflineplus">+   *</span>
<a href="#l9.195"></a><span id="l9.195" class="difflineplus">+   * @param aCallback the nsIRequestObserver for monitoring the start and stop</span>
<a href="#l9.196"></a><span id="l9.196" class="difflineplus">+   *                  states of the upload procedure.</span>
<a href="#l9.197"></a><span id="l9.197" class="difflineplus">+   */</span>
<a href="#l9.198"></a><span id="l9.198" class="difflineplus">+  _fileExceedsLimit: function nsYouSendIt__fileExceedsLimit(aCallback, aType, aStorageSize) {</span>
<a href="#l9.199"></a><span id="l9.199" class="difflineplus">+    let cancel = Ci.nsIMsgCloudFileProvider.uploadCanceled;</span>
<a href="#l9.200"></a><span id="l9.200" class="difflineplus">+</span>
<a href="#l9.201"></a><span id="l9.201" class="difflineplus">+    let args = {storage: aStorageSize};</span>
<a href="#l9.202"></a><span id="l9.202" class="difflineplus">+    args.wrappedJSObject = args;</span>
<a href="#l9.203"></a><span id="l9.203" class="difflineplus">+    let ww = Components.classes[&quot;@mozilla.org/embedcomp/window-watcher;1&quot;]</span>
<a href="#l9.204"></a><span id="l9.204" class="difflineplus">+                    .getService(Components.interfaces.nsIWindowWatcher);</span>
<a href="#l9.205"></a><span id="l9.205" class="difflineplus">+    ww.openWindow(null, </span>
<a href="#l9.206"></a><span id="l9.206" class="difflineplus">+                  &quot;chrome://messenger/content/cloudfile/YouSendIt/&quot;</span>
<a href="#l9.207"></a><span id="l9.207" class="difflineplus">+                  + &quot;fileExceeds&quot; + aType + &quot;.xul&quot;,</span>
<a href="#l9.208"></a><span id="l9.208" class="difflineplus">+                  &quot;YouSendIt&quot;, &quot;chrome,centerscreen,dialog,modal,resizable=yes&quot;, </span>
<a href="#l9.209"></a><span id="l9.209" class="difflineplus">+                  args).focus(); </span>
<a href="#l9.210"></a><span id="l9.210" class="difflineplus">+                  </span>
<a href="#l9.211"></a><span id="l9.211" class="difflineplus">+    return aCallback.onStopRequest(null, null, cancel);</span>
<a href="#l9.212"></a><span id="l9.212" class="difflineplus">+  },</span>
<a href="#l9.213"></a><span id="l9.213" class="difflineplus">+</span>
<a href="#l9.214"></a><span id="l9.214" class="difflineplus">+  /**</span>
<a href="#l9.215"></a><span id="l9.215">    * Cancels an in-progress file upload.</span>
<a href="#l9.216"></a><span id="l9.216">    *</span>
<a href="#l9.217"></a><span id="l9.217">    * @param aFile the nsILocalFile being uploaded.</span>
<a href="#l9.218"></a><span id="l9.218">    */</span>
<a href="#l9.219"></a><span id="l9.219">   cancelFileUpload: function nsYouSendIt_cancelFileUpload(aFile) {</span>
<a href="#l9.220"></a><span id="l9.220">     this.log.info(&quot;in cancel upload&quot;);</span>
<a href="#l9.221"></a><span id="l9.221" class="difflineminus">-    if (this._uploadingFile.equals(aFile))</span>
<a href="#l9.222"></a><span id="l9.222" class="difflineplus">+    if (this._uploadingFile != null &amp;&amp; this._uploader != null &amp;&amp; </span>
<a href="#l9.223"></a><span id="l9.223" class="difflineplus">+        this._uploadingFile.equals(aFile)) {</span>
<a href="#l9.224"></a><span id="l9.224">       this._uploader.cancel();</span>
<a href="#l9.225"></a><span id="l9.225" class="difflineplus">+    }</span>
<a href="#l9.226"></a><span id="l9.226">     else {</span>
<a href="#l9.227"></a><span id="l9.227">       for (let i = 0; i &lt; this._uploads.length; i++)</span>
<a href="#l9.228"></a><span id="l9.228">         if (this._uploads[i].file.equals(aFile)) {</span>
<a href="#l9.229"></a><span id="l9.229">           this._uploads[i].requestObserver.onStopRequest(</span>
<a href="#l9.230"></a><span id="l9.230">             null, null, Ci.nsIMsgCloudFileProvider.uploadCanceled);</span>
<a href="#l9.231"></a><span id="l9.231">           this._uploads.splice(i, 1);</span>
<a href="#l9.232"></a><span id="l9.232">           return;</span>
<a href="#l9.233"></a><span id="l9.233">         }</span>
<a href="#l9.234"></a><span id="l9.234" class="difflineat">@@ -251,33 +322,33 @@ nsYouSendIt.prototype = {</span>
<a href="#l9.235"></a><span id="l9.235">    *</span>
<a href="#l9.236"></a><span id="l9.236">    * @param successCallback a callback fired if retrieving profile information</span>
<a href="#l9.237"></a><span id="l9.237">    *                        is successful.</span>
<a href="#l9.238"></a><span id="l9.238">    * @param failureCallback a callback fired if retrieving profile information</span>
<a href="#l9.239"></a><span id="l9.239">    *                        fails.</span>
<a href="#l9.240"></a><span id="l9.240">    */</span>
<a href="#l9.241"></a><span id="l9.241">   _getUserInfo: function nsYouSendIt_userInfo(successCallback, failureCallback) {</span>
<a href="#l9.242"></a><span id="l9.242">     this.log.info(&quot;getting user info&quot;);</span>
<a href="#l9.243"></a><span id="l9.243" class="difflineminus">-    let args = &quot;?email=&quot; + this._userName;</span>
<a href="#l9.244"></a><span id="l9.244" class="difflineplus">+    let args = &quot;?email=&quot; + this._userName + &quot;&amp;&quot;;</span>
<a href="#l9.245"></a><span id="l9.245"> </span>
<a href="#l9.246"></a><span id="l9.246">     let req = Cc[&quot;@mozilla.org/xmlextras/xmlhttprequest;1&quot;]</span>
<a href="#l9.247"></a><span id="l9.247">                 .createInstance(Ci.nsIXMLHttpRequest);</span>
<a href="#l9.248"></a><span id="l9.248" class="difflineminus">-    req.open(&quot;GET&quot;, gServerUrl + kUserInfoPath + args, true);</span>
<a href="#l9.249"></a><span id="l9.249" class="difflineplus">+    req.open(&quot;GET&quot;, gServerUrl + kUserInfoPath + args + kUrlTail, true);</span>
<a href="#l9.250"></a><span id="l9.250"> </span>
<a href="#l9.251"></a><span id="l9.251">     req.onload = function() {</span>
<a href="#l9.252"></a><span id="l9.252" class="difflineminus">-      if (req.status &gt;= 200 &amp;&amp; req.status &lt;= 400) {</span>
<a href="#l9.253"></a><span id="l9.253" class="difflineplus">+      if (req.status &gt;= 200 &amp;&amp; req.status &lt; 400) {</span>
<a href="#l9.254"></a><span id="l9.254">         this.log.info(&quot;request status = &quot; + req.status +</span>
<a href="#l9.255"></a><span id="l9.255">                       &quot; response = &quot; + req.responseText);</span>
<a href="#l9.256"></a><span id="l9.256">         let docResponse = JSON.parse(req.responseText);</span>
<a href="#l9.257"></a><span id="l9.257">         this.log.info(&quot;user info response parsed = &quot; + docResponse);</span>
<a href="#l9.258"></a><span id="l9.258">         if (docResponse.errorStatus)</span>
<a href="#l9.259"></a><span id="l9.259">           this.log.info(&quot;error status = &quot; + docResponse.errorStatus.code);</span>
<a href="#l9.260"></a><span id="l9.260"> </span>
<a href="#l9.261"></a><span id="l9.261">         if (docResponse.errorStatus &amp;&amp; docResponse.errorStatus.code &gt; 200) {</span>
<a href="#l9.262"></a><span id="l9.262" class="difflineminus">-          if (docResponse.errorStatus.code &gt;= 400) {</span>
<a href="#l9.263"></a><span id="l9.263" class="difflineplus">+          if (docResponse.errorStatus.code &gt; 400) {</span>
<a href="#l9.264"></a><span id="l9.264">             // Our token has gone stale</span>
<a href="#l9.265"></a><span id="l9.265">             this.log.info(&quot;Our token has gone stale - requesting a new one.&quot;);</span>
<a href="#l9.266"></a><span id="l9.266"> </span>
<a href="#l9.267"></a><span id="l9.267">             let retryGetUserInfo = function() {</span>
<a href="#l9.268"></a><span id="l9.268">               this._getUserInfo(successCallback, failureCallback);</span>
<a href="#l9.269"></a><span id="l9.269">             }.bind(this);</span>
<a href="#l9.270"></a><span id="l9.270"> </span>
<a href="#l9.271"></a><span id="l9.271">             this._handleStaleToken(retryGetUserInfo, failureCallback);</span>
<a href="#l9.272"></a><span id="l9.272" class="difflineat">@@ -286,30 +357,28 @@ nsYouSendIt.prototype = {</span>
<a href="#l9.273"></a><span id="l9.273"> </span>
<a href="#l9.274"></a><span id="l9.274">           failureCallback();</span>
<a href="#l9.275"></a><span id="l9.275">           return;</span>
<a href="#l9.276"></a><span id="l9.276">         }</span>
<a href="#l9.277"></a><span id="l9.277">         this._userInfo = docResponse;</span>
<a href="#l9.278"></a><span id="l9.278">         let account = docResponse.account;</span>
<a href="#l9.279"></a><span id="l9.279">         let storage = docResponse.storage;</span>
<a href="#l9.280"></a><span id="l9.280">         if (storage) {</span>
<a href="#l9.281"></a><span id="l9.281" class="difflineminus">-          this._fileSpaceUsed = storage.currentUsage;</span>
<a href="#l9.282"></a><span id="l9.282" class="difflineminus">-          this._availableStorage = storage.storageQuota - this._fileSpaceUsed;</span>
<a href="#l9.283"></a><span id="l9.283" class="difflineplus">+          this._fileSpaceUsed = parseInt(storage.currentUsage);</span>
<a href="#l9.284"></a><span id="l9.284" class="difflineplus">+          this._availableStorage = parseInt(storage.storageQuota) - this._fileSpaceUsed;</span>
<a href="#l9.285"></a><span id="l9.285">         }</span>
<a href="#l9.286"></a><span id="l9.286" class="difflineminus">-        else {</span>
<a href="#l9.287"></a><span id="l9.287" class="difflineminus">-          this._availableStorage = account.availableStorage;</span>
<a href="#l9.288"></a><span id="l9.288" class="difflineminus">-        }</span>
<a href="#l9.289"></a><span id="l9.289" class="difflineplus">+        else</span>
<a href="#l9.290"></a><span id="l9.290" class="difflineplus">+          this._availableStorage = parseInt(account.availableStorage);</span>
<a href="#l9.291"></a><span id="l9.291"> </span>
<a href="#l9.292"></a><span id="l9.292" class="difflineminus">-        this._maxFileSize = account.maxFileSize;</span>
<a href="#l9.293"></a><span id="l9.293" class="difflineplus">+        this._maxFileSize = docResponse.type == &quot;BAS&quot; ? 52428800 : (parseInt(account.maxFileSize));</span>
<a href="#l9.294"></a><span id="l9.294">         this.log.info(&quot;available storage = &quot; + this._availableStorage + &quot; max file size = &quot; + this._maxFileSize);</span>
<a href="#l9.295"></a><span id="l9.295">         successCallback();</span>
<a href="#l9.296"></a><span id="l9.296">       }</span>
<a href="#l9.297"></a><span id="l9.297" class="difflineminus">-      else {</span>
<a href="#l9.298"></a><span id="l9.298" class="difflineplus">+      else</span>
<a href="#l9.299"></a><span id="l9.299">         failureCallback();</span>
<a href="#l9.300"></a><span id="l9.300" class="difflineminus">-      }</span>
<a href="#l9.301"></a><span id="l9.301">     }.bind(this);</span>
<a href="#l9.302"></a><span id="l9.302"> </span>
<a href="#l9.303"></a><span id="l9.303">     req.onerror = function() {</span>
<a href="#l9.304"></a><span id="l9.304">       this.log.info(&quot;getUserInfo failed - status = &quot; + req.status);</span>
<a href="#l9.305"></a><span id="l9.305">       failureCallback();</span>
<a href="#l9.306"></a><span id="l9.306">     }.bind(this);</span>
<a href="#l9.307"></a><span id="l9.307">     // Add a space at the end because http logging looks for two</span>
<a href="#l9.308"></a><span id="l9.308">     // spaces in the X-Auth-Token header to avoid putting passwords</span>
<a href="#l9.309"></a><span id="l9.309" class="difflineat">@@ -377,22 +446,22 @@ nsYouSendIt.prototype = {</span>
<a href="#l9.310"></a><span id="l9.310">    */</span>
<a href="#l9.311"></a><span id="l9.311">   createNewAccount: function nsYouSendIt_createNewAccount(aEmailAddress, aPassword,</span>
<a href="#l9.312"></a><span id="l9.312">                                                           aFirstName, aLastName,</span>
<a href="#l9.313"></a><span id="l9.313">                                                           aRequestObserver) {</span>
<a href="#l9.314"></a><span id="l9.314">     if (Services.io.offline)</span>
<a href="#l9.315"></a><span id="l9.315">       throw Ci.nsIMsgCloudFileProvider.offlineErr;</span>
<a href="#l9.316"></a><span id="l9.316"> </span>
<a href="#l9.317"></a><span id="l9.317">     let args = &quot;?email=&quot; + aEmailAddress + &quot;&amp;password=&quot; + aPassword + &quot;&amp;firstname=&quot;</span>
<a href="#l9.318"></a><span id="l9.318" class="difflineminus">-               + aFirstName + &quot;&amp;lastname=&quot; + aLastName;</span>
<a href="#l9.319"></a><span id="l9.319" class="difflineplus">+               + aFirstName + &quot;&amp;lastname=&quot; + aLastName + &quot;&amp;&quot;;</span>
<a href="#l9.320"></a><span id="l9.320"> </span>
<a href="#l9.321"></a><span id="l9.321">     let req = Cc[&quot;@mozilla.org/xmlextras/xmlhttprequest;1&quot;]</span>
<a href="#l9.322"></a><span id="l9.322">                 .createInstance(Ci.nsIXMLHttpRequest);</span>
<a href="#l9.323"></a><span id="l9.323"> </span>
<a href="#l9.324"></a><span id="l9.324" class="difflineminus">-    req.open(&quot;POST&quot;, gServerUrl + kUserInfoPath + args, true);</span>
<a href="#l9.325"></a><span id="l9.325" class="difflineplus">+    req.open(&quot;POST&quot;, gServerUrl + kUserInfoPath + args + kUrlTail, true);</span>
<a href="#l9.326"></a><span id="l9.326"> </span>
<a href="#l9.327"></a><span id="l9.327">     req.onload = function() {</span>
<a href="#l9.328"></a><span id="l9.328">       if (req.status &gt;= 200 &amp;&amp;</span>
<a href="#l9.329"></a><span id="l9.329">           req.status &lt; 400) {</span>
<a href="#l9.330"></a><span id="l9.330">         this.log.info(&quot;request status = &quot; + req + &quot; response = &quot; +</span>
<a href="#l9.331"></a><span id="l9.331">                       req.responseText);</span>
<a href="#l9.332"></a><span id="l9.332">         aRequestObserver.onStopRequest(null, null, Cr.NS_OK);</span>
<a href="#l9.333"></a><span id="l9.333">       }</span>
<a href="#l9.334"></a><span id="l9.334" class="difflineat">@@ -413,16 +482,152 @@ nsYouSendIt.prototype = {</span>
<a href="#l9.335"></a><span id="l9.335">     // in the log, and crashes if there aren't two spaces.</span>
<a href="#l9.336"></a><span id="l9.336">     req.setRequestHeader(&quot;X-Auth-Token&quot;, this._cachedAuthToken + &quot; &quot;);</span>
<a href="#l9.337"></a><span id="l9.337">     req.setRequestHeader(&quot;X-Api-Key&quot;, kApiKey);</span>
<a href="#l9.338"></a><span id="l9.338">     req.setRequestHeader(&quot;Accept&quot;, &quot;application/json&quot;);</span>
<a href="#l9.339"></a><span id="l9.339">     req.send();</span>
<a href="#l9.340"></a><span id="l9.340">   },</span>
<a href="#l9.341"></a><span id="l9.341"> </span>
<a href="#l9.342"></a><span id="l9.342">   /**</span>
<a href="#l9.343"></a><span id="l9.343" class="difflineplus">+   * Attempt to find folder by name on YSI website.</span>
<a href="#l9.344"></a><span id="l9.344" class="difflineplus">+   *</span>
<a href="#l9.345"></a><span id="l9.345" class="difflineplus">+   * @param aFolderName name of folder</span>
<a href="#l9.346"></a><span id="l9.346" class="difflineplus">+   * @param aParentFolderId id of folder where we are looking</span>
<a href="#l9.347"></a><span id="l9.347" class="difflineplus">+   * @param aNotFoundCallback called if folder is not found</span>
<a href="#l9.348"></a><span id="l9.348" class="difflineplus">+   * @param aFoundCallback called if folder is found</span>
<a href="#l9.349"></a><span id="l9.349" class="difflineplus">+   */</span>
<a href="#l9.350"></a><span id="l9.350" class="difflineplus">+  _findFolder: function nsYouSendIt__findFolder(aFolderName,</span>
<a href="#l9.351"></a><span id="l9.351" class="difflineplus">+                                                aParentFolderId,</span>
<a href="#l9.352"></a><span id="l9.352" class="difflineplus">+                                                aNotFoundCallback,</span>
<a href="#l9.353"></a><span id="l9.353" class="difflineplus">+                                                aFoundCallback) {</span>
<a href="#l9.354"></a><span id="l9.354" class="difflineplus">+    </span>
<a href="#l9.355"></a><span id="l9.355" class="difflineplus">+    this.log.info(&quot;Find folder: &quot; + aFolderName);</span>
<a href="#l9.356"></a><span id="l9.356" class="difflineplus">+    </span>
<a href="#l9.357"></a><span id="l9.357" class="difflineplus">+    let checkChildFolders = function(folders) {</span>
<a href="#l9.358"></a><span id="l9.358" class="difflineplus">+      this.log.info(&quot;Looking for a child folder&quot;);</span>
<a href="#l9.359"></a><span id="l9.359" class="difflineplus">+      let folderId = 0;</span>
<a href="#l9.360"></a><span id="l9.360" class="difflineplus">+      let folder = folders.folder;</span>
<a href="#l9.361"></a><span id="l9.361" class="difflineplus">+      for (let i in folder) {</span>
<a href="#l9.362"></a><span id="l9.362" class="difflineplus">+        if (folder[i].name == aFolderName) {</span>
<a href="#l9.363"></a><span id="l9.363" class="difflineplus">+          folderId = folder[i].id;</span>
<a href="#l9.364"></a><span id="l9.364" class="difflineplus">+          break;</span>
<a href="#l9.365"></a><span id="l9.365" class="difflineplus">+        }</span>
<a href="#l9.366"></a><span id="l9.366" class="difflineplus">+      }</span>
<a href="#l9.367"></a><span id="l9.367" class="difflineplus">+</span>
<a href="#l9.368"></a><span id="l9.368" class="difflineplus">+      if (!folderId &amp;&amp; aNotFoundCallback)</span>
<a href="#l9.369"></a><span id="l9.369" class="difflineplus">+        aNotFoundCallback(aParentFolderId);</span>
<a href="#l9.370"></a><span id="l9.370" class="difflineplus">+</span>
<a href="#l9.371"></a><span id="l9.371" class="difflineplus">+      if (folderId &amp;&amp; aFoundCallback)</span>
<a href="#l9.372"></a><span id="l9.372" class="difflineplus">+        aFoundCallback(folderId);</span>
<a href="#l9.373"></a><span id="l9.373" class="difflineplus">+    }.bind(this);</span>
<a href="#l9.374"></a><span id="l9.374" class="difflineplus">+</span>
<a href="#l9.375"></a><span id="l9.375" class="difflineplus">+    this._checkFolderExist(aParentFolderId, checkChildFolders);</span>
<a href="#l9.376"></a><span id="l9.376" class="difflineplus">+  },</span>
<a href="#l9.377"></a><span id="l9.377" class="difflineplus">+</span>
<a href="#l9.378"></a><span id="l9.378" class="difflineplus">+  /**</span>
<a href="#l9.379"></a><span id="l9.379" class="difflineplus">+   * Attempt to find folder by id on YSI website.</span>
<a href="#l9.380"></a><span id="l9.380" class="difflineplus">+   *</span>
<a href="#l9.381"></a><span id="l9.381" class="difflineplus">+   * @param aFolderId id of folder</span>
<a href="#l9.382"></a><span id="l9.382" class="difflineplus">+   * @param aNotFoundCallback called if folder is not found</span>
<a href="#l9.383"></a><span id="l9.383" class="difflineplus">+   * @param aFoundCallback called if folder is found</span>
<a href="#l9.384"></a><span id="l9.384" class="difflineplus">+   */</span>
<a href="#l9.385"></a><span id="l9.385" class="difflineplus">+  _checkFolderExist: function nsYouSendIt__checkFolderExist(aFolderId,</span>
<a href="#l9.386"></a><span id="l9.386" class="difflineplus">+                                                            aFoundCallback,</span>
<a href="#l9.387"></a><span id="l9.387" class="difflineplus">+                                                            aNotFoundCallback) {</span>
<a href="#l9.388"></a><span id="l9.388" class="difflineplus">+    this.log.info('checkFolderExist');</span>
<a href="#l9.389"></a><span id="l9.389" class="difflineplus">+    if (Services.io.offline)</span>
<a href="#l9.390"></a><span id="l9.390" class="difflineplus">+      throw Ci.nsIMsgCloudFileProvider.offlineErr;</span>
<a href="#l9.391"></a><span id="l9.391" class="difflineplus">+</span>
<a href="#l9.392"></a><span id="l9.392" class="difflineplus">+    let args = &quot;?includeFiles=false&amp;includeFolders=true&amp;&quot;;</span>
<a href="#l9.393"></a><span id="l9.393" class="difflineplus">+</span>
<a href="#l9.394"></a><span id="l9.394" class="difflineplus">+    let req = Cc[&quot;@mozilla.org/xmlextras/xmlhttprequest;1&quot;]</span>
<a href="#l9.395"></a><span id="l9.395" class="difflineplus">+                .createInstance(Ci.nsIXMLHttpRequest);</span>
<a href="#l9.396"></a><span id="l9.396" class="difflineplus">+</span>
<a href="#l9.397"></a><span id="l9.397" class="difflineplus">+    req.open(&quot;GET&quot;,</span>
<a href="#l9.398"></a><span id="l9.398" class="difflineplus">+             gServerUrl + kFolderPath + aFolderId + args + kUrlTail,</span>
<a href="#l9.399"></a><span id="l9.399" class="difflineplus">+             true);</span>
<a href="#l9.400"></a><span id="l9.400" class="difflineplus">+</span>
<a href="#l9.401"></a><span id="l9.401" class="difflineplus">+    req.onload = function() {</span>
<a href="#l9.402"></a><span id="l9.402" class="difflineplus">+      let docResponse = JSON.parse(req.responseText);</span>
<a href="#l9.403"></a><span id="l9.403" class="difflineplus">+      if (req.status &gt;= 200 &amp;&amp; req.status &lt; 400) {</span>
<a href="#l9.404"></a><span id="l9.404" class="difflineplus">+        this.log.info(&quot;request status = &quot; + req + &quot; response = &quot; +</span>
<a href="#l9.405"></a><span id="l9.405" class="difflineplus">+                      req.responseText);</span>
<a href="#l9.406"></a><span id="l9.406" class="difflineplus">+		</span>
<a href="#l9.407"></a><span id="l9.407" class="difflineplus">+        if (aFoundCallback &amp;&amp; docResponse.folders)</span>
<a href="#l9.408"></a><span id="l9.408" class="difflineplus">+          aFoundCallback(docResponse.folders);</span>
<a href="#l9.409"></a><span id="l9.409" class="difflineplus">+      }</span>
<a href="#l9.410"></a><span id="l9.410" class="difflineplus">+      else {</span>
<a href="#l9.411"></a><span id="l9.411" class="difflineplus">+        this._lastErrorText = docResponse.errorStatus.message;</span>
<a href="#l9.412"></a><span id="l9.412" class="difflineplus">+        this._lastErrorStatus = docResponse.errorStatus.code;</span>
<a href="#l9.413"></a><span id="l9.413" class="difflineplus">+        if (this._lastErrorStatus == 400 &amp;&amp; this._lastErrorText == &quot;Not Found&quot; &amp;&amp; aNotFoundCallback)</span>
<a href="#l9.414"></a><span id="l9.414" class="difflineplus">+          aNotFoundCallback();</span>
<a href="#l9.415"></a><span id="l9.415" class="difflineplus">+      }</span>
<a href="#l9.416"></a><span id="l9.416" class="difflineplus">+    }.bind(this);</span>
<a href="#l9.417"></a><span id="l9.417" class="difflineplus">+</span>
<a href="#l9.418"></a><span id="l9.418" class="difflineplus">+    req.onerror = function() {</span>
<a href="#l9.419"></a><span id="l9.419" class="difflineplus">+      this.log.info(&quot;_checkFolderExist failed - status = &quot; + req.status);</span>
<a href="#l9.420"></a><span id="l9.420" class="difflineplus">+    }.bind(this);</span>
<a href="#l9.421"></a><span id="l9.421" class="difflineplus">+    // Add a space at the end because http logging looks for two</span>
<a href="#l9.422"></a><span id="l9.422" class="difflineplus">+    // spaces in the X-Auth-Token header to avoid putting passwords</span>
<a href="#l9.423"></a><span id="l9.423" class="difflineplus">+    // in the log, and crashes if there aren't two spaces.</span>
<a href="#l9.424"></a><span id="l9.424" class="difflineplus">+    req.setRequestHeader(&quot;X-Auth-Token&quot;, this._cachedAuthToken + &quot; &quot;);</span>
<a href="#l9.425"></a><span id="l9.425" class="difflineplus">+    req.setRequestHeader(&quot;X-Api-Key&quot;, kApiKey);</span>
<a href="#l9.426"></a><span id="l9.426" class="difflineplus">+    req.setRequestHeader(&quot;Accept&quot;, &quot;application/json&quot;);</span>
<a href="#l9.427"></a><span id="l9.427" class="difflineplus">+    req.send();</span>
<a href="#l9.428"></a><span id="l9.428" class="difflineplus">+  },</span>
<a href="#l9.429"></a><span id="l9.429" class="difflineplus">+</span>
<a href="#l9.430"></a><span id="l9.430" class="difflineplus">+  /**</span>
<a href="#l9.431"></a><span id="l9.431" class="difflineplus">+   * Private function for creating folder on YSI website.</span>
<a href="#l9.432"></a><span id="l9.432" class="difflineplus">+   *</span>
<a href="#l9.433"></a><span id="l9.433" class="difflineplus">+   * @param aName name of folder</span>
<a href="#l9.434"></a><span id="l9.434" class="difflineplus">+   * @param aParent id of parent folder</span>
<a href="#l9.435"></a><span id="l9.435" class="difflineplus">+   * @param aSuccessCallback called when folder is created</span>
<a href="#l9.436"></a><span id="l9.436" class="difflineplus">+   */</span>
<a href="#l9.437"></a><span id="l9.437" class="difflineplus">+  _createFolder: function nsYouSendIt__createFolder(aName,</span>
<a href="#l9.438"></a><span id="l9.438" class="difflineplus">+                                                    aParent,</span>
<a href="#l9.439"></a><span id="l9.439" class="difflineplus">+                                                    aSuccessCallback) {</span>
<a href="#l9.440"></a><span id="l9.440" class="difflineplus">+    this.log.info(&quot;Create folder: &quot; + aName);</span>
<a href="#l9.441"></a><span id="l9.441" class="difflineplus">+    if (Services.io.offline)</span>
<a href="#l9.442"></a><span id="l9.442" class="difflineplus">+      throw Ci.nsIMsgCloudFileProvider.offlineErr;</span>
<a href="#l9.443"></a><span id="l9.443" class="difflineplus">+</span>
<a href="#l9.444"></a><span id="l9.444" class="difflineplus">+    let args = &quot;?name=&quot; + aName + &quot;&amp;parentId=&quot; + aParent + &quot;&amp;&quot;;</span>
<a href="#l9.445"></a><span id="l9.445" class="difflineplus">+</span>
<a href="#l9.446"></a><span id="l9.446" class="difflineplus">+    let req = Cc[&quot;@mozilla.org/xmlextras/xmlhttprequest;1&quot;]</span>
<a href="#l9.447"></a><span id="l9.447" class="difflineplus">+                .createInstance(Ci.nsIXMLHttpRequest);</span>
<a href="#l9.448"></a><span id="l9.448" class="difflineplus">+</span>
<a href="#l9.449"></a><span id="l9.449" class="difflineplus">+    req.open(&quot;POST&quot;, gServerUrl + kFolderPath.replace(/\/$/, '') + args + kUrlTail, true);</span>
<a href="#l9.450"></a><span id="l9.450" class="difflineplus">+</span>
<a href="#l9.451"></a><span id="l9.451" class="difflineplus">+    req.onload = function() {</span>
<a href="#l9.452"></a><span id="l9.452" class="difflineplus">+      let docResponse = JSON.parse(req.responseText);</span>
<a href="#l9.453"></a><span id="l9.453" class="difflineplus">+      if (req.status &gt;= 200 &amp;&amp; req.status &lt; 400) {</span>
<a href="#l9.454"></a><span id="l9.454" class="difflineplus">+        this.log.info(&quot;request status = &quot; + req + &quot; response = &quot; +</span>
<a href="#l9.455"></a><span id="l9.455" class="difflineplus">+                      req.responseText);</span>
<a href="#l9.456"></a><span id="l9.456" class="difflineplus">+		</span>
<a href="#l9.457"></a><span id="l9.457" class="difflineplus">+        if (aSuccessCallback)</span>
<a href="#l9.458"></a><span id="l9.458" class="difflineplus">+          aSuccessCallback(docResponse.id)</span>
<a href="#l9.459"></a><span id="l9.459" class="difflineplus">+      }</span>
<a href="#l9.460"></a><span id="l9.460" class="difflineplus">+      else {</span>
<a href="#l9.461"></a><span id="l9.461" class="difflineplus">+        this._lastErrorText = docResponse.errorStatus.message;</span>
<a href="#l9.462"></a><span id="l9.462" class="difflineplus">+        this._lastErrorStatus = docResponse.errorStatus.code;</span>
<a href="#l9.463"></a><span id="l9.463" class="difflineplus">+      }</span>
<a href="#l9.464"></a><span id="l9.464" class="difflineplus">+    }.bind(this);</span>
<a href="#l9.465"></a><span id="l9.465" class="difflineplus">+</span>
<a href="#l9.466"></a><span id="l9.466" class="difflineplus">+    req.onerror = function() {</span>
<a href="#l9.467"></a><span id="l9.467" class="difflineplus">+      this.log.info(&quot;createFolder failed - status = &quot; + req.status);</span>
<a href="#l9.468"></a><span id="l9.468" class="difflineplus">+    }.bind(this);</span>
<a href="#l9.469"></a><span id="l9.469" class="difflineplus">+    // Add a space at the end because http logging looks for two</span>
<a href="#l9.470"></a><span id="l9.470" class="difflineplus">+    // spaces in the X-Auth-Token header to avoid putting passwords</span>
<a href="#l9.471"></a><span id="l9.471" class="difflineplus">+    // in the log, and crashes if there aren't two spaces.</span>
<a href="#l9.472"></a><span id="l9.472" class="difflineplus">+    req.setRequestHeader(&quot;X-Auth-Token&quot;, this._cachedAuthToken + &quot; &quot;);</span>
<a href="#l9.473"></a><span id="l9.473" class="difflineplus">+    req.setRequestHeader(&quot;X-Api-Key&quot;, kApiKey);</span>
<a href="#l9.474"></a><span id="l9.474" class="difflineplus">+    req.setRequestHeader(&quot;Accept&quot;, &quot;application/json&quot;);</span>
<a href="#l9.475"></a><span id="l9.475" class="difflineplus">+    req.send();</span>
<a href="#l9.476"></a><span id="l9.476" class="difflineplus">+  },</span>
<a href="#l9.477"></a><span id="l9.477" class="difflineplus">+</span>
<a href="#l9.478"></a><span id="l9.478" class="difflineplus">+  /**</span>
<a href="#l9.479"></a><span id="l9.479">    * If a the user associated with this account key already has an account,</span>
<a href="#l9.480"></a><span id="l9.480">    * allows them to log in.</span>
<a href="#l9.481"></a><span id="l9.481">    *</span>
<a href="#l9.482"></a><span id="l9.482">    * @param aRequestObserver an nsIRequestObserver for monitoring the start and</span>
<a href="#l9.483"></a><span id="l9.483">    *                         stop states of the login procedure.</span>
<a href="#l9.484"></a><span id="l9.484">    */</span>
<a href="#l9.485"></a><span id="l9.485">   createExistingAccount: function nsYouSendIt_createExistingAccount(aRequestObserver) {</span>
<a href="#l9.486"></a><span id="l9.486">      // XXX: replace this with a better function</span>
<a href="#l9.487"></a><span id="l9.487" class="difflineat">@@ -484,80 +689,71 @@ nsYouSendIt.prototype = {</span>
<a href="#l9.488"></a><span id="l9.488">     let uploadInfo = this._uploadInfo[aFile.path];</span>
<a href="#l9.489"></a><span id="l9.489">     if (!uploadInfo) {</span>
<a href="#l9.490"></a><span id="l9.490">       this.log.error(&quot;Could not find a record for the file to be deleted.&quot;);</span>
<a href="#l9.491"></a><span id="l9.491">       throw Cr.NS_ERROR_FAILURE;</span>
<a href="#l9.492"></a><span id="l9.492">     }</span>
<a href="#l9.493"></a><span id="l9.493"> </span>
<a href="#l9.494"></a><span id="l9.494">     let req = Cc[&quot;@mozilla.org/xmlextras/xmlhttprequest;1&quot;]</span>
<a href="#l9.495"></a><span id="l9.495">                 .createInstance(Ci.nsIXMLHttpRequest);</span>
<a href="#l9.496"></a><span id="l9.496" class="difflineminus">-    let resource = kItemPath + uploadInfo.itemId;</span>
<a href="#l9.497"></a><span id="l9.497"> </span>
<a href="#l9.498"></a><span id="l9.498" class="difflineminus">-    req.open(&quot;DELETE&quot;, gServerUrl + resource, true);</span>
<a href="#l9.499"></a><span id="l9.499" class="difflineplus">+    let args = kFolderFilePath + uploadInfo.fileId + &quot;?&quot;;</span>
<a href="#l9.500"></a><span id="l9.500"> </span>
<a href="#l9.501"></a><span id="l9.501" class="difflineminus">-    this.log.info(&quot;Sending request to: &quot; + gServerUrl + resource);</span>
<a href="#l9.502"></a><span id="l9.502" class="difflineplus">+    req.open(&quot;DELETE&quot;, gServerUrl + args + kUrlTail, true);</span>
<a href="#l9.503"></a><span id="l9.503" class="difflineplus">+    this.log.info(&quot;Sending request to: &quot; + gServerUrl + args);</span>
<a href="#l9.504"></a><span id="l9.504"> </span>
<a href="#l9.505"></a><span id="l9.505" class="difflineminus">-    req.onerror = function() {</span>
<a href="#l9.506"></a><span id="l9.506" class="difflineminus">-      this._lastErrorStatus = req.status;</span>
<a href="#l9.507"></a><span id="l9.507" class="difflineminus">-      this._lastErrorText = req.responseText;</span>
<a href="#l9.508"></a><span id="l9.508" class="difflineplus">+    req.onerror = function() {    </span>
<a href="#l9.509"></a><span id="l9.509" class="difflineplus">+      let response = JSON.parse(req.responseText);</span>
<a href="#l9.510"></a><span id="l9.510" class="difflineplus">+      this._lastErrorStatus = response.errorStatus.status;</span>
<a href="#l9.511"></a><span id="l9.511" class="difflineplus">+      this._lastErrorText = response.errorStatus.message;</span>
<a href="#l9.512"></a><span id="l9.512">       this.log.error(&quot;There was a problem deleting: &quot; + this._lastErrorText);</span>
<a href="#l9.513"></a><span id="l9.513">       aCallback.onStopRequest(null, null, Cr.NS_ERROR_FAILURE);</span>
<a href="#l9.514"></a><span id="l9.514">     }.bind(this);</span>
<a href="#l9.515"></a><span id="l9.515"> </span>
<a href="#l9.516"></a><span id="l9.516">     req.onload = function() {</span>
<a href="#l9.517"></a><span id="l9.517" class="difflineminus">-      let response = req.responseText.replace(/&lt;\?xml[^&gt;]*\?&gt;/, &quot;&quot;);</span>
<a href="#l9.518"></a><span id="l9.518" class="difflineminus">-</span>
<a href="#l9.519"></a><span id="l9.519" class="difflineminus">-      if (req.status &gt;= 200 &amp;&amp; req.status &lt; 400) {</span>
<a href="#l9.520"></a><span id="l9.520" class="difflineminus">-        this.log.info(&quot;Got back deletion response: &quot; + response);</span>
<a href="#l9.521"></a><span id="l9.521" class="difflineminus">-        let docResponse = new XML(response);</span>
<a href="#l9.522"></a><span id="l9.522" class="difflineminus">-        this.log.info(&quot;docResponse = &quot; + docResponse);</span>
<a href="#l9.523"></a><span id="l9.523" class="difflineminus">-</span>
<a href="#l9.524"></a><span id="l9.524" class="difflineminus">-        if (&quot;errorStatus&quot; in docResponse) {</span>
<a href="#l9.525"></a><span id="l9.525" class="difflineminus">-          // Argh - for some reason, on deletion, the error code for a stale</span>
<a href="#l9.526"></a><span id="l9.526" class="difflineminus">-          // token is 401 instead of 500.</span>
<a href="#l9.527"></a><span id="l9.527" class="difflineminus">-          if (docResponse.errorStatus.code == 401) {</span>
<a href="#l9.528"></a><span id="l9.528" class="difflineplus">+      // Response is the URL.</span>
<a href="#l9.529"></a><span id="l9.529" class="difflineplus">+      let response = req.responseText;</span>
<a href="#l9.530"></a><span id="l9.530" class="difflineplus">+      this.log.info(&quot;delete response = &quot; + response);</span>
<a href="#l9.531"></a><span id="l9.531" class="difflineplus">+      let deleteInfo = JSON.parse(response);</span>
<a href="#l9.532"></a><span id="l9.532"> </span>
<a href="#l9.533"></a><span id="l9.533" class="difflineminus">-            this.log.warn(&quot;Token has gone stale! Will attempt to reauth.&quot;);</span>
<a href="#l9.534"></a><span id="l9.534" class="difflineminus">-            // Our token has gone stale</span>
<a href="#l9.535"></a><span id="l9.535" class="difflineminus">-            let onTokenRefresh = function() {</span>
<a href="#l9.536"></a><span id="l9.536" class="difflineminus">-              this.deleteFile(aFile, aCallback);</span>
<a href="#l9.537"></a><span id="l9.537" class="difflineminus">-            }.bind(this);</span>
<a href="#l9.538"></a><span id="l9.538" class="difflineplus">+      if (deleteInfo.errorStatus) {</span>
<a href="#l9.539"></a><span id="l9.539" class="difflineplus">+        // Argh - for some reason, on deletion, the error code for a stale</span>
<a href="#l9.540"></a><span id="l9.540" class="difflineplus">+        // token is 401 instead of 500.</span>
<a href="#l9.541"></a><span id="l9.541" class="difflineplus">+        if (deleteInfo.errorStatus.code == 401) {</span>
<a href="#l9.542"></a><span id="l9.542" class="difflineplus">+          this.log.warn(&quot;Token has gone stale! Will attempt to reauth.&quot;);</span>
<a href="#l9.543"></a><span id="l9.543" class="difflineplus">+          // Our token has gone stale</span>
<a href="#l9.544"></a><span id="l9.544" class="difflineplus">+          let onTokenRefresh = function() {</span>
<a href="#l9.545"></a><span id="l9.545" class="difflineplus">+            this.deleteFile(aFile, aCallback);</span>
<a href="#l9.546"></a><span id="l9.546" class="difflineplus">+          }.bind(this);</span>
<a href="#l9.547"></a><span id="l9.547"> </span>
<a href="#l9.548"></a><span id="l9.548" class="difflineminus">-            let onTokenRefreshFailure = function() {</span>
<a href="#l9.549"></a><span id="l9.549" class="difflineminus">-              aCallback.onStopRequest(null, null,</span>
<a href="#l9.550"></a><span id="l9.550" class="difflineminus">-                                      Ci.nsIMsgCloudFileProvider.authErr);</span>
<a href="#l9.551"></a><span id="l9.551" class="difflineminus">-            }</span>
<a href="#l9.552"></a><span id="l9.552" class="difflineminus">-            this._handleStaleToken(onTokenRefresh, onTokenRefreshFailure);</span>
<a href="#l9.553"></a><span id="l9.553" class="difflineminus">-            return;</span>
<a href="#l9.554"></a><span id="l9.554" class="difflineplus">+          let onTokenRefreshFailure = function() {</span>
<a href="#l9.555"></a><span id="l9.555" class="difflineplus">+            aCallback.onStopRequest(null, null,</span>
<a href="#l9.556"></a><span id="l9.556" class="difflineplus">+                                    Ci.nsIMsgCloudFileProvider.authErr);</span>
<a href="#l9.557"></a><span id="l9.557">           }</span>
<a href="#l9.558"></a><span id="l9.558" class="difflineminus">-</span>
<a href="#l9.559"></a><span id="l9.559" class="difflineminus">-          this.log.error(&quot;Server has returned a failure on our delete request.&quot;);</span>
<a href="#l9.560"></a><span id="l9.560" class="difflineminus">-          this.log.error(&quot;Error code: &quot; + docResponse.errorStatus.code);</span>
<a href="#l9.561"></a><span id="l9.561" class="difflineminus">-          this.log.error(&quot;Error message: &quot; + docResponse.errorStatus.message);</span>
<a href="#l9.562"></a><span id="l9.562" class="difflineminus">-          aCallback.onStopRequest(null, null,</span>
<a href="#l9.563"></a><span id="l9.563" class="difflineminus">-                                  Ci.nsIMsgCloudFileProvider.uploadErr);</span>
<a href="#l9.564"></a><span id="l9.564" class="difflineplus">+          this._handleStaleToken(onTokenRefresh, onTokenRefreshFailure);</span>
<a href="#l9.565"></a><span id="l9.565">           return;</span>
<a href="#l9.566"></a><span id="l9.566">         }</span>
<a href="#l9.567"></a><span id="l9.567"> </span>
<a href="#l9.568"></a><span id="l9.568" class="difflineminus">-        this.log.info(&quot;Delete was successful!&quot;);</span>
<a href="#l9.569"></a><span id="l9.569" class="difflineminus">-        // Success!</span>
<a href="#l9.570"></a><span id="l9.570" class="difflineminus">-        aCallback.onStopRequest(null, null, Cr.NS_OK);</span>
<a href="#l9.571"></a><span id="l9.571" class="difflineplus">+        this.log.error(&quot;Server has returned a failure on our delete request.&quot;);</span>
<a href="#l9.572"></a><span id="l9.572" class="difflineplus">+        this.log.error(&quot;Error code: &quot; + deleteInfo.errorStatus.code);</span>
<a href="#l9.573"></a><span id="l9.573" class="difflineplus">+        this.log.error(&quot;Error message: &quot; + deleteInfo.errorStatus.message);</span>
<a href="#l9.574"></a><span id="l9.574" class="difflineplus">+        //aCallback.onStopRequest(null, null,</span>
<a href="#l9.575"></a><span id="l9.575" class="difflineplus">+        //                        Ci.nsIMsgCloudFileProvider.uploadErr);</span>
<a href="#l9.576"></a><span id="l9.576" class="difflineplus">+        return;</span>
<a href="#l9.577"></a><span id="l9.577">       }</span>
<a href="#l9.578"></a><span id="l9.578" class="difflineminus">-      else {</span>
<a href="#l9.579"></a><span id="l9.579" class="difflineminus">-        this._lastErrorText = response;</span>
<a href="#l9.580"></a><span id="l9.580" class="difflineminus">-        this.log.error(&quot;Delete was not successful: &quot; + this._lastErrorText);</span>
<a href="#l9.581"></a><span id="l9.581" class="difflineminus">-        this._lastErrorStatus = req.status;</span>
<a href="#l9.582"></a><span id="l9.582" class="difflineminus">-        aCallback.onStopRequest(null, null, Cr.NS_ERROR_FAILURE);</span>
<a href="#l9.583"></a><span id="l9.583" class="difflineminus">-      }</span>
<a href="#l9.584"></a><span id="l9.584" class="difflineplus">+</span>
<a href="#l9.585"></a><span id="l9.585" class="difflineplus">+      this.log.info(&quot;Delete was successful!&quot;);</span>
<a href="#l9.586"></a><span id="l9.586" class="difflineplus">+      // Success!</span>
<a href="#l9.587"></a><span id="l9.587" class="difflineplus">+      aCallback.onStopRequest(null, null, Cr.NS_OK);</span>
<a href="#l9.588"></a><span id="l9.588">     }.bind(this);</span>
<a href="#l9.589"></a><span id="l9.589"> </span>
<a href="#l9.590"></a><span id="l9.590" class="difflineminus">-    this.log.info(&quot;Sending delete request...&quot;);</span>
<a href="#l9.591"></a><span id="l9.591">     req.setRequestHeader(&quot;X-Auth-Token&quot;, this._cachedAuthToken + &quot; &quot;);</span>
<a href="#l9.592"></a><span id="l9.592">     req.setRequestHeader(&quot;X-Api-Key&quot;, kApiKey);</span>
<a href="#l9.593"></a><span id="l9.593">     req.setRequestHeader(&quot;Content-Type&quot;, &quot;application/x-www-form-urlencoded&quot;);</span>
<a href="#l9.594"></a><span id="l9.594" class="difflineplus">+    req.setRequestHeader(&quot;Accept&quot;, &quot;application/json&quot;);</span>
<a href="#l9.595"></a><span id="l9.595">     req.send();</span>
<a href="#l9.596"></a><span id="l9.596">   },</span>
<a href="#l9.597"></a><span id="l9.597"> </span>
<a href="#l9.598"></a><span id="l9.598">   /**</span>
<a href="#l9.599"></a><span id="l9.599">    * Returns the saved password for this account if one exists, or prompts</span>
<a href="#l9.600"></a><span id="l9.600">    * the user for a password. Returns the empty string on failure.</span>
<a href="#l9.601"></a><span id="l9.601">    *</span>
<a href="#l9.602"></a><span id="l9.602">    * @param aUsername the username associated with the account / password.</span>
<a href="#l9.603"></a><span id="l9.603" class="difflineat">@@ -580,17 +776,17 @@ nsYouSendIt.prototype = {</span>
<a href="#l9.604"></a><span id="l9.604">     }</span>
<a href="#l9.605"></a><span id="l9.605">     if (aNoPrompt)</span>
<a href="#l9.606"></a><span id="l9.606">       return &quot;&quot;;</span>
<a href="#l9.607"></a><span id="l9.607"> </span>
<a href="#l9.608"></a><span id="l9.608">     // OK, let's prompt for it.</span>
<a href="#l9.609"></a><span id="l9.609">     let win = Services.wm.getMostRecentWindow(null);</span>
<a href="#l9.610"></a><span id="l9.610"> </span>
<a href="#l9.611"></a><span id="l9.611">     let authPrompter = Services.ww.getNewAuthPrompter(win);</span>
<a href="#l9.612"></a><span id="l9.612" class="difflineminus">-    var password = { value: &quot;&quot; };</span>
<a href="#l9.613"></a><span id="l9.613" class="difflineplus">+    let password = { value: &quot;&quot; };</span>
<a href="#l9.614"></a><span id="l9.614">     // Use the service name in the prompt text</span>
<a href="#l9.615"></a><span id="l9.615">     let serverUrl = gServerUrl;</span>
<a href="#l9.616"></a><span id="l9.616">     let userPos = gServerUrl.indexOf(&quot;//&quot;) + 2;</span>
<a href="#l9.617"></a><span id="l9.617">     let userNamePart = encodeURIComponent(this._userName) + '@';</span>
<a href="#l9.618"></a><span id="l9.618">     serverUrl = gServerUrl.substr(0, userPos) + userNamePart + gServerUrl.substr(userPos);</span>
<a href="#l9.619"></a><span id="l9.619">     let messengerBundle = Services.strings.createBundle(</span>
<a href="#l9.620"></a><span id="l9.620">       &quot;chrome://messenger/locale/messenger.properties&quot;);</span>
<a href="#l9.621"></a><span id="l9.621">     let promptString = messengerBundle.formatStringFromName(&quot;passwordPrompt&quot;,</span>
<a href="#l9.622"></a><span id="l9.622" class="difflineat">@@ -600,17 +796,17 @@ nsYouSendIt.prototype = {</span>
<a href="#l9.623"></a><span id="l9.623"> </span>
<a href="#l9.624"></a><span id="l9.624">     if (authPrompter.promptPassword(this.displayName, promptString, serverUrl,</span>
<a href="#l9.625"></a><span id="l9.625">                                     authPrompter.SAVE_PASSWORD_PERMANENTLY,</span>
<a href="#l9.626"></a><span id="l9.626">                                     password))</span>
<a href="#l9.627"></a><span id="l9.627">       return password.value;</span>
<a href="#l9.628"></a><span id="l9.628"> </span>
<a href="#l9.629"></a><span id="l9.629">     return &quot;&quot;;</span>
<a href="#l9.630"></a><span id="l9.630">   },</span>
<a href="#l9.631"></a><span id="l9.631" class="difflineminus">-</span>
<a href="#l9.632"></a><span id="l9.632" class="difflineplus">+ </span>
<a href="#l9.633"></a><span id="l9.633">   /**</span>
<a href="#l9.634"></a><span id="l9.634">    * Clears any saved YouSendIt passwords for this instance's account.</span>
<a href="#l9.635"></a><span id="l9.635">    */</span>
<a href="#l9.636"></a><span id="l9.636">   clearPassword: function nsYouSendIt_clearPassword() {</span>
<a href="#l9.637"></a><span id="l9.637">     let logins = Services.logins.findLogins({}, gServerUrl, null, gServerUrl);</span>
<a href="#l9.638"></a><span id="l9.638">     for each (let loginInfo in logins)</span>
<a href="#l9.639"></a><span id="l9.639">       if (loginInfo.username == this._userName)</span>
<a href="#l9.640"></a><span id="l9.640">         Services.logins.removeLogin(loginInfo);</span>
<a href="#l9.641"></a><span id="l9.641" class="difflineat">@@ -623,23 +819,23 @@ nsYouSendIt.prototype = {</span>
<a href="#l9.642"></a><span id="l9.642">    * @param failureCallback the callback to be fired if loggong on fails</span>
<a href="#l9.643"></a><span id="l9.643">    * @aparam aWithUI a boolean for whether or not we should prompt for a password</span>
<a href="#l9.644"></a><span id="l9.644">    *                 if no auth token is currently stored.</span>
<a href="#l9.645"></a><span id="l9.645">    */</span>
<a href="#l9.646"></a><span id="l9.646">   logon: function nsYouSendIt_login(successCallback, failureCallback, aWithUI) {</span>
<a href="#l9.647"></a><span id="l9.647">     this.log.info(&quot;Logging in, aWithUI = &quot; + aWithUI);</span>
<a href="#l9.648"></a><span id="l9.648">     if (this._password == undefined || !this._password)</span>
<a href="#l9.649"></a><span id="l9.649">       this._password = this.getPassword(this._userName, !aWithUI);</span>
<a href="#l9.650"></a><span id="l9.650" class="difflineminus">-    let args = &quot;?email=&quot; + this._userName + &quot;&amp;password=&quot; + this._password;</span>
<a href="#l9.651"></a><span id="l9.651" class="difflineplus">+    let args = &quot;?email=&quot; + this._userName + &quot;&amp;password=&quot; + this._password + &quot;&amp;&quot;;</span>
<a href="#l9.652"></a><span id="l9.652">     this.log.info(&quot;Sending login information...&quot;);</span>
<a href="#l9.653"></a><span id="l9.653">     let req = Cc[&quot;@mozilla.org/xmlextras/xmlhttprequest;1&quot;]</span>
<a href="#l9.654"></a><span id="l9.654">                 .createInstance(Ci.nsIXMLHttpRequest);</span>
<a href="#l9.655"></a><span id="l9.655">     let curDate = Date.now().toString();</span>
<a href="#l9.656"></a><span id="l9.656"> </span>
<a href="#l9.657"></a><span id="l9.657" class="difflineminus">-    req.open(&quot;POST&quot;, gServerUrl + kAuthPath + args, true);</span>
<a href="#l9.658"></a><span id="l9.658" class="difflineplus">+    req.open(&quot;POST&quot;, gServerUrl + kAuthPath + args + kUrlTail, true);</span>
<a href="#l9.659"></a><span id="l9.659">     req.onerror = function() {</span>
<a href="#l9.660"></a><span id="l9.660">       this.log.info(&quot;logon failure&quot;);</span>
<a href="#l9.661"></a><span id="l9.661">       failureCallback();</span>
<a href="#l9.662"></a><span id="l9.662">     }.bind(this);</span>
<a href="#l9.663"></a><span id="l9.663"> </span>
<a href="#l9.664"></a><span id="l9.664">     req.onload = function() {</span>
<a href="#l9.665"></a><span id="l9.665">       if (req.status &gt;= 200 &amp;&amp; req.status &lt; 400) {</span>
<a href="#l9.666"></a><span id="l9.666">         this.log.info(&quot;auth token response = &quot; + req.responseText);</span>
<a href="#l9.667"></a><span id="l9.667" class="difflineat">@@ -707,16 +903,17 @@ nsYouSendItFileUploader.prototype = {</span>
<a href="#l9.668"></a><span id="l9.668">   callback : null,</span>
<a href="#l9.669"></a><span id="l9.669">   _request : null,</span>
<a href="#l9.670"></a><span id="l9.670"> </span>
<a href="#l9.671"></a><span id="l9.671">   /**</span>
<a href="#l9.672"></a><span id="l9.672">    * Kicks off the upload procedure for this uploader.</span>
<a href="#l9.673"></a><span id="l9.673">    */</span>
<a href="#l9.674"></a><span id="l9.674">   startUpload: function nsYSIFU_startUpload() {</span>
<a href="#l9.675"></a><span id="l9.675">     let curDate = Date.now().toString();</span>
<a href="#l9.676"></a><span id="l9.676" class="difflineplus">+</span>
<a href="#l9.677"></a><span id="l9.677">     this.requestObserver.onStartRequest(null, null);</span>
<a href="#l9.678"></a><span id="l9.678"> </span>
<a href="#l9.679"></a><span id="l9.679">     let onSuccess = function() {</span>
<a href="#l9.680"></a><span id="l9.680">       this._uploadFile();</span>
<a href="#l9.681"></a><span id="l9.681">     }.bind(this);</span>
<a href="#l9.682"></a><span id="l9.682"> </span>
<a href="#l9.683"></a><span id="l9.683">     let onFailure = function() {</span>
<a href="#l9.684"></a><span id="l9.684">       this.callback(this.requestObserver, Ci.nsIMsgCloudFileProvider.uploadErr);</span>
<a href="#l9.685"></a><span id="l9.685" class="difflineat">@@ -729,35 +926,31 @@ nsYouSendItFileUploader.prototype = {</span>
<a href="#l9.686"></a><span id="l9.686">    * Communicates with YSI to get the URL that we will send the upload</span>
<a href="#l9.687"></a><span id="l9.687">    * request to.</span>
<a href="#l9.688"></a><span id="l9.688">    *</span>
<a href="#l9.689"></a><span id="l9.689">    * @param successCallback the callback fired if getting the URL is successful</span>
<a href="#l9.690"></a><span id="l9.690">    * @param failureCallback the callback fired if getting the URL fails</span>
<a href="#l9.691"></a><span id="l9.691">    */</span>
<a href="#l9.692"></a><span id="l9.692">   _prepareToSend: function nsYSIFU__prepareToSend(successCallback,</span>
<a href="#l9.693"></a><span id="l9.693">                                                   failureCallback) {</span>
<a href="#l9.694"></a><span id="l9.694" class="difflineminus">-    let args = &quot;?email=&quot; + this.youSendIt._userName + &quot;&amp;recipients=&quot; +</span>
<a href="#l9.695"></a><span id="l9.695" class="difflineminus">-               encodeURIComponent(this.youSendIt._userName) +</span>
<a href="#l9.696"></a><span id="l9.696" class="difflineminus">-               &quot;&amp;secureUrl=true&quot;;</span>
<a href="#l9.697"></a><span id="l9.697" class="difflineminus">-</span>
<a href="#l9.698"></a><span id="l9.698">     let req = Cc[&quot;@mozilla.org/xmlextras/xmlhttprequest;1&quot;]</span>
<a href="#l9.699"></a><span id="l9.699">                 .createInstance(Ci.nsIXMLHttpRequest);</span>
<a href="#l9.700"></a><span id="l9.700"> </span>
<a href="#l9.701"></a><span id="l9.701" class="difflineminus">-    req.open(&quot;POST&quot;, gServerUrl + kItemSendPath + args, true);</span>
<a href="#l9.702"></a><span id="l9.702" class="difflineplus">+    req.open(&quot;POST&quot;, gServerUrl + kFolderInitUploadPath + &quot;?&quot; + kUrlTail, true);</span>
<a href="#l9.703"></a><span id="l9.703"> </span>
<a href="#l9.704"></a><span id="l9.704">     req.onerror = failureCallback;</span>
<a href="#l9.705"></a><span id="l9.705"> </span>
<a href="#l9.706"></a><span id="l9.706">     req.onload = function() {</span>
<a href="#l9.707"></a><span id="l9.707">       let response = req.responseText;</span>
<a href="#l9.708"></a><span id="l9.708">       if (req.status &gt;= 200 &amp;&amp; req.status &lt; 400) {</span>
<a href="#l9.709"></a><span id="l9.709">         this._urlInfo = JSON.parse(response);</span>
<a href="#l9.710"></a><span id="l9.710">         this.youSendIt._uploadInfo[this.file.path] = this._urlInfo;</span>
<a href="#l9.711"></a><span id="l9.711">         this.log.info(&quot;in prepare to send response = &quot; + response);</span>
<a href="#l9.712"></a><span id="l9.712" class="difflineminus">-        this.log.info(&quot;urlInfo = &quot; + this._urlInfo);</span>
<a href="#l9.713"></a><span id="l9.713" class="difflineminus">-        this.log.info(&quot;upload url = &quot; + this._urlInfo.uploadUrl);</span>
<a href="#l9.714"></a><span id="l9.714" class="difflineplus">+        this.log.info(&quot;file id = &quot; + this._urlInfo.fileId);</span>
<a href="#l9.715"></a><span id="l9.715" class="difflineplus">+        this.log.info(&quot;upload url = &quot; + this._urlInfo.uploadUrl[0]);</span>
<a href="#l9.716"></a><span id="l9.716">         successCallback();</span>
<a href="#l9.717"></a><span id="l9.717">       }</span>
<a href="#l9.718"></a><span id="l9.718">       else {</span>
<a href="#l9.719"></a><span id="l9.719">         this.log.error(&quot;Preparing to send failed!&quot;);</span>
<a href="#l9.720"></a><span id="l9.720">         this.log.error(&quot;Response was: &quot; + response);</span>
<a href="#l9.721"></a><span id="l9.721">         this.youSendIt._lastErrorText = req.responseText;</span>
<a href="#l9.722"></a><span id="l9.722">         this.youSendIt._lastErrorStatus = req.status;</span>
<a href="#l9.723"></a><span id="l9.723">         failureCallback();</span>
<a href="#l9.724"></a><span id="l9.724" class="difflineat">@@ -766,32 +959,31 @@ nsYouSendItFileUploader.prototype = {</span>
<a href="#l9.725"></a><span id="l9.725"> </span>
<a href="#l9.726"></a><span id="l9.726">     // Add a space at the end because http logging looks for two</span>
<a href="#l9.727"></a><span id="l9.727">     // spaces in the X-Auth-Token header to avoid putting passwords</span>
<a href="#l9.728"></a><span id="l9.728">     // in the log, and crashes if there aren't two spaces.</span>
<a href="#l9.729"></a><span id="l9.729">     req.setRequestHeader(&quot;X-Auth-Token&quot;, this.youSendIt._cachedAuthToken + &quot; &quot;);</span>
<a href="#l9.730"></a><span id="l9.730">     req.setRequestHeader(&quot;X-Api-Key&quot;, kApiKey);</span>
<a href="#l9.731"></a><span id="l9.731">     req.setRequestHeader(&quot;Accept&quot;, &quot;application/json&quot;);</span>
<a href="#l9.732"></a><span id="l9.732">     req.setRequestHeader(&quot;Content-Type&quot;, &quot;application/x-www-form-urlencoded&quot;);</span>
<a href="#l9.733"></a><span id="l9.733" class="difflineminus">-    this.log.info(&quot;Sending prepare request with args: &quot; + args);</span>
<a href="#l9.734"></a><span id="l9.734">     req.send();</span>
<a href="#l9.735"></a><span id="l9.735">   },</span>
<a href="#l9.736"></a><span id="l9.736"> </span>
<a href="#l9.737"></a><span id="l9.737">   /**</span>
<a href="#l9.738"></a><span id="l9.738">    * Once we've got the URL to upload the file to, this function actually does</span>
<a href="#l9.739"></a><span id="l9.739">    * the upload of the file to YouSendIt.</span>
<a href="#l9.740"></a><span id="l9.740">    */</span>
<a href="#l9.741"></a><span id="l9.741">   _uploadFile: function nsYSIFU__uploadFile() {</span>
<a href="#l9.742"></a><span id="l9.742">     let req = Cc[&quot;@mozilla.org/xmlextras/xmlhttprequest;1&quot;]</span>
<a href="#l9.743"></a><span id="l9.743">                 .createInstance(Ci.nsIXMLHttpRequest);</span>
<a href="#l9.744"></a><span id="l9.744"> </span>
<a href="#l9.745"></a><span id="l9.745">     let curDate = Date.now().toString();</span>
<a href="#l9.746"></a><span id="l9.746" class="difflineminus">-    this.log.info(&quot;upload url = &quot; + this._urlInfo.uploadUrl);</span>
<a href="#l9.747"></a><span id="l9.747" class="difflineplus">+    this.log.info(&quot;upload url = &quot; + this._urlInfo.uploadUrl[0]);</span>
<a href="#l9.748"></a><span id="l9.748">     this.request = req;</span>
<a href="#l9.749"></a><span id="l9.749" class="difflineminus">-    req.open(&quot;POST&quot;, this._urlInfo.uploadUrl, true);</span>
<a href="#l9.750"></a><span id="l9.750" class="difflineplus">+    req.open(&quot;POST&quot;, this._urlInfo.uploadUrl[0] + &quot;?&quot; + kUrlTail, true);</span>
<a href="#l9.751"></a><span id="l9.751">     req.onload = function() {</span>
<a href="#l9.752"></a><span id="l9.752">       this.cleanupTempFile();</span>
<a href="#l9.753"></a><span id="l9.753">       if (req.status &gt;= 200 &amp;&amp; req.status &lt; 400) {</span>
<a href="#l9.754"></a><span id="l9.754">         try {</span>
<a href="#l9.755"></a><span id="l9.755">           let response = req.responseText.replace(/&lt;\?xml[^&gt;]*\?&gt;/, &quot;&quot;);</span>
<a href="#l9.756"></a><span id="l9.756">           this.log.info(&quot;upload response = &quot; + response);</span>
<a href="#l9.757"></a><span id="l9.757">           let docResponse = new XML(response);</span>
<a href="#l9.758"></a><span id="l9.758">           this.log.info(&quot;docResponse = &quot; + docResponse);</span>
<a href="#l9.759"></a><span id="l9.759" class="difflineat">@@ -802,37 +994,36 @@ nsYouSendItFileUploader.prototype = {</span>
<a href="#l9.760"></a><span id="l9.760">           this.log.info(&quot;ysi error = &quot; + ysiError);</span>
<a href="#l9.761"></a><span id="l9.761">           let errorCode = docResponse['error-code'];</span>
<a href="#l9.762"></a><span id="l9.762">           this.log.info(&quot;error code = &quot; + errorCode);</span>
<a href="#l9.763"></a><span id="l9.763">           this._commitSend();</span>
<a href="#l9.764"></a><span id="l9.764">         } catch (ex) {</span>
<a href="#l9.765"></a><span id="l9.765">           this.log.error(ex);</span>
<a href="#l9.766"></a><span id="l9.766">         }</span>
<a href="#l9.767"></a><span id="l9.767">       }</span>
<a href="#l9.768"></a><span id="l9.768" class="difflineminus">-      else {</span>
<a href="#l9.769"></a><span id="l9.769" class="difflineplus">+      else</span>
<a href="#l9.770"></a><span id="l9.770">         this.callback(this.requestObserver,</span>
<a href="#l9.771"></a><span id="l9.771">                       Ci.nsIMsgCloudFileProvider.uploadErr);</span>
<a href="#l9.772"></a><span id="l9.772" class="difflineminus">-      }</span>
<a href="#l9.773"></a><span id="l9.773">     }.bind(this);</span>
<a href="#l9.774"></a><span id="l9.774"> </span>
<a href="#l9.775"></a><span id="l9.775">     req.onerror = function () {</span>
<a href="#l9.776"></a><span id="l9.776">       this.cleanupTempFile();</span>
<a href="#l9.777"></a><span id="l9.777">       if (this.callback)</span>
<a href="#l9.778"></a><span id="l9.778">         this.callback(this.requestObserver,</span>
<a href="#l9.779"></a><span id="l9.779">                       Ci.nsIMsgCloudFileProvider.uploadErr);</span>
<a href="#l9.780"></a><span id="l9.780">     }.bind(this);</span>
<a href="#l9.781"></a><span id="l9.781"> </span>
<a href="#l9.782"></a><span id="l9.782">     req.setRequestHeader(&quot;Date&quot;, curDate);</span>
<a href="#l9.783"></a><span id="l9.783">     let boundary = &quot;------&quot; + curDate;</span>
<a href="#l9.784"></a><span id="l9.784">     let contentType = &quot;multipart/form-data; boundary=&quot;+ boundary;</span>
<a href="#l9.785"></a><span id="l9.785">     req.setRequestHeader(&quot;Content-Type&quot;, contentType);</span>
<a href="#l9.786"></a><span id="l9.786"> </span>
<a href="#l9.787"></a><span id="l9.787">     let fileContents = &quot;--&quot; + boundary +</span>
<a href="#l9.788"></a><span id="l9.788">       &quot;\r\nContent-Disposition: form-data; name=\&quot;bid\&quot;\r\n\r\n&quot; +</span>
<a href="#l9.789"></a><span id="l9.789" class="difflineminus">-       this._urlInfo.itemId;</span>
<a href="#l9.790"></a><span id="l9.790" class="difflineplus">+       this._urlInfo.fileId;</span>
<a href="#l9.791"></a><span id="l9.791"> </span>
<a href="#l9.792"></a><span id="l9.792">     fileContents += &quot;\r\n--&quot; + boundary +</span>
<a href="#l9.793"></a><span id="l9.793">       &quot;\r\nContent-Disposition: form-data; name=\&quot;fname\&quot;; filename=\&quot;&quot; +</span>
<a href="#l9.794"></a><span id="l9.794">       this.file.leafName + &quot;\&quot;\r\nContent-Type: application/octet-stream&quot; +</span>
<a href="#l9.795"></a><span id="l9.795">       &quot;\r\n\r\n&quot;;</span>
<a href="#l9.796"></a><span id="l9.796"> </span>
<a href="#l9.797"></a><span id="l9.797">     // Since js doesn't like binary data in strings, we're going to create</span>
<a href="#l9.798"></a><span id="l9.798">     // a temp file consisting of the message preamble, the file contents, and</span>
<a href="#l9.799"></a><span id="l9.799" class="difflineat">@@ -905,48 +1096,96 @@ nsYouSendItFileUploader.prototype = {</span>
<a href="#l9.800"></a><span id="l9.800">       this.request = null;</span>
<a href="#l9.801"></a><span id="l9.801">     }</span>
<a href="#l9.802"></a><span id="l9.802">   },</span>
<a href="#l9.803"></a><span id="l9.803">   /**</span>
<a href="#l9.804"></a><span id="l9.804">    * Once the file is uploaded, if we want to get a sharing URL back, we have</span>
<a href="#l9.805"></a><span id="l9.805">    * to send a &quot;commit&quot; request - which this function does.</span>
<a href="#l9.806"></a><span id="l9.806">    */</span>
<a href="#l9.807"></a><span id="l9.807">   _commitSend: function nsYSIFU__commitSend() {</span>
<a href="#l9.808"></a><span id="l9.808" class="difflineplus">+    this.log.info(&quot;commit sending file &quot; + this._urlInfo.fileId);</span>
<a href="#l9.809"></a><span id="l9.809" class="difflineplus">+    </span>
<a href="#l9.810"></a><span id="l9.810">     let req = Cc[&quot;@mozilla.org/xmlextras/xmlhttprequest;1&quot;]</span>
<a href="#l9.811"></a><span id="l9.811">                 .createInstance(Ci.nsIXMLHttpRequest);</span>
<a href="#l9.812"></a><span id="l9.812" class="difflineminus">-    let resource = kItemCommitPath + &quot;/&quot; + this._urlInfo.itemId;</span>
<a href="#l9.813"></a><span id="l9.813" class="difflineminus">-    // Not quite sure how we're going to not have expiration.</span>
<a href="#l9.814"></a><span id="l9.814" class="difflineminus">-    let args = &quot;?sendEmailNotifications=false&amp;expiration=0&quot;;  // &amp;expiration=4000000</span>
<a href="#l9.815"></a><span id="l9.815" class="difflineminus">-    let curDate = Date.now().toString();</span>
<a href="#l9.816"></a><span id="l9.816" class="difflineplus">+    let args = &quot;?name=&quot; + this.file.leafName +</span>
<a href="#l9.817"></a><span id="l9.817" class="difflineplus">+               &quot;&amp;fileId=&quot; + this._urlInfo.fileId +</span>
<a href="#l9.818"></a><span id="l9.818" class="difflineplus">+               &quot;&amp;parentId=&quot; + this.youSendIt._folderId + &quot;&amp;&quot;;</span>
<a href="#l9.819"></a><span id="l9.819"> </span>
<a href="#l9.820"></a><span id="l9.820" class="difflineminus">-    this.log.info(&quot;in commit send resource = &quot; + resource);</span>
<a href="#l9.821"></a><span id="l9.821" class="difflineminus">-</span>
<a href="#l9.822"></a><span id="l9.822" class="difflineminus">-    req.open(&quot;POST&quot;, gServerUrl + resource + args, true);</span>
<a href="#l9.823"></a><span id="l9.823" class="difflineplus">+    req.open(&quot;POST&quot;, gServerUrl + kFolderCommitUploadPath + args + kUrlTail, true);</span>
<a href="#l9.824"></a><span id="l9.824"> </span>
<a href="#l9.825"></a><span id="l9.825">     req.onerror = function() {</span>
<a href="#l9.826"></a><span id="l9.826">       this.log.info(&quot;error in commit send&quot;);</span>
<a href="#l9.827"></a><span id="l9.827">       this.callback(this.requestObserver,</span>
<a href="#l9.828"></a><span id="l9.828">                     Ci.nsIMsgCloudFileProvider.uploadErr);</span>
<a href="#l9.829"></a><span id="l9.829">     }.bind(this);</span>
<a href="#l9.830"></a><span id="l9.830"> </span>
<a href="#l9.831"></a><span id="l9.831">     req.onload = function() {</span>
<a href="#l9.832"></a><span id="l9.832">       // Response is the URL.</span>
<a href="#l9.833"></a><span id="l9.833">       let response = req.responseText;</span>
<a href="#l9.834"></a><span id="l9.834">       this.log.info(&quot;commit response = &quot; + response);</span>
<a href="#l9.835"></a><span id="l9.835">       let uploadInfo = JSON.parse(response);</span>
<a href="#l9.836"></a><span id="l9.836"> </span>
<a href="#l9.837"></a><span id="l9.837" class="difflineminus">-      if (uploadInfo.downloadUrl != null) {</span>
<a href="#l9.838"></a><span id="l9.838" class="difflineminus">-        this.youSendIt._urlsForFiles[this.file.path] = uploadInfo.downloadUrl;</span>
<a href="#l9.839"></a><span id="l9.839" class="difflineminus">-        // Success!</span>
<a href="#l9.840"></a><span id="l9.840" class="difflineplus">+      let succeed = function() {</span>
<a href="#l9.841"></a><span id="l9.841">         this.callback(this.requestObserver, Cr.NS_OK);</span>
<a href="#l9.842"></a><span id="l9.842" class="difflineminus">-        return;</span>
<a href="#l9.843"></a><span id="l9.843" class="difflineplus">+      }.bind(this);</span>
<a href="#l9.844"></a><span id="l9.844" class="difflineplus">+</span>
<a href="#l9.845"></a><span id="l9.845" class="difflineplus">+      let failed = function() {</span>
<a href="#l9.846"></a><span id="l9.846" class="difflineplus">+        this.callback(this.requestObserver, this.file.leafName.length &gt; 120 </span>
<a href="#l9.847"></a><span id="l9.847" class="difflineplus">+                      ? Ci.nsIMsgCloudFileProvider.uploadExceedsFileNameLimit</span>
<a href="#l9.848"></a><span id="l9.848" class="difflineplus">+                      : Ci.nsIMsgCloudFileProvider.uploadErr);</span>
<a href="#l9.849"></a><span id="l9.849" class="difflineplus">+      }.bind(this);</span>
<a href="#l9.850"></a><span id="l9.850" class="difflineplus">+</span>
<a href="#l9.851"></a><span id="l9.851" class="difflineplus">+      if (uploadInfo.errorStatus) {</span>
<a href="#l9.852"></a><span id="l9.852" class="difflineplus">+        this.youSendIt._lastErrorText = uploadInfo.errorStatus.message;</span>
<a href="#l9.853"></a><span id="l9.853" class="difflineplus">+        this.youSendIt._lastErrorStatus = uploadInfo.errorStatus.code;</span>
<a href="#l9.854"></a><span id="l9.854" class="difflineplus">+        failed();</span>
<a href="#l9.855"></a><span id="l9.855" class="difflineplus">+      }</span>
<a href="#l9.856"></a><span id="l9.856" class="difflineplus">+      else if (uploadInfo.clickableDownloadUrl) {</span>
<a href="#l9.857"></a><span id="l9.857" class="difflineplus">+        this.youSendIt._urlsForFiles[this.file.path] = uploadInfo.clickableDownloadUrl;</span>
<a href="#l9.858"></a><span id="l9.858" class="difflineplus">+        succeed();</span>
<a href="#l9.859"></a><span id="l9.859">       }</span>
<a href="#l9.860"></a><span id="l9.860" class="difflineminus">-      this.youSendIt._lastErrorText = uploadInfo.errorStatus.message;</span>
<a href="#l9.861"></a><span id="l9.861" class="difflineminus">-      this.youSendIt._lastErrorStatus = uploadInfo.errorStatus.code;</span>
<a href="#l9.862"></a><span id="l9.862" class="difflineminus">-      this.callback(this.requestObserver, Ci.nsIMsgCloudFileProvider.uploadErr);</span>
<a href="#l9.863"></a><span id="l9.863" class="difflineplus">+      else</span>
<a href="#l9.864"></a><span id="l9.864" class="difflineplus">+        this._findDownloadUrl(uploadInfo.id, succeed, failed);</span>
<a href="#l9.865"></a><span id="l9.865" class="difflineplus">+    }.bind(this);</span>
<a href="#l9.866"></a><span id="l9.866" class="difflineplus">+</span>
<a href="#l9.867"></a><span id="l9.867" class="difflineplus">+    req.setRequestHeader(&quot;X-Auth-Token&quot;, this.youSendIt._cachedAuthToken + &quot; &quot;);</span>
<a href="#l9.868"></a><span id="l9.868" class="difflineplus">+    req.setRequestHeader(&quot;X-Api-Key&quot;, kApiKey);</span>
<a href="#l9.869"></a><span id="l9.869" class="difflineplus">+    req.setRequestHeader(&quot;Accept&quot;, &quot;application/json&quot;);</span>
<a href="#l9.870"></a><span id="l9.870" class="difflineplus">+    req.send();</span>
<a href="#l9.871"></a><span id="l9.871" class="difflineplus">+  },</span>
<a href="#l9.872"></a><span id="l9.872" class="difflineplus">+</span>
<a href="#l9.873"></a><span id="l9.873" class="difflineplus">+  /**</span>
<a href="#l9.874"></a><span id="l9.874" class="difflineplus">+   * Attempt to find download url for file.</span>
<a href="#l9.875"></a><span id="l9.875" class="difflineplus">+   *</span>
<a href="#l9.876"></a><span id="l9.876" class="difflineplus">+   * @param aFileId id of file</span>
<a href="#l9.877"></a><span id="l9.877" class="difflineplus">+   * @param aSuccessCallback called if url is found</span>
<a href="#l9.878"></a><span id="l9.878" class="difflineplus">+   * @param aFailureCallback called if url is not found</span>
<a href="#l9.879"></a><span id="l9.879" class="difflineplus">+   */</span>
<a href="#l9.880"></a><span id="l9.880" class="difflineplus">+  _findDownloadUrl: function nsYSIFU__findDownloadUrl(aFileId, aSuccessCallback, aFailureCallback) {</span>
<a href="#l9.881"></a><span id="l9.881" class="difflineplus">+    let req = Cc[&quot;@mozilla.org/xmlextras/xmlhttprequest;1&quot;]</span>
<a href="#l9.882"></a><span id="l9.882" class="difflineplus">+                .createInstance(Ci.nsIXMLHttpRequest);</span>
<a href="#l9.883"></a><span id="l9.883" class="difflineplus">+</span>
<a href="#l9.884"></a><span id="l9.884" class="difflineplus">+    req.open(&quot;GET&quot;, gServerUrl + kFolderFilePath + aFileId, true);</span>
<a href="#l9.885"></a><span id="l9.885" class="difflineplus">+</span>
<a href="#l9.886"></a><span id="l9.886" class="difflineplus">+    req.onerror = function() {</span>
<a href="#l9.887"></a><span id="l9.887" class="difflineplus">+      this.log.info(&quot;error in findDownloadUrl&quot;);</span>
<a href="#l9.888"></a><span id="l9.888" class="difflineplus">+      aFailureCallback();</span>
<a href="#l9.889"></a><span id="l9.889" class="difflineplus">+    }.bind(this);</span>
<a href="#l9.890"></a><span id="l9.890" class="difflineplus">+</span>
<a href="#l9.891"></a><span id="l9.891" class="difflineplus">+    req.onload = function() {</span>
<a href="#l9.892"></a><span id="l9.892" class="difflineplus">+      let response = req.responseText;</span>
<a href="#l9.893"></a><span id="l9.893" class="difflineplus">+      this.log.info(&quot;findDownloadUrl response = &quot; + response);</span>
<a href="#l9.894"></a><span id="l9.894" class="difflineplus">+      let fileInfo = JSON.parse(response);</span>
<a href="#l9.895"></a><span id="l9.895" class="difflineplus">+</span>
<a href="#l9.896"></a><span id="l9.896" class="difflineplus">+      if (fileInfo.errorStatus)</span>
<a href="#l9.897"></a><span id="l9.897" class="difflineplus">+        aFailureCallback();</span>
<a href="#l9.898"></a><span id="l9.898" class="difflineplus">+      else {</span>
<a href="#l9.899"></a><span id="l9.899" class="difflineplus">+        this.youSendIt._urlsForFiles[this.file.path] = fileInfo.clickableDownloadUrl;</span>
<a href="#l9.900"></a><span id="l9.900" class="difflineplus">+        aSuccessCallback();</span>
<a href="#l9.901"></a><span id="l9.901" class="difflineplus">+      }</span>
<a href="#l9.902"></a><span id="l9.902">     }.bind(this);</span>
<a href="#l9.903"></a><span id="l9.903"> </span>
<a href="#l9.904"></a><span id="l9.904">     req.setRequestHeader(&quot;X-Auth-Token&quot;, this.youSendIt._cachedAuthToken + &quot; &quot;);</span>
<a href="#l9.905"></a><span id="l9.905">     req.setRequestHeader(&quot;X-Api-Key&quot;, kApiKey);</span>
<a href="#l9.906"></a><span id="l9.906">     req.setRequestHeader(&quot;Accept&quot;, &quot;application/json&quot;);</span>
<a href="#l9.907"></a><span id="l9.907">     req.send();</span>
<a href="#l9.908"></a><span id="l9.908">   },</span>
<a href="#l9.909"></a><span id="l9.909"> </span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l10.1"></a><span id="l10.1" class="difflineminus">--- a/mail/components/compose/content/MsgComposeCommands.js</span>
<a href="#l10.2"></a><span id="l10.2" class="difflineplus">+++ b/mail/components/compose/content/MsgComposeCommands.js</span>
<a href="#l10.3"></a><span id="l10.3" class="difflineat">@@ -1039,16 +1039,22 @@ uploadListener.prototype = {</span>
<a href="#l10.4"></a><span id="l10.4">                                          this.attachment.name]);</span>
<a href="#l10.5"></a><span id="l10.5">         break;</span>
<a href="#l10.6"></a><span id="l10.6">       case this.cloudProvider.uploadWouldExceedQuota:</span>
<a href="#l10.7"></a><span id="l10.7">         title = bundle.getString(&quot;errorCloudFileQuota.title&quot;);</span>
<a href="#l10.8"></a><span id="l10.8">         msg = bundle.getFormattedString(&quot;errorCloudFileQuota.message&quot;,</span>
<a href="#l10.9"></a><span id="l10.9">                                         [displayName,</span>
<a href="#l10.10"></a><span id="l10.10">                                          this.attachment.name]);</span>
<a href="#l10.11"></a><span id="l10.11">         break;</span>
<a href="#l10.12"></a><span id="l10.12" class="difflineplus">+      case this.cloudProvider.uploadExceedsFileNameLimit:</span>
<a href="#l10.13"></a><span id="l10.13" class="difflineplus">+        title = bundle.getString(&quot;errorCloudFileNameLimit.title&quot;);</span>
<a href="#l10.14"></a><span id="l10.14" class="difflineplus">+        msg = bundle.getFormattedString(&quot;errorCloudFileNameLimit.message&quot;,</span>
<a href="#l10.15"></a><span id="l10.15" class="difflineplus">+                                        [displayName,</span>
<a href="#l10.16"></a><span id="l10.16" class="difflineplus">+                                         this.attachment.name]);</span>
<a href="#l10.17"></a><span id="l10.17" class="difflineplus">+        break;</span>
<a href="#l10.18"></a><span id="l10.18">       case this.cloudProvider.uploadExceedsFileLimit:</span>
<a href="#l10.19"></a><span id="l10.19">         title = bundle.getString(&quot;errorCloudFileLimit.title&quot;);</span>
<a href="#l10.20"></a><span id="l10.20">         msg = bundle.getFormattedString(&quot;errorCloudFileLimit.message&quot;,</span>
<a href="#l10.21"></a><span id="l10.21">                                         [displayName,</span>
<a href="#l10.22"></a><span id="l10.22">                                          this.attachment.name]);</span>
<a href="#l10.23"></a><span id="l10.23">         break;</span>
<a href="#l10.24"></a><span id="l10.24">       case this.cloudProvider.uploadCanceled:</span>
<a href="#l10.25"></a><span id="l10.25">         displayError = false;</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l11.1"></a><span id="l11.1">new file mode 100644</span>
<a href="#l11.2"></a><span id="l11.2" class="difflineminus">--- /dev/null</span>
<a href="#l11.3"></a><span id="l11.3" class="difflineplus">+++ b/mail/locales/en-US/chrome/messenger/cloudfile/YouSendIt/fileExceeds2GB.dtd</span>
<a href="#l11.4"></a><span id="l11.4" class="difflineat">@@ -0,0 +1,6 @@</span>
<a href="#l11.5"></a><span id="l11.5" class="difflineplus">+&lt;!-- This Source Code Form is subject to the terms of the Mozilla Public</span>
<a href="#l11.6"></a><span id="l11.6" class="difflineplus">+   - License, v. 2.0. If a copy of the MPL was not distributed with this file,</span>
<a href="#l11.7"></a><span id="l11.7" class="difflineplus">+   - You can obtain one at http://mozilla.org/MPL/2.0/.  --&gt;</span>
<a href="#l11.8"></a><span id="l11.8" class="difflineplus">+&lt;!ENTITY fileExceeds2GB.title   &quot;YouSendIt&quot;&gt;</span>
<a href="#l11.9"></a><span id="l11.9" class="difflineplus">+&lt;!ENTITY fileExceeds2GB.cancel &quot;OK&quot;&gt;</span>
<a href="#l11.10"></a><span id="l11.10" class="difflineplus">+&lt;!ENTITY fileExceeds2GB.description &quot;Sending files over 2GB is not supported.&quot;&gt;</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l12.1"></a><span id="l12.1">new file mode 100644</span>
<a href="#l12.2"></a><span id="l12.2" class="difflineminus">--- /dev/null</span>
<a href="#l12.3"></a><span id="l12.3" class="difflineplus">+++ b/mail/locales/en-US/chrome/messenger/cloudfile/YouSendIt/fileExceedsLimit.dtd</span>
<a href="#l12.4"></a><span id="l12.4" class="difflineat">@@ -0,0 +1,13 @@</span>
<a href="#l12.5"></a><span id="l12.5" class="difflineplus">+&lt;!-- This Source Code Form is subject to the terms of the Mozilla Public</span>
<a href="#l12.6"></a><span id="l12.6" class="difflineplus">+   - License, v. 2.0. If a copy of the MPL was not distributed with this file,</span>
<a href="#l12.7"></a><span id="l12.7" class="difflineplus">+   - You can obtain one at http://mozilla.org/MPL/2.0/.  --&gt;</span>
<a href="#l12.8"></a><span id="l12.8" class="difflineplus">+&lt;!ENTITY fileExceedsLimit.title   &quot;YouSendIt&quot;&gt;</span>
<a href="#l12.9"></a><span id="l12.9" class="difflineplus">+&lt;!ENTITY fileExceedsLimit.thatsBigFile   &quot;Sending files larger than 50 MB&quot;&gt;</span>
<a href="#l12.10"></a><span id="l12.10" class="difflineplus">+&lt;!ENTITY fileExceedsLimit.thatsBigFile2   &quot;is a premium feature.&quot;&gt;</span>
<a href="#l12.11"></a><span id="l12.11" class="difflineplus">+&lt;!ENTITY fileExceedsLimit.accept &quot;Upgrade&quot;&gt;</span>
<a href="#l12.12"></a><span id="l12.12" class="difflineplus">+&lt;!ENTITY fileExceedsLimit.cancel &quot;Cancel&quot;&gt;</span>
<a href="#l12.13"></a><span id="l12.13" class="difflineplus">+&lt;!ENTITY fileExceedsLimit.style &quot;width: 40em; min-height: 20em;&quot;&gt;</span>
<a href="#l12.14"></a><span id="l12.14" class="difflineplus">+&lt;!ENTITY fileExceedsLimit.proIncludes &quot;Upgrade now to send this file plus:&quot;&gt;</span>
<a href="#l12.15"></a><span id="l12.15" class="difflineplus">+&lt;!ENTITY fileExceedsLimit.pros1 &quot;Send files and folders up to 2GB&quot;&gt;</span>
<a href="#l12.16"></a><span id="l12.16" class="difflineplus">+&lt;!ENTITY fileExceedsLimit.pros2 &quot;Store unlimited files online&quot;&gt;</span>
<a href="#l12.17"></a><span id="l12.17" class="difflineplus">+&lt;!ENTITY fileExceedsLimit.pros3 &quot;Access and share files from anywhere&quot;&gt;</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l13.1"></a><span id="l13.1">new file mode 100644</span>
<a href="#l13.2"></a><span id="l13.2" class="difflineminus">--- /dev/null</span>
<a href="#l13.3"></a><span id="l13.3" class="difflineplus">+++ b/mail/locales/en-US/chrome/messenger/cloudfile/YouSendIt/fileExceedsQuota.dtd</span>
<a href="#l13.4"></a><span id="l13.4" class="difflineat">@@ -0,0 +1,11 @@</span>
<a href="#l13.5"></a><span id="l13.5" class="difflineplus">+&lt;!-- This Source Code Form is subject to the terms of the Mozilla Public</span>
<a href="#l13.6"></a><span id="l13.6" class="difflineplus">+   - License, v. 2.0. If a copy of the MPL was not distributed with this file,</span>
<a href="#l13.7"></a><span id="l13.7" class="difflineplus">+   - You can obtain one at http://mozilla.org/MPL/2.0/.  --&gt;</span>
<a href="#l13.8"></a><span id="l13.8" class="difflineplus">+&lt;!ENTITY fileExceedsQuota.title   &quot;YouSendIt&quot;&gt;</span>
<a href="#l13.9"></a><span id="l13.9" class="difflineplus">+&lt;!ENTITY fileExceedsQuota.storageLimitReached   &quot;Storage limit reached&quot;&gt;</span>
<a href="#l13.10"></a><span id="l13.10" class="difflineplus">+&lt;!ENTITY fileExceedsQuota.accept &quot;Upgrade&quot;&gt;</span>
<a href="#l13.11"></a><span id="l13.11" class="difflineplus">+&lt;!ENTITY fileExceedsQuota.cancel &quot;Cancel&quot;&gt;</span>
<a href="#l13.12"></a><span id="l13.12" class="difflineplus">+&lt;!ENTITY fileExceedsQuota.description &quot;You have reached your account storage limit of 2GB.&quot;&gt;</span>
<a href="#l13.13"></a><span id="l13.13" class="difflineplus">+&lt;!ENTITY fileExceedsQuota.description1 &quot;Your current storage usage is #XXX GB.&quot;&gt;</span>
<a href="#l13.14"></a><span id="l13.14" class="difflineplus">+&lt;!ENTITY fileExceedsQuota.description2 &quot;Upgrade today to Pro Plus account to get unlimited storage!&quot;&gt;</span>
<a href="#l13.15"></a><span id="l13.15" class="difflineplus">+&lt;!ENTITY fileExceedsQuota.description3 &quot;You can also choose to delete files in your account to create more space.&quot;&gt;</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l14.1"></a><span id="l14.1" class="difflineminus">--- a/mail/locales/en-US/chrome/messenger/messengercompose/composeMsgs.properties</span>
<a href="#l14.2"></a><span id="l14.2" class="difflineplus">+++ b/mail/locales/en-US/chrome/messenger/messengercompose/composeMsgs.properties</span>
<a href="#l14.3"></a><span id="l14.3" class="difflineat">@@ -393,16 +393,21 @@ errorCloudFileUpload.title=Upload Error</span>
<a href="#l14.4"></a><span id="l14.4"> ## %1$S is the name of the online storage service that uploading failed against.</span>
<a href="#l14.5"></a><span id="l14.5"> ## %2$S is the name of the file that failed to upload.</span>
<a href="#l14.6"></a><span id="l14.6"> errorCloudFileUpload.message=Unable to upload %2$S to %1$S.</span>
<a href="#l14.7"></a><span id="l14.7"> errorCloudFileQuota.title=Quota Error</span>
<a href="#l14.8"></a><span id="l14.8"> ## LOCALIZATION NOTE(errorCloudFileQuota.message):</span>
<a href="#l14.9"></a><span id="l14.9"> ## %1$S is the name of the online storage service being uploaded to.</span>
<a href="#l14.10"></a><span id="l14.10"> ## %2$S is the name of the file that could not be uploaded due to exceeding the storage limit.</span>
<a href="#l14.11"></a><span id="l14.11"> errorCloudFileQuota.message=Uploading %2$S to %1$S would exceed your space quota.</span>
<a href="#l14.12"></a><span id="l14.12" class="difflineplus">+errorCloudFileNameLimit.title=File Name Error</span>
<a href="#l14.13"></a><span id="l14.13" class="difflineplus">+## LOCALIZATION NOTE(errorCloudFileNameLimit.message):</span>
<a href="#l14.14"></a><span id="l14.14" class="difflineplus">+## %1$S is the name of the online storage service being uploaded to.</span>
<a href="#l14.15"></a><span id="l14.15" class="difflineplus">+## %2$S is the name of the file that could not be uploaded due to the excess file name length</span>
<a href="#l14.16"></a><span id="l14.16" class="difflineplus">+errorCloudFileNameLimit.message=Uploading %2$S to %1$S contains has more than 120 characters in its name. Please rename the file to have 120 characters or less in its name and upload again.</span>
<a href="#l14.17"></a><span id="l14.17"> errorCloudFileLimit.title=File Size Error</span>
<a href="#l14.18"></a><span id="l14.18"> ## LOCALIZATION NOTE(errorCloudFileLimit.message):</span>
<a href="#l14.19"></a><span id="l14.19"> ## %1$S is the name of the online storage service being uploaded to.</span>
<a href="#l14.20"></a><span id="l14.20"> ## %2$S is the name of the file that could not be uploaded due to size restrictions.</span>
<a href="#l14.21"></a><span id="l14.21"> errorCloudFileLimit.message=%2$S exceeds the maximum size for %1$S.</span>
<a href="#l14.22"></a><span id="l14.22"> errorCloudFileOther.title=Unknown Error</span>
<a href="#l14.23"></a><span id="l14.23"> ## LOCALIZATION NOTE(errorCloudFileOther.message):</span>
<a href="#l14.24"></a><span id="l14.24"> ## %1$S is the name of the online storage service that cannot be communicated with.</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l15.1"></a><span id="l15.1" class="difflineminus">--- a/mail/locales/jar.mn</span>
<a href="#l15.2"></a><span id="l15.2" class="difflineplus">+++ b/mail/locales/jar.mn</span>
<a href="#l15.3"></a><span id="l15.3" class="difflineat">@@ -126,16 +126,19 @@</span>
<a href="#l15.4"></a><span id="l15.4">   locale/@AB_CD@/messenger/addressbook/pref-directory-add.dtd           (%chrome/messenger/addressbook/pref-directory-add.dtd)</span>
<a href="#l15.5"></a><span id="l15.5">   locale/@AB_CD@/messenger/addressbook/replicationProgress.properties   (%chrome/messenger/addressbook/replicationProgress.properties)</span>
<a href="#l15.6"></a><span id="l15.6">   locale/@AB_CD@/messenger/cloudfile/addAccountDialog.dtd               (%chrome/messenger/cloudfile/addAccountDialog.dtd)</span>
<a href="#l15.7"></a><span id="l15.7">   locale/@AB_CD@/messenger/cloudfile/management.dtd                     (%chrome/messenger/cloudfile/management.dtd)</span>
<a href="#l15.8"></a><span id="l15.8">   locale/@AB_CD@/messenger/cloudfile/UbuntuOne/management.dtd           (%chrome/messenger/cloudfile/UbuntuOne/management.dtd)</span>
<a href="#l15.9"></a><span id="l15.9">   locale/@AB_CD@/messenger/cloudfile/UbuntuOne/settings.dtd             (%chrome/messenger/cloudfile/UbuntuOne/settings.dtd)</span>
<a href="#l15.10"></a><span id="l15.10">   locale/@AB_CD@/messenger/cloudfile/YouSendIt/management.dtd           (%chrome/messenger/cloudfile/YouSendIt/management.dtd)</span>
<a href="#l15.11"></a><span id="l15.11">   locale/@AB_CD@/messenger/cloudfile/YouSendIt/settings.dtd             (%chrome/messenger/cloudfile/YouSendIt/settings.dtd)</span>
<a href="#l15.12"></a><span id="l15.12" class="difflineplus">+  locale/@AB_CD@/messenger/cloudfile/YouSendIt/fileExceedsLimit.dtd     (%chrome/messenger/cloudfile/YouSendIt/fileExceedsLimit.dtd)</span>
<a href="#l15.13"></a><span id="l15.13" class="difflineplus">+  locale/@AB_CD@/messenger/cloudfile/YouSendIt/fileExceedsQuota.dtd     (%chrome/messenger/cloudfile/YouSendIt/fileExceedsQuota.dtd)</span>
<a href="#l15.14"></a><span id="l15.14" class="difflineplus">+  locale/@AB_CD@/messenger/cloudfile/YouSendIt/fileExceeds2GB.dtd       (%chrome/messenger/cloudfile/YouSendIt/fileExceeds2GB.dtd)</span>
<a href="#l15.15"></a><span id="l15.15">   locale/@AB_CD@/messenger/messengercompose/messengercompose.dtd        (%chrome/messenger/messengercompose/messengercompose.dtd)</span>
<a href="#l15.16"></a><span id="l15.16">   locale/@AB_CD@/messenger/messengercompose/addressingWidgetOverlay.dtd (%chrome/messenger/messengercompose/addressingWidgetOverlay.dtd)</span>
<a href="#l15.17"></a><span id="l15.17">   locale/@AB_CD@/messenger/messengercompose/askSendFormat.dtd           (%chrome/messenger/messengercompose/askSendFormat.dtd)</span>
<a href="#l15.18"></a><span id="l15.18">   locale/@AB_CD@/messenger/messengercompose/askSendFormat.properties    (%chrome/messenger/messengercompose/askSendFormat.properties)</span>
<a href="#l15.19"></a><span id="l15.19">   locale/@AB_CD@/messenger/messengercompose/sendProgress.dtd            (%chrome/messenger/messengercompose/sendProgress.dtd)</span>
<a href="#l15.20"></a><span id="l15.20">   locale/@AB_CD@/messenger/messengercompose/sendProgress.properties     (%chrome/messenger/messengercompose/sendProgress.properties)</span>
<a href="#l15.21"></a><span id="l15.21">   locale/@AB_CD@/messenger/messengercompose/composeMsgs.properties      (%chrome/messenger/messengercompose/composeMsgs.properties)</span>
<a href="#l15.22"></a><span id="l15.22">   locale/@AB_CD@/messenger/messengercompose/mailComposeEditorOverlay.dtd (%chrome/messenger/messengercompose/mailComposeEditorOverlay.dtd)</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l16.1"></a><span id="l16.1" class="difflineminus">--- a/mail/test/mozmill/shared-modules/test-cloudfile-yousendit-helpers.js</span>
<a href="#l16.2"></a><span id="l16.2" class="difflineplus">+++ b/mail/test/mozmill/shared-modules/test-cloudfile-yousendit-helpers.js</span>
<a href="#l16.3"></a><span id="l16.3" class="difflineat">@@ -17,21 +17,21 @@ Cu.import('resource://gre/modules/Servic</span>
<a href="#l16.4"></a><span id="l16.4"> Cu.import('resource:///modules/cloudFileAccounts.js');</span>
<a href="#l16.5"></a><span id="l16.5"> </span>
<a href="#l16.6"></a><span id="l16.6"> const kDefaultServerPort = 4444;</span>
<a href="#l16.7"></a><span id="l16.7"> const kServerRoot = &quot;http://localhost:&quot; + kDefaultServerPort;</span>
<a href="#l16.8"></a><span id="l16.8"> const kServerPath = &quot;&quot;;</span>
<a href="#l16.9"></a><span id="l16.9"> const kServerURL = kServerRoot + kServerPath;</span>
<a href="#l16.10"></a><span id="l16.10"> const kAuthPath = &quot;/dpi/v1/auth&quot;;</span>
<a href="#l16.11"></a><span id="l16.11"> const kUserInfoPath = &quot;/dpi/v2/user&quot;;</span>
<a href="#l16.12"></a><span id="l16.12" class="difflineminus">-const kFilePreparePath = &quot;/dpi/v1/item/send&quot;;</span>
<a href="#l16.13"></a><span id="l16.13" class="difflineplus">+const kFolderPath = &quot;/dpi/v1/folder/&quot;;</span>
<a href="#l16.14"></a><span id="l16.14" class="difflineplus">+const kFolderInitUploadPath = kFolderPath + &quot;file/initUpload&quot;;</span>
<a href="#l16.15"></a><span id="l16.15" class="difflineplus">+const kFolderCommitUploadPath = kFolderPath + &quot;file/commitUpload&quot;;</span>
<a href="#l16.16"></a><span id="l16.16" class="difflineplus">+const kDeletePath = kFolderPath + &quot;file&quot;;</span>
<a href="#l16.17"></a><span id="l16.17"> const kDefaultFileUploadPath = &quot;/uploads&quot;;</span>
<a href="#l16.18"></a><span id="l16.18" class="difflineminus">-const kCommitPath = &quot;/dpi/v1/item/commit&quot;;</span>
<a href="#l16.19"></a><span id="l16.19" class="difflineminus">-const kDeletePath = &quot;/dpi/v1/item&quot;;</span>
<a href="#l16.20"></a><span id="l16.20" class="difflineminus">-</span>
<a href="#l16.21"></a><span id="l16.21"> const kDownloadURLPrefix = &quot;http://www.example.com/downloads&quot;;</span>
<a href="#l16.22"></a><span id="l16.22"> </span>
<a href="#l16.23"></a><span id="l16.23"> const kAuthResult = {</span>
<a href="#l16.24"></a><span id="l16.24">   authToken: &quot;someAuthToken&quot;,</span>
<a href="#l16.25"></a><span id="l16.25">   errorStatus: null,</span>
<a href="#l16.26"></a><span id="l16.26"> }</span>
<a href="#l16.27"></a><span id="l16.27"> </span>
<a href="#l16.28"></a><span id="l16.28"> const kDefaultConfig = {</span>
<a href="#l16.29"></a><span id="l16.29" class="difflineat">@@ -74,25 +74,25 @@ const kDefaultUser = {</span>
<a href="#l16.30"></a><span id="l16.30">     currentUsage: 1045,</span>
<a href="#l16.31"></a><span id="l16.31">     storageQuota: 2147483648</span>
<a href="#l16.32"></a><span id="l16.32">   },</span>
<a href="#l16.33"></a><span id="l16.33">   status: null,</span>
<a href="#l16.34"></a><span id="l16.34">   errorStatus: null,</span>
<a href="#l16.35"></a><span id="l16.35"> };</span>
<a href="#l16.36"></a><span id="l16.36"> </span>
<a href="#l16.37"></a><span id="l16.37"> const kDefaultFilePrepare = {</span>
<a href="#l16.38"></a><span id="l16.38" class="difflineminus">-  itemId: &quot;&quot;,</span>
<a href="#l16.39"></a><span id="l16.39" class="difflineplus">+  fileId: &quot;&quot;,</span>
<a href="#l16.40"></a><span id="l16.40">   uploadUrl: [</span>
<a href="#l16.41"></a><span id="l16.41">   ],</span>
<a href="#l16.42"></a><span id="l16.42">   status: null,</span>
<a href="#l16.43"></a><span id="l16.43">   errorStatus: null,</span>
<a href="#l16.44"></a><span id="l16.44"> }</span>
<a href="#l16.45"></a><span id="l16.45"> </span>
<a href="#l16.46"></a><span id="l16.46"> const kDefaultCommitReturn = {</span>
<a href="#l16.47"></a><span id="l16.47" class="difflineminus">-  downloadUrl: &quot;&quot;,</span>
<a href="#l16.48"></a><span id="l16.48" class="difflineplus">+  clickableDownloadUrl: &quot;&quot;,</span>
<a href="#l16.49"></a><span id="l16.49">   errorStatus: null,</span>
<a href="#l16.50"></a><span id="l16.50"> }</span>
<a href="#l16.51"></a><span id="l16.51"> </span>
<a href="#l16.52"></a><span id="l16.52"> function installInto(module) {</span>
<a href="#l16.53"></a><span id="l16.53">   module.MockYouSendItServer = MockYouSendItServer;</span>
<a href="#l16.54"></a><span id="l16.54">   module.MockYouSendItAuthCounter = MockYouSendItAuthCounter;</span>
<a href="#l16.55"></a><span id="l16.55">   module.MockYouSendItDeleterStaleToken = MockYouSendItDeleterStaleToken;</span>
<a href="#l16.56"></a><span id="l16.56">   module.remember_ysi_credentials = remember_ysi_credentials;</span>
<a href="#l16.57"></a><span id="l16.57" class="difflineat">@@ -305,44 +305,76 @@ MockYouSendItItemIdRegistry.prototype = </span>
<a href="#l16.58"></a><span id="l16.58"> function MockYouSendItPrepareSimple(aYouSendIt) {</span>
<a href="#l16.59"></a><span id="l16.59">   this._server = null;</span>
<a href="#l16.60"></a><span id="l16.60">   this._ysi = aYouSendIt;</span>
<a href="#l16.61"></a><span id="l16.61"> }</span>
<a href="#l16.62"></a><span id="l16.62"> </span>
<a href="#l16.63"></a><span id="l16.63"> MockYouSendItPrepareSimple.prototype = {</span>
<a href="#l16.64"></a><span id="l16.64">   init: function(aServer) {</span>
<a href="#l16.65"></a><span id="l16.65">     this._server = aServer;</span>
<a href="#l16.66"></a><span id="l16.66" class="difflineminus">-    this._server.registerPathHandler(kFilePreparePath,</span>
<a href="#l16.67"></a><span id="l16.67" class="difflineplus">+    this._server.registerPathHandler(kFolderInitUploadPath,</span>
<a href="#l16.68"></a><span id="l16.68">                                      this._prepare.bind(this));</span>
<a href="#l16.69"></a><span id="l16.69" class="difflineplus">+    </span>
<a href="#l16.70"></a><span id="l16.70" class="difflineplus">+    this._foldersId = {</span>
<a href="#l16.71"></a><span id="l16.71" class="difflineplus">+      root: 0,</span>
<a href="#l16.72"></a><span id="l16.72" class="difflineplus">+      Apps: this._ysi.registry.createItemId(),</span>
<a href="#l16.73"></a><span id="l16.73" class="difflineplus">+      &quot;Mozilla Thunderbird&quot; : this._ysi.registry.createItemId()</span>
<a href="#l16.74"></a><span id="l16.74" class="difflineplus">+    };</span>
<a href="#l16.75"></a><span id="l16.75" class="difflineplus">+    </span>
<a href="#l16.76"></a><span id="l16.76" class="difflineplus">+    // Set up folders info</span>
<a href="#l16.77"></a><span id="l16.77" class="difflineplus">+    for (let i in this._foldersId) {</span>
<a href="#l16.78"></a><span id="l16.78" class="difflineplus">+      this._server.registerPathHandler(kFolderPath + this._foldersId[i],</span>
<a href="#l16.79"></a><span id="l16.79" class="difflineplus">+                                       this._getFolderInfo.bind(this));</span>
<a href="#l16.80"></a><span id="l16.80" class="difflineplus">+    }</span>
<a href="#l16.81"></a><span id="l16.81">   },</span>
<a href="#l16.82"></a><span id="l16.82"> </span>
<a href="#l16.83"></a><span id="l16.83">   shutdown: function() {</span>
<a href="#l16.84"></a><span id="l16.84" class="difflineminus">-    this._server.registerPathHandler(kFilePreparePath, null);</span>
<a href="#l16.85"></a><span id="l16.85" class="difflineplus">+    this._server.registerPathHandler(kFolderInitUploadPath, null);</span>
<a href="#l16.86"></a><span id="l16.86" class="difflineplus">+    for (let i in this._foldersId) {</span>
<a href="#l16.87"></a><span id="l16.87" class="difflineplus">+      this._server.registerPathHandler(kFolderPath + this._foldersId[i],</span>
<a href="#l16.88"></a><span id="l16.88" class="difflineplus">+                                       null);</span>
<a href="#l16.89"></a><span id="l16.89" class="difflineplus">+    }</span>
<a href="#l16.90"></a><span id="l16.90">     this._server = null;</span>
<a href="#l16.91"></a><span id="l16.91">   },</span>
<a href="#l16.92"></a><span id="l16.92"> </span>
<a href="#l16.93"></a><span id="l16.93" class="difflineplus">+  _getFolderInfo: function(aRequest, aResponse) {</span>
<a href="#l16.94"></a><span id="l16.94" class="difflineplus">+    let folderId = aRequest.path.substring(kFolderPath.length);</span>
<a href="#l16.95"></a><span id="l16.95" class="difflineplus">+    let nextFolder = folderId == (this._foldersId.root + &quot;&quot;)</span>
<a href="#l16.96"></a><span id="l16.96" class="difflineplus">+                        ? &quot;Apps&quot; </span>
<a href="#l16.97"></a><span id="l16.97" class="difflineplus">+                        : &quot;Mozilla Thunderbird&quot;;</span>
<a href="#l16.98"></a><span id="l16.98" class="difflineplus">+    let response = {</span>
<a href="#l16.99"></a><span id="l16.99" class="difflineplus">+      folders: {</span>
<a href="#l16.100"></a><span id="l16.100" class="difflineplus">+        folder: [{name: nextFolder, id: this._foldersId[nextFolder]}]</span>
<a href="#l16.101"></a><span id="l16.101" class="difflineplus">+      },</span>
<a href="#l16.102"></a><span id="l16.102" class="difflineplus">+      status: 200</span>
<a href="#l16.103"></a><span id="l16.103" class="difflineplus">+    }</span>
<a href="#l16.104"></a><span id="l16.104" class="difflineplus">+    aResponse.setStatusLine(null, 200, &quot;OK&quot;);</span>
<a href="#l16.105"></a><span id="l16.105" class="difflineplus">+    aResponse.setHeader(&quot;Content-Type&quot;, &quot;application/json&quot;);</span>
<a href="#l16.106"></a><span id="l16.106" class="difflineplus">+    aResponse.write(JSON.stringify(response));</span>
<a href="#l16.107"></a><span id="l16.107" class="difflineplus">+  },</span>
<a href="#l16.108"></a><span id="l16.108" class="difflineplus">+</span>
<a href="#l16.109"></a><span id="l16.109">   _prepare: function(aRequest, aResponse) {</span>
<a href="#l16.110"></a><span id="l16.110" class="difflineminus">-    let itemId = this._ysi.registry.createItemId();</span>
<a href="#l16.111"></a><span id="l16.111" class="difflineminus">-    let uploadPath = kDefaultFileUploadPath + &quot;/&quot; + itemId;</span>
<a href="#l16.112"></a><span id="l16.112" class="difflineplus">+    let fileId = this._ysi.registry.createItemId();</span>
<a href="#l16.113"></a><span id="l16.113" class="difflineplus">+    let uploadPath = kDefaultFileUploadPath + &quot;/&quot; + fileId;</span>
<a href="#l16.114"></a><span id="l16.114"> </span>
<a href="#l16.115"></a><span id="l16.115">     let injectedData = {</span>
<a href="#l16.116"></a><span id="l16.116" class="difflineminus">-      itemId: itemId,</span>
<a href="#l16.117"></a><span id="l16.117" class="difflineplus">+      fileId: fileId,</span>
<a href="#l16.118"></a><span id="l16.118">       uploadUrl: [</span>
<a href="#l16.119"></a><span id="l16.119">         kServerURL + uploadPath,</span>
<a href="#l16.120"></a><span id="l16.120">       ]</span>
<a href="#l16.121"></a><span id="l16.121">     }</span>
<a href="#l16.122"></a><span id="l16.122"> </span>
<a href="#l16.123"></a><span id="l16.123">     // Set up the path that will accept an uploaded file</span>
<a href="#l16.124"></a><span id="l16.124">     this._server.registerPathHandler(uploadPath,</span>
<a href="#l16.125"></a><span id="l16.125">                                      this._ysi.receiver.receiveUpload</span>
<a href="#l16.126"></a><span id="l16.126">                                                        .bind(this._ysi.receiver));</span>
<a href="#l16.127"></a><span id="l16.127"> </span>
<a href="#l16.128"></a><span id="l16.128">     // Set up the path that will accept file deletion</span>
<a href="#l16.129"></a><span id="l16.129"> </span>
<a href="#l16.130"></a><span id="l16.130" class="difflineminus">-    let deletePath = kDeletePath + &quot;/&quot; + itemId;</span>
<a href="#l16.131"></a><span id="l16.131" class="difflineplus">+    let deletePath = kDeletePath + &quot;/&quot; + fileId;</span>
<a href="#l16.132"></a><span id="l16.132"> </span>
<a href="#l16.133"></a><span id="l16.133">     this._server.registerPathHandler(deletePath,</span>
<a href="#l16.134"></a><span id="l16.134">                                      this._ysi.deleter.receiveDelete</span>
<a href="#l16.135"></a><span id="l16.135">                                                       .bind(this._ysi.deleter));</span>
<a href="#l16.136"></a><span id="l16.136"> </span>
<a href="#l16.137"></a><span id="l16.137">     let data = overrideDefault(kDefaultFilePrepare, injectedData);</span>
<a href="#l16.138"></a><span id="l16.138">     aResponse.setStatusLine(null, 200, &quot;OK&quot;);</span>
<a href="#l16.139"></a><span id="l16.139">     aResponse.setHeader(&quot;Content-Type&quot;, &quot;application/json&quot;);</span>
<a href="#l16.140"></a><span id="l16.140" class="difflineat">@@ -393,17 +425,16 @@ MockYouSendItReceiverSimple.prototype = </span>
<a href="#l16.141"></a><span id="l16.141">     Services.obs.notifyObservers(null, &quot;cloudfile:uploadFile&quot;,</span>
<a href="#l16.142"></a><span id="l16.142">                                  filename);</span>
<a href="#l16.143"></a><span id="l16.143"> </span>
<a href="#l16.144"></a><span id="l16.144">     this._expectedFiles.splice(filenameIndex, 1);</span>
<a href="#l16.145"></a><span id="l16.145"> </span>
<a href="#l16.146"></a><span id="l16.146">     let itemId = formData['bid'];</span>
<a href="#l16.147"></a><span id="l16.147">     // Tell the committer how to map the uuid to the filename</span>
<a href="#l16.148"></a><span id="l16.148">     this._ysi.registry.setMapping(itemId, filename);</span>
<a href="#l16.149"></a><span id="l16.149" class="difflineminus">-    this._ysi.committer.expectCommit(filename);</span>
<a href="#l16.150"></a><span id="l16.150"> </span>
<a href="#l16.151"></a><span id="l16.151">     // De-register this URL...</span>
<a href="#l16.152"></a><span id="l16.152">     this._server.registerPathHandler(aRequest.path, null);</span>
<a href="#l16.153"></a><span id="l16.153"> </span>
<a href="#l16.154"></a><span id="l16.154">     if (filename in this._mSeconds) {</span>
<a href="#l16.155"></a><span id="l16.155">       let timer = Cc[&quot;@mozilla.org/timer;1&quot;].createInstance(Ci.nsITimer);</span>
<a href="#l16.156"></a><span id="l16.156">       let timerEvent = {</span>
<a href="#l16.157"></a><span id="l16.157">         notify: function(aTimer) {</span>
<a href="#l16.158"></a><span id="l16.158" class="difflineat">@@ -436,66 +467,64 @@ function MockYouSendItCommitterSimple(aY</span>
<a href="#l16.159"></a><span id="l16.159">   this._ysi = aYouSendIt;</span>
<a href="#l16.160"></a><span id="l16.160">   this._itemIdMap = {};</span>
<a href="#l16.161"></a><span id="l16.161">   this._filenameURLMap = {};</span>
<a href="#l16.162"></a><span id="l16.162"> }</span>
<a href="#l16.163"></a><span id="l16.163"> </span>
<a href="#l16.164"></a><span id="l16.164"> MockYouSendItCommitterSimple.prototype = {</span>
<a href="#l16.165"></a><span id="l16.165">   init: function(aServer) {</span>
<a href="#l16.166"></a><span id="l16.166">     this._server = aServer;</span>
<a href="#l16.167"></a><span id="l16.167" class="difflineplus">+    // Since fileId is in query, we need to register path only once.</span>
<a href="#l16.168"></a><span id="l16.168" class="difflineplus">+    this._server.registerPathHandler(kFolderCommitUploadPath, </span>
<a href="#l16.169"></a><span id="l16.169" class="difflineplus">+                                     this.commit.bind(this));</span>
<a href="#l16.170"></a><span id="l16.170">   },</span>
<a href="#l16.171"></a><span id="l16.171"> </span>
<a href="#l16.172"></a><span id="l16.172">   shutdown: function() {</span>
<a href="#l16.173"></a><span id="l16.173" class="difflineplus">+    this._server.registerPathHandler(kFolderCommitUploadPath, </span>
<a href="#l16.174"></a><span id="l16.174" class="difflineplus">+                                     null);</span>
<a href="#l16.175"></a><span id="l16.175">     this._server = null;</span>
<a href="#l16.176"></a><span id="l16.176">     this._itemIdMap = {};</span>
<a href="#l16.177"></a><span id="l16.177">     this._filenameURLMap = {};</span>
<a href="#l16.178"></a><span id="l16.178">   },</span>
<a href="#l16.179"></a><span id="l16.179"> </span>
<a href="#l16.180"></a><span id="l16.180" class="difflineminus">-  expectCommit: function(aFilename) {</span>
<a href="#l16.181"></a><span id="l16.181" class="difflineminus">-    let itemId = this._ysi.registry.lookupItemId(aFilename);</span>
<a href="#l16.182"></a><span id="l16.182" class="difflineminus">-    let commitPath = kCommitPath + &quot;/&quot; + itemId;</span>
<a href="#l16.183"></a><span id="l16.183" class="difflineminus">-    this._server.registerPathHandler(commitPath, this.commit.bind(this));</span>
<a href="#l16.184"></a><span id="l16.184" class="difflineminus">-  },</span>
<a href="#l16.185"></a><span id="l16.185" class="difflineminus">-</span>
<a href="#l16.186"></a><span id="l16.186">   prepareDownloadURL: function(aFilename, aURL) {</span>
<a href="#l16.187"></a><span id="l16.187">     this._filenameURLMap[aFilename] = aURL;</span>
<a href="#l16.188"></a><span id="l16.188">   },</span>
<a href="#l16.189"></a><span id="l16.189"> </span>
<a href="#l16.190"></a><span id="l16.190">   commit: function(aRequest, aResponse) {</span>
<a href="#l16.191"></a><span id="l16.191" class="difflineminus">-    let itemId = aRequest.path.substring(kCommitPath.length + 1);</span>
<a href="#l16.192"></a><span id="l16.192" class="difflineplus">+    let fileId = aRequest.queryString;</span>
<a href="#l16.193"></a><span id="l16.193" class="difflineplus">+    fileId = fileId.substring(fileId.indexOf(&quot;fileId=&quot;) + 7);</span>
<a href="#l16.194"></a><span id="l16.194" class="difflineplus">+    fileId = fileId.substring(0, fileId.indexOf(&quot;&amp;&quot;));</span>
<a href="#l16.195"></a><span id="l16.195"> </span>
<a href="#l16.196"></a><span id="l16.196" class="difflineminus">-    if (!this._ysi.registry.hasItemId(itemId)) {</span>
<a href="#l16.197"></a><span id="l16.197" class="difflineplus">+    if (!this._ysi.registry.hasItemId(fileId)) {</span>
<a href="#l16.198"></a><span id="l16.198">       aResponse.setStatusLine(null, 500, &quot;Bad request&quot;);</span>
<a href="#l16.199"></a><span id="l16.199" class="difflineminus">-      aResponse.write(&quot;The item ID &quot; + itemId + &quot; did not map to an item we &quot;</span>
<a href="#l16.200"></a><span id="l16.200" class="difflineplus">+      aResponse.write(&quot;The item ID &quot; + fileId + &quot; did not map to an item we &quot;</span>
<a href="#l16.201"></a><span id="l16.201">                       + &quot;were prepared for committing&quot;);</span>
<a href="#l16.202"></a><span id="l16.202">       return;</span>
<a href="#l16.203"></a><span id="l16.203">     }</span>
<a href="#l16.204"></a><span id="l16.204"> </span>
<a href="#l16.205"></a><span id="l16.205" class="difflineminus">-    let filename = this._ysi.registry.lookupFilename(itemId);</span>
<a href="#l16.206"></a><span id="l16.206" class="difflineplus">+    let filename = this._ysi.registry.lookupFilename(fileId);</span>
<a href="#l16.207"></a><span id="l16.207">     let url;</span>
<a href="#l16.208"></a><span id="l16.208" class="difflineminus">-</span>
<a href="#l16.209"></a><span id="l16.209" class="difflineplus">+    </span>
<a href="#l16.210"></a><span id="l16.210">     if (filename in this._filenameURLMap)</span>
<a href="#l16.211"></a><span id="l16.211">       url = this._filenameURLMap[filename];</span>
<a href="#l16.212"></a><span id="l16.212">     else</span>
<a href="#l16.213"></a><span id="l16.213">       url = kDownloadURLPrefix + &quot;/&quot; + filename;</span>
<a href="#l16.214"></a><span id="l16.214" class="difflineminus">-</span>
<a href="#l16.215"></a><span id="l16.215" class="difflineplus">+    </span>
<a href="#l16.216"></a><span id="l16.216">     let injectedData = {</span>
<a href="#l16.217"></a><span id="l16.217" class="difflineminus">-      downloadUrl: url,</span>
<a href="#l16.218"></a><span id="l16.218" class="difflineplus">+      clickableDownloadUrl: url,</span>
<a href="#l16.219"></a><span id="l16.219">     }</span>
<a href="#l16.220"></a><span id="l16.220">     let data = overrideDefault(kDefaultCommitReturn, injectedData);</span>
<a href="#l16.221"></a><span id="l16.221" class="difflineminus">-</span>
<a href="#l16.222"></a><span id="l16.222" class="difflineplus">+    </span>
<a href="#l16.223"></a><span id="l16.223">     // Return the default share URL</span>
<a href="#l16.224"></a><span id="l16.224">     aResponse.setStatusLine(null, 200, &quot;OK&quot;);</span>
<a href="#l16.225"></a><span id="l16.225">     aResponse.setHeader(&quot;Content-Type&quot;, &quot;application/json&quot;);</span>
<a href="#l16.226"></a><span id="l16.226">     aResponse.write(JSON.stringify(data));</span>
<a href="#l16.227"></a><span id="l16.227" class="difflineminus">-</span>
<a href="#l16.228"></a><span id="l16.228" class="difflineplus">+    </span>
<a href="#l16.229"></a><span id="l16.229">     Services.obs.notifyObservers(null, &quot;cloudfile:getFileURL&quot;, filename);</span>
<a href="#l16.230"></a><span id="l16.230" class="difflineminus">-</span>
<a href="#l16.231"></a><span id="l16.231" class="difflineminus">-    // Unregister this commit URL</span>
<a href="#l16.232"></a><span id="l16.232" class="difflineminus">-    this._server.registerPathHandler(aRequest.path, null);</span>
<a href="#l16.233"></a><span id="l16.233">   },</span>
<a href="#l16.234"></a><span id="l16.234"> };</span>
<a href="#l16.235"></a><span id="l16.235"> </span>
<a href="#l16.236"></a><span id="l16.236"> function MockYouSendItDeleterSimple(aYouSendIt) {</span>
<a href="#l16.237"></a><span id="l16.237">   this._server = null;</span>
<a href="#l16.238"></a><span id="l16.238">   this._ysi = aYouSendIt;</span>
<a href="#l16.239"></a><span id="l16.239">   this._expectDelete = [];</span>
<a href="#l16.240"></a><span id="l16.240"> }</span>
<a href="#l16.241"></a><span id="l16.241" class="difflineat">@@ -509,40 +538,40 @@ MockYouSendItDeleterSimple.prototype = {</span>
<a href="#l16.242"></a><span id="l16.242">   receiveDelete: function(aRequest, aResponse) {</span>
<a href="#l16.243"></a><span id="l16.243">     if (aRequest.method != &quot;DELETE&quot;) {</span>
<a href="#l16.244"></a><span id="l16.244">       aResponse.setStatusLine(null, 500, &quot;Bad request&quot;);</span>
<a href="#l16.245"></a><span id="l16.245">       aResponse.write(&quot;Expected a DELETE for deleting.&quot;);</span>
<a href="#l16.246"></a><span id="l16.246">       return;</span>
<a href="#l16.247"></a><span id="l16.247">     }</span>
<a href="#l16.248"></a><span id="l16.248"> </span>
<a href="#l16.249"></a><span id="l16.249"> </span>
<a href="#l16.250"></a><span id="l16.250" class="difflineminus">-    let itemId = aRequest.path.substring(kDeletePath.length + 1);</span>
<a href="#l16.251"></a><span id="l16.251" class="difflineplus">+    let fileId = aRequest.path.substring(kDeletePath.length + 1);</span>
<a href="#l16.252"></a><span id="l16.252"> </span>
<a href="#l16.253"></a><span id="l16.253" class="difflineminus">-    if (!this._ysi.registry.hasItemId(itemId)) {</span>
<a href="#l16.254"></a><span id="l16.254" class="difflineplus">+    if (!this._ysi.registry.hasItemId(fileId)) {</span>
<a href="#l16.255"></a><span id="l16.255">       aResponse.setStatusLine(null, 500, &quot;Bad request&quot;);</span>
<a href="#l16.256"></a><span id="l16.256" class="difflineminus">-      aResponse.write(&quot;The item ID &quot; + itemId + &quot; did not map to an item &quot;</span>
<a href="#l16.257"></a><span id="l16.257" class="difflineplus">+      aResponse.write(&quot;The item ID &quot; + fileId + &quot; did not map to an item &quot;</span>
<a href="#l16.258"></a><span id="l16.258">                       + &quot;we were prepared for deleting&quot;);</span>
<a href="#l16.259"></a><span id="l16.259">       return;</span>
<a href="#l16.260"></a><span id="l16.260">     }</span>
<a href="#l16.261"></a><span id="l16.261"> </span>
<a href="#l16.262"></a><span id="l16.262" class="difflineminus">-    let filename = this._ysi.registry.lookupFilename(itemId);</span>
<a href="#l16.263"></a><span id="l16.263" class="difflineplus">+    let filename = this._ysi.registry.lookupFilename(fileId);</span>
<a href="#l16.264"></a><span id="l16.264">     let itemIndex = this._expectDelete.indexOf(filename);</span>
<a href="#l16.265"></a><span id="l16.265">     if (itemIndex == -1) {</span>
<a href="#l16.266"></a><span id="l16.266">       aResponse.setStatusLine(null, 500, &quot;Bad request&quot;);</span>
<a href="#l16.267"></a><span id="l16.267" class="difflineminus">-      aRespones.write(&quot;Not prepared to delete file with filename: &quot;</span>
<a href="#l16.268"></a><span id="l16.268" class="difflineplus">+      aResponse.write(&quot;Not prepared to delete file with filename: &quot;</span>
<a href="#l16.269"></a><span id="l16.269">                       + filename);</span>
<a href="#l16.270"></a><span id="l16.270">       return;</span>
<a href="#l16.271"></a><span id="l16.271">     }</span>
<a href="#l16.272"></a><span id="l16.272"> </span>
<a href="#l16.273"></a><span id="l16.273">     this._expectDelete.splice(itemIndex, 1);</span>
<a href="#l16.274"></a><span id="l16.274"> </span>
<a href="#l16.275"></a><span id="l16.275" class="difflineminus">-    let response = '&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot; standalone=&quot;yes&quot;?&gt;&lt;delete&gt;&lt;status&gt;OK&lt;/status&gt;&lt;/delete&gt;';</span>
<a href="#l16.276"></a><span id="l16.276" class="difflineplus">+    let response = {status: 200};</span>
<a href="#l16.277"></a><span id="l16.277">     aResponse.setStatusLine(null, 200, &quot;OK&quot;);</span>
<a href="#l16.278"></a><span id="l16.278" class="difflineminus">-    aResponse.setHeader(&quot;Content-Type&quot;, &quot;application/xml&quot;);</span>
<a href="#l16.279"></a><span id="l16.279" class="difflineminus">-    aResponse.write(response);</span>
<a href="#l16.280"></a><span id="l16.280" class="difflineplus">+    aResponse.setHeader(&quot;Content-Type&quot;, &quot;application/json&quot;);</span>
<a href="#l16.281"></a><span id="l16.281" class="difflineplus">+    aResponse.write(JSON.stringify(response));</span>
<a href="#l16.282"></a><span id="l16.282"> </span>
<a href="#l16.283"></a><span id="l16.283">     Services.obs.notifyObservers(null, &quot;cloudfile:deleteFile&quot;, filename);</span>
<a href="#l16.284"></a><span id="l16.284">     this._server.registerPathHandler(aRequest.path, null);</span>
<a href="#l16.285"></a><span id="l16.285">   },</span>
<a href="#l16.286"></a><span id="l16.286">   prepareForDelete: function(aFilename) {</span>
<a href="#l16.287"></a><span id="l16.287">     this._expectDelete.push(aFilename);</span>
<a href="#l16.288"></a><span id="l16.288">   },</span>
<a href="#l16.289"></a><span id="l16.289"> };</span>
<a href="#l16.290"></a><span id="l16.290" class="difflineat">@@ -555,21 +584,21 @@ function MockYouSendItDeleterStaleToken(</span>
<a href="#l16.291"></a><span id="l16.291"> MockYouSendItDeleterStaleToken.prototype = {</span>
<a href="#l16.292"></a><span id="l16.292">   init: function(aServer) {</span>
<a href="#l16.293"></a><span id="l16.293">     this._server = aServer;</span>
<a href="#l16.294"></a><span id="l16.294">   },</span>
<a href="#l16.295"></a><span id="l16.295"> </span>
<a href="#l16.296"></a><span id="l16.296">   shutdown: function() {},</span>
<a href="#l16.297"></a><span id="l16.297"> </span>
<a href="#l16.298"></a><span id="l16.298">   receiveDelete: function(aRequest, aResponse) {</span>
<a href="#l16.299"></a><span id="l16.299" class="difflineminus">-    let data = '&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot; standalone=&quot;yes&quot;?&gt;&lt;delete&gt;&lt;errorStatus&gt;&lt;code&gt;401&lt;/code&gt;&lt;message&gt;Invalid auth token&lt;/message&gt;&lt;/errorStatus&gt;&lt;/delete&gt;';</span>
<a href="#l16.300"></a><span id="l16.300" class="difflineplus">+    let data = { errorStatus: { code: 401, message: &quot;Invalid auth token&quot; } };</span>
<a href="#l16.301"></a><span id="l16.301"> </span>
<a href="#l16.302"></a><span id="l16.302" class="difflineminus">-    aResponse.setStatusLine(null, 200, &quot;OK&quot;);</span>
<a href="#l16.303"></a><span id="l16.303" class="difflineplus">+    aResponse.setStatusLine(null, 401, &quot;Invalid auth token&quot;);</span>
<a href="#l16.304"></a><span id="l16.304">     aResponse.setHeader(&quot;Content-Type&quot;, &quot;application/json&quot;);</span>
<a href="#l16.305"></a><span id="l16.305" class="difflineminus">-    aResponse.write(data);</span>
<a href="#l16.306"></a><span id="l16.306" class="difflineplus">+    aResponse.write(JSON.stringify(data));</span>
<a href="#l16.307"></a><span id="l16.307">   },</span>
<a href="#l16.308"></a><span id="l16.308"> </span>
<a href="#l16.309"></a><span id="l16.309">   prepareForDelete: function(aFilename) {},</span>
<a href="#l16.310"></a><span id="l16.310"> };</span>
<a href="#l16.311"></a><span id="l16.311"> </span>
<a href="#l16.312"></a><span id="l16.312"> function MockYouSendItAuthCounter(aYouSendIt) {</span>
<a href="#l16.313"></a><span id="l16.313">   this._server = null;</span>
<a href="#l16.314"></a><span id="l16.314">   this._ysi = aYouSendIt;</span>
<a href="#l16.315"></a><span id="l16.315" class="difflineat">@@ -686,21 +715,21 @@ function parseHeaders(data, start)</span>
<a href="#l16.316"></a><span id="l16.316"> }</span>
<a href="#l16.317"></a><span id="l16.317"> </span>
<a href="#l16.318"></a><span id="l16.318"> function parseMultipartForm(request)</span>
<a href="#l16.319"></a><span id="l16.319"> {</span>
<a href="#l16.320"></a><span id="l16.320">   let boundary = null;</span>
<a href="#l16.321"></a><span id="l16.321">   // See if this is a multipart/form-data request, and if so, find the</span>
<a href="#l16.322"></a><span id="l16.322">   // boundary string</span>
<a href="#l16.323"></a><span id="l16.323">   if (request.hasHeader(&quot;Content-Type&quot;)) {</span>
<a href="#l16.324"></a><span id="l16.324" class="difflineminus">-    var contenttype = request.getHeader(&quot;Content-Type&quot;);</span>
<a href="#l16.325"></a><span id="l16.325" class="difflineminus">-    var bits = contenttype.split(&quot;;&quot;);</span>
<a href="#l16.326"></a><span id="l16.326" class="difflineplus">+    let contenttype = request.getHeader(&quot;Content-Type&quot;);</span>
<a href="#l16.327"></a><span id="l16.327" class="difflineplus">+    let bits = contenttype.split(&quot;;&quot;);</span>
<a href="#l16.328"></a><span id="l16.328">     if (bits[0] == &quot;multipart/form-data&quot;) {</span>
<a href="#l16.329"></a><span id="l16.329" class="difflineminus">-      for (var i = 1; i &lt; bits.length; i++) {</span>
<a href="#l16.330"></a><span id="l16.330" class="difflineminus">-        var b = bits[i].trimLeft();</span>
<a href="#l16.331"></a><span id="l16.331" class="difflineplus">+      for (let i = 1; i &lt; bits.length; i++) {</span>
<a href="#l16.332"></a><span id="l16.332" class="difflineplus">+        let b = bits[i].trimLeft();</span>
<a href="#l16.333"></a><span id="l16.333">         if (b.indexOf(&quot;boundary=&quot;) == 0) {</span>
<a href="#l16.334"></a><span id="l16.334">           // grab everything after boundary=</span>
<a href="#l16.335"></a><span id="l16.335">           boundary = &quot;--&quot; + b.substring(9);</span>
<a href="#l16.336"></a><span id="l16.336">           break;</span>
<a href="#l16.337"></a><span id="l16.337">         }</span>
<a href="#l16.338"></a><span id="l16.338">       }</span>
<a href="#l16.339"></a><span id="l16.339">     }</span>
<a href="#l16.340"></a><span id="l16.340">   }</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l17.1"></a><span id="l17.1" class="difflineminus">--- a/mail/themes/gnomestripe/jar.mn</span>
<a href="#l17.2"></a><span id="l17.2" class="difflineplus">+++ b/mail/themes/gnomestripe/jar.mn</span>
<a href="#l17.3"></a><span id="l17.3" class="difflineat">@@ -85,16 +85,19 @@ classic.jar:</span>
<a href="#l17.4"></a><span id="l17.4">   skin/classic/messenger/addressbook/icons/contact-generic-tiny.png        (mail/addrbook/contact-generic-tiny.png)</span>
<a href="#l17.5"></a><span id="l17.5">   skin/classic/messenger/addressbook/icons/addressbook-toolbar.png         (mail/addrbook/addressbook-toolbar.png)</span>
<a href="#l17.6"></a><span id="l17.6">   skin/classic/messenger/addressbook/icons/addressbook-toolbar-small.png   (mail/addrbook/addressbook-toolbar-small.png)</span>
<a href="#l17.7"></a><span id="l17.7">   skin/classic/messenger/addressbook/icons/abcard-large.png   (mail/addrbook/abcard-large.png)</span>
<a href="#l17.8"></a><span id="l17.8">   skin/classic/messenger/addressbook/icons/remote-addrbook.png (mail/addrbook/remote-addrbook.png)</span>
<a href="#l17.9"></a><span id="l17.9">   skin/classic/messenger/addressbook/icons/remote-addrbook-error.png      (mail/addrbook/remote-addrbook-error.png)</span>
<a href="#l17.10"></a><span id="l17.10">   skin/classic/messenger/addressbook/icons/secure-remote-addrbook.png     (mail/addrbook/secure-remote-addrbook.png)</span>
<a href="#l17.11"></a><span id="l17.11">   skin/classic/messenger/cloudfile/addAccountDialog.css       (mail/cloudfile/addAccountDialog.css)</span>
<a href="#l17.12"></a><span id="l17.12" class="difflineplus">+  skin/classic/messenger/cloudfile/YouSendIt/settings.css               (mail/cloudfile/YouSendIt/settings.css)</span>
<a href="#l17.13"></a><span id="l17.13" class="difflineplus">+  skin/classic/messenger/cloudfile/YouSendIt/fileExceedsLimit.css       (mail/cloudfile/YouSendIt/fileExceedsLimit.css)</span>
<a href="#l17.14"></a><span id="l17.14" class="difflineplus">+  skin/classic/messenger/cloudfile/YouSendIt/check.png                  (mail/cloudfile/YouSendIt/check.png)</span>
<a href="#l17.15"></a><span id="l17.15">   skin/classic/messenger/messengercompose/messengercompose.css (mail/compose/messengercompose.css)</span>
<a href="#l17.16"></a><span id="l17.16">   skin/classic/messenger/messengercompose/editorOverlay.css    (mail/compose/editorOverlay.css)</span>
<a href="#l17.17"></a><span id="l17.17">   skin/classic/messenger/messengercompose/compose-toolbar.png  (mail/compose/compose-toolbar.png)</span>
<a href="#l17.18"></a><span id="l17.18">   skin/classic/messenger/messengercompose/compose-toolbar-small.png   (mail/compose/compose-toolbar-small.png)</span>
<a href="#l17.19"></a><span id="l17.19">   skin/classic/messenger/messengercompose/format-buttons.png  (mail/compose/format-buttons.png)</span>
<a href="#l17.20"></a><span id="l17.20"> % skin messenger-newsblog classic/1.0 %skin/classic/messenger-newsblog/</span>
<a href="#l17.21"></a><span id="l17.21">   skin/classic/messenger-newsblog/feed-subscriptions.css      (mail/newsblog/feed-subscriptions.css)</span>
<a href="#l17.22"></a><span id="l17.22">   skin/classic/messenger-newsblog/icons/rss-feed.png          (mail/newsblog/rss-feed.png)</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l18.1"></a><span id="l18.1">new file mode 100644</span>
<a href="#l18.2"></a><span id="l18.2" class="difflineminus">--- /dev/null</span>
<a href="#l18.3"></a><span id="l18.3" class="difflineplus">+++ b/mail/themes/gnomestripe/mail/cloudfile/YouSendIt/fileExceedsLimit.css</span>
<a href="#l18.4"></a><span id="l18.4" class="difflineat">@@ -0,0 +1,36 @@</span>
<a href="#l18.5"></a><span id="l18.5" class="difflineplus">+/* This Source Code Form is subject to the terms of the Mozilla Public</span>
<a href="#l18.6"></a><span id="l18.6" class="difflineplus">+ * License, v. 2.0. If a copy of the MPL was not distributed with this file,</span>
<a href="#l18.7"></a><span id="l18.7" class="difflineplus">+ * You can obtain one at http://mozilla.org/MPL/2.0/. */</span>
<a href="#l18.8"></a><span id="l18.8" class="difflineplus">+</span>
<a href="#l18.9"></a><span id="l18.9" class="difflineplus">+html, body {</span>
<a href="#l18.10"></a><span id="l18.10" class="difflineplus">+  font: message-box;</span>
<a href="#l18.11"></a><span id="l18.11" class="difflineplus">+  margin: 0;</span>
<a href="#l18.12"></a><span id="l18.12" class="difflineplus">+}</span>
<a href="#l18.13"></a><span id="l18.13" class="difflineplus">+</span>
<a href="#l18.14"></a><span id="l18.14" class="difflineplus">+#fileExceedsLimit {</span>
<a href="#l18.15"></a><span id="l18.15" class="difflineplus">+  padding-left: 15px;</span>
<a href="#l18.16"></a><span id="l18.16" class="difflineplus">+  padding-right: 13px;</span>
<a href="#l18.17"></a><span id="l18.17" class="difflineplus">+  padding-top: 15px;</span>
<a href="#l18.18"></a><span id="l18.18" class="difflineplus">+  padding-bottom: 15px;</span>
<a href="#l18.19"></a><span id="l18.19" class="difflineplus">+}</span>
<a href="#l18.20"></a><span id="l18.20" class="difflineplus">+</span>
<a href="#l18.21"></a><span id="l18.21" class="difflineplus">+#proIncludes {</span>
<a href="#l18.22"></a><span id="l18.22" class="difflineplus">+  font-weight: bold;</span>
<a href="#l18.23"></a><span id="l18.23" class="difflineplus">+  margin-bottom: 10px;</span>
<a href="#l18.24"></a><span id="l18.24" class="difflineplus">+}</span>
<a href="#l18.25"></a><span id="l18.25" class="difflineplus">+</span>
<a href="#l18.26"></a><span id="l18.26" class="difflineplus">+#title {</span>
<a href="#l18.27"></a><span id="l18.27" class="difflineplus">+  font-size: 20pt;</span>
<a href="#l18.28"></a><span id="l18.28" class="difflineplus">+  color: rgb(141,198,63);</span>
<a href="#l18.29"></a><span id="l18.29" class="difflineplus">+}</span>
<a href="#l18.30"></a><span id="l18.30" class="difflineplus">+</span>
<a href="#l18.31"></a><span id="l18.31" class="difflineplus">+#title2 {</span>
<a href="#l18.32"></a><span id="l18.32" class="difflineplus">+  font-size: 20pt;</span>
<a href="#l18.33"></a><span id="l18.33" class="difflineplus">+  color: rgb(141,198,63);</span>
<a href="#l18.34"></a><span id="l18.34" class="difflineplus">+  margin-top: -10px;</span>
<a href="#l18.35"></a><span id="l18.35" class="difflineplus">+  margin-bottom: 10px;</span>
<a href="#l18.36"></a><span id="l18.36" class="difflineplus">+}</span>
<a href="#l18.37"></a><span id="l18.37" class="difflineplus">+</span>
<a href="#l18.38"></a><span id="l18.38" class="difflineplus">+description {</span>
<a href="#l18.39"></a><span id="l18.39" class="difflineplus">+  font-family: &quot;Lucida Sans Unicode&quot;, &quot;Lucida Grande&quot;, sans-serif;</span>
<a href="#l18.40"></a><span id="l18.40" class="difflineplus">+}</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l19.1"></a><span id="l19.1">new file mode 100644</span>
<a href="#l19.2"></a><span id="l19.2" class="difflineminus">--- /dev/null</span>
<a href="#l19.3"></a><span id="l19.3" class="difflineplus">+++ b/mail/themes/gnomestripe/mail/cloudfile/YouSendIt/settings.css</span>
<a href="#l19.4"></a><span id="l19.4" class="difflineat">@@ -0,0 +1,9 @@</span>
<a href="#l19.5"></a><span id="l19.5" class="difflineplus">+/* This Source Code Form is subject to the terms of the Mozilla Public</span>
<a href="#l19.6"></a><span id="l19.6" class="difflineplus">+ * License, v. 2.0. If a copy of the MPL was not distributed with this file,</span>
<a href="#l19.7"></a><span id="l19.7" class="difflineplus">+ * You can obtain one at http://mozilla.org/MPL/2.0/. */</span>
<a href="#l19.8"></a><span id="l19.8" class="difflineplus">+</span>
<a href="#l19.9"></a><span id="l19.9" class="difflineplus">+#username.hint {</span>
<a href="#l19.10"></a><span id="l19.10" class="difflineplus">+  color: gray;</span>
<a href="#l19.11"></a><span id="l19.11" class="difflineplus">+  font-style:italic;</span>
<a href="#l19.12"></a><span id="l19.12" class="difflineplus">+  font-size:95%</span>
<a href="#l19.13"></a><span id="l19.13" class="difflineplus">+}</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l20.1"></a><span id="l20.1" class="difflineminus">--- a/mail/themes/pinstripe/jar.mn</span>
<a href="#l20.2"></a><span id="l20.2" class="difflineplus">+++ b/mail/themes/pinstripe/jar.mn</span>
<a href="#l20.3"></a><span id="l20.3" class="difflineat">@@ -78,16 +78,19 @@ classic.jar:</span>
<a href="#l20.4"></a><span id="l20.4">   skin/classic/messenger/addressbook/icons/addressbook-toolbar.png         (mail/addrbook/addressbook-toolbar.png)</span>
<a href="#l20.5"></a><span id="l20.5">   skin/classic/messenger/addressbook/icons/abcard.png            (mail/addrbook/abcard.png)</span>
<a href="#l20.6"></a><span id="l20.6">   skin/classic/messenger/addressbook/icons/ablist.png            (mail/addrbook/ablist.png)</span>
<a href="#l20.7"></a><span id="l20.7">   skin/classic/messenger/addressbook/icons/addrbook.png          (mail/addrbook/addrbook.png)</span>
<a href="#l20.8"></a><span id="l20.8">   skin/classic/messenger/addressbook/icons/remote-addrbook-error.png      (mail/addrbook/remote-addrbook-error.png)</span>
<a href="#l20.9"></a><span id="l20.9">   skin/classic/messenger/addressbook/icons/remote-addrbook.png   (mail/addrbook/remote-addrbook.png)</span>
<a href="#l20.10"></a><span id="l20.10">   skin/classic/messenger/addressbook/icons/secure-remote-addrbook.png     (mail/addrbook/secure-remote-addrbook.png)</span>
<a href="#l20.11"></a><span id="l20.11">   skin/classic/messenger/cloudfile/addAccountDialog.css          (mail/cloudfile/addAccountDialog.css)</span>
<a href="#l20.12"></a><span id="l20.12" class="difflineplus">+  skin/classic/messenger/cloudfile/YouSendIt/settings.css               (mail/cloudfile/YouSendIt/settings.css)</span>
<a href="#l20.13"></a><span id="l20.13" class="difflineplus">+  skin/classic/messenger/cloudfile/YouSendIt/fileExceedsLimit.css       (mail/cloudfile/YouSendIt/fileExceedsLimit.css)</span>
<a href="#l20.14"></a><span id="l20.14" class="difflineplus">+  skin/classic/messenger/cloudfile/YouSendIt/check.png                  (mail/cloudfile/YouSendIt/check.png)</span>
<a href="#l20.15"></a><span id="l20.15">   skin/classic/messenger/messengercompose/messengercompose.css    (mail/compose/messengercompose.css)</span>
<a href="#l20.16"></a><span id="l20.16">   skin/classic/messenger/messengercompose/attachmentnotification.png     (mail/compose/attachmentnotification.png)</span>
<a href="#l20.17"></a><span id="l20.17">   skin/classic/messenger/messengercompose/compose-toolbar.png     (mail/compose/compose-toolbar.png)</span>
<a href="#l20.18"></a><span id="l20.18">   skin/classic/messenger/messengercompose/emoticon_cool.png       (mail/compose/emoticon_cool.png)</span>
<a href="#l20.19"></a><span id="l20.19">   skin/classic/messenger/messengercompose/emoticon_cry.png        (mail/compose/emoticon_cry.png)</span>
<a href="#l20.20"></a><span id="l20.20">   skin/classic/messenger/messengercompose/emoticon_embarrassed.png         (mail/compose/emoticon_embarrassed.png)</span>
<a href="#l20.21"></a><span id="l20.21">   skin/classic/messenger/messengercompose/emoticon_foot_in_mouth.png       (mail/compose/emoticon_foot_in_mouth.png)</span>
<a href="#l20.22"></a><span id="l20.22">   skin/classic/messenger/messengercompose/emoticon_frown.png      (mail/compose/emoticon_frown.png)</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l21.1"></a><span id="l21.1">new file mode 100644</span>
<a href="#l21.2"></a><span id="l21.2" class="difflineminus">--- /dev/null</span>
<a href="#l21.3"></a><span id="l21.3" class="difflineplus">+++ b/mail/themes/pinstripe/mail/cloudfile/YouSendIt/fileExceedsLimit.css</span>
<a href="#l21.4"></a><span id="l21.4" class="difflineat">@@ -0,0 +1,36 @@</span>
<a href="#l21.5"></a><span id="l21.5" class="difflineplus">+/* This Source Code Form is subject to the terms of the Mozilla Public</span>
<a href="#l21.6"></a><span id="l21.6" class="difflineplus">+ * License, v. 2.0. If a copy of the MPL was not distributed with this file,</span>
<a href="#l21.7"></a><span id="l21.7" class="difflineplus">+ * You can obtain one at http://mozilla.org/MPL/2.0/. */</span>
<a href="#l21.8"></a><span id="l21.8" class="difflineplus">+</span>
<a href="#l21.9"></a><span id="l21.9" class="difflineplus">+html, body {</span>
<a href="#l21.10"></a><span id="l21.10" class="difflineplus">+  font: message-box;</span>
<a href="#l21.11"></a><span id="l21.11" class="difflineplus">+  margin: 0;</span>
<a href="#l21.12"></a><span id="l21.12" class="difflineplus">+}</span>
<a href="#l21.13"></a><span id="l21.13" class="difflineplus">+</span>
<a href="#l21.14"></a><span id="l21.14" class="difflineplus">+#fileExceedsLimit {</span>
<a href="#l21.15"></a><span id="l21.15" class="difflineplus">+  padding-left: 15px;</span>
<a href="#l21.16"></a><span id="l21.16" class="difflineplus">+  padding-right: 13px;</span>
<a href="#l21.17"></a><span id="l21.17" class="difflineplus">+  padding-top: 15px;</span>
<a href="#l21.18"></a><span id="l21.18" class="difflineplus">+  padding-bottom: 15px;</span>
<a href="#l21.19"></a><span id="l21.19" class="difflineplus">+}</span>
<a href="#l21.20"></a><span id="l21.20" class="difflineplus">+</span>
<a href="#l21.21"></a><span id="l21.21" class="difflineplus">+#proIncludes {</span>
<a href="#l21.22"></a><span id="l21.22" class="difflineplus">+  font-weight: bold;</span>
<a href="#l21.23"></a><span id="l21.23" class="difflineplus">+  margin-bottom: 10px;</span>
<a href="#l21.24"></a><span id="l21.24" class="difflineplus">+}</span>
<a href="#l21.25"></a><span id="l21.25" class="difflineplus">+</span>
<a href="#l21.26"></a><span id="l21.26" class="difflineplus">+#title {</span>
<a href="#l21.27"></a><span id="l21.27" class="difflineplus">+  font-size: 20pt;</span>
<a href="#l21.28"></a><span id="l21.28" class="difflineplus">+  color: rgb(141,198,63);</span>
<a href="#l21.29"></a><span id="l21.29" class="difflineplus">+}</span>
<a href="#l21.30"></a><span id="l21.30" class="difflineplus">+</span>
<a href="#l21.31"></a><span id="l21.31" class="difflineplus">+#title2 {</span>
<a href="#l21.32"></a><span id="l21.32" class="difflineplus">+  font-size: 20pt;</span>
<a href="#l21.33"></a><span id="l21.33" class="difflineplus">+  color: rgb(141,198,63);</span>
<a href="#l21.34"></a><span id="l21.34" class="difflineplus">+  margin-top: -10px;</span>
<a href="#l21.35"></a><span id="l21.35" class="difflineplus">+  margin-bottom: 10px;</span>
<a href="#l21.36"></a><span id="l21.36" class="difflineplus">+}</span>
<a href="#l21.37"></a><span id="l21.37" class="difflineplus">+</span>
<a href="#l21.38"></a><span id="l21.38" class="difflineplus">+description {</span>
<a href="#l21.39"></a><span id="l21.39" class="difflineplus">+  font-family: &quot;Lucida Sans Unicode&quot;, &quot;Lucida Grande&quot;, sans-serif;</span>
<a href="#l21.40"></a><span id="l21.40" class="difflineplus">+}</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l22.1"></a><span id="l22.1">new file mode 100644</span>
<a href="#l22.2"></a><span id="l22.2" class="difflineminus">--- /dev/null</span>
<a href="#l22.3"></a><span id="l22.3" class="difflineplus">+++ b/mail/themes/pinstripe/mail/cloudfile/YouSendIt/settings.css</span>
<a href="#l22.4"></a><span id="l22.4" class="difflineat">@@ -0,0 +1,9 @@</span>
<a href="#l22.5"></a><span id="l22.5" class="difflineplus">+/* This Source Code Form is subject to the terms of the Mozilla Public</span>
<a href="#l22.6"></a><span id="l22.6" class="difflineplus">+ * License, v. 2.0. If a copy of the MPL was not distributed with this file,</span>
<a href="#l22.7"></a><span id="l22.7" class="difflineplus">+ * You can obtain one at http://mozilla.org/MPL/2.0/. */</span>
<a href="#l22.8"></a><span id="l22.8" class="difflineplus">+</span>
<a href="#l22.9"></a><span id="l22.9" class="difflineplus">+#username.hint {</span>
<a href="#l22.10"></a><span id="l22.10" class="difflineplus">+  color: gray;</span>
<a href="#l22.11"></a><span id="l22.11" class="difflineplus">+  font-style:italic;</span>
<a href="#l22.12"></a><span id="l22.12" class="difflineplus">+  font-size:95%</span>
<a href="#l22.13"></a><span id="l22.13" class="difflineplus">+}</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l23.1"></a><span id="l23.1" class="difflineminus">--- a/mail/themes/qute/jar.mn</span>
<a href="#l23.2"></a><span id="l23.2" class="difflineplus">+++ b/mail/themes/qute/jar.mn</span>
<a href="#l23.3"></a><span id="l23.3" class="difflineat">@@ -119,16 +119,19 @@ classic.jar:</span>
<a href="#l23.4"></a><span id="l23.4">   skin/classic/messenger/addressbook/icons/contact-generic-tiny.png        (mail/addrbook/contact-generic-tiny.png)</span>
<a href="#l23.5"></a><span id="l23.5">   skin/classic/messenger/addressbook/icons/addressbook-toolbar.png         (mail/addrbook/addressbook-toolbar.png)</span>
<a href="#l23.6"></a><span id="l23.6">   skin/classic/messenger/addressbook/icons/addressbook-toolbar-small.png   (mail/addrbook/addressbook-toolbar-small.png)</span>
<a href="#l23.7"></a><span id="l23.7">   skin/classic/messenger/addressbook/icons/abcard-large.png   (mail/addrbook/abcard-large.png)</span>
<a href="#l23.8"></a><span id="l23.8">   skin/classic/messenger/addressbook/icons/remote-addrbook.png (mail/addrbook/remote-addrbook.png)</span>
<a href="#l23.9"></a><span id="l23.9">   skin/classic/messenger/addressbook/icons/remote-addrbook-error.png      (mail/addrbook/remote-addrbook-error.png)</span>
<a href="#l23.10"></a><span id="l23.10">   skin/classic/messenger/addressbook/icons/secure-remote-addrbook.png     (mail/addrbook/secure-remote-addrbook.png)</span>
<a href="#l23.11"></a><span id="l23.11">   skin/classic/messenger/cloudfile/addAccountDialog.css       (mail/cloudfile/addAccountDialog.css)</span>
<a href="#l23.12"></a><span id="l23.12" class="difflineplus">+  skin/classic/messenger/cloudfile/YouSendIt/settings.css               (mail/cloudfile/YouSendIt/settings.css)</span>
<a href="#l23.13"></a><span id="l23.13" class="difflineplus">+  skin/classic/messenger/cloudfile/YouSendIt/fileExceedsLimit.css       (mail/cloudfile/YouSendIt/fileExceedsLimit.css)</span>
<a href="#l23.14"></a><span id="l23.14" class="difflineplus">+  skin/classic/messenger/cloudfile/YouSendIt/check.png                  (mail/cloudfile/YouSendIt/check.png)</span>
<a href="#l23.15"></a><span id="l23.15">   skin/classic/messenger/messengercompose/messengercompose.css (mail/compose/messengercompose.css)</span>
<a href="#l23.16"></a><span id="l23.16">   skin/classic/messenger/messengercompose/compose-toolbar.png  (mail/compose/compose-toolbar.png)</span>
<a href="#l23.17"></a><span id="l23.17">   skin/classic/messenger/messengercompose/compose-toolbar-small.png   (mail/compose/compose-toolbar-small.png)</span>
<a href="#l23.18"></a><span id="l23.18">   skin/classic/messenger/messengercompose/format-buttons.png  (mail/compose/format-buttons.png)</span>
<a href="#l23.19"></a><span id="l23.19">   skin/classic/messenger/preferences/alwaysAsk.png            (mail/preferences/alwaysAsk.png)</span>
<a href="#l23.20"></a><span id="l23.20">   skin/classic/messenger/preferences/application.png          (mail/preferences/application.png)</span>
<a href="#l23.21"></a><span id="l23.21">   skin/classic/messenger/preferences/preferences.css          (mail/preferences/preferences.css)</span>
<a href="#l23.22"></a><span id="l23.22">   skin/classic/messenger/preferences/general.png              (mail/preferences/general.png)</span>
<a href="#l23.23"></a><span id="l23.23" class="difflineat">@@ -365,16 +368,19 @@ classic.jar:</span>
<a href="#l23.24"></a><span id="l23.24">   skin/classic/aero/messenger/addressbook/icons/contact-generic.png             (mail/addrbook/contact-generic.png)</span>
<a href="#l23.25"></a><span id="l23.25">   skin/classic/aero/messenger/addressbook/icons/contact-generic-tiny.png        (mail/addrbook/contact-generic-tiny.png)</span>
<a href="#l23.26"></a><span id="l23.26">   skin/classic/aero/messenger/addressbook/icons/addressbook-toolbar.png         (mail/addrbook/addressbook-toolbar-aero.png)</span>
<a href="#l23.27"></a><span id="l23.27">   skin/classic/aero/messenger/addressbook/icons/abcard-large.png   (mail/addrbook/abcard-large.png)</span>
<a href="#l23.28"></a><span id="l23.28">   skin/classic/aero/messenger/addressbook/icons/remote-addrbook.png (mail/addrbook/remote-addrbook-aero.png)</span>
<a href="#l23.29"></a><span id="l23.29">   skin/classic/aero/messenger/addressbook/icons/remote-addrbook-error.png      (mail/addrbook/remote-addrbook-error.png)</span>
<a href="#l23.30"></a><span id="l23.30">   skin/classic/aero/messenger/addressbook/icons/secure-remote-addrbook.png     (mail/addrbook/secure-remote-addrbook-aero.png)</span>
<a href="#l23.31"></a><span id="l23.31"> * skin/classic/aero/messenger/cloudfile/addAccountDialog.css       (mail/cloudfile/addAccountDialog-aero.css)</span>
<a href="#l23.32"></a><span id="l23.32" class="difflineplus">+  skin/classic/aero/messenger/cloudfile/YouSendIt/settings.css               (mail/cloudfile/YouSendIt/settings.css)</span>
<a href="#l23.33"></a><span id="l23.33" class="difflineplus">+  skin/classic/aero/messenger/cloudfile/YouSendIt/fileExceedsLimit.css       (mail/cloudfile/YouSendIt/fileExceedsLimit.css)</span>
<a href="#l23.34"></a><span id="l23.34" class="difflineplus">+  skin/classic/aero/messenger/cloudfile/YouSendIt/check.png                  (mail/cloudfile/YouSendIt/check.png)</span>
<a href="#l23.35"></a><span id="l23.35">   skin/classic/aero/messenger/messengercompose/messengercompose.css (mail/compose/messengercompose-aero.css)</span>
<a href="#l23.36"></a><span id="l23.36">   skin/classic/aero/messenger/messengercompose/compose-toolbar.png  (mail/compose/compose-toolbar-aero.png)</span>
<a href="#l23.37"></a><span id="l23.37">   skin/classic/aero/messenger/messengercompose/format-buttons.png  (mail/compose/format-buttons-aero.png)</span>
<a href="#l23.38"></a><span id="l23.38">   skin/classic/aero/messenger/preferences/alwaysAsk.png            (mail/preferences/alwaysAsk.png)</span>
<a href="#l23.39"></a><span id="l23.39">   skin/classic/aero/messenger/preferences/application.png          (mail/preferences/application.png)</span>
<a href="#l23.40"></a><span id="l23.40"> * skin/classic/aero/messenger/preferences/preferences.css          (mail/preferences/preferences-aero.css)</span>
<a href="#l23.41"></a><span id="l23.41">   skin/classic/aero/messenger/preferences/general.png              (mail/preferences/general-aero.png)</span>
<a href="#l23.42"></a><span id="l23.42">   skin/classic/aero/messenger/preferences/display.png              (mail/preferences/display-aero.png)</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l24.1"></a><span id="l24.1">new file mode 100644</span>
<a href="#l24.2"></a><span id="l24.2" class="difflineminus">--- /dev/null</span>
<a href="#l24.3"></a><span id="l24.3" class="difflineplus">+++ b/mail/themes/qute/mail/cloudfile/YouSendIt/fileExceedsLimit.css</span>
<a href="#l24.4"></a><span id="l24.4" class="difflineat">@@ -0,0 +1,36 @@</span>
<a href="#l24.5"></a><span id="l24.5" class="difflineplus">+/* This Source Code Form is subject to the terms of the Mozilla Public</span>
<a href="#l24.6"></a><span id="l24.6" class="difflineplus">+ * License, v. 2.0. If a copy of the MPL was not distributed with this file,</span>
<a href="#l24.7"></a><span id="l24.7" class="difflineplus">+ * You can obtain one at http://mozilla.org/MPL/2.0/. */</span>
<a href="#l24.8"></a><span id="l24.8" class="difflineplus">+</span>
<a href="#l24.9"></a><span id="l24.9" class="difflineplus">+html, body {</span>
<a href="#l24.10"></a><span id="l24.10" class="difflineplus">+  font: message-box;</span>
<a href="#l24.11"></a><span id="l24.11" class="difflineplus">+  margin: 0;</span>
<a href="#l24.12"></a><span id="l24.12" class="difflineplus">+}</span>
<a href="#l24.13"></a><span id="l24.13" class="difflineplus">+</span>
<a href="#l24.14"></a><span id="l24.14" class="difflineplus">+#fileExceedsLimit {</span>
<a href="#l24.15"></a><span id="l24.15" class="difflineplus">+  padding-left: 15px;</span>
<a href="#l24.16"></a><span id="l24.16" class="difflineplus">+  padding-right: 13px;</span>
<a href="#l24.17"></a><span id="l24.17" class="difflineplus">+  padding-top: 15px;</span>
<a href="#l24.18"></a><span id="l24.18" class="difflineplus">+  padding-bottom: 15px;</span>
<a href="#l24.19"></a><span id="l24.19" class="difflineplus">+}</span>
<a href="#l24.20"></a><span id="l24.20" class="difflineplus">+</span>
<a href="#l24.21"></a><span id="l24.21" class="difflineplus">+#proIncludes {</span>
<a href="#l24.22"></a><span id="l24.22" class="difflineplus">+  font-weight: bold;</span>
<a href="#l24.23"></a><span id="l24.23" class="difflineplus">+  margin-bottom: 10px;</span>
<a href="#l24.24"></a><span id="l24.24" class="difflineplus">+}</span>
<a href="#l24.25"></a><span id="l24.25" class="difflineplus">+</span>
<a href="#l24.26"></a><span id="l24.26" class="difflineplus">+#title {</span>
<a href="#l24.27"></a><span id="l24.27" class="difflineplus">+  font-size: 20pt;</span>
<a href="#l24.28"></a><span id="l24.28" class="difflineplus">+  color: rgb(141,198,63);</span>
<a href="#l24.29"></a><span id="l24.29" class="difflineplus">+}</span>
<a href="#l24.30"></a><span id="l24.30" class="difflineplus">+</span>
<a href="#l24.31"></a><span id="l24.31" class="difflineplus">+#title2 {</span>
<a href="#l24.32"></a><span id="l24.32" class="difflineplus">+  font-size: 20pt;</span>
<a href="#l24.33"></a><span id="l24.33" class="difflineplus">+  color: rgb(141,198,63);</span>
<a href="#l24.34"></a><span id="l24.34" class="difflineplus">+  margin-top: -10px;</span>
<a href="#l24.35"></a><span id="l24.35" class="difflineplus">+  margin-bottom: 10px;</span>
<a href="#l24.36"></a><span id="l24.36" class="difflineplus">+}</span>
<a href="#l24.37"></a><span id="l24.37" class="difflineplus">+</span>
<a href="#l24.38"></a><span id="l24.38" class="difflineplus">+description {</span>
<a href="#l24.39"></a><span id="l24.39" class="difflineplus">+  font-family: &quot;Lucida Sans Unicode&quot;, &quot;Lucida Grande&quot;, sans-serif;</span>
<a href="#l24.40"></a><span id="l24.40" class="difflineplus">+}</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l25.1"></a><span id="l25.1">new file mode 100644</span>
<a href="#l25.2"></a><span id="l25.2" class="difflineminus">--- /dev/null</span>
<a href="#l25.3"></a><span id="l25.3" class="difflineplus">+++ b/mail/themes/qute/mail/cloudfile/YouSendIt/settings.css</span>
<a href="#l25.4"></a><span id="l25.4" class="difflineat">@@ -0,0 +1,9 @@</span>
<a href="#l25.5"></a><span id="l25.5" class="difflineplus">+/* This Source Code Form is subject to the terms of the Mozilla Public</span>
<a href="#l25.6"></a><span id="l25.6" class="difflineplus">+ * License, v. 2.0. If a copy of the MPL was not distributed with this file,</span>
<a href="#l25.7"></a><span id="l25.7" class="difflineplus">+ * You can obtain one at http://mozilla.org/MPL/2.0/. */</span>
<a href="#l25.8"></a><span id="l25.8" class="difflineplus">+</span>
<a href="#l25.9"></a><span id="l25.9" class="difflineplus">+#username.hint {</span>
<a href="#l25.10"></a><span id="l25.10" class="difflineplus">+  color: gray;</span>
<a href="#l25.11"></a><span id="l25.11" class="difflineplus">+  font-style:italic;</span>
<a href="#l25.12"></a><span id="l25.12" class="difflineplus">+  font-size:95%</span>
<a href="#l25.13"></a><span id="l25.13" class="difflineplus">+}</span></pre></div></div>

<div class="page_footer">
<div class="page_footer_text">comm-central</div>
<div class="page_footer_text" style="padding-left: 10px">Deployed from <a href="https://hg.mozilla.org/hgcustom/version-control-tools/rev/35f393d6769a">35f393d6769a</a> at 2020-07-16T17:23:43Z.</div>
<div class="rss_logo">
<a href="/comm-central/rss-log">RSS</a>
<a href="/comm-central/atom-log">Atom</a>
</div>
<br />

</div>
</body>
</html>

