<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en-US" lang="en-US">
<head>
<link rel="icon" href="/static/4b0de666d1a4/hgicon.png" type="image/png" />
<meta name="robots" content="index, nofollow"/>
<link rel="stylesheet" href="/static/4b0de666d1a4/style-gitweb.css" type="text/css" />

<style type="text/css">
div.feed {
  float: right;
}
a img {
  border-width: 0px;
}
div.log_link {
  width: 80px;
  background-color: white;
}

div.log_body {
  padding-left: 96px;
}
</style>
<script type="text/javascript" src="/static/4b0de666d1a4/mercurial.js"></script>

<meta property="og:image" content="/static/4b0de666d1a4/moz-logo-bw-rgb.svg"/>
<meta property="og:type" content="website"/>

<title>comm-central: changeset 29651:4bf4b3ce8d53355b8d02452c9d1b99da0fac95d0</title>
<link rel="alternate" type="application/atom+xml"
   href="/comm-central/atom-log" title="Atom feed for comm-central"/>
<link rel="alternate" type="application/rss+xml"
   href="/comm-central/rss-log" title="RSS feed for comm-central"/>

<meta property="og:title" content="comm-central @ 4bf4b3ce8d53355b8d02452c9d1b99da0fac95d0" />
<meta property="og:url" content="/comm-central/rev/4bf4b3ce8d53355b8d02452c9d1b99da0fac95d0" />
<meta property="og:description" content="Bug 1636531 - Enable search in multiple/all address books. r=frg" />

</head>
<body>

<div class="page_header">
<div class="logo">
    <a href="https://developer.mozilla.org/en/docs/Mercurial">
        <img src="/static/4b0de666d1a4/moz-logo-bw-rgb.svg" alt="mercurial" />
    </a>
</div>
<a href="/">Mercurial</a> &gt; <a href="/comm-central">comm-central</a>  / changeset / 4bf4b3ce8d53355b8d02452c9d1b99da0fac95d0 
</div>

<div class="page_nav">
<div>
<a href="/comm-central/summary">summary</a> |
<a href="/comm-central/shortlog/4bf4b3ce8d53355b8d02452c9d1b99da0fac95d0">shortlog</a> |
<a href="/comm-central/log/4bf4b3ce8d53355b8d02452c9d1b99da0fac95d0">changelog</a> |
<a href="/comm-central/pushloghtml">pushlog</a> |
<a href="/comm-central/graph/4bf4b3ce8d53355b8d02452c9d1b99da0fac95d0">graph</a> |
<a href="/comm-central/tags">tags</a> |
<a href="/comm-central/bookmarks">bookmarks</a> |
<a href="/comm-central/branches">branches</a> |
<a href="/comm-central/file/4bf4b3ce8d53355b8d02452c9d1b99da0fac95d0">files</a> |
changeset |
<a href="/comm-central/raw-rev/4bf4b3ce8d53355b8d02452c9d1b99da0fac95d0">raw</a>  | <a href="/comm-central/archive/4bf4b3ce8d53355b8d02452c9d1b99da0fac95d0.zip">zip</a>  |
<a href="/comm-central/help">help</a>
</div>

<div class="search">
<form id="searchform" action="/comm-central/log">

<input name="rev" type="text" value="" size="40" />
<div id="hint">Find changesets by keywords (author, files, the commit message), revision
number or hash, or <a href="/comm-central/help/revsets">revset expression</a>.</div>
</form>
</div>
</div>

<div class="title">
<a href="https://bugzilla.mozilla.org/show_bug.cgi?id=1636531">Bug 1636531</a> - Enable search in multiple/all address books. r=frg
<span class="logtags"></span>
</div>
<div class="title_text">
<table cellspacing="0">

<tr><td>author</td><td>&#73;&#97;&#110;&#32;&#78;&#101;&#97;&#108;&#32;&#60;&#105;&#97;&#110;&#110;&#95;&#99;&#118;&#115;&#64;&#98;&#108;&#117;&#101;&#121;&#111;&#110;&#100;&#101;&#114;&#46;&#99;&#111;&#46;&#117;&#107;&#62;</td></tr>
<tr><td></td><td class="date age">Wed, 06 May 2020 00:45:49 +0100</td></tr>

<tr>
 <td>changeset 29651</td>
 <td style="font-family:monospace"><a class="list" href="/comm-central/rev/4bf4b3ce8d53355b8d02452c9d1b99da0fac95d0">4bf4b3ce8d53355b8d02452c9d1b99da0fac95d0</a></td>
</tr>



<tr>
<td>parent 29650</td>
<td style="font-family:monospace">
<a class="list" href="/comm-central/rev/f349036e7311c828d5602a6791b15098a01537a2">f349036e7311c828d5602a6791b15098a01537a2</a>
</td>
</tr>

<tr>
<td>child 29652</td>
<td style="font-family:monospace">
<a class="list" href="/comm-central/rev/94a426143805198f756b6fc772aced706f8d94d4">94a426143805198f756b6fc772aced706f8d94d4</a>
</td>
</tr>
<tr><td>push id</td><td><a href="/comm-central/pushloghtml?changeset=4bf4b3ce8d53355b8d02452c9d1b99da0fac95d0">17471</a></td></tr>
<tr><td>push user</td><td>frgrahl@gmx.net</td></tr>
<tr><td>push date</td><td class="date age">Sun, 24 May 2020 12:29:34 +0000</td></tr>

<tr><td>treeherder</td><td>comm-central@94a426143805 [<a href="https://treeherder.mozilla.org/#/jobs?repo=comm-central&revision=94a426143805198f756b6fc772aced706f8d94d4">default view</a>] [<a href="https://treeherder.mozilla.org/#/jobs?repo=comm-central&revision=94a426143805198f756b6fc772aced706f8d94d4&filter-resultStatus=testfailed&filter-resultStatus=busted&filter-resultStatus=exception">failures only]</td></tr>
<tr><td>perfherder</td><td>[<a href="https://treeherder.mozilla.org/perf.html#/compare?originalProject=comm-central&originalRevision=94a426143805198f756b6fc772aced706f8d94d4&newProject=comm-central&newRevision=391e5553aaad8b5ebbd6230705f981f4bd2832d7&framework=1" target="_blank">talos</a>] [<a href="https://treeherder.mozilla.org/perf.html#/compare?originalProject=comm-central&originalRevision=94a426143805198f756b6fc772aced706f8d94d4&newProject=comm-central&newRevision=391e5553aaad8b5ebbd6230705f981f4bd2832d7&framework=2" target="_blank">build metrics</a>] [<a href="https://treeherder.mozilla.org/perf.html#/compare?originalProject=comm-central&originalRevision=94a426143805198f756b6fc772aced706f8d94d4&newProject=comm-central&newRevision=391e5553aaad8b5ebbd6230705f981f4bd2832d7&framework=6" target="_blank">platform microbench</a>] (compared to previous push)</td></tr>
<tr><td>reviewers</td><td><a href="/comm-central/log?rev=reviewer%28frg%29&revcount=50">frg</a></td></tr>
<tr><td>bugs</td><td><a href="https://bugzilla.mozilla.org/show_bug.cgi?id=1636531">1636531</a>, <a href="https://bugzilla.mozilla.org/show_bug.cgi?id=170270">170270</a>, <a href="https://bugzilla.mozilla.org/show_bug.cgi?id=1140768">1140768</a>, <a href="https://bugzilla.mozilla.org/show_bug.cgi?id=1143812">1143812</a>, <a href="https://bugzilla.mozilla.org/show_bug.cgi?id=1142705">1142705</a>, <a href="https://bugzilla.mozilla.org/show_bug.cgi?id=824150">824150</a>, <a href="https://bugzilla.mozilla.org/show_bug.cgi?id=691141">691141</a>, <a href="https://bugzilla.mozilla.org/show_bug.cgi?id=1319409">1319409</a></td></tr>




</table></div>

<div class="page_body description"><a href="https://bugzilla.mozilla.org/show_bug.cgi?id=1636531">Bug 1636531</a> - Enable search in multiple/all address books. r=frg
Port the relevant parts of the following bugs to SeaMonkey:
* <a href="https://bugzilla.mozilla.org/show_bug.cgi?id=170270">Bug 170270</a> - Enable search in multiple/all address books
* <a href="https://bugzilla.mozilla.org/show_bug.cgi?id=1140768">Bug 1140768</a> - Fix typo of &quot;gShowAbColumnInComposeSidbar&quot; in abContactsPanel.js and improve the logic of hiding the &quot;addressbook&quot; column
* <a href="https://bugzilla.mozilla.org/show_bug.cgi?id=1143812">Bug 1143812</a> - Always allow creating new contacts and lists after opening addressbook by using Personal Addressbook when a usable AB is not selected
* <a href="https://bugzilla.mozilla.org/show_bug.cgi?id=1142705">Bug 1142705</a> - Contacts sidebar doesn't remember the last selected address book after <a href="https://bugzilla.mozilla.org/show_bug.cgi?id=170270">Bug 170270</a> checked in
* <a href="https://bugzilla.mozilla.org/show_bug.cgi?id=824150">Bug 824150</a> - Code cleanup in /mail/ and /mailnews/
* <a href="https://bugzilla.mozilla.org/show_bug.cgi?id=691141">Bug 691141</a> - rework AB contact photo storing UI
* <a href="https://bugzilla.mozilla.org/show_bug.cgi?id=1319409">Bug 1319409</a> - Rename GetSelectedDirectory() function to getSelectedDirURI(), and various related code cleanup/refactoring</div>
<div class="list_head"></div>
<div class="title_text">
<table cellspacing="0">

<tr class="parity0">
<td><a class="list" href="/comm-central/diff/4bf4b3ce8d53355b8d02452c9d1b99da0fac95d0/suite/locales/en-US/chrome/mailnews/addressbook/abMainWindow.dtd">suite/locales/en-US/chrome/mailnews/addressbook/abMainWindow.dtd</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/4bf4b3ce8d53355b8d02452c9d1b99da0fac95d0/suite/locales/en-US/chrome/mailnews/addressbook/abMainWindow.dtd">file</a> |
<a href="/comm-central/annotate/4bf4b3ce8d53355b8d02452c9d1b99da0fac95d0/suite/locales/en-US/chrome/mailnews/addressbook/abMainWindow.dtd">annotate</a> |
<a href="/comm-central/diff/4bf4b3ce8d53355b8d02452c9d1b99da0fac95d0/suite/locales/en-US/chrome/mailnews/addressbook/abMainWindow.dtd">diff</a> |
<a href="/comm-central/comparison/4bf4b3ce8d53355b8d02452c9d1b99da0fac95d0/suite/locales/en-US/chrome/mailnews/addressbook/abMainWindow.dtd">comparison</a> |
<a href="/comm-central/log/4bf4b3ce8d53355b8d02452c9d1b99da0fac95d0/suite/locales/en-US/chrome/mailnews/addressbook/abMainWindow.dtd">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/4bf4b3ce8d53355b8d02452c9d1b99da0fac95d0/suite/locales/en-US/chrome/mailnews/addressbook/abResultsPaneOverlay.dtd">suite/locales/en-US/chrome/mailnews/addressbook/abResultsPaneOverlay.dtd</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/4bf4b3ce8d53355b8d02452c9d1b99da0fac95d0/suite/locales/en-US/chrome/mailnews/addressbook/abResultsPaneOverlay.dtd">file</a> |
<a href="/comm-central/annotate/4bf4b3ce8d53355b8d02452c9d1b99da0fac95d0/suite/locales/en-US/chrome/mailnews/addressbook/abResultsPaneOverlay.dtd">annotate</a> |
<a href="/comm-central/diff/4bf4b3ce8d53355b8d02452c9d1b99da0fac95d0/suite/locales/en-US/chrome/mailnews/addressbook/abResultsPaneOverlay.dtd">diff</a> |
<a href="/comm-central/comparison/4bf4b3ce8d53355b8d02452c9d1b99da0fac95d0/suite/locales/en-US/chrome/mailnews/addressbook/abResultsPaneOverlay.dtd">comparison</a> |
<a href="/comm-central/log/4bf4b3ce8d53355b8d02452c9d1b99da0fac95d0/suite/locales/en-US/chrome/mailnews/addressbook/abResultsPaneOverlay.dtd">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/4bf4b3ce8d53355b8d02452c9d1b99da0fac95d0/suite/locales/en-US/chrome/mailnews/addressbook/addressBook.properties">suite/locales/en-US/chrome/mailnews/addressbook/addressBook.properties</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/4bf4b3ce8d53355b8d02452c9d1b99da0fac95d0/suite/locales/en-US/chrome/mailnews/addressbook/addressBook.properties">file</a> |
<a href="/comm-central/annotate/4bf4b3ce8d53355b8d02452c9d1b99da0fac95d0/suite/locales/en-US/chrome/mailnews/addressbook/addressBook.properties">annotate</a> |
<a href="/comm-central/diff/4bf4b3ce8d53355b8d02452c9d1b99da0fac95d0/suite/locales/en-US/chrome/mailnews/addressbook/addressBook.properties">diff</a> |
<a href="/comm-central/comparison/4bf4b3ce8d53355b8d02452c9d1b99da0fac95d0/suite/locales/en-US/chrome/mailnews/addressbook/addressBook.properties">comparison</a> |
<a href="/comm-central/log/4bf4b3ce8d53355b8d02452c9d1b99da0fac95d0/suite/locales/en-US/chrome/mailnews/addressbook/addressBook.properties">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/4bf4b3ce8d53355b8d02452c9d1b99da0fac95d0/suite/mailnews/components/addrbook/content/abCardOverlay.js">suite/mailnews/components/addrbook/content/abCardOverlay.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/4bf4b3ce8d53355b8d02452c9d1b99da0fac95d0/suite/mailnews/components/addrbook/content/abCardOverlay.js">file</a> |
<a href="/comm-central/annotate/4bf4b3ce8d53355b8d02452c9d1b99da0fac95d0/suite/mailnews/components/addrbook/content/abCardOverlay.js">annotate</a> |
<a href="/comm-central/diff/4bf4b3ce8d53355b8d02452c9d1b99da0fac95d0/suite/mailnews/components/addrbook/content/abCardOverlay.js">diff</a> |
<a href="/comm-central/comparison/4bf4b3ce8d53355b8d02452c9d1b99da0fac95d0/suite/mailnews/components/addrbook/content/abCardOverlay.js">comparison</a> |
<a href="/comm-central/log/4bf4b3ce8d53355b8d02452c9d1b99da0fac95d0/suite/mailnews/components/addrbook/content/abCardOverlay.js">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/4bf4b3ce8d53355b8d02452c9d1b99da0fac95d0/suite/mailnews/components/addrbook/content/abCommon.js">suite/mailnews/components/addrbook/content/abCommon.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/4bf4b3ce8d53355b8d02452c9d1b99da0fac95d0/suite/mailnews/components/addrbook/content/abCommon.js">file</a> |
<a href="/comm-central/annotate/4bf4b3ce8d53355b8d02452c9d1b99da0fac95d0/suite/mailnews/components/addrbook/content/abCommon.js">annotate</a> |
<a href="/comm-central/diff/4bf4b3ce8d53355b8d02452c9d1b99da0fac95d0/suite/mailnews/components/addrbook/content/abCommon.js">diff</a> |
<a href="/comm-central/comparison/4bf4b3ce8d53355b8d02452c9d1b99da0fac95d0/suite/mailnews/components/addrbook/content/abCommon.js">comparison</a> |
<a href="/comm-central/log/4bf4b3ce8d53355b8d02452c9d1b99da0fac95d0/suite/mailnews/components/addrbook/content/abCommon.js">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/4bf4b3ce8d53355b8d02452c9d1b99da0fac95d0/suite/mailnews/components/addrbook/content/abResultsPaneOverlay.xul">suite/mailnews/components/addrbook/content/abResultsPaneOverlay.xul</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/4bf4b3ce8d53355b8d02452c9d1b99da0fac95d0/suite/mailnews/components/addrbook/content/abResultsPaneOverlay.xul">file</a> |
<a href="/comm-central/annotate/4bf4b3ce8d53355b8d02452c9d1b99da0fac95d0/suite/mailnews/components/addrbook/content/abResultsPaneOverlay.xul">annotate</a> |
<a href="/comm-central/diff/4bf4b3ce8d53355b8d02452c9d1b99da0fac95d0/suite/mailnews/components/addrbook/content/abResultsPaneOverlay.xul">diff</a> |
<a href="/comm-central/comparison/4bf4b3ce8d53355b8d02452c9d1b99da0fac95d0/suite/mailnews/components/addrbook/content/abResultsPaneOverlay.xul">comparison</a> |
<a href="/comm-central/log/4bf4b3ce8d53355b8d02452c9d1b99da0fac95d0/suite/mailnews/components/addrbook/content/abResultsPaneOverlay.xul">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/4bf4b3ce8d53355b8d02452c9d1b99da0fac95d0/suite/mailnews/components/addrbook/content/abSelectAddressesDialog.js">suite/mailnews/components/addrbook/content/abSelectAddressesDialog.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/4bf4b3ce8d53355b8d02452c9d1b99da0fac95d0/suite/mailnews/components/addrbook/content/abSelectAddressesDialog.js">file</a> |
<a href="/comm-central/annotate/4bf4b3ce8d53355b8d02452c9d1b99da0fac95d0/suite/mailnews/components/addrbook/content/abSelectAddressesDialog.js">annotate</a> |
<a href="/comm-central/diff/4bf4b3ce8d53355b8d02452c9d1b99da0fac95d0/suite/mailnews/components/addrbook/content/abSelectAddressesDialog.js">diff</a> |
<a href="/comm-central/comparison/4bf4b3ce8d53355b8d02452c9d1b99da0fac95d0/suite/mailnews/components/addrbook/content/abSelectAddressesDialog.js">comparison</a> |
<a href="/comm-central/log/4bf4b3ce8d53355b8d02452c9d1b99da0fac95d0/suite/mailnews/components/addrbook/content/abSelectAddressesDialog.js">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/4bf4b3ce8d53355b8d02452c9d1b99da0fac95d0/suite/mailnews/components/addrbook/content/abTrees.js">suite/mailnews/components/addrbook/content/abTrees.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/4bf4b3ce8d53355b8d02452c9d1b99da0fac95d0/suite/mailnews/components/addrbook/content/abTrees.js">file</a> |
<a href="/comm-central/annotate/4bf4b3ce8d53355b8d02452c9d1b99da0fac95d0/suite/mailnews/components/addrbook/content/abTrees.js">annotate</a> |
<a href="/comm-central/diff/4bf4b3ce8d53355b8d02452c9d1b99da0fac95d0/suite/mailnews/components/addrbook/content/abTrees.js">diff</a> |
<a href="/comm-central/comparison/4bf4b3ce8d53355b8d02452c9d1b99da0fac95d0/suite/mailnews/components/addrbook/content/abTrees.js">comparison</a> |
<a href="/comm-central/log/4bf4b3ce8d53355b8d02452c9d1b99da0fac95d0/suite/mailnews/components/addrbook/content/abTrees.js">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/4bf4b3ce8d53355b8d02452c9d1b99da0fac95d0/suite/mailnews/components/addrbook/content/addressbook-panel.js">suite/mailnews/components/addrbook/content/addressbook-panel.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/4bf4b3ce8d53355b8d02452c9d1b99da0fac95d0/suite/mailnews/components/addrbook/content/addressbook-panel.js">file</a> |
<a href="/comm-central/annotate/4bf4b3ce8d53355b8d02452c9d1b99da0fac95d0/suite/mailnews/components/addrbook/content/addressbook-panel.js">annotate</a> |
<a href="/comm-central/diff/4bf4b3ce8d53355b8d02452c9d1b99da0fac95d0/suite/mailnews/components/addrbook/content/addressbook-panel.js">diff</a> |
<a href="/comm-central/comparison/4bf4b3ce8d53355b8d02452c9d1b99da0fac95d0/suite/mailnews/components/addrbook/content/addressbook-panel.js">comparison</a> |
<a href="/comm-central/log/4bf4b3ce8d53355b8d02452c9d1b99da0fac95d0/suite/mailnews/components/addrbook/content/addressbook-panel.js">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/4bf4b3ce8d53355b8d02452c9d1b99da0fac95d0/suite/mailnews/components/addrbook/content/addressbook-panel.xul">suite/mailnews/components/addrbook/content/addressbook-panel.xul</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/4bf4b3ce8d53355b8d02452c9d1b99da0fac95d0/suite/mailnews/components/addrbook/content/addressbook-panel.xul">file</a> |
<a href="/comm-central/annotate/4bf4b3ce8d53355b8d02452c9d1b99da0fac95d0/suite/mailnews/components/addrbook/content/addressbook-panel.xul">annotate</a> |
<a href="/comm-central/diff/4bf4b3ce8d53355b8d02452c9d1b99da0fac95d0/suite/mailnews/components/addrbook/content/addressbook-panel.xul">diff</a> |
<a href="/comm-central/comparison/4bf4b3ce8d53355b8d02452c9d1b99da0fac95d0/suite/mailnews/components/addrbook/content/addressbook-panel.xul">comparison</a> |
<a href="/comm-central/log/4bf4b3ce8d53355b8d02452c9d1b99da0fac95d0/suite/mailnews/components/addrbook/content/addressbook-panel.xul">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/4bf4b3ce8d53355b8d02452c9d1b99da0fac95d0/suite/mailnews/components/addrbook/content/addressbook.js">suite/mailnews/components/addrbook/content/addressbook.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/4bf4b3ce8d53355b8d02452c9d1b99da0fac95d0/suite/mailnews/components/addrbook/content/addressbook.js">file</a> |
<a href="/comm-central/annotate/4bf4b3ce8d53355b8d02452c9d1b99da0fac95d0/suite/mailnews/components/addrbook/content/addressbook.js">annotate</a> |
<a href="/comm-central/diff/4bf4b3ce8d53355b8d02452c9d1b99da0fac95d0/suite/mailnews/components/addrbook/content/addressbook.js">diff</a> |
<a href="/comm-central/comparison/4bf4b3ce8d53355b8d02452c9d1b99da0fac95d0/suite/mailnews/components/addrbook/content/addressbook.js">comparison</a> |
<a href="/comm-central/log/4bf4b3ce8d53355b8d02452c9d1b99da0fac95d0/suite/mailnews/components/addrbook/content/addressbook.js">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/4bf4b3ce8d53355b8d02452c9d1b99da0fac95d0/suite/mailnews/components/addrbook/content/addressbook.xul">suite/mailnews/components/addrbook/content/addressbook.xul</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/4bf4b3ce8d53355b8d02452c9d1b99da0fac95d0/suite/mailnews/components/addrbook/content/addressbook.xul">file</a> |
<a href="/comm-central/annotate/4bf4b3ce8d53355b8d02452c9d1b99da0fac95d0/suite/mailnews/components/addrbook/content/addressbook.xul">annotate</a> |
<a href="/comm-central/diff/4bf4b3ce8d53355b8d02452c9d1b99da0fac95d0/suite/mailnews/components/addrbook/content/addressbook.xul">diff</a> |
<a href="/comm-central/comparison/4bf4b3ce8d53355b8d02452c9d1b99da0fac95d0/suite/mailnews/components/addrbook/content/addressbook.xul">comparison</a> |
<a href="/comm-central/log/4bf4b3ce8d53355b8d02452c9d1b99da0fac95d0/suite/mailnews/components/addrbook/content/addressbook.xul">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/4bf4b3ce8d53355b8d02452c9d1b99da0fac95d0/suite/themes/classic/mac/messenger/addressbook/addressbook.css">suite/themes/classic/mac/messenger/addressbook/addressbook.css</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/4bf4b3ce8d53355b8d02452c9d1b99da0fac95d0/suite/themes/classic/mac/messenger/addressbook/addressbook.css">file</a> |
<a href="/comm-central/annotate/4bf4b3ce8d53355b8d02452c9d1b99da0fac95d0/suite/themes/classic/mac/messenger/addressbook/addressbook.css">annotate</a> |
<a href="/comm-central/diff/4bf4b3ce8d53355b8d02452c9d1b99da0fac95d0/suite/themes/classic/mac/messenger/addressbook/addressbook.css">diff</a> |
<a href="/comm-central/comparison/4bf4b3ce8d53355b8d02452c9d1b99da0fac95d0/suite/themes/classic/mac/messenger/addressbook/addressbook.css">comparison</a> |
<a href="/comm-central/log/4bf4b3ce8d53355b8d02452c9d1b99da0fac95d0/suite/themes/classic/mac/messenger/addressbook/addressbook.css">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/4bf4b3ce8d53355b8d02452c9d1b99da0fac95d0/suite/themes/classic/messenger/addressbook/addressbook.css">suite/themes/classic/messenger/addressbook/addressbook.css</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/4bf4b3ce8d53355b8d02452c9d1b99da0fac95d0/suite/themes/classic/messenger/addressbook/addressbook.css">file</a> |
<a href="/comm-central/annotate/4bf4b3ce8d53355b8d02452c9d1b99da0fac95d0/suite/themes/classic/messenger/addressbook/addressbook.css">annotate</a> |
<a href="/comm-central/diff/4bf4b3ce8d53355b8d02452c9d1b99da0fac95d0/suite/themes/classic/messenger/addressbook/addressbook.css">diff</a> |
<a href="/comm-central/comparison/4bf4b3ce8d53355b8d02452c9d1b99da0fac95d0/suite/themes/classic/messenger/addressbook/addressbook.css">comparison</a> |
<a href="/comm-central/log/4bf4b3ce8d53355b8d02452c9d1b99da0fac95d0/suite/themes/classic/messenger/addressbook/addressbook.css">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/4bf4b3ce8d53355b8d02452c9d1b99da0fac95d0/suite/themes/modern/messenger/addressbook/addressbook.css">suite/themes/modern/messenger/addressbook/addressbook.css</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/4bf4b3ce8d53355b8d02452c9d1b99da0fac95d0/suite/themes/modern/messenger/addressbook/addressbook.css">file</a> |
<a href="/comm-central/annotate/4bf4b3ce8d53355b8d02452c9d1b99da0fac95d0/suite/themes/modern/messenger/addressbook/addressbook.css">annotate</a> |
<a href="/comm-central/diff/4bf4b3ce8d53355b8d02452c9d1b99da0fac95d0/suite/themes/modern/messenger/addressbook/addressbook.css">diff</a> |
<a href="/comm-central/comparison/4bf4b3ce8d53355b8d02452c9d1b99da0fac95d0/suite/themes/modern/messenger/addressbook/addressbook.css">comparison</a> |
<a href="/comm-central/log/4bf4b3ce8d53355b8d02452c9d1b99da0fac95d0/suite/themes/modern/messenger/addressbook/addressbook.css">revisions</a>
</td>
</tr>
</table></div>

<div class="page_body diffblocks"><div class="diffblock"><pre class="sourcelines">
<a href="#l1.1"></a><span id="l1.1" class="difflineminus">--- a/suite/locales/en-US/chrome/mailnews/addressbook/abMainWindow.dtd</span>
<a href="#l1.2"></a><span id="l1.2" class="difflineplus">+++ b/suite/locales/en-US/chrome/mailnews/addressbook/abMainWindow.dtd</span>
<a href="#l1.3"></a><span id="l1.3" class="difflineat">@@ -1,71 +1,67 @@</span>
<a href="#l1.4"></a><span id="l1.4"> &lt;!-- This Source Code Form is subject to the terms of the Mozilla Public</span>
<a href="#l1.5"></a><span id="l1.5">    - License, v. 2.0. If a copy of the MPL was not distributed with this</span>
<a href="#l1.6"></a><span id="l1.6">    - file, You can obtain one at http://mozilla.org/MPL/2.0/. --&gt;</span>
<a href="#l1.7"></a><span id="l1.7"> </span>
<a href="#l1.8"></a><span id="l1.8"> &lt;!-- Title --&gt;</span>
<a href="#l1.9"></a><span id="l1.9"> &lt;!ENTITY addressbookWindow.title                        &quot;Address Book&quot;&gt;</span>
<a href="#l1.10"></a><span id="l1.10" class="difflineminus">-</span>
<a href="#l1.11"></a><span id="l1.11" class="difflineminus">-&lt;!-- Menus:  the . means that the menu item isn't implemented yet --&gt;</span>
<a href="#l1.12"></a><span id="l1.12" class="difflineminus">-</span>
<a href="#l1.13"></a><span id="l1.13" class="difflineplus">+&lt;!ENTITY blankResultsPaneMessage.label                  &quot;This address book shows contacts only after a search&quot;&gt;</span>
<a href="#l1.14"></a><span id="l1.14" class="difflineplus">+&lt;!ENTITY localResultsOnlyMessage.label                  &quot;Contacts from remote address books are not shown until you search&quot;&gt;</span>
<a href="#l1.15"></a><span id="l1.15"> &lt;!-- File Menu --&gt;</span>
<a href="#l1.16"></a><span id="l1.16"> &lt;!ENTITY newContact.label                               &quot;Contact…&quot;&gt;</span>
<a href="#l1.17"></a><span id="l1.17" class="difflineminus">-&lt;!-- LOCALIZATION NOTE (newContact.accesskey) : DONT_TRANSLATE --&gt;</span>
<a href="#l1.18"></a><span id="l1.18"> &lt;!ENTITY newContact.accesskey                           &quot;C&quot;&gt;</span>
<a href="#l1.19"></a><span id="l1.19" class="difflineplus">+&lt;!ENTITY newContact.key                                 &quot;N&quot;&gt;</span>
<a href="#l1.20"></a><span id="l1.20"> &lt;!ENTITY newListCmd.label                               &quot;Mailing List…&quot;&gt;</span>
<a href="#l1.21"></a><span id="l1.21" class="difflineminus">-&lt;!-- LOCALIZATION NOTE (newListCmd.accesskey) : DONT_TRANSLATE --&gt;</span>
<a href="#l1.22"></a><span id="l1.22"> &lt;!ENTITY newListCmd.accesskey                           &quot;L&quot;&gt;</span>
<a href="#l1.23"></a><span id="l1.23"> &lt;!ENTITY newAddressBookCmd.label                        &quot;Address Book…&quot;&gt;</span>
<a href="#l1.24"></a><span id="l1.24"> &lt;!ENTITY newAddressBookCmd.accesskey                    &quot;o&quot;&gt;</span>
<a href="#l1.25"></a><span id="l1.25"> &lt;!ENTITY newLDAPDirectoryCmd.label                      &quot;LDAP Directory…&quot;&gt;</span>
<a href="#l1.26"></a><span id="l1.26" class="difflineminus">-&lt;!-- LOCALIZATION NOTE (newLDAPDirectoryCmd.accesskey) : DONT_TRANSLATE --&gt;</span>
<a href="#l1.27"></a><span id="l1.27"> &lt;!ENTITY newLDAPDirectoryCmd.accesskey                  &quot;D&quot;&gt;</span>
<a href="#l1.28"></a><span id="l1.28"> &lt;!ENTITY newIM.label                                    &quot;IM&quot;&gt;</span>
<a href="#l1.29"></a><span id="l1.29"> &lt;!ENTITY printContactViewCmd.label                      &quot;Print Contact…&quot;&gt;</span>
<a href="#l1.30"></a><span id="l1.30" class="difflineminus">-&lt;!ENTITY printContactViewCmd.accesskey                  &quot;p&quot;&gt;</span>
<a href="#l1.31"></a><span id="l1.31" class="difflineplus">+&lt;!ENTITY printContactViewCmd.accesskey                  &quot;P&quot;&gt;</span>
<a href="#l1.32"></a><span id="l1.32" class="difflineplus">+&lt;!ENTITY printContactViewCmd.key                        &quot;P&quot;&gt;</span>
<a href="#l1.33"></a><span id="l1.33"> &lt;!ENTITY printPreviewContactViewCmd.label               &quot;Print Preview Contact&quot;&gt;</span>
<a href="#l1.34"></a><span id="l1.34"> &lt;!ENTITY printPreviewContactViewCmd.accesskey           &quot;v&quot;&gt;</span>
<a href="#l1.35"></a><span id="l1.35" class="difflineminus">-&lt;!ENTITY printContactViewCmd.key                        &quot;P&quot;&gt;</span>
<a href="#l1.36"></a><span id="l1.36"> &lt;!ENTITY printAddressBook.label                         &quot;Print Address Book…&quot;&gt;</span>
<a href="#l1.37"></a><span id="l1.37"> &lt;!ENTITY printAddressBook.accesskey                     &quot;A&quot;&gt;</span>
<a href="#l1.38"></a><span id="l1.38"> &lt;!ENTITY printPreviewAddressBook.label                  &quot;Print Preview Address Book&quot;&gt;</span>
<a href="#l1.39"></a><span id="l1.39"> &lt;!ENTITY printPreviewAddressBook.accesskey              &quot;B&quot;&gt;</span>
<a href="#l1.40"></a><span id="l1.40"> </span>
<a href="#l1.41"></a><span id="l1.41"> &lt;!-- Edit Menu --&gt;</span>
<a href="#l1.42"></a><span id="l1.42"> &lt;!ENTITY deleteAbCmd.label                              &quot;Delete Address Book&quot;&gt;</span>
<a href="#l1.43"></a><span id="l1.43"> &lt;!ENTITY deleteContactCmd.label                         &quot;Delete Contact&quot;&gt;</span>
<a href="#l1.44"></a><span id="l1.44"> &lt;!ENTITY deleteContactsCmd.label                        &quot;Delete Selected Contacts&quot;&gt;</span>
<a href="#l1.45"></a><span id="l1.45"> &lt;!ENTITY deleteListCmd.label                            &quot;Delete List&quot;&gt;</span>
<a href="#l1.46"></a><span id="l1.46"> &lt;!ENTITY deleteListsCmd.label                           &quot;Delete Selected Lists&quot;&gt;</span>
<a href="#l1.47"></a><span id="l1.47"> &lt;!ENTITY deleteItemsCmd.label                           &quot;Delete Selected Items&quot;&gt;</span>
<a href="#l1.48"></a><span id="l1.48"> &lt;!ENTITY swapFirstNameLastNameCmd.label                 &quot;Swap First/Last Name&quot;&gt;</span>
<a href="#l1.49"></a><span id="l1.49"> &lt;!ENTITY swapFirstNameLastNameCmd.accesskey             &quot;w&quot;&gt;</span>
<a href="#l1.50"></a><span id="l1.50"> &lt;!ENTITY propertiesCmd.label                            &quot;Properties…&quot;&gt;</span>
<a href="#l1.51"></a><span id="l1.51" class="difflineminus">-&lt;!-- LOCALIZATION NOTE (propertiesCmd.accesskey) : DONT_TRANSLATE --&gt;</span>
<a href="#l1.52"></a><span id="l1.52"> &lt;!ENTITY propertiesCmd.accesskey                        &quot;i&quot;&gt;</span>
<a href="#l1.53"></a><span id="l1.53"> &lt;!ENTITY propertiesCmd.key                              &quot;i&quot;&gt;</span>
<a href="#l1.54"></a><span id="l1.54"> </span>
<a href="#l1.55"></a><span id="l1.55"> &lt;!-- View Menu --&gt;</span>
<a href="#l1.56"></a><span id="l1.56"> &lt;!ENTITY showAbToolbarCmd.label                         &quot;Address Book Toolbar&quot;&gt;</span>
<a href="#l1.57"></a><span id="l1.57"> &lt;!ENTITY showAbToolbarCmd.accesskey                     &quot;o&quot;&gt;</span>
<a href="#l1.58"></a><span id="l1.58"> &lt;!ENTITY layoutMenu.label                               &quot;Layout&quot;&gt;</span>
<a href="#l1.59"></a><span id="l1.59"> &lt;!ENTITY layoutMenu.accesskey                           &quot;L&quot;&gt;</span>
<a href="#l1.60"></a><span id="l1.60"> &lt;!ENTITY showDirectoryPane.label                        &quot;Directory Pane&quot;&gt;</span>
<a href="#l1.61"></a><span id="l1.61"> &lt;!ENTITY showDirectoryPane.accesskey                    &quot;D&quot;&gt;</span>
<a href="#l1.62"></a><span id="l1.62"> &lt;!ENTITY showContactPane2.label                         &quot;Contact Pane&quot;&gt;</span>
<a href="#l1.63"></a><span id="l1.63"> &lt;!ENTITY showContactPane2.accesskey                     &quot;C&quot;&gt;</span>
<a href="#l1.64"></a><span id="l1.64"> &lt;!ENTITY menu_ShowNameAs.label                          &quot;Show Name As&quot;&gt;</span>
<a href="#l1.65"></a><span id="l1.65"> &lt;!ENTITY menu_ShowNameAs.accesskey                      &quot;n&quot;&gt;</span>
<a href="#l1.66"></a><span id="l1.66"> &lt;!ENTITY firstLastCmd.label                             &quot;First Last&quot;&gt;</span>
<a href="#l1.67"></a><span id="l1.67" class="difflineminus">-&lt;!ENTITY firstLastCmd.accesskey                         &quot;f&quot;&gt;</span>
<a href="#l1.68"></a><span id="l1.68" class="difflineplus">+&lt;!ENTITY firstLastCmd.accesskey                         &quot;F&quot;&gt;</span>
<a href="#l1.69"></a><span id="l1.69"> &lt;!ENTITY lastFirstCmd.label                             &quot;Last, First&quot;&gt;</span>
<a href="#l1.70"></a><span id="l1.70" class="difflineminus">-&lt;!ENTITY lastFirstCmd.accesskey                         &quot;l&quot;&gt;</span>
<a href="#l1.71"></a><span id="l1.71" class="difflineplus">+&lt;!ENTITY lastFirstCmd.accesskey                         &quot;L&quot;&gt;</span>
<a href="#l1.72"></a><span id="l1.72"> &lt;!ENTITY displayNameCmd.label                           &quot;Display Name&quot;&gt;</span>
<a href="#l1.73"></a><span id="l1.73" class="difflineminus">-&lt;!ENTITY displayNameCmd.accesskey                       &quot;d&quot;&gt;</span>
<a href="#l1.74"></a><span id="l1.74" class="difflineplus">+&lt;!ENTITY displayNameCmd.accesskey                       &quot;D&quot;&gt;</span>
<a href="#l1.75"></a><span id="l1.75"> &lt;!-- LOCALIZATION NOTE (toggleDirectoryPaneCmd.key): This is only used on the</span>
<a href="#l1.76"></a><span id="l1.76">      mac platform, other platforms use VK_F9. --&gt;</span>
<a href="#l1.77"></a><span id="l1.77"> &lt;!ENTITY toggleDirectoryPaneCmd.key                     &quot;S&quot;&gt;</span>
<a href="#l1.78"></a><span id="l1.78"> </span>
<a href="#l1.79"></a><span id="l1.79"> &lt;!-- Tasks Menu --&gt;</span>
<a href="#l1.80"></a><span id="l1.80"> &lt;!ENTITY importCmd.label                                &quot;Import…&quot;&gt;</span>
<a href="#l1.81"></a><span id="l1.81"> &lt;!ENTITY importCmd.accesskey                            &quot;I&quot;&gt;</span>
<a href="#l1.82"></a><span id="l1.82"> &lt;!ENTITY exportCmd.label                                &quot;Export…&quot;&gt;</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l2.1"></a><span id="l2.1" class="difflineminus">--- a/suite/locales/en-US/chrome/mailnews/addressbook/abResultsPaneOverlay.dtd</span>
<a href="#l2.2"></a><span id="l2.2" class="difflineplus">+++ b/suite/locales/en-US/chrome/mailnews/addressbook/abResultsPaneOverlay.dtd</span>
<a href="#l2.3"></a><span id="l2.3" class="difflineat">@@ -1,12 +1,14 @@</span>
<a href="#l2.4"></a><span id="l2.4"> &lt;!-- This Source Code Form is subject to the terms of the Mozilla Public</span>
<a href="#l2.5"></a><span id="l2.5">    - License, v. 2.0. If a copy of the MPL was not distributed with this</span>
<a href="#l2.6"></a><span id="l2.6">    - file, You can obtain one at http://mozilla.org/MPL/2.0/. --&gt;</span>
<a href="#l2.7"></a><span id="l2.7"> </span>
<a href="#l2.8"></a><span id="l2.8" class="difflineplus">+&lt;!ENTITY Addrbook.label                        &quot;Address Book&quot;&gt;</span>
<a href="#l2.9"></a><span id="l2.9" class="difflineplus">+&lt;!ENTITY Addrbook.accesskey                    &quot;B&quot;&gt;</span>
<a href="#l2.10"></a><span id="l2.10"> &lt;!ENTITY GeneratedName.label                   &quot;Name&quot;&gt;</span>
<a href="#l2.11"></a><span id="l2.11"> &lt;!ENTITY GeneratedName.accesskey               &quot;N&quot;&gt;</span>
<a href="#l2.12"></a><span id="l2.12"> &lt;!ENTITY PrimaryEmail.label                    &quot;Email&quot;&gt;</span>
<a href="#l2.13"></a><span id="l2.13"> &lt;!ENTITY PrimaryEmail.accesskey                &quot;E&quot;&gt;</span>
<a href="#l2.14"></a><span id="l2.14"> &lt;!ENTITY Company.label                         &quot;Organization&quot;&gt;</span>
<a href="#l2.15"></a><span id="l2.15"> &lt;!ENTITY Company.accesskey                     &quot;z&quot;&gt;</span>
<a href="#l2.16"></a><span id="l2.16"> &lt;!ENTITY _PhoneticName.label                   &quot;Phonetic Name&quot;&gt;</span>
<a href="#l2.17"></a><span id="l2.17"> &lt;!ENTITY _PhoneticName.accesskey               &quot;o&quot;&gt;</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l3.1"></a><span id="l3.1" class="difflineminus">--- a/suite/locales/en-US/chrome/mailnews/addressbook/addressBook.properties</span>
<a href="#l3.2"></a><span id="l3.2" class="difflineplus">+++ b/suite/locales/en-US/chrome/mailnews/addressbook/addressBook.properties</span>
<a href="#l3.3"></a><span id="l3.3" class="difflineat">@@ -7,16 +7,18 @@</span>
<a href="#l3.4"></a><span id="l3.4"> #</span>
<a href="#l3.5"></a><span id="l3.5"> </span>
<a href="#l3.6"></a><span id="l3.6"> ## LOCALIZATION NOTE (mailingListTitleEdit): %S will be replaced by the Mailing List's display name</span>
<a href="#l3.7"></a><span id="l3.7"> mailingListTitleEdit=Edit %S</span>
<a href="#l3.8"></a><span id="l3.8"> emptyListName=You must enter a list name.</span>
<a href="#l3.9"></a><span id="l3.9"> lastFirstFormat=%S, %S</span>
<a href="#l3.10"></a><span id="l3.10"> firstLastFormat=%S %S</span>
<a href="#l3.11"></a><span id="l3.11"> </span>
<a href="#l3.12"></a><span id="l3.12" class="difflineplus">+allAddressBooks=All Address Books</span>
<a href="#l3.13"></a><span id="l3.13" class="difflineplus">+</span>
<a href="#l3.14"></a><span id="l3.14"> newContactTitle=New Contact</span>
<a href="#l3.15"></a><span id="l3.15"> # %S will be the card's display name</span>
<a href="#l3.16"></a><span id="l3.16"> newContactTitleWithDisplayName=New Contact for %S</span>
<a href="#l3.17"></a><span id="l3.17"> editContactTitle=Edit Contact</span>
<a href="#l3.18"></a><span id="l3.18"> # %S will be the card's display name</span>
<a href="#l3.19"></a><span id="l3.19"> editContactTitleWithDisplayName=Edit Contact for %S</span>
<a href="#l3.20"></a><span id="l3.20"> # don't translate vCard</span>
<a href="#l3.21"></a><span id="l3.21"> editVCardTitle=Edit vCard</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l4.1"></a><span id="l4.1" class="difflineminus">--- a/suite/mailnews/components/addrbook/content/abCardOverlay.js</span>
<a href="#l4.2"></a><span id="l4.2" class="difflineplus">+++ b/suite/mailnews/components/addrbook/content/abCardOverlay.js</span>
<a href="#l4.3"></a><span id="l4.3" class="difflineat">@@ -152,30 +152,46 @@ function OnLoadNewCard()</span>
<a href="#l4.4"></a><span id="l4.4">   GetCardValues(gEditCard.card, document);</span>
<a href="#l4.5"></a><span id="l4.5"> </span>
<a href="#l4.6"></a><span id="l4.6">   // FIX ME - looks like we need to focus on both the text field and the tab widget</span>
<a href="#l4.7"></a><span id="l4.7">   // probably need to do the same in the addressing widget</span>
<a href="#l4.8"></a><span id="l4.8"> </span>
<a href="#l4.9"></a><span id="l4.9">   // focus on first or last name based on the pref</span>
<a href="#l4.10"></a><span id="l4.10">   var focus = document.getElementById(gEditCard.displayLastNameFirst</span>
<a href="#l4.11"></a><span id="l4.11">                                       ? &quot;LastName&quot; : &quot;FirstName&quot;);</span>
<a href="#l4.12"></a><span id="l4.12" class="difflineminus">-  if ( focus ) {</span>
<a href="#l4.13"></a><span id="l4.13" class="difflineplus">+  if (focus) {</span>
<a href="#l4.14"></a><span id="l4.14">     // XXX Using the setTimeout hack until bug 103197 is fixed</span>
<a href="#l4.15"></a><span id="l4.15">     setTimeout( function(firstTextBox) { firstTextBox.focus(); }, 0, focus );</span>
<a href="#l4.16"></a><span id="l4.16">   }</span>
<a href="#l4.17"></a><span id="l4.17"> }</span>
<a href="#l4.18"></a><span id="l4.18"> </span>
<a href="#l4.19"></a><span id="l4.19" class="difflineplus">+/**</span>
<a href="#l4.20"></a><span id="l4.20" class="difflineplus">+ * Get the source directory containing the card we are editing.</span>
<a href="#l4.21"></a><span id="l4.21" class="difflineplus">+ */</span>
<a href="#l4.22"></a><span id="l4.22" class="difflineplus">+function getContainingDirectory() {</span>
<a href="#l4.23"></a><span id="l4.23" class="difflineplus">+  let directory = GetDirectoryFromURI(gEditCard.abURI);</span>
<a href="#l4.24"></a><span id="l4.24" class="difflineplus">+  // If the source directory is &quot;All Address Books&quot;, find the parent</span>
<a href="#l4.25"></a><span id="l4.25" class="difflineplus">+  // address book of the card being edited and reflect the changes in it.</span>
<a href="#l4.26"></a><span id="l4.26" class="difflineplus">+  if (directory.URI == kAllDirectoryRoot + &quot;?&quot;) {</span>
<a href="#l4.27"></a><span id="l4.27" class="difflineplus">+    let dirId =</span>
<a href="#l4.28"></a><span id="l4.28" class="difflineplus">+      gEditCard.card.directoryId</span>
<a href="#l4.29"></a><span id="l4.29" class="difflineplus">+                    .substring(0, gEditCard.card.directoryId.indexOf(&quot;&amp;&quot;));</span>
<a href="#l4.30"></a><span id="l4.30" class="difflineplus">+    directory = MailServices.ab.getDirectoryFromId(dirId);</span>
<a href="#l4.31"></a><span id="l4.31" class="difflineplus">+  }</span>
<a href="#l4.32"></a><span id="l4.32" class="difflineplus">+  return directory;</span>
<a href="#l4.33"></a><span id="l4.33" class="difflineplus">+}</span>
<a href="#l4.34"></a><span id="l4.34" class="difflineplus">+</span>
<a href="#l4.35"></a><span id="l4.35"> function EditCardOKButton()</span>
<a href="#l4.36"></a><span id="l4.36"> {</span>
<a href="#l4.37"></a><span id="l4.37">   if (!CheckCardRequiredDataPresence(document))</span>
<a href="#l4.38"></a><span id="l4.38">     return false;  // don't close window</span>
<a href="#l4.39"></a><span id="l4.39"> </span>
<a href="#l4.40"></a><span id="l4.40">   // See if this card is in any mailing list</span>
<a href="#l4.41"></a><span id="l4.41">   // if so then we need to update the addresslists of those mailing lists</span>
<a href="#l4.42"></a><span id="l4.42" class="difflineminus">-  var directory = GetDirectoryFromURI(gEditCard.abURI);</span>
<a href="#l4.43"></a><span id="l4.43" class="difflineplus">+  let directory = getContainingDirectory();</span>
<a href="#l4.44"></a><span id="l4.44"> </span>
<a href="#l4.45"></a><span id="l4.45">   // if the directory is a mailing list we need to search all the mailing lists</span>
<a href="#l4.46"></a><span id="l4.46">   // in the parent directory if the card exists.</span>
<a href="#l4.47"></a><span id="l4.47">   if (directory.isMailList) {</span>
<a href="#l4.48"></a><span id="l4.48">     var parentURI = GetParentDirectoryFromMailingListURI(gEditCard.abURI);</span>
<a href="#l4.49"></a><span id="l4.49">     directory = GetDirectoryFromURI(parentURI);</span>
<a href="#l4.50"></a><span id="l4.50">   }</span>
<a href="#l4.51"></a><span id="l4.51"> </span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l5.1"></a><span id="l5.1" class="difflineminus">--- a/suite/mailnews/components/addrbook/content/abCommon.js</span>
<a href="#l5.2"></a><span id="l5.2" class="difflineplus">+++ b/suite/mailnews/components/addrbook/content/abCommon.js</span>
<a href="#l5.3"></a><span id="l5.3" class="difflineat">@@ -6,16 +6,19 @@ var {Services} = ChromeUtils.import(&quot;res</span>
<a href="#l5.4"></a><span id="l5.4"> const {MailServices} = ChromeUtils.import(&quot;resource:///modules/MailServices.jsm&quot;);</span>
<a href="#l5.5"></a><span id="l5.5"> const {IOUtils} = ChromeUtils.import(&quot;resource:///modules/IOUtils.js&quot;);</span>
<a href="#l5.6"></a><span id="l5.6"> </span>
<a href="#l5.7"></a><span id="l5.7"> var gDirTree = null;</span>
<a href="#l5.8"></a><span id="l5.8"> var abList = null;</span>
<a href="#l5.9"></a><span id="l5.9"> var gAbResultsTree = null;</span>
<a href="#l5.10"></a><span id="l5.10"> var gAbView = null;</span>
<a href="#l5.11"></a><span id="l5.11"> var gAddressBookBundle;</span>
<a href="#l5.12"></a><span id="l5.12" class="difflineplus">+// A boolean variable determining whether AB column should be shown in AB</span>
<a href="#l5.13"></a><span id="l5.13" class="difflineplus">+// sidebar in compose window.</span>
<a href="#l5.14"></a><span id="l5.14" class="difflineplus">+var gShowAbColumnInComposeSidebar = false;</span>
<a href="#l5.15"></a><span id="l5.15"> </span>
<a href="#l5.16"></a><span id="l5.16"> const kDefaultSortColumn = &quot;GeneratedName&quot;;</span>
<a href="#l5.17"></a><span id="l5.17"> const kDefaultAscending = &quot;ascending&quot;;</span>
<a href="#l5.18"></a><span id="l5.18"> const kDefaultDescending = &quot;descending&quot;;</span>
<a href="#l5.19"></a><span id="l5.19"> // kDefaultYear will be used in birthday calculations when no year is given;</span>
<a href="#l5.20"></a><span id="l5.20"> // this is a leap year so that Feb 29th works.</span>
<a href="#l5.21"></a><span id="l5.21"> const kDefaultYear = nearestLeap(new Date().getFullYear());</span>
<a href="#l5.22"></a><span id="l5.22"> const kMaxYear = 9999;</span>
<a href="#l5.23"></a><span id="l5.23" class="difflineat">@@ -35,16 +38,17 @@ var DirPaneController =</span>
<a href="#l5.24"></a><span id="l5.24">     switch (command) {</span>
<a href="#l5.25"></a><span id="l5.25">       case &quot;cmd_selectAll&quot;:</span>
<a href="#l5.26"></a><span id="l5.26">       case &quot;cmd_delete&quot;:</span>
<a href="#l5.27"></a><span id="l5.27">       case &quot;button_delete&quot;:</span>
<a href="#l5.28"></a><span id="l5.28">       case &quot;cmd_properties&quot;:</span>
<a href="#l5.29"></a><span id="l5.29">       case &quot;cmd_printcard&quot;:</span>
<a href="#l5.30"></a><span id="l5.30">       case &quot;cmd_printcardpreview&quot;:</span>
<a href="#l5.31"></a><span id="l5.31">       case &quot;cmd_newlist&quot;:</span>
<a href="#l5.32"></a><span id="l5.32" class="difflineplus">+      case &quot;cmd_newCard&quot;:</span>
<a href="#l5.33"></a><span id="l5.33">         return true;</span>
<a href="#l5.34"></a><span id="l5.34">       default:</span>
<a href="#l5.35"></a><span id="l5.35">         return false;</span>
<a href="#l5.36"></a><span id="l5.36">     }</span>
<a href="#l5.37"></a><span id="l5.37">   },</span>
<a href="#l5.38"></a><span id="l5.38"> </span>
<a href="#l5.39"></a><span id="l5.39">   isCommandEnabled: function(command)</span>
<a href="#l5.40"></a><span id="l5.40">   {</span>
<a href="#l5.41"></a><span id="l5.41" class="difflineat">@@ -64,17 +68,18 @@ var DirPaneController =</span>
<a href="#l5.42"></a><span id="l5.42">         // Context-sensitive labels for Edit &gt; Delete menuitem.</span>
<a href="#l5.43"></a><span id="l5.43">         if (command == &quot;cmd_delete&quot;) {</span>
<a href="#l5.44"></a><span id="l5.44">           goSetMenuValue(command, selectedDir.isMailList ?</span>
<a href="#l5.45"></a><span id="l5.45">                                   &quot;valueList&quot; : &quot;valueAddressBook&quot;);</span>
<a href="#l5.46"></a><span id="l5.46">         }</span>
<a href="#l5.47"></a><span id="l5.47"> </span>
<a href="#l5.48"></a><span id="l5.48">         // If it's one of these special ABs, return false to disable deletion.</span>
<a href="#l5.49"></a><span id="l5.49">         if (selectedDirURI == kPersonalAddressbookURI ||</span>
<a href="#l5.50"></a><span id="l5.50" class="difflineminus">-            selectedDirURI == kCollectedAddressbookURI)</span>
<a href="#l5.51"></a><span id="l5.51" class="difflineplus">+            selectedDirURI == kCollectedAddressbookURI ||</span>
<a href="#l5.52"></a><span id="l5.52" class="difflineplus">+            selectedDirURI == (kAllDirectoryRoot + &quot;?&quot;))</span>
<a href="#l5.53"></a><span id="l5.53">           return false;</span>
<a href="#l5.54"></a><span id="l5.54"> </span>
<a href="#l5.55"></a><span id="l5.55">         // If the directory is a mailing list, and it is read-only,</span>
<a href="#l5.56"></a><span id="l5.56">         // return false to disable deletion.</span>
<a href="#l5.57"></a><span id="l5.57">         if (selectedDir.isMailList &amp;&amp; selectedDir.readOnly)</span>
<a href="#l5.58"></a><span id="l5.58">           return false;</span>
<a href="#l5.59"></a><span id="l5.59"> </span>
<a href="#l5.60"></a><span id="l5.60">         // If the selected directory is an ldap directory,</span>
<a href="#l5.61"></a><span id="l5.61" class="difflineat">@@ -97,16 +102,17 @@ var DirPaneController =</span>
<a href="#l5.62"></a><span id="l5.62">         return true;</span>
<a href="#l5.63"></a><span id="l5.63">       }</span>
<a href="#l5.64"></a><span id="l5.64">       case &quot;cmd_printcard&quot;:</span>
<a href="#l5.65"></a><span id="l5.65">       case &quot;cmd_printcardpreview&quot;:</span>
<a href="#l5.66"></a><span id="l5.66">         return (GetSelectedCardIndex() != -1);</span>
<a href="#l5.67"></a><span id="l5.67">       case &quot;cmd_properties&quot;:</span>
<a href="#l5.68"></a><span id="l5.68">         return (getSelectedDirectoryURI() != null);</span>
<a href="#l5.69"></a><span id="l5.69">       case &quot;cmd_newlist&quot;:</span>
<a href="#l5.70"></a><span id="l5.70" class="difflineplus">+      case &quot;cmd_newCard&quot;:</span>
<a href="#l5.71"></a><span id="l5.71">         return true;</span>
<a href="#l5.72"></a><span id="l5.72">       default:</span>
<a href="#l5.73"></a><span id="l5.73">         return false;</span>
<a href="#l5.74"></a><span id="l5.74">     }</span>
<a href="#l5.75"></a><span id="l5.75">   },</span>
<a href="#l5.76"></a><span id="l5.76"> </span>
<a href="#l5.77"></a><span id="l5.77">   doCommand: function(command)</span>
<a href="#l5.78"></a><span id="l5.78">   {</span>
<a href="#l5.79"></a><span id="l5.79" class="difflineat">@@ -122,16 +128,19 @@ var DirPaneController =</span>
<a href="#l5.80"></a><span id="l5.80">           AbDeleteSelectedDirectory();</span>
<a href="#l5.81"></a><span id="l5.81">         break;</span>
<a href="#l5.82"></a><span id="l5.82">       case &quot;cmd_properties&quot;:</span>
<a href="#l5.83"></a><span id="l5.83">         AbEditSelectedDirectory();</span>
<a href="#l5.84"></a><span id="l5.84">         break;</span>
<a href="#l5.85"></a><span id="l5.85">       case &quot;cmd_newlist&quot;:</span>
<a href="#l5.86"></a><span id="l5.86">         AbNewList();</span>
<a href="#l5.87"></a><span id="l5.87">         break;</span>
<a href="#l5.88"></a><span id="l5.88" class="difflineplus">+      case &quot;cmd_newCard&quot;:</span>
<a href="#l5.89"></a><span id="l5.89" class="difflineplus">+        AbNewCard();</span>
<a href="#l5.90"></a><span id="l5.90" class="difflineplus">+        break;</span>
<a href="#l5.91"></a><span id="l5.91">     }</span>
<a href="#l5.92"></a><span id="l5.92">   },</span>
<a href="#l5.93"></a><span id="l5.93"> </span>
<a href="#l5.94"></a><span id="l5.94">   onEvent: function(event)</span>
<a href="#l5.95"></a><span id="l5.95">   {</span>
<a href="#l5.96"></a><span id="l5.96">     // on blur events set the menu item texts back to the normal values</span>
<a href="#l5.97"></a><span id="l5.97">     if (event == &quot;blur&quot;)</span>
<a href="#l5.98"></a><span id="l5.98">       goSetMenuValue(&quot;cmd_delete&quot;, &quot;valueDefault&quot;);</span>
<a href="#l5.99"></a><span id="l5.99" class="difflineat">@@ -231,16 +240,22 @@ function AbDeleteDirectory(aURI)</span>
<a href="#l5.100"></a><span id="l5.100">   MailServices.ab.deleteAddressBook(aURI);</span>
<a href="#l5.101"></a><span id="l5.101"> }</span>
<a href="#l5.102"></a><span id="l5.102"> </span>
<a href="#l5.103"></a><span id="l5.103"> function InitCommonJS()</span>
<a href="#l5.104"></a><span id="l5.104"> {</span>
<a href="#l5.105"></a><span id="l5.105">   gDirTree = document.getElementById(&quot;dirTree&quot;);</span>
<a href="#l5.106"></a><span id="l5.106">   abList = document.getElementById(&quot;addressbookList&quot;);</span>
<a href="#l5.107"></a><span id="l5.107">   gAddressBookBundle = document.getElementById(&quot;bundle_addressBook&quot;);</span>
<a href="#l5.108"></a><span id="l5.108" class="difflineplus">+</span>
<a href="#l5.109"></a><span id="l5.109" class="difflineplus">+  // Make an entry for &quot;All Address Books&quot;.</span>
<a href="#l5.110"></a><span id="l5.110" class="difflineplus">+  if (abList) {</span>
<a href="#l5.111"></a><span id="l5.111" class="difflineplus">+    abList.insertItemAt(0, gAddressBookBundle.getString(&quot;allAddressBooks&quot;),</span>
<a href="#l5.112"></a><span id="l5.112" class="difflineplus">+                        kAllDirectoryRoot + &quot;?&quot;);</span>
<a href="#l5.113"></a><span id="l5.113" class="difflineplus">+  }</span>
<a href="#l5.114"></a><span id="l5.114"> }</span>
<a href="#l5.115"></a><span id="l5.115"> </span>
<a href="#l5.116"></a><span id="l5.116"> function UpgradeAddressBookResultsPaneUI(prefName)</span>
<a href="#l5.117"></a><span id="l5.117"> {</span>
<a href="#l5.118"></a><span id="l5.118">   // placeholder in case any new columns get added to the address book</span>
<a href="#l5.119"></a><span id="l5.119">   // var resultsPaneUIVersion = Services.prefs.getIntPref(prefName);</span>
<a href="#l5.120"></a><span id="l5.120"> }</span>
<a href="#l5.121"></a><span id="l5.121"> </span>
<a href="#l5.122"></a><span id="l5.122" class="difflineat">@@ -266,19 +281,41 @@ function AbDelete()</span>
<a href="#l5.123"></a><span id="l5.123">     if (types == kListsAndCards)</span>
<a href="#l5.124"></a><span id="l5.124">       confirmDeleteMessage = gAddressBookBundle.getString(&quot;confirmDeleteListsAndContacts&quot;);</span>
<a href="#l5.125"></a><span id="l5.125">     else if (types == kMultipleListsOnly)</span>
<a href="#l5.126"></a><span id="l5.126">       confirmDeleteMessage = gAddressBookBundle.getString(&quot;confirmDeleteMailingLists&quot;);</span>
<a href="#l5.127"></a><span id="l5.127">     else if (types == kSingleListOnly)</span>
<a href="#l5.128"></a><span id="l5.128">       confirmDeleteMessage = gAddressBookBundle.getString(&quot;confirmDeleteMailingList&quot;);</span>
<a href="#l5.129"></a><span id="l5.129">   }</span>
<a href="#l5.130"></a><span id="l5.130"> </span>
<a href="#l5.131"></a><span id="l5.131" class="difflineminus">-  if (confirmDeleteMessage &amp;&amp;</span>
<a href="#l5.132"></a><span id="l5.132" class="difflineminus">-      Services.prompt.confirm(window, null, confirmDeleteMessage))</span>
<a href="#l5.133"></a><span id="l5.133" class="difflineplus">+  if (!confirmDeleteMessage ||</span>
<a href="#l5.134"></a><span id="l5.134" class="difflineplus">+      !Services.prompt.confirm(window, null, confirmDeleteMessage)) {</span>
<a href="#l5.135"></a><span id="l5.135" class="difflineplus">+    return;</span>
<a href="#l5.136"></a><span id="l5.136" class="difflineplus">+  }</span>
<a href="#l5.137"></a><span id="l5.137" class="difflineplus">+</span>
<a href="#l5.138"></a><span id="l5.138" class="difflineplus">+  if (getSelectedDirectoryURI() == (kAllDirectoryRoot + &quot;?&quot;)) {</span>
<a href="#l5.139"></a><span id="l5.139" class="difflineplus">+    // Delete cards from &quot;All Address Books&quot; view.</span>
<a href="#l5.140"></a><span id="l5.140" class="difflineplus">+    let cards = GetSelectedAbCards();</span>
<a href="#l5.141"></a><span id="l5.141" class="difflineplus">+    for (let i = 0; i &lt; cards.length; i++) {</span>
<a href="#l5.142"></a><span id="l5.142" class="difflineplus">+      let dirId = cards[i].directoryId</span>
<a href="#l5.143"></a><span id="l5.143" class="difflineplus">+                          .substring(0, cards[i].directoryId.indexOf(&quot;&amp;&quot;));</span>
<a href="#l5.144"></a><span id="l5.144" class="difflineplus">+      let directory = MailServices.ab.getDirectoryFromId(dirId);</span>
<a href="#l5.145"></a><span id="l5.145" class="difflineplus">+</span>
<a href="#l5.146"></a><span id="l5.146" class="difflineplus">+      let cardArray =</span>
<a href="#l5.147"></a><span id="l5.147" class="difflineplus">+        Cc[&quot;@mozilla.org/array;1&quot;]</span>
<a href="#l5.148"></a><span id="l5.148" class="difflineplus">+          .createInstance(Ci.nsIMutableArray);</span>
<a href="#l5.149"></a><span id="l5.149" class="difflineplus">+      cardArray.appendElement(cards[i], false);</span>
<a href="#l5.150"></a><span id="l5.150" class="difflineplus">+      if (directory)</span>
<a href="#l5.151"></a><span id="l5.151" class="difflineplus">+        directory.deleteCards(cardArray);</span>
<a href="#l5.152"></a><span id="l5.152" class="difflineplus">+    }</span>
<a href="#l5.153"></a><span id="l5.153" class="difflineplus">+    SetAbView(kAllDirectoryRoot + &quot;?&quot;);</span>
<a href="#l5.154"></a><span id="l5.154" class="difflineplus">+  } else {</span>
<a href="#l5.155"></a><span id="l5.155" class="difflineplus">+    // Delete cards from address books or mailing lists.</span>
<a href="#l5.156"></a><span id="l5.156">     gAbView.deleteSelectedCards();</span>
<a href="#l5.157"></a><span id="l5.157" class="difflineplus">+  }</span>
<a href="#l5.158"></a><span id="l5.158"> }</span>
<a href="#l5.159"></a><span id="l5.159"> </span>
<a href="#l5.160"></a><span id="l5.160"> function AbNewCard()</span>
<a href="#l5.161"></a><span id="l5.161"> {</span>
<a href="#l5.162"></a><span id="l5.162">   goNewCardDialog(getSelectedDirectoryURI());</span>
<a href="#l5.163"></a><span id="l5.163"> }</span>
<a href="#l5.164"></a><span id="l5.164"> </span>
<a href="#l5.165"></a><span id="l5.165"> function AbEditCard(card)</span>
<a href="#l5.166"></a><span id="l5.166" class="difflineat">@@ -452,21 +489,26 @@ function DirPaneDoubleClick(event)</span>
<a href="#l5.167"></a><span id="l5.167">       gDirTree.view.selection.count == 1 &amp;&amp;</span>
<a href="#l5.168"></a><span id="l5.168">       getSelectedDirectory().isMailList) {</span>
<a href="#l5.169"></a><span id="l5.169">     AbEditSelectedDirectory();</span>
<a href="#l5.170"></a><span id="l5.170">   }</span>
<a href="#l5.171"></a><span id="l5.171"> }</span>
<a href="#l5.172"></a><span id="l5.172"> </span>
<a href="#l5.173"></a><span id="l5.173"> function DirPaneSelectionChange()</span>
<a href="#l5.174"></a><span id="l5.174"> {</span>
<a href="#l5.175"></a><span id="l5.175" class="difflineplus">+  let uri = getSelectedDirectoryURI();</span>
<a href="#l5.176"></a><span id="l5.176">   // clear out the search box when changing folders...</span>
<a href="#l5.177"></a><span id="l5.177">   onAbClearSearch(false);</span>
<a href="#l5.178"></a><span id="l5.178">   if (gDirectoryTreeView.selection &amp;&amp;</span>
<a href="#l5.179"></a><span id="l5.179">       gDirectoryTreeView.selection.count == 1) {</span>
<a href="#l5.180"></a><span id="l5.180" class="difflineminus">-    ChangeDirectoryByURI(getSelectedDirectoryURI());</span>
<a href="#l5.181"></a><span id="l5.181" class="difflineplus">+    ChangeDirectoryByURI(uri);</span>
<a href="#l5.182"></a><span id="l5.182" class="difflineplus">+    document.getElementById(&quot;localResultsOnlyMessage&quot;)</span>
<a href="#l5.183"></a><span id="l5.183" class="difflineplus">+            .setAttribute(&quot;hidden&quot;,</span>
<a href="#l5.184"></a><span id="l5.184" class="difflineplus">+                          !gDirectoryTreeView.hasRemoteAB ||</span>
<a href="#l5.185"></a><span id="l5.185" class="difflineplus">+                          uri != kAllDirectoryRoot + &quot;?&quot;);</span>
<a href="#l5.186"></a><span id="l5.186">   }</span>
<a href="#l5.187"></a><span id="l5.187"> }</span>
<a href="#l5.188"></a><span id="l5.188"> </span>
<a href="#l5.189"></a><span id="l5.189"> function ChangeDirectoryByURI(uri = kPersonalAddressbookURI)</span>
<a href="#l5.190"></a><span id="l5.190"> {</span>
<a href="#l5.191"></a><span id="l5.191">   SetAbView(uri);</span>
<a href="#l5.192"></a><span id="l5.192"> </span>
<a href="#l5.193"></a><span id="l5.193">   // Actively de-selecting if there are any pre-existing selections</span>
<a href="#l5.194"></a><span id="l5.194" class="difflineat">@@ -539,20 +581,20 @@ function InitViewSortByMenu()</span>
<a href="#l5.195"></a><span id="l5.195">     var sortDirection = kDefaultAscending;</span>
<a href="#l5.196"></a><span id="l5.196"> </span>
<a href="#l5.197"></a><span id="l5.197">     if (gAbView) {</span>
<a href="#l5.198"></a><span id="l5.198">       sortColumn = gAbView.sortColumn;</span>
<a href="#l5.199"></a><span id="l5.199">       sortDirection = gAbView.sortDirection;</span>
<a href="#l5.200"></a><span id="l5.200">     }</span>
<a href="#l5.201"></a><span id="l5.201"> </span>
<a href="#l5.202"></a><span id="l5.202">     // this approach is necessary to support generic columns that get overlayed.</span>
<a href="#l5.203"></a><span id="l5.203" class="difflineminus">-    var elements = document.getElementsByAttribute(&quot;name&quot;,&quot;sortas&quot;);</span>
<a href="#l5.204"></a><span id="l5.204" class="difflineminus">-    for (var i=0; i&lt;elements.length; i++) {</span>
<a href="#l5.205"></a><span id="l5.205" class="difflineminus">-      let cmd = elements[i].getAttribute(&quot;id&quot;);</span>
<a href="#l5.206"></a><span id="l5.206" class="difflineminus">-      let columnForCmd = cmd.split(&quot;cmd_SortBy&quot;)[1];</span>
<a href="#l5.207"></a><span id="l5.207" class="difflineplus">+    let elements = document.querySelectorAll('[name=&quot;sortas&quot;]');</span>
<a href="#l5.208"></a><span id="l5.208" class="difflineplus">+    for (let i = 0; i &lt; elements.length; i++) {</span>
<a href="#l5.209"></a><span id="l5.209" class="difflineplus">+      let cmd = elements[i].id;</span>
<a href="#l5.210"></a><span id="l5.210" class="difflineplus">+      let columnForCmd = cmd.substr(10); // everything right of cmd_SortBy</span>
<a href="#l5.211"></a><span id="l5.211">       setSortByMenuItemCheckState(cmd, (sortColumn == columnForCmd));</span>
<a href="#l5.212"></a><span id="l5.212">     }</span>
<a href="#l5.213"></a><span id="l5.213"> </span>
<a href="#l5.214"></a><span id="l5.214">     setSortByMenuItemCheckState(&quot;sortAscending&quot;, (sortDirection == kDefaultAscending));</span>
<a href="#l5.215"></a><span id="l5.215">     setSortByMenuItemCheckState(&quot;sortDescending&quot;, (sortDirection == kDefaultDescending));</span>
<a href="#l5.216"></a><span id="l5.216"> }</span>
<a href="#l5.217"></a><span id="l5.217"> </span>
<a href="#l5.218"></a><span id="l5.218"> function GenerateAddressFromCard(card)</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l6.1"></a><span id="l6.1" class="difflineminus">--- a/suite/mailnews/components/addrbook/content/abResultsPaneOverlay.xul</span>
<a href="#l6.2"></a><span id="l6.2" class="difflineplus">+++ b/suite/mailnews/components/addrbook/content/abResultsPaneOverlay.xul</span>
<a href="#l6.3"></a><span id="l6.3" class="difflineat">@@ -68,17 +68,21 @@</span>
<a href="#l6.4"></a><span id="l6.4">     &lt;splitter class=&quot;tree-splitter&quot;/&gt;</span>
<a href="#l6.5"></a><span id="l6.5">     &lt;treecol id=&quot;HomePhone&quot;</span>
<a href="#l6.6"></a><span id="l6.6">              persist=&quot;hidden ordinal width sortDirection&quot; flex=&quot;1&quot;</span>
<a href="#l6.7"></a><span id="l6.7">              label=&quot;&amp;HomePhone.label;&quot; hidden=&quot;true&quot;/&gt;</span>
<a href="#l6.8"></a><span id="l6.8">     &lt;splitter class=&quot;tree-splitter&quot;/&gt;</span>
<a href="#l6.9"></a><span id="l6.9">     &lt;treecol id=&quot;WorkPhone&quot;</span>
<a href="#l6.10"></a><span id="l6.10">              persist=&quot;hidden ordinal width sortDirection&quot; flex=&quot;1&quot;</span>
<a href="#l6.11"></a><span id="l6.11">              label=&quot;&amp;WorkPhone.label;&quot;/&gt;</span>
<a href="#l6.12"></a><span id="l6.12" class="difflineminus">-</span>
<a href="#l6.13"></a><span id="l6.13" class="difflineplus">+    &lt;splitter class=&quot;tree-splitter&quot;/&gt;</span>
<a href="#l6.14"></a><span id="l6.14" class="difflineplus">+    &lt;treecol id=&quot;addrbook&quot;</span>
<a href="#l6.15"></a><span id="l6.15" class="difflineplus">+             persist=&quot;hidden ordinal width sortDirection&quot; flex=&quot;1&quot;</span>
<a href="#l6.16"></a><span id="l6.16" class="difflineplus">+             hidden=&quot;true&quot;</span>
<a href="#l6.17"></a><span id="l6.17" class="difflineplus">+             label=&quot;&amp;Addrbook.label;&quot;/&gt;</span>
<a href="#l6.18"></a><span id="l6.18">     &lt;!-- LOCALIZATION NOTE: _PhoneticName may be enabled for Japanese builds. --&gt;</span>
<a href="#l6.19"></a><span id="l6.19">     &lt;!--</span>
<a href="#l6.20"></a><span id="l6.20">     &lt;splitter class=&quot;tree-splitter&quot;/&gt;</span>
<a href="#l6.21"></a><span id="l6.21">     &lt;treecol id=&quot;_PhoneticName&quot;</span>
<a href="#l6.22"></a><span id="l6.22">              persist=&quot;hidden ordinal width sortDirection&quot; flex=&quot;1&quot;</span>
<a href="#l6.23"></a><span id="l6.23">              label=&quot;&amp;_PhoneticName.label;&quot; hidden=&quot;true&quot;/&gt;</span>
<a href="#l6.24"></a><span id="l6.24">      --&gt;</span>
<a href="#l6.25"></a><span id="l6.25"> </span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l7.1"></a><span id="l7.1" class="difflineminus">--- a/suite/mailnews/components/addrbook/content/abSelectAddressesDialog.js</span>
<a href="#l7.2"></a><span id="l7.2" class="difflineplus">+++ b/suite/mailnews/components/addrbook/content/abSelectAddressesDialog.js</span>
<a href="#l7.3"></a><span id="l7.3" class="difflineat">@@ -380,9 +380,20 @@ function onEnterInSearchBar()</span>
<a href="#l7.4"></a><span id="l7.4"> function DirPaneSelectionChangeMenulist()</span>
<a href="#l7.5"></a><span id="l7.5"> {</span>
<a href="#l7.6"></a><span id="l7.6">   if (abList &amp;&amp; abList.selectedItem) {</span>
<a href="#l7.7"></a><span id="l7.7">     if (gSearchInput.value &amp;&amp; (gSearchInput.value != &quot;&quot;))</span>
<a href="#l7.8"></a><span id="l7.8">       onEnterInSearchBar();</span>
<a href="#l7.9"></a><span id="l7.9">     else</span>
<a href="#l7.10"></a><span id="l7.10">       ChangeDirectoryByURI(abList.value);</span>
<a href="#l7.11"></a><span id="l7.11">   }</span>
<a href="#l7.12"></a><span id="l7.12" class="difflineplus">+</span>
<a href="#l7.13"></a><span id="l7.13" class="difflineplus">+  // Hide the addressbook column if the selected addressbook isn't</span>
<a href="#l7.14"></a><span id="l7.14" class="difflineplus">+  // &quot;All address books&quot;. Since the column is redundant in all other cases.</span>
<a href="#l7.15"></a><span id="l7.15" class="difflineplus">+  let addrbookColumn = document.getElementById(&quot;addrbook&quot;);</span>
<a href="#l7.16"></a><span id="l7.16" class="difflineplus">+  if (abList.value.startsWith(kAllDirectoryRoot + &quot;?&quot;)) {</span>
<a href="#l7.17"></a><span id="l7.17" class="difflineplus">+    addrbookColumn.hidden = !gShowAbColumnInComposeSidebar;</span>
<a href="#l7.18"></a><span id="l7.18" class="difflineplus">+    addrbookColumn.removeAttribute(&quot;ignoreincolumnpicker&quot;);</span>
<a href="#l7.19"></a><span id="l7.19" class="difflineplus">+  } else {</span>
<a href="#l7.20"></a><span id="l7.20" class="difflineplus">+    addrbookColumn.hidden = true;</span>
<a href="#l7.21"></a><span id="l7.21" class="difflineplus">+    addrbookColumn.setAttribute(&quot;ignoreincolumnpicker&quot;, &quot;true&quot;);</span>
<a href="#l7.22"></a><span id="l7.22" class="difflineplus">+  }</span>
<a href="#l7.23"></a><span id="l7.23"> }</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l8.1"></a><span id="l8.1" class="difflineminus">--- a/suite/mailnews/components/addrbook/content/abTrees.js</span>
<a href="#l8.2"></a><span id="l8.2" class="difflineplus">+++ b/suite/mailnews/components/addrbook/content/abTrees.js</span>
<a href="#l8.3"></a><span id="l8.3" class="difflineat">@@ -4,16 +4,75 @@</span>
<a href="#l8.4"></a><span id="l8.4"> </span>
<a href="#l8.5"></a><span id="l8.5"> /**</span>
<a href="#l8.6"></a><span id="l8.6">  * This file contains our implementation for various addressbook trees.  It</span>
<a href="#l8.7"></a><span id="l8.7">  * depends on jsTreeView.js being loaded before this script is loaded.</span>
<a href="#l8.8"></a><span id="l8.8">  */</span>
<a href="#l8.9"></a><span id="l8.9"> </span>
<a href="#l8.10"></a><span id="l8.10"> const {IOUtils} = ChromeUtils.import(&quot;resource:///modules/IOUtils.js&quot;);</span>
<a href="#l8.11"></a><span id="l8.11"> </span>
<a href="#l8.12"></a><span id="l8.12" class="difflineplus">+// Tree Sort helper methods.</span>
<a href="#l8.13"></a><span id="l8.13" class="difflineplus">+var AB_ORDER = [&quot;aab&quot;, &quot;pab&quot;, &quot;mork&quot;, &quot;ldap&quot;, &quot;mapi+other&quot;, &quot;anyab&quot;, &quot;cab&quot;];</span>
<a href="#l8.14"></a><span id="l8.14" class="difflineplus">+</span>
<a href="#l8.15"></a><span id="l8.15" class="difflineplus">+function getDirectoryValue(aDir, aKey) {</span>
<a href="#l8.16"></a><span id="l8.16" class="difflineplus">+  if (aKey == &quot;ab_type&quot;) {</span>
<a href="#l8.17"></a><span id="l8.17" class="difflineplus">+    if (aDir._directory.URI == kAllDirectoryRoot + &quot;?&quot;)</span>
<a href="#l8.18"></a><span id="l8.18" class="difflineplus">+      return &quot;aab&quot;;</span>
<a href="#l8.19"></a><span id="l8.19" class="difflineplus">+    if (aDir._directory.URI == kPersonalAddressbookURI)</span>
<a href="#l8.20"></a><span id="l8.20" class="difflineplus">+      return &quot;pab&quot;;</span>
<a href="#l8.21"></a><span id="l8.21" class="difflineplus">+    if (aDir._directory.URI == kCollectedAddressbookURI)</span>
<a href="#l8.22"></a><span id="l8.22" class="difflineplus">+      return &quot;cab&quot;;</span>
<a href="#l8.23"></a><span id="l8.23" class="difflineplus">+    if (aDir._directory instanceof Ci.nsIAbMDBDirectory)</span>
<a href="#l8.24"></a><span id="l8.24" class="difflineplus">+      return &quot;mork&quot;;</span>
<a href="#l8.25"></a><span id="l8.25" class="difflineplus">+    if (aDir._directory instanceof Ci.nsIAbLDAPDirectory)</span>
<a href="#l8.26"></a><span id="l8.26" class="difflineplus">+      return &quot;ldap&quot;;</span>
<a href="#l8.27"></a><span id="l8.27" class="difflineplus">+</span>
<a href="#l8.28"></a><span id="l8.28" class="difflineplus">+    // If there is any other AB type.</span>
<a href="#l8.29"></a><span id="l8.29" class="difflineplus">+    return &quot;mapi+other&quot;;</span>
<a href="#l8.30"></a><span id="l8.30" class="difflineplus">+  } else if (aKey == &quot;ab_name&quot;) {</span>
<a href="#l8.31"></a><span id="l8.31" class="difflineplus">+    return aDir._directory.dirName;</span>
<a href="#l8.32"></a><span id="l8.32" class="difflineplus">+  }</span>
<a href="#l8.33"></a><span id="l8.33" class="difflineplus">+</span>
<a href="#l8.34"></a><span id="l8.34" class="difflineplus">+  // This should never happen.</span>
<a href="#l8.35"></a><span id="l8.35" class="difflineplus">+  return null;</span>
<a href="#l8.36"></a><span id="l8.36" class="difflineplus">+}</span>
<a href="#l8.37"></a><span id="l8.37" class="difflineplus">+</span>
<a href="#l8.38"></a><span id="l8.38" class="difflineplus">+function abNameCompare(a, b) {</span>
<a href="#l8.39"></a><span id="l8.39" class="difflineplus">+  return a.localeCompare(b);</span>
<a href="#l8.40"></a><span id="l8.40" class="difflineplus">+}</span>
<a href="#l8.41"></a><span id="l8.41" class="difflineplus">+</span>
<a href="#l8.42"></a><span id="l8.42" class="difflineplus">+function abTypeCompare(a, b) {</span>
<a href="#l8.43"></a><span id="l8.43" class="difflineplus">+  return (AB_ORDER.indexOf(a) - AB_ORDER.indexOf(b));</span>
<a href="#l8.44"></a><span id="l8.44" class="difflineplus">+}</span>
<a href="#l8.45"></a><span id="l8.45" class="difflineplus">+</span>
<a href="#l8.46"></a><span id="l8.46" class="difflineplus">+var SORT_PRIORITY = [&quot;ab_type&quot;, &quot;ab_name&quot;];</span>
<a href="#l8.47"></a><span id="l8.47" class="difflineplus">+var SORT_FUNCS = [abTypeCompare, abNameCompare];</span>
<a href="#l8.48"></a><span id="l8.48" class="difflineplus">+</span>
<a href="#l8.49"></a><span id="l8.49" class="difflineplus">+function abSort(a, b) {</span>
<a href="#l8.50"></a><span id="l8.50" class="difflineplus">+  for (let i = 0; i &lt; SORT_FUNCS.length; i++) {</span>
<a href="#l8.51"></a><span id="l8.51" class="difflineplus">+    let sortBy = SORT_PRIORITY[i];</span>
<a href="#l8.52"></a><span id="l8.52" class="difflineplus">+    let aValue = getDirectoryValue(a, sortBy);</span>
<a href="#l8.53"></a><span id="l8.53" class="difflineplus">+    let bValue = getDirectoryValue(b, sortBy);</span>
<a href="#l8.54"></a><span id="l8.54" class="difflineplus">+</span>
<a href="#l8.55"></a><span id="l8.55" class="difflineplus">+    if (!aValue &amp;&amp; !bValue)</span>
<a href="#l8.56"></a><span id="l8.56" class="difflineplus">+      return 0;</span>
<a href="#l8.57"></a><span id="l8.57" class="difflineplus">+    if (!aValue)</span>
<a href="#l8.58"></a><span id="l8.58" class="difflineplus">+      return -1;</span>
<a href="#l8.59"></a><span id="l8.59" class="difflineplus">+    if (!bValue)</span>
<a href="#l8.60"></a><span id="l8.60" class="difflineplus">+      return 1;</span>
<a href="#l8.61"></a><span id="l8.61" class="difflineplus">+    if (aValue != bValue) {</span>
<a href="#l8.62"></a><span id="l8.62" class="difflineplus">+      let result = SORT_FUNCS[i](aValue, bValue);</span>
<a href="#l8.63"></a><span id="l8.63" class="difflineplus">+</span>
<a href="#l8.64"></a><span id="l8.64" class="difflineplus">+      if (result != 0)</span>
<a href="#l8.65"></a><span id="l8.65" class="difflineplus">+        return result;</span>
<a href="#l8.66"></a><span id="l8.66" class="difflineplus">+    }</span>
<a href="#l8.67"></a><span id="l8.67" class="difflineplus">+  }</span>
<a href="#l8.68"></a><span id="l8.68" class="difflineplus">+  return 0;</span>
<a href="#l8.69"></a><span id="l8.69" class="difflineplus">+}</span>
<a href="#l8.70"></a><span id="l8.70" class="difflineplus">+</span>
<a href="#l8.71"></a><span id="l8.71"> /**</span>
<a href="#l8.72"></a><span id="l8.72">  * Each abDirTreeItem corresponds to one row in the tree view.</span>
<a href="#l8.73"></a><span id="l8.73">  */</span>
<a href="#l8.74"></a><span id="l8.74"> function abDirTreeItem(aDirectory)</span>
<a href="#l8.75"></a><span id="l8.75"> {</span>
<a href="#l8.76"></a><span id="l8.76">   this._directory = aDirectory;</span>
<a href="#l8.77"></a><span id="l8.77"> }</span>
<a href="#l8.78"></a><span id="l8.78"> </span>
<a href="#l8.79"></a><span id="l8.79" class="difflineat">@@ -42,32 +101,37 @@ abDirTreeItem.prototype =</span>
<a href="#l8.80"></a><span id="l8.80">   },</span>
<a href="#l8.81"></a><span id="l8.81"> </span>
<a href="#l8.82"></a><span id="l8.82">   _children: null,</span>
<a href="#l8.83"></a><span id="l8.83">   get children()</span>
<a href="#l8.84"></a><span id="l8.84">   {</span>
<a href="#l8.85"></a><span id="l8.85">     if (!this._children)</span>
<a href="#l8.86"></a><span id="l8.86">     {</span>
<a href="#l8.87"></a><span id="l8.87">       this._children = [];</span>
<a href="#l8.88"></a><span id="l8.88" class="difflineminus">-      var myEnum = this._directory.childNodes;</span>
<a href="#l8.89"></a><span id="l8.89" class="difflineplus">+      let myEnum;</span>
<a href="#l8.90"></a><span id="l8.90" class="difflineplus">+      if (this._directory.URI == (kAllDirectoryRoot + &quot;?&quot;))</span>
<a href="#l8.91"></a><span id="l8.91" class="difflineplus">+        myEnum = MailServices.ab.directories;</span>
<a href="#l8.92"></a><span id="l8.92" class="difflineplus">+      else</span>
<a href="#l8.93"></a><span id="l8.93" class="difflineplus">+        myEnum = this._directory.childNodes;</span>
<a href="#l8.94"></a><span id="l8.94" class="difflineplus">+</span>
<a href="#l8.95"></a><span id="l8.95">       while (myEnum.hasMoreElements())</span>
<a href="#l8.96"></a><span id="l8.96">       {</span>
<a href="#l8.97"></a><span id="l8.97">         var abItem = new abDirTreeItem(</span>
<a href="#l8.98"></a><span id="l8.98">           myEnum.getNext().QueryInterface(Ci.nsIAbDirectory));</span>
<a href="#l8.99"></a><span id="l8.99" class="difflineplus">+        if (gDirectoryTreeView&amp;&amp;</span>
<a href="#l8.100"></a><span id="l8.100" class="difflineplus">+            this.id == kAllDirectoryRoot + &quot;?&quot; &amp;&amp;</span>
<a href="#l8.101"></a><span id="l8.101" class="difflineplus">+            getDirectoryValue(abItem, &quot;ab_type&quot;) == &quot;ldap&quot;)</span>
<a href="#l8.102"></a><span id="l8.102" class="difflineplus">+          gDirectoryTreeView.hasRemoteAB = true;</span>
<a href="#l8.103"></a><span id="l8.103" class="difflineplus">+</span>
<a href="#l8.104"></a><span id="l8.104">         abItem._level = this._level + 1;</span>
<a href="#l8.105"></a><span id="l8.105">         abItem._parent = this;</span>
<a href="#l8.106"></a><span id="l8.106">         this._children.push(abItem);</span>
<a href="#l8.107"></a><span id="l8.107">       }</span>
<a href="#l8.108"></a><span id="l8.108"> </span>
<a href="#l8.109"></a><span id="l8.109" class="difflineminus">-      // We sort children based on their names.</span>
<a href="#l8.110"></a><span id="l8.110" class="difflineminus">-      function nameSort(a, b)</span>
<a href="#l8.111"></a><span id="l8.111" class="difflineminus">-      {</span>
<a href="#l8.112"></a><span id="l8.112" class="difflineminus">-        return a._directory.dirName.localeCompare(b._directory.dirName);</span>
<a href="#l8.113"></a><span id="l8.113" class="difflineminus">-      }</span>
<a href="#l8.114"></a><span id="l8.114" class="difflineminus">-      this._children.sort(nameSort);</span>
<a href="#l8.115"></a><span id="l8.115" class="difflineplus">+      this._children.sort(abSort);</span>
<a href="#l8.116"></a><span id="l8.116">     }</span>
<a href="#l8.117"></a><span id="l8.117">     return this._children;</span>
<a href="#l8.118"></a><span id="l8.118">   },</span>
<a href="#l8.119"></a><span id="l8.119"> </span>
<a href="#l8.120"></a><span id="l8.120">   getProperties: function atv_getProps()</span>
<a href="#l8.121"></a><span id="l8.121">   {</span>
<a href="#l8.122"></a><span id="l8.122">     var properties = []</span>
<a href="#l8.123"></a><span id="l8.123">     if (this._directory.isMailList)</span>
<a href="#l8.124"></a><span id="l8.124" class="difflineat">@@ -83,16 +147,18 @@ abDirTreeItem.prototype =</span>
<a href="#l8.125"></a><span id="l8.125"> /**</span>
<a href="#l8.126"></a><span id="l8.126">  * Our actual implementation of nsITreeView.</span>
<a href="#l8.127"></a><span id="l8.127">  */</span>
<a href="#l8.128"></a><span id="l8.128"> function directoryTreeView() {}</span>
<a href="#l8.129"></a><span id="l8.129"> directoryTreeView.prototype =</span>
<a href="#l8.130"></a><span id="l8.130"> {</span>
<a href="#l8.131"></a><span id="l8.131">   __proto__: new PROTO_TREE_VIEW(),</span>
<a href="#l8.132"></a><span id="l8.132"> </span>
<a href="#l8.133"></a><span id="l8.133" class="difflineplus">+  hasRemoteAB: false,</span>
<a href="#l8.134"></a><span id="l8.134" class="difflineplus">+</span>
<a href="#l8.135"></a><span id="l8.135">   init: function dtv_init(aTree, aJSONFile)</span>
<a href="#l8.136"></a><span id="l8.136">   {</span>
<a href="#l8.137"></a><span id="l8.137">     if (aJSONFile) {</span>
<a href="#l8.138"></a><span id="l8.138">       // Parse our persistent-open-state json file</span>
<a href="#l8.139"></a><span id="l8.139">       let data = IOUtils.loadFileToString(aJSONFile);</span>
<a href="#l8.140"></a><span id="l8.140">       if (data) {</span>
<a href="#l8.141"></a><span id="l8.141">         this._persistOpenMap = JSON.parse(data);</span>
<a href="#l8.142"></a><span id="l8.142">       }</span>
<a href="#l8.143"></a><span id="l8.143" class="difflineat">@@ -149,88 +215,36 @@ directoryTreeView.prototype =</span>
<a href="#l8.144"></a><span id="l8.144">   /**</span>
<a href="#l8.145"></a><span id="l8.145">    * NOTE: This function will result in indeterminate rows being selected.</span>
<a href="#l8.146"></a><span id="l8.146">    *       Callers should take care to re-select a desired row after calling</span>
<a href="#l8.147"></a><span id="l8.147">    *       this function.</span>
<a href="#l8.148"></a><span id="l8.148">    */</span>
<a href="#l8.149"></a><span id="l8.149">   _rebuild: function dtv__rebuild() {</span>
<a href="#l8.150"></a><span id="l8.150">     this._rowMap = [];</span>
<a href="#l8.151"></a><span id="l8.151"> </span>
<a href="#l8.152"></a><span id="l8.152" class="difflineminus">-    var dirEnum = MailServices.ab.directories;</span>
<a href="#l8.153"></a><span id="l8.153" class="difflineminus">-    while (dirEnum.hasMoreElements())</span>
<a href="#l8.154"></a><span id="l8.154" class="difflineminus">-      this._rowMap.push(new abDirTreeItem(</span>
<a href="#l8.155"></a><span id="l8.155" class="difflineminus">-        dirEnum.getNext().QueryInterface(Ci.nsIAbDirectory)));</span>
<a href="#l8.156"></a><span id="l8.156" class="difflineplus">+    // Make an entry for All Address Books.</span>
<a href="#l8.157"></a><span id="l8.157" class="difflineplus">+    let rootAB = MailServices.ab.getDirectory(kAllDirectoryRoot + &quot;?&quot;);</span>
<a href="#l8.158"></a><span id="l8.158" class="difflineplus">+    rootAB.dirName = gAddressBookBundle.getString(&quot;allAddressBooks&quot;);</span>
<a href="#l8.159"></a><span id="l8.159" class="difflineplus">+    this._rowMap.push(new abDirTreeItem(rootAB));</span>
<a href="#l8.160"></a><span id="l8.160"> </span>
<a href="#l8.161"></a><span id="l8.161">     // Sort our addressbooks now.</span>
<a href="#l8.162"></a><span id="l8.162" class="difflineminus">-</span>
<a href="#l8.163"></a><span id="l8.163" class="difflineminus">-    const AB_ORDER = [&quot;pab&quot;, &quot;mork&quot;, &quot;ldap&quot;, &quot;mapi+other&quot;, &quot;cab&quot;];</span>
<a href="#l8.164"></a><span id="l8.164" class="difflineminus">-</span>
<a href="#l8.165"></a><span id="l8.165" class="difflineminus">-    function getDirectoryValue(aDir, aKey)</span>
<a href="#l8.166"></a><span id="l8.166" class="difflineminus">-    {</span>
<a href="#l8.167"></a><span id="l8.167" class="difflineminus">-      if (aKey == &quot;ab_type&quot;)</span>
<a href="#l8.168"></a><span id="l8.168" class="difflineminus">-      {</span>
<a href="#l8.169"></a><span id="l8.169" class="difflineminus">-        if (aDir._directory.URI == kPersonalAddressbookURI)</span>
<a href="#l8.170"></a><span id="l8.170" class="difflineminus">-          return &quot;pab&quot;;</span>
<a href="#l8.171"></a><span id="l8.171" class="difflineminus">-        if (aDir._directory.URI == kCollectedAddressbookURI)</span>
<a href="#l8.172"></a><span id="l8.172" class="difflineminus">-          return &quot;cab&quot;;</span>
<a href="#l8.173"></a><span id="l8.173" class="difflineminus">-        if (aDir._directory instanceof Ci.nsIAbMDBDirectory)</span>
<a href="#l8.174"></a><span id="l8.174" class="difflineminus">-          return &quot;mork&quot;;</span>
<a href="#l8.175"></a><span id="l8.175" class="difflineminus">-        if (&quot;nsIAbLDAPDirectory&quot; in Ci &amp;&amp;</span>
<a href="#l8.176"></a><span id="l8.176" class="difflineminus">-            aDir._directory instanceof Ci.nsIAbLDAPDirectory)</span>
<a href="#l8.177"></a><span id="l8.177" class="difflineminus">-          return &quot;ldap&quot;;</span>
<a href="#l8.178"></a><span id="l8.178" class="difflineminus">-        return &quot;mapi+other&quot;;</span>
<a href="#l8.179"></a><span id="l8.179" class="difflineminus">-      }</span>
<a href="#l8.180"></a><span id="l8.180" class="difflineminus">-      else if (aKey == &quot;ab_name&quot;)</span>
<a href="#l8.181"></a><span id="l8.181" class="difflineminus">-      {</span>
<a href="#l8.182"></a><span id="l8.182" class="difflineminus">-        return aDir._directory.dirName;</span>
<a href="#l8.183"></a><span id="l8.183" class="difflineminus">-      }</span>
<a href="#l8.184"></a><span id="l8.184" class="difflineminus">-    }</span>
<a href="#l8.185"></a><span id="l8.185" class="difflineminus">-</span>
<a href="#l8.186"></a><span id="l8.186" class="difflineminus">-    function abNameCompare(a, b)</span>
<a href="#l8.187"></a><span id="l8.187" class="difflineminus">-    {</span>
<a href="#l8.188"></a><span id="l8.188" class="difflineminus">-      return a.localeCompare(b);</span>
<a href="#l8.189"></a><span id="l8.189" class="difflineminus">-    }</span>
<a href="#l8.190"></a><span id="l8.190" class="difflineminus">-</span>
<a href="#l8.191"></a><span id="l8.191" class="difflineminus">-    function abTypeCompare(a, b)</span>
<a href="#l8.192"></a><span id="l8.192" class="difflineminus">-    {</span>
<a href="#l8.193"></a><span id="l8.193" class="difflineminus">-      return (AB_ORDER.indexOf(a) - AB_ORDER.indexOf(b));</span>
<a href="#l8.194"></a><span id="l8.194" class="difflineminus">-    }</span>
<a href="#l8.195"></a><span id="l8.195" class="difflineminus">-</span>
<a href="#l8.196"></a><span id="l8.196" class="difflineminus">-    const SORT_PRIORITY = [&quot;ab_type&quot;, &quot;ab_name&quot;];</span>
<a href="#l8.197"></a><span id="l8.197" class="difflineminus">-    const SORT_FUNCS = [abTypeCompare, abNameCompare];</span>
<a href="#l8.198"></a><span id="l8.198" class="difflineminus">-</span>
<a href="#l8.199"></a><span id="l8.199" class="difflineminus">-    function abSort(a, b)</span>
<a href="#l8.200"></a><span id="l8.200" class="difflineminus">-    {</span>
<a href="#l8.201"></a><span id="l8.201" class="difflineminus">-      for (let i = 0; i &lt; SORT_FUNCS.length; i++)</span>
<a href="#l8.202"></a><span id="l8.202" class="difflineminus">-      {</span>
<a href="#l8.203"></a><span id="l8.203" class="difflineminus">-        let sortBy = SORT_PRIORITY[i];</span>
<a href="#l8.204"></a><span id="l8.204" class="difflineminus">-        let aValue = getDirectoryValue(a, sortBy);</span>
<a href="#l8.205"></a><span id="l8.205" class="difflineminus">-        let bValue = getDirectoryValue(b, sortBy);</span>
<a href="#l8.206"></a><span id="l8.206" class="difflineminus">-</span>
<a href="#l8.207"></a><span id="l8.207" class="difflineminus">-        if (!aValue &amp;&amp; !bValue)</span>
<a href="#l8.208"></a><span id="l8.208" class="difflineminus">-          continue;</span>
<a href="#l8.209"></a><span id="l8.209" class="difflineminus">-        if (!aValue)</span>
<a href="#l8.210"></a><span id="l8.210" class="difflineminus">-          return -1;</span>
<a href="#l8.211"></a><span id="l8.211" class="difflineminus">-        if (!bValue)</span>
<a href="#l8.212"></a><span id="l8.212" class="difflineminus">-          return 1;</span>
<a href="#l8.213"></a><span id="l8.213" class="difflineminus">-        if (aValue != bValue)</span>
<a href="#l8.214"></a><span id="l8.214" class="difflineminus">-        {</span>
<a href="#l8.215"></a><span id="l8.215" class="difflineminus">-          let result = SORT_FUNCS[i](aValue, bValue);</span>
<a href="#l8.216"></a><span id="l8.216" class="difflineminus">-          if (result != 0)</span>
<a href="#l8.217"></a><span id="l8.217" class="difflineminus">-            return result;</span>
<a href="#l8.218"></a><span id="l8.218" class="difflineminus">-        }</span>
<a href="#l8.219"></a><span id="l8.219" class="difflineminus">-      }</span>
<a href="#l8.220"></a><span id="l8.220" class="difflineminus">-      return 0;</span>
<a href="#l8.221"></a><span id="l8.221" class="difflineminus">-    }</span>
<a href="#l8.222"></a><span id="l8.222" class="difflineminus">-</span>
<a href="#l8.223"></a><span id="l8.223">     this._rowMap.sort(abSort);</span>
<a href="#l8.224"></a><span id="l8.224"> </span>
<a href="#l8.225"></a><span id="l8.225">     this._restoreOpenStates();</span>
<a href="#l8.226"></a><span id="l8.226">   },</span>
<a href="#l8.227"></a><span id="l8.227"> </span>
<a href="#l8.228"></a><span id="l8.228" class="difflineplus">+  getIndexForId: function(aId) {</span>
<a href="#l8.229"></a><span id="l8.229" class="difflineplus">+    for (let i = 0; i &lt; this._rowMap.length; i++) {</span>
<a href="#l8.230"></a><span id="l8.230" class="difflineplus">+      if (this._rowMap[i].id == aId)</span>
<a href="#l8.231"></a><span id="l8.231" class="difflineplus">+        return i;</span>
<a href="#l8.232"></a><span id="l8.232" class="difflineplus">+    }</span>
<a href="#l8.233"></a><span id="l8.233" class="difflineplus">+</span>
<a href="#l8.234"></a><span id="l8.234" class="difflineplus">+    return -1;</span>
<a href="#l8.235"></a><span id="l8.235" class="difflineplus">+  },</span>
<a href="#l8.236"></a><span id="l8.236" class="difflineplus">+</span>
<a href="#l8.237"></a><span id="l8.237">   // nsIAbListener interfaces</span>
<a href="#l8.238"></a><span id="l8.238">   onItemAdded: function dtv_onItemAdded(aParent, aItem)</span>
<a href="#l8.239"></a><span id="l8.239">   {</span>
<a href="#l8.240"></a><span id="l8.240">     if (!(aItem instanceof Ci.nsIAbDirectory))</span>
<a href="#l8.241"></a><span id="l8.241">       return;</span>
<a href="#l8.242"></a><span id="l8.242"> </span>
<a href="#l8.243"></a><span id="l8.243">     var oldCount = this._rowMap.length;</span>
<a href="#l8.244"></a><span id="l8.244">     var tree = this._tree;</span>
<a href="#l8.245"></a><span id="l8.245" class="difflineat">@@ -257,16 +271,25 @@ directoryTreeView.prototype =</span>
<a href="#l8.246"></a><span id="l8.246">     var tree = this._tree;</span>
<a href="#l8.247"></a><span id="l8.247">     this._tree = null;</span>
<a href="#l8.248"></a><span id="l8.248">     this._rebuild();</span>
<a href="#l8.249"></a><span id="l8.249">     if (!tree)</span>
<a href="#l8.250"></a><span id="l8.250">       return;</span>
<a href="#l8.251"></a><span id="l8.251"> </span>
<a href="#l8.252"></a><span id="l8.252">     this._tree = tree;</span>
<a href="#l8.253"></a><span id="l8.253">     tree.rowCountChanged(itemIndex, this._rowMap.length - oldCount);</span>
<a href="#l8.254"></a><span id="l8.254" class="difflineplus">+</span>
<a href="#l8.255"></a><span id="l8.255" class="difflineplus">+    // This does not currently work, see Bug 1323563.</span>
<a href="#l8.256"></a><span id="l8.256" class="difflineplus">+    // If we're deleting a top-level address-book, just select the first book.</span>
<a href="#l8.257"></a><span id="l8.257" class="difflineplus">+    // if (aParent.URI == kAllDirectoryRoot ||</span>
<a href="#l8.258"></a><span id="l8.258" class="difflineplus">+    //     aParent.URI == kAllDirectoryRoot + &quot;?&quot;) {</span>
<a href="#l8.259"></a><span id="l8.259" class="difflineplus">+    //   this.selection.select(0);</span>
<a href="#l8.260"></a><span id="l8.260" class="difflineplus">+    //   return;</span>
<a href="#l8.261"></a><span id="l8.261" class="difflineplus">+    // }</span>
<a href="#l8.262"></a><span id="l8.262" class="difflineplus">+</span>
<a href="#l8.263"></a><span id="l8.263">     var parentIndex = this.getIndexOfDirectory(aParent);</span>
<a href="#l8.264"></a><span id="l8.264">     if (parentIndex &gt; -1)</span>
<a href="#l8.265"></a><span id="l8.265">       tree.invalidateRow(parentIndex);</span>
<a href="#l8.266"></a><span id="l8.266"> </span>
<a href="#l8.267"></a><span id="l8.267">     if (!this.selection.count)</span>
<a href="#l8.268"></a><span id="l8.268">     {</span>
<a href="#l8.269"></a><span id="l8.269">       // The previously selected item was a member of the deleted subtree.</span>
<a href="#l8.270"></a><span id="l8.270">       // Select the parent of the subtree.</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l9.1"></a><span id="l9.1" class="difflineminus">--- a/suite/mailnews/components/addrbook/content/addressbook-panel.js</span>
<a href="#l9.2"></a><span id="l9.2" class="difflineplus">+++ b/suite/mailnews/components/addrbook/content/addressbook-panel.js</span>
<a href="#l9.3"></a><span id="l9.3" class="difflineat">@@ -5,16 +5,18 @@</span>
<a href="#l9.4"></a><span id="l9.4"> var gIsMsgCompose = false;</span>
<a href="#l9.5"></a><span id="l9.5"> </span>
<a href="#l9.6"></a><span id="l9.6"> function GetAbViewListener()</span>
<a href="#l9.7"></a><span id="l9.7"> {</span>
<a href="#l9.8"></a><span id="l9.8">   // the ab panel doesn't care if the total changes, or if the selection changes</span>
<a href="#l9.9"></a><span id="l9.9">   return null;</span>
<a href="#l9.10"></a><span id="l9.10"> }</span>
<a href="#l9.11"></a><span id="l9.11"> </span>
<a href="#l9.12"></a><span id="l9.12" class="difflineplus">+var mutationObs = null;</span>
<a href="#l9.13"></a><span id="l9.13" class="difflineplus">+</span>
<a href="#l9.14"></a><span id="l9.14"> function AbPanelLoad()</span>
<a href="#l9.15"></a><span id="l9.15"> {</span>
<a href="#l9.16"></a><span id="l9.16">   InitCommonJS();</span>
<a href="#l9.17"></a><span id="l9.17"> </span>
<a href="#l9.18"></a><span id="l9.18">   UpgradeAddressBookResultsPaneUI(&quot;mailnews.ui.addressbook_panel_results.version&quot;);</span>
<a href="#l9.19"></a><span id="l9.19"> </span>
<a href="#l9.20"></a><span id="l9.20">   var abPopup = document.getElementById('addressbookList');</span>
<a href="#l9.21"></a><span id="l9.21"> </span>
<a href="#l9.22"></a><span id="l9.22" class="difflineat">@@ -23,31 +25,49 @@ function AbPanelLoad()</span>
<a href="#l9.23"></a><span id="l9.23">   var temp = abPopup.value;</span>
<a href="#l9.24"></a><span id="l9.24">   abPopup.selectedItem = null;</span>
<a href="#l9.25"></a><span id="l9.25">   abPopup.value = temp;</span>
<a href="#l9.26"></a><span id="l9.26">   if (!abPopup.selectedItem)</span>
<a href="#l9.27"></a><span id="l9.27">     abPopup.selectedIndex = 0;</span>
<a href="#l9.28"></a><span id="l9.28"> </span>
<a href="#l9.29"></a><span id="l9.29">   ChangeDirectoryByURI(abPopup.value);</span>
<a href="#l9.30"></a><span id="l9.30"> </span>
<a href="#l9.31"></a><span id="l9.31" class="difflineplus">+  mutationObs = new MutationObserver(function(aMutations) {</span>
<a href="#l9.32"></a><span id="l9.32" class="difflineplus">+    aMutations.forEach(function(mutation) {</span>
<a href="#l9.33"></a><span id="l9.33" class="difflineplus">+      if (getSelectedDirectoryURI() == (kAllDirectoryRoot + &quot;?&quot;) &amp;&amp;</span>
<a href="#l9.34"></a><span id="l9.34" class="difflineplus">+          mutation.type == &quot;attributes&quot; &amp;&amp;</span>
<a href="#l9.35"></a><span id="l9.35" class="difflineplus">+          mutation.attributeName == &quot;hidden&quot;) {</span>
<a href="#l9.36"></a><span id="l9.36" class="difflineplus">+        let curState = document.getElementById(&quot;addrbook&quot;).hidden;</span>
<a href="#l9.37"></a><span id="l9.37" class="difflineplus">+        gShowAbColumnInComposeSidebar = !curState;</span>
<a href="#l9.38"></a><span id="l9.38" class="difflineplus">+      }</span>
<a href="#l9.39"></a><span id="l9.39" class="difflineplus">+    });</span>
<a href="#l9.40"></a><span id="l9.40" class="difflineplus">+  });</span>
<a href="#l9.41"></a><span id="l9.41" class="difflineplus">+</span>
<a href="#l9.42"></a><span id="l9.42" class="difflineplus">+  document.getElementById(&quot;addrbook&quot;).hidden = !gShowAbColumnInComposeSidebar;</span>
<a href="#l9.43"></a><span id="l9.43" class="difflineplus">+</span>
<a href="#l9.44"></a><span id="l9.44" class="difflineplus">+  mutationObs.observe(document.getElementById(&quot;addrbook&quot;),</span>
<a href="#l9.45"></a><span id="l9.45" class="difflineplus">+                      { attributes: true, childList: true });</span>
<a href="#l9.46"></a><span id="l9.46" class="difflineplus">+</span>
<a href="#l9.47"></a><span id="l9.47">   gSearchInput = document.getElementById(&quot;searchInput&quot;);</span>
<a href="#l9.48"></a><span id="l9.48"> </span>
<a href="#l9.49"></a><span id="l9.49">   // for the compose window we want to show To, Cc, Bcc and a separator</span>
<a href="#l9.50"></a><span id="l9.50">   // for all other windows we want to show Compose Mail To</span>
<a href="#l9.51"></a><span id="l9.51">   var popup = document.getElementById(&quot;composeMail&quot;);</span>
<a href="#l9.52"></a><span id="l9.52">   gIsMsgCompose = parent.document</span>
<a href="#l9.53"></a><span id="l9.53">                         .documentElement</span>
<a href="#l9.54"></a><span id="l9.54">                         .getAttribute(&quot;windowtype&quot;) == &quot;msgcompose&quot;;</span>
<a href="#l9.55"></a><span id="l9.55">   for (var i = 0; i &lt; 4; i++)</span>
<a href="#l9.56"></a><span id="l9.56">     popup.childNodes[i].hidden = !gIsMsgCompose;</span>
<a href="#l9.57"></a><span id="l9.57">   popup.childNodes[4].hidden = gIsMsgCompose;</span>
<a href="#l9.58"></a><span id="l9.58"> }</span>
<a href="#l9.59"></a><span id="l9.59"> </span>
<a href="#l9.60"></a><span id="l9.60"> function AbPanelUnload()</span>
<a href="#l9.61"></a><span id="l9.61"> {</span>
<a href="#l9.62"></a><span id="l9.62" class="difflineplus">+  mutationObs.disconnect();</span>
<a href="#l9.63"></a><span id="l9.63" class="difflineplus">+</span>
<a href="#l9.64"></a><span id="l9.64">   CloseAbView();</span>
<a href="#l9.65"></a><span id="l9.65"> }</span>
<a href="#l9.66"></a><span id="l9.66"> </span>
<a href="#l9.67"></a><span id="l9.67"> function AbPanelAdd(addrtype)</span>
<a href="#l9.68"></a><span id="l9.68"> {</span>
<a href="#l9.69"></a><span id="l9.69">   var cards = GetSelectedAbCards();</span>
<a href="#l9.70"></a><span id="l9.70">   var count = cards.length;</span>
<a href="#l9.71"></a><span id="l9.71"> </span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l10.1"></a><span id="l10.1" class="difflineminus">--- a/suite/mailnews/components/addrbook/content/addressbook-panel.xul</span>
<a href="#l10.2"></a><span id="l10.2" class="difflineplus">+++ b/suite/mailnews/components/addrbook/content/addressbook-panel.xul</span>
<a href="#l10.3"></a><span id="l10.3" class="difflineat">@@ -76,16 +76,20 @@</span>
<a href="#l10.4"></a><span id="l10.4"> </span>
<a href="#l10.5"></a><span id="l10.5">     &lt;tree id=&quot;abResultsTree&quot; flex=&quot;1&quot; context=&quot;composeMail&quot; onclick=&quot;AbResultsPaneOnClick(event);&quot; class=&quot;plain&quot;</span>
<a href="#l10.6"></a><span id="l10.6">           sortCol=&quot;GeneratedName&quot; persist=&quot;sortCol&quot;&gt;</span>
<a href="#l10.7"></a><span id="l10.7">   &lt;treecols&gt;</span>
<a href="#l10.8"></a><span id="l10.8">     &lt;!-- these column ids must match up to the mork column names, see nsIAddrDatabase.idl --&gt;</span>
<a href="#l10.9"></a><span id="l10.9">     &lt;treecol id=&quot;GeneratedName&quot;</span>
<a href="#l10.10"></a><span id="l10.10">           persist=&quot;hidden ordinal width sortDirection&quot; flex=&quot;1&quot; label=&quot;&amp;GeneratedName.label;&quot; primary=&quot;true&quot;/&gt;</span>
<a href="#l10.11"></a><span id="l10.11">     &lt;splitter class=&quot;tree-splitter&quot;/&gt;</span>
<a href="#l10.12"></a><span id="l10.12" class="difflineplus">+    &lt;treecol id=&quot;addrbook&quot;</span>
<a href="#l10.13"></a><span id="l10.13" class="difflineplus">+             persist=&quot;hidden ordinal width sortDirection&quot; hidden=&quot;true&quot;</span>
<a href="#l10.14"></a><span id="l10.14" class="difflineplus">+             flex=&quot;1&quot; label=&quot;&amp;Addrbook.label;&quot;/&gt;</span>
<a href="#l10.15"></a><span id="l10.15" class="difflineplus">+    &lt;splitter class=&quot;tree-splitter&quot;/&gt;</span>
<a href="#l10.16"></a><span id="l10.16">     &lt;treecol id=&quot;PrimaryEmail&quot;</span>
<a href="#l10.17"></a><span id="l10.17">           persist=&quot;hidden ordinal width sortDirection&quot;</span>
<a href="#l10.18"></a><span id="l10.18">       hiddenbydefault=&quot;true&quot;</span>
<a href="#l10.19"></a><span id="l10.19">       flex=&quot;1&quot; label=&quot;&amp;PrimaryEmail.label;&quot;/&gt;</span>
<a href="#l10.20"></a><span id="l10.20">   &lt;/treecols&gt;</span>
<a href="#l10.21"></a><span id="l10.21">   &lt;treechildren ondragstart=&quot;nsDragAndDrop.startDrag(event, abResultsPaneObserver);&quot;/&gt;</span>
<a href="#l10.22"></a><span id="l10.22"> &lt;/tree&gt;</span>
<a href="#l10.23"></a><span id="l10.23"> </span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l11.1"></a><span id="l11.1" class="difflineminus">--- a/suite/mailnews/components/addrbook/content/addressbook.js</span>
<a href="#l11.2"></a><span id="l11.2" class="difflineplus">+++ b/suite/mailnews/components/addrbook/content/addressbook.js</span>
<a href="#l11.3"></a><span id="l11.3" class="difflineat">@@ -121,17 +121,16 @@ function GetCurrentPrefs()</span>
<a href="#l11.4"></a><span id="l11.4">     menuitem.setAttribute('checked', 'true');</span>
<a href="#l11.5"></a><span id="l11.5"> </span>
<a href="#l11.6"></a><span id="l11.6">   // show phonetic fields if indicated by the pref</span>
<a href="#l11.7"></a><span id="l11.7">   if (GetLocalizedStringPref(&quot;mail.addr_book.show_phonetic_fields&quot;) == &quot;true&quot;)</span>
<a href="#l11.8"></a><span id="l11.8">     document.getElementById(&quot;cmd_SortBy_PhoneticName&quot;)</span>
<a href="#l11.9"></a><span id="l11.9">             .setAttribute(&quot;hidden&quot;, &quot;false&quot;);</span>
<a href="#l11.10"></a><span id="l11.10"> }</span>
<a href="#l11.11"></a><span id="l11.11"> </span>
<a href="#l11.12"></a><span id="l11.12" class="difflineminus">-</span>
<a href="#l11.13"></a><span id="l11.13"> function SetNameColumn(cmd)</span>
<a href="#l11.14"></a><span id="l11.14"> {</span>
<a href="#l11.15"></a><span id="l11.15">   var prefValue;</span>
<a href="#l11.16"></a><span id="l11.16"> </span>
<a href="#l11.17"></a><span id="l11.17">   switch (cmd)</span>
<a href="#l11.18"></a><span id="l11.18">   {</span>
<a href="#l11.19"></a><span id="l11.19">   case 'firstLastCmd':</span>
<a href="#l11.20"></a><span id="l11.20">     prefValue = kFirstNameFirst;</span>
<a href="#l11.21"></a><span id="l11.21" class="difflineat">@@ -348,17 +347,20 @@ function SetStatusText(total)</span>
<a href="#l11.22"></a><span id="l11.22">         statusText = gAddressBookBundle.getString(&quot;noMatchFound&quot;);</span>
<a href="#l11.23"></a><span id="l11.23">       } else {</span>
<a href="#l11.24"></a><span id="l11.24">         statusText = PluralForm</span>
<a href="#l11.25"></a><span id="l11.25">           .get(total, gAddressBookBundle.getString(&quot;matchesFound1&quot;))</span>
<a href="#l11.26"></a><span id="l11.26">           .replace(&quot;#1&quot;, total);</span>
<a href="#l11.27"></a><span id="l11.27">       }</span>
<a href="#l11.28"></a><span id="l11.28">     }</span>
<a href="#l11.29"></a><span id="l11.29">     else</span>
<a href="#l11.30"></a><span id="l11.30" class="difflineminus">-      statusText = gAddressBookBundle.getFormattedString(&quot;totalContactStatus&quot;, [gAbView.directory.dirName, total]);</span>
<a href="#l11.31"></a><span id="l11.31" class="difflineplus">+      statusText =</span>
<a href="#l11.32"></a><span id="l11.32" class="difflineplus">+        gAddressBookBundle.getFormattedString(</span>
<a href="#l11.33"></a><span id="l11.33" class="difflineplus">+          &quot;totalContactStatus&quot;,</span>
<a href="#l11.34"></a><span id="l11.34" class="difflineplus">+          [getSelectedDirectory().dirName, total]);</span>
<a href="#l11.35"></a><span id="l11.35"> </span>
<a href="#l11.36"></a><span id="l11.36">     gStatusText.setAttribute(&quot;label&quot;, statusText);</span>
<a href="#l11.37"></a><span id="l11.37">   }</span>
<a href="#l11.38"></a><span id="l11.38">   catch(ex) {</span>
<a href="#l11.39"></a><span id="l11.39">     dump(&quot;failed to set status text:  &quot; + ex + &quot;\n&quot;);</span>
<a href="#l11.40"></a><span id="l11.40">   }</span>
<a href="#l11.41"></a><span id="l11.41"> }</span>
<a href="#l11.42"></a><span id="l11.42"> </span>
<a href="#l11.43"></a><span id="l11.43" class="difflineat">@@ -380,17 +382,16 @@ function onAdvancedAbSearch()</span>
<a href="#l11.44"></a><span id="l11.44">     window.openDialog(&quot;chrome://messenger/content/ABSearchDialog.xul&quot;, &quot;&quot;,</span>
<a href="#l11.45"></a><span id="l11.45">                       &quot;chrome,resizable,status,centerscreen,dialog=no&quot;,</span>
<a href="#l11.46"></a><span id="l11.46">                       {directory: selectedDirURI});</span>
<a href="#l11.47"></a><span id="l11.47"> }</span>
<a href="#l11.48"></a><span id="l11.48"> </span>
<a href="#l11.49"></a><span id="l11.49"> function onEnterInSearchBar()</span>
<a href="#l11.50"></a><span id="l11.50"> {</span>
<a href="#l11.51"></a><span id="l11.51">   ClearCardViewPane();</span>
<a href="#l11.52"></a><span id="l11.52" class="difflineminus">-</span>
<a href="#l11.53"></a><span id="l11.53">   if (!gQueryURIFormat) {</span>
<a href="#l11.54"></a><span id="l11.54">     // Get model query from pref. We don't want the query starting with &quot;?&quot;</span>
<a href="#l11.55"></a><span id="l11.55">     // as we have to prefix &quot;?and&quot; to this format.</span>
<a href="#l11.56"></a><span id="l11.56">     gQueryURIFormat = getModelQuery(&quot;mail.addr_book.quicksearchquery.format&quot;);</span>
<a href="#l11.57"></a><span id="l11.57">   }</span>
<a href="#l11.58"></a><span id="l11.58"> </span>
<a href="#l11.59"></a><span id="l11.59">   let searchURI = getSelectedDirectoryURI();</span>
<a href="#l11.60"></a><span id="l11.60">   if (!searchURI) return;</span>
<a href="#l11.61"></a><span id="l11.61" class="difflineat">@@ -400,16 +401,24 @@ function onEnterInSearchBar()</span>
<a href="#l11.62"></a><span id="l11.62">    already has a query, like</span>
<a href="#l11.63"></a><span id="l11.63">    moz-abldapdirectory://nsdirectory.netscape.com:389/ou=People,dc=netscape,dc=com?(or(Department,=,Applications))</span>
<a href="#l11.64"></a><span id="l11.64">   */</span>
<a href="#l11.65"></a><span id="l11.65">   // Use helper method to split up search query to multi-word search</span>
<a href="#l11.66"></a><span id="l11.66">   // query against multiple fields.</span>
<a href="#l11.67"></a><span id="l11.67">   let searchWords = getSearchTokens(gSearchInput.value);</span>
<a href="#l11.68"></a><span id="l11.68">   searchURI += generateQueryURI(gQueryURIFormat, searchWords);</span>
<a href="#l11.69"></a><span id="l11.69"> </span>
<a href="#l11.70"></a><span id="l11.70" class="difflineplus">+  if (searchURI == kAllDirectoryRoot)</span>
<a href="#l11.71"></a><span id="l11.71" class="difflineplus">+    searchURI += &quot;?&quot;;</span>
<a href="#l11.72"></a><span id="l11.72" class="difflineplus">+</span>
<a href="#l11.73"></a><span id="l11.73" class="difflineplus">+  document.getElementById(&quot;localResultsOnlyMessage&quot;)</span>
<a href="#l11.74"></a><span id="l11.74" class="difflineplus">+          .setAttribute(&quot;hidden&quot;,</span>
<a href="#l11.75"></a><span id="l11.75" class="difflineplus">+                        !gDirectoryTreeView.hasRemoteAB ||</span>
<a href="#l11.76"></a><span id="l11.76" class="difflineplus">+                        searchURI != kAllDirectoryRoot + &quot;?&quot;);</span>
<a href="#l11.77"></a><span id="l11.77" class="difflineplus">+</span>
<a href="#l11.78"></a><span id="l11.78">   SetAbView(searchURI);</span>
<a href="#l11.79"></a><span id="l11.79"> </span>
<a href="#l11.80"></a><span id="l11.80">   // XXX todo</span>
<a href="#l11.81"></a><span id="l11.81">   // this works for synchronous searches of local addressbooks,</span>
<a href="#l11.82"></a><span id="l11.82">   // but not for LDAP searches</span>
<a href="#l11.83"></a><span id="l11.83">   SelectFirstCard();</span>
<a href="#l11.84"></a><span id="l11.84"> }</span>
<a href="#l11.85"></a><span id="l11.85"> </span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l12.1"></a><span id="l12.1" class="difflineminus">--- a/suite/mailnews/components/addrbook/content/addressbook.xul</span>
<a href="#l12.2"></a><span id="l12.2" class="difflineplus">+++ b/suite/mailnews/components/addrbook/content/addressbook.xul</span>
<a href="#l12.3"></a><span id="l12.3" class="difflineat">@@ -65,18 +65,18 @@</span>
<a href="#l12.4"></a><span id="l12.4">                 events=&quot;focus,addrbook-select&quot;</span>
<a href="#l12.5"></a><span id="l12.5">                 oncommandupdate=&quot;CommandUpdate_AddressBook()&quot;/&gt;</span>
<a href="#l12.6"></a><span id="l12.6">     &lt;commandset id=&quot;selectEditMenuItems&quot;/&gt;</span>
<a href="#l12.7"></a><span id="l12.7">     &lt;commandset id=&quot;undoEditMenuItems&quot;/&gt;</span>
<a href="#l12.8"></a><span id="l12.8">     &lt;commandset id=&quot;globalEditMenuItems&quot;/&gt;</span>
<a href="#l12.9"></a><span id="l12.9">     &lt;command id=&quot;cmd_newNavigator&quot;/&gt;</span>
<a href="#l12.10"></a><span id="l12.10">     &lt;command id=&quot;cmd_newPrivateWindow&quot;/&gt;</span>
<a href="#l12.11"></a><span id="l12.11">     &lt;command id=&quot;cmd_newEditor&quot;/&gt;</span>
<a href="#l12.12"></a><span id="l12.12" class="difflineminus">-    &lt;command id=&quot;cmd_newcard&quot; oncommand=&quot;AbNewCard();&quot;/&gt;</span>
<a href="#l12.13"></a><span id="l12.13">     &lt;command id=&quot;cmd_newlist&quot; oncommand=&quot;AbNewList();&quot;/&gt;</span>
<a href="#l12.14"></a><span id="l12.14" class="difflineplus">+    &lt;command id=&quot;cmd_newCard&quot; oncommand=&quot;goDoCommand('cmd_newCard');&quot;/&gt;</span>
<a href="#l12.15"></a><span id="l12.15">     &lt;command id=&quot;cmd_newMessage&quot; oncommand=&quot;AbNewMessage();&quot;/&gt;</span>
<a href="#l12.16"></a><span id="l12.16">     &lt;command id=&quot;cmd_newim&quot; oncommand=&quot;AbIMSelected()&quot;/&gt;</span>
<a href="#l12.17"></a><span id="l12.17">     &lt;command id=&quot;cmd_printSetup&quot; oncommand=&quot;PrintUtils.showPageSetup()&quot;/&gt;</span>
<a href="#l12.18"></a><span id="l12.18">     &lt;command id=&quot;cmd_printcard&quot; oncommand=&quot;AbPrintCard()&quot;/&gt;</span>
<a href="#l12.19"></a><span id="l12.19">     &lt;command id=&quot;cmd_printcardpreview&quot; oncommand=&quot;AbPrintPreviewCard()&quot;/&gt;</span>
<a href="#l12.20"></a><span id="l12.20">     &lt;command id=&quot;cmd_printAddressBook&quot; oncommand=&quot;AbPrintAddressBook()&quot;/&gt;</span>
<a href="#l12.21"></a><span id="l12.21">     &lt;command id=&quot;cmd_printPreviewAddressBook&quot; oncommand=&quot;AbPrintPreviewAddressBook()&quot;/&gt;</span>
<a href="#l12.22"></a><span id="l12.22">     &lt;command id=&quot;cmd_close&quot; oncommand=&quot;AbClose()&quot;/&gt;</span>
<a href="#l12.23"></a><span id="l12.23" class="difflineat">@@ -113,16 +113,18 @@</span>
<a href="#l12.24"></a><span id="l12.24">   &lt;key id=&quot;key_newBlankPage&quot;/&gt;</span>
<a href="#l12.25"></a><span id="l12.25"> #ifdef XP_MACOSX</span>
<a href="#l12.26"></a><span id="l12.26">   &lt;key id=&quot;key_newMessage&quot; key=&quot;&amp;newMessageCmd.key;&quot;</span>
<a href="#l12.27"></a><span id="l12.27">        modifiers=&quot;accel,shift&quot; command=&quot;cmd_newMessage&quot;/&gt;</span>
<a href="#l12.28"></a><span id="l12.28"> #else</span>
<a href="#l12.29"></a><span id="l12.29">   &lt;key id=&quot;key_newMessage&quot; key=&quot;&amp;newMessageCmd.key;&quot;</span>
<a href="#l12.30"></a><span id="l12.30">        modifiers=&quot;accel&quot; command=&quot;cmd_newMessage&quot;/&gt;</span>
<a href="#l12.31"></a><span id="l12.31"> #endif</span>
<a href="#l12.32"></a><span id="l12.32" class="difflineplus">+  &lt;key id=&quot;key_newCard&quot; key=&quot;&amp;newContact.key;&quot; modifiers=&quot;accel&quot;</span>
<a href="#l12.33"></a><span id="l12.33" class="difflineplus">+       command=&quot;cmd_newCard&quot;/&gt;</span>
<a href="#l12.34"></a><span id="l12.34">   &lt;key id=&quot;key_printCard&quot; key=&quot;&amp;printContactViewCmd.key;&quot;</span>
<a href="#l12.35"></a><span id="l12.35">        command=&quot;cmd_printcard&quot; modifiers=&quot;accel&quot;/&gt;</span>
<a href="#l12.36"></a><span id="l12.36">   &lt;key id=&quot;key_close&quot;/&gt;</span>
<a href="#l12.37"></a><span id="l12.37">   &lt;!-- Edit Menu --&gt;</span>
<a href="#l12.38"></a><span id="l12.38">   &lt;key id=&quot;key_delete&quot;/&gt;</span>
<a href="#l12.39"></a><span id="l12.39">   &lt;key id=&quot;key_delete2&quot;/&gt; &lt;!-- secondary delete key --&gt;</span>
<a href="#l12.40"></a><span id="l12.40">   &lt;key id=&quot;key_undo&quot;/&gt;</span>
<a href="#l12.41"></a><span id="l12.41">   &lt;key id=&quot;key_redo&quot;/&gt;</span>
<a href="#l12.42"></a><span id="l12.42" class="difflineat">@@ -163,17 +165,17 @@</span>
<a href="#l12.43"></a><span id="l12.43">   &lt;menuitem id=&quot;dirTreeContext-properties&quot;</span>
<a href="#l12.44"></a><span id="l12.44">             label=&quot;&amp;editItemButton.label;&quot;</span>
<a href="#l12.45"></a><span id="l12.45">             accesskey=&quot;&amp;editItemButton.accesskey;&quot;</span>
<a href="#l12.46"></a><span id="l12.46">             command=&quot;cmd_properties&quot;/&gt;</span>
<a href="#l12.47"></a><span id="l12.47">   &lt;menuseparator/&gt;</span>
<a href="#l12.48"></a><span id="l12.48">   &lt;menuitem id=&quot;dirTreeContext-newcard&quot;</span>
<a href="#l12.49"></a><span id="l12.49">             label=&quot;&amp;newContactButton.label;&quot;</span>
<a href="#l12.50"></a><span id="l12.50">             accesskey=&quot;&amp;newContactButton.accesskey;&quot;</span>
<a href="#l12.51"></a><span id="l12.51" class="difflineminus">-            command=&quot;cmd_newcard&quot;/&gt;</span>
<a href="#l12.52"></a><span id="l12.52" class="difflineplus">+            command=&quot;cmd_newCard&quot;/&gt;</span>
<a href="#l12.53"></a><span id="l12.53">   &lt;menuitem id=&quot;dirTreeContext-newlist&quot;</span>
<a href="#l12.54"></a><span id="l12.54">             label=&quot;&amp;newlistButton.label;&quot;</span>
<a href="#l12.55"></a><span id="l12.55">             accesskey=&quot;&amp;newlistButton.accesskey;&quot;</span>
<a href="#l12.56"></a><span id="l12.56">             command=&quot;cmd_newlist&quot;/&gt;</span>
<a href="#l12.57"></a><span id="l12.57">   &lt;menuseparator/&gt;</span>
<a href="#l12.58"></a><span id="l12.58">   &lt;menuitem id=&quot;dirTreeContext-delete&quot;</span>
<a href="#l12.59"></a><span id="l12.59">             label=&quot;&amp;deleteItemButton.label;&quot;</span>
<a href="#l12.60"></a><span id="l12.60">             accesskey=&quot;&amp;deleteItemButton.accesskey;&quot;</span>
<a href="#l12.61"></a><span id="l12.61" class="difflineat">@@ -227,17 +229,18 @@</span>
<a href="#l12.62"></a><span id="l12.62">       &lt;menubar id=&quot;ab-menubar&quot;&gt;</span>
<a href="#l12.63"></a><span id="l12.63">         &lt;menu id=&quot;menu_File&quot;&gt;</span>
<a href="#l12.64"></a><span id="l12.64">           &lt;menupopup id=&quot;menu_FilePopup&quot;&gt;</span>
<a href="#l12.65"></a><span id="l12.65">             &lt;menu id=&quot;menu_New&quot;&gt;</span>
<a href="#l12.66"></a><span id="l12.66">               &lt;menupopup id=&quot;menu_NewPopup&quot;&gt;</span>
<a href="#l12.67"></a><span id="l12.67">                 &lt;menuitem id=&quot;menu_newContact&quot;</span>
<a href="#l12.68"></a><span id="l12.68">                           label=&quot;&amp;newContact.label;&quot;</span>
<a href="#l12.69"></a><span id="l12.69">                           accesskey=&quot;&amp;newContact.accesskey;&quot;</span>
<a href="#l12.70"></a><span id="l12.70" class="difflineminus">-                          oncommand=&quot;AbNewCard();&quot;/&gt;</span>
<a href="#l12.71"></a><span id="l12.71" class="difflineplus">+                          key=&quot;key_newCard&quot;</span>
<a href="#l12.72"></a><span id="l12.72" class="difflineplus">+                          command=&quot;cmd_newCard&quot;/&gt;</span>
<a href="#l12.73"></a><span id="l12.73">                 &lt;menuitem id=&quot;menu_newList&quot;</span>
<a href="#l12.74"></a><span id="l12.74">                           label=&quot;&amp;newListCmd.label;&quot;</span>
<a href="#l12.75"></a><span id="l12.75">                           accesskey=&quot;&amp;newListCmd.accesskey;&quot;</span>
<a href="#l12.76"></a><span id="l12.76">                           command=&quot;cmd_newlist&quot;/&gt;</span>
<a href="#l12.77"></a><span id="l12.77">                 &lt;menuitem id=&quot;menu_newAddrbook&quot;</span>
<a href="#l12.78"></a><span id="l12.78">                           label=&quot;&amp;newAddressBookCmd.label;&quot;</span>
<a href="#l12.79"></a><span id="l12.79">                           accesskey=&quot;&amp;newAddressBookCmd.accesskey;&quot;</span>
<a href="#l12.80"></a><span id="l12.80">                           oncommand=&quot;AbNewAddressBook();&quot;/&gt;</span>
<a href="#l12.81"></a><span id="l12.81" class="difflineat">@@ -415,16 +418,23 @@</span>
<a href="#l12.82"></a><span id="l12.82">             &lt;menuitem label=&quot;&amp;HomePhone.label;&quot;</span>
<a href="#l12.83"></a><span id="l12.83">                                   id=&quot;cmd_SortByHomePhone&quot;</span>
<a href="#l12.84"></a><span id="l12.84">                                   accesskey=&quot;&amp;HomePhone.accesskey;&quot;</span>
<a href="#l12.85"></a><span id="l12.85">                                   oncommand=&quot;SortResultPane('HomePhone');&quot; name=&quot;sortas&quot; type=&quot;radio&quot; checked=&quot;true&quot;/&gt;</span>
<a href="#l12.86"></a><span id="l12.86">             &lt;menuitem label=&quot;&amp;WorkPhone.label;&quot;</span>
<a href="#l12.87"></a><span id="l12.87">                                   id=&quot;cmd_SortByWorkPhone&quot;</span>
<a href="#l12.88"></a><span id="l12.88">                                   accesskey=&quot;&amp;WorkPhone.accesskey;&quot;</span>
<a href="#l12.89"></a><span id="l12.89">                                   oncommand=&quot;SortResultPane('WorkPhone');&quot; name=&quot;sortas&quot; type=&quot;radio&quot; checked=&quot;true&quot;/&gt;</span>
<a href="#l12.90"></a><span id="l12.90" class="difflineplus">+            &lt;menuitem label=&quot;&amp;Addrbook.label;&quot;</span>
<a href="#l12.91"></a><span id="l12.91" class="difflineplus">+                      id=&quot;cmd_SortByaddrbook&quot;</span>
<a href="#l12.92"></a><span id="l12.92" class="difflineplus">+                      accesskey=&quot;&amp;Addrbook.accesskey;&quot;</span>
<a href="#l12.93"></a><span id="l12.93" class="difflineplus">+                      oncommand=&quot;SortResultPane('addrbook');&quot;</span>
<a href="#l12.94"></a><span id="l12.94" class="difflineplus">+                      name=&quot;sortas&quot;</span>
<a href="#l12.95"></a><span id="l12.95" class="difflineplus">+                      type=&quot;radio&quot;</span>
<a href="#l12.96"></a><span id="l12.96" class="difflineplus">+                      checked=&quot;true&quot;/&gt;</span>
<a href="#l12.97"></a><span id="l12.97">             &lt;menuseparator/&gt;</span>
<a href="#l12.98"></a><span id="l12.98">             &lt;menuitem id=&quot;sortAscending&quot; type=&quot;radio&quot; name=&quot;sortdirection&quot; label=&quot;&amp;sortAscending.label;&quot; accesskey=&quot;&amp;sortAscending.accesskey;&quot; oncommand=&quot;AbSortAscending()&quot;/&gt;</span>
<a href="#l12.99"></a><span id="l12.99">             &lt;menuitem id=&quot;sortDescending&quot; type=&quot;radio&quot; name=&quot;sortdirection&quot; label=&quot;&amp;sortDescending.label;&quot; accesskey=&quot;&amp;sortDescending.accesskey;&quot; oncommand=&quot;AbSortDescending()&quot;/&gt;</span>
<a href="#l12.100"></a><span id="l12.100">                     &lt;/menupopup&gt;</span>
<a href="#l12.101"></a><span id="l12.101">                 &lt;/menu&gt;</span>
<a href="#l12.102"></a><span id="l12.102">             &lt;/menupopup&gt;</span>
<a href="#l12.103"></a><span id="l12.103">         &lt;/menu&gt;</span>
<a href="#l12.104"></a><span id="l12.104">         &lt;menu id=&quot;tasksMenu&quot;&gt;</span>
<a href="#l12.105"></a><span id="l12.105" class="difflineat">@@ -456,17 +466,17 @@</span>
<a href="#l12.106"></a><span id="l12.106">            accesskey=&quot;&amp;showAbToolbarCmd.accesskey;&quot;</span>
<a href="#l12.107"></a><span id="l12.107">            defaultset=&quot;button-newcard,button-newlist,separator,button-editcard,button-newmessage,button-newim,button-abdelete,spring,searchBox,throbber-box&quot;</span>
<a href="#l12.108"></a><span id="l12.108">            context=&quot;toolbar-context-menu&quot;&gt;</span>
<a href="#l12.109"></a><span id="l12.109">     &lt;toolbarbutton id=&quot;button-newcard&quot;</span>
<a href="#l12.110"></a><span id="l12.110">                    class=&quot;toolbarbutton-1&quot;</span>
<a href="#l12.111"></a><span id="l12.111">                    label=&quot;&amp;newContactButton.label;&quot;</span>
<a href="#l12.112"></a><span id="l12.112">                    tooltiptext=&quot;&amp;newContactButton.tooltip;&quot;</span>
<a href="#l12.113"></a><span id="l12.113">                    removable=&quot;true&quot;</span>
<a href="#l12.114"></a><span id="l12.114" class="difflineminus">-                   oncommand=&quot;AbNewCard();&quot;/&gt;</span>
<a href="#l12.115"></a><span id="l12.115" class="difflineplus">+                   command=&quot;cmd_newCard&quot;/&gt;</span>
<a href="#l12.116"></a><span id="l12.116">     &lt;toolbarbutton id=&quot;button-newlist&quot;</span>
<a href="#l12.117"></a><span id="l12.117">                    class=&quot;toolbarbutton-1&quot;</span>
<a href="#l12.118"></a><span id="l12.118">                    label=&quot;&amp;newlistButton.label;&quot;</span>
<a href="#l12.119"></a><span id="l12.119">                    tooltiptext=&quot;&amp;newlistButton.tooltip;&quot;</span>
<a href="#l12.120"></a><span id="l12.120">                    removable=&quot;true&quot;</span>
<a href="#l12.121"></a><span id="l12.121">                    command=&quot;cmd_newlist&quot;/&gt;</span>
<a href="#l12.122"></a><span id="l12.122">     &lt;toolbarbutton id=&quot;button-editcard&quot;</span>
<a href="#l12.123"></a><span id="l12.123">                    class=&quot;toolbarbutton-1&quot;</span>
<a href="#l12.124"></a><span id="l12.124" class="difflineat">@@ -541,17 +551,25 @@</span>
<a href="#l12.125"></a><span id="l12.125">       &lt;/tree&gt;</span>
<a href="#l12.126"></a><span id="l12.126">     &lt;/vbox&gt;</span>
<a href="#l12.127"></a><span id="l12.127"> </span>
<a href="#l12.128"></a><span id="l12.128">     &lt;splitter id=&quot;dirTree-splitter&quot; collapse=&quot;before&quot; persist=&quot;state&quot;&gt;</span>
<a href="#l12.129"></a><span id="l12.129">       &lt;grippy/&gt;</span>
<a href="#l12.130"></a><span id="l12.130">     &lt;/splitter&gt;</span>
<a href="#l12.131"></a><span id="l12.131"> </span>
<a href="#l12.132"></a><span id="l12.132">     &lt;vbox flex=&quot;1&quot; style=&quot;min-width:100px&quot;&gt;</span>
<a href="#l12.133"></a><span id="l12.133" class="difflineminus">-</span>
<a href="#l12.134"></a><span id="l12.134" class="difflineplus">+      &lt;description id=&quot;localResultsOnlyMessage&quot;</span>
<a href="#l12.135"></a><span id="l12.135" class="difflineplus">+                   value=&quot;&amp;localResultsOnlyMessage.label;&quot;/&gt;</span>
<a href="#l12.136"></a><span id="l12.136" class="difflineplus">+      &lt;vbox id=&quot;blankResultsPaneMessageBox&quot;</span>
<a href="#l12.137"></a><span id="l12.137" class="difflineplus">+            flex=&quot;1&quot;</span>
<a href="#l12.138"></a><span id="l12.138" class="difflineplus">+            pack=&quot;center&quot;</span>
<a href="#l12.139"></a><span id="l12.139" class="difflineplus">+            align=&quot;center&quot;&gt;</span>
<a href="#l12.140"></a><span id="l12.140" class="difflineplus">+        &lt;description id=&quot;blankResultsPaneMessage&quot;</span>
<a href="#l12.141"></a><span id="l12.141" class="difflineplus">+                     value=&quot;&amp;blankResultsPaneMessage.label;&quot;/&gt;</span>
<a href="#l12.142"></a><span id="l12.142" class="difflineplus">+      &lt;/vbox&gt;</span>
<a href="#l12.143"></a><span id="l12.143">       &lt;!-- results pane --&gt;</span>
<a href="#l12.144"></a><span id="l12.144">       &lt;tree id=&quot;abResultsTree&quot; context=&quot;abResultsTreeContext&quot; flex=&quot;1&quot; /&gt;</span>
<a href="#l12.145"></a><span id="l12.145"> </span>
<a href="#l12.146"></a><span id="l12.146">       &lt;splitter id=&quot;results-splitter&quot; collapse=&quot;after&quot; persist=&quot;state&quot;&gt;</span>
<a href="#l12.147"></a><span id="l12.147">         &lt;grippy/&gt;</span>
<a href="#l12.148"></a><span id="l12.148">       &lt;/splitter&gt;</span>
<a href="#l12.149"></a><span id="l12.149"> </span>
<a href="#l12.150"></a><span id="l12.150">       &lt;!-- card view --&gt;</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l13.1"></a><span id="l13.1" class="difflineminus">--- a/suite/themes/classic/mac/messenger/addressbook/addressbook.css</span>
<a href="#l13.2"></a><span id="l13.2" class="difflineplus">+++ b/suite/themes/classic/mac/messenger/addressbook/addressbook.css</span>
<a href="#l13.3"></a><span id="l13.3" class="difflineat">@@ -298,16 +298,25 @@ toolbar[iconsize=&quot;small&quot;] &gt; #button-abde</span>
<a href="#l13.4"></a><span id="l13.4"> }</span>
<a href="#l13.5"></a><span id="l13.5"> </span>
<a href="#l13.6"></a><span id="l13.6"> #DirCol &gt; .treecol-text {</span>
<a href="#l13.7"></a><span id="l13.7">   padding: 6px 0 6px 8px;</span>
<a href="#l13.8"></a><span id="l13.8">   font-weight: bold;</span>
<a href="#l13.9"></a><span id="l13.9">   color: #738193;</span>
<a href="#l13.10"></a><span id="l13.10"> }</span>
<a href="#l13.11"></a><span id="l13.11"> </span>
<a href="#l13.12"></a><span id="l13.12" class="difflineplus">+#blankResultsPaneMessage {</span>
<a href="#l13.13"></a><span id="l13.13" class="difflineplus">+  font-style: italic;</span>
<a href="#l13.14"></a><span id="l13.14" class="difflineplus">+}</span>
<a href="#l13.15"></a><span id="l13.15" class="difflineplus">+</span>
<a href="#l13.16"></a><span id="l13.16" class="difflineplus">+#localResultsOnlyMessage {</span>
<a href="#l13.17"></a><span id="l13.17" class="difflineplus">+  font-style: italic;</span>
<a href="#l13.18"></a><span id="l13.18" class="difflineplus">+  text-align: center;</span>
<a href="#l13.19"></a><span id="l13.19" class="difflineplus">+}</span>
<a href="#l13.20"></a><span id="l13.20" class="difflineplus">+</span>
<a href="#l13.21"></a><span id="l13.21"> /* CardView styles - used in the Card View Pane */</span>
<a href="#l13.22"></a><span id="l13.22">  </span>
<a href="#l13.23"></a><span id="l13.23"> #CardViewBox {</span>
<a href="#l13.24"></a><span id="l13.24">   -moz-user-focus: ignore;</span>
<a href="#l13.25"></a><span id="l13.25">   overflow: auto;</span>
<a href="#l13.26"></a><span id="l13.26">   min-width: 150px;</span>
<a href="#l13.27"></a><span id="l13.27">   background-color: #FFFFFF;</span>
<a href="#l13.28"></a><span id="l13.28"> }</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l14.1"></a><span id="l14.1" class="difflineminus">--- a/suite/themes/classic/messenger/addressbook/addressbook.css</span>
<a href="#l14.2"></a><span id="l14.2" class="difflineplus">+++ b/suite/themes/classic/messenger/addressbook/addressbook.css</span>
<a href="#l14.3"></a><span id="l14.3" class="difflineat">@@ -220,16 +220,25 @@ toolbar[iconsize=&quot;small&quot;] &gt; #button-abde</span>
<a href="#l14.4"></a><span id="l14.4"> toolbar[iconsize=&quot;small&quot;] &gt; #button-abdelete:hover:active {</span>
<a href="#l14.5"></a><span id="l14.5">   -moz-image-region: rect(0 59px 19px 40px);</span>
<a href="#l14.6"></a><span id="l14.6"> }</span>
<a href="#l14.7"></a><span id="l14.7"> </span>
<a href="#l14.8"></a><span id="l14.8"> toolbar[iconsize=&quot;small&quot;] &gt; #button-abdelete[disabled] {</span>
<a href="#l14.9"></a><span id="l14.9">   -moz-image-region: rect(0 79px 19px 60px) !important;</span>
<a href="#l14.10"></a><span id="l14.10"> }</span>
<a href="#l14.11"></a><span id="l14.11"> </span>
<a href="#l14.12"></a><span id="l14.12" class="difflineplus">+#blankResultsPaneMessage {</span>
<a href="#l14.13"></a><span id="l14.13" class="difflineplus">+  font-style: italic;</span>
<a href="#l14.14"></a><span id="l14.14" class="difflineplus">+}</span>
<a href="#l14.15"></a><span id="l14.15" class="difflineplus">+</span>
<a href="#l14.16"></a><span id="l14.16" class="difflineplus">+#localResultsOnlyMessage {</span>
<a href="#l14.17"></a><span id="l14.17" class="difflineplus">+  font-style: italic;</span>
<a href="#l14.18"></a><span id="l14.18" class="difflineplus">+  text-align: center;</span>
<a href="#l14.19"></a><span id="l14.19" class="difflineplus">+}</span>
<a href="#l14.20"></a><span id="l14.20" class="difflineplus">+</span>
<a href="#l14.21"></a><span id="l14.21"> /* CardView styles - used in the Card View Pane */</span>
<a href="#l14.22"></a><span id="l14.22"> </span>
<a href="#l14.23"></a><span id="l14.23"> #CardViewOuterBox {</span>
<a href="#l14.24"></a><span id="l14.24">   border-left: 1px solid ThreeDShadow;</span>
<a href="#l14.25"></a><span id="l14.25">   border-top: 1px solid ThreeDShadow;</span>
<a href="#l14.26"></a><span id="l14.26">   border-right: 1px solid ThreeDHighlight;</span>
<a href="#l14.27"></a><span id="l14.27"> }</span>
<a href="#l14.28"></a><span id="l14.28"> </span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l15.1"></a><span id="l15.1" class="difflineminus">--- a/suite/themes/modern/messenger/addressbook/addressbook.css</span>
<a href="#l15.2"></a><span id="l15.2" class="difflineplus">+++ b/suite/themes/modern/messenger/addressbook/addressbook.css</span>
<a href="#l15.3"></a><span id="l15.3" class="difflineat">@@ -116,16 +116,25 @@</span>
<a href="#l15.4"></a><span id="l15.4"> #button-abdelete:hover:active {</span>
<a href="#l15.5"></a><span id="l15.5">   -moz-image-region: rect(408px 149px 441px 100px);</span>
<a href="#l15.6"></a><span id="l15.6"> }</span>
<a href="#l15.7"></a><span id="l15.7"> </span>
<a href="#l15.8"></a><span id="l15.8"> #button-abdelete[disabled] {</span>
<a href="#l15.9"></a><span id="l15.9">   -moz-image-region: rect(408px 199px 441px 150px) !important;</span>
<a href="#l15.10"></a><span id="l15.10"> } </span>
<a href="#l15.11"></a><span id="l15.11"> </span>
<a href="#l15.12"></a><span id="l15.12" class="difflineplus">+#blankResultsPaneMessage {</span>
<a href="#l15.13"></a><span id="l15.13" class="difflineplus">+  font-style: italic;</span>
<a href="#l15.14"></a><span id="l15.14" class="difflineplus">+}</span>
<a href="#l15.15"></a><span id="l15.15" class="difflineplus">+</span>
<a href="#l15.16"></a><span id="l15.16" class="difflineplus">+#localResultsOnlyMessage {</span>
<a href="#l15.17"></a><span id="l15.17" class="difflineplus">+  font-style: italic;</span>
<a href="#l15.18"></a><span id="l15.18" class="difflineplus">+  text-align: center;</span>
<a href="#l15.19"></a><span id="l15.19" class="difflineplus">+}</span>
<a href="#l15.20"></a><span id="l15.20" class="difflineplus">+</span>
<a href="#l15.21"></a><span id="l15.21"> /* ::::: Card View pane ::::: */</span>
<a href="#l15.22"></a><span id="l15.22"> </span>
<a href="#l15.23"></a><span id="l15.23"> #CardViewBox {</span>
<a href="#l15.24"></a><span id="l15.24">   -moz-user-focus: ignore;</span>
<a href="#l15.25"></a><span id="l15.25">   min-width: 150px;</span>
<a href="#l15.26"></a><span id="l15.26">   background-color: #EFEFEF;</span>
<a href="#l15.27"></a><span id="l15.27">   overflow: auto;</span>
<a href="#l15.28"></a><span id="l15.28"> }</span></pre></div></div>

<div class="page_footer">
<div class="page_footer_text">comm-central</div>
<div class="page_footer_text" style="padding-left: 10px">Deployed from <a href="https://hg.mozilla.org/hgcustom/version-control-tools/rev/4b0de666d1a4">4b0de666d1a4</a> at 2020-07-30T19:32:33Z.</div>
<div class="rss_logo">
<a href="/comm-central/rss-log">RSS</a>
<a href="/comm-central/atom-log">Atom</a>
</div>
<br />

</div>
</body>
</html>

