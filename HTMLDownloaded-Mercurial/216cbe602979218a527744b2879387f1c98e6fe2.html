<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en-US" lang="en-US">
<head>
<link rel="icon" href="/static/4b0de666d1a4/hgicon.png" type="image/png" />
<meta name="robots" content="index, nofollow"/>
<link rel="stylesheet" href="/static/4b0de666d1a4/style-gitweb.css" type="text/css" />

<style type="text/css">
div.feed {
  float: right;
}
a img {
  border-width: 0px;
}
div.log_link {
  width: 80px;
  background-color: white;
}

div.log_body {
  padding-left: 96px;
}
</style>
<script type="text/javascript" src="/static/4b0de666d1a4/mercurial.js"></script>

<meta property="og:image" content="/static/4b0de666d1a4/moz-logo-bw-rgb.svg"/>
<meta property="og:type" content="website"/>

<title>comm-central: changeset 28520:216cbe602979218a527744b2879387f1c98e6fe2</title>
<link rel="alternate" type="application/atom+xml"
   href="/comm-central/atom-log" title="Atom feed for comm-central"/>
<link rel="alternate" type="application/rss+xml"
   href="/comm-central/rss-log" title="RSS feed for comm-central"/>

<meta property="og:title" content="comm-central @ 216cbe602979218a527744b2879387f1c98e6fe2" />
<meta property="og:url" content="/comm-central/rev/216cbe602979218a527744b2879387f1c98e6fe2" />
<meta property="og:description" content="Bug 1594000 - Convert remaining nsISimpleEnumerator users to use JS iteration in /mailnews. r=mkmelin" />

</head>
<body>

<div class="page_header">
<div class="logo">
    <a href="https://developer.mozilla.org/en/docs/Mercurial">
        <img src="/static/4b0de666d1a4/moz-logo-bw-rgb.svg" alt="mercurial" />
    </a>
</div>
<a href="/">Mercurial</a> &gt; <a href="/comm-central">comm-central</a>  / changeset / 216cbe602979218a527744b2879387f1c98e6fe2 
</div>

<div class="page_nav">
<div>
<a href="/comm-central/summary">summary</a> |
<a href="/comm-central/shortlog/216cbe602979218a527744b2879387f1c98e6fe2">shortlog</a> |
<a href="/comm-central/log/216cbe602979218a527744b2879387f1c98e6fe2">changelog</a> |
<a href="/comm-central/pushloghtml">pushlog</a> |
<a href="/comm-central/graph/216cbe602979218a527744b2879387f1c98e6fe2">graph</a> |
<a href="/comm-central/tags">tags</a> |
<a href="/comm-central/bookmarks">bookmarks</a> |
<a href="/comm-central/branches">branches</a> |
<a href="/comm-central/file/216cbe602979218a527744b2879387f1c98e6fe2">files</a> |
changeset |
<a href="/comm-central/raw-rev/216cbe602979218a527744b2879387f1c98e6fe2">raw</a>  | <a href="/comm-central/archive/216cbe602979218a527744b2879387f1c98e6fe2.zip">zip</a>  |
<a href="/comm-central/help">help</a>
</div>

<div class="search">
<form id="searchform" action="/comm-central/log">

<input name="rev" type="text" value="" size="40" />
<div id="hint">Find changesets by keywords (author, files, the commit message), revision
number or hash, or <a href="/comm-central/help/revsets">revset expression</a>.</div>
</form>
</div>
</div>

<div class="title">
<a href="https://bugzilla.mozilla.org/show_bug.cgi?id=1594000">Bug 1594000</a> - Convert remaining nsISimpleEnumerator users to use JS iteration in /mailnews. r=mkmelin
<span class="logtags"></span>
</div>
<div class="title_text">
<table cellspacing="0">

<tr><td>author</td><td>&#75;&#104;&#117;&#115;&#104;&#105;&#108;&#32;&#77;&#105;&#115;&#116;&#114;&#121;&#32;&#60;&#107;&#104;&#117;&#115;&#104;&#105;&#108;&#51;&#50;&#52;&#64;&#103;&#109;&#97;&#105;&#108;&#46;&#99;&#111;&#109;&#62;</td></tr>
<tr><td></td><td class="date age">Mon, 13 Jan 2020 09:32:02 +0200</td></tr>

<tr>
 <td>changeset 28520</td>
 <td style="font-family:monospace"><a class="list" href="/comm-central/rev/216cbe602979218a527744b2879387f1c98e6fe2">216cbe602979218a527744b2879387f1c98e6fe2</a></td>
</tr>



<tr>
<td>parent 28519</td>
<td style="font-family:monospace">
<a class="list" href="/comm-central/rev/741493b66b6abddfa227c1dd08c91bf11367a3cb">741493b66b6abddfa227c1dd08c91bf11367a3cb</a>
</td>
</tr>

<tr>
<td>child 28521</td>
<td style="font-family:monospace">
<a class="list" href="/comm-central/rev/8386d49168fa9c7a441886da483b482835010a8d">8386d49168fa9c7a441886da483b482835010a8d</a>
</td>
</tr>
<tr><td>push id</td><td><a href="/comm-central/pushloghtml?changeset=216cbe602979218a527744b2879387f1c98e6fe2">16894</a></td></tr>
<tr><td>push user</td><td>mkmelin@iki.fi</td></tr>
<tr><td>push date</td><td class="date age">Mon, 13 Jan 2020 07:35:45 +0000</td></tr>

<tr><td>treeherder</td><td>comm-central@216cbe602979 [<a href="https://treeherder.mozilla.org/#/jobs?repo=comm-central&revision=216cbe602979218a527744b2879387f1c98e6fe2">default view</a>] [<a href="https://treeherder.mozilla.org/#/jobs?repo=comm-central&revision=216cbe602979218a527744b2879387f1c98e6fe2&filter-resultStatus=testfailed&filter-resultStatus=busted&filter-resultStatus=exception">failures only]</td></tr>
<tr><td>perfherder</td><td>[<a href="https://treeherder.mozilla.org/perf.html#/compare?originalProject=comm-central&originalRevision=216cbe602979218a527744b2879387f1c98e6fe2&newProject=comm-central&newRevision=78ee796295d6bb5dc68db16e5eb199bd6111c378&framework=1" target="_blank">talos</a>] [<a href="https://treeherder.mozilla.org/perf.html#/compare?originalProject=comm-central&originalRevision=216cbe602979218a527744b2879387f1c98e6fe2&newProject=comm-central&newRevision=78ee796295d6bb5dc68db16e5eb199bd6111c378&framework=2" target="_blank">build metrics</a>] [<a href="https://treeherder.mozilla.org/perf.html#/compare?originalProject=comm-central&originalRevision=216cbe602979218a527744b2879387f1c98e6fe2&newProject=comm-central&newRevision=78ee796295d6bb5dc68db16e5eb199bd6111c378&framework=6" target="_blank">platform microbench</a>] (compared to previous push)</td></tr>
<tr><td>reviewers</td><td><a href="/comm-central/log?rev=reviewer%28mkmelin%29&revcount=50">mkmelin</a></td></tr>
<tr><td>bugs</td><td><a href="https://bugzilla.mozilla.org/show_bug.cgi?id=1594000">1594000</a></td></tr>




</table></div>

<div class="page_body description"><a href="https://bugzilla.mozilla.org/show_bug.cgi?id=1594000">Bug 1594000</a> - Convert remaining nsISimpleEnumerator users to use JS iteration in /mailnews. r=mkmelin</div>
<div class="list_head"></div>
<div class="title_text">
<table cellspacing="0">

<tr class="parity0">
<td><a class="list" href="/comm-central/diff/216cbe602979218a527744b2879387f1c98e6fe2/mailnews/addrbook/content/abAddressBookNameDialog.js">mailnews/addrbook/content/abAddressBookNameDialog.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/216cbe602979218a527744b2879387f1c98e6fe2/mailnews/addrbook/content/abAddressBookNameDialog.js">file</a> |
<a href="/comm-central/annotate/216cbe602979218a527744b2879387f1c98e6fe2/mailnews/addrbook/content/abAddressBookNameDialog.js">annotate</a> |
<a href="/comm-central/diff/216cbe602979218a527744b2879387f1c98e6fe2/mailnews/addrbook/content/abAddressBookNameDialog.js">diff</a> |
<a href="/comm-central/comparison/216cbe602979218a527744b2879387f1c98e6fe2/mailnews/addrbook/content/abAddressBookNameDialog.js">comparison</a> |
<a href="/comm-central/log/216cbe602979218a527744b2879387f1c98e6fe2/mailnews/addrbook/content/abAddressBookNameDialog.js">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/216cbe602979218a527744b2879387f1c98e6fe2/mailnews/addrbook/prefs/content/pref-directory-add.js">mailnews/addrbook/prefs/content/pref-directory-add.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/216cbe602979218a527744b2879387f1c98e6fe2/mailnews/addrbook/prefs/content/pref-directory-add.js">file</a> |
<a href="/comm-central/annotate/216cbe602979218a527744b2879387f1c98e6fe2/mailnews/addrbook/prefs/content/pref-directory-add.js">annotate</a> |
<a href="/comm-central/diff/216cbe602979218a527744b2879387f1c98e6fe2/mailnews/addrbook/prefs/content/pref-directory-add.js">diff</a> |
<a href="/comm-central/comparison/216cbe602979218a527744b2879387f1c98e6fe2/mailnews/addrbook/prefs/content/pref-directory-add.js">comparison</a> |
<a href="/comm-central/log/216cbe602979218a527744b2879387f1c98e6fe2/mailnews/addrbook/prefs/content/pref-directory-add.js">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/216cbe602979218a527744b2879387f1c98e6fe2/mailnews/addrbook/prefs/content/pref-editdirectories.js">mailnews/addrbook/prefs/content/pref-editdirectories.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/216cbe602979218a527744b2879387f1c98e6fe2/mailnews/addrbook/prefs/content/pref-editdirectories.js">file</a> |
<a href="/comm-central/annotate/216cbe602979218a527744b2879387f1c98e6fe2/mailnews/addrbook/prefs/content/pref-editdirectories.js">annotate</a> |
<a href="/comm-central/diff/216cbe602979218a527744b2879387f1c98e6fe2/mailnews/addrbook/prefs/content/pref-editdirectories.js">diff</a> |
<a href="/comm-central/comparison/216cbe602979218a527744b2879387f1c98e6fe2/mailnews/addrbook/prefs/content/pref-editdirectories.js">comparison</a> |
<a href="/comm-central/log/216cbe602979218a527744b2879387f1c98e6fe2/mailnews/addrbook/prefs/content/pref-editdirectories.js">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/216cbe602979218a527744b2879387f1c98e6fe2/mailnews/addrbook/src/AbAutoCompleteSearch.jsm">mailnews/addrbook/src/AbAutoCompleteSearch.jsm</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/216cbe602979218a527744b2879387f1c98e6fe2/mailnews/addrbook/src/AbAutoCompleteSearch.jsm">file</a> |
<a href="/comm-central/annotate/216cbe602979218a527744b2879387f1c98e6fe2/mailnews/addrbook/src/AbAutoCompleteSearch.jsm">annotate</a> |
<a href="/comm-central/diff/216cbe602979218a527744b2879387f1c98e6fe2/mailnews/addrbook/src/AbAutoCompleteSearch.jsm">diff</a> |
<a href="/comm-central/comparison/216cbe602979218a527744b2879387f1c98e6fe2/mailnews/addrbook/src/AbAutoCompleteSearch.jsm">comparison</a> |
<a href="/comm-central/log/216cbe602979218a527744b2879387f1c98e6fe2/mailnews/addrbook/src/AbAutoCompleteSearch.jsm">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/216cbe602979218a527744b2879387f1c98e6fe2/mailnews/addrbook/test/unit/test_bug534822.js">mailnews/addrbook/test/unit/test_bug534822.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/216cbe602979218a527744b2879387f1c98e6fe2/mailnews/addrbook/test/unit/test_bug534822.js">file</a> |
<a href="/comm-central/annotate/216cbe602979218a527744b2879387f1c98e6fe2/mailnews/addrbook/test/unit/test_bug534822.js">annotate</a> |
<a href="/comm-central/diff/216cbe602979218a527744b2879387f1c98e6fe2/mailnews/addrbook/test/unit/test_bug534822.js">diff</a> |
<a href="/comm-central/comparison/216cbe602979218a527744b2879387f1c98e6fe2/mailnews/addrbook/test/unit/test_bug534822.js">comparison</a> |
<a href="/comm-central/log/216cbe602979218a527744b2879387f1c98e6fe2/mailnews/addrbook/test/unit/test_bug534822.js">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/216cbe602979218a527744b2879387f1c98e6fe2/mailnews/addrbook/test/unit/test_cardForEmail.js">mailnews/addrbook/test/unit/test_cardForEmail.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/216cbe602979218a527744b2879387f1c98e6fe2/mailnews/addrbook/test/unit/test_cardForEmail.js">file</a> |
<a href="/comm-central/annotate/216cbe602979218a527744b2879387f1c98e6fe2/mailnews/addrbook/test/unit/test_cardForEmail.js">annotate</a> |
<a href="/comm-central/diff/216cbe602979218a527744b2879387f1c98e6fe2/mailnews/addrbook/test/unit/test_cardForEmail.js">diff</a> |
<a href="/comm-central/comparison/216cbe602979218a527744b2879387f1c98e6fe2/mailnews/addrbook/test/unit/test_cardForEmail.js">comparison</a> |
<a href="/comm-central/log/216cbe602979218a527744b2879387f1c98e6fe2/mailnews/addrbook/test/unit/test_cardForEmail.js">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/216cbe602979218a527744b2879387f1c98e6fe2/mailnews/addrbook/test/unit/test_collection.js">mailnews/addrbook/test/unit/test_collection.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/216cbe602979218a527744b2879387f1c98e6fe2/mailnews/addrbook/test/unit/test_collection.js">file</a> |
<a href="/comm-central/annotate/216cbe602979218a527744b2879387f1c98e6fe2/mailnews/addrbook/test/unit/test_collection.js">annotate</a> |
<a href="/comm-central/diff/216cbe602979218a527744b2879387f1c98e6fe2/mailnews/addrbook/test/unit/test_collection.js">diff</a> |
<a href="/comm-central/comparison/216cbe602979218a527744b2879387f1c98e6fe2/mailnews/addrbook/test/unit/test_collection.js">comparison</a> |
<a href="/comm-central/log/216cbe602979218a527744b2879387f1c98e6fe2/mailnews/addrbook/test/unit/test_collection.js">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/216cbe602979218a527744b2879387f1c98e6fe2/mailnews/addrbook/test/unit/test_db_enumerator.js">mailnews/addrbook/test/unit/test_db_enumerator.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/216cbe602979218a527744b2879387f1c98e6fe2/mailnews/addrbook/test/unit/test_db_enumerator.js">file</a> |
<a href="/comm-central/annotate/216cbe602979218a527744b2879387f1c98e6fe2/mailnews/addrbook/test/unit/test_db_enumerator.js">annotate</a> |
<a href="/comm-central/diff/216cbe602979218a527744b2879387f1c98e6fe2/mailnews/addrbook/test/unit/test_db_enumerator.js">diff</a> |
<a href="/comm-central/comparison/216cbe602979218a527744b2879387f1c98e6fe2/mailnews/addrbook/test/unit/test_db_enumerator.js">comparison</a> |
<a href="/comm-central/log/216cbe602979218a527744b2879387f1c98e6fe2/mailnews/addrbook/test/unit/test_db_enumerator.js">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/216cbe602979218a527744b2879387f1c98e6fe2/mailnews/addrbook/test/unit/test_ldapOffline.js">mailnews/addrbook/test/unit/test_ldapOffline.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/216cbe602979218a527744b2879387f1c98e6fe2/mailnews/addrbook/test/unit/test_ldapOffline.js">file</a> |
<a href="/comm-central/annotate/216cbe602979218a527744b2879387f1c98e6fe2/mailnews/addrbook/test/unit/test_ldapOffline.js">annotate</a> |
<a href="/comm-central/diff/216cbe602979218a527744b2879387f1c98e6fe2/mailnews/addrbook/test/unit/test_ldapOffline.js">diff</a> |
<a href="/comm-central/comparison/216cbe602979218a527744b2879387f1c98e6fe2/mailnews/addrbook/test/unit/test_ldapOffline.js">comparison</a> |
<a href="/comm-central/log/216cbe602979218a527744b2879387f1c98e6fe2/mailnews/addrbook/test/unit/test_ldapOffline.js">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/216cbe602979218a527744b2879387f1c98e6fe2/mailnews/addrbook/test/unit/test_mailList1.js">mailnews/addrbook/test/unit/test_mailList1.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/216cbe602979218a527744b2879387f1c98e6fe2/mailnews/addrbook/test/unit/test_mailList1.js">file</a> |
<a href="/comm-central/annotate/216cbe602979218a527744b2879387f1c98e6fe2/mailnews/addrbook/test/unit/test_mailList1.js">annotate</a> |
<a href="/comm-central/diff/216cbe602979218a527744b2879387f1c98e6fe2/mailnews/addrbook/test/unit/test_mailList1.js">diff</a> |
<a href="/comm-central/comparison/216cbe602979218a527744b2879387f1c98e6fe2/mailnews/addrbook/test/unit/test_mailList1.js">comparison</a> |
<a href="/comm-central/log/216cbe602979218a527744b2879387f1c98e6fe2/mailnews/addrbook/test/unit/test_mailList1.js">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/216cbe602979218a527744b2879387f1c98e6fe2/mailnews/addrbook/test/unit/test_nsAbAutoCompleteSearch1.js">mailnews/addrbook/test/unit/test_nsAbAutoCompleteSearch1.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/216cbe602979218a527744b2879387f1c98e6fe2/mailnews/addrbook/test/unit/test_nsAbAutoCompleteSearch1.js">file</a> |
<a href="/comm-central/annotate/216cbe602979218a527744b2879387f1c98e6fe2/mailnews/addrbook/test/unit/test_nsAbAutoCompleteSearch1.js">annotate</a> |
<a href="/comm-central/diff/216cbe602979218a527744b2879387f1c98e6fe2/mailnews/addrbook/test/unit/test_nsAbAutoCompleteSearch1.js">diff</a> |
<a href="/comm-central/comparison/216cbe602979218a527744b2879387f1c98e6fe2/mailnews/addrbook/test/unit/test_nsAbAutoCompleteSearch1.js">comparison</a> |
<a href="/comm-central/log/216cbe602979218a527744b2879387f1c98e6fe2/mailnews/addrbook/test/unit/test_nsAbAutoCompleteSearch1.js">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/216cbe602979218a527744b2879387f1c98e6fe2/mailnews/addrbook/test/unit/test_nsAbAutoCompleteSearch7.js">mailnews/addrbook/test/unit/test_nsAbAutoCompleteSearch7.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/216cbe602979218a527744b2879387f1c98e6fe2/mailnews/addrbook/test/unit/test_nsAbAutoCompleteSearch7.js">file</a> |
<a href="/comm-central/annotate/216cbe602979218a527744b2879387f1c98e6fe2/mailnews/addrbook/test/unit/test_nsAbAutoCompleteSearch7.js">annotate</a> |
<a href="/comm-central/diff/216cbe602979218a527744b2879387f1c98e6fe2/mailnews/addrbook/test/unit/test_nsAbAutoCompleteSearch7.js">diff</a> |
<a href="/comm-central/comparison/216cbe602979218a527744b2879387f1c98e6fe2/mailnews/addrbook/test/unit/test_nsAbAutoCompleteSearch7.js">comparison</a> |
<a href="/comm-central/log/216cbe602979218a527744b2879387f1c98e6fe2/mailnews/addrbook/test/unit/test_nsAbAutoCompleteSearch7.js">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/216cbe602979218a527744b2879387f1c98e6fe2/mailnews/addrbook/test/unit/test_nsAbManager2.js">mailnews/addrbook/test/unit/test_nsAbManager2.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/216cbe602979218a527744b2879387f1c98e6fe2/mailnews/addrbook/test/unit/test_nsAbManager2.js">file</a> |
<a href="/comm-central/annotate/216cbe602979218a527744b2879387f1c98e6fe2/mailnews/addrbook/test/unit/test_nsAbManager2.js">annotate</a> |
<a href="/comm-central/diff/216cbe602979218a527744b2879387f1c98e6fe2/mailnews/addrbook/test/unit/test_nsAbManager2.js">diff</a> |
<a href="/comm-central/comparison/216cbe602979218a527744b2879387f1c98e6fe2/mailnews/addrbook/test/unit/test_nsAbManager2.js">comparison</a> |
<a href="/comm-central/log/216cbe602979218a527744b2879387f1c98e6fe2/mailnews/addrbook/test/unit/test_nsAbManager2.js">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/216cbe602979218a527744b2879387f1c98e6fe2/mailnews/addrbook/test/unit/test_nsIAbCard.js">mailnews/addrbook/test/unit/test_nsIAbCard.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/216cbe602979218a527744b2879387f1c98e6fe2/mailnews/addrbook/test/unit/test_nsIAbCard.js">file</a> |
<a href="/comm-central/annotate/216cbe602979218a527744b2879387f1c98e6fe2/mailnews/addrbook/test/unit/test_nsIAbCard.js">annotate</a> |
<a href="/comm-central/diff/216cbe602979218a527744b2879387f1c98e6fe2/mailnews/addrbook/test/unit/test_nsIAbCard.js">diff</a> |
<a href="/comm-central/comparison/216cbe602979218a527744b2879387f1c98e6fe2/mailnews/addrbook/test/unit/test_nsIAbCard.js">comparison</a> |
<a href="/comm-central/log/216cbe602979218a527744b2879387f1c98e6fe2/mailnews/addrbook/test/unit/test_nsIAbCard.js">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/216cbe602979218a527744b2879387f1c98e6fe2/mailnews/base/content/junkCommands.js">mailnews/base/content/junkCommands.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/216cbe602979218a527744b2879387f1c98e6fe2/mailnews/base/content/junkCommands.js">file</a> |
<a href="/comm-central/annotate/216cbe602979218a527744b2879387f1c98e6fe2/mailnews/base/content/junkCommands.js">annotate</a> |
<a href="/comm-central/diff/216cbe602979218a527744b2879387f1c98e6fe2/mailnews/base/content/junkCommands.js">diff</a> |
<a href="/comm-central/comparison/216cbe602979218a527744b2879387f1c98e6fe2/mailnews/base/content/junkCommands.js">comparison</a> |
<a href="/comm-central/log/216cbe602979218a527744b2879387f1c98e6fe2/mailnews/base/content/junkCommands.js">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/216cbe602979218a527744b2879387f1c98e6fe2/mailnews/base/prefs/content/am-identity-edit.js">mailnews/base/prefs/content/am-identity-edit.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/216cbe602979218a527744b2879387f1c98e6fe2/mailnews/base/prefs/content/am-identity-edit.js">file</a> |
<a href="/comm-central/annotate/216cbe602979218a527744b2879387f1c98e6fe2/mailnews/base/prefs/content/am-identity-edit.js">annotate</a> |
<a href="/comm-central/diff/216cbe602979218a527744b2879387f1c98e6fe2/mailnews/base/prefs/content/am-identity-edit.js">diff</a> |
<a href="/comm-central/comparison/216cbe602979218a527744b2879387f1c98e6fe2/mailnews/base/prefs/content/am-identity-edit.js">comparison</a> |
<a href="/comm-central/log/216cbe602979218a527744b2879387f1c98e6fe2/mailnews/base/prefs/content/am-identity-edit.js">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/216cbe602979218a527744b2879387f1c98e6fe2/mailnews/base/prefs/content/am-junk.js">mailnews/base/prefs/content/am-junk.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/216cbe602979218a527744b2879387f1c98e6fe2/mailnews/base/prefs/content/am-junk.js">file</a> |
<a href="/comm-central/annotate/216cbe602979218a527744b2879387f1c98e6fe2/mailnews/base/prefs/content/am-junk.js">annotate</a> |
<a href="/comm-central/diff/216cbe602979218a527744b2879387f1c98e6fe2/mailnews/base/prefs/content/am-junk.js">diff</a> |
<a href="/comm-central/comparison/216cbe602979218a527744b2879387f1c98e6fe2/mailnews/base/prefs/content/am-junk.js">comparison</a> |
<a href="/comm-central/log/216cbe602979218a527744b2879387f1c98e6fe2/mailnews/base/prefs/content/am-junk.js">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/216cbe602979218a527744b2879387f1c98e6fe2/mailnews/base/prefs/content/am-smtp.js">mailnews/base/prefs/content/am-smtp.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/216cbe602979218a527744b2879387f1c98e6fe2/mailnews/base/prefs/content/am-smtp.js">file</a> |
<a href="/comm-central/annotate/216cbe602979218a527744b2879387f1c98e6fe2/mailnews/base/prefs/content/am-smtp.js">annotate</a> |
<a href="/comm-central/diff/216cbe602979218a527744b2879387f1c98e6fe2/mailnews/base/prefs/content/am-smtp.js">diff</a> |
<a href="/comm-central/comparison/216cbe602979218a527744b2879387f1c98e6fe2/mailnews/base/prefs/content/am-smtp.js">comparison</a> |
<a href="/comm-central/log/216cbe602979218a527744b2879387f1c98e6fe2/mailnews/base/prefs/content/am-smtp.js">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/216cbe602979218a527744b2879387f1c98e6fe2/mailnews/base/prefs/content/converterDialog.js">mailnews/base/prefs/content/converterDialog.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/216cbe602979218a527744b2879387f1c98e6fe2/mailnews/base/prefs/content/converterDialog.js">file</a> |
<a href="/comm-central/annotate/216cbe602979218a527744b2879387f1c98e6fe2/mailnews/base/prefs/content/converterDialog.js">annotate</a> |
<a href="/comm-central/diff/216cbe602979218a527744b2879387f1c98e6fe2/mailnews/base/prefs/content/converterDialog.js">diff</a> |
<a href="/comm-central/comparison/216cbe602979218a527744b2879387f1c98e6fe2/mailnews/base/prefs/content/converterDialog.js">comparison</a> |
<a href="/comm-central/log/216cbe602979218a527744b2879387f1c98e6fe2/mailnews/base/prefs/content/converterDialog.js">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/216cbe602979218a527744b2879387f1c98e6fe2/mailnews/base/search/content/FilterEditor.js">mailnews/base/search/content/FilterEditor.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/216cbe602979218a527744b2879387f1c98e6fe2/mailnews/base/search/content/FilterEditor.js">file</a> |
<a href="/comm-central/annotate/216cbe602979218a527744b2879387f1c98e6fe2/mailnews/base/search/content/FilterEditor.js">annotate</a> |
<a href="/comm-central/diff/216cbe602979218a527744b2879387f1c98e6fe2/mailnews/base/search/content/FilterEditor.js">diff</a> |
<a href="/comm-central/comparison/216cbe602979218a527744b2879387f1c98e6fe2/mailnews/base/search/content/FilterEditor.js">comparison</a> |
<a href="/comm-central/log/216cbe602979218a527744b2879387f1c98e6fe2/mailnews/base/search/content/FilterEditor.js">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/216cbe602979218a527744b2879387f1c98e6fe2/mailnews/base/search/content/searchWidgets.js">mailnews/base/search/content/searchWidgets.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/216cbe602979218a527744b2879387f1c98e6fe2/mailnews/base/search/content/searchWidgets.js">file</a> |
<a href="/comm-central/annotate/216cbe602979218a527744b2879387f1c98e6fe2/mailnews/base/search/content/searchWidgets.js">annotate</a> |
<a href="/comm-central/diff/216cbe602979218a527744b2879387f1c98e6fe2/mailnews/base/search/content/searchWidgets.js">diff</a> |
<a href="/comm-central/comparison/216cbe602979218a527744b2879387f1c98e6fe2/mailnews/base/search/content/searchWidgets.js">comparison</a> |
<a href="/comm-central/log/216cbe602979218a527744b2879387f1c98e6fe2/mailnews/base/search/content/searchWidgets.js">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/216cbe602979218a527744b2879387f1c98e6fe2/mailnews/base/test/unit/test_compactFailure.js">mailnews/base/test/unit/test_compactFailure.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/216cbe602979218a527744b2879387f1c98e6fe2/mailnews/base/test/unit/test_compactFailure.js">file</a> |
<a href="/comm-central/annotate/216cbe602979218a527744b2879387f1c98e6fe2/mailnews/base/test/unit/test_compactFailure.js">annotate</a> |
<a href="/comm-central/diff/216cbe602979218a527744b2879387f1c98e6fe2/mailnews/base/test/unit/test_compactFailure.js">diff</a> |
<a href="/comm-central/comparison/216cbe602979218a527744b2879387f1c98e6fe2/mailnews/base/test/unit/test_compactFailure.js">comparison</a> |
<a href="/comm-central/log/216cbe602979218a527744b2879387f1c98e6fe2/mailnews/base/test/unit/test_compactFailure.js">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/216cbe602979218a527744b2879387f1c98e6fe2/mailnews/base/test/unit/test_converterDeferredAccount.js">mailnews/base/test/unit/test_converterDeferredAccount.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/216cbe602979218a527744b2879387f1c98e6fe2/mailnews/base/test/unit/test_converterDeferredAccount.js">file</a> |
<a href="/comm-central/annotate/216cbe602979218a527744b2879387f1c98e6fe2/mailnews/base/test/unit/test_converterDeferredAccount.js">annotate</a> |
<a href="/comm-central/diff/216cbe602979218a527744b2879387f1c98e6fe2/mailnews/base/test/unit/test_converterDeferredAccount.js">diff</a> |
<a href="/comm-central/comparison/216cbe602979218a527744b2879387f1c98e6fe2/mailnews/base/test/unit/test_converterDeferredAccount.js">comparison</a> |
<a href="/comm-central/log/216cbe602979218a527744b2879387f1c98e6fe2/mailnews/base/test/unit/test_converterDeferredAccount.js">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/216cbe602979218a527744b2879387f1c98e6fe2/mailnews/base/test/unit/test_copyThenMoveManual.js">mailnews/base/test/unit/test_copyThenMoveManual.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/216cbe602979218a527744b2879387f1c98e6fe2/mailnews/base/test/unit/test_copyThenMoveManual.js">file</a> |
<a href="/comm-central/annotate/216cbe602979218a527744b2879387f1c98e6fe2/mailnews/base/test/unit/test_copyThenMoveManual.js">annotate</a> |
<a href="/comm-central/diff/216cbe602979218a527744b2879387f1c98e6fe2/mailnews/base/test/unit/test_copyThenMoveManual.js">diff</a> |
<a href="/comm-central/comparison/216cbe602979218a527744b2879387f1c98e6fe2/mailnews/base/test/unit/test_copyThenMoveManual.js">comparison</a> |
<a href="/comm-central/log/216cbe602979218a527744b2879387f1c98e6fe2/mailnews/base/test/unit/test_copyThenMoveManual.js">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/216cbe602979218a527744b2879387f1c98e6fe2/mailnews/base/test/unit/test_folderCompact.js">mailnews/base/test/unit/test_folderCompact.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/216cbe602979218a527744b2879387f1c98e6fe2/mailnews/base/test/unit/test_folderCompact.js">file</a> |
<a href="/comm-central/annotate/216cbe602979218a527744b2879387f1c98e6fe2/mailnews/base/test/unit/test_folderCompact.js">annotate</a> |
<a href="/comm-central/diff/216cbe602979218a527744b2879387f1c98e6fe2/mailnews/base/test/unit/test_folderCompact.js">diff</a> |
<a href="/comm-central/comparison/216cbe602979218a527744b2879387f1c98e6fe2/mailnews/base/test/unit/test_folderCompact.js">comparison</a> |
<a href="/comm-central/log/216cbe602979218a527744b2879387f1c98e6fe2/mailnews/base/test/unit/test_folderCompact.js">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/216cbe602979218a527744b2879387f1c98e6fe2/mailnews/base/test/unit/test_junkWhitelisting.js">mailnews/base/test/unit/test_junkWhitelisting.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/216cbe602979218a527744b2879387f1c98e6fe2/mailnews/base/test/unit/test_junkWhitelisting.js">file</a> |
<a href="/comm-central/annotate/216cbe602979218a527744b2879387f1c98e6fe2/mailnews/base/test/unit/test_junkWhitelisting.js">annotate</a> |
<a href="/comm-central/diff/216cbe602979218a527744b2879387f1c98e6fe2/mailnews/base/test/unit/test_junkWhitelisting.js">diff</a> |
<a href="/comm-central/comparison/216cbe602979218a527744b2879387f1c98e6fe2/mailnews/base/test/unit/test_junkWhitelisting.js">comparison</a> |
<a href="/comm-central/log/216cbe602979218a527744b2879387f1c98e6fe2/mailnews/base/test/unit/test_junkWhitelisting.js">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/216cbe602979218a527744b2879387f1c98e6fe2/mailnews/base/test/unit/test_mailstoreConverter.js">mailnews/base/test/unit/test_mailstoreConverter.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/216cbe602979218a527744b2879387f1c98e6fe2/mailnews/base/test/unit/test_mailstoreConverter.js">file</a> |
<a href="/comm-central/annotate/216cbe602979218a527744b2879387f1c98e6fe2/mailnews/base/test/unit/test_mailstoreConverter.js">annotate</a> |
<a href="/comm-central/diff/216cbe602979218a527744b2879387f1c98e6fe2/mailnews/base/test/unit/test_mailstoreConverter.js">diff</a> |
<a href="/comm-central/comparison/216cbe602979218a527744b2879387f1c98e6fe2/mailnews/base/test/unit/test_mailstoreConverter.js">comparison</a> |
<a href="/comm-central/log/216cbe602979218a527744b2879387f1c98e6fe2/mailnews/base/test/unit/test_mailstoreConverter.js">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/216cbe602979218a527744b2879387f1c98e6fe2/mailnews/base/test/unit/test_nsMsgDBView.js">mailnews/base/test/unit/test_nsMsgDBView.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/216cbe602979218a527744b2879387f1c98e6fe2/mailnews/base/test/unit/test_nsMsgDBView.js">file</a> |
<a href="/comm-central/annotate/216cbe602979218a527744b2879387f1c98e6fe2/mailnews/base/test/unit/test_nsMsgDBView.js">annotate</a> |
<a href="/comm-central/diff/216cbe602979218a527744b2879387f1c98e6fe2/mailnews/base/test/unit/test_nsMsgDBView.js">diff</a> |
<a href="/comm-central/comparison/216cbe602979218a527744b2879387f1c98e6fe2/mailnews/base/test/unit/test_nsMsgDBView.js">comparison</a> |
<a href="/comm-central/log/216cbe602979218a527744b2879387f1c98e6fe2/mailnews/base/test/unit/test_nsMsgDBView.js">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/216cbe602979218a527744b2879387f1c98e6fe2/mailnews/base/test/unit/test_quarantineFilterMove.js">mailnews/base/test/unit/test_quarantineFilterMove.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/216cbe602979218a527744b2879387f1c98e6fe2/mailnews/base/test/unit/test_quarantineFilterMove.js">file</a> |
<a href="/comm-central/annotate/216cbe602979218a527744b2879387f1c98e6fe2/mailnews/base/test/unit/test_quarantineFilterMove.js">annotate</a> |
<a href="/comm-central/diff/216cbe602979218a527744b2879387f1c98e6fe2/mailnews/base/test/unit/test_quarantineFilterMove.js">diff</a> |
<a href="/comm-central/comparison/216cbe602979218a527744b2879387f1c98e6fe2/mailnews/base/test/unit/test_quarantineFilterMove.js">comparison</a> |
<a href="/comm-central/log/216cbe602979218a527744b2879387f1c98e6fe2/mailnews/base/test/unit/test_quarantineFilterMove.js">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/216cbe602979218a527744b2879387f1c98e6fe2/mailnews/base/test/unit/test_searchUint32HdrProperty.js">mailnews/base/test/unit/test_searchUint32HdrProperty.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/216cbe602979218a527744b2879387f1c98e6fe2/mailnews/base/test/unit/test_searchUint32HdrProperty.js">file</a> |
<a href="/comm-central/annotate/216cbe602979218a527744b2879387f1c98e6fe2/mailnews/base/test/unit/test_searchUint32HdrProperty.js">annotate</a> |
<a href="/comm-central/diff/216cbe602979218a527744b2879387f1c98e6fe2/mailnews/base/test/unit/test_searchUint32HdrProperty.js">diff</a> |
<a href="/comm-central/comparison/216cbe602979218a527744b2879387f1c98e6fe2/mailnews/base/test/unit/test_searchUint32HdrProperty.js">comparison</a> |
<a href="/comm-central/log/216cbe602979218a527744b2879387f1c98e6fe2/mailnews/base/test/unit/test_searchUint32HdrProperty.js">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/216cbe602979218a527744b2879387f1c98e6fe2/mailnews/base/util/StringBundle.js">mailnews/base/util/StringBundle.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/216cbe602979218a527744b2879387f1c98e6fe2/mailnews/base/util/StringBundle.js">file</a> |
<a href="/comm-central/annotate/216cbe602979218a527744b2879387f1c98e6fe2/mailnews/base/util/StringBundle.js">annotate</a> |
<a href="/comm-central/diff/216cbe602979218a527744b2879387f1c98e6fe2/mailnews/base/util/StringBundle.js">diff</a> |
<a href="/comm-central/comparison/216cbe602979218a527744b2879387f1c98e6fe2/mailnews/base/util/StringBundle.js">comparison</a> |
<a href="/comm-central/log/216cbe602979218a527744b2879387f1c98e6fe2/mailnews/base/util/StringBundle.js">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/216cbe602979218a527744b2879387f1c98e6fe2/mailnews/base/util/mailnewsMigrator.js">mailnews/base/util/mailnewsMigrator.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/216cbe602979218a527744b2879387f1c98e6fe2/mailnews/base/util/mailnewsMigrator.js">file</a> |
<a href="/comm-central/annotate/216cbe602979218a527744b2879387f1c98e6fe2/mailnews/base/util/mailnewsMigrator.js">annotate</a> |
<a href="/comm-central/diff/216cbe602979218a527744b2879387f1c98e6fe2/mailnews/base/util/mailnewsMigrator.js">diff</a> |
<a href="/comm-central/comparison/216cbe602979218a527744b2879387f1c98e6fe2/mailnews/base/util/mailnewsMigrator.js">comparison</a> |
<a href="/comm-central/log/216cbe602979218a527744b2879387f1c98e6fe2/mailnews/base/util/mailnewsMigrator.js">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/216cbe602979218a527744b2879387f1c98e6fe2/mailnews/compose/test/unit/head_compose.js">mailnews/compose/test/unit/head_compose.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/216cbe602979218a527744b2879387f1c98e6fe2/mailnews/compose/test/unit/head_compose.js">file</a> |
<a href="/comm-central/annotate/216cbe602979218a527744b2879387f1c98e6fe2/mailnews/compose/test/unit/head_compose.js">annotate</a> |
<a href="/comm-central/diff/216cbe602979218a527744b2879387f1c98e6fe2/mailnews/compose/test/unit/head_compose.js">diff</a> |
<a href="/comm-central/comparison/216cbe602979218a527744b2879387f1c98e6fe2/mailnews/compose/test/unit/head_compose.js">comparison</a> |
<a href="/comm-central/log/216cbe602979218a527744b2879387f1c98e6fe2/mailnews/compose/test/unit/head_compose.js">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/216cbe602979218a527744b2879387f1c98e6fe2/mailnews/compose/test/unit/test_nsSmtpService1.js">mailnews/compose/test/unit/test_nsSmtpService1.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/216cbe602979218a527744b2879387f1c98e6fe2/mailnews/compose/test/unit/test_nsSmtpService1.js">file</a> |
<a href="/comm-central/annotate/216cbe602979218a527744b2879387f1c98e6fe2/mailnews/compose/test/unit/test_nsSmtpService1.js">annotate</a> |
<a href="/comm-central/diff/216cbe602979218a527744b2879387f1c98e6fe2/mailnews/compose/test/unit/test_nsSmtpService1.js">diff</a> |
<a href="/comm-central/comparison/216cbe602979218a527744b2879387f1c98e6fe2/mailnews/compose/test/unit/test_nsSmtpService1.js">comparison</a> |
<a href="/comm-central/log/216cbe602979218a527744b2879387f1c98e6fe2/mailnews/compose/test/unit/test_nsSmtpService1.js">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/216cbe602979218a527744b2879387f1c98e6fe2/mailnews/db/gloda/modules/utils.js">mailnews/db/gloda/modules/utils.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/216cbe602979218a527744b2879387f1c98e6fe2/mailnews/db/gloda/modules/utils.js">file</a> |
<a href="/comm-central/annotate/216cbe602979218a527744b2879387f1c98e6fe2/mailnews/db/gloda/modules/utils.js">annotate</a> |
<a href="/comm-central/diff/216cbe602979218a527744b2879387f1c98e6fe2/mailnews/db/gloda/modules/utils.js">diff</a> |
<a href="/comm-central/comparison/216cbe602979218a527744b2879387f1c98e6fe2/mailnews/db/gloda/modules/utils.js">comparison</a> |
<a href="/comm-central/log/216cbe602979218a527744b2879387f1c98e6fe2/mailnews/db/gloda/modules/utils.js">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/216cbe602979218a527744b2879387f1c98e6fe2/mailnews/db/gloda/test/unit/test_index_addressbook.js">mailnews/db/gloda/test/unit/test_index_addressbook.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/216cbe602979218a527744b2879387f1c98e6fe2/mailnews/db/gloda/test/unit/test_index_addressbook.js">file</a> |
<a href="/comm-central/annotate/216cbe602979218a527744b2879387f1c98e6fe2/mailnews/db/gloda/test/unit/test_index_addressbook.js">annotate</a> |
<a href="/comm-central/diff/216cbe602979218a527744b2879387f1c98e6fe2/mailnews/db/gloda/test/unit/test_index_addressbook.js">diff</a> |
<a href="/comm-central/comparison/216cbe602979218a527744b2879387f1c98e6fe2/mailnews/db/gloda/test/unit/test_index_addressbook.js">comparison</a> |
<a href="/comm-central/log/216cbe602979218a527744b2879387f1c98e6fe2/mailnews/db/gloda/test/unit/test_index_addressbook.js">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/216cbe602979218a527744b2879387f1c98e6fe2/mailnews/db/msgdb/test/unit/test_propertyEnumerator.js">mailnews/db/msgdb/test/unit/test_propertyEnumerator.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/216cbe602979218a527744b2879387f1c98e6fe2/mailnews/db/msgdb/test/unit/test_propertyEnumerator.js">file</a> |
<a href="/comm-central/annotate/216cbe602979218a527744b2879387f1c98e6fe2/mailnews/db/msgdb/test/unit/test_propertyEnumerator.js">annotate</a> |
<a href="/comm-central/diff/216cbe602979218a527744b2879387f1c98e6fe2/mailnews/db/msgdb/test/unit/test_propertyEnumerator.js">diff</a> |
<a href="/comm-central/comparison/216cbe602979218a527744b2879387f1c98e6fe2/mailnews/db/msgdb/test/unit/test_propertyEnumerator.js">comparison</a> |
<a href="/comm-central/log/216cbe602979218a527744b2879387f1c98e6fe2/mailnews/db/msgdb/test/unit/test_propertyEnumerator.js">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/216cbe602979218a527744b2879387f1c98e6fe2/mailnews/extensions/newsblog/content/feed-subscriptions.js">mailnews/extensions/newsblog/content/feed-subscriptions.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/216cbe602979218a527744b2879387f1c98e6fe2/mailnews/extensions/newsblog/content/feed-subscriptions.js">file</a> |
<a href="/comm-central/annotate/216cbe602979218a527744b2879387f1c98e6fe2/mailnews/extensions/newsblog/content/feed-subscriptions.js">annotate</a> |
<a href="/comm-central/diff/216cbe602979218a527744b2879387f1c98e6fe2/mailnews/extensions/newsblog/content/feed-subscriptions.js">diff</a> |
<a href="/comm-central/comparison/216cbe602979218a527744b2879387f1c98e6fe2/mailnews/extensions/newsblog/content/feed-subscriptions.js">comparison</a> |
<a href="/comm-central/log/216cbe602979218a527744b2879387f1c98e6fe2/mailnews/extensions/newsblog/content/feed-subscriptions.js">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/216cbe602979218a527744b2879387f1c98e6fe2/mailnews/imap/test/unit/test_autosync_date_constraints.js">mailnews/imap/test/unit/test_autosync_date_constraints.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/216cbe602979218a527744b2879387f1c98e6fe2/mailnews/imap/test/unit/test_autosync_date_constraints.js">file</a> |
<a href="/comm-central/annotate/216cbe602979218a527744b2879387f1c98e6fe2/mailnews/imap/test/unit/test_autosync_date_constraints.js">annotate</a> |
<a href="/comm-central/diff/216cbe602979218a527744b2879387f1c98e6fe2/mailnews/imap/test/unit/test_autosync_date_constraints.js">diff</a> |
<a href="/comm-central/comparison/216cbe602979218a527744b2879387f1c98e6fe2/mailnews/imap/test/unit/test_autosync_date_constraints.js">comparison</a> |
<a href="/comm-central/log/216cbe602979218a527744b2879387f1c98e6fe2/mailnews/imap/test/unit/test_autosync_date_constraints.js">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/216cbe602979218a527744b2879387f1c98e6fe2/mailnews/imap/test/unit/test_bccProperty.js">mailnews/imap/test/unit/test_bccProperty.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/216cbe602979218a527744b2879387f1c98e6fe2/mailnews/imap/test/unit/test_bccProperty.js">file</a> |
<a href="/comm-central/annotate/216cbe602979218a527744b2879387f1c98e6fe2/mailnews/imap/test/unit/test_bccProperty.js">annotate</a> |
<a href="/comm-central/diff/216cbe602979218a527744b2879387f1c98e6fe2/mailnews/imap/test/unit/test_bccProperty.js">diff</a> |
<a href="/comm-central/comparison/216cbe602979218a527744b2879387f1c98e6fe2/mailnews/imap/test/unit/test_bccProperty.js">comparison</a> |
<a href="/comm-central/log/216cbe602979218a527744b2879387f1c98e6fe2/mailnews/imap/test/unit/test_bccProperty.js">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/216cbe602979218a527744b2879387f1c98e6fe2/mailnews/imap/test/unit/test_compactOfflineStore.js">mailnews/imap/test/unit/test_compactOfflineStore.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/216cbe602979218a527744b2879387f1c98e6fe2/mailnews/imap/test/unit/test_compactOfflineStore.js">file</a> |
<a href="/comm-central/annotate/216cbe602979218a527744b2879387f1c98e6fe2/mailnews/imap/test/unit/test_compactOfflineStore.js">annotate</a> |
<a href="/comm-central/diff/216cbe602979218a527744b2879387f1c98e6fe2/mailnews/imap/test/unit/test_compactOfflineStore.js">diff</a> |
<a href="/comm-central/comparison/216cbe602979218a527744b2879387f1c98e6fe2/mailnews/imap/test/unit/test_compactOfflineStore.js">comparison</a> |
<a href="/comm-central/log/216cbe602979218a527744b2879387f1c98e6fe2/mailnews/imap/test/unit/test_compactOfflineStore.js">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/216cbe602979218a527744b2879387f1c98e6fe2/mailnews/imap/test/unit/test_converterImap.js">mailnews/imap/test/unit/test_converterImap.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/216cbe602979218a527744b2879387f1c98e6fe2/mailnews/imap/test/unit/test_converterImap.js">file</a> |
<a href="/comm-central/annotate/216cbe602979218a527744b2879387f1c98e6fe2/mailnews/imap/test/unit/test_converterImap.js">annotate</a> |
<a href="/comm-central/diff/216cbe602979218a527744b2879387f1c98e6fe2/mailnews/imap/test/unit/test_converterImap.js">diff</a> |
<a href="/comm-central/comparison/216cbe602979218a527744b2879387f1c98e6fe2/mailnews/imap/test/unit/test_converterImap.js">comparison</a> |
<a href="/comm-central/log/216cbe602979218a527744b2879387f1c98e6fe2/mailnews/imap/test/unit/test_converterImap.js">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/216cbe602979218a527744b2879387f1c98e6fe2/mailnews/imap/test/unit/test_copyThenMove.js">mailnews/imap/test/unit/test_copyThenMove.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/216cbe602979218a527744b2879387f1c98e6fe2/mailnews/imap/test/unit/test_copyThenMove.js">file</a> |
<a href="/comm-central/annotate/216cbe602979218a527744b2879387f1c98e6fe2/mailnews/imap/test/unit/test_copyThenMove.js">annotate</a> |
<a href="/comm-central/diff/216cbe602979218a527744b2879387f1c98e6fe2/mailnews/imap/test/unit/test_copyThenMove.js">diff</a> |
<a href="/comm-central/comparison/216cbe602979218a527744b2879387f1c98e6fe2/mailnews/imap/test/unit/test_copyThenMove.js">comparison</a> |
<a href="/comm-central/log/216cbe602979218a527744b2879387f1c98e6fe2/mailnews/imap/test/unit/test_copyThenMove.js">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/216cbe602979218a527744b2879387f1c98e6fe2/mailnews/imap/test/unit/test_dod.js">mailnews/imap/test/unit/test_dod.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/216cbe602979218a527744b2879387f1c98e6fe2/mailnews/imap/test/unit/test_dod.js">file</a> |
<a href="/comm-central/annotate/216cbe602979218a527744b2879387f1c98e6fe2/mailnews/imap/test/unit/test_dod.js">annotate</a> |
<a href="/comm-central/diff/216cbe602979218a527744b2879387f1c98e6fe2/mailnews/imap/test/unit/test_dod.js">diff</a> |
<a href="/comm-central/comparison/216cbe602979218a527744b2879387f1c98e6fe2/mailnews/imap/test/unit/test_dod.js">comparison</a> |
<a href="/comm-central/log/216cbe602979218a527744b2879387f1c98e6fe2/mailnews/imap/test/unit/test_dod.js">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/216cbe602979218a527744b2879387f1c98e6fe2/mailnews/imap/test/unit/test_downloadOffline.js">mailnews/imap/test/unit/test_downloadOffline.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/216cbe602979218a527744b2879387f1c98e6fe2/mailnews/imap/test/unit/test_downloadOffline.js">file</a> |
<a href="/comm-central/annotate/216cbe602979218a527744b2879387f1c98e6fe2/mailnews/imap/test/unit/test_downloadOffline.js">annotate</a> |
<a href="/comm-central/diff/216cbe602979218a527744b2879387f1c98e6fe2/mailnews/imap/test/unit/test_downloadOffline.js">diff</a> |
<a href="/comm-central/comparison/216cbe602979218a527744b2879387f1c98e6fe2/mailnews/imap/test/unit/test_downloadOffline.js">comparison</a> |
<a href="/comm-central/log/216cbe602979218a527744b2879387f1c98e6fe2/mailnews/imap/test/unit/test_downloadOffline.js">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/216cbe602979218a527744b2879387f1c98e6fe2/mailnews/imap/test/unit/test_imapAutoSync.js">mailnews/imap/test/unit/test_imapAutoSync.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/216cbe602979218a527744b2879387f1c98e6fe2/mailnews/imap/test/unit/test_imapAutoSync.js">file</a> |
<a href="/comm-central/annotate/216cbe602979218a527744b2879387f1c98e6fe2/mailnews/imap/test/unit/test_imapAutoSync.js">annotate</a> |
<a href="/comm-central/diff/216cbe602979218a527744b2879387f1c98e6fe2/mailnews/imap/test/unit/test_imapAutoSync.js">diff</a> |
<a href="/comm-central/comparison/216cbe602979218a527744b2879387f1c98e6fe2/mailnews/imap/test/unit/test_imapAutoSync.js">comparison</a> |
<a href="/comm-central/log/216cbe602979218a527744b2879387f1c98e6fe2/mailnews/imap/test/unit/test_imapAutoSync.js">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/216cbe602979218a527744b2879387f1c98e6fe2/mailnews/imap/test/unit/test_imapFilterActions.js">mailnews/imap/test/unit/test_imapFilterActions.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/216cbe602979218a527744b2879387f1c98e6fe2/mailnews/imap/test/unit/test_imapFilterActions.js">file</a> |
<a href="/comm-central/annotate/216cbe602979218a527744b2879387f1c98e6fe2/mailnews/imap/test/unit/test_imapFilterActions.js">annotate</a> |
<a href="/comm-central/diff/216cbe602979218a527744b2879387f1c98e6fe2/mailnews/imap/test/unit/test_imapFilterActions.js">diff</a> |
<a href="/comm-central/comparison/216cbe602979218a527744b2879387f1c98e6fe2/mailnews/imap/test/unit/test_imapFilterActions.js">comparison</a> |
<a href="/comm-central/log/216cbe602979218a527744b2879387f1c98e6fe2/mailnews/imap/test/unit/test_imapFilterActions.js">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/216cbe602979218a527744b2879387f1c98e6fe2/mailnews/imap/test/unit/test_imapFilterActionsPostplugin.js">mailnews/imap/test/unit/test_imapFilterActionsPostplugin.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/216cbe602979218a527744b2879387f1c98e6fe2/mailnews/imap/test/unit/test_imapFilterActionsPostplugin.js">file</a> |
<a href="/comm-central/annotate/216cbe602979218a527744b2879387f1c98e6fe2/mailnews/imap/test/unit/test_imapFilterActionsPostplugin.js">annotate</a> |
<a href="/comm-central/diff/216cbe602979218a527744b2879387f1c98e6fe2/mailnews/imap/test/unit/test_imapFilterActionsPostplugin.js">diff</a> |
<a href="/comm-central/comparison/216cbe602979218a527744b2879387f1c98e6fe2/mailnews/imap/test/unit/test_imapFilterActionsPostplugin.js">comparison</a> |
<a href="/comm-central/log/216cbe602979218a527744b2879387f1c98e6fe2/mailnews/imap/test/unit/test_imapFilterActionsPostplugin.js">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/216cbe602979218a527744b2879387f1c98e6fe2/mailnews/imap/test/unit/test_imapHighWater.js">mailnews/imap/test/unit/test_imapHighWater.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/216cbe602979218a527744b2879387f1c98e6fe2/mailnews/imap/test/unit/test_imapHighWater.js">file</a> |
<a href="/comm-central/annotate/216cbe602979218a527744b2879387f1c98e6fe2/mailnews/imap/test/unit/test_imapHighWater.js">annotate</a> |
<a href="/comm-central/diff/216cbe602979218a527744b2879387f1c98e6fe2/mailnews/imap/test/unit/test_imapHighWater.js">diff</a> |
<a href="/comm-central/comparison/216cbe602979218a527744b2879387f1c98e6fe2/mailnews/imap/test/unit/test_imapHighWater.js">comparison</a> |
<a href="/comm-central/log/216cbe602979218a527744b2879387f1c98e6fe2/mailnews/imap/test/unit/test_imapHighWater.js">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/216cbe602979218a527744b2879387f1c98e6fe2/mailnews/imap/test/unit/test_largeOfflineStore.js">mailnews/imap/test/unit/test_largeOfflineStore.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/216cbe602979218a527744b2879387f1c98e6fe2/mailnews/imap/test/unit/test_largeOfflineStore.js">file</a> |
<a href="/comm-central/annotate/216cbe602979218a527744b2879387f1c98e6fe2/mailnews/imap/test/unit/test_largeOfflineStore.js">annotate</a> |
<a href="/comm-central/diff/216cbe602979218a527744b2879387f1c98e6fe2/mailnews/imap/test/unit/test_largeOfflineStore.js">diff</a> |
<a href="/comm-central/comparison/216cbe602979218a527744b2879387f1c98e6fe2/mailnews/imap/test/unit/test_largeOfflineStore.js">comparison</a> |
<a href="/comm-central/log/216cbe602979218a527744b2879387f1c98e6fe2/mailnews/imap/test/unit/test_largeOfflineStore.js">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/216cbe602979218a527744b2879387f1c98e6fe2/mailnews/imap/test/unit/test_localToImapFilterQuarantine.js">mailnews/imap/test/unit/test_localToImapFilterQuarantine.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/216cbe602979218a527744b2879387f1c98e6fe2/mailnews/imap/test/unit/test_localToImapFilterQuarantine.js">file</a> |
<a href="/comm-central/annotate/216cbe602979218a527744b2879387f1c98e6fe2/mailnews/imap/test/unit/test_localToImapFilterQuarantine.js">annotate</a> |
<a href="/comm-central/diff/216cbe602979218a527744b2879387f1c98e6fe2/mailnews/imap/test/unit/test_localToImapFilterQuarantine.js">diff</a> |
<a href="/comm-central/comparison/216cbe602979218a527744b2879387f1c98e6fe2/mailnews/imap/test/unit/test_localToImapFilterQuarantine.js">comparison</a> |
<a href="/comm-central/log/216cbe602979218a527744b2879387f1c98e6fe2/mailnews/imap/test/unit/test_localToImapFilterQuarantine.js">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/216cbe602979218a527744b2879387f1c98e6fe2/mailnews/imap/test/unit/test_offlineCopy.js">mailnews/imap/test/unit/test_offlineCopy.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/216cbe602979218a527744b2879387f1c98e6fe2/mailnews/imap/test/unit/test_offlineCopy.js">file</a> |
<a href="/comm-central/annotate/216cbe602979218a527744b2879387f1c98e6fe2/mailnews/imap/test/unit/test_offlineCopy.js">annotate</a> |
<a href="/comm-central/diff/216cbe602979218a527744b2879387f1c98e6fe2/mailnews/imap/test/unit/test_offlineCopy.js">diff</a> |
<a href="/comm-central/comparison/216cbe602979218a527744b2879387f1c98e6fe2/mailnews/imap/test/unit/test_offlineCopy.js">comparison</a> |
<a href="/comm-central/log/216cbe602979218a527744b2879387f1c98e6fe2/mailnews/imap/test/unit/test_offlineCopy.js">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/216cbe602979218a527744b2879387f1c98e6fe2/mailnews/import/test/unit/resources/TestMailImporter.jsm">mailnews/import/test/unit/resources/TestMailImporter.jsm</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/216cbe602979218a527744b2879387f1c98e6fe2/mailnews/import/test/unit/resources/TestMailImporter.jsm">file</a> |
<a href="/comm-central/annotate/216cbe602979218a527744b2879387f1c98e6fe2/mailnews/import/test/unit/resources/TestMailImporter.jsm">annotate</a> |
<a href="/comm-central/diff/216cbe602979218a527744b2879387f1c98e6fe2/mailnews/import/test/unit/resources/TestMailImporter.jsm">diff</a> |
<a href="/comm-central/comparison/216cbe602979218a527744b2879387f1c98e6fe2/mailnews/import/test/unit/resources/TestMailImporter.jsm">comparison</a> |
<a href="/comm-central/log/216cbe602979218a527744b2879387f1c98e6fe2/mailnews/import/test/unit/resources/TestMailImporter.jsm">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/216cbe602979218a527744b2879387f1c98e6fe2/mailnews/import/test/unit/resources/import_helper.js">mailnews/import/test/unit/resources/import_helper.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/216cbe602979218a527744b2879387f1c98e6fe2/mailnews/import/test/unit/resources/import_helper.js">file</a> |
<a href="/comm-central/annotate/216cbe602979218a527744b2879387f1c98e6fe2/mailnews/import/test/unit/resources/import_helper.js">annotate</a> |
<a href="/comm-central/diff/216cbe602979218a527744b2879387f1c98e6fe2/mailnews/import/test/unit/resources/import_helper.js">diff</a> |
<a href="/comm-central/comparison/216cbe602979218a527744b2879387f1c98e6fe2/mailnews/import/test/unit/resources/import_helper.js">comparison</a> |
<a href="/comm-central/log/216cbe602979218a527744b2879387f1c98e6fe2/mailnews/import/test/unit/resources/import_helper.js">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/216cbe602979218a527744b2879387f1c98e6fe2/mailnews/import/test/unit/test_outlook_settings.js">mailnews/import/test/unit/test_outlook_settings.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/216cbe602979218a527744b2879387f1c98e6fe2/mailnews/import/test/unit/test_outlook_settings.js">file</a> |
<a href="/comm-central/annotate/216cbe602979218a527744b2879387f1c98e6fe2/mailnews/import/test/unit/test_outlook_settings.js">annotate</a> |
<a href="/comm-central/diff/216cbe602979218a527744b2879387f1c98e6fe2/mailnews/import/test/unit/test_outlook_settings.js">diff</a> |
<a href="/comm-central/comparison/216cbe602979218a527744b2879387f1c98e6fe2/mailnews/import/test/unit/test_outlook_settings.js">comparison</a> |
<a href="/comm-central/log/216cbe602979218a527744b2879387f1c98e6fe2/mailnews/import/test/unit/test_outlook_settings.js">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/216cbe602979218a527744b2879387f1c98e6fe2/mailnews/import/test/unit/test_winmail.js">mailnews/import/test/unit/test_winmail.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/216cbe602979218a527744b2879387f1c98e6fe2/mailnews/import/test/unit/test_winmail.js">file</a> |
<a href="/comm-central/annotate/216cbe602979218a527744b2879387f1c98e6fe2/mailnews/import/test/unit/test_winmail.js">annotate</a> |
<a href="/comm-central/diff/216cbe602979218a527744b2879387f1c98e6fe2/mailnews/import/test/unit/test_winmail.js">diff</a> |
<a href="/comm-central/comparison/216cbe602979218a527744b2879387f1c98e6fe2/mailnews/import/test/unit/test_winmail.js">comparison</a> |
<a href="/comm-central/log/216cbe602979218a527744b2879387f1c98e6fe2/mailnews/import/test/unit/test_winmail.js">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/216cbe602979218a527744b2879387f1c98e6fe2/mailnews/local/test/unit/test_duplicateKey.js">mailnews/local/test/unit/test_duplicateKey.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/216cbe602979218a527744b2879387f1c98e6fe2/mailnews/local/test/unit/test_duplicateKey.js">file</a> |
<a href="/comm-central/annotate/216cbe602979218a527744b2879387f1c98e6fe2/mailnews/local/test/unit/test_duplicateKey.js">annotate</a> |
<a href="/comm-central/diff/216cbe602979218a527744b2879387f1c98e6fe2/mailnews/local/test/unit/test_duplicateKey.js">diff</a> |
<a href="/comm-central/comparison/216cbe602979218a527744b2879387f1c98e6fe2/mailnews/local/test/unit/test_duplicateKey.js">comparison</a> |
<a href="/comm-central/log/216cbe602979218a527744b2879387f1c98e6fe2/mailnews/local/test/unit/test_duplicateKey.js">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/216cbe602979218a527744b2879387f1c98e6fe2/mailnews/local/test/unit/test_folderLoaded.js">mailnews/local/test/unit/test_folderLoaded.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/216cbe602979218a527744b2879387f1c98e6fe2/mailnews/local/test/unit/test_folderLoaded.js">file</a> |
<a href="/comm-central/annotate/216cbe602979218a527744b2879387f1c98e6fe2/mailnews/local/test/unit/test_folderLoaded.js">annotate</a> |
<a href="/comm-central/diff/216cbe602979218a527744b2879387f1c98e6fe2/mailnews/local/test/unit/test_folderLoaded.js">diff</a> |
<a href="/comm-central/comparison/216cbe602979218a527744b2879387f1c98e6fe2/mailnews/local/test/unit/test_folderLoaded.js">comparison</a> |
<a href="/comm-central/log/216cbe602979218a527744b2879387f1c98e6fe2/mailnews/local/test/unit/test_folderLoaded.js">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/216cbe602979218a527744b2879387f1c98e6fe2/mailnews/local/test/unit/test_localFolder.js">mailnews/local/test/unit/test_localFolder.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/216cbe602979218a527744b2879387f1c98e6fe2/mailnews/local/test/unit/test_localFolder.js">file</a> |
<a href="/comm-central/annotate/216cbe602979218a527744b2879387f1c98e6fe2/mailnews/local/test/unit/test_localFolder.js">annotate</a> |
<a href="/comm-central/diff/216cbe602979218a527744b2879387f1c98e6fe2/mailnews/local/test/unit/test_localFolder.js">diff</a> |
<a href="/comm-central/comparison/216cbe602979218a527744b2879387f1c98e6fe2/mailnews/local/test/unit/test_localFolder.js">comparison</a> |
<a href="/comm-central/log/216cbe602979218a527744b2879387f1c98e6fe2/mailnews/local/test/unit/test_localFolder.js">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/216cbe602979218a527744b2879387f1c98e6fe2/mailnews/local/test/unit/test_movemailDownload.js">mailnews/local/test/unit/test_movemailDownload.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/216cbe602979218a527744b2879387f1c98e6fe2/mailnews/local/test/unit/test_movemailDownload.js">file</a> |
<a href="/comm-central/annotate/216cbe602979218a527744b2879387f1c98e6fe2/mailnews/local/test/unit/test_movemailDownload.js">annotate</a> |
<a href="/comm-central/diff/216cbe602979218a527744b2879387f1c98e6fe2/mailnews/local/test/unit/test_movemailDownload.js">diff</a> |
<a href="/comm-central/comparison/216cbe602979218a527744b2879387f1c98e6fe2/mailnews/local/test/unit/test_movemailDownload.js">comparison</a> |
<a href="/comm-central/log/216cbe602979218a527744b2879387f1c98e6fe2/mailnews/local/test/unit/test_movemailDownload.js">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/216cbe602979218a527744b2879387f1c98e6fe2/mailnews/local/test/unit/test_over2GBMailboxes.js">mailnews/local/test/unit/test_over2GBMailboxes.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/216cbe602979218a527744b2879387f1c98e6fe2/mailnews/local/test/unit/test_over2GBMailboxes.js">file</a> |
<a href="/comm-central/annotate/216cbe602979218a527744b2879387f1c98e6fe2/mailnews/local/test/unit/test_over2GBMailboxes.js">annotate</a> |
<a href="/comm-central/diff/216cbe602979218a527744b2879387f1c98e6fe2/mailnews/local/test/unit/test_over2GBMailboxes.js">diff</a> |
<a href="/comm-central/comparison/216cbe602979218a527744b2879387f1c98e6fe2/mailnews/local/test/unit/test_over2GBMailboxes.js">comparison</a> |
<a href="/comm-central/log/216cbe602979218a527744b2879387f1c98e6fe2/mailnews/local/test/unit/test_over2GBMailboxes.js">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/216cbe602979218a527744b2879387f1c98e6fe2/mailnews/local/test/unit/test_over4GBMailboxes.js">mailnews/local/test/unit/test_over4GBMailboxes.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/216cbe602979218a527744b2879387f1c98e6fe2/mailnews/local/test/unit/test_over4GBMailboxes.js">file</a> |
<a href="/comm-central/annotate/216cbe602979218a527744b2879387f1c98e6fe2/mailnews/local/test/unit/test_over4GBMailboxes.js">annotate</a> |
<a href="/comm-central/diff/216cbe602979218a527744b2879387f1c98e6fe2/mailnews/local/test/unit/test_over4GBMailboxes.js">diff</a> |
<a href="/comm-central/comparison/216cbe602979218a527744b2879387f1c98e6fe2/mailnews/local/test/unit/test_over4GBMailboxes.js">comparison</a> |
<a href="/comm-central/log/216cbe602979218a527744b2879387f1c98e6fe2/mailnews/local/test/unit/test_over4GBMailboxes.js">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/216cbe602979218a527744b2879387f1c98e6fe2/mailnews/local/test/unit/test_pop3Download.js">mailnews/local/test/unit/test_pop3Download.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/216cbe602979218a527744b2879387f1c98e6fe2/mailnews/local/test/unit/test_pop3Download.js">file</a> |
<a href="/comm-central/annotate/216cbe602979218a527744b2879387f1c98e6fe2/mailnews/local/test/unit/test_pop3Download.js">annotate</a> |
<a href="/comm-central/diff/216cbe602979218a527744b2879387f1c98e6fe2/mailnews/local/test/unit/test_pop3Download.js">diff</a> |
<a href="/comm-central/comparison/216cbe602979218a527744b2879387f1c98e6fe2/mailnews/local/test/unit/test_pop3Download.js">comparison</a> |
<a href="/comm-central/log/216cbe602979218a527744b2879387f1c98e6fe2/mailnews/local/test/unit/test_pop3Download.js">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/216cbe602979218a527744b2879387f1c98e6fe2/mailnews/local/test/unit/test_pop3DownloadTempFileHandling.js">mailnews/local/test/unit/test_pop3DownloadTempFileHandling.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/216cbe602979218a527744b2879387f1c98e6fe2/mailnews/local/test/unit/test_pop3DownloadTempFileHandling.js">file</a> |
<a href="/comm-central/annotate/216cbe602979218a527744b2879387f1c98e6fe2/mailnews/local/test/unit/test_pop3DownloadTempFileHandling.js">annotate</a> |
<a href="/comm-central/diff/216cbe602979218a527744b2879387f1c98e6fe2/mailnews/local/test/unit/test_pop3DownloadTempFileHandling.js">diff</a> |
<a href="/comm-central/comparison/216cbe602979218a527744b2879387f1c98e6fe2/mailnews/local/test/unit/test_pop3DownloadTempFileHandling.js">comparison</a> |
<a href="/comm-central/log/216cbe602979218a527744b2879387f1c98e6fe2/mailnews/local/test/unit/test_pop3DownloadTempFileHandling.js">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/216cbe602979218a527744b2879387f1c98e6fe2/mailnews/local/test/unit/test_pop3Duplicates.js">mailnews/local/test/unit/test_pop3Duplicates.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/216cbe602979218a527744b2879387f1c98e6fe2/mailnews/local/test/unit/test_pop3Duplicates.js">file</a> |
<a href="/comm-central/annotate/216cbe602979218a527744b2879387f1c98e6fe2/mailnews/local/test/unit/test_pop3Duplicates.js">annotate</a> |
<a href="/comm-central/diff/216cbe602979218a527744b2879387f1c98e6fe2/mailnews/local/test/unit/test_pop3Duplicates.js">diff</a> |
<a href="/comm-central/comparison/216cbe602979218a527744b2879387f1c98e6fe2/mailnews/local/test/unit/test_pop3Duplicates.js">comparison</a> |
<a href="/comm-central/log/216cbe602979218a527744b2879387f1c98e6fe2/mailnews/local/test/unit/test_pop3Duplicates.js">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/216cbe602979218a527744b2879387f1c98e6fe2/mailnews/local/test/unit/test_pop3FilterActions.js">mailnews/local/test/unit/test_pop3FilterActions.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/216cbe602979218a527744b2879387f1c98e6fe2/mailnews/local/test/unit/test_pop3FilterActions.js">file</a> |
<a href="/comm-central/annotate/216cbe602979218a527744b2879387f1c98e6fe2/mailnews/local/test/unit/test_pop3FilterActions.js">annotate</a> |
<a href="/comm-central/diff/216cbe602979218a527744b2879387f1c98e6fe2/mailnews/local/test/unit/test_pop3FilterActions.js">diff</a> |
<a href="/comm-central/comparison/216cbe602979218a527744b2879387f1c98e6fe2/mailnews/local/test/unit/test_pop3FilterActions.js">comparison</a> |
<a href="/comm-central/log/216cbe602979218a527744b2879387f1c98e6fe2/mailnews/local/test/unit/test_pop3FilterActions.js">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/216cbe602979218a527744b2879387f1c98e6fe2/mailnews/local/test/unit/test_pop3MoveFilter.js">mailnews/local/test/unit/test_pop3MoveFilter.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/216cbe602979218a527744b2879387f1c98e6fe2/mailnews/local/test/unit/test_pop3MoveFilter.js">file</a> |
<a href="/comm-central/annotate/216cbe602979218a527744b2879387f1c98e6fe2/mailnews/local/test/unit/test_pop3MoveFilter.js">annotate</a> |
<a href="/comm-central/diff/216cbe602979218a527744b2879387f1c98e6fe2/mailnews/local/test/unit/test_pop3MoveFilter.js">diff</a> |
<a href="/comm-central/comparison/216cbe602979218a527744b2879387f1c98e6fe2/mailnews/local/test/unit/test_pop3MoveFilter.js">comparison</a> |
<a href="/comm-central/log/216cbe602979218a527744b2879387f1c98e6fe2/mailnews/local/test/unit/test_pop3MoveFilter.js">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/216cbe602979218a527744b2879387f1c98e6fe2/mailnews/local/test/unit/test_pop3MoveFilter2.js">mailnews/local/test/unit/test_pop3MoveFilter2.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/216cbe602979218a527744b2879387f1c98e6fe2/mailnews/local/test/unit/test_pop3MoveFilter2.js">file</a> |
<a href="/comm-central/annotate/216cbe602979218a527744b2879387f1c98e6fe2/mailnews/local/test/unit/test_pop3MoveFilter2.js">annotate</a> |
<a href="/comm-central/diff/216cbe602979218a527744b2879387f1c98e6fe2/mailnews/local/test/unit/test_pop3MoveFilter2.js">diff</a> |
<a href="/comm-central/comparison/216cbe602979218a527744b2879387f1c98e6fe2/mailnews/local/test/unit/test_pop3MoveFilter2.js">comparison</a> |
<a href="/comm-central/log/216cbe602979218a527744b2879387f1c98e6fe2/mailnews/local/test/unit/test_pop3MoveFilter2.js">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/216cbe602979218a527744b2879387f1c98e6fe2/mailnews/local/test/unit/test_pop3MultiCopy.js">mailnews/local/test/unit/test_pop3MultiCopy.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/216cbe602979218a527744b2879387f1c98e6fe2/mailnews/local/test/unit/test_pop3MultiCopy.js">file</a> |
<a href="/comm-central/annotate/216cbe602979218a527744b2879387f1c98e6fe2/mailnews/local/test/unit/test_pop3MultiCopy.js">annotate</a> |
<a href="/comm-central/diff/216cbe602979218a527744b2879387f1c98e6fe2/mailnews/local/test/unit/test_pop3MultiCopy.js">diff</a> |
<a href="/comm-central/comparison/216cbe602979218a527744b2879387f1c98e6fe2/mailnews/local/test/unit/test_pop3MultiCopy.js">comparison</a> |
<a href="/comm-central/log/216cbe602979218a527744b2879387f1c98e6fe2/mailnews/local/test/unit/test_pop3MultiCopy.js">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/216cbe602979218a527744b2879387f1c98e6fe2/mailnews/local/test/unit/test_pop3MultiCopy2.js">mailnews/local/test/unit/test_pop3MultiCopy2.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/216cbe602979218a527744b2879387f1c98e6fe2/mailnews/local/test/unit/test_pop3MultiCopy2.js">file</a> |
<a href="/comm-central/annotate/216cbe602979218a527744b2879387f1c98e6fe2/mailnews/local/test/unit/test_pop3MultiCopy2.js">annotate</a> |
<a href="/comm-central/diff/216cbe602979218a527744b2879387f1c98e6fe2/mailnews/local/test/unit/test_pop3MultiCopy2.js">diff</a> |
<a href="/comm-central/comparison/216cbe602979218a527744b2879387f1c98e6fe2/mailnews/local/test/unit/test_pop3MultiCopy2.js">comparison</a> |
<a href="/comm-central/log/216cbe602979218a527744b2879387f1c98e6fe2/mailnews/local/test/unit/test_pop3MultiCopy2.js">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/216cbe602979218a527744b2879387f1c98e6fe2/mailnews/local/test/unit/test_pop3Pump.js">mailnews/local/test/unit/test_pop3Pump.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/216cbe602979218a527744b2879387f1c98e6fe2/mailnews/local/test/unit/test_pop3Pump.js">file</a> |
<a href="/comm-central/annotate/216cbe602979218a527744b2879387f1c98e6fe2/mailnews/local/test/unit/test_pop3Pump.js">annotate</a> |
<a href="/comm-central/diff/216cbe602979218a527744b2879387f1c98e6fe2/mailnews/local/test/unit/test_pop3Pump.js">diff</a> |
<a href="/comm-central/comparison/216cbe602979218a527744b2879387f1c98e6fe2/mailnews/local/test/unit/test_pop3Pump.js">comparison</a> |
<a href="/comm-central/log/216cbe602979218a527744b2879387f1c98e6fe2/mailnews/local/test/unit/test_pop3Pump.js">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/216cbe602979218a527744b2879387f1c98e6fe2/mailnews/local/test/unit/test_streamHeaders.js">mailnews/local/test/unit/test_streamHeaders.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/216cbe602979218a527744b2879387f1c98e6fe2/mailnews/local/test/unit/test_streamHeaders.js">file</a> |
<a href="/comm-central/annotate/216cbe602979218a527744b2879387f1c98e6fe2/mailnews/local/test/unit/test_streamHeaders.js">annotate</a> |
<a href="/comm-central/diff/216cbe602979218a527744b2879387f1c98e6fe2/mailnews/local/test/unit/test_streamHeaders.js">diff</a> |
<a href="/comm-central/comparison/216cbe602979218a527744b2879387f1c98e6fe2/mailnews/local/test/unit/test_streamHeaders.js">comparison</a> |
<a href="/comm-central/log/216cbe602979218a527744b2879387f1c98e6fe2/mailnews/local/test/unit/test_streamHeaders.js">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/216cbe602979218a527744b2879387f1c98e6fe2/mailnews/news/src/NewsAutoCompleteSearch.jsm">mailnews/news/src/NewsAutoCompleteSearch.jsm</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/216cbe602979218a527744b2879387f1c98e6fe2/mailnews/news/src/NewsAutoCompleteSearch.jsm">file</a> |
<a href="/comm-central/annotate/216cbe602979218a527744b2879387f1c98e6fe2/mailnews/news/src/NewsAutoCompleteSearch.jsm">annotate</a> |
<a href="/comm-central/diff/216cbe602979218a527744b2879387f1c98e6fe2/mailnews/news/src/NewsAutoCompleteSearch.jsm">diff</a> |
<a href="/comm-central/comparison/216cbe602979218a527744b2879387f1c98e6fe2/mailnews/news/src/NewsAutoCompleteSearch.jsm">comparison</a> |
<a href="/comm-central/log/216cbe602979218a527744b2879387f1c98e6fe2/mailnews/news/src/NewsAutoCompleteSearch.jsm">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/216cbe602979218a527744b2879387f1c98e6fe2/mailnews/news/test/unit/head_server_setup.js">mailnews/news/test/unit/head_server_setup.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/216cbe602979218a527744b2879387f1c98e6fe2/mailnews/news/test/unit/head_server_setup.js">file</a> |
<a href="/comm-central/annotate/216cbe602979218a527744b2879387f1c98e6fe2/mailnews/news/test/unit/head_server_setup.js">annotate</a> |
<a href="/comm-central/diff/216cbe602979218a527744b2879387f1c98e6fe2/mailnews/news/test/unit/head_server_setup.js">diff</a> |
<a href="/comm-central/comparison/216cbe602979218a527744b2879387f1c98e6fe2/mailnews/news/test/unit/head_server_setup.js">comparison</a> |
<a href="/comm-central/log/216cbe602979218a527744b2879387f1c98e6fe2/mailnews/news/test/unit/head_server_setup.js">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/216cbe602979218a527744b2879387f1c98e6fe2/mailnews/news/test/unit/test_biff.js">mailnews/news/test/unit/test_biff.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/216cbe602979218a527744b2879387f1c98e6fe2/mailnews/news/test/unit/test_biff.js">file</a> |
<a href="/comm-central/annotate/216cbe602979218a527744b2879387f1c98e6fe2/mailnews/news/test/unit/test_biff.js">annotate</a> |
<a href="/comm-central/diff/216cbe602979218a527744b2879387f1c98e6fe2/mailnews/news/test/unit/test_biff.js">diff</a> |
<a href="/comm-central/comparison/216cbe602979218a527744b2879387f1c98e6fe2/mailnews/news/test/unit/test_biff.js">comparison</a> |
<a href="/comm-central/log/216cbe602979218a527744b2879387f1c98e6fe2/mailnews/news/test/unit/test_biff.js">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/216cbe602979218a527744b2879387f1c98e6fe2/mailnews/news/test/unit/test_filter.js">mailnews/news/test/unit/test_filter.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/216cbe602979218a527744b2879387f1c98e6fe2/mailnews/news/test/unit/test_filter.js">file</a> |
<a href="/comm-central/annotate/216cbe602979218a527744b2879387f1c98e6fe2/mailnews/news/test/unit/test_filter.js">annotate</a> |
<a href="/comm-central/diff/216cbe602979218a527744b2879387f1c98e6fe2/mailnews/news/test/unit/test_filter.js">diff</a> |
<a href="/comm-central/comparison/216cbe602979218a527744b2879387f1c98e6fe2/mailnews/news/test/unit/test_filter.js">comparison</a> |
<a href="/comm-central/log/216cbe602979218a527744b2879387f1c98e6fe2/mailnews/news/test/unit/test_filter.js">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/216cbe602979218a527744b2879387f1c98e6fe2/mailnews/news/test/unit/test_server.js">mailnews/news/test/unit/test_server.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/216cbe602979218a527744b2879387f1c98e6fe2/mailnews/news/test/unit/test_server.js">file</a> |
<a href="/comm-central/annotate/216cbe602979218a527744b2879387f1c98e6fe2/mailnews/news/test/unit/test_server.js">annotate</a> |
<a href="/comm-central/diff/216cbe602979218a527744b2879387f1c98e6fe2/mailnews/news/test/unit/test_server.js">diff</a> |
<a href="/comm-central/comparison/216cbe602979218a527744b2879387f1c98e6fe2/mailnews/news/test/unit/test_server.js">comparison</a> |
<a href="/comm-central/log/216cbe602979218a527744b2879387f1c98e6fe2/mailnews/news/test/unit/test_server.js">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/216cbe602979218a527744b2879387f1c98e6fe2/mailnews/test/resources/mailTestUtils.js">mailnews/test/resources/mailTestUtils.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/216cbe602979218a527744b2879387f1c98e6fe2/mailnews/test/resources/mailTestUtils.js">file</a> |
<a href="/comm-central/annotate/216cbe602979218a527744b2879387f1c98e6fe2/mailnews/test/resources/mailTestUtils.js">annotate</a> |
<a href="/comm-central/diff/216cbe602979218a527744b2879387f1c98e6fe2/mailnews/test/resources/mailTestUtils.js">diff</a> |
<a href="/comm-central/comparison/216cbe602979218a527744b2879387f1c98e6fe2/mailnews/test/resources/mailTestUtils.js">comparison</a> |
<a href="/comm-central/log/216cbe602979218a527744b2879387f1c98e6fe2/mailnews/test/resources/mailTestUtils.js">revisions</a>
</td>
</tr>
</table></div>

<div class="page_body diffblocks"><div class="diffblock"><pre class="sourcelines">
<a href="#l1.1"></a><span id="l1.1" class="difflineminus">--- a/mailnews/addrbook/content/abAddressBookNameDialog.js</span>
<a href="#l1.2"></a><span id="l1.2" class="difflineplus">+++ b/mailnews/addrbook/content/abAddressBookNameDialog.js</span>
<a href="#l1.3"></a><span id="l1.3" class="difflineat">@@ -1,18 +1,15 @@</span>
<a href="#l1.4"></a><span id="l1.4"> /* This Source Code Form is subject to the terms of the Mozilla Public</span>
<a href="#l1.5"></a><span id="l1.5">  * License, v. 2.0. If a copy of the MPL was not distributed with this</span>
<a href="#l1.6"></a><span id="l1.6">  * file, You can obtain one at http://mozilla.org/MPL/2.0/. */</span>
<a href="#l1.7"></a><span id="l1.7"> </span>
<a href="#l1.8"></a><span id="l1.8"> var { MailServices } = ChromeUtils.import(</span>
<a href="#l1.9"></a><span id="l1.9">   &quot;resource:///modules/MailServices.jsm&quot;</span>
<a href="#l1.10"></a><span id="l1.10"> );</span>
<a href="#l1.11"></a><span id="l1.11" class="difflineminus">-var { fixIterator } = ChromeUtils.import(</span>
<a href="#l1.12"></a><span id="l1.12" class="difflineminus">-  &quot;resource:///modules/iteratorUtils.jsm&quot;</span>
<a href="#l1.13"></a><span id="l1.13" class="difflineminus">-);</span>
<a href="#l1.14"></a><span id="l1.14"> var { Services } = ChromeUtils.import(&quot;resource://gre/modules/Services.jsm&quot;);</span>
<a href="#l1.15"></a><span id="l1.15"> </span>
<a href="#l1.16"></a><span id="l1.16"> var gOkButton;</span>
<a href="#l1.17"></a><span id="l1.17"> var gNameInput;</span>
<a href="#l1.18"></a><span id="l1.18"> var gDirectory = null;</span>
<a href="#l1.19"></a><span id="l1.19"> </span>
<a href="#l1.20"></a><span id="l1.20"> var kPersonalAddressbookURI = &quot;jsaddrbook://abook.sqlite&quot;;</span>
<a href="#l1.21"></a><span id="l1.21"> var kCollectedAddressbookURI = &quot;jsaddrbook://history.sqlite&quot;;</span>
<a href="#l1.22"></a><span id="l1.22" class="difflineat">@@ -63,17 +60,17 @@ function abNameOnLoad() {</span>
<a href="#l1.23"></a><span id="l1.23">     abNameDoOkEnabling();</span>
<a href="#l1.24"></a><span id="l1.24">   }</span>
<a href="#l1.25"></a><span id="l1.25"> }</span>
<a href="#l1.26"></a><span id="l1.26"> </span>
<a href="#l1.27"></a><span id="l1.27"> function abNameOKButton(event) {</span>
<a href="#l1.28"></a><span id="l1.28">   var newName = gNameInput.value.trim();</span>
<a href="#l1.29"></a><span id="l1.29"> </span>
<a href="#l1.30"></a><span id="l1.30">   // Do not allow an already existing name.</span>
<a href="#l1.31"></a><span id="l1.31" class="difflineminus">-  for (let ab of fixIterator(MailServices.ab.directories, Ci.nsIAbDirectory)) {</span>
<a href="#l1.32"></a><span id="l1.32" class="difflineplus">+  for (let ab of MailServices.ab.directories) {</span>
<a href="#l1.33"></a><span id="l1.33">     if (</span>
<a href="#l1.34"></a><span id="l1.34">       ab.dirName.toLowerCase() == newName.toLowerCase() &amp;&amp;</span>
<a href="#l1.35"></a><span id="l1.35">       (!gDirectory || ab.URI != gDirectory.URI)</span>
<a href="#l1.36"></a><span id="l1.36">     ) {</span>
<a href="#l1.37"></a><span id="l1.37">       const kAlertTitle = document</span>
<a href="#l1.38"></a><span id="l1.38">         .getElementById(&quot;bundle_addressBook&quot;)</span>
<a href="#l1.39"></a><span id="l1.39">         .getString(&quot;duplicateNameTitle&quot;);</span>
<a href="#l1.40"></a><span id="l1.40">       const kAlertText = document</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l2.1"></a><span id="l2.1" class="difflineminus">--- a/mailnews/addrbook/prefs/content/pref-directory-add.js</span>
<a href="#l2.2"></a><span id="l2.2" class="difflineplus">+++ b/mailnews/addrbook/prefs/content/pref-directory-add.js</span>
<a href="#l2.3"></a><span id="l2.3" class="difflineat">@@ -5,19 +5,16 @@</span>
<a href="#l2.4"></a><span id="l2.4"> </span>
<a href="#l2.5"></a><span id="l2.5"> var { Services } = ChromeUtils.import(&quot;resource://gre/modules/Services.jsm&quot;);</span>
<a href="#l2.6"></a><span id="l2.6"> var { MailServices } = ChromeUtils.import(</span>
<a href="#l2.7"></a><span id="l2.7">   &quot;resource:///modules/MailServices.jsm&quot;</span>
<a href="#l2.8"></a><span id="l2.8"> );</span>
<a href="#l2.9"></a><span id="l2.9"> var { isLegalHostNameOrIP, cleanUpHostName } = ChromeUtils.import(</span>
<a href="#l2.10"></a><span id="l2.10">   &quot;resource:///modules/hostnameUtils.jsm&quot;</span>
<a href="#l2.11"></a><span id="l2.11"> );</span>
<a href="#l2.12"></a><span id="l2.12" class="difflineminus">-var { fixIterator } = ChromeUtils.import(</span>
<a href="#l2.13"></a><span id="l2.13" class="difflineminus">-  &quot;resource:///modules/iteratorUtils.jsm&quot;</span>
<a href="#l2.14"></a><span id="l2.14" class="difflineminus">-);</span>
<a href="#l2.15"></a><span id="l2.15"> </span>
<a href="#l2.16"></a><span id="l2.16"> var gCurrentDirectory = null;</span>
<a href="#l2.17"></a><span id="l2.17"> var gReplicationBundle = null;</span>
<a href="#l2.18"></a><span id="l2.18"> var gReplicationService = Cc[</span>
<a href="#l2.19"></a><span id="l2.19">   &quot;@mozilla.org/addressbook/ldap-replication-service;1&quot;</span>
<a href="#l2.20"></a><span id="l2.20"> ].getService(Ci.nsIAbLDAPReplicationService);</span>
<a href="#l2.21"></a><span id="l2.21"> var gReplicationCancelled = false;</span>
<a href="#l2.22"></a><span id="l2.22"> var gProgressText;</span>
<a href="#l2.23"></a><span id="l2.23" class="difflineat">@@ -333,20 +330,17 @@ function onAccept(event) {</span>
<a href="#l2.24"></a><span id="l2.24">     let secure = document.getElementById(&quot;secure&quot;);</span>
<a href="#l2.25"></a><span id="l2.25">     let results = document.getElementById(&quot;results&quot;).value;</span>
<a href="#l2.26"></a><span id="l2.26">     let errorValue = null;</span>
<a href="#l2.27"></a><span id="l2.27">     let errorArg = null;</span>
<a href="#l2.28"></a><span id="l2.28">     let saslMechanism = &quot;&quot;;</span>
<a href="#l2.29"></a><span id="l2.29"> </span>
<a href="#l2.30"></a><span id="l2.30">     let findDupeName = function(newName) {</span>
<a href="#l2.31"></a><span id="l2.31">       // Do not allow an already existing name.</span>
<a href="#l2.32"></a><span id="l2.32" class="difflineminus">-      for (let ab of fixIterator(</span>
<a href="#l2.33"></a><span id="l2.33" class="difflineminus">-        MailServices.ab.directories,</span>
<a href="#l2.34"></a><span id="l2.34" class="difflineminus">-        Ci.nsIAbDirectory</span>
<a href="#l2.35"></a><span id="l2.35" class="difflineminus">-      )) {</span>
<a href="#l2.36"></a><span id="l2.36" class="difflineplus">+      for (let ab of MailServices.ab.directories) {</span>
<a href="#l2.37"></a><span id="l2.37">         if (</span>
<a href="#l2.38"></a><span id="l2.38">           ab.dirName.toLowerCase() == newName.toLowerCase() &amp;&amp;</span>
<a href="#l2.39"></a><span id="l2.39">           (!gCurrentDirectory || ab.URI != gCurrentDirectory.URI)</span>
<a href="#l2.40"></a><span id="l2.40">         ) {</span>
<a href="#l2.41"></a><span id="l2.41">           return ab.dirName;</span>
<a href="#l2.42"></a><span id="l2.42">         }</span>
<a href="#l2.43"></a><span id="l2.43">       }</span>
<a href="#l2.44"></a><span id="l2.44">       return null;</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l3.1"></a><span id="l3.1" class="difflineminus">--- a/mailnews/addrbook/prefs/content/pref-editdirectories.js</span>
<a href="#l3.2"></a><span id="l3.2" class="difflineplus">+++ b/mailnews/addrbook/prefs/content/pref-editdirectories.js</span>
<a href="#l3.3"></a><span id="l3.3" class="difflineat">@@ -61,20 +61,18 @@ function fillDirectoryList(aItem = null)</span>
<a href="#l3.4"></a><span id="l3.4">   var abList = document.getElementById(&quot;directoriesList&quot;);</span>
<a href="#l3.5"></a><span id="l3.5"> </span>
<a href="#l3.6"></a><span id="l3.6">   // Empty out anything in the list</span>
<a href="#l3.7"></a><span id="l3.7">   while (abList.hasChildNodes()) {</span>
<a href="#l3.8"></a><span id="l3.8">     abList.lastChild.remove();</span>
<a href="#l3.9"></a><span id="l3.9">   }</span>
<a href="#l3.10"></a><span id="l3.10"> </span>
<a href="#l3.11"></a><span id="l3.11">   // Init the address book list</span>
<a href="#l3.12"></a><span id="l3.12" class="difflineminus">-  let directories = MailServices.ab.directories;</span>
<a href="#l3.13"></a><span id="l3.13">   let holdingArray = [];</span>
<a href="#l3.14"></a><span id="l3.14" class="difflineminus">-  while (directories &amp;&amp; directories.hasMoreElements()) {</span>
<a href="#l3.15"></a><span id="l3.15" class="difflineminus">-    let ab = directories.getNext();</span>
<a href="#l3.16"></a><span id="l3.16" class="difflineplus">+  for (let ab of MailServices.ab.directories) {</span>
<a href="#l3.17"></a><span id="l3.17">     if (ab instanceof Ci.nsIAbDirectory &amp;&amp; ab.isRemote) {</span>
<a href="#l3.18"></a><span id="l3.18">       holdingArray.push(ab);</span>
<a href="#l3.19"></a><span id="l3.19">     }</span>
<a href="#l3.20"></a><span id="l3.20">   }</span>
<a href="#l3.21"></a><span id="l3.21"> </span>
<a href="#l3.22"></a><span id="l3.22">   holdingArray.sort(function(a, b) {</span>
<a href="#l3.23"></a><span id="l3.23">     return a.dirName.localeCompare(b.dirName);</span>
<a href="#l3.24"></a><span id="l3.24">   });</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l4.1"></a><span id="l4.1" class="difflineminus">--- a/mailnews/addrbook/src/AbAutoCompleteSearch.jsm</span>
<a href="#l4.2"></a><span id="l4.2" class="difflineplus">+++ b/mailnews/addrbook/src/AbAutoCompleteSearch.jsm</span>
<a href="#l4.3"></a><span id="l4.3" class="difflineat">@@ -208,46 +208,42 @@ AbAutoCompleteSearch.prototype = {</span>
<a href="#l4.4"></a><span id="l4.4">       );</span>
<a href="#l4.5"></a><span id="l4.5">       return;</span>
<a href="#l4.6"></a><span id="l4.6">     }</span>
<a href="#l4.7"></a><span id="l4.7"> </span>
<a href="#l4.8"></a><span id="l4.8">     // Cache this values to save going through xpconnect each time</span>
<a href="#l4.9"></a><span id="l4.9">     var commentColumn = this._commentColumn == 1 ? directory.dirName : &quot;&quot;;</span>
<a href="#l4.10"></a><span id="l4.10"> </span>
<a href="#l4.11"></a><span id="l4.11">     // Now iterate through all the cards.</span>
<a href="#l4.12"></a><span id="l4.12" class="difflineminus">-    while (childCards.hasMoreElements()) {</span>
<a href="#l4.13"></a><span id="l4.13" class="difflineminus">-      var card = childCards.getNext();</span>
<a href="#l4.14"></a><span id="l4.14" class="difflineplus">+    for (let card of childCards) {</span>
<a href="#l4.15"></a><span id="l4.15" class="difflineplus">+      if (card.isMailList) {</span>
<a href="#l4.16"></a><span id="l4.16" class="difflineplus">+        this._addToResult(commentColumn, directory, card, &quot;&quot;, true, result);</span>
<a href="#l4.17"></a><span id="l4.17" class="difflineplus">+      } else {</span>
<a href="#l4.18"></a><span id="l4.18" class="difflineplus">+        let email = card.primaryEmail;</span>
<a href="#l4.19"></a><span id="l4.19" class="difflineplus">+        if (email) {</span>
<a href="#l4.20"></a><span id="l4.20" class="difflineplus">+          this._addToResult(</span>
<a href="#l4.21"></a><span id="l4.21" class="difflineplus">+            commentColumn,</span>
<a href="#l4.22"></a><span id="l4.22" class="difflineplus">+            directory,</span>
<a href="#l4.23"></a><span id="l4.23" class="difflineplus">+            card,</span>
<a href="#l4.24"></a><span id="l4.24" class="difflineplus">+            email,</span>
<a href="#l4.25"></a><span id="l4.25" class="difflineplus">+            true,</span>
<a href="#l4.26"></a><span id="l4.26" class="difflineplus">+            result</span>
<a href="#l4.27"></a><span id="l4.27" class="difflineplus">+          );</span>
<a href="#l4.28"></a><span id="l4.28" class="difflineplus">+        }</span>
<a href="#l4.29"></a><span id="l4.29"> </span>
<a href="#l4.30"></a><span id="l4.30" class="difflineminus">-      if (card instanceof Ci.nsIAbCard) {</span>
<a href="#l4.31"></a><span id="l4.31" class="difflineminus">-        if (card.isMailList) {</span>
<a href="#l4.32"></a><span id="l4.32" class="difflineminus">-          this._addToResult(commentColumn, directory, card, &quot;&quot;, true, result);</span>
<a href="#l4.33"></a><span id="l4.33" class="difflineminus">-        } else {</span>
<a href="#l4.34"></a><span id="l4.34" class="difflineminus">-          let email = card.primaryEmail;</span>
<a href="#l4.35"></a><span id="l4.35" class="difflineminus">-          if (email) {</span>
<a href="#l4.36"></a><span id="l4.36" class="difflineminus">-            this._addToResult(</span>
<a href="#l4.37"></a><span id="l4.37" class="difflineminus">-              commentColumn,</span>
<a href="#l4.38"></a><span id="l4.38" class="difflineminus">-              directory,</span>
<a href="#l4.39"></a><span id="l4.39" class="difflineminus">-              card,</span>
<a href="#l4.40"></a><span id="l4.40" class="difflineminus">-              email,</span>
<a href="#l4.41"></a><span id="l4.41" class="difflineminus">-              true,</span>
<a href="#l4.42"></a><span id="l4.42" class="difflineminus">-              result</span>
<a href="#l4.43"></a><span id="l4.43" class="difflineminus">-            );</span>
<a href="#l4.44"></a><span id="l4.44" class="difflineminus">-          }</span>
<a href="#l4.45"></a><span id="l4.45" class="difflineminus">-</span>
<a href="#l4.46"></a><span id="l4.46" class="difflineminus">-          email = card.getProperty(&quot;SecondEmail&quot;, &quot;&quot;);</span>
<a href="#l4.47"></a><span id="l4.47" class="difflineminus">-          if (email) {</span>
<a href="#l4.48"></a><span id="l4.48" class="difflineminus">-            this._addToResult(</span>
<a href="#l4.49"></a><span id="l4.49" class="difflineminus">-              commentColumn,</span>
<a href="#l4.50"></a><span id="l4.50" class="difflineminus">-              directory,</span>
<a href="#l4.51"></a><span id="l4.51" class="difflineminus">-              card,</span>
<a href="#l4.52"></a><span id="l4.52" class="difflineminus">-              email,</span>
<a href="#l4.53"></a><span id="l4.53" class="difflineminus">-              false,</span>
<a href="#l4.54"></a><span id="l4.54" class="difflineminus">-              result</span>
<a href="#l4.55"></a><span id="l4.55" class="difflineminus">-            );</span>
<a href="#l4.56"></a><span id="l4.56" class="difflineminus">-          }</span>
<a href="#l4.57"></a><span id="l4.57" class="difflineplus">+        email = card.getProperty(&quot;SecondEmail&quot;, &quot;&quot;);</span>
<a href="#l4.58"></a><span id="l4.58" class="difflineplus">+        if (email) {</span>
<a href="#l4.59"></a><span id="l4.59" class="difflineplus">+          this._addToResult(</span>
<a href="#l4.60"></a><span id="l4.60" class="difflineplus">+            commentColumn,</span>
<a href="#l4.61"></a><span id="l4.61" class="difflineplus">+            directory,</span>
<a href="#l4.62"></a><span id="l4.62" class="difflineplus">+            card,</span>
<a href="#l4.63"></a><span id="l4.63" class="difflineplus">+            email,</span>
<a href="#l4.64"></a><span id="l4.64" class="difflineplus">+            false,</span>
<a href="#l4.65"></a><span id="l4.65" class="difflineplus">+            result</span>
<a href="#l4.66"></a><span id="l4.66" class="difflineplus">+          );</span>
<a href="#l4.67"></a><span id="l4.67">         }</span>
<a href="#l4.68"></a><span id="l4.68">       }</span>
<a href="#l4.69"></a><span id="l4.69">     }</span>
<a href="#l4.70"></a><span id="l4.70">   },</span>
<a href="#l4.71"></a><span id="l4.71"> </span>
<a href="#l4.72"></a><span id="l4.72">   /**</span>
<a href="#l4.73"></a><span id="l4.73">    * Checks the parent card and email address of an autocomplete results entry</span>
<a href="#l4.74"></a><span id="l4.74">    * from a previous result against the search parameters to see if that entry</span>
<a href="#l4.75"></a><span id="l4.75" class="difflineat">@@ -460,24 +456,21 @@ AbAutoCompleteSearch.prototype = {</span>
<a href="#l4.76"></a><span id="l4.76">       // from the fullstring in the fields of the addressbook card</span>
<a href="#l4.77"></a><span id="l4.77">       // (see bug 558931 for explanations).</span>
<a href="#l4.78"></a><span id="l4.78">       // Use helper method to split up search query to multi-word search</span>
<a href="#l4.79"></a><span id="l4.79">       // query against multiple fields.</span>
<a href="#l4.80"></a><span id="l4.80">       let searchWords = getSearchTokens(fullString);</span>
<a href="#l4.81"></a><span id="l4.81">       let searchQuery = generateQueryURI(result.modelQuery, searchWords);</span>
<a href="#l4.82"></a><span id="l4.82"> </span>
<a href="#l4.83"></a><span id="l4.83">       // Now do the searching</span>
<a href="#l4.84"></a><span id="l4.84" class="difflineminus">-      let allABs = this._abManager.directories;</span>
<a href="#l4.85"></a><span id="l4.85" class="difflineminus">-</span>
<a href="#l4.86"></a><span id="l4.86">       // We're not going to bother searching sub-directories, currently the</span>
<a href="#l4.87"></a><span id="l4.87">       // architecture forces all cards that are in mailing lists to be in ABs as</span>
<a href="#l4.88"></a><span id="l4.88">       // well, therefore by searching sub-directories (aka mailing lists) we're</span>
<a href="#l4.89"></a><span id="l4.89">       // just going to find duplicates.</span>
<a href="#l4.90"></a><span id="l4.90" class="difflineminus">-      while (allABs.hasMoreElements()) {</span>
<a href="#l4.91"></a><span id="l4.91" class="difflineminus">-        let dir = allABs.getNext();</span>
<a href="#l4.92"></a><span id="l4.92" class="difflineplus">+      for (let dir of this._abManager.directories) {</span>
<a href="#l4.93"></a><span id="l4.93">         if (</span>
<a href="#l4.94"></a><span id="l4.94">           dir instanceof Ci.nsIAbDirectory &amp;&amp;</span>
<a href="#l4.95"></a><span id="l4.95">           dir.useForAutocomplete(&quot;idKey&quot; in params ? params.idKey : null)</span>
<a href="#l4.96"></a><span id="l4.96">         ) {</span>
<a href="#l4.97"></a><span id="l4.97">           this._searchCards(searchQuery, dir, result);</span>
<a href="#l4.98"></a><span id="l4.98">         }</span>
<a href="#l4.99"></a><span id="l4.99">       }</span>
<a href="#l4.100"></a><span id="l4.100"> </span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l5.1"></a><span id="l5.1" class="difflineminus">--- a/mailnews/addrbook/test/unit/test_bug534822.js</span>
<a href="#l5.2"></a><span id="l5.2" class="difflineplus">+++ b/mailnews/addrbook/test/unit/test_bug534822.js</span>
<a href="#l5.3"></a><span id="l5.3" class="difflineat">@@ -12,27 +12,23 @@ function run_test() {</span>
<a href="#l5.4"></a><span id="l5.4">   specialPrefs.copyTo(profileDir, &quot;&quot;);</span>
<a href="#l5.5"></a><span id="l5.5"> </span>
<a href="#l5.6"></a><span id="l5.6">   specialPrefs = profileDir;</span>
<a href="#l5.7"></a><span id="l5.7">   specialPrefs.append(&quot;bug534822prefs.js&quot;);</span>
<a href="#l5.8"></a><span id="l5.8"> </span>
<a href="#l5.9"></a><span id="l5.9">   Services.prefs.readUserPrefsFromFile(specialPrefs);</span>
<a href="#l5.10"></a><span id="l5.10"> </span>
<a href="#l5.11"></a><span id="l5.11">   // Now load the ABs and check we've got all of them.</span>
<a href="#l5.12"></a><span id="l5.12" class="difflineminus">-  let dirs = MailServices.ab.directories;</span>
<a href="#l5.13"></a><span id="l5.13" class="difflineminus">-</span>
<a href="#l5.14"></a><span id="l5.14">   let results = [</span>
<a href="#l5.15"></a><span id="l5.15">     { name: &quot;extension&quot;, result: false },</span>
<a href="#l5.16"></a><span id="l5.16">     { name: kPABData.dirName, result: false },</span>
<a href="#l5.17"></a><span id="l5.17">     { name: kCABData.dirName, result: false },</span>
<a href="#l5.18"></a><span id="l5.18">   ];</span>
<a href="#l5.19"></a><span id="l5.19"> </span>
<a href="#l5.20"></a><span id="l5.20" class="difflineminus">-  while (dirs.hasMoreElements()) {</span>
<a href="#l5.21"></a><span id="l5.21" class="difflineminus">-    let dir = dirs.getNext().QueryInterface(Ci.nsIAbDirectory);</span>
<a href="#l5.22"></a><span id="l5.22" class="difflineminus">-</span>
<a href="#l5.23"></a><span id="l5.23" class="difflineplus">+  for (let dir of MailServices.ab.directories) {</span>
<a href="#l5.24"></a><span id="l5.24">     for (let i = 0; i &lt; results.length; ++i) {</span>
<a href="#l5.25"></a><span id="l5.25">       if (results[i].name == dir.dirName) {</span>
<a href="#l5.26"></a><span id="l5.26">         Assert.ok(!results[i].result);</span>
<a href="#l5.27"></a><span id="l5.27">         results[i].result = true;</span>
<a href="#l5.28"></a><span id="l5.28">       }</span>
<a href="#l5.29"></a><span id="l5.29">     }</span>
<a href="#l5.30"></a><span id="l5.30">   }</span>
<a href="#l5.31"></a><span id="l5.31"> </span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l6.1"></a><span id="l6.1" class="difflineminus">--- a/mailnews/addrbook/test/unit/test_cardForEmail.js</span>
<a href="#l6.2"></a><span id="l6.2" class="difflineplus">+++ b/mailnews/addrbook/test/unit/test_cardForEmail.js</span>
<a href="#l6.3"></a><span id="l6.3" class="difflineat">@@ -76,18 +76,17 @@ function run_test() {</span>
<a href="#l6.4"></a><span id="l6.4"> </span>
<a href="#l6.5"></a><span id="l6.5">   var cards = AB.getCardsFromProperty(&quot;LastName&quot;, &quot;DOE&quot;, true);</span>
<a href="#l6.6"></a><span id="l6.6">   Assert.ok(!cards.hasMoreElements());</span>
<a href="#l6.7"></a><span id="l6.7"> </span>
<a href="#l6.8"></a><span id="l6.8">   cards = AB.getCardsFromProperty(&quot;LastName&quot;, &quot;Doe&quot;, true);</span>
<a href="#l6.9"></a><span id="l6.9">   var i = 0;</span>
<a href="#l6.10"></a><span id="l6.10">   var data = [&quot;John&quot;, &quot;Jane&quot;];</span>
<a href="#l6.11"></a><span id="l6.11"> </span>
<a href="#l6.12"></a><span id="l6.12" class="difflineminus">-  while (cards.hasMoreElements()) {</span>
<a href="#l6.13"></a><span id="l6.13" class="difflineplus">+  for (card of cards) {</span>
<a href="#l6.14"></a><span id="l6.14">     i++;</span>
<a href="#l6.15"></a><span id="l6.15" class="difflineminus">-    card = cards.getNext().QueryInterface(Ci.nsIAbCard);</span>
<a href="#l6.16"></a><span id="l6.16">     Assert.equal(card.lastName, &quot;Doe&quot;);</span>
<a href="#l6.17"></a><span id="l6.17">     var index = data.indexOf(card.firstName);</span>
<a href="#l6.18"></a><span id="l6.18">     Assert.notEqual(index, -1);</span>
<a href="#l6.19"></a><span id="l6.19">     delete data[index];</span>
<a href="#l6.20"></a><span id="l6.20">   }</span>
<a href="#l6.21"></a><span id="l6.21">   Assert.equal(i, 2);</span>
<a href="#l6.22"></a><span id="l6.22"> }</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l7.1"></a><span id="l7.1" class="difflineminus">--- a/mailnews/addrbook/test/unit/test_collection.js</span>
<a href="#l7.2"></a><span id="l7.2" class="difflineplus">+++ b/mailnews/addrbook/test/unit/test_collection.js</span>
<a href="#l7.3"></a><span id="l7.3" class="difflineat">@@ -372,18 +372,18 @@ function run_test() {</span>
<a href="#l7.4"></a><span id="l7.4"> </span>
<a href="#l7.5"></a><span id="l7.5">   // Test - Do all emails at the same time.</span>
<a href="#l7.6"></a><span id="l7.6"> </span>
<a href="#l7.7"></a><span id="l7.7">   // First delete all existing cards</span>
<a href="#l7.8"></a><span id="l7.8">   var childCards = collectChecker.AB.childCards;</span>
<a href="#l7.9"></a><span id="l7.9">   var cardsToDelete = Cc[&quot;@mozilla.org/array;1&quot;].createInstance(</span>
<a href="#l7.10"></a><span id="l7.10">     Ci.nsIMutableArray</span>
<a href="#l7.11"></a><span id="l7.11">   );</span>
<a href="#l7.12"></a><span id="l7.12" class="difflineminus">-  while (childCards.hasMoreElements()) {</span>
<a href="#l7.13"></a><span id="l7.13" class="difflineminus">-    cardsToDelete.appendElement(childCards.getNext());</span>
<a href="#l7.14"></a><span id="l7.14" class="difflineplus">+  for (let childCard of childCards) {</span>
<a href="#l7.15"></a><span id="l7.15" class="difflineplus">+    cardsToDelete.appendElement(childCard);</span>
<a href="#l7.16"></a><span id="l7.16">   }</span>
<a href="#l7.17"></a><span id="l7.17"> </span>
<a href="#l7.18"></a><span id="l7.18">   collectChecker.AB.deleteCards(cardsToDelete);</span>
<a href="#l7.19"></a><span id="l7.19"> </span>
<a href="#l7.20"></a><span id="l7.20">   // Null these directly, so gc() will purge them</span>
<a href="#l7.21"></a><span id="l7.21">   childCards = null;</span>
<a href="#l7.22"></a><span id="l7.22">   cardsToDelete = null;</span>
<a href="#l7.23"></a><span id="l7.23"> </span>
<a href="#l7.24"></a><span id="l7.24" class="difflineat">@@ -442,19 +442,18 @@ function run_test() {</span>
<a href="#l7.25"></a><span id="l7.25">     true,</span>
<a href="#l7.26"></a><span id="l7.26">     nsIAbPMF.unknown,</span>
<a href="#l7.27"></a><span id="l7.27">     true</span>
<a href="#l7.28"></a><span id="l7.28">   );</span>
<a href="#l7.29"></a><span id="l7.29"> </span>
<a href="#l7.30"></a><span id="l7.30">   childCards = collectChecker.AB.childCards;</span>
<a href="#l7.31"></a><span id="l7.31">   var foundCards = [];</span>
<a href="#l7.32"></a><span id="l7.32"> </span>
<a href="#l7.33"></a><span id="l7.33" class="difflineminus">-  while (childCards.hasMoreElements()) {</span>
<a href="#l7.34"></a><span id="l7.34" class="difflineminus">-    card = childCards.getNext();</span>
<a href="#l7.35"></a><span id="l7.35" class="difflineminus">-    if (card instanceof Ci.nsIAbCard &amp;&amp; card.primaryEmail == kSingleAddress) {</span>
<a href="#l7.36"></a><span id="l7.36" class="difflineplus">+  for (card of childCards) {</span>
<a href="#l7.37"></a><span id="l7.37" class="difflineplus">+    if (card.primaryEmail == kSingleAddress) {</span>
<a href="#l7.38"></a><span id="l7.38">       foundCards.push(card);</span>
<a href="#l7.39"></a><span id="l7.39">     }</span>
<a href="#l7.40"></a><span id="l7.40">   }</span>
<a href="#l7.41"></a><span id="l7.41"> </span>
<a href="#l7.42"></a><span id="l7.42">   Assert.equal(foundCards.length, 2);</span>
<a href="#l7.43"></a><span id="l7.43"> </span>
<a href="#l7.44"></a><span id="l7.44">   if (</span>
<a href="#l7.45"></a><span id="l7.45">     foundCards[0].displayName != kSingleDisplayName &amp;&amp;</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l8.1"></a><span id="l8.1" class="difflineminus">--- a/mailnews/addrbook/test/unit/test_db_enumerator.js</span>
<a href="#l8.2"></a><span id="l8.2" class="difflineplus">+++ b/mailnews/addrbook/test/unit/test_db_enumerator.js</span>
<a href="#l8.3"></a><span id="l8.3" class="difflineat">@@ -15,19 +15,17 @@ function bug_537815_fixture_setup() {</span>
<a href="#l8.4"></a><span id="l8.4">   let i, key;</span>
<a href="#l8.5"></a><span id="l8.5"> </span>
<a href="#l8.6"></a><span id="l8.6">   for (i = 1; i &lt;= max_addressbooks; i++) {</span>
<a href="#l8.7"></a><span id="l8.7">     let ab_name = ab_prefix + i;</span>
<a href="#l8.8"></a><span id="l8.8">     MailServices.ab.newAddressBook(ab_name, &quot;&quot;, 101);</span>
<a href="#l8.9"></a><span id="l8.9">     dump(&quot;created: &quot; + ab_name + &quot;\n&quot;);</span>
<a href="#l8.10"></a><span id="l8.10"> </span>
<a href="#l8.11"></a><span id="l8.11">     for (var j = 1; j &lt; 2; j++) {</span>
<a href="#l8.12"></a><span id="l8.12" class="difflineminus">-      let enm_dirs = MailServices.ab.directories;</span>
<a href="#l8.13"></a><span id="l8.13" class="difflineminus">-      while (enm_dirs.hasMoreElements()) {</span>
<a href="#l8.14"></a><span id="l8.14" class="difflineminus">-        let elem = enm_dirs.getNext().QueryInterface(Ci.nsIAbDirectory);</span>
<a href="#l8.15"></a><span id="l8.15" class="difflineplus">+      for (let elem of MailServices.ab.directories) {</span>
<a href="#l8.16"></a><span id="l8.16">         let uri = elem.URI;</span>
<a href="#l8.17"></a><span id="l8.17">         let dir = MailServices.ab.getDirectory(uri);</span>
<a href="#l8.18"></a><span id="l8.18"> </span>
<a href="#l8.19"></a><span id="l8.19">         dump(&quot;considering: j: &quot; + j + &quot; &quot; + elem.dirName + &quot;\n&quot;);</span>
<a href="#l8.20"></a><span id="l8.20"> </span>
<a href="#l8.21"></a><span id="l8.21">         if (j == 1 &amp;&amp; elem.dirName.startsWith(ab_prefix)) {</span>
<a href="#l8.22"></a><span id="l8.22">           for (i = 1; i &lt;= 1000; i++) {</span>
<a href="#l8.23"></a><span id="l8.23">             let abCard = Cc[&quot;@mozilla.org/addressbook/cardproperty;1&quot;]</span>
<a href="#l8.24"></a><span id="l8.24" class="difflineat">@@ -43,52 +41,39 @@ function bug_537815_fixture_setup() {</span>
<a href="#l8.25"></a><span id="l8.25">           dump(&quot;populated: &quot; + elem.dirName + &quot;\n&quot;);</span>
<a href="#l8.26"></a><span id="l8.26">         }</span>
<a href="#l8.27"></a><span id="l8.27">       }</span>
<a href="#l8.28"></a><span id="l8.28">     }</span>
<a href="#l8.29"></a><span id="l8.29">   }</span>
<a href="#l8.30"></a><span id="l8.30"> }</span>
<a href="#l8.31"></a><span id="l8.31"> </span>
<a href="#l8.32"></a><span id="l8.32"> function bug_537815_test() {</span>
<a href="#l8.33"></a><span id="l8.33" class="difflineminus">-  let enm_dirs = MailServices.ab.directories;</span>
<a href="#l8.34"></a><span id="l8.34" class="difflineminus">-</span>
<a href="#l8.35"></a><span id="l8.35" class="difflineminus">-  while (enm_dirs.hasMoreElements()) {</span>
<a href="#l8.36"></a><span id="l8.36" class="difflineminus">-    let elem = enm_dirs.getNext().QueryInterface(Ci.nsIAbDirectory);</span>
<a href="#l8.37"></a><span id="l8.37" class="difflineplus">+  for (let elem of MailServices.ab.directories) {</span>
<a href="#l8.38"></a><span id="l8.38">     let uri = elem.URI;</span>
<a href="#l8.39"></a><span id="l8.39">     let dir = MailServices.ab.getDirectory(uri);</span>
<a href="#l8.40"></a><span id="l8.40" class="difflineminus">-</span>
<a href="#l8.41"></a><span id="l8.41">     if (elem.dirName.startsWith(ab_prefix)) {</span>
<a href="#l8.42"></a><span id="l8.42" class="difflineminus">-      let enm_cards = dir.childCards;</span>
<a href="#l8.43"></a><span id="l8.43" class="difflineminus">-</span>
<a href="#l8.44"></a><span id="l8.44" class="difflineminus">-      while (enm_cards.hasMoreElements()) {</span>
<a href="#l8.45"></a><span id="l8.45" class="difflineminus">-        let item = enm_cards.getNext();</span>
<a href="#l8.46"></a><span id="l8.46" class="difflineminus">-        let abCard = item.QueryInterface(Ci.nsIAbCard);</span>
<a href="#l8.47"></a><span id="l8.47" class="difflineminus">-</span>
<a href="#l8.48"></a><span id="l8.48" class="difflineplus">+      for (let abCard of dir.childCards) {</span>
<a href="#l8.49"></a><span id="l8.49">         for (let key in card_properties) {</span>
<a href="#l8.50"></a><span id="l8.50">           abCard.getProperty(key, null);</span>
<a href="#l8.51"></a><span id="l8.51">         }</span>
<a href="#l8.52"></a><span id="l8.52">       }</span>
<a href="#l8.53"></a><span id="l8.53">       dump(&quot;visited all cards in: &quot; + elem.dirName + &quot;\n&quot;);</span>
<a href="#l8.54"></a><span id="l8.54">     }</span>
<a href="#l8.55"></a><span id="l8.55">   }</span>
<a href="#l8.56"></a><span id="l8.56"> }</span>
<a href="#l8.57"></a><span id="l8.57"> </span>
<a href="#l8.58"></a><span id="l8.58"> function test_bug_537815() {</span>
<a href="#l8.59"></a><span id="l8.59">   bug_537815_fixture_setup();</span>
<a href="#l8.60"></a><span id="l8.60">   bug_537815_test();</span>
<a href="#l8.61"></a><span id="l8.61">   bug_537815_fixture_tear_down();</span>
<a href="#l8.62"></a><span id="l8.62"> }</span>
<a href="#l8.63"></a><span id="l8.63"> </span>
<a href="#l8.64"></a><span id="l8.64"> function bug_537815_fixture_tear_down() {</span>
<a href="#l8.65"></a><span id="l8.65" class="difflineminus">-  let enm_dirs = MailServices.ab.directories;</span>
<a href="#l8.66"></a><span id="l8.66">   let a_uri = {};</span>
<a href="#l8.67"></a><span id="l8.67" class="difflineminus">-</span>
<a href="#l8.68"></a><span id="l8.68" class="difflineminus">-  while (enm_dirs.hasMoreElements()) {</span>
<a href="#l8.69"></a><span id="l8.69" class="difflineminus">-    let elem = enm_dirs.getNext().QueryInterface(Ci.nsIAbDirectory);</span>
<a href="#l8.70"></a><span id="l8.70" class="difflineminus">-</span>
<a href="#l8.71"></a><span id="l8.71" class="difflineplus">+  for (let elem of MailServices.ab.directories) {</span>
<a href="#l8.72"></a><span id="l8.72">     if (elem.dirName.startsWith(ab_prefix)) {</span>
<a href="#l8.73"></a><span id="l8.73">       a_uri[elem.URI] = true;</span>
<a href="#l8.74"></a><span id="l8.74">       dump(&quot;to be deleted: &quot; + elem.dirName + &quot;\n&quot;);</span>
<a href="#l8.75"></a><span id="l8.75">     }</span>
<a href="#l8.76"></a><span id="l8.76">   }</span>
<a href="#l8.77"></a><span id="l8.77"> </span>
<a href="#l8.78"></a><span id="l8.78">   for (let uri in a_uri) {</span>
<a href="#l8.79"></a><span id="l8.79">     MailServices.ab.deleteAddressBook(uri);</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l9.1"></a><span id="l9.1" class="difflineminus">--- a/mailnews/addrbook/test/unit/test_ldapOffline.js</span>
<a href="#l9.2"></a><span id="l9.2" class="difflineplus">+++ b/mailnews/addrbook/test/unit/test_ldapOffline.js</span>
<a href="#l9.3"></a><span id="l9.3" class="difflineat">@@ -34,25 +34,17 @@ function run_test() {</span>
<a href="#l9.4"></a><span id="l9.4">   loadABFile(&quot;data/cardForEmail&quot;, kLDAPFileName);</span>
<a href="#l9.5"></a><span id="l9.5"> </span>
<a href="#l9.6"></a><span id="l9.6">   // And tell the ldap directory we want this file.</span>
<a href="#l9.7"></a><span id="l9.7">   abDir.replicationFileName = kLDAPFileName;</span>
<a href="#l9.8"></a><span id="l9.8"> </span>
<a href="#l9.9"></a><span id="l9.9">   // Now go offline</span>
<a href="#l9.10"></a><span id="l9.10">   Services.io.offline = true;</span>
<a href="#l9.11"></a><span id="l9.11"> </span>
<a href="#l9.12"></a><span id="l9.12" class="difflineminus">-  // Now try and get the card that has been replicated for offline use.</span>
<a href="#l9.13"></a><span id="l9.13" class="difflineminus">-  let childCards = abDir.childCards;</span>
<a href="#l9.14"></a><span id="l9.14" class="difflineminus">-  let count = 0;</span>
<a href="#l9.15"></a><span id="l9.15" class="difflineminus">-</span>
<a href="#l9.16"></a><span id="l9.16">   // Make sure we clear any memory that is now loose, so that the crash would</span>
<a href="#l9.17"></a><span id="l9.17">   // be triggered.</span>
<a href="#l9.18"></a><span id="l9.18">   gc();</span>
<a href="#l9.19"></a><span id="l9.19"> </span>
<a href="#l9.20"></a><span id="l9.20" class="difflineminus">-  while (childCards.hasMoreElements()) {</span>
<a href="#l9.21"></a><span id="l9.21" class="difflineminus">-    // Make sure everything is an nsIAbCard.</span>
<a href="#l9.22"></a><span id="l9.22" class="difflineminus">-    childCards.getNext().QueryInterface(Ci.nsIAbCard);</span>
<a href="#l9.23"></a><span id="l9.23" class="difflineminus">-</span>
<a href="#l9.24"></a><span id="l9.24" class="difflineminus">-    ++count;</span>
<a href="#l9.25"></a><span id="l9.25" class="difflineminus">-  }</span>
<a href="#l9.26"></a><span id="l9.26" class="difflineplus">+  // Now try and get the card that has been replicated for offline use.</span>
<a href="#l9.27"></a><span id="l9.27" class="difflineplus">+  let count = [...abDir.childCards].length;</span>
<a href="#l9.28"></a><span id="l9.28"> </span>
<a href="#l9.29"></a><span id="l9.29">   Assert.equal(count, 4);</span>
<a href="#l9.30"></a><span id="l9.30"> }</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l10.1"></a><span id="l10.1" class="difflineminus">--- a/mailnews/addrbook/test/unit/test_mailList1.js</span>
<a href="#l10.2"></a><span id="l10.2" class="difflineplus">+++ b/mailnews/addrbook/test/unit/test_mailList1.js</span>
<a href="#l10.3"></a><span id="l10.3" class="difflineat">@@ -10,23 +10,18 @@</span>
<a href="#l10.4"></a><span id="l10.4"> function checkLists(childNodes, number) {</span>
<a href="#l10.5"></a><span id="l10.5">   var mailListArray = new Array(number);</span>
<a href="#l10.6"></a><span id="l10.6"> </span>
<a href="#l10.7"></a><span id="l10.7">   for (var i = 0; i &lt; number; ++i) {</span>
<a href="#l10.8"></a><span id="l10.8">     mailListArray[i] = null;</span>
<a href="#l10.9"></a><span id="l10.9">   }</span>
<a href="#l10.10"></a><span id="l10.10"> </span>
<a href="#l10.11"></a><span id="l10.11">   // See comment above for matching requirements</span>
<a href="#l10.12"></a><span id="l10.12" class="difflineminus">-  while (childNodes.hasMoreElements()) {</span>
<a href="#l10.13"></a><span id="l10.13" class="difflineminus">-    var list = childNodes.getNext();</span>
<a href="#l10.14"></a><span id="l10.14" class="difflineminus">-    if (</span>
<a href="#l10.15"></a><span id="l10.15" class="difflineminus">-      list instanceof Ci.nsIAbDirectory &amp;&amp;</span>
<a href="#l10.16"></a><span id="l10.16" class="difflineminus">-      list.isMailList &amp;&amp;</span>
<a href="#l10.17"></a><span id="l10.17" class="difflineminus">-      list.dirName.startsWith(&quot;TestList&quot;)</span>
<a href="#l10.18"></a><span id="l10.18" class="difflineminus">-    ) {</span>
<a href="#l10.19"></a><span id="l10.19" class="difflineplus">+  for (let list of childNodes) {</span>
<a href="#l10.20"></a><span id="l10.20" class="difflineplus">+    if (list.isMailList &amp;&amp; list.dirName.startsWith(&quot;TestList&quot;)) {</span>
<a href="#l10.21"></a><span id="l10.21">       var index = list.dirName.substr(8, list.dirName.length - 8);</span>
<a href="#l10.22"></a><span id="l10.22">       Assert.equal(mailListArray[index - 1], null);</span>
<a href="#l10.23"></a><span id="l10.23">       Assert.equal(list.URI, kPABData.URI + &quot;/MailList&quot; + index);</span>
<a href="#l10.24"></a><span id="l10.24"> </span>
<a href="#l10.25"></a><span id="l10.25">       mailListArray[index - 1] = list;</span>
<a href="#l10.26"></a><span id="l10.26">     }</span>
<a href="#l10.27"></a><span id="l10.27">   }</span>
<a href="#l10.28"></a><span id="l10.28"> </span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l11.1"></a><span id="l11.1" class="difflineminus">--- a/mailnews/addrbook/test/unit/test_nsAbAutoCompleteSearch1.js</span>
<a href="#l11.2"></a><span id="l11.2" class="difflineplus">+++ b/mailnews/addrbook/test/unit/test_nsAbAutoCompleteSearch1.js</span>
<a href="#l11.3"></a><span id="l11.3" class="difflineat">@@ -207,20 +207,18 @@ var CAB_LIST_DATA = [];</span>
<a href="#l11.4"></a><span id="l11.4"> </span>
<a href="#l11.5"></a><span id="l11.5"> function setupAddressBookData(aDirURI, aCardData, aMailListData) {</span>
<a href="#l11.6"></a><span id="l11.6">   let ab = MailServices.ab.getDirectory(aDirURI);</span>
<a href="#l11.7"></a><span id="l11.7"> </span>
<a href="#l11.8"></a><span id="l11.8">   // Getting all directories ensures we create all ABs because mailing</span>
<a href="#l11.9"></a><span id="l11.9">   // lists need help initialising themselves</span>
<a href="#l11.10"></a><span id="l11.10">   MailServices.ab.directories;</span>
<a href="#l11.11"></a><span id="l11.11"> </span>
<a href="#l11.12"></a><span id="l11.12" class="difflineminus">-  let childCards0 = ab.childCards;</span>
<a href="#l11.13"></a><span id="l11.13" class="difflineminus">-  while (childCards0.hasMoreElements()) {</span>
<a href="#l11.14"></a><span id="l11.14" class="difflineminus">-    let c = childCards0.getNext().QueryInterface(Ci.nsIAbCard);</span>
<a href="#l11.15"></a><span id="l11.15" class="difflineminus">-    ab.dropCard(c, false);</span>
<a href="#l11.16"></a><span id="l11.16" class="difflineplus">+  for (let card of ab.childCards) {</span>
<a href="#l11.17"></a><span id="l11.17" class="difflineplus">+    ab.dropCard(card, false);</span>
<a href="#l11.18"></a><span id="l11.18">   }</span>
<a href="#l11.19"></a><span id="l11.19"> </span>
<a href="#l11.20"></a><span id="l11.20">   aCardData.forEach(function(cd) {</span>
<a href="#l11.21"></a><span id="l11.21">     let card = Cc[&quot;@mozilla.org/addressbook/cardproperty;1&quot;].createInstance(</span>
<a href="#l11.22"></a><span id="l11.22">       Ci.nsIAbCard</span>
<a href="#l11.23"></a><span id="l11.23">     );</span>
<a href="#l11.24"></a><span id="l11.24">     for (var prop in cd) {</span>
<a href="#l11.25"></a><span id="l11.25">       card.setProperty(prop, cd[prop]);</span>
<a href="#l11.26"></a><span id="l11.26" class="difflineat">@@ -233,21 +231,16 @@ function setupAddressBookData(aDirURI, a</span>
<a href="#l11.27"></a><span id="l11.27">       &quot;@mozilla.org/addressbook/directoryproperty;1&quot;</span>
<a href="#l11.28"></a><span id="l11.28">     ].createInstance(Ci.nsIAbDirectory);</span>
<a href="#l11.29"></a><span id="l11.29">     list.isMailList = true;</span>
<a href="#l11.30"></a><span id="l11.30">     for (var prop in ld) {</span>
<a href="#l11.31"></a><span id="l11.31">       list[prop] = ld[prop];</span>
<a href="#l11.32"></a><span id="l11.32">     }</span>
<a href="#l11.33"></a><span id="l11.33">     ab.addMailList(list);</span>
<a href="#l11.34"></a><span id="l11.34">   });</span>
<a href="#l11.35"></a><span id="l11.35" class="difflineminus">-</span>
<a href="#l11.36"></a><span id="l11.36" class="difflineminus">-  let childCards = ab.childCards;</span>
<a href="#l11.37"></a><span id="l11.37" class="difflineminus">-  while (childCards.hasMoreElements()) {</span>
<a href="#l11.38"></a><span id="l11.38" class="difflineminus">-    childCards.getNext().QueryInterface(Ci.nsIAbCard);</span>
<a href="#l11.39"></a><span id="l11.39" class="difflineminus">-  }</span>
<a href="#l11.40"></a><span id="l11.40"> }</span>
<a href="#l11.41"></a><span id="l11.41"> </span>
<a href="#l11.42"></a><span id="l11.42"> function run_test() {</span>
<a href="#l11.43"></a><span id="l11.43">   // Set up addresses for in the personal address book.</span>
<a href="#l11.44"></a><span id="l11.44">   setupAddressBookData(kPABData.URI, PAB_CARD_DATA, PAB_LIST_DATA);</span>
<a href="#l11.45"></a><span id="l11.45">   // ... and collected addresses address book.</span>
<a href="#l11.46"></a><span id="l11.46">   setupAddressBookData(kCABData.URI, CAB_CARD_DATA, CAB_LIST_DATA);</span>
<a href="#l11.47"></a><span id="l11.47"> </span>
<a href="#l11.48"></a><span id="l11.48" class="difflineat">@@ -422,21 +415,17 @@ function run_test() {</span>
<a href="#l11.49"></a><span id="l11.49">   }</span>
<a href="#l11.50"></a><span id="l11.50"> </span>
<a href="#l11.51"></a><span id="l11.51">   inputs.forEach(checkInputSet);</span>
<a href="#l11.52"></a><span id="l11.52"> </span>
<a href="#l11.53"></a><span id="l11.53">   // Test - Popularity Index</span>
<a href="#l11.54"></a><span id="l11.54">   print(&quot;Checking by popularity index:&quot;);</span>
<a href="#l11.55"></a><span id="l11.55">   let pab = MailServices.ab.getDirectory(kPABData.URI);</span>
<a href="#l11.56"></a><span id="l11.56"> </span>
<a href="#l11.57"></a><span id="l11.57" class="difflineminus">-  var childCards = pab.childCards;</span>
<a href="#l11.58"></a><span id="l11.58" class="difflineminus">-</span>
<a href="#l11.59"></a><span id="l11.59" class="difflineminus">-  while (childCards.hasMoreElements()) {</span>
<a href="#l11.60"></a><span id="l11.60" class="difflineminus">-    var card = childCards.getNext().QueryInterface(Ci.nsIAbCard);</span>
<a href="#l11.61"></a><span id="l11.61" class="difflineminus">-</span>
<a href="#l11.62"></a><span id="l11.62" class="difflineplus">+  for (let card of pab.childCards) {</span>
<a href="#l11.63"></a><span id="l11.63">     if (card.isMailList) {</span>
<a href="#l11.64"></a><span id="l11.64">       continue;</span>
<a href="#l11.65"></a><span id="l11.65">     }</span>
<a href="#l11.66"></a><span id="l11.66"> </span>
<a href="#l11.67"></a><span id="l11.67">     switch (card.displayName) {</span>
<a href="#l11.68"></a><span id="l11.68">       case &quot;dis&quot;: // 2</span>
<a href="#l11.69"></a><span id="l11.69">       case &quot;disp&quot;: // 3</span>
<a href="#l11.70"></a><span id="l11.70">         card.setProperty(&quot;PopularityIndex&quot;, 4);</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l12.1"></a><span id="l12.1" class="difflineminus">--- a/mailnews/addrbook/test/unit/test_nsAbAutoCompleteSearch7.js</span>
<a href="#l12.2"></a><span id="l12.2" class="difflineplus">+++ b/mailnews/addrbook/test/unit/test_nsAbAutoCompleteSearch7.js</span>
<a href="#l12.3"></a><span id="l12.3" class="difflineat">@@ -71,20 +71,18 @@ var PAB_CARD_DATA = [</span>
<a href="#l12.4"></a><span id="l12.4"> </span>
<a href="#l12.5"></a><span id="l12.5"> function setupAddressBookData(aDirURI, aCardData, aMailListData) {</span>
<a href="#l12.6"></a><span id="l12.6">   let ab = MailServices.ab.getDirectory(aDirURI);</span>
<a href="#l12.7"></a><span id="l12.7"> </span>
<a href="#l12.8"></a><span id="l12.8">   // Getting all directories ensures we create all ABs because mailing</span>
<a href="#l12.9"></a><span id="l12.9">   // lists need help initialising themselves</span>
<a href="#l12.10"></a><span id="l12.10">   MailServices.ab.directories;</span>
<a href="#l12.11"></a><span id="l12.11"> </span>
<a href="#l12.12"></a><span id="l12.12" class="difflineminus">-  let childCards0 = ab.childCards;</span>
<a href="#l12.13"></a><span id="l12.13" class="difflineminus">-  while (childCards0.hasMoreElements()) {</span>
<a href="#l12.14"></a><span id="l12.14" class="difflineminus">-    let c = childCards0.getNext().QueryInterface(Ci.nsIAbCard);</span>
<a href="#l12.15"></a><span id="l12.15" class="difflineminus">-    ab.dropCard(c, false);</span>
<a href="#l12.16"></a><span id="l12.16" class="difflineplus">+  for (let card of ab.childCards) {</span>
<a href="#l12.17"></a><span id="l12.17" class="difflineplus">+    ab.dropCard(card, false);</span>
<a href="#l12.18"></a><span id="l12.18">   }</span>
<a href="#l12.19"></a><span id="l12.19"> </span>
<a href="#l12.20"></a><span id="l12.20">   aCardData.forEach(function(cd) {</span>
<a href="#l12.21"></a><span id="l12.21">     let card = Cc[&quot;@mozilla.org/addressbook/cardproperty;1&quot;].createInstance(</span>
<a href="#l12.22"></a><span id="l12.22">       Ci.nsIAbCard</span>
<a href="#l12.23"></a><span id="l12.23">     );</span>
<a href="#l12.24"></a><span id="l12.24">     for (var prop in cd) {</span>
<a href="#l12.25"></a><span id="l12.25">       card.setProperty(prop, cd[prop]);</span>
<a href="#l12.26"></a><span id="l12.26" class="difflineat">@@ -97,21 +95,16 @@ function setupAddressBookData(aDirURI, a</span>
<a href="#l12.27"></a><span id="l12.27">       &quot;@mozilla.org/addressbook/directoryproperty;1&quot;</span>
<a href="#l12.28"></a><span id="l12.28">     ].createInstance(Ci.nsIAbDirectory);</span>
<a href="#l12.29"></a><span id="l12.29">     list.isMailList = true;</span>
<a href="#l12.30"></a><span id="l12.30">     for (var prop in ld) {</span>
<a href="#l12.31"></a><span id="l12.31">       list[prop] = ld[prop];</span>
<a href="#l12.32"></a><span id="l12.32">     }</span>
<a href="#l12.33"></a><span id="l12.33">     ab.addMailList(list);</span>
<a href="#l12.34"></a><span id="l12.34">   });</span>
<a href="#l12.35"></a><span id="l12.35" class="difflineminus">-</span>
<a href="#l12.36"></a><span id="l12.36" class="difflineminus">-  let childCards = ab.childCards;</span>
<a href="#l12.37"></a><span id="l12.37" class="difflineminus">-  while (childCards.hasMoreElements()) {</span>
<a href="#l12.38"></a><span id="l12.38" class="difflineminus">-    childCards.getNext().QueryInterface(Ci.nsIAbCard);</span>
<a href="#l12.39"></a><span id="l12.39" class="difflineminus">-  }</span>
<a href="#l12.40"></a><span id="l12.40"> }</span>
<a href="#l12.41"></a><span id="l12.41"> </span>
<a href="#l12.42"></a><span id="l12.42"> function run_test() {</span>
<a href="#l12.43"></a><span id="l12.43">   // Set up addresses for in the personal address book.</span>
<a href="#l12.44"></a><span id="l12.44">   setupAddressBookData(kPABData.URI, PAB_CARD_DATA, []);</span>
<a href="#l12.45"></a><span id="l12.45"> </span>
<a href="#l12.46"></a><span id="l12.46">   // Test - Create a new search component</span>
<a href="#l12.47"></a><span id="l12.47"> </span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l13.1"></a><span id="l13.1" class="difflineminus">--- a/mailnews/addrbook/test/unit/test_nsAbManager2.js</span>
<a href="#l13.2"></a><span id="l13.2" class="difflineplus">+++ b/mailnews/addrbook/test/unit/test_nsAbManager2.js</span>
<a href="#l13.3"></a><span id="l13.3" class="difflineat">@@ -40,18 +40,17 @@ abL.prototype = {</span>
<a href="#l13.4"></a><span id="l13.4">     }</span>
<a href="#l13.5"></a><span id="l13.5">   },</span>
<a href="#l13.6"></a><span id="l13.6"> };</span>
<a href="#l13.7"></a><span id="l13.7"> </span>
<a href="#l13.8"></a><span id="l13.8"> function checkDirs(aDirs, aDirArray) {</span>
<a href="#l13.9"></a><span id="l13.9">   // Don't modify the passed in array.</span>
<a href="#l13.10"></a><span id="l13.10">   var dirArray = aDirArray.concat();</span>
<a href="#l13.11"></a><span id="l13.11"> </span>
<a href="#l13.12"></a><span id="l13.12" class="difflineminus">-  while (aDirs.hasMoreElements()) {</span>
<a href="#l13.13"></a><span id="l13.13" class="difflineminus">-    var dir = aDirs.getNext().QueryInterface(nsIAbDirectory);</span>
<a href="#l13.14"></a><span id="l13.14" class="difflineplus">+  for (let dir of aDirs) {</span>
<a href="#l13.15"></a><span id="l13.15">     var loc = dirArray.indexOf(dir.URI);</span>
<a href="#l13.16"></a><span id="l13.16"> </span>
<a href="#l13.17"></a><span id="l13.17">     Assert.equal(MailServices.ab.getDirectory(dir.URI), dir);</span>
<a href="#l13.18"></a><span id="l13.18"> </span>
<a href="#l13.19"></a><span id="l13.19">     if (loc == -1) {</span>
<a href="#l13.20"></a><span id="l13.20">       do_throw(</span>
<a href="#l13.21"></a><span id="l13.21">         &quot;Unexpected directory &quot; + dir.URI + &quot; found in address book list&quot;</span>
<a href="#l13.22"></a><span id="l13.22">       );</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l14.1"></a><span id="l14.1" class="difflineminus">--- a/mailnews/addrbook/test/unit/test_nsIAbCard.js</span>
<a href="#l14.2"></a><span id="l14.2" class="difflineplus">+++ b/mailnews/addrbook/test/unit/test_nsIAbCard.js</span>
<a href="#l14.3"></a><span id="l14.3" class="difflineat">@@ -4,34 +4,27 @@</span>
<a href="#l14.4"></a><span id="l14.4">  *</span>
<a href="#l14.5"></a><span id="l14.5">  * XXX At the moment these just check the functions basically work i.e. can set</span>
<a href="#l14.6"></a><span id="l14.6">  * up all the parameters correctly. We'll have to extend them as we develop</span>
<a href="#l14.7"></a><span id="l14.7">  * the address book more, especially looking towards standards etc.</span>
<a href="#l14.8"></a><span id="l14.8">  */</span>
<a href="#l14.9"></a><span id="l14.9"> </span>
<a href="#l14.10"></a><span id="l14.10"> // Main function for the this test so we can check both personal and</span>
<a href="#l14.11"></a><span id="l14.11"> // collected books work correctly in an easy manner.</span>
<a href="#l14.12"></a><span id="l14.12" class="difflineplus">+</span>
<a href="#l14.13"></a><span id="l14.13"> function run_test() {</span>
<a href="#l14.14"></a><span id="l14.14">   loadABFile(&quot;data/cardForEmail&quot;, kPABData.fileName);</span>
<a href="#l14.15"></a><span id="l14.15"> </span>
<a href="#l14.16"></a><span id="l14.16">   // Test - Get the directory</span>
<a href="#l14.17"></a><span id="l14.17">   let AB = MailServices.ab.getDirectory(kPABData.URI);</span>
<a href="#l14.18"></a><span id="l14.18" class="difflineminus">-</span>
<a href="#l14.19"></a><span id="l14.19" class="difflineminus">-  var childCards = AB.childCards;</span>
<a href="#l14.20"></a><span id="l14.20">   var fullCard = null;</span>
<a href="#l14.21"></a><span id="l14.21" class="difflineminus">-  var tempCard;</span>
<a href="#l14.22"></a><span id="l14.22"> </span>
<a href="#l14.23"></a><span id="l14.23" class="difflineminus">-  while (childCards.hasMoreElements()) {</span>
<a href="#l14.24"></a><span id="l14.24" class="difflineminus">-    tempCard = childCards.getNext();</span>
<a href="#l14.25"></a><span id="l14.25" class="difflineminus">-</span>
<a href="#l14.26"></a><span id="l14.26" class="difflineplus">+  for (let tempCard of AB.childCards) {</span>
<a href="#l14.27"></a><span id="l14.27">     // We want the one with the right email...</span>
<a href="#l14.28"></a><span id="l14.28" class="difflineminus">-    if (</span>
<a href="#l14.29"></a><span id="l14.29" class="difflineminus">-      tempCard instanceof Ci.nsIAbCard &amp;&amp;</span>
<a href="#l14.30"></a><span id="l14.30" class="difflineminus">-      tempCard.primaryEmail == &quot;PrimaryEmail1@test.invalid&quot;</span>
<a href="#l14.31"></a><span id="l14.31" class="difflineminus">-    ) {</span>
<a href="#l14.32"></a><span id="l14.32" class="difflineplus">+    if (tempCard.primaryEmail == &quot;PrimaryEmail1@test.invalid&quot;) {</span>
<a href="#l14.33"></a><span id="l14.33">       fullCard = tempCard;</span>
<a href="#l14.34"></a><span id="l14.34">     }</span>
<a href="#l14.35"></a><span id="l14.35">   }</span>
<a href="#l14.36"></a><span id="l14.36"> </span>
<a href="#l14.37"></a><span id="l14.37">   Assert.ok(fullCard != null);</span>
<a href="#l14.38"></a><span id="l14.38"> </span>
<a href="#l14.39"></a><span id="l14.39">   // Test - VCard.</span>
<a href="#l14.40"></a><span id="l14.40"> </span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l15.1"></a><span id="l15.1" class="difflineminus">--- a/mailnews/base/content/junkCommands.js</span>
<a href="#l15.2"></a><span id="l15.2" class="difflineplus">+++ b/mailnews/base/content/junkCommands.js</span>
<a href="#l15.3"></a><span id="l15.3" class="difflineat">@@ -406,19 +406,17 @@ function deleteJunkInFolder() {</span>
<a href="#l15.4"></a><span id="l15.4">   MsgJunkMailInfo(true);</span>
<a href="#l15.5"></a><span id="l15.5"> </span>
<a href="#l15.6"></a><span id="l15.6">   // use direct folder commands if possible so we don't mess with the selection</span>
<a href="#l15.7"></a><span id="l15.7">   let selectedFolder = gFolderDisplay.displayedFolder;</span>
<a href="#l15.8"></a><span id="l15.8">   if (!selectedFolder.getFlag(Ci.nsMsgFolderFlags.Virtual)) {</span>
<a href="#l15.9"></a><span id="l15.9">     var junkMsgHdrs = Cc[&quot;@mozilla.org/array;1&quot;].createInstance(</span>
<a href="#l15.10"></a><span id="l15.10">       Ci.nsIMutableArray</span>
<a href="#l15.11"></a><span id="l15.11">     );</span>
<a href="#l15.12"></a><span id="l15.12" class="difflineminus">-    var enumerator = gDBView.msgFolder.messages;</span>
<a href="#l15.13"></a><span id="l15.13" class="difflineminus">-    while (enumerator.hasMoreElements()) {</span>
<a href="#l15.14"></a><span id="l15.14" class="difflineminus">-      let msgHdr = enumerator.getNext().QueryInterface(Ci.nsIMsgDBHdr);</span>
<a href="#l15.15"></a><span id="l15.15" class="difflineplus">+    for (let msgHdr of gDBView.msgFolder.messages) {</span>
<a href="#l15.16"></a><span id="l15.16">       let junkScore = msgHdr.getStringProperty(&quot;junkscore&quot;);</span>
<a href="#l15.17"></a><span id="l15.17">       if (junkScore == Ci.nsIJunkMailPlugin.IS_SPAM_SCORE) {</span>
<a href="#l15.18"></a><span id="l15.18">         junkMsgHdrs.appendElement(msgHdr);</span>
<a href="#l15.19"></a><span id="l15.19">       }</span>
<a href="#l15.20"></a><span id="l15.20">     }</span>
<a href="#l15.21"></a><span id="l15.21"> </span>
<a href="#l15.22"></a><span id="l15.22">     if (junkMsgHdrs.length) {</span>
<a href="#l15.23"></a><span id="l15.23">       gDBView.msgFolder.deleteMessages(</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l16.1"></a><span id="l16.1" class="difflineminus">--- a/mailnews/base/prefs/content/am-identity-edit.js</span>
<a href="#l16.2"></a><span id="l16.2" class="difflineplus">+++ b/mailnews/base/prefs/content/am-identity-edit.js</span>
<a href="#l16.3"></a><span id="l16.3" class="difflineat">@@ -459,28 +459,25 @@ function getAccountForFolderPickerState(</span>
<a href="#l16.4"></a><span id="l16.4">   return gAccount;</span>
<a href="#l16.5"></a><span id="l16.5"> }</span>
<a href="#l16.6"></a><span id="l16.6"> </span>
<a href="#l16.7"></a><span id="l16.7"> /**</span>
<a href="#l16.8"></a><span id="l16.8">  * Build the SMTP server list for display.</span>
<a href="#l16.9"></a><span id="l16.9">  */</span>
<a href="#l16.10"></a><span id="l16.10"> function loadSMTPServerList() {</span>
<a href="#l16.11"></a><span id="l16.11">   var smtpServerList = document.getElementById(&quot;identity.smtpServerKey&quot;);</span>
<a href="#l16.12"></a><span id="l16.12" class="difflineminus">-  let servers = MailServices.smtp.servers;</span>
<a href="#l16.13"></a><span id="l16.13">   let defaultServer = MailServices.smtp.defaultServer;</span>
<a href="#l16.14"></a><span id="l16.14">   let currentValue = smtpServerList.value;</span>
<a href="#l16.15"></a><span id="l16.15"> </span>
<a href="#l16.16"></a><span id="l16.16">   var smtpPopup = smtpServerList.menupopup;</span>
<a href="#l16.17"></a><span id="l16.17">   while (smtpPopup.lastChild.nodeName != &quot;menuseparator&quot;) {</span>
<a href="#l16.18"></a><span id="l16.18">     smtpPopup.lastChild.remove();</span>
<a href="#l16.19"></a><span id="l16.19">   }</span>
<a href="#l16.20"></a><span id="l16.20"> </span>
<a href="#l16.21"></a><span id="l16.21" class="difflineminus">-  while (servers.hasMoreElements()) {</span>
<a href="#l16.22"></a><span id="l16.22" class="difflineminus">-    var server = servers.getNext();</span>
<a href="#l16.23"></a><span id="l16.23" class="difflineminus">-</span>
<a href="#l16.24"></a><span id="l16.24" class="difflineplus">+  for (let server of MailServices.smtp.servers) {</span>
<a href="#l16.25"></a><span id="l16.25">     if (server instanceof Ci.nsISmtpServer) {</span>
<a href="#l16.26"></a><span id="l16.26">       var serverName = &quot;&quot;;</span>
<a href="#l16.27"></a><span id="l16.27">       if (server.description) {</span>
<a href="#l16.28"></a><span id="l16.28">         serverName = server.description + &quot; - &quot;;</span>
<a href="#l16.29"></a><span id="l16.29">       } else if (server.username) {</span>
<a href="#l16.30"></a><span id="l16.30">         serverName = server.username + &quot; - &quot;;</span>
<a href="#l16.31"></a><span id="l16.31">       }</span>
<a href="#l16.32"></a><span id="l16.32">       serverName += server.hostname;</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l17.1"></a><span id="l17.1" class="difflineminus">--- a/mailnews/base/prefs/content/am-junk.js</span>
<a href="#l17.2"></a><span id="l17.2" class="difflineplus">+++ b/mailnews/base/prefs/content/am-junk.js</span>
<a href="#l17.3"></a><span id="l17.3" class="difflineat">@@ -4,19 +4,16 @@</span>
<a href="#l17.4"></a><span id="l17.4">  * file, you can obtain one at http://mozilla.org/MPL/2.0/. */</span>
<a href="#l17.5"></a><span id="l17.5"> </span>
<a href="#l17.6"></a><span id="l17.6"> /* import-globals-from am-prefs.js */</span>
<a href="#l17.7"></a><span id="l17.7"> /* import-globals-from amUtils.js */</span>
<a href="#l17.8"></a><span id="l17.8"> </span>
<a href="#l17.9"></a><span id="l17.9"> var { MailServices } = ChromeUtils.import(</span>
<a href="#l17.10"></a><span id="l17.10">   &quot;resource:///modules/MailServices.jsm&quot;</span>
<a href="#l17.11"></a><span id="l17.11"> );</span>
<a href="#l17.12"></a><span id="l17.12" class="difflineminus">-var { fixIterator } = ChromeUtils.import(</span>
<a href="#l17.13"></a><span id="l17.13" class="difflineminus">-  &quot;resource:///modules/iteratorUtils.jsm&quot;</span>
<a href="#l17.14"></a><span id="l17.14" class="difflineminus">-);</span>
<a href="#l17.15"></a><span id="l17.15"> var { MailUtils } = ChromeUtils.import(&quot;resource:///modules/MailUtils.jsm&quot;);</span>
<a href="#l17.16"></a><span id="l17.16"> </span>
<a href="#l17.17"></a><span id="l17.17"> var gDeferredToAccount = &quot;&quot;;</span>
<a href="#l17.18"></a><span id="l17.18"> </span>
<a href="#l17.19"></a><span id="l17.19"> function onInit(aPageId, aServerId) {</span>
<a href="#l17.20"></a><span id="l17.20">   // manually adjust several pref UI elements</span>
<a href="#l17.21"></a><span id="l17.21">   document</span>
<a href="#l17.22"></a><span id="l17.22">     .getElementById(&quot;server.spamLevel.visible&quot;)</span>
<a href="#l17.23"></a><span id="l17.23" class="difflineat">@@ -79,17 +76,17 @@ function onInit(aPageId, aServerId) {</span>
<a href="#l17.24"></a><span id="l17.24">   var wList = document.getElementById(&quot;whiteListAbURI&quot;);</span>
<a href="#l17.25"></a><span id="l17.25">   // Ensure the whitelist is empty</span>
<a href="#l17.26"></a><span id="l17.26">   while (wList.hasChildNodes()) {</span>
<a href="#l17.27"></a><span id="l17.27">     wList.lastChild.remove();</span>
<a href="#l17.28"></a><span id="l17.28">   }</span>
<a href="#l17.29"></a><span id="l17.29"> </span>
<a href="#l17.30"></a><span id="l17.30">   // Populate the listbox with address books</span>
<a href="#l17.31"></a><span id="l17.31">   let abItems = [];</span>
<a href="#l17.32"></a><span id="l17.32" class="difflineminus">-  for (let ab of fixIterator(MailServices.ab.directories, Ci.nsIAbDirectory)) {</span>
<a href="#l17.33"></a><span id="l17.33" class="difflineplus">+  for (let ab of MailServices.ab.directories) {</span>
<a href="#l17.34"></a><span id="l17.34">     // We skip mailing lists and remote address books.</span>
<a href="#l17.35"></a><span id="l17.35">     if (ab.isMailList || ab.isRemote) {</span>
<a href="#l17.36"></a><span id="l17.36">       continue;</span>
<a href="#l17.37"></a><span id="l17.37">     }</span>
<a href="#l17.38"></a><span id="l17.38"> </span>
<a href="#l17.39"></a><span id="l17.39">     abItems.push({ label: ab.dirName, URI: ab.URI });</span>
<a href="#l17.40"></a><span id="l17.40">   }</span>
<a href="#l17.41"></a><span id="l17.41"> </span>
<a href="#l17.42"></a><span id="l17.42" class="difflineat">@@ -307,20 +304,18 @@ function buildServerFilterMenuList() {</span>
<a href="#l17.43"></a><span id="l17.43">  *</span>
<a href="#l17.44"></a><span id="l17.44">  * @param aDir              directory to look for .sfd files</span>
<a href="#l17.45"></a><span id="l17.45">  * @param aExistingEntries  Filter names already found.</span>
<a href="#l17.46"></a><span id="l17.46">  */</span>
<a href="#l17.47"></a><span id="l17.47"> function buildServerFilterListFromDir(aDir, aExistingEntries) {</span>
<a href="#l17.48"></a><span id="l17.48">   let newEntries = [];</span>
<a href="#l17.49"></a><span id="l17.49">   // Now iterate over each file in the directory looking for .sfd files.</span>
<a href="#l17.50"></a><span id="l17.50">   const kSuffix = &quot;.sfd&quot;;</span>
<a href="#l17.51"></a><span id="l17.51" class="difflineminus">-  let entries = aDir.directoryEntries.QueryInterface(Ci.nsIDirectoryEnumerator);</span>
<a href="#l17.52"></a><span id="l17.52"> </span>
<a href="#l17.53"></a><span id="l17.53" class="difflineminus">-  while (entries.hasMoreElements()) {</span>
<a href="#l17.54"></a><span id="l17.54" class="difflineminus">-    let entry = entries.nextFile;</span>
<a href="#l17.55"></a><span id="l17.55" class="difflineplus">+  for (let entry of aDir.directoryEntries) {</span>
<a href="#l17.56"></a><span id="l17.56">     // we only care about files that end in .sfd</span>
<a href="#l17.57"></a><span id="l17.57">     if (entry.isFile() &amp;&amp; entry.leafName.endsWith(kSuffix)) {</span>
<a href="#l17.58"></a><span id="l17.58">       let fileName = entry.leafName.slice(0, -kSuffix.length);</span>
<a href="#l17.59"></a><span id="l17.59">       // If we've already added an item with this name, then don't add it again.</span>
<a href="#l17.60"></a><span id="l17.60">       if (!aExistingEntries.includes(fileName)) {</span>
<a href="#l17.61"></a><span id="l17.61">         newEntries.push(fileName);</span>
<a href="#l17.62"></a><span id="l17.62">       }</span>
<a href="#l17.63"></a><span id="l17.63">     }</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l18.1"></a><span id="l18.1" class="difflineminus">--- a/mailnews/base/prefs/content/am-smtp.js</span>
<a href="#l18.2"></a><span id="l18.2" class="difflineplus">+++ b/mailnews/base/prefs/content/am-smtp.js</span>
<a href="#l18.3"></a><span id="l18.3" class="difflineat">@@ -208,19 +208,17 @@ var gSmtpServerListWindow = {</span>
<a href="#l18.4"></a><span id="l18.4">     }</span>
<a href="#l18.5"></a><span id="l18.5">   },</span>
<a href="#l18.6"></a><span id="l18.6"> </span>
<a href="#l18.7"></a><span id="l18.7">   fillSmtpServers(aListBox, aServers, aDefaultServer) {</span>
<a href="#l18.8"></a><span id="l18.8">     if (!aListBox || !aServers) {</span>
<a href="#l18.9"></a><span id="l18.9">       return;</span>
<a href="#l18.10"></a><span id="l18.10">     }</span>
<a href="#l18.11"></a><span id="l18.11"> </span>
<a href="#l18.12"></a><span id="l18.12" class="difflineminus">-    while (aServers.hasMoreElements()) {</span>
<a href="#l18.13"></a><span id="l18.13" class="difflineminus">-      var server = aServers.getNext();</span>
<a href="#l18.14"></a><span id="l18.14" class="difflineminus">-</span>
<a href="#l18.15"></a><span id="l18.15" class="difflineplus">+    for (let server of aServers) {</span>
<a href="#l18.16"></a><span id="l18.16">       if (server instanceof Ci.nsISmtpServer) {</span>
<a href="#l18.17"></a><span id="l18.17">         var isDefault = aDefaultServer.key == server.key;</span>
<a href="#l18.18"></a><span id="l18.18"> </span>
<a href="#l18.19"></a><span id="l18.19">         var listitem = this.createSmtpListItem(server, isDefault);</span>
<a href="#l18.20"></a><span id="l18.20">         aListBox.appendChild(listitem);</span>
<a href="#l18.21"></a><span id="l18.21">       }</span>
<a href="#l18.22"></a><span id="l18.22">     }</span>
<a href="#l18.23"></a><span id="l18.23">   },</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l19.1"></a><span id="l19.1" class="difflineminus">--- a/mailnews/base/prefs/content/converterDialog.js</span>
<a href="#l19.2"></a><span id="l19.2" class="difflineplus">+++ b/mailnews/base/prefs/content/converterDialog.js</span>
<a href="#l19.3"></a><span id="l19.3" class="difflineat">@@ -289,19 +289,18 @@ function startContinue(aSelectedStoreTyp</span>
<a href="#l19.4"></a><span id="l19.4">    * Check whether an mbox folder can be compacted or not.</span>
<a href="#l19.5"></a><span id="l19.5">    * @param {nsIMsgFolder} aFolder - mbox folder that is to be checked.</span>
<a href="#l19.6"></a><span id="l19.6">    */</span>
<a href="#l19.7"></a><span id="l19.7">   function canCompact(aFolder) {</span>
<a href="#l19.8"></a><span id="l19.8">     if (aFolder.expungedBytes != 0) {</span>
<a href="#l19.9"></a><span id="l19.9">       return true;</span>
<a href="#l19.10"></a><span id="l19.10">     }</span>
<a href="#l19.11"></a><span id="l19.11">     if (aFolder.hasSubFolders) {</span>
<a href="#l19.12"></a><span id="l19.12" class="difflineminus">-      let subFolders = aFolder.subFolders;</span>
<a href="#l19.13"></a><span id="l19.13" class="difflineminus">-      while (subFolders.hasMoreElements()) {</span>
<a href="#l19.14"></a><span id="l19.14" class="difflineminus">-        if (canCompact(subFolders.getNext().QueryInterface(Ci.nsIMsgFolder))) {</span>
<a href="#l19.15"></a><span id="l19.15" class="difflineplus">+      for (let subFolder of aFolder.subFolders) {</span>
<a href="#l19.16"></a><span id="l19.16" class="difflineplus">+        if (canCompact(subFolder)) {</span>
<a href="#l19.17"></a><span id="l19.17">           return true;</span>
<a href="#l19.18"></a><span id="l19.18">         }</span>
<a href="#l19.19"></a><span id="l19.19">       }</span>
<a href="#l19.20"></a><span id="l19.20">     }</span>
<a href="#l19.21"></a><span id="l19.21">     return false;</span>
<a href="#l19.22"></a><span id="l19.22">   }</span>
<a href="#l19.23"></a><span id="l19.23"> </span>
<a href="#l19.24"></a><span id="l19.24">   // Compaction (compactAll()) works only for mbox folders which satisfy one of</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l20.1"></a><span id="l20.1" class="difflineminus">--- a/mailnews/base/search/content/FilterEditor.js</span>
<a href="#l20.2"></a><span id="l20.2" class="difflineplus">+++ b/mailnews/base/search/content/FilterEditor.js</span>
<a href="#l20.3"></a><span id="l20.3" class="difflineat">@@ -804,22 +804,17 @@ function SetBusyCursor(window, enable) {</span>
<a href="#l20.4"></a><span id="l20.4"> // suite/components/helpviewer/content/contextHelp.js</span>
<a href="#l20.5"></a><span id="l20.5"> function doHelpButton() {</span>
<a href="#l20.6"></a><span id="l20.6">   openHelp(&quot;mail-filters&quot;);</span>
<a href="#l20.7"></a><span id="l20.7"> }</span>
<a href="#l20.8"></a><span id="l20.8"> </span>
<a href="#l20.9"></a><span id="l20.9"> function getCustomActions() {</span>
<a href="#l20.10"></a><span id="l20.10">   if (!gCustomActions) {</span>
<a href="#l20.11"></a><span id="l20.11">     gCustomActions = [];</span>
<a href="#l20.12"></a><span id="l20.12" class="difflineminus">-    let customActionsEnum = MailServices.filters.getCustomActions();</span>
<a href="#l20.13"></a><span id="l20.13" class="difflineminus">-    while (customActionsEnum.hasMoreElements()) {</span>
<a href="#l20.14"></a><span id="l20.14" class="difflineminus">-      gCustomActions.push(</span>
<a href="#l20.15"></a><span id="l20.15" class="difflineminus">-        customActionsEnum.getNext().QueryInterface(Ci.nsIMsgFilterCustomAction)</span>
<a href="#l20.16"></a><span id="l20.16" class="difflineminus">-      );</span>
<a href="#l20.17"></a><span id="l20.17" class="difflineminus">-    }</span>
<a href="#l20.18"></a><span id="l20.18" class="difflineplus">+    gCustomActions = [...MailServices.filters.getCustomActions()];</span>
<a href="#l20.19"></a><span id="l20.19">   }</span>
<a href="#l20.20"></a><span id="l20.20"> }</span>
<a href="#l20.21"></a><span id="l20.21"> </span>
<a href="#l20.22"></a><span id="l20.22"> function updateFilterType() {</span>
<a href="#l20.23"></a><span id="l20.23">   gFilterType = gFilterTypeSelector.getType();</span>
<a href="#l20.24"></a><span id="l20.24">   setFilterScope(gFilterType, gFilterList);</span>
<a href="#l20.25"></a><span id="l20.25"> </span>
<a href="#l20.26"></a><span id="l20.26">   // set valid actions</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l21.1"></a><span id="l21.1" class="difflineminus">--- a/mailnews/base/search/content/searchWidgets.js</span>
<a href="#l21.2"></a><span id="l21.2" class="difflineplus">+++ b/mailnews/base/search/content/searchWidgets.js</span>
<a href="#l21.3"></a><span id="l21.3" class="difflineat">@@ -11,19 +11,16 @@</span>
<a href="#l21.4"></a><span id="l21.4"> {</span>
<a href="#l21.5"></a><span id="l21.5">   const { Services } = ChromeUtils.import(</span>
<a href="#l21.6"></a><span id="l21.6">     &quot;resource://gre/modules/Services.jsm&quot;</span>
<a href="#l21.7"></a><span id="l21.7">   );</span>
<a href="#l21.8"></a><span id="l21.8">   const { MailServices } = ChromeUtils.import(</span>
<a href="#l21.9"></a><span id="l21.9">     &quot;resource:///modules/MailServices.jsm&quot;</span>
<a href="#l21.10"></a><span id="l21.10">   );</span>
<a href="#l21.11"></a><span id="l21.11">   const { MailUtils } = ChromeUtils.import(&quot;resource:///modules/MailUtils.jsm&quot;);</span>
<a href="#l21.12"></a><span id="l21.12" class="difflineminus">-  const { fixIterator } = ChromeUtils.import(</span>
<a href="#l21.13"></a><span id="l21.13" class="difflineminus">-    &quot;resource:///modules/iteratorUtils.jsm&quot;</span>
<a href="#l21.14"></a><span id="l21.14" class="difflineminus">-  );</span>
<a href="#l21.15"></a><span id="l21.15"> </span>
<a href="#l21.16"></a><span id="l21.16">   const updateParentNode = parentNode =&gt; {</span>
<a href="#l21.17"></a><span id="l21.17">     if (parentNode.hasAttribute(&quot;initialActionIndex&quot;)) {</span>
<a href="#l21.18"></a><span id="l21.18">       let actionIndex = parentNode.getAttribute(&quot;initialActionIndex&quot;);</span>
<a href="#l21.19"></a><span id="l21.19">       let filterAction = gFilter.getActionAt(actionIndex);</span>
<a href="#l21.20"></a><span id="l21.20">       parentNode.initWithAction(filterAction);</span>
<a href="#l21.21"></a><span id="l21.21">     }</span>
<a href="#l21.22"></a><span id="l21.22">     parentNode.updateRemoveButton();</span>
<a href="#l21.23"></a><span id="l21.23" class="difflineat">@@ -1422,27 +1419,24 @@</span>
<a href="#l21.24"></a><span id="l21.24">             foldersScanned.push(msgFolder);</span>
<a href="#l21.25"></a><span id="l21.25">             enumerator = msgFolder.msgDatabase.EnumerateMessages();</span>
<a href="#l21.26"></a><span id="l21.26">           }</span>
<a href="#l21.27"></a><span id="l21.27"> </span>
<a href="#l21.28"></a><span id="l21.28">           if (!enumerator) {</span>
<a href="#l21.29"></a><span id="l21.29">             continue;</span>
<a href="#l21.30"></a><span id="l21.30">           }</span>
<a href="#l21.31"></a><span id="l21.31"> </span>
<a href="#l21.32"></a><span id="l21.32" class="difflineminus">-          while (enumerator.hasMoreElements()) {</span>
<a href="#l21.33"></a><span id="l21.33" class="difflineminus">-            let header = enumerator.getNext();</span>
<a href="#l21.34"></a><span id="l21.34" class="difflineminus">-            if (header instanceof Ci.nsIMsgDBHdr) {</span>
<a href="#l21.35"></a><span id="l21.35" class="difflineminus">-              let uri =</span>
<a href="#l21.36"></a><span id="l21.36" class="difflineminus">-                msgFolder.URI +</span>
<a href="#l21.37"></a><span id="l21.37" class="difflineminus">-                &quot;?messageId=&quot; +</span>
<a href="#l21.38"></a><span id="l21.38" class="difflineminus">-                header.messageId +</span>
<a href="#l21.39"></a><span id="l21.39" class="difflineminus">-                &quot;&amp;subject=&quot; +</span>
<a href="#l21.40"></a><span id="l21.40" class="difflineminus">-                header.mime2DecodedSubject;</span>
<a href="#l21.41"></a><span id="l21.41" class="difflineminus">-              templates.push({ label: header.mime2DecodedSubject, value: uri });</span>
<a href="#l21.42"></a><span id="l21.42" class="difflineminus">-            }</span>
<a href="#l21.43"></a><span id="l21.43" class="difflineplus">+          for (let header of enumerator) {</span>
<a href="#l21.44"></a><span id="l21.44" class="difflineplus">+            let uri =</span>
<a href="#l21.45"></a><span id="l21.45" class="difflineplus">+              msgFolder.URI +</span>
<a href="#l21.46"></a><span id="l21.46" class="difflineplus">+              &quot;?messageId=&quot; +</span>
<a href="#l21.47"></a><span id="l21.47" class="difflineplus">+              header.messageId +</span>
<a href="#l21.48"></a><span id="l21.48" class="difflineplus">+              &quot;&amp;subject=&quot; +</span>
<a href="#l21.49"></a><span id="l21.49" class="difflineplus">+              header.mime2DecodedSubject;</span>
<a href="#l21.50"></a><span id="l21.50" class="difflineplus">+            templates.push({ label: header.mime2DecodedSubject, value: uri });</span>
<a href="#l21.51"></a><span id="l21.51">           }</span>
<a href="#l21.52"></a><span id="l21.52">         }</span>
<a href="#l21.53"></a><span id="l21.53">         return templates;</span>
<a href="#l21.54"></a><span id="l21.54">       }</span>
<a href="#l21.55"></a><span id="l21.55">     }</span>
<a href="#l21.56"></a><span id="l21.56"> </span>
<a href="#l21.57"></a><span id="l21.57">     customElements.define(</span>
<a href="#l21.58"></a><span id="l21.58">       &quot;ruleactiontype-menulist&quot;,</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l22.1"></a><span id="l22.1" class="difflineminus">--- a/mailnews/base/test/unit/test_compactFailure.js</span>
<a href="#l22.2"></a><span id="l22.2" class="difflineplus">+++ b/mailnews/base/test/unit/test_compactFailure.js</span>
<a href="#l22.3"></a><span id="l22.3" class="difflineat">@@ -119,21 +119,17 @@ function* setup_open_failure_folder() {</span>
<a href="#l22.4"></a><span id="l22.4">   );</span>
<a href="#l22.5"></a><span id="l22.5">   addMessagesToFolder(generate_messages(), gTargetFolder);</span>
<a href="#l22.6"></a><span id="l22.6"> </span>
<a href="#l22.7"></a><span id="l22.7">   mailTestUtils.updateFolderAndNotify(gTargetFolder, async_driver);</span>
<a href="#l22.8"></a><span id="l22.8">   yield false;</span>
<a href="#l22.9"></a><span id="l22.9"> }</span>
<a href="#l22.10"></a><span id="l22.10"> </span>
<a href="#l22.11"></a><span id="l22.11"> function* delete_all_messages() {</span>
<a href="#l22.12"></a><span id="l22.12" class="difflineminus">-  let enumerator = gTargetFolder.messages;</span>
<a href="#l22.13"></a><span id="l22.13" class="difflineminus">-  let headers = [];</span>
<a href="#l22.14"></a><span id="l22.14" class="difflineminus">-  while (enumerator.hasMoreElements()) {</span>
<a href="#l22.15"></a><span id="l22.15" class="difflineminus">-    headers.push(enumerator.getNext().QueryInterface(Ci.nsIMsgDBHdr));</span>
<a href="#l22.16"></a><span id="l22.16" class="difflineminus">-  }</span>
<a href="#l22.17"></a><span id="l22.17" class="difflineplus">+  let headers = [...gTargetFolder.messages];</span>
<a href="#l22.18"></a><span id="l22.18"> </span>
<a href="#l22.19"></a><span id="l22.19">   let array = toXPCOMArray(headers, Ci.nsIMutableArray);</span>
<a href="#l22.20"></a><span id="l22.20"> </span>
<a href="#l22.21"></a><span id="l22.21">   gTargetFolder.deleteMessages(</span>
<a href="#l22.22"></a><span id="l22.22">     array,</span>
<a href="#l22.23"></a><span id="l22.23">     null,</span>
<a href="#l22.24"></a><span id="l22.24">     false,</span>
<a href="#l22.25"></a><span id="l22.25">     true,</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l23.1"></a><span id="l23.1" class="difflineminus">--- a/mailnews/base/test/unit/test_converterDeferredAccount.js</span>
<a href="#l23.2"></a><span id="l23.2" class="difflineplus">+++ b/mailnews/base/test/unit/test_converterDeferredAccount.js</span>
<a href="#l23.3"></a><span id="l23.3" class="difflineat">@@ -72,20 +72,17 @@ function copyFileMessage(file, destFolde</span>
<a href="#l23.4"></a><span id="l23.4"> }</span>
<a href="#l23.5"></a><span id="l23.5"> </span>
<a href="#l23.6"></a><span id="l23.6"> /**</span>
<a href="#l23.7"></a><span id="l23.7">  * Check that conversion worked for the given source.</span>
<a href="#l23.8"></a><span id="l23.8">  * @param source - mbox source directory</span>
<a href="#l23.9"></a><span id="l23.9">  * @param target - maildir target directory</span>
<a href="#l23.10"></a><span id="l23.10">  */</span>
<a href="#l23.11"></a><span id="l23.11"> function checkConversion(source, target) {</span>
<a href="#l23.12"></a><span id="l23.12" class="difflineminus">-  let sourceContents = source.directoryEntries;</span>
<a href="#l23.13"></a><span id="l23.13" class="difflineminus">-</span>
<a href="#l23.14"></a><span id="l23.14" class="difflineminus">-  while (sourceContents.hasMoreElements()) {</span>
<a href="#l23.15"></a><span id="l23.15" class="difflineminus">-    let sourceContent = sourceContents.nextFile;</span>
<a href="#l23.16"></a><span id="l23.16" class="difflineplus">+  for (let sourceContent of source.directoryEntries) {</span>
<a href="#l23.17"></a><span id="l23.17">     let sourceContentName = sourceContent.leafName;</span>
<a href="#l23.18"></a><span id="l23.18">     let ext = sourceContentName.substr(-4);</span>
<a href="#l23.19"></a><span id="l23.19">     let targetFile = FileUtils.File(</span>
<a href="#l23.20"></a><span id="l23.20">       OS.Path.join(target.path, sourceContentName)</span>
<a href="#l23.21"></a><span id="l23.21">     );</span>
<a href="#l23.22"></a><span id="l23.22">     log.debug(&quot;Checking path: &quot; + targetFile.path);</span>
<a href="#l23.23"></a><span id="l23.23">     if (ext == &quot;.dat&quot;) {</span>
<a href="#l23.24"></a><span id="l23.24">       Assert.ok(targetFile.exists());</span>
<a href="#l23.25"></a><span id="l23.25" class="difflineat">@@ -95,21 +92,17 @@ function checkConversion(source, target)</span>
<a href="#l23.26"></a><span id="l23.26">     } else if (ext != &quot;.msf&quot;) {</span>
<a href="#l23.27"></a><span id="l23.27">       Assert.ok(targetFile.exists());</span>
<a href="#l23.28"></a><span id="l23.28">       let cur = FileUtils.File(OS.Path.join(targetFile.path, &quot;cur&quot;));</span>
<a href="#l23.29"></a><span id="l23.29">       Assert.ok(cur.exists());</span>
<a href="#l23.30"></a><span id="l23.30">       let tmp = FileUtils.File(OS.Path.join(targetFile.path, &quot;tmp&quot;));</span>
<a href="#l23.31"></a><span id="l23.31">       Assert.ok(tmp.exists());</span>
<a href="#l23.32"></a><span id="l23.32">       if (targetFile.leafName == &quot;Inbox&quot;) {</span>
<a href="#l23.33"></a><span id="l23.33">         let curContents = cur.directoryEntries;</span>
<a href="#l23.34"></a><span id="l23.34" class="difflineminus">-        let curContentsCount = 0;</span>
<a href="#l23.35"></a><span id="l23.35" class="difflineminus">-        while (curContents.hasMoreElements()) {</span>
<a href="#l23.36"></a><span id="l23.36" class="difflineminus">-          curContents.nextFile;</span>
<a href="#l23.37"></a><span id="l23.37" class="difflineminus">-          curContentsCount++;</span>
<a href="#l23.38"></a><span id="l23.38" class="difflineminus">-        }</span>
<a href="#l23.39"></a><span id="l23.39" class="difflineplus">+        let curContentsCount = [...curContents].length;</span>
<a href="#l23.40"></a><span id="l23.40">         Assert.equal(curContentsCount, 1000);</span>
<a href="#l23.41"></a><span id="l23.41">       }</span>
<a href="#l23.42"></a><span id="l23.42">     }</span>
<a href="#l23.43"></a><span id="l23.43">   }</span>
<a href="#l23.44"></a><span id="l23.44"> }</span>
<a href="#l23.45"></a><span id="l23.45"> </span>
<a href="#l23.46"></a><span id="l23.46"> function run_test() {</span>
<a href="#l23.47"></a><span id="l23.47">   localAccountUtils.loadLocalMailAccount();</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l24.1"></a><span id="l24.1" class="difflineminus">--- a/mailnews/base/test/unit/test_copyThenMoveManual.js</span>
<a href="#l24.2"></a><span id="l24.2" class="difflineplus">+++ b/mailnews/base/test/unit/test_copyThenMoveManual.js</span>
<a href="#l24.3"></a><span id="l24.3" class="difflineat">@@ -99,23 +99,17 @@ var gTestArray = [</span>
<a href="#l24.4"></a><span id="l24.4">     // Cleanup, null out everything, close all cached connections and stop the</span>
<a href="#l24.5"></a><span id="l24.5">     // server</span>
<a href="#l24.6"></a><span id="l24.6">     dump(&quot; Exiting mail tests\n&quot;);</span>
<a href="#l24.7"></a><span id="l24.7">     gPOP3Pump = null;</span>
<a href="#l24.8"></a><span id="l24.8">   },</span>
<a href="#l24.9"></a><span id="l24.9"> ];</span>
<a href="#l24.10"></a><span id="l24.10"> </span>
<a href="#l24.11"></a><span id="l24.11"> function folderCount(folder) {</span>
<a href="#l24.12"></a><span id="l24.12" class="difflineminus">-  let enumerator = folder.msgDatabase.EnumerateMessages();</span>
<a href="#l24.13"></a><span id="l24.13" class="difflineminus">-  let count = 0;</span>
<a href="#l24.14"></a><span id="l24.14" class="difflineminus">-  while (enumerator.hasMoreElements()) {</span>
<a href="#l24.15"></a><span id="l24.15" class="difflineminus">-    count++;</span>
<a href="#l24.16"></a><span id="l24.16" class="difflineminus">-    enumerator.getNext();</span>
<a href="#l24.17"></a><span id="l24.17" class="difflineminus">-  }</span>
<a href="#l24.18"></a><span id="l24.18" class="difflineminus">-  return count;</span>
<a href="#l24.19"></a><span id="l24.19" class="difflineplus">+  return [...folder.msgDatabase.EnumerateMessages()].length;</span>
<a href="#l24.20"></a><span id="l24.20"> }</span>
<a href="#l24.21"></a><span id="l24.21"> </span>
<a href="#l24.22"></a><span id="l24.22"> function run_test() {</span>
<a href="#l24.23"></a><span id="l24.23">   if (!localAccountUtils.inboxFolder) {</span>
<a href="#l24.24"></a><span id="l24.24">     localAccountUtils.loadLocalMailAccount();</span>
<a href="#l24.25"></a><span id="l24.25">   }</span>
<a href="#l24.26"></a><span id="l24.26"> </span>
<a href="#l24.27"></a><span id="l24.27">   gCopyFolder = localAccountUtils.rootFolder.createLocalSubfolder(&quot;CopyFolder&quot;);</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l25.1"></a><span id="l25.1" class="difflineminus">--- a/mailnews/base/test/unit/test_folderCompact.js</span>
<a href="#l25.2"></a><span id="l25.2" class="difflineplus">+++ b/mailnews/base/test/unit/test_folderCompact.js</span>
<a href="#l25.3"></a><span id="l25.3" class="difflineat">@@ -126,32 +126,30 @@ function calculateFolderSize(folder) {</span>
<a href="#l25.4"></a><span id="l25.4">   let enumerator = msgDB.EnumerateMessages();</span>
<a href="#l25.5"></a><span id="l25.5">   let totalSize = 0;</span>
<a href="#l25.6"></a><span id="l25.6">   if (enumerator) {</span>
<a href="#l25.7"></a><span id="l25.7">     if (gMsgLinebreak == &quot;&quot;) {</span>
<a href="#l25.8"></a><span id="l25.8">       // Figure out what the linebreak sequence is on the platform running the tests.</span>
<a href="#l25.9"></a><span id="l25.9">       gMsgLinebreak =</span>
<a href="#l25.10"></a><span id="l25.10">         &quot;@mozilla.org/windows-registry-key;1&quot; in Cc ? &quot;\r\n&quot; : &quot;\n&quot;;</span>
<a href="#l25.11"></a><span id="l25.11">     }</span>
<a href="#l25.12"></a><span id="l25.12" class="difflineminus">-    while (enumerator.hasMoreElements()) {</span>
<a href="#l25.13"></a><span id="l25.13" class="difflineminus">-      var header = enumerator.getNext();</span>
<a href="#l25.14"></a><span id="l25.14" class="difflineplus">+    for (let header of enumerator) {</span>
<a href="#l25.15"></a><span id="l25.15">       if (header instanceof Ci.nsIMsgDBHdr) {</span>
<a href="#l25.16"></a><span id="l25.16">         totalSize += header.messageSize + gMsgLinebreak.length;</span>
<a href="#l25.17"></a><span id="l25.17">       }</span>
<a href="#l25.18"></a><span id="l25.18">     }</span>
<a href="#l25.19"></a><span id="l25.19">   }</span>
<a href="#l25.20"></a><span id="l25.20">   return totalSize;</span>
<a href="#l25.21"></a><span id="l25.21"> }</span>
<a href="#l25.22"></a><span id="l25.22"> </span>
<a href="#l25.23"></a><span id="l25.23"> function verifyMsgOffsets(folder) {</span>
<a href="#l25.24"></a><span id="l25.24">   let msgDB = folder.msgDatabase;</span>
<a href="#l25.25"></a><span id="l25.25">   let enumerator = msgDB.EnumerateMessages();</span>
<a href="#l25.26"></a><span id="l25.26">   if (enumerator) {</span>
<a href="#l25.27"></a><span id="l25.27" class="difflineminus">-    while (enumerator.hasMoreElements()) {</span>
<a href="#l25.28"></a><span id="l25.28" class="difflineminus">-      let header = enumerator.getNext();</span>
<a href="#l25.29"></a><span id="l25.29" class="difflineplus">+    for (let header of enumerator) {</span>
<a href="#l25.30"></a><span id="l25.30">       if (header instanceof Ci.nsIMsgDBHdr) {</span>
<a href="#l25.31"></a><span id="l25.31">         let storeToken = header.getStringProperty(&quot;storeToken&quot;);</span>
<a href="#l25.32"></a><span id="l25.32">         Assert.equal(storeToken, header.messageOffset);</span>
<a href="#l25.33"></a><span id="l25.33">       }</span>
<a href="#l25.34"></a><span id="l25.34">     }</span>
<a href="#l25.35"></a><span id="l25.35">   }</span>
<a href="#l25.36"></a><span id="l25.36"> }</span>
<a href="#l25.37"></a><span id="l25.37"> </span>
<a href="#l25.38"></a><span id="l25.38" class="difflineat">@@ -210,19 +208,17 @@ var gTestArray = [</span>
<a href="#l25.39"></a><span id="l25.39">   async function testDeleteMessages1() {</span>
<a href="#l25.40"></a><span id="l25.40">     // delete to trash</span>
<a href="#l25.41"></a><span id="l25.41">     // Let's take a moment to re-initialize stuff that got moved</span>
<a href="#l25.42"></a><span id="l25.42">     var folder3DB = gLocalFolder3.msgDatabase;</span>
<a href="#l25.43"></a><span id="l25.43">     gMsgHdrs[0].hdr = folder3DB.getMsgHdrForMessageID(gMsgHdrs[0].ID);</span>
<a href="#l25.44"></a><span id="l25.44"> </span>
<a href="#l25.45"></a><span id="l25.45">     // Store message keys before deletion and compaction.</span>
<a href="#l25.46"></a><span id="l25.46">     gMsgKeys.folder = gLocalFolder3;</span>
<a href="#l25.47"></a><span id="l25.47" class="difflineminus">-    let folderMsgs = gLocalFolder3.messages;</span>
<a href="#l25.48"></a><span id="l25.48" class="difflineminus">-    while (folderMsgs.hasMoreElements()) {</span>
<a href="#l25.49"></a><span id="l25.49" class="difflineminus">-      let header = folderMsgs.getNext().QueryInterface(Ci.nsIMsgDBHdr);</span>
<a href="#l25.50"></a><span id="l25.50" class="difflineplus">+    for (let header of gLocalFolder3.messages) {</span>
<a href="#l25.51"></a><span id="l25.51">       gMsgKeys.push(header.messageKey);</span>
<a href="#l25.52"></a><span id="l25.52">     }</span>
<a href="#l25.53"></a><span id="l25.53"> </span>
<a href="#l25.54"></a><span id="l25.54">     // Now delete the message</span>
<a href="#l25.55"></a><span id="l25.55">     await deleteMessages(gLocalFolder3, [gMsgHdrs[0].hdr], false, false);</span>
<a href="#l25.56"></a><span id="l25.56"> </span>
<a href="#l25.57"></a><span id="l25.57">     showMessages(gLocalFolder3, &quot;after deleting 1 message to trash&quot;);</span>
<a href="#l25.58"></a><span id="l25.58">   },</span>
<a href="#l25.59"></a><span id="l25.59" class="difflineat">@@ -238,19 +234,17 @@ var gTestArray = [</span>
<a href="#l25.60"></a><span id="l25.60">   async function testDeleteMessages2() {</span>
<a href="#l25.61"></a><span id="l25.61">     Assert.equal(gExpectedFolderSize, gLocalFolder3.filePath.fileSize);</span>
<a href="#l25.62"></a><span id="l25.62">     verifyMsgOffsets(gLocalFolder3);</span>
<a href="#l25.63"></a><span id="l25.63">     var folder2DB = gLocalFolder2.msgDatabase;</span>
<a href="#l25.64"></a><span id="l25.64">     gMsgHdrs[0].hdr = folder2DB.getMsgHdrForMessageID(gMsgHdrs[0].ID);</span>
<a href="#l25.65"></a><span id="l25.65"> </span>
<a href="#l25.66"></a><span id="l25.66">     // Store message keys before deletion and compaction.</span>
<a href="#l25.67"></a><span id="l25.67">     gMsgKeys.folder = gLocalFolder2;</span>
<a href="#l25.68"></a><span id="l25.68" class="difflineminus">-    let folderMsgs = gLocalFolder2.messages;</span>
<a href="#l25.69"></a><span id="l25.69" class="difflineminus">-    while (folderMsgs.hasMoreElements()) {</span>
<a href="#l25.70"></a><span id="l25.70" class="difflineminus">-      let header = folderMsgs.getNext().QueryInterface(Ci.nsIMsgDBHdr);</span>
<a href="#l25.71"></a><span id="l25.71" class="difflineplus">+    for (let header of gLocalFolder2.messages) {</span>
<a href="#l25.72"></a><span id="l25.72">       gMsgKeys.push(header.messageKey);</span>
<a href="#l25.73"></a><span id="l25.73">     }</span>
<a href="#l25.74"></a><span id="l25.74"> </span>
<a href="#l25.75"></a><span id="l25.75">     // Now delete the message</span>
<a href="#l25.76"></a><span id="l25.76">     await deleteMessages(gLocalFolder2, [gMsgHdrs[0].hdr], false, false);</span>
<a href="#l25.77"></a><span id="l25.77"> </span>
<a href="#l25.78"></a><span id="l25.78">     showMessages(gLocalFolder2, &quot;after deleting 1 message&quot;);</span>
<a href="#l25.79"></a><span id="l25.79">   },</span>
<a href="#l25.80"></a><span id="l25.80" class="difflineat">@@ -343,19 +337,17 @@ function run_test() {</span>
<a href="#l25.81"></a><span id="l25.81"> </span>
<a href="#l25.82"></a><span id="l25.82">   gTestArray.forEach(x =&gt; add_task(x));</span>
<a href="#l25.83"></a><span id="l25.83">   run_next_test();</span>
<a href="#l25.84"></a><span id="l25.84"> }</span>
<a href="#l25.85"></a><span id="l25.85"> </span>
<a href="#l25.86"></a><span id="l25.86"> // debug utility to show the key/offset/ID relationship of messages in a folder</span>
<a href="#l25.87"></a><span id="l25.87"> function showMessages(folder, text) {</span>
<a href="#l25.88"></a><span id="l25.88">   dump(&quot;Show messages for folder &lt;&quot; + folder.name + &quot;&gt; &quot; + text + &quot;\n&quot;);</span>
<a href="#l25.89"></a><span id="l25.89" class="difflineminus">-  let folderMsgs = folder.messages;</span>
<a href="#l25.90"></a><span id="l25.90" class="difflineminus">-  while (folderMsgs.hasMoreElements()) {</span>
<a href="#l25.91"></a><span id="l25.91" class="difflineminus">-    let header = folderMsgs.getNext().QueryInterface(Ci.nsIMsgDBHdr);</span>
<a href="#l25.92"></a><span id="l25.92" class="difflineplus">+  for (let header of folder.messages) {</span>
<a href="#l25.93"></a><span id="l25.93">     dump(</span>
<a href="#l25.94"></a><span id="l25.94">       &quot;key: &quot; +</span>
<a href="#l25.95"></a><span id="l25.95">         header.messageKey +</span>
<a href="#l25.96"></a><span id="l25.96">         &quot; offset: &quot; +</span>
<a href="#l25.97"></a><span id="l25.97">         header.messageOffset +</span>
<a href="#l25.98"></a><span id="l25.98">         &quot; ID: &quot; +</span>
<a href="#l25.99"></a><span id="l25.99">         header.messageId +</span>
<a href="#l25.100"></a><span id="l25.100">         &quot;\n&quot;</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l26.1"></a><span id="l26.1" class="difflineminus">--- a/mailnews/base/test/unit/test_junkWhitelisting.js</span>
<a href="#l26.2"></a><span id="l26.2" class="difflineplus">+++ b/mailnews/base/test/unit/test_junkWhitelisting.js</span>
<a href="#l26.3"></a><span id="l26.3" class="difflineat">@@ -49,19 +49,18 @@ function run_test() {</span>
<a href="#l26.4"></a><span id="l26.4">   // kick off copying</span>
<a href="#l26.5"></a><span id="l26.5">   gPOP3Pump.files = Files;</span>
<a href="#l26.6"></a><span id="l26.6">   gPOP3Pump.onDone = continueTest;</span>
<a href="#l26.7"></a><span id="l26.7">   gPOP3Pump.run();</span>
<a href="#l26.8"></a><span id="l26.8"> }</span>
<a href="#l26.9"></a><span id="l26.9"> </span>
<a href="#l26.10"></a><span id="l26.10"> function continueTest() {</span>
<a href="#l26.11"></a><span id="l26.11">   // get the message headers</span>
<a href="#l26.12"></a><span id="l26.12" class="difflineminus">-  let headerEnum = localAccountUtils.inboxFolder.messages;</span>
<a href="#l26.13"></a><span id="l26.13" class="difflineminus">-  while (headerEnum.hasMoreElements()) {</span>
<a href="#l26.14"></a><span id="l26.14" class="difflineminus">-    hdrs.push(headerEnum.getNext().QueryInterface(Ci.nsIMsgDBHdr));</span>
<a href="#l26.15"></a><span id="l26.15" class="difflineplus">+  for (let header of localAccountUtils.inboxFolder.messages) {</span>
<a href="#l26.16"></a><span id="l26.16" class="difflineplus">+    hdrs.push(header);</span>
<a href="#l26.17"></a><span id="l26.17">   }</span>
<a href="#l26.18"></a><span id="l26.18"> </span>
<a href="#l26.19"></a><span id="l26.19">   // check with spam properties set on the local server</span>
<a href="#l26.20"></a><span id="l26.20">   doChecks(localAccountUtils.incomingServer);</span>
<a href="#l26.21"></a><span id="l26.21"> </span>
<a href="#l26.22"></a><span id="l26.22">   // Free our globals</span>
<a href="#l26.23"></a><span id="l26.23">   hdrs = null;</span>
<a href="#l26.24"></a><span id="l26.24">   gPOP3Pump = null;</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l27.1"></a><span id="l27.1" class="difflineminus">--- a/mailnews/base/test/unit/test_mailstoreConverter.js</span>
<a href="#l27.2"></a><span id="l27.2" class="difflineplus">+++ b/mailnews/base/test/unit/test_mailstoreConverter.js</span>
<a href="#l27.3"></a><span id="l27.3" class="difflineat">@@ -135,22 +135,17 @@ async function doMboxTest(srvName, mboxF</span>
<a href="#l27.4"></a><span id="l27.4">   let curDir = server.rootFolder.filePath;</span>
<a href="#l27.5"></a><span id="l27.5">   curDir.append(inbox.filePath.leafName);</span>
<a href="#l27.6"></a><span id="l27.6">   curDir.append(&quot;cur&quot;);</span>
<a href="#l27.7"></a><span id="l27.7"> </span>
<a href="#l27.8"></a><span id="l27.8">   // Sanity check.</span>
<a href="#l27.9"></a><span id="l27.9">   Assert.ok(curDir.isDirectory(), &quot;'cur' directory created&quot;);</span>
<a href="#l27.10"></a><span id="l27.10"> </span>
<a href="#l27.11"></a><span id="l27.11">   // Check number of messages in Inbox/cur is what we expect.</span>
<a href="#l27.12"></a><span id="l27.12" class="difflineminus">-  let cnt = 0;</span>
<a href="#l27.13"></a><span id="l27.13" class="difflineminus">-  let it = curDir.directoryEntries;</span>
<a href="#l27.14"></a><span id="l27.14" class="difflineminus">-  while (it.hasMoreElements()) {</span>
<a href="#l27.15"></a><span id="l27.15" class="difflineminus">-    it.nextFile;</span>
<a href="#l27.16"></a><span id="l27.16" class="difflineminus">-    cnt++;</span>
<a href="#l27.17"></a><span id="l27.17" class="difflineminus">-  }</span>
<a href="#l27.18"></a><span id="l27.18" class="difflineplus">+  let cnt = [...curDir.directoryEntries].length;</span>
<a href="#l27.19"></a><span id="l27.19"> </span>
<a href="#l27.20"></a><span id="l27.20">   Assert.equal(</span>
<a href="#l27.21"></a><span id="l27.21">     cnt,</span>
<a href="#l27.22"></a><span id="l27.22">     expectCnt,</span>
<a href="#l27.23"></a><span id="l27.23">     &quot;expected number of messages (&quot; + mboxFilename + &quot;)&quot;</span>
<a href="#l27.24"></a><span id="l27.24">   );</span>
<a href="#l27.25"></a><span id="l27.25"> }</span>
<a href="#l27.26"></a><span id="l27.26"> </span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l28.1"></a><span id="l28.1" class="difflineminus">--- a/mailnews/base/test/unit/test_nsMsgDBView.js</span>
<a href="#l28.2"></a><span id="l28.2" class="difflineplus">+++ b/mailnews/base/test/unit/test_nsMsgDBView.js</span>
<a href="#l28.3"></a><span id="l28.3" class="difflineat">@@ -303,19 +303,17 @@ function setup_view(aViewType, aViewFlag</span>
<a href="#l28.4"></a><span id="l28.4">   // we need to cram messages into the search via nsIMsgSearchNotify interface</span>
<a href="#l28.5"></a><span id="l28.5">   if (</span>
<a href="#l28.6"></a><span id="l28.6">     aViewType == &quot;search&quot; ||</span>
<a href="#l28.7"></a><span id="l28.7">     aViewType == &quot;quicksearch&quot; ||</span>
<a href="#l28.8"></a><span id="l28.8">     aViewType == &quot;xfvf&quot;</span>
<a href="#l28.9"></a><span id="l28.9">   ) {</span>
<a href="#l28.10"></a><span id="l28.10">     let searchNotify = gDBView.QueryInterface(Ci.nsIMsgSearchNotify);</span>
<a href="#l28.11"></a><span id="l28.11">     searchNotify.onNewSearch();</span>
<a href="#l28.12"></a><span id="l28.12" class="difflineminus">-    let enumerator = aTestFolder.msgDatabase.EnumerateMessages();</span>
<a href="#l28.13"></a><span id="l28.13" class="difflineminus">-    while (enumerator.hasMoreElements()) {</span>
<a href="#l28.14"></a><span id="l28.14" class="difflineminus">-      let msgHdr = enumerator.getNext().QueryInterface(Ci.nsIMsgDBHdr);</span>
<a href="#l28.15"></a><span id="l28.15" class="difflineplus">+    for (let msgHdr of aTestFolder.msgDatabase.EnumerateMessages()) {</span>
<a href="#l28.16"></a><span id="l28.16">       searchNotify.onSearchHit(msgHdr, msgHdr.folder);</span>
<a href="#l28.17"></a><span id="l28.17">     }</span>
<a href="#l28.18"></a><span id="l28.18">     searchNotify.onSearchDone(Cr.NS_OK);</span>
<a href="#l28.19"></a><span id="l28.19">   }</span>
<a href="#l28.20"></a><span id="l28.20"> </span>
<a href="#l28.21"></a><span id="l28.21">   gDBView.addColumnHandler(</span>
<a href="#l28.22"></a><span id="l28.22">     &quot;authorFirstLetterCol&quot;,</span>
<a href="#l28.23"></a><span id="l28.23">     authorFirstLetterCustomColumn</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l29.1"></a><span id="l29.1" class="difflineminus">--- a/mailnews/base/test/unit/test_quarantineFilterMove.js</span>
<a href="#l29.2"></a><span id="l29.2" class="difflineplus">+++ b/mailnews/base/test/unit/test_quarantineFilterMove.js</span>
<a href="#l29.3"></a><span id="l29.3" class="difflineat">@@ -115,23 +115,17 @@ var gTestArray = [</span>
<a href="#l29.4"></a><span id="l29.4">   },</span>
<a href="#l29.5"></a><span id="l29.5">   function endTest() {</span>
<a href="#l29.6"></a><span id="l29.6">     dump(&quot;Exiting mail tests\n&quot;);</span>
<a href="#l29.7"></a><span id="l29.7">     gPOP3Pump = null;</span>
<a href="#l29.8"></a><span id="l29.8">   },</span>
<a href="#l29.9"></a><span id="l29.9"> ];</span>
<a href="#l29.10"></a><span id="l29.10"> </span>
<a href="#l29.11"></a><span id="l29.11"> function folderCount(folder) {</span>
<a href="#l29.12"></a><span id="l29.12" class="difflineminus">-  let enumerator = folder.msgDatabase.EnumerateMessages();</span>
<a href="#l29.13"></a><span id="l29.13" class="difflineminus">-  let count = 0;</span>
<a href="#l29.14"></a><span id="l29.14" class="difflineminus">-  while (enumerator.hasMoreElements()) {</span>
<a href="#l29.15"></a><span id="l29.15" class="difflineminus">-    count++;</span>
<a href="#l29.16"></a><span id="l29.16" class="difflineminus">-    enumerator.getNext();</span>
<a href="#l29.17"></a><span id="l29.17" class="difflineminus">-  }</span>
<a href="#l29.18"></a><span id="l29.18" class="difflineminus">-  return count;</span>
<a href="#l29.19"></a><span id="l29.19" class="difflineplus">+  return [...folder.msgDatabase.EnumerateMessages()].length;</span>
<a href="#l29.20"></a><span id="l29.20"> }</span>
<a href="#l29.21"></a><span id="l29.21"> </span>
<a href="#l29.22"></a><span id="l29.22"> function run_test() {</span>
<a href="#l29.23"></a><span id="l29.23">   /* may not work in Linux */</span>
<a href="#l29.24"></a><span id="l29.24">   // if (&quot;@mozilla.org/gnome-gconf-service;1&quot; in Cc)</span>
<a href="#l29.25"></a><span id="l29.25">   //  return;</span>
<a href="#l29.26"></a><span id="l29.26">   /**/</span>
<a href="#l29.27"></a><span id="l29.27">   // quarantine messages</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l30.1"></a><span id="l30.1" class="difflineminus">--- a/mailnews/base/test/unit/test_searchUint32HdrProperty.js</span>
<a href="#l30.2"></a><span id="l30.2" class="difflineplus">+++ b/mailnews/base/test/unit/test_searchUint32HdrProperty.js</span>
<a href="#l30.3"></a><span id="l30.3" class="difflineat">@@ -30,22 +30,18 @@ var Tests = [</span>
<a href="#l30.4"></a><span id="l30.4">     hdrProperty: &quot;idonotexist&quot;,</span>
<a href="#l30.5"></a><span id="l30.5">     op: Isnt,</span>
<a href="#l30.6"></a><span id="l30.6">     value: 1,</span>
<a href="#l30.7"></a><span id="l30.7">     count: 1,</span>
<a href="#l30.8"></a><span id="l30.8">   },</span>
<a href="#l30.9"></a><span id="l30.9">   // add a property and test its value</span>
<a href="#l30.10"></a><span id="l30.10">   {</span>
<a href="#l30.11"></a><span id="l30.11">     setup: function setupProperty() {</span>
<a href="#l30.12"></a><span id="l30.12" class="difflineminus">-      let enumerator = localAccountUtils.inboxFolder.msgDatabase.EnumerateMessages();</span>
<a href="#l30.13"></a><span id="l30.13" class="difflineminus">-      while (enumerator.hasMoreElements()) {</span>
<a href="#l30.14"></a><span id="l30.14" class="difflineminus">-        enumerator</span>
<a href="#l30.15"></a><span id="l30.15" class="difflineminus">-          .getNext()</span>
<a href="#l30.16"></a><span id="l30.16" class="difflineminus">-          .QueryInterface(Ci.nsIMsgDBHdr)</span>
<a href="#l30.17"></a><span id="l30.17" class="difflineminus">-          .setUint32Property(&quot;iam23&quot;, 23);</span>
<a href="#l30.18"></a><span id="l30.18" class="difflineplus">+      for (let msgHdr of localAccountUtils.inboxFolder.msgDatabase.EnumerateMessages()) {</span>
<a href="#l30.19"></a><span id="l30.19" class="difflineplus">+        msgHdr.setUint32Property(&quot;iam23&quot;, 23);</span>
<a href="#l30.20"></a><span id="l30.20">       }</span>
<a href="#l30.21"></a><span id="l30.21">     },</span>
<a href="#l30.22"></a><span id="l30.22">     hdrProperty: &quot;iam23&quot;,</span>
<a href="#l30.23"></a><span id="l30.23">     op: Is,</span>
<a href="#l30.24"></a><span id="l30.24">     value: 23,</span>
<a href="#l30.25"></a><span id="l30.25">     count: 1,</span>
<a href="#l30.26"></a><span id="l30.26">   },</span>
<a href="#l30.27"></a><span id="l30.27">   {</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l31.1"></a><span id="l31.1" class="difflineminus">--- a/mailnews/base/util/StringBundle.js</span>
<a href="#l31.2"></a><span id="l31.2" class="difflineplus">+++ b/mailnews/base/util/StringBundle.js</span>
<a href="#l31.3"></a><span id="l31.3" class="difflineat">@@ -80,32 +80,17 @@ StringBundle.prototype = {</span>
<a href="#l31.4"></a><span id="l31.4"> </span>
<a href="#l31.5"></a><span id="l31.5">   /**</span>
<a href="#l31.6"></a><span id="l31.6">    * Get all the strings in the bundle.</span>
<a href="#l31.7"></a><span id="l31.7">    *</span>
<a href="#l31.8"></a><span id="l31.8">    * @returns {Array}</span>
<a href="#l31.9"></a><span id="l31.9">    *          an array of objects with key and value properties</span>
<a href="#l31.10"></a><span id="l31.10">    */</span>
<a href="#l31.11"></a><span id="l31.11">   getAll() {</span>
<a href="#l31.12"></a><span id="l31.12" class="difflineminus">-    let strings = [];</span>
<a href="#l31.13"></a><span id="l31.13" class="difflineminus">-</span>
<a href="#l31.14"></a><span id="l31.14" class="difflineminus">-    // FIXME: for performance, return an enumerable array that wraps the string</span>
<a href="#l31.15"></a><span id="l31.15" class="difflineminus">-    // bundle's nsISimpleEnumerator (does JavaScript already support this?).</span>
<a href="#l31.16"></a><span id="l31.16" class="difflineminus">-</span>
<a href="#l31.17"></a><span id="l31.17" class="difflineminus">-    let enumerator = this.stringBundle.getSimpleEnumeration();</span>
<a href="#l31.18"></a><span id="l31.18" class="difflineminus">-</span>
<a href="#l31.19"></a><span id="l31.19" class="difflineminus">-    while (enumerator.hasMoreElements()) {</span>
<a href="#l31.20"></a><span id="l31.20" class="difflineminus">-      // We could simply return the nsIPropertyElement objects, but I think</span>
<a href="#l31.21"></a><span id="l31.21" class="difflineminus">-      // it's better to return standard JS objects that behave as consumers</span>
<a href="#l31.22"></a><span id="l31.22" class="difflineminus">-      // expect JS objects to behave (f.e. you can modify them dynamically).</span>
<a href="#l31.23"></a><span id="l31.23" class="difflineminus">-      let string = enumerator.getNext().QueryInterface(Ci.nsIPropertyElement);</span>
<a href="#l31.24"></a><span id="l31.24" class="difflineminus">-      strings.push({ key: string.key, value: string.value });</span>
<a href="#l31.25"></a><span id="l31.25" class="difflineminus">-    }</span>
<a href="#l31.26"></a><span id="l31.26" class="difflineminus">-</span>
<a href="#l31.27"></a><span id="l31.27" class="difflineminus">-    return strings;</span>
<a href="#l31.28"></a><span id="l31.28" class="difflineplus">+    return [...this.stringBundle.getSimpleEnumeration()];</span>
<a href="#l31.29"></a><span id="l31.29">   },</span>
<a href="#l31.30"></a><span id="l31.30"> </span>
<a href="#l31.31"></a><span id="l31.31">   // the deprecated XBL binding-compatible API</span>
<a href="#l31.32"></a><span id="l31.32"> </span>
<a href="#l31.33"></a><span id="l31.33">   /**</span>
<a href="#l31.34"></a><span id="l31.34">    * the URL of the string bundle</span>
<a href="#l31.35"></a><span id="l31.35">    * @deprecated because its name doesn't make sense outside of an XBL binding</span>
<a href="#l31.36"></a><span id="l31.36">    * @type String</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l32.1"></a><span id="l32.1" class="difflineminus">--- a/mailnews/base/util/mailnewsMigrator.js</span>
<a href="#l32.2"></a><span id="l32.2" class="difflineplus">+++ b/mailnews/base/util/mailnewsMigrator.js</span>
<a href="#l32.3"></a><span id="l32.3" class="difflineat">@@ -156,41 +156,36 @@ function MigrateServerAuthPref() {</span>
<a href="#l32.4"></a><span id="l32.4">  * Do a one-time migration for it.</span>
<a href="#l32.5"></a><span id="l32.5">  */</span>
<a href="#l32.6"></a><span id="l32.6"> function MigrateABRemoteContentSettings() {</span>
<a href="#l32.7"></a><span id="l32.7">   if (Services.prefs.prefHasUserValue(&quot;mail.ab_remote_content.migrated&quot;)) {</span>
<a href="#l32.8"></a><span id="l32.8">     return;</span>
<a href="#l32.9"></a><span id="l32.9">   }</span>
<a href="#l32.10"></a><span id="l32.10"> </span>
<a href="#l32.11"></a><span id="l32.11">   // Search through all of our local address books looking for a match.</span>
<a href="#l32.12"></a><span id="l32.12" class="difflineminus">-  let enumerator = MailServices.ab.directories;</span>
<a href="#l32.13"></a><span id="l32.13" class="difflineminus">-  while (enumerator.hasMoreElements()) {</span>
<a href="#l32.14"></a><span id="l32.14" class="difflineplus">+  for (let addrbook of MailServices.ab.directories) {</span>
<a href="#l32.15"></a><span id="l32.15">     let migrateAddress = function(aEmail) {</span>
<a href="#l32.16"></a><span id="l32.16">       let uri = Services.io.newURI(</span>
<a href="#l32.17"></a><span id="l32.17">         &quot;chrome://messenger/content/email=&quot; + aEmail</span>
<a href="#l32.18"></a><span id="l32.18">       );</span>
<a href="#l32.19"></a><span id="l32.19">       Services.perms.addFromPrincipal(</span>
<a href="#l32.20"></a><span id="l32.20">         Services.scriptSecurityManager.createContentPrincipal(uri, {}),</span>
<a href="#l32.21"></a><span id="l32.21">         &quot;image&quot;,</span>
<a href="#l32.22"></a><span id="l32.22">         Services.perms.ALLOW_ACTION</span>
<a href="#l32.23"></a><span id="l32.23">       );</span>
<a href="#l32.24"></a><span id="l32.24">     };</span>
<a href="#l32.25"></a><span id="l32.25"> </span>
<a href="#l32.26"></a><span id="l32.26" class="difflineminus">-    let addrbook = enumerator.getNext().QueryInterface(Ci.nsIAbDirectory);</span>
<a href="#l32.27"></a><span id="l32.27">     try {</span>
<a href="#l32.28"></a><span id="l32.28">       // If it's a read-only book, don't try to find a card as we we could never</span>
<a href="#l32.29"></a><span id="l32.29">       // have set the AllowRemoteContent property.</span>
<a href="#l32.30"></a><span id="l32.30">       if (addrbook.readOnly) {</span>
<a href="#l32.31"></a><span id="l32.31">         continue;</span>
<a href="#l32.32"></a><span id="l32.32">       }</span>
<a href="#l32.33"></a><span id="l32.33"> </span>
<a href="#l32.34"></a><span id="l32.34" class="difflineminus">-      let childCards = addrbook.childCards;</span>
<a href="#l32.35"></a><span id="l32.35" class="difflineminus">-      while (childCards.hasMoreElements()) {</span>
<a href="#l32.36"></a><span id="l32.36" class="difflineminus">-        let card = childCards.getNext().QueryInterface(Ci.nsIAbCard);</span>
<a href="#l32.37"></a><span id="l32.37" class="difflineminus">-</span>
<a href="#l32.38"></a><span id="l32.38" class="difflineplus">+      for (let card of addrbook.childCards) {</span>
<a href="#l32.39"></a><span id="l32.39">         if (card.getProperty(&quot;AllowRemoteContent&quot;, &quot;0&quot;) == &quot;0&quot;) {</span>
<a href="#l32.40"></a><span id="l32.40">           // Not allowed for this contact.</span>
<a href="#l32.41"></a><span id="l32.41">           continue;</span>
<a href="#l32.42"></a><span id="l32.42">         }</span>
<a href="#l32.43"></a><span id="l32.43"> </span>
<a href="#l32.44"></a><span id="l32.44">         if (card.primaryEmail) {</span>
<a href="#l32.45"></a><span id="l32.45">           migrateAddress(card.primaryEmail);</span>
<a href="#l32.46"></a><span id="l32.46">         }</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l33.1"></a><span id="l33.1" class="difflineminus">--- a/mailnews/compose/test/unit/head_compose.js</span>
<a href="#l33.2"></a><span id="l33.2" class="difflineplus">+++ b/mailnews/compose/test/unit/head_compose.js</span>
<a href="#l33.3"></a><span id="l33.3" class="difflineat">@@ -198,19 +198,18 @@ function richCreateMessage(</span>
<a href="#l33.4"></a><span id="l33.4">   try {</span>
<a href="#l33.5"></a><span id="l33.5">     gDraftFolder = rootFolder.getChildNamed(&quot;Drafts&quot;);</span>
<a href="#l33.6"></a><span id="l33.6">   } catch (e) {</span>
<a href="#l33.7"></a><span id="l33.7">     // we don't have to remove the folder because it doesn't exist yet</span>
<a href="#l33.8"></a><span id="l33.8">     gDraftFolder = rootFolder.createLocalSubfolder(&quot;Drafts&quot;);</span>
<a href="#l33.9"></a><span id="l33.9">   }</span>
<a href="#l33.10"></a><span id="l33.10">   // Clear all messages</span>
<a href="#l33.11"></a><span id="l33.11">   let array = Cc[&quot;@mozilla.org/array;1&quot;].createInstance(Ci.nsIMutableArray);</span>
<a href="#l33.12"></a><span id="l33.12" class="difflineminus">-  let enumerator = gDraftFolder.msgDatabase.EnumerateMessages();</span>
<a href="#l33.13"></a><span id="l33.13" class="difflineminus">-  while (enumerator.hasMoreElements()) {</span>
<a href="#l33.14"></a><span id="l33.14" class="difflineminus">-    array.appendElement(enumerator.getNext());</span>
<a href="#l33.15"></a><span id="l33.15" class="difflineplus">+  for (let msg of gDraftFolder.msgDatabase.EnumerateMessages()) {</span>
<a href="#l33.16"></a><span id="l33.16" class="difflineplus">+    array.appendElement(msg);</span>
<a href="#l33.17"></a><span id="l33.17">   }</span>
<a href="#l33.18"></a><span id="l33.18">   if (array.length) {</span>
<a href="#l33.19"></a><span id="l33.19">     gDraftFolder.deleteMessages(array, null, true, false, null, false);</span>
<a href="#l33.20"></a><span id="l33.20">   }</span>
<a href="#l33.21"></a><span id="l33.21"> </span>
<a href="#l33.22"></a><span id="l33.22">   // Set attachment</span>
<a href="#l33.23"></a><span id="l33.23">   fields.removeAttachments();</span>
<a href="#l33.24"></a><span id="l33.24">   for (let attachment of attachments) {</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l34.1"></a><span id="l34.1" class="difflineminus">--- a/mailnews/compose/test/unit/test_nsSmtpService1.js</span>
<a href="#l34.2"></a><span id="l34.2" class="difflineplus">+++ b/mailnews/compose/test/unit/test_nsSmtpService1.js</span>
<a href="#l34.3"></a><span id="l34.3" class="difflineat">@@ -70,19 +70,17 @@ function run_test() {</span>
<a href="#l34.4"></a><span id="l34.4">   smtpServerArray[2].description = &quot;test2&quot;;</span>
<a href="#l34.5"></a><span id="l34.5">   smtpServerArray[2].username = &quot;&quot;;</span>
<a href="#l34.6"></a><span id="l34.6"> </span>
<a href="#l34.7"></a><span id="l34.7">   // Now check them</span>
<a href="#l34.8"></a><span id="l34.8">   smtpServers = smtpService.servers;</span>
<a href="#l34.9"></a><span id="l34.9"> </span>
<a href="#l34.10"></a><span id="l34.10">   var found = [false, false, false];</span>
<a href="#l34.11"></a><span id="l34.11"> </span>
<a href="#l34.12"></a><span id="l34.12" class="difflineminus">-  while (smtpServers.hasMoreElements()) {</span>
<a href="#l34.13"></a><span id="l34.13" class="difflineminus">-    smtpServer = smtpServers.getNext();</span>
<a href="#l34.14"></a><span id="l34.14" class="difflineminus">-</span>
<a href="#l34.15"></a><span id="l34.15" class="difflineplus">+  for (smtpServer of smtpServers) {</span>
<a href="#l34.16"></a><span id="l34.16">     for (i = 0; i &lt; 3; ++i) {</span>
<a href="#l34.17"></a><span id="l34.17">       if (smtpServer == smtpServerArray[i]) {</span>
<a href="#l34.18"></a><span id="l34.18">         found[i] = true;</span>
<a href="#l34.19"></a><span id="l34.19">       }</span>
<a href="#l34.20"></a><span id="l34.20">     }</span>
<a href="#l34.21"></a><span id="l34.21">   }</span>
<a href="#l34.22"></a><span id="l34.22"> </span>
<a href="#l34.23"></a><span id="l34.23">   Assert.equal(found, &quot;true,true,true&quot;);</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l35.1"></a><span id="l35.1" class="difflineminus">--- a/mailnews/db/gloda/modules/utils.js</span>
<a href="#l35.2"></a><span id="l35.2" class="difflineplus">+++ b/mailnews/db/gloda/modules/utils.js</span>
<a href="#l35.3"></a><span id="l35.3" class="difflineat">@@ -84,21 +84,21 @@ var GlodaUtils = {</span>
<a href="#l35.4"></a><span id="l35.4"> </span>
<a href="#l35.5"></a><span id="l35.5">     // convert the binary hash data to a hex string.</span>
<a href="#l35.6"></a><span id="l35.6">     let hex = Object.keys(hash).map(i =&gt; toHexString(hash.charCodeAt(i)));</span>
<a href="#l35.7"></a><span id="l35.7">     return hex.join(&quot;&quot;);</span>
<a href="#l35.8"></a><span id="l35.8">   },</span>
<a href="#l35.9"></a><span id="l35.9"> </span>
<a href="#l35.10"></a><span id="l35.10">   getCardForEmail(aAddress) {</span>
<a href="#l35.11"></a><span id="l35.11">     // search through all of our local address books looking for a match.</span>
<a href="#l35.12"></a><span id="l35.12" class="difflineminus">-    let enumerator = MailServices.ab.directories;</span>
<a href="#l35.13"></a><span id="l35.13">     let cardForEmailAddress;</span>
<a href="#l35.14"></a><span id="l35.14" class="difflineminus">-    let addrbook;</span>
<a href="#l35.15"></a><span id="l35.15" class="difflineminus">-    while (!cardForEmailAddress &amp;&amp; enumerator.hasMoreElements()) {</span>
<a href="#l35.16"></a><span id="l35.16" class="difflineminus">-      addrbook = enumerator.getNext().QueryInterface(Ci.nsIAbDirectory);</span>
<a href="#l35.17"></a><span id="l35.17" class="difflineplus">+    for (let addrbook of MailServices.ab.directories) {</span>
<a href="#l35.18"></a><span id="l35.18" class="difflineplus">+      if (cardForEmailAddress) {</span>
<a href="#l35.19"></a><span id="l35.19" class="difflineplus">+        break;</span>
<a href="#l35.20"></a><span id="l35.20" class="difflineplus">+      }</span>
<a href="#l35.21"></a><span id="l35.21">       try {</span>
<a href="#l35.22"></a><span id="l35.22">         cardForEmailAddress = addrbook.cardForEmailAddress(aAddress);</span>
<a href="#l35.23"></a><span id="l35.23">         if (cardForEmailAddress) {</span>
<a href="#l35.24"></a><span id="l35.24">           return cardForEmailAddress;</span>
<a href="#l35.25"></a><span id="l35.25">         }</span>
<a href="#l35.26"></a><span id="l35.26">       } catch (ex) {}</span>
<a href="#l35.27"></a><span id="l35.27">     }</span>
<a href="#l35.28"></a><span id="l35.28"> </span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l36.1"></a><span id="l36.1" class="difflineminus">--- a/mailnews/db/gloda/test/unit/test_index_addressbook.js</span>
<a href="#l36.2"></a><span id="l36.2" class="difflineplus">+++ b/mailnews/db/gloda/test/unit/test_index_addressbook.js</span>
<a href="#l36.3"></a><span id="l36.3" class="difflineat">@@ -19,23 +19,18 @@ function add_card(aEmailAddress, aDispla</span>
<a href="#l36.4"></a><span id="l36.4">       aDisplayName,</span>
<a href="#l36.5"></a><span id="l36.5">       true,</span>
<a href="#l36.6"></a><span id="l36.6">       Ci.nsIAbPreferMailFormat.unknown,</span>
<a href="#l36.7"></a><span id="l36.7">       true</span>
<a href="#l36.8"></a><span id="l36.8">     );</span>
<a href="#l36.9"></a><span id="l36.9"> }</span>
<a href="#l36.10"></a><span id="l36.10"> </span>
<a href="#l36.11"></a><span id="l36.11"> function get_card_for_email(aEmailAddress) {</span>
<a href="#l36.12"></a><span id="l36.12" class="difflineminus">-  let books = MailServices.ab.directories;</span>
<a href="#l36.13"></a><span id="l36.13" class="difflineminus">-</span>
<a href="#l36.14"></a><span id="l36.14" class="difflineminus">-  let book, card;</span>
<a href="#l36.15"></a><span id="l36.15" class="difflineminus">-</span>
<a href="#l36.16"></a><span id="l36.16" class="difflineminus">-  while (books.hasMoreElements()) {</span>
<a href="#l36.17"></a><span id="l36.17" class="difflineminus">-    book = books.getNext().QueryInterface(Ci.nsIAbDirectory);</span>
<a href="#l36.18"></a><span id="l36.18" class="difflineminus">-    card = book.cardForEmailAddress(aEmailAddress);</span>
<a href="#l36.19"></a><span id="l36.19" class="difflineplus">+  for (let book of MailServices.ab.directories) {</span>
<a href="#l36.20"></a><span id="l36.20" class="difflineplus">+    let card = book.cardForEmailAddress(aEmailAddress);</span>
<a href="#l36.21"></a><span id="l36.21">     if (card) {</span>
<a href="#l36.22"></a><span id="l36.22">       return [book, card];</span>
<a href="#l36.23"></a><span id="l36.23">     }</span>
<a href="#l36.24"></a><span id="l36.24">   }</span>
<a href="#l36.25"></a><span id="l36.25">   return [null, null];</span>
<a href="#l36.26"></a><span id="l36.26"> }</span>
<a href="#l36.27"></a><span id="l36.27"> </span>
<a href="#l36.28"></a><span id="l36.28"> function delete_card(aEmailAddress) {</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l37.1"></a><span id="l37.1" class="difflineminus">--- a/mailnews/db/msgdb/test/unit/test_propertyEnumerator.js</span>
<a href="#l37.2"></a><span id="l37.2" class="difflineplus">+++ b/mailnews/db/msgdb/test/unit/test_propertyEnumerator.js</span>
<a href="#l37.3"></a><span id="l37.3" class="difflineat">@@ -37,35 +37,27 @@ var copyListener = {</span>
<a href="#l37.4"></a><span id="l37.4">   SetMessageId(aMessageId) {},</span>
<a href="#l37.5"></a><span id="l37.5">   OnStopCopy(aStatus) {</span>
<a href="#l37.6"></a><span id="l37.6">     continue_test();</span>
<a href="#l37.7"></a><span id="l37.7">   },</span>
<a href="#l37.8"></a><span id="l37.8"> };</span>
<a href="#l37.9"></a><span id="l37.9"> </span>
<a href="#l37.10"></a><span id="l37.10"> function continue_test() {</span>
<a href="#l37.11"></a><span id="l37.11">   // test some of the default properties</span>
<a href="#l37.12"></a><span id="l37.12" class="difflineminus">-  var enumerator = gHdr.propertyEnumerator;</span>
<a href="#l37.13"></a><span id="l37.13" class="difflineminus">-  var properties = [];</span>
<a href="#l37.14"></a><span id="l37.14" class="difflineminus">-  while (enumerator.hasMore()) {</span>
<a href="#l37.15"></a><span id="l37.15" class="difflineminus">-    var property = enumerator.getNext();</span>
<a href="#l37.16"></a><span id="l37.16" class="difflineminus">-    // dump(&quot;\nProperty is &quot; + property);</span>
<a href="#l37.17"></a><span id="l37.17" class="difflineminus">-    properties.push(property);</span>
<a href="#l37.18"></a><span id="l37.18" class="difflineminus">-  }</span>
<a href="#l37.19"></a><span id="l37.19" class="difflineplus">+  let properties = [...gHdr.propertyEnumerator];</span>
<a href="#l37.20"></a><span id="l37.20">   Assert.ok(properties.includes(&quot;flags&quot;));</span>
<a href="#l37.21"></a><span id="l37.21">   Assert.ok(properties.includes(&quot;size&quot;));</span>
<a href="#l37.22"></a><span id="l37.22">   // this will be added in the next section, but does not exist yet</span>
<a href="#l37.23"></a><span id="l37.23">   Assert.ok(!properties.includes(&quot;iamnew&quot;));</span>
<a href="#l37.24"></a><span id="l37.24"> </span>
<a href="#l37.25"></a><span id="l37.25">   // add a new property, and make sure that it appears</span>
<a href="#l37.26"></a><span id="l37.26">   gHdr.setStringProperty(&quot;iamnew&quot;, &quot;somevalue&quot;);</span>
<a href="#l37.27"></a><span id="l37.27"> </span>
<a href="#l37.28"></a><span id="l37.28" class="difflineminus">-  enumerator = gHdr.propertyEnumerator;</span>
<a href="#l37.29"></a><span id="l37.29">   properties = [];</span>
<a href="#l37.30"></a><span id="l37.30" class="difflineminus">-  while (enumerator.hasMore()) {</span>
<a href="#l37.31"></a><span id="l37.31" class="difflineminus">-    property = enumerator.getNext();</span>
<a href="#l37.32"></a><span id="l37.32" class="difflineplus">+  for (let property of gHdr.propertyEnumerator) {</span>
<a href="#l37.33"></a><span id="l37.33">     // dump(&quot;\nProperty 2 is &quot; + property);</span>
<a href="#l37.34"></a><span id="l37.34">     properties.push(property);</span>
<a href="#l37.35"></a><span id="l37.35">   }</span>
<a href="#l37.36"></a><span id="l37.36">   Assert.ok(properties.includes(&quot;flags&quot;));</span>
<a href="#l37.37"></a><span id="l37.37">   Assert.ok(properties.includes(&quot;size&quot;));</span>
<a href="#l37.38"></a><span id="l37.38">   Assert.ok(properties.includes(&quot;iamnew&quot;));</span>
<a href="#l37.39"></a><span id="l37.39">   Assert.ok(!properties.includes(&quot;idonotexist&quot;));</span>
<a href="#l37.40"></a><span id="l37.40"> </span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l38.1"></a><span id="l38.1" class="difflineminus">--- a/mailnews/extensions/newsblog/content/feed-subscriptions.js</span>
<a href="#l38.2"></a><span id="l38.2" class="difflineplus">+++ b/mailnews/extensions/newsblog/content/feed-subscriptions.js</span>
<a href="#l38.3"></a><span id="l38.3" class="difflineat">@@ -682,20 +682,17 @@ var FeedSubscriptions = {</span>
<a href="#l38.4"></a><span id="l38.4">       quickMode: defaultQuickMode,</span>
<a href="#l38.5"></a><span id="l38.5">       options: optionsAcct,</span>
<a href="#l38.6"></a><span id="l38.6">       open,</span>
<a href="#l38.7"></a><span id="l38.7">       container: true,</span>
<a href="#l38.8"></a><span id="l38.8">       favicon: null,</span>
<a href="#l38.9"></a><span id="l38.9">     };</span>
<a href="#l38.10"></a><span id="l38.10"> </span>
<a href="#l38.11"></a><span id="l38.11">     // If a feed has any sub folders, add them to the list of children.</span>
<a href="#l38.12"></a><span id="l38.12" class="difflineminus">-    let folderEnumerator = aFolder.subFolders;</span>
<a href="#l38.13"></a><span id="l38.13" class="difflineminus">-</span>
<a href="#l38.14"></a><span id="l38.14" class="difflineminus">-    while (folderEnumerator.hasMoreElements()) {</span>
<a href="#l38.15"></a><span id="l38.15" class="difflineminus">-      let folder = folderEnumerator.getNext();</span>
<a href="#l38.16"></a><span id="l38.16" class="difflineplus">+    for (let folder of aFolder.subFolders) {</span>
<a href="#l38.17"></a><span id="l38.17">       if (</span>
<a href="#l38.18"></a><span id="l38.18">         folder instanceof Ci.nsIMsgFolder &amp;&amp;</span>
<a href="#l38.19"></a><span id="l38.19">         !folder.getFlag(Ci.nsMsgFolderFlags.Trash) &amp;&amp;</span>
<a href="#l38.20"></a><span id="l38.20">         !folder.getFlag(Ci.nsMsgFolderFlags.Virtual)</span>
<a href="#l38.21"></a><span id="l38.21">       ) {</span>
<a href="#l38.22"></a><span id="l38.22">         folderObject.children.push(</span>
<a href="#l38.23"></a><span id="l38.23">           this.makeFolderObject(folder, aCurrentLevel + 1)</span>
<a href="#l38.24"></a><span id="l38.24">         );</span>
<a href="#l38.25"></a><span id="l38.25" class="difflineat">@@ -2656,19 +2653,17 @@ var FeedSubscriptions = {</span>
<a href="#l38.26"></a><span id="l38.26">     aNode.appendChild(aNode.ownerDocument.createTextNode(indentString));</span>
<a href="#l38.27"></a><span id="l38.27">   },</span>
<a href="#l38.28"></a><span id="l38.28"> </span>
<a href="#l38.29"></a><span id="l38.29">   generateOutlineList(baseFolder, parent, indentLevel) {</span>
<a href="#l38.30"></a><span id="l38.30">     // Pretty printing.</span>
<a href="#l38.31"></a><span id="l38.31">     let indentString = &quot; &quot;.repeat(indentLevel - 2);</span>
<a href="#l38.32"></a><span id="l38.32"> </span>
<a href="#l38.33"></a><span id="l38.33">     let feedOutline;</span>
<a href="#l38.34"></a><span id="l38.34" class="difflineminus">-    let folderEnumerator = baseFolder.subFolders;</span>
<a href="#l38.35"></a><span id="l38.35" class="difflineminus">-    while (folderEnumerator.hasMoreElements()) {</span>
<a href="#l38.36"></a><span id="l38.36" class="difflineminus">-      let folder = folderEnumerator.getNext().QueryInterface(Ci.nsIMsgFolder);</span>
<a href="#l38.37"></a><span id="l38.37" class="difflineplus">+    for (let folder of baseFolder.subFolders) {</span>
<a href="#l38.38"></a><span id="l38.38">       FeedUtils.log.debug(</span>
<a href="#l38.39"></a><span id="l38.39">         &quot;generateOutlineList: folder - &quot; + folder.filePath.path</span>
<a href="#l38.40"></a><span id="l38.40">       );</span>
<a href="#l38.41"></a><span id="l38.41">       if (</span>
<a href="#l38.42"></a><span id="l38.42">         !(folder instanceof Ci.nsIMsgFolder) ||</span>
<a href="#l38.43"></a><span id="l38.43">         folder.getFlag(Ci.nsMsgFolderFlags.Trash) ||</span>
<a href="#l38.44"></a><span id="l38.44">         folder.getFlag(Ci.nsMsgFolderFlags.Virtual)</span>
<a href="#l38.45"></a><span id="l38.45">       ) {</span>
<a href="#l38.46"></a><span id="l38.46" class="difflineat">@@ -2705,19 +2700,17 @@ var FeedSubscriptions = {</span>
<a href="#l38.47"></a><span id="l38.47"> </span>
<a href="#l38.48"></a><span id="l38.48">   generateOutlineStruct(baseFolder, parent, indentLevel) {</span>
<a href="#l38.49"></a><span id="l38.49">     // Pretty printing.</span>
<a href="#l38.50"></a><span id="l38.50">     function indentString(len) {</span>
<a href="#l38.51"></a><span id="l38.51">       return &quot; &quot;.repeat(len - 2);</span>
<a href="#l38.52"></a><span id="l38.52">     }</span>
<a href="#l38.53"></a><span id="l38.53"> </span>
<a href="#l38.54"></a><span id="l38.54">     let folderOutline, feedOutline;</span>
<a href="#l38.55"></a><span id="l38.55" class="difflineminus">-    let folderEnumerator = baseFolder.subFolders;</span>
<a href="#l38.56"></a><span id="l38.56" class="difflineminus">-    while (folderEnumerator.hasMoreElements()) {</span>
<a href="#l38.57"></a><span id="l38.57" class="difflineminus">-      let folder = folderEnumerator.getNext().QueryInterface(Ci.nsIMsgFolder);</span>
<a href="#l38.58"></a><span id="l38.58" class="difflineplus">+    for (let folder of baseFolder.subFolders) {</span>
<a href="#l38.59"></a><span id="l38.59">       FeedUtils.log.debug(</span>
<a href="#l38.60"></a><span id="l38.60">         &quot;generateOutlineStruct: folder - &quot; + folder.filePath.path</span>
<a href="#l38.61"></a><span id="l38.61">       );</span>
<a href="#l38.62"></a><span id="l38.62">       if (</span>
<a href="#l38.63"></a><span id="l38.63">         !(folder instanceof Ci.nsIMsgFolder) ||</span>
<a href="#l38.64"></a><span id="l38.64">         folder.getFlag(Ci.nsMsgFolderFlags.Trash) ||</span>
<a href="#l38.65"></a><span id="l38.65">         folder.getFlag(Ci.nsMsgFolderFlags.Virtual)</span>
<a href="#l38.66"></a><span id="l38.66">       ) {</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l39.1"></a><span id="l39.1" class="difflineminus">--- a/mailnews/imap/test/unit/test_autosync_date_constraints.js</span>
<a href="#l39.2"></a><span id="l39.2" class="difflineplus">+++ b/mailnews/imap/test/unit/test_autosync_date_constraints.js</span>
<a href="#l39.3"></a><span id="l39.3" class="difflineat">@@ -31,18 +31,17 @@ var tests = [</span>
<a href="#l39.4"></a><span id="l39.4">   },</span>
<a href="#l39.5"></a><span id="l39.5">   function applyRetentionSettings() {</span>
<a href="#l39.6"></a><span id="l39.6">     IMAPPump.inbox.applyRetentionSettings();</span>
<a href="#l39.7"></a><span id="l39.7">     let enumerator = IMAPPump.inbox.msgDatabase.EnumerateMessages();</span>
<a href="#l39.8"></a><span id="l39.8">     if (enumerator) {</span>
<a href="#l39.9"></a><span id="l39.9">       let now = new Date();</span>
<a href="#l39.10"></a><span id="l39.10">       let dateInSeconds = now.getSeconds();</span>
<a href="#l39.11"></a><span id="l39.11">       let cutOffDateInSeconds = dateInSeconds - 5 * 60 * 24;</span>
<a href="#l39.12"></a><span id="l39.12" class="difflineminus">-      while (enumerator.hasMoreElements()) {</span>
<a href="#l39.13"></a><span id="l39.13" class="difflineminus">-        let header = enumerator.getNext();</span>
<a href="#l39.14"></a><span id="l39.14" class="difflineplus">+      for (let header of enumerator) {</span>
<a href="#l39.15"></a><span id="l39.15">         if (header instanceof Ci.nsIMsgDBHdr) {</span>
<a href="#l39.16"></a><span id="l39.16">           if (header.dateInSeconds &lt; cutOffDateInSeconds) {</span>
<a href="#l39.17"></a><span id="l39.17">             Assert.equal(header.getStringProperty(&quot;pendingRemoval&quot;), &quot;1&quot;);</span>
<a href="#l39.18"></a><span id="l39.18">           } else {</span>
<a href="#l39.19"></a><span id="l39.19">             Assert.equal(header.getStringProperty(&quot;pendingRemoval&quot;), &quot;&quot;);</span>
<a href="#l39.20"></a><span id="l39.20">           }</span>
<a href="#l39.21"></a><span id="l39.21">         }</span>
<a href="#l39.22"></a><span id="l39.22">       }</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l40.1"></a><span id="l40.1" class="difflineminus">--- a/mailnews/imap/test/unit/test_bccProperty.js</span>
<a href="#l40.2"></a><span id="l40.2" class="difflineplus">+++ b/mailnews/imap/test/unit/test_bccProperty.js</span>
<a href="#l40.3"></a><span id="l40.3" class="difflineat">@@ -39,19 +39,17 @@ function* setup() {</span>
<a href="#l40.4"></a><span id="l40.4"> </span>
<a href="#l40.5"></a><span id="l40.5"> function* downloadAllForOffline() {</span>
<a href="#l40.6"></a><span id="l40.6">   IMAPPump.inbox.downloadAllForOffline(asyncUrlListener, null);</span>
<a href="#l40.7"></a><span id="l40.7">   yield false;</span>
<a href="#l40.8"></a><span id="l40.8"> }</span>
<a href="#l40.9"></a><span id="l40.9"> </span>
<a href="#l40.10"></a><span id="l40.10"> function checkBccs() {</span>
<a href="#l40.11"></a><span id="l40.11">   // locate the new message by enumerating through the database</span>
<a href="#l40.12"></a><span id="l40.12" class="difflineminus">-  let enumerator = IMAPPump.inbox.msgDatabase.EnumerateMessages();</span>
<a href="#l40.13"></a><span id="l40.13" class="difflineminus">-  while (enumerator.hasMoreElements()) {</span>
<a href="#l40.14"></a><span id="l40.14" class="difflineminus">-    let hdr = enumerator.getNext().QueryInterface(Ci.nsIMsgDBHdr);</span>
<a href="#l40.15"></a><span id="l40.15" class="difflineplus">+  for (let hdr of IMAPPump.inbox.msgDatabase.EnumerateMessages()) {</span>
<a href="#l40.16"></a><span id="l40.16">     Assert.ok(hdr.bccList.includes(&quot;Another Person&quot;));</span>
<a href="#l40.17"></a><span id="l40.17">     Assert.ok(hdr.bccList.includes(&quot;&lt;u1@example.com&gt;&quot;));</span>
<a href="#l40.18"></a><span id="l40.18">     Assert.ok(!hdr.bccList.includes(&quot;IDoNotExist&quot;));</span>
<a href="#l40.19"></a><span id="l40.19">   }</span>
<a href="#l40.20"></a><span id="l40.20"> }</span>
<a href="#l40.21"></a><span id="l40.21"> </span>
<a href="#l40.22"></a><span id="l40.22"> function teardown() {</span>
<a href="#l40.23"></a><span id="l40.23">   teardownIMAPPump();</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l41.1"></a><span id="l41.1" class="difflineminus">--- a/mailnews/imap/test/unit/test_compactOfflineStore.js</span>
<a href="#l41.2"></a><span id="l41.2" class="difflineplus">+++ b/mailnews/imap/test/unit/test_compactOfflineStore.js</span>
<a href="#l41.3"></a><span id="l41.3" class="difflineat">@@ -58,18 +58,17 @@ function addGeneratedMessagesToServer(me</span>
<a href="#l41.4"></a><span id="l41.4"> }</span>
<a href="#l41.5"></a><span id="l41.5"> </span>
<a href="#l41.6"></a><span id="l41.6"> function checkOfflineStore(prevOfflineStoreSize) {</span>
<a href="#l41.7"></a><span id="l41.7">   dump(&quot;checking offline store\n&quot;);</span>
<a href="#l41.8"></a><span id="l41.8">   let offset = {};</span>
<a href="#l41.9"></a><span id="l41.9">   let size = {};</span>
<a href="#l41.10"></a><span id="l41.10">   let enumerator = IMAPPump.inbox.msgDatabase.EnumerateMessages();</span>
<a href="#l41.11"></a><span id="l41.11">   if (enumerator) {</span>
<a href="#l41.12"></a><span id="l41.12" class="difflineminus">-    while (enumerator.hasMoreElements()) {</span>
<a href="#l41.13"></a><span id="l41.13" class="difflineminus">-      let header = enumerator.getNext();</span>
<a href="#l41.14"></a><span id="l41.14" class="difflineplus">+    for (let header of enumerator) {</span>
<a href="#l41.15"></a><span id="l41.15">       // this will verify that the message in the offline store</span>
<a href="#l41.16"></a><span id="l41.16">       // starts with &quot;From &quot; - otherwise, it returns an error.</span>
<a href="#l41.17"></a><span id="l41.17">       if (</span>
<a href="#l41.18"></a><span id="l41.18">         header instanceof Ci.nsIMsgDBHdr &amp;&amp;</span>
<a href="#l41.19"></a><span id="l41.19">         header.flags &amp; Ci.nsMsgMessageFlags.Offline</span>
<a href="#l41.20"></a><span id="l41.20">       ) {</span>
<a href="#l41.21"></a><span id="l41.21">         IMAPPump.inbox</span>
<a href="#l41.22"></a><span id="l41.22">           .getOfflineFileStream(header.messageKey, offset, size)</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l42.1"></a><span id="l42.1" class="difflineminus">--- a/mailnews/imap/test/unit/test_converterImap.js</span>
<a href="#l42.2"></a><span id="l42.2" class="difflineplus">+++ b/mailnews/imap/test/unit/test_converterImap.js</span>
<a href="#l42.3"></a><span id="l42.3" class="difflineat">@@ -32,20 +32,17 @@ var gMsgFile1 = do_get_file(&quot;../../../da</span>
<a href="#l42.4"></a><span id="l42.4"> // Copied straight from the example files</span>
<a href="#l42.5"></a><span id="l42.5"> var gMsgId1 = &quot;200806061706.m56H6RWT004933@mrapp54.mozilla.org&quot;;</span>
<a href="#l42.6"></a><span id="l42.6"> var gMsgId2 = &quot;200804111417.m3BEHTk4030129@mrapp51.mozilla.org&quot;;</span>
<a href="#l42.7"></a><span id="l42.7"> // var gMsgId3 = &quot;4849BF7B.2030800@example.com&quot;;</span>
<a href="#l42.8"></a><span id="l42.8"> var gMsgId4 = &quot;bugmail7.m47LtAEf007542@mrapp51.mozilla.org&quot;;</span>
<a href="#l42.9"></a><span id="l42.9"> var gMsgId5 = &quot;bugmail6.m47LtAEf007542@mrapp51.mozilla.org&quot;;</span>
<a href="#l42.10"></a><span id="l42.10"> </span>
<a href="#l42.11"></a><span id="l42.11"> function checkConversion(aSource, aTarget) {</span>
<a href="#l42.12"></a><span id="l42.12" class="difflineminus">-  let sourceContents = aSource.directoryEntries;</span>
<a href="#l42.13"></a><span id="l42.13" class="difflineminus">-</span>
<a href="#l42.14"></a><span id="l42.14" class="difflineminus">-  while (sourceContents.hasMoreElements()) {</span>
<a href="#l42.15"></a><span id="l42.15" class="difflineminus">-    let sourceContent = sourceContents.nextFile;</span>
<a href="#l42.16"></a><span id="l42.16" class="difflineplus">+  for (let sourceContent of aSource.directoryEntries) {</span>
<a href="#l42.17"></a><span id="l42.17">     let sourceContentName = sourceContent.leafName;</span>
<a href="#l42.18"></a><span id="l42.18">     let ext = sourceContentName.slice(-4);</span>
<a href="#l42.19"></a><span id="l42.19">     let targetFile = FileUtils.File(</span>
<a href="#l42.20"></a><span id="l42.20">       OS.Path.join(aTarget.path, sourceContentName)</span>
<a href="#l42.21"></a><span id="l42.21">     );</span>
<a href="#l42.22"></a><span id="l42.22">     log.debug(&quot;Checking path: &quot; + targetFile.path);</span>
<a href="#l42.23"></a><span id="l42.23"> </span>
<a href="#l42.24"></a><span id="l42.24">     if (ext == &quot;.msf&quot; || ext == &quot;.dat&quot;) {</span>
<a href="#l42.25"></a><span id="l42.25" class="difflineat">@@ -55,22 +52,17 @@ function checkConversion(aSource, aTarge</span>
<a href="#l42.26"></a><span id="l42.26">       checkConversion(sourceContent, targetFile);</span>
<a href="#l42.27"></a><span id="l42.27">     } else {</span>
<a href="#l42.28"></a><span id="l42.28">       Assert.ok(targetFile.exists());</span>
<a href="#l42.29"></a><span id="l42.29">       let cur = FileUtils.File(OS.Path.join(targetFile.path, &quot;cur&quot;));</span>
<a href="#l42.30"></a><span id="l42.30">       Assert.ok(cur.exists());</span>
<a href="#l42.31"></a><span id="l42.31">       let tmp = FileUtils.File(OS.Path.join(targetFile.path, &quot;tmp&quot;));</span>
<a href="#l42.32"></a><span id="l42.32">       Assert.ok(tmp.exists());</span>
<a href="#l42.33"></a><span id="l42.33">       if (targetFile.leafName == &quot;INBOX&quot;) {</span>
<a href="#l42.34"></a><span id="l42.34" class="difflineminus">-        let curContents = cur.directoryEntries;</span>
<a href="#l42.35"></a><span id="l42.35" class="difflineminus">-        let curContentsCount = 0;</span>
<a href="#l42.36"></a><span id="l42.36" class="difflineminus">-        while (curContents.hasMoreElements()) {</span>
<a href="#l42.37"></a><span id="l42.37" class="difflineminus">-          curContents.nextFile;</span>
<a href="#l42.38"></a><span id="l42.38" class="difflineminus">-          curContentsCount += 1;</span>
<a href="#l42.39"></a><span id="l42.39" class="difflineminus">-        }</span>
<a href="#l42.40"></a><span id="l42.40" class="difflineplus">+        let curContentsCount = [...cur.directoryEntries].length;</span>
<a href="#l42.41"></a><span id="l42.41">         Assert.equal(curContentsCount, 8);</span>
<a href="#l42.42"></a><span id="l42.42">       }</span>
<a href="#l42.43"></a><span id="l42.43">     }</span>
<a href="#l42.44"></a><span id="l42.44">   }</span>
<a href="#l42.45"></a><span id="l42.45"> }</span>
<a href="#l42.46"></a><span id="l42.46"> </span>
<a href="#l42.47"></a><span id="l42.47"> var EventTarget = function() {</span>
<a href="#l42.48"></a><span id="l42.48">   this.dispatchEvent = function(aEvent) {</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l43.1"></a><span id="l43.1" class="difflineminus">--- a/mailnews/imap/test/unit/test_copyThenMove.js</span>
<a href="#l43.2"></a><span id="l43.2" class="difflineplus">+++ b/mailnews/imap/test/unit/test_copyThenMove.js</span>
<a href="#l43.3"></a><span id="l43.3" class="difflineat">@@ -128,23 +128,17 @@ var tests = [</span>
<a href="#l43.4"></a><span id="l43.4">     // The local inbox folder should now be empty, since the second</span>
<a href="#l43.5"></a><span id="l43.5">     // operation was a move.</span>
<a href="#l43.6"></a><span id="l43.6">     Assert.equal(folderCount(localAccountUtils.inboxFolder), 0);</span>
<a href="#l43.7"></a><span id="l43.7">   },</span>
<a href="#l43.8"></a><span id="l43.8">   teardown,</span>
<a href="#l43.9"></a><span id="l43.9"> ];</span>
<a href="#l43.10"></a><span id="l43.10"> </span>
<a href="#l43.11"></a><span id="l43.11"> function folderCount(folder) {</span>
<a href="#l43.12"></a><span id="l43.12" class="difflineminus">-  let enumerator = folder.msgDatabase.EnumerateMessages();</span>
<a href="#l43.13"></a><span id="l43.13" class="difflineminus">-  let count = 0;</span>
<a href="#l43.14"></a><span id="l43.14" class="difflineminus">-  while (enumerator.hasMoreElements()) {</span>
<a href="#l43.15"></a><span id="l43.15" class="difflineminus">-    count++;</span>
<a href="#l43.16"></a><span id="l43.16" class="difflineminus">-    enumerator.getNext();</span>
<a href="#l43.17"></a><span id="l43.17" class="difflineminus">-  }</span>
<a href="#l43.18"></a><span id="l43.18" class="difflineminus">-  return count;</span>
<a href="#l43.19"></a><span id="l43.19" class="difflineplus">+  return [...folder.msgDatabase.EnumerateMessages()].length;</span>
<a href="#l43.20"></a><span id="l43.20"> }</span>
<a href="#l43.21"></a><span id="l43.21"> </span>
<a href="#l43.22"></a><span id="l43.22"> function setup() {</span>
<a href="#l43.23"></a><span id="l43.23">   // Turn off autosync_offline_stores because</span>
<a href="#l43.24"></a><span id="l43.24">   // fetching messages is invoked after copying the messages.</span>
<a href="#l43.25"></a><span id="l43.25">   // (i.e. The fetching process will be invoked after OnStopCopy)</span>
<a href="#l43.26"></a><span id="l43.26">   // It will cause crash with an assertion</span>
<a href="#l43.27"></a><span id="l43.27">   // (ASSERTION: tried to add duplicate listener: 'index == -1') on teardown.</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l44.1"></a><span id="l44.1" class="difflineminus">--- a/mailnews/imap/test/unit/test_dod.js</span>
<a href="#l44.2"></a><span id="l44.2" class="difflineplus">+++ b/mailnews/imap/test/unit/test_dod.js</span>
<a href="#l44.3"></a><span id="l44.3" class="difflineat">@@ -50,19 +50,17 @@ function run_test() {</span>
<a href="#l44.4"></a><span id="l44.4"> }</span>
<a href="#l44.5"></a><span id="l44.5"> </span>
<a href="#l44.6"></a><span id="l44.6"> function* streamMessages() {</span>
<a href="#l44.7"></a><span id="l44.7">   let inbox = gIMAPDaemon.getMailbox(&quot;INBOX&quot;);</span>
<a href="#l44.8"></a><span id="l44.8">   let imapS = Cc[</span>
<a href="#l44.9"></a><span id="l44.9">     &quot;@mozilla.org/messenger/messageservice;1?type=imap&quot;</span>
<a href="#l44.10"></a><span id="l44.10">   ].getService(Ci.nsIMsgMessageService);</span>
<a href="#l44.11"></a><span id="l44.11">   let fileNames = [];</span>
<a href="#l44.12"></a><span id="l44.12" class="difflineminus">-  let msgFiles = do_get_file(&quot;../../../data/&quot;).directoryEntries;</span>
<a href="#l44.13"></a><span id="l44.13" class="difflineminus">-  while (msgFiles.hasMoreElements()) {</span>
<a href="#l44.14"></a><span id="l44.14" class="difflineminus">-    let file = msgFiles.nextFile;</span>
<a href="#l44.15"></a><span id="l44.15" class="difflineplus">+  for (let file of do_get_file(&quot;../../../data/&quot;).directoryEntries) {</span>
<a href="#l44.16"></a><span id="l44.16">     let msgfileuri = Services.io.newFileURI(file).QueryInterface(Ci.nsIFileURL);</span>
<a href="#l44.17"></a><span id="l44.17">     if (msgfileuri.fileName.toLowerCase().startsWith(&quot;bodystructure&quot;)) {</span>
<a href="#l44.18"></a><span id="l44.18">       inbox.addMessage(new imapMessage(msgfileuri.spec, inbox.uidnext++, []));</span>
<a href="#l44.19"></a><span id="l44.19">       fileNames.push(msgfileuri.fileName);</span>
<a href="#l44.20"></a><span id="l44.20">     }</span>
<a href="#l44.21"></a><span id="l44.21">   }</span>
<a href="#l44.22"></a><span id="l44.22"> </span>
<a href="#l44.23"></a><span id="l44.23">   // loop through the files twice, once for plain and one for html check</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l45.1"></a><span id="l45.1" class="difflineminus">--- a/mailnews/imap/test/unit/test_downloadOffline.js</span>
<a href="#l45.2"></a><span id="l45.2" class="difflineplus">+++ b/mailnews/imap/test/unit/test_downloadOffline.js</span>
<a href="#l45.3"></a><span id="l45.3" class="difflineat">@@ -48,21 +48,19 @@ async function setup() {</span>
<a href="#l45.4"></a><span id="l45.4"> async function downloadAllForOffline() {</span>
<a href="#l45.5"></a><span id="l45.5">   let promiseUrlListener = new PromiseTestUtils.PromiseUrlListener();</span>
<a href="#l45.6"></a><span id="l45.6">   IMAPPump.inbox.downloadAllForOffline(promiseUrlListener, null);</span>
<a href="#l45.7"></a><span id="l45.7">   await promiseUrlListener.promise;</span>
<a href="#l45.8"></a><span id="l45.8"> }</span>
<a href="#l45.9"></a><span id="l45.9"> </span>
<a href="#l45.10"></a><span id="l45.10"> function verifyDownloaded() {</span>
<a href="#l45.11"></a><span id="l45.11">   // verify that the message headers have the offline flag set.</span>
<a href="#l45.12"></a><span id="l45.12" class="difflineminus">-  let msgEnumerator = IMAPPump.inbox.msgDatabase.EnumerateMessages();</span>
<a href="#l45.13"></a><span id="l45.13">   let offset = {};</span>
<a href="#l45.14"></a><span id="l45.14">   let size = {};</span>
<a href="#l45.15"></a><span id="l45.15" class="difflineminus">-  while (msgEnumerator.hasMoreElements()) {</span>
<a href="#l45.16"></a><span id="l45.16" class="difflineminus">-    let header = msgEnumerator.getNext();</span>
<a href="#l45.17"></a><span id="l45.17" class="difflineplus">+  for (let header of IMAPPump.inbox.msgDatabase.EnumerateMessages()) {</span>
<a href="#l45.18"></a><span id="l45.18">     // Verify that each message has been downloaded and looks OK.</span>
<a href="#l45.19"></a><span id="l45.19">     if (</span>
<a href="#l45.20"></a><span id="l45.20">       header instanceof Ci.nsIMsgDBHdr &amp;&amp;</span>
<a href="#l45.21"></a><span id="l45.21">       header.flags &amp; Ci.nsMsgMessageFlags.Offline</span>
<a href="#l45.22"></a><span id="l45.22">     ) {</span>
<a href="#l45.23"></a><span id="l45.23">       IMAPPump.inbox</span>
<a href="#l45.24"></a><span id="l45.24">         .getOfflineFileStream(header.messageKey, offset, size)</span>
<a href="#l45.25"></a><span id="l45.25">         .close();</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l46.1"></a><span id="l46.1" class="difflineminus">--- a/mailnews/imap/test/unit/test_imapAutoSync.js</span>
<a href="#l46.2"></a><span id="l46.2" class="difflineplus">+++ b/mailnews/imap/test/unit/test_imapAutoSync.js</span>
<a href="#l46.3"></a><span id="l46.3" class="difflineat">@@ -121,25 +121,20 @@ function* test_waitForTargetUpdate() {</span>
<a href="#l46.4"></a><span id="l46.4">     .observe(null, &quot;mail:appIdle&quot;, &quot;idle&quot;);</span>
<a href="#l46.5"></a><span id="l46.5">   // Need two yield here to get results of both onDownloadCompleted and onDiscoveryQProcessed</span>
<a href="#l46.6"></a><span id="l46.6">   yield false;</span>
<a href="#l46.7"></a><span id="l46.7">   yield false;</span>
<a href="#l46.8"></a><span id="l46.8"> }</span>
<a href="#l46.9"></a><span id="l46.9"> </span>
<a href="#l46.10"></a><span id="l46.10"> // Cleanup</span>
<a href="#l46.11"></a><span id="l46.11"> function endTest() {</span>
<a href="#l46.12"></a><span id="l46.12" class="difflineminus">-  let enumerator = gTargetFolder.messages;</span>
<a href="#l46.13"></a><span id="l46.13">   let numMsgs = 0;</span>
<a href="#l46.14"></a><span id="l46.14" class="difflineminus">-  while (enumerator.hasMoreElements()) {</span>
<a href="#l46.15"></a><span id="l46.15" class="difflineplus">+  for (let header of gTargetFolder.messages) {</span>
<a href="#l46.16"></a><span id="l46.16">     numMsgs++;</span>
<a href="#l46.17"></a><span id="l46.17" class="difflineminus">-    Assert.notEqual(</span>
<a href="#l46.18"></a><span id="l46.18" class="difflineminus">-      enumerator.getNext().QueryInterface(Ci.nsIMsgDBHdr).flags &amp;</span>
<a href="#l46.19"></a><span id="l46.19" class="difflineminus">-        msgFlagOffline,</span>
<a href="#l46.20"></a><span id="l46.20" class="difflineminus">-      0</span>
<a href="#l46.21"></a><span id="l46.21" class="difflineminus">-    );</span>
<a href="#l46.22"></a><span id="l46.22" class="difflineplus">+    Assert.notEqual(header.flags &amp; msgFlagOffline, 0);</span>
<a href="#l46.23"></a><span id="l46.23">   }</span>
<a href="#l46.24"></a><span id="l46.24">   Assert.equal(2, numMsgs);</span>
<a href="#l46.25"></a><span id="l46.25">   Assert.equal(gAutoSyncListener._waitingForUpdateList.length, 0);</span>
<a href="#l46.26"></a><span id="l46.26">   Assert.ok(!gAutoSyncListener._waitingForDiscovery);</span>
<a href="#l46.27"></a><span id="l46.27">   Assert.ok(!gAutoSyncListener._waitingForUpdate);</span>
<a href="#l46.28"></a><span id="l46.28">   teardownIMAPPump();</span>
<a href="#l46.29"></a><span id="l46.29"> }</span>
<a href="#l46.30"></a><span id="l46.30"> </span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l47.1"></a><span id="l47.1" class="difflineminus">--- a/mailnews/imap/test/unit/test_imapFilterActions.js</span>
<a href="#l47.2"></a><span id="l47.2" class="difflineplus">+++ b/mailnews/imap/test/unit/test_imapFilterActions.js</span>
<a href="#l47.3"></a><span id="l47.3" class="difflineat">@@ -493,22 +493,17 @@ DBListener.prototype = {</span>
<a href="#l47.4"></a><span id="l47.4"> /*</span>
<a href="#l47.5"></a><span id="l47.5">  * helper functions</span>
<a href="#l47.6"></a><span id="l47.6">  */</span>
<a href="#l47.7"></a><span id="l47.7"> </span>
<a href="#l47.8"></a><span id="l47.8"> // return the number of messages in a folder (and check that the</span>
<a href="#l47.9"></a><span id="l47.9"> // folder counts match the database counts)</span>
<a href="#l47.10"></a><span id="l47.10"> function folderCount(folder) {</span>
<a href="#l47.11"></a><span id="l47.11">   // count using the database</span>
<a href="#l47.12"></a><span id="l47.12" class="difflineminus">-  let enumerator = folder.msgDatabase.EnumerateMessages();</span>
<a href="#l47.13"></a><span id="l47.13" class="difflineminus">-  let dbCount = 0;</span>
<a href="#l47.14"></a><span id="l47.14" class="difflineminus">-  while (enumerator.hasMoreElements()) {</span>
<a href="#l47.15"></a><span id="l47.15" class="difflineminus">-    dbCount++;</span>
<a href="#l47.16"></a><span id="l47.16" class="difflineminus">-    enumerator.getNext();</span>
<a href="#l47.17"></a><span id="l47.17" class="difflineminus">-  }</span>
<a href="#l47.18"></a><span id="l47.18" class="difflineplus">+  let dbCount = [...folder.msgDatabase.EnumerateMessages()].length;</span>
<a href="#l47.19"></a><span id="l47.19"> </span>
<a href="#l47.20"></a><span id="l47.20">   // count using the folder</span>
<a href="#l47.21"></a><span id="l47.21">   let count = folder.getTotalMessages(false);</span>
<a href="#l47.22"></a><span id="l47.22"> </span>
<a href="#l47.23"></a><span id="l47.23">   // compare the two</span>
<a href="#l47.24"></a><span id="l47.24">   Assert.equal(dbCount, count);</span>
<a href="#l47.25"></a><span id="l47.25">   return dbCount;</span>
<a href="#l47.26"></a><span id="l47.26"> }</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l48.1"></a><span id="l48.1" class="difflineminus">--- a/mailnews/imap/test/unit/test_imapFilterActionsPostplugin.js</span>
<a href="#l48.2"></a><span id="l48.2" class="difflineplus">+++ b/mailnews/imap/test/unit/test_imapFilterActionsPostplugin.js</span>
<a href="#l48.3"></a><span id="l48.3" class="difflineat">@@ -325,22 +325,17 @@ DBListener.prototype = {</span>
<a href="#l48.4"></a><span id="l48.4"> /*</span>
<a href="#l48.5"></a><span id="l48.5">  * helper functions</span>
<a href="#l48.6"></a><span id="l48.6">  */</span>
<a href="#l48.7"></a><span id="l48.7"> </span>
<a href="#l48.8"></a><span id="l48.8"> // return the number of messages in a folder (and check that the</span>
<a href="#l48.9"></a><span id="l48.9"> // folder counts match the database counts)</span>
<a href="#l48.10"></a><span id="l48.10"> function folderCount(folder) {</span>
<a href="#l48.11"></a><span id="l48.11">   // count using the database</span>
<a href="#l48.12"></a><span id="l48.12" class="difflineminus">-  let enumerator = folder.msgDatabase.EnumerateMessages();</span>
<a href="#l48.13"></a><span id="l48.13" class="difflineminus">-  let dbCount = 0;</span>
<a href="#l48.14"></a><span id="l48.14" class="difflineminus">-  while (enumerator.hasMoreElements()) {</span>
<a href="#l48.15"></a><span id="l48.15" class="difflineminus">-    dbCount++;</span>
<a href="#l48.16"></a><span id="l48.16" class="difflineminus">-    enumerator.getNext();</span>
<a href="#l48.17"></a><span id="l48.17" class="difflineminus">-  }</span>
<a href="#l48.18"></a><span id="l48.18" class="difflineplus">+  let dbCount = [...folder.msgDatabase.EnumerateMessages()].length;</span>
<a href="#l48.19"></a><span id="l48.19"> </span>
<a href="#l48.20"></a><span id="l48.20">   // count using the folder</span>
<a href="#l48.21"></a><span id="l48.21">   let count = folder.getTotalMessages(false);</span>
<a href="#l48.22"></a><span id="l48.22"> </span>
<a href="#l48.23"></a><span id="l48.23">   // compare the two</span>
<a href="#l48.24"></a><span id="l48.24">   Assert.equal(dbCount, count);</span>
<a href="#l48.25"></a><span id="l48.25">   return dbCount;</span>
<a href="#l48.26"></a><span id="l48.26"> }</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l49.1"></a><span id="l49.1" class="difflineminus">--- a/mailnews/imap/test/unit/test_imapHighWater.js</span>
<a href="#l49.2"></a><span id="l49.2" class="difflineplus">+++ b/mailnews/imap/test/unit/test_imapHighWater.js</span>
<a href="#l49.3"></a><span id="l49.3" class="difflineat">@@ -104,22 +104,25 @@ function* doMoves() {</span>
<a href="#l49.4"></a><span id="l49.4">   yield false;</span>
<a href="#l49.5"></a><span id="l49.5">   gFolder1 = gRootFolder</span>
<a href="#l49.6"></a><span id="l49.6">     .getChildNamed(&quot;folder 1&quot;)</span>
<a href="#l49.7"></a><span id="l49.7">     .QueryInterface(Ci.nsIMsgImapMailFolder);</span>
<a href="#l49.8"></a><span id="l49.8">   gFolder1.updateFolderWithListener(null, UrlListener);</span>
<a href="#l49.9"></a><span id="l49.9">   yield false;</span>
<a href="#l49.10"></a><span id="l49.10">   // get five messages to move from Inbox to folder 1.</span>
<a href="#l49.11"></a><span id="l49.11">   let headers1 = Cc[&quot;@mozilla.org/array;1&quot;].createInstance(Ci.nsIMutableArray);</span>
<a href="#l49.12"></a><span id="l49.12" class="difflineminus">-  let msgEnumerator = gIMAPInbox.msgDatabase.EnumerateMessages();</span>
<a href="#l49.13"></a><span id="l49.13" class="difflineminus">-  for (let i = 0; i &lt; 5 &amp;&amp; msgEnumerator.hasMoreElements(); i++) {</span>
<a href="#l49.14"></a><span id="l49.14" class="difflineminus">-    let header = msgEnumerator.getNext();</span>
<a href="#l49.15"></a><span id="l49.15" class="difflineplus">+  let count = 0;</span>
<a href="#l49.16"></a><span id="l49.16" class="difflineplus">+  for (let header of gIMAPInbox.msgDatabase.EnumerateMessages()) {</span>
<a href="#l49.17"></a><span id="l49.17" class="difflineplus">+    if (count &gt;= 5) {</span>
<a href="#l49.18"></a><span id="l49.18" class="difflineplus">+      break;</span>
<a href="#l49.19"></a><span id="l49.19" class="difflineplus">+    }</span>
<a href="#l49.20"></a><span id="l49.20">     if (header instanceof Ci.nsIMsgDBHdr) {</span>
<a href="#l49.21"></a><span id="l49.21">       headers1.appendElement(header);</span>
<a href="#l49.22"></a><span id="l49.22">     }</span>
<a href="#l49.23"></a><span id="l49.23" class="difflineplus">+    count++;</span>
<a href="#l49.24"></a><span id="l49.24">   }</span>
<a href="#l49.25"></a><span id="l49.25">   // this will add dummy headers with keys &gt; 0xffffff80</span>
<a href="#l49.26"></a><span id="l49.26">   MailServices.copy.CopyMessages(</span>
<a href="#l49.27"></a><span id="l49.27">     gIMAPInbox,</span>
<a href="#l49.28"></a><span id="l49.28">     headers1,</span>
<a href="#l49.29"></a><span id="l49.29">     gFolder1,</span>
<a href="#l49.30"></a><span id="l49.30">     true,</span>
<a href="#l49.31"></a><span id="l49.31">     CopyListener,</span>
<a href="#l49.32"></a><span id="l49.32" class="difflineat">@@ -130,22 +133,25 @@ function* doMoves() {</span>
<a href="#l49.33"></a><span id="l49.33">   gIMAPInbox.updateFolderWithListener(null, UrlListener);</span>
<a href="#l49.34"></a><span id="l49.34">   yield false;</span>
<a href="#l49.35"></a><span id="l49.35">   gFolder1.updateFolderWithListener(gDummyMsgWindow, UrlListener);</span>
<a href="#l49.36"></a><span id="l49.36">   yield false;</span>
<a href="#l49.37"></a><span id="l49.37">   // Check that playing back offline events gets rid of dummy</span>
<a href="#l49.38"></a><span id="l49.38">   // headers, and thus highWater is recalculated.</span>
<a href="#l49.39"></a><span id="l49.39">   Assert.equal(gFolder1.msgDatabase.dBFolderInfo.highWater, 6);</span>
<a href="#l49.40"></a><span id="l49.40">   headers1 = Cc[&quot;@mozilla.org/array;1&quot;].createInstance(Ci.nsIMutableArray);</span>
<a href="#l49.41"></a><span id="l49.41" class="difflineminus">-  msgEnumerator = gIMAPInbox.msgDatabase.EnumerateMessages();</span>
<a href="#l49.42"></a><span id="l49.42" class="difflineminus">-  for (let i = 0; i &lt; 5 &amp;&amp; msgEnumerator.hasMoreElements(); i++) {</span>
<a href="#l49.43"></a><span id="l49.43" class="difflineminus">-    let header = msgEnumerator.getNext();</span>
<a href="#l49.44"></a><span id="l49.44" class="difflineplus">+  count = 0;</span>
<a href="#l49.45"></a><span id="l49.45" class="difflineplus">+  for (let header of gIMAPInbox.msgDatabase.EnumerateMessages()) {</span>
<a href="#l49.46"></a><span id="l49.46" class="difflineplus">+    if (count &gt;= 5) {</span>
<a href="#l49.47"></a><span id="l49.47" class="difflineplus">+      break;</span>
<a href="#l49.48"></a><span id="l49.48" class="difflineplus">+    }</span>
<a href="#l49.49"></a><span id="l49.49">     if (header instanceof Ci.nsIMsgDBHdr) {</span>
<a href="#l49.50"></a><span id="l49.50">       headers1.appendElement(header);</span>
<a href="#l49.51"></a><span id="l49.51">     }</span>
<a href="#l49.52"></a><span id="l49.52" class="difflineplus">+    count++;</span>
<a href="#l49.53"></a><span id="l49.53">   }</span>
<a href="#l49.54"></a><span id="l49.54">   // Check that CopyMessages will handle having a high highwater mark.</span>
<a href="#l49.55"></a><span id="l49.55">   // It will thrown an exception if it can't.</span>
<a href="#l49.56"></a><span id="l49.56">   let msgHdr = gFolder1.msgDatabase.CreateNewHdr(0xfffffffd);</span>
<a href="#l49.57"></a><span id="l49.57">   gFolder1.msgDatabase.AddNewHdrToDB(msgHdr, false);</span>
<a href="#l49.58"></a><span id="l49.58">   MailServices.copy.CopyMessages(</span>
<a href="#l49.59"></a><span id="l49.59">     gIMAPInbox,</span>
<a href="#l49.60"></a><span id="l49.60">     headers1,</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l50.1"></a><span id="l50.1" class="difflineminus">--- a/mailnews/imap/test/unit/test_largeOfflineStore.js</span>
<a href="#l50.2"></a><span id="l50.2" class="difflineplus">+++ b/mailnews/imap/test/unit/test_largeOfflineStore.js</span>
<a href="#l50.3"></a><span id="l50.3" class="difflineat">@@ -118,21 +118,19 @@ function* check_result() {</span>
<a href="#l50.4"></a><span id="l50.4">   info(</span>
<a href="#l50.5"></a><span id="l50.5">     &quot;Offline store size (after 2nd downloadAllForOffline()) = &quot; +</span>
<a href="#l50.6"></a><span id="l50.6">       offlineStoreSize +</span>
<a href="#l50.7"></a><span id="l50.7">       &quot;. (Msg hdr offsets should be close to it.)&quot;</span>
<a href="#l50.8"></a><span id="l50.8">   );</span>
<a href="#l50.9"></a><span id="l50.9">   Assert.ok(offlineStoreSize &gt; gOfflineStoreSize);</span>
<a href="#l50.10"></a><span id="l50.10"> </span>
<a href="#l50.11"></a><span id="l50.11">   // Verify that the message headers have the offline flag set.</span>
<a href="#l50.12"></a><span id="l50.12" class="difflineminus">-  let msgEnumerator = IMAPPump.inbox.msgDatabase.EnumerateMessages();</span>
<a href="#l50.13"></a><span id="l50.13">   let offset = {};</span>
<a href="#l50.14"></a><span id="l50.14">   let size = {};</span>
<a href="#l50.15"></a><span id="l50.15" class="difflineminus">-  while (msgEnumerator.hasMoreElements()) {</span>
<a href="#l50.16"></a><span id="l50.16" class="difflineminus">-    let header = msgEnumerator.getNext();</span>
<a href="#l50.17"></a><span id="l50.17" class="difflineplus">+  for (let header of IMAPPump.inbox.msgDatabase.EnumerateMessages()) {</span>
<a href="#l50.18"></a><span id="l50.18">     // Verify that each message has been downloaded and looks OK.</span>
<a href="#l50.19"></a><span id="l50.19">     if (</span>
<a href="#l50.20"></a><span id="l50.20">       !(</span>
<a href="#l50.21"></a><span id="l50.21">         header instanceof Ci.nsIMsgDBHdr &amp;&amp;</span>
<a href="#l50.22"></a><span id="l50.22">         header.flags &amp; Ci.nsMsgMessageFlags.Offline</span>
<a href="#l50.23"></a><span id="l50.23">       )</span>
<a href="#l50.24"></a><span id="l50.24">     ) {</span>
<a href="#l50.25"></a><span id="l50.25">       do_throw(&quot;Message not downloaded for offline use&quot;);</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l51.1"></a><span id="l51.1" class="difflineminus">--- a/mailnews/imap/test/unit/test_localToImapFilterQuarantine.js</span>
<a href="#l51.2"></a><span id="l51.2" class="difflineplus">+++ b/mailnews/imap/test/unit/test_localToImapFilterQuarantine.js</span>
<a href="#l51.3"></a><span id="l51.3" class="difflineat">@@ -204,33 +204,25 @@ function run_test() {</span>
<a href="#l51.4"></a><span id="l51.4">   // start first test</span>
<a href="#l51.5"></a><span id="l51.5">   async_run_tests(quarantineTests);</span>
<a href="#l51.6"></a><span id="l51.6"> }</span>
<a href="#l51.7"></a><span id="l51.7"> </span>
<a href="#l51.8"></a><span id="l51.8"> // helper functions</span>
<a href="#l51.9"></a><span id="l51.9"> </span>
<a href="#l51.10"></a><span id="l51.10"> // count of messages in a folder, using the database</span>
<a href="#l51.11"></a><span id="l51.11"> function folderCount(folder) {</span>
<a href="#l51.12"></a><span id="l51.12" class="difflineminus">-  let enumerator = folder.msgDatabase.EnumerateMessages();</span>
<a href="#l51.13"></a><span id="l51.13" class="difflineminus">-  let count = 0;</span>
<a href="#l51.14"></a><span id="l51.14" class="difflineminus">-  while (enumerator.hasMoreElements()) {</span>
<a href="#l51.15"></a><span id="l51.15" class="difflineminus">-    count++;</span>
<a href="#l51.16"></a><span id="l51.16" class="difflineminus">-    enumerator.getNext();</span>
<a href="#l51.17"></a><span id="l51.17" class="difflineminus">-  }</span>
<a href="#l51.18"></a><span id="l51.18" class="difflineminus">-  return count;</span>
<a href="#l51.19"></a><span id="l51.19" class="difflineplus">+  return [...folder.msgDatabase.EnumerateMessages()].length;</span>
<a href="#l51.20"></a><span id="l51.20"> }</span>
<a href="#l51.21"></a><span id="l51.21"> </span>
<a href="#l51.22"></a><span id="l51.22"> // display of message subjects in a folder</span>
<a href="#l51.23"></a><span id="l51.23"> function listMessages(folder) {</span>
<a href="#l51.24"></a><span id="l51.24" class="difflineminus">-  let enumerator = folder.msgDatabase.EnumerateMessages();</span>
<a href="#l51.25"></a><span id="l51.25">   var msgCount = 0;</span>
<a href="#l51.26"></a><span id="l51.26">   dl(&quot;listing messages for &quot; + folder.prettyName);</span>
<a href="#l51.27"></a><span id="l51.27" class="difflineminus">-  while (enumerator.hasMoreElements()) {</span>
<a href="#l51.28"></a><span id="l51.28" class="difflineplus">+  for (let hdr of folder.msgDatabase.EnumerateMessages()) {</span>
<a href="#l51.29"></a><span id="l51.29">     msgCount++;</span>
<a href="#l51.30"></a><span id="l51.30" class="difflineminus">-    let hdr = enumerator.getNext().QueryInterface(Ci.nsIMsgDBHdr);</span>
<a href="#l51.31"></a><span id="l51.31">     dl(msgCount + &quot;: &quot; + hdr.subject);</span>
<a href="#l51.32"></a><span id="l51.32">   }</span>
<a href="#l51.33"></a><span id="l51.33"> }</span>
<a href="#l51.34"></a><span id="l51.34"> </span>
<a href="#l51.35"></a><span id="l51.35"> // shorthand output of a line of text</span>
<a href="#l51.36"></a><span id="l51.36"> function dl(text) {</span>
<a href="#l51.37"></a><span id="l51.37">   dump(text + &quot;\n&quot;);</span>
<a href="#l51.38"></a><span id="l51.38"> }</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l52.1"></a><span id="l52.1" class="difflineminus">--- a/mailnews/imap/test/unit/test_offlineCopy.js</span>
<a href="#l52.2"></a><span id="l52.2" class="difflineplus">+++ b/mailnews/imap/test/unit/test_offlineCopy.js</span>
<a href="#l52.3"></a><span id="l52.3" class="difflineat">@@ -118,21 +118,19 @@ var tests = [</span>
<a href="#l52.4"></a><span id="l52.4"> </span>
<a href="#l52.5"></a><span id="l52.5">     let promiseUrlListener = new PromiseTestUtils.PromiseUrlListener();</span>
<a href="#l52.6"></a><span id="l52.6">     IMAPPump.inbox.updateFolderWithListener(null, promiseUrlListener);</span>
<a href="#l52.7"></a><span id="l52.7">     await promiseUrlListener.promise;</span>
<a href="#l52.8"></a><span id="l52.8"> </span>
<a href="#l52.9"></a><span id="l52.9">     let db = IMAPPump.inbox.msgDatabase;</span>
<a href="#l52.10"></a><span id="l52.10"> </span>
<a href="#l52.11"></a><span id="l52.11">     // test the headers in the inbox</span>
<a href="#l52.12"></a><span id="l52.12" class="difflineminus">-    let enumerator = db.EnumerateMessages();</span>
<a href="#l52.13"></a><span id="l52.13">     let count = 0;</span>
<a href="#l52.14"></a><span id="l52.14" class="difflineminus">-    while (enumerator.hasMoreElements()) {</span>
<a href="#l52.15"></a><span id="l52.15" class="difflineplus">+    for (let message of db.EnumerateMessages()) {</span>
<a href="#l52.16"></a><span id="l52.16">       count++;</span>
<a href="#l52.17"></a><span id="l52.17" class="difflineminus">-      var message = enumerator.getNext();</span>
<a href="#l52.18"></a><span id="l52.18">       message instanceof Ci.nsIMsgDBHdr;</span>
<a href="#l52.19"></a><span id="l52.19">       dump(</span>
<a href="#l52.20"></a><span id="l52.20">         &quot;message &lt;&quot; +</span>
<a href="#l52.21"></a><span id="l52.21">           message.subject +</span>
<a href="#l52.22"></a><span id="l52.22">           &quot;&gt; storeToken: &lt;&quot; +</span>
<a href="#l52.23"></a><span id="l52.23">           message.getStringProperty(&quot;storeToken&quot;) +</span>
<a href="#l52.24"></a><span id="l52.24">           &quot;&gt; offset: &lt;&quot; +</span>
<a href="#l52.25"></a><span id="l52.25">           message.messageOffset +</span>
<a href="#l52.26"></a><span id="l52.26" class="difflineat">@@ -200,21 +198,19 @@ var tests = [</span>
<a href="#l52.27"></a><span id="l52.27">       false,</span>
<a href="#l52.28"></a><span id="l52.28">       null,</span>
<a href="#l52.29"></a><span id="l52.29">       null,</span>
<a href="#l52.30"></a><span id="l52.30">       true</span>
<a href="#l52.31"></a><span id="l52.31">     );</span>
<a href="#l52.32"></a><span id="l52.32"> </span>
<a href="#l52.33"></a><span id="l52.33">     // test the db headers in folder1</span>
<a href="#l52.34"></a><span id="l52.34">     db = gFolder1.msgDatabase;</span>
<a href="#l52.35"></a><span id="l52.35" class="difflineminus">-    let enumerator = db.EnumerateMessages();</span>
<a href="#l52.36"></a><span id="l52.36">     let count = 0;</span>
<a href="#l52.37"></a><span id="l52.37" class="difflineminus">-    while (enumerator.hasMoreElements()) {</span>
<a href="#l52.38"></a><span id="l52.38" class="difflineplus">+    for (let message of db.EnumerateMessages()) {</span>
<a href="#l52.39"></a><span id="l52.39">       count++;</span>
<a href="#l52.40"></a><span id="l52.40" class="difflineminus">-      var message = enumerator.getNext();</span>
<a href="#l52.41"></a><span id="l52.41">       message instanceof Ci.nsIMsgDBHdr;</span>
<a href="#l52.42"></a><span id="l52.42">       dump(</span>
<a href="#l52.43"></a><span id="l52.43">         &quot;message &lt;&quot; +</span>
<a href="#l52.44"></a><span id="l52.44">           message.subject +</span>
<a href="#l52.45"></a><span id="l52.45">           &quot;&gt; storeToken: &lt;&quot; +</span>
<a href="#l52.46"></a><span id="l52.46">           message.getStringProperty(&quot;storeToken&quot;) +</span>
<a href="#l52.47"></a><span id="l52.47">           &quot;&gt; offset: &lt;&quot; +</span>
<a href="#l52.48"></a><span id="l52.48">           message.messageOffset +</span>
<a href="#l52.49"></a><span id="l52.49" class="difflineat">@@ -250,18 +246,18 @@ var tests = [</span>
<a href="#l52.50"></a><span id="l52.50">   },</span>
<a href="#l52.51"></a><span id="l52.51">   function moveMessagesToSubfolder() {</span>
<a href="#l52.52"></a><span id="l52.52">     let db = IMAPPump.inbox.msgDatabase;</span>
<a href="#l52.53"></a><span id="l52.53">     let enumerator = db.EnumerateMessages();</span>
<a href="#l52.54"></a><span id="l52.54">     Assert.ok(enumerator.hasMoreElements());</span>
<a href="#l52.55"></a><span id="l52.55">     let messages = Cc[&quot;@mozilla.org/array;1&quot;].createInstance(</span>
<a href="#l52.56"></a><span id="l52.56">       Ci.nsIMutableArray</span>
<a href="#l52.57"></a><span id="l52.57">     );</span>
<a href="#l52.58"></a><span id="l52.58" class="difflineminus">-    while (enumerator.hasMoreElements()) {</span>
<a href="#l52.59"></a><span id="l52.59" class="difflineminus">-      messages.appendElement(enumerator.getNext());</span>
<a href="#l52.60"></a><span id="l52.60" class="difflineplus">+    for (let message of enumerator) {</span>
<a href="#l52.61"></a><span id="l52.61" class="difflineplus">+      messages.appendElement(message);</span>
<a href="#l52.62"></a><span id="l52.62">     }</span>
<a href="#l52.63"></a><span id="l52.63">     // this is sync, I believe?</span>
<a href="#l52.64"></a><span id="l52.64">     MailServices.copy.CopyMessages(</span>
<a href="#l52.65"></a><span id="l52.65">       IMAPPump.inbox,</span>
<a href="#l52.66"></a><span id="l52.66">       messages,</span>
<a href="#l52.67"></a><span id="l52.67">       gFolder1,</span>
<a href="#l52.68"></a><span id="l52.68">       true,</span>
<a href="#l52.69"></a><span id="l52.69">       null,</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l53.1"></a><span id="l53.1" class="difflineminus">--- a/mailnews/import/test/unit/resources/TestMailImporter.jsm</span>
<a href="#l53.2"></a><span id="l53.2" class="difflineplus">+++ b/mailnews/import/test/unit/resources/TestMailImporter.jsm</span>
<a href="#l53.3"></a><span id="l53.3" class="difflineat">@@ -65,19 +65,17 @@ TestMailImpoter.prototype = {</span>
<a href="#l53.4"></a><span id="l53.4"> </span>
<a href="#l53.5"></a><span id="l53.5">   _collectMailboxesInDirectory(directory, depth, result) {</span>
<a href="#l53.6"></a><span id="l53.6">     let descriptor = this._createMailboxDescriptor(</span>
<a href="#l53.7"></a><span id="l53.7">       directory.path,</span>
<a href="#l53.8"></a><span id="l53.8">       directory.leafName,</span>
<a href="#l53.9"></a><span id="l53.9">       depth</span>
<a href="#l53.10"></a><span id="l53.10">     );</span>
<a href="#l53.11"></a><span id="l53.11">     result.appendElement(descriptor);</span>
<a href="#l53.12"></a><span id="l53.12" class="difflineminus">-    let entries = directory.directoryEntries;</span>
<a href="#l53.13"></a><span id="l53.13" class="difflineminus">-    while (entries.hasMoreElements()) {</span>
<a href="#l53.14"></a><span id="l53.14" class="difflineminus">-      let entry = entries.nextFile;</span>
<a href="#l53.15"></a><span id="l53.15" class="difflineplus">+    for (let entry of directory.directoryEntries) {</span>
<a href="#l53.16"></a><span id="l53.16">       if (entry.isDirectory()) {</span>
<a href="#l53.17"></a><span id="l53.17">         this._collectMailboxesInDirectory(entry, depth + 1, result);</span>
<a href="#l53.18"></a><span id="l53.18">       }</span>
<a href="#l53.19"></a><span id="l53.19">     }</span>
<a href="#l53.20"></a><span id="l53.20">   },</span>
<a href="#l53.21"></a><span id="l53.21"> </span>
<a href="#l53.22"></a><span id="l53.22">   FindMailboxes(location) {</span>
<a href="#l53.23"></a><span id="l53.23">     let result = Cc[&quot;@mozilla.org/array;1&quot;].createInstance(Ci.nsIMutableArray);</span>
<a href="#l53.24"></a><span id="l53.24" class="difflineat">@@ -85,19 +83,17 @@ TestMailImpoter.prototype = {</span>
<a href="#l53.25"></a><span id="l53.25"> </span>
<a href="#l53.26"></a><span id="l53.26">     return result;</span>
<a href="#l53.27"></a><span id="l53.27">   },</span>
<a href="#l53.28"></a><span id="l53.28"> </span>
<a href="#l53.29"></a><span id="l53.29">   ImportMailbox(source, destination, errorLog, successLog, fatalError) {</span>
<a href="#l53.30"></a><span id="l53.30">     this.progress = 0;</span>
<a href="#l53.31"></a><span id="l53.31">     let msgStore = destination.msgStore;</span>
<a href="#l53.32"></a><span id="l53.32"> </span>
<a href="#l53.33"></a><span id="l53.33" class="difflineminus">-    let entries = source.directoryEntries;</span>
<a href="#l53.34"></a><span id="l53.34" class="difflineminus">-    while (entries.hasMoreElements()) {</span>
<a href="#l53.35"></a><span id="l53.35" class="difflineminus">-      let entry = entries.nextFile;</span>
<a href="#l53.36"></a><span id="l53.36" class="difflineplus">+    for (let entry of source.directoryEntries) {</span>
<a href="#l53.37"></a><span id="l53.37">       if (!entry.isFile()) {</span>
<a href="#l53.38"></a><span id="l53.38">         continue;</span>
<a href="#l53.39"></a><span id="l53.39">       }</span>
<a href="#l53.40"></a><span id="l53.40"> </span>
<a href="#l53.41"></a><span id="l53.41">       let newMsgHdr = {};</span>
<a href="#l53.42"></a><span id="l53.42">       let reusable = {};</span>
<a href="#l53.43"></a><span id="l53.43">       let outputStream = msgStore.getNewMsgOutputStream(</span>
<a href="#l53.44"></a><span id="l53.44">         destination,</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l54.1"></a><span id="l54.1" class="difflineminus">--- a/mailnews/import/test/unit/resources/import_helper.js</span>
<a href="#l54.2"></a><span id="l54.2" class="difflineplus">+++ b/mailnews/import/test/unit/resources/import_helper.js</span>
<a href="#l54.3"></a><span id="l54.3" class="difflineat">@@ -278,21 +278,20 @@ AbImportHelper.prototype = {</span>
<a href="#l54.4"></a><span id="l54.4">       // make sure an address book was created</span>
<a href="#l54.5"></a><span id="l54.5">       var newAb = this.getAbByName(this.mAbName);</span>
<a href="#l54.6"></a><span id="l54.6">       Assert.ok(newAb !== null);</span>
<a href="#l54.7"></a><span id="l54.7">       Assert.ok(</span>
<a href="#l54.8"></a><span id="l54.8">         newAb instanceof Ci.nsIAbDirectory &amp;&amp;</span>
<a href="#l54.9"></a><span id="l54.9">           newAb.childCards instanceof Ci.nsISimpleEnumerator</span>
<a href="#l54.10"></a><span id="l54.10">       );</span>
<a href="#l54.11"></a><span id="l54.11">       // get the imported card(s) and check each one</span>
<a href="#l54.12"></a><span id="l54.12" class="difflineminus">-      var iter = newAb.childCards;</span>
<a href="#l54.13"></a><span id="l54.13">       var count = 0;</span>
<a href="#l54.14"></a><span id="l54.14" class="difflineminus">-      for (; iter.hasMoreElements(); count++) {</span>
<a href="#l54.15"></a><span id="l54.15" class="difflineminus">-        var importedCard = iter.getNext().QueryInterface(Ci.nsIAbCard);</span>
<a href="#l54.16"></a><span id="l54.16" class="difflineplus">+      for (let importedCard of newAb.childCards) {</span>
<a href="#l54.17"></a><span id="l54.17">         this.compareCards(this.mJsonCards[count], importedCard);</span>
<a href="#l54.18"></a><span id="l54.18" class="difflineplus">+        count++;</span>
<a href="#l54.19"></a><span id="l54.19">       }</span>
<a href="#l54.20"></a><span id="l54.20">       // make sure there are the same number of cards in the address book and</span>
<a href="#l54.21"></a><span id="l54.21">       // the JSON array</span>
<a href="#l54.22"></a><span id="l54.22">       Assert.equal(count, this.mJsonCards.length);</span>
<a href="#l54.23"></a><span id="l54.23">       do_test_finished();</span>
<a href="#l54.24"></a><span id="l54.24">     } catch (e) {</span>
<a href="#l54.25"></a><span id="l54.25">       do_throw(e);</span>
<a href="#l54.26"></a><span id="l54.26">     }</span>
<a href="#l54.27"></a><span id="l54.27" class="difflineat">@@ -303,20 +302,17 @@ AbImportHelper.prototype = {</span>
<a href="#l54.28"></a><span id="l54.28">    *</span>
<a href="#l54.29"></a><span id="l54.29">    * @param aName The name of the Address Book to find.</span>
<a href="#l54.30"></a><span id="l54.30">    * @return An nsIAbDirectory, if found.</span>
<a href="#l54.31"></a><span id="l54.31">    *         null if the requested Address Book could not be found.</span>
<a href="#l54.32"></a><span id="l54.32">    */</span>
<a href="#l54.33"></a><span id="l54.33">   getAbByName(aName) {</span>
<a href="#l54.34"></a><span id="l54.34">     Assert.ok(aName &amp;&amp; aName.length &gt; 0);</span>
<a href="#l54.35"></a><span id="l54.35"> </span>
<a href="#l54.36"></a><span id="l54.36" class="difflineminus">-    var iter = MailServices.ab.directories;</span>
<a href="#l54.37"></a><span id="l54.37" class="difflineminus">-    var data = null;</span>
<a href="#l54.38"></a><span id="l54.38" class="difflineminus">-    while (iter.hasMoreElements()) {</span>
<a href="#l54.39"></a><span id="l54.39" class="difflineminus">-      data = iter.getNext();</span>
<a href="#l54.40"></a><span id="l54.40" class="difflineplus">+    for (let data of MailServices.ab.directories) {</span>
<a href="#l54.41"></a><span id="l54.41">       if (data instanceof Ci.nsIAbDirectory) {</span>
<a href="#l54.42"></a><span id="l54.42">         if (data.dirName == aName) {</span>
<a href="#l54.43"></a><span id="l54.43">           return data;</span>
<a href="#l54.44"></a><span id="l54.44">         }</span>
<a href="#l54.45"></a><span id="l54.45">       }</span>
<a href="#l54.46"></a><span id="l54.46">     }</span>
<a href="#l54.47"></a><span id="l54.47">     return null;</span>
<a href="#l54.48"></a><span id="l54.48">   },</span>
<a href="#l54.49"></a><span id="l54.49" class="difflineat">@@ -406,20 +402,18 @@ function MailImportHelper(aFile, aModule</span>
<a href="#l54.50"></a><span id="l54.50"> </span>
<a href="#l54.51"></a><span id="l54.51"> MailImportHelper.prototype = {</span>
<a href="#l54.52"></a><span id="l54.52">   __proto__: GenericImportHelper.prototype,</span>
<a href="#l54.53"></a><span id="l54.53">   interfaceType: Ci.nsIImportGeneric,</span>
<a href="#l54.54"></a><span id="l54.54">   _checkEqualFolder(expectedFolder, actualFolder) {</span>
<a href="#l54.55"></a><span id="l54.55">     Assert.equal(expectedFolder.leafName, actualFolder.name);</span>
<a href="#l54.56"></a><span id="l54.56">     let expectedSubFolderCount = 0;</span>
<a href="#l54.57"></a><span id="l54.57"> </span>
<a href="#l54.58"></a><span id="l54.58" class="difflineminus">-    let expectedEnumerator = expectedFolder.directoryEntries;</span>
<a href="#l54.59"></a><span id="l54.59">     let expectedSubFolders = [];</span>
<a href="#l54.60"></a><span id="l54.60" class="difflineminus">-    while (expectedEnumerator.hasMoreElements()) {</span>
<a href="#l54.61"></a><span id="l54.61" class="difflineminus">-      let entry = expectedEnumerator.nextFile;</span>
<a href="#l54.62"></a><span id="l54.62" class="difflineplus">+    for (let entry of expectedFolder.directoryEntries) {</span>
<a href="#l54.63"></a><span id="l54.63">       if (entry.isDirectory()) {</span>
<a href="#l54.64"></a><span id="l54.64">         expectedSubFolderCount++;</span>
<a href="#l54.65"></a><span id="l54.65">         expectedSubFolders.push(entry);</span>
<a href="#l54.66"></a><span id="l54.66">       }</span>
<a href="#l54.67"></a><span id="l54.67">     }</span>
<a href="#l54.68"></a><span id="l54.68">     Assert.equal(expectedSubFolderCount, actualFolder.numSubFolders);</span>
<a href="#l54.69"></a><span id="l54.69"> </span>
<a href="#l54.70"></a><span id="l54.70">     let actualEnumerator = actualFolder.subFolders;</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l55.1"></a><span id="l55.1" class="difflineminus">--- a/mailnews/import/test/unit/test_outlook_settings.js</span>
<a href="#l55.2"></a><span id="l55.2" class="difflineplus">+++ b/mailnews/import/test/unit/test_outlook_settings.js</span>
<a href="#l55.3"></a><span id="l55.3" class="difflineat">@@ -95,20 +95,17 @@ var expectedImapAccount = {</span>
<a href="#l55.4"></a><span id="l55.4">   },</span>
<a href="#l55.5"></a><span id="l55.5">   smtpServer: {</span>
<a href="#l55.6"></a><span id="l55.6">     hostname: &quot;smtp.invalid.host&quot;,</span>
<a href="#l55.7"></a><span id="l55.7">     username: &quot;smtpuser&quot;,</span>
<a href="#l55.8"></a><span id="l55.8">   },</span>
<a href="#l55.9"></a><span id="l55.9"> };</span>
<a href="#l55.10"></a><span id="l55.10"> </span>
<a href="#l55.11"></a><span id="l55.11"> function teardown() {</span>
<a href="#l55.12"></a><span id="l55.12" class="difflineminus">-  let smtpServers = MailServices.smtp.servers;</span>
<a href="#l55.13"></a><span id="l55.13" class="difflineminus">-</span>
<a href="#l55.14"></a><span id="l55.14" class="difflineminus">-  while (smtpServers.hasMoreElements()) {</span>
<a href="#l55.15"></a><span id="l55.15" class="difflineminus">-    let server = smtpServers.getNext().QueryInterface(Ci.nsISmtpServer);</span>
<a href="#l55.16"></a><span id="l55.16" class="difflineplus">+  for (let server of MailServices.smtp.servers) {</span>
<a href="#l55.17"></a><span id="l55.17">     MailServices.smtp.deleteServer(server);</span>
<a href="#l55.18"></a><span id="l55.18">   }</span>
<a href="#l55.19"></a><span id="l55.19"> </span>
<a href="#l55.20"></a><span id="l55.20">   teardown_mock_registry();</span>
<a href="#l55.21"></a><span id="l55.21"> }</span>
<a href="#l55.22"></a><span id="l55.22"> </span>
<a href="#l55.23"></a><span id="l55.23"> function _test(registry, expectedAccount) {</span>
<a href="#l55.24"></a><span id="l55.24">   try {</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l56.1"></a><span id="l56.1" class="difflineminus">--- a/mailnews/import/test/unit/test_winmail.js</span>
<a href="#l56.2"></a><span id="l56.2" class="difflineplus">+++ b/mailnews/import/test/unit/test_winmail.js</span>
<a href="#l56.3"></a><span id="l56.3" class="difflineat">@@ -158,20 +158,17 @@ function _test(registry) {</span>
<a href="#l56.4"></a><span id="l56.4">   } catch (e) {</span>
<a href="#l56.5"></a><span id="l56.5">     teardown();</span>
<a href="#l56.6"></a><span id="l56.6">     do_throw(e);</span>
<a href="#l56.7"></a><span id="l56.7">   }</span>
<a href="#l56.8"></a><span id="l56.8">   teardown();</span>
<a href="#l56.9"></a><span id="l56.9"> }</span>
<a href="#l56.10"></a><span id="l56.10"> </span>
<a href="#l56.11"></a><span id="l56.11"> function teardown() {</span>
<a href="#l56.12"></a><span id="l56.12" class="difflineminus">-  let smtpServers = MailServices.smtp.servers;</span>
<a href="#l56.13"></a><span id="l56.13" class="difflineminus">-</span>
<a href="#l56.14"></a><span id="l56.14" class="difflineminus">-  while (smtpServers.hasMoreElements()) {</span>
<a href="#l56.15"></a><span id="l56.15" class="difflineminus">-    let server = smtpServers.getNext().QueryInterface(Ci.nsISmtpServer);</span>
<a href="#l56.16"></a><span id="l56.16" class="difflineplus">+  for (let server of MailServices.smtp.servers) {</span>
<a href="#l56.17"></a><span id="l56.17">     MailServices.smtp.deleteServer(server);</span>
<a href="#l56.18"></a><span id="l56.18">   }</span>
<a href="#l56.19"></a><span id="l56.19"> </span>
<a href="#l56.20"></a><span id="l56.20">   teardown_mock_registry();</span>
<a href="#l56.21"></a><span id="l56.21"> }</span>
<a href="#l56.22"></a><span id="l56.22"> </span>
<a href="#l56.23"></a><span id="l56.23"> function run_test() {</span>
<a href="#l56.24"></a><span id="l56.24">   let root = do_get_file(&quot;resources/WindowsLiveMail&quot;);</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l57.1"></a><span id="l57.1" class="difflineminus">--- a/mailnews/local/test/unit/test_duplicateKey.js</span>
<a href="#l57.2"></a><span id="l57.2" class="difflineplus">+++ b/mailnews/local/test/unit/test_duplicateKey.js</span>
<a href="#l57.3"></a><span id="l57.3" class="difflineat">@@ -63,20 +63,19 @@ add_task(async function runPump() {</span>
<a href="#l57.4"></a><span id="l57.4">   dump(&quot;Messages after new message\n&quot;);</span>
<a href="#l57.5"></a><span id="l57.5">   hdrs = showMessages(localAccountUtils.inboxFolder);</span>
<a href="#l57.6"></a><span id="l57.6">   Assert.equal(hdrs.length, 4, &quot;Check db length after adding one message&quot;);</span>
<a href="#l57.7"></a><span id="l57.7"> </span>
<a href="#l57.8"></a><span id="l57.8">   gPOP3Pump = null;</span>
<a href="#l57.9"></a><span id="l57.9"> });</span>
<a href="#l57.10"></a><span id="l57.10"> </span>
<a href="#l57.11"></a><span id="l57.11"> function showMessages(folder) {</span>
<a href="#l57.12"></a><span id="l57.12" class="difflineminus">-  let enumerator = folder.msgDatabase.EnumerateMessages();</span>
<a href="#l57.13"></a><span id="l57.13">   var hdrs = [];</span>
<a href="#l57.14"></a><span id="l57.14" class="difflineminus">-  while (enumerator.hasMoreElements()) {</span>
<a href="#l57.15"></a><span id="l57.15" class="difflineminus">-    hdrs.push(enumerator.getNext().QueryInterface(Ci.nsIMsgDBHdr));</span>
<a href="#l57.16"></a><span id="l57.16" class="difflineplus">+  for (let hdr of folder.msgDatabase.EnumerateMessages()) {</span>
<a href="#l57.17"></a><span id="l57.17" class="difflineplus">+    hdrs.push(hdr);</span>
<a href="#l57.18"></a><span id="l57.18">     dump(</span>
<a href="#l57.19"></a><span id="l57.19">       &quot;key &quot; +</span>
<a href="#l57.20"></a><span id="l57.20">         (hdrs.length - 1) +</span>
<a href="#l57.21"></a><span id="l57.21">         &quot; is &quot; +</span>
<a href="#l57.22"></a><span id="l57.22">         hdrs[hdrs.length - 1].messageKey +</span>
<a href="#l57.23"></a><span id="l57.23">         &quot;\n&quot;</span>
<a href="#l57.24"></a><span id="l57.24">     );</span>
<a href="#l57.25"></a><span id="l57.25">   }</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l58.1"></a><span id="l58.1" class="difflineminus">--- a/mailnews/local/test/unit/test_folderLoaded.js</span>
<a href="#l58.2"></a><span id="l58.2" class="difflineplus">+++ b/mailnews/local/test/unit/test_folderLoaded.js</span>
<a href="#l58.3"></a><span id="l58.3" class="difflineat">@@ -61,21 +61,19 @@ var tests = [</span>
<a href="#l58.4"></a><span id="l58.4">       asyncCopyListener,</span>
<a href="#l58.5"></a><span id="l58.5">       null</span>
<a href="#l58.6"></a><span id="l58.6">     );</span>
<a href="#l58.7"></a><span id="l58.7">     yield false;</span>
<a href="#l58.8"></a><span id="l58.8">   },</span>
<a href="#l58.9"></a><span id="l58.9"> </span>
<a href="#l58.10"></a><span id="l58.10">   function* firstUpdate() {</span>
<a href="#l58.11"></a><span id="l58.11">     // get message headers for the target folder</span>
<a href="#l58.12"></a><span id="l58.12" class="difflineminus">-    let enumerator = gTargetFolder.msgDatabase.EnumerateMessages();</span>
<a href="#l58.13"></a><span id="l58.13">     var msgCount = 0;</span>
<a href="#l58.14"></a><span id="l58.14" class="difflineminus">-    while (enumerator.hasMoreElements()) {</span>
<a href="#l58.15"></a><span id="l58.15" class="difflineplus">+    for (let hdr of gTargetFolder.msgDatabase.EnumerateMessages()) {</span>
<a href="#l58.16"></a><span id="l58.16">       msgCount++;</span>
<a href="#l58.17"></a><span id="l58.17" class="difflineminus">-      let hdr = enumerator.getNext().QueryInterface(Ci.nsIMsgDBHdr);</span>
<a href="#l58.18"></a><span id="l58.18">       Assert.equal(hdr.subject, testSubjects[msgCount - 1]);</span>
<a href="#l58.19"></a><span id="l58.19">     }</span>
<a href="#l58.20"></a><span id="l58.20">     Assert.equal(msgCount, 2);</span>
<a href="#l58.21"></a><span id="l58.21"> </span>
<a href="#l58.22"></a><span id="l58.22">     // try an update</span>
<a href="#l58.23"></a><span id="l58.23">     mailTestUtils.updateFolderAndNotify(gTargetFolder, function() {</span>
<a href="#l58.24"></a><span id="l58.24">       dump(&quot;after FolderLoaded1\n&quot;);</span>
<a href="#l58.25"></a><span id="l58.25">       async_driver();</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l59.1"></a><span id="l59.1" class="difflineminus">--- a/mailnews/local/test/unit/test_localFolder.js</span>
<a href="#l59.2"></a><span id="l59.2" class="difflineplus">+++ b/mailnews/local/test/unit/test_localFolder.js</span>
<a href="#l59.3"></a><span id="l59.3" class="difflineat">@@ -18,18 +18,17 @@ var gPluggableStores = [</span>
<a href="#l59.4"></a><span id="l59.4">  * Check whether the expected folder structure</span>
<a href="#l59.5"></a><span id="l59.5">  * exists in the root folder &quot;mailFolder&quot;.</span>
<a href="#l59.6"></a><span id="l59.6">  *</span>
<a href="#l59.7"></a><span id="l59.7">  * @param expected  array of folders and subfolders</span>
<a href="#l59.8"></a><span id="l59.8">  *                  we expect</span>
<a href="#l59.9"></a><span id="l59.9">  * @param actual    actual subfolders enumerator</span>
<a href="#l59.10"></a><span id="l59.10">  */</span>
<a href="#l59.11"></a><span id="l59.11"> function check_sub_folders(expected, actual) {</span>
<a href="#l59.12"></a><span id="l59.12" class="difflineminus">-  while (actual.hasMoreElements()) {</span>
<a href="#l59.13"></a><span id="l59.13" class="difflineminus">-    let actualFolder = actual.getNext().QueryInterface(Ci.nsIMsgFolder);</span>
<a href="#l59.14"></a><span id="l59.14" class="difflineplus">+  for (let actualFolder of actual) {</span>
<a href="#l59.15"></a><span id="l59.15">     let index;</span>
<a href="#l59.16"></a><span id="l59.16">     for (index = 0; index &lt; expected.length; index++) {</span>
<a href="#l59.17"></a><span id="l59.17">       if (expected[index].name == actualFolder.name) {</span>
<a href="#l59.18"></a><span id="l59.18">         break;</span>
<a href="#l59.19"></a><span id="l59.19">       }</span>
<a href="#l59.20"></a><span id="l59.20">     }</span>
<a href="#l59.21"></a><span id="l59.21">     // If index goes out of bounds, probably we didn't find the name.</span>
<a href="#l59.22"></a><span id="l59.22">     Assert.ok(index &lt; expected.length);</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l60.1"></a><span id="l60.1" class="difflineminus">--- a/mailnews/local/test/unit/test_movemailDownload.js</span>
<a href="#l60.2"></a><span id="l60.2" class="difflineplus">+++ b/mailnews/local/test/unit/test_movemailDownload.js</span>
<a href="#l60.3"></a><span id="l60.3" class="difflineat">@@ -39,20 +39,18 @@ function setup(storeID, aHostName) {</span>
<a href="#l60.4"></a><span id="l60.4">   };</span>
<a href="#l60.5"></a><span id="l60.5"> }</span>
<a href="#l60.6"></a><span id="l60.6"> </span>
<a href="#l60.7"></a><span id="l60.7"> var gTestArray = [</span>
<a href="#l60.8"></a><span id="l60.8">   function continueTest() {</span>
<a href="#l60.9"></a><span id="l60.9">     // Clear the gMsgHdrs array.</span>
<a href="#l60.10"></a><span id="l60.10">     gMsgHdrs = [];</span>
<a href="#l60.11"></a><span id="l60.11">     // get message headers for the inbox folder</span>
<a href="#l60.12"></a><span id="l60.12" class="difflineminus">-    let enumerator = gMoveMailInbox.msgDatabase.EnumerateMessages();</span>
<a href="#l60.13"></a><span id="l60.13">     var msgCount = 0;</span>
<a href="#l60.14"></a><span id="l60.14" class="difflineminus">-    while (enumerator.hasMoreElements()) {</span>
<a href="#l60.15"></a><span id="l60.15" class="difflineminus">-      let hdr = enumerator.getNext().QueryInterface(Ci.nsIMsgDBHdr);</span>
<a href="#l60.16"></a><span id="l60.16" class="difflineplus">+    for (let hdr of gMoveMailInbox.msgDatabase.EnumerateMessages()) {</span>
<a href="#l60.17"></a><span id="l60.17">       gMsgHdrs.push(hdr);</span>
<a href="#l60.18"></a><span id="l60.18">       Assert.equal(hdr.subject, testSubjects[msgCount++]);</span>
<a href="#l60.19"></a><span id="l60.19">     }</span>
<a href="#l60.20"></a><span id="l60.20">     Assert.equal(msgCount, 3);</span>
<a href="#l60.21"></a><span id="l60.21">   },</span>
<a href="#l60.22"></a><span id="l60.22">   async function streamMessages() {</span>
<a href="#l60.23"></a><span id="l60.23">     for (let msgHdr of gMsgHdrs) {</span>
<a href="#l60.24"></a><span id="l60.24">       await streamNextMessage(msgHdr);</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l61.1"></a><span id="l61.1" class="difflineminus">--- a/mailnews/local/test/unit/test_over2GBMailboxes.js</span>
<a href="#l61.2"></a><span id="l61.2" class="difflineplus">+++ b/mailnews/local/test/unit/test_over2GBMailboxes.js</span>
<a href="#l61.3"></a><span id="l61.3" class="difflineat">@@ -63,19 +63,17 @@ function run_test() {</span>
<a href="#l61.4"></a><span id="l61.4">   );</span>
<a href="#l61.5"></a><span id="l61.5"> </span>
<a href="#l61.6"></a><span id="l61.6">   // Append mail data to over 2 GiB position for over 2 GiB msgkey.</span>
<a href="#l61.7"></a><span id="l61.7">   copyFileMessageInLocalFolder(bugmail10, 0, &quot;&quot;, null, copyMessages);</span>
<a href="#l61.8"></a><span id="l61.8"> }</span>
<a href="#l61.9"></a><span id="l61.9"> </span>
<a href="#l61.10"></a><span id="l61.10"> // Get message whose offset is over 2 GiB.</span>
<a href="#l61.11"></a><span id="l61.11"> function getMessageHdr() {</span>
<a href="#l61.12"></a><span id="l61.12" class="difflineminus">-  let msgEnum = localAccountUtils.inboxFolder.msgDatabase.EnumerateMessages();</span>
<a href="#l61.13"></a><span id="l61.13" class="difflineminus">-  while (msgEnum.hasMoreElements()) {</span>
<a href="#l61.14"></a><span id="l61.14" class="difflineminus">-    let header = msgEnum.getNext().QueryInterface(Ci.nsIMsgDBHdr);</span>
<a href="#l61.15"></a><span id="l61.15" class="difflineplus">+  for (let header of localAccountUtils.inboxFolder.msgDatabase.EnumerateMessages()) {</span>
<a href="#l61.16"></a><span id="l61.16">     if (header.messageOffset &gt;= 0x80000000) {</span>
<a href="#l61.17"></a><span id="l61.17">       return header;</span>
<a href="#l61.18"></a><span id="l61.18">     }</span>
<a href="#l61.19"></a><span id="l61.19">   }</span>
<a href="#l61.20"></a><span id="l61.20"> </span>
<a href="#l61.21"></a><span id="l61.21">   do_throw(&quot;Over 2 GiB msgkey was not found!&quot;);</span>
<a href="#l61.22"></a><span id="l61.22">   return null; // This won't ever happen, but we're keeping the linter happy.</span>
<a href="#l61.23"></a><span id="l61.23"> }</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l62.1"></a><span id="l62.1" class="difflineminus">--- a/mailnews/local/test/unit/test_over4GBMailboxes.js</span>
<a href="#l62.2"></a><span id="l62.2" class="difflineplus">+++ b/mailnews/local/test/unit/test_over4GBMailboxes.js</span>
<a href="#l62.3"></a><span id="l62.3" class="difflineat">@@ -370,21 +370,20 @@ function downloadOver4GiB_success_check(</span>
<a href="#l62.4"></a><span id="l62.4">     FListener.msgsHistory(0),</span>
<a href="#l62.5"></a><span id="l62.5">     FListener.msgsHistory(16) + gExpectedNewMessages</span>
<a href="#l62.6"></a><span id="l62.6">   );</span>
<a href="#l62.7"></a><span id="l62.7">   Assert.equal(gInbox.expungedBytes, 0);</span>
<a href="#l62.8"></a><span id="l62.8"> </span>
<a href="#l62.9"></a><span id="l62.9">   // Bug 1183490</span>
<a href="#l62.10"></a><span id="l62.10">   // Check that the message keys are below 4GB (thus no offset),</span>
<a href="#l62.11"></a><span id="l62.11">   // actually just incrementing by 1 for each message.</span>
<a href="#l62.12"></a><span id="l62.12" class="difflineminus">-  let msgs = gInbox.messages;</span>
<a href="#l62.13"></a><span id="l62.13">   let key = 0;</span>
<a href="#l62.14"></a><span id="l62.14" class="difflineminus">-  while (msgs.hasMoreElements()) {</span>
<a href="#l62.15"></a><span id="l62.15" class="difflineplus">+  for (let hdr of gInbox.messages) {</span>
<a href="#l62.16"></a><span id="l62.16">     key++;</span>
<a href="#l62.17"></a><span id="l62.17" class="difflineminus">-    Assert.equal(msgs.getNext().QueryInterface(Ci.nsIMsgDBHdr).messageKey, key);</span>
<a href="#l62.18"></a><span id="l62.18" class="difflineplus">+    Assert.equal(hdr.messageKey, key);</span>
<a href="#l62.19"></a><span id="l62.19">   }</span>
<a href="#l62.20"></a><span id="l62.20"> </span>
<a href="#l62.21"></a><span id="l62.21">   copyIntoOver4GiB_fail();</span>
<a href="#l62.22"></a><span id="l62.22"> }</span>
<a href="#l62.23"></a><span id="l62.23"> </span>
<a href="#l62.24"></a><span id="l62.24"> /**</span>
<a href="#l62.25"></a><span id="l62.25">  * Bug 598104</span>
<a href="#l62.26"></a><span id="l62.26">  * Check that copy operation does not allow to grow a local folder above 4 GiB.</span>
<a href="#l62.27"></a><span id="l62.27" class="difflineat">@@ -482,18 +481,17 @@ function copyIntoOver4GiB_success_check2</span>
<a href="#l62.28"></a><span id="l62.28"> function compactOver4GiB() {</span>
<a href="#l62.29"></a><span id="l62.29">   gInboxSize = gInboxFile.clone().fileSize;</span>
<a href="#l62.30"></a><span id="l62.30">   Assert.ok(gInboxSize &gt; kSizeLimit);</span>
<a href="#l62.31"></a><span id="l62.31">   Assert.equal(gInbox.expungedBytes, 0);</span>
<a href="#l62.32"></a><span id="l62.32">   // Delete the last small message at folder end.</span>
<a href="#l62.33"></a><span id="l62.33">   let enumerator = gInbox.messages;</span>
<a href="#l62.34"></a><span id="l62.34">   let messages = Cc[&quot;@mozilla.org/array;1&quot;].createInstance(Ci.nsIMutableArray);</span>
<a href="#l62.35"></a><span id="l62.35">   let sizeToExpunge = 0;</span>
<a href="#l62.36"></a><span id="l62.36" class="difflineminus">-  while (enumerator.hasMoreElements()) {</span>
<a href="#l62.37"></a><span id="l62.37" class="difflineminus">-    let header = enumerator.getNext().QueryInterface(Ci.nsIMsgDBHdr);</span>
<a href="#l62.38"></a><span id="l62.38" class="difflineplus">+  for (let header of enumerator) {</span>
<a href="#l62.39"></a><span id="l62.39">     if (!enumerator.hasMoreElements()) {</span>
<a href="#l62.40"></a><span id="l62.40">       messages.appendElement(header);</span>
<a href="#l62.41"></a><span id="l62.41">       sizeToExpunge = header.messageSize;</span>
<a href="#l62.42"></a><span id="l62.42">     }</span>
<a href="#l62.43"></a><span id="l62.43">   }</span>
<a href="#l62.44"></a><span id="l62.44">   gInbox.deleteMessages(messages, null, true, false, null, false);</span>
<a href="#l62.45"></a><span id="l62.45">   Assert.equal(gInbox.expungedBytes, sizeToExpunge);</span>
<a href="#l62.46"></a><span id="l62.46"> </span>
<a href="#l62.47"></a><span id="l62.47" class="difflineat">@@ -535,18 +533,17 @@ function compactUnder4GiB() {</span>
<a href="#l62.48"></a><span id="l62.48">   Assert.equal(gInbox.sizeOnDisk, folderSize);</span>
<a href="#l62.49"></a><span id="l62.49">   Assert.equal(gInbox.getTotalMessages(false), totalMsgs);</span>
<a href="#l62.50"></a><span id="l62.50"> </span>
<a href="#l62.51"></a><span id="l62.51">   // Very last header in folder is retained,</span>
<a href="#l62.52"></a><span id="l62.52">   // but all other preceding headers are marked as deleted.</span>
<a href="#l62.53"></a><span id="l62.53">   let enumerator = gInbox.messages;</span>
<a href="#l62.54"></a><span id="l62.54">   let messages = Cc[&quot;@mozilla.org/array;1&quot;].createInstance(Ci.nsIMutableArray);</span>
<a href="#l62.55"></a><span id="l62.55">   let sizeToExpunge = gInbox.expungedBytes; // If compact in compactOver4GB was skipped, this is not 0.</span>
<a href="#l62.56"></a><span id="l62.56" class="difflineminus">-  while (enumerator.hasMoreElements()) {</span>
<a href="#l62.57"></a><span id="l62.57" class="difflineminus">-    let header = enumerator.getNext().QueryInterface(Ci.nsIMsgDBHdr);</span>
<a href="#l62.58"></a><span id="l62.58" class="difflineplus">+  for (let header of enumerator) {</span>
<a href="#l62.59"></a><span id="l62.59">     if (enumerator.hasMoreElements()) {</span>
<a href="#l62.60"></a><span id="l62.60">       messages.appendElement(header);</span>
<a href="#l62.61"></a><span id="l62.61">       sizeToExpunge += header.messageSize;</span>
<a href="#l62.62"></a><span id="l62.62">     }</span>
<a href="#l62.63"></a><span id="l62.63">   }</span>
<a href="#l62.64"></a><span id="l62.64">   gInbox.deleteMessages(messages, null, true, false, null, false);</span>
<a href="#l62.65"></a><span id="l62.65"> </span>
<a href="#l62.66"></a><span id="l62.66">   // Bug 894012: size of messages to expunge is now higher than 4GB.</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l63.1"></a><span id="l63.1" class="difflineminus">--- a/mailnews/local/test/unit/test_pop3Download.js</span>
<a href="#l63.2"></a><span id="l63.2" class="difflineplus">+++ b/mailnews/local/test/unit/test_pop3Download.js</span>
<a href="#l63.3"></a><span id="l63.3" class="difflineat">@@ -30,20 +30,18 @@ function run_test() {</span>
<a href="#l63.4"></a><span id="l63.4">   gPOP3Pump.files = gFiles;</span>
<a href="#l63.5"></a><span id="l63.5">   gPOP3Pump.onDone = continueTest;</span>
<a href="#l63.6"></a><span id="l63.6">   do_test_pending();</span>
<a href="#l63.7"></a><span id="l63.7">   gPOP3Pump.run();</span>
<a href="#l63.8"></a><span id="l63.8"> }</span>
<a href="#l63.9"></a><span id="l63.9"> </span>
<a href="#l63.10"></a><span id="l63.10"> function continueTest() {</span>
<a href="#l63.11"></a><span id="l63.11">   // get message headers for the inbox folder</span>
<a href="#l63.12"></a><span id="l63.12" class="difflineminus">-  let enumerator = localAccountUtils.inboxFolder.msgDatabase.EnumerateMessages();</span>
<a href="#l63.13"></a><span id="l63.13">   var msgCount = 0;</span>
<a href="#l63.14"></a><span id="l63.14" class="difflineminus">-  while (enumerator.hasMoreElements()) {</span>
<a href="#l63.15"></a><span id="l63.15" class="difflineminus">-    let hdr = enumerator.getNext().QueryInterface(Ci.nsIMsgDBHdr);</span>
<a href="#l63.16"></a><span id="l63.16" class="difflineplus">+  for (let hdr of localAccountUtils.inboxFolder.msgDatabase.EnumerateMessages()) {</span>
<a href="#l63.17"></a><span id="l63.17">     gMsgHdrs.push(hdr);</span>
<a href="#l63.18"></a><span id="l63.18">     Assert.equal(hdr.subject, testSubjects[msgCount++]);</span>
<a href="#l63.19"></a><span id="l63.19">   }</span>
<a href="#l63.20"></a><span id="l63.20">   Assert.equal(msgCount, 3);</span>
<a href="#l63.21"></a><span id="l63.21">   gPOP3Pump = null;</span>
<a href="#l63.22"></a><span id="l63.22">   streamNextMessage();</span>
<a href="#l63.23"></a><span id="l63.23"> }</span>
<a href="#l63.24"></a><span id="l63.24"> </span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l64.1"></a><span id="l64.1" class="difflineminus">--- a/mailnews/local/test/unit/test_pop3DownloadTempFileHandling.js</span>
<a href="#l64.2"></a><span id="l64.2" class="difflineplus">+++ b/mailnews/local/test/unit/test_pop3DownloadTempFileHandling.js</span>
<a href="#l64.3"></a><span id="l64.3" class="difflineat">@@ -27,20 +27,18 @@ function run_test() {</span>
<a href="#l64.4"></a><span id="l64.4"> function continueTest() {</span>
<a href="#l64.5"></a><span id="l64.5">   dump(&quot;temp file path = &quot; + gExpectedFiles[0].path + &quot;\n&quot;);</span>
<a href="#l64.6"></a><span id="l64.6">   dump(&quot;temp file path = &quot; + gExpectedFiles[1].path + &quot;\n&quot;);</span>
<a href="#l64.7"></a><span id="l64.7">   for (let expectedFile of gExpectedFiles) {</span>
<a href="#l64.8"></a><span id="l64.8">     Assert.ok(!expectedFile.exists());</span>
<a href="#l64.9"></a><span id="l64.9">   }</span>
<a href="#l64.10"></a><span id="l64.10"> </span>
<a href="#l64.11"></a><span id="l64.11">   // get message headers for the inbox folder</span>
<a href="#l64.12"></a><span id="l64.12" class="difflineminus">-  let enumerator = localAccountUtils.inboxFolder.msgDatabase.EnumerateMessages();</span>
<a href="#l64.13"></a><span id="l64.13">   var msgCount = 0;</span>
<a href="#l64.14"></a><span id="l64.14" class="difflineminus">-  while (enumerator.hasMoreElements()) {</span>
<a href="#l64.15"></a><span id="l64.15" class="difflineminus">-    let hdr = enumerator.getNext().QueryInterface(Ci.nsIMsgDBHdr);</span>
<a href="#l64.16"></a><span id="l64.16" class="difflineplus">+  for (let hdr of localAccountUtils.inboxFolder.msgDatabase.EnumerateMessages()) {</span>
<a href="#l64.17"></a><span id="l64.17">     Assert.equal(hdr.subject, testSubjects[msgCount++]);</span>
<a href="#l64.18"></a><span id="l64.18">   }</span>
<a href="#l64.19"></a><span id="l64.19">   Assert.equal(msgCount, 2);</span>
<a href="#l64.20"></a><span id="l64.20">   gPOP3Pump = null;</span>
<a href="#l64.21"></a><span id="l64.21">   do_test_finished();</span>
<a href="#l64.22"></a><span id="l64.22"> }</span>
<a href="#l64.23"></a><span id="l64.23"> </span>
<a href="#l64.24"></a><span id="l64.24"> function createExpectedTemporaryFiles(numFiles) {</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l65.1"></a><span id="l65.1" class="difflineminus">--- a/mailnews/local/test/unit/test_pop3Duplicates.js</span>
<a href="#l65.2"></a><span id="l65.2" class="difflineplus">+++ b/mailnews/local/test/unit/test_pop3Duplicates.js</span>
<a href="#l65.3"></a><span id="l65.3" class="difflineat">@@ -25,18 +25,16 @@ function run_test() {</span>
<a href="#l65.4"></a><span id="l65.4">   ];</span>
<a href="#l65.5"></a><span id="l65.5">   gPOP3Pump.onDone = continueTest;</span>
<a href="#l65.6"></a><span id="l65.6">   do_test_pending();</span>
<a href="#l65.7"></a><span id="l65.7">   gPOP3Pump.run();</span>
<a href="#l65.8"></a><span id="l65.8"> }</span>
<a href="#l65.9"></a><span id="l65.9"> </span>
<a href="#l65.10"></a><span id="l65.10"> function continueTest() {</span>
<a href="#l65.11"></a><span id="l65.11">   // get message headers for the inbox folder</span>
<a href="#l65.12"></a><span id="l65.12" class="difflineminus">-  let enumerator = localAccountUtils.inboxFolder.msgDatabase.EnumerateMessages();</span>
<a href="#l65.13"></a><span id="l65.13">   var msgCount = 0;</span>
<a href="#l65.14"></a><span id="l65.14" class="difflineminus">-  while (enumerator.hasMoreElements()) {</span>
<a href="#l65.15"></a><span id="l65.15" class="difflineminus">-    let hdr = enumerator.getNext().QueryInterface(Ci.nsIMsgDBHdr);</span>
<a href="#l65.16"></a><span id="l65.16" class="difflineplus">+  for (let hdr of localAccountUtils.inboxFolder.msgDatabase.EnumerateMessages()) {</span>
<a href="#l65.17"></a><span id="l65.17">     Assert.equal(hdr.subject, testSubjects[msgCount++]);</span>
<a href="#l65.18"></a><span id="l65.18">   }</span>
<a href="#l65.19"></a><span id="l65.19">   Assert.equal(msgCount, 2);</span>
<a href="#l65.20"></a><span id="l65.20">   gPOP3Pump = null;</span>
<a href="#l65.21"></a><span id="l65.21">   do_test_finished();</span>
<a href="#l65.22"></a><span id="l65.22"> }</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l66.1"></a><span id="l66.1" class="difflineminus">--- a/mailnews/local/test/unit/test_pop3FilterActions.js</span>
<a href="#l66.2"></a><span id="l66.2" class="difflineplus">+++ b/mailnews/local/test/unit/test_pop3FilterActions.js</span>
<a href="#l66.3"></a><span id="l66.3" class="difflineat">@@ -79,19 +79,17 @@ var gTestArray = [</span>
<a href="#l66.4"></a><span id="l66.4">     }</span>
<a href="#l66.5"></a><span id="l66.5"> </span>
<a href="#l66.6"></a><span id="l66.6">     // This statement is never reached.</span>
<a href="#l66.7"></a><span id="l66.7">     Assert.ok(false);</span>
<a href="#l66.8"></a><span id="l66.8">   },</span>
<a href="#l66.9"></a><span id="l66.9">   function verifyMessages() {</span>
<a href="#l66.10"></a><span id="l66.10">     let hdrs = [];</span>
<a href="#l66.11"></a><span id="l66.11">     let keys = [];</span>
<a href="#l66.12"></a><span id="l66.12" class="difflineminus">-    let enumerator = localAccountUtils.inboxFolder.msgDatabase.EnumerateMessages();</span>
<a href="#l66.13"></a><span id="l66.13" class="difflineminus">-    while (enumerator.hasMoreElements()) {</span>
<a href="#l66.14"></a><span id="l66.14" class="difflineminus">-      let hdr = enumerator.getNext().QueryInterface(Ci.nsIMsgDBHdr);</span>
<a href="#l66.15"></a><span id="l66.15" class="difflineplus">+    for (let hdr of localAccountUtils.inboxFolder.msgDatabase.EnumerateMessages()) {</span>
<a href="#l66.16"></a><span id="l66.16">       keys.push(hdr.messageKey);</span>
<a href="#l66.17"></a><span id="l66.17">       hdrs.push(hdr);</span>
<a href="#l66.18"></a><span id="l66.18">     }</span>
<a href="#l66.19"></a><span id="l66.19">     Assert.ok(</span>
<a href="#l66.20"></a><span id="l66.20">       !localAccountUtils.inboxFolder.fetchMsgPreviewText(keys, false, null)</span>
<a href="#l66.21"></a><span id="l66.21">     );</span>
<a href="#l66.22"></a><span id="l66.22">     let preview1 = hdrs[0].getStringProperty(&quot;preview&quot;);</span>
<a href="#l66.23"></a><span id="l66.23">     let preview2 = hdrs[1].getStringProperty(&quot;preview&quot;);</span>
<a href="#l66.24"></a><span id="l66.24" class="difflineat">@@ -106,23 +104,17 @@ var gTestArray = [</span>
<a href="#l66.25"></a><span id="l66.25">     Assert.equal(</span>
<a href="#l66.26"></a><span id="l66.26">       hdrs[1].flags,</span>
<a href="#l66.27"></a><span id="l66.27">       Ci.nsMsgMessageFlags.Read | Ci.nsMsgMessageFlags.Marked</span>
<a href="#l66.28"></a><span id="l66.28">     );</span>
<a href="#l66.29"></a><span id="l66.29">   },</span>
<a href="#l66.30"></a><span id="l66.30"> ];</span>
<a href="#l66.31"></a><span id="l66.31"> </span>
<a href="#l66.32"></a><span id="l66.32"> function folderCount(folder) {</span>
<a href="#l66.33"></a><span id="l66.33" class="difflineminus">-  let enumerator = folder.msgDatabase.EnumerateMessages();</span>
<a href="#l66.34"></a><span id="l66.34" class="difflineminus">-  let count = 0;</span>
<a href="#l66.35"></a><span id="l66.35" class="difflineminus">-  while (enumerator.hasMoreElements()) {</span>
<a href="#l66.36"></a><span id="l66.36" class="difflineminus">-    count++;</span>
<a href="#l66.37"></a><span id="l66.37" class="difflineminus">-    enumerator.getNext();</span>
<a href="#l66.38"></a><span id="l66.38" class="difflineminus">-  }</span>
<a href="#l66.39"></a><span id="l66.39" class="difflineminus">-  return count;</span>
<a href="#l66.40"></a><span id="l66.40" class="difflineplus">+  return [...folder.msgDatabase.EnumerateMessages()].length;</span>
<a href="#l66.41"></a><span id="l66.41"> }</span>
<a href="#l66.42"></a><span id="l66.42"> </span>
<a href="#l66.43"></a><span id="l66.43"> function setup_store(storeID) {</span>
<a href="#l66.44"></a><span id="l66.44">   return function _setup_store() {</span>
<a href="#l66.45"></a><span id="l66.45">     // Initialize pop3Pump with correct mailbox format.</span>
<a href="#l66.46"></a><span id="l66.46">     gPOP3Pump.resetPluggableStore(storeID);</span>
<a href="#l66.47"></a><span id="l66.47"> </span>
<a href="#l66.48"></a><span id="l66.48">     // Set the default mailbox store.</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l67.1"></a><span id="l67.1" class="difflineminus">--- a/mailnews/local/test/unit/test_pop3MoveFilter.js</span>
<a href="#l67.2"></a><span id="l67.2" class="difflineplus">+++ b/mailnews/local/test/unit/test_pop3MoveFilter.js</span>
<a href="#l67.3"></a><span id="l67.3" class="difflineat">@@ -78,42 +78,34 @@ var gTestArray = [</span>
<a href="#l67.4"></a><span id="l67.4">       return;</span>
<a href="#l67.5"></a><span id="l67.5">     }</span>
<a href="#l67.6"></a><span id="l67.6">     // This statement isn't reached since the error is thrown.</span>
<a href="#l67.7"></a><span id="l67.7">     Assert.ok(false);</span>
<a href="#l67.8"></a><span id="l67.8">   },</span>
<a href="#l67.9"></a><span id="l67.9">   function verifyMessages() {</span>
<a href="#l67.10"></a><span id="l67.10">     let hdrs = [];</span>
<a href="#l67.11"></a><span id="l67.11">     let keys = [];</span>
<a href="#l67.12"></a><span id="l67.12" class="difflineminus">-    let enumerator = gMoveFolder.msgDatabase.EnumerateMessages();</span>
<a href="#l67.13"></a><span id="l67.13" class="difflineminus">-    while (enumerator.hasMoreElements()) {</span>
<a href="#l67.14"></a><span id="l67.14" class="difflineminus">-      let hdr = enumerator.getNext().QueryInterface(Ci.nsIMsgDBHdr);</span>
<a href="#l67.15"></a><span id="l67.15" class="difflineplus">+    for (let hdr of gMoveFolder.msgDatabase.EnumerateMessages()) {</span>
<a href="#l67.16"></a><span id="l67.16">       keys.push(hdr.messageKey);</span>
<a href="#l67.17"></a><span id="l67.17">       hdrs.push(hdr);</span>
<a href="#l67.18"></a><span id="l67.18">     }</span>
<a href="#l67.19"></a><span id="l67.19">     Assert.ok(!gMoveFolder.fetchMsgPreviewText(keys, false, null));</span>
<a href="#l67.20"></a><span id="l67.20">     Assert.equal(</span>
<a href="#l67.21"></a><span id="l67.21">       hdrs[0].getStringProperty(&quot;preview&quot;),</span>
<a href="#l67.22"></a><span id="l67.22">       previews[hdrs[0].subject]</span>
<a href="#l67.23"></a><span id="l67.23">     );</span>
<a href="#l67.24"></a><span id="l67.24">     Assert.equal(</span>
<a href="#l67.25"></a><span id="l67.25">       hdrs[1].getStringProperty(&quot;preview&quot;),</span>
<a href="#l67.26"></a><span id="l67.26">       previews[hdrs[1].subject]</span>
<a href="#l67.27"></a><span id="l67.27">     );</span>
<a href="#l67.28"></a><span id="l67.28">   },</span>
<a href="#l67.29"></a><span id="l67.29"> ];</span>
<a href="#l67.30"></a><span id="l67.30"> </span>
<a href="#l67.31"></a><span id="l67.31"> function folderCount(folder) {</span>
<a href="#l67.32"></a><span id="l67.32" class="difflineminus">-  let enumerator = folder.msgDatabase.EnumerateMessages();</span>
<a href="#l67.33"></a><span id="l67.33" class="difflineminus">-  let count = 0;</span>
<a href="#l67.34"></a><span id="l67.34" class="difflineminus">-  while (enumerator.hasMoreElements()) {</span>
<a href="#l67.35"></a><span id="l67.35" class="difflineminus">-    count++;</span>
<a href="#l67.36"></a><span id="l67.36" class="difflineminus">-    enumerator.getNext();</span>
<a href="#l67.37"></a><span id="l67.37" class="difflineminus">-  }</span>
<a href="#l67.38"></a><span id="l67.38" class="difflineminus">-  return count;</span>
<a href="#l67.39"></a><span id="l67.39" class="difflineplus">+  return [...folder.msgDatabase.EnumerateMessages()].length;</span>
<a href="#l67.40"></a><span id="l67.40"> }</span>
<a href="#l67.41"></a><span id="l67.41"> </span>
<a href="#l67.42"></a><span id="l67.42"> function setup_store(storeID) {</span>
<a href="#l67.43"></a><span id="l67.43">   return function _setup_store() {</span>
<a href="#l67.44"></a><span id="l67.44">     // Reset pop3Pump with correct mailbox format.</span>
<a href="#l67.45"></a><span id="l67.45">     gPOP3Pump.resetPluggableStore(storeID);</span>
<a href="#l67.46"></a><span id="l67.46"> </span>
<a href="#l67.47"></a><span id="l67.47">     // Make sure we're not quarantining messages</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l68.1"></a><span id="l68.1" class="difflineminus">--- a/mailnews/local/test/unit/test_pop3MoveFilter2.js</span>
<a href="#l68.2"></a><span id="l68.2" class="difflineplus">+++ b/mailnews/local/test/unit/test_pop3MoveFilter2.js</span>
<a href="#l68.3"></a><span id="l68.3" class="difflineat">@@ -74,23 +74,17 @@ var gTestArray = [</span>
<a href="#l68.4"></a><span id="l68.4">     Assert.ok(</span>
<a href="#l68.5"></a><span id="l68.5">       !localAccountUtils.inboxFolder.fetchMsgPreviewText(keys, false, null)</span>
<a href="#l68.6"></a><span id="l68.6">     );</span>
<a href="#l68.7"></a><span id="l68.7">     Assert.equal(hdrs[0].getStringProperty(&quot;preview&quot;), basic1_preview);</span>
<a href="#l68.8"></a><span id="l68.8">   },</span>
<a href="#l68.9"></a><span id="l68.9"> ];</span>
<a href="#l68.10"></a><span id="l68.10"> </span>
<a href="#l68.11"></a><span id="l68.11"> function folderCount(folder) {</span>
<a href="#l68.12"></a><span id="l68.12" class="difflineminus">-  let enumerator = folder.msgDatabase.EnumerateMessages();</span>
<a href="#l68.13"></a><span id="l68.13" class="difflineminus">-  let count = 0;</span>
<a href="#l68.14"></a><span id="l68.14" class="difflineminus">-  while (enumerator.hasMoreElements()) {</span>
<a href="#l68.15"></a><span id="l68.15" class="difflineminus">-    count++;</span>
<a href="#l68.16"></a><span id="l68.16" class="difflineminus">-    enumerator.getNext();</span>
<a href="#l68.17"></a><span id="l68.17" class="difflineminus">-  }</span>
<a href="#l68.18"></a><span id="l68.18" class="difflineminus">-  return count;</span>
<a href="#l68.19"></a><span id="l68.19" class="difflineplus">+  return [...folder.msgDatabase.EnumerateMessages()].length;</span>
<a href="#l68.20"></a><span id="l68.20"> }</span>
<a href="#l68.21"></a><span id="l68.21"> </span>
<a href="#l68.22"></a><span id="l68.22"> function setup_store(storeID) {</span>
<a href="#l68.23"></a><span id="l68.23">   return function _setup_store() {</span>
<a href="#l68.24"></a><span id="l68.24">     // Initialize pop3Pump with correct mailbox format.</span>
<a href="#l68.25"></a><span id="l68.25">     gPOP3Pump.resetPluggableStore(storeID);</span>
<a href="#l68.26"></a><span id="l68.26"> </span>
<a href="#l68.27"></a><span id="l68.27">     // Set the default mailbox store.</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l69.1"></a><span id="l69.1" class="difflineminus">--- a/mailnews/local/test/unit/test_pop3MultiCopy.js</span>
<a href="#l69.2"></a><span id="l69.2" class="difflineplus">+++ b/mailnews/local/test/unit/test_pop3MultiCopy.js</span>
<a href="#l69.3"></a><span id="l69.3" class="difflineat">@@ -37,21 +37,19 @@ add_task(async function runPump() {</span>
<a href="#l69.4"></a><span id="l69.4">   // get message headers for the inbox folder</span>
<a href="#l69.5"></a><span id="l69.5">   let inbox = gPOP3Pump.fakeServer.rootMsgFolder.getFolderWithFlags(</span>
<a href="#l69.6"></a><span id="l69.6">     Ci.nsMsgFolderFlags.Inbox</span>
<a href="#l69.7"></a><span id="l69.7">   );</span>
<a href="#l69.8"></a><span id="l69.8">   dump(&quot;inbox is at &quot; + inbox.filePath.path + &quot;\n&quot;);</span>
<a href="#l69.9"></a><span id="l69.9"> </span>
<a href="#l69.10"></a><span id="l69.10">   // Accumulate messages to copy.</span>
<a href="#l69.11"></a><span id="l69.11">   let messages = Cc[&quot;@mozilla.org/array;1&quot;].createInstance(Ci.nsIMutableArray);</span>
<a href="#l69.12"></a><span id="l69.12" class="difflineminus">-  let enumerator = inbox.msgDatabase.EnumerateMessages();</span>
<a href="#l69.13"></a><span id="l69.13">   let msgCount = 0;</span>
<a href="#l69.14"></a><span id="l69.14" class="difflineminus">-  while (enumerator.hasMoreElements()) {</span>
<a href="#l69.15"></a><span id="l69.15" class="difflineplus">+  for (let hdr of inbox.msgDatabase.EnumerateMessages()) {</span>
<a href="#l69.16"></a><span id="l69.16">     msgCount++;</span>
<a href="#l69.17"></a><span id="l69.17" class="difflineminus">-    let hdr = enumerator.getNext().QueryInterface(Ci.nsIMsgDBHdr);</span>
<a href="#l69.18"></a><span id="l69.18">     messages.appendElement(hdr);</span>
<a href="#l69.19"></a><span id="l69.19">     Assert.equal(hdr.subject, testSubjects[msgCount - 1]);</span>
<a href="#l69.20"></a><span id="l69.20">   }</span>
<a href="#l69.21"></a><span id="l69.21">   Assert.equal(messages.length, 2);</span>
<a href="#l69.22"></a><span id="l69.22"> </span>
<a href="#l69.23"></a><span id="l69.23">   // Create a test folder on the Local Folders account.</span>
<a href="#l69.24"></a><span id="l69.24">   let testFolder = localAccountUtils.rootFolder</span>
<a href="#l69.25"></a><span id="l69.25">     .QueryInterface(Ci.nsIMsgLocalMailFolder)</span>
<a href="#l69.26"></a><span id="l69.26" class="difflineat">@@ -68,36 +66,32 @@ add_task(async function runPump() {</span>
<a href="#l69.27"></a><span id="l69.27">     promiseCopyListener,</span>
<a href="#l69.28"></a><span id="l69.28">     null,</span>
<a href="#l69.29"></a><span id="l69.29">     false</span>
<a href="#l69.30"></a><span id="l69.30">   );</span>
<a href="#l69.31"></a><span id="l69.31">   await promiseCopyListener.promise;</span>
<a href="#l69.32"></a><span id="l69.32"> </span>
<a href="#l69.33"></a><span id="l69.33">   // Check the destination headers.</span>
<a href="#l69.34"></a><span id="l69.34">   messages.clear();</span>
<a href="#l69.35"></a><span id="l69.35" class="difflineminus">-  enumerator = testFolder.msgDatabase.EnumerateMessages();</span>
<a href="#l69.36"></a><span id="l69.36">   msgCount = 0;</span>
<a href="#l69.37"></a><span id="l69.37">   let subjects = [];</span>
<a href="#l69.38"></a><span id="l69.38" class="difflineminus">-  while (enumerator.hasMoreElements()) {</span>
<a href="#l69.39"></a><span id="l69.39" class="difflineplus">+  for (let hdr of testFolder.msgDatabase.EnumerateMessages()) {</span>
<a href="#l69.40"></a><span id="l69.40">     msgCount++;</span>
<a href="#l69.41"></a><span id="l69.41" class="difflineminus">-    let hdr = enumerator.getNext().QueryInterface(Ci.nsIMsgDBHdr);</span>
<a href="#l69.42"></a><span id="l69.42">     messages.appendElement(hdr);</span>
<a href="#l69.43"></a><span id="l69.43">     dump(&quot;Subject: &quot; + hdr.subject + &quot;\n&quot;);</span>
<a href="#l69.44"></a><span id="l69.44">     subjects.push(hdr.subject);</span>
<a href="#l69.45"></a><span id="l69.45">   }</span>
<a href="#l69.46"></a><span id="l69.46">   Assert.equal(messages.length, 2);</span>
<a href="#l69.47"></a><span id="l69.47"> </span>
<a href="#l69.48"></a><span id="l69.48">   // Check for subjects. maildir order for messages may not match</span>
<a href="#l69.49"></a><span id="l69.49">   // order for creation, hence the array.includes.</span>
<a href="#l69.50"></a><span id="l69.50">   for (let subject of testSubjects) {</span>
<a href="#l69.51"></a><span id="l69.51">     Assert.ok(subjects.includes(subject));</span>
<a href="#l69.52"></a><span id="l69.52">   }</span>
<a href="#l69.53"></a><span id="l69.53"> </span>
<a href="#l69.54"></a><span id="l69.54">   // Make sure the body matches the message.</span>
<a href="#l69.55"></a><span id="l69.55" class="difflineminus">-  enumerator = testFolder.msgDatabase.EnumerateMessages();</span>
<a href="#l69.56"></a><span id="l69.56" class="difflineminus">-  while (enumerator.hasMoreElements()) {</span>
<a href="#l69.57"></a><span id="l69.57" class="difflineminus">-    let hdr = enumerator.getNext().QueryInterface(Ci.nsIMsgDBHdr);</span>
<a href="#l69.58"></a><span id="l69.58" class="difflineplus">+  for (let hdr of testFolder.msgDatabase.EnumerateMessages()) {</span>
<a href="#l69.59"></a><span id="l69.59">     let body = mailTestUtils.loadMessageToString(testFolder, hdr);</span>
<a href="#l69.60"></a><span id="l69.60">     Assert.ok(body.includes(hdr.subject));</span>
<a href="#l69.61"></a><span id="l69.61">   }</span>
<a href="#l69.62"></a><span id="l69.62"> </span>
<a href="#l69.63"></a><span id="l69.63">   gPOP3Pump = null;</span>
<a href="#l69.64"></a><span id="l69.64"> });</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l70.1"></a><span id="l70.1" class="difflineminus">--- a/mailnews/local/test/unit/test_pop3MultiCopy2.js</span>
<a href="#l70.2"></a><span id="l70.2" class="difflineplus">+++ b/mailnews/local/test/unit/test_pop3MultiCopy2.js</span>
<a href="#l70.3"></a><span id="l70.3" class="difflineat">@@ -46,19 +46,17 @@ add_task(async function maildirToMbox() </span>
<a href="#l70.4"></a><span id="l70.4">   // get message headers for the inbox folder</span>
<a href="#l70.5"></a><span id="l70.5">   gInboxFolder = gPOP3Pump.fakeServer.rootMsgFolder.getFolderWithFlags(</span>
<a href="#l70.6"></a><span id="l70.6">     Ci.nsMsgFolderFlags.Inbox</span>
<a href="#l70.7"></a><span id="l70.7">   );</span>
<a href="#l70.8"></a><span id="l70.8">   dump(&quot;inbox is at &quot; + gInboxFolder.filePath.path + &quot;\n&quot;);</span>
<a href="#l70.9"></a><span id="l70.9"> </span>
<a href="#l70.10"></a><span id="l70.10">   // Accumulate messages to copy.</span>
<a href="#l70.11"></a><span id="l70.11">   let messages = Cc[&quot;@mozilla.org/array;1&quot;].createInstance(Ci.nsIMutableArray);</span>
<a href="#l70.12"></a><span id="l70.12" class="difflineminus">-  let enumerator = gInboxFolder.msgDatabase.EnumerateMessages();</span>
<a href="#l70.13"></a><span id="l70.13" class="difflineminus">-  while (enumerator.hasMoreElements()) {</span>
<a href="#l70.14"></a><span id="l70.14" class="difflineminus">-    let hdr = enumerator.getNext().QueryInterface(Ci.nsIMsgDBHdr);</span>
<a href="#l70.15"></a><span id="l70.15" class="difflineplus">+  for (let hdr of gInboxFolder.msgDatabase.EnumerateMessages()) {</span>
<a href="#l70.16"></a><span id="l70.16">     messages.appendElement(hdr);</span>
<a href="#l70.17"></a><span id="l70.17">   }</span>
<a href="#l70.18"></a><span id="l70.18">   Assert.equal(messages.length, 2);</span>
<a href="#l70.19"></a><span id="l70.19"> </span>
<a href="#l70.20"></a><span id="l70.20">   // Move messages to mbox test folder.</span>
<a href="#l70.21"></a><span id="l70.21">   let promiseCopyListener = new PromiseTestUtils.PromiseCopyListener();</span>
<a href="#l70.22"></a><span id="l70.22">   MailServices.copy.CopyMessages(</span>
<a href="#l70.23"></a><span id="l70.23">     gInboxFolder,</span>
<a href="#l70.24"></a><span id="l70.24" class="difflineat">@@ -68,52 +66,46 @@ add_task(async function maildirToMbox() </span>
<a href="#l70.25"></a><span id="l70.25">     promiseCopyListener,</span>
<a href="#l70.26"></a><span id="l70.26">     null,</span>
<a href="#l70.27"></a><span id="l70.27">     false</span>
<a href="#l70.28"></a><span id="l70.28">   );</span>
<a href="#l70.29"></a><span id="l70.29">   await promiseCopyListener.promise;</span>
<a href="#l70.30"></a><span id="l70.30"> </span>
<a href="#l70.31"></a><span id="l70.31">   // Check the destination headers.</span>
<a href="#l70.32"></a><span id="l70.32">   messages.clear();</span>
<a href="#l70.33"></a><span id="l70.33" class="difflineminus">-  enumerator = gTestFolder.msgDatabase.EnumerateMessages();</span>
<a href="#l70.34"></a><span id="l70.34">   let subjects = [];</span>
<a href="#l70.35"></a><span id="l70.35" class="difflineminus">-  while (enumerator.hasMoreElements()) {</span>
<a href="#l70.36"></a><span id="l70.36" class="difflineminus">-    let hdr = enumerator.getNext().QueryInterface(Ci.nsIMsgDBHdr);</span>
<a href="#l70.37"></a><span id="l70.37" class="difflineplus">+  for (let hdr of gTestFolder.msgDatabase.EnumerateMessages()) {</span>
<a href="#l70.38"></a><span id="l70.38">     messages.appendElement(hdr);</span>
<a href="#l70.39"></a><span id="l70.39">     dump(&quot;Subject: &quot; + hdr.subject + &quot;\n&quot;);</span>
<a href="#l70.40"></a><span id="l70.40">     subjects.push(hdr.subject);</span>
<a href="#l70.41"></a><span id="l70.41">   }</span>
<a href="#l70.42"></a><span id="l70.42">   Assert.equal(messages.length, 2);</span>
<a href="#l70.43"></a><span id="l70.43"> </span>
<a href="#l70.44"></a><span id="l70.44">   // messages should be missing from source</span>
<a href="#l70.45"></a><span id="l70.45">   Assert.equal(gInboxFolder.getTotalMessages(false), 0);</span>
<a href="#l70.46"></a><span id="l70.46"> </span>
<a href="#l70.47"></a><span id="l70.47">   // Check for subjects. maildir order for messages may not match</span>
<a href="#l70.48"></a><span id="l70.48">   // order for creation, hence the array.includes.</span>
<a href="#l70.49"></a><span id="l70.49">   for (let subject of gTestSubjects) {</span>
<a href="#l70.50"></a><span id="l70.50">     Assert.ok(subjects.includes(subject));</span>
<a href="#l70.51"></a><span id="l70.51">   }</span>
<a href="#l70.52"></a><span id="l70.52"> </span>
<a href="#l70.53"></a><span id="l70.53">   // Make sure the body matches the message.</span>
<a href="#l70.54"></a><span id="l70.54" class="difflineminus">-  enumerator = gTestFolder.msgDatabase.EnumerateMessages();</span>
<a href="#l70.55"></a><span id="l70.55" class="difflineminus">-  while (enumerator.hasMoreElements()) {</span>
<a href="#l70.56"></a><span id="l70.56" class="difflineminus">-    let hdr = enumerator.getNext().QueryInterface(Ci.nsIMsgDBHdr);</span>
<a href="#l70.57"></a><span id="l70.57" class="difflineplus">+  for (let hdr of gTestFolder.msgDatabase.EnumerateMessages()) {</span>
<a href="#l70.58"></a><span id="l70.58">     let body = mailTestUtils.loadMessageToString(gTestFolder, hdr);</span>
<a href="#l70.59"></a><span id="l70.59">     Assert.ok(body.includes(hdr.subject));</span>
<a href="#l70.60"></a><span id="l70.60">   }</span>
<a href="#l70.61"></a><span id="l70.61"> });</span>
<a href="#l70.62"></a><span id="l70.62"> </span>
<a href="#l70.63"></a><span id="l70.63"> add_task(async function mboxToMaildir() {</span>
<a href="#l70.64"></a><span id="l70.64">   // Test for multiple message copy for mbox-&gt;maildir.</span>
<a href="#l70.65"></a><span id="l70.65"> </span>
<a href="#l70.66"></a><span id="l70.66">   // Accumulate messages to copy.</span>
<a href="#l70.67"></a><span id="l70.67">   let messages = Cc[&quot;@mozilla.org/array;1&quot;].createInstance(Ci.nsIMutableArray);</span>
<a href="#l70.68"></a><span id="l70.68" class="difflineminus">-  let enumerator = gTestFolder.msgDatabase.EnumerateMessages();</span>
<a href="#l70.69"></a><span id="l70.69" class="difflineminus">-  while (enumerator.hasMoreElements()) {</span>
<a href="#l70.70"></a><span id="l70.70" class="difflineminus">-    let hdr = enumerator.getNext().QueryInterface(Ci.nsIMsgDBHdr);</span>
<a href="#l70.71"></a><span id="l70.71" class="difflineplus">+  for (let hdr of gTestFolder.msgDatabase.EnumerateMessages()) {</span>
<a href="#l70.72"></a><span id="l70.72">     messages.appendElement(hdr);</span>
<a href="#l70.73"></a><span id="l70.73">   }</span>
<a href="#l70.74"></a><span id="l70.74">   Assert.equal(messages.length, 2);</span>
<a href="#l70.75"></a><span id="l70.75"> </span>
<a href="#l70.76"></a><span id="l70.76">   // Move messages to inbox folder.</span>
<a href="#l70.77"></a><span id="l70.77">   let promiseCopyListener = new PromiseTestUtils.PromiseCopyListener();</span>
<a href="#l70.78"></a><span id="l70.78">   MailServices.copy.CopyMessages(</span>
<a href="#l70.79"></a><span id="l70.79">     gTestFolder,</span>
<a href="#l70.80"></a><span id="l70.80" class="difflineat">@@ -123,39 +115,35 @@ add_task(async function mboxToMaildir() </span>
<a href="#l70.81"></a><span id="l70.81">     promiseCopyListener,</span>
<a href="#l70.82"></a><span id="l70.82">     null,</span>
<a href="#l70.83"></a><span id="l70.83">     false</span>
<a href="#l70.84"></a><span id="l70.84">   );</span>
<a href="#l70.85"></a><span id="l70.85">   await promiseCopyListener.promise;</span>
<a href="#l70.86"></a><span id="l70.86"> </span>
<a href="#l70.87"></a><span id="l70.87">   // Check the destination headers.</span>
<a href="#l70.88"></a><span id="l70.88">   messages.clear();</span>
<a href="#l70.89"></a><span id="l70.89" class="difflineminus">-  enumerator = gInboxFolder.msgDatabase.EnumerateMessages();</span>
<a href="#l70.90"></a><span id="l70.90">   let subjects = [];</span>
<a href="#l70.91"></a><span id="l70.91" class="difflineminus">-  while (enumerator.hasMoreElements()) {</span>
<a href="#l70.92"></a><span id="l70.92" class="difflineminus">-    let hdr = enumerator.getNext().QueryInterface(Ci.nsIMsgDBHdr);</span>
<a href="#l70.93"></a><span id="l70.93" class="difflineplus">+  for (let hdr of gInboxFolder.msgDatabase.EnumerateMessages()) {</span>
<a href="#l70.94"></a><span id="l70.94">     messages.appendElement(hdr);</span>
<a href="#l70.95"></a><span id="l70.95">     dump(&quot;Subject: &quot; + hdr.subject + &quot;\n&quot;);</span>
<a href="#l70.96"></a><span id="l70.96">     subjects.push(hdr.subject);</span>
<a href="#l70.97"></a><span id="l70.97">   }</span>
<a href="#l70.98"></a><span id="l70.98">   Assert.equal(messages.length, 2);</span>
<a href="#l70.99"></a><span id="l70.99"> </span>
<a href="#l70.100"></a><span id="l70.100">   // messages should be missing from source</span>
<a href="#l70.101"></a><span id="l70.101">   Assert.equal(gTestFolder.getTotalMessages(false), 0);</span>
<a href="#l70.102"></a><span id="l70.102"> </span>
<a href="#l70.103"></a><span id="l70.103">   // Check for subjects. maildir order for messages may not match</span>
<a href="#l70.104"></a><span id="l70.104">   // order for creation, hence the array.includes.</span>
<a href="#l70.105"></a><span id="l70.105">   for (let subject of gTestSubjects) {</span>
<a href="#l70.106"></a><span id="l70.106">     Assert.ok(subjects.includes(subject));</span>
<a href="#l70.107"></a><span id="l70.107">   }</span>
<a href="#l70.108"></a><span id="l70.108"> </span>
<a href="#l70.109"></a><span id="l70.109">   // Make sure the body matches the message.</span>
<a href="#l70.110"></a><span id="l70.110" class="difflineminus">-  enumerator = gInboxFolder.msgDatabase.EnumerateMessages();</span>
<a href="#l70.111"></a><span id="l70.111" class="difflineminus">-  while (enumerator.hasMoreElements()) {</span>
<a href="#l70.112"></a><span id="l70.112" class="difflineminus">-    let hdr = enumerator.getNext().QueryInterface(Ci.nsIMsgDBHdr);</span>
<a href="#l70.113"></a><span id="l70.113" class="difflineplus">+  for (let hdr of gInboxFolder.msgDatabase.EnumerateMessages()) {</span>
<a href="#l70.114"></a><span id="l70.114">     let body = mailTestUtils.loadMessageToString(gInboxFolder, hdr);</span>
<a href="#l70.115"></a><span id="l70.115">     Assert.ok(body.includes(hdr.subject));</span>
<a href="#l70.116"></a><span id="l70.116">   }</span>
<a href="#l70.117"></a><span id="l70.117"> });</span>
<a href="#l70.118"></a><span id="l70.118"> </span>
<a href="#l70.119"></a><span id="l70.119"> add_task(function testCleanup() {</span>
<a href="#l70.120"></a><span id="l70.120">   gPOP3Pump = null;</span>
<a href="#l70.121"></a><span id="l70.121"> });</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l71.1"></a><span id="l71.1" class="difflineminus">--- a/mailnews/local/test/unit/test_pop3Pump.js</span>
<a href="#l71.2"></a><span id="l71.2" class="difflineplus">+++ b/mailnews/local/test/unit/test_pop3Pump.js</span>
<a href="#l71.3"></a><span id="l71.3" class="difflineat">@@ -17,18 +17,16 @@ add_task(async function runPump() {</span>
<a href="#l71.4"></a><span id="l71.4">   );</span>
<a href="#l71.5"></a><span id="l71.5">   // demonstration of access to the fake server</span>
<a href="#l71.6"></a><span id="l71.6">   dump(&quot;Server &quot; + gPOP3Pump.fakeServer.prettyName + &quot; is loaded\n&quot;);</span>
<a href="#l71.7"></a><span id="l71.7"> </span>
<a href="#l71.8"></a><span id="l71.8">   gPOP3Pump.files = [&quot;../../../data/bugmail1&quot;, &quot;../../../data/draft1&quot;];</span>
<a href="#l71.9"></a><span id="l71.9">   await gPOP3Pump.run();</span>
<a href="#l71.10"></a><span id="l71.10"> </span>
<a href="#l71.11"></a><span id="l71.11">   // get message headers for the inbox folder</span>
<a href="#l71.12"></a><span id="l71.12" class="difflineminus">-  let enumerator = localAccountUtils.inboxFolder.msgDatabase.EnumerateMessages();</span>
<a href="#l71.13"></a><span id="l71.13">   var msgCount = 0;</span>
<a href="#l71.14"></a><span id="l71.14" class="difflineminus">-  while (enumerator.hasMoreElements()) {</span>
<a href="#l71.15"></a><span id="l71.15" class="difflineplus">+  for (let hdr of localAccountUtils.inboxFolder.msgDatabase.EnumerateMessages()) {</span>
<a href="#l71.16"></a><span id="l71.16">     msgCount++;</span>
<a href="#l71.17"></a><span id="l71.17" class="difflineminus">-    let hdr = enumerator.getNext().QueryInterface(Ci.nsIMsgDBHdr);</span>
<a href="#l71.18"></a><span id="l71.18">     Assert.equal(hdr.subject, testSubjects[msgCount - 1]);</span>
<a href="#l71.19"></a><span id="l71.19">   }</span>
<a href="#l71.20"></a><span id="l71.20">   Assert.equal(msgCount, 2);</span>
<a href="#l71.21"></a><span id="l71.21">   gPOP3Pump = null;</span>
<a href="#l71.22"></a><span id="l71.22"> });</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l72.1"></a><span id="l72.1" class="difflineminus">--- a/mailnews/local/test/unit/test_streamHeaders.js</span>
<a href="#l72.2"></a><span id="l72.2" class="difflineplus">+++ b/mailnews/local/test/unit/test_streamHeaders.js</span>
<a href="#l72.3"></a><span id="l72.3" class="difflineat">@@ -30,21 +30,19 @@ function run_test() {</span>
<a href="#l72.4"></a><span id="l72.4"> var gHdr;</span>
<a href="#l72.5"></a><span id="l72.5"> function* loadMessages() {</span>
<a href="#l72.6"></a><span id="l72.6">   gPOP3Pump.files = [&quot;../../../data/draft1&quot;];</span>
<a href="#l72.7"></a><span id="l72.7">   gPOP3Pump.onDone = async_driver;</span>
<a href="#l72.8"></a><span id="l72.8">   gPOP3Pump.run();</span>
<a href="#l72.9"></a><span id="l72.9">   yield false;</span>
<a href="#l72.10"></a><span id="l72.10"> </span>
<a href="#l72.11"></a><span id="l72.11">   // get message headers for the inbox folder</span>
<a href="#l72.12"></a><span id="l72.12" class="difflineminus">-  let enumerator = localAccountUtils.inboxFolder.msgDatabase.EnumerateMessages();</span>
<a href="#l72.13"></a><span id="l72.13">   var msgCount = 0;</span>
<a href="#l72.14"></a><span id="l72.14" class="difflineminus">-  while (enumerator.hasMoreElements()) {</span>
<a href="#l72.15"></a><span id="l72.15" class="difflineplus">+  for (gHdr of localAccountUtils.inboxFolder.msgDatabase.EnumerateMessages()) {</span>
<a href="#l72.16"></a><span id="l72.16">     msgCount++;</span>
<a href="#l72.17"></a><span id="l72.17" class="difflineminus">-    gHdr = enumerator.getNext().QueryInterface(Ci.nsIMsgDBHdr);</span>
<a href="#l72.18"></a><span id="l72.18">     Assert.equal(gHdr.subject, testSubjects[msgCount - 1]);</span>
<a href="#l72.19"></a><span id="l72.19">   }</span>
<a href="#l72.20"></a><span id="l72.20">   Assert.equal(msgCount, 1);</span>
<a href="#l72.21"></a><span id="l72.21">   gPOP3Pump = null;</span>
<a href="#l72.22"></a><span id="l72.22"> }</span>
<a href="#l72.23"></a><span id="l72.23"> </span>
<a href="#l72.24"></a><span id="l72.24"> function* goodStreaming() {</span>
<a href="#l72.25"></a><span id="l72.25">   // try to stream the headers of the last message</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l73.1"></a><span id="l73.1" class="difflineminus">--- a/mailnews/news/src/NewsAutoCompleteSearch.jsm</span>
<a href="#l73.2"></a><span id="l73.2" class="difflineplus">+++ b/mailnews/news/src/NewsAutoCompleteSearch.jsm</span>
<a href="#l73.3"></a><span id="l73.3" class="difflineat">@@ -103,19 +103,17 @@ NewsAutoCompleteSearch.prototype = {</span>
<a href="#l73.4"></a><span id="l73.4">     }</span>
<a href="#l73.5"></a><span id="l73.5"> </span>
<a href="#l73.6"></a><span id="l73.6">     if (&quot;accountKey&quot; in params &amp;&amp; params.accountKey != this.cachedAccountKey) {</span>
<a href="#l73.7"></a><span id="l73.7">       this.cachedAccountKey = params.accountKey;</span>
<a href="#l73.8"></a><span id="l73.8">       this.cachedServer = this._findServer(params.accountKey);</span>
<a href="#l73.9"></a><span id="l73.9">     }</span>
<a href="#l73.10"></a><span id="l73.10"> </span>
<a href="#l73.11"></a><span id="l73.11">     if (this.cachedServer) {</span>
<a href="#l73.12"></a><span id="l73.12" class="difflineminus">-      let groups = this.cachedServer.rootFolder.subFolders;</span>
<a href="#l73.13"></a><span id="l73.13" class="difflineminus">-      while (groups.hasMoreElements()) {</span>
<a href="#l73.14"></a><span id="l73.14" class="difflineminus">-        let curr = groups.getNext().QueryInterface(Ci.nsIMsgFolder);</span>
<a href="#l73.15"></a><span id="l73.15" class="difflineplus">+      for (let curr of this.cachedServer.rootFolder.subFolders) {</span>
<a href="#l73.16"></a><span id="l73.16">         if (curr.prettyName.includes(aSearchString)) {</span>
<a href="#l73.17"></a><span id="l73.17">           result._searchResults.push({</span>
<a href="#l73.18"></a><span id="l73.18">             value: curr.prettyName,</span>
<a href="#l73.19"></a><span id="l73.19">             comment: this.cachedServer.prettyName,</span>
<a href="#l73.20"></a><span id="l73.20">           });</span>
<a href="#l73.21"></a><span id="l73.21">         }</span>
<a href="#l73.22"></a><span id="l73.22">       }</span>
<a href="#l73.23"></a><span id="l73.23">     }</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l74.1"></a><span id="l74.1" class="difflineminus">--- a/mailnews/news/test/unit/head_server_setup.js</span>
<a href="#l74.2"></a><span id="l74.2" class="difflineplus">+++ b/mailnews/news/test/unit/head_server_setup.js</span>
<a href="#l74.3"></a><span id="l74.3" class="difflineat">@@ -58,21 +58,17 @@ var groups = [</span>
<a href="#l74.4"></a><span id="l74.4"> function setupNNTPDaemon() {</span>
<a href="#l74.5"></a><span id="l74.5">   var daemon = new nntpDaemon();</span>
<a href="#l74.6"></a><span id="l74.6"> </span>
<a href="#l74.7"></a><span id="l74.7">   groups.forEach(function(element) {</span>
<a href="#l74.8"></a><span id="l74.8">     daemon.addGroup(element[0]);</span>
<a href="#l74.9"></a><span id="l74.9">   });</span>
<a href="#l74.10"></a><span id="l74.10"> </span>
<a href="#l74.11"></a><span id="l74.11">   var auto_add = do_get_file(&quot;postings/auto-add/&quot;);</span>
<a href="#l74.12"></a><span id="l74.12" class="difflineminus">-  var files = [];</span>
<a href="#l74.13"></a><span id="l74.13" class="difflineminus">-  var enumerator = auto_add.directoryEntries;</span>
<a href="#l74.14"></a><span id="l74.14" class="difflineminus">-  while (enumerator.hasMoreElements()) {</span>
<a href="#l74.15"></a><span id="l74.15" class="difflineminus">-    files.push(enumerator.nextFile);</span>
<a href="#l74.16"></a><span id="l74.16" class="difflineminus">-  }</span>
<a href="#l74.17"></a><span id="l74.17" class="difflineplus">+  var files = [...auto_add.directoryEntries];</span>
<a href="#l74.18"></a><span id="l74.18"> </span>
<a href="#l74.19"></a><span id="l74.19">   files.sort(function(a, b) {</span>
<a href="#l74.20"></a><span id="l74.20">     if (a.leafName == b.leafName) {</span>
<a href="#l74.21"></a><span id="l74.21">       return 0;</span>
<a href="#l74.22"></a><span id="l74.22">     }</span>
<a href="#l74.23"></a><span id="l74.23">     return a.leafName &lt; b.leafName ? -1 : 1;</span>
<a href="#l74.24"></a><span id="l74.24">   });</span>
<a href="#l74.25"></a><span id="l74.25"> </span>
<a href="#l74.26"></a><span id="l74.26" class="difflineat">@@ -191,21 +187,17 @@ function create_post(baseURL, file) {</span>
<a href="#l74.27"></a><span id="l74.27">     Ci.nsINNTPNewsgroupPost</span>
<a href="#l74.28"></a><span id="l74.28">   );</span>
<a href="#l74.29"></a><span id="l74.29">   post.postMessageFile = do_get_file(file);</span>
<a href="#l74.30"></a><span id="l74.30">   url.messageToPost = post;</span>
<a href="#l74.31"></a><span id="l74.31">   return url;</span>
<a href="#l74.32"></a><span id="l74.32"> }</span>
<a href="#l74.33"></a><span id="l74.33"> </span>
<a href="#l74.34"></a><span id="l74.34"> function resetFolder(folder) {</span>
<a href="#l74.35"></a><span id="l74.35" class="difflineminus">-  var headerEnum = folder.messages;</span>
<a href="#l74.36"></a><span id="l74.36" class="difflineminus">-  var headers = [];</span>
<a href="#l74.37"></a><span id="l74.37" class="difflineminus">-  while (headerEnum.hasMoreElements()) {</span>
<a href="#l74.38"></a><span id="l74.38" class="difflineminus">-    headers.push(headerEnum.getNext().QueryInterface(Ci.nsIMsgDBHdr));</span>
<a href="#l74.39"></a><span id="l74.39" class="difflineminus">-  }</span>
<a href="#l74.40"></a><span id="l74.40" class="difflineplus">+  var headers = [...folder.messages];</span>
<a href="#l74.41"></a><span id="l74.41"> </span>
<a href="#l74.42"></a><span id="l74.42">   var db = folder.msgDatabase;</span>
<a href="#l74.43"></a><span id="l74.43">   db.dBFolderInfo.knownArtsSet = &quot;&quot;;</span>
<a href="#l74.44"></a><span id="l74.44">   for (var header of headers) {</span>
<a href="#l74.45"></a><span id="l74.45">     db.DeleteHeader(header, null, true, false);</span>
<a href="#l74.46"></a><span id="l74.46">   }</span>
<a href="#l74.47"></a><span id="l74.47">   dump(&quot;resetting folder\n&quot;);</span>
<a href="#l74.48"></a><span id="l74.48">   folder.msgDatabase = null;</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l75.1"></a><span id="l75.1" class="difflineminus">--- a/mailnews/news/test/unit/test_biff.js</span>
<a href="#l75.2"></a><span id="l75.2" class="difflineplus">+++ b/mailnews/news/test/unit/test_biff.js</span>
<a href="#l75.3"></a><span id="l75.3" class="difflineat">@@ -11,19 +11,17 @@ var { MailServices } = ChromeUtils.impor</span>
<a href="#l75.4"></a><span id="l75.4"> function run_test() {</span>
<a href="#l75.5"></a><span id="l75.5">   // Set up the server and add in filters</span>
<a href="#l75.6"></a><span id="l75.6">   let daemon = setupNNTPDaemon();</span>
<a href="#l75.7"></a><span id="l75.7">   let server = makeServer(NNTP_RFC2980_handler, daemon);</span>
<a href="#l75.8"></a><span id="l75.8">   server.start();</span>
<a href="#l75.9"></a><span id="l75.9">   let localserver = setupLocalServer(server.port);</span>
<a href="#l75.10"></a><span id="l75.10">   // Remove all but the test.filter folder</span>
<a href="#l75.11"></a><span id="l75.11">   let rootFolder = localserver.rootFolder;</span>
<a href="#l75.12"></a><span id="l75.12" class="difflineminus">-  let enumerator = rootFolder.subFolders;</span>
<a href="#l75.13"></a><span id="l75.13" class="difflineminus">-  while (enumerator.hasMoreElements()) {</span>
<a href="#l75.14"></a><span id="l75.14" class="difflineminus">-    let folder = enumerator.getNext().QueryInterface(Ci.nsIMsgFolder);</span>
<a href="#l75.15"></a><span id="l75.15" class="difflineplus">+  for (let folder of rootFolder.subFolders) {</span>
<a href="#l75.16"></a><span id="l75.16">     if (folder.name != &quot;test.filter&quot;) {</span>
<a href="#l75.17"></a><span id="l75.17">       rootFolder.propagateDelete(folder, true, null);</span>
<a href="#l75.18"></a><span id="l75.18">     }</span>
<a href="#l75.19"></a><span id="l75.19">   }</span>
<a href="#l75.20"></a><span id="l75.20"> </span>
<a href="#l75.21"></a><span id="l75.21">   // Create a filter to mark one message read.</span>
<a href="#l75.22"></a><span id="l75.22">   let filters = localserver.getFilterList(null);</span>
<a href="#l75.23"></a><span id="l75.23">   filters.loggingEnabled = true;</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l76.1"></a><span id="l76.1" class="difflineminus">--- a/mailnews/news/test/unit/test_filter.js</span>
<a href="#l76.2"></a><span id="l76.2" class="difflineplus">+++ b/mailnews/news/test/unit/test_filter.js</span>
<a href="#l76.3"></a><span id="l76.3" class="difflineat">@@ -40,21 +40,17 @@ function testAttrib(handler, daemon, loc</span>
<a href="#l76.4"></a><span id="l76.4">   var folder = localserver.rootFolder.getChildNamed(&quot;test.filter&quot;);</span>
<a href="#l76.5"></a><span id="l76.5">   folder.getNewMessages(null, {</span>
<a href="#l76.6"></a><span id="l76.6">     OnStopRunningUrl() {</span>
<a href="#l76.7"></a><span id="l76.7">       localserver.closeCachedConnections();</span>
<a href="#l76.8"></a><span id="l76.8">     },</span>
<a href="#l76.9"></a><span id="l76.9">   });</span>
<a href="#l76.10"></a><span id="l76.10">   server.performTest();</span>
<a href="#l76.11"></a><span id="l76.11"> </span>
<a href="#l76.12"></a><span id="l76.12" class="difflineminus">-  var headerEnum = folder.messages;</span>
<a href="#l76.13"></a><span id="l76.13" class="difflineminus">-  var headers = [];</span>
<a href="#l76.14"></a><span id="l76.14" class="difflineminus">-  while (headerEnum.hasMoreElements()) {</span>
<a href="#l76.15"></a><span id="l76.15" class="difflineminus">-    headers.push(headerEnum.getNext().QueryInterface(Ci.nsIMsgDBHdr));</span>
<a href="#l76.16"></a><span id="l76.16" class="difflineminus">-  }</span>
<a href="#l76.17"></a><span id="l76.17" class="difflineplus">+  var headers = [...folder.messages];</span>
<a href="#l76.18"></a><span id="l76.18"> </span>
<a href="#l76.19"></a><span id="l76.19">   try {</span>
<a href="#l76.20"></a><span id="l76.20">     Assert.equal(headers.length, 8);</span>
<a href="#l76.21"></a><span id="l76.21">     for (var header of headers) {</span>
<a href="#l76.22"></a><span id="l76.22">       var id = header.messageId;</span>
<a href="#l76.23"></a><span id="l76.23">       dump(&quot;Testing message &quot; + id + &quot;\n&quot;);</span>
<a href="#l76.24"></a><span id="l76.24">       Assert.equal(header[attribResults[id][0]], attribResults[id][1]);</span>
<a href="#l76.25"></a><span id="l76.25">     }</span>
<a href="#l76.26"></a><span id="l76.26" class="difflineat">@@ -100,21 +96,17 @@ function testAction(handler, daemon, loc</span>
<a href="#l76.27"></a><span id="l76.27">   var folder = localserver.rootFolder.getChildNamed(&quot;test.filter&quot;);</span>
<a href="#l76.28"></a><span id="l76.28">   folder.getNewMessages(null, {</span>
<a href="#l76.29"></a><span id="l76.29">     OnStopRunningUrl() {</span>
<a href="#l76.30"></a><span id="l76.30">       localserver.closeCachedConnections();</span>
<a href="#l76.31"></a><span id="l76.31">     },</span>
<a href="#l76.32"></a><span id="l76.32">   });</span>
<a href="#l76.33"></a><span id="l76.33">   server.performTest();</span>
<a href="#l76.34"></a><span id="l76.34"> </span>
<a href="#l76.35"></a><span id="l76.35" class="difflineminus">-  var headerEnum = folder.messages;</span>
<a href="#l76.36"></a><span id="l76.36" class="difflineminus">-  var headers = [];</span>
<a href="#l76.37"></a><span id="l76.37" class="difflineminus">-  while (headerEnum.hasMoreElements()) {</span>
<a href="#l76.38"></a><span id="l76.38" class="difflineminus">-    headers.push(headerEnum.getNext().QueryInterface(Ci.nsIMsgDBHdr));</span>
<a href="#l76.39"></a><span id="l76.39" class="difflineminus">-  }</span>
<a href="#l76.40"></a><span id="l76.40" class="difflineplus">+  let headers = [...folder.messages];</span>
<a href="#l76.41"></a><span id="l76.41"> </span>
<a href="#l76.42"></a><span id="l76.42">   try {</span>
<a href="#l76.43"></a><span id="l76.43">     Assert.equal(headers.length, 7);</span>
<a href="#l76.44"></a><span id="l76.44">     for (var header of headers) {</span>
<a href="#l76.45"></a><span id="l76.45">       var id = header.messageId;</span>
<a href="#l76.46"></a><span id="l76.46">       dump(&quot;Testing message &quot; + id + &quot;\n&quot;);</span>
<a href="#l76.47"></a><span id="l76.47">       if (actionResults[id] instanceof Array) {</span>
<a href="#l76.48"></a><span id="l76.48">         Assert.equal(header[actionResults[id][0]], actionResults[id][1]);</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l77.1"></a><span id="l77.1" class="difflineminus">--- a/mailnews/news/test/unit/test_server.js</span>
<a href="#l77.2"></a><span id="l77.2" class="difflineplus">+++ b/mailnews/news/test/unit/test_server.js</span>
<a href="#l77.3"></a><span id="l77.3" class="difflineat">@@ -168,22 +168,18 @@ function testManyConnections() {</span>
<a href="#l77.4"></a><span id="l77.4">     ran: 0,</span>
<a href="#l77.5"></a><span id="l77.5">     OnStartRunningUrl(url) {},</span>
<a href="#l77.6"></a><span id="l77.6">     OnStopRunningUrl(url, rv) {</span>
<a href="#l77.7"></a><span id="l77.7">       if (--this.ran == 0) {</span>
<a href="#l77.8"></a><span id="l77.8">         _server.closeCachedConnections();</span>
<a href="#l77.9"></a><span id="l77.9">       }</span>
<a href="#l77.10"></a><span id="l77.10">     },</span>
<a href="#l77.11"></a><span id="l77.11">   };</span>
<a href="#l77.12"></a><span id="l77.12" class="difflineminus">-  let groups = _server.rootFolder.subFolders;</span>
<a href="#l77.13"></a><span id="l77.13" class="difflineminus">-  while (groups.hasMoreElements()) {</span>
<a href="#l77.14"></a><span id="l77.14" class="difflineminus">-    groups</span>
<a href="#l77.15"></a><span id="l77.15" class="difflineminus">-      .getNext()</span>
<a href="#l77.16"></a><span id="l77.16" class="difflineminus">-      .QueryInterface(Ci.nsIMsgFolder)</span>
<a href="#l77.17"></a><span id="l77.17" class="difflineminus">-      .getNewMessages(null, listener);</span>
<a href="#l77.18"></a><span id="l77.18" class="difflineplus">+  for (let group of _server.rootFolder.subFolders) {</span>
<a href="#l77.19"></a><span id="l77.19" class="difflineplus">+    group.getNewMessages(null, listener);</span>
<a href="#l77.20"></a><span id="l77.20">     listener.ran++;</span>
<a href="#l77.21"></a><span id="l77.21">   }</span>
<a href="#l77.22"></a><span id="l77.22">   server.performTest();</span>
<a href="#l77.23"></a><span id="l77.23">   // The last one that is processed is test.filter, so make sure that</span>
<a href="#l77.24"></a><span id="l77.24">   // test.subscribed.simple is not retrieving the data meant for test.filter</span>
<a href="#l77.25"></a><span id="l77.25">   let folder = _server.rootFolder.getChildNamed(&quot;test.subscribe.simple&quot;);</span>
<a href="#l77.26"></a><span id="l77.26">   Assert.equal(folder.getTotalMessages(false), 1);</span>
<a href="#l77.27"></a><span id="l77.27"> }</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l78.1"></a><span id="l78.1" class="difflineminus">--- a/mailnews/test/resources/mailTestUtils.js</span>
<a href="#l78.2"></a><span id="l78.2" class="difflineplus">+++ b/mailnews/test/resources/mailTestUtils.js</span>
<a href="#l78.3"></a><span id="l78.3" class="difflineat">@@ -128,21 +128,19 @@ var mailTestUtils = {</span>
<a href="#l78.4"></a><span id="l78.4">       return enumerator.getNext().QueryInterface(Ci.nsIMsgDBHdr);</span>
<a href="#l78.5"></a><span id="l78.5">     }</span>
<a href="#l78.6"></a><span id="l78.6">     return null;</span>
<a href="#l78.7"></a><span id="l78.7">   },</span>
<a href="#l78.8"></a><span id="l78.8"> </span>
<a href="#l78.9"></a><span id="l78.9">   // Gets message header number N (0 based index) in a folder.</span>
<a href="#l78.10"></a><span id="l78.10">   getMsgHdrN(folder, n) {</span>
<a href="#l78.11"></a><span id="l78.11">     let i = 0;</span>
<a href="#l78.12"></a><span id="l78.12" class="difflineminus">-    let enumerator = folder.msgDatabase.EnumerateMessages();</span>
<a href="#l78.13"></a><span id="l78.13" class="difflineminus">-    while (enumerator.hasMoreElements()) {</span>
<a href="#l78.14"></a><span id="l78.14" class="difflineminus">-      let next = enumerator.getNext();</span>
<a href="#l78.15"></a><span id="l78.15" class="difflineplus">+    for (let next of folder.msgDatabase.EnumerateMessages()) {</span>
<a href="#l78.16"></a><span id="l78.16">       if (i == n) {</span>
<a href="#l78.17"></a><span id="l78.17" class="difflineminus">-        return next.QueryInterface(Ci.nsIMsgDBHdr);</span>
<a href="#l78.18"></a><span id="l78.18" class="difflineplus">+        return next;</span>
<a href="#l78.19"></a><span id="l78.19">       }</span>
<a href="#l78.20"></a><span id="l78.20">       i++;</span>
<a href="#l78.21"></a><span id="l78.21">     }</span>
<a href="#l78.22"></a><span id="l78.22">     return null;</span>
<a href="#l78.23"></a><span id="l78.23">   },</span>
<a href="#l78.24"></a><span id="l78.24"> </span>
<a href="#l78.25"></a><span id="l78.25">   /**</span>
<a href="#l78.26"></a><span id="l78.26">    * Returns the file system a particular file is on.</span></pre></div></div>

<div class="page_footer">
<div class="page_footer_text">comm-central</div>
<div class="page_footer_text" style="padding-left: 10px">Deployed from <a href="https://hg.mozilla.org/hgcustom/version-control-tools/rev/4b0de666d1a4">4b0de666d1a4</a> at 2020-07-30T19:32:33Z.</div>
<div class="rss_logo">
<a href="/comm-central/rss-log">RSS</a>
<a href="/comm-central/atom-log">Atom</a>
</div>
<br />

</div>
</body>
</html>

