<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en-US" lang="en-US">
<head>
<link rel="icon" href="/static/35f393d6769a/hgicon.png" type="image/png" />
<meta name="robots" content="index, nofollow"/>
<link rel="stylesheet" href="/static/35f393d6769a/style-gitweb.css" type="text/css" />

<style type="text/css">
div.feed {
  float: right;
}
a img {
  border-width: 0px;
}
div.log_link {
  width: 80px;
  background-color: white;
}

div.log_body {
  padding-left: 96px;
}
</style>
<script type="text/javascript" src="/static/35f393d6769a/mercurial.js"></script>

<meta property="og:image" content="/static/35f393d6769a/moz-logo-bw-rgb.svg"/>
<meta property="og:type" content="website"/>

<title>comm-central: changeset 10811:6856915ce62ba31ae73713896dba686bdd74b00f</title>
<link rel="alternate" type="application/atom+xml"
   href="/comm-central/atom-log" title="Atom feed for comm-central"/>
<link rel="alternate" type="application/rss+xml"
   href="/comm-central/rss-log" title="RSS feed for comm-central"/>

<meta property="og:title" content="comm-central @ 6856915ce62ba31ae73713896dba686bdd74b00f" />
<meta property="og:url" content="/comm-central/rev/6856915ce62ba31ae73713896dba686bdd74b00f" />
<meta property="og:description" content="Bug 450302: There is no &quot;filter searching&quot; (to find a filter). ui-r=bwinton, r=mkmelin" />

</head>
<body>

<div class="page_header">
<div class="logo">
    <a href="https://developer.mozilla.org/en/docs/Mercurial">
        <img src="/static/35f393d6769a/moz-logo-bw-rgb.svg" alt="mercurial" />
    </a>
</div>
<a href="/">Mercurial</a> &gt; <a href="/comm-central">comm-central</a>  / changeset / 6856915ce62ba31ae73713896dba686bdd74b00f 
</div>

<div class="page_nav">
<div>
<a href="/comm-central/summary">summary</a> |
<a href="/comm-central/shortlog/6856915ce62ba31ae73713896dba686bdd74b00f">shortlog</a> |
<a href="/comm-central/log/6856915ce62ba31ae73713896dba686bdd74b00f">changelog</a> |
<a href="/comm-central/pushloghtml">pushlog</a> |
<a href="/comm-central/graph/6856915ce62ba31ae73713896dba686bdd74b00f">graph</a> |
<a href="/comm-central/tags">tags</a> |
<a href="/comm-central/bookmarks">bookmarks</a> |
<a href="/comm-central/branches">branches</a> |
<a href="/comm-central/file/6856915ce62ba31ae73713896dba686bdd74b00f">files</a> |
changeset |
<a href="/comm-central/raw-rev/6856915ce62ba31ae73713896dba686bdd74b00f">raw</a>  | <a href="/comm-central/archive/6856915ce62ba31ae73713896dba686bdd74b00f.zip">zip</a>  |
<a href="/comm-central/help">help</a>
</div>

<div class="search">
<form id="searchform" action="/comm-central/log">

<input name="rev" type="text" value="" size="40" />
<div id="hint">Find changesets by keywords (author, files, the commit message), revision
number or hash, or <a href="/comm-central/help/revsets">revset expression</a>.</div>
</form>
</div>
</div>

<div class="title">
<a href="https://bugzilla.mozilla.org/show_bug.cgi?id=450302">Bug 450302</a>: There is no &quot;filter searching&quot; (to find a filter). ui-r=bwinton, r=mkmelin
<span class="logtags"></span>
</div>
<div class="title_text">
<table cellspacing="0">

<tr><td>author</td><td>&#65;&#120;&#101;&#108;&#32;&#71;&#114;&#117;&#100;&#101;&#32;&#91;&#58;&#114;&#101;&#97;&#108;&#82;&#97;&#118;&#101;&#110;&#93;&#32;&#60;&#97;&#120;&#101;&#108;&#103;&#64;&#103;&#111;&#102;&#114;&#101;&#101;&#46;&#105;&#110;&#100;&#105;&#103;&#111;&#46;&#105;&#101;&#62;</td></tr>
<tr><td></td><td class="date age">Sun, 05 Aug 2012 13:09:58 +0300</td></tr>

<tr>
 <td>changeset 10811</td>
 <td style="font-family:monospace"><a class="list" href="/comm-central/rev/6856915ce62ba31ae73713896dba686bdd74b00f">6856915ce62ba31ae73713896dba686bdd74b00f</a></td>
</tr>



<tr>
<td>parent 10810</td>
<td style="font-family:monospace">
<a class="list" href="/comm-central/rev/25e716ecbc45fc3b28b69275c5cdbdb2cc85653b">25e716ecbc45fc3b28b69275c5cdbdb2cc85653b</a>
</td>
</tr>

<tr>
<td>child 10812</td>
<td style="font-family:monospace">
<a class="list" href="/comm-central/rev/423cb0440fca93faab9e466582f9d289da49324c">423cb0440fca93faab9e466582f9d289da49324c</a>
</td>
</tr>
<tr><td>push id</td><td><a href="/comm-central/pushloghtml?changeset=6856915ce62ba31ae73713896dba686bdd74b00f">8123</a></td></tr>
<tr><td>push user</td><td>mkmelin@iki.fi</td></tr>
<tr><td>push date</td><td class="date age">Sun, 05 Aug 2012 10:12:24 +0000</td></tr>

<tr><td>treeherder</td><td>comm-central@6856915ce62b [<a href="https://treeherder.mozilla.org/#/jobs?repo=comm-central&revision=6856915ce62ba31ae73713896dba686bdd74b00f">default view</a>] [<a href="https://treeherder.mozilla.org/#/jobs?repo=comm-central&revision=6856915ce62ba31ae73713896dba686bdd74b00f&filter-resultStatus=testfailed&filter-resultStatus=busted&filter-resultStatus=exception">failures only]</td></tr>
<tr><td>perfherder</td><td>[<a href="https://treeherder.mozilla.org/perf.html#/compare?originalProject=comm-central&originalRevision=6856915ce62ba31ae73713896dba686bdd74b00f&newProject=comm-central&newRevision=6856915ce62ba31ae73713896dba686bdd74b00f&framework=1" target="_blank">talos</a>] [<a href="https://treeherder.mozilla.org/perf.html#/compare?originalProject=comm-central&originalRevision=6856915ce62ba31ae73713896dba686bdd74b00f&newProject=comm-central&newRevision=6856915ce62ba31ae73713896dba686bdd74b00f&framework=2" target="_blank">build metrics</a>] [<a href="https://treeherder.mozilla.org/perf.html#/compare?originalProject=comm-central&originalRevision=6856915ce62ba31ae73713896dba686bdd74b00f&newProject=comm-central&newRevision=6856915ce62ba31ae73713896dba686bdd74b00f&framework=6" target="_blank">platform microbench</a>] (compared to previous push)</td></tr>
<tr><td>reviewers</td><td><a href="/comm-central/log?rev=reviewer%28bwinton%29&revcount=50">bwinton</a>, <a href="/comm-central/log?rev=reviewer%28mkmelin%29&revcount=50">mkmelin</a></td></tr>
<tr><td>bugs</td><td><a href="https://bugzilla.mozilla.org/show_bug.cgi?id=450302">450302</a></td></tr>




</table></div>

<div class="page_body description"><a href="https://bugzilla.mozilla.org/show_bug.cgi?id=450302">Bug 450302</a>: There is no &quot;filter searching&quot; (to find a filter). ui-r=bwinton, r=mkmelin</div>
<div class="list_head"></div>
<div class="title_text">
<table cellspacing="0">

<tr class="parity0">
<td><a class="list" href="/comm-central/diff/6856915ce62ba31ae73713896dba686bdd74b00f/aclocal.m4">aclocal.m4</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/6856915ce62ba31ae73713896dba686bdd74b00f/aclocal.m4">file</a> |
<a href="/comm-central/annotate/6856915ce62ba31ae73713896dba686bdd74b00f/aclocal.m4">annotate</a> |
<a href="/comm-central/diff/6856915ce62ba31ae73713896dba686bdd74b00f/aclocal.m4">diff</a> |
<a href="/comm-central/comparison/6856915ce62ba31ae73713896dba686bdd74b00f/aclocal.m4">comparison</a> |
<a href="/comm-central/log/6856915ce62ba31ae73713896dba686bdd74b00f/aclocal.m4">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/6856915ce62ba31ae73713896dba686bdd74b00f/mail/base/content/FilterListDialog.js">mail/base/content/FilterListDialog.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/6856915ce62ba31ae73713896dba686bdd74b00f/mail/base/content/FilterListDialog.js">file</a> |
<a href="/comm-central/annotate/6856915ce62ba31ae73713896dba686bdd74b00f/mail/base/content/FilterListDialog.js">annotate</a> |
<a href="/comm-central/diff/6856915ce62ba31ae73713896dba686bdd74b00f/mail/base/content/FilterListDialog.js">diff</a> |
<a href="/comm-central/comparison/6856915ce62ba31ae73713896dba686bdd74b00f/mail/base/content/FilterListDialog.js">comparison</a> |
<a href="/comm-central/log/6856915ce62ba31ae73713896dba686bdd74b00f/mail/base/content/FilterListDialog.js">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/6856915ce62ba31ae73713896dba686bdd74b00f/mail/base/content/FilterListDialog.xul">mail/base/content/FilterListDialog.xul</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/6856915ce62ba31ae73713896dba686bdd74b00f/mail/base/content/FilterListDialog.xul">file</a> |
<a href="/comm-central/annotate/6856915ce62ba31ae73713896dba686bdd74b00f/mail/base/content/FilterListDialog.xul">annotate</a> |
<a href="/comm-central/diff/6856915ce62ba31ae73713896dba686bdd74b00f/mail/base/content/FilterListDialog.xul">diff</a> |
<a href="/comm-central/comparison/6856915ce62ba31ae73713896dba686bdd74b00f/mail/base/content/FilterListDialog.xul">comparison</a> |
<a href="/comm-central/log/6856915ce62ba31ae73713896dba686bdd74b00f/mail/base/content/FilterListDialog.xul">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/6856915ce62ba31ae73713896dba686bdd74b00f/mail/locales/en-US/chrome/messenger/FilterListDialog.dtd">mail/locales/en-US/chrome/messenger/FilterListDialog.dtd</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/6856915ce62ba31ae73713896dba686bdd74b00f/mail/locales/en-US/chrome/messenger/FilterListDialog.dtd">file</a> |
<a href="/comm-central/annotate/6856915ce62ba31ae73713896dba686bdd74b00f/mail/locales/en-US/chrome/messenger/FilterListDialog.dtd">annotate</a> |
<a href="/comm-central/diff/6856915ce62ba31ae73713896dba686bdd74b00f/mail/locales/en-US/chrome/messenger/FilterListDialog.dtd">diff</a> |
<a href="/comm-central/comparison/6856915ce62ba31ae73713896dba686bdd74b00f/mail/locales/en-US/chrome/messenger/FilterListDialog.dtd">comparison</a> |
<a href="/comm-central/log/6856915ce62ba31ae73713896dba686bdd74b00f/mail/locales/en-US/chrome/messenger/FilterListDialog.dtd">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/6856915ce62ba31ae73713896dba686bdd74b00f/mail/locales/en-US/chrome/messenger/filter.properties">mail/locales/en-US/chrome/messenger/filter.properties</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/6856915ce62ba31ae73713896dba686bdd74b00f/mail/locales/en-US/chrome/messenger/filter.properties">file</a> |
<a href="/comm-central/annotate/6856915ce62ba31ae73713896dba686bdd74b00f/mail/locales/en-US/chrome/messenger/filter.properties">annotate</a> |
<a href="/comm-central/diff/6856915ce62ba31ae73713896dba686bdd74b00f/mail/locales/en-US/chrome/messenger/filter.properties">diff</a> |
<a href="/comm-central/comparison/6856915ce62ba31ae73713896dba686bdd74b00f/mail/locales/en-US/chrome/messenger/filter.properties">comparison</a> |
<a href="/comm-central/log/6856915ce62ba31ae73713896dba686bdd74b00f/mail/locales/en-US/chrome/messenger/filter.properties">revisions</a>
</td>
</tr>
</table></div>

<div class="page_body diffblocks"><div class="diffblock"><pre class="sourcelines">
<a href="#l1.1"></a><span id="l1.1" class="difflineminus">--- a/aclocal.m4</span>
<a href="#l1.2"></a><span id="l1.2" class="difflineplus">+++ b/aclocal.m4</span>
<a href="#l1.3"></a><span id="l1.3" class="difflineat">@@ -1,12 +1,12 @@</span>
<a href="#l1.4"></a><span id="l1.4"> dnl</span>
<a href="#l1.5"></a><span id="l1.5"> dnl Local autoconf macros used with mozilla</span>
<a href="#l1.6"></a><span id="l1.6"> dnl The contents of this file are under the Public Domain.</span>
<a href="#l1.7"></a><span id="l1.7" class="difflineminus">-dnl </span>
<a href="#l1.8"></a><span id="l1.8" class="difflineplus">+dnl</span>
<a href="#l1.9"></a><span id="l1.9"> </span>
<a href="#l1.10"></a><span id="l1.10"> builtin(include, mozilla/build/autoconf/nspr.m4)dnl</span>
<a href="#l1.11"></a><span id="l1.11"> builtin(include, mozilla/build/autoconf/nss.m4)dnl</span>
<a href="#l1.12"></a><span id="l1.12"> builtin(include, mozilla/build/autoconf/pkg.m4)dnl</span>
<a href="#l1.13"></a><span id="l1.13"> builtin(include, mozilla/build/autoconf/codeset.m4)dnl</span>
<a href="#l1.14"></a><span id="l1.14"> builtin(include, mozilla/build/autoconf/altoptions.m4)dnl</span>
<a href="#l1.15"></a><span id="l1.15"> builtin(include, mozilla/build/autoconf/mozprog.m4)dnl</span>
<a href="#l1.16"></a><span id="l1.16"> builtin(include, mozilla/build/autoconf/acwinpaths.m4)dnl</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l2.1"></a><span id="l2.1" class="difflineminus">--- a/mail/base/content/FilterListDialog.js</span>
<a href="#l2.2"></a><span id="l2.2" class="difflineplus">+++ b/mail/base/content/FilterListDialog.js</span>
<a href="#l2.3"></a><span id="l2.3" class="difflineat">@@ -1,19 +1,28 @@</span>
<a href="#l2.4"></a><span id="l2.4"> /* -*- Mode: C++; tab-width: 4; indent-tabs-mode: nil; c-basic-offset: 4 -*-</span>
<a href="#l2.5"></a><span id="l2.5">  * This Source Code Form is subject to the terms of the Mozilla Public</span>
<a href="#l2.6"></a><span id="l2.6">  * License, v. 2.0. If a copy of the MPL was not distributed with this</span>
<a href="#l2.7"></a><span id="l2.7">  * file, You can obtain one at http://mozilla.org/MPL/2.0/. */</span>
<a href="#l2.8"></a><span id="l2.8"> </span>
<a href="#l2.9"></a><span id="l2.9"> Components.utils.import(&quot;resource://gre/modules/Services.jsm&quot;);</span>
<a href="#l2.10"></a><span id="l2.10" class="difflineplus">+Components.utils.import(&quot;resource://gre/modules/PluralForm.jsm&quot;);</span>
<a href="#l2.11"></a><span id="l2.11"> </span>
<a href="#l2.12"></a><span id="l2.12"> var gFilterListMsgWindow = null;</span>
<a href="#l2.13"></a><span id="l2.13"> var gCurrentFilterList;</span>
<a href="#l2.14"></a><span id="l2.14"> var gCurrentFolder;</span>
<a href="#l2.15"></a><span id="l2.15"> </span>
<a href="#l2.16"></a><span id="l2.16" class="difflineplus">+const msgMoveMotion = {</span>
<a href="#l2.17"></a><span id="l2.17" class="difflineplus">+  Up     : 0,</span>
<a href="#l2.18"></a><span id="l2.18" class="difflineplus">+  Down   : 1,</span>
<a href="#l2.19"></a><span id="l2.19" class="difflineplus">+  Top    : 2,</span>
<a href="#l2.20"></a><span id="l2.20" class="difflineplus">+  Bottom : 3</span>
<a href="#l2.21"></a><span id="l2.21" class="difflineplus">+}</span>
<a href="#l2.22"></a><span id="l2.22" class="difflineplus">+</span>
<a href="#l2.23"></a><span id="l2.23" class="difflineplus">+</span>
<a href="#l2.24"></a><span id="l2.24"> var gStatusFeedback = {</span>
<a href="#l2.25"></a><span id="l2.25">   progressMeterVisible : false,</span>
<a href="#l2.26"></a><span id="l2.26"> </span>
<a href="#l2.27"></a><span id="l2.27">   showStatusString: function(status)</span>
<a href="#l2.28"></a><span id="l2.28">   {</span>
<a href="#l2.29"></a><span id="l2.29">     document.getElementById(&quot;statusText&quot;).setAttribute(&quot;value&quot;, status);</span>
<a href="#l2.30"></a><span id="l2.30">   },</span>
<a href="#l2.31"></a><span id="l2.31">   startMeteors: function()</span>
<a href="#l2.32"></a><span id="l2.32" class="difflineat">@@ -75,48 +84,51 @@ function onLoad()</span>
<a href="#l2.33"></a><span id="l2.33">     gFilterListMsgWindow.domWindow = window;</span>
<a href="#l2.34"></a><span id="l2.34">     gFilterListMsgWindow.rootDocShell.appType = Components.interfaces.nsIDocShell.APP_TYPE_MAIL;</span>
<a href="#l2.35"></a><span id="l2.35">     gFilterListMsgWindow.statusFeedback = gStatusFeedback;</span>
<a href="#l2.36"></a><span id="l2.36"> </span>
<a href="#l2.37"></a><span id="l2.37">     updateButtons();</span>
<a href="#l2.38"></a><span id="l2.38"> </span>
<a href="#l2.39"></a><span id="l2.39">     // Get the folder where filters should be defined, if that server</span>
<a href="#l2.40"></a><span id="l2.40">     // can accept filters.</span>
<a href="#l2.41"></a><span id="l2.41" class="difflineminus">-    var firstItem = getFilterFolderForSelection();</span>
<a href="#l2.42"></a><span id="l2.42" class="difflineplus">+    let firstItem = getFilterFolderForSelection();</span>
<a href="#l2.43"></a><span id="l2.43"> </span>
<a href="#l2.44"></a><span id="l2.44" class="difflineminus">-    // if the selected server cannot have filters, get the default server</span>
<a href="#l2.45"></a><span id="l2.45" class="difflineminus">-    // if the default server cannot have filters, check all accounts</span>
<a href="#l2.46"></a><span id="l2.46" class="difflineplus">+    // If the selected server cannot have filters, get the default server</span>
<a href="#l2.47"></a><span id="l2.47" class="difflineplus">+    // If the default server cannot have filters, check all accounts</span>
<a href="#l2.48"></a><span id="l2.48">     // and get a server that can have filters.</span>
<a href="#l2.49"></a><span id="l2.49">     if (!firstItem)</span>
<a href="#l2.50"></a><span id="l2.50">         firstItem = getServerThatCanHaveFilters().rootFolder;</span>
<a href="#l2.51"></a><span id="l2.51"> </span>
<a href="#l2.52"></a><span id="l2.52">     if (firstItem) {</span>
<a href="#l2.53"></a><span id="l2.53">         selectFolder(firstItem);</span>
<a href="#l2.54"></a><span id="l2.54">     }</span>
<a href="#l2.55"></a><span id="l2.55"> </span>
<a href="#l2.56"></a><span id="l2.56">     Services.obs.addObserver(filterEditorQuitObserver,</span>
<a href="#l2.57"></a><span id="l2.57">                              &quot;quit-application-requested&quot;, false);</span>
<a href="#l2.58"></a><span id="l2.58"> }</span>
<a href="#l2.59"></a><span id="l2.59"> </span>
<a href="#l2.60"></a><span id="l2.60"> /**</span>
<a href="#l2.61"></a><span id="l2.61" class="difflineminus">- * Called when a user selects a folder in the list, so we can update the filters</span>
<a href="#l2.62"></a><span id="l2.62" class="difflineminus">- * that are displayed</span>
<a href="#l2.63"></a><span id="l2.63" class="difflineplus">+ * Called when a user selects a folder in the list, so we can update the </span>
<a href="#l2.64"></a><span id="l2.64" class="difflineplus">+ * filters that are displayed</span>
<a href="#l2.65"></a><span id="l2.65" class="difflineplus">+ * note the function name 'onFilterFolderClick' is misleading, it would be</span>
<a href="#l2.66"></a><span id="l2.66" class="difflineplus">+ * better named 'onServerSelect' =&gt; file follow up bug later.</span>
<a href="#l2.67"></a><span id="l2.67">  *</span>
<a href="#l2.68"></a><span id="l2.68">  * @param aFolder  the nsIMsgFolder that was selected</span>
<a href="#l2.69"></a><span id="l2.69">  */</span>
<a href="#l2.70"></a><span id="l2.70"> function onFilterFolderClick(aFolder)</span>
<a href="#l2.71"></a><span id="l2.71"> {</span>
<a href="#l2.72"></a><span id="l2.72">     if (!aFolder || aFolder == gCurrentFolder)</span>
<a href="#l2.73"></a><span id="l2.73">       return;</span>
<a href="#l2.74"></a><span id="l2.74"> </span>
<a href="#l2.75"></a><span id="l2.75">     // Save the current filters to disk before switching because</span>
<a href="#l2.76"></a><span id="l2.76">     // the dialog may be closed and we'll lose current filters.</span>
<a href="#l2.77"></a><span id="l2.77">     gCurrentFilterList.saveToDefaultFile();</span>
<a href="#l2.78"></a><span id="l2.78"> </span>
<a href="#l2.79"></a><span id="l2.79">     selectFolder(aFolder);</span>
<a href="#l2.80"></a><span id="l2.80" class="difflineplus">+    onFindFilter(false);</span>
<a href="#l2.81"></a><span id="l2.81"> }</span>
<a href="#l2.82"></a><span id="l2.82"> </span>
<a href="#l2.83"></a><span id="l2.83"> function CanRunFiltersAfterTheFact(aServer)</span>
<a href="#l2.84"></a><span id="l2.84"> {</span>
<a href="#l2.85"></a><span id="l2.85">   // filter after the fact is implement using search</span>
<a href="#l2.86"></a><span id="l2.86">   // so if you can't search, you can't filter after the fact</span>
<a href="#l2.87"></a><span id="l2.87">   return aServer.canSearchMessages;</span>
<a href="#l2.88"></a><span id="l2.88"> }</span>
<a href="#l2.89"></a><span id="l2.89" class="difflineat">@@ -165,16 +177,17 @@ function setFolder(msgFolder)</span>
<a href="#l2.90"></a><span id="l2.90">      document.getElementById(&quot;runFiltersFolder&quot;).setAttribute(&quot;hidden&quot;, &quot;true&quot;);</span>
<a href="#l2.91"></a><span id="l2.91">      document.getElementById(&quot;runFiltersButton&quot;).setAttribute(&quot;hidden&quot;, &quot;true&quot;);</span>
<a href="#l2.92"></a><span id="l2.92">      document.getElementById(&quot;folderPickerPrefix&quot;).setAttribute(&quot;hidden&quot;, &quot;true&quot;);</span>
<a href="#l2.93"></a><span id="l2.93">    }</span>
<a href="#l2.94"></a><span id="l2.94"> </span>
<a href="#l2.95"></a><span id="l2.95">    // Get the first folder for this server. INBOX for</span>
<a href="#l2.96"></a><span id="l2.96">    // imap and pop accts and 1st news group for news.</span>
<a href="#l2.97"></a><span id="l2.97">    updateButtons();</span>
<a href="#l2.98"></a><span id="l2.98" class="difflineplus">+   updateCountBox();</span>
<a href="#l2.99"></a><span id="l2.99"> }</span>
<a href="#l2.100"></a><span id="l2.100"> </span>
<a href="#l2.101"></a><span id="l2.101"> function toggleFilter(aFilter, aIndex)</span>
<a href="#l2.102"></a><span id="l2.102"> {</span>
<a href="#l2.103"></a><span id="l2.103">     if (aFilter.unparseable)</span>
<a href="#l2.104"></a><span id="l2.104">     {</span>
<a href="#l2.105"></a><span id="l2.105">       var bundle = document.getElementById(&quot;bundle_filter&quot;);</span>
<a href="#l2.106"></a><span id="l2.106">       var promptSvc = Components.classes[&quot;@mozilla.org/embedcomp/prompt-service;1&quot;]</span>
<a href="#l2.107"></a><span id="l2.107" class="difflineat">@@ -207,53 +220,71 @@ function currentFilter()</span>
<a href="#l2.108"></a><span id="l2.108"> </span>
<a href="#l2.109"></a><span id="l2.109"> function onEditFilter()</span>
<a href="#l2.110"></a><span id="l2.110"> {</span>
<a href="#l2.111"></a><span id="l2.111">   var selectedFilter = currentFilter();</span>
<a href="#l2.112"></a><span id="l2.112">   var args = {filter: selectedFilter, filterList: gCurrentFilterList};</span>
<a href="#l2.113"></a><span id="l2.113"> </span>
<a href="#l2.114"></a><span id="l2.114">   window.openDialog(&quot;chrome://messenger/content/FilterEditor.xul&quot;, &quot;FilterEditor&quot;, &quot;chrome,modal,titlebar,resizable,centerscreen&quot;, args);</span>
<a href="#l2.115"></a><span id="l2.115"> </span>
<a href="#l2.116"></a><span id="l2.116" class="difflineminus">-  if (&quot;refresh&quot; in args &amp;&amp; args.refresh)</span>
<a href="#l2.117"></a><span id="l2.117" class="difflineplus">+  if (&quot;refresh&quot; in args &amp;&amp; args.refresh) {</span>
<a href="#l2.118"></a><span id="l2.118" class="difflineplus">+    // reset search if edit was okay (name change might lead to hidden entry!)</span>
<a href="#l2.119"></a><span id="l2.119" class="difflineplus">+    document.getElementById(&quot;searchBox&quot;).value = &quot;&quot;;</span>
<a href="#l2.120"></a><span id="l2.120">     rebuildFilterList(gCurrentFilterList);</span>
<a href="#l2.121"></a><span id="l2.121" class="difflineplus">+  }</span>
<a href="#l2.122"></a><span id="l2.122"> }</span>
<a href="#l2.123"></a><span id="l2.123"> </span>
<a href="#l2.124"></a><span id="l2.124"> function onNewFilter(emailAddress)</span>
<a href="#l2.125"></a><span id="l2.125"> {</span>
<a href="#l2.126"></a><span id="l2.126">   let list = document.getElementById(&quot;filterList&quot;);</span>
<a href="#l2.127"></a><span id="l2.127">   let filterNodes = list.childNodes;</span>
<a href="#l2.128"></a><span id="l2.128">   let selectedFilter = currentFilter();</span>
<a href="#l2.129"></a><span id="l2.129">   // if no filter is selected use the first position, starting at 1</span>
<a href="#l2.130"></a><span id="l2.130">   let position = 1;</span>
<a href="#l2.131"></a><span id="l2.131">   if (selectedFilter) {</span>
<a href="#l2.132"></a><span id="l2.132" class="difflineplus">+    // Get the position in the unfiltered list.</span>
<a href="#l2.133"></a><span id="l2.133" class="difflineplus">+    // - this is where the new filter should be inserted!</span>
<a href="#l2.134"></a><span id="l2.134" class="difflineplus">+    rebuildFilterList(gCurrentFilterList);</span>
<a href="#l2.135"></a><span id="l2.135" class="difflineplus">+</span>
<a href="#l2.136"></a><span id="l2.136">     // The filterNodes[0] item is the list header, skip it.</span>
<a href="#l2.137"></a><span id="l2.137">     for (let i = 1; i &lt; filterNodes.length; i++) {</span>
<a href="#l2.138"></a><span id="l2.138">       if (filterNodes[i]._filter == selectedFilter) {</span>
<a href="#l2.139"></a><span id="l2.139">         position = i;</span>
<a href="#l2.140"></a><span id="l2.140">         break;</span>
<a href="#l2.141"></a><span id="l2.141">       }</span>
<a href="#l2.142"></a><span id="l2.142">     }</span>
<a href="#l2.143"></a><span id="l2.143">   }</span>
<a href="#l2.144"></a><span id="l2.144" class="difflineminus">-</span>
<a href="#l2.145"></a><span id="l2.145">   // The returned position is offset by 1 (due to the list header)</span>
<a href="#l2.146"></a><span id="l2.146">   // compared to filter indexes in gCurrentFilterList.</span>
<a href="#l2.147"></a><span id="l2.147">   let args = {filterList: gCurrentFilterList, filterPosition: position - 1};</span>
<a href="#l2.148"></a><span id="l2.148"> </span>
<a href="#l2.149"></a><span id="l2.149">   window.openDialog(&quot;chrome://messenger/content/FilterEditor.xul&quot;, &quot;FilterEditor&quot;, &quot;chrome,modal,titlebar,resizable,centerscreen&quot;, args);</span>
<a href="#l2.150"></a><span id="l2.150"> </span>
<a href="#l2.151"></a><span id="l2.151">   if (&quot;refresh&quot; in args &amp;&amp; args.refresh) {</span>
<a href="#l2.152"></a><span id="l2.152" class="difflineplus">+    // On success: reset the search box!</span>
<a href="#l2.153"></a><span id="l2.153" class="difflineplus">+    document.getElementById(&quot;searchBox&quot;).value = &quot;&quot;;</span>
<a href="#l2.154"></a><span id="l2.154">     rebuildFilterList(gCurrentFilterList);</span>
<a href="#l2.155"></a><span id="l2.155"> </span>
<a href="#l2.156"></a><span id="l2.156" class="difflineminus">-    // select the new filter, it is at the position of previous selection</span>
<a href="#l2.157"></a><span id="l2.157" class="difflineplus">+    // Select the new filter, it is at the position of previous selection.</span>
<a href="#l2.158"></a><span id="l2.158">     list.clearSelection();</span>
<a href="#l2.159"></a><span id="l2.159">     list.addItemToSelection(list.childNodes[position]);</span>
<a href="#l2.160"></a><span id="l2.160">     updateViewPosition(position);</span>
<a href="#l2.161"></a><span id="l2.161" class="difflineplus">+    updateCountBox();</span>
<a href="#l2.162"></a><span id="l2.162">   }</span>
<a href="#l2.163"></a><span id="l2.163" class="difflineplus">+  else {</span>
<a href="#l2.164"></a><span id="l2.164" class="difflineplus">+    // If no filter created, let's search again.</span>
<a href="#l2.165"></a><span id="l2.165" class="difflineplus">+    onFindFilter(false);</span>
<a href="#l2.166"></a><span id="l2.166" class="difflineplus">+  }</span>
<a href="#l2.167"></a><span id="l2.167" class="difflineplus">+</span>
<a href="#l2.168"></a><span id="l2.168"> }</span>
<a href="#l2.169"></a><span id="l2.169"> </span>
<a href="#l2.170"></a><span id="l2.170" class="difflineplus">+/**</span>
<a href="#l2.171"></a><span id="l2.171" class="difflineplus">+ * Delete selected filters.</span>
<a href="#l2.172"></a><span id="l2.172" class="difflineplus">+ *  'Selected' is not to be confused with active (checkbox checked)</span>
<a href="#l2.173"></a><span id="l2.173" class="difflineplus">+ */</span>
<a href="#l2.174"></a><span id="l2.174"> function onDeleteFilter()</span>
<a href="#l2.175"></a><span id="l2.175"> {</span>
<a href="#l2.176"></a><span id="l2.176">   let list = document.getElementById(&quot;filterList&quot;);</span>
<a href="#l2.177"></a><span id="l2.177">   let items = list.selectedItems;</span>
<a href="#l2.178"></a><span id="l2.178">   if (!items.length)</span>
<a href="#l2.179"></a><span id="l2.179">     return;</span>
<a href="#l2.180"></a><span id="l2.180"> </span>
<a href="#l2.181"></a><span id="l2.181">   let checkValue = {value:false};</span>
<a href="#l2.182"></a><span id="l2.182" class="difflineat">@@ -270,45 +301,156 @@ function onDeleteFilter()</span>
<a href="#l2.183"></a><span id="l2.183">                            '', '', '',</span>
<a href="#l2.184"></a><span id="l2.184">                            bundle.getString('dontWarnAboutDeleteCheckbox'),</span>
<a href="#l2.185"></a><span id="l2.185">                            checkValue)))</span>
<a href="#l2.186"></a><span id="l2.186">     return;</span>
<a href="#l2.187"></a><span id="l2.187"> </span>
<a href="#l2.188"></a><span id="l2.188">   if (checkValue.value)</span>
<a href="#l2.189"></a><span id="l2.189">      prefBranch.setBoolPref(&quot;mailnews.filters.confirm_delete&quot;, false);</span>
<a href="#l2.190"></a><span id="l2.190"> </span>
<a href="#l2.191"></a><span id="l2.191" class="difflineminus">-  // save filter position before the first selected one</span>
<a href="#l2.192"></a><span id="l2.192" class="difflineplus">+  // Save filter position before the first selected one.</span>
<a href="#l2.193"></a><span id="l2.193">   let newSelection = items[0].previousElementSibling;</span>
<a href="#l2.194"></a><span id="l2.194">   if (newSelection == list.childNodes[0])</span>
<a href="#l2.195"></a><span id="l2.195">     newSelection = null;</span>
<a href="#l2.196"></a><span id="l2.196"> </span>
<a href="#l2.197"></a><span id="l2.197" class="difflineminus">-  // must reverse the loop, as the items list shrinks when we delete</span>
<a href="#l2.198"></a><span id="l2.198" class="difflineplus">+  // Must reverse the loop, as the items list shrinks when we delete.</span>
<a href="#l2.199"></a><span id="l2.199">   for (let index = items.length - 1; index &gt;= 0; --index) {</span>
<a href="#l2.200"></a><span id="l2.200">     let item = items[index];</span>
<a href="#l2.201"></a><span id="l2.201">     gCurrentFilterList.removeFilter(item._filter);</span>
<a href="#l2.202"></a><span id="l2.202">     document.getElementById(&quot;filterList&quot;).removeChild(item);</span>
<a href="#l2.203"></a><span id="l2.203">   }</span>
<a href="#l2.204"></a><span id="l2.204"> </span>
<a href="#l2.205"></a><span id="l2.205" class="difflineminus">-  // select filter above previously selected if one existed, otherwise the first one</span>
<a href="#l2.206"></a><span id="l2.206" class="difflineplus">+  // Select filter above previously selected if one existed, otherwise the first one.</span>
<a href="#l2.207"></a><span id="l2.207">   if (!newSelection &amp;&amp; list.itemCount)</span>
<a href="#l2.208"></a><span id="l2.208">     newSelection = list.childNodes[1];</span>
<a href="#l2.209"></a><span id="l2.209">   if (newSelection) {</span>
<a href="#l2.210"></a><span id="l2.210">     list.addItemToSelection(newSelection);</span>
<a href="#l2.211"></a><span id="l2.211">     updateViewPosition(-1);</span>
<a href="#l2.212"></a><span id="l2.212">   }</span>
<a href="#l2.213"></a><span id="l2.213" class="difflineplus">+  updateCountBox();</span>
<a href="#l2.214"></a><span id="l2.214" class="difflineplus">+}</span>
<a href="#l2.215"></a><span id="l2.215" class="difflineplus">+</span>
<a href="#l2.216"></a><span id="l2.216" class="difflineplus">+/**</span>
<a href="#l2.217"></a><span id="l2.217" class="difflineplus">+ * Move filter one step up in visible list.</span>
<a href="#l2.218"></a><span id="l2.218" class="difflineplus">+ */</span>
<a href="#l2.219"></a><span id="l2.219" class="difflineplus">+function onUp(event) {</span>
<a href="#l2.220"></a><span id="l2.220" class="difflineplus">+  moveFilter(msgMoveMotion.Up);</span>
<a href="#l2.221"></a><span id="l2.221" class="difflineplus">+}</span>
<a href="#l2.222"></a><span id="l2.222" class="difflineplus">+</span>
<a href="#l2.223"></a><span id="l2.223" class="difflineplus">+/**</span>
<a href="#l2.224"></a><span id="l2.224" class="difflineplus">+ * Move filter one step down in visible list.</span>
<a href="#l2.225"></a><span id="l2.225" class="difflineplus">+ */</span>
<a href="#l2.226"></a><span id="l2.226" class="difflineplus">+function onDown(event) {</span>
<a href="#l2.227"></a><span id="l2.227" class="difflineplus">+  moveFilter(msgMoveMotion.Down);</span>
<a href="#l2.228"></a><span id="l2.228" class="difflineplus">+}</span>
<a href="#l2.229"></a><span id="l2.229" class="difflineplus">+</span>
<a href="#l2.230"></a><span id="l2.230" class="difflineplus">+/**</span>
<a href="#l2.231"></a><span id="l2.231" class="difflineplus">+ * Move filter to bottom for long filter lists.</span>
<a href="#l2.232"></a><span id="l2.232" class="difflineplus">+ */</span>
<a href="#l2.233"></a><span id="l2.233" class="difflineplus">+ function onTop(evt) {</span>
<a href="#l2.234"></a><span id="l2.234" class="difflineplus">+  moveFilter(msgMoveMotion.Top);</span>
<a href="#l2.235"></a><span id="l2.235" class="difflineplus">+}</span>
<a href="#l2.236"></a><span id="l2.236" class="difflineplus">+</span>
<a href="#l2.237"></a><span id="l2.237" class="difflineplus">+/**</span>
<a href="#l2.238"></a><span id="l2.238" class="difflineplus">+ * Move filter to top for long filter lists.</span>
<a href="#l2.239"></a><span id="l2.239" class="difflineplus">+ */</span>
<a href="#l2.240"></a><span id="l2.240" class="difflineplus">+function onBottom(evt) {</span>
<a href="#l2.241"></a><span id="l2.241" class="difflineplus">+  moveFilter(msgMoveMotion.Bottom);</span>
<a href="#l2.242"></a><span id="l2.242"> }</span>
<a href="#l2.243"></a><span id="l2.243"> </span>
<a href="#l2.244"></a><span id="l2.244" class="difflineminus">-function onUp(event)</span>
<a href="#l2.245"></a><span id="l2.245" class="difflineminus">-{</span>
<a href="#l2.246"></a><span id="l2.246" class="difflineminus">-    moveCurrentFilter(Components.interfaces.nsMsgFilterMotion.up);</span>
<a href="#l2.247"></a><span id="l2.247" class="difflineminus">-}</span>
<a href="#l2.248"></a><span id="l2.248" class="difflineplus">+/**</span>
<a href="#l2.249"></a><span id="l2.249" class="difflineplus">+ * Moves a singular selected filter up or down either 1 increment or to the </span>
<a href="#l2.250"></a><span id="l2.250" class="difflineplus">+ * top/bottom. This acts on the visible filter list only which means that:</span>
<a href="#l2.251"></a><span id="l2.251" class="difflineplus">+ *</span>
<a href="#l2.252"></a><span id="l2.252" class="difflineplus">+ * - when moving up or down &quot;1&quot; the filter may skip one or more other</span>
<a href="#l2.253"></a><span id="l2.253" class="difflineplus">+ *   filters (which are currently not visible) - this will also lead</span>
<a href="#l2.254"></a><span id="l2.254" class="difflineplus">+ *   to the &quot;related&quot; filters (e.g search filters containing 'moz')</span>
<a href="#l2.255"></a><span id="l2.255" class="difflineplus">+ *   being grouped more closely together</span>
<a href="#l2.256"></a><span id="l2.256" class="difflineplus">+ * - moveTop / moveBottom</span>
<a href="#l2.257"></a><span id="l2.257" class="difflineplus">+ *   this is currently moving to the top/bottom of the absolute list</span>
<a href="#l2.258"></a><span id="l2.258" class="difflineplus">+ *   but it would be better if it moved &quot;just as far as necessary&quot;</span>
<a href="#l2.259"></a><span id="l2.259" class="difflineplus">+ *   which would further &quot;compact&quot; related filters</span>
<a href="#l2.260"></a><span id="l2.260" class="difflineplus">+ *</span>
<a href="#l2.261"></a><span id="l2.261" class="difflineplus">+ * @param motion</span>
<a href="#l2.262"></a><span id="l2.262" class="difflineplus">+ *   msgMoveMotion.Up, msgMoveMotion.Down, msgMoveMotion.Top, msgMoveMotion.Bottom</span>
<a href="#l2.263"></a><span id="l2.263" class="difflineplus">+ */</span>
<a href="#l2.264"></a><span id="l2.264" class="difflineplus">+function moveFilter(motion) {</span>
<a href="#l2.265"></a><span id="l2.265" class="difflineplus">+  // At the moment, do not allow moving groups of filters.</span>
<a href="#l2.266"></a><span id="l2.266" class="difflineplus">+  var list = document.getElementById(&quot;filterList&quot;);</span>
<a href="#l2.267"></a><span id="l2.267" class="difflineplus">+  if (list.selectedItems.length != 1)</span>
<a href="#l2.268"></a><span id="l2.268" class="difflineplus">+    return;</span>
<a href="#l2.269"></a><span id="l2.269" class="difflineplus">+  var activeFilter = list.selectedItems[0]._filter;</span>
<a href="#l2.270"></a><span id="l2.270" class="difflineplus">+  var relativeStep = 0;</span>
<a href="#l2.271"></a><span id="l2.271" class="difflineplus">+  var moveFilterNative = null;</span>
<a href="#l2.272"></a><span id="l2.272"> </span>
<a href="#l2.273"></a><span id="l2.273" class="difflineminus">-function onDown(event)</span>
<a href="#l2.274"></a><span id="l2.274" class="difflineminus">-{</span>
<a href="#l2.275"></a><span id="l2.275" class="difflineminus">-    moveCurrentFilter(Components.interfaces.nsMsgFilterMotion.down);</span>
<a href="#l2.276"></a><span id="l2.276" class="difflineplus">+  switch(motion) {</span>
<a href="#l2.277"></a><span id="l2.277" class="difflineplus">+    case msgMoveMotion.Top:</span>
<a href="#l2.278"></a><span id="l2.278" class="difflineplus">+      if (activeFilter) {</span>
<a href="#l2.279"></a><span id="l2.279" class="difflineplus">+        gCurrentFilterList.removeFilter(activeFilter);</span>
<a href="#l2.280"></a><span id="l2.280" class="difflineplus">+        gCurrentFilterList.insertFilterAt(0, activeFilter);</span>
<a href="#l2.281"></a><span id="l2.281" class="difflineplus">+        rebuildFilterList(gCurrentFilterList);</span>
<a href="#l2.282"></a><span id="l2.282" class="difflineplus">+        onFindFilter(false); // re-filter list</span>
<a href="#l2.283"></a><span id="l2.283" class="difflineplus">+        document.getElementById(&quot;reorderTopButton&quot;).disabled = true;</span>
<a href="#l2.284"></a><span id="l2.284" class="difflineplus">+      }</span>
<a href="#l2.285"></a><span id="l2.285" class="difflineplus">+      return;</span>
<a href="#l2.286"></a><span id="l2.286" class="difflineplus">+    case msgMoveMotion.Bottom:</span>
<a href="#l2.287"></a><span id="l2.287" class="difflineplus">+      if (activeFilter) {</span>
<a href="#l2.288"></a><span id="l2.288" class="difflineplus">+        gCurrentFilterList.removeFilter(activeFilter);</span>
<a href="#l2.289"></a><span id="l2.289" class="difflineplus">+        gCurrentFilterList.insertFilterAt(gCurrentFilterList.filterCount, activeFilter);</span>
<a href="#l2.290"></a><span id="l2.290" class="difflineplus">+        rebuildFilterList(gCurrentFilterList);</span>
<a href="#l2.291"></a><span id="l2.291" class="difflineplus">+        onFindFilter(false);</span>
<a href="#l2.292"></a><span id="l2.292" class="difflineplus">+        document.getElementById(&quot;reorderBottomButton&quot;).disabled = true;</span>
<a href="#l2.293"></a><span id="l2.293" class="difflineplus">+      }</span>
<a href="#l2.294"></a><span id="l2.294" class="difflineplus">+      return;</span>
<a href="#l2.295"></a><span id="l2.295" class="difflineplus">+    case msgMoveMotion.Up:</span>
<a href="#l2.296"></a><span id="l2.296" class="difflineplus">+      relativeStep = -1;</span>
<a href="#l2.297"></a><span id="l2.297" class="difflineplus">+      moveFilterNative = Components.interfaces.nsMsgFilterMotion.up;</span>
<a href="#l2.298"></a><span id="l2.298" class="difflineplus">+      break;</span>
<a href="#l2.299"></a><span id="l2.299" class="difflineplus">+    case msgMoveMotion.Down:</span>
<a href="#l2.300"></a><span id="l2.300" class="difflineplus">+      relativeStep = +1;</span>
<a href="#l2.301"></a><span id="l2.301" class="difflineplus">+      moveFilterNative = Components.interfaces.nsMsgFilterMotion.down;</span>
<a href="#l2.302"></a><span id="l2.302" class="difflineplus">+      break;</span>
<a href="#l2.303"></a><span id="l2.303" class="difflineplus">+  }</span>
<a href="#l2.304"></a><span id="l2.304" class="difflineplus">+</span>
<a href="#l2.305"></a><span id="l2.305" class="difflineplus">+  var searchBox = document.getElementById(&quot;searchBox&quot;);</span>
<a href="#l2.306"></a><span id="l2.306" class="difflineplus">+  if (searchBox.value) {</span>
<a href="#l2.307"></a><span id="l2.307" class="difflineplus">+    if (activeFilter) {</span>
<a href="#l2.308"></a><span id="l2.308" class="difflineplus">+      let nextIndex = list.selectedIndex + relativeStep;</span>
<a href="#l2.309"></a><span id="l2.309" class="difflineplus">+      let nextFilter = list.getItemAtIndex(nextIndex)._filter;</span>
<a href="#l2.310"></a><span id="l2.310" class="difflineplus">+      rebuildFilterList(gCurrentFilterList);</span>
<a href="#l2.311"></a><span id="l2.311" class="difflineplus">+</span>
<a href="#l2.312"></a><span id="l2.312" class="difflineplus">+      // assumption: item stays selected even after removing the search condition</span>
<a href="#l2.313"></a><span id="l2.313" class="difflineplus">+      let newIndex = list.selectedIndex + relativeStep;</span>
<a href="#l2.314"></a><span id="l2.314" class="difflineplus">+      gCurrentFilterList.removeFilter(activeFilter);</span>
<a href="#l2.315"></a><span id="l2.315" class="difflineplus">+</span>
<a href="#l2.316"></a><span id="l2.316" class="difflineplus">+      // insert after/before next visible item</span>
<a href="#l2.317"></a><span id="l2.317" class="difflineplus">+      switch(motion) {</span>
<a href="#l2.318"></a><span id="l2.318" class="difflineplus">+        case msgMoveMotion.Up:</span>
<a href="#l2.319"></a><span id="l2.319" class="difflineplus">+          // go up from selected index until finding the correct filter name</span>
<a href="#l2.320"></a><span id="l2.320" class="difflineplus">+          while (nextFilter.filterName != list.getItemAtIndex(newIndex)._filter.filterName &amp;&amp; nextIndex &lt; list.itemCount)</span>
<a href="#l2.321"></a><span id="l2.321" class="difflineplus">+            newIndex--;</span>
<a href="#l2.322"></a><span id="l2.322" class="difflineplus">+          break;</span>
<a href="#l2.323"></a><span id="l2.323" class="difflineplus">+        case msgMoveMotion.Down:</span>
<a href="#l2.324"></a><span id="l2.324" class="difflineplus">+          // go down from selected index until finding the correct filter name</span>
<a href="#l2.325"></a><span id="l2.325" class="difflineplus">+          while (nextFilter.filterName != list.getItemAtIndex(newIndex)._filter.filterName &amp;&amp; nextIndex &lt; list.itemCount)</span>
<a href="#l2.326"></a><span id="l2.326" class="difflineplus">+            newIndex++;</span>
<a href="#l2.327"></a><span id="l2.327" class="difflineplus">+          break;</span>
<a href="#l2.328"></a><span id="l2.328" class="difflineplus">+        case msgMoveMotion.Top: break; // obsolete, dealt with above</span>
<a href="#l2.329"></a><span id="l2.329" class="difflineplus">+        case msgMoveMotion.Bottom: break; // obsolete, dealt with above</span>
<a href="#l2.330"></a><span id="l2.330" class="difflineplus">+      }</span>
<a href="#l2.331"></a><span id="l2.331" class="difflineplus">+      gCurrentFilterList.insertFilterAt(newIndex, activeFilter);</span>
<a href="#l2.332"></a><span id="l2.332" class="difflineplus">+      rebuildFilterList(gCurrentFilterList);</span>
<a href="#l2.333"></a><span id="l2.333" class="difflineplus">+      list.selectedIndex = newIndex;</span>
<a href="#l2.334"></a><span id="l2.334" class="difflineplus">+    }</span>
<a href="#l2.335"></a><span id="l2.335" class="difflineplus">+    onFindFilter(false);</span>
<a href="#l2.336"></a><span id="l2.336" class="difflineplus">+  }</span>
<a href="#l2.337"></a><span id="l2.337" class="difflineplus">+  else {</span>
<a href="#l2.338"></a><span id="l2.338" class="difflineplus">+    // use legacy move filter code: up, down; only if searchBox is empty</span>
<a href="#l2.339"></a><span id="l2.339" class="difflineplus">+    moveCurrentFilter(moveFilterNative);</span>
<a href="#l2.340"></a><span id="l2.340" class="difflineplus">+  }</span>
<a href="#l2.341"></a><span id="l2.341"> }</span>
<a href="#l2.342"></a><span id="l2.342"> </span>
<a href="#l2.343"></a><span id="l2.343"> function viewLog()</span>
<a href="#l2.344"></a><span id="l2.344"> {</span>
<a href="#l2.345"></a><span id="l2.345">   var args = {filterList: gCurrentFilterList};</span>
<a href="#l2.346"></a><span id="l2.346"> </span>
<a href="#l2.347"></a><span id="l2.347">   window.openDialog(&quot;chrome://messenger/content/viewLog.xul&quot;, &quot;FilterLog&quot;, &quot;chrome,modal,titlebar,resizable,centerscreen&quot;, args);</span>
<a href="#l2.348"></a><span id="l2.348"> }</span>
<a href="#l2.349"></a><span id="l2.349" class="difflineat">@@ -392,16 +534,17 @@ function rebuildFilterList(aFilterList)</span>
<a href="#l2.350"></a><span id="l2.350">   var list = document.getElementById(&quot;filterList&quot;);</span>
<a href="#l2.351"></a><span id="l2.351"> </span>
<a href="#l2.352"></a><span id="l2.352">   // Make a note of which filters were previously selected</span>
<a href="#l2.353"></a><span id="l2.353">   var selectedNames = [];</span>
<a href="#l2.354"></a><span id="l2.354">   for (var i = 0; i &lt; list.selectedItems.length; i++)</span>
<a href="#l2.355"></a><span id="l2.355">     selectedNames.push(list.selectedItems[i]._filter.filterName);</span>
<a href="#l2.356"></a><span id="l2.356"> </span>
<a href="#l2.357"></a><span id="l2.357">   // Save scroll position so we can try to restore it later.</span>
<a href="#l2.358"></a><span id="l2.358" class="difflineplus">+  // Doesn't work when the list is rebuilt after search box condition changed.</span>
<a href="#l2.359"></a><span id="l2.359">   let firstVisibleRowIndex = list.getIndexOfFirstVisibleRow();</span>
<a href="#l2.360"></a><span id="l2.360"> </span>
<a href="#l2.361"></a><span id="l2.361">   // Remove any existing child nodes, but not our headers</span>
<a href="#l2.362"></a><span id="l2.362">   for (var i = list.childNodes.length - 1; i &gt; 0; i--) {</span>
<a href="#l2.363"></a><span id="l2.363">     list.removeChild(list.childNodes[i]);</span>
<a href="#l2.364"></a><span id="l2.364">   }</span>
<a href="#l2.365"></a><span id="l2.365"> </span>
<a href="#l2.366"></a><span id="l2.366">   // listbox.xml seems to cache the value of the first selected item in a</span>
<a href="#l2.367"></a><span id="l2.367" class="difflineat">@@ -430,23 +573,25 @@ function rebuildFilterList(aFilterList)</span>
<a href="#l2.368"></a><span id="l2.368">     listitem.addEventListener(&quot;dblclick&quot;, onFilterDoubleClick, true);</span>
<a href="#l2.369"></a><span id="l2.369">     listitem._filter = filter;</span>
<a href="#l2.370"></a><span id="l2.370">     list.appendChild(listitem);</span>
<a href="#l2.371"></a><span id="l2.371"> </span>
<a href="#l2.372"></a><span id="l2.372">     if (selectedNames.indexOf(filter.filterName) != -1)</span>
<a href="#l2.373"></a><span id="l2.373">       list.addItemToSelection(listitem);</span>
<a href="#l2.374"></a><span id="l2.374">   }</span>
<a href="#l2.375"></a><span id="l2.375">   updateViewPosition(firstVisibleRowIndex);</span>
<a href="#l2.376"></a><span id="l2.376" class="difflineplus">+  updateCountBox();</span>
<a href="#l2.377"></a><span id="l2.377"> }</span>
<a href="#l2.378"></a><span id="l2.378"> </span>
<a href="#l2.379"></a><span id="l2.379"> function updateViewPosition(firstVisibleRowIndex)</span>
<a href="#l2.380"></a><span id="l2.380"> {</span>
<a href="#l2.381"></a><span id="l2.381">   let list = document.getElementById(&quot;filterList&quot;);</span>
<a href="#l2.382"></a><span id="l2.382">   if (firstVisibleRowIndex == -1)</span>
<a href="#l2.383"></a><span id="l2.383">     firstVisibleRowIndex = list.getIndexOfFirstVisibleRow();</span>
<a href="#l2.384"></a><span id="l2.384" class="difflineplus">+</span>
<a href="#l2.385"></a><span id="l2.385">   // Restore to the extent possible the scroll position.</span>
<a href="#l2.386"></a><span id="l2.386">   if (firstVisibleRowIndex &amp;&amp; list.itemCount)</span>
<a href="#l2.387"></a><span id="l2.387">     list.scrollToIndex(Math.min(firstVisibleRowIndex, list.itemCount - 1));</span>
<a href="#l2.388"></a><span id="l2.388"> </span>
<a href="#l2.389"></a><span id="l2.389">   if (list.selectedCount) {</span>
<a href="#l2.390"></a><span id="l2.390">     // Make sure that at least the first selected item is visible.</span>
<a href="#l2.391"></a><span id="l2.391">     list.ensureElementIsVisible(list.selectedItems[0]);</span>
<a href="#l2.392"></a><span id="l2.392"> </span>
<a href="#l2.393"></a><span id="l2.393" class="difflineat">@@ -454,54 +599,68 @@ function updateViewPosition(firstVisible</span>
<a href="#l2.394"></a><span id="l2.394">     // selection extension can work.</span>
<a href="#l2.395"></a><span id="l2.395">     list.currentItem = list.selectedItems[0];</span>
<a href="#l2.396"></a><span id="l2.396">   }</span>
<a href="#l2.397"></a><span id="l2.397"> </span>
<a href="#l2.398"></a><span id="l2.398">   updateButtons();</span>
<a href="#l2.399"></a><span id="l2.399">   list.focus();</span>
<a href="#l2.400"></a><span id="l2.400"> }</span>
<a href="#l2.401"></a><span id="l2.401"> </span>
<a href="#l2.402"></a><span id="l2.402" class="difflineplus">+/**</span>
<a href="#l2.403"></a><span id="l2.403" class="difflineplus">+ * Try to only enable buttons that make sense</span>
<a href="#l2.404"></a><span id="l2.404" class="difflineplus">+ *  - moving filters is currently only enabled for single selection</span>
<a href="#l2.405"></a><span id="l2.405" class="difflineplus">+ *    also movement is restricted by searchBox and current selection position</span>
<a href="#l2.406"></a><span id="l2.406" class="difflineplus">+ *  - edit only for single filters</span>
<a href="#l2.407"></a><span id="l2.407" class="difflineplus">+ *  - delete / run only for one or more selected filters</span>
<a href="#l2.408"></a><span id="l2.408" class="difflineplus">+ */</span>
<a href="#l2.409"></a><span id="l2.409"> function updateButtons()</span>
<a href="#l2.410"></a><span id="l2.410"> {</span>
<a href="#l2.411"></a><span id="l2.411">     var list = document.getElementById(&quot;filterList&quot;);</span>
<a href="#l2.412"></a><span id="l2.412">     var numFiltersSelected = list.selectedItems.length;</span>
<a href="#l2.413"></a><span id="l2.413">     var oneFilterSelected = (numFiltersSelected == 1);</span>
<a href="#l2.414"></a><span id="l2.414"> </span>
<a href="#l2.415"></a><span id="l2.415">     var filter = currentFilter();</span>
<a href="#l2.416"></a><span id="l2.416">     // &quot;edit&quot; only enabled when one filter selected or if we couldn't parse the filter</span>
<a href="#l2.417"></a><span id="l2.417">     var disabled = !oneFilterSelected || filter.unparseable</span>
<a href="#l2.418"></a><span id="l2.418">     document.getElementById(&quot;editButton&quot;).disabled = disabled;</span>
<a href="#l2.419"></a><span id="l2.419" class="difflineminus">-    </span>
<a href="#l2.420"></a><span id="l2.420" class="difflineplus">+</span>
<a href="#l2.421"></a><span id="l2.421">     // &quot;delete&quot; only disabled when no filters are selected</span>
<a href="#l2.422"></a><span id="l2.422">     document.getElementById(&quot;deleteButton&quot;).disabled = !numFiltersSelected;</span>
<a href="#l2.423"></a><span id="l2.423"> </span>
<a href="#l2.424"></a><span id="l2.424">     // we can run multiple filters on a folder</span>
<a href="#l2.425"></a><span id="l2.425">     // so only disable this UI if no filters are selected</span>
<a href="#l2.426"></a><span id="l2.426">     document.getElementById(&quot;folderPickerPrefix&quot;).disabled = !numFiltersSelected;</span>
<a href="#l2.427"></a><span id="l2.427">     document.getElementById(&quot;runFiltersFolder&quot;).disabled = !numFiltersSelected;</span>
<a href="#l2.428"></a><span id="l2.428">     document.getElementById(&quot;runFiltersButton&quot;).disabled = !numFiltersSelected;</span>
<a href="#l2.429"></a><span id="l2.429"> </span>
<a href="#l2.430"></a><span id="l2.430">     // &quot;up&quot; enabled only if one filter selected, and it's not the first</span>
<a href="#l2.431"></a><span id="l2.431">     // don't use list.currentIndex here, it's buggy when we've just changed the</span>
<a href="#l2.432"></a><span id="l2.432">     // children in the list (via rebuildFilterList)</span>
<a href="#l2.433"></a><span id="l2.433" class="difflineminus">-    var upDisabled = !(oneFilterSelected &amp;&amp; </span>
<a href="#l2.434"></a><span id="l2.434" class="difflineplus">+    var upDisabled = !(oneFilterSelected &amp;&amp;</span>
<a href="#l2.435"></a><span id="l2.435">                        list.selectedItems[0] != list.childNodes[1]);</span>
<a href="#l2.436"></a><span id="l2.436">     document.getElementById(&quot;reorderUpButton&quot;).disabled = upDisabled</span>
<a href="#l2.437"></a><span id="l2.437">     // &quot;down&quot; enabled only if one filter selected, and it's not the last</span>
<a href="#l2.438"></a><span id="l2.438">     var downDisabled = !(oneFilterSelected &amp;&amp; list.currentIndex &lt; list.getRowCount()-1);</span>
<a href="#l2.439"></a><span id="l2.439">     document.getElementById(&quot;reorderDownButton&quot;).disabled = downDisabled;</span>
<a href="#l2.440"></a><span id="l2.440" class="difflineplus">+</span>
<a href="#l2.441"></a><span id="l2.441" class="difflineplus">+    // special buttons</span>
<a href="#l2.442"></a><span id="l2.442" class="difflineplus">+    var buttonTop = document.getElementById(&quot;reorderTopButton&quot;);</span>
<a href="#l2.443"></a><span id="l2.443" class="difflineplus">+    var buttonBottom = document.getElementById(&quot;reorderBottomButton&quot;);</span>
<a href="#l2.444"></a><span id="l2.444" class="difflineplus">+</span>
<a href="#l2.445"></a><span id="l2.445" class="difflineplus">+    buttonTop.disabled = upDisabled;</span>
<a href="#l2.446"></a><span id="l2.446" class="difflineplus">+    buttonBottom.disabled = downDisabled;</span>
<a href="#l2.447"></a><span id="l2.447"> }</span>
<a href="#l2.448"></a><span id="l2.448"> </span>
<a href="#l2.449"></a><span id="l2.449"> /**</span>
<a href="#l2.450"></a><span id="l2.450" class="difflineminus">-  * Given a selected folder, returns the folder where filters should</span>
<a href="#l2.451"></a><span id="l2.451" class="difflineminus">-  *  be defined (the root folder except for news) if the server can</span>
<a href="#l2.452"></a><span id="l2.452" class="difflineminus">-  *  accept filters.</span>
<a href="#l2.453"></a><span id="l2.453" class="difflineminus">-  *</span>
<a href="#l2.454"></a><span id="l2.454" class="difflineminus">-  * @returns an nsIMsgFolder where the filter is defined</span>
<a href="#l2.455"></a><span id="l2.455" class="difflineminus">-  */</span>
<a href="#l2.456"></a><span id="l2.456" class="difflineplus">+ * Given a selected folder, returns the folder where filters should</span>
<a href="#l2.457"></a><span id="l2.457" class="difflineplus">+ *  be defined (the root folder except for news) if the server can</span>
<a href="#l2.458"></a><span id="l2.458" class="difflineplus">+ *  accept filters.</span>
<a href="#l2.459"></a><span id="l2.459" class="difflineplus">+ *</span>
<a href="#l2.460"></a><span id="l2.460" class="difflineplus">+ * @returns an nsIMsgFolder where the filter is defined</span>
<a href="#l2.461"></a><span id="l2.461" class="difflineplus">+ */</span>
<a href="#l2.462"></a><span id="l2.462"> function getFilterFolderForSelection()</span>
<a href="#l2.463"></a><span id="l2.463"> {</span>
<a href="#l2.464"></a><span id="l2.464">     var args = window.arguments;</span>
<a href="#l2.465"></a><span id="l2.465"> </span>
<a href="#l2.466"></a><span id="l2.466">     if (args &amp;&amp; args[0] &amp;&amp; args[0].folder)</span>
<a href="#l2.467"></a><span id="l2.467">     {</span>
<a href="#l2.468"></a><span id="l2.468">         var selectedFolder = args[0].folder;</span>
<a href="#l2.469"></a><span id="l2.469">         var msgFolder = selectedFolder.QueryInterface(Components.interfaces.nsIMsgFolder);</span>
<a href="#l2.470"></a><span id="l2.470" class="difflineat">@@ -518,22 +677,23 @@ function getFilterFolderForSelection()</span>
<a href="#l2.471"></a><span id="l2.471">         catch (ex)</span>
<a href="#l2.472"></a><span id="l2.472">         {</span>
<a href="#l2.473"></a><span id="l2.473">         }</span>
<a href="#l2.474"></a><span id="l2.474">     }</span>
<a href="#l2.475"></a><span id="l2.475"> </span>
<a href="#l2.476"></a><span id="l2.476">     return null;</span>
<a href="#l2.477"></a><span id="l2.477"> }</span>
<a href="#l2.478"></a><span id="l2.478"> </span>
<a href="#l2.479"></a><span id="l2.479" class="difflineminus">-/** if the selected server cannot have filters, get the default server</span>
<a href="#l2.480"></a><span id="l2.480" class="difflineminus">-  * if the default server cannot have filters, check all accounts</span>
<a href="#l2.481"></a><span id="l2.481" class="difflineminus">-  * and get a server that can have filters.</span>
<a href="#l2.482"></a><span id="l2.482" class="difflineminus">-  *</span>
<a href="#l2.483"></a><span id="l2.483" class="difflineminus">-  * @returns an nsIMsgIncomingServer</span>
<a href="#l2.484"></a><span id="l2.484" class="difflineminus">-  */</span>
<a href="#l2.485"></a><span id="l2.485" class="difflineplus">+/**</span>
<a href="#l2.486"></a><span id="l2.486" class="difflineplus">+ * If the selected server cannot have filters, get the default server.</span>
<a href="#l2.487"></a><span id="l2.487" class="difflineplus">+ * If the default server cannot have filters, check all accounts</span>
<a href="#l2.488"></a><span id="l2.488" class="difflineplus">+ * and get a server that can have filters.</span>
<a href="#l2.489"></a><span id="l2.489" class="difflineplus">+ *</span>
<a href="#l2.490"></a><span id="l2.490" class="difflineplus">+ * @returns an nsIMsgIncomingServer</span>
<a href="#l2.491"></a><span id="l2.491" class="difflineplus">+ */</span>
<a href="#l2.492"></a><span id="l2.492"> function getServerThatCanHaveFilters()</span>
<a href="#l2.493"></a><span id="l2.493"> {</span>
<a href="#l2.494"></a><span id="l2.494">     var firstItem = null;</span>
<a href="#l2.495"></a><span id="l2.495"> </span>
<a href="#l2.496"></a><span id="l2.496">     var accountManager</span>
<a href="#l2.497"></a><span id="l2.497">         = Components.classes[&quot;@mozilla.org/messenger/account-manager;1&quot;].</span>
<a href="#l2.498"></a><span id="l2.498">             getService(Components.interfaces.nsIMsgAccountManager);</span>
<a href="#l2.499"></a><span id="l2.499"> </span>
<a href="#l2.500"></a><span id="l2.500" class="difflineat">@@ -617,19 +777,19 @@ function onFilterListKeyPress(event)</span>
<a href="#l2.501"></a><span id="l2.501"> </span>
<a href="#l2.502"></a><span id="l2.502"> function onTargetSelect(event) {</span>
<a href="#l2.503"></a><span id="l2.503">   var menu = document.getElementById(&quot;runFiltersFolder&quot;);</span>
<a href="#l2.504"></a><span id="l2.504">   menu._folder = event.target._folder;</span>
<a href="#l2.505"></a><span id="l2.505">   menu.setAttribute(&quot;label&quot;, event.target._folder.prettyName);</span>
<a href="#l2.506"></a><span id="l2.506"> }</span>
<a href="#l2.507"></a><span id="l2.507"> </span>
<a href="#l2.508"></a><span id="l2.508"> /**</span>
<a href="#l2.509"></a><span id="l2.509" class="difflineminus">-  * For a given server folder, get the first folder. For imap and pop it's INBOX</span>
<a href="#l2.510"></a><span id="l2.510" class="difflineminus">-  * and it's the very first group for news accounts.</span>
<a href="#l2.511"></a><span id="l2.511" class="difflineminus">-  */</span>
<a href="#l2.512"></a><span id="l2.512" class="difflineplus">+ * For a given server folder, get the first folder. For imap and pop it's INBOX</span>
<a href="#l2.513"></a><span id="l2.513" class="difflineplus">+ * and it's the very first group for news accounts.</span>
<a href="#l2.514"></a><span id="l2.514" class="difflineplus">+ */</span>
<a href="#l2.515"></a><span id="l2.515"> function getFirstFolder(msgFolder)</span>
<a href="#l2.516"></a><span id="l2.516"> {</span>
<a href="#l2.517"></a><span id="l2.517">   // Sanity check.</span>
<a href="#l2.518"></a><span id="l2.518">   if (! msgFolder.isServer)</span>
<a href="#l2.519"></a><span id="l2.519">     return msgFolder;</span>
<a href="#l2.520"></a><span id="l2.520"> </span>
<a href="#l2.521"></a><span id="l2.521">   try {</span>
<a href="#l2.522"></a><span id="l2.522">     // Find Inbox for imap and pop</span>
<a href="#l2.523"></a><span id="l2.523" class="difflineat">@@ -647,8 +807,73 @@ function getFirstFolder(msgFolder)</span>
<a href="#l2.524"></a><span id="l2.524">       // XXX TODO: For news, we should find the 1st group/folder off the news groups. For now use server.</span>
<a href="#l2.525"></a><span id="l2.525">       return msgFolder;</span>
<a href="#l2.526"></a><span id="l2.526">   }</span>
<a href="#l2.527"></a><span id="l2.527">   catch (ex) {</span>
<a href="#l2.528"></a><span id="l2.528">     dump(ex + &quot;\n&quot;);</span>
<a href="#l2.529"></a><span id="l2.529">   }</span>
<a href="#l2.530"></a><span id="l2.530">   return msgFolder;</span>
<a href="#l2.531"></a><span id="l2.531"> }</span>
<a href="#l2.532"></a><span id="l2.532" class="difflineplus">+</span>
<a href="#l2.533"></a><span id="l2.533" class="difflineplus">+</span>
<a href="#l2.534"></a><span id="l2.534" class="difflineplus">+</span>
<a href="#l2.535"></a><span id="l2.535" class="difflineplus">+/**</span>
<a href="#l2.536"></a><span id="l2.536" class="difflineplus">+ * Called when the search button is clicked, this will narrow down the amount</span>
<a href="#l2.537"></a><span id="l2.537" class="difflineplus">+ * of filters displayed in the list, using the search term to filter the names</span>
<a href="#l2.538"></a><span id="l2.538" class="difflineplus">+ *</span>
<a href="#l2.539"></a><span id="l2.539" class="difflineplus">+ * @param focusSearchBox  if called from the button click event, return to searchbox</span>
<a href="#l2.540"></a><span id="l2.540" class="difflineplus">+ */</span>
<a href="#l2.541"></a><span id="l2.541" class="difflineplus">+function onFindFilter(focusSearchBox)</span>
<a href="#l2.542"></a><span id="l2.542" class="difflineplus">+{</span>
<a href="#l2.543"></a><span id="l2.543" class="difflineplus">+  let searchBox = document.getElementById(&quot;searchBox&quot;);</span>
<a href="#l2.544"></a><span id="l2.544" class="difflineplus">+  let filterList = document.getElementById(&quot;filterList&quot;);</span>
<a href="#l2.545"></a><span id="l2.545" class="difflineplus">+  let keyWord = searchBox.value.toLocaleLowerCase();</span>
<a href="#l2.546"></a><span id="l2.546" class="difflineplus">+</span>
<a href="#l2.547"></a><span id="l2.547" class="difflineplus">+  // simplest case: if filter was added or removed and searchbox is empty</span>
<a href="#l2.548"></a><span id="l2.548" class="difflineplus">+  if (!keyWord &amp;&amp; !focusSearchBox) {</span>
<a href="#l2.549"></a><span id="l2.549" class="difflineplus">+    updateCountBox();</span>
<a href="#l2.550"></a><span id="l2.550" class="difflineplus">+    return;</span>
<a href="#l2.551"></a><span id="l2.551" class="difflineplus">+  }</span>
<a href="#l2.552"></a><span id="l2.552" class="difflineplus">+  rebuildFilterList(gCurrentFilterList); // creates the unfiltered list</span>
<a href="#l2.553"></a><span id="l2.553" class="difflineplus">+  if (!keyWord) {</span>
<a href="#l2.554"></a><span id="l2.554" class="difflineplus">+    if (focusSearchBox)</span>
<a href="#l2.555"></a><span id="l2.555" class="difflineplus">+      searchBox.focus();</span>
<a href="#l2.556"></a><span id="l2.556" class="difflineplus">+    updateCountBox();</span>
<a href="#l2.557"></a><span id="l2.557" class="difflineplus">+    return;</span>
<a href="#l2.558"></a><span id="l2.558" class="difflineplus">+  }</span>
<a href="#l2.559"></a><span id="l2.559" class="difflineplus">+</span>
<a href="#l2.560"></a><span id="l2.560" class="difflineplus">+  // rematch everything in the list, remove what doesn't match the search box</span>
<a href="#l2.561"></a><span id="l2.561" class="difflineplus">+  let rows = filterList.getRowCount();</span>
<a href="#l2.562"></a><span id="l2.562" class="difflineplus">+</span>
<a href="#l2.563"></a><span id="l2.563" class="difflineplus">+  for(let i = rows - 1; i &gt;= 0; i--) {</span>
<a href="#l2.564"></a><span id="l2.564" class="difflineplus">+    let matched = true;</span>
<a href="#l2.565"></a><span id="l2.565" class="difflineplus">+    let item = filterList.getItemAtIndex(i);</span>
<a href="#l2.566"></a><span id="l2.566" class="difflineplus">+    let title = item.firstChild.getAttribute(&quot;label&quot;);</span>
<a href="#l2.567"></a><span id="l2.567" class="difflineplus">+    if (title.toLocaleLowerCase().indexOf(keyWord) == -1)</span>
<a href="#l2.568"></a><span id="l2.568" class="difflineplus">+    {</span>
<a href="#l2.569"></a><span id="l2.569" class="difflineplus">+      matched = false;</span>
<a href="#l2.570"></a><span id="l2.570" class="difflineplus">+      filterList.removeChild(item);</span>
<a href="#l2.571"></a><span id="l2.571" class="difflineplus">+    }</span>
<a href="#l2.572"></a><span id="l2.572" class="difflineplus">+  }</span>
<a href="#l2.573"></a><span id="l2.573" class="difflineplus">+  updateCountBox();</span>
<a href="#l2.574"></a><span id="l2.574" class="difflineplus">+  if (focusSearchBox)</span>
<a href="#l2.575"></a><span id="l2.575" class="difflineplus">+    searchBox.focus();</span>
<a href="#l2.576"></a><span id="l2.576" class="difflineplus">+}</span>
<a href="#l2.577"></a><span id="l2.577" class="difflineplus">+</span>
<a href="#l2.578"></a><span id="l2.578" class="difflineplus">+/**</span>
<a href="#l2.579"></a><span id="l2.579" class="difflineplus">+ * Display &quot;1 item&quot;,  &quot;11 items&quot; or &quot;4 of 10&quot; if list is filtered via search box.</span>
<a href="#l2.580"></a><span id="l2.580" class="difflineplus">+ */</span>
<a href="#l2.581"></a><span id="l2.581" class="difflineplus">+function updateCountBox()</span>
<a href="#l2.582"></a><span id="l2.582" class="difflineplus">+{</span>
<a href="#l2.583"></a><span id="l2.583" class="difflineplus">+  let countBox = document.getElementById(&quot;countBox&quot;);</span>
<a href="#l2.584"></a><span id="l2.584" class="difflineplus">+  let sum = gCurrentFilterList.filterCount;</span>
<a href="#l2.585"></a><span id="l2.585" class="difflineplus">+  let filterList = document.getElementById(&quot;filterList&quot;);</span>
<a href="#l2.586"></a><span id="l2.586" class="difflineplus">+  let len = filterList.getRowCount();</span>
<a href="#l2.587"></a><span id="l2.587" class="difflineplus">+</span>
<a href="#l2.588"></a><span id="l2.588" class="difflineplus">+  let bundle = document.getElementById(&quot;bundle_filter&quot;);</span>
<a href="#l2.589"></a><span id="l2.589" class="difflineplus">+</span>
<a href="#l2.590"></a><span id="l2.590" class="difflineplus">+  if (len == sum) // &quot;N items&quot;</span>
<a href="#l2.591"></a><span id="l2.591" class="difflineplus">+    countBox.value = PluralForm.get(len, bundle.getString(&quot;filterCountItems&quot;))</span>
<a href="#l2.592"></a><span id="l2.592" class="difflineplus">+                               .replace(&quot;#1&quot;,[len]);</span>
<a href="#l2.593"></a><span id="l2.593" class="difflineplus">+  else // &quot;N of M&quot;</span>
<a href="#l2.594"></a><span id="l2.594" class="difflineplus">+    countBox.value = bundle.getFormattedString(&quot;filterCountVisibleOfTotal&quot;, [len, sum]);</span>
<a href="#l2.595"></a><span id="l2.595" class="difflineplus">+}</span>
<a href="#l2.596"></a><span id="l2.596" class="difflineplus">+</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l3.1"></a><span id="l3.1" class="difflineminus">--- a/mail/base/content/FilterListDialog.xul</span>
<a href="#l3.2"></a><span id="l3.2" class="difflineplus">+++ b/mail/base/content/FilterListDialog.xul</span>
<a href="#l3.3"></a><span id="l3.3" class="difflineat">@@ -31,109 +31,141 @@</span>
<a href="#l3.4"></a><span id="l3.4">   &lt;keyset id=&quot;dialogKeys&quot;/&gt;</span>
<a href="#l3.5"></a><span id="l3.5"> </span>
<a href="#l3.6"></a><span id="l3.6">   &lt;keyset&gt;</span>
<a href="#l3.7"></a><span id="l3.7">     &lt;key key=&quot;&amp;closeCmd.key;&quot; modifiers=&quot;accel&quot; oncommand=&quot;if (onFilterClose()) window.close();&quot;/&gt;</span>
<a href="#l3.8"></a><span id="l3.8">     &lt;key keycode=&quot;VK_ESCAPE&quot; oncommand=&quot;if (onFilterClose()) window.close();&quot;/&gt;</span>
<a href="#l3.9"></a><span id="l3.9">   &lt;/keyset&gt;</span>
<a href="#l3.10"></a><span id="l3.10"> </span>
<a href="#l3.11"></a><span id="l3.11">   &lt;hbox align=&quot;center&quot;&gt;</span>
<a href="#l3.12"></a><span id="l3.12" class="difflineminus">-    &lt;label value=&quot;&amp;filtersForPrefix.label;&quot; </span>
<a href="#l3.13"></a><span id="l3.13" class="difflineplus">+    &lt;label value=&quot;&amp;filtersForPrefix.label;&quot;</span>
<a href="#l3.14"></a><span id="l3.14">            accesskey=&quot;&amp;filtersForPrefix.accesskey;&quot; control=&quot;serverMenu&quot;/&gt;</span>
<a href="#l3.15"></a><span id="l3.15"> </span>
<a href="#l3.16"></a><span id="l3.16" class="difflineminus">-      &lt;menulist id=&quot;serverMenu&quot;</span>
<a href="#l3.17"></a><span id="l3.17" class="difflineminus">-                class=&quot;folderMenuItem&quot;</span>
<a href="#l3.18"></a><span id="l3.18" class="difflineminus">-                IsServer=&quot;true&quot;</span>
<a href="#l3.19"></a><span id="l3.19" class="difflineminus">-                IsSecure=&quot;false&quot;</span>
<a href="#l3.20"></a><span id="l3.20" class="difflineminus">-                ServerType=&quot;none&quot;</span>
<a href="#l3.21"></a><span id="l3.21" class="difflineminus">-                oncommand=&quot;onFilterFolderClick(event.target._folder);&quot;&gt;</span>
<a href="#l3.22"></a><span id="l3.22" class="difflineminus">-        &lt;menupopup id=&quot;serverMenuPopup&quot; type=&quot;folder&quot; mode=&quot;filters&quot;</span>
<a href="#l3.23"></a><span id="l3.23" class="difflineminus">-          expandFolders=&quot;nntp&quot; headlabels=&quot;&amp;choosethisnewsserver.label;&quot; /&gt;</span>
<a href="#l3.24"></a><span id="l3.24" class="difflineminus">-      &lt;/menulist&gt;</span>
<a href="#l3.25"></a><span id="l3.25" class="difflineminus">-      &lt;spacer flex=&quot;1&quot;/&gt; </span>
<a href="#l3.26"></a><span id="l3.26" class="difflineminus">-      &lt;vbox&gt;</span>
<a href="#l3.27"></a><span id="l3.27" class="difflineminus">-        &lt;button label=&quot;&amp;viewLogButton.label;&quot; accesskey=&quot;&amp;viewLogButton.accesskey;&quot; oncommand=&quot;viewLog();&quot;/&gt;</span>
<a href="#l3.28"></a><span id="l3.28" class="difflineminus">-      &lt;/vbox&gt;</span>
<a href="#l3.29"></a><span id="l3.29" class="difflineplus">+    &lt;menulist id=&quot;serverMenu&quot;</span>
<a href="#l3.30"></a><span id="l3.30" class="difflineplus">+              class=&quot;folderMenuItem&quot;</span>
<a href="#l3.31"></a><span id="l3.31" class="difflineplus">+              IsServer=&quot;true&quot;</span>
<a href="#l3.32"></a><span id="l3.32" class="difflineplus">+              IsSecure=&quot;false&quot;</span>
<a href="#l3.33"></a><span id="l3.33" class="difflineplus">+              ServerType=&quot;none&quot;</span>
<a href="#l3.34"></a><span id="l3.34" class="difflineplus">+              oncommand=&quot;onFilterFolderClick(event.target._folder);&quot;&gt;</span>
<a href="#l3.35"></a><span id="l3.35" class="difflineplus">+      &lt;menupopup id=&quot;serverMenuPopup&quot; type=&quot;folder&quot; mode=&quot;filters&quot;</span>
<a href="#l3.36"></a><span id="l3.36" class="difflineplus">+                 expandFolders=&quot;nntp&quot; headlabels=&quot;&amp;choosethisnewsserver.label;&quot;/&gt;</span>
<a href="#l3.37"></a><span id="l3.37" class="difflineplus">+    &lt;/menulist&gt;</span>
<a href="#l3.38"></a><span id="l3.38" class="difflineplus">+    &lt;textbox id=&quot;searchBox&quot;</span>
<a href="#l3.39"></a><span id="l3.39" class="difflineplus">+             flex=&quot;1&quot;</span>
<a href="#l3.40"></a><span id="l3.40" class="difflineplus">+             type=&quot;search&quot;</span>
<a href="#l3.41"></a><span id="l3.41" class="difflineplus">+             oncommand=&quot;onFindFilter(true);&quot;</span>
<a href="#l3.42"></a><span id="l3.42" class="difflineplus">+             emptytext=&quot;&amp;searchBox.emptyText;&quot;</span>
<a href="#l3.43"></a><span id="l3.43" class="difflineplus">+             isempty=&quot;true&quot;/&gt;</span>
<a href="#l3.44"></a><span id="l3.44">   &lt;/hbox&gt;</span>
<a href="#l3.45"></a><span id="l3.45"> </span>
<a href="#l3.46"></a><span id="l3.46">   &lt;grid flex=&quot;1&quot;&gt;</span>
<a href="#l3.47"></a><span id="l3.47">     &lt;columns&gt;</span>
<a href="#l3.48"></a><span id="l3.48">       &lt;column flex=&quot;1&quot;/&gt;</span>
<a href="#l3.49"></a><span id="l3.49">       &lt;column/&gt;</span>
<a href="#l3.50"></a><span id="l3.50">     &lt;/columns&gt;</span>
<a href="#l3.51"></a><span id="l3.51">     &lt;rows&gt;</span>
<a href="#l3.52"></a><span id="l3.52">       &lt;row&gt;</span>
<a href="#l3.53"></a><span id="l3.53">         &lt;separator class=&quot;thin&quot;/&gt;</span>
<a href="#l3.54"></a><span id="l3.54">       &lt;/row&gt;</span>
<a href="#l3.55"></a><span id="l3.55">       &lt;row&gt;</span>
<a href="#l3.56"></a><span id="l3.56" class="difflineminus">-        &lt;label control=&quot;filterTree&quot;&gt;&amp;filterHeader.label;&lt;/label&gt;</span>
<a href="#l3.57"></a><span id="l3.57" class="difflineplus">+        &lt;hbox&gt;</span>
<a href="#l3.58"></a><span id="l3.58" class="difflineplus">+          &lt;label id=&quot;filterListLabel&quot;</span>
<a href="#l3.59"></a><span id="l3.59" class="difflineplus">+                 control=&quot;filterList&quot;</span>
<a href="#l3.60"></a><span id="l3.60" class="difflineplus">+                 value=&quot;&amp;filterHeader.label;&quot;</span>
<a href="#l3.61"></a><span id="l3.61" class="difflineplus">+                 crop=&quot;end&quot;</span>
<a href="#l3.62"></a><span id="l3.62" class="difflineplus">+                 flex=&quot;1&quot;/&gt;</span>
<a href="#l3.63"></a><span id="l3.63" class="difflineplus">+          &lt;label id=&quot;countBox&quot;/&gt;</span>
<a href="#l3.64"></a><span id="l3.64" class="difflineplus">+        &lt;/hbox&gt;</span>
<a href="#l3.65"></a><span id="l3.65">       &lt;/row&gt;</span>
<a href="#l3.66"></a><span id="l3.66"> </span>
<a href="#l3.67"></a><span id="l3.67">       &lt;row flex=&quot;1&quot;&gt;</span>
<a href="#l3.68"></a><span id="l3.68">         &lt;vbox&gt;</span>
<a href="#l3.69"></a><span id="l3.69">           &lt;listbox id=&quot;filterList&quot; flex=&quot;1&quot; onselect=&quot;updateButtons();&quot;</span>
<a href="#l3.70"></a><span id="l3.70">                    seltype=&quot;multiple&quot;</span>
<a href="#l3.71"></a><span id="l3.71">                    onkeypress=&quot;onFilterListKeyPress(event);&quot;&gt;</span>
<a href="#l3.72"></a><span id="l3.72">             &lt;listhead&gt;</span>
<a href="#l3.73"></a><span id="l3.73">               &lt;listheader id=&quot;nameColumn&quot; label=&quot;&amp;nameColumn.label;&quot; flex=&quot;1&quot;/&gt;</span>
<a href="#l3.74"></a><span id="l3.74">               &lt;listheader id=&quot;activeColumn&quot; label=&quot;&amp;activeColumn.label;&quot; minwidth=&quot;40px&quot;/&gt;</span>
<a href="#l3.75"></a><span id="l3.75">             &lt;/listhead&gt;</span>
<a href="#l3.76"></a><span id="l3.76">           &lt;/listbox&gt;</span>
<a href="#l3.77"></a><span id="l3.77">         &lt;/vbox&gt;</span>
<a href="#l3.78"></a><span id="l3.78"> </span>
<a href="#l3.79"></a><span id="l3.79">         &lt;vbox&gt;</span>
<a href="#l3.80"></a><span id="l3.80" class="difflineminus">-          &lt;button id=&quot;newButton&quot; label=&quot;&amp;newButton.label;&quot; accesskey=&quot;&amp;newButton.accesskey;&quot;</span>
<a href="#l3.81"></a><span id="l3.81" class="difflineplus">+          &lt;button id=&quot;newButton&quot;</span>
<a href="#l3.82"></a><span id="l3.82" class="difflineplus">+                  label=&quot;&amp;newButton.label;&quot;</span>
<a href="#l3.83"></a><span id="l3.83" class="difflineplus">+                  accesskey=&quot;&amp;newButton.accesskey;&quot;</span>
<a href="#l3.84"></a><span id="l3.84">                   oncommand=&quot;onNewFilter(null);&quot;/&gt;</span>
<a href="#l3.85"></a><span id="l3.85" class="difflineminus">-          &lt;button id=&quot;editButton&quot; label=&quot;&amp;editButton.label;&quot; accesskey=&quot;&amp;editButton.accesskey;&quot; </span>
<a href="#l3.86"></a><span id="l3.86" class="difflineplus">+          &lt;button id=&quot;editButton&quot; label=&quot;&amp;editButton.label;&quot;</span>
<a href="#l3.87"></a><span id="l3.87" class="difflineplus">+                  accesskey=&quot;&amp;editButton.accesskey;&quot;</span>
<a href="#l3.88"></a><span id="l3.88">                   oncommand=&quot;onEditFilter();&quot;/&gt;</span>
<a href="#l3.89"></a><span id="l3.89" class="difflineminus">-          &lt;button id=&quot;deleteButton&quot; label=&quot;&amp;deleteButton.label;&quot; accesskey=&quot;&amp;deleteButton.accesskey;&quot; </span>
<a href="#l3.90"></a><span id="l3.90" class="difflineplus">+          &lt;button id=&quot;deleteButton&quot;</span>
<a href="#l3.91"></a><span id="l3.91" class="difflineplus">+                  label=&quot;&amp;deleteButton.label;&quot;</span>
<a href="#l3.92"></a><span id="l3.92" class="difflineplus">+                  accesskey=&quot;&amp;deleteButton.accesskey;&quot;</span>
<a href="#l3.93"></a><span id="l3.93">                   oncommand=&quot;onDeleteFilter();&quot;/&gt;</span>
<a href="#l3.94"></a><span id="l3.94">           &lt;spacer flex=&quot;1&quot;/&gt;</span>
<a href="#l3.95"></a><span id="l3.95" class="difflineminus">-          &lt;button id=&quot;reorderUpButton&quot; label=&quot;&amp;reorderUpButton.label;&quot; accesskey=&quot;&amp;reorderUpButton.accesskey;&quot; </span>
<a href="#l3.96"></a><span id="l3.96" class="difflineplus">+          &lt;button id=&quot;reorderTopButton&quot;</span>
<a href="#l3.97"></a><span id="l3.97" class="difflineplus">+                  label=&quot;&amp;reorderTopButton;&quot;</span>
<a href="#l3.98"></a><span id="l3.98" class="difflineplus">+                  accesskey=&quot;&amp;reorderTopButton.accessKey;&quot;</span>
<a href="#l3.99"></a><span id="l3.99" class="difflineplus">+                  tooltiptext=&quot;&amp;reorderTopButton.toolTip;&quot;</span>
<a href="#l3.100"></a><span id="l3.100" class="difflineplus">+                  oncommand=&quot;onTop(event);&quot;/&gt;</span>
<a href="#l3.101"></a><span id="l3.101" class="difflineplus">+          &lt;button id=&quot;reorderUpButton&quot;</span>
<a href="#l3.102"></a><span id="l3.102" class="difflineplus">+                  label=&quot;&amp;reorderUpButton.label;&quot;</span>
<a href="#l3.103"></a><span id="l3.103" class="difflineplus">+                  accesskey=&quot;&amp;reorderUpButton.accesskey;&quot;</span>
<a href="#l3.104"></a><span id="l3.104">                   class=&quot;up&quot;</span>
<a href="#l3.105"></a><span id="l3.105">                   oncommand=&quot;onUp(event);&quot;/&gt;</span>
<a href="#l3.106"></a><span id="l3.106" class="difflineminus">-          &lt;button id=&quot;reorderDownButton&quot; label=&quot;&amp;reorderDownButton.label;&quot; accesskey=&quot;&amp;reorderDownButton.accesskey;&quot; </span>
<a href="#l3.107"></a><span id="l3.107" class="difflineplus">+          &lt;button id=&quot;reorderDownButton&quot;</span>
<a href="#l3.108"></a><span id="l3.108" class="difflineplus">+                  label=&quot;&amp;reorderDownButton.label;&quot;</span>
<a href="#l3.109"></a><span id="l3.109" class="difflineplus">+                  accesskey=&quot;&amp;reorderDownButton.accesskey;&quot;</span>
<a href="#l3.110"></a><span id="l3.110">                   class=&quot;down&quot;</span>
<a href="#l3.111"></a><span id="l3.111">                   oncommand=&quot;onDown(event);&quot;/&gt;</span>
<a href="#l3.112"></a><span id="l3.112" class="difflineplus">+          &lt;button id=&quot;reorderBottomButton&quot;</span>
<a href="#l3.113"></a><span id="l3.113" class="difflineplus">+                  label=&quot;&amp;reorderBottomButton;&quot;</span>
<a href="#l3.114"></a><span id="l3.114" class="difflineplus">+                  accesskey=&quot;&amp;reorderBottomButton.accessKey;&quot;</span>
<a href="#l3.115"></a><span id="l3.115" class="difflineplus">+                  tooltiptext=&quot;&amp;reorderBottomButton.toolTip;&quot;</span>
<a href="#l3.116"></a><span id="l3.116" class="difflineplus">+                  oncommand=&quot;onBottom(event);&quot;/&gt;</span>
<a href="#l3.117"></a><span id="l3.117">           &lt;spacer flex=&quot;1&quot;/&gt;</span>
<a href="#l3.118"></a><span id="l3.118">         &lt;/vbox&gt;</span>
<a href="#l3.119"></a><span id="l3.119">       &lt;/row&gt;</span>
<a href="#l3.120"></a><span id="l3.120">       &lt;row&gt;</span>
<a href="#l3.121"></a><span id="l3.121">         &lt;vbox&gt;</span>
<a href="#l3.122"></a><span id="l3.122">           &lt;separator class=&quot;thin&quot;/&gt;</span>
<a href="#l3.123"></a><span id="l3.123">           &lt;hbox align=&quot;center&quot;&gt;</span>
<a href="#l3.124"></a><span id="l3.124" class="difflineminus">-            &lt;label id=&quot;folderPickerPrefix&quot; value=&quot;&amp;folderPickerPrefix.label;&quot; </span>
<a href="#l3.125"></a><span id="l3.125" class="difflineplus">+            &lt;label id=&quot;folderPickerPrefix&quot; value=&quot;&amp;folderPickerPrefix.label;&quot;</span>
<a href="#l3.126"></a><span id="l3.126">                    accesskey=&quot;&amp;folderPickerPrefix.accesskey;&quot;</span>
<a href="#l3.127"></a><span id="l3.127">                    disabled=&quot;true&quot; control=&quot;runFiltersFolder&quot;/&gt;</span>
<a href="#l3.128"></a><span id="l3.128">             &lt;menulist id=&quot;runFiltersFolder&quot; disabled=&quot;true&quot; flex=&quot;1&quot;</span>
<a href="#l3.129"></a><span id="l3.129">                       oncommand=&quot;onTargetSelect(event);&quot;&gt;</span>
<a href="#l3.130"></a><span id="l3.130">               &lt;menupopup id=&quot;runFiltersPopup&quot; type=&quot;folder&quot;</span>
<a href="#l3.131"></a><span id="l3.131">                          showFileHereLabel=&quot;true&quot;</span>
<a href="#l3.132"></a><span id="l3.132">                          fileHereLabel=&quot;&amp;filemessageschoosethis.label;&quot;/&gt;</span>
<a href="#l3.133"></a><span id="l3.133">             &lt;/menulist&gt;</span>
<a href="#l3.134"></a><span id="l3.134" class="difflineplus">+          &lt;button id=&quot;runFiltersButton&quot;</span>
<a href="#l3.135"></a><span id="l3.135" class="difflineplus">+                  label=&quot;&amp;runFilters.label;&quot;</span>
<a href="#l3.136"></a><span id="l3.136" class="difflineplus">+                  accesskey=&quot;&amp;runFilters.accesskey;&quot;</span>
<a href="#l3.137"></a><span id="l3.137" class="difflineplus">+                  runlabel=&quot;&amp;runFilters.label;&quot;</span>
<a href="#l3.138"></a><span id="l3.138" class="difflineplus">+                  runaccesskey=&quot;&amp;runFilters.accesskey;&quot;</span>
<a href="#l3.139"></a><span id="l3.139" class="difflineplus">+                  stoplabel=&quot;&amp;stopFilters.label;&quot;</span>
<a href="#l3.140"></a><span id="l3.140" class="difflineplus">+                  stopaccesskey=&quot;&amp;stopFilters.accesskey;&quot;</span>
<a href="#l3.141"></a><span id="l3.141" class="difflineplus">+                  oncommand=&quot;runSelectedFilters();&quot; disabled=&quot;true&quot;/&gt;</span>
<a href="#l3.142"></a><span id="l3.142">           &lt;/hbox&gt;</span>
<a href="#l3.143"></a><span id="l3.143">         &lt;/vbox&gt;</span>
<a href="#l3.144"></a><span id="l3.144">         &lt;vbox&gt;</span>
<a href="#l3.145"></a><span id="l3.145">           &lt;separator class=&quot;thin&quot;/&gt;</span>
<a href="#l3.146"></a><span id="l3.146" class="difflineminus">-          &lt;button id=&quot;runFiltersButton&quot; </span>
<a href="#l3.147"></a><span id="l3.147" class="difflineminus">-                  label=&quot;&amp;runFilters.label;&quot; </span>
<a href="#l3.148"></a><span id="l3.148" class="difflineminus">-                  accesskey=&quot;&amp;runFilters.accesskey;&quot; </span>
<a href="#l3.149"></a><span id="l3.149" class="difflineminus">-                  runlabel=&quot;&amp;runFilters.label;&quot; </span>
<a href="#l3.150"></a><span id="l3.150" class="difflineminus">-                  runaccesskey=&quot;&amp;runFilters.accesskey;&quot; </span>
<a href="#l3.151"></a><span id="l3.151" class="difflineminus">-                  stoplabel=&quot;&amp;stopFilters.label;&quot; </span>
<a href="#l3.152"></a><span id="l3.152" class="difflineminus">-                  stopaccesskey=&quot;&amp;stopFilters.accesskey;&quot;</span>
<a href="#l3.153"></a><span id="l3.153" class="difflineminus">-                  oncommand=&quot;runSelectedFilters();&quot; disabled=&quot;true&quot;/&gt;</span>
<a href="#l3.154"></a><span id="l3.154" class="difflineplus">+            &lt;button label=&quot;&amp;viewLogButton.label;&quot;</span>
<a href="#l3.155"></a><span id="l3.155" class="difflineplus">+                    accesskey=&quot;&amp;viewLogButton.accesskey;&quot;</span>
<a href="#l3.156"></a><span id="l3.156" class="difflineplus">+                    oncommand=&quot;viewLog();&quot;/&gt;</span>
<a href="#l3.157"></a><span id="l3.157" class="difflineplus">+</span>
<a href="#l3.158"></a><span id="l3.158">         &lt;/vbox&gt;</span>
<a href="#l3.159"></a><span id="l3.159">       &lt;/row&gt;</span>
<a href="#l3.160"></a><span id="l3.160">     &lt;/rows&gt;</span>
<a href="#l3.161"></a><span id="l3.161">   &lt;/grid&gt;</span>
<a href="#l3.162"></a><span id="l3.162"> </span>
<a href="#l3.163"></a><span id="l3.163">   &lt;separator class=&quot;thin&quot;/&gt;</span>
<a href="#l3.164"></a><span id="l3.164"> </span>
<a href="#l3.165"></a><span id="l3.165">   &lt;statusbar class=&quot;chromeclass-status&quot; id=&quot;status-bar&quot;&gt;</span>
<a href="#l3.166"></a><span id="l3.166">     &lt;statusbarpanel id=&quot;statusText&quot; flex=&quot;1&quot; crop=&quot;right&quot;/&gt;</span>
<a href="#l3.167"></a><span id="l3.167">     &lt;statusbarpanel class=&quot;statusbarpanel-progress&quot; collapsed=&quot;true&quot; id=&quot;statusbar-progresspanel&quot;&gt;</span>
<a href="#l3.168"></a><span id="l3.168">       &lt;progressmeter class=&quot;progressmeter-statusbar&quot; id=&quot;statusbar-icon&quot; mode=&quot;normal&quot; value=&quot;0&quot;/&gt;</span>
<a href="#l3.169"></a><span id="l3.169">     &lt;/statusbarpanel&gt;</span>
<a href="#l3.170"></a><span id="l3.170" class="difflineminus">-  &lt;/statusbar&gt; </span>
<a href="#l3.171"></a><span id="l3.171" class="difflineplus">+  &lt;/statusbar&gt;</span>
<a href="#l3.172"></a><span id="l3.172"> </span>
<a href="#l3.173"></a><span id="l3.173"> &lt;/window&gt;</span>
<a href="#l3.174"></a><span id="l3.174"> </span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l4.1"></a><span id="l4.1" class="difflineminus">--- a/mail/locales/en-US/chrome/messenger/FilterListDialog.dtd</span>
<a href="#l4.2"></a><span id="l4.2" class="difflineplus">+++ b/mail/locales/en-US/chrome/messenger/FilterListDialog.dtd</span>
<a href="#l4.3"></a><span id="l4.3" class="difflineat">@@ -6,28 +6,38 @@</span>
<a href="#l4.4"></a><span id="l4.4"> &lt;!ENTITY nameColumn.label &quot;Filter Name&quot;&gt;</span>
<a href="#l4.5"></a><span id="l4.5"> &lt;!ENTITY activeColumn.label &quot;Enabled&quot;&gt;</span>
<a href="#l4.6"></a><span id="l4.6"> &lt;!ENTITY newButton.label &quot;New…&quot;&gt;</span>
<a href="#l4.7"></a><span id="l4.7"> &lt;!ENTITY newButton.accesskey &quot;N&quot;&gt;</span>
<a href="#l4.8"></a><span id="l4.8"> &lt;!ENTITY editButton.label &quot;Edit…&quot;&gt;</span>
<a href="#l4.9"></a><span id="l4.9"> &lt;!ENTITY editButton.accesskey &quot;E&quot;&gt;</span>
<a href="#l4.10"></a><span id="l4.10"> &lt;!ENTITY deleteButton.label &quot;Delete&quot;&gt;</span>
<a href="#l4.11"></a><span id="l4.11"> &lt;!ENTITY deleteButton.accesskey &quot;t&quot;&gt;</span>
<a href="#l4.12"></a><span id="l4.12" class="difflineplus">+&lt;!ENTITY reorderTopButton &quot;Move to Top&quot;&gt;</span>
<a href="#l4.13"></a><span id="l4.13" class="difflineplus">+&lt;!ENTITY reorderTopButton.accessKey &quot;o&quot;&gt;</span>
<a href="#l4.14"></a><span id="l4.14" class="difflineplus">+&lt;!ENTITY reorderTopButton.toolTip &quot;Rearrange filter so it executes before all others&quot;&gt;</span>
<a href="#l4.15"></a><span id="l4.15"> &lt;!ENTITY reorderUpButton.label &quot;Move Up&quot;&gt;</span>
<a href="#l4.16"></a><span id="l4.16"> &lt;!ENTITY reorderUpButton.accesskey &quot;U&quot;&gt;</span>
<a href="#l4.17"></a><span id="l4.17"> &lt;!ENTITY reorderDownButton.label &quot;Move Down&quot;&gt;</span>
<a href="#l4.18"></a><span id="l4.18"> &lt;!ENTITY reorderDownButton.accesskey &quot;D&quot;&gt;</span>
<a href="#l4.19"></a><span id="l4.19" class="difflineplus">+&lt;!ENTITY reorderBottomButton &quot;Move to Bottom&quot;&gt;</span>
<a href="#l4.20"></a><span id="l4.20" class="difflineplus">+&lt;!ENTITY reorderBottomButton.accessKey &quot;B&quot;&gt;</span>
<a href="#l4.21"></a><span id="l4.21" class="difflineplus">+&lt;!ENTITY reorderBottomButton.toolTip &quot;Rearrange filter so it executes after all others&quot;&gt;</span>
<a href="#l4.22"></a><span id="l4.22"> &lt;!ENTITY filterHeader.label &quot;Enabled filters are run automatically in the order shown below.&quot;&gt;</span>
<a href="#l4.23"></a><span id="l4.23"> &lt;!ENTITY filtersForPrefix.label &quot;Filters for:&quot;&gt;</span>
<a href="#l4.24"></a><span id="l4.24"> &lt;!ENTITY filtersForPrefix.accesskey &quot;F&quot;&gt;</span>
<a href="#l4.25"></a><span id="l4.25"> &lt;!ENTITY viewLogButton.label &quot;Filter Log&quot;&gt;</span>
<a href="#l4.26"></a><span id="l4.26"> &lt;!ENTITY viewLogButton.accesskey &quot;L&quot;&gt;</span>
<a href="#l4.27"></a><span id="l4.27"> &lt;!ENTITY runFilters.label &quot;Run Now&quot;&gt;</span>
<a href="#l4.28"></a><span id="l4.28"> &lt;!ENTITY runFilters.accesskey &quot;R&quot;&gt;</span>
<a href="#l4.29"></a><span id="l4.29"> &lt;!ENTITY stopFilters.label &quot;Stop&quot;&gt;</span>
<a href="#l4.30"></a><span id="l4.30"> &lt;!ENTITY stopFilters.accesskey &quot;S&quot;&gt;</span>
<a href="#l4.31"></a><span id="l4.31"> &lt;!ENTITY folderPickerPrefix.label &quot;Run selected filter(s) on:&quot;&gt;</span>
<a href="#l4.32"></a><span id="l4.32"> &lt;!ENTITY folderPickerPrefix.accesskey &quot;c&quot;&gt;</span>
<a href="#l4.33"></a><span id="l4.33"> &lt;!ENTITY choosethis.label &quot;choose this folder&quot;&gt;</span>
<a href="#l4.34"></a><span id="l4.34"> &lt;!ENTITY choosethisnewsserver.label &quot;choose this news server&quot;&gt;</span>
<a href="#l4.35"></a><span id="l4.35"> &lt;!ENTITY helpButton.label &quot;Help&quot;&gt;</span>
<a href="#l4.36"></a><span id="l4.36"> &lt;!ENTITY helpButton.accesskey &quot;H&quot;&gt;</span>
<a href="#l4.37"></a><span id="l4.37"> &lt;!ENTITY closeCmd.key &quot;W&quot;&gt; </span>
<a href="#l4.38"></a><span id="l4.38" class="difflineplus">+&lt;!ENTITY searchBox.emptyText &quot;Search filters by name…&quot;&gt;</span>
<a href="#l4.39"></a><span id="l4.39" class="difflineplus">+</span>
<a href="#l4.40"></a><span id="l4.40" class="difflineplus">+</span>
<a href="#l4.41"></a><span id="l4.41" class="difflineplus">+</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l5.1"></a><span id="l5.1" class="difflineminus">--- a/mail/locales/en-US/chrome/messenger/filter.properties</span>
<a href="#l5.2"></a><span id="l5.2" class="difflineplus">+++ b/mail/locales/en-US/chrome/messenger/filter.properties</span>
<a href="#l5.3"></a><span id="l5.3" class="difflineat">@@ -19,17 +19,21 @@ continueFilterExecution=Applying filter </span>
<a href="#l5.4"></a><span id="l5.4"> promptTitle=Running Filters</span>
<a href="#l5.5"></a><span id="l5.5"> promptMsg=You are currently in the process of filtering messages.\nWould you like to continue applying filters?</span>
<a href="#l5.6"></a><span id="l5.6"> stopButtonLabel=Stop</span>
<a href="#l5.7"></a><span id="l5.7"> continueButtonLabel=Continue</span>
<a href="#l5.8"></a><span id="l5.8"> cannotEnableFilter=This filter was probably created by future version of mozilla/netscape. You cannot enable this filter because we don't know how to apply it.</span>
<a href="#l5.9"></a><span id="l5.9"> dontWarnAboutDeleteCheckbox=Don't ask me again</span>
<a href="#l5.10"></a><span id="l5.10"> searchTermsInvalidTitle=Search Terms Invalid</span>
<a href="#l5.11"></a><span id="l5.11"> searchTermsInvalidMessage=This filter cannot be saved because some search terms are invalid in the current context.</span>
<a href="#l5.12"></a><span id="l5.12" class="difflineminus">-</span>
<a href="#l5.13"></a><span id="l5.13" class="difflineplus">+filterCountVisibleOfTotal=%1$S of %2$S</span>
<a href="#l5.14"></a><span id="l5.14" class="difflineplus">+## LOCALIZATION NOTE(filterCountItems): Semi-colon list of plural forms.</span>
<a href="#l5.15"></a><span id="l5.15" class="difflineplus">+## See: http://developer.mozilla.org/en/docs/Localization_and_Plurals</span>
<a href="#l5.16"></a><span id="l5.16" class="difflineplus">+## #1 is the count of items in the list.# filterCountItems is a pluralForm - see </span>
<a href="#l5.17"></a><span id="l5.17" class="difflineplus">+filterCountItems=#1 item; #1 items</span>
<a href="#l5.18"></a><span id="l5.18"> # for junk mail logging / mail filter logging</span>
<a href="#l5.19"></a><span id="l5.19"> # LOCALIZATION NOTE(junkLogDetectStr)</span>
<a href="#l5.20"></a><span id="l5.20"> # %1$S=author, %2$S=subject, %3$S=date</span>
<a href="#l5.21"></a><span id="l5.21"> junkLogDetectStr=Detected junk message from %1$S - %2$S at %3$S</span>
<a href="#l5.22"></a><span id="l5.22"> # LOCALIZATION NOTE(logMoveStr)</span>
<a href="#l5.23"></a><span id="l5.23"> # %1$S=message id, %2$S=folder URI</span>
<a href="#l5.24"></a><span id="l5.24"> logMoveStr=moved message id = %1$S to %2$S</span>
<a href="#l5.25"></a><span id="l5.25"> # LOCALIZATION NOTE(logCopyStr)</span></pre></div></div>

<div class="page_footer">
<div class="page_footer_text">comm-central</div>
<div class="page_footer_text" style="padding-left: 10px">Deployed from <a href="https://hg.mozilla.org/hgcustom/version-control-tools/rev/35f393d6769a">35f393d6769a</a> at 2020-07-16T17:23:43Z.</div>
<div class="rss_logo">
<a href="/comm-central/rss-log">RSS</a>
<a href="/comm-central/atom-log">Atom</a>
</div>
<br />

</div>
</body>
</html>

