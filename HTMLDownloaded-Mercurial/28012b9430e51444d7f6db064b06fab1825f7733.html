<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en-US" lang="en-US">
<head>
<link rel="icon" href="/static/35f393d6769a/hgicon.png" type="image/png" />
<meta name="robots" content="index, nofollow"/>
<link rel="stylesheet" href="/static/35f393d6769a/style-gitweb.css" type="text/css" />

<style type="text/css">
div.feed {
  float: right;
}
a img {
  border-width: 0px;
}
div.log_link {
  width: 80px;
  background-color: white;
}

div.log_body {
  padding-left: 96px;
}
</style>
<script type="text/javascript" src="/static/35f393d6769a/mercurial.js"></script>

<meta property="og:image" content="/static/35f393d6769a/moz-logo-bw-rgb.svg"/>
<meta property="og:type" content="website"/>

<title>comm-central: changeset 1359:28012b9430e51444d7f6db064b06fab1825f7733</title>
<link rel="alternate" type="application/atom+xml"
   href="/comm-central/atom-log" title="Atom feed for comm-central"/>
<link rel="alternate" type="application/rss+xml"
   href="/comm-central/rss-log" title="RSS feed for comm-central"/>

<meta property="og:title" content="comm-central @ 28012b9430e51444d7f6db064b06fab1825f7733" />
<meta property="og:url" content="/comm-central/rev/28012b9430e51444d7f6db064b06fab1825f7733" />
<meta property="og:description" content="bug 382187 - use places for SeaMonkey history, enable it and switch the UI, r+sr=Neil" />

</head>
<body>

<div class="page_header">
<div class="logo">
    <a href="https://developer.mozilla.org/en/docs/Mercurial">
        <img src="/static/35f393d6769a/moz-logo-bw-rgb.svg" alt="mercurial" />
    </a>
</div>
<a href="/">Mercurial</a> &gt; <a href="/comm-central">comm-central</a>  / changeset / 28012b9430e51444d7f6db064b06fab1825f7733 
</div>

<div class="page_nav">
<div>
<a href="/comm-central/summary">summary</a> |
<a href="/comm-central/shortlog/28012b9430e51444d7f6db064b06fab1825f7733">shortlog</a> |
<a href="/comm-central/log/28012b9430e51444d7f6db064b06fab1825f7733">changelog</a> |
<a href="/comm-central/pushloghtml">pushlog</a> |
<a href="/comm-central/graph/28012b9430e51444d7f6db064b06fab1825f7733">graph</a> |
<a href="/comm-central/tags">tags</a> |
<a href="/comm-central/bookmarks">bookmarks</a> |
<a href="/comm-central/branches">branches</a> |
<a href="/comm-central/file/28012b9430e51444d7f6db064b06fab1825f7733">files</a> |
changeset |
<a href="/comm-central/raw-rev/28012b9430e51444d7f6db064b06fab1825f7733">raw</a>  | <a href="/comm-central/archive/28012b9430e51444d7f6db064b06fab1825f7733.zip">zip</a>  |
<a href="/comm-central/help">help</a>
</div>

<div class="search">
<form id="searchform" action="/comm-central/log">

<input name="rev" type="text" value="" size="40" />
<div id="hint">Find changesets by keywords (author, files, the commit message), revision
number or hash, or <a href="/comm-central/help/revsets">revset expression</a>.</div>
</form>
</div>
</div>

<div class="title">
<a href="https://bugzilla.mozilla.org/show_bug.cgi?id=382187">bug 382187</a> - use places for SeaMonkey history, enable it and switch the UI, r+sr=Neil
<span class="logtags"></span>
</div>
<div class="title_text">
<table cellspacing="0">

<tr><td>author</td><td>&#82;&#111;&#98;&#101;&#114;&#116;&#32;&#75;&#97;&#105;&#115;&#101;&#114;&#32;&#60;&#107;&#97;&#105;&#114;&#111;&#64;&#107;&#97;&#105;&#114;&#111;&#46;&#97;&#116;&#62;</td></tr>
<tr><td></td><td class="date age">Sun, 07 Dec 2008 14:20:44 +0100</td></tr>

<tr>
 <td>changeset 1359</td>
 <td style="font-family:monospace"><a class="list" href="/comm-central/rev/28012b9430e51444d7f6db064b06fab1825f7733">28012b9430e51444d7f6db064b06fab1825f7733</a></td>
</tr>



<tr>
<td>parent 1358</td>
<td style="font-family:monospace">
<a class="list" href="/comm-central/rev/ed0cf62bc9fb20cade8f49387cbc5a289da2db1b">ed0cf62bc9fb20cade8f49387cbc5a289da2db1b</a>
</td>
</tr>

<tr>
<td>child 1360</td>
<td style="font-family:monospace">
<a class="list" href="/comm-central/rev/8dbdd7537b670f4d304c5a89ae9bac968252196e">8dbdd7537b670f4d304c5a89ae9bac968252196e</a>
</td>
</tr>
<tr><td>push id</td><td><a href="/comm-central/pushloghtml?changeset=28012b9430e51444d7f6db064b06fab1825f7733">1069</a></td></tr>
<tr><td>push user</td><td>kairo@kairo.at</td></tr>
<tr><td>push date</td><td class="date age">Sun, 07 Dec 2008 13:21:19 +0000</td></tr>

<tr><td>treeherder</td><td>comm-central@28012b9430e5 [<a href="https://treeherder.mozilla.org/#/jobs?repo=comm-central&revision=28012b9430e51444d7f6db064b06fab1825f7733">default view</a>] [<a href="https://treeherder.mozilla.org/#/jobs?repo=comm-central&revision=28012b9430e51444d7f6db064b06fab1825f7733&filter-resultStatus=testfailed&filter-resultStatus=busted&filter-resultStatus=exception">failures only]</td></tr>
<tr><td>perfherder</td><td>[<a href="https://treeherder.mozilla.org/perf.html#/compare?originalProject=comm-central&originalRevision=28012b9430e51444d7f6db064b06fab1825f7733&newProject=comm-central&newRevision=28012b9430e51444d7f6db064b06fab1825f7733&framework=1" target="_blank">talos</a>] [<a href="https://treeherder.mozilla.org/perf.html#/compare?originalProject=comm-central&originalRevision=28012b9430e51444d7f6db064b06fab1825f7733&newProject=comm-central&newRevision=28012b9430e51444d7f6db064b06fab1825f7733&framework=2" target="_blank">build metrics</a>] [<a href="https://treeherder.mozilla.org/perf.html#/compare?originalProject=comm-central&originalRevision=28012b9430e51444d7f6db064b06fab1825f7733&newProject=comm-central&newRevision=28012b9430e51444d7f6db064b06fab1825f7733&framework=6" target="_blank">platform microbench</a>] (compared to previous push)</td></tr>

<tr><td>bugs</td><td><a href="https://bugzilla.mozilla.org/show_bug.cgi?id=382187">382187</a></td></tr>




</table></div>

<div class="page_body description"><a href="https://bugzilla.mozilla.org/show_bug.cgi?id=382187">bug 382187</a> - use places for SeaMonkey history, enable it and switch the UI, r+sr=Neil</div>
<div class="list_head"></div>
<div class="title_text">
<table cellspacing="0">

<tr class="parity0">
<td><a class="list" href="/comm-central/diff/28012b9430e51444d7f6db064b06fab1825f7733/suite/browser/browser-prefs.js">suite/browser/browser-prefs.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/28012b9430e51444d7f6db064b06fab1825f7733/suite/browser/browser-prefs.js">file</a> |
<a href="/comm-central/annotate/28012b9430e51444d7f6db064b06fab1825f7733/suite/browser/browser-prefs.js">annotate</a> |
<a href="/comm-central/diff/28012b9430e51444d7f6db064b06fab1825f7733/suite/browser/browser-prefs.js">diff</a> |
<a href="/comm-central/comparison/28012b9430e51444d7f6db064b06fab1825f7733/suite/browser/browser-prefs.js">comparison</a> |
<a href="/comm-central/log/28012b9430e51444d7f6db064b06fab1825f7733/suite/browser/browser-prefs.js">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/28012b9430e51444d7f6db064b06fab1825f7733/suite/common/history/controller.js">suite/common/history/controller.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/28012b9430e51444d7f6db064b06fab1825f7733/suite/common/history/controller.js">file</a> |
<a href="/comm-central/annotate/28012b9430e51444d7f6db064b06fab1825f7733/suite/common/history/controller.js">annotate</a> |
<a href="/comm-central/diff/28012b9430e51444d7f6db064b06fab1825f7733/suite/common/history/controller.js">diff</a> |
<a href="/comm-central/comparison/28012b9430e51444d7f6db064b06fab1825f7733/suite/common/history/controller.js">comparison</a> |
<a href="/comm-central/log/28012b9430e51444d7f6db064b06fab1825f7733/suite/common/history/controller.js">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/28012b9430e51444d7f6db064b06fab1825f7733/suite/common/history/findHistory.js">suite/common/history/findHistory.js</a></td>
<td></td>
<td class="link">
file |
annotate |
<a href="/comm-central/diff/28012b9430e51444d7f6db064b06fab1825f7733/suite/common/history/findHistory.js">diff</a> |
<a href="/comm-central/comparison/28012b9430e51444d7f6db064b06fab1825f7733/suite/common/history/findHistory.js">comparison</a> |
<a href="/comm-central/log/28012b9430e51444d7f6db064b06fab1825f7733/suite/common/history/findHistory.js">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/28012b9430e51444d7f6db064b06fab1825f7733/suite/common/history/findHistory.xul">suite/common/history/findHistory.xul</a></td>
<td></td>
<td class="link">
file |
annotate |
<a href="/comm-central/diff/28012b9430e51444d7f6db064b06fab1825f7733/suite/common/history/findHistory.xul">diff</a> |
<a href="/comm-central/comparison/28012b9430e51444d7f6db064b06fab1825f7733/suite/common/history/findHistory.xul">comparison</a> |
<a href="/comm-central/log/28012b9430e51444d7f6db064b06fab1825f7733/suite/common/history/findHistory.xul">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/28012b9430e51444d7f6db064b06fab1825f7733/suite/common/history/history-panel.xul">suite/common/history/history-panel.xul</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/28012b9430e51444d7f6db064b06fab1825f7733/suite/common/history/history-panel.xul">file</a> |
<a href="/comm-central/annotate/28012b9430e51444d7f6db064b06fab1825f7733/suite/common/history/history-panel.xul">annotate</a> |
<a href="/comm-central/diff/28012b9430e51444d7f6db064b06fab1825f7733/suite/common/history/history-panel.xul">diff</a> |
<a href="/comm-central/comparison/28012b9430e51444d7f6db064b06fab1825f7733/suite/common/history/history-panel.xul">comparison</a> |
<a href="/comm-central/log/28012b9430e51444d7f6db064b06fab1825f7733/suite/common/history/history-panel.xul">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/28012b9430e51444d7f6db064b06fab1825f7733/suite/common/history/history-test.js">suite/common/history/history-test.js</a></td>
<td></td>
<td class="link">
file |
annotate |
<a href="/comm-central/diff/28012b9430e51444d7f6db064b06fab1825f7733/suite/common/history/history-test.js">diff</a> |
<a href="/comm-central/comparison/28012b9430e51444d7f6db064b06fab1825f7733/suite/common/history/history-test.js">comparison</a> |
<a href="/comm-central/log/28012b9430e51444d7f6db064b06fab1825f7733/suite/common/history/history-test.js">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/28012b9430e51444d7f6db064b06fab1825f7733/suite/common/history/history-test.xul">suite/common/history/history-test.xul</a></td>
<td></td>
<td class="link">
file |
annotate |
<a href="/comm-central/diff/28012b9430e51444d7f6db064b06fab1825f7733/suite/common/history/history-test.xul">diff</a> |
<a href="/comm-central/comparison/28012b9430e51444d7f6db064b06fab1825f7733/suite/common/history/history-test.xul">comparison</a> |
<a href="/comm-central/log/28012b9430e51444d7f6db064b06fab1825f7733/suite/common/history/history-test.xul">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/28012b9430e51444d7f6db064b06fab1825f7733/suite/common/history/history.js">suite/common/history/history.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/28012b9430e51444d7f6db064b06fab1825f7733/suite/common/history/history.js">file</a> |
<a href="/comm-central/annotate/28012b9430e51444d7f6db064b06fab1825f7733/suite/common/history/history.js">annotate</a> |
<a href="/comm-central/diff/28012b9430e51444d7f6db064b06fab1825f7733/suite/common/history/history.js">diff</a> |
<a href="/comm-central/comparison/28012b9430e51444d7f6db064b06fab1825f7733/suite/common/history/history.js">comparison</a> |
<a href="/comm-central/log/28012b9430e51444d7f6db064b06fab1825f7733/suite/common/history/history.js">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/28012b9430e51444d7f6db064b06fab1825f7733/suite/common/history/history.xul">suite/common/history/history.xul</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/28012b9430e51444d7f6db064b06fab1825f7733/suite/common/history/history.xul">file</a> |
<a href="/comm-central/annotate/28012b9430e51444d7f6db064b06fab1825f7733/suite/common/history/history.xul">annotate</a> |
<a href="/comm-central/diff/28012b9430e51444d7f6db064b06fab1825f7733/suite/common/history/history.xul">diff</a> |
<a href="/comm-central/comparison/28012b9430e51444d7f6db064b06fab1825f7733/suite/common/history/history.xul">comparison</a> |
<a href="/comm-central/log/28012b9430e51444d7f6db064b06fab1825f7733/suite/common/history/history.xul">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/28012b9430e51444d7f6db064b06fab1825f7733/suite/common/history/historyTreeOverlay.xul">suite/common/history/historyTreeOverlay.xul</a></td>
<td></td>
<td class="link">
file |
annotate |
<a href="/comm-central/diff/28012b9430e51444d7f6db064b06fab1825f7733/suite/common/history/historyTreeOverlay.xul">diff</a> |
<a href="/comm-central/comparison/28012b9430e51444d7f6db064b06fab1825f7733/suite/common/history/historyTreeOverlay.xul">comparison</a> |
<a href="/comm-central/log/28012b9430e51444d7f6db064b06fab1825f7733/suite/common/history/historyTreeOverlay.xul">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/28012b9430e51444d7f6db064b06fab1825f7733/suite/common/history/historyTreeSorting.js">suite/common/history/historyTreeSorting.js</a></td>
<td></td>
<td class="link">
file |
annotate |
<a href="/comm-central/diff/28012b9430e51444d7f6db064b06fab1825f7733/suite/common/history/historyTreeSorting.js">diff</a> |
<a href="/comm-central/comparison/28012b9430e51444d7f6db064b06fab1825f7733/suite/common/history/historyTreeSorting.js">comparison</a> |
<a href="/comm-central/log/28012b9430e51444d7f6db064b06fab1825f7733/suite/common/history/historyTreeSorting.js">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/28012b9430e51444d7f6db064b06fab1825f7733/suite/common/history/places.css">suite/common/history/places.css</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/28012b9430e51444d7f6db064b06fab1825f7733/suite/common/history/places.css">file</a> |
<a href="/comm-central/annotate/28012b9430e51444d7f6db064b06fab1825f7733/suite/common/history/places.css">annotate</a> |
<a href="/comm-central/diff/28012b9430e51444d7f6db064b06fab1825f7733/suite/common/history/places.css">diff</a> |
<a href="/comm-central/comparison/28012b9430e51444d7f6db064b06fab1825f7733/suite/common/history/places.css">comparison</a> |
<a href="/comm-central/log/28012b9430e51444d7f6db064b06fab1825f7733/suite/common/history/places.css">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/28012b9430e51444d7f6db064b06fab1825f7733/suite/common/history/places.js">suite/common/history/places.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/28012b9430e51444d7f6db064b06fab1825f7733/suite/common/history/places.js">file</a> |
<a href="/comm-central/annotate/28012b9430e51444d7f6db064b06fab1825f7733/suite/common/history/places.js">annotate</a> |
<a href="/comm-central/diff/28012b9430e51444d7f6db064b06fab1825f7733/suite/common/history/places.js">diff</a> |
<a href="/comm-central/comparison/28012b9430e51444d7f6db064b06fab1825f7733/suite/common/history/places.js">comparison</a> |
<a href="/comm-central/log/28012b9430e51444d7f6db064b06fab1825f7733/suite/common/history/places.js">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/28012b9430e51444d7f6db064b06fab1825f7733/suite/common/history/placesOverlay.xul">suite/common/history/placesOverlay.xul</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/28012b9430e51444d7f6db064b06fab1825f7733/suite/common/history/placesOverlay.xul">file</a> |
<a href="/comm-central/annotate/28012b9430e51444d7f6db064b06fab1825f7733/suite/common/history/placesOverlay.xul">annotate</a> |
<a href="/comm-central/diff/28012b9430e51444d7f6db064b06fab1825f7733/suite/common/history/placesOverlay.xul">diff</a> |
<a href="/comm-central/comparison/28012b9430e51444d7f6db064b06fab1825f7733/suite/common/history/placesOverlay.xul">comparison</a> |
<a href="/comm-central/log/28012b9430e51444d7f6db064b06fab1825f7733/suite/common/history/placesOverlay.xul">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/28012b9430e51444d7f6db064b06fab1825f7733/suite/common/history/sidebarUtils.js">suite/common/history/sidebarUtils.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/28012b9430e51444d7f6db064b06fab1825f7733/suite/common/history/sidebarUtils.js">file</a> |
<a href="/comm-central/annotate/28012b9430e51444d7f6db064b06fab1825f7733/suite/common/history/sidebarUtils.js">annotate</a> |
<a href="/comm-central/diff/28012b9430e51444d7f6db064b06fab1825f7733/suite/common/history/sidebarUtils.js">diff</a> |
<a href="/comm-central/comparison/28012b9430e51444d7f6db064b06fab1825f7733/suite/common/history/sidebarUtils.js">comparison</a> |
<a href="/comm-central/log/28012b9430e51444d7f6db064b06fab1825f7733/suite/common/history/sidebarUtils.js">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/28012b9430e51444d7f6db064b06fab1825f7733/suite/common/history/tree.xml">suite/common/history/tree.xml</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/28012b9430e51444d7f6db064b06fab1825f7733/suite/common/history/tree.xml">file</a> |
<a href="/comm-central/annotate/28012b9430e51444d7f6db064b06fab1825f7733/suite/common/history/tree.xml">annotate</a> |
<a href="/comm-central/diff/28012b9430e51444d7f6db064b06fab1825f7733/suite/common/history/tree.xml">diff</a> |
<a href="/comm-central/comparison/28012b9430e51444d7f6db064b06fab1825f7733/suite/common/history/tree.xml">comparison</a> |
<a href="/comm-central/log/28012b9430e51444d7f6db064b06fab1825f7733/suite/common/history/tree.xml">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/28012b9430e51444d7f6db064b06fab1825f7733/suite/common/history/treeView.js">suite/common/history/treeView.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/28012b9430e51444d7f6db064b06fab1825f7733/suite/common/history/treeView.js">file</a> |
<a href="/comm-central/annotate/28012b9430e51444d7f6db064b06fab1825f7733/suite/common/history/treeView.js">annotate</a> |
<a href="/comm-central/diff/28012b9430e51444d7f6db064b06fab1825f7733/suite/common/history/treeView.js">diff</a> |
<a href="/comm-central/comparison/28012b9430e51444d7f6db064b06fab1825f7733/suite/common/history/treeView.js">comparison</a> |
<a href="/comm-central/log/28012b9430e51444d7f6db064b06fab1825f7733/suite/common/history/treeView.js">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/28012b9430e51444d7f6db064b06fab1825f7733/suite/common/history/utils.js">suite/common/history/utils.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/28012b9430e51444d7f6db064b06fab1825f7733/suite/common/history/utils.js">file</a> |
<a href="/comm-central/annotate/28012b9430e51444d7f6db064b06fab1825f7733/suite/common/history/utils.js">annotate</a> |
<a href="/comm-central/diff/28012b9430e51444d7f6db064b06fab1825f7733/suite/common/history/utils.js">diff</a> |
<a href="/comm-central/comparison/28012b9430e51444d7f6db064b06fab1825f7733/suite/common/history/utils.js">comparison</a> |
<a href="/comm-central/log/28012b9430e51444d7f6db064b06fab1825f7733/suite/common/history/utils.js">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/28012b9430e51444d7f6db064b06fab1825f7733/suite/common/jar.mn">suite/common/jar.mn</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/28012b9430e51444d7f6db064b06fab1825f7733/suite/common/jar.mn">file</a> |
<a href="/comm-central/annotate/28012b9430e51444d7f6db064b06fab1825f7733/suite/common/jar.mn">annotate</a> |
<a href="/comm-central/diff/28012b9430e51444d7f6db064b06fab1825f7733/suite/common/jar.mn">diff</a> |
<a href="/comm-central/comparison/28012b9430e51444d7f6db064b06fab1825f7733/suite/common/jar.mn">comparison</a> |
<a href="/comm-central/log/28012b9430e51444d7f6db064b06fab1825f7733/suite/common/jar.mn">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/28012b9430e51444d7f6db064b06fab1825f7733/suite/confvars.sh">suite/confvars.sh</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/28012b9430e51444d7f6db064b06fab1825f7733/suite/confvars.sh">file</a> |
<a href="/comm-central/annotate/28012b9430e51444d7f6db064b06fab1825f7733/suite/confvars.sh">annotate</a> |
<a href="/comm-central/diff/28012b9430e51444d7f6db064b06fab1825f7733/suite/confvars.sh">diff</a> |
<a href="/comm-central/comparison/28012b9430e51444d7f6db064b06fab1825f7733/suite/confvars.sh">comparison</a> |
<a href="/comm-central/log/28012b9430e51444d7f6db064b06fab1825f7733/suite/confvars.sh">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/28012b9430e51444d7f6db064b06fab1825f7733/suite/installer/unix/packages">suite/installer/unix/packages</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/28012b9430e51444d7f6db064b06fab1825f7733/suite/installer/unix/packages">file</a> |
<a href="/comm-central/annotate/28012b9430e51444d7f6db064b06fab1825f7733/suite/installer/unix/packages">annotate</a> |
<a href="/comm-central/diff/28012b9430e51444d7f6db064b06fab1825f7733/suite/installer/unix/packages">diff</a> |
<a href="/comm-central/comparison/28012b9430e51444d7f6db064b06fab1825f7733/suite/installer/unix/packages">comparison</a> |
<a href="/comm-central/log/28012b9430e51444d7f6db064b06fab1825f7733/suite/installer/unix/packages">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/28012b9430e51444d7f6db064b06fab1825f7733/suite/installer/windows/packages">suite/installer/windows/packages</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/28012b9430e51444d7f6db064b06fab1825f7733/suite/installer/windows/packages">file</a> |
<a href="/comm-central/annotate/28012b9430e51444d7f6db064b06fab1825f7733/suite/installer/windows/packages">annotate</a> |
<a href="/comm-central/diff/28012b9430e51444d7f6db064b06fab1825f7733/suite/installer/windows/packages">diff</a> |
<a href="/comm-central/comparison/28012b9430e51444d7f6db064b06fab1825f7733/suite/installer/windows/packages">comparison</a> |
<a href="/comm-central/log/28012b9430e51444d7f6db064b06fab1825f7733/suite/installer/windows/packages">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/28012b9430e51444d7f6db064b06fab1825f7733/suite/locales/en-US/chrome/common/history/findHistory.dtd">suite/locales/en-US/chrome/common/history/findHistory.dtd</a></td>
<td></td>
<td class="link">
file |
annotate |
<a href="/comm-central/diff/28012b9430e51444d7f6db064b06fab1825f7733/suite/locales/en-US/chrome/common/history/findHistory.dtd">diff</a> |
<a href="/comm-central/comparison/28012b9430e51444d7f6db064b06fab1825f7733/suite/locales/en-US/chrome/common/history/findHistory.dtd">comparison</a> |
<a href="/comm-central/log/28012b9430e51444d7f6db064b06fab1825f7733/suite/locales/en-US/chrome/common/history/findHistory.dtd">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/28012b9430e51444d7f6db064b06fab1825f7733/suite/locales/en-US/chrome/common/history/history.dtd">suite/locales/en-US/chrome/common/history/history.dtd</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/28012b9430e51444d7f6db064b06fab1825f7733/suite/locales/en-US/chrome/common/history/history.dtd">file</a> |
<a href="/comm-central/annotate/28012b9430e51444d7f6db064b06fab1825f7733/suite/locales/en-US/chrome/common/history/history.dtd">annotate</a> |
<a href="/comm-central/diff/28012b9430e51444d7f6db064b06fab1825f7733/suite/locales/en-US/chrome/common/history/history.dtd">diff</a> |
<a href="/comm-central/comparison/28012b9430e51444d7f6db064b06fab1825f7733/suite/locales/en-US/chrome/common/history/history.dtd">comparison</a> |
<a href="/comm-central/log/28012b9430e51444d7f6db064b06fab1825f7733/suite/locales/en-US/chrome/common/history/history.dtd">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/28012b9430e51444d7f6db064b06fab1825f7733/suite/locales/en-US/chrome/common/history/history.properties">suite/locales/en-US/chrome/common/history/history.properties</a></td>
<td></td>
<td class="link">
file |
annotate |
<a href="/comm-central/diff/28012b9430e51444d7f6db064b06fab1825f7733/suite/locales/en-US/chrome/common/history/history.properties">diff</a> |
<a href="/comm-central/comparison/28012b9430e51444d7f6db064b06fab1825f7733/suite/locales/en-US/chrome/common/history/history.properties">comparison</a> |
<a href="/comm-central/log/28012b9430e51444d7f6db064b06fab1825f7733/suite/locales/en-US/chrome/common/history/history.properties">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/28012b9430e51444d7f6db064b06fab1825f7733/suite/locales/en-US/chrome/common/history/historyTreeOverlay.dtd">suite/locales/en-US/chrome/common/history/historyTreeOverlay.dtd</a></td>
<td></td>
<td class="link">
file |
annotate |
<a href="/comm-central/diff/28012b9430e51444d7f6db064b06fab1825f7733/suite/locales/en-US/chrome/common/history/historyTreeOverlay.dtd">diff</a> |
<a href="/comm-central/comparison/28012b9430e51444d7f6db064b06fab1825f7733/suite/locales/en-US/chrome/common/history/historyTreeOverlay.dtd">comparison</a> |
<a href="/comm-central/log/28012b9430e51444d7f6db064b06fab1825f7733/suite/locales/en-US/chrome/common/history/historyTreeOverlay.dtd">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/28012b9430e51444d7f6db064b06fab1825f7733/suite/locales/en-US/chrome/common/history/places.properties">suite/locales/en-US/chrome/common/history/places.properties</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/28012b9430e51444d7f6db064b06fab1825f7733/suite/locales/en-US/chrome/common/history/places.properties">file</a> |
<a href="/comm-central/annotate/28012b9430e51444d7f6db064b06fab1825f7733/suite/locales/en-US/chrome/common/history/places.properties">annotate</a> |
<a href="/comm-central/diff/28012b9430e51444d7f6db064b06fab1825f7733/suite/locales/en-US/chrome/common/history/places.properties">diff</a> |
<a href="/comm-central/comparison/28012b9430e51444d7f6db064b06fab1825f7733/suite/locales/en-US/chrome/common/history/places.properties">comparison</a> |
<a href="/comm-central/log/28012b9430e51444d7f6db064b06fab1825f7733/suite/locales/en-US/chrome/common/history/places.properties">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/28012b9430e51444d7f6db064b06fab1825f7733/suite/locales/jar.mn">suite/locales/jar.mn</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/28012b9430e51444d7f6db064b06fab1825f7733/suite/locales/jar.mn">file</a> |
<a href="/comm-central/annotate/28012b9430e51444d7f6db064b06fab1825f7733/suite/locales/jar.mn">annotate</a> |
<a href="/comm-central/diff/28012b9430e51444d7f6db064b06fab1825f7733/suite/locales/jar.mn">diff</a> |
<a href="/comm-central/comparison/28012b9430e51444d7f6db064b06fab1825f7733/suite/locales/jar.mn">comparison</a> |
<a href="/comm-central/log/28012b9430e51444d7f6db064b06fab1825f7733/suite/locales/jar.mn">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/28012b9430e51444d7f6db064b06fab1825f7733/suite/themes/classic/communicator/history/calendar.png">suite/themes/classic/communicator/history/calendar.png</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/28012b9430e51444d7f6db064b06fab1825f7733/suite/themes/classic/communicator/history/calendar.png">file</a> |
<a href="/comm-central/annotate/28012b9430e51444d7f6db064b06fab1825f7733/suite/themes/classic/communicator/history/calendar.png">annotate</a> |
<a href="/comm-central/diff/28012b9430e51444d7f6db064b06fab1825f7733/suite/themes/classic/communicator/history/calendar.png">diff</a> |
<a href="/comm-central/comparison/28012b9430e51444d7f6db064b06fab1825f7733/suite/themes/classic/communicator/history/calendar.png">comparison</a> |
<a href="/comm-central/log/28012b9430e51444d7f6db064b06fab1825f7733/suite/themes/classic/communicator/history/calendar.png">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/28012b9430e51444d7f6db064b06fab1825f7733/suite/themes/classic/communicator/history/places.css">suite/themes/classic/communicator/history/places.css</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/28012b9430e51444d7f6db064b06fab1825f7733/suite/themes/classic/communicator/history/places.css">file</a> |
<a href="/comm-central/annotate/28012b9430e51444d7f6db064b06fab1825f7733/suite/themes/classic/communicator/history/places.css">annotate</a> |
<a href="/comm-central/diff/28012b9430e51444d7f6db064b06fab1825f7733/suite/themes/classic/communicator/history/places.css">diff</a> |
<a href="/comm-central/comparison/28012b9430e51444d7f6db064b06fab1825f7733/suite/themes/classic/communicator/history/places.css">comparison</a> |
<a href="/comm-central/log/28012b9430e51444d7f6db064b06fab1825f7733/suite/themes/classic/communicator/history/places.css">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/28012b9430e51444d7f6db064b06fab1825f7733/suite/themes/classic/communicator/sidebar/sidebarListView.css">suite/themes/classic/communicator/sidebar/sidebarListView.css</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/28012b9430e51444d7f6db064b06fab1825f7733/suite/themes/classic/communicator/sidebar/sidebarListView.css">file</a> |
<a href="/comm-central/annotate/28012b9430e51444d7f6db064b06fab1825f7733/suite/themes/classic/communicator/sidebar/sidebarListView.css">annotate</a> |
<a href="/comm-central/diff/28012b9430e51444d7f6db064b06fab1825f7733/suite/themes/classic/communicator/sidebar/sidebarListView.css">diff</a> |
<a href="/comm-central/comparison/28012b9430e51444d7f6db064b06fab1825f7733/suite/themes/classic/communicator/sidebar/sidebarListView.css">comparison</a> |
<a href="/comm-central/log/28012b9430e51444d7f6db064b06fab1825f7733/suite/themes/classic/communicator/sidebar/sidebarListView.css">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/28012b9430e51444d7f6db064b06fab1825f7733/suite/themes/classic/jar.mn">suite/themes/classic/jar.mn</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/28012b9430e51444d7f6db064b06fab1825f7733/suite/themes/classic/jar.mn">file</a> |
<a href="/comm-central/annotate/28012b9430e51444d7f6db064b06fab1825f7733/suite/themes/classic/jar.mn">annotate</a> |
<a href="/comm-central/diff/28012b9430e51444d7f6db064b06fab1825f7733/suite/themes/classic/jar.mn">diff</a> |
<a href="/comm-central/comparison/28012b9430e51444d7f6db064b06fab1825f7733/suite/themes/classic/jar.mn">comparison</a> |
<a href="/comm-central/log/28012b9430e51444d7f6db064b06fab1825f7733/suite/themes/classic/jar.mn">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/28012b9430e51444d7f6db064b06fab1825f7733/suite/themes/modern/communicator/history/calendar.png">suite/themes/modern/communicator/history/calendar.png</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/28012b9430e51444d7f6db064b06fab1825f7733/suite/themes/modern/communicator/history/calendar.png">file</a> |
<a href="/comm-central/annotate/28012b9430e51444d7f6db064b06fab1825f7733/suite/themes/modern/communicator/history/calendar.png">annotate</a> |
<a href="/comm-central/diff/28012b9430e51444d7f6db064b06fab1825f7733/suite/themes/modern/communicator/history/calendar.png">diff</a> |
<a href="/comm-central/comparison/28012b9430e51444d7f6db064b06fab1825f7733/suite/themes/modern/communicator/history/calendar.png">comparison</a> |
<a href="/comm-central/log/28012b9430e51444d7f6db064b06fab1825f7733/suite/themes/modern/communicator/history/calendar.png">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/28012b9430e51444d7f6db064b06fab1825f7733/suite/themes/modern/communicator/history/places.css">suite/themes/modern/communicator/history/places.css</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/28012b9430e51444d7f6db064b06fab1825f7733/suite/themes/modern/communicator/history/places.css">file</a> |
<a href="/comm-central/annotate/28012b9430e51444d7f6db064b06fab1825f7733/suite/themes/modern/communicator/history/places.css">annotate</a> |
<a href="/comm-central/diff/28012b9430e51444d7f6db064b06fab1825f7733/suite/themes/modern/communicator/history/places.css">diff</a> |
<a href="/comm-central/comparison/28012b9430e51444d7f6db064b06fab1825f7733/suite/themes/modern/communicator/history/places.css">comparison</a> |
<a href="/comm-central/log/28012b9430e51444d7f6db064b06fab1825f7733/suite/themes/modern/communicator/history/places.css">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/28012b9430e51444d7f6db064b06fab1825f7733/suite/themes/modern/communicator/sidebar/sidebarListView.css">suite/themes/modern/communicator/sidebar/sidebarListView.css</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/28012b9430e51444d7f6db064b06fab1825f7733/suite/themes/modern/communicator/sidebar/sidebarListView.css">file</a> |
<a href="/comm-central/annotate/28012b9430e51444d7f6db064b06fab1825f7733/suite/themes/modern/communicator/sidebar/sidebarListView.css">annotate</a> |
<a href="/comm-central/diff/28012b9430e51444d7f6db064b06fab1825f7733/suite/themes/modern/communicator/sidebar/sidebarListView.css">diff</a> |
<a href="/comm-central/comparison/28012b9430e51444d7f6db064b06fab1825f7733/suite/themes/modern/communicator/sidebar/sidebarListView.css">comparison</a> |
<a href="/comm-central/log/28012b9430e51444d7f6db064b06fab1825f7733/suite/themes/modern/communicator/sidebar/sidebarListView.css">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/28012b9430e51444d7f6db064b06fab1825f7733/suite/themes/modern/jar.mn">suite/themes/modern/jar.mn</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/28012b9430e51444d7f6db064b06fab1825f7733/suite/themes/modern/jar.mn">file</a> |
<a href="/comm-central/annotate/28012b9430e51444d7f6db064b06fab1825f7733/suite/themes/modern/jar.mn">annotate</a> |
<a href="/comm-central/diff/28012b9430e51444d7f6db064b06fab1825f7733/suite/themes/modern/jar.mn">diff</a> |
<a href="/comm-central/comparison/28012b9430e51444d7f6db064b06fab1825f7733/suite/themes/modern/jar.mn">comparison</a> |
<a href="/comm-central/log/28012b9430e51444d7f6db064b06fab1825f7733/suite/themes/modern/jar.mn">revisions</a>
</td>
</tr>
</table></div>

<div class="page_body diffblocks"><div class="diffblock"><pre class="sourcelines">
<a href="#l1.1"></a><span id="l1.1" class="difflineminus">--- a/suite/browser/browser-prefs.js</span>
<a href="#l1.2"></a><span id="l1.2" class="difflineplus">+++ b/suite/browser/browser-prefs.js</span>
<a href="#l1.3"></a><span id="l1.3" class="difflineat">@@ -65,21 +65,16 @@ pref(&quot;general.autoScroll&quot;, true);</span>
<a href="#l1.4"></a><span id="l1.4"> // 0 = blank, 1 = home (browser.startup.homepage), 2 = last</span>
<a href="#l1.5"></a><span id="l1.5"> pref(&quot;browser.startup.page&quot;,                1);</span>
<a href="#l1.6"></a><span id="l1.6"> pref(&quot;browser.startup.homepage&quot;,	   &quot;chrome://navigator-region/locale/region.properties&quot;);</span>
<a href="#l1.7"></a><span id="l1.7"> pref(&quot;browser.startup.homepage.count&quot;, 1);</span>
<a href="#l1.8"></a><span id="l1.8"> </span>
<a href="#l1.9"></a><span id="l1.9"> // disable this until it can be disabled on a per-docshell basis (see bug 319368)</span>
<a href="#l1.10"></a><span id="l1.10"> pref(&quot;browser.send_pings&quot;, false);</span>
<a href="#l1.11"></a><span id="l1.11"> </span>
<a href="#l1.12"></a><span id="l1.12" class="difflineminus">-pref(&quot;browser.urlbar.autoFill&quot;, false);</span>
<a href="#l1.13"></a><span id="l1.13" class="difflineminus">-pref(&quot;browser.urlbar.showPopup&quot;, true);</span>
<a href="#l1.14"></a><span id="l1.14" class="difflineminus">-pref(&quot;browser.urlbar.showSearch&quot;, true);</span>
<a href="#l1.15"></a><span id="l1.15" class="difflineminus">-pref(&quot;browser.urlbar.matchOnlyTyped&quot;, false);</span>
<a href="#l1.16"></a><span id="l1.16" class="difflineminus">-</span>
<a href="#l1.17"></a><span id="l1.17"> pref(&quot;browser.chrome.site_icons&quot;, true);</span>
<a href="#l1.18"></a><span id="l1.18"> pref(&quot;browser.chrome.favicons&quot;, false);</span>
<a href="#l1.19"></a><span id="l1.19"> pref(&quot;browser.chrome.image_icons.max_size&quot;, 1024);</span>
<a href="#l1.20"></a><span id="l1.20"> </span>
<a href="#l1.21"></a><span id="l1.21"> // 0 = never, 1 = when in cache, 2 = always</span>
<a href="#l1.22"></a><span id="l1.22"> pref(&quot;browser.chrome.load_toolbar_icons&quot;, 0);</span>
<a href="#l1.23"></a><span id="l1.23"> </span>
<a href="#l1.24"></a><span id="l1.24"> pref(&quot;browser.toolbars.showbutton.bookmarks&quot;, true);</span>
<a href="#l1.25"></a><span id="l1.25" class="difflineat">@@ -106,34 +101,113 @@ pref(&quot;browser.search.mode&quot;, 0);</span>
<a href="#l1.26"></a><span id="l1.26"> // basic search popup constraint: minimum sherlock plugin version displayed</span>
<a href="#l1.27"></a><span id="l1.27"> // (note: must be a string representation of a float or it'll default to 0.0)</span>
<a href="#l1.28"></a><span id="l1.28"> pref(&quot;browser.search.basic.min_ver&quot;, &quot;0.0&quot;);</span>
<a href="#l1.29"></a><span id="l1.29"> pref(&quot;browser.urlbar.autocomplete.enabled&quot;, true);</span>
<a href="#l1.30"></a><span id="l1.30"> pref(&quot;browser.urlbar.clickSelectsAll&quot;, true);</span>
<a href="#l1.31"></a><span id="l1.31"> // when clickSelectsAll=true, does it also apply when the click is past end of text?</span>
<a href="#l1.32"></a><span id="l1.32"> pref(&quot;browser.urlbar.clickAtEndSelects&quot;, true);</span>
<a href="#l1.33"></a><span id="l1.33"> </span>
<a href="#l1.34"></a><span id="l1.34" class="difflineplus">+pref(&quot;browser.urlbar.autoFill&quot;, false);</span>
<a href="#l1.35"></a><span id="l1.35" class="difflineplus">+pref(&quot;browser.urlbar.showPopup&quot;, true);</span>
<a href="#l1.36"></a><span id="l1.36" class="difflineplus">+pref(&quot;browser.urlbar.showSearch&quot;, true);</span>
<a href="#l1.37"></a><span id="l1.37" class="difflineplus">+pref(&quot;browser.urlbar.matchOnlyTyped&quot;, false);</span>
<a href="#l1.38"></a><span id="l1.38" class="difflineplus">+// 0: Match anywhere (e.g., middle of words)</span>
<a href="#l1.39"></a><span id="l1.39" class="difflineplus">+// 1: Match on word boundaries and then try matching anywhere</span>
<a href="#l1.40"></a><span id="l1.40" class="difflineplus">+// 2: Match only on word boundaries (e.g., after / or .)</span>
<a href="#l1.41"></a><span id="l1.41" class="difflineplus">+// 3: Match at the beginning of the url or title</span>
<a href="#l1.42"></a><span id="l1.42" class="difflineplus">+pref(&quot;browser.urlbar.matchBehavior&quot;, 1);</span>
<a href="#l1.43"></a><span id="l1.43" class="difflineplus">+// 0: Search nothing</span>
<a href="#l1.44"></a><span id="l1.44" class="difflineplus">+// 1: Search history (visited pages)</span>
<a href="#l1.45"></a><span id="l1.45" class="difflineplus">+// 2: Search bookmarks</span>
<a href="#l1.46"></a><span id="l1.46" class="difflineplus">+// 3: Search both history and bookmarks</span>
<a href="#l1.47"></a><span id="l1.47" class="difflineplus">+pref(&quot;browser.urlbar.search.sources&quot;, 1);</span>
<a href="#l1.48"></a><span id="l1.48" class="difflineplus">+pref(&quot;browser.urlbar.filter.javascript&quot;, true);</span>
<a href="#l1.49"></a><span id="l1.49" class="difflineplus">+</span>
<a href="#l1.50"></a><span id="l1.50" class="difflineplus">+// Size of &quot;chunks&quot; affects the number of places to process between each search</span>
<a href="#l1.51"></a><span id="l1.51" class="difflineplus">+// timeout (ms). Too big and the UI will be unresponsive; too small and we'll</span>
<a href="#l1.52"></a><span id="l1.52" class="difflineplus">+// be waiting on the timeout too often without many results.</span>
<a href="#l1.53"></a><span id="l1.53" class="difflineplus">+pref(&quot;browser.urlbar.search.chunkSize&quot;, 1000);</span>
<a href="#l1.54"></a><span id="l1.54" class="difflineplus">+pref(&quot;browser.urlbar.search.timeout&quot;, 100);</span>
<a href="#l1.55"></a><span id="l1.55" class="difflineplus">+</span>
<a href="#l1.56"></a><span id="l1.56" class="difflineplus">+// The special characters below can be typed into the urlbar to either restrict</span>
<a href="#l1.57"></a><span id="l1.57" class="difflineplus">+// the search to visited history, bookmarked, tagged pages; or force a match on</span>
<a href="#l1.58"></a><span id="l1.58" class="difflineplus">+// just the title text or url.</span>
<a href="#l1.59"></a><span id="l1.59" class="difflineplus">+pref(&quot;browser.urlbar.restrict.history&quot;, &quot;^&quot;);</span>
<a href="#l1.60"></a><span id="l1.60" class="difflineplus">+pref(&quot;browser.urlbar.restrict.bookmark&quot;, &quot;*&quot;);</span>
<a href="#l1.61"></a><span id="l1.61" class="difflineplus">+pref(&quot;browser.urlbar.restrict.tag&quot;, &quot;+&quot;);</span>
<a href="#l1.62"></a><span id="l1.62" class="difflineplus">+pref(&quot;browser.urlbar.match.title&quot;, &quot;#&quot;);</span>
<a href="#l1.63"></a><span id="l1.63" class="difflineplus">+pref(&quot;browser.urlbar.match.url&quot;, &quot;@&quot;);</span>
<a href="#l1.64"></a><span id="l1.64" class="difflineplus">+</span>
<a href="#l1.65"></a><span id="l1.65"> pref(&quot;browser.search.param.Google.1.custom&quot;, &quot;chrome://navigator/content/searchconfig.properties&quot;);</span>
<a href="#l1.66"></a><span id="l1.66"> pref(&quot;browser.search.param.Google.1.default&quot;, &quot;chrome://navigator/content/searchconfig.properties&quot;);</span>
<a href="#l1.67"></a><span id="l1.67"> </span>
<a href="#l1.68"></a><span id="l1.68"> pref(&quot;browser.history.grouping&quot;, &quot;day&quot;);</span>
<a href="#l1.69"></a><span id="l1.69"> pref(&quot;browser.sessionhistory.max_entries&quot;, 50);</span>
<a href="#l1.70"></a><span id="l1.70" class="difflineplus">+pref(&quot;browser.history_expire_days&quot;, 180);</span>
<a href="#l1.71"></a><span id="l1.71" class="difflineplus">+pref(&quot;browser.history_expire_days_min&quot;, 90);</span>
<a href="#l1.72"></a><span id="l1.72" class="difflineplus">+pref(&quot;browser.history_expire_sites&quot;, 40000);</span>
<a href="#l1.73"></a><span id="l1.73" class="difflineplus">+</span>
<a href="#l1.74"></a><span id="l1.74" class="difflineplus">+// the (maximum) number of the recent visits to sample</span>
<a href="#l1.75"></a><span id="l1.75" class="difflineplus">+// when calculating frecency</span>
<a href="#l1.76"></a><span id="l1.76" class="difflineplus">+pref(&quot;places.frecency.numVisits&quot;, 10);</span>
<a href="#l1.77"></a><span id="l1.77" class="difflineplus">+</span>
<a href="#l1.78"></a><span id="l1.78" class="difflineplus">+// Number of records to update frecency for when idle.</span>
<a href="#l1.79"></a><span id="l1.79" class="difflineplus">+pref(&quot;places.frecency.numCalcOnIdle&quot;, 50);</span>
<a href="#l1.80"></a><span id="l1.80" class="difflineplus">+</span>
<a href="#l1.81"></a><span id="l1.81" class="difflineplus">+// Number of records to update frecency for when migrating from</span>
<a href="#l1.82"></a><span id="l1.82" class="difflineplus">+// a pre-frecency build.</span>
<a href="#l1.83"></a><span id="l1.83" class="difflineplus">+pref(&quot;places.frecency.numCalcOnMigrate&quot;, 50);</span>
<a href="#l1.84"></a><span id="l1.84" class="difflineplus">+</span>
<a href="#l1.85"></a><span id="l1.85" class="difflineplus">+// Perform frecency recalculation after this amount of idle, repeating.</span>
<a href="#l1.86"></a><span id="l1.86" class="difflineplus">+// A value of zero disables updating of frecency on idle.</span>
<a href="#l1.87"></a><span id="l1.87" class="difflineplus">+// Default is 1 minute (60000ms).</span>
<a href="#l1.88"></a><span id="l1.88" class="difflineplus">+pref(&quot;places.frecency.updateIdleTime&quot;, 60000);</span>
<a href="#l1.89"></a><span id="l1.89" class="difflineplus">+</span>
<a href="#l1.90"></a><span id="l1.90" class="difflineplus">+// buckets (in days) for frecency calculation</span>
<a href="#l1.91"></a><span id="l1.91" class="difflineplus">+pref(&quot;places.frecency.firstBucketCutoff&quot;, 4);</span>
<a href="#l1.92"></a><span id="l1.92" class="difflineplus">+pref(&quot;places.frecency.secondBucketCutoff&quot;, 14);</span>
<a href="#l1.93"></a><span id="l1.93" class="difflineplus">+pref(&quot;places.frecency.thirdBucketCutoff&quot;, 31);</span>
<a href="#l1.94"></a><span id="l1.94" class="difflineplus">+pref(&quot;places.frecency.fourthBucketCutoff&quot;, 90);</span>
<a href="#l1.95"></a><span id="l1.95" class="difflineplus">+</span>
<a href="#l1.96"></a><span id="l1.96" class="difflineplus">+// weights for buckets for frecency calculations</span>
<a href="#l1.97"></a><span id="l1.97" class="difflineplus">+pref(&quot;places.frecency.firstBucketWeight&quot;, 100);</span>
<a href="#l1.98"></a><span id="l1.98" class="difflineplus">+pref(&quot;places.frecency.secondBucketWeight&quot;, 70);</span>
<a href="#l1.99"></a><span id="l1.99" class="difflineplus">+pref(&quot;places.frecency.thirdBucketWeight&quot;, 50);</span>
<a href="#l1.100"></a><span id="l1.100" class="difflineplus">+pref(&quot;places.frecency.fourthBucketWeight&quot;, 30);</span>
<a href="#l1.101"></a><span id="l1.101" class="difflineplus">+pref(&quot;places.frecency.defaultBucketWeight&quot;, 10);</span>
<a href="#l1.102"></a><span id="l1.102" class="difflineplus">+</span>
<a href="#l1.103"></a><span id="l1.103" class="difflineplus">+// bonus (in percent) for visit transition types for frecency calculations</span>
<a href="#l1.104"></a><span id="l1.104" class="difflineplus">+pref(&quot;places.frecency.embedVisitBonus&quot;, 0);</span>
<a href="#l1.105"></a><span id="l1.105" class="difflineplus">+pref(&quot;places.frecency.linkVisitBonus&quot;, 100);</span>
<a href="#l1.106"></a><span id="l1.106" class="difflineplus">+pref(&quot;places.frecency.typedVisitBonus&quot;, 2000);</span>
<a href="#l1.107"></a><span id="l1.107" class="difflineplus">+pref(&quot;places.frecency.bookmarkVisitBonus&quot;, 150);</span>
<a href="#l1.108"></a><span id="l1.108" class="difflineplus">+pref(&quot;places.frecency.downloadVisitBonus&quot;, 0);</span>
<a href="#l1.109"></a><span id="l1.109" class="difflineplus">+pref(&quot;places.frecency.permRedirectVisitBonus&quot;, 0);</span>
<a href="#l1.110"></a><span id="l1.110" class="difflineplus">+pref(&quot;places.frecency.tempRedirectVisitBonus&quot;, 0);</span>
<a href="#l1.111"></a><span id="l1.111" class="difflineplus">+pref(&quot;places.frecency.defaultVisitBonus&quot;, 0);</span>
<a href="#l1.112"></a><span id="l1.112" class="difflineplus">+</span>
<a href="#l1.113"></a><span id="l1.113" class="difflineplus">+// bonus (in percent) for place types for frecency calculations</span>
<a href="#l1.114"></a><span id="l1.114" class="difflineplus">+pref(&quot;places.frecency.unvisitedBookmarkBonus&quot;, 140);</span>
<a href="#l1.115"></a><span id="l1.115" class="difflineplus">+pref(&quot;places.frecency.unvisitedTypedBonus&quot;, 200);</span>
<a href="#l1.116"></a><span id="l1.116"> </span>
<a href="#l1.117"></a><span id="l1.117"> // Tabbed browser</span>
<a href="#l1.118"></a><span id="l1.118"> pref(&quot;browser.tabs.loadDivertedInBackground&quot;, false);</span>
<a href="#l1.119"></a><span id="l1.119"> pref(&quot;browser.tabs.loadInBackground&quot;, false);</span>
<a href="#l1.120"></a><span id="l1.120"> pref(&quot;browser.tabs.opentabfor.middleclick&quot;, false);</span>
<a href="#l1.121"></a><span id="l1.121"> pref(&quot;browser.tabs.opentabfor.urlbar&quot;, false);</span>
<a href="#l1.122"></a><span id="l1.122"> pref(&quot;browser.tabs.tooltippreview.enable&quot;, true);</span>
<a href="#l1.123"></a><span id="l1.123"> pref(&quot;browser.tabs.tooltippreview.width&quot;, 300);</span>
<a href="#l1.124"></a><span id="l1.124"> pref(&quot;browser.tabs.undoclose.depth&quot;, 3);</span>
<a href="#l1.125"></a><span id="l1.125"> pref(&quot;browser.tabs.autoHide&quot;, true);</span>
<a href="#l1.126"></a><span id="l1.126"> pref(&quot;browser.tabs.forceHide&quot;, false);</span>
<a href="#l1.127"></a><span id="l1.127"> pref(&quot;browser.tabs.warnOnClose&quot;, true);</span>
<a href="#l1.128"></a><span id="l1.128"> pref(&quot;browser.tabs.warnOnCloseOther&quot;, true);</span>
<a href="#l1.129"></a><span id="l1.129" class="difflineplus">+pref(&quot;browser.tabs.warnOnOpen&quot;, true);</span>
<a href="#l1.130"></a><span id="l1.130" class="difflineplus">+pref(&quot;browser.tabs.maxOpenBeforeWarn&quot;, 15);</span>
<a href="#l1.131"></a><span id="l1.131"> // 0 = append, 1 = replace</span>
<a href="#l1.132"></a><span id="l1.132"> pref(&quot;browser.tabs.loadGroup&quot;, 1);</span>
<a href="#l1.133"></a><span id="l1.133"> </span>
<a href="#l1.134"></a><span id="l1.134"> // lets new tab/window load something different than first window</span>
<a href="#l1.135"></a><span id="l1.135"> // -1 - use navigator startup preference</span>
<a href="#l1.136"></a><span id="l1.136"> //  0 - loads blank page</span>
<a href="#l1.137"></a><span id="l1.137"> //  1 - loads home page</span>
<a href="#l1.138"></a><span id="l1.138"> //  2 - loads last page visited</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l2.1"></a><span id="l2.1">new file mode 100755</span>
<a href="#l2.2"></a><span id="l2.2" class="difflineminus">--- /dev/null</span>
<a href="#l2.3"></a><span id="l2.3" class="difflineplus">+++ b/suite/common/history/controller.js</span>
<a href="#l2.4"></a><span id="l2.4" class="difflineat">@@ -0,0 +1,642 @@</span>
<a href="#l2.5"></a><span id="l2.5" class="difflineplus">+/* -*- Mode: C++; tab-width: 8; indent-tabs-mode: nil; c-basic-offset: 2 -*- */</span>
<a href="#l2.6"></a><span id="l2.6" class="difflineplus">+/* ***** BEGIN LICENSE BLOCK *****</span>
<a href="#l2.7"></a><span id="l2.7" class="difflineplus">+ * Version: MPL 1.1/GPL 2.0/LGPL 2.1</span>
<a href="#l2.8"></a><span id="l2.8" class="difflineplus">+ *</span>
<a href="#l2.9"></a><span id="l2.9" class="difflineplus">+ * The contents of this file are subject to the Mozilla Public License Version</span>
<a href="#l2.10"></a><span id="l2.10" class="difflineplus">+ * 1.1 (the &quot;License&quot;); you may not use this file except in compliance with</span>
<a href="#l2.11"></a><span id="l2.11" class="difflineplus">+ * the License. You may obtain a copy of the License at</span>
<a href="#l2.12"></a><span id="l2.12" class="difflineplus">+ * http://www.mozilla.org/MPL/</span>
<a href="#l2.13"></a><span id="l2.13" class="difflineplus">+ *</span>
<a href="#l2.14"></a><span id="l2.14" class="difflineplus">+ * Software distributed under the License is distributed on an &quot;AS IS&quot; basis,</span>
<a href="#l2.15"></a><span id="l2.15" class="difflineplus">+ * WITHOUT WARRANTY OF ANY KIND, either express or implied. See the License</span>
<a href="#l2.16"></a><span id="l2.16" class="difflineplus">+ * for the specific language governing rights and limitations under the</span>
<a href="#l2.17"></a><span id="l2.17" class="difflineplus">+ * License.</span>
<a href="#l2.18"></a><span id="l2.18" class="difflineplus">+ *</span>
<a href="#l2.19"></a><span id="l2.19" class="difflineplus">+ * The Original Code is the Places Command Controller.</span>
<a href="#l2.20"></a><span id="l2.20" class="difflineplus">+ *</span>
<a href="#l2.21"></a><span id="l2.21" class="difflineplus">+ * The Initial Developer of the Original Code is Google Inc.</span>
<a href="#l2.22"></a><span id="l2.22" class="difflineplus">+ * Portions created by the Initial Developer are Copyright (C) 2005</span>
<a href="#l2.23"></a><span id="l2.23" class="difflineplus">+ * the Initial Developer. All Rights Reserved.</span>
<a href="#l2.24"></a><span id="l2.24" class="difflineplus">+ *</span>
<a href="#l2.25"></a><span id="l2.25" class="difflineplus">+ * Contributor(s):</span>
<a href="#l2.26"></a><span id="l2.26" class="difflineplus">+ *   Ben Goodger &lt;beng@google.com&gt;</span>
<a href="#l2.27"></a><span id="l2.27" class="difflineplus">+ *   Myk Melez &lt;myk@mozilla.org&gt;</span>
<a href="#l2.28"></a><span id="l2.28" class="difflineplus">+ *   Asaf Romano &lt;mano@mozilla.com&gt;</span>
<a href="#l2.29"></a><span id="l2.29" class="difflineplus">+ *   Marco Bonardo &lt;mak77@bonardo.net&gt;</span>
<a href="#l2.30"></a><span id="l2.30" class="difflineplus">+ *</span>
<a href="#l2.31"></a><span id="l2.31" class="difflineplus">+ * Alternatively, the contents of this file may be used under the terms of</span>
<a href="#l2.32"></a><span id="l2.32" class="difflineplus">+ * either the GNU General Public License Version 2 or later (the &quot;GPL&quot;), or</span>
<a href="#l2.33"></a><span id="l2.33" class="difflineplus">+ * the GNU Lesser General Public License Version 2.1 or later (the &quot;LGPL&quot;),</span>
<a href="#l2.34"></a><span id="l2.34" class="difflineplus">+ * in which case the provisions of the GPL or the LGPL are applicable instead</span>
<a href="#l2.35"></a><span id="l2.35" class="difflineplus">+ * of those above. If you wish to allow use of your version of this file only</span>
<a href="#l2.36"></a><span id="l2.36" class="difflineplus">+ * under the terms of either the GPL or the LGPL, and not to allow others to</span>
<a href="#l2.37"></a><span id="l2.37" class="difflineplus">+ * use your version of this file under the terms of the MPL, indicate your</span>
<a href="#l2.38"></a><span id="l2.38" class="difflineplus">+ * decision by deleting the provisions above and replace them with the notice</span>
<a href="#l2.39"></a><span id="l2.39" class="difflineplus">+ * and other provisions required by the GPL or the LGPL. If you do not delete</span>
<a href="#l2.40"></a><span id="l2.40" class="difflineplus">+ * the provisions above, a recipient may use your version of this file under</span>
<a href="#l2.41"></a><span id="l2.41" class="difflineplus">+ * the terms of any one of the MPL, the GPL or the LGPL.</span>
<a href="#l2.42"></a><span id="l2.42" class="difflineplus">+ *</span>
<a href="#l2.43"></a><span id="l2.43" class="difflineplus">+ * ***** END LICENSE BLOCK ***** */</span>
<a href="#l2.44"></a><span id="l2.44" class="difflineplus">+</span>
<a href="#l2.45"></a><span id="l2.45" class="difflineplus">+// XXXmano: we should move most/all of these constants to PlacesUtils</span>
<a href="#l2.46"></a><span id="l2.46" class="difflineplus">+const ORGANIZER_ROOT_BOOKMARKS = &quot;place:folder=BOOKMARKS_MENU&amp;excludeItems=1&amp;queryType=1&quot;;</span>
<a href="#l2.47"></a><span id="l2.47" class="difflineplus">+const ORGANIZER_SUBSCRIPTIONS_QUERY = &quot;place:annotation=livemark%2FfeedURI&quot;;</span>
<a href="#l2.48"></a><span id="l2.48" class="difflineplus">+</span>
<a href="#l2.49"></a><span id="l2.49" class="difflineplus">+// when removing a bunch of pages we split them in chunks to avoid passing</span>
<a href="#l2.50"></a><span id="l2.50" class="difflineplus">+// a too big array to RemovePages</span>
<a href="#l2.51"></a><span id="l2.51" class="difflineplus">+// 300 is the best choice with an history of about 150000 visits</span>
<a href="#l2.52"></a><span id="l2.52" class="difflineplus">+// smaller chunks could cause a Slow Script warning with a huge history</span>
<a href="#l2.53"></a><span id="l2.53" class="difflineplus">+const REMOVE_PAGES_CHUNKLEN = 300;</span>
<a href="#l2.54"></a><span id="l2.54" class="difflineplus">+// if we are removing less than this pages we will remove them one by one</span>
<a href="#l2.55"></a><span id="l2.55" class="difflineplus">+// since it will be reflected faster on the UI</span>
<a href="#l2.56"></a><span id="l2.56" class="difflineplus">+// 10 is a good compromise, since allows the user to delete a little amount of</span>
<a href="#l2.57"></a><span id="l2.57" class="difflineplus">+// urls for privacy reasons, but does not cause heavy disk access</span>
<a href="#l2.58"></a><span id="l2.58" class="difflineplus">+const REMOVE_PAGES_MAX_SINGLEREMOVES = 10;</span>
<a href="#l2.59"></a><span id="l2.59" class="difflineplus">+</span>
<a href="#l2.60"></a><span id="l2.60" class="difflineplus">+/**</span>
<a href="#l2.61"></a><span id="l2.61" class="difflineplus">+ * Places Controller</span>
<a href="#l2.62"></a><span id="l2.62" class="difflineplus">+ */</span>
<a href="#l2.63"></a><span id="l2.63" class="difflineplus">+</span>
<a href="#l2.64"></a><span id="l2.64" class="difflineplus">+function PlacesController(aView) {</span>
<a href="#l2.65"></a><span id="l2.65" class="difflineplus">+  this._view = aView;</span>
<a href="#l2.66"></a><span id="l2.66" class="difflineplus">+}</span>
<a href="#l2.67"></a><span id="l2.67" class="difflineplus">+</span>
<a href="#l2.68"></a><span id="l2.68" class="difflineplus">+PlacesController.prototype = {</span>
<a href="#l2.69"></a><span id="l2.69" class="difflineplus">+  /**</span>
<a href="#l2.70"></a><span id="l2.70" class="difflineplus">+   * The places view.</span>
<a href="#l2.71"></a><span id="l2.71" class="difflineplus">+   */</span>
<a href="#l2.72"></a><span id="l2.72" class="difflineplus">+  _view: null,</span>
<a href="#l2.73"></a><span id="l2.73" class="difflineplus">+</span>
<a href="#l2.74"></a><span id="l2.74" class="difflineplus">+  supportsCommand: function PC_supportsCommand(aCommand) {</span>
<a href="#l2.75"></a><span id="l2.75" class="difflineplus">+    //LOG(&quot;supportsCommand: &quot; + command);</span>
<a href="#l2.76"></a><span id="l2.76" class="difflineplus">+    // Non-Places specific commands that we also support</span>
<a href="#l2.77"></a><span id="l2.77" class="difflineplus">+    switch (aCommand) {</span>
<a href="#l2.78"></a><span id="l2.78" class="difflineplus">+    case &quot;cmd_cut&quot;:</span>
<a href="#l2.79"></a><span id="l2.79" class="difflineplus">+    case &quot;cmd_copy&quot;:</span>
<a href="#l2.80"></a><span id="l2.80" class="difflineplus">+    case &quot;cmd_delete&quot;:</span>
<a href="#l2.81"></a><span id="l2.81" class="difflineplus">+    case &quot;cmd_selectAll&quot;:</span>
<a href="#l2.82"></a><span id="l2.82" class="difflineplus">+      return true;</span>
<a href="#l2.83"></a><span id="l2.83" class="difflineplus">+    }</span>
<a href="#l2.84"></a><span id="l2.84" class="difflineplus">+</span>
<a href="#l2.85"></a><span id="l2.85" class="difflineplus">+    // All other Places Commands are prefixed with &quot;placesCmd_&quot; ... this</span>
<a href="#l2.86"></a><span id="l2.86" class="difflineplus">+    // filters out other commands that we do _not_ support (see 329587).</span>
<a href="#l2.87"></a><span id="l2.87" class="difflineplus">+    return (/^placesCmd_/.test(aCommand));</span>
<a href="#l2.88"></a><span id="l2.88" class="difflineplus">+  },</span>
<a href="#l2.89"></a><span id="l2.89" class="difflineplus">+</span>
<a href="#l2.90"></a><span id="l2.90" class="difflineplus">+  isCommandEnabled: function PC_isCommandEnabled(aCommand) {</span>
<a href="#l2.91"></a><span id="l2.91" class="difflineplus">+    switch (aCommand) {</span>
<a href="#l2.92"></a><span id="l2.92" class="difflineplus">+    case &quot;cmd_cut&quot;:</span>
<a href="#l2.93"></a><span id="l2.93" class="difflineplus">+    case &quot;cmd_delete&quot;:</span>
<a href="#l2.94"></a><span id="l2.94" class="difflineplus">+      return true; // history items can always be deleted</span>
<a href="#l2.95"></a><span id="l2.95" class="difflineplus">+    case &quot;cmd_copy&quot;:</span>
<a href="#l2.96"></a><span id="l2.96" class="difflineplus">+      return this._view.hasSelection;</span>
<a href="#l2.97"></a><span id="l2.97" class="difflineplus">+    case &quot;cmd_selectAll&quot;:</span>
<a href="#l2.98"></a><span id="l2.98" class="difflineplus">+      if (this._view.selType != &quot;single&quot;) {</span>
<a href="#l2.99"></a><span id="l2.99" class="difflineplus">+        var result = this._view.getResult();</span>
<a href="#l2.100"></a><span id="l2.100" class="difflineplus">+        if (result) {</span>
<a href="#l2.101"></a><span id="l2.101" class="difflineplus">+          var container = asContainer(result.root);</span>
<a href="#l2.102"></a><span id="l2.102" class="difflineplus">+          if (container.childCount &gt; 0);</span>
<a href="#l2.103"></a><span id="l2.103" class="difflineplus">+            return true;</span>
<a href="#l2.104"></a><span id="l2.104" class="difflineplus">+        }</span>
<a href="#l2.105"></a><span id="l2.105" class="difflineplus">+      }</span>
<a href="#l2.106"></a><span id="l2.106" class="difflineplus">+      return false;</span>
<a href="#l2.107"></a><span id="l2.107" class="difflineplus">+    case &quot;placesCmd_open&quot;:</span>
<a href="#l2.108"></a><span id="l2.108" class="difflineplus">+    case &quot;placesCmd_open:window&quot;:</span>
<a href="#l2.109"></a><span id="l2.109" class="difflineplus">+    case &quot;placesCmd_open:tab&quot;:</span>
<a href="#l2.110"></a><span id="l2.110" class="difflineplus">+      var selectedNode = this._view.selectedNode;</span>
<a href="#l2.111"></a><span id="l2.111" class="difflineplus">+      return selectedNode &amp;&amp; PlacesUtils.nodeIsURI(selectedNode);</span>
<a href="#l2.112"></a><span id="l2.112" class="difflineplus">+    default:</span>
<a href="#l2.113"></a><span id="l2.113" class="difflineplus">+      return false;</span>
<a href="#l2.114"></a><span id="l2.114" class="difflineplus">+    }</span>
<a href="#l2.115"></a><span id="l2.115" class="difflineplus">+  },</span>
<a href="#l2.116"></a><span id="l2.116" class="difflineplus">+</span>
<a href="#l2.117"></a><span id="l2.117" class="difflineplus">+  doCommand: function PC_doCommand(aCommand) {</span>
<a href="#l2.118"></a><span id="l2.118" class="difflineplus">+    switch (aCommand) {</span>
<a href="#l2.119"></a><span id="l2.119" class="difflineplus">+    case &quot;cmd_cut&quot;:</span>
<a href="#l2.120"></a><span id="l2.120" class="difflineplus">+      this.cut();</span>
<a href="#l2.121"></a><span id="l2.121" class="difflineplus">+      break;</span>
<a href="#l2.122"></a><span id="l2.122" class="difflineplus">+    case &quot;cmd_copy&quot;:</span>
<a href="#l2.123"></a><span id="l2.123" class="difflineplus">+      this.copy();</span>
<a href="#l2.124"></a><span id="l2.124" class="difflineplus">+      break;</span>
<a href="#l2.125"></a><span id="l2.125" class="difflineplus">+    case &quot;cmd_delete&quot;:</span>
<a href="#l2.126"></a><span id="l2.126" class="difflineplus">+      this._removeRowsFromHistory();</span>
<a href="#l2.127"></a><span id="l2.127" class="difflineplus">+      break;</span>
<a href="#l2.128"></a><span id="l2.128" class="difflineplus">+    case &quot;cmd_selectAll&quot;:</span>
<a href="#l2.129"></a><span id="l2.129" class="difflineplus">+      this.selectAll();</span>
<a href="#l2.130"></a><span id="l2.130" class="difflineplus">+      break;</span>
<a href="#l2.131"></a><span id="l2.131" class="difflineplus">+    case &quot;placesCmd_open&quot;:</span>
<a href="#l2.132"></a><span id="l2.132" class="difflineplus">+      PlacesUIUtils.openNodeIn(this._view.selectedNode, &quot;current&quot;);</span>
<a href="#l2.133"></a><span id="l2.133" class="difflineplus">+      break;</span>
<a href="#l2.134"></a><span id="l2.134" class="difflineplus">+    case &quot;placesCmd_open:window&quot;:</span>
<a href="#l2.135"></a><span id="l2.135" class="difflineplus">+      PlacesUIUtils.openNodeIn(this._view.selectedNode, &quot;window&quot;);</span>
<a href="#l2.136"></a><span id="l2.136" class="difflineplus">+      break;</span>
<a href="#l2.137"></a><span id="l2.137" class="difflineplus">+    case &quot;placesCmd_open:tab&quot;:</span>
<a href="#l2.138"></a><span id="l2.138" class="difflineplus">+      PlacesUIUtils.openNodeIn(this._view.selectedNode, &quot;tab&quot;);</span>
<a href="#l2.139"></a><span id="l2.139" class="difflineplus">+      break;</span>
<a href="#l2.140"></a><span id="l2.140" class="difflineplus">+    }</span>
<a href="#l2.141"></a><span id="l2.141" class="difflineplus">+  },</span>
<a href="#l2.142"></a><span id="l2.142" class="difflineplus">+</span>
<a href="#l2.143"></a><span id="l2.143" class="difflineplus">+  onEvent: function PC_onEvent(eventName) { },</span>
<a href="#l2.144"></a><span id="l2.144" class="difflineplus">+</span>
<a href="#l2.145"></a><span id="l2.145" class="difflineplus">+  /**</span>
<a href="#l2.146"></a><span id="l2.146" class="difflineplus">+   * Gathers information about the selected nodes according to the following</span>
<a href="#l2.147"></a><span id="l2.147" class="difflineplus">+   * rules:</span>
<a href="#l2.148"></a><span id="l2.148" class="difflineplus">+   *    &quot;link&quot;              node is a URI</span>
<a href="#l2.149"></a><span id="l2.149" class="difflineplus">+   *    &quot;folder&quot;            node is a folder</span>
<a href="#l2.150"></a><span id="l2.150" class="difflineplus">+   *    &quot;query&quot;             node is a query</span>
<a href="#l2.151"></a><span id="l2.151" class="difflineplus">+   *    &quot;dynamiccontainer&quot;  node is a dynamic container</span>
<a href="#l2.152"></a><span id="l2.152" class="difflineplus">+   *    &quot;host&quot;              node is a host</span>
<a href="#l2.153"></a><span id="l2.153" class="difflineplus">+   *    &quot;day&quot;               node is a date query</span>
<a href="#l2.154"></a><span id="l2.154" class="difflineplus">+   *</span>
<a href="#l2.155"></a><span id="l2.155" class="difflineplus">+   * @returns an array of objects corresponding the selected nodes. Each</span>
<a href="#l2.156"></a><span id="l2.156" class="difflineplus">+   *          object has each of the properties above set if its corresponding</span>
<a href="#l2.157"></a><span id="l2.157" class="difflineplus">+   *          node matches the rule. In addition, the annotations names for each</span>
<a href="#l2.158"></a><span id="l2.158" class="difflineplus">+   *          node are set on its corresponding object as properties.</span>
<a href="#l2.159"></a><span id="l2.159" class="difflineplus">+   * Notes:</span>
<a href="#l2.160"></a><span id="l2.160" class="difflineplus">+   *   1) This can be slow, so don't call it anywhere performance critical!</span>
<a href="#l2.161"></a><span id="l2.161" class="difflineplus">+   *   2) A single-object array corresponding the root node is returned if</span>
<a href="#l2.162"></a><span id="l2.162" class="difflineplus">+   *      there's no selection.</span>
<a href="#l2.163"></a><span id="l2.163" class="difflineplus">+   */</span>
<a href="#l2.164"></a><span id="l2.164" class="difflineplus">+  _buildSelectionMetadata: function PC__buildSelectionMetadata() {</span>
<a href="#l2.165"></a><span id="l2.165" class="difflineplus">+    var metadata = [];</span>
<a href="#l2.166"></a><span id="l2.166" class="difflineplus">+    var root = this._view.getResult().root;</span>
<a href="#l2.167"></a><span id="l2.167" class="difflineplus">+    var nodes = this._view.getSelectionNodes();</span>
<a href="#l2.168"></a><span id="l2.168" class="difflineplus">+    if (nodes.length == 0)</span>
<a href="#l2.169"></a><span id="l2.169" class="difflineplus">+      nodes.push(root); // See the second note above</span>
<a href="#l2.170"></a><span id="l2.170" class="difflineplus">+</span>
<a href="#l2.171"></a><span id="l2.171" class="difflineplus">+    for (var i=0; i &lt; nodes.length; i++) {</span>
<a href="#l2.172"></a><span id="l2.172" class="difflineplus">+      var nodeData = {};</span>
<a href="#l2.173"></a><span id="l2.173" class="difflineplus">+      var node = nodes[i];</span>
<a href="#l2.174"></a><span id="l2.174" class="difflineplus">+      var nodeType = node.type;</span>
<a href="#l2.175"></a><span id="l2.175" class="difflineplus">+      var uri = null;</span>
<a href="#l2.176"></a><span id="l2.176" class="difflineplus">+</span>
<a href="#l2.177"></a><span id="l2.177" class="difflineplus">+      // We don't use the nodeIs* methods here to avoid going through the type</span>
<a href="#l2.178"></a><span id="l2.178" class="difflineplus">+      // property way too often</span>
<a href="#l2.179"></a><span id="l2.179" class="difflineplus">+      switch(nodeType) {</span>
<a href="#l2.180"></a><span id="l2.180" class="difflineplus">+        case Components.interfaces.nsINavHistoryResultNode.RESULT_TYPE_QUERY:</span>
<a href="#l2.181"></a><span id="l2.181" class="difflineplus">+          nodeData[&quot;query&quot;] = true;</span>
<a href="#l2.182"></a><span id="l2.182" class="difflineplus">+          if (node.parent) {</span>
<a href="#l2.183"></a><span id="l2.183" class="difflineplus">+            switch (asQuery(node.parent).queryOptions.resultType) {</span>
<a href="#l2.184"></a><span id="l2.184" class="difflineplus">+              case Components.interfaces.nsINavHistoryQueryOptions.RESULTS_AS_SITE_QUERY:</span>
<a href="#l2.185"></a><span id="l2.185" class="difflineplus">+                nodeData[&quot;host&quot;] = true;</span>
<a href="#l2.186"></a><span id="l2.186" class="difflineplus">+                break;</span>
<a href="#l2.187"></a><span id="l2.187" class="difflineplus">+              case Components.interfaces.nsINavHistoryQueryOptions.RESULTS_AS_DATE_SITE_QUERY:</span>
<a href="#l2.188"></a><span id="l2.188" class="difflineplus">+              case Components.interfaces.nsINavHistoryQueryOptions.RESULTS_AS_DATE_QUERY:</span>
<a href="#l2.189"></a><span id="l2.189" class="difflineplus">+                nodeData[&quot;day&quot;] = true;</span>
<a href="#l2.190"></a><span id="l2.190" class="difflineplus">+                break;</span>
<a href="#l2.191"></a><span id="l2.191" class="difflineplus">+            }</span>
<a href="#l2.192"></a><span id="l2.192" class="difflineplus">+          }</span>
<a href="#l2.193"></a><span id="l2.193" class="difflineplus">+          break;</span>
<a href="#l2.194"></a><span id="l2.194" class="difflineplus">+        case Components.interfaces.nsINavHistoryResultNode.RESULT_TYPE_DYNAMIC_CONTAINER:</span>
<a href="#l2.195"></a><span id="l2.195" class="difflineplus">+          nodeData[&quot;dynamiccontainer&quot;] = true;</span>
<a href="#l2.196"></a><span id="l2.196" class="difflineplus">+          break;</span>
<a href="#l2.197"></a><span id="l2.197" class="difflineplus">+        case Components.interfaces.nsINavHistoryResultNode.RESULT_TYPE_FOLDER:</span>
<a href="#l2.198"></a><span id="l2.198" class="difflineplus">+        case Components.interfaces.nsINavHistoryResultNode.RESULT_TYPE_FOLDER_SHORTCUT:</span>
<a href="#l2.199"></a><span id="l2.199" class="difflineplus">+          nodeData[&quot;folder&quot;] = true;</span>
<a href="#l2.200"></a><span id="l2.200" class="difflineplus">+          break;</span>
<a href="#l2.201"></a><span id="l2.201" class="difflineplus">+        case Components.interfaces.nsINavHistoryResultNode.RESULT_TYPE_URI:</span>
<a href="#l2.202"></a><span id="l2.202" class="difflineplus">+        case Components.interfaces.nsINavHistoryResultNode.RESULT_TYPE_VISIT:</span>
<a href="#l2.203"></a><span id="l2.203" class="difflineplus">+        case Components.interfaces.nsINavHistoryResultNode.RESULT_TYPE_FULL_VISIT:</span>
<a href="#l2.204"></a><span id="l2.204" class="difflineplus">+          nodeData[&quot;link&quot;] = true;</span>
<a href="#l2.205"></a><span id="l2.205" class="difflineplus">+          uri = PlacesUtils._uri(node.uri);</span>
<a href="#l2.206"></a><span id="l2.206" class="difflineplus">+          break;</span>
<a href="#l2.207"></a><span id="l2.207" class="difflineplus">+      }</span>
<a href="#l2.208"></a><span id="l2.208" class="difflineplus">+</span>
<a href="#l2.209"></a><span id="l2.209" class="difflineplus">+      // annotations</span>
<a href="#l2.210"></a><span id="l2.210" class="difflineplus">+      if (uri) {</span>
<a href="#l2.211"></a><span id="l2.211" class="difflineplus">+        var names = PlacesUtils.annotations.getPageAnnotationNames(uri, {});</span>
<a href="#l2.212"></a><span id="l2.212" class="difflineplus">+        for (var j = 0; j &lt; names.length; ++j)</span>
<a href="#l2.213"></a><span id="l2.213" class="difflineplus">+          nodeData[names[j]] = true;</span>
<a href="#l2.214"></a><span id="l2.214" class="difflineplus">+      }</span>
<a href="#l2.215"></a><span id="l2.215" class="difflineplus">+</span>
<a href="#l2.216"></a><span id="l2.216" class="difflineplus">+      // For items also include the item-specific annotations</span>
<a href="#l2.217"></a><span id="l2.217" class="difflineplus">+      if (node.itemId != -1) {</span>
<a href="#l2.218"></a><span id="l2.218" class="difflineplus">+        names = PlacesUtils.annotations</span>
<a href="#l2.219"></a><span id="l2.219" class="difflineplus">+                           .getItemAnnotationNames(node.itemId, {});</span>
<a href="#l2.220"></a><span id="l2.220" class="difflineplus">+        for (j = 0; j &lt; names.length; ++j)</span>
<a href="#l2.221"></a><span id="l2.221" class="difflineplus">+          nodeData[names[j]] = true;</span>
<a href="#l2.222"></a><span id="l2.222" class="difflineplus">+      }</span>
<a href="#l2.223"></a><span id="l2.223" class="difflineplus">+      metadata.push(nodeData);</span>
<a href="#l2.224"></a><span id="l2.224" class="difflineplus">+    }</span>
<a href="#l2.225"></a><span id="l2.225" class="difflineplus">+</span>
<a href="#l2.226"></a><span id="l2.226" class="difflineplus">+    return metadata;</span>
<a href="#l2.227"></a><span id="l2.227" class="difflineplus">+  },</span>
<a href="#l2.228"></a><span id="l2.228" class="difflineplus">+</span>
<a href="#l2.229"></a><span id="l2.229" class="difflineplus">+  /**</span>
<a href="#l2.230"></a><span id="l2.230" class="difflineplus">+   * Determines if a context-menu item should be shown</span>
<a href="#l2.231"></a><span id="l2.231" class="difflineplus">+   * @param   aMenuItem</span>
<a href="#l2.232"></a><span id="l2.232" class="difflineplus">+   *          the context menu item</span>
<a href="#l2.233"></a><span id="l2.233" class="difflineplus">+   * @param   aMetaData</span>
<a href="#l2.234"></a><span id="l2.234" class="difflineplus">+   *          meta data about the selection</span>
<a href="#l2.235"></a><span id="l2.235" class="difflineplus">+   * @returns true if the conditions (see buildContextMenu) are satisfied</span>
<a href="#l2.236"></a><span id="l2.236" class="difflineplus">+   *          and the item can be displayed, false otherwise.</span>
<a href="#l2.237"></a><span id="l2.237" class="difflineplus">+   */</span>
<a href="#l2.238"></a><span id="l2.238" class="difflineplus">+  _shouldShowMenuItem: function PC__shouldShowMenuItem(aMenuItem, aMetaData) {</span>
<a href="#l2.239"></a><span id="l2.239" class="difflineplus">+    var selectiontype = aMenuItem.getAttribute(&quot;selectiontype&quot;);</span>
<a href="#l2.240"></a><span id="l2.240" class="difflineplus">+    if (selectiontype == &quot;multiple&quot; &amp;&amp; aMetaData.length == 1)</span>
<a href="#l2.241"></a><span id="l2.241" class="difflineplus">+      return false;</span>
<a href="#l2.242"></a><span id="l2.242" class="difflineplus">+    if (selectiontype == &quot;single&quot; &amp;&amp; aMetaData.length != 1)</span>
<a href="#l2.243"></a><span id="l2.243" class="difflineplus">+      return false;</span>
<a href="#l2.244"></a><span id="l2.244" class="difflineplus">+</span>
<a href="#l2.245"></a><span id="l2.245" class="difflineplus">+    var forceHideRules = aMenuItem.getAttribute(&quot;forcehideselection&quot;).split(&quot;|&quot;);</span>
<a href="#l2.246"></a><span id="l2.246" class="difflineplus">+    for (var i = 0; i &lt; aMetaData.length; ++i) {</span>
<a href="#l2.247"></a><span id="l2.247" class="difflineplus">+      for (var j=0; j &lt; forceHideRules.length; ++j) {</span>
<a href="#l2.248"></a><span id="l2.248" class="difflineplus">+        if (forceHideRules[j] in aMetaData[i])</span>
<a href="#l2.249"></a><span id="l2.249" class="difflineplus">+          return false;</span>
<a href="#l2.250"></a><span id="l2.250" class="difflineplus">+      }</span>
<a href="#l2.251"></a><span id="l2.251" class="difflineplus">+    }</span>
<a href="#l2.252"></a><span id="l2.252" class="difflineplus">+</span>
<a href="#l2.253"></a><span id="l2.253" class="difflineplus">+    var selectionAttr = aMenuItem.getAttribute(&quot;selection&quot;);</span>
<a href="#l2.254"></a><span id="l2.254" class="difflineplus">+    if (selectionAttr) {</span>
<a href="#l2.255"></a><span id="l2.255" class="difflineplus">+      if (selectionAttr == &quot;any&quot;)</span>
<a href="#l2.256"></a><span id="l2.256" class="difflineplus">+        return true;</span>
<a href="#l2.257"></a><span id="l2.257" class="difflineplus">+</span>
<a href="#l2.258"></a><span id="l2.258" class="difflineplus">+      var showRules = selectionAttr.split(&quot;|&quot;);</span>
<a href="#l2.259"></a><span id="l2.259" class="difflineplus">+      var anyMatched = false;</span>
<a href="#l2.260"></a><span id="l2.260" class="difflineplus">+      function metaDataNodeMatches(metaDataNode, rules) {</span>
<a href="#l2.261"></a><span id="l2.261" class="difflineplus">+        for (var i=0; i &lt; rules.length; i++) {</span>
<a href="#l2.262"></a><span id="l2.262" class="difflineplus">+          if (rules[i] in metaDataNode)</span>
<a href="#l2.263"></a><span id="l2.263" class="difflineplus">+            return true;</span>
<a href="#l2.264"></a><span id="l2.264" class="difflineplus">+        }</span>
<a href="#l2.265"></a><span id="l2.265" class="difflineplus">+</span>
<a href="#l2.266"></a><span id="l2.266" class="difflineplus">+        return false;</span>
<a href="#l2.267"></a><span id="l2.267" class="difflineplus">+      }</span>
<a href="#l2.268"></a><span id="l2.268" class="difflineplus">+      for (var i = 0; i &lt; aMetaData.length; ++i) {</span>
<a href="#l2.269"></a><span id="l2.269" class="difflineplus">+        if (metaDataNodeMatches(aMetaData[i], showRules))</span>
<a href="#l2.270"></a><span id="l2.270" class="difflineplus">+          anyMatched = true;</span>
<a href="#l2.271"></a><span id="l2.271" class="difflineplus">+        else</span>
<a href="#l2.272"></a><span id="l2.272" class="difflineplus">+          return false;</span>
<a href="#l2.273"></a><span id="l2.273" class="difflineplus">+      }</span>
<a href="#l2.274"></a><span id="l2.274" class="difflineplus">+      return anyMatched;</span>
<a href="#l2.275"></a><span id="l2.275" class="difflineplus">+    }</span>
<a href="#l2.276"></a><span id="l2.276" class="difflineplus">+</span>
<a href="#l2.277"></a><span id="l2.277" class="difflineplus">+    return !aMenuItem.hidden;</span>
<a href="#l2.278"></a><span id="l2.278" class="difflineplus">+  },</span>
<a href="#l2.279"></a><span id="l2.279" class="difflineplus">+</span>
<a href="#l2.280"></a><span id="l2.280" class="difflineplus">+  /**</span>
<a href="#l2.281"></a><span id="l2.281" class="difflineplus">+   * Detects information (meta-data rules) about the current selection in the</span>
<a href="#l2.282"></a><span id="l2.282" class="difflineplus">+   * view (see _buildSelectionMetadata) and sets the visibility state for each</span>
<a href="#l2.283"></a><span id="l2.283" class="difflineplus">+   * of the menu-items in the given popup with the following rules applied:</span>
<a href="#l2.284"></a><span id="l2.284" class="difflineplus">+   *  1) The &quot;selectiontype&quot; attribute may be set on a menu-item to &quot;single&quot;</span>
<a href="#l2.285"></a><span id="l2.285" class="difflineplus">+   *     if the menu-item should be visible only if there is a single node</span>
<a href="#l2.286"></a><span id="l2.286" class="difflineplus">+   *     selected, or to &quot;multiple&quot; if the menu-item should be visible only if</span>
<a href="#l2.287"></a><span id="l2.287" class="difflineplus">+   *     multiple nodes are selected. If the attribute is not set or if it is</span>
<a href="#l2.288"></a><span id="l2.288" class="difflineplus">+   *     set to an invalid value, the menu-item may be visible for both types of</span>
<a href="#l2.289"></a><span id="l2.289" class="difflineplus">+   *     selection.</span>
<a href="#l2.290"></a><span id="l2.290" class="difflineplus">+   *  2) The &quot;selection&quot; attribute may be set on a menu-item to the various</span>
<a href="#l2.291"></a><span id="l2.291" class="difflineplus">+   *     meta-data rules for which it may be visible. The rules should be</span>
<a href="#l2.292"></a><span id="l2.292" class="difflineplus">+   *     separated with the | character.</span>
<a href="#l2.293"></a><span id="l2.293" class="difflineplus">+   *  3) A menu-item may be visible only if at least one of the rules set in</span>
<a href="#l2.294"></a><span id="l2.294" class="difflineplus">+   *     its selection attribute apply to each of the selected nodes in the</span>
<a href="#l2.295"></a><span id="l2.295" class="difflineplus">+   *     view.</span>
<a href="#l2.296"></a><span id="l2.296" class="difflineplus">+   *  4) The &quot;forcehideselection&quot; attribute may be set on a menu-item to rules</span>
<a href="#l2.297"></a><span id="l2.297" class="difflineplus">+   *     for which it should be hidden. This attribute takes priority over the</span>
<a href="#l2.298"></a><span id="l2.298" class="difflineplus">+   *     selection attribute. A menu-item would be hidden if at least one of the</span>
<a href="#l2.299"></a><span id="l2.299" class="difflineplus">+   *     given rules apply to one of the selected nodes. The rules should be</span>
<a href="#l2.300"></a><span id="l2.300" class="difflineplus">+   *     separated with the | character.</span>
<a href="#l2.301"></a><span id="l2.301" class="difflineplus">+   *  5) The visibility state of a menu-item is unchanged if none of this</span>
<a href="#l2.302"></a><span id="l2.302" class="difflineplus">+   *     attribute is set.</span>
<a href="#l2.303"></a><span id="l2.303" class="difflineplus">+   *  6) This attribute should not be set on separators for which the</span>
<a href="#l2.304"></a><span id="l2.304" class="difflineplus">+   *     visibility state is &quot;auto-detected.&quot;</span>
<a href="#l2.305"></a><span id="l2.305" class="difflineplus">+   * @param   aPopup</span>
<a href="#l2.306"></a><span id="l2.306" class="difflineplus">+   *          The menupopup to build children into.</span>
<a href="#l2.307"></a><span id="l2.307" class="difflineplus">+   * @return true if at least one item is visible, false otherwise.</span>
<a href="#l2.308"></a><span id="l2.308" class="difflineplus">+   */</span>
<a href="#l2.309"></a><span id="l2.309" class="difflineplus">+  buildContextMenu: function PC_buildContextMenu(aPopup) {</span>
<a href="#l2.310"></a><span id="l2.310" class="difflineplus">+    var metadata = this._buildSelectionMetadata();</span>
<a href="#l2.311"></a><span id="l2.311" class="difflineplus">+</span>
<a href="#l2.312"></a><span id="l2.312" class="difflineplus">+    var separator = null;</span>
<a href="#l2.313"></a><span id="l2.313" class="difflineplus">+    var visibleItemsBeforeSep = false;</span>
<a href="#l2.314"></a><span id="l2.314" class="difflineplus">+    var anyVisible = false;</span>
<a href="#l2.315"></a><span id="l2.315" class="difflineplus">+    for (var i = 0; i &lt; aPopup.childNodes.length; ++i) {</span>
<a href="#l2.316"></a><span id="l2.316" class="difflineplus">+      var item = aPopup.childNodes[i];</span>
<a href="#l2.317"></a><span id="l2.317" class="difflineplus">+      if (item.localName != &quot;menuseparator&quot;) {</span>
<a href="#l2.318"></a><span id="l2.318" class="difflineplus">+        item.hidden = !this._shouldShowMenuItem(item, metadata);</span>
<a href="#l2.319"></a><span id="l2.319" class="difflineplus">+</span>
<a href="#l2.320"></a><span id="l2.320" class="difflineplus">+        if (!item.hidden) {</span>
<a href="#l2.321"></a><span id="l2.321" class="difflineplus">+          visibleItemsBeforeSep = true;</span>
<a href="#l2.322"></a><span id="l2.322" class="difflineplus">+          anyVisible = true;</span>
<a href="#l2.323"></a><span id="l2.323" class="difflineplus">+</span>
<a href="#l2.324"></a><span id="l2.324" class="difflineplus">+          // Show the separator above the menu-item if any</span>
<a href="#l2.325"></a><span id="l2.325" class="difflineplus">+          if (separator) {</span>
<a href="#l2.326"></a><span id="l2.326" class="difflineplus">+            separator.hidden = false;</span>
<a href="#l2.327"></a><span id="l2.327" class="difflineplus">+            separator = null;</span>
<a href="#l2.328"></a><span id="l2.328" class="difflineplus">+          }</span>
<a href="#l2.329"></a><span id="l2.329" class="difflineplus">+        }</span>
<a href="#l2.330"></a><span id="l2.330" class="difflineplus">+      }</span>
<a href="#l2.331"></a><span id="l2.331" class="difflineplus">+      else { // menuseparator</span>
<a href="#l2.332"></a><span id="l2.332" class="difflineplus">+        // Initially hide it. It will be unhidden if there will be at least one</span>
<a href="#l2.333"></a><span id="l2.333" class="difflineplus">+        // visible menu-item above and below it.</span>
<a href="#l2.334"></a><span id="l2.334" class="difflineplus">+        item.hidden = true;</span>
<a href="#l2.335"></a><span id="l2.335" class="difflineplus">+</span>
<a href="#l2.336"></a><span id="l2.336" class="difflineplus">+        // We won't show the separator at all if no items are visible above it</span>
<a href="#l2.337"></a><span id="l2.337" class="difflineplus">+        if (visibleItemsBeforeSep)</span>
<a href="#l2.338"></a><span id="l2.338" class="difflineplus">+          separator = item;</span>
<a href="#l2.339"></a><span id="l2.339" class="difflineplus">+</span>
<a href="#l2.340"></a><span id="l2.340" class="difflineplus">+        // New separator, count again:</span>
<a href="#l2.341"></a><span id="l2.341" class="difflineplus">+        visibleItemsBeforeSep = false;</span>
<a href="#l2.342"></a><span id="l2.342" class="difflineplus">+      }</span>
<a href="#l2.343"></a><span id="l2.343" class="difflineplus">+    }</span>
<a href="#l2.344"></a><span id="l2.344" class="difflineplus">+</span>
<a href="#l2.345"></a><span id="l2.345" class="difflineplus">+    return anyVisible;</span>
<a href="#l2.346"></a><span id="l2.346" class="difflineplus">+  },</span>
<a href="#l2.347"></a><span id="l2.347" class="difflineplus">+</span>
<a href="#l2.348"></a><span id="l2.348" class="difflineplus">+  /**</span>
<a href="#l2.349"></a><span id="l2.349" class="difflineplus">+   * Select all links in the current view.</span>
<a href="#l2.350"></a><span id="l2.350" class="difflineplus">+   */</span>
<a href="#l2.351"></a><span id="l2.351" class="difflineplus">+  selectAll: function PC_selectAll() {</span>
<a href="#l2.352"></a><span id="l2.352" class="difflineplus">+    this._view.selectAll();</span>
<a href="#l2.353"></a><span id="l2.353" class="difflineplus">+  },</span>
<a href="#l2.354"></a><span id="l2.354" class="difflineplus">+</span>
<a href="#l2.355"></a><span id="l2.355" class="difflineplus">+  /**</span>
<a href="#l2.356"></a><span id="l2.356" class="difflineplus">+   * Gives the user a chance to cancel loading lots of tabs at once</span>
<a href="#l2.357"></a><span id="l2.357" class="difflineplus">+   */</span>
<a href="#l2.358"></a><span id="l2.358" class="difflineplus">+  _confirmOpenTabs: function(numTabsToOpen) {</span>
<a href="#l2.359"></a><span id="l2.359" class="difflineplus">+    var pref = Components.classes[&quot;@mozilla.org/preferences-service;1&quot;]</span>
<a href="#l2.360"></a><span id="l2.360" class="difflineplus">+                         .getService(Components.interfaces.nsIPrefBranch);</span>
<a href="#l2.361"></a><span id="l2.361" class="difflineplus">+</span>
<a href="#l2.362"></a><span id="l2.362" class="difflineplus">+    const kWarnOnOpenPref = &quot;browser.tabs.warnOnOpen&quot;;</span>
<a href="#l2.363"></a><span id="l2.363" class="difflineplus">+    var reallyOpen = true;</span>
<a href="#l2.364"></a><span id="l2.364" class="difflineplus">+    if (pref.getBoolPref(kWarnOnOpenPref)) {</span>
<a href="#l2.365"></a><span id="l2.365" class="difflineplus">+      if (numTabsToOpen &gt;= pref.getIntPref(&quot;browser.tabs.maxOpenBeforeWarn&quot;)) {</span>
<a href="#l2.366"></a><span id="l2.366" class="difflineplus">+        var promptService = Components.classes[&quot;@mozilla.org/embedcomp/prompt-service;1&quot;]</span>
<a href="#l2.367"></a><span id="l2.367" class="difflineplus">+                                      .getService(Components.interfaces.nsIPromptService);</span>
<a href="#l2.368"></a><span id="l2.368" class="difflineplus">+</span>
<a href="#l2.369"></a><span id="l2.369" class="difflineplus">+        // default to true: if it were false, we wouldn't get this far</span>
<a href="#l2.370"></a><span id="l2.370" class="difflineplus">+        var warnOnOpen = { value: true };</span>
<a href="#l2.371"></a><span id="l2.371" class="difflineplus">+</span>
<a href="#l2.372"></a><span id="l2.372" class="difflineplus">+        var messageKey = &quot;tabs.openWarningMultipleBranded&quot;;</span>
<a href="#l2.373"></a><span id="l2.373" class="difflineplus">+        var openKey = &quot;tabs.openButtonMultiple&quot;;</span>
<a href="#l2.374"></a><span id="l2.374" class="difflineplus">+        var strings = document.getElementById(&quot;placeBundle&quot;);</span>
<a href="#l2.375"></a><span id="l2.375" class="difflineplus">+        const BRANDING_BUNDLE_URI = &quot;chrome://branding/locale/brand.properties&quot;;</span>
<a href="#l2.376"></a><span id="l2.376" class="difflineplus">+        var brandShortName = Components.classes[&quot;@mozilla.org/intl/stringbundle;1&quot;]</span>
<a href="#l2.377"></a><span id="l2.377" class="difflineplus">+                                       .getService(Components.interfaces.nsIStringBundleService)</span>
<a href="#l2.378"></a><span id="l2.378" class="difflineplus">+                                       .createBundle(BRANDING_BUNDLE_URI)</span>
<a href="#l2.379"></a><span id="l2.379" class="difflineplus">+                                       .GetStringFromName(&quot;brandShortName&quot;);</span>
<a href="#l2.380"></a><span id="l2.380" class="difflineplus">+</span>
<a href="#l2.381"></a><span id="l2.381" class="difflineplus">+        var buttonPressed = promptService.confirmEx(window,</span>
<a href="#l2.382"></a><span id="l2.382" class="difflineplus">+          PlacesUIUtils.getString(&quot;tabs.openWarningTitle&quot;),</span>
<a href="#l2.383"></a><span id="l2.383" class="difflineplus">+          PlacesUIUtils.getFormattedString(messageKey,</span>
<a href="#l2.384"></a><span id="l2.384" class="difflineplus">+            [numTabsToOpen, brandShortName]),</span>
<a href="#l2.385"></a><span id="l2.385" class="difflineplus">+          (promptService.BUTTON_TITLE_IS_STRING * promptService.BUTTON_POS_0)</span>
<a href="#l2.386"></a><span id="l2.386" class="difflineplus">+          + (promptService.BUTTON_TITLE_CANCEL * promptService.BUTTON_POS_1),</span>
<a href="#l2.387"></a><span id="l2.387" class="difflineplus">+          PlacesUIUtils.getString(openKey),</span>
<a href="#l2.388"></a><span id="l2.388" class="difflineplus">+          null, null,</span>
<a href="#l2.389"></a><span id="l2.389" class="difflineplus">+          PlacesUIUtils.getFormattedString(&quot;tabs.openWarningPromptMeBranded&quot;,</span>
<a href="#l2.390"></a><span id="l2.390" class="difflineplus">+            [brandShortName]),</span>
<a href="#l2.391"></a><span id="l2.391" class="difflineplus">+          warnOnOpen);</span>
<a href="#l2.392"></a><span id="l2.392" class="difflineplus">+</span>
<a href="#l2.393"></a><span id="l2.393" class="difflineplus">+         reallyOpen = (buttonPressed == 0);</span>
<a href="#l2.394"></a><span id="l2.394" class="difflineplus">+         // don't set the pref unless they press OK and it's false</span>
<a href="#l2.395"></a><span id="l2.395" class="difflineplus">+         if (reallyOpen &amp;&amp; !warnOnOpen.value)</span>
<a href="#l2.396"></a><span id="l2.396" class="difflineplus">+           pref.setBoolPref(kWarnOnOpenPref, false);</span>
<a href="#l2.397"></a><span id="l2.397" class="difflineplus">+      }</span>
<a href="#l2.398"></a><span id="l2.398" class="difflineplus">+    }</span>
<a href="#l2.399"></a><span id="l2.399" class="difflineplus">+    return reallyOpen;</span>
<a href="#l2.400"></a><span id="l2.400" class="difflineplus">+  },</span>
<a href="#l2.401"></a><span id="l2.401" class="difflineplus">+</span>
<a href="#l2.402"></a><span id="l2.402" class="difflineplus">+  /**</span>
<a href="#l2.403"></a><span id="l2.403" class="difflineplus">+   * Opens the links in the selected folder, or the selected links in new tabs.</span>
<a href="#l2.404"></a><span id="l2.404" class="difflineplus">+   */</span>
<a href="#l2.405"></a><span id="l2.405" class="difflineplus">+  openSelectionInTabs: function PC_openLinksInTabs(aEvent) {</span>
<a href="#l2.406"></a><span id="l2.406" class="difflineplus">+    var node = this._view.selectedNode;</span>
<a href="#l2.407"></a><span id="l2.407" class="difflineplus">+    if (node &amp;&amp; PlacesUtils.nodeIsContainer(node))</span>
<a href="#l2.408"></a><span id="l2.408" class="difflineplus">+      PlacesUIUtils.openContainerNodeInTabs(this._view.selectedNode, aEvent);</span>
<a href="#l2.409"></a><span id="l2.409" class="difflineplus">+    else</span>
<a href="#l2.410"></a><span id="l2.410" class="difflineplus">+      PlacesUIUtils.openURINodesInTabs(this._view.getSelectionNodes(), aEvent);</span>
<a href="#l2.411"></a><span id="l2.411" class="difflineplus">+  },</span>
<a href="#l2.412"></a><span id="l2.412" class="difflineplus">+</span>
<a href="#l2.413"></a><span id="l2.413" class="difflineplus">+  /**</span>
<a href="#l2.414"></a><span id="l2.414" class="difflineplus">+   * Walk the list of folders we're removing in this delete operation, and</span>
<a href="#l2.415"></a><span id="l2.415" class="difflineplus">+   * see if the selected node specified is already implicitly being removed</span>
<a href="#l2.416"></a><span id="l2.416" class="difflineplus">+   * because it is a child of that folder.</span>
<a href="#l2.417"></a><span id="l2.417" class="difflineplus">+   * @param   node</span>
<a href="#l2.418"></a><span id="l2.418" class="difflineplus">+   *          Node to check for containment.</span>
<a href="#l2.419"></a><span id="l2.419" class="difflineplus">+   * @param   pastFolders</span>
<a href="#l2.420"></a><span id="l2.420" class="difflineplus">+   *          List of folders the calling function has already traversed</span>
<a href="#l2.421"></a><span id="l2.421" class="difflineplus">+   * @returns true if the node should be skipped, false otherwise.</span>
<a href="#l2.422"></a><span id="l2.422" class="difflineplus">+   */</span>
<a href="#l2.423"></a><span id="l2.423" class="difflineplus">+  _shouldSkipNode: function PC_shouldSkipNode(node, pastFolders) {</span>
<a href="#l2.424"></a><span id="l2.424" class="difflineplus">+    /**</span>
<a href="#l2.425"></a><span id="l2.425" class="difflineplus">+     * Determines if a node is contained by another node within a resultset.</span>
<a href="#l2.426"></a><span id="l2.426" class="difflineplus">+     * @param   node</span>
<a href="#l2.427"></a><span id="l2.427" class="difflineplus">+     *          The node to check for containment for</span>
<a href="#l2.428"></a><span id="l2.428" class="difflineplus">+     * @param   parent</span>
<a href="#l2.429"></a><span id="l2.429" class="difflineplus">+     *          The parent container to check for containment in</span>
<a href="#l2.430"></a><span id="l2.430" class="difflineplus">+     * @returns true if node is a member of parent's children, false otherwise.</span>
<a href="#l2.431"></a><span id="l2.431" class="difflineplus">+     */</span>
<a href="#l2.432"></a><span id="l2.432" class="difflineplus">+    function isContainedBy(node, parent) {</span>
<a href="#l2.433"></a><span id="l2.433" class="difflineplus">+      var cursor = node.parent;</span>
<a href="#l2.434"></a><span id="l2.434" class="difflineplus">+      while (cursor) {</span>
<a href="#l2.435"></a><span id="l2.435" class="difflineplus">+        if (cursor == parent)</span>
<a href="#l2.436"></a><span id="l2.436" class="difflineplus">+          return true;</span>
<a href="#l2.437"></a><span id="l2.437" class="difflineplus">+        cursor = cursor.parent;</span>
<a href="#l2.438"></a><span id="l2.438" class="difflineplus">+      }</span>
<a href="#l2.439"></a><span id="l2.439" class="difflineplus">+      return false;</span>
<a href="#l2.440"></a><span id="l2.440" class="difflineplus">+    }</span>
<a href="#l2.441"></a><span id="l2.441" class="difflineplus">+</span>
<a href="#l2.442"></a><span id="l2.442" class="difflineplus">+      for (var j = 0; j &lt; pastFolders.length; ++j) {</span>
<a href="#l2.443"></a><span id="l2.443" class="difflineplus">+        if (isContainedBy(node, pastFolders[j]))</span>
<a href="#l2.444"></a><span id="l2.444" class="difflineplus">+          return true;</span>
<a href="#l2.445"></a><span id="l2.445" class="difflineplus">+      }</span>
<a href="#l2.446"></a><span id="l2.446" class="difflineplus">+      return false;</span>
<a href="#l2.447"></a><span id="l2.447" class="difflineplus">+  },</span>
<a href="#l2.448"></a><span id="l2.448" class="difflineplus">+</span>
<a href="#l2.449"></a><span id="l2.449" class="difflineplus">+  /**</span>
<a href="#l2.450"></a><span id="l2.450" class="difflineplus">+   * Removes the set of selected ranges from history.</span>
<a href="#l2.451"></a><span id="l2.451" class="difflineplus">+   */</span>
<a href="#l2.452"></a><span id="l2.452" class="difflineplus">+  _removeRowsFromHistory: function PC__removeRowsFromHistory() {</span>
<a href="#l2.453"></a><span id="l2.453" class="difflineplus">+    // Other containers are history queries, just delete from history</span>
<a href="#l2.454"></a><span id="l2.454" class="difflineplus">+    // history deletes are not undoable.</span>
<a href="#l2.455"></a><span id="l2.455" class="difflineplus">+    var nodes = this._view.getSelectionNodes();</span>
<a href="#l2.456"></a><span id="l2.456" class="difflineplus">+    var URIs = [];</span>
<a href="#l2.457"></a><span id="l2.457" class="difflineplus">+    var bhist = PlacesUtils.history.QueryInterface(Components.interfaces.nsIBrowserHistory);</span>
<a href="#l2.458"></a><span id="l2.458" class="difflineplus">+    var resultView = this._view.getResultView();</span>
<a href="#l2.459"></a><span id="l2.459" class="difflineplus">+    var root = this._view.getResultNode();</span>
<a href="#l2.460"></a><span id="l2.460" class="difflineplus">+</span>
<a href="#l2.461"></a><span id="l2.461" class="difflineplus">+    for (var i = 0; i &lt; nodes.length; ++i) {</span>
<a href="#l2.462"></a><span id="l2.462" class="difflineplus">+      var node = nodes[i];</span>
<a href="#l2.463"></a><span id="l2.463" class="difflineplus">+      if (PlacesUtils.nodeIsHost(node))</span>
<a href="#l2.464"></a><span id="l2.464" class="difflineplus">+        bhist.removePagesFromHost(node.title, true);</span>
<a href="#l2.465"></a><span id="l2.465" class="difflineplus">+      else if (PlacesUtils.nodeIsURI(node)) {</span>
<a href="#l2.466"></a><span id="l2.466" class="difflineplus">+        var uri = PlacesUtils._uri(node.uri);</span>
<a href="#l2.467"></a><span id="l2.467" class="difflineplus">+        // avoid trying to delete the same url twice</span>
<a href="#l2.468"></a><span id="l2.468" class="difflineplus">+        if (URIs.indexOf(uri) &lt; 0) {</span>
<a href="#l2.469"></a><span id="l2.469" class="difflineplus">+          URIs.push(uri);</span>
<a href="#l2.470"></a><span id="l2.470" class="difflineplus">+        }</span>
<a href="#l2.471"></a><span id="l2.471" class="difflineplus">+      }</span>
<a href="#l2.472"></a><span id="l2.472" class="difflineplus">+      else if (PlacesUtils.nodeIsDay(node)) {</span>
<a href="#l2.473"></a><span id="l2.473" class="difflineplus">+        // this is the oldest date</span>
<a href="#l2.474"></a><span id="l2.474" class="difflineplus">+        // for the last node endDate is end of epoch</span>
<a href="#l2.475"></a><span id="l2.475" class="difflineplus">+        var beginDate = 0;</span>
<a href="#l2.476"></a><span id="l2.476" class="difflineplus">+        // this is the newest date</span>
<a href="#l2.477"></a><span id="l2.477" class="difflineplus">+        // day nodes have time property set to the last day in the interval</span>
<a href="#l2.478"></a><span id="l2.478" class="difflineplus">+        var endDate = node.time;</span>
<a href="#l2.479"></a><span id="l2.479" class="difflineplus">+</span>
<a href="#l2.480"></a><span id="l2.480" class="difflineplus">+        var nodeIdx = 0;</span>
<a href="#l2.481"></a><span id="l2.481" class="difflineplus">+        var cc = root.childCount;</span>
<a href="#l2.482"></a><span id="l2.482" class="difflineplus">+</span>
<a href="#l2.483"></a><span id="l2.483" class="difflineplus">+        // Find index of current day node</span>
<a href="#l2.484"></a><span id="l2.484" class="difflineplus">+        while (nodeIdx &lt; cc &amp;&amp; root.getChild(nodeIdx) != node)</span>
<a href="#l2.485"></a><span id="l2.485" class="difflineplus">+          ++nodeIdx;</span>
<a href="#l2.486"></a><span id="l2.486" class="difflineplus">+</span>
<a href="#l2.487"></a><span id="l2.487" class="difflineplus">+        // We have an older day</span>
<a href="#l2.488"></a><span id="l2.488" class="difflineplus">+        if (nodeIdx+1 &lt; cc)</span>
<a href="#l2.489"></a><span id="l2.489" class="difflineplus">+          beginDate = root.getChild(nodeIdx+1).time;</span>
<a href="#l2.490"></a><span id="l2.490" class="difflineplus">+</span>
<a href="#l2.491"></a><span id="l2.491" class="difflineplus">+        // we want to exclude beginDate from the removal</span>
<a href="#l2.492"></a><span id="l2.492" class="difflineplus">+        bhist.removePagesByTimeframe(beginDate+1, endDate);</span>
<a href="#l2.493"></a><span id="l2.493" class="difflineplus">+      }</span>
<a href="#l2.494"></a><span id="l2.494" class="difflineplus">+    }</span>
<a href="#l2.495"></a><span id="l2.495" class="difflineplus">+</span>
<a href="#l2.496"></a><span id="l2.496" class="difflineplus">+    // if we have to delete a lot of urls RemovePage will be slow, it's better</span>
<a href="#l2.497"></a><span id="l2.497" class="difflineplus">+    // to delete them in bunch and rebuild the full treeView</span>
<a href="#l2.498"></a><span id="l2.498" class="difflineplus">+    if (URIs.length &gt; REMOVE_PAGES_MAX_SINGLEREMOVES) {</span>
<a href="#l2.499"></a><span id="l2.499" class="difflineplus">+      // do removal in chunks to avoid passing a too big array to removePages</span>
<a href="#l2.500"></a><span id="l2.500" class="difflineplus">+      for (var i = 0; i &lt; URIs.length; i += REMOVE_PAGES_CHUNKLEN) {</span>
<a href="#l2.501"></a><span id="l2.501" class="difflineplus">+        var URIslice = URIs.slice(i, i + REMOVE_PAGES_CHUNKLEN);</span>
<a href="#l2.502"></a><span id="l2.502" class="difflineplus">+        // set DoBatchNotify (third param) only on the last chunk, so we update</span>
<a href="#l2.503"></a><span id="l2.503" class="difflineplus">+        // the treeView when we are done.</span>
<a href="#l2.504"></a><span id="l2.504" class="difflineplus">+        bhist.removePages(URIslice, URIslice.length,</span>
<a href="#l2.505"></a><span id="l2.505" class="difflineplus">+                          (i + REMOVE_PAGES_CHUNKLEN) &gt;= URIs.length);</span>
<a href="#l2.506"></a><span id="l2.506" class="difflineplus">+      }</span>
<a href="#l2.507"></a><span id="l2.507" class="difflineplus">+    }</span>
<a href="#l2.508"></a><span id="l2.508" class="difflineplus">+    else {</span>
<a href="#l2.509"></a><span id="l2.509" class="difflineplus">+      // if we have to delete fewer urls, removepage will allow us to avoid</span>
<a href="#l2.510"></a><span id="l2.510" class="difflineplus">+      // rebuilding the full treeView</span>
<a href="#l2.511"></a><span id="l2.511" class="difflineplus">+      for (var i = 0; i &lt; URIs.length; ++i)</span>
<a href="#l2.512"></a><span id="l2.512" class="difflineplus">+        bhist.removePage(URIs[i]);</span>
<a href="#l2.513"></a><span id="l2.513" class="difflineplus">+    }</span>
<a href="#l2.514"></a><span id="l2.514" class="difflineplus">+  },</span>
<a href="#l2.515"></a><span id="l2.515" class="difflineplus">+</span>
<a href="#l2.516"></a><span id="l2.516" class="difflineplus">+  /**</span>
<a href="#l2.517"></a><span id="l2.517" class="difflineplus">+   * Fills a DataTransfer object with the content of the selection that can be</span>
<a href="#l2.518"></a><span id="l2.518" class="difflineplus">+   * dropped elsewhere.</span>
<a href="#l2.519"></a><span id="l2.519" class="difflineplus">+   * @param   aEvent</span>
<a href="#l2.520"></a><span id="l2.520" class="difflineplus">+   *          The dragstart event.</span>
<a href="#l2.521"></a><span id="l2.521" class="difflineplus">+   */</span>
<a href="#l2.522"></a><span id="l2.522" class="difflineplus">+  setDataTransfer: function PC_setDataTransfer(aEvent) {</span>
<a href="#l2.523"></a><span id="l2.523" class="difflineplus">+    var dt = aEvent.dataTransfer;</span>
<a href="#l2.524"></a><span id="l2.524" class="difflineplus">+    var doCopy = dt.effectAllowed == &quot;copyLink&quot; || dt.effectAllowed == &quot;copy&quot;;</span>
<a href="#l2.525"></a><span id="l2.525" class="difflineplus">+</span>
<a href="#l2.526"></a><span id="l2.526" class="difflineplus">+    var result = this._view.getResult();</span>
<a href="#l2.527"></a><span id="l2.527" class="difflineplus">+    var oldViewer = result.viewer;</span>
<a href="#l2.528"></a><span id="l2.528" class="difflineplus">+    try {</span>
<a href="#l2.529"></a><span id="l2.529" class="difflineplus">+      result.viewer = null;</span>
<a href="#l2.530"></a><span id="l2.530" class="difflineplus">+      var nodes = this._view.getDragableSelection();</span>
<a href="#l2.531"></a><span id="l2.531" class="difflineplus">+</span>
<a href="#l2.532"></a><span id="l2.532" class="difflineplus">+      for (var i = 0; i &lt; nodes.length; ++i) {</span>
<a href="#l2.533"></a><span id="l2.533" class="difflineplus">+        var node = nodes[i];</span>
<a href="#l2.534"></a><span id="l2.534" class="difflineplus">+</span>
<a href="#l2.535"></a><span id="l2.535" class="difflineplus">+        function addData(type, index, overrideURI) {</span>
<a href="#l2.536"></a><span id="l2.536" class="difflineplus">+          var wrapNode = PlacesUtils.wrapNode(node, type, overrideURI, doCopy);</span>
<a href="#l2.537"></a><span id="l2.537" class="difflineplus">+          dt.mozSetDataAt(type, wrapNode, index);</span>
<a href="#l2.538"></a><span id="l2.538" class="difflineplus">+        }</span>
<a href="#l2.539"></a><span id="l2.539" class="difflineplus">+</span>
<a href="#l2.540"></a><span id="l2.540" class="difflineplus">+        function addURIData(index, overrideURI) {</span>
<a href="#l2.541"></a><span id="l2.541" class="difflineplus">+          addData(PlacesUtils.TYPE_X_MOZ_URL, index, overrideURI);</span>
<a href="#l2.542"></a><span id="l2.542" class="difflineplus">+          addData(PlacesUtils.TYPE_UNICODE, index, overrideURI);</span>
<a href="#l2.543"></a><span id="l2.543" class="difflineplus">+          addData(PlacesUtils.TYPE_HTML, index, overrideURI);</span>
<a href="#l2.544"></a><span id="l2.544" class="difflineplus">+        }</span>
<a href="#l2.545"></a><span id="l2.545" class="difflineplus">+</span>
<a href="#l2.546"></a><span id="l2.546" class="difflineplus">+        // This order is _important_! It controls how this and other</span>
<a href="#l2.547"></a><span id="l2.547" class="difflineplus">+        // applications select data to be inserted based on type.</span>
<a href="#l2.548"></a><span id="l2.548" class="difflineplus">+        addData(PlacesUtils.TYPE_X_MOZ_PLACE, i);</span>
<a href="#l2.549"></a><span id="l2.549" class="difflineplus">+</span>
<a href="#l2.550"></a><span id="l2.550" class="difflineplus">+        if (node.uri)</span>
<a href="#l2.551"></a><span id="l2.551" class="difflineplus">+          addURIData(i);</span>
<a href="#l2.552"></a><span id="l2.552" class="difflineplus">+      }</span>
<a href="#l2.553"></a><span id="l2.553" class="difflineplus">+    }</span>
<a href="#l2.554"></a><span id="l2.554" class="difflineplus">+    finally {</span>
<a href="#l2.555"></a><span id="l2.555" class="difflineplus">+      if (oldViewer)</span>
<a href="#l2.556"></a><span id="l2.556" class="difflineplus">+        result.viewer = oldViewer;</span>
<a href="#l2.557"></a><span id="l2.557" class="difflineplus">+    }</span>
<a href="#l2.558"></a><span id="l2.558" class="difflineplus">+  },</span>
<a href="#l2.559"></a><span id="l2.559" class="difflineplus">+</span>
<a href="#l2.560"></a><span id="l2.560" class="difflineplus">+  /**</span>
<a href="#l2.561"></a><span id="l2.561" class="difflineplus">+   * Copy Bookmarks and Folders to the clipboard</span>
<a href="#l2.562"></a><span id="l2.562" class="difflineplus">+   */</span>
<a href="#l2.563"></a><span id="l2.563" class="difflineplus">+  copy: function PC_copy() {</span>
<a href="#l2.564"></a><span id="l2.564" class="difflineplus">+    var result = this._view.getResult();</span>
<a href="#l2.565"></a><span id="l2.565" class="difflineplus">+    var oldViewer = result.viewer;</span>
<a href="#l2.566"></a><span id="l2.566" class="difflineplus">+    try {</span>
<a href="#l2.567"></a><span id="l2.567" class="difflineplus">+      result.viewer = null;</span>
<a href="#l2.568"></a><span id="l2.568" class="difflineplus">+      var nodes = this._view.getSelectionNodes();</span>
<a href="#l2.569"></a><span id="l2.569" class="difflineplus">+</span>
<a href="#l2.570"></a><span id="l2.570" class="difflineplus">+      var xferable = Components.classes[&quot;@mozilla.org/widget/transferable;1&quot;]</span>
<a href="#l2.571"></a><span id="l2.571" class="difflineplus">+                               .createInstance(Components.interfaces.nsITransferable);</span>
<a href="#l2.572"></a><span id="l2.572" class="difflineplus">+      var foundFolder = false, foundLink = false;</span>
<a href="#l2.573"></a><span id="l2.573" class="difflineplus">+      var copiedFolders = [];</span>
<a href="#l2.574"></a><span id="l2.574" class="difflineplus">+      var placeString, mozURLString, htmlString, unicodeString;</span>
<a href="#l2.575"></a><span id="l2.575" class="difflineplus">+      placeString = mozURLString = htmlString = unicodeString = &quot;&quot;;</span>
<a href="#l2.576"></a><span id="l2.576" class="difflineplus">+</span>
<a href="#l2.577"></a><span id="l2.577" class="difflineplus">+      for (var i = 0; i &lt; nodes.length; ++i) {</span>
<a href="#l2.578"></a><span id="l2.578" class="difflineplus">+        var node = nodes[i];</span>
<a href="#l2.579"></a><span id="l2.579" class="difflineplus">+        if (this._shouldSkipNode(node, copiedFolders))</span>
<a href="#l2.580"></a><span id="l2.580" class="difflineplus">+          continue;</span>
<a href="#l2.581"></a><span id="l2.581" class="difflineplus">+        if (PlacesUtils.nodeIsFolder(node))</span>
<a href="#l2.582"></a><span id="l2.582" class="difflineplus">+          copiedFolders.push(node);</span>
<a href="#l2.583"></a><span id="l2.583" class="difflineplus">+</span>
<a href="#l2.584"></a><span id="l2.584" class="difflineplus">+        function generateChunk(type, overrideURI) {</span>
<a href="#l2.585"></a><span id="l2.585" class="difflineplus">+          var suffix = i &lt; (nodes.length - 1) ? NEWLINE : &quot;&quot;;</span>
<a href="#l2.586"></a><span id="l2.586" class="difflineplus">+          var uri = overrideURI;</span>
<a href="#l2.587"></a><span id="l2.587" class="difflineplus">+</span>
<a href="#l2.588"></a><span id="l2.588" class="difflineplus">+          mozURLString += (PlacesUtils.wrapNode(node, PlacesUtils.TYPE_X_MOZ_URL,</span>
<a href="#l2.589"></a><span id="l2.589" class="difflineplus">+                                                 uri) + suffix);</span>
<a href="#l2.590"></a><span id="l2.590" class="difflineplus">+          unicodeString += (PlacesUtils.wrapNode(node, PlacesUtils.TYPE_UNICODE,</span>
<a href="#l2.591"></a><span id="l2.591" class="difflineplus">+                                                 uri) + suffix);</span>
<a href="#l2.592"></a><span id="l2.592" class="difflineplus">+          htmlString += (PlacesUtils.wrapNode(node, PlacesUtils.TYPE_HTML,</span>
<a href="#l2.593"></a><span id="l2.593" class="difflineplus">+                                                 uri) + suffix);</span>
<a href="#l2.594"></a><span id="l2.594" class="difflineplus">+</span>
<a href="#l2.595"></a><span id="l2.595" class="difflineplus">+          var placeSuffix = i &lt; (nodes.length - 1) ? &quot;,&quot; : &quot;&quot;;</span>
<a href="#l2.596"></a><span id="l2.596" class="difflineplus">+          var resolveShortcuts = false; // !PlacesControllerDragHelper.canMoveNode(node);</span>
<a href="#l2.597"></a><span id="l2.597" class="difflineplus">+          return PlacesUtils.wrapNode(node, type, overrideURI, resolveShortcuts) + placeSuffix;</span>
<a href="#l2.598"></a><span id="l2.598" class="difflineplus">+        }</span>
<a href="#l2.599"></a><span id="l2.599" class="difflineplus">+</span>
<a href="#l2.600"></a><span id="l2.600" class="difflineplus">+        // all items wrapped as TYPE_X_MOZ_PLACE</span>
<a href="#l2.601"></a><span id="l2.601" class="difflineplus">+        placeString += generateChunk(PlacesUtils.TYPE_X_MOZ_PLACE);</span>
<a href="#l2.602"></a><span id="l2.602" class="difflineplus">+      }</span>
<a href="#l2.603"></a><span id="l2.603" class="difflineplus">+</span>
<a href="#l2.604"></a><span id="l2.604" class="difflineplus">+      function addData(type, data) {</span>
<a href="#l2.605"></a><span id="l2.605" class="difflineplus">+        xferable.addDataFlavor(type);</span>
<a href="#l2.606"></a><span id="l2.606" class="difflineplus">+        xferable.setTransferData(type, PlacesUIUtils._wrapString(data), data.length * 2);</span>
<a href="#l2.607"></a><span id="l2.607" class="difflineplus">+      }</span>
<a href="#l2.608"></a><span id="l2.608" class="difflineplus">+      // This order is _important_! It controls how this and other applications</span>
<a href="#l2.609"></a><span id="l2.609" class="difflineplus">+      // select data to be inserted based on type.</span>
<a href="#l2.610"></a><span id="l2.610" class="difflineplus">+      if (placeString)</span>
<a href="#l2.611"></a><span id="l2.611" class="difflineplus">+        addData(PlacesUtils.TYPE_X_MOZ_PLACE, placeString);</span>
<a href="#l2.612"></a><span id="l2.612" class="difflineplus">+      if (mozURLString)</span>
<a href="#l2.613"></a><span id="l2.613" class="difflineplus">+        addData(PlacesUtils.TYPE_X_MOZ_URL, mozURLString);</span>
<a href="#l2.614"></a><span id="l2.614" class="difflineplus">+      if (unicodeString)</span>
<a href="#l2.615"></a><span id="l2.615" class="difflineplus">+        addData(PlacesUtils.TYPE_UNICODE, unicodeString);</span>
<a href="#l2.616"></a><span id="l2.616" class="difflineplus">+      if (htmlString)</span>
<a href="#l2.617"></a><span id="l2.617" class="difflineplus">+        addData(PlacesUtils.TYPE_HTML, htmlString);</span>
<a href="#l2.618"></a><span id="l2.618" class="difflineplus">+</span>
<a href="#l2.619"></a><span id="l2.619" class="difflineplus">+      if (placeString || unicodeString || htmlString || mozURLString) {</span>
<a href="#l2.620"></a><span id="l2.620" class="difflineplus">+        PlacesUIUtils.clipboard.setData(xferable, null, Components.interfaces.nsIClipboard.kGlobalClipboard);</span>
<a href="#l2.621"></a><span id="l2.621" class="difflineplus">+      }</span>
<a href="#l2.622"></a><span id="l2.622" class="difflineplus">+    }</span>
<a href="#l2.623"></a><span id="l2.623" class="difflineplus">+    catch(e) {</span>
<a href="#l2.624"></a><span id="l2.624" class="difflineplus">+      dump(e);</span>
<a href="#l2.625"></a><span id="l2.625" class="difflineplus">+    }</span>
<a href="#l2.626"></a><span id="l2.626" class="difflineplus">+    finally {</span>
<a href="#l2.627"></a><span id="l2.627" class="difflineplus">+      if (oldViewer)</span>
<a href="#l2.628"></a><span id="l2.628" class="difflineplus">+        result.viewer = oldViewer;</span>
<a href="#l2.629"></a><span id="l2.629" class="difflineplus">+    }</span>
<a href="#l2.630"></a><span id="l2.630" class="difflineplus">+  },</span>
<a href="#l2.631"></a><span id="l2.631" class="difflineplus">+</span>
<a href="#l2.632"></a><span id="l2.632" class="difflineplus">+  /**</span>
<a href="#l2.633"></a><span id="l2.633" class="difflineplus">+   * Cut Bookmarks and Folders to the clipboard</span>
<a href="#l2.634"></a><span id="l2.634" class="difflineplus">+   */</span>
<a href="#l2.635"></a><span id="l2.635" class="difflineplus">+  cut: function PC_cut() {</span>
<a href="#l2.636"></a><span id="l2.636" class="difflineplus">+    this.copy();</span>
<a href="#l2.637"></a><span id="l2.637" class="difflineplus">+    this._removeRowsFromHistory();</span>
<a href="#l2.638"></a><span id="l2.638" class="difflineplus">+  },</span>
<a href="#l2.639"></a><span id="l2.639" class="difflineplus">+};</span>
<a href="#l2.640"></a><span id="l2.640" class="difflineplus">+</span>
<a href="#l2.641"></a><span id="l2.641" class="difflineplus">+function goUpdatePlacesCommands() {</span>
<a href="#l2.642"></a><span id="l2.642" class="difflineplus">+  goUpdateCommand(&quot;placesCmd_open&quot;);</span>
<a href="#l2.643"></a><span id="l2.643" class="difflineplus">+  goUpdateCommand(&quot;placesCmd_open:window&quot;);</span>
<a href="#l2.644"></a><span id="l2.644" class="difflineplus">+  goUpdateCommand(&quot;placesCmd_open:tab&quot;);</span>
<a href="#l2.645"></a><span id="l2.645" class="difflineplus">+  goUpdateCommand(&quot;placesCmd_sortBy:name&quot;);</span>
<a href="#l2.646"></a><span id="l2.646" class="difflineplus">+}</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l3.1"></a><span id="l3.1">deleted file mode 100644</span>
<a href="#l3.2"></a><span id="l3.2" class="difflineminus">--- a/suite/common/history/findHistory.js</span>
<a href="#l3.3"></a><span id="l3.3" class="difflineplus">+++ /dev/null</span>
<a href="#l3.4"></a><span id="l3.4" class="difflineat">@@ -1,84 +0,0 @@</span>
<a href="#l3.5"></a><span id="l3.5" class="difflineminus">-/* -*- Mode: Java; tab-width: 4; indent-tabs-mode: nil; c-basic-offset: 4 -*- */</span>
<a href="#l3.6"></a><span id="l3.6" class="difflineminus">-/* ***** BEGIN LICENSE BLOCK *****</span>
<a href="#l3.7"></a><span id="l3.7" class="difflineminus">- * Version: MPL 1.1/GPL 2.0/LGPL 2.1</span>
<a href="#l3.8"></a><span id="l3.8" class="difflineminus">- *</span>
<a href="#l3.9"></a><span id="l3.9" class="difflineminus">- * The contents of this file are subject to the Mozilla Public License Version</span>
<a href="#l3.10"></a><span id="l3.10" class="difflineminus">- * 1.1 (the &quot;License&quot;); you may not use this file except in compliance with</span>
<a href="#l3.11"></a><span id="l3.11" class="difflineminus">- * the License. You may obtain a copy of the License at</span>
<a href="#l3.12"></a><span id="l3.12" class="difflineminus">- * http://www.mozilla.org/MPL/</span>
<a href="#l3.13"></a><span id="l3.13" class="difflineminus">- *</span>
<a href="#l3.14"></a><span id="l3.14" class="difflineminus">- * Software distributed under the License is distributed on an &quot;AS IS&quot; basis,</span>
<a href="#l3.15"></a><span id="l3.15" class="difflineminus">- * WITHOUT WARRANTY OF ANY KIND, either express or implied. See the License</span>
<a href="#l3.16"></a><span id="l3.16" class="difflineminus">- * for the specific language governing rights and limitations under the</span>
<a href="#l3.17"></a><span id="l3.17" class="difflineminus">- * License.</span>
<a href="#l3.18"></a><span id="l3.18" class="difflineminus">- *</span>
<a href="#l3.19"></a><span id="l3.19" class="difflineminus">- * The Original Code is mozilla.org code.</span>
<a href="#l3.20"></a><span id="l3.20" class="difflineminus">- *</span>
<a href="#l3.21"></a><span id="l3.21" class="difflineminus">- * The Initial Developer of the Original Code is</span>
<a href="#l3.22"></a><span id="l3.22" class="difflineminus">- * Netscape Communications Corporation.</span>
<a href="#l3.23"></a><span id="l3.23" class="difflineminus">- * Portions created by the Initial Developer are Copyright (C) 1998</span>
<a href="#l3.24"></a><span id="l3.24" class="difflineminus">- * the Initial Developer. All Rights Reserved.</span>
<a href="#l3.25"></a><span id="l3.25" class="difflineminus">- *</span>
<a href="#l3.26"></a><span id="l3.26" class="difflineminus">- * Contributor(s):</span>
<a href="#l3.27"></a><span id="l3.27" class="difflineminus">- *   Ben Goodger &lt;ben@netscape.com&gt; (Original Author)</span>
<a href="#l3.28"></a><span id="l3.28" class="difflineminus">- *</span>
<a href="#l3.29"></a><span id="l3.29" class="difflineminus">- * Alternatively, the contents of this file may be used under the terms of</span>
<a href="#l3.30"></a><span id="l3.30" class="difflineminus">- * either of the GNU General Public License Version 2 or later (the &quot;GPL&quot;),</span>
<a href="#l3.31"></a><span id="l3.31" class="difflineminus">- * or the GNU Lesser General Public License Version 2.1 or later (the &quot;LGPL&quot;),</span>
<a href="#l3.32"></a><span id="l3.32" class="difflineminus">- * in which case the provisions of the GPL or the LGPL are applicable instead</span>
<a href="#l3.33"></a><span id="l3.33" class="difflineminus">- * of those above. If you wish to allow use of your version of this file only</span>
<a href="#l3.34"></a><span id="l3.34" class="difflineminus">- * under the terms of either the GPL or the LGPL, and not to allow others to</span>
<a href="#l3.35"></a><span id="l3.35" class="difflineminus">- * use your version of this file under the terms of the MPL, indicate your</span>
<a href="#l3.36"></a><span id="l3.36" class="difflineminus">- * decision by deleting the provisions above and replace them with the notice</span>
<a href="#l3.37"></a><span id="l3.37" class="difflineminus">- * and other provisions required by the GPL or the LGPL. If you do not delete</span>
<a href="#l3.38"></a><span id="l3.38" class="difflineminus">- * the provisions above, a recipient may use your version of this file under</span>
<a href="#l3.39"></a><span id="l3.39" class="difflineminus">- * the terms of any one of the MPL, the GPL or the LGPL.</span>
<a href="#l3.40"></a><span id="l3.40" class="difflineminus">- *</span>
<a href="#l3.41"></a><span id="l3.41" class="difflineminus">- * ***** END LICENSE BLOCK ***** */</span>
<a href="#l3.42"></a><span id="l3.42" class="difflineminus">-</span>
<a href="#l3.43"></a><span id="l3.43" class="difflineminus">-var gOKButton;</span>
<a href="#l3.44"></a><span id="l3.44" class="difflineminus">-var gSearchField;</span>
<a href="#l3.45"></a><span id="l3.45" class="difflineminus">-function Startup()</span>
<a href="#l3.46"></a><span id="l3.46" class="difflineminus">-{</span>
<a href="#l3.47"></a><span id="l3.47" class="difflineminus">-  var bundle = document.getElementById(&quot;historyBundle&quot;);</span>
<a href="#l3.48"></a><span id="l3.48" class="difflineminus">-  gOKButton = document.documentElement.getButton(&quot;accept&quot;);</span>
<a href="#l3.49"></a><span id="l3.49" class="difflineminus">-  gOKButton.disabled = true;</span>
<a href="#l3.50"></a><span id="l3.50" class="difflineminus">-  gSearchField = document.getElementById(&quot;searchField&quot;);</span>
<a href="#l3.51"></a><span id="l3.51" class="difflineminus">-  gSearchField.focus();</span>
<a href="#l3.52"></a><span id="l3.52" class="difflineminus">-}</span>
<a href="#l3.53"></a><span id="l3.53" class="difflineminus">-</span>
<a href="#l3.54"></a><span id="l3.54" class="difflineminus">-function find()</span>
<a href="#l3.55"></a><span id="l3.55" class="difflineminus">-{</span>
<a href="#l3.56"></a><span id="l3.56" class="difflineminus">-  // Build up a find URI from the search fields and open a new window</span>
<a href="#l3.57"></a><span id="l3.57" class="difflineminus">-  // rooted on the URI. </span>
<a href="#l3.58"></a><span id="l3.58" class="difflineminus">-  var match = document.getElementById(&quot;matchList&quot;);</span>
<a href="#l3.59"></a><span id="l3.59" class="difflineminus">-  var method = document.getElementById(&quot;methodList&quot;);</span>
<a href="#l3.60"></a><span id="l3.60" class="difflineminus">-  var searchURI = &quot;find:datasource=history&quot;</span>
<a href="#l3.61"></a><span id="l3.61" class="difflineminus">-  searchURI += &quot;&amp;match=&quot; + match.selectedItem.value;</span>
<a href="#l3.62"></a><span id="l3.62" class="difflineminus">-  searchURI += &quot;&amp;method=&quot; + method.selectedItem.value;</span>
<a href="#l3.63"></a><span id="l3.63" class="difflineminus">-  searchURI += &quot;&amp;text=&quot; + encodeURIComponent(gSearchField.value);</span>
<a href="#l3.64"></a><span id="l3.64" class="difflineminus">-  var hstWindow = findMostRecentWindow(&quot;history:searchresults&quot;, &quot;chrome://communicator/content/history/history.xul&quot;, searchURI);</span>
<a href="#l3.65"></a><span id="l3.65" class="difflineminus">-  </span>
<a href="#l3.66"></a><span id="l3.66" class="difflineminus">-  // Update the root of the tree if we're using an existing search window. </span>
<a href="#l3.67"></a><span id="l3.67" class="difflineminus">-  if (!gCreatingNewWindow) </span>
<a href="#l3.68"></a><span id="l3.68" class="difflineminus">-    hstWindow.setRoot(searchURI);</span>
<a href="#l3.69"></a><span id="l3.69" class="difflineminus">-</span>
<a href="#l3.70"></a><span id="l3.70" class="difflineminus">-  hstWindow.focus();</span>
<a href="#l3.71"></a><span id="l3.71" class="difflineminus">-  return true;</span>
<a href="#l3.72"></a><span id="l3.72" class="difflineminus">-}</span>
<a href="#l3.73"></a><span id="l3.73" class="difflineminus">-</span>
<a href="#l3.74"></a><span id="l3.74" class="difflineminus">-var gCreatingNewWindow = false;</span>
<a href="#l3.75"></a><span id="l3.75" class="difflineminus">-function findMostRecentWindow(aType, aURI, aParam)</span>
<a href="#l3.76"></a><span id="l3.76" class="difflineminus">-{</span>
<a href="#l3.77"></a><span id="l3.77" class="difflineminus">-  var WM = Components.classes['@mozilla.org/appshell/window-mediator;1'].getService();</span>
<a href="#l3.78"></a><span id="l3.78" class="difflineminus">-  WM = WM.QueryInterface(Components.interfaces.nsIWindowMediator);</span>
<a href="#l3.79"></a><span id="l3.79" class="difflineminus">-  var topWindow = WM.getMostRecentWindow(aType);</span>
<a href="#l3.80"></a><span id="l3.80" class="difflineminus">-  if (!topWindow) gCreatingNewWindow = true;</span>
<a href="#l3.81"></a><span id="l3.81" class="difflineminus">-  return topWindow || openDialog(&quot;chrome://communicator/content/history/history.xul&quot;, </span>
<a href="#l3.82"></a><span id="l3.82" class="difflineminus">-                                 &quot;&quot;, &quot;chrome,all,dialog=no&quot;, aParam);</span>
<a href="#l3.83"></a><span id="l3.83" class="difflineminus">-}</span>
<a href="#l3.84"></a><span id="l3.84" class="difflineminus">-</span>
<a href="#l3.85"></a><span id="l3.85" class="difflineminus">-function doEnabling()</span>
<a href="#l3.86"></a><span id="l3.86" class="difflineminus">-{</span>
<a href="#l3.87"></a><span id="l3.87" class="difflineminus">-  gOKButton.disabled = !gSearchField.value;</span>
<a href="#l3.88"></a><span id="l3.88" class="difflineminus">-}</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l4.1"></a><span id="l4.1">deleted file mode 100644</span>
<a href="#l4.2"></a><span id="l4.2" class="difflineminus">--- a/suite/common/history/findHistory.xul</span>
<a href="#l4.3"></a><span id="l4.3" class="difflineplus">+++ /dev/null</span>
<a href="#l4.4"></a><span id="l4.4" class="difflineat">@@ -1,80 +0,0 @@</span>
<a href="#l4.5"></a><span id="l4.5" class="difflineminus">-&lt;?xml version=&quot;1.0&quot;?&gt; &lt;!-- -*- Mode: HTML; indent-tabs-mode: nil; -*- --&gt;</span>
<a href="#l4.6"></a><span id="l4.6" class="difflineminus">-&lt;!--</span>
<a href="#l4.7"></a><span id="l4.7" class="difflineminus">-</span>
<a href="#l4.8"></a><span id="l4.8" class="difflineminus">- ***** BEGIN LICENSE BLOCK *****</span>
<a href="#l4.9"></a><span id="l4.9" class="difflineminus">- Version: MPL 1.1/GPL 2.0/LGPL 2.1</span>
<a href="#l4.10"></a><span id="l4.10" class="difflineminus">-</span>
<a href="#l4.11"></a><span id="l4.11" class="difflineminus">- The contents of this file are subject to the Mozilla Public License Version</span>
<a href="#l4.12"></a><span id="l4.12" class="difflineminus">- 1.1 (the &quot;License&quot;); you may not use this file except in compliance with</span>
<a href="#l4.13"></a><span id="l4.13" class="difflineminus">- the License. You may obtain a copy of the License at</span>
<a href="#l4.14"></a><span id="l4.14" class="difflineminus">- http://www.mozilla.org/MPL/</span>
<a href="#l4.15"></a><span id="l4.15" class="difflineminus">-</span>
<a href="#l4.16"></a><span id="l4.16" class="difflineminus">- Software distributed under the License is distributed on an &quot;AS IS&quot; basis,</span>
<a href="#l4.17"></a><span id="l4.17" class="difflineminus">- WITHOUT WARRANTY OF ANY KIND, either express or implied. See the License</span>
<a href="#l4.18"></a><span id="l4.18" class="difflineminus">- for the specific language governing rights and limitations under the</span>
<a href="#l4.19"></a><span id="l4.19" class="difflineminus">- License.</span>
<a href="#l4.20"></a><span id="l4.20" class="difflineminus">-</span>
<a href="#l4.21"></a><span id="l4.21" class="difflineminus">- The Original Code is mozilla.org code.</span>
<a href="#l4.22"></a><span id="l4.22" class="difflineminus">-</span>
<a href="#l4.23"></a><span id="l4.23" class="difflineminus">- The Initial Developer of the Original Code is</span>
<a href="#l4.24"></a><span id="l4.24" class="difflineminus">- Netscape Communications Corporation.</span>
<a href="#l4.25"></a><span id="l4.25" class="difflineminus">- Portions created by the Initial Developer are Copyright (C) 1998</span>
<a href="#l4.26"></a><span id="l4.26" class="difflineminus">- the Initial Developer. All Rights Reserved.</span>
<a href="#l4.27"></a><span id="l4.27" class="difflineminus">-</span>
<a href="#l4.28"></a><span id="l4.28" class="difflineminus">- Contributor(s):</span>
<a href="#l4.29"></a><span id="l4.29" class="difflineminus">-   Ben Goodger &lt;ben@netscape.com&gt; (Original Author)</span>
<a href="#l4.30"></a><span id="l4.30" class="difflineminus">-</span>
<a href="#l4.31"></a><span id="l4.31" class="difflineminus">- Alternatively, the contents of this file may be used under the terms of</span>
<a href="#l4.32"></a><span id="l4.32" class="difflineminus">- either of the GNU General Public License Version 2 or later (the &quot;GPL&quot;),</span>
<a href="#l4.33"></a><span id="l4.33" class="difflineminus">- or the GNU Lesser General Public License Version 2.1 or later (the &quot;LGPL&quot;),</span>
<a href="#l4.34"></a><span id="l4.34" class="difflineminus">- in which case the provisions of the GPL or the LGPL are applicable instead</span>
<a href="#l4.35"></a><span id="l4.35" class="difflineminus">- of those above. If you wish to allow use of your version of this file only</span>
<a href="#l4.36"></a><span id="l4.36" class="difflineminus">- under the terms of either the GPL or the LGPL, and not to allow others to</span>
<a href="#l4.37"></a><span id="l4.37" class="difflineminus">- use your version of this file under the terms of the MPL, indicate your</span>
<a href="#l4.38"></a><span id="l4.38" class="difflineminus">- decision by deleting the provisions above and replace them with the notice</span>
<a href="#l4.39"></a><span id="l4.39" class="difflineminus">- and other provisions required by the GPL or the LGPL. If you do not delete</span>
<a href="#l4.40"></a><span id="l4.40" class="difflineminus">- the provisions above, a recipient may use your version of this file under</span>
<a href="#l4.41"></a><span id="l4.41" class="difflineminus">- the terms of any one of the MPL, the GPL or the LGPL.</span>
<a href="#l4.42"></a><span id="l4.42" class="difflineminus">-</span>
<a href="#l4.43"></a><span id="l4.43" class="difflineminus">- ***** END LICENSE BLOCK ***** --&gt;</span>
<a href="#l4.44"></a><span id="l4.44" class="difflineminus">-</span>
<a href="#l4.45"></a><span id="l4.45" class="difflineminus">-&lt;!--</span>
<a href="#l4.46"></a><span id="l4.46" class="difflineminus">-    &quot;Find in History&quot; window</span>
<a href="#l4.47"></a><span id="l4.47" class="difflineminus">-  --&gt;</span>
<a href="#l4.48"></a><span id="l4.48" class="difflineminus">-</span>
<a href="#l4.49"></a><span id="l4.49" class="difflineminus">-&lt;?xml-stylesheet href=&quot;chrome://communicator/skin/&quot;?&gt;</span>
<a href="#l4.50"></a><span id="l4.50" class="difflineminus">-&lt;!DOCTYPE dialog SYSTEM &quot;chrome://communicator/locale/history/findHistory.dtd&quot;&gt;</span>
<a href="#l4.51"></a><span id="l4.51" class="difflineminus">-</span>
<a href="#l4.52"></a><span id="l4.52" class="difflineminus">-&lt;dialog id=&quot;findHistoryWindow&quot; style=&quot;width: 36em;&quot;</span>
<a href="#l4.53"></a><span id="l4.53" class="difflineminus">-        xmlns=&quot;http://www.mozilla.org/keymaster/gatekeeper/there.is.only.xul&quot;</span>
<a href="#l4.54"></a><span id="l4.54" class="difflineminus">-        title=&quot;&amp;findHistory.title;&quot; </span>
<a href="#l4.55"></a><span id="l4.55" class="difflineminus">-        onload=&quot;Startup();&quot;</span>
<a href="#l4.56"></a><span id="l4.56" class="difflineminus">-        ondialogaccept=&quot;return find();&quot;</span>
<a href="#l4.57"></a><span id="l4.57" class="difflineminus">-        buttonlabelaccept=&quot;&amp;findButton.label;&quot;&gt;</span>
<a href="#l4.58"></a><span id="l4.58" class="difflineminus">-</span>
<a href="#l4.59"></a><span id="l4.59" class="difflineminus">-  &lt;stringbundle id=&quot;historyBundle&quot; src=&quot;chrome://communicator/locale/history/history.properties&quot;/&gt;</span>
<a href="#l4.60"></a><span id="l4.60" class="difflineminus">-</span>
<a href="#l4.61"></a><span id="l4.61" class="difflineminus">-  &lt;script type=&quot;application/x-javascript&quot; src=&quot;chrome://communicator/content/history/findHistory.js&quot;/&gt;</span>
<a href="#l4.62"></a><span id="l4.62" class="difflineminus">-</span>
<a href="#l4.63"></a><span id="l4.63" class="difflineminus">-  &lt;label value=&quot;&amp;search.for.label;&quot; control=&quot;matchList&quot;/&gt;</span>
<a href="#l4.64"></a><span id="l4.64" class="difflineminus">-  &lt;hbox align=&quot;center&quot;&gt;</span>
<a href="#l4.65"></a><span id="l4.65" class="difflineminus">-    &lt;menulist id=&quot;matchList&quot;&gt;</span>
<a href="#l4.66"></a><span id="l4.66" class="difflineminus">-      &lt;menupopup&gt;</span>
<a href="#l4.67"></a><span id="l4.67" class="difflineminus">-        &lt;menuitem value=&quot;Name&quot; label=&quot;&amp;search.name.label;&quot;/&gt;</span>
<a href="#l4.68"></a><span id="l4.68" class="difflineminus">-        &lt;menuitem value=&quot;URL&quot; label=&quot;&amp;search.url.label;&quot;/&gt;</span>
<a href="#l4.69"></a><span id="l4.69" class="difflineminus">-      &lt;/menupopup&gt;</span>
<a href="#l4.70"></a><span id="l4.70" class="difflineminus">-    &lt;/menulist&gt;</span>
<a href="#l4.71"></a><span id="l4.71" class="difflineminus">-    &lt;menulist id=&quot;methodList&quot;&gt;</span>
<a href="#l4.72"></a><span id="l4.72" class="difflineminus">-      &lt;menupopup&gt;</span>
<a href="#l4.73"></a><span id="l4.73" class="difflineminus">-        &lt;menuitem value=&quot;contains&quot; label=&quot;&amp;search.contains.label;&quot;/&gt;</span>
<a href="#l4.74"></a><span id="l4.74" class="difflineminus">-        &lt;menuitem value=&quot;startswith&quot; label=&quot;&amp;search.startswith.label;&quot;/&gt;</span>
<a href="#l4.75"></a><span id="l4.75" class="difflineminus">-        &lt;menuitem value=&quot;endswith&quot; label=&quot;&amp;search.endswith.label;&quot;/&gt;</span>
<a href="#l4.76"></a><span id="l4.76" class="difflineminus">-        &lt;menuitem value=&quot;is&quot; label=&quot;&amp;search.is.label;&quot;/&gt;</span>
<a href="#l4.77"></a><span id="l4.77" class="difflineminus">-        &lt;menuitem value=&quot;isnot&quot; label=&quot;&amp;search.isnot.label;&quot;/&gt;</span>
<a href="#l4.78"></a><span id="l4.78" class="difflineminus">-        &lt;menuitem value=&quot;doesntcontain&quot; label=&quot;&amp;search.doesntcontain.label;&quot;/&gt;</span>
<a href="#l4.79"></a><span id="l4.79" class="difflineminus">-      &lt;/menupopup&gt;</span>
<a href="#l4.80"></a><span id="l4.80" class="difflineminus">-    &lt;/menulist&gt;</span>
<a href="#l4.81"></a><span id="l4.81" class="difflineminus">-    &lt;textbox id=&quot;searchField&quot; flex=&quot;1&quot; oninput=&quot;doEnabling();&quot;/&gt;</span>
<a href="#l4.82"></a><span id="l4.82" class="difflineminus">-  &lt;/hbox&gt;</span>
<a href="#l4.83"></a><span id="l4.83" class="difflineminus">-&lt;/dialog&gt;</span>
<a href="#l4.84"></a><span id="l4.84" class="difflineminus">-</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l5.1"></a><span id="l5.1" class="difflineminus">--- a/suite/common/history/history-panel.xul</span>
<a href="#l5.2"></a><span id="l5.2" class="difflineplus">+++ b/suite/common/history/history-panel.xul</span>
<a href="#l5.3"></a><span id="l5.3" class="difflineat">@@ -1,82 +1,122 @@</span>
<a href="#l5.4"></a><span id="l5.4"> &lt;?xml version=&quot;1.0&quot;?&gt; &lt;!-- -*- Mode: xml; indent-tabs-mode: nil; -*- --&gt;</span>
<a href="#l5.5"></a><span id="l5.5" class="difflineminus">-&lt;!--</span>
<a href="#l5.6"></a><span id="l5.6" class="difflineminus">-</span>
<a href="#l5.7"></a><span id="l5.7" class="difflineminus">- ***** BEGIN LICENSE BLOCK *****</span>
<a href="#l5.8"></a><span id="l5.8" class="difflineminus">- Version: MPL 1.1/GPL 2.0/LGPL 2.1</span>
<a href="#l5.9"></a><span id="l5.9" class="difflineminus">-</span>
<a href="#l5.10"></a><span id="l5.10" class="difflineminus">- The contents of this file are subject to the Mozilla Public License Version</span>
<a href="#l5.11"></a><span id="l5.11" class="difflineminus">- 1.1 (the &quot;License&quot;); you may not use this file except in compliance with</span>
<a href="#l5.12"></a><span id="l5.12" class="difflineminus">- the License. You may obtain a copy of the License at</span>
<a href="#l5.13"></a><span id="l5.13" class="difflineminus">- http://www.mozilla.org/MPL/</span>
<a href="#l5.14"></a><span id="l5.14" class="difflineminus">-</span>
<a href="#l5.15"></a><span id="l5.15" class="difflineminus">- Software distributed under the License is distributed on an &quot;AS IS&quot; basis,</span>
<a href="#l5.16"></a><span id="l5.16" class="difflineminus">- WITHOUT WARRANTY OF ANY KIND, either express or implied. See the License</span>
<a href="#l5.17"></a><span id="l5.17" class="difflineminus">- for the specific language governing rights and limitations under the</span>
<a href="#l5.18"></a><span id="l5.18" class="difflineminus">- License.</span>
<a href="#l5.19"></a><span id="l5.19" class="difflineminus">-</span>
<a href="#l5.20"></a><span id="l5.20" class="difflineminus">- The Original Code is mozilla.org code.</span>
<a href="#l5.21"></a><span id="l5.21"> </span>
<a href="#l5.22"></a><span id="l5.22" class="difflineminus">- The Initial Developer of the Original Code is</span>
<a href="#l5.23"></a><span id="l5.23" class="difflineminus">- Netscape Communications Corporation.</span>
<a href="#l5.24"></a><span id="l5.24" class="difflineminus">- Portions created by the Initial Developer are Copyright (C) 1998</span>
<a href="#l5.25"></a><span id="l5.25" class="difflineminus">- the Initial Developer. All Rights Reserved.</span>
<a href="#l5.26"></a><span id="l5.26" class="difflineminus">-</span>
<a href="#l5.27"></a><span id="l5.27" class="difflineminus">- Contributor(s):</span>
<a href="#l5.28"></a><span id="l5.28" class="difflineplus">+&lt;!-- ***** BEGIN LICENSE BLOCK *****</span>
<a href="#l5.29"></a><span id="l5.29" class="difflineplus">+   - Version: MPL 1.1/GPL 2.0/LGPL 2.1</span>
<a href="#l5.30"></a><span id="l5.30" class="difflineplus">+   -</span>
<a href="#l5.31"></a><span id="l5.31" class="difflineplus">+   - The contents of this file are subject to the Mozilla Public License Version</span>
<a href="#l5.32"></a><span id="l5.32" class="difflineplus">+   - 1.1 (the &quot;License&quot;); you may not use this file except in compliance with</span>
<a href="#l5.33"></a><span id="l5.33" class="difflineplus">+   - the License. You may obtain a copy of the License at</span>
<a href="#l5.34"></a><span id="l5.34" class="difflineplus">+   - http://www.mozilla.org/MPL/</span>
<a href="#l5.35"></a><span id="l5.35" class="difflineplus">+   -</span>
<a href="#l5.36"></a><span id="l5.36" class="difflineplus">+   - Software distributed under the License is distributed on an &quot;AS IS&quot; basis,</span>
<a href="#l5.37"></a><span id="l5.37" class="difflineplus">+   - WITHOUT WARRANTY OF ANY KIND, either express or implied. See the License</span>
<a href="#l5.38"></a><span id="l5.38" class="difflineplus">+   - for the specific language governing rights and limitations under the</span>
<a href="#l5.39"></a><span id="l5.39" class="difflineplus">+   - License.</span>
<a href="#l5.40"></a><span id="l5.40" class="difflineplus">+   -</span>
<a href="#l5.41"></a><span id="l5.41" class="difflineplus">+   - The Original Code is mozilla.org code.</span>
<a href="#l5.42"></a><span id="l5.42" class="difflineplus">+   -</span>
<a href="#l5.43"></a><span id="l5.43" class="difflineplus">+   - The Initial Developer of the Original Code is</span>
<a href="#l5.44"></a><span id="l5.44" class="difflineplus">+   - Netscape Communications Corporation.</span>
<a href="#l5.45"></a><span id="l5.45" class="difflineplus">+   - Portions created by the Initial Developer are Copyright (C) 1998</span>
<a href="#l5.46"></a><span id="l5.46" class="difflineplus">+   - the Initial Developer. All Rights Reserved.</span>
<a href="#l5.47"></a><span id="l5.47" class="difflineplus">+   -</span>
<a href="#l5.48"></a><span id="l5.48" class="difflineplus">+   - Contributor(s):</span>
<a href="#l5.49"></a><span id="l5.49" class="difflineplus">+   -   Alec Flett &lt;alecf@netscape.com&gt; (original author of history-panel.xul)</span>
<a href="#l5.50"></a><span id="l5.50" class="difflineplus">+   -   Seth Spitzer &lt;sspitzer@mozilla.org&gt; (port to Places)</span>
<a href="#l5.51"></a><span id="l5.51" class="difflineplus">+   -</span>
<a href="#l5.52"></a><span id="l5.52" class="difflineplus">+   - Alternatively, the contents of this file may be used under the terms of</span>
<a href="#l5.53"></a><span id="l5.53" class="difflineplus">+   - either the GNU General Public License Version 2 or later (the &quot;GPL&quot;), or</span>
<a href="#l5.54"></a><span id="l5.54" class="difflineplus">+   - the GNU Lesser General Public License Version 2.1 or later (the &quot;LGPL&quot;),</span>
<a href="#l5.55"></a><span id="l5.55" class="difflineplus">+   - in which case the provisions of the GPL or the LGPL are applicable instead</span>
<a href="#l5.56"></a><span id="l5.56" class="difflineplus">+   - of those above. If you wish to allow use of your version of this file only</span>
<a href="#l5.57"></a><span id="l5.57" class="difflineplus">+   - under the terms of either the GPL or the LGPL, and not to allow others to</span>
<a href="#l5.58"></a><span id="l5.58" class="difflineplus">+   - use your version of this file under the terms of the MPL, indicate your</span>
<a href="#l5.59"></a><span id="l5.59" class="difflineplus">+   - decision by deleting the provisions above and replace them with the notice</span>
<a href="#l5.60"></a><span id="l5.60" class="difflineplus">+   - and other provisions required by the LGPL or the GPL. If you do not delete</span>
<a href="#l5.61"></a><span id="l5.61" class="difflineplus">+   - the provisions above, a recipient may use your version of this file under</span>
<a href="#l5.62"></a><span id="l5.62" class="difflineplus">+   - the terms of any one of the MPL, the GPL or the LGPL.</span>
<a href="#l5.63"></a><span id="l5.63" class="difflineplus">+   -</span>
<a href="#l5.64"></a><span id="l5.64" class="difflineplus">+   - ***** END LICENSE BLOCK ***** --&gt;</span>
<a href="#l5.65"></a><span id="l5.65"> </span>
<a href="#l5.66"></a><span id="l5.66" class="difflineminus">- Alternatively, the contents of this file may be used under the terms of</span>
<a href="#l5.67"></a><span id="l5.67" class="difflineminus">- either of the GNU General Public License Version 2 or later (the &quot;GPL&quot;),</span>
<a href="#l5.68"></a><span id="l5.68" class="difflineminus">- or the GNU Lesser General Public License Version 2.1 or later (the &quot;LGPL&quot;),</span>
<a href="#l5.69"></a><span id="l5.69" class="difflineminus">- in which case the provisions of the GPL or the LGPL are applicable instead</span>
<a href="#l5.70"></a><span id="l5.70" class="difflineminus">- of those above. If you wish to allow use of your version of this file only</span>
<a href="#l5.71"></a><span id="l5.71" class="difflineminus">- under the terms of either the GPL or the LGPL, and not to allow others to</span>
<a href="#l5.72"></a><span id="l5.72" class="difflineminus">- use your version of this file under the terms of the MPL, indicate your</span>
<a href="#l5.73"></a><span id="l5.73" class="difflineminus">- decision by deleting the provisions above and replace them with the notice</span>
<a href="#l5.74"></a><span id="l5.74" class="difflineminus">- and other provisions required by the GPL or the LGPL. If you do not delete</span>
<a href="#l5.75"></a><span id="l5.75" class="difflineminus">- the provisions above, a recipient may use your version of this file under</span>
<a href="#l5.76"></a><span id="l5.76" class="difflineminus">- the terms of any one of the MPL, the GPL or the LGPL.</span>
<a href="#l5.77"></a><span id="l5.77" class="difflineminus">-</span>
<a href="#l5.78"></a><span id="l5.78" class="difflineminus">- ***** END LICENSE BLOCK ***** --&gt;</span>
<a href="#l5.79"></a><span id="l5.79" class="difflineminus">-</span>
<a href="#l5.80"></a><span id="l5.80" class="difflineplus">+&lt;?xml-stylesheet href=&quot;chrome://communicator/content/history/places.css&quot;?&gt;</span>
<a href="#l5.81"></a><span id="l5.81"> &lt;?xml-stylesheet href=&quot;chrome://communicator/skin/&quot; type=&quot;text/css&quot;?&gt;</span>
<a href="#l5.82"></a><span id="l5.82"> &lt;?xml-stylesheet href=&quot;chrome://communicator/skin/sidebar/sidebarListView.css&quot; type=&quot;text/css&quot;?&gt;</span>
<a href="#l5.83"></a><span id="l5.83" class="difflineplus">+&lt;?xml-stylesheet href=&quot;chrome://communicator/skin/history/places.css&quot;?&gt;</span>
<a href="#l5.84"></a><span id="l5.84"> </span>
<a href="#l5.85"></a><span id="l5.85" class="difflineminus">-&lt;?xul-overlay href=&quot;chrome://communicator/content/history/historyTreeOverlay.xul&quot;?&gt;</span>
<a href="#l5.86"></a><span id="l5.86" class="difflineplus">+&lt;?xul-overlay href=&quot;chrome://global/content/editMenuOverlay.xul&quot;?&gt;</span>
<a href="#l5.87"></a><span id="l5.87" class="difflineplus">+&lt;?xul-overlay href=&quot;chrome://communicator/content/history/placesOverlay.xul&quot;?&gt;</span>
<a href="#l5.88"></a><span id="l5.88" class="difflineplus">+&lt;?xul-overlay href=&quot;chrome://communicator/content/utilityOverlay.xul&quot;?&gt;</span>
<a href="#l5.89"></a><span id="l5.89"> </span>
<a href="#l5.90"></a><span id="l5.90" class="difflineminus">-&lt;!DOCTYPE page SYSTEM &quot;chrome://communicator/locale/history/history.dtd&quot; &gt;</span>
<a href="#l5.91"></a><span id="l5.91" class="difflineplus">+&lt;!DOCTYPE page SYSTEM &quot;chrome://communicator/locale/history/history.dtd&quot;&gt;</span>
<a href="#l5.92"></a><span id="l5.92" class="difflineplus">+</span>
<a href="#l5.93"></a><span id="l5.93" class="difflineplus">+&lt;!-- we need to keep id=&quot;history-panel&quot; for upgrade and switching</span>
<a href="#l5.94"></a><span id="l5.94" class="difflineplus">+     between versions of the browser --&gt;</span>
<a href="#l5.95"></a><span id="l5.95"> </span>
<a href="#l5.96"></a><span id="l5.96"> &lt;page id=&quot;history-panel&quot; orient=&quot;vertical&quot;</span>
<a href="#l5.97"></a><span id="l5.97">       xmlns=&quot;http://www.mozilla.org/keymaster/gatekeeper/there.is.only.xul&quot;</span>
<a href="#l5.98"></a><span id="l5.98" class="difflineminus">-      onload=&quot;HistoryCommonInit();&quot;</span>
<a href="#l5.99"></a><span id="l5.99" class="difflineminus">-      onunload=&quot;HistoryPanelUnload();&quot;</span>
<a href="#l5.100"></a><span id="l5.100" class="difflineminus">-      elementtofocus=&quot;historyTree&quot;&gt;</span>
<a href="#l5.101"></a><span id="l5.101" class="difflineminus">-  &lt;stringbundle id=&quot;historyBundle&quot;</span>
<a href="#l5.102"></a><span id="l5.102" class="difflineminus">-                src=&quot;chrome://communicator/locale/history/history.properties&quot;/&gt;</span>
<a href="#l5.103"></a><span id="l5.103" class="difflineminus">-  &lt;commandset id=&quot;selectEditMenuItems&quot;&gt;</span>
<a href="#l5.104"></a><span id="l5.104" class="difflineminus">-    &lt;command id=&quot;cmd_delete&quot;/&gt;</span>
<a href="#l5.105"></a><span id="l5.105" class="difflineminus">-    &lt;command id=&quot;cmd_copy&quot;/&gt;</span>
<a href="#l5.106"></a><span id="l5.106" class="difflineminus">-  &lt;/commandset&gt;</span>
<a href="#l5.107"></a><span id="l5.107" class="difflineminus">-  &lt;keyset id=&quot;historyKeys&quot;&gt;</span>
<a href="#l5.108"></a><span id="l5.108" class="difflineminus">-    &lt;key id=&quot;key_delete&quot;/&gt;</span>
<a href="#l5.109"></a><span id="l5.109" class="difflineplus">+      onload=&quot;HistorySidebarInit();&quot;</span>
<a href="#l5.110"></a><span id="l5.110" class="difflineplus">+      onunload=&quot;SidebarUtils.clearURLFromStatusBar();&quot;</span>
<a href="#l5.111"></a><span id="l5.111" class="difflineplus">+      elementtofocus=&quot;search-box&quot;&gt;</span>
<a href="#l5.112"></a><span id="l5.112" class="difflineplus">+</span>
<a href="#l5.113"></a><span id="l5.113" class="difflineplus">+  &lt;script type=&quot;application/x-javascript&quot;</span>
<a href="#l5.114"></a><span id="l5.114" class="difflineplus">+          src=&quot;chrome://communicator/content/history/sidebarUtils.js&quot;/&gt;</span>
<a href="#l5.115"></a><span id="l5.115" class="difflineplus">+  &lt;script type=&quot;application/x-javascript&quot;</span>
<a href="#l5.116"></a><span id="l5.116" class="difflineplus">+          src=&quot;chrome://communicator/content/history/history.js&quot;/&gt;</span>
<a href="#l5.117"></a><span id="l5.117" class="difflineplus">+  &lt;script type=&quot;application/x-javascript&quot;</span>
<a href="#l5.118"></a><span id="l5.118" class="difflineplus">+          src=&quot;chrome://communicator/content/bookmarks/bookmarks.js&quot;/&gt;</span>
<a href="#l5.119"></a><span id="l5.119" class="difflineplus">+</span>
<a href="#l5.120"></a><span id="l5.120" class="difflineplus">+  &lt;commandset id=&quot;editMenuCommands&quot;/&gt;</span>
<a href="#l5.121"></a><span id="l5.121" class="difflineplus">+  &lt;commandset id=&quot;placesCommands&quot;/&gt;</span>
<a href="#l5.122"></a><span id="l5.122" class="difflineplus">+</span>
<a href="#l5.123"></a><span id="l5.123" class="difflineplus">+  &lt;keyset id=&quot;editMenuKeys&quot;&gt;</span>
<a href="#l5.124"></a><span id="l5.124">     &lt;key id=&quot;key_delete2&quot;/&gt;</span>
<a href="#l5.125"></a><span id="l5.125" class="difflineminus">-    &lt;key id=&quot;key_copy&quot;/&gt;</span>
<a href="#l5.126"></a><span id="l5.126">   &lt;/keyset&gt;</span>
<a href="#l5.127"></a><span id="l5.127" class="difflineminus">-  &lt;popupset id=&quot;historyContextMenu&quot;/&gt;</span>
<a href="#l5.128"></a><span id="l5.128" class="difflineminus">-  &lt;!-- use deep merging to hide certain columns by default --&gt;</span>
<a href="#l5.129"></a><span id="l5.129" class="difflineminus">-  &lt;tree id=&quot;historyTree&quot; onfocus=&quot;goUpdateSelectEditMenuItems();&quot; seltype=&quot;single&quot;&gt;</span>
<a href="#l5.130"></a><span id="l5.130" class="difflineminus">-    &lt;treecols id=&quot;historyTreeCols&quot;&gt;</span>
<a href="#l5.131"></a><span id="l5.131" class="difflineminus">-      &lt;treecol id=&quot;Name&quot;/&gt;</span>
<a href="#l5.132"></a><span id="l5.132" class="difflineminus">-      &lt;splitter id=&quot;pre-URL-splitter&quot;/&gt;</span>
<a href="#l5.133"></a><span id="l5.133" class="difflineminus">-      &lt;treecol id=&quot;URL&quot; hidden=&quot;true&quot;/&gt;</span>
<a href="#l5.134"></a><span id="l5.134" class="difflineminus">-      &lt;splitter id=&quot;pre-Date-splitter&quot;/&gt;</span>
<a href="#l5.135"></a><span id="l5.135" class="difflineminus">-      &lt;treecol id=&quot;Date&quot; hidden=&quot;true&quot;/&gt;</span>
<a href="#l5.136"></a><span id="l5.136" class="difflineminus">-      &lt;splitter id=&quot;pre-FirstVisitDate-splitter&quot;/&gt;</span>
<a href="#l5.137"></a><span id="l5.137" class="difflineminus">-      &lt;treecol id=&quot;FirstVisitDate&quot; hidden=&quot;true&quot;/&gt;</span>
<a href="#l5.138"></a><span id="l5.138" class="difflineminus">-      &lt;splitter id=&quot;pre-Hostname-splitter&quot;/&gt;</span>
<a href="#l5.139"></a><span id="l5.139" class="difflineminus">-      &lt;treecol id=&quot;Hostname&quot; hidden=&quot;true&quot;/&gt;</span>
<a href="#l5.140"></a><span id="l5.140" class="difflineminus">-      &lt;splitter id=&quot;pre-Referrer-splitter&quot;/&gt;</span>
<a href="#l5.141"></a><span id="l5.141" class="difflineminus">-      &lt;treecol id=&quot;Referrer&quot; hidden=&quot;true&quot;/&gt;</span>
<a href="#l5.142"></a><span id="l5.142" class="difflineminus">-      &lt;splitter id=&quot;pre-VisitCount-splitter&quot;/&gt;</span>
<a href="#l5.143"></a><span id="l5.143" class="difflineminus">-      &lt;treecol id=&quot;VisitCount&quot; hidden=&quot;true&quot;/&gt;</span>
<a href="#l5.144"></a><span id="l5.144" class="difflineplus">+</span>
<a href="#l5.145"></a><span id="l5.145" class="difflineplus">+  &lt;popup id=&quot;placesContext&quot;/&gt;</span>
<a href="#l5.146"></a><span id="l5.146" class="difflineplus">+</span>
<a href="#l5.147"></a><span id="l5.147" class="difflineplus">+  &lt;hbox align=&quot;center&quot;&gt;</span>
<a href="#l5.148"></a><span id="l5.148" class="difflineplus">+    &lt;textbox id=&quot;search-box&quot; flex=&quot;1&quot; type=&quot;search&quot;</span>
<a href="#l5.149"></a><span id="l5.149" class="difflineplus">+             emptytext=&quot;&amp;search.emptytext;&quot;</span>
<a href="#l5.150"></a><span id="l5.150" class="difflineplus">+             oncommand=&quot;searchHistory(this.value);&quot;/&gt;</span>
<a href="#l5.151"></a><span id="l5.151" class="difflineplus">+    &lt;toolbarbutton id=&quot;viewButton&quot; type=&quot;menu&quot;</span>
<a href="#l5.152"></a><span id="l5.152" class="difflineplus">+            label=&quot;&amp;view.label;&quot;</span>
<a href="#l5.153"></a><span id="l5.153" class="difflineplus">+            selectedsort=&quot;day&quot; persist=&quot;selectedsort&quot;&gt;</span>
<a href="#l5.154"></a><span id="l5.154" class="difflineplus">+      &lt;menupopup&gt;</span>
<a href="#l5.155"></a><span id="l5.155" class="difflineplus">+        &lt;menuitem id=&quot;bydayandsite&quot; label=&quot;&amp;byDayAndSite.label;&quot;</span>
<a href="#l5.156"></a><span id="l5.156" class="difflineplus">+                  accesskey=&quot;&amp;byDayAndSite.accesskey;&quot; type=&quot;radio&quot;</span>
<a href="#l5.157"></a><span id="l5.157" class="difflineplus">+                  oncommand=&quot;this.parentNode.parentNode.setAttribute('selectedsort', 'dayandsite'); GroupBy('dayandsite');&quot;/&gt;</span>
<a href="#l5.158"></a><span id="l5.158" class="difflineplus">+        &lt;menuitem id=&quot;bysite&quot; label=&quot;&amp;bySite.label;&quot;</span>
<a href="#l5.159"></a><span id="l5.159" class="difflineplus">+                  accesskey=&quot;&amp;bySite.accesskey;&quot; type=&quot;radio&quot;</span>
<a href="#l5.160"></a><span id="l5.160" class="difflineplus">+                  oncommand=&quot;this.parentNode.parentNode.setAttribute('selectedsort', 'site'); GroupBy('site');&quot;/&gt;</span>
<a href="#l5.161"></a><span id="l5.161" class="difflineplus">+        &lt;menuitem id=&quot;byday&quot; label=&quot;&amp;byDate.label;&quot;</span>
<a href="#l5.162"></a><span id="l5.162" class="difflineplus">+                  accesskey=&quot;&amp;byDate.accesskey;&quot;</span>
<a href="#l5.163"></a><span id="l5.163" class="difflineplus">+                  type=&quot;radio&quot;</span>
<a href="#l5.164"></a><span id="l5.164" class="difflineplus">+                  oncommand=&quot;this.parentNode.parentNode.setAttribute('selectedsort', 'day'); GroupBy('day');&quot;/&gt;</span>
<a href="#l5.165"></a><span id="l5.165" class="difflineplus">+        &lt;menuitem id=&quot;byvisited&quot; label=&quot;&amp;byMostVisited.label;&quot;</span>
<a href="#l5.166"></a><span id="l5.166" class="difflineplus">+                  accesskey=&quot;&amp;byMostVisited.accesskey;&quot;</span>
<a href="#l5.167"></a><span id="l5.167" class="difflineplus">+                  type=&quot;radio&quot;</span>
<a href="#l5.168"></a><span id="l5.168" class="difflineplus">+                  oncommand=&quot;this.parentNode.parentNode.setAttribute('selectedsort', 'visited'); GroupBy('visited');&quot;/&gt;</span>
<a href="#l5.169"></a><span id="l5.169" class="difflineplus">+        &lt;menuitem id=&quot;bylastvisited&quot; label=&quot;&amp;byLastVisited.label;&quot;</span>
<a href="#l5.170"></a><span id="l5.170" class="difflineplus">+                  accesskey=&quot;&amp;byLastVisited.accesskey;&quot;</span>
<a href="#l5.171"></a><span id="l5.171" class="difflineplus">+                  type=&quot;radio&quot;</span>
<a href="#l5.172"></a><span id="l5.172" class="difflineplus">+                  oncommand=&quot;this.parentNode.parentNode.setAttribute('selectedsort', 'lastvisited'); GroupBy('lastvisited');&quot;/&gt;</span>
<a href="#l5.173"></a><span id="l5.173" class="difflineplus">+      &lt;/menupopup&gt;</span>
<a href="#l5.174"></a><span id="l5.174" class="difflineplus">+    &lt;/toolbarbutton&gt;</span>
<a href="#l5.175"></a><span id="l5.175" class="difflineplus">+  &lt;/hbox&gt;</span>
<a href="#l5.176"></a><span id="l5.176" class="difflineplus">+</span>
<a href="#l5.177"></a><span id="l5.177" class="difflineplus">+  &lt;tree id=&quot;historyTree&quot;</span>
<a href="#l5.178"></a><span id="l5.178" class="difflineplus">+        class=&quot;sidebar-placesTree plain&quot;</span>
<a href="#l5.179"></a><span id="l5.179" class="difflineplus">+        flex=&quot;1&quot;</span>
<a href="#l5.180"></a><span id="l5.180" class="difflineplus">+        type=&quot;places&quot;</span>
<a href="#l5.181"></a><span id="l5.181" class="difflineplus">+        context=&quot;placesContext&quot;</span>
<a href="#l5.182"></a><span id="l5.182" class="difflineplus">+        hidecolumnpicker=&quot;true&quot;</span>
<a href="#l5.183"></a><span id="l5.183" class="difflineplus">+        onkeypress=&quot;SidebarUtils.handleTreeKeyPress(event);&quot;</span>
<a href="#l5.184"></a><span id="l5.184" class="difflineplus">+        onclick=&quot;SidebarUtils.handleTreeClick(this, event, true);&quot;</span>
<a href="#l5.185"></a><span id="l5.185" class="difflineplus">+        onmousemove=&quot;SidebarUtils.handleTreeMouseMove(event);&quot;</span>
<a href="#l5.186"></a><span id="l5.186" class="difflineplus">+        onmouseout=&quot;SidebarUtils.clearURLFromStatusBar();&quot;&gt;</span>
<a href="#l5.187"></a><span id="l5.187" class="difflineplus">+    &lt;treecols&gt;</span>
<a href="#l5.188"></a><span id="l5.188" class="difflineplus">+      &lt;treecol id=&quot;title&quot; flex=&quot;1&quot; primary=&quot;true&quot; hideheader=&quot;true&quot;/&gt;</span>
<a href="#l5.189"></a><span id="l5.189">     &lt;/treecols&gt;</span>
<a href="#l5.190"></a><span id="l5.190" class="difflineplus">+    &lt;treechildren class=&quot;sidebar-placesTreechildren&quot; flex=&quot;1&quot;/&gt;</span>
<a href="#l5.191"></a><span id="l5.191">   &lt;/tree&gt;</span>
<a href="#l5.192"></a><span id="l5.192"> &lt;/page&gt;</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l6.1"></a><span id="l6.1">deleted file mode 100644</span>
<a href="#l6.2"></a><span id="l6.2" class="difflineminus">--- a/suite/common/history/history-test.js</span>
<a href="#l6.3"></a><span id="l6.3" class="difflineplus">+++ /dev/null</span>
<a href="#l6.4"></a><span id="l6.4" class="difflineat">@@ -1,60 +0,0 @@</span>
<a href="#l6.5"></a><span id="l6.5" class="difflineminus">-/* -*- Mode: Java; tab-width: 4; indent-tabs-mode: nil; c-basic-offset: 2 -*- */</span>
<a href="#l6.6"></a><span id="l6.6" class="difflineminus">-/* ***** BEGIN LICENSE BLOCK *****</span>
<a href="#l6.7"></a><span id="l6.7" class="difflineminus">- * Version: MPL 1.1/GPL 2.0/LGPL 2.1</span>
<a href="#l6.8"></a><span id="l6.8" class="difflineminus">- *</span>
<a href="#l6.9"></a><span id="l6.9" class="difflineminus">- * The contents of this file are subject to the Mozilla Public License Version</span>
<a href="#l6.10"></a><span id="l6.10" class="difflineminus">- * 1.1 (the &quot;License&quot;); you may not use this file except in compliance with</span>
<a href="#l6.11"></a><span id="l6.11" class="difflineminus">- * the License. You may obtain a copy of the License at</span>
<a href="#l6.12"></a><span id="l6.12" class="difflineminus">- * http://www.mozilla.org/MPL/</span>
<a href="#l6.13"></a><span id="l6.13" class="difflineminus">- *</span>
<a href="#l6.14"></a><span id="l6.14" class="difflineminus">- * Software distributed under the License is distributed on an &quot;AS IS&quot; basis,</span>
<a href="#l6.15"></a><span id="l6.15" class="difflineminus">- * WITHOUT WARRANTY OF ANY KIND, either express or implied. See the License</span>
<a href="#l6.16"></a><span id="l6.16" class="difflineminus">- * for the specific language governing rights and limitations under the</span>
<a href="#l6.17"></a><span id="l6.17" class="difflineminus">- * License.</span>
<a href="#l6.18"></a><span id="l6.18" class="difflineminus">- *</span>
<a href="#l6.19"></a><span id="l6.19" class="difflineminus">- * The Original Code is mozilla.org code.</span>
<a href="#l6.20"></a><span id="l6.20" class="difflineminus">- *</span>
<a href="#l6.21"></a><span id="l6.21" class="difflineminus">- * The Initial Developer of the Original Code is</span>
<a href="#l6.22"></a><span id="l6.22" class="difflineminus">- * Netscape Communications Corporation.</span>
<a href="#l6.23"></a><span id="l6.23" class="difflineminus">- * Portions created by the Initial Developer are Copyright (C) 1998</span>
<a href="#l6.24"></a><span id="l6.24" class="difflineminus">- * the Initial Developer. All Rights Reserved.</span>
<a href="#l6.25"></a><span id="l6.25" class="difflineminus">- *</span>
<a href="#l6.26"></a><span id="l6.26" class="difflineminus">- * Contributor(s):</span>
<a href="#l6.27"></a><span id="l6.27" class="difflineminus">- *</span>
<a href="#l6.28"></a><span id="l6.28" class="difflineminus">- * Alternatively, the contents of this file may be used under the terms of</span>
<a href="#l6.29"></a><span id="l6.29" class="difflineminus">- * either of the GNU General Public License Version 2 or later (the &quot;GPL&quot;),</span>
<a href="#l6.30"></a><span id="l6.30" class="difflineminus">- * or the GNU Lesser General Public License Version 2.1 or later (the &quot;LGPL&quot;),</span>
<a href="#l6.31"></a><span id="l6.31" class="difflineminus">- * in which case the provisions of the GPL or the LGPL are applicable instead</span>
<a href="#l6.32"></a><span id="l6.32" class="difflineminus">- * of those above. If you wish to allow use of your version of this file only</span>
<a href="#l6.33"></a><span id="l6.33" class="difflineminus">- * under the terms of either the GPL or the LGPL, and not to allow others to</span>
<a href="#l6.34"></a><span id="l6.34" class="difflineminus">- * use your version of this file under the terms of the MPL, indicate your</span>
<a href="#l6.35"></a><span id="l6.35" class="difflineminus">- * decision by deleting the provisions above and replace them with the notice</span>
<a href="#l6.36"></a><span id="l6.36" class="difflineminus">- * and other provisions required by the GPL or the LGPL. If you do not delete</span>
<a href="#l6.37"></a><span id="l6.37" class="difflineminus">- * the provisions above, a recipient may use your version of this file under</span>
<a href="#l6.38"></a><span id="l6.38" class="difflineminus">- * the terms of any one of the MPL, the GPL or the LGPL.</span>
<a href="#l6.39"></a><span id="l6.39" class="difflineminus">- *</span>
<a href="#l6.40"></a><span id="l6.40" class="difflineminus">- * ***** END LICENSE BLOCK ***** */</span>
<a href="#l6.41"></a><span id="l6.41" class="difflineminus">-</span>
<a href="#l6.42"></a><span id="l6.42" class="difflineminus">-function ShowLastPageVisited() {</span>
<a href="#l6.43"></a><span id="l6.43" class="difflineminus">-    dump(&quot;start of ShowLastPageVisited()\n&quot;);</span>
<a href="#l6.44"></a><span id="l6.44" class="difflineminus">-</span>
<a href="#l6.45"></a><span id="l6.45" class="difflineminus">-    var lastpagevisited = &quot;failure...not set&quot;;</span>
<a href="#l6.46"></a><span id="l6.46" class="difflineminus">-    </span>
<a href="#l6.47"></a><span id="l6.47" class="difflineminus">-    var history = Components.classes['@mozilla.org/browser/global-history;1'];</span>
<a href="#l6.48"></a><span id="l6.48" class="difflineminus">-    if (history) {</span>
<a href="#l6.49"></a><span id="l6.49" class="difflineminus">-      history = history.getService();</span>
<a href="#l6.50"></a><span id="l6.50" class="difflineminus">-    }</span>
<a href="#l6.51"></a><span id="l6.51" class="difflineminus">-    if (history) {</span>
<a href="#l6.52"></a><span id="l6.52" class="difflineminus">-      history = history.QueryInterface(Components.interfaces.nsIGlobalHistory);</span>
<a href="#l6.53"></a><span id="l6.53" class="difflineminus">-    }</span>
<a href="#l6.54"></a><span id="l6.54" class="difflineminus">-    if (history) {</span>
<a href="#l6.55"></a><span id="l6.55" class="difflineminus">-      try {</span>
<a href="#l6.56"></a><span id="l6.56" class="difflineminus">-        lastpagevisited = history.lastPageVisited;</span>
<a href="#l6.57"></a><span id="l6.57" class="difflineminus">-	document.getElementById('result').value =  lastpagevisited;</span>
<a href="#l6.58"></a><span id="l6.58" class="difflineminus">-      } </span>
<a href="#l6.59"></a><span id="l6.59" class="difflineminus">-      catch (ex) {</span>
<a href="#l6.60"></a><span id="l6.60" class="difflineminus">-	dump(ex + &quot;\n&quot;);</span>
<a href="#l6.61"></a><span id="l6.61" class="difflineminus">-	document.getElementById('result').value = &quot;Error check console&quot;;</span>
<a href="#l6.62"></a><span id="l6.62" class="difflineminus">-      }    </span>
<a href="#l6.63"></a><span id="l6.63" class="difflineminus">-    }</span>
<a href="#l6.64"></a><span id="l6.64" class="difflineminus">-}</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l7.1"></a><span id="l7.1">deleted file mode 100644</span>
<a href="#l7.2"></a><span id="l7.2" class="difflineminus">--- a/suite/common/history/history-test.xul</span>
<a href="#l7.3"></a><span id="l7.3" class="difflineplus">+++ /dev/null</span>
<a href="#l7.4"></a><span id="l7.4" class="difflineat">@@ -1,20 +0,0 @@</span>
<a href="#l7.5"></a><span id="l7.5" class="difflineminus">-&lt;?xml version=&quot;1.0&quot;?&gt; </span>
<a href="#l7.6"></a><span id="l7.6" class="difflineminus">-&lt;?xml-stylesheet href=&quot;xul.css&quot; type=&quot;text/css&quot;?&gt; </span>
<a href="#l7.7"></a><span id="l7.7" class="difflineminus">-&lt;?xml-stylesheet href=&quot;chrome://navigator/skin/navigator.css&quot; type=&quot;text/css&quot;?&gt; </span>
<a href="#l7.8"></a><span id="l7.8" class="difflineminus">-</span>
<a href="#l7.9"></a><span id="l7.9" class="difflineminus">-&lt;window title=&quot;history test&quot; </span>
<a href="#l7.10"></a><span id="l7.10" class="difflineminus">-	id=&quot;history-test-window&quot; xmlns:html=&quot;http://www.w3.org/1999/xhtml&quot;</span>
<a href="#l7.11"></a><span id="l7.11" class="difflineminus">-	xmlns:rdf=&quot;http://www.w3.org/1999/02/22-rdf-syntax-ns#&quot;</span>
<a href="#l7.12"></a><span id="l7.12" class="difflineminus">-        xmlns=&quot;http://www.mozilla.org/keymaster/gatekeeper/there.is.only.xul&quot;&gt;</span>
<a href="#l7.13"></a><span id="l7.13" class="difflineminus">-</span>
<a href="#l7.14"></a><span id="l7.14" class="difflineminus">-&lt;script type=&quot;application/x-javascript&quot; src=&quot;history-test.js&quot;/&gt;</span>
<a href="#l7.15"></a><span id="l7.15" class="difflineminus">-</span>
<a href="#l7.16"></a><span id="l7.16" class="difflineminus">-&lt;html:b&gt;history test&lt;/html:b&gt;</span>
<a href="#l7.17"></a><span id="l7.17" class="difflineminus">-&lt;html:hr/&gt;</span>
<a href="#l7.18"></a><span id="l7.18" class="difflineminus">-</span>
<a href="#l7.19"></a><span id="l7.19" class="difflineminus">-&lt;hbox flex=&quot;100%&quot;&gt;</span>
<a href="#l7.20"></a><span id="l7.20" class="difflineminus">-&lt;html:input id=&quot;result&quot; type=&quot;text&quot; style=&quot;min-width: 400px; min-height: 27px&quot; flex=&quot;100%&quot;/&gt;</span>
<a href="#l7.21"></a><span id="l7.21" class="difflineminus">-&lt;/hbox&gt;</span>
<a href="#l7.22"></a><span id="l7.22" class="difflineminus">-&lt;html:hr/&gt;</span>
<a href="#l7.23"></a><span id="l7.23" class="difflineminus">-&lt;html:button onclick=&quot;ShowLastPageVisited();&quot;&gt;Show Last Page Visited&lt;/html:button&gt;  </span>
<a href="#l7.24"></a><span id="l7.24" class="difflineminus">-&lt;/window&gt;</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l8.1"></a><span id="l8.1" class="difflineminus">--- a/suite/common/history/history.js</span>
<a href="#l8.2"></a><span id="l8.2" class="difflineplus">+++ b/suite/common/history/history.js</span>
<a href="#l8.3"></a><span id="l8.3" class="difflineat">@@ -16,528 +16,130 @@</span>
<a href="#l8.4"></a><span id="l8.4">  *</span>
<a href="#l8.5"></a><span id="l8.5">  * The Initial Developer of the Original Code is</span>
<a href="#l8.6"></a><span id="l8.6">  * Netscape Communications Corporation.</span>
<a href="#l8.7"></a><span id="l8.7">  * Portions created by the Initial Developer are Copyright (C) 1998</span>
<a href="#l8.8"></a><span id="l8.8">  * the Initial Developer. All Rights Reserved.</span>
<a href="#l8.9"></a><span id="l8.9">  *</span>
<a href="#l8.10"></a><span id="l8.10">  * Contributor(s):</span>
<a href="#l8.11"></a><span id="l8.11">  *   Alec Flett &lt;alecf@netscape.com&gt;</span>
<a href="#l8.12"></a><span id="l8.12" class="difflineplus">+ *   Seth Spitzer &lt;sspizer@mozilla.org&gt; (port to Places)</span>
<a href="#l8.13"></a><span id="l8.13" class="difflineplus">+ *   Asaf Romano &lt;mano@mozilla.com&gt;</span>
<a href="#l8.14"></a><span id="l8.14" class="difflineplus">+ *   Robert Kaiser &lt;kairo@kairo.at&gt;</span>
<a href="#l8.15"></a><span id="l8.15">  *</span>
<a href="#l8.16"></a><span id="l8.16">  * Alternatively, the contents of this file may be used under the terms of</span>
<a href="#l8.17"></a><span id="l8.17">  * either of the GNU General Public License Version 2 or later (the &quot;GPL&quot;),</span>
<a href="#l8.18"></a><span id="l8.18">  * or the GNU Lesser General Public License Version 2.1 or later (the &quot;LGPL&quot;),</span>
<a href="#l8.19"></a><span id="l8.19">  * in which case the provisions of the GPL or the LGPL are applicable instead</span>
<a href="#l8.20"></a><span id="l8.20">  * of those above. If you wish to allow use of your version of this file only</span>
<a href="#l8.21"></a><span id="l8.21">  * under the terms of either the GPL or the LGPL, and not to allow others to</span>
<a href="#l8.22"></a><span id="l8.22">  * use your version of this file under the terms of the MPL, indicate your</span>
<a href="#l8.23"></a><span id="l8.23">  * decision by deleting the provisions above and replace them with the notice</span>
<a href="#l8.24"></a><span id="l8.24">  * and other provisions required by the GPL or the LGPL. If you do not delete</span>
<a href="#l8.25"></a><span id="l8.25">  * the provisions above, a recipient may use your version of this file under</span>
<a href="#l8.26"></a><span id="l8.26">  * the terms of any one of the MPL, the GPL or the LGPL.</span>
<a href="#l8.27"></a><span id="l8.27">  *</span>
<a href="#l8.28"></a><span id="l8.28">  * ***** END LICENSE BLOCK ***** */</span>
<a href="#l8.29"></a><span id="l8.29" class="difflineminus">-// The history window uses JavaScript in bookmarks.js too.</span>
<a href="#l8.30"></a><span id="l8.30"> </span>
<a href="#l8.31"></a><span id="l8.31"> var gHistoryTree;</span>
<a href="#l8.32"></a><span id="l8.32" class="difflineminus">-var gLastHostname;</span>
<a href="#l8.33"></a><span id="l8.33" class="difflineminus">-var gLastDomain;</span>
<a href="#l8.34"></a><span id="l8.34" class="difflineminus">-var gGlobalHistory;</span>
<a href="#l8.35"></a><span id="l8.35" class="difflineminus">-var gPrefService;</span>
<a href="#l8.36"></a><span id="l8.36" class="difflineminus">-var gIOService;</span>
<a href="#l8.37"></a><span id="l8.37" class="difflineminus">-var gDeleteByHostname;</span>
<a href="#l8.38"></a><span id="l8.38" class="difflineminus">-var gDeleteByDomain;</span>
<a href="#l8.39"></a><span id="l8.39" class="difflineminus">-var gHistoryBundle;</span>
<a href="#l8.40"></a><span id="l8.40" class="difflineminus">-var gHistoryStatus;</span>
<a href="#l8.41"></a><span id="l8.41" class="difflineplus">+var gSearchBox;</span>
<a href="#l8.42"></a><span id="l8.42"> var gHistoryGrouping = &quot;&quot;;</span>
<a href="#l8.43"></a><span id="l8.43" class="difflineminus">-</span>
<a href="#l8.44"></a><span id="l8.44" class="difflineminus">-function HistoryCommonInit()</span>
<a href="#l8.45"></a><span id="l8.45" class="difflineminus">-{</span>
<a href="#l8.46"></a><span id="l8.46" class="difflineminus">-    gHistoryTree =  document.getElementById(&quot;historyTree&quot;);</span>
<a href="#l8.47"></a><span id="l8.47" class="difflineminus">-    gDeleteByHostname = document.getElementById(&quot;menu_deleteByHostname&quot;);</span>
<a href="#l8.48"></a><span id="l8.48" class="difflineminus">-    gDeleteByDomain =   document.getElementById(&quot;menu_deleteByDomain&quot;);</span>
<a href="#l8.49"></a><span id="l8.49" class="difflineminus">-    gHistoryBundle =    document.getElementById(&quot;historyBundle&quot;);</span>
<a href="#l8.50"></a><span id="l8.50" class="difflineminus">-    gHistoryStatus =    document.getElementById(&quot;statusbar-display&quot;);</span>
<a href="#l8.51"></a><span id="l8.51" class="difflineminus">-</span>
<a href="#l8.52"></a><span id="l8.52" class="difflineminus">-    var treeController = new nsTreeController(gHistoryTree);</span>
<a href="#l8.53"></a><span id="l8.53" class="difflineminus">-    var historyController = new nsHistoryController;</span>
<a href="#l8.54"></a><span id="l8.54" class="difflineminus">-    gHistoryTree.controllers.appendController(historyController);</span>
<a href="#l8.55"></a><span id="l8.55" class="difflineminus">-</span>
<a href="#l8.56"></a><span id="l8.56" class="difflineminus">-    gPrefService = Components.classes[&quot;@mozilla.org/preferences-service;1&quot;]</span>
<a href="#l8.57"></a><span id="l8.57" class="difflineminus">-                              .getService(Components.interfaces.nsIPrefBranch);</span>
<a href="#l8.58"></a><span id="l8.58" class="difflineminus">-    PREF = gPrefService;    // need this for bookmarks.js</span>
<a href="#l8.59"></a><span id="l8.59" class="difflineplus">+var gSearching = false;</span>
<a href="#l8.60"></a><span id="l8.60"> </span>
<a href="#l8.61"></a><span id="l8.61" class="difflineminus">-    if (&quot;arguments&quot; in window &amp;&amp; window.arguments[0] &amp;&amp; window.arguments.length &gt;= 1) {</span>
<a href="#l8.62"></a><span id="l8.62" class="difflineminus">-        // We have been supplied a resource URI to root the tree on</span>
<a href="#l8.63"></a><span id="l8.63" class="difflineminus">-        var uri = window.arguments[0];</span>
<a href="#l8.64"></a><span id="l8.64" class="difflineminus">-        gHistoryTree.setAttribute(&quot;ref&quot;, uri);</span>
<a href="#l8.65"></a><span id="l8.65" class="difflineminus">-        if (uri.substring(0,5) == &quot;find:&quot; &amp;&amp;</span>
<a href="#l8.66"></a><span id="l8.66" class="difflineminus">-            !(window.arguments.length &gt; 1 &amp;&amp; window.arguments[1] == &quot;newWindow&quot;)) {</span>
<a href="#l8.67"></a><span id="l8.67" class="difflineminus">-            // Update the windowtype so that future searches are directed </span>
<a href="#l8.68"></a><span id="l8.68" class="difflineminus">-            // there and the window is not re-used for bookmarks. </span>
<a href="#l8.69"></a><span id="l8.69" class="difflineminus">-            var windowNode = document.getElementById(&quot;history-window&quot;);</span>
<a href="#l8.70"></a><span id="l8.70" class="difflineminus">-            windowNode.setAttribute(&quot;windowtype&quot;, &quot;history:searchresults&quot;);</span>
<a href="#l8.71"></a><span id="l8.71" class="difflineminus">-            document.title = gHistoryBundle.getString(&quot;search_results_title&quot;);</span>
<a href="#l8.72"></a><span id="l8.72" class="difflineplus">+function HistorySidebarInit()</span>
<a href="#l8.73"></a><span id="l8.73" class="difflineplus">+{</span>
<a href="#l8.74"></a><span id="l8.74" class="difflineplus">+  gHistoryTree = document.getElementById(&quot;historyTree&quot;);</span>
<a href="#l8.75"></a><span id="l8.75" class="difflineplus">+  gSearchBox = document.getElementById(&quot;search-box&quot;);</span>
<a href="#l8.76"></a><span id="l8.76"> </span>
<a href="#l8.77"></a><span id="l8.77" class="difflineminus">-        }</span>
<a href="#l8.78"></a><span id="l8.78" class="difflineminus">-        document.getElementById(&quot;groupingMenu&quot;).setAttribute(&quot;hidden&quot;, &quot;true&quot;);</span>
<a href="#l8.79"></a><span id="l8.79" class="difflineminus">-    }</span>
<a href="#l8.80"></a><span id="l8.80" class="difflineminus">-    else {</span>
<a href="#l8.81"></a><span id="l8.81" class="difflineminus">-        try {</span>
<a href="#l8.82"></a><span id="l8.82" class="difflineminus">-            gHistoryGrouping = gPrefService.getCharPref(&quot;browser.history.grouping&quot;);</span>
<a href="#l8.83"></a><span id="l8.83" class="difflineminus">-        }</span>
<a href="#l8.84"></a><span id="l8.84" class="difflineminus">-        catch(e) {</span>
<a href="#l8.85"></a><span id="l8.85" class="difflineminus">-            gHistoryGrouping = &quot;day&quot;;</span>
<a href="#l8.86"></a><span id="l8.86" class="difflineminus">-        }</span>
<a href="#l8.87"></a><span id="l8.87" class="difflineminus">-        UpdateTreeGrouping();</span>
<a href="#l8.88"></a><span id="l8.88" class="difflineminus">-        if (gHistoryStatus) {  // must be the window</span>
<a href="#l8.89"></a><span id="l8.89" class="difflineminus">-            switch(gHistoryGrouping) {</span>
<a href="#l8.90"></a><span id="l8.90" class="difflineminus">-            case &quot;none&quot;:</span>
<a href="#l8.91"></a><span id="l8.91" class="difflineminus">-                document.getElementById(&quot;groupByNone&quot;).setAttribute(&quot;checked&quot;, &quot;true&quot;);</span>
<a href="#l8.92"></a><span id="l8.92" class="difflineminus">-                break;</span>
<a href="#l8.93"></a><span id="l8.93" class="difflineminus">-            case &quot;site&quot;:</span>
<a href="#l8.94"></a><span id="l8.94" class="difflineminus">-                document.getElementById(&quot;groupBySite&quot;).setAttribute(&quot;checked&quot;, &quot;true&quot;);</span>
<a href="#l8.95"></a><span id="l8.95" class="difflineminus">-                break;</span>
<a href="#l8.96"></a><span id="l8.96" class="difflineminus">-            case &quot;day&quot;:</span>
<a href="#l8.97"></a><span id="l8.97" class="difflineminus">-            default:</span>
<a href="#l8.98"></a><span id="l8.98" class="difflineminus">-                document.getElementById(&quot;groupByDay&quot;).setAttribute(&quot;checked&quot;, &quot;true&quot;);</span>
<a href="#l8.99"></a><span id="l8.99" class="difflineminus">-            }        </span>
<a href="#l8.100"></a><span id="l8.100" class="difflineminus">-        }</span>
<a href="#l8.101"></a><span id="l8.101" class="difflineminus">-        else {  // must be the sidebar panel</span>
<a href="#l8.102"></a><span id="l8.102" class="difflineminus">-            var pb = Components.classes[&quot;@mozilla.org/preferences-service;1&quot;].getService(Components.interfaces.nsIPrefBranch);</span>
<a href="#l8.103"></a><span id="l8.103" class="difflineminus">-            var pbi = pb.QueryInterface(Components.interfaces.nsIPrefBranch2);</span>
<a href="#l8.104"></a><span id="l8.104" class="difflineminus">-            pbi.addObserver(&quot;browser.history.grouping&quot;, groupObserver, false);</span>
<a href="#l8.105"></a><span id="l8.105" class="difflineminus">-        }</span>
<a href="#l8.106"></a><span id="l8.106" class="difflineminus">-    } </span>
<a href="#l8.107"></a><span id="l8.107" class="difflineminus">-</span>
<a href="#l8.108"></a><span id="l8.108" class="difflineminus">-    SortInNewDirection(find_sort_direction(find_sort_column()));</span>
<a href="#l8.109"></a><span id="l8.109" class="difflineminus">-</span>
<a href="#l8.110"></a><span id="l8.110" class="difflineminus">-    if (gHistoryStatus)</span>
<a href="#l8.111"></a><span id="l8.111" class="difflineminus">-        gHistoryTree.focus();</span>
<a href="#l8.112"></a><span id="l8.112" class="difflineplus">+  gHistoryGrouping = document.getElementById(&quot;viewButton&quot;).</span>
<a href="#l8.113"></a><span id="l8.113" class="difflineplus">+                              getAttribute(&quot;selectedsort&quot;);</span>
<a href="#l8.114"></a><span id="l8.114"> </span>
<a href="#l8.115"></a><span id="l8.115" class="difflineminus">-    if (gHistoryTree.view.rowCount &gt; 0)</span>
<a href="#l8.116"></a><span id="l8.116" class="difflineminus">-        gHistoryTree.view.selection.select(0);</span>
<a href="#l8.117"></a><span id="l8.117" class="difflineminus">-    else if (gHistoryStatus)</span>
<a href="#l8.118"></a><span id="l8.118" class="difflineminus">-        updateHistoryCommands();</span>
<a href="#l8.119"></a><span id="l8.119" class="difflineminus">-}</span>
<a href="#l8.120"></a><span id="l8.120" class="difflineminus">-</span>
<a href="#l8.121"></a><span id="l8.121" class="difflineminus">-function HistoryPanelUnload()</span>
<a href="#l8.122"></a><span id="l8.122" class="difflineminus">-{</span>
<a href="#l8.123"></a><span id="l8.123" class="difflineminus">-  var pb = Components.classes[&quot;@mozilla.org/preferences-service;1&quot;].getService(Components.interfaces.nsIPrefBranch);</span>
<a href="#l8.124"></a><span id="l8.124" class="difflineminus">-  var pbi = pb.QueryInterface(Components.interfaces.nsIPrefBranch2);</span>
<a href="#l8.125"></a><span id="l8.125" class="difflineminus">-  pbi.removeObserver(&quot;browser.history.grouping&quot;, groupObserver, false);</span>
<a href="#l8.126"></a><span id="l8.126" class="difflineminus">-}</span>
<a href="#l8.127"></a><span id="l8.127" class="difflineminus">-</span>
<a href="#l8.128"></a><span id="l8.128" class="difflineminus">-function updateHistoryCommands()</span>
<a href="#l8.129"></a><span id="l8.129" class="difflineminus">-{</span>
<a href="#l8.130"></a><span id="l8.130" class="difflineminus">-    goUpdateCommand(&quot;cmd_deleteByHostname&quot;);</span>
<a href="#l8.131"></a><span id="l8.131" class="difflineminus">-    goUpdateCommand(&quot;cmd_deleteByDomain&quot;);</span>
<a href="#l8.132"></a><span id="l8.132" class="difflineminus">-}</span>
<a href="#l8.133"></a><span id="l8.133" class="difflineminus">-</span>
<a href="#l8.134"></a><span id="l8.134" class="difflineminus">-function historyOnClick(aEvent)</span>
<a href="#l8.135"></a><span id="l8.135" class="difflineminus">-{</span>
<a href="#l8.136"></a><span id="l8.136" class="difflineminus">-  // This is kind of a hack but matches the currently implemented behaviour. </span>
<a href="#l8.137"></a><span id="l8.137" class="difflineminus">-  // If a status bar is not present, assume we're in sidebar mode, and thus single clicks on containers</span>
<a href="#l8.138"></a><span id="l8.138" class="difflineminus">-  // will open the container. Single clicks on non-containers are handled below in historyOnSelect.</span>
<a href="#l8.139"></a><span id="l8.139" class="difflineminus">-  if (gHistoryStatus &amp;&amp; aEvent.button == 0)</span>
<a href="#l8.140"></a><span id="l8.140" class="difflineminus">-    return;</span>
<a href="#l8.141"></a><span id="l8.141" class="difflineminus">-</span>
<a href="#l8.142"></a><span id="l8.142" class="difflineminus">-  var target = BookmarksUtils.getBrowserTargetFromEvent(aEvent);</span>
<a href="#l8.143"></a><span id="l8.143" class="difflineminus">-  if (!target)</span>
<a href="#l8.144"></a><span id="l8.144" class="difflineminus">-    return;</span>
<a href="#l8.145"></a><span id="l8.145" class="difflineplus">+  if (gHistoryGrouping == &quot;site&quot;)</span>
<a href="#l8.146"></a><span id="l8.146" class="difflineplus">+    document.getElementById(&quot;bysite&quot;).setAttribute(&quot;checked&quot;, &quot;true&quot;);</span>
<a href="#l8.147"></a><span id="l8.147" class="difflineplus">+  else if (gHistoryGrouping == &quot;visited&quot;)</span>
<a href="#l8.148"></a><span id="l8.148" class="difflineplus">+    document.getElementById(&quot;byvisited&quot;).setAttribute(&quot;checked&quot;, &quot;true&quot;);</span>
<a href="#l8.149"></a><span id="l8.149" class="difflineplus">+  else if (gHistoryGrouping == &quot;lastvisited&quot;)</span>
<a href="#l8.150"></a><span id="l8.150" class="difflineplus">+    document.getElementById(&quot;bylastvisited&quot;).setAttribute(&quot;checked&quot;, &quot;true&quot;);</span>
<a href="#l8.151"></a><span id="l8.151" class="difflineplus">+  else if (gHistoryGrouping == &quot;dayandsite&quot;)</span>
<a href="#l8.152"></a><span id="l8.152" class="difflineplus">+    document.getElementById(&quot;bydayandsite&quot;).setAttribute(&quot;checked&quot;, &quot;true&quot;);</span>
<a href="#l8.153"></a><span id="l8.153" class="difflineplus">+  else</span>
<a href="#l8.154"></a><span id="l8.154" class="difflineplus">+    document.getElementById(&quot;byday&quot;).setAttribute(&quot;checked&quot;, &quot;true&quot;);</span>
<a href="#l8.155"></a><span id="l8.155"> </span>
<a href="#l8.156"></a><span id="l8.156" class="difflineminus">-  var row = { };</span>
<a href="#l8.157"></a><span id="l8.157" class="difflineminus">-  var col = { };</span>
<a href="#l8.158"></a><span id="l8.158" class="difflineminus">-  var elt = { };</span>
<a href="#l8.159"></a><span id="l8.159" class="difflineminus">-  gHistoryTree.treeBoxObject.getCellAt(aEvent.clientX, aEvent.clientY, row, col, elt);</span>
<a href="#l8.160"></a><span id="l8.160" class="difflineminus">-  if (row.value &gt;= 0 &amp;&amp; col.value) {</span>
<a href="#l8.161"></a><span id="l8.161" class="difflineminus">-    if (!isContainer(gHistoryTree, row.value))</span>
<a href="#l8.162"></a><span id="l8.162" class="difflineminus">-      OpenURL(target, aEvent);</span>
<a href="#l8.163"></a><span id="l8.163" class="difflineminus">-    else if (aEvent.button == 0 &amp;&amp; elt.value != &quot;twisty&quot;)</span>
<a href="#l8.164"></a><span id="l8.164" class="difflineminus">-      gHistoryTree.treeBoxObject.view.toggleOpenState(row.value);</span>
<a href="#l8.165"></a><span id="l8.165" class="difflineminus">-  }</span>
<a href="#l8.166"></a><span id="l8.166" class="difflineminus">-}</span>
<a href="#l8.167"></a><span id="l8.167" class="difflineminus">-</span>
<a href="#l8.168"></a><span id="l8.168" class="difflineminus">-function historyOnSelect()</span>
<a href="#l8.169"></a><span id="l8.169" class="difflineminus">-{</span>
<a href="#l8.170"></a><span id="l8.170" class="difflineminus">-    // every time selection changes, save the last hostname</span>
<a href="#l8.171"></a><span id="l8.171" class="difflineminus">-    gLastHostname = &quot;&quot;;</span>
<a href="#l8.172"></a><span id="l8.172" class="difflineminus">-    gLastDomain = &quot;&quot;;</span>
<a href="#l8.173"></a><span id="l8.173" class="difflineminus">-    var match;</span>
<a href="#l8.174"></a><span id="l8.174" class="difflineminus">-    var currentIndex = gHistoryTree.currentIndex;</span>
<a href="#l8.175"></a><span id="l8.175" class="difflineminus">-    var rowIsContainer = currentIndex &lt; 0 || (gHistoryGrouping != &quot;none&quot; &amp;&amp; isContainer(gHistoryTree, currentIndex));</span>
<a href="#l8.176"></a><span id="l8.176" class="difflineminus">-    var col = gHistoryTree.columns[&quot;URL&quot;];</span>
<a href="#l8.177"></a><span id="l8.177" class="difflineminus">-    var url = rowIsContainer ? &quot;&quot; : gHistoryTree.view.getCellText(currentIndex, col);</span>
<a href="#l8.178"></a><span id="l8.178" class="difflineminus">-</span>
<a href="#l8.179"></a><span id="l8.179" class="difflineminus">-    if (url) {</span>
<a href="#l8.180"></a><span id="l8.180" class="difflineminus">-        if (!gIOService)</span>
<a href="#l8.181"></a><span id="l8.181" class="difflineminus">-            gIOService = Components.classes['@mozilla.org/network/io-service;1']</span>
<a href="#l8.182"></a><span id="l8.182" class="difflineminus">-                                   .getService(Components.interfaces.nsIIOService);</span>
<a href="#l8.183"></a><span id="l8.183" class="difflineminus">-        try {</span>
<a href="#l8.184"></a><span id="l8.184" class="difflineminus">-            gLastHostname = gIOService.newURI(url, null, null).host;</span>
<a href="#l8.185"></a><span id="l8.185" class="difflineminus">-            // matches the last foo.bar in foo.bar or baz.foo.bar</span>
<a href="#l8.186"></a><span id="l8.186" class="difflineminus">-            match = gLastHostname.match(/([^.]+\.[^.]+$)/);</span>
<a href="#l8.187"></a><span id="l8.187" class="difflineminus">-            if (match)</span>
<a href="#l8.188"></a><span id="l8.188" class="difflineminus">-                gLastDomain = match[1];</span>
<a href="#l8.189"></a><span id="l8.189" class="difflineminus">-        } catch (e) {}</span>
<a href="#l8.190"></a><span id="l8.190" class="difflineminus">-    }</span>
<a href="#l8.191"></a><span id="l8.191" class="difflineminus">-</span>
<a href="#l8.192"></a><span id="l8.192" class="difflineminus">-    if (gHistoryStatus)</span>
<a href="#l8.193"></a><span id="l8.193" class="difflineminus">-        gHistoryStatus.label = url;</span>
<a href="#l8.194"></a><span id="l8.194" class="difflineminus">-</span>
<a href="#l8.195"></a><span id="l8.195" class="difflineminus">-    document.commandDispatcher.updateCommands(&quot;select&quot;);</span>
<a href="#l8.196"></a><span id="l8.196" class="difflineminus">-}</span>
<a href="#l8.197"></a><span id="l8.197" class="difflineminus">-</span>
<a href="#l8.198"></a><span id="l8.198" class="difflineminus">-function nsHistoryController()</span>
<a href="#l8.199"></a><span id="l8.199" class="difflineminus">-{</span>
<a href="#l8.200"></a><span id="l8.200" class="difflineplus">+  searchHistory(&quot;&quot;);</span>
<a href="#l8.201"></a><span id="l8.201"> }</span>
<a href="#l8.202"></a><span id="l8.202"> </span>
<a href="#l8.203"></a><span id="l8.203" class="difflineminus">-nsHistoryController.prototype =</span>
<a href="#l8.204"></a><span id="l8.204" class="difflineplus">+function GroupBy(groupingType)</span>
<a href="#l8.205"></a><span id="l8.205"> {</span>
<a href="#l8.206"></a><span id="l8.206" class="difflineminus">-    supportsCommand: function(command)</span>
<a href="#l8.207"></a><span id="l8.207" class="difflineminus">-    {</span>
<a href="#l8.208"></a><span id="l8.208" class="difflineminus">-        switch(command) {</span>
<a href="#l8.209"></a><span id="l8.209" class="difflineminus">-        case &quot;cmd_deleteByHostname&quot;:</span>
<a href="#l8.210"></a><span id="l8.210" class="difflineminus">-        case &quot;cmd_deleteByDomain&quot;:</span>
<a href="#l8.211"></a><span id="l8.211" class="difflineminus">-            return true;</span>
<a href="#l8.212"></a><span id="l8.212" class="difflineminus">-        default:</span>
<a href="#l8.213"></a><span id="l8.213" class="difflineminus">-            return false;</span>
<a href="#l8.214"></a><span id="l8.214" class="difflineminus">-        }</span>
<a href="#l8.215"></a><span id="l8.215" class="difflineminus">-    },</span>
<a href="#l8.216"></a><span id="l8.216" class="difflineminus">-</span>
<a href="#l8.217"></a><span id="l8.217" class="difflineminus">-    isCommandEnabled: function(command)</span>
<a href="#l8.218"></a><span id="l8.218" class="difflineminus">-    {</span>
<a href="#l8.219"></a><span id="l8.219" class="difflineminus">-        var enabled = false;</span>
<a href="#l8.220"></a><span id="l8.220" class="difflineminus">-        var text;</span>
<a href="#l8.221"></a><span id="l8.221" class="difflineminus">-        switch(command) {</span>
<a href="#l8.222"></a><span id="l8.222" class="difflineminus">-        case &quot;cmd_deleteByHostname&quot;:</span>
<a href="#l8.223"></a><span id="l8.223" class="difflineminus">-            if (gLastHostname) {</span>
<a href="#l8.224"></a><span id="l8.224" class="difflineminus">-                text = gHistoryBundle.getFormattedString(&quot;deleteHost&quot;, [ gLastHostname ]);</span>
<a href="#l8.225"></a><span id="l8.225" class="difflineminus">-                enabled = true;</span>
<a href="#l8.226"></a><span id="l8.226" class="difflineminus">-            } else {</span>
<a href="#l8.227"></a><span id="l8.227" class="difflineminus">-                text = gHistoryBundle.getString(&quot;deleteHostNoSelection&quot;);</span>
<a href="#l8.228"></a><span id="l8.228" class="difflineminus">-            }</span>
<a href="#l8.229"></a><span id="l8.229" class="difflineminus">-</span>
<a href="#l8.230"></a><span id="l8.230" class="difflineminus">-            gDeleteByHostname.label = text;</span>
<a href="#l8.231"></a><span id="l8.231" class="difflineminus">-            break;</span>
<a href="#l8.232"></a><span id="l8.232" class="difflineminus">-        case &quot;cmd_deleteByDomain&quot;:</span>
<a href="#l8.233"></a><span id="l8.233" class="difflineminus">-            if (gLastDomain) {</span>
<a href="#l8.234"></a><span id="l8.234" class="difflineminus">-                text = gHistoryBundle.getFormattedString(&quot;deleteDomain&quot;, [ gLastDomain ]);</span>
<a href="#l8.235"></a><span id="l8.235" class="difflineminus">-                enabled = true;</span>
<a href="#l8.236"></a><span id="l8.236" class="difflineminus">-            } else {</span>
<a href="#l8.237"></a><span id="l8.237" class="difflineminus">-                text = gHistoryBundle.getString(&quot;deleteDomainNoSelection&quot;);</span>
<a href="#l8.238"></a><span id="l8.238" class="difflineminus">-            }</span>
<a href="#l8.239"></a><span id="l8.239" class="difflineminus">-</span>
<a href="#l8.240"></a><span id="l8.240" class="difflineminus">-            gDeleteByDomain.label = text;</span>
<a href="#l8.241"></a><span id="l8.241" class="difflineminus">-        }</span>
<a href="#l8.242"></a><span id="l8.242" class="difflineminus">-        return enabled;</span>
<a href="#l8.243"></a><span id="l8.243" class="difflineminus">-    },</span>
<a href="#l8.244"></a><span id="l8.244" class="difflineminus">-</span>
<a href="#l8.245"></a><span id="l8.245" class="difflineminus">-    doCommand: function(command)</span>
<a href="#l8.246"></a><span id="l8.246" class="difflineminus">-    {</span>
<a href="#l8.247"></a><span id="l8.247" class="difflineminus">-        switch(command) {</span>
<a href="#l8.248"></a><span id="l8.248" class="difflineminus">-        case &quot;cmd_deleteByHostname&quot;:</span>
<a href="#l8.249"></a><span id="l8.249" class="difflineminus">-            if (!gGlobalHistory)</span>
<a href="#l8.250"></a><span id="l8.250" class="difflineminus">-                gGlobalHistory = Components.classes[&quot;@mozilla.org/browser/global-history;2&quot;].getService(Components.interfaces.nsIBrowserHistory);</span>
<a href="#l8.251"></a><span id="l8.251" class="difflineminus">-            gGlobalHistory.removePagesFromHost(gLastHostname, false)</span>
<a href="#l8.252"></a><span id="l8.252" class="difflineminus">-            return true;</span>
<a href="#l8.253"></a><span id="l8.253" class="difflineminus">-</span>
<a href="#l8.254"></a><span id="l8.254" class="difflineminus">-        case &quot;cmd_deleteByDomain&quot;:</span>
<a href="#l8.255"></a><span id="l8.255" class="difflineminus">-            if (!gGlobalHistory)</span>
<a href="#l8.256"></a><span id="l8.256" class="difflineminus">-                gGlobalHistory = Components.classes[&quot;@mozilla.org/browser/global-history;2&quot;].getService(Components.interfaces.nsIBrowserHistory);</span>
<a href="#l8.257"></a><span id="l8.257" class="difflineminus">-            gGlobalHistory.removePagesFromHost(gLastDomain, true)</span>
<a href="#l8.258"></a><span id="l8.258" class="difflineminus">-            return true;</span>
<a href="#l8.259"></a><span id="l8.259" class="difflineminus">-</span>
<a href="#l8.260"></a><span id="l8.260" class="difflineminus">-        default:</span>
<a href="#l8.261"></a><span id="l8.261" class="difflineminus">-            return false;</span>
<a href="#l8.262"></a><span id="l8.262" class="difflineminus">-        }</span>
<a href="#l8.263"></a><span id="l8.263" class="difflineminus">-    }</span>
<a href="#l8.264"></a><span id="l8.264" class="difflineminus">-}</span>
<a href="#l8.265"></a><span id="l8.265" class="difflineminus">-</span>
<a href="#l8.266"></a><span id="l8.266" class="difflineminus">-var historyDNDObserver = {</span>
<a href="#l8.267"></a><span id="l8.267" class="difflineminus">-    onDragStart: function (aEvent, aXferData, aDragAction)</span>
<a href="#l8.268"></a><span id="l8.268" class="difflineminus">-    {</span>
<a href="#l8.269"></a><span id="l8.269" class="difflineminus">-        var currentIndex = gHistoryTree.currentIndex;</span>
<a href="#l8.270"></a><span id="l8.270" class="difflineminus">-        if (isContainer(gHistoryTree, currentIndex))</span>
<a href="#l8.271"></a><span id="l8.271" class="difflineminus">-            return false;</span>
<a href="#l8.272"></a><span id="l8.272" class="difflineminus">-        var col = gHistoryTree.columns[&quot;URL&quot;];</span>
<a href="#l8.273"></a><span id="l8.273" class="difflineminus">-        var url = gHistoryTree.view.getCellText(currentIndex, col);</span>
<a href="#l8.274"></a><span id="l8.274" class="difflineminus">-        col = gHistoryTree.columns[&quot;Name&quot;];</span>
<a href="#l8.275"></a><span id="l8.275" class="difflineminus">-        var title = gHistoryTree.view.getCellText(currentIndex, col);</span>
<a href="#l8.276"></a><span id="l8.276" class="difflineminus">-</span>
<a href="#l8.277"></a><span id="l8.277" class="difflineminus">-        var htmlString = &quot;&lt;A HREF='&quot; + url + &quot;'&gt;&quot; + title + &quot;&lt;/A&gt;&quot;;</span>
<a href="#l8.278"></a><span id="l8.278" class="difflineminus">-        aXferData.data = new TransferData();</span>
<a href="#l8.279"></a><span id="l8.279" class="difflineminus">-        aXferData.data.addDataForFlavour(&quot;text/unicode&quot;, url);</span>
<a href="#l8.280"></a><span id="l8.280" class="difflineminus">-        aXferData.data.addDataForFlavour(&quot;text/html&quot;, htmlString);</span>
<a href="#l8.281"></a><span id="l8.281" class="difflineminus">-        aXferData.data.addDataForFlavour(&quot;text/x-moz-url&quot;, url + &quot;\n&quot; + title);</span>
<a href="#l8.282"></a><span id="l8.282" class="difflineminus">-        return true;</span>
<a href="#l8.283"></a><span id="l8.283" class="difflineminus">-    }</span>
<a href="#l8.284"></a><span id="l8.284" class="difflineminus">-};</span>
<a href="#l8.285"></a><span id="l8.285" class="difflineminus">-</span>
<a href="#l8.286"></a><span id="l8.286" class="difflineminus">-function validClickConditions(event)</span>
<a href="#l8.287"></a><span id="l8.287" class="difflineminus">-{</span>
<a href="#l8.288"></a><span id="l8.288" class="difflineminus">-  var currentIndex = gHistoryTree.currentIndex;</span>
<a href="#l8.289"></a><span id="l8.289" class="difflineminus">-  if (currentIndex == -1) return false;</span>
<a href="#l8.290"></a><span id="l8.290" class="difflineminus">-  var container = isContainer(gHistoryTree, currentIndex);</span>
<a href="#l8.291"></a><span id="l8.291" class="difflineminus">-  return (event.button == 0 &amp;&amp;</span>
<a href="#l8.292"></a><span id="l8.292" class="difflineminus">-          event.originalTarget.localName == 'treechildren' &amp;&amp;</span>
<a href="#l8.293"></a><span id="l8.293" class="difflineminus">-          !container &amp;&amp; gHistoryStatus);</span>
<a href="#l8.294"></a><span id="l8.294" class="difflineminus">-}</span>
<a href="#l8.295"></a><span id="l8.295" class="difflineminus">-</span>
<a href="#l8.296"></a><span id="l8.296" class="difflineminus">-function collapseExpand()</span>
<a href="#l8.297"></a><span id="l8.297" class="difflineminus">-{</span>
<a href="#l8.298"></a><span id="l8.298" class="difflineminus">-    var currentIndex = gHistoryTree.currentIndex;</span>
<a href="#l8.299"></a><span id="l8.299" class="difflineminus">-    gHistoryTree.treeBoxObject.view.toggleOpenState(currentIndex);</span>
<a href="#l8.300"></a><span id="l8.300" class="difflineplus">+  gHistoryGrouping = groupingType;</span>
<a href="#l8.301"></a><span id="l8.301" class="difflineplus">+  gSearchBox.value = &quot;&quot;;</span>
<a href="#l8.302"></a><span id="l8.302" class="difflineplus">+  searchHistory(&quot;&quot;);</span>
<a href="#l8.303"></a><span id="l8.303"> }</span>
<a href="#l8.304"></a><span id="l8.304"> </span>
<a href="#l8.305"></a><span id="l8.305" class="difflineminus">-function OpenURL(aTarget, aEvent)</span>
<a href="#l8.306"></a><span id="l8.306" class="difflineminus">-{</span>
<a href="#l8.307"></a><span id="l8.307" class="difflineminus">-    var currentIndex = gHistoryTree.currentIndex;     </span>
<a href="#l8.308"></a><span id="l8.308" class="difflineminus">-    var builder = gHistoryTree.builder.QueryInterface(Components.interfaces.nsIXULTreeBuilder);</span>
<a href="#l8.309"></a><span id="l8.309" class="difflineminus">-    var url = builder.getResourceAtIndex(currentIndex).ValueUTF8;</span>
<a href="#l8.310"></a><span id="l8.310" class="difflineminus">-    if (!gIOService)</span>
<a href="#l8.311"></a><span id="l8.311" class="difflineminus">-      gIOService = Components.classes['@mozilla.org/network/io-service;1']</span>
<a href="#l8.312"></a><span id="l8.312" class="difflineminus">-                             .getService(Components.interfaces.nsIIOService);</span>
<a href="#l8.313"></a><span id="l8.313" class="difflineminus">-    try {</span>
<a href="#l8.314"></a><span id="l8.314" class="difflineminus">-      var scheme = gIOService.extractScheme(url);</span>
<a href="#l8.315"></a><span id="l8.315" class="difflineminus">-      if (scheme == &quot;javascript&quot; || scheme == &quot;data&quot;) {</span>
<a href="#l8.316"></a><span id="l8.316" class="difflineminus">-        var strBundleService = Components.classes[&quot;@mozilla.org/intl/stringbundle;1&quot;]</span>
<a href="#l8.317"></a><span id="l8.317" class="difflineminus">-                                         .getService(Components.interfaces.nsIStringBundleService);</span>
<a href="#l8.318"></a><span id="l8.318" class="difflineminus">-        var promptService = Components.classes[&quot;@mozilla.org/embedcomp/prompt-service;1&quot;]</span>
<a href="#l8.319"></a><span id="l8.319" class="difflineminus">-                                      .getService(Components.interfaces.nsIPromptService);</span>
<a href="#l8.320"></a><span id="l8.320" class="difflineminus">-        var historyBundle = strBundleService.createBundle(&quot;chrome://communicator/locale/history/history.properties&quot;);</span>
<a href="#l8.321"></a><span id="l8.321" class="difflineminus">-        var brandBundle = strBundleService.createBundle(&quot;chrome://branding/locale/brand.properties&quot;);      </span>
<a href="#l8.322"></a><span id="l8.322" class="difflineminus">-        var brandStr = brandBundle.GetStringFromName(&quot;brandShortName&quot;);</span>
<a href="#l8.323"></a><span id="l8.323" class="difflineminus">-        var errorStr = historyBundle.GetStringFromName(&quot;load-js-data-url-error&quot;);</span>
<a href="#l8.324"></a><span id="l8.324" class="difflineminus">-        promptService.alert(window, brandStr, errorStr);</span>
<a href="#l8.325"></a><span id="l8.325" class="difflineminus">-        return false;</span>
<a href="#l8.326"></a><span id="l8.326" class="difflineminus">-      }</span>
<a href="#l8.327"></a><span id="l8.327" class="difflineminus">-    } catch (e) {</span>
<a href="#l8.328"></a><span id="l8.328" class="difflineminus">-      return false;</span>
<a href="#l8.329"></a><span id="l8.329" class="difflineminus">-    }</span>
<a href="#l8.330"></a><span id="l8.330" class="difflineminus">-</span>
<a href="#l8.331"></a><span id="l8.331" class="difflineminus">-    if (aTarget != &quot;current&quot;) {</span>
<a href="#l8.332"></a><span id="l8.332" class="difflineminus">-      var count = gHistoryTree.view.selection.count;</span>
<a href="#l8.333"></a><span id="l8.333" class="difflineminus">-      var URLArray = [];</span>
<a href="#l8.334"></a><span id="l8.334" class="difflineminus">-      if (count == 1) {</span>
<a href="#l8.335"></a><span id="l8.335" class="difflineminus">-        if (isContainer(gHistoryTree, currentIndex))</span>
<a href="#l8.336"></a><span id="l8.336" class="difflineminus">-          openDialog(&quot;chrome://communicator/content/history/history.xul&quot;, </span>
<a href="#l8.337"></a><span id="l8.337" class="difflineminus">-                     &quot;&quot;, &quot;chrome,all,dialog=no&quot;, url, &quot;newWindow&quot;);</span>
<a href="#l8.338"></a><span id="l8.338" class="difflineminus">-        else</span>
<a href="#l8.339"></a><span id="l8.339" class="difflineminus">-          URLArray.push(url);</span>
<a href="#l8.340"></a><span id="l8.340" class="difflineminus">-      }</span>
<a href="#l8.341"></a><span id="l8.341" class="difflineminus">-      else {</span>
<a href="#l8.342"></a><span id="l8.342" class="difflineminus">-        var col = gHistoryTree.columns[&quot;URL&quot;];</span>
<a href="#l8.343"></a><span id="l8.343" class="difflineminus">-        var min = new Object(); </span>
<a href="#l8.344"></a><span id="l8.344" class="difflineminus">-        var max = new Object();</span>
<a href="#l8.345"></a><span id="l8.345" class="difflineminus">-        var rangeCount = gHistoryTree.view.selection.getRangeCount();</span>
<a href="#l8.346"></a><span id="l8.346" class="difflineminus">-        for (var i = 0; i &lt; rangeCount; ++i) {</span>
<a href="#l8.347"></a><span id="l8.347" class="difflineminus">-          gHistoryTree.view.selection.getRangeAt(i, min, max);</span>
<a href="#l8.348"></a><span id="l8.348" class="difflineminus">-          for (var k = max.value; k &gt;= min.value; --k) {</span>
<a href="#l8.349"></a><span id="l8.349" class="difflineminus">-            url = gHistoryTree.view.getCellText(k, col);</span>
<a href="#l8.350"></a><span id="l8.350" class="difflineminus">-            URLArray.push(url);</span>
<a href="#l8.351"></a><span id="l8.351" class="difflineminus">-          }</span>
<a href="#l8.352"></a><span id="l8.352" class="difflineminus">-        }</span>
<a href="#l8.353"></a><span id="l8.353" class="difflineminus">-      }</span>
<a href="#l8.354"></a><span id="l8.354" class="difflineminus">-      if (aTarget == &quot;window&quot;) {</span>
<a href="#l8.355"></a><span id="l8.355" class="difflineminus">-        for (i = 0; i &lt; URLArray.length; i++) {</span>
<a href="#l8.356"></a><span id="l8.356" class="difflineminus">-          openDialog(getBrowserURL(), &quot;_blank&quot;, &quot;chrome,all,dialog=no&quot;, URLArray[i]);</span>
<a href="#l8.357"></a><span id="l8.357" class="difflineminus">-        }</span>
<a href="#l8.358"></a><span id="l8.358" class="difflineminus">-      } else {</span>
<a href="#l8.359"></a><span id="l8.359" class="difflineminus">-        if (URLArray.length &gt; 0)</span>
<a href="#l8.360"></a><span id="l8.360" class="difflineminus">-          OpenURLArrayInTabs(URLArray, BookmarksUtils.shouldLoadTabInBackground(aEvent));</span>
<a href="#l8.361"></a><span id="l8.361" class="difflineminus">-      }</span>
<a href="#l8.362"></a><span id="l8.362" class="difflineminus">-    }</span>
<a href="#l8.363"></a><span id="l8.363" class="difflineminus">-    else if (!isContainer(gHistoryTree, currentIndex))</span>
<a href="#l8.364"></a><span id="l8.364" class="difflineminus">-      openTopWin(url);</span>
<a href="#l8.365"></a><span id="l8.365" class="difflineminus">-    return true;</span>
<a href="#l8.366"></a><span id="l8.366" class="difflineminus">-}</span>
<a href="#l8.367"></a><span id="l8.367" class="difflineminus">-</span>
<a href="#l8.368"></a><span id="l8.368" class="difflineminus">-// This opens the URLs contained in the given array in new tabs</span>
<a href="#l8.369"></a><span id="l8.369" class="difflineminus">-// of the most recent window, creates a new window if necessary.</span>
<a href="#l8.370"></a><span id="l8.370" class="difflineminus">-function OpenURLArrayInTabs(aURLArray, aBackground)</span>
<a href="#l8.371"></a><span id="l8.371" class="difflineminus">-{</span>
<a href="#l8.372"></a><span id="l8.372" class="difflineminus">-  var browserWin = getTopWin();</span>
<a href="#l8.373"></a><span id="l8.373" class="difflineminus">-  if (browserWin) {</span>
<a href="#l8.374"></a><span id="l8.374" class="difflineminus">-    var browser = browserWin.getBrowser();</span>
<a href="#l8.375"></a><span id="l8.375" class="difflineminus">-    var tab = browser.addTab(aURLArray[0]);</span>
<a href="#l8.376"></a><span id="l8.376" class="difflineminus">-    if (!aBackground)</span>
<a href="#l8.377"></a><span id="l8.377" class="difflineminus">-      browser.selectedTab = tab;</span>
<a href="#l8.378"></a><span id="l8.378" class="difflineminus">-    for (var i = 1; i &lt; aURLArray.length; ++i)</span>
<a href="#l8.379"></a><span id="l8.379" class="difflineminus">-      browser.addTab(aURLArray[i]);</span>
<a href="#l8.380"></a><span id="l8.380" class="difflineminus">-  } else {</span>
<a href="#l8.381"></a><span id="l8.381" class="difflineminus">-    openTopWin(aURLArray.join(&quot;\n&quot;)); // Pretend that we're a home page group</span>
<a href="#l8.382"></a><span id="l8.382" class="difflineminus">-  }</span>
<a href="#l8.383"></a><span id="l8.383" class="difflineminus">-}</span>
<a href="#l8.384"></a><span id="l8.384" class="difflineminus">-</span>
<a href="#l8.385"></a><span id="l8.385" class="difflineminus">-/**</span>
<a href="#l8.386"></a><span id="l8.386" class="difflineminus">- * Root the tree on a given URI (used for displaying search results)</span>
<a href="#l8.387"></a><span id="l8.387" class="difflineminus">- */</span>
<a href="#l8.388"></a><span id="l8.388" class="difflineminus">-function setRoot(root)</span>
<a href="#l8.389"></a><span id="l8.389" class="difflineminus">-{</span>
<a href="#l8.390"></a><span id="l8.390" class="difflineminus">-  gHistoryTree.ref = root;</span>
<a href="#l8.391"></a><span id="l8.391" class="difflineminus">-}</span>
<a href="#l8.392"></a><span id="l8.392" class="difflineminus">-</span>
<a href="#l8.393"></a><span id="l8.393" class="difflineminus">-function GroupBy(aGroupingType)</span>
<a href="#l8.394"></a><span id="l8.394" class="difflineminus">-{</span>
<a href="#l8.395"></a><span id="l8.395" class="difflineminus">-  gHistoryGrouping = aGroupingType;</span>
<a href="#l8.396"></a><span id="l8.396" class="difflineminus">-  UpdateTreeGrouping();</span>
<a href="#l8.397"></a><span id="l8.397" class="difflineminus">-  gPrefService.setCharPref(&quot;browser.history.grouping&quot;, aGroupingType);</span>
<a href="#l8.398"></a><span id="l8.398" class="difflineminus">-}</span>
<a href="#l8.399"></a><span id="l8.399" class="difflineminus">-</span>
<a href="#l8.400"></a><span id="l8.400" class="difflineminus">-function UpdateTreeGrouping()</span>
<a href="#l8.401"></a><span id="l8.401" class="difflineminus">-{</span>
<a href="#l8.402"></a><span id="l8.402" class="difflineminus">-  var tree = document.getElementById(&quot;historyTree&quot;);</span>
<a href="#l8.403"></a><span id="l8.403" class="difflineminus">-  switch(gHistoryGrouping) {</span>
<a href="#l8.404"></a><span id="l8.404" class="difflineminus">-  case &quot;none&quot;:</span>
<a href="#l8.405"></a><span id="l8.405" class="difflineminus">-    tree.setAttribute(&quot;ref&quot;, &quot;NC:HistoryRoot&quot;);</span>
<a href="#l8.406"></a><span id="l8.406" class="difflineminus">-    break;</span>
<a href="#l8.407"></a><span id="l8.407" class="difflineminus">-  case &quot;site&quot;:</span>
<a href="#l8.408"></a><span id="l8.408" class="difflineminus">-    tree.setAttribute(&quot;ref&quot;, &quot;find:datasource=history&amp;groupby=Hostname&quot;);</span>
<a href="#l8.409"></a><span id="l8.409" class="difflineminus">-    break;</span>
<a href="#l8.410"></a><span id="l8.410" class="difflineminus">-  case &quot;day&quot;:</span>
<a href="#l8.411"></a><span id="l8.411" class="difflineminus">-  default:</span>
<a href="#l8.412"></a><span id="l8.412" class="difflineminus">-    tree.setAttribute(&quot;ref&quot;, &quot;NC:HistoryByDate&quot;);</span>
<a href="#l8.413"></a><span id="l8.413" class="difflineminus">-    break;</span>
<a href="#l8.414"></a><span id="l8.414" class="difflineminus">-  }</span>
<a href="#l8.415"></a><span id="l8.415" class="difflineminus">-}</span>
<a href="#l8.416"></a><span id="l8.416" class="difflineminus">-</span>
<a href="#l8.417"></a><span id="l8.417" class="difflineminus">-var groupObserver = {</span>
<a href="#l8.418"></a><span id="l8.418" class="difflineminus">-  observe: function(aPrefBranch, aTopic, aPrefName) {</span>
<a href="#l8.419"></a><span id="l8.419" class="difflineminus">-    try {</span>
<a href="#l8.420"></a><span id="l8.420" class="difflineminus">-      gHistoryGrouping = gPrefService.getCharPref(&quot;browser.history.grouping&quot;);</span>
<a href="#l8.421"></a><span id="l8.421" class="difflineminus">-    }</span>
<a href="#l8.422"></a><span id="l8.422" class="difflineminus">-    catch(e) {</span>
<a href="#l8.423"></a><span id="l8.423" class="difflineminus">-      gHistoryGrouping = &quot;day&quot;;</span>
<a href="#l8.424"></a><span id="l8.424" class="difflineminus">-    }</span>
<a href="#l8.425"></a><span id="l8.425" class="difflineminus">-    UpdateTreeGrouping();</span>
<a href="#l8.426"></a><span id="l8.426" class="difflineminus">-  }</span>
<a href="#l8.427"></a><span id="l8.427" class="difflineminus">-}</span>
<a href="#l8.428"></a><span id="l8.428" class="difflineminus">-</span>
<a href="#l8.429"></a><span id="l8.429" class="difflineplus">+// we need bookmarks.js to set bookmarks!</span>
<a href="#l8.430"></a><span id="l8.430"> function historyAddBookmarks()</span>
<a href="#l8.431"></a><span id="l8.431"> {</span>
<a href="#l8.432"></a><span id="l8.432" class="difflineminus">-  var urlCol = gHistoryTree.columns[&quot;URL&quot;];</span>
<a href="#l8.433"></a><span id="l8.433" class="difflineminus">-  var titleCol = gHistoryTree.columns[&quot;Name&quot;];</span>
<a href="#l8.434"></a><span id="l8.434" class="difflineminus">-</span>
<a href="#l8.435"></a><span id="l8.435" class="difflineplus">+  // if we're not sidebar, the tree ID is &quot;placeContent&quot;</span>
<a href="#l8.436"></a><span id="l8.436" class="difflineplus">+  if (!gHistoryTree)</span>
<a href="#l8.437"></a><span id="l8.437" class="difflineplus">+    gHistoryTree = document.getElementById(&quot;placeContent&quot;);</span>
<a href="#l8.438"></a><span id="l8.438">   var count = gHistoryTree.view.selection.count;</span>
<a href="#l8.439"></a><span id="l8.439" class="difflineminus">-  var url;</span>
<a href="#l8.440"></a><span id="l8.440" class="difflineminus">-  var title;</span>
<a href="#l8.441"></a><span id="l8.441" class="difflineminus">-  if (count == 1) {</span>
<a href="#l8.442"></a><span id="l8.442" class="difflineminus">-    var currentIndex = gHistoryTree.currentIndex;</span>
<a href="#l8.443"></a><span id="l8.443" class="difflineminus">-    url = gHistoryTree.treeBoxObject.view.getCellText(currentIndex, urlCol);</span>
<a href="#l8.444"></a><span id="l8.444" class="difflineminus">-    title = gHistoryTree.treeBoxObject.view.getCellText(currentIndex, titleCol);</span>
<a href="#l8.445"></a><span id="l8.445" class="difflineminus">-    BookmarksUtils.addBookmark(url, title, null, true);</span>
<a href="#l8.446"></a><span id="l8.446" class="difflineminus">-  }</span>
<a href="#l8.447"></a><span id="l8.447" class="difflineplus">+  if (count == 1)</span>
<a href="#l8.448"></a><span id="l8.448" class="difflineplus">+    BookmarksUtils.addBookmark(gHistoryTree.selectedNode.uri,</span>
<a href="#l8.449"></a><span id="l8.449" class="difflineplus">+                               gHistoryTree.selectedNode.title, null, true);</span>
<a href="#l8.450"></a><span id="l8.450">   else if (count &gt; 1) {</span>
<a href="#l8.451"></a><span id="l8.451" class="difflineminus">-    var min = new Object(); </span>
<a href="#l8.452"></a><span id="l8.452" class="difflineminus">-    var max = new Object();</span>
<a href="#l8.453"></a><span id="l8.453" class="difflineminus">-    var rangeCount = gHistoryTree.view.selection.getRangeCount();</span>
<a href="#l8.454"></a><span id="l8.454">     if (!BMSVC) {</span>
<a href="#l8.455"></a><span id="l8.455">       initServices();</span>
<a href="#l8.456"></a><span id="l8.456">       initBMService();</span>
<a href="#l8.457"></a><span id="l8.457">     }</span>
<a href="#l8.458"></a><span id="l8.458" class="difflineminus">-    for (var i = 0; i &lt; rangeCount; ++i) {</span>
<a href="#l8.459"></a><span id="l8.459" class="difflineminus">-      gHistoryTree.view.selection.getRangeAt(i, min, max);</span>
<a href="#l8.460"></a><span id="l8.460" class="difflineminus">-      for (var k = max.value; k &gt;= min.value; --k) {</span>
<a href="#l8.461"></a><span id="l8.461" class="difflineminus">-        url = gHistoryTree.view.getCellText(k, urlCol);</span>
<a href="#l8.462"></a><span id="l8.462" class="difflineminus">-        title = gHistoryTree.view.getCellText(k, titleCol);</span>
<a href="#l8.463"></a><span id="l8.463" class="difflineminus">-        BookmarksUtils.addBookmark(url, title, null, false);</span>
<a href="#l8.464"></a><span id="l8.464" class="difflineminus">-      }</span>
<a href="#l8.465"></a><span id="l8.465" class="difflineplus">+    selNodes = gHistoryTree.getSelectionNodes();</span>
<a href="#l8.466"></a><span id="l8.466" class="difflineplus">+    for (var i = 0; i &lt; selNodes.length; i++) {</span>
<a href="#l8.467"></a><span id="l8.467" class="difflineplus">+      // skip over separators and folders</span>
<a href="#l8.468"></a><span id="l8.468" class="difflineplus">+      if (PlacesUtils.nodeIsURI(selNodes[i]))</span>
<a href="#l8.469"></a><span id="l8.469" class="difflineplus">+        BookmarksUtils.addBookmark(selNodes.uri, selNodes.title, null, false);</span>
<a href="#l8.470"></a><span id="l8.470">     }</span>
<a href="#l8.471"></a><span id="l8.471">   }</span>
<a href="#l8.472"></a><span id="l8.472"> }</span>
<a href="#l8.473"></a><span id="l8.473"> </span>
<a href="#l8.474"></a><span id="l8.474" class="difflineminus">-</span>
<a href="#l8.475"></a><span id="l8.475" class="difflineminus">-function updateItems()</span>
<a href="#l8.476"></a><span id="l8.476" class="difflineplus">+function searchHistory(aInput)</span>
<a href="#l8.477"></a><span id="l8.477"> {</span>
<a href="#l8.478"></a><span id="l8.478" class="difflineminus">-  var count = gHistoryTree.view.selection.count;</span>
<a href="#l8.479"></a><span id="l8.479" class="difflineminus">-  var openItem = document.getElementById(&quot;miOpen&quot;);</span>
<a href="#l8.480"></a><span id="l8.480" class="difflineminus">-  var bookmarkItem = document.getElementById(&quot;miAddBookmark&quot;);</span>
<a href="#l8.481"></a><span id="l8.481" class="difflineminus">-  var copyLocationItem = document.getElementById(&quot;miCopyLinkLocation&quot;);</span>
<a href="#l8.482"></a><span id="l8.482" class="difflineminus">-  var sep1 = document.getElementById(&quot;pre-bookmarks-separator&quot;);</span>
<a href="#l8.483"></a><span id="l8.483" class="difflineminus">-  var sep2 = document.getElementById(&quot;post-bookmarks-separator&quot;);</span>
<a href="#l8.484"></a><span id="l8.484" class="difflineminus">-  var openItemInNewWindow = document.getElementById(&quot;miOpenInNewWindow&quot;);</span>
<a href="#l8.485"></a><span id="l8.485" class="difflineminus">-  var openItemInNewTab = document.getElementById(&quot;miOpenInNewTab&quot;);</span>
<a href="#l8.486"></a><span id="l8.486" class="difflineminus">-  var collapseExpandItem = document.getElementById(&quot;miCollapseExpand&quot;);</span>
<a href="#l8.487"></a><span id="l8.487" class="difflineminus">-  if (count &gt; 1) {</span>
<a href="#l8.488"></a><span id="l8.488" class="difflineminus">-    var hasContainer = false;</span>
<a href="#l8.489"></a><span id="l8.489" class="difflineminus">-    if (gHistoryGrouping != &quot;none&quot;) {</span>
<a href="#l8.490"></a><span id="l8.490" class="difflineminus">-      var min = new Object(); </span>
<a href="#l8.491"></a><span id="l8.491" class="difflineminus">-      var max = new Object();</span>
<a href="#l8.492"></a><span id="l8.492" class="difflineminus">-      var rangeCount = gHistoryTree.view.selection.getRangeCount();</span>
<a href="#l8.493"></a><span id="l8.493" class="difflineminus">-      for (var i = 0; i &lt; rangeCount; ++i) {</span>
<a href="#l8.494"></a><span id="l8.494" class="difflineminus">-        gHistoryTree.view.selection.getRangeAt(i, min, max);</span>
<a href="#l8.495"></a><span id="l8.495" class="difflineminus">-        for (var k = max.value; k &gt;= min.value; --k) {</span>
<a href="#l8.496"></a><span id="l8.496" class="difflineminus">-          if (isContainer(gHistoryTree, k)) {</span>
<a href="#l8.497"></a><span id="l8.497" class="difflineminus">-            hasContainer = true;</span>
<a href="#l8.498"></a><span id="l8.498" class="difflineminus">-            break;</span>
<a href="#l8.499"></a><span id="l8.499" class="difflineminus">-          }</span>
<a href="#l8.500"></a><span id="l8.500" class="difflineminus">-        }</span>
<a href="#l8.501"></a><span id="l8.501" class="difflineminus">-      }</span>
<a href="#l8.502"></a><span id="l8.502" class="difflineminus">-    }</span>
<a href="#l8.503"></a><span id="l8.503" class="difflineminus">-    collapseExpandItem.hidden = true;</span>
<a href="#l8.504"></a><span id="l8.504" class="difflineminus">-    openItem.hidden = true;</span>
<a href="#l8.505"></a><span id="l8.505" class="difflineminus">-    if (hasContainer) {   // several items selected, folder(s) amongst them</span>
<a href="#l8.506"></a><span id="l8.506" class="difflineminus">-      bookmarkItem.hidden = true;</span>
<a href="#l8.507"></a><span id="l8.507" class="difflineminus">-      copyLocationItem.hidden = true;</span>
<a href="#l8.508"></a><span id="l8.508" class="difflineminus">-      sep1.hidden = true;</span>
<a href="#l8.509"></a><span id="l8.509" class="difflineminus">-      sep2.hidden = true;</span>
<a href="#l8.510"></a><span id="l8.510" class="difflineminus">-      openItemInNewWindow.hidden = true;</span>
<a href="#l8.511"></a><span id="l8.511" class="difflineminus">-      openItemInNewTab.hidden = true;</span>
<a href="#l8.512"></a><span id="l8.512" class="difflineminus">-    }</span>
<a href="#l8.513"></a><span id="l8.513" class="difflineminus">-    else {                // several items selected, but no folder</span>
<a href="#l8.514"></a><span id="l8.514" class="difflineminus">-      bookmarkItem.hidden = false;</span>
<a href="#l8.515"></a><span id="l8.515" class="difflineminus">-      copyLocationItem.hidden = false;</span>
<a href="#l8.516"></a><span id="l8.516" class="difflineminus">-      sep1.hidden = false;</span>
<a href="#l8.517"></a><span id="l8.517" class="difflineminus">-      sep2.hidden = false;</span>
<a href="#l8.518"></a><span id="l8.518" class="difflineminus">-      bookmarkItem.setAttribute(&quot;label&quot;, document.getElementById('multipleBookmarks').getAttribute(&quot;label&quot;));</span>
<a href="#l8.519"></a><span id="l8.519" class="difflineminus">-      bookmarkItem.setAttribute(&quot;accesskey&quot;, document.getElementById('multipleBookmarks').getAttribute(&quot;accesskey&quot;));</span>
<a href="#l8.520"></a><span id="l8.520" class="difflineminus">-      openItem.removeAttribute(&quot;default&quot;);</span>
<a href="#l8.521"></a><span id="l8.521" class="difflineminus">-      openItemInNewWindow.setAttribute(&quot;default&quot;, &quot;true&quot;);</span>
<a href="#l8.522"></a><span id="l8.522" class="difflineminus">-      openItemInNewWindow.hidden = false;</span>
<a href="#l8.523"></a><span id="l8.523" class="difflineminus">-      openItemInNewTab.hidden = false;</span>
<a href="#l8.524"></a><span id="l8.524" class="difflineplus">+  var query = PlacesUtils.history.getNewQuery();</span>
<a href="#l8.525"></a><span id="l8.525" class="difflineplus">+  var options = PlacesUtils.history.getNewQueryOptions();</span>
<a href="#l8.526"></a><span id="l8.526" class="difflineplus">+</span>
<a href="#l8.527"></a><span id="l8.527" class="difflineplus">+  const NHQO = Components.interfaces.nsINavHistoryQueryOptions;</span>
<a href="#l8.528"></a><span id="l8.528" class="difflineplus">+  var sortingMode;</span>
<a href="#l8.529"></a><span id="l8.529" class="difflineplus">+  var resultType;</span>
<a href="#l8.530"></a><span id="l8.530" class="difflineplus">+</span>
<a href="#l8.531"></a><span id="l8.531" class="difflineplus">+  if (aInput) {</span>
<a href="#l8.532"></a><span id="l8.532" class="difflineplus">+    query.searchTerms = aInput;</span>
<a href="#l8.533"></a><span id="l8.533" class="difflineplus">+    sortingMode = NHQO.SORT_BY_TITLE_ASCENDING;</span>
<a href="#l8.534"></a><span id="l8.534" class="difflineplus">+    resultType = NHQO.RESULTS_AS_URI;</span>
<a href="#l8.535"></a><span id="l8.535" class="difflineplus">+  }</span>
<a href="#l8.536"></a><span id="l8.536" class="difflineplus">+  else {</span>
<a href="#l8.537"></a><span id="l8.537" class="difflineplus">+    switch (gHistoryGrouping) {</span>
<a href="#l8.538"></a><span id="l8.538" class="difflineplus">+      case &quot;visited&quot;:</span>
<a href="#l8.539"></a><span id="l8.539" class="difflineplus">+        resultType = NHQO.RESULTS_AS_URI;</span>
<a href="#l8.540"></a><span id="l8.540" class="difflineplus">+        sortingMode = NHQO.SORT_BY_VISITCOUNT_DESCENDING;</span>
<a href="#l8.541"></a><span id="l8.541" class="difflineplus">+        break;</span>
<a href="#l8.542"></a><span id="l8.542" class="difflineplus">+      case &quot;lastvisited&quot;:</span>
<a href="#l8.543"></a><span id="l8.543" class="difflineplus">+        resultType = NHQO.RESULTS_AS_URI;</span>
<a href="#l8.544"></a><span id="l8.544" class="difflineplus">+        sortingMode = NHQO.SORT_BY_DATE_DESCENDING;</span>
<a href="#l8.545"></a><span id="l8.545" class="difflineplus">+        break;</span>
<a href="#l8.546"></a><span id="l8.546" class="difflineplus">+      case &quot;dayandsite&quot;:</span>
<a href="#l8.547"></a><span id="l8.547" class="difflineplus">+        resultType = NHQO.RESULTS_AS_DATE_SITE_QUERY;</span>
<a href="#l8.548"></a><span id="l8.548" class="difflineplus">+        break;</span>
<a href="#l8.549"></a><span id="l8.549" class="difflineplus">+      case &quot;site&quot;:</span>
<a href="#l8.550"></a><span id="l8.550" class="difflineplus">+        resultType = NHQO.RESULTS_AS_SITE_QUERY;</span>
<a href="#l8.551"></a><span id="l8.551" class="difflineplus">+        sortingMode = NHQO.SORT_BY_TITLE_ASCENDING;</span>
<a href="#l8.552"></a><span id="l8.552" class="difflineplus">+        break;</span>
<a href="#l8.553"></a><span id="l8.553" class="difflineplus">+      case &quot;day&quot;:</span>
<a href="#l8.554"></a><span id="l8.554" class="difflineplus">+      default:</span>
<a href="#l8.555"></a><span id="l8.555" class="difflineplus">+        resultType = NHQO.RESULTS_AS_DATE_QUERY;</span>
<a href="#l8.556"></a><span id="l8.556" class="difflineplus">+        break;</span>
<a href="#l8.557"></a><span id="l8.557">     }</span>
<a href="#l8.558"></a><span id="l8.558">   }</span>
<a href="#l8.559"></a><span id="l8.559" class="difflineminus">-  else {</span>
<a href="#l8.560"></a><span id="l8.560" class="difflineminus">-    openItemInNewWindow.hidden = false;</span>
<a href="#l8.561"></a><span id="l8.561" class="difflineminus">-    bookmarkItem.setAttribute(&quot;label&quot;, document.getElementById('oneBookmark').getAttribute(&quot;label&quot;));</span>
<a href="#l8.562"></a><span id="l8.562" class="difflineminus">-    bookmarkItem.setAttribute(&quot;accesskey&quot;, document.getElementById('oneBookmark').getAttribute(&quot;accesskey&quot;));</span>
<a href="#l8.563"></a><span id="l8.563" class="difflineminus">-    sep2.hidden = false;</span>
<a href="#l8.564"></a><span id="l8.564" class="difflineminus">-    var currentIndex = gHistoryTree.currentIndex;</span>
<a href="#l8.565"></a><span id="l8.565" class="difflineminus">-    if (isContainer(gHistoryTree, currentIndex)) {   // one folder selected</span>
<a href="#l8.566"></a><span id="l8.566" class="difflineminus">-        openItem.hidden = true;</span>
<a href="#l8.567"></a><span id="l8.567" class="difflineminus">-        openItem.removeAttribute(&quot;default&quot;);</span>
<a href="#l8.568"></a><span id="l8.568" class="difflineminus">-        openItemInNewWindow.removeAttribute(&quot;default&quot;);</span>
<a href="#l8.569"></a><span id="l8.569" class="difflineminus">-        openItemInNewTab.hidden = true;</span>
<a href="#l8.570"></a><span id="l8.570" class="difflineminus">-        collapseExpandItem.hidden = false;</span>
<a href="#l8.571"></a><span id="l8.571" class="difflineminus">-        collapseExpandItem.setAttribute(&quot;default&quot;, &quot;true&quot;);</span>
<a href="#l8.572"></a><span id="l8.572" class="difflineminus">-        bookmarkItem.hidden = true;</span>
<a href="#l8.573"></a><span id="l8.573" class="difflineminus">-        copyLocationItem.hidden = true;</span>
<a href="#l8.574"></a><span id="l8.574" class="difflineminus">-        sep1.hidden = true;</span>
<a href="#l8.575"></a><span id="l8.575" class="difflineminus">-        if (isContainerOpen(gHistoryTree, currentIndex)) {</span>
<a href="#l8.576"></a><span id="l8.576" class="difflineminus">-          collapseExpandItem.setAttribute(&quot;label&quot;, gHistoryBundle.getString(&quot;collapseLabel&quot;));</span>
<a href="#l8.577"></a><span id="l8.577" class="difflineminus">-          collapseExpandItem.setAttribute(&quot;accesskey&quot;, gHistoryBundle.getString(&quot;collapseAccesskey&quot;));</span>
<a href="#l8.578"></a><span id="l8.578" class="difflineminus">-        }</span>
<a href="#l8.579"></a><span id="l8.579" class="difflineminus">-        else {</span>
<a href="#l8.580"></a><span id="l8.580" class="difflineminus">-          collapseExpandItem.setAttribute(&quot;label&quot;, gHistoryBundle.getString(&quot;expandLabel&quot;));</span>
<a href="#l8.581"></a><span id="l8.581" class="difflineminus">-          collapseExpandItem.setAttribute(&quot;accesskey&quot;, gHistoryBundle.getString(&quot;expandAccesskey&quot;));          </span>
<a href="#l8.582"></a><span id="l8.582" class="difflineminus">-        }</span>
<a href="#l8.583"></a><span id="l8.583" class="difflineminus">-        return true;</span>
<a href="#l8.584"></a><span id="l8.584" class="difflineminus">-    }                                                // one entry selected (not a folder)</span>
<a href="#l8.585"></a><span id="l8.585" class="difflineminus">-    openItemInNewTab.hidden = false;</span>
<a href="#l8.586"></a><span id="l8.586" class="difflineminus">-    collapseExpandItem.hidden = true;</span>
<a href="#l8.587"></a><span id="l8.587" class="difflineminus">-    bookmarkItem.hidden = false;</span>
<a href="#l8.588"></a><span id="l8.588" class="difflineminus">-    copyLocationItem.hidden = false;</span>
<a href="#l8.589"></a><span id="l8.589" class="difflineminus">-    sep1.hidden = false;</span>
<a href="#l8.590"></a><span id="l8.590" class="difflineminus">-    if (!getTopWin()) {</span>
<a href="#l8.591"></a><span id="l8.591" class="difflineminus">-        openItem.hidden = true;</span>
<a href="#l8.592"></a><span id="l8.592" class="difflineminus">-        openItem.removeAttribute(&quot;default&quot;);</span>
<a href="#l8.593"></a><span id="l8.593" class="difflineminus">-        openItemInNewWindow.setAttribute(&quot;default&quot;, &quot;true&quot;);</span>
<a href="#l8.594"></a><span id="l8.594" class="difflineminus">-    }</span>
<a href="#l8.595"></a><span id="l8.595" class="difflineminus">-    else {</span>
<a href="#l8.596"></a><span id="l8.596" class="difflineminus">-      openItem.hidden = false;</span>
<a href="#l8.597"></a><span id="l8.597" class="difflineminus">-      if (!openItem.getAttribute(&quot;default&quot;))</span>
<a href="#l8.598"></a><span id="l8.598" class="difflineminus">-        openItem.setAttribute(&quot;default&quot;, &quot;true&quot;);</span>
<a href="#l8.599"></a><span id="l8.599" class="difflineminus">-      openItemInNewWindow.removeAttribute(&quot;default&quot;);</span>
<a href="#l8.600"></a><span id="l8.600" class="difflineminus">-    }</span>
<a href="#l8.601"></a><span id="l8.601" class="difflineminus">-  }</span>
<a href="#l8.602"></a><span id="l8.602" class="difflineminus">-  return true;</span>
<a href="#l8.603"></a><span id="l8.603" class="difflineplus">+</span>
<a href="#l8.604"></a><span id="l8.604" class="difflineplus">+  options.sortingMode = sortingMode;</span>
<a href="#l8.605"></a><span id="l8.605" class="difflineplus">+  options.resultType = resultType;</span>
<a href="#l8.606"></a><span id="l8.606" class="difflineplus">+</span>
<a href="#l8.607"></a><span id="l8.607" class="difflineplus">+  // call load() on the tree manually</span>
<a href="#l8.608"></a><span id="l8.608" class="difflineplus">+  // instead of setting the place attribute in history-panel.xul</span>
<a href="#l8.609"></a><span id="l8.609" class="difflineplus">+  // otherwise, we will end up calling load() twice</span>
<a href="#l8.610"></a><span id="l8.610" class="difflineplus">+  gHistoryTree.load([query], options);</span>
<a href="#l8.611"></a><span id="l8.611"> }</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l9.1"></a><span id="l9.1" class="difflineminus">--- a/suite/common/history/history.xul</span>
<a href="#l9.2"></a><span id="l9.2" class="difflineplus">+++ b/suite/common/history/history.xul</span>
<a href="#l9.3"></a><span id="l9.3" class="difflineat">@@ -1,160 +1,214 @@</span>
<a href="#l9.4"></a><span id="l9.4" class="difflineminus">-&lt;?xml version=&quot;1.0&quot;?&gt; &lt;!-- -*- Mode: xml; indent-tabs-mode: nil; -*- --&gt;</span>
<a href="#l9.5"></a><span id="l9.5" class="difflineminus">-&lt;!--</span>
<a href="#l9.6"></a><span id="l9.6" class="difflineminus">-</span>
<a href="#l9.7"></a><span id="l9.7" class="difflineminus">- ***** BEGIN LICENSE BLOCK *****</span>
<a href="#l9.8"></a><span id="l9.8" class="difflineminus">- Version: MPL 1.1/GPL 2.0/LGPL 2.1</span>
<a href="#l9.9"></a><span id="l9.9" class="difflineminus">-</span>
<a href="#l9.10"></a><span id="l9.10" class="difflineminus">- The contents of this file are subject to the Mozilla Public License Version</span>
<a href="#l9.11"></a><span id="l9.11" class="difflineminus">- 1.1 (the &quot;License&quot;); you may not use this file except in compliance with</span>
<a href="#l9.12"></a><span id="l9.12" class="difflineminus">- the License. You may obtain a copy of the License at</span>
<a href="#l9.13"></a><span id="l9.13" class="difflineminus">- http://www.mozilla.org/MPL/</span>
<a href="#l9.14"></a><span id="l9.14" class="difflineminus">-</span>
<a href="#l9.15"></a><span id="l9.15" class="difflineminus">- Software distributed under the License is distributed on an &quot;AS IS&quot; basis,</span>
<a href="#l9.16"></a><span id="l9.16" class="difflineminus">- WITHOUT WARRANTY OF ANY KIND, either express or implied. See the License</span>
<a href="#l9.17"></a><span id="l9.17" class="difflineminus">- for the specific language governing rights and limitations under the</span>
<a href="#l9.18"></a><span id="l9.18" class="difflineminus">- License.</span>
<a href="#l9.19"></a><span id="l9.19" class="difflineminus">-</span>
<a href="#l9.20"></a><span id="l9.20" class="difflineminus">- The Original Code is mozilla.org code.</span>
<a href="#l9.21"></a><span id="l9.21" class="difflineplus">+&lt;?xml version=&quot;1.0&quot;?&gt;</span>
<a href="#l9.22"></a><span id="l9.22" class="difflineplus">+&lt;!-- ***** BEGIN LICENSE BLOCK *****</span>
<a href="#l9.23"></a><span id="l9.23" class="difflineplus">+   - Version: MPL 1.1/GPL 2.0/LGPL 2.1</span>
<a href="#l9.24"></a><span id="l9.24" class="difflineplus">+   -</span>
<a href="#l9.25"></a><span id="l9.25" class="difflineplus">+   - The contents of this file are subject to the Mozilla Public License Version</span>
<a href="#l9.26"></a><span id="l9.26" class="difflineplus">+   - 1.1 (the &quot;License&quot;); you may not use this file except in compliance with</span>
<a href="#l9.27"></a><span id="l9.27" class="difflineplus">+   - the License. You may obtain a copy of the License at</span>
<a href="#l9.28"></a><span id="l9.28" class="difflineplus">+   - http://www.mozilla.org/MPL/</span>
<a href="#l9.29"></a><span id="l9.29" class="difflineplus">+   -</span>
<a href="#l9.30"></a><span id="l9.30" class="difflineplus">+   - Software distributed under the License is distributed on an &quot;AS IS&quot; basis,</span>
<a href="#l9.31"></a><span id="l9.31" class="difflineplus">+   - WITHOUT WARRANTY OF ANY KIND, either express or implied. See the License</span>
<a href="#l9.32"></a><span id="l9.32" class="difflineplus">+   - for the specific language governing rights and limitations under the</span>
<a href="#l9.33"></a><span id="l9.33" class="difflineplus">+   - License.</span>
<a href="#l9.34"></a><span id="l9.34" class="difflineplus">+   -</span>
<a href="#l9.35"></a><span id="l9.35" class="difflineplus">+   - The Original Code is mozilla.org code.</span>
<a href="#l9.36"></a><span id="l9.36" class="difflineplus">+   -</span>
<a href="#l9.37"></a><span id="l9.37" class="difflineplus">+   - The Initial Developer of the Original Code is</span>
<a href="#l9.38"></a><span id="l9.38" class="difflineplus">+   - Netscape Communications Corporation.</span>
<a href="#l9.39"></a><span id="l9.39" class="difflineplus">+   - Portions created by the Initial Developer are Copyright (C) 1998</span>
<a href="#l9.40"></a><span id="l9.40" class="difflineplus">+   - the Initial Developer. All Rights Reserved.</span>
<a href="#l9.41"></a><span id="l9.41" class="difflineplus">+   -</span>
<a href="#l9.42"></a><span id="l9.42" class="difflineplus">+   - Contributor(s):</span>
<a href="#l9.43"></a><span id="l9.43" class="difflineplus">+   -   Blake Ross &lt;blaker@netscape.com&gt; (original history.xul)</span>
<a href="#l9.44"></a><span id="l9.44" class="difflineplus">+   -   Ben Goodger &lt;beng@google.com&gt; (places organizer)</span>
<a href="#l9.45"></a><span id="l9.45" class="difflineplus">+   -   Annie Sullivan &lt;annie.sullivan@gmail.com&gt; (places organizer)</span>
<a href="#l9.46"></a><span id="l9.46" class="difflineplus">+   -   Asaf Romano &lt;mano@mozilla.com&gt; (places organizer)</span>
<a href="#l9.47"></a><span id="l9.47" class="difflineplus">+   -   Ehsan Akhgari &lt;ehsan.akhgari@gmail.com&gt; (places organizer)</span>
<a href="#l9.48"></a><span id="l9.48" class="difflineplus">+   -   Dietrich Ayala &lt;dietrich@mozilla.com&gt; (places organizer)</span>
<a href="#l9.49"></a><span id="l9.49" class="difflineplus">+   -   Robert Kaiser &lt;kairo@kairo.at&gt; (combining history.xul with places)</span>
<a href="#l9.50"></a><span id="l9.50" class="difflineplus">+   -</span>
<a href="#l9.51"></a><span id="l9.51" class="difflineplus">+   - Alternatively, the contents of this file may be used under the terms of</span>
<a href="#l9.52"></a><span id="l9.52" class="difflineplus">+   - either the GNU General Public License Version 2 or later (the &quot;GPL&quot;), or</span>
<a href="#l9.53"></a><span id="l9.53" class="difflineplus">+   - the GNU Lesser General Public License Version 2.1 or later (the &quot;LGPL&quot;),</span>
<a href="#l9.54"></a><span id="l9.54" class="difflineplus">+   - in which case the provisions of the GPL or the LGPL are applicable instead</span>
<a href="#l9.55"></a><span id="l9.55" class="difflineplus">+   - of those above. If you wish to allow use of your version of this file only</span>
<a href="#l9.56"></a><span id="l9.56" class="difflineplus">+   - under the terms of either the GPL or the LGPL, and not to allow others to</span>
<a href="#l9.57"></a><span id="l9.57" class="difflineplus">+   - use your version of this file under the terms of the MPL, indicate your</span>
<a href="#l9.58"></a><span id="l9.58" class="difflineplus">+   - decision by deleting the provisions above and replace them with the notice</span>
<a href="#l9.59"></a><span id="l9.59" class="difflineplus">+   - and other provisions required by the LGPL or the GPL. If you do not delete</span>
<a href="#l9.60"></a><span id="l9.60" class="difflineplus">+   - the provisions above, a recipient may use your version of this file under</span>
<a href="#l9.61"></a><span id="l9.61" class="difflineplus">+   - the terms of any one of the MPL, the GPL or the LGPL.</span>
<a href="#l9.62"></a><span id="l9.62" class="difflineplus">+   -</span>
<a href="#l9.63"></a><span id="l9.63" class="difflineplus">+   - ***** END LICENSE BLOCK ***** --&gt;</span>
<a href="#l9.64"></a><span id="l9.64"> </span>
<a href="#l9.65"></a><span id="l9.65" class="difflineminus">- The Initial Developer of the Original Code is</span>
<a href="#l9.66"></a><span id="l9.66" class="difflineminus">- Netscape Communications Corporation.</span>
<a href="#l9.67"></a><span id="l9.67" class="difflineminus">- Portions created by the Initial Developer are Copyright (C) 1998</span>
<a href="#l9.68"></a><span id="l9.68" class="difflineminus">- the Initial Developer. All Rights Reserved.</span>
<a href="#l9.69"></a><span id="l9.69" class="difflineminus">-</span>
<a href="#l9.70"></a><span id="l9.70" class="difflineminus">- Contributor(s):</span>
<a href="#l9.71"></a><span id="l9.71" class="difflineminus">-   Blake Ross &lt;blaker@netscape.com&gt;</span>
<a href="#l9.72"></a><span id="l9.72" class="difflineplus">+&lt;?xml-stylesheet href=&quot;chrome://communicator/content/history/places.css&quot;?&gt;</span>
<a href="#l9.73"></a><span id="l9.73" class="difflineplus">+&lt;?xml-stylesheet href=&quot;chrome://communicator/skin/&quot; type=&quot;text/css&quot;?&gt;</span>
<a href="#l9.74"></a><span id="l9.74" class="difflineplus">+&lt;?xml-stylesheet href=&quot;chrome://communicator/skin/history/places.css&quot;?&gt;</span>
<a href="#l9.75"></a><span id="l9.75"> </span>
<a href="#l9.76"></a><span id="l9.76" class="difflineminus">- Alternatively, the contents of this file may be used under the terms of</span>
<a href="#l9.77"></a><span id="l9.77" class="difflineminus">- either of the GNU General Public License Version 2 or later (the &quot;GPL&quot;),</span>
<a href="#l9.78"></a><span id="l9.78" class="difflineminus">- or the GNU Lesser General Public License Version 2.1 or later (the &quot;LGPL&quot;),</span>
<a href="#l9.79"></a><span id="l9.79" class="difflineminus">- in which case the provisions of the GPL or the LGPL are applicable instead</span>
<a href="#l9.80"></a><span id="l9.80" class="difflineminus">- of those above. If you wish to allow use of your version of this file only</span>
<a href="#l9.81"></a><span id="l9.81" class="difflineminus">- under the terms of either the GPL or the LGPL, and not to allow others to</span>
<a href="#l9.82"></a><span id="l9.82" class="difflineminus">- use your version of this file under the terms of the MPL, indicate your</span>
<a href="#l9.83"></a><span id="l9.83" class="difflineminus">- decision by deleting the provisions above and replace them with the notice</span>
<a href="#l9.84"></a><span id="l9.84" class="difflineminus">- and other provisions required by the GPL or the LGPL. If you do not delete</span>
<a href="#l9.85"></a><span id="l9.85" class="difflineminus">- the provisions above, a recipient may use your version of this file under</span>
<a href="#l9.86"></a><span id="l9.86" class="difflineminus">- the terms of any one of the MPL, the GPL or the LGPL.</span>
<a href="#l9.87"></a><span id="l9.87" class="difflineminus">-</span>
<a href="#l9.88"></a><span id="l9.88" class="difflineminus">- ***** END LICENSE BLOCK ***** --&gt;</span>
<a href="#l9.89"></a><span id="l9.89" class="difflineminus">-</span>
<a href="#l9.90"></a><span id="l9.90" class="difflineminus">-&lt;?xml-stylesheet href=&quot;chrome://communicator/skin/&quot; type=&quot;text/css&quot;?&gt;</span>
<a href="#l9.91"></a><span id="l9.91" class="difflineminus">-</span>
<a href="#l9.92"></a><span id="l9.92" class="difflineminus">-&lt;?xul-overlay href=&quot;chrome://communicator/content/history/historyTreeOverlay.xul&quot;?&gt;</span>
<a href="#l9.93"></a><span id="l9.93"> &lt;?xul-overlay href=&quot;chrome://global/content/globalOverlay.xul&quot;?&gt;</span>
<a href="#l9.94"></a><span id="l9.94"> &lt;?xul-overlay href=&quot;chrome://communicator/content/tasksOverlay.xul&quot;?&gt;</span>
<a href="#l9.95"></a><span id="l9.95" class="difflineplus">+&lt;?xul-overlay href=&quot;chrome://global/content/editMenuOverlay.xul&quot;?&gt;</span>
<a href="#l9.96"></a><span id="l9.96" class="difflineplus">+&lt;?xul-overlay href=&quot;chrome://communicator/content/utilityOverlay.xul&quot;?&gt;</span>
<a href="#l9.97"></a><span id="l9.97" class="difflineplus">+&lt;?xul-overlay href=&quot;chrome://communicator/content/history/placesOverlay.xul&quot;?&gt;</span>
<a href="#l9.98"></a><span id="l9.98"> </span>
<a href="#l9.99"></a><span id="l9.99" class="difflineminus">-&lt;!DOCTYPE window SYSTEM &quot;chrome://communicator/locale/history/history.dtd&quot; &gt;</span>
<a href="#l9.100"></a><span id="l9.100" class="difflineplus">+&lt;!DOCTYPE window [</span>
<a href="#l9.101"></a><span id="l9.101" class="difflineplus">+&lt;!ENTITY % historyDTD SYSTEM &quot;chrome://communicator/locale/history/history.dtd&quot;&gt;</span>
<a href="#l9.102"></a><span id="l9.102" class="difflineplus">+%historyDTD;</span>
<a href="#l9.103"></a><span id="l9.103" class="difflineplus">+&lt;!ENTITY % editMenuOverlayDTD SYSTEM &quot;chrome://global/locale/editMenuOverlay.dtd&quot;&gt;</span>
<a href="#l9.104"></a><span id="l9.104" class="difflineplus">+%editMenuOverlayDTD;</span>
<a href="#l9.105"></a><span id="l9.105" class="difflineplus">+&lt;!ENTITY % globalDTD SYSTEM &quot;chrome://global/locale/global.dtd&quot;&gt;</span>
<a href="#l9.106"></a><span id="l9.106" class="difflineplus">+%globalDTD;</span>
<a href="#l9.107"></a><span id="l9.107" class="difflineplus">+]&gt;</span>
<a href="#l9.108"></a><span id="l9.108"> </span>
<a href="#l9.109"></a><span id="l9.109"> &lt;window title=&quot;&amp;historyWindowTitle.label;&quot; id=&quot;history-window&quot;</span>
<a href="#l9.110"></a><span id="l9.110" class="difflineminus">-        onload=&quot;HistoryCommonInit();&quot;</span>
<a href="#l9.111"></a><span id="l9.111" class="difflineplus">+        onload=&quot;PlacesOrganizer.init();&quot;</span>
<a href="#l9.112"></a><span id="l9.112" class="difflineplus">+        onunload=&quot;PlacesOrganizer.destroy();&quot;</span>
<a href="#l9.113"></a><span id="l9.113">         xmlns=&quot;http://www.mozilla.org/keymaster/gatekeeper/there.is.only.xul&quot;</span>
<a href="#l9.114"></a><span id="l9.114">         width=&quot;500&quot; height=&quot;400&quot;</span>
<a href="#l9.115"></a><span id="l9.115">         persist=&quot;width height screenX screenY sizemode&quot;</span>
<a href="#l9.116"></a><span id="l9.116">         windowtype=&quot;history:manager&quot;&gt;</span>
<a href="#l9.117"></a><span id="l9.117"> </span>
<a href="#l9.118"></a><span id="l9.118" class="difflineminus">-  &lt;stringbundle id=&quot;historyBundle&quot;</span>
<a href="#l9.119"></a><span id="l9.119" class="difflineminus">-                src=&quot;chrome://communicator/locale/history/history.properties&quot;/&gt;</span>
<a href="#l9.120"></a><span id="l9.120" class="difflineminus">-  &lt;stringbundle id=&quot;sortBundle&quot; src=&quot;chrome://global/locale/nsTreeSorting.properties&quot;/&gt;</span>
<a href="#l9.121"></a><span id="l9.121" class="difflineplus">+  &lt;script type=&quot;application/x-javascript&quot;</span>
<a href="#l9.122"></a><span id="l9.122" class="difflineplus">+          src=&quot;chrome://communicator/content/history/places.js&quot;/&gt;</span>
<a href="#l9.123"></a><span id="l9.123" class="difflineplus">+  &lt;script type=&quot;application/x-javascript&quot;</span>
<a href="#l9.124"></a><span id="l9.124" class="difflineplus">+          src=&quot;chrome://global/content/globalOverlay.js&quot;/&gt;</span>
<a href="#l9.125"></a><span id="l9.125" class="difflineplus">+  &lt;script type=&quot;application/x-javascript&quot;</span>
<a href="#l9.126"></a><span id="l9.126" class="difflineplus">+          src=&quot;chrome://communicator/content/history/history.js&quot;/&gt;</span>
<a href="#l9.127"></a><span id="l9.127" class="difflineplus">+  &lt;script type=&quot;application/x-javascript&quot;</span>
<a href="#l9.128"></a><span id="l9.128" class="difflineplus">+          src=&quot;chrome://communicator/content/bookmarks/bookmarks.js&quot;/&gt;</span>
<a href="#l9.129"></a><span id="l9.129"> </span>
<a href="#l9.130"></a><span id="l9.130" class="difflineminus">-&lt;commandset id=&quot;tasksCommands&quot;&gt;</span>
<a href="#l9.131"></a><span id="l9.131" class="difflineminus">-  &lt;commandset id=&quot;selectEditMenuItems&quot;/&gt;</span>
<a href="#l9.132"></a><span id="l9.132" class="difflineminus">-  &lt;commandset id=&quot;globalEditMenuItems&quot;/&gt;</span>
<a href="#l9.133"></a><span id="l9.133" class="difflineminus">-  &lt;commandset id=&quot;historyEditMenuItems&quot;</span>
<a href="#l9.134"></a><span id="l9.134" class="difflineminus">-              commandupdater=&quot;true&quot;</span>
<a href="#l9.135"></a><span id="l9.135" class="difflineminus">-              events=&quot;select&quot;</span>
<a href="#l9.136"></a><span id="l9.136" class="difflineminus">-              oncommandupdate=&quot;updateHistoryCommands()&quot;/&gt;</span>
<a href="#l9.137"></a><span id="l9.137" class="difflineminus">-  &lt;command id=&quot;cmd_searchHistory&quot; oncommand=&quot;window.openDialog('chrome://communicator/content/history/findHistory.xul', 'FindHistoryWindow', 'dialog=no,centerscreen,resizable=no,chrome,dependent');&quot;/&gt;</span>
<a href="#l9.138"></a><span id="l9.138" class="difflineplus">+  &lt;commandset id=&quot;tasksCommands&quot;&gt;</span>
<a href="#l9.139"></a><span id="l9.139" class="difflineplus">+    &lt;!-- File Menu --&gt;</span>
<a href="#l9.140"></a><span id="l9.140" class="difflineplus">+    &lt;command id=&quot;cmd_close&quot; oncommand=&quot;window.close()&quot;/&gt;</span>
<a href="#l9.141"></a><span id="l9.141" class="difflineplus">+    &lt;command id=&quot;cmd_quit&quot;/&gt;</span>
<a href="#l9.142"></a><span id="l9.142" class="difflineplus">+    &lt;command id=&quot;bm_cmd_saveas&quot;/&gt;</span>
<a href="#l9.143"></a><span id="l9.143" class="difflineplus">+    &lt;!-- Search Box --&gt;</span>
<a href="#l9.144"></a><span id="l9.144" class="difflineplus">+    &lt;command id=&quot;cmd_search_focus&quot;</span>
<a href="#l9.145"></a><span id="l9.145" class="difflineplus">+             oncommand=&quot;PlacesSearchBox.focus();&quot;/&gt;</span>
<a href="#l9.146"></a><span id="l9.146" class="difflineplus">+  &lt;/commandset&gt;</span>
<a href="#l9.147"></a><span id="l9.147" class="difflineplus">+  &lt;commandset id=&quot;editMenuCommands&quot;/&gt;</span>
<a href="#l9.148"></a><span id="l9.148" class="difflineplus">+  &lt;commandset id=&quot;placesCommands&quot;/&gt;</span>
<a href="#l9.149"></a><span id="l9.149"> </span>
<a href="#l9.150"></a><span id="l9.150" class="difflineminus">-  &lt;!-- File Menu --&gt;</span>
<a href="#l9.151"></a><span id="l9.151" class="difflineminus">-  &lt;command id=&quot;cmd_close&quot; oncommand=&quot;window.close()&quot;/&gt;</span>
<a href="#l9.152"></a><span id="l9.152" class="difflineminus">-  &lt;command id=&quot;cmd_quit&quot;/&gt;</span>
<a href="#l9.153"></a><span id="l9.153" class="difflineminus">-  &lt;command id=&quot;bm_cmd_saveas&quot;/&gt;</span>
<a href="#l9.154"></a><span id="l9.154" class="difflineminus">-  &lt;!-- Edit Menu --&gt;</span>
<a href="#l9.155"></a><span id="l9.155" class="difflineminus">-  &lt;command id=&quot;cmd_deleteByHostname&quot; oncommand=&quot;goDoCommand('cmd_deleteByHostname');&quot;/&gt;</span>
<a href="#l9.156"></a><span id="l9.156" class="difflineminus">-  &lt;command id=&quot;cmd_deleteByDomain&quot; oncommand=&quot;goDoCommand('cmd_deleteByDomain');&quot;/&gt;</span>
<a href="#l9.157"></a><span id="l9.157" class="difflineminus">-</span>
<a href="#l9.158"></a><span id="l9.158" class="difflineminus">-&lt;/commandset&gt;</span>
<a href="#l9.159"></a><span id="l9.159" class="difflineplus">+  &lt;broadcaster id=&quot;Communicator:WorkMode&quot;/&gt;</span>
<a href="#l9.160"></a><span id="l9.160"> </span>
<a href="#l9.161"></a><span id="l9.161" class="difflineminus">-&lt;broadcaster id=&quot;Communicator:WorkMode&quot;/&gt;</span>
<a href="#l9.162"></a><span id="l9.162" class="difflineplus">+  &lt;keyset id=&quot;tasksKeys&quot;&gt;</span>
<a href="#l9.163"></a><span id="l9.163" class="difflineplus">+    &lt;!-- File Menu --&gt;</span>
<a href="#l9.164"></a><span id="l9.164" class="difflineplus">+    &lt;key id=&quot;key_close&quot;/&gt;</span>
<a href="#l9.165"></a><span id="l9.165" class="difflineplus">+    &lt;key id=&quot;key_quit&quot;/&gt;</span>
<a href="#l9.166"></a><span id="l9.166" class="difflineplus">+    &lt;!-- Edit Menu --&gt;</span>
<a href="#l9.167"></a><span id="l9.167" class="difflineplus">+    &lt;key id=&quot;key_cut&quot;/&gt;</span>
<a href="#l9.168"></a><span id="l9.168" class="difflineplus">+    &lt;key id=&quot;key_copy&quot;/&gt;</span>
<a href="#l9.169"></a><span id="l9.169" class="difflineplus">+    &lt;key id=&quot;key_delete&quot;/&gt;</span>
<a href="#l9.170"></a><span id="l9.170" class="difflineplus">+    &lt;key id=&quot;key_delete2&quot;/&gt;</span>
<a href="#l9.171"></a><span id="l9.171" class="difflineplus">+    &lt;key id=&quot;key_selectAll&quot;/&gt;</span>
<a href="#l9.172"></a><span id="l9.172" class="difflineplus">+    &lt;!-- Search Box --&gt;</span>
<a href="#l9.173"></a><span id="l9.173" class="difflineplus">+    &lt;key id=&quot;key_search_focus&quot;</span>
<a href="#l9.174"></a><span id="l9.174" class="difflineplus">+         command=&quot;cmd_search_focus&quot;</span>
<a href="#l9.175"></a><span id="l9.175" class="difflineplus">+         key=&quot;&amp;search.key;&quot;</span>
<a href="#l9.176"></a><span id="l9.176" class="difflineplus">+         modifiers=&quot;accel&quot;/&gt;</span>
<a href="#l9.177"></a><span id="l9.177" class="difflineplus">+  &lt;/keyset&gt;</span>
<a href="#l9.178"></a><span id="l9.178"> </span>
<a href="#l9.179"></a><span id="l9.179" class="difflineminus">-&lt;keyset id=&quot;tasksKeys&quot;&gt;</span>
<a href="#l9.180"></a><span id="l9.180" class="difflineminus">-  &lt;!-- File Menu --&gt;</span>
<a href="#l9.181"></a><span id="l9.181" class="difflineminus">-  &lt;key id=&quot;key_close&quot;/&gt;</span>
<a href="#l9.182"></a><span id="l9.182" class="difflineminus">-  &lt;key id=&quot;key_quit&quot;/&gt;</span>
<a href="#l9.183"></a><span id="l9.183" class="difflineminus">-  &lt;!-- Edit Menu --&gt;</span>
<a href="#l9.184"></a><span id="l9.184" class="difflineminus">-  &lt;key id=&quot;key_cut&quot;/&gt;</span>
<a href="#l9.185"></a><span id="l9.185" class="difflineminus">-  &lt;key id=&quot;key_copy&quot;/&gt;</span>
<a href="#l9.186"></a><span id="l9.186" class="difflineminus">-  &lt;key id=&quot;key_delete&quot;/&gt;</span>
<a href="#l9.187"></a><span id="l9.187" class="difflineminus">-  &lt;key id=&quot;key_delete2&quot;/&gt;</span>
<a href="#l9.188"></a><span id="l9.188" class="difflineminus">-  &lt;key id=&quot;key_selectAll&quot;/&gt;</span>
<a href="#l9.189"></a><span id="l9.189" class="difflineminus">-  &lt;key id=&quot;key_searchHistory&quot; key=&quot;&amp;findHisCmd.commandkey;&quot; command=&quot;cmd_searchHistory&quot; modifiers=&quot;accel&quot;/&gt;</span>
<a href="#l9.190"></a><span id="l9.190" class="difflineminus">-&lt;/keyset&gt;</span>
<a href="#l9.191"></a><span id="l9.191" class="difflineplus">+  &lt;popupset id=&quot;placesPopupset&quot;&gt;</span>
<a href="#l9.192"></a><span id="l9.192" class="difflineplus">+    &lt;popup id=&quot;placesContext&quot;/&gt;</span>
<a href="#l9.193"></a><span id="l9.193" class="difflineplus">+    &lt;popup id=&quot;placesColumnsContext&quot;</span>
<a href="#l9.194"></a><span id="l9.194" class="difflineplus">+           onpopupshowing=&quot;ViewMenu.fillWithColumns(event, null, null, 'checkbox', null);&quot;</span>
<a href="#l9.195"></a><span id="l9.195" class="difflineplus">+           oncommand=&quot;ViewMenu.showHideColumn(event.target); event.stopPropagation();&quot;/&gt;</span>
<a href="#l9.196"></a><span id="l9.196" class="difflineplus">+  &lt;/popupset&gt;</span>
<a href="#l9.197"></a><span id="l9.197"> </span>
<a href="#l9.198"></a><span id="l9.198" class="difflineminus">-&lt;popupset id=&quot;historyContextMenu&quot;/&gt;</span>
<a href="#l9.199"></a><span id="l9.199" class="difflineminus">-</span>
<a href="#l9.200"></a><span id="l9.200" class="difflineminus">-&lt;toolbox id=&quot;history-toolbox&quot;&gt;</span>
<a href="#l9.201"></a><span id="l9.201" class="difflineminus">-&lt;menubar id=&quot;history-menu&quot; grippytooltiptext=&quot;&amp;menuBar.tooltip;&quot;&gt;</span>
<a href="#l9.202"></a><span id="l9.202" class="difflineminus">-  &lt;menu id=&quot;menu_File&quot;&gt;</span>
<a href="#l9.203"></a><span id="l9.203" class="difflineminus">-    &lt;menupopup id=&quot;menu_FilePopup&quot;&gt;</span>
<a href="#l9.204"></a><span id="l9.204" class="difflineminus">-      &lt;menuitem id=&quot;menu_close&quot;/&gt;</span>
<a href="#l9.205"></a><span id="l9.205" class="difflineminus">-    &lt;/menupopup&gt;</span>
<a href="#l9.206"></a><span id="l9.206" class="difflineminus">-  &lt;/menu&gt;</span>
<a href="#l9.207"></a><span id="l9.207" class="difflineplus">+  &lt;toolbox id=&quot;history-toolbox&quot;&gt;</span>
<a href="#l9.208"></a><span id="l9.208" class="difflineplus">+  &lt;menubar id=&quot;history-menu&quot;</span>
<a href="#l9.209"></a><span id="l9.209" class="difflineplus">+           grippytooltiptext=&quot;&amp;menuBar.tooltip;&quot;</span>
<a href="#l9.210"></a><span id="l9.210" class="difflineplus">+           chromedir=&quot;&amp;locale.dir;&quot;&gt;</span>
<a href="#l9.211"></a><span id="l9.211" class="difflineplus">+    &lt;menu id=&quot;menu_File&quot;&gt;</span>
<a href="#l9.212"></a><span id="l9.212" class="difflineplus">+      &lt;menupopup id=&quot;menu_FilePopup&quot;&gt;</span>
<a href="#l9.213"></a><span id="l9.213" class="difflineplus">+        &lt;menuitem id=&quot;menu_close&quot;/&gt;</span>
<a href="#l9.214"></a><span id="l9.214" class="difflineplus">+      &lt;/menupopup&gt;</span>
<a href="#l9.215"></a><span id="l9.215" class="difflineplus">+    &lt;/menu&gt;</span>
<a href="#l9.216"></a><span id="l9.216"> </span>
<a href="#l9.217"></a><span id="l9.217" class="difflineminus">-  &lt;menu id=&quot;menu_Edit&quot;&gt;</span>
<a href="#l9.218"></a><span id="l9.218" class="difflineminus">-    &lt;menupopup&gt;</span>
<a href="#l9.219"></a><span id="l9.219" class="difflineminus">-      &lt;menuitem id=&quot;menu_cut&quot;/&gt;</span>
<a href="#l9.220"></a><span id="l9.220" class="difflineminus">-      &lt;menuitem id=&quot;menu_copy&quot;/&gt;</span>
<a href="#l9.221"></a><span id="l9.221" class="difflineminus">-      &lt;menuitem id=&quot;menu_delete&quot;/&gt;</span>
<a href="#l9.222"></a><span id="l9.222" class="difflineminus">-      &lt;menuitem id=&quot;menu_deleteByHostname&quot; command=&quot;cmd_deleteByHostname&quot;</span>
<a href="#l9.223"></a><span id="l9.223" class="difflineminus">-                accesskey=&quot;&amp;deleteHostnameCmd.accesskey;&quot;/&gt;</span>
<a href="#l9.224"></a><span id="l9.224" class="difflineminus">-      &lt;menuitem id=&quot;menu_deleteByDomain&quot; command=&quot;cmd_deleteByDomain&quot;</span>
<a href="#l9.225"></a><span id="l9.225" class="difflineminus">-                accesskey=&quot;&amp;deleteDomainCmd.accesskey;&quot;/&gt;</span>
<a href="#l9.226"></a><span id="l9.226" class="difflineminus">-      &lt;menuseparator/&gt;</span>
<a href="#l9.227"></a><span id="l9.227" class="difflineminus">-      &lt;menuitem id=&quot;menu_selectAll&quot;/&gt;</span>
<a href="#l9.228"></a><span id="l9.228" class="difflineminus">-    &lt;/menupopup&gt;</span>
<a href="#l9.229"></a><span id="l9.229" class="difflineminus">-  &lt;/menu&gt;</span>
<a href="#l9.230"></a><span id="l9.230" class="difflineminus">-  &lt;menu id=&quot;menu_View&quot;&gt;</span>
<a href="#l9.231"></a><span id="l9.231" class="difflineminus">-    &lt;menupopup onpopupshowing=&quot;fillViewMenu(this)&quot;&gt;</span>
<a href="#l9.232"></a><span id="l9.232" class="difflineminus">-      &lt;menu id=&quot;groupingMenu&quot; label=&quot;&amp;groupBy.label;&quot; accesskey=&quot;&amp;groupBy.accesskey;&quot;&gt;</span>
<a href="#l9.233"></a><span id="l9.233" class="difflineminus">-        &lt;menupopup&gt;</span>
<a href="#l9.234"></a><span id="l9.234" class="difflineminus">-          &lt;menuitem id=&quot;groupByDay&quot; label=&quot;&amp;groupByDay.label;&quot; accesskey=&quot;&amp;groupByDay.accesskey;&quot; type=&quot;radio&quot; oncommand=&quot;GroupBy('day');&quot;/&gt;</span>
<a href="#l9.235"></a><span id="l9.235" class="difflineminus">-          &lt;menuitem id=&quot;groupBySite&quot; label=&quot;&amp;groupBySite.label;&quot; accesskey=&quot;&amp;groupBySite.accesskey;&quot; type=&quot;radio&quot; oncommand=&quot;GroupBy('site');&quot;/&gt;</span>
<a href="#l9.236"></a><span id="l9.236" class="difflineminus">-          &lt;menuitem id=&quot;groupByNone&quot; label=&quot;&amp;groupByNone.label;&quot; accesskey=&quot;&amp;groupByNone.accesskey;&quot; type=&quot;radio&quot; oncommand=&quot;GroupBy('none');&quot;/&gt;</span>
<a href="#l9.237"></a><span id="l9.237" class="difflineminus">-        &lt;/menupopup&gt;</span>
<a href="#l9.238"></a><span id="l9.238" class="difflineminus">-      &lt;/menu&gt;</span>
<a href="#l9.239"></a><span id="l9.239" class="difflineminus">-      &lt;menuitem type=&quot;radio&quot; name=&quot;sort_column&quot; id=&quot;unsorted_menuitem&quot;</span>
<a href="#l9.240"></a><span id="l9.240" class="difflineminus">-        label=&quot;&amp;menuitem.view.unsorted.label;&quot;</span>
<a href="#l9.241"></a><span id="l9.241" class="difflineminus">-        accesskey=&quot;&amp;menuitem.view.unsorted.accesskey;&quot;</span>
<a href="#l9.242"></a><span id="l9.242" class="difflineminus">-        oncommand=&quot;return SortInNewDirection('natural');&quot;/&gt;</span>
<a href="#l9.243"></a><span id="l9.243" class="difflineminus">-      &lt;menuseparator id=&quot;fill_after_this_node&quot;/&gt;</span>
<a href="#l9.244"></a><span id="l9.244" class="difflineminus">-      &lt;menuseparator id=&quot;fill_before_this_node&quot;/&gt;</span>
<a href="#l9.245"></a><span id="l9.245" class="difflineminus">-      &lt;menuitem type=&quot;radio&quot; name=&quot;sort_direction&quot; id=&quot;sort_ascending&quot;</span>
<a href="#l9.246"></a><span id="l9.246" class="difflineminus">-        label=&quot;&amp;sortAscending.label;&quot;</span>
<a href="#l9.247"></a><span id="l9.247" class="difflineminus">-        accesskey=&quot;&amp;sortAscending.accesskey;&quot;</span>
<a href="#l9.248"></a><span id="l9.248" class="difflineminus">-        oncommand=&quot;return SortInNewDirection('ascending');&quot;/&gt;</span>
<a href="#l9.249"></a><span id="l9.249" class="difflineminus">-      &lt;menuitem type=&quot;radio&quot; name=&quot;sort_direction&quot; id=&quot;sort_descending&quot;</span>
<a href="#l9.250"></a><span id="l9.250" class="difflineminus">-        label=&quot;&amp;sortDescending.label;&quot;</span>
<a href="#l9.251"></a><span id="l9.251" class="difflineminus">-        accesskey=&quot;&amp;sortDescending.accesskey;&quot;</span>
<a href="#l9.252"></a><span id="l9.252" class="difflineminus">-        oncommand=&quot;return SortInNewDirection('descending');&quot;/&gt;</span>
<a href="#l9.253"></a><span id="l9.253" class="difflineminus">-    &lt;/menupopup&gt;</span>
<a href="#l9.254"></a><span id="l9.254" class="difflineminus">-  &lt;/menu&gt;</span>
<a href="#l9.255"></a><span id="l9.255" class="difflineminus">-  &lt;menu id=&quot;tasksMenu&quot;&gt;</span>
<a href="#l9.256"></a><span id="l9.256" class="difflineminus">-    &lt;menupopup id=&quot;taskPopup&quot;&gt;</span>
<a href="#l9.257"></a><span id="l9.257" class="difflineminus">-      &lt;menuitem id=&quot;menu_searchHistory&quot; label=&quot;&amp;findHisCmd.label;&quot; key=&quot;key_searchHistory&quot;</span>
<a href="#l9.258"></a><span id="l9.258" class="difflineminus">-                accesskey=&quot;&amp;findHisCmd.accesskey;&quot; command=&quot;cmd_searchHistory&quot;/&gt;</span>
<a href="#l9.259"></a><span id="l9.259" class="difflineminus">-      &lt;menuseparator/&gt;</span>
<a href="#l9.260"></a><span id="l9.260" class="difflineminus">-    &lt;/menupopup&gt;</span>
<a href="#l9.261"></a><span id="l9.261" class="difflineminus">-  &lt;/menu&gt;</span>
<a href="#l9.262"></a><span id="l9.262" class="difflineminus">-  &lt;menu id=&quot;windowMenu&quot;/&gt;</span>
<a href="#l9.263"></a><span id="l9.263" class="difflineminus">-  &lt;menu id=&quot;menu_Help&quot;/&gt;</span>
<a href="#l9.264"></a><span id="l9.264" class="difflineminus">-&lt;/menubar&gt;</span>
<a href="#l9.265"></a><span id="l9.265" class="difflineminus">-&lt;/toolbox&gt;</span>
<a href="#l9.266"></a><span id="l9.266" class="difflineplus">+    &lt;menu id=&quot;menu_Edit&quot;&gt;</span>
<a href="#l9.267"></a><span id="l9.267" class="difflineplus">+      &lt;menupopup&gt;</span>
<a href="#l9.268"></a><span id="l9.268" class="difflineplus">+        &lt;menuitem id=&quot;menu_cut&quot;</span>
<a href="#l9.269"></a><span id="l9.269" class="difflineplus">+                  selection=&quot;separator|link|folder|mixed&quot;/&gt;</span>
<a href="#l9.270"></a><span id="l9.270" class="difflineplus">+        &lt;menuitem id=&quot;menu_copy&quot;</span>
<a href="#l9.271"></a><span id="l9.271" class="difflineplus">+                  selection=&quot;separator|link|folder|mixed&quot;/&gt;</span>
<a href="#l9.272"></a><span id="l9.272" class="difflineplus">+        &lt;menuitem id=&quot;menu_delete&quot;/&gt;</span>
<a href="#l9.273"></a><span id="l9.273" class="difflineplus">+        &lt;menuseparator/&gt;</span>
<a href="#l9.274"></a><span id="l9.274" class="difflineplus">+        &lt;menuitem id=&quot;cMenu_selectAll&quot;/&gt;</span>
<a href="#l9.275"></a><span id="l9.275" class="difflineplus">+      &lt;/menupopup&gt;</span>
<a href="#l9.276"></a><span id="l9.276" class="difflineplus">+    &lt;/menu&gt;</span>
<a href="#l9.277"></a><span id="l9.277" class="difflineplus">+    &lt;menu id=&quot;menu_View&quot;&gt;</span>
<a href="#l9.278"></a><span id="l9.278" class="difflineplus">+      &lt;menupopup&gt;</span>
<a href="#l9.279"></a><span id="l9.279" class="difflineplus">+        &lt;menu id=&quot;viewColumns&quot;</span>
<a href="#l9.280"></a><span id="l9.280" class="difflineplus">+              label=&quot;&amp;view.columns.label;&quot; accesskey=&quot;&amp;view.columns.accesskey;&quot;&gt;</span>
<a href="#l9.281"></a><span id="l9.281" class="difflineplus">+          &lt;menupopup onpopupshowing=&quot;ViewMenu.fillWithColumns(event, null, null, 'checkbox', null);&quot;</span>
<a href="#l9.282"></a><span id="l9.282" class="difflineplus">+                     oncommand=&quot;ViewMenu.showHideColumn(event.target); event.stopPropagation();&quot;/&gt;</span>
<a href="#l9.283"></a><span id="l9.283" class="difflineplus">+        &lt;/menu&gt;</span>
<a href="#l9.284"></a><span id="l9.284" class="difflineplus">+        &lt;menu id=&quot;viewSort&quot; label=&quot;&amp;view.sort.label;&quot;</span>
<a href="#l9.285"></a><span id="l9.285" class="difflineplus">+              accesskey=&quot;&amp;view.sort.accesskey;&quot;&gt;</span>
<a href="#l9.286"></a><span id="l9.286" class="difflineplus">+          &lt;menupopup onpopupshowing=&quot;ViewMenu.populateSortMenu(event);&quot;</span>
<a href="#l9.287"></a><span id="l9.287" class="difflineplus">+                     oncommand=&quot;ViewMenu.setSortColumn(event.target.column, null);&quot;&gt;</span>
<a href="#l9.288"></a><span id="l9.288" class="difflineplus">+            &lt;menuitem id=&quot;viewUnsorted&quot; type=&quot;radio&quot; name=&quot;columns&quot;</span>
<a href="#l9.289"></a><span id="l9.289" class="difflineplus">+                      label=&quot;&amp;view.unsorted.label;&quot; accesskey=&quot;&amp;view.unsorted.accesskey;&quot;</span>
<a href="#l9.290"></a><span id="l9.290" class="difflineplus">+                      oncommand=&quot;ViewMenu.setSortColumn(null, null);&quot;/&gt;</span>
<a href="#l9.291"></a><span id="l9.291" class="difflineplus">+            &lt;menuseparator id=&quot;directionSeparator&quot;/&gt;</span>
<a href="#l9.292"></a><span id="l9.292" class="difflineplus">+            &lt;menuitem id=&quot;viewSortAscending&quot; type=&quot;radio&quot; name=&quot;direction&quot;</span>
<a href="#l9.293"></a><span id="l9.293" class="difflineplus">+                      label=&quot;&amp;view.sortAscending.label;&quot; accesskey=&quot;&amp;view.sortAscending.accesskey;&quot;</span>
<a href="#l9.294"></a><span id="l9.294" class="difflineplus">+                      oncommand=&quot;ViewMenu.setSortColumn(null, 'ascending'); event.stopPropagation();&quot;/&gt;</span>
<a href="#l9.295"></a><span id="l9.295" class="difflineplus">+            &lt;menuitem id=&quot;viewSortDescending&quot; type=&quot;radio&quot; name=&quot;direction&quot;</span>
<a href="#l9.296"></a><span id="l9.296" class="difflineplus">+                      label=&quot;&amp;view.sortDescending.label;&quot; accesskey=&quot;&amp;view.sortDescending.accesskey;&quot;</span>
<a href="#l9.297"></a><span id="l9.297" class="difflineplus">+                      oncommand=&quot;ViewMenu.setSortColumn(null, 'descending'); event.stopPropagation();&quot;/&gt;</span>
<a href="#l9.298"></a><span id="l9.298" class="difflineplus">+          &lt;/menupopup&gt;</span>
<a href="#l9.299"></a><span id="l9.299" class="difflineplus">+        &lt;/menu&gt;</span>
<a href="#l9.300"></a><span id="l9.300" class="difflineplus">+      &lt;/menupopup&gt;</span>
<a href="#l9.301"></a><span id="l9.301" class="difflineplus">+    &lt;/menu&gt;</span>
<a href="#l9.302"></a><span id="l9.302" class="difflineplus">+    &lt;menu id=&quot;tasksMenu&quot;/&gt;</span>
<a href="#l9.303"></a><span id="l9.303" class="difflineplus">+    &lt;menu id=&quot;windowMenu&quot;/&gt;</span>
<a href="#l9.304"></a><span id="l9.304" class="difflineplus">+    &lt;menu id=&quot;menu_Help&quot;/&gt;</span>
<a href="#l9.305"></a><span id="l9.305" class="difflineplus">+  &lt;/menubar&gt;</span>
<a href="#l9.306"></a><span id="l9.306" class="difflineplus">+  &lt;toolbar class=&quot;chromeclass-toolbar&quot;</span>
<a href="#l9.307"></a><span id="l9.307" class="difflineplus">+           id=&quot;placesToolbar&quot;</span>
<a href="#l9.308"></a><span id="l9.308" class="difflineplus">+           align=&quot;center&quot;</span>
<a href="#l9.309"></a><span id="l9.309" class="difflineplus">+           grippytooltiptext=&quot;&amp;searchBar.tooltip;&quot;</span>
<a href="#l9.310"></a><span id="l9.310" class="difflineplus">+           chromedir=&quot;&amp;locale.dir;&quot;&gt;</span>
<a href="#l9.311"></a><span id="l9.311" class="difflineplus">+    &lt;textbox id=&quot;searchFilter&quot;</span>
<a href="#l9.312"></a><span id="l9.312" class="difflineplus">+             clickSelectsAll=&quot;true&quot;</span>
<a href="#l9.313"></a><span id="l9.313" class="difflineplus">+             type=&quot;search&quot;</span>
<a href="#l9.314"></a><span id="l9.314" class="difflineplus">+             emptytext=&quot;&amp;search.emptytext;&quot;</span>
<a href="#l9.315"></a><span id="l9.315" class="difflineplus">+             oncommand=&quot;PlacesSearchBox.search(this.value);&quot;</span>
<a href="#l9.316"></a><span id="l9.316" class="difflineplus">+             collection=&quot;history&quot;&gt;</span>
<a href="#l9.317"></a><span id="l9.317" class="difflineplus">+    &lt;/textbox&gt;</span>
<a href="#l9.318"></a><span id="l9.318" class="difflineplus">+  &lt;/toolbar&gt;</span>
<a href="#l9.319"></a><span id="l9.319" class="difflineplus">+  &lt;/toolbox&gt;</span>
<a href="#l9.320"></a><span id="l9.320"> </span>
<a href="#l9.321"></a><span id="l9.321" class="difflineminus">-  &lt;tree id=&quot;historyTree&quot;/&gt;</span>
<a href="#l9.322"></a><span id="l9.322" class="difflineplus">+  &lt;tree id=&quot;placeContent&quot;</span>
<a href="#l9.323"></a><span id="l9.323" class="difflineplus">+        class=&quot;placesTree&quot;</span>
<a href="#l9.324"></a><span id="l9.324" class="difflineplus">+        context=&quot;placesContext&quot;</span>
<a href="#l9.325"></a><span id="l9.325" class="difflineplus">+        flex=&quot;1&quot; type=&quot;places&quot;</span>
<a href="#l9.326"></a><span id="l9.326" class="difflineplus">+        flatList=&quot;true&quot;</span>
<a href="#l9.327"></a><span id="l9.327" class="difflineplus">+        enableColumnDrag=&quot;true&quot;</span>
<a href="#l9.328"></a><span id="l9.328" class="difflineplus">+        onkeypress=&quot;if (event.keyCode == KeyEvent.DOM_VK_RETURN) PlacesOrganizer.openSelectedNode(event);&quot;</span>
<a href="#l9.329"></a><span id="l9.329" class="difflineplus">+        ondblclick=&quot;PlacesOrganizer.openSelectedNode(event);&quot;</span>
<a href="#l9.330"></a><span id="l9.330" class="difflineplus">+        onfocus=&quot;PlacesOrganizer.onTreeFocus(event);&quot;</span>
<a href="#l9.331"></a><span id="l9.331" class="difflineplus">+        onclick=&quot;PlacesOrganizer.onTreeClick(event);&quot;&gt;</span>
<a href="#l9.332"></a><span id="l9.332" class="difflineplus">+    &lt;treecols id=&quot;placeContentColumns&quot; context=&quot;placesColumnsContext&quot;&gt;</span>
<a href="#l9.333"></a><span id="l9.333" class="difflineplus">+      &lt;treecol label=&quot;&amp;col.name.label;&quot; id=&quot;placesContentTitle&quot; anonid=&quot;title&quot; flex=&quot;5&quot; primary=&quot;true&quot; ordinal=&quot;1&quot;</span>
<a href="#l9.334"></a><span id="l9.334" class="difflineplus">+               persist=&quot;width hidden ordinal sortActive sortDirection&quot;/&gt;</span>
<a href="#l9.335"></a><span id="l9.335" class="difflineplus">+      &lt;splitter class=&quot;tree-splitter&quot;/&gt;</span>
<a href="#l9.336"></a><span id="l9.336" class="difflineplus">+      &lt;treecol label=&quot;&amp;col.url.label;&quot; id=&quot;placesContentUrl&quot; anonid=&quot;url&quot; flex=&quot;5&quot;</span>
<a href="#l9.337"></a><span id="l9.337" class="difflineplus">+               persist=&quot;width hidden ordinal sortActive sortDirection&quot;/&gt;</span>
<a href="#l9.338"></a><span id="l9.338" class="difflineplus">+      &lt;splitter class=&quot;tree-splitter&quot;/&gt;</span>
<a href="#l9.339"></a><span id="l9.339" class="difflineplus">+      &lt;treecol label=&quot;&amp;col.lastvisit.label;&quot; id=&quot;placesContentDate&quot; anonid=&quot;date&quot; flex=&quot;1&quot;</span>
<a href="#l9.340"></a><span id="l9.340" class="difflineplus">+               persist=&quot;width hidden ordinal sortActive sortDirection&quot;/&gt;</span>
<a href="#l9.341"></a><span id="l9.341" class="difflineplus">+      &lt;splitter class=&quot;tree-splitter&quot;/&gt;</span>
<a href="#l9.342"></a><span id="l9.342" class="difflineplus">+      &lt;treecol label=&quot;&amp;col.visitcount.label;&quot; id=&quot;placesContentVisitCount&quot; anonid=&quot;visitCount&quot; flex=&quot;1&quot; hidden=&quot;true&quot;</span>
<a href="#l9.343"></a><span id="l9.343" class="difflineplus">+               persist=&quot;width hidden ordinal sortActive sortDirection&quot;/&gt;</span>
<a href="#l9.344"></a><span id="l9.344" class="difflineplus">+    &lt;/treecols&gt;</span>
<a href="#l9.345"></a><span id="l9.345" class="difflineplus">+    &lt;treechildren flex=&quot;1&quot;/&gt;</span>
<a href="#l9.346"></a><span id="l9.346" class="difflineplus">+  &lt;/tree&gt;</span>
<a href="#l9.347"></a><span id="l9.347">   &lt;statusbar id=&quot;status-bar&quot; class=&quot;chromeclass-status&quot;&gt;</span>
<a href="#l9.348"></a><span id="l9.348">     &lt;statusbarpanel id=&quot;statusbar-display&quot; flex=&quot;1&quot;/&gt;</span>
<a href="#l9.349"></a><span id="l9.349">     &lt;statusbarpanel class=&quot;statusbarpanel-iconic&quot; id=&quot;offline-status&quot;/&gt;</span>
<a href="#l9.350"></a><span id="l9.350">   &lt;/statusbar&gt;</span>
<a href="#l9.351"></a><span id="l9.351"> </span>
<a href="#l9.352"></a><span id="l9.352"> &lt;/window&gt;</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l10.1"></a><span id="l10.1">deleted file mode 100644</span>
<a href="#l10.2"></a><span id="l10.2" class="difflineminus">--- a/suite/common/history/historyTreeOverlay.xul</span>
<a href="#l10.3"></a><span id="l10.3" class="difflineplus">+++ /dev/null</span>
<a href="#l10.4"></a><span id="l10.4" class="difflineat">@@ -1,167 +0,0 @@</span>
<a href="#l10.5"></a><span id="l10.5" class="difflineminus">-&lt;?xml version=&quot;1.0&quot;?&gt;</span>
<a href="#l10.6"></a><span id="l10.6" class="difflineminus">-&lt;!--</span>
<a href="#l10.7"></a><span id="l10.7" class="difflineminus">-</span>
<a href="#l10.8"></a><span id="l10.8" class="difflineminus">- ***** BEGIN LICENSE BLOCK *****</span>
<a href="#l10.9"></a><span id="l10.9" class="difflineminus">- Version: MPL 1.1/GPL 2.0/LGPL 2.1</span>
<a href="#l10.10"></a><span id="l10.10" class="difflineminus">-</span>
<a href="#l10.11"></a><span id="l10.11" class="difflineminus">- The contents of this file are subject to the Mozilla Public License Version</span>
<a href="#l10.12"></a><span id="l10.12" class="difflineminus">- 1.1 (the &quot;License&quot;); you may not use this file except in compliance with</span>
<a href="#l10.13"></a><span id="l10.13" class="difflineminus">- the License. You may obtain a copy of the License at</span>
<a href="#l10.14"></a><span id="l10.14" class="difflineminus">- http://www.mozilla.org/MPL/</span>
<a href="#l10.15"></a><span id="l10.15" class="difflineminus">-</span>
<a href="#l10.16"></a><span id="l10.16" class="difflineminus">- Software distributed under the License is distributed on an &quot;AS IS&quot; basis,</span>
<a href="#l10.17"></a><span id="l10.17" class="difflineminus">- WITHOUT WARRANTY OF ANY KIND, either express or implied. See the License</span>
<a href="#l10.18"></a><span id="l10.18" class="difflineminus">- for the specific language governing rights and limitations under the</span>
<a href="#l10.19"></a><span id="l10.19" class="difflineminus">- License.</span>
<a href="#l10.20"></a><span id="l10.20" class="difflineminus">-</span>
<a href="#l10.21"></a><span id="l10.21" class="difflineminus">- The Original Code is mozilla.org code.</span>
<a href="#l10.22"></a><span id="l10.22" class="difflineminus">-</span>
<a href="#l10.23"></a><span id="l10.23" class="difflineminus">- The Initial Developer of the Original Code is</span>
<a href="#l10.24"></a><span id="l10.24" class="difflineminus">- Netscape Communications Corporation.</span>
<a href="#l10.25"></a><span id="l10.25" class="difflineminus">- Portions created by the Initial Developer are Copyright (C) 1998</span>
<a href="#l10.26"></a><span id="l10.26" class="difflineminus">- the Initial Developer. All Rights Reserved.</span>
<a href="#l10.27"></a><span id="l10.27" class="difflineminus">-</span>
<a href="#l10.28"></a><span id="l10.28" class="difflineminus">- Contributor(s):</span>
<a href="#l10.29"></a><span id="l10.29" class="difflineminus">-   Ben Goodger &lt;ben@netscape.com&gt;</span>
<a href="#l10.30"></a><span id="l10.30" class="difflineminus">-   Blake Ross &lt;blakeross@telocity.com&gt;</span>
<a href="#l10.31"></a><span id="l10.31" class="difflineminus">-   Alec Flett &lt;alecf@netscape.com&gt;</span>
<a href="#l10.32"></a><span id="l10.32" class="difflineminus">-</span>
<a href="#l10.33"></a><span id="l10.33" class="difflineminus">- Alternatively, the contents of this file may be used under the terms of</span>
<a href="#l10.34"></a><span id="l10.34" class="difflineminus">- either of the GNU General Public License Version 2 or later (the &quot;GPL&quot;),</span>
<a href="#l10.35"></a><span id="l10.35" class="difflineminus">- or the GNU Lesser General Public License Version 2.1 or later (the &quot;LGPL&quot;),</span>
<a href="#l10.36"></a><span id="l10.36" class="difflineminus">- in which case the provisions of the GPL or the LGPL are applicable instead</span>
<a href="#l10.37"></a><span id="l10.37" class="difflineminus">- of those above. If you wish to allow use of your version of this file only</span>
<a href="#l10.38"></a><span id="l10.38" class="difflineminus">- under the terms of either the GPL or the LGPL, and not to allow others to</span>
<a href="#l10.39"></a><span id="l10.39" class="difflineminus">- use your version of this file under the terms of the MPL, indicate your</span>
<a href="#l10.40"></a><span id="l10.40" class="difflineminus">- decision by deleting the provisions above and replace them with the notice</span>
<a href="#l10.41"></a><span id="l10.41" class="difflineminus">- and other provisions required by the GPL or the LGPL. If you do not delete</span>
<a href="#l10.42"></a><span id="l10.42" class="difflineminus">- the provisions above, a recipient may use your version of this file under</span>
<a href="#l10.43"></a><span id="l10.43" class="difflineminus">- the terms of any one of the MPL, the GPL or the LGPL.</span>
<a href="#l10.44"></a><span id="l10.44" class="difflineminus">-</span>
<a href="#l10.45"></a><span id="l10.45" class="difflineminus">- ***** END LICENSE BLOCK ***** --&gt;</span>
<a href="#l10.46"></a><span id="l10.46" class="difflineminus">-</span>
<a href="#l10.47"></a><span id="l10.47" class="difflineminus">-&lt;!DOCTYPE overlay [</span>
<a href="#l10.48"></a><span id="l10.48" class="difflineminus">-&lt;!ENTITY % historyDTD SYSTEM &quot;chrome://communicator/locale/history/historyTreeOverlay.dtd&quot; &gt;</span>
<a href="#l10.49"></a><span id="l10.49" class="difflineminus">-%historyDTD;</span>
<a href="#l10.50"></a><span id="l10.50" class="difflineminus">-&lt;!ENTITY % contentAreaCommandsDTD SYSTEM &quot;chrome://communicator/locale/contentAreaCommands.dtd&quot; &gt;</span>
<a href="#l10.51"></a><span id="l10.51" class="difflineminus">-%contentAreaCommandsDTD;</span>
<a href="#l10.52"></a><span id="l10.52" class="difflineminus">-]&gt;</span>
<a href="#l10.53"></a><span id="l10.53" class="difflineminus">-&lt;?xml-stylesheet href=&quot;chrome://communicator/skin/bookmarks/bookmarks.css&quot; type=&quot;text/css&quot;?&gt;</span>
<a href="#l10.54"></a><span id="l10.54" class="difflineminus">-</span>
<a href="#l10.55"></a><span id="l10.55" class="difflineminus">-&lt;?xul-overlay href=&quot;chrome://communicator/content/utilityOverlay.xul&quot;?&gt;</span>
<a href="#l10.56"></a><span id="l10.56" class="difflineminus">-</span>
<a href="#l10.57"></a><span id="l10.57" class="difflineminus">-&lt;overlay id=&quot;historyTreeOverlay&quot;</span>
<a href="#l10.58"></a><span id="l10.58" class="difflineminus">-         xmlns=&quot;http://www.mozilla.org/keymaster/gatekeeper/there.is.only.xul&quot;</span>
<a href="#l10.59"></a><span id="l10.59" class="difflineminus">-         xmlns:web=&quot;http://home.netscape.com/WEB-rdf#&quot;</span>
<a href="#l10.60"></a><span id="l10.60" class="difflineminus">-         xmlns:rdf=&quot;http://www.w3.org/1999/02/22-rdf-syntax-ns#&quot;&gt;</span>
<a href="#l10.61"></a><span id="l10.61" class="difflineminus">-</span>
<a href="#l10.62"></a><span id="l10.62" class="difflineminus">-  &lt;script type=&quot;application/x-javascript&quot; src=&quot;chrome://global/content/nsDragAndDrop.js&quot;/&gt;</span>
<a href="#l10.63"></a><span id="l10.63" class="difflineminus">-  &lt;script type=&quot;application/x-javascript&quot; src=&quot;chrome://global/content/nsTreeController.js&quot;/&gt;</span>
<a href="#l10.64"></a><span id="l10.64" class="difflineminus">-  &lt;script type=&quot;application/x-javascript&quot; src=&quot;chrome://global/content/globalOverlay.js&quot;/&gt;</span>
<a href="#l10.65"></a><span id="l10.65" class="difflineminus">-  &lt;script type=&quot;application/x-javascript&quot; src=&quot;chrome://communicator/content/history/history.js&quot;/&gt;</span>
<a href="#l10.66"></a><span id="l10.66" class="difflineminus">-  &lt;script type=&quot;application/x-javascript&quot; src=&quot;chrome://communicator/content/history/historyTreeSorting.js&quot;/&gt;</span>
<a href="#l10.67"></a><span id="l10.67" class="difflineminus">-  &lt;script type=&quot;application/x-javascript&quot; src=&quot;chrome://communicator/content/bookmarks/bookmarks.js&quot;/&gt;</span>
<a href="#l10.68"></a><span id="l10.68" class="difflineminus">-  </span>
<a href="#l10.69"></a><span id="l10.69" class="difflineminus">-  &lt;popupset id=&quot;historyContextMenu&quot;&gt;</span>
<a href="#l10.70"></a><span id="l10.70" class="difflineminus">-    &lt;command id=&quot;cmd_selectAll&quot;/&gt;</span>
<a href="#l10.71"></a><span id="l10.71" class="difflineminus">-    &lt;command id=&quot;cmd_cut&quot;/&gt;</span>
<a href="#l10.72"></a><span id="l10.72" class="difflineminus">-    &lt;command id=&quot;cmd_copy&quot;/&gt;</span>
<a href="#l10.73"></a><span id="l10.73" class="difflineminus">-    &lt;command id=&quot;cmd_delete&quot;/&gt;</span>
<a href="#l10.74"></a><span id="l10.74" class="difflineminus">-    &lt;command id=&quot;cmd_selectAll&quot;/&gt;</span>
<a href="#l10.75"></a><span id="l10.75" class="difflineminus">-    &lt;popup id=&quot;historyMenu&quot; onpopupshowing=&quot;return updateItems();&quot;&gt;</span>
<a href="#l10.76"></a><span id="l10.76" class="difflineminus">-      &lt;menuitem id=&quot;miCollapseExpand&quot; oncommand=&quot;collapseExpand();&quot;/&gt;</span>
<a href="#l10.77"></a><span id="l10.77" class="difflineminus">-      &lt;menuitem id=&quot;miOpen&quot; label=&quot;&amp;openLinkInWindowCmd.label;&quot; accesskey=&quot;&amp;openLinkInWindowCmd.accesskey;&quot; default=&quot;true&quot;</span>
<a href="#l10.78"></a><span id="l10.78" class="difflineminus">-                oncommand=&quot;OpenURL('current');&quot;/&gt;</span>
<a href="#l10.79"></a><span id="l10.79" class="difflineminus">-      &lt;menuitem id=&quot;miOpenInNewWindow&quot; label=&quot;&amp;openLinkCmd.label;&quot; accesskey=&quot;&amp;openLinkCmd.accesskey;&quot;</span>
<a href="#l10.80"></a><span id="l10.80" class="difflineminus">-                oncommand=&quot;OpenURL('window');&quot;/&gt;</span>
<a href="#l10.81"></a><span id="l10.81" class="difflineminus">-      &lt;menuitem id=&quot;miOpenInNewTab&quot; label=&quot;&amp;openLinkCmdInTab.label;&quot; accesskey=&quot;&amp;openLinkCmdInTab.accesskey;&quot;</span>
<a href="#l10.82"></a><span id="l10.82" class="difflineminus">-                oncommand=&quot;OpenURL('tab', event);&quot;/&gt;</span>
<a href="#l10.83"></a><span id="l10.83" class="difflineminus">-      &lt;menuseparator id=&quot;pre-bookmarks-separator&quot;/&gt;</span>
<a href="#l10.84"></a><span id="l10.84" class="difflineminus">-      &lt;menuitem id=&quot;miAddBookmark&quot; label=&quot;&amp;bookmarkLinkCmd.label;&quot; accesskey=&quot;&amp;bookmarkLinkCmd.accesskey;&quot; oncommand=&quot;historyAddBookmarks();&quot;/&gt;</span>
<a href="#l10.85"></a><span id="l10.85" class="difflineminus">-      &lt;menuitem id=&quot;miCopyLinkLocation&quot; label=&quot;&amp;copyLinkCmd.label;&quot; accesskey=&quot;&amp;copyLinkCmd.accesskey;&quot;</span>
<a href="#l10.86"></a><span id="l10.86" class="difflineminus">-                command=&quot;cmd_copy&quot;/&gt;</span>
<a href="#l10.87"></a><span id="l10.87" class="difflineminus">-      &lt;menuseparator id=&quot;post-bookmarks-separator&quot;/&gt;</span>
<a href="#l10.88"></a><span id="l10.88" class="difflineminus">-      &lt;menuitem id=&quot;miDelete&quot; label=&quot;&amp;deleteCmd.label;&quot; accesskey=&quot;&amp;deleteCmd.accesskey;&quot;</span>
<a href="#l10.89"></a><span id="l10.89" class="difflineminus">-                command=&quot;cmd_delete&quot;/&gt;</span>
<a href="#l10.90"></a><span id="l10.90" class="difflineminus">-      &lt;menuitem id=&quot;miSelectAll&quot; label=&quot;&amp;selectAllCmd.label;&quot; accesskey=&quot;&amp;selectAllCmd.accesskey;&quot;</span>
<a href="#l10.91"></a><span id="l10.91" class="difflineminus">-                command=&quot;cmd_selectAll&quot;/&gt;</span>
<a href="#l10.92"></a><span id="l10.92" class="difflineminus">-    &lt;/popup&gt;</span>
<a href="#l10.93"></a><span id="l10.93" class="difflineminus">-    &lt;data id=&quot;multipleBookmarks&quot; label=&quot;&amp;bookmarkLinksCmd.label;&quot; accesskey=&quot;&amp;bookmarkLinksCmd.accesskey;&quot;/&gt;</span>
<a href="#l10.94"></a><span id="l10.94" class="difflineminus">-    &lt;data id=&quot;oneBookmark&quot; label=&quot;&amp;bookmarkLinkCmd.label;&quot; accesskey=&quot;&amp;bookmarkLinkCmd.accesskey;&quot;/&gt;</span>
<a href="#l10.95"></a><span id="l10.95" class="difflineminus">-  &lt;/popupset&gt;</span>
<a href="#l10.96"></a><span id="l10.96" class="difflineminus">-  &lt;tree id=&quot;historyTree&quot;</span>
<a href="#l10.97"></a><span id="l10.97" class="difflineminus">-        treelines=&quot;true&quot;</span>
<a href="#l10.98"></a><span id="l10.98" class="difflineminus">-        flex=&quot;1&quot;</span>
<a href="#l10.99"></a><span id="l10.99" class="difflineminus">-        enableColumnDrag=&quot;true&quot;</span>
<a href="#l10.100"></a><span id="l10.100" class="difflineminus">-        class=&quot;plain&quot;</span>
<a href="#l10.101"></a><span id="l10.101" class="difflineminus">-        context=&quot;historyMenu&quot;</span>
<a href="#l10.102"></a><span id="l10.102" class="difflineminus">-        datasources=&quot;rdf:history&quot;</span>
<a href="#l10.103"></a><span id="l10.103" class="difflineminus">-        ref=&quot;NC:HistoryByDate&quot;</span>
<a href="#l10.104"></a><span id="l10.104" class="difflineminus">-        flags=&quot;dont-build-content&quot;</span>
<a href="#l10.105"></a><span id="l10.105" class="difflineminus">-        onkeypress=&quot;if (event.keyCode == 13) OpenURL(BookmarksUtils.getBrowserTargetFromEvent(event), event);&quot;</span>
<a href="#l10.106"></a><span id="l10.106" class="difflineminus">-        onselect=&quot;this.view.selectionChanged(); historyOnSelect();&quot;</span>
<a href="#l10.107"></a><span id="l10.107" class="difflineminus">-        onclick=&quot;historyOnClick(event);&quot;</span>
<a href="#l10.108"></a><span id="l10.108" class="difflineminus">-        ondraggesture=&quot;if (event.originalTarget.localName == 'treechildren') nsDragAndDrop.startDrag(event, historyDNDObserver);&quot;</span>
<a href="#l10.109"></a><span id="l10.109" class="difflineminus">-        ondblclick=&quot;if (validClickConditions(event)) OpenURL(BookmarksUtils.getBrowserTargetFromEvent(event), event);&quot;&gt;</span>
<a href="#l10.110"></a><span id="l10.110" class="difflineminus">-    &lt;template&gt;</span>
<a href="#l10.111"></a><span id="l10.111" class="difflineminus">-      &lt;rule&gt;</span>
<a href="#l10.112"></a><span id="l10.112" class="difflineminus">-        &lt;treechildren&gt;</span>
<a href="#l10.113"></a><span id="l10.113" class="difflineminus">-          &lt;treeitem uri=&quot;rdf:*&quot; rdf:type=&quot;rdf:http://www.w3.org/1999/02/22-rdf-syntax-ns#type&quot;&gt;</span>
<a href="#l10.114"></a><span id="l10.114" class="difflineminus">-            &lt;treerow&gt;</span>
<a href="#l10.115"></a><span id="l10.115" class="difflineminus">-              &lt;treecell label=&quot;rdf:http://home.netscape.com/NC-rdf#Name&quot;/&gt;</span>
<a href="#l10.116"></a><span id="l10.116" class="difflineminus">-              &lt;treecell label=&quot;rdf:http://home.netscape.com/NC-rdf#URL&quot;/&gt;</span>
<a href="#l10.117"></a><span id="l10.117" class="difflineminus">-              &lt;treecell label=&quot;rdf:http://home.netscape.com/NC-rdf#Date&quot;/&gt;</span>
<a href="#l10.118"></a><span id="l10.118" class="difflineminus">-              &lt;treecell label=&quot;rdf:http://home.netscape.com/NC-rdf#FirstVisitDate&quot;/&gt;</span>
<a href="#l10.119"></a><span id="l10.119" class="difflineminus">-              &lt;treecell label=&quot;rdf:http://home.netscape.com/NC-rdf#Hostname&quot; /&gt;</span>
<a href="#l10.120"></a><span id="l10.120" class="difflineminus">-              &lt;treecell label=&quot;rdf:http://home.netscape.com/NC-rdf#Referrer&quot;/&gt;</span>
<a href="#l10.121"></a><span id="l10.121" class="difflineminus">-              &lt;treecell label=&quot;rdf:http://home.netscape.com/NC-rdf#VisitCount&quot;/&gt;</span>
<a href="#l10.122"></a><span id="l10.122" class="difflineminus">-            &lt;/treerow&gt;</span>
<a href="#l10.123"></a><span id="l10.123" class="difflineminus">-          &lt;/treeitem&gt;</span>
<a href="#l10.124"></a><span id="l10.124" class="difflineminus">-        &lt;/treechildren&gt;</span>
<a href="#l10.125"></a><span id="l10.125" class="difflineminus">-      &lt;/rule&gt;</span>
<a href="#l10.126"></a><span id="l10.126" class="difflineminus">-    &lt;/template&gt;</span>
<a href="#l10.127"></a><span id="l10.127" class="difflineminus">-    &lt;treecols id=&quot;historyTreeCols&quot;&gt;</span>
<a href="#l10.128"></a><span id="l10.128" class="difflineminus">-      &lt;treecol flex=&quot;4&quot; id=&quot;Name&quot; persist=&quot;hidden width sortActive sortDirection ordinal&quot; </span>
<a href="#l10.129"></a><span id="l10.129" class="difflineminus">-                   label=&quot;&amp;tree.header.name.label;&quot; primary=&quot;true&quot;</span>
<a href="#l10.130"></a><span id="l10.130" class="difflineminus">-                   sort=&quot;rdf:http://home.netscape.com/NC-rdf#Name&quot;</span>
<a href="#l10.131"></a><span id="l10.131" class="difflineminus">-                   accesskey=&quot;&amp;tree.header.name.accesskey;&quot;</span>
<a href="#l10.132"></a><span id="l10.132" class="difflineminus">-                   class=&quot;sortDirectionIndicator&quot;/&gt;</span>
<a href="#l10.133"></a><span id="l10.133" class="difflineminus">-      &lt;splitter class=&quot;tree-splitter&quot; id=&quot;pre-URL-splitter&quot;/&gt;</span>
<a href="#l10.134"></a><span id="l10.134" class="difflineminus">-      &lt;treecol flex=&quot;4&quot; id=&quot;URL&quot;</span>
<a href="#l10.135"></a><span id="l10.135" class="difflineminus">-                   persist=&quot;hidden width sortActive sortDirection ordinal&quot;</span>
<a href="#l10.136"></a><span id="l10.136" class="difflineminus">-                   label=&quot;&amp;tree.header.url.label;&quot; class=&quot;sortDirectionIndicator&quot;</span>
<a href="#l10.137"></a><span id="l10.137" class="difflineminus">-                   accesskey=&quot;&amp;tree.header.url.accesskey;&quot;</span>
<a href="#l10.138"></a><span id="l10.138" class="difflineminus">-                   sort=&quot;rdf:http://home.netscape.com/NC-rdf#URL&quot;/&gt;</span>
<a href="#l10.139"></a><span id="l10.139" class="difflineminus">-      &lt;splitter class=&quot;tree-splitter&quot; id=&quot;pre-Date-splitter&quot;/&gt;</span>
<a href="#l10.140"></a><span id="l10.140" class="difflineminus">-      &lt;treecol flex=&quot;1&quot; id=&quot;Date&quot;</span>
<a href="#l10.141"></a><span id="l10.141" class="difflineminus">-                   persist=&quot;hidden width sortActive sortDirection ordinal&quot;</span>
<a href="#l10.142"></a><span id="l10.142" class="difflineminus">-                   label=&quot;&amp;tree.header.date.label;&quot; class=&quot;sortDirectionIndicator&quot;</span>
<a href="#l10.143"></a><span id="l10.143" class="difflineminus">-                   accesskey=&quot;&amp;tree.header.date.accesskey;&quot;</span>
<a href="#l10.144"></a><span id="l10.144" class="difflineminus">-                   sort=&quot;rdf:http://home.netscape.com/NC-rdf#Date&quot;/&gt;</span>
<a href="#l10.145"></a><span id="l10.145" class="difflineminus">-      &lt;splitter class=&quot;tree-splitter&quot; id=&quot;pre-FirstVisitDate-splitter&quot;/&gt;</span>
<a href="#l10.146"></a><span id="l10.146" class="difflineminus">-      &lt;treecol flex=&quot;1&quot; id=&quot;FirstVisitDate&quot; hidden=&quot;true&quot;</span>
<a href="#l10.147"></a><span id="l10.147" class="difflineminus">-                   persist=&quot;hidden width sortActive sortDirection ordinal&quot;</span>
<a href="#l10.148"></a><span id="l10.148" class="difflineminus">-                   label=&quot;&amp;tree.header.firstvisitdate.label;&quot; class=&quot;sortDirectionIndicator&quot;</span>
<a href="#l10.149"></a><span id="l10.149" class="difflineminus">-                   accesskey=&quot;&amp;tree.header.firstvisitdate.accesskey;&quot;</span>
<a href="#l10.150"></a><span id="l10.150" class="difflineminus">-                   sort=&quot;rdf:http://home.netscape.com/NC-rdf#FirstVisitDate&quot;/&gt;</span>
<a href="#l10.151"></a><span id="l10.151" class="difflineminus">-      &lt;splitter class=&quot;tree-splitter&quot; id=&quot;pre-Hostname-splitter&quot;/&gt;</span>
<a href="#l10.152"></a><span id="l10.152" class="difflineminus">-      &lt;treecol flex=&quot;1&quot; id=&quot;Hostname&quot; hidden=&quot;true&quot;</span>
<a href="#l10.153"></a><span id="l10.153" class="difflineminus">-                   persist=&quot;hidden width sortActive sortDirection ordinal&quot;</span>
<a href="#l10.154"></a><span id="l10.154" class="difflineminus">-                   label=&quot;&amp;tree.header.hostname.label;&quot; class=&quot;sortDirectionIndicator&quot;</span>
<a href="#l10.155"></a><span id="l10.155" class="difflineminus">-                   accesskey=&quot;&amp;tree.header.hostname.accesskey;&quot;</span>
<a href="#l10.156"></a><span id="l10.156" class="difflineminus">-                   sort=&quot;rdf:http://home.netscape.com/NC-rdf#Hostname&quot;/&gt;</span>
<a href="#l10.157"></a><span id="l10.157" class="difflineminus">-      &lt;splitter class=&quot;tree-splitter&quot; id=&quot;pre-Referrer-splitter&quot;/&gt;</span>
<a href="#l10.158"></a><span id="l10.158" class="difflineminus">-      &lt;treecol flex=&quot;1&quot; id=&quot;Referrer&quot; hidden=&quot;true&quot;</span>
<a href="#l10.159"></a><span id="l10.159" class="difflineminus">-                   persist=&quot;hidden width sortActive sortDirection ordinal&quot;</span>
<a href="#l10.160"></a><span id="l10.160" class="difflineminus">-                   label=&quot;&amp;tree.header.referrer.label;&quot; class=&quot;sortDirectionIndicator&quot;</span>
<a href="#l10.161"></a><span id="l10.161" class="difflineminus">-                   accesskey=&quot;&amp;tree.header.referrer.accesskey;&quot;</span>
<a href="#l10.162"></a><span id="l10.162" class="difflineminus">-                   sort=&quot;rdf:http://home.netscape.com/NC-rdf#Referrer&quot;/&gt;</span>
<a href="#l10.163"></a><span id="l10.163" class="difflineminus">-      &lt;splitter class=&quot;tree-splitter&quot; id=&quot;pre-VisitCount-splitter&quot;/&gt;</span>
<a href="#l10.164"></a><span id="l10.164" class="difflineminus">-      &lt;treecol flex=&quot;1&quot; id=&quot;VisitCount&quot; hidden=&quot;true&quot;</span>
<a href="#l10.165"></a><span id="l10.165" class="difflineminus">-                   persist=&quot;hidden width sortActive sortDirection ordinal&quot;</span>
<a href="#l10.166"></a><span id="l10.166" class="difflineminus">-                   label=&quot;&amp;tree.header.visitcount.label;&quot; class=&quot;sortDirectionIndicator&quot;</span>
<a href="#l10.167"></a><span id="l10.167" class="difflineminus">-                   accesskey=&quot;&amp;tree.header.visitcount.accesskey;&quot;</span>
<a href="#l10.168"></a><span id="l10.168" class="difflineminus">-                   sort=&quot;rdf:http://home.netscape.com/NC-rdf#VisitCount&quot;/&gt;</span>
<a href="#l10.169"></a><span id="l10.169" class="difflineminus">-    &lt;/treecols&gt;</span>
<a href="#l10.170"></a><span id="l10.170" class="difflineminus">-  &lt;/tree&gt;</span>
<a href="#l10.171"></a><span id="l10.171" class="difflineminus">-&lt;/overlay&gt;</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l11.1"></a><span id="l11.1">deleted file mode 100644</span>
<a href="#l11.2"></a><span id="l11.2" class="difflineminus">--- a/suite/common/history/historyTreeSorting.js</span>
<a href="#l11.3"></a><span id="l11.3" class="difflineplus">+++ /dev/null</span>
<a href="#l11.4"></a><span id="l11.4" class="difflineat">@@ -1,199 +0,0 @@</span>
<a href="#l11.5"></a><span id="l11.5" class="difflineminus">-/* -*- Mode: Java; tab-width: 4; indent-tabs-mode: nil; c-basic-offset: 4 -*- */</span>
<a href="#l11.6"></a><span id="l11.6" class="difflineminus">-/* ***** BEGIN LICENSE BLOCK *****</span>
<a href="#l11.7"></a><span id="l11.7" class="difflineminus">- * Version: MPL 1.1/GPL 2.0/LGPL 2.1</span>
<a href="#l11.8"></a><span id="l11.8" class="difflineminus">- *</span>
<a href="#l11.9"></a><span id="l11.9" class="difflineminus">- * The contents of this file are subject to the Mozilla Public License Version</span>
<a href="#l11.10"></a><span id="l11.10" class="difflineminus">- * 1.1 (the &quot;License&quot;); you may not use this file except in compliance with</span>
<a href="#l11.11"></a><span id="l11.11" class="difflineminus">- * the License. You may obtain a copy of the License at</span>
<a href="#l11.12"></a><span id="l11.12" class="difflineminus">- * http://www.mozilla.org/MPL/</span>
<a href="#l11.13"></a><span id="l11.13" class="difflineminus">- *</span>
<a href="#l11.14"></a><span id="l11.14" class="difflineminus">- * Software distributed under the License is distributed on an &quot;AS IS&quot; basis,</span>
<a href="#l11.15"></a><span id="l11.15" class="difflineminus">- * WITHOUT WARRANTY OF ANY KIND, either express or implied. See the License</span>
<a href="#l11.16"></a><span id="l11.16" class="difflineminus">- * for the specific language governing rights and limitations under the</span>
<a href="#l11.17"></a><span id="l11.17" class="difflineminus">- * License.</span>
<a href="#l11.18"></a><span id="l11.18" class="difflineminus">- *</span>
<a href="#l11.19"></a><span id="l11.19" class="difflineminus">- * The Original Code is mozilla.org code.</span>
<a href="#l11.20"></a><span id="l11.20" class="difflineminus">- *</span>
<a href="#l11.21"></a><span id="l11.21" class="difflineminus">- * The Initial Developer of the Original Code is</span>
<a href="#l11.22"></a><span id="l11.22" class="difflineminus">- * Netscape Communications Corporation.</span>
<a href="#l11.23"></a><span id="l11.23" class="difflineminus">- * Portions created by the Initial Developer are Copyright (C) 1998</span>
<a href="#l11.24"></a><span id="l11.24" class="difflineminus">- * the Initial Developer. All Rights Reserved.</span>
<a href="#l11.25"></a><span id="l11.25" class="difflineminus">- *</span>
<a href="#l11.26"></a><span id="l11.26" class="difflineminus">- * Contributor(s):</span>
<a href="#l11.27"></a><span id="l11.27" class="difflineminus">- *   Peter Annema &lt;disttsc@bart.nl&gt;</span>
<a href="#l11.28"></a><span id="l11.28" class="difflineminus">- *   Blake Ross &lt;blakeross@telocity.com&gt;</span>
<a href="#l11.29"></a><span id="l11.29" class="difflineminus">- *   Alec Flett &lt;alecf@netscape.com&gt;</span>
<a href="#l11.30"></a><span id="l11.30" class="difflineminus">- *</span>
<a href="#l11.31"></a><span id="l11.31" class="difflineminus">- * Alternatively, the contents of this file may be used under the terms of</span>
<a href="#l11.32"></a><span id="l11.32" class="difflineminus">- * either of the GNU General Public License Version 2 or later (the &quot;GPL&quot;),</span>
<a href="#l11.33"></a><span id="l11.33" class="difflineminus">- * or the GNU Lesser General Public License Version 2.1 or later (the &quot;LGPL&quot;),</span>
<a href="#l11.34"></a><span id="l11.34" class="difflineminus">- * in which case the provisions of the GPL or the LGPL are applicable instead</span>
<a href="#l11.35"></a><span id="l11.35" class="difflineminus">- * of those above. If you wish to allow use of your version of this file only</span>
<a href="#l11.36"></a><span id="l11.36" class="difflineminus">- * under the terms of either the GPL or the LGPL, and not to allow others to</span>
<a href="#l11.37"></a><span id="l11.37" class="difflineminus">- * use your version of this file under the terms of the MPL, indicate your</span>
<a href="#l11.38"></a><span id="l11.38" class="difflineminus">- * decision by deleting the provisions above and replace them with the notice</span>
<a href="#l11.39"></a><span id="l11.39" class="difflineminus">- * and other provisions required by the GPL or the LGPL. If you do not delete</span>
<a href="#l11.40"></a><span id="l11.40" class="difflineminus">- * the provisions above, a recipient may use your version of this file under</span>
<a href="#l11.41"></a><span id="l11.41" class="difflineminus">- * the terms of any one of the MPL, the GPL or the LGPL.</span>
<a href="#l11.42"></a><span id="l11.42" class="difflineminus">- *</span>
<a href="#l11.43"></a><span id="l11.43" class="difflineminus">- * ***** END LICENSE BLOCK ***** */</span>
<a href="#l11.44"></a><span id="l11.44" class="difflineminus">-</span>
<a href="#l11.45"></a><span id="l11.45" class="difflineminus">-// This file got moved from</span>
<a href="#l11.46"></a><span id="l11.46" class="difflineminus">-// CVS /mozilla/xpfe/global/resources/content/nsTreeSorting.js.</span>
<a href="#l11.47"></a><span id="l11.47" class="difflineminus">-</span>
<a href="#l11.48"></a><span id="l11.48" class="difflineminus">-// utility routines for sorting</span>
<a href="#l11.49"></a><span id="l11.49" class="difflineminus">-</span>
<a href="#l11.50"></a><span id="l11.50" class="difflineminus">-// set the sort direction on the currently sorted column</span>
<a href="#l11.51"></a><span id="l11.51" class="difflineminus">-function SortInNewDirection(direction)</span>
<a href="#l11.52"></a><span id="l11.52" class="difflineminus">-{</span>
<a href="#l11.53"></a><span id="l11.53" class="difflineminus">-  var current_column = find_sort_column();</span>
<a href="#l11.54"></a><span id="l11.54" class="difflineminus">-  if (direction == &quot;ascending&quot;)</span>
<a href="#l11.55"></a><span id="l11.55" class="difflineminus">-    direction = &quot;natural&quot;;</span>
<a href="#l11.56"></a><span id="l11.56" class="difflineminus">-  else if (direction == &quot;descending&quot;)</span>
<a href="#l11.57"></a><span id="l11.57" class="difflineminus">-    direction = &quot;ascending&quot;;</span>
<a href="#l11.58"></a><span id="l11.58" class="difflineminus">-  else if (direction == &quot;natural&quot;)</span>
<a href="#l11.59"></a><span id="l11.59" class="difflineminus">-    direction = &quot;descending&quot;;</span>
<a href="#l11.60"></a><span id="l11.60" class="difflineminus">-  current_column.setAttribute(&quot;sortDirection&quot;, direction);</span>
<a href="#l11.61"></a><span id="l11.61" class="difflineminus">-  SortColumnElement(current_column);</span>
<a href="#l11.62"></a><span id="l11.62" class="difflineminus">-}</span>
<a href="#l11.63"></a><span id="l11.63" class="difflineminus">-</span>
<a href="#l11.64"></a><span id="l11.64" class="difflineminus">-function SortColumn(columnId)</span>
<a href="#l11.65"></a><span id="l11.65" class="difflineminus">-{</span>
<a href="#l11.66"></a><span id="l11.66" class="difflineminus">-  var column = document.getElementById(columnId);</span>
<a href="#l11.67"></a><span id="l11.67" class="difflineminus">-  SortColumnElement(column);</span>
<a href="#l11.68"></a><span id="l11.68" class="difflineminus">-}</span>
<a href="#l11.69"></a><span id="l11.69" class="difflineminus">-</span>
<a href="#l11.70"></a><span id="l11.70" class="difflineminus">-function SortColumnElement(column)</span>
<a href="#l11.71"></a><span id="l11.71" class="difflineminus">-{</span>
<a href="#l11.72"></a><span id="l11.72" class="difflineminus">-  var tree = column.parentNode.parentNode;</span>
<a href="#l11.73"></a><span id="l11.73" class="difflineminus">-  var col = tree.columns.getColumnFor(column);</span>
<a href="#l11.74"></a><span id="l11.74" class="difflineminus">-  tree.view.cycleHeader(col);</span>
<a href="#l11.75"></a><span id="l11.75" class="difflineminus">-}</span>
<a href="#l11.76"></a><span id="l11.76" class="difflineminus">-</span>
<a href="#l11.77"></a><span id="l11.77" class="difflineminus">-// search over the columns to find the first one with an active sort</span>
<a href="#l11.78"></a><span id="l11.78" class="difflineminus">-function find_sort_column()</span>
<a href="#l11.79"></a><span id="l11.79" class="difflineminus">-{</span>
<a href="#l11.80"></a><span id="l11.80" class="difflineminus">-  var columns = document.getElementsByTagName('treecol');</span>
<a href="#l11.81"></a><span id="l11.81" class="difflineminus">-  var i = 0;</span>
<a href="#l11.82"></a><span id="l11.82" class="difflineminus">-  var column;</span>
<a href="#l11.83"></a><span id="l11.83" class="difflineminus">-  while ((column = columns.item(i++)) != null) {</span>
<a href="#l11.84"></a><span id="l11.84" class="difflineminus">-      if (column.getAttribute('sortDirection'))</span>
<a href="#l11.85"></a><span id="l11.85" class="difflineminus">-          return column;</span>
<a href="#l11.86"></a><span id="l11.86" class="difflineminus">-  }</span>
<a href="#l11.87"></a><span id="l11.87" class="difflineminus">-  return columns.item(0);</span>
<a href="#l11.88"></a><span id="l11.88" class="difflineminus">-}</span>
<a href="#l11.89"></a><span id="l11.89" class="difflineminus">-</span>
<a href="#l11.90"></a><span id="l11.90" class="difflineminus">-// get the sort direction for the given column</span>
<a href="#l11.91"></a><span id="l11.91" class="difflineminus">-function find_sort_direction(column)</span>
<a href="#l11.92"></a><span id="l11.92" class="difflineminus">-{</span>
<a href="#l11.93"></a><span id="l11.93" class="difflineminus">-  var sortDirection = column.getAttribute('sortDirection');</span>
<a href="#l11.94"></a><span id="l11.94" class="difflineminus">-  return (sortDirection ? sortDirection : &quot;natural&quot;);</span>
<a href="#l11.95"></a><span id="l11.95" class="difflineminus">-}</span>
<a href="#l11.96"></a><span id="l11.96" class="difflineminus">-</span>
<a href="#l11.97"></a><span id="l11.97" class="difflineminus">-// set up the menu items to reflect the specified sort column</span>
<a href="#l11.98"></a><span id="l11.98" class="difflineminus">-// and direction - put check marks next to the active ones, and clear</span>
<a href="#l11.99"></a><span id="l11.99" class="difflineminus">-// out the old ones</span>
<a href="#l11.100"></a><span id="l11.100" class="difflineminus">-// - disable ascending/descending direction if the tree isn't sorted</span>
<a href="#l11.101"></a><span id="l11.101" class="difflineminus">-// - disable columns that are not visible</span>
<a href="#l11.102"></a><span id="l11.102" class="difflineminus">-function update_sort_menuitems(column, direction)</span>
<a href="#l11.103"></a><span id="l11.103" class="difflineminus">-{</span>
<a href="#l11.104"></a><span id="l11.104" class="difflineminus">-  var unsorted_menuitem = document.getElementById(&quot;unsorted_menuitem&quot;);</span>
<a href="#l11.105"></a><span id="l11.105" class="difflineminus">-  var sort_ascending = document.getElementById('sort_ascending');</span>
<a href="#l11.106"></a><span id="l11.106" class="difflineminus">-  var sort_descending = document.getElementById('sort_descending');</span>
<a href="#l11.107"></a><span id="l11.107" class="difflineminus">-</span>
<a href="#l11.108"></a><span id="l11.108" class="difflineminus">-  // as this function may be called from various places, including the</span>
<a href="#l11.109"></a><span id="l11.109" class="difflineminus">-  // bookmarks sidebar panel (which doesn't have any menu items)</span>
<a href="#l11.110"></a><span id="l11.110" class="difflineminus">-  // ensure that the document contains the elements</span>
<a href="#l11.111"></a><span id="l11.111" class="difflineminus">-  if ((!unsorted_menuitem) || (!sort_ascending) || (!sort_descending))</span>
<a href="#l11.112"></a><span id="l11.112" class="difflineminus">-    return;</span>
<a href="#l11.113"></a><span id="l11.113" class="difflineminus">-</span>
<a href="#l11.114"></a><span id="l11.114" class="difflineminus">-  if (direction == &quot;natural&quot;) {</span>
<a href="#l11.115"></a><span id="l11.115" class="difflineminus">-    unsorted_menuitem.setAttribute('checked','true');</span>
<a href="#l11.116"></a><span id="l11.116" class="difflineminus">-    sort_ascending.setAttribute('disabled','true');</span>
<a href="#l11.117"></a><span id="l11.117" class="difflineminus">-    sort_descending.setAttribute('disabled','true');</span>
<a href="#l11.118"></a><span id="l11.118" class="difflineminus">-    sort_ascending.removeAttribute('checked');</span>
<a href="#l11.119"></a><span id="l11.119" class="difflineminus">-    sort_descending.removeAttribute('checked');</span>
<a href="#l11.120"></a><span id="l11.120" class="difflineminus">-  } else {</span>
<a href="#l11.121"></a><span id="l11.121" class="difflineminus">-    sort_ascending.removeAttribute('disabled');</span>
<a href="#l11.122"></a><span id="l11.122" class="difflineminus">-    sort_descending.removeAttribute('disabled');</span>
<a href="#l11.123"></a><span id="l11.123" class="difflineminus">-    if (direction == &quot;ascending&quot;) {</span>
<a href="#l11.124"></a><span id="l11.124" class="difflineminus">-      sort_ascending.setAttribute('checked','true');</span>
<a href="#l11.125"></a><span id="l11.125" class="difflineminus">-    } else {</span>
<a href="#l11.126"></a><span id="l11.126" class="difflineminus">-      sort_descending.setAttribute('checked','true');</span>
<a href="#l11.127"></a><span id="l11.127" class="difflineminus">-    }</span>
<a href="#l11.128"></a><span id="l11.128" class="difflineminus">-</span>
<a href="#l11.129"></a><span id="l11.129" class="difflineminus">-    var columns = document.getElementsByTagName('treecol');</span>
<a href="#l11.130"></a><span id="l11.130" class="difflineminus">-    var i = 0;</span>
<a href="#l11.131"></a><span id="l11.131" class="difflineminus">-    var column_node = columns[i];</span>
<a href="#l11.132"></a><span id="l11.132" class="difflineminus">-    var column_name = column.id;</span>
<a href="#l11.133"></a><span id="l11.133" class="difflineminus">-    var menuitem = document.getElementById('fill_after_this_node');</span>
<a href="#l11.134"></a><span id="l11.134" class="difflineminus">-    menuitem = menuitem.nextSibling</span>
<a href="#l11.135"></a><span id="l11.135" class="difflineminus">-    while (1) {</span>
<a href="#l11.136"></a><span id="l11.136" class="difflineminus">-      var name = menuitem.getAttribute('column_id');</span>
<a href="#l11.137"></a><span id="l11.137" class="difflineminus">-      if (!name) break;</span>
<a href="#l11.138"></a><span id="l11.138" class="difflineminus">-      if (column_name == name) {</span>
<a href="#l11.139"></a><span id="l11.139" class="difflineminus">-        menuitem.setAttribute('checked', 'true');</span>
<a href="#l11.140"></a><span id="l11.140" class="difflineminus">-        break;</span>
<a href="#l11.141"></a><span id="l11.141" class="difflineminus">-      }</span>
<a href="#l11.142"></a><span id="l11.142" class="difflineminus">-      menuitem = menuitem.nextSibling;</span>
<a href="#l11.143"></a><span id="l11.143" class="difflineminus">-      column_node = columns[++i];</span>
<a href="#l11.144"></a><span id="l11.144" class="difflineminus">-      if (column_node &amp;&amp; column_node.tagName == &quot;splitter&quot;) {</span>
<a href="#l11.145"></a><span id="l11.145" class="difflineminus">-        column_node = columns[++i];</span>
<a href="#l11.146"></a><span id="l11.146" class="difflineminus">-      }</span>
<a href="#l11.147"></a><span id="l11.147" class="difflineminus">-    }</span>
<a href="#l11.148"></a><span id="l11.148" class="difflineminus">-  }</span>
<a href="#l11.149"></a><span id="l11.149" class="difflineminus">-  enable_sort_menuitems();</span>
<a href="#l11.150"></a><span id="l11.150" class="difflineminus">-}</span>
<a href="#l11.151"></a><span id="l11.151" class="difflineminus">-</span>
<a href="#l11.152"></a><span id="l11.152" class="difflineminus">-function enable_sort_menuitems()</span>
<a href="#l11.153"></a><span id="l11.153" class="difflineminus">-{</span>
<a href="#l11.154"></a><span id="l11.154" class="difflineminus">-  var columns = document.getElementsByTagName('treecol');</span>
<a href="#l11.155"></a><span id="l11.155" class="difflineminus">-  var menuitem = document.getElementById('fill_after_this_node');</span>
<a href="#l11.156"></a><span id="l11.156" class="difflineminus">-  menuitem = menuitem.nextSibling</span>
<a href="#l11.157"></a><span id="l11.157" class="difflineminus">-  for (var i = 0; (i &lt; columns.length) &amp;&amp; menuitem; ++i) {</span>
<a href="#l11.158"></a><span id="l11.158" class="difflineminus">-    var column_node = columns[i];</span>
<a href="#l11.159"></a><span id="l11.159" class="difflineminus">-    if (column_node.getAttribute(&quot;hidden&quot;) == &quot;true&quot;)</span>
<a href="#l11.160"></a><span id="l11.160" class="difflineminus">-      menuitem.setAttribute(&quot;disabled&quot;, &quot;true&quot;);</span>
<a href="#l11.161"></a><span id="l11.161" class="difflineminus">-    else</span>
<a href="#l11.162"></a><span id="l11.162" class="difflineminus">-      menuitem.removeAttribute(&quot;disabled&quot;);</span>
<a href="#l11.163"></a><span id="l11.163" class="difflineminus">-    menuitem = menuitem.nextSibling;</span>
<a href="#l11.164"></a><span id="l11.164" class="difflineminus">-  }</span>
<a href="#l11.165"></a><span id="l11.165" class="difflineminus">-}</span>
<a href="#l11.166"></a><span id="l11.166" class="difflineminus">-</span>
<a href="#l11.167"></a><span id="l11.167" class="difflineminus">-function fillViewMenu(popup)</span>
<a href="#l11.168"></a><span id="l11.168" class="difflineminus">-{</span>
<a href="#l11.169"></a><span id="l11.169" class="difflineminus">-  var fill_after = document.getElementById('fill_after_this_node');</span>
<a href="#l11.170"></a><span id="l11.170" class="difflineminus">-  var fill_before = document.getElementById('fill_before_this_node');</span>
<a href="#l11.171"></a><span id="l11.171" class="difflineminus">-  var strBundle = document.getElementById('sortBundle');</span>
<a href="#l11.172"></a><span id="l11.172" class="difflineminus">-  var sortString;</span>
<a href="#l11.173"></a><span id="l11.173" class="difflineminus">-  if (strBundle)</span>
<a href="#l11.174"></a><span id="l11.174" class="difflineminus">-    sortString = strBundle.getString('SortMenuItems');</span>
<a href="#l11.175"></a><span id="l11.175" class="difflineminus">-  if (!sortString)</span>
<a href="#l11.176"></a><span id="l11.176" class="difflineminus">-    sortString = &quot;Sorted by %COLNAME%&quot;;</span>
<a href="#l11.177"></a><span id="l11.177" class="difflineminus">-    </span>
<a href="#l11.178"></a><span id="l11.178" class="difflineminus">-  var firstTime = (fill_after.nextSibling == fill_before);</span>
<a href="#l11.179"></a><span id="l11.179" class="difflineminus">-  if (firstTime) {</span>
<a href="#l11.180"></a><span id="l11.180" class="difflineminus">-    var columns = document.getElementsByTagName('treecol');</span>
<a href="#l11.181"></a><span id="l11.181" class="difflineminus">-    for (var i = 0; i &lt; columns.length; ++i) {</span>
<a href="#l11.182"></a><span id="l11.182" class="difflineminus">-      var column = columns[i];</span>
<a href="#l11.183"></a><span id="l11.183" class="difflineminus">-      // Construct an entry for each cell in the row.</span>
<a href="#l11.184"></a><span id="l11.184" class="difflineminus">-      var column_name = column.getAttribute(&quot;label&quot;);</span>
<a href="#l11.185"></a><span id="l11.185" class="difflineminus">-      var column_accesskey = column.getAttribute(&quot;accesskey&quot;);</span>
<a href="#l11.186"></a><span id="l11.186" class="difflineminus">-      var item = document.createElement(&quot;menuitem&quot;);</span>
<a href="#l11.187"></a><span id="l11.187" class="difflineminus">-      if (column_accesskey)</span>
<a href="#l11.188"></a><span id="l11.188" class="difflineminus">-        item.setAttribute(&quot;accesskey&quot;, column_accesskey);</span>
<a href="#l11.189"></a><span id="l11.189" class="difflineminus">-      item.setAttribute(&quot;type&quot;, &quot;radio&quot;);</span>
<a href="#l11.190"></a><span id="l11.190" class="difflineminus">-      item.setAttribute(&quot;name&quot;, &quot;sort_column&quot;);</span>
<a href="#l11.191"></a><span id="l11.191" class="difflineminus">-      if (column_name == &quot;&quot;)</span>
<a href="#l11.192"></a><span id="l11.192" class="difflineminus">-        column_name = column.getAttribute(&quot;display&quot;);</span>
<a href="#l11.193"></a><span id="l11.193" class="difflineminus">-      var name = sortString.replace(/%COLNAME%/g, column_name);</span>
<a href="#l11.194"></a><span id="l11.194" class="difflineminus">-      item.setAttribute(&quot;label&quot;, name);</span>
<a href="#l11.195"></a><span id="l11.195" class="difflineminus">-      item.setAttribute(&quot;oncommand&quot;, &quot;SortColumn('&quot; + column.id + &quot;');&quot;);</span>
<a href="#l11.196"></a><span id="l11.196" class="difflineminus">-      item.setAttribute(&quot;column_id&quot;, column.id);</span>
<a href="#l11.197"></a><span id="l11.197" class="difflineminus">-      popup.insertBefore(item, fill_before);</span>
<a href="#l11.198"></a><span id="l11.198" class="difflineminus">-    }</span>
<a href="#l11.199"></a><span id="l11.199" class="difflineminus">-  }</span>
<a href="#l11.200"></a><span id="l11.200" class="difflineminus">-  var sort_column = find_sort_column();</span>
<a href="#l11.201"></a><span id="l11.201" class="difflineminus">-  var sort_direction = find_sort_direction(sort_column);</span>
<a href="#l11.202"></a><span id="l11.202" class="difflineminus">-  update_sort_menuitems(sort_column, sort_direction);</span>
<a href="#l11.203"></a><span id="l11.203" class="difflineminus">-}</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l12.1"></a><span id="l12.1">new file mode 100644</span>
<a href="#l12.2"></a><span id="l12.2" class="difflineminus">--- /dev/null</span>
<a href="#l12.3"></a><span id="l12.3" class="difflineplus">+++ b/suite/common/history/places.css</span>
<a href="#l12.4"></a><span id="l12.4" class="difflineat">@@ -0,0 +1,3 @@</span>
<a href="#l12.5"></a><span id="l12.5" class="difflineplus">+tree[type=&quot;places&quot;] {</span>
<a href="#l12.6"></a><span id="l12.6" class="difflineplus">+  -moz-binding: url(&quot;chrome://communicator/content/history/tree.xml#places-tree&quot;);</span>
<a href="#l12.7"></a><span id="l12.7" class="difflineplus">+}</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l13.1"></a><span id="l13.1">new file mode 100755</span>
<a href="#l13.2"></a><span id="l13.2" class="difflineminus">--- /dev/null</span>
<a href="#l13.3"></a><span id="l13.3" class="difflineplus">+++ b/suite/common/history/places.js</span>
<a href="#l13.4"></a><span id="l13.4" class="difflineat">@@ -0,0 +1,484 @@</span>
<a href="#l13.5"></a><span id="l13.5" class="difflineplus">+/* -*- Mode: C++; tab-width: 8; indent-tabs-mode: nil; c-basic-offset: 2 -*- */</span>
<a href="#l13.6"></a><span id="l13.6" class="difflineplus">+/* ***** BEGIN LICENSE BLOCK *****</span>
<a href="#l13.7"></a><span id="l13.7" class="difflineplus">+ * Version: MPL 1.1/GPL 2.0/LGPL 2.1</span>
<a href="#l13.8"></a><span id="l13.8" class="difflineplus">+ *</span>
<a href="#l13.9"></a><span id="l13.9" class="difflineplus">+ * The contents of this file are subject to the Mozilla Public License Version</span>
<a href="#l13.10"></a><span id="l13.10" class="difflineplus">+ * 1.1 (the &quot;License&quot;); you may not use this file except in compliance with</span>
<a href="#l13.11"></a><span id="l13.11" class="difflineplus">+ * the License. You may obtain a copy of the License at</span>
<a href="#l13.12"></a><span id="l13.12" class="difflineplus">+ * http://www.mozilla.org/MPL/</span>
<a href="#l13.13"></a><span id="l13.13" class="difflineplus">+ *</span>
<a href="#l13.14"></a><span id="l13.14" class="difflineplus">+ * Software distributed under the License is distributed on an &quot;AS IS&quot; basis,</span>
<a href="#l13.15"></a><span id="l13.15" class="difflineplus">+ * WITHOUT WARRANTY OF ANY KIND, either express or implied. See the License</span>
<a href="#l13.16"></a><span id="l13.16" class="difflineplus">+ * for the specific language governing rights and limitations under the</span>
<a href="#l13.17"></a><span id="l13.17" class="difflineplus">+ * License.</span>
<a href="#l13.18"></a><span id="l13.18" class="difflineplus">+ *</span>
<a href="#l13.19"></a><span id="l13.19" class="difflineplus">+ * The Original Code is Mozilla Places Organizer.</span>
<a href="#l13.20"></a><span id="l13.20" class="difflineplus">+ *</span>
<a href="#l13.21"></a><span id="l13.21" class="difflineplus">+ * The Initial Developer of the Original Code is Google Inc.</span>
<a href="#l13.22"></a><span id="l13.22" class="difflineplus">+ * Portions created by the Initial Developer are Copyright (C) 2005-2006</span>
<a href="#l13.23"></a><span id="l13.23" class="difflineplus">+ * the Initial Developer. All Rights Reserved.</span>
<a href="#l13.24"></a><span id="l13.24" class="difflineplus">+ *</span>
<a href="#l13.25"></a><span id="l13.25" class="difflineplus">+ * Contributor(s):</span>
<a href="#l13.26"></a><span id="l13.26" class="difflineplus">+ *   Ben Goodger &lt;beng@google.com&gt;</span>
<a href="#l13.27"></a><span id="l13.27" class="difflineplus">+ *   Annie Sullivan &lt;annie.sullivan@gmail.com&gt;</span>
<a href="#l13.28"></a><span id="l13.28" class="difflineplus">+ *   Asaf Romano &lt;mano@mozilla.com&gt;</span>
<a href="#l13.29"></a><span id="l13.29" class="difflineplus">+ *   Ehsan Akhgari &lt;ehsan.akhgari@gmail.com&gt;</span>
<a href="#l13.30"></a><span id="l13.30" class="difflineplus">+ *   Robert Kaiser &lt;kairo@kairo.at&gt;</span>
<a href="#l13.31"></a><span id="l13.31" class="difflineplus">+ *</span>
<a href="#l13.32"></a><span id="l13.32" class="difflineplus">+ * Alternatively, the contents of this file may be used under the terms of</span>
<a href="#l13.33"></a><span id="l13.33" class="difflineplus">+ * either the GNU General Public License Version 2 or later (the &quot;GPL&quot;), or</span>
<a href="#l13.34"></a><span id="l13.34" class="difflineplus">+ * the GNU Lesser General Public License Version 2.1 or later (the &quot;LGPL&quot;),</span>
<a href="#l13.35"></a><span id="l13.35" class="difflineplus">+ * in which case the provisions of the GPL or the LGPL are applicable instead</span>
<a href="#l13.36"></a><span id="l13.36" class="difflineplus">+ * of those above. If you wish to allow use of your version of this file only</span>
<a href="#l13.37"></a><span id="l13.37" class="difflineplus">+ * under the terms of either the GPL or the LGPL, and not to allow others to</span>
<a href="#l13.38"></a><span id="l13.38" class="difflineplus">+ * use your version of this file under the terms of the MPL, indicate your</span>
<a href="#l13.39"></a><span id="l13.39" class="difflineplus">+ * decision by deleting the provisions above and replace them with the notice</span>
<a href="#l13.40"></a><span id="l13.40" class="difflineplus">+ * and other provisions required by the GPL or the LGPL. If you do not delete</span>
<a href="#l13.41"></a><span id="l13.41" class="difflineplus">+ * the provisions above, a recipient may use your version of this file under</span>
<a href="#l13.42"></a><span id="l13.42" class="difflineplus">+ * the terms of any one of the MPL, the GPL or the LGPL.</span>
<a href="#l13.43"></a><span id="l13.43" class="difflineplus">+ *</span>
<a href="#l13.44"></a><span id="l13.44" class="difflineplus">+ * ***** END LICENSE BLOCK ***** */</span>
<a href="#l13.45"></a><span id="l13.45" class="difflineplus">+</span>
<a href="#l13.46"></a><span id="l13.46" class="difflineplus">+var PlacesOrganizer = {</span>
<a href="#l13.47"></a><span id="l13.47" class="difflineplus">+  _content: null,</span>
<a href="#l13.48"></a><span id="l13.48" class="difflineplus">+</span>
<a href="#l13.49"></a><span id="l13.49" class="difflineplus">+  init: function PO_init() {</span>
<a href="#l13.50"></a><span id="l13.50" class="difflineplus">+    this._content = document.getElementById(&quot;placeContent&quot;);</span>
<a href="#l13.51"></a><span id="l13.51" class="difflineplus">+</span>
<a href="#l13.52"></a><span id="l13.52" class="difflineplus">+    var view = this._content.treeBoxObject.view;</span>
<a href="#l13.53"></a><span id="l13.53" class="difflineplus">+    if (view.rowCount &gt; 0)</span>
<a href="#l13.54"></a><span id="l13.54" class="difflineplus">+      view.selection.select(0);</span>
<a href="#l13.55"></a><span id="l13.55" class="difflineplus">+</span>
<a href="#l13.56"></a><span id="l13.56" class="difflineplus">+    // do an initial load of the tree with history content</span>
<a href="#l13.57"></a><span id="l13.57" class="difflineplus">+    var query = PlacesUtils.history.getNewQuery();</span>
<a href="#l13.58"></a><span id="l13.58" class="difflineplus">+    var options = PlacesUtils.history.getNewQueryOptions();</span>
<a href="#l13.59"></a><span id="l13.59" class="difflineplus">+    query.searchTerms = &quot;&quot;;</span>
<a href="#l13.60"></a><span id="l13.60" class="difflineplus">+    options.queryType = Components.interfaces.nsINavHistoryQueryOptions</span>
<a href="#l13.61"></a><span id="l13.61" class="difflineplus">+                                  .QUERY_TYPE_HISTORY;</span>
<a href="#l13.62"></a><span id="l13.62" class="difflineplus">+    this._content.load([query], options);</span>
<a href="#l13.63"></a><span id="l13.63" class="difflineplus">+</span>
<a href="#l13.64"></a><span id="l13.64" class="difflineplus">+    this._content.focus();</span>
<a href="#l13.65"></a><span id="l13.65" class="difflineplus">+</span>
<a href="#l13.66"></a><span id="l13.66" class="difflineplus">+    window.addEventListener(&quot;AppCommand&quot;, this, true);</span>
<a href="#l13.67"></a><span id="l13.67" class="difflineplus">+  },</span>
<a href="#l13.68"></a><span id="l13.68" class="difflineplus">+</span>
<a href="#l13.69"></a><span id="l13.69" class="difflineplus">+  QueryInterface: function PO_QueryInterface(aIID) {</span>
<a href="#l13.70"></a><span id="l13.70" class="difflineplus">+    if (aIID.equals(Components.interfaces.nsIDOMEventListener) ||</span>
<a href="#l13.71"></a><span id="l13.71" class="difflineplus">+        aIID.equals(Components.interfaces.nsISupports))</span>
<a href="#l13.72"></a><span id="l13.72" class="difflineplus">+      return this;</span>
<a href="#l13.73"></a><span id="l13.73" class="difflineplus">+</span>
<a href="#l13.74"></a><span id="l13.74" class="difflineplus">+    throw Components.results.NS_NOINTERFACE;</span>
<a href="#l13.75"></a><span id="l13.75" class="difflineplus">+  },</span>
<a href="#l13.76"></a><span id="l13.76" class="difflineplus">+</span>
<a href="#l13.77"></a><span id="l13.77" class="difflineplus">+  handleEvent: function PO_handleEvent(aEvent) {</span>
<a href="#l13.78"></a><span id="l13.78" class="difflineplus">+    if (aEvent.type != &quot;AppCommand&quot;)</span>
<a href="#l13.79"></a><span id="l13.79" class="difflineplus">+      return;</span>
<a href="#l13.80"></a><span id="l13.80" class="difflineplus">+</span>
<a href="#l13.81"></a><span id="l13.81" class="difflineplus">+    aEvent.stopPropagation();</span>
<a href="#l13.82"></a><span id="l13.82" class="difflineplus">+    switch (aEvent.command) {</span>
<a href="#l13.83"></a><span id="l13.83" class="difflineplus">+      case &quot;Search&quot;:</span>
<a href="#l13.84"></a><span id="l13.84" class="difflineplus">+        PlacesSearchBox.findAll();</span>
<a href="#l13.85"></a><span id="l13.85" class="difflineplus">+        break;</span>
<a href="#l13.86"></a><span id="l13.86" class="difflineplus">+    }</span>
<a href="#l13.87"></a><span id="l13.87" class="difflineplus">+  },</span>
<a href="#l13.88"></a><span id="l13.88" class="difflineplus">+</span>
<a href="#l13.89"></a><span id="l13.89" class="difflineplus">+  destroy: function PO_destroy() {</span>
<a href="#l13.90"></a><span id="l13.90" class="difflineplus">+  },</span>
<a href="#l13.91"></a><span id="l13.91" class="difflineplus">+</span>
<a href="#l13.92"></a><span id="l13.92" class="difflineplus">+  _location: null,</span>
<a href="#l13.93"></a><span id="l13.93" class="difflineplus">+  get location() {</span>
<a href="#l13.94"></a><span id="l13.94" class="difflineplus">+    return this._location;</span>
<a href="#l13.95"></a><span id="l13.95" class="difflineplus">+  },</span>
<a href="#l13.96"></a><span id="l13.96" class="difflineplus">+</span>
<a href="#l13.97"></a><span id="l13.97" class="difflineplus">+  set location(aLocation) {</span>
<a href="#l13.98"></a><span id="l13.98" class="difflineplus">+    if (!aLocation || this._location == aLocation)</span>
<a href="#l13.99"></a><span id="l13.99" class="difflineplus">+      return aLocation;</span>
<a href="#l13.100"></a><span id="l13.100" class="difflineplus">+</span>
<a href="#l13.101"></a><span id="l13.101" class="difflineplus">+    this._location = aLocation;</span>
<a href="#l13.102"></a><span id="l13.102" class="difflineplus">+    // just load place: uri directly</span>
<a href="#l13.103"></a><span id="l13.103" class="difflineplus">+    this._content.place = aLocation;</span>
<a href="#l13.104"></a><span id="l13.104" class="difflineplus">+</span>
<a href="#l13.105"></a><span id="l13.105" class="difflineplus">+    return aLocation;</span>
<a href="#l13.106"></a><span id="l13.106" class="difflineplus">+  },</span>
<a href="#l13.107"></a><span id="l13.107" class="difflineplus">+</span>
<a href="#l13.108"></a><span id="l13.108" class="difflineplus">+  /**</span>
<a href="#l13.109"></a><span id="l13.109" class="difflineplus">+   * Handle clicks on the tree. If the user middle clicks on a URL, load that</span>
<a href="#l13.110"></a><span id="l13.110" class="difflineplus">+   * URL according to rules. Single clicks or modified clicks do not result in</span>
<a href="#l13.111"></a><span id="l13.111" class="difflineplus">+   * any special action, since they're related to selection.</span>
<a href="#l13.112"></a><span id="l13.112" class="difflineplus">+   * @param   aEvent</span>
<a href="#l13.113"></a><span id="l13.113" class="difflineplus">+   *          The mouse event.</span>
<a href="#l13.114"></a><span id="l13.114" class="difflineplus">+   */</span>
<a href="#l13.115"></a><span id="l13.115" class="difflineplus">+  onTreeClick: function PO_onTreeClick(aEvent) {</span>
<a href="#l13.116"></a><span id="l13.116" class="difflineplus">+    if (aEvent.target.localName != &quot;treechildren&quot;)</span>
<a href="#l13.117"></a><span id="l13.117" class="difflineplus">+      return;</span>
<a href="#l13.118"></a><span id="l13.118" class="difflineplus">+</span>
<a href="#l13.119"></a><span id="l13.119" class="difflineplus">+    var currentView = aEvent.currentTarget;</span>
<a href="#l13.120"></a><span id="l13.120" class="difflineplus">+    var selectedNode = currentView.selectedNode;</span>
<a href="#l13.121"></a><span id="l13.121" class="difflineplus">+    if (selectedNode &amp;&amp; aEvent.button == 1) {</span>
<a href="#l13.122"></a><span id="l13.122" class="difflineplus">+      if (PlacesUtils.nodeIsURI(selectedNode))</span>
<a href="#l13.123"></a><span id="l13.123" class="difflineplus">+        PlacesUIUtils.openNodeWithEvent(selectedNode, aEvent);</span>
<a href="#l13.124"></a><span id="l13.124" class="difflineplus">+      else if (PlacesUtils.nodeIsContainer(selectedNode)) {</span>
<a href="#l13.125"></a><span id="l13.125" class="difflineplus">+        // The command execution function will take care of seeing the</span>
<a href="#l13.126"></a><span id="l13.126" class="difflineplus">+        // selection is a folder/container and loading its contents in</span>
<a href="#l13.127"></a><span id="l13.127" class="difflineplus">+        // tabs for us.</span>
<a href="#l13.128"></a><span id="l13.128" class="difflineplus">+        PlacesUIUtils.openContainerNodeInTabs(selectedNode, aEvent);</span>
<a href="#l13.129"></a><span id="l13.129" class="difflineplus">+      }</span>
<a href="#l13.130"></a><span id="l13.130" class="difflineplus">+    }</span>
<a href="#l13.131"></a><span id="l13.131" class="difflineplus">+  },</span>
<a href="#l13.132"></a><span id="l13.132" class="difflineplus">+</span>
<a href="#l13.133"></a><span id="l13.133" class="difflineplus">+  /**</span>
<a href="#l13.134"></a><span id="l13.134" class="difflineplus">+   * Handle focus changes on the trees.</span>
<a href="#l13.135"></a><span id="l13.135" class="difflineplus">+   * When moving focus between panes we should update the details pane contents.</span>
<a href="#l13.136"></a><span id="l13.136" class="difflineplus">+   * @param   aEvent</span>
<a href="#l13.137"></a><span id="l13.137" class="difflineplus">+   *          The mouse event.</span>
<a href="#l13.138"></a><span id="l13.138" class="difflineplus">+   */</span>
<a href="#l13.139"></a><span id="l13.139" class="difflineplus">+  onTreeFocus: function PO_onTreeFocus(aEvent) {</span>
<a href="#l13.140"></a><span id="l13.140" class="difflineplus">+  },</span>
<a href="#l13.141"></a><span id="l13.141" class="difflineplus">+</span>
<a href="#l13.142"></a><span id="l13.142" class="difflineplus">+  openSelectedNode: function PU_openSelectedNode(aEvent) {</span>
<a href="#l13.143"></a><span id="l13.143" class="difflineplus">+    PlacesUIUtils.openNodeWithEvent(this._content.selectedNode, aEvent);</span>
<a href="#l13.144"></a><span id="l13.144" class="difflineplus">+  },</span>
<a href="#l13.145"></a><span id="l13.145" class="difflineplus">+</span>
<a href="#l13.146"></a><span id="l13.146" class="difflineplus">+  /**</span>
<a href="#l13.147"></a><span id="l13.147" class="difflineplus">+   * Returns the options associated with the query currently loaded in the</span>
<a href="#l13.148"></a><span id="l13.148" class="difflineplus">+   * main places pane.</span>
<a href="#l13.149"></a><span id="l13.149" class="difflineplus">+   */</span>
<a href="#l13.150"></a><span id="l13.150" class="difflineplus">+  getCurrentOptions: function PO_getCurrentOptions() {</span>
<a href="#l13.151"></a><span id="l13.151" class="difflineplus">+    return asQuery(this._content.getResult().root).queryOptions;</span>
<a href="#l13.152"></a><span id="l13.152" class="difflineplus">+  },</span>
<a href="#l13.153"></a><span id="l13.153" class="difflineplus">+</span>
<a href="#l13.154"></a><span id="l13.154" class="difflineplus">+  /**</span>
<a href="#l13.155"></a><span id="l13.155" class="difflineplus">+   * Returns the queries associated with the query currently loaded in the</span>
<a href="#l13.156"></a><span id="l13.156" class="difflineplus">+   * main places pane.</span>
<a href="#l13.157"></a><span id="l13.157" class="difflineplus">+   */</span>
<a href="#l13.158"></a><span id="l13.158" class="difflineplus">+  getCurrentQueries: function PO_getCurrentQueries() {</span>
<a href="#l13.159"></a><span id="l13.159" class="difflineplus">+    return asQuery(this._content.getResult().root).getQueries({});</span>
<a href="#l13.160"></a><span id="l13.160" class="difflineplus">+  },</span>
<a href="#l13.161"></a><span id="l13.161" class="difflineplus">+</span>
<a href="#l13.162"></a><span id="l13.162" class="difflineplus">+  _showErrorAlert: function PO__showErrorAlert(aMsg) {</span>
<a href="#l13.163"></a><span id="l13.163" class="difflineplus">+    var brandShortName = document.getElementById(&quot;brandStrings&quot;).</span>
<a href="#l13.164"></a><span id="l13.164" class="difflineplus">+                                  getString(&quot;brandShortName&quot;);</span>
<a href="#l13.165"></a><span id="l13.165" class="difflineplus">+</span>
<a href="#l13.166"></a><span id="l13.166" class="difflineplus">+    Components.classes[&quot;@mozilla.org/embedcomp/prompt-service;1&quot;]</span>
<a href="#l13.167"></a><span id="l13.167" class="difflineplus">+              .getService(Components.interfaces.nsIPromptService)</span>
<a href="#l13.168"></a><span id="l13.168" class="difflineplus">+              .alert(window, brandShortName, aMsg);</span>
<a href="#l13.169"></a><span id="l13.169" class="difflineplus">+  },</span>
<a href="#l13.170"></a><span id="l13.170" class="difflineplus">+};</span>
<a href="#l13.171"></a><span id="l13.171" class="difflineplus">+</span>
<a href="#l13.172"></a><span id="l13.172" class="difflineplus">+/**</span>
<a href="#l13.173"></a><span id="l13.173" class="difflineplus">+ * A set of utilities relating to search within Bookmarks and History.</span>
<a href="#l13.174"></a><span id="l13.174" class="difflineplus">+ */</span>
<a href="#l13.175"></a><span id="l13.175" class="difflineplus">+var PlacesSearchBox = {</span>
<a href="#l13.176"></a><span id="l13.176" class="difflineplus">+</span>
<a href="#l13.177"></a><span id="l13.177" class="difflineplus">+  /**</span>
<a href="#l13.178"></a><span id="l13.178" class="difflineplus">+   * The Search text field</span>
<a href="#l13.179"></a><span id="l13.179" class="difflineplus">+   */</span>
<a href="#l13.180"></a><span id="l13.180" class="difflineplus">+  get searchFilter() {</span>
<a href="#l13.181"></a><span id="l13.181" class="difflineplus">+    return document.getElementById(&quot;searchFilter&quot;);</span>
<a href="#l13.182"></a><span id="l13.182" class="difflineplus">+  },</span>
<a href="#l13.183"></a><span id="l13.183" class="difflineplus">+</span>
<a href="#l13.184"></a><span id="l13.184" class="difflineplus">+  /**</span>
<a href="#l13.185"></a><span id="l13.185" class="difflineplus">+   * Folders to include when searching.</span>
<a href="#l13.186"></a><span id="l13.186" class="difflineplus">+   */</span>
<a href="#l13.187"></a><span id="l13.187" class="difflineplus">+  _folders: [],</span>
<a href="#l13.188"></a><span id="l13.188" class="difflineplus">+  get folders() {</span>
<a href="#l13.189"></a><span id="l13.189" class="difflineplus">+    if (this._folders.length == 0)</span>
<a href="#l13.190"></a><span id="l13.190" class="difflineplus">+      this._folders.push(PlacesUtils.bookmarksMenuFolderId,</span>
<a href="#l13.191"></a><span id="l13.191" class="difflineplus">+                         PlacesUtils.unfiledBookmarksFolderId,</span>
<a href="#l13.192"></a><span id="l13.192" class="difflineplus">+                         PlacesUtils.toolbarFolderId);</span>
<a href="#l13.193"></a><span id="l13.193" class="difflineplus">+    return this._folders;</span>
<a href="#l13.194"></a><span id="l13.194" class="difflineplus">+  },</span>
<a href="#l13.195"></a><span id="l13.195" class="difflineplus">+  set folders(aFolders) {</span>
<a href="#l13.196"></a><span id="l13.196" class="difflineplus">+    this._folders = aFolders;</span>
<a href="#l13.197"></a><span id="l13.197" class="difflineplus">+    return aFolders;</span>
<a href="#l13.198"></a><span id="l13.198" class="difflineplus">+  },</span>
<a href="#l13.199"></a><span id="l13.199" class="difflineplus">+</span>
<a href="#l13.200"></a><span id="l13.200" class="difflineplus">+  /**</span>
<a href="#l13.201"></a><span id="l13.201" class="difflineplus">+   * Run a search for the specified text, over the collection specified by</span>
<a href="#l13.202"></a><span id="l13.202" class="difflineplus">+   * the dropdown arrow. The default is all bookmarks, but can be</span>
<a href="#l13.203"></a><span id="l13.203" class="difflineplus">+   * localized to the active collection.</span>
<a href="#l13.204"></a><span id="l13.204" class="difflineplus">+   * @param   filterString</span>
<a href="#l13.205"></a><span id="l13.205" class="difflineplus">+   *          The text to search for.</span>
<a href="#l13.206"></a><span id="l13.206" class="difflineplus">+   */</span>
<a href="#l13.207"></a><span id="l13.207" class="difflineplus">+  search: function PSB_search(filterString) {</span>
<a href="#l13.208"></a><span id="l13.208" class="difflineplus">+    var PO = PlacesOrganizer;</span>
<a href="#l13.209"></a><span id="l13.209" class="difflineplus">+</span>
<a href="#l13.210"></a><span id="l13.210" class="difflineplus">+    var currentOptions = PO.getCurrentOptions();</span>
<a href="#l13.211"></a><span id="l13.211" class="difflineplus">+    var content = PO._content;</span>
<a href="#l13.212"></a><span id="l13.212" class="difflineplus">+</span>
<a href="#l13.213"></a><span id="l13.213" class="difflineplus">+      if (currentOptions.queryType != Components.interfaces.nsINavHistoryQueryOptions.QUERY_TYPE_HISTORY) {</span>
<a href="#l13.214"></a><span id="l13.214" class="difflineplus">+        var query = PlacesUtils.history.getNewQuery();</span>
<a href="#l13.215"></a><span id="l13.215" class="difflineplus">+        query.searchTerms = filterString;</span>
<a href="#l13.216"></a><span id="l13.216" class="difflineplus">+        var options = currentOptions.clone();</span>
<a href="#l13.217"></a><span id="l13.217" class="difflineplus">+        options.queryType = Components.interfaces.nsINavHistoryQueryOptions</span>
<a href="#l13.218"></a><span id="l13.218" class="difflineplus">+                                      .QUERY_TYPE_HISTORY;</span>
<a href="#l13.219"></a><span id="l13.219" class="difflineplus">+        content.load([query], options);</span>
<a href="#l13.220"></a><span id="l13.220" class="difflineplus">+      }</span>
<a href="#l13.221"></a><span id="l13.221" class="difflineplus">+      else</span>
<a href="#l13.222"></a><span id="l13.222" class="difflineplus">+        content.applyFilter(filterString);</span>
<a href="#l13.223"></a><span id="l13.223" class="difflineplus">+  },</span>
<a href="#l13.224"></a><span id="l13.224" class="difflineplus">+</span>
<a href="#l13.225"></a><span id="l13.225" class="difflineplus">+  /**</span>
<a href="#l13.226"></a><span id="l13.226" class="difflineplus">+   * Focus the search box</span>
<a href="#l13.227"></a><span id="l13.227" class="difflineplus">+   */</span>
<a href="#l13.228"></a><span id="l13.228" class="difflineplus">+  focus: function PSB_focus() {</span>
<a href="#l13.229"></a><span id="l13.229" class="difflineplus">+    this.searchFilter.focus();</span>
<a href="#l13.230"></a><span id="l13.230" class="difflineplus">+  },</span>
<a href="#l13.231"></a><span id="l13.231" class="difflineplus">+</span>
<a href="#l13.232"></a><span id="l13.232" class="difflineplus">+  /**</span>
<a href="#l13.233"></a><span id="l13.233" class="difflineplus">+   * Gets or sets the text shown in the Places Search Box</span>
<a href="#l13.234"></a><span id="l13.234" class="difflineplus">+   */</span>
<a href="#l13.235"></a><span id="l13.235" class="difflineplus">+  get value() {</span>
<a href="#l13.236"></a><span id="l13.236" class="difflineplus">+    return this.searchFilter.value;</span>
<a href="#l13.237"></a><span id="l13.237" class="difflineplus">+  },</span>
<a href="#l13.238"></a><span id="l13.238" class="difflineplus">+  set value(value) {</span>
<a href="#l13.239"></a><span id="l13.239" class="difflineplus">+    return this.searchFilter.value = value;</span>
<a href="#l13.240"></a><span id="l13.240" class="difflineplus">+  },</span>
<a href="#l13.241"></a><span id="l13.241" class="difflineplus">+};</span>
<a href="#l13.242"></a><span id="l13.242" class="difflineplus">+</span>
<a href="#l13.243"></a><span id="l13.243" class="difflineplus">+/**</span>
<a href="#l13.244"></a><span id="l13.244" class="difflineplus">+ * Population and commands for the View Menu.</span>
<a href="#l13.245"></a><span id="l13.245" class="difflineplus">+ */</span>
<a href="#l13.246"></a><span id="l13.246" class="difflineplus">+var ViewMenu = {</span>
<a href="#l13.247"></a><span id="l13.247" class="difflineplus">+  /**</span>
<a href="#l13.248"></a><span id="l13.248" class="difflineplus">+   * Removes content generated previously from a menupopup.</span>
<a href="#l13.249"></a><span id="l13.249" class="difflineplus">+   * @param   popup</span>
<a href="#l13.250"></a><span id="l13.250" class="difflineplus">+   *          The popup that contains the previously generated content.</span>
<a href="#l13.251"></a><span id="l13.251" class="difflineplus">+   * @param   startID</span>
<a href="#l13.252"></a><span id="l13.252" class="difflineplus">+   *          The id attribute of an element that is the start of the</span>
<a href="#l13.253"></a><span id="l13.253" class="difflineplus">+   *          dynamically generated region - remove elements after this</span>
<a href="#l13.254"></a><span id="l13.254" class="difflineplus">+   *          item only.</span>
<a href="#l13.255"></a><span id="l13.255" class="difflineplus">+   *          Must be contained by popup. Can be null (in which case the</span>
<a href="#l13.256"></a><span id="l13.256" class="difflineplus">+   *          contents of popup are removed).</span>
<a href="#l13.257"></a><span id="l13.257" class="difflineplus">+   * @param   endID</span>
<a href="#l13.258"></a><span id="l13.258" class="difflineplus">+   *          The id attribute of an element that is the end of the</span>
<a href="#l13.259"></a><span id="l13.259" class="difflineplus">+   *          dynamically generated region - remove elements up to this</span>
<a href="#l13.260"></a><span id="l13.260" class="difflineplus">+   *          item only.</span>
<a href="#l13.261"></a><span id="l13.261" class="difflineplus">+   *          Must be contained by popup. Can be null (in which case all</span>
<a href="#l13.262"></a><span id="l13.262" class="difflineplus">+   *          items until the end of the popup will be removed). Ignored</span>
<a href="#l13.263"></a><span id="l13.263" class="difflineplus">+   *          if startID is null.</span>
<a href="#l13.264"></a><span id="l13.264" class="difflineplus">+   * @returns The element for the caller to insert new items before,</span>
<a href="#l13.265"></a><span id="l13.265" class="difflineplus">+   *          null if the caller should just append to the popup.</span>
<a href="#l13.266"></a><span id="l13.266" class="difflineplus">+   */</span>
<a href="#l13.267"></a><span id="l13.267" class="difflineplus">+  _clean: function VM__clean(popup, startID, endID) {</span>
<a href="#l13.268"></a><span id="l13.268" class="difflineplus">+    if (endID)</span>
<a href="#l13.269"></a><span id="l13.269" class="difflineplus">+      NS_ASSERT(startID, &quot;meaningless to have valid endID and null startID&quot;);</span>
<a href="#l13.270"></a><span id="l13.270" class="difflineplus">+    if (startID) {</span>
<a href="#l13.271"></a><span id="l13.271" class="difflineplus">+      var startElement = document.getElementById(startID);</span>
<a href="#l13.272"></a><span id="l13.272" class="difflineplus">+      NS_ASSERT(startElement.parentNode ==</span>
<a href="#l13.273"></a><span id="l13.273" class="difflineplus">+                popup, &quot;startElement is not in popup&quot;);</span>
<a href="#l13.274"></a><span id="l13.274" class="difflineplus">+      NS_ASSERT(startElement,</span>
<a href="#l13.275"></a><span id="l13.275" class="difflineplus">+                &quot;startID does not correspond to an existing element&quot;);</span>
<a href="#l13.276"></a><span id="l13.276" class="difflineplus">+      var endElement = null;</span>
<a href="#l13.277"></a><span id="l13.277" class="difflineplus">+      if (endID) {</span>
<a href="#l13.278"></a><span id="l13.278" class="difflineplus">+        endElement = document.getElementById(endID);</span>
<a href="#l13.279"></a><span id="l13.279" class="difflineplus">+        NS_ASSERT(endElement.parentNode == popup,</span>
<a href="#l13.280"></a><span id="l13.280" class="difflineplus">+                  &quot;endElement is not in popup&quot;);</span>
<a href="#l13.281"></a><span id="l13.281" class="difflineplus">+        NS_ASSERT(endElement,</span>
<a href="#l13.282"></a><span id="l13.282" class="difflineplus">+                  &quot;endID does not correspond to an existing element&quot;);</span>
<a href="#l13.283"></a><span id="l13.283" class="difflineplus">+      }</span>
<a href="#l13.284"></a><span id="l13.284" class="difflineplus">+      while (startElement.nextSibling != endElement)</span>
<a href="#l13.285"></a><span id="l13.285" class="difflineplus">+        popup.removeChild(startElement.nextSibling);</span>
<a href="#l13.286"></a><span id="l13.286" class="difflineplus">+      return endElement;</span>
<a href="#l13.287"></a><span id="l13.287" class="difflineplus">+    }</span>
<a href="#l13.288"></a><span id="l13.288" class="difflineplus">+    else {</span>
<a href="#l13.289"></a><span id="l13.289" class="difflineplus">+      while(popup.hasChildNodes())</span>
<a href="#l13.290"></a><span id="l13.290" class="difflineplus">+        popup.removeChild(popup.firstChild);</span>
<a href="#l13.291"></a><span id="l13.291" class="difflineplus">+    }</span>
<a href="#l13.292"></a><span id="l13.292" class="difflineplus">+    return null;</span>
<a href="#l13.293"></a><span id="l13.293" class="difflineplus">+  },</span>
<a href="#l13.294"></a><span id="l13.294" class="difflineplus">+</span>
<a href="#l13.295"></a><span id="l13.295" class="difflineplus">+  /**</span>
<a href="#l13.296"></a><span id="l13.296" class="difflineplus">+   * Fills a menupopup with a list of columns</span>
<a href="#l13.297"></a><span id="l13.297" class="difflineplus">+   * @param   event</span>
<a href="#l13.298"></a><span id="l13.298" class="difflineplus">+   *          The popupshowing event that invoked this function.</span>
<a href="#l13.299"></a><span id="l13.299" class="difflineplus">+   * @param   startID</span>
<a href="#l13.300"></a><span id="l13.300" class="difflineplus">+   *          see _clean</span>
<a href="#l13.301"></a><span id="l13.301" class="difflineplus">+   * @param   endID</span>
<a href="#l13.302"></a><span id="l13.302" class="difflineplus">+   *          see _clean</span>
<a href="#l13.303"></a><span id="l13.303" class="difflineplus">+   * @param   type</span>
<a href="#l13.304"></a><span id="l13.304" class="difflineplus">+   *          the type of the menuitem, e.g. &quot;radio&quot; or &quot;checkbox&quot;.</span>
<a href="#l13.305"></a><span id="l13.305" class="difflineplus">+   *          Can be null (no-type).</span>
<a href="#l13.306"></a><span id="l13.306" class="difflineplus">+   *          Checkboxes are checked if the column is visible.</span>
<a href="#l13.307"></a><span id="l13.307" class="difflineplus">+   * @param   propertyPrefix</span>
<a href="#l13.308"></a><span id="l13.308" class="difflineplus">+   *          If propertyPrefix is non-null:</span>
<a href="#l13.309"></a><span id="l13.309" class="difflineplus">+   *          propertyPrefix + column ID + &quot;.label&quot; will be used to get the</span>
<a href="#l13.310"></a><span id="l13.310" class="difflineplus">+   *          localized label string.</span>
<a href="#l13.311"></a><span id="l13.311" class="difflineplus">+   *          propertyPrefix + column ID + &quot;.accesskey&quot; will be used to get the</span>
<a href="#l13.312"></a><span id="l13.312" class="difflineplus">+   *          localized accesskey.</span>
<a href="#l13.313"></a><span id="l13.313" class="difflineplus">+   *          If propertyPrefix is null, the column label is used as label and</span>
<a href="#l13.314"></a><span id="l13.314" class="difflineplus">+   *          no accesskey is assigned.</span>
<a href="#l13.315"></a><span id="l13.315" class="difflineplus">+   */</span>
<a href="#l13.316"></a><span id="l13.316" class="difflineplus">+  fillWithColumns: function VM_fillWithColumns(event, startID, endID, type, propertyPrefix) {</span>
<a href="#l13.317"></a><span id="l13.317" class="difflineplus">+    var popup = event.target;</span>
<a href="#l13.318"></a><span id="l13.318" class="difflineplus">+    var pivot = this._clean(popup, startID, endID);</span>
<a href="#l13.319"></a><span id="l13.319" class="difflineplus">+</span>
<a href="#l13.320"></a><span id="l13.320" class="difflineplus">+    // If no column is &quot;sort-active&quot;, the &quot;Unsorted&quot; item needs to be checked,</span>
<a href="#l13.321"></a><span id="l13.321" class="difflineplus">+    // so track whether or not we find a column that is sort-active.</span>
<a href="#l13.322"></a><span id="l13.322" class="difflineplus">+    var isSorted = false;</span>
<a href="#l13.323"></a><span id="l13.323" class="difflineplus">+    var content = document.getElementById(&quot;placeContent&quot;);</span>
<a href="#l13.324"></a><span id="l13.324" class="difflineplus">+    var columns = content.columns;</span>
<a href="#l13.325"></a><span id="l13.325" class="difflineplus">+    for (var i = 0; i &lt; columns.count; ++i) {</span>
<a href="#l13.326"></a><span id="l13.326" class="difflineplus">+      var column = columns.getColumnAt(i).element;</span>
<a href="#l13.327"></a><span id="l13.327" class="difflineplus">+      var menuitem = document.createElement(&quot;menuitem&quot;);</span>
<a href="#l13.328"></a><span id="l13.328" class="difflineplus">+      menuitem.id = &quot;menucol_&quot; + column.id;</span>
<a href="#l13.329"></a><span id="l13.329" class="difflineplus">+      menuitem.column = column;</span>
<a href="#l13.330"></a><span id="l13.330" class="difflineplus">+      var label = column.getAttribute(&quot;label&quot;);</span>
<a href="#l13.331"></a><span id="l13.331" class="difflineplus">+      if (propertyPrefix) {</span>
<a href="#l13.332"></a><span id="l13.332" class="difflineplus">+        var menuitemPrefix = propertyPrefix;</span>
<a href="#l13.333"></a><span id="l13.333" class="difflineplus">+        // for string properties, use &quot;name&quot; as the id, instead of &quot;title&quot;</span>
<a href="#l13.334"></a><span id="l13.334" class="difflineplus">+        // see bug #386287 for details</span>
<a href="#l13.335"></a><span id="l13.335" class="difflineplus">+        var columnId = column.getAttribute(&quot;anonid&quot;);</span>
<a href="#l13.336"></a><span id="l13.336" class="difflineplus">+        menuitemPrefix += columnId == &quot;title&quot; ? &quot;name&quot; : columnId;</span>
<a href="#l13.337"></a><span id="l13.337" class="difflineplus">+        label = PlacesUIUtils.getString(menuitemPrefix + &quot;.label&quot;);</span>
<a href="#l13.338"></a><span id="l13.338" class="difflineplus">+        var accesskey = PlacesUIUtils.getString(menuitemPrefix + &quot;.accesskey&quot;);</span>
<a href="#l13.339"></a><span id="l13.339" class="difflineplus">+        menuitem.setAttribute(&quot;accesskey&quot;, accesskey);</span>
<a href="#l13.340"></a><span id="l13.340" class="difflineplus">+      }</span>
<a href="#l13.341"></a><span id="l13.341" class="difflineplus">+      menuitem.setAttribute(&quot;label&quot;, label);</span>
<a href="#l13.342"></a><span id="l13.342" class="difflineplus">+      if (type == &quot;radio&quot;) {</span>
<a href="#l13.343"></a><span id="l13.343" class="difflineplus">+        menuitem.setAttribute(&quot;type&quot;, &quot;radio&quot;);</span>
<a href="#l13.344"></a><span id="l13.344" class="difflineplus">+        menuitem.setAttribute(&quot;name&quot;, &quot;columns&quot;);</span>
<a href="#l13.345"></a><span id="l13.345" class="difflineplus">+        // This column is the sort key. Its item is checked.</span>
<a href="#l13.346"></a><span id="l13.346" class="difflineplus">+        if (column.getAttribute(&quot;sortDirection&quot;) != &quot;&quot;) {</span>
<a href="#l13.347"></a><span id="l13.347" class="difflineplus">+          menuitem.setAttribute(&quot;checked&quot;, &quot;true&quot;);</span>
<a href="#l13.348"></a><span id="l13.348" class="difflineplus">+          isSorted = true;</span>
<a href="#l13.349"></a><span id="l13.349" class="difflineplus">+        }</span>
<a href="#l13.350"></a><span id="l13.350" class="difflineplus">+      }</span>
<a href="#l13.351"></a><span id="l13.351" class="difflineplus">+      else if (type == &quot;checkbox&quot;) {</span>
<a href="#l13.352"></a><span id="l13.352" class="difflineplus">+        menuitem.setAttribute(&quot;type&quot;, &quot;checkbox&quot;);</span>
<a href="#l13.353"></a><span id="l13.353" class="difflineplus">+        // Cannot uncheck the primary column.</span>
<a href="#l13.354"></a><span id="l13.354" class="difflineplus">+        if (column.getAttribute(&quot;primary&quot;) == &quot;true&quot;)</span>
<a href="#l13.355"></a><span id="l13.355" class="difflineplus">+          menuitem.setAttribute(&quot;disabled&quot;, &quot;true&quot;);</span>
<a href="#l13.356"></a><span id="l13.356" class="difflineplus">+        // Items for visible columns are checked.</span>
<a href="#l13.357"></a><span id="l13.357" class="difflineplus">+        if (!column.hidden)</span>
<a href="#l13.358"></a><span id="l13.358" class="difflineplus">+          menuitem.setAttribute(&quot;checked&quot;, &quot;true&quot;);</span>
<a href="#l13.359"></a><span id="l13.359" class="difflineplus">+      }</span>
<a href="#l13.360"></a><span id="l13.360" class="difflineplus">+      if (pivot)</span>
<a href="#l13.361"></a><span id="l13.361" class="difflineplus">+        popup.insertBefore(menuitem, pivot);</span>
<a href="#l13.362"></a><span id="l13.362" class="difflineplus">+      else</span>
<a href="#l13.363"></a><span id="l13.363" class="difflineplus">+        popup.appendChild(menuitem);</span>
<a href="#l13.364"></a><span id="l13.364" class="difflineplus">+    }</span>
<a href="#l13.365"></a><span id="l13.365" class="difflineplus">+    event.stopPropagation();</span>
<a href="#l13.366"></a><span id="l13.366" class="difflineplus">+  },</span>
<a href="#l13.367"></a><span id="l13.367" class="difflineplus">+</span>
<a href="#l13.368"></a><span id="l13.368" class="difflineplus">+  /**</span>
<a href="#l13.369"></a><span id="l13.369" class="difflineplus">+   * Set up the content of the view menu.</span>
<a href="#l13.370"></a><span id="l13.370" class="difflineplus">+   */</span>
<a href="#l13.371"></a><span id="l13.371" class="difflineplus">+  populateSortMenu: function VM_populateSortMenu(event) {</span>
<a href="#l13.372"></a><span id="l13.372" class="difflineplus">+    this.fillWithColumns(event, &quot;viewUnsorted&quot;, &quot;directionSeparator&quot;, &quot;radio&quot;, &quot;view.sortBy.&quot;);</span>
<a href="#l13.373"></a><span id="l13.373" class="difflineplus">+</span>
<a href="#l13.374"></a><span id="l13.374" class="difflineplus">+    var sortColumn = this._getSortColumn();</span>
<a href="#l13.375"></a><span id="l13.375" class="difflineplus">+    var viewSortAscending = document.getElementById(&quot;viewSortAscending&quot;);</span>
<a href="#l13.376"></a><span id="l13.376" class="difflineplus">+    var viewSortDescending = document.getElementById(&quot;viewSortDescending&quot;);</span>
<a href="#l13.377"></a><span id="l13.377" class="difflineplus">+    // We need to remove an existing checked attribute because the unsorted</span>
<a href="#l13.378"></a><span id="l13.378" class="difflineplus">+    // menu item is not rebuilt every time we open the menu like the others.</span>
<a href="#l13.379"></a><span id="l13.379" class="difflineplus">+    var viewUnsorted = document.getElementById(&quot;viewUnsorted&quot;);</span>
<a href="#l13.380"></a><span id="l13.380" class="difflineplus">+    if (!sortColumn) {</span>
<a href="#l13.381"></a><span id="l13.381" class="difflineplus">+      viewSortAscending.removeAttribute(&quot;checked&quot;);</span>
<a href="#l13.382"></a><span id="l13.382" class="difflineplus">+      viewSortDescending.removeAttribute(&quot;checked&quot;);</span>
<a href="#l13.383"></a><span id="l13.383" class="difflineplus">+      viewUnsorted.setAttribute(&quot;checked&quot;, &quot;true&quot;);</span>
<a href="#l13.384"></a><span id="l13.384" class="difflineplus">+    }</span>
<a href="#l13.385"></a><span id="l13.385" class="difflineplus">+    else if (sortColumn.getAttribute(&quot;sortDirection&quot;) == &quot;ascending&quot;) {</span>
<a href="#l13.386"></a><span id="l13.386" class="difflineplus">+      viewSortAscending.setAttribute(&quot;checked&quot;, &quot;true&quot;);</span>
<a href="#l13.387"></a><span id="l13.387" class="difflineplus">+      viewSortDescending.removeAttribute(&quot;checked&quot;);</span>
<a href="#l13.388"></a><span id="l13.388" class="difflineplus">+      viewUnsorted.removeAttribute(&quot;checked&quot;);</span>
<a href="#l13.389"></a><span id="l13.389" class="difflineplus">+    }</span>
<a href="#l13.390"></a><span id="l13.390" class="difflineplus">+    else if (sortColumn.getAttribute(&quot;sortDirection&quot;) == &quot;descending&quot;) {</span>
<a href="#l13.391"></a><span id="l13.391" class="difflineplus">+      viewSortDescending.setAttribute(&quot;checked&quot;, &quot;true&quot;);</span>
<a href="#l13.392"></a><span id="l13.392" class="difflineplus">+      viewSortAscending.removeAttribute(&quot;checked&quot;);</span>
<a href="#l13.393"></a><span id="l13.393" class="difflineplus">+      viewUnsorted.removeAttribute(&quot;checked&quot;);</span>
<a href="#l13.394"></a><span id="l13.394" class="difflineplus">+    }</span>
<a href="#l13.395"></a><span id="l13.395" class="difflineplus">+  },</span>
<a href="#l13.396"></a><span id="l13.396" class="difflineplus">+</span>
<a href="#l13.397"></a><span id="l13.397" class="difflineplus">+  /**</span>
<a href="#l13.398"></a><span id="l13.398" class="difflineplus">+   * Shows/Hides a tree column.</span>
<a href="#l13.399"></a><span id="l13.399" class="difflineplus">+   * @param   element</span>
<a href="#l13.400"></a><span id="l13.400" class="difflineplus">+   *          The menuitem element for the column</span>
<a href="#l13.401"></a><span id="l13.401" class="difflineplus">+   */</span>
<a href="#l13.402"></a><span id="l13.402" class="difflineplus">+  showHideColumn: function VM_showHideColumn(element) {</span>
<a href="#l13.403"></a><span id="l13.403" class="difflineplus">+    var column = element.column;</span>
<a href="#l13.404"></a><span id="l13.404" class="difflineplus">+</span>
<a href="#l13.405"></a><span id="l13.405" class="difflineplus">+    if (element.getAttribute(&quot;checked&quot;) == &quot;true&quot;) {</span>
<a href="#l13.406"></a><span id="l13.406" class="difflineplus">+      column.setAttribute(&quot;hidden&quot;, &quot;false&quot;);</span>
<a href="#l13.407"></a><span id="l13.407" class="difflineplus">+    }</span>
<a href="#l13.408"></a><span id="l13.408" class="difflineplus">+    else {</span>
<a href="#l13.409"></a><span id="l13.409" class="difflineplus">+      column.setAttribute(&quot;hidden&quot;, &quot;true&quot;);</span>
<a href="#l13.410"></a><span id="l13.410" class="difflineplus">+    }</span>
<a href="#l13.411"></a><span id="l13.411" class="difflineplus">+  },</span>
<a href="#l13.412"></a><span id="l13.412" class="difflineplus">+</span>
<a href="#l13.413"></a><span id="l13.413" class="difflineplus">+  /**</span>
<a href="#l13.414"></a><span id="l13.414" class="difflineplus">+   * Gets the last column that was sorted.</span>
<a href="#l13.415"></a><span id="l13.415" class="difflineplus">+   * @returns  the currently sorted column, null if there is no sorted column.</span>
<a href="#l13.416"></a><span id="l13.416" class="difflineplus">+   */</span>
<a href="#l13.417"></a><span id="l13.417" class="difflineplus">+  _getSortColumn: function VM__getSortColumn() {</span>
<a href="#l13.418"></a><span id="l13.418" class="difflineplus">+    var content = document.getElementById(&quot;placeContent&quot;);</span>
<a href="#l13.419"></a><span id="l13.419" class="difflineplus">+    var cols = content.columns;</span>
<a href="#l13.420"></a><span id="l13.420" class="difflineplus">+    for (var i = 0; i &lt; cols.count; ++i) {</span>
<a href="#l13.421"></a><span id="l13.421" class="difflineplus">+      var column = cols.getColumnAt(i).element;</span>
<a href="#l13.422"></a><span id="l13.422" class="difflineplus">+      var sortDirection = column.getAttribute(&quot;sortDirection&quot;);</span>
<a href="#l13.423"></a><span id="l13.423" class="difflineplus">+      if (sortDirection == &quot;ascending&quot; || sortDirection == &quot;descending&quot;)</span>
<a href="#l13.424"></a><span id="l13.424" class="difflineplus">+        return column;</span>
<a href="#l13.425"></a><span id="l13.425" class="difflineplus">+    }</span>
<a href="#l13.426"></a><span id="l13.426" class="difflineplus">+    return null;</span>
<a href="#l13.427"></a><span id="l13.427" class="difflineplus">+  },</span>
<a href="#l13.428"></a><span id="l13.428" class="difflineplus">+</span>
<a href="#l13.429"></a><span id="l13.429" class="difflineplus">+  /**</span>
<a href="#l13.430"></a><span id="l13.430" class="difflineplus">+   * Sorts the view by the specified column.</span>
<a href="#l13.431"></a><span id="l13.431" class="difflineplus">+   * @param   aColumn</span>
<a href="#l13.432"></a><span id="l13.432" class="difflineplus">+   *          The colum that is the sort key. Can be null - the</span>
<a href="#l13.433"></a><span id="l13.433" class="difflineplus">+   *          current sort column or the title column will be used.</span>
<a href="#l13.434"></a><span id="l13.434" class="difflineplus">+   * @param   aDirection</span>
<a href="#l13.435"></a><span id="l13.435" class="difflineplus">+   *          The direction to sort - &quot;ascending&quot; or &quot;descending&quot;.</span>
<a href="#l13.436"></a><span id="l13.436" class="difflineplus">+   *          Can be null - the last direction or descending will be used.</span>
<a href="#l13.437"></a><span id="l13.437" class="difflineplus">+   *</span>
<a href="#l13.438"></a><span id="l13.438" class="difflineplus">+   * If both aColumnID and aDirection are null, the view will be unsorted.</span>
<a href="#l13.439"></a><span id="l13.439" class="difflineplus">+   */</span>
<a href="#l13.440"></a><span id="l13.440" class="difflineplus">+  setSortColumn: function VM_setSortColumn(aColumn, aDirection) {</span>
<a href="#l13.441"></a><span id="l13.441" class="difflineplus">+    var result = document.getElementById(&quot;placeContent&quot;).getResult();</span>
<a href="#l13.442"></a><span id="l13.442" class="difflineplus">+    if (!aColumn &amp;&amp; !aDirection) {</span>
<a href="#l13.443"></a><span id="l13.443" class="difflineplus">+      result.sortingMode = Components.interfaces.nsINavHistoryQueryOptions</span>
<a href="#l13.444"></a><span id="l13.444" class="difflineplus">+                                     .SORT_BY_NONE;</span>
<a href="#l13.445"></a><span id="l13.445" class="difflineplus">+      return;</span>
<a href="#l13.446"></a><span id="l13.446" class="difflineplus">+    }</span>
<a href="#l13.447"></a><span id="l13.447" class="difflineplus">+</span>
<a href="#l13.448"></a><span id="l13.448" class="difflineplus">+    var columnId;</span>
<a href="#l13.449"></a><span id="l13.449" class="difflineplus">+    if (aColumn) {</span>
<a href="#l13.450"></a><span id="l13.450" class="difflineplus">+      columnId = aColumn.getAttribute(&quot;anonid&quot;)</span>
<a href="#l13.451"></a><span id="l13.451" class="difflineplus">+      if (!aDirection) {</span>
<a href="#l13.452"></a><span id="l13.452" class="difflineplus">+        var sortColumn = this._getSortColumn();</span>
<a href="#l13.453"></a><span id="l13.453" class="difflineplus">+        aDirection = sortColumn ?</span>
<a href="#l13.454"></a><span id="l13.454" class="difflineplus">+                     sortColumn.getAttribute(&quot;sortDirection&quot;) : &quot;descending&quot;;</span>
<a href="#l13.455"></a><span id="l13.455" class="difflineplus">+      }</span>
<a href="#l13.456"></a><span id="l13.456" class="difflineplus">+    }</span>
<a href="#l13.457"></a><span id="l13.457" class="difflineplus">+    else {</span>
<a href="#l13.458"></a><span id="l13.458" class="difflineplus">+      var sortColumn = this._getSortColumn();</span>
<a href="#l13.459"></a><span id="l13.459" class="difflineplus">+      columnId = sortColumn ? sortColumn.getAttribute(&quot;anonid&quot;) : &quot;title&quot;;</span>
<a href="#l13.460"></a><span id="l13.460" class="difflineplus">+    }</span>
<a href="#l13.461"></a><span id="l13.461" class="difflineplus">+</span>
<a href="#l13.462"></a><span id="l13.462" class="difflineplus">+    var sortingMode;</span>
<a href="#l13.463"></a><span id="l13.463" class="difflineplus">+    var sortingAnnotation = &quot;&quot;;</span>
<a href="#l13.464"></a><span id="l13.464" class="difflineplus">+    const NHQO = Components.interfaces.nsINavHistoryQueryOptions;</span>
<a href="#l13.465"></a><span id="l13.465" class="difflineplus">+    switch (columnId) {</span>
<a href="#l13.466"></a><span id="l13.466" class="difflineplus">+      case &quot;title&quot;:</span>
<a href="#l13.467"></a><span id="l13.467" class="difflineplus">+        sortingMode = aDirection == &quot;descending&quot; ?</span>
<a href="#l13.468"></a><span id="l13.468" class="difflineplus">+          NHQO.SORT_BY_TITLE_DESCENDING : NHQO.SORT_BY_TITLE_ASCENDING;</span>
<a href="#l13.469"></a><span id="l13.469" class="difflineplus">+        break;</span>
<a href="#l13.470"></a><span id="l13.470" class="difflineplus">+      case &quot;url&quot;:</span>
<a href="#l13.471"></a><span id="l13.471" class="difflineplus">+        sortingMode = aDirection == &quot;descending&quot; ?</span>
<a href="#l13.472"></a><span id="l13.472" class="difflineplus">+          NHQO.SORT_BY_URI_DESCENDING : NHQO.SORT_BY_URI_ASCENDING;</span>
<a href="#l13.473"></a><span id="l13.473" class="difflineplus">+        break;</span>
<a href="#l13.474"></a><span id="l13.474" class="difflineplus">+      case &quot;date&quot;:</span>
<a href="#l13.475"></a><span id="l13.475" class="difflineplus">+        sortingMode = aDirection == &quot;descending&quot; ?</span>
<a href="#l13.476"></a><span id="l13.476" class="difflineplus">+          NHQO.SORT_BY_DATE_DESCENDING : NHQO.SORT_BY_DATE_ASCENDING;</span>
<a href="#l13.477"></a><span id="l13.477" class="difflineplus">+        break;</span>
<a href="#l13.478"></a><span id="l13.478" class="difflineplus">+      case &quot;visitCount&quot;:</span>
<a href="#l13.479"></a><span id="l13.479" class="difflineplus">+        sortingMode = aDirection == &quot;descending&quot; ?</span>
<a href="#l13.480"></a><span id="l13.480" class="difflineplus">+          NHQO.SORT_BY_VISITCOUNT_DESCENDING : NHQO.SORT_BY_VISITCOUNT_ASCENDING;</span>
<a href="#l13.481"></a><span id="l13.481" class="difflineplus">+        break;</span>
<a href="#l13.482"></a><span id="l13.482" class="difflineplus">+      default:</span>
<a href="#l13.483"></a><span id="l13.483" class="difflineplus">+        throw(&quot;Invalid Column&quot;);</span>
<a href="#l13.484"></a><span id="l13.484" class="difflineplus">+    }</span>
<a href="#l13.485"></a><span id="l13.485" class="difflineplus">+    result.sortingAnnotation = sortingAnnotation;</span>
<a href="#l13.486"></a><span id="l13.486" class="difflineplus">+    result.sortingMode = sortingMode;</span>
<a href="#l13.487"></a><span id="l13.487" class="difflineplus">+  }</span>
<a href="#l13.488"></a><span id="l13.488" class="difflineplus">+};</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l14.1"></a><span id="l14.1">new file mode 100644</span>
<a href="#l14.2"></a><span id="l14.2" class="difflineminus">--- /dev/null</span>
<a href="#l14.3"></a><span id="l14.3" class="difflineplus">+++ b/suite/common/history/placesOverlay.xul</span>
<a href="#l14.4"></a><span id="l14.4" class="difflineat">@@ -0,0 +1,130 @@</span>
<a href="#l14.5"></a><span id="l14.5" class="difflineplus">+&lt;!-- ***** BEGIN LICENSE BLOCK *****</span>
<a href="#l14.6"></a><span id="l14.6" class="difflineplus">+   - Version: MPL 1.1/GPL 2.0/LGPL 2.1</span>
<a href="#l14.7"></a><span id="l14.7" class="difflineplus">+   -</span>
<a href="#l14.8"></a><span id="l14.8" class="difflineplus">+   - The contents of this file are subject to the Mozilla Public License Version</span>
<a href="#l14.9"></a><span id="l14.9" class="difflineplus">+   - 1.1 (the &quot;License&quot;); you may not use this file except in compliance with</span>
<a href="#l14.10"></a><span id="l14.10" class="difflineplus">+   - the License. You may obtain a copy of the License at</span>
<a href="#l14.11"></a><span id="l14.11" class="difflineplus">+   - http://www.mozilla.org/MPL/</span>
<a href="#l14.12"></a><span id="l14.12" class="difflineplus">+   -</span>
<a href="#l14.13"></a><span id="l14.13" class="difflineplus">+   - Software distributed under the License is distributed on an &quot;AS IS&quot; basis,</span>
<a href="#l14.14"></a><span id="l14.14" class="difflineplus">+   - WITHOUT WARRANTY OF ANY KIND, either express or implied. See the License</span>
<a href="#l14.15"></a><span id="l14.15" class="difflineplus">+   - for the specific language governing rights and limitations under the</span>
<a href="#l14.16"></a><span id="l14.16" class="difflineplus">+   - License.</span>
<a href="#l14.17"></a><span id="l14.17" class="difflineplus">+   -</span>
<a href="#l14.18"></a><span id="l14.18" class="difflineplus">+   - The Original Code is mozilla.org code.</span>
<a href="#l14.19"></a><span id="l14.19" class="difflineplus">+   -</span>
<a href="#l14.20"></a><span id="l14.20" class="difflineplus">+   - The Initial Developer of the Original Code is</span>
<a href="#l14.21"></a><span id="l14.21" class="difflineplus">+   - Netscape Communications Corporation.</span>
<a href="#l14.22"></a><span id="l14.22" class="difflineplus">+   - Portions created by the Initial Developer are Copyright (C) 1998</span>
<a href="#l14.23"></a><span id="l14.23" class="difflineplus">+   - the Initial Developer. All Rights Reserved.</span>
<a href="#l14.24"></a><span id="l14.24" class="difflineplus">+   -</span>
<a href="#l14.25"></a><span id="l14.25" class="difflineplus">+   - Contributor(s):</span>
<a href="#l14.26"></a><span id="l14.26" class="difflineplus">+   -   Ben Goodger &lt;beng@google.com&gt;</span>
<a href="#l14.27"></a><span id="l14.27" class="difflineplus">+   -   Asaf Romano &lt;mano@mozilla.com&gt;</span>
<a href="#l14.28"></a><span id="l14.28" class="difflineplus">+   -   Robert Kaiser &lt;kairo@kairo.at&gt;</span>
<a href="#l14.29"></a><span id="l14.29" class="difflineplus">+   -</span>
<a href="#l14.30"></a><span id="l14.30" class="difflineplus">+   - Alternatively, the contents of this file may be used under the terms of</span>
<a href="#l14.31"></a><span id="l14.31" class="difflineplus">+   - either the GNU General Public License Version 2 or later (the &quot;GPL&quot;), or</span>
<a href="#l14.32"></a><span id="l14.32" class="difflineplus">+   - the GNU Lesser General Public License Version 2.1 or later (the &quot;LGPL&quot;),</span>
<a href="#l14.33"></a><span id="l14.33" class="difflineplus">+   - in which case the provisions of the GPL or the LGPL are applicable instead</span>
<a href="#l14.34"></a><span id="l14.34" class="difflineplus">+   - of those above. If you wish to allow use of your version of this file only</span>
<a href="#l14.35"></a><span id="l14.35" class="difflineplus">+   - under the terms of either the GPL or the LGPL, and not to allow others to</span>
<a href="#l14.36"></a><span id="l14.36" class="difflineplus">+   - use your version of this file under the terms of the MPL, indicate your</span>
<a href="#l14.37"></a><span id="l14.37" class="difflineplus">+   - decision by deleting the provisions above and replace them with the notice</span>
<a href="#l14.38"></a><span id="l14.38" class="difflineplus">+   - and other provisions required by the LGPL or the GPL. If you do not delete</span>
<a href="#l14.39"></a><span id="l14.39" class="difflineplus">+   - the provisions above, a recipient may use your version of this file under</span>
<a href="#l14.40"></a><span id="l14.40" class="difflineplus">+   - the terms of any one of the MPL, the GPL or the LGPL.</span>
<a href="#l14.41"></a><span id="l14.41" class="difflineplus">+   -</span>
<a href="#l14.42"></a><span id="l14.42" class="difflineplus">+   - ***** END LICENSE BLOCK ***** --&gt;</span>
<a href="#l14.43"></a><span id="l14.43" class="difflineplus">+</span>
<a href="#l14.44"></a><span id="l14.44" class="difflineplus">+&lt;!DOCTYPE overlay [</span>
<a href="#l14.45"></a><span id="l14.45" class="difflineplus">+&lt;!ENTITY % historyDTD SYSTEM &quot;chrome://communicator/locale/history/history.dtd&quot;&gt;</span>
<a href="#l14.46"></a><span id="l14.46" class="difflineplus">+%historyDTD;</span>
<a href="#l14.47"></a><span id="l14.47" class="difflineplus">+&lt;!ENTITY % editMenuOverlayDTD SYSTEM &quot;chrome://global/locale/editMenuOverlay.dtd&quot;&gt;</span>
<a href="#l14.48"></a><span id="l14.48" class="difflineplus">+%editMenuOverlayDTD;</span>
<a href="#l14.49"></a><span id="l14.49" class="difflineplus">+]&gt;</span>
<a href="#l14.50"></a><span id="l14.50" class="difflineplus">+</span>
<a href="#l14.51"></a><span id="l14.51" class="difflineplus">+&lt;overlay id=&quot;placesOverlay&quot;</span>
<a href="#l14.52"></a><span id="l14.52" class="difflineplus">+         xmlns:rdf=&quot;http://www.w3.org/1999/02/22-rdf-syntax-ns#&quot;</span>
<a href="#l14.53"></a><span id="l14.53" class="difflineplus">+         xmlns=&quot;http://www.mozilla.org/keymaster/gatekeeper/there.is.only.xul&quot;&gt;</span>
<a href="#l14.54"></a><span id="l14.54" class="difflineplus">+</span>
<a href="#l14.55"></a><span id="l14.55" class="difflineplus">+  &lt;script type=&quot;application/x-javascript&quot;</span>
<a href="#l14.56"></a><span id="l14.56" class="difflineplus">+          src=&quot;chrome://global/content/globalOverlay.js&quot;/&gt;</span>
<a href="#l14.57"></a><span id="l14.57" class="difflineplus">+  &lt;script type=&quot;application/x-javascript&quot;</span>
<a href="#l14.58"></a><span id="l14.58" class="difflineplus">+          src=&quot;chrome://communicator/content/history/utils.js&quot;/&gt;</span>
<a href="#l14.59"></a><span id="l14.59" class="difflineplus">+  &lt;script type=&quot;application/x-javascript&quot;</span>
<a href="#l14.60"></a><span id="l14.60" class="difflineplus">+          src=&quot;chrome://communicator/content/history/controller.js&quot;/&gt;</span>
<a href="#l14.61"></a><span id="l14.61" class="difflineplus">+  &lt;script type=&quot;application/x-javascript&quot;</span>
<a href="#l14.62"></a><span id="l14.62" class="difflineplus">+          src=&quot;chrome://communicator/content/history/treeView.js&quot;/&gt;</span>
<a href="#l14.63"></a><span id="l14.63" class="difflineplus">+  &lt;script type=&quot;application/x-javascript&quot;</span>
<a href="#l14.64"></a><span id="l14.64" class="difflineplus">+          src=&quot;chrome://global/content/nsDragAndDrop.js&quot;/&gt;</span>
<a href="#l14.65"></a><span id="l14.65" class="difflineplus">+</span>
<a href="#l14.66"></a><span id="l14.66" class="difflineplus">+  &lt;commandset id=&quot;placesCommands&quot;</span>
<a href="#l14.67"></a><span id="l14.67" class="difflineplus">+              commandupdater=&quot;true&quot;</span>
<a href="#l14.68"></a><span id="l14.68" class="difflineplus">+              events=&quot;focus,sort&quot;</span>
<a href="#l14.69"></a><span id="l14.69" class="difflineplus">+              oncommandupdate=&quot;goUpdatePlacesCommands();&quot;&gt;</span>
<a href="#l14.70"></a><span id="l14.70" class="difflineplus">+    &lt;command id=&quot;placesCmd_open&quot;</span>
<a href="#l14.71"></a><span id="l14.71" class="difflineplus">+             oncommand=&quot;goDoCommand('placesCmd_open');&quot;/&gt;</span>
<a href="#l14.72"></a><span id="l14.72" class="difflineplus">+    &lt;command id=&quot;placesCmd_open:window&quot;</span>
<a href="#l14.73"></a><span id="l14.73" class="difflineplus">+             oncommand=&quot;goDoCommand('placesCmd_open:window');&quot;/&gt;</span>
<a href="#l14.74"></a><span id="l14.74" class="difflineplus">+    &lt;command id=&quot;placesCmd_open:tab&quot;</span>
<a href="#l14.75"></a><span id="l14.75" class="difflineplus">+             oncommand=&quot;goDoCommand('placesCmd_open:tab');&quot;/&gt;</span>
<a href="#l14.76"></a><span id="l14.76" class="difflineplus">+    &lt;command id=&quot;placesCmd_sortBy:name&quot;</span>
<a href="#l14.77"></a><span id="l14.77" class="difflineplus">+             oncommand=&quot;goDoCommand('placesCmd_sortBy:name');&quot;/&gt;</span>
<a href="#l14.78"></a><span id="l14.78" class="difflineplus">+  &lt;/commandset&gt;</span>
<a href="#l14.79"></a><span id="l14.79" class="difflineplus">+</span>
<a href="#l14.80"></a><span id="l14.80" class="difflineplus">+  &lt;popup id=&quot;placesContext&quot;</span>
<a href="#l14.81"></a><span id="l14.81" class="difflineplus">+         onpopupshowing=&quot;this._view = PlacesUIUtils.getViewForNode(document.popupNode);</span>
<a href="#l14.82"></a><span id="l14.82" class="difflineplus">+                         return this._view.buildContextMenu(this);&quot;</span>
<a href="#l14.83"></a><span id="l14.83" class="difflineplus">+         onpopuphiding=&quot;this._view.destroyContextMenu();&quot;&gt;</span>
<a href="#l14.84"></a><span id="l14.84" class="difflineplus">+    &lt;menuitem id=&quot;placesContext_open&quot;</span>
<a href="#l14.85"></a><span id="l14.85" class="difflineplus">+              command=&quot;placesCmd_open&quot;</span>
<a href="#l14.86"></a><span id="l14.86" class="difflineplus">+              label=&quot;&amp;cmd.open.label;&quot;</span>
<a href="#l14.87"></a><span id="l14.87" class="difflineplus">+              accesskey=&quot;&amp;cmd.open.accesskey;&quot;</span>
<a href="#l14.88"></a><span id="l14.88" class="difflineplus">+              default=&quot;true&quot;</span>
<a href="#l14.89"></a><span id="l14.89" class="difflineplus">+              selectiontype=&quot;single&quot;</span>
<a href="#l14.90"></a><span id="l14.90" class="difflineplus">+              selection=&quot;link&quot;/&gt;</span>
<a href="#l14.91"></a><span id="l14.91" class="difflineplus">+    &lt;menuitem id=&quot;placesContext_open:newwindow&quot;</span>
<a href="#l14.92"></a><span id="l14.92" class="difflineplus">+              command=&quot;placesCmd_open:window&quot;</span>
<a href="#l14.93"></a><span id="l14.93" class="difflineplus">+              label=&quot;&amp;cmd.open_window.label;&quot;</span>
<a href="#l14.94"></a><span id="l14.94" class="difflineplus">+              accesskey=&quot;&amp;cmd.open_window.accesskey;&quot;</span>
<a href="#l14.95"></a><span id="l14.95" class="difflineplus">+              selectiontype=&quot;single&quot;</span>
<a href="#l14.96"></a><span id="l14.96" class="difflineplus">+              selection=&quot;link&quot;/&gt;</span>
<a href="#l14.97"></a><span id="l14.97" class="difflineplus">+    &lt;menuitem id=&quot;placesContext_open:newtab&quot;</span>
<a href="#l14.98"></a><span id="l14.98" class="difflineplus">+              command=&quot;placesCmd_open:tab&quot;</span>
<a href="#l14.99"></a><span id="l14.99" class="difflineplus">+              label=&quot;&amp;cmd.open_tab.label;&quot;</span>
<a href="#l14.100"></a><span id="l14.100" class="difflineplus">+              accesskey=&quot;&amp;cmd.open_tab.accesskey;&quot;</span>
<a href="#l14.101"></a><span id="l14.101" class="difflineplus">+              selectiontype=&quot;single&quot;</span>
<a href="#l14.102"></a><span id="l14.102" class="difflineplus">+              selection=&quot;link&quot;/&gt;</span>
<a href="#l14.103"></a><span id="l14.103" class="difflineplus">+    &lt;menuitem id=&quot;placesContext_openLinks:tabs&quot;</span>
<a href="#l14.104"></a><span id="l14.104" class="difflineplus">+              oncommand=&quot;var view = PlacesUIUtils.getViewForNode(document.popupNode);</span>
<a href="#l14.105"></a><span id="l14.105" class="difflineplus">+                         view.controller.openSelectionInTabs(event);&quot;</span>
<a href="#l14.106"></a><span id="l14.106" class="difflineplus">+              onclick=&quot;checkForMiddleClick(this, event);&quot;</span>
<a href="#l14.107"></a><span id="l14.107" class="difflineplus">+              label=&quot;&amp;cmd.open_all_in_tabs.label;&quot;</span>
<a href="#l14.108"></a><span id="l14.108" class="difflineplus">+              accesskey=&quot;&amp;cmd.open_all_in_tabs.accesskey;&quot;</span>
<a href="#l14.109"></a><span id="l14.109" class="difflineplus">+              selectiontype=&quot;multiple&quot;</span>
<a href="#l14.110"></a><span id="l14.110" class="difflineplus">+              selection=&quot;link&quot;/&gt;</span>
<a href="#l14.111"></a><span id="l14.111" class="difflineplus">+    &lt;menuseparator id=&quot;placesContext_openSeparator&quot;/&gt;</span>
<a href="#l14.112"></a><span id="l14.112" class="difflineplus">+    &lt;menuitem id=&quot;addBookmarkContextItem&quot;</span>
<a href="#l14.113"></a><span id="l14.113" class="difflineplus">+              label=&quot;&amp;bookmarkCmd.label;&quot;</span>
<a href="#l14.114"></a><span id="l14.114" class="difflineplus">+              accesskey=&quot;&amp;bookmarkCmd.accesskey;&quot;</span>
<a href="#l14.115"></a><span id="l14.115" class="difflineplus">+              selection=&quot;link&quot;</span>
<a href="#l14.116"></a><span id="l14.116" class="difflineplus">+              selectiontype=&quot;single&quot;</span>
<a href="#l14.117"></a><span id="l14.117" class="difflineplus">+              oncommand=&quot;historyAddBookmarks();&quot;/&gt;</span>
<a href="#l14.118"></a><span id="l14.118" class="difflineplus">+    &lt;menuitem id=&quot;placesContext_copy&quot;</span>
<a href="#l14.119"></a><span id="l14.119" class="difflineplus">+              command=&quot;cmd_copy&quot;</span>
<a href="#l14.120"></a><span id="l14.120" class="difflineplus">+              label=&quot;&amp;copyCmd.label;&quot;</span>
<a href="#l14.121"></a><span id="l14.121" class="difflineplus">+              closemenu=&quot;single&quot;</span>
<a href="#l14.122"></a><span id="l14.122" class="difflineplus">+              accesskey=&quot;&amp;copyCmd.accesskey;&quot;</span>
<a href="#l14.123"></a><span id="l14.123" class="difflineplus">+              selection=&quot;any&quot;/&gt;</span>
<a href="#l14.124"></a><span id="l14.124" class="difflineplus">+    &lt;menuseparator id=&quot;placesContext_editSeparator&quot;/&gt;</span>
<a href="#l14.125"></a><span id="l14.125" class="difflineplus">+    &lt;menuitem id=&quot;placesContext_delete&quot;</span>
<a href="#l14.126"></a><span id="l14.126" class="difflineplus">+              command=&quot;cmd_delete&quot;</span>
<a href="#l14.127"></a><span id="l14.127" class="difflineplus">+              label=&quot;&amp;deleteCmd.label;&quot;</span>
<a href="#l14.128"></a><span id="l14.128" class="difflineplus">+              accesskey=&quot;&amp;deleteCmd.accesskey;&quot;</span>
<a href="#l14.129"></a><span id="l14.129" class="difflineplus">+              closemenu=&quot;single&quot;</span>
<a href="#l14.130"></a><span id="l14.130" class="difflineplus">+              selection=&quot;any&quot;</span>
<a href="#l14.131"></a><span id="l14.131" class="difflineplus">+              forcehideselection=&quot;livemarkChild&quot;/&gt;</span>
<a href="#l14.132"></a><span id="l14.132" class="difflineplus">+  &lt;/popup&gt;</span>
<a href="#l14.133"></a><span id="l14.133" class="difflineplus">+</span>
<a href="#l14.134"></a><span id="l14.134" class="difflineplus">+&lt;/overlay&gt;</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l15.1"></a><span id="l15.1">new file mode 100644</span>
<a href="#l15.2"></a><span id="l15.2" class="difflineminus">--- /dev/null</span>
<a href="#l15.3"></a><span id="l15.3" class="difflineplus">+++ b/suite/common/history/sidebarUtils.js</span>
<a href="#l15.4"></a><span id="l15.4" class="difflineat">@@ -0,0 +1,123 @@</span>
<a href="#l15.5"></a><span id="l15.5" class="difflineplus">+/* -*- Mode: C++; tab-width: 8; indent-tabs-mode: nil; c-basic-offset: 2 -*- */</span>
<a href="#l15.6"></a><span id="l15.6" class="difflineplus">+/* ***** BEGIN LICENSE BLOCK *****</span>
<a href="#l15.7"></a><span id="l15.7" class="difflineplus">+ * Version: MPL 1.1/GPL 2.0/LGPL 2.1</span>
<a href="#l15.8"></a><span id="l15.8" class="difflineplus">+ *</span>
<a href="#l15.9"></a><span id="l15.9" class="difflineplus">+ * The contents of this file are subject to the Mozilla Public License Version</span>
<a href="#l15.10"></a><span id="l15.10" class="difflineplus">+ * 1.1 (the &quot;License&quot;); you may not use this file except in compliance with</span>
<a href="#l15.11"></a><span id="l15.11" class="difflineplus">+ * the License. You may obtain a copy of the License at</span>
<a href="#l15.12"></a><span id="l15.12" class="difflineplus">+ * http://www.mozilla.org/MPL/</span>
<a href="#l15.13"></a><span id="l15.13" class="difflineplus">+ *</span>
<a href="#l15.14"></a><span id="l15.14" class="difflineplus">+ * Software distributed under the License is distributed on an &quot;AS IS&quot; basis,</span>
<a href="#l15.15"></a><span id="l15.15" class="difflineplus">+ * WITHOUT WARRANTY OF ANY KIND, either express or implied. See the License</span>
<a href="#l15.16"></a><span id="l15.16" class="difflineplus">+ * for the specific language governing rights and limitations under the</span>
<a href="#l15.17"></a><span id="l15.17" class="difflineplus">+ * License.</span>
<a href="#l15.18"></a><span id="l15.18" class="difflineplus">+ *</span>
<a href="#l15.19"></a><span id="l15.19" class="difflineplus">+ * The Original Code is Mozilla Places Organizer.</span>
<a href="#l15.20"></a><span id="l15.20" class="difflineplus">+ *</span>
<a href="#l15.21"></a><span id="l15.21" class="difflineplus">+ * The Initial Developer of the Original Code is Google Inc.</span>
<a href="#l15.22"></a><span id="l15.22" class="difflineplus">+ * Portions created by the Initial Developer are Copyright (C) 2005-2006</span>
<a href="#l15.23"></a><span id="l15.23" class="difflineplus">+ * the Initial Developer. All Rights Reserved.</span>
<a href="#l15.24"></a><span id="l15.24" class="difflineplus">+ *</span>
<a href="#l15.25"></a><span id="l15.25" class="difflineplus">+ * Contributor(s):</span>
<a href="#l15.26"></a><span id="l15.26" class="difflineplus">+ *   Dan Mills &lt;thunder@mozilla.com&gt; (Ported from history-panel.js)</span>
<a href="#l15.27"></a><span id="l15.27" class="difflineplus">+ *   Marco Bonardo &lt;mak77@supereva.it&gt;</span>
<a href="#l15.28"></a><span id="l15.28" class="difflineplus">+ *   Robert Kaiser &lt;kairo@kairo.at&gt;</span>
<a href="#l15.29"></a><span id="l15.29" class="difflineplus">+ *</span>
<a href="#l15.30"></a><span id="l15.30" class="difflineplus">+ * Alternatively, the contents of this file may be used under the terms of</span>
<a href="#l15.31"></a><span id="l15.31" class="difflineplus">+ * either the GNU General Public License Version 2 or later (the &quot;GPL&quot;), or</span>
<a href="#l15.32"></a><span id="l15.32" class="difflineplus">+ * the GNU Lesser General Public License Version 2.1 or later (the &quot;LGPL&quot;),</span>
<a href="#l15.33"></a><span id="l15.33" class="difflineplus">+ * in which case the provisions of the GPL or the LGPL are applicable instead</span>
<a href="#l15.34"></a><span id="l15.34" class="difflineplus">+ * of those above. If you wish to allow use of your version of this file only</span>
<a href="#l15.35"></a><span id="l15.35" class="difflineplus">+ * under the terms of either the GPL or the LGPL, and not to allow others to</span>
<a href="#l15.36"></a><span id="l15.36" class="difflineplus">+ * use your version of this file under the terms of the MPL, indicate your</span>
<a href="#l15.37"></a><span id="l15.37" class="difflineplus">+ * decision by deleting the provisions above and replace them with the notice</span>
<a href="#l15.38"></a><span id="l15.38" class="difflineplus">+ * and other provisions required by the GPL or the LGPL. If you do not delete</span>
<a href="#l15.39"></a><span id="l15.39" class="difflineplus">+ * the provisions above, a recipient may use your version of this file under</span>
<a href="#l15.40"></a><span id="l15.40" class="difflineplus">+ * the terms of any one of the MPL, the GPL or the LGPL.</span>
<a href="#l15.41"></a><span id="l15.41" class="difflineplus">+ *</span>
<a href="#l15.42"></a><span id="l15.42" class="difflineplus">+ * ***** END LICENSE BLOCK ***** */</span>
<a href="#l15.43"></a><span id="l15.43" class="difflineplus">+</span>
<a href="#l15.44"></a><span id="l15.44" class="difflineplus">+var SidebarUtils = {</span>
<a href="#l15.45"></a><span id="l15.45" class="difflineplus">+  handleTreeClick: function SU_handleTreeClick(aTree, aEvent, aGutterSelect) {</span>
<a href="#l15.46"></a><span id="l15.46" class="difflineplus">+    // right-clicks are not handled here</span>
<a href="#l15.47"></a><span id="l15.47" class="difflineplus">+    if (aEvent.button == 2)</span>
<a href="#l15.48"></a><span id="l15.48" class="difflineplus">+      return;</span>
<a href="#l15.49"></a><span id="l15.49" class="difflineplus">+</span>
<a href="#l15.50"></a><span id="l15.50" class="difflineplus">+    var tbo = aTree.treeBoxObject;</span>
<a href="#l15.51"></a><span id="l15.51" class="difflineplus">+    var row = { }, col = { }, obj = { };</span>
<a href="#l15.52"></a><span id="l15.52" class="difflineplus">+    tbo.getCellAt(aEvent.clientX, aEvent.clientY, row, col, obj);</span>
<a href="#l15.53"></a><span id="l15.53" class="difflineplus">+</span>
<a href="#l15.54"></a><span id="l15.54" class="difflineplus">+    if (row.value == -1 || obj.value == &quot;twisty&quot;)</span>
<a href="#l15.55"></a><span id="l15.55" class="difflineplus">+      return;</span>
<a href="#l15.56"></a><span id="l15.56" class="difflineplus">+</span>
<a href="#l15.57"></a><span id="l15.57" class="difflineplus">+    var mouseInGutter = false;</span>
<a href="#l15.58"></a><span id="l15.58" class="difflineplus">+    if (aGutterSelect) {</span>
<a href="#l15.59"></a><span id="l15.59" class="difflineplus">+      var x = { }, y = { }, w = { }, h = { };</span>
<a href="#l15.60"></a><span id="l15.60" class="difflineplus">+      tbo.getCoordsForCellItem(row.value, col.value, &quot;image&quot;,</span>
<a href="#l15.61"></a><span id="l15.61" class="difflineplus">+                               x, y, w, h);</span>
<a href="#l15.62"></a><span id="l15.62" class="difflineplus">+      mouseInGutter = aEvent.clientX &lt; x.value;</span>
<a href="#l15.63"></a><span id="l15.63" class="difflineplus">+    }</span>
<a href="#l15.64"></a><span id="l15.64" class="difflineplus">+</span>
<a href="#l15.65"></a><span id="l15.65" class="difflineplus">+    var openWhere = whereToOpenLink(aEvent);</span>
<a href="#l15.66"></a><span id="l15.66" class="difflineplus">+</span>
<a href="#l15.67"></a><span id="l15.67" class="difflineplus">+    var isContainer = tbo.view.isContainer(row.value);</span>
<a href="#l15.68"></a><span id="l15.68" class="difflineplus">+    var openInTabs = isContainer &amp;&amp;</span>
<a href="#l15.69"></a><span id="l15.69" class="difflineplus">+                     (openWhere == &quot;tab&quot; || openWhere == &quot;tabshifted&quot;) &amp;&amp;</span>
<a href="#l15.70"></a><span id="l15.70" class="difflineplus">+                     PlacesUtils.hasChildURIs(tbo.view.nodeForTreeIndex(row.value));</span>
<a href="#l15.71"></a><span id="l15.71" class="difflineplus">+</span>
<a href="#l15.72"></a><span id="l15.72" class="difflineplus">+    if (aEvent.button == 0 &amp;&amp; isContainer &amp;&amp; !openInTabs) {</span>
<a href="#l15.73"></a><span id="l15.73" class="difflineplus">+      tbo.view.toggleOpenState(row.value);</span>
<a href="#l15.74"></a><span id="l15.74" class="difflineplus">+      return;</span>
<a href="#l15.75"></a><span id="l15.75" class="difflineplus">+    }</span>
<a href="#l15.76"></a><span id="l15.76" class="difflineplus">+    else if (!mouseInGutter &amp;&amp; openInTabs &amp;&amp;</span>
<a href="#l15.77"></a><span id="l15.77" class="difflineplus">+            aEvent.originalTarget.localName == &quot;treechildren&quot;) {</span>
<a href="#l15.78"></a><span id="l15.78" class="difflineplus">+      tbo.view.selection.select(row.value);</span>
<a href="#l15.79"></a><span id="l15.79" class="difflineplus">+      PlacesUIUtils.openContainerNodeInTabs(aTree.selectedNode, aEvent);</span>
<a href="#l15.80"></a><span id="l15.80" class="difflineplus">+    }</span>
<a href="#l15.81"></a><span id="l15.81" class="difflineplus">+    else if (!mouseInGutter &amp;&amp; !isContainer &amp;&amp;</span>
<a href="#l15.82"></a><span id="l15.82" class="difflineplus">+             aEvent.originalTarget.localName == &quot;treechildren&quot;) {</span>
<a href="#l15.83"></a><span id="l15.83" class="difflineplus">+      // Clear all other selection since we're loading a link now. We must</span>
<a href="#l15.84"></a><span id="l15.84" class="difflineplus">+      // do this *before* attempting to load the link since openURL uses</span>
<a href="#l15.85"></a><span id="l15.85" class="difflineplus">+      // selection as an indication of which link to load.</span>
<a href="#l15.86"></a><span id="l15.86" class="difflineplus">+      tbo.view.selection.select(row.value);</span>
<a href="#l15.87"></a><span id="l15.87" class="difflineplus">+      PlacesUIUtils.openNodeWithEvent(aTree.selectedNode, aEvent);</span>
<a href="#l15.88"></a><span id="l15.88" class="difflineplus">+    }</span>
<a href="#l15.89"></a><span id="l15.89" class="difflineplus">+  },</span>
<a href="#l15.90"></a><span id="l15.90" class="difflineplus">+</span>
<a href="#l15.91"></a><span id="l15.91" class="difflineplus">+  handleTreeKeyPress: function SU_handleTreeKeyPress(aEvent) {</span>
<a href="#l15.92"></a><span id="l15.92" class="difflineplus">+    if (aEvent.keyCode == KeyEvent.DOM_VK_RETURN)</span>
<a href="#l15.93"></a><span id="l15.93" class="difflineplus">+      PlacesUIUtils.openNodeWithEvent(aEvent.target.selectedNode, aEvent);</span>
<a href="#l15.94"></a><span id="l15.94" class="difflineplus">+  },</span>
<a href="#l15.95"></a><span id="l15.95" class="difflineplus">+</span>
<a href="#l15.96"></a><span id="l15.96" class="difflineplus">+  /**</span>
<a href="#l15.97"></a><span id="l15.97" class="difflineplus">+   * The following function displays the URL of a node that is being</span>
<a href="#l15.98"></a><span id="l15.98" class="difflineplus">+   * hovered over.</span>
<a href="#l15.99"></a><span id="l15.99" class="difflineplus">+   */</span>
<a href="#l15.100"></a><span id="l15.100" class="difflineplus">+  handleTreeMouseMove: function SU_handleTreeMouseMove(aEvent) {</span>
<a href="#l15.101"></a><span id="l15.101" class="difflineplus">+    if (aEvent.target.localName != &quot;treechildren&quot;)</span>
<a href="#l15.102"></a><span id="l15.102" class="difflineplus">+      return;</span>
<a href="#l15.103"></a><span id="l15.103" class="difflineplus">+</span>
<a href="#l15.104"></a><span id="l15.104" class="difflineplus">+    var tree = aEvent.target.parentNode;</span>
<a href="#l15.105"></a><span id="l15.105" class="difflineplus">+    var tbo = tree.treeBoxObject;</span>
<a href="#l15.106"></a><span id="l15.106" class="difflineplus">+    var row = { }, col = { }, obj = { };</span>
<a href="#l15.107"></a><span id="l15.107" class="difflineplus">+    tbo.getCellAt(aEvent.clientX, aEvent.clientY, row, col, obj);</span>
<a href="#l15.108"></a><span id="l15.108" class="difflineplus">+</span>
<a href="#l15.109"></a><span id="l15.109" class="difflineplus">+    // row.value is -1 when the mouse is hovering an empty area within the tree.</span>
<a href="#l15.110"></a><span id="l15.110" class="difflineplus">+    // To avoid showing a URL from a previously hovered node,</span>
<a href="#l15.111"></a><span id="l15.111" class="difflineplus">+    // for a currently hovered non-url node, we must clear the URL from the</span>
<a href="#l15.112"></a><span id="l15.112" class="difflineplus">+    // status bar in these cases.</span>
<a href="#l15.113"></a><span id="l15.113" class="difflineplus">+    if (row.value != -1) {</span>
<a href="#l15.114"></a><span id="l15.114" class="difflineplus">+      var cell = tree.view.nodeForTreeIndex(row.value);</span>
<a href="#l15.115"></a><span id="l15.115" class="difflineplus">+      if (PlacesUtils.nodeIsURI(cell))</span>
<a href="#l15.116"></a><span id="l15.116" class="difflineplus">+        window.top.XULBrowserWindow.setOverLink(cell.uri, null);</span>
<a href="#l15.117"></a><span id="l15.117" class="difflineplus">+      else</span>
<a href="#l15.118"></a><span id="l15.118" class="difflineplus">+        this.clearURLFromStatusBar();</span>
<a href="#l15.119"></a><span id="l15.119" class="difflineplus">+    }</span>
<a href="#l15.120"></a><span id="l15.120" class="difflineplus">+    else</span>
<a href="#l15.121"></a><span id="l15.121" class="difflineplus">+      this.clearURLFromStatusBar();</span>
<a href="#l15.122"></a><span id="l15.122" class="difflineplus">+  },</span>
<a href="#l15.123"></a><span id="l15.123" class="difflineplus">+</span>
<a href="#l15.124"></a><span id="l15.124" class="difflineplus">+  clearURLFromStatusBar: function SU_clearURLFromStatusBar() {</span>
<a href="#l15.125"></a><span id="l15.125" class="difflineplus">+    window.top.XULBrowserWindow.setOverLink(&quot;&quot;, null);</span>
<a href="#l15.126"></a><span id="l15.126" class="difflineplus">+  }</span>
<a href="#l15.127"></a><span id="l15.127" class="difflineplus">+};</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l16.1"></a><span id="l16.1">new file mode 100644</span>
<a href="#l16.2"></a><span id="l16.2" class="difflineminus">--- /dev/null</span>
<a href="#l16.3"></a><span id="l16.3" class="difflineplus">+++ b/suite/common/history/tree.xml</span>
<a href="#l16.4"></a><span id="l16.4" class="difflineat">@@ -0,0 +1,360 @@</span>
<a href="#l16.5"></a><span id="l16.5" class="difflineplus">+&lt;?xml version=&quot;1.0&quot;?&gt;</span>
<a href="#l16.6"></a><span id="l16.6" class="difflineplus">+&lt;!-- ***** BEGIN LICENSE BLOCK *****</span>
<a href="#l16.7"></a><span id="l16.7" class="difflineplus">+   - Version: MPL 1.1/GPL 2.0/LGPL 2.1</span>
<a href="#l16.8"></a><span id="l16.8" class="difflineplus">+   -</span>
<a href="#l16.9"></a><span id="l16.9" class="difflineplus">+   - The contents of this file are subject to the Mozilla Public License Version</span>
<a href="#l16.10"></a><span id="l16.10" class="difflineplus">+   - 1.1 (the &quot;License&quot;); you may not use this file except in compliance with</span>
<a href="#l16.11"></a><span id="l16.11" class="difflineplus">+   - the License. You may obtain a copy of the License at</span>
<a href="#l16.12"></a><span id="l16.12" class="difflineplus">+   - http://www.mozilla.org/MPL/</span>
<a href="#l16.13"></a><span id="l16.13" class="difflineplus">+   -</span>
<a href="#l16.14"></a><span id="l16.14" class="difflineplus">+   - Software distributed under the License is distributed on an &quot;AS IS&quot; basis,</span>
<a href="#l16.15"></a><span id="l16.15" class="difflineplus">+   - WITHOUT WARRANTY OF ANY KIND, either express or implied. See the License</span>
<a href="#l16.16"></a><span id="l16.16" class="difflineplus">+   - for the specific language governing rights and limitations under the</span>
<a href="#l16.17"></a><span id="l16.17" class="difflineplus">+   - License.</span>
<a href="#l16.18"></a><span id="l16.18" class="difflineplus">+   -</span>
<a href="#l16.19"></a><span id="l16.19" class="difflineplus">+   - The Original Code is mozilla.org code.</span>
<a href="#l16.20"></a><span id="l16.20" class="difflineplus">+   -</span>
<a href="#l16.21"></a><span id="l16.21" class="difflineplus">+   - The Initial Developer of the Original Code is</span>
<a href="#l16.22"></a><span id="l16.22" class="difflineplus">+   - Netscape Communications Corporation.</span>
<a href="#l16.23"></a><span id="l16.23" class="difflineplus">+   - Portions created by the Initial Developer are Copyright (C) 1998</span>
<a href="#l16.24"></a><span id="l16.24" class="difflineplus">+   - the Initial Developer. All Rights Reserved.</span>
<a href="#l16.25"></a><span id="l16.25" class="difflineplus">+   -</span>
<a href="#l16.26"></a><span id="l16.26" class="difflineplus">+   - Contributor(s):</span>
<a href="#l16.27"></a><span id="l16.27" class="difflineplus">+   -   Ben Goodger &lt;beng@google.com&gt;</span>
<a href="#l16.28"></a><span id="l16.28" class="difflineplus">+   -   Annie Sullivan &lt;annie.sullivan@gmail.com&gt;</span>
<a href="#l16.29"></a><span id="l16.29" class="difflineplus">+   -   Marco Bonardo &lt;mak77@bonardo.net&gt;</span>
<a href="#l16.30"></a><span id="l16.30" class="difflineplus">+   -</span>
<a href="#l16.31"></a><span id="l16.31" class="difflineplus">+   - Alternatively, the contents of this file may be used under the terms of</span>
<a href="#l16.32"></a><span id="l16.32" class="difflineplus">+   - either the GNU General Public License Version 2 or later (the &quot;GPL&quot;), or</span>
<a href="#l16.33"></a><span id="l16.33" class="difflineplus">+   - the GNU Lesser General Public License Version 2.1 or later (the &quot;LGPL&quot;),</span>
<a href="#l16.34"></a><span id="l16.34" class="difflineplus">+   - in which case the provisions of the GPL or the LGPL are applicable instead</span>
<a href="#l16.35"></a><span id="l16.35" class="difflineplus">+   - of those above. If you wish to allow use of your version of this file only</span>
<a href="#l16.36"></a><span id="l16.36" class="difflineplus">+   - under the terms of either the GPL or the LGPL, and not to allow others to</span>
<a href="#l16.37"></a><span id="l16.37" class="difflineplus">+   - use your version of this file under the terms of the MPL, indicate your</span>
<a href="#l16.38"></a><span id="l16.38" class="difflineplus">+   - decision by deleting the provisions above and replace them with the notice</span>
<a href="#l16.39"></a><span id="l16.39" class="difflineplus">+   - and other provisions required by the LGPL or the GPL. If you do not delete</span>
<a href="#l16.40"></a><span id="l16.40" class="difflineplus">+   - the provisions above, a recipient may use your version of this file under</span>
<a href="#l16.41"></a><span id="l16.41" class="difflineplus">+   - the terms of any one of the MPL, the GPL or the LGPL.</span>
<a href="#l16.42"></a><span id="l16.42" class="difflineplus">+   -</span>
<a href="#l16.43"></a><span id="l16.43" class="difflineplus">+   - ***** END LICENSE BLOCK ***** --&gt;</span>
<a href="#l16.44"></a><span id="l16.44" class="difflineplus">+</span>
<a href="#l16.45"></a><span id="l16.45" class="difflineplus">+&lt;bindings id=&quot;placesTreeBindings&quot;</span>
<a href="#l16.46"></a><span id="l16.46" class="difflineplus">+          xmlns=&quot;http://www.mozilla.org/xbl&quot;</span>
<a href="#l16.47"></a><span id="l16.47" class="difflineplus">+          xmlns:xbl=&quot;http://www.mozilla.org/xbl&quot;</span>
<a href="#l16.48"></a><span id="l16.48" class="difflineplus">+          xmlns:html=&quot;http://www.w3.org/1999/xhtml&quot;</span>
<a href="#l16.49"></a><span id="l16.49" class="difflineplus">+          xmlns:xul=&quot;http://www.mozilla.org/keymaster/gatekeeper/there.is.only.xul&quot;&gt;</span>
<a href="#l16.50"></a><span id="l16.50" class="difflineplus">+</span>
<a href="#l16.51"></a><span id="l16.51" class="difflineplus">+  &lt;binding id=&quot;places-tree&quot; extends=&quot;chrome://global/content/bindings/tree.xml#tree&quot;&gt;</span>
<a href="#l16.52"></a><span id="l16.52" class="difflineplus">+    &lt;implementation&gt;</span>
<a href="#l16.53"></a><span id="l16.53" class="difflineplus">+      &lt;constructor&gt;&lt;![CDATA[</span>
<a href="#l16.54"></a><span id="l16.54" class="difflineplus">+        // Force an initial build.</span>
<a href="#l16.55"></a><span id="l16.55" class="difflineplus">+        if (this.place)</span>
<a href="#l16.56"></a><span id="l16.56" class="difflineplus">+          this.place = this.place;</span>
<a href="#l16.57"></a><span id="l16.57" class="difflineplus">+      ]]&gt;&lt;/constructor&gt;</span>
<a href="#l16.58"></a><span id="l16.58" class="difflineplus">+</span>
<a href="#l16.59"></a><span id="l16.59" class="difflineplus">+      &lt;destructor&gt;&lt;![CDATA[</span>
<a href="#l16.60"></a><span id="l16.60" class="difflineplus">+        // Break the treeviewer-&gt;result-&gt;treeviewer cycle.</span>
<a href="#l16.61"></a><span id="l16.61" class="difflineplus">+        // Note: unsetting the result's viewer also unsets</span>
<a href="#l16.62"></a><span id="l16.62" class="difflineplus">+        // the viewer's reference to our treeBoxObject.</span>
<a href="#l16.63"></a><span id="l16.63" class="difflineplus">+        var result = this.getResult();</span>
<a href="#l16.64"></a><span id="l16.64" class="difflineplus">+        if (result)</span>
<a href="#l16.65"></a><span id="l16.65" class="difflineplus">+          result.viewer = null;</span>
<a href="#l16.66"></a><span id="l16.66" class="difflineplus">+        this.view = null;</span>
<a href="#l16.67"></a><span id="l16.67" class="difflineplus">+      ]]&gt;&lt;/destructor&gt;</span>
<a href="#l16.68"></a><span id="l16.68" class="difflineplus">+</span>
<a href="#l16.69"></a><span id="l16.69" class="difflineplus">+      &lt;property name=&quot;controller&quot;</span>
<a href="#l16.70"></a><span id="l16.70" class="difflineplus">+                readonly=&quot;true&quot;</span>
<a href="#l16.71"></a><span id="l16.71" class="difflineplus">+                onget=&quot;return this._controller;&quot;/&gt;</span>
<a href="#l16.72"></a><span id="l16.72" class="difflineplus">+</span>
<a href="#l16.73"></a><span id="l16.73" class="difflineplus">+      &lt;!-- overriding --&gt;</span>
<a href="#l16.74"></a><span id="l16.74" class="difflineplus">+      &lt;property name=&quot;view&quot;&gt;</span>
<a href="#l16.75"></a><span id="l16.75" class="difflineplus">+        &lt;getter&gt;&lt;![CDATA[</span>
<a href="#l16.76"></a><span id="l16.76" class="difflineplus">+          return this.treeBoxObject.view</span>
<a href="#l16.77"></a><span id="l16.77" class="difflineplus">+            .QueryInterface(Components.interfaces.nsINavHistoryResultTreeViewer);</span>
<a href="#l16.78"></a><span id="l16.78" class="difflineplus">+        ]]&gt;&lt;/getter&gt;</span>
<a href="#l16.79"></a><span id="l16.79" class="difflineplus">+        &lt;setter&gt;&lt;![CDATA[</span>
<a href="#l16.80"></a><span id="l16.80" class="difflineplus">+          return this.treeBoxObject.view = val;</span>
<a href="#l16.81"></a><span id="l16.81" class="difflineplus">+        ]]&gt;&lt;/setter&gt;</span>
<a href="#l16.82"></a><span id="l16.82" class="difflineplus">+      &lt;/property&gt;</span>
<a href="#l16.83"></a><span id="l16.83" class="difflineplus">+</span>
<a href="#l16.84"></a><span id="l16.84" class="difflineplus">+      &lt;method name=&quot;applyFilter&quot;&gt;</span>
<a href="#l16.85"></a><span id="l16.85" class="difflineplus">+        &lt;parameter name=&quot;filterString&quot;/&gt;</span>
<a href="#l16.86"></a><span id="l16.86" class="difflineplus">+        &lt;parameter name=&quot;folderRestrict&quot;/&gt;</span>
<a href="#l16.87"></a><span id="l16.87" class="difflineplus">+        &lt;body&gt;&lt;![CDATA[</span>
<a href="#l16.88"></a><span id="l16.88" class="difflineplus">+          // preserve grouping</span>
<a href="#l16.89"></a><span id="l16.89" class="difflineplus">+          var queryNode = asQuery(this.getResultNode());</span>
<a href="#l16.90"></a><span id="l16.90" class="difflineplus">+          var options = queryNode.queryOptions.clone();</span>
<a href="#l16.91"></a><span id="l16.91" class="difflineplus">+</span>
<a href="#l16.92"></a><span id="l16.92" class="difflineplus">+          var query = PlacesUtils.history.getNewQuery();</span>
<a href="#l16.93"></a><span id="l16.93" class="difflineplus">+          query.searchTerms = filterString;</span>
<a href="#l16.94"></a><span id="l16.94" class="difflineplus">+</span>
<a href="#l16.95"></a><span id="l16.95" class="difflineplus">+          if (folderRestrict) {</span>
<a href="#l16.96"></a><span id="l16.96" class="difflineplus">+            query.setFolders(folderRestrict, folderRestrict.length);</span>
<a href="#l16.97"></a><span id="l16.97" class="difflineplus">+            options.queryType = options.QUERY_TYPE_BOOKMARKS;</span>
<a href="#l16.98"></a><span id="l16.98" class="difflineplus">+          }</span>
<a href="#l16.99"></a><span id="l16.99" class="difflineplus">+</span>
<a href="#l16.100"></a><span id="l16.100" class="difflineplus">+          this.load([query], options);</span>
<a href="#l16.101"></a><span id="l16.101" class="difflineplus">+        ]]&gt;&lt;/body&gt;</span>
<a href="#l16.102"></a><span id="l16.102" class="difflineplus">+      &lt;/method&gt;</span>
<a href="#l16.103"></a><span id="l16.103" class="difflineplus">+</span>
<a href="#l16.104"></a><span id="l16.104" class="difflineplus">+      &lt;method name=&quot;load&quot;&gt;</span>
<a href="#l16.105"></a><span id="l16.105" class="difflineplus">+        &lt;parameter name=&quot;queries&quot;/&gt;</span>
<a href="#l16.106"></a><span id="l16.106" class="difflineplus">+        &lt;parameter name=&quot;options&quot;/&gt;</span>
<a href="#l16.107"></a><span id="l16.107" class="difflineplus">+        &lt;body&gt;&lt;![CDATA[</span>
<a href="#l16.108"></a><span id="l16.108" class="difflineplus">+          var result = PlacesUtils.history.executeQueries(queries, queries.length,</span>
<a href="#l16.109"></a><span id="l16.109" class="difflineplus">+                                                          options);</span>
<a href="#l16.110"></a><span id="l16.110" class="difflineplus">+</span>
<a href="#l16.111"></a><span id="l16.111" class="difflineplus">+          var treeView = new PlacesTreeView(this.flatList);</span>
<a href="#l16.112"></a><span id="l16.112" class="difflineplus">+          result.viewer = treeView;</span>
<a href="#l16.113"></a><span id="l16.113" class="difflineplus">+          this.view = treeView;</span>
<a href="#l16.114"></a><span id="l16.114" class="difflineplus">+          if (!this._controller) {</span>
<a href="#l16.115"></a><span id="l16.115" class="difflineplus">+            this._controller = new PlacesController(this);</span>
<a href="#l16.116"></a><span id="l16.116" class="difflineplus">+            this.controllers.appendController(this._controller);</span>
<a href="#l16.117"></a><span id="l16.117" class="difflineplus">+          }</span>
<a href="#l16.118"></a><span id="l16.118" class="difflineplus">+          this._cachedInsertionPoint = undefined;</span>
<a href="#l16.119"></a><span id="l16.119" class="difflineplus">+        ]]&gt;&lt;/body&gt;</span>
<a href="#l16.120"></a><span id="l16.120" class="difflineplus">+      &lt;/method&gt;</span>
<a href="#l16.121"></a><span id="l16.121" class="difflineplus">+</span>
<a href="#l16.122"></a><span id="l16.122" class="difflineplus">+      &lt;property name=&quot;flatList&quot;&gt;</span>
<a href="#l16.123"></a><span id="l16.123" class="difflineplus">+        &lt;getter&gt;&lt;![CDATA[</span>
<a href="#l16.124"></a><span id="l16.124" class="difflineplus">+          return this.getAttribute(&quot;flatList&quot;) == &quot;true&quot;;</span>
<a href="#l16.125"></a><span id="l16.125" class="difflineplus">+        ]]&gt;&lt;/getter&gt;</span>
<a href="#l16.126"></a><span id="l16.126" class="difflineplus">+        &lt;setter&gt;&lt;![CDATA[</span>
<a href="#l16.127"></a><span id="l16.127" class="difflineplus">+          if (this.flatList != val) {</span>
<a href="#l16.128"></a><span id="l16.128" class="difflineplus">+            this.setAttribute(&quot;flatList&quot;, val);</span>
<a href="#l16.129"></a><span id="l16.129" class="difflineplus">+            // reload with the last place set</span>
<a href="#l16.130"></a><span id="l16.130" class="difflineplus">+            if (this.place)</span>
<a href="#l16.131"></a><span id="l16.131" class="difflineplus">+              this.place = this.place;</span>
<a href="#l16.132"></a><span id="l16.132" class="difflineplus">+          }</span>
<a href="#l16.133"></a><span id="l16.133" class="difflineplus">+          return val;</span>
<a href="#l16.134"></a><span id="l16.134" class="difflineplus">+        ]]&gt;&lt;/setter&gt;</span>
<a href="#l16.135"></a><span id="l16.135" class="difflineplus">+      &lt;/property&gt;</span>
<a href="#l16.136"></a><span id="l16.136" class="difflineplus">+</span>
<a href="#l16.137"></a><span id="l16.137" class="difflineplus">+      &lt;property name=&quot;onOpenFlatContainer&quot;&gt;</span>
<a href="#l16.138"></a><span id="l16.138" class="difflineplus">+        &lt;getter&gt;&lt;![CDATA[</span>
<a href="#l16.139"></a><span id="l16.139" class="difflineplus">+          return this.getAttribute(&quot;onopenflatcontainer&quot;);</span>
<a href="#l16.140"></a><span id="l16.140" class="difflineplus">+        ]]&gt;&lt;/getter&gt;</span>
<a href="#l16.141"></a><span id="l16.141" class="difflineplus">+        &lt;setter&gt;&lt;![CDATA[</span>
<a href="#l16.142"></a><span id="l16.142" class="difflineplus">+          if (this.onOpenFlatContainer != val) {</span>
<a href="#l16.143"></a><span id="l16.143" class="difflineplus">+            this.setAttribute(&quot;onopenflatcontainer&quot;, val);</span>
<a href="#l16.144"></a><span id="l16.144" class="difflineplus">+            // reload with the last place set</span>
<a href="#l16.145"></a><span id="l16.145" class="difflineplus">+            if (this.place)</span>
<a href="#l16.146"></a><span id="l16.146" class="difflineplus">+              this.place = this.place;</span>
<a href="#l16.147"></a><span id="l16.147" class="difflineplus">+          }</span>
<a href="#l16.148"></a><span id="l16.148" class="difflineplus">+          return val;</span>
<a href="#l16.149"></a><span id="l16.149" class="difflineplus">+        ]]&gt;&lt;/setter&gt;</span>
<a href="#l16.150"></a><span id="l16.150" class="difflineplus">+      &lt;/property&gt;</span>
<a href="#l16.151"></a><span id="l16.151" class="difflineplus">+</span>
<a href="#l16.152"></a><span id="l16.152" class="difflineplus">+      &lt;!-- nsIPlacesView --&gt;</span>
<a href="#l16.153"></a><span id="l16.153" class="difflineplus">+      &lt;method name=&quot;getResult&quot;&gt;</span>
<a href="#l16.154"></a><span id="l16.154" class="difflineplus">+        &lt;body&gt;&lt;![CDATA[</span>
<a href="#l16.155"></a><span id="l16.155" class="difflineplus">+          try {</span>
<a href="#l16.156"></a><span id="l16.156" class="difflineplus">+            return this.view.QueryInterface(Components.interfaces.nsINavHistoryResultViewer).result;</span>
<a href="#l16.157"></a><span id="l16.157" class="difflineplus">+          }</span>
<a href="#l16.158"></a><span id="l16.158" class="difflineplus">+          catch (e) {</span>
<a href="#l16.159"></a><span id="l16.159" class="difflineplus">+            return null;</span>
<a href="#l16.160"></a><span id="l16.160" class="difflineplus">+          }</span>
<a href="#l16.161"></a><span id="l16.161" class="difflineplus">+        ]]&gt;&lt;/body&gt;</span>
<a href="#l16.162"></a><span id="l16.162" class="difflineplus">+      &lt;/method&gt;</span>
<a href="#l16.163"></a><span id="l16.163" class="difflineplus">+</span>
<a href="#l16.164"></a><span id="l16.164" class="difflineplus">+      &lt;!-- nsIPlacesView --&gt;</span>
<a href="#l16.165"></a><span id="l16.165" class="difflineplus">+      &lt;method name=&quot;getResultNode&quot;&gt;</span>
<a href="#l16.166"></a><span id="l16.166" class="difflineplus">+        &lt;body&gt;&lt;![CDATA[</span>
<a href="#l16.167"></a><span id="l16.167" class="difflineplus">+          return this.getResult().root;</span>
<a href="#l16.168"></a><span id="l16.168" class="difflineplus">+        ]]&gt;&lt;/body&gt;</span>
<a href="#l16.169"></a><span id="l16.169" class="difflineplus">+      &lt;/method&gt;</span>
<a href="#l16.170"></a><span id="l16.170" class="difflineplus">+</span>
<a href="#l16.171"></a><span id="l16.171" class="difflineplus">+      &lt;method name=&quot;getResultView&quot;&gt;</span>
<a href="#l16.172"></a><span id="l16.172" class="difflineplus">+        &lt;body&gt;&lt;![CDATA[</span>
<a href="#l16.173"></a><span id="l16.173" class="difflineplus">+          try {</span>
<a href="#l16.174"></a><span id="l16.174" class="difflineplus">+            return this.view.QueryInterface(Components.interfaces.nsINavHistoryResultTreeViewer);</span>
<a href="#l16.175"></a><span id="l16.175" class="difflineplus">+          }</span>
<a href="#l16.176"></a><span id="l16.176" class="difflineplus">+          catch (e) {</span>
<a href="#l16.177"></a><span id="l16.177" class="difflineplus">+          }</span>
<a href="#l16.178"></a><span id="l16.178" class="difflineplus">+          return null;</span>
<a href="#l16.179"></a><span id="l16.179" class="difflineplus">+        ]]&gt;&lt;/body&gt;</span>
<a href="#l16.180"></a><span id="l16.180" class="difflineplus">+      &lt;/method&gt;</span>
<a href="#l16.181"></a><span id="l16.181" class="difflineplus">+</span>
<a href="#l16.182"></a><span id="l16.182" class="difflineplus">+      &lt;!-- nsIPlacesView --&gt;</span>
<a href="#l16.183"></a><span id="l16.183" class="difflineplus">+      &lt;property name=&quot;place&quot;&gt;</span>
<a href="#l16.184"></a><span id="l16.184" class="difflineplus">+        &lt;getter&gt;&lt;![CDATA[</span>
<a href="#l16.185"></a><span id="l16.185" class="difflineplus">+          return this.getAttribute(&quot;place&quot;);</span>
<a href="#l16.186"></a><span id="l16.186" class="difflineplus">+        ]]&gt;&lt;/getter&gt;</span>
<a href="#l16.187"></a><span id="l16.187" class="difflineplus">+        &lt;setter&gt;&lt;![CDATA[</span>
<a href="#l16.188"></a><span id="l16.188" class="difflineplus">+          this.setAttribute(&quot;place&quot;, val);</span>
<a href="#l16.189"></a><span id="l16.189" class="difflineplus">+</span>
<a href="#l16.190"></a><span id="l16.190" class="difflineplus">+          var queriesRef = { };</span>
<a href="#l16.191"></a><span id="l16.191" class="difflineplus">+          var queryCountRef = { };</span>
<a href="#l16.192"></a><span id="l16.192" class="difflineplus">+          var optionsRef = { };</span>
<a href="#l16.193"></a><span id="l16.193" class="difflineplus">+          PlacesUtils.history.queryStringToQueries(val, queriesRef, queryCountRef, optionsRef);</span>
<a href="#l16.194"></a><span id="l16.194" class="difflineplus">+          if (queryCountRef.value == 0)</span>
<a href="#l16.195"></a><span id="l16.195" class="difflineplus">+            queriesRef.value = [PlacesUtils.history.getNewQuery()];</span>
<a href="#l16.196"></a><span id="l16.196" class="difflineplus">+          if (!optionsRef.value)</span>
<a href="#l16.197"></a><span id="l16.197" class="difflineplus">+            optionsRef.value = PlacesUtils.history.getNewQueryOptions();</span>
<a href="#l16.198"></a><span id="l16.198" class="difflineplus">+</span>
<a href="#l16.199"></a><span id="l16.199" class="difflineplus">+          this.load(queriesRef.value, optionsRef.value);</span>
<a href="#l16.200"></a><span id="l16.200" class="difflineplus">+</span>
<a href="#l16.201"></a><span id="l16.201" class="difflineplus">+          return val;</span>
<a href="#l16.202"></a><span id="l16.202" class="difflineplus">+        ]]&gt;&lt;/setter&gt;</span>
<a href="#l16.203"></a><span id="l16.203" class="difflineplus">+      &lt;/property&gt;</span>
<a href="#l16.204"></a><span id="l16.204" class="difflineplus">+</span>
<a href="#l16.205"></a><span id="l16.205" class="difflineplus">+      &lt;!-- nsIPlacesView --&gt;</span>
<a href="#l16.206"></a><span id="l16.206" class="difflineplus">+      &lt;property name=&quot;hasSelection&quot;&gt;</span>
<a href="#l16.207"></a><span id="l16.207" class="difflineplus">+        &lt;getter&gt;&lt;![CDATA[</span>
<a href="#l16.208"></a><span id="l16.208" class="difflineplus">+          return this.view.selection.count &gt;= 1;</span>
<a href="#l16.209"></a><span id="l16.209" class="difflineplus">+        ]]&gt;&lt;/getter&gt;</span>
<a href="#l16.210"></a><span id="l16.210" class="difflineplus">+      &lt;/property&gt;</span>
<a href="#l16.211"></a><span id="l16.211" class="difflineplus">+</span>
<a href="#l16.212"></a><span id="l16.212" class="difflineplus">+      &lt;!-- nsIPlacesView --&gt;</span>
<a href="#l16.213"></a><span id="l16.213" class="difflineplus">+      &lt;method name=&quot;getSelectionNodes&quot;&gt;</span>
<a href="#l16.214"></a><span id="l16.214" class="difflineplus">+        &lt;body&gt;&lt;![CDATA[</span>
<a href="#l16.215"></a><span id="l16.215" class="difflineplus">+          var selection = this.view.selection;</span>
<a href="#l16.216"></a><span id="l16.216" class="difflineplus">+          var rc = selection.getRangeCount();</span>
<a href="#l16.217"></a><span id="l16.217" class="difflineplus">+          var nodes = [];</span>
<a href="#l16.218"></a><span id="l16.218" class="difflineplus">+          var resultview = this.getResultView();</span>
<a href="#l16.219"></a><span id="l16.219" class="difflineplus">+          for (var i = 0; i &lt; rc; ++i) {</span>
<a href="#l16.220"></a><span id="l16.220" class="difflineplus">+            var min = { }, max = { };</span>
<a href="#l16.221"></a><span id="l16.221" class="difflineplus">+            selection.getRangeAt(i, min, max);</span>
<a href="#l16.222"></a><span id="l16.222" class="difflineplus">+</span>
<a href="#l16.223"></a><span id="l16.223" class="difflineplus">+            for (var j = min.value; j &lt;= max.value; ++j)</span>
<a href="#l16.224"></a><span id="l16.224" class="difflineplus">+              nodes.push(resultview.nodeForTreeIndex(j));</span>
<a href="#l16.225"></a><span id="l16.225" class="difflineplus">+          }</span>
<a href="#l16.226"></a><span id="l16.226" class="difflineplus">+          return nodes;</span>
<a href="#l16.227"></a><span id="l16.227" class="difflineplus">+        ]]&gt;&lt;/body&gt;</span>
<a href="#l16.228"></a><span id="l16.228" class="difflineplus">+      &lt;/method&gt;</span>
<a href="#l16.229"></a><span id="l16.229" class="difflineplus">+</span>
<a href="#l16.230"></a><span id="l16.230" class="difflineplus">+      &lt;!-- nsIPlacesView --&gt;</span>
<a href="#l16.231"></a><span id="l16.231" class="difflineplus">+      &lt;method name=&quot;getDragableSelection&quot;&gt;</span>
<a href="#l16.232"></a><span id="l16.232" class="difflineplus">+        &lt;body&gt;&lt;![CDATA[</span>
<a href="#l16.233"></a><span id="l16.233" class="difflineplus">+          return this.getSelectionNodes();</span>
<a href="#l16.234"></a><span id="l16.234" class="difflineplus">+        ]]&gt;&lt;/body&gt;</span>
<a href="#l16.235"></a><span id="l16.235" class="difflineplus">+      &lt;/method&gt;</span>
<a href="#l16.236"></a><span id="l16.236" class="difflineplus">+</span>
<a href="#l16.237"></a><span id="l16.237" class="difflineplus">+      &lt;!-- nsIPlacesView --&gt;</span>
<a href="#l16.238"></a><span id="l16.238" class="difflineplus">+      &lt;property name=&quot;selectedNode&quot;&gt;</span>
<a href="#l16.239"></a><span id="l16.239" class="difflineplus">+        &lt;getter&gt;&lt;![CDATA[</span>
<a href="#l16.240"></a><span id="l16.240" class="difflineplus">+          var view = this.view;</span>
<a href="#l16.241"></a><span id="l16.241" class="difflineplus">+          if (view.selection.count != 1)</span>
<a href="#l16.242"></a><span id="l16.242" class="difflineplus">+            return null;</span>
<a href="#l16.243"></a><span id="l16.243" class="difflineplus">+</span>
<a href="#l16.244"></a><span id="l16.244" class="difflineplus">+          var selection = view.selection;</span>
<a href="#l16.245"></a><span id="l16.245" class="difflineplus">+          var min = { }, max = { };</span>
<a href="#l16.246"></a><span id="l16.246" class="difflineplus">+          selection.getRangeAt(0, min, max);</span>
<a href="#l16.247"></a><span id="l16.247" class="difflineplus">+</span>
<a href="#l16.248"></a><span id="l16.248" class="difflineplus">+          return this.getResultView().nodeForTreeIndex(min.value);</span>
<a href="#l16.249"></a><span id="l16.249" class="difflineplus">+        ]]&gt;&lt;/getter&gt;</span>
<a href="#l16.250"></a><span id="l16.250" class="difflineplus">+      &lt;/property&gt;</span>
<a href="#l16.251"></a><span id="l16.251" class="difflineplus">+</span>
<a href="#l16.252"></a><span id="l16.252" class="difflineplus">+      &lt;!-- nsIPlacesView --&gt;</span>
<a href="#l16.253"></a><span id="l16.253" class="difflineplus">+      &lt;property name=&quot;insertionPoint&quot;&gt;</span>
<a href="#l16.254"></a><span id="l16.254" class="difflineplus">+        &lt;getter&gt;&lt;![CDATA[</span>
<a href="#l16.255"></a><span id="l16.255" class="difflineplus">+          // there is no insertion point for history queries</span>
<a href="#l16.256"></a><span id="l16.256" class="difflineplus">+          // so just bail out</span>
<a href="#l16.257"></a><span id="l16.257" class="difflineplus">+          return this._cachedInsertionPoint = null;</span>
<a href="#l16.258"></a><span id="l16.258" class="difflineplus">+        ]]&gt;&lt;/getter&gt;</span>
<a href="#l16.259"></a><span id="l16.259" class="difflineplus">+      &lt;/property&gt;</span>
<a href="#l16.260"></a><span id="l16.260" class="difflineplus">+</span>
<a href="#l16.261"></a><span id="l16.261" class="difflineplus">+      &lt;!-- nsIPlacesView --&gt;</span>
<a href="#l16.262"></a><span id="l16.262" class="difflineplus">+      &lt;method name=&quot;selectAll&quot;&gt;</span>
<a href="#l16.263"></a><span id="l16.263" class="difflineplus">+        &lt;body&gt;&lt;![CDATA[</span>
<a href="#l16.264"></a><span id="l16.264" class="difflineplus">+          this.view.selection.selectAll();</span>
<a href="#l16.265"></a><span id="l16.265" class="difflineplus">+        ]]&gt;&lt;/body&gt;</span>
<a href="#l16.266"></a><span id="l16.266" class="difflineplus">+      &lt;/method&gt;</span>
<a href="#l16.267"></a><span id="l16.267" class="difflineplus">+</span>
<a href="#l16.268"></a><span id="l16.268" class="difflineplus">+      &lt;!-- nsDragAndDrop --&gt;</span>
<a href="#l16.269"></a><span id="l16.269" class="difflineplus">+      &lt;method name=&quot;onDragStart&quot;&gt;</span>
<a href="#l16.270"></a><span id="l16.270" class="difflineplus">+        &lt;parameter name=&quot;aEvent&quot;/&gt;</span>
<a href="#l16.271"></a><span id="l16.271" class="difflineplus">+        &lt;parameter name=&quot;aXferData&quot;/&gt;</span>
<a href="#l16.272"></a><span id="l16.272" class="difflineplus">+        &lt;parameter name=&quot;aDragAction&quot;/&gt;</span>
<a href="#l16.273"></a><span id="l16.273" class="difflineplus">+        &lt;body&gt;&lt;![CDATA[</span>
<a href="#l16.274"></a><span id="l16.274" class="difflineplus">+          var nodes = this.getSelectionNodes();</span>
<a href="#l16.275"></a><span id="l16.275" class="difflineplus">+          for (var i = 0; i &lt; nodes.length; ++i) {</span>
<a href="#l16.276"></a><span id="l16.276" class="difflineplus">+            var node = nodes[i];</span>
<a href="#l16.277"></a><span id="l16.277" class="difflineplus">+</span>
<a href="#l16.278"></a><span id="l16.278" class="difflineplus">+            // Disallow dragging the root node of a tree</span>
<a href="#l16.279"></a><span id="l16.279" class="difflineplus">+            var parent = node.parent;</span>
<a href="#l16.280"></a><span id="l16.280" class="difflineplus">+            if (!parent)</span>
<a href="#l16.281"></a><span id="l16.281" class="difflineplus">+              return;</span>
<a href="#l16.282"></a><span id="l16.282" class="difflineplus">+</span>
<a href="#l16.283"></a><span id="l16.283" class="difflineplus">+            // History nodes can always be dragged off</span>
<a href="#l16.284"></a><span id="l16.284" class="difflineplus">+          }</span>
<a href="#l16.285"></a><span id="l16.285" class="difflineplus">+</span>
<a href="#l16.286"></a><span id="l16.286" class="difflineplus">+          // Stuff the encoded selection into the transferable data object</span>
<a href="#l16.287"></a><span id="l16.287" class="difflineplus">+          this._controller.setDataTransfer(aEvent);</span>
<a href="#l16.288"></a><span id="l16.288" class="difflineplus">+        ]]&gt;&lt;/body&gt;</span>
<a href="#l16.289"></a><span id="l16.289" class="difflineplus">+      &lt;/method&gt;</span>
<a href="#l16.290"></a><span id="l16.290" class="difflineplus">+</span>
<a href="#l16.291"></a><span id="l16.291" class="difflineplus">+      &lt;!-- nsDragAndDrop --&gt;</span>
<a href="#l16.292"></a><span id="l16.292" class="difflineplus">+      &lt;method name=&quot;canDrop&quot;&gt;</span>
<a href="#l16.293"></a><span id="l16.293" class="difflineplus">+        &lt;parameter name=&quot;aEvent&quot;/&gt;</span>
<a href="#l16.294"></a><span id="l16.294" class="difflineplus">+        &lt;parameter name=&quot;aDragSession&quot;/&gt;</span>
<a href="#l16.295"></a><span id="l16.295" class="difflineplus">+        &lt;body&gt;&lt;![CDATA[</span>
<a href="#l16.296"></a><span id="l16.296" class="difflineplus">+          // compat to general places tree but you never can drop on history</span>
<a href="#l16.297"></a><span id="l16.297" class="difflineplus">+          return false</span>
<a href="#l16.298"></a><span id="l16.298" class="difflineplus">+        ]]&gt;&lt;/body&gt;</span>
<a href="#l16.299"></a><span id="l16.299" class="difflineplus">+      &lt;/method&gt;</span>
<a href="#l16.300"></a><span id="l16.300" class="difflineplus">+</span>
<a href="#l16.301"></a><span id="l16.301" class="difflineplus">+      &lt;!-- nsDragAndDrop --&gt;</span>
<a href="#l16.302"></a><span id="l16.302" class="difflineplus">+      &lt;method name=&quot;onDragOver&quot;&gt;</span>
<a href="#l16.303"></a><span id="l16.303" class="difflineplus">+        &lt;parameter name=&quot;aEvent&quot;/&gt;</span>
<a href="#l16.304"></a><span id="l16.304" class="difflineplus">+        &lt;parameter name=&quot;aFlavour&quot;/&gt;</span>
<a href="#l16.305"></a><span id="l16.305" class="difflineplus">+        &lt;parameter name=&quot;aDragSession&quot;/&gt;</span>
<a href="#l16.306"></a><span id="l16.306" class="difflineplus">+        &lt;body&gt;&lt;![CDATA[</span>
<a href="#l16.307"></a><span id="l16.307" class="difflineplus">+          if (!this.canDrop(aEvent, aDragSession))</span>
<a href="#l16.308"></a><span id="l16.308" class="difflineplus">+            aEvent.dataTransfer.effectAllowed = &quot;none&quot;;</span>
<a href="#l16.309"></a><span id="l16.309" class="difflineplus">+        ]]&gt;&lt;/body&gt;</span>
<a href="#l16.310"></a><span id="l16.310" class="difflineplus">+      &lt;/method&gt;</span>
<a href="#l16.311"></a><span id="l16.311" class="difflineplus">+</span>
<a href="#l16.312"></a><span id="l16.312" class="difflineplus">+      &lt;!-- nsDragAndDrop --&gt;</span>
<a href="#l16.313"></a><span id="l16.313" class="difflineplus">+      &lt;method name=&quot;getSupportedFlavours&quot;&gt;</span>
<a href="#l16.314"></a><span id="l16.314" class="difflineplus">+        &lt;body&gt;&lt;![CDATA[</span>
<a href="#l16.315"></a><span id="l16.315" class="difflineplus">+          // nothing can be dropped on history, actually.</span>
<a href="#l16.316"></a><span id="l16.316" class="difflineplus">+          return [];</span>
<a href="#l16.317"></a><span id="l16.317" class="difflineplus">+        ]]&gt;&lt;/body&gt;</span>
<a href="#l16.318"></a><span id="l16.318" class="difflineplus">+      &lt;/method&gt;</span>
<a href="#l16.319"></a><span id="l16.319" class="difflineplus">+</span>
<a href="#l16.320"></a><span id="l16.320" class="difflineplus">+      &lt;method name=&quot;buildContextMenu&quot;&gt;</span>
<a href="#l16.321"></a><span id="l16.321" class="difflineplus">+        &lt;parameter name=&quot;aPopup&quot;/&gt;</span>
<a href="#l16.322"></a><span id="l16.322" class="difflineplus">+        &lt;body&gt;&lt;![CDATA[</span>
<a href="#l16.323"></a><span id="l16.323" class="difflineplus">+          return this.controller.buildContextMenu(aPopup);</span>
<a href="#l16.324"></a><span id="l16.324" class="difflineplus">+        ]]&gt;&lt;/body&gt;</span>
<a href="#l16.325"></a><span id="l16.325" class="difflineplus">+      &lt;/method&gt;</span>
<a href="#l16.326"></a><span id="l16.326" class="difflineplus">+</span>
<a href="#l16.327"></a><span id="l16.327" class="difflineplus">+      &lt;method name=&quot;destroyContextMenu&quot;&gt;</span>
<a href="#l16.328"></a><span id="l16.328" class="difflineplus">+        &lt;parameter name=&quot;aPopup&quot;/&gt;</span>
<a href="#l16.329"></a><span id="l16.329" class="difflineplus">+        &lt;body/&gt;</span>
<a href="#l16.330"></a><span id="l16.330" class="difflineplus">+      &lt;/method&gt;</span>
<a href="#l16.331"></a><span id="l16.331" class="difflineplus">+    &lt;/implementation&gt;</span>
<a href="#l16.332"></a><span id="l16.332" class="difflineplus">+    &lt;handlers&gt;</span>
<a href="#l16.333"></a><span id="l16.333" class="difflineplus">+      &lt;handler event=&quot;focus&quot;&gt;&lt;![CDATA[</span>
<a href="#l16.334"></a><span id="l16.334" class="difflineplus">+        this._cachedInsertionPoint = undefined;</span>
<a href="#l16.335"></a><span id="l16.335" class="difflineplus">+</span>
<a href="#l16.336"></a><span id="l16.336" class="difflineplus">+        // See select handler. We need the sidebar's places commandset to be</span>
<a href="#l16.337"></a><span id="l16.337" class="difflineplus">+        // updated as well</span>
<a href="#l16.338"></a><span id="l16.338" class="difflineplus">+        document.commandDispatcher.updateCommands(&quot;focus&quot;);</span>
<a href="#l16.339"></a><span id="l16.339" class="difflineplus">+      ]]&gt;&lt;/handler&gt;</span>
<a href="#l16.340"></a><span id="l16.340" class="difflineplus">+      &lt;handler event=&quot;select&quot;&gt;&lt;![CDATA[</span>
<a href="#l16.341"></a><span id="l16.341" class="difflineplus">+        this._cachedInsertionPoint = undefined;</span>
<a href="#l16.342"></a><span id="l16.342" class="difflineplus">+</span>
<a href="#l16.343"></a><span id="l16.343" class="difflineplus">+        // This additional complexity is here for the sidebars</span>
<a href="#l16.344"></a><span id="l16.344" class="difflineplus">+        var win = window;</span>
<a href="#l16.345"></a><span id="l16.345" class="difflineplus">+        while (true) {</span>
<a href="#l16.346"></a><span id="l16.346" class="difflineplus">+          win.document.commandDispatcher.updateCommands(&quot;focus&quot;);</span>
<a href="#l16.347"></a><span id="l16.347" class="difflineplus">+          if (win == window.top)</span>
<a href="#l16.348"></a><span id="l16.348" class="difflineplus">+            break;</span>
<a href="#l16.349"></a><span id="l16.349" class="difflineplus">+</span>
<a href="#l16.350"></a><span id="l16.350" class="difflineplus">+          win = win.parent;</span>
<a href="#l16.351"></a><span id="l16.351" class="difflineplus">+        }</span>
<a href="#l16.352"></a><span id="l16.352" class="difflineplus">+      ]]&gt;&lt;/handler&gt;</span>
<a href="#l16.353"></a><span id="l16.353" class="difflineplus">+      &lt;handler event=&quot;draggesture&quot;&gt;&lt;![CDATA[</span>
<a href="#l16.354"></a><span id="l16.354" class="difflineplus">+        if (event.target.localName == &quot;treechildren&quot;)</span>
<a href="#l16.355"></a><span id="l16.355" class="difflineplus">+          nsDragAndDrop.startDrag(event, this);</span>
<a href="#l16.356"></a><span id="l16.356" class="difflineplus">+      ]]&gt;&lt;/handler&gt;</span>
<a href="#l16.357"></a><span id="l16.357" class="difflineplus">+      &lt;handler event=&quot;dragover&quot;&gt;&lt;![CDATA[</span>
<a href="#l16.358"></a><span id="l16.358" class="difflineplus">+        if (event.target.localName == &quot;treechildren&quot;)</span>
<a href="#l16.359"></a><span id="l16.359" class="difflineplus">+          nsDragAndDrop.dragOver(event, this);</span>
<a href="#l16.360"></a><span id="l16.360" class="difflineplus">+      ]]&gt;&lt;/handler&gt;</span>
<a href="#l16.361"></a><span id="l16.361" class="difflineplus">+    &lt;/handlers&gt;</span>
<a href="#l16.362"></a><span id="l16.362" class="difflineplus">+  &lt;/binding&gt;</span>
<a href="#l16.363"></a><span id="l16.363" class="difflineplus">+</span>
<a href="#l16.364"></a><span id="l16.364" class="difflineplus">+&lt;/bindings&gt;</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l17.1"></a><span id="l17.1">new file mode 100644</span>
<a href="#l17.2"></a><span id="l17.2" class="difflineminus">--- /dev/null</span>
<a href="#l17.3"></a><span id="l17.3" class="difflineplus">+++ b/suite/common/history/treeView.js</span>
<a href="#l17.4"></a><span id="l17.4" class="difflineat">@@ -0,0 +1,1144 @@</span>
<a href="#l17.5"></a><span id="l17.5" class="difflineplus">+/* -*- Mode: C++; tab-width: 8; indent-tabs-mode: nil; c-basic-offset: 2 -*- */</span>
<a href="#l17.6"></a><span id="l17.6" class="difflineplus">+/* ***** BEGIN LICENSE BLOCK *****</span>
<a href="#l17.7"></a><span id="l17.7" class="difflineplus">+ * Version: MPL 1.1/GPL 2.0/LGPL 2.1</span>
<a href="#l17.8"></a><span id="l17.8" class="difflineplus">+ *</span>
<a href="#l17.9"></a><span id="l17.9" class="difflineplus">+ * The contents of this file are subject to the Mozilla Public License Version</span>
<a href="#l17.10"></a><span id="l17.10" class="difflineplus">+ * 1.1 (the &quot;License&quot;); you may not use this file except in compliance with</span>
<a href="#l17.11"></a><span id="l17.11" class="difflineplus">+ * the License. You may obtain a copy of the License at</span>
<a href="#l17.12"></a><span id="l17.12" class="difflineplus">+ * http://www.mozilla.org/MPL/</span>
<a href="#l17.13"></a><span id="l17.13" class="difflineplus">+ *</span>
<a href="#l17.14"></a><span id="l17.14" class="difflineplus">+ * Software distributed under the License is distributed on an &quot;AS IS&quot; basis,</span>
<a href="#l17.15"></a><span id="l17.15" class="difflineplus">+ * WITHOUT WARRANTY OF ANY KIND, either express or implied. See the License</span>
<a href="#l17.16"></a><span id="l17.16" class="difflineplus">+ * for the specific language governing rights and limitations under the</span>
<a href="#l17.17"></a><span id="l17.17" class="difflineplus">+ * License.</span>
<a href="#l17.18"></a><span id="l17.18" class="difflineplus">+ *</span>
<a href="#l17.19"></a><span id="l17.19" class="difflineplus">+ * The Original Code is Mozilla History System</span>
<a href="#l17.20"></a><span id="l17.20" class="difflineplus">+ *</span>
<a href="#l17.21"></a><span id="l17.21" class="difflineplus">+ * The Initial Developer of the Original Code is</span>
<a href="#l17.22"></a><span id="l17.22" class="difflineplus">+ * Google Inc.</span>
<a href="#l17.23"></a><span id="l17.23" class="difflineplus">+ * Portions created by the Initial Developer are Copyright (C) 2005</span>
<a href="#l17.24"></a><span id="l17.24" class="difflineplus">+ * the Initial Developer. All Rights Reserved.</span>
<a href="#l17.25"></a><span id="l17.25" class="difflineplus">+ *</span>
<a href="#l17.26"></a><span id="l17.26" class="difflineplus">+ * Contributor(s):</span>
<a href="#l17.27"></a><span id="l17.27" class="difflineplus">+ *   Brett Wilson &lt;brettw@gmail.com&gt; (original author)</span>
<a href="#l17.28"></a><span id="l17.28" class="difflineplus">+ *   Asaf Romano &lt;mano@mozilla.com&gt; (Javascript version)</span>
<a href="#l17.29"></a><span id="l17.29" class="difflineplus">+ *</span>
<a href="#l17.30"></a><span id="l17.30" class="difflineplus">+ * Alternatively, the contents of this file may be used under the terms of</span>
<a href="#l17.31"></a><span id="l17.31" class="difflineplus">+ * either the GNU General Public License Version 2 or later (the &quot;GPL&quot;), or</span>
<a href="#l17.32"></a><span id="l17.32" class="difflineplus">+ * the GNU Lesser General Public License Version 2.1 or later (the &quot;LGPL&quot;),</span>
<a href="#l17.33"></a><span id="l17.33" class="difflineplus">+ * in which case the provisions of the GPL or the LGPL are applicable instead</span>
<a href="#l17.34"></a><span id="l17.34" class="difflineplus">+ * of those above. If you wish to allow use of your version of this file only</span>
<a href="#l17.35"></a><span id="l17.35" class="difflineplus">+ * under the terms of either the GPL or the LGPL, and not to allow others to</span>
<a href="#l17.36"></a><span id="l17.36" class="difflineplus">+ * use your version of this file under the terms of the MPL, indicate your</span>
<a href="#l17.37"></a><span id="l17.37" class="difflineplus">+ * decision by deleting the provisions above and replace them with the notice</span>
<a href="#l17.38"></a><span id="l17.38" class="difflineplus">+ * and other provisions required by the GPL or the LGPL. If you do not delete</span>
<a href="#l17.39"></a><span id="l17.39" class="difflineplus">+ * the provisions above, a recipient may use your version of this file under</span>
<a href="#l17.40"></a><span id="l17.40" class="difflineplus">+ * the terms of any one of the MPL, the GPL or the LGPL.</span>
<a href="#l17.41"></a><span id="l17.41" class="difflineplus">+ *</span>
<a href="#l17.42"></a><span id="l17.42" class="difflineplus">+ * ***** END LICENSE BLOCK ***** */</span>
<a href="#l17.43"></a><span id="l17.43" class="difflineplus">+</span>
<a href="#l17.44"></a><span id="l17.44" class="difflineplus">+PlacesTreeView.prototype = {</span>
<a href="#l17.45"></a><span id="l17.45" class="difflineplus">+  _makeAtom: function PTV__makeAtom(aString) {</span>
<a href="#l17.46"></a><span id="l17.46" class="difflineplus">+    return  Components.classes[&quot;@mozilla.org/atom-service;1&quot;]</span>
<a href="#l17.47"></a><span id="l17.47" class="difflineplus">+                      .getService(Components.interfaces.nsIAtomService)</span>
<a href="#l17.48"></a><span id="l17.48" class="difflineplus">+                      .getAtom(aString);</span>
<a href="#l17.49"></a><span id="l17.49" class="difflineplus">+  },</span>
<a href="#l17.50"></a><span id="l17.50" class="difflineplus">+</span>
<a href="#l17.51"></a><span id="l17.51" class="difflineplus">+  _atoms: [],</span>
<a href="#l17.52"></a><span id="l17.52" class="difflineplus">+  _getAtomFor: function PTV__getAtomFor(aName) {</span>
<a href="#l17.53"></a><span id="l17.53" class="difflineplus">+    if (!this._atoms[aName])</span>
<a href="#l17.54"></a><span id="l17.54" class="difflineplus">+      this._atoms[aName] = this._makeAtom(aName);</span>
<a href="#l17.55"></a><span id="l17.55" class="difflineplus">+</span>
<a href="#l17.56"></a><span id="l17.56" class="difflineplus">+    return this._atoms[aName];</span>
<a href="#l17.57"></a><span id="l17.57" class="difflineplus">+  },</span>
<a href="#l17.58"></a><span id="l17.58" class="difflineplus">+</span>
<a href="#l17.59"></a><span id="l17.59" class="difflineplus">+  _ensureValidRow: function PTV__ensureValidRow(aRow) {</span>
<a href="#l17.60"></a><span id="l17.60" class="difflineplus">+    if (aRow &lt; 0 || aRow &gt;= this._visibleElements.length)</span>
<a href="#l17.61"></a><span id="l17.61" class="difflineplus">+      throw Components.results.NS_ERROR_INVALID_ARG;</span>
<a href="#l17.62"></a><span id="l17.62" class="difflineplus">+  },</span>
<a href="#l17.63"></a><span id="l17.63" class="difflineplus">+</span>
<a href="#l17.64"></a><span id="l17.64" class="difflineplus">+  __dateService: null,</span>
<a href="#l17.65"></a><span id="l17.65" class="difflineplus">+  get _dateService() {</span>
<a href="#l17.66"></a><span id="l17.66" class="difflineplus">+    if (!this.__dateService) {</span>
<a href="#l17.67"></a><span id="l17.67" class="difflineplus">+      this.__dateService = Components.classes[&quot;@mozilla.org/intl/scriptabledateformat;1&quot;]</span>
<a href="#l17.68"></a><span id="l17.68" class="difflineplus">+                                     .getService(Components.interfaces.nsIScriptableDateFormat);</span>
<a href="#l17.69"></a><span id="l17.69" class="difflineplus">+    }</span>
<a href="#l17.70"></a><span id="l17.70" class="difflineplus">+    return this.__dateService;</span>
<a href="#l17.71"></a><span id="l17.71" class="difflineplus">+  },</span>
<a href="#l17.72"></a><span id="l17.72" class="difflineplus">+</span>
<a href="#l17.73"></a><span id="l17.73" class="difflineplus">+  QueryInterface: function PTV_QueryInterface(aIID) {</span>
<a href="#l17.74"></a><span id="l17.74" class="difflineplus">+    if (aIID.equals(Components.interfaces.nsITreeView) ||</span>
<a href="#l17.75"></a><span id="l17.75" class="difflineplus">+        aIID.equals(Components.interfaces.nsINavHistoryResultViewer) ||</span>
<a href="#l17.76"></a><span id="l17.76" class="difflineplus">+        aIID.equals(Components.interfaces.nsINavHistoryResultTreeViewer) ||</span>
<a href="#l17.77"></a><span id="l17.77" class="difflineplus">+        aIID.equals(Components.interfaces.nsISupports))</span>
<a href="#l17.78"></a><span id="l17.78" class="difflineplus">+      return this;</span>
<a href="#l17.79"></a><span id="l17.79" class="difflineplus">+</span>
<a href="#l17.80"></a><span id="l17.80" class="difflineplus">+    throw Components.results.NS_ERROR_NO_INTERFACE;</span>
<a href="#l17.81"></a><span id="l17.81" class="difflineplus">+  },</span>
<a href="#l17.82"></a><span id="l17.82" class="difflineplus">+</span>
<a href="#l17.83"></a><span id="l17.83" class="difflineplus">+  /**</span>
<a href="#l17.84"></a><span id="l17.84" class="difflineplus">+   * This is called when the result or tree may have changed.</span>
<a href="#l17.85"></a><span id="l17.85" class="difflineplus">+   * It reinitializes everything. Result and/or tree can be null</span>
<a href="#l17.86"></a><span id="l17.86" class="difflineplus">+   * when calling.</span>
<a href="#l17.87"></a><span id="l17.87" class="difflineplus">+   */</span>
<a href="#l17.88"></a><span id="l17.88" class="difflineplus">+  _finishInit: function PTV__finishInit() {</span>
<a href="#l17.89"></a><span id="l17.89" class="difflineplus">+    if (this._tree &amp;&amp; this._result)</span>
<a href="#l17.90"></a><span id="l17.90" class="difflineplus">+      this.sortingChanged(this._result.sortingMode);</span>
<a href="#l17.91"></a><span id="l17.91" class="difflineplus">+</span>
<a href="#l17.92"></a><span id="l17.92" class="difflineplus">+    var qoInt = Components.interfaces.nsINavHistoryQueryOptions;</span>
<a href="#l17.93"></a><span id="l17.93" class="difflineplus">+    var options = asQuery(this._result.root).queryOptions;</span>
<a href="#l17.94"></a><span id="l17.94" class="difflineplus">+</span>
<a href="#l17.95"></a><span id="l17.95" class="difflineplus">+    // if there is no tree, BuildVisibleList will clear everything for us</span>
<a href="#l17.96"></a><span id="l17.96" class="difflineplus">+    this._buildVisibleList();</span>
<a href="#l17.97"></a><span id="l17.97" class="difflineplus">+  },</span>
<a href="#l17.98"></a><span id="l17.98" class="difflineplus">+</span>
<a href="#l17.99"></a><span id="l17.99" class="difflineplus">+  _computeShowSessions: function PTV__computeShowSessions() {</span>
<a href="#l17.100"></a><span id="l17.100" class="difflineplus">+    NS_ASSERT(this._result, &quot;Must have a result to show sessions!&quot;);</span>
<a href="#l17.101"></a><span id="l17.101" class="difflineplus">+    this._showSessions = false;</span>
<a href="#l17.102"></a><span id="l17.102" class="difflineplus">+</span>
<a href="#l17.103"></a><span id="l17.103" class="difflineplus">+    var options = asQuery(this._result.root).queryOptions;</span>
<a href="#l17.104"></a><span id="l17.104" class="difflineplus">+    NS_ASSERT(options, &quot;navHistoryResults must have valid options&quot;);</span>
<a href="#l17.105"></a><span id="l17.105" class="difflineplus">+</span>
<a href="#l17.106"></a><span id="l17.106" class="difflineplus">+    if (!options.showSessions)</span>
<a href="#l17.107"></a><span id="l17.107" class="difflineplus">+      return; // sessions are off</span>
<a href="#l17.108"></a><span id="l17.108" class="difflineplus">+</span>
<a href="#l17.109"></a><span id="l17.109" class="difflineplus">+    var resultType = options.resultType;</span>
<a href="#l17.110"></a><span id="l17.110" class="difflineplus">+    if (resultType != Components.interfaces.nsINavHistoryQueryOptions.RESULTS_AS_VISIT &amp;&amp;</span>
<a href="#l17.111"></a><span id="l17.111" class="difflineplus">+        resultType != Components.interfaces.nsINavHistoryQueryOptions.RESULTS_AS_FULL_VISIT)</span>
<a href="#l17.112"></a><span id="l17.112" class="difflineplus">+      return; // not visits</span>
<a href="#l17.113"></a><span id="l17.113" class="difflineplus">+</span>
<a href="#l17.114"></a><span id="l17.114" class="difflineplus">+    var sortType = this._result.sortingMode;</span>
<a href="#l17.115"></a><span id="l17.115" class="difflineplus">+    if (sortType != nsINavHistoryQueryOptions::SORT_BY_DATE_ASCENDING &amp;&amp;</span>
<a href="#l17.116"></a><span id="l17.116" class="difflineplus">+        sortType != nsINavHistoryQueryOptions::SORT_BY_DATE_DESCENDING)</span>
<a href="#l17.117"></a><span id="l17.117" class="difflineplus">+      return; // not date sorting</span>
<a href="#l17.118"></a><span id="l17.118" class="difflineplus">+</span>
<a href="#l17.119"></a><span id="l17.119" class="difflineplus">+    this._showSessions = true;</span>
<a href="#l17.120"></a><span id="l17.120" class="difflineplus">+  },</span>
<a href="#l17.121"></a><span id="l17.121" class="difflineplus">+</span>
<a href="#l17.122"></a><span id="l17.122" class="difflineplus">+  SESSION_STATUS_NONE: 0,</span>
<a href="#l17.123"></a><span id="l17.123" class="difflineplus">+  SESSION_STATUS_START: 1,</span>
<a href="#l17.124"></a><span id="l17.124" class="difflineplus">+  SESSION_STATUS_CONTINUE: 2,</span>
<a href="#l17.125"></a><span id="l17.125" class="difflineplus">+  _getRowSessionStatus: function PTV__getRowSessionStatus(aRow) {</span>
<a href="#l17.126"></a><span id="l17.126" class="difflineplus">+    var node = this._visibleElements[aRow].node;</span>
<a href="#l17.127"></a><span id="l17.127" class="difflineplus">+    if (!PlacesUtils.nodeIsVisit(node) || asVisit(node).sessionId == 0)</span>
<a href="#l17.128"></a><span id="l17.128" class="difflineplus">+      return this.SESSION_STATUS_NONE;</span>
<a href="#l17.129"></a><span id="l17.129" class="difflineplus">+</span>
<a href="#l17.130"></a><span id="l17.130" class="difflineplus">+    if (aRow == 0)</span>
<a href="#l17.131"></a><span id="l17.131" class="difflineplus">+      return this.SESSION_STATUS_START;</span>
<a href="#l17.132"></a><span id="l17.132" class="difflineplus">+</span>
<a href="#l17.133"></a><span id="l17.133" class="difflineplus">+    var previousNode = this._visibleElements[aRow - 1].node;</span>
<a href="#l17.134"></a><span id="l17.134" class="difflineplus">+    if (!PlacesUtils.nodeIsVisit(previousNode) ||</span>
<a href="#l17.135"></a><span id="l17.135" class="difflineplus">+        node.sessionId != asVisit(previousNode).sessionId)</span>
<a href="#l17.136"></a><span id="l17.136" class="difflineplus">+      return this.SESSION_STATUS_START;</span>
<a href="#l17.137"></a><span id="l17.137" class="difflineplus">+</span>
<a href="#l17.138"></a><span id="l17.138" class="difflineplus">+    return this.SESSION_STATUS_CONTINUE;</span>
<a href="#l17.139"></a><span id="l17.139" class="difflineplus">+  },</span>
<a href="#l17.140"></a><span id="l17.140" class="difflineplus">+</span>
<a href="#l17.141"></a><span id="l17.141" class="difflineplus">+  /**</span>
<a href="#l17.142"></a><span id="l17.142" class="difflineplus">+   * Call to completely rebuild the list of visible items. Note if there is no</span>
<a href="#l17.143"></a><span id="l17.143" class="difflineplus">+   * tree or root this will just clear out the list, so you can also call this</span>
<a href="#l17.144"></a><span id="l17.144" class="difflineplus">+   * when a tree is detached to clear the list.</span>
<a href="#l17.145"></a><span id="l17.145" class="difflineplus">+   */</span>
<a href="#l17.146"></a><span id="l17.146" class="difflineplus">+  _buildVisibleList: function PTV__buildVisibleList() {</span>
<a href="#l17.147"></a><span id="l17.147" class="difflineplus">+    var selection = this.selection;</span>
<a href="#l17.148"></a><span id="l17.148" class="difflineplus">+    if (selection)</span>
<a href="#l17.149"></a><span id="l17.149" class="difflineplus">+      selection.selectEventsSuppressed = true;</span>
<a href="#l17.150"></a><span id="l17.150" class="difflineplus">+</span>
<a href="#l17.151"></a><span id="l17.151" class="difflineplus">+    if (this._result) {</span>
<a href="#l17.152"></a><span id="l17.152" class="difflineplus">+      // Any current visible elements need to be marked as invisible.</span>
<a href="#l17.153"></a><span id="l17.153" class="difflineplus">+      for (var i = 0; i &lt; this._visibleElements.length; i++) {</span>
<a href="#l17.154"></a><span id="l17.154" class="difflineplus">+        this._visibleElements[i].node.viewIndex = -1;</span>
<a href="#l17.155"></a><span id="l17.155" class="difflineplus">+      }</span>
<a href="#l17.156"></a><span id="l17.156" class="difflineplus">+    }</span>
<a href="#l17.157"></a><span id="l17.157" class="difflineplus">+</span>
<a href="#l17.158"></a><span id="l17.158" class="difflineplus">+    var rootNode = this._result.root;</span>
<a href="#l17.159"></a><span id="l17.159" class="difflineplus">+    if (rootNode &amp;&amp; this._tree) {</span>
<a href="#l17.160"></a><span id="l17.160" class="difflineplus">+      this._computeShowSessions();</span>
<a href="#l17.161"></a><span id="l17.161" class="difflineplus">+</span>
<a href="#l17.162"></a><span id="l17.162" class="difflineplus">+      asContainer(rootNode);</span>
<a href="#l17.163"></a><span id="l17.163" class="difflineplus">+      if (!rootNode.containerOpen) {</span>
<a href="#l17.164"></a><span id="l17.164" class="difflineplus">+        // this triggers containerOpened which then builds the visible</span>
<a href="#l17.165"></a><span id="l17.165" class="difflineplus">+        // section</span>
<a href="#l17.166"></a><span id="l17.166" class="difflineplus">+        rootNode.containerOpen = true;</span>
<a href="#l17.167"></a><span id="l17.167" class="difflineplus">+      }</span>
<a href="#l17.168"></a><span id="l17.168" class="difflineplus">+      else</span>
<a href="#l17.169"></a><span id="l17.169" class="difflineplus">+        this.invalidateContainer(rootNode);</span>
<a href="#l17.170"></a><span id="l17.170" class="difflineplus">+    }</span>
<a href="#l17.171"></a><span id="l17.171" class="difflineplus">+    if (selection)</span>
<a href="#l17.172"></a><span id="l17.172" class="difflineplus">+      selection.selectEventsSuppressed = false;</span>
<a href="#l17.173"></a><span id="l17.173" class="difflineplus">+  },</span>
<a href="#l17.174"></a><span id="l17.174" class="difflineplus">+</span>
<a href="#l17.175"></a><span id="l17.175" class="difflineplus">+  /**</span>
<a href="#l17.176"></a><span id="l17.176" class="difflineplus">+   * This takes a container and recursively appends visible elements to the</span>
<a href="#l17.177"></a><span id="l17.177" class="difflineplus">+   * given array. This is used to build the visible element list (with</span>
<a href="#l17.178"></a><span id="l17.178" class="difflineplus">+   * this._visibleElements passed as the array), or portions thereof (with</span>
<a href="#l17.179"></a><span id="l17.179" class="difflineplus">+   * a separate array that is merged with the main list later.</span>
<a href="#l17.180"></a><span id="l17.180" class="difflineplus">+   *</span>
<a href="#l17.181"></a><span id="l17.181" class="difflineplus">+   * aVisibleStartIndex is the visible index of the beginning of the 'aVisible'</span>
<a href="#l17.182"></a><span id="l17.182" class="difflineplus">+   * array. When aVisible is this._visibleElements, this is 0. This is non-zero</span>
<a href="#l17.183"></a><span id="l17.183" class="difflineplus">+   * when we are building up a sub-region for insertion. Then, this is the</span>
<a href="#l17.184"></a><span id="l17.184" class="difflineplus">+   * index where the new array will be inserted into this._visibleElements.</span>
<a href="#l17.185"></a><span id="l17.185" class="difflineplus">+   * It is used to compute each node's viewIndex.</span>
<a href="#l17.186"></a><span id="l17.186" class="difflineplus">+   */</span>
<a href="#l17.187"></a><span id="l17.187" class="difflineplus">+  _buildVisibleSection:</span>
<a href="#l17.188"></a><span id="l17.188" class="difflineplus">+  function PTV__buildVisibleSection(aContainer, aVisible, aToOpen, aVisibleStartIndex)</span>
<a href="#l17.189"></a><span id="l17.189" class="difflineplus">+  {</span>
<a href="#l17.190"></a><span id="l17.190" class="difflineplus">+    if (!aContainer.containerOpen)</span>
<a href="#l17.191"></a><span id="l17.191" class="difflineplus">+      return;  // nothing to do</span>
<a href="#l17.192"></a><span id="l17.192" class="difflineplus">+</span>
<a href="#l17.193"></a><span id="l17.193" class="difflineplus">+    const openLiteral = PlacesUIUtils.RDF.GetResource(&quot;http://home.netscape.com/NC-rdf#open&quot;);</span>
<a href="#l17.194"></a><span id="l17.194" class="difflineplus">+    const trueLiteral = PlacesUIUtils.RDF.GetLiteral(&quot;true&quot;);</span>
<a href="#l17.195"></a><span id="l17.195" class="difflineplus">+</span>
<a href="#l17.196"></a><span id="l17.196" class="difflineplus">+    var cc = aContainer.childCount;</span>
<a href="#l17.197"></a><span id="l17.197" class="difflineplus">+    for (var i=0; i &lt; cc; i++) {</span>
<a href="#l17.198"></a><span id="l17.198" class="difflineplus">+      var curChild = aContainer.getChild(i);</span>
<a href="#l17.199"></a><span id="l17.199" class="difflineplus">+      var curChildType = curChild.type;</span>
<a href="#l17.200"></a><span id="l17.200" class="difflineplus">+</span>
<a href="#l17.201"></a><span id="l17.201" class="difflineplus">+      // add item</span>
<a href="#l17.202"></a><span id="l17.202" class="difflineplus">+      curChild.viewIndex = aVisibleStartIndex + aVisible.length;</span>
<a href="#l17.203"></a><span id="l17.203" class="difflineplus">+      aVisible.push({ node: curChild, properties: null });</span>
<a href="#l17.204"></a><span id="l17.204" class="difflineplus">+</span>
<a href="#l17.205"></a><span id="l17.205" class="difflineplus">+      // recursively do containers</span>
<a href="#l17.206"></a><span id="l17.206" class="difflineplus">+      if (!this._flatList &amp;&amp; PlacesUtils.containerTypes.indexOf(curChildType) != -1) {</span>
<a href="#l17.207"></a><span id="l17.207" class="difflineplus">+        asContainer(curChild);</span>
<a href="#l17.208"></a><span id="l17.208" class="difflineplus">+</span>
<a href="#l17.209"></a><span id="l17.209" class="difflineplus">+        var resource = this._getResourceForNode(curChild);</span>
<a href="#l17.210"></a><span id="l17.210" class="difflineplus">+        var isopen = resource != null &amp;&amp;</span>
<a href="#l17.211"></a><span id="l17.211" class="difflineplus">+                     PlacesUIUtils.localStore.HasAssertion(resource, openLiteral,</span>
<a href="#l17.212"></a><span id="l17.212" class="difflineplus">+                                                           trueLiteral, true);</span>
<a href="#l17.213"></a><span id="l17.213" class="difflineplus">+        if (isopen != curChild.containerOpen)</span>
<a href="#l17.214"></a><span id="l17.214" class="difflineplus">+          aToOpen.push(curChild);</span>
<a href="#l17.215"></a><span id="l17.215" class="difflineplus">+        else if (curChild.containerOpen &amp;&amp; curChild.childCount &gt; 0)</span>
<a href="#l17.216"></a><span id="l17.216" class="difflineplus">+          this._buildVisibleSection(curChild, aVisible, aToOpen, aVisibleStartIndex);</span>
<a href="#l17.217"></a><span id="l17.217" class="difflineplus">+      }</span>
<a href="#l17.218"></a><span id="l17.218" class="difflineplus">+    }</span>
<a href="#l17.219"></a><span id="l17.219" class="difflineplus">+  },</span>
<a href="#l17.220"></a><span id="l17.220" class="difflineplus">+</span>
<a href="#l17.221"></a><span id="l17.221" class="difflineplus">+  /**</span>
<a href="#l17.222"></a><span id="l17.222" class="difflineplus">+   * This counts how many rows an item takes in the tree, that is, the</span>
<a href="#l17.223"></a><span id="l17.223" class="difflineplus">+   * item itself plus any nodes following it with an increased indent.</span>
<a href="#l17.224"></a><span id="l17.224" class="difflineplus">+   * This allows you to figure out how many rows an item (=1) or a</span>
<a href="#l17.225"></a><span id="l17.225" class="difflineplus">+   * container with all of its children takes.</span>
<a href="#l17.226"></a><span id="l17.226" class="difflineplus">+   */</span>
<a href="#l17.227"></a><span id="l17.227" class="difflineplus">+  _countVisibleRowsForItem: function PTV__countVisibleRowsForItem(aNode) {</span>
<a href="#l17.228"></a><span id="l17.228" class="difflineplus">+    if (aNode == this._result.root)</span>
<a href="#l17.229"></a><span id="l17.229" class="difflineplus">+      return this._visibleElements.length;</span>
<a href="#l17.230"></a><span id="l17.230" class="difflineplus">+</span>
<a href="#l17.231"></a><span id="l17.231" class="difflineplus">+    var viewIndex = aNode.viewIndex;</span>
<a href="#l17.232"></a><span id="l17.232" class="difflineplus">+    NS_ASSERT(viewIndex &gt;= 0, &quot;Item is not visible, no rows to count&quot;);</span>
<a href="#l17.233"></a><span id="l17.233" class="difflineplus">+    var outerLevel = aNode.indentLevel;</span>
<a href="#l17.234"></a><span id="l17.234" class="difflineplus">+    for (var i = viewIndex + 1; i &lt; this._visibleElements.length; i++) {</span>
<a href="#l17.235"></a><span id="l17.235" class="difflineplus">+      if (this._visibleElements[i].node.indentLevel &lt;= outerLevel)</span>
<a href="#l17.236"></a><span id="l17.236" class="difflineplus">+        return i - viewIndex;</span>
<a href="#l17.237"></a><span id="l17.237" class="difflineplus">+    }</span>
<a href="#l17.238"></a><span id="l17.238" class="difflineplus">+    // this node plus its children occupy the bottom of the list</span>
<a href="#l17.239"></a><span id="l17.239" class="difflineplus">+    return this._visibleElements.length - viewIndex;</span>
<a href="#l17.240"></a><span id="l17.240" class="difflineplus">+  },</span>
<a href="#l17.241"></a><span id="l17.241" class="difflineplus">+</span>
<a href="#l17.242"></a><span id="l17.242" class="difflineplus">+  /**</span>
<a href="#l17.243"></a><span id="l17.243" class="difflineplus">+   * This is called by containers when they change and we need to update</span>
<a href="#l17.244"></a><span id="l17.244" class="difflineplus">+   * everything about the container. We build a new visible section with</span>
<a href="#l17.245"></a><span id="l17.245" class="difflineplus">+   * the container as a separate object so we first know how the list</span>
<a href="#l17.246"></a><span id="l17.246" class="difflineplus">+   * changes. This way we only have to do one realloc/memcpy to update</span>
<a href="#l17.247"></a><span id="l17.247" class="difflineplus">+   * the list.</span>
<a href="#l17.248"></a><span id="l17.248" class="difflineplus">+   *</span>
<a href="#l17.249"></a><span id="l17.249" class="difflineplus">+   * We also try to be smart here about redrawing the screen.</span>
<a href="#l17.250"></a><span id="l17.250" class="difflineplus">+   */</span>
<a href="#l17.251"></a><span id="l17.251" class="difflineplus">+  _refreshVisibleSection: function PTV__refreshVisibleSection(aContainer) {</span>
<a href="#l17.252"></a><span id="l17.252" class="difflineplus">+    NS_ASSERT(this._result, &quot;Need to have a result to update&quot;);</span>
<a href="#l17.253"></a><span id="l17.253" class="difflineplus">+    if (!this._tree)</span>
<a href="#l17.254"></a><span id="l17.254" class="difflineplus">+      return;</span>
<a href="#l17.255"></a><span id="l17.255" class="difflineplus">+</span>
<a href="#l17.256"></a><span id="l17.256" class="difflineplus">+    // aContainer must be visible</span>
<a href="#l17.257"></a><span id="l17.257" class="difflineplus">+    if (aContainer != this._result.root) {</span>
<a href="#l17.258"></a><span id="l17.258" class="difflineplus">+      if (aContainer.viewIndex &lt; 0 ||</span>
<a href="#l17.259"></a><span id="l17.259" class="difflineplus">+          aContainer.viewIndex &gt; this._visibleElements.length)</span>
<a href="#l17.260"></a><span id="l17.260" class="difflineplus">+        throw &quot;Trying to expand a node that is not visible&quot;;</span>
<a href="#l17.261"></a><span id="l17.261" class="difflineplus">+</span>
<a href="#l17.262"></a><span id="l17.262" class="difflineplus">+      NS_ASSERT(this._visibleElements[aContainer.viewIndex].node == aContainer,</span>
<a href="#l17.263"></a><span id="l17.263" class="difflineplus">+                &quot;Visible index is out of sync!&quot;);</span>
<a href="#l17.264"></a><span id="l17.264" class="difflineplus">+    }</span>
<a href="#l17.265"></a><span id="l17.265" class="difflineplus">+</span>
<a href="#l17.266"></a><span id="l17.266" class="difflineplus">+    var startReplacement = aContainer.viewIndex + 1;</span>
<a href="#l17.267"></a><span id="l17.267" class="difflineplus">+    var replaceCount = this._countVisibleRowsForItem(aContainer);</span>
<a href="#l17.268"></a><span id="l17.268" class="difflineplus">+</span>
<a href="#l17.269"></a><span id="l17.269" class="difflineplus">+    // We don't replace the container item itself so we decrease the</span>
<a href="#l17.270"></a><span id="l17.270" class="difflineplus">+    // replaceCount by 1. We don't do so though if there is no visible item</span>
<a href="#l17.271"></a><span id="l17.271" class="difflineplus">+    // for the container. This happens when aContainer is the root node</span>
<a href="#l17.272"></a><span id="l17.272" class="difflineplus">+    if (aContainer.viewIndex != -1)</span>
<a href="#l17.273"></a><span id="l17.273" class="difflineplus">+      replaceCount-=1;</span>
<a href="#l17.274"></a><span id="l17.274" class="difflineplus">+</span>
<a href="#l17.275"></a><span id="l17.275" class="difflineplus">+    // Persist selection state</span>
<a href="#l17.276"></a><span id="l17.276" class="difflineplus">+    var previouslySelectedNodes = [];</span>
<a href="#l17.277"></a><span id="l17.277" class="difflineplus">+    var selection = this.selection;</span>
<a href="#l17.278"></a><span id="l17.278" class="difflineplus">+    var rc = selection.getRangeCount();</span>
<a href="#l17.279"></a><span id="l17.279" class="difflineplus">+    for (var rangeIndex = 0; rangeIndex &lt; rc; rangeIndex++) {</span>
<a href="#l17.280"></a><span id="l17.280" class="difflineplus">+      var min = { }, max = { };</span>
<a href="#l17.281"></a><span id="l17.281" class="difflineplus">+      selection.getRangeAt(rangeIndex, min, max);</span>
<a href="#l17.282"></a><span id="l17.282" class="difflineplus">+      var lastIndex = Math.min(max.value, startReplacement + replaceCount -1);</span>
<a href="#l17.283"></a><span id="l17.283" class="difflineplus">+      if (min.value &lt; startReplacement || min.value &gt; lastIndex)</span>
<a href="#l17.284"></a><span id="l17.284" class="difflineplus">+        continue;</span>
<a href="#l17.285"></a><span id="l17.285" class="difflineplus">+</span>
<a href="#l17.286"></a><span id="l17.286" class="difflineplus">+      for (var nodeIndex = min.value; nodeIndex &lt;= lastIndex; nodeIndex++)</span>
<a href="#l17.287"></a><span id="l17.287" class="difflineplus">+        previouslySelectedNodes.push(</span>
<a href="#l17.288"></a><span id="l17.288" class="difflineplus">+          { node: this._visibleElements[nodeIndex].node, oldIndex: nodeIndex });</span>
<a href="#l17.289"></a><span id="l17.289" class="difflineplus">+    }</span>
<a href="#l17.290"></a><span id="l17.290" class="difflineplus">+</span>
<a href="#l17.291"></a><span id="l17.291" class="difflineplus">+    // Mark the removes as invisible</span>
<a href="#l17.292"></a><span id="l17.292" class="difflineplus">+    for (var i = 0; i &lt; replaceCount; i++)</span>
<a href="#l17.293"></a><span id="l17.293" class="difflineplus">+      this._visibleElements[startReplacement + i].node.viewIndex = -1;</span>
<a href="#l17.294"></a><span id="l17.294" class="difflineplus">+</span>
<a href="#l17.295"></a><span id="l17.295" class="difflineplus">+    // Building the new list will set the new elements' visible indices.</span>
<a href="#l17.296"></a><span id="l17.296" class="difflineplus">+    var newElements = [];</span>
<a href="#l17.297"></a><span id="l17.297" class="difflineplus">+    var toOpenElements = [];</span>
<a href="#l17.298"></a><span id="l17.298" class="difflineplus">+    this._buildVisibleSection(aContainer, newElements, toOpenElements, startReplacement);</span>
<a href="#l17.299"></a><span id="l17.299" class="difflineplus">+</span>
<a href="#l17.300"></a><span id="l17.300" class="difflineplus">+    // actually update the visible list</span>
<a href="#l17.301"></a><span id="l17.301" class="difflineplus">+    this._visibleElements =</span>
<a href="#l17.302"></a><span id="l17.302" class="difflineplus">+      this._visibleElements.slice(0, startReplacement).concat(newElements)</span>
<a href="#l17.303"></a><span id="l17.303" class="difflineplus">+          .concat(this._visibleElements.slice(startReplacement + replaceCount,</span>
<a href="#l17.304"></a><span id="l17.304" class="difflineplus">+                                              this._visibleElements.length));</span>
<a href="#l17.305"></a><span id="l17.305" class="difflineplus">+</span>
<a href="#l17.306"></a><span id="l17.306" class="difflineplus">+    // If the new area has a different size, we'll have to renumber the</span>
<a href="#l17.307"></a><span id="l17.307" class="difflineplus">+    // elements following the area.</span>
<a href="#l17.308"></a><span id="l17.308" class="difflineplus">+    if (replaceCount != newElements.length) {</span>
<a href="#l17.309"></a><span id="l17.309" class="difflineplus">+      for (i = startReplacement + newElements.length;</span>
<a href="#l17.310"></a><span id="l17.310" class="difflineplus">+           i &lt; this._visibleElements.length; i ++) {</span>
<a href="#l17.311"></a><span id="l17.311" class="difflineplus">+        this._visibleElements[i].node.viewIndex = i;</span>
<a href="#l17.312"></a><span id="l17.312" class="difflineplus">+      }</span>
<a href="#l17.313"></a><span id="l17.313" class="difflineplus">+    }</span>
<a href="#l17.314"></a><span id="l17.314" class="difflineplus">+</span>
<a href="#l17.315"></a><span id="l17.315" class="difflineplus">+    // now update the number of elements</span>
<a href="#l17.316"></a><span id="l17.316" class="difflineplus">+    selection.selectEventsSuppressed = true;</span>
<a href="#l17.317"></a><span id="l17.317" class="difflineplus">+    this._tree.beginUpdateBatch();</span>
<a href="#l17.318"></a><span id="l17.318" class="difflineplus">+</span>
<a href="#l17.319"></a><span id="l17.319" class="difflineplus">+    if (replaceCount)</span>
<a href="#l17.320"></a><span id="l17.320" class="difflineplus">+      this._tree.rowCountChanged(startReplacement, -replaceCount);</span>
<a href="#l17.321"></a><span id="l17.321" class="difflineplus">+    if (newElements.length)</span>
<a href="#l17.322"></a><span id="l17.322" class="difflineplus">+      this._tree.rowCountChanged(startReplacement, newElements.length);</span>
<a href="#l17.323"></a><span id="l17.323" class="difflineplus">+</span>
<a href="#l17.324"></a><span id="l17.324" class="difflineplus">+    if (!this._flatList) {</span>
<a href="#l17.325"></a><span id="l17.325" class="difflineplus">+      // now, open any containers that were persisted</span>
<a href="#l17.326"></a><span id="l17.326" class="difflineplus">+      for (var i = 0; i &lt; toOpenElements.length; i++) {</span>
<a href="#l17.327"></a><span id="l17.327" class="difflineplus">+        var item = toOpenElements[i];</span>
<a href="#l17.328"></a><span id="l17.328" class="difflineplus">+        var parent = item.parent;</span>
<a href="#l17.329"></a><span id="l17.329" class="difflineplus">+        // avoid recursively opening containers</span>
<a href="#l17.330"></a><span id="l17.330" class="difflineplus">+        while (parent) {</span>
<a href="#l17.331"></a><span id="l17.331" class="difflineplus">+          if (parent.uri == item.uri)</span>
<a href="#l17.332"></a><span id="l17.332" class="difflineplus">+            break;</span>
<a href="#l17.333"></a><span id="l17.333" class="difflineplus">+          parent = parent.parent;</span>
<a href="#l17.334"></a><span id="l17.334" class="difflineplus">+        }</span>
<a href="#l17.335"></a><span id="l17.335" class="difflineplus">+        // if we don't have a parent, we made it all the way to the root</span>
<a href="#l17.336"></a><span id="l17.336" class="difflineplus">+        // and didn't find a match, so we can open our item</span>
<a href="#l17.337"></a><span id="l17.337" class="difflineplus">+        if (!parent &amp;&amp; !item.containerOpen)</span>
<a href="#l17.338"></a><span id="l17.338" class="difflineplus">+          item.containerOpen = true;</span>
<a href="#l17.339"></a><span id="l17.339" class="difflineplus">+      }</span>
<a href="#l17.340"></a><span id="l17.340" class="difflineplus">+    }</span>
<a href="#l17.341"></a><span id="l17.341" class="difflineplus">+</span>
<a href="#l17.342"></a><span id="l17.342" class="difflineplus">+    this._tree.endUpdateBatch();</span>
<a href="#l17.343"></a><span id="l17.343" class="difflineplus">+</span>
<a href="#l17.344"></a><span id="l17.344" class="difflineplus">+    // restore selection</span>
<a href="#l17.345"></a><span id="l17.345" class="difflineplus">+    if (previouslySelectedNodes.length &gt; 0) {</span>
<a href="#l17.346"></a><span id="l17.346" class="difflineplus">+      for (var i = 0; i &lt; previouslySelectedNodes.length; i++) {</span>
<a href="#l17.347"></a><span id="l17.347" class="difflineplus">+        var nodeInfo = previouslySelectedNodes[i];</span>
<a href="#l17.348"></a><span id="l17.348" class="difflineplus">+        var index = nodeInfo.node.viewIndex;</span>
<a href="#l17.349"></a><span id="l17.349" class="difflineplus">+</span>
<a href="#l17.350"></a><span id="l17.350" class="difflineplus">+        // if the same node was used (happens on sorting-changes),</span>
<a href="#l17.351"></a><span id="l17.351" class="difflineplus">+        // just use viewIndex</span>
<a href="#l17.352"></a><span id="l17.352" class="difflineplus">+        if (index == -1) { // otherwise, try to find an equal node</span>
<a href="#l17.353"></a><span id="l17.353" class="difflineplus">+          var itemId = PlacesUtils.getConcreteItemId(nodeInfo.node);</span>
<a href="#l17.354"></a><span id="l17.354" class="difflineplus">+          if (itemId != 1) { // bookmark-nodes in queries case</span>
<a href="#l17.355"></a><span id="l17.355" class="difflineplus">+            for (var j = 0; j &lt; newElements.length &amp;&amp; index == -1; j++) {</span>
<a href="#l17.356"></a><span id="l17.356" class="difflineplus">+              if (PlacesUtils.getConcreteItemId(newElements[j]) == itemId)</span>
<a href="#l17.357"></a><span id="l17.357" class="difflineplus">+                index = newElements[j].viewIndex;</span>
<a href="#l17.358"></a><span id="l17.358" class="difflineplus">+            }</span>
<a href="#l17.359"></a><span id="l17.359" class="difflineplus">+          }</span>
<a href="#l17.360"></a><span id="l17.360" class="difflineplus">+          else { // history nodes</span>
<a href="#l17.361"></a><span id="l17.361" class="difflineplus">+            var uri = nodeInfo.node.uri;</span>
<a href="#l17.362"></a><span id="l17.362" class="difflineplus">+            if (uri) {</span>
<a href="#l17.363"></a><span id="l17.363" class="difflineplus">+              for (var j = 0; j &lt; newElements.length &amp;&amp; index == -1; j++) {</span>
<a href="#l17.364"></a><span id="l17.364" class="difflineplus">+                if (newElements[j].uri == uri)</span>
<a href="#l17.365"></a><span id="l17.365" class="difflineplus">+                  index = newElements[j].viewIndex;</span>
<a href="#l17.366"></a><span id="l17.366" class="difflineplus">+              }</span>
<a href="#l17.367"></a><span id="l17.367" class="difflineplus">+            }</span>
<a href="#l17.368"></a><span id="l17.368" class="difflineplus">+          }</span>
<a href="#l17.369"></a><span id="l17.369" class="difflineplus">+        }</span>
<a href="#l17.370"></a><span id="l17.370" class="difflineplus">+        if (index != -1)</span>
<a href="#l17.371"></a><span id="l17.371" class="difflineplus">+          selection.rangedSelect(index, index, true);</span>
<a href="#l17.372"></a><span id="l17.372" class="difflineplus">+      }</span>
<a href="#l17.373"></a><span id="l17.373" class="difflineplus">+</span>
<a href="#l17.374"></a><span id="l17.374" class="difflineplus">+      // if only one node was previously selected and there's no selection now,</span>
<a href="#l17.375"></a><span id="l17.375" class="difflineplus">+      // select the node at its old-viewIndex, if any</span>
<a href="#l17.376"></a><span id="l17.376" class="difflineplus">+      if (previouslySelectedNodes.length == 1 &amp;&amp;</span>
<a href="#l17.377"></a><span id="l17.377" class="difflineplus">+          selection.getRangeCount() == 0 &amp;&amp;</span>
<a href="#l17.378"></a><span id="l17.378" class="difflineplus">+          this._visibleElements.length &gt; previouslySelectedNodes[0].oldIndex) {</span>
<a href="#l17.379"></a><span id="l17.379" class="difflineplus">+        selection.rangedSelect(previouslySelectedNodes[0].oldIndex,</span>
<a href="#l17.380"></a><span id="l17.380" class="difflineplus">+                               previouslySelectedNodes[0].oldIndex, true);</span>
<a href="#l17.381"></a><span id="l17.381" class="difflineplus">+      }</span>
<a href="#l17.382"></a><span id="l17.382" class="difflineplus">+    }</span>
<a href="#l17.383"></a><span id="l17.383" class="difflineplus">+    selection.selectEventsSuppressed = false;</span>
<a href="#l17.384"></a><span id="l17.384" class="difflineplus">+  },</span>
<a href="#l17.385"></a><span id="l17.385" class="difflineplus">+</span>
<a href="#l17.386"></a><span id="l17.386" class="difflineplus">+  _convertPRTimeToString: function PTV__convertPRTimeToString(aTime) {</span>
<a href="#l17.387"></a><span id="l17.387" class="difflineplus">+    var timeInMilliseconds = aTime / 1000; // PRTime is in microseconds</span>
<a href="#l17.388"></a><span id="l17.388" class="difflineplus">+    var timeObj = new Date(timeInMilliseconds);</span>
<a href="#l17.389"></a><span id="l17.389" class="difflineplus">+</span>
<a href="#l17.390"></a><span id="l17.390" class="difflineplus">+    // Check if it is today and only display the time.  Only bother</span>
<a href="#l17.391"></a><span id="l17.391" class="difflineplus">+    // checking for today if it's within the last 24 hours, since</span>
<a href="#l17.392"></a><span id="l17.392" class="difflineplus">+    // computing midnight is not really cheap. Sometimes we may get dates</span>
<a href="#l17.393"></a><span id="l17.393" class="difflineplus">+    // in the future, so always show those.</span>
<a href="#l17.394"></a><span id="l17.394" class="difflineplus">+    var ago = new Date(Date.now() - timeInMilliseconds);</span>
<a href="#l17.395"></a><span id="l17.395" class="difflineplus">+    var dateFormat = Components.interfaces.nsIScriptableDateFormat.dateFormatShort;</span>
<a href="#l17.396"></a><span id="l17.396" class="difflineplus">+    if (ago &gt; -10000 &amp;&amp; ago &lt; (1000 * 24 * 60 * 60)) {</span>
<a href="#l17.397"></a><span id="l17.397" class="difflineplus">+      var midnight = new Date(timeInMilliseconds);</span>
<a href="#l17.398"></a><span id="l17.398" class="difflineplus">+      midnight.setHours(0);</span>
<a href="#l17.399"></a><span id="l17.399" class="difflineplus">+      midnight.setMinutes(0);</span>
<a href="#l17.400"></a><span id="l17.400" class="difflineplus">+      midnight.setSeconds(0);</span>
<a href="#l17.401"></a><span id="l17.401" class="difflineplus">+      midnight.setMilliseconds(0);</span>
<a href="#l17.402"></a><span id="l17.402" class="difflineplus">+</span>
<a href="#l17.403"></a><span id="l17.403" class="difflineplus">+      if (timeInMilliseconds &gt; midnight.getTime())</span>
<a href="#l17.404"></a><span id="l17.404" class="difflineplus">+        dateFormat = Components.interfaces.nsIScriptableDateFormat.dateFormatNone;</span>
<a href="#l17.405"></a><span id="l17.405" class="difflineplus">+    }</span>
<a href="#l17.406"></a><span id="l17.406" class="difflineplus">+</span>
<a href="#l17.407"></a><span id="l17.407" class="difflineplus">+    return (this._dateService.FormatDateTime(&quot;&quot;, dateFormat,</span>
<a href="#l17.408"></a><span id="l17.408" class="difflineplus">+      Components.interfaces.nsIScriptableDateFormat.timeFormatNoSeconds,</span>
<a href="#l17.409"></a><span id="l17.409" class="difflineplus">+      timeObj.getFullYear(), timeObj.getMonth() + 1,</span>
<a href="#l17.410"></a><span id="l17.410" class="difflineplus">+      timeObj.getDate(), timeObj.getHours(),</span>
<a href="#l17.411"></a><span id="l17.411" class="difflineplus">+      timeObj.getMinutes(), timeObj.getSeconds()));</span>
<a href="#l17.412"></a><span id="l17.412" class="difflineplus">+  },</span>
<a href="#l17.413"></a><span id="l17.413" class="difflineplus">+</span>
<a href="#l17.414"></a><span id="l17.414" class="difflineplus">+  COLUMN_TYPE_UNKNOWN: 0,</span>
<a href="#l17.415"></a><span id="l17.415" class="difflineplus">+  COLUMN_TYPE_TITLE: 1,</span>
<a href="#l17.416"></a><span id="l17.416" class="difflineplus">+  COLUMN_TYPE_URI: 2,</span>
<a href="#l17.417"></a><span id="l17.417" class="difflineplus">+  COLUMN_TYPE_DATE: 3,</span>
<a href="#l17.418"></a><span id="l17.418" class="difflineplus">+  COLUMN_TYPE_VISITCOUNT: 4,</span>
<a href="#l17.419"></a><span id="l17.419" class="difflineplus">+</span>
<a href="#l17.420"></a><span id="l17.420" class="difflineplus">+  _getColumnType: function PTV__getColumnType(aColumn) {</span>
<a href="#l17.421"></a><span id="l17.421" class="difflineplus">+    var columnType = aColumn.element.getAttribute(&quot;anonid&quot;) || aColumn.id;</span>
<a href="#l17.422"></a><span id="l17.422" class="difflineplus">+</span>
<a href="#l17.423"></a><span id="l17.423" class="difflineplus">+    switch (columnType) {</span>
<a href="#l17.424"></a><span id="l17.424" class="difflineplus">+      case &quot;title&quot;:</span>
<a href="#l17.425"></a><span id="l17.425" class="difflineplus">+        return this.COLUMN_TYPE_TITLE;</span>
<a href="#l17.426"></a><span id="l17.426" class="difflineplus">+      case &quot;url&quot;:</span>
<a href="#l17.427"></a><span id="l17.427" class="difflineplus">+        return this.COLUMN_TYPE_URI;</span>
<a href="#l17.428"></a><span id="l17.428" class="difflineplus">+      case &quot;date&quot;:</span>
<a href="#l17.429"></a><span id="l17.429" class="difflineplus">+        return this.COLUMN_TYPE_DATE;</span>
<a href="#l17.430"></a><span id="l17.430" class="difflineplus">+      case &quot;visitCount&quot;:</span>
<a href="#l17.431"></a><span id="l17.431" class="difflineplus">+        return this.COLUMN_TYPE_VISITCOUNT;</span>
<a href="#l17.432"></a><span id="l17.432" class="difflineplus">+    }</span>
<a href="#l17.433"></a><span id="l17.433" class="difflineplus">+    return this.COLUMN_TYPE_UNKNOWN;</span>
<a href="#l17.434"></a><span id="l17.434" class="difflineplus">+  },</span>
<a href="#l17.435"></a><span id="l17.435" class="difflineplus">+</span>
<a href="#l17.436"></a><span id="l17.436" class="difflineplus">+  _sortTypeToColumnType: function PTV__sortTypeToColumnType(aSortType) {</span>
<a href="#l17.437"></a><span id="l17.437" class="difflineplus">+    switch (aSortType) {</span>
<a href="#l17.438"></a><span id="l17.438" class="difflineplus">+      case Components.interfaces.nsINavHistoryQueryOptions.SORT_BY_TITLE_ASCENDING:</span>
<a href="#l17.439"></a><span id="l17.439" class="difflineplus">+        return [this.COLUMN_TYPE_TITLE, false];</span>
<a href="#l17.440"></a><span id="l17.440" class="difflineplus">+      case Components.interfaces.nsINavHistoryQueryOptions.SORT_BY_TITLE_DESCENDING:</span>
<a href="#l17.441"></a><span id="l17.441" class="difflineplus">+        return [this.COLUMN_TYPE_TITLE, true];</span>
<a href="#l17.442"></a><span id="l17.442" class="difflineplus">+      case Components.interfaces.nsINavHistoryQueryOptions.SORT_BY_DATE_ASCENDING:</span>
<a href="#l17.443"></a><span id="l17.443" class="difflineplus">+        return [this.COLUMN_TYPE_DATE, false];</span>
<a href="#l17.444"></a><span id="l17.444" class="difflineplus">+      case Components.interfaces.nsINavHistoryQueryOptions.SORT_BY_DATE_DESCENDING:</span>
<a href="#l17.445"></a><span id="l17.445" class="difflineplus">+        return [this.COLUMN_TYPE_DATE, true];</span>
<a href="#l17.446"></a><span id="l17.446" class="difflineplus">+      case Components.interfaces.nsINavHistoryQueryOptions.SORT_BY_URI_ASCENDING:</span>
<a href="#l17.447"></a><span id="l17.447" class="difflineplus">+        return [this.COLUMN_TYPE_URI, false];</span>
<a href="#l17.448"></a><span id="l17.448" class="difflineplus">+      case Components.interfaces.nsINavHistoryQueryOptions.SORT_BY_URI_DESCENDING:</span>
<a href="#l17.449"></a><span id="l17.449" class="difflineplus">+        return [this.COLUMN_TYPE_URI, true];</span>
<a href="#l17.450"></a><span id="l17.450" class="difflineplus">+      case Components.interfaces.nsINavHistoryQueryOptions.SORT_BY_VISITCOUNT_ASCENDING:</span>
<a href="#l17.451"></a><span id="l17.451" class="difflineplus">+        return [this.COLUMN_TYPE_VISITCOUNT, false];</span>
<a href="#l17.452"></a><span id="l17.452" class="difflineplus">+      case Components.interfaces.nsINavHistoryQueryOptions.SORT_BY_VISITCOUNT_DESCENDING:</span>
<a href="#l17.453"></a><span id="l17.453" class="difflineplus">+        return [this.COLUMN_TYPE_VISITCOUNT, true];</span>
<a href="#l17.454"></a><span id="l17.454" class="difflineplus">+    }</span>
<a href="#l17.455"></a><span id="l17.455" class="difflineplus">+    return [this.COLUMN_TYPE_UNKNOWN, false];</span>
<a href="#l17.456"></a><span id="l17.456" class="difflineplus">+  },</span>
<a href="#l17.457"></a><span id="l17.457" class="difflineplus">+</span>
<a href="#l17.458"></a><span id="l17.458" class="difflineplus">+  // nsINavHistoryResultViewer</span>
<a href="#l17.459"></a><span id="l17.459" class="difflineplus">+  itemInserted: function PTV_itemInserted(aParent, aItem, aNewIndex) {</span>
<a href="#l17.460"></a><span id="l17.460" class="difflineplus">+    if (!this._tree)</span>
<a href="#l17.461"></a><span id="l17.461" class="difflineplus">+      return;</span>
<a href="#l17.462"></a><span id="l17.462" class="difflineplus">+    if (!this._result)</span>
<a href="#l17.463"></a><span id="l17.463" class="difflineplus">+      throw Components.results.NS_ERROR_UNEXPECTED;</span>
<a href="#l17.464"></a><span id="l17.464" class="difflineplus">+</span>
<a href="#l17.465"></a><span id="l17.465" class="difflineplus">+    // update parent when inserting the first item because twisty may</span>
<a href="#l17.466"></a><span id="l17.466" class="difflineplus">+    // have changed</span>
<a href="#l17.467"></a><span id="l17.467" class="difflineplus">+    if (aParent.childCount == 1)</span>
<a href="#l17.468"></a><span id="l17.468" class="difflineplus">+      this.itemChanged(aParent);</span>
<a href="#l17.469"></a><span id="l17.469" class="difflineplus">+</span>
<a href="#l17.470"></a><span id="l17.470" class="difflineplus">+    // compute the new view index of the item</span>
<a href="#l17.471"></a><span id="l17.471" class="difflineplus">+    var newViewIndex = -1;</span>
<a href="#l17.472"></a><span id="l17.472" class="difflineplus">+    if (aNewIndex == 0) {</span>
<a href="#l17.473"></a><span id="l17.473" class="difflineplus">+      // item is the first thing in our child list, it takes our index +1. Note</span>
<a href="#l17.474"></a><span id="l17.474" class="difflineplus">+      // that this computation still works if the parent is an invisible root</span>
<a href="#l17.475"></a><span id="l17.475" class="difflineplus">+      // node, because root_index + 1 = -1 + 1 = 0</span>
<a href="#l17.476"></a><span id="l17.476" class="difflineplus">+      newViewIndex = aParent.viewIndex + 1;</span>
<a href="#l17.477"></a><span id="l17.477" class="difflineplus">+    }</span>
<a href="#l17.478"></a><span id="l17.478" class="difflineplus">+    else {</span>
<a href="#l17.479"></a><span id="l17.479" class="difflineplus">+      // Here, we try to find the next visible element in the child list so we</span>
<a href="#l17.480"></a><span id="l17.480" class="difflineplus">+      // can set the new visible index to be right before that. Note that we</span>
<a href="#l17.481"></a><span id="l17.481" class="difflineplus">+      // have to search DOWN instead of up, because some siblings could have</span>
<a href="#l17.482"></a><span id="l17.482" class="difflineplus">+      // children themselves that would be in the way.</span>
<a href="#l17.483"></a><span id="l17.483" class="difflineplus">+      for (var i = aNewIndex + 1; i &lt; aParent.childCount; i ++) {</span>
<a href="#l17.484"></a><span id="l17.484" class="difflineplus">+        var viewIndex = aParent.getChild(i).viewIndex;</span>
<a href="#l17.485"></a><span id="l17.485" class="difflineplus">+        if (viewIndex &gt;= 0) {</span>
<a href="#l17.486"></a><span id="l17.486" class="difflineplus">+          // the view indices of subsequent children have not been shifted so</span>
<a href="#l17.487"></a><span id="l17.487" class="difflineplus">+          // the next item will have what should be our index</span>
<a href="#l17.488"></a><span id="l17.488" class="difflineplus">+          newViewIndex = viewIndex;</span>
<a href="#l17.489"></a><span id="l17.489" class="difflineplus">+          break;</span>
<a href="#l17.490"></a><span id="l17.490" class="difflineplus">+        }</span>
<a href="#l17.491"></a><span id="l17.491" class="difflineplus">+      }</span>
<a href="#l17.492"></a><span id="l17.492" class="difflineplus">+      if (newViewIndex &lt; 0) {</span>
<a href="#l17.493"></a><span id="l17.493" class="difflineplus">+        // At the end of the child list without finding a visible sibling: This</span>
<a href="#l17.494"></a><span id="l17.494" class="difflineplus">+        // is a little harder because we don't know how many rows the last item</span>
<a href="#l17.495"></a><span id="l17.495" class="difflineplus">+        // in our list takes up (it could be a container with many children).</span>
<a href="#l17.496"></a><span id="l17.496" class="difflineplus">+        var prevChild = aParent.getChild(aNewIndex - 1);</span>
<a href="#l17.497"></a><span id="l17.497" class="difflineplus">+        newViewIndex = prevChild.viewIndex + this._countVisibleRowsForItem(prevChild);</span>
<a href="#l17.498"></a><span id="l17.498" class="difflineplus">+      }</span>
<a href="#l17.499"></a><span id="l17.499" class="difflineplus">+    }</span>
<a href="#l17.500"></a><span id="l17.500" class="difflineplus">+</span>
<a href="#l17.501"></a><span id="l17.501" class="difflineplus">+    aItem.viewIndex = newViewIndex;</span>
<a href="#l17.502"></a><span id="l17.502" class="difflineplus">+    this._visibleElements.splice(newViewIndex, 0,</span>
<a href="#l17.503"></a><span id="l17.503" class="difflineplus">+                                 { node: aItem, properties: null });</span>
<a href="#l17.504"></a><span id="l17.504" class="difflineplus">+    for (var i = newViewIndex + 1;</span>
<a href="#l17.505"></a><span id="l17.505" class="difflineplus">+         i &lt; this._visibleElements.length; i ++) {</span>
<a href="#l17.506"></a><span id="l17.506" class="difflineplus">+      this._visibleElements[i].node.viewIndex = i;</span>
<a href="#l17.507"></a><span id="l17.507" class="difflineplus">+    }</span>
<a href="#l17.508"></a><span id="l17.508" class="difflineplus">+    this._tree.rowCountChanged(newViewIndex, 1);</span>
<a href="#l17.509"></a><span id="l17.509" class="difflineplus">+</span>
<a href="#l17.510"></a><span id="l17.510" class="difflineplus">+    // Need to redraw the rows around this one because session boundaries</span>
<a href="#l17.511"></a><span id="l17.511" class="difflineplus">+    // may have changed. For example, if we add a page to a session, the</span>
<a href="#l17.512"></a><span id="l17.512" class="difflineplus">+    // previous page will need to be redrawn because its session border</span>
<a href="#l17.513"></a><span id="l17.513" class="difflineplus">+    // will disappear.</span>
<a href="#l17.514"></a><span id="l17.514" class="difflineplus">+    if (this._showSessions) {</span>
<a href="#l17.515"></a><span id="l17.515" class="difflineplus">+      if (newViewIndex &gt; 0)</span>
<a href="#l17.516"></a><span id="l17.516" class="difflineplus">+        this._tree.invalidateRange(newViewIndex - 1, newViewIndex - 1);</span>
<a href="#l17.517"></a><span id="l17.517" class="difflineplus">+      if (newViewIndex &lt; this._visibleElements.length -1)</span>
<a href="#l17.518"></a><span id="l17.518" class="difflineplus">+        this._tree.invalidateRange(newViewIndex + 1, newViewIndex + 1);</span>
<a href="#l17.519"></a><span id="l17.519" class="difflineplus">+    }</span>
<a href="#l17.520"></a><span id="l17.520" class="difflineplus">+</span>
<a href="#l17.521"></a><span id="l17.521" class="difflineplus">+    if (PlacesUtils.nodeIsContainer(aItem) &amp;&amp; asContainer(aItem).containerOpen)</span>
<a href="#l17.522"></a><span id="l17.522" class="difflineplus">+      this._refreshVisibleSection(aItem);</span>
<a href="#l17.523"></a><span id="l17.523" class="difflineplus">+  },</span>
<a href="#l17.524"></a><span id="l17.524" class="difflineplus">+</span>
<a href="#l17.525"></a><span id="l17.525" class="difflineplus">+  // this is used in itemRemoved and itemMoved to fix viewIndex values</span>
<a href="#l17.526"></a><span id="l17.526" class="difflineplus">+  // throw if the item has an invalid viewIndex</span>
<a href="#l17.527"></a><span id="l17.527" class="difflineplus">+  _fixViewIndexOnRemove: function PTV_fixViewIndexOnRemove(aItem, aParent) {</span>
<a href="#l17.528"></a><span id="l17.528" class="difflineplus">+    var oldViewIndex = aItem.viewIndex;</span>
<a href="#l17.529"></a><span id="l17.529" class="difflineplus">+    // this may have been a container, in which case it has a lot of rows</span>
<a href="#l17.530"></a><span id="l17.530" class="difflineplus">+    var count = this._countVisibleRowsForItem(aItem);</span>
<a href="#l17.531"></a><span id="l17.531" class="difflineplus">+</span>
<a href="#l17.532"></a><span id="l17.532" class="difflineplus">+    if (oldViewIndex &gt; this._visibleElements.length)</span>
<a href="#l17.533"></a><span id="l17.533" class="difflineplus">+      throw(&quot;Trying to remove an item with an invalid viewIndex&quot;);</span>
<a href="#l17.534"></a><span id="l17.534" class="difflineplus">+</span>
<a href="#l17.535"></a><span id="l17.535" class="difflineplus">+    this._visibleElements.splice(oldViewIndex, count);</span>
<a href="#l17.536"></a><span id="l17.536" class="difflineplus">+    for (var i = oldViewIndex; i &lt; this._visibleElements.length; i++)</span>
<a href="#l17.537"></a><span id="l17.537" class="difflineplus">+      this._visibleElements[i].node.viewIndex = i;</span>
<a href="#l17.538"></a><span id="l17.538" class="difflineplus">+</span>
<a href="#l17.539"></a><span id="l17.539" class="difflineplus">+    this._tree.rowCountChanged(oldViewIndex, -count);</span>
<a href="#l17.540"></a><span id="l17.540" class="difflineplus">+</span>
<a href="#l17.541"></a><span id="l17.541" class="difflineplus">+    // redraw parent because twisty may have changed</span>
<a href="#l17.542"></a><span id="l17.542" class="difflineplus">+    if (!aParent.hasChildren)</span>
<a href="#l17.543"></a><span id="l17.543" class="difflineplus">+      this.itemChanged(aParent);</span>
<a href="#l17.544"></a><span id="l17.544" class="difflineplus">+</span>
<a href="#l17.545"></a><span id="l17.545" class="difflineplus">+    return;</span>
<a href="#l17.546"></a><span id="l17.546" class="difflineplus">+  },</span>
<a href="#l17.547"></a><span id="l17.547" class="difflineplus">+</span>
<a href="#l17.548"></a><span id="l17.548" class="difflineplus">+  /**</span>
<a href="#l17.549"></a><span id="l17.549" class="difflineplus">+   * THIS FUNCTION DOES NOT HANDLE cases where a collapsed node is being</span>
<a href="#l17.550"></a><span id="l17.550" class="difflineplus">+   * removed but the node it is collapsed with is not being removed (this then</span>
<a href="#l17.551"></a><span id="l17.551" class="difflineplus">+   * just swap out the removee with its collapsing partner). The only time</span>
<a href="#l17.552"></a><span id="l17.552" class="difflineplus">+   * when we really remove things is when deleting URIs, which will apply to</span>
<a href="#l17.553"></a><span id="l17.553" class="difflineplus">+   * all collapsees. This function is called sometimes when resorting items.</span>
<a href="#l17.554"></a><span id="l17.554" class="difflineplus">+   * However, we won't do this when sorted by date because dates will never</span>
<a href="#l17.555"></a><span id="l17.555" class="difflineplus">+   * change for visits, and date sorting is the only time things are collapsed.</span>
<a href="#l17.556"></a><span id="l17.556" class="difflineplus">+   */</span>
<a href="#l17.557"></a><span id="l17.557" class="difflineplus">+  itemRemoved: function PTV_itemRemoved(aParent, aItem, aOldIndex) {</span>
<a href="#l17.558"></a><span id="l17.558" class="difflineplus">+    NS_ASSERT(this._result, &quot;Got a notification but have no result!&quot;);</span>
<a href="#l17.559"></a><span id="l17.559" class="difflineplus">+    if (!this._tree)</span>
<a href="#l17.560"></a><span id="l17.560" class="difflineplus">+      return; // nothing to do</span>
<a href="#l17.561"></a><span id="l17.561" class="difflineplus">+</span>
<a href="#l17.562"></a><span id="l17.562" class="difflineplus">+    var oldViewIndex = aItem.viewIndex;</span>
<a href="#l17.563"></a><span id="l17.563" class="difflineplus">+    if (oldViewIndex &lt; 0)</span>
<a href="#l17.564"></a><span id="l17.564" class="difflineplus">+      return; // item was already invisible, nothing to do</span>
<a href="#l17.565"></a><span id="l17.565" class="difflineplus">+</span>
<a href="#l17.566"></a><span id="l17.566" class="difflineplus">+    // if the item was exclusively selected, the node next to it will be</span>
<a href="#l17.567"></a><span id="l17.567" class="difflineplus">+    // selected</span>
<a href="#l17.568"></a><span id="l17.568" class="difflineplus">+    var selectNext = false;</span>
<a href="#l17.569"></a><span id="l17.569" class="difflineplus">+    var selection = this.selection;</span>
<a href="#l17.570"></a><span id="l17.570" class="difflineplus">+    if (selection.getRangeCount() == 1) {</span>
<a href="#l17.571"></a><span id="l17.571" class="difflineplus">+      var min = { }, max = { };</span>
<a href="#l17.572"></a><span id="l17.572" class="difflineplus">+      selection.getRangeAt(0, min, max);</span>
<a href="#l17.573"></a><span id="l17.573" class="difflineplus">+      if (min.value == max.value &amp;&amp;</span>
<a href="#l17.574"></a><span id="l17.574" class="difflineplus">+          this.nodeForTreeIndex(min.value) == aItem)</span>
<a href="#l17.575"></a><span id="l17.575" class="difflineplus">+        selectNext = true;</span>
<a href="#l17.576"></a><span id="l17.576" class="difflineplus">+    }</span>
<a href="#l17.577"></a><span id="l17.577" class="difflineplus">+</span>
<a href="#l17.578"></a><span id="l17.578" class="difflineplus">+    // remove the item and fix viewIndex values</span>
<a href="#l17.579"></a><span id="l17.579" class="difflineplus">+    this._fixViewIndexOnRemove(aItem, aParent);</span>
<a href="#l17.580"></a><span id="l17.580" class="difflineplus">+</span>
<a href="#l17.581"></a><span id="l17.581" class="difflineplus">+    // restore selection if the item was exclusively selected</span>
<a href="#l17.582"></a><span id="l17.582" class="difflineplus">+    if (!selectNext)</span>
<a href="#l17.583"></a><span id="l17.583" class="difflineplus">+      return;</span>
<a href="#l17.584"></a><span id="l17.584" class="difflineplus">+    // restore selection</span>
<a href="#l17.585"></a><span id="l17.585" class="difflineplus">+    if (this._visibleElements.length &gt; oldViewIndex)</span>
<a href="#l17.586"></a><span id="l17.586" class="difflineplus">+      selection.rangedSelect(oldViewIndex, oldViewIndex, true);</span>
<a href="#l17.587"></a><span id="l17.587" class="difflineplus">+    else if (this._visibleElements.length &gt; 0) {</span>
<a href="#l17.588"></a><span id="l17.588" class="difflineplus">+      // if we removed the last child, we select the new last child if exists</span>
<a href="#l17.589"></a><span id="l17.589" class="difflineplus">+      selection.rangedSelect(this._visibleElements.length - 1,</span>
<a href="#l17.590"></a><span id="l17.590" class="difflineplus">+                             this._visibleElements.length - 1, true);</span>
<a href="#l17.591"></a><span id="l17.591" class="difflineplus">+    }</span>
<a href="#l17.592"></a><span id="l17.592" class="difflineplus">+  },</span>
<a href="#l17.593"></a><span id="l17.593" class="difflineplus">+</span>
<a href="#l17.594"></a><span id="l17.594" class="difflineplus">+  /**</span>
<a href="#l17.595"></a><span id="l17.595" class="difflineplus">+   * Be careful, aOldIndex and aNewIndex specify the index in the</span>
<a href="#l17.596"></a><span id="l17.596" class="difflineplus">+   * corresponding parent nodes, not the visible indexes.</span>
<a href="#l17.597"></a><span id="l17.597" class="difflineplus">+   */</span>
<a href="#l17.598"></a><span id="l17.598" class="difflineplus">+  itemMoved:</span>
<a href="#l17.599"></a><span id="l17.599" class="difflineplus">+  function PTV_itemMoved(aItem, aOldParent, aOldIndex, aNewParent, aNewIndex) {</span>
<a href="#l17.600"></a><span id="l17.600" class="difflineplus">+    NS_ASSERT(this._result, &quot;Got a notification but have no result!&quot;);</span>
<a href="#l17.601"></a><span id="l17.601" class="difflineplus">+    if (!this._tree)</span>
<a href="#l17.602"></a><span id="l17.602" class="difflineplus">+      return; // nothing to do</span>
<a href="#l17.603"></a><span id="l17.603" class="difflineplus">+</span>
<a href="#l17.604"></a><span id="l17.604" class="difflineplus">+    var oldViewIndex = aItem.viewIndex;</span>
<a href="#l17.605"></a><span id="l17.605" class="difflineplus">+    if (oldViewIndex &lt; 0)</span>
<a href="#l17.606"></a><span id="l17.606" class="difflineplus">+      return; // item was already invisible, nothing to do</span>
<a href="#l17.607"></a><span id="l17.607" class="difflineplus">+</span>
<a href="#l17.608"></a><span id="l17.608" class="difflineplus">+    // this may have been a container, in which case it has a lot of rows</span>
<a href="#l17.609"></a><span id="l17.609" class="difflineplus">+    var count = this._countVisibleRowsForItem(aItem);</span>
<a href="#l17.610"></a><span id="l17.610" class="difflineplus">+</span>
<a href="#l17.611"></a><span id="l17.611" class="difflineplus">+    // Persist selection state</span>
<a href="#l17.612"></a><span id="l17.612" class="difflineplus">+    var nodesToSelect = [];</span>
<a href="#l17.613"></a><span id="l17.613" class="difflineplus">+    var selection = this.selection;</span>
<a href="#l17.614"></a><span id="l17.614" class="difflineplus">+    var rc = selection.getRangeCount();</span>
<a href="#l17.615"></a><span id="l17.615" class="difflineplus">+    for (var rangeIndex = 0; rangeIndex &lt; rc; rangeIndex++) {</span>
<a href="#l17.616"></a><span id="l17.616" class="difflineplus">+      var min = { }, max = { };</span>
<a href="#l17.617"></a><span id="l17.617" class="difflineplus">+      selection.getRangeAt(rangeIndex, min, max);</span>
<a href="#l17.618"></a><span id="l17.618" class="difflineplus">+      var lastIndex = Math.min(max.value, oldViewIndex + count -1);</span>
<a href="#l17.619"></a><span id="l17.619" class="difflineplus">+      if (min.value &lt; oldViewIndex || min.value &gt; lastIndex)</span>
<a href="#l17.620"></a><span id="l17.620" class="difflineplus">+        continue;</span>
<a href="#l17.621"></a><span id="l17.621" class="difflineplus">+</span>
<a href="#l17.622"></a><span id="l17.622" class="difflineplus">+      for (var nodeIndex = min.value; nodeIndex &lt;= lastIndex; nodeIndex++)</span>
<a href="#l17.623"></a><span id="l17.623" class="difflineplus">+        nodesToSelect.push(this._visibleElements[nodeIndex].node);</span>
<a href="#l17.624"></a><span id="l17.624" class="difflineplus">+    }</span>
<a href="#l17.625"></a><span id="l17.625" class="difflineplus">+    if (nodesToSelect.length &gt; 0)</span>
<a href="#l17.626"></a><span id="l17.626" class="difflineplus">+      selection.selectEventsSuppressed = true;</span>
<a href="#l17.627"></a><span id="l17.627" class="difflineplus">+</span>
<a href="#l17.628"></a><span id="l17.628" class="difflineplus">+    // remove item from the old position</span>
<a href="#l17.629"></a><span id="l17.629" class="difflineplus">+    this._fixViewIndexOnRemove(aItem, aOldParent);</span>
<a href="#l17.630"></a><span id="l17.630" class="difflineplus">+</span>
<a href="#l17.631"></a><span id="l17.631" class="difflineplus">+    // insert the item into the new position</span>
<a href="#l17.632"></a><span id="l17.632" class="difflineplus">+    this.itemInserted(aNewParent, aItem, aNewIndex);</span>
<a href="#l17.633"></a><span id="l17.633" class="difflineplus">+</span>
<a href="#l17.634"></a><span id="l17.634" class="difflineplus">+    // restore selection</span>
<a href="#l17.635"></a><span id="l17.635" class="difflineplus">+    if (nodesToSelect.length &gt; 0) {</span>
<a href="#l17.636"></a><span id="l17.636" class="difflineplus">+      for (var i = 0; i &lt; nodesToSelect.length; i++) {</span>
<a href="#l17.637"></a><span id="l17.637" class="difflineplus">+        var node = nodesToSelect[i];</span>
<a href="#l17.638"></a><span id="l17.638" class="difflineplus">+        var index = node.viewIndex;</span>
<a href="#l17.639"></a><span id="l17.639" class="difflineplus">+        selection.rangedSelect(index, index, true);</span>
<a href="#l17.640"></a><span id="l17.640" class="difflineplus">+      }</span>
<a href="#l17.641"></a><span id="l17.641" class="difflineplus">+      selection.selectEventsSuppressed = false;</span>
<a href="#l17.642"></a><span id="l17.642" class="difflineplus">+    }</span>
<a href="#l17.643"></a><span id="l17.643" class="difflineplus">+  },</span>
<a href="#l17.644"></a><span id="l17.644" class="difflineplus">+</span>
<a href="#l17.645"></a><span id="l17.645" class="difflineplus">+  /**</span>
<a href="#l17.646"></a><span id="l17.646" class="difflineplus">+   * Be careful, the parameter 'aIndex' here specifies the index in the parent</span>
<a href="#l17.647"></a><span id="l17.647" class="difflineplus">+   * node of the item, not the visible index.</span>
<a href="#l17.648"></a><span id="l17.648" class="difflineplus">+   *</span>
<a href="#l17.649"></a><span id="l17.649" class="difflineplus">+   * This is called from the result when the item is replaced, but this object</span>
<a href="#l17.650"></a><span id="l17.650" class="difflineplus">+   * calls this function internally also when duplicate collapsing changes. In</span>
<a href="#l17.651"></a><span id="l17.651" class="difflineplus">+   * this case, aIndex will be 0, so we should be careful not to use the value.</span>
<a href="#l17.652"></a><span id="l17.652" class="difflineplus">+   */</span>
<a href="#l17.653"></a><span id="l17.653" class="difflineplus">+  itemReplaced:</span>
<a href="#l17.654"></a><span id="l17.654" class="difflineplus">+  function PTV_itemReplaced(aParent, aOldItem, aNewItem, aIndexDoNotUse) {</span>
<a href="#l17.655"></a><span id="l17.655" class="difflineplus">+    if (!this._tree)</span>
<a href="#l17.656"></a><span id="l17.656" class="difflineplus">+      return;</span>
<a href="#l17.657"></a><span id="l17.657" class="difflineplus">+</span>
<a href="#l17.658"></a><span id="l17.658" class="difflineplus">+    var viewIndex = aOldItem.viewIndex;</span>
<a href="#l17.659"></a><span id="l17.659" class="difflineplus">+    aNewItem.viewIndex = viewIndex;</span>
<a href="#l17.660"></a><span id="l17.660" class="difflineplus">+    if (viewIndex &gt;= 0 &amp;&amp;</span>
<a href="#l17.661"></a><span id="l17.661" class="difflineplus">+        viewIndex &lt; this._visibleElements.length) {</span>
<a href="#l17.662"></a><span id="l17.662" class="difflineplus">+      this._visibleElements[viewIndex].node = aNewItem;</span>
<a href="#l17.663"></a><span id="l17.663" class="difflineplus">+      this._visibleElements[viewIndex].properties = null;</span>
<a href="#l17.664"></a><span id="l17.664" class="difflineplus">+    }</span>
<a href="#l17.665"></a><span id="l17.665" class="difflineplus">+    aOldItem.viewIndex = -1;</span>
<a href="#l17.666"></a><span id="l17.666" class="difflineplus">+    this._tree.invalidateRow(viewIndex);</span>
<a href="#l17.667"></a><span id="l17.667" class="difflineplus">+  },</span>
<a href="#l17.668"></a><span id="l17.668" class="difflineplus">+</span>
<a href="#l17.669"></a><span id="l17.669" class="difflineplus">+  itemChanged: function PTV_itemChanged(aItem) {</span>
<a href="#l17.670"></a><span id="l17.670" class="difflineplus">+    NS_ASSERT(this._result, &quot;Got a notification but have no result!&quot;);</span>
<a href="#l17.671"></a><span id="l17.671" class="difflineplus">+    var viewIndex = aItem.viewIndex;</span>
<a href="#l17.672"></a><span id="l17.672" class="difflineplus">+    if (this._tree &amp;&amp; viewIndex &gt;= 0)</span>
<a href="#l17.673"></a><span id="l17.673" class="difflineplus">+      this._tree.invalidateRow(viewIndex);</span>
<a href="#l17.674"></a><span id="l17.674" class="difflineplus">+  },</span>
<a href="#l17.675"></a><span id="l17.675" class="difflineplus">+</span>
<a href="#l17.676"></a><span id="l17.676" class="difflineplus">+  containerOpened: function PTV_containerOpened(aItem) {</span>
<a href="#l17.677"></a><span id="l17.677" class="difflineplus">+    this.invalidateContainer(aItem);</span>
<a href="#l17.678"></a><span id="l17.678" class="difflineplus">+  },</span>
<a href="#l17.679"></a><span id="l17.679" class="difflineplus">+</span>
<a href="#l17.680"></a><span id="l17.680" class="difflineplus">+  containerClosed: function PTV_containerClosed(aItem) {</span>
<a href="#l17.681"></a><span id="l17.681" class="difflineplus">+    this.invalidateContainer(aItem);</span>
<a href="#l17.682"></a><span id="l17.682" class="difflineplus">+  },</span>
<a href="#l17.683"></a><span id="l17.683" class="difflineplus">+</span>
<a href="#l17.684"></a><span id="l17.684" class="difflineplus">+  invalidateContainer: function PTV_invalidateContainer(aItem) {</span>
<a href="#l17.685"></a><span id="l17.685" class="difflineplus">+    NS_ASSERT(this._result, &quot;Got a notification but have no result!&quot;);</span>
<a href="#l17.686"></a><span id="l17.686" class="difflineplus">+    if (!this._tree)</span>
<a href="#l17.687"></a><span id="l17.687" class="difflineplus">+      return; // nothing to do, container is not visible</span>
<a href="#l17.688"></a><span id="l17.688" class="difflineplus">+    var viewIndex = aItem.viewIndex;</span>
<a href="#l17.689"></a><span id="l17.689" class="difflineplus">+    if (viewIndex &gt;= this._visibleElements.length) {</span>
<a href="#l17.690"></a><span id="l17.690" class="difflineplus">+      // be paranoid about visible indices since others can change it</span>
<a href="#l17.691"></a><span id="l17.691" class="difflineplus">+      throw Components.results.NS_ERROR_UNEXPECTED;</span>
<a href="#l17.692"></a><span id="l17.692" class="difflineplus">+    }</span>
<a href="#l17.693"></a><span id="l17.693" class="difflineplus">+    this._refreshVisibleSection(aItem);</span>
<a href="#l17.694"></a><span id="l17.694" class="difflineplus">+  },</span>
<a href="#l17.695"></a><span id="l17.695" class="difflineplus">+</span>
<a href="#l17.696"></a><span id="l17.696" class="difflineplus">+  invalidateAll: function PTV_invalidateAll() {</span>
<a href="#l17.697"></a><span id="l17.697" class="difflineplus">+    NS_ASSERT(this._result, &quot;Got message but don't have a result!&quot;);</span>
<a href="#l17.698"></a><span id="l17.698" class="difflineplus">+    if (!this._tree)</span>
<a href="#l17.699"></a><span id="l17.699" class="difflineplus">+      return;</span>
<a href="#l17.700"></a><span id="l17.700" class="difflineplus">+</span>
<a href="#l17.701"></a><span id="l17.701" class="difflineplus">+    var oldRowCount = this._visibleElements.length;</span>
<a href="#l17.702"></a><span id="l17.702" class="difflineplus">+</span>
<a href="#l17.703"></a><span id="l17.703" class="difflineplus">+    // update flat list to new contents</span>
<a href="#l17.704"></a><span id="l17.704" class="difflineplus">+    this._buildVisibleList();</span>
<a href="#l17.705"></a><span id="l17.705" class="difflineplus">+  },</span>
<a href="#l17.706"></a><span id="l17.706" class="difflineplus">+</span>
<a href="#l17.707"></a><span id="l17.707" class="difflineplus">+  sortingChanged: function PTV__sortingChanged(aSortingMode) {</span>
<a href="#l17.708"></a><span id="l17.708" class="difflineplus">+    if (!this._tree || !this._result)</span>
<a href="#l17.709"></a><span id="l17.709" class="difflineplus">+      return;</span>
<a href="#l17.710"></a><span id="l17.710" class="difflineplus">+</span>
<a href="#l17.711"></a><span id="l17.711" class="difflineplus">+    // depending on the sort mode, certain commands may be disabled</span>
<a href="#l17.712"></a><span id="l17.712" class="difflineplus">+    window.updateCommands(&quot;sort&quot;);</span>
<a href="#l17.713"></a><span id="l17.713" class="difflineplus">+</span>
<a href="#l17.714"></a><span id="l17.714" class="difflineplus">+    var columns = this._tree.columns;</span>
<a href="#l17.715"></a><span id="l17.715" class="difflineplus">+</span>
<a href="#l17.716"></a><span id="l17.716" class="difflineplus">+    // clear old sorting indicator</span>
<a href="#l17.717"></a><span id="l17.717" class="difflineplus">+    var sortedColumn = columns.getSortedColumn();</span>
<a href="#l17.718"></a><span id="l17.718" class="difflineplus">+    if (sortedColumn)</span>
<a href="#l17.719"></a><span id="l17.719" class="difflineplus">+      sortedColumn.element.removeAttribute(&quot;sortDirection&quot;);</span>
<a href="#l17.720"></a><span id="l17.720" class="difflineplus">+</span>
<a href="#l17.721"></a><span id="l17.721" class="difflineplus">+    // set new sorting indicator by looking through all columns for ours</span>
<a href="#l17.722"></a><span id="l17.722" class="difflineplus">+    if (aSortingMode == Components.interfaces.nsINavHistoryQueryOptions.SORT_BY_NONE)</span>
<a href="#l17.723"></a><span id="l17.723" class="difflineplus">+      return;</span>
<a href="#l17.724"></a><span id="l17.724" class="difflineplus">+    var [desiredColumn, desiredIsDescending] =</span>
<a href="#l17.725"></a><span id="l17.725" class="difflineplus">+      this._sortTypeToColumnType(aSortingMode);</span>
<a href="#l17.726"></a><span id="l17.726" class="difflineplus">+    var colCount = columns.count;</span>
<a href="#l17.727"></a><span id="l17.727" class="difflineplus">+    for (var i = 0; i &lt; colCount; i ++) {</span>
<a href="#l17.728"></a><span id="l17.728" class="difflineplus">+      var column = columns.getColumnAt(i);</span>
<a href="#l17.729"></a><span id="l17.729" class="difflineplus">+      if (this._getColumnType(column) == desiredColumn) {</span>
<a href="#l17.730"></a><span id="l17.730" class="difflineplus">+        // found our desired one, set</span>
<a href="#l17.731"></a><span id="l17.731" class="difflineplus">+        if (desiredIsDescending)</span>
<a href="#l17.732"></a><span id="l17.732" class="difflineplus">+          column.element.setAttribute(&quot;sortDirection&quot;, &quot;descending&quot;);</span>
<a href="#l17.733"></a><span id="l17.733" class="difflineplus">+        else</span>
<a href="#l17.734"></a><span id="l17.734" class="difflineplus">+          column.element.setAttribute(&quot;sortDirection&quot;, &quot;ascending&quot;);</span>
<a href="#l17.735"></a><span id="l17.735" class="difflineplus">+        break;</span>
<a href="#l17.736"></a><span id="l17.736" class="difflineplus">+      }</span>
<a href="#l17.737"></a><span id="l17.737" class="difflineplus">+    }</span>
<a href="#l17.738"></a><span id="l17.738" class="difflineplus">+  },</span>
<a href="#l17.739"></a><span id="l17.739" class="difflineplus">+</span>
<a href="#l17.740"></a><span id="l17.740" class="difflineplus">+  get result() {</span>
<a href="#l17.741"></a><span id="l17.741" class="difflineplus">+    return this._result;</span>
<a href="#l17.742"></a><span id="l17.742" class="difflineplus">+  },</span>
<a href="#l17.743"></a><span id="l17.743" class="difflineplus">+</span>
<a href="#l17.744"></a><span id="l17.744" class="difflineplus">+  set result(val) {</span>
<a href="#l17.745"></a><span id="l17.745" class="difflineplus">+    // some methods (e.g. getURLsFromContainer) temporarily null out the</span>
<a href="#l17.746"></a><span id="l17.746" class="difflineplus">+    // viewer when they do temporary changes to the view, this does _not_</span>
<a href="#l17.747"></a><span id="l17.747" class="difflineplus">+    // call setResult(null), but then, we're called again with the result</span>
<a href="#l17.748"></a><span id="l17.748" class="difflineplus">+    // object which is already set for this viewer. At that point,</span>
<a href="#l17.749"></a><span id="l17.749" class="difflineplus">+    // we should do nothing.</span>
<a href="#l17.750"></a><span id="l17.750" class="difflineplus">+    if (this._result != val) {</span>
<a href="#l17.751"></a><span id="l17.751" class="difflineplus">+      this._result = val;</span>
<a href="#l17.752"></a><span id="l17.752" class="difflineplus">+      this._finishInit();</span>
<a href="#l17.753"></a><span id="l17.753" class="difflineplus">+    }</span>
<a href="#l17.754"></a><span id="l17.754" class="difflineplus">+    return val;</span>
<a href="#l17.755"></a><span id="l17.755" class="difflineplus">+  },</span>
<a href="#l17.756"></a><span id="l17.756" class="difflineplus">+</span>
<a href="#l17.757"></a><span id="l17.757" class="difflineplus">+  nodeForTreeIndex: function PTV_nodeForTreeIndex(aIndex) {</span>
<a href="#l17.758"></a><span id="l17.758" class="difflineplus">+    if (aIndex &gt; this._visibleElements.length)</span>
<a href="#l17.759"></a><span id="l17.759" class="difflineplus">+      throw Components.results.NS_ERROR_INVALID_ARG;</span>
<a href="#l17.760"></a><span id="l17.760" class="difflineplus">+</span>
<a href="#l17.761"></a><span id="l17.761" class="difflineplus">+    return this._visibleElements[aIndex].node;</span>
<a href="#l17.762"></a><span id="l17.762" class="difflineplus">+  },</span>
<a href="#l17.763"></a><span id="l17.763" class="difflineplus">+</span>
<a href="#l17.764"></a><span id="l17.764" class="difflineplus">+  treeIndexForNode: function PTV_treeNodeForIndex(aNode) {</span>
<a href="#l17.765"></a><span id="l17.765" class="difflineplus">+    var viewIndex = aNode.viewIndex;</span>
<a href="#l17.766"></a><span id="l17.766" class="difflineplus">+    if (viewIndex &lt; 0)</span>
<a href="#l17.767"></a><span id="l17.767" class="difflineplus">+      return Components.interfaces.nsINavHistoryResultTreeViewer.INDEX_INVISIBLE;</span>
<a href="#l17.768"></a><span id="l17.768" class="difflineplus">+</span>
<a href="#l17.769"></a><span id="l17.769" class="difflineplus">+    NS_ASSERT(this._visibleElements[viewIndex].node == aNode,</span>
<a href="#l17.770"></a><span id="l17.770" class="difflineplus">+              &quot;Node's visible index and array out of sync&quot;);</span>
<a href="#l17.771"></a><span id="l17.771" class="difflineplus">+    return viewIndex;</span>
<a href="#l17.772"></a><span id="l17.772" class="difflineplus">+  },</span>
<a href="#l17.773"></a><span id="l17.773" class="difflineplus">+</span>
<a href="#l17.774"></a><span id="l17.774" class="difflineplus">+  _getResourceForNode: function PTV_getResourceForNode(aNode)</span>
<a href="#l17.775"></a><span id="l17.775" class="difflineplus">+  {</span>
<a href="#l17.776"></a><span id="l17.776" class="difflineplus">+    var uri = aNode.uri;</span>
<a href="#l17.777"></a><span id="l17.777" class="difflineplus">+    NS_ASSERT(uri, &quot;if there is no uri, we can't persist the open state&quot;);</span>
<a href="#l17.778"></a><span id="l17.778" class="difflineplus">+    return uri ? PlacesUIUtils.RDF.GetResource(uri) : null;</span>
<a href="#l17.779"></a><span id="l17.779" class="difflineplus">+  },</span>
<a href="#l17.780"></a><span id="l17.780" class="difflineplus">+</span>
<a href="#l17.781"></a><span id="l17.781" class="difflineplus">+  // nsITreeView</span>
<a href="#l17.782"></a><span id="l17.782" class="difflineplus">+  get rowCount() {</span>
<a href="#l17.783"></a><span id="l17.783" class="difflineplus">+    return this._visibleElements.length;</span>
<a href="#l17.784"></a><span id="l17.784" class="difflineplus">+  },</span>
<a href="#l17.785"></a><span id="l17.785" class="difflineplus">+</span>
<a href="#l17.786"></a><span id="l17.786" class="difflineplus">+  get selection() {</span>
<a href="#l17.787"></a><span id="l17.787" class="difflineplus">+    return this._selection;</span>
<a href="#l17.788"></a><span id="l17.788" class="difflineplus">+  },</span>
<a href="#l17.789"></a><span id="l17.789" class="difflineplus">+</span>
<a href="#l17.790"></a><span id="l17.790" class="difflineplus">+  set selection(val) {</span>
<a href="#l17.791"></a><span id="l17.791" class="difflineplus">+    return this._selection = val;</span>
<a href="#l17.792"></a><span id="l17.792" class="difflineplus">+  },</span>
<a href="#l17.793"></a><span id="l17.793" class="difflineplus">+</span>
<a href="#l17.794"></a><span id="l17.794" class="difflineplus">+  getRowProperties: function PTV_getRowProperties(aRow, aProperties) {</span>
<a href="#l17.795"></a><span id="l17.795" class="difflineplus">+    this._ensureValidRow(aRow);</span>
<a href="#l17.796"></a><span id="l17.796" class="difflineplus">+</span>
<a href="#l17.797"></a><span id="l17.797" class="difflineplus">+    // Handle properties for session information.</span>
<a href="#l17.798"></a><span id="l17.798" class="difflineplus">+    if (!this._showSessions)</span>
<a href="#l17.799"></a><span id="l17.799" class="difflineplus">+      return;</span>
<a href="#l17.800"></a><span id="l17.800" class="difflineplus">+</span>
<a href="#l17.801"></a><span id="l17.801" class="difflineplus">+    var status = this._getRowSessionStatus(aRow);</span>
<a href="#l17.802"></a><span id="l17.802" class="difflineplus">+    switch (status) {</span>
<a href="#l17.803"></a><span id="l17.803" class="difflineplus">+      case this.SESSION_STATUS_NONE:</span>
<a href="#l17.804"></a><span id="l17.804" class="difflineplus">+        break;</span>
<a href="#l17.805"></a><span id="l17.805" class="difflineplus">+      case this.SESSION_STATUS_START:</span>
<a href="#l17.806"></a><span id="l17.806" class="difflineplus">+        aProperties.AppendElement(this._getAtomFor(&quot;session-start&quot;));</span>
<a href="#l17.807"></a><span id="l17.807" class="difflineplus">+        break;</span>
<a href="#l17.808"></a><span id="l17.808" class="difflineplus">+      case this.SESSION_STATUS_CONTINUE:</span>
<a href="#l17.809"></a><span id="l17.809" class="difflineplus">+        aProperties.AppendElement(this._getAtomFor(&quot;session-continue&quot;));</span>
<a href="#l17.810"></a><span id="l17.810" class="difflineplus">+        break</span>
<a href="#l17.811"></a><span id="l17.811" class="difflineplus">+    }</span>
<a href="#l17.812"></a><span id="l17.812" class="difflineplus">+  },</span>
<a href="#l17.813"></a><span id="l17.813" class="difflineplus">+</span>
<a href="#l17.814"></a><span id="l17.814" class="difflineplus">+  getCellProperties: function PTV_getCellProperties(aRow, aColumn, aProperties) {</span>
<a href="#l17.815"></a><span id="l17.815" class="difflineplus">+    this._ensureValidRow(aRow);</span>
<a href="#l17.816"></a><span id="l17.816" class="difflineplus">+</span>
<a href="#l17.817"></a><span id="l17.817" class="difflineplus">+    // for anonid-trees, we need to add the column-type manually</span>
<a href="#l17.818"></a><span id="l17.818" class="difflineplus">+    var columnType = aColumn.element.getAttribute(&quot;anonid&quot;);</span>
<a href="#l17.819"></a><span id="l17.819" class="difflineplus">+    if (columnType)</span>
<a href="#l17.820"></a><span id="l17.820" class="difflineplus">+      aProperties.AppendElement(this._getAtomFor(columnType));</span>
<a href="#l17.821"></a><span id="l17.821" class="difflineplus">+    else</span>
<a href="#l17.822"></a><span id="l17.822" class="difflineplus">+      var columnType = aColumn.id;</span>
<a href="#l17.823"></a><span id="l17.823" class="difflineplus">+</span>
<a href="#l17.824"></a><span id="l17.824" class="difflineplus">+    if (columnType != &quot;title&quot;)</span>
<a href="#l17.825"></a><span id="l17.825" class="difflineplus">+      return;</span>
<a href="#l17.826"></a><span id="l17.826" class="difflineplus">+</span>
<a href="#l17.827"></a><span id="l17.827" class="difflineplus">+    var node = this._visibleElements[aRow].node;</span>
<a href="#l17.828"></a><span id="l17.828" class="difflineplus">+    var properties = this._visibleElements[aRow].properties;</span>
<a href="#l17.829"></a><span id="l17.829" class="difflineplus">+</span>
<a href="#l17.830"></a><span id="l17.830" class="difflineplus">+    if (!properties) {</span>
<a href="#l17.831"></a><span id="l17.831" class="difflineplus">+      properties = new Array();</span>
<a href="#l17.832"></a><span id="l17.832" class="difflineplus">+      var itemId = node.itemId;</span>
<a href="#l17.833"></a><span id="l17.833" class="difflineplus">+      var nodeType = node.type;</span>
<a href="#l17.834"></a><span id="l17.834" class="difflineplus">+      if (PlacesUtils.containerTypes.indexOf(nodeType) != -1) {</span>
<a href="#l17.835"></a><span id="l17.835" class="difflineplus">+        if (nodeType == Components.interfaces.nsINavHistoryResultNode.RESULT_TYPE_QUERY) {</span>
<a href="#l17.836"></a><span id="l17.836" class="difflineplus">+          properties.push(this._getAtomFor(&quot;query&quot;));</span>
<a href="#l17.837"></a><span id="l17.837" class="difflineplus">+          if (PlacesUtils.nodeIsTagQuery(node))</span>
<a href="#l17.838"></a><span id="l17.838" class="difflineplus">+            properties.push(this._getAtomFor(&quot;tagContainer&quot;));</span>
<a href="#l17.839"></a><span id="l17.839" class="difflineplus">+          else if (PlacesUtils.nodeIsDay(node))</span>
<a href="#l17.840"></a><span id="l17.840" class="difflineplus">+            properties.push(this._getAtomFor(&quot;dayContainer&quot;));</span>
<a href="#l17.841"></a><span id="l17.841" class="difflineplus">+          else if (PlacesUtils.nodeIsHost(node))</span>
<a href="#l17.842"></a><span id="l17.842" class="difflineplus">+            properties.push(this._getAtomFor(&quot;hostContainer&quot;));</span>
<a href="#l17.843"></a><span id="l17.843" class="difflineplus">+        }</span>
<a href="#l17.844"></a><span id="l17.844" class="difflineplus">+</span>
<a href="#l17.845"></a><span id="l17.845" class="difflineplus">+        if (itemId != -1) {</span>
<a href="#l17.846"></a><span id="l17.846" class="difflineplus">+          var oqAnno;</span>
<a href="#l17.847"></a><span id="l17.847" class="difflineplus">+          try {</span>
<a href="#l17.848"></a><span id="l17.848" class="difflineplus">+            oqAnno = PlacesUtils.annotations</span>
<a href="#l17.849"></a><span id="l17.849" class="difflineplus">+                                .getItemAnnotation(itemId,</span>
<a href="#l17.850"></a><span id="l17.850" class="difflineplus">+                                                   ORGANIZER_QUERY_ANNO);</span>
<a href="#l17.851"></a><span id="l17.851" class="difflineplus">+            properties.push(this._getAtomFor(&quot;OrganizerQuery_&quot; + oqAnno));</span>
<a href="#l17.852"></a><span id="l17.852" class="difflineplus">+          }</span>
<a href="#l17.853"></a><span id="l17.853" class="difflineplus">+          catch (ex) { /* not a special query */ }</span>
<a href="#l17.854"></a><span id="l17.854" class="difflineplus">+        }</span>
<a href="#l17.855"></a><span id="l17.855" class="difflineplus">+      }</span>
<a href="#l17.856"></a><span id="l17.856" class="difflineplus">+</span>
<a href="#l17.857"></a><span id="l17.857" class="difflineplus">+      this._visibleElements[aRow].properties = properties;</span>
<a href="#l17.858"></a><span id="l17.858" class="difflineplus">+    }</span>
<a href="#l17.859"></a><span id="l17.859" class="difflineplus">+    for (var i = 0; i &lt; properties.length; i++)</span>
<a href="#l17.860"></a><span id="l17.860" class="difflineplus">+      aProperties.AppendElement(properties[i]);</span>
<a href="#l17.861"></a><span id="l17.861" class="difflineplus">+  },</span>
<a href="#l17.862"></a><span id="l17.862" class="difflineplus">+</span>
<a href="#l17.863"></a><span id="l17.863" class="difflineplus">+  getColumnProperties: function(aColumn, aProperties) { },</span>
<a href="#l17.864"></a><span id="l17.864" class="difflineplus">+</span>
<a href="#l17.865"></a><span id="l17.865" class="difflineplus">+  isContainer: function PTV_isContainer(aRow) {</span>
<a href="#l17.866"></a><span id="l17.866" class="difflineplus">+    this._ensureValidRow(aRow);</span>
<a href="#l17.867"></a><span id="l17.867" class="difflineplus">+</span>
<a href="#l17.868"></a><span id="l17.868" class="difflineplus">+    var node = this._visibleElements[aRow].node;</span>
<a href="#l17.869"></a><span id="l17.869" class="difflineplus">+    if (PlacesUtils.nodeIsContainer(node)) {</span>
<a href="#l17.870"></a><span id="l17.870" class="difflineplus">+      // the root node is always expandable</span>
<a href="#l17.871"></a><span id="l17.871" class="difflineplus">+      if (!node.parent)</span>
<a href="#l17.872"></a><span id="l17.872" class="difflineplus">+        return true;</span>
<a href="#l17.873"></a><span id="l17.873" class="difflineplus">+</span>
<a href="#l17.874"></a><span id="l17.874" class="difflineplus">+      // Flat-lists may ignore expandQueries and other query options when</span>
<a href="#l17.875"></a><span id="l17.875" class="difflineplus">+      // they are asked to open a container.</span>
<a href="#l17.876"></a><span id="l17.876" class="difflineplus">+      if (this._flatList)</span>
<a href="#l17.877"></a><span id="l17.877" class="difflineplus">+        return true;</span>
<a href="#l17.878"></a><span id="l17.878" class="difflineplus">+</span>
<a href="#l17.879"></a><span id="l17.879" class="difflineplus">+      // treat non-expandable childless queries as non-containers</span>
<a href="#l17.880"></a><span id="l17.880" class="difflineplus">+      if (PlacesUtils.nodeIsQuery(node)) {</span>
<a href="#l17.881"></a><span id="l17.881" class="difflineplus">+        var parent = node.parent;</span>
<a href="#l17.882"></a><span id="l17.882" class="difflineplus">+        if((PlacesUtils.nodeIsQuery(parent) ||</span>
<a href="#l17.883"></a><span id="l17.883" class="difflineplus">+            PlacesUtils.nodeIsFolder(parent)) &amp;&amp;</span>
<a href="#l17.884"></a><span id="l17.884" class="difflineplus">+           !node.hasChildren)</span>
<a href="#l17.885"></a><span id="l17.885" class="difflineplus">+          return asQuery(parent).queryOptions.expandQueries;</span>
<a href="#l17.886"></a><span id="l17.886" class="difflineplus">+      }</span>
<a href="#l17.887"></a><span id="l17.887" class="difflineplus">+      return true;</span>
<a href="#l17.888"></a><span id="l17.888" class="difflineplus">+    }</span>
<a href="#l17.889"></a><span id="l17.889" class="difflineplus">+    return false;</span>
<a href="#l17.890"></a><span id="l17.890" class="difflineplus">+  },</span>
<a href="#l17.891"></a><span id="l17.891" class="difflineplus">+</span>
<a href="#l17.892"></a><span id="l17.892" class="difflineplus">+  isContainerOpen: function PTV_isContainerOpen(aRow) {</span>
<a href="#l17.893"></a><span id="l17.893" class="difflineplus">+    if (this._flatList)</span>
<a href="#l17.894"></a><span id="l17.894" class="difflineplus">+      return false;</span>
<a href="#l17.895"></a><span id="l17.895" class="difflineplus">+</span>
<a href="#l17.896"></a><span id="l17.896" class="difflineplus">+    this._ensureValidRow(aRow);</span>
<a href="#l17.897"></a><span id="l17.897" class="difflineplus">+    if (!PlacesUtils.nodeIsContainer(this._visibleElements[aRow].node))</span>
<a href="#l17.898"></a><span id="l17.898" class="difflineplus">+      throw Components.results.NS_ERROR_INVALID_ARG;</span>
<a href="#l17.899"></a><span id="l17.899" class="difflineplus">+</span>
<a href="#l17.900"></a><span id="l17.900" class="difflineplus">+    return this._visibleElements[aRow].node.containerOpen;</span>
<a href="#l17.901"></a><span id="l17.901" class="difflineplus">+  },</span>
<a href="#l17.902"></a><span id="l17.902" class="difflineplus">+</span>
<a href="#l17.903"></a><span id="l17.903" class="difflineplus">+  isContainerEmpty: function PTV_isContainerEmpty(aRow) {</span>
<a href="#l17.904"></a><span id="l17.904" class="difflineplus">+    if (this._flatList)</span>
<a href="#l17.905"></a><span id="l17.905" class="difflineplus">+      return true;</span>
<a href="#l17.906"></a><span id="l17.906" class="difflineplus">+</span>
<a href="#l17.907"></a><span id="l17.907" class="difflineplus">+    this._ensureValidRow(aRow);</span>
<a href="#l17.908"></a><span id="l17.908" class="difflineplus">+</span>
<a href="#l17.909"></a><span id="l17.909" class="difflineplus">+    if (!PlacesUtils.nodeIsContainer(this._visibleElements[aRow].node))</span>
<a href="#l17.910"></a><span id="l17.910" class="difflineplus">+      throw Components.results.NS_ERROR_INVALID_ARG;</span>
<a href="#l17.911"></a><span id="l17.911" class="difflineplus">+</span>
<a href="#l17.912"></a><span id="l17.912" class="difflineplus">+    return !this._visibleElements[aRow].node.hasChildren;</span>
<a href="#l17.913"></a><span id="l17.913" class="difflineplus">+  },</span>
<a href="#l17.914"></a><span id="l17.914" class="difflineplus">+</span>
<a href="#l17.915"></a><span id="l17.915" class="difflineplus">+  isSeparator: function PTV_isSeparator(aRow) {</span>
<a href="#l17.916"></a><span id="l17.916" class="difflineplus">+    this._ensureValidRow(aRow);</span>
<a href="#l17.917"></a><span id="l17.917" class="difflineplus">+    return PlacesUtils.nodeIsSeparator(this._visibleElements[aRow].node);</span>
<a href="#l17.918"></a><span id="l17.918" class="difflineplus">+  },</span>
<a href="#l17.919"></a><span id="l17.919" class="difflineplus">+</span>
<a href="#l17.920"></a><span id="l17.920" class="difflineplus">+  isSorted: function PTV_isSorted() {</span>
<a href="#l17.921"></a><span id="l17.921" class="difflineplus">+    return this._result.sortingMode !=</span>
<a href="#l17.922"></a><span id="l17.922" class="difflineplus">+           Components.interfaces.nsINavHistoryQueryOptions.SORT_BY_NONE;</span>
<a href="#l17.923"></a><span id="l17.923" class="difflineplus">+  },</span>
<a href="#l17.924"></a><span id="l17.924" class="difflineplus">+</span>
<a href="#l17.925"></a><span id="l17.925" class="difflineplus">+  canDrop: function PTV_canDrop(aRow, aOrientation) {</span>
<a href="#l17.926"></a><span id="l17.926" class="difflineplus">+    // compat to general places tree, but you can never drop URLs into history</span>
<a href="#l17.927"></a><span id="l17.927" class="difflineplus">+    return false;</span>
<a href="#l17.928"></a><span id="l17.928" class="difflineplus">+  },</span>
<a href="#l17.929"></a><span id="l17.929" class="difflineplus">+</span>
<a href="#l17.930"></a><span id="l17.930" class="difflineplus">+  drop: function PTV_drop(aRow, aOrientation) {</span>
<a href="#l17.931"></a><span id="l17.931" class="difflineplus">+    // compat to general places tree, but you can never drop into history</span>
<a href="#l17.932"></a><span id="l17.932" class="difflineplus">+    return;</span>
<a href="#l17.933"></a><span id="l17.933" class="difflineplus">+  },</span>
<a href="#l17.934"></a><span id="l17.934" class="difflineplus">+</span>
<a href="#l17.935"></a><span id="l17.935" class="difflineplus">+  getParentIndex: function PTV_getParentIndex(aRow) {</span>
<a href="#l17.936"></a><span id="l17.936" class="difflineplus">+    this._ensureValidRow(aRow);</span>
<a href="#l17.937"></a><span id="l17.937" class="difflineplus">+    var parent = this._visibleElements[aRow].node.parent;</span>
<a href="#l17.938"></a><span id="l17.938" class="difflineplus">+    if (!parent || parent.viewIndex &lt; 0)</span>
<a href="#l17.939"></a><span id="l17.939" class="difflineplus">+      return -1;</span>
<a href="#l17.940"></a><span id="l17.940" class="difflineplus">+</span>
<a href="#l17.941"></a><span id="l17.941" class="difflineplus">+    return parent.viewIndex;</span>
<a href="#l17.942"></a><span id="l17.942" class="difflineplus">+  },</span>
<a href="#l17.943"></a><span id="l17.943" class="difflineplus">+</span>
<a href="#l17.944"></a><span id="l17.944" class="difflineplus">+  hasNextSibling: function PTV_hasNextSibling(aRow, aAfterIndex) {</span>
<a href="#l17.945"></a><span id="l17.945" class="difflineplus">+    this._ensureValidRow(aRow);</span>
<a href="#l17.946"></a><span id="l17.946" class="difflineplus">+    if (aRow == this._visibleElements.length -1) {</span>
<a href="#l17.947"></a><span id="l17.947" class="difflineplus">+      // this is the last thing in the list -&gt; no next sibling</span>
<a href="#l17.948"></a><span id="l17.948" class="difflineplus">+      return false;</span>
<a href="#l17.949"></a><span id="l17.949" class="difflineplus">+    }</span>
<a href="#l17.950"></a><span id="l17.950" class="difflineplus">+</span>
<a href="#l17.951"></a><span id="l17.951" class="difflineplus">+    var thisLevel = this._visibleElements[aRow].node.indentLevel;</span>
<a href="#l17.952"></a><span id="l17.952" class="difflineplus">+    for (var i = aAfterIndex + 1; i &lt; this._visibleElements.length; ++i) {</span>
<a href="#l17.953"></a><span id="l17.953" class="difflineplus">+      var nextLevel = this._visibleElements[i].node.indentLevel;</span>
<a href="#l17.954"></a><span id="l17.954" class="difflineplus">+      if (nextLevel == thisLevel)</span>
<a href="#l17.955"></a><span id="l17.955" class="difflineplus">+        return true;</span>
<a href="#l17.956"></a><span id="l17.956" class="difflineplus">+      if (nextLevel &lt; thisLevel)</span>
<a href="#l17.957"></a><span id="l17.957" class="difflineplus">+        break;</span>
<a href="#l17.958"></a><span id="l17.958" class="difflineplus">+    }</span>
<a href="#l17.959"></a><span id="l17.959" class="difflineplus">+    return false;</span>
<a href="#l17.960"></a><span id="l17.960" class="difflineplus">+  },</span>
<a href="#l17.961"></a><span id="l17.961" class="difflineplus">+</span>
<a href="#l17.962"></a><span id="l17.962" class="difflineplus">+  getLevel: function PTV_getLevel(aRow) {</span>
<a href="#l17.963"></a><span id="l17.963" class="difflineplus">+    this._ensureValidRow(aRow);</span>
<a href="#l17.964"></a><span id="l17.964" class="difflineplus">+</span>
<a href="#l17.965"></a><span id="l17.965" class="difflineplus">+    return this._visibleElements[aRow].node.indentLevel;</span>
<a href="#l17.966"></a><span id="l17.966" class="difflineplus">+  },</span>
<a href="#l17.967"></a><span id="l17.967" class="difflineplus">+</span>
<a href="#l17.968"></a><span id="l17.968" class="difflineplus">+  getImageSrc: function PTV_getImageSrc(aRow, aColumn) {</span>
<a href="#l17.969"></a><span id="l17.969" class="difflineplus">+    this._ensureValidRow(aRow);</span>
<a href="#l17.970"></a><span id="l17.970" class="difflineplus">+</span>
<a href="#l17.971"></a><span id="l17.971" class="difflineplus">+    // only the title column has an image</span>
<a href="#l17.972"></a><span id="l17.972" class="difflineplus">+    if (this._getColumnType(aColumn) != this.COLUMN_TYPE_TITLE)</span>
<a href="#l17.973"></a><span id="l17.973" class="difflineplus">+      return &quot;&quot;;</span>
<a href="#l17.974"></a><span id="l17.974" class="difflineplus">+</span>
<a href="#l17.975"></a><span id="l17.975" class="difflineplus">+    var node = this._visibleElements[aRow].node;</span>
<a href="#l17.976"></a><span id="l17.976" class="difflineplus">+    var icon = node.icon;</span>
<a href="#l17.977"></a><span id="l17.977" class="difflineplus">+    if (icon)</span>
<a href="#l17.978"></a><span id="l17.978" class="difflineplus">+      return icon.spec;</span>
<a href="#l17.979"></a><span id="l17.979" class="difflineplus">+    return &quot;&quot;;</span>
<a href="#l17.980"></a><span id="l17.980" class="difflineplus">+  },</span>
<a href="#l17.981"></a><span id="l17.981" class="difflineplus">+</span>
<a href="#l17.982"></a><span id="l17.982" class="difflineplus">+  getProgressMode: function(aRow, aColumn) { },</span>
<a href="#l17.983"></a><span id="l17.983" class="difflineplus">+  getCellValue: function(aRow, aColumn) { },</span>
<a href="#l17.984"></a><span id="l17.984" class="difflineplus">+</span>
<a href="#l17.985"></a><span id="l17.985" class="difflineplus">+  getCellText: function PTV_getCellText(aRow, aColumn) {</span>
<a href="#l17.986"></a><span id="l17.986" class="difflineplus">+    this._ensureValidRow(aRow);</span>
<a href="#l17.987"></a><span id="l17.987" class="difflineplus">+</span>
<a href="#l17.988"></a><span id="l17.988" class="difflineplus">+    var node = this._visibleElements[aRow].node;</span>
<a href="#l17.989"></a><span id="l17.989" class="difflineplus">+    var columnType = this._getColumnType(aColumn);</span>
<a href="#l17.990"></a><span id="l17.990" class="difflineplus">+    switch (columnType) {</span>
<a href="#l17.991"></a><span id="l17.991" class="difflineplus">+      case this.COLUMN_TYPE_TITLE:</span>
<a href="#l17.992"></a><span id="l17.992" class="difflineplus">+        // normally, this is just the title, but we don't want empty items in</span>
<a href="#l17.993"></a><span id="l17.993" class="difflineplus">+        // the tree view so return a special string if the title is empty.</span>
<a href="#l17.994"></a><span id="l17.994" class="difflineplus">+        // Do it here so that callers can still get at the 0 length title</span>
<a href="#l17.995"></a><span id="l17.995" class="difflineplus">+        // if they go through the &quot;result&quot; API.</span>
<a href="#l17.996"></a><span id="l17.996" class="difflineplus">+        return PlacesUIUtils.getBestTitle(node);</span>
<a href="#l17.997"></a><span id="l17.997" class="difflineplus">+      case this.COLUMN_TYPE_TAGS:</span>
<a href="#l17.998"></a><span id="l17.998" class="difflineplus">+        return node.tags;</span>
<a href="#l17.999"></a><span id="l17.999" class="difflineplus">+      case this.COLUMN_TYPE_URI:</span>
<a href="#l17.1000"></a><span id="l17.1000" class="difflineplus">+        if (PlacesUtils.nodeIsURI(node))</span>
<a href="#l17.1001"></a><span id="l17.1001" class="difflineplus">+          return node.uri;</span>
<a href="#l17.1002"></a><span id="l17.1002" class="difflineplus">+        return &quot;&quot;;</span>
<a href="#l17.1003"></a><span id="l17.1003" class="difflineplus">+      case this.COLUMN_TYPE_DATE:</span>
<a href="#l17.1004"></a><span id="l17.1004" class="difflineplus">+        if (node.time == 0 || !PlacesUtils.nodeIsURI(node)) {</span>
<a href="#l17.1005"></a><span id="l17.1005" class="difflineplus">+          // hosts and days shouldn't have a value for the date column.</span>
<a href="#l17.1006"></a><span id="l17.1006" class="difflineplus">+          // Actually, you could argue this point, but looking at the</span>
<a href="#l17.1007"></a><span id="l17.1007" class="difflineplus">+          // results, seeing the most recently visited date is not what</span>
<a href="#l17.1008"></a><span id="l17.1008" class="difflineplus">+          // I expect, and gives me no information I know how to use.</span>
<a href="#l17.1009"></a><span id="l17.1009" class="difflineplus">+          // Only show this for URI-based items.</span>
<a href="#l17.1010"></a><span id="l17.1010" class="difflineplus">+          return &quot;&quot;;</span>
<a href="#l17.1011"></a><span id="l17.1011" class="difflineplus">+        }</span>
<a href="#l17.1012"></a><span id="l17.1012" class="difflineplus">+        if (this._getRowSessionStatus(aRow) != this.SESSION_STATUS_CONTINUE)</span>
<a href="#l17.1013"></a><span id="l17.1013" class="difflineplus">+          return this._convertPRTimeToString(node.time);</span>
<a href="#l17.1014"></a><span id="l17.1014" class="difflineplus">+        return &quot;&quot;;</span>
<a href="#l17.1015"></a><span id="l17.1015" class="difflineplus">+      case this.COLUMN_TYPE_VISITCOUNT:</span>
<a href="#l17.1016"></a><span id="l17.1016" class="difflineplus">+        return node.accessCount;</span>
<a href="#l17.1017"></a><span id="l17.1017" class="difflineplus">+    }</span>
<a href="#l17.1018"></a><span id="l17.1018" class="difflineplus">+    return &quot;&quot;;</span>
<a href="#l17.1019"></a><span id="l17.1019" class="difflineplus">+  },</span>
<a href="#l17.1020"></a><span id="l17.1020" class="difflineplus">+</span>
<a href="#l17.1021"></a><span id="l17.1021" class="difflineplus">+  setTree: function PTV_setTree(aTree) {</span>
<a href="#l17.1022"></a><span id="l17.1022" class="difflineplus">+    var hasOldTree = this._tree != null;</span>
<a href="#l17.1023"></a><span id="l17.1023" class="difflineplus">+    this._tree = aTree;</span>
<a href="#l17.1024"></a><span id="l17.1024" class="difflineplus">+</span>
<a href="#l17.1025"></a><span id="l17.1025" class="difflineplus">+    // do this before detaching from result when there is no tree.</span>
<a href="#l17.1026"></a><span id="l17.1026" class="difflineplus">+    // This ensures that the visible indices of the elements in the</span>
<a href="#l17.1027"></a><span id="l17.1027" class="difflineplus">+    // result have been set to -1</span>
<a href="#l17.1028"></a><span id="l17.1028" class="difflineplus">+    this._finishInit();</span>
<a href="#l17.1029"></a><span id="l17.1029" class="difflineplus">+</span>
<a href="#l17.1030"></a><span id="l17.1030" class="difflineplus">+    if (!aTree &amp;&amp; hasOldTree &amp;&amp; this._result) {</span>
<a href="#l17.1031"></a><span id="l17.1031" class="difflineplus">+      // detach from result when we are detaching from the tree.</span>
<a href="#l17.1032"></a><span id="l17.1032" class="difflineplus">+      // This breaks the reference cycle between us and the result.</span>
<a href="#l17.1033"></a><span id="l17.1033" class="difflineplus">+      this._result.viewer = null;</span>
<a href="#l17.1034"></a><span id="l17.1034" class="difflineplus">+    }</span>
<a href="#l17.1035"></a><span id="l17.1035" class="difflineplus">+  },</span>
<a href="#l17.1036"></a><span id="l17.1036" class="difflineplus">+</span>
<a href="#l17.1037"></a><span id="l17.1037" class="difflineplus">+  toggleOpenState: function PTV_toggleOpenState(aRow) {</span>
<a href="#l17.1038"></a><span id="l17.1038" class="difflineplus">+    if (!this._result)</span>
<a href="#l17.1039"></a><span id="l17.1039" class="difflineplus">+      throw Components.results.NS_ERROR_UNEXPECTED;</span>
<a href="#l17.1040"></a><span id="l17.1040" class="difflineplus">+    this._ensureValidRow(aRow);</span>
<a href="#l17.1041"></a><span id="l17.1041" class="difflineplus">+</span>
<a href="#l17.1042"></a><span id="l17.1042" class="difflineplus">+    var node = this._visibleElements[aRow].node;</span>
<a href="#l17.1043"></a><span id="l17.1043" class="difflineplus">+    if (!PlacesUtils.nodeIsContainer(node))</span>
<a href="#l17.1044"></a><span id="l17.1044" class="difflineplus">+      return; // not a container, nothing to do</span>
<a href="#l17.1045"></a><span id="l17.1045" class="difflineplus">+</span>
<a href="#l17.1046"></a><span id="l17.1046" class="difflineplus">+    var resource = this._getResourceForNode(node);</span>
<a href="#l17.1047"></a><span id="l17.1047" class="difflineplus">+    if (resource) {</span>
<a href="#l17.1048"></a><span id="l17.1048" class="difflineplus">+      const openLiteral = PlacesUIUtils.RDF.GetResource(&quot;http://home.netscape.com/NC-rdf#open&quot;);</span>
<a href="#l17.1049"></a><span id="l17.1049" class="difflineplus">+      const trueLiteral = PlacesUIUtils.RDF.GetLiteral(&quot;true&quot;);</span>
<a href="#l17.1050"></a><span id="l17.1050" class="difflineplus">+</span>
<a href="#l17.1051"></a><span id="l17.1051" class="difflineplus">+      if (node.containerOpen)</span>
<a href="#l17.1052"></a><span id="l17.1052" class="difflineplus">+        PlacesUIUtils.localStore.Unassert(resource, openLiteral, trueLiteral);</span>
<a href="#l17.1053"></a><span id="l17.1053" class="difflineplus">+      else</span>
<a href="#l17.1054"></a><span id="l17.1054" class="difflineplus">+        PlacesUIUtils.localStore.Assert(resource, openLiteral, trueLiteral, true);</span>
<a href="#l17.1055"></a><span id="l17.1055" class="difflineplus">+    }</span>
<a href="#l17.1056"></a><span id="l17.1056" class="difflineplus">+</span>
<a href="#l17.1057"></a><span id="l17.1057" class="difflineplus">+    node.containerOpen = !node.containerOpen;</span>
<a href="#l17.1058"></a><span id="l17.1058" class="difflineplus">+  },</span>
<a href="#l17.1059"></a><span id="l17.1059" class="difflineplus">+</span>
<a href="#l17.1060"></a><span id="l17.1060" class="difflineplus">+  cycleHeader: function PTV_cycleHeader(aColumn) {</span>
<a href="#l17.1061"></a><span id="l17.1061" class="difflineplus">+    if (!this._result)</span>
<a href="#l17.1062"></a><span id="l17.1062" class="difflineplus">+      throw Components.results.NS_ERROR_UNEXPECTED;</span>
<a href="#l17.1063"></a><span id="l17.1063" class="difflineplus">+</span>
<a href="#l17.1064"></a><span id="l17.1064" class="difflineplus">+    var oldSort = this._result.sortingMode;</span>
<a href="#l17.1065"></a><span id="l17.1065" class="difflineplus">+    var oldSortingAnnotation = this._result.sortingAnnotation;</span>
<a href="#l17.1066"></a><span id="l17.1066" class="difflineplus">+    var newSort;</span>
<a href="#l17.1067"></a><span id="l17.1067" class="difflineplus">+    var newSortingAnnotation = &quot;&quot;;</span>
<a href="#l17.1068"></a><span id="l17.1068" class="difflineplus">+    const NHQO = Components.interfaces.nsINavHistoryQueryOptions;</span>
<a href="#l17.1069"></a><span id="l17.1069" class="difflineplus">+    var columnType = this._getColumnType(aColumn);</span>
<a href="#l17.1070"></a><span id="l17.1070" class="difflineplus">+    switch (columnType) {</span>
<a href="#l17.1071"></a><span id="l17.1071" class="difflineplus">+      case this.COLUMN_TYPE_TITLE:</span>
<a href="#l17.1072"></a><span id="l17.1072" class="difflineplus">+        if (oldSort == NHQO.SORT_BY_TITLE_ASCENDING)</span>
<a href="#l17.1073"></a><span id="l17.1073" class="difflineplus">+          newSort = NHQO.SORT_BY_TITLE_DESCENDING;</span>
<a href="#l17.1074"></a><span id="l17.1074" class="difflineplus">+        else</span>
<a href="#l17.1075"></a><span id="l17.1075" class="difflineplus">+          newSort = NHQO.SORT_BY_TITLE_ASCENDING;</span>
<a href="#l17.1076"></a><span id="l17.1076" class="difflineplus">+</span>
<a href="#l17.1077"></a><span id="l17.1077" class="difflineplus">+        break;</span>
<a href="#l17.1078"></a><span id="l17.1078" class="difflineplus">+      case this.COLUMN_TYPE_URI:</span>
<a href="#l17.1079"></a><span id="l17.1079" class="difflineplus">+        if (oldSort == NHQO.SORT_BY_URI_ASCENDING)</span>
<a href="#l17.1080"></a><span id="l17.1080" class="difflineplus">+          newSort = NHQO.SORT_BY_URI_DESCENDING;</span>
<a href="#l17.1081"></a><span id="l17.1081" class="difflineplus">+        else</span>
<a href="#l17.1082"></a><span id="l17.1082" class="difflineplus">+          newSort = NHQO.SORT_BY_URI_ASCENDING;</span>
<a href="#l17.1083"></a><span id="l17.1083" class="difflineplus">+</span>
<a href="#l17.1084"></a><span id="l17.1084" class="difflineplus">+        break;</span>
<a href="#l17.1085"></a><span id="l17.1085" class="difflineplus">+      case this.COLUMN_TYPE_DATE:</span>
<a href="#l17.1086"></a><span id="l17.1086" class="difflineplus">+        if (oldSort == NHQO.SORT_BY_DATE_ASCENDING)</span>
<a href="#l17.1087"></a><span id="l17.1087" class="difflineplus">+          newSort = NHQO.SORT_BY_DATE_DESCENDING;</span>
<a href="#l17.1088"></a><span id="l17.1088" class="difflineplus">+        else</span>
<a href="#l17.1089"></a><span id="l17.1089" class="difflineplus">+          newSort = NHQO.SORT_BY_DATE_ASCENDING;</span>
<a href="#l17.1090"></a><span id="l17.1090" class="difflineplus">+</span>
<a href="#l17.1091"></a><span id="l17.1091" class="difflineplus">+        break;</span>
<a href="#l17.1092"></a><span id="l17.1092" class="difflineplus">+      case this.COLUMN_TYPE_VISITCOUNT:</span>
<a href="#l17.1093"></a><span id="l17.1093" class="difflineplus">+        // visit count default is unusual because we sort by descending</span>
<a href="#l17.1094"></a><span id="l17.1094" class="difflineplus">+        // by default because you are most likely to be looking for</span>
<a href="#l17.1095"></a><span id="l17.1095" class="difflineplus">+        // highly visited sites when you click it</span>
<a href="#l17.1096"></a><span id="l17.1096" class="difflineplus">+        if (oldSort == NHQO.SORT_BY_VISITCOUNT_DESCENDING)</span>
<a href="#l17.1097"></a><span id="l17.1097" class="difflineplus">+          newSort = NHQO.SORT_BY_VISITCOUNT_ASCENDING;</span>
<a href="#l17.1098"></a><span id="l17.1098" class="difflineplus">+        else</span>
<a href="#l17.1099"></a><span id="l17.1099" class="difflineplus">+          newSort = NHQO.SORT_BY_VISITCOUNT_DESCENDING;</span>
<a href="#l17.1100"></a><span id="l17.1100" class="difflineplus">+</span>
<a href="#l17.1101"></a><span id="l17.1101" class="difflineplus">+        break;</span>
<a href="#l17.1102"></a><span id="l17.1102" class="difflineplus">+      default:</span>
<a href="#l17.1103"></a><span id="l17.1103" class="difflineplus">+        throw Components.results.NS_ERROR_INVALID_ARG;</span>
<a href="#l17.1104"></a><span id="l17.1104" class="difflineplus">+    }</span>
<a href="#l17.1105"></a><span id="l17.1105" class="difflineplus">+    this._result.sortingAnnotation = newSortingAnnotation;</span>
<a href="#l17.1106"></a><span id="l17.1106" class="difflineplus">+    this._result.sortingMode = newSort;</span>
<a href="#l17.1107"></a><span id="l17.1107" class="difflineplus">+  },</span>
<a href="#l17.1108"></a><span id="l17.1108" class="difflineplus">+</span>
<a href="#l17.1109"></a><span id="l17.1109" class="difflineplus">+  isEditable: function PTV_isEditable(aRow, aColumn) {</span>
<a href="#l17.1110"></a><span id="l17.1110" class="difflineplus">+    // At this point we only support editing the title field.</span>
<a href="#l17.1111"></a><span id="l17.1111" class="difflineplus">+    if (aColumn.index != 0)</span>
<a href="#l17.1112"></a><span id="l17.1112" class="difflineplus">+      return false;</span>
<a href="#l17.1113"></a><span id="l17.1113" class="difflineplus">+</span>
<a href="#l17.1114"></a><span id="l17.1114" class="difflineplus">+    var node = this.nodeForTreeIndex(aRow);</span>
<a href="#l17.1115"></a><span id="l17.1115" class="difflineplus">+    if (!PlacesUtils.nodeIsReadOnly(node) &amp;&amp;</span>
<a href="#l17.1116"></a><span id="l17.1116" class="difflineplus">+        (PlacesUtils.nodeIsFolder(node) ||</span>
<a href="#l17.1117"></a><span id="l17.1117" class="difflineplus">+         (PlacesUtils.nodeIsBookmark(node) &amp;&amp;</span>
<a href="#l17.1118"></a><span id="l17.1118" class="difflineplus">+          !PlacesUtils.nodeIsLivemarkItem(node))))</span>
<a href="#l17.1119"></a><span id="l17.1119" class="difflineplus">+      return true;</span>
<a href="#l17.1120"></a><span id="l17.1120" class="difflineplus">+</span>
<a href="#l17.1121"></a><span id="l17.1121" class="difflineplus">+    return false;</span>
<a href="#l17.1122"></a><span id="l17.1122" class="difflineplus">+  },</span>
<a href="#l17.1123"></a><span id="l17.1123" class="difflineplus">+</span>
<a href="#l17.1124"></a><span id="l17.1124" class="difflineplus">+  setCellText: function PTV_setCellText(aRow, aColumn, aText) {</span>
<a href="#l17.1125"></a><span id="l17.1125" class="difflineplus">+    // we may only get here if the cell is editable</span>
<a href="#l17.1126"></a><span id="l17.1126" class="difflineplus">+    var node = this.nodeForTreeIndex(aRow);</span>
<a href="#l17.1127"></a><span id="l17.1127" class="difflineplus">+    if (node.title != aText) {</span>
<a href="#l17.1128"></a><span id="l17.1128" class="difflineplus">+      var txn = PlacesUIUtils.ptm.editItemTitle(node.itemId, aText);</span>
<a href="#l17.1129"></a><span id="l17.1129" class="difflineplus">+      PlacesUIUtils.ptm.doTransaction(txn);</span>
<a href="#l17.1130"></a><span id="l17.1130" class="difflineplus">+    }</span>
<a href="#l17.1131"></a><span id="l17.1131" class="difflineplus">+  },</span>
<a href="#l17.1132"></a><span id="l17.1132" class="difflineplus">+</span>
<a href="#l17.1133"></a><span id="l17.1133" class="difflineplus">+  selectionChanged: function() { },</span>
<a href="#l17.1134"></a><span id="l17.1134" class="difflineplus">+  cycleCell: function PTV_cycleCell(aRow, aColumn) { },</span>
<a href="#l17.1135"></a><span id="l17.1135" class="difflineplus">+  isSelectable: function(aRow, aColumn) { return false; },</span>
<a href="#l17.1136"></a><span id="l17.1136" class="difflineplus">+  performAction: function(aAction) { },</span>
<a href="#l17.1137"></a><span id="l17.1137" class="difflineplus">+  performActionOnRow: function(aAction, aRow) { },</span>
<a href="#l17.1138"></a><span id="l17.1138" class="difflineplus">+  performActionOnCell: function(aAction, aRow, aColumn) { }</span>
<a href="#l17.1139"></a><span id="l17.1139" class="difflineplus">+};</span>
<a href="#l17.1140"></a><span id="l17.1140" class="difflineplus">+</span>
<a href="#l17.1141"></a><span id="l17.1141" class="difflineplus">+function PlacesTreeView(aFlatList) {</span>
<a href="#l17.1142"></a><span id="l17.1142" class="difflineplus">+  this._tree = null;</span>
<a href="#l17.1143"></a><span id="l17.1143" class="difflineplus">+  this._result = null;</span>
<a href="#l17.1144"></a><span id="l17.1144" class="difflineplus">+  this._showSessions = false;</span>
<a href="#l17.1145"></a><span id="l17.1145" class="difflineplus">+  this._selection = null;</span>
<a href="#l17.1146"></a><span id="l17.1146" class="difflineplus">+  this._visibleElements = [];</span>
<a href="#l17.1147"></a><span id="l17.1147" class="difflineplus">+  this._flatList = aFlatList;</span>
<a href="#l17.1148"></a><span id="l17.1148" class="difflineplus">+}</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l18.1"></a><span id="l18.1">new file mode 100644</span>
<a href="#l18.2"></a><span id="l18.2" class="difflineminus">--- /dev/null</span>
<a href="#l18.3"></a><span id="l18.3" class="difflineplus">+++ b/suite/common/history/utils.js</span>
<a href="#l18.4"></a><span id="l18.4" class="difflineat">@@ -0,0 +1,432 @@</span>
<a href="#l18.5"></a><span id="l18.5" class="difflineplus">+/* -*- Mode: C++; tab-width: 8; indent-tabs-mode: nil; c-basic-offset: 2 -*- */</span>
<a href="#l18.6"></a><span id="l18.6" class="difflineplus">+/* ***** BEGIN LICENSE BLOCK *****</span>
<a href="#l18.7"></a><span id="l18.7" class="difflineplus">+ * Version: MPL 1.1/GPL 2.0/LGPL 2.1</span>
<a href="#l18.8"></a><span id="l18.8" class="difflineplus">+ *</span>
<a href="#l18.9"></a><span id="l18.9" class="difflineplus">+ * The contents of this file are subject to the Mozilla Public License Version</span>
<a href="#l18.10"></a><span id="l18.10" class="difflineplus">+ * 1.1 (the &quot;License&quot;); you may not use this file except in compliance with</span>
<a href="#l18.11"></a><span id="l18.11" class="difflineplus">+ * the License. You may obtain a copy of the License at</span>
<a href="#l18.12"></a><span id="l18.12" class="difflineplus">+ * http://www.mozilla.org/MPL/</span>
<a href="#l18.13"></a><span id="l18.13" class="difflineplus">+ *</span>
<a href="#l18.14"></a><span id="l18.14" class="difflineplus">+ * Software distributed under the License is distributed on an &quot;AS IS&quot; basis,</span>
<a href="#l18.15"></a><span id="l18.15" class="difflineplus">+ * WITHOUT WARRANTY OF ANY KIND, either express or implied. See the License</span>
<a href="#l18.16"></a><span id="l18.16" class="difflineplus">+ * for the specific language governing rights and limitations under the</span>
<a href="#l18.17"></a><span id="l18.17" class="difflineplus">+ * License.</span>
<a href="#l18.18"></a><span id="l18.18" class="difflineplus">+ *</span>
<a href="#l18.19"></a><span id="l18.19" class="difflineplus">+ * The Original Code is the Places Command Controller.</span>
<a href="#l18.20"></a><span id="l18.20" class="difflineplus">+ *</span>
<a href="#l18.21"></a><span id="l18.21" class="difflineplus">+ * The Initial Developer of the Original Code is Google Inc.</span>
<a href="#l18.22"></a><span id="l18.22" class="difflineplus">+ * Portions created by the Initial Developer are Copyright (C) 2005</span>
<a href="#l18.23"></a><span id="l18.23" class="difflineplus">+ * the Initial Developer. All Rights Reserved.</span>
<a href="#l18.24"></a><span id="l18.24" class="difflineplus">+ *</span>
<a href="#l18.25"></a><span id="l18.25" class="difflineplus">+ * Contributor(s):</span>
<a href="#l18.26"></a><span id="l18.26" class="difflineplus">+ *   Ben Goodger &lt;beng@google.com&gt;</span>
<a href="#l18.27"></a><span id="l18.27" class="difflineplus">+ *   Myk Melez &lt;myk@mozilla.org&gt;</span>
<a href="#l18.28"></a><span id="l18.28" class="difflineplus">+ *   Asaf Romano &lt;mano@mozilla.com&gt;</span>
<a href="#l18.29"></a><span id="l18.29" class="difflineplus">+ *   Sungjoon Steve Won &lt;stevewon@gmail.com&gt;</span>
<a href="#l18.30"></a><span id="l18.30" class="difflineplus">+ *   Dietrich Ayala &lt;dietrich@mozilla.com&gt;</span>
<a href="#l18.31"></a><span id="l18.31" class="difflineplus">+ *   Marco Bonardo &lt;mak77@bonardo.net&gt;</span>
<a href="#l18.32"></a><span id="l18.32" class="difflineplus">+ *</span>
<a href="#l18.33"></a><span id="l18.33" class="difflineplus">+ * Alternatively, the contents of this file may be used under the terms of</span>
<a href="#l18.34"></a><span id="l18.34" class="difflineplus">+ * either the GNU General Public License Version 2 or later (the &quot;GPL&quot;), or</span>
<a href="#l18.35"></a><span id="l18.35" class="difflineplus">+ * the GNU Lesser General Public License Version 2.1 or later (the &quot;LGPL&quot;),</span>
<a href="#l18.36"></a><span id="l18.36" class="difflineplus">+ * in which case the provisions of the GPL or the LGPL are applicable instead</span>
<a href="#l18.37"></a><span id="l18.37" class="difflineplus">+ * of those above. If you wish to allow use of your version of this file only</span>
<a href="#l18.38"></a><span id="l18.38" class="difflineplus">+ * under the terms of either the GPL or the LGPL, and not to allow others to</span>
<a href="#l18.39"></a><span id="l18.39" class="difflineplus">+ * use your version of this file under the terms of the MPL, indicate your</span>
<a href="#l18.40"></a><span id="l18.40" class="difflineplus">+ * decision by deleting the provisions above and replace them with the notice</span>
<a href="#l18.41"></a><span id="l18.41" class="difflineplus">+ * and other provisions required by the GPL or the LGPL. If you do not delete</span>
<a href="#l18.42"></a><span id="l18.42" class="difflineplus">+ * the provisions above, a recipient may use your version of this file under</span>
<a href="#l18.43"></a><span id="l18.43" class="difflineplus">+ * the terms of any one of the MPL, the GPL or the LGPL.</span>
<a href="#l18.44"></a><span id="l18.44" class="difflineplus">+ *</span>
<a href="#l18.45"></a><span id="l18.45" class="difflineplus">+ * ***** END LICENSE BLOCK ***** */</span>
<a href="#l18.46"></a><span id="l18.46" class="difflineplus">+</span>
<a href="#l18.47"></a><span id="l18.47" class="difflineplus">+function LOG(str) {</span>
<a href="#l18.48"></a><span id="l18.48" class="difflineplus">+  dump(&quot;*** &quot; + str + &quot;\n&quot;);</span>
<a href="#l18.49"></a><span id="l18.49" class="difflineplus">+}</span>
<a href="#l18.50"></a><span id="l18.50" class="difflineplus">+</span>
<a href="#l18.51"></a><span id="l18.51" class="difflineplus">+__defineGetter__(&quot;PlacesUtils&quot;, function() {</span>
<a href="#l18.52"></a><span id="l18.52" class="difflineplus">+  delete this.PlacesUtils</span>
<a href="#l18.53"></a><span id="l18.53" class="difflineplus">+  var tmpScope = {};</span>
<a href="#l18.54"></a><span id="l18.54" class="difflineplus">+  Components.utils.import(&quot;resource://gre/modules/utils.js&quot;, tmpScope);</span>
<a href="#l18.55"></a><span id="l18.55" class="difflineplus">+  return this.PlacesUtils = tmpScope.PlacesUtils;</span>
<a href="#l18.56"></a><span id="l18.56" class="difflineplus">+});</span>
<a href="#l18.57"></a><span id="l18.57" class="difflineplus">+</span>
<a href="#l18.58"></a><span id="l18.58" class="difflineplus">+const LOAD_IN_SIDEBAR_ANNO = &quot;bookmarkProperties/loadInSidebar&quot;;</span>
<a href="#l18.59"></a><span id="l18.59" class="difflineplus">+const DESCRIPTION_ANNO = &quot;bookmarkProperties/description&quot;;</span>
<a href="#l18.60"></a><span id="l18.60" class="difflineplus">+const LMANNO_FEEDURI = &quot;livemark/feedURI&quot;;</span>
<a href="#l18.61"></a><span id="l18.61" class="difflineplus">+const LMANNO_SITEURI = &quot;livemark/siteURI&quot;;</span>
<a href="#l18.62"></a><span id="l18.62" class="difflineplus">+const ORGANIZER_FOLDER_ANNO = &quot;PlacesOrganizer/OrganizerFolder&quot;;</span>
<a href="#l18.63"></a><span id="l18.63" class="difflineplus">+const ORGANIZER_QUERY_ANNO = &quot;PlacesOrganizer/OrganizerQuery&quot;;</span>
<a href="#l18.64"></a><span id="l18.64" class="difflineplus">+const ORGANIZER_LEFTPANE_VERSION = 4;</span>
<a href="#l18.65"></a><span id="l18.65" class="difflineplus">+</span>
<a href="#l18.66"></a><span id="l18.66" class="difflineplus">+#ifdef XP_MACOSX</span>
<a href="#l18.67"></a><span id="l18.67" class="difflineplus">+// On Mac OSX, the transferable system converts &quot;\r\n&quot; to &quot;\n\n&quot;, where we</span>
<a href="#l18.68"></a><span id="l18.68" class="difflineplus">+// really just want &quot;\n&quot;.</span>
<a href="#l18.69"></a><span id="l18.69" class="difflineplus">+const NEWLINE= &quot;\n&quot;;</span>
<a href="#l18.70"></a><span id="l18.70" class="difflineplus">+#else</span>
<a href="#l18.71"></a><span id="l18.71" class="difflineplus">+// On other platforms, the transferable system converts &quot;\r\n&quot; to &quot;\n&quot;.</span>
<a href="#l18.72"></a><span id="l18.72" class="difflineplus">+const NEWLINE = &quot;\r\n&quot;;</span>
<a href="#l18.73"></a><span id="l18.73" class="difflineplus">+#endif</span>
<a href="#l18.74"></a><span id="l18.74" class="difflineplus">+</span>
<a href="#l18.75"></a><span id="l18.75" class="difflineplus">+function QI_node(aNode, aIID) {</span>
<a href="#l18.76"></a><span id="l18.76" class="difflineplus">+  return aNode.QueryInterface(aIID);</span>
<a href="#l18.77"></a><span id="l18.77" class="difflineplus">+}</span>
<a href="#l18.78"></a><span id="l18.78" class="difflineplus">+function asVisit(aNode)    {</span>
<a href="#l18.79"></a><span id="l18.79" class="difflineplus">+  return QI_node(aNode, Components.interfaces.nsINavHistoryVisitResultNode);</span>
<a href="#l18.80"></a><span id="l18.80" class="difflineplus">+}</span>
<a href="#l18.81"></a><span id="l18.81" class="difflineplus">+function asFullVisit(aNode){</span>
<a href="#l18.82"></a><span id="l18.82" class="difflineplus">+  return QI_node(aNode, Components.interfaces.nsINavHistoryFullVisitResultNode);</span>
<a href="#l18.83"></a><span id="l18.83" class="difflineplus">+}</span>
<a href="#l18.84"></a><span id="l18.84" class="difflineplus">+function asContainer(aNode){</span>
<a href="#l18.85"></a><span id="l18.85" class="difflineplus">+  return QI_node(aNode, Components.interfaces.nsINavHistoryContainerResultNode);</span>
<a href="#l18.86"></a><span id="l18.86" class="difflineplus">+}</span>
<a href="#l18.87"></a><span id="l18.87" class="difflineplus">+function asQuery(aNode)    {</span>
<a href="#l18.88"></a><span id="l18.88" class="difflineplus">+  return QI_node(aNode, Components.interfaces.nsINavHistoryQueryResultNode);</span>
<a href="#l18.89"></a><span id="l18.89" class="difflineplus">+}</span>
<a href="#l18.90"></a><span id="l18.90" class="difflineplus">+</span>
<a href="#l18.91"></a><span id="l18.91" class="difflineplus">+var PlacesUIUtils = {</span>
<a href="#l18.92"></a><span id="l18.92" class="difflineplus">+  /**</span>
<a href="#l18.93"></a><span id="l18.93" class="difflineplus">+   * The Microsummary Service</span>
<a href="#l18.94"></a><span id="l18.94" class="difflineplus">+   */</span>
<a href="#l18.95"></a><span id="l18.95" class="difflineplus">+  get microsummaries() {</span>
<a href="#l18.96"></a><span id="l18.96" class="difflineplus">+    delete this.microsummaries;</span>
<a href="#l18.97"></a><span id="l18.97" class="difflineplus">+    return this.microsummaries = Components.classes[&quot;@mozilla.org/microsummary/service;1&quot;]</span>
<a href="#l18.98"></a><span id="l18.98" class="difflineplus">+                                           .getService(Components.interfaces.nsIMicrosummaryService);</span>
<a href="#l18.99"></a><span id="l18.99" class="difflineplus">+  },</span>
<a href="#l18.100"></a><span id="l18.100" class="difflineplus">+</span>
<a href="#l18.101"></a><span id="l18.101" class="difflineplus">+  get RDF() {</span>
<a href="#l18.102"></a><span id="l18.102" class="difflineplus">+    delete this.RDF;</span>
<a href="#l18.103"></a><span id="l18.103" class="difflineplus">+    return this.RDF = Components.classes[&quot;@mozilla.org/rdf/rdf-service;1&quot;]</span>
<a href="#l18.104"></a><span id="l18.104" class="difflineplus">+                                .getService(Components.interfaces.nsIRDFService);</span>
<a href="#l18.105"></a><span id="l18.105" class="difflineplus">+  },</span>
<a href="#l18.106"></a><span id="l18.106" class="difflineplus">+</span>
<a href="#l18.107"></a><span id="l18.107" class="difflineplus">+  get localStore() {</span>
<a href="#l18.108"></a><span id="l18.108" class="difflineplus">+    delete this.localStore;</span>
<a href="#l18.109"></a><span id="l18.109" class="difflineplus">+    return this.localStore = this.RDF.GetDataSource(&quot;rdf:local-store&quot;);</span>
<a href="#l18.110"></a><span id="l18.110" class="difflineplus">+  },</span>
<a href="#l18.111"></a><span id="l18.111" class="difflineplus">+</span>
<a href="#l18.112"></a><span id="l18.112" class="difflineplus">+  get clipboard() {</span>
<a href="#l18.113"></a><span id="l18.113" class="difflineplus">+    delete this.clipboard;</span>
<a href="#l18.114"></a><span id="l18.114" class="difflineplus">+    return this.clipboard = Components.classes[&quot;@mozilla.org/widget/clipboard;1&quot;]</span>
<a href="#l18.115"></a><span id="l18.115" class="difflineplus">+                                      .getService(Components.interfaces.nsIClipboard);</span>
<a href="#l18.116"></a><span id="l18.116" class="difflineplus">+  },</span>
<a href="#l18.117"></a><span id="l18.117" class="difflineplus">+</span>
<a href="#l18.118"></a><span id="l18.118" class="difflineplus">+  get URIFixup() {</span>
<a href="#l18.119"></a><span id="l18.119" class="difflineplus">+    delete this.URIFixup;</span>
<a href="#l18.120"></a><span id="l18.120" class="difflineplus">+    return this.URIFixup = Components.classes[&quot;@mozilla.org/docshell/urifixup;1&quot;]</span>
<a href="#l18.121"></a><span id="l18.121" class="difflineplus">+                                     .getService(Components.interfaces.nsIURIFixup);</span>
<a href="#l18.122"></a><span id="l18.122" class="difflineplus">+  },</span>
<a href="#l18.123"></a><span id="l18.123" class="difflineplus">+</span>
<a href="#l18.124"></a><span id="l18.124" class="difflineplus">+  get ellipsis() {</span>
<a href="#l18.125"></a><span id="l18.125" class="difflineplus">+    delete this.ellipsis;</span>
<a href="#l18.126"></a><span id="l18.126" class="difflineplus">+    var pref = Components.classes[&quot;@mozilla.org/preferences-service;1&quot;]</span>
<a href="#l18.127"></a><span id="l18.127" class="difflineplus">+                         .getService(Components.interfaces.nsIPrefBranch);</span>
<a href="#l18.128"></a><span id="l18.128" class="difflineplus">+    return this.ellipsis = pref.getComplexValue(&quot;intl.ellipsis&quot;,</span>
<a href="#l18.129"></a><span id="l18.129" class="difflineplus">+                                                Components.interfaces.nsIPrefLocalizedString).data;</span>
<a href="#l18.130"></a><span id="l18.130" class="difflineplus">+  },</span>
<a href="#l18.131"></a><span id="l18.131" class="difflineplus">+</span>
<a href="#l18.132"></a><span id="l18.132" class="difflineplus">+  /**</span>
<a href="#l18.133"></a><span id="l18.133" class="difflineplus">+   * Makes a URI from a spec, and do fixup</span>
<a href="#l18.134"></a><span id="l18.134" class="difflineplus">+   * @param   aSpec</span>
<a href="#l18.135"></a><span id="l18.135" class="difflineplus">+   *          The string spec of the URI</span>
<a href="#l18.136"></a><span id="l18.136" class="difflineplus">+   * @returns A URI object for the spec.</span>
<a href="#l18.137"></a><span id="l18.137" class="difflineplus">+   */</span>
<a href="#l18.138"></a><span id="l18.138" class="difflineplus">+  createFixedURI: function PU_createFixedURI(aSpec) {</span>
<a href="#l18.139"></a><span id="l18.139" class="difflineplus">+    return this.URIFixup.createFixupURI(aSpec, 0);</span>
<a href="#l18.140"></a><span id="l18.140" class="difflineplus">+  },</span>
<a href="#l18.141"></a><span id="l18.141" class="difflineplus">+</span>
<a href="#l18.142"></a><span id="l18.142" class="difflineplus">+  /**</span>
<a href="#l18.143"></a><span id="l18.143" class="difflineplus">+   * Wraps a string in a nsISupportsString wrapper</span>
<a href="#l18.144"></a><span id="l18.144" class="difflineplus">+   * @param   aString</span>
<a href="#l18.145"></a><span id="l18.145" class="difflineplus">+   *          The string to wrap</span>
<a href="#l18.146"></a><span id="l18.146" class="difflineplus">+   * @returns A nsISupportsString object containing a string.</span>
<a href="#l18.147"></a><span id="l18.147" class="difflineplus">+   */</span>
<a href="#l18.148"></a><span id="l18.148" class="difflineplus">+  _wrapString: function PU__wrapString(aString) {</span>
<a href="#l18.149"></a><span id="l18.149" class="difflineplus">+    var s = Components.classes[&quot;@mozilla.org/supports-string;1&quot;]</span>
<a href="#l18.150"></a><span id="l18.150" class="difflineplus">+                      .createInstance(Components.interfaces.nsISupportsString);</span>
<a href="#l18.151"></a><span id="l18.151" class="difflineplus">+    s.data = aString;</span>
<a href="#l18.152"></a><span id="l18.152" class="difflineplus">+    return s;</span>
<a href="#l18.153"></a><span id="l18.153" class="difflineplus">+  },</span>
<a href="#l18.154"></a><span id="l18.154" class="difflineplus">+</span>
<a href="#l18.155"></a><span id="l18.155" class="difflineplus">+  /**</span>
<a href="#l18.156"></a><span id="l18.156" class="difflineplus">+   * String bundle helpers</span>
<a href="#l18.157"></a><span id="l18.157" class="difflineplus">+   */</span>
<a href="#l18.158"></a><span id="l18.158" class="difflineplus">+  get _bundle() {</span>
<a href="#l18.159"></a><span id="l18.159" class="difflineplus">+    const PLACES_STRING_BUNDLE_URI =</span>
<a href="#l18.160"></a><span id="l18.160" class="difflineplus">+        &quot;chrome://communicator/locale/history/places.properties&quot;;</span>
<a href="#l18.161"></a><span id="l18.161" class="difflineplus">+    delete this._bundle;</span>
<a href="#l18.162"></a><span id="l18.162" class="difflineplus">+    return this._bundle = Components.classes[&quot;@mozilla.org/intl/stringbundle;1&quot;]</span>
<a href="#l18.163"></a><span id="l18.163" class="difflineplus">+                                    .getService(Components.interfaces.nsIStringBundleService)</span>
<a href="#l18.164"></a><span id="l18.164" class="difflineplus">+                                    .createBundle(PLACES_STRING_BUNDLE_URI);</span>
<a href="#l18.165"></a><span id="l18.165" class="difflineplus">+  },</span>
<a href="#l18.166"></a><span id="l18.166" class="difflineplus">+</span>
<a href="#l18.167"></a><span id="l18.167" class="difflineplus">+  getFormattedString: function PU_getFormattedString(key, params) {</span>
<a href="#l18.168"></a><span id="l18.168" class="difflineplus">+    return this._bundle.formatStringFromName(key, params, params.length);</span>
<a href="#l18.169"></a><span id="l18.169" class="difflineplus">+  },</span>
<a href="#l18.170"></a><span id="l18.170" class="difflineplus">+</span>
<a href="#l18.171"></a><span id="l18.171" class="difflineplus">+  getString: function PU_getString(key) {</span>
<a href="#l18.172"></a><span id="l18.172" class="difflineplus">+    return this._bundle.GetStringFromName(key);</span>
<a href="#l18.173"></a><span id="l18.173" class="difflineplus">+  },</span>
<a href="#l18.174"></a><span id="l18.174" class="difflineplus">+</span>
<a href="#l18.175"></a><span id="l18.175" class="difflineplus">+  /**</span>
<a href="#l18.176"></a><span id="l18.176" class="difflineplus">+   * Returns the closet ancestor places view for the given DOM node</span>
<a href="#l18.177"></a><span id="l18.177" class="difflineplus">+   * @param aNode</span>
<a href="#l18.178"></a><span id="l18.178" class="difflineplus">+   *        a DOM node</span>
<a href="#l18.179"></a><span id="l18.179" class="difflineplus">+   * @return the closet ancestor places view if exists, null otherwsie.</span>
<a href="#l18.180"></a><span id="l18.180" class="difflineplus">+   */</span>
<a href="#l18.181"></a><span id="l18.181" class="difflineplus">+  getViewForNode: function PU_getViewForNode(aNode) {</span>
<a href="#l18.182"></a><span id="l18.182" class="difflineplus">+    var node = aNode;</span>
<a href="#l18.183"></a><span id="l18.183" class="difflineplus">+</span>
<a href="#l18.184"></a><span id="l18.184" class="difflineplus">+    // the view for a &lt;menu&gt; of which its associated menupopup is a places view,</span>
<a href="#l18.185"></a><span id="l18.185" class="difflineplus">+    // is the menupopup</span>
<a href="#l18.186"></a><span id="l18.186" class="difflineplus">+    if (node.localName == &quot;menu&quot; &amp;&amp; !node.node &amp;&amp;</span>
<a href="#l18.187"></a><span id="l18.187" class="difflineplus">+        node.firstChild.getAttribute(&quot;type&quot;) == &quot;places&quot;)</span>
<a href="#l18.188"></a><span id="l18.188" class="difflineplus">+      return node.firstChild;</span>
<a href="#l18.189"></a><span id="l18.189" class="difflineplus">+</span>
<a href="#l18.190"></a><span id="l18.190" class="difflineplus">+    while (node) {</span>
<a href="#l18.191"></a><span id="l18.191" class="difflineplus">+      // XXXmano: Use QueryInterface(nsIPlacesView) once we implement it...</span>
<a href="#l18.192"></a><span id="l18.192" class="difflineplus">+      if (node.getAttribute(&quot;type&quot;) == &quot;places&quot;)</span>
<a href="#l18.193"></a><span id="l18.193" class="difflineplus">+        return node;</span>
<a href="#l18.194"></a><span id="l18.194" class="difflineplus">+</span>
<a href="#l18.195"></a><span id="l18.195" class="difflineplus">+      node = node.parentNode;</span>
<a href="#l18.196"></a><span id="l18.196" class="difflineplus">+    }</span>
<a href="#l18.197"></a><span id="l18.197" class="difflineplus">+</span>
<a href="#l18.198"></a><span id="l18.198" class="difflineplus">+    return null;</span>
<a href="#l18.199"></a><span id="l18.199" class="difflineplus">+  },</span>
<a href="#l18.200"></a><span id="l18.200" class="difflineplus">+</span>
<a href="#l18.201"></a><span id="l18.201" class="difflineplus">+  /**</span>
<a href="#l18.202"></a><span id="l18.202" class="difflineplus">+   * By calling this before we visit a URL, we will use TRANSITION_TYPED</span>
<a href="#l18.203"></a><span id="l18.203" class="difflineplus">+   * as the transition for the visit to that URL (if we don't have a referrer).</span>
<a href="#l18.204"></a><span id="l18.204" class="difflineplus">+   * This is used when visiting pages from the history menu, history sidebar,</span>
<a href="#l18.205"></a><span id="l18.205" class="difflineplus">+   * url bar, url autocomplete results, and history searches from the places</span>
<a href="#l18.206"></a><span id="l18.206" class="difflineplus">+   * organizer.  If we don't call this, we'll treat those visits as</span>
<a href="#l18.207"></a><span id="l18.207" class="difflineplus">+   * TRANSITION_LINK.</span>
<a href="#l18.208"></a><span id="l18.208" class="difflineplus">+   */</span>
<a href="#l18.209"></a><span id="l18.209" class="difflineplus">+  markPageAsTyped: function PU_markPageAsTyped(aURL) {</span>
<a href="#l18.210"></a><span id="l18.210" class="difflineplus">+    PlacesUtils.history.QueryInterface(Components.interfaces.nsIBrowserHistory)</span>
<a href="#l18.211"></a><span id="l18.211" class="difflineplus">+               .markPageAsTyped(this.createFixedURI(aURL));</span>
<a href="#l18.212"></a><span id="l18.212" class="difflineplus">+  },</span>
<a href="#l18.213"></a><span id="l18.213" class="difflineplus">+</span>
<a href="#l18.214"></a><span id="l18.214" class="difflineplus">+  /**</span>
<a href="#l18.215"></a><span id="l18.215" class="difflineplus">+   * By calling this before we visit a URL, we will use TRANSITION_BOOKMARK</span>
<a href="#l18.216"></a><span id="l18.216" class="difflineplus">+   * as the transition for the visit to that URL (if we don't have a referrer).</span>
<a href="#l18.217"></a><span id="l18.217" class="difflineplus">+   * This is used when visiting pages from the bookmarks menu,</span>
<a href="#l18.218"></a><span id="l18.218" class="difflineplus">+   * personal toolbar, and bookmarks from within the places organizer.</span>
<a href="#l18.219"></a><span id="l18.219" class="difflineplus">+   * If we don't call this, we'll treat those visits as TRANSITION_LINK.</span>
<a href="#l18.220"></a><span id="l18.220" class="difflineplus">+   */</span>
<a href="#l18.221"></a><span id="l18.221" class="difflineplus">+  markPageAsFollowedBookmark: function PU_markPageAsFollowedBookmark(aURL) {</span>
<a href="#l18.222"></a><span id="l18.222" class="difflineplus">+    PlacesUtils.history.markPageAsFollowedBookmark(this.createFixedURI(aURL));</span>
<a href="#l18.223"></a><span id="l18.223" class="difflineplus">+  },</span>
<a href="#l18.224"></a><span id="l18.224" class="difflineplus">+</span>
<a href="#l18.225"></a><span id="l18.225" class="difflineplus">+  /**</span>
<a href="#l18.226"></a><span id="l18.226" class="difflineplus">+   * Allows opening of javascript/data URI only if the given node is</span>
<a href="#l18.227"></a><span id="l18.227" class="difflineplus">+   * bookmarked (see bug 224521).</span>
<a href="#l18.228"></a><span id="l18.228" class="difflineplus">+   * @param aURINode</span>
<a href="#l18.229"></a><span id="l18.229" class="difflineplus">+   *        a URI node</span>
<a href="#l18.230"></a><span id="l18.230" class="difflineplus">+   * @return true if it's safe to open the node in the browser, false otherwise.</span>
<a href="#l18.231"></a><span id="l18.231" class="difflineplus">+   *</span>
<a href="#l18.232"></a><span id="l18.232" class="difflineplus">+   */</span>
<a href="#l18.233"></a><span id="l18.233" class="difflineplus">+  checkURLSecurity: function PU_checkURLSecurity(aURINode) {</span>
<a href="#l18.234"></a><span id="l18.234" class="difflineplus">+    if (!PlacesUtils.nodeIsBookmark(aURINode)) {</span>
<a href="#l18.235"></a><span id="l18.235" class="difflineplus">+      var uri = PlacesUtils._uri(aURINode.uri);</span>
<a href="#l18.236"></a><span id="l18.236" class="difflineplus">+      if (uri.schemeIs(&quot;javascript&quot;) || uri.schemeIs(&quot;data&quot;)) {</span>
<a href="#l18.237"></a><span id="l18.237" class="difflineplus">+        const BRANDING_BUNDLE_URI = &quot;chrome://branding/locale/brand.properties&quot;;</span>
<a href="#l18.238"></a><span id="l18.238" class="difflineplus">+        var brandShortName = Components.classes[&quot;@mozilla.org/intl/stringbundle;1&quot;]</span>
<a href="#l18.239"></a><span id="l18.239" class="difflineplus">+                                       .getService(Components.interfaces.nsIStringBundleService)</span>
<a href="#l18.240"></a><span id="l18.240" class="difflineplus">+                                       .createBundle(BRANDING_BUNDLE_URI)</span>
<a href="#l18.241"></a><span id="l18.241" class="difflineplus">+                                       .GetStringFromName(&quot;brandShortName&quot;);</span>
<a href="#l18.242"></a><span id="l18.242" class="difflineplus">+        var promptService = Components.classes[&quot;@mozilla.org/embedcomp/prompt-service;1&quot;]</span>
<a href="#l18.243"></a><span id="l18.243" class="difflineplus">+                                      .getService(Components.interfaces.nsIPromptService);</span>
<a href="#l18.244"></a><span id="l18.244" class="difflineplus">+</span>
<a href="#l18.245"></a><span id="l18.245" class="difflineplus">+        var errorStr = this.getString(&quot;load-js-data-url-error&quot;);</span>
<a href="#l18.246"></a><span id="l18.246" class="difflineplus">+        promptService.alert(window, brandShortName, errorStr);</span>
<a href="#l18.247"></a><span id="l18.247" class="difflineplus">+        return false;</span>
<a href="#l18.248"></a><span id="l18.248" class="difflineplus">+      }</span>
<a href="#l18.249"></a><span id="l18.249" class="difflineplus">+    }</span>
<a href="#l18.250"></a><span id="l18.250" class="difflineplus">+    return true;</span>
<a href="#l18.251"></a><span id="l18.251" class="difflineplus">+  },</span>
<a href="#l18.252"></a><span id="l18.252" class="difflineplus">+</span>
<a href="#l18.253"></a><span id="l18.253" class="difflineplus">+  /**</span>
<a href="#l18.254"></a><span id="l18.254" class="difflineplus">+   * Get the description associated with a document, as specified in a &lt;META&gt;</span>
<a href="#l18.255"></a><span id="l18.255" class="difflineplus">+   * element.</span>
<a href="#l18.256"></a><span id="l18.256" class="difflineplus">+   * @param   doc</span>
<a href="#l18.257"></a><span id="l18.257" class="difflineplus">+   *          A DOM Document to get a description for</span>
<a href="#l18.258"></a><span id="l18.258" class="difflineplus">+   * @returns A description string if a META element was discovered with a</span>
<a href="#l18.259"></a><span id="l18.259" class="difflineplus">+   *          &quot;description&quot; or &quot;httpequiv&quot; attribute, empty string otherwise.</span>
<a href="#l18.260"></a><span id="l18.260" class="difflineplus">+   */</span>
<a href="#l18.261"></a><span id="l18.261" class="difflineplus">+  getDescriptionFromDocument: function PU_getDescriptionFromDocument(doc) {</span>
<a href="#l18.262"></a><span id="l18.262" class="difflineplus">+    var metaElements = doc.getElementsByTagName(&quot;META&quot;);</span>
<a href="#l18.263"></a><span id="l18.263" class="difflineplus">+    for (var i = 0; i &lt; metaElements.length; ++i) {</span>
<a href="#l18.264"></a><span id="l18.264" class="difflineplus">+      if (metaElements[i].name.toLowerCase() == &quot;description&quot; ||</span>
<a href="#l18.265"></a><span id="l18.265" class="difflineplus">+          metaElements[i].httpEquiv.toLowerCase() == &quot;description&quot;) {</span>
<a href="#l18.266"></a><span id="l18.266" class="difflineplus">+        return metaElements[i].content;</span>
<a href="#l18.267"></a><span id="l18.267" class="difflineplus">+      }</span>
<a href="#l18.268"></a><span id="l18.268" class="difflineplus">+    }</span>
<a href="#l18.269"></a><span id="l18.269" class="difflineplus">+    return &quot;&quot;;</span>
<a href="#l18.270"></a><span id="l18.270" class="difflineplus">+  },</span>
<a href="#l18.271"></a><span id="l18.271" class="difflineplus">+</span>
<a href="#l18.272"></a><span id="l18.272" class="difflineplus">+  /**</span>
<a href="#l18.273"></a><span id="l18.273" class="difflineplus">+   * Retrieve the description of an item</span>
<a href="#l18.274"></a><span id="l18.274" class="difflineplus">+   * @param aItemId</span>
<a href="#l18.275"></a><span id="l18.275" class="difflineplus">+   *        item identifier</span>
<a href="#l18.276"></a><span id="l18.276" class="difflineplus">+   * @returns the description of the given item, or an empty string if it is</span>
<a href="#l18.277"></a><span id="l18.277" class="difflineplus">+   * not set.</span>
<a href="#l18.278"></a><span id="l18.278" class="difflineplus">+   */</span>
<a href="#l18.279"></a><span id="l18.279" class="difflineplus">+  getItemDescription: function PU_getItemDescription(aItemId) {</span>
<a href="#l18.280"></a><span id="l18.280" class="difflineplus">+    if (PlacesUtils.annotations.itemHasAnnotation(aItemId, DESCRIPTION_ANNO))</span>
<a href="#l18.281"></a><span id="l18.281" class="difflineplus">+      return PlacesUtils.annotations.getItemAnnotation(aItemId, DESCRIPTION_ANNO);</span>
<a href="#l18.282"></a><span id="l18.282" class="difflineplus">+    return &quot;&quot;;</span>
<a href="#l18.283"></a><span id="l18.283" class="difflineplus">+  },</span>
<a href="#l18.284"></a><span id="l18.284" class="difflineplus">+</span>
<a href="#l18.285"></a><span id="l18.285" class="difflineplus">+  /**</span>
<a href="#l18.286"></a><span id="l18.286" class="difflineplus">+   * Gives the user a chance to cancel loading lots of tabs at once</span>
<a href="#l18.287"></a><span id="l18.287" class="difflineplus">+   */</span>
<a href="#l18.288"></a><span id="l18.288" class="difflineplus">+  _confirmOpenInTabs: function PU__confirmOpenInTabs(numTabsToOpen) {</span>
<a href="#l18.289"></a><span id="l18.289" class="difflineplus">+    var pref = Components.classes[&quot;@mozilla.org/preferences-service;1&quot;]</span>
<a href="#l18.290"></a><span id="l18.290" class="difflineplus">+                         .getService(Components.interfaces.nsIPrefBranch);</span>
<a href="#l18.291"></a><span id="l18.291" class="difflineplus">+</span>
<a href="#l18.292"></a><span id="l18.292" class="difflineplus">+    const kWarnOnOpenPref = &quot;browser.tabs.warnOnOpen&quot;;</span>
<a href="#l18.293"></a><span id="l18.293" class="difflineplus">+    var reallyOpen = true;</span>
<a href="#l18.294"></a><span id="l18.294" class="difflineplus">+    if (pref.getBoolPref(kWarnOnOpenPref)) {</span>
<a href="#l18.295"></a><span id="l18.295" class="difflineplus">+      if (numTabsToOpen &gt;= pref.getIntPref(&quot;browser.tabs.maxOpenBeforeWarn&quot;)) {</span>
<a href="#l18.296"></a><span id="l18.296" class="difflineplus">+        var promptService = Components.classes[&quot;@mozilla.org/embedcomp/prompt-service;1&quot;]</span>
<a href="#l18.297"></a><span id="l18.297" class="difflineplus">+                                      .getService(Components.interfaces.nsIPromptService);</span>
<a href="#l18.298"></a><span id="l18.298" class="difflineplus">+</span>
<a href="#l18.299"></a><span id="l18.299" class="difflineplus">+        // default to true: if it were false, we wouldn't get this far</span>
<a href="#l18.300"></a><span id="l18.300" class="difflineplus">+        var warnOnOpen = { value: true };</span>
<a href="#l18.301"></a><span id="l18.301" class="difflineplus">+</span>
<a href="#l18.302"></a><span id="l18.302" class="difflineplus">+        var messageKey = &quot;tabs.openWarningMultipleBranded&quot;;</span>
<a href="#l18.303"></a><span id="l18.303" class="difflineplus">+        var openKey = &quot;tabs.openButtonMultiple&quot;;</span>
<a href="#l18.304"></a><span id="l18.304" class="difflineplus">+        const BRANDING_BUNDLE_URI = &quot;chrome://branding/locale/brand.properties&quot;;</span>
<a href="#l18.305"></a><span id="l18.305" class="difflineplus">+        var brandShortName = Components.classes[&quot;@mozilla.org/intl/stringbundle;1&quot;]</span>
<a href="#l18.306"></a><span id="l18.306" class="difflineplus">+                                       .getService(Components.interfaces.nsIStringBundleService)</span>
<a href="#l18.307"></a><span id="l18.307" class="difflineplus">+                                       .createBundle(BRANDING_BUNDLE_URI)</span>
<a href="#l18.308"></a><span id="l18.308" class="difflineplus">+                                       .GetStringFromName(&quot;brandShortName&quot;);</span>
<a href="#l18.309"></a><span id="l18.309" class="difflineplus">+</span>
<a href="#l18.310"></a><span id="l18.310" class="difflineplus">+        var buttonPressed = promptService.confirmEx(window,</span>
<a href="#l18.311"></a><span id="l18.311" class="difflineplus">+          this.getString(&quot;tabs.openWarningTitle&quot;),</span>
<a href="#l18.312"></a><span id="l18.312" class="difflineplus">+          this.getFormattedString(messageKey, [numTabsToOpen, brandShortName]),</span>
<a href="#l18.313"></a><span id="l18.313" class="difflineplus">+          (promptService.BUTTON_TITLE_IS_STRING * promptService.BUTTON_POS_0)</span>
<a href="#l18.314"></a><span id="l18.314" class="difflineplus">+           + (promptService.BUTTON_TITLE_CANCEL * promptService.BUTTON_POS_1),</span>
<a href="#l18.315"></a><span id="l18.315" class="difflineplus">+          this.getString(openKey), null, null,</span>
<a href="#l18.316"></a><span id="l18.316" class="difflineplus">+          this.getFormattedString(&quot;tabs.openWarningPromptMeBranded&quot;,</span>
<a href="#l18.317"></a><span id="l18.317" class="difflineplus">+                                  [brandShortName]), warnOnOpen);</span>
<a href="#l18.318"></a><span id="l18.318" class="difflineplus">+</span>
<a href="#l18.319"></a><span id="l18.319" class="difflineplus">+        reallyOpen = (buttonPressed == 0);</span>
<a href="#l18.320"></a><span id="l18.320" class="difflineplus">+        // don't set the pref unless they press OK and it's false</span>
<a href="#l18.321"></a><span id="l18.321" class="difflineplus">+        if (reallyOpen &amp;&amp; !warnOnOpen.value)</span>
<a href="#l18.322"></a><span id="l18.322" class="difflineplus">+          pref.setBoolPref(kWarnOnOpenPref, false);</span>
<a href="#l18.323"></a><span id="l18.323" class="difflineplus">+      }</span>
<a href="#l18.324"></a><span id="l18.324" class="difflineplus">+    }</span>
<a href="#l18.325"></a><span id="l18.325" class="difflineplus">+    return reallyOpen;</span>
<a href="#l18.326"></a><span id="l18.326" class="difflineplus">+  },</span>
<a href="#l18.327"></a><span id="l18.327" class="difflineplus">+</span>
<a href="#l18.328"></a><span id="l18.328" class="difflineplus">+  /** aItemsToOpen needs to be an array of objects of the form:</span>
<a href="#l18.329"></a><span id="l18.329" class="difflineplus">+    * {uri: string, isBookmark: boolean}</span>
<a href="#l18.330"></a><span id="l18.330" class="difflineplus">+    */</span>
<a href="#l18.331"></a><span id="l18.331" class="difflineplus">+  _openTabset: function PU__openTabset(aItemsToOpen, aEvent) {</span>
<a href="#l18.332"></a><span id="l18.332" class="difflineplus">+    var urls = [];</span>
<a href="#l18.333"></a><span id="l18.333" class="difflineplus">+    for (var i = 0; i &lt; aItemsToOpen.length; i++) {</span>
<a href="#l18.334"></a><span id="l18.334" class="difflineplus">+      var item = aItemsToOpen[i];</span>
<a href="#l18.335"></a><span id="l18.335" class="difflineplus">+      if (item.isBookmark)</span>
<a href="#l18.336"></a><span id="l18.336" class="difflineplus">+        this.markPageAsFollowedBookmark(item.uri);</span>
<a href="#l18.337"></a><span id="l18.337" class="difflineplus">+      else</span>
<a href="#l18.338"></a><span id="l18.338" class="difflineplus">+        this.markPageAsTyped(item.uri);</span>
<a href="#l18.339"></a><span id="l18.339" class="difflineplus">+</span>
<a href="#l18.340"></a><span id="l18.340" class="difflineplus">+      urls.push(item.uri);</span>
<a href="#l18.341"></a><span id="l18.341" class="difflineplus">+    }</span>
<a href="#l18.342"></a><span id="l18.342" class="difflineplus">+</span>
<a href="#l18.343"></a><span id="l18.343" class="difflineplus">+    var browserWindow = getTopWin();</span>
<a href="#l18.344"></a><span id="l18.344" class="difflineplus">+    var where = browserWindow ?</span>
<a href="#l18.345"></a><span id="l18.345" class="difflineplus">+                whereToOpenLink(aEvent, false, true) : &quot;window&quot;;</span>
<a href="#l18.346"></a><span id="l18.346" class="difflineplus">+    openUILinkArrayIn(urls, where);</span>
<a href="#l18.347"></a><span id="l18.347" class="difflineplus">+  },</span>
<a href="#l18.348"></a><span id="l18.348" class="difflineplus">+</span>
<a href="#l18.349"></a><span id="l18.349" class="difflineplus">+  openContainerNodeInTabs: function PU_openContainerInTabs(aNode, aEvent) {</span>
<a href="#l18.350"></a><span id="l18.350" class="difflineplus">+    var urlsToOpen = PlacesUtils.getURLsForContainerNode(aNode);</span>
<a href="#l18.351"></a><span id="l18.351" class="difflineplus">+    if (!this._confirmOpenInTabs(urlsToOpen.length))</span>
<a href="#l18.352"></a><span id="l18.352" class="difflineplus">+      return;</span>
<a href="#l18.353"></a><span id="l18.353" class="difflineplus">+</span>
<a href="#l18.354"></a><span id="l18.354" class="difflineplus">+    this._openTabset(urlsToOpen, aEvent);</span>
<a href="#l18.355"></a><span id="l18.355" class="difflineplus">+  },</span>
<a href="#l18.356"></a><span id="l18.356" class="difflineplus">+</span>
<a href="#l18.357"></a><span id="l18.357" class="difflineplus">+  openURINodesInTabs: function PU_openURINodesInTabs(aNodes, aEvent) {</span>
<a href="#l18.358"></a><span id="l18.358" class="difflineplus">+    var urlsToOpen = [];</span>
<a href="#l18.359"></a><span id="l18.359" class="difflineplus">+    for (var i=0; i &lt; aNodes.length; i++) {</span>
<a href="#l18.360"></a><span id="l18.360" class="difflineplus">+      // skip over separators and folders</span>
<a href="#l18.361"></a><span id="l18.361" class="difflineplus">+      if (PlacesUtils.nodeIsURI(aNodes[i]))</span>
<a href="#l18.362"></a><span id="l18.362" class="difflineplus">+        urlsToOpen.push({uri: aNodes[i].uri, isBookmark: PlacesUtils.nodeIsBookmark(aNodes[i])});</span>
<a href="#l18.363"></a><span id="l18.363" class="difflineplus">+    }</span>
<a href="#l18.364"></a><span id="l18.364" class="difflineplus">+    this._openTabset(urlsToOpen, aEvent);</span>
<a href="#l18.365"></a><span id="l18.365" class="difflineplus">+  },</span>
<a href="#l18.366"></a><span id="l18.366" class="difflineplus">+</span>
<a href="#l18.367"></a><span id="l18.367" class="difflineplus">+  /**</span>
<a href="#l18.368"></a><span id="l18.368" class="difflineplus">+   * Loads the node's URL in the appropriate tab or window or as a web</span>
<a href="#l18.369"></a><span id="l18.369" class="difflineplus">+   * panel given the user's preference specified by modifier keys tracked by a</span>
<a href="#l18.370"></a><span id="l18.370" class="difflineplus">+   * DOM mouse/key event.</span>
<a href="#l18.371"></a><span id="l18.371" class="difflineplus">+   * @param   aNode</span>
<a href="#l18.372"></a><span id="l18.372" class="difflineplus">+   *          An uri result node.</span>
<a href="#l18.373"></a><span id="l18.373" class="difflineplus">+   * @param   aEvent</span>
<a href="#l18.374"></a><span id="l18.374" class="difflineplus">+   *          The DOM mouse/key event with modifier keys set that track the</span>
<a href="#l18.375"></a><span id="l18.375" class="difflineplus">+   *          user's preferred destination window or tab.</span>
<a href="#l18.376"></a><span id="l18.376" class="difflineplus">+   */</span>
<a href="#l18.377"></a><span id="l18.377" class="difflineplus">+  openNodeWithEvent: function PU_openNodeWithEvent(aNode, aEvent) {</span>
<a href="#l18.378"></a><span id="l18.378" class="difflineplus">+    this.openNodeIn(aNode, whereToOpenLink(aEvent));</span>
<a href="#l18.379"></a><span id="l18.379" class="difflineplus">+  },</span>
<a href="#l18.380"></a><span id="l18.380" class="difflineplus">+</span>
<a href="#l18.381"></a><span id="l18.381" class="difflineplus">+  /**</span>
<a href="#l18.382"></a><span id="l18.382" class="difflineplus">+   * Loads the node's URL in the appropriate tab or window or as a</span>
<a href="#l18.383"></a><span id="l18.383" class="difflineplus">+   * web panel.</span>
<a href="#l18.384"></a><span id="l18.384" class="difflineplus">+   * see also openUILinkIn</span>
<a href="#l18.385"></a><span id="l18.385" class="difflineplus">+   */</span>
<a href="#l18.386"></a><span id="l18.386" class="difflineplus">+  openNodeIn: function PU_openNodeIn(aNode, aWhere) {</span>
<a href="#l18.387"></a><span id="l18.387" class="difflineplus">+    if (aNode &amp;&amp; PlacesUtils.nodeIsURI(aNode) &amp;&amp;</span>
<a href="#l18.388"></a><span id="l18.388" class="difflineplus">+        this.checkURLSecurity(aNode)) {</span>
<a href="#l18.389"></a><span id="l18.389" class="difflineplus">+      var isBookmark = PlacesUtils.nodeIsBookmark(aNode);</span>
<a href="#l18.390"></a><span id="l18.390" class="difflineplus">+</span>
<a href="#l18.391"></a><span id="l18.391" class="difflineplus">+      if (isBookmark)</span>
<a href="#l18.392"></a><span id="l18.392" class="difflineplus">+        this.markPageAsFollowedBookmark(aNode.uri);</span>
<a href="#l18.393"></a><span id="l18.393" class="difflineplus">+      else</span>
<a href="#l18.394"></a><span id="l18.394" class="difflineplus">+        this.markPageAsTyped(aNode.uri);</span>
<a href="#l18.395"></a><span id="l18.395" class="difflineplus">+</span>
<a href="#l18.396"></a><span id="l18.396" class="difflineplus">+      // Check whether the node is a bookmark which should be opened as</span>
<a href="#l18.397"></a><span id="l18.397" class="difflineplus">+      // a web panel</span>
<a href="#l18.398"></a><span id="l18.398" class="difflineplus">+      if (aWhere == &quot;current&quot; &amp;&amp; isBookmark) {</span>
<a href="#l18.399"></a><span id="l18.399" class="difflineplus">+        if (PlacesUtils.annotations</span>
<a href="#l18.400"></a><span id="l18.400" class="difflineplus">+                       .itemHasAnnotation(aNode.itemId, LOAD_IN_SIDEBAR_ANNO)) {</span>
<a href="#l18.401"></a><span id="l18.401" class="difflineplus">+          var w = getTopWin();</span>
<a href="#l18.402"></a><span id="l18.402" class="difflineplus">+          if (w) {</span>
<a href="#l18.403"></a><span id="l18.403" class="difflineplus">+            w.openWebPanel(aNode.title, aNode.uri);</span>
<a href="#l18.404"></a><span id="l18.404" class="difflineplus">+            return;</span>
<a href="#l18.405"></a><span id="l18.405" class="difflineplus">+          }</span>
<a href="#l18.406"></a><span id="l18.406" class="difflineplus">+        }</span>
<a href="#l18.407"></a><span id="l18.407" class="difflineplus">+      }</span>
<a href="#l18.408"></a><span id="l18.408" class="difflineplus">+      openUILinkIn(aNode.uri, aWhere);</span>
<a href="#l18.409"></a><span id="l18.409" class="difflineplus">+    }</span>
<a href="#l18.410"></a><span id="l18.410" class="difflineplus">+  },</span>
<a href="#l18.411"></a><span id="l18.411" class="difflineplus">+</span>
<a href="#l18.412"></a><span id="l18.412" class="difflineplus">+  getBestTitle: function PU_getBestTitle(aNode) {</span>
<a href="#l18.413"></a><span id="l18.413" class="difflineplus">+    var title;</span>
<a href="#l18.414"></a><span id="l18.414" class="difflineplus">+    if (!aNode.title &amp;&amp; PlacesUtils.uriTypes.indexOf(aNode.type) != -1) {</span>
<a href="#l18.415"></a><span id="l18.415" class="difflineplus">+      // if node title is empty, try to set the label using host and filename</span>
<a href="#l18.416"></a><span id="l18.416" class="difflineplus">+      // PlacesUtils._uri() will throw if aNode.uri is not a valid URI</span>
<a href="#l18.417"></a><span id="l18.417" class="difflineplus">+      try {</span>
<a href="#l18.418"></a><span id="l18.418" class="difflineplus">+        var uri = PlacesUtils._uri(aNode.uri);</span>
<a href="#l18.419"></a><span id="l18.419" class="difflineplus">+        var host = uri.host;</span>
<a href="#l18.420"></a><span id="l18.420" class="difflineplus">+        var fileName = uri.QueryInterface(Components.interfaces.nsIURL).fileName;</span>
<a href="#l18.421"></a><span id="l18.421" class="difflineplus">+        // if fileName is empty, use path to distinguish labels</span>
<a href="#l18.422"></a><span id="l18.422" class="difflineplus">+        title = host + (fileName ?</span>
<a href="#l18.423"></a><span id="l18.423" class="difflineplus">+                        (host ? &quot;/&quot; + this.ellipsis + &quot;/&quot; : &quot;&quot;) + fileName :</span>
<a href="#l18.424"></a><span id="l18.424" class="difflineplus">+                        uri.path);</span>
<a href="#l18.425"></a><span id="l18.425" class="difflineplus">+      }</span>
<a href="#l18.426"></a><span id="l18.426" class="difflineplus">+      catch (e) {</span>
<a href="#l18.427"></a><span id="l18.427" class="difflineplus">+        // Use (no title) for non-standard URIs (data:, javascript:, ...)</span>
<a href="#l18.428"></a><span id="l18.428" class="difflineplus">+        title = &quot;&quot;;</span>
<a href="#l18.429"></a><span id="l18.429" class="difflineplus">+      }</span>
<a href="#l18.430"></a><span id="l18.430" class="difflineplus">+    }</span>
<a href="#l18.431"></a><span id="l18.431" class="difflineplus">+    else</span>
<a href="#l18.432"></a><span id="l18.432" class="difflineplus">+      title = aNode.title;</span>
<a href="#l18.433"></a><span id="l18.433" class="difflineplus">+</span>
<a href="#l18.434"></a><span id="l18.434" class="difflineplus">+    return title || this.getString(&quot;noTitle&quot;);</span>
<a href="#l18.435"></a><span id="l18.435" class="difflineplus">+  },</span>
<a href="#l18.436"></a><span id="l18.436" class="difflineplus">+};</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l19.1"></a><span id="l19.1" class="difflineminus">--- a/suite/common/jar.mn</span>
<a href="#l19.2"></a><span id="l19.2" class="difflineplus">+++ b/suite/common/jar.mn</span>
<a href="#l19.3"></a><span id="l19.3" class="difflineat">@@ -116,25 +116,27 @@ comm.jar:</span>
<a href="#l19.4"></a><span id="l19.4">    content/communicator/bookmarks/bookmarksTree.xml                 (bookmarks/bookmarksTree.xml)</span>
<a href="#l19.5"></a><span id="l19.5">    content/communicator/bookmarks/findBookmark.js                   (bookmarks/findBookmark.js)</span>
<a href="#l19.6"></a><span id="l19.6">    content/communicator/bookmarks/findBookmark.xul                  (bookmarks/findBookmark.xul)</span>
<a href="#l19.7"></a><span id="l19.7">    content/communicator/bookmarks/sortFolder.js                     (bookmarks/sortFolder.js)</span>
<a href="#l19.8"></a><span id="l19.8">    content/communicator/bookmarks/sortFolder.xul                    (bookmarks/sortFolder.xul)</span>
<a href="#l19.9"></a><span id="l19.9">    content/communicator/directory/directory.html                    (directory/directory.html)</span>
<a href="#l19.10"></a><span id="l19.10">    content/communicator/directory/directory.js                      (directory/directory.js)</span>
<a href="#l19.11"></a><span id="l19.11">    content/communicator/directory/directory.xul                     (directory/directory.xul)</span>
<a href="#l19.12"></a><span id="l19.12" class="difflineplus">+   content/communicator/history/controller.js                       (history/controller.js)</span>
<a href="#l19.13"></a><span id="l19.13">    content/communicator/history/history.js                          (history/history.js)</span>
<a href="#l19.14"></a><span id="l19.14">    content/communicator/history/history.xul                         (history/history.xul)</span>
<a href="#l19.15"></a><span id="l19.15" class="difflineminus">-   content/communicator/history/historyTreeOverlay.xul              (history/historyTreeOverlay.xul)</span>
<a href="#l19.16"></a><span id="l19.16" class="difflineminus">-   content/communicator/history/historyTreeSorting.js               (history/historyTreeSorting.js)</span>
<a href="#l19.17"></a><span id="l19.17">    content/communicator/history/history-panel.xul                   (history/history-panel.xul)</span>
<a href="#l19.18"></a><span id="l19.18" class="difflineminus">-   content/communicator/history/history-test.js                     (history/history-test.js)</span>
<a href="#l19.19"></a><span id="l19.19" class="difflineminus">-   content/communicator/history/history-test.xul                    (history/history-test.xul)</span>
<a href="#l19.20"></a><span id="l19.20" class="difflineminus">-   content/communicator/history/findHistory.js                      (history/findHistory.js)</span>
<a href="#l19.21"></a><span id="l19.21" class="difflineminus">-   content/communicator/history/findHistory.xul                     (history/findHistory.xul)</span>
<a href="#l19.22"></a><span id="l19.22" class="difflineplus">+   content/communicator/history/places.css                          (history/places.css)</span>
<a href="#l19.23"></a><span id="l19.23" class="difflineplus">+   content/communicator/history/places.js                           (history/places.js)</span>
<a href="#l19.24"></a><span id="l19.24" class="difflineplus">+   content/communicator/history/placesOverlay.xul                   (history/placesOverlay.xul)</span>
<a href="#l19.25"></a><span id="l19.25" class="difflineplus">+   content/communicator/history/sidebarUtils.js                     (history/sidebarUtils.js)</span>
<a href="#l19.26"></a><span id="l19.26" class="difflineplus">+   content/communicator/history/tree.xml                            (history/tree.xml)</span>
<a href="#l19.27"></a><span id="l19.27" class="difflineplus">+   content/communicator/history/treeView.js                         (history/treeView.js)</span>
<a href="#l19.28"></a><span id="l19.28" class="difflineplus">+*  content/communicator/history/utils.js                            (history/utils.js)</span>
<a href="#l19.29"></a><span id="l19.29">    content/communicator/permissions/cookieViewer.js                 (permissions/cookieViewer.js)</span>
<a href="#l19.30"></a><span id="l19.30">    content/communicator/permissions/cookieViewer.xul                (permissions/cookieViewer.xul)</span>
<a href="#l19.31"></a><span id="l19.31">    content/communicator/permissions/imageContextOverlay.xul         (permissions/imageContextOverlay.xul)</span>
<a href="#l19.32"></a><span id="l19.32">    content/communicator/permissions/permissionsManager.js           (permissions/permissionsManager.js)</span>
<a href="#l19.33"></a><span id="l19.33">    content/communicator/permissions/permissionsManager.xul          (permissions/permissionsManager.xul)</span>
<a href="#l19.34"></a><span id="l19.34">    content/communicator/permissions/permissionsNavigatorOverlay.xul (permissions/permissionsNavigatorOverlay.xul)</span>
<a href="#l19.35"></a><span id="l19.35">    content/communicator/permissions/permissionsOverlay.js           (permissions/permissionsOverlay.js)</span>
<a href="#l19.36"></a><span id="l19.36">    content/communicator/permissions/treeUtils.js                    (permissions/treeUtils.js)</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l20.1"></a><span id="l20.1" class="difflineminus">--- a/suite/confvars.sh</span>
<a href="#l20.2"></a><span id="l20.2" class="difflineplus">+++ b/suite/confvars.sh</span>
<a href="#l20.3"></a><span id="l20.3" class="difflineat">@@ -44,10 +44,11 @@ if [ &quot;$COMM_BUILD&quot; ]; then</span>
<a href="#l20.4"></a><span id="l20.4"> fi</span>
<a href="#l20.5"></a><span id="l20.5"> MOZ_STATIC_MAIL_BUILD=1</span>
<a href="#l20.6"></a><span id="l20.6"> MOZ_COMPOSER=1</span>
<a href="#l20.7"></a><span id="l20.7"> MOZ_SUITE=1</span>
<a href="#l20.8"></a><span id="l20.8"> MOZ_APP_VERSION=`cat $topsrcdir/$MOZ_BUILD_APP/config/version.txt`</span>
<a href="#l20.9"></a><span id="l20.9"> SEAMONKEY_VERSION=$MOZ_APP_VERSION</span>
<a href="#l20.10"></a><span id="l20.10"> MOZ_NO_XPCOM_OBSOLETE=1</span>
<a href="#l20.11"></a><span id="l20.11"> MOZ_EXTENSIONS_DEFAULT=&quot; wallet venkman inspector irc gnomevfs reporter&quot;</span>
<a href="#l20.12"></a><span id="l20.12" class="difflineplus">+MOZ_PLACES=1</span>
<a href="#l20.13"></a><span id="l20.13"> MOZ_UPDATER=1</span>
<a href="#l20.14"></a><span id="l20.14"> MOZ_HELP_VIEWER=1</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l21.1"></a><span id="l21.1" class="difflineminus">--- a/suite/installer/unix/packages</span>
<a href="#l21.2"></a><span id="l21.2" class="difflineplus">+++ b/suite/installer/unix/packages</span>
<a href="#l21.3"></a><span id="l21.3" class="difflineat">@@ -124,17 +124,16 @@ bin/components/exthandler.xpt</span>
<a href="#l21.4"></a><span id="l21.4"> bin/components/exthelper.xpt</span>
<a href="#l21.5"></a><span id="l21.5"> bin/components/fastfind.xpt</span>
<a href="#l21.6"></a><span id="l21.6"> bin/components/feeds.xpt</span>
<a href="#l21.7"></a><span id="l21.7"> bin/components/filepicker.xpt</span>
<a href="#l21.8"></a><span id="l21.8"> bin/components/libfileview.so</span>
<a href="#l21.9"></a><span id="l21.9"> bin/components/find.xpt</span>
<a href="#l21.10"></a><span id="l21.10"> bin/components/gfx.xpt</span>
<a href="#l21.11"></a><span id="l21.11"> bin/components/libgkgfxthebes.so</span>
<a href="#l21.12"></a><span id="l21.12" class="difflineminus">-bin/components/history.xpt</span>
<a href="#l21.13"></a><span id="l21.13"> bin/components/htmlparser.xpt</span>
<a href="#l21.14"></a><span id="l21.14"> bin/components/libgklayout.so</span>
<a href="#l21.15"></a><span id="l21.15"> bin/components/libgkplugin.so</span>
<a href="#l21.16"></a><span id="l21.16"> bin/components/libhtmlpars.so</span>
<a href="#l21.17"></a><span id="l21.17"> bin/components/libi18n.so</span>
<a href="#l21.18"></a><span id="l21.18"> bin/components/libimgicon.so</span>
<a href="#l21.19"></a><span id="l21.19"> bin/components/imgicon.xpt</span>
<a href="#l21.20"></a><span id="l21.20"> bin/components/libimglib2.so</span>
<a href="#l21.21"></a><span id="l21.21" class="difflineat">@@ -169,16 +168,18 @@ bin/components/necko_http.xpt</span>
<a href="#l21.22"></a><span id="l21.22"> bin/components/necko_res.xpt</span>
<a href="#l21.23"></a><span id="l21.23"> bin/components/necko_socket.xpt</span>
<a href="#l21.24"></a><span id="l21.24"> bin/components/necko_strconv.xpt</span>
<a href="#l21.25"></a><span id="l21.25"> bin/components/necko_viewsource.xpt</span>
<a href="#l21.26"></a><span id="l21.26"> bin/components/liboji.so</span>
<a href="#l21.27"></a><span id="l21.27"> bin/components/oji.xpt</span>
<a href="#l21.28"></a><span id="l21.28"> bin/components/parentalcontrols.xpt</span>
<a href="#l21.29"></a><span id="l21.29"> bin/components/libpermissions.so</span>
<a href="#l21.30"></a><span id="l21.30" class="difflineplus">+bin/components/places.xpt</span>
<a href="#l21.31"></a><span id="l21.31" class="difflineplus">+bin/components/libplaces.so</span>
<a href="#l21.32"></a><span id="l21.32"> bin/components/plugin.xpt</span>
<a href="#l21.33"></a><span id="l21.33"> bin/components/libpref.so</span>
<a href="#l21.34"></a><span id="l21.34"> bin/components/pref.xpt</span>
<a href="#l21.35"></a><span id="l21.35"> bin/components/prefetch.xpt</span>
<a href="#l21.36"></a><span id="l21.36"> bin/components/profile.xpt</span>
<a href="#l21.37"></a><span id="l21.37"> bin/components/proxyObjInst.xpt</span>
<a href="#l21.38"></a><span id="l21.38"> bin/components/libunixproxy.so</span>
<a href="#l21.39"></a><span id="l21.39"> bin/components/libremoteservice.so</span>
<a href="#l21.40"></a><span id="l21.40" class="difflineat">@@ -258,25 +259,28 @@ bin/components/nsBlocklistService.js</span>
<a href="#l21.41"></a><span id="l21.41"> bin/components/nsBrowserContentHandler.js</span>
<a href="#l21.42"></a><span id="l21.42"> bin/components/nsComposerCmdLineHandler.js</span>
<a href="#l21.43"></a><span id="l21.43"> bin/components/nsContentDispatchChooser.js</span>
<a href="#l21.44"></a><span id="l21.44"> bin/components/nsContentPrefService.js</span>
<a href="#l21.45"></a><span id="l21.45"> bin/components/nsDefaultCLH.js</span>
<a href="#l21.46"></a><span id="l21.46"> bin/components/nsDownloadProgressListener.js</span>
<a href="#l21.47"></a><span id="l21.47"> bin/components/nsExtensionManager.js</span>
<a href="#l21.48"></a><span id="l21.48"> bin/components/nsFilePicker.js</span>
<a href="#l21.49"></a><span id="l21.49" class="difflineplus">+bin/components/nsLivemarkService.js</span>
<a href="#l21.50"></a><span id="l21.50"> bin/components/nsLoginInfo.js</span>
<a href="#l21.51"></a><span id="l21.51"> bin/components/nsLoginManager.js</span>
<a href="#l21.52"></a><span id="l21.52"> bin/components/nsLoginManagerPrompter.js</span>
<a href="#l21.53"></a><span id="l21.53"> bin/components/nsHandlerService.js</span>
<a href="#l21.54"></a><span id="l21.54"> bin/components/nsHelperAppDlg.js</span>
<a href="#l21.55"></a><span id="l21.55" class="difflineplus">+bin/components/nsPlacesDBFlush.js</span>
<a href="#l21.56"></a><span id="l21.56"> bin/components/nsProgressDialog.js</span>
<a href="#l21.57"></a><span id="l21.57"> bin/components/nsProxyAutoConfig.js</span>
<a href="#l21.58"></a><span id="l21.58"> bin/components/nsSidebar.js</span>
<a href="#l21.59"></a><span id="l21.59"> bin/components/nsSuiteGlue.js</span>
<a href="#l21.60"></a><span id="l21.60" class="difflineplus">+bin/components/nsTaggingService.js</span>
<a href="#l21.61"></a><span id="l21.61"> bin/components/nsTypeAheadFind.js</span>
<a href="#l21.62"></a><span id="l21.62"> bin/components/nsTryToClose.js</span>
<a href="#l21.63"></a><span id="l21.63"> bin/components/nsUpdateService.js</span>
<a href="#l21.64"></a><span id="l21.64"> bin/components/nsURLFormatter.js</span>
<a href="#l21.65"></a><span id="l21.65"> bin/components/nsWebHandlerApp.js</span>
<a href="#l21.66"></a><span id="l21.66"> bin/components/pluginGlue.js</span>
<a href="#l21.67"></a><span id="l21.67"> bin/components/storage-Legacy.js</span>
<a href="#l21.68"></a><span id="l21.68"> bin/components/txEXSLTRegExFunctions.js</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l22.1"></a><span id="l22.1" class="difflineminus">--- a/suite/installer/windows/packages</span>
<a href="#l22.2"></a><span id="l22.2" class="difflineplus">+++ b/suite/installer/windows/packages</span>
<a href="#l22.3"></a><span id="l22.3" class="difflineat">@@ -132,17 +132,16 @@ bin\components\extensions.xpt</span>
<a href="#l22.4"></a><span id="l22.4"> bin\components\exthandler.xpt</span>
<a href="#l22.5"></a><span id="l22.5"> bin\components\exthelper.xpt</span>
<a href="#l22.6"></a><span id="l22.6"> bin\components\fastfind.xpt</span>
<a href="#l22.7"></a><span id="l22.7"> bin\components\feeds.xpt</span>
<a href="#l22.8"></a><span id="l22.8"> bin\components\find.xpt</span>
<a href="#l22.9"></a><span id="l22.9"> bin\components\gklayout.dll</span>
<a href="#l22.10"></a><span id="l22.10"> bin\components\gkparser.dll</span>
<a href="#l22.11"></a><span id="l22.11"> bin\components\gkplugin.dll</span>
<a href="#l22.12"></a><span id="l22.12" class="difflineminus">-bin\components\history.xpt</span>
<a href="#l22.13"></a><span id="l22.13"> bin\components\htmlparser.xpt</span>
<a href="#l22.14"></a><span id="l22.14"> bin\components\i18n.dll</span>
<a href="#l22.15"></a><span id="l22.15"> bin\components\imgicon.dll</span>
<a href="#l22.16"></a><span id="l22.16"> bin\components\imgicon.xpt</span>
<a href="#l22.17"></a><span id="l22.17"> bin\components\imglib2.dll</span>
<a href="#l22.18"></a><span id="l22.18"> bin\components\imglib2.xpt</span>
<a href="#l22.19"></a><span id="l22.19"> bin\components\inspector.xpt</span>
<a href="#l22.20"></a><span id="l22.20"> bin\components\intl.xpt</span>
<a href="#l22.21"></a><span id="l22.21" class="difflineat">@@ -258,24 +257,27 @@ bin\components\nsAxSecurityPolicy.js</span>
<a href="#l22.22"></a><span id="l22.22"> bin\components\nsBadCertHandler.js</span>
<a href="#l22.23"></a><span id="l22.23"> bin\components\nsBlocklistService.js</span>
<a href="#l22.24"></a><span id="l22.24"> bin\components\nsBrowserContentHandler.js</span>
<a href="#l22.25"></a><span id="l22.25"> bin\components\nsTryToClose.js</span>
<a href="#l22.26"></a><span id="l22.26"> bin\components\nsComposerCmdLineHandler.js</span>
<a href="#l22.27"></a><span id="l22.27"> bin\components\nsContentDispatchChooser.js</span>
<a href="#l22.28"></a><span id="l22.28"> bin\components\nsContentPrefService.js</span>
<a href="#l22.29"></a><span id="l22.29"> bin\components\nsExtensionManager.js</span>
<a href="#l22.30"></a><span id="l22.30" class="difflineplus">+bin\components\nsLivemarkService.js</span>
<a href="#l22.31"></a><span id="l22.31"> bin\components\nsLoginInfo.js</span>
<a href="#l22.32"></a><span id="l22.32"> bin\components\nsLoginManager.js</span>
<a href="#l22.33"></a><span id="l22.33"> bin\components\nsLoginManagerPrompter.js</span>
<a href="#l22.34"></a><span id="l22.34" class="difflineplus">+bin\components\nsPlacesDBFlush.js</span>
<a href="#l22.35"></a><span id="l22.35"> bin\components\nsPostUpdateWin.js</span>
<a href="#l22.36"></a><span id="l22.36"> bin\components\nsProxyAutoConfig.js</span>
<a href="#l22.37"></a><span id="l22.37"> bin\components\nsSetDefault.js</span>
<a href="#l22.38"></a><span id="l22.38"> bin\components\nsSidebar.js</span>
<a href="#l22.39"></a><span id="l22.39"> bin\components\nsSuiteGlue.js</span>
<a href="#l22.40"></a><span id="l22.40" class="difflineplus">+bin\components\nsTaggingService.js</span>
<a href="#l22.41"></a><span id="l22.41"> bin\components\nsTypeAheadFind.js</span>
<a href="#l22.42"></a><span id="l22.42"> bin\components\nsUpdateService.js</span>
<a href="#l22.43"></a><span id="l22.43"> bin\components\nsURLFormatter.js</span>
<a href="#l22.44"></a><span id="l22.44"> bin\components\pluginGlue.js</span>
<a href="#l22.45"></a><span id="l22.45"> bin\components\storage-Legacy.js</span>
<a href="#l22.46"></a><span id="l22.46"> bin\components\txEXSLTRegExFunctions.js</span>
<a href="#l22.47"></a><span id="l22.47"> bin\components\nsAboutAbout.js</span>
<a href="#l22.48"></a><span id="l22.48"> bin\components\nsDefaultCLH.js</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l23.1"></a><span id="l23.1">deleted file mode 100644</span>
<a href="#l23.2"></a><span id="l23.2" class="difflineminus">--- a/suite/locales/en-US/chrome/common/history/findHistory.dtd</span>
<a href="#l23.3"></a><span id="l23.3" class="difflineplus">+++ /dev/null</span>
<a href="#l23.4"></a><span id="l23.4" class="difflineat">@@ -1,13 +0,0 @@</span>
<a href="#l23.5"></a><span id="l23.5" class="difflineminus">-</span>
<a href="#l23.6"></a><span id="l23.6" class="difflineminus">-&lt;!ENTITY search.name.label              &quot;title&quot;&gt;</span>
<a href="#l23.7"></a><span id="l23.7" class="difflineminus">-&lt;!ENTITY search.url.label               &quot;location&quot;&gt;</span>
<a href="#l23.8"></a><span id="l23.8" class="difflineminus">-&lt;!ENTITY search.startswith.label        &quot;starts with&quot;&gt;</span>
<a href="#l23.9"></a><span id="l23.9" class="difflineminus">-&lt;!ENTITY search.endswith.label          &quot;ends with&quot;&gt;</span>
<a href="#l23.10"></a><span id="l23.10" class="difflineminus">-&lt;!ENTITY search.is.label                &quot;is&quot;&gt;</span>
<a href="#l23.11"></a><span id="l23.11" class="difflineminus">-&lt;!ENTITY search.isnot.label             &quot;is not&quot;&gt;</span>
<a href="#l23.12"></a><span id="l23.12" class="difflineminus">-&lt;!ENTITY search.contains.label          &quot;contains&quot;&gt;</span>
<a href="#l23.13"></a><span id="l23.13" class="difflineminus">-&lt;!ENTITY search.doesntcontain.label     &quot;doesn't contain&quot;&gt;</span>
<a href="#l23.14"></a><span id="l23.14" class="difflineminus">-&lt;!ENTITY search.for.label               &quot;Find visited documents whose&quot;&gt;</span>
<a href="#l23.15"></a><span id="l23.15" class="difflineminus">-&lt;!ENTITY findHistory.title              &quot;Find in History&quot;&gt;</span>
<a href="#l23.16"></a><span id="l23.16" class="difflineminus">-&lt;!ENTITY findButton.label               &quot;Find&quot;&gt;</span>
<a href="#l23.17"></a><span id="l23.17" class="difflineminus">-</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l24.1"></a><span id="l24.1" class="difflineminus">--- a/suite/locales/en-US/chrome/common/history/history.dtd</span>
<a href="#l24.2"></a><span id="l24.2" class="difflineplus">+++ b/suite/locales/en-US/chrome/common/history/history.dtd</span>
<a href="#l24.3"></a><span id="l24.3" class="difflineat">@@ -1,35 +1,47 @@</span>
<a href="#l24.4"></a><span id="l24.4" class="difflineminus">-&lt;!-- extracted from ./history.xul --&gt;</span>
<a href="#l24.5"></a><span id="l24.5" class="difflineplus">+&lt;!-- history.xul, history-panel.xul, placesOverlay.xul --&gt;</span>
<a href="#l24.6"></a><span id="l24.6" class="difflineplus">+</span>
<a href="#l24.7"></a><span id="l24.7" class="difflineplus">+&lt;!ENTITY historyWindowTitle.label       &quot;History&quot;&gt;</span>
<a href="#l24.8"></a><span id="l24.8" class="difflineplus">+&lt;!ENTITY menuBar.tooltip                &quot;Menu Bar&quot;&gt;</span>
<a href="#l24.9"></a><span id="l24.9" class="difflineplus">+&lt;!ENTITY searchBar.tooltip              &quot;Search Bar&quot;&gt;</span>
<a href="#l24.10"></a><span id="l24.10" class="difflineplus">+</span>
<a href="#l24.11"></a><span id="l24.11" class="difflineplus">+&lt;!ENTITY search.emptytext               &quot;Search History&quot;&gt;</span>
<a href="#l24.12"></a><span id="l24.12" class="difflineplus">+&lt;!ENTITY search.key                     &quot;f&quot;&gt;</span>
<a href="#l24.13"></a><span id="l24.13" class="difflineplus">+&lt;!ENTITY view.label                     &quot;View&quot;&gt;</span>
<a href="#l24.14"></a><span id="l24.14" class="difflineplus">+&lt;!ENTITY byDate.label                   &quot;By Date&quot;&gt;</span>
<a href="#l24.15"></a><span id="l24.15" class="difflineplus">+&lt;!ENTITY byDate.accesskey               &quot;D&quot;&gt;</span>
<a href="#l24.16"></a><span id="l24.16" class="difflineplus">+&lt;!ENTITY bySite.label                   &quot;By Site&quot;&gt;</span>
<a href="#l24.17"></a><span id="l24.17" class="difflineplus">+&lt;!ENTITY bySite.accesskey               &quot;S&quot;&gt;</span>
<a href="#l24.18"></a><span id="l24.18" class="difflineplus">+&lt;!ENTITY byMostVisited.label            &quot;By Most Visited&quot;&gt;</span>
<a href="#l24.19"></a><span id="l24.19" class="difflineplus">+&lt;!ENTITY byMostVisited.accesskey        &quot;V&quot;&gt;</span>
<a href="#l24.20"></a><span id="l24.20" class="difflineplus">+&lt;!ENTITY byLastVisited.label            &quot;By Last Visited&quot;&gt;</span>
<a href="#l24.21"></a><span id="l24.21" class="difflineplus">+&lt;!ENTITY byLastVisited.accesskey        &quot;L&quot;&gt;</span>
<a href="#l24.22"></a><span id="l24.22" class="difflineplus">+&lt;!ENTITY byDayAndSite.label             &quot;By Date and Site&quot;&gt;</span>
<a href="#l24.23"></a><span id="l24.23" class="difflineplus">+&lt;!ENTITY byDayAndSite.accesskey         &quot;t&quot;&gt;</span>
<a href="#l24.24"></a><span id="l24.24"> </span>
<a href="#l24.25"></a><span id="l24.25" class="difflineminus">-&lt;!ENTITY menuBar.tooltip            &quot;Menu Bar&quot;&gt;</span>
<a href="#l24.26"></a><span id="l24.26" class="difflineminus">-&lt;!ENTITY fileMenu.label             &quot;File&quot;&gt;</span>
<a href="#l24.27"></a><span id="l24.27" class="difflineminus">-&lt;!ENTITY closeCmd.label             &quot;Close&quot;&gt;</span>
<a href="#l24.28"></a><span id="l24.28" class="difflineminus">-&lt;!ENTITY editMenu.label             &quot;Edit&quot;&gt; </span>
<a href="#l24.29"></a><span id="l24.29" class="difflineminus">-&lt;!ENTITY undoCmd.label              &quot;Undo&quot;&gt;</span>
<a href="#l24.30"></a><span id="l24.30" class="difflineminus">-&lt;!ENTITY redoCmd.label              &quot;Redo&quot;&gt;</span>
<a href="#l24.31"></a><span id="l24.31" class="difflineminus">-&lt;!ENTITY cutCmd.label               &quot;Cut&quot;&gt;</span>
<a href="#l24.32"></a><span id="l24.32" class="difflineminus">-&lt;!ENTITY copyCmd.label              &quot;Copy&quot;&gt;</span>
<a href="#l24.33"></a><span id="l24.33" class="difflineminus">-&lt;!ENTITY pasteCmd.label             &quot;Paste&quot;&gt;</span>
<a href="#l24.34"></a><span id="l24.34" class="difflineminus">-&lt;!ENTITY deleteCmd.label            &quot;Delete&quot;&gt;</span>
<a href="#l24.35"></a><span id="l24.35" class="difflineminus">-&lt;!ENTITY deleteHostnameCmd.accesskey &quot;H&quot;&gt;</span>
<a href="#l24.36"></a><span id="l24.36" class="difflineminus">-&lt;!ENTITY deleteDomainCmd.accesskey  &quot;s&quot;&gt;</span>
<a href="#l24.37"></a><span id="l24.37" class="difflineminus">-&lt;!ENTITY selAllCmd.label            &quot;Select All&quot;&gt;</span>
<a href="#l24.38"></a><span id="l24.38" class="difflineminus">-&lt;!ENTITY findHisCmd.label           &quot;Search History…&quot;&gt;</span>
<a href="#l24.39"></a><span id="l24.39" class="difflineminus">-&lt;!ENTITY findHisCmd.commandkey      &quot;f&quot;&gt;</span>
<a href="#l24.40"></a><span id="l24.40" class="difflineminus">-&lt;!ENTITY findHisCmd.accesskey       &quot;S&quot;&gt;</span>
<a href="#l24.41"></a><span id="l24.41" class="difflineminus">-&lt;!ENTITY groupBy.label              &quot;Group By&quot;&gt;</span>
<a href="#l24.42"></a><span id="l24.42" class="difflineminus">-&lt;!ENTITY groupBy.accesskey          &quot;G&quot;&gt;</span>
<a href="#l24.43"></a><span id="l24.43" class="difflineminus">-&lt;!ENTITY groupByDay.label           &quot;Day&quot;&gt;</span>
<a href="#l24.44"></a><span id="l24.44" class="difflineminus">-&lt;!ENTITY groupByDay.accesskey       &quot;D&quot;&gt;</span>
<a href="#l24.45"></a><span id="l24.45" class="difflineminus">-&lt;!ENTITY groupBySite.label          &quot;Site&quot;&gt;</span>
<a href="#l24.46"></a><span id="l24.46" class="difflineminus">-&lt;!ENTITY groupBySite.accesskey      &quot;S&quot;&gt;</span>
<a href="#l24.47"></a><span id="l24.47" class="difflineminus">-&lt;!ENTITY groupByNone.label          &quot;None&quot;&gt;</span>
<a href="#l24.48"></a><span id="l24.48" class="difflineminus">-&lt;!ENTITY groupByNone.accesskey      &quot;N&quot;&gt;</span>
<a href="#l24.49"></a><span id="l24.49" class="difflineminus">-&lt;!ENTITY historyWindowTitle.label   &quot;History&quot;&gt;</span>
<a href="#l24.50"></a><span id="l24.50" class="difflineminus">-&lt;!ENTITY menuitem.view.unsorted.label &quot;Unsorted&quot;&gt;</span>
<a href="#l24.51"></a><span id="l24.51" class="difflineminus">-&lt;!ENTITY menuitem.view.unsorted.accesskey &quot;u&quot;&gt;</span>
<a href="#l24.52"></a><span id="l24.52" class="difflineminus">-&lt;!ENTITY sortAscending.label         &quot;Ascending&quot;&gt;</span>
<a href="#l24.53"></a><span id="l24.53" class="difflineminus">-&lt;!ENTITY sortAscending.accesskey     &quot;A&quot;&gt;</span>
<a href="#l24.54"></a><span id="l24.54" class="difflineminus">-&lt;!ENTITY sortDescending.label        &quot;Descending&quot;&gt;</span>
<a href="#l24.55"></a><span id="l24.55" class="difflineminus">-&lt;!ENTITY sortDescending.accesskey    &quot;D&quot;&gt;</span>
<a href="#l24.56"></a><span id="l24.56" class="difflineminus">-&lt;!ENTITY menuitem.view.show_columns.label &quot;Show columns&quot;&gt;</span>
<a href="#l24.57"></a><span id="l24.57" class="difflineminus">-&lt;!ENTITY menuitem.view.show_columns.accesskey &quot;S&quot;&gt;</span>
<a href="#l24.58"></a><span id="l24.58" class="difflineplus">+&lt;!ENTITY view.columns.label             &quot;Show Columns&quot;&gt;</span>
<a href="#l24.59"></a><span id="l24.59" class="difflineplus">+&lt;!ENTITY view.columns.accesskey         &quot;C&quot;&gt;</span>
<a href="#l24.60"></a><span id="l24.60" class="difflineplus">+&lt;!ENTITY view.sort.label                &quot;Sort&quot;&gt;</span>
<a href="#l24.61"></a><span id="l24.61" class="difflineplus">+&lt;!ENTITY view.sort.accesskey            &quot;S&quot;&gt;</span>
<a href="#l24.62"></a><span id="l24.62" class="difflineplus">+&lt;!ENTITY view.unsorted.label            &quot;Unsorted&quot;&gt;</span>
<a href="#l24.63"></a><span id="l24.63" class="difflineplus">+&lt;!ENTITY view.unsorted.accesskey        &quot;U&quot;&gt;</span>
<a href="#l24.64"></a><span id="l24.64" class="difflineplus">+&lt;!ENTITY view.sortAscending.label       &quot;A &gt; Z Sort Order&quot;&gt;</span>
<a href="#l24.65"></a><span id="l24.65" class="difflineplus">+&lt;!ENTITY view.sortAscending.accesskey   &quot;A&quot;&gt;</span>
<a href="#l24.66"></a><span id="l24.66" class="difflineplus">+&lt;!ENTITY view.sortDescending.label      &quot;Z &gt; A Sort Order&quot;&gt;</span>
<a href="#l24.67"></a><span id="l24.67" class="difflineplus">+&lt;!ENTITY view.sortDescending.accesskey  &quot;Z&quot;&gt;</span>
<a href="#l24.68"></a><span id="l24.68" class="difflineplus">+</span>
<a href="#l24.69"></a><span id="l24.69" class="difflineplus">+&lt;!ENTITY cmd.open.label                 &quot;Open&quot;&gt;</span>
<a href="#l24.70"></a><span id="l24.70" class="difflineplus">+&lt;!ENTITY cmd.open.accesskey             &quot;O&quot;&gt;</span>
<a href="#l24.71"></a><span id="l24.71" class="difflineplus">+&lt;!ENTITY cmd.open_window.label          &quot;Open Link in New Window&quot;&gt;</span>
<a href="#l24.72"></a><span id="l24.72" class="difflineplus">+&lt;!ENTITY cmd.open_window.accesskey      &quot;N&quot;&gt;</span>
<a href="#l24.73"></a><span id="l24.73" class="difflineplus">+&lt;!ENTITY cmd.open_tab.label             &quot;Open Link in New Tab&quot;&gt;</span>
<a href="#l24.74"></a><span id="l24.74" class="difflineplus">+&lt;!ENTITY cmd.open_tab.accesskey         &quot;w&quot;&gt;</span>
<a href="#l24.75"></a><span id="l24.75" class="difflineplus">+&lt;!ENTITY cmd.open_all_in_tabs.label     &quot;Open All in Tabs&quot;&gt;</span>
<a href="#l24.76"></a><span id="l24.76" class="difflineplus">+&lt;!ENTITY cmd.open_all_in_tabs.accesskey &quot;O&quot;&gt;</span>
<a href="#l24.77"></a><span id="l24.77" class="difflineplus">+</span>
<a href="#l24.78"></a><span id="l24.78" class="difflineplus">+&lt;!ENTITY bookmarkCmd.label              &quot;Bookmark This Link…&quot;&gt;</span>
<a href="#l24.79"></a><span id="l24.79" class="difflineplus">+&lt;!ENTITY bookmarkCmd.accesskey          &quot;B&quot;&gt;</span>
<a href="#l24.80"></a><span id="l24.80" class="difflineplus">+</span>
<a href="#l24.81"></a><span id="l24.81" class="difflineplus">+&lt;!ENTITY col.name.label                 &quot;Title&quot;&gt;</span>
<a href="#l24.82"></a><span id="l24.82" class="difflineplus">+&lt;!ENTITY col.url.label                  &quot;Location&quot;&gt;</span>
<a href="#l24.83"></a><span id="l24.83" class="difflineplus">+&lt;!ENTITY col.lastvisit.label            &quot;Last Visited&quot;&gt;</span>
<a href="#l24.84"></a><span id="l24.84" class="difflineplus">+&lt;!ENTITY col.visitcount.label           &quot;Visit Count&quot;&gt;</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l25.1"></a><span id="l25.1">deleted file mode 100644</span>
<a href="#l25.2"></a><span id="l25.2" class="difflineminus">--- a/suite/locales/en-US/chrome/common/history/history.properties</span>
<a href="#l25.3"></a><span id="l25.3" class="difflineplus">+++ /dev/null</span>
<a href="#l25.4"></a><span id="l25.4" class="difflineat">@@ -1,20 +0,0 @@</span>
<a href="#l25.5"></a><span id="l25.5" class="difflineminus">-deleteHost=Delete History for %S</span>
<a href="#l25.6"></a><span id="l25.6" class="difflineminus">-deleteHostNoSelection=Delete History for Site</span>
<a href="#l25.7"></a><span id="l25.7" class="difflineminus">-deleteDomain=Delete History for *.%S</span>
<a href="#l25.8"></a><span id="l25.8" class="difflineminus">-deleteDomainNoSelection=Delete History for Domain</span>
<a href="#l25.9"></a><span id="l25.9" class="difflineminus">-</span>
<a href="#l25.10"></a><span id="l25.10" class="difflineminus">-finduri-AgeInDays-is-0=Today</span>
<a href="#l25.11"></a><span id="l25.11" class="difflineminus">-finduri-AgeInDays-is-1=Yesterday</span>
<a href="#l25.12"></a><span id="l25.12" class="difflineminus">-finduri-AgeInDays-is=%S days ago</span>
<a href="#l25.13"></a><span id="l25.13" class="difflineminus">-finduri-AgeInDays-isgreater=Older than %S days</span>
<a href="#l25.14"></a><span id="l25.14" class="difflineminus">-</span>
<a href="#l25.15"></a><span id="l25.15" class="difflineminus">-finduri-Hostname-is-=(no host)</span>
<a href="#l25.16"></a><span id="l25.16" class="difflineminus">-</span>
<a href="#l25.17"></a><span id="l25.17" class="difflineminus">-search_results_title=Search Results</span>
<a href="#l25.18"></a><span id="l25.18" class="difflineminus">-</span>
<a href="#l25.19"></a><span id="l25.19" class="difflineminus">-collapseLabel=Collapse</span>
<a href="#l25.20"></a><span id="l25.20" class="difflineminus">-expandLabel=Expand</span>
<a href="#l25.21"></a><span id="l25.21" class="difflineminus">-collapseAccesskey=C</span>
<a href="#l25.22"></a><span id="l25.22" class="difflineminus">-expandAccesskey=x</span>
<a href="#l25.23"></a><span id="l25.23" class="difflineminus">-</span>
<a href="#l25.24"></a><span id="l25.24" class="difflineminus">-load-js-data-url-error=For security reasons, javascript or data urls cannot be loaded from the history window or sidebar.</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l26.1"></a><span id="l26.1">deleted file mode 100644</span>
<a href="#l26.2"></a><span id="l26.2" class="difflineminus">--- a/suite/locales/en-US/chrome/common/history/historyTreeOverlay.dtd</span>
<a href="#l26.3"></a><span id="l26.3" class="difflineplus">+++ /dev/null</span>
<a href="#l26.4"></a><span id="l26.4" class="difflineat">@@ -1,16 +0,0 @@</span>
<a href="#l26.5"></a><span id="l26.5" class="difflineminus">-&lt;!ENTITY tree.header.name.label               &quot;Title&quot;&gt;</span>
<a href="#l26.6"></a><span id="l26.6" class="difflineminus">-&lt;!ENTITY tree.header.name.accesskey           &quot;T&quot;&gt;</span>
<a href="#l26.7"></a><span id="l26.7" class="difflineminus">-&lt;!ENTITY tree.header.url.label                &quot;Location&quot;&gt;</span>
<a href="#l26.8"></a><span id="l26.8" class="difflineminus">-&lt;!ENTITY tree.header.url.accesskey            &quot;L&quot;&gt;</span>
<a href="#l26.9"></a><span id="l26.9" class="difflineminus">-&lt;!ENTITY tree.header.date.label               &quot;Last Visited&quot;&gt;</span>
<a href="#l26.10"></a><span id="l26.10" class="difflineminus">-&lt;!ENTITY tree.header.date.accesskey           &quot;V&quot;&gt;</span>
<a href="#l26.11"></a><span id="l26.11" class="difflineminus">-&lt;!ENTITY tree.header.firstvisitdate.label     &quot;First Visited&quot;&gt;</span>
<a href="#l26.12"></a><span id="l26.12" class="difflineminus">-&lt;!ENTITY tree.header.firstvisitdate.accesskey &quot;F&quot;&gt;</span>
<a href="#l26.13"></a><span id="l26.13" class="difflineminus">-&lt;!ENTITY tree.header.referrer.label           &quot;Referrer&quot;&gt;</span>
<a href="#l26.14"></a><span id="l26.14" class="difflineminus">-&lt;!ENTITY tree.header.referrer.accesskey       &quot;R&quot;&gt;</span>
<a href="#l26.15"></a><span id="l26.15" class="difflineminus">-&lt;!ENTITY tree.header.hostname.label           &quot;Hostname&quot;&gt;</span>
<a href="#l26.16"></a><span id="l26.16" class="difflineminus">-&lt;!ENTITY tree.header.hostname.accesskey       &quot;H&quot;&gt;</span>
<a href="#l26.17"></a><span id="l26.17" class="difflineminus">-&lt;!ENTITY tree.header.visitcount.label         &quot;Visit Count&quot;&gt;</span>
<a href="#l26.18"></a><span id="l26.18" class="difflineminus">-&lt;!ENTITY tree.header.visitcount.accesskey     &quot;C&quot;&gt;</span>
<a href="#l26.19"></a><span id="l26.19" class="difflineminus">-&lt;!ENTITY bookmarkLinksCmd.label               &quot;Bookmark These Links&quot;&gt;</span>
<a href="#l26.20"></a><span id="l26.20" class="difflineminus">-&lt;!ENTITY bookmarkLinksCmd.accesskey           &quot;L&quot;&gt;</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l27.1"></a><span id="l27.1">new file mode 100644</span>
<a href="#l27.2"></a><span id="l27.2" class="difflineminus">--- /dev/null</span>
<a href="#l27.3"></a><span id="l27.3" class="difflineplus">+++ b/suite/locales/en-US/chrome/common/history/places.properties</span>
<a href="#l27.4"></a><span id="l27.4" class="difflineat">@@ -0,0 +1,25 @@</span>
<a href="#l27.5"></a><span id="l27.5" class="difflineplus">+load-js-data-url-error=For security reasons, javascript or data urls cannot be loaded from the history window or sidebar.</span>
<a href="#l27.6"></a><span id="l27.6" class="difflineplus">+noTitle=(no title)</span>
<a href="#l27.7"></a><span id="l27.7" class="difflineplus">+</span>
<a href="#l27.8"></a><span id="l27.8" class="difflineplus">+bookmarksMenuEmptyFolder=(Empty)</span>
<a href="#l27.9"></a><span id="l27.9" class="difflineplus">+</span>
<a href="#l27.10"></a><span id="l27.10" class="difflineplus">+view.sortBy.name.label=Sort by Name</span>
<a href="#l27.11"></a><span id="l27.11" class="difflineplus">+view.sortBy.name.accesskey=N</span>
<a href="#l27.12"></a><span id="l27.12" class="difflineplus">+view.sortBy.url.label=Sort by Location</span>
<a href="#l27.13"></a><span id="l27.13" class="difflineplus">+view.sortBy.url.accesskey=L</span>
<a href="#l27.14"></a><span id="l27.14" class="difflineplus">+view.sortBy.date.label=Sort by Visit Date</span>
<a href="#l27.15"></a><span id="l27.15" class="difflineplus">+view.sortBy.date.accesskey=V</span>
<a href="#l27.16"></a><span id="l27.16" class="difflineplus">+view.sortBy.visitCount.label=Sort by Visit Count</span>
<a href="#l27.17"></a><span id="l27.17" class="difflineplus">+view.sortBy.visitCount.accesskey=C</span>
<a href="#l27.18"></a><span id="l27.18" class="difflineplus">+view.sortBy.dateAdded.label=Sort by Added</span>
<a href="#l27.19"></a><span id="l27.19" class="difflineplus">+view.sortBy.dateAdded.accesskey=e</span>
<a href="#l27.20"></a><span id="l27.20" class="difflineplus">+view.sortBy.lastModified.label=Sort by Last Modified</span>
<a href="#l27.21"></a><span id="l27.21" class="difflineplus">+view.sortBy.lastModified.accesskey=M</span>
<a href="#l27.22"></a><span id="l27.22" class="difflineplus">+</span>
<a href="#l27.23"></a><span id="l27.23" class="difflineplus">+searchHistory=Search History</span>
<a href="#l27.24"></a><span id="l27.24" class="difflineplus">+searchCurrentDefault=Search in '%S'</span>
<a href="#l27.25"></a><span id="l27.25" class="difflineplus">+</span>
<a href="#l27.26"></a><span id="l27.26" class="difflineplus">+tabs.openWarningTitle=Confirm open</span>
<a href="#l27.27"></a><span id="l27.27" class="difflineplus">+tabs.openWarningMultipleBranded=You are about to open %S tabs.  This might slow down %S while the pages are loading.  Are you sure you want to continue?</span>
<a href="#l27.28"></a><span id="l27.28" class="difflineplus">+tabs.openButtonMultiple=Open tabs</span>
<a href="#l27.29"></a><span id="l27.29" class="difflineplus">+tabs.openWarningPromptMeBranded=Warn me when opening multiple tabs might slow down %S</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l28.1"></a><span id="l28.1" class="difflineminus">--- a/suite/locales/jar.mn</span>
<a href="#l28.2"></a><span id="l28.2" class="difflineplus">+++ b/suite/locales/jar.mn</span>
<a href="#l28.3"></a><span id="l28.3" class="difflineat">@@ -116,19 +116,17 @@</span>
<a href="#l28.4"></a><span id="l28.4">   locale/@AB_CD@/communicator/help/images/taskbar.png                       (%chrome/common/help/images/taskbar.png)</span>
<a href="#l28.5"></a><span id="l28.5">   locale/@AB_CD@/communicator/help/images/taskbar-ab.png                    (%chrome/common/help/images/taskbar-ab.png)</span>
<a href="#l28.6"></a><span id="l28.6">   locale/@AB_CD@/communicator/help/images/task_mail.png                     (%chrome/common/help/images/task_mail.png)</span>
<a href="#l28.7"></a><span id="l28.7">   locale/@AB_CD@/communicator/help/images/task_newmail.png                  (%chrome/common/help/images/task_newmail.png)</span>
<a href="#l28.8"></a><span id="l28.8">   locale/@AB_CD@/communicator/help/images/threadbutton.png                  (%chrome/common/help/images/threadbutton.png)</span>
<a href="#l28.9"></a><span id="l28.9">   locale/@AB_CD@/communicator/help/images/web-links.png                     (%chrome/common/help/images/web-links.png)</span>
<a href="#l28.10"></a><span id="l28.10">   locale/@AB_CD@/communicator/help/images/wink.png                          (%chrome/common/help/images/wink.png)</span>
<a href="#l28.11"></a><span id="l28.11">   locale/@AB_CD@/communicator/history/history.dtd                           (%chrome/common/history/history.dtd)</span>
<a href="#l28.12"></a><span id="l28.12" class="difflineminus">-  locale/@AB_CD@/communicator/history/historyTreeOverlay.dtd                (%chrome/common/history/historyTreeOverlay.dtd)</span>
<a href="#l28.13"></a><span id="l28.13" class="difflineminus">-  locale/@AB_CD@/communicator/history/history.properties                    (%chrome/common/history/history.properties)</span>
<a href="#l28.14"></a><span id="l28.14" class="difflineminus">-  locale/@AB_CD@/communicator/history/findHistory.dtd                       (%chrome/common/history/findHistory.dtd)</span>
<a href="#l28.15"></a><span id="l28.15" class="difflineplus">+  locale/@AB_CD@/communicator/history/places.properties                     (%chrome/common/history/places.properties)</span>
<a href="#l28.16"></a><span id="l28.16">   locale/@AB_CD@/communicator/migration/migration.dtd                       (%chrome/common/migration/migration.dtd)</span>
<a href="#l28.17"></a><span id="l28.17">   locale/@AB_CD@/communicator/migration/migration.properties                (%chrome/common/migration/migration.properties)</span>
<a href="#l28.18"></a><span id="l28.18">   locale/@AB_CD@/communicator/permissions/cookieViewer.properties           (%chrome/common/permissions/cookieViewer.properties)</span>
<a href="#l28.19"></a><span id="l28.19">   locale/@AB_CD@/communicator/permissions/cookieViewer.dtd                  (%chrome/common/permissions/cookieViewer.dtd)</span>
<a href="#l28.20"></a><span id="l28.20">   locale/@AB_CD@/communicator/permissions/permissionsManager.dtd            (%chrome/common/permissions/permissionsManager.dtd)</span>
<a href="#l28.21"></a><span id="l28.21">   locale/@AB_CD@/communicator/permissions/permissionsManager.properties     (%chrome/common/permissions/permissionsManager.properties)</span>
<a href="#l28.22"></a><span id="l28.22">   locale/@AB_CD@/communicator/permissions/permissionsNavigatorOverlay.dtd   (%chrome/common/permissions/permissionsNavigatorOverlay.dtd)</span>
<a href="#l28.23"></a><span id="l28.23">   locale/@AB_CD@/communicator/pref/prefutilities.properties                 (%chrome/common/pref/prefutilities.properties)</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l29.1"></a><span id="l29.1">new file mode 100644</span>
<a href="#l29.2"></a><span id="l29.2">index e69de29bb2d1d6434b8b29ae775ad8c2e48c5391..1855c9f507f4794b9fc392c1700ca07f963c0ece</span>
<a href="#l29.3"></a><span id="l29.3">GIT binary patch
literal 614
zc$@)d0-61ZP)&lt;h;3K|Lk000e1NJLTq000mG000mO1^@s6AM^iV0000PbVXQnQ*UN;
zcVTj606}DLVr3vnZDD6+Qe|Oed2z{QJOBU!2uVaiRCwB?Q$1)DQ4pRx4k2Q#MmP~I
z5-mK)j}Vh0212gUQc|U{v#_uc1d}2th+Ltd!KAy+CMhIEPKY^3Asz-Ih?U5(f*=xO
z?l#`OeeaF)^EM`63UOfeeY~A-=9}5s+=sb`2!|LVJF0s&lt;{XX1(`(CcVffoio!M|GL
z^(i?e0ep!8QVUZrk3e;F3!syz|LOoFMzJw4wKWXYqpL!3XKu)um#1f~9;&amp;yx2zz?V
z?g9&gt;{5ATCHj$vC_|BQ#3b%=&gt;Yj1A&amp;;2l0E1__dAL{E7H&lt;evLyQ@3;cl&lt;~Mb=+M5WH
z+3Vm)*jgiku9-4eD){bw1Sjs7!4M@)m6vzc|8+?9@e0`ReO_H#5E55hE&lt;Xc9l+&gt;g;
zL~Auu&gt;3HakNTY*AsmMk8OGP0w&gt;0Iw=C9?u!Re=qFW#iql%rBG8fsKtOoP418ZG98Y
zSF#qe1VKS2HS4H$bzbmp+&lt;_NEkEC*IJBBC4J92Ns3&lt;{iSzijrtl47oOaj*wc##FFx
z;&lt;C2JaiMVDB&lt;VrfjO!owrd?ZHhu(_b|7b?giXvdHvsnwIK&amp;nxqr7Mqx)ZU5VdC#=q
z)=nE{kKL36drO3W7O7xJ8^0X7bXJE$cw~G)hQ@u5O=@-aLU&amp;P@6nQZ*d`3#JFt-A{
z51f@3%ZJlZkf(c3YtDD_H~ND=Z;mhj$9@Yi0O3ZMSR`QizW@LL07*qoM6N&lt;$f&gt;u`&amp;
AQ~&amp;?~</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l30.1"></a><span id="l30.1">new file mode 100755</span>
<a href="#l30.2"></a><span id="l30.2" class="difflineminus">--- /dev/null</span>
<a href="#l30.3"></a><span id="l30.3" class="difflineplus">+++ b/suite/themes/classic/communicator/history/places.css</span>
<a href="#l30.4"></a><span id="l30.4" class="difflineat">@@ -0,0 +1,42 @@</span>
<a href="#l30.5"></a><span id="l30.5" class="difflineplus">+/* Trees */</span>
<a href="#l30.6"></a><span id="l30.6" class="difflineplus">+treechildren::-moz-tree-image(title) {</span>
<a href="#l30.7"></a><span id="l30.7" class="difflineplus">+  list-style-image: url(&quot;chrome://mozapps/skin/places/defaultFavicon.png&quot;);</span>
<a href="#l30.8"></a><span id="l30.8" class="difflineplus">+  padding-right: 2px;</span>
<a href="#l30.9"></a><span id="l30.9" class="difflineplus">+  margin: 0px 2px;</span>
<a href="#l30.10"></a><span id="l30.10" class="difflineplus">+  width: 16px;</span>
<a href="#l30.11"></a><span id="l30.11" class="difflineplus">+  height: 16px;</span>
<a href="#l30.12"></a><span id="l30.12" class="difflineplus">+}</span>
<a href="#l30.13"></a><span id="l30.13" class="difflineplus">+</span>
<a href="#l30.14"></a><span id="l30.14" class="difflineplus">+treechildren::-moz-tree-image(title, separator) {</span>
<a href="#l30.15"></a><span id="l30.15" class="difflineplus">+  list-style-image: none;</span>
<a href="#l30.16"></a><span id="l30.16" class="difflineplus">+  width: 0;</span>
<a href="#l30.17"></a><span id="l30.17" class="difflineplus">+  height: 0;</span>
<a href="#l30.18"></a><span id="l30.18" class="difflineplus">+}</span>
<a href="#l30.19"></a><span id="l30.19" class="difflineplus">+</span>
<a href="#l30.20"></a><span id="l30.20" class="difflineplus">+treechildren::-moz-tree-image(title, container) {</span>
<a href="#l30.21"></a><span id="l30.21" class="difflineplus">+  list-style-image: url(&quot;chrome://communicator/skin/bookmarks/bookmark-folder-closed.png&quot;);</span>
<a href="#l30.22"></a><span id="l30.22" class="difflineplus">+}</span>
<a href="#l30.23"></a><span id="l30.23" class="difflineplus">+</span>
<a href="#l30.24"></a><span id="l30.24" class="difflineplus">+treechildren::-moz-tree-image(title, open) {</span>
<a href="#l30.25"></a><span id="l30.25" class="difflineplus">+  list-style-image: url(&quot;chrome://communicator/skin/bookmarks/bookmark-folder-open.png&quot;);</span>
<a href="#l30.26"></a><span id="l30.26" class="difflineplus">+}</span>
<a href="#l30.27"></a><span id="l30.27" class="difflineplus">+</span>
<a href="#l30.28"></a><span id="l30.28" class="difflineplus">+/* calendar icon for folders grouping items by date */</span>
<a href="#l30.29"></a><span id="l30.29" class="difflineplus">+treechildren::-moz-tree-image(title, query, dayContainer) {</span>
<a href="#l30.30"></a><span id="l30.30" class="difflineplus">+  list-style-image: url(&quot;chrome://communicator/skin/history/calendar.png&quot;);</span>
<a href="#l30.31"></a><span id="l30.31" class="difflineplus">+}</span>
<a href="#l30.32"></a><span id="l30.32" class="difflineplus">+</span>
<a href="#l30.33"></a><span id="l30.33" class="difflineplus">+treechildren::-moz-tree-row(session-start) {</span>
<a href="#l30.34"></a><span id="l30.34" class="difflineplus">+  border-top:1px dotted ThreeDShadow;</span>
<a href="#l30.35"></a><span id="l30.35" class="difflineplus">+  font-weight: bold;</span>
<a href="#l30.36"></a><span id="l30.36" class="difflineplus">+}</span>
<a href="#l30.37"></a><span id="l30.37" class="difflineplus">+</span>
<a href="#l30.38"></a><span id="l30.38" class="difflineplus">+treechildren::-moz-tree-cell-text(date, session-continue) {</span>
<a href="#l30.39"></a><span id="l30.39" class="difflineplus">+  color: -moz-Field;</span>
<a href="#l30.40"></a><span id="l30.40" class="difflineplus">+}</span>
<a href="#l30.41"></a><span id="l30.41" class="difflineplus">+</span>
<a href="#l30.42"></a><span id="l30.42" class="difflineplus">+/* Browser Sidebars */</span>
<a href="#l30.43"></a><span id="l30.43" class="difflineplus">+</span>
<a href="#l30.44"></a><span id="l30.44" class="difflineplus">+#viewButton {</span>
<a href="#l30.45"></a><span id="l30.45" class="difflineplus">+  min-width: 0px !important;</span>
<a href="#l30.46"></a><span id="l30.46" class="difflineplus">+}</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l31.1"></a><span id="l31.1" class="difflineminus">--- a/suite/themes/classic/communicator/sidebar/sidebarListView.css</span>
<a href="#l31.2"></a><span id="l31.2" class="difflineplus">+++ b/suite/themes/classic/communicator/sidebar/sidebarListView.css</span>
<a href="#l31.3"></a><span id="l31.3" class="difflineat">@@ -31,12 +31,21 @@</span>
<a href="#l31.4"></a><span id="l31.4">  * use your version of this file under the terms of the MPL, indicate your</span>
<a href="#l31.5"></a><span id="l31.5">  * decision by deleting the provisions above and replace them with the notice</span>
<a href="#l31.6"></a><span id="l31.6">  * and other provisions required by the GPL or the LGPL. If you do not delete</span>
<a href="#l31.7"></a><span id="l31.7">  * the provisions above, a recipient may use your version of this file under</span>
<a href="#l31.8"></a><span id="l31.8">  * the terms of any one of the MPL, the GPL or the LGPL.</span>
<a href="#l31.9"></a><span id="l31.9">  *</span>
<a href="#l31.10"></a><span id="l31.10">  * ***** END LICENSE BLOCK ***** */</span>
<a href="#l31.11"></a><span id="l31.11"> </span>
<a href="#l31.12"></a><span id="l31.12" class="difflineminus">-treechildren::-moz-tree-image,</span>
<a href="#l31.13"></a><span id="l31.13" class="difflineminus">-treechildren::-moz-tree-cell-text {</span>
<a href="#l31.14"></a><span id="l31.14" class="difflineminus">-  cursor: pointer;  </span>
<a href="#l31.15"></a><span id="l31.15" class="difflineplus">+treechildren::-moz-tree-image(leaf),</span>
<a href="#l31.16"></a><span id="l31.16" class="difflineplus">+treechildren::-moz-tree-cell(leaf) {</span>
<a href="#l31.17"></a><span id="l31.17" class="difflineplus">+  cursor: pointer;</span>
<a href="#l31.18"></a><span id="l31.18"> }</span>
<a href="#l31.19"></a><span id="l31.19" class="difflineplus">+</span>
<a href="#l31.20"></a><span id="l31.20" class="difflineplus">+treechildren::-moz-tree-cell-text(leaf, hover) {</span>
<a href="#l31.21"></a><span id="l31.21" class="difflineplus">+  cursor: pointer;</span>
<a href="#l31.22"></a><span id="l31.22" class="difflineplus">+  text-decoration: underline;</span>
<a href="#l31.23"></a><span id="l31.23" class="difflineplus">+}</span>
<a href="#l31.24"></a><span id="l31.24" class="difflineplus">+</span>
<a href="#l31.25"></a><span id="l31.25" class="difflineplus">+treechildren::-moz-tree-cell(separator) {</span>
<a href="#l31.26"></a><span id="l31.26" class="difflineplus">+  cursor: default;</span>
<a href="#l31.27"></a><span id="l31.27" class="difflineplus">+}</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l32.1"></a><span id="l32.1" class="difflineminus">--- a/suite/themes/classic/jar.mn</span>
<a href="#l32.2"></a><span id="l32.2" class="difflineplus">+++ b/suite/themes/classic/jar.mn</span>
<a href="#l32.3"></a><span id="l32.3" class="difflineat">@@ -35,16 +35,18 @@ classic.jar:</span>
<a href="#l32.4"></a><span id="l32.4">   skin/classic/communicator/bookmarks/location-dis.gif                  (communicator/bookmarks/location-dis.gif)</span>
<a href="#l32.5"></a><span id="l32.5">   skin/classic/communicator/bookmarks/location-hov.gif                  (communicator/bookmarks/location-hov.gif)</span>
<a href="#l32.6"></a><span id="l32.6">   skin/classic/communicator/bookmarks/location.gif                      (communicator/bookmarks/location.gif)</span>
<a href="#l32.7"></a><span id="l32.7">   skin/classic/communicator/bookmarks/bookmarksToolbar.css              (communicator/bookmarks/bookmarksToolbar.css)</span>
<a href="#l32.8"></a><span id="l32.8">   skin/classic/communicator/directory/directory.css                     (communicator/directory/directory.css)</span>
<a href="#l32.9"></a><span id="l32.9">   skin/classic/communicator/directory/folder-clsd.gif                   (communicator/directory/folder-clsd.gif)</span>
<a href="#l32.10"></a><span id="l32.10">   skin/classic/communicator/directory/folder-open.gif                   (communicator/directory/folder-open.gif)</span>
<a href="#l32.11"></a><span id="l32.11">   skin/classic/communicator/directory/file.gif                          (communicator/directory/file.gif)</span>
<a href="#l32.12"></a><span id="l32.12" class="difflineplus">+  skin/classic/communicator/history/calendar.png                        (communicator/history/calendar.png)</span>
<a href="#l32.13"></a><span id="l32.13" class="difflineplus">+  skin/classic/communicator/history/places.css                          (communicator/history/places.css)</span>
<a href="#l32.14"></a><span id="l32.14">   skin/classic/communicator/profile/migrate.gif                         (communicator/profile/migrate.gif)</span>
<a href="#l32.15"></a><span id="l32.15">   skin/classic/communicator/profile/profile.css                         (communicator/profile/profile.css)</span>
<a href="#l32.16"></a><span id="l32.16">   skin/classic/communicator/profile/profileManager.css                  (communicator/profile/profileManager.css)</span>
<a href="#l32.17"></a><span id="l32.17">   skin/classic/communicator/profile/profileicon-large.gif               (communicator/profile/profileicon-large.gif)</span>
<a href="#l32.18"></a><span id="l32.18">   skin/classic/communicator/related/related.css                         (communicator/related/related.css)</span>
<a href="#l32.19"></a><span id="l32.19">   skin/classic/communicator/related/sitemap.gif                         (communicator/related/sitemap.gif)</span>
<a href="#l32.20"></a><span id="l32.20">   skin/classic/communicator/search/category.gif                         (communicator/search/category.gif)</span>
<a href="#l32.21"></a><span id="l32.21">   skin/classic/communicator/search/result.gif                           (communicator/search/result.gif)</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l33.1"></a><span id="l33.1">new file mode 100644</span>
<a href="#l33.2"></a><span id="l33.2">index e69de29bb2d1d6434b8b29ae775ad8c2e48c5391..1855c9f507f4794b9fc392c1700ca07f963c0ece</span>
<a href="#l33.3"></a><span id="l33.3">GIT binary patch
literal 614
zc$@)d0-61ZP)&lt;h;3K|Lk000e1NJLTq000mG000mO1^@s6AM^iV0000PbVXQnQ*UN;
zcVTj606}DLVr3vnZDD6+Qe|Oed2z{QJOBU!2uVaiRCwB?Q$1)DQ4pRx4k2Q#MmP~I
z5-mK)j}Vh0212gUQc|U{v#_uc1d}2th+Ltd!KAy+CMhIEPKY^3Asz-Ih?U5(f*=xO
z?l#`OeeaF)^EM`63UOfeeY~A-=9}5s+=sb`2!|LVJF0s&lt;{XX1(`(CcVffoio!M|GL
z^(i?e0ep!8QVUZrk3e;F3!syz|LOoFMzJw4wKWXYqpL!3XKu)um#1f~9;&amp;yx2zz?V
z?g9&gt;{5ATCHj$vC_|BQ#3b%=&gt;Yj1A&amp;;2l0E1__dAL{E7H&lt;evLyQ@3;cl&lt;~Mb=+M5WH
z+3Vm)*jgiku9-4eD){bw1Sjs7!4M@)m6vzc|8+?9@e0`ReO_H#5E55hE&lt;Xc9l+&gt;g;
zL~Auu&gt;3HakNTY*AsmMk8OGP0w&gt;0Iw=C9?u!Re=qFW#iql%rBG8fsKtOoP418ZG98Y
zSF#qe1VKS2HS4H$bzbmp+&lt;_NEkEC*IJBBC4J92Ns3&lt;{iSzijrtl47oOaj*wc##FFx
z;&lt;C2JaiMVDB&lt;VrfjO!owrd?ZHhu(_b|7b?giXvdHvsnwIK&amp;nxqr7Mqx)ZU5VdC#=q
z)=nE{kKL36drO3W7O7xJ8^0X7bXJE$cw~G)hQ@u5O=@-aLU&amp;P@6nQZ*d`3#JFt-A{
z51f@3%ZJlZkf(c3YtDD_H~ND=Z;mhj$9@Yi0O3ZMSR`QizW@LL07*qoM6N&lt;$f&gt;u`&amp;
AQ~&amp;?~</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l34.1"></a><span id="l34.1">new file mode 100755</span>
<a href="#l34.2"></a><span id="l34.2" class="difflineminus">--- /dev/null</span>
<a href="#l34.3"></a><span id="l34.3" class="difflineplus">+++ b/suite/themes/modern/communicator/history/places.css</span>
<a href="#l34.4"></a><span id="l34.4" class="difflineat">@@ -0,0 +1,42 @@</span>
<a href="#l34.5"></a><span id="l34.5" class="difflineplus">+/* Trees */</span>
<a href="#l34.6"></a><span id="l34.6" class="difflineplus">+treechildren::-moz-tree-image(title) {</span>
<a href="#l34.7"></a><span id="l34.7" class="difflineplus">+  list-style-image: url(&quot;chrome://mozapps/skin/places/defaultFavicon.png&quot;);</span>
<a href="#l34.8"></a><span id="l34.8" class="difflineplus">+  padding-right: 2px;</span>
<a href="#l34.9"></a><span id="l34.9" class="difflineplus">+  margin: 0px 2px;</span>
<a href="#l34.10"></a><span id="l34.10" class="difflineplus">+  width: 16px;</span>
<a href="#l34.11"></a><span id="l34.11" class="difflineplus">+  height: 16px;</span>
<a href="#l34.12"></a><span id="l34.12" class="difflineplus">+}</span>
<a href="#l34.13"></a><span id="l34.13" class="difflineplus">+</span>
<a href="#l34.14"></a><span id="l34.14" class="difflineplus">+treechildren::-moz-tree-image(title, separator) {</span>
<a href="#l34.15"></a><span id="l34.15" class="difflineplus">+  list-style-image: none;</span>
<a href="#l34.16"></a><span id="l34.16" class="difflineplus">+  width: 0;</span>
<a href="#l34.17"></a><span id="l34.17" class="difflineplus">+  height: 0;</span>
<a href="#l34.18"></a><span id="l34.18" class="difflineplus">+}</span>
<a href="#l34.19"></a><span id="l34.19" class="difflineplus">+</span>
<a href="#l34.20"></a><span id="l34.20" class="difflineplus">+treechildren::-moz-tree-image(title, container) {</span>
<a href="#l34.21"></a><span id="l34.21" class="difflineplus">+  list-style-image: url(&quot;chrome://communicator/skin/bookmarks/bookmark-folder-closed.png&quot;);</span>
<a href="#l34.22"></a><span id="l34.22" class="difflineplus">+}</span>
<a href="#l34.23"></a><span id="l34.23" class="difflineplus">+</span>
<a href="#l34.24"></a><span id="l34.24" class="difflineplus">+treechildren::-moz-tree-image(title, open) {</span>
<a href="#l34.25"></a><span id="l34.25" class="difflineplus">+  list-style-image: url(&quot;chrome://communicator/skin/bookmarks/bookmark-folder-open.png&quot;);</span>
<a href="#l34.26"></a><span id="l34.26" class="difflineplus">+}</span>
<a href="#l34.27"></a><span id="l34.27" class="difflineplus">+</span>
<a href="#l34.28"></a><span id="l34.28" class="difflineplus">+/* calendar icon for folders grouping items by date */</span>
<a href="#l34.29"></a><span id="l34.29" class="difflineplus">+treechildren::-moz-tree-image(title, query, dayContainer) {</span>
<a href="#l34.30"></a><span id="l34.30" class="difflineplus">+  list-style-image: url(&quot;chrome://communicator/skin/history/calendar.png&quot;);</span>
<a href="#l34.31"></a><span id="l34.31" class="difflineplus">+}</span>
<a href="#l34.32"></a><span id="l34.32" class="difflineplus">+</span>
<a href="#l34.33"></a><span id="l34.33" class="difflineplus">+treechildren::-moz-tree-row(session-start) {</span>
<a href="#l34.34"></a><span id="l34.34" class="difflineplus">+  border-top:1px dotted #808080;</span>
<a href="#l34.35"></a><span id="l34.35" class="difflineplus">+  font-weight: bold;</span>
<a href="#l34.36"></a><span id="l34.36" class="difflineplus">+}</span>
<a href="#l34.37"></a><span id="l34.37" class="difflineplus">+</span>
<a href="#l34.38"></a><span id="l34.38" class="difflineplus">+treechildren::-moz-tree-cell-text(date, session-continue) {</span>
<a href="#l34.39"></a><span id="l34.39" class="difflineplus">+  color: #FFFFFF;</span>
<a href="#l34.40"></a><span id="l34.40" class="difflineplus">+}</span>
<a href="#l34.41"></a><span id="l34.41" class="difflineplus">+</span>
<a href="#l34.42"></a><span id="l34.42" class="difflineplus">+/* Browser Sidebars */</span>
<a href="#l34.43"></a><span id="l34.43" class="difflineplus">+</span>
<a href="#l34.44"></a><span id="l34.44" class="difflineplus">+#viewButton {</span>
<a href="#l34.45"></a><span id="l34.45" class="difflineplus">+  min-width: 0px !important;</span>
<a href="#l34.46"></a><span id="l34.46" class="difflineplus">+}</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l35.1"></a><span id="l35.1" class="difflineminus">--- a/suite/themes/modern/communicator/sidebar/sidebarListView.css</span>
<a href="#l35.2"></a><span id="l35.2" class="difflineplus">+++ b/suite/themes/modern/communicator/sidebar/sidebarListView.css</span>
<a href="#l35.3"></a><span id="l35.3" class="difflineat">@@ -31,11 +31,21 @@</span>
<a href="#l35.4"></a><span id="l35.4">  * use your version of this file under the terms of the MPL, indicate your</span>
<a href="#l35.5"></a><span id="l35.5">  * decision by deleting the provisions above and replace them with the notice</span>
<a href="#l35.6"></a><span id="l35.6">  * and other provisions required by the GPL or the LGPL. If you do not delete</span>
<a href="#l35.7"></a><span id="l35.7">  * the provisions above, a recipient may use your version of this file under</span>
<a href="#l35.8"></a><span id="l35.8">  * the terms of any one of the MPL, the GPL or the LGPL.</span>
<a href="#l35.9"></a><span id="l35.9">  *</span>
<a href="#l35.10"></a><span id="l35.10">  * ***** END LICENSE BLOCK ***** */</span>
<a href="#l35.11"></a><span id="l35.11"> </span>
<a href="#l35.12"></a><span id="l35.12" class="difflineminus">-treechildren {</span>
<a href="#l35.13"></a><span id="l35.13" class="difflineminus">-  cursor: pointer;  </span>
<a href="#l35.14"></a><span id="l35.14" class="difflineplus">+treechildren::-moz-tree-image(leaf),</span>
<a href="#l35.15"></a><span id="l35.15" class="difflineplus">+treechildren::-moz-tree-cell(leaf) {</span>
<a href="#l35.16"></a><span id="l35.16" class="difflineplus">+  cursor: pointer;</span>
<a href="#l35.17"></a><span id="l35.17"> }</span>
<a href="#l35.18"></a><span id="l35.18" class="difflineplus">+</span>
<a href="#l35.19"></a><span id="l35.19" class="difflineplus">+treechildren::-moz-tree-cell-text(leaf, hover) {</span>
<a href="#l35.20"></a><span id="l35.20" class="difflineplus">+  cursor: pointer;</span>
<a href="#l35.21"></a><span id="l35.21" class="difflineplus">+  text-decoration: underline;</span>
<a href="#l35.22"></a><span id="l35.22" class="difflineplus">+}</span>
<a href="#l35.23"></a><span id="l35.23" class="difflineplus">+</span>
<a href="#l35.24"></a><span id="l35.24" class="difflineplus">+treechildren::-moz-tree-cell(separator) {</span>
<a href="#l35.25"></a><span id="l35.25" class="difflineplus">+  cursor: default;</span>
<a href="#l35.26"></a><span id="l35.26" class="difflineplus">+}</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l36.1"></a><span id="l36.1" class="difflineminus">--- a/suite/themes/modern/jar.mn</span>
<a href="#l36.2"></a><span id="l36.2" class="difflineplus">+++ b/suite/themes/modern/jar.mn</span>
<a href="#l36.3"></a><span id="l36.3" class="difflineat">@@ -30,16 +30,18 @@ modern.jar:</span>
<a href="#l36.4"></a><span id="l36.4">   skin/modern/communicator/brand/throbber-anim.gif                 (communicator/brand/throbber-anim.gif)</span>
<a href="#l36.5"></a><span id="l36.5">   skin/modern/communicator/brand/throbber-single.gif               (communicator/brand/throbber-single.gif)</span>
<a href="#l36.6"></a><span id="l36.6">   skin/modern/communicator/brand/throbber16-anim.gif               (communicator/brand/throbber16-anim.gif)</span>
<a href="#l36.7"></a><span id="l36.7">   skin/modern/communicator/brand/throbber16-single.gif             (communicator/brand/throbber16-single.gif)</span>
<a href="#l36.8"></a><span id="l36.8">   skin/modern/communicator/directory/file-folder-closed.gif        (communicator/directory/file-folder-closed.gif)</span>
<a href="#l36.9"></a><span id="l36.9">   skin/modern/communicator/directory/file-folder-open.gif          (communicator/directory/file-folder-open.gif)</span>
<a href="#l36.10"></a><span id="l36.10">   skin/modern/communicator/directory/file-icon.gif                 (communicator/directory/file-icon.gif)</span>
<a href="#l36.11"></a><span id="l36.11">   skin/modern/communicator/directory/directory.css                 (communicator/directory/directory.css)</span>
<a href="#l36.12"></a><span id="l36.12" class="difflineplus">+  skin/modern/communicator/history/calendar.png                    (communicator/history/calendar.png)</span>
<a href="#l36.13"></a><span id="l36.13" class="difflineplus">+  skin/modern/communicator/history/places.css                      (communicator/history/places.css)</span>
<a href="#l36.14"></a><span id="l36.14">   skin/modern/communicator/icons/alwaysAsk.png                     (communicator/icons/alwaysAsk.png)</span>
<a href="#l36.15"></a><span id="l36.15">   skin/modern/communicator/icons/application.png                   (communicator/icons/application.png)</span>
<a href="#l36.16"></a><span id="l36.16">   skin/modern/communicator/icons/btn1.gif                          (communicator/icons/btn1.gif)</span>
<a href="#l36.17"></a><span id="l36.17">   skin/modern/communicator/icons/common.png                        (communicator/icons/common.png)</span>
<a href="#l36.18"></a><span id="l36.18">   skin/modern/communicator/icons/common-small.png                  (communicator/icons/common-small.png)</span>
<a href="#l36.19"></a><span id="l36.19">   skin/modern/communicator/icons/feedIcon16.png                    (communicator/icons/feedIcon16.png)</span>
<a href="#l36.20"></a><span id="l36.20">   skin/modern/communicator/icons/loading.gif                       (communicator/icons/loading.gif)</span>
<a href="#l36.21"></a><span id="l36.21">   skin/modern/communicator/icons/lock-broken.gif                   (communicator/icons/lock-broken.gif)</span></pre></div></div>

<div class="page_footer">
<div class="page_footer_text">comm-central</div>
<div class="page_footer_text" style="padding-left: 10px">Deployed from <a href="https://hg.mozilla.org/hgcustom/version-control-tools/rev/35f393d6769a">35f393d6769a</a> at 2020-07-16T17:23:43Z.</div>
<div class="rss_logo">
<a href="/comm-central/rss-log">RSS</a>
<a href="/comm-central/atom-log">Atom</a>
</div>
<br />

</div>
</body>
</html>

