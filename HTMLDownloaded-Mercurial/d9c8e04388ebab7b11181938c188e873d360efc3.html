<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en-US" lang="en-US">
<head>
<link rel="icon" href="/static/4b0de666d1a4/hgicon.png" type="image/png" />
<meta name="robots" content="index, nofollow"/>
<link rel="stylesheet" href="/static/4b0de666d1a4/style-gitweb.css" type="text/css" />

<style type="text/css">
div.feed {
  float: right;
}
a img {
  border-width: 0px;
}
div.log_link {
  width: 80px;
  background-color: white;
}

div.log_body {
  padding-left: 96px;
}
</style>
<script type="text/javascript" src="/static/4b0de666d1a4/mercurial.js"></script>

<meta property="og:image" content="/static/4b0de666d1a4/moz-logo-bw-rgb.svg"/>
<meta property="og:type" content="website"/>

<title>comm-central: changeset 29150:d9c8e04388ebab7b11181938c188e873d360efc3</title>
<link rel="alternate" type="application/atom+xml"
   href="/comm-central/atom-log" title="Atom feed for comm-central"/>
<link rel="alternate" type="application/rss+xml"
   href="/comm-central/rss-log" title="RSS feed for comm-central"/>

<meta property="og:title" content="comm-central @ d9c8e04388ebab7b11181938c188e873d360efc3" />
<meta property="og:url" content="/comm-central/rev/d9c8e04388ebab7b11181938c188e873d360efc3" />
<meta property="og:description" content="Bug 1626161 - Minimize to tray on Windows. r=mkmelin" />

</head>
<body>

<div class="page_header">
<div class="logo">
    <a href="https://developer.mozilla.org/en/docs/Mercurial">
        <img src="/static/4b0de666d1a4/moz-logo-bw-rgb.svg" alt="mercurial" />
    </a>
</div>
<a href="/">Mercurial</a> &gt; <a href="/comm-central">comm-central</a>  / changeset / d9c8e04388ebab7b11181938c188e873d360efc3 
</div>

<div class="page_nav">
<div>
<a href="/comm-central/summary">summary</a> |
<a href="/comm-central/shortlog/d9c8e04388ebab7b11181938c188e873d360efc3">shortlog</a> |
<a href="/comm-central/log/d9c8e04388ebab7b11181938c188e873d360efc3">changelog</a> |
<a href="/comm-central/pushloghtml">pushlog</a> |
<a href="/comm-central/graph/d9c8e04388ebab7b11181938c188e873d360efc3">graph</a> |
<a href="/comm-central/tags">tags</a> |
<a href="/comm-central/bookmarks">bookmarks</a> |
<a href="/comm-central/branches">branches</a> |
<a href="/comm-central/file/d9c8e04388ebab7b11181938c188e873d360efc3">files</a> |
changeset |
<a href="/comm-central/raw-rev/d9c8e04388ebab7b11181938c188e873d360efc3">raw</a>  | <a href="/comm-central/archive/d9c8e04388ebab7b11181938c188e873d360efc3.zip">zip</a>  |
<a href="/comm-central/help">help</a>
</div>

<div class="search">
<form id="searchform" action="/comm-central/log">

<input name="rev" type="text" value="" size="40" />
<div id="hint">Find changesets by keywords (author, files, the commit message), revision
number or hash, or <a href="/comm-central/help/revsets">revset expression</a>.</div>
</form>
</div>
</div>

<div class="title">
<a href="https://bugzilla.mozilla.org/show_bug.cgi?id=1626161">Bug 1626161</a> - Minimize to tray on Windows. r=mkmelin
<span class="logtags"></span>
</div>
<div class="title_text">
<table cellspacing="0">

<tr><td>author</td><td>&#71;&#101;&#111;&#102;&#102;&#32;&#76;&#97;&#110;&#107;&#111;&#119;&#32;&#60;&#103;&#101;&#111;&#102;&#102;&#64;&#100;&#97;&#114;&#107;&#116;&#114;&#111;&#106;&#97;&#110;&#46;&#110;&#101;&#116;&#62;</td></tr>
<tr><td></td><td class="date age">Tue, 10 Mar 2020 21:49:26 +1300</td></tr>

<tr>
 <td>changeset 29150</td>
 <td style="font-family:monospace"><a class="list" href="/comm-central/rev/d9c8e04388ebab7b11181938c188e873d360efc3">d9c8e04388ebab7b11181938c188e873d360efc3</a></td>
</tr>



<tr>
<td>parent 29149</td>
<td style="font-family:monospace">
<a class="list" href="/comm-central/rev/03cfd777e6359f5628d750985da7c4c5d5c45935">03cfd777e6359f5628d750985da7c4c5d5c45935</a>
</td>
</tr>

<tr>
<td>child 29151</td>
<td style="font-family:monospace">
<a class="list" href="/comm-central/rev/817be4121219fd8a0d3a746d0d7e46810474baca">817be4121219fd8a0d3a746d0d7e46810474baca</a>
</td>
</tr>
<tr><td>push id</td><td><a href="/comm-central/pushloghtml?changeset=d9c8e04388ebab7b11181938c188e873d360efc3">17225</a></td></tr>
<tr><td>push user</td><td>geoff@darktrojan.net</td></tr>
<tr><td>push date</td><td class="date age">Wed, 01 Apr 2020 07:17:53 +0000</td></tr>

<tr><td>treeherder</td><td>comm-central@d9c8e04388eb [<a href="https://treeherder.mozilla.org/#/jobs?repo=comm-central&revision=d9c8e04388ebab7b11181938c188e873d360efc3">default view</a>] [<a href="https://treeherder.mozilla.org/#/jobs?repo=comm-central&revision=d9c8e04388ebab7b11181938c188e873d360efc3&filter-resultStatus=testfailed&filter-resultStatus=busted&filter-resultStatus=exception">failures only]</td></tr>
<tr><td>perfherder</td><td>[<a href="https://treeherder.mozilla.org/perf.html#/compare?originalProject=comm-central&originalRevision=d9c8e04388ebab7b11181938c188e873d360efc3&newProject=comm-central&newRevision=03cfd777e6359f5628d750985da7c4c5d5c45935&framework=1" target="_blank">talos</a>] [<a href="https://treeherder.mozilla.org/perf.html#/compare?originalProject=comm-central&originalRevision=d9c8e04388ebab7b11181938c188e873d360efc3&newProject=comm-central&newRevision=03cfd777e6359f5628d750985da7c4c5d5c45935&framework=2" target="_blank">build metrics</a>] [<a href="https://treeherder.mozilla.org/perf.html#/compare?originalProject=comm-central&originalRevision=d9c8e04388ebab7b11181938c188e873d360efc3&newProject=comm-central&newRevision=03cfd777e6359f5628d750985da7c4c5d5c45935&framework=6" target="_blank">platform microbench</a>] (compared to previous push)</td></tr>
<tr><td>reviewers</td><td><a href="/comm-central/log?rev=reviewer%28mkmelin%29&revcount=50">mkmelin</a></td></tr>
<tr><td>bugs</td><td><a href="https://bugzilla.mozilla.org/show_bug.cgi?id=1626161">1626161</a></td></tr>




</table></div>

<div class="page_body description"><a href="https://bugzilla.mozilla.org/show_bug.cgi?id=1626161">Bug 1626161</a> - Minimize to tray on Windows. r=mkmelin</div>
<div class="list_head"></div>
<div class="title_text">
<table cellspacing="0">

<tr class="parity0">
<td><a class="list" href="/comm-central/diff/d9c8e04388ebab7b11181938c188e873d360efc3/mail/app/profile/all-thunderbird.js">mail/app/profile/all-thunderbird.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/d9c8e04388ebab7b11181938c188e873d360efc3/mail/app/profile/all-thunderbird.js">file</a> |
<a href="/comm-central/annotate/d9c8e04388ebab7b11181938c188e873d360efc3/mail/app/profile/all-thunderbird.js">annotate</a> |
<a href="/comm-central/diff/d9c8e04388ebab7b11181938c188e873d360efc3/mail/app/profile/all-thunderbird.js">diff</a> |
<a href="/comm-central/comparison/d9c8e04388ebab7b11181938c188e873d360efc3/mail/app/profile/all-thunderbird.js">comparison</a> |
<a href="/comm-central/log/d9c8e04388ebab7b11181938c188e873d360efc3/mail/app/profile/all-thunderbird.js">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/d9c8e04388ebab7b11181938c188e873d360efc3/mail/base/content/messenger.xhtml">mail/base/content/messenger.xhtml</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/d9c8e04388ebab7b11181938c188e873d360efc3/mail/base/content/messenger.xhtml">file</a> |
<a href="/comm-central/annotate/d9c8e04388ebab7b11181938c188e873d360efc3/mail/base/content/messenger.xhtml">annotate</a> |
<a href="/comm-central/diff/d9c8e04388ebab7b11181938c188e873d360efc3/mail/base/content/messenger.xhtml">diff</a> |
<a href="/comm-central/comparison/d9c8e04388ebab7b11181938c188e873d360efc3/mail/base/content/messenger.xhtml">comparison</a> |
<a href="/comm-central/log/d9c8e04388ebab7b11181938c188e873d360efc3/mail/base/content/messenger.xhtml">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/d9c8e04388ebab7b11181938c188e873d360efc3/mail/base/content/minimizeToTray.js">mail/base/content/minimizeToTray.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/d9c8e04388ebab7b11181938c188e873d360efc3/mail/base/content/minimizeToTray.js">file</a> |
<a href="/comm-central/annotate/d9c8e04388ebab7b11181938c188e873d360efc3/mail/base/content/minimizeToTray.js">annotate</a> |
<a href="/comm-central/diff/d9c8e04388ebab7b11181938c188e873d360efc3/mail/base/content/minimizeToTray.js">diff</a> |
<a href="/comm-central/comparison/d9c8e04388ebab7b11181938c188e873d360efc3/mail/base/content/minimizeToTray.js">comparison</a> |
<a href="/comm-central/log/d9c8e04388ebab7b11181938c188e873d360efc3/mail/base/content/minimizeToTray.js">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/d9c8e04388ebab7b11181938c188e873d360efc3/mail/base/jar.mn">mail/base/jar.mn</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/d9c8e04388ebab7b11181938c188e873d360efc3/mail/base/jar.mn">file</a> |
<a href="/comm-central/annotate/d9c8e04388ebab7b11181938c188e873d360efc3/mail/base/jar.mn">annotate</a> |
<a href="/comm-central/diff/d9c8e04388ebab7b11181938c188e873d360efc3/mail/base/jar.mn">diff</a> |
<a href="/comm-central/comparison/d9c8e04388ebab7b11181938c188e873d360efc3/mail/base/jar.mn">comparison</a> |
<a href="/comm-central/log/d9c8e04388ebab7b11181938c188e873d360efc3/mail/base/jar.mn">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/d9c8e04388ebab7b11181938c188e873d360efc3/mail/components/preferences/general.inc.xhtml">mail/components/preferences/general.inc.xhtml</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/d9c8e04388ebab7b11181938c188e873d360efc3/mail/components/preferences/general.inc.xhtml">file</a> |
<a href="/comm-central/annotate/d9c8e04388ebab7b11181938c188e873d360efc3/mail/components/preferences/general.inc.xhtml">annotate</a> |
<a href="/comm-central/diff/d9c8e04388ebab7b11181938c188e873d360efc3/mail/components/preferences/general.inc.xhtml">diff</a> |
<a href="/comm-central/comparison/d9c8e04388ebab7b11181938c188e873d360efc3/mail/components/preferences/general.inc.xhtml">comparison</a> |
<a href="/comm-central/log/d9c8e04388ebab7b11181938c188e873d360efc3/mail/components/preferences/general.inc.xhtml">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/d9c8e04388ebab7b11181938c188e873d360efc3/mail/components/preferences/general.js">mail/components/preferences/general.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/d9c8e04388ebab7b11181938c188e873d360efc3/mail/components/preferences/general.js">file</a> |
<a href="/comm-central/annotate/d9c8e04388ebab7b11181938c188e873d360efc3/mail/components/preferences/general.js">annotate</a> |
<a href="/comm-central/diff/d9c8e04388ebab7b11181938c188e873d360efc3/mail/components/preferences/general.js">diff</a> |
<a href="/comm-central/comparison/d9c8e04388ebab7b11181938c188e873d360efc3/mail/components/preferences/general.js">comparison</a> |
<a href="/comm-central/log/d9c8e04388ebab7b11181938c188e873d360efc3/mail/components/preferences/general.js">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/d9c8e04388ebab7b11181938c188e873d360efc3/mail/locales/en-US/chrome/messenger/preferences/general.dtd">mail/locales/en-US/chrome/messenger/preferences/general.dtd</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/d9c8e04388ebab7b11181938c188e873d360efc3/mail/locales/en-US/chrome/messenger/preferences/general.dtd">file</a> |
<a href="/comm-central/annotate/d9c8e04388ebab7b11181938c188e873d360efc3/mail/locales/en-US/chrome/messenger/preferences/general.dtd">annotate</a> |
<a href="/comm-central/diff/d9c8e04388ebab7b11181938c188e873d360efc3/mail/locales/en-US/chrome/messenger/preferences/general.dtd">diff</a> |
<a href="/comm-central/comparison/d9c8e04388ebab7b11181938c188e873d360efc3/mail/locales/en-US/chrome/messenger/preferences/general.dtd">comparison</a> |
<a href="/comm-central/log/d9c8e04388ebab7b11181938c188e873d360efc3/mail/locales/en-US/chrome/messenger/preferences/general.dtd">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/d9c8e04388ebab7b11181938c188e873d360efc3/mailnews/base/public/moz.build">mailnews/base/public/moz.build</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/d9c8e04388ebab7b11181938c188e873d360efc3/mailnews/base/public/moz.build">file</a> |
<a href="/comm-central/annotate/d9c8e04388ebab7b11181938c188e873d360efc3/mailnews/base/public/moz.build">annotate</a> |
<a href="/comm-central/diff/d9c8e04388ebab7b11181938c188e873d360efc3/mailnews/base/public/moz.build">diff</a> |
<a href="/comm-central/comparison/d9c8e04388ebab7b11181938c188e873d360efc3/mailnews/base/public/moz.build">comparison</a> |
<a href="/comm-central/log/d9c8e04388ebab7b11181938c188e873d360efc3/mailnews/base/public/moz.build">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/d9c8e04388ebab7b11181938c188e873d360efc3/mailnews/base/public/nsIMessengerWindowsIntegration.idl">mailnews/base/public/nsIMessengerWindowsIntegration.idl</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/d9c8e04388ebab7b11181938c188e873d360efc3/mailnews/base/public/nsIMessengerWindowsIntegration.idl">file</a> |
<a href="/comm-central/annotate/d9c8e04388ebab7b11181938c188e873d360efc3/mailnews/base/public/nsIMessengerWindowsIntegration.idl">annotate</a> |
<a href="/comm-central/diff/d9c8e04388ebab7b11181938c188e873d360efc3/mailnews/base/public/nsIMessengerWindowsIntegration.idl">diff</a> |
<a href="/comm-central/comparison/d9c8e04388ebab7b11181938c188e873d360efc3/mailnews/base/public/nsIMessengerWindowsIntegration.idl">comparison</a> |
<a href="/comm-central/log/d9c8e04388ebab7b11181938c188e873d360efc3/mailnews/base/public/nsIMessengerWindowsIntegration.idl">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/d9c8e04388ebab7b11181938c188e873d360efc3/mailnews/base/src/nsMessengerWinIntegration.cpp">mailnews/base/src/nsMessengerWinIntegration.cpp</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/d9c8e04388ebab7b11181938c188e873d360efc3/mailnews/base/src/nsMessengerWinIntegration.cpp">file</a> |
<a href="/comm-central/annotate/d9c8e04388ebab7b11181938c188e873d360efc3/mailnews/base/src/nsMessengerWinIntegration.cpp">annotate</a> |
<a href="/comm-central/diff/d9c8e04388ebab7b11181938c188e873d360efc3/mailnews/base/src/nsMessengerWinIntegration.cpp">diff</a> |
<a href="/comm-central/comparison/d9c8e04388ebab7b11181938c188e873d360efc3/mailnews/base/src/nsMessengerWinIntegration.cpp">comparison</a> |
<a href="/comm-central/log/d9c8e04388ebab7b11181938c188e873d360efc3/mailnews/base/src/nsMessengerWinIntegration.cpp">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/d9c8e04388ebab7b11181938c188e873d360efc3/mailnews/base/src/nsMessengerWinIntegration.h">mailnews/base/src/nsMessengerWinIntegration.h</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/d9c8e04388ebab7b11181938c188e873d360efc3/mailnews/base/src/nsMessengerWinIntegration.h">file</a> |
<a href="/comm-central/annotate/d9c8e04388ebab7b11181938c188e873d360efc3/mailnews/base/src/nsMessengerWinIntegration.h">annotate</a> |
<a href="/comm-central/diff/d9c8e04388ebab7b11181938c188e873d360efc3/mailnews/base/src/nsMessengerWinIntegration.h">diff</a> |
<a href="/comm-central/comparison/d9c8e04388ebab7b11181938c188e873d360efc3/mailnews/base/src/nsMessengerWinIntegration.h">comparison</a> |
<a href="/comm-central/log/d9c8e04388ebab7b11181938c188e873d360efc3/mailnews/base/src/nsMessengerWinIntegration.h">revisions</a>
</td>
</tr>
</table></div>

<div class="page_body diffblocks"><div class="diffblock"><pre class="sourcelines">
<a href="#l1.1"></a><span id="l1.1" class="difflineminus">--- a/mail/app/profile/all-thunderbird.js</span>
<a href="#l1.2"></a><span id="l1.2" class="difflineplus">+++ b/mail/app/profile/all-thunderbird.js</span>
<a href="#l1.3"></a><span id="l1.3" class="difflineat">@@ -1259,8 +1259,11 @@ pref(&quot;toolkit.telemetry.bhrPing.enabled&quot;</span>
<a href="#l1.4"></a><span id="l1.4"> </span>
<a href="#l1.5"></a><span id="l1.5"> // Required to enable telemetry pings (defaults to true if</span>
<a href="#l1.6"></a><span id="l1.6"> // MOZ_SERVICES_HEALTHREPORT is defined, but we're not yet sure we want</span>
<a href="#l1.7"></a><span id="l1.7"> // that...)</span>
<a href="#l1.8"></a><span id="l1.8"> pref(&quot;datareporting.healthreport.uploadEnabled&quot;, true);</span>
<a href="#l1.9"></a><span id="l1.9"> </span>
<a href="#l1.10"></a><span id="l1.10"> pref(&quot;toolkit.telemetry.infoURL&quot;, &quot;https://www.mozilla.org/thunderbird/legal/privacy/#telemetry&quot;);</span>
<a href="#l1.11"></a><span id="l1.11"> </span>
<a href="#l1.12"></a><span id="l1.12" class="difflineplus">+#ifdef XP_WIN</span>
<a href="#l1.13"></a><span id="l1.13" class="difflineplus">+pref(&quot;mail.minimizeToTray&quot;, false);</span>
<a href="#l1.14"></a><span id="l1.14" class="difflineplus">+#endif</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l2.1"></a><span id="l2.1" class="difflineminus">--- a/mail/base/content/messenger.xhtml</span>
<a href="#l2.2"></a><span id="l2.2" class="difflineplus">+++ b/mail/base/content/messenger.xhtml</span>
<a href="#l2.3"></a><span id="l2.3" class="difflineat">@@ -206,16 +206,19 @@</span>
<a href="#l2.4"></a><span id="l2.4"> &lt;script src=&quot;chrome://messenger/content/messenger-customization.js&quot;/&gt;</span>
<a href="#l2.5"></a><span id="l2.5"> &lt;script src=&quot;chrome://messenger/content/customizable-toolbar.js&quot;/&gt;</span>
<a href="#l2.6"></a><span id="l2.6"> &lt;!-- panelUI.js is for the appmenus. --&gt;</span>
<a href="#l2.7"></a><span id="l2.7"> &lt;script src=&quot;chrome://messenger/content/customizableui/panelUI.js&quot;/&gt;</span>
<a href="#l2.8"></a><span id="l2.8"> #ifdef XP_MACOSX</span>
<a href="#l2.9"></a><span id="l2.9"> &lt;script src=&quot;chrome://messenger/content/macMessengerMenu.js&quot;/&gt;</span>
<a href="#l2.10"></a><span id="l2.10"> &lt;script src=&quot;chrome://global/content/macWindowMenu.js&quot;/&gt;</span>
<a href="#l2.11"></a><span id="l2.11"> #endif</span>
<a href="#l2.12"></a><span id="l2.12" class="difflineplus">+#ifdef XP_WIN</span>
<a href="#l2.13"></a><span id="l2.13" class="difflineplus">+&lt;script src=&quot;chrome://messenger/content/minimizeToTray.js&quot;&gt;&lt;/script&gt;</span>
<a href="#l2.14"></a><span id="l2.14" class="difflineplus">+#endif</span>
<a href="#l2.15"></a><span id="l2.15"> </span>
<a href="#l2.16"></a><span id="l2.16"> &lt;!-- move needed functions into a single js file --&gt;</span>
<a href="#l2.17"></a><span id="l2.17"> &lt;script src=&quot;chrome://messenger/content/threadPane.js&quot;/&gt;</span>
<a href="#l2.18"></a><span id="l2.18"> </span>
<a href="#l2.19"></a><span id="l2.19"> &lt;!-- calendar imip bar --&gt;</span>
<a href="#l2.20"></a><span id="l2.20"> &lt;script src=&quot;chrome://lightning/content/lightning-utils.js&quot;/&gt;</span>
<a href="#l2.21"></a><span id="l2.21"> &lt;script src=&quot;chrome://lightning/content/imip-bar.js&quot;/&gt;</span>
<a href="#l2.22"></a><span id="l2.22"> &lt;!-- calendar-management.js also needed for multiple calendar support and today pane --&gt;</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l3.1"></a><span id="l3.1">new file mode 100644</span>
<a href="#l3.2"></a><span id="l3.2" class="difflineminus">--- /dev/null</span>
<a href="#l3.3"></a><span id="l3.3" class="difflineplus">+++ b/mail/base/content/minimizeToTray.js</span>
<a href="#l3.4"></a><span id="l3.4" class="difflineat">@@ -0,0 +1,19 @@</span>
<a href="#l3.5"></a><span id="l3.5" class="difflineplus">+/* This Source Code Form is subject to the terms of the Mozilla Public</span>
<a href="#l3.6"></a><span id="l3.6" class="difflineplus">+ * License, v. 2.0. If a copy of the MPL was not distributed with this</span>
<a href="#l3.7"></a><span id="l3.7" class="difflineplus">+ * file, you can obtain one at http://mozilla.org/MPL/2.0/. */</span>
<a href="#l3.8"></a><span id="l3.8" class="difflineplus">+</span>
<a href="#l3.9"></a><span id="l3.9" class="difflineplus">+/* globals docShell, Services, windowState */</span>
<a href="#l3.10"></a><span id="l3.10" class="difflineplus">+</span>
<a href="#l3.11"></a><span id="l3.11" class="difflineplus">+addEventListener(&quot;sizemodechange&quot;, () =&gt; {</span>
<a href="#l3.12"></a><span id="l3.12" class="difflineplus">+  if (</span>
<a href="#l3.13"></a><span id="l3.13" class="difflineplus">+    windowState == window.STATE_MINIMIZED &amp;&amp;</span>
<a href="#l3.14"></a><span id="l3.14" class="difflineplus">+    Services.prefs.getBoolPref(&quot;mail.minimizeToTray&quot;, false)</span>
<a href="#l3.15"></a><span id="l3.15" class="difflineplus">+  ) {</span>
<a href="#l3.16"></a><span id="l3.16" class="difflineplus">+    setTimeout(() =&gt; {</span>
<a href="#l3.17"></a><span id="l3.17" class="difflineplus">+      var bw = docShell.treeOwner.QueryInterface(Ci.nsIBaseWindow);</span>
<a href="#l3.18"></a><span id="l3.18" class="difflineplus">+      Cc[&quot;@mozilla.org/messenger/osintegration;1&quot;]</span>
<a href="#l3.19"></a><span id="l3.19" class="difflineplus">+        .getService(Ci.nsIMessengerWindowsIntegration)</span>
<a href="#l3.20"></a><span id="l3.20" class="difflineplus">+        .HideWindow(bw);</span>
<a href="#l3.21"></a><span id="l3.21" class="difflineplus">+    });</span>
<a href="#l3.22"></a><span id="l3.22" class="difflineplus">+  }</span>
<a href="#l3.23"></a><span id="l3.23" class="difflineplus">+});</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l4.1"></a><span id="l4.1" class="difflineminus">--- a/mail/base/jar.mn</span>
<a href="#l4.2"></a><span id="l4.2" class="difflineplus">+++ b/mail/base/jar.mn</span>
<a href="#l4.3"></a><span id="l4.3" class="difflineat">@@ -79,16 +79,19 @@ messenger.jar:</span>
<a href="#l4.4"></a><span id="l4.4">     content/messenger/composerOverlay.css           (content/composerOverlay.css)</span>
<a href="#l4.5"></a><span id="l4.5">     content/messenger/threadPane.js                 (content/threadPane.js)</span>
<a href="#l4.6"></a><span id="l4.6">     content/messenger/protovis-r2.6-modded.js       (content/protovis-r2.6-modded.js)</span>
<a href="#l4.7"></a><span id="l4.7">     content/messenger/newInstall.xhtml              (content/newInstall.xhtml)</span>
<a href="#l4.8"></a><span id="l4.8">     content/messenger/newInstall.js                 (content/newInstall.js)</span>
<a href="#l4.9"></a><span id="l4.9"> #ifdef XP_MACOSX</span>
<a href="#l4.10"></a><span id="l4.10">     content/messenger/macMessengerMenu.js           (content/macMessengerMenu.js)</span>
<a href="#l4.11"></a><span id="l4.11"> #endif</span>
<a href="#l4.12"></a><span id="l4.12" class="difflineplus">+#ifdef XP_WIN</span>
<a href="#l4.13"></a><span id="l4.13" class="difflineplus">+    content/messenger/minimizeToTray.js             (content/minimizeToTray.js)</span>
<a href="#l4.14"></a><span id="l4.14" class="difflineplus">+#endif</span>
<a href="#l4.15"></a><span id="l4.15">     content/messenger/selectionsummaries.js         (content/selectionsummaries.js)</span>
<a href="#l4.16"></a><span id="l4.16">     content/messenger/multimessageview.css          (content/multimessageview.css)</span>
<a href="#l4.17"></a><span id="l4.17">     content/messenger/multimessageview_print.css    (content/multimessageview_print.css)</span>
<a href="#l4.18"></a><span id="l4.18">     content/messenger/sharedsummary.css             (content/sharedsummary.css)</span>
<a href="#l4.19"></a><span id="l4.19">     content/messenger/multimessageview.xhtml        (content/multimessageview.xhtml)</span>
<a href="#l4.20"></a><span id="l4.20">     content/messenger/multimessageview.js           (content/multimessageview.js)</span>
<a href="#l4.21"></a><span id="l4.21">     content/messenger/glodaFacetTab.js              (content/glodaFacetTab.js)</span>
<a href="#l4.22"></a><span id="l4.22">     content/messenger/glodaFacetViewWrapper.xhtml   (content/glodaFacetViewWrapper.xhtml)</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l5.1"></a><span id="l5.1" class="difflineminus">--- a/mail/components/preferences/general.inc.xhtml</span>
<a href="#l5.2"></a><span id="l5.2" class="difflineplus">+++ b/mail/components/preferences/general.inc.xhtml</span>
<a href="#l5.3"></a><span id="l5.3" class="difflineat">@@ -83,16 +83,23 @@</span>
<a href="#l5.4"></a><span id="l5.4">                   label=&quot;&amp;alwaysCheckDefault.label;&quot;</span>
<a href="#l5.5"></a><span id="l5.5">                   accesskey=&quot;&amp;alwaysCheckDefault.accesskey;&quot;/&gt;</span>
<a href="#l5.6"></a><span id="l5.6">         &lt;spacer flex=&quot;1&quot;/&gt;</span>
<a href="#l5.7"></a><span id="l5.7">         &lt;button id=&quot;checkDefaultButton&quot; label=&quot;&amp;checkDefaultsNow.label;&quot;</span>
<a href="#l5.8"></a><span id="l5.8">                 accesskey=&quot;&amp;checkDefaultsNow.accesskey;&quot;</span>
<a href="#l5.9"></a><span id="l5.9">                 oncommand=&quot;gGeneralPane.checkDefaultNow();&quot;</span>
<a href="#l5.10"></a><span id="l5.10">                 preference=&quot;pref.general.disable_button.default_mail&quot;/&gt;</span>
<a href="#l5.11"></a><span id="l5.11">       &lt;/hbox&gt;</span>
<a href="#l5.12"></a><span id="l5.12" class="difflineplus">+#ifdef XP_WIN</span>
<a href="#l5.13"></a><span id="l5.13" class="difflineplus">+      &lt;hbox align=&quot;start&quot;&gt;</span>
<a href="#l5.14"></a><span id="l5.14" class="difflineplus">+        &lt;checkbox label=&quot;&amp;minimizeToTray.label;&quot;</span>
<a href="#l5.15"></a><span id="l5.15" class="difflineplus">+                  accesskey=&quot;&amp;minimizeToTray.accesskey;&quot;</span>
<a href="#l5.16"></a><span id="l5.16" class="difflineplus">+                  preference=&quot;mail.minimizeToTray&quot;/&gt;</span>
<a href="#l5.17"></a><span id="l5.17" class="difflineplus">+      &lt;/hbox&gt;</span>
<a href="#l5.18"></a><span id="l5.18" class="difflineplus">+#endif</span>
<a href="#l5.19"></a><span id="l5.19">       &lt;hbox id=&quot;searchIntegrationContainer&quot;&gt;</span>
<a href="#l5.20"></a><span id="l5.20">         &lt;checkbox id=&quot;searchIntegration&quot;</span>
<a href="#l5.21"></a><span id="l5.21">                   preference=&quot;searchintegration.enable&quot;</span>
<a href="#l5.22"></a><span id="l5.22">                   label=&quot;&amp;searchIntegration.label;&quot;</span>
<a href="#l5.23"></a><span id="l5.23">                   accesskey=&quot;&amp;searchIntegration.accesskey;&quot;/&gt;</span>
<a href="#l5.24"></a><span id="l5.24">       &lt;/hbox&gt;</span>
<a href="#l5.25"></a><span id="l5.25">       &lt;/vbox&gt;</span>
<a href="#l5.26"></a><span id="l5.26">     &lt;/html:fieldset&gt;</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l6.1"></a><span id="l6.1" class="difflineminus">--- a/mail/components/preferences/general.js</span>
<a href="#l6.2"></a><span id="l6.2" class="difflineplus">+++ b/mail/components/preferences/general.js</span>
<a href="#l6.3"></a><span id="l6.3" class="difflineat">@@ -86,16 +86,19 @@ Preferences.addAll([</span>
<a href="#l6.4"></a><span id="l6.4">   { id: &quot;mail.close_message_window.on_delete&quot;, type: &quot;bool&quot; },</span>
<a href="#l6.5"></a><span id="l6.5">   { id: &quot;mail.prompt_purge_threshhold&quot;, type: &quot;bool&quot; },</span>
<a href="#l6.6"></a><span id="l6.6">   { id: &quot;mail.purge_threshhold_mb&quot;, type: &quot;int&quot; },</span>
<a href="#l6.7"></a><span id="l6.7">   { id: &quot;browser.cache.disk.capacity&quot;, type: &quot;int&quot; },</span>
<a href="#l6.8"></a><span id="l6.8">   { id: &quot;browser.cache.disk.smart_size.enabled&quot;, inverted: true, type: &quot;bool&quot; },</span>
<a href="#l6.9"></a><span id="l6.9">   { id: &quot;layers.acceleration.disabled&quot;, type: &quot;bool&quot;, inverted: true },</span>
<a href="#l6.10"></a><span id="l6.10">   { id: &quot;searchintegration.enable&quot;, type: &quot;bool&quot; },</span>
<a href="#l6.11"></a><span id="l6.11"> ]);</span>
<a href="#l6.12"></a><span id="l6.12" class="difflineplus">+if (AppConstants.platform == &quot;win&quot;) {</span>
<a href="#l6.13"></a><span id="l6.13" class="difflineplus">+  Preferences.add({ id: &quot;mail.minimizeToTray&quot;, type: &quot;bool&quot; });</span>
<a href="#l6.14"></a><span id="l6.14" class="difflineplus">+}</span>
<a href="#l6.15"></a><span id="l6.15"> if (AppConstants.platform != &quot;macosx&quot;) {</span>
<a href="#l6.16"></a><span id="l6.16">   Preferences.add({ id: &quot;mail.biff.show_alert&quot;, type: &quot;bool&quot; });</span>
<a href="#l6.17"></a><span id="l6.17"> }</span>
<a href="#l6.18"></a><span id="l6.18"> </span>
<a href="#l6.19"></a><span id="l6.19"> var ICON_URL_APP = &quot;&quot;;</span>
<a href="#l6.20"></a><span id="l6.20"> </span>
<a href="#l6.21"></a><span id="l6.21"> if (AppConstants.MOZ_WIDGET_GTK) {</span>
<a href="#l6.22"></a><span id="l6.22">   ICON_URL_APP = &quot;moz-icon://dummy.exe?size=16&quot;;</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l7.1"></a><span id="l7.1" class="difflineminus">--- a/mail/locales/en-US/chrome/messenger/preferences/general.dtd</span>
<a href="#l7.2"></a><span id="l7.2" class="difflineplus">+++ b/mail/locales/en-US/chrome/messenger/preferences/general.dtd</span>
<a href="#l7.3"></a><span id="l7.3" class="difflineat">@@ -37,8 +37,11 @@</span>
<a href="#l7.4"></a><span id="l7.4"> &lt;!ENTITY browse.label                     &quot;Browse…&quot;&gt;</span>
<a href="#l7.5"></a><span id="l7.5"> &lt;!ENTITY browse.accesskey                 &quot;B&quot;&gt;</span>
<a href="#l7.6"></a><span id="l7.6"> </span>
<a href="#l7.7"></a><span id="l7.7"> &lt;!ENTITY defaultSearchEngine.label        &quot;Default Search Engine&quot;&gt;</span>
<a href="#l7.8"></a><span id="l7.8"> &lt;!ENTITY addSearchEngine.label            &quot;Add from file&quot;&gt;</span>
<a href="#l7.9"></a><span id="l7.9"> &lt;!ENTITY addSearchEngine.accesskey        &quot;A&quot;&gt;</span>
<a href="#l7.10"></a><span id="l7.10"> &lt;!ENTITY removeSearchEngine.label         &quot;Remove&quot;&gt;</span>
<a href="#l7.11"></a><span id="l7.11"> &lt;!ENTITY removeSearchEngine.accesskey     &quot;v&quot;&gt;</span>
<a href="#l7.12"></a><span id="l7.12" class="difflineplus">+</span>
<a href="#l7.13"></a><span id="l7.13" class="difflineplus">+&lt;!ENTITY minimizeToTray.label             &quot;When &amp;brandShortName; is minimized, move it to the tray&quot;&gt;</span>
<a href="#l7.14"></a><span id="l7.14" class="difflineplus">+&lt;!ENTITY minimizeToTray.accesskey         &quot;m&quot;&gt;</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l8.1"></a><span id="l8.1" class="difflineminus">--- a/mailnews/base/public/moz.build</span>
<a href="#l8.2"></a><span id="l8.2" class="difflineplus">+++ b/mailnews/base/public/moz.build</span>
<a href="#l8.3"></a><span id="l8.3" class="difflineat">@@ -58,16 +58,21 @@ XPIDL_SOURCES += [</span>
<a href="#l8.4"></a><span id="l8.4">     'nsIStatusBarBiffManager.idl',</span>
<a href="#l8.5"></a><span id="l8.5">     'nsIStopwatch.idl',</span>
<a href="#l8.6"></a><span id="l8.6">     'nsISubscribableServer.idl',</span>
<a href="#l8.7"></a><span id="l8.7">     'nsIUrlListener.idl',</span>
<a href="#l8.8"></a><span id="l8.8">     'nsMsgFolderFlags.idl',</span>
<a href="#l8.9"></a><span id="l8.9">     'nsMsgMessageFlags.idl',</span>
<a href="#l8.10"></a><span id="l8.10"> ]</span>
<a href="#l8.11"></a><span id="l8.11"> </span>
<a href="#l8.12"></a><span id="l8.12" class="difflineplus">+if CONFIG['OS_ARCH'] == 'WINNT':</span>
<a href="#l8.13"></a><span id="l8.13" class="difflineplus">+    XPIDL_SOURCES += [</span>
<a href="#l8.14"></a><span id="l8.14" class="difflineplus">+        'nsIMessengerWindowsIntegration.idl',</span>
<a href="#l8.15"></a><span id="l8.15" class="difflineplus">+    ]</span>
<a href="#l8.16"></a><span id="l8.16" class="difflineplus">+</span>
<a href="#l8.17"></a><span id="l8.17"> XPIDL_MODULE = 'msgbase'</span>
<a href="#l8.18"></a><span id="l8.18"> </span>
<a href="#l8.19"></a><span id="l8.19"> EXPORTS += [</span>
<a href="#l8.20"></a><span id="l8.20">     'MailNewsTypes.h',</span>
<a href="#l8.21"></a><span id="l8.21">     'msgCore.h',</span>
<a href="#l8.22"></a><span id="l8.22">     'nsMsgBaseCID.h',</span>
<a href="#l8.23"></a><span id="l8.23">     'nsMsgHeaderMasks.h',</span>
<a href="#l8.24"></a><span id="l8.24">     'nsMsgLocalFolderHdrs.h',</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l9.1"></a><span id="l9.1">new file mode 100644</span>
<a href="#l9.2"></a><span id="l9.2" class="difflineminus">--- /dev/null</span>
<a href="#l9.3"></a><span id="l9.3" class="difflineplus">+++ b/mailnews/base/public/nsIMessengerWindowsIntegration.idl</span>
<a href="#l9.4"></a><span id="l9.4" class="difflineat">@@ -0,0 +1,12 @@</span>
<a href="#l9.5"></a><span id="l9.5" class="difflineplus">+/* -*- Mode: IDL; tab-width: 4; indent-tabs-mode: nil; c-basic-offset: 4 -*-</span>
<a href="#l9.6"></a><span id="l9.6" class="difflineplus">+/* This Source Code Form is subject to the terms of the Mozilla Public</span>
<a href="#l9.7"></a><span id="l9.7" class="difflineplus">+ * License, v. 2.0. If a copy of the MPL was not distributed with this</span>
<a href="#l9.8"></a><span id="l9.8" class="difflineplus">+ * file, You can obtain one at http://mozilla.org/MPL/2.0/. */</span>
<a href="#l9.9"></a><span id="l9.9" class="difflineplus">+</span>
<a href="#l9.10"></a><span id="l9.10" class="difflineplus">+#include &quot;nsIBaseWindow.idl&quot;</span>
<a href="#l9.11"></a><span id="l9.11" class="difflineplus">+#include &quot;nsIMessengerOSIntegration.idl&quot;</span>
<a href="#l9.12"></a><span id="l9.12" class="difflineplus">+</span>
<a href="#l9.13"></a><span id="l9.13" class="difflineplus">+[scriptable, uuid(e14eb9fe-e05e-4b78-bd31-5b7e1497f91b)]</span>
<a href="#l9.14"></a><span id="l9.14" class="difflineplus">+interface nsIMessengerWindowsIntegration : nsIMessengerOSIntegration {</span>
<a href="#l9.15"></a><span id="l9.15" class="difflineplus">+  void HideWindow(in nsIBaseWindow aWindow);</span>
<a href="#l9.16"></a><span id="l9.16" class="difflineplus">+};</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l10.1"></a><span id="l10.1" class="difflineminus">--- a/mailnews/base/src/nsMessengerWinIntegration.cpp</span>
<a href="#l10.2"></a><span id="l10.2" class="difflineplus">+++ b/mailnews/base/src/nsMessengerWinIntegration.cpp</span>
<a href="#l10.3"></a><span id="l10.3" class="difflineat">@@ -246,16 +246,17 @@ nsMessengerWinIntegration::~nsMessengerW</span>
<a href="#l10.4"></a><span id="l10.4">   DestroyBiffIcon();</span>
<a href="#l10.5"></a><span id="l10.5"> }</span>
<a href="#l10.6"></a><span id="l10.6"> </span>
<a href="#l10.7"></a><span id="l10.7"> NS_IMPL_ADDREF(nsMessengerWinIntegration)</span>
<a href="#l10.8"></a><span id="l10.8"> NS_IMPL_RELEASE(nsMessengerWinIntegration)</span>
<a href="#l10.9"></a><span id="l10.9"> </span>
<a href="#l10.10"></a><span id="l10.10"> NS_INTERFACE_MAP_BEGIN(nsMessengerWinIntegration)</span>
<a href="#l10.11"></a><span id="l10.11">   NS_INTERFACE_MAP_ENTRY_AMBIGUOUS(nsISupports, nsIMessengerOSIntegration)</span>
<a href="#l10.12"></a><span id="l10.12" class="difflineplus">+  NS_INTERFACE_MAP_ENTRY(nsIMessengerWindowsIntegration)</span>
<a href="#l10.13"></a><span id="l10.13">   NS_INTERFACE_MAP_ENTRY(nsIMessengerOSIntegration)</span>
<a href="#l10.14"></a><span id="l10.14">   NS_INTERFACE_MAP_ENTRY(nsIFolderListener)</span>
<a href="#l10.15"></a><span id="l10.15">   NS_INTERFACE_MAP_ENTRY(nsIObserver)</span>
<a href="#l10.16"></a><span id="l10.16"> NS_INTERFACE_MAP_END</span>
<a href="#l10.17"></a><span id="l10.17"> </span>
<a href="#l10.18"></a><span id="l10.18"> nsresult nsMessengerWinIntegration::ResetCurrent() {</span>
<a href="#l10.19"></a><span id="l10.19">   mInboxURI.Truncate();</span>
<a href="#l10.20"></a><span id="l10.20">   mEmail.Truncate();</span>
<a href="#l10.21"></a><span id="l10.21" class="difflineat">@@ -1055,8 +1056,98 @@ nsresult nsMessengerWinIntegration::Setu</span>
<a href="#l10.22"></a><span id="l10.22"> </span>
<a href="#l10.23"></a><span id="l10.23">   mUnreadCountUpdateTimer-&gt;InitWithNamedFuncCallback(</span>
<a href="#l10.24"></a><span id="l10.24">       OnUnreadCountUpdateTimer, (void *)this, UNREAD_UPDATE_INTERVAL,</span>
<a href="#l10.25"></a><span id="l10.25">       nsITimer::TYPE_ONE_SHOT,</span>
<a href="#l10.26"></a><span id="l10.26">       &quot;nsMessengerWinIntegration::OnUnreadCountUpdateTimer&quot;);</span>
<a href="#l10.27"></a><span id="l10.27"> </span>
<a href="#l10.28"></a><span id="l10.28">   return NS_OK;</span>
<a href="#l10.29"></a><span id="l10.29"> }</span>
<a href="#l10.30"></a><span id="l10.30" class="difflineplus">+</span>
<a href="#l10.31"></a><span id="l10.31" class="difflineplus">+NOTIFYICONDATAW sMailIconData = {</span>
<a href="#l10.32"></a><span id="l10.32" class="difflineplus">+  /* cbSize */ (DWORD)NOTIFYICONDATAW_V2_SIZE,</span>
<a href="#l10.33"></a><span id="l10.33" class="difflineplus">+  /* hWnd */ 0,</span>
<a href="#l10.34"></a><span id="l10.34" class="difflineplus">+  /* uID */ 2,</span>
<a href="#l10.35"></a><span id="l10.35" class="difflineplus">+  /* uFlags */ NIF_ICON | NIF_MESSAGE | NIF_TIP | NIF_INFO,</span>
<a href="#l10.36"></a><span id="l10.36" class="difflineplus">+  /* uCallbackMessage */ WM_USER,</span>
<a href="#l10.37"></a><span id="l10.37" class="difflineplus">+  /* hIcon */ 0,</span>
<a href="#l10.38"></a><span id="l10.38" class="difflineplus">+  /* szTip */ L&quot;&quot;,</span>
<a href="#l10.39"></a><span id="l10.39" class="difflineplus">+  /* dwState */ 0,</span>
<a href="#l10.40"></a><span id="l10.40" class="difflineplus">+  /* dwStateMask */ 0,</span>
<a href="#l10.41"></a><span id="l10.41" class="difflineplus">+  /* szInfo */ L&quot;&quot;,</span>
<a href="#l10.42"></a><span id="l10.42" class="difflineplus">+  /* uVersion */ {30000},</span>
<a href="#l10.43"></a><span id="l10.43" class="difflineplus">+  /* szInfoTitle */ L&quot;&quot;,</span>
<a href="#l10.44"></a><span id="l10.44" class="difflineplus">+  /* dwInfoFlags */ NIIF_USER | NIIF_NOSOUND</span>
<a href="#l10.45"></a><span id="l10.45" class="difflineplus">+};</span>
<a href="#l10.46"></a><span id="l10.46" class="difflineplus">+</span>
<a href="#l10.47"></a><span id="l10.47" class="difflineplus">+static nsCOMArray&lt;nsIBaseWindow&gt; sHiddenWindows;</span>
<a href="#l10.48"></a><span id="l10.48" class="difflineplus">+static HWND sIconWindow;</span>
<a href="#l10.49"></a><span id="l10.49" class="difflineplus">+static LRESULT CALLBACK IconWindowProc(HWND msgWindow, UINT msg, WPARAM wp, LPARAM lp) {</span>
<a href="#l10.50"></a><span id="l10.50" class="difflineplus">+  if (msg == WM_USER &amp;&amp; lp == WM_LBUTTONDOWN) {</span>
<a href="#l10.51"></a><span id="l10.51" class="difflineplus">+    ::Shell_NotifyIconW(NIM_DELETE, &amp;sMailIconData);</span>
<a href="#l10.52"></a><span id="l10.52" class="difflineplus">+</span>
<a href="#l10.53"></a><span id="l10.53" class="difflineplus">+    uint32_t count = sHiddenWindows.Length();</span>
<a href="#l10.54"></a><span id="l10.54" class="difflineplus">+    for (uint32_t i = 0; i &lt; count; i++) {</span>
<a href="#l10.55"></a><span id="l10.55" class="difflineplus">+      sHiddenWindows[i]-&gt;SetVisibility(true);</span>
<a href="#l10.56"></a><span id="l10.56" class="difflineplus">+</span>
<a href="#l10.57"></a><span id="l10.57" class="difflineplus">+      nsCOMPtr&lt;nsIWidget&gt; widget;</span>
<a href="#l10.58"></a><span id="l10.58" class="difflineplus">+      sHiddenWindows[i]-&gt;GetMainWidget(getter_AddRefs(widget));</span>
<a href="#l10.59"></a><span id="l10.59" class="difflineplus">+</span>
<a href="#l10.60"></a><span id="l10.60" class="difflineplus">+      HWND hwnd = (HWND)(widget-&gt;GetNativeData(NS_NATIVE_WIDGET));</span>
<a href="#l10.61"></a><span id="l10.61" class="difflineplus">+      ::ShowWindow(hwnd, SW_RESTORE);</span>
<a href="#l10.62"></a><span id="l10.62" class="difflineplus">+      ::SetForegroundWindow(hwnd);</span>
<a href="#l10.63"></a><span id="l10.63" class="difflineplus">+    }</span>
<a href="#l10.64"></a><span id="l10.64" class="difflineplus">+</span>
<a href="#l10.65"></a><span id="l10.65" class="difflineplus">+    sHiddenWindows.Clear();</span>
<a href="#l10.66"></a><span id="l10.66" class="difflineplus">+  }</span>
<a href="#l10.67"></a><span id="l10.67" class="difflineplus">+  return TRUE;</span>
<a href="#l10.68"></a><span id="l10.68" class="difflineplus">+}</span>
<a href="#l10.69"></a><span id="l10.69" class="difflineplus">+</span>
<a href="#l10.70"></a><span id="l10.70" class="difflineplus">+WNDCLASS sClassStruct = {</span>
<a href="#l10.71"></a><span id="l10.71" class="difflineplus">+  /* style */ 0,</span>
<a href="#l10.72"></a><span id="l10.72" class="difflineplus">+  /* lpfnWndProc */ &amp;IconWindowProc,</span>
<a href="#l10.73"></a><span id="l10.73" class="difflineplus">+  /* cbClsExtra */ 0,</span>
<a href="#l10.74"></a><span id="l10.74" class="difflineplus">+  /* cbWndExtra */ 0,</span>
<a href="#l10.75"></a><span id="l10.75" class="difflineplus">+  /* hInstance */ 0,</span>
<a href="#l10.76"></a><span id="l10.76" class="difflineplus">+  /* hIcon */ 0,</span>
<a href="#l10.77"></a><span id="l10.77" class="difflineplus">+  /* hCursor */ 0,</span>
<a href="#l10.78"></a><span id="l10.78" class="difflineplus">+  /* hbrBackground */ 0,</span>
<a href="#l10.79"></a><span id="l10.79" class="difflineplus">+  /* lpszMenuName */ 0,</span>
<a href="#l10.80"></a><span id="l10.80" class="difflineplus">+  /* lpszClassName */ L&quot;IconWindowClass&quot;</span>
<a href="#l10.81"></a><span id="l10.81" class="difflineplus">+};</span>
<a href="#l10.82"></a><span id="l10.82" class="difflineplus">+</span>
<a href="#l10.83"></a><span id="l10.83" class="difflineplus">+nsresult nsMessengerWinIntegration::HideWindow(nsIBaseWindow* aWindow) {</span>
<a href="#l10.84"></a><span id="l10.84" class="difflineplus">+  aWindow-&gt;SetVisibility(false);</span>
<a href="#l10.85"></a><span id="l10.85" class="difflineplus">+  sHiddenWindows.AppendElement(aWindow);</span>
<a href="#l10.86"></a><span id="l10.86" class="difflineplus">+</span>
<a href="#l10.87"></a><span id="l10.87" class="difflineplus">+  if (sMailIconData.hWnd == 0) {</span>
<a href="#l10.88"></a><span id="l10.88" class="difflineplus">+    // Register the window class.</span>
<a href="#l10.89"></a><span id="l10.89" class="difflineplus">+    NS_ENSURE_TRUE(::RegisterClass(&amp;sClassStruct), NS_ERROR_FAILURE);</span>
<a href="#l10.90"></a><span id="l10.90" class="difflineplus">+    // Create the window.</span>
<a href="#l10.91"></a><span id="l10.91" class="difflineplus">+    NS_ENSURE_TRUE(</span>
<a href="#l10.92"></a><span id="l10.92" class="difflineplus">+      sIconWindow = ::CreateWindow(</span>
<a href="#l10.93"></a><span id="l10.93" class="difflineplus">+        /* className */ L&quot;IconWindowClass&quot;,</span>
<a href="#l10.94"></a><span id="l10.94" class="difflineplus">+        /* title */ 0,</span>
<a href="#l10.95"></a><span id="l10.95" class="difflineplus">+        /* style */ WS_CAPTION,</span>
<a href="#l10.96"></a><span id="l10.96" class="difflineplus">+        /* x, y, cx, cy */ 0, 0, 0, 0,</span>
<a href="#l10.97"></a><span id="l10.97" class="difflineplus">+        /* parent */ 0,</span>
<a href="#l10.98"></a><span id="l10.98" class="difflineplus">+        /* menu */ 0,</span>
<a href="#l10.99"></a><span id="l10.99" class="difflineplus">+        /* instance */ 0,</span>
<a href="#l10.100"></a><span id="l10.100" class="difflineplus">+        /* create struct */ 0</span>
<a href="#l10.101"></a><span id="l10.101" class="difflineplus">+      ),</span>
<a href="#l10.102"></a><span id="l10.102" class="difflineplus">+      NS_ERROR_FAILURE</span>
<a href="#l10.103"></a><span id="l10.103" class="difflineplus">+    );</span>
<a href="#l10.104"></a><span id="l10.104" class="difflineplus">+    sMailIconData.hWnd = sIconWindow;</span>
<a href="#l10.105"></a><span id="l10.105" class="difflineplus">+    sMailIconData.hIcon = ::LoadIcon(::GetModuleHandle(NULL), MAKEINTRESOURCE(IDI_APPLICATION));</span>
<a href="#l10.106"></a><span id="l10.106" class="difflineplus">+</span>
<a href="#l10.107"></a><span id="l10.107" class="difflineplus">+    nsCOMPtr&lt;nsIStringBundleService&gt; bundleService = mozilla::services::GetStringBundleService();</span>
<a href="#l10.108"></a><span id="l10.108" class="difflineplus">+    NS_ENSURE_TRUE(bundleService, NS_ERROR_UNEXPECTED);</span>
<a href="#l10.109"></a><span id="l10.109" class="difflineplus">+    nsCOMPtr&lt;nsIStringBundle&gt; bundle;</span>
<a href="#l10.110"></a><span id="l10.110" class="difflineplus">+    bundleService-&gt;CreateBundle(&quot;chrome://branding/locale/brand.properties&quot;, getter_AddRefs(bundle));</span>
<a href="#l10.111"></a><span id="l10.111" class="difflineplus">+    nsString brandShortName;</span>
<a href="#l10.112"></a><span id="l10.112" class="difflineplus">+    bundle-&gt;GetStringFromName(&quot;brandShortName&quot;, brandShortName);</span>
<a href="#l10.113"></a><span id="l10.113" class="difflineplus">+    ::wcsncpy(sMailIconData.szTip, brandShortName.get(), brandShortName.Length());</span>
<a href="#l10.114"></a><span id="l10.114" class="difflineplus">+  }</span>
<a href="#l10.115"></a><span id="l10.115" class="difflineplus">+</span>
<a href="#l10.116"></a><span id="l10.116" class="difflineplus">+  ::Shell_NotifyIconW(NIM_ADD, &amp;sMailIconData);</span>
<a href="#l10.117"></a><span id="l10.117" class="difflineplus">+  ::Shell_NotifyIconW(NIM_SETVERSION, &amp;sMailIconData);</span>
<a href="#l10.118"></a><span id="l10.118" class="difflineplus">+  return NS_OK;</span>
<a href="#l10.119"></a><span id="l10.119" class="difflineplus">+}</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l11.1"></a><span id="l11.1" class="difflineminus">--- a/mailnews/base/src/nsMessengerWinIntegration.h</span>
<a href="#l11.2"></a><span id="l11.2" class="difflineplus">+++ b/mailnews/base/src/nsMessengerWinIntegration.h</span>
<a href="#l11.3"></a><span id="l11.3" class="difflineat">@@ -6,42 +6,42 @@</span>
<a href="#l11.4"></a><span id="l11.4"> #ifndef __nsMessengerWinIntegration_h</span>
<a href="#l11.5"></a><span id="l11.5"> #define __nsMessengerWinIntegration_h</span>
<a href="#l11.6"></a><span id="l11.6"> </span>
<a href="#l11.7"></a><span id="l11.7"> #include &lt;windows.h&gt;</span>
<a href="#l11.8"></a><span id="l11.8"> </span>
<a href="#l11.9"></a><span id="l11.9"> // shellapi.h is needed to build with WIN32_LEAN_AND_MEAN</span>
<a href="#l11.10"></a><span id="l11.10"> #include &lt;shellapi.h&gt;</span>
<a href="#l11.11"></a><span id="l11.11"> </span>
<a href="#l11.12"></a><span id="l11.12" class="difflineminus">-#include &quot;nsIMessengerOSIntegration.h&quot;</span>
<a href="#l11.13"></a><span id="l11.13" class="difflineplus">+#include &quot;nsIMessengerWindowsIntegration.h&quot;</span>
<a href="#l11.14"></a><span id="l11.14"> #include &quot;nsIFolderListener.h&quot;</span>
<a href="#l11.15"></a><span id="l11.15"> #include &quot;nsITimer.h&quot;</span>
<a href="#l11.16"></a><span id="l11.16"> #include &quot;nsCOMPtr.h&quot;</span>
<a href="#l11.17"></a><span id="l11.17"> #include &quot;nsString.h&quot;</span>
<a href="#l11.18"></a><span id="l11.18"> #include &quot;nsIMutableArray.h&quot;</span>
<a href="#l11.19"></a><span id="l11.19"> #include &quot;nsIObserver.h&quot;</span>
<a href="#l11.20"></a><span id="l11.20"> </span>
<a href="#l11.21"></a><span id="l11.21"> #define NS_MESSENGERWININTEGRATION_CID               \</span>
<a href="#l11.22"></a><span id="l11.22">   {                                                  \</span>
<a href="#l11.23"></a><span id="l11.23">     0xf62f3d3a, 0x1dd1, 0x11b2, {                    \</span>
<a href="#l11.24"></a><span id="l11.24">       0xa5, 0x16, 0xef, 0xad, 0xb1, 0x31, 0x61, 0x5c \</span>
<a href="#l11.25"></a><span id="l11.25">     }                                                \</span>
<a href="#l11.26"></a><span id="l11.26">   }</span>
<a href="#l11.27"></a><span id="l11.27"> </span>
<a href="#l11.28"></a><span id="l11.28"> class nsIStringBundle;</span>
<a href="#l11.29"></a><span id="l11.29"> </span>
<a href="#l11.30"></a><span id="l11.30" class="difflineminus">-class nsMessengerWinIntegration : public nsIMessengerOSIntegration,</span>
<a href="#l11.31"></a><span id="l11.31" class="difflineplus">+class nsMessengerWinIntegration : public nsIMessengerWindowsIntegration,</span>
<a href="#l11.32"></a><span id="l11.32">                                   public nsIFolderListener,</span>
<a href="#l11.33"></a><span id="l11.33">                                   public nsIObserver {</span>
<a href="#l11.34"></a><span id="l11.34">  public:</span>
<a href="#l11.35"></a><span id="l11.35">   nsMessengerWinIntegration();</span>
<a href="#l11.36"></a><span id="l11.36">   virtual nsresult Init();</span>
<a href="#l11.37"></a><span id="l11.37"> </span>
<a href="#l11.38"></a><span id="l11.38">   NS_DECL_ISUPPORTS</span>
<a href="#l11.39"></a><span id="l11.39" class="difflineminus">-  NS_DECL_NSIMESSENGEROSINTEGRATION</span>
<a href="#l11.40"></a><span id="l11.40" class="difflineplus">+  NS_DECL_NSIMESSENGERWINDOWSINTEGRATION</span>
<a href="#l11.41"></a><span id="l11.41">   NS_DECL_NSIFOLDERLISTENER</span>
<a href="#l11.42"></a><span id="l11.42">   NS_DECL_NSIOBSERVER</span>
<a href="#l11.43"></a><span id="l11.43"> </span>
<a href="#l11.44"></a><span id="l11.44">   nsresult ShowNewAlertNotification(bool aUserInitiated,</span>
<a href="#l11.45"></a><span id="l11.45">                                     const nsString&amp; aAlertTitle,</span>
<a href="#l11.46"></a><span id="l11.46">                                     const nsString&amp; aAlertText);</span>
<a href="#l11.47"></a><span id="l11.47"> #ifndef MOZ_THUNDERBIRD</span>
<a href="#l11.48"></a><span id="l11.48">   nsresult ShowAlertMessage(const nsString&amp; aAlertTitle,</span></pre></div></div>

<div class="page_footer">
<div class="page_footer_text">comm-central</div>
<div class="page_footer_text" style="padding-left: 10px">Deployed from <a href="https://hg.mozilla.org/hgcustom/version-control-tools/rev/4b0de666d1a4">4b0de666d1a4</a> at 2020-07-30T19:32:33Z.</div>
<div class="rss_logo">
<a href="/comm-central/rss-log">RSS</a>
<a href="/comm-central/atom-log">Atom</a>
</div>
<br />

</div>
</body>
</html>

