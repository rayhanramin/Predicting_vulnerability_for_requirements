<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en-US" lang="en-US">
<head>
<link rel="icon" href="/static/35f393d6769a/hgicon.png" type="image/png" />
<meta name="robots" content="index, nofollow"/>
<link rel="stylesheet" href="/static/35f393d6769a/style-gitweb.css" type="text/css" />

<style type="text/css">
div.feed {
  float: right;
}
a img {
  border-width: 0px;
}
div.log_link {
  width: 80px;
  background-color: white;
}

div.log_body {
  padding-left: 96px;
}
</style>
<script type="text/javascript" src="/static/35f393d6769a/mercurial.js"></script>

<meta property="og:image" content="/static/35f393d6769a/moz-logo-bw-rgb.svg"/>
<meta property="og:type" content="website"/>

<title>comm-central: changeset 18686:6d3320934b32ca12c389756c61732256810f18d7</title>
<link rel="alternate" type="application/atom+xml"
   href="/comm-central/atom-log" title="Atom feed for comm-central"/>
<link rel="alternate" type="application/rss+xml"
   href="/comm-central/rss-log" title="RSS feed for comm-central"/>

<meta property="og:title" content="comm-central @ 6d3320934b32ca12c389756c61732256810f18d7" />
<meta property="og:url" content="/comm-central/rev/6d3320934b32ca12c389756c61732256810f18d7" />
<meta property="og:description" content="Bug 824104 - Part 1: Remove for-each from mail/. r=jcranmer" />

</head>
<body>

<div class="page_header">
<div class="logo">
    <a href="https://developer.mozilla.org/en/docs/Mercurial">
        <img src="/static/35f393d6769a/moz-logo-bw-rgb.svg" alt="mercurial" />
    </a>
</div>
<a href="/">Mercurial</a> &gt; <a href="/comm-central">comm-central</a>  / changeset / 6d3320934b32ca12c389756c61732256810f18d7 
</div>

<div class="page_nav">
<div>
<a href="/comm-central/summary">summary</a> |
<a href="/comm-central/shortlog/6d3320934b32ca12c389756c61732256810f18d7">shortlog</a> |
<a href="/comm-central/log/6d3320934b32ca12c389756c61732256810f18d7">changelog</a> |
<a href="/comm-central/pushloghtml">pushlog</a> |
<a href="/comm-central/graph/6d3320934b32ca12c389756c61732256810f18d7">graph</a> |
<a href="/comm-central/tags">tags</a> |
<a href="/comm-central/bookmarks">bookmarks</a> |
<a href="/comm-central/branches">branches</a> |
<a href="/comm-central/file/6d3320934b32ca12c389756c61732256810f18d7">files</a> |
changeset |
<a href="/comm-central/raw-rev/6d3320934b32ca12c389756c61732256810f18d7">raw</a>  | <a href="/comm-central/archive/6d3320934b32ca12c389756c61732256810f18d7.zip">zip</a>  |
<a href="/comm-central/help">help</a>
</div>

<div class="search">
<form id="searchform" action="/comm-central/log">

<input name="rev" type="text" value="" size="40" />
<div id="hint">Find changesets by keywords (author, files, the commit message), revision
number or hash, or <a href="/comm-central/help/revsets">revset expression</a>.</div>
</form>
</div>
</div>

<div class="title">
<a href="https://bugzilla.mozilla.org/show_bug.cgi?id=824104">Bug 824104</a> - Part 1: Remove for-each from mail/. r=jcranmer
<span class="logtags"></span>
</div>
<div class="title_text">
<table cellspacing="0">

<tr><td>author</td><td>&#84;&#111;&#111;&#114;&#117;&#32;&#70;&#117;&#106;&#105;&#115;&#97;&#119;&#97;&#32;&#60;&#97;&#114;&#97;&#105;&#95;&#97;&#64;&#109;&#97;&#99;&#46;&#99;&#111;&#109;&#62;</td></tr>
<tr><td></td><td class="date age">Sat, 05 Dec 2015 14:27:13 +0900</td></tr>

<tr>
 <td>changeset 18686</td>
 <td style="font-family:monospace"><a class="list" href="/comm-central/rev/6d3320934b32ca12c389756c61732256810f18d7">6d3320934b32ca12c389756c61732256810f18d7</a></td>
</tr>



<tr>
<td>parent 18685</td>
<td style="font-family:monospace">
<a class="list" href="/comm-central/rev/725ae1aad7d0900e34dbd06359a1a41279e25873">725ae1aad7d0900e34dbd06359a1a41279e25873</a>
</td>
</tr>

<tr>
<td>child 18687</td>
<td style="font-family:monospace">
<a class="list" href="/comm-central/rev/9692c8c255faf011c9a878e3b1c9a401d5ba55da">9692c8c255faf011c9a878e3b1c9a401d5ba55da</a>
</td>
</tr>
<tr><td>push id</td><td><a href="/comm-central/pushloghtml?changeset=6d3320934b32ca12c389756c61732256810f18d7">11448</a></td></tr>
<tr><td>push user</td><td>arai_a@mac.com</td></tr>
<tr><td>push date</td><td class="date age">Sat, 05 Dec 2015 05:32:05 +0000</td></tr>

<tr><td>treeherder</td><td>comm-central@4d56a1bacc30 [<a href="https://treeherder.mozilla.org/#/jobs?repo=comm-central&revision=4d56a1bacc304e528382543b4e6ded86f07cb313">default view</a>] [<a href="https://treeherder.mozilla.org/#/jobs?repo=comm-central&revision=4d56a1bacc304e528382543b4e6ded86f07cb313&filter-resultStatus=testfailed&filter-resultStatus=busted&filter-resultStatus=exception">failures only]</td></tr>
<tr><td>perfherder</td><td>[<a href="https://treeherder.mozilla.org/perf.html#/compare?originalProject=comm-central&originalRevision=4d56a1bacc304e528382543b4e6ded86f07cb313&newProject=comm-central&newRevision=6d3320934b32ca12c389756c61732256810f18d7&framework=1" target="_blank">talos</a>] [<a href="https://treeherder.mozilla.org/perf.html#/compare?originalProject=comm-central&originalRevision=4d56a1bacc304e528382543b4e6ded86f07cb313&newProject=comm-central&newRevision=6d3320934b32ca12c389756c61732256810f18d7&framework=2" target="_blank">build metrics</a>] [<a href="https://treeherder.mozilla.org/perf.html#/compare?originalProject=comm-central&originalRevision=4d56a1bacc304e528382543b4e6ded86f07cb313&newProject=comm-central&newRevision=6d3320934b32ca12c389756c61732256810f18d7&framework=6" target="_blank">platform microbench</a>] (compared to previous push)</td></tr>
<tr><td>reviewers</td><td><a href="/comm-central/log?rev=reviewer%28jcranmer%29&revcount=50">jcranmer</a></td></tr>
<tr><td>bugs</td><td><a href="https://bugzilla.mozilla.org/show_bug.cgi?id=824104">824104</a></td></tr>




</table></div>

<div class="page_body description"><a href="https://bugzilla.mozilla.org/show_bug.cgi?id=824104">Bug 824104</a> - Part 1: Remove for-each from mail/. r=jcranmer</div>
<div class="list_head"></div>
<div class="title_text">
<table cellspacing="0">

<tr class="parity0">
<td><a class="list" href="/comm-central/diff/6d3320934b32ca12c389756c61732256810f18d7/mail/base/content/folderDisplay.js">mail/base/content/folderDisplay.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/6d3320934b32ca12c389756c61732256810f18d7/mail/base/content/folderDisplay.js">file</a> |
<a href="/comm-central/annotate/6d3320934b32ca12c389756c61732256810f18d7/mail/base/content/folderDisplay.js">annotate</a> |
<a href="/comm-central/diff/6d3320934b32ca12c389756c61732256810f18d7/mail/base/content/folderDisplay.js">diff</a> |
<a href="/comm-central/comparison/6d3320934b32ca12c389756c61732256810f18d7/mail/base/content/folderDisplay.js">comparison</a> |
<a href="/comm-central/log/6d3320934b32ca12c389756c61732256810f18d7/mail/base/content/folderDisplay.js">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/6d3320934b32ca12c389756c61732256810f18d7/mail/base/content/folderPane.js">mail/base/content/folderPane.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/6d3320934b32ca12c389756c61732256810f18d7/mail/base/content/folderPane.js">file</a> |
<a href="/comm-central/annotate/6d3320934b32ca12c389756c61732256810f18d7/mail/base/content/folderPane.js">annotate</a> |
<a href="/comm-central/diff/6d3320934b32ca12c389756c61732256810f18d7/mail/base/content/folderPane.js">diff</a> |
<a href="/comm-central/comparison/6d3320934b32ca12c389756c61732256810f18d7/mail/base/content/folderPane.js">comparison</a> |
<a href="/comm-central/log/6d3320934b32ca12c389756c61732256810f18d7/mail/base/content/folderPane.js">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/6d3320934b32ca12c389756c61732256810f18d7/mail/base/content/glodaFacetBindings.xml">mail/base/content/glodaFacetBindings.xml</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/6d3320934b32ca12c389756c61732256810f18d7/mail/base/content/glodaFacetBindings.xml">file</a> |
<a href="/comm-central/annotate/6d3320934b32ca12c389756c61732256810f18d7/mail/base/content/glodaFacetBindings.xml">annotate</a> |
<a href="/comm-central/diff/6d3320934b32ca12c389756c61732256810f18d7/mail/base/content/glodaFacetBindings.xml">diff</a> |
<a href="/comm-central/comparison/6d3320934b32ca12c389756c61732256810f18d7/mail/base/content/glodaFacetBindings.xml">comparison</a> |
<a href="/comm-central/log/6d3320934b32ca12c389756c61732256810f18d7/mail/base/content/glodaFacetBindings.xml">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/6d3320934b32ca12c389756c61732256810f18d7/mail/base/content/mailCore.js">mail/base/content/mailCore.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/6d3320934b32ca12c389756c61732256810f18d7/mail/base/content/mailCore.js">file</a> |
<a href="/comm-central/annotate/6d3320934b32ca12c389756c61732256810f18d7/mail/base/content/mailCore.js">annotate</a> |
<a href="/comm-central/diff/6d3320934b32ca12c389756c61732256810f18d7/mail/base/content/mailCore.js">diff</a> |
<a href="/comm-central/comparison/6d3320934b32ca12c389756c61732256810f18d7/mail/base/content/mailCore.js">comparison</a> |
<a href="/comm-central/log/6d3320934b32ca12c389756c61732256810f18d7/mail/base/content/mailCore.js">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/6d3320934b32ca12c389756c61732256810f18d7/mail/base/content/mailTabs.js">mail/base/content/mailTabs.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/6d3320934b32ca12c389756c61732256810f18d7/mail/base/content/mailTabs.js">file</a> |
<a href="/comm-central/annotate/6d3320934b32ca12c389756c61732256810f18d7/mail/base/content/mailTabs.js">annotate</a> |
<a href="/comm-central/diff/6d3320934b32ca12c389756c61732256810f18d7/mail/base/content/mailTabs.js">diff</a> |
<a href="/comm-central/comparison/6d3320934b32ca12c389756c61732256810f18d7/mail/base/content/mailTabs.js">comparison</a> |
<a href="/comm-central/log/6d3320934b32ca12c389756c61732256810f18d7/mail/base/content/mailTabs.js">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/6d3320934b32ca12c389756c61732256810f18d7/mail/base/content/mailWindowOverlay.js">mail/base/content/mailWindowOverlay.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/6d3320934b32ca12c389756c61732256810f18d7/mail/base/content/mailWindowOverlay.js">file</a> |
<a href="/comm-central/annotate/6d3320934b32ca12c389756c61732256810f18d7/mail/base/content/mailWindowOverlay.js">annotate</a> |
<a href="/comm-central/diff/6d3320934b32ca12c389756c61732256810f18d7/mail/base/content/mailWindowOverlay.js">diff</a> |
<a href="/comm-central/comparison/6d3320934b32ca12c389756c61732256810f18d7/mail/base/content/mailWindowOverlay.js">comparison</a> |
<a href="/comm-central/log/6d3320934b32ca12c389756c61732256810f18d7/mail/base/content/mailWindowOverlay.js">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/6d3320934b32ca12c389756c61732256810f18d7/mail/base/content/msgHdrViewOverlay.js">mail/base/content/msgHdrViewOverlay.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/6d3320934b32ca12c389756c61732256810f18d7/mail/base/content/msgHdrViewOverlay.js">file</a> |
<a href="/comm-central/annotate/6d3320934b32ca12c389756c61732256810f18d7/mail/base/content/msgHdrViewOverlay.js">annotate</a> |
<a href="/comm-central/diff/6d3320934b32ca12c389756c61732256810f18d7/mail/base/content/msgHdrViewOverlay.js">diff</a> |
<a href="/comm-central/comparison/6d3320934b32ca12c389756c61732256810f18d7/mail/base/content/msgHdrViewOverlay.js">comparison</a> |
<a href="/comm-central/log/6d3320934b32ca12c389756c61732256810f18d7/mail/base/content/msgHdrViewOverlay.js">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/6d3320934b32ca12c389756c61732256810f18d7/mail/base/content/msgViewNavigation.js">mail/base/content/msgViewNavigation.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/6d3320934b32ca12c389756c61732256810f18d7/mail/base/content/msgViewNavigation.js">file</a> |
<a href="/comm-central/annotate/6d3320934b32ca12c389756c61732256810f18d7/mail/base/content/msgViewNavigation.js">annotate</a> |
<a href="/comm-central/diff/6d3320934b32ca12c389756c61732256810f18d7/mail/base/content/msgViewNavigation.js">diff</a> |
<a href="/comm-central/comparison/6d3320934b32ca12c389756c61732256810f18d7/mail/base/content/msgViewNavigation.js">comparison</a> |
<a href="/comm-central/log/6d3320934b32ca12c389756c61732256810f18d7/mail/base/content/msgViewNavigation.js">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/6d3320934b32ca12c389756c61732256810f18d7/mail/base/content/quickFilterBar.js">mail/base/content/quickFilterBar.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/6d3320934b32ca12c389756c61732256810f18d7/mail/base/content/quickFilterBar.js">file</a> |
<a href="/comm-central/annotate/6d3320934b32ca12c389756c61732256810f18d7/mail/base/content/quickFilterBar.js">annotate</a> |
<a href="/comm-central/diff/6d3320934b32ca12c389756c61732256810f18d7/mail/base/content/quickFilterBar.js">diff</a> |
<a href="/comm-central/comparison/6d3320934b32ca12c389756c61732256810f18d7/mail/base/content/quickFilterBar.js">comparison</a> |
<a href="/comm-central/log/6d3320934b32ca12c389756c61732256810f18d7/mail/base/content/quickFilterBar.js">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/6d3320934b32ca12c389756c61732256810f18d7/mail/base/content/tabmail.xml">mail/base/content/tabmail.xml</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/6d3320934b32ca12c389756c61732256810f18d7/mail/base/content/tabmail.xml">file</a> |
<a href="/comm-central/annotate/6d3320934b32ca12c389756c61732256810f18d7/mail/base/content/tabmail.xml">annotate</a> |
<a href="/comm-central/diff/6d3320934b32ca12c389756c61732256810f18d7/mail/base/content/tabmail.xml">diff</a> |
<a href="/comm-central/comparison/6d3320934b32ca12c389756c61732256810f18d7/mail/base/content/tabmail.xml">comparison</a> |
<a href="/comm-central/log/6d3320934b32ca12c389756c61732256810f18d7/mail/base/content/tabmail.xml">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/6d3320934b32ca12c389756c61732256810f18d7/mail/base/modules/MailUtils.js">mail/base/modules/MailUtils.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/6d3320934b32ca12c389756c61732256810f18d7/mail/base/modules/MailUtils.js">file</a> |
<a href="/comm-central/annotate/6d3320934b32ca12c389756c61732256810f18d7/mail/base/modules/MailUtils.js">annotate</a> |
<a href="/comm-central/diff/6d3320934b32ca12c389756c61732256810f18d7/mail/base/modules/MailUtils.js">diff</a> |
<a href="/comm-central/comparison/6d3320934b32ca12c389756c61732256810f18d7/mail/base/modules/MailUtils.js">comparison</a> |
<a href="/comm-central/log/6d3320934b32ca12c389756c61732256810f18d7/mail/base/modules/MailUtils.js">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/6d3320934b32ca12c389756c61732256810f18d7/mail/base/modules/dbViewWrapper.js">mail/base/modules/dbViewWrapper.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/6d3320934b32ca12c389756c61732256810f18d7/mail/base/modules/dbViewWrapper.js">file</a> |
<a href="/comm-central/annotate/6d3320934b32ca12c389756c61732256810f18d7/mail/base/modules/dbViewWrapper.js">annotate</a> |
<a href="/comm-central/diff/6d3320934b32ca12c389756c61732256810f18d7/mail/base/modules/dbViewWrapper.js">diff</a> |
<a href="/comm-central/comparison/6d3320934b32ca12c389756c61732256810f18d7/mail/base/modules/dbViewWrapper.js">comparison</a> |
<a href="/comm-central/log/6d3320934b32ca12c389756c61732256810f18d7/mail/base/modules/dbViewWrapper.js">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/6d3320934b32ca12c389756c61732256810f18d7/mail/base/modules/mailMigrator.js">mail/base/modules/mailMigrator.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/6d3320934b32ca12c389756c61732256810f18d7/mail/base/modules/mailMigrator.js">file</a> |
<a href="/comm-central/annotate/6d3320934b32ca12c389756c61732256810f18d7/mail/base/modules/mailMigrator.js">annotate</a> |
<a href="/comm-central/diff/6d3320934b32ca12c389756c61732256810f18d7/mail/base/modules/mailMigrator.js">diff</a> |
<a href="/comm-central/comparison/6d3320934b32ca12c389756c61732256810f18d7/mail/base/modules/mailMigrator.js">comparison</a> |
<a href="/comm-central/log/6d3320934b32ca12c389756c61732256810f18d7/mail/base/modules/mailMigrator.js">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/6d3320934b32ca12c389756c61732256810f18d7/mail/base/modules/oauth.jsm">mail/base/modules/oauth.jsm</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/6d3320934b32ca12c389756c61732256810f18d7/mail/base/modules/oauth.jsm">file</a> |
<a href="/comm-central/annotate/6d3320934b32ca12c389756c61732256810f18d7/mail/base/modules/oauth.jsm">annotate</a> |
<a href="/comm-central/diff/6d3320934b32ca12c389756c61732256810f18d7/mail/base/modules/oauth.jsm">diff</a> |
<a href="/comm-central/comparison/6d3320934b32ca12c389756c61732256810f18d7/mail/base/modules/oauth.jsm">comparison</a> |
<a href="/comm-central/log/6d3320934b32ca12c389756c61732256810f18d7/mail/base/modules/oauth.jsm">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/6d3320934b32ca12c389756c61732256810f18d7/mail/base/modules/quickFilterManager.js">mail/base/modules/quickFilterManager.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/6d3320934b32ca12c389756c61732256810f18d7/mail/base/modules/quickFilterManager.js">file</a> |
<a href="/comm-central/annotate/6d3320934b32ca12c389756c61732256810f18d7/mail/base/modules/quickFilterManager.js">annotate</a> |
<a href="/comm-central/diff/6d3320934b32ca12c389756c61732256810f18d7/mail/base/modules/quickFilterManager.js">diff</a> |
<a href="/comm-central/comparison/6d3320934b32ca12c389756c61732256810f18d7/mail/base/modules/quickFilterManager.js">comparison</a> |
<a href="/comm-central/log/6d3320934b32ca12c389756c61732256810f18d7/mail/base/modules/quickFilterManager.js">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/6d3320934b32ca12c389756c61732256810f18d7/mail/base/modules/searchSpec.js">mail/base/modules/searchSpec.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/6d3320934b32ca12c389756c61732256810f18d7/mail/base/modules/searchSpec.js">file</a> |
<a href="/comm-central/annotate/6d3320934b32ca12c389756c61732256810f18d7/mail/base/modules/searchSpec.js">annotate</a> |
<a href="/comm-central/diff/6d3320934b32ca12c389756c61732256810f18d7/mail/base/modules/searchSpec.js">diff</a> |
<a href="/comm-central/comparison/6d3320934b32ca12c389756c61732256810f18d7/mail/base/modules/searchSpec.js">comparison</a> |
<a href="/comm-central/log/6d3320934b32ca12c389756c61732256810f18d7/mail/base/modules/searchSpec.js">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/6d3320934b32ca12c389756c61732256810f18d7/mail/base/test/unit/resources/viewWrapperTestUtils.js">mail/base/test/unit/resources/viewWrapperTestUtils.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/6d3320934b32ca12c389756c61732256810f18d7/mail/base/test/unit/resources/viewWrapperTestUtils.js">file</a> |
<a href="/comm-central/annotate/6d3320934b32ca12c389756c61732256810f18d7/mail/base/test/unit/resources/viewWrapperTestUtils.js">annotate</a> |
<a href="/comm-central/diff/6d3320934b32ca12c389756c61732256810f18d7/mail/base/test/unit/resources/viewWrapperTestUtils.js">diff</a> |
<a href="/comm-central/comparison/6d3320934b32ca12c389756c61732256810f18d7/mail/base/test/unit/resources/viewWrapperTestUtils.js">comparison</a> |
<a href="/comm-central/log/6d3320934b32ca12c389756c61732256810f18d7/mail/base/test/unit/resources/viewWrapperTestUtils.js">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/6d3320934b32ca12c389756c61732256810f18d7/mail/components/activity/content/activity.js">mail/components/activity/content/activity.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/6d3320934b32ca12c389756c61732256810f18d7/mail/components/activity/content/activity.js">file</a> |
<a href="/comm-central/annotate/6d3320934b32ca12c389756c61732256810f18d7/mail/components/activity/content/activity.js">annotate</a> |
<a href="/comm-central/diff/6d3320934b32ca12c389756c61732256810f18d7/mail/components/activity/content/activity.js">diff</a> |
<a href="/comm-central/comparison/6d3320934b32ca12c389756c61732256810f18d7/mail/components/activity/content/activity.js">comparison</a> |
<a href="/comm-central/log/6d3320934b32ca12c389756c61732256810f18d7/mail/components/activity/content/activity.js">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/6d3320934b32ca12c389756c61732256810f18d7/mail/components/activity/content/activity.xml">mail/components/activity/content/activity.xml</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/6d3320934b32ca12c389756c61732256810f18d7/mail/components/activity/content/activity.xml">file</a> |
<a href="/comm-central/annotate/6d3320934b32ca12c389756c61732256810f18d7/mail/components/activity/content/activity.xml">annotate</a> |
<a href="/comm-central/diff/6d3320934b32ca12c389756c61732256810f18d7/mail/components/activity/content/activity.xml">diff</a> |
<a href="/comm-central/comparison/6d3320934b32ca12c389756c61732256810f18d7/mail/components/activity/content/activity.xml">comparison</a> |
<a href="/comm-central/log/6d3320934b32ca12c389756c61732256810f18d7/mail/components/activity/content/activity.xml">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/6d3320934b32ca12c389756c61732256810f18d7/mail/components/activity/modules/autosync.js">mail/components/activity/modules/autosync.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/6d3320934b32ca12c389756c61732256810f18d7/mail/components/activity/modules/autosync.js">file</a> |
<a href="/comm-central/annotate/6d3320934b32ca12c389756c61732256810f18d7/mail/components/activity/modules/autosync.js">annotate</a> |
<a href="/comm-central/diff/6d3320934b32ca12c389756c61732256810f18d7/mail/components/activity/modules/autosync.js">diff</a> |
<a href="/comm-central/comparison/6d3320934b32ca12c389756c61732256810f18d7/mail/components/activity/modules/autosync.js">comparison</a> |
<a href="/comm-central/log/6d3320934b32ca12c389756c61732256810f18d7/mail/components/activity/modules/autosync.js">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/6d3320934b32ca12c389756c61732256810f18d7/mail/components/activity/modules/glodaIndexer.js">mail/components/activity/modules/glodaIndexer.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/6d3320934b32ca12c389756c61732256810f18d7/mail/components/activity/modules/glodaIndexer.js">file</a> |
<a href="/comm-central/annotate/6d3320934b32ca12c389756c61732256810f18d7/mail/components/activity/modules/glodaIndexer.js">annotate</a> |
<a href="/comm-central/diff/6d3320934b32ca12c389756c61732256810f18d7/mail/components/activity/modules/glodaIndexer.js">diff</a> |
<a href="/comm-central/comparison/6d3320934b32ca12c389756c61732256810f18d7/mail/components/activity/modules/glodaIndexer.js">comparison</a> |
<a href="/comm-central/log/6d3320934b32ca12c389756c61732256810f18d7/mail/components/activity/modules/glodaIndexer.js">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/6d3320934b32ca12c389756c61732256810f18d7/mail/components/activity/nsActivity.js">mail/components/activity/nsActivity.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/6d3320934b32ca12c389756c61732256810f18d7/mail/components/activity/nsActivity.js">file</a> |
<a href="/comm-central/annotate/6d3320934b32ca12c389756c61732256810f18d7/mail/components/activity/nsActivity.js">annotate</a> |
<a href="/comm-central/diff/6d3320934b32ca12c389756c61732256810f18d7/mail/components/activity/nsActivity.js">diff</a> |
<a href="/comm-central/comparison/6d3320934b32ca12c389756c61732256810f18d7/mail/components/activity/nsActivity.js">comparison</a> |
<a href="/comm-central/log/6d3320934b32ca12c389756c61732256810f18d7/mail/components/activity/nsActivity.js">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/6d3320934b32ca12c389756c61732256810f18d7/mail/components/activity/nsActivityManager.js">mail/components/activity/nsActivityManager.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/6d3320934b32ca12c389756c61732256810f18d7/mail/components/activity/nsActivityManager.js">file</a> |
<a href="/comm-central/annotate/6d3320934b32ca12c389756c61732256810f18d7/mail/components/activity/nsActivityManager.js">annotate</a> |
<a href="/comm-central/diff/6d3320934b32ca12c389756c61732256810f18d7/mail/components/activity/nsActivityManager.js">diff</a> |
<a href="/comm-central/comparison/6d3320934b32ca12c389756c61732256810f18d7/mail/components/activity/nsActivityManager.js">comparison</a> |
<a href="/comm-central/log/6d3320934b32ca12c389756c61732256810f18d7/mail/components/activity/nsActivityManager.js">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/6d3320934b32ca12c389756c61732256810f18d7/mail/components/addrbook/content/abCardOverlay.js">mail/components/addrbook/content/abCardOverlay.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/6d3320934b32ca12c389756c61732256810f18d7/mail/components/addrbook/content/abCardOverlay.js">file</a> |
<a href="/comm-central/annotate/6d3320934b32ca12c389756c61732256810f18d7/mail/components/addrbook/content/abCardOverlay.js">annotate</a> |
<a href="/comm-central/diff/6d3320934b32ca12c389756c61732256810f18d7/mail/components/addrbook/content/abCardOverlay.js">diff</a> |
<a href="/comm-central/comparison/6d3320934b32ca12c389756c61732256810f18d7/mail/components/addrbook/content/abCardOverlay.js">comparison</a> |
<a href="/comm-central/log/6d3320934b32ca12c389756c61732256810f18d7/mail/components/addrbook/content/abCardOverlay.js">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/6d3320934b32ca12c389756c61732256810f18d7/mail/components/addrbook/content/addressbook.js">mail/components/addrbook/content/addressbook.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/6d3320934b32ca12c389756c61732256810f18d7/mail/components/addrbook/content/addressbook.js">file</a> |
<a href="/comm-central/annotate/6d3320934b32ca12c389756c61732256810f18d7/mail/components/addrbook/content/addressbook.js">annotate</a> |
<a href="/comm-central/diff/6d3320934b32ca12c389756c61732256810f18d7/mail/components/addrbook/content/addressbook.js">diff</a> |
<a href="/comm-central/comparison/6d3320934b32ca12c389756c61732256810f18d7/mail/components/addrbook/content/addressbook.js">comparison</a> |
<a href="/comm-central/log/6d3320934b32ca12c389756c61732256810f18d7/mail/components/addrbook/content/addressbook.js">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/6d3320934b32ca12c389756c61732256810f18d7/mail/components/cloudfile/cloudFileAccounts.js">mail/components/cloudfile/cloudFileAccounts.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/6d3320934b32ca12c389756c61732256810f18d7/mail/components/cloudfile/cloudFileAccounts.js">file</a> |
<a href="/comm-central/annotate/6d3320934b32ca12c389756c61732256810f18d7/mail/components/cloudfile/cloudFileAccounts.js">annotate</a> |
<a href="/comm-central/diff/6d3320934b32ca12c389756c61732256810f18d7/mail/components/cloudfile/cloudFileAccounts.js">diff</a> |
<a href="/comm-central/comparison/6d3320934b32ca12c389756c61732256810f18d7/mail/components/cloudfile/cloudFileAccounts.js">comparison</a> |
<a href="/comm-central/log/6d3320934b32ca12c389756c61732256810f18d7/mail/components/cloudfile/cloudFileAccounts.js">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/6d3320934b32ca12c389756c61732256810f18d7/mail/components/cloudfile/nsHightail.js">mail/components/cloudfile/nsHightail.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/6d3320934b32ca12c389756c61732256810f18d7/mail/components/cloudfile/nsHightail.js">file</a> |
<a href="/comm-central/annotate/6d3320934b32ca12c389756c61732256810f18d7/mail/components/cloudfile/nsHightail.js">annotate</a> |
<a href="/comm-central/diff/6d3320934b32ca12c389756c61732256810f18d7/mail/components/cloudfile/nsHightail.js">diff</a> |
<a href="/comm-central/comparison/6d3320934b32ca12c389756c61732256810f18d7/mail/components/cloudfile/nsHightail.js">comparison</a> |
<a href="/comm-central/log/6d3320934b32ca12c389756c61732256810f18d7/mail/components/cloudfile/nsHightail.js">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/6d3320934b32ca12c389756c61732256810f18d7/mail/components/compose/content/MsgComposeCommands.js">mail/components/compose/content/MsgComposeCommands.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/6d3320934b32ca12c389756c61732256810f18d7/mail/components/compose/content/MsgComposeCommands.js">file</a> |
<a href="/comm-central/annotate/6d3320934b32ca12c389756c61732256810f18d7/mail/components/compose/content/MsgComposeCommands.js">annotate</a> |
<a href="/comm-central/diff/6d3320934b32ca12c389756c61732256810f18d7/mail/components/compose/content/MsgComposeCommands.js">diff</a> |
<a href="/comm-central/comparison/6d3320934b32ca12c389756c61732256810f18d7/mail/components/compose/content/MsgComposeCommands.js">comparison</a> |
<a href="/comm-central/log/6d3320934b32ca12c389756c61732256810f18d7/mail/components/compose/content/MsgComposeCommands.js">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/6d3320934b32ca12c389756c61732256810f18d7/mail/components/compose/content/bigFileObserver.js">mail/components/compose/content/bigFileObserver.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/6d3320934b32ca12c389756c61732256810f18d7/mail/components/compose/content/bigFileObserver.js">file</a> |
<a href="/comm-central/annotate/6d3320934b32ca12c389756c61732256810f18d7/mail/components/compose/content/bigFileObserver.js">annotate</a> |
<a href="/comm-central/diff/6d3320934b32ca12c389756c61732256810f18d7/mail/components/compose/content/bigFileObserver.js">diff</a> |
<a href="/comm-central/comparison/6d3320934b32ca12c389756c61732256810f18d7/mail/components/compose/content/bigFileObserver.js">comparison</a> |
<a href="/comm-central/log/6d3320934b32ca12c389756c61732256810f18d7/mail/components/compose/content/bigFileObserver.js">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/6d3320934b32ca12c389756c61732256810f18d7/mail/components/compose/content/cloudAttachmentLinkManager.js">mail/components/compose/content/cloudAttachmentLinkManager.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/6d3320934b32ca12c389756c61732256810f18d7/mail/components/compose/content/cloudAttachmentLinkManager.js">file</a> |
<a href="/comm-central/annotate/6d3320934b32ca12c389756c61732256810f18d7/mail/components/compose/content/cloudAttachmentLinkManager.js">annotate</a> |
<a href="/comm-central/diff/6d3320934b32ca12c389756c61732256810f18d7/mail/components/compose/content/cloudAttachmentLinkManager.js">diff</a> |
<a href="/comm-central/comparison/6d3320934b32ca12c389756c61732256810f18d7/mail/components/compose/content/cloudAttachmentLinkManager.js">comparison</a> |
<a href="/comm-central/log/6d3320934b32ca12c389756c61732256810f18d7/mail/components/compose/content/cloudAttachmentLinkManager.js">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/6d3320934b32ca12c389756c61732256810f18d7/mail/components/im/content/chat-messenger-overlay.js">mail/components/im/content/chat-messenger-overlay.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/6d3320934b32ca12c389756c61732256810f18d7/mail/components/im/content/chat-messenger-overlay.js">file</a> |
<a href="/comm-central/annotate/6d3320934b32ca12c389756c61732256810f18d7/mail/components/im/content/chat-messenger-overlay.js">annotate</a> |
<a href="/comm-central/diff/6d3320934b32ca12c389756c61732256810f18d7/mail/components/im/content/chat-messenger-overlay.js">diff</a> |
<a href="/comm-central/comparison/6d3320934b32ca12c389756c61732256810f18d7/mail/components/im/content/chat-messenger-overlay.js">comparison</a> |
<a href="/comm-central/log/6d3320934b32ca12c389756c61732256810f18d7/mail/components/im/content/chat-messenger-overlay.js">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/6d3320934b32ca12c389756c61732256810f18d7/mail/components/im/content/imAccounts.js">mail/components/im/content/imAccounts.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/6d3320934b32ca12c389756c61732256810f18d7/mail/components/im/content/imAccounts.js">file</a> |
<a href="/comm-central/annotate/6d3320934b32ca12c389756c61732256810f18d7/mail/components/im/content/imAccounts.js">annotate</a> |
<a href="/comm-central/diff/6d3320934b32ca12c389756c61732256810f18d7/mail/components/im/content/imAccounts.js">diff</a> |
<a href="/comm-central/comparison/6d3320934b32ca12c389756c61732256810f18d7/mail/components/im/content/imAccounts.js">comparison</a> |
<a href="/comm-central/log/6d3320934b32ca12c389756c61732256810f18d7/mail/components/im/content/imAccounts.js">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/6d3320934b32ca12c389756c61732256810f18d7/mail/components/im/content/imContextMenu.js">mail/components/im/content/imContextMenu.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/6d3320934b32ca12c389756c61732256810f18d7/mail/components/im/content/imContextMenu.js">file</a> |
<a href="/comm-central/annotate/6d3320934b32ca12c389756c61732256810f18d7/mail/components/im/content/imContextMenu.js">annotate</a> |
<a href="/comm-central/diff/6d3320934b32ca12c389756c61732256810f18d7/mail/components/im/content/imContextMenu.js">diff</a> |
<a href="/comm-central/comparison/6d3320934b32ca12c389756c61732256810f18d7/mail/components/im/content/imContextMenu.js">comparison</a> |
<a href="/comm-central/log/6d3320934b32ca12c389756c61732256810f18d7/mail/components/im/content/imContextMenu.js">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/6d3320934b32ca12c389756c61732256810f18d7/mail/components/im/content/imStatusSelector.js">mail/components/im/content/imStatusSelector.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/6d3320934b32ca12c389756c61732256810f18d7/mail/components/im/content/imStatusSelector.js">file</a> |
<a href="/comm-central/annotate/6d3320934b32ca12c389756c61732256810f18d7/mail/components/im/content/imStatusSelector.js">annotate</a> |
<a href="/comm-central/diff/6d3320934b32ca12c389756c61732256810f18d7/mail/components/im/content/imStatusSelector.js">diff</a> |
<a href="/comm-central/comparison/6d3320934b32ca12c389756c61732256810f18d7/mail/components/im/content/imStatusSelector.js">comparison</a> |
<a href="/comm-central/log/6d3320934b32ca12c389756c61732256810f18d7/mail/components/im/content/imStatusSelector.js">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/6d3320934b32ca12c389756c61732256810f18d7/mail/components/im/content/imconversation.xml">mail/components/im/content/imconversation.xml</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/6d3320934b32ca12c389756c61732256810f18d7/mail/components/im/content/imconversation.xml">file</a> |
<a href="/comm-central/annotate/6d3320934b32ca12c389756c61732256810f18d7/mail/components/im/content/imconversation.xml">annotate</a> |
<a href="/comm-central/diff/6d3320934b32ca12c389756c61732256810f18d7/mail/components/im/content/imconversation.xml">diff</a> |
<a href="/comm-central/comparison/6d3320934b32ca12c389756c61732256810f18d7/mail/components/im/content/imconversation.xml">comparison</a> |
<a href="/comm-central/log/6d3320934b32ca12c389756c61732256810f18d7/mail/components/im/content/imconversation.xml">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/6d3320934b32ca12c389756c61732256810f18d7/mail/components/im/content/imgroup.xml">mail/components/im/content/imgroup.xml</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/6d3320934b32ca12c389756c61732256810f18d7/mail/components/im/content/imgroup.xml">file</a> |
<a href="/comm-central/annotate/6d3320934b32ca12c389756c61732256810f18d7/mail/components/im/content/imgroup.xml">annotate</a> |
<a href="/comm-central/diff/6d3320934b32ca12c389756c61732256810f18d7/mail/components/im/content/imgroup.xml">diff</a> |
<a href="/comm-central/comparison/6d3320934b32ca12c389756c61732256810f18d7/mail/components/im/content/imgroup.xml">comparison</a> |
<a href="/comm-central/log/6d3320934b32ca12c389756c61732256810f18d7/mail/components/im/content/imgroup.xml">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/6d3320934b32ca12c389756c61732256810f18d7/mail/components/im/content/joinchat.js">mail/components/im/content/joinchat.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/6d3320934b32ca12c389756c61732256810f18d7/mail/components/im/content/joinchat.js">file</a> |
<a href="/comm-central/annotate/6d3320934b32ca12c389756c61732256810f18d7/mail/components/im/content/joinchat.js">annotate</a> |
<a href="/comm-central/diff/6d3320934b32ca12c389756c61732256810f18d7/mail/components/im/content/joinchat.js">diff</a> |
<a href="/comm-central/comparison/6d3320934b32ca12c389756c61732256810f18d7/mail/components/im/content/joinchat.js">comparison</a> |
<a href="/comm-central/log/6d3320934b32ca12c389756c61732256810f18d7/mail/components/im/content/joinchat.js">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/6d3320934b32ca12c389756c61732256810f18d7/mail/components/im/modules/chatHandler.jsm">mail/components/im/modules/chatHandler.jsm</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/6d3320934b32ca12c389756c61732256810f18d7/mail/components/im/modules/chatHandler.jsm">file</a> |
<a href="/comm-central/annotate/6d3320934b32ca12c389756c61732256810f18d7/mail/components/im/modules/chatHandler.jsm">annotate</a> |
<a href="/comm-central/diff/6d3320934b32ca12c389756c61732256810f18d7/mail/components/im/modules/chatHandler.jsm">diff</a> |
<a href="/comm-central/comparison/6d3320934b32ca12c389756c61732256810f18d7/mail/components/im/modules/chatHandler.jsm">comparison</a> |
<a href="/comm-central/log/6d3320934b32ca12c389756c61732256810f18d7/mail/components/im/modules/chatHandler.jsm">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/6d3320934b32ca12c389756c61732256810f18d7/mail/components/im/modules/search_im.js">mail/components/im/modules/search_im.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/6d3320934b32ca12c389756c61732256810f18d7/mail/components/im/modules/search_im.js">file</a> |
<a href="/comm-central/annotate/6d3320934b32ca12c389756c61732256810f18d7/mail/components/im/modules/search_im.js">annotate</a> |
<a href="/comm-central/diff/6d3320934b32ca12c389756c61732256810f18d7/mail/components/im/modules/search_im.js">diff</a> |
<a href="/comm-central/comparison/6d3320934b32ca12c389756c61732256810f18d7/mail/components/im/modules/search_im.js">comparison</a> |
<a href="/comm-central/log/6d3320934b32ca12c389756c61732256810f18d7/mail/components/im/modules/search_im.js">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/6d3320934b32ca12c389756c61732256810f18d7/mail/components/preferences/applications.js">mail/components/preferences/applications.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/6d3320934b32ca12c389756c61732256810f18d7/mail/components/preferences/applications.js">file</a> |
<a href="/comm-central/annotate/6d3320934b32ca12c389756c61732256810f18d7/mail/components/preferences/applications.js">annotate</a> |
<a href="/comm-central/diff/6d3320934b32ca12c389756c61732256810f18d7/mail/components/preferences/applications.js">diff</a> |
<a href="/comm-central/comparison/6d3320934b32ca12c389756c61732256810f18d7/mail/components/preferences/applications.js">comparison</a> |
<a href="/comm-central/log/6d3320934b32ca12c389756c61732256810f18d7/mail/components/preferences/applications.js">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/6d3320934b32ca12c389756c61732256810f18d7/mail/test/mozmill/attachment/test-attachment-menus.js">mail/test/mozmill/attachment/test-attachment-menus.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/6d3320934b32ca12c389756c61732256810f18d7/mail/test/mozmill/attachment/test-attachment-menus.js">file</a> |
<a href="/comm-central/annotate/6d3320934b32ca12c389756c61732256810f18d7/mail/test/mozmill/attachment/test-attachment-menus.js">annotate</a> |
<a href="/comm-central/diff/6d3320934b32ca12c389756c61732256810f18d7/mail/test/mozmill/attachment/test-attachment-menus.js">diff</a> |
<a href="/comm-central/comparison/6d3320934b32ca12c389756c61732256810f18d7/mail/test/mozmill/attachment/test-attachment-menus.js">comparison</a> |
<a href="/comm-central/log/6d3320934b32ca12c389756c61732256810f18d7/mail/test/mozmill/attachment/test-attachment-menus.js">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/6d3320934b32ca12c389756c61732256810f18d7/mail/test/mozmill/attachment/test-attachment-size.js">mail/test/mozmill/attachment/test-attachment-size.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/6d3320934b32ca12c389756c61732256810f18d7/mail/test/mozmill/attachment/test-attachment-size.js">file</a> |
<a href="/comm-central/annotate/6d3320934b32ca12c389756c61732256810f18d7/mail/test/mozmill/attachment/test-attachment-size.js">annotate</a> |
<a href="/comm-central/diff/6d3320934b32ca12c389756c61732256810f18d7/mail/test/mozmill/attachment/test-attachment-size.js">diff</a> |
<a href="/comm-central/comparison/6d3320934b32ca12c389756c61732256810f18d7/mail/test/mozmill/attachment/test-attachment-size.js">comparison</a> |
<a href="/comm-central/log/6d3320934b32ca12c389756c61732256810f18d7/mail/test/mozmill/attachment/test-attachment-size.js">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/6d3320934b32ca12c389756c61732256810f18d7/mail/test/mozmill/cloudfile/test-cloudfile-backend-hightail.js">mail/test/mozmill/cloudfile/test-cloudfile-backend-hightail.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/6d3320934b32ca12c389756c61732256810f18d7/mail/test/mozmill/cloudfile/test-cloudfile-backend-hightail.js">file</a> |
<a href="/comm-central/annotate/6d3320934b32ca12c389756c61732256810f18d7/mail/test/mozmill/cloudfile/test-cloudfile-backend-hightail.js">annotate</a> |
<a href="/comm-central/diff/6d3320934b32ca12c389756c61732256810f18d7/mail/test/mozmill/cloudfile/test-cloudfile-backend-hightail.js">diff</a> |
<a href="/comm-central/comparison/6d3320934b32ca12c389756c61732256810f18d7/mail/test/mozmill/cloudfile/test-cloudfile-backend-hightail.js">comparison</a> |
<a href="/comm-central/log/6d3320934b32ca12c389756c61732256810f18d7/mail/test/mozmill/cloudfile/test-cloudfile-backend-hightail.js">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/6d3320934b32ca12c389756c61732256810f18d7/mail/test/mozmill/cloudfile/test-cloudfile-notifications.js">mail/test/mozmill/cloudfile/test-cloudfile-notifications.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/6d3320934b32ca12c389756c61732256810f18d7/mail/test/mozmill/cloudfile/test-cloudfile-notifications.js">file</a> |
<a href="/comm-central/annotate/6d3320934b32ca12c389756c61732256810f18d7/mail/test/mozmill/cloudfile/test-cloudfile-notifications.js">annotate</a> |
<a href="/comm-central/diff/6d3320934b32ca12c389756c61732256810f18d7/mail/test/mozmill/cloudfile/test-cloudfile-notifications.js">diff</a> |
<a href="/comm-central/comparison/6d3320934b32ca12c389756c61732256810f18d7/mail/test/mozmill/cloudfile/test-cloudfile-notifications.js">comparison</a> |
<a href="/comm-central/log/6d3320934b32ca12c389756c61732256810f18d7/mail/test/mozmill/cloudfile/test-cloudfile-notifications.js">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/6d3320934b32ca12c389756c61732256810f18d7/mail/test/mozmill/folder-display/test-folder-pane-visibility.js">mail/test/mozmill/folder-display/test-folder-pane-visibility.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/6d3320934b32ca12c389756c61732256810f18d7/mail/test/mozmill/folder-display/test-folder-pane-visibility.js">file</a> |
<a href="/comm-central/annotate/6d3320934b32ca12c389756c61732256810f18d7/mail/test/mozmill/folder-display/test-folder-pane-visibility.js">annotate</a> |
<a href="/comm-central/diff/6d3320934b32ca12c389756c61732256810f18d7/mail/test/mozmill/folder-display/test-folder-pane-visibility.js">diff</a> |
<a href="/comm-central/comparison/6d3320934b32ca12c389756c61732256810f18d7/mail/test/mozmill/folder-display/test-folder-pane-visibility.js">comparison</a> |
<a href="/comm-central/log/6d3320934b32ca12c389756c61732256810f18d7/mail/test/mozmill/folder-display/test-folder-pane-visibility.js">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/6d3320934b32ca12c389756c61732256810f18d7/mail/test/mozmill/folder-display/test-message-pane-visibility.js">mail/test/mozmill/folder-display/test-message-pane-visibility.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/6d3320934b32ca12c389756c61732256810f18d7/mail/test/mozmill/folder-display/test-message-pane-visibility.js">file</a> |
<a href="/comm-central/annotate/6d3320934b32ca12c389756c61732256810f18d7/mail/test/mozmill/folder-display/test-message-pane-visibility.js">annotate</a> |
<a href="/comm-central/diff/6d3320934b32ca12c389756c61732256810f18d7/mail/test/mozmill/folder-display/test-message-pane-visibility.js">diff</a> |
<a href="/comm-central/comparison/6d3320934b32ca12c389756c61732256810f18d7/mail/test/mozmill/folder-display/test-message-pane-visibility.js">comparison</a> |
<a href="/comm-central/log/6d3320934b32ca12c389756c61732256810f18d7/mail/test/mozmill/folder-display/test-message-pane-visibility.js">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/6d3320934b32ca12c389756c61732256810f18d7/mail/test/mozmill/folder-display/test-right-click-middle-click-folders.js">mail/test/mozmill/folder-display/test-right-click-middle-click-folders.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/6d3320934b32ca12c389756c61732256810f18d7/mail/test/mozmill/folder-display/test-right-click-middle-click-folders.js">file</a> |
<a href="/comm-central/annotate/6d3320934b32ca12c389756c61732256810f18d7/mail/test/mozmill/folder-display/test-right-click-middle-click-folders.js">annotate</a> |
<a href="/comm-central/diff/6d3320934b32ca12c389756c61732256810f18d7/mail/test/mozmill/folder-display/test-right-click-middle-click-folders.js">diff</a> |
<a href="/comm-central/comparison/6d3320934b32ca12c389756c61732256810f18d7/mail/test/mozmill/folder-display/test-right-click-middle-click-folders.js">comparison</a> |
<a href="/comm-central/log/6d3320934b32ca12c389756c61732256810f18d7/mail/test/mozmill/folder-display/test-right-click-middle-click-folders.js">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/6d3320934b32ca12c389756c61732256810f18d7/mail/test/mozmill/folder-display/test-right-click-middle-click-messages.js">mail/test/mozmill/folder-display/test-right-click-middle-click-messages.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/6d3320934b32ca12c389756c61732256810f18d7/mail/test/mozmill/folder-display/test-right-click-middle-click-messages.js">file</a> |
<a href="/comm-central/annotate/6d3320934b32ca12c389756c61732256810f18d7/mail/test/mozmill/folder-display/test-right-click-middle-click-messages.js">annotate</a> |
<a href="/comm-central/diff/6d3320934b32ca12c389756c61732256810f18d7/mail/test/mozmill/folder-display/test-right-click-middle-click-messages.js">diff</a> |
<a href="/comm-central/comparison/6d3320934b32ca12c389756c61732256810f18d7/mail/test/mozmill/folder-display/test-right-click-middle-click-messages.js">comparison</a> |
<a href="/comm-central/log/6d3320934b32ca12c389756c61732256810f18d7/mail/test/mozmill/folder-display/test-right-click-middle-click-messages.js">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/6d3320934b32ca12c389756c61732256810f18d7/mail/test/mozmill/folder-tree-modes/test-custom-smart-folder.js">mail/test/mozmill/folder-tree-modes/test-custom-smart-folder.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/6d3320934b32ca12c389756c61732256810f18d7/mail/test/mozmill/folder-tree-modes/test-custom-smart-folder.js">file</a> |
<a href="/comm-central/annotate/6d3320934b32ca12c389756c61732256810f18d7/mail/test/mozmill/folder-tree-modes/test-custom-smart-folder.js">annotate</a> |
<a href="/comm-central/diff/6d3320934b32ca12c389756c61732256810f18d7/mail/test/mozmill/folder-tree-modes/test-custom-smart-folder.js">diff</a> |
<a href="/comm-central/comparison/6d3320934b32ca12c389756c61732256810f18d7/mail/test/mozmill/folder-tree-modes/test-custom-smart-folder.js">comparison</a> |
<a href="/comm-central/log/6d3320934b32ca12c389756c61732256810f18d7/mail/test/mozmill/folder-tree-modes/test-custom-smart-folder.js">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/6d3320934b32ca12c389756c61732256810f18d7/mail/test/mozmill/junk-commands/test-junk-commands.js">mail/test/mozmill/junk-commands/test-junk-commands.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/6d3320934b32ca12c389756c61732256810f18d7/mail/test/mozmill/junk-commands/test-junk-commands.js">file</a> |
<a href="/comm-central/annotate/6d3320934b32ca12c389756c61732256810f18d7/mail/test/mozmill/junk-commands/test-junk-commands.js">annotate</a> |
<a href="/comm-central/diff/6d3320934b32ca12c389756c61732256810f18d7/mail/test/mozmill/junk-commands/test-junk-commands.js">diff</a> |
<a href="/comm-central/comparison/6d3320934b32ca12c389756c61732256810f18d7/mail/test/mozmill/junk-commands/test-junk-commands.js">comparison</a> |
<a href="/comm-central/log/6d3320934b32ca12c389756c61732256810f18d7/mail/test/mozmill/junk-commands/test-junk-commands.js">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/6d3320934b32ca12c389756c61732256810f18d7/mail/test/mozmill/notification/test-notification.js">mail/test/mozmill/notification/test-notification.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/6d3320934b32ca12c389756c61732256810f18d7/mail/test/mozmill/notification/test-notification.js">file</a> |
<a href="/comm-central/annotate/6d3320934b32ca12c389756c61732256810f18d7/mail/test/mozmill/notification/test-notification.js">annotate</a> |
<a href="/comm-central/diff/6d3320934b32ca12c389756c61732256810f18d7/mail/test/mozmill/notification/test-notification.js">diff</a> |
<a href="/comm-central/comparison/6d3320934b32ca12c389756c61732256810f18d7/mail/test/mozmill/notification/test-notification.js">comparison</a> |
<a href="/comm-central/log/6d3320934b32ca12c389756c61732256810f18d7/mail/test/mozmill/notification/test-notification.js">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/6d3320934b32ca12c389756c61732256810f18d7/mail/test/mozmill/shared-modules/test-address-book-helpers.js">mail/test/mozmill/shared-modules/test-address-book-helpers.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/6d3320934b32ca12c389756c61732256810f18d7/mail/test/mozmill/shared-modules/test-address-book-helpers.js">file</a> |
<a href="/comm-central/annotate/6d3320934b32ca12c389756c61732256810f18d7/mail/test/mozmill/shared-modules/test-address-book-helpers.js">annotate</a> |
<a href="/comm-central/diff/6d3320934b32ca12c389756c61732256810f18d7/mail/test/mozmill/shared-modules/test-address-book-helpers.js">diff</a> |
<a href="/comm-central/comparison/6d3320934b32ca12c389756c61732256810f18d7/mail/test/mozmill/shared-modules/test-address-book-helpers.js">comparison</a> |
<a href="/comm-central/log/6d3320934b32ca12c389756c61732256810f18d7/mail/test/mozmill/shared-modules/test-address-book-helpers.js">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/6d3320934b32ca12c389756c61732256810f18d7/mail/test/mozmill/shared-modules/test-cloudfile-backend-helpers.js">mail/test/mozmill/shared-modules/test-cloudfile-backend-helpers.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/6d3320934b32ca12c389756c61732256810f18d7/mail/test/mozmill/shared-modules/test-cloudfile-backend-helpers.js">file</a> |
<a href="/comm-central/annotate/6d3320934b32ca12c389756c61732256810f18d7/mail/test/mozmill/shared-modules/test-cloudfile-backend-helpers.js">annotate</a> |
<a href="/comm-central/diff/6d3320934b32ca12c389756c61732256810f18d7/mail/test/mozmill/shared-modules/test-cloudfile-backend-helpers.js">diff</a> |
<a href="/comm-central/comparison/6d3320934b32ca12c389756c61732256810f18d7/mail/test/mozmill/shared-modules/test-cloudfile-backend-helpers.js">comparison</a> |
<a href="/comm-central/log/6d3320934b32ca12c389756c61732256810f18d7/mail/test/mozmill/shared-modules/test-cloudfile-backend-helpers.js">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/6d3320934b32ca12c389756c61732256810f18d7/mail/test/mozmill/shared-modules/test-cloudfile-helpers.js">mail/test/mozmill/shared-modules/test-cloudfile-helpers.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/6d3320934b32ca12c389756c61732256810f18d7/mail/test/mozmill/shared-modules/test-cloudfile-helpers.js">file</a> |
<a href="/comm-central/annotate/6d3320934b32ca12c389756c61732256810f18d7/mail/test/mozmill/shared-modules/test-cloudfile-helpers.js">annotate</a> |
<a href="/comm-central/diff/6d3320934b32ca12c389756c61732256810f18d7/mail/test/mozmill/shared-modules/test-cloudfile-helpers.js">diff</a> |
<a href="/comm-central/comparison/6d3320934b32ca12c389756c61732256810f18d7/mail/test/mozmill/shared-modules/test-cloudfile-helpers.js">comparison</a> |
<a href="/comm-central/log/6d3320934b32ca12c389756c61732256810f18d7/mail/test/mozmill/shared-modules/test-cloudfile-helpers.js">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/6d3320934b32ca12c389756c61732256810f18d7/mail/test/mozmill/shared-modules/test-compose-helpers.js">mail/test/mozmill/shared-modules/test-compose-helpers.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/6d3320934b32ca12c389756c61732256810f18d7/mail/test/mozmill/shared-modules/test-compose-helpers.js">file</a> |
<a href="/comm-central/annotate/6d3320934b32ca12c389756c61732256810f18d7/mail/test/mozmill/shared-modules/test-compose-helpers.js">annotate</a> |
<a href="/comm-central/diff/6d3320934b32ca12c389756c61732256810f18d7/mail/test/mozmill/shared-modules/test-compose-helpers.js">diff</a> |
<a href="/comm-central/comparison/6d3320934b32ca12c389756c61732256810f18d7/mail/test/mozmill/shared-modules/test-compose-helpers.js">comparison</a> |
<a href="/comm-central/log/6d3320934b32ca12c389756c61732256810f18d7/mail/test/mozmill/shared-modules/test-compose-helpers.js">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/6d3320934b32ca12c389756c61732256810f18d7/mail/test/mozmill/shared-modules/test-folder-display-helpers.js">mail/test/mozmill/shared-modules/test-folder-display-helpers.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/6d3320934b32ca12c389756c61732256810f18d7/mail/test/mozmill/shared-modules/test-folder-display-helpers.js">file</a> |
<a href="/comm-central/annotate/6d3320934b32ca12c389756c61732256810f18d7/mail/test/mozmill/shared-modules/test-folder-display-helpers.js">annotate</a> |
<a href="/comm-central/diff/6d3320934b32ca12c389756c61732256810f18d7/mail/test/mozmill/shared-modules/test-folder-display-helpers.js">diff</a> |
<a href="/comm-central/comparison/6d3320934b32ca12c389756c61732256810f18d7/mail/test/mozmill/shared-modules/test-folder-display-helpers.js">comparison</a> |
<a href="/comm-central/log/6d3320934b32ca12c389756c61732256810f18d7/mail/test/mozmill/shared-modules/test-folder-display-helpers.js">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/6d3320934b32ca12c389756c61732256810f18d7/mail/test/mozmill/shared-modules/test-quick-filter-bar-helper.js">mail/test/mozmill/shared-modules/test-quick-filter-bar-helper.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/6d3320934b32ca12c389756c61732256810f18d7/mail/test/mozmill/shared-modules/test-quick-filter-bar-helper.js">file</a> |
<a href="/comm-central/annotate/6d3320934b32ca12c389756c61732256810f18d7/mail/test/mozmill/shared-modules/test-quick-filter-bar-helper.js">annotate</a> |
<a href="/comm-central/diff/6d3320934b32ca12c389756c61732256810f18d7/mail/test/mozmill/shared-modules/test-quick-filter-bar-helper.js">diff</a> |
<a href="/comm-central/comparison/6d3320934b32ca12c389756c61732256810f18d7/mail/test/mozmill/shared-modules/test-quick-filter-bar-helper.js">comparison</a> |
<a href="/comm-central/log/6d3320934b32ca12c389756c61732256810f18d7/mail/test/mozmill/shared-modules/test-quick-filter-bar-helper.js">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/6d3320934b32ca12c389756c61732256810f18d7/mail/test/mozmill/shared-modules/test-window-helpers.js">mail/test/mozmill/shared-modules/test-window-helpers.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/6d3320934b32ca12c389756c61732256810f18d7/mail/test/mozmill/shared-modules/test-window-helpers.js">file</a> |
<a href="/comm-central/annotate/6d3320934b32ca12c389756c61732256810f18d7/mail/test/mozmill/shared-modules/test-window-helpers.js">annotate</a> |
<a href="/comm-central/diff/6d3320934b32ca12c389756c61732256810f18d7/mail/test/mozmill/shared-modules/test-window-helpers.js">diff</a> |
<a href="/comm-central/comparison/6d3320934b32ca12c389756c61732256810f18d7/mail/test/mozmill/shared-modules/test-window-helpers.js">comparison</a> |
<a href="/comm-central/log/6d3320934b32ca12c389756c61732256810f18d7/mail/test/mozmill/shared-modules/test-window-helpers.js">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/6d3320934b32ca12c389756c61732256810f18d7/mail/test/resources/jsbridge/jsbridge/extension/resource/modules/events.js">mail/test/resources/jsbridge/jsbridge/extension/resource/modules/events.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/6d3320934b32ca12c389756c61732256810f18d7/mail/test/resources/jsbridge/jsbridge/extension/resource/modules/events.js">file</a> |
<a href="/comm-central/annotate/6d3320934b32ca12c389756c61732256810f18d7/mail/test/resources/jsbridge/jsbridge/extension/resource/modules/events.js">annotate</a> |
<a href="/comm-central/diff/6d3320934b32ca12c389756c61732256810f18d7/mail/test/resources/jsbridge/jsbridge/extension/resource/modules/events.js">diff</a> |
<a href="/comm-central/comparison/6d3320934b32ca12c389756c61732256810f18d7/mail/test/resources/jsbridge/jsbridge/extension/resource/modules/events.js">comparison</a> |
<a href="/comm-central/log/6d3320934b32ca12c389756c61732256810f18d7/mail/test/resources/jsbridge/jsbridge/extension/resource/modules/events.js">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/6d3320934b32ca12c389756c61732256810f18d7/mail/test/resources/mozmill/mozmill/extension/content/chrome.js">mail/test/resources/mozmill/mozmill/extension/content/chrome.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/6d3320934b32ca12c389756c61732256810f18d7/mail/test/resources/mozmill/mozmill/extension/content/chrome.js">file</a> |
<a href="/comm-central/annotate/6d3320934b32ca12c389756c61732256810f18d7/mail/test/resources/mozmill/mozmill/extension/content/chrome.js">annotate</a> |
<a href="/comm-central/diff/6d3320934b32ca12c389756c61732256810f18d7/mail/test/resources/mozmill/mozmill/extension/content/chrome.js">diff</a> |
<a href="/comm-central/comparison/6d3320934b32ca12c389756c61732256810f18d7/mail/test/resources/mozmill/mozmill/extension/content/chrome.js">comparison</a> |
<a href="/comm-central/log/6d3320934b32ca12c389756c61732256810f18d7/mail/test/resources/mozmill/mozmill/extension/content/chrome.js">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/6d3320934b32ca12c389756c61732256810f18d7/mail/test/resources/mozmill/mozmill/extension/content/dx.js">mail/test/resources/mozmill/mozmill/extension/content/dx.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/6d3320934b32ca12c389756c61732256810f18d7/mail/test/resources/mozmill/mozmill/extension/content/dx.js">file</a> |
<a href="/comm-central/annotate/6d3320934b32ca12c389756c61732256810f18d7/mail/test/resources/mozmill/mozmill/extension/content/dx.js">annotate</a> |
<a href="/comm-central/diff/6d3320934b32ca12c389756c61732256810f18d7/mail/test/resources/mozmill/mozmill/extension/content/dx.js">diff</a> |
<a href="/comm-central/comparison/6d3320934b32ca12c389756c61732256810f18d7/mail/test/resources/mozmill/mozmill/extension/content/dx.js">comparison</a> |
<a href="/comm-central/log/6d3320934b32ca12c389756c61732256810f18d7/mail/test/resources/mozmill/mozmill/extension/content/dx.js">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/6d3320934b32ca12c389756c61732256810f18d7/mail/test/resources/mozmill/mozmill/extension/content/rec.js">mail/test/resources/mozmill/mozmill/extension/content/rec.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/6d3320934b32ca12c389756c61732256810f18d7/mail/test/resources/mozmill/mozmill/extension/content/rec.js">file</a> |
<a href="/comm-central/annotate/6d3320934b32ca12c389756c61732256810f18d7/mail/test/resources/mozmill/mozmill/extension/content/rec.js">annotate</a> |
<a href="/comm-central/diff/6d3320934b32ca12c389756c61732256810f18d7/mail/test/resources/mozmill/mozmill/extension/content/rec.js">diff</a> |
<a href="/comm-central/comparison/6d3320934b32ca12c389756c61732256810f18d7/mail/test/resources/mozmill/mozmill/extension/content/rec.js">comparison</a> |
<a href="/comm-central/log/6d3320934b32ca12c389756c61732256810f18d7/mail/test/resources/mozmill/mozmill/extension/content/rec.js">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/6d3320934b32ca12c389756c61732256810f18d7/mail/test/resources/mozmill/mozmill/extension/resource/modules/controller.js">mail/test/resources/mozmill/mozmill/extension/resource/modules/controller.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/6d3320934b32ca12c389756c61732256810f18d7/mail/test/resources/mozmill/mozmill/extension/resource/modules/controller.js">file</a> |
<a href="/comm-central/annotate/6d3320934b32ca12c389756c61732256810f18d7/mail/test/resources/mozmill/mozmill/extension/resource/modules/controller.js">annotate</a> |
<a href="/comm-central/diff/6d3320934b32ca12c389756c61732256810f18d7/mail/test/resources/mozmill/mozmill/extension/resource/modules/controller.js">diff</a> |
<a href="/comm-central/comparison/6d3320934b32ca12c389756c61732256810f18d7/mail/test/resources/mozmill/mozmill/extension/resource/modules/controller.js">comparison</a> |
<a href="/comm-central/log/6d3320934b32ca12c389756c61732256810f18d7/mail/test/resources/mozmill/mozmill/extension/resource/modules/controller.js">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/6d3320934b32ca12c389756c61732256810f18d7/mail/test/resources/mozmill/mozmill/extension/resource/modules/elementslib.js">mail/test/resources/mozmill/mozmill/extension/resource/modules/elementslib.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/6d3320934b32ca12c389756c61732256810f18d7/mail/test/resources/mozmill/mozmill/extension/resource/modules/elementslib.js">file</a> |
<a href="/comm-central/annotate/6d3320934b32ca12c389756c61732256810f18d7/mail/test/resources/mozmill/mozmill/extension/resource/modules/elementslib.js">annotate</a> |
<a href="/comm-central/diff/6d3320934b32ca12c389756c61732256810f18d7/mail/test/resources/mozmill/mozmill/extension/resource/modules/elementslib.js">diff</a> |
<a href="/comm-central/comparison/6d3320934b32ca12c389756c61732256810f18d7/mail/test/resources/mozmill/mozmill/extension/resource/modules/elementslib.js">comparison</a> |
<a href="/comm-central/log/6d3320934b32ca12c389756c61732256810f18d7/mail/test/resources/mozmill/mozmill/extension/resource/modules/elementslib.js">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/6d3320934b32ca12c389756c61732256810f18d7/mail/test/resources/mozmill/mozmill/extension/resource/modules/frame.js">mail/test/resources/mozmill/mozmill/extension/resource/modules/frame.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/6d3320934b32ca12c389756c61732256810f18d7/mail/test/resources/mozmill/mozmill/extension/resource/modules/frame.js">file</a> |
<a href="/comm-central/annotate/6d3320934b32ca12c389756c61732256810f18d7/mail/test/resources/mozmill/mozmill/extension/resource/modules/frame.js">annotate</a> |
<a href="/comm-central/diff/6d3320934b32ca12c389756c61732256810f18d7/mail/test/resources/mozmill/mozmill/extension/resource/modules/frame.js">diff</a> |
<a href="/comm-central/comparison/6d3320934b32ca12c389756c61732256810f18d7/mail/test/resources/mozmill/mozmill/extension/resource/modules/frame.js">comparison</a> |
<a href="/comm-central/log/6d3320934b32ca12c389756c61732256810f18d7/mail/test/resources/mozmill/mozmill/extension/resource/modules/frame.js">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/6d3320934b32ca12c389756c61732256810f18d7/mail/test/resources/mozmill/mozmill/extension/resource/modules/inspection.js">mail/test/resources/mozmill/mozmill/extension/resource/modules/inspection.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/6d3320934b32ca12c389756c61732256810f18d7/mail/test/resources/mozmill/mozmill/extension/resource/modules/inspection.js">file</a> |
<a href="/comm-central/annotate/6d3320934b32ca12c389756c61732256810f18d7/mail/test/resources/mozmill/mozmill/extension/resource/modules/inspection.js">annotate</a> |
<a href="/comm-central/diff/6d3320934b32ca12c389756c61732256810f18d7/mail/test/resources/mozmill/mozmill/extension/resource/modules/inspection.js">diff</a> |
<a href="/comm-central/comparison/6d3320934b32ca12c389756c61732256810f18d7/mail/test/resources/mozmill/mozmill/extension/resource/modules/inspection.js">comparison</a> |
<a href="/comm-central/log/6d3320934b32ca12c389756c61732256810f18d7/mail/test/resources/mozmill/mozmill/extension/resource/modules/inspection.js">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/6d3320934b32ca12c389756c61732256810f18d7/mail/test/resources/mozmill/mozmill/extension/resource/modules/utils.js">mail/test/resources/mozmill/mozmill/extension/resource/modules/utils.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/6d3320934b32ca12c389756c61732256810f18d7/mail/test/resources/mozmill/mozmill/extension/resource/modules/utils.js">file</a> |
<a href="/comm-central/annotate/6d3320934b32ca12c389756c61732256810f18d7/mail/test/resources/mozmill/mozmill/extension/resource/modules/utils.js">annotate</a> |
<a href="/comm-central/diff/6d3320934b32ca12c389756c61732256810f18d7/mail/test/resources/mozmill/mozmill/extension/resource/modules/utils.js">diff</a> |
<a href="/comm-central/comparison/6d3320934b32ca12c389756c61732256810f18d7/mail/test/resources/mozmill/mozmill/extension/resource/modules/utils.js">comparison</a> |
<a href="/comm-central/log/6d3320934b32ca12c389756c61732256810f18d7/mail/test/resources/mozmill/mozmill/extension/resource/modules/utils.js">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/6d3320934b32ca12c389756c61732256810f18d7/mail/test/resources/mozmill/mozmill/extension/resource/stdlib/os.js">mail/test/resources/mozmill/mozmill/extension/resource/stdlib/os.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/6d3320934b32ca12c389756c61732256810f18d7/mail/test/resources/mozmill/mozmill/extension/resource/stdlib/os.js">file</a> |
<a href="/comm-central/annotate/6d3320934b32ca12c389756c61732256810f18d7/mail/test/resources/mozmill/mozmill/extension/resource/stdlib/os.js">annotate</a> |
<a href="/comm-central/diff/6d3320934b32ca12c389756c61732256810f18d7/mail/test/resources/mozmill/mozmill/extension/resource/stdlib/os.js">diff</a> |
<a href="/comm-central/comparison/6d3320934b32ca12c389756c61732256810f18d7/mail/test/resources/mozmill/mozmill/extension/resource/stdlib/os.js">comparison</a> |
<a href="/comm-central/log/6d3320934b32ca12c389756c61732256810f18d7/mail/test/resources/mozmill/mozmill/extension/resource/stdlib/os.js">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/6d3320934b32ca12c389756c61732256810f18d7/mail/test/resources/mozmill/mozmill/extension/resource/stdlib/securable-module.js">mail/test/resources/mozmill/mozmill/extension/resource/stdlib/securable-module.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/6d3320934b32ca12c389756c61732256810f18d7/mail/test/resources/mozmill/mozmill/extension/resource/stdlib/securable-module.js">file</a> |
<a href="/comm-central/annotate/6d3320934b32ca12c389756c61732256810f18d7/mail/test/resources/mozmill/mozmill/extension/resource/stdlib/securable-module.js">annotate</a> |
<a href="/comm-central/diff/6d3320934b32ca12c389756c61732256810f18d7/mail/test/resources/mozmill/mozmill/extension/resource/stdlib/securable-module.js">diff</a> |
<a href="/comm-central/comparison/6d3320934b32ca12c389756c61732256810f18d7/mail/test/resources/mozmill/mozmill/extension/resource/stdlib/securable-module.js">comparison</a> |
<a href="/comm-central/log/6d3320934b32ca12c389756c61732256810f18d7/mail/test/resources/mozmill/mozmill/extension/resource/stdlib/securable-module.js">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/6d3320934b32ca12c389756c61732256810f18d7/mail/test/resources/mozmill/test/test_waitForPageLoad.js">mail/test/resources/mozmill/test/test_waitForPageLoad.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/6d3320934b32ca12c389756c61732256810f18d7/mail/test/resources/mozmill/test/test_waitForPageLoad.js">file</a> |
<a href="/comm-central/annotate/6d3320934b32ca12c389756c61732256810f18d7/mail/test/resources/mozmill/test/test_waitForPageLoad.js">annotate</a> |
<a href="/comm-central/diff/6d3320934b32ca12c389756c61732256810f18d7/mail/test/resources/mozmill/test/test_waitForPageLoad.js">diff</a> |
<a href="/comm-central/comparison/6d3320934b32ca12c389756c61732256810f18d7/mail/test/resources/mozmill/test/test_waitForPageLoad.js">comparison</a> |
<a href="/comm-central/log/6d3320934b32ca12c389756c61732256810f18d7/mail/test/resources/mozmill/test/test_waitForPageLoad.js">revisions</a>
</td>
</tr>
</table></div>

<div class="page_body diffblocks"><div class="diffblock"><pre class="sourcelines">
<a href="#l1.1"></a><span id="l1.1" class="difflineminus">--- a/mail/base/content/folderDisplay.js</span>
<a href="#l1.2"></a><span id="l1.2" class="difflineplus">+++ b/mail/base/content/folderDisplay.js</span>
<a href="#l1.3"></a><span id="l1.3" class="difflineat">@@ -58,17 +58,17 @@ var FolderDisplayListenerManager = {</span>
<a href="#l1.4"></a><span id="l1.4">       this._listeners.splice(idx, 1);</span>
<a href="#l1.5"></a><span id="l1.5">     }</span>
<a href="#l1.6"></a><span id="l1.6">   },</span>
<a href="#l1.7"></a><span id="l1.7"> </span>
<a href="#l1.8"></a><span id="l1.8">   /**</span>
<a href="#l1.9"></a><span id="l1.9">    * For use by FolderDisplayWidget to trigger listener invocation.</span>
<a href="#l1.10"></a><span id="l1.10">    */</span>
<a href="#l1.11"></a><span id="l1.11">   _fireListeners: function FDBLM__fireListeners(aEventName, aArgs) {</span>
<a href="#l1.12"></a><span id="l1.12" class="difflineminus">-    for each (let [, listener] in Iterator(this._listeners)) {</span>
<a href="#l1.13"></a><span id="l1.13" class="difflineplus">+    for (let listener of this._listeners) {</span>
<a href="#l1.14"></a><span id="l1.14">       if (aEventName in listener) {</span>
<a href="#l1.15"></a><span id="l1.15">         try {</span>
<a href="#l1.16"></a><span id="l1.16">           listener[aEventName].apply(listener, aArgs);</span>
<a href="#l1.17"></a><span id="l1.17">         }</span>
<a href="#l1.18"></a><span id="l1.18">         catch(e) {</span>
<a href="#l1.19"></a><span id="l1.19">           Components.utils.reportError(aEventName + &quot; event listener FAILED; &quot; +</span>
<a href="#l1.20"></a><span id="l1.20">                                        e + &quot; at: &quot; + e.stack);</span>
<a href="#l1.21"></a><span id="l1.21">         }</span>
<a href="#l1.22"></a><span id="l1.22" class="difflineat">@@ -308,20 +308,20 @@ FolderDisplayWidget.prototype = {</span>
<a href="#l1.23"></a><span id="l1.23">    * Save the current view selection for when we the view is getting destroyed</span>
<a href="#l1.24"></a><span id="l1.24">    *  or otherwise re-ordered in such a way that the nsITreeSelection will lose</span>
<a href="#l1.25"></a><span id="l1.25">    *  track of things (because it just has a naive view-index 'view' of the</span>
<a href="#l1.26"></a><span id="l1.26">    *  world.)  We just save each message's message-id header.  This is overkill</span>
<a href="#l1.27"></a><span id="l1.27">    *  and ambiguous in the face of duplicate messages (and expensive to</span>
<a href="#l1.28"></a><span id="l1.28">    *  restore), but is also the most reliable option for this use case.</span>
<a href="#l1.29"></a><span id="l1.29">    */</span>
<a href="#l1.30"></a><span id="l1.30">   _saveSelection: function FolderDisplayWidget_saveSelection() {</span>
<a href="#l1.31"></a><span id="l1.31" class="difflineminus">-    this._savedSelection = {messages:</span>
<a href="#l1.32"></a><span id="l1.32" class="difflineminus">-                            [{messageId: msgHdr.messageId} for each</span>
<a href="#l1.33"></a><span id="l1.33" class="difflineminus">-                             ([, msgHdr] in Iterator(this.selectedMessages))],</span>
<a href="#l1.34"></a><span id="l1.34" class="difflineminus">-                            forceSelect: false};</span>
<a href="#l1.35"></a><span id="l1.35" class="difflineplus">+    this._savedSelection = {</span>
<a href="#l1.36"></a><span id="l1.36" class="difflineplus">+      messages: this.selectedMessages.map(msgHdr =&gt; ({messageId: msgHdr.messageId})),</span>
<a href="#l1.37"></a><span id="l1.37" class="difflineplus">+      forceSelect: false</span>
<a href="#l1.38"></a><span id="l1.38" class="difflineplus">+    };</span>
<a href="#l1.39"></a><span id="l1.39">   },</span>
<a href="#l1.40"></a><span id="l1.40"> </span>
<a href="#l1.41"></a><span id="l1.41">   /**</span>
<a href="#l1.42"></a><span id="l1.42">    * Clear the saved selection.</span>
<a href="#l1.43"></a><span id="l1.43">    */</span>
<a href="#l1.44"></a><span id="l1.44">   _clearSavedSelection: function FolderDisplayWidget_clearSavedSelection() {</span>
<a href="#l1.45"></a><span id="l1.45">     this._savedSelection = null;</span>
<a href="#l1.46"></a><span id="l1.46">   },</span>
<a href="#l1.47"></a><span id="l1.47" class="difflineat">@@ -340,19 +340,19 @@ FolderDisplayWidget.prototype = {</span>
<a href="#l1.48"></a><span id="l1.48">     // translate message IDs back to messages.  this is O(s(m+n)) where:</span>
<a href="#l1.49"></a><span id="l1.49">     // - s is the number of messages saved in the selection</span>
<a href="#l1.50"></a><span id="l1.50">     // - m is the number of messages in the view (from findIndexOfMsgHdr)</span>
<a href="#l1.51"></a><span id="l1.51">     // - n is the number of messages in the underlying folders (from</span>
<a href="#l1.52"></a><span id="l1.52">     //   DBViewWrapper.getMsgHdrForMessageID).</span>
<a href="#l1.53"></a><span id="l1.53">     // which ends up being O(sn)</span>
<a href="#l1.54"></a><span id="l1.54">     var msgHdr;</span>
<a href="#l1.55"></a><span id="l1.55">     let messages =</span>
<a href="#l1.56"></a><span id="l1.56" class="difflineminus">-      [msgHdr for each</span>
<a href="#l1.57"></a><span id="l1.57" class="difflineminus">-        ([, savedInfo] in Iterator(this._savedSelection.messages)) if</span>
<a href="#l1.58"></a><span id="l1.58" class="difflineminus">-        ((msgHdr = this.view.getMsgHdrForMessageID(savedInfo.messageId)))];</span>
<a href="#l1.59"></a><span id="l1.59" class="difflineplus">+      this._savedSelection.messages.</span>
<a href="#l1.60"></a><span id="l1.60" class="difflineplus">+      map(savedInfo =&gt; this.view.getMsgHdrForMessageID(savedInfo.messageId)).</span>
<a href="#l1.61"></a><span id="l1.61" class="difflineplus">+      filter(msgHdr =&gt; !!msgHdr);</span>
<a href="#l1.62"></a><span id="l1.62"> </span>
<a href="#l1.63"></a><span id="l1.63">     this.selectMessages(messages, this._savedSelection.forceSelect, true);</span>
<a href="#l1.64"></a><span id="l1.64">     this._savedSelection = null;</span>
<a href="#l1.65"></a><span id="l1.65"> </span>
<a href="#l1.66"></a><span id="l1.66">     return this.selectedCount != 0;</span>
<a href="#l1.67"></a><span id="l1.67">   },</span>
<a href="#l1.68"></a><span id="l1.68"> </span>
<a href="#l1.69"></a><span id="l1.69">   /**</span>
<a href="#l1.70"></a><span id="l1.70" class="difflineat">@@ -1584,17 +1584,17 @@ FolderDisplayWidget.prototype = {</span>
<a href="#l1.71"></a><span id="l1.71">    */</span>
<a href="#l1.72"></a><span id="l1.72">   _runNotificationsPendingActivation:</span>
<a href="#l1.73"></a><span id="l1.73">       function FolderDisplayWidget__runNotificationsPendingActivation() {</span>
<a href="#l1.74"></a><span id="l1.74">     if (!this._notificationsPendingActivation.length)</span>
<a href="#l1.75"></a><span id="l1.75">       return;</span>
<a href="#l1.76"></a><span id="l1.76"> </span>
<a href="#l1.77"></a><span id="l1.77">     let pendingNotifications = this._notificationsPendingActivation;</span>
<a href="#l1.78"></a><span id="l1.78">     this._notificationsPendingActivation = [];</span>
<a href="#l1.79"></a><span id="l1.79" class="difflineminus">-    for each (let [, notif] in Iterator(pendingNotifications)) {</span>
<a href="#l1.80"></a><span id="l1.80" class="difflineplus">+    for (let notif of pendingNotifications) {</span>
<a href="#l1.81"></a><span id="l1.81">       notif.call(this);</span>
<a href="#l1.82"></a><span id="l1.82">     }</span>
<a href="#l1.83"></a><span id="l1.83">   },</span>
<a href="#l1.84"></a><span id="l1.84"> </span>
<a href="#l1.85"></a><span id="l1.85">   /// This is not guaranteed to be up to date if the folder display is active</span>
<a href="#l1.86"></a><span id="l1.86">   _folderPaneVisible: null,</span>
<a href="#l1.87"></a><span id="l1.87"> </span>
<a href="#l1.88"></a><span id="l1.88">   /**</span>
<a href="#l1.89"></a><span id="l1.89" class="difflineat">@@ -2294,17 +2294,17 @@ FolderDisplayWidget.prototype = {</span>
<a href="#l1.90"></a><span id="l1.90">     let treeSelection = this.treeSelection; // potentially magic getter</span>
<a href="#l1.91"></a><span id="l1.91">     let foundAll = true;</span>
<a href="#l1.92"></a><span id="l1.92">     if (treeSelection) {</span>
<a href="#l1.93"></a><span id="l1.93">       let minRow = null, maxRow = null;</span>
<a href="#l1.94"></a><span id="l1.94"> </span>
<a href="#l1.95"></a><span id="l1.95">       treeSelection.selectEventsSuppressed = true;</span>
<a href="#l1.96"></a><span id="l1.96">       treeSelection.clearSelection();</span>
<a href="#l1.97"></a><span id="l1.97"> </span>
<a href="#l1.98"></a><span id="l1.98" class="difflineminus">-      for each (let [, msgHdr] in Iterator(aMessages)) {</span>
<a href="#l1.99"></a><span id="l1.99" class="difflineplus">+      for (let msgHdr of aMessages) {</span>
<a href="#l1.100"></a><span id="l1.100">         let viewIndex = this.view.getViewIndexForMsgHdr(msgHdr, aForceSelect);</span>
<a href="#l1.101"></a><span id="l1.101"> </span>
<a href="#l1.102"></a><span id="l1.102">         if (viewIndex != nsMsgViewIndex_None) {</span>
<a href="#l1.103"></a><span id="l1.103">           if (minRow == null || viewIndex &lt; minRow)</span>
<a href="#l1.104"></a><span id="l1.104">             minRow = viewIndex;</span>
<a href="#l1.105"></a><span id="l1.105">           if (maxRow == null || viewIndex &gt; maxRow )</span>
<a href="#l1.106"></a><span id="l1.106">             maxRow = viewIndex;</span>
<a href="#l1.107"></a><span id="l1.107">           // nsTreeSelection is actually very clever about doing this</span>
<a href="#l1.108"></a><span id="l1.108" class="difflineat">@@ -2330,20 +2330,20 @@ FolderDisplayWidget.prototype = {</span>
<a href="#l1.109"></a><span id="l1.109">     // Do this here instead of at the beginning to prevent reentrancy issues</span>
<a href="#l1.110"></a><span id="l1.110">     this._aboutToSelectMessage = false;</span>
<a href="#l1.111"></a><span id="l1.111"> </span>
<a href="#l1.112"></a><span id="l1.112">     // Two cases.</span>
<a href="#l1.113"></a><span id="l1.113">     // 1. The tree selection isn't there at all.</span>
<a href="#l1.114"></a><span id="l1.114">     // 2. The tree selection is there, and we needed to find all messages, but</span>
<a href="#l1.115"></a><span id="l1.115">     //    we didn't.</span>
<a href="#l1.116"></a><span id="l1.116">     if (!treeSelection || (!aDoNotNeedToFindAll &amp;&amp; !foundAll)) {</span>
<a href="#l1.117"></a><span id="l1.117" class="difflineminus">-      this._savedSelection = {messages:</span>
<a href="#l1.118"></a><span id="l1.118" class="difflineminus">-                              [{messageId: msgHdr.messageId} for each</span>
<a href="#l1.119"></a><span id="l1.119" class="difflineminus">-                              ([, msgHdr] in Iterator(aMessages))],</span>
<a href="#l1.120"></a><span id="l1.120" class="difflineminus">-                              forceSelect: aForceSelect};</span>
<a href="#l1.121"></a><span id="l1.121" class="difflineplus">+      this._savedSelection = {</span>
<a href="#l1.122"></a><span id="l1.122" class="difflineplus">+        messages: aMessages.map(msgHdr =&gt; ({messageId: msgHdr.messageId})),</span>
<a href="#l1.123"></a><span id="l1.123" class="difflineplus">+        forceSelect: aForceSelect</span>
<a href="#l1.124"></a><span id="l1.124" class="difflineplus">+      };</span>
<a href="#l1.125"></a><span id="l1.125">       if (!this.active)</span>
<a href="#l1.126"></a><span id="l1.126">         this._notifyWhenActive(this._restoreSelection);</span>
<a href="#l1.127"></a><span id="l1.127">     }</span>
<a href="#l1.128"></a><span id="l1.128">   },</span>
<a href="#l1.129"></a><span id="l1.129"> </span>
<a href="#l1.130"></a><span id="l1.130">   /**</span>
<a href="#l1.131"></a><span id="l1.131">    * Select the message at view index.</span>
<a href="#l1.132"></a><span id="l1.132">    *</span>
<a href="#l1.133"></a><span id="l1.133" class="difflineat">@@ -2426,17 +2426,17 @@ FolderDisplayWidget.prototype = {</span>
<a href="#l1.134"></a><span id="l1.134">     //    efficiently retrieve the thread root, then find the root using</span>
<a href="#l1.135"></a><span id="l1.135">     //    the message header.  The inefficiency here is that the view</span>
<a href="#l1.136"></a><span id="l1.136">     //    currently does a linear scan, albeit a relatively efficient one.</span>
<a href="#l1.137"></a><span id="l1.137">     // And the winner is... option 2, because the code is simpler because we</span>
<a href="#l1.138"></a><span id="l1.138">     //  can reuse selectMessages to do most of the work.</span>
<a href="#l1.139"></a><span id="l1.139">     let selectedIndices = this.selectedIndices;</span>
<a href="#l1.140"></a><span id="l1.140">     let newSelectedMessages = [];</span>
<a href="#l1.141"></a><span id="l1.141">     let dbView = this.view.dbView;</span>
<a href="#l1.142"></a><span id="l1.142" class="difflineminus">-    for each (let [, index] in Iterator(selectedIndices)) {</span>
<a href="#l1.143"></a><span id="l1.143" class="difflineplus">+    for (let index of selectedIndices) {</span>
<a href="#l1.144"></a><span id="l1.144">       let thread = dbView.getThreadContainingIndex(index);</span>
<a href="#l1.145"></a><span id="l1.145">       // We use getChildHdrAt instead of getRootHdr because getRootHdr has</span>
<a href="#l1.146"></a><span id="l1.146">       //  a useless out-param and just calls getChildHdrAt anyways.</span>
<a href="#l1.147"></a><span id="l1.147">       newSelectedMessages.push(thread.getChildHdrAt(0));</span>
<a href="#l1.148"></a><span id="l1.148">     }</span>
<a href="#l1.149"></a><span id="l1.149">     this.selectMessages(newSelectedMessages);</span>
<a href="#l1.150"></a><span id="l1.150">   },</span>
<a href="#l1.151"></a><span id="l1.151"> </span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l2.1"></a><span id="l2.1" class="difflineminus">--- a/mail/base/content/folderPane.js</span>
<a href="#l2.2"></a><span id="l2.2" class="difflineplus">+++ b/mail/base/content/folderPane.js</span>
<a href="#l2.3"></a><span id="l2.3" class="difflineat">@@ -526,17 +526,17 @@ var gFolderTreeView = {</span>
<a href="#l2.4"></a><span id="l2.4">    * Returns the index of a folder in the current display.</span>
<a href="#l2.5"></a><span id="l2.5">    *</span>
<a href="#l2.6"></a><span id="l2.6">    * @param aFolder  the folder whose index should be returned.</span>
<a href="#l2.7"></a><span id="l2.7">    * @returns The index of the folder in the view (a number).</span>
<a href="#l2.8"></a><span id="l2.8">    * @note If the folder is not in the display (perhaps because one of its</span>
<a href="#l2.9"></a><span id="l2.9">    *       anscetors is collapsed), this function returns null.</span>
<a href="#l2.10"></a><span id="l2.10">    */</span>
<a href="#l2.11"></a><span id="l2.11">   getIndexOfFolder: function ftv_getIndexOfFolder(aFolder) {</span>
<a href="#l2.12"></a><span id="l2.12" class="difflineminus">-    for each (let [iRow, row] in Iterator(this._rowMap)) {</span>
<a href="#l2.13"></a><span id="l2.13" class="difflineplus">+    for (let [iRow, row] of this._rowMap.entries()) {</span>
<a href="#l2.14"></a><span id="l2.14">       if (row.id == aFolder.URI)</span>
<a href="#l2.15"></a><span id="l2.15">         return iRow;</span>
<a href="#l2.16"></a><span id="l2.16">     }</span>
<a href="#l2.17"></a><span id="l2.17">     return null;</span>
<a href="#l2.18"></a><span id="l2.18">   },</span>
<a href="#l2.19"></a><span id="l2.19"> </span>
<a href="#l2.20"></a><span id="l2.20">   /**</span>
<a href="#l2.21"></a><span id="l2.21">    * Returns the folder for an index in the current display.</span>
<a href="#l2.22"></a><span id="l2.22" class="difflineat">@@ -1073,27 +1073,27 @@ var gFolderTreeView = {</span>
<a href="#l2.23"></a><span id="l2.23">         // if this folder doesn't have a property set, check Its children</span>
<a href="#l2.24"></a><span id="l2.24">         this._subFoldersWithStringProperty(child, folders, aFolderName, deep);</span>
<a href="#l2.25"></a><span id="l2.25">     }</span>
<a href="#l2.26"></a><span id="l2.26">   },</span>
<a href="#l2.27"></a><span id="l2.27"> </span>
<a href="#l2.28"></a><span id="l2.28">   _allFoldersWithStringProperty: function ftv_getAllFoldersWithProperty(accounts, aFolderName, deep)</span>
<a href="#l2.29"></a><span id="l2.29">   {</span>
<a href="#l2.30"></a><span id="l2.30">     let folders = [];</span>
<a href="#l2.31"></a><span id="l2.31" class="difflineminus">-    for each (let acct in accounts) {</span>
<a href="#l2.32"></a><span id="l2.32" class="difflineplus">+    for (let acct of accounts) {</span>
<a href="#l2.33"></a><span id="l2.33">       let folder = acct.incomingServer.rootFolder;</span>
<a href="#l2.34"></a><span id="l2.34">       this._subFoldersWithStringProperty(folder, folders, aFolderName, deep);</span>
<a href="#l2.35"></a><span id="l2.35">     }</span>
<a href="#l2.36"></a><span id="l2.36">     return folders;</span>
<a href="#l2.37"></a><span id="l2.37">   },</span>
<a href="#l2.38"></a><span id="l2.38"> </span>
<a href="#l2.39"></a><span id="l2.39">   _allFoldersWithFlag: function ftv_getAllFolders(accounts, aFolderFlag, deep)</span>
<a href="#l2.40"></a><span id="l2.40">   {</span>
<a href="#l2.41"></a><span id="l2.41">     let folders = [];</span>
<a href="#l2.42"></a><span id="l2.42" class="difflineminus">-    for each (let acct in accounts) {</span>
<a href="#l2.43"></a><span id="l2.43" class="difflineplus">+    for (let acct of accounts) {</span>
<a href="#l2.44"></a><span id="l2.44">       let foldersWithFlag = acct.incomingServer.rootFolder.getFoldersWithFlags(aFolderFlag);</span>
<a href="#l2.45"></a><span id="l2.45">       if (foldersWithFlag.length &gt; 0) {</span>
<a href="#l2.46"></a><span id="l2.46">         for (let folderWithFlag in fixIterator(foldersWithFlag,</span>
<a href="#l2.47"></a><span id="l2.47">                                                Components.interfaces.nsIMsgFolder)) {</span>
<a href="#l2.48"></a><span id="l2.48">           folders.push(folderWithFlag);</span>
<a href="#l2.49"></a><span id="l2.49">           // Add sub-folders of Sent and Archive to the result.</span>
<a href="#l2.50"></a><span id="l2.50">           if (deep &amp;&amp; (aFolderFlag &amp; (nsMsgFolderFlags.SentMail | nsMsgFolderFlags.Archive)))</span>
<a href="#l2.51"></a><span id="l2.51">             this.addSubFolders(folderWithFlag, folders);</span>
<a href="#l2.52"></a><span id="l2.52" class="difflineat">@@ -1148,17 +1148,17 @@ var gFolderTreeView = {</span>
<a href="#l2.53"></a><span id="l2.53">       let folderUri = smartRootFolder.URI + &quot;/&quot; + encodeURI(folderName);</span>
<a href="#l2.54"></a><span id="l2.54">       smartFolder = smartRootFolder.getChildWithURI(folderUri, false, true);</span>
<a href="#l2.55"></a><span id="l2.55">     } catch (ex) {</span>
<a href="#l2.56"></a><span id="l2.56">         smartFolder = null;</span>
<a href="#l2.57"></a><span id="l2.57">     };</span>
<a href="#l2.58"></a><span id="l2.58">     if (!smartFolder) {</span>
<a href="#l2.59"></a><span id="l2.59">       let searchFolders = gFolderTreeView._allSmartFolders(accounts, flag, folderName, true);</span>
<a href="#l2.60"></a><span id="l2.60">       let searchFolderURIs = &quot;&quot;;</span>
<a href="#l2.61"></a><span id="l2.61" class="difflineminus">-      for each (let searchFolder in searchFolders) {</span>
<a href="#l2.62"></a><span id="l2.62" class="difflineplus">+      for (let searchFolder of searchFolders) {</span>
<a href="#l2.63"></a><span id="l2.63">         if (searchFolderURIs.length)</span>
<a href="#l2.64"></a><span id="l2.64">           searchFolderURIs += '|';</span>
<a href="#l2.65"></a><span id="l2.65">         searchFolderURIs +=  searchFolder.URI;</span>
<a href="#l2.66"></a><span id="l2.66">       }</span>
<a href="#l2.67"></a><span id="l2.67">       if (!searchFolderURIs.length)</span>
<a href="#l2.68"></a><span id="l2.68">         return null;</span>
<a href="#l2.69"></a><span id="l2.69">       smartFolder = gFolderTreeView._createVFFolder(folderName, smartRootFolder,</span>
<a href="#l2.70"></a><span id="l2.70">                                                     searchFolderURIs, flag);</span>
<a href="#l2.71"></a><span id="l2.71" class="difflineat">@@ -1168,21 +1168,21 @@ var gFolderTreeView = {</span>
<a href="#l2.72"></a><span id="l2.72">     smartFolderItem._level = 0;</span>
<a href="#l2.73"></a><span id="l2.73">     if (position == undefined)</span>
<a href="#l2.74"></a><span id="l2.74">       map.push(smartFolderItem);</span>
<a href="#l2.75"></a><span id="l2.75">     else</span>
<a href="#l2.76"></a><span id="l2.76">       map[position] = smartFolderItem;</span>
<a href="#l2.77"></a><span id="l2.77">     // Add the actual special folders as sub-folders of the saved search.</span>
<a href="#l2.78"></a><span id="l2.78">     // By setting _children directly, we bypass the normal calculation</span>
<a href="#l2.79"></a><span id="l2.79">     // of subfolders.</span>
<a href="#l2.80"></a><span id="l2.80" class="difflineminus">-    smartFolderItem._children = [new ftvItem(f) for each (f in subFolders)];</span>
<a href="#l2.81"></a><span id="l2.81" class="difflineplus">+    smartFolderItem._children = subFolders.map(f =&gt; new ftvItem(f));</span>
<a href="#l2.82"></a><span id="l2.82"> </span>
<a href="#l2.83"></a><span id="l2.83">     let prevChild = null;</span>
<a href="#l2.84"></a><span id="l2.84">     // Each child is a level one below the smartFolder</span>
<a href="#l2.85"></a><span id="l2.85" class="difflineminus">-    for each (let child in smartFolderItem._children) {</span>
<a href="#l2.86"></a><span id="l2.86" class="difflineplus">+    for (let child of smartFolderItem._children) {</span>
<a href="#l2.87"></a><span id="l2.87">       child._level = smartFolderItem._level + 1;</span>
<a href="#l2.88"></a><span id="l2.88">       child._parent = smartFolderItem;</span>
<a href="#l2.89"></a><span id="l2.89">       // don't show sub-folders of the inbox, but I think Archives/Sent, etc</span>
<a href="#l2.90"></a><span id="l2.90">       // should have the sub-folders.</span>
<a href="#l2.91"></a><span id="l2.91">       if (flag &amp; nsMsgFolderFlags.Inbox)</span>
<a href="#l2.92"></a><span id="l2.92">         child.__defineGetter__(&quot;children&quot;, () =&gt; []);</span>
<a href="#l2.93"></a><span id="l2.93">       // If we have consecutive children with the same server, then both</span>
<a href="#l2.94"></a><span id="l2.94">       // should display as folder - server.</span>
<a href="#l2.95"></a><span id="l2.95" class="difflineat">@@ -1427,18 +1427,17 @@ var gFolderTreeView = {</span>
<a href="#l2.96"></a><span id="l2.96">     all: {</span>
<a href="#l2.97"></a><span id="l2.97">       __proto__: IFolderTreeMode,</span>
<a href="#l2.98"></a><span id="l2.98"> </span>
<a href="#l2.99"></a><span id="l2.99">       generateMap: function ftv_all_generateMap(ftv) {</span>
<a href="#l2.100"></a><span id="l2.100">         let accounts = gFolderTreeView._sortedAccounts();</span>
<a href="#l2.101"></a><span id="l2.101">         // force each root folder to do its local subfolder discovery.</span>
<a href="#l2.102"></a><span id="l2.102">         MailUtils.discoverFolders();</span>
<a href="#l2.103"></a><span id="l2.103"> </span>
<a href="#l2.104"></a><span id="l2.104" class="difflineminus">-        return [new ftvItem(acct.incomingServer.rootFolder)</span>
<a href="#l2.105"></a><span id="l2.105" class="difflineminus">-                for each (acct in accounts)];</span>
<a href="#l2.106"></a><span id="l2.106" class="difflineplus">+        return accounts.map(acct =&gt; new ftvItem(acct.incomingServer.rootFolder));</span>
<a href="#l2.107"></a><span id="l2.107">       }</span>
<a href="#l2.108"></a><span id="l2.108">     },</span>
<a href="#l2.109"></a><span id="l2.109"> </span>
<a href="#l2.110"></a><span id="l2.110">     /**</span>
<a href="#l2.111"></a><span id="l2.111">      * The unread mode returns all folders that are not root-folders and that</span>
<a href="#l2.112"></a><span id="l2.112">      * have unread items. Also always keep the currently selected folder</span>
<a href="#l2.113"></a><span id="l2.113">      * so it doesn't disappear under the user.</span>
<a href="#l2.114"></a><span id="l2.114">      * It also includes parent folders of the Unread folders so the hierarchy</span>
<a href="#l2.115"></a><span id="l2.115" class="difflineat">@@ -1797,22 +1796,22 @@ var gFolderTreeView = {</span>
<a href="#l2.116"></a><span id="l2.116">         let smartRoot = smartServer.rootFolder;</span>
<a href="#l2.117"></a><span id="l2.117">         let smartChildren = [];</span>
<a href="#l2.118"></a><span id="l2.118">         for (let [flag, name,,] of this._flagNameList) {</span>
<a href="#l2.119"></a><span id="l2.119">           gFolderTreeView._addSmartFoldersForFlag(smartChildren, accounts,</span>
<a href="#l2.120"></a><span id="l2.120">                                                   smartRoot, flag, name);</span>
<a href="#l2.121"></a><span id="l2.121">         }</span>
<a href="#l2.122"></a><span id="l2.122"> </span>
<a href="#l2.123"></a><span id="l2.123">         sortFolderItems(smartChildren);</span>
<a href="#l2.124"></a><span id="l2.124" class="difflineminus">-        for each (let smartChild in smartChildren)</span>
<a href="#l2.125"></a><span id="l2.125" class="difflineplus">+        for (let smartChild of smartChildren)</span>
<a href="#l2.126"></a><span id="l2.126">           map.push(smartChild);</span>
<a href="#l2.127"></a><span id="l2.127"> </span>
<a href="#l2.128"></a><span id="l2.128">         MailUtils.discoverFolders();</span>
<a href="#l2.129"></a><span id="l2.129"> </span>
<a href="#l2.130"></a><span id="l2.130" class="difflineminus">-        for each (let acct in accounts)</span>
<a href="#l2.131"></a><span id="l2.131" class="difflineplus">+        for (let acct of accounts)</span>
<a href="#l2.132"></a><span id="l2.132">           map.push(new ftv_SmartItem(acct.incomingServer.rootFolder));</span>
<a href="#l2.133"></a><span id="l2.133"> </span>
<a href="#l2.134"></a><span id="l2.134">         return map;</span>
<a href="#l2.135"></a><span id="l2.135">       },</span>
<a href="#l2.136"></a><span id="l2.136"> </span>
<a href="#l2.137"></a><span id="l2.137">       /**</span>
<a href="#l2.138"></a><span id="l2.138">        * Returns the parent of a folder in the view.</span>
<a href="#l2.139"></a><span id="l2.139">        *</span>
<a href="#l2.140"></a><span id="l2.140" class="difflineat">@@ -2052,17 +2051,17 @@ var gFolderTreeView = {</span>
<a href="#l2.141"></a><span id="l2.141">     let parent = this._rowMap[parentIndex];</span>
<a href="#l2.142"></a><span id="l2.142">     if (!parent)</span>
<a href="#l2.143"></a><span id="l2.143">        return;</span>
<a href="#l2.144"></a><span id="l2.144"> </span>
<a href="#l2.145"></a><span id="l2.145">     // Getting these children might have triggered our parent to build its</span>
<a href="#l2.146"></a><span id="l2.146">     // array just now, in which case the added item will already exist</span>
<a href="#l2.147"></a><span id="l2.147">     let children = parent.children;</span>
<a href="#l2.148"></a><span id="l2.148">     var newChild;</span>
<a href="#l2.149"></a><span id="l2.149" class="difflineminus">-    for each (let child in children) {</span>
<a href="#l2.150"></a><span id="l2.150" class="difflineplus">+    for (let child of children) {</span>
<a href="#l2.151"></a><span id="l2.151">       if (child._folder == aItem) {</span>
<a href="#l2.152"></a><span id="l2.152">         newChild = child;</span>
<a href="#l2.153"></a><span id="l2.153">         break;</span>
<a href="#l2.154"></a><span id="l2.154">       }</span>
<a href="#l2.155"></a><span id="l2.155">     }</span>
<a href="#l2.156"></a><span id="l2.156">     if (!newChild) {</span>
<a href="#l2.157"></a><span id="l2.157">       newChild = new ftvItem(aItem);</span>
<a href="#l2.158"></a><span id="l2.158">       parent.children.push(newChild);</span>
<a href="#l2.159"></a><span id="l2.159" class="difflineat">@@ -2727,17 +2726,17 @@ ftv_SmartItem.prototype = {</span>
<a href="#l2.160"></a><span id="l2.160">           for (let subfolder in subIter) {</span>
<a href="#l2.161"></a><span id="l2.161">             if (!smartMode.isSmartFolder(subfolder))</span>
<a href="#l2.162"></a><span id="l2.162">               this._children.push(new ftv_SmartItem(subfolder));</span>
<a href="#l2.163"></a><span id="l2.163">           }</span>
<a href="#l2.164"></a><span id="l2.164">         }</span>
<a href="#l2.165"></a><span id="l2.165">       }</span>
<a href="#l2.166"></a><span id="l2.166">       sortFolderItems(this._children);</span>
<a href="#l2.167"></a><span id="l2.167">       // Each child is a level one below us</span>
<a href="#l2.168"></a><span id="l2.168" class="difflineminus">-      for each (let child in this._children) {</span>
<a href="#l2.169"></a><span id="l2.169" class="difflineplus">+      for (let child of this._children) {</span>
<a href="#l2.170"></a><span id="l2.170">         child._level = this._level + 1;</span>
<a href="#l2.171"></a><span id="l2.171">         child._parent = this;</span>
<a href="#l2.172"></a><span id="l2.172">       }</span>
<a href="#l2.173"></a><span id="l2.173">     }</span>
<a href="#l2.174"></a><span id="l2.174">     return this._children;</span>
<a href="#l2.175"></a><span id="l2.175">   }</span>
<a href="#l2.176"></a><span id="l2.176"> }</span>
<a href="#l2.177"></a><span id="l2.177"> </span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l3.1"></a><span id="l3.1" class="difflineminus">--- a/mail/base/content/glodaFacetBindings.xml</span>
<a href="#l3.2"></a><span id="l3.2" class="difflineplus">+++ b/mail/base/content/glodaFacetBindings.xml</span>
<a href="#l3.3"></a><span id="l3.3" class="difflineat">@@ -38,17 +38,17 @@</span>
<a href="#l3.4"></a><span id="l3.4"> </span>
<a href="#l3.5"></a><span id="l3.5">         let searchLabel = glodaFacetStrings.get(</span>
<a href="#l3.6"></a><span id="l3.6">           &quot;glodaFacetView.search.label&quot;);</span>
<a href="#l3.7"></a><span id="l3.7">         spanify(searchLabel, &quot;explanation-fulltext-label&quot;);</span>
<a href="#l3.8"></a><span id="l3.8"> </span>
<a href="#l3.9"></a><span id="l3.9">         let criteriaText = glodaFacetStrings.get(</span>
<a href="#l3.10"></a><span id="l3.10">           &quot;glodaFacetView.constraints.query.fulltext.&quot; +</span>
<a href="#l3.11"></a><span id="l3.11">           (aMsgSearcher.andTerms ? &quot;and&quot; : &quot;or&quot;) + &quot;JoinWord&quot;);</span>
<a href="#l3.12"></a><span id="l3.12" class="difflineminus">-        for each (let [iTerm, term] in Iterator(aMsgSearcher.fulltextTerms)) {</span>
<a href="#l3.13"></a><span id="l3.13" class="difflineplus">+        for (let [iTerm, term] of aMsgSearcher.fulltextTerms.entries()) {</span>
<a href="#l3.14"></a><span id="l3.14">           if (iTerm)</span>
<a href="#l3.15"></a><span id="l3.15">             spanify(criteriaText, &quot;explanation-fulltext-criteria&quot;);</span>
<a href="#l3.16"></a><span id="l3.16">           spanify(term, &quot;explanation-fulltext-term&quot;);</span>
<a href="#l3.17"></a><span id="l3.17">         }</span>
<a href="#l3.18"></a><span id="l3.18">       ]]&gt;&lt;/body&gt;</span>
<a href="#l3.19"></a><span id="l3.19">     &lt;/method&gt;</span>
<a href="#l3.20"></a><span id="l3.20">     &lt;method name=&quot;setQuery&quot;&gt;</span>
<a href="#l3.21"></a><span id="l3.21">       &lt;parameter name=&quot;aMsgQuery&quot; /&gt;</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l4.1"></a><span id="l4.1" class="difflineminus">--- a/mail/base/content/mailCore.js</span>
<a href="#l4.2"></a><span id="l4.2" class="difflineplus">+++ b/mail/base/content/mailCore.js</span>
<a href="#l4.3"></a><span id="l4.3" class="difflineat">@@ -740,17 +740,17 @@ nsFlavorDataProvider.prototype =</span>
<a href="#l4.4"></a><span id="l4.4">       var destDirectory = dirPrimitive.value.QueryInterface(Components.interfaces.nsILocalFile);</span>
<a href="#l4.5"></a><span id="l4.5"> </span>
<a href="#l4.6"></a><span id="l4.6">       // now save the attachment to the specified location</span>
<a href="#l4.7"></a><span id="l4.7">       // XXX: we need more information than just the attachment url to save it,</span>
<a href="#l4.8"></a><span id="l4.8">       // fortunately, we have an array of all the current attachments so we can</span>
<a href="#l4.9"></a><span id="l4.9">       // cheat and scan through them</span>
<a href="#l4.10"></a><span id="l4.10"> </span>
<a href="#l4.11"></a><span id="l4.11">       var attachment = null;</span>
<a href="#l4.12"></a><span id="l4.12" class="difflineminus">-      for each (let index in Iterator(currentAttachments, true))</span>
<a href="#l4.13"></a><span id="l4.13" class="difflineplus">+      for (let index of currentAttachments.keys())</span>
<a href="#l4.14"></a><span id="l4.14">       {</span>
<a href="#l4.15"></a><span id="l4.15">         attachment = currentAttachments[index];</span>
<a href="#l4.16"></a><span id="l4.16">         if (attachment.url == srcUrlPrimitive)</span>
<a href="#l4.17"></a><span id="l4.17">           break;</span>
<a href="#l4.18"></a><span id="l4.18">       }</span>
<a href="#l4.19"></a><span id="l4.19"> </span>
<a href="#l4.20"></a><span id="l4.20">       // call our code for saving attachments</span>
<a href="#l4.21"></a><span id="l4.21">       if (attachment)</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l5.1"></a><span id="l5.1" class="difflineminus">--- a/mail/base/content/mailTabs.js</span>
<a href="#l5.2"></a><span id="l5.2" class="difflineplus">+++ b/mail/base/content/mailTabs.js</span>
<a href="#l5.3"></a><span id="l5.3" class="difflineat">@@ -220,17 +220,17 @@ var mailTabType = {</span>
<a href="#l5.4"></a><span id="l5.4">             // We need to manually trigger the tab monitor restore trigger</span>
<a href="#l5.5"></a><span id="l5.5">             // for this tab.  In theory this should be in tabmail, but the</span>
<a href="#l5.6"></a><span id="l5.6">             // special nature of the first tab will last exactly long as this</span>
<a href="#l5.7"></a><span id="l5.7">             // implementation right here so it does not particularly matter</span>
<a href="#l5.8"></a><span id="l5.8">             // and is a bit more honest, if ugly, to do it here.</span>
<a href="#l5.9"></a><span id="l5.9">             let tabmail = document.getElementById(&quot;tabmail&quot;);</span>
<a href="#l5.10"></a><span id="l5.10">             let restoreState = tabmail._restoringTabState;</span>
<a href="#l5.11"></a><span id="l5.11">             let tab = tabmail.tabInfo[0];</span>
<a href="#l5.12"></a><span id="l5.12" class="difflineminus">-            for each (let [, tabMonitor] in Iterator(tabmail.tabMonitors)) {</span>
<a href="#l5.13"></a><span id="l5.13" class="difflineplus">+            for (let tabMonitor of tabmail.tabMonitors) {</span>
<a href="#l5.14"></a><span id="l5.14">               if ((&quot;onTabRestored&quot; in tabMonitor) &amp;&amp;</span>
<a href="#l5.15"></a><span id="l5.15">                   (tabMonitor.monitorName in restoreState.ext)) {</span>
<a href="#l5.16"></a><span id="l5.16">                 tabMonitor.onTabRestored(tab,</span>
<a href="#l5.17"></a><span id="l5.17">                                          restoreState.ext[tabMonitor.monitorName],</span>
<a href="#l5.18"></a><span id="l5.18">                                          true);</span>
<a href="#l5.19"></a><span id="l5.19">               }</span>
<a href="#l5.20"></a><span id="l5.20">             }</span>
<a href="#l5.21"></a><span id="l5.21">           }</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l6.1"></a><span id="l6.1" class="difflineminus">--- a/mail/base/content/mailWindowOverlay.js</span>
<a href="#l6.2"></a><span id="l6.2" class="difflineplus">+++ b/mail/base/content/mailWindowOverlay.js</span>
<a href="#l6.3"></a><span id="l6.3" class="difflineat">@@ -244,17 +244,17 @@ function view_init()</span>
<a href="#l6.4"></a><span id="l6.4">   let appmenuViewFeedSummary = document.getElementById('appmenu_viewFeedSummary');</span>
<a href="#l6.5"></a><span id="l6.5">   if (appmenuViewFeedSummary)</span>
<a href="#l6.6"></a><span id="l6.6">     appmenuViewFeedSummary.hidden = !isFeed;</span>
<a href="#l6.7"></a><span id="l6.7"> </span>
<a href="#l6.8"></a><span id="l6.8">   let viewRssMenuItemIds = [&quot;bodyFeedGlobalWebPage&quot;,</span>
<a href="#l6.9"></a><span id="l6.9">                             &quot;bodyFeedGlobalSummary&quot;,</span>
<a href="#l6.10"></a><span id="l6.10">                             &quot;bodyFeedPerFolderPref&quot;];</span>
<a href="#l6.11"></a><span id="l6.11">   let checked = FeedMessageHandler.onSelectPref;</span>
<a href="#l6.12"></a><span id="l6.12" class="difflineminus">-  for each (let [index, id] in Iterator(viewRssMenuItemIds)) {</span>
<a href="#l6.13"></a><span id="l6.13" class="difflineplus">+  for (let [index, id] of viewRssMenuItemIds.entries()) {</span>
<a href="#l6.14"></a><span id="l6.14">     document.getElementById(id)</span>
<a href="#l6.15"></a><span id="l6.15">             .setAttribute(&quot;checked&quot;, index == checked);</span>
<a href="#l6.16"></a><span id="l6.16">   }</span>
<a href="#l6.17"></a><span id="l6.17"> </span>
<a href="#l6.18"></a><span id="l6.18">   // Initialize the View Attachment Inline menu</span>
<a href="#l6.19"></a><span id="l6.19">   var viewAttachmentInline = Services.prefs.getBoolPref(&quot;mail.inline_attachments&quot;);</span>
<a href="#l6.20"></a><span id="l6.20">   document.getElementById(&quot;viewAttachmentsInlineMenuitem&quot;)</span>
<a href="#l6.21"></a><span id="l6.21">           .setAttribute(&quot;checked&quot;, viewAttachmentInline);</span>
<a href="#l6.22"></a><span id="l6.22" class="difflineat">@@ -760,17 +760,17 @@ function SetGetMsgButtonTooltip()</span>
<a href="#l6.23"></a><span id="l6.23">     folders = selectedFolders;</span>
<a href="#l6.24"></a><span id="l6.24">   else</span>
<a href="#l6.25"></a><span id="l6.25">     folders = [ GetDefaultAccountRootFolder() ];</span>
<a href="#l6.26"></a><span id="l6.26"> </span>
<a href="#l6.27"></a><span id="l6.27">   var bundle = document.getElementById(&quot;bundle_messenger&quot;);</span>
<a href="#l6.28"></a><span id="l6.28">   var listSeparator = bundle.getString(&quot;getMsgButtonTooltip.listSeparator&quot;);</span>
<a href="#l6.29"></a><span id="l6.29"> </span>
<a href="#l6.30"></a><span id="l6.30">   // Push the usernames through a Set() to remove duplicates.</span>
<a href="#l6.31"></a><span id="l6.31" class="difflineminus">-  var names = new Set([v.server.prettyName for each (v in folders)]);</span>
<a href="#l6.32"></a><span id="l6.32" class="difflineplus">+  var names = new Set(folders.map(v =&gt; v.server.prettyName));</span>
<a href="#l6.33"></a><span id="l6.33">   var tooltipNames = Array.from(names).join(listSeparator);</span>
<a href="#l6.34"></a><span id="l6.34">   msgButton.tooltipText = bundle.getFormattedString(&quot;getMsgButtonTooltip&quot;,</span>
<a href="#l6.35"></a><span id="l6.35">                                                     [ tooltipNames ]);</span>
<a href="#l6.36"></a><span id="l6.36"> }</span>
<a href="#l6.37"></a><span id="l6.37"> </span>
<a href="#l6.38"></a><span id="l6.38"> function RemoveAllMessageTags()</span>
<a href="#l6.39"></a><span id="l6.39"> {</span>
<a href="#l6.40"></a><span id="l6.40">   var selectedMessages = gFolderDisplay.selectedMessages;</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l7.1"></a><span id="l7.1" class="difflineminus">--- a/mail/base/content/msgHdrViewOverlay.js</span>
<a href="#l7.2"></a><span id="l7.2" class="difflineplus">+++ b/mail/base/content/msgHdrViewOverlay.js</span>
<a href="#l7.3"></a><span id="l7.3" class="difflineat">@@ -653,17 +653,17 @@ var messageHeaderSink = {</span>
<a href="#l7.4"></a><span id="l7.4">         last.size = null;</span>
<a href="#l7.5"></a><span id="l7.5">       }</span>
<a href="#l7.6"></a><span id="l7.6">     },</span>
<a href="#l7.7"></a><span id="l7.7"> </span>
<a href="#l7.8"></a><span id="l7.8">     onEndAllAttachments: function()</span>
<a href="#l7.9"></a><span id="l7.9">     {</span>
<a href="#l7.10"></a><span id="l7.10">       displayAttachmentsForExpandedView();</span>
<a href="#l7.11"></a><span id="l7.11"> </span>
<a href="#l7.12"></a><span id="l7.12" class="difflineminus">-      for each (let [, listener] in Iterator(gMessageListeners)) {</span>
<a href="#l7.13"></a><span id="l7.13" class="difflineplus">+      for (let listener of gMessageListeners) {</span>
<a href="#l7.14"></a><span id="l7.14">         if (&quot;onEndAttachments&quot; in listener)</span>
<a href="#l7.15"></a><span id="l7.15">           listener.onEndAttachments();</span>
<a href="#l7.16"></a><span id="l7.16">       }</span>
<a href="#l7.17"></a><span id="l7.17">     },</span>
<a href="#l7.18"></a><span id="l7.18"> </span>
<a href="#l7.19"></a><span id="l7.19">     /**</span>
<a href="#l7.20"></a><span id="l7.20">      * This event is generated by nsMsgStatusFeedback when it gets an</span>
<a href="#l7.21"></a><span id="l7.21">      * OnStateChange event for STATE_STOP.  This is the same event that</span>
<a href="#l7.22"></a><span id="l7.22" class="difflineat">@@ -689,17 +689,17 @@ var messageHeaderSink = {</span>
<a href="#l7.23"></a><span id="l7.23">         this.mSaveHdr.markHasAttachments(false);</span>
<a href="#l7.24"></a><span id="l7.24"> </span>
<a href="#l7.25"></a><span id="l7.25">       let browser = getBrowser();</span>
<a href="#l7.26"></a><span id="l7.26">       if (currentAttachments.length &amp;&amp;</span>
<a href="#l7.27"></a><span id="l7.27">           Services.prefs.getBoolPref(&quot;mail.inline_attachments&quot;) &amp;&amp;</span>
<a href="#l7.28"></a><span id="l7.28">           this.mSaveHdr &amp;&amp; gFolderDisplay.selectedMessageIsFeed &amp;&amp;</span>
<a href="#l7.29"></a><span id="l7.29">           browser &amp;&amp; browser.contentDocument &amp;&amp; browser.contentDocument.body) {</span>
<a href="#l7.30"></a><span id="l7.30">         for (let img of browser.contentDocument.body.getElementsByClassName(&quot;moz-attached-image&quot;)) {</span>
<a href="#l7.31"></a><span id="l7.31" class="difflineminus">-          for each (let [, attachment] in Iterator(currentAttachments)) {</span>
<a href="#l7.32"></a><span id="l7.32" class="difflineplus">+          for (let attachment of currentAttachments) {</span>
<a href="#l7.33"></a><span id="l7.33">             let partID = img.src.split(&quot;&amp;part=&quot;)[1];</span>
<a href="#l7.34"></a><span id="l7.34">             partID = partID ? partID.split(&quot;&amp;&quot;)[0] : null;</span>
<a href="#l7.35"></a><span id="l7.35">             if (attachment.partID &amp;&amp; partID == attachment.partID) {</span>
<a href="#l7.36"></a><span id="l7.36">               img.src = attachment.url;</span>
<a href="#l7.37"></a><span id="l7.37">               break;</span>
<a href="#l7.38"></a><span id="l7.38">             }</span>
<a href="#l7.39"></a><span id="l7.39">             else {</span>
<a href="#l7.40"></a><span id="l7.40">               // GlodaUtils.PART_RE fails to extract a partID for urls with</span>
<a href="#l7.41"></a><span id="l7.41" class="difflineat">@@ -779,17 +779,17 @@ function SetTagHeader()</span>
<a href="#l7.42"></a><span id="l7.42">   // It would be nice if we passed in the msgHdr from the back end.</span>
<a href="#l7.43"></a><span id="l7.43">   var msgHdr = gFolderDisplay.selectedMessage;</span>
<a href="#l7.44"></a><span id="l7.44">   if (!msgHdr)</span>
<a href="#l7.45"></a><span id="l7.45">     return; // no msgHdr to add our tags to</span>
<a href="#l7.46"></a><span id="l7.46"> </span>
<a href="#l7.47"></a><span id="l7.47">   // get the list of known tags</span>
<a href="#l7.48"></a><span id="l7.48">   var tagArray = MailServices.tags.getAllTags({});</span>
<a href="#l7.49"></a><span id="l7.49">   var tagKeys = {};</span>
<a href="#l7.50"></a><span id="l7.50" class="difflineminus">-  for each (var tagInfo in tagArray)</span>
<a href="#l7.51"></a><span id="l7.51" class="difflineplus">+  for (var tagInfo of tagArray)</span>
<a href="#l7.52"></a><span id="l7.52">     if (tagInfo.tag)</span>
<a href="#l7.53"></a><span id="l7.53">       tagKeys[tagInfo.key] = true;</span>
<a href="#l7.54"></a><span id="l7.54"> </span>
<a href="#l7.55"></a><span id="l7.55">   // extract the tag keys from the msgHdr</span>
<a href="#l7.56"></a><span id="l7.56">   var msgKeyArray = msgHdr.getStringProperty(&quot;keywords&quot;).split(&quot; &quot;);</span>
<a href="#l7.57"></a><span id="l7.57"> </span>
<a href="#l7.58"></a><span id="l7.58">   // attach legacy label to the front if not already there</span>
<a href="#l7.59"></a><span id="l7.59">   var label = msgHdr.label;</span>
<a href="#l7.60"></a><span id="l7.60" class="difflineat">@@ -848,43 +848,47 @@ function OnTagsChange()</span>
<a href="#l7.61"></a><span id="l7.61"> </span>
<a href="#l7.62"></a><span id="l7.62"> /**</span>
<a href="#l7.63"></a><span id="l7.63">  * Flush out any local state being held by a header entry for a given table.</span>
<a href="#l7.64"></a><span id="l7.64">  *</span>
<a href="#l7.65"></a><span id="l7.65">  * @param aHeaderTable Table of header entries</span>
<a href="#l7.66"></a><span id="l7.66">  */</span>
<a href="#l7.67"></a><span id="l7.67"> function ClearHeaderView(aHeaderTable)</span>
<a href="#l7.68"></a><span id="l7.68"> {</span>
<a href="#l7.69"></a><span id="l7.69" class="difflineminus">-  for each (let [, headerEntry] in Iterator(aHeaderTable)) {</span>
<a href="#l7.70"></a><span id="l7.70" class="difflineplus">+  for (let name in aHeaderTable) {</span>
<a href="#l7.71"></a><span id="l7.71" class="difflineplus">+    let headerEntry = aHeaderTable[name];</span>
<a href="#l7.72"></a><span id="l7.72">     if (headerEntry.enclosingBox.clearHeaderValues)</span>
<a href="#l7.73"></a><span id="l7.73">       headerEntry.enclosingBox.clearHeaderValues();</span>
<a href="#l7.74"></a><span id="l7.74"> </span>
<a href="#l7.75"></a><span id="l7.75">     headerEntry.valid = false;</span>
<a href="#l7.76"></a><span id="l7.76">   }</span>
<a href="#l7.77"></a><span id="l7.77"> }</span>
<a href="#l7.78"></a><span id="l7.78"> </span>
<a href="#l7.79"></a><span id="l7.79"> /**</span>
<a href="#l7.80"></a><span id="l7.80">  * Make sure that any valid header entry in the table is collapsed.</span>
<a href="#l7.81"></a><span id="l7.81">  *</span>
<a href="#l7.82"></a><span id="l7.82">  * @param aHeaderTable Table of header entries</span>
<a href="#l7.83"></a><span id="l7.83">  */</span>
<a href="#l7.84"></a><span id="l7.84"> function hideHeaderView(aHeaderTable)</span>
<a href="#l7.85"></a><span id="l7.85"> {</span>
<a href="#l7.86"></a><span id="l7.86" class="difflineminus">-  for each (let [, headerEntry] in Iterator(aHeaderTable))</span>
<a href="#l7.87"></a><span id="l7.87" class="difflineplus">+  for (let name in aHeaderTable) {</span>
<a href="#l7.88"></a><span id="l7.88" class="difflineplus">+    let headerEntry = aHeaderTable[name];</span>
<a href="#l7.89"></a><span id="l7.89">     headerEntry.enclosingRow.collapsed = true;</span>
<a href="#l7.90"></a><span id="l7.90" class="difflineplus">+  }</span>
<a href="#l7.91"></a><span id="l7.91"> }</span>
<a href="#l7.92"></a><span id="l7.92"> </span>
<a href="#l7.93"></a><span id="l7.93"> /**</span>
<a href="#l7.94"></a><span id="l7.94">  * Make sure that any valid header entry in the table specified is visible.</span>
<a href="#l7.95"></a><span id="l7.95">  *</span>
<a href="#l7.96"></a><span id="l7.96">  * @param aHeaderTable Table of header entries</span>
<a href="#l7.97"></a><span id="l7.97">  */</span>
<a href="#l7.98"></a><span id="l7.98"> function showHeaderView(aHeaderTable)</span>
<a href="#l7.99"></a><span id="l7.99"> {</span>
<a href="#l7.100"></a><span id="l7.100" class="difflineminus">-  for each (let [, headerEntry] in Iterator(aHeaderTable)) {</span>
<a href="#l7.101"></a><span id="l7.101" class="difflineplus">+  for (let name in aHeaderTable) {</span>
<a href="#l7.102"></a><span id="l7.102" class="difflineplus">+    let headerEntry = aHeaderTable[name];</span>
<a href="#l7.103"></a><span id="l7.103">     if (headerEntry.valid) {</span>
<a href="#l7.104"></a><span id="l7.104">       headerEntry.enclosingRow.collapsed = false;</span>
<a href="#l7.105"></a><span id="l7.105">     } else {</span>
<a href="#l7.106"></a><span id="l7.106">       // if the entry is invalid, always make sure it's collapsed</span>
<a href="#l7.107"></a><span id="l7.107">       headerEntry.enclosingRow.collapsed = true;</span>
<a href="#l7.108"></a><span id="l7.108">     }</span>
<a href="#l7.109"></a><span id="l7.109">   }</span>
<a href="#l7.110"></a><span id="l7.110"> }</span>
<a href="#l7.111"></a><span id="l7.111" class="difflineat">@@ -895,28 +899,30 @@ function showHeaderView(aHeaderTable)</span>
<a href="#l7.112"></a><span id="l7.112">  */</span>
<a href="#l7.113"></a><span id="l7.113"> function EnsureMinimumNumberOfHeaders (headerTable)</span>
<a href="#l7.114"></a><span id="l7.114"> {</span>
<a href="#l7.115"></a><span id="l7.115">   // 0 means we don't have a minimum... do nothing special</span>
<a href="#l7.116"></a><span id="l7.116">   if (!gMinNumberOfHeaders)</span>
<a href="#l7.117"></a><span id="l7.117">     return;</span>
<a href="#l7.118"></a><span id="l7.118"> </span>
<a href="#l7.119"></a><span id="l7.119">   var numVisibleHeaders = 0;</span>
<a href="#l7.120"></a><span id="l7.120" class="difflineminus">-  for each (let [, headerEntry] in Iterator(headerTable)) {</span>
<a href="#l7.121"></a><span id="l7.121" class="difflineplus">+  for (let name in headerTable) {</span>
<a href="#l7.122"></a><span id="l7.122" class="difflineplus">+    let headerEntry = headerTable[name];</span>
<a href="#l7.123"></a><span id="l7.123">     if (headerEntry.valid)</span>
<a href="#l7.124"></a><span id="l7.124">       numVisibleHeaders ++;</span>
<a href="#l7.125"></a><span id="l7.125">   }</span>
<a href="#l7.126"></a><span id="l7.126"> </span>
<a href="#l7.127"></a><span id="l7.127">   if (numVisibleHeaders &lt; gMinNumberOfHeaders) {</span>
<a href="#l7.128"></a><span id="l7.128">     // How many empty headers do we need to add?</span>
<a href="#l7.129"></a><span id="l7.129">     var numEmptyHeaders = gMinNumberOfHeaders - numVisibleHeaders;</span>
<a href="#l7.130"></a><span id="l7.130"> </span>
<a href="#l7.131"></a><span id="l7.131">     // We may have already dynamically created our empty rows and we just need</span>
<a href="#l7.132"></a><span id="l7.132">     // to make them visible.</span>
<a href="#l7.133"></a><span id="l7.133" class="difflineminus">-    for each (let [index, headerEntry] in Iterator(headerTable)) {</span>
<a href="#l7.134"></a><span id="l7.134" class="difflineplus">+    for (let index in headerTable) {</span>
<a href="#l7.135"></a><span id="l7.135" class="difflineplus">+      let headerEntry = headerTable[index];</span>
<a href="#l7.136"></a><span id="l7.136">       if (index.startsWith(&quot;Dummy-Header&quot;) &amp;&amp; numEmptyHeaders) {</span>
<a href="#l7.137"></a><span id="l7.137">         headerEntry.valid = true;</span>
<a href="#l7.138"></a><span id="l7.138">         numEmptyHeaders--;</span>
<a href="#l7.139"></a><span id="l7.139">       }</span>
<a href="#l7.140"></a><span id="l7.140">     }</span>
<a href="#l7.141"></a><span id="l7.141"> </span>
<a href="#l7.142"></a><span id="l7.142">     // Ok, now if we have any extra dummy headers we need to add, create a new</span>
<a href="#l7.143"></a><span id="l7.143">     // header widget for them.</span>
<a href="#l7.144"></a><span id="l7.144" class="difflineat">@@ -1047,17 +1053,18 @@ function HeaderView(headerName, label)</span>
<a href="#l7.145"></a><span id="l7.145"> </span>
<a href="#l7.146"></a><span id="l7.146"> /**</span>
<a href="#l7.147"></a><span id="l7.147">  * Removes all non-predefined header nodes from the view.</span>
<a href="#l7.148"></a><span id="l7.148">  *</span>
<a href="#l7.149"></a><span id="l7.149">  * @param aHeaderTable  Table of header entries.</span>
<a href="#l7.150"></a><span id="l7.150">  */</span>
<a href="#l7.151"></a><span id="l7.151"> function RemoveNewHeaderViews(aHeaderTable)</span>
<a href="#l7.152"></a><span id="l7.152"> {</span>
<a href="#l7.153"></a><span id="l7.153" class="difflineminus">-  for each (let [, headerEntry] in Iterator(aHeaderTable)) {</span>
<a href="#l7.154"></a><span id="l7.154" class="difflineplus">+  for (let name in aHeaderTable) {</span>
<a href="#l7.155"></a><span id="l7.155" class="difflineplus">+    let headerEntry = aHeaderTable[name];</span>
<a href="#l7.156"></a><span id="l7.156">     if (headerEntry.isNewHeader)</span>
<a href="#l7.157"></a><span id="l7.157">       headerEntry.enclosingRow.remove();</span>
<a href="#l7.158"></a><span id="l7.158">   }</span>
<a href="#l7.159"></a><span id="l7.159"> }</span>
<a href="#l7.160"></a><span id="l7.160"> </span>
<a href="#l7.161"></a><span id="l7.161"> /**</span>
<a href="#l7.162"></a><span id="l7.162">  * UpdateExpandedMessageHeaders: Iterate through all the current header data</span>
<a href="#l7.163"></a><span id="l7.163">  * we received from mime for this message for the expanded header entry table,</span>
<a href="#l7.164"></a><span id="l7.164" class="difflineat">@@ -1282,17 +1289,17 @@ function UpdateEmailNodeDetails(aEmailAd</span>
<a href="#l7.165"></a><span id="l7.165">       chatAddresses.push(jid);</span>
<a href="#l7.166"></a><span id="l7.166">   }</span>
<a href="#l7.167"></a><span id="l7.167">   let chatContact;</span>
<a href="#l7.168"></a><span id="l7.168">   if (!(&quot;chatHandler&quot; in window)) {</span>
<a href="#l7.169"></a><span id="l7.169">     window.chatHandler = {};</span>
<a href="#l7.170"></a><span id="l7.170">     Components.utils.import(&quot;resource:///modules/chatHandler.jsm&quot;, chatHandler);</span>
<a href="#l7.171"></a><span id="l7.171">   }</span>
<a href="#l7.172"></a><span id="l7.172">   let onlineContacts = chatHandler.onlineContacts;</span>
<a href="#l7.173"></a><span id="l7.173" class="difflineminus">-  for each (let chatAddress in chatAddresses) {</span>
<a href="#l7.174"></a><span id="l7.174" class="difflineplus">+  for (let chatAddress of chatAddresses) {</span>
<a href="#l7.175"></a><span id="l7.175">     if (Object.prototype.hasOwnProperty.call(onlineContacts, chatAddresses)) {</span>
<a href="#l7.176"></a><span id="l7.176">       chatContact = onlineContacts[chatAddress];</span>
<a href="#l7.177"></a><span id="l7.177">       break;</span>
<a href="#l7.178"></a><span id="l7.178">     }</span>
<a href="#l7.179"></a><span id="l7.179">   }</span>
<a href="#l7.180"></a><span id="l7.180">   if (aDocumentNode.chatContact) {</span>
<a href="#l7.181"></a><span id="l7.181">     aDocumentNode.chatContact.removeObserver(aDocumentNode.chatContactObserver);</span>
<a href="#l7.182"></a><span id="l7.182">     delete aDocumentNode.chatContact;</span>
<a href="#l7.183"></a><span id="l7.183" class="difflineat">@@ -2229,17 +2236,17 @@ function displayAttachmentsForExpandedVi</span>
<a href="#l7.184"></a><span id="l7.184">     var views = [&quot;small&quot;, &quot;large&quot;, &quot;tile&quot;];</span>
<a href="#l7.185"></a><span id="l7.185">     attachmentList.view = views[viewMode];</span>
<a href="#l7.186"></a><span id="l7.186">     attachmentList.controllers.appendController(AttachmentListController);</span>
<a href="#l7.187"></a><span id="l7.187"> </span>
<a href="#l7.188"></a><span id="l7.188">     toggleAttachmentList(false);</span>
<a href="#l7.189"></a><span id="l7.189"> </span>
<a href="#l7.190"></a><span id="l7.190">     var lastPartID;</span>
<a href="#l7.191"></a><span id="l7.191">     var unknownSize = false;</span>
<a href="#l7.192"></a><span id="l7.192" class="difflineminus">-    for each (let [, attachment] in Iterator(currentAttachments)) {</span>
<a href="#l7.193"></a><span id="l7.193" class="difflineplus">+    for (let attachment of currentAttachments) {</span>
<a href="#l7.194"></a><span id="l7.194">       // Create a new attachment widget</span>
<a href="#l7.195"></a><span id="l7.195">       var displayName = SanitizeAttachmentDisplayName(attachment);</span>
<a href="#l7.196"></a><span id="l7.196">       var item = attachmentList.appendItem(attachment, displayName);</span>
<a href="#l7.197"></a><span id="l7.197">       item.setAttribute(&quot;tooltiptext&quot;, attachment.name);</span>
<a href="#l7.198"></a><span id="l7.198">       item.addEventListener(&quot;command&quot;, attachmentItemCommand, false);</span>
<a href="#l7.199"></a><span id="l7.199"> </span>
<a href="#l7.200"></a><span id="l7.200">       // Check if this attachment's part ID is a child of the last attachment</span>
<a href="#l7.201"></a><span id="l7.201">       // we counted. If so, skip it, since we already accounted for its size</span>
<a href="#l7.202"></a><span id="l7.202" class="difflineat">@@ -2392,17 +2399,17 @@ function getIconForAttachment(attachment</span>
<a href="#l7.203"></a><span id="l7.203"> /**</span>
<a href="#l7.204"></a><span id="l7.204">  * Public method called when we create the attachments file menu</span>
<a href="#l7.205"></a><span id="l7.205">  */</span>
<a href="#l7.206"></a><span id="l7.206"> function FillAttachmentListPopup(aEvent, aPopup)</span>
<a href="#l7.207"></a><span id="l7.207"> {</span>
<a href="#l7.208"></a><span id="l7.208">   // First clear out the old view...</span>
<a href="#l7.209"></a><span id="l7.209">   ClearAttachmentMenu(aPopup);</span>
<a href="#l7.210"></a><span id="l7.210"> </span>
<a href="#l7.211"></a><span id="l7.211" class="difflineminus">-  for each (let [attachmentIndex, attachment] in Iterator(currentAttachments))</span>
<a href="#l7.212"></a><span id="l7.212" class="difflineplus">+  for (let [attachmentIndex, attachment] of currentAttachments.entries())</span>
<a href="#l7.213"></a><span id="l7.213">     addAttachmentToPopup(aPopup, attachment, attachmentIndex);</span>
<a href="#l7.214"></a><span id="l7.214"> </span>
<a href="#l7.215"></a><span id="l7.215">   goUpdateAttachmentCommands();</span>
<a href="#l7.216"></a><span id="l7.216"> }</span>
<a href="#l7.217"></a><span id="l7.217"> </span>
<a href="#l7.218"></a><span id="l7.218"> // Public method used to clear the file attachment menu</span>
<a href="#l7.219"></a><span id="l7.219"> function ClearAttachmentMenu(popup)</span>
<a href="#l7.220"></a><span id="l7.220"> {</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l8.1"></a><span id="l8.1" class="difflineminus">--- a/mail/base/content/msgViewNavigation.js</span>
<a href="#l8.2"></a><span id="l8.2" class="difflineplus">+++ b/mail/base/content/msgViewNavigation.js</span>
<a href="#l8.3"></a><span id="l8.3" class="difflineat">@@ -116,17 +116,17 @@ function FindNextFolder()</span>
<a href="#l8.4"></a><span id="l8.4">   return null;</span>
<a href="#l8.5"></a><span id="l8.5"> }</span>
<a href="#l8.6"></a><span id="l8.6"> </span>
<a href="#l8.7"></a><span id="l8.7"> function GetRootFoldersInFolderPaneOrder()</span>
<a href="#l8.8"></a><span id="l8.8"> {</span>
<a href="#l8.9"></a><span id="l8.9">   let accounts = allAccountsSorted(false);</span>
<a href="#l8.10"></a><span id="l8.10"> </span>
<a href="#l8.11"></a><span id="l8.11">   let serversMsgFolders = [];</span>
<a href="#l8.12"></a><span id="l8.12" class="difflineminus">-  for each (let account in accounts)</span>
<a href="#l8.13"></a><span id="l8.13" class="difflineplus">+  for (let account of accounts)</span>
<a href="#l8.14"></a><span id="l8.14">     serversMsgFolders.push(account.incomingServer.rootMsgFolder);</span>
<a href="#l8.15"></a><span id="l8.15"> </span>
<a href="#l8.16"></a><span id="l8.16">   return serversMsgFolders;</span>
<a href="#l8.17"></a><span id="l8.17"> }</span>
<a href="#l8.18"></a><span id="l8.18"> </span>
<a href="#l8.19"></a><span id="l8.19"> function CrossFolderNavigation(type)</span>
<a href="#l8.20"></a><span id="l8.20"> {</span>
<a href="#l8.21"></a><span id="l8.21">   // do cross folder navigation for next unread message/thread and message history</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l9.1"></a><span id="l9.1" class="difflineminus">--- a/mail/base/content/quickFilterBar.js</span>
<a href="#l9.2"></a><span id="l9.2" class="difflineplus">+++ b/mail/base/content/quickFilterBar.js</span>
<a href="#l9.3"></a><span id="l9.3" class="difflineat">@@ -124,17 +124,17 @@ var QuickFilterBarMuxer = {</span>
<a href="#l9.4"></a><span id="l9.4">     let filterer = this.maybeActiveFilterer;</span>
<a href="#l9.5"></a><span id="l9.5">     if (!filterer)</span>
<a href="#l9.6"></a><span id="l9.6">       return;</span>
<a href="#l9.7"></a><span id="l9.7"> </span>
<a href="#l9.8"></a><span id="l9.8">     let filtering = aFolderDisplay.view.search.userTerms != null;</span>
<a href="#l9.9"></a><span id="l9.9"> </span>
<a href="#l9.10"></a><span id="l9.10">     // - postFilterProcess everyone who cares</span>
<a href="#l9.11"></a><span id="l9.11">     // This may need to be converted into an asynchronous process at some point.</span>
<a href="#l9.12"></a><span id="l9.12" class="difflineminus">-    for each (let [, filterDef] in Iterator(QuickFilterManager.filterDefs)) {</span>
<a href="#l9.13"></a><span id="l9.13" class="difflineplus">+    for (let filterDef of QuickFilterManager.filterDefs) {</span>
<a href="#l9.14"></a><span id="l9.14">       if (&quot;postFilterProcess&quot; in filterDef) {</span>
<a href="#l9.15"></a><span id="l9.15">         let preState = (filterDef.name in filterer.filterValues) ?</span>
<a href="#l9.16"></a><span id="l9.16">           filterer.filterValues[filterDef.name] : null;</span>
<a href="#l9.17"></a><span id="l9.17">         let [newState, update, treatAsUserAction] =</span>
<a href="#l9.18"></a><span id="l9.18">           filterDef.postFilterProcess(preState, aFolderDisplay.view, filtering);</span>
<a href="#l9.19"></a><span id="l9.19">         filterer.setFilterValue(filterDef.name, newState, !treatAsUserAction);</span>
<a href="#l9.20"></a><span id="l9.20">         if (update) {</span>
<a href="#l9.21"></a><span id="l9.21">           if (aFolderDisplay._tabInfo == this.tabmail.currentTabInfo &amp;&amp;</span>
<a href="#l9.22"></a><span id="l9.22" class="difflineat">@@ -175,17 +175,17 @@ var QuickFilterBarMuxer = {</span>
<a href="#l9.23"></a><span id="l9.23">    * Add appropriate event handlers to the DOM elements.  We do this rather</span>
<a href="#l9.24"></a><span id="l9.24">    *  than requiring lots of boilerplate &quot;oncommand&quot; junk on the nodes.</span>
<a href="#l9.25"></a><span id="l9.25">    *</span>
<a href="#l9.26"></a><span id="l9.26">    * We hook up the following:</span>
<a href="#l9.27"></a><span id="l9.27">    * - &quot;command&quot; event listener.</span>
<a href="#l9.28"></a><span id="l9.28">    * - reflect filter state</span>
<a href="#l9.29"></a><span id="l9.29">    */</span>
<a href="#l9.30"></a><span id="l9.30">   _bindUI: function QFBM__bindUI() {</span>
<a href="#l9.31"></a><span id="l9.31" class="difflineminus">-    for each (let [, filterDef] in Iterator(QuickFilterManager.filterDefs)) {</span>
<a href="#l9.32"></a><span id="l9.32" class="difflineplus">+    for (let filterDef of QuickFilterManager.filterDefs) {</span>
<a href="#l9.33"></a><span id="l9.33">       let domNode = document.getElementById(filterDef.domId);</span>
<a href="#l9.34"></a><span id="l9.34">       // the loop let binding does not latch, at least in 1.9.2</span>
<a href="#l9.35"></a><span id="l9.35">       let latchedFilterDef = filterDef;</span>
<a href="#l9.36"></a><span id="l9.36"> </span>
<a href="#l9.37"></a><span id="l9.37">       let handler;</span>
<a href="#l9.38"></a><span id="l9.38">       if (!(&quot;onCommand&quot; in filterDef)) {</span>
<a href="#l9.39"></a><span id="l9.39">         handler = function(aEvent) {</span>
<a href="#l9.40"></a><span id="l9.40">           try {</span>
<a href="#l9.41"></a><span id="l9.41" class="difflineat">@@ -227,18 +227,17 @@ var QuickFilterBarMuxer = {</span>
<a href="#l9.42"></a><span id="l9.42">    * @param [aFilterName] If only a single filter needs to be updated, name it.</span>
<a href="#l9.43"></a><span id="l9.43">    */</span>
<a href="#l9.44"></a><span id="l9.44">   reflectFiltererState: function QFBM_reflectFiltererState(aFilterer,</span>
<a href="#l9.45"></a><span id="l9.45">                                                            aFolderDisplay,</span>
<a href="#l9.46"></a><span id="l9.46">                                                            aFilterName) {</span>
<a href="#l9.47"></a><span id="l9.47">     // If we aren't visible then there is no need to update the widgets.</span>
<a href="#l9.48"></a><span id="l9.48">     if (aFilterer.visible) {</span>
<a href="#l9.49"></a><span id="l9.49">       let filterValues = aFilterer.filterValues;</span>
<a href="#l9.50"></a><span id="l9.50" class="difflineminus">-      for each (let [, filterDef] in</span>
<a href="#l9.51"></a><span id="l9.51" class="difflineminus">-                Iterator(QuickFilterManager.filterDefs)) {</span>
<a href="#l9.52"></a><span id="l9.52" class="difflineplus">+      for (let filterDef of QuickFilterManager.filterDefs) {</span>
<a href="#l9.53"></a><span id="l9.53">         // If we only need to update one state, check and skip as appropriate.</span>
<a href="#l9.54"></a><span id="l9.54">         if (aFilterName &amp;&amp; filterDef.name != aFilterName)</span>
<a href="#l9.55"></a><span id="l9.55">           continue;</span>
<a href="#l9.56"></a><span id="l9.56"> </span>
<a href="#l9.57"></a><span id="l9.57">         let domNode = document.getElementById(filterDef.domId);</span>
<a href="#l9.58"></a><span id="l9.58">         let value = (filterDef.name in filterValues) ?</span>
<a href="#l9.59"></a><span id="l9.59">           filterValues[filterDef.name] : null;</span>
<a href="#l9.60"></a><span id="l9.60">         if (!(&quot;reflectInDOM&quot; in filterDef))</span>
<a href="#l9.61"></a><span id="l9.61" class="difflineat">@@ -583,17 +582,17 @@ var QuickFilterBarMuxer = {</span>
<a href="#l9.62"></a><span id="l9.62">       return;</span>
<a href="#l9.63"></a><span id="l9.63"> </span>
<a href="#l9.64"></a><span id="l9.64">     let filterer = tab._ext.quickFilter;</span>
<a href="#l9.65"></a><span id="l9.65">     filterer.displayedFolder = tab.folderDisplay.displayedFolder;</span>
<a href="#l9.66"></a><span id="l9.66"> </span>
<a href="#l9.67"></a><span id="l9.67">     let [terms, listeners] =</span>
<a href="#l9.68"></a><span id="l9.68">       filterer.createSearchTerms(tab.folderDisplay.view.search.session);</span>
<a href="#l9.69"></a><span id="l9.69"> </span>
<a href="#l9.70"></a><span id="l9.70" class="difflineminus">-    for each (let [, [listener, filterDef]] in Iterator(listeners)) {</span>
<a href="#l9.71"></a><span id="l9.71" class="difflineplus">+    for (let [listener, filterDef] of listeners) {</span>
<a href="#l9.72"></a><span id="l9.72">       // it registers itself with the search session.</span>
<a href="#l9.73"></a><span id="l9.73">       new QuickFilterSearchListener(</span>
<a href="#l9.74"></a><span id="l9.74">         tab.folderDisplay, filterer, filterDef,</span>
<a href="#l9.75"></a><span id="l9.75">         listener, QuickFilterBarMuxer);</span>
<a href="#l9.76"></a><span id="l9.76">     }</span>
<a href="#l9.77"></a><span id="l9.77">     tab.folderDisplay.view.search.userTerms = terms;</span>
<a href="#l9.78"></a><span id="l9.78">     // Uncomment to know what the search state is when we (try and) update it.</span>
<a href="#l9.79"></a><span id="l9.79">     //dump(tab.folderDisplay.view.search.prettyString());</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l10.1"></a><span id="l10.1" class="difflineminus">--- a/mail/base/content/tabmail.xml</span>
<a href="#l10.2"></a><span id="l10.2" class="difflineplus">+++ b/mail/base/content/tabmail.xml</span>
<a href="#l10.3"></a><span id="l10.3" class="difflineat">@@ -443,17 +443,17 @@</span>
<a href="#l10.4"></a><span id="l10.4"> </span>
<a href="#l10.5"></a><span id="l10.5">             this.tabInfo[0] = this.currentTabInfo = firstTab;</span>
<a href="#l10.6"></a><span id="l10.6"> </span>
<a href="#l10.7"></a><span id="l10.7">             let tabOpenFirstFunc = firstTab.mode.openFirstTab ||</span>
<a href="#l10.8"></a><span id="l10.8">                                    firstTab.mode.tabType.openFirstTab;</span>
<a href="#l10.9"></a><span id="l10.9">             tabOpenFirstFunc.call(firstTab.mode.tabType, firstTab);</span>
<a href="#l10.10"></a><span id="l10.10">             this.setTabTitle(null);</span>
<a href="#l10.11"></a><span id="l10.11"> </span>
<a href="#l10.12"></a><span id="l10.12" class="difflineminus">-            for each (let [i, tabMonitor] in Iterator(this.tabMonitors)) {</span>
<a href="#l10.13"></a><span id="l10.13" class="difflineplus">+            for (let [i, tabMonitor] of this.tabMonitors.entries()) {</span>
<a href="#l10.14"></a><span id="l10.14">               if (&quot;onTabOpened&quot; in tabMonitor)</span>
<a href="#l10.15"></a><span id="l10.15">                 tabMonitor.onTabOpened(firstTab, true);</span>
<a href="#l10.16"></a><span id="l10.16">               tabMonitor.onTabSwitched(firstTab, null);</span>
<a href="#l10.17"></a><span id="l10.17">             }</span>
<a href="#l10.18"></a><span id="l10.18">           }</span>
<a href="#l10.19"></a><span id="l10.19">         ]]&gt;&lt;/body&gt;</span>
<a href="#l10.20"></a><span id="l10.20">       &lt;/method&gt;</span>
<a href="#l10.21"></a><span id="l10.21">       &lt;method name=&quot;openTab&quot;&gt;</span>
<a href="#l10.22"></a><span id="l10.22" class="difflineat">@@ -559,17 +559,17 @@</span>
<a href="#l10.23"></a><span id="l10.23">           // Make sure the new panel is marked selected.</span>
<a href="#l10.24"></a><span id="l10.24">           oldPanel.removeAttribute(&quot;selected&quot;);</span>
<a href="#l10.25"></a><span id="l10.25">           this.panelContainer.selectedPanel.setAttribute(&quot;selected&quot;, &quot;true&quot;);</span>
<a href="#l10.26"></a><span id="l10.26"> </span>
<a href="#l10.27"></a><span id="l10.27">           let tabOpenFunc = tab.mode.openTab || tab.mode.tabType.openTab;</span>
<a href="#l10.28"></a><span id="l10.28">           tabOpenFunc.apply(tab.mode.tabType, [tab, aArgs]);</span>
<a href="#l10.29"></a><span id="l10.29"> </span>
<a href="#l10.30"></a><span id="l10.30">           let restoreState = this._restoringTabState;</span>
<a href="#l10.31"></a><span id="l10.31" class="difflineminus">-          for each (let [i, tabMonitor] in Iterator(this.tabMonitors)) {</span>
<a href="#l10.32"></a><span id="l10.32" class="difflineplus">+          for (let [i, tabMonitor] of this.tabMonitors.entries()) {</span>
<a href="#l10.33"></a><span id="l10.33">             if ((&quot;onTabRestored&quot; in tabMonitor) &amp;&amp; restoreState &amp;&amp;</span>
<a href="#l10.34"></a><span id="l10.34">                 (tabMonitor.monitorName in restoreState.ext))</span>
<a href="#l10.35"></a><span id="l10.35">               tabMonitor.onTabRestored(tab,</span>
<a href="#l10.36"></a><span id="l10.36">                                        restoreState.ext[tabMonitor.monitorName],</span>
<a href="#l10.37"></a><span id="l10.37">                                        false);</span>
<a href="#l10.38"></a><span id="l10.38">             else if (&quot;onTabOpened&quot; in tabMonitor)</span>
<a href="#l10.39"></a><span id="l10.39">               tabMonitor.onTabOpened(tab, false, oldTab);</span>
<a href="#l10.40"></a><span id="l10.40">             if (!background)</span>
<a href="#l10.41"></a><span id="l10.41" class="difflineat">@@ -703,17 +703,17 @@</span>
<a href="#l10.42"></a><span id="l10.42">             // whether its tabs can be closed or not. For instance, contentTabs</span>
<a href="#l10.43"></a><span id="l10.43">             // and chromeTabs run onbeforeunload event handlers that may</span>
<a href="#l10.44"></a><span id="l10.44">             // exercise their right to prompt the user for confirmation before</span>
<a href="#l10.45"></a><span id="l10.45">             // closing.</span>
<a href="#l10.46"></a><span id="l10.46">             let tryCloseFunc = tab.mode.tryCloseTab || tab.mode.tabType.tryCloseTab;</span>
<a href="#l10.47"></a><span id="l10.47">             if (tryCloseFunc &amp;&amp; !tryCloseFunc.call(tab.mode.tabType, tab))</span>
<a href="#l10.48"></a><span id="l10.48">               return;</span>
<a href="#l10.49"></a><span id="l10.49"> </span>
<a href="#l10.50"></a><span id="l10.50" class="difflineminus">-            for each (let [i, tabMonitor] in Iterator(this.tabMonitors)) {</span>
<a href="#l10.51"></a><span id="l10.51" class="difflineplus">+            for (let [i, tabMonitor] of this.tabMonitors.entries()) {</span>
<a href="#l10.52"></a><span id="l10.52">               if (&quot;onTabClosing&quot; in tabMonitor)</span>
<a href="#l10.53"></a><span id="l10.53">                 tabMonitor.onTabClosing(tab);</span>
<a href="#l10.54"></a><span id="l10.54">             }</span>
<a href="#l10.55"></a><span id="l10.55"> </span>
<a href="#l10.56"></a><span id="l10.56">             if (!aNoUndo) {</span>
<a href="#l10.57"></a><span id="l10.57">               // Allow user to undo accidentially closed tabs</span>
<a href="#l10.58"></a><span id="l10.58">               let session = this.persistTab(tab);</span>
<a href="#l10.59"></a><span id="l10.59"> </span>
<a href="#l10.60"></a><span id="l10.60" class="difflineat">@@ -916,17 +916,17 @@</span>
<a href="#l10.61"></a><span id="l10.61">              Components.utils.reportError(ex);</span>
<a href="#l10.62"></a><span id="l10.62">            }</span>
<a href="#l10.63"></a><span id="l10.63"> </span>
<a href="#l10.64"></a><span id="l10.64">            if (!tabState)</span>
<a href="#l10.65"></a><span id="l10.65">              return null;</span>
<a href="#l10.66"></a><span id="l10.66"> </span>
<a href="#l10.67"></a><span id="l10.67">            let ext = {};</span>
<a href="#l10.68"></a><span id="l10.68"> </span>
<a href="#l10.69"></a><span id="l10.69" class="difflineminus">-           for each (let [i, tabMonitor] in Iterator(this.tabMonitors)) {</span>
<a href="#l10.70"></a><span id="l10.70" class="difflineplus">+           for (let [i, tabMonitor] of this.tabMonitors.entries()) {</span>
<a href="#l10.71"></a><span id="l10.71">              if (&quot;onTabPersist&quot; in tabMonitor) {</span>
<a href="#l10.72"></a><span id="l10.72">                let monState = tabMonitor.onTabPersist(tab);</span>
<a href="#l10.73"></a><span id="l10.73">                if (monState !== null)</span>
<a href="#l10.74"></a><span id="l10.74">                  ext[tabMonitor.monitorName] = monState;</span>
<a href="#l10.75"></a><span id="l10.75">              }</span>
<a href="#l10.76"></a><span id="l10.76">            }</span>
<a href="#l10.77"></a><span id="l10.77"> </span>
<a href="#l10.78"></a><span id="l10.78">            return {mode: tab.mode.name, state: tabState, ext: ext}</span>
<a href="#l10.79"></a><span id="l10.79" class="difflineat">@@ -950,17 +950,17 @@</span>
<a href="#l10.80"></a><span id="l10.80">             // Explicitly specify a revision so we don't wish we had later.</span>
<a href="#l10.81"></a><span id="l10.81">             rev: 0,</span>
<a href="#l10.82"></a><span id="l10.82">             // If our currently selected tab gets persisted, we will update this</span>
<a href="#l10.83"></a><span id="l10.83">             selectedIndex: null,</span>
<a href="#l10.84"></a><span id="l10.84">           };</span>
<a href="#l10.85"></a><span id="l10.85"> </span>
<a href="#l10.86"></a><span id="l10.86">           let tabs = state.tabs = [];</span>
<a href="#l10.87"></a><span id="l10.87"> </span>
<a href="#l10.88"></a><span id="l10.88" class="difflineminus">-          for each (let [iTab, tab] in Iterator(this.tabInfo)) {</span>
<a href="#l10.89"></a><span id="l10.89" class="difflineplus">+          for (let [iTab, tab] of this.tabInfo.entries()) {</span>
<a href="#l10.90"></a><span id="l10.90"> </span>
<a href="#l10.91"></a><span id="l10.91">             let persistTab = this.persistTab(tab);</span>
<a href="#l10.92"></a><span id="l10.92"> </span>
<a href="#l10.93"></a><span id="l10.93">             if (!persistTab)</span>
<a href="#l10.94"></a><span id="l10.94">               continue;</span>
<a href="#l10.95"></a><span id="l10.95"> </span>
<a href="#l10.96"></a><span id="l10.96">             tabs.push(persistTab);</span>
<a href="#l10.97"></a><span id="l10.97"> </span>
<a href="#l10.98"></a><span id="l10.98" class="difflineat">@@ -1005,17 +1005,17 @@</span>
<a href="#l10.99"></a><span id="l10.99">           /**</span>
<a href="#l10.100"></a><span id="l10.100">            * Attempts to restore tabs persisted from a prior call to</span>
<a href="#l10.101"></a><span id="l10.101">            *  |persistTabs|.  This is currently a synchronous operation, but in</span>
<a href="#l10.102"></a><span id="l10.102">            *  the future this may kick off an asynchronous mechanism to restore</span>
<a href="#l10.103"></a><span id="l10.103">            *  the tabs one-by-one.</span>
<a href="#l10.104"></a><span id="l10.104">            */</span>
<a href="#l10.105"></a><span id="l10.105">           let tabs = aPersistedState.tabs;</span>
<a href="#l10.106"></a><span id="l10.106">           let indexToSelect = null;</span>
<a href="#l10.107"></a><span id="l10.107" class="difflineminus">-          for each (let [iTab, tabState] in Iterator(tabs)) {</span>
<a href="#l10.108"></a><span id="l10.108" class="difflineplus">+          for (let [iTab, tabState] of tabs.entries()) {</span>
<a href="#l10.109"></a><span id="l10.109"> </span>
<a href="#l10.110"></a><span id="l10.110">             if (tabState.state.firstTab &amp;&amp; aDontRestoreFirstTab)</span>
<a href="#l10.111"></a><span id="l10.111">               tabState.state.dontRestoreFirstTab = aDontRestoreFirstTab;</span>
<a href="#l10.112"></a><span id="l10.112"> </span>
<a href="#l10.113"></a><span id="l10.113">             if (!this.restoreTab(tabState))</span>
<a href="#l10.114"></a><span id="l10.114">               continue;</span>
<a href="#l10.115"></a><span id="l10.115"> </span>
<a href="#l10.116"></a><span id="l10.116">             // If this persisted tab was the selected one, then mark the newest</span>
<a href="#l10.117"></a><span id="l10.117" class="difflineat">@@ -1150,17 +1150,17 @@</span>
<a href="#l10.118"></a><span id="l10.118"> </span>
<a href="#l10.119"></a><span id="l10.119">               // Update the selected attribute on the current and old tab panel.</span>
<a href="#l10.120"></a><span id="l10.120">               oldPanel.removeAttribute(&quot;selected&quot;);</span>
<a href="#l10.121"></a><span id="l10.121">               this.panelContainer.selectedPanel.setAttribute(&quot;selected&quot;, &quot;true&quot;);</span>
<a href="#l10.122"></a><span id="l10.122"> </span>
<a href="#l10.123"></a><span id="l10.123">               let showTabFunc = tab.mode.showTab || tab.mode.tabType.showTab;</span>
<a href="#l10.124"></a><span id="l10.124">               showTabFunc.call(tab.mode.tabType, tab);</span>
<a href="#l10.125"></a><span id="l10.125"> </span>
<a href="#l10.126"></a><span id="l10.126" class="difflineminus">-              for each (let [i, tabMonitor] in Iterator(this.tabMonitors))</span>
<a href="#l10.127"></a><span id="l10.127" class="difflineplus">+              for (let [i, tabMonitor] of this.tabMonitors.entries())</span>
<a href="#l10.128"></a><span id="l10.128">                 tabMonitor.onTabSwitched(tab, oldTab);</span>
<a href="#l10.129"></a><span id="l10.129"> </span>
<a href="#l10.130"></a><span id="l10.130">               // always update the cursor status when we switch tabs</span>
<a href="#l10.131"></a><span id="l10.131">               SetBusyCursor(window, tab.busy);</span>
<a href="#l10.132"></a><span id="l10.132">               // active tabs should not have the wasBusy attribute</span>
<a href="#l10.133"></a><span id="l10.133">               this.tabContainer.selectedItem.removeAttribute(&quot;wasBusy&quot;);</span>
<a href="#l10.134"></a><span id="l10.134"> </span>
<a href="#l10.135"></a><span id="l10.135">               // update the thinking status when we switch tabs</span>
<a href="#l10.136"></a><span id="l10.136" class="difflineat">@@ -1219,17 +1219,17 @@</span>
<a href="#l10.137"></a><span id="l10.137">               let tabNode =</span>
<a href="#l10.138"></a><span id="l10.138">                 this.tabContainer.childNodes[iTab];</span>
<a href="#l10.139"></a><span id="l10.139"> </span>
<a href="#l10.140"></a><span id="l10.140">               let titleChangeFunc = tab.mode.onTitleChanged ||</span>
<a href="#l10.141"></a><span id="l10.141">                                     tab.mode.tabType.onTitleChanged;</span>
<a href="#l10.142"></a><span id="l10.142">               if (titleChangeFunc)</span>
<a href="#l10.143"></a><span id="l10.143">                 titleChangeFunc.call(tab.mode.tabType, tab, tabNode);</span>
<a href="#l10.144"></a><span id="l10.144"> </span>
<a href="#l10.145"></a><span id="l10.145" class="difflineminus">-              for each (let [, tabMonitor] in Iterator(this.tabMonitors))</span>
<a href="#l10.146"></a><span id="l10.146" class="difflineplus">+              for (let tabMonitor of this.tabMonitors)</span>
<a href="#l10.147"></a><span id="l10.147">                 tabMonitor.onTabTitleChanged(tab);</span>
<a href="#l10.148"></a><span id="l10.148"> </span>
<a href="#l10.149"></a><span id="l10.149">               // If the displayed tab is the one at the moment of creation</span>
<a href="#l10.150"></a><span id="l10.150">               // (aTabNodeOrInfo is null), set the default title as its title.</span>
<a href="#l10.151"></a><span id="l10.151">               tabNode.setAttribute(&quot;label&quot;, aTabNodeOrInfo ?</span>
<a href="#l10.152"></a><span id="l10.152">                                             tab.title :</span>
<a href="#l10.153"></a><span id="l10.153">                                             document.documentElement.getAttribute(&quot;defaultTabTitle&quot;));</span>
<a href="#l10.154"></a><span id="l10.154"> </span>
<a href="#l10.155"></a><span id="l10.155" class="difflineat">@@ -1399,17 +1399,17 @@</span>
<a href="#l10.156"></a><span id="l10.156">           &lt;![CDATA[</span>
<a href="#l10.157"></a><span id="l10.157">             let tab = this.currentTabInfo;</span>
<a href="#l10.158"></a><span id="l10.158"> </span>
<a href="#l10.159"></a><span id="l10.159">             // This can happen if we're starting up and haven't got a tab</span>
<a href="#l10.160"></a><span id="l10.160">             // loaded yet.</span>
<a href="#l10.161"></a><span id="l10.161">             if (!tab)</span>
<a href="#l10.162"></a><span id="l10.162">               return false;</span>
<a href="#l10.163"></a><span id="l10.163"> </span>
<a href="#l10.164"></a><span id="l10.164" class="difflineminus">-            for each (let [, tabMonitor] in Iterator(this.tabMonitors)) {</span>
<a href="#l10.165"></a><span id="l10.165" class="difflineplus">+            for (let tabMonitor of this.tabMonitors) {</span>
<a href="#l10.166"></a><span id="l10.166">               if (&quot;supportsCommand&quot; in tabMonitor) {</span>
<a href="#l10.167"></a><span id="l10.167">                 let result = tabMonitor.supportsCommand(aCommand, tab);</span>
<a href="#l10.168"></a><span id="l10.168">                 if (result !== null)</span>
<a href="#l10.169"></a><span id="l10.169">                   return result;</span>
<a href="#l10.170"></a><span id="l10.170">               }</span>
<a href="#l10.171"></a><span id="l10.171">             }</span>
<a href="#l10.172"></a><span id="l10.172"> </span>
<a href="#l10.173"></a><span id="l10.173">             let supportsCommandFunc = tab.mode.supportsCommand ||</span>
<a href="#l10.174"></a><span id="l10.174" class="difflineat">@@ -1427,17 +1427,17 @@</span>
<a href="#l10.175"></a><span id="l10.175">           &lt;![CDATA[</span>
<a href="#l10.176"></a><span id="l10.176">             let tab = this.currentTabInfo;</span>
<a href="#l10.177"></a><span id="l10.177"> </span>
<a href="#l10.178"></a><span id="l10.178">             // This can happen if we're starting up and haven't got a tab</span>
<a href="#l10.179"></a><span id="l10.179">             // loaded yet.</span>
<a href="#l10.180"></a><span id="l10.180">             if (!tab)</span>
<a href="#l10.181"></a><span id="l10.181">               return false;</span>
<a href="#l10.182"></a><span id="l10.182"> </span>
<a href="#l10.183"></a><span id="l10.183" class="difflineminus">-            for each (let [, tabMonitor] in Iterator(this.tabMonitors)) {</span>
<a href="#l10.184"></a><span id="l10.184" class="difflineplus">+            for (let tabMonitor of this.tabMonitors) {</span>
<a href="#l10.185"></a><span id="l10.185">               if (&quot;isCommandEnabled&quot; in tabMonitor) {</span>
<a href="#l10.186"></a><span id="l10.186">                 let result = tabMonitor.isCommandEnabled(aCommand, tab);</span>
<a href="#l10.187"></a><span id="l10.187">                 if (result !== null)</span>
<a href="#l10.188"></a><span id="l10.188">                   return result;</span>
<a href="#l10.189"></a><span id="l10.189">               }</span>
<a href="#l10.190"></a><span id="l10.190">             }</span>
<a href="#l10.191"></a><span id="l10.191"> </span>
<a href="#l10.192"></a><span id="l10.192">             let isCommandEnabledFunc = tab.mode.isCommandEnabled ||</span>
<a href="#l10.193"></a><span id="l10.193" class="difflineat">@@ -1455,17 +1455,17 @@</span>
<a href="#l10.194"></a><span id="l10.194">           &lt;![CDATA[</span>
<a href="#l10.195"></a><span id="l10.195">             let tab = this.currentTabInfo;</span>
<a href="#l10.196"></a><span id="l10.196"> </span>
<a href="#l10.197"></a><span id="l10.197">             // This can happen if we're starting up and haven't got a tab</span>
<a href="#l10.198"></a><span id="l10.198">             // loaded yet.</span>
<a href="#l10.199"></a><span id="l10.199">             if (!tab)</span>
<a href="#l10.200"></a><span id="l10.200">               return;</span>
<a href="#l10.201"></a><span id="l10.201"> </span>
<a href="#l10.202"></a><span id="l10.202" class="difflineminus">-            for each (let [, tabMonitor] in Iterator(this.tabMonitors)) {</span>
<a href="#l10.203"></a><span id="l10.203" class="difflineplus">+            for (let tabMonitor of this.tabMonitors) {</span>
<a href="#l10.204"></a><span id="l10.204">               if (&quot;doCommand&quot; in tabMonitor) {</span>
<a href="#l10.205"></a><span id="l10.205">                 let result = tabMonitor.doCommand(aCommand, tab);</span>
<a href="#l10.206"></a><span id="l10.206">                 if (result === true)</span>
<a href="#l10.207"></a><span id="l10.207">                   return;</span>
<a href="#l10.208"></a><span id="l10.208">               }</span>
<a href="#l10.209"></a><span id="l10.209">             }</span>
<a href="#l10.210"></a><span id="l10.210"> </span>
<a href="#l10.211"></a><span id="l10.211">             let doCommandFunc = tab.mode.doCommand ||</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l11.1"></a><span id="l11.1" class="difflineminus">--- a/mail/base/modules/MailUtils.js</span>
<a href="#l11.2"></a><span id="l11.2" class="difflineplus">+++ b/mail/base/modules/MailUtils.js</span>
<a href="#l11.3"></a><span id="l11.3" class="difflineat">@@ -184,17 +184,17 @@ var MailUtils =</span>
<a href="#l11.4"></a><span id="l11.4">           aTabmail = mail3PaneWindow.document.getElementById(&quot;tabmail&quot;);</span>
<a href="#l11.5"></a><span id="l11.5">       }</span>
<a href="#l11.6"></a><span id="l11.6"> </span>
<a href="#l11.7"></a><span id="l11.7">       if (aTabmail) {</span>
<a href="#l11.8"></a><span id="l11.8">         if (this.confirmAction(aMsgHdrs.length, &quot;openTabWarningTitle&quot;,</span>
<a href="#l11.9"></a><span id="l11.9">                                &quot;openTabWarningConfirmation&quot;,</span>
<a href="#l11.10"></a><span id="l11.10">                                &quot;mailnews.open_tab_warning&quot;))</span>
<a href="#l11.11"></a><span id="l11.11">           return;</span>
<a href="#l11.12"></a><span id="l11.12" class="difflineminus">-        for each (let [i, msgHdr] in Iterator(aMsgHdrs))</span>
<a href="#l11.13"></a><span id="l11.13" class="difflineplus">+        for (let [i, msgHdr] of aMsgHdrs.entries())</span>
<a href="#l11.14"></a><span id="l11.14">           // Open all the tabs in the background, except for the last one</span>
<a href="#l11.15"></a><span id="l11.15">           aTabmail.openTab(&quot;message&quot;, {msgHdr: msgHdr,</span>
<a href="#l11.16"></a><span id="l11.16">               viewWrapperToClone: aViewWrapperToClone,</span>
<a href="#l11.17"></a><span id="l11.17">               background: (i &lt; (aMsgHdrs.length - 1)),</span>
<a href="#l11.18"></a><span id="l11.18">               disregardOpener: (aMsgHdrs.length &gt; 1),</span>
<a href="#l11.19"></a><span id="l11.19">           });</span>
<a href="#l11.20"></a><span id="l11.20"> </span>
<a href="#l11.21"></a><span id="l11.21">         if (mail3PaneWindow)</span>
<a href="#l11.22"></a><span id="l11.22" class="difflineat">@@ -257,17 +257,17 @@ var MailUtils =</span>
<a href="#l11.23"></a><span id="l11.23">    openMessagesInNewWindows:</span>
<a href="#l11.24"></a><span id="l11.24">        function MailUtils_openMessagesInNewWindows(aMsgHdrs,</span>
<a href="#l11.25"></a><span id="l11.25">                                                    aViewWrapperToClone) {</span>
<a href="#l11.26"></a><span id="l11.26">     if (this.confirmAction(aMsgHdrs.length, &quot;openWindowWarningTitle&quot;,</span>
<a href="#l11.27"></a><span id="l11.27">                            &quot;openWindowWarningConfirmation&quot;,</span>
<a href="#l11.28"></a><span id="l11.28">                            &quot;mailnews.open_window_warning&quot;))</span>
<a href="#l11.29"></a><span id="l11.29">       return;</span>
<a href="#l11.30"></a><span id="l11.30"> </span>
<a href="#l11.31"></a><span id="l11.31" class="difflineminus">-    for each (let [, msgHdr] in Iterator(aMsgHdrs))</span>
<a href="#l11.32"></a><span id="l11.32" class="difflineplus">+    for (let msgHdr of aMsgHdrs)</span>
<a href="#l11.33"></a><span id="l11.33">       this.openMessageInNewWindow(msgHdr, aViewWrapperToClone);</span>
<a href="#l11.34"></a><span id="l11.34">   },</span>
<a href="#l11.35"></a><span id="l11.35"> </span>
<a href="#l11.36"></a><span id="l11.36">   /**</span>
<a href="#l11.37"></a><span id="l11.37">    * Display this message header in a folder tab in a 3pane window. This is</span>
<a href="#l11.38"></a><span id="l11.38">    * useful when the message needs to be displayed in the context of its folder</span>
<a href="#l11.39"></a><span id="l11.39">    * or thread.</span>
<a href="#l11.40"></a><span id="l11.40">    *</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l12.1"></a><span id="l12.1" class="difflineminus">--- a/mail/base/modules/dbViewWrapper.js</span>
<a href="#l12.2"></a><span id="l12.2" class="difflineplus">+++ b/mail/base/modules/dbViewWrapper.js</span>
<a href="#l12.3"></a><span id="l12.3" class="difflineat">@@ -108,17 +108,17 @@ var FolderNotificationHelper = {</span>
<a href="#l12.4"></a><span id="l12.4">    * @param aNotherFolder A folder that may or may not be in aFolders.</span>
<a href="#l12.5"></a><span id="l12.5">    * @param aViewWrapper The view wrapper that is up to no good.</span>
<a href="#l12.6"></a><span id="l12.6">    */</span>
<a href="#l12.7"></a><span id="l12.7">   stalkFolders: function FolderNotificationHelper_stalkFolders(</span>
<a href="#l12.8"></a><span id="l12.8">       aFolders, aNotherFolder, aViewWrapper) {</span>
<a href="#l12.9"></a><span id="l12.9">     let folders = aFolders ? aFolders.concat() : [];</span>
<a href="#l12.10"></a><span id="l12.10">     if (aNotherFolder &amp;&amp; !folders.includes(aNotherFolder))</span>
<a href="#l12.11"></a><span id="l12.11">       folders.push(aNotherFolder);</span>
<a href="#l12.12"></a><span id="l12.12" class="difflineminus">-    for each (let [, folder] in Iterator(folders)) {</span>
<a href="#l12.13"></a><span id="l12.13" class="difflineplus">+    for (let folder of folders) {</span>
<a href="#l12.14"></a><span id="l12.14">       let wrappers = this._interestedWrappers[folder.URI];</span>
<a href="#l12.15"></a><span id="l12.15">       if (wrappers == null)</span>
<a href="#l12.16"></a><span id="l12.16">         wrappers = this._interestedWrappers[folder.URI] = [];</span>
<a href="#l12.17"></a><span id="l12.17">       wrappers.push(aViewWrapper);</span>
<a href="#l12.18"></a><span id="l12.18">     }</span>
<a href="#l12.19"></a><span id="l12.19">   },</span>
<a href="#l12.20"></a><span id="l12.20"> </span>
<a href="#l12.21"></a><span id="l12.21">   /**</span>
<a href="#l12.22"></a><span id="l12.22" class="difflineat">@@ -153,63 +153,63 @@ var FolderNotificationHelper = {</span>
<a href="#l12.23"></a><span id="l12.23">    *  wrapper.</span>
<a href="#l12.24"></a><span id="l12.24">    */</span>
<a href="#l12.25"></a><span id="l12.25">   removeNotifications: function FolderNotificationHelper_removeNotifications(</span>
<a href="#l12.26"></a><span id="l12.26">       aFolders, aViewWrapper) {</span>
<a href="#l12.27"></a><span id="l12.27">     if (!aFolders) {</span>
<a href="#l12.28"></a><span id="l12.28">       this._curiousWrappers.splice(this._curiousWrappers.indexOf(aViewWrapper), 1);</span>
<a href="#l12.29"></a><span id="l12.29">       return;</span>
<a href="#l12.30"></a><span id="l12.30">     }</span>
<a href="#l12.31"></a><span id="l12.31" class="difflineminus">-    for each (let [, folder] in Iterator(aFolders)) {</span>
<a href="#l12.32"></a><span id="l12.32" class="difflineplus">+    for (let folder of aFolders) {</span>
<a href="#l12.33"></a><span id="l12.33">       this._removeWrapperFromListener(</span>
<a href="#l12.34"></a><span id="l12.34">         this._interestedWrappers, folder, aViewWrapper);</span>
<a href="#l12.35"></a><span id="l12.35">       this._removeWrapperFromListener(</span>
<a href="#l12.36"></a><span id="l12.36">         this._pendingFolderUriToViewWrapperLists, folder, aViewWrapper);</span>
<a href="#l12.37"></a><span id="l12.37">     }</span>
<a href="#l12.38"></a><span id="l12.38">   },</span>
<a href="#l12.39"></a><span id="l12.39"> </span>
<a href="#l12.40"></a><span id="l12.40">   /**</span>
<a href="#l12.41"></a><span id="l12.41">    * @return true if there are any listeners still registered.  This is intended</span>
<a href="#l12.42"></a><span id="l12.42">    *     to support debugging code.  If you are not debug code, you are a bad</span>
<a href="#l12.43"></a><span id="l12.43">    *     person/code.</span>
<a href="#l12.44"></a><span id="l12.44">    */</span>
<a href="#l12.45"></a><span id="l12.45">   haveListeners: function FolderNotificationHelper_haveListeners() {</span>
<a href="#l12.46"></a><span id="l12.46" class="difflineminus">-    for each (let [folderURI, wrappers] in</span>
<a href="#l12.47"></a><span id="l12.47" class="difflineminus">-              Iterator(this._pendingFolderUriToViewWrapperLists)) {</span>
<a href="#l12.48"></a><span id="l12.48" class="difflineplus">+    for (let folderURI in this._pendingFolderUriToViewWrapperLists) {</span>
<a href="#l12.49"></a><span id="l12.49" class="difflineplus">+      let wrappers = this._pendingFolderUriToViewWrapperLists[folderURI];</span>
<a href="#l12.50"></a><span id="l12.50">       return true;</span>
<a href="#l12.51"></a><span id="l12.51">     }</span>
<a href="#l12.52"></a><span id="l12.52" class="difflineminus">-    for each (let [folderURI, wrappers] in</span>
<a href="#l12.53"></a><span id="l12.53" class="difflineminus">-              Iterator(this._interestedWrappers)) {</span>
<a href="#l12.54"></a><span id="l12.54" class="difflineplus">+    for (let folderURI in this._interestedWrappers) {</span>
<a href="#l12.55"></a><span id="l12.55" class="difflineplus">+      let wrappers = this._interestedWrappers[folderURI];</span>
<a href="#l12.56"></a><span id="l12.56">       return true;</span>
<a href="#l12.57"></a><span id="l12.57">     }</span>
<a href="#l12.58"></a><span id="l12.58">     return this._curiousWrappers.length != 0;</span>
<a href="#l12.59"></a><span id="l12.59">   },</span>
<a href="#l12.60"></a><span id="l12.60"> </span>
<a href="#l12.61"></a><span id="l12.61">   /* ***** Notifications ***** */</span>
<a href="#l12.62"></a><span id="l12.62">   _notifyHelper: function FolderNotificationHelper__notifyHelper(aFolder,</span>
<a href="#l12.63"></a><span id="l12.63">                                                                  aHandlerName) {</span>
<a href="#l12.64"></a><span id="l12.64">     let wrappers = this._interestedWrappers[aFolder.URI];</span>
<a href="#l12.65"></a><span id="l12.65">     if (wrappers) {</span>
<a href="#l12.66"></a><span id="l12.66">       // clone the list to avoid confusing mutation by listeners</span>
<a href="#l12.67"></a><span id="l12.67" class="difflineminus">-      for each (let [, wrapper] in Iterator(wrappers.concat())) {</span>
<a href="#l12.68"></a><span id="l12.68" class="difflineplus">+      for (let wrapper of wrappers.concat()) {</span>
<a href="#l12.69"></a><span id="l12.69">         wrapper[aHandlerName](aFolder);</span>
<a href="#l12.70"></a><span id="l12.70">       }</span>
<a href="#l12.71"></a><span id="l12.71">     }</span>
<a href="#l12.72"></a><span id="l12.72" class="difflineminus">-    for each (let wrapper in this._curiousWrappers)</span>
<a href="#l12.73"></a><span id="l12.73" class="difflineplus">+    for (let wrapper of this._curiousWrappers)</span>
<a href="#l12.74"></a><span id="l12.74">       wrapper[aHandlerName](aFolder);</span>
<a href="#l12.75"></a><span id="l12.75">   },</span>
<a href="#l12.76"></a><span id="l12.76"> </span>
<a href="#l12.77"></a><span id="l12.77">   OnItemEvent: function FolderNotificationHelper_OnItemEvent(</span>
<a href="#l12.78"></a><span id="l12.78">       aFolder, aEvent) {</span>
<a href="#l12.79"></a><span id="l12.79">     let eventType = aEvent.toString();</span>
<a href="#l12.80"></a><span id="l12.80">     if (eventType == &quot;FolderLoaded&quot;) {</span>
<a href="#l12.81"></a><span id="l12.81">       let folderURI = aFolder.URI;</span>
<a href="#l12.82"></a><span id="l12.82">       let widgets = this._pendingFolderUriToViewWrapperLists[folderURI];</span>
<a href="#l12.83"></a><span id="l12.83">       if (widgets) {</span>
<a href="#l12.84"></a><span id="l12.84" class="difflineminus">-        for each (let [, widget] in Iterator(widgets)) {</span>
<a href="#l12.85"></a><span id="l12.85" class="difflineplus">+        for (let widget of widgets) {</span>
<a href="#l12.86"></a><span id="l12.86">           // we are friends, this is an explicit relationship.</span>
<a href="#l12.87"></a><span id="l12.87">           // (we don't use a generic callback mechanism because the 'this' stuff</span>
<a href="#l12.88"></a><span id="l12.88">           //  gets ugly and no one else should be hooking in at this level.)</span>
<a href="#l12.89"></a><span id="l12.89">           try {</span>
<a href="#l12.90"></a><span id="l12.90">             widget._folderLoaded(aFolder);</span>
<a href="#l12.91"></a><span id="l12.91">           }</span>
<a href="#l12.92"></a><span id="l12.92">           catch (ex) {</span>
<a href="#l12.93"></a><span id="l12.93">             dump(&quot;``` EXCEPTION DURING NOTIFY: &quot; + ex.fileName + &quot;:&quot; +</span>
<a href="#l12.94"></a><span id="l12.94" class="difflineat">@@ -257,17 +257,17 @@ var FolderNotificationHelper = {</span>
<a href="#l12.95"></a><span id="l12.95">       this._interestedWrappers[newURI] =</span>
<a href="#l12.96"></a><span id="l12.96">         this._interestedWrappers[oldURI];</span>
<a href="#l12.97"></a><span id="l12.97">       delete this._interestedWrappers[oldURI];</span>
<a href="#l12.98"></a><span id="l12.98">     }</span>
<a href="#l12.99"></a><span id="l12.99"> </span>
<a href="#l12.100"></a><span id="l12.100">     let wrappers = this._interestedWrappers[newURI];</span>
<a href="#l12.101"></a><span id="l12.101">     if (wrappers) {</span>
<a href="#l12.102"></a><span id="l12.102">       // clone the list to avoid confusing mutation by listeners</span>
<a href="#l12.103"></a><span id="l12.103" class="difflineminus">-      for each (let [, wrapper] in Iterator(wrappers.concat())) {</span>
<a href="#l12.104"></a><span id="l12.104" class="difflineplus">+      for (let wrapper of wrappers.concat()) {</span>
<a href="#l12.105"></a><span id="l12.105">         wrapper._folderMoved(aOldFolder, aNewFolder);</span>
<a href="#l12.106"></a><span id="l12.106">       }</span>
<a href="#l12.107"></a><span id="l12.107">     }</span>
<a href="#l12.108"></a><span id="l12.108">   },</span>
<a href="#l12.109"></a><span id="l12.109"> </span>
<a href="#l12.110"></a><span id="l12.110">   /**</span>
<a href="#l12.111"></a><span id="l12.111">    * Update our URI mapping tables when renames happen.</span>
<a href="#l12.112"></a><span id="l12.112">    */</span>
<a href="#l12.113"></a><span id="l12.113" class="difflineat">@@ -285,17 +285,17 @@ var FolderNotificationHelper = {</span>
<a href="#l12.114"></a><span id="l12.114">        this._folderMoveHelper(aSrcFolder, aNewFolder);</span>
<a href="#l12.115"></a><span id="l12.115">      }</span>
<a href="#l12.116"></a><span id="l12.116">   },</span>
<a href="#l12.117"></a><span id="l12.117"> </span>
<a href="#l12.118"></a><span id="l12.118">   folderDeleted: function FolderNotificationHelper_folderDeleted(aFolder) {</span>
<a href="#l12.119"></a><span id="l12.119">     let wrappers = this._interestedWrappers[aFolder.URI];</span>
<a href="#l12.120"></a><span id="l12.120">     if (wrappers) {</span>
<a href="#l12.121"></a><span id="l12.121">       // clone the list to avoid confusing mutation by listeners</span>
<a href="#l12.122"></a><span id="l12.122" class="difflineminus">-      for each (let [, wrapper] in Iterator(wrappers.concat())) {</span>
<a href="#l12.123"></a><span id="l12.123" class="difflineplus">+      for (let wrapper of wrappers.concat()) {</span>
<a href="#l12.124"></a><span id="l12.124">         wrapper._folderDeleted(aFolder);</span>
<a href="#l12.125"></a><span id="l12.125">       }</span>
<a href="#l12.126"></a><span id="l12.126">       // if the folder is deleted, it's not going to ever do anything again</span>
<a href="#l12.127"></a><span id="l12.127">       delete this._interestedWrappers[aFolder.URI];</span>
<a href="#l12.128"></a><span id="l12.128">     }</span>
<a href="#l12.129"></a><span id="l12.129">   },</span>
<a href="#l12.130"></a><span id="l12.130"> };</span>
<a href="#l12.131"></a><span id="l12.131"> FolderNotificationHelper._init();</span>
<a href="#l12.132"></a><span id="l12.132" class="difflineat">@@ -579,21 +579,17 @@ DBViewWrapper.prototype = {</span>
<a href="#l12.133"></a><span id="l12.133">    * Check if the folder in question backs the currently displayed folder.  For</span>
<a href="#l12.134"></a><span id="l12.134">    *  a virtual folder, this is a test of whether the virtual folder includes</span>
<a href="#l12.135"></a><span id="l12.135">    *  messages from the given folder.  For a 'real' single folder, this is</span>
<a href="#l12.136"></a><span id="l12.136">    *  effectively a test against displayedFolder.</span>
<a href="#l12.137"></a><span id="l12.137">    * If you want to see if the displayed folder is a folder, just compare</span>
<a href="#l12.138"></a><span id="l12.138">    *  against the displayedFolder attribute.</span>
<a href="#l12.139"></a><span id="l12.139">    */</span>
<a href="#l12.140"></a><span id="l12.140">   isUnderlyingFolder: function DBViewWrapper_isUnderlyingFolder(aFolder) {</span>
<a href="#l12.141"></a><span id="l12.141" class="difflineminus">-    for each (let [i,underlyingFolder] in Iterator(this._underlyingFolders)) {</span>
<a href="#l12.142"></a><span id="l12.142" class="difflineminus">-      if (aFolder == underlyingFolder)</span>
<a href="#l12.143"></a><span id="l12.143" class="difflineminus">-        return true;</span>
<a href="#l12.144"></a><span id="l12.144" class="difflineminus">-    }</span>
<a href="#l12.145"></a><span id="l12.145" class="difflineminus">-    return false;</span>
<a href="#l12.146"></a><span id="l12.146" class="difflineplus">+    return this._underlyingFolders.some(underlyingFolder =&gt; aFolder == underlyingFolder);</span>
<a href="#l12.147"></a><span id="l12.147">   },</span>
<a href="#l12.148"></a><span id="l12.148"> </span>
<a href="#l12.149"></a><span id="l12.149">   /**</span>
<a href="#l12.150"></a><span id="l12.150">    * Refresh the view by re-creating the view.  You would do this to get rid of</span>
<a href="#l12.151"></a><span id="l12.151">    *  messages that no longer match the view but are kept around for view</span>
<a href="#l12.152"></a><span id="l12.152">    *  stability reasons.  (In other words, in an unread-messages view, you would</span>
<a href="#l12.153"></a><span id="l12.153">    *  go insane if when you clicked on a message it immediately disappeared</span>
<a href="#l12.154"></a><span id="l12.154">    *  because it no longer matched.)</span>
<a href="#l12.155"></a><span id="l12.155" class="difflineat">@@ -710,17 +706,17 @@ DBViewWrapper.prototype = {</span>
<a href="#l12.156"></a><span id="l12.156">       this.folderLoading = false;</span>
<a href="#l12.157"></a><span id="l12.157">       this.displayedFolder = null;</span>
<a href="#l12.158"></a><span id="l12.158">     }</span>
<a href="#l12.159"></a><span id="l12.159"> </span>
<a href="#l12.160"></a><span id="l12.160">     FolderNotificationHelper.removeNotifications(this._underlyingFolders,</span>
<a href="#l12.161"></a><span id="l12.161">                                                  this);</span>
<a href="#l12.162"></a><span id="l12.162">     if (this._underlyingFolders) {</span>
<a href="#l12.163"></a><span id="l12.163">       // (potentially) zero out the underlying msgDatabase references</span>
<a href="#l12.164"></a><span id="l12.164" class="difflineminus">-      for each (let [, folder] in Iterator(this._underlyingFolders))</span>
<a href="#l12.165"></a><span id="l12.165" class="difflineplus">+      for (let folder of this._underlyingFolders)</span>
<a href="#l12.166"></a><span id="l12.166">         this._releaseFolderDatabase(folder);</span>
<a href="#l12.167"></a><span id="l12.167">     }</span>
<a href="#l12.168"></a><span id="l12.168"> </span>
<a href="#l12.169"></a><span id="l12.169">     // kill off the view and its search association</span>
<a href="#l12.170"></a><span id="l12.170">     if (this.dbView) {</span>
<a href="#l12.171"></a><span id="l12.171">       this.listener.onDestroyingView(false);</span>
<a href="#l12.172"></a><span id="l12.172">       this.search.dissociateView(this.dbView);</span>
<a href="#l12.173"></a><span id="l12.173">       this.dbView.setTree(null);</span>
<a href="#l12.174"></a><span id="l12.174" class="difflineat">@@ -946,18 +942,17 @@ DBViewWrapper.prototype = {</span>
<a href="#l12.175"></a><span id="l12.175">         (viewType == nsMsgViewType.eShowWatchedThreadsWithUnread))</span>
<a href="#l12.176"></a><span id="l12.176">       this._setSpecialView(viewType);</span>
<a href="#l12.177"></a><span id="l12.177"> </span>
<a href="#l12.178"></a><span id="l12.178">     // - retrieve virtual folder configuration</span>
<a href="#l12.179"></a><span id="l12.179">     if (aFolder.flags &amp; nsMsgFolderFlags.Virtual) {</span>
<a href="#l12.180"></a><span id="l12.180">       let virtFolder = VirtualFolderHelper.wrapVirtualFolder(aFolder);</span>
<a href="#l12.181"></a><span id="l12.181">       // Filter out the server roots; they only exist for UI reasons.</span>
<a href="#l12.182"></a><span id="l12.182">       this._underlyingFolders =</span>
<a href="#l12.183"></a><span id="l12.183" class="difflineminus">-        [folder for each ([, folder] in Iterator(virtFolder.searchFolders))</span>
<a href="#l12.184"></a><span id="l12.184" class="difflineminus">-                if (!folder.isServer)];</span>
<a href="#l12.185"></a><span id="l12.185" class="difflineplus">+        virtFolder.searchFolders.filter(folder =&gt; !folder.isServer);</span>
<a href="#l12.186"></a><span id="l12.186">       this._underlyingData = (this._underlyingFolders.length &gt; 1) ?</span>
<a href="#l12.187"></a><span id="l12.187">                              this.kUnderlyingMultipleFolder :</span>
<a href="#l12.188"></a><span id="l12.188">                              this.kUnderlyingRealFolder;</span>
<a href="#l12.189"></a><span id="l12.189"> </span>
<a href="#l12.190"></a><span id="l12.190">       // figure out if we are using online IMAP searching</span>
<a href="#l12.191"></a><span id="l12.191">       this.search.onlineSearch = virtFolder.onlineSearch;</span>
<a href="#l12.192"></a><span id="l12.192"> </span>
<a href="#l12.193"></a><span id="l12.193">       // retrieve and chew the search query</span>
<a href="#l12.194"></a><span id="l12.194" class="difflineat">@@ -1155,17 +1150,17 @@ DBViewWrapper.prototype = {</span>
<a href="#l12.195"></a><span id="l12.195">    * Renames, moves to the trash, it's all crazy.  We have to update all our</span>
<a href="#l12.196"></a><span id="l12.196">    *  references when this happens.</span>
<a href="#l12.197"></a><span id="l12.197">    */</span>
<a href="#l12.198"></a><span id="l12.198">   _folderMoved: function DBViewWrapper__folderMoved(aOldFolder, aNewFolder) {</span>
<a href="#l12.199"></a><span id="l12.199">     if (aOldFolder == this.displayedFolder)</span>
<a href="#l12.200"></a><span id="l12.200">       this.displayedFolder = aNewFolder;</span>
<a href="#l12.201"></a><span id="l12.201"> </span>
<a href="#l12.202"></a><span id="l12.202">     // indexOf doesn't work for this (reliably)</span>
<a href="#l12.203"></a><span id="l12.203" class="difflineminus">-    for each (let [i,underlyingFolder] in Iterator(this._underlyingFolders)) {</span>
<a href="#l12.204"></a><span id="l12.204" class="difflineplus">+    for (let [i, underlyingFolder] of this._underlyingFolders.entries()) {</span>
<a href="#l12.205"></a><span id="l12.205">       if (aOldFolder == underlyingFolder) {</span>
<a href="#l12.206"></a><span id="l12.206">         this._underlyingFolders[i] = aNewFolder;</span>
<a href="#l12.207"></a><span id="l12.207">         break;</span>
<a href="#l12.208"></a><span id="l12.208">       }</span>
<a href="#l12.209"></a><span id="l12.209">     }</span>
<a href="#l12.210"></a><span id="l12.210"> </span>
<a href="#l12.211"></a><span id="l12.211">     // re-populate the view.</span>
<a href="#l12.212"></a><span id="l12.212">     this._applyViewChanges();</span>
<a href="#l12.213"></a><span id="l12.213" class="difflineat">@@ -1191,17 +1186,17 @@ DBViewWrapper.prototype = {</span>
<a href="#l12.214"></a><span id="l12.214">       return;</span>
<a href="#l12.215"></a><span id="l12.215"> </span>
<a href="#l12.216"></a><span id="l12.216">     if (aFolder == this.displayedFolder) {</span>
<a href="#l12.217"></a><span id="l12.217">       this.close();</span>
<a href="#l12.218"></a><span id="l12.218">       return;</span>
<a href="#l12.219"></a><span id="l12.219">     }</span>
<a href="#l12.220"></a><span id="l12.220"> </span>
<a href="#l12.221"></a><span id="l12.221">     // indexOf doesn't work for this (reliably)</span>
<a href="#l12.222"></a><span id="l12.222" class="difflineminus">-    for each (let [i,underlyingFolder] in Iterator(this._underlyingFolders)) {</span>
<a href="#l12.223"></a><span id="l12.223" class="difflineplus">+    for (let [i, underlyingFolder] of this._underlyingFolders.entries()) {</span>
<a href="#l12.224"></a><span id="l12.224">       if (aFolder == underlyingFolder) {</span>
<a href="#l12.225"></a><span id="l12.225">         this._underlyingFolders.splice(i,1);</span>
<a href="#l12.226"></a><span id="l12.226">         break;</span>
<a href="#l12.227"></a><span id="l12.227">       }</span>
<a href="#l12.228"></a><span id="l12.228">     }</span>
<a href="#l12.229"></a><span id="l12.229"> </span>
<a href="#l12.230"></a><span id="l12.230">     if (this._underlyingFolders.length == 0) {</span>
<a href="#l12.231"></a><span id="l12.231">       this.close();</span>
<a href="#l12.232"></a><span id="l12.232" class="difflineat">@@ -1630,17 +1625,17 @@ DBViewWrapper.prototype = {</span>
<a href="#l12.233"></a><span id="l12.233">    * @param aViewFlags Optional set of view flags to consider instead of the</span>
<a href="#l12.234"></a><span id="l12.234">    *     potentially live view flags.</span>
<a href="#l12.235"></a><span id="l12.235">    */</span>
<a href="#l12.236"></a><span id="l12.236">   _ensureValidSort: function DBViewWrapper_ensureValidSort(aViewFlags) {</span>
<a href="#l12.237"></a><span id="l12.237">     if ((aViewFlags != null ? aViewFlags : this._viewFlags) &amp;</span>
<a href="#l12.238"></a><span id="l12.238">         nsMsgViewFlagsType.kGroupBySort) {</span>
<a href="#l12.239"></a><span id="l12.239">       // We cannot be sorting by thread, id, none, or size.  If we are, switch</span>
<a href="#l12.240"></a><span id="l12.240">       //  to sorting by date.</span>
<a href="#l12.241"></a><span id="l12.241" class="difflineminus">-      for each (let [, sortPair] in Iterator(this._sort)) {</span>
<a href="#l12.242"></a><span id="l12.242" class="difflineplus">+      for (let sortPair of this._sort) {</span>
<a href="#l12.243"></a><span id="l12.243">         let sortType = sortPair[0];</span>
<a href="#l12.244"></a><span id="l12.244">         if (sortType == nsMsgViewSortType.byThread ||</span>
<a href="#l12.245"></a><span id="l12.245">             sortType == nsMsgViewSortType.byId ||</span>
<a href="#l12.246"></a><span id="l12.246">             sortType == nsMsgViewSortType.byNone ||</span>
<a href="#l12.247"></a><span id="l12.247">             sortType == nsMsgViewSortType.bySize) {</span>
<a href="#l12.248"></a><span id="l12.248">           this._sort = [[nsMsgViewSortType.byDate, this._sort[0][1]]];</span>
<a href="#l12.249"></a><span id="l12.249">           break;</span>
<a href="#l12.250"></a><span id="l12.250">         }</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l13.1"></a><span id="l13.1" class="difflineminus">--- a/mail/base/modules/mailMigrator.js</span>
<a href="#l13.2"></a><span id="l13.2" class="difflineplus">+++ b/mail/base/modules/mailMigrator.js</span>
<a href="#l13.3"></a><span id="l13.3" class="difflineat">@@ -22,17 +22,17 @@ Cu.import(&quot;resource:///modules/IOUtils.j</span>
<a href="#l13.4"></a><span id="l13.4"> </span>
<a href="#l13.5"></a><span id="l13.5"> var MailMigrator = {</span>
<a href="#l13.6"></a><span id="l13.6">   /**</span>
<a href="#l13.7"></a><span id="l13.7">    * Switch the given fonts to the given encodings, but only if the current fonts</span>
<a href="#l13.8"></a><span id="l13.8">    * are defaults.</span>
<a href="#l13.9"></a><span id="l13.9">    */</span>
<a href="#l13.10"></a><span id="l13.10">   _switchDefaultFonts: function MailMigrator__switchDefaultFonts(aFonts,</span>
<a href="#l13.11"></a><span id="l13.11">                                                                  aEncodings) {</span>
<a href="#l13.12"></a><span id="l13.12" class="difflineminus">-    for each (let [, encoding] in Iterator(aEncodings)) {</span>
<a href="#l13.13"></a><span id="l13.13" class="difflineplus">+    for (let encoding of aEncodings) {</span>
<a href="#l13.14"></a><span id="l13.14">       let serifPref = &quot;font.name.serif.&quot; + encoding;</span>
<a href="#l13.15"></a><span id="l13.15">       let sansPref = &quot;font.name.sans-serif.&quot; + encoding;</span>
<a href="#l13.16"></a><span id="l13.16">       let variableSizePref = &quot;font.size.variable.&quot; + encoding;</span>
<a href="#l13.17"></a><span id="l13.17">       // This is expected to be one of sans-serif or serif, and determines what</span>
<a href="#l13.18"></a><span id="l13.18">       // we'll link the variable font size to.</span>
<a href="#l13.19"></a><span id="l13.19">       let isSansDefault = Services.prefs.getCharPref(&quot;font.default.&quot; + encoding) ==</span>
<a href="#l13.20"></a><span id="l13.20">                             &quot;sans-serif&quot;;</span>
<a href="#l13.21"></a><span id="l13.21"> </span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l14.1"></a><span id="l14.1" class="difflineminus">--- a/mail/base/modules/oauth.jsm</span>
<a href="#l14.2"></a><span id="l14.2" class="difflineplus">+++ b/mail/base/modules/oauth.jsm</span>
<a href="#l14.3"></a><span id="l14.3" class="difflineat">@@ -296,17 +296,17 @@ OAuth.prototype = {</span>
<a href="#l14.4"></a><span id="l14.4">     this.tokenSecret = result.oauth_token_secret;</span>
<a href="#l14.5"></a><span id="l14.5">     this.connectSuccessCallback(result);</span>
<a href="#l14.6"></a><span id="l14.6">   },</span>
<a href="#l14.7"></a><span id="l14.7"> </span>
<a href="#l14.8"></a><span id="l14.8"> </span>
<a href="#l14.9"></a><span id="l14.9">   cleanUp: function() {</span>
<a href="#l14.10"></a><span id="l14.10">     this.finishAuthorizationRequest();</span>
<a href="#l14.11"></a><span id="l14.11">     if (this._pendingRequests.length != 0) {</span>
<a href="#l14.12"></a><span id="l14.12" class="difflineminus">-      for each (let request in this._pendingRequests)</span>
<a href="#l14.13"></a><span id="l14.13" class="difflineplus">+      for (let request of this._pendingRequests)</span>
<a href="#l14.14"></a><span id="l14.14">         request.abort();</span>
<a href="#l14.15"></a><span id="l14.15">       delete this._pendingRequests;</span>
<a href="#l14.16"></a><span id="l14.16">     }</span>
<a href="#l14.17"></a><span id="l14.17">     if (this._streamingRequest) {</span>
<a href="#l14.18"></a><span id="l14.18">       this._streamingRequest.abort();</span>
<a href="#l14.19"></a><span id="l14.19">       delete this._streamingRequest;</span>
<a href="#l14.20"></a><span id="l14.20">     }</span>
<a href="#l14.21"></a><span id="l14.21">   },</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l15.1"></a><span id="l15.1" class="difflineminus">--- a/mail/base/modules/quickFilterManager.js</span>
<a href="#l15.2"></a><span id="l15.2" class="difflineplus">+++ b/mail/base/modules/quickFilterManager.js</span>
<a href="#l15.3"></a><span id="l15.3" class="difflineat">@@ -31,18 +31,18 @@ Cu.import(&quot;resource:///modules/gloda/ind</span>
<a href="#l15.4"></a><span id="l15.4"> Cu.import(&quot;resource:///modules/gloda/msg_search.js&quot;);</span>
<a href="#l15.5"></a><span id="l15.5"> </span>
<a href="#l15.6"></a><span id="l15.6"> </span>
<a href="#l15.7"></a><span id="l15.7"> /**</span>
<a href="#l15.8"></a><span id="l15.8">  * Shallow object copy.</span>
<a href="#l15.9"></a><span id="l15.9">  */</span>
<a href="#l15.10"></a><span id="l15.10"> function shallowObjCopy(obj) {</span>
<a href="#l15.11"></a><span id="l15.11">   let newObj = {};</span>
<a href="#l15.12"></a><span id="l15.12" class="difflineminus">-  for each (let [key, value] in Iterator(obj)) {</span>
<a href="#l15.13"></a><span id="l15.13" class="difflineminus">-    newObj[key] = value;</span>
<a href="#l15.14"></a><span id="l15.14" class="difflineplus">+  for (let key in obj) {</span>
<a href="#l15.15"></a><span id="l15.15" class="difflineplus">+    newObj[key] = obj[key];</span>
<a href="#l15.16"></a><span id="l15.16">   }</span>
<a href="#l15.17"></a><span id="l15.17">   return newObj;</span>
<a href="#l15.18"></a><span id="l15.18"> }</span>
<a href="#l15.19"></a><span id="l15.19"> </span>
<a href="#l15.20"></a><span id="l15.20"> /**</span>
<a href="#l15.21"></a><span id="l15.21">  * Should the filter be visible when there's no previous state to propagate it</span>
<a href="#l15.22"></a><span id="l15.22">  *  from?  The idea is that when session persistence is working this should only</span>
<a href="#l15.23"></a><span id="l15.23">  *  ever affect the first time Thunderbird is started up.  Although opening</span>
<a href="#l15.24"></a><span id="l15.24" class="difflineat">@@ -418,17 +418,17 @@ var QuickFilterManager = {</span>
<a href="#l15.25"></a><span id="l15.25">    *</span>
<a href="#l15.26"></a><span id="l15.26">    * @param aTemplValues A set of existing filterValues.</span>
<a href="#l15.27"></a><span id="l15.27">    * @return The new filterValues state.</span>
<a href="#l15.28"></a><span id="l15.28">    */</span>
<a href="#l15.29"></a><span id="l15.29">   propagateValues: function MFM_propagateValues(aTemplValues) {</span>
<a href="#l15.30"></a><span id="l15.30">     let values = {};</span>
<a href="#l15.31"></a><span id="l15.31">     let sticky = (&quot;sticky&quot; in aTemplValues) ? aTemplValues.sticky : false;</span>
<a href="#l15.32"></a><span id="l15.32"> </span>
<a href="#l15.33"></a><span id="l15.33" class="difflineminus">-    for each (let [, filterDef] in Iterator(this.filterDefs)) {</span>
<a href="#l15.34"></a><span id="l15.34" class="difflineplus">+    for (let filterDef of this.filterDefs) {</span>
<a href="#l15.35"></a><span id="l15.35">       if (&quot;propagateState&quot; in filterDef) {</span>
<a href="#l15.36"></a><span id="l15.36">         let curValue = (filterDef.name in aTemplValues) ?</span>
<a href="#l15.37"></a><span id="l15.37">                          aTemplValues[filterDef.name] : undefined;</span>
<a href="#l15.38"></a><span id="l15.38">         let newValue = filterDef.propagateState(curValue, sticky);</span>
<a href="#l15.39"></a><span id="l15.39">         if (newValue != null)</span>
<a href="#l15.40"></a><span id="l15.40">           values[filterDef.name] = newValue;</span>
<a href="#l15.41"></a><span id="l15.41">       }</span>
<a href="#l15.42"></a><span id="l15.42">       // always propagate the value if sticky and there was no handler</span>
<a href="#l15.43"></a><span id="l15.43" class="difflineat">@@ -442,17 +442,17 @@ var QuickFilterManager = {</span>
<a href="#l15.44"></a><span id="l15.44">   },</span>
<a href="#l15.45"></a><span id="l15.45">   /**</span>
<a href="#l15.46"></a><span id="l15.46">    * Get the set of default filterValues for the current set of defined filters.</span>
<a href="#l15.47"></a><span id="l15.47">    *</span>
<a href="#l15.48"></a><span id="l15.48">    * @return Thew new filterValues state.</span>
<a href="#l15.49"></a><span id="l15.49">    */</span>
<a href="#l15.50"></a><span id="l15.50">   getDefaultValues: function MFM_getDefaultValues() {</span>
<a href="#l15.51"></a><span id="l15.51">     let values = {};</span>
<a href="#l15.52"></a><span id="l15.52" class="difflineminus">-    for each (let [, filterDef] in Iterator(this.filterDefs)) {</span>
<a href="#l15.53"></a><span id="l15.53" class="difflineplus">+    for (let filterDef of this.filterDefs) {</span>
<a href="#l15.54"></a><span id="l15.54">       if (&quot;getDefaults&quot; in filterDef) {</span>
<a href="#l15.55"></a><span id="l15.55">         let newValue = filterDef.getDefaults();</span>
<a href="#l15.56"></a><span id="l15.56">         if (newValue != null)</span>
<a href="#l15.57"></a><span id="l15.57">           values[filterDef.name] = newValue;</span>
<a href="#l15.58"></a><span id="l15.58">       }</span>
<a href="#l15.59"></a><span id="l15.59">     }</span>
<a href="#l15.60"></a><span id="l15.60">     return values;</span>
<a href="#l15.61"></a><span id="l15.61">   },</span>
<a href="#l15.62"></a><span id="l15.62" class="difflineat">@@ -487,33 +487,34 @@ var QuickFilterManager = {</span>
<a href="#l15.63"></a><span id="l15.63">   /**</span>
<a href="#l15.64"></a><span id="l15.64">    * Reset the state of all filters given the provided values.</span>
<a href="#l15.65"></a><span id="l15.65">    *</span>
<a href="#l15.66"></a><span id="l15.66">    * @return true if we actually cleared something, false if there was nothing</span>
<a href="#l15.67"></a><span id="l15.67">    *     to clear.</span>
<a href="#l15.68"></a><span id="l15.68">    */</span>
<a href="#l15.69"></a><span id="l15.69">   clearAllFilterValues: function MFM_clearFilterValues(aFilterValues) {</span>
<a href="#l15.70"></a><span id="l15.70">     let didClearSomething = false;</span>
<a href="#l15.71"></a><span id="l15.71" class="difflineminus">-    for each (let [, filterDef] in Iterator(this.filterDefs)) {</span>
<a href="#l15.72"></a><span id="l15.72" class="difflineplus">+    for (let filterDef of this.filterDefs) {</span>
<a href="#l15.73"></a><span id="l15.73">       if (this.clearFilterValue(filterDef.name, aFilterValues))</span>
<a href="#l15.74"></a><span id="l15.74">         didClearSomething = true;</span>
<a href="#l15.75"></a><span id="l15.75">     }</span>
<a href="#l15.76"></a><span id="l15.76">     return didClearSomething;</span>
<a href="#l15.77"></a><span id="l15.77">   },</span>
<a href="#l15.78"></a><span id="l15.78"> </span>
<a href="#l15.79"></a><span id="l15.79">   /**</span>
<a href="#l15.80"></a><span id="l15.80">    * Populate and return a list of search terms given the provided state.</span>
<a href="#l15.81"></a><span id="l15.81">    *</span>
<a href="#l15.82"></a><span id="l15.82">    * We only invoke appendTerms on filters that have state in aFilterValues,</span>
<a href="#l15.83"></a><span id="l15.83">    * as per the contract.</span>
<a href="#l15.84"></a><span id="l15.84">    */</span>
<a href="#l15.85"></a><span id="l15.85">   createSearchTerms: function MFM_createSearchTerms(aFilterValues,</span>
<a href="#l15.86"></a><span id="l15.86">                                                     aTermCreator) {</span>
<a href="#l15.87"></a><span id="l15.87">     let searchTerms = [], listeners = [];</span>
<a href="#l15.88"></a><span id="l15.88" class="difflineminus">-    for each (let [filterName, filterValue] in Iterator(aFilterValues)) {</span>
<a href="#l15.89"></a><span id="l15.89" class="difflineplus">+    for (let filterName in aFilterValues) {</span>
<a href="#l15.90"></a><span id="l15.90" class="difflineplus">+      let filterValue = aFilterValues[filterName];</span>
<a href="#l15.91"></a><span id="l15.91">       let filterDef = this.filterDefsByName[filterName];</span>
<a href="#l15.92"></a><span id="l15.92">       try {</span>
<a href="#l15.93"></a><span id="l15.93">         let listener =</span>
<a href="#l15.94"></a><span id="l15.94">           filterDef.appendTerms(aTermCreator, searchTerms, filterValue);</span>
<a href="#l15.95"></a><span id="l15.95">         if (listener)</span>
<a href="#l15.96"></a><span id="l15.96">           listeners.push([listener, filterDef]);</span>
<a href="#l15.97"></a><span id="l15.97">       }</span>
<a href="#l15.98"></a><span id="l15.98">       catch(ex) {</span>
<a href="#l15.99"></a><span id="l15.99" class="difflineat">@@ -636,17 +637,18 @@ var TagFacetingFilter = {</span>
<a href="#l15.100"></a><span id="l15.100">    *     false if there are specific tag constraints in play.</span>
<a href="#l15.101"></a><span id="l15.101">    */</span>
<a href="#l15.102"></a><span id="l15.102">   isSimple: function(aFilterValue) {</span>
<a href="#l15.103"></a><span id="l15.103">     // it's the simple case if the value is just a boolean</span>
<a href="#l15.104"></a><span id="l15.104">     if (typeof(aFilterValue) != &quot;object&quot;)</span>
<a href="#l15.105"></a><span id="l15.105">       return true;</span>
<a href="#l15.106"></a><span id="l15.106">     // but also if the object contains no non-null values</span>
<a href="#l15.107"></a><span id="l15.107">     let simpleCase = true;</span>
<a href="#l15.108"></a><span id="l15.108" class="difflineminus">-    for each (let [key, value] in Iterator(aFilterValue.tags)) {</span>
<a href="#l15.109"></a><span id="l15.109" class="difflineplus">+    for (let key in aFilterValue.tags) {</span>
<a href="#l15.110"></a><span id="l15.110" class="difflineplus">+      let value = aFilterValue.tags[key];</span>
<a href="#l15.111"></a><span id="l15.111">       if (value !== null) {</span>
<a href="#l15.112"></a><span id="l15.112">         simpleCase = false;</span>
<a href="#l15.113"></a><span id="l15.113">         break;</span>
<a href="#l15.114"></a><span id="l15.114">       }</span>
<a href="#l15.115"></a><span id="l15.115">     }</span>
<a href="#l15.116"></a><span id="l15.116">     return simpleCase;</span>
<a href="#l15.117"></a><span id="l15.117">   },</span>
<a href="#l15.118"></a><span id="l15.118"> </span>
<a href="#l15.119"></a><span id="l15.119" class="difflineat">@@ -683,17 +685,18 @@ var TagFacetingFilter = {</span>
<a href="#l15.120"></a><span id="l15.120">     else {</span>
<a href="#l15.121"></a><span id="l15.121">       let firstIncludeClause = true, firstExcludeClause = true;</span>
<a href="#l15.122"></a><span id="l15.122">       let lastIncludeTerm = null;</span>
<a href="#l15.123"></a><span id="l15.123">       term = null;</span>
<a href="#l15.124"></a><span id="l15.124"> </span>
<a href="#l15.125"></a><span id="l15.125">       let excludeTerms = [];</span>
<a href="#l15.126"></a><span id="l15.126"> </span>
<a href="#l15.127"></a><span id="l15.127">       let mode = aFilterValue.mode;</span>
<a href="#l15.128"></a><span id="l15.128" class="difflineminus">-      for each (let [key, shouldFilter] in Iterator(aFilterValue.tags)) {</span>
<a href="#l15.129"></a><span id="l15.129" class="difflineplus">+      for (let key in aFilterValue.tags) {</span>
<a href="#l15.130"></a><span id="l15.130" class="difflineplus">+        let shouldFilter = aFilterValue.tags[key];</span>
<a href="#l15.131"></a><span id="l15.131">         if (shouldFilter !== null) {</span>
<a href="#l15.132"></a><span id="l15.132">           term = aTermCreator.createTerm();</span>
<a href="#l15.133"></a><span id="l15.133">           term.attrib = Components.interfaces.nsMsgSearchAttrib.Keywords;</span>
<a href="#l15.134"></a><span id="l15.134">           value = term.value;</span>
<a href="#l15.135"></a><span id="l15.135">           value.attrib = term.attrib;</span>
<a href="#l15.136"></a><span id="l15.136">           value.str = key;</span>
<a href="#l15.137"></a><span id="l15.137">           term.value = value;</span>
<a href="#l15.138"></a><span id="l15.138">           if (shouldFilter) {</span>
<a href="#l15.139"></a><span id="l15.139" class="difflineat">@@ -1031,18 +1034,18 @@ var MessageTextFilter = {</span>
<a href="#l15.140"></a><span id="l15.140">         }</span>
<a href="#l15.141"></a><span id="l15.141">         if (term)</span>
<a href="#l15.142"></a><span id="l15.142">           term.endsGrouping = true;</span>
<a href="#l15.143"></a><span id="l15.143">       }</span>
<a href="#l15.144"></a><span id="l15.144">     }</span>
<a href="#l15.145"></a><span id="l15.145">   },</span>
<a href="#l15.146"></a><span id="l15.146">   getDefaults: function() {</span>
<a href="#l15.147"></a><span id="l15.147">     let states = {};</span>
<a href="#l15.148"></a><span id="l15.148" class="difflineminus">-    for each (let [name, value] in Iterator(this._defaultStates)) {</span>
<a href="#l15.149"></a><span id="l15.149" class="difflineminus">-      states[name] = value;</span>
<a href="#l15.150"></a><span id="l15.150" class="difflineplus">+    for (let name in this._defaultStates) {</span>
<a href="#l15.151"></a><span id="l15.151" class="difflineplus">+      states[name] = this._defaultStates[name];</span>
<a href="#l15.152"></a><span id="l15.152">     }</span>
<a href="#l15.153"></a><span id="l15.153">     return {</span>
<a href="#l15.154"></a><span id="l15.154">       text: null,</span>
<a href="#l15.155"></a><span id="l15.155">       states: states,</span>
<a href="#l15.156"></a><span id="l15.156">     };</span>
<a href="#l15.157"></a><span id="l15.157">   },</span>
<a href="#l15.158"></a><span id="l15.158">   propagateState: function(aOld, aSticky) {</span>
<a href="#l15.159"></a><span id="l15.159">     return {</span>
<a href="#l15.160"></a><span id="l15.160" class="difflineat">@@ -1101,17 +1104,18 @@ var MessageTextFilter = {</span>
<a href="#l15.161"></a><span id="l15.161">     // -- Expando Buttons!</span>
<a href="#l15.162"></a><span id="l15.162">     function commandHandler(aEvent) {</span>
<a href="#l15.163"></a><span id="l15.163">       let state = aMuxer.getFilterValueForMutation(MessageTextFilter.name);</span>
<a href="#l15.164"></a><span id="l15.164">       let filterDef = MessageTextFilter.textFilterDefsByDomId[aEvent.target.id];</span>
<a href="#l15.165"></a><span id="l15.165">       state.states[filterDef.name] = aEvent.target.checked;</span>
<a href="#l15.166"></a><span id="l15.166">       aMuxer.updateSearch();</span>
<a href="#l15.167"></a><span id="l15.167">     }</span>
<a href="#l15.168"></a><span id="l15.168"> </span>
<a href="#l15.169"></a><span id="l15.169" class="difflineminus">-    for each (let [, textFilter] in Iterator(this.textFilterDefs)) {</span>
<a href="#l15.170"></a><span id="l15.170" class="difflineplus">+    for (let name in this.textFilterDefs) {</span>
<a href="#l15.171"></a><span id="l15.171" class="difflineplus">+      let textFilter  = this.textFilterDefs[name];</span>
<a href="#l15.172"></a><span id="l15.172">       aDocument.getElementById(textFilter.domId).addEventListener(</span>
<a href="#l15.173"></a><span id="l15.173">         &quot;command&quot;, commandHandler, false);</span>
<a href="#l15.174"></a><span id="l15.174">     }</span>
<a href="#l15.175"></a><span id="l15.175">   },</span>
<a href="#l15.176"></a><span id="l15.176"> </span>
<a href="#l15.177"></a><span id="l15.177">   onCommand: function(aState, aNode, aEvent, aDocument) {</span>
<a href="#l15.178"></a><span id="l15.178">     let text = aNode.value.length ? aNode.value : null;</span>
<a href="#l15.179"></a><span id="l15.179">     if (text == aState.text) {</span>
<a href="#l15.180"></a><span id="l15.180" class="difflineat">@@ -1166,17 +1170,18 @@ var MessageTextFilter = {</span>
<a href="#l15.181"></a><span id="l15.181">     // Update the text if it has changed (linux does weird things with empty</span>
<a href="#l15.182"></a><span id="l15.182">     //  text if we're transitioning emptytext to emptytext)</span>
<a href="#l15.183"></a><span id="l15.183">     let desiredValue = aFilterValue.text || &quot;&quot;;</span>
<a href="#l15.184"></a><span id="l15.184">     if (aNode.value != desiredValue)</span>
<a href="#l15.185"></a><span id="l15.185">       aNode.value = desiredValue;</span>
<a href="#l15.186"></a><span id="l15.186"> </span>
<a href="#l15.187"></a><span id="l15.187">     // Update our expando buttons</span>
<a href="#l15.188"></a><span id="l15.188">     let states = aFilterValue.states;</span>
<a href="#l15.189"></a><span id="l15.189" class="difflineminus">-    for each (let [, textFilter] in Iterator(this.textFilterDefs)) {</span>
<a href="#l15.190"></a><span id="l15.190" class="difflineplus">+    for (let name in this.textFilterDefs) {</span>
<a href="#l15.191"></a><span id="l15.191" class="difflineplus">+      let textFilter  = this.textFilterDefs[name];</span>
<a href="#l15.192"></a><span id="l15.192">       aDocument.getElementById(textFilter.domId).checked =</span>
<a href="#l15.193"></a><span id="l15.193">         states[textFilter.name];</span>
<a href="#l15.194"></a><span id="l15.194">     }</span>
<a href="#l15.195"></a><span id="l15.195"> </span>
<a href="#l15.196"></a><span id="l15.196">     // Show the expando?</span>
<a href="#l15.197"></a><span id="l15.197">     aDocument.getElementById(&quot;quick-filter-bar-filter-text-bar&quot;).collapsed =</span>
<a href="#l15.198"></a><span id="l15.198">       (aFilterValue.text == null);</span>
<a href="#l15.199"></a><span id="l15.199">   },</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l16.1"></a><span id="l16.1" class="difflineminus">--- a/mail/base/modules/searchSpec.js</span>
<a href="#l16.2"></a><span id="l16.2" class="difflineplus">+++ b/mail/base/modules/searchSpec.js</span>
<a href="#l16.3"></a><span id="l16.3" class="difflineat">@@ -403,17 +403,17 @@ SearchSpec.prototype = {</span>
<a href="#l16.4"></a><span id="l16.4">       //  allSearchableGroups scope, so we cheat and use AddDirectoryScopeTerm.</span>
<a href="#l16.5"></a><span id="l16.5">       session.addDirectoryScopeTerm(nsMsgSearchScope.offlineMail);</span>
<a href="#l16.6"></a><span id="l16.6">       return;</span>
<a href="#l16.7"></a><span id="l16.7">     }</span>
<a href="#l16.8"></a><span id="l16.8"> </span>
<a href="#l16.9"></a><span id="l16.9">     let filtering = this._userTerms != null || this._viewTerms != null;</span>
<a href="#l16.10"></a><span id="l16.10">     let validityManager = Cc['@mozilla.org/mail/search/validityManager;1']</span>
<a href="#l16.11"></a><span id="l16.11">                             .getService(Ci.nsIMsgSearchValidityManager);</span>
<a href="#l16.12"></a><span id="l16.12" class="difflineminus">-    for each (let [, folder] in Iterator(this.owner._underlyingFolders)) {</span>
<a href="#l16.13"></a><span id="l16.13" class="difflineplus">+    for (let folder of this.owner._underlyingFolders) {</span>
<a href="#l16.14"></a><span id="l16.14">       // we do not need to check isServer here because _underlyingFolders</span>
<a href="#l16.15"></a><span id="l16.15">       //  filtered it out when it was initialized.</span>
<a href="#l16.16"></a><span id="l16.16"> </span>
<a href="#l16.17"></a><span id="l16.17">       let scope;</span>
<a href="#l16.18"></a><span id="l16.18">       let serverScope = folder.server.searchScope;</span>
<a href="#l16.19"></a><span id="l16.19">       // If we're offline, or this is a local folder, or there's no separate</span>
<a href="#l16.20"></a><span id="l16.20">       //  online scope, use server scope.</span>
<a href="#l16.21"></a><span id="l16.21">       if (Services.io.offline || (serverScope == nsMsgSearchScope.offlineMail) ||</span>
<a href="#l16.22"></a><span id="l16.22" class="difflineat">@@ -486,17 +486,17 @@ SearchSpec.prototype = {</span>
<a href="#l16.23"></a><span id="l16.23">     let s = '  Search Terms:\n';</span>
<a href="#l16.24"></a><span id="l16.24">     s += '    Virtual Folder Terms:\n';</span>
<a href="#l16.25"></a><span id="l16.25">     s += this.prettyStringOfSearchTerms(this._virtualFolderTerms);</span>
<a href="#l16.26"></a><span id="l16.26">     s += '    View Terms:\n';</span>
<a href="#l16.27"></a><span id="l16.27">     s += this.prettyStringOfSearchTerms(this._viewTerms);</span>
<a href="#l16.28"></a><span id="l16.28">     s += '    User Terms:\n';</span>
<a href="#l16.29"></a><span id="l16.29">     s += this.prettyStringOfSearchTerms(this._userTerms);</span>
<a href="#l16.30"></a><span id="l16.30">     s += '    Scope (Folders):\n';</span>
<a href="#l16.31"></a><span id="l16.31" class="difflineminus">-    for each (let [, folder] in Iterator(this.owner._underlyingFolders)) {</span>
<a href="#l16.32"></a><span id="l16.32" class="difflineplus">+    for (let folder of this.owner._underlyingFolders) {</span>
<a href="#l16.33"></a><span id="l16.33">       s += '      ' + folder.prettyName + '\n';</span>
<a href="#l16.34"></a><span id="l16.34">     }</span>
<a href="#l16.35"></a><span id="l16.35">     return s;</span>
<a href="#l16.36"></a><span id="l16.36">   },</span>
<a href="#l16.37"></a><span id="l16.37"> };</span>
<a href="#l16.38"></a><span id="l16.38"> </span>
<a href="#l16.39"></a><span id="l16.39"> /**</span>
<a href="#l16.40"></a><span id="l16.40">  * A simple nsIMsgSearchNotify listener that only listens for search start/stop</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l17.1"></a><span id="l17.1" class="difflineminus">--- a/mail/base/test/unit/resources/viewWrapperTestUtils.js</span>
<a href="#l17.2"></a><span id="l17.2" class="difflineplus">+++ b/mail/base/test/unit/resources/viewWrapperTestUtils.js</span>
<a href="#l17.3"></a><span id="l17.3" class="difflineat">@@ -131,25 +131,23 @@ var VWTU_testHelper = {</span>
<a href="#l17.4"></a><span id="l17.4">     this.active_view_wrappers.forEach(function (wrapper) {</span>
<a href="#l17.5"></a><span id="l17.5">       wrapper.close();</span>
<a href="#l17.6"></a><span id="l17.6">     });</span>
<a href="#l17.7"></a><span id="l17.7">     // verify that the notification helper has no outstanding listeners.</span>
<a href="#l17.8"></a><span id="l17.8">     if (IDBViewWrapperListener.prototype._FNH.haveListeners()) {</span>
<a href="#l17.9"></a><span id="l17.9">       let msg = &quot;FolderNotificationHelper has listeners, but should not.&quot;;</span>
<a href="#l17.10"></a><span id="l17.10">       dump(&quot;*** &quot; + msg + &quot;\n&quot;);</span>
<a href="#l17.11"></a><span id="l17.11">       dump(&quot;Pending URIs:\n&quot;);</span>
<a href="#l17.12"></a><span id="l17.12" class="difflineminus">-      for each (let [folderURI, wrappers] in</span>
<a href="#l17.13"></a><span id="l17.13" class="difflineminus">-                Iterator(IDBViewWrapperListener.prototype._FNH</span>
<a href="#l17.14"></a><span id="l17.14" class="difflineminus">-                           ._pendingFolderUriToViewWrapperLists)) {</span>
<a href="#l17.15"></a><span id="l17.15" class="difflineplus">+      for (let folderURI in IDBViewWrapperListener.prototype._FNH</span>
<a href="#l17.16"></a><span id="l17.16" class="difflineplus">+                              ._pendingFolderUriToViewWrapperLists) {</span>
<a href="#l17.17"></a><span id="l17.17">         dump(&quot;  &quot; + folderURI + &quot;\n&quot;);</span>
<a href="#l17.18"></a><span id="l17.18">       }</span>
<a href="#l17.19"></a><span id="l17.19">       dump(&quot;Interested wrappers:\n&quot;);</span>
<a href="#l17.20"></a><span id="l17.20" class="difflineminus">-      for each (let [folderURI, wrappers] in</span>
<a href="#l17.21"></a><span id="l17.21" class="difflineminus">-                Iterator(IDBViewWrapperListener.prototype._FNH</span>
<a href="#l17.22"></a><span id="l17.22" class="difflineminus">-                           ._interestedWrappers)) {</span>
<a href="#l17.23"></a><span id="l17.23" class="difflineplus">+      for (let folderURI in IDBViewWrapperListener.prototype._FNH</span>
<a href="#l17.24"></a><span id="l17.24" class="difflineplus">+                              ._interestedWrappers) {</span>
<a href="#l17.25"></a><span id="l17.25">         dump(&quot;  &quot; + folderURI + &quot;\n&quot;);</span>
<a href="#l17.26"></a><span id="l17.26">       }</span>
<a href="#l17.27"></a><span id="l17.27">       dump(&quot;***\n&quot;);</span>
<a href="#l17.28"></a><span id="l17.28">       do_throw(msg);</span>
<a href="#l17.29"></a><span id="l17.29">     }</span>
<a href="#l17.30"></a><span id="l17.30">     // force the folder to forget about the message database</span>
<a href="#l17.31"></a><span id="l17.31">     this.active_virtual_folders.forEach(function (folder) {</span>
<a href="#l17.32"></a><span id="l17.32">       folder.msgDatabase = null;</span>
<a href="#l17.33"></a><span id="l17.33" class="difflineat">@@ -162,23 +160,23 @@ var VWTU_testHelper = {</span>
<a href="#l17.34"></a><span id="l17.34">     this.active_real_folders.splice(0);</span>
<a href="#l17.35"></a><span id="l17.35">     this.active_virtual_folders.splice(0);</span>
<a href="#l17.36"></a><span id="l17.36"> </span>
<a href="#l17.37"></a><span id="l17.37">     gMockViewWrapperListener.allMessagesLoadedEventCount = 0;</span>
<a href="#l17.38"></a><span id="l17.38">   },</span>
<a href="#l17.39"></a><span id="l17.39">   onTimeout: function () {</span>
<a href="#l17.40"></a><span id="l17.40">     dump(&quot;-----------------------------------------------------------\n&quot;);</span>
<a href="#l17.41"></a><span id="l17.41">     dump(&quot;Active things at time of timeout:\n&quot;);</span>
<a href="#l17.42"></a><span id="l17.42" class="difflineminus">-    for each (let [, folder] in Iterator(this.active_real_folders)) {</span>
<a href="#l17.43"></a><span id="l17.43" class="difflineplus">+    for (let folder of this.active_real_folders) {</span>
<a href="#l17.44"></a><span id="l17.44">       dump(&quot;Real folder: &quot; + folder.prettyName + &quot;\n&quot;);</span>
<a href="#l17.45"></a><span id="l17.45">     }</span>
<a href="#l17.46"></a><span id="l17.46" class="difflineminus">-    for each (let [, virtFolder] in Iterator(this.active_virtual_folders)) {</span>
<a href="#l17.47"></a><span id="l17.47" class="difflineplus">+    for (let virtFolder of this.active_virtual_folders) {</span>
<a href="#l17.48"></a><span id="l17.48">       dump(&quot;Virtual folder: &quot; + virtFolder.prettyName + &quot;\n&quot;);</span>
<a href="#l17.49"></a><span id="l17.49">     }</span>
<a href="#l17.50"></a><span id="l17.50" class="difflineminus">-    for each (let [i, viewWrapper] in Iterator(this.active_view_wrappers)) {</span>
<a href="#l17.51"></a><span id="l17.51" class="difflineplus">+    for (let [i, viewWrapper] of this.active_view_wrappers.entries()) {</span>
<a href="#l17.52"></a><span id="l17.52">       dump(&quot;-----------------------------------\n&quot;);</span>
<a href="#l17.53"></a><span id="l17.53">       dump(&quot;Active view wrapper &quot; + i + &quot;\n&quot;);</span>
<a href="#l17.54"></a><span id="l17.54">       dump_view_state(viewWrapper);</span>
<a href="#l17.55"></a><span id="l17.55">     }</span>
<a href="#l17.56"></a><span id="l17.56">   }</span>
<a href="#l17.57"></a><span id="l17.57"> };</span>
<a href="#l17.58"></a><span id="l17.58"> </span>
<a href="#l17.59"></a><span id="l17.59"> function make_view_wrapper() {</span>
<a href="#l17.60"></a><span id="l17.60" class="difflineat">@@ -326,17 +324,18 @@ function dump_view_contents(aViewWrapper</span>
<a href="#l17.61"></a><span id="l17.61">     s += &quot; [&quot; + msgHdr.folder.prettyName + &quot;,&quot; + msgHdr.messageKey + &quot;]&quot;;</span>
<a href="#l17.62"></a><span id="l17.62"> </span>
<a href="#l17.63"></a><span id="l17.63">     dump(s + &quot;\n&quot;);</span>
<a href="#l17.64"></a><span id="l17.64">   }</span>
<a href="#l17.65"></a><span id="l17.65">   dump(&quot;********* end view contents\n&quot;);</span>
<a href="#l17.66"></a><span id="l17.66"> }</span>
<a href="#l17.67"></a><span id="l17.67"> </span>
<a href="#l17.68"></a><span id="l17.68"> function _lookupValueNameInInterface(aValue, aInterface) {</span>
<a href="#l17.69"></a><span id="l17.69" class="difflineminus">-  for each (let [key, value] in Iterator(aInterface)) {</span>
<a href="#l17.70"></a><span id="l17.70" class="difflineplus">+  for (let key in aInterface) {</span>
<a href="#l17.71"></a><span id="l17.71" class="difflineplus">+    let value = aInterface[key];</span>
<a href="#l17.72"></a><span id="l17.72">     if (value == aValue)</span>
<a href="#l17.73"></a><span id="l17.73">       return key;</span>
<a href="#l17.74"></a><span id="l17.74">   }</span>
<a href="#l17.75"></a><span id="l17.75">   return &quot;unknown: &quot; + aValue;</span>
<a href="#l17.76"></a><span id="l17.76"> }</span>
<a href="#l17.77"></a><span id="l17.77"> </span>
<a href="#l17.78"></a><span id="l17.78"> function dump_view_state(aViewWrapper, aDoNotDumpContents) {</span>
<a href="#l17.79"></a><span id="l17.79">   if (aViewWrapper.dbView == null) {</span>
<a href="#l17.80"></a><span id="l17.80" class="difflineat">@@ -381,18 +380,18 @@ function dump_view_state(aViewWrapper, a</span>
<a href="#l17.81"></a><span id="l17.81">  */</span>
<a href="#l17.82"></a><span id="l17.82"> function verify_messages_in_view(aSynSets, aViewWrapper) {</span>
<a href="#l17.83"></a><span id="l17.83">   if (!('length' in aSynSets))</span>
<a href="#l17.84"></a><span id="l17.84">     aSynSets = [aSynSets];</span>
<a href="#l17.85"></a><span id="l17.85"> </span>
<a href="#l17.86"></a><span id="l17.86">   // - Iterate over all the message sets, retrieving the message header.  Use</span>
<a href="#l17.87"></a><span id="l17.87">   //  this to construct a URI to populate a dictionary mapping.</span>
<a href="#l17.88"></a><span id="l17.88">   let synMessageURIs = {}; // map URI to message header</span>
<a href="#l17.89"></a><span id="l17.89" class="difflineminus">-  for each (let [, messageSet] in Iterator(aSynSets)) {</span>
<a href="#l17.90"></a><span id="l17.90" class="difflineminus">-    for each (let msgHdr in Iterator(messageSet.msgHdrs)) {</span>
<a href="#l17.91"></a><span id="l17.91" class="difflineplus">+  for (let messageSet of aSynSets) {</span>
<a href="#l17.92"></a><span id="l17.92" class="difflineplus">+    for (let msgHdr of messageSet.msgHdrs) {</span>
<a href="#l17.93"></a><span id="l17.93">       synMessageURIs[msgHdr.folder.getUriForMsg(msgHdr)] = msgHdr;</span>
<a href="#l17.94"></a><span id="l17.94">     }</span>
<a href="#l17.95"></a><span id="l17.95">   }</span>
<a href="#l17.96"></a><span id="l17.96"> </span>
<a href="#l17.97"></a><span id="l17.97">   // - Iterate over the contents of the view, nulling out values in</span>
<a href="#l17.98"></a><span id="l17.98">   //  synMessageURIs for found messages, and exploding for missing ones.</span>
<a href="#l17.99"></a><span id="l17.99">   let dbView = aViewWrapper.dbView;</span>
<a href="#l17.100"></a><span id="l17.100">   let treeView = aViewWrapper.dbView.QueryInterface(Ci.nsITreeView);</span>
<a href="#l17.101"></a><span id="l17.101" class="difflineat">@@ -414,17 +413,18 @@ function verify_messages_in_view(aSynSet</span>
<a href="#l17.102"></a><span id="l17.102">       dump(&quot;View State:\n&quot;);</span>
<a href="#l17.103"></a><span id="l17.103">       dump_view_state(aViewWrapper);</span>
<a href="#l17.104"></a><span id="l17.104">       mark_failure([&quot;view contains header that should not be present!&quot;,</span>
<a href="#l17.105"></a><span id="l17.105">                     msgHdr]);</span>
<a href="#l17.106"></a><span id="l17.106">     }</span>
<a href="#l17.107"></a><span id="l17.107">   }</span>
<a href="#l17.108"></a><span id="l17.108"> </span>
<a href="#l17.109"></a><span id="l17.109">   // - Iterate over our URI set and make sure every message got nulled out.</span>
<a href="#l17.110"></a><span id="l17.110" class="difflineminus">-  for each (let [, msgHdr] in Iterator(synMessageURIs)) {</span>
<a href="#l17.111"></a><span id="l17.111" class="difflineplus">+  for (let uri in synMessageURIs) {</span>
<a href="#l17.112"></a><span id="l17.112" class="difflineplus">+    let msgHdr = synMessageURIs[uri];</span>
<a href="#l17.113"></a><span id="l17.113">     if (msgHdr != null) {</span>
<a href="#l17.114"></a><span id="l17.114">       dump(&quot;************************\n&quot;);</span>
<a href="#l17.115"></a><span id="l17.115">       dump(&quot;The view should have included the following message header but&quot; +</span>
<a href="#l17.116"></a><span id="l17.116">            &quot; did not:\n&quot;);</span>
<a href="#l17.117"></a><span id="l17.117">       dump_message_header(msgHdr);</span>
<a href="#l17.118"></a><span id="l17.118">       dump(&quot;View State:\n&quot;);</span>
<a href="#l17.119"></a><span id="l17.119">       dump_view_state(aViewWrapper);</span>
<a href="#l17.120"></a><span id="l17.120">       mark_failure([&quot;view does not contain a header that should be present!&quot;,</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l18.1"></a><span id="l18.1" class="difflineminus">--- a/mail/components/activity/content/activity.js</span>
<a href="#l18.2"></a><span id="l18.2" class="difflineplus">+++ b/mail/components/activity/content/activity.js</span>
<a href="#l18.3"></a><span id="l18.3" class="difflineat">@@ -221,17 +221,17 @@ var activityObject =</span>
<a href="#l18.4"></a><span id="l18.4">       this._activityLogger.error(&quot;Exception: &quot; + e )</span>
<a href="#l18.5"></a><span id="l18.5">     }</span>
<a href="#l18.6"></a><span id="l18.6">   },</span>
<a href="#l18.7"></a><span id="l18.7"> </span>
<a href="#l18.8"></a><span id="l18.8">   rebuild: function() {</span>
<a href="#l18.9"></a><span id="l18.9">     let activityManager = Components.classes[&quot;@mozilla.org/activity-manager;1&quot;]</span>
<a href="#l18.10"></a><span id="l18.10">       .getService(Components.interfaces.nsIActivityManager);</span>
<a href="#l18.11"></a><span id="l18.11">     let activities = activityManager.getActivities({});</span>
<a href="#l18.12"></a><span id="l18.12" class="difflineminus">-    for each (let [, activity] in Iterator(activities))</span>
<a href="#l18.13"></a><span id="l18.13" class="difflineplus">+    for (let activity of activities)</span>
<a href="#l18.14"></a><span id="l18.14">       this.addActivityBinding(activity.id, activity);</span>
<a href="#l18.15"></a><span id="l18.15">   },</span>
<a href="#l18.16"></a><span id="l18.16"> </span>
<a href="#l18.17"></a><span id="l18.17">   shutdown: function() {</span>
<a href="#l18.18"></a><span id="l18.18">     let activityManager = Components.classes[&quot;@mozilla.org/activity-manager;1&quot;]</span>
<a href="#l18.19"></a><span id="l18.19">       .getService(Components.interfaces.nsIActivityManager);</span>
<a href="#l18.20"></a><span id="l18.20">     activityManager.removeListener(this._activityMgrListener);</span>
<a href="#l18.21"></a><span id="l18.21">   },</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l19.1"></a><span id="l19.1" class="difflineminus">--- a/mail/components/activity/content/activity.xml</span>
<a href="#l19.2"></a><span id="l19.2" class="difflineplus">+++ b/mail/components/activity/content/activity.xml</span>
<a href="#l19.3"></a><span id="l19.3" class="difflineat">@@ -69,17 +69,17 @@</span>
<a href="#l19.4"></a><span id="l19.4">         &lt;body&gt;</span>
<a href="#l19.5"></a><span id="l19.5">           &lt;![CDATA[</span>
<a href="#l19.6"></a><span id="l19.6">             let activityManager = Components.classes[&quot;@mozilla.org/activity-manager;1&quot;]</span>
<a href="#l19.7"></a><span id="l19.7">                                             .getService(Components.interfaces.nsIActivityManager);</span>
<a href="#l19.8"></a><span id="l19.8"> </span>
<a href="#l19.9"></a><span id="l19.9">             let processes = activityManager</span>
<a href="#l19.10"></a><span id="l19.10">                                   .getProcessesByContext(this.contextType,</span>
<a href="#l19.11"></a><span id="l19.11">                                                          this.contextObj, {});</span>
<a href="#l19.12"></a><span id="l19.12" class="difflineminus">-            for each (let [, process] in Iterator(processes)) {</span>
<a href="#l19.13"></a><span id="l19.13" class="difflineplus">+            for (let process of processes) {</span>
<a href="#l19.14"></a><span id="l19.14">               if (process.retryHandler)</span>
<a href="#l19.15"></a><span id="l19.15">                 process.retryHandler.retry(process);</span>
<a href="#l19.16"></a><span id="l19.16">             }</span>
<a href="#l19.17"></a><span id="l19.17">           ]]&gt;</span>
<a href="#l19.18"></a><span id="l19.18">         &lt;/body&gt;</span>
<a href="#l19.19"></a><span id="l19.19">       &lt;/method&gt;</span>
<a href="#l19.20"></a><span id="l19.20">     &lt;/implementation&gt;</span>
<a href="#l19.21"></a><span id="l19.21">     &lt;content&gt;</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l20.1"></a><span id="l20.1" class="difflineminus">--- a/mail/components/activity/modules/autosync.js</span>
<a href="#l20.2"></a><span id="l20.2" class="difflineplus">+++ b/mail/components/activity/modules/autosync.js</span>
<a href="#l20.3"></a><span id="l20.3" class="difflineat">@@ -126,17 +126,17 @@ var autosyncModule =</span>
<a href="#l20.4"></a><span id="l20.4">       event.contextDisplayText = this.bundle.formatStringFromName(&quot;autosyncContextDisplayText&quot;,</span>
<a href="#l20.5"></a><span id="l20.5">                                         [folder.server.prettyName], 1)</span>
<a href="#l20.6"></a><span id="l20.6">       event.contextObj = process.contextObj;</span>
<a href="#l20.7"></a><span id="l20.7">       event.iconClass = &quot;syncMail&quot;;</span>
<a href="#l20.8"></a><span id="l20.8"> </span>
<a href="#l20.9"></a><span id="l20.9">       // transfer all subjects.</span>
<a href="#l20.10"></a><span id="l20.10">       // same as above, not mandatory</span>
<a href="#l20.11"></a><span id="l20.11">       let subjects = process.getSubjects({});</span>
<a href="#l20.12"></a><span id="l20.12" class="difflineminus">-      for each (let [, subject] in Iterator(subjects))</span>
<a href="#l20.13"></a><span id="l20.13" class="difflineplus">+      for (let subject of subjects)</span>
<a href="#l20.14"></a><span id="l20.14">         event.addSubject(subject);</span>
<a href="#l20.15"></a><span id="l20.15"> </span>
<a href="#l20.16"></a><span id="l20.16">       return event;</span>
<a href="#l20.17"></a><span id="l20.17">     } catch (e) {</span>
<a href="#l20.18"></a><span id="l20.18">       this.log.error(&quot;createSyncMailEvent: &quot; + e);</span>
<a href="#l20.19"></a><span id="l20.19">       throw(e);</span>
<a href="#l20.20"></a><span id="l20.20">     }</span>
<a href="#l20.21"></a><span id="l20.21">   },</span>
<a href="#l20.22"></a><span id="l20.22" class="difflineat">@@ -221,18 +221,19 @@ var autosyncModule =</span>
<a href="#l20.23"></a><span id="l20.23"> </span>
<a href="#l20.24"></a><span id="l20.24">           // remove the folder/syncItem association from the table</span>
<a href="#l20.25"></a><span id="l20.25">           delete this._syncInfoPerFolder[folder.URI];</span>
<a href="#l20.26"></a><span id="l20.26">         }</span>
<a href="#l20.27"></a><span id="l20.27"> </span>
<a href="#l20.28"></a><span id="l20.28">         // if this is the last folder of this server in the queue</span>
<a href="#l20.29"></a><span id="l20.29">         // create a sync event and clean the sync start time</span>
<a href="#l20.30"></a><span id="l20.30">         let found = false;</span>
<a href="#l20.31"></a><span id="l20.31" class="difflineminus">-        for each(let [key, value] in Iterator(this._syncInfoPerFolder))</span>
<a href="#l20.32"></a><span id="l20.32" class="difflineplus">+        for (let key in this._syncInfoPerFolder)</span>
<a href="#l20.33"></a><span id="l20.33">         {</span>
<a href="#l20.34"></a><span id="l20.34" class="difflineplus">+          let value = this._syncInfoPerFolder[key];</span>
<a href="#l20.35"></a><span id="l20.35">           if (value.syncFolder.server == folder.server)</span>
<a href="#l20.36"></a><span id="l20.36">           {</span>
<a href="#l20.37"></a><span id="l20.37">             found = true;</span>
<a href="#l20.38"></a><span id="l20.38">             break;</span>
<a href="#l20.39"></a><span id="l20.39">           }</span>
<a href="#l20.40"></a><span id="l20.40">         }</span>
<a href="#l20.41"></a><span id="l20.41">         this.log.info(&quot;Auto_Sync OnFolderRemovedFromQ Last folder of the server: &quot; + !found);</span>
<a href="#l20.42"></a><span id="l20.42">         if (!found) {</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l21.1"></a><span id="l21.1" class="difflineminus">--- a/mail/components/activity/modules/glodaIndexer.js</span>
<a href="#l21.2"></a><span id="l21.2" class="difflineplus">+++ b/mail/components/activity/modules/glodaIndexer.js</span>
<a href="#l21.3"></a><span id="l21.3" class="difflineat">@@ -211,17 +211,17 @@ var glodaIndexerActivity =</span>
<a href="#l21.4"></a><span id="l21.4">                                  this.currentJob.startTime,</span>
<a href="#l21.5"></a><span id="l21.5">                                  endTime);</span>
<a href="#l21.6"></a><span id="l21.6">       event.contextType = this.currentJob.contextType;</span>
<a href="#l21.7"></a><span id="l21.7">       event.contextObj = this.currentJob.contextObj;</span>
<a href="#l21.8"></a><span id="l21.8">       event.iconClass   = &quot;indexMail&quot;;</span>
<a href="#l21.9"></a><span id="l21.9"> </span>
<a href="#l21.10"></a><span id="l21.10">       // Transfer subjects.</span>
<a href="#l21.11"></a><span id="l21.11">       let subjects = this.currentJob.process.getSubjects({});</span>
<a href="#l21.12"></a><span id="l21.12" class="difflineminus">-      for each (let [, subject] in Iterator(subjects))</span>
<a href="#l21.13"></a><span id="l21.13" class="difflineplus">+      for (let subject of subjects)</span>
<a href="#l21.14"></a><span id="l21.14">         event.addSubject(subject);</span>
<a href="#l21.15"></a><span id="l21.15"> </span>
<a href="#l21.16"></a><span id="l21.16">       this.activityMgr.addActivity(event);</span>
<a href="#l21.17"></a><span id="l21.17">     }</span>
<a href="#l21.18"></a><span id="l21.18"> </span>
<a href="#l21.19"></a><span id="l21.19">     this.currentJob = null;</span>
<a href="#l21.20"></a><span id="l21.20">   }</span>
<a href="#l21.21"></a><span id="l21.21"> </span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l22.1"></a><span id="l22.1" class="difflineminus">--- a/mail/components/activity/nsActivity.js</span>
<a href="#l22.2"></a><span id="l22.2" class="difflineplus">+++ b/mail/components/activity/nsActivity.js</span>
<a href="#l22.3"></a><span id="l22.3" class="difflineat">@@ -53,17 +53,17 @@ nsActivity.prototype = {</span>
<a href="#l22.4"></a><span id="l22.4">   },</span>
<a href="#l22.5"></a><span id="l22.5"> </span>
<a href="#l22.6"></a><span id="l22.6">   addSubject: function(aSubject) {</span>
<a href="#l22.7"></a><span id="l22.7">     this._subjects.push(aSubject);</span>
<a href="#l22.8"></a><span id="l22.8">   },</span>
<a href="#l22.9"></a><span id="l22.9"> </span>
<a href="#l22.10"></a><span id="l22.10">   getSubjects: function(aCount) {</span>
<a href="#l22.11"></a><span id="l22.11">     let list = [];</span>
<a href="#l22.12"></a><span id="l22.12" class="difflineminus">-    for each (let [, value] in Iterator(this._subjects))</span>
<a href="#l22.13"></a><span id="l22.13" class="difflineplus">+    for (let value of this._subjects)</span>
<a href="#l22.14"></a><span id="l22.14">       list.push(value);</span>
<a href="#l22.15"></a><span id="l22.15"> </span>
<a href="#l22.16"></a><span id="l22.16">     aCount.value = list.length;</span>
<a href="#l22.17"></a><span id="l22.17">     return list;</span>
<a href="#l22.18"></a><span id="l22.18">   },</span>
<a href="#l22.19"></a><span id="l22.19"> };</span>
<a href="#l22.20"></a><span id="l22.20"> </span>
<a href="#l22.21"></a><span id="l22.21"> ////////////////////////////////////////////////////////////////////////////////</span>
<a href="#l22.22"></a><span id="l22.22" class="difflineat">@@ -144,17 +144,17 @@ nsActivityProcess.prototype = {</span>
<a href="#l22.23"></a><span id="l22.23">       throw Cr.NS_ERROR_ILLEGAL_VALUE;</span>
<a href="#l22.24"></a><span id="l22.24">     }</span>
<a href="#l22.25"></a><span id="l22.25"> </span>
<a href="#l22.26"></a><span id="l22.26">     let oldState = this._state;</span>
<a href="#l22.27"></a><span id="l22.27">     this._state = val;</span>
<a href="#l22.28"></a><span id="l22.28"> </span>
<a href="#l22.29"></a><span id="l22.29">     // let the listeners know about the change</span>
<a href="#l22.30"></a><span id="l22.30">     this.log.debug(&quot;Notifying onStateChanged listeners&quot;);</span>
<a href="#l22.31"></a><span id="l22.31" class="difflineminus">-    for each (let [, value] in Iterator(this._listeners)) {</span>
<a href="#l22.32"></a><span id="l22.32" class="difflineplus">+    for (let value of this._listeners) {</span>
<a href="#l22.33"></a><span id="l22.33">       try {</span>
<a href="#l22.34"></a><span id="l22.34">         value.onStateChanged(this, oldState);</span>
<a href="#l22.35"></a><span id="l22.35">       }</span>
<a href="#l22.36"></a><span id="l22.36">       catch(e) {</span>
<a href="#l22.37"></a><span id="l22.37">         this.log.error(&quot;Exception thrown by onStateChanged listener: &quot;+ e);</span>
<a href="#l22.38"></a><span id="l22.38">       }</span>
<a href="#l22.39"></a><span id="l22.39">     }</span>
<a href="#l22.40"></a><span id="l22.40">   },</span>
<a href="#l22.41"></a><span id="l22.41" class="difflineat">@@ -168,17 +168,17 @@ nsActivityProcess.prototype = {</span>
<a href="#l22.42"></a><span id="l22.42">     else {</span>
<a href="#l22.43"></a><span id="l22.43">       this.percentComplete = parseInt(100.0 * aWorkUnitsComplete / aTotalWorkUnits);</span>
<a href="#l22.44"></a><span id="l22.44">       this.workUnitComplete = aWorkUnitsComplete;</span>
<a href="#l22.45"></a><span id="l22.45">       this.totalWorkUnits = aTotalWorkUnits;</span>
<a href="#l22.46"></a><span id="l22.46">     }</span>
<a href="#l22.47"></a><span id="l22.47">     this.lastStatusText = aStatusText;</span>
<a href="#l22.48"></a><span id="l22.48"> </span>
<a href="#l22.49"></a><span id="l22.49">     // notify listeners</span>
<a href="#l22.50"></a><span id="l22.50" class="difflineminus">-    for each (let [, value] in Iterator(this._listeners)) {</span>
<a href="#l22.51"></a><span id="l22.51" class="difflineplus">+    for (let value of this._listeners) {</span>
<a href="#l22.52"></a><span id="l22.52">       try {</span>
<a href="#l22.53"></a><span id="l22.53">         value.onProgressChanged(this, aStatusText, aWorkUnitsComplete,</span>
<a href="#l22.54"></a><span id="l22.54">                                 aTotalWorkUnits);</span>
<a href="#l22.55"></a><span id="l22.55">       }</span>
<a href="#l22.56"></a><span id="l22.56">       catch(e) {</span>
<a href="#l22.57"></a><span id="l22.57">         this.log.error(&quot;Exception thrown by onProgressChanged listener: &quot; + e);</span>
<a href="#l22.58"></a><span id="l22.58">       }</span>
<a href="#l22.59"></a><span id="l22.59">     }</span>
<a href="#l22.60"></a><span id="l22.60" class="difflineat">@@ -188,17 +188,17 @@ nsActivityProcess.prototype = {</span>
<a href="#l22.61"></a><span id="l22.61">     return this._cancelHandler;</span>
<a href="#l22.62"></a><span id="l22.62">   },</span>
<a href="#l22.63"></a><span id="l22.63"> </span>
<a href="#l22.64"></a><span id="l22.64">   set cancelHandler(val) {</span>
<a href="#l22.65"></a><span id="l22.65">     this._cancelHandler = val;</span>
<a href="#l22.66"></a><span id="l22.66"> </span>
<a href="#l22.67"></a><span id="l22.67">     // let the listeners know about the change</span>
<a href="#l22.68"></a><span id="l22.68">     this.log.debug(&quot;Notifying onHandlerChanged listeners&quot;);</span>
<a href="#l22.69"></a><span id="l22.69" class="difflineminus">-    for each (let [, value] in Iterator(this._listeners)) {</span>
<a href="#l22.70"></a><span id="l22.70" class="difflineplus">+    for (let value of this._listeners) {</span>
<a href="#l22.71"></a><span id="l22.71">       try {</span>
<a href="#l22.72"></a><span id="l22.72">         value.onHandlerChanged(this);</span>
<a href="#l22.73"></a><span id="l22.73">       }</span>
<a href="#l22.74"></a><span id="l22.74">       catch(e) {</span>
<a href="#l22.75"></a><span id="l22.75">         this.log.error(&quot;Exception thrown by onHandlerChanged listener: &quot; + e);</span>
<a href="#l22.76"></a><span id="l22.76">       }</span>
<a href="#l22.77"></a><span id="l22.77">     }</span>
<a href="#l22.78"></a><span id="l22.78">   },</span>
<a href="#l22.79"></a><span id="l22.79" class="difflineat">@@ -207,31 +207,31 @@ nsActivityProcess.prototype = {</span>
<a href="#l22.80"></a><span id="l22.80">     return this._pauseHandler;</span>
<a href="#l22.81"></a><span id="l22.81">   },</span>
<a href="#l22.82"></a><span id="l22.82"> </span>
<a href="#l22.83"></a><span id="l22.83">   set pauseHandler(val) {</span>
<a href="#l22.84"></a><span id="l22.84">     this._pauseHandler = val;</span>
<a href="#l22.85"></a><span id="l22.85"> </span>
<a href="#l22.86"></a><span id="l22.86">     // let the listeners know about the change</span>
<a href="#l22.87"></a><span id="l22.87">     this.log.debug(&quot;Notifying onHandlerChanged listeners&quot;);</span>
<a href="#l22.88"></a><span id="l22.88" class="difflineminus">-    for each (let [, value] in Iterator(this._listeners)) {</span>
<a href="#l22.89"></a><span id="l22.89" class="difflineplus">+    for (let value of this._listeners) {</span>
<a href="#l22.90"></a><span id="l22.90">       value.onHandlerChanged(this);</span>
<a href="#l22.91"></a><span id="l22.91">     }</span>
<a href="#l22.92"></a><span id="l22.92">   },</span>
<a href="#l22.93"></a><span id="l22.93"> </span>
<a href="#l22.94"></a><span id="l22.94">   get retryHandler() {</span>
<a href="#l22.95"></a><span id="l22.95">     return this._retryHandler;</span>
<a href="#l22.96"></a><span id="l22.96">   },</span>
<a href="#l22.97"></a><span id="l22.97"> </span>
<a href="#l22.98"></a><span id="l22.98">   set retryHandler(val) {</span>
<a href="#l22.99"></a><span id="l22.99">     this._retryHandler = val;</span>
<a href="#l22.100"></a><span id="l22.100"> </span>
<a href="#l22.101"></a><span id="l22.101">     // let the listeners know about the change</span>
<a href="#l22.102"></a><span id="l22.102">     this.log.debug(&quot;Notifying onHandlerChanged listeners&quot;);</span>
<a href="#l22.103"></a><span id="l22.103" class="difflineminus">-    for each (let [, value] in Iterator(this._listeners)) {</span>
<a href="#l22.104"></a><span id="l22.104" class="difflineplus">+    for (let value of this._listeners) {</span>
<a href="#l22.105"></a><span id="l22.105">       value.onHandlerChanged(this);</span>
<a href="#l22.106"></a><span id="l22.106">     }</span>
<a href="#l22.107"></a><span id="l22.107">   },</span>
<a href="#l22.108"></a><span id="l22.108"> </span>
<a href="#l22.109"></a><span id="l22.109">   //////////////////////////////////////////////////////////////////////////////</span>
<a href="#l22.110"></a><span id="l22.110">   //// nsISupports</span>
<a href="#l22.111"></a><span id="l22.111"> </span>
<a href="#l22.112"></a><span id="l22.112">   QueryInterface: XPCOMUtils.generateQI([Ci.nsIActivityProcess, Ci.nsIActivity])</span>
<a href="#l22.113"></a><span id="l22.113" class="difflineat">@@ -276,17 +276,17 @@ nsActivityEvent.prototype = {</span>
<a href="#l22.114"></a><span id="l22.114">     return this._undoHandler;</span>
<a href="#l22.115"></a><span id="l22.115">   },</span>
<a href="#l22.116"></a><span id="l22.116"> </span>
<a href="#l22.117"></a><span id="l22.117">   set undoHandler(val) {</span>
<a href="#l22.118"></a><span id="l22.118">     this._undoHandler = val;</span>
<a href="#l22.119"></a><span id="l22.119"> </span>
<a href="#l22.120"></a><span id="l22.120">     // let the listeners know about the change</span>
<a href="#l22.121"></a><span id="l22.121">     this.log.debug(&quot;Notifying onHandlerChanged listeners&quot;);</span>
<a href="#l22.122"></a><span id="l22.122" class="difflineminus">-    for each (let [, value] in Iterator(this._listeners)) {</span>
<a href="#l22.123"></a><span id="l22.123" class="difflineplus">+    for (let value of this._listeners) {</span>
<a href="#l22.124"></a><span id="l22.124">       value.onHandlerChanged(this);</span>
<a href="#l22.125"></a><span id="l22.125">     }</span>
<a href="#l22.126"></a><span id="l22.126">   },</span>
<a href="#l22.127"></a><span id="l22.127"> </span>
<a href="#l22.128"></a><span id="l22.128">   //////////////////////////////////////////////////////////////////////////////</span>
<a href="#l22.129"></a><span id="l22.129">   //// nsISupports</span>
<a href="#l22.130"></a><span id="l22.130"> </span>
<a href="#l22.131"></a><span id="l22.131">   QueryInterface: XPCOMUtils.generateQI([Ci.nsIActivityEvent, Ci.nsIActivity])</span>
<a href="#l22.132"></a><span id="l22.132" class="difflineat">@@ -324,17 +324,17 @@ nsActivityWarning.prototype = {</span>
<a href="#l22.133"></a><span id="l22.133">     return this._recoveryHandler;</span>
<a href="#l22.134"></a><span id="l22.134">   },</span>
<a href="#l22.135"></a><span id="l22.135"> </span>
<a href="#l22.136"></a><span id="l22.136">   set recoveryHandler(val) {</span>
<a href="#l22.137"></a><span id="l22.137">     this._recoveryHandler = val;</span>
<a href="#l22.138"></a><span id="l22.138"> </span>
<a href="#l22.139"></a><span id="l22.139">     // let the listeners know about the change</span>
<a href="#l22.140"></a><span id="l22.140">     this.log.debug(&quot;Notifying onHandlerChanged listeners&quot;);</span>
<a href="#l22.141"></a><span id="l22.141" class="difflineminus">-    for each (let [, value] in Iterator(this._listeners)) {</span>
<a href="#l22.142"></a><span id="l22.142" class="difflineplus">+    for (let value of this._listeners) {</span>
<a href="#l22.143"></a><span id="l22.143">       value.onHandlerChanged(this);</span>
<a href="#l22.144"></a><span id="l22.144">     }</span>
<a href="#l22.145"></a><span id="l22.145">   },</span>
<a href="#l22.146"></a><span id="l22.146"> </span>
<a href="#l22.147"></a><span id="l22.147">   get time() {</span>
<a href="#l22.148"></a><span id="l22.148">     return this._time;</span>
<a href="#l22.149"></a><span id="l22.149">   },</span>
<a href="#l22.150"></a><span id="l22.150"> </span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l23.1"></a><span id="l23.1" class="difflineminus">--- a/mail/components/activity/nsActivityManager.js</span>
<a href="#l23.2"></a><span id="l23.2" class="difflineplus">+++ b/mail/components/activity/nsActivityManager.js</span>
<a href="#l23.3"></a><span id="l23.3" class="difflineat">@@ -29,27 +29,29 @@ nsActivityManager.prototype = {</span>
<a href="#l23.4"></a><span id="l23.4">   _listeners: [],</span>
<a href="#l23.5"></a><span id="l23.5">   _processCount: 0,</span>
<a href="#l23.6"></a><span id="l23.6">   _db: null,</span>
<a href="#l23.7"></a><span id="l23.7">   _idCounter: 1,</span>
<a href="#l23.8"></a><span id="l23.8">   _activities: {},</span>
<a href="#l23.9"></a><span id="l23.9"> </span>
<a href="#l23.10"></a><span id="l23.10">   get processCount() {</span>
<a href="#l23.11"></a><span id="l23.11">     let count = 0;</span>
<a href="#l23.12"></a><span id="l23.12" class="difflineminus">-    for each(let [, value] in Iterator(this._activities)) {</span>
<a href="#l23.13"></a><span id="l23.13" class="difflineplus">+    for (let id in this._activities) {</span>
<a href="#l23.14"></a><span id="l23.14" class="difflineplus">+      let value = this._activities;</span>
<a href="#l23.15"></a><span id="l23.15">       if (value instanceof Ci.nsIActivityProcess)</span>
<a href="#l23.16"></a><span id="l23.16">         count++;</span>
<a href="#l23.17"></a><span id="l23.17">     }</span>
<a href="#l23.18"></a><span id="l23.18"> </span>
<a href="#l23.19"></a><span id="l23.19">     return count;</span>
<a href="#l23.20"></a><span id="l23.20">   },</span>
<a href="#l23.21"></a><span id="l23.21"> </span>
<a href="#l23.22"></a><span id="l23.22">   getProcessesByContext: function(aContextType, aContextObj, aCount) {</span>
<a href="#l23.23"></a><span id="l23.23">     let list = [];</span>
<a href="#l23.24"></a><span id="l23.24" class="difflineminus">-    for each (let [, activity] in Iterator(this._activities)) {</span>
<a href="#l23.25"></a><span id="l23.25" class="difflineplus">+    for (let id in this._activities) {</span>
<a href="#l23.26"></a><span id="l23.26" class="difflineplus">+      let value = this._activities;</span>
<a href="#l23.27"></a><span id="l23.27">       if (activity instanceof Ci.nsIActivityProcess &amp;&amp;</span>
<a href="#l23.28"></a><span id="l23.28">           activity.contextType == aContextType &amp;&amp;</span>
<a href="#l23.29"></a><span id="l23.29">           activity.contextObj == aContextObj) {</span>
<a href="#l23.30"></a><span id="l23.30">         list.push(activity);</span>
<a href="#l23.31"></a><span id="l23.31">       }</span>
<a href="#l23.32"></a><span id="l23.32">     }</span>
<a href="#l23.33"></a><span id="l23.33"> </span>
<a href="#l23.34"></a><span id="l23.34">     aCount.value = list.length;</span>
<a href="#l23.35"></a><span id="l23.35" class="difflineat">@@ -69,17 +71,17 @@ nsActivityManager.prototype = {</span>
<a href="#l23.36"></a><span id="l23.36">       this.log.info(&quot;adding Activity&quot;);</span>
<a href="#l23.37"></a><span id="l23.37">       // get the next valid id for this activity</span>
<a href="#l23.38"></a><span id="l23.38">       let id = this.nextId;</span>
<a href="#l23.39"></a><span id="l23.39">       aActivity.id = id;</span>
<a href="#l23.40"></a><span id="l23.40"> </span>
<a href="#l23.41"></a><span id="l23.41">       // add activity into the activities table</span>
<a href="#l23.42"></a><span id="l23.42">       this._activities[id] = aActivity;</span>
<a href="#l23.43"></a><span id="l23.43">       // notify all the listeners</span>
<a href="#l23.44"></a><span id="l23.44" class="difflineminus">-      for each (let [, value] in Iterator(this._listeners)) {</span>
<a href="#l23.45"></a><span id="l23.45" class="difflineplus">+      for (let value of this._listeners) {</span>
<a href="#l23.46"></a><span id="l23.46">         try {</span>
<a href="#l23.47"></a><span id="l23.47">           value.onAddedActivity(id, aActivity);</span>
<a href="#l23.48"></a><span id="l23.48">         }</span>
<a href="#l23.49"></a><span id="l23.49">         catch(e) {</span>
<a href="#l23.50"></a><span id="l23.50">           this.log.error(&quot;Exception calling onAddedActivity&quot; + e)</span>
<a href="#l23.51"></a><span id="l23.51">         }</span>
<a href="#l23.52"></a><span id="l23.52">       }</span>
<a href="#l23.53"></a><span id="l23.53">       return id;</span>
<a href="#l23.54"></a><span id="l23.54" class="difflineat">@@ -101,17 +103,17 @@ nsActivityManager.prototype = {</span>
<a href="#l23.55"></a><span id="l23.55">     if (activity instanceof Ci.nsIActivityProcess &amp;&amp;</span>
<a href="#l23.56"></a><span id="l23.56">         activity.state == Ci.nsIActivityProcess.STATE_INPROGRESS)</span>
<a href="#l23.57"></a><span id="l23.57">       throw Cr.NS_ERROR_FAILURE;</span>
<a href="#l23.58"></a><span id="l23.58"> </span>
<a href="#l23.59"></a><span id="l23.59">     // remove the activity</span>
<a href="#l23.60"></a><span id="l23.60">     delete this._activities[aID];</span>
<a href="#l23.61"></a><span id="l23.61"> </span>
<a href="#l23.62"></a><span id="l23.62">     // notify all the listeners</span>
<a href="#l23.63"></a><span id="l23.63" class="difflineminus">-    for each (let [, value] in Iterator(this._listeners)) {</span>
<a href="#l23.64"></a><span id="l23.64" class="difflineplus">+    for (let value of this._listeners) {</span>
<a href="#l23.65"></a><span id="l23.65">       try {</span>
<a href="#l23.66"></a><span id="l23.66">         value.onRemovedActivity(aID);</span>
<a href="#l23.67"></a><span id="l23.67">       }</span>
<a href="#l23.68"></a><span id="l23.68">       catch(e) {</span>
<a href="#l23.69"></a><span id="l23.69">         // ignore the exception</span>
<a href="#l23.70"></a><span id="l23.70">       }</span>
<a href="#l23.71"></a><span id="l23.71">     }</span>
<a href="#l23.72"></a><span id="l23.72">   },</span>
<a href="#l23.73"></a><span id="l23.73" class="difflineat">@@ -143,18 +145,20 @@ nsActivityManager.prototype = {</span>
<a href="#l23.74"></a><span id="l23.74">   },</span>
<a href="#l23.75"></a><span id="l23.75"> </span>
<a href="#l23.76"></a><span id="l23.76">   containsActivity: function (aID) {</span>
<a href="#l23.77"></a><span id="l23.77">     return !!this._activities[aID];</span>
<a href="#l23.78"></a><span id="l23.78">   },</span>
<a href="#l23.79"></a><span id="l23.79"> </span>
<a href="#l23.80"></a><span id="l23.80">   getActivities: function(aCount) {</span>
<a href="#l23.81"></a><span id="l23.81">     let list = [];</span>
<a href="#l23.82"></a><span id="l23.82" class="difflineminus">-    for each (let [, value] in Iterator(this._activities))</span>
<a href="#l23.83"></a><span id="l23.83" class="difflineplus">+    for (let id in this._activities) {</span>
<a href="#l23.84"></a><span id="l23.84" class="difflineplus">+      let value = this._activities;</span>
<a href="#l23.85"></a><span id="l23.85">       list.push(value);</span>
<a href="#l23.86"></a><span id="l23.86" class="difflineplus">+    }</span>
<a href="#l23.87"></a><span id="l23.87"> </span>
<a href="#l23.88"></a><span id="l23.88">     aCount.value = list.length;</span>
<a href="#l23.89"></a><span id="l23.89">     return list;</span>
<a href="#l23.90"></a><span id="l23.90">   },</span>
<a href="#l23.91"></a><span id="l23.91"> </span>
<a href="#l23.92"></a><span id="l23.92">   addListener: function(aListener) {</span>
<a href="#l23.93"></a><span id="l23.93">     this.log.info(&quot;addListener\n&quot;);</span>
<a href="#l23.94"></a><span id="l23.94">     this._listeners.push(aListener);</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l24.1"></a><span id="l24.1" class="difflineminus">--- a/mail/components/addrbook/content/abCardOverlay.js</span>
<a href="#l24.2"></a><span id="l24.2" class="difflineplus">+++ b/mail/components/addrbook/content/abCardOverlay.js</span>
<a href="#l24.3"></a><span id="l24.3" class="difflineat">@@ -875,34 +875,34 @@ var chatNameFieldIds =</span>
<a href="#l24.4"></a><span id="l24.4"> /**</span>
<a href="#l24.5"></a><span id="l24.5">  * Show the 'Chat' tab and focus the first field that has a value, or</span>
<a href="#l24.6"></a><span id="l24.6">  * the first field if none of them has a value.</span>
<a href="#l24.7"></a><span id="l24.7">  */</span>
<a href="#l24.8"></a><span id="l24.8"> function showChat()</span>
<a href="#l24.9"></a><span id="l24.9"> {</span>
<a href="#l24.10"></a><span id="l24.10">   document.getElementById('abTabPanels').parentNode.selectedTab =</span>
<a href="#l24.11"></a><span id="l24.11">     document.getElementById('chatTabButton');</span>
<a href="#l24.12"></a><span id="l24.12" class="difflineminus">-  for each (let id in chatNameFieldIds) {</span>
<a href="#l24.13"></a><span id="l24.13" class="difflineplus">+  for (let id of chatNameFieldIds) {</span>
<a href="#l24.14"></a><span id="l24.14">     let elt = document.getElementById(id);</span>
<a href="#l24.15"></a><span id="l24.15">     if (elt.value) {</span>
<a href="#l24.16"></a><span id="l24.16">       elt.focus();</span>
<a href="#l24.17"></a><span id="l24.17">       return;</span>
<a href="#l24.18"></a><span id="l24.18">     }</span>
<a href="#l24.19"></a><span id="l24.19">   }</span>
<a href="#l24.20"></a><span id="l24.20">   document.getElementById(chatNameFieldIds[0]).focus();</span>
<a href="#l24.21"></a><span id="l24.21"> }</span>
<a href="#l24.22"></a><span id="l24.22"> </span>
<a href="#l24.23"></a><span id="l24.23"> /**</span>
<a href="#l24.24"></a><span id="l24.24">  * Fill in the value of the ChatName readonly field with the first</span>
<a href="#l24.25"></a><span id="l24.25">  * value of the fields in the Chat tab.</span>
<a href="#l24.26"></a><span id="l24.26">  */</span>
<a href="#l24.27"></a><span id="l24.27"> function updateChatName()</span>
<a href="#l24.28"></a><span id="l24.28"> {</span>
<a href="#l24.29"></a><span id="l24.29">   let value = &quot;&quot;;</span>
<a href="#l24.30"></a><span id="l24.30" class="difflineminus">-  for each (let id in chatNameFieldIds) {</span>
<a href="#l24.31"></a><span id="l24.31" class="difflineplus">+  for (let id of chatNameFieldIds) {</span>
<a href="#l24.32"></a><span id="l24.32">     let val = document.getElementById(id).value;</span>
<a href="#l24.33"></a><span id="l24.33">     if (val) {</span>
<a href="#l24.34"></a><span id="l24.34">       value = val;</span>
<a href="#l24.35"></a><span id="l24.35">       break;</span>
<a href="#l24.36"></a><span id="l24.36">     }</span>
<a href="#l24.37"></a><span id="l24.37">   }</span>
<a href="#l24.38"></a><span id="l24.38">   document.getElementById(&quot;ChatName&quot;).value = value;</span>
<a href="#l24.39"></a><span id="l24.39"> }</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l25.1"></a><span id="l25.1" class="difflineminus">--- a/mail/components/addrbook/content/addressbook.js</span>
<a href="#l25.2"></a><span id="l25.2" class="difflineplus">+++ b/mail/components/addrbook/content/addressbook.js</span>
<a href="#l25.3"></a><span id="l25.3" class="difflineat">@@ -697,17 +697,17 @@ function AbIMSelected()</span>
<a href="#l25.4"></a><span id="l25.4">   //</span>
<a href="#l25.5"></a><span id="l25.5">   // First, sort the IM usernames into two groups - online contacts go into</span>
<a href="#l25.6"></a><span id="l25.6">   // the &quot;online&quot; group, and offline (but chat-able) contacts go into the</span>
<a href="#l25.7"></a><span id="l25.7">   // &quot;offline&quot; group.</span>
<a href="#l25.8"></a><span id="l25.8"> </span>
<a href="#l25.9"></a><span id="l25.9">   let online = [];</span>
<a href="#l25.10"></a><span id="l25.10">   let offline = [];</span>
<a href="#l25.11"></a><span id="l25.11"> </span>
<a href="#l25.12"></a><span id="l25.12" class="difflineminus">-  for each (let [, chatProperty] in Iterator(kChatProperties)) {</span>
<a href="#l25.13"></a><span id="l25.13" class="difflineplus">+  for (let chatProperty of kChatProperties) {</span>
<a href="#l25.14"></a><span id="l25.14">     let chatID = card.getProperty(chatProperty, &quot;&quot;);</span>
<a href="#l25.15"></a><span id="l25.15"> </span>
<a href="#l25.16"></a><span id="l25.16">     if (chatID &amp;&amp; (chatID in chatHandler.allContacts)) {</span>
<a href="#l25.17"></a><span id="l25.17">       let chatContact = chatHandler.allContacts[chatID];</span>
<a href="#l25.18"></a><span id="l25.18">       if (chatContact.online)</span>
<a href="#l25.19"></a><span id="l25.19">         online.push(chatContact);</span>
<a href="#l25.20"></a><span id="l25.20">       else if (chatContact.canSendMessage)</span>
<a href="#l25.21"></a><span id="l25.21">         offline.push(chatContact);</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l26.1"></a><span id="l26.1" class="difflineminus">--- a/mail/components/cloudfile/cloudFileAccounts.js</span>
<a href="#l26.2"></a><span id="l26.2" class="difflineplus">+++ b/mail/components/cloudfile/cloudFileAccounts.js</span>
<a href="#l26.3"></a><span id="l26.3" class="difflineat">@@ -160,26 +160,25 @@ var cloudFileAccounts = {</span>
<a href="#l26.4"></a><span id="l26.4">     let key = this._ensureKey(aKeyOrAccount);</span>
<a href="#l26.5"></a><span id="l26.5"> </span>
<a href="#l26.6"></a><span id="l26.6">     let type = Services.prefs.QueryInterface(Ci.nsIPrefBranch)</span>
<a href="#l26.7"></a><span id="l26.7">                        .deleteBranch(ACCOUNT_ROOT + key);</span>
<a href="#l26.8"></a><span id="l26.8"> </span>
<a href="#l26.9"></a><span id="l26.9">     // Destroy any secret tokens for this accountKey.</span>
<a href="#l26.10"></a><span id="l26.10">     let logins = Services.logins</span>
<a href="#l26.11"></a><span id="l26.11">                          .findLogins({}, PWDMGR_HOST, null, &quot;&quot;);</span>
<a href="#l26.12"></a><span id="l26.12" class="difflineminus">-    for each (let login in logins) {</span>
<a href="#l26.13"></a><span id="l26.13" class="difflineplus">+    for (let login of logins) {</span>
<a href="#l26.14"></a><span id="l26.14">       if (login.username == key)</span>
<a href="#l26.15"></a><span id="l26.15">         Services.logins.removeLogin(login);</span>
<a href="#l26.16"></a><span id="l26.16">     }</span>
<a href="#l26.17"></a><span id="l26.17">   },</span>
<a href="#l26.18"></a><span id="l26.18"> </span>
<a href="#l26.19"></a><span id="l26.19">   get accounts() {</span>
<a href="#l26.20"></a><span id="l26.20" class="difflineminus">-    return [this.getAccount(key)</span>
<a href="#l26.21"></a><span id="l26.21" class="difflineminus">-            for each (key in this._accountKeys)</span>
<a href="#l26.22"></a><span id="l26.22" class="difflineminus">-            if (this.getAccount(key) != null)];</span>
<a href="#l26.23"></a><span id="l26.23" class="difflineplus">+    return this._accountKeys.filter(key =&gt; this.getAccount(key) != null).</span>
<a href="#l26.24"></a><span id="l26.24" class="difflineplus">+      map(key =&gt; this.getAccount(key));</span>
<a href="#l26.25"></a><span id="l26.25">   },</span>
<a href="#l26.26"></a><span id="l26.26"> </span>
<a href="#l26.27"></a><span id="l26.27">   getAccountsForType: function CFA_getAccountsForType(aType) {</span>
<a href="#l26.28"></a><span id="l26.28">     let result = [];</span>
<a href="#l26.29"></a><span id="l26.29"> </span>
<a href="#l26.30"></a><span id="l26.30">     for (let [, accountKey] in Iterator(this._accountKeys)) {</span>
<a href="#l26.31"></a><span id="l26.31">       let type = Services.prefs.getCharPref(ACCOUNT_ROOT + accountKey</span>
<a href="#l26.32"></a><span id="l26.32">                                             + &quot;.type&quot;);</span>
<a href="#l26.33"></a><span id="l26.33" class="difflineat">@@ -281,17 +280,17 @@ var cloudFileAccounts = {</span>
<a href="#l26.34"></a><span id="l26.34">    *</span>
<a href="#l26.35"></a><span id="l26.35">    * @param aKey a key for an nsIMsgCloudFileProvider that we're searching</span>
<a href="#l26.36"></a><span id="l26.36">    *             for login info for.</span>
<a href="#l26.37"></a><span id="l26.37">    * @param aRealm the realm that the login info was stored under.</span>
<a href="#l26.38"></a><span id="l26.38">    */</span>
<a href="#l26.39"></a><span id="l26.39">   _getLoginInfoForKey: function(aKey, aRealm) {</span>
<a href="#l26.40"></a><span id="l26.40">     let logins = Services.logins</span>
<a href="#l26.41"></a><span id="l26.41">                          .findLogins({}, PWDMGR_HOST, null, aRealm);</span>
<a href="#l26.42"></a><span id="l26.42" class="difflineminus">-    for each (let login in logins) {</span>
<a href="#l26.43"></a><span id="l26.43" class="difflineplus">+    for (let login of logins) {</span>
<a href="#l26.44"></a><span id="l26.44">       if (login.username == aKey)</span>
<a href="#l26.45"></a><span id="l26.45">         return login;</span>
<a href="#l26.46"></a><span id="l26.46">     }</span>
<a href="#l26.47"></a><span id="l26.47">     return null;</span>
<a href="#l26.48"></a><span id="l26.48">   },</span>
<a href="#l26.49"></a><span id="l26.49"> };</span>
<a href="#l26.50"></a><span id="l26.50"> </span>
<a href="#l26.51"></a><span id="l26.51"> XPCOMUtils.defineLazyServiceGetter(this, &quot;categoryManager&quot;,</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l27.1"></a><span id="l27.1" class="difflineminus">--- a/mail/components/cloudfile/nsHightail.js</span>
<a href="#l27.2"></a><span id="l27.2" class="difflineplus">+++ b/mail/components/cloudfile/nsHightail.js</span>
<a href="#l27.3"></a><span id="l27.3" class="difflineat">@@ -754,17 +754,17 @@ nsHightail.prototype = {</span>
<a href="#l27.4"></a><span id="l27.4">   getPassword: function(aUsername, aNoPrompt) {</span>
<a href="#l27.5"></a><span id="l27.5">     this.log.info(&quot;Getting password for user: &quot; + aUsername);</span>
<a href="#l27.6"></a><span id="l27.6"> </span>
<a href="#l27.7"></a><span id="l27.7">     if (aNoPrompt)</span>
<a href="#l27.8"></a><span id="l27.8">       this.log.info(&quot;Suppressing password prompt&quot;);</span>
<a href="#l27.9"></a><span id="l27.9"> </span>
<a href="#l27.10"></a><span id="l27.10">     let passwordURI = gServerUrl;</span>
<a href="#l27.11"></a><span id="l27.11">     let logins = Services.logins.findLogins({}, passwordURI, null, passwordURI);</span>
<a href="#l27.12"></a><span id="l27.12" class="difflineminus">-    for each (let loginInfo in logins) {</span>
<a href="#l27.13"></a><span id="l27.13" class="difflineplus">+    for (let loginInfo of logins) {</span>
<a href="#l27.14"></a><span id="l27.14">       if (loginInfo.username == aUsername)</span>
<a href="#l27.15"></a><span id="l27.15">         return loginInfo.password;</span>
<a href="#l27.16"></a><span id="l27.16">     }</span>
<a href="#l27.17"></a><span id="l27.17">     if (aNoPrompt)</span>
<a href="#l27.18"></a><span id="l27.18">       return &quot;&quot;;</span>
<a href="#l27.19"></a><span id="l27.19"> </span>
<a href="#l27.20"></a><span id="l27.20">     // OK, let's prompt for it.</span>
<a href="#l27.21"></a><span id="l27.21">     let win = Services.wm.getMostRecentWindow(null);</span>
<a href="#l27.22"></a><span id="l27.22" class="difflineat">@@ -791,17 +791,17 @@ nsHightail.prototype = {</span>
<a href="#l27.23"></a><span id="l27.23">     return &quot;&quot;;</span>
<a href="#l27.24"></a><span id="l27.24">   },</span>
<a href="#l27.25"></a><span id="l27.25"> </span>
<a href="#l27.26"></a><span id="l27.26">   /**</span>
<a href="#l27.27"></a><span id="l27.27">    * Clears any saved Hightail passwords for this instance's account.</span>
<a href="#l27.28"></a><span id="l27.28">    */</span>
<a href="#l27.29"></a><span id="l27.29">   clearPassword: function() {</span>
<a href="#l27.30"></a><span id="l27.30">     let logins = Services.logins.findLogins({}, gServerUrl, null, gServerUrl);</span>
<a href="#l27.31"></a><span id="l27.31" class="difflineminus">-    for each (let loginInfo in logins)</span>
<a href="#l27.32"></a><span id="l27.32" class="difflineplus">+    for (let loginInfo of logins)</span>
<a href="#l27.33"></a><span id="l27.33">       if (loginInfo.username == this._userName)</span>
<a href="#l27.34"></a><span id="l27.34">         Services.logins.removeLogin(loginInfo);</span>
<a href="#l27.35"></a><span id="l27.35">   },</span>
<a href="#l27.36"></a><span id="l27.36"> </span>
<a href="#l27.37"></a><span id="l27.37">   /**</span>
<a href="#l27.38"></a><span id="l27.38">    * Attempt to log on and get the auth token for this Hightail account.</span>
<a href="#l27.39"></a><span id="l27.39">    *</span>
<a href="#l27.40"></a><span id="l27.40">    * @param successCallback the callback to be fired if logging on is successful</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l28.1"></a><span id="l28.1" class="difflineminus">--- a/mail/components/compose/content/MsgComposeCommands.js</span>
<a href="#l28.2"></a><span id="l28.2" class="difflineplus">+++ b/mail/components/compose/content/MsgComposeCommands.js</span>
<a href="#l28.3"></a><span id="l28.3" class="difflineat">@@ -1041,17 +1041,17 @@ function updateAllItems(aDisable)</span>
<a href="#l28.4"></a><span id="l28.4"> </span>
<a href="#l28.5"></a><span id="l28.5"> </span>
<a href="#l28.6"></a><span id="l28.6">   // This array will contain HTMLCollection objects as members.</span>
<a href="#l28.7"></a><span id="l28.7">   let commandItemCollections = [];</span>
<a href="#l28.8"></a><span id="l28.8">   commandItemCollections.push(document.getElementsByTagName(&quot;menu&quot;));</span>
<a href="#l28.9"></a><span id="l28.9">   commandItemCollections.push(document.getElementsByTagName(&quot;toolbarbutton&quot;));</span>
<a href="#l28.10"></a><span id="l28.10">   commandItemCollections.push(document.querySelectorAll('[command]'));</span>
<a href="#l28.11"></a><span id="l28.11">   commandItemCollections.push(document.querySelectorAll('[oncommand]'));</span>
<a href="#l28.12"></a><span id="l28.12" class="difflineminus">-  for each (let itemCollection in commandItemCollections) {</span>
<a href="#l28.13"></a><span id="l28.13" class="difflineplus">+  for (let itemCollection of commandItemCollections) {</span>
<a href="#l28.14"></a><span id="l28.14">     for (let item = 0; item &lt; itemCollection.length; item++) {</span>
<a href="#l28.15"></a><span id="l28.15">       let commandItem = itemCollection[item];</span>
<a href="#l28.16"></a><span id="l28.16">       if (aDisable) {</span>
<a href="#l28.17"></a><span id="l28.17">         // Any element can appear multiple times in the commandItemCollections</span>
<a href="#l28.18"></a><span id="l28.18">         // list so only act on it if we didn't already set the &quot;stateBeforeSend&quot;</span>
<a href="#l28.19"></a><span id="l28.19">         // attribute on previous visit.</span>
<a href="#l28.20"></a><span id="l28.20">         if (!commandItem.hasAttribute(&quot;stateBeforeSend&quot;)) {</span>
<a href="#l28.21"></a><span id="l28.21">           commandItem.setAttribute(&quot;stateBeforeSend&quot;, getDisabledState(commandItem));</span>
<a href="#l28.22"></a><span id="l28.22" class="difflineat">@@ -1406,17 +1406,17 @@ function attachToCloud(aProvider)</span>
<a href="#l28.23"></a><span id="l28.23">   fp.appendFilters(nsIFilePicker.filterAll);</span>
<a href="#l28.24"></a><span id="l28.24">   if (fp.show() == nsIFilePicker.returnOK)</span>
<a href="#l28.25"></a><span id="l28.25">   {</span>
<a href="#l28.26"></a><span id="l28.26">     if (!fp.files)</span>
<a href="#l28.27"></a><span id="l28.27">       return;</span>
<a href="#l28.28"></a><span id="l28.28"> </span>
<a href="#l28.29"></a><span id="l28.29">     let files = [f for (f in fixIterator(fp.files,</span>
<a href="#l28.30"></a><span id="l28.30">                                          Components.interfaces.nsILocalFile))];</span>
<a href="#l28.31"></a><span id="l28.31" class="difflineminus">-    let attachments = [FileToAttachment(f) for each (f in files)];</span>
<a href="#l28.32"></a><span id="l28.32" class="difflineplus">+    let attachments = files.map(f =&gt; FileToAttachment(f));</span>
<a href="#l28.33"></a><span id="l28.33"> </span>
<a href="#l28.34"></a><span id="l28.34">     let i = 0;</span>
<a href="#l28.35"></a><span id="l28.35">     let items = AddAttachments(attachments, function(aItem) {</span>
<a href="#l28.36"></a><span id="l28.36">       let listener = new uploadListener(attachments[i], files[i], aProvider);</span>
<a href="#l28.37"></a><span id="l28.37">       try {</span>
<a href="#l28.38"></a><span id="l28.38">         aProvider.uploadFile(files[i], listener);</span>
<a href="#l28.39"></a><span id="l28.39">       }</span>
<a href="#l28.40"></a><span id="l28.40">       catch (ex) {</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l29.1"></a><span id="l29.1" class="difflineminus">--- a/mail/components/compose/content/bigFileObserver.js</span>
<a href="#l29.2"></a><span id="l29.2" class="difflineplus">+++ b/mail/components/compose/content/bigFileObserver.js</span>
<a href="#l29.3"></a><span id="l29.3" class="difflineat">@@ -50,17 +50,17 @@ var gBigFileObserver = {</span>
<a href="#l29.4"></a><span id="l29.4">     bucket.removeEventListener(&quot;attachment-upload-failed&quot;, this, false);</span>
<a href="#l29.5"></a><span id="l29.5">     bucket.removeEventListener(&quot;attachments-converted&quot;, this, false);</span>
<a href="#l29.6"></a><span id="l29.6"> </span>
<a href="#l29.7"></a><span id="l29.7">     let nb = document.getElementById(&quot;attachmentNotificationBox&quot;);</span>
<a href="#l29.8"></a><span id="l29.8"> </span>
<a href="#l29.9"></a><span id="l29.9">     let removeValues = [kUploadNotificationValue,</span>
<a href="#l29.10"></a><span id="l29.10">                         kPrivacyWarningNotificationValue];</span>
<a href="#l29.11"></a><span id="l29.11"> </span>
<a href="#l29.12"></a><span id="l29.12" class="difflineminus">-    for each (let [, value] in Iterator(removeValues)) {</span>
<a href="#l29.13"></a><span id="l29.13" class="difflineplus">+    for (let value of removeValues) {</span>
<a href="#l29.14"></a><span id="l29.14">       let notification = nb.getNotificationWithValue(value);</span>
<a href="#l29.15"></a><span id="l29.15">       if (notification) {</span>
<a href="#l29.16"></a><span id="l29.16">         nb.removeNotification(notification);</span>
<a href="#l29.17"></a><span id="l29.17">       }</span>
<a href="#l29.18"></a><span id="l29.18">     };</span>
<a href="#l29.19"></a><span id="l29.19">   },</span>
<a href="#l29.20"></a><span id="l29.20"> </span>
<a href="#l29.21"></a><span id="l29.21">   handleEvent: function(event) {</span>
<a href="#l29.22"></a><span id="l29.22" class="difflineat">@@ -210,17 +210,17 @@ var gBigFileObserver = {</span>
<a href="#l29.23"></a><span id="l29.23">     let cloudProvider;</span>
<a href="#l29.24"></a><span id="l29.24">     let accounts = cloudFileAccounts.accounts;</span>
<a href="#l29.25"></a><span id="l29.25"> </span>
<a href="#l29.26"></a><span id="l29.26">     if (accounts.length == 1) {</span>
<a href="#l29.27"></a><span id="l29.27">       cloudProvider = accounts[0];</span>
<a href="#l29.28"></a><span id="l29.28">     }</span>
<a href="#l29.29"></a><span id="l29.29">     else if(accounts.length &gt; 1) {</span>
<a href="#l29.30"></a><span id="l29.30">       let selection = {};</span>
<a href="#l29.31"></a><span id="l29.31" class="difflineminus">-      let names = [cloudFileAccounts.getDisplayName(i) for each (i in accounts)];</span>
<a href="#l29.32"></a><span id="l29.32" class="difflineplus">+      let names = accounts.map(i =&gt; cloudFileAccounts.getDisplayName(i));</span>
<a href="#l29.33"></a><span id="l29.33">       if (Services.prompt.select(window,</span>
<a href="#l29.34"></a><span id="l29.34">                                  this.formatString(&quot;bigFileChooseAccount.title&quot;),</span>
<a href="#l29.35"></a><span id="l29.35">                                  this.formatString(&quot;bigFileChooseAccount.text&quot;),</span>
<a href="#l29.36"></a><span id="l29.36">                                  names.length, names, selection))</span>
<a href="#l29.37"></a><span id="l29.37">         cloudProvider = accounts[selection.value];</span>
<a href="#l29.38"></a><span id="l29.38">     }</span>
<a href="#l29.39"></a><span id="l29.39">     else {</span>
<a href="#l29.40"></a><span id="l29.40">       let accountKey = cloudFileAccounts.addAccountDialog();</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l30.1"></a><span id="l30.1" class="difflineminus">--- a/mail/components/compose/content/cloudAttachmentLinkManager.js</span>
<a href="#l30.2"></a><span id="l30.2" class="difflineplus">+++ b/mail/components/compose/content/cloudAttachmentLinkManager.js</span>
<a href="#l30.3"></a><span id="l30.3" class="difflineat">@@ -264,17 +264,17 @@ var gCloudAttachmentLinkManager = {</span>
<a href="#l30.4"></a><span id="l30.4">   /**</span>
<a href="#l30.5"></a><span id="l30.5">    * Attempts to find any elements with an id in aIDs, and sets those elements</span>
<a href="#l30.6"></a><span id="l30.6">    * id attribute to the empty string, freeing up the ids for later use.</span>
<a href="#l30.7"></a><span id="l30.7">    *</span>
<a href="#l30.8"></a><span id="l30.8">    * @param aDocument the document to search for the elements.</span>
<a href="#l30.9"></a><span id="l30.9">    * @param aIDs an array of id strings.</span>
<a href="#l30.10"></a><span id="l30.10">    */</span>
<a href="#l30.11"></a><span id="l30.11">   _resetNodeIDs: function(aDocument, aIDs) {</span>
<a href="#l30.12"></a><span id="l30.12" class="difflineminus">-    for each (let [, id] in Iterator(aIDs)) {</span>
<a href="#l30.13"></a><span id="l30.13" class="difflineplus">+    for (let id of aIDs) {</span>
<a href="#l30.14"></a><span id="l30.14">       let node = aDocument.getElementById(id);</span>
<a href="#l30.15"></a><span id="l30.15">       if (node)</span>
<a href="#l30.16"></a><span id="l30.16">         node.id = &quot;&quot;;</span>
<a href="#l30.17"></a><span id="l30.17">     }</span>
<a href="#l30.18"></a><span id="l30.18">   },</span>
<a href="#l30.19"></a><span id="l30.19"> </span>
<a href="#l30.20"></a><span id="l30.20">   /**</span>
<a href="#l30.21"></a><span id="l30.21">    * Insert the header for the cloud attachment list, which we'll use to</span>
<a href="#l30.22"></a><span id="l30.22" class="difflineat">@@ -488,17 +488,17 @@ var gCloudAttachmentLinkManager = {</span>
<a href="#l30.23"></a><span id="l30.23">     if (msgType == Ci.nsIMsgCompDeliverMode.Now ||</span>
<a href="#l30.24"></a><span id="l30.24">         msgType == Ci.nsIMsgCompDeliverMode.Later ||</span>
<a href="#l30.25"></a><span id="l30.25">         msgType == Ci.nsIMsgCompDeliverMode.Background) {</span>
<a href="#l30.26"></a><span id="l30.26"> </span>
<a href="#l30.27"></a><span id="l30.27">       const kIDs = [&quot;cloudAttachmentList&quot;, &quot;cloudAttachmentListRoot&quot;,</span>
<a href="#l30.28"></a><span id="l30.28">                     &quot;cloudAttachmentListHeader&quot;];</span>
<a href="#l30.29"></a><span id="l30.29">       let mailDoc = document.getElementById(&quot;content-frame&quot;).contentDocument;</span>
<a href="#l30.30"></a><span id="l30.30"> </span>
<a href="#l30.31"></a><span id="l30.31" class="difflineminus">-      for each (let [, id] in Iterator(kIDs)) {</span>
<a href="#l30.32"></a><span id="l30.32" class="difflineplus">+      for (let id of kIDs) {</span>
<a href="#l30.33"></a><span id="l30.33">         let element = mailDoc.getElementById(id);</span>
<a href="#l30.34"></a><span id="l30.34">         if (element)</span>
<a href="#l30.35"></a><span id="l30.35">           element.removeAttribute(&quot;id&quot;);</span>
<a href="#l30.36"></a><span id="l30.36">       }</span>
<a href="#l30.37"></a><span id="l30.37">     }</span>
<a href="#l30.38"></a><span id="l30.38">   },</span>
<a href="#l30.39"></a><span id="l30.39"> };</span>
<a href="#l30.40"></a><span id="l30.40"> </span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l31.1"></a><span id="l31.1" class="difflineminus">--- a/mail/components/im/content/chat-messenger-overlay.js</span>
<a href="#l31.2"></a><span id="l31.2" class="difflineplus">+++ b/mail/components/im/content/chat-messenger-overlay.js</span>
<a href="#l31.3"></a><span id="l31.3" class="difflineat">@@ -136,17 +136,17 @@ var chatTabType = {</span>
<a href="#l31.4"></a><span id="l31.4">       chatHandler._onTabDeactivated();</span>
<a href="#l31.5"></a><span id="l31.5">   },</span>
<a href="#l31.6"></a><span id="l31.6">   openTab: function(aTab, aArgs) {</span>
<a href="#l31.7"></a><span id="l31.7">     if (!this.hasBeenOpened &amp;&amp; imServices.core.initialized) {</span>
<a href="#l31.8"></a><span id="l31.8">       let convs = imServices.conversations.getUIConversations();</span>
<a href="#l31.9"></a><span id="l31.9">       if (convs.length != 0) {</span>
<a href="#l31.10"></a><span id="l31.10">         convs.sort((a, b) =&gt;</span>
<a href="#l31.11"></a><span id="l31.11">                    a.title.toLowerCase().localeCompare(b.title.toLowerCase()));</span>
<a href="#l31.12"></a><span id="l31.12" class="difflineminus">-        for each (let conv in convs)</span>
<a href="#l31.13"></a><span id="l31.13" class="difflineplus">+        for (let conv of convs)</span>
<a href="#l31.14"></a><span id="l31.14">           chatHandler._addConversation(conv);</span>
<a href="#l31.15"></a><span id="l31.15">       }</span>
<a href="#l31.16"></a><span id="l31.16"> </span>
<a href="#l31.17"></a><span id="l31.17">       // The tab monitor will inform us when a different tab is selected.</span>
<a href="#l31.18"></a><span id="l31.18">       let tabmail = document.getElementById(&quot;tabmail&quot;);</span>
<a href="#l31.19"></a><span id="l31.19">       tabmail.registerTabMonitor(this.tabMonitor);</span>
<a href="#l31.20"></a><span id="l31.20">       window.addEventListener(&quot;deactivate&quot;, chatTabType._onWindowDeactivated);</span>
<a href="#l31.21"></a><span id="l31.21">       window.addEventListener(&quot;activate&quot;, chatTabType._onWindowActivated);</span>
<a href="#l31.22"></a><span id="l31.22" class="difflineat">@@ -334,17 +334,17 @@ var chatHandler = {</span>
<a href="#l31.23"></a><span id="l31.23">       this._notifiedUnreadCount = unreadTargettedCount;</span>
<a href="#l31.24"></a><span id="l31.24">     }</span>
<a href="#l31.25"></a><span id="l31.25">   },</span>
<a href="#l31.26"></a><span id="l31.26"> </span>
<a href="#l31.27"></a><span id="l31.27">   countUnreadMessages: function() {</span>
<a href="#l31.28"></a><span id="l31.28">     let convs = imServices.conversations.getUIConversations();</span>
<a href="#l31.29"></a><span id="l31.29">     let unreadTargettedCount = 0;</span>
<a href="#l31.30"></a><span id="l31.30">     let unreadTotalCount = 0;</span>
<a href="#l31.31"></a><span id="l31.31" class="difflineminus">-    for each (let conv in convs) {</span>
<a href="#l31.32"></a><span id="l31.32" class="difflineplus">+    for (let conv of convs) {</span>
<a href="#l31.33"></a><span id="l31.33">       unreadTargettedCount += conv.unreadTargetedMessageCount;</span>
<a href="#l31.34"></a><span id="l31.34">       unreadTotalCount += conv.unreadIncomingMessageCount;</span>
<a href="#l31.35"></a><span id="l31.35">     }</span>
<a href="#l31.36"></a><span id="l31.36">     return [unreadTargettedCount, unreadTotalCount];</span>
<a href="#l31.37"></a><span id="l31.37">   },</span>
<a href="#l31.38"></a><span id="l31.38"> </span>
<a href="#l31.39"></a><span id="l31.39">   updateTitle: function() {</span>
<a href="#l31.40"></a><span id="l31.40">     if (!gChatTab)</span>
<a href="#l31.41"></a><span id="l31.41" class="difflineat">@@ -822,29 +822,29 @@ var chatHandler = {</span>
<a href="#l31.42"></a><span id="l31.42">       connected || !hasAccount;</span>
<a href="#l31.43"></a><span id="l31.43">     if (connected) {</span>
<a href="#l31.44"></a><span id="l31.44">       delete this._placeHolderButtonId;</span>
<a href="#l31.45"></a><span id="l31.45">     }</span>
<a href="#l31.46"></a><span id="l31.46">     else {</span>
<a href="#l31.47"></a><span id="l31.47">       this._placeHolderButtonId =</span>
<a href="#l31.48"></a><span id="l31.48">         hasAccount ? &quot;openIMAccountManagerButton&quot; : &quot;openIMAccountWizardButton&quot;;</span>
<a href="#l31.49"></a><span id="l31.49">     }</span>
<a href="#l31.50"></a><span id="l31.50" class="difflineminus">-    for each (let id in [&quot;statusTypeIcon&quot;, &quot;statusMessage&quot;, &quot;button-chat-accounts&quot;]) {</span>
<a href="#l31.51"></a><span id="l31.51" class="difflineplus">+    for (let id of [&quot;statusTypeIcon&quot;, &quot;statusMessage&quot;, &quot;button-chat-accounts&quot;]) {</span>
<a href="#l31.52"></a><span id="l31.52">       let elt = document.getElementById(id);</span>
<a href="#l31.53"></a><span id="l31.53">       if (elt)</span>
<a href="#l31.54"></a><span id="l31.54">         elt.disabled = !hasAccount;</span>
<a href="#l31.55"></a><span id="l31.55">     }</span>
<a href="#l31.56"></a><span id="l31.56" class="difflineminus">-    for each (let id in [&quot;button-add-buddy&quot;, &quot;newIMContactMenuItem&quot;,</span>
<a href="#l31.57"></a><span id="l31.57" class="difflineminus">-                         &quot;appmenu_newIMContactMenuItem&quot;]) {</span>
<a href="#l31.58"></a><span id="l31.58" class="difflineplus">+    for (let id of [&quot;button-add-buddy&quot;, &quot;newIMContactMenuItem&quot;,</span>
<a href="#l31.59"></a><span id="l31.59" class="difflineplus">+                    &quot;appmenu_newIMContactMenuItem&quot;]) {</span>
<a href="#l31.60"></a><span id="l31.60">       let elt = document.getElementById(id);</span>
<a href="#l31.61"></a><span id="l31.61">       if (elt)</span>
<a href="#l31.62"></a><span id="l31.62">         elt.disabled = !connected;</span>
<a href="#l31.63"></a><span id="l31.63">     }</span>
<a href="#l31.64"></a><span id="l31.64" class="difflineminus">-    for each (let id in [&quot;button-join-chat&quot;, &quot;joinChatMenuItem&quot;,</span>
<a href="#l31.65"></a><span id="l31.65" class="difflineminus">-                         &quot;appmenu_joinChatMenuItem&quot;]) {</span>
<a href="#l31.66"></a><span id="l31.66" class="difflineplus">+    for (let id of [&quot;button-join-chat&quot;, &quot;joinChatMenuItem&quot;,</span>
<a href="#l31.67"></a><span id="l31.67" class="difflineplus">+                    &quot;appmenu_joinChatMenuItem&quot;]) {</span>
<a href="#l31.68"></a><span id="l31.68">       let elt = document.getElementById(id);</span>
<a href="#l31.69"></a><span id="l31.69">       if (elt)</span>
<a href="#l31.70"></a><span id="l31.70">         elt.disabled = !canJoinChat;</span>
<a href="#l31.71"></a><span id="l31.71">     }</span>
<a href="#l31.72"></a><span id="l31.72">     let groupIds = [&quot;conversations&quot;, &quot;onlinecontacts&quot;, &quot;offlinecontacts&quot;];</span>
<a href="#l31.73"></a><span id="l31.73">     let contactlist = document.getElementById(&quot;contactlistbox&quot;);</span>
<a href="#l31.74"></a><span id="l31.74">     if (!hasAccount || !connected &amp;&amp; groupIds.every(id =&gt;</span>
<a href="#l31.75"></a><span id="l31.75">         document.getElementById(id + &quot;Group&quot;).contacts.length)) {</span>
<a href="#l31.76"></a><span id="l31.76" class="difflineat">@@ -892,17 +892,17 @@ var chatHandler = {</span>
<a href="#l31.77"></a><span id="l31.77">     }</span>
<a href="#l31.78"></a><span id="l31.78"> </span>
<a href="#l31.79"></a><span id="l31.79">     // No conversation, if a visible item is selected, keep it.</span>
<a href="#l31.80"></a><span id="l31.80">     if (selectedItem &amp;&amp; !selectedItem.collapsed)</span>
<a href="#l31.81"></a><span id="l31.81">       return;</span>
<a href="#l31.82"></a><span id="l31.82"> </span>
<a href="#l31.83"></a><span id="l31.83">     // Select the first visible group header.</span>
<a href="#l31.84"></a><span id="l31.84">     let groupIds = [&quot;conversations&quot;, &quot;onlinecontacts&quot;, &quot;offlinecontacts&quot;];</span>
<a href="#l31.85"></a><span id="l31.85" class="difflineminus">-    for each (let id in groupIds) {</span>
<a href="#l31.86"></a><span id="l31.86" class="difflineplus">+    for (let id of groupIds) {</span>
<a href="#l31.87"></a><span id="l31.87">       let item = document.getElementById(id + &quot;Group&quot;);</span>
<a href="#l31.88"></a><span id="l31.88">       if (item.collapsed)</span>
<a href="#l31.89"></a><span id="l31.89">         continue;</span>
<a href="#l31.90"></a><span id="l31.90">       list.selectedItem = item;</span>
<a href="#l31.91"></a><span id="l31.91">       return;</span>
<a href="#l31.92"></a><span id="l31.92">     }</span>
<a href="#l31.93"></a><span id="l31.93">   },</span>
<a href="#l31.94"></a><span id="l31.94">   _updateFocus: function() {</span>
<a href="#l31.95"></a><span id="l31.95" class="difflineat">@@ -937,17 +937,17 @@ var chatHandler = {</span>
<a href="#l31.96"></a><span id="l31.96">       return;</span>
<a href="#l31.97"></a><span id="l31.97">     }</span>
<a href="#l31.98"></a><span id="l31.98"> </span>
<a href="#l31.99"></a><span id="l31.99">     if (aTopic == &quot;conversation-loaded&quot;) {</span>
<a href="#l31.100"></a><span id="l31.100">       let browser = document.getElementById(&quot;conv-log-browser&quot;);</span>
<a href="#l31.101"></a><span id="l31.101">       if (aSubject != browser)</span>
<a href="#l31.102"></a><span id="l31.102">         return;</span>
<a href="#l31.103"></a><span id="l31.103"> </span>
<a href="#l31.104"></a><span id="l31.104" class="difflineminus">-      for each (let msg in browser._conv.getMessages()) {</span>
<a href="#l31.105"></a><span id="l31.105" class="difflineplus">+      for (let msg of browser._conv.getMessages()) {</span>
<a href="#l31.106"></a><span id="l31.106">         if (!msg.system)</span>
<a href="#l31.107"></a><span id="l31.107">           msg.color = &quot;color: hsl(&quot; + this._computeColor(msg.who) + &quot;, 100%, 40%);&quot;;</span>
<a href="#l31.108"></a><span id="l31.108">         browser.appendMessage(msg);</span>
<a href="#l31.109"></a><span id="l31.109">       }</span>
<a href="#l31.110"></a><span id="l31.110"> </span>
<a href="#l31.111"></a><span id="l31.111">       if (this._pendingSearchTerm) {</span>
<a href="#l31.112"></a><span id="l31.112">         let findbar = document.getElementById(&quot;log-findbar&quot;);</span>
<a href="#l31.113"></a><span id="l31.113">         findbar._findField.value = this._pendingSearchTerm;</span>
<a href="#l31.114"></a><span id="l31.114" class="difflineat">@@ -1066,17 +1066,18 @@ var chatHandler = {</span>
<a href="#l31.115"></a><span id="l31.115">         notification.close();</span>
<a href="#l31.116"></a><span id="l31.116">       return;</span>
<a href="#l31.117"></a><span id="l31.117">     }</span>
<a href="#l31.118"></a><span id="l31.118">   },</span>
<a href="#l31.119"></a><span id="l31.119">   initAfterChatCore: function() {</span>
<a href="#l31.120"></a><span id="l31.120">     let onGroup = document.getElementById(&quot;onlinecontactsGroup&quot;);</span>
<a href="#l31.121"></a><span id="l31.121">     let offGroup = document.getElementById(&quot;offlinecontactsGroup&quot;);</span>
<a href="#l31.122"></a><span id="l31.122"> </span>
<a href="#l31.123"></a><span id="l31.123" class="difflineminus">-    for each (let contact in chatHandler.allContacts) {</span>
<a href="#l31.124"></a><span id="l31.124" class="difflineplus">+    for (let name in chatHandler.allContacts) {</span>
<a href="#l31.125"></a><span id="l31.125" class="difflineplus">+      let contact = chatHandler.allContacts[name];</span>
<a href="#l31.126"></a><span id="l31.126">       let group = contact.online ? onGroup : offGroup;</span>
<a href="#l31.127"></a><span id="l31.127">       group.addContact(contact);</span>
<a href="#l31.128"></a><span id="l31.128">     }</span>
<a href="#l31.129"></a><span id="l31.129"> </span>
<a href="#l31.130"></a><span id="l31.130">     onGroup._updateGroupLabel();</span>
<a href="#l31.131"></a><span id="l31.131">     offGroup._updateGroupLabel();</span>
<a href="#l31.132"></a><span id="l31.132"> </span>
<a href="#l31.133"></a><span id="l31.133">     [&quot;new-text&quot;, &quot;new-ui-conversation&quot;, &quot;ui-conversation-closed&quot;,</span>
<a href="#l31.134"></a><span id="l31.134" class="difflineat">@@ -1090,17 +1091,17 @@ var chatHandler = {</span>
<a href="#l31.135"></a><span id="l31.135">     statusSelector.init();</span>
<a href="#l31.136"></a><span id="l31.136">   },</span>
<a href="#l31.137"></a><span id="l31.137">   _observedTopics: [],</span>
<a href="#l31.138"></a><span id="l31.138">   _addObserver: function(aTopic) {</span>
<a href="#l31.139"></a><span id="l31.139">     imServices.obs.addObserver(chatHandler, aTopic, false);</span>
<a href="#l31.140"></a><span id="l31.140">     chatHandler._observedTopics.push(aTopic);</span>
<a href="#l31.141"></a><span id="l31.141">   },</span>
<a href="#l31.142"></a><span id="l31.142">   _removeObservers: function() {</span>
<a href="#l31.143"></a><span id="l31.143" class="difflineminus">-    for each (let topic in this._observedTopics)</span>
<a href="#l31.144"></a><span id="l31.144" class="difflineplus">+    for (let topic of this._observedTopics)</span>
<a href="#l31.145"></a><span id="l31.145">       imServices.obs.removeObserver(this, topic);</span>
<a href="#l31.146"></a><span id="l31.146">   },</span>
<a href="#l31.147"></a><span id="l31.147">   init: function() {</span>
<a href="#l31.148"></a><span id="l31.148">     Notifications.init();</span>
<a href="#l31.149"></a><span id="l31.149">     if (!Services.prefs.getBoolPref(&quot;mail.chat.enabled&quot;)) {</span>
<a href="#l31.150"></a><span id="l31.150">       [&quot;button-chat&quot;, &quot;menu_goChat&quot;, &quot;goChatSeparator&quot;,</span>
<a href="#l31.151"></a><span id="l31.151">        &quot;imAccountsStatus&quot;, &quot;joinChatMenuItem&quot;, &quot;newIMAccountMenuItem&quot;,</span>
<a href="#l31.152"></a><span id="l31.152">        &quot;newIMContactMenuItem&quot;, &quot;appmenu_joinChatMenuItem&quot;, &quot;appmenu_afterChatSeparator&quot;,</span>
<a href="#l31.153"></a><span id="l31.153" class="difflineat">@@ -1161,17 +1162,17 @@ var chatHandler = {</span>
<a href="#l31.154"></a><span id="l31.154">       this._addObserver(&quot;chat-core-initialized&quot;);</span>
<a href="#l31.155"></a><span id="l31.155">     }</span>
<a href="#l31.156"></a><span id="l31.156">   }</span>
<a href="#l31.157"></a><span id="l31.157"> };</span>
<a href="#l31.158"></a><span id="l31.158"> </span>
<a href="#l31.159"></a><span id="l31.159"> function chatLogTreeGroupItem(aTitle, aLogItems) {</span>
<a href="#l31.160"></a><span id="l31.160">   this._title = aTitle;</span>
<a href="#l31.161"></a><span id="l31.161">   this._children = aLogItems;</span>
<a href="#l31.162"></a><span id="l31.162" class="difflineminus">-  for each (let child in this._children)</span>
<a href="#l31.163"></a><span id="l31.163" class="difflineplus">+  for (let child of this._children)</span>
<a href="#l31.164"></a><span id="l31.164">     child._parent = this;</span>
<a href="#l31.165"></a><span id="l31.165">   this._open = false;</span>
<a href="#l31.166"></a><span id="l31.166"> }</span>
<a href="#l31.167"></a><span id="l31.167"> chatLogTreeGroupItem.prototype = {</span>
<a href="#l31.168"></a><span id="l31.168">   getText: function() { return this._title; },</span>
<a href="#l31.169"></a><span id="l31.169">   get id() { return this._title; },</span>
<a href="#l31.170"></a><span id="l31.170">   get open() { return this._open; },</span>
<a href="#l31.171"></a><span id="l31.171">   get level() { return 0; },</span>
<a href="#l31.172"></a><span id="l31.172" class="difflineat">@@ -1313,17 +1314,18 @@ chatLogTreeView.prototype = {</span>
<a href="#l31.173"></a><span id="l31.173">         group = groups[groupID].entries;</span>
<a href="#l31.174"></a><span id="l31.174">       }</span>
<a href="#l31.175"></a><span id="l31.175">       group.push(new chatLogTreeLogItem(log, title, 1));</span>
<a href="#l31.176"></a><span id="l31.176">     }</span>
<a href="#l31.177"></a><span id="l31.177"> </span>
<a href="#l31.178"></a><span id="l31.178">     let groupIDs = Object.keys(groups).sort().reverse();</span>
<a href="#l31.179"></a><span id="l31.179"> </span>
<a href="#l31.180"></a><span id="l31.180">     // Add firstgroups to groups and groupIDs.</span>
<a href="#l31.181"></a><span id="l31.181" class="difflineminus">-    for each (let [groupID, group] in Iterator(firstgroups)) {</span>
<a href="#l31.182"></a><span id="l31.182" class="difflineplus">+    for (let groupID in firstgroups) {</span>
<a href="#l31.183"></a><span id="l31.183" class="difflineplus">+      let group = firstgroups[groupID];</span>
<a href="#l31.184"></a><span id="l31.184">       if (!group.length)</span>
<a href="#l31.185"></a><span id="l31.185">         continue;</span>
<a href="#l31.186"></a><span id="l31.186">       groupIDs.unshift(groupID);</span>
<a href="#l31.187"></a><span id="l31.187">       groups[groupID] = {</span>
<a href="#l31.188"></a><span id="l31.188">         entries: firstgroups[groupID],</span>
<a href="#l31.189"></a><span id="l31.189">         name: chatBundle.getString(&quot;log.&quot; + groupID)</span>
<a href="#l31.190"></a><span id="l31.190">       };</span>
<a href="#l31.191"></a><span id="l31.191">     }</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l32.1"></a><span id="l32.1" class="difflineminus">--- a/mail/components/im/content/imAccounts.js</span>
<a href="#l32.2"></a><span id="l32.2" class="difflineplus">+++ b/mail/components/im/content/imAccounts.js</span>
<a href="#l32.3"></a><span id="l32.3" class="difflineat">@@ -40,17 +40,17 @@ var gAccountManager = {</span>
<a href="#l32.4"></a><span id="l32.4">       Services.core.init(); // ensure the imCore is initialized.</span>
<a href="#l32.5"></a><span id="l32.5">       for (let acc in this.getAccounts()) {</span>
<a href="#l32.6"></a><span id="l32.6">         var elt = document.createElement(&quot;richlistitem&quot;);</span>
<a href="#l32.7"></a><span id="l32.7">         this.accountList.appendChild(elt);</span>
<a href="#l32.8"></a><span id="l32.8">         elt.build(acc);</span>
<a href="#l32.9"></a><span id="l32.9">         if (!defaultID &amp;&amp; acc.firstConnectionState == acc.FIRST_CONNECTION_CRASHED)</span>
<a href="#l32.10"></a><span id="l32.10">           defaultID = acc.id;</span>
<a href="#l32.11"></a><span id="l32.11">       }</span>
<a href="#l32.12"></a><span id="l32.12" class="difflineminus">-      for each (let event in events)</span>
<a href="#l32.13"></a><span id="l32.13" class="difflineplus">+      for (let event of events)</span>
<a href="#l32.14"></a><span id="l32.14">         Services.obs.addObserver(this, event, false);</span>
<a href="#l32.15"></a><span id="l32.15">       if (!this.accountList.getRowCount())</span>
<a href="#l32.16"></a><span id="l32.16">         // This is horrible, but it works. Otherwise (at least on mac)</span>
<a href="#l32.17"></a><span id="l32.17">         // the wizard is not centered relatively to the account manager</span>
<a href="#l32.18"></a><span id="l32.18">         setTimeout(function() { gAccountManager.new(); }, 0);</span>
<a href="#l32.19"></a><span id="l32.19">       else {</span>
<a href="#l32.20"></a><span id="l32.20">         // we have accounts, show the list</span>
<a href="#l32.21"></a><span id="l32.21">         document.getElementById(&quot;accountsDesk&quot;).selectedIndex = 1;</span>
<a href="#l32.22"></a><span id="l32.22" class="difflineat">@@ -69,17 +69,17 @@ var gAccountManager = {</span>
<a href="#l32.23"></a><span id="l32.23">       this._connectedLabelInterval = setInterval(this.updateConnectedLabels, 60000);</span>
<a href="#l32.24"></a><span id="l32.24">       statusSelector.init();</span>
<a href="#l32.25"></a><span id="l32.25">     }, () =&gt; {</span>
<a href="#l32.26"></a><span id="l32.26">       this.close();</span>
<a href="#l32.27"></a><span id="l32.27">     });</span>
<a href="#l32.28"></a><span id="l32.28">   },</span>
<a href="#l32.29"></a><span id="l32.29">   unload: function am_unload() {</span>
<a href="#l32.30"></a><span id="l32.30">     clearInterval(this._connectedLabelInterval);</span>
<a href="#l32.31"></a><span id="l32.31" class="difflineminus">-    for each (let event in events)</span>
<a href="#l32.32"></a><span id="l32.32" class="difflineplus">+    for (let event of events)</span>
<a href="#l32.33"></a><span id="l32.33">       Services.obs.removeObserver(this, event);</span>
<a href="#l32.34"></a><span id="l32.34">   },</span>
<a href="#l32.35"></a><span id="l32.35">   _updateAccountList: function am__updateAccountList() {</span>
<a href="#l32.36"></a><span id="l32.36">     let accountList = this.accountList;</span>
<a href="#l32.37"></a><span id="l32.37">     let i = 0;</span>
<a href="#l32.38"></a><span id="l32.38">     for (let acc in this.getAccounts()) {</span>
<a href="#l32.39"></a><span id="l32.39">       let oldItem = accountList.getItemAtIndex(i);</span>
<a href="#l32.40"></a><span id="l32.40">       if (oldItem.id != acc.id) {</span>
<a href="#l32.41"></a><span id="l32.41" class="difflineat">@@ -347,23 +347,23 @@ var gAccountManager = {</span>
<a href="#l32.42"></a><span id="l32.42">       return;</span>
<a href="#l32.43"></a><span id="l32.43"> </span>
<a href="#l32.44"></a><span id="l32.44">     let account = selectedItem.account;</span>
<a href="#l32.45"></a><span id="l32.45">     let isCommandDisabled =</span>
<a href="#l32.46"></a><span id="l32.46">       (this.isOffline ||</span>
<a href="#l32.47"></a><span id="l32.47">        (account.disconnected &amp;&amp;</span>
<a href="#l32.48"></a><span id="l32.48">         account.connectionErrorReason == Ci.imIAccount.ERROR_UNKNOWN_PRPL));</span>
<a href="#l32.49"></a><span id="l32.49"> </span>
<a href="#l32.50"></a><span id="l32.50" class="difflineminus">-    let disabledItems = {</span>
<a href="#l32.51"></a><span id="l32.51" class="difflineminus">-      connect: isCommandDisabled,</span>
<a href="#l32.52"></a><span id="l32.52" class="difflineminus">-      disconnect: isCommandDisabled,</span>
<a href="#l32.53"></a><span id="l32.53" class="difflineminus">-      moveup: accountList.selectedIndex == 0,</span>
<a href="#l32.54"></a><span id="l32.54" class="difflineminus">-      movedown: accountList.selectedIndex == accountList.itemCount - 1</span>
<a href="#l32.55"></a><span id="l32.55" class="difflineminus">-    };</span>
<a href="#l32.56"></a><span id="l32.56" class="difflineminus">-    for each (let [name, state] in Iterator(disabledItems)) {</span>
<a href="#l32.57"></a><span id="l32.57" class="difflineplus">+    let disabledItems = [</span>
<a href="#l32.58"></a><span id="l32.58" class="difflineplus">+      [&quot;connect&quot;, isCommandDisabled],</span>
<a href="#l32.59"></a><span id="l32.59" class="difflineplus">+      [&quot;disconnect&quot;, isCommandDisabled],</span>
<a href="#l32.60"></a><span id="l32.60" class="difflineplus">+      [&quot;moveup&quot;, accountList.selectedIndex == 0],</span>
<a href="#l32.61"></a><span id="l32.61" class="difflineplus">+      [&quot;movedown&quot;, accountList.selectedIndex == accountList.itemCount - 1],</span>
<a href="#l32.62"></a><span id="l32.62" class="difflineplus">+    ];</span>
<a href="#l32.63"></a><span id="l32.63" class="difflineplus">+    for (let [name, state] of disabledItems) {</span>
<a href="#l32.64"></a><span id="l32.64">       let elt = document.getElementById(&quot;cmd_&quot; + name);</span>
<a href="#l32.65"></a><span id="l32.65">       if (state)</span>
<a href="#l32.66"></a><span id="l32.66">         elt.setAttribute(&quot;disabled&quot;, &quot;true&quot;);</span>
<a href="#l32.67"></a><span id="l32.67">       else</span>
<a href="#l32.68"></a><span id="l32.68">         elt.removeAttribute(&quot;disabled&quot;);</span>
<a href="#l32.69"></a><span id="l32.69">     }</span>
<a href="#l32.70"></a><span id="l32.70">   },</span>
<a href="#l32.71"></a><span id="l32.71">   onContextMenuShowing: function am_onContextMenuShowing() {</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l33.1"></a><span id="l33.1" class="difflineminus">--- a/mail/components/im/content/imContextMenu.js</span>
<a href="#l33.2"></a><span id="l33.2" class="difflineplus">+++ b/mail/components/im/content/imContextMenu.js</span>
<a href="#l33.3"></a><span id="l33.3" class="difflineat">@@ -82,17 +82,17 @@ imContextMenu.prototype = {</span>
<a href="#l33.4"></a><span id="l33.4">     this.showItem(&quot;context-copyemail&quot;, this.onMailtoLink);</span>
<a href="#l33.5"></a><span id="l33.5"> </span>
<a href="#l33.6"></a><span id="l33.6">     // Copy link location depends on whether we're on a non-mailto link.</span>
<a href="#l33.7"></a><span id="l33.7">     this.showItem(&quot;context-copylink&quot;, this.onLink &amp;&amp; !this.onMailtoLink);</span>
<a href="#l33.8"></a><span id="l33.8">     this.showItem(&quot;context-sep-copylink&quot;, this.onLink &amp;&amp; this.isContentSelected);</span>
<a href="#l33.9"></a><span id="l33.9"> </span>
<a href="#l33.10"></a><span id="l33.10">     // Display action menu items.</span>
<a href="#l33.11"></a><span id="l33.11">     let sep = document.getElementById(&quot;context-sep-messageactions&quot;);</span>
<a href="#l33.12"></a><span id="l33.12" class="difflineminus">-    for each (let action in actions) {</span>
<a href="#l33.13"></a><span id="l33.13" class="difflineplus">+    for (let action of actions) {</span>
<a href="#l33.14"></a><span id="l33.14">       let menuitem = document.createElement(&quot;menuitem&quot;);</span>
<a href="#l33.15"></a><span id="l33.15">       menuitem.setAttribute(&quot;label&quot;, action.label);</span>
<a href="#l33.16"></a><span id="l33.16">       menuitem.setAttribute(&quot;oncommand&quot;, &quot;this.action.run();&quot;);</span>
<a href="#l33.17"></a><span id="l33.17">       menuitem.action = action;</span>
<a href="#l33.18"></a><span id="l33.18">       sep.parentNode.appendChild(menuitem);</span>
<a href="#l33.19"></a><span id="l33.19">     }</span>
<a href="#l33.20"></a><span id="l33.20">   },</span>
<a href="#l33.21"></a><span id="l33.21"> </span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l34.1"></a><span id="l34.1" class="difflineminus">--- a/mail/components/im/content/imStatusSelector.js</span>
<a href="#l34.2"></a><span id="l34.2" class="difflineplus">+++ b/mail/components/im/content/imStatusSelector.js</span>
<a href="#l34.3"></a><span id="l34.3" class="difflineat">@@ -266,20 +266,20 @@ var statusSelector = {</span>
<a href="#l34.4"></a><span id="l34.4">       events.push(&quot;user-icon-changed&quot;);</span>
<a href="#l34.5"></a><span id="l34.5">       statusSelector.displayUserIcon();</span>
<a href="#l34.6"></a><span id="l34.6">     }</span>
<a href="#l34.7"></a><span id="l34.7"> </span>
<a href="#l34.8"></a><span id="l34.8">     let statusMessage = document.getElementById(&quot;statusMessage&quot;);</span>
<a href="#l34.9"></a><span id="l34.9">     if (statusMessage)</span>
<a href="#l34.10"></a><span id="l34.10">       statusMessage.addEventListener(&quot;keypress&quot;, this.statusMessageKeyPress);</span>
<a href="#l34.11"></a><span id="l34.11"> </span>
<a href="#l34.12"></a><span id="l34.12" class="difflineminus">-    for each (let event in events)</span>
<a href="#l34.13"></a><span id="l34.13" class="difflineplus">+    for (let event of events)</span>
<a href="#l34.14"></a><span id="l34.14">       Services.obs.addObserver(statusSelector, event, false);</span>
<a href="#l34.15"></a><span id="l34.15">     statusSelector._events = events;</span>
<a href="#l34.16"></a><span id="l34.16"> </span>
<a href="#l34.17"></a><span id="l34.17">     window.addEventListener(&quot;unload&quot;, statusSelector.unload);</span>
<a href="#l34.18"></a><span id="l34.18">   },</span>
<a href="#l34.19"></a><span id="l34.19"> </span>
<a href="#l34.20"></a><span id="l34.20">   unload: function ss_unload() {</span>
<a href="#l34.21"></a><span id="l34.21" class="difflineminus">-    for each (let event in statusSelector._events)</span>
<a href="#l34.22"></a><span id="l34.22" class="difflineplus">+    for (let event of statusSelector._events)</span>
<a href="#l34.23"></a><span id="l34.23">       Services.obs.removeObserver(statusSelector, event);</span>
<a href="#l34.24"></a><span id="l34.24">    }</span>
<a href="#l34.25"></a><span id="l34.25"> };</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l35.1"></a><span id="l35.1" class="difflineminus">--- a/mail/components/im/content/imconversation.xml</span>
<a href="#l35.2"></a><span id="l35.2" class="difflineplus">+++ b/mail/components/im/content/imconversation.xml</span>
<a href="#l35.3"></a><span id="l35.3" class="difflineat">@@ -565,17 +565,17 @@</span>
<a href="#l35.4"></a><span id="l35.4">           let word = words[0];</span>
<a href="#l35.5"></a><span id="l35.5">           if (!word)</span>
<a href="#l35.6"></a><span id="l35.6">             return;</span>
<a href="#l35.7"></a><span id="l35.7">           let isFirstWord = inputBox.selectionStart == word.length;</span>
<a href="#l35.8"></a><span id="l35.8"> </span>
<a href="#l35.9"></a><span id="l35.9">           // Check if we are completing a command.</span>
<a href="#l35.10"></a><span id="l35.10">           let completingCommand = isFirstWord &amp;&amp; word[0] == &quot;/&quot;;</span>
<a href="#l35.11"></a><span id="l35.11">           if (completingCommand) {</span>
<a href="#l35.12"></a><span id="l35.12" class="difflineminus">-            for each (let cmd in Services.cmd.listCommandsForConversation(this._conv)) {</span>
<a href="#l35.13"></a><span id="l35.13" class="difflineplus">+            for (let cmd of Services.cmd.listCommandsForConversation(this._conv)) {</span>
<a href="#l35.14"></a><span id="l35.14">               // It's possible to have a global and a protocol specific command</span>
<a href="#l35.15"></a><span id="l35.15">               // with the same name. Avoid duplicates in the |completions| array.</span>
<a href="#l35.16"></a><span id="l35.16">               let name = &quot;/&quot; + cmd.name;</span>
<a href="#l35.17"></a><span id="l35.17">               if (completions.indexOf(name) == -1)</span>
<a href="#l35.18"></a><span id="l35.18">                 completions.push(name);</span>
<a href="#l35.19"></a><span id="l35.19">             }</span>
<a href="#l35.20"></a><span id="l35.20">           }</span>
<a href="#l35.21"></a><span id="l35.21">           else {</span>
<a href="#l35.22"></a><span id="l35.22" class="difflineat">@@ -635,17 +635,17 @@</span>
<a href="#l35.23"></a><span id="l35.23">             matchingCompletions = completions.filter(condition);</span>
<a href="#l35.24"></a><span id="l35.24">           }</span>
<a href="#l35.25"></a><span id="l35.25">           if (!matchingCompletions.length)</span>
<a href="#l35.26"></a><span id="l35.26">             return;</span>
<a href="#l35.27"></a><span id="l35.27"> </span>
<a href="#l35.28"></a><span id="l35.28">           // If the cursor is in the middle of a word, and the word is a nick,</span>
<a href="#l35.29"></a><span id="l35.29">           // there is no need to complete - just jump to the end of the nick.</span>
<a href="#l35.30"></a><span id="l35.30">           let wholeWord = text.substring(inputBox.selectionStart - word.length);</span>
<a href="#l35.31"></a><span id="l35.31" class="difflineminus">-          for each (let completion in matchingCompletions) {</span>
<a href="#l35.32"></a><span id="l35.32" class="difflineplus">+          for (let completion of matchingCompletions) {</span>
<a href="#l35.33"></a><span id="l35.33">             if (wholeWord.lastIndexOf(completion, 0) == 0) {</span>
<a href="#l35.34"></a><span id="l35.34">               let moveCursor = completion.length - word.length;</span>
<a href="#l35.35"></a><span id="l35.35">               inputBox.selectionStart += moveCursor;</span>
<a href="#l35.36"></a><span id="l35.36">               let separator = text.substring(inputBox.selectionStart,</span>
<a href="#l35.37"></a><span id="l35.37">                                              inputBox.selectionStart + 2);</span>
<a href="#l35.38"></a><span id="l35.38">               if (separator == &quot;: &quot; || separator == &quot;, &quot;)</span>
<a href="#l35.39"></a><span id="l35.39">                 inputBox.selectionStart += 2;</span>
<a href="#l35.40"></a><span id="l35.40">               else if (!moveCursor) {</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l36.1"></a><span id="l36.1" class="difflineminus">--- a/mail/components/im/content/imgroup.xml</span>
<a href="#l36.2"></a><span id="l36.2" class="difflineplus">+++ b/mail/components/im/content/imgroup.xml</span>
<a href="#l36.3"></a><span id="l36.3" class="difflineat">@@ -134,17 +134,17 @@</span>
<a href="#l36.4"></a><span id="l36.4">       ]]&gt;</span>
<a href="#l36.5"></a><span id="l36.5">       &lt;/body&gt;</span>
<a href="#l36.6"></a><span id="l36.6">      &lt;/method&gt;</span>
<a href="#l36.7"></a><span id="l36.7"> </span>
<a href="#l36.8"></a><span id="l36.8">      &lt;method name=&quot;_updateClosedState&quot;&gt;</span>
<a href="#l36.9"></a><span id="l36.9">       &lt;parameter name=&quot;aClosed&quot;/&gt;</span>
<a href="#l36.10"></a><span id="l36.10">       &lt;body&gt;</span>
<a href="#l36.11"></a><span id="l36.11">       &lt;![CDATA[</span>
<a href="#l36.12"></a><span id="l36.12" class="difflineminus">-        for each (let contact in this.contacts)</span>
<a href="#l36.13"></a><span id="l36.13" class="difflineplus">+        for (let contact of this.contacts)</span>
<a href="#l36.14"></a><span id="l36.14">           contact.collapsed = aClosed;</span>
<a href="#l36.15"></a><span id="l36.15">       ]]&gt;</span>
<a href="#l36.16"></a><span id="l36.16">       &lt;/body&gt;</span>
<a href="#l36.17"></a><span id="l36.17">      &lt;/method&gt;</span>
<a href="#l36.18"></a><span id="l36.18"> </span>
<a href="#l36.19"></a><span id="l36.19">      &lt;method name=&quot;close&quot;&gt;</span>
<a href="#l36.20"></a><span id="l36.20">       &lt;body&gt;</span>
<a href="#l36.21"></a><span id="l36.21">       &lt;![CDATA[</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l37.1"></a><span id="l37.1" class="difflineminus">--- a/mail/components/im/content/joinchat.js</span>
<a href="#l37.2"></a><span id="l37.2" class="difflineplus">+++ b/mail/components/im/content/joinchat.js</span>
<a href="#l37.3"></a><span id="l37.3" class="difflineat">@@ -86,17 +86,17 @@ var joinChat = {</span>
<a href="#l37.4"></a><span id="l37.4">       joinChat._fields.push({field: field, textbox: textbox});</span>
<a href="#l37.5"></a><span id="l37.5">     }</span>
<a href="#l37.6"></a><span id="l37.6"> </span>
<a href="#l37.7"></a><span id="l37.7">     window.sizeToContent();</span>
<a href="#l37.8"></a><span id="l37.8">   },</span>
<a href="#l37.9"></a><span id="l37.9"> </span>
<a href="#l37.10"></a><span id="l37.10">   join: function jc_join() {</span>
<a href="#l37.11"></a><span id="l37.11">     let values = joinChat._values;</span>
<a href="#l37.12"></a><span id="l37.12" class="difflineminus">-    for each (let field in joinChat._fields) {</span>
<a href="#l37.13"></a><span id="l37.13" class="difflineplus">+    for (let field of joinChat._fields) {</span>
<a href="#l37.14"></a><span id="l37.14">       let val = field.textbox.value.trim();</span>
<a href="#l37.15"></a><span id="l37.15">       if (!val &amp;&amp; field.field.required) {</span>
<a href="#l37.16"></a><span id="l37.16">         field.textbox.focus();</span>
<a href="#l37.17"></a><span id="l37.17">         //FIXME: why isn't the return false enough?</span>
<a href="#l37.18"></a><span id="l37.18">         throw &quot;Some required fields are empty!&quot;;</span>
<a href="#l37.19"></a><span id="l37.19">         return false;</span>
<a href="#l37.20"></a><span id="l37.20">       }</span>
<a href="#l37.21"></a><span id="l37.21">       if (val)</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l38.1"></a><span id="l38.1" class="difflineminus">--- a/mail/components/im/modules/chatHandler.jsm</span>
<a href="#l38.2"></a><span id="l38.2" class="difflineplus">+++ b/mail/components/im/modules/chatHandler.jsm</span>
<a href="#l38.3"></a><span id="l38.3" class="difflineat">@@ -46,17 +46,18 @@ var ChatCore = {</span>
<a href="#l38.4"></a><span id="l38.4">         let mgr = MailServices.accounts;</span>
<a href="#l38.5"></a><span id="l38.5">         for (let account in fixIterator(mgr.accounts, Components.interfaces.nsIMsgAccount)) {</span>
<a href="#l38.6"></a><span id="l38.6">           let incomingServer = account.incomingServer;</span>
<a href="#l38.7"></a><span id="l38.7">           if (!incomingServer || incomingServer.type != &quot;im&quot;)</span>
<a href="#l38.8"></a><span id="l38.8">             continue;</span>
<a href="#l38.9"></a><span id="l38.9">           delete accountsById[incomingServer.wrappedJSObject.imAccount.numericId];</span>
<a href="#l38.10"></a><span id="l38.10">         }</span>
<a href="#l38.11"></a><span id="l38.11">         // Let's recreate each of them...</span>
<a href="#l38.12"></a><span id="l38.12" class="difflineminus">-        for each (let account in accountsById) {</span>
<a href="#l38.13"></a><span id="l38.13" class="difflineplus">+        for (let id in accountsById) {</span>
<a href="#l38.14"></a><span id="l38.14" class="difflineplus">+          let account = accountsById[id];</span>
<a href="#l38.15"></a><span id="l38.15">           let inServer = mgr.createIncomingServer(account.name,</span>
<a href="#l38.16"></a><span id="l38.16">                                                   account.protocol.id, // hostname</span>
<a href="#l38.17"></a><span id="l38.17">                                                   &quot;im&quot;);</span>
<a href="#l38.18"></a><span id="l38.18">           inServer.wrappedJSObject.imAccount = account;</span>
<a href="#l38.19"></a><span id="l38.19">           let acc = mgr.createAccount();</span>
<a href="#l38.20"></a><span id="l38.20">           // Avoid new folder notifications.</span>
<a href="#l38.21"></a><span id="l38.21">           inServer.valid = false;</span>
<a href="#l38.22"></a><span id="l38.22">           acc.incomingServer = inServer;</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l39.1"></a><span id="l39.1" class="difflineminus">--- a/mail/components/im/modules/search_im.js</span>
<a href="#l39.2"></a><span id="l39.2" class="difflineplus">+++ b/mail/components/im/modules/search_im.js</span>
<a href="#l39.3"></a><span id="l39.3" class="difflineat">@@ -134,28 +134,28 @@ var COLUMN_MULTIPLE_MATCH_SCORES = [1, 0</span>
<a href="#l39.4"></a><span id="l39.4"> var COLUMN_MULTIPLE_MATCH_LIMIT = [10, 0, 0, 0, 0];</span>
<a href="#l39.5"></a><span id="l39.5"> </span>
<a href="#l39.6"></a><span id="l39.6"> /**</span>
<a href="#l39.7"></a><span id="l39.7">  * Score the message on its offsets (from stashedColumns).</span>
<a href="#l39.8"></a><span id="l39.8">  */</span>
<a href="#l39.9"></a><span id="l39.9"> function scoreOffsets(aMessage, aContext) {</span>
<a href="#l39.10"></a><span id="l39.10">   let score = 0;</span>
<a href="#l39.11"></a><span id="l39.11"> </span>
<a href="#l39.12"></a><span id="l39.12" class="difflineminus">-  let termTemplate = [0 for each (term in Iterator(aContext.terms, true))];</span>
<a href="#l39.13"></a><span id="l39.13" class="difflineplus">+  let termTemplate = aContext.terms.map(_ =&gt; 0);</span>
<a href="#l39.14"></a><span id="l39.14">   // for each column, a list of the incidence of each term</span>
<a href="#l39.15"></a><span id="l39.15">   let columnTermIncidence = [termTemplate.concat(),</span>
<a href="#l39.16"></a><span id="l39.16">                              termTemplate.concat(),</span>
<a href="#l39.17"></a><span id="l39.17">                              termTemplate.concat(),</span>
<a href="#l39.18"></a><span id="l39.18">                              termTemplate.concat(),</span>
<a href="#l39.19"></a><span id="l39.19">                              termTemplate.concat()];</span>
<a href="#l39.20"></a><span id="l39.20"> </span>
<a href="#l39.21"></a><span id="l39.21">   // we need a friendlyParseInt because otherwise the radix stuff happens</span>
<a href="#l39.22"></a><span id="l39.22">   //  because of the extra arguments map parses.  curse you, map!</span>
<a href="#l39.23"></a><span id="l39.23">   let offsetNums =</span>
<a href="#l39.24"></a><span id="l39.24" class="difflineminus">-    [parseInt(x) for each (x in aContext.stashedColumns[aMessage.id][0].split(&quot; &quot;))];</span>
<a href="#l39.25"></a><span id="l39.25" class="difflineplus">+    aContext.stashedColumns[aMessage.id][0].split(&quot; &quot;).map(x =&gt; parseInt(x));</span>
<a href="#l39.26"></a><span id="l39.26">   for (let i=0; i &lt; offsetNums.length; i += 4) {</span>
<a href="#l39.27"></a><span id="l39.27">     let columnIndex = offsetNums[i];</span>
<a href="#l39.28"></a><span id="l39.28">     let termIndex = offsetNums[i+1];</span>
<a href="#l39.29"></a><span id="l39.29">     columnTermIncidence[columnIndex][termIndex]++;</span>
<a href="#l39.30"></a><span id="l39.30">   }</span>
<a href="#l39.31"></a><span id="l39.31"> </span>
<a href="#l39.32"></a><span id="l39.32">   for (let iColumn = 0; iColumn &lt; COLUMN_ALL_MATCH_SCORES.length; iColumn++) {</span>
<a href="#l39.33"></a><span id="l39.33">     let termIncidence = columnTermIncidence[iColumn];</span>
<a href="#l39.34"></a><span id="l39.34" class="difflineat">@@ -259,17 +259,17 @@ GlodaIMSearcher.prototype = {</span>
<a href="#l39.35"></a><span id="l39.35">       limitClauseAlreadyIncluded: true,</span>
<a href="#l39.36"></a><span id="l39.36">       // osets is 0-based column number 4 (volatile to column changes)</span>
<a href="#l39.37"></a><span id="l39.37">       // save the offset column for extra analysis</span>
<a href="#l39.38"></a><span id="l39.38">       stashColumns: [6]</span>
<a href="#l39.39"></a><span id="l39.39">     });</span>
<a href="#l39.40"></a><span id="l39.40"> </span>
<a href="#l39.41"></a><span id="l39.41">     let fulltextQueryString = &quot;&quot;;</span>
<a href="#l39.42"></a><span id="l39.42"> </span>
<a href="#l39.43"></a><span id="l39.43" class="difflineminus">-    for each (let [iTerm, term] in Iterator(this.fulltextTerms)) {</span>
<a href="#l39.44"></a><span id="l39.44" class="difflineplus">+    for (let [iTerm, term] of this.fulltextTerms.entries()) {</span>
<a href="#l39.45"></a><span id="l39.45">       if (iTerm)</span>
<a href="#l39.46"></a><span id="l39.46">         fulltextQueryString += this.andTerms ? &quot; &quot; : &quot; OR &quot;;</span>
<a href="#l39.47"></a><span id="l39.47"> </span>
<a href="#l39.48"></a><span id="l39.48">       // Put our term in quotes.  This is needed for the tokenizer to be able</span>
<a href="#l39.49"></a><span id="l39.49">       //  to do useful things.  The exception is people clever enough to use</span>
<a href="#l39.50"></a><span id="l39.50">       //  NEAR.</span>
<a href="#l39.51"></a><span id="l39.51">       if (/^NEAR(\/\d+)?$/.test(term))</span>
<a href="#l39.52"></a><span id="l39.52">         fulltextQueryString += term;</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l40.1"></a><span id="l40.1" class="difflineminus">--- a/mail/components/preferences/applications.js</span>
<a href="#l40.2"></a><span id="l40.2" class="difflineplus">+++ b/mail/components/preferences/applications.js</span>
<a href="#l40.3"></a><span id="l40.3" class="difflineat">@@ -1109,17 +1109,17 @@ var gApplicationsPane = {</span>
<a href="#l40.4"></a><span id="l40.4">     while (this._list.childNodes.length &gt; 1)</span>
<a href="#l40.5"></a><span id="l40.5">       this._list.lastChild.remove();</span>
<a href="#l40.6"></a><span id="l40.6">     var visibleTypes = this._visibleTypes;</span>
<a href="#l40.7"></a><span id="l40.7"> </span>
<a href="#l40.8"></a><span id="l40.8">     // If the user is filtering the list, then only show matching types.</span>
<a href="#l40.9"></a><span id="l40.9">     if (this._filter.value)</span>
<a href="#l40.10"></a><span id="l40.10">       visibleTypes = visibleTypes.filter(this._matchesFilter, this);</span>
<a href="#l40.11"></a><span id="l40.11"> </span>
<a href="#l40.12"></a><span id="l40.12" class="difflineminus">-    for each (let visibleType in visibleTypes) {</span>
<a href="#l40.13"></a><span id="l40.13" class="difflineplus">+    for (let visibleType of visibleTypes) {</span>
<a href="#l40.14"></a><span id="l40.14">       let item = document.createElement(&quot;richlistitem&quot;);</span>
<a href="#l40.15"></a><span id="l40.15">       item.setAttribute(&quot;type&quot;, visibleType.type);</span>
<a href="#l40.16"></a><span id="l40.16">       item.setAttribute(&quot;typeDescription&quot;, this._describeType(visibleType));</span>
<a href="#l40.17"></a><span id="l40.17">       item.setAttribute(&quot;shortTypeDescription&quot;, visibleType.description);</span>
<a href="#l40.18"></a><span id="l40.18">       item.setAttribute(&quot;shortTypeDetails&quot;, this._typeDetails(visibleType));</span>
<a href="#l40.19"></a><span id="l40.19">       if (visibleType.smallIcon)</span>
<a href="#l40.20"></a><span id="l40.20">         item.setAttribute(&quot;typeIcon&quot;, visibleType.smallIcon);</span>
<a href="#l40.21"></a><span id="l40.21">       item.setAttribute(&quot;actionDescription&quot;,</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l41.1"></a><span id="l41.1" class="difflineminus">--- a/mail/test/mozmill/attachment/test-attachment-menus.js</span>
<a href="#l41.2"></a><span id="l41.2" class="difflineplus">+++ b/mail/test/mozmill/attachment/test-attachment-menus.js</span>
<a href="#l41.3"></a><span id="l41.3" class="difflineat">@@ -373,14 +373,14 @@ function help_test_attachment_menus(inde</span>
<a href="#l41.4"></a><span id="l41.4">     check_toolbar_menu_states_multiple(messages[index].allMenuStates);</span>
<a href="#l41.5"></a><span id="l41.5"> </span>
<a href="#l41.6"></a><span id="l41.6">   check_menu_states_all(messages[index].allMenuStates);</span>
<a href="#l41.7"></a><span id="l41.7">   for (let i = 0; i &lt; expectedStates.length; i++)</span>
<a href="#l41.8"></a><span id="l41.8">     check_menu_states_single(i, expectedStates[i]);</span>
<a href="#l41.9"></a><span id="l41.9"> }</span>
<a href="#l41.10"></a><span id="l41.10"> </span>
<a href="#l41.11"></a><span id="l41.11"> // Generate a test for each message in |messages|.</span>
<a href="#l41.12"></a><span id="l41.12" class="difflineminus">-for each (let [i, message] in Iterator(messages)) {</span>
<a href="#l41.13"></a><span id="l41.13" class="difflineplus">+for (let [i, message] of messages.entries()) {</span>
<a href="#l41.14"></a><span id="l41.14">   let index = i; // make a copy to avoid passing a reference to i</span>
<a href="#l41.15"></a><span id="l41.15">   this[&quot;test_&quot; + message.name] = function() {</span>
<a href="#l41.16"></a><span id="l41.16">     help_test_attachment_menus(index);</span>
<a href="#l41.17"></a><span id="l41.17">   };</span>
<a href="#l41.18"></a><span id="l41.18"> }</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l42.1"></a><span id="l42.1" class="difflineminus">--- a/mail/test/mozmill/attachment/test-attachment-size.js</span>
<a href="#l42.2"></a><span id="l42.2" class="difflineplus">+++ b/mail/test/mozmill/attachment/test-attachment-size.js</span>
<a href="#l42.3"></a><span id="l42.3" class="difflineat">@@ -338,14 +338,14 @@ function help_test_attachment_size(index</span>
<a href="#l42.4"></a><span id="l42.4">   }</span>
<a href="#l42.5"></a><span id="l42.5"> </span>
<a href="#l42.6"></a><span id="l42.6">   let totalSize = messages[index].attachmentTotalSize;</span>
<a href="#l42.7"></a><span id="l42.7">   check_total_attachment_size(expectedSizes.length, totalSize.size,</span>
<a href="#l42.8"></a><span id="l42.8">                               totalSize.exact);</span>
<a href="#l42.9"></a><span id="l42.9"> }</span>
<a href="#l42.10"></a><span id="l42.10"> </span>
<a href="#l42.11"></a><span id="l42.11"> // Generate a test for each message in |messages|.</span>
<a href="#l42.12"></a><span id="l42.12" class="difflineminus">-for each (let [i, message] in Iterator(messages)) {</span>
<a href="#l42.13"></a><span id="l42.13" class="difflineplus">+for (let [i, message] of messages.entries()) {</span>
<a href="#l42.14"></a><span id="l42.14">   let index = i; // make a copy to avoid passing a reference to i</span>
<a href="#l42.15"></a><span id="l42.15">   this[&quot;test_&quot; + message.name] = function() {</span>
<a href="#l42.16"></a><span id="l42.16">     help_test_attachment_size(index);</span>
<a href="#l42.17"></a><span id="l42.17">   };</span>
<a href="#l42.18"></a><span id="l42.18"> }</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l43.1"></a><span id="l43.1" class="difflineminus">--- a/mail/test/mozmill/cloudfile/test-cloudfile-backend-hightail.js</span>
<a href="#l43.2"></a><span id="l43.2" class="difflineplus">+++ b/mail/test/mozmill/cloudfile/test-cloudfile-backend-hightail.js</span>
<a href="#l43.3"></a><span id="l43.3" class="difflineat">@@ -72,17 +72,17 @@ function teardownTest() {</span>
<a href="#l43.4"></a><span id="l43.4"> function test_simple_case() {</span>
<a href="#l43.5"></a><span id="l43.5">   const kExpectedUrl = &quot;http://www.example.com/expectedUrl&quot;;</span>
<a href="#l43.6"></a><span id="l43.6">   const kTopics = [kUploadFile, kGetFileURL];</span>
<a href="#l43.7"></a><span id="l43.7"> </span>
<a href="#l43.8"></a><span id="l43.8">   gServer.planForUploadFile(&quot;testFile1&quot;);</span>
<a href="#l43.9"></a><span id="l43.9">   gServer.planForGetFileURL(&quot;testFile1&quot;, {url: kExpectedUrl});</span>
<a href="#l43.10"></a><span id="l43.10"> </span>
<a href="#l43.11"></a><span id="l43.11">   let obs = new ObservationRecorder();</span>
<a href="#l43.12"></a><span id="l43.12" class="difflineminus">-  for each (let [, topic] in Iterator(kTopics)) {</span>
<a href="#l43.13"></a><span id="l43.13" class="difflineplus">+  for (let topic of kTopics) {</span>
<a href="#l43.14"></a><span id="l43.14">     obs.planFor(topic);</span>
<a href="#l43.15"></a><span id="l43.15">     Services.obs.addObserver(obs, topic, false);</span>
<a href="#l43.16"></a><span id="l43.16">   }</span>
<a href="#l43.17"></a><span id="l43.17"> </span>
<a href="#l43.18"></a><span id="l43.18">   let requestObserver = gObsManager.create(&quot;test_simple_case - Upload 1&quot;);</span>
<a href="#l43.19"></a><span id="l43.19">   let file = getFile(&quot;./data/testFile1&quot;, __file__);</span>
<a href="#l43.20"></a><span id="l43.20">   let provider = gServer.getPreparedBackend(&quot;someAccountKey&quot;);</span>
<a href="#l43.21"></a><span id="l43.21">   provider.uploadFile(file, requestObserver);</span>
<a href="#l43.22"></a><span id="l43.22" class="difflineat">@@ -100,34 +100,34 @@ function test_simple_case() {</span>
<a href="#l43.23"></a><span id="l43.23">   provider.uploadFile(file, requestObserver);</span>
<a href="#l43.24"></a><span id="l43.24">   mc.waitFor(() =&gt; requestObserver.success);</span>
<a href="#l43.25"></a><span id="l43.25">   urlForFile = provider.urlForFile(file);</span>
<a href="#l43.26"></a><span id="l43.26">   assert_equals(kExpectedUrl, urlForFile);</span>
<a href="#l43.27"></a><span id="l43.27"> </span>
<a href="#l43.28"></a><span id="l43.28">   assert_equals(2, obs.numSightings(kUploadFile));</span>
<a href="#l43.29"></a><span id="l43.29">   assert_equals(2, obs.numSightings(kGetFileURL));</span>
<a href="#l43.30"></a><span id="l43.30"> </span>
<a href="#l43.31"></a><span id="l43.31" class="difflineminus">-  for each (let [, topic] in Iterator(kTopics)) {</span>
<a href="#l43.32"></a><span id="l43.32" class="difflineplus">+  for (let topic of kTopics) {</span>
<a href="#l43.33"></a><span id="l43.33">     Services.obs.removeObserver(obs, topic);</span>
<a href="#l43.34"></a><span id="l43.34">   }</span>
<a href="#l43.35"></a><span id="l43.35"> }</span>
<a href="#l43.36"></a><span id="l43.36"> </span>
<a href="#l43.37"></a><span id="l43.37"> function test_chained_uploads() {</span>
<a href="#l43.38"></a><span id="l43.38">   const kExpectedUrlRoot = &quot;http://www.example.com/&quot;;</span>
<a href="#l43.39"></a><span id="l43.39">   const kTopics = [kUploadFile, kGetFileURL];</span>
<a href="#l43.40"></a><span id="l43.40">   const kFilenames = [&quot;testFile1&quot;, &quot;testFile2&quot;, &quot;testFile3&quot;];</span>
<a href="#l43.41"></a><span id="l43.41"> </span>
<a href="#l43.42"></a><span id="l43.42" class="difflineminus">-  for each (let [, filename] in Iterator(kFilenames)) {</span>
<a href="#l43.43"></a><span id="l43.43" class="difflineplus">+  for (let filename of kFilenames) {</span>
<a href="#l43.44"></a><span id="l43.44">     let expectedUrl = kExpectedUrlRoot + filename;</span>
<a href="#l43.45"></a><span id="l43.45">     gServer.planForUploadFile(filename);</span>
<a href="#l43.46"></a><span id="l43.46">     gServer.planForGetFileURL(filename, {url: expectedUrl});</span>
<a href="#l43.47"></a><span id="l43.47">   }</span>
<a href="#l43.48"></a><span id="l43.48"> </span>
<a href="#l43.49"></a><span id="l43.49">   let obs = new ObservationRecorder();</span>
<a href="#l43.50"></a><span id="l43.50" class="difflineminus">-  for each (let [, topic] in Iterator(kTopics)) {</span>
<a href="#l43.51"></a><span id="l43.51" class="difflineplus">+  for (let topic of kTopics) {</span>
<a href="#l43.52"></a><span id="l43.52">     obs.planFor(topic);</span>
<a href="#l43.53"></a><span id="l43.53">     Services.obs.addObserver(obs, topic, false);</span>
<a href="#l43.54"></a><span id="l43.54">   }</span>
<a href="#l43.55"></a><span id="l43.55"> </span>
<a href="#l43.56"></a><span id="l43.56">   let provider = gServer.getPreparedBackend(&quot;someAccountKey&quot;);</span>
<a href="#l43.57"></a><span id="l43.57"> </span>
<a href="#l43.58"></a><span id="l43.58">   let files = [];</span>
<a href="#l43.59"></a><span id="l43.59"> </span>
<a href="#l43.60"></a><span id="l43.60" class="difflineat">@@ -150,17 +150,17 @@ function test_chained_uploads() {</span>
<a href="#l43.61"></a><span id="l43.61">     let file = getFile(&quot;./data/&quot; + filename, __file__);</span>
<a href="#l43.62"></a><span id="l43.62">     let expectedUriForFile = kExpectedUrlRoot + filename;</span>
<a href="#l43.63"></a><span id="l43.63">     let uriForFile = provider.urlForFile(files[index]);</span>
<a href="#l43.64"></a><span id="l43.64">     assert_equals(expectedUriForFile, uriForFile);</span>
<a href="#l43.65"></a><span id="l43.65">   }</span>
<a href="#l43.66"></a><span id="l43.66"> </span>
<a href="#l43.67"></a><span id="l43.67">   assert_equals(kFilenames.length, obs.numSightings(kGetFileURL));</span>
<a href="#l43.68"></a><span id="l43.68"> </span>
<a href="#l43.69"></a><span id="l43.69" class="difflineminus">-  for each (let [, topic] in Iterator(kTopics)) {</span>
<a href="#l43.70"></a><span id="l43.70" class="difflineplus">+  for (let topic of kTopics) {</span>
<a href="#l43.71"></a><span id="l43.71">     Services.obs.removeObserver(obs, topic);</span>
<a href="#l43.72"></a><span id="l43.72">   }</span>
<a href="#l43.73"></a><span id="l43.73"> }</span>
<a href="#l43.74"></a><span id="l43.74"> </span>
<a href="#l43.75"></a><span id="l43.75"> function test_deleting_uploads() {</span>
<a href="#l43.76"></a><span id="l43.76">   const kFilename = &quot;testFile1&quot;;</span>
<a href="#l43.77"></a><span id="l43.77">   let provider = gServer.getPreparedBackend(&quot;someAccountKey&quot;);</span>
<a href="#l43.78"></a><span id="l43.78">   // Upload a file</span>
<a href="#l43.79"></a><span id="l43.79" class="difflineat">@@ -202,17 +202,17 @@ function test_can_cancel_upload() {</span>
<a href="#l43.80"></a><span id="l43.80"> /**</span>
<a href="#l43.81"></a><span id="l43.81">  * Test that cancelling several uploads causes onStopRequest to be</span>
<a href="#l43.82"></a><span id="l43.82">  * called with nsIMsgCloudFileProvider.uploadCanceled.</span>
<a href="#l43.83"></a><span id="l43.83">  */</span>
<a href="#l43.84"></a><span id="l43.84"> function test_can_cancel_uploads() {</span>
<a href="#l43.85"></a><span id="l43.85">   const kFiles = [&quot;testFile2&quot;, &quot;testFile3&quot;, &quot;testFile4&quot;];</span>
<a href="#l43.86"></a><span id="l43.86">   let provider = gServer.getPreparedBackend(&quot;anAccount&quot;);</span>
<a href="#l43.87"></a><span id="l43.87">   let files = [];</span>
<a href="#l43.88"></a><span id="l43.88" class="difflineminus">-  for each (let [, filename] in Iterator(kFiles)) {</span>
<a href="#l43.89"></a><span id="l43.89" class="difflineplus">+  for (let filename of kFiles) {</span>
<a href="#l43.90"></a><span id="l43.90">     gServer.planForUploadFile(filename, 2000);</span>
<a href="#l43.91"></a><span id="l43.91">     files.push(getFile(&quot;./data/&quot; + filename, __file__));</span>
<a href="#l43.92"></a><span id="l43.92">   }</span>
<a href="#l43.93"></a><span id="l43.93">   assert_can_cancel_uploads(mc, provider, files);</span>
<a href="#l43.94"></a><span id="l43.94"> }</span>
<a href="#l43.95"></a><span id="l43.95"> </span>
<a href="#l43.96"></a><span id="l43.96"> /**</span>
<a href="#l43.97"></a><span id="l43.97">  * Test that when we call createExistingAccount, onStopRequest is successfully</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l44.1"></a><span id="l44.1" class="difflineminus">--- a/mail/test/mozmill/cloudfile/test-cloudfile-notifications.js</span>
<a href="#l44.2"></a><span id="l44.2" class="difflineplus">+++ b/mail/test/mozmill/cloudfile/test-cloudfile-notifications.js</span>
<a href="#l44.3"></a><span id="l44.3" class="difflineat">@@ -287,18 +287,18 @@ function test_no_offer_on_conversion() {</span>
<a href="#l44.4"></a><span id="l44.4"> function test_offer_then_upload_notifications() {</span>
<a href="#l44.5"></a><span id="l44.5">   const kFiles = ['./data/testFile1', './data/testFile2'];</span>
<a href="#l44.6"></a><span id="l44.6">   // Set the notification threshold to 0 to ensure that we get it.</span>
<a href="#l44.7"></a><span id="l44.7">   Services.prefs.setIntPref(kOfferThreshold, 0);</span>
<a href="#l44.8"></a><span id="l44.8"> </span>
<a href="#l44.9"></a><span id="l44.9">   // We're going to add attachments to the attachmentbucket, and we'll</span>
<a href="#l44.10"></a><span id="l44.10">   // use the add_attachments helper function to do it.  First, retrieve</span>
<a href="#l44.11"></a><span id="l44.11">   // some file URIs...</span>
<a href="#l44.12"></a><span id="l44.12" class="difflineminus">-  let fileURIs = [Services.io.newFileURI(file).spec</span>
<a href="#l44.13"></a><span id="l44.13" class="difflineminus">-                  for each (file in collectFiles(kFiles, __file__))];</span>
<a href="#l44.14"></a><span id="l44.14" class="difflineplus">+  let fileURIs = collectFiles(kFiles, __file__).</span>
<a href="#l44.15"></a><span id="l44.15" class="difflineplus">+    map(file =&gt; Services.io.newFileURI(file).spec);</span>
<a href="#l44.16"></a><span id="l44.16"> </span>
<a href="#l44.17"></a><span id="l44.17">   // Create our mock provider</span>
<a href="#l44.18"></a><span id="l44.18">   let provider = new MockCloudfileAccount();</span>
<a href="#l44.19"></a><span id="l44.19">   provider.init(&quot;someKey&quot;);</span>
<a href="#l44.20"></a><span id="l44.20"> </span>
<a href="#l44.21"></a><span id="l44.21">   // Override uploadFile to succeed instantaneously so that we don't have</span>
<a href="#l44.22"></a><span id="l44.22">   // to worry about waiting for the onStopRequest method being called</span>
<a href="#l44.23"></a><span id="l44.23">   // asynchronously.</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l45.1"></a><span id="l45.1" class="difflineminus">--- a/mail/test/mozmill/folder-display/test-folder-pane-visibility.js</span>
<a href="#l45.2"></a><span id="l45.2" class="difflineplus">+++ b/mail/test/mozmill/folder-display/test-folder-pane-visibility.js</span>
<a href="#l45.3"></a><span id="l45.3" class="difflineat">@@ -226,17 +226,17 @@ function test_folder_pane_persistence_ge</span>
<a href="#l45.4"></a><span id="l45.4"> </span>
<a href="#l45.5"></a><span id="l45.5">   let configs = [</span>
<a href="#l45.6"></a><span id="l45.6">     // 1st time: [+ - - + +]</span>
<a href="#l45.7"></a><span id="l45.7">     [1, 0, 0, 1, 1],</span>
<a href="#l45.8"></a><span id="l45.8">     // 2nd time: [- + + - -]</span>
<a href="#l45.9"></a><span id="l45.9">     [0, 1, 1, 0, 0]</span>
<a href="#l45.10"></a><span id="l45.10">   ];</span>
<a href="#l45.11"></a><span id="l45.11"> </span>
<a href="#l45.12"></a><span id="l45.12" class="difflineminus">-  for each (let [, config] in Iterator(configs)) {</span>
<a href="#l45.13"></a><span id="l45.13" class="difflineplus">+  for (let config of configs) {</span>
<a href="#l45.14"></a><span id="l45.14">     openTabs(config);</span>
<a href="#l45.15"></a><span id="l45.15">     verifyTabs(config); // make sure openTabs did its job right</span>
<a href="#l45.16"></a><span id="l45.16">     let state = mc.tabmail.persistTabs();</span>
<a href="#l45.17"></a><span id="l45.17">     closeTabs();</span>
<a href="#l45.18"></a><span id="l45.18">     // toggle the state for the current tab so we can be sure that it knows how</span>
<a href="#l45.19"></a><span id="l45.19">     // to change things.</span>
<a href="#l45.20"></a><span id="l45.20">     toggle_folder_pane();</span>
<a href="#l45.21"></a><span id="l45.21">     mc.tabmail.restoreTabs(state);</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l46.1"></a><span id="l46.1" class="difflineminus">--- a/mail/test/mozmill/folder-display/test-message-pane-visibility.js</span>
<a href="#l46.2"></a><span id="l46.2" class="difflineplus">+++ b/mail/test/mozmill/folder-display/test-message-pane-visibility.js</span>
<a href="#l46.3"></a><span id="l46.3" class="difflineat">@@ -197,17 +197,17 @@ function test_message_pane_persistence_g</span>
<a href="#l46.4"></a><span id="l46.4">   }</span>
<a href="#l46.5"></a><span id="l46.5"> </span>
<a href="#l46.6"></a><span id="l46.6">   let configs = [</span>
<a href="#l46.7"></a><span id="l46.7">     // 1st time: [+ - - + +]</span>
<a href="#l46.8"></a><span id="l46.8">     [1, 0, 0, 1, 1],</span>
<a href="#l46.9"></a><span id="l46.9">     // 2nd time: [- + + - -]</span>
<a href="#l46.10"></a><span id="l46.10">     [0, 1, 1, 0, 0]</span>
<a href="#l46.11"></a><span id="l46.11">   ];</span>
<a href="#l46.12"></a><span id="l46.12" class="difflineminus">-  for each (let [, config] in Iterator(configs)) {</span>
<a href="#l46.13"></a><span id="l46.13" class="difflineplus">+  for (let config of configs) {</span>
<a href="#l46.14"></a><span id="l46.14">     openTabs(config);</span>
<a href="#l46.15"></a><span id="l46.15">     verifyTabs(config); // make sure openTabs did its job right</span>
<a href="#l46.16"></a><span id="l46.16"> </span>
<a href="#l46.17"></a><span id="l46.17">     // Switch to the first tab, so that we don't cause a double message load</span>
<a href="#l46.18"></a><span id="l46.18">     // while restoring tabs (one by the first tab, one by the currently selected</span>
<a href="#l46.19"></a><span id="l46.19">     // one). This is fine because we only restore tabs at startup, and we know</span>
<a href="#l46.20"></a><span id="l46.20">     // that we don't select a message at startup.</span>
<a href="#l46.21"></a><span id="l46.21">     // XXX This should probably be fixed properly, though.</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l47.1"></a><span id="l47.1" class="difflineminus">--- a/mail/test/mozmill/folder-display/test-right-click-middle-click-folders.js</span>
<a href="#l47.2"></a><span id="l47.2" class="difflineplus">+++ b/mail/test/mozmill/folder-display/test-right-click-middle-click-folders.js</span>
<a href="#l47.3"></a><span id="l47.3" class="difflineat">@@ -229,17 +229,17 @@ function _middle_click_on_existing_multi</span>
<a href="#l47.4"></a><span id="l47.4"> </span>
<a href="#l47.5"></a><span id="l47.5"> /**</span>
<a href="#l47.6"></a><span id="l47.6">  * Generate background and foreground tests for each middle click test.</span>
<a href="#l47.7"></a><span id="l47.7">  *</span>
<a href="#l47.8"></a><span id="l47.8">  * @param aTests an array of test names</span>
<a href="#l47.9"></a><span id="l47.9">  */</span>
<a href="#l47.10"></a><span id="l47.10"> function _generate_background_foreground_tests(aTests) {</span>
<a href="#l47.11"></a><span id="l47.11">   let self = this;</span>
<a href="#l47.12"></a><span id="l47.12" class="difflineminus">-  for each (let [, test] in Iterator(aTests)) {</span>
<a href="#l47.13"></a><span id="l47.13" class="difflineplus">+  for (let test of aTests) {</span>
<a href="#l47.14"></a><span id="l47.14">     let helperFunc = this[&quot;_&quot; + test + &quot;_helper&quot;];</span>
<a href="#l47.15"></a><span id="l47.15">     this[&quot;test_&quot; + test + &quot;_background&quot;] = function() {</span>
<a href="#l47.16"></a><span id="l47.16">       set_context_menu_background_tabs(true);</span>
<a href="#l47.17"></a><span id="l47.17">       helperFunc.apply(self, [true]);</span>
<a href="#l47.18"></a><span id="l47.18">       reset_context_menu_background_tabs();</span>
<a href="#l47.19"></a><span id="l47.19">     };</span>
<a href="#l47.20"></a><span id="l47.20">     this[&quot;test_&quot; + test + &quot;_foreground&quot;] = function() {</span>
<a href="#l47.21"></a><span id="l47.21">       set_context_menu_background_tabs(false);</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l48.1"></a><span id="l48.1" class="difflineminus">--- a/mail/test/mozmill/folder-display/test-right-click-middle-click-messages.js</span>
<a href="#l48.2"></a><span id="l48.2" class="difflineplus">+++ b/mail/test/mozmill/folder-display/test-right-click-middle-click-messages.js</span>
<a href="#l48.3"></a><span id="l48.3" class="difflineat">@@ -394,17 +394,17 @@ function _middle_click_on_expanded_threa</span>
<a href="#l48.4"></a><span id="l48.4"> </span>
<a href="#l48.5"></a><span id="l48.5"> /**</span>
<a href="#l48.6"></a><span id="l48.6">  * Generate background and foreground tests for each middle click test.</span>
<a href="#l48.7"></a><span id="l48.7">  *</span>
<a href="#l48.8"></a><span id="l48.8">  * @param aTests an array of test names</span>
<a href="#l48.9"></a><span id="l48.9">  */</span>
<a href="#l48.10"></a><span id="l48.10"> function _generate_background_foreground_tests(aTests) {</span>
<a href="#l48.11"></a><span id="l48.11">   let self = this;</span>
<a href="#l48.12"></a><span id="l48.12" class="difflineminus">-  for each (let [, test] in Iterator(aTests)) {</span>
<a href="#l48.13"></a><span id="l48.13" class="difflineplus">+  for (let test of aTests) {</span>
<a href="#l48.14"></a><span id="l48.14">     let helperFunc = this[&quot;_&quot; + test + &quot;_helper&quot;];</span>
<a href="#l48.15"></a><span id="l48.15">     this[&quot;test_&quot; + test + &quot;_background&quot;] = function() {</span>
<a href="#l48.16"></a><span id="l48.16">       set_context_menu_background_tabs(true);</span>
<a href="#l48.17"></a><span id="l48.17">       helperFunc.apply(self, [true]);</span>
<a href="#l48.18"></a><span id="l48.18">       reset_context_menu_background_tabs();</span>
<a href="#l48.19"></a><span id="l48.19">     };</span>
<a href="#l48.20"></a><span id="l48.20">     this[&quot;test_&quot; + test + &quot;_foreground&quot;] = function() {</span>
<a href="#l48.21"></a><span id="l48.21">       set_context_menu_background_tabs(false);</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l49.1"></a><span id="l49.1" class="difflineminus">--- a/mail/test/mozmill/folder-tree-modes/test-custom-smart-folder.js</span>
<a href="#l49.2"></a><span id="l49.2" class="difflineplus">+++ b/mail/test/mozmill/folder-tree-modes/test-custom-smart-folder.js</span>
<a href="#l49.3"></a><span id="l49.3" class="difflineat">@@ -96,17 +96,17 @@ function test_custom_folder_exists() {</span>
<a href="#l49.4"></a><span id="l49.4">   assert_folder_mode(&quot;smart&quot;);</span>
<a href="#l49.5"></a><span id="l49.5">   assert_folder_displayed(smartFolderA);</span>
<a href="#l49.6"></a><span id="l49.6">   // this is our custom smart folder parent created in folderPane.js</span>
<a href="#l49.7"></a><span id="l49.7">   mc.folderTreeView.selectFolder(subfolderA);</span>
<a href="#l49.8"></a><span id="l49.8">   assert_folder_selected_and_displayed(subfolderA);</span>
<a href="#l49.9"></a><span id="l49.9"> }</span>
<a href="#l49.10"></a><span id="l49.10"> </span>
<a href="#l49.11"></a><span id="l49.11"> function FTVItemHasChild(parentFTVItem, childFolder, recurse) {</span>
<a href="#l49.12"></a><span id="l49.12" class="difflineminus">-  for each(let child in parentFTVItem.children) {</span>
<a href="#l49.13"></a><span id="l49.13" class="difflineplus">+  for (let child of parentFTVItem.children) {</span>
<a href="#l49.14"></a><span id="l49.14">     if (child._folder.URI == childFolder.URI ||</span>
<a href="#l49.15"></a><span id="l49.15">         recurse &amp;&amp; FTVItemHasChild(child, childFolder, recurse))</span>
<a href="#l49.16"></a><span id="l49.16">       return true;</span>
<a href="#l49.17"></a><span id="l49.17">   }</span>
<a href="#l49.18"></a><span id="l49.18">   return false;</span>
<a href="#l49.19"></a><span id="l49.19"> }</span>
<a href="#l49.20"></a><span id="l49.20"> </span>
<a href="#l49.21"></a><span id="l49.21"> /**</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l50.1"></a><span id="l50.1" class="difflineminus">--- a/mail/test/mozmill/junk-commands/test-junk-commands.js</span>
<a href="#l50.2"></a><span id="l50.2" class="difflineplus">+++ b/mail/test/mozmill/junk-commands/test-junk-commands.js</span>
<a href="#l50.3"></a><span id="l50.3" class="difflineat">@@ -66,15 +66,15 @@ function test_delete_junk_messages() {</span>
<a href="#l50.4"></a><span id="l50.4">   mark_selected_messages_as_junk();</span>
<a href="#l50.5"></a><span id="l50.5">   // Now delete junk mail</span>
<a href="#l50.6"></a><span id="l50.6">   delete_mail_marked_as_junk(NUM_MESSAGES_TO_JUNK);</span>
<a href="#l50.7"></a><span id="l50.7">   // Check that we have the right number of messages left</span>
<a href="#l50.8"></a><span id="l50.8">   _assert_folder_total_messages(folder,</span>
<a href="#l50.9"></a><span id="l50.9">                                 initialNumMessages - NUM_MESSAGES_TO_JUNK);</span>
<a href="#l50.10"></a><span id="l50.10">   // Check that none of the message keys exist any more</span>
<a href="#l50.11"></a><span id="l50.11">   let db = folder.getDBFolderInfoAndDB({});</span>
<a href="#l50.12"></a><span id="l50.12" class="difflineminus">-  for each (let [, msgHdr] in Iterator(selectedMessages)) {</span>
<a href="#l50.13"></a><span id="l50.13" class="difflineplus">+  for (let msgHdr of selectedMessages) {</span>
<a href="#l50.14"></a><span id="l50.14">     let key = msgHdr.messageKey;</span>
<a href="#l50.15"></a><span id="l50.15">     if (db.ContainsKey(key))</span>
<a href="#l50.16"></a><span id="l50.16">       throw new Error(&quot;The database shouldn't contain key &quot; + key +</span>
<a href="#l50.17"></a><span id="l50.17">                       &quot;, but does.&quot;);</span>
<a href="#l50.18"></a><span id="l50.18">   }</span>
<a href="#l50.19"></a><span id="l50.19"> }</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l51.1"></a><span id="l51.1" class="difflineminus">--- a/mail/test/mozmill/notification/test-notification.js</span>
<a href="#l51.2"></a><span id="l51.2" class="difflineplus">+++ b/mail/test/mozmill/notification/test-notification.js</span>
<a href="#l51.3"></a><span id="l51.3" class="difflineat">@@ -170,17 +170,17 @@ function remember_and_set_bool_pref(aPre</span>
<a href="#l51.4"></a><span id="l51.4">  * each sent message is slightly newer than the last.  In this</span>
<a href="#l51.5"></a><span id="l51.5">  * case, each new message set will be sent one minute further</span>
<a href="#l51.6"></a><span id="l51.6">  * into the future than the last message set.</span>
<a href="#l51.7"></a><span id="l51.7">  */</span>
<a href="#l51.8"></a><span id="l51.8"> function make_gradually_newer_sets_in_folder(aFolder, aArgs)</span>
<a href="#l51.9"></a><span id="l51.9"> {</span>
<a href="#l51.10"></a><span id="l51.10">   gMsgMinutes -= 1;</span>
<a href="#l51.11"></a><span id="l51.11">   if (!aArgs.age) {</span>
<a href="#l51.12"></a><span id="l51.12" class="difflineminus">-    for each (let arg in aArgs)</span>
<a href="#l51.13"></a><span id="l51.13" class="difflineplus">+    for (let arg of aArgs)</span>
<a href="#l51.14"></a><span id="l51.14">       arg.age = {minutes: gMsgMinutes};</span>
<a href="#l51.15"></a><span id="l51.15">   }</span>
<a href="#l51.16"></a><span id="l51.16">   make_new_sets_in_folder(aFolder, aArgs);</span>
<a href="#l51.17"></a><span id="l51.17"> }</span>
<a href="#l51.18"></a><span id="l51.18"> </span>
<a href="#l51.19"></a><span id="l51.19"> /**</span>
<a href="#l51.20"></a><span id="l51.20">  * Test that we revert to newmailalert.xul if there is no system</span>
<a href="#l51.21"></a><span id="l51.21">  * notification service present.</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l52.1"></a><span id="l52.1" class="difflineminus">--- a/mail/test/mozmill/shared-modules/test-address-book-helpers.js</span>
<a href="#l52.2"></a><span id="l52.2" class="difflineplus">+++ b/mail/test/mozmill/shared-modules/test-address-book-helpers.js</span>
<a href="#l52.3"></a><span id="l52.3" class="difflineat">@@ -241,17 +241,17 @@ function get_mailing_list_from_address_b</span>
<a href="#l52.4"></a><span id="l52.4">  *                  where each contact has members &quot;email&quot;</span>
<a href="#l52.5"></a><span id="l52.5">  *                  and &quot;displayName&quot;</span>
<a href="#l52.6"></a><span id="l52.6">  *</span>
<a href="#l52.7"></a><span id="l52.7">  *                  Example:</span>
<a href="#l52.8"></a><span id="l52.8">  *                  [{email: 'test@example.com', displayName: 'Sammy Jenkis'}]</span>
<a href="#l52.9"></a><span id="l52.9">  */</span>
<a href="#l52.10"></a><span id="l52.10"> function load_contacts_into_address_book(aAddressBook, aContacts)</span>
<a href="#l52.11"></a><span id="l52.11"> {</span>
<a href="#l52.12"></a><span id="l52.12" class="difflineminus">-  for each (contact in aContacts) {</span>
<a href="#l52.13"></a><span id="l52.13" class="difflineplus">+  for (contact of aContacts) {</span>
<a href="#l52.14"></a><span id="l52.14"> </span>
<a href="#l52.15"></a><span id="l52.15">     if (!(contact instanceof Ci.nsIAbCard))</span>
<a href="#l52.16"></a><span id="l52.16">       contact = create_contact(contact.email,</span>
<a href="#l52.17"></a><span id="l52.17">                                contact.displayName, true);</span>
<a href="#l52.18"></a><span id="l52.18"> </span>
<a href="#l52.19"></a><span id="l52.19">     aAddressBook.addCard(contact);</span>
<a href="#l52.20"></a><span id="l52.20">   }</span>
<a href="#l52.21"></a><span id="l52.21"> }</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l53.1"></a><span id="l53.1" class="difflineminus">--- a/mail/test/mozmill/shared-modules/test-cloudfile-backend-helpers.js</span>
<a href="#l53.2"></a><span id="l53.2" class="difflineplus">+++ b/mail/test/mozmill/shared-modules/test-cloudfile-backend-helpers.js</span>
<a href="#l53.3"></a><span id="l53.3" class="difflineat">@@ -42,17 +42,17 @@ function SimpleRequestObserverManager() </span>
<a href="#l53.4"></a><span id="l53.4"> SimpleRequestObserverManager.prototype = {</span>
<a href="#l53.5"></a><span id="l53.5">   create: function(aName) {</span>
<a href="#l53.6"></a><span id="l53.6">     let obs = new SimpleRequestObserver(aName);</span>
<a href="#l53.7"></a><span id="l53.7">     this._observers.push(obs);</span>
<a href="#l53.8"></a><span id="l53.8">     return obs;</span>
<a href="#l53.9"></a><span id="l53.9">   },</span>
<a href="#l53.10"></a><span id="l53.10"> </span>
<a href="#l53.11"></a><span id="l53.11">   check: function() {</span>
<a href="#l53.12"></a><span id="l53.12" class="difflineminus">-    for each (let [, observer] in Iterator(this._observers)) {</span>
<a href="#l53.13"></a><span id="l53.13" class="difflineplus">+    for (let observer of this._observers) {</span>
<a href="#l53.14"></a><span id="l53.14">       if (!observer.success)</span>
<a href="#l53.15"></a><span id="l53.15">         throw new Error(&quot;An observer named &quot; + observer.name + &quot; was leftover, &quot;</span>
<a href="#l53.16"></a><span id="l53.16">                         + &quot;with its success attribute set to: &quot;</span>
<a href="#l53.17"></a><span id="l53.17">                         + observer.success);</span>
<a href="#l53.18"></a><span id="l53.18">     }</span>
<a href="#l53.19"></a><span id="l53.19">   },</span>
<a href="#l53.20"></a><span id="l53.20"> </span>
<a href="#l53.21"></a><span id="l53.21">   reset: function() {</span>
<a href="#l53.22"></a><span id="l53.22" class="difflineat">@@ -87,17 +87,17 @@ SimpleRequestObserver.prototype = {</span>
<a href="#l53.23"></a><span id="l53.23">  * @param aController the controller to use for waitFors.</span>
<a href="#l53.24"></a><span id="l53.24">  * @param aProvider the provider to upload and cancel the files with.</span>
<a href="#l53.25"></a><span id="l53.25">  * @param aFiles the array of files to upload.</span>
<a href="#l53.26"></a><span id="l53.26">  */</span>
<a href="#l53.27"></a><span id="l53.27"> function assert_can_cancel_uploads(aController, aProvider, aFiles) {</span>
<a href="#l53.28"></a><span id="l53.28">   let fileListenerMap = [];</span>
<a href="#l53.29"></a><span id="l53.29">   wh.plan_for_observable_event(&quot;cloudfile:uploadStarted&quot;);</span>
<a href="#l53.30"></a><span id="l53.30"> </span>
<a href="#l53.31"></a><span id="l53.31" class="difflineminus">-  for each (let [, file] in Iterator(aFiles)) {</span>
<a href="#l53.32"></a><span id="l53.32" class="difflineplus">+  for (let file of aFiles) {</span>
<a href="#l53.33"></a><span id="l53.33">     let mapping = {};</span>
<a href="#l53.34"></a><span id="l53.34">     mapping.listener = {</span>
<a href="#l53.35"></a><span id="l53.35">       onStartRequest: function(aRequest, aContext) {</span>
<a href="#l53.36"></a><span id="l53.36">         mapping.started = true;</span>
<a href="#l53.37"></a><span id="l53.37">       },</span>
<a href="#l53.38"></a><span id="l53.38">       onStopRequest: function(aRequest, aContext, aStatusCode) {</span>
<a href="#l53.39"></a><span id="l53.39">         if (aStatusCode == Ci.nsIMsgCloudFileProvider.uploadCanceled)</span>
<a href="#l53.40"></a><span id="l53.40">           mapping.cancelled = true;</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l54.1"></a><span id="l54.1" class="difflineminus">--- a/mail/test/mozmill/shared-modules/test-cloudfile-helpers.js</span>
<a href="#l54.2"></a><span id="l54.2" class="difflineplus">+++ b/mail/test/mozmill/shared-modules/test-cloudfile-helpers.js</span>
<a href="#l54.3"></a><span id="l54.3" class="difflineat">@@ -64,18 +64,17 @@ function getFile(aFilename, aRoot) {</span>
<a href="#l54.4"></a><span id="l54.4">  * @param aFileRoot the file who's parent directory we should start looking</span>
<a href="#l54.5"></a><span id="l54.5">  *                  for aFiles in.</span>
<a href="#l54.6"></a><span id="l54.6">  *</span>
<a href="#l54.7"></a><span id="l54.7">  * Example:</span>
<a href="#l54.8"></a><span id="l54.8">  * let files = collectFiles(['./data/testFile1', './data/testFile2'],</span>
<a href="#l54.9"></a><span id="l54.9">  *                          __file__);</span>
<a href="#l54.10"></a><span id="l54.10">  */</span>
<a href="#l54.11"></a><span id="l54.11"> function collectFiles(aFiles, aFileRoot) {</span>
<a href="#l54.12"></a><span id="l54.12" class="difflineminus">-  return [getFile(filename, aFileRoot)</span>
<a href="#l54.13"></a><span id="l54.13" class="difflineminus">-          for each (filename in aFiles)]</span>
<a href="#l54.14"></a><span id="l54.14" class="difflineplus">+  return aFiles.map(filename =&gt; getFile(filename, aFileRoot));</span>
<a href="#l54.15"></a><span id="l54.15"> }</span>
<a href="#l54.16"></a><span id="l54.16"> </span>
<a href="#l54.17"></a><span id="l54.17"> function MockCloudfileAccount() {</span>
<a href="#l54.18"></a><span id="l54.18">   for(let someDefault in kDefaults)</span>
<a href="#l54.19"></a><span id="l54.19">     this[someDefault] = kDefaults[someDefault];</span>
<a href="#l54.20"></a><span id="l54.20"> }</span>
<a href="#l54.21"></a><span id="l54.21"> </span>
<a href="#l54.22"></a><span id="l54.22"> MockCloudfileAccount.prototype = {</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l55.1"></a><span id="l55.1" class="difflineminus">--- a/mail/test/mozmill/shared-modules/test-compose-helpers.js</span>
<a href="#l55.2"></a><span id="l55.2" class="difflineplus">+++ b/mail/test/mozmill/shared-modules/test-compose-helpers.js</span>
<a href="#l55.3"></a><span id="l55.3" class="difflineat">@@ -320,17 +320,17 @@ function get_compose_body(aController) {</span>
<a href="#l55.4"></a><span id="l55.4">  * pressing enter after each line except for the last.</span>
<a href="#l55.5"></a><span id="l55.5">  *</span>
<a href="#l55.6"></a><span id="l55.6">  * @param aController a compose window controller.</span>
<a href="#l55.7"></a><span id="l55.7">  * @param aText an array of strings to type.</span>
<a href="#l55.8"></a><span id="l55.8">  */</span>
<a href="#l55.9"></a><span id="l55.9"> function type_in_composer(aController, aText) {</span>
<a href="#l55.10"></a><span id="l55.10">   // If we have any typing to do, let's do it.</span>
<a href="#l55.11"></a><span id="l55.11">   let frame = aController.eid(&quot;content-frame&quot;);</span>
<a href="#l55.12"></a><span id="l55.12" class="difflineminus">-  for each (let [i, aLine] in Iterator(aText)) {</span>
<a href="#l55.13"></a><span id="l55.13" class="difflineplus">+  for (let [i, aLine] of aText.entries()) {</span>
<a href="#l55.14"></a><span id="l55.14">     aController.type(frame, aLine);</span>
<a href="#l55.15"></a><span id="l55.15">     if (i &lt; aText.length - 1)</span>
<a href="#l55.16"></a><span id="l55.16">       aController.keypress(frame, &quot;VK_RETURN&quot;, {});</span>
<a href="#l55.17"></a><span id="l55.17">   }</span>
<a href="#l55.18"></a><span id="l55.18"> }</span>
<a href="#l55.19"></a><span id="l55.19"> </span>
<a href="#l55.20"></a><span id="l55.20"> /**</span>
<a href="#l55.21"></a><span id="l55.21">  * Given some starting node aStart, ensure that aStart is a text node which</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l56.1"></a><span id="l56.1" class="difflineminus">--- a/mail/test/mozmill/shared-modules/test-folder-display-helpers.js</span>
<a href="#l56.2"></a><span id="l56.2" class="difflineplus">+++ b/mail/test/mozmill/shared-modules/test-folder-display-helpers.js</span>
<a href="#l56.3"></a><span id="l56.3" class="difflineat">@@ -266,17 +266,18 @@ function installInto(module) {</span>
<a href="#l56.4"></a><span id="l56.4">   // resizeTo operates on outerWidth/outerHeight, their limit is actually</span>
<a href="#l56.5"></a><span id="l56.5">   // screen size + window border size)</span>
<a href="#l56.6"></a><span id="l56.6">   if (mc.window.outerWidth != 1024 || mc.window.outerHeight != 768)</span>
<a href="#l56.7"></a><span id="l56.7">     mc.window.resizeTo(1024, 768);</span>
<a href="#l56.8"></a><span id="l56.8"> </span>
<a href="#l56.9"></a><span id="l56.9">   // now copy everything into the module they provided to us...</span>
<a href="#l56.10"></a><span id="l56.10">   let us = collector.getModule('folder-display-helpers');</span>
<a href="#l56.11"></a><span id="l56.11">   let self = this;</span>
<a href="#l56.12"></a><span id="l56.12" class="difflineminus">-  for each (let [key, value] in Iterator(us)) {</span>
<a href="#l56.13"></a><span id="l56.13" class="difflineplus">+  for (let key in us) {</span>
<a href="#l56.14"></a><span id="l56.14" class="difflineplus">+    let value = us[key];</span>
<a href="#l56.15"></a><span id="l56.15">     if (key in EXPORT_VIA_GETTER_SETTER) {</span>
<a href="#l56.16"></a><span id="l56.16">       // The value of |key| changes between iterations, so it's important to</span>
<a href="#l56.17"></a><span id="l56.17">       // capture the right key in a local variable.</span>
<a href="#l56.18"></a><span id="l56.18">       let thisKey = key;</span>
<a href="#l56.19"></a><span id="l56.19">       module.__defineGetter__(thisKey, () =&gt; self[thisKey]);</span>
<a href="#l56.20"></a><span id="l56.20">       module.__defineSetter__(thisKey, function (aNewValue) {</span>
<a href="#l56.21"></a><span id="l56.21">                                self[thisKey] = aNewValue;</span>
<a href="#l56.22"></a><span id="l56.22">                              });</span>
<a href="#l56.23"></a><span id="l56.23" class="difflineat">@@ -1734,17 +1735,17 @@ function assert_messages_in_view(aSynSet</span>
<a href="#l56.24"></a><span id="l56.24">  * Assert the the given message/messages are not present in the view.</span>
<a href="#l56.25"></a><span id="l56.25">  * @param aMessages Either a single nsIMsgDBHdr or a list of them.</span>
<a href="#l56.26"></a><span id="l56.26">  */</span>
<a href="#l56.27"></a><span id="l56.27"> function assert_messages_not_in_view(aMessages, aController) {</span>
<a href="#l56.28"></a><span id="l56.28">   if (aController == null)</span>
<a href="#l56.29"></a><span id="l56.29">     aController = mc;</span>
<a href="#l56.30"></a><span id="l56.30">   if (aMessages instanceof Ci.nsIMsgDBHdr)</span>
<a href="#l56.31"></a><span id="l56.31">     aMessages = [aMessages];</span>
<a href="#l56.32"></a><span id="l56.32" class="difflineminus">-  for each (let [, msgHdr] in Iterator(aMessages)) {</span>
<a href="#l56.33"></a><span id="l56.33" class="difflineplus">+  for (let msgHdr of aMessages) {</span>
<a href="#l56.34"></a><span id="l56.34">     if (mc.dbView.findIndexOfMsgHdr(msgHdr, true) != nsMsgViewIndex_None)</span>
<a href="#l56.35"></a><span id="l56.35">       mark_failure([&quot;Message header is present in view but should not be:&quot;,</span>
<a href="#l56.36"></a><span id="l56.36">                     msgHdr, &quot;index:&quot;,</span>
<a href="#l56.37"></a><span id="l56.37">                     mc.dbView.findIndexOfMsgHdr(msgHdr, true)]);</span>
<a href="#l56.38"></a><span id="l56.38">   }</span>
<a href="#l56.39"></a><span id="l56.39"> }</span>
<a href="#l56.40"></a><span id="l56.40"> var assert_message_not_in_view = assert_messages_not_in_view;</span>
<a href="#l56.41"></a><span id="l56.41"> </span>
<a href="#l56.42"></a><span id="l56.42" class="difflineat">@@ -1874,17 +1875,17 @@ function _process_row_message_arguments(</span>
<a href="#l56.43"></a><span id="l56.43">           throw_and_dump_view_state(</span>
<a href="#l56.44"></a><span id="l56.44">             &quot;Message not present in view that should be there. &quot; +</span>
<a href="#l56.45"></a><span id="l56.45">              &quot;(&quot; + msgHdr.messageKey + &quot;: &quot; + msgHdr.mime2DecodedSubject + &quot;)&quot;);</span>
<a href="#l56.46"></a><span id="l56.46">         desiredIndices.push(viewIndex);</span>
<a href="#l56.47"></a><span id="l56.47">       }</span>
<a href="#l56.48"></a><span id="l56.48">     }</span>
<a href="#l56.49"></a><span id="l56.49">     // SyntheticMessageSet</span>
<a href="#l56.50"></a><span id="l56.50">     else if (arg.synMessages) {</span>
<a href="#l56.51"></a><span id="l56.51" class="difflineminus">-      for each (let msgHdr in arg.msgHdrs) {</span>
<a href="#l56.52"></a><span id="l56.52" class="difflineplus">+      for (let msgHdr of arg.msgHdrs) {</span>
<a href="#l56.53"></a><span id="l56.53">         let viewIndex = troller.dbView.findIndexOfMsgHdr(msgHdr, false);</span>
<a href="#l56.54"></a><span id="l56.54">         if (viewIndex == nsMsgViewIndex_None)</span>
<a href="#l56.55"></a><span id="l56.55">           throw_and_dump_view_state(</span>
<a href="#l56.56"></a><span id="l56.56">             &quot;Message not present in view that should be there. &quot; +</span>
<a href="#l56.57"></a><span id="l56.57">              &quot;(&quot; + msgHdr.messageKey + &quot;: &quot; + msgHdr.mime2DecodedSubject + &quot;)&quot;);</span>
<a href="#l56.58"></a><span id="l56.58">         desiredIndices.push(viewIndex);</span>
<a href="#l56.59"></a><span id="l56.59">       }</span>
<a href="#l56.60"></a><span id="l56.60">     }</span>
<a href="#l56.61"></a><span id="l56.61" class="difflineat">@@ -2030,18 +2031,17 @@ function _internal_assert_displayed(trus</span>
<a href="#l56.62"></a><span id="l56.62">     let multiMessagePane = troller.e(&quot;multimessage&quot;);</span>
<a href="#l56.63"></a><span id="l56.63">     if (singleMessagePane &amp;&amp; !singleMessagePane.hidden)</span>
<a href="#l56.64"></a><span id="l56.64">       throw new Error(&quot;Single message pane is visible but it should not be.&quot;);</span>
<a href="#l56.65"></a><span id="l56.65">     if (multiMessagePane &amp;&amp; multiMessagePane.hidden)</span>
<a href="#l56.66"></a><span id="l56.66">       throw new Error(&quot;Multiple message pane is hidden but it should not be.&quot;);</span>
<a href="#l56.67"></a><span id="l56.67"> </span>
<a href="#l56.68"></a><span id="l56.68">     // and _now_ make sure that we actually summarized what we wanted to</span>
<a href="#l56.69"></a><span id="l56.69">     //  summarize.</span>
<a href="#l56.70"></a><span id="l56.70" class="difflineminus">-    let desiredMessages = [mc.dbView.getMsgHdrAt(vi) for each</span>
<a href="#l56.71"></a><span id="l56.71" class="difflineminus">-                            ([, vi] in Iterator(desiredIndices))];</span>
<a href="#l56.72"></a><span id="l56.72" class="difflineplus">+    let desiredMessages = desiredIndices.map(vi =&gt; mc.dbView.getMsgHdrAt(vi));</span>
<a href="#l56.73"></a><span id="l56.73">     assert_messages_summarized(troller, desiredMessages);</span>
<a href="#l56.74"></a><span id="l56.74">   }</span>
<a href="#l56.75"></a><span id="l56.75"> }</span>
<a href="#l56.76"></a><span id="l56.76"> </span>
<a href="#l56.77"></a><span id="l56.77"> /**</span>
<a href="#l56.78"></a><span id="l56.78">  * Assert that the messages corresponding to the one or more message spec</span>
<a href="#l56.79"></a><span id="l56.79">  *  arguments are selected and displayed.  If you specify multiple messages,</span>
<a href="#l56.80"></a><span id="l56.80">  *  we verify that the multi-message selection mode is in effect and that they</span>
<a href="#l56.81"></a><span id="l56.81" class="difflineat">@@ -2117,17 +2117,17 @@ function assert_messages_summarized(aCon</span>
<a href="#l56.82"></a><span id="l56.82">   //  actually gotten a chance to run.</span>
<a href="#l56.83"></a><span id="l56.83">   controller.sleep(0);</span>
<a href="#l56.84"></a><span id="l56.84"> </span>
<a href="#l56.85"></a><span id="l56.85">   // - Verify summary object knows about right messages</span>
<a href="#l56.86"></a><span id="l56.86">   if (aSelectedMessages == null)</span>
<a href="#l56.87"></a><span id="l56.87">     aSelectedMessages = aController.folderDisplay.selectedMessages;</span>
<a href="#l56.88"></a><span id="l56.88">   // if it's a synthetic message set, we want the headers...</span>
<a href="#l56.89"></a><span id="l56.89">   if (aSelectedMessages.synMessages)</span>
<a href="#l56.90"></a><span id="l56.90" class="difflineminus">-    aSelectedMessages = [msgHdr for each (msgHdr in aSelectedMessages.msgHdrs)];</span>
<a href="#l56.91"></a><span id="l56.91" class="difflineplus">+    aSelectedMessages = Array.from(aSelectedMessages.msgHdrs);</span>
<a href="#l56.92"></a><span id="l56.92"> </span>
<a href="#l56.93"></a><span id="l56.93">   let summaryFrame = aController.window.gSummaryFrameManager.iframe;</span>
<a href="#l56.94"></a><span id="l56.94">   let summary = summaryFrame.contentWindow.gMessageSummary;</span>
<a href="#l56.95"></a><span id="l56.95">   let summarizedKeys = Object.keys(summary._msgNodes);</span>
<a href="#l56.96"></a><span id="l56.96">   if (aSelectedMessages.length != summarizedKeys.length) {</span>
<a href="#l56.97"></a><span id="l56.97">     let elaboration = &quot;Summary contains &quot; + summarizedKeys.length +</span>
<a href="#l56.98"></a><span id="l56.98">                       &quot; messages, expected &quot; + aSelectedMessages.length + &quot;.&quot;;</span>
<a href="#l56.99"></a><span id="l56.99">     throw new Error(&quot;Summary does not contain the right set of messages. &quot; +</span>
<a href="#l56.100"></a><span id="l56.100" class="difflineat">@@ -2181,17 +2181,17 @@ function assert_not_shown(aMessages) {</span>
<a href="#l56.101"></a><span id="l56.101">  * @param aArgs Arguments of the form processed by</span>
<a href="#l56.102"></a><span id="l56.102">  *     |_process_row_message_arguments|.</span>
<a href="#l56.103"></a><span id="l56.103">  */</span>
<a href="#l56.104"></a><span id="l56.104"> function _assert_elided_helper(aShouldBeElided, aArgs) {</span>
<a href="#l56.105"></a><span id="l56.105">   let [troller, viewIndices] =</span>
<a href="#l56.106"></a><span id="l56.106">     _process_row_message_arguments.apply(this, aArgs);</span>
<a href="#l56.107"></a><span id="l56.107"> </span>
<a href="#l56.108"></a><span id="l56.108">   let dbView = troller.dbView;</span>
<a href="#l56.109"></a><span id="l56.109" class="difflineminus">-  for each (let [, viewIndex] in Iterator(viewIndices)) {</span>
<a href="#l56.110"></a><span id="l56.110" class="difflineplus">+  for (let viewIndex of viewIndices) {</span>
<a href="#l56.111"></a><span id="l56.111">     let flags = dbView.getFlagsAt(viewIndex);</span>
<a href="#l56.112"></a><span id="l56.112">     if (Boolean(flags &amp; Ci.nsMsgMessageFlags.Elided) != aShouldBeElided)</span>
<a href="#l56.113"></a><span id="l56.113">       throw new Error(&quot;Message at view index &quot; + viewIndex +</span>
<a href="#l56.114"></a><span id="l56.114">                       (aShouldBeElided ? &quot; should be elided but is not!&quot;</span>
<a href="#l56.115"></a><span id="l56.115">                                        : &quot; should not be elided but is!&quot;));</span>
<a href="#l56.116"></a><span id="l56.116">   }</span>
<a href="#l56.117"></a><span id="l56.117"> }</span>
<a href="#l56.118"></a><span id="l56.118"> </span>
<a href="#l56.119"></a><span id="l56.119" class="difflineat">@@ -2306,32 +2306,31 @@ function focus_multimessage_pane() {</span>
<a href="#l56.120"></a><span id="l56.120"> /**</span>
<a href="#l56.121"></a><span id="l56.121">  * Returns a string indicating whatever's currently focused. This will return</span>
<a href="#l56.122"></a><span id="l56.122">  * either one of the strings in RECOGNIZED_WINDOWS/RECOGNIZED_ELEMENTS or null.</span>
<a href="#l56.123"></a><span id="l56.123">  */</span>
<a href="#l56.124"></a><span id="l56.124"> function _get_currently_focused_thing() {</span>
<a href="#l56.125"></a><span id="l56.125">   // If the message pane or multimessage is focused, return that</span>
<a href="#l56.126"></a><span id="l56.126">   let focusedWindow = mc.window.document.commandDispatcher.focusedWindow;</span>
<a href="#l56.127"></a><span id="l56.127">   if (focusedWindow) {</span>
<a href="#l56.128"></a><span id="l56.128" class="difflineminus">-    for each (let [, windowId] in Iterator(RECOGNIZED_WINDOWS)) {</span>
<a href="#l56.129"></a><span id="l56.129" class="difflineplus">+    for (let windowId of RECOGNIZED_WINDOWS) {</span>
<a href="#l56.130"></a><span id="l56.130">       let elem = mc.e(windowId);</span>
<a href="#l56.131"></a><span id="l56.131">       if (elem &amp;&amp; focusedWindow == elem.contentWindow)</span>
<a href="#l56.132"></a><span id="l56.132">         return windowId;</span>
<a href="#l56.133"></a><span id="l56.133">     }</span>
<a href="#l56.134"></a><span id="l56.134">   }</span>
<a href="#l56.135"></a><span id="l56.135"> </span>
<a href="#l56.136"></a><span id="l56.136">   // Focused window not recognized, let's try the focused element.</span>
<a href="#l56.137"></a><span id="l56.137">   // If an element is focused, it is necessary for the main window to be</span>
<a href="#l56.138"></a><span id="l56.138">   // focused.</span>
<a href="#l56.139"></a><span id="l56.139">   if (focusedWindow != mc.window)</span>
<a href="#l56.140"></a><span id="l56.140">     return null;</span>
<a href="#l56.141"></a><span id="l56.141"> </span>
<a href="#l56.142"></a><span id="l56.142">   let focusedElement = mc.window.document.commandDispatcher.focusedElement;</span>
<a href="#l56.143"></a><span id="l56.143" class="difflineminus">-  let elementsToMatch = [mc.e(elem)</span>
<a href="#l56.144"></a><span id="l56.144" class="difflineminus">-                         for each ([, elem] in Iterator(RECOGNIZED_ELEMENTS))];</span>
<a href="#l56.145"></a><span id="l56.145" class="difflineplus">+  let elementsToMatch = RECOGNIZED_ELEMENTS.map(elem =&gt; mc.e(elem));</span>
<a href="#l56.146"></a><span id="l56.146">   while (focusedElement &amp;&amp; !elementsToMatch.includes(focusedElement))</span>
<a href="#l56.147"></a><span id="l56.147">     focusedElement = focusedElement.parentNode;</span>
<a href="#l56.148"></a><span id="l56.148"> </span>
<a href="#l56.149"></a><span id="l56.149">   return focusedElement ? focusedElement.id : null;</span>
<a href="#l56.150"></a><span id="l56.150"> }</span>
<a href="#l56.151"></a><span id="l56.151"> </span>
<a href="#l56.152"></a><span id="l56.152"> function _assert_thing_focused(aThing) {</span>
<a href="#l56.153"></a><span id="l56.153">   let focusedThing = _get_currently_focused_thing();</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l57.1"></a><span id="l57.1" class="difflineminus">--- a/mail/test/mozmill/shared-modules/test-quick-filter-bar-helper.js</span>
<a href="#l57.2"></a><span id="l57.2" class="difflineplus">+++ b/mail/test/mozmill/shared-modules/test-quick-filter-bar-helper.js</span>
<a href="#l57.3"></a><span id="l57.3" class="difflineat">@@ -90,17 +90,18 @@ function toggle_quick_filter_bar() {</span>
<a href="#l57.4"></a><span id="l57.4"> }</span>
<a href="#l57.5"></a><span id="l57.5"> </span>
<a href="#l57.6"></a><span id="l57.6"> /**</span>
<a href="#l57.7"></a><span id="l57.7">  * Assert that the state of the constraints visually expressed by the bar is</span>
<a href="#l57.8"></a><span id="l57.8">  * consistent with the passed-in constraints.  This method does not verify</span>
<a href="#l57.9"></a><span id="l57.9">  * that the search constraints are in effect.  Check that elsewhere.</span>
<a href="#l57.10"></a><span id="l57.10">  */</span>
<a href="#l57.11"></a><span id="l57.11"> function assert_constraints_expressed(aConstraints) {</span>
<a href="#l57.12"></a><span id="l57.12" class="difflineminus">-  for each (let [name, domId] in Iterator(nameToBarDomId)) {</span>
<a href="#l57.13"></a><span id="l57.13" class="difflineplus">+  for (let name in nameToBarDomId) {</span>
<a href="#l57.14"></a><span id="l57.14" class="difflineplus">+    let domId = nameToBarDomId[name];</span>
<a href="#l57.15"></a><span id="l57.15">     let expectedValue = (name in aConstraints) ? aConstraints[name] : false;</span>
<a href="#l57.16"></a><span id="l57.16">     let domNode = mc.e(domId);</span>
<a href="#l57.17"></a><span id="l57.17">     if (domNode.checked !== expectedValue) {</span>
<a href="#l57.18"></a><span id="l57.18">       throw new Error(name + &quot;'s checked state should be &quot; + expectedValue);</span>
<a href="#l57.19"></a><span id="l57.19">     }</span>
<a href="#l57.20"></a><span id="l57.20">   }</span>
<a href="#l57.21"></a><span id="l57.21"> }</span>
<a href="#l57.22"></a><span id="l57.22"> </span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l58.1"></a><span id="l58.1" class="difflineminus">--- a/mail/test/mozmill/shared-modules/test-window-helpers.js</span>
<a href="#l58.2"></a><span id="l58.2" class="difflineplus">+++ b/mail/test/mozmill/shared-modules/test-window-helpers.js</span>
<a href="#l58.3"></a><span id="l58.3" class="difflineat">@@ -831,18 +831,17 @@ var AugmentEverybodyWith = {</span>
<a href="#l58.4"></a><span id="l58.4">      */</span>
<a href="#l58.5"></a><span id="l58.5">     e: function _get_element_by_id_helper(aId, aQuery) {</span>
<a href="#l58.6"></a><span id="l58.6">       let elem = this.window.document.getElementById(aId);</span>
<a href="#l58.7"></a><span id="l58.7">       if (aQuery) {</span>
<a href="#l58.8"></a><span id="l58.8">         if (aQuery.tagName) {</span>
<a href="#l58.9"></a><span id="l58.9">           let elems = Array.prototype.slice.call(</span>
<a href="#l58.10"></a><span id="l58.10">                         elem.getElementsByTagName(aQuery.tagName));</span>
<a href="#l58.11"></a><span id="l58.11">           if (aQuery.label)</span>
<a href="#l58.12"></a><span id="l58.12" class="difflineminus">-            elems = [elem for each (elem in elems)</span>
<a href="#l58.13"></a><span id="l58.13" class="difflineminus">-                          if (elem.label == aQuery.label)];</span>
<a href="#l58.14"></a><span id="l58.14" class="difflineplus">+            elems = elems.filter(elem =&gt; elem.label == aQuery.label);</span>
<a href="#l58.15"></a><span id="l58.15">           elem = elems[0];</span>
<a href="#l58.16"></a><span id="l58.16">         }</span>
<a href="#l58.17"></a><span id="l58.17">       }</span>
<a href="#l58.18"></a><span id="l58.18">       return elem;</span>
<a href="#l58.19"></a><span id="l58.19">     },</span>
<a href="#l58.20"></a><span id="l58.20"> </span>
<a href="#l58.21"></a><span id="l58.21">     /**</span>
<a href="#l58.22"></a><span id="l58.22">      * @return an elementlib.Elem for the element with the given id on the</span>
<a href="#l58.23"></a><span id="l58.23" class="difflineat">@@ -964,17 +963,17 @@ var AugmentEverybodyWith = {</span>
<a href="#l58.24"></a><span id="l58.24">                       &quot;Popup never opened! id=&quot; + aRootPopup.id +</span>
<a href="#l58.25"></a><span id="l58.25">                       &quot;, state=&quot; + aRootPopup.state);</span>
<a href="#l58.26"></a><span id="l58.26">       }</span>
<a href="#l58.27"></a><span id="l58.27">       // These popups sadly do not close themselves, so we need to keep track</span>
<a href="#l58.28"></a><span id="l58.28">       // of them so we can make sure they end up closed.</span>
<a href="#l58.29"></a><span id="l58.29">       let closeStack = [aRootPopup];</span>
<a href="#l58.30"></a><span id="l58.30"> </span>
<a href="#l58.31"></a><span id="l58.31">       let curPopup = aRootPopup;</span>
<a href="#l58.32"></a><span id="l58.32" class="difflineminus">-      for each (let [iAction, actionObj] in Iterator(aActions)) {</span>
<a href="#l58.33"></a><span id="l58.33" class="difflineplus">+      for (let [iAction, actionObj] of aActions.entries()) {</span>
<a href="#l58.34"></a><span id="l58.34">         /**</span>
<a href="#l58.35"></a><span id="l58.35">          * Check if aNode attributes match all those given in actionObj.</span>
<a href="#l58.36"></a><span id="l58.36">          * Nodes that are obvious containers are skipped, and their children</span>
<a href="#l58.37"></a><span id="l58.37">          * will be used to recursively find a match instead.</span>
<a href="#l58.38"></a><span id="l58.38">          */</span>
<a href="#l58.39"></a><span id="l58.39">         let findMatch = function(aNode) {</span>
<a href="#l58.40"></a><span id="l58.40">           // Ignore some elements and just use their children instead.</span>
<a href="#l58.41"></a><span id="l58.41">           if (aNode.localName == &quot;hbox&quot; || aNode.localName == &quot;vbox&quot; ||</span>
<a href="#l58.42"></a><span id="l58.42" class="difflineat">@@ -983,17 +982,18 @@ var AugmentEverybodyWith = {</span>
<a href="#l58.43"></a><span id="l58.43">               let childMatch = findMatch(aNode.children[i]);</span>
<a href="#l58.44"></a><span id="l58.44">               if (childMatch)</span>
<a href="#l58.45"></a><span id="l58.45">                 return childMatch;</span>
<a href="#l58.46"></a><span id="l58.46">             }</span>
<a href="#l58.47"></a><span id="l58.47">             return null;</span>
<a href="#l58.48"></a><span id="l58.48">           }</span>
<a href="#l58.49"></a><span id="l58.49"> </span>
<a href="#l58.50"></a><span id="l58.50">           let matchedAll = true;</span>
<a href="#l58.51"></a><span id="l58.51" class="difflineminus">-          for each (let [name, value] in Iterator(actionObj)) {</span>
<a href="#l58.52"></a><span id="l58.52" class="difflineplus">+          for (let name in actionObj) {</span>
<a href="#l58.53"></a><span id="l58.53" class="difflineplus">+            let value = actionObj[name];</span>
<a href="#l58.54"></a><span id="l58.54">             if (!aNode.hasAttribute(name) ||</span>
<a href="#l58.55"></a><span id="l58.55">                 aNode.getAttribute(name) != value) {</span>
<a href="#l58.56"></a><span id="l58.56">               matchedAll = false;</span>
<a href="#l58.57"></a><span id="l58.57">               break;</span>
<a href="#l58.58"></a><span id="l58.58">             }</span>
<a href="#l58.59"></a><span id="l58.59">           }</span>
<a href="#l58.60"></a><span id="l58.60">           return (matchedAll) ? aNode : null;</span>
<a href="#l58.61"></a><span id="l58.61">         };</span>
<a href="#l58.62"></a><span id="l58.62" class="difflineat">@@ -1305,55 +1305,59 @@ var PerWindowTypeAugmentations = {</span>
<a href="#l58.63"></a><span id="l58.63">         return this.folderDisplay.view.dbView;</span>
<a href="#l58.64"></a><span id="l58.64">       }</span>
<a href="#l58.65"></a><span id="l58.65">     }</span>
<a href="#l58.66"></a><span id="l58.66">   },</span>
<a href="#l58.67"></a><span id="l58.67"> };</span>
<a href="#l58.68"></a><span id="l58.68"> </span>
<a href="#l58.69"></a><span id="l58.69"> function _augment_helper(aController, aAugmentDef) {</span>
<a href="#l58.70"></a><span id="l58.70">   if (aAugmentDef.elementsToExpose) {</span>
<a href="#l58.71"></a><span id="l58.71" class="difflineminus">-    for each (let [key, value] in Iterator(aAugmentDef.elementsToExpose)) {</span>
<a href="#l58.72"></a><span id="l58.72" class="difflineplus">+    for (let key in aAugmentDef.elementsToExpose) {</span>
<a href="#l58.73"></a><span id="l58.73" class="difflineplus">+      let value = aAugmentDef.elementsToExpose[key];</span>
<a href="#l58.74"></a><span id="l58.74">       aController[key] = aController.window.document.getElementById(value);</span>
<a href="#l58.75"></a><span id="l58.75">     }</span>
<a href="#l58.76"></a><span id="l58.76">   }</span>
<a href="#l58.77"></a><span id="l58.77">   if (aAugmentDef.elementsIDsToExpose) {</span>
<a href="#l58.78"></a><span id="l58.78" class="difflineminus">-    for each (let [key, value] in Iterator(aAugmentDef.elementIDsToExpose)) {</span>
<a href="#l58.79"></a><span id="l58.79" class="difflineplus">+    for (let key in aAugmentDef.elementIDsToExpose) {</span>
<a href="#l58.80"></a><span id="l58.80" class="difflineplus">+      let value = aAugmentDef.elementIDsToExpose[key];</span>
<a href="#l58.81"></a><span id="l58.81">       aController[key] = new elib.ID(</span>
<a href="#l58.82"></a><span id="l58.82">                            aController.window.document, value);</span>
<a href="#l58.83"></a><span id="l58.83">     }</span>
<a href="#l58.84"></a><span id="l58.84">   }</span>
<a href="#l58.85"></a><span id="l58.85">   if (aAugmentDef.globalsToExposeAtStartup) {</span>
<a href="#l58.86"></a><span id="l58.86" class="difflineminus">-    for each (let [key, value] in</span>
<a href="#l58.87"></a><span id="l58.87" class="difflineminus">-              Iterator(aAugmentDef.globalsToExposeAtStartup)) {</span>
<a href="#l58.88"></a><span id="l58.88" class="difflineplus">+    for (let key in aAugmentDef.globalsToExposeAtStartup) {</span>
<a href="#l58.89"></a><span id="l58.89" class="difflineplus">+      let value = aAugmentDef.globalsToExposeAtStartup[key];</span>
<a href="#l58.90"></a><span id="l58.90">       aController[key] = aController.window[value];</span>
<a href="#l58.91"></a><span id="l58.91">     }</span>
<a href="#l58.92"></a><span id="l58.92">   }</span>
<a href="#l58.93"></a><span id="l58.93">   if (aAugmentDef.globalsToExposeViaGetters) {</span>
<a href="#l58.94"></a><span id="l58.94" class="difflineminus">-    for each (let [key, value] in</span>
<a href="#l58.95"></a><span id="l58.95" class="difflineminus">-              Iterator(aAugmentDef.globalsToExposeViaGetters)) {</span>
<a href="#l58.96"></a><span id="l58.96" class="difflineplus">+    for (let key in aAugmentDef.globalsToExposeViaGetters) {</span>
<a href="#l58.97"></a><span id="l58.97" class="difflineplus">+      let value = aAugmentDef.globalsToExposeViaGetters[key];</span>
<a href="#l58.98"></a><span id="l58.98">       let globalName = value;</span>
<a href="#l58.99"></a><span id="l58.99">       aController.__defineGetter__(key, function() {</span>
<a href="#l58.100"></a><span id="l58.100">           return this.window[globalName];</span>
<a href="#l58.101"></a><span id="l58.101">         });</span>
<a href="#l58.102"></a><span id="l58.102">     }</span>
<a href="#l58.103"></a><span id="l58.103">   }</span>
<a href="#l58.104"></a><span id="l58.104">   if (aAugmentDef.getters) {</span>
<a href="#l58.105"></a><span id="l58.105" class="difflineminus">-    for each (let [key, value] in Iterator(aAugmentDef.getters)) {</span>
<a href="#l58.106"></a><span id="l58.106" class="difflineplus">+    for (let key in aAugmentDef.getters) {</span>
<a href="#l58.107"></a><span id="l58.107" class="difflineplus">+      let value = aAugmentDef.getters[key];</span>
<a href="#l58.108"></a><span id="l58.108">       aController.__defineGetter__(key, value);</span>
<a href="#l58.109"></a><span id="l58.109">     }</span>
<a href="#l58.110"></a><span id="l58.110">   }</span>
<a href="#l58.111"></a><span id="l58.111">   if (aAugmentDef.methods) {</span>
<a href="#l58.112"></a><span id="l58.112" class="difflineminus">-    for each (let [key, value] in Iterator(aAugmentDef.methods)) {</span>
<a href="#l58.113"></a><span id="l58.113" class="difflineplus">+    for (let key in aAugmentDef.methods) {</span>
<a href="#l58.114"></a><span id="l58.114" class="difflineplus">+      let value = aAugmentDef.methods[key];</span>
<a href="#l58.115"></a><span id="l58.115">       aController[key] = value;</span>
<a href="#l58.116"></a><span id="l58.116">     }</span>
<a href="#l58.117"></a><span id="l58.117">   }</span>
<a href="#l58.118"></a><span id="l58.118"> </span>
<a href="#l58.119"></a><span id="l58.119">   if (aAugmentDef.debugTrace) {</span>
<a href="#l58.120"></a><span id="l58.120">     let win = aController.window;</span>
<a href="#l58.121"></a><span id="l58.121" class="difflineminus">-    for each (let [, traceDef] in Iterator(aAugmentDef.debugTrace)) {</span>
<a href="#l58.122"></a><span id="l58.122" class="difflineplus">+    for (let traceDef of aAugmentDef.debugTrace) {</span>
<a href="#l58.123"></a><span id="l58.123">       let baseObj, useThis;</span>
<a href="#l58.124"></a><span id="l58.124">       // - Get the object that actually has the method to wrap</span>
<a href="#l58.125"></a><span id="l58.125">       if (traceDef.hasOwnProperty(&quot;onGlobal&quot;)) {</span>
<a href="#l58.126"></a><span id="l58.126">         baseObj = win;</span>
<a href="#l58.127"></a><span id="l58.127">         useThis = false;</span>
<a href="#l58.128"></a><span id="l58.128">       }</span>
<a href="#l58.129"></a><span id="l58.129">       else if (traceDef.hasOwnProperty(&quot;onConstructor&quot;)) {</span>
<a href="#l58.130"></a><span id="l58.130">         baseObj = win[traceDef.onConstructor].prototype;</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l59.1"></a><span id="l59.1" class="difflineminus">--- a/mail/test/resources/jsbridge/jsbridge/extension/resource/modules/events.js</span>
<a href="#l59.2"></a><span id="l59.2" class="difflineplus">+++ b/mail/test/resources/jsbridge/jsbridge/extension/resource/modules/events.js</span>
<a href="#l59.3"></a><span id="l59.3" class="difflineat">@@ -1,13 +1,13 @@</span>
<a href="#l59.4"></a><span id="l59.4"> var EXPORTED_SYMBOLS = [&quot;backchannels&quot;, &quot;fireEvent&quot;, &quot;addBackChannel&quot;];</span>
<a href="#l59.5"></a><span id="l59.5"> </span>
<a href="#l59.6"></a><span id="l59.6"> var backchannels = [];</span>
<a href="#l59.7"></a><span id="l59.7"> </span>
<a href="#l59.8"></a><span id="l59.8"> var fireEvent = function (name, obj) {</span>
<a href="#l59.9"></a><span id="l59.9" class="difflineminus">-  for each(backchannel in backchannels) {</span>
<a href="#l59.10"></a><span id="l59.10" class="difflineplus">+  for (let backchannel of backchannels) {</span>
<a href="#l59.11"></a><span id="l59.11">     backchannel.session.encodeOut({'eventType':name, 'result':obj});</span>
<a href="#l59.12"></a><span id="l59.12">   }</span>
<a href="#l59.13"></a><span id="l59.13"> }</span>
<a href="#l59.14"></a><span id="l59.14"> </span>
<a href="#l59.15"></a><span id="l59.15"> var addBackChannel = function (backchannel) {</span>
<a href="#l59.16"></a><span id="l59.16">     backchannels.push(backchannel);</span>
<a href="#l59.17"></a><span id="l59.17"> }</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l60.1"></a><span id="l60.1" class="difflineminus">--- a/mail/test/resources/mozmill/mozmill/extension/content/chrome.js</span>
<a href="#l60.2"></a><span id="l60.2" class="difflineplus">+++ b/mail/test/resources/mozmill/mozmill/extension/content/chrome.js</span>
<a href="#l60.3"></a><span id="l60.3" class="difflineat">@@ -20,17 +20,17 @@ function fillTooltip(tipElement) {</span>
<a href="#l60.4"></a><span id="l60.4">           .getPropertyValue(&quot;direction&quot;);</span>
<a href="#l60.5"></a><span id="l60.5">       }</span>
<a href="#l60.6"></a><span id="l60.6">       tipElement = tipElement.parentNode;</span>
<a href="#l60.7"></a><span id="l60.7">     }</span>
<a href="#l60.8"></a><span id="l60.8"> </span>
<a href="#l60.9"></a><span id="l60.9">     var tipNode = document.getElementById(&quot;mozmill-tooltip&quot;);</span>
<a href="#l60.10"></a><span id="l60.10">     tipNode.style.direction = direction;</span>
<a href="#l60.11"></a><span id="l60.11"> </span>
<a href="#l60.12"></a><span id="l60.12" class="difflineminus">-    for each (var t in [titleText, XLinkTitleText]) {</span>
<a href="#l60.13"></a><span id="l60.13" class="difflineplus">+    for (var t of [titleText, XLinkTitleText]) {</span>
<a href="#l60.14"></a><span id="l60.14">       if (t &amp;&amp; /\S/.test(t)) {</span>
<a href="#l60.15"></a><span id="l60.15">         // Per HTML 4.01 6.2 (CDATA section), literal CRs and tabs should be</span>
<a href="#l60.16"></a><span id="l60.16">         // replaced with spaces, and LFs should be removed entirely</span>
<a href="#l60.17"></a><span id="l60.17">         t = t.replace(/[\r\t]/g, ' ');</span>
<a href="#l60.18"></a><span id="l60.18">         t = t.replace(/\n/g, '');</span>
<a href="#l60.19"></a><span id="l60.19"> </span>
<a href="#l60.20"></a><span id="l60.20">         tipNode.setAttribute(&quot;label&quot;, t);</span>
<a href="#l60.21"></a><span id="l60.21">         retVal = true;</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l61.1"></a><span id="l61.1" class="difflineminus">--- a/mail/test/resources/mozmill/mozmill/extension/content/dx.js</span>
<a href="#l61.2"></a><span id="l61.2" class="difflineplus">+++ b/mail/test/resources/mozmill/mozmill/extension/content/dx.js</span>
<a href="#l61.3"></a><span id="l61.3" class="difflineat">@@ -141,21 +141,21 @@ DomInspectorConnector.prototype.dxOff = </span>
<a href="#l61.4"></a><span id="l61.4">   $(&quot;#dxToggle&quot;).text(&quot;Start&quot;);</span>
<a href="#l61.5"></a><span id="l61.5">   $(&quot;#dxCopy&quot;).show();</span>
<a href="#l61.6"></a><span id="l61.6"> </span>
<a href="#l61.7"></a><span id="l61.7">   //try to cleanup left over outlines</span>
<a href="#l61.8"></a><span id="l61.8">   if (this.lastEvent){</span>
<a href="#l61.9"></a><span id="l61.9">     this.lastEvent.target.style.outline = &quot;&quot;;</span>
<a href="#l61.10"></a><span id="l61.10">   }</span>
<a href="#l61.11"></a><span id="l61.11"> </span>
<a href="#l61.12"></a><span id="l61.12" class="difflineminus">-  for each(win in utils.getWindows()) {</span>
<a href="#l61.13"></a><span id="l61.13" class="difflineplus">+  for (var win of utils.getWindows()) {</span>
<a href="#l61.14"></a><span id="l61.14">     this.dxRecursiveUnBind(win, 'click');</span>
<a href="#l61.15"></a><span id="l61.15">   }</span>
<a href="#l61.16"></a><span id="l61.16"> </span>
<a href="#l61.17"></a><span id="l61.17" class="difflineminus">-  for each(win in utils.getWindows()) {</span>
<a href="#l61.18"></a><span id="l61.18" class="difflineplus">+  for (win of utils.getWindows()) {</span>
<a href="#l61.19"></a><span id="l61.19">     this.dxRecursiveUnBind(win, 'dblclick');</span>
<a href="#l61.20"></a><span id="l61.20">   }</span>
<a href="#l61.21"></a><span id="l61.21"> </span>
<a href="#l61.22"></a><span id="l61.22">   var observerService =</span>
<a href="#l61.23"></a><span id="l61.23">     Components.classes[&quot;@mozilla.org/observer-service;1&quot;]</span>
<a href="#l61.24"></a><span id="l61.24">       .getService(Components.interfaces.nsIObserverService);</span>
<a href="#l61.25"></a><span id="l61.25"> </span>
<a href="#l61.26"></a><span id="l61.26">   try {</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l62.1"></a><span id="l62.1" class="difflineminus">--- a/mail/test/resources/mozmill/mozmill/extension/content/rec.js</span>
<a href="#l62.2"></a><span id="l62.2" class="difflineplus">+++ b/mail/test/resources/mozmill/mozmill/extension/content/rec.js</span>
<a href="#l62.3"></a><span id="l62.3" class="difflineat">@@ -45,26 +45,26 @@ var events = {}; Components.utils.import</span>
<a href="#l62.4"></a><span id="l62.4"> var controller = {};  Components.utils.import('resource://mozmill/modules/controller.js', controller);</span>
<a href="#l62.5"></a><span id="l62.5"> </span>
<a href="#l62.6"></a><span id="l62.6"> // var recorderLogger = logging.getLogger('recorderLogger');</span>
<a href="#l62.7"></a><span id="l62.7"> </span>
<a href="#l62.8"></a><span id="l62.8"> var currentRecorderArray = [];</span>
<a href="#l62.9"></a><span id="l62.9"> </span>
<a href="#l62.10"></a><span id="l62.10"> var getEventSet = function (eArray) {</span>
<a href="#l62.11"></a><span id="l62.11">   var inSet = function (a, c) {</span>
<a href="#l62.12"></a><span id="l62.12" class="difflineminus">-    for each(x in a) {</span>
<a href="#l62.13"></a><span id="l62.13" class="difflineplus">+    for (var x of a) {</span>
<a href="#l62.14"></a><span id="l62.14">       if (x.evt.timeStamp == c.evt.timeStamp &amp;&amp; c.evt.type == x.evt.type) {</span>
<a href="#l62.15"></a><span id="l62.15">         return true;</span>
<a href="#l62.16"></a><span id="l62.16">       }</span>
<a href="#l62.17"></a><span id="l62.17">     }</span>
<a href="#l62.18"></a><span id="l62.18">     return false;</span>
<a href="#l62.19"></a><span id="l62.19">   }</span>
<a href="#l62.20"></a><span id="l62.20"> </span>
<a href="#l62.21"></a><span id="l62.21">   var returnArray = [];</span>
<a href="#l62.22"></a><span id="l62.22" class="difflineminus">-  for each(e in eArray) {</span>
<a href="#l62.23"></a><span id="l62.23" class="difflineplus">+  for (var e of eArray) {</span>
<a href="#l62.24"></a><span id="l62.24">     // recorderLogger.info('ts '+e.evt.timeStamp+' '+inSet(returnArray, e))</span>
<a href="#l62.25"></a><span id="l62.25">     if (!inSet(returnArray, e)) {</span>
<a href="#l62.26"></a><span id="l62.26">       returnArray.push(e);</span>
<a href="#l62.27"></a><span id="l62.27">     }</span>
<a href="#l62.28"></a><span id="l62.28">   }</span>
<a href="#l62.29"></a><span id="l62.29">   return returnArray;</span>
<a href="#l62.30"></a><span id="l62.30"> }</span>
<a href="#l62.31"></a><span id="l62.31"> </span>
<a href="#l62.32"></a><span id="l62.32" class="difflineat">@@ -85,17 +85,17 @@ var recorderMethodCases = {</span>
<a href="#l62.33"></a><span id="l62.33">     }</span>
<a href="#l62.34"></a><span id="l62.34">    },</span>
<a href="#l62.35"></a><span id="l62.35">   'change': function (x) {return 'type('+x['inspected'].elementText+',&quot;'+x['evt'].target.value+'&quot;)';},</span>
<a href="#l62.36"></a><span id="l62.36">   'dblclick': function (x) { return 'doubleClick('+x['inspected'].elementText+')';},</span>
<a href="#l62.37"></a><span id="l62.37"> }</span>
<a href="#l62.38"></a><span id="l62.38"> </span>
<a href="#l62.39"></a><span id="l62.39"> var cleanupEventsArray = function (recorder_array) {</span>
<a href="#l62.40"></a><span id="l62.40">   var indexesForRemoval = [];</span>
<a href="#l62.41"></a><span id="l62.41" class="difflineminus">-  var type_indexes = [x['evt'].type for each(x in recorder_array)];</span>
<a href="#l62.42"></a><span id="l62.42" class="difflineplus">+  var type_indexes = recorder_array.map(x =&gt; x['evt'].type);</span>
<a href="#l62.43"></a><span id="l62.43"> </span>
<a href="#l62.44"></a><span id="l62.44">   // Convert a set of keypress events to a single type event</span>
<a href="#l62.45"></a><span id="l62.45">   if (arrays.inArray(type_indexes, 'change')) {</span>
<a href="#l62.46"></a><span id="l62.46">     var offset = 0;</span>
<a href="#l62.47"></a><span id="l62.47">     while (arrays.indexOf(type_indexes, 'change', offset) != -1) {</span>
<a href="#l62.48"></a><span id="l62.48">       var eIndex = arrays.indexOf(type_indexes, 'change', offset);</span>
<a href="#l62.49"></a><span id="l62.49">       var e = recorder_array[eIndex];</span>
<a href="#l62.50"></a><span id="l62.50">       if (e['evt'].target.value != undefined &amp;&amp; arrays.compare(e['evt'].target.value,</span>
<a href="#l62.51"></a><span id="l62.51" class="difflineat">@@ -159,17 +159,17 @@ var cleanupEventsArray = function (recor</span>
<a href="#l62.52"></a><span id="l62.52"> }</span>
<a href="#l62.53"></a><span id="l62.53"> </span>
<a href="#l62.54"></a><span id="l62.54"> var getRecordedScript = function (recorder_array) {</span>
<a href="#l62.55"></a><span id="l62.55">   var setup = {};</span>
<a href="#l62.56"></a><span id="l62.56">   var test = [];</span>
<a href="#l62.57"></a><span id="l62.57"> </span>
<a href="#l62.58"></a><span id="l62.58">   var recorder_array = cleanupEventsArray(getEventSet(recorder_array));</span>
<a href="#l62.59"></a><span id="l62.59"> </span>
<a href="#l62.60"></a><span id="l62.60" class="difflineminus">-  for each(x in recorder_array) {</span>
<a href="#l62.61"></a><span id="l62.61" class="difflineplus">+  for (var x of recorder_array) {</span>
<a href="#l62.62"></a><span id="l62.62">     var inspected = x['inspected'];</span>
<a href="#l62.63"></a><span id="l62.63">     if (!setup[inspected.controllerText]) {</span>
<a href="#l62.64"></a><span id="l62.64">       if (objects.getLength(setup) &gt; 0) {</span>
<a href="#l62.65"></a><span id="l62.65">         var ext = String(objects.getLength(setup) + 1);</span>
<a href="#l62.66"></a><span id="l62.66">       } else {</span>
<a href="#l62.67"></a><span id="l62.67">         var ext = '';</span>
<a href="#l62.68"></a><span id="l62.68">       }</span>
<a href="#l62.69"></a><span id="l62.69">       setup[inspected.controllerText] = 'controller'+ext</span>
<a href="#l62.70"></a><span id="l62.70" class="difflineat">@@ -187,17 +187,17 @@ var getRecordedScript = function (record</span>
<a href="#l62.71"></a><span id="l62.71"> </span>
<a href="#l62.72"></a><span id="l62.72">   var rscript = ['var setupModule = function(module) {',];</span>
<a href="#l62.73"></a><span id="l62.73">   for (i in setup) {</span>
<a href="#l62.74"></a><span id="l62.74">     rscript.push(&quot;  &quot;+setup[i]+' = '+i+';')</span>
<a href="#l62.75"></a><span id="l62.75">   }</span>
<a href="#l62.76"></a><span id="l62.76">   rscript.push('}')</span>
<a href="#l62.77"></a><span id="l62.77">   rscript.push('')</span>
<a href="#l62.78"></a><span id="l62.78">   rscript.push('var testRecorded = function () {')</span>
<a href="#l62.79"></a><span id="l62.79" class="difflineminus">-  for each(t in test){</span>
<a href="#l62.80"></a><span id="l62.80" class="difflineplus">+  for (var t of test){</span>
<a href="#l62.81"></a><span id="l62.81">     rscript.push('  '+t);</span>
<a href="#l62.82"></a><span id="l62.82">   }</span>
<a href="#l62.83"></a><span id="l62.83">   rscript.push('}')</span>
<a href="#l62.84"></a><span id="l62.84">   return rscript.join('\n');</span>
<a href="#l62.85"></a><span id="l62.85"> }</span>
<a href="#l62.86"></a><span id="l62.86"> </span>
<a href="#l62.87"></a><span id="l62.87"> var RecorderConnector = function() {</span>
<a href="#l62.88"></a><span id="l62.88">   this.lastEvent = null;</span>
<a href="#l62.89"></a><span id="l62.89" class="difflineat">@@ -265,17 +265,17 @@ RecorderConnector.prototype.on = functio</span>
<a href="#l62.90"></a><span id="l62.90"> </span>
<a href="#l62.91"></a><span id="l62.91">   // update UI</span>
<a href="#l62.92"></a><span id="l62.92">   $(&quot;#recordToggle&quot;).text(&quot;Stop Recording&quot;);</span>
<a href="#l62.93"></a><span id="l62.93">   $(&quot;#recordToggle&quot;).addClass(&quot;ui-state-highlight&quot;);</span>
<a href="#l62.94"></a><span id="l62.94">   $(&quot;#recordToggle&quot;).addClass(&quot;ui-priority-primary&quot;);</span>
<a href="#l62.95"></a><span id="l62.95"> </span>
<a href="#l62.96"></a><span id="l62.96">   newFile();</span>
<a href="#l62.97"></a><span id="l62.97"> </span>
<a href="#l62.98"></a><span id="l62.98" class="difflineminus">-  for each(win in utils.getWindows()) {</span>
<a href="#l62.99"></a><span id="l62.99" class="difflineplus">+  for (var win of utils.getWindows()) {</span>
<a href="#l62.100"></a><span id="l62.100">     if (win.document.title != &quot;MozMill IDE&quot;){</span>
<a href="#l62.101"></a><span id="l62.101">       this.bindListeners(win);</span>
<a href="#l62.102"></a><span id="l62.102">     }</span>
<a href="#l62.103"></a><span id="l62.103">   }</span>
<a href="#l62.104"></a><span id="l62.104"> </span>
<a href="#l62.105"></a><span id="l62.105">   var mmWindows = utils.getWindows('navigator:browser');</span>
<a href="#l62.106"></a><span id="l62.106">   if (mmWindows.length != 0){</span>
<a href="#l62.107"></a><span id="l62.107">     mmWindows[0].focus();</span>
<a href="#l62.108"></a><span id="l62.108" class="difflineat">@@ -295,17 +295,17 @@ RecorderConnector.prototype.off = functi</span>
<a href="#l62.109"></a><span id="l62.109">   this.ison = false;</span>
<a href="#l62.110"></a><span id="l62.110"> </span>
<a href="#l62.111"></a><span id="l62.111">   //update UI</span>
<a href="#l62.112"></a><span id="l62.112">   $(&quot;#recordToggle&quot;).text(&quot;Record&quot;);</span>
<a href="#l62.113"></a><span id="l62.113">   $(&quot;#recordToggle&quot;).removeClass(&quot;ui-state-highlight&quot;);</span>
<a href="#l62.114"></a><span id="l62.114">   $(&quot;#recordToggle&quot;).removeClass(&quot;ui-priority-primary&quot;);</span>
<a href="#l62.115"></a><span id="l62.115"> </span>
<a href="#l62.116"></a><span id="l62.116"> </span>
<a href="#l62.117"></a><span id="l62.117" class="difflineminus">-  for each(win in utils.getWindows()) {</span>
<a href="#l62.118"></a><span id="l62.118" class="difflineplus">+  for (var win of utils.getWindows()) {</span>
<a href="#l62.119"></a><span id="l62.119">     this.unbindListeners(win);</span>
<a href="#l62.120"></a><span id="l62.120">   }</span>
<a href="#l62.121"></a><span id="l62.121">   var r = getRecordedScript(currentRecorderArray);</span>
<a href="#l62.122"></a><span id="l62.122"> </span>
<a href="#l62.123"></a><span id="l62.123">   editor.setContent(r);</span>
<a href="#l62.124"></a><span id="l62.124">   currentRecorderArray = [];</span>
<a href="#l62.125"></a><span id="l62.125">   //remove new window listener</span>
<a href="#l62.126"></a><span id="l62.126">   var observerService =</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l63.1"></a><span id="l63.1" class="difflineminus">--- a/mail/test/resources/mozmill/mozmill/extension/resource/modules/controller.js</span>
<a href="#l63.2"></a><span id="l63.2" class="difflineplus">+++ b/mail/test/resources/mozmill/mozmill/extension/resource/modules/controller.js</span>
<a href="#l63.3"></a><span id="l63.3" class="difflineat">@@ -107,17 +107,17 @@ waitForEvents.prototype = {</span>
<a href="#l63.4"></a><span id="l63.4">     if (node.getNode != undefined)</span>
<a href="#l63.5"></a><span id="l63.5">       node = node.getNode();</span>
<a href="#l63.6"></a><span id="l63.6"> </span>
<a href="#l63.7"></a><span id="l63.7">     this.events = events;</span>
<a href="#l63.8"></a><span id="l63.8">     this.node = node;</span>
<a href="#l63.9"></a><span id="l63.9">     node.firedEvents = {};</span>
<a href="#l63.10"></a><span id="l63.10">     this.registry = {};</span>
<a href="#l63.11"></a><span id="l63.11"> </span>
<a href="#l63.12"></a><span id="l63.12" class="difflineminus">-    for each(e in events) {</span>
<a href="#l63.13"></a><span id="l63.13" class="difflineplus">+    for (var e of events) {</span>
<a href="#l63.14"></a><span id="l63.14">       var listener = function(event) {</span>
<a href="#l63.15"></a><span id="l63.15">         this.firedEvents[event.type] = true;</span>
<a href="#l63.16"></a><span id="l63.16">       }</span>
<a href="#l63.17"></a><span id="l63.17">       this.registry[e] = listener;</span>
<a href="#l63.18"></a><span id="l63.18">       this.registry[e].result = false;</span>
<a href="#l63.19"></a><span id="l63.19">       this.node.addEventListener(e, this.registry[e], true);</span>
<a href="#l63.20"></a><span id="l63.20">     }</span>
<a href="#l63.21"></a><span id="l63.21">   },</span>
<a href="#l63.22"></a><span id="l63.22" class="difflineat">@@ -300,18 +300,20 @@ Menu.prototype = {</span>
<a href="#l63.23"></a><span id="l63.23">   }</span>
<a href="#l63.24"></a><span id="l63.24"> };</span>
<a href="#l63.25"></a><span id="l63.25"> </span>
<a href="#l63.26"></a><span id="l63.26"> /**</span>
<a href="#l63.27"></a><span id="l63.27">  * Deprecated - Has to be removed with Mozmill 2.0</span>
<a href="#l63.28"></a><span id="l63.28">  */</span>
<a href="#l63.29"></a><span id="l63.29"> var MenuTree = function(aWindow, aMenu) {</span>
<a href="#l63.30"></a><span id="l63.30">   var items = aMenu ? aMenu.childNodes : null;</span>
<a href="#l63.31"></a><span id="l63.31" class="difflineminus">-</span>
<a href="#l63.32"></a><span id="l63.32" class="difflineminus">-  for each (var node in items) {</span>
<a href="#l63.33"></a><span id="l63.33" class="difflineplus">+  if (!items) {</span>
<a href="#l63.34"></a><span id="l63.34" class="difflineplus">+    return;</span>
<a href="#l63.35"></a><span id="l63.35" class="difflineplus">+  }</span>
<a href="#l63.36"></a><span id="l63.36" class="difflineplus">+  for (var node of items) {</span>
<a href="#l63.37"></a><span id="l63.37">     var entry = null;</span>
<a href="#l63.38"></a><span id="l63.38"> </span>
<a href="#l63.39"></a><span id="l63.39">     switch (node.tagName) {</span>
<a href="#l63.40"></a><span id="l63.40">       case &quot;menu&quot;:</span>
<a href="#l63.41"></a><span id="l63.41">         // Fake a click onto the menu to add dynamic entries</span>
<a href="#l63.42"></a><span id="l63.42">         var popup = node.querySelector(&quot;menupopup&quot;);</span>
<a href="#l63.43"></a><span id="l63.43">         if (popup) {</span>
<a href="#l63.44"></a><span id="l63.44">           if (popup.allowevents) {</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l64.1"></a><span id="l64.1" class="difflineminus">--- a/mail/test/resources/mozmill/mozmill/extension/resource/modules/elementslib.js</span>
<a href="#l64.2"></a><span id="l64.2" class="difflineplus">+++ b/mail/test/resources/mozmill/mozmill/extension/resource/modules/elementslib.js</span>
<a href="#l64.3"></a><span id="l64.3" class="difflineat">@@ -307,28 +307,28 @@ var _returnResult = function (results) {</span>
<a href="#l64.4"></a><span id="l64.4">   } else if (results.length == 1) {</span>
<a href="#l64.5"></a><span id="l64.5">     return results[0];</span>
<a href="#l64.6"></a><span id="l64.6">   } else {</span>
<a href="#l64.7"></a><span id="l64.7">     return results;</span>
<a href="#l64.8"></a><span id="l64.8">   }</span>
<a href="#l64.9"></a><span id="l64.9"> }</span>
<a href="#l64.10"></a><span id="l64.10"> var _forChildren = function (element, name, value) {</span>
<a href="#l64.11"></a><span id="l64.11">   var results = [];</span>
<a href="#l64.12"></a><span id="l64.12" class="difflineminus">-  var nodes = [e for each (e in element.childNodes) if (e)]</span>
<a href="#l64.13"></a><span id="l64.13" class="difflineplus">+  var nodes = Array.from(element.childNodes).filter(e =&gt; e);</span>
<a href="#l64.14"></a><span id="l64.14">   for (var i in nodes) {</span>
<a href="#l64.15"></a><span id="l64.15">     var n = nodes[i];</span>
<a href="#l64.16"></a><span id="l64.16">     if (n[name] == value) {</span>
<a href="#l64.17"></a><span id="l64.17">       results.push(n);</span>
<a href="#l64.18"></a><span id="l64.18">     }</span>
<a href="#l64.19"></a><span id="l64.19">   }</span>
<a href="#l64.20"></a><span id="l64.20">   return results;</span>
<a href="#l64.21"></a><span id="l64.21"> }</span>
<a href="#l64.22"></a><span id="l64.22"> var _forAnonChildren = function (_document, element, name, value) {</span>
<a href="#l64.23"></a><span id="l64.23">   var results = [];</span>
<a href="#l64.24"></a><span id="l64.24" class="difflineminus">-  var nodes = [e for each (e in _document.getAnoymousNodes(element)) if (e)];</span>
<a href="#l64.25"></a><span id="l64.25" class="difflineplus">+  var nodes = Array.from(_document.getAnoymousNodes(element)).filter(e =&gt; e);</span>
<a href="#l64.26"></a><span id="l64.26">   for (var i in nodes ) {</span>
<a href="#l64.27"></a><span id="l64.27">     var n = nodes[i];</span>
<a href="#l64.28"></a><span id="l64.28">     if (n[name] == value) {</span>
<a href="#l64.29"></a><span id="l64.29">       results.push(n);</span>
<a href="#l64.30"></a><span id="l64.30">     }</span>
<a href="#l64.31"></a><span id="l64.31">   }</span>
<a href="#l64.32"></a><span id="l64.32">   return results;</span>
<a href="#l64.33"></a><span id="l64.33"> }</span>
<a href="#l64.34"></a><span id="l64.34" class="difflineat">@@ -370,17 +370,17 @@ var _byAnonAttrib = function (_document,</span>
<a href="#l64.35"></a><span id="l64.35">   if (objects.getLength(attributes) == 1) {</span>
<a href="#l64.36"></a><span id="l64.36">     for (var i in attributes) {var k = i; var v = attributes[i]; }</span>
<a href="#l64.37"></a><span id="l64.37">     var result = _document.getAnonymousElementByAttribute(parent, k, v)</span>
<a href="#l64.38"></a><span id="l64.38">     if (result) {</span>
<a href="#l64.39"></a><span id="l64.39">       return result;</span>
<a href="#l64.40"></a><span id="l64.40"> </span>
<a href="#l64.41"></a><span id="l64.41">     }</span>
<a href="#l64.42"></a><span id="l64.42">   }</span>
<a href="#l64.43"></a><span id="l64.43" class="difflineminus">-  var nodes = [n for each (n in _document.getAnonymousNodes(parent)) if (n.getAttribute)];</span>
<a href="#l64.44"></a><span id="l64.44" class="difflineplus">+  var nodes = Array.from(_document.getAnonymousNodes(parent)).filter(n =&gt; n.getAttribute);</span>
<a href="#l64.45"></a><span id="l64.45">   function resultsForNodes (nodes) {</span>
<a href="#l64.46"></a><span id="l64.46">     for (var i in nodes) {</span>
<a href="#l64.47"></a><span id="l64.47">       var n = nodes[i];</span>
<a href="#l64.48"></a><span id="l64.48">       requirementPass = 0;</span>
<a href="#l64.49"></a><span id="l64.49">       requirementLength = 0;</span>
<a href="#l64.50"></a><span id="l64.50">       for (var a in attributes) {</span>
<a href="#l64.51"></a><span id="l64.51">         requirementLength++;</span>
<a href="#l64.52"></a><span id="l64.52">         if (n.getAttribute(a) == attributes[a]) {</span>
<a href="#l64.53"></a><span id="l64.53" class="difflineat">@@ -389,17 +389,17 @@ var _byAnonAttrib = function (_document,</span>
<a href="#l64.54"></a><span id="l64.54">       }</span>
<a href="#l64.55"></a><span id="l64.55">       if (requirementPass == requirementLength) {</span>
<a href="#l64.56"></a><span id="l64.56">         results.push(n);</span>
<a href="#l64.57"></a><span id="l64.57">       }</span>
<a href="#l64.58"></a><span id="l64.58">     }</span>
<a href="#l64.59"></a><span id="l64.59">   }</span>
<a href="#l64.60"></a><span id="l64.60">   resultsForNodes(nodes)</span>
<a href="#l64.61"></a><span id="l64.61">   if (results.length == 0) {</span>
<a href="#l64.62"></a><span id="l64.62" class="difflineminus">-    resultsForNodes([n for each (n in parent.childNodes) if (n != undefined &amp;&amp; n.getAttribute)])</span>
<a href="#l64.63"></a><span id="l64.63" class="difflineplus">+    resultsForNodes(Array.from(parent.childNodes).filter(n =&gt; n != undefined &amp;&amp; n.getAttribute));</span>
<a href="#l64.64"></a><span id="l64.64">   }</span>
<a href="#l64.65"></a><span id="l64.65">   return _returnResult(results)</span>
<a href="#l64.66"></a><span id="l64.66"> }</span>
<a href="#l64.67"></a><span id="l64.67"> var _byIndex = function (_document, parent, i) {</span>
<a href="#l64.68"></a><span id="l64.68">   return parent.childNodes[i];</span>
<a href="#l64.69"></a><span id="l64.69"> }</span>
<a href="#l64.70"></a><span id="l64.70"> var _anonByName = function (_document, parent, value) {</span>
<a href="#l64.71"></a><span id="l64.71">   return _returnResult(_forAnonChildren(_document, parent, 'tagName', value));</span>
<a href="#l64.72"></a><span id="l64.72" class="difflineat">@@ -421,17 +421,17 @@ Lookup.prototype.exists = function () {</span>
<a href="#l64.73"></a><span id="l64.73">     return false;</span>
<a href="#l64.74"></a><span id="l64.74">   }</span>
<a href="#l64.75"></a><span id="l64.75">   if (e) {</span>
<a href="#l64.76"></a><span id="l64.76">     return true;</span>
<a href="#l64.77"></a><span id="l64.77">   }</span>
<a href="#l64.78"></a><span id="l64.78">   return false;</span>
<a href="#l64.79"></a><span id="l64.79"> }</span>
<a href="#l64.80"></a><span id="l64.80"> Lookup.prototype.getNode = function () {</span>
<a href="#l64.81"></a><span id="l64.81" class="difflineminus">-  var expSplit = [e for each (e in smartSplit(this.expression) ) if (e != '')];</span>
<a href="#l64.82"></a><span id="l64.82" class="difflineplus">+  var expSplit = smartSplit(this.expression).filter(e =&gt; e != '');</span>
<a href="#l64.83"></a><span id="l64.83">   expSplit.unshift(this._view.document)</span>
<a href="#l64.84"></a><span id="l64.84">   _document = this._view.document;</span>
<a href="#l64.85"></a><span id="l64.85">   var nCases = {'id':_byID, 'name':_byName, 'attrib':_byAttrib, 'index':_byIndex};</span>
<a href="#l64.86"></a><span id="l64.86">   var aCases = {'name':_anonByName, 'attrib':_anonByAttrib, 'index':_anonByIndex};</span>
<a href="#l64.87"></a><span id="l64.87">   var reduceLookup = function (parent, exp) {</span>
<a href="#l64.88"></a><span id="l64.88">     // Handle case where only index is provided</span>
<a href="#l64.89"></a><span id="l64.89">     var cases = nCases;</span>
<a href="#l64.90"></a><span id="l64.90"> </span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l65.1"></a><span id="l65.1" class="difflineminus">--- a/mail/test/resources/mozmill/mozmill/extension/resource/modules/frame.js</span>
<a href="#l65.2"></a><span id="l65.2" class="difflineplus">+++ b/mail/test/resources/mozmill/mozmill/extension/resource/modules/frame.js</span>
<a href="#l65.3"></a><span id="l65.3" class="difflineat">@@ -230,17 +230,17 @@ events.endTest = function (test) {</span>
<a href="#l65.4"></a><span id="l65.4"> events.setModule = function (v) {</span>
<a href="#l65.5"></a><span id="l65.5">   return stateChangeBase( null, [function (v) {return (v.__file__ != undefined)}],</span>
<a href="#l65.6"></a><span id="l65.6">                           'currentModule', 'setModule', v);</span>
<a href="#l65.7"></a><span id="l65.7"> }</span>
<a href="#l65.8"></a><span id="l65.8"> events.pass = function (obj) {</span>
<a href="#l65.9"></a><span id="l65.9">   if (events.currentTest) {</span>
<a href="#l65.10"></a><span id="l65.10">     events.currentTest.__passes__.push(obj);</span>
<a href="#l65.11"></a><span id="l65.11">   }</span>
<a href="#l65.12"></a><span id="l65.12" class="difflineminus">-  for each(var timer in timers) {</span>
<a href="#l65.13"></a><span id="l65.13" class="difflineplus">+  for (var timer of timers) {</span>
<a href="#l65.14"></a><span id="l65.14">     timer.actions.push(</span>
<a href="#l65.15"></a><span id="l65.15">       {&quot;currentTest&quot;:events.currentModule.__file__+&quot;::&quot;+events.currentTest.__name__, &quot;obj&quot;:obj,</span>
<a href="#l65.16"></a><span id="l65.16">        &quot;result&quot;:&quot;pass&quot;}</span>
<a href="#l65.17"></a><span id="l65.17">     );</span>
<a href="#l65.18"></a><span id="l65.18">   }</span>
<a href="#l65.19"></a><span id="l65.19">   events.fireEvent('pass', obj);</span>
<a href="#l65.20"></a><span id="l65.20"> }</span>
<a href="#l65.21"></a><span id="l65.21"> events.fail = function (obj) {</span>
<a href="#l65.22"></a><span id="l65.22" class="difflineat">@@ -254,45 +254,45 @@ events.fail = function (obj) {</span>
<a href="#l65.23"></a><span id="l65.23">       fileName: error.fileName,</span>
<a href="#l65.24"></a><span id="l65.24">       stack: error.stack</span>
<a href="#l65.25"></a><span id="l65.25">     };</span>
<a href="#l65.26"></a><span id="l65.26">   }</span>
<a href="#l65.27"></a><span id="l65.27">   // a low level event, such as a keystroke, fails</span>
<a href="#l65.28"></a><span id="l65.28">   if (events.currentTest) {</span>
<a href="#l65.29"></a><span id="l65.29">     events.currentTest.__fails__.push(obj);</span>
<a href="#l65.30"></a><span id="l65.30">   }</span>
<a href="#l65.31"></a><span id="l65.31" class="difflineminus">-  for each(var time in timers) {</span>
<a href="#l65.32"></a><span id="l65.32" class="difflineplus">+  for (var time of timers) {</span>
<a href="#l65.33"></a><span id="l65.33">     timer.actions.push(</span>
<a href="#l65.34"></a><span id="l65.34">       {&quot;currentTest&quot;:events.currentModule.__file__+&quot;::&quot;+events.currentTest.__name__, &quot;obj&quot;:obj,</span>
<a href="#l65.35"></a><span id="l65.35">        &quot;result&quot;:&quot;fail&quot;}</span>
<a href="#l65.36"></a><span id="l65.36">     );</span>
<a href="#l65.37"></a><span id="l65.37">   }</span>
<a href="#l65.38"></a><span id="l65.38">   events.fireEvent('fail', obj);</span>
<a href="#l65.39"></a><span id="l65.39"> }</span>
<a href="#l65.40"></a><span id="l65.40"> events.skip = function (reason) {</span>
<a href="#l65.41"></a><span id="l65.41">   events.currentTest.skipped = true;</span>
<a href="#l65.42"></a><span id="l65.42">   events.currentTest.skipped_reason = reason;</span>
<a href="#l65.43"></a><span id="l65.43" class="difflineminus">-  for each(var timer in timers) {</span>
<a href="#l65.44"></a><span id="l65.44" class="difflineplus">+  for (var timer of timers) {</span>
<a href="#l65.45"></a><span id="l65.45">     timer.actions.push(</span>
<a href="#l65.46"></a><span id="l65.46">       {&quot;currentTest&quot;:events.currentModule.__file__+&quot;::&quot;+events.currentTest.__name__, &quot;obj&quot;:reason,</span>
<a href="#l65.47"></a><span id="l65.47">        &quot;result&quot;:&quot;skip&quot;}</span>
<a href="#l65.48"></a><span id="l65.48">     );</span>
<a href="#l65.49"></a><span id="l65.49">   }</span>
<a href="#l65.50"></a><span id="l65.50">   events.fireEvent('skip', reason);</span>
<a href="#l65.51"></a><span id="l65.51"> }</span>
<a href="#l65.52"></a><span id="l65.52"> events.fireEvent = function (name, obj) {</span>
<a href="#l65.53"></a><span id="l65.53">   if (events.currentTest &amp;&amp; name == &quot;firePythonCallback&quot; &amp;&amp; events.currentTest.__invokedFromIDE__) {</span>
<a href="#l65.54"></a><span id="l65.54">     throw new Error(&quot;tests that use firePythonCallback cannot be run from the IDE\n&quot;);</span>
<a href="#l65.55"></a><span id="l65.55">   }</span>
<a href="#l65.56"></a><span id="l65.56">   if (this.listeners[name]) {</span>
<a href="#l65.57"></a><span id="l65.57">     for (var i in this.listeners[name]) {</span>
<a href="#l65.58"></a><span id="l65.58">       this.listeners[name][i](obj);</span>
<a href="#l65.59"></a><span id="l65.59">     }</span>
<a href="#l65.60"></a><span id="l65.60">   }</span>
<a href="#l65.61"></a><span id="l65.61" class="difflineminus">-  for each(var listener in this.globalListeners) {</span>
<a href="#l65.62"></a><span id="l65.62" class="difflineplus">+  for (var listener of this.globalListeners) {</span>
<a href="#l65.63"></a><span id="l65.63">     listener(name, obj);</span>
<a href="#l65.64"></a><span id="l65.64">   }</span>
<a href="#l65.65"></a><span id="l65.65"> }</span>
<a href="#l65.66"></a><span id="l65.66"> events.globalListeners = [];</span>
<a href="#l65.67"></a><span id="l65.67"> events.addListener = function (name, listener) {</span>
<a href="#l65.68"></a><span id="l65.68">   if (this.listeners[name]) {</span>
<a href="#l65.69"></a><span id="l65.69">     this.listeners[name].push(listener);</span>
<a href="#l65.70"></a><span id="l65.70">   } else if (name =='') {</span>
<a href="#l65.71"></a><span id="l65.71" class="difflineat">@@ -446,17 +446,17 @@ Collector.prototype.initTestModule = fun</span>
<a href="#l65.72"></a><span id="l65.72">     }</span>
<a href="#l65.73"></a><span id="l65.73">     if (i == &quot;MODULE_NAME&quot;) {</span>
<a href="#l65.74"></a><span id="l65.74">       test_module.__module_name__ = test_module[i];</span>
<a href="#l65.75"></a><span id="l65.75">       this.test_modules_by_name[test_module[i]] = test_module;</span>
<a href="#l65.76"></a><span id="l65.76">     }</span>
<a href="#l65.77"></a><span id="l65.77">   }</span>
<a href="#l65.78"></a><span id="l65.78"> </span>
<a href="#l65.79"></a><span id="l65.79">   if (test_module.MODULE_REQUIRES != undefined &amp;&amp; test_module.RELATIVE_ROOT == undefined) {</span>
<a href="#l65.80"></a><span id="l65.80" class="difflineminus">-    for each(var t in test_module.__tests__) {</span>
<a href="#l65.81"></a><span id="l65.81" class="difflineplus">+    for (var t of test_module.__tests__) {</span>
<a href="#l65.82"></a><span id="l65.82">       t.__force_skip__ = &quot;RELATIVE ROOT is not defined and test requires another module.&quot;;</span>
<a href="#l65.83"></a><span id="l65.83">     }</span>
<a href="#l65.84"></a><span id="l65.84">   }</span>
<a href="#l65.85"></a><span id="l65.85"> </span>
<a href="#l65.86"></a><span id="l65.86">   test_module.collector = this;</span>
<a href="#l65.87"></a><span id="l65.87">   test_module.status = 'loaded';</span>
<a href="#l65.88"></a><span id="l65.88">   this.test_modules_by_filename[filename] = test_module;</span>
<a href="#l65.89"></a><span id="l65.89"> </span>
<a href="#l65.90"></a><span id="l65.90" class="difflineat">@@ -604,17 +604,17 @@ Runner.prototype.wrapper = function (fun</span>
<a href="#l65.91"></a><span id="l65.91">       events.fail({'exception': e, 'test':func})</span>
<a href="#l65.92"></a><span id="l65.92">       Components.utils.reportError(e);</span>
<a href="#l65.93"></a><span id="l65.93">     }</span>
<a href="#l65.94"></a><span id="l65.94">   }</span>
<a href="#l65.95"></a><span id="l65.95"> }</span>
<a href="#l65.96"></a><span id="l65.96"> </span>
<a href="#l65.97"></a><span id="l65.97"> Runner.prototype._runTestModule = function (module) {</span>
<a href="#l65.98"></a><span id="l65.98">   if (module.__requirements__ != undefined &amp;&amp; module.__force_skip__ == undefined) {</span>
<a href="#l65.99"></a><span id="l65.99" class="difflineminus">-    for each(var req in module.__requirements__) {</span>
<a href="#l65.100"></a><span id="l65.100" class="difflineplus">+    for (var req of module.__requirements__) {</span>
<a href="#l65.101"></a><span id="l65.101">       module[req] = this.collector.getModule(req);</span>
<a href="#l65.102"></a><span id="l65.102">     }</span>
<a href="#l65.103"></a><span id="l65.103">   }</span>
<a href="#l65.104"></a><span id="l65.104"> </span>
<a href="#l65.105"></a><span id="l65.105">   var attrs = [];</span>
<a href="#l65.106"></a><span id="l65.106">   for (var i in module) {</span>
<a href="#l65.107"></a><span id="l65.107">     attrs.push(i);</span>
<a href="#l65.108"></a><span id="l65.108">   }</span>
<a href="#l65.109"></a><span id="l65.109" class="difflineat">@@ -660,17 +660,17 @@ Runner.prototype._runTestModule = functi</span>
<a href="#l65.110"></a><span id="l65.110">         events.setState('teardownTest');</span>
<a href="#l65.111"></a><span id="l65.111">         events.setTest(module.__teardownTest__);</span>
<a href="#l65.112"></a><span id="l65.112">         this.wrapper(module.__teardownTest__, test);</span>
<a href="#l65.113"></a><span id="l65.113">         events.endTest(module.__teardownTest__);</span>
<a href="#l65.114"></a><span id="l65.114">       }</span>
<a href="#l65.115"></a><span id="l65.115">       events.endTest(test)</span>
<a href="#l65.116"></a><span id="l65.116">     }</span>
<a href="#l65.117"></a><span id="l65.117">   } else {</span>
<a href="#l65.118"></a><span id="l65.118" class="difflineminus">-    for each(var test in module.__tests__) {</span>
<a href="#l65.119"></a><span id="l65.119" class="difflineplus">+    for (var test of module.__tests__) {</span>
<a href="#l65.120"></a><span id="l65.120">       events.setTest(test);</span>
<a href="#l65.121"></a><span id="l65.121">       events.skip(&quot;setupModule failed.&quot;);</span>
<a href="#l65.122"></a><span id="l65.122">       events.endTest(test);</span>
<a href="#l65.123"></a><span id="l65.123">     }</span>
<a href="#l65.124"></a><span id="l65.124">   }</span>
<a href="#l65.125"></a><span id="l65.125">   if (module.__teardownModule__) {</span>
<a href="#l65.126"></a><span id="l65.126">     events.setState('teardownModule');</span>
<a href="#l65.127"></a><span id="l65.127">     events.setTest(module.__teardownModule__);</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l66.1"></a><span id="l66.1" class="difflineminus">--- a/mail/test/resources/mozmill/mozmill/extension/resource/modules/inspection.js</span>
<a href="#l66.2"></a><span id="l66.2" class="difflineplus">+++ b/mail/test/resources/mozmill/mozmill/extension/resource/modules/inspection.js</span>
<a href="#l66.3"></a><span id="l66.3" class="difflineat">@@ -188,19 +188,18 @@ var getLookupForElem = function (_docume</span>
<a href="#l66.4"></a><span id="l66.4">     if (identifier) {</span>
<a href="#l66.5"></a><span id="l66.5">       var result = {'id':elementslib._byID, 'name':elementslib._byName}[identifier.name](_document, elem.parentNode, identifier.value);</span>
<a href="#l66.6"></a><span id="l66.6">       if ( typeof(result != 'array') ) {</span>
<a href="#l66.7"></a><span id="l66.7">         return identifier.name+'('+json2.JSON.stringify(identifier.value)+')';</span>
<a href="#l66.8"></a><span id="l66.8">       }</span>
<a href="#l66.9"></a><span id="l66.9">     }</span>
<a href="#l66.10"></a><span id="l66.10"> </span>
<a href="#l66.11"></a><span id="l66.11">     // At this point there is either no identifier or it returns multiple</span>
<a href="#l66.12"></a><span id="l66.12" class="difflineminus">-    var parse = [n for each (n in elem.parentNode.childNodes) if</span>
<a href="#l66.13"></a><span id="l66.13" class="difflineminus">-                 (n.getAttribute &amp;&amp; n != elem)</span>
<a href="#l66.14"></a><span id="l66.14" class="difflineminus">-                 ];</span>
<a href="#l66.15"></a><span id="l66.15" class="difflineplus">+    var parse = Array.from(elem.parentNode.childNodes).</span>
<a href="#l66.16"></a><span id="l66.16" class="difflineplus">+      filter(n =&gt; n.getAttribute &amp;&amp; n != elem);</span>
<a href="#l66.17"></a><span id="l66.17">     parse.unshift(dom.getAttributes(elem));</span>
<a href="#l66.18"></a><span id="l66.18">     var uniqueAttributes = parse.reduce(getUniqueAttributesReduction);</span>
<a href="#l66.19"></a><span id="l66.19"> </span>
<a href="#l66.20"></a><span id="l66.20">     if (!result) {</span>
<a href="#l66.21"></a><span id="l66.21">       var result = elementslib._byAttrib(elem.parentNode, uniqueAttributes);</span>
<a href="#l66.22"></a><span id="l66.22">     }</span>
<a href="#l66.23"></a><span id="l66.23"> </span>
<a href="#l66.24"></a><span id="l66.24">     if (!identifier &amp;&amp; typeof(result) == 'array' ) {</span>
<a href="#l66.25"></a><span id="l66.25" class="difflineat">@@ -216,19 +215,18 @@ var getLookupForElem = function (_docume</span>
<a href="#l66.26"></a><span id="l66.26">         return json2.JSON.stringify(uniqueAttributes) + '['+arrays.indexOf(aresult, elem)+']'</span>
<a href="#l66.27"></a><span id="l66.27">       } else {</span>
<a href="#l66.28"></a><span id="l66.28">         return identifier.name+'('+json2.JSON.stringify(identifier.value)+')' + '['+arrays.indexOf(result, elem)+']'</span>
<a href="#l66.29"></a><span id="l66.29">       }</span>
<a href="#l66.30"></a><span id="l66.30">     }</span>
<a href="#l66.31"></a><span id="l66.31"> </span>
<a href="#l66.32"></a><span id="l66.32">   } else {</span>
<a href="#l66.33"></a><span id="l66.33">     // Handle Anonymous Nodes</span>
<a href="#l66.34"></a><span id="l66.34" class="difflineminus">-    var parse = [n for each (n in _document.getAnonymousNodes(elem.parentNode)) if</span>
<a href="#l66.35"></a><span id="l66.35" class="difflineminus">-                 (n.getAttribute &amp;&amp; n != elem)</span>
<a href="#l66.36"></a><span id="l66.36" class="difflineminus">-                 ];</span>
<a href="#l66.37"></a><span id="l66.37" class="difflineplus">+    var parse = Array.from(_document.getAnonymousNodes(elem.parentNode)).</span>
<a href="#l66.38"></a><span id="l66.38" class="difflineplus">+      filter(n =&gt; n.getAttribute &amp;&amp; n != elem);</span>
<a href="#l66.39"></a><span id="l66.39">     parse.unshift(dom.getAttributes(elem));</span>
<a href="#l66.40"></a><span id="l66.40">     var uniqueAttributes = parse.reduce(getUniqueAttributesReduction);</span>
<a href="#l66.41"></a><span id="l66.41">     if (uniqueAttributes.anonid &amp;&amp; typeof(elementslib._byAnonAttrib(_document,</span>
<a href="#l66.42"></a><span id="l66.42">         elem.parentNode, {'anonid':uniqueAttributes.anonid})) != 'array') {</span>
<a href="#l66.43"></a><span id="l66.43">       uniqueAttributes = {'anonid':uniqueAttributes.anonid};</span>
<a href="#l66.44"></a><span id="l66.44">     }</span>
<a href="#l66.45"></a><span id="l66.45"> </span>
<a href="#l66.46"></a><span id="l66.46">     if (objects.getLength(uniqueAttributes) == 0) {</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l67.1"></a><span id="l67.1" class="difflineminus">--- a/mail/test/resources/mozmill/mozmill/extension/resource/modules/utils.js</span>
<a href="#l67.2"></a><span id="l67.2" class="difflineplus">+++ b/mail/test/resources/mozmill/mozmill/extension/resource/modules/utils.js</span>
<a href="#l67.3"></a><span id="l67.3" class="difflineat">@@ -84,26 +84,26 @@ function getWindows(type) {</span>
<a href="#l67.4"></a><span id="l67.4">   }</span>
<a href="#l67.5"></a><span id="l67.5">   if (type == &quot;&quot;) {</span>
<a href="#l67.6"></a><span id="l67.6">     windows.push(hwindow);</span>
<a href="#l67.7"></a><span id="l67.7">   }</span>
<a href="#l67.8"></a><span id="l67.8">   return windows;</span>
<a href="#l67.9"></a><span id="l67.9"> }</span>
<a href="#l67.10"></a><span id="l67.10"> </span>
<a href="#l67.11"></a><span id="l67.11"> function getMethodInWindows (methodName) {</span>
<a href="#l67.12"></a><span id="l67.12" class="difflineminus">-  for each(w in getWindows()) {</span>
<a href="#l67.13"></a><span id="l67.13" class="difflineplus">+  for (var w of getWindows()) {</span>
<a href="#l67.14"></a><span id="l67.14">     if (w[methodName] != undefined) {</span>
<a href="#l67.15"></a><span id="l67.15">       return w[methodName];</span>
<a href="#l67.16"></a><span id="l67.16">     }</span>
<a href="#l67.17"></a><span id="l67.17">   }</span>
<a href="#l67.18"></a><span id="l67.18">   throw new Error(&quot;Method with name: '&quot; + methodName + &quot;' is not in any open window.&quot;);</span>
<a href="#l67.19"></a><span id="l67.19"> }</span>
<a href="#l67.20"></a><span id="l67.20"> </span>
<a href="#l67.21"></a><span id="l67.21"> function getWindowByTitle(title) {</span>
<a href="#l67.22"></a><span id="l67.22" class="difflineminus">-  for each(w in getWindows()) {</span>
<a href="#l67.23"></a><span id="l67.23" class="difflineplus">+  for (var w of getWindows()) {</span>
<a href="#l67.24"></a><span id="l67.24">     if (w.document.title &amp;&amp; w.document.title == title) {</span>
<a href="#l67.25"></a><span id="l67.25">       return w;</span>
<a href="#l67.26"></a><span id="l67.26">     }</span>
<a href="#l67.27"></a><span id="l67.27">   }</span>
<a href="#l67.28"></a><span id="l67.28"> }</span>
<a href="#l67.29"></a><span id="l67.29"> </span>
<a href="#l67.30"></a><span id="l67.30"> function getWindowByType(type) {</span>
<a href="#l67.31"></a><span id="l67.31">   var wm = Components.classes[&quot;@mozilla.org/appshell/window-mediator;1&quot;]</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l68.1"></a><span id="l68.1" class="difflineminus">--- a/mail/test/resources/mozmill/mozmill/extension/resource/stdlib/os.js</span>
<a href="#l68.2"></a><span id="l68.2" class="difflineplus">+++ b/mail/test/resources/mozmill/mozmill/extension/resource/stdlib/os.js</span>
<a href="#l68.3"></a><span id="l68.3" class="difflineat">@@ -57,17 +57,17 @@ function getFileForPath (path) {</span>
<a href="#l68.4"></a><span id="l68.4">   return file;</span>
<a href="#l68.5"></a><span id="l68.5"> }</span>
<a href="#l68.6"></a><span id="l68.6"> </span>
<a href="#l68.7"></a><span id="l68.7"> function abspath (rel, file) {</span>
<a href="#l68.8"></a><span id="l68.8">   var relSplit = rel.split('/');</span>
<a href="#l68.9"></a><span id="l68.9">   if (relSplit[0] == '..' &amp;&amp; !file.isDirectory()) {</span>
<a href="#l68.10"></a><span id="l68.10">     file = file.parent;</span>
<a href="#l68.11"></a><span id="l68.11">   }</span>
<a href="#l68.12"></a><span id="l68.12" class="difflineminus">-  for each(p in relSplit) {</span>
<a href="#l68.13"></a><span id="l68.13" class="difflineplus">+  for (var p of relSplit) {</span>
<a href="#l68.14"></a><span id="l68.14">     if (p == '..') {</span>
<a href="#l68.15"></a><span id="l68.15">       file = file.parent;</span>
<a href="#l68.16"></a><span id="l68.16">     } else if (p == '.'){</span>
<a href="#l68.17"></a><span id="l68.17">       if (!file.isDirectory()) {</span>
<a href="#l68.18"></a><span id="l68.18">         file = file.parent;</span>
<a href="#l68.19"></a><span id="l68.19">       }</span>
<a href="#l68.20"></a><span id="l68.20">     } else {</span>
<a href="#l68.21"></a><span id="l68.21">       file.append(p);</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l69.1"></a><span id="l69.1" class="difflineminus">--- a/mail/test/resources/mozmill/mozmill/extension/resource/stdlib/securable-module.js</span>
<a href="#l69.2"></a><span id="l69.2" class="difflineplus">+++ b/mail/test/resources/mozmill/mozmill/extension/resource/stdlib/securable-module.js</span>
<a href="#l69.3"></a><span id="l69.3" class="difflineat">@@ -166,18 +166,17 @@</span>
<a href="#l69.4"></a><span id="l69.4"> </span>
<a href="#l69.5"></a><span id="l69.5">    exports.Loader = function Loader(options) {</span>
<a href="#l69.6"></a><span id="l69.6">      options = {__proto__: options};</span>
<a href="#l69.7"></a><span id="l69.7">      if (options.fs === undefined) {</span>
<a href="#l69.8"></a><span id="l69.8">        var rootPaths = options.rootPath || options.rootPaths;</span>
<a href="#l69.9"></a><span id="l69.9">        if (rootPaths) {</span>
<a href="#l69.10"></a><span id="l69.10">          if (rootPaths.constructor.name != &quot;Array&quot;)</span>
<a href="#l69.11"></a><span id="l69.11">            rootPaths = [rootPaths];</span>
<a href="#l69.12"></a><span id="l69.12" class="difflineminus">-         var fses = [new exports.LocalFileSystem(path)</span>
<a href="#l69.13"></a><span id="l69.13" class="difflineminus">-                     for each (path in rootPaths)];</span>
<a href="#l69.14"></a><span id="l69.14" class="difflineplus">+         var fses = rootPaths.map(path =&gt; new exports.LocalFileSystem(path));</span>
<a href="#l69.15"></a><span id="l69.15">          options.fs = new exports.CompositeFileSystem(fses);</span>
<a href="#l69.16"></a><span id="l69.16">        } else</span>
<a href="#l69.17"></a><span id="l69.17">          options.fs = new exports.LocalFileSystem();</span>
<a href="#l69.18"></a><span id="l69.18">      }</span>
<a href="#l69.19"></a><span id="l69.19">      if (options.sandboxFactory === undefined)</span>
<a href="#l69.20"></a><span id="l69.20">        options.sandboxFactory = new exports.SandboxFactory(</span>
<a href="#l69.21"></a><span id="l69.21">          options.defaultPrincipal</span>
<a href="#l69.22"></a><span id="l69.22">        );</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l70.1"></a><span id="l70.1" class="difflineminus">--- a/mail/test/resources/mozmill/test/test_waitForPageLoad.js</span>
<a href="#l70.2"></a><span id="l70.2" class="difflineplus">+++ b/mail/test/resources/mozmill/test/test_waitForPageLoad.js</span>
<a href="#l70.3"></a><span id="l70.3" class="difflineat">@@ -18,17 +18,17 @@ var setupTest = function() {</span>
<a href="#l70.4"></a><span id="l70.4">   controller = mozmill.getBrowserController();</span>
<a href="#l70.5"></a><span id="l70.5"> }</span>
<a href="#l70.6"></a><span id="l70.6"> </span>
<a href="#l70.7"></a><span id="l70.7"> var testWaitForPageLoad = function() {</span>
<a href="#l70.8"></a><span id="l70.8"> </span>
<a href="#l70.9"></a><span id="l70.9">   /**</span>
<a href="#l70.10"></a><span id="l70.10">    * PART I - Check different types of pages</span>
<a href="#l70.11"></a><span id="l70.11">    */</span>
<a href="#l70.12"></a><span id="l70.12" class="difflineminus">-  for each (var location in LOCATIONS) {</span>
<a href="#l70.13"></a><span id="l70.13" class="difflineplus">+  for (var location of LOCATIONS) {</span>
<a href="#l70.14"></a><span id="l70.14">     controller.open(location.url);</span>
<a href="#l70.15"></a><span id="l70.15">     controller.waitForPageLoad();</span>
<a href="#l70.16"></a><span id="l70.16"> </span>
<a href="#l70.17"></a><span id="l70.17">     // Check that the expected element exists</span>
<a href="#l70.18"></a><span id="l70.18">     if (location.type) {</span>
<a href="#l70.19"></a><span id="l70.19">       var elem = null;</span>
<a href="#l70.20"></a><span id="l70.20"> </span>
<a href="#l70.21"></a><span id="l70.21">       switch (location.type) {</span></pre></div></div>

<div class="page_footer">
<div class="page_footer_text">comm-central</div>
<div class="page_footer_text" style="padding-left: 10px">Deployed from <a href="https://hg.mozilla.org/hgcustom/version-control-tools/rev/35f393d6769a">35f393d6769a</a> at 2020-07-16T17:23:43Z.</div>
<div class="rss_logo">
<a href="/comm-central/rss-log">RSS</a>
<a href="/comm-central/atom-log">Atom</a>
</div>
<br />

</div>
</body>
</html>

