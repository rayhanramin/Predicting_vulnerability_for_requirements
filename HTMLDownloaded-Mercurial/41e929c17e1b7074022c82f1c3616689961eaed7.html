<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en-US" lang="en-US">
<head>
<link rel="icon" href="/static/4b0de666d1a4/hgicon.png" type="image/png" />
<meta name="robots" content="index, nofollow"/>
<link rel="stylesheet" href="/static/4b0de666d1a4/style-gitweb.css" type="text/css" />

<style type="text/css">
div.feed {
  float: right;
}
a img {
  border-width: 0px;
}
div.log_link {
  width: 80px;
  background-color: white;
}

div.log_body {
  padding-left: 96px;
}
</style>
<script type="text/javascript" src="/static/4b0de666d1a4/mercurial.js"></script>

<meta property="og:image" content="/static/4b0de666d1a4/moz-logo-bw-rgb.svg"/>
<meta property="og:type" content="website"/>

<title>comm-central: changeset 29719:41e929c17e1b7074022c82f1c3616689961eaed7</title>
<link rel="alternate" type="application/atom+xml"
   href="/comm-central/atom-log" title="Atom feed for comm-central"/>
<link rel="alternate" type="application/rss+xml"
   href="/comm-central/rss-log" title="RSS feed for comm-central"/>

<meta property="og:title" content="comm-central @ 41e929c17e1b7074022c82f1c3616689961eaed7" />
<meta property="og:url" content="/comm-central/rev/41e929c17e1b7074022c82f1c3616689961eaed7" />
<meta property="og:description" content="Bug 546932 - Add UI (preffed-off) for creating a CardDAV address book. r=mkmelin" />

</head>
<body>

<div class="page_header">
<div class="logo">
    <a href="https://developer.mozilla.org/en/docs/Mercurial">
        <img src="/static/4b0de666d1a4/moz-logo-bw-rgb.svg" alt="mercurial" />
    </a>
</div>
<a href="/">Mercurial</a> &gt; <a href="/comm-central">comm-central</a>  / changeset / 41e929c17e1b7074022c82f1c3616689961eaed7 
</div>

<div class="page_nav">
<div>
<a href="/comm-central/summary">summary</a> |
<a href="/comm-central/shortlog/41e929c17e1b7074022c82f1c3616689961eaed7">shortlog</a> |
<a href="/comm-central/log/41e929c17e1b7074022c82f1c3616689961eaed7">changelog</a> |
<a href="/comm-central/pushloghtml">pushlog</a> |
<a href="/comm-central/graph/41e929c17e1b7074022c82f1c3616689961eaed7">graph</a> |
<a href="/comm-central/tags">tags</a> |
<a href="/comm-central/bookmarks">bookmarks</a> |
<a href="/comm-central/branches">branches</a> |
<a href="/comm-central/file/41e929c17e1b7074022c82f1c3616689961eaed7">files</a> |
changeset |
<a href="/comm-central/raw-rev/41e929c17e1b7074022c82f1c3616689961eaed7">raw</a>  | <a href="/comm-central/archive/41e929c17e1b7074022c82f1c3616689961eaed7.zip">zip</a>  |
<a href="/comm-central/help">help</a>
</div>

<div class="search">
<form id="searchform" action="/comm-central/log">

<input name="rev" type="text" value="" size="40" />
<div id="hint">Find changesets by keywords (author, files, the commit message), revision
number or hash, or <a href="/comm-central/help/revsets">revset expression</a>.</div>
</form>
</div>
</div>

<div class="title">
<a href="https://bugzilla.mozilla.org/show_bug.cgi?id=546932">Bug 546932</a> - Add UI (preffed-off) for creating a CardDAV address book. r=mkmelin
<span class="logtags"></span>
</div>
<div class="title_text">
<table cellspacing="0">

<tr><td>author</td><td>&#71;&#101;&#111;&#102;&#102;&#32;&#76;&#97;&#110;&#107;&#111;&#119;&#32;&#60;&#103;&#101;&#111;&#102;&#102;&#64;&#100;&#97;&#114;&#107;&#116;&#114;&#111;&#106;&#97;&#110;&#46;&#110;&#101;&#116;&#62;</td></tr>
<tr><td></td><td class="date age">Sun, 31 May 2020 20:42:14 +0300</td></tr>

<tr>
 <td>changeset 29719</td>
 <td style="font-family:monospace"><a class="list" href="/comm-central/rev/41e929c17e1b7074022c82f1c3616689961eaed7">41e929c17e1b7074022c82f1c3616689961eaed7</a></td>
</tr>



<tr>
<td>parent 29718</td>
<td style="font-family:monospace">
<a class="list" href="/comm-central/rev/f9966a892f2a6df51c92d09e88748fc4c8cc2e76">f9966a892f2a6df51c92d09e88748fc4c8cc2e76</a>
</td>
</tr>

<tr>
<td>child 29720</td>
<td style="font-family:monospace">
<a class="list" href="/comm-central/rev/ad9902d060b0ab0a74854ca24ef3571ea4077470">ad9902d060b0ab0a74854ca24ef3571ea4077470</a>
</td>
</tr>
<tr><td>push id</td><td><a href="/comm-central/pushloghtml?changeset=41e929c17e1b7074022c82f1c3616689961eaed7">17499</a></td></tr>
<tr><td>push user</td><td>mkmelin@iki.fi</td></tr>
<tr><td>push date</td><td class="date age">Sun, 31 May 2020 17:48:51 +0000</td></tr>

<tr><td>treeherder</td><td>comm-central@9f4a9f7ce106 [<a href="https://treeherder.mozilla.org/#/jobs?repo=comm-central&revision=9f4a9f7ce10651f40e6788c3c1d648f4fb99d9dd">default view</a>] [<a href="https://treeherder.mozilla.org/#/jobs?repo=comm-central&revision=9f4a9f7ce10651f40e6788c3c1d648f4fb99d9dd&filter-resultStatus=testfailed&filter-resultStatus=busted&filter-resultStatus=exception">failures only]</td></tr>
<tr><td>perfherder</td><td>[<a href="https://treeherder.mozilla.org/perf.html#/compare?originalProject=comm-central&originalRevision=9f4a9f7ce10651f40e6788c3c1d648f4fb99d9dd&newProject=comm-central&newRevision=894c67ced89cc5c864d24eba23a6c4cc6f60fbc4&framework=1" target="_blank">talos</a>] [<a href="https://treeherder.mozilla.org/perf.html#/compare?originalProject=comm-central&originalRevision=9f4a9f7ce10651f40e6788c3c1d648f4fb99d9dd&newProject=comm-central&newRevision=894c67ced89cc5c864d24eba23a6c4cc6f60fbc4&framework=2" target="_blank">build metrics</a>] [<a href="https://treeherder.mozilla.org/perf.html#/compare?originalProject=comm-central&originalRevision=9f4a9f7ce10651f40e6788c3c1d648f4fb99d9dd&newProject=comm-central&newRevision=894c67ced89cc5c864d24eba23a6c4cc6f60fbc4&framework=6" target="_blank">platform microbench</a>] (compared to previous push)</td></tr>
<tr><td>reviewers</td><td><a href="/comm-central/log?rev=reviewer%28mkmelin%29&revcount=50">mkmelin</a></td></tr>
<tr><td>bugs</td><td><a href="https://bugzilla.mozilla.org/show_bug.cgi?id=546932">546932</a></td></tr>




</table></div>

<div class="page_body description"><a href="https://bugzilla.mozilla.org/show_bug.cgi?id=546932">Bug 546932</a> - Add UI (preffed-off) for creating a CardDAV address book. r=mkmelin</div>
<div class="list_head"></div>
<div class="title_text">
<table cellspacing="0">

<tr class="parity0">
<td><a class="list" href="/comm-central/diff/41e929c17e1b7074022c82f1c3616689961eaed7/mail/app/profile/all-thunderbird.js">mail/app/profile/all-thunderbird.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/41e929c17e1b7074022c82f1c3616689961eaed7/mail/app/profile/all-thunderbird.js">file</a> |
<a href="/comm-central/annotate/41e929c17e1b7074022c82f1c3616689961eaed7/mail/app/profile/all-thunderbird.js">annotate</a> |
<a href="/comm-central/diff/41e929c17e1b7074022c82f1c3616689961eaed7/mail/app/profile/all-thunderbird.js">diff</a> |
<a href="/comm-central/comparison/41e929c17e1b7074022c82f1c3616689961eaed7/mail/app/profile/all-thunderbird.js">comparison</a> |
<a href="/comm-central/log/41e929c17e1b7074022c82f1c3616689961eaed7/mail/app/profile/all-thunderbird.js">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/41e929c17e1b7074022c82f1c3616689961eaed7/mail/components/addrbook/content/abCommon.js">mail/components/addrbook/content/abCommon.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/41e929c17e1b7074022c82f1c3616689961eaed7/mail/components/addrbook/content/abCommon.js">file</a> |
<a href="/comm-central/annotate/41e929c17e1b7074022c82f1c3616689961eaed7/mail/components/addrbook/content/abCommon.js">annotate</a> |
<a href="/comm-central/diff/41e929c17e1b7074022c82f1c3616689961eaed7/mail/components/addrbook/content/abCommon.js">diff</a> |
<a href="/comm-central/comparison/41e929c17e1b7074022c82f1c3616689961eaed7/mail/components/addrbook/content/abCommon.js">comparison</a> |
<a href="/comm-central/log/41e929c17e1b7074022c82f1c3616689961eaed7/mail/components/addrbook/content/abCommon.js">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/41e929c17e1b7074022c82f1c3616689961eaed7/mail/components/addrbook/content/addressbook.js">mail/components/addrbook/content/addressbook.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/41e929c17e1b7074022c82f1c3616689961eaed7/mail/components/addrbook/content/addressbook.js">file</a> |
<a href="/comm-central/annotate/41e929c17e1b7074022c82f1c3616689961eaed7/mail/components/addrbook/content/addressbook.js">annotate</a> |
<a href="/comm-central/diff/41e929c17e1b7074022c82f1c3616689961eaed7/mail/components/addrbook/content/addressbook.js">diff</a> |
<a href="/comm-central/comparison/41e929c17e1b7074022c82f1c3616689961eaed7/mail/components/addrbook/content/addressbook.js">comparison</a> |
<a href="/comm-central/log/41e929c17e1b7074022c82f1c3616689961eaed7/mail/components/addrbook/content/addressbook.js">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/41e929c17e1b7074022c82f1c3616689961eaed7/mail/components/addrbook/content/addressbook.xhtml">mail/components/addrbook/content/addressbook.xhtml</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/41e929c17e1b7074022c82f1c3616689961eaed7/mail/components/addrbook/content/addressbook.xhtml">file</a> |
<a href="/comm-central/annotate/41e929c17e1b7074022c82f1c3616689961eaed7/mail/components/addrbook/content/addressbook.xhtml">annotate</a> |
<a href="/comm-central/diff/41e929c17e1b7074022c82f1c3616689961eaed7/mail/components/addrbook/content/addressbook.xhtml">diff</a> |
<a href="/comm-central/comparison/41e929c17e1b7074022c82f1c3616689961eaed7/mail/components/addrbook/content/addressbook.xhtml">comparison</a> |
<a href="/comm-central/log/41e929c17e1b7074022c82f1c3616689961eaed7/mail/components/addrbook/content/addressbook.xhtml">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/41e929c17e1b7074022c82f1c3616689961eaed7/mail/locales/en-US/chrome/messenger/addressbook/abMainWindow.dtd">mail/locales/en-US/chrome/messenger/addressbook/abMainWindow.dtd</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/41e929c17e1b7074022c82f1c3616689961eaed7/mail/locales/en-US/chrome/messenger/addressbook/abMainWindow.dtd">file</a> |
<a href="/comm-central/annotate/41e929c17e1b7074022c82f1c3616689961eaed7/mail/locales/en-US/chrome/messenger/addressbook/abMainWindow.dtd">annotate</a> |
<a href="/comm-central/diff/41e929c17e1b7074022c82f1c3616689961eaed7/mail/locales/en-US/chrome/messenger/addressbook/abMainWindow.dtd">diff</a> |
<a href="/comm-central/comparison/41e929c17e1b7074022c82f1c3616689961eaed7/mail/locales/en-US/chrome/messenger/addressbook/abMainWindow.dtd">comparison</a> |
<a href="/comm-central/log/41e929c17e1b7074022c82f1c3616689961eaed7/mail/locales/en-US/chrome/messenger/addressbook/abMainWindow.dtd">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/41e929c17e1b7074022c82f1c3616689961eaed7/mail/locales/en-US/messenger/addressbook/abCardDAVDialog.ftl">mail/locales/en-US/messenger/addressbook/abCardDAVDialog.ftl</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/41e929c17e1b7074022c82f1c3616689961eaed7/mail/locales/en-US/messenger/addressbook/abCardDAVDialog.ftl">file</a> |
<a href="/comm-central/annotate/41e929c17e1b7074022c82f1c3616689961eaed7/mail/locales/en-US/messenger/addressbook/abCardDAVDialog.ftl">annotate</a> |
<a href="/comm-central/diff/41e929c17e1b7074022c82f1c3616689961eaed7/mail/locales/en-US/messenger/addressbook/abCardDAVDialog.ftl">diff</a> |
<a href="/comm-central/comparison/41e929c17e1b7074022c82f1c3616689961eaed7/mail/locales/en-US/messenger/addressbook/abCardDAVDialog.ftl">comparison</a> |
<a href="/comm-central/log/41e929c17e1b7074022c82f1c3616689961eaed7/mail/locales/en-US/messenger/addressbook/abCardDAVDialog.ftl">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/41e929c17e1b7074022c82f1c3616689961eaed7/mailnews/addrbook/content/abCardDAVDialog.css">mailnews/addrbook/content/abCardDAVDialog.css</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/41e929c17e1b7074022c82f1c3616689961eaed7/mailnews/addrbook/content/abCardDAVDialog.css">file</a> |
<a href="/comm-central/annotate/41e929c17e1b7074022c82f1c3616689961eaed7/mailnews/addrbook/content/abCardDAVDialog.css">annotate</a> |
<a href="/comm-central/diff/41e929c17e1b7074022c82f1c3616689961eaed7/mailnews/addrbook/content/abCardDAVDialog.css">diff</a> |
<a href="/comm-central/comparison/41e929c17e1b7074022c82f1c3616689961eaed7/mailnews/addrbook/content/abCardDAVDialog.css">comparison</a> |
<a href="/comm-central/log/41e929c17e1b7074022c82f1c3616689961eaed7/mailnews/addrbook/content/abCardDAVDialog.css">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/41e929c17e1b7074022c82f1c3616689961eaed7/mailnews/addrbook/content/abCardDAVDialog.js">mailnews/addrbook/content/abCardDAVDialog.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/41e929c17e1b7074022c82f1c3616689961eaed7/mailnews/addrbook/content/abCardDAVDialog.js">file</a> |
<a href="/comm-central/annotate/41e929c17e1b7074022c82f1c3616689961eaed7/mailnews/addrbook/content/abCardDAVDialog.js">annotate</a> |
<a href="/comm-central/diff/41e929c17e1b7074022c82f1c3616689961eaed7/mailnews/addrbook/content/abCardDAVDialog.js">diff</a> |
<a href="/comm-central/comparison/41e929c17e1b7074022c82f1c3616689961eaed7/mailnews/addrbook/content/abCardDAVDialog.js">comparison</a> |
<a href="/comm-central/log/41e929c17e1b7074022c82f1c3616689961eaed7/mailnews/addrbook/content/abCardDAVDialog.js">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/41e929c17e1b7074022c82f1c3616689961eaed7/mailnews/addrbook/content/abCardDAVDialog.xhtml">mailnews/addrbook/content/abCardDAVDialog.xhtml</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/41e929c17e1b7074022c82f1c3616689961eaed7/mailnews/addrbook/content/abCardDAVDialog.xhtml">file</a> |
<a href="/comm-central/annotate/41e929c17e1b7074022c82f1c3616689961eaed7/mailnews/addrbook/content/abCardDAVDialog.xhtml">annotate</a> |
<a href="/comm-central/diff/41e929c17e1b7074022c82f1c3616689961eaed7/mailnews/addrbook/content/abCardDAVDialog.xhtml">diff</a> |
<a href="/comm-central/comparison/41e929c17e1b7074022c82f1c3616689961eaed7/mailnews/addrbook/content/abCardDAVDialog.xhtml">comparison</a> |
<a href="/comm-central/log/41e929c17e1b7074022c82f1c3616689961eaed7/mailnews/addrbook/content/abCardDAVDialog.xhtml">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/41e929c17e1b7074022c82f1c3616689961eaed7/mailnews/addrbook/jsaddrbook/AddrBookDirectory.jsm">mailnews/addrbook/jsaddrbook/AddrBookDirectory.jsm</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/41e929c17e1b7074022c82f1c3616689961eaed7/mailnews/addrbook/jsaddrbook/AddrBookDirectory.jsm">file</a> |
<a href="/comm-central/annotate/41e929c17e1b7074022c82f1c3616689961eaed7/mailnews/addrbook/jsaddrbook/AddrBookDirectory.jsm">annotate</a> |
<a href="/comm-central/diff/41e929c17e1b7074022c82f1c3616689961eaed7/mailnews/addrbook/jsaddrbook/AddrBookDirectory.jsm">diff</a> |
<a href="/comm-central/comparison/41e929c17e1b7074022c82f1c3616689961eaed7/mailnews/addrbook/jsaddrbook/AddrBookDirectory.jsm">comparison</a> |
<a href="/comm-central/log/41e929c17e1b7074022c82f1c3616689961eaed7/mailnews/addrbook/jsaddrbook/AddrBookDirectory.jsm">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/41e929c17e1b7074022c82f1c3616689961eaed7/mailnews/addrbook/jsaddrbook/CardDAVDirectory.jsm">mailnews/addrbook/jsaddrbook/CardDAVDirectory.jsm</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/41e929c17e1b7074022c82f1c3616689961eaed7/mailnews/addrbook/jsaddrbook/CardDAVDirectory.jsm">file</a> |
<a href="/comm-central/annotate/41e929c17e1b7074022c82f1c3616689961eaed7/mailnews/addrbook/jsaddrbook/CardDAVDirectory.jsm">annotate</a> |
<a href="/comm-central/diff/41e929c17e1b7074022c82f1c3616689961eaed7/mailnews/addrbook/jsaddrbook/CardDAVDirectory.jsm">diff</a> |
<a href="/comm-central/comparison/41e929c17e1b7074022c82f1c3616689961eaed7/mailnews/addrbook/jsaddrbook/CardDAVDirectory.jsm">comparison</a> |
<a href="/comm-central/log/41e929c17e1b7074022c82f1c3616689961eaed7/mailnews/addrbook/jsaddrbook/CardDAVDirectory.jsm">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/41e929c17e1b7074022c82f1c3616689961eaed7/mailnews/jar.mn">mailnews/jar.mn</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/41e929c17e1b7074022c82f1c3616689961eaed7/mailnews/jar.mn">file</a> |
<a href="/comm-central/annotate/41e929c17e1b7074022c82f1c3616689961eaed7/mailnews/jar.mn">annotate</a> |
<a href="/comm-central/diff/41e929c17e1b7074022c82f1c3616689961eaed7/mailnews/jar.mn">diff</a> |
<a href="/comm-central/comparison/41e929c17e1b7074022c82f1c3616689961eaed7/mailnews/jar.mn">comparison</a> |
<a href="/comm-central/log/41e929c17e1b7074022c82f1c3616689961eaed7/mailnews/jar.mn">revisions</a>
</td>
</tr>
</table></div>

<div class="page_body diffblocks"><div class="diffblock"><pre class="sourcelines">
<a href="#l1.1"></a><span id="l1.1" class="difflineminus">--- a/mail/app/profile/all-thunderbird.js</span>
<a href="#l1.2"></a><span id="l1.2" class="difflineplus">+++ b/mail/app/profile/all-thunderbird.js</span>
<a href="#l1.3"></a><span id="l1.3" class="difflineat">@@ -493,16 +493,19 @@ pref(&quot;mail.spotlight.logging.dump&quot;, fals</span>
<a href="#l1.4"></a><span id="l1.4"> </span>
<a href="#l1.5"></a><span id="l1.5"> // Whether to use a panel that looks like an OS X sheet for customization</span>
<a href="#l1.6"></a><span id="l1.6"> #ifdef XP_MACOSX</span>
<a href="#l1.7"></a><span id="l1.7"> pref(&quot;toolbar.customization.usesheet&quot;, true);</span>
<a href="#l1.8"></a><span id="l1.8"> #else</span>
<a href="#l1.9"></a><span id="l1.9"> pref(&quot;toolbar.customization.usesheet&quot;, false);</span>
<a href="#l1.10"></a><span id="l1.10"> #endif</span>
<a href="#l1.11"></a><span id="l1.11"> </span>
<a href="#l1.12"></a><span id="l1.12" class="difflineplus">+// Whether to enable experimental CardDAV support.</span>
<a href="#l1.13"></a><span id="l1.13" class="difflineplus">+pref(&quot;mail.addr_book.carddav.enabled&quot;, false);</span>
<a href="#l1.14"></a><span id="l1.14" class="difflineplus">+</span>
<a href="#l1.15"></a><span id="l1.15"> // Number of recipient rows shown by default</span>
<a href="#l1.16"></a><span id="l1.16"> pref(&quot;mail.compose.addresswidget.numRowsShownDefault&quot;, 3);</span>
<a href="#l1.17"></a><span id="l1.17"> </span>
<a href="#l1.18"></a><span id="l1.18"> // Start compositions with (empty) attachment pane showing</span>
<a href="#l1.19"></a><span id="l1.19"> pref(&quot;mail.compose.show_attachment_pane&quot;, false);</span>
<a href="#l1.20"></a><span id="l1.20"> // Check for missing attachments?</span>
<a href="#l1.21"></a><span id="l1.21"> pref(&quot;mail.compose.attachment_reminder&quot;, true);</span>
<a href="#l1.22"></a><span id="l1.22"> // Words that should trigger a missing attachments warning.</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l2.1"></a><span id="l2.1" class="difflineminus">--- a/mail/components/addrbook/content/abCommon.js</span>
<a href="#l2.2"></a><span id="l2.2" class="difflineplus">+++ b/mail/components/addrbook/content/abCommon.js</span>
<a href="#l2.3"></a><span id="l2.3" class="difflineat">@@ -239,16 +239,25 @@ function AbNewAddressBook() {</span>
<a href="#l2.4"></a><span id="l2.4">   window.openDialog(</span>
<a href="#l2.5"></a><span id="l2.5">     &quot;chrome://messenger/content/addressbook/abAddressBookNameDialog.xhtml&quot;,</span>
<a href="#l2.6"></a><span id="l2.6">     &quot;&quot;,</span>
<a href="#l2.7"></a><span id="l2.7">     &quot;chrome,modal,resizable=no,centerscreen&quot;,</span>
<a href="#l2.8"></a><span id="l2.8">     null</span>
<a href="#l2.9"></a><span id="l2.9">   );</span>
<a href="#l2.10"></a><span id="l2.10"> }</span>
<a href="#l2.11"></a><span id="l2.11"> </span>
<a href="#l2.12"></a><span id="l2.12" class="difflineplus">+function AbNewCardDAVBook() {</span>
<a href="#l2.13"></a><span id="l2.13" class="difflineplus">+  window.openDialog(</span>
<a href="#l2.14"></a><span id="l2.14" class="difflineplus">+    &quot;chrome://messenger/content/addressbook/abCardDAVDialog.xhtml&quot;,</span>
<a href="#l2.15"></a><span id="l2.15" class="difflineplus">+    &quot;&quot;,</span>
<a href="#l2.16"></a><span id="l2.16" class="difflineplus">+    &quot;chrome,modal,resizable=no,centerscreen&quot;,</span>
<a href="#l2.17"></a><span id="l2.17" class="difflineplus">+    null</span>
<a href="#l2.18"></a><span id="l2.18" class="difflineplus">+  );</span>
<a href="#l2.19"></a><span id="l2.19" class="difflineplus">+}</span>
<a href="#l2.20"></a><span id="l2.20" class="difflineplus">+</span>
<a href="#l2.21"></a><span id="l2.21"> function AbEditSelectedDirectory() {</span>
<a href="#l2.22"></a><span id="l2.22">   let selectedDir = getSelectedDirectory();</span>
<a href="#l2.23"></a><span id="l2.23">   if (!selectedDir) {</span>
<a href="#l2.24"></a><span id="l2.24">     return;</span>
<a href="#l2.25"></a><span id="l2.25">   }</span>
<a href="#l2.26"></a><span id="l2.26"> </span>
<a href="#l2.27"></a><span id="l2.27">   if (selectedDir.isMailList) {</span>
<a href="#l2.28"></a><span id="l2.28">     goEditListDialog(null, selectedDir.URI);</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l3.1"></a><span id="l3.1" class="difflineminus">--- a/mail/components/addrbook/content/addressbook.js</span>
<a href="#l3.2"></a><span id="l3.2" class="difflineplus">+++ b/mail/components/addrbook/content/addressbook.js</span>
<a href="#l3.3"></a><span id="l3.3" class="difflineat">@@ -298,20 +298,27 @@ function SetNameColumn(cmd) {</span>
<a href="#l3.4"></a><span id="l3.4">     case &quot;displayNameCmd&quot;:</span>
<a href="#l3.5"></a><span id="l3.5">       prefValue = kDisplayName;</span>
<a href="#l3.6"></a><span id="l3.6">       break;</span>
<a href="#l3.7"></a><span id="l3.7">   }</span>
<a href="#l3.8"></a><span id="l3.8"> </span>
<a href="#l3.9"></a><span id="l3.9">   Services.prefs.setIntPref(kPrefMailAddrBookLastNameFirst, prefValue);</span>
<a href="#l3.10"></a><span id="l3.10"> }</span>
<a href="#l3.11"></a><span id="l3.11"> </span>
<a href="#l3.12"></a><span id="l3.12" class="difflineminus">-function onOSXFileMenuInit() {</span>
<a href="#l3.13"></a><span id="l3.13" class="difflineminus">-  document</span>
<a href="#l3.14"></a><span id="l3.14" class="difflineminus">-    .getElementById(&quot;menu_osxAddressBook&quot;)</span>
<a href="#l3.15"></a><span id="l3.15" class="difflineminus">-    .setAttribute(&quot;checked&quot;, AbOSXAddressBookExists());</span>
<a href="#l3.16"></a><span id="l3.16" class="difflineplus">+function onFileMenuInit() {</span>
<a href="#l3.17"></a><span id="l3.17" class="difflineplus">+  let osxMenuItem = document.getElementById(&quot;menu_osxAddressBook&quot;);</span>
<a href="#l3.18"></a><span id="l3.18" class="difflineplus">+  if (osxMenuItem) {</span>
<a href="#l3.19"></a><span id="l3.19" class="difflineplus">+    osxMenuItem.setAttribute(&quot;checked&quot;, AbOSXAddressBookExists());</span>
<a href="#l3.20"></a><span id="l3.20" class="difflineplus">+  }</span>
<a href="#l3.21"></a><span id="l3.21" class="difflineplus">+  document.getElementById(</span>
<a href="#l3.22"></a><span id="l3.22" class="difflineplus">+    &quot;menu_newCardDAVBook&quot;</span>
<a href="#l3.23"></a><span id="l3.23" class="difflineplus">+  ).hidden = !Services.prefs.getBoolPref(</span>
<a href="#l3.24"></a><span id="l3.24" class="difflineplus">+    &quot;mail.addr_book.carddav.enabled&quot;,</span>
<a href="#l3.25"></a><span id="l3.25" class="difflineplus">+    false</span>
<a href="#l3.26"></a><span id="l3.26" class="difflineplus">+  );</span>
<a href="#l3.27"></a><span id="l3.27"> }</span>
<a href="#l3.28"></a><span id="l3.28"> </span>
<a href="#l3.29"></a><span id="l3.29"> function CommandUpdate_AddressBook() {</span>
<a href="#l3.30"></a><span id="l3.30">   goUpdateCommand(&quot;cmd_delete&quot;);</span>
<a href="#l3.31"></a><span id="l3.31">   goUpdateCommand(&quot;button_delete&quot;);</span>
<a href="#l3.32"></a><span id="l3.32">   goUpdateCommand(&quot;cmd_printcardpreview&quot;);</span>
<a href="#l3.33"></a><span id="l3.33">   goUpdateCommand(&quot;cmd_printcard&quot;);</span>
<a href="#l3.34"></a><span id="l3.34">   goUpdateCommand(&quot;cmd_properties&quot;);</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l4.1"></a><span id="l4.1" class="difflineminus">--- a/mail/components/addrbook/content/addressbook.xhtml</span>
<a href="#l4.2"></a><span id="l4.2" class="difflineplus">+++ b/mail/components/addrbook/content/addressbook.xhtml</span>
<a href="#l4.3"></a><span id="l4.3" class="difflineat">@@ -297,21 +297,17 @@</span>
<a href="#l4.4"></a><span id="l4.4">           toolbarname=&quot;&amp;menubarCmd.label;&quot;</span>
<a href="#l4.5"></a><span id="l4.5">           accesskey=&quot;&amp;menubarCmd.accesskey;&quot;</span>
<a href="#l4.6"></a><span id="l4.6"> #endif</span>
<a href="#l4.7"></a><span id="l4.7">            context=&quot;toolbar-context-menu&quot; mode=&quot;icons&quot;&gt;</span>
<a href="#l4.8"></a><span id="l4.8"> </span>
<a href="#l4.9"></a><span id="l4.9">    &lt;toolbaritem id=&quot;menubar-items&quot; align=&quot;center&quot;&gt;</span>
<a href="#l4.10"></a><span id="l4.10">      &lt;menubar id=&quot;mail-menubar&quot;&gt;</span>
<a href="#l4.11"></a><span id="l4.11">         &lt;menu id=&quot;menu_File&quot; label=&quot;&amp;fileMenu.label;&quot; accesskey=&quot;&amp;fileMenu.accesskey;&quot;&gt;</span>
<a href="#l4.12"></a><span id="l4.12" class="difflineminus">-#ifdef XP_MACOSX</span>
<a href="#l4.13"></a><span id="l4.13" class="difflineminus">-            &lt;menupopup id=&quot;menu_FilePopup&quot; onpopupshowing=&quot;onOSXFileMenuInit();&quot;&gt;</span>
<a href="#l4.14"></a><span id="l4.14" class="difflineminus">-#else</span>
<a href="#l4.15"></a><span id="l4.15" class="difflineminus">-            &lt;menupopup id=&quot;menu_FilePopup&quot;&gt;</span>
<a href="#l4.16"></a><span id="l4.16" class="difflineminus">-#endif</span>
<a href="#l4.17"></a><span id="l4.17" class="difflineplus">+            &lt;menupopup id=&quot;menu_FilePopup&quot; onpopupshowing=&quot;onFileMenuInit();&quot;&gt;</span>
<a href="#l4.18"></a><span id="l4.18">                 &lt;menu id=&quot;menu_New&quot; class=&quot;menu-iconic&quot;</span>
<a href="#l4.19"></a><span id="l4.19">                       label=&quot;&amp;newMenu.label;&quot; accesskey=&quot;&amp;newMenu.accesskey;&quot;&gt;</span>
<a href="#l4.20"></a><span id="l4.20">                     &lt;menupopup id=&quot;menu_NewPopup&quot;&gt;</span>
<a href="#l4.21"></a><span id="l4.21">                       &lt;menuitem id=&quot;menu_newContact&quot;</span>
<a href="#l4.22"></a><span id="l4.22">                                 label=&quot;&amp;newContact.label;&quot;</span>
<a href="#l4.23"></a><span id="l4.23">                                 accesskey=&quot;&amp;newContact.accesskey;&quot;</span>
<a href="#l4.24"></a><span id="l4.24">                                 key=&quot;key_newCard&quot; command=&quot;cmd_newCard&quot;</span>
<a href="#l4.25"></a><span id="l4.25">                                 class=&quot;menuitem-iconic&quot;/&gt;</span>
<a href="#l4.26"></a><span id="l4.26" class="difflineat">@@ -320,16 +316,21 @@</span>
<a href="#l4.27"></a><span id="l4.27">                                 accesskey=&quot;&amp;newListCmd.accesskey;&quot;</span>
<a href="#l4.28"></a><span id="l4.28">                                 command=&quot;cmd_newlist&quot;</span>
<a href="#l4.29"></a><span id="l4.29">                                 class=&quot;menuitem-iconic&quot;/&gt;</span>
<a href="#l4.30"></a><span id="l4.30">                       &lt;menuitem id=&quot;menu_newAddrbook&quot;</span>
<a href="#l4.31"></a><span id="l4.31">                                 label=&quot;&amp;newAddressBookCmd.label;&quot;</span>
<a href="#l4.32"></a><span id="l4.32">                                 accesskey=&quot;&amp;newAddressBookCmd.accesskey;&quot;</span>
<a href="#l4.33"></a><span id="l4.33">                                 oncommand=&quot;AbNewAddressBook()&quot;</span>
<a href="#l4.34"></a><span id="l4.34">                                 class=&quot;menuitem-iconic&quot;/&gt;</span>
<a href="#l4.35"></a><span id="l4.35" class="difflineplus">+                      &lt;menuitem id=&quot;menu_newCardDAVBook&quot;</span>
<a href="#l4.36"></a><span id="l4.36" class="difflineplus">+                                label=&quot;&amp;newCardDAVBookCmd.label;&quot;</span>
<a href="#l4.37"></a><span id="l4.37" class="difflineplus">+                                accesskey=&quot;&amp;newCardDAVBookCmd.accesskey;&quot;</span>
<a href="#l4.38"></a><span id="l4.38" class="difflineplus">+                                oncommand=&quot;AbNewCardDAVBook()&quot;</span>
<a href="#l4.39"></a><span id="l4.39" class="difflineplus">+                                class=&quot;menuitem-iconic&quot;/&gt;</span>
<a href="#l4.40"></a><span id="l4.40">                       &lt;menuitem id=&quot;addLDAP&quot; label=&quot;&amp;newLDAPDirectoryCmd.label;&quot;</span>
<a href="#l4.41"></a><span id="l4.41">                                 accesskey=&quot;&amp;newLDAPDirectoryCmd.accesskey;&quot;</span>
<a href="#l4.42"></a><span id="l4.42">                                 oncommand=&quot;AbNewLDAPDirectory()&quot;</span>
<a href="#l4.43"></a><span id="l4.43">                                 class=&quot;menuitem-iconic&quot;/&gt;</span>
<a href="#l4.44"></a><span id="l4.44">                       &lt;menuseparator/&gt;</span>
<a href="#l4.45"></a><span id="l4.45">                       &lt;menuitem id=&quot;menu_newMessage&quot;</span>
<a href="#l4.46"></a><span id="l4.46">                                 label=&quot;&amp;newMessageCmd.label;&quot;</span>
<a href="#l4.47"></a><span id="l4.47">                                 key=&quot;key_newMessage&quot;</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l5.1"></a><span id="l5.1" class="difflineminus">--- a/mail/locales/en-US/chrome/messenger/addressbook/abMainWindow.dtd</span>
<a href="#l5.2"></a><span id="l5.2" class="difflineplus">+++ b/mail/locales/en-US/chrome/messenger/addressbook/abMainWindow.dtd</span>
<a href="#l5.3"></a><span id="l5.3" class="difflineat">@@ -13,16 +13,18 @@</span>
<a href="#l5.4"></a><span id="l5.4"> &lt;!ENTITY newMenu.accesskey                              &quot;N&quot;&gt;</span>
<a href="#l5.5"></a><span id="l5.5"> &lt;!ENTITY newContact.label                               &quot;Address Book Contact…&quot;&gt;</span>
<a href="#l5.6"></a><span id="l5.6"> &lt;!ENTITY newContact.accesskey                           &quot;C&quot;&gt;</span>
<a href="#l5.7"></a><span id="l5.7"> &lt;!ENTITY newContact.key                                 &quot;N&quot;&gt;</span>
<a href="#l5.8"></a><span id="l5.8"> &lt;!ENTITY newListCmd.label                               &quot;Mailing List…&quot;&gt;</span>
<a href="#l5.9"></a><span id="l5.9"> &lt;!ENTITY newListCmd.accesskey                           &quot;L&quot;&gt;</span>
<a href="#l5.10"></a><span id="l5.10"> &lt;!ENTITY newAddressBookCmd.label                        &quot;Address Book…&quot;&gt;</span>
<a href="#l5.11"></a><span id="l5.11"> &lt;!ENTITY newAddressBookCmd.accesskey                    &quot;B&quot;&gt;</span>
<a href="#l5.12"></a><span id="l5.12" class="difflineplus">+&lt;!ENTITY newCardDAVBookCmd.label                        &quot;CardDAV Address Book…&quot;&gt;</span>
<a href="#l5.13"></a><span id="l5.13" class="difflineplus">+&lt;!ENTITY newCardDAVBookCmd.accesskey                    &quot;V&quot;&gt;</span>
<a href="#l5.14"></a><span id="l5.14"> &lt;!ENTITY newLDAPDirectoryCmd.label                      &quot;LDAP Directory…&quot;&gt;</span>
<a href="#l5.15"></a><span id="l5.15"> &lt;!ENTITY newLDAPDirectoryCmd.accesskey                  &quot;D&quot;&gt;</span>
<a href="#l5.16"></a><span id="l5.16"> &lt;!ENTITY newMessageCmd.label                            &quot;Message&quot;&gt;</span>
<a href="#l5.17"></a><span id="l5.17"> &lt;!ENTITY newMessageCmd.key                              &quot;M&quot;&gt;</span>
<a href="#l5.18"></a><span id="l5.18"> &lt;!ENTITY newMessageCmd.accesskey                        &quot;M&quot;&gt;</span>
<a href="#l5.19"></a><span id="l5.19"> &lt;!-- LOCALIZATION NOTE (osxAddressBook) : These entities are only used on Mac --&gt;</span>
<a href="#l5.20"></a><span id="l5.20"> &lt;!ENTITY osxAddressBook.label                           &quot;Use Mac OS X Address Book&quot;&gt;</span>
<a href="#l5.21"></a><span id="l5.21"> &lt;!ENTITY osxAddressBook.accesskey                       &quot;O&quot;&gt;</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l6.1"></a><span id="l6.1">new file mode 100644</span>
<a href="#l6.2"></a><span id="l6.2" class="difflineminus">--- /dev/null</span>
<a href="#l6.3"></a><span id="l6.3" class="difflineplus">+++ b/mail/locales/en-US/messenger/addressbook/abCardDAVDialog.ftl</span>
<a href="#l6.4"></a><span id="l6.4" class="difflineat">@@ -0,0 +1,45 @@</span>
<a href="#l6.5"></a><span id="l6.5" class="difflineplus">+# This Source Code Form is subject to the terms of the Mozilla Public</span>
<a href="#l6.6"></a><span id="l6.6" class="difflineplus">+# License, v. 2.0. If a copy of the MPL was not distributed with this</span>
<a href="#l6.7"></a><span id="l6.7" class="difflineplus">+# file, you can obtain one at http://mozilla.org/MPL/2.0/.</span>
<a href="#l6.8"></a><span id="l6.8" class="difflineplus">+</span>
<a href="#l6.9"></a><span id="l6.9" class="difflineplus">+carddav-window =</span>
<a href="#l6.10"></a><span id="l6.10" class="difflineplus">+    .title = New CardDAV Address Book</span>
<a href="#l6.11"></a><span id="l6.11" class="difflineplus">+</span>
<a href="#l6.12"></a><span id="l6.12" class="difflineplus">+carddav-dialog =</span>
<a href="#l6.13"></a><span id="l6.13" class="difflineplus">+    .buttonlabelaccept = Continue</span>
<a href="#l6.14"></a><span id="l6.14" class="difflineplus">+    .buttonaccesskeyaccept = C</span>
<a href="#l6.15"></a><span id="l6.15" class="difflineplus">+</span>
<a href="#l6.16"></a><span id="l6.16" class="difflineplus">+carddav-experimental-warning = CardDAV address book support is experimental and could permanently damage your data. Use at your own risk.</span>
<a href="#l6.17"></a><span id="l6.17" class="difflineplus">+</span>
<a href="#l6.18"></a><span id="l6.18" class="difflineplus">+carddav-provider-label =</span>
<a href="#l6.19"></a><span id="l6.19" class="difflineplus">+    .value = CardDAV Provider:</span>
<a href="#l6.20"></a><span id="l6.20" class="difflineplus">+    .accesskey = P</span>
<a href="#l6.21"></a><span id="l6.21" class="difflineplus">+</span>
<a href="#l6.22"></a><span id="l6.22" class="difflineplus">+carddav-provider-option-other = Other provider…</span>
<a href="#l6.23"></a><span id="l6.23" class="difflineplus">+</span>
<a href="#l6.24"></a><span id="l6.24" class="difflineplus">+carddav-url-label =</span>
<a href="#l6.25"></a><span id="l6.25" class="difflineplus">+    .value = CardDAV URL:</span>
<a href="#l6.26"></a><span id="l6.26" class="difflineplus">+    .accesskey = V</span>
<a href="#l6.27"></a><span id="l6.27" class="difflineplus">+</span>
<a href="#l6.28"></a><span id="l6.28" class="difflineplus">+carddav-username-label =</span>
<a href="#l6.29"></a><span id="l6.29" class="difflineplus">+    .value = Username:</span>
<a href="#l6.30"></a><span id="l6.30" class="difflineplus">+    .accesskey = U</span>
<a href="#l6.31"></a><span id="l6.31" class="difflineplus">+carddav-username-input =</span>
<a href="#l6.32"></a><span id="l6.32" class="difflineplus">+    .placeholder = you@example.com</span>
<a href="#l6.33"></a><span id="l6.33" class="difflineplus">+</span>
<a href="#l6.34"></a><span id="l6.34" class="difflineplus">+carddav-password-label =</span>
<a href="#l6.35"></a><span id="l6.35" class="difflineplus">+    .value = Password:</span>
<a href="#l6.36"></a><span id="l6.36" class="difflineplus">+    .accesskey = w</span>
<a href="#l6.37"></a><span id="l6.37" class="difflineplus">+carddav-password-input =</span>
<a href="#l6.38"></a><span id="l6.38" class="difflineplus">+    .placeholder = Password</span>
<a href="#l6.39"></a><span id="l6.39" class="difflineplus">+</span>
<a href="#l6.40"></a><span id="l6.40" class="difflineplus">+carddav-remember-password =</span>
<a href="#l6.41"></a><span id="l6.41" class="difflineplus">+    .label = Remember password</span>
<a href="#l6.42"></a><span id="l6.42" class="difflineplus">+    .accesskey = m</span>
<a href="#l6.43"></a><span id="l6.43" class="difflineplus">+</span>
<a href="#l6.44"></a><span id="l6.44" class="difflineplus">+carddav-loading = Looking up configuration…</span>
<a href="#l6.45"></a><span id="l6.45" class="difflineplus">+carddav-connection-error = Failed to connect.</span>
<a href="#l6.46"></a><span id="l6.46" class="difflineplus">+carddav-none-found = Found no address books to add for the specified account.</span>
<a href="#l6.47"></a><span id="l6.47" class="difflineplus">+carddav-already-added = All address books for the specified account have already been added.</span>
<a href="#l6.48"></a><span id="l6.48" class="difflineplus">+</span>
<a href="#l6.49"></a><span id="l6.49" class="difflineplus">+carddav-available-books = Available address books:</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l7.1"></a><span id="l7.1">new file mode 100644</span>
<a href="#l7.2"></a><span id="l7.2" class="difflineminus">--- /dev/null</span>
<a href="#l7.3"></a><span id="l7.3" class="difflineplus">+++ b/mailnews/addrbook/content/abCardDAVDialog.css</span>
<a href="#l7.4"></a><span id="l7.4" class="difflineat">@@ -0,0 +1,68 @@</span>
<a href="#l7.5"></a><span id="l7.5" class="difflineplus">+/* This Source Code Form is subject to the terms of the Mozilla Public</span>
<a href="#l7.6"></a><span id="l7.6" class="difflineplus">+ * License, v. 2.0. If a copy of the MPL was not distributed with this</span>
<a href="#l7.7"></a><span id="l7.7" class="difflineplus">+ * file, you can obtain one at http://mozilla.org/MPL/2.0/. */</span>
<a href="#l7.8"></a><span id="l7.8" class="difflineplus">+</span>
<a href="#l7.9"></a><span id="l7.9" class="difflineplus">+#bigScaryWarning {</span>
<a href="#l7.10"></a><span id="l7.10" class="difflineplus">+  background-color: #FFE900;</span>
<a href="#l7.11"></a><span id="l7.11" class="difflineplus">+  border-color: #F2D00F;</span>
<a href="#l7.12"></a><span id="l7.12" class="difflineplus">+  color: -moz-DialogText;</span>
<a href="#l7.13"></a><span id="l7.13" class="difflineplus">+  padding: 4px;</span>
<a href="#l7.14"></a><span id="l7.14" class="difflineplus">+  white-space: normal;</span>
<a href="#l7.15"></a><span id="l7.15" class="difflineplus">+}</span>
<a href="#l7.16"></a><span id="l7.16" class="difflineplus">+</span>
<a href="#l7.17"></a><span id="l7.17" class="difflineplus">+#bigScaryWarning image {</span>
<a href="#l7.18"></a><span id="l7.18" class="difflineplus">+  -moz-context-properties: fill;</span>
<a href="#l7.19"></a><span id="l7.19" class="difflineplus">+  fill: currentColor;</span>
<a href="#l7.20"></a><span id="l7.20" class="difflineplus">+  margin: 4px 8px;</span>
<a href="#l7.21"></a><span id="l7.21" class="difflineplus">+}</span>
<a href="#l7.22"></a><span id="l7.22" class="difflineplus">+</span>
<a href="#l7.23"></a><span id="l7.23" class="difflineplus">+#bigScaryWarning description {</span>
<a href="#l7.24"></a><span id="l7.24" class="difflineplus">+  width: 30em;</span>
<a href="#l7.25"></a><span id="l7.25" class="difflineplus">+}</span>
<a href="#l7.26"></a><span id="l7.26" class="difflineplus">+</span>
<a href="#l7.27"></a><span id="l7.27" class="difflineplus">+th {</span>
<a href="#l7.28"></a><span id="l7.28" class="difflineplus">+  font-weight: normal;</span>
<a href="#l7.29"></a><span id="l7.29" class="difflineplus">+  text-align: start;</span>
<a href="#l7.30"></a><span id="l7.30" class="difflineplus">+}</span>
<a href="#l7.31"></a><span id="l7.31" class="difflineplus">+</span>
<a href="#l7.32"></a><span id="l7.32" class="difflineplus">+#statusArea {</span>
<a href="#l7.33"></a><span id="l7.33" class="difflineplus">+  background: transparent;</span>
<a href="#l7.34"></a><span id="l7.34" class="difflineplus">+  border: 1px solid transparent;</span>
<a href="#l7.35"></a><span id="l7.35" class="difflineplus">+  border-radius: 2px;</span>
<a href="#l7.36"></a><span id="l7.36" class="difflineplus">+  padding: 3px 4px;</span>
<a href="#l7.37"></a><span id="l7.37" class="difflineplus">+  color: var(--text-color);</span>
<a href="#l7.38"></a><span id="l7.38" class="difflineplus">+}</span>
<a href="#l7.39"></a><span id="l7.39" class="difflineplus">+</span>
<a href="#l7.40"></a><span id="l7.40" class="difflineplus">+#statusArea #statusImageBefore {</span>
<a href="#l7.41"></a><span id="l7.41" class="difflineplus">+  -moz-context-properties: fill;</span>
<a href="#l7.42"></a><span id="l7.42" class="difflineplus">+  fill: currentColor;</span>
<a href="#l7.43"></a><span id="l7.43" class="difflineplus">+  width: 16px;</span>
<a href="#l7.44"></a><span id="l7.44" class="difflineplus">+  height: 16px;</span>
<a href="#l7.45"></a><span id="l7.45" class="difflineplus">+  background-size: 16px 16px;</span>
<a href="#l7.46"></a><span id="l7.46" class="difflineplus">+}</span>
<a href="#l7.47"></a><span id="l7.47" class="difflineplus">+</span>
<a href="#l7.48"></a><span id="l7.48" class="difflineplus">+#statusArea[status=error] {</span>
<a href="#l7.49"></a><span id="l7.49" class="difflineplus">+  background-color: #FFE900;</span>
<a href="#l7.50"></a><span id="l7.50" class="difflineplus">+  border-color: #F2D00F;</span>
<a href="#l7.51"></a><span id="l7.51" class="difflineplus">+  color: -moz-DialogText;</span>
<a href="#l7.52"></a><span id="l7.52" class="difflineplus">+}</span>
<a href="#l7.53"></a><span id="l7.53" class="difflineplus">+</span>
<a href="#l7.54"></a><span id="l7.54" class="difflineplus">+#statusArea[status=error] #statusImageBefore {</span>
<a href="#l7.55"></a><span id="l7.55" class="difflineplus">+  list-style-image: url(&quot;chrome://global/skin/icons/warning.svg&quot;);</span>
<a href="#l7.56"></a><span id="l7.56" class="difflineplus">+}</span>
<a href="#l7.57"></a><span id="l7.57" class="difflineplus">+</span>
<a href="#l7.58"></a><span id="l7.58" class="difflineplus">+#statusArea[status=loading] {</span>
<a href="#l7.59"></a><span id="l7.59" class="difflineplus">+  background-color: rgba(0, 0, 0, 0.05);</span>
<a href="#l7.60"></a><span id="l7.60" class="difflineplus">+  border-color: rgba(0, 0, 0, 0.1);</span>
<a href="#l7.61"></a><span id="l7.61" class="difflineplus">+}</span>
<a href="#l7.62"></a><span id="l7.62" class="difflineplus">+</span>
<a href="#l7.63"></a><span id="l7.63" class="difflineplus">+#statusArea[status=loading] #statusImageBefore {</span>
<a href="#l7.64"></a><span id="l7.64" class="difflineplus">+  background: url(&quot;chrome://global/skin/icons/loading.png&quot;) no-repeat;</span>
<a href="#l7.65"></a><span id="l7.65" class="difflineplus">+}</span>
<a href="#l7.66"></a><span id="l7.66" class="difflineplus">+</span>
<a href="#l7.67"></a><span id="l7.67" class="difflineplus">+@media (min-resolution: 1.1dppx) {</span>
<a href="#l7.68"></a><span id="l7.68" class="difflineplus">+  #statusArea[status=loading] #statusImageBefore {</span>
<a href="#l7.69"></a><span id="l7.69" class="difflineplus">+    background-image: url(&quot;chrome://global/skin/icons/loading@2x.png&quot;);</span>
<a href="#l7.70"></a><span id="l7.70" class="difflineplus">+    background-size: 16px 16px;</span>
<a href="#l7.71"></a><span id="l7.71" class="difflineplus">+  }</span>
<a href="#l7.72"></a><span id="l7.72" class="difflineplus">+}</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l8.1"></a><span id="l8.1">new file mode 100644</span>
<a href="#l8.2"></a><span id="l8.2" class="difflineminus">--- /dev/null</span>
<a href="#l8.3"></a><span id="l8.3" class="difflineplus">+++ b/mailnews/addrbook/content/abCardDAVDialog.js</span>
<a href="#l8.4"></a><span id="l8.4" class="difflineat">@@ -0,0 +1,231 @@</span>
<a href="#l8.5"></a><span id="l8.5" class="difflineplus">+/* This Source Code Form is subject to the terms of the Mozilla Public</span>
<a href="#l8.6"></a><span id="l8.6" class="difflineplus">+ * License, v. 2.0. If a copy of the MPL was not distributed with this</span>
<a href="#l8.7"></a><span id="l8.7" class="difflineplus">+ * file, you can obtain one at http://mozilla.org/MPL/2.0/. */</span>
<a href="#l8.8"></a><span id="l8.8" class="difflineplus">+</span>
<a href="#l8.9"></a><span id="l8.9" class="difflineplus">+var { Services } = ChromeUtils.import(&quot;resource://gre/modules/Services.jsm&quot;);</span>
<a href="#l8.10"></a><span id="l8.10" class="difflineplus">+var { MailServices } = ChromeUtils.import(</span>
<a href="#l8.11"></a><span id="l8.11" class="difflineplus">+  &quot;resource:///modules/MailServices.jsm&quot;</span>
<a href="#l8.12"></a><span id="l8.12" class="difflineplus">+);</span>
<a href="#l8.13"></a><span id="l8.13" class="difflineplus">+var { CardDAVDirectory } = ChromeUtils.import(</span>
<a href="#l8.14"></a><span id="l8.14" class="difflineplus">+  &quot;resource:///modules/CardDAVDirectory.jsm&quot;</span>
<a href="#l8.15"></a><span id="l8.15" class="difflineplus">+);</span>
<a href="#l8.16"></a><span id="l8.16" class="difflineplus">+</span>
<a href="#l8.17"></a><span id="l8.17" class="difflineplus">+var gUrl;</span>
<a href="#l8.18"></a><span id="l8.18" class="difflineplus">+var gUsername;</span>
<a href="#l8.19"></a><span id="l8.19" class="difflineplus">+var gPassword;</span>
<a href="#l8.20"></a><span id="l8.20" class="difflineplus">+</span>
<a href="#l8.21"></a><span id="l8.21" class="difflineplus">+var uiElements = {};</span>
<a href="#l8.22"></a><span id="l8.22" class="difflineplus">+</span>
<a href="#l8.23"></a><span id="l8.23" class="difflineplus">+window.addEventListener(&quot;DOMContentLoaded&quot;, async () =&gt; {</span>
<a href="#l8.24"></a><span id="l8.24" class="difflineplus">+  for (let id of [</span>
<a href="#l8.25"></a><span id="l8.25" class="difflineplus">+    &quot;dialog&quot;,</span>
<a href="#l8.26"></a><span id="l8.26" class="difflineplus">+    &quot;url&quot;,</span>
<a href="#l8.27"></a><span id="l8.27" class="difflineplus">+    &quot;username&quot;,</span>
<a href="#l8.28"></a><span id="l8.28" class="difflineplus">+    &quot;password&quot;,</span>
<a href="#l8.29"></a><span id="l8.29" class="difflineplus">+    &quot;rememberPassword&quot;,</span>
<a href="#l8.30"></a><span id="l8.30" class="difflineplus">+    &quot;statusArea&quot;,</span>
<a href="#l8.31"></a><span id="l8.31" class="difflineplus">+    &quot;statusMessage&quot;,</span>
<a href="#l8.32"></a><span id="l8.32" class="difflineplus">+    &quot;resultsArea&quot;,</span>
<a href="#l8.33"></a><span id="l8.33" class="difflineplus">+    &quot;availableBooks&quot;,</span>
<a href="#l8.34"></a><span id="l8.34" class="difflineplus">+  ]) {</span>
<a href="#l8.35"></a><span id="l8.35" class="difflineplus">+    uiElements[id] = document.getElementById(&quot;carddav-&quot; + id);</span>
<a href="#l8.36"></a><span id="l8.36" class="difflineplus">+  }</span>
<a href="#l8.37"></a><span id="l8.37" class="difflineplus">+</span>
<a href="#l8.38"></a><span id="l8.38" class="difflineplus">+  await document.l10n.ready;</span>
<a href="#l8.39"></a><span id="l8.39" class="difflineplus">+</span>
<a href="#l8.40"></a><span id="l8.40" class="difflineplus">+  let presets = {</span>
<a href="#l8.41"></a><span id="l8.41" class="difflineplus">+    Fastmail: &quot;https://carddav.fastmail.com&quot;,</span>
<a href="#l8.42"></a><span id="l8.42" class="difflineplus">+    Google: &quot;https://www.googleapis.com&quot;,</span>
<a href="#l8.43"></a><span id="l8.43" class="difflineplus">+  };</span>
<a href="#l8.44"></a><span id="l8.44" class="difflineplus">+  // TODO: Only load presets of accounts we have.</span>
<a href="#l8.45"></a><span id="l8.45" class="difflineplus">+  let provider = document.getElementById(&quot;carddav-provider&quot;);</span>
<a href="#l8.46"></a><span id="l8.46" class="difflineplus">+  for (let [label, hostname] of Object.entries(presets)) {</span>
<a href="#l8.47"></a><span id="l8.47" class="difflineplus">+    let option = document.createElementNS(</span>
<a href="#l8.48"></a><span id="l8.48" class="difflineplus">+      &quot;http://www.w3.org/1999/xhtml&quot;,</span>
<a href="#l8.49"></a><span id="l8.49" class="difflineplus">+      &quot;option&quot;</span>
<a href="#l8.50"></a><span id="l8.50" class="difflineplus">+    );</span>
<a href="#l8.51"></a><span id="l8.51" class="difflineplus">+    option.label = label;</span>
<a href="#l8.52"></a><span id="l8.52" class="difflineplus">+    option.value = hostname;</span>
<a href="#l8.53"></a><span id="l8.53" class="difflineplus">+    provider.appendChild(option);</span>
<a href="#l8.54"></a><span id="l8.54" class="difflineplus">+  }</span>
<a href="#l8.55"></a><span id="l8.55" class="difflineplus">+  let other = document.createElementNS(</span>
<a href="#l8.56"></a><span id="l8.56" class="difflineplus">+    &quot;http://www.w3.org/1999/xhtml&quot;,</span>
<a href="#l8.57"></a><span id="l8.57" class="difflineplus">+    &quot;option&quot;</span>
<a href="#l8.58"></a><span id="l8.58" class="difflineplus">+  );</span>
<a href="#l8.59"></a><span id="l8.59" class="difflineplus">+  other.value = &quot;&quot;;</span>
<a href="#l8.60"></a><span id="l8.60" class="difflineplus">+  other.setAttribute(&quot;data-l10n-id&quot;, &quot;carddav-provider-option-other&quot;);</span>
<a href="#l8.61"></a><span id="l8.61" class="difflineplus">+  provider.appendChild(other);</span>
<a href="#l8.62"></a><span id="l8.62" class="difflineplus">+</span>
<a href="#l8.63"></a><span id="l8.63" class="difflineplus">+  uiElements.url.value = provider.value;</span>
<a href="#l8.64"></a><span id="l8.64" class="difflineplus">+});</span>
<a href="#l8.65"></a><span id="l8.65" class="difflineplus">+</span>
<a href="#l8.66"></a><span id="l8.66" class="difflineplus">+function handleChangeProvider(event) {</span>
<a href="#l8.67"></a><span id="l8.67" class="difflineplus">+  uiElements.url.value = event.target.value;</span>
<a href="#l8.68"></a><span id="l8.68" class="difflineplus">+  changeCardDAVURL(uiElements.url.value);</span>
<a href="#l8.69"></a><span id="l8.69" class="difflineplus">+}</span>
<a href="#l8.70"></a><span id="l8.70" class="difflineplus">+</span>
<a href="#l8.71"></a><span id="l8.71" class="difflineplus">+function handleCardDAVURLInput(event) {</span>
<a href="#l8.72"></a><span id="l8.72" class="difflineplus">+  changeCardDAVURL(event.target.value);</span>
<a href="#l8.73"></a><span id="l8.73" class="difflineplus">+}</span>
<a href="#l8.74"></a><span id="l8.74" class="difflineplus">+</span>
<a href="#l8.75"></a><span id="l8.75" class="difflineplus">+function changeCardDAVURL(value) {</span>
<a href="#l8.76"></a><span id="l8.76" class="difflineplus">+  setStatus();</span>
<a href="#l8.77"></a><span id="l8.77" class="difflineplus">+  uiElements.resultsArea.hidden = true;</span>
<a href="#l8.78"></a><span id="l8.78" class="difflineplus">+  gUrl = uiElements.url.value.trim();</span>
<a href="#l8.79"></a><span id="l8.79" class="difflineplus">+  if (gUrl &amp;&amp; !gUrl.match(/^https?:\/\//)) {</span>
<a href="#l8.80"></a><span id="l8.80" class="difflineplus">+    gUrl = &quot;https://&quot; + gUrl;</span>
<a href="#l8.81"></a><span id="l8.81" class="difflineplus">+  }</span>
<a href="#l8.82"></a><span id="l8.82" class="difflineplus">+  gUrl = gUrl ? new URL(gUrl) : &quot;&quot;;</span>
<a href="#l8.83"></a><span id="l8.83" class="difflineplus">+}</span>
<a href="#l8.84"></a><span id="l8.84" class="difflineplus">+</span>
<a href="#l8.85"></a><span id="l8.85" class="difflineplus">+async function check() {</span>
<a href="#l8.86"></a><span id="l8.86" class="difflineplus">+  gUrl = uiElements.url.value;</span>
<a href="#l8.87"></a><span id="l8.87" class="difflineplus">+  gUsername = uiElements.username.value;</span>
<a href="#l8.88"></a><span id="l8.88" class="difflineplus">+  gPassword = uiElements.password.value;</span>
<a href="#l8.89"></a><span id="l8.89" class="difflineplus">+</span>
<a href="#l8.90"></a><span id="l8.90" class="difflineplus">+  setStatus(&quot;loading&quot;, &quot;carddav-loading&quot;);</span>
<a href="#l8.91"></a><span id="l8.91" class="difflineplus">+</span>
<a href="#l8.92"></a><span id="l8.92" class="difflineplus">+  try {</span>
<a href="#l8.93"></a><span id="l8.93" class="difflineplus">+    if (!gUrl.match(/^https?:\/\//)) {</span>
<a href="#l8.94"></a><span id="l8.94" class="difflineplus">+      gUrl = &quot;https://&quot; + gUrl;</span>
<a href="#l8.95"></a><span id="l8.95" class="difflineplus">+    }</span>
<a href="#l8.96"></a><span id="l8.96" class="difflineplus">+    gUrl = new URL(gUrl);</span>
<a href="#l8.97"></a><span id="l8.97" class="difflineplus">+</span>
<a href="#l8.98"></a><span id="l8.98" class="difflineplus">+    let response = await CardDAVDirectory.makeRequest(</span>
<a href="#l8.99"></a><span id="l8.99" class="difflineplus">+      `${gUrl.origin}/.well-known/carddav`,</span>
<a href="#l8.100"></a><span id="l8.100" class="difflineplus">+      {</span>
<a href="#l8.101"></a><span id="l8.101" class="difflineplus">+        method: &quot;PROPFIND&quot;,</span>
<a href="#l8.102"></a><span id="l8.102" class="difflineplus">+        headers: {</span>
<a href="#l8.103"></a><span id="l8.103" class="difflineplus">+          &quot;Content-Type&quot;: &quot;text/xml&quot;,</span>
<a href="#l8.104"></a><span id="l8.104" class="difflineplus">+          Depth: 0,</span>
<a href="#l8.105"></a><span id="l8.105" class="difflineplus">+        },</span>
<a href="#l8.106"></a><span id="l8.106" class="difflineplus">+        body: `&lt;propfind xmlns=&quot;DAV:&quot;&gt;</span>
<a href="#l8.107"></a><span id="l8.107" class="difflineplus">+        &lt;prop&gt;</span>
<a href="#l8.108"></a><span id="l8.108" class="difflineplus">+          &lt;current-user-principal/&gt;</span>
<a href="#l8.109"></a><span id="l8.109" class="difflineplus">+        &lt;/prop&gt;</span>
<a href="#l8.110"></a><span id="l8.110" class="difflineplus">+      &lt;/propfind&gt;`,</span>
<a href="#l8.111"></a><span id="l8.111" class="difflineplus">+      }</span>
<a href="#l8.112"></a><span id="l8.112" class="difflineplus">+    );</span>
<a href="#l8.113"></a><span id="l8.113" class="difflineplus">+    let href =</span>
<a href="#l8.114"></a><span id="l8.114" class="difflineplus">+      gUrl.origin +</span>
<a href="#l8.115"></a><span id="l8.115" class="difflineplus">+      response.dom.querySelector(&quot;current-user-principal href&quot;).textContent;</span>
<a href="#l8.116"></a><span id="l8.116" class="difflineplus">+</span>
<a href="#l8.117"></a><span id="l8.117" class="difflineplus">+    response = await CardDAVDirectory.makeRequest(href, {</span>
<a href="#l8.118"></a><span id="l8.118" class="difflineplus">+      method: &quot;PROPFIND&quot;,</span>
<a href="#l8.119"></a><span id="l8.119" class="difflineplus">+      headers: {</span>
<a href="#l8.120"></a><span id="l8.120" class="difflineplus">+        &quot;Content-Type&quot;: &quot;text/xml&quot;,</span>
<a href="#l8.121"></a><span id="l8.121" class="difflineplus">+        Depth: 0,</span>
<a href="#l8.122"></a><span id="l8.122" class="difflineplus">+      },</span>
<a href="#l8.123"></a><span id="l8.123" class="difflineplus">+      body: `&lt;propfind xmlns=&quot;DAV:&quot; xmlns:card=&quot;urn:ietf:params:xml:ns:carddav&quot;&gt;</span>
<a href="#l8.124"></a><span id="l8.124" class="difflineplus">+        &lt;prop&gt;</span>
<a href="#l8.125"></a><span id="l8.125" class="difflineplus">+          &lt;card:addressbook-home-set/&gt;</span>
<a href="#l8.126"></a><span id="l8.126" class="difflineplus">+        &lt;/prop&gt;</span>
<a href="#l8.127"></a><span id="l8.127" class="difflineplus">+      &lt;/propfind&gt;`,</span>
<a href="#l8.128"></a><span id="l8.128" class="difflineplus">+    });</span>
<a href="#l8.129"></a><span id="l8.129" class="difflineplus">+    href =</span>
<a href="#l8.130"></a><span id="l8.130" class="difflineplus">+      gUrl.origin +</span>
<a href="#l8.131"></a><span id="l8.131" class="difflineplus">+      response.dom.querySelector(&quot;addressbook-home-set href&quot;).textContent;</span>
<a href="#l8.132"></a><span id="l8.132" class="difflineplus">+</span>
<a href="#l8.133"></a><span id="l8.133" class="difflineplus">+    response = await CardDAVDirectory.makeRequest(href, {</span>
<a href="#l8.134"></a><span id="l8.134" class="difflineplus">+      method: &quot;PROPFIND&quot;,</span>
<a href="#l8.135"></a><span id="l8.135" class="difflineplus">+      headers: {</span>
<a href="#l8.136"></a><span id="l8.136" class="difflineplus">+        &quot;Content-Type&quot;: &quot;text/xml&quot;,</span>
<a href="#l8.137"></a><span id="l8.137" class="difflineplus">+        Depth: 1,</span>
<a href="#l8.138"></a><span id="l8.138" class="difflineplus">+      },</span>
<a href="#l8.139"></a><span id="l8.139" class="difflineplus">+      body: `&lt;propfind xmlns=&quot;DAV:&quot; xmlns:cs=&quot;http://calendarserver.org/ns/&quot;&gt;</span>
<a href="#l8.140"></a><span id="l8.140" class="difflineplus">+        &lt;prop&gt;</span>
<a href="#l8.141"></a><span id="l8.141" class="difflineplus">+          &lt;resourcetype/&gt;</span>
<a href="#l8.142"></a><span id="l8.142" class="difflineplus">+          &lt;displayname/&gt;</span>
<a href="#l8.143"></a><span id="l8.143" class="difflineplus">+          &lt;cs:getctag/&gt;</span>
<a href="#l8.144"></a><span id="l8.144" class="difflineplus">+        &lt;/prop&gt;</span>
<a href="#l8.145"></a><span id="l8.145" class="difflineplus">+      &lt;/propfind&gt;`,</span>
<a href="#l8.146"></a><span id="l8.146" class="difflineplus">+    });</span>
<a href="#l8.147"></a><span id="l8.147" class="difflineplus">+</span>
<a href="#l8.148"></a><span id="l8.148" class="difflineplus">+    while (uiElements.availableBooks.lastChild) {</span>
<a href="#l8.149"></a><span id="l8.149" class="difflineplus">+      uiElements.availableBooks.lastChild.remove();</span>
<a href="#l8.150"></a><span id="l8.150" class="difflineplus">+    }</span>
<a href="#l8.151"></a><span id="l8.151" class="difflineplus">+</span>
<a href="#l8.152"></a><span id="l8.152" class="difflineplus">+    let existing = [...MailServices.ab.directories].map(d =&gt;</span>
<a href="#l8.153"></a><span id="l8.153" class="difflineplus">+      d.getStringValue(&quot;carddav.url&quot;, &quot;&quot;)</span>
<a href="#l8.154"></a><span id="l8.154" class="difflineplus">+    );</span>
<a href="#l8.155"></a><span id="l8.155" class="difflineplus">+    let alreadyAdded = 0;</span>
<a href="#l8.156"></a><span id="l8.156" class="difflineplus">+    for (let r of response.dom.querySelectorAll(&quot;response&quot;)) {</span>
<a href="#l8.157"></a><span id="l8.157" class="difflineplus">+      if (r.querySelector(&quot;resourcetype addressbook&quot;)) {</span>
<a href="#l8.158"></a><span id="l8.158" class="difflineplus">+        let bookURL = new URL(r.querySelector(&quot;href&quot;).textContent, gUrl).href;</span>
<a href="#l8.159"></a><span id="l8.159" class="difflineplus">+        if (existing.includes(bookURL)) {</span>
<a href="#l8.160"></a><span id="l8.160" class="difflineplus">+          alreadyAdded++;</span>
<a href="#l8.161"></a><span id="l8.161" class="difflineplus">+          continue;</span>
<a href="#l8.162"></a><span id="l8.162" class="difflineplus">+        }</span>
<a href="#l8.163"></a><span id="l8.163" class="difflineplus">+        let checkbox = uiElements.availableBooks.appendChild(</span>
<a href="#l8.164"></a><span id="l8.164" class="difflineplus">+          document.createXULElement(&quot;checkbox&quot;)</span>
<a href="#l8.165"></a><span id="l8.165" class="difflineplus">+        );</span>
<a href="#l8.166"></a><span id="l8.166" class="difflineplus">+        checkbox.setAttribute(</span>
<a href="#l8.167"></a><span id="l8.167" class="difflineplus">+          &quot;label&quot;,</span>
<a href="#l8.168"></a><span id="l8.168" class="difflineplus">+          r.querySelector(&quot;displayname&quot;).textContent</span>
<a href="#l8.169"></a><span id="l8.169" class="difflineplus">+        );</span>
<a href="#l8.170"></a><span id="l8.170" class="difflineplus">+        checkbox.checked = true;</span>
<a href="#l8.171"></a><span id="l8.171" class="difflineplus">+        checkbox.value = bookURL;</span>
<a href="#l8.172"></a><span id="l8.172" class="difflineplus">+      }</span>
<a href="#l8.173"></a><span id="l8.173" class="difflineplus">+    }</span>
<a href="#l8.174"></a><span id="l8.174" class="difflineplus">+    if (uiElements.availableBooks.childElementCount == 0) {</span>
<a href="#l8.175"></a><span id="l8.175" class="difflineplus">+      if (alreadyAdded &gt; 0) {</span>
<a href="#l8.176"></a><span id="l8.176" class="difflineplus">+        setStatus(&quot;error&quot;, &quot;carddav-already-added&quot;);</span>
<a href="#l8.177"></a><span id="l8.177" class="difflineplus">+      } else {</span>
<a href="#l8.178"></a><span id="l8.178" class="difflineplus">+        setStatus(&quot;error&quot;, &quot;carddav-none-found&quot;);</span>
<a href="#l8.179"></a><span id="l8.179" class="difflineplus">+      }</span>
<a href="#l8.180"></a><span id="l8.180" class="difflineplus">+    } else {</span>
<a href="#l8.181"></a><span id="l8.181" class="difflineplus">+      uiElements.resultsArea.hidden = false;</span>
<a href="#l8.182"></a><span id="l8.182" class="difflineplus">+      setStatus();</span>
<a href="#l8.183"></a><span id="l8.183" class="difflineplus">+    }</span>
<a href="#l8.184"></a><span id="l8.184" class="difflineplus">+  } catch (ex) {</span>
<a href="#l8.185"></a><span id="l8.185" class="difflineplus">+    setStatus(&quot;error&quot;, &quot;carddav-connection-error&quot;);</span>
<a href="#l8.186"></a><span id="l8.186" class="difflineplus">+  }</span>
<a href="#l8.187"></a><span id="l8.187" class="difflineplus">+}</span>
<a href="#l8.188"></a><span id="l8.188" class="difflineplus">+</span>
<a href="#l8.189"></a><span id="l8.189" class="difflineplus">+function setStatus(status, message) {</span>
<a href="#l8.190"></a><span id="l8.190" class="difflineplus">+  uiElements.dialog.getButton(&quot;accept&quot;).disabled = status == &quot;error&quot;;</span>
<a href="#l8.191"></a><span id="l8.191" class="difflineplus">+  if (status) {</span>
<a href="#l8.192"></a><span id="l8.192" class="difflineplus">+    uiElements.statusArea.setAttribute(&quot;status&quot;, status);</span>
<a href="#l8.193"></a><span id="l8.193" class="difflineplus">+    document.l10n.setAttributes(uiElements.statusMessage, message);</span>
<a href="#l8.194"></a><span id="l8.194" class="difflineplus">+    window.sizeToContent();</span>
<a href="#l8.195"></a><span id="l8.195" class="difflineplus">+  } else {</span>
<a href="#l8.196"></a><span id="l8.196" class="difflineplus">+    uiElements.statusArea.removeAttribute(&quot;status&quot;);</span>
<a href="#l8.197"></a><span id="l8.197" class="difflineplus">+    document.l10n.setAttributes(uiElements.statusMessage, null);</span>
<a href="#l8.198"></a><span id="l8.198" class="difflineplus">+  }</span>
<a href="#l8.199"></a><span id="l8.199" class="difflineplus">+}</span>
<a href="#l8.200"></a><span id="l8.200" class="difflineplus">+</span>
<a href="#l8.201"></a><span id="l8.201" class="difflineplus">+window.addEventListener(&quot;dialogaccept&quot;, event =&gt; {</span>
<a href="#l8.202"></a><span id="l8.202" class="difflineplus">+  if (uiElements.resultsArea.hidden) {</span>
<a href="#l8.203"></a><span id="l8.203" class="difflineplus">+    event.preventDefault();</span>
<a href="#l8.204"></a><span id="l8.204" class="difflineplus">+    check();</span>
<a href="#l8.205"></a><span id="l8.205" class="difflineplus">+    return;</span>
<a href="#l8.206"></a><span id="l8.206" class="difflineplus">+  }</span>
<a href="#l8.207"></a><span id="l8.207" class="difflineplus">+</span>
<a href="#l8.208"></a><span id="l8.208" class="difflineplus">+  if (uiElements.availableBooks.childElementCount == 0) {</span>
<a href="#l8.209"></a><span id="l8.209" class="difflineplus">+    return;</span>
<a href="#l8.210"></a><span id="l8.210" class="difflineplus">+  }</span>
<a href="#l8.211"></a><span id="l8.211" class="difflineplus">+</span>
<a href="#l8.212"></a><span id="l8.212" class="difflineplus">+  let newLoginInfo = Cc[</span>
<a href="#l8.213"></a><span id="l8.213" class="difflineplus">+    &quot;@mozilla.org/login-manager/loginInfo;1&quot;</span>
<a href="#l8.214"></a><span id="l8.214" class="difflineplus">+  ].createInstance(Ci.nsILoginInfo);</span>
<a href="#l8.215"></a><span id="l8.215" class="difflineplus">+  newLoginInfo.init(gUrl.origin, null, &quot;CardDAV&quot;, gUsername, gPassword, &quot;&quot;, &quot;&quot;);</span>
<a href="#l8.216"></a><span id="l8.216" class="difflineplus">+  // TODO: Login might exist.</span>
<a href="#l8.217"></a><span id="l8.217" class="difflineplus">+  Services.logins.addLogin(newLoginInfo);</span>
<a href="#l8.218"></a><span id="l8.218" class="difflineplus">+</span>
<a href="#l8.219"></a><span id="l8.219" class="difflineplus">+  let book;</span>
<a href="#l8.220"></a><span id="l8.220" class="difflineplus">+  for (let checkbox of uiElements.availableBooks.children) {</span>
<a href="#l8.221"></a><span id="l8.221" class="difflineplus">+    if (checkbox.checked) {</span>
<a href="#l8.222"></a><span id="l8.222" class="difflineplus">+      let dirPrefId = MailServices.ab.newAddressBook(</span>
<a href="#l8.223"></a><span id="l8.223" class="difflineplus">+        checkbox.getAttribute(&quot;label&quot;),</span>
<a href="#l8.224"></a><span id="l8.224" class="difflineplus">+        null,</span>
<a href="#l8.225"></a><span id="l8.225" class="difflineplus">+        102,</span>
<a href="#l8.226"></a><span id="l8.226" class="difflineplus">+        null</span>
<a href="#l8.227"></a><span id="l8.227" class="difflineplus">+      );</span>
<a href="#l8.228"></a><span id="l8.228" class="difflineplus">+      book = MailServices.ab.getDirectoryFromId(dirPrefId);</span>
<a href="#l8.229"></a><span id="l8.229" class="difflineplus">+      book.setStringValue(&quot;carddav.url&quot;, checkbox.value);</span>
<a href="#l8.230"></a><span id="l8.230" class="difflineplus">+</span>
<a href="#l8.231"></a><span id="l8.231" class="difflineplus">+      let dir = CardDAVDirectory.forFile(book.fileName);</span>
<a href="#l8.232"></a><span id="l8.232" class="difflineplus">+      dir.fetchAllFromServer();</span>
<a href="#l8.233"></a><span id="l8.233" class="difflineplus">+    }</span>
<a href="#l8.234"></a><span id="l8.234" class="difflineplus">+  }</span>
<a href="#l8.235"></a><span id="l8.235" class="difflineplus">+});</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l9.1"></a><span id="l9.1">new file mode 100644</span>
<a href="#l9.2"></a><span id="l9.2" class="difflineminus">--- /dev/null</span>
<a href="#l9.3"></a><span id="l9.3" class="difflineplus">+++ b/mailnews/addrbook/content/abCardDAVDialog.xhtml</span>
<a href="#l9.4"></a><span id="l9.4" class="difflineat">@@ -0,0 +1,112 @@</span>
<a href="#l9.5"></a><span id="l9.5" class="difflineplus">+&lt;?xml version=&quot;1.0&quot;?&gt;</span>
<a href="#l9.6"></a><span id="l9.6" class="difflineplus">+&lt;!-- This Source Code Form is subject to the terms of the Mozilla Public</span>
<a href="#l9.7"></a><span id="l9.7" class="difflineplus">+   - License, v. 2.0. If a copy of the MPL was not distributed with this</span>
<a href="#l9.8"></a><span id="l9.8" class="difflineplus">+   - file, you can obtain one at http://mozilla.org/MPL/2.0/. --&gt;</span>
<a href="#l9.9"></a><span id="l9.9" class="difflineplus">+</span>
<a href="#l9.10"></a><span id="l9.10" class="difflineplus">+&lt;?xml-stylesheet href=&quot;chrome://messenger/skin/dialogs.css&quot; type=&quot;text/css&quot;?&gt;</span>
<a href="#l9.11"></a><span id="l9.11" class="difflineplus">+&lt;?xml-stylesheet href=&quot;chrome://messenger/skin/menulist.css&quot; type=&quot;text/css&quot;?&gt;</span>
<a href="#l9.12"></a><span id="l9.12" class="difflineplus">+&lt;?xml-stylesheet href=&quot;chrome://messenger/content/addressbook/abCardDAVDialog.css&quot; type=&quot;text/css&quot;?&gt;</span>
<a href="#l9.13"></a><span id="l9.13" class="difflineplus">+</span>
<a href="#l9.14"></a><span id="l9.14" class="difflineplus">+&lt;window data-l10n-id=&quot;carddav-window&quot;</span>
<a href="#l9.15"></a><span id="l9.15" class="difflineplus">+        data-l10n-attrs=&quot;title&quot;</span>
<a href="#l9.16"></a><span id="l9.16" class="difflineplus">+        xmlns=&quot;http://www.mozilla.org/keymaster/gatekeeper/there.is.only.xul&quot;</span>
<a href="#l9.17"></a><span id="l9.17" class="difflineplus">+        xmlns:html=&quot;http://www.w3.org/1999/xhtml&quot;&gt;</span>
<a href="#l9.18"></a><span id="l9.18" class="difflineplus">+&lt;dialog id=&quot;carddav-dialog&quot;</span>
<a href="#l9.19"></a><span id="l9.19" class="difflineplus">+        data-l10n-id=&quot;carddav-dialog&quot;</span>
<a href="#l9.20"></a><span id="l9.20" class="difflineplus">+        data-l10n-attrs=&quot;buttonlabelaccept,buttonaccesskeyaccept&quot;&gt;</span>
<a href="#l9.21"></a><span id="l9.21" class="difflineplus">+</span>
<a href="#l9.22"></a><span id="l9.22" class="difflineplus">+  &lt;linkset&gt;</span>
<a href="#l9.23"></a><span id="l9.23" class="difflineplus">+    &lt;html:link rel=&quot;localization&quot; href=&quot;messenger/addressbook/abCardDAVDialog.ftl&quot;/&gt;</span>
<a href="#l9.24"></a><span id="l9.24" class="difflineplus">+  &lt;/linkset&gt;</span>
<a href="#l9.25"></a><span id="l9.25" class="difflineplus">+</span>
<a href="#l9.26"></a><span id="l9.26" class="difflineplus">+  &lt;script src=&quot;chrome://global/content/globalOverlay.js&quot;/&gt;</span>
<a href="#l9.27"></a><span id="l9.27" class="difflineplus">+  &lt;script src=&quot;chrome://global/content/editMenuOverlay.js&quot;/&gt;</span>
<a href="#l9.28"></a><span id="l9.28" class="difflineplus">+  &lt;script src=&quot;chrome://messenger/content/addressbook/abCardDAVDialog.js&quot;/&gt;</span>
<a href="#l9.29"></a><span id="l9.29" class="difflineplus">+</span>
<a href="#l9.30"></a><span id="l9.30" class="difflineplus">+  &lt;hbox id=&quot;bigScaryWarning&quot;</span>
<a href="#l9.31"></a><span id="l9.31" class="difflineplus">+        align=&quot;center&quot;&gt;</span>
<a href="#l9.32"></a><span id="l9.32" class="difflineplus">+    &lt;image src=&quot;chrome://global/skin/icons/warning.svg&quot;</span>
<a href="#l9.33"></a><span id="l9.33" class="difflineplus">+           width=&quot;32&quot;</span>
<a href="#l9.34"></a><span id="l9.34" class="difflineplus">+           height=&quot;32&quot;/&gt;</span>
<a href="#l9.35"></a><span id="l9.35" class="difflineplus">+    &lt;description data-l10n-id=&quot;carddav-experimental-warning&quot;/&gt;</span>
<a href="#l9.36"></a><span id="l9.36" class="difflineplus">+  &lt;/hbox&gt;</span>
<a href="#l9.37"></a><span id="l9.37" class="difflineplus">+</span>
<a href="#l9.38"></a><span id="l9.38" class="difflineplus">+  &lt;html:table&gt;</span>
<a href="#l9.39"></a><span id="l9.39" class="difflineplus">+    &lt;html:tr&gt;</span>
<a href="#l9.40"></a><span id="l9.40" class="difflineplus">+      &lt;html:th&gt;</span>
<a href="#l9.41"></a><span id="l9.41" class="difflineplus">+        &lt;label control=&quot;carddav-provider&quot;</span>
<a href="#l9.42"></a><span id="l9.42" class="difflineplus">+               data-l10n-id=&quot;carddav-provider-label&quot;</span>
<a href="#l9.43"></a><span id="l9.43" class="difflineplus">+               data-l10n-attrs=&quot;value,accesskey&quot;/&gt;</span>
<a href="#l9.44"></a><span id="l9.44" class="difflineplus">+      &lt;/html:th&gt;</span>
<a href="#l9.45"></a><span id="l9.45" class="difflineplus">+      &lt;html:td&gt;</span>
<a href="#l9.46"></a><span id="l9.46" class="difflineplus">+        &lt;html:select id=&quot;carddav-provider&quot; onchange=&quot;handleChangeProvider(event);&quot;&gt;</span>
<a href="#l9.47"></a><span id="l9.47" class="difflineplus">+        &lt;/html:select&gt;</span>
<a href="#l9.48"></a><span id="l9.48" class="difflineplus">+      &lt;/html:td&gt;</span>
<a href="#l9.49"></a><span id="l9.49" class="difflineplus">+    &lt;/html:tr&gt;</span>
<a href="#l9.50"></a><span id="l9.50" class="difflineplus">+    &lt;html:tr&gt;</span>
<a href="#l9.51"></a><span id="l9.51" class="difflineplus">+      &lt;html:th&gt;</span>
<a href="#l9.52"></a><span id="l9.52" class="difflineplus">+        &lt;label control=&quot;carddav-url&quot;</span>
<a href="#l9.53"></a><span id="l9.53" class="difflineplus">+               data-l10n-id=&quot;carddav-url-label&quot;</span>
<a href="#l9.54"></a><span id="l9.54" class="difflineplus">+               data-l10n-attrs=&quot;value,accesskey&quot;/&gt;</span>
<a href="#l9.55"></a><span id="l9.55" class="difflineplus">+      &lt;/html:th&gt;</span>
<a href="#l9.56"></a><span id="l9.56" class="difflineplus">+      &lt;html:td&gt;</span>
<a href="#l9.57"></a><span id="l9.57" class="difflineplus">+        &lt;html:input id=&quot;carddav-url&quot; type=&quot;url&quot;</span>
<a href="#l9.58"></a><span id="l9.58" class="difflineplus">+                    placeholder=&quot;https://carddav.example.com/dav/addressbooks/user/&quot;</span>
<a href="#l9.59"></a><span id="l9.59" class="difflineplus">+                    oninput=&quot;handleCardDAVURLInput(event);&quot;/&gt;</span>
<a href="#l9.60"></a><span id="l9.60" class="difflineplus">+      &lt;/html:td&gt;</span>
<a href="#l9.61"></a><span id="l9.61" class="difflineplus">+    &lt;/html:tr&gt;</span>
<a href="#l9.62"></a><span id="l9.62" class="difflineplus">+    &lt;html:tr&gt;</span>
<a href="#l9.63"></a><span id="l9.63" class="difflineplus">+      &lt;html:th&gt;</span>
<a href="#l9.64"></a><span id="l9.64" class="difflineplus">+        &lt;label control=&quot;carddav-username&quot;</span>
<a href="#l9.65"></a><span id="l9.65" class="difflineplus">+               data-l10n-id=&quot;carddav-username-label&quot;</span>
<a href="#l9.66"></a><span id="l9.66" class="difflineplus">+               data-l10n-attrs=&quot;value,accesskey&quot;</span>
<a href="#l9.67"></a><span id="l9.67" class="difflineplus">+               flex=&quot;1&quot;/&gt;</span>
<a href="#l9.68"></a><span id="l9.68" class="difflineplus">+      &lt;/html:th&gt;</span>
<a href="#l9.69"></a><span id="l9.69" class="difflineplus">+      &lt;html:td&gt;</span>
<a href="#l9.70"></a><span id="l9.70" class="difflineplus">+        &lt;html:input id=&quot;carddav-username&quot;</span>
<a href="#l9.71"></a><span id="l9.71" class="difflineplus">+                    type=&quot;text&quot;</span>
<a href="#l9.72"></a><span id="l9.72" class="difflineplus">+                    data-l10n-id=&quot;carddav-username-input&quot;/&gt;</span>
<a href="#l9.73"></a><span id="l9.73" class="difflineplus">+      &lt;/html:td&gt;</span>
<a href="#l9.74"></a><span id="l9.74" class="difflineplus">+    &lt;/html:tr&gt;</span>
<a href="#l9.75"></a><span id="l9.75" class="difflineplus">+    &lt;html:tr&gt;</span>
<a href="#l9.76"></a><span id="l9.76" class="difflineplus">+      &lt;html:th&gt;</span>
<a href="#l9.77"></a><span id="l9.77" class="difflineplus">+        &lt;label control=&quot;carddav-password&quot;</span>
<a href="#l9.78"></a><span id="l9.78" class="difflineplus">+               data-l10n-id=&quot;carddav-password-label&quot;</span>
<a href="#l9.79"></a><span id="l9.79" class="difflineplus">+               flex=&quot;1&quot;/&gt;</span>
<a href="#l9.80"></a><span id="l9.80" class="difflineplus">+      &lt;/html:th&gt;</span>
<a href="#l9.81"></a><span id="l9.81" class="difflineplus">+      &lt;html:td&gt;</span>
<a href="#l9.82"></a><span id="l9.82" class="difflineplus">+        &lt;html:input id=&quot;carddav-password&quot; type=&quot;password&quot;/&gt;</span>
<a href="#l9.83"></a><span id="l9.83" class="difflineplus">+      &lt;/html:td&gt;</span>
<a href="#l9.84"></a><span id="l9.84" class="difflineplus">+    &lt;/html:tr&gt;</span>
<a href="#l9.85"></a><span id="l9.85" class="difflineplus">+    &lt;html:tr&gt;</span>
<a href="#l9.86"></a><span id="l9.86" class="difflineplus">+      &lt;html:th&gt;&lt;/html:th&gt;</span>
<a href="#l9.87"></a><span id="l9.87" class="difflineplus">+      &lt;html:td&gt;</span>
<a href="#l9.88"></a><span id="l9.88" class="difflineplus">+        &lt;checkbox id=&quot;carddav-rememberPassword&quot;</span>
<a href="#l9.89"></a><span id="l9.89" class="difflineplus">+                  data-l10n-id=&quot;carddav-remember-password&quot;</span>
<a href="#l9.90"></a><span id="l9.90" class="difflineplus">+                  data-l10n-attrs=&quot;label,accesskey&quot;</span>
<a href="#l9.91"></a><span id="l9.91" class="difflineplus">+                  checked=&quot;true&quot;/&gt;</span>
<a href="#l9.92"></a><span id="l9.92" class="difflineplus">+      &lt;/html:td&gt;</span>
<a href="#l9.93"></a><span id="l9.93" class="difflineplus">+    &lt;/html:tr&gt;</span>
<a href="#l9.94"></a><span id="l9.94" class="difflineplus">+  &lt;/html:table&gt;</span>
<a href="#l9.95"></a><span id="l9.95" class="difflineplus">+</span>
<a href="#l9.96"></a><span id="l9.96" class="difflineplus">+  &lt;vbox id=&quot;carddav-statusArea&quot;</span>
<a href="#l9.97"></a><span id="l9.97" class="difflineplus">+        align=&quot;center&quot;</span>
<a href="#l9.98"></a><span id="l9.98" class="difflineplus">+        pack=&quot;center&quot;&gt;</span>
<a href="#l9.99"></a><span id="l9.99" class="difflineplus">+    &lt;hbox align=&quot;center&quot;</span>
<a href="#l9.100"></a><span id="l9.100" class="difflineplus">+          pack=&quot;center&quot;&gt;</span>
<a href="#l9.101"></a><span id="l9.101" class="difflineplus">+      &lt;image id=&quot;statusImageBefore&quot;/&gt;</span>
<a href="#l9.102"></a><span id="l9.102" class="difflineplus">+      &lt;description id=&quot;carddav-statusMessage&quot;</span>
<a href="#l9.103"></a><span id="l9.103" class="difflineplus">+                   flex=&quot;1&quot;&gt;&amp;#160;&lt;/description&gt;</span>
<a href="#l9.104"></a><span id="l9.104" class="difflineplus">+        &lt;!-- Include 160 = nbsp, to make the element occupy the</span>
<a href="#l9.105"></a><span id="l9.105" class="difflineplus">+            full height, for at least one line. With a normal space,</span>
<a href="#l9.106"></a><span id="l9.106" class="difflineplus">+            it does not have sufficient height. --&gt;</span>
<a href="#l9.107"></a><span id="l9.107" class="difflineplus">+    &lt;/hbox&gt;</span>
<a href="#l9.108"></a><span id="l9.108" class="difflineplus">+  &lt;/vbox&gt;</span>
<a href="#l9.109"></a><span id="l9.109" class="difflineplus">+</span>
<a href="#l9.110"></a><span id="l9.110" class="difflineplus">+  &lt;vbox id=&quot;carddav-resultsArea&quot;</span>
<a href="#l9.111"></a><span id="l9.111" class="difflineplus">+        hidden=&quot;true&quot;&gt;</span>
<a href="#l9.112"></a><span id="l9.112" class="difflineplus">+    &lt;label data-l10n-id=&quot;carddav-available-books&quot;/&gt;</span>
<a href="#l9.113"></a><span id="l9.113" class="difflineplus">+    &lt;vbox id=&quot;carddav-availableBooks&quot;&gt;&lt;/vbox&gt;</span>
<a href="#l9.114"></a><span id="l9.114" class="difflineplus">+  &lt;/vbox&gt;</span>
<a href="#l9.115"></a><span id="l9.115" class="difflineplus">+&lt;/dialog&gt;</span>
<a href="#l9.116"></a><span id="l9.116" class="difflineplus">+&lt;/window&gt;</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l10.1"></a><span id="l10.1" class="difflineminus">--- a/mailnews/addrbook/jsaddrbook/AddrBookDirectory.jsm</span>
<a href="#l10.2"></a><span id="l10.2" class="difflineplus">+++ b/mailnews/addrbook/jsaddrbook/AddrBookDirectory.jsm</span>
<a href="#l10.3"></a><span id="l10.3" class="difflineat">@@ -43,22 +43,26 @@ ChromeUtils.defineModuleGetter(</span>
<a href="#l10.4"></a><span id="l10.4">   this,</span>
<a href="#l10.5"></a><span id="l10.5">   &quot;newUID&quot;,</span>
<a href="#l10.6"></a><span id="l10.6">   &quot;resource:///modules/AddrBookUtils.jsm&quot;</span>
<a href="#l10.7"></a><span id="l10.7"> );</span>
<a href="#l10.8"></a><span id="l10.8"> </span>
<a href="#l10.9"></a><span id="l10.9"> // Keep track of all database connections, and close them at shutdown, since</span>
<a href="#l10.10"></a><span id="l10.10"> // nothing else ever tells us to close them.</span>
<a href="#l10.11"></a><span id="l10.11"> </span>
<a href="#l10.12"></a><span id="l10.12" class="difflineplus">+// Also track all directories by filename, for AddrBookDirectory.forFile.</span>
<a href="#l10.13"></a><span id="l10.13" class="difflineplus">+</span>
<a href="#l10.14"></a><span id="l10.14"> var connections = new Map();</span>
<a href="#l10.15"></a><span id="l10.15" class="difflineplus">+var directories = new Map();</span>
<a href="#l10.16"></a><span id="l10.16"> Services.obs.addObserver(() =&gt; {</span>
<a href="#l10.17"></a><span id="l10.17">   for (let connection of connections.values()) {</span>
<a href="#l10.18"></a><span id="l10.18">     connection.asyncClose();</span>
<a href="#l10.19"></a><span id="l10.19">   }</span>
<a href="#l10.20"></a><span id="l10.20">   connections.clear();</span>
<a href="#l10.21"></a><span id="l10.21" class="difflineplus">+  directories.clear();</span>
<a href="#l10.22"></a><span id="l10.22"> }, &quot;quit-application&quot;);</span>
<a href="#l10.23"></a><span id="l10.23"> </span>
<a href="#l10.24"></a><span id="l10.24"> // Close a connection on demand. This serves as an escape hatch from C++ code.</span>
<a href="#l10.25"></a><span id="l10.25"> </span>
<a href="#l10.26"></a><span id="l10.26"> Services.obs.addObserver(async file =&gt; {</span>
<a href="#l10.27"></a><span id="l10.27">   file.QueryInterface(Ci.nsIFile);</span>
<a href="#l10.28"></a><span id="l10.28">   await closeConnectionTo(file);</span>
<a href="#l10.29"></a><span id="l10.29">   Services.obs.notifyObservers(file, &quot;addrbook-close-ab-complete&quot;);</span>
<a href="#l10.30"></a><span id="l10.30" class="difflineat">@@ -102,16 +106,17 @@ function openConnectionTo(file) {</span>
<a href="#l10.31"></a><span id="l10.31">   }</span>
<a href="#l10.32"></a><span id="l10.32">   return connection;</span>
<a href="#l10.33"></a><span id="l10.33"> }</span>
<a href="#l10.34"></a><span id="l10.34"> </span>
<a href="#l10.35"></a><span id="l10.35"> /**</span>
<a href="#l10.36"></a><span id="l10.36">  * Closes the SQLite connection to `file` and removes it from the cache.</span>
<a href="#l10.37"></a><span id="l10.37">  */</span>
<a href="#l10.38"></a><span id="l10.38"> function closeConnectionTo(file) {</span>
<a href="#l10.39"></a><span id="l10.39" class="difflineplus">+  directories.delete(file.leafName);</span>
<a href="#l10.40"></a><span id="l10.40">   let connection = connections.get(file.path);</span>
<a href="#l10.41"></a><span id="l10.41">   if (connection) {</span>
<a href="#l10.42"></a><span id="l10.42">     return new Promise(resolve =&gt; {</span>
<a href="#l10.43"></a><span id="l10.43">       connection.asyncClose({</span>
<a href="#l10.44"></a><span id="l10.44">         complete() {</span>
<a href="#l10.45"></a><span id="l10.45">           resolve();</span>
<a href="#l10.46"></a><span id="l10.46">         },</span>
<a href="#l10.47"></a><span id="l10.47">       });</span>
<a href="#l10.48"></a><span id="l10.48" class="difflineat">@@ -156,16 +161,17 @@ class AddrBookDirectory {</span>
<a href="#l10.49"></a><span id="l10.49">     // Make sure we always have a file. If a file is not created, the</span>
<a href="#l10.50"></a><span id="l10.50">     // filename may be accidentally reused.</span>
<a href="#l10.51"></a><span id="l10.51">     let file = FileUtils.getFile(&quot;ProfD&quot;, [fileName]);</span>
<a href="#l10.52"></a><span id="l10.52">     if (!file.exists()) {</span>
<a href="#l10.53"></a><span id="l10.53">       file.create(Ci.nsIFile.NORMAL_FILE_TYPE, 0o644);</span>
<a href="#l10.54"></a><span id="l10.54">     }</span>
<a href="#l10.55"></a><span id="l10.55"> </span>
<a href="#l10.56"></a><span id="l10.56">     this._fileName = fileName;</span>
<a href="#l10.57"></a><span id="l10.57" class="difflineplus">+    directories.set(fileName, this);</span>
<a href="#l10.58"></a><span id="l10.58">   }</span>
<a href="#l10.59"></a><span id="l10.59"> </span>
<a href="#l10.60"></a><span id="l10.60">   get _prefBranch() {</span>
<a href="#l10.61"></a><span id="l10.61">     if (!this.dirPrefId) {</span>
<a href="#l10.62"></a><span id="l10.62">       throw Components.Exception(&quot;&quot;, Cr.NS_ERROR_NOT_AVAILABLE);</span>
<a href="#l10.63"></a><span id="l10.63">     }</span>
<a href="#l10.64"></a><span id="l10.64">     return Services.prefs.getBranch(`${this.dirPrefId}.`);</span>
<a href="#l10.65"></a><span id="l10.65">   }</span>
<a href="#l10.66"></a><span id="l10.66" class="difflineat">@@ -1074,15 +1080,19 @@ class AddrBookDirectory {</span>
<a href="#l10.67"></a><span id="l10.67">     );</span>
<a href="#l10.68"></a><span id="l10.68">     valueLocal.data = value;</span>
<a href="#l10.69"></a><span id="l10.69">     this._prefBranch.setComplexValue(</span>
<a href="#l10.70"></a><span id="l10.70">       name,</span>
<a href="#l10.71"></a><span id="l10.71">       Ci.nsIPrefLocalizedString,</span>
<a href="#l10.72"></a><span id="l10.72">       valueLocal</span>
<a href="#l10.73"></a><span id="l10.73">     );</span>
<a href="#l10.74"></a><span id="l10.74">   }</span>
<a href="#l10.75"></a><span id="l10.75" class="difflineplus">+</span>
<a href="#l10.76"></a><span id="l10.76" class="difflineplus">+  static forFile(fileName) {</span>
<a href="#l10.77"></a><span id="l10.77" class="difflineplus">+    return directories.get(fileName);</span>
<a href="#l10.78"></a><span id="l10.78" class="difflineplus">+  }</span>
<a href="#l10.79"></a><span id="l10.79"> }</span>
<a href="#l10.80"></a><span id="l10.80"> AddrBookDirectory.prototype.QueryInterface = ChromeUtils.generateQI([</span>
<a href="#l10.81"></a><span id="l10.81">   Ci.nsIAbDirectory,</span>
<a href="#l10.82"></a><span id="l10.82"> ]);</span>
<a href="#l10.83"></a><span id="l10.83"> AddrBookDirectory.prototype.classID = Components.ID(</span>
<a href="#l10.84"></a><span id="l10.84">   &quot;{e96ee804-0bd3-472f-81a6-8a9d65277ad3}&quot;</span>
<a href="#l10.85"></a><span id="l10.85"> );</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l11.1"></a><span id="l11.1" class="difflineminus">--- a/mailnews/addrbook/jsaddrbook/CardDAVDirectory.jsm</span>
<a href="#l11.2"></a><span id="l11.2" class="difflineplus">+++ b/mailnews/addrbook/jsaddrbook/CardDAVDirectory.jsm</span>
<a href="#l11.3"></a><span id="l11.3" class="difflineat">@@ -401,16 +401,24 @@ class CardDAVDirectory extends AddrBookD</span>
<a href="#l11.4"></a><span id="l11.4"> </span>
<a href="#l11.5"></a><span id="l11.5">     if (cardsToDelete.length &gt; 0) {</span>
<a href="#l11.6"></a><span id="l11.6">       this._syncInProgress = true;</span>
<a href="#l11.7"></a><span id="l11.7">       this.deleteCards(cardsToDelete);</span>
<a href="#l11.8"></a><span id="l11.8">       this._syncInProgress = false;</span>
<a href="#l11.9"></a><span id="l11.9">     }</span>
<a href="#l11.10"></a><span id="l11.10">   }</span>
<a href="#l11.11"></a><span id="l11.11"> </span>
<a href="#l11.12"></a><span id="l11.12" class="difflineplus">+  static forFile(fileName) {</span>
<a href="#l11.13"></a><span id="l11.13" class="difflineplus">+    let directory = super.forFile(fileName);</span>
<a href="#l11.14"></a><span id="l11.14" class="difflineplus">+    if (directory instanceof CardDAVDirectory) {</span>
<a href="#l11.15"></a><span id="l11.15" class="difflineplus">+      return directory;</span>
<a href="#l11.16"></a><span id="l11.16" class="difflineplus">+    }</span>
<a href="#l11.17"></a><span id="l11.17" class="difflineplus">+    return undefined;</span>
<a href="#l11.18"></a><span id="l11.18" class="difflineplus">+  }</span>
<a href="#l11.19"></a><span id="l11.19" class="difflineplus">+</span>
<a href="#l11.20"></a><span id="l11.20">   /**</span>
<a href="#l11.21"></a><span id="l11.21">    * Make an HTTP request. If the request needs a username and password, the</span>
<a href="#l11.22"></a><span id="l11.22">    * given authPrompt is called.</span>
<a href="#l11.23"></a><span id="l11.23">    *</span>
<a href="#l11.24"></a><span id="l11.24">    * @param {String} uri</span>
<a href="#l11.25"></a><span id="l11.25">    * @param {Object} details</span>
<a href="#l11.26"></a><span id="l11.26">    * @param {String} details.method</span>
<a href="#l11.27"></a><span id="l11.27">    * @param {String} details.header</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l12.1"></a><span id="l12.1" class="difflineminus">--- a/mailnews/jar.mn</span>
<a href="#l12.2"></a><span id="l12.2" class="difflineplus">+++ b/mailnews/jar.mn</span>
<a href="#l12.3"></a><span id="l12.3" class="difflineat">@@ -4,16 +4,19 @@</span>
<a href="#l12.4"></a><span id="l12.4"> </span>
<a href="#l12.5"></a><span id="l12.5"> messenger.jar:</span>
<a href="#l12.6"></a><span id="l12.6">     content/messenger/addressbook/pref-directory-add.js                        (addrbook/prefs/content/pref-directory-add.js)</span>
<a href="#l12.7"></a><span id="l12.7">     content/messenger/addressbook/pref-directory-add.xhtml                     (addrbook/prefs/content/pref-directory-add.xhtml)</span>
<a href="#l12.8"></a><span id="l12.8">     content/messenger/addressbook/pref-editdirectories.js                      (addrbook/prefs/content/pref-editdirectories.js)</span>
<a href="#l12.9"></a><span id="l12.9">     content/messenger/addressbook/pref-editdirectories.xhtml                   (addrbook/prefs/content/pref-editdirectories.xhtml)</span>
<a href="#l12.10"></a><span id="l12.10">     content/messenger/addressbook/abAddressBookNameDialog.js                   (addrbook/content/abAddressBookNameDialog.js)</span>
<a href="#l12.11"></a><span id="l12.11">     content/messenger/addressbook/abAddressBookNameDialog.xhtml                (addrbook/content/abAddressBookNameDialog.xhtml)</span>
<a href="#l12.12"></a><span id="l12.12" class="difflineplus">+    content/messenger/addressbook/abCardDAVDialog.css                          (addrbook/content/abCardDAVDialog.css)</span>
<a href="#l12.13"></a><span id="l12.13" class="difflineplus">+    content/messenger/addressbook/abCardDAVDialog.js                           (addrbook/content/abCardDAVDialog.js)</span>
<a href="#l12.14"></a><span id="l12.14" class="difflineplus">+    content/messenger/addressbook/abCardDAVDialog.xhtml                        (addrbook/content/abCardDAVDialog.xhtml)</span>
<a href="#l12.15"></a><span id="l12.15">     content/messenger/addressbook/abResultsPane.js                             (addrbook/content/abResultsPane.js)</span>
<a href="#l12.16"></a><span id="l12.16">     content/messenger/addressbook/abDragDrop.js                                (addrbook/content/abDragDrop.js)</span>
<a href="#l12.17"></a><span id="l12.17">     content/messenger/addressbook/abMailListDialog.js                          (addrbook/content/abMailListDialog.js)</span>
<a href="#l12.18"></a><span id="l12.18">     content/messenger/addressbook/abView.js                                    (addrbook/content/abView.js)</span>
<a href="#l12.19"></a><span id="l12.19">     content/messenger/addressbook/map-list.js                                  (addrbook/content/map-list.js)</span>
<a href="#l12.20"></a><span id="l12.20">     content/messagebody/addressbook/print.css                                  (addrbook/content/print.css)</span>
<a href="#l12.21"></a><span id="l12.21"> *   content/messenger/AccountManager.xhtml                                     (base/prefs/content/AccountManager.xhtml)</span>
<a href="#l12.22"></a><span id="l12.22">     content/messenger/AccountManager.js                                        (base/prefs/content/AccountManager.js)</span></pre></div></div>

<div class="page_footer">
<div class="page_footer_text">comm-central</div>
<div class="page_footer_text" style="padding-left: 10px">Deployed from <a href="https://hg.mozilla.org/hgcustom/version-control-tools/rev/4b0de666d1a4">4b0de666d1a4</a> at 2020-07-30T19:32:31Z.</div>
<div class="rss_logo">
<a href="/comm-central/rss-log">RSS</a>
<a href="/comm-central/atom-log">Atom</a>
</div>
<br />

</div>
</body>
</html>

