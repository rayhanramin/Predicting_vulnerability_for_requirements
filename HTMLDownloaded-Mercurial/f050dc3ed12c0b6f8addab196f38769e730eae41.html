<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en-US" lang="en-US">
<head>
<link rel="icon" href="/static/35f393d6769a/hgicon.png" type="image/png" />
<meta name="robots" content="index, nofollow"/>
<link rel="stylesheet" href="/static/35f393d6769a/style-gitweb.css" type="text/css" />

<style type="text/css">
div.feed {
  float: right;
}
a img {
  border-width: 0px;
}
div.log_link {
  width: 80px;
  background-color: white;
}

div.log_body {
  padding-left: 96px;
}
</style>
<script type="text/javascript" src="/static/35f393d6769a/mercurial.js"></script>

<meta property="og:image" content="/static/35f393d6769a/moz-logo-bw-rgb.svg"/>
<meta property="og:type" content="website"/>

<title>comm-central: changeset 19495:f050dc3ed12c0b6f8addab196f38769e730eae41</title>
<link rel="alternate" type="application/atom+xml"
   href="/comm-central/atom-log" title="Atom feed for comm-central"/>
<link rel="alternate" type="application/rss+xml"
   href="/comm-central/rss-log" title="RSS feed for comm-central"/>

<meta property="og:title" content="comm-central @ f050dc3ed12c0b6f8addab196f38769e730eae41" />
<meta property="og:url" content="/comm-central/rev/f050dc3ed12c0b6f8addab196f38769e730eae41" />
<meta property="og:description" content="Bug 1280817 - Trailing spaces and eol cleanup for js files. r=Ratty a=Ratty" />

</head>
<body>

<div class="page_header">
<div class="logo">
    <a href="https://developer.mozilla.org/en/docs/Mercurial">
        <img src="/static/35f393d6769a/moz-logo-bw-rgb.svg" alt="mercurial" />
    </a>
</div>
<a href="/">Mercurial</a> &gt; <a href="/comm-central">comm-central</a>  / changeset / f050dc3ed12c0b6f8addab196f38769e730eae41 
</div>

<div class="page_nav">
<div>
<a href="/comm-central/summary">summary</a> |
<a href="/comm-central/shortlog/f050dc3ed12c0b6f8addab196f38769e730eae41">shortlog</a> |
<a href="/comm-central/log/f050dc3ed12c0b6f8addab196f38769e730eae41">changelog</a> |
<a href="/comm-central/pushloghtml">pushlog</a> |
<a href="/comm-central/graph/f050dc3ed12c0b6f8addab196f38769e730eae41">graph</a> |
<a href="/comm-central/tags">tags</a> |
<a href="/comm-central/bookmarks">bookmarks</a> |
<a href="/comm-central/branches">branches</a> |
<a href="/comm-central/file/f050dc3ed12c0b6f8addab196f38769e730eae41">files</a> |
changeset |
<a href="/comm-central/raw-rev/f050dc3ed12c0b6f8addab196f38769e730eae41">raw</a>  | <a href="/comm-central/archive/f050dc3ed12c0b6f8addab196f38769e730eae41.zip">zip</a>  |
<a href="/comm-central/help">help</a>
</div>

<div class="search">
<form id="searchform" action="/comm-central/log">

<input name="rev" type="text" value="" size="40" />
<div id="hint">Find changesets by keywords (author, files, the commit message), revision
number or hash, or <a href="/comm-central/help/revsets">revset expression</a>.</div>
</form>
</div>
</div>

<div class="title">
<a href="https://bugzilla.mozilla.org/show_bug.cgi?id=1280817">Bug 1280817</a> - Trailing spaces and eol cleanup for js files. r=Ratty a=Ratty
<span class="logtags"></span>
</div>
<div class="title_text">
<table cellspacing="0">

<tr><td>author</td><td>&#70;&#114;&#97;&#110;&#107;&#45;&#82;&#97;&#105;&#110;&#101;&#114;&#32;&#71;&#114;&#97;&#104;&#108;&#32;&#60;&#102;&#114;&#103;&#114;&#97;&#104;&#108;&#64;&#103;&#109;&#120;&#46;&#110;&#101;&#116;&#62;</td></tr>
<tr><td></td><td class="date age">Tue, 21 Jun 2016 16:13:24 +0200</td></tr>

<tr>
 <td>changeset 19495</td>
 <td style="font-family:monospace"><a class="list" href="/comm-central/rev/f050dc3ed12c0b6f8addab196f38769e730eae41">f050dc3ed12c0b6f8addab196f38769e730eae41</a></td>
</tr>



<tr>
<td>parent 19494</td>
<td style="font-family:monospace">
<a class="list" href="/comm-central/rev/4eb37cac8583023923c3c08e6afd543043126c79">4eb37cac8583023923c3c08e6afd543043126c79</a>
</td>
</tr>

<tr>
<td>child 19496</td>
<td style="font-family:monospace">
<a class="list" href="/comm-central/rev/aff0b19aa11aca7af3bacb6b3aaaa210d2b20369">aff0b19aa11aca7af3bacb6b3aaaa210d2b20369</a>
</td>
</tr>
<tr><td>push id</td><td><a href="/comm-central/pushloghtml?changeset=f050dc3ed12c0b6f8addab196f38769e730eae41">12007</a></td></tr>
<tr><td>push user</td><td>frgrahl@gmx.net</td></tr>
<tr><td>push date</td><td class="date age">Tue, 21 Jun 2016 14:16:23 +0000</td></tr>

<tr><td>treeherder</td><td>comm-central@649c20beaaa9 [<a href="https://treeherder.mozilla.org/#/jobs?repo=comm-central&revision=649c20beaaa95f31f210229170d698a968ab7a2e">default view</a>] [<a href="https://treeherder.mozilla.org/#/jobs?repo=comm-central&revision=649c20beaaa95f31f210229170d698a968ab7a2e&filter-resultStatus=testfailed&filter-resultStatus=busted&filter-resultStatus=exception">failures only]</td></tr>
<tr><td>perfherder</td><td>[<a href="https://treeherder.mozilla.org/perf.html#/compare?originalProject=comm-central&originalRevision=649c20beaaa95f31f210229170d698a968ab7a2e&newProject=comm-central&newRevision=c4ed316106a28757f279a49cae0f228a6ec7cfa7&framework=1" target="_blank">talos</a>] [<a href="https://treeherder.mozilla.org/perf.html#/compare?originalProject=comm-central&originalRevision=649c20beaaa95f31f210229170d698a968ab7a2e&newProject=comm-central&newRevision=c4ed316106a28757f279a49cae0f228a6ec7cfa7&framework=2" target="_blank">build metrics</a>] [<a href="https://treeherder.mozilla.org/perf.html#/compare?originalProject=comm-central&originalRevision=649c20beaaa95f31f210229170d698a968ab7a2e&newProject=comm-central&newRevision=c4ed316106a28757f279a49cae0f228a6ec7cfa7&framework=6" target="_blank">platform microbench</a>] (compared to previous push)</td></tr>
<tr><td>reviewers</td><td><a href="/comm-central/log?rev=reviewer%28Ratty%29&revcount=50">Ratty</a>, <a href="/comm-central/log?rev=reviewer%28Ratty%29&revcount=50">Ratty</a></td></tr>
<tr><td>bugs</td><td><a href="https://bugzilla.mozilla.org/show_bug.cgi?id=1280817">1280817</a></td></tr>




</table></div>

<div class="page_body description"><a href="https://bugzilla.mozilla.org/show_bug.cgi?id=1280817">Bug 1280817</a> - Trailing spaces and eol cleanup for js files. r=Ratty a=Ratty</div>
<div class="list_head"></div>
<div class="title_text">
<table cellspacing="0">

<tr class="parity0">
<td><a class="list" href="/comm-central/diff/f050dc3ed12c0b6f8addab196f38769e730eae41/suite/browser/browser-prefs.js">suite/browser/browser-prefs.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/f050dc3ed12c0b6f8addab196f38769e730eae41/suite/browser/browser-prefs.js">file</a> |
<a href="/comm-central/annotate/f050dc3ed12c0b6f8addab196f38769e730eae41/suite/browser/browser-prefs.js">annotate</a> |
<a href="/comm-central/diff/f050dc3ed12c0b6f8addab196f38769e730eae41/suite/browser/browser-prefs.js">diff</a> |
<a href="/comm-central/comparison/f050dc3ed12c0b6f8addab196f38769e730eae41/suite/browser/browser-prefs.js">comparison</a> |
<a href="/comm-central/log/f050dc3ed12c0b6f8addab196f38769e730eae41/suite/browser/browser-prefs.js">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/f050dc3ed12c0b6f8addab196f38769e730eae41/suite/browser/browser.js">suite/browser/browser.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/f050dc3ed12c0b6f8addab196f38769e730eae41/suite/browser/browser.js">file</a> |
<a href="/comm-central/annotate/f050dc3ed12c0b6f8addab196f38769e730eae41/suite/browser/browser.js">annotate</a> |
<a href="/comm-central/diff/f050dc3ed12c0b6f8addab196f38769e730eae41/suite/browser/browser.js">diff</a> |
<a href="/comm-central/comparison/f050dc3ed12c0b6f8addab196f38769e730eae41/suite/browser/browser.js">comparison</a> |
<a href="/comm-central/log/f050dc3ed12c0b6f8addab196f38769e730eae41/suite/browser/browser.js">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/f050dc3ed12c0b6f8addab196f38769e730eae41/suite/browser/linkToolbarHandler.js">suite/browser/linkToolbarHandler.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/f050dc3ed12c0b6f8addab196f38769e730eae41/suite/browser/linkToolbarHandler.js">file</a> |
<a href="/comm-central/annotate/f050dc3ed12c0b6f8addab196f38769e730eae41/suite/browser/linkToolbarHandler.js">annotate</a> |
<a href="/comm-central/diff/f050dc3ed12c0b6f8addab196f38769e730eae41/suite/browser/linkToolbarHandler.js">diff</a> |
<a href="/comm-central/comparison/f050dc3ed12c0b6f8addab196f38769e730eae41/suite/browser/linkToolbarHandler.js">comparison</a> |
<a href="/comm-central/log/f050dc3ed12c0b6f8addab196f38769e730eae41/suite/browser/linkToolbarHandler.js">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/f050dc3ed12c0b6f8addab196f38769e730eae41/suite/browser/linkToolbarItem.js">suite/browser/linkToolbarItem.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/f050dc3ed12c0b6f8addab196f38769e730eae41/suite/browser/linkToolbarItem.js">file</a> |
<a href="/comm-central/annotate/f050dc3ed12c0b6f8addab196f38769e730eae41/suite/browser/linkToolbarItem.js">annotate</a> |
<a href="/comm-central/diff/f050dc3ed12c0b6f8addab196f38769e730eae41/suite/browser/linkToolbarItem.js">diff</a> |
<a href="/comm-central/comparison/f050dc3ed12c0b6f8addab196f38769e730eae41/suite/browser/linkToolbarItem.js">comparison</a> |
<a href="/comm-central/log/f050dc3ed12c0b6f8addab196f38769e730eae41/suite/browser/linkToolbarItem.js">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/f050dc3ed12c0b6f8addab196f38769e730eae41/suite/browser/linkToolbarOverlay.js">suite/browser/linkToolbarOverlay.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/f050dc3ed12c0b6f8addab196f38769e730eae41/suite/browser/linkToolbarOverlay.js">file</a> |
<a href="/comm-central/annotate/f050dc3ed12c0b6f8addab196f38769e730eae41/suite/browser/linkToolbarOverlay.js">annotate</a> |
<a href="/comm-central/diff/f050dc3ed12c0b6f8addab196f38769e730eae41/suite/browser/linkToolbarOverlay.js">diff</a> |
<a href="/comm-central/comparison/f050dc3ed12c0b6f8addab196f38769e730eae41/suite/browser/linkToolbarOverlay.js">comparison</a> |
<a href="/comm-central/log/f050dc3ed12c0b6f8addab196f38769e730eae41/suite/browser/linkToolbarOverlay.js">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/f050dc3ed12c0b6f8addab196f38769e730eae41/suite/browser/mailNavigatorOverlay.js">suite/browser/mailNavigatorOverlay.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/f050dc3ed12c0b6f8addab196f38769e730eae41/suite/browser/mailNavigatorOverlay.js">file</a> |
<a href="/comm-central/annotate/f050dc3ed12c0b6f8addab196f38769e730eae41/suite/browser/mailNavigatorOverlay.js">annotate</a> |
<a href="/comm-central/diff/f050dc3ed12c0b6f8addab196f38769e730eae41/suite/browser/mailNavigatorOverlay.js">diff</a> |
<a href="/comm-central/comparison/f050dc3ed12c0b6f8addab196f38769e730eae41/suite/browser/mailNavigatorOverlay.js">comparison</a> |
<a href="/comm-central/log/f050dc3ed12c0b6f8addab196f38769e730eae41/suite/browser/mailNavigatorOverlay.js">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/f050dc3ed12c0b6f8addab196f38769e730eae41/suite/browser/metadata.js">suite/browser/metadata.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/f050dc3ed12c0b6f8addab196f38769e730eae41/suite/browser/metadata.js">file</a> |
<a href="/comm-central/annotate/f050dc3ed12c0b6f8addab196f38769e730eae41/suite/browser/metadata.js">annotate</a> |
<a href="/comm-central/diff/f050dc3ed12c0b6f8addab196f38769e730eae41/suite/browser/metadata.js">diff</a> |
<a href="/comm-central/comparison/f050dc3ed12c0b6f8addab196f38769e730eae41/suite/browser/metadata.js">comparison</a> |
<a href="/comm-central/log/f050dc3ed12c0b6f8addab196f38769e730eae41/suite/browser/metadata.js">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/f050dc3ed12c0b6f8addab196f38769e730eae41/suite/browser/navigator.js">suite/browser/navigator.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/f050dc3ed12c0b6f8addab196f38769e730eae41/suite/browser/navigator.js">file</a> |
<a href="/comm-central/annotate/f050dc3ed12c0b6f8addab196f38769e730eae41/suite/browser/navigator.js">annotate</a> |
<a href="/comm-central/diff/f050dc3ed12c0b6f8addab196f38769e730eae41/suite/browser/navigator.js">diff</a> |
<a href="/comm-central/comparison/f050dc3ed12c0b6f8addab196f38769e730eae41/suite/browser/navigator.js">comparison</a> |
<a href="/comm-central/log/f050dc3ed12c0b6f8addab196f38769e730eae41/suite/browser/navigator.js">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/f050dc3ed12c0b6f8addab196f38769e730eae41/suite/browser/navigatorDD.js">suite/browser/navigatorDD.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/f050dc3ed12c0b6f8addab196f38769e730eae41/suite/browser/navigatorDD.js">file</a> |
<a href="/comm-central/annotate/f050dc3ed12c0b6f8addab196f38769e730eae41/suite/browser/navigatorDD.js">annotate</a> |
<a href="/comm-central/diff/f050dc3ed12c0b6f8addab196f38769e730eae41/suite/browser/navigatorDD.js">diff</a> |
<a href="/comm-central/comparison/f050dc3ed12c0b6f8addab196f38769e730eae41/suite/browser/navigatorDD.js">comparison</a> |
<a href="/comm-central/log/f050dc3ed12c0b6f8addab196f38769e730eae41/suite/browser/navigatorDD.js">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/f050dc3ed12c0b6f8addab196f38769e730eae41/suite/browser/nsBrowserContentHandler.js">suite/browser/nsBrowserContentHandler.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/f050dc3ed12c0b6f8addab196f38769e730eae41/suite/browser/nsBrowserContentHandler.js">file</a> |
<a href="/comm-central/annotate/f050dc3ed12c0b6f8addab196f38769e730eae41/suite/browser/nsBrowserContentHandler.js">annotate</a> |
<a href="/comm-central/diff/f050dc3ed12c0b6f8addab196f38769e730eae41/suite/browser/nsBrowserContentHandler.js">diff</a> |
<a href="/comm-central/comparison/f050dc3ed12c0b6f8addab196f38769e730eae41/suite/browser/nsBrowserContentHandler.js">comparison</a> |
<a href="/comm-central/log/f050dc3ed12c0b6f8addab196f38769e730eae41/suite/browser/nsBrowserContentHandler.js">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/f050dc3ed12c0b6f8addab196f38769e730eae41/suite/browser/nsBrowserContentListener.js">suite/browser/nsBrowserContentListener.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/f050dc3ed12c0b6f8addab196f38769e730eae41/suite/browser/nsBrowserContentListener.js">file</a> |
<a href="/comm-central/annotate/f050dc3ed12c0b6f8addab196f38769e730eae41/suite/browser/nsBrowserContentListener.js">annotate</a> |
<a href="/comm-central/diff/f050dc3ed12c0b6f8addab196f38769e730eae41/suite/browser/nsBrowserContentListener.js">diff</a> |
<a href="/comm-central/comparison/f050dc3ed12c0b6f8addab196f38769e730eae41/suite/browser/nsBrowserContentListener.js">comparison</a> |
<a href="/comm-central/log/f050dc3ed12c0b6f8addab196f38769e730eae41/suite/browser/nsBrowserContentListener.js">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/f050dc3ed12c0b6f8addab196f38769e730eae41/suite/browser/nsBrowserStatusHandler.js">suite/browser/nsBrowserStatusHandler.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/f050dc3ed12c0b6f8addab196f38769e730eae41/suite/browser/nsBrowserStatusHandler.js">file</a> |
<a href="/comm-central/annotate/f050dc3ed12c0b6f8addab196f38769e730eae41/suite/browser/nsBrowserStatusHandler.js">annotate</a> |
<a href="/comm-central/diff/f050dc3ed12c0b6f8addab196f38769e730eae41/suite/browser/nsBrowserStatusHandler.js">diff</a> |
<a href="/comm-central/comparison/f050dc3ed12c0b6f8addab196f38769e730eae41/suite/browser/nsBrowserStatusHandler.js">comparison</a> |
<a href="/comm-central/log/f050dc3ed12c0b6f8addab196f38769e730eae41/suite/browser/nsBrowserStatusHandler.js">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/f050dc3ed12c0b6f8addab196f38769e730eae41/suite/browser/pageinfo/pageInfo.js">suite/browser/pageinfo/pageInfo.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/f050dc3ed12c0b6f8addab196f38769e730eae41/suite/browser/pageinfo/pageInfo.js">file</a> |
<a href="/comm-central/annotate/f050dc3ed12c0b6f8addab196f38769e730eae41/suite/browser/pageinfo/pageInfo.js">annotate</a> |
<a href="/comm-central/diff/f050dc3ed12c0b6f8addab196f38769e730eae41/suite/browser/pageinfo/pageInfo.js">diff</a> |
<a href="/comm-central/comparison/f050dc3ed12c0b6f8addab196f38769e730eae41/suite/browser/pageinfo/pageInfo.js">comparison</a> |
<a href="/comm-central/log/f050dc3ed12c0b6f8addab196f38769e730eae41/suite/browser/pageinfo/pageInfo.js">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/f050dc3ed12c0b6f8addab196f38769e730eae41/suite/browser/pageinfo/permissions.js">suite/browser/pageinfo/permissions.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/f050dc3ed12c0b6f8addab196f38769e730eae41/suite/browser/pageinfo/permissions.js">file</a> |
<a href="/comm-central/annotate/f050dc3ed12c0b6f8addab196f38769e730eae41/suite/browser/pageinfo/permissions.js">annotate</a> |
<a href="/comm-central/diff/f050dc3ed12c0b6f8addab196f38769e730eae41/suite/browser/pageinfo/permissions.js">diff</a> |
<a href="/comm-central/comparison/f050dc3ed12c0b6f8addab196f38769e730eae41/suite/browser/pageinfo/permissions.js">comparison</a> |
<a href="/comm-central/log/f050dc3ed12c0b6f8addab196f38769e730eae41/suite/browser/pageinfo/permissions.js">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/f050dc3ed12c0b6f8addab196f38769e730eae41/suite/browser/pageinfo/security.js">suite/browser/pageinfo/security.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/f050dc3ed12c0b6f8addab196f38769e730eae41/suite/browser/pageinfo/security.js">file</a> |
<a href="/comm-central/annotate/f050dc3ed12c0b6f8addab196f38769e730eae41/suite/browser/pageinfo/security.js">annotate</a> |
<a href="/comm-central/diff/f050dc3ed12c0b6f8addab196f38769e730eae41/suite/browser/pageinfo/security.js">diff</a> |
<a href="/comm-central/comparison/f050dc3ed12c0b6f8addab196f38769e730eae41/suite/browser/pageinfo/security.js">comparison</a> |
<a href="/comm-central/log/f050dc3ed12c0b6f8addab196f38769e730eae41/suite/browser/pageinfo/security.js">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/f050dc3ed12c0b6f8addab196f38769e730eae41/suite/browser/test/browser/browser_bug329212.js">suite/browser/test/browser/browser_bug329212.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/f050dc3ed12c0b6f8addab196f38769e730eae41/suite/browser/test/browser/browser_bug329212.js">file</a> |
<a href="/comm-central/annotate/f050dc3ed12c0b6f8addab196f38769e730eae41/suite/browser/test/browser/browser_bug329212.js">annotate</a> |
<a href="/comm-central/diff/f050dc3ed12c0b6f8addab196f38769e730eae41/suite/browser/test/browser/browser_bug329212.js">diff</a> |
<a href="/comm-central/comparison/f050dc3ed12c0b6f8addab196f38769e730eae41/suite/browser/test/browser/browser_bug329212.js">comparison</a> |
<a href="/comm-central/log/f050dc3ed12c0b6f8addab196f38769e730eae41/suite/browser/test/browser/browser_bug329212.js">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/f050dc3ed12c0b6f8addab196f38769e730eae41/suite/browser/test/browser/browser_bug581947.js">suite/browser/test/browser/browser_bug581947.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/f050dc3ed12c0b6f8addab196f38769e730eae41/suite/browser/test/browser/browser_bug581947.js">file</a> |
<a href="/comm-central/annotate/f050dc3ed12c0b6f8addab196f38769e730eae41/suite/browser/test/browser/browser_bug581947.js">annotate</a> |
<a href="/comm-central/diff/f050dc3ed12c0b6f8addab196f38769e730eae41/suite/browser/test/browser/browser_bug581947.js">diff</a> |
<a href="/comm-central/comparison/f050dc3ed12c0b6f8addab196f38769e730eae41/suite/browser/test/browser/browser_bug581947.js">comparison</a> |
<a href="/comm-central/log/f050dc3ed12c0b6f8addab196f38769e730eae41/suite/browser/test/browser/browser_bug581947.js">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/f050dc3ed12c0b6f8addab196f38769e730eae41/suite/browser/test/browser/browser_bug623155.js">suite/browser/test/browser/browser_bug623155.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/f050dc3ed12c0b6f8addab196f38769e730eae41/suite/browser/test/browser/browser_bug623155.js">file</a> |
<a href="/comm-central/annotate/f050dc3ed12c0b6f8addab196f38769e730eae41/suite/browser/test/browser/browser_bug623155.js">annotate</a> |
<a href="/comm-central/diff/f050dc3ed12c0b6f8addab196f38769e730eae41/suite/browser/test/browser/browser_bug623155.js">diff</a> |
<a href="/comm-central/comparison/f050dc3ed12c0b6f8addab196f38769e730eae41/suite/browser/test/browser/browser_bug623155.js">comparison</a> |
<a href="/comm-central/log/f050dc3ed12c0b6f8addab196f38769e730eae41/suite/browser/test/browser/browser_bug623155.js">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/f050dc3ed12c0b6f8addab196f38769e730eae41/suite/common/bookmarks/browser-places.js">suite/common/bookmarks/browser-places.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/f050dc3ed12c0b6f8addab196f38769e730eae41/suite/common/bookmarks/browser-places.js">file</a> |
<a href="/comm-central/annotate/f050dc3ed12c0b6f8addab196f38769e730eae41/suite/common/bookmarks/browser-places.js">annotate</a> |
<a href="/comm-central/diff/f050dc3ed12c0b6f8addab196f38769e730eae41/suite/common/bookmarks/browser-places.js">diff</a> |
<a href="/comm-central/comparison/f050dc3ed12c0b6f8addab196f38769e730eae41/suite/common/bookmarks/browser-places.js">comparison</a> |
<a href="/comm-central/log/f050dc3ed12c0b6f8addab196f38769e730eae41/suite/common/bookmarks/browser-places.js">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/f050dc3ed12c0b6f8addab196f38769e730eae41/suite/common/bookmarks/editBookmarkOverlay.js">suite/common/bookmarks/editBookmarkOverlay.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/f050dc3ed12c0b6f8addab196f38769e730eae41/suite/common/bookmarks/editBookmarkOverlay.js">file</a> |
<a href="/comm-central/annotate/f050dc3ed12c0b6f8addab196f38769e730eae41/suite/common/bookmarks/editBookmarkOverlay.js">annotate</a> |
<a href="/comm-central/diff/f050dc3ed12c0b6f8addab196f38769e730eae41/suite/common/bookmarks/editBookmarkOverlay.js">diff</a> |
<a href="/comm-central/comparison/f050dc3ed12c0b6f8addab196f38769e730eae41/suite/common/bookmarks/editBookmarkOverlay.js">comparison</a> |
<a href="/comm-central/log/f050dc3ed12c0b6f8addab196f38769e730eae41/suite/common/bookmarks/editBookmarkOverlay.js">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/f050dc3ed12c0b6f8addab196f38769e730eae41/suite/common/contentAreaClick.js">suite/common/contentAreaClick.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/f050dc3ed12c0b6f8addab196f38769e730eae41/suite/common/contentAreaClick.js">file</a> |
<a href="/comm-central/annotate/f050dc3ed12c0b6f8addab196f38769e730eae41/suite/common/contentAreaClick.js">annotate</a> |
<a href="/comm-central/diff/f050dc3ed12c0b6f8addab196f38769e730eae41/suite/common/contentAreaClick.js">diff</a> |
<a href="/comm-central/comparison/f050dc3ed12c0b6f8addab196f38769e730eae41/suite/common/contentAreaClick.js">comparison</a> |
<a href="/comm-central/log/f050dc3ed12c0b6f8addab196f38769e730eae41/suite/common/contentAreaClick.js">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/f050dc3ed12c0b6f8addab196f38769e730eae41/suite/common/defaultClientDialog.js">suite/common/defaultClientDialog.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/f050dc3ed12c0b6f8addab196f38769e730eae41/suite/common/defaultClientDialog.js">file</a> |
<a href="/comm-central/annotate/f050dc3ed12c0b6f8addab196f38769e730eae41/suite/common/defaultClientDialog.js">annotate</a> |
<a href="/comm-central/diff/f050dc3ed12c0b6f8addab196f38769e730eae41/suite/common/defaultClientDialog.js">diff</a> |
<a href="/comm-central/comparison/f050dc3ed12c0b6f8addab196f38769e730eae41/suite/common/defaultClientDialog.js">comparison</a> |
<a href="/comm-central/log/f050dc3ed12c0b6f8addab196f38769e730eae41/suite/common/defaultClientDialog.js">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/f050dc3ed12c0b6f8addab196f38769e730eae41/suite/common/directory/directory.js">suite/common/directory/directory.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/f050dc3ed12c0b6f8addab196f38769e730eae41/suite/common/directory/directory.js">file</a> |
<a href="/comm-central/annotate/f050dc3ed12c0b6f8addab196f38769e730eae41/suite/common/directory/directory.js">annotate</a> |
<a href="/comm-central/diff/f050dc3ed12c0b6f8addab196f38769e730eae41/suite/common/directory/directory.js">diff</a> |
<a href="/comm-central/comparison/f050dc3ed12c0b6f8addab196f38769e730eae41/suite/common/directory/directory.js">comparison</a> |
<a href="/comm-central/log/f050dc3ed12c0b6f8addab196f38769e730eae41/suite/common/directory/directory.js">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/f050dc3ed12c0b6f8addab196f38769e730eae41/suite/common/findUtils.js">suite/common/findUtils.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/f050dc3ed12c0b6f8addab196f38769e730eae41/suite/common/findUtils.js">file</a> |
<a href="/comm-central/annotate/f050dc3ed12c0b6f8addab196f38769e730eae41/suite/common/findUtils.js">annotate</a> |
<a href="/comm-central/diff/f050dc3ed12c0b6f8addab196f38769e730eae41/suite/common/findUtils.js">diff</a> |
<a href="/comm-central/comparison/f050dc3ed12c0b6f8addab196f38769e730eae41/suite/common/findUtils.js">comparison</a> |
<a href="/comm-central/log/f050dc3ed12c0b6f8addab196f38769e730eae41/suite/common/findUtils.js">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/f050dc3ed12c0b6f8addab196f38769e730eae41/suite/common/permissions/permissionsManager.js">suite/common/permissions/permissionsManager.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/f050dc3ed12c0b6f8addab196f38769e730eae41/suite/common/permissions/permissionsManager.js">file</a> |
<a href="/comm-central/annotate/f050dc3ed12c0b6f8addab196f38769e730eae41/suite/common/permissions/permissionsManager.js">annotate</a> |
<a href="/comm-central/diff/f050dc3ed12c0b6f8addab196f38769e730eae41/suite/common/permissions/permissionsManager.js">diff</a> |
<a href="/comm-central/comparison/f050dc3ed12c0b6f8addab196f38769e730eae41/suite/common/permissions/permissionsManager.js">comparison</a> |
<a href="/comm-central/log/f050dc3ed12c0b6f8addab196f38769e730eae41/suite/common/permissions/permissionsManager.js">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/f050dc3ed12c0b6f8addab196f38769e730eae41/suite/common/places/controller.js">suite/common/places/controller.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/f050dc3ed12c0b6f8addab196f38769e730eae41/suite/common/places/controller.js">file</a> |
<a href="/comm-central/annotate/f050dc3ed12c0b6f8addab196f38769e730eae41/suite/common/places/controller.js">annotate</a> |
<a href="/comm-central/diff/f050dc3ed12c0b6f8addab196f38769e730eae41/suite/common/places/controller.js">diff</a> |
<a href="/comm-central/comparison/f050dc3ed12c0b6f8addab196f38769e730eae41/suite/common/places/controller.js">comparison</a> |
<a href="/comm-central/log/f050dc3ed12c0b6f8addab196f38769e730eae41/suite/common/places/controller.js">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/f050dc3ed12c0b6f8addab196f38769e730eae41/suite/common/places/tests/browser/browser_library_infoBox.js">suite/common/places/tests/browser/browser_library_infoBox.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/f050dc3ed12c0b6f8addab196f38769e730eae41/suite/common/places/tests/browser/browser_library_infoBox.js">file</a> |
<a href="/comm-central/annotate/f050dc3ed12c0b6f8addab196f38769e730eae41/suite/common/places/tests/browser/browser_library_infoBox.js">annotate</a> |
<a href="/comm-central/diff/f050dc3ed12c0b6f8addab196f38769e730eae41/suite/common/places/tests/browser/browser_library_infoBox.js">diff</a> |
<a href="/comm-central/comparison/f050dc3ed12c0b6f8addab196f38769e730eae41/suite/common/places/tests/browser/browser_library_infoBox.js">comparison</a> |
<a href="/comm-central/log/f050dc3ed12c0b6f8addab196f38769e730eae41/suite/common/places/tests/browser/browser_library_infoBox.js">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/f050dc3ed12c0b6f8addab196f38769e730eae41/suite/common/places/tests/browser/browser_library_left_pane_commands.js">suite/common/places/tests/browser/browser_library_left_pane_commands.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/f050dc3ed12c0b6f8addab196f38769e730eae41/suite/common/places/tests/browser/browser_library_left_pane_commands.js">file</a> |
<a href="/comm-central/annotate/f050dc3ed12c0b6f8addab196f38769e730eae41/suite/common/places/tests/browser/browser_library_left_pane_commands.js">annotate</a> |
<a href="/comm-central/diff/f050dc3ed12c0b6f8addab196f38769e730eae41/suite/common/places/tests/browser/browser_library_left_pane_commands.js">diff</a> |
<a href="/comm-central/comparison/f050dc3ed12c0b6f8addab196f38769e730eae41/suite/common/places/tests/browser/browser_library_left_pane_commands.js">comparison</a> |
<a href="/comm-central/log/f050dc3ed12c0b6f8addab196f38769e730eae41/suite/common/places/tests/browser/browser_library_left_pane_commands.js">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/f050dc3ed12c0b6f8addab196f38769e730eae41/suite/common/places/tests/unit/test_PUIU_makeTransaction.js">suite/common/places/tests/unit/test_PUIU_makeTransaction.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/f050dc3ed12c0b6f8addab196f38769e730eae41/suite/common/places/tests/unit/test_PUIU_makeTransaction.js">file</a> |
<a href="/comm-central/annotate/f050dc3ed12c0b6f8addab196f38769e730eae41/suite/common/places/tests/unit/test_PUIU_makeTransaction.js">annotate</a> |
<a href="/comm-central/diff/f050dc3ed12c0b6f8addab196f38769e730eae41/suite/common/places/tests/unit/test_PUIU_makeTransaction.js">diff</a> |
<a href="/comm-central/comparison/f050dc3ed12c0b6f8addab196f38769e730eae41/suite/common/places/tests/unit/test_PUIU_makeTransaction.js">comparison</a> |
<a href="/comm-central/log/f050dc3ed12c0b6f8addab196f38769e730eae41/suite/common/places/tests/unit/test_PUIU_makeTransaction.js">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/f050dc3ed12c0b6f8addab196f38769e730eae41/suite/common/places/tests/unit/test_browserGlue_smartBookmarks.js">suite/common/places/tests/unit/test_browserGlue_smartBookmarks.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/f050dc3ed12c0b6f8addab196f38769e730eae41/suite/common/places/tests/unit/test_browserGlue_smartBookmarks.js">file</a> |
<a href="/comm-central/annotate/f050dc3ed12c0b6f8addab196f38769e730eae41/suite/common/places/tests/unit/test_browserGlue_smartBookmarks.js">annotate</a> |
<a href="/comm-central/diff/f050dc3ed12c0b6f8addab196f38769e730eae41/suite/common/places/tests/unit/test_browserGlue_smartBookmarks.js">diff</a> |
<a href="/comm-central/comparison/f050dc3ed12c0b6f8addab196f38769e730eae41/suite/common/places/tests/unit/test_browserGlue_smartBookmarks.js">comparison</a> |
<a href="/comm-central/log/f050dc3ed12c0b6f8addab196f38769e730eae41/suite/common/places/tests/unit/test_browserGlue_smartBookmarks.js">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/f050dc3ed12c0b6f8addab196f38769e730eae41/suite/common/places/tests/unit/test_clearHistory_shutdown.js">suite/common/places/tests/unit/test_clearHistory_shutdown.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/f050dc3ed12c0b6f8addab196f38769e730eae41/suite/common/places/tests/unit/test_clearHistory_shutdown.js">file</a> |
<a href="/comm-central/annotate/f050dc3ed12c0b6f8addab196f38769e730eae41/suite/common/places/tests/unit/test_clearHistory_shutdown.js">annotate</a> |
<a href="/comm-central/diff/f050dc3ed12c0b6f8addab196f38769e730eae41/suite/common/places/tests/unit/test_clearHistory_shutdown.js">diff</a> |
<a href="/comm-central/comparison/f050dc3ed12c0b6f8addab196f38769e730eae41/suite/common/places/tests/unit/test_clearHistory_shutdown.js">comparison</a> |
<a href="/comm-central/log/f050dc3ed12c0b6f8addab196f38769e730eae41/suite/common/places/tests/unit/test_clearHistory_shutdown.js">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/f050dc3ed12c0b6f8addab196f38769e730eae41/suite/common/pref/pref-applications.js">suite/common/pref/pref-applications.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/f050dc3ed12c0b6f8addab196f38769e730eae41/suite/common/pref/pref-applications.js">file</a> |
<a href="/comm-central/annotate/f050dc3ed12c0b6f8addab196f38769e730eae41/suite/common/pref/pref-applications.js">annotate</a> |
<a href="/comm-central/diff/f050dc3ed12c0b6f8addab196f38769e730eae41/suite/common/pref/pref-applications.js">diff</a> |
<a href="/comm-central/comparison/f050dc3ed12c0b6f8addab196f38769e730eae41/suite/common/pref/pref-applications.js">comparison</a> |
<a href="/comm-central/log/f050dc3ed12c0b6f8addab196f38769e730eae41/suite/common/pref/pref-applications.js">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/f050dc3ed12c0b6f8addab196f38769e730eae41/suite/common/pref/pref-colors.js">suite/common/pref/pref-colors.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/f050dc3ed12c0b6f8addab196f38769e730eae41/suite/common/pref/pref-colors.js">file</a> |
<a href="/comm-central/annotate/f050dc3ed12c0b6f8addab196f38769e730eae41/suite/common/pref/pref-colors.js">annotate</a> |
<a href="/comm-central/diff/f050dc3ed12c0b6f8addab196f38769e730eae41/suite/common/pref/pref-colors.js">diff</a> |
<a href="/comm-central/comparison/f050dc3ed12c0b6f8addab196f38769e730eae41/suite/common/pref/pref-colors.js">comparison</a> |
<a href="/comm-central/log/f050dc3ed12c0b6f8addab196f38769e730eae41/suite/common/pref/pref-colors.js">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/f050dc3ed12c0b6f8addab196f38769e730eae41/suite/common/pref/pref-fonts.js">suite/common/pref/pref-fonts.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/f050dc3ed12c0b6f8addab196f38769e730eae41/suite/common/pref/pref-fonts.js">file</a> |
<a href="/comm-central/annotate/f050dc3ed12c0b6f8addab196f38769e730eae41/suite/common/pref/pref-fonts.js">annotate</a> |
<a href="/comm-central/diff/f050dc3ed12c0b6f8addab196f38769e730eae41/suite/common/pref/pref-fonts.js">diff</a> |
<a href="/comm-central/comparison/f050dc3ed12c0b6f8addab196f38769e730eae41/suite/common/pref/pref-fonts.js">comparison</a> |
<a href="/comm-central/log/f050dc3ed12c0b6f8addab196f38769e730eae41/suite/common/pref/pref-fonts.js">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/f050dc3ed12c0b6f8addab196f38769e730eae41/suite/common/pref/pref-history.js">suite/common/pref/pref-history.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/f050dc3ed12c0b6f8addab196f38769e730eae41/suite/common/pref/pref-history.js">file</a> |
<a href="/comm-central/annotate/f050dc3ed12c0b6f8addab196f38769e730eae41/suite/common/pref/pref-history.js">annotate</a> |
<a href="/comm-central/diff/f050dc3ed12c0b6f8addab196f38769e730eae41/suite/common/pref/pref-history.js">diff</a> |
<a href="/comm-central/comparison/f050dc3ed12c0b6f8addab196f38769e730eae41/suite/common/pref/pref-history.js">comparison</a> |
<a href="/comm-central/log/f050dc3ed12c0b6f8addab196f38769e730eae41/suite/common/pref/pref-history.js">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/f050dc3ed12c0b6f8addab196f38769e730eae41/suite/common/pref/pref-http.js">suite/common/pref/pref-http.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/f050dc3ed12c0b6f8addab196f38769e730eae41/suite/common/pref/pref-http.js">file</a> |
<a href="/comm-central/annotate/f050dc3ed12c0b6f8addab196f38769e730eae41/suite/common/pref/pref-http.js">annotate</a> |
<a href="/comm-central/diff/f050dc3ed12c0b6f8addab196f38769e730eae41/suite/common/pref/pref-http.js">diff</a> |
<a href="/comm-central/comparison/f050dc3ed12c0b6f8addab196f38769e730eae41/suite/common/pref/pref-http.js">comparison</a> |
<a href="/comm-central/log/f050dc3ed12c0b6f8addab196f38769e730eae41/suite/common/pref/pref-http.js">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/f050dc3ed12c0b6f8addab196f38769e730eae41/suite/common/pref/pref-languages.js">suite/common/pref/pref-languages.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/f050dc3ed12c0b6f8addab196f38769e730eae41/suite/common/pref/pref-languages.js">file</a> |
<a href="/comm-central/annotate/f050dc3ed12c0b6f8addab196f38769e730eae41/suite/common/pref/pref-languages.js">annotate</a> |
<a href="/comm-central/diff/f050dc3ed12c0b6f8addab196f38769e730eae41/suite/common/pref/pref-languages.js">diff</a> |
<a href="/comm-central/comparison/f050dc3ed12c0b6f8addab196f38769e730eae41/suite/common/pref/pref-languages.js">comparison</a> |
<a href="/comm-central/log/f050dc3ed12c0b6f8addab196f38769e730eae41/suite/common/pref/pref-languages.js">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/f050dc3ed12c0b6f8addab196f38769e730eae41/suite/common/pref/pref-navigator.js">suite/common/pref/pref-navigator.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/f050dc3ed12c0b6f8addab196f38769e730eae41/suite/common/pref/pref-navigator.js">file</a> |
<a href="/comm-central/annotate/f050dc3ed12c0b6f8addab196f38769e730eae41/suite/common/pref/pref-navigator.js">annotate</a> |
<a href="/comm-central/diff/f050dc3ed12c0b6f8addab196f38769e730eae41/suite/common/pref/pref-navigator.js">diff</a> |
<a href="/comm-central/comparison/f050dc3ed12c0b6f8addab196f38769e730eae41/suite/common/pref/pref-navigator.js">comparison</a> |
<a href="/comm-central/log/f050dc3ed12c0b6f8addab196f38769e730eae41/suite/common/pref/pref-navigator.js">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/f050dc3ed12c0b6f8addab196f38769e730eae41/suite/common/pref/pref-offlineapps.js">suite/common/pref/pref-offlineapps.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/f050dc3ed12c0b6f8addab196f38769e730eae41/suite/common/pref/pref-offlineapps.js">file</a> |
<a href="/comm-central/annotate/f050dc3ed12c0b6f8addab196f38769e730eae41/suite/common/pref/pref-offlineapps.js">annotate</a> |
<a href="/comm-central/diff/f050dc3ed12c0b6f8addab196f38769e730eae41/suite/common/pref/pref-offlineapps.js">diff</a> |
<a href="/comm-central/comparison/f050dc3ed12c0b6f8addab196f38769e730eae41/suite/common/pref/pref-offlineapps.js">comparison</a> |
<a href="/comm-central/log/f050dc3ed12c0b6f8addab196f38769e730eae41/suite/common/pref/pref-offlineapps.js">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/f050dc3ed12c0b6f8addab196f38769e730eae41/suite/common/pref/pref-popups.js">suite/common/pref/pref-popups.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/f050dc3ed12c0b6f8addab196f38769e730eae41/suite/common/pref/pref-popups.js">file</a> |
<a href="/comm-central/annotate/f050dc3ed12c0b6f8addab196f38769e730eae41/suite/common/pref/pref-popups.js">annotate</a> |
<a href="/comm-central/diff/f050dc3ed12c0b6f8addab196f38769e730eae41/suite/common/pref/pref-popups.js">diff</a> |
<a href="/comm-central/comparison/f050dc3ed12c0b6f8addab196f38769e730eae41/suite/common/pref/pref-popups.js">comparison</a> |
<a href="/comm-central/log/f050dc3ed12c0b6f8addab196f38769e730eae41/suite/common/pref/pref-popups.js">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/f050dc3ed12c0b6f8addab196f38769e730eae41/suite/common/pref/pref-proxies.js">suite/common/pref/pref-proxies.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/f050dc3ed12c0b6f8addab196f38769e730eae41/suite/common/pref/pref-proxies.js">file</a> |
<a href="/comm-central/annotate/f050dc3ed12c0b6f8addab196f38769e730eae41/suite/common/pref/pref-proxies.js">annotate</a> |
<a href="/comm-central/diff/f050dc3ed12c0b6f8addab196f38769e730eae41/suite/common/pref/pref-proxies.js">diff</a> |
<a href="/comm-central/comparison/f050dc3ed12c0b6f8addab196f38769e730eae41/suite/common/pref/pref-proxies.js">comparison</a> |
<a href="/comm-central/log/f050dc3ed12c0b6f8addab196f38769e730eae41/suite/common/pref/pref-proxies.js">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/f050dc3ed12c0b6f8addab196f38769e730eae41/suite/common/pref/pref-smartupdate.js">suite/common/pref/pref-smartupdate.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/f050dc3ed12c0b6f8addab196f38769e730eae41/suite/common/pref/pref-smartupdate.js">file</a> |
<a href="/comm-central/annotate/f050dc3ed12c0b6f8addab196f38769e730eae41/suite/common/pref/pref-smartupdate.js">annotate</a> |
<a href="/comm-central/diff/f050dc3ed12c0b6f8addab196f38769e730eae41/suite/common/pref/pref-smartupdate.js">diff</a> |
<a href="/comm-central/comparison/f050dc3ed12c0b6f8addab196f38769e730eae41/suite/common/pref/pref-smartupdate.js">comparison</a> |
<a href="/comm-central/log/f050dc3ed12c0b6f8addab196f38769e730eae41/suite/common/pref/pref-smartupdate.js">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/f050dc3ed12c0b6f8addab196f38769e730eae41/suite/common/pref/pref-spelling.js">suite/common/pref/pref-spelling.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/f050dc3ed12c0b6f8addab196f38769e730eae41/suite/common/pref/pref-spelling.js">file</a> |
<a href="/comm-central/annotate/f050dc3ed12c0b6f8addab196f38769e730eae41/suite/common/pref/pref-spelling.js">annotate</a> |
<a href="/comm-central/diff/f050dc3ed12c0b6f8addab196f38769e730eae41/suite/common/pref/pref-spelling.js">diff</a> |
<a href="/comm-central/comparison/f050dc3ed12c0b6f8addab196f38769e730eae41/suite/common/pref/pref-spelling.js">comparison</a> |
<a href="/comm-central/log/f050dc3ed12c0b6f8addab196f38769e730eae41/suite/common/pref/pref-spelling.js">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/f050dc3ed12c0b6f8addab196f38769e730eae41/suite/common/pref/pref-sync.js">suite/common/pref/pref-sync.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/f050dc3ed12c0b6f8addab196f38769e730eae41/suite/common/pref/pref-sync.js">file</a> |
<a href="/comm-central/annotate/f050dc3ed12c0b6f8addab196f38769e730eae41/suite/common/pref/pref-sync.js">annotate</a> |
<a href="/comm-central/diff/f050dc3ed12c0b6f8addab196f38769e730eae41/suite/common/pref/pref-sync.js">diff</a> |
<a href="/comm-central/comparison/f050dc3ed12c0b6f8addab196f38769e730eae41/suite/common/pref/pref-sync.js">comparison</a> |
<a href="/comm-central/log/f050dc3ed12c0b6f8addab196f38769e730eae41/suite/common/pref/pref-sync.js">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/f050dc3ed12c0b6f8addab196f38769e730eae41/suite/common/sidebar/customize.js">suite/common/sidebar/customize.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/f050dc3ed12c0b6f8addab196f38769e730eae41/suite/common/sidebar/customize.js">file</a> |
<a href="/comm-central/annotate/f050dc3ed12c0b6f8addab196f38769e730eae41/suite/common/sidebar/customize.js">annotate</a> |
<a href="/comm-central/diff/f050dc3ed12c0b6f8addab196f38769e730eae41/suite/common/sidebar/customize.js">diff</a> |
<a href="/comm-central/comparison/f050dc3ed12c0b6f8addab196f38769e730eae41/suite/common/sidebar/customize.js">comparison</a> |
<a href="/comm-central/log/f050dc3ed12c0b6f8addab196f38769e730eae41/suite/common/sidebar/customize.js">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/f050dc3ed12c0b6f8addab196f38769e730eae41/suite/common/sidebar/sidebarOverlay.js">suite/common/sidebar/sidebarOverlay.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/f050dc3ed12c0b6f8addab196f38769e730eae41/suite/common/sidebar/sidebarOverlay.js">file</a> |
<a href="/comm-central/annotate/f050dc3ed12c0b6f8addab196f38769e730eae41/suite/common/sidebar/sidebarOverlay.js">annotate</a> |
<a href="/comm-central/diff/f050dc3ed12c0b6f8addab196f38769e730eae41/suite/common/sidebar/sidebarOverlay.js">diff</a> |
<a href="/comm-central/comparison/f050dc3ed12c0b6f8addab196f38769e730eae41/suite/common/sidebar/sidebarOverlay.js">comparison</a> |
<a href="/comm-central/log/f050dc3ed12c0b6f8addab196f38769e730eae41/suite/common/sidebar/sidebarOverlay.js">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/f050dc3ed12c0b6f8addab196f38769e730eae41/suite/common/src/nsGopherProtocolStubHandler.js">suite/common/src/nsGopherProtocolStubHandler.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/f050dc3ed12c0b6f8addab196f38769e730eae41/suite/common/src/nsGopherProtocolStubHandler.js">file</a> |
<a href="/comm-central/annotate/f050dc3ed12c0b6f8addab196f38769e730eae41/suite/common/src/nsGopherProtocolStubHandler.js">annotate</a> |
<a href="/comm-central/diff/f050dc3ed12c0b6f8addab196f38769e730eae41/suite/common/src/nsGopherProtocolStubHandler.js">diff</a> |
<a href="/comm-central/comparison/f050dc3ed12c0b6f8addab196f38769e730eae41/suite/common/src/nsGopherProtocolStubHandler.js">comparison</a> |
<a href="/comm-central/log/f050dc3ed12c0b6f8addab196f38769e730eae41/suite/common/src/nsGopherProtocolStubHandler.js">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/f050dc3ed12c0b6f8addab196f38769e730eae41/suite/common/src/nsSessionStore.js">suite/common/src/nsSessionStore.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/f050dc3ed12c0b6f8addab196f38769e730eae41/suite/common/src/nsSessionStore.js">file</a> |
<a href="/comm-central/annotate/f050dc3ed12c0b6f8addab196f38769e730eae41/suite/common/src/nsSessionStore.js">annotate</a> |
<a href="/comm-central/diff/f050dc3ed12c0b6f8addab196f38769e730eae41/suite/common/src/nsSessionStore.js">diff</a> |
<a href="/comm-central/comparison/f050dc3ed12c0b6f8addab196f38769e730eae41/suite/common/src/nsSessionStore.js">comparison</a> |
<a href="/comm-central/log/f050dc3ed12c0b6f8addab196f38769e730eae41/suite/common/src/nsSessionStore.js">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/f050dc3ed12c0b6f8addab196f38769e730eae41/suite/common/src/nsSuiteGlue.js">suite/common/src/nsSuiteGlue.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/f050dc3ed12c0b6f8addab196f38769e730eae41/suite/common/src/nsSuiteGlue.js">file</a> |
<a href="/comm-central/annotate/f050dc3ed12c0b6f8addab196f38769e730eae41/suite/common/src/nsSuiteGlue.js">annotate</a> |
<a href="/comm-central/diff/f050dc3ed12c0b6f8addab196f38769e730eae41/suite/common/src/nsSuiteGlue.js">diff</a> |
<a href="/comm-central/comparison/f050dc3ed12c0b6f8addab196f38769e730eae41/suite/common/src/nsSuiteGlue.js">comparison</a> |
<a href="/comm-central/log/f050dc3ed12c0b6f8addab196f38769e730eae41/suite/common/src/nsSuiteGlue.js">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/f050dc3ed12c0b6f8addab196f38769e730eae41/suite/common/sync/syncSetup.js">suite/common/sync/syncSetup.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/f050dc3ed12c0b6f8addab196f38769e730eae41/suite/common/sync/syncSetup.js">file</a> |
<a href="/comm-central/annotate/f050dc3ed12c0b6f8addab196f38769e730eae41/suite/common/sync/syncSetup.js">annotate</a> |
<a href="/comm-central/diff/f050dc3ed12c0b6f8addab196f38769e730eae41/suite/common/sync/syncSetup.js">diff</a> |
<a href="/comm-central/comparison/f050dc3ed12c0b6f8addab196f38769e730eae41/suite/common/sync/syncSetup.js">comparison</a> |
<a href="/comm-central/log/f050dc3ed12c0b6f8addab196f38769e730eae41/suite/common/sync/syncSetup.js">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/f050dc3ed12c0b6f8addab196f38769e730eae41/suite/common/sync/syncUI.js">suite/common/sync/syncUI.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/f050dc3ed12c0b6f8addab196f38769e730eae41/suite/common/sync/syncUI.js">file</a> |
<a href="/comm-central/annotate/f050dc3ed12c0b6f8addab196f38769e730eae41/suite/common/sync/syncUI.js">annotate</a> |
<a href="/comm-central/diff/f050dc3ed12c0b6f8addab196f38769e730eae41/suite/common/sync/syncUI.js">diff</a> |
<a href="/comm-central/comparison/f050dc3ed12c0b6f8addab196f38769e730eae41/suite/common/sync/syncUI.js">comparison</a> |
<a href="/comm-central/log/f050dc3ed12c0b6f8addab196f38769e730eae41/suite/common/sync/syncUI.js">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/f050dc3ed12c0b6f8addab196f38769e730eae41/suite/common/tests/browser/browser_345898.js">suite/common/tests/browser/browser_345898.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/f050dc3ed12c0b6f8addab196f38769e730eae41/suite/common/tests/browser/browser_345898.js">file</a> |
<a href="/comm-central/annotate/f050dc3ed12c0b6f8addab196f38769e730eae41/suite/common/tests/browser/browser_345898.js">annotate</a> |
<a href="/comm-central/diff/f050dc3ed12c0b6f8addab196f38769e730eae41/suite/common/tests/browser/browser_345898.js">diff</a> |
<a href="/comm-central/comparison/f050dc3ed12c0b6f8addab196f38769e730eae41/suite/common/tests/browser/browser_345898.js">comparison</a> |
<a href="/comm-central/log/f050dc3ed12c0b6f8addab196f38769e730eae41/suite/common/tests/browser/browser_345898.js">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/f050dc3ed12c0b6f8addab196f38769e730eae41/suite/common/tests/browser/browser_350525.js">suite/common/tests/browser/browser_350525.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/f050dc3ed12c0b6f8addab196f38769e730eae41/suite/common/tests/browser/browser_350525.js">file</a> |
<a href="/comm-central/annotate/f050dc3ed12c0b6f8addab196f38769e730eae41/suite/common/tests/browser/browser_350525.js">annotate</a> |
<a href="/comm-central/diff/f050dc3ed12c0b6f8addab196f38769e730eae41/suite/common/tests/browser/browser_350525.js">diff</a> |
<a href="/comm-central/comparison/f050dc3ed12c0b6f8addab196f38769e730eae41/suite/common/tests/browser/browser_350525.js">comparison</a> |
<a href="/comm-central/log/f050dc3ed12c0b6f8addab196f38769e730eae41/suite/common/tests/browser/browser_350525.js">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/f050dc3ed12c0b6f8addab196f38769e730eae41/suite/common/tests/browser/browser_393716.js">suite/common/tests/browser/browser_393716.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/f050dc3ed12c0b6f8addab196f38769e730eae41/suite/common/tests/browser/browser_393716.js">file</a> |
<a href="/comm-central/annotate/f050dc3ed12c0b6f8addab196f38769e730eae41/suite/common/tests/browser/browser_393716.js">annotate</a> |
<a href="/comm-central/diff/f050dc3ed12c0b6f8addab196f38769e730eae41/suite/common/tests/browser/browser_393716.js">diff</a> |
<a href="/comm-central/comparison/f050dc3ed12c0b6f8addab196f38769e730eae41/suite/common/tests/browser/browser_393716.js">comparison</a> |
<a href="/comm-central/log/f050dc3ed12c0b6f8addab196f38769e730eae41/suite/common/tests/browser/browser_393716.js">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/f050dc3ed12c0b6f8addab196f38769e730eae41/suite/common/tests/browser/browser_408470.js">suite/common/tests/browser/browser_408470.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/f050dc3ed12c0b6f8addab196f38769e730eae41/suite/common/tests/browser/browser_408470.js">file</a> |
<a href="/comm-central/annotate/f050dc3ed12c0b6f8addab196f38769e730eae41/suite/common/tests/browser/browser_408470.js">annotate</a> |
<a href="/comm-central/diff/f050dc3ed12c0b6f8addab196f38769e730eae41/suite/common/tests/browser/browser_408470.js">diff</a> |
<a href="/comm-central/comparison/f050dc3ed12c0b6f8addab196f38769e730eae41/suite/common/tests/browser/browser_408470.js">comparison</a> |
<a href="/comm-central/log/f050dc3ed12c0b6f8addab196f38769e730eae41/suite/common/tests/browser/browser_408470.js">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/f050dc3ed12c0b6f8addab196f38769e730eae41/suite/common/tests/browser/browser_447951.js">suite/common/tests/browser/browser_447951.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/f050dc3ed12c0b6f8addab196f38769e730eae41/suite/common/tests/browser/browser_447951.js">file</a> |
<a href="/comm-central/annotate/f050dc3ed12c0b6f8addab196f38769e730eae41/suite/common/tests/browser/browser_447951.js">annotate</a> |
<a href="/comm-central/diff/f050dc3ed12c0b6f8addab196f38769e730eae41/suite/common/tests/browser/browser_447951.js">diff</a> |
<a href="/comm-central/comparison/f050dc3ed12c0b6f8addab196f38769e730eae41/suite/common/tests/browser/browser_447951.js">comparison</a> |
<a href="/comm-central/log/f050dc3ed12c0b6f8addab196f38769e730eae41/suite/common/tests/browser/browser_447951.js">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/f050dc3ed12c0b6f8addab196f38769e730eae41/suite/common/tests/browser/browser_448741.js">suite/common/tests/browser/browser_448741.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/f050dc3ed12c0b6f8addab196f38769e730eae41/suite/common/tests/browser/browser_448741.js">file</a> |
<a href="/comm-central/annotate/f050dc3ed12c0b6f8addab196f38769e730eae41/suite/common/tests/browser/browser_448741.js">annotate</a> |
<a href="/comm-central/diff/f050dc3ed12c0b6f8addab196f38769e730eae41/suite/common/tests/browser/browser_448741.js">diff</a> |
<a href="/comm-central/comparison/f050dc3ed12c0b6f8addab196f38769e730eae41/suite/common/tests/browser/browser_448741.js">comparison</a> |
<a href="/comm-central/log/f050dc3ed12c0b6f8addab196f38769e730eae41/suite/common/tests/browser/browser_448741.js">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/f050dc3ed12c0b6f8addab196f38769e730eae41/suite/common/tests/browser/browser_454908.js">suite/common/tests/browser/browser_454908.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/f050dc3ed12c0b6f8addab196f38769e730eae41/suite/common/tests/browser/browser_454908.js">file</a> |
<a href="/comm-central/annotate/f050dc3ed12c0b6f8addab196f38769e730eae41/suite/common/tests/browser/browser_454908.js">annotate</a> |
<a href="/comm-central/diff/f050dc3ed12c0b6f8addab196f38769e730eae41/suite/common/tests/browser/browser_454908.js">diff</a> |
<a href="/comm-central/comparison/f050dc3ed12c0b6f8addab196f38769e730eae41/suite/common/tests/browser/browser_454908.js">comparison</a> |
<a href="/comm-central/log/f050dc3ed12c0b6f8addab196f38769e730eae41/suite/common/tests/browser/browser_454908.js">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/f050dc3ed12c0b6f8addab196f38769e730eae41/suite/common/tests/browser/browser_456342.js">suite/common/tests/browser/browser_456342.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/f050dc3ed12c0b6f8addab196f38769e730eae41/suite/common/tests/browser/browser_456342.js">file</a> |
<a href="/comm-central/annotate/f050dc3ed12c0b6f8addab196f38769e730eae41/suite/common/tests/browser/browser_456342.js">annotate</a> |
<a href="/comm-central/diff/f050dc3ed12c0b6f8addab196f38769e730eae41/suite/common/tests/browser/browser_456342.js">diff</a> |
<a href="/comm-central/comparison/f050dc3ed12c0b6f8addab196f38769e730eae41/suite/common/tests/browser/browser_456342.js">comparison</a> |
<a href="/comm-central/log/f050dc3ed12c0b6f8addab196f38769e730eae41/suite/common/tests/browser/browser_456342.js">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/f050dc3ed12c0b6f8addab196f38769e730eae41/suite/common/tests/browser/browser_463206.js">suite/common/tests/browser/browser_463206.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/f050dc3ed12c0b6f8addab196f38769e730eae41/suite/common/tests/browser/browser_463206.js">file</a> |
<a href="/comm-central/annotate/f050dc3ed12c0b6f8addab196f38769e730eae41/suite/common/tests/browser/browser_463206.js">annotate</a> |
<a href="/comm-central/diff/f050dc3ed12c0b6f8addab196f38769e730eae41/suite/common/tests/browser/browser_463206.js">diff</a> |
<a href="/comm-central/comparison/f050dc3ed12c0b6f8addab196f38769e730eae41/suite/common/tests/browser/browser_463206.js">comparison</a> |
<a href="/comm-central/log/f050dc3ed12c0b6f8addab196f38769e730eae41/suite/common/tests/browser/browser_463206.js">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/f050dc3ed12c0b6f8addab196f38769e730eae41/suite/common/tests/browser/browser_465215.js">suite/common/tests/browser/browser_465215.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/f050dc3ed12c0b6f8addab196f38769e730eae41/suite/common/tests/browser/browser_465215.js">file</a> |
<a href="/comm-central/annotate/f050dc3ed12c0b6f8addab196f38769e730eae41/suite/common/tests/browser/browser_465215.js">annotate</a> |
<a href="/comm-central/diff/f050dc3ed12c0b6f8addab196f38769e730eae41/suite/common/tests/browser/browser_465215.js">diff</a> |
<a href="/comm-central/comparison/f050dc3ed12c0b6f8addab196f38769e730eae41/suite/common/tests/browser/browser_465215.js">comparison</a> |
<a href="/comm-central/log/f050dc3ed12c0b6f8addab196f38769e730eae41/suite/common/tests/browser/browser_465215.js">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/f050dc3ed12c0b6f8addab196f38769e730eae41/suite/common/tests/browser/browser_466937.js">suite/common/tests/browser/browser_466937.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/f050dc3ed12c0b6f8addab196f38769e730eae41/suite/common/tests/browser/browser_466937.js">file</a> |
<a href="/comm-central/annotate/f050dc3ed12c0b6f8addab196f38769e730eae41/suite/common/tests/browser/browser_466937.js">annotate</a> |
<a href="/comm-central/diff/f050dc3ed12c0b6f8addab196f38769e730eae41/suite/common/tests/browser/browser_466937.js">diff</a> |
<a href="/comm-central/comparison/f050dc3ed12c0b6f8addab196f38769e730eae41/suite/common/tests/browser/browser_466937.js">comparison</a> |
<a href="/comm-central/log/f050dc3ed12c0b6f8addab196f38769e730eae41/suite/common/tests/browser/browser_466937.js">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/f050dc3ed12c0b6f8addab196f38769e730eae41/suite/common/tests/browser/browser_477657.js">suite/common/tests/browser/browser_477657.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/f050dc3ed12c0b6f8addab196f38769e730eae41/suite/common/tests/browser/browser_477657.js">file</a> |
<a href="/comm-central/annotate/f050dc3ed12c0b6f8addab196f38769e730eae41/suite/common/tests/browser/browser_477657.js">annotate</a> |
<a href="/comm-central/diff/f050dc3ed12c0b6f8addab196f38769e730eae41/suite/common/tests/browser/browser_477657.js">diff</a> |
<a href="/comm-central/comparison/f050dc3ed12c0b6f8addab196f38769e730eae41/suite/common/tests/browser/browser_477657.js">comparison</a> |
<a href="/comm-central/log/f050dc3ed12c0b6f8addab196f38769e730eae41/suite/common/tests/browser/browser_477657.js">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/f050dc3ed12c0b6f8addab196f38769e730eae41/suite/common/tests/browser/browser_480893.js">suite/common/tests/browser/browser_480893.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/f050dc3ed12c0b6f8addab196f38769e730eae41/suite/common/tests/browser/browser_480893.js">file</a> |
<a href="/comm-central/annotate/f050dc3ed12c0b6f8addab196f38769e730eae41/suite/common/tests/browser/browser_480893.js">annotate</a> |
<a href="/comm-central/diff/f050dc3ed12c0b6f8addab196f38769e730eae41/suite/common/tests/browser/browser_480893.js">diff</a> |
<a href="/comm-central/comparison/f050dc3ed12c0b6f8addab196f38769e730eae41/suite/common/tests/browser/browser_480893.js">comparison</a> |
<a href="/comm-central/log/f050dc3ed12c0b6f8addab196f38769e730eae41/suite/common/tests/browser/browser_480893.js">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/f050dc3ed12c0b6f8addab196f38769e730eae41/suite/common/tests/browser/browser_485482.js">suite/common/tests/browser/browser_485482.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/f050dc3ed12c0b6f8addab196f38769e730eae41/suite/common/tests/browser/browser_485482.js">file</a> |
<a href="/comm-central/annotate/f050dc3ed12c0b6f8addab196f38769e730eae41/suite/common/tests/browser/browser_485482.js">annotate</a> |
<a href="/comm-central/diff/f050dc3ed12c0b6f8addab196f38769e730eae41/suite/common/tests/browser/browser_485482.js">diff</a> |
<a href="/comm-central/comparison/f050dc3ed12c0b6f8addab196f38769e730eae41/suite/common/tests/browser/browser_485482.js">comparison</a> |
<a href="/comm-central/log/f050dc3ed12c0b6f8addab196f38769e730eae41/suite/common/tests/browser/browser_485482.js">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/f050dc3ed12c0b6f8addab196f38769e730eae41/suite/common/tests/browser/browser_493467.js">suite/common/tests/browser/browser_493467.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/f050dc3ed12c0b6f8addab196f38769e730eae41/suite/common/tests/browser/browser_493467.js">file</a> |
<a href="/comm-central/annotate/f050dc3ed12c0b6f8addab196f38769e730eae41/suite/common/tests/browser/browser_493467.js">annotate</a> |
<a href="/comm-central/diff/f050dc3ed12c0b6f8addab196f38769e730eae41/suite/common/tests/browser/browser_493467.js">diff</a> |
<a href="/comm-central/comparison/f050dc3ed12c0b6f8addab196f38769e730eae41/suite/common/tests/browser/browser_493467.js">comparison</a> |
<a href="/comm-central/log/f050dc3ed12c0b6f8addab196f38769e730eae41/suite/common/tests/browser/browser_493467.js">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/f050dc3ed12c0b6f8addab196f38769e730eae41/suite/common/tests/browser/browser_522545.js">suite/common/tests/browser/browser_522545.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/f050dc3ed12c0b6f8addab196f38769e730eae41/suite/common/tests/browser/browser_522545.js">file</a> |
<a href="/comm-central/annotate/f050dc3ed12c0b6f8addab196f38769e730eae41/suite/common/tests/browser/browser_522545.js">annotate</a> |
<a href="/comm-central/diff/f050dc3ed12c0b6f8addab196f38769e730eae41/suite/common/tests/browser/browser_522545.js">diff</a> |
<a href="/comm-central/comparison/f050dc3ed12c0b6f8addab196f38769e730eae41/suite/common/tests/browser/browser_522545.js">comparison</a> |
<a href="/comm-central/log/f050dc3ed12c0b6f8addab196f38769e730eae41/suite/common/tests/browser/browser_522545.js">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/f050dc3ed12c0b6f8addab196f38769e730eae41/suite/common/tests/browser/browser_586068-cascaded_restore.js">suite/common/tests/browser/browser_586068-cascaded_restore.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/f050dc3ed12c0b6f8addab196f38769e730eae41/suite/common/tests/browser/browser_586068-cascaded_restore.js">file</a> |
<a href="/comm-central/annotate/f050dc3ed12c0b6f8addab196f38769e730eae41/suite/common/tests/browser/browser_586068-cascaded_restore.js">annotate</a> |
<a href="/comm-central/diff/f050dc3ed12c0b6f8addab196f38769e730eae41/suite/common/tests/browser/browser_586068-cascaded_restore.js">diff</a> |
<a href="/comm-central/comparison/f050dc3ed12c0b6f8addab196f38769e730eae41/suite/common/tests/browser/browser_586068-cascaded_restore.js">comparison</a> |
<a href="/comm-central/log/f050dc3ed12c0b6f8addab196f38769e730eae41/suite/common/tests/browser/browser_586068-cascaded_restore.js">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/f050dc3ed12c0b6f8addab196f38769e730eae41/suite/common/tests/browser/browser_isempty.js">suite/common/tests/browser/browser_isempty.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/f050dc3ed12c0b6f8addab196f38769e730eae41/suite/common/tests/browser/browser_isempty.js">file</a> |
<a href="/comm-central/annotate/f050dc3ed12c0b6f8addab196f38769e730eae41/suite/common/tests/browser/browser_isempty.js">annotate</a> |
<a href="/comm-central/diff/f050dc3ed12c0b6f8addab196f38769e730eae41/suite/common/tests/browser/browser_isempty.js">diff</a> |
<a href="/comm-central/comparison/f050dc3ed12c0b6f8addab196f38769e730eae41/suite/common/tests/browser/browser_isempty.js">comparison</a> |
<a href="/comm-central/log/f050dc3ed12c0b6f8addab196f38769e730eae41/suite/common/tests/browser/browser_isempty.js">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/f050dc3ed12c0b6f8addab196f38769e730eae41/suite/mailnews/addrbook/abCardOverlay.js">suite/mailnews/addrbook/abCardOverlay.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/f050dc3ed12c0b6f8addab196f38769e730eae41/suite/mailnews/addrbook/abCardOverlay.js">file</a> |
<a href="/comm-central/annotate/f050dc3ed12c0b6f8addab196f38769e730eae41/suite/mailnews/addrbook/abCardOverlay.js">annotate</a> |
<a href="/comm-central/diff/f050dc3ed12c0b6f8addab196f38769e730eae41/suite/mailnews/addrbook/abCardOverlay.js">diff</a> |
<a href="/comm-central/comparison/f050dc3ed12c0b6f8addab196f38769e730eae41/suite/mailnews/addrbook/abCardOverlay.js">comparison</a> |
<a href="/comm-central/log/f050dc3ed12c0b6f8addab196f38769e730eae41/suite/mailnews/addrbook/abCardOverlay.js">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/f050dc3ed12c0b6f8addab196f38769e730eae41/suite/mailnews/addrbook/abCardViewOverlay.js">suite/mailnews/addrbook/abCardViewOverlay.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/f050dc3ed12c0b6f8addab196f38769e730eae41/suite/mailnews/addrbook/abCardViewOverlay.js">file</a> |
<a href="/comm-central/annotate/f050dc3ed12c0b6f8addab196f38769e730eae41/suite/mailnews/addrbook/abCardViewOverlay.js">annotate</a> |
<a href="/comm-central/diff/f050dc3ed12c0b6f8addab196f38769e730eae41/suite/mailnews/addrbook/abCardViewOverlay.js">diff</a> |
<a href="/comm-central/comparison/f050dc3ed12c0b6f8addab196f38769e730eae41/suite/mailnews/addrbook/abCardViewOverlay.js">comparison</a> |
<a href="/comm-central/log/f050dc3ed12c0b6f8addab196f38769e730eae41/suite/mailnews/addrbook/abCardViewOverlay.js">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/f050dc3ed12c0b6f8addab196f38769e730eae41/suite/mailnews/addrbook/abCommon.js">suite/mailnews/addrbook/abCommon.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/f050dc3ed12c0b6f8addab196f38769e730eae41/suite/mailnews/addrbook/abCommon.js">file</a> |
<a href="/comm-central/annotate/f050dc3ed12c0b6f8addab196f38769e730eae41/suite/mailnews/addrbook/abCommon.js">annotate</a> |
<a href="/comm-central/diff/f050dc3ed12c0b6f8addab196f38769e730eae41/suite/mailnews/addrbook/abCommon.js">diff</a> |
<a href="/comm-central/comparison/f050dc3ed12c0b6f8addab196f38769e730eae41/suite/mailnews/addrbook/abCommon.js">comparison</a> |
<a href="/comm-central/log/f050dc3ed12c0b6f8addab196f38769e730eae41/suite/mailnews/addrbook/abCommon.js">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/f050dc3ed12c0b6f8addab196f38769e730eae41/suite/mailnews/addrbook/abSelectAddressesDialog.js">suite/mailnews/addrbook/abSelectAddressesDialog.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/f050dc3ed12c0b6f8addab196f38769e730eae41/suite/mailnews/addrbook/abSelectAddressesDialog.js">file</a> |
<a href="/comm-central/annotate/f050dc3ed12c0b6f8addab196f38769e730eae41/suite/mailnews/addrbook/abSelectAddressesDialog.js">annotate</a> |
<a href="/comm-central/diff/f050dc3ed12c0b6f8addab196f38769e730eae41/suite/mailnews/addrbook/abSelectAddressesDialog.js">diff</a> |
<a href="/comm-central/comparison/f050dc3ed12c0b6f8addab196f38769e730eae41/suite/mailnews/addrbook/abSelectAddressesDialog.js">comparison</a> |
<a href="/comm-central/log/f050dc3ed12c0b6f8addab196f38769e730eae41/suite/mailnews/addrbook/abSelectAddressesDialog.js">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/f050dc3ed12c0b6f8addab196f38769e730eae41/suite/mailnews/addrbook/addressbook-panel.js">suite/mailnews/addrbook/addressbook-panel.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/f050dc3ed12c0b6f8addab196f38769e730eae41/suite/mailnews/addrbook/addressbook-panel.js">file</a> |
<a href="/comm-central/annotate/f050dc3ed12c0b6f8addab196f38769e730eae41/suite/mailnews/addrbook/addressbook-panel.js">annotate</a> |
<a href="/comm-central/diff/f050dc3ed12c0b6f8addab196f38769e730eae41/suite/mailnews/addrbook/addressbook-panel.js">diff</a> |
<a href="/comm-central/comparison/f050dc3ed12c0b6f8addab196f38769e730eae41/suite/mailnews/addrbook/addressbook-panel.js">comparison</a> |
<a href="/comm-central/log/f050dc3ed12c0b6f8addab196f38769e730eae41/suite/mailnews/addrbook/addressbook-panel.js">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/f050dc3ed12c0b6f8addab196f38769e730eae41/suite/mailnews/addrbook/addressbook.js">suite/mailnews/addrbook/addressbook.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/f050dc3ed12c0b6f8addab196f38769e730eae41/suite/mailnews/addrbook/addressbook.js">file</a> |
<a href="/comm-central/annotate/f050dc3ed12c0b6f8addab196f38769e730eae41/suite/mailnews/addrbook/addressbook.js">annotate</a> |
<a href="/comm-central/diff/f050dc3ed12c0b6f8addab196f38769e730eae41/suite/mailnews/addrbook/addressbook.js">diff</a> |
<a href="/comm-central/comparison/f050dc3ed12c0b6f8addab196f38769e730eae41/suite/mailnews/addrbook/addressbook.js">comparison</a> |
<a href="/comm-central/log/f050dc3ed12c0b6f8addab196f38769e730eae41/suite/mailnews/addrbook/addressbook.js">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/f050dc3ed12c0b6f8addab196f38769e730eae41/suite/mailnews/commandglue.js">suite/mailnews/commandglue.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/f050dc3ed12c0b6f8addab196f38769e730eae41/suite/mailnews/commandglue.js">file</a> |
<a href="/comm-central/annotate/f050dc3ed12c0b6f8addab196f38769e730eae41/suite/mailnews/commandglue.js">annotate</a> |
<a href="/comm-central/diff/f050dc3ed12c0b6f8addab196f38769e730eae41/suite/mailnews/commandglue.js">diff</a> |
<a href="/comm-central/comparison/f050dc3ed12c0b6f8addab196f38769e730eae41/suite/mailnews/commandglue.js">comparison</a> |
<a href="/comm-central/log/f050dc3ed12c0b6f8addab196f38769e730eae41/suite/mailnews/commandglue.js">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/f050dc3ed12c0b6f8addab196f38769e730eae41/suite/mailnews/compose/MsgComposeCommands.js">suite/mailnews/compose/MsgComposeCommands.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/f050dc3ed12c0b6f8addab196f38769e730eae41/suite/mailnews/compose/MsgComposeCommands.js">file</a> |
<a href="/comm-central/annotate/f050dc3ed12c0b6f8addab196f38769e730eae41/suite/mailnews/compose/MsgComposeCommands.js">annotate</a> |
<a href="/comm-central/diff/f050dc3ed12c0b6f8addab196f38769e730eae41/suite/mailnews/compose/MsgComposeCommands.js">diff</a> |
<a href="/comm-central/comparison/f050dc3ed12c0b6f8addab196f38769e730eae41/suite/mailnews/compose/MsgComposeCommands.js">comparison</a> |
<a href="/comm-central/log/f050dc3ed12c0b6f8addab196f38769e730eae41/suite/mailnews/compose/MsgComposeCommands.js">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/f050dc3ed12c0b6f8addab196f38769e730eae41/suite/mailnews/mail-offline.js">suite/mailnews/mail-offline.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/f050dc3ed12c0b6f8addab196f38769e730eae41/suite/mailnews/mail-offline.js">file</a> |
<a href="/comm-central/annotate/f050dc3ed12c0b6f8addab196f38769e730eae41/suite/mailnews/mail-offline.js">annotate</a> |
<a href="/comm-central/diff/f050dc3ed12c0b6f8addab196f38769e730eae41/suite/mailnews/mail-offline.js">diff</a> |
<a href="/comm-central/comparison/f050dc3ed12c0b6f8addab196f38769e730eae41/suite/mailnews/mail-offline.js">comparison</a> |
<a href="/comm-central/log/f050dc3ed12c0b6f8addab196f38769e730eae41/suite/mailnews/mail-offline.js">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/f050dc3ed12c0b6f8addab196f38769e730eae41/suite/mailnews/mail3PaneWindowCommands.js">suite/mailnews/mail3PaneWindowCommands.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/f050dc3ed12c0b6f8addab196f38769e730eae41/suite/mailnews/mail3PaneWindowCommands.js">file</a> |
<a href="/comm-central/annotate/f050dc3ed12c0b6f8addab196f38769e730eae41/suite/mailnews/mail3PaneWindowCommands.js">annotate</a> |
<a href="/comm-central/diff/f050dc3ed12c0b6f8addab196f38769e730eae41/suite/mailnews/mail3PaneWindowCommands.js">diff</a> |
<a href="/comm-central/comparison/f050dc3ed12c0b6f8addab196f38769e730eae41/suite/mailnews/mail3PaneWindowCommands.js">comparison</a> |
<a href="/comm-central/log/f050dc3ed12c0b6f8addab196f38769e730eae41/suite/mailnews/mail3PaneWindowCommands.js">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/f050dc3ed12c0b6f8addab196f38769e730eae41/suite/mailnews/mailCommands.js">suite/mailnews/mailCommands.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/f050dc3ed12c0b6f8addab196f38769e730eae41/suite/mailnews/mailCommands.js">file</a> |
<a href="/comm-central/annotate/f050dc3ed12c0b6f8addab196f38769e730eae41/suite/mailnews/mailCommands.js">annotate</a> |
<a href="/comm-central/diff/f050dc3ed12c0b6f8addab196f38769e730eae41/suite/mailnews/mailCommands.js">diff</a> |
<a href="/comm-central/comparison/f050dc3ed12c0b6f8addab196f38769e730eae41/suite/mailnews/mailCommands.js">comparison</a> |
<a href="/comm-central/log/f050dc3ed12c0b6f8addab196f38769e730eae41/suite/mailnews/mailCommands.js">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/f050dc3ed12c0b6f8addab196f38769e730eae41/suite/mailnews/mailContextMenus.js">suite/mailnews/mailContextMenus.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/f050dc3ed12c0b6f8addab196f38769e730eae41/suite/mailnews/mailContextMenus.js">file</a> |
<a href="/comm-central/annotate/f050dc3ed12c0b6f8addab196f38769e730eae41/suite/mailnews/mailContextMenus.js">annotate</a> |
<a href="/comm-central/diff/f050dc3ed12c0b6f8addab196f38769e730eae41/suite/mailnews/mailContextMenus.js">diff</a> |
<a href="/comm-central/comparison/f050dc3ed12c0b6f8addab196f38769e730eae41/suite/mailnews/mailContextMenus.js">comparison</a> |
<a href="/comm-central/log/f050dc3ed12c0b6f8addab196f38769e730eae41/suite/mailnews/mailContextMenus.js">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/f050dc3ed12c0b6f8addab196f38769e730eae41/suite/mailnews/mailTasksOverlay.js">suite/mailnews/mailTasksOverlay.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/f050dc3ed12c0b6f8addab196f38769e730eae41/suite/mailnews/mailTasksOverlay.js">file</a> |
<a href="/comm-central/annotate/f050dc3ed12c0b6f8addab196f38769e730eae41/suite/mailnews/mailTasksOverlay.js">annotate</a> |
<a href="/comm-central/diff/f050dc3ed12c0b6f8addab196f38769e730eae41/suite/mailnews/mailTasksOverlay.js">diff</a> |
<a href="/comm-central/comparison/f050dc3ed12c0b6f8addab196f38769e730eae41/suite/mailnews/mailTasksOverlay.js">comparison</a> |
<a href="/comm-central/log/f050dc3ed12c0b6f8addab196f38769e730eae41/suite/mailnews/mailTasksOverlay.js">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/f050dc3ed12c0b6f8addab196f38769e730eae41/suite/mailnews/mailViewSetup.js">suite/mailnews/mailViewSetup.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/f050dc3ed12c0b6f8addab196f38769e730eae41/suite/mailnews/mailViewSetup.js">file</a> |
<a href="/comm-central/annotate/f050dc3ed12c0b6f8addab196f38769e730eae41/suite/mailnews/mailViewSetup.js">annotate</a> |
<a href="/comm-central/diff/f050dc3ed12c0b6f8addab196f38769e730eae41/suite/mailnews/mailViewSetup.js">diff</a> |
<a href="/comm-central/comparison/f050dc3ed12c0b6f8addab196f38769e730eae41/suite/mailnews/mailViewSetup.js">comparison</a> |
<a href="/comm-central/log/f050dc3ed12c0b6f8addab196f38769e730eae41/suite/mailnews/mailViewSetup.js">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/f050dc3ed12c0b6f8addab196f38769e730eae41/suite/mailnews/mailWindow.js">suite/mailnews/mailWindow.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/f050dc3ed12c0b6f8addab196f38769e730eae41/suite/mailnews/mailWindow.js">file</a> |
<a href="/comm-central/annotate/f050dc3ed12c0b6f8addab196f38769e730eae41/suite/mailnews/mailWindow.js">annotate</a> |
<a href="/comm-central/diff/f050dc3ed12c0b6f8addab196f38769e730eae41/suite/mailnews/mailWindow.js">diff</a> |
<a href="/comm-central/comparison/f050dc3ed12c0b6f8addab196f38769e730eae41/suite/mailnews/mailWindow.js">comparison</a> |
<a href="/comm-central/log/f050dc3ed12c0b6f8addab196f38769e730eae41/suite/mailnews/mailWindow.js">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/f050dc3ed12c0b6f8addab196f38769e730eae41/suite/mailnews/messageWindow.js">suite/mailnews/messageWindow.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/f050dc3ed12c0b6f8addab196f38769e730eae41/suite/mailnews/messageWindow.js">file</a> |
<a href="/comm-central/annotate/f050dc3ed12c0b6f8addab196f38769e730eae41/suite/mailnews/messageWindow.js">annotate</a> |
<a href="/comm-central/diff/f050dc3ed12c0b6f8addab196f38769e730eae41/suite/mailnews/messageWindow.js">diff</a> |
<a href="/comm-central/comparison/f050dc3ed12c0b6f8addab196f38769e730eae41/suite/mailnews/messageWindow.js">comparison</a> |
<a href="/comm-central/log/f050dc3ed12c0b6f8addab196f38769e730eae41/suite/mailnews/messageWindow.js">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/f050dc3ed12c0b6f8addab196f38769e730eae41/suite/mailnews/msgViewNavigation.js">suite/mailnews/msgViewNavigation.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/f050dc3ed12c0b6f8addab196f38769e730eae41/suite/mailnews/msgViewNavigation.js">file</a> |
<a href="/comm-central/annotate/f050dc3ed12c0b6f8addab196f38769e730eae41/suite/mailnews/msgViewNavigation.js">annotate</a> |
<a href="/comm-central/diff/f050dc3ed12c0b6f8addab196f38769e730eae41/suite/mailnews/msgViewNavigation.js">diff</a> |
<a href="/comm-central/comparison/f050dc3ed12c0b6f8addab196f38769e730eae41/suite/mailnews/msgViewNavigation.js">comparison</a> |
<a href="/comm-central/log/f050dc3ed12c0b6f8addab196f38769e730eae41/suite/mailnews/msgViewNavigation.js">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/f050dc3ed12c0b6f8addab196f38769e730eae41/suite/mailnews/phishingDetector.js">suite/mailnews/phishingDetector.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/f050dc3ed12c0b6f8addab196f38769e730eae41/suite/mailnews/phishingDetector.js">file</a> |
<a href="/comm-central/annotate/f050dc3ed12c0b6f8addab196f38769e730eae41/suite/mailnews/phishingDetector.js">annotate</a> |
<a href="/comm-central/diff/f050dc3ed12c0b6f8addab196f38769e730eae41/suite/mailnews/phishingDetector.js">diff</a> |
<a href="/comm-central/comparison/f050dc3ed12c0b6f8addab196f38769e730eae41/suite/mailnews/phishingDetector.js">comparison</a> |
<a href="/comm-central/log/f050dc3ed12c0b6f8addab196f38769e730eae41/suite/mailnews/phishingDetector.js">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/f050dc3ed12c0b6f8addab196f38769e730eae41/suite/mailnews/prefs/pref-tags.js">suite/mailnews/prefs/pref-tags.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/f050dc3ed12c0b6f8addab196f38769e730eae41/suite/mailnews/prefs/pref-tags.js">file</a> |
<a href="/comm-central/annotate/f050dc3ed12c0b6f8addab196f38769e730eae41/suite/mailnews/prefs/pref-tags.js">annotate</a> |
<a href="/comm-central/diff/f050dc3ed12c0b6f8addab196f38769e730eae41/suite/mailnews/prefs/pref-tags.js">diff</a> |
<a href="/comm-central/comparison/f050dc3ed12c0b6f8addab196f38769e730eae41/suite/mailnews/prefs/pref-tags.js">comparison</a> |
<a href="/comm-central/log/f050dc3ed12c0b6f8addab196f38769e730eae41/suite/mailnews/prefs/pref-tags.js">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/f050dc3ed12c0b6f8addab196f38769e730eae41/suite/mailnews/search/ABSearchDialog.js">suite/mailnews/search/ABSearchDialog.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/f050dc3ed12c0b6f8addab196f38769e730eae41/suite/mailnews/search/ABSearchDialog.js">file</a> |
<a href="/comm-central/annotate/f050dc3ed12c0b6f8addab196f38769e730eae41/suite/mailnews/search/ABSearchDialog.js">annotate</a> |
<a href="/comm-central/diff/f050dc3ed12c0b6f8addab196f38769e730eae41/suite/mailnews/search/ABSearchDialog.js">diff</a> |
<a href="/comm-central/comparison/f050dc3ed12c0b6f8addab196f38769e730eae41/suite/mailnews/search/ABSearchDialog.js">comparison</a> |
<a href="/comm-central/log/f050dc3ed12c0b6f8addab196f38769e730eae41/suite/mailnews/search/ABSearchDialog.js">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/f050dc3ed12c0b6f8addab196f38769e730eae41/suite/mailnews/search/FilterListDialog.js">suite/mailnews/search/FilterListDialog.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/f050dc3ed12c0b6f8addab196f38769e730eae41/suite/mailnews/search/FilterListDialog.js">file</a> |
<a href="/comm-central/annotate/f050dc3ed12c0b6f8addab196f38769e730eae41/suite/mailnews/search/FilterListDialog.js">annotate</a> |
<a href="/comm-central/diff/f050dc3ed12c0b6f8addab196f38769e730eae41/suite/mailnews/search/FilterListDialog.js">diff</a> |
<a href="/comm-central/comparison/f050dc3ed12c0b6f8addab196f38769e730eae41/suite/mailnews/search/FilterListDialog.js">comparison</a> |
<a href="/comm-central/log/f050dc3ed12c0b6f8addab196f38769e730eae41/suite/mailnews/search/FilterListDialog.js">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/f050dc3ed12c0b6f8addab196f38769e730eae41/suite/mailnews/search/SearchDialog.js">suite/mailnews/search/SearchDialog.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/f050dc3ed12c0b6f8addab196f38769e730eae41/suite/mailnews/search/SearchDialog.js">file</a> |
<a href="/comm-central/annotate/f050dc3ed12c0b6f8addab196f38769e730eae41/suite/mailnews/search/SearchDialog.js">annotate</a> |
<a href="/comm-central/diff/f050dc3ed12c0b6f8addab196f38769e730eae41/suite/mailnews/search/SearchDialog.js">diff</a> |
<a href="/comm-central/comparison/f050dc3ed12c0b6f8addab196f38769e730eae41/suite/mailnews/search/SearchDialog.js">comparison</a> |
<a href="/comm-central/log/f050dc3ed12c0b6f8addab196f38769e730eae41/suite/mailnews/search/SearchDialog.js">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/f050dc3ed12c0b6f8addab196f38769e730eae41/suite/mailnews/searchBar.js">suite/mailnews/searchBar.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/f050dc3ed12c0b6f8addab196f38769e730eae41/suite/mailnews/searchBar.js">file</a> |
<a href="/comm-central/annotate/f050dc3ed12c0b6f8addab196f38769e730eae41/suite/mailnews/searchBar.js">annotate</a> |
<a href="/comm-central/diff/f050dc3ed12c0b6f8addab196f38769e730eae41/suite/mailnews/searchBar.js">diff</a> |
<a href="/comm-central/comparison/f050dc3ed12c0b6f8addab196f38769e730eae41/suite/mailnews/searchBar.js">comparison</a> |
<a href="/comm-central/log/f050dc3ed12c0b6f8addab196f38769e730eae41/suite/mailnews/searchBar.js">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/f050dc3ed12c0b6f8addab196f38769e730eae41/suite/mailnews/threadPane.js">suite/mailnews/threadPane.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/f050dc3ed12c0b6f8addab196f38769e730eae41/suite/mailnews/threadPane.js">file</a> |
<a href="/comm-central/annotate/f050dc3ed12c0b6f8addab196f38769e730eae41/suite/mailnews/threadPane.js">annotate</a> |
<a href="/comm-central/diff/f050dc3ed12c0b6f8addab196f38769e730eae41/suite/mailnews/threadPane.js">diff</a> |
<a href="/comm-central/comparison/f050dc3ed12c0b6f8addab196f38769e730eae41/suite/mailnews/threadPane.js">comparison</a> |
<a href="/comm-central/log/f050dc3ed12c0b6f8addab196f38769e730eae41/suite/mailnews/threadPane.js">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/f050dc3ed12c0b6f8addab196f38769e730eae41/suite/mailnews/widgetglue.js">suite/mailnews/widgetglue.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/f050dc3ed12c0b6f8addab196f38769e730eae41/suite/mailnews/widgetglue.js">file</a> |
<a href="/comm-central/annotate/f050dc3ed12c0b6f8addab196f38769e730eae41/suite/mailnews/widgetglue.js">annotate</a> |
<a href="/comm-central/diff/f050dc3ed12c0b6f8addab196f38769e730eae41/suite/mailnews/widgetglue.js">diff</a> |
<a href="/comm-central/comparison/f050dc3ed12c0b6f8addab196f38769e730eae41/suite/mailnews/widgetglue.js">comparison</a> |
<a href="/comm-central/log/f050dc3ed12c0b6f8addab196f38769e730eae41/suite/mailnews/widgetglue.js">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/f050dc3ed12c0b6f8addab196f38769e730eae41/suite/modules/test/unit/test_browser_sanitizer.js">suite/modules/test/unit/test_browser_sanitizer.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/f050dc3ed12c0b6f8addab196f38769e730eae41/suite/modules/test/unit/test_browser_sanitizer.js">file</a> |
<a href="/comm-central/annotate/f050dc3ed12c0b6f8addab196f38769e730eae41/suite/modules/test/unit/test_browser_sanitizer.js">annotate</a> |
<a href="/comm-central/diff/f050dc3ed12c0b6f8addab196f38769e730eae41/suite/modules/test/unit/test_browser_sanitizer.js">diff</a> |
<a href="/comm-central/comparison/f050dc3ed12c0b6f8addab196f38769e730eae41/suite/modules/test/unit/test_browser_sanitizer.js">comparison</a> |
<a href="/comm-central/log/f050dc3ed12c0b6f8addab196f38769e730eae41/suite/modules/test/unit/test_browser_sanitizer.js">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/f050dc3ed12c0b6f8addab196f38769e730eae41/suite/profile/migration.js">suite/profile/migration.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/f050dc3ed12c0b6f8addab196f38769e730eae41/suite/profile/migration.js">file</a> |
<a href="/comm-central/annotate/f050dc3ed12c0b6f8addab196f38769e730eae41/suite/profile/migration.js">annotate</a> |
<a href="/comm-central/diff/f050dc3ed12c0b6f8addab196f38769e730eae41/suite/profile/migration.js">diff</a> |
<a href="/comm-central/comparison/f050dc3ed12c0b6f8addab196f38769e730eae41/suite/profile/migration.js">comparison</a> |
<a href="/comm-central/log/f050dc3ed12c0b6f8addab196f38769e730eae41/suite/profile/migration.js">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/f050dc3ed12c0b6f8addab196f38769e730eae41/suite/profile/migration/src/SuiteProfileMigrator.js">suite/profile/migration/src/SuiteProfileMigrator.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/f050dc3ed12c0b6f8addab196f38769e730eae41/suite/profile/migration/src/SuiteProfileMigrator.js">file</a> |
<a href="/comm-central/annotate/f050dc3ed12c0b6f8addab196f38769e730eae41/suite/profile/migration/src/SuiteProfileMigrator.js">annotate</a> |
<a href="/comm-central/diff/f050dc3ed12c0b6f8addab196f38769e730eae41/suite/profile/migration/src/SuiteProfileMigrator.js">diff</a> |
<a href="/comm-central/comparison/f050dc3ed12c0b6f8addab196f38769e730eae41/suite/profile/migration/src/SuiteProfileMigrator.js">comparison</a> |
<a href="/comm-central/log/f050dc3ed12c0b6f8addab196f38769e730eae41/suite/profile/migration/src/SuiteProfileMigrator.js">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/f050dc3ed12c0b6f8addab196f38769e730eae41/suite/security/prefs/pref-certs.js">suite/security/prefs/pref-certs.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/f050dc3ed12c0b6f8addab196f38769e730eae41/suite/security/prefs/pref-certs.js">file</a> |
<a href="/comm-central/annotate/f050dc3ed12c0b6f8addab196f38769e730eae41/suite/security/prefs/pref-certs.js">annotate</a> |
<a href="/comm-central/diff/f050dc3ed12c0b6f8addab196f38769e730eae41/suite/security/prefs/pref-certs.js">diff</a> |
<a href="/comm-central/comparison/f050dc3ed12c0b6f8addab196f38769e730eae41/suite/security/prefs/pref-certs.js">comparison</a> |
<a href="/comm-central/log/f050dc3ed12c0b6f8addab196f38769e730eae41/suite/security/prefs/pref-certs.js">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/f050dc3ed12c0b6f8addab196f38769e730eae41/suite/smile/test/browser_Application.js">suite/smile/test/browser_Application.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/f050dc3ed12c0b6f8addab196f38769e730eae41/suite/smile/test/browser_Application.js">file</a> |
<a href="/comm-central/annotate/f050dc3ed12c0b6f8addab196f38769e730eae41/suite/smile/test/browser_Application.js">annotate</a> |
<a href="/comm-central/diff/f050dc3ed12c0b6f8addab196f38769e730eae41/suite/smile/test/browser_Application.js">diff</a> |
<a href="/comm-central/comparison/f050dc3ed12c0b6f8addab196f38769e730eae41/suite/smile/test/browser_Application.js">comparison</a> |
<a href="/comm-central/log/f050dc3ed12c0b6f8addab196f38769e730eae41/suite/smile/test/browser_Application.js">revisions</a>
</td>
</tr>
</table></div>

<div class="page_body diffblocks"><div class="diffblock"><pre class="sourcelines">
<a href="#l1.1"></a><span id="l1.1" class="difflineminus">--- a/suite/browser/browser-prefs.js</span>
<a href="#l1.2"></a><span id="l1.2" class="difflineplus">+++ b/suite/browser/browser-prefs.js</span>
<a href="#l1.3"></a><span id="l1.3" class="difflineat">@@ -461,49 +461,49 @@ pref(&quot;browser.sessionstore.max_tabs_undo</span>
<a href="#l1.4"></a><span id="l1.4"> pref(&quot;browser.sessionstore.max_windows_undo&quot;, 3);</span>
<a href="#l1.5"></a><span id="l1.5"> // The number of tabs that can restore concurrently:</span>
<a href="#l1.6"></a><span id="l1.6"> // &lt; 0 = All tabs can restore at the same time</span>
<a href="#l1.7"></a><span id="l1.7"> //   0 = Only the selected tab in each window will load.</span>
<a href="#l1.8"></a><span id="l1.8"> //   N = N tabs should restore at the same time</span>
<a href="#l1.9"></a><span id="l1.9"> pref(&quot;browser.sessionstore.max_concurrent_tabs&quot;, 3);</span>
<a href="#l1.10"></a><span id="l1.10"> </span>
<a href="#l1.11"></a><span id="l1.11"> pref(&quot;shell.checkDefaultClient&quot;, true);</span>
<a href="#l1.12"></a><span id="l1.12" class="difflineminus">-// We want to check if we are the default client for browser and mail. See </span>
<a href="#l1.13"></a><span id="l1.13" class="difflineplus">+// We want to check if we are the default client for browser and mail. See</span>
<a href="#l1.14"></a><span id="l1.14"> // suite/shell/public/nsIShellService.idl for the possible constants you can use</span>
<a href="#l1.15"></a><span id="l1.15"> pref(&quot;shell.checkDefaultApps&quot;, 3);</span>
<a href="#l1.16"></a><span id="l1.16"> </span>
<a href="#l1.17"></a><span id="l1.17"> pref(&quot;app.releaseNotesURL&quot;, &quot;chrome://branding/locale/brand.properties&quot;);</span>
<a href="#l1.18"></a><span id="l1.18"> pref(&quot;app.vendorURL&quot;, &quot;chrome://branding/locale/brand.properties&quot;);</span>
<a href="#l1.19"></a><span id="l1.19"> </span>
<a href="#l1.20"></a><span id="l1.20"> // Base URL for web-based support pages.</span>
<a href="#l1.21"></a><span id="l1.21"> pref(&quot;app.support.baseURL&quot;, &quot;http://www.seamonkey-project.org/doc/&quot;);</span>
<a href="#l1.22"></a><span id="l1.22"> </span>
<a href="#l1.23"></a><span id="l1.23"> // App-specific update preferences</span>
<a href="#l1.24"></a><span id="l1.24"> </span>
<a href="#l1.25"></a><span id="l1.25"> // Whether or not app updates are enabled</span>
<a href="#l1.26"></a><span id="l1.26"> pref(&quot;app.update.enabled&quot;, true);</span>
<a href="#l1.27"></a><span id="l1.27" class="difflineminus">- </span>
<a href="#l1.28"></a><span id="l1.28" class="difflineplus">+</span>
<a href="#l1.29"></a><span id="l1.29"> // This preference allows automatic download and install to take place.</span>
<a href="#l1.30"></a><span id="l1.30"> pref(&quot;app.update.auto&quot;, true);</span>
<a href="#l1.31"></a><span id="l1.31"> </span>
<a href="#l1.32"></a><span id="l1.32"> // If set to true, the Update Service will present no UI for any event.</span>
<a href="#l1.33"></a><span id="l1.33"> pref(&quot;app.update.silent&quot;, false);</span>
<a href="#l1.34"></a><span id="l1.34"> </span>
<a href="#l1.35"></a><span id="l1.35"> // Update service URL:</span>
<a href="#l1.36"></a><span id="l1.36"> pref(&quot;app.update.url&quot;, &quot;https://aus2-community.mozilla.org/update/3/%PRODUCT%/%VERSION%/%BUILD_ID%/%BUILD_TARGET%/%LOCALE%/%CHANNEL%/%OS_VERSION%/%SYSTEM_CAPABILITIES%/%DISTRIBUTION%/%DISTRIBUTION_VERSION%/update.xml&quot;);</span>
<a href="#l1.37"></a><span id="l1.37"> // URL user can browse to manually if for some reason all update installation</span>
<a href="#l1.38"></a><span id="l1.38"> // attempts fail.</span>
<a href="#l1.39"></a><span id="l1.39"> pref(&quot;app.update.url.manual&quot;, &quot;http://www.seamonkey-project.org/&quot;);</span>
<a href="#l1.40"></a><span id="l1.40"> // A default value for the &quot;More information about this update&quot; link</span>
<a href="#l1.41"></a><span id="l1.41" class="difflineminus">-// supplied in the &quot;An update is available&quot; page of the update wizard. </span>
<a href="#l1.42"></a><span id="l1.42" class="difflineplus">+// supplied in the &quot;An update is available&quot; page of the update wizard.</span>
<a href="#l1.43"></a><span id="l1.43"> pref(&quot;app.update.url.details&quot;, &quot;chrome://communicator-region/locale/region.properties&quot;);</span>
<a href="#l1.44"></a><span id="l1.44" class="difflineminus">- </span>
<a href="#l1.45"></a><span id="l1.45" class="difflineplus">+</span>
<a href="#l1.46"></a><span id="l1.46"> // User-settable override to app.update.url for testing purposes.</span>
<a href="#l1.47"></a><span id="l1.47"> //pref(&quot;app.update.url.override&quot;, &quot;&quot;);</span>
<a href="#l1.48"></a><span id="l1.48" class="difflineminus">- </span>
<a href="#l1.49"></a><span id="l1.49" class="difflineplus">+</span>
<a href="#l1.50"></a><span id="l1.50"> // Enables some extra Application Update Logging (can reduce performance)</span>
<a href="#l1.51"></a><span id="l1.51"> pref(&quot;app.update.log&quot;, false);</span>
<a href="#l1.52"></a><span id="l1.52"> </span>
<a href="#l1.53"></a><span id="l1.53"> // The number of general background check failures to allow before notifying the</span>
<a href="#l1.54"></a><span id="l1.54"> // user of the failure. User initiated update checks always notify the user of</span>
<a href="#l1.55"></a><span id="l1.55"> // the failure.</span>
<a href="#l1.56"></a><span id="l1.56"> pref(&quot;app.update.backgroundMaxErrors&quot;, 10);</span>
<a href="#l1.57"></a><span id="l1.57"> </span>
<a href="#l1.58"></a><span id="l1.58" class="difflineat">@@ -551,17 +551,17 @@ pref(&quot;app.update.timerMinimumDelay&quot;, 120</span>
<a href="#l1.59"></a><span id="l1.59"> // Give the user x seconds to react before showing the big UI. default=8 days</span>
<a href="#l1.60"></a><span id="l1.60"> pref(&quot;app.update.promptWaitTime&quot;, 691200);</span>
<a href="#l1.61"></a><span id="l1.61"> #else</span>
<a href="#l1.62"></a><span id="l1.62"> // For nightly and aurora builds, before showing the big UI, default=12 hrs</span>
<a href="#l1.63"></a><span id="l1.63"> pref(&quot;app.update.promptWaitTime&quot;, 43200);</span>
<a href="#l1.64"></a><span id="l1.64"> #endif</span>
<a href="#l1.65"></a><span id="l1.65"> // Show the Update Checking/Ready UI when the user was idle for x seconds</span>
<a href="#l1.66"></a><span id="l1.66"> pref(&quot;app.update.idletime&quot;, 60);</span>
<a href="#l1.67"></a><span id="l1.67" class="difflineminus">- </span>
<a href="#l1.68"></a><span id="l1.68" class="difflineplus">+</span>
<a href="#l1.69"></a><span id="l1.69"> // Extension preferences</span>
<a href="#l1.70"></a><span id="l1.70"> </span>
<a href="#l1.71"></a><span id="l1.71"> // Enables some extra Extension System Logging (can reduce performance)</span>
<a href="#l1.72"></a><span id="l1.72"> pref(&quot;extensions.logging.enabled&quot;, false);</span>
<a href="#l1.73"></a><span id="l1.73"> </span>
<a href="#l1.74"></a><span id="l1.74"> // Disables strict compatibility, making addons compatible-by-default.</span>
<a href="#l1.75"></a><span id="l1.75"> pref(&quot;extensions.strictCompatibility&quot;, false);</span>
<a href="#l1.76"></a><span id="l1.76"> </span>
<a href="#l1.77"></a><span id="l1.77" class="difflineat">@@ -638,24 +638,24 @@ pref(&quot;browser.taskbar.previews.cachetime</span>
<a href="#l1.78"></a><span id="l1.78"> </span>
<a href="#l1.79"></a><span id="l1.79"> pref(&quot;sidebar.customize.all_panels.url&quot;, &quot;http://sidebar-rdf.netscape.com/%LOCALE%/sidebar-rdf/%SIDEBAR_VERSION%/all-panels.rdf&quot;);</span>
<a href="#l1.80"></a><span id="l1.80"> pref(&quot;sidebar.customize.directory.url&quot;, &quot;http://dmoz.org/Netscape/Sidebar/&quot;);</span>
<a href="#l1.81"></a><span id="l1.81"> pref(&quot;sidebar.customize.more_panels.url&quot;, &quot;http://dmoz.org/Netscape/Sidebar/&quot;);</span>
<a href="#l1.82"></a><span id="l1.82"> pref(&quot;sidebar.num_tabs_in_view&quot;, 8);</span>
<a href="#l1.83"></a><span id="l1.83"> </span>
<a href="#l1.84"></a><span id="l1.84"> pref(&quot;browser.throbber.url&quot;,&quot;chrome://navigator-region/locale/region.properties&quot;);</span>
<a href="#l1.85"></a><span id="l1.85"> </span>
<a href="#l1.86"></a><span id="l1.86" class="difflineminus">-// pref to control the alert notification </span>
<a href="#l1.87"></a><span id="l1.87" class="difflineplus">+// pref to control the alert notification</span>
<a href="#l1.88"></a><span id="l1.88"> pref(&quot;alerts.slideIncrement&quot;, 1);</span>
<a href="#l1.89"></a><span id="l1.89"> pref(&quot;alerts.slideIncrementTime&quot;, 10);</span>
<a href="#l1.90"></a><span id="l1.90"> pref(&quot;alerts.totalOpenTime&quot;, 10000);</span>
<a href="#l1.91"></a><span id="l1.91"> </span>
<a href="#l1.92"></a><span id="l1.92"> // 0 opens the download manager</span>
<a href="#l1.93"></a><span id="l1.93"> // 1 opens a progress dialog</span>
<a href="#l1.94"></a><span id="l1.94" class="difflineminus">-// 2 and other values, no download manager, no progress dialog. </span>
<a href="#l1.95"></a><span id="l1.95" class="difflineplus">+// 2 and other values, no download manager, no progress dialog.</span>
<a href="#l1.96"></a><span id="l1.96"> pref(&quot;browser.download.manager.behavior&quot;, 0);</span>
<a href="#l1.97"></a><span id="l1.97"> </span>
<a href="#l1.98"></a><span id="l1.98"> pref(&quot;privacy.popups.sound_enabled&quot;,              false);</span>
<a href="#l1.99"></a><span id="l1.99"> pref(&quot;privacy.popups.sound_type&quot;,                 1);</span>
<a href="#l1.100"></a><span id="l1.100"> pref(&quot;privacy.popups.sound_url&quot;,                  &quot;&quot;);</span>
<a href="#l1.101"></a><span id="l1.101"> pref(&quot;privacy.popups.statusbar_icon_enabled&quot;,     true);</span>
<a href="#l1.102"></a><span id="l1.102"> pref(&quot;privacy.popups.prefill_whitelist&quot;,          false);</span>
<a href="#l1.103"></a><span id="l1.103"> pref(&quot;privacy.popups.remove_blacklist&quot;,           true);</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l2.1"></a><span id="l2.1" class="difflineminus">--- a/suite/browser/browser.js</span>
<a href="#l2.2"></a><span id="l2.2" class="difflineplus">+++ b/suite/browser/browser.js</span>
<a href="#l2.3"></a><span id="l2.3" class="difflineat">@@ -16,19 +16,19 @@ function getWebNavigation()</span>
<a href="#l2.4"></a><span id="l2.4">     return getBrowser().webNavigation;</span>
<a href="#l2.5"></a><span id="l2.5">   } catch (e) {</span>
<a href="#l2.6"></a><span id="l2.6">     return null;</span>
<a href="#l2.7"></a><span id="l2.7">   }</span>
<a href="#l2.8"></a><span id="l2.8"> }</span>
<a href="#l2.9"></a><span id="l2.9"> </span>
<a href="#l2.10"></a><span id="l2.10"> function BrowserReloadWithFlags(reloadFlags)</span>
<a href="#l2.11"></a><span id="l2.11"> {</span>
<a href="#l2.12"></a><span id="l2.12" class="difflineminus">-  /* First, we'll try to use the session history object to reload so </span>
<a href="#l2.13"></a><span id="l2.13" class="difflineminus">-   * that framesets are handled properly. If we're in a special </span>
<a href="#l2.14"></a><span id="l2.14" class="difflineminus">-   * window (such as view-source) that has no session history, fall </span>
<a href="#l2.15"></a><span id="l2.15" class="difflineplus">+  /* First, we'll try to use the session history object to reload so</span>
<a href="#l2.16"></a><span id="l2.16" class="difflineplus">+   * that framesets are handled properly. If we're in a special</span>
<a href="#l2.17"></a><span id="l2.17" class="difflineplus">+   * window (such as view-source) that has no session history, fall</span>
<a href="#l2.18"></a><span id="l2.18">    * back on using the web navigation's reload method.</span>
<a href="#l2.19"></a><span id="l2.19">    */</span>
<a href="#l2.20"></a><span id="l2.20"> </span>
<a href="#l2.21"></a><span id="l2.21">   var webNav = getWebNavigation();</span>
<a href="#l2.22"></a><span id="l2.22">   try {</span>
<a href="#l2.23"></a><span id="l2.23">     var sh = webNav.sessionHistory;</span>
<a href="#l2.24"></a><span id="l2.24">     if (sh)</span>
<a href="#l2.25"></a><span id="l2.25">       webNav = sh.QueryInterface(Components.interfaces.nsIWebNavigation);</span>
<a href="#l2.26"></a><span id="l2.26" class="difflineat">@@ -51,17 +51,17 @@ function toggleAffectedChrome(aHide)</span>
<a href="#l2.27"></a><span id="l2.27">   //   (*) sidebar</span>
<a href="#l2.28"></a><span id="l2.28">   //   (*) statusbar</span>
<a href="#l2.29"></a><span id="l2.29">   //   (*) findbar</span>
<a href="#l2.30"></a><span id="l2.30"> </span>
<a href="#l2.31"></a><span id="l2.31">   if (!gChromeState)</span>
<a href="#l2.32"></a><span id="l2.32">     gChromeState = new Object;</span>
<a href="#l2.33"></a><span id="l2.33"> </span>
<a href="#l2.34"></a><span id="l2.34">   var statusbar = document.getElementById(&quot;status-bar&quot;);</span>
<a href="#l2.35"></a><span id="l2.35" class="difflineminus">-  getNavToolbox().hidden = aHide; </span>
<a href="#l2.36"></a><span id="l2.36" class="difflineplus">+  getNavToolbox().hidden = aHide;</span>
<a href="#l2.37"></a><span id="l2.37">   var notificationBox = gBrowser.getNotificationBox();</span>
<a href="#l2.38"></a><span id="l2.38">   var findbar = document.getElementById(&quot;FindToolbar&quot;)</span>
<a href="#l2.39"></a><span id="l2.39"> </span>
<a href="#l2.40"></a><span id="l2.40">   // sidebar states map as follows:</span>
<a href="#l2.41"></a><span id="l2.41">   //   hidden    =&gt; hide/show nothing</span>
<a href="#l2.42"></a><span id="l2.42">   //   collapsed =&gt; hide/show only the splitter</span>
<a href="#l2.43"></a><span id="l2.43">   //   shown     =&gt; hide/show the splitter and the box</span>
<a href="#l2.44"></a><span id="l2.44">   if (aHide)</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l3.1"></a><span id="l3.1" class="difflineminus">--- a/suite/browser/linkToolbarHandler.js</span>
<a href="#l3.2"></a><span id="l3.2" class="difflineplus">+++ b/suite/browser/linkToolbarHandler.js</span>
<a href="#l3.3"></a><span id="l3.3" class="difflineat">@@ -1,18 +1,18 @@</span>
<a href="#l3.4"></a><span id="l3.4"> /* This Source Code Form is subject to the terms of the Mozilla Public</span>
<a href="#l3.5"></a><span id="l3.5">  * License, v. 2.0. If a copy of the MPL was not distributed with this</span>
<a href="#l3.6"></a><span id="l3.6">  * file, You can obtain one at http://mozilla.org/MPL/2.0/. */</span>
<a href="#l3.7"></a><span id="l3.7"> </span>
<a href="#l3.8"></a><span id="l3.8" class="difflineminus">-/** </span>
<a href="#l3.9"></a><span id="l3.9" class="difflineminus">- * LinkToolbarHandler is a Singleton that displays LINK elements </span>
<a href="#l3.10"></a><span id="l3.10" class="difflineplus">+/**</span>
<a href="#l3.11"></a><span id="l3.11" class="difflineplus">+ * LinkToolbarHandler is a Singleton that displays LINK elements</span>
<a href="#l3.12"></a><span id="l3.12">  * and nodeLists of LINK elements in the Link Toolbar.  It</span>
<a href="#l3.13"></a><span id="l3.13" class="difflineminus">- * associates the LINK with a corresponding LinkToolbarItem based </span>
<a href="#l3.14"></a><span id="l3.14" class="difflineplus">+ * associates the LINK with a corresponding LinkToolbarItem based</span>
<a href="#l3.15"></a><span id="l3.15">  * on it's REL attribute and the toolbar item's ID attribute.</span>
<a href="#l3.16"></a><span id="l3.16" class="difflineminus">- * LinkToolbarHandler is also a Factory and will create </span>
<a href="#l3.17"></a><span id="l3.17" class="difflineplus">+ * LinkToolbarHandler is also a Factory and will create</span>
<a href="#l3.18"></a><span id="l3.18">  * LinkToolbarItems as necessary.</span>
<a href="#l3.19"></a><span id="l3.19">  */</span>
<a href="#l3.20"></a><span id="l3.20"> function LinkToolbarHandler()</span>
<a href="#l3.21"></a><span id="l3.21"> {</span>
<a href="#l3.22"></a><span id="l3.22">   this.items = new Array();</span>
<a href="#l3.23"></a><span id="l3.23">   this.hasItems = false;</span>
<a href="#l3.24"></a><span id="l3.24"> }</span>
<a href="#l3.25"></a><span id="l3.25"> </span>
<a href="#l3.26"></a><span id="l3.26" class="difflineat">@@ -144,29 +144,29 @@ function()</span>
<a href="#l3.27"></a><span id="l3.27"> }</span>
<a href="#l3.28"></a><span id="l3.28"> </span>
<a href="#l3.29"></a><span id="l3.29"> const linkToolbarHandler = new LinkToolbarHandler();</span>
<a href="#l3.30"></a><span id="l3.30"> var gLanguageBundle;</span>
<a href="#l3.31"></a><span id="l3.31"> </span>
<a href="#l3.32"></a><span id="l3.32"> function LinkElementDecorator(element) {</span>
<a href="#l3.33"></a><span id="l3.33">   /*</span>
<a href="#l3.34"></a><span id="l3.34">    * XXX: this is an incomplete decorator, because it doesn't implement</span>
<a href="#l3.35"></a><span id="l3.35" class="difflineminus">-   *      the full Element interface.  If you need to use a method </span>
<a href="#l3.36"></a><span id="l3.36" class="difflineplus">+   *      the full Element interface.  If you need to use a method</span>
<a href="#l3.37"></a><span id="l3.37">    *      or member in the Element interface, just add it here and</span>
<a href="#l3.38"></a><span id="l3.38">    *      have it delegate to this.element</span>
<a href="#l3.39"></a><span id="l3.39">    *</span>
<a href="#l3.40"></a><span id="l3.40">    * XXX: would rather add some methods to Element.prototype instead of</span>
<a href="#l3.41"></a><span id="l3.41" class="difflineminus">-   *    using a decorator, but Element.prototype is no longer exposed </span>
<a href="#l3.42"></a><span id="l3.42" class="difflineplus">+   *    using a decorator, but Element.prototype is no longer exposed</span>
<a href="#l3.43"></a><span id="l3.43">    *      since the XPCDOM landing, see bug 83433</span>
<a href="#l3.44"></a><span id="l3.44">    */</span>
<a href="#l3.45"></a><span id="l3.45"> </span>
<a href="#l3.46"></a><span id="l3.46">   if (!element) return; // skip the rest on foo.prototype = new ThisClass calls</span>
<a href="#l3.47"></a><span id="l3.47" class="difflineminus">-  </span>
<a href="#l3.48"></a><span id="l3.48" class="difflineplus">+</span>
<a href="#l3.49"></a><span id="l3.49">   this.element = element;</span>
<a href="#l3.50"></a><span id="l3.50" class="difflineminus">-  </span>
<a href="#l3.51"></a><span id="l3.51" class="difflineplus">+</span>
<a href="#l3.52"></a><span id="l3.52">   this.rel = LinkElementDecorator.convertRevMade(element.rel, element.rev);</span>
<a href="#l3.53"></a><span id="l3.53">   if (this.rel)</span>
<a href="#l3.54"></a><span id="l3.54">     this.relValues = this.rel.split(&quot; &quot;);</span>
<a href="#l3.55"></a><span id="l3.55">   this.rev = element.rev;</span>
<a href="#l3.56"></a><span id="l3.56">   this.title = element.title;</span>
<a href="#l3.57"></a><span id="l3.57">   this.href = element.href;</span>
<a href="#l3.58"></a><span id="l3.58">   this.hreflang = element.hreflang;</span>
<a href="#l3.59"></a><span id="l3.59">   this.media = element.media;</span>
<a href="#l3.60"></a><span id="l3.60" class="difflineat">@@ -179,51 +179,51 @@ function()</span>
<a href="#l3.61"></a><span id="l3.61">   if (!this.rel) return true;</span>
<a href="#l3.62"></a><span id="l3.62">   for (var i = 0; i &lt; this.relValues.length; i++)</span>
<a href="#l3.63"></a><span id="l3.63">     if (/^stylesheet$|^icon$|^fontdef$|^p3pv|^schema./i.test(this.relValues[i]))</span>
<a href="#l3.64"></a><span id="l3.64">       return true;</span>
<a href="#l3.65"></a><span id="l3.65">   return false;</span>
<a href="#l3.66"></a><span id="l3.66"> }</span>
<a href="#l3.67"></a><span id="l3.67"> </span>
<a href="#l3.68"></a><span id="l3.68"> LinkElementDecorator.convertRevMade =</span>
<a href="#l3.69"></a><span id="l3.69" class="difflineminus">-function(rel, rev) </span>
<a href="#l3.70"></a><span id="l3.70" class="difflineplus">+function(rel, rev)</span>
<a href="#l3.71"></a><span id="l3.71"> {</span>
<a href="#l3.72"></a><span id="l3.72">   if (!rel &amp;&amp; rev &amp;&amp; /\bmade\b/i.test(rev))</span>
<a href="#l3.73"></a><span id="l3.73">     return rev;</span>
<a href="#l3.74"></a><span id="l3.74">   else</span>
<a href="#l3.75"></a><span id="l3.75">     return rel;</span>
<a href="#l3.76"></a><span id="l3.76"> }</span>
<a href="#l3.77"></a><span id="l3.77"> </span>
<a href="#l3.78"></a><span id="l3.78"> LinkElementDecorator.prototype.getTooltip =</span>
<a href="#l3.79"></a><span id="l3.79" class="difflineminus">-function() </span>
<a href="#l3.80"></a><span id="l3.80" class="difflineplus">+function()</span>
<a href="#l3.81"></a><span id="l3.81"> {</span>
<a href="#l3.82"></a><span id="l3.82">   return this.getLongTitle() || this.href;</span>
<a href="#l3.83"></a><span id="l3.83"> }</span>
<a href="#l3.84"></a><span id="l3.84"> </span>
<a href="#l3.85"></a><span id="l3.85"> LinkElementDecorator.prototype.getLabel =</span>
<a href="#l3.86"></a><span id="l3.86" class="difflineminus">-function() </span>
<a href="#l3.87"></a><span id="l3.87" class="difflineplus">+function()</span>
<a href="#l3.88"></a><span id="l3.88"> {</span>
<a href="#l3.89"></a><span id="l3.89">   return this.getLongTitle() || this.rel;</span>
<a href="#l3.90"></a><span id="l3.90"> }</span>
<a href="#l3.91"></a><span id="l3.91"> </span>
<a href="#l3.92"></a><span id="l3.92"> LinkElementDecorator.prototype.getLongTitle =</span>
<a href="#l3.93"></a><span id="l3.93" class="difflineminus">-function() </span>
<a href="#l3.94"></a><span id="l3.94" class="difflineplus">+function()</span>
<a href="#l3.95"></a><span id="l3.95"> {</span>
<a href="#l3.96"></a><span id="l3.96">   if (this.longTitle == null)</span>
<a href="#l3.97"></a><span id="l3.97">     this.longTitle = this.makeLongTitle();</span>
<a href="#l3.98"></a><span id="l3.98"> </span>
<a href="#l3.99"></a><span id="l3.99">   return this.longTitle;</span>
<a href="#l3.100"></a><span id="l3.100"> }</span>
<a href="#l3.101"></a><span id="l3.101"> </span>
<a href="#l3.102"></a><span id="l3.102"> LinkElementDecorator.prototype.makeLongTitle =</span>
<a href="#l3.103"></a><span id="l3.103"> function()</span>
<a href="#l3.104"></a><span id="l3.104"> {</span>
<a href="#l3.105"></a><span id="l3.105">   var prefix = &quot;&quot;;</span>
<a href="#l3.106"></a><span id="l3.106"> </span>
<a href="#l3.107"></a><span id="l3.107" class="difflineminus">-  // XXX: lookup more meaningful and localized version of media, </span>
<a href="#l3.108"></a><span id="l3.108" class="difflineplus">+  // XXX: lookup more meaningful and localized version of media,</span>
<a href="#l3.109"></a><span id="l3.109">   //   i.e. media=&quot;print&quot; becomes &quot;Printable&quot; or some such</span>
<a href="#l3.110"></a><span id="l3.110">   // XXX: use localized version of &quot;:&quot; separator</span>
<a href="#l3.111"></a><span id="l3.111">   if (this.media &amp;&amp; !/\ball\b|\bscreen\b/i.test(this.media))</span>
<a href="#l3.112"></a><span id="l3.112">     prefix += this.media + &quot;: &quot;;</span>
<a href="#l3.113"></a><span id="l3.113">   if (this.hreflang) {</span>
<a href="#l3.114"></a><span id="l3.114">     try {</span>
<a href="#l3.115"></a><span id="l3.115">       if (!gLanguageBundle)</span>
<a href="#l3.116"></a><span id="l3.116">         gLanguageBundle = document.getElementById(&quot;languageBundle&quot;);</span>
<a href="#l3.117"></a><span id="l3.117" class="difflineat">@@ -241,30 +241,30 @@ function()</span>
<a href="#l3.118"></a><span id="l3.118"> }</span>
<a href="#l3.119"></a><span id="l3.119"> </span>
<a href="#l3.120"></a><span id="l3.120"> function AnchorElementDecorator(element) {</span>
<a href="#l3.121"></a><span id="l3.121">   this.constructor(element);</span>
<a href="#l3.122"></a><span id="l3.122"> }</span>
<a href="#l3.123"></a><span id="l3.123"> AnchorElementDecorator.prototype = new LinkElementDecorator;</span>
<a href="#l3.124"></a><span id="l3.124"> </span>
<a href="#l3.125"></a><span id="l3.125"> AnchorElementDecorator.prototype.getLongTitle =</span>
<a href="#l3.126"></a><span id="l3.126" class="difflineminus">-function() </span>
<a href="#l3.127"></a><span id="l3.127" class="difflineplus">+function()</span>
<a href="#l3.128"></a><span id="l3.128"> {</span>
<a href="#l3.129"></a><span id="l3.129" class="difflineminus">-  return this.title ? this.__proto__.getLongTitle.apply(this) </span>
<a href="#l3.130"></a><span id="l3.130" class="difflineplus">+  return this.title ? this.__proto__.getLongTitle.apply(this)</span>
<a href="#l3.131"></a><span id="l3.131">       : getText(this.element);</span>
<a href="#l3.132"></a><span id="l3.132"> }</span>
<a href="#l3.133"></a><span id="l3.133"> </span>
<a href="#l3.134"></a><span id="l3.134"> AnchorElementDecorator.prototype.getText =</span>
<a href="#l3.135"></a><span id="l3.135"> function(element)</span>
<a href="#l3.136"></a><span id="l3.136"> {</span>
<a href="#l3.137"></a><span id="l3.137">   return condenseWhitespace(getTextRecursive(element));</span>
<a href="#l3.138"></a><span id="l3.138"> }</span>
<a href="#l3.139"></a><span id="l3.139"> </span>
<a href="#l3.140"></a><span id="l3.140"> AnchorElementDecorator.prototype.getTextRecursive =</span>
<a href="#l3.141"></a><span id="l3.141" class="difflineminus">-function(node) </span>
<a href="#l3.142"></a><span id="l3.142" class="difflineplus">+function(node)</span>
<a href="#l3.143"></a><span id="l3.143"> {</span>
<a href="#l3.144"></a><span id="l3.144">   var text = &quot;&quot;;</span>
<a href="#l3.145"></a><span id="l3.145">   node.normalize();</span>
<a href="#l3.146"></a><span id="l3.146">   if (node.hasChildNodes()) {</span>
<a href="#l3.147"></a><span id="l3.147">     for (var i = 0; i &lt; node.childNodes.length; i++) {</span>
<a href="#l3.148"></a><span id="l3.148">       if (node.childNodes.item(i).nodeType == Node.TEXT_NODE)</span>
<a href="#l3.149"></a><span id="l3.149">         text += node.childNodes.item(i).nodeValue;</span>
<a href="#l3.150"></a><span id="l3.150">       else if (node.childNodes.item(i).nodeType == Node.ELEMENT_NODE)</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l4.1"></a><span id="l4.1" class="difflineminus">--- a/suite/browser/linkToolbarItem.js</span>
<a href="#l4.2"></a><span id="l4.2" class="difflineplus">+++ b/suite/browser/linkToolbarItem.js</span>
<a href="#l4.3"></a><span id="l4.3" class="difflineat">@@ -1,14 +1,14 @@</span>
<a href="#l4.4"></a><span id="l4.4"> /* This Source Code Form is subject to the terms of the Mozilla Public</span>
<a href="#l4.5"></a><span id="l4.5">  * License, v. 2.0. If a copy of the MPL was not distributed with this</span>
<a href="#l4.6"></a><span id="l4.6">  * file, You can obtain one at http://mozilla.org/MPL/2.0/. */</span>
<a href="#l4.7"></a><span id="l4.7"> </span>
<a href="#l4.8"></a><span id="l4.8" class="difflineminus">-/* </span>
<a href="#l4.9"></a><span id="l4.9" class="difflineminus">- * LinkToolbarItem and its subclasses represent the buttons, menuitems, </span>
<a href="#l4.10"></a><span id="l4.10" class="difflineplus">+/*</span>
<a href="#l4.11"></a><span id="l4.11" class="difflineplus">+ * LinkToolbarItem and its subclasses represent the buttons, menuitems,</span>
<a href="#l4.12"></a><span id="l4.12">  * and menus that handle the various link types.</span>
<a href="#l4.13"></a><span id="l4.13">  */</span>
<a href="#l4.14"></a><span id="l4.14"> function LinkToolbarItem (linkType) {</span>
<a href="#l4.15"></a><span id="l4.15">   this.linkType = linkType;</span>
<a href="#l4.16"></a><span id="l4.16">   this.xulElementId = &quot;link-&quot; + linkType;</span>
<a href="#l4.17"></a><span id="l4.17">   this.xulPopupId = this.xulElementId + &quot;-popup&quot;;</span>
<a href="#l4.18"></a><span id="l4.18">   this.parentMenuButton = null;</span>
<a href="#l4.19"></a><span id="l4.19"> </span>
<a href="#l4.20"></a><span id="l4.20" class="difflineat">@@ -53,17 +53,17 @@ function LinkToolbarItem (linkType) {</span>
<a href="#l4.21"></a><span id="l4.21">           this.getXULElement());</span>
<a href="#l4.22"></a><span id="l4.22"> </span>
<a href="#l4.23"></a><span id="l4.23">     return this.parentMenuButton;</span>
<a href="#l4.24"></a><span id="l4.24">   }</span>
<a href="#l4.25"></a><span id="l4.25"> </span>
<a href="#l4.26"></a><span id="l4.26">   function getParentMenuButtonRecursive(xulElement) {</span>
<a href="#l4.27"></a><span id="l4.27">     if (!xulElement) return null;</span>
<a href="#l4.28"></a><span id="l4.28"> </span>
<a href="#l4.29"></a><span id="l4.29" class="difflineminus">-    if (xulElement.tagName == &quot;toolbarbutton&quot;) </span>
<a href="#l4.30"></a><span id="l4.30" class="difflineplus">+    if (xulElement.tagName == &quot;toolbarbutton&quot;)</span>
<a href="#l4.31"></a><span id="l4.31">       return xulElement;</span>
<a href="#l4.32"></a><span id="l4.32"> </span>
<a href="#l4.33"></a><span id="l4.33">     return getParentMenuButtonRecursive(xulElement.parentNode)</span>
<a href="#l4.34"></a><span id="l4.34">   }</span>
<a href="#l4.35"></a><span id="l4.35"> }</span>
<a href="#l4.36"></a><span id="l4.36"> </span>
<a href="#l4.37"></a><span id="l4.37"> </span>
<a href="#l4.38"></a><span id="l4.38"> function LinkToolbarButton (linkType) {</span>
<a href="#l4.39"></a><span id="l4.39" class="difflineat">@@ -125,30 +125,30 @@ function LinkToolbarMenu (linkType) {</span>
<a href="#l4.40"></a><span id="l4.40"> </span>
<a href="#l4.41"></a><span id="l4.41">   this.createMenuItem = function(linkElement) {</span>
<a href="#l4.42"></a><span id="l4.42">     // XXX: clone a prototypical XUL element instead of hardcoding these</span>
<a href="#l4.43"></a><span id="l4.43">     //   attributes</span>
<a href="#l4.44"></a><span id="l4.44">     var menuitem = document.createElement(&quot;menuitem&quot;);</span>
<a href="#l4.45"></a><span id="l4.45">     menuitem.setAttribute(&quot;label&quot;, linkElement.getLabel());</span>
<a href="#l4.46"></a><span id="l4.46">     menuitem.setAttribute(&quot;href&quot;, linkElement.href);</span>
<a href="#l4.47"></a><span id="l4.47">     menuitem.setAttribute(&quot;class&quot;, &quot;menuitem-iconic bookmark-item&quot;);</span>
<a href="#l4.48"></a><span id="l4.48" class="difflineminus">-    menuitem.setAttribute(&quot;rdf:type&quot;, </span>
<a href="#l4.49"></a><span id="l4.49" class="difflineplus">+    menuitem.setAttribute(&quot;rdf:type&quot;,</span>
<a href="#l4.50"></a><span id="l4.50">         &quot;rdf:http://www.w3.org/1999/02/22-rdf-syntax-ns#linkType&quot;);</span>
<a href="#l4.51"></a><span id="l4.51"> </span>
<a href="#l4.52"></a><span id="l4.52">     return menuitem;</span>
<a href="#l4.53"></a><span id="l4.53">   }</span>
<a href="#l4.54"></a><span id="l4.54"> }</span>
<a href="#l4.55"></a><span id="l4.55"> LinkToolbarMenu.prototype = new LinkToolbarItem;</span>
<a href="#l4.56"></a><span id="l4.56"> </span>
<a href="#l4.57"></a><span id="l4.57"> </span>
<a href="#l4.58"></a><span id="l4.58"> function LinkToolbarTransientMenu (linkType) {</span>
<a href="#l4.59"></a><span id="l4.59">   this.constructor(linkType);</span>
<a href="#l4.60"></a><span id="l4.60"> </span>
<a href="#l4.61"></a><span id="l4.61">   this.getXULElement = function() {</span>
<a href="#l4.62"></a><span id="l4.62" class="difflineminus">-    if (this.__proto__.getXULElement.apply(this)) </span>
<a href="#l4.63"></a><span id="l4.63" class="difflineplus">+    if (this.__proto__.getXULElement.apply(this))</span>
<a href="#l4.64"></a><span id="l4.64">       return this.__proto__.getXULElement.apply(this);</span>
<a href="#l4.65"></a><span id="l4.65">     else</span>
<a href="#l4.66"></a><span id="l4.66">       return this.createXULElement();</span>
<a href="#l4.67"></a><span id="l4.67">   }</span>
<a href="#l4.68"></a><span id="l4.68"> </span>
<a href="#l4.69"></a><span id="l4.69">   this.createXULElement = function() {</span>
<a href="#l4.70"></a><span id="l4.70">     // XXX: clone a prototypical XUL element instead of hardcoding these</span>
<a href="#l4.71"></a><span id="l4.71">     //   attributes</span>
<a href="#l4.72"></a><span id="l4.72" class="difflineat">@@ -164,17 +164,17 @@ function LinkToolbarTransientMenu (linkT</span>
<a href="#l4.73"></a><span id="l4.73"> </span>
<a href="#l4.74"></a><span id="l4.74">     return menu;</span>
<a href="#l4.75"></a><span id="l4.75">   }</span>
<a href="#l4.76"></a><span id="l4.76"> </span>
<a href="#l4.77"></a><span id="l4.77">   this.getPopup = function() {</span>
<a href="#l4.78"></a><span id="l4.78">     if (!this.__proto__.getPopup.apply(this))</span>
<a href="#l4.79"></a><span id="l4.79">       this.getXULElement().appendChild(this.createPopup());</span>
<a href="#l4.80"></a><span id="l4.80"> </span>
<a href="#l4.81"></a><span id="l4.81" class="difflineminus">-    return this.__proto__.getPopup.apply(this) </span>
<a href="#l4.82"></a><span id="l4.82" class="difflineplus">+    return this.__proto__.getPopup.apply(this)</span>
<a href="#l4.83"></a><span id="l4.83">   }</span>
<a href="#l4.84"></a><span id="l4.84"> </span>
<a href="#l4.85"></a><span id="l4.85">   this.createPopup = function() {</span>
<a href="#l4.86"></a><span id="l4.86">     var popup = document.createElement(&quot;menupopup&quot;);</span>
<a href="#l4.87"></a><span id="l4.87">     popup.setAttribute(&quot;id&quot;, this.xulPopupId);</span>
<a href="#l4.88"></a><span id="l4.88"> </span>
<a href="#l4.89"></a><span id="l4.89">     return popup;</span>
<a href="#l4.90"></a><span id="l4.90">   }</span>
<a href="#l4.91"></a><span id="l4.91" class="difflineat">@@ -184,17 +184,17 @@ function LinkToolbarTransientMenu (linkT</span>
<a href="#l4.92"></a><span id="l4.92"> </span>
<a href="#l4.93"></a><span id="l4.93">     // XXX: we really want to use this instead of removeXULElement</span>
<a href="#l4.94"></a><span id="l4.94">     //this.hideXULElement();</span>
<a href="#l4.95"></a><span id="l4.95">     this.removeXULElement();</span>
<a href="#l4.96"></a><span id="l4.96">   }</span>
<a href="#l4.97"></a><span id="l4.97"> </span>
<a href="#l4.98"></a><span id="l4.98">   this.hideXULElement = function() {</span>
<a href="#l4.99"></a><span id="l4.99">     /*</span>
<a href="#l4.100"></a><span id="l4.100" class="difflineminus">-     * XXX: using &quot;hidden&quot; or &quot;collapsed&quot; leads to a crash when you </span>
<a href="#l4.101"></a><span id="l4.101" class="difflineplus">+     * XXX: using &quot;hidden&quot; or &quot;collapsed&quot; leads to a crash when you</span>
<a href="#l4.102"></a><span id="l4.102">      *        open the More menu under certain circumstances.  Maybe</span>
<a href="#l4.103"></a><span id="l4.103">      *        related to bug 83906.  As of 0.9.2 I it doesn't seem</span>
<a href="#l4.104"></a><span id="l4.104">      *        to crash anymore.</span>
<a href="#l4.105"></a><span id="l4.105">      */</span>
<a href="#l4.106"></a><span id="l4.106">     this.getXULElement().setAttribute(&quot;collapsed&quot;, &quot;true&quot;);</span>
<a href="#l4.107"></a><span id="l4.107">   }</span>
<a href="#l4.108"></a><span id="l4.108"> </span>
<a href="#l4.109"></a><span id="l4.109">   this.removeXULElement = function() {</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l5.1"></a><span id="l5.1" class="difflineminus">--- a/suite/browser/linkToolbarOverlay.js</span>
<a href="#l5.2"></a><span id="l5.2" class="difflineplus">+++ b/suite/browser/linkToolbarOverlay.js</span>
<a href="#l5.3"></a><span id="l5.3" class="difflineat">@@ -54,22 +54,22 @@ function(event)</span>
<a href="#l5.4"></a><span id="l5.4"> </span>
<a href="#l5.5"></a><span id="l5.5"> LinkToolbarUI.prototype.fullSlowRefresh =</span>
<a href="#l5.6"></a><span id="l5.6"> function()</span>
<a href="#l5.7"></a><span id="l5.7"> {</span>
<a href="#l5.8"></a><span id="l5.8">   var currentNode = getBrowser().contentDocument.documentElement;</span>
<a href="#l5.9"></a><span id="l5.9">   if (!(currentNode instanceof Components.interfaces.nsIDOMHTMLHtmlElement))</span>
<a href="#l5.10"></a><span id="l5.10">     return;</span>
<a href="#l5.11"></a><span id="l5.11">   currentNode = currentNode.firstChild;</span>
<a href="#l5.12"></a><span id="l5.12" class="difflineminus">-  </span>
<a href="#l5.13"></a><span id="l5.13" class="difflineplus">+</span>
<a href="#l5.14"></a><span id="l5.14">   while(currentNode)</span>
<a href="#l5.15"></a><span id="l5.15">   {</span>
<a href="#l5.16"></a><span id="l5.16">     if (currentNode instanceof Components.interfaces.nsIDOMHTMLHeadElement) {</span>
<a href="#l5.17"></a><span id="l5.17">       currentNode = currentNode.firstChild;</span>
<a href="#l5.18"></a><span id="l5.18" class="difflineminus">-      </span>
<a href="#l5.19"></a><span id="l5.19" class="difflineplus">+</span>
<a href="#l5.20"></a><span id="l5.20">       while(currentNode)</span>
<a href="#l5.21"></a><span id="l5.21">       {</span>
<a href="#l5.22"></a><span id="l5.22">         if (currentNode instanceof Components.interfaces.nsIDOMHTMLLinkElement)</span>
<a href="#l5.23"></a><span id="l5.23">           linkToolbarUI.linkAdded({originalTarget: currentNode});</span>
<a href="#l5.24"></a><span id="l5.24">         currentNode = currentNode.nextSibling;</span>
<a href="#l5.25"></a><span id="l5.25">       }</span>
<a href="#l5.26"></a><span id="l5.26">     }</span>
<a href="#l5.27"></a><span id="l5.27">     else if (currentNode instanceof Components.interfaces.nsIDOMElement)</span>
<a href="#l5.28"></a><span id="l5.28" class="difflineat">@@ -78,17 +78,17 @@ function()</span>
<a href="#l5.29"></a><span id="l5.29">       // Got something else instead. returning</span>
<a href="#l5.30"></a><span id="l5.30">        return;</span>
<a href="#l5.31"></a><span id="l5.31">     }</span>
<a href="#l5.32"></a><span id="l5.32">     else</span>
<a href="#l5.33"></a><span id="l5.33">     {</span>
<a href="#l5.34"></a><span id="l5.34">       // Got a comment node or something like that. Moving on.</span>
<a href="#l5.35"></a><span id="l5.35">       currentNode = currentNode.nextSibling;</span>
<a href="#l5.36"></a><span id="l5.36">     }</span>
<a href="#l5.37"></a><span id="l5.37" class="difflineminus">-  }  </span>
<a href="#l5.38"></a><span id="l5.38" class="difflineplus">+  }</span>
<a href="#l5.39"></a><span id="l5.39"> }</span>
<a href="#l5.40"></a><span id="l5.40"> </span>
<a href="#l5.41"></a><span id="l5.41"> LinkToolbarUI.prototype.toolbarActive = false;</span>
<a href="#l5.42"></a><span id="l5.42"> </span>
<a href="#l5.43"></a><span id="l5.43"> LinkToolbarUI.prototype.activate =</span>
<a href="#l5.44"></a><span id="l5.44"> function()</span>
<a href="#l5.45"></a><span id="l5.45"> {</span>
<a href="#l5.46"></a><span id="l5.46">   if (!linkToolbarUI.toolbarActive) {</span>
<a href="#l5.47"></a><span id="l5.47" class="difflineat">@@ -122,21 +122,21 @@ function()</span>
<a href="#l5.48"></a><span id="l5.48"> }</span>
<a href="#l5.49"></a><span id="l5.49"> </span>
<a href="#l5.50"></a><span id="l5.50"> /* called whenever something on the toolbar gets an oncommand event */</span>
<a href="#l5.51"></a><span id="l5.51"> LinkToolbarUI.prototype.commanded =</span>
<a href="#l5.52"></a><span id="l5.52"> function(event)</span>
<a href="#l5.53"></a><span id="l5.53"> {</span>
<a href="#l5.54"></a><span id="l5.54">   // Return if this is one of the menubuttons.</span>
<a href="#l5.55"></a><span id="l5.55">   if (event.target.getAttribute(&quot;type&quot;) == &quot;menu&quot;) return;</span>
<a href="#l5.56"></a><span id="l5.56" class="difflineminus">-  </span>
<a href="#l5.57"></a><span id="l5.57" class="difflineplus">+</span>
<a href="#l5.58"></a><span id="l5.58">   if (!event.target.getAttribute(&quot;href&quot;)) return;</span>
<a href="#l5.59"></a><span id="l5.59"> </span>
<a href="#l5.60"></a><span id="l5.60">   var destURL = event.target.getAttribute(&quot;href&quot;);</span>
<a href="#l5.61"></a><span id="l5.61" class="difflineminus">-  </span>
<a href="#l5.62"></a><span id="l5.62" class="difflineplus">+</span>
<a href="#l5.63"></a><span id="l5.63">   // We have to do a security check here, because we are loading URIs given</span>
<a href="#l5.64"></a><span id="l5.64">   // to us by a web page from chrome, which is privileged.</span>
<a href="#l5.65"></a><span id="l5.65">   try {</span>
<a href="#l5.66"></a><span id="l5.66">     urlSecurityCheck(destURL, content.document.nodePrincipal,</span>
<a href="#l5.67"></a><span id="l5.67">                      Components.interfaces.nsIScriptSecurityManager.STANDARD);</span>
<a href="#l5.68"></a><span id="l5.68">     loadURI(destURL, content.document.documentURIObject);</span>
<a href="#l5.69"></a><span id="l5.69">   } catch (e) {</span>
<a href="#l5.70"></a><span id="l5.70">     dump(&quot;Error: it is not permitted to load this URI from a &lt;link&gt; element: &quot; + e);</span>
<a href="#l5.71"></a><span id="l5.71" class="difflineat">@@ -151,17 +151,17 @@ function(checkedItem)</span>
<a href="#l5.72"></a><span id="l5.72">   this.goToggleTristateToolbar(&quot;linktoolbar&quot;, checkedItem);</span>
<a href="#l5.73"></a><span id="l5.73">   this.initHandlers();</span>
<a href="#l5.74"></a><span id="l5.74">   if (this.isLinkToolbarEnabled())</span>
<a href="#l5.75"></a><span id="l5.75">     this.fullSlowRefresh();</span>
<a href="#l5.76"></a><span id="l5.76">   else</span>
<a href="#l5.77"></a><span id="l5.77">     linkToolbarHandler.clearAllItems();</span>
<a href="#l5.78"></a><span id="l5.78"> }</span>
<a href="#l5.79"></a><span id="l5.79"> </span>
<a href="#l5.80"></a><span id="l5.80" class="difflineminus">-LinkToolbarUI.prototype.initLinkbarVisibilityMenu = </span>
<a href="#l5.81"></a><span id="l5.81" class="difflineplus">+LinkToolbarUI.prototype.initLinkbarVisibilityMenu =</span>
<a href="#l5.82"></a><span id="l5.82"> function()</span>
<a href="#l5.83"></a><span id="l5.83"> {</span>
<a href="#l5.84"></a><span id="l5.84">   var state = document.getElementById(&quot;linktoolbar&quot;).getAttribute(&quot;hidden&quot;);</span>
<a href="#l5.85"></a><span id="l5.85">   if (!state)</span>
<a href="#l5.86"></a><span id="l5.86">     state = &quot;maybe&quot;;</span>
<a href="#l5.87"></a><span id="l5.87">   var checkedItem = document.getElementById(&quot;cmd_viewlinktoolbar_&quot; + state);</span>
<a href="#l5.88"></a><span id="l5.88">   checkedItem.setAttribute(&quot;checked&quot;, true);</span>
<a href="#l5.89"></a><span id="l5.89">   checkedItem.checked = true;</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l6.1"></a><span id="l6.1" class="difflineminus">--- a/suite/browser/mailNavigatorOverlay.js</span>
<a href="#l6.2"></a><span id="l6.2" class="difflineplus">+++ b/suite/browser/mailNavigatorOverlay.js</span>
<a href="#l6.3"></a><span id="l6.3" class="difflineat">@@ -124,17 +124,17 @@ function sendMedia(mediaURL)</span>
<a href="#l6.4"></a><span id="l6.4">     dump(&quot;Cannot Send Media: &quot; + ex + &quot;\n&quot;);</span>
<a href="#l6.5"></a><span id="l6.5">   }</span>
<a href="#l6.6"></a><span id="l6.6"> }</span>
<a href="#l6.7"></a><span id="l6.7"> </span>
<a href="#l6.8"></a><span id="l6.8"> function sendPage(aDocument)</span>
<a href="#l6.9"></a><span id="l6.9"> {</span>
<a href="#l6.10"></a><span id="l6.10">   if (!aDocument)</span>
<a href="#l6.11"></a><span id="l6.11">     aDocument = window.content.document;</span>
<a href="#l6.12"></a><span id="l6.12" class="difflineminus">-    </span>
<a href="#l6.13"></a><span id="l6.13" class="difflineplus">+</span>
<a href="#l6.14"></a><span id="l6.14">   try</span>
<a href="#l6.15"></a><span id="l6.15">   {</span>
<a href="#l6.16"></a><span id="l6.16">     var charset = getCharsetforSave(aDocument);</span>
<a href="#l6.17"></a><span id="l6.17">     openComposeWindow(aDocument.URL, aDocument.title, 1, charset);</span>
<a href="#l6.18"></a><span id="l6.18">   }</span>
<a href="#l6.19"></a><span id="l6.19">   catch(ex)</span>
<a href="#l6.20"></a><span id="l6.20">   {</span>
<a href="#l6.21"></a><span id="l6.21">     dump(&quot;Cannot Send Page: &quot; + ex + &quot;\n&quot;);</span>
<a href="#l6.22"></a><span id="l6.22" class="difflineat">@@ -146,17 +146,17 @@ function initMailContextMenuItems(aEvent</span>
<a href="#l6.23"></a><span id="l6.23">   var shouldShowSendPage = !(gContextMenu.onTextInput || gContextMenu.isContentSelected ||</span>
<a href="#l6.24"></a><span id="l6.24">                            gContextMenu.onVideo || gContextMenu.onAudio) &amp;&amp;</span>
<a href="#l6.25"></a><span id="l6.25">                            !gContextMenu.onLink &amp;&amp;</span>
<a href="#l6.26"></a><span id="l6.26">                            !gUseExternalMailto;</span>
<a href="#l6.27"></a><span id="l6.27">   gContextMenu.showItem(&quot;context-sendpage&quot;, shouldShowSendPage);</span>
<a href="#l6.28"></a><span id="l6.28"> </span>
<a href="#l6.29"></a><span id="l6.29">   gContextMenu.showItem(&quot;context-sep-apps&quot;, gContextMenu.shouldShowSeparator(&quot;context-sep-apps&quot;));</span>
<a href="#l6.30"></a><span id="l6.30"> }</span>
<a href="#l6.31"></a><span id="l6.31" class="difflineminus">-  </span>
<a href="#l6.32"></a><span id="l6.32" class="difflineplus">+</span>
<a href="#l6.33"></a><span id="l6.33"> function initMailContextMenuPopupListener(aEvent)</span>
<a href="#l6.34"></a><span id="l6.34"> {</span>
<a href="#l6.35"></a><span id="l6.35">   var popup = document.getElementById(&quot;contentAreaContextMenu&quot;);</span>
<a href="#l6.36"></a><span id="l6.36">   if (popup)</span>
<a href="#l6.37"></a><span id="l6.37">     popup.addEventListener(&quot;popupshowing&quot;, initMailContextMenuItems, false);</span>
<a href="#l6.38"></a><span id="l6.38"> }</span>
<a href="#l6.39"></a><span id="l6.39"> </span>
<a href="#l6.40"></a><span id="l6.40"> function hideMenuitems() {</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l7.1"></a><span id="l7.1" class="difflineminus">--- a/suite/browser/metadata.js</span>
<a href="#l7.2"></a><span id="l7.2" class="difflineplus">+++ b/suite/browser/metadata.js</span>
<a href="#l7.3"></a><span id="l7.3" class="difflineat">@@ -26,17 +26,17 @@ var onLang   = false;</span>
<a href="#l7.4"></a><span id="l7.4"> </span>
<a href="#l7.5"></a><span id="l7.5"> const OPEN_READONLY = Components.interfaces.nsICacheStorage.OPEN_READONLY;</span>
<a href="#l7.6"></a><span id="l7.6"> </span>
<a href="#l7.7"></a><span id="l7.7"> function onLoad()</span>
<a href="#l7.8"></a><span id="l7.8"> {</span>
<a href="#l7.9"></a><span id="l7.9">     gMetadataBundle = document.getElementById(&quot;bundle_metadata&quot;);</span>
<a href="#l7.10"></a><span id="l7.10">     gLangBundle = document.getElementById(&quot;bundle_languages&quot;);</span>
<a href="#l7.11"></a><span id="l7.11">     gRegionBundle = document.getElementById(&quot;bundle_regions&quot;);</span>
<a href="#l7.12"></a><span id="l7.12" class="difflineminus">-    </span>
<a href="#l7.13"></a><span id="l7.13" class="difflineplus">+</span>
<a href="#l7.14"></a><span id="l7.14">     showMetadataFor(window.arguments[0]);</span>
<a href="#l7.15"></a><span id="l7.15"> </span>
<a href="#l7.16"></a><span id="l7.16">     nodeView = window.arguments[0].ownerDocument.defaultView;</span>
<a href="#l7.17"></a><span id="l7.17"> }</span>
<a href="#l7.18"></a><span id="l7.18"> </span>
<a href="#l7.19"></a><span id="l7.19"> function showMetadataFor(elem)</span>
<a href="#l7.20"></a><span id="l7.20"> {</span>
<a href="#l7.21"></a><span id="l7.21">     // skip past non-element nodes</span>
<a href="#l7.22"></a><span id="l7.22" class="difflineat">@@ -45,42 +45,42 @@ function showMetadataFor(elem)</span>
<a href="#l7.23"></a><span id="l7.23"> </span>
<a href="#l7.24"></a><span id="l7.24">     if (!elem) {</span>
<a href="#l7.25"></a><span id="l7.25">         alert(gMetadataBundle.getString(&quot;unableToShowProps&quot;));</span>
<a href="#l7.26"></a><span id="l7.26">         window.close();</span>
<a href="#l7.27"></a><span id="l7.27">     }</span>
<a href="#l7.28"></a><span id="l7.28"> </span>
<a href="#l7.29"></a><span id="l7.29">     if (elem.ownerDocument.getElementsByName &amp;&amp; !elem.ownerDocument.namespaceURI)</span>
<a href="#l7.30"></a><span id="l7.30">         htmlMode = true;</span>
<a href="#l7.31"></a><span id="l7.31" class="difflineminus">-    </span>
<a href="#l7.32"></a><span id="l7.32" class="difflineplus">+</span>
<a href="#l7.33"></a><span id="l7.33">     // htmllocalname is &quot;&quot; if it's not an html tag, or the name of the tag if it is.</span>
<a href="#l7.34"></a><span id="l7.34">     var htmllocalname = &quot;&quot;;</span>
<a href="#l7.35"></a><span id="l7.35" class="difflineminus">-    if (isHTMLElement(elem,&quot;&quot;)) { </span>
<a href="#l7.36"></a><span id="l7.36" class="difflineplus">+    if (isHTMLElement(elem,&quot;&quot;)) {</span>
<a href="#l7.37"></a><span id="l7.37">         htmllocalname = elem.localName.toLowerCase();</span>
<a href="#l7.38"></a><span id="l7.38">     }</span>
<a href="#l7.39"></a><span id="l7.39" class="difflineminus">-    </span>
<a href="#l7.40"></a><span id="l7.40" class="difflineplus">+</span>
<a href="#l7.41"></a><span id="l7.41">     // We only look for images once</span>
<a href="#l7.42"></a><span id="l7.42">     checkForImage(elem, htmllocalname);</span>
<a href="#l7.43"></a><span id="l7.43" class="difflineminus">-    </span>
<a href="#l7.44"></a><span id="l7.44" class="difflineplus">+</span>
<a href="#l7.45"></a><span id="l7.45">     // Walk up the tree, looking for elements of interest.</span>
<a href="#l7.46"></a><span id="l7.46">     // Each of them could be at a different level in the tree, so they each</span>
<a href="#l7.47"></a><span id="l7.47">     // need their own boolean to tell us to stop looking.</span>
<a href="#l7.48"></a><span id="l7.48">     while (elem &amp;&amp; elem.nodeType == Node.ELEMENT_NODE) {</span>
<a href="#l7.49"></a><span id="l7.49">         htmllocalname = &quot;&quot;;</span>
<a href="#l7.50"></a><span id="l7.50">         if (isHTMLElement(elem,&quot;&quot;)) {</span>
<a href="#l7.51"></a><span id="l7.51">             htmllocalname = elem.localName.toLowerCase();</span>
<a href="#l7.52"></a><span id="l7.52">         }</span>
<a href="#l7.53"></a><span id="l7.53"> </span>
<a href="#l7.54"></a><span id="l7.54">         if (!onLink)   checkForLink(elem, htmllocalname);</span>
<a href="#l7.55"></a><span id="l7.55">         if (!onInsDel) checkForInsDel(elem, htmllocalname);</span>
<a href="#l7.56"></a><span id="l7.56">         if (!onQuote)  checkForQuote(elem, htmllocalname);</span>
<a href="#l7.57"></a><span id="l7.57">         if (!onTable)  checkForTable(elem, htmllocalname);</span>
<a href="#l7.58"></a><span id="l7.58">         if (!onTitle)  checkForTitle(elem, htmllocalname);</span>
<a href="#l7.59"></a><span id="l7.59">         if (!onLang)   checkForLang(elem, htmllocalname);</span>
<a href="#l7.60"></a><span id="l7.60" class="difflineminus">-          </span>
<a href="#l7.61"></a><span id="l7.61" class="difflineplus">+</span>
<a href="#l7.62"></a><span id="l7.62">         elem = elem.parentNode;</span>
<a href="#l7.63"></a><span id="l7.63">     }</span>
<a href="#l7.64"></a><span id="l7.64"> </span>
<a href="#l7.65"></a><span id="l7.65">     // Decide which sections to show</span>
<a href="#l7.66"></a><span id="l7.66">     var onMisc = onTable || onTitle || onLang;</span>
<a href="#l7.67"></a><span id="l7.67">     if (!onMisc)   hideNode(&quot;misc-sec&quot;);</span>
<a href="#l7.68"></a><span id="l7.68">     if (!onLink)   hideNode(&quot;link-sec&quot;);</span>
<a href="#l7.69"></a><span id="l7.69">     if (!onImage)  hideNode(&quot;image-sec&quot;);</span>
<a href="#l7.70"></a><span id="l7.70" class="difflineat">@@ -162,17 +162,17 @@ function checkForImage(elem, htmllocalna</span>
<a href="#l7.71"></a><span id="l7.71"> </span>
<a href="#l7.72"></a><span id="l7.72">     }</span>
<a href="#l7.73"></a><span id="l7.73"> </span>
<a href="#l7.74"></a><span id="l7.74">     if (img) {</span>
<a href="#l7.75"></a><span id="l7.75"> </span>
<a href="#l7.76"></a><span id="l7.76">         var imgURL = imgType == &quot;object&quot; ? img.data : img.src;</span>
<a href="#l7.77"></a><span id="l7.77">         setInfo(&quot;image-url&quot;, imgURL);</span>
<a href="#l7.78"></a><span id="l7.78"> </span>
<a href="#l7.79"></a><span id="l7.79" class="difflineminus">-        const LoadContextInfo = Components.classes[&quot;@mozilla.org/load-context-info-factory;1&quot;]</span>
<a href="#l7.80"></a><span id="l7.80" class="difflineplus">+        const LoadContextInfo = Components.classes[&quot;@mozilla.org/load-context-info-factory;1&quot;]</span>
<a href="#l7.81"></a><span id="l7.81">                                           .getService(Components.interfaces.nsILoadContextInfoFactory);</span>
<a href="#l7.82"></a><span id="l7.82">         var loadContextInfo = opener.gPrivate ? LoadContextInfo.private :</span>
<a href="#l7.83"></a><span id="l7.83">                                                 LoadContextInfo.default;</span>
<a href="#l7.84"></a><span id="l7.84">         Components.utils.import(&quot;resource://gre/modules/NetUtil.jsm&quot;);</span>
<a href="#l7.85"></a><span id="l7.85">         Components.classes[&quot;@mozilla.org/netwerk/cache-storage-service;1&quot;]</span>
<a href="#l7.86"></a><span id="l7.86">                   .getService(Components.interfaces.nsICacheStorageService)</span>
<a href="#l7.87"></a><span id="l7.87">                   .diskCacheStorage(loadContextInfo, false)</span>
<a href="#l7.88"></a><span id="l7.88">                   .asyncOpenURI(NetUtil.newURI(imgURL), null,</span>
<a href="#l7.89"></a><span id="l7.89" class="difflineat">@@ -180,24 +180,24 @@ function checkForImage(elem, htmllocalna</span>
<a href="#l7.90"></a><span id="l7.90"> </span>
<a href="#l7.91"></a><span id="l7.91">         if (&quot;width&quot; in img &amp;&amp; img.width != &quot;&quot;) {</span>
<a href="#l7.92"></a><span id="l7.92">             setInfo(&quot;image-width&quot;, gMetadataBundle.getFormattedString(&quot;imageWidth&quot;, [formatNumber(img.width)]));</span>
<a href="#l7.93"></a><span id="l7.93">             setInfo(&quot;image-height&quot;, gMetadataBundle.getFormattedString(&quot;imageHeight&quot;, [formatNumber(img.height)]));</span>
<a href="#l7.94"></a><span id="l7.94">         }</span>
<a href="#l7.95"></a><span id="l7.95">         else {</span>
<a href="#l7.96"></a><span id="l7.96">             setInfo(&quot;image-width&quot;, &quot;&quot;);</span>
<a href="#l7.97"></a><span id="l7.97">             setInfo(&quot;image-height&quot;, &quot;&quot;);</span>
<a href="#l7.98"></a><span id="l7.98" class="difflineminus">-        }        </span>
<a href="#l7.99"></a><span id="l7.99" class="difflineminus">-         </span>
<a href="#l7.100"></a><span id="l7.100" class="difflineplus">+        }</span>
<a href="#l7.101"></a><span id="l7.101" class="difflineplus">+</span>
<a href="#l7.102"></a><span id="l7.102">         if (imgType == &quot;img&quot;) {</span>
<a href="#l7.103"></a><span id="l7.103">             setInfo(&quot;image-desc&quot;, img.longDesc);</span>
<a href="#l7.104"></a><span id="l7.104">         } else {</span>
<a href="#l7.105"></a><span id="l7.105">             setInfo(&quot;image-desc&quot;, &quot;&quot;);</span>
<a href="#l7.106"></a><span id="l7.106">         }</span>
<a href="#l7.107"></a><span id="l7.107" class="difflineminus">-        </span>
<a href="#l7.108"></a><span id="l7.108" class="difflineplus">+</span>
<a href="#l7.109"></a><span id="l7.109">         onImage = true;</span>
<a href="#l7.110"></a><span id="l7.110">     }</span>
<a href="#l7.111"></a><span id="l7.111"> </span>
<a href="#l7.112"></a><span id="l7.112">     if (!ismap) {</span>
<a href="#l7.113"></a><span id="l7.113">        if (imgType == &quot;img&quot; || imgType == &quot;input&quot;) {</span>
<a href="#l7.114"></a><span id="l7.114">            setAlt(img);</span>
<a href="#l7.115"></a><span id="l7.115">        } else {</span>
<a href="#l7.116"></a><span id="l7.116">            hideNode(&quot;image-alt&quot;);</span>
<a href="#l7.117"></a><span id="l7.117" class="difflineat">@@ -235,17 +235,17 @@ function checkForLink(elem, htmllocalnam</span>
<a href="#l7.118"></a><span id="l7.118">                     setInfo(&quot;link-target&quot;, gMetadataBundle.getString(&quot;sameWindowText&quot;));</span>
<a href="#l7.119"></a><span id="l7.119">             } else {</span>
<a href="#l7.120"></a><span id="l7.120">                 hideNode(&quot;link-target&quot;);</span>
<a href="#l7.121"></a><span id="l7.121">             }</span>
<a href="#l7.122"></a><span id="l7.122">             break;</span>
<a href="#l7.123"></a><span id="l7.123">         default:</span>
<a href="#l7.124"></a><span id="l7.124">             setInfo(&quot;link-target&quot;, &quot;\&quot;&quot; + target + &quot;\&quot;&quot;);</span>
<a href="#l7.125"></a><span id="l7.125">         }</span>
<a href="#l7.126"></a><span id="l7.126" class="difflineminus">-        </span>
<a href="#l7.127"></a><span id="l7.127" class="difflineplus">+</span>
<a href="#l7.128"></a><span id="l7.128">         onLink = true;</span>
<a href="#l7.129"></a><span id="l7.129">     }</span>
<a href="#l7.130"></a><span id="l7.130">     else if (elem.namespaceURI == MathMLNS &amp;&amp; elem.hasAttribute(&quot;href&quot;)) {</span>
<a href="#l7.131"></a><span id="l7.131">         setLink(makeHrefAbsolute(elem.getAttribute(&quot;href&quot;), elem));</span>
<a href="#l7.132"></a><span id="l7.132"> </span>
<a href="#l7.133"></a><span id="l7.133">         setInfo(&quot;link-target&quot;, &quot;&quot;);</span>
<a href="#l7.134"></a><span id="l7.134"> </span>
<a href="#l7.135"></a><span id="l7.135">         onLink = true;</span>
<a href="#l7.136"></a><span id="l7.136" class="difflineat">@@ -267,38 +267,38 @@ function checkForLink(elem, htmllocalnam</span>
<a href="#l7.137"></a><span id="l7.137">                 setInfo(&quot;link-target&quot;, gMetadataBundle.getString(&quot;sameFrameText&quot;));</span>
<a href="#l7.138"></a><span id="l7.138">             else</span>
<a href="#l7.139"></a><span id="l7.139">                 setInfo(&quot;link-target&quot;, gMetadataBundle.getString(&quot;sameWindowText&quot;));</span>
<a href="#l7.140"></a><span id="l7.140">             break;</span>
<a href="#l7.141"></a><span id="l7.141">         default:</span>
<a href="#l7.142"></a><span id="l7.142">             setInfo(&quot;link-target&quot;, &quot;&quot;);</span>
<a href="#l7.143"></a><span id="l7.143">             break;</span>
<a href="#l7.144"></a><span id="l7.144">         }</span>
<a href="#l7.145"></a><span id="l7.145" class="difflineminus">-        </span>
<a href="#l7.146"></a><span id="l7.146" class="difflineplus">+</span>
<a href="#l7.147"></a><span id="l7.147">         onLink = true;</span>
<a href="#l7.148"></a><span id="l7.148">     }</span>
<a href="#l7.149"></a><span id="l7.149"> }</span>
<a href="#l7.150"></a><span id="l7.150"> </span>
<a href="#l7.151"></a><span id="l7.151"> function checkForInsDel(elem, htmllocalname)</span>
<a href="#l7.152"></a><span id="l7.152"> {</span>
<a href="#l7.153"></a><span id="l7.153">     if ((htmllocalname === &quot;ins&quot; || htmllocalname === &quot;del&quot;) &amp;&amp;</span>
<a href="#l7.154"></a><span id="l7.154">         (elem.cite || elem.dateTime)) {</span>
<a href="#l7.155"></a><span id="l7.155">         setInfo(&quot;insdel-cite&quot;, elem.cite);</span>
<a href="#l7.156"></a><span id="l7.156">         setInfo(&quot;insdel-date&quot;, elem.dateTime);</span>
<a href="#l7.157"></a><span id="l7.157">         onInsDel = true;</span>
<a href="#l7.158"></a><span id="l7.158" class="difflineminus">-    } </span>
<a href="#l7.159"></a><span id="l7.159" class="difflineplus">+    }</span>
<a href="#l7.160"></a><span id="l7.160"> }</span>
<a href="#l7.161"></a><span id="l7.161"> </span>
<a href="#l7.162"></a><span id="l7.162"> </span>
<a href="#l7.163"></a><span id="l7.163"> function checkForQuote(elem, htmllocalname)</span>
<a href="#l7.164"></a><span id="l7.164"> {</span>
<a href="#l7.165"></a><span id="l7.165">     if ((htmllocalname === &quot;q&quot; || htmllocalname === &quot;blockquote&quot;) &amp;&amp; elem.cite) {</span>
<a href="#l7.166"></a><span id="l7.166">         setInfo(&quot;quote-cite&quot;, elem.cite);</span>
<a href="#l7.167"></a><span id="l7.167">         onQuote = true;</span>
<a href="#l7.168"></a><span id="l7.168" class="difflineminus">-    } </span>
<a href="#l7.169"></a><span id="l7.169" class="difflineplus">+    }</span>
<a href="#l7.170"></a><span id="l7.170"> }</span>
<a href="#l7.171"></a><span id="l7.171"> </span>
<a href="#l7.172"></a><span id="l7.172"> function checkForTable(elem, htmllocalname)</span>
<a href="#l7.173"></a><span id="l7.173"> {</span>
<a href="#l7.174"></a><span id="l7.174">     if (htmllocalname === &quot;table&quot; &amp;&amp; elem.summary) {</span>
<a href="#l7.175"></a><span id="l7.175">         setInfo(&quot;misc-tblsummary&quot;, elem.summary);</span>
<a href="#l7.176"></a><span id="l7.176">         onTable = true;</span>
<a href="#l7.177"></a><span id="l7.177">     }</span>
<a href="#l7.178"></a><span id="l7.178" class="difflineat">@@ -307,28 +307,28 @@ function checkForTable(elem, htmllocalna</span>
<a href="#l7.179"></a><span id="l7.179"> function checkForLang(elem, htmllocalname)</span>
<a href="#l7.180"></a><span id="l7.180"> {</span>
<a href="#l7.181"></a><span id="l7.181">     if ((htmllocalname &amp;&amp; elem.lang) || elem.getAttributeNS(XMLNS, &quot;lang&quot;)) {</span>
<a href="#l7.182"></a><span id="l7.182">         var abbr;</span>
<a href="#l7.183"></a><span id="l7.183">         if (htmllocalname &amp;&amp; elem.lang)</span>
<a href="#l7.184"></a><span id="l7.184">             abbr = elem.lang;</span>
<a href="#l7.185"></a><span id="l7.185">         else</span>
<a href="#l7.186"></a><span id="l7.186">             abbr = elem.getAttributeNS(XMLNS, &quot;lang&quot;);</span>
<a href="#l7.187"></a><span id="l7.187" class="difflineminus">-            </span>
<a href="#l7.188"></a><span id="l7.188" class="difflineplus">+</span>
<a href="#l7.189"></a><span id="l7.189">         setInfo(&quot;misc-lang&quot;, convertLanguageCode(abbr));</span>
<a href="#l7.190"></a><span id="l7.190">         onLang = true;</span>
<a href="#l7.191"></a><span id="l7.191">     }</span>
<a href="#l7.192"></a><span id="l7.192"> }</span>
<a href="#l7.193"></a><span id="l7.193" class="difflineminus">-    </span>
<a href="#l7.194"></a><span id="l7.194" class="difflineplus">+</span>
<a href="#l7.195"></a><span id="l7.195"> function checkForTitle(elem, htmllocalname)</span>
<a href="#l7.196"></a><span id="l7.196"> {</span>
<a href="#l7.197"></a><span id="l7.197">     if (htmllocalname &amp;&amp; elem.title) {</span>
<a href="#l7.198"></a><span id="l7.198">         setInfo(&quot;misc-title&quot;, elem.title);</span>
<a href="#l7.199"></a><span id="l7.199">         onTitle = true;</span>
<a href="#l7.200"></a><span id="l7.200" class="difflineminus">-    }    </span>
<a href="#l7.201"></a><span id="l7.201" class="difflineplus">+    }</span>
<a href="#l7.202"></a><span id="l7.202"> }</span>
<a href="#l7.203"></a><span id="l7.203"> </span>
<a href="#l7.204"></a><span id="l7.204"> /*</span>
<a href="#l7.205"></a><span id="l7.205">  * Set five link properties at once.</span>
<a href="#l7.206"></a><span id="l7.206">  * All parameters are optional.</span>
<a href="#l7.207"></a><span id="l7.207">  */</span>
<a href="#l7.208"></a><span id="l7.208"> function setLink(url, lang, type, rel, rev)</span>
<a href="#l7.209"></a><span id="l7.209"> {</span>
<a href="#l7.210"></a><span id="l7.210" class="difflineat">@@ -463,27 +463,27 @@ function convertLanguageCode(abbr)</span>
<a href="#l7.211"></a><span id="l7.211">     else</span>
<a href="#l7.212"></a><span id="l7.212">     {</span>
<a href="#l7.213"></a><span id="l7.213">         // Otherwise we treat the first as a lang, the second as a region</span>
<a href="#l7.214"></a><span id="l7.214">         // and the rest as strings.</span>
<a href="#l7.215"></a><span id="l7.215">         try</span>
<a href="#l7.216"></a><span id="l7.216">         {</span>
<a href="#l7.217"></a><span id="l7.217">             language = gLangBundle.getString(language.toLowerCase());</span>
<a href="#l7.218"></a><span id="l7.218">         }</span>
<a href="#l7.219"></a><span id="l7.219" class="difflineminus">-        catch (e) </span>
<a href="#l7.220"></a><span id="l7.220" class="difflineplus">+        catch (e)</span>
<a href="#l7.221"></a><span id="l7.221">         {</span>
<a href="#l7.222"></a><span id="l7.222">         }</span>
<a href="#l7.223"></a><span id="l7.223"> </span>
<a href="#l7.224"></a><span id="l7.224">         if (tokens.length &gt; 0)</span>
<a href="#l7.225"></a><span id="l7.225">         {</span>
<a href="#l7.226"></a><span id="l7.226">             try</span>
<a href="#l7.227"></a><span id="l7.227">             {</span>
<a href="#l7.228"></a><span id="l7.228">                 tokens[0] = gRegionBundle.getString(tokens[0].toLowerCase());</span>
<a href="#l7.229"></a><span id="l7.229">             }</span>
<a href="#l7.230"></a><span id="l7.230" class="difflineminus">-            catch (e) </span>
<a href="#l7.231"></a><span id="l7.231" class="difflineplus">+            catch (e)</span>
<a href="#l7.232"></a><span id="l7.232">             {</span>
<a href="#l7.233"></a><span id="l7.233">             }</span>
<a href="#l7.234"></a><span id="l7.234">             region = tokens.join(&quot; &quot;);</span>
<a href="#l7.235"></a><span id="l7.235">         }</span>
<a href="#l7.236"></a><span id="l7.236">     }</span>
<a href="#l7.237"></a><span id="l7.237"> </span>
<a href="#l7.238"></a><span id="l7.238">     if (region) {</span>
<a href="#l7.239"></a><span id="l7.239">         result = gMetadataBundle.getFormattedString(&quot;languageRegionFormat&quot;,</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l8.1"></a><span id="l8.1" class="difflineminus">--- a/suite/browser/navigator.js</span>
<a href="#l8.2"></a><span id="l8.2" class="difflineplus">+++ b/suite/browser/navigator.js</span>
<a href="#l8.3"></a><span id="l8.3" class="difflineat">@@ -1604,17 +1604,17 @@ function BrowserCloseTabOrWindow()</span>
<a href="#l8.4"></a><span id="l8.4"> }</span>
<a href="#l8.5"></a><span id="l8.5"> </span>
<a href="#l8.6"></a><span id="l8.6"> function BrowserTryToCloseWindow()</span>
<a href="#l8.7"></a><span id="l8.7"> {</span>
<a href="#l8.8"></a><span id="l8.8">   if (WindowIsClosing())</span>
<a href="#l8.9"></a><span id="l8.9">     BrowserCloseWindow();</span>
<a href="#l8.10"></a><span id="l8.10"> }</span>
<a href="#l8.11"></a><span id="l8.11"> </span>
<a href="#l8.12"></a><span id="l8.12" class="difflineminus">-function BrowserCloseWindow() </span>
<a href="#l8.13"></a><span id="l8.13" class="difflineplus">+function BrowserCloseWindow()</span>
<a href="#l8.14"></a><span id="l8.14"> {</span>
<a href="#l8.15"></a><span id="l8.15">   // This code replicates stuff in Shutdown().  It is here because</span>
<a href="#l8.16"></a><span id="l8.16">   // window.screenX and window.screenY have real values.  We need</span>
<a href="#l8.17"></a><span id="l8.17">   // to fix this eventually but by replicating the code here, we</span>
<a href="#l8.18"></a><span id="l8.18">   // provide a means of saving position (it just requires that the</span>
<a href="#l8.19"></a><span id="l8.19">   // user close the window via File-&gt;Close (vs. close box).</span>
<a href="#l8.20"></a><span id="l8.20"> </span>
<a href="#l8.21"></a><span id="l8.21">   // Get the current window position/size.</span>
<a href="#l8.22"></a><span id="l8.22" class="difflineat">@@ -2618,17 +2618,17 @@ function convertFromUnicode(charset, str</span>
<a href="#l8.23"></a><span id="l8.23">   try {</span>
<a href="#l8.24"></a><span id="l8.24">     var unicodeConverter = Components</span>
<a href="#l8.25"></a><span id="l8.25">        .classes[&quot;@mozilla.org/intl/scriptableunicodeconverter&quot;]</span>
<a href="#l8.26"></a><span id="l8.26">        .createInstance(Components.interfaces.nsIScriptableUnicodeConverter);</span>
<a href="#l8.27"></a><span id="l8.27">     unicodeConverter.charset = charset;</span>
<a href="#l8.28"></a><span id="l8.28">     str = unicodeConverter.ConvertFromUnicode(str);</span>
<a href="#l8.29"></a><span id="l8.29">     return str + unicodeConverter.Finish();</span>
<a href="#l8.30"></a><span id="l8.30">   } catch(ex) {</span>
<a href="#l8.31"></a><span id="l8.31" class="difflineminus">-    return null; </span>
<a href="#l8.32"></a><span id="l8.32" class="difflineplus">+    return null;</span>
<a href="#l8.33"></a><span id="l8.33">   }</span>
<a href="#l8.34"></a><span id="l8.34"> }</span>
<a href="#l8.35"></a><span id="l8.35"> </span>
<a href="#l8.36"></a><span id="l8.36"> function getNotificationBox(aWindow)</span>
<a href="#l8.37"></a><span id="l8.37"> {</span>
<a href="#l8.38"></a><span id="l8.38">   return aWindow.QueryInterface(Components.interfaces.nsIInterfaceRequestor)</span>
<a href="#l8.39"></a><span id="l8.39">                 .getInterface(Components.interfaces.nsIWebNavigation)</span>
<a href="#l8.40"></a><span id="l8.40">                 .QueryInterface(Components.interfaces.nsIDocShell)</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l9.1"></a><span id="l9.1" class="difflineminus">--- a/suite/browser/navigatorDD.js</span>
<a href="#l9.2"></a><span id="l9.2" class="difflineplus">+++ b/suite/browser/navigatorDD.js</span>
<a href="#l9.3"></a><span id="l9.3" class="difflineat">@@ -49,17 +49,17 @@ function htmlEscape(aString)</span>
<a href="#l9.4"></a><span id="l9.4">                 .replace(/'/g, &quot;&amp;apos;&quot;);</span>
<a href="#l9.5"></a><span id="l9.5"> }</span>
<a href="#l9.6"></a><span id="l9.6"> </span>
<a href="#l9.7"></a><span id="l9.7"> function BeginDragLink(aEvent, aHref, aTitle)</span>
<a href="#l9.8"></a><span id="l9.8"> {</span>
<a href="#l9.9"></a><span id="l9.9">   var dt = aEvent.dataTransfer;</span>
<a href="#l9.10"></a><span id="l9.10">   dt.setData(&quot;text/x-moz-url&quot;, aHref + &quot;\n&quot; + aTitle);</span>
<a href="#l9.11"></a><span id="l9.11">   dt.setData(&quot;text/uri-list&quot;, aHref);</span>
<a href="#l9.12"></a><span id="l9.12" class="difflineminus">-  dt.setData(&quot;text/html&quot;, &quot;&lt;a href=\&quot;&quot; + htmlEscape(aHref) + </span>
<a href="#l9.13"></a><span id="l9.13" class="difflineplus">+  dt.setData(&quot;text/html&quot;, &quot;&lt;a href=\&quot;&quot; + htmlEscape(aHref) +</span>
<a href="#l9.14"></a><span id="l9.14">                           &quot;\&quot;&gt;&quot; + htmlEscape(aTitle) + &quot;&lt;/a&gt;&quot;);</span>
<a href="#l9.15"></a><span id="l9.15">   dt.setData(&quot;text/plain&quot;, aHref);</span>
<a href="#l9.16"></a><span id="l9.16"> }</span>
<a href="#l9.17"></a><span id="l9.17"> </span>
<a href="#l9.18"></a><span id="l9.18"> function DragLinkOver(aEvent)</span>
<a href="#l9.19"></a><span id="l9.19"> {</span>
<a href="#l9.20"></a><span id="l9.20">   if (Services.droppedLinkHandler.canDropLink(aEvent, true))</span>
<a href="#l9.21"></a><span id="l9.21">     aEvent.preventDefault();</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l10.1"></a><span id="l10.1" class="difflineminus">--- a/suite/browser/nsBrowserContentHandler.js</span>
<a href="#l10.2"></a><span id="l10.2" class="difflineplus">+++ b/suite/browser/nsBrowserContentHandler.js</span>
<a href="#l10.3"></a><span id="l10.3" class="difflineat">@@ -55,17 +55,17 @@ function resolveURIInternal(aCmdLine, aA</span>
<a href="#l10.4"></a><span id="l10.4">                                 .getService(nsIIOService);</span>
<a href="#l10.5"></a><span id="l10.5">       return ioService.newFileURI(file);</span>
<a href="#l10.6"></a><span id="l10.6">     }</span>
<a href="#l10.7"></a><span id="l10.7">   } catch (e) {</span>
<a href="#l10.8"></a><span id="l10.8">   }</span>
<a href="#l10.9"></a><span id="l10.9"> </span>
<a href="#l10.10"></a><span id="l10.10">   // We have interpreted the argument as a relative file URI, but the file</span>
<a href="#l10.11"></a><span id="l10.11">   // doesn't exist. Try URI fixup heuristics: see bug 290782.</span>
<a href="#l10.12"></a><span id="l10.12" class="difflineminus">- </span>
<a href="#l10.13"></a><span id="l10.13" class="difflineplus">+</span>
<a href="#l10.14"></a><span id="l10.14">   try {</span>
<a href="#l10.15"></a><span id="l10.15">     var urifixup = Components.classes[&quot;@mozilla.org/docshell/urifixup;1&quot;]</span>
<a href="#l10.16"></a><span id="l10.16">                              .getService(nsIURIFixup);</span>
<a href="#l10.17"></a><span id="l10.17"> </span>
<a href="#l10.18"></a><span id="l10.18">     return urifixup.createFixupURI(aArgument,</span>
<a href="#l10.19"></a><span id="l10.19">                                    nsIURIFixup.FIXUP_FLAG_ALLOW_KEYWORD_LOOKUP);</span>
<a href="#l10.20"></a><span id="l10.20">   } catch (e) {</span>
<a href="#l10.21"></a><span id="l10.21">     Components.utils.reportError(e);</span>
<a href="#l10.22"></a><span id="l10.22" class="difflineat">@@ -151,17 +151,17 @@ function getURLToLoad()</span>
<a href="#l10.23"></a><span id="l10.23">     case 1:</span>
<a href="#l10.24"></a><span id="l10.24">       return getHomePageGroup();</span>
<a href="#l10.25"></a><span id="l10.25"> </span>
<a href="#l10.26"></a><span id="l10.26">     case 2:</span>
<a href="#l10.27"></a><span id="l10.27">       return Services.prefs.getComplexValue(&quot;browser.history.last_page_visited&quot;,</span>
<a href="#l10.28"></a><span id="l10.28">                                             nsISupportsString).data;</span>
<a href="#l10.29"></a><span id="l10.29">     }</span>
<a href="#l10.30"></a><span id="l10.30">   } catch (e) {</span>
<a href="#l10.31"></a><span id="l10.31" class="difflineminus">-  } </span>
<a href="#l10.32"></a><span id="l10.32" class="difflineplus">+  }</span>
<a href="#l10.33"></a><span id="l10.33"> </span>
<a href="#l10.34"></a><span id="l10.34">   return &quot;about:blank&quot;;</span>
<a href="#l10.35"></a><span id="l10.35"> }</span>
<a href="#l10.36"></a><span id="l10.36"> </span>
<a href="#l10.37"></a><span id="l10.37"> function openWindow(parent, url, features, arg)</span>
<a href="#l10.38"></a><span id="l10.38"> {</span>
<a href="#l10.39"></a><span id="l10.39">   var wwatch = Components.classes[&quot;@mozilla.org/embedcomp/window-watcher;1&quot;]</span>
<a href="#l10.40"></a><span id="l10.40">                          .getService(nsIWindowWatcher);</span>
<a href="#l10.41"></a><span id="l10.41" class="difflineat">@@ -210,21 +210,21 @@ function handURIToExistingBrowser(uri, l</span>
<a href="#l10.42"></a><span id="l10.42">     openWindow(null, getBrowserURL(), features, uri.spec);</span>
<a href="#l10.43"></a><span id="l10.43"> }</span>
<a href="#l10.44"></a><span id="l10.44"> </span>
<a href="#l10.45"></a><span id="l10.45"> function doSearch(aSearchTerm, aFeatures) {</span>
<a href="#l10.46"></a><span id="l10.46">   var ss = Components.classes[&quot;@mozilla.org/browser/search-service;1&quot;]</span>
<a href="#l10.47"></a><span id="l10.47">                      .getService(nsIBrowserSearchService);</span>
<a href="#l10.48"></a><span id="l10.48"> </span>
<a href="#l10.49"></a><span id="l10.49">   var submission = ss.defaultEngine.getSubmission(aSearchTerm);</span>
<a href="#l10.50"></a><span id="l10.50" class="difflineminus">-  </span>
<a href="#l10.51"></a><span id="l10.51" class="difflineplus">+</span>
<a href="#l10.52"></a><span id="l10.52">   // fill our nsIMutableArray with uri-as-wstring, null, null, postData</span>
<a href="#l10.53"></a><span id="l10.53">   var sa = Components.classes[&quot;@mozilla.org/array;1&quot;]</span>
<a href="#l10.54"></a><span id="l10.54">                      .createInstance(Components.interfaces.nsIMutableArray);</span>
<a href="#l10.55"></a><span id="l10.55" class="difflineminus">-  </span>
<a href="#l10.56"></a><span id="l10.56" class="difflineplus">+</span>
<a href="#l10.57"></a><span id="l10.57">   var uristring = Components.classes[&quot;@mozilla.org/supports-string;1&quot;]</span>
<a href="#l10.58"></a><span id="l10.58">                             .createInstance(nsISupportsString);</span>
<a href="#l10.59"></a><span id="l10.59">   uristring.data = submission.uri.spec;</span>
<a href="#l10.60"></a><span id="l10.60"> </span>
<a href="#l10.61"></a><span id="l10.61">   sa.appendElement(uristring, false);</span>
<a href="#l10.62"></a><span id="l10.62">   sa.appendElement(null, false);</span>
<a href="#l10.63"></a><span id="l10.63">   sa.appendElement(null, false);</span>
<a href="#l10.64"></a><span id="l10.64">   sa.appendElement(submission.postData, false);</span>
<a href="#l10.65"></a><span id="l10.65" class="difflineat">@@ -298,17 +298,17 @@ var nsBrowserContentHandler = {</span>
<a href="#l10.66"></a><span id="l10.66">           openWindow(null, &quot;chrome://messenger/content/messengercompose/messengercompose.xul&quot;, features, RegExp.$2);</span>
<a href="#l10.67"></a><span id="l10.67">           break;</span>
<a href="#l10.68"></a><span id="l10.68"> </span>
<a href="#l10.69"></a><span id="l10.69">         case &quot;xfedocommand&quot;:</span>
<a href="#l10.70"></a><span id="l10.70">           switch (RegExp.$2.toLowerCase()) {</span>
<a href="#l10.71"></a><span id="l10.71">           case &quot;openbrowser&quot;:</span>
<a href="#l10.72"></a><span id="l10.72">             openWindow(null, getBrowserURL(), features, RegExp.$3 || getURLToLoad());</span>
<a href="#l10.73"></a><span id="l10.73">             break;</span>
<a href="#l10.74"></a><span id="l10.74" class="difflineminus">-          </span>
<a href="#l10.75"></a><span id="l10.75" class="difflineplus">+</span>
<a href="#l10.76"></a><span id="l10.76">           case &quot;openinbox&quot;:</span>
<a href="#l10.77"></a><span id="l10.77">             openWindow(null, &quot;chrome://messenger/content&quot;, features);</span>
<a href="#l10.78"></a><span id="l10.78">             break;</span>
<a href="#l10.79"></a><span id="l10.79"> </span>
<a href="#l10.80"></a><span id="l10.80">           case &quot;composemessage&quot;:</span>
<a href="#l10.81"></a><span id="l10.81">             openWindow(null, &quot;chrome://messenger/content/messengercompose/messengercompose.xul&quot;, features, RegExp.$3);</span>
<a href="#l10.82"></a><span id="l10.82">             break;</span>
<a href="#l10.83"></a><span id="l10.83"> </span>
<a href="#l10.84"></a><span id="l10.84" class="difflineat">@@ -382,17 +382,17 @@ var nsBrowserContentHandler = {</span>
<a href="#l10.85"></a><span id="l10.85">         } else {</span>
<a href="#l10.86"></a><span id="l10.86">           if (cmdLine.handleFlag(&quot;requestpending&quot;, false) &amp;&amp;</span>
<a href="#l10.87"></a><span id="l10.87">               cmdLine.state == nsICommandLine.STATE_INITIAL_LAUNCH) {</span>
<a href="#l10.88"></a><span id="l10.88">             // A DDE request with the URL will follow and the DDE handling code</span>
<a href="#l10.89"></a><span id="l10.89">             // will send it to the commandline handler via</span>
<a href="#l10.90"></a><span id="l10.90">             // &quot;mozilla -url http://www.foo.com&quot;. Store the URL so we can</span>
<a href="#l10.91"></a><span id="l10.91">             // ignore this request later</span>
<a href="#l10.92"></a><span id="l10.92">             this._handledURI = urlParam;</span>
<a href="#l10.93"></a><span id="l10.93" class="difflineminus">-          } </span>
<a href="#l10.94"></a><span id="l10.94" class="difflineplus">+          }</span>
<a href="#l10.95"></a><span id="l10.95"> </span>
<a href="#l10.96"></a><span id="l10.96">           urlParam = resolveURIInternal(cmdLine, urlParam);</span>
<a href="#l10.97"></a><span id="l10.97">           handURIToExistingBrowser(urlParam,</span>
<a href="#l10.98"></a><span id="l10.98">                                    nsIBrowserDOMWindow.OPEN_DEFAULTWINDOW,</span>
<a href="#l10.99"></a><span id="l10.99">                                    features);</span>
<a href="#l10.100"></a><span id="l10.100">         }</span>
<a href="#l10.101"></a><span id="l10.101">         cmdLine.preventDefault = true;</span>
<a href="#l10.102"></a><span id="l10.102">       }</span>
<a href="#l10.103"></a><span id="l10.103" class="difflineat">@@ -427,17 +427,17 @@ var nsBrowserContentHandler = {</span>
<a href="#l10.104"></a><span id="l10.104">                                 .getService(nsINetUtil);</span>
<a href="#l10.105"></a><span id="l10.105">         if (!netutil.URIChainHasFlags(uri, URI_INHERITS_SECURITY_CONTEXT)) {</span>
<a href="#l10.106"></a><span id="l10.106">           openWindow(null, uri.spec, features);</span>
<a href="#l10.107"></a><span id="l10.107">           cmdLine.preventDefault = true;</span>
<a href="#l10.108"></a><span id="l10.108">         }</span>
<a href="#l10.109"></a><span id="l10.109">       }</span>
<a href="#l10.110"></a><span id="l10.110">     } catch (e) {</span>
<a href="#l10.111"></a><span id="l10.111">     }</span>
<a href="#l10.112"></a><span id="l10.112" class="difflineminus">- </span>
<a href="#l10.113"></a><span id="l10.113" class="difflineplus">+</span>
<a href="#l10.114"></a><span id="l10.114">     try {</span>
<a href="#l10.115"></a><span id="l10.115">       var fileParam = cmdLine.handleFlagWithParam(&quot;file&quot;, false);</span>
<a href="#l10.116"></a><span id="l10.116">       if (fileParam) {</span>
<a href="#l10.117"></a><span id="l10.117">        fileParam = resolveURIInternal(cmdLine, fileParam);</span>
<a href="#l10.118"></a><span id="l10.118">        handURIToExistingBrowser(fileParam, nsIBrowserDOMWindow.OPEN_DEFAULTWINDOW, features);</span>
<a href="#l10.119"></a><span id="l10.119">        cmdLine.preventDefault = true;</span>
<a href="#l10.120"></a><span id="l10.120">       }</span>
<a href="#l10.121"></a><span id="l10.121">     } catch (e) {</span>
<a href="#l10.122"></a><span id="l10.122" class="difflineat">@@ -626,17 +626,17 @@ var nsBrowserContentHandler = {</span>
<a href="#l10.123"></a><span id="l10.123"> </span>
<a href="#l10.124"></a><span id="l10.124">   /* nsIFactory */</span>
<a href="#l10.125"></a><span id="l10.125">   createInstance: function createInstance(outer, iid) {</span>
<a href="#l10.126"></a><span id="l10.126">     if (outer != null)</span>
<a href="#l10.127"></a><span id="l10.127">       throw Components.results.NS_ERROR_NO_AGGREGATION;</span>
<a href="#l10.128"></a><span id="l10.128"> </span>
<a href="#l10.129"></a><span id="l10.129">     return this.QueryInterface(iid);</span>
<a href="#l10.130"></a><span id="l10.130">   },</span>
<a href="#l10.131"></a><span id="l10.131" class="difflineminus">-    </span>
<a href="#l10.132"></a><span id="l10.132" class="difflineplus">+</span>
<a href="#l10.133"></a><span id="l10.133">   lockFactory: function lockFactory(lock) {</span>
<a href="#l10.134"></a><span id="l10.134">     /* no-op */</span>
<a href="#l10.135"></a><span id="l10.135">   }</span>
<a href="#l10.136"></a><span id="l10.136"> };</span>
<a href="#l10.137"></a><span id="l10.137"> </span>
<a href="#l10.138"></a><span id="l10.138"> const BROWSER_CID = Components.ID(&quot;{c2343730-dc2c-11d3-98b3-001083010e9b}&quot;);</span>
<a href="#l10.139"></a><span id="l10.139"> </span>
<a href="#l10.140"></a><span id="l10.140"> function NSGetFactory(cid) {</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l11.1"></a><span id="l11.1" class="difflineminus">--- a/suite/browser/nsBrowserContentListener.js</span>
<a href="#l11.2"></a><span id="l11.2" class="difflineplus">+++ b/suite/browser/nsBrowserContentListener.js</span>
<a href="#l11.3"></a><span id="l11.3" class="difflineat">@@ -106,17 +106,17 @@ nsBrowserContentListener.prototype =</span>
<a href="#l11.4"></a><span id="l11.4">     },</span>
<a href="#l11.5"></a><span id="l11.5"> </span>
<a href="#l11.6"></a><span id="l11.6">     isPreferred: function(contentType, desiredContentType)</span>
<a href="#l11.7"></a><span id="l11.7">     {</span>
<a href="#l11.8"></a><span id="l11.8">         if (Services.prefs.getIntPref(&quot;browser.link.open_external&quot;) == nsIBrowserDOMWindow.OPEN_NEWWINDOW)</span>
<a href="#l11.9"></a><span id="l11.9">             return false;</span>
<a href="#l11.10"></a><span id="l11.10"> </span>
<a href="#l11.11"></a><span id="l11.11">         try {</span>
<a href="#l11.12"></a><span id="l11.12" class="difflineminus">-            var webNavInfo = </span>
<a href="#l11.13"></a><span id="l11.13" class="difflineplus">+            var webNavInfo =</span>
<a href="#l11.14"></a><span id="l11.14">               Components.classes[&quot;@mozilla.org/webnavigation-info;1&quot;]</span>
<a href="#l11.15"></a><span id="l11.15">                         .getService(Components.interfaces.nsIWebNavigationInfo);</span>
<a href="#l11.16"></a><span id="l11.16">             return webNavInfo.isTypeSupported(contentType, null);</span>
<a href="#l11.17"></a><span id="l11.17">         } catch (e) {</span>
<a href="#l11.18"></a><span id="l11.18">             // XXX propagate failures other than &quot;NS_ERROR_NOT_AVAILABLE&quot;?</span>
<a href="#l11.19"></a><span id="l11.19">             // This seems to never get called, so not like it matters....</span>
<a href="#l11.20"></a><span id="l11.20">             return false;</span>
<a href="#l11.21"></a><span id="l11.21">         }</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l12.1"></a><span id="l12.1" class="difflineminus">--- a/suite/browser/nsBrowserStatusHandler.js</span>
<a href="#l12.2"></a><span id="l12.2" class="difflineplus">+++ b/suite/browser/nsBrowserStatusHandler.js</span>
<a href="#l12.3"></a><span id="l12.3" class="difflineat">@@ -177,17 +177,17 @@ nsBrowserStatusHandler.prototype =</span>
<a href="#l12.4"></a><span id="l12.4">       // you are intimately familiar with the cost of setting</span>
<a href="#l12.5"></a><span id="l12.5">       // attrs on XUL elements. -- hyatt</span>
<a href="#l12.6"></a><span id="l12.6">       var percentage = (aCurTotalProgress * 100) / aMaxTotalProgress;</span>
<a href="#l12.7"></a><span id="l12.7">       this.statusMeter.value = percentage;</span>
<a href="#l12.8"></a><span id="l12.8">     }</span>
<a href="#l12.9"></a><span id="l12.9">   },</span>
<a href="#l12.10"></a><span id="l12.10"> </span>
<a href="#l12.11"></a><span id="l12.11">   onStateChange : function(aWebProgress, aRequest, aStateFlags, aStatus)</span>
<a href="#l12.12"></a><span id="l12.12" class="difflineminus">-  {  </span>
<a href="#l12.13"></a><span id="l12.13" class="difflineplus">+  {</span>
<a href="#l12.14"></a><span id="l12.14">     const nsIWebProgressListener = Components.interfaces.nsIWebProgressListener;</span>
<a href="#l12.15"></a><span id="l12.15">     const nsIChannel = Components.interfaces.nsIChannel;</span>
<a href="#l12.16"></a><span id="l12.16">     var ctype;</span>
<a href="#l12.17"></a><span id="l12.17">     if (aStateFlags &amp; nsIWebProgressListener.STATE_START) {</span>
<a href="#l12.18"></a><span id="l12.18">       // This (thanks to the filter) is a network start or the first</span>
<a href="#l12.19"></a><span id="l12.19">       // stray request (the first request outside of the document load),</span>
<a href="#l12.20"></a><span id="l12.20">       // initialize the throbber and his friends.</span>
<a href="#l12.21"></a><span id="l12.21"> </span>
<a href="#l12.22"></a><span id="l12.22" class="difflineat">@@ -237,17 +237,17 @@ nsBrowserStatusHandler.prototype =</span>
<a href="#l12.23"></a><span id="l12.23">         }</span>
<a href="#l12.24"></a><span id="l12.24">         // If msg is false then we did not have an error (channel may have</span>
<a href="#l12.25"></a><span id="l12.25">         // been null, in the case of a stray image load).</span>
<a href="#l12.26"></a><span id="l12.26">         if (!msg) {</span>
<a href="#l12.27"></a><span id="l12.27">           msg = gNavigatorBundle.getString(&quot;nv_done&quot;);</span>
<a href="#l12.28"></a><span id="l12.28">         }</span>
<a href="#l12.29"></a><span id="l12.29">         this.status = &quot;&quot;;</span>
<a href="#l12.30"></a><span id="l12.30">         this.setDefaultStatus(msg);</span>
<a href="#l12.31"></a><span id="l12.31" class="difflineminus">-        </span>
<a href="#l12.32"></a><span id="l12.32" class="difflineplus">+</span>
<a href="#l12.33"></a><span id="l12.33">         // Disable menu entries for images, enable otherwise</span>
<a href="#l12.34"></a><span id="l12.34">         if (content.document &amp;&amp; this.mimeTypeIsTextBased(content.document.contentType))</span>
<a href="#l12.35"></a><span id="l12.35">           this.isImage.removeAttribute('disabled');</span>
<a href="#l12.36"></a><span id="l12.36">         else</span>
<a href="#l12.37"></a><span id="l12.37">           this.isImage.setAttribute('disabled', 'true');</span>
<a href="#l12.38"></a><span id="l12.38">       }</span>
<a href="#l12.39"></a><span id="l12.39"> </span>
<a href="#l12.40"></a><span id="l12.40">       // Turn the progress meter and throbber off.</span>
<a href="#l12.41"></a><span id="l12.41" class="difflineat">@@ -451,17 +451,17 @@ nsBrowserStatusHandler.prototype =</span>
<a href="#l12.42"></a><span id="l12.42">     else {</span>
<a href="#l12.43"></a><span id="l12.43">       // per QA request</span>
<a href="#l12.44"></a><span id="l12.44">       var e = new Components.Exception(&quot;&quot;, aStatus);</span>
<a href="#l12.45"></a><span id="l12.45">       var name = e.name;</span>
<a href="#l12.46"></a><span id="l12.46">       dump(&quot;Error loading URL &quot;+urlStr+&quot; : &quot;+</span>
<a href="#l12.47"></a><span id="l12.47">            Number(aStatus).toString(16));</span>
<a href="#l12.48"></a><span id="l12.48">       if (name)</span>
<a href="#l12.49"></a><span id="l12.49">            dump(&quot; (&quot;+name+&quot;)&quot;);</span>
<a href="#l12.50"></a><span id="l12.50" class="difflineminus">-      dump('\n'); </span>
<a href="#l12.51"></a><span id="l12.51" class="difflineplus">+      dump('\n');</span>
<a href="#l12.52"></a><span id="l12.52">     }</span>
<a href="#l12.53"></a><span id="l12.53"> </span>
<a href="#l12.54"></a><span id="l12.54">     var notification = Components.isSuccessCode(aStatus) ? &quot;EndDocumentLoad&quot; : &quot;FailDocumentLoad&quot;;</span>
<a href="#l12.55"></a><span id="l12.55">     try {</span>
<a href="#l12.56"></a><span id="l12.56">       Services.obs.notifyObservers(content, notification, urlStr);</span>
<a href="#l12.57"></a><span id="l12.57">     } catch (e) {</span>
<a href="#l12.58"></a><span id="l12.58">     }</span>
<a href="#l12.59"></a><span id="l12.59">   }</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l13.1"></a><span id="l13.1" class="difflineminus">--- a/suite/browser/pageinfo/pageInfo.js</span>
<a href="#l13.2"></a><span id="l13.2" class="difflineplus">+++ b/suite/browser/pageinfo/pageInfo.js</span>
<a href="#l13.3"></a><span id="l13.3" class="difflineat">@@ -219,18 +219,18 @@ const DRAGSERVICE_CONTRACTID    = &quot;@mozi</span>
<a href="#l13.4"></a><span id="l13.4"> const TRANSFERABLE_CONTRACTID   = &quot;@mozilla.org/widget/transferable;1&quot;;</span>
<a href="#l13.5"></a><span id="l13.5"> const ARRAY_CONTRACTID          = &quot;@mozilla.org/supports-array;1&quot;;</span>
<a href="#l13.6"></a><span id="l13.6"> const STRING_CONTRACTID         = &quot;@mozilla.org/supports-string;1&quot;;</span>
<a href="#l13.7"></a><span id="l13.7"> </span>
<a href="#l13.8"></a><span id="l13.8"> // a number of services I'll need later</span>
<a href="#l13.9"></a><span id="l13.9"> // the cache services</span>
<a href="#l13.10"></a><span id="l13.10"> const OPEN_READONLY = Components.interfaces.nsICacheStorage.OPEN_READONLY;</span>
<a href="#l13.11"></a><span id="l13.11"> const ENTRY_WANTED = Components.interfaces.nsICacheEntryOpenCallback.ENTRY_WANTED;</span>
<a href="#l13.12"></a><span id="l13.12" class="difflineminus">-const LoadContextInfo = Components.classes[&quot;@mozilla.org/load-context-info-factory;1&quot;]</span>
<a href="#l13.13"></a><span id="l13.13" class="difflineminus">-                                  .getService(Components.interfaces.nsILoadContextInfoFactory);</span>
<a href="#l13.14"></a><span id="l13.14" class="difflineplus">+const LoadContextInfo = Components.classes[&quot;@mozilla.org/load-context-info-factory;1&quot;]</span>
<a href="#l13.15"></a><span id="l13.15" class="difflineplus">+                                  .getService(Components.interfaces.nsILoadContextInfoFactory);</span>
<a href="#l13.16"></a><span id="l13.16"> var loadContextInfo = opener.gPrivate ? LoadContextInfo.private :</span>
<a href="#l13.17"></a><span id="l13.17">                                         LoadContextInfo.default;</span>
<a href="#l13.18"></a><span id="l13.18"> const diskCacheStorage =</span>
<a href="#l13.19"></a><span id="l13.19">     Components.classes[&quot;@mozilla.org/netwerk/cache-storage-service;1&quot;]</span>
<a href="#l13.20"></a><span id="l13.20">               .getService(Components.interfaces.nsICacheStorageService)</span>
<a href="#l13.21"></a><span id="l13.21">               .diskCacheStorage(loadContextInfo, false);</span>
<a href="#l13.22"></a><span id="l13.22"> </span>
<a href="#l13.23"></a><span id="l13.23"> const nsICertificateDialogs = Components.interfaces.nsICertificateDialogs;</span>
<a href="#l13.24"></a><span id="l13.24" class="difflineat">@@ -747,17 +747,17 @@ function onFormSelect()</span>
<a href="#l13.25"></a><span id="l13.25">     setItemValue(&quot;formtarget&quot;, form.target, gBundle.getString(&quot;formDefaultTarget&quot;));</span>
<a href="#l13.26"></a><span id="l13.26">     document.getElementById(&quot;formname&quot;).value = ft || gBundle.getString(&quot;formUntitled&quot;);</span>
<a href="#l13.27"></a><span id="l13.27"> </span>
<a href="#l13.28"></a><span id="l13.28">     var formfields = form.elements;</span>
<a href="#l13.29"></a><span id="l13.29"> </span>
<a href="#l13.30"></a><span id="l13.30">     var length = formfields.length;</span>
<a href="#l13.31"></a><span id="l13.31"> </span>
<a href="#l13.32"></a><span id="l13.32">     var checked = gBundle.getString(&quot;formChecked&quot;);</span>
<a href="#l13.33"></a><span id="l13.33" class="difflineminus">-    var unchecked = gBundle.getString(&quot;formUnchecked&quot;);    </span>
<a href="#l13.34"></a><span id="l13.34" class="difflineplus">+    var unchecked = gBundle.getString(&quot;formUnchecked&quot;);</span>
<a href="#l13.35"></a><span id="l13.35"> </span>
<a href="#l13.36"></a><span id="l13.36">     for (var i = 0; i &lt; length; i++)</span>
<a href="#l13.37"></a><span id="l13.37">     {</span>
<a href="#l13.38"></a><span id="l13.38">       var elem = formfields[i], val;</span>
<a href="#l13.39"></a><span id="l13.39"> </span>
<a href="#l13.40"></a><span id="l13.40">       if (elem instanceof HTMLButtonElement)</span>
<a href="#l13.41"></a><span id="l13.41">         val = getValueText(elem);</span>
<a href="#l13.42"></a><span id="l13.42">       else</span>
<a href="#l13.43"></a><span id="l13.43" class="difflineat">@@ -772,30 +772,30 @@ function onFormSelect()</span>
<a href="#l13.44"></a><span id="l13.44"> </span>
<a href="#l13.45"></a><span id="l13.45">     for (i = 0; i &lt; llength; i++)</span>
<a href="#l13.46"></a><span id="l13.46">     {</span>
<a href="#l13.47"></a><span id="l13.47">       label = labels[i];</span>
<a href="#l13.48"></a><span id="l13.48">       var whatfor = label.hasAttribute(&quot;for&quot;) ?</span>
<a href="#l13.49"></a><span id="l13.49">         gDocument.getElementById(label.getAttribute(&quot;for&quot;)) :</span>
<a href="#l13.50"></a><span id="l13.50">         findFirstControl(label);</span>
<a href="#l13.51"></a><span id="l13.51"> </span>
<a href="#l13.52"></a><span id="l13.52" class="difflineminus">-      if (whatfor &amp;&amp; (whatfor.form == form)) </span>
<a href="#l13.53"></a><span id="l13.53" class="difflineplus">+      if (whatfor &amp;&amp; (whatfor.form == form))</span>
<a href="#l13.54"></a><span id="l13.54">       {</span>
<a href="#l13.55"></a><span id="l13.55">         var labeltext = getValueText(label);</span>
<a href="#l13.56"></a><span id="l13.56">         for (var j = 0; j &lt; length; j++)</span>
<a href="#l13.57"></a><span id="l13.57">           if (formfields[j] == whatfor) {</span>
<a href="#l13.58"></a><span id="l13.58">             var col = formPreview.columns[&quot;field-label&quot;];</span>
<a href="#l13.59"></a><span id="l13.59">             gFieldView.setCellText(j, col, labeltext);</span>
<a href="#l13.60"></a><span id="l13.60">           }</span>
<a href="#l13.61"></a><span id="l13.61">       }</span>
<a href="#l13.62"></a><span id="l13.62">     }</span>
<a href="#l13.63"></a><span id="l13.63">   }</span>
<a href="#l13.64"></a><span id="l13.64"> }</span>
<a href="#l13.65"></a><span id="l13.65"> </span>
<a href="#l13.66"></a><span id="l13.66" class="difflineminus">-function FormControlFilter(node) </span>
<a href="#l13.67"></a><span id="l13.67" class="difflineplus">+function FormControlFilter(node)</span>
<a href="#l13.68"></a><span id="l13.68"> {</span>
<a href="#l13.69"></a><span id="l13.69">   if (node instanceof HTMLInputElement || node instanceof HTMLSelectElement ||</span>
<a href="#l13.70"></a><span id="l13.70">       node instanceof HTMLButtonElement || node instanceof HTMLTextAreaElement ||</span>
<a href="#l13.71"></a><span id="l13.71">       node instanceof HTMLObjectElement)</span>
<a href="#l13.72"></a><span id="l13.72">       return NodeFilter.FILTER_ACCEPT;</span>
<a href="#l13.73"></a><span id="l13.73">     return NodeFilter.FILTER_SKIP;</span>
<a href="#l13.74"></a><span id="l13.74"> }</span>
<a href="#l13.75"></a><span id="l13.75"> </span>
<a href="#l13.76"></a><span id="l13.76" class="difflineat">@@ -1319,19 +1319,19 @@ function formatDate(datestr, unknown)</span>
<a href="#l13.77"></a><span id="l13.77">   return dateService.FormatDateTime(&quot;&quot;, dateService.dateFormatLong,</span>
<a href="#l13.78"></a><span id="l13.78">                                     dateService.timeFormatSeconds,</span>
<a href="#l13.79"></a><span id="l13.79">                                     date.getFullYear(), date.getMonth()+1, date.getDate(),</span>
<a href="#l13.80"></a><span id="l13.80">                                     date.getHours(), date.getMinutes(), date.getSeconds());</span>
<a href="#l13.81"></a><span id="l13.81"> }</span>
<a href="#l13.82"></a><span id="l13.82"> </span>
<a href="#l13.83"></a><span id="l13.83"> function getSelectedItems(linksMode)</span>
<a href="#l13.84"></a><span id="l13.84"> {</span>
<a href="#l13.85"></a><span id="l13.85" class="difflineminus">-  // linksMode is a boolean that is used to determine </span>
<a href="#l13.86"></a><span id="l13.86" class="difflineplus">+  // linksMode is a boolean that is used to determine</span>
<a href="#l13.87"></a><span id="l13.87">   // whether the getSelectedItems() function needs to</span>
<a href="#l13.88"></a><span id="l13.88" class="difflineminus">-  // run with urlSecurityCheck() or not.  </span>
<a href="#l13.89"></a><span id="l13.89" class="difflineplus">+  // run with urlSecurityCheck() or not.</span>
<a href="#l13.90"></a><span id="l13.90"> </span>
<a href="#l13.91"></a><span id="l13.91">   var elem = document.commandDispatcher.focusedElement;</span>
<a href="#l13.92"></a><span id="l13.92"> </span>
<a href="#l13.93"></a><span id="l13.93">   var view = elem.view;</span>
<a href="#l13.94"></a><span id="l13.94">   var selection = view.selection;</span>
<a href="#l13.95"></a><span id="l13.95">   var text = [], tmp = '';</span>
<a href="#l13.96"></a><span id="l13.96">   var min = {}, max = {};</span>
<a href="#l13.97"></a><span id="l13.97"> </span>
<a href="#l13.98"></a><span id="l13.98" class="difflineat">@@ -1352,17 +1352,17 @@ function getSelectedItems(linksMode)</span>
<a href="#l13.99"></a><span id="l13.99">           text.push(tmp);</span>
<a href="#l13.100"></a><span id="l13.100">         }</span>
<a href="#l13.101"></a><span id="l13.101">         catch (e) {</span>
<a href="#l13.102"></a><span id="l13.102">         }</span>
<a href="#l13.103"></a><span id="l13.103">       }</span>
<a href="#l13.104"></a><span id="l13.104">       elem.removeAttribute(&quot;copybuffer&quot;);</span>
<a href="#l13.105"></a><span id="l13.105">     }</span>
<a href="#l13.106"></a><span id="l13.106">   }</span>
<a href="#l13.107"></a><span id="l13.107" class="difflineminus">-  </span>
<a href="#l13.108"></a><span id="l13.108" class="difflineplus">+</span>
<a href="#l13.109"></a><span id="l13.109">   return text;</span>
<a href="#l13.110"></a><span id="l13.110"> }</span>
<a href="#l13.111"></a><span id="l13.111"> </span>
<a href="#l13.112"></a><span id="l13.112"> function doCopy(isLinkMode)</span>
<a href="#l13.113"></a><span id="l13.113"> {</span>
<a href="#l13.114"></a><span id="l13.114">   var text = getSelectedItems(isLinkMode);</span>
<a href="#l13.115"></a><span id="l13.115"> </span>
<a href="#l13.116"></a><span id="l13.116">   Components.classes[&quot;@mozilla.org/widget/clipboardhelper;1&quot;]</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l14.1"></a><span id="l14.1" class="difflineminus">--- a/suite/browser/pageinfo/permissions.js</span>
<a href="#l14.2"></a><span id="l14.2" class="difflineplus">+++ b/suite/browser/pageinfo/permissions.js</span>
<a href="#l14.3"></a><span id="l14.3" class="difflineat">@@ -100,17 +100,17 @@ function initRow(aPartId)</span>
<a href="#l14.4"></a><span id="l14.4">     command.setAttribute(&quot;disabled&quot;, &quot;true&quot;);</span>
<a href="#l14.5"></a><span id="l14.5">     document.getElementById(aPartId + &quot;RadioGroup&quot;).selectedItem = null;</span>
<a href="#l14.6"></a><span id="l14.6">     return;</span>
<a href="#l14.7"></a><span id="l14.7">   }</span>
<a href="#l14.8"></a><span id="l14.8">   checkbox.removeAttribute(&quot;disabled&quot;);</span>
<a href="#l14.9"></a><span id="l14.9">   var pm = Services.perms;</span>
<a href="#l14.10"></a><span id="l14.10">   var perm = aPartId == &quot;geo&quot; ? pm.testExactPermissionFromPrincipal(gPermPrincipal, aPartId) :</span>
<a href="#l14.11"></a><span id="l14.11">                                 pm.testPermissionFromPrincipal(gPermPrincipal, aPartId);</span>
<a href="#l14.12"></a><span id="l14.12" class="difflineminus">- </span>
<a href="#l14.13"></a><span id="l14.13" class="difflineplus">+</span>
<a href="#l14.14"></a><span id="l14.14">   if (perm) {</span>
<a href="#l14.15"></a><span id="l14.15">     checkbox.checked = false;</span>
<a href="#l14.16"></a><span id="l14.16">     command.removeAttribute(&quot;disabled&quot;);</span>
<a href="#l14.17"></a><span id="l14.17">   }</span>
<a href="#l14.18"></a><span id="l14.18">   else {</span>
<a href="#l14.19"></a><span id="l14.19">     checkbox.checked = true;</span>
<a href="#l14.20"></a><span id="l14.20">     command.setAttribute(&quot;disabled&quot;, &quot;true&quot;);</span>
<a href="#l14.21"></a><span id="l14.21">     perm = gPermObj[aPartId]();</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l15.1"></a><span id="l15.1" class="difflineminus">--- a/suite/browser/pageinfo/security.js</span>
<a href="#l15.2"></a><span id="l15.2" class="difflineplus">+++ b/suite/browser/pageinfo/security.js</span>
<a href="#l15.3"></a><span id="l15.3" class="difflineat">@@ -67,17 +67,17 @@ var security = {</span>
<a href="#l15.4"></a><span id="l15.4">       return {</span>
<a href="#l15.5"></a><span id="l15.5">         hostName : hName,</span>
<a href="#l15.6"></a><span id="l15.6">         cAName : &quot;&quot;,</span>
<a href="#l15.7"></a><span id="l15.7">         encryptionAlgorithm : &quot;&quot;,</span>
<a href="#l15.8"></a><span id="l15.8">         encryptionStrength : 0,</span>
<a href="#l15.9"></a><span id="l15.9">         isBroken : isBroken,</span>
<a href="#l15.10"></a><span id="l15.10">         isEV : isEV,</span>
<a href="#l15.11"></a><span id="l15.11">         cert : null,</span>
<a href="#l15.12"></a><span id="l15.12" class="difflineminus">-        fullLocation : gWindow.location        </span>
<a href="#l15.13"></a><span id="l15.13" class="difflineplus">+        fullLocation : gWindow.location</span>
<a href="#l15.14"></a><span id="l15.14">       };</span>
<a href="#l15.15"></a><span id="l15.15">     }</span>
<a href="#l15.16"></a><span id="l15.16">   },</span>
<a href="#l15.17"></a><span id="l15.17"> </span>
<a href="#l15.18"></a><span id="l15.18">   // Find the secureBrowserUI object (if present)</span>
<a href="#l15.19"></a><span id="l15.19">   _getSecurityUI : function() {</span>
<a href="#l15.20"></a><span id="l15.20">     if (&quot;gBrowser&quot; in window.opener)</span>
<a href="#l15.21"></a><span id="l15.21">       return window.opener.gBrowser.securityUI;</span>
<a href="#l15.22"></a><span id="l15.22" class="difflineat">@@ -210,17 +210,17 @@ function securityOnLoad() {</span>
<a href="#l15.23"></a><span id="l15.23">     if (info.hostName)</span>
<a href="#l15.24"></a><span id="l15.24">       msg1 = pageInfoBundle.getFormattedString(&quot;securityNone1&quot;, [info.hostName]);</span>
<a href="#l15.25"></a><span id="l15.25">     else</span>
<a href="#l15.26"></a><span id="l15.26">       msg1 = pageInfoBundle.getString(&quot;securityNone3&quot;);</span>
<a href="#l15.27"></a><span id="l15.27">     msg2 = pageInfoBundle.getString(&quot;securityNone2&quot;);</span>
<a href="#l15.28"></a><span id="l15.28">   }</span>
<a href="#l15.29"></a><span id="l15.29">   setText(&quot;security-technical-shortform&quot;, hdr);</span>
<a href="#l15.30"></a><span id="l15.30">   setText(&quot;security-technical-longform1&quot;, msg1);</span>
<a href="#l15.31"></a><span id="l15.31" class="difflineminus">-  setText(&quot;security-technical-longform2&quot;, msg2); </span>
<a href="#l15.32"></a><span id="l15.32" class="difflineplus">+  setText(&quot;security-technical-longform2&quot;, msg2);</span>
<a href="#l15.33"></a><span id="l15.33">   setText(&quot;general-security-privacy&quot;, hdr);</span>
<a href="#l15.34"></a><span id="l15.34"> }</span>
<a href="#l15.35"></a><span id="l15.35"> </span>
<a href="#l15.36"></a><span id="l15.36"> function setText(id, value)</span>
<a href="#l15.37"></a><span id="l15.37"> {</span>
<a href="#l15.38"></a><span id="l15.38">   var element = document.getElementById(id);</span>
<a href="#l15.39"></a><span id="l15.39">   if (!element)</span>
<a href="#l15.40"></a><span id="l15.40">     return;</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l16.1"></a><span id="l16.1" class="difflineminus">--- a/suite/browser/test/browser/browser_bug329212.js</span>
<a href="#l16.2"></a><span id="l16.2" class="difflineplus">+++ b/suite/browser/test/browser/browser_bug329212.js</span>
<a href="#l16.3"></a><span id="l16.3" class="difflineat">@@ -31,12 +31,12 @@ function test() {</span>
<a href="#l16.4"></a><span id="l16.4">     is(tooltip.getAttribute(&quot;label&quot;), &quot;This is an xlink:title attribute&quot;);</span>
<a href="#l16.5"></a><span id="l16.5"> </span>
<a href="#l16.6"></a><span id="l16.6">     ok(!FillInHTMLTooltip(doc.getElementById(&quot;text5&quot;)), &quot;should not get title&quot;);</span>
<a href="#l16.7"></a><span id="l16.7"> </span>
<a href="#l16.8"></a><span id="l16.8">     gBrowser.removeCurrentTab();</span>
<a href="#l16.9"></a><span id="l16.9">     finish();</span>
<a href="#l16.10"></a><span id="l16.10">   }, true);</span>
<a href="#l16.11"></a><span id="l16.11"> </span>
<a href="#l16.12"></a><span id="l16.12" class="difflineminus">-  content.location = </span>
<a href="#l16.13"></a><span id="l16.13" class="difflineplus">+  content.location =</span>
<a href="#l16.14"></a><span id="l16.14">     &quot;http://mochi.test:8888/browser/suite/browser/test/browser/title_test.svg&quot;;</span>
<a href="#l16.15"></a><span id="l16.15"> }</span>
<a href="#l16.16"></a><span id="l16.16"> </span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l17.1"></a><span id="l17.1" class="difflineminus">--- a/suite/browser/test/browser/browser_bug581947.js</span>
<a href="#l17.2"></a><span id="l17.2" class="difflineplus">+++ b/suite/browser/test/browser/browser_bug581947.js</span>
<a href="#l17.3"></a><span id="l17.3" class="difflineat">@@ -84,12 +84,12 @@ function test() {</span>
<a href="#l17.4"></a><span id="l17.4">     for each (let data in todo_testData) {</span>
<a href="#l17.5"></a><span id="l17.5">       todo_check(data[0], data[1]);</span>
<a href="#l17.6"></a><span id="l17.6">     }</span>
<a href="#l17.7"></a><span id="l17.7"> </span>
<a href="#l17.8"></a><span id="l17.8">     gBrowser.removeCurrentTab();</span>
<a href="#l17.9"></a><span id="l17.9">     finish();</span>
<a href="#l17.10"></a><span id="l17.10">   }, true);</span>
<a href="#l17.11"></a><span id="l17.11"> </span>
<a href="#l17.12"></a><span id="l17.12" class="difflineminus">-  content.location = </span>
<a href="#l17.13"></a><span id="l17.13" class="difflineplus">+  content.location =</span>
<a href="#l17.14"></a><span id="l17.14">     &quot;data:text/html,&lt;!DOCTYPE html&gt;&lt;html&gt;&lt;body&gt;&lt;form id='content'&gt;&lt;/form&gt;&lt;/body&gt;&lt;/html&gt;&quot;;</span>
<a href="#l17.15"></a><span id="l17.15"> }</span>
<a href="#l17.16"></a><span id="l17.16"> </span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l18.1"></a><span id="l18.1" class="difflineminus">--- a/suite/browser/test/browser/browser_bug623155.js</span>
<a href="#l18.2"></a><span id="l18.2" class="difflineplus">+++ b/suite/browser/test/browser/browser_bug623155.js</span>
<a href="#l18.3"></a><span id="l18.3" class="difflineat">@@ -77,17 +77,17 @@ var gWebProgressListener = {</span>
<a href="#l18.4"></a><span id="l18.4"> </span>
<a href="#l18.5"></a><span id="l18.5">   onLocationChange: function(aWebProgress, aRequest, aLocation, aFlags) {</span>
<a href="#l18.6"></a><span id="l18.6">     if (!aRequest) {</span>
<a href="#l18.7"></a><span id="l18.7">       // This is bug 673752, or maybe initial &quot;about:blank&quot;.</span>
<a href="#l18.8"></a><span id="l18.8">       return;</span>
<a href="#l18.9"></a><span id="l18.9">     }</span>
<a href="#l18.10"></a><span id="l18.10"> </span>
<a href="#l18.11"></a><span id="l18.11">     ok(gNewTab, &quot;There is a new tab.&quot;);</span>
<a href="#l18.12"></a><span id="l18.12" class="difflineminus">-    ok(isRedirectedURI(aLocation), </span>
<a href="#l18.13"></a><span id="l18.13" class="difflineplus">+    ok(isRedirectedURI(aLocation),</span>
<a href="#l18.14"></a><span id="l18.14">        &quot;onLocationChange catches only redirected URI.&quot;);</span>
<a href="#l18.15"></a><span id="l18.15"> </span>
<a href="#l18.16"></a><span id="l18.16">     if (aLocation.ref == &quot;BG&quot;) {</span>
<a href="#l18.17"></a><span id="l18.17">       // This is background tab's request.</span>
<a href="#l18.18"></a><span id="l18.18">       isnot(gNewTab, gBrowser.selectedTab, &quot;This is a background tab.&quot;);</span>
<a href="#l18.19"></a><span id="l18.19">     } else if (aLocation.ref == &quot;FG&quot;) {</span>
<a href="#l18.20"></a><span id="l18.20">       // This is foreground tab's request.</span>
<a href="#l18.21"></a><span id="l18.21">       is(gNewTab, gBrowser.selectedTab, &quot;This is a foreground tab.&quot;);</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l19.1"></a><span id="l19.1" class="difflineminus">--- a/suite/common/bookmarks/browser-places.js</span>
<a href="#l19.2"></a><span id="l19.2" class="difflineplus">+++ b/suite/common/bookmarks/browser-places.js</span>
<a href="#l19.3"></a><span id="l19.3" class="difflineat">@@ -511,17 +511,17 @@ var BookmarksEventHandler = {</span>
<a href="#l19.4"></a><span id="l19.4">   onPopupShowing: function BEH_onPopupShowing(aEvent) {</span>
<a href="#l19.5"></a><span id="l19.5">     var browser = getBrowser();</span>
<a href="#l19.6"></a><span id="l19.6">     if (!aEvent.currentTarget.parentNode._placesView)</span>
<a href="#l19.7"></a><span id="l19.7">       new PlacesMenu(aEvent, 'place:folder=BOOKMARKS_MENU');</span>
<a href="#l19.8"></a><span id="l19.8"> </span>
<a href="#l19.9"></a><span id="l19.9">     document.getElementById(&quot;Browser:BookmarkAllTabs&quot;)</span>
<a href="#l19.10"></a><span id="l19.10">             .setAttribute(&quot;disabled&quot;, !browser || browser.tabs.length == 1);</span>
<a href="#l19.11"></a><span id="l19.11">   },</span>
<a href="#l19.12"></a><span id="l19.12" class="difflineminus">-  </span>
<a href="#l19.13"></a><span id="l19.13" class="difflineplus">+</span>
<a href="#l19.14"></a><span id="l19.14">   fillInBHTooltip: function BEH_fillInBHTooltip(aDocument, aEvent) {</span>
<a href="#l19.15"></a><span id="l19.15">     var node;</span>
<a href="#l19.16"></a><span id="l19.16">     var cropped = false;</span>
<a href="#l19.17"></a><span id="l19.17">     var targetURI;</span>
<a href="#l19.18"></a><span id="l19.18"> </span>
<a href="#l19.19"></a><span id="l19.19">     if (aDocument.tooltipNode.localName == &quot;treechildren&quot;) {</span>
<a href="#l19.20"></a><span id="l19.20">       var tree = aDocument.tooltipNode.parentNode;</span>
<a href="#l19.21"></a><span id="l19.21">       var tbo = tree.treeBoxObject;</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l20.1"></a><span id="l20.1" class="difflineminus">--- a/suite/common/bookmarks/editBookmarkOverlay.js</span>
<a href="#l20.2"></a><span id="l20.2" class="difflineplus">+++ b/suite/common/bookmarks/editBookmarkOverlay.js</span>
<a href="#l20.3"></a><span id="l20.3" class="difflineat">@@ -83,17 +83,17 @@ var gEditItemOverlay = {</span>
<a href="#l20.4"></a><span id="l20.4">       this._hiddenRows.indexOf(&quot;siteLocation&quot;) != -1;</span>
<a href="#l20.5"></a><span id="l20.5">     this._element(&quot;selectionCount&quot;).hidden = !this._multiEdit;</span>
<a href="#l20.6"></a><span id="l20.6">   },</span>
<a href="#l20.7"></a><span id="l20.7"> </span>
<a href="#l20.8"></a><span id="l20.8">   /**</span>
<a href="#l20.9"></a><span id="l20.9">    * Initialize the panel</span>
<a href="#l20.10"></a><span id="l20.10">    * @param aFor</span>
<a href="#l20.11"></a><span id="l20.11">    *        Either a places-itemId (of a bookmark, folder or a live bookmark),</span>
<a href="#l20.12"></a><span id="l20.12" class="difflineminus">-   *        an array of itemIds (used for bulk tagging), or a URI object (in </span>
<a href="#l20.13"></a><span id="l20.13" class="difflineplus">+   *        an array of itemIds (used for bulk tagging), or a URI object (in</span>
<a href="#l20.14"></a><span id="l20.14">    *        which case, the panel would be initialized in read-only mode).</span>
<a href="#l20.15"></a><span id="l20.15">    * @param [optional] aInfo</span>
<a href="#l20.16"></a><span id="l20.16">    *        JS object which stores additional info for the panel</span>
<a href="#l20.17"></a><span id="l20.17">    *        initialization. The following properties may bet set:</span>
<a href="#l20.18"></a><span id="l20.18">    *        * hiddenRows (Strings array): list of rows to be hidden regardless</span>
<a href="#l20.19"></a><span id="l20.19">    *          of the item edited. Possible values: &quot;title&quot;, &quot;location&quot;,</span>
<a href="#l20.20"></a><span id="l20.20">    *          &quot;description&quot;, &quot;keyword&quot;, &quot;feedLocation&quot;,</span>
<a href="#l20.21"></a><span id="l20.21">    *          &quot;siteLocation&quot;, folderPicker&quot;</span>
<a href="#l20.22"></a><span id="l20.22" class="difflineat">@@ -154,17 +154,17 @@ var gEditItemOverlay = {</span>
<a href="#l20.23"></a><span id="l20.23">           this._showHideRows();</span>
<a href="#l20.24"></a><span id="l20.24">         }, () =&gt; undefined);</span>
<a href="#l20.25"></a><span id="l20.25">       }</span>
<a href="#l20.26"></a><span id="l20.26"> </span>
<a href="#l20.27"></a><span id="l20.27">       // folder picker</span>
<a href="#l20.28"></a><span id="l20.28">       this._initFolderMenuList(containerId);</span>
<a href="#l20.29"></a><span id="l20.29"> </span>
<a href="#l20.30"></a><span id="l20.30">       // description field</span>
<a href="#l20.31"></a><span id="l20.31" class="difflineminus">-      this._initTextField(&quot;descriptionField&quot;, </span>
<a href="#l20.32"></a><span id="l20.32" class="difflineplus">+      this._initTextField(&quot;descriptionField&quot;,</span>
<a href="#l20.33"></a><span id="l20.33">                           PlacesUIUtils.getItemDescription(this._itemId));</span>
<a href="#l20.34"></a><span id="l20.34">     }</span>
<a href="#l20.35"></a><span id="l20.35"> </span>
<a href="#l20.36"></a><span id="l20.36">     if (this._itemId == -1 ||</span>
<a href="#l20.37"></a><span id="l20.37">         this._itemType == Components.interfaces.nsINavBookmarksService.TYPE_BOOKMARK) {</span>
<a href="#l20.38"></a><span id="l20.38">       this._isLivemark = false;</span>
<a href="#l20.39"></a><span id="l20.39"> </span>
<a href="#l20.40"></a><span id="l20.40">       this._initTextField(&quot;locationField&quot;, this._uri.spec);</span>
<a href="#l20.41"></a><span id="l20.41" class="difflineat">@@ -411,17 +411,17 @@ var gEditItemOverlay = {</span>
<a href="#l20.42"></a><span id="l20.42">   },</span>
<a href="#l20.43"></a><span id="l20.43"> </span>
<a href="#l20.44"></a><span id="l20.44">   _updateSingleTagForItem: function EIO__updateSingleTagForItem() {</span>
<a href="#l20.45"></a><span id="l20.45">     var currentTags = PlacesUtils.tagging.getTagsForURI(this._uri);</span>
<a href="#l20.46"></a><span id="l20.46">     var tags = this._getTagsArrayFromTagField();</span>
<a href="#l20.47"></a><span id="l20.47">     if (tags.length &gt; 0 || currentTags.length &gt; 0) {</span>
<a href="#l20.48"></a><span id="l20.48">       var tagsToRemove = [];</span>
<a href="#l20.49"></a><span id="l20.49">       var tagsToAdd = [];</span>
<a href="#l20.50"></a><span id="l20.50" class="difflineminus">-      var txns = []; </span>
<a href="#l20.51"></a><span id="l20.51" class="difflineplus">+      var txns = [];</span>
<a href="#l20.52"></a><span id="l20.52">       for (var i = 0; i &lt; currentTags.length; i++) {</span>
<a href="#l20.53"></a><span id="l20.53">         if (tags.indexOf(currentTags[i]) == -1)</span>
<a href="#l20.54"></a><span id="l20.54">           tagsToRemove.push(currentTags[i]);</span>
<a href="#l20.55"></a><span id="l20.55">       }</span>
<a href="#l20.56"></a><span id="l20.56">       for (var i = 0; i &lt; tags.length; i++) {</span>
<a href="#l20.57"></a><span id="l20.57">         if (currentTags.indexOf(tags[i]) == -1)</span>
<a href="#l20.58"></a><span id="l20.58">           tagsToAdd.push(tags[i]);</span>
<a href="#l20.59"></a><span id="l20.59">       }</span>
<a href="#l20.60"></a><span id="l20.60" class="difflineat">@@ -468,17 +468,17 @@ var gEditItemOverlay = {</span>
<a href="#l20.61"></a><span id="l20.61">     Services.prefs.setCharPref(&quot;browser.bookmarks.editDialog.firstEditField&quot;, aNewField);</span>
<a href="#l20.62"></a><span id="l20.62">   },</span>
<a href="#l20.63"></a><span id="l20.63"> </span>
<a href="#l20.64"></a><span id="l20.64">   _updateMultipleTagsForItems: function EIO__updateMultipleTagsForItems() {</span>
<a href="#l20.65"></a><span id="l20.65">     var tags = this._getTagsArrayFromTagField();</span>
<a href="#l20.66"></a><span id="l20.66">     if (tags.length &gt; 0 || this._allTags.length &gt; 0) {</span>
<a href="#l20.67"></a><span id="l20.67">       var tagsToRemove = [];</span>
<a href="#l20.68"></a><span id="l20.68">       var tagsToAdd = [];</span>
<a href="#l20.69"></a><span id="l20.69" class="difflineminus">-      var txns = []; </span>
<a href="#l20.70"></a><span id="l20.70" class="difflineplus">+      var txns = [];</span>
<a href="#l20.71"></a><span id="l20.71">       for (var i = 0; i &lt; this._allTags.length; i++) {</span>
<a href="#l20.72"></a><span id="l20.72">         if (tags.indexOf(this._allTags[i]) == -1)</span>
<a href="#l20.73"></a><span id="l20.73">           tagsToRemove.push(this._allTags[i]);</span>
<a href="#l20.74"></a><span id="l20.74">       }</span>
<a href="#l20.75"></a><span id="l20.75">       for (var i = 0; i &lt; this._tags.length; i++) {</span>
<a href="#l20.76"></a><span id="l20.76">         tagsToAdd[i] = [];</span>
<a href="#l20.77"></a><span id="l20.77">         for (var j = 0; j &lt; tags.length; j++) {</span>
<a href="#l20.78"></a><span id="l20.78">           if (this._tags[i].indexOf(tags[j]) == -1)</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l21.1"></a><span id="l21.1" class="difflineminus">--- a/suite/common/contentAreaClick.js</span>
<a href="#l21.2"></a><span id="l21.2" class="difflineplus">+++ b/suite/common/contentAreaClick.js</span>
<a href="#l21.3"></a><span id="l21.3" class="difflineat">@@ -41,33 +41,33 @@</span>
<a href="#l21.4"></a><span id="l21.4">     }</span>
<a href="#l21.5"></a><span id="l21.5"> </span>
<a href="#l21.6"></a><span id="l21.6">     return href ? {href: href, linkNode: linkNode} : null;</span>
<a href="#l21.7"></a><span id="l21.7">   }</span>
<a href="#l21.8"></a><span id="l21.8"> </span>
<a href="#l21.9"></a><span id="l21.9">   // Called whenever the user clicks in the content area,</span>
<a href="#l21.10"></a><span id="l21.10">   // except when left-clicking on links (special case)</span>
<a href="#l21.11"></a><span id="l21.11">   // should always return true for click to go through</span>
<a href="#l21.12"></a><span id="l21.12" class="difflineminus">-  function contentAreaClick(event) </span>
<a href="#l21.13"></a><span id="l21.13" class="difflineplus">+  function contentAreaClick(event)</span>
<a href="#l21.14"></a><span id="l21.14">   {</span>
<a href="#l21.15"></a><span id="l21.15">     if (!event.isTrusted || event.defaultPrevented) {</span>
<a href="#l21.16"></a><span id="l21.16">       return true;</span>
<a href="#l21.17"></a><span id="l21.17">     }</span>
<a href="#l21.18"></a><span id="l21.18"> </span>
<a href="#l21.19"></a><span id="l21.19">     var isKeyCommand = (event.type == &quot;command&quot;);</span>
<a href="#l21.20"></a><span id="l21.20">     var ceParams = hrefAndLinkNodeForClickEvent(event);</span>
<a href="#l21.21"></a><span id="l21.21">     if (ceParams) {</span>
<a href="#l21.22"></a><span id="l21.22">       var href = ceParams.href;</span>
<a href="#l21.23"></a><span id="l21.23">       if (isKeyCommand) {</span>
<a href="#l21.24"></a><span id="l21.24">         openNewTabWith(href, event.target, event.altKey);</span>
<a href="#l21.25"></a><span id="l21.25">         event.stopPropagation();</span>
<a href="#l21.26"></a><span id="l21.26">       }</span>
<a href="#l21.27"></a><span id="l21.27">       else {</span>
<a href="#l21.28"></a><span id="l21.28">         // if in mailnews block the link left click if we determine</span>
<a href="#l21.29"></a><span id="l21.29" class="difflineminus">-        // that this URL is phishy (i.e. a potential email scam) </span>
<a href="#l21.30"></a><span id="l21.30" class="difflineplus">+        // that this URL is phishy (i.e. a potential email scam)</span>
<a href="#l21.31"></a><span id="l21.31">         if (&quot;gMessengerBundle&quot; in this &amp;&amp; event.button &lt; 2 &amp;&amp;</span>
<a href="#l21.32"></a><span id="l21.32">             isPhishingURL(ceParams.linkNode, false, href))</span>
<a href="#l21.33"></a><span id="l21.33">           return false;</span>
<a href="#l21.34"></a><span id="l21.34">         handleLinkClick(event, href, ceParams.linkNode);</span>
<a href="#l21.35"></a><span id="l21.35"> </span>
<a href="#l21.36"></a><span id="l21.36">         // Mark the page as a user followed link.  This is done so that history can</span>
<a href="#l21.37"></a><span id="l21.37">         // distinguish automatic embed visits from user activated ones.  For example</span>
<a href="#l21.38"></a><span id="l21.38">         // pages loaded in frames are embed visits and lost with the session, while</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l22.1"></a><span id="l22.1" class="difflineminus">--- a/suite/common/defaultClientDialog.js</span>
<a href="#l22.2"></a><span id="l22.2" class="difflineplus">+++ b/suite/common/defaultClientDialog.js</span>
<a href="#l22.3"></a><span id="l22.3" class="difflineat">@@ -38,25 +38,25 @@ function onAccept()</span>
<a href="#l22.4"></a><span id="l22.4">                            .getService(nsIShellService);</span>
<a href="#l22.5"></a><span id="l22.5">   var appTypes = 0;</span>
<a href="#l22.6"></a><span id="l22.6">   var appTypesCheck = 0;</span>
<a href="#l22.7"></a><span id="l22.7">   var defaultList = document.getElementById(&quot;defaultList&quot;);</span>
<a href="#l22.8"></a><span id="l22.8"> </span>
<a href="#l22.9"></a><span id="l22.9">   for (var i = 0; i &lt; defaultList.getRowCount(); i++) {</span>
<a href="#l22.10"></a><span id="l22.10">     var currentItem = defaultList.getItemAtIndex(i);</span>
<a href="#l22.11"></a><span id="l22.11">     var currentAppType = nsIShellService[currentItem.value];</span>
<a href="#l22.12"></a><span id="l22.12" class="difflineminus">-    </span>
<a href="#l22.13"></a><span id="l22.13" class="difflineplus">+</span>
<a href="#l22.14"></a><span id="l22.14">     if (currentItem.checked) {</span>
<a href="#l22.15"></a><span id="l22.15">       appTypesCheck |= currentAppType;</span>
<a href="#l22.16"></a><span id="l22.16" class="difflineminus">-      </span>
<a href="#l22.17"></a><span id="l22.17" class="difflineplus">+</span>
<a href="#l22.18"></a><span id="l22.18">       if (!currentItem.disabled)</span>
<a href="#l22.19"></a><span id="l22.19">         appTypes |= currentAppType;</span>
<a href="#l22.20"></a><span id="l22.20">     }</span>
<a href="#l22.21"></a><span id="l22.21">   }</span>
<a href="#l22.22"></a><span id="l22.22" class="difflineminus">- </span>
<a href="#l22.23"></a><span id="l22.23" class="difflineplus">+</span>
<a href="#l22.24"></a><span id="l22.24">   if (appTypes)</span>
<a href="#l22.25"></a><span id="l22.25">     shellSvc.setDefaultClient(false, true, appTypes);</span>
<a href="#l22.26"></a><span id="l22.26"> </span>
<a href="#l22.27"></a><span id="l22.27">   // Update the pref for which app types we should check if we are the default app</span>
<a href="#l22.28"></a><span id="l22.28">   shellSvc.shouldBeDefaultClientFor = appTypesCheck;</span>
<a href="#l22.29"></a><span id="l22.29"> </span>
<a href="#l22.30"></a><span id="l22.30">   shellSvc.shouldCheckDefaultClient = document.getElementById('checkOnStartup').checked;</span>
<a href="#l22.31"></a><span id="l22.31"> }</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l23.1"></a><span id="l23.1" class="difflineminus">--- a/suite/common/directory/directory.js</span>
<a href="#l23.2"></a><span id="l23.2" class="difflineplus">+++ b/suite/common/directory/directory.js</span>
<a href="#l23.3"></a><span id="l23.3" class="difflineat">@@ -41,27 +41,27 @@ var loadingArc = null;</span>
<a href="#l23.4"></a><span id="l23.4"> var loadingLevel = 0;</span>
<a href="#l23.5"></a><span id="l23.5"> </span>
<a href="#l23.6"></a><span id="l23.6"> var	RDF_observer =</span>
<a href="#l23.7"></a><span id="l23.7"> {</span>
<a href="#l23.8"></a><span id="l23.8"> 	onAssert: function(ds, src, prop, target)</span>
<a href="#l23.9"></a><span id="l23.9"> 	{</span>
<a href="#l23.10"></a><span id="l23.10"> 		if (prop == loadingArc) {</span>
<a href="#l23.11"></a><span id="l23.11"> 		  if (loadingLevel++ == 0)</span>
<a href="#l23.12"></a><span id="l23.12" class="difflineminus">-        SetBusyCursor(window, true); </span>
<a href="#l23.13"></a><span id="l23.13" class="difflineplus">+        SetBusyCursor(window, true);</span>
<a href="#l23.14"></a><span id="l23.14">       debug(&quot;Directory: assert: loading level is &quot; + loadingLevel + &quot; for &quot; + src.Value + &quot;\n&quot;);</span>
<a href="#l23.15"></a><span id="l23.15"> 		}</span>
<a href="#l23.16"></a><span id="l23.16"> 	},</span>
<a href="#l23.17"></a><span id="l23.17" class="difflineminus">-		</span>
<a href="#l23.18"></a><span id="l23.18" class="difflineplus">+</span>
<a href="#l23.19"></a><span id="l23.19"> 	onUnassert: function(ds, src, prop, target)</span>
<a href="#l23.20"></a><span id="l23.20"> 	{</span>
<a href="#l23.21"></a><span id="l23.21"> 		if (prop == loadingArc) {</span>
<a href="#l23.22"></a><span id="l23.22"> 		  if (loadingLevel &gt; 0)</span>
<a href="#l23.23"></a><span id="l23.23">     	  if (--loadingLevel == 0)</span>
<a href="#l23.24"></a><span id="l23.24" class="difflineminus">-          SetBusyCursor(window, false); </span>
<a href="#l23.25"></a><span id="l23.25" class="difflineplus">+          SetBusyCursor(window, false);</span>
<a href="#l23.26"></a><span id="l23.26">       debug(&quot;Directory: unassert: loading level is &quot; + loadingLevel + &quot; for &quot; + src.Value + &quot;\n&quot;);</span>
<a href="#l23.27"></a><span id="l23.27"> 		}</span>
<a href="#l23.28"></a><span id="l23.28"> 	},</span>
<a href="#l23.29"></a><span id="l23.29"> </span>
<a href="#l23.30"></a><span id="l23.30"> 	onChange: function(ds, src, prop, old_target, new_target) { },</span>
<a href="#l23.31"></a><span id="l23.31"> 	onMove: function(ds, old_src, new_src, prop, target) { },</span>
<a href="#l23.32"></a><span id="l23.32"> 	onBeginUpdateBatch: function(ds) { },</span>
<a href="#l23.33"></a><span id="l23.33"> 	onEndUpdateBatch: function(ds) { }</span>
<a href="#l23.34"></a><span id="l23.34" class="difflineat">@@ -186,84 +186,84 @@ function OnClick(event)</span>
<a href="#l23.35"></a><span id="l23.35"> </span>
<a href="#l23.36"></a><span id="l23.36">   return true;</span>
<a href="#l23.37"></a><span id="l23.37"> }</span>
<a href="#l23.38"></a><span id="l23.38"> </span>
<a href="#l23.39"></a><span id="l23.39"> function doSort(aTarget)</span>
<a href="#l23.40"></a><span id="l23.40"> {</span>
<a href="#l23.41"></a><span id="l23.41">   if (aTarget.localName != &quot;treecol&quot;)</span>
<a href="#l23.42"></a><span id="l23.42">     return;</span>
<a href="#l23.43"></a><span id="l23.43" class="difflineminus">-    </span>
<a href="#l23.44"></a><span id="l23.44" class="difflineplus">+</span>
<a href="#l23.45"></a><span id="l23.45"> 	// determine column resource to sort on</span>
<a href="#l23.46"></a><span id="l23.46"> 	var sortResource = aTarget.getAttribute('resource');</span>
<a href="#l23.47"></a><span id="l23.47"> </span>
<a href="#l23.48"></a><span id="l23.48"> 	// switch between ascending &amp; descending sort (no natural order support)</span>
<a href="#l23.49"></a><span id="l23.49">   var sortDirection = aTarget.getAttribute(&quot;sortDirection&quot;) == &quot;ascending&quot; ? &quot;descending&quot; : &quot;ascending&quot;;</span>
<a href="#l23.50"></a><span id="l23.50"> </span>
<a href="#l23.51"></a><span id="l23.51"> 	try {</span>
<a href="#l23.52"></a><span id="l23.52"> 	  var sortService = Components.classes[XULSORTSERVICE_CONTRACTID].getService(nsIXULSortService);</span>
<a href="#l23.53"></a><span id="l23.53"> 		sortService.sort(aTarget, sortResource, sortDirection);</span>
<a href="#l23.54"></a><span id="l23.54"> 	} catch(ex) { }</span>
<a href="#l23.55"></a><span id="l23.55"> }</span>
<a href="#l23.56"></a><span id="l23.56"> </span>
<a href="#l23.57"></a><span id="l23.57"> function BeginDragTree (event)</span>
<a href="#l23.58"></a><span id="l23.58"> {</span>
<a href="#l23.59"></a><span id="l23.59">   if (event.target.localName != &quot;treechildren&quot;)</span>
<a href="#l23.60"></a><span id="l23.60">     return true;</span>
<a href="#l23.61"></a><span id="l23.61" class="difflineminus">-    </span>
<a href="#l23.62"></a><span id="l23.62" class="difflineplus">+</span>
<a href="#l23.63"></a><span id="l23.63">   var dragStarted = false;</span>
<a href="#l23.64"></a><span id="l23.64"> </span>
<a href="#l23.65"></a><span id="l23.65">   try {</span>
<a href="#l23.66"></a><span id="l23.66">     // determine which treeitem was dragged</span>
<a href="#l23.67"></a><span id="l23.67">     var tree = document.getElementById(&quot;tree&quot;);</span>
<a href="#l23.68"></a><span id="l23.68">     var row = tree.treeBoxObject.getRowAt(event.clientX, event.clientY);</span>
<a href="#l23.69"></a><span id="l23.69">     var item = tree.contentView.getItemAtIndex(row);</span>
<a href="#l23.70"></a><span id="l23.70"> </span>
<a href="#l23.71"></a><span id="l23.71">     // get information from treeitem for drag</span>
<a href="#l23.72"></a><span id="l23.72">     var url = item.getAttributeNS(NC_NS, &quot;url&quot;);</span>
<a href="#l23.73"></a><span id="l23.73">     var desc = item.getAttributeNS(NC_NS, &quot;desc&quot;);</span>
<a href="#l23.74"></a><span id="l23.74" class="difflineminus">-    </span>
<a href="#l23.75"></a><span id="l23.75" class="difflineminus">-    var transferable = </span>
<a href="#l23.76"></a><span id="l23.76" class="difflineplus">+</span>
<a href="#l23.77"></a><span id="l23.77" class="difflineplus">+    var transferable =</span>
<a href="#l23.78"></a><span id="l23.78">       Components.classes[TRANSFERABLE_CONTRACTID].createInstance(nsITransferable);</span>
<a href="#l23.79"></a><span id="l23.79" class="difflineminus">-    var genDataURL = </span>
<a href="#l23.80"></a><span id="l23.80" class="difflineplus">+    var genDataURL =</span>
<a href="#l23.81"></a><span id="l23.81">       Components.classes[WSTRING_CONTRACTID].createInstance(nsISupportsString);</span>
<a href="#l23.82"></a><span id="l23.82" class="difflineminus">-    var genDataHTML = </span>
<a href="#l23.83"></a><span id="l23.83" class="difflineplus">+    var genDataHTML =</span>
<a href="#l23.84"></a><span id="l23.84">       Components.classes[WSTRING_CONTRACTID].createInstance(nsISupportsString);</span>
<a href="#l23.85"></a><span id="l23.85" class="difflineminus">-    var genData = </span>
<a href="#l23.86"></a><span id="l23.86" class="difflineplus">+    var genData =</span>
<a href="#l23.87"></a><span id="l23.87">       Components.classes[WSTRING_CONTRACTID].createInstance(nsISupportsString);</span>
<a href="#l23.88"></a><span id="l23.88"> </span>
<a href="#l23.89"></a><span id="l23.89">     transferable.init(null);</span>
<a href="#l23.90"></a><span id="l23.90">     transferable.addDataFlavor(&quot;text/x-moz-url&quot;);</span>
<a href="#l23.91"></a><span id="l23.91">     transferable.addDataFlavor(&quot;text/html&quot;);</span>
<a href="#l23.92"></a><span id="l23.92">     transferable.addDataFlavor(&quot;text/unicode&quot;);</span>
<a href="#l23.93"></a><span id="l23.93" class="difflineminus">-    </span>
<a href="#l23.94"></a><span id="l23.94" class="difflineplus">+</span>
<a href="#l23.95"></a><span id="l23.95">     genDataURL.data = url + &quot;\n&quot; + desc;</span>
<a href="#l23.96"></a><span id="l23.96">     genDataHTML.data = &quot;&lt;a href=\&quot;&quot; + url + &quot;\&quot;&gt;&quot; + desc + &quot;&lt;/a&gt;&quot;;</span>
<a href="#l23.97"></a><span id="l23.97">     genData.data = url;</span>
<a href="#l23.98"></a><span id="l23.98"> </span>
<a href="#l23.99"></a><span id="l23.99">     transferable.setTransferData(&quot;text/x-moz-url&quot;, genDataURL, genDataURL.data.length * 2);</span>
<a href="#l23.100"></a><span id="l23.100">     transferable.setTransferData(&quot;text/html&quot;, genDataHTML, genDataHTML.data.length * 2);</span>
<a href="#l23.101"></a><span id="l23.101">     transferable.setTransferData(&quot;text/unicode&quot;, genData, genData.data.length * 2);</span>
<a href="#l23.102"></a><span id="l23.102"> </span>
<a href="#l23.103"></a><span id="l23.103" class="difflineminus">-    var transArray = </span>
<a href="#l23.104"></a><span id="l23.104" class="difflineplus">+    var transArray =</span>
<a href="#l23.105"></a><span id="l23.105">       Components.classes[ARRAY_CONTRACTID].createInstance(nsISupportsArray);</span>
<a href="#l23.106"></a><span id="l23.106"> </span>
<a href="#l23.107"></a><span id="l23.107">     // put it into the transferable as an |nsISupports|</span>
<a href="#l23.108"></a><span id="l23.108">     var genTrans = transferable.QueryInterface(Components.interfaces.nsISupports);</span>
<a href="#l23.109"></a><span id="l23.109">     transArray.AppendElement(genTrans);</span>
<a href="#l23.110"></a><span id="l23.110" class="difflineminus">-    </span>
<a href="#l23.111"></a><span id="l23.111" class="difflineminus">-    var dragService = </span>
<a href="#l23.112"></a><span id="l23.112" class="difflineplus">+</span>
<a href="#l23.113"></a><span id="l23.113" class="difflineplus">+    var dragService =</span>
<a href="#l23.114"></a><span id="l23.114">       Components.classes[DRAGSERVICE_CONTRACTID].getService(nsIDragService);</span>
<a href="#l23.115"></a><span id="l23.115"> </span>
<a href="#l23.116"></a><span id="l23.116" class="difflineminus">-    dragService.invokeDragSession(event.target, transArray, null, nsIDragService.DRAGDROP_ACTION_COPY + </span>
<a href="#l23.117"></a><span id="l23.117" class="difflineplus">+    dragService.invokeDragSession(event.target, transArray, null, nsIDragService.DRAGDROP_ACTION_COPY +</span>
<a href="#l23.118"></a><span id="l23.118">                                   nsIDragService.DRAGDROP_ACTION_MOVE);</span>
<a href="#l23.119"></a><span id="l23.119" class="difflineminus">-  </span>
<a href="#l23.120"></a><span id="l23.120" class="difflineplus">+</span>
<a href="#l23.121"></a><span id="l23.121">     dragStarted = true;</span>
<a href="#l23.122"></a><span id="l23.122">   } catch (ex) { }</span>
<a href="#l23.123"></a><span id="l23.123" class="difflineminus">-  </span>
<a href="#l23.124"></a><span id="l23.124" class="difflineplus">+</span>
<a href="#l23.125"></a><span id="l23.125">   return !dragStarted;</span>
<a href="#l23.126"></a><span id="l23.126"> }</span>
<a href="#l23.127"></a><span id="l23.127"> </span>
<a href="#l23.128"></a><span id="l23.128"> function scrollDown()</span>
<a href="#l23.129"></a><span id="l23.129"> {</span>
<a href="#l23.130"></a><span id="l23.130">   window.frames[0].scrollTo(0, window.frames[0].document.body.clientHeight);</span>
<a href="#l23.131"></a><span id="l23.131"> }</span>
<a href="#l23.132"></a><span id="l23.132"> </span>
<a href="#l23.133"></a><span id="l23.133" class="difflineat">@@ -274,14 +274,14 @@ function OnFTPControlLog(server, msg)</span>
<a href="#l23.134"></a><span id="l23.134">   var div = logdoc.createElementNS(&quot;http://www.w3.org/1999/xhtml&quot;, &quot;div&quot;);</span>
<a href="#l23.135"></a><span id="l23.135"> </span>
<a href="#l23.136"></a><span id="l23.136">   if (server)</span>
<a href="#l23.137"></a><span id="l23.137">     div.setAttribute(&quot;class&quot;, &quot;server&quot;);</span>
<a href="#l23.138"></a><span id="l23.138">   else</span>
<a href="#l23.139"></a><span id="l23.139">     div.setAttribute(&quot;class&quot;, &quot;client&quot;);</span>
<a href="#l23.140"></a><span id="l23.140"> </span>
<a href="#l23.141"></a><span id="l23.141">   div.appendChild(logdoc.createTextNode(msg));</span>
<a href="#l23.142"></a><span id="l23.142" class="difflineminus">-  </span>
<a href="#l23.143"></a><span id="l23.143" class="difflineplus">+</span>
<a href="#l23.144"></a><span id="l23.144">   logdocDiv.appendChild(div);</span>
<a href="#l23.145"></a><span id="l23.145"> </span>
<a href="#l23.146"></a><span id="l23.146">   scrollDown();</span>
<a href="#l23.147"></a><span id="l23.147"> }</span>
<a href="#l23.148"></a><span id="l23.148"> </span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l24.1"></a><span id="l24.1" class="difflineminus">--- a/suite/common/findUtils.js</span>
<a href="#l24.2"></a><span id="l24.2" class="difflineplus">+++ b/suite/common/findUtils.js</span>
<a href="#l24.3"></a><span id="l24.3" class="difflineat">@@ -29,17 +29,17 @@ nsFindInstData.prototype =</span>
<a href="#l24.4"></a><span id="l24.4">   get webBrowserFind() { return this.browser.webBrowserFind; },</span>
<a href="#l24.5"></a><span id="l24.5"> </span>
<a href="#l24.6"></a><span id="l24.6">   init : function() {</span>
<a href="#l24.7"></a><span id="l24.7">     var findInst = this.webBrowserFind;</span>
<a href="#l24.8"></a><span id="l24.8">     // set up the find to search the focussedWindow, bounded by the content window.</span>
<a href="#l24.9"></a><span id="l24.9">     var findInFrames = findInst.QueryInterface(Components.interfaces.nsIWebBrowserFindInFrames);</span>
<a href="#l24.10"></a><span id="l24.10">     findInFrames.rootSearchFrame = this.rootSearchWindow;</span>
<a href="#l24.11"></a><span id="l24.11">     findInFrames.currentSearchFrame = this.currentSearchWindow;</span>
<a href="#l24.12"></a><span id="l24.12" class="difflineminus">-  </span>
<a href="#l24.13"></a><span id="l24.13" class="difflineplus">+</span>
<a href="#l24.14"></a><span id="l24.14">     // always search in frames for now. We could add a checkbox to the dialog for this.</span>
<a href="#l24.15"></a><span id="l24.15">     findInst.searchFrames = true;</span>
<a href="#l24.16"></a><span id="l24.16">   },</span>
<a href="#l24.17"></a><span id="l24.17"> </span>
<a href="#l24.18"></a><span id="l24.18">   window : window,</span>
<a href="#l24.19"></a><span id="l24.19">   _root : null,</span>
<a href="#l24.20"></a><span id="l24.20">   _current : null</span>
<a href="#l24.21"></a><span id="l24.21"> }</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l25.1"></a><span id="l25.1" class="difflineminus">--- a/suite/common/permissions/permissionsManager.js</span>
<a href="#l25.2"></a><span id="l25.2" class="difflineplus">+++ b/suite/common/permissions/permissionsManager.js</span>
<a href="#l25.3"></a><span id="l25.3" class="difflineat">@@ -162,28 +162,28 @@ function capabilityString(aCapability) {</span>
<a href="#l25.4"></a><span id="l25.4">       capability = &quot;cannot&quot;;</span>
<a href="#l25.5"></a><span id="l25.5">       break;</span>
<a href="#l25.6"></a><span id="l25.6">     // we should only ever hit this for cookies</span>
<a href="#l25.7"></a><span id="l25.7">     case nsICookiePermission.ACCESS_SESSION:</span>
<a href="#l25.8"></a><span id="l25.8">       capability = &quot;canSession&quot;;</span>
<a href="#l25.9"></a><span id="l25.9">       break;</span>
<a href="#l25.10"></a><span id="l25.10">     default:</span>
<a href="#l25.11"></a><span id="l25.11">       break;</span>
<a href="#l25.12"></a><span id="l25.12" class="difflineminus">-  } </span>
<a href="#l25.13"></a><span id="l25.13" class="difflineplus">+  }</span>
<a href="#l25.14"></a><span id="l25.14">   return permissionsBundle.getString(capability);</span>
<a href="#l25.15"></a><span id="l25.15"> }</span>
<a href="#l25.16"></a><span id="l25.16"> </span>
<a href="#l25.17"></a><span id="l25.17"> function permissionPush(aId, aHost, aType, aString, aCapability) {</span>
<a href="#l25.18"></a><span id="l25.18">   var rawHost = (aHost.charAt(0) == &quot;.&quot;) ? aHost.substring(1, aHost.length) : aHost;</span>
<a href="#l25.19"></a><span id="l25.19">   var p = new Permission(aId, aHost, rawHost, aType, aString, aCapability);</span>
<a href="#l25.20"></a><span id="l25.20">   additions.push(p);</span>
<a href="#l25.21"></a><span id="l25.21"> }</span>
<a href="#l25.22"></a><span id="l25.22"> </span>
<a href="#l25.23"></a><span id="l25.23"> function permissionColumnSort(aColumn, aUpdateSelection) {</span>
<a href="#l25.24"></a><span id="l25.24" class="difflineminus">-  sortAscending = </span>
<a href="#l25.25"></a><span id="l25.25" class="difflineplus">+  sortAscending =</span>
<a href="#l25.26"></a><span id="l25.26">     SortTree(permissionsTree, permissionsTreeView, additions,</span>
<a href="#l25.27"></a><span id="l25.27">              aColumn, sortColumn, sortAscending, aUpdateSelection);</span>
<a href="#l25.28"></a><span id="l25.28">   sortColumn = aColumn;</span>
<a href="#l25.29"></a><span id="l25.29"> }</span>
<a href="#l25.30"></a><span id="l25.30"> </span>
<a href="#l25.31"></a><span id="l25.31"> function permissionSelected() {</span>
<a href="#l25.32"></a><span id="l25.32">   if (permissionManager) {</span>
<a href="#l25.33"></a><span id="l25.33">     var selections = GetTreeSelections(permissionsTree);</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l26.1"></a><span id="l26.1" class="difflineminus">--- a/suite/common/places/controller.js</span>
<a href="#l26.2"></a><span id="l26.2" class="difflineplus">+++ b/suite/common/places/controller.js</span>
<a href="#l26.3"></a><span id="l26.3" class="difflineat">@@ -185,20 +185,20 @@ PlacesController.prototype = {</span>
<a href="#l26.4"></a><span id="l26.4">     default:</span>
<a href="#l26.5"></a><span id="l26.5">       return false;</span>
<a href="#l26.6"></a><span id="l26.6">     }</span>
<a href="#l26.7"></a><span id="l26.7">   },</span>
<a href="#l26.8"></a><span id="l26.8"> </span>
<a href="#l26.9"></a><span id="l26.9">   doCommand: function PC_doCommand(aCommand) {</span>
<a href="#l26.10"></a><span id="l26.10">     switch (aCommand) {</span>
<a href="#l26.11"></a><span id="l26.11">     case &quot;cmd_undo&quot;:</span>
<a href="#l26.12"></a><span id="l26.12" class="difflineminus">-      PlacesUtils.transactionManager.undoTransaction(); </span>
<a href="#l26.13"></a><span id="l26.13" class="difflineplus">+      PlacesUtils.transactionManager.undoTransaction();</span>
<a href="#l26.14"></a><span id="l26.14">       break;</span>
<a href="#l26.15"></a><span id="l26.15">     case &quot;cmd_redo&quot;:</span>
<a href="#l26.16"></a><span id="l26.16" class="difflineminus">-      PlacesUtils.transactionManager.redoTransaction(); </span>
<a href="#l26.17"></a><span id="l26.17" class="difflineplus">+      PlacesUtils.transactionManager.redoTransaction();</span>
<a href="#l26.18"></a><span id="l26.18">       break;</span>
<a href="#l26.19"></a><span id="l26.19">     case &quot;cmd_cut&quot;:</span>
<a href="#l26.20"></a><span id="l26.20">     case &quot;placesCmd_cut&quot;:</span>
<a href="#l26.21"></a><span id="l26.21">       this.cut();</span>
<a href="#l26.22"></a><span id="l26.22">       break;</span>
<a href="#l26.23"></a><span id="l26.23">     case &quot;cmd_copy&quot;:</span>
<a href="#l26.24"></a><span id="l26.24">     case &quot;placesCmd_copy&quot;:</span>
<a href="#l26.25"></a><span id="l26.25">       this.copy();</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l27.1"></a><span id="l27.1" class="difflineminus">--- a/suite/common/places/tests/browser/browser_library_infoBox.js</span>
<a href="#l27.2"></a><span id="l27.2" class="difflineplus">+++ b/suite/common/places/tests/browser/browser_library_infoBox.js</span>
<a href="#l27.3"></a><span id="l27.3" class="difflineat">@@ -84,17 +84,17 @@ gTests.push({</span>
<a href="#l27.4"></a><span id="l27.4">     };</span>
<a href="#l27.5"></a><span id="l27.5"> </span>
<a href="#l27.6"></a><span id="l27.6">     // Add a visit to browser history</span>
<a href="#l27.7"></a><span id="l27.7">     addVisits(</span>
<a href="#l27.8"></a><span id="l27.8">       { uri: PlacesUtils._uri(TEST_URI),</span>
<a href="#l27.9"></a><span id="l27.9">         visitDate: Date.now()*1000,</span>
<a href="#l27.10"></a><span id="l27.10">         transition: PlacesUtils.history.TRANSITION_TYPED },</span>
<a href="#l27.11"></a><span id="l27.11">       addVisitsCallback);</span>
<a href="#l27.12"></a><span id="l27.12" class="difflineminus">-  } </span>
<a href="#l27.13"></a><span id="l27.13" class="difflineplus">+  }</span>
<a href="#l27.14"></a><span id="l27.14"> });</span>
<a href="#l27.15"></a><span id="l27.15"> </span>
<a href="#l27.16"></a><span id="l27.16"> function checkInfoBoxSelected(PO) {</span>
<a href="#l27.17"></a><span id="l27.17">   is(getAndCheckElmtById(&quot;detailsDeck&quot;).selectedIndex, 1,</span>
<a href="#l27.18"></a><span id="l27.18">      &quot;Selected element in detailsDeck is infoBox.&quot;);</span>
<a href="#l27.19"></a><span id="l27.19"> }</span>
<a href="#l27.20"></a><span id="l27.20"> </span>
<a href="#l27.21"></a><span id="l27.21"> function checkAddInfoFieldsCollapsed(PO) {</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l28.1"></a><span id="l28.1" class="difflineminus">--- a/suite/common/places/tests/browser/browser_library_left_pane_commands.js</span>
<a href="#l28.2"></a><span id="l28.2" class="difflineplus">+++ b/suite/common/places/tests/browser/browser_library_left_pane_commands.js</span>
<a href="#l28.3"></a><span id="l28.3" class="difflineat">@@ -54,17 +54,17 @@ gTests.push({</span>
<a href="#l28.4"></a><span id="l28.4">     ok(PO._places.controller.isCommandEnabled(&quot;cmd_cut&quot;),</span>
<a href="#l28.5"></a><span id="l28.5">        &quot;Cut command is enabled&quot;);</span>
<a href="#l28.6"></a><span id="l28.6">     ok(PO._places.controller.isCommandEnabled(&quot;cmd_delete&quot;),</span>
<a href="#l28.7"></a><span id="l28.7">        &quot;Delete command is enabled&quot;);</span>
<a href="#l28.8"></a><span id="l28.8"> </span>
<a href="#l28.9"></a><span id="l28.9">     // Execute the delete command and check bookmark has been removed.</span>
<a href="#l28.10"></a><span id="l28.10">     PO._places.controller.doCommand(&quot;cmd_delete&quot;);</span>
<a href="#l28.11"></a><span id="l28.11">     try {</span>
<a href="#l28.12"></a><span id="l28.12" class="difflineminus">-      PlacesUtils.bookmarks.getFolderIdForItem(queryNode.itemId);  </span>
<a href="#l28.13"></a><span id="l28.13" class="difflineplus">+      PlacesUtils.bookmarks.getFolderIdForItem(queryNode.itemId);</span>
<a href="#l28.14"></a><span id="l28.14">       ok(false, &quot;Unable to remove query node bookmark&quot;);</span>
<a href="#l28.15"></a><span id="l28.15">     } catch(ex) {</span>
<a href="#l28.16"></a><span id="l28.16">       ok(true, &quot;Query node bookmark has been correctly removed&quot;);</span>
<a href="#l28.17"></a><span id="l28.17">     }</span>
<a href="#l28.18"></a><span id="l28.18"> </span>
<a href="#l28.19"></a><span id="l28.19">     toolbarNode.containerOpen = false;</span>
<a href="#l28.20"></a><span id="l28.20">     nextTest();</span>
<a href="#l28.21"></a><span id="l28.21">   }</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l29.1"></a><span id="l29.1" class="difflineminus">--- a/suite/common/places/tests/unit/test_PUIU_makeTransaction.js</span>
<a href="#l29.2"></a><span id="l29.2" class="difflineplus">+++ b/suite/common/places/tests/unit/test_PUIU_makeTransaction.js</span>
<a href="#l29.3"></a><span id="l29.3" class="difflineat">@@ -1,355 +1,355 @@</span>
<a href="#l29.4"></a><span id="l29.4" class="difflineminus">-/* Any copyright is dedicated to the Public Domain.</span>
<a href="#l29.5"></a><span id="l29.5" class="difflineminus">-   http://creativecommons.org/publicdomain/zero/1.0/ */</span>
<a href="#l29.6"></a><span id="l29.6" class="difflineminus">-</span>
<a href="#l29.7"></a><span id="l29.7" class="difflineminus">-function waitForBookmarkNotification(aNotification, aCallback, aProperty)</span>
<a href="#l29.8"></a><span id="l29.8" class="difflineminus">-{</span>
<a href="#l29.9"></a><span id="l29.9" class="difflineminus">-  PlacesUtils.bookmarks.addObserver({</span>
<a href="#l29.10"></a><span id="l29.10" class="difflineminus">-    validate: function (aMethodName, aData)</span>
<a href="#l29.11"></a><span id="l29.11" class="difflineminus">-    {</span>
<a href="#l29.12"></a><span id="l29.12" class="difflineminus">-      if (aMethodName == aNotification &amp;&amp;</span>
<a href="#l29.13"></a><span id="l29.13" class="difflineminus">-          (!aProperty || aProperty == aData.property)) {</span>
<a href="#l29.14"></a><span id="l29.14" class="difflineminus">-        PlacesUtils.bookmarks.removeObserver(this);</span>
<a href="#l29.15"></a><span id="l29.15" class="difflineminus">-        aCallback(aData);</span>
<a href="#l29.16"></a><span id="l29.16" class="difflineminus">-      }</span>
<a href="#l29.17"></a><span id="l29.17" class="difflineminus">-    },</span>
<a href="#l29.18"></a><span id="l29.18" class="difflineminus">-</span>
<a href="#l29.19"></a><span id="l29.19" class="difflineminus">-    // nsINavBookmarkObserver</span>
<a href="#l29.20"></a><span id="l29.20" class="difflineminus">-    QueryInterface: XPCOMUtils.generateQI([Ci.nsINavBookmarkObserver]),</span>
<a href="#l29.21"></a><span id="l29.21" class="difflineminus">-    onBeginUpdateBatch: function onBeginUpdateBatch() {</span>
<a href="#l29.22"></a><span id="l29.22" class="difflineminus">-      return this.validate(arguments.callee.name, arguments);</span>
<a href="#l29.23"></a><span id="l29.23" class="difflineminus">-    },</span>
<a href="#l29.24"></a><span id="l29.24" class="difflineminus">-    onEndUpdateBatch: function onEndUpdateBatch() {</span>
<a href="#l29.25"></a><span id="l29.25" class="difflineminus">-      return this.validate(arguments.callee.name, arguments);</span>
<a href="#l29.26"></a><span id="l29.26" class="difflineminus">-    },</span>
<a href="#l29.27"></a><span id="l29.27" class="difflineminus">-    onItemAdded: function onItemAdded(aItemId, aParentId, aIndex, aItemType,</span>
<a href="#l29.28"></a><span id="l29.28" class="difflineminus">-                                      aURI, aTitle)</span>
<a href="#l29.29"></a><span id="l29.29" class="difflineminus">-    {</span>
<a href="#l29.30"></a><span id="l29.30" class="difflineminus">-      return this.validate(arguments.callee.name, { id: aItemId,</span>
<a href="#l29.31"></a><span id="l29.31" class="difflineminus">-                                                    index: aIndex,</span>
<a href="#l29.32"></a><span id="l29.32" class="difflineminus">-                                                    type: aItemType,</span>
<a href="#l29.33"></a><span id="l29.33" class="difflineminus">-                                                    url: aURI ? aURI.spec : null,</span>
<a href="#l29.34"></a><span id="l29.34" class="difflineminus">-                                                    title: aTitle });</span>
<a href="#l29.35"></a><span id="l29.35" class="difflineminus">-    },</span>
<a href="#l29.36"></a><span id="l29.36" class="difflineminus">-    onItemRemoved: function onItemRemoved() {</span>
<a href="#l29.37"></a><span id="l29.37" class="difflineminus">-      return this.validate(arguments.callee.name, arguments);</span>
<a href="#l29.38"></a><span id="l29.38" class="difflineminus">-    },</span>
<a href="#l29.39"></a><span id="l29.39" class="difflineminus">-    onItemChanged: function onItemChanged(aItemId, aProperty, aIsAnno,</span>
<a href="#l29.40"></a><span id="l29.40" class="difflineminus">-                                          aNewValue, aLastModified, aItemType)</span>
<a href="#l29.41"></a><span id="l29.41" class="difflineminus">-    {</span>
<a href="#l29.42"></a><span id="l29.42" class="difflineminus">-      return this.validate(arguments.callee.name,</span>
<a href="#l29.43"></a><span id="l29.43" class="difflineminus">-                           { id: aItemId,</span>
<a href="#l29.44"></a><span id="l29.44" class="difflineminus">-                             get index() { return PlacesUtils.bookmarks.getItemIndex(this.id); },</span>
<a href="#l29.45"></a><span id="l29.45" class="difflineminus">-                             type: aItemType,</span>
<a href="#l29.46"></a><span id="l29.46" class="difflineminus">-                             property: aProperty,</span>
<a href="#l29.47"></a><span id="l29.47" class="difflineminus">-                             get url() { return aItemType == PlacesUtils.bookmarks.TYPE_BOOKMARK ?</span>
<a href="#l29.48"></a><span id="l29.48" class="difflineminus">-                                                PlacesUtils.bookmarks.getBookmarkURI(this.id).spec :</span>
<a href="#l29.49"></a><span id="l29.49" class="difflineminus">-                                                null; },</span>
<a href="#l29.50"></a><span id="l29.50" class="difflineminus">-                             get title() { return PlacesUtils.bookmarks.getItemTitle(this.id); },</span>
<a href="#l29.51"></a><span id="l29.51" class="difflineminus">-                           });</span>
<a href="#l29.52"></a><span id="l29.52" class="difflineminus">-    },</span>
<a href="#l29.53"></a><span id="l29.53" class="difflineminus">-    onItemVisited: function onItemVisited() {</span>
<a href="#l29.54"></a><span id="l29.54" class="difflineminus">-      return this.validate(arguments.callee.name, arguments);</span>
<a href="#l29.55"></a><span id="l29.55" class="difflineminus">-    },</span>
<a href="#l29.56"></a><span id="l29.56" class="difflineminus">-    onItemMoved: function onItemMoved(aItemId, aOldParentId, aOldIndex,</span>
<a href="#l29.57"></a><span id="l29.57" class="difflineminus">-                                      aNewParentId, aNewIndex, aItemType)</span>
<a href="#l29.58"></a><span id="l29.58" class="difflineminus">-    {</span>
<a href="#l29.59"></a><span id="l29.59" class="difflineminus">-      this.validate(arguments.callee.name, { id: aItemId,</span>
<a href="#l29.60"></a><span id="l29.60" class="difflineminus">-                                             index: aNewIndex,</span>
<a href="#l29.61"></a><span id="l29.61" class="difflineminus">-                                             type: aItemType });</span>
<a href="#l29.62"></a><span id="l29.62" class="difflineminus">-    }</span>
<a href="#l29.63"></a><span id="l29.63" class="difflineminus">-  }, false);</span>
<a href="#l29.64"></a><span id="l29.64" class="difflineminus">-}</span>
<a href="#l29.65"></a><span id="l29.65" class="difflineminus">-</span>
<a href="#l29.66"></a><span id="l29.66" class="difflineminus">-function wrapNodeByIdAndParent(aItemId, aParentId)</span>
<a href="#l29.67"></a><span id="l29.67" class="difflineminus">-{</span>
<a href="#l29.68"></a><span id="l29.68" class="difflineminus">-  let wrappedNode;</span>
<a href="#l29.69"></a><span id="l29.69" class="difflineminus">-  let root = PlacesUtils.getFolderContents(aParentId, false, false).root;</span>
<a href="#l29.70"></a><span id="l29.70" class="difflineminus">-  for (let i = 0; i &lt; root.childCount; ++i) {</span>
<a href="#l29.71"></a><span id="l29.71" class="difflineminus">-    let node = root.getChild(i);</span>
<a href="#l29.72"></a><span id="l29.72" class="difflineminus">-    if (node.itemId == aItemId) {</span>
<a href="#l29.73"></a><span id="l29.73" class="difflineminus">-      let type;</span>
<a href="#l29.74"></a><span id="l29.74" class="difflineminus">-      if (PlacesUtils.nodeIsContainer(node)) {</span>
<a href="#l29.75"></a><span id="l29.75" class="difflineminus">-        type = PlacesUtils.TYPE_X_MOZ_PLACE_CONTAINER;</span>
<a href="#l29.76"></a><span id="l29.76" class="difflineminus">-      }</span>
<a href="#l29.77"></a><span id="l29.77" class="difflineminus">-      else if (PlacesUtils.nodeIsURI(node)) {</span>
<a href="#l29.78"></a><span id="l29.78" class="difflineminus">-        type = PlacesUtils.TYPE_X_MOZ_PLACE;</span>
<a href="#l29.79"></a><span id="l29.79" class="difflineminus">-      }</span>
<a href="#l29.80"></a><span id="l29.80" class="difflineminus">-      else if (PlacesUtils.nodeIsSeparator(node)) {</span>
<a href="#l29.81"></a><span id="l29.81" class="difflineminus">-        type = PlacesUtils.TYPE_X_MOZ_PLACE_SEPARATOR;</span>
<a href="#l29.82"></a><span id="l29.82" class="difflineminus">-      }</span>
<a href="#l29.83"></a><span id="l29.83" class="difflineminus">-      else {</span>
<a href="#l29.84"></a><span id="l29.84" class="difflineminus">-        do_throw(&quot;Unknown node type&quot;);</span>
<a href="#l29.85"></a><span id="l29.85" class="difflineminus">-      }</span>
<a href="#l29.86"></a><span id="l29.86" class="difflineminus">-      wrappedNode = PlacesUtils.wrapNode(node, type);</span>
<a href="#l29.87"></a><span id="l29.87" class="difflineminus">-    }</span>
<a href="#l29.88"></a><span id="l29.88" class="difflineminus">-  }</span>
<a href="#l29.89"></a><span id="l29.89" class="difflineminus">-  root.containerOpen = false;</span>
<a href="#l29.90"></a><span id="l29.90" class="difflineminus">-  return JSON.parse(wrappedNode);</span>
<a href="#l29.91"></a><span id="l29.91" class="difflineminus">-}</span>
<a href="#l29.92"></a><span id="l29.92" class="difflineminus">-</span>
<a href="#l29.93"></a><span id="l29.93" class="difflineminus">-add_test(function test_text_paste()</span>
<a href="#l29.94"></a><span id="l29.94" class="difflineminus">-{</span>
<a href="#l29.95"></a><span id="l29.95" class="difflineminus">-  const TEST_URL = &quot;http://places.moz.org/&quot;</span>
<a href="#l29.96"></a><span id="l29.96" class="difflineminus">-  const TEST_TITLE = &quot;Places bookmark&quot;</span>
<a href="#l29.97"></a><span id="l29.97" class="difflineminus">-</span>
<a href="#l29.98"></a><span id="l29.98" class="difflineminus">-  waitForBookmarkNotification(&quot;onItemAdded&quot;, function(aData)</span>
<a href="#l29.99"></a><span id="l29.99" class="difflineminus">-  {</span>
<a href="#l29.100"></a><span id="l29.100" class="difflineminus">-    do_check_eq(aData.title, TEST_TITLE);</span>
<a href="#l29.101"></a><span id="l29.101" class="difflineminus">-    do_check_eq(aData.url, TEST_URL);</span>
<a href="#l29.102"></a><span id="l29.102" class="difflineminus">-    do_check_eq(aData.type, PlacesUtils.bookmarks.TYPE_BOOKMARK);</span>
<a href="#l29.103"></a><span id="l29.103" class="difflineminus">-    do_check_eq(aData.index, 0);</span>
<a href="#l29.104"></a><span id="l29.104" class="difflineminus">-    run_next_test();</span>
<a href="#l29.105"></a><span id="l29.105" class="difflineminus">-  });</span>
<a href="#l29.106"></a><span id="l29.106" class="difflineminus">-</span>
<a href="#l29.107"></a><span id="l29.107" class="difflineminus">-  let txn = PlacesUIUtils.makeTransaction(</span>
<a href="#l29.108"></a><span id="l29.108" class="difflineminus">-    { title: TEST_TITLE, uri: TEST_URL },</span>
<a href="#l29.109"></a><span id="l29.109" class="difflineminus">-    PlacesUtils.TYPE_X_MOZ_URL,</span>
<a href="#l29.110"></a><span id="l29.110" class="difflineminus">-    PlacesUtils.unfiledBookmarksFolderId,</span>
<a href="#l29.111"></a><span id="l29.111" class="difflineminus">-    PlacesUtils.bookmarks.DEFAULT_INDEX,</span>
<a href="#l29.112"></a><span id="l29.112" class="difflineminus">-    true // Unused for text.</span>
<a href="#l29.113"></a><span id="l29.113" class="difflineminus">-  );</span>
<a href="#l29.114"></a><span id="l29.114" class="difflineminus">-  PlacesUtils.transactionManager.doTransaction(txn);</span>
<a href="#l29.115"></a><span id="l29.115" class="difflineminus">-});</span>
<a href="#l29.116"></a><span id="l29.116" class="difflineminus">-</span>
<a href="#l29.117"></a><span id="l29.117" class="difflineminus">-add_test(function test_container()</span>
<a href="#l29.118"></a><span id="l29.118" class="difflineminus">-{</span>
<a href="#l29.119"></a><span id="l29.119" class="difflineminus">-  const TEST_TITLE = &quot;Places folder&quot;</span>
<a href="#l29.120"></a><span id="l29.120" class="difflineminus">-</span>
<a href="#l29.121"></a><span id="l29.121" class="difflineminus">-  waitForBookmarkNotification(&quot;onItemChanged&quot;, function(aData)</span>
<a href="#l29.122"></a><span id="l29.122" class="difflineminus">-  {</span>
<a href="#l29.123"></a><span id="l29.123" class="difflineminus">-    do_check_eq(aData.title, TEST_TITLE);</span>
<a href="#l29.124"></a><span id="l29.124" class="difflineminus">-    do_check_eq(aData.type, PlacesUtils.bookmarks.TYPE_FOLDER);</span>
<a href="#l29.125"></a><span id="l29.125" class="difflineminus">-    do_check_eq(aData.index, 1);</span>
<a href="#l29.126"></a><span id="l29.126" class="difflineminus">-</span>
<a href="#l29.127"></a><span id="l29.127" class="difflineminus">-    waitForBookmarkNotification(&quot;onItemAdded&quot;, function(aData)</span>
<a href="#l29.128"></a><span id="l29.128" class="difflineminus">-    {</span>
<a href="#l29.129"></a><span id="l29.129" class="difflineminus">-      do_check_eq(aData.title, TEST_TITLE);</span>
<a href="#l29.130"></a><span id="l29.130" class="difflineminus">-      do_check_eq(aData.type, PlacesUtils.bookmarks.TYPE_FOLDER);</span>
<a href="#l29.131"></a><span id="l29.131" class="difflineminus">-      do_check_eq(aData.index, 2);</span>
<a href="#l29.132"></a><span id="l29.132" class="difflineminus">-      let id = aData.id;</span>
<a href="#l29.133"></a><span id="l29.133" class="difflineminus">-</span>
<a href="#l29.134"></a><span id="l29.134" class="difflineminus">-      waitForBookmarkNotification(&quot;onItemMoved&quot;, function(aData)</span>
<a href="#l29.135"></a><span id="l29.135" class="difflineminus">-      {</span>
<a href="#l29.136"></a><span id="l29.136" class="difflineminus">-        do_check_eq(aData.id, id);</span>
<a href="#l29.137"></a><span id="l29.137" class="difflineminus">-        do_check_eq(aData.type, PlacesUtils.bookmarks.TYPE_FOLDER);</span>
<a href="#l29.138"></a><span id="l29.138" class="difflineminus">-        do_check_eq(aData.index, 1);</span>
<a href="#l29.139"></a><span id="l29.139" class="difflineminus">-</span>
<a href="#l29.140"></a><span id="l29.140" class="difflineminus">-        run_next_test();</span>
<a href="#l29.141"></a><span id="l29.141" class="difflineminus">-      });</span>
<a href="#l29.142"></a><span id="l29.142" class="difflineminus">-</span>
<a href="#l29.143"></a><span id="l29.143" class="difflineminus">-      let txn = PlacesUIUtils.makeTransaction(</span>
<a href="#l29.144"></a><span id="l29.144" class="difflineminus">-        wrapNodeByIdAndParent(aData.id, PlacesUtils.unfiledBookmarksFolderId),</span>
<a href="#l29.145"></a><span id="l29.145" class="difflineminus">-        0, // Unused for real nodes.</span>
<a href="#l29.146"></a><span id="l29.146" class="difflineminus">-        PlacesUtils.unfiledBookmarksFolderId,</span>
<a href="#l29.147"></a><span id="l29.147" class="difflineminus">-        1, // Move to position 1.</span>
<a href="#l29.148"></a><span id="l29.148" class="difflineminus">-        false</span>
<a href="#l29.149"></a><span id="l29.149" class="difflineminus">-      );</span>
<a href="#l29.150"></a><span id="l29.150" class="difflineminus">-      PlacesUtils.transactionManager.doTransaction(txn);</span>
<a href="#l29.151"></a><span id="l29.151" class="difflineminus">-    });</span>
<a href="#l29.152"></a><span id="l29.152" class="difflineminus">-</span>
<a href="#l29.153"></a><span id="l29.153" class="difflineminus">-    try {</span>
<a href="#l29.154"></a><span id="l29.154" class="difflineminus">-    let txn = PlacesUIUtils.makeTransaction(</span>
<a href="#l29.155"></a><span id="l29.155" class="difflineminus">-      wrapNodeByIdAndParent(aData.id, PlacesUtils.unfiledBookmarksFolderId),</span>
<a href="#l29.156"></a><span id="l29.156" class="difflineminus">-      0, // Unused for real nodes.</span>
<a href="#l29.157"></a><span id="l29.157" class="difflineminus">-      PlacesUtils.unfiledBookmarksFolderId,</span>
<a href="#l29.158"></a><span id="l29.158" class="difflineminus">-      PlacesUtils.bookmarks.DEFAULT_INDEX,</span>
<a href="#l29.159"></a><span id="l29.159" class="difflineminus">-      true</span>
<a href="#l29.160"></a><span id="l29.160" class="difflineminus">-    );</span>
<a href="#l29.161"></a><span id="l29.161" class="difflineminus">-    PlacesUtils.transactionManager.doTransaction(txn);</span>
<a href="#l29.162"></a><span id="l29.162" class="difflineminus">-    } catch(ex) {</span>
<a href="#l29.163"></a><span id="l29.163" class="difflineminus">-      do_throw(ex);</span>
<a href="#l29.164"></a><span id="l29.164" class="difflineminus">-    }</span>
<a href="#l29.165"></a><span id="l29.165" class="difflineminus">-  }, &quot;random-anno&quot;);</span>
<a href="#l29.166"></a><span id="l29.166" class="difflineminus">-</span>
<a href="#l29.167"></a><span id="l29.167" class="difflineminus">-  let id = PlacesUtils.bookmarks.createFolder(PlacesUtils.unfiledBookmarksFolderId,</span>
<a href="#l29.168"></a><span id="l29.168" class="difflineminus">-                                              TEST_TITLE,</span>
<a href="#l29.169"></a><span id="l29.169" class="difflineminus">-                                              PlacesUtils.bookmarks.DEFAULT_INDEX);</span>
<a href="#l29.170"></a><span id="l29.170" class="difflineminus">-  PlacesUtils.annotations.setItemAnnotation(id, PlacesUIUtils.DESCRIPTION_ANNO,</span>
<a href="#l29.171"></a><span id="l29.171" class="difflineminus">-                                            &quot;description&quot;, 0,</span>
<a href="#l29.172"></a><span id="l29.172" class="difflineminus">-                                            PlacesUtils.annotations.EXPIRE_NEVER);</span>
<a href="#l29.173"></a><span id="l29.173" class="difflineminus">-  PlacesUtils.annotations.setItemAnnotation(id, &quot;random-anno&quot;,</span>
<a href="#l29.174"></a><span id="l29.174" class="difflineminus">-                                            &quot;random-value&quot;, 0,</span>
<a href="#l29.175"></a><span id="l29.175" class="difflineminus">-                                            PlacesUtils.annotations.EXPIRE_NEVER);</span>
<a href="#l29.176"></a><span id="l29.176" class="difflineminus">-});</span>
<a href="#l29.177"></a><span id="l29.177" class="difflineminus">-</span>
<a href="#l29.178"></a><span id="l29.178" class="difflineminus">-</span>
<a href="#l29.179"></a><span id="l29.179" class="difflineminus">-add_test(function test_separator()</span>
<a href="#l29.180"></a><span id="l29.180" class="difflineminus">-{</span>
<a href="#l29.181"></a><span id="l29.181" class="difflineminus">-  waitForBookmarkNotification(&quot;onItemChanged&quot;, function(aData)</span>
<a href="#l29.182"></a><span id="l29.182" class="difflineminus">-  {</span>
<a href="#l29.183"></a><span id="l29.183" class="difflineminus">-    do_check_eq(aData.type, PlacesUtils.bookmarks.TYPE_SEPARATOR);</span>
<a href="#l29.184"></a><span id="l29.184" class="difflineminus">-    do_check_eq(aData.index, 3);</span>
<a href="#l29.185"></a><span id="l29.185" class="difflineminus">-</span>
<a href="#l29.186"></a><span id="l29.186" class="difflineminus">-    waitForBookmarkNotification(&quot;onItemAdded&quot;, function(aData)</span>
<a href="#l29.187"></a><span id="l29.187" class="difflineminus">-    {</span>
<a href="#l29.188"></a><span id="l29.188" class="difflineminus">-      do_check_eq(aData.type, PlacesUtils.bookmarks.TYPE_SEPARATOR);</span>
<a href="#l29.189"></a><span id="l29.189" class="difflineminus">-      do_check_eq(aData.index, 4);</span>
<a href="#l29.190"></a><span id="l29.190" class="difflineminus">-      let id = aData.id;</span>
<a href="#l29.191"></a><span id="l29.191" class="difflineminus">-</span>
<a href="#l29.192"></a><span id="l29.192" class="difflineminus">-      waitForBookmarkNotification(&quot;onItemMoved&quot;, function(aData)</span>
<a href="#l29.193"></a><span id="l29.193" class="difflineminus">-      {</span>
<a href="#l29.194"></a><span id="l29.194" class="difflineminus">-        do_check_eq(aData.id, id);</span>
<a href="#l29.195"></a><span id="l29.195" class="difflineminus">-        do_check_eq(aData.type, PlacesUtils.bookmarks.TYPE_SEPARATOR);</span>
<a href="#l29.196"></a><span id="l29.196" class="difflineminus">-        do_check_eq(aData.index, 1);</span>
<a href="#l29.197"></a><span id="l29.197" class="difflineminus">-</span>
<a href="#l29.198"></a><span id="l29.198" class="difflineminus">-        run_next_test();</span>
<a href="#l29.199"></a><span id="l29.199" class="difflineminus">-      });</span>
<a href="#l29.200"></a><span id="l29.200" class="difflineminus">-</span>
<a href="#l29.201"></a><span id="l29.201" class="difflineminus">-      let txn = PlacesUIUtils.makeTransaction(</span>
<a href="#l29.202"></a><span id="l29.202" class="difflineminus">-        wrapNodeByIdAndParent(aData.id, PlacesUtils.unfiledBookmarksFolderId),</span>
<a href="#l29.203"></a><span id="l29.203" class="difflineminus">-        0, // Unused for real nodes.</span>
<a href="#l29.204"></a><span id="l29.204" class="difflineminus">-        PlacesUtils.unfiledBookmarksFolderId,</span>
<a href="#l29.205"></a><span id="l29.205" class="difflineminus">-        1, // Move to position 1.</span>
<a href="#l29.206"></a><span id="l29.206" class="difflineminus">-        false</span>
<a href="#l29.207"></a><span id="l29.207" class="difflineminus">-      );</span>
<a href="#l29.208"></a><span id="l29.208" class="difflineminus">-      PlacesUtils.transactionManager.doTransaction(txn);</span>
<a href="#l29.209"></a><span id="l29.209" class="difflineminus">-    });</span>
<a href="#l29.210"></a><span id="l29.210" class="difflineminus">-</span>
<a href="#l29.211"></a><span id="l29.211" class="difflineminus">-    try {</span>
<a href="#l29.212"></a><span id="l29.212" class="difflineminus">-    let txn = PlacesUIUtils.makeTransaction(</span>
<a href="#l29.213"></a><span id="l29.213" class="difflineminus">-      wrapNodeByIdAndParent(aData.id, PlacesUtils.unfiledBookmarksFolderId),</span>
<a href="#l29.214"></a><span id="l29.214" class="difflineminus">-      0, // Unused for real nodes.</span>
<a href="#l29.215"></a><span id="l29.215" class="difflineminus">-      PlacesUtils.unfiledBookmarksFolderId,</span>
<a href="#l29.216"></a><span id="l29.216" class="difflineminus">-      PlacesUtils.bookmarks.DEFAULT_INDEX,</span>
<a href="#l29.217"></a><span id="l29.217" class="difflineminus">-      true</span>
<a href="#l29.218"></a><span id="l29.218" class="difflineminus">-    );</span>
<a href="#l29.219"></a><span id="l29.219" class="difflineminus">-    PlacesUtils.transactionManager.doTransaction(txn);</span>
<a href="#l29.220"></a><span id="l29.220" class="difflineminus">-    } catch(ex) {</span>
<a href="#l29.221"></a><span id="l29.221" class="difflineminus">-      do_throw(ex);</span>
<a href="#l29.222"></a><span id="l29.222" class="difflineminus">-    }</span>
<a href="#l29.223"></a><span id="l29.223" class="difflineminus">-  }, &quot;random-anno&quot;);</span>
<a href="#l29.224"></a><span id="l29.224" class="difflineminus">-</span>
<a href="#l29.225"></a><span id="l29.225" class="difflineminus">-  let id = PlacesUtils.bookmarks.insertSeparator(PlacesUtils.unfiledBookmarksFolderId,</span>
<a href="#l29.226"></a><span id="l29.226" class="difflineminus">-                                                 PlacesUtils.bookmarks.DEFAULT_INDEX);</span>
<a href="#l29.227"></a><span id="l29.227" class="difflineminus">-  PlacesUtils.annotations.setItemAnnotation(id, &quot;random-anno&quot;,</span>
<a href="#l29.228"></a><span id="l29.228" class="difflineminus">-                                            &quot;random-value&quot;, 0, </span>
<a href="#l29.229"></a><span id="l29.229" class="difflineminus">-                                            PlacesUtils.annotations.EXPIRE_NEVER);</span>
<a href="#l29.230"></a><span id="l29.230" class="difflineminus">-});</span>
<a href="#l29.231"></a><span id="l29.231" class="difflineminus">-</span>
<a href="#l29.232"></a><span id="l29.232" class="difflineminus">-add_test(function test_bookmark()</span>
<a href="#l29.233"></a><span id="l29.233" class="difflineminus">-{</span>
<a href="#l29.234"></a><span id="l29.234" class="difflineminus">-  const TEST_URL = &quot;http://places.moz.org/&quot;</span>
<a href="#l29.235"></a><span id="l29.235" class="difflineminus">-  const TEST_TITLE = &quot;Places bookmark&quot;</span>
<a href="#l29.236"></a><span id="l29.236" class="difflineminus">-</span>
<a href="#l29.237"></a><span id="l29.237" class="difflineminus">-  waitForBookmarkNotification(&quot;onItemChanged&quot;, function(aData)</span>
<a href="#l29.238"></a><span id="l29.238" class="difflineminus">-  {</span>
<a href="#l29.239"></a><span id="l29.239" class="difflineminus">-    do_check_eq(aData.title, TEST_TITLE);</span>
<a href="#l29.240"></a><span id="l29.240" class="difflineminus">-    do_check_eq(aData.url, TEST_URL);</span>
<a href="#l29.241"></a><span id="l29.241" class="difflineminus">-    do_check_eq(aData.type, PlacesUtils.bookmarks.TYPE_BOOKMARK);</span>
<a href="#l29.242"></a><span id="l29.242" class="difflineminus">-    do_check_eq(aData.index, 5);</span>
<a href="#l29.243"></a><span id="l29.243" class="difflineminus">-</span>
<a href="#l29.244"></a><span id="l29.244" class="difflineminus">-    waitForBookmarkNotification(&quot;onItemAdded&quot;, function(aData)</span>
<a href="#l29.245"></a><span id="l29.245" class="difflineminus">-    {</span>
<a href="#l29.246"></a><span id="l29.246" class="difflineminus">-      do_check_eq(aData.title, TEST_TITLE);</span>
<a href="#l29.247"></a><span id="l29.247" class="difflineminus">-      do_check_eq(aData.url, TEST_URL);</span>
<a href="#l29.248"></a><span id="l29.248" class="difflineminus">-      do_check_eq(aData.type, PlacesUtils.bookmarks.TYPE_BOOKMARK);</span>
<a href="#l29.249"></a><span id="l29.249" class="difflineminus">-      do_check_eq(aData.index, 6);</span>
<a href="#l29.250"></a><span id="l29.250" class="difflineminus">-      let id = aData.id;</span>
<a href="#l29.251"></a><span id="l29.251" class="difflineminus">-</span>
<a href="#l29.252"></a><span id="l29.252" class="difflineminus">-      waitForBookmarkNotification(&quot;onItemMoved&quot;, function(aData)</span>
<a href="#l29.253"></a><span id="l29.253" class="difflineminus">-      {</span>
<a href="#l29.254"></a><span id="l29.254" class="difflineminus">-        do_check_eq(aData.id, id);</span>
<a href="#l29.255"></a><span id="l29.255" class="difflineminus">-        do_check_eq(aData.type, PlacesUtils.bookmarks.TYPE_BOOKMARK);</span>
<a href="#l29.256"></a><span id="l29.256" class="difflineminus">-        do_check_eq(aData.index, 1);</span>
<a href="#l29.257"></a><span id="l29.257" class="difflineminus">-</span>
<a href="#l29.258"></a><span id="l29.258" class="difflineminus">-        run_next_test();</span>
<a href="#l29.259"></a><span id="l29.259" class="difflineminus">-      });</span>
<a href="#l29.260"></a><span id="l29.260" class="difflineminus">-</span>
<a href="#l29.261"></a><span id="l29.261" class="difflineminus">-      let txn = PlacesUIUtils.makeTransaction(</span>
<a href="#l29.262"></a><span id="l29.262" class="difflineminus">-        wrapNodeByIdAndParent(aData.id, PlacesUtils.unfiledBookmarksFolderId),</span>
<a href="#l29.263"></a><span id="l29.263" class="difflineminus">-        0, // Unused for real nodes.</span>
<a href="#l29.264"></a><span id="l29.264" class="difflineminus">-        PlacesUtils.unfiledBookmarksFolderId,</span>
<a href="#l29.265"></a><span id="l29.265" class="difflineminus">-        1, // Move to position 1.</span>
<a href="#l29.266"></a><span id="l29.266" class="difflineminus">-        false</span>
<a href="#l29.267"></a><span id="l29.267" class="difflineminus">-      );</span>
<a href="#l29.268"></a><span id="l29.268" class="difflineminus">-      PlacesUtils.transactionManager.doTransaction(txn);</span>
<a href="#l29.269"></a><span id="l29.269" class="difflineminus">-    });</span>
<a href="#l29.270"></a><span id="l29.270" class="difflineminus">-</span>
<a href="#l29.271"></a><span id="l29.271" class="difflineminus">-    try {</span>
<a href="#l29.272"></a><span id="l29.272" class="difflineminus">-    let txn = PlacesUIUtils.makeTransaction(</span>
<a href="#l29.273"></a><span id="l29.273" class="difflineminus">-      wrapNodeByIdAndParent(aData.id, PlacesUtils.unfiledBookmarksFolderId),</span>
<a href="#l29.274"></a><span id="l29.274" class="difflineminus">-      0, // Unused for real nodes.</span>
<a href="#l29.275"></a><span id="l29.275" class="difflineminus">-      PlacesUtils.unfiledBookmarksFolderId,</span>
<a href="#l29.276"></a><span id="l29.276" class="difflineminus">-      PlacesUtils.bookmarks.DEFAULT_INDEX,</span>
<a href="#l29.277"></a><span id="l29.277" class="difflineminus">-      true</span>
<a href="#l29.278"></a><span id="l29.278" class="difflineminus">-    );</span>
<a href="#l29.279"></a><span id="l29.279" class="difflineminus">-    PlacesUtils.transactionManager.doTransaction(txn);</span>
<a href="#l29.280"></a><span id="l29.280" class="difflineminus">-    } catch(ex) {</span>
<a href="#l29.281"></a><span id="l29.281" class="difflineminus">-      do_throw(ex);</span>
<a href="#l29.282"></a><span id="l29.282" class="difflineminus">-    }</span>
<a href="#l29.283"></a><span id="l29.283" class="difflineminus">-  }, &quot;random-anno&quot;);</span>
<a href="#l29.284"></a><span id="l29.284" class="difflineminus">-</span>
<a href="#l29.285"></a><span id="l29.285" class="difflineminus">-  let id = PlacesUtils.bookmarks.insertBookmark(PlacesUtils.unfiledBookmarksFolderId,</span>
<a href="#l29.286"></a><span id="l29.286" class="difflineminus">-                                                NetUtil.newURI(TEST_URL),</span>
<a href="#l29.287"></a><span id="l29.287" class="difflineminus">-                                                PlacesUtils.bookmarks.DEFAULT_INDEX,</span>
<a href="#l29.288"></a><span id="l29.288" class="difflineminus">-                                                TEST_TITLE);</span>
<a href="#l29.289"></a><span id="l29.289" class="difflineminus">-  PlacesUtils.annotations.setItemAnnotation(id, PlacesUIUtils.DESCRIPTION_ANNO,</span>
<a href="#l29.290"></a><span id="l29.290" class="difflineminus">-                                            &quot;description&quot;, 0,</span>
<a href="#l29.291"></a><span id="l29.291" class="difflineminus">-                                            PlacesUtils.annotations.EXPIRE_NEVER);</span>
<a href="#l29.292"></a><span id="l29.292" class="difflineminus">-  PlacesUtils.annotations.setItemAnnotation(id, &quot;random-anno&quot;,</span>
<a href="#l29.293"></a><span id="l29.293" class="difflineminus">-                                            &quot;random-value&quot;, 0,</span>
<a href="#l29.294"></a><span id="l29.294" class="difflineminus">-                                            PlacesUtils.annotations.EXPIRE_NEVER);</span>
<a href="#l29.295"></a><span id="l29.295" class="difflineminus">-});</span>
<a href="#l29.296"></a><span id="l29.296" class="difflineminus">-</span>
<a href="#l29.297"></a><span id="l29.297" class="difflineminus">-add_test(function test_visit()</span>
<a href="#l29.298"></a><span id="l29.298" class="difflineminus">-{</span>
<a href="#l29.299"></a><span id="l29.299" class="difflineminus">-  const TEST_URL = &quot;http://places.moz.org/&quot;</span>
<a href="#l29.300"></a><span id="l29.300" class="difflineminus">-  const TEST_TITLE = &quot;Places bookmark&quot;</span>
<a href="#l29.301"></a><span id="l29.301" class="difflineminus">-</span>
<a href="#l29.302"></a><span id="l29.302" class="difflineminus">-  waitForBookmarkNotification(&quot;onItemAdded&quot;, function(aData)</span>
<a href="#l29.303"></a><span id="l29.303" class="difflineminus">-  {</span>
<a href="#l29.304"></a><span id="l29.304" class="difflineminus">-    do_check_eq(aData.title, TEST_TITLE);</span>
<a href="#l29.305"></a><span id="l29.305" class="difflineminus">-    do_check_eq(aData.url, TEST_URL);</span>
<a href="#l29.306"></a><span id="l29.306" class="difflineminus">-    do_check_eq(aData.type, PlacesUtils.bookmarks.TYPE_BOOKMARK);</span>
<a href="#l29.307"></a><span id="l29.307" class="difflineminus">-    do_check_eq(aData.index, 7);</span>
<a href="#l29.308"></a><span id="l29.308" class="difflineminus">-</span>
<a href="#l29.309"></a><span id="l29.309" class="difflineminus">-    waitForBookmarkNotification(&quot;onItemAdded&quot;, function(aData)</span>
<a href="#l29.310"></a><span id="l29.310" class="difflineminus">-    {</span>
<a href="#l29.311"></a><span id="l29.311" class="difflineminus">-      do_check_eq(aData.title, TEST_TITLE);</span>
<a href="#l29.312"></a><span id="l29.312" class="difflineminus">-      do_check_eq(aData.url, TEST_URL);</span>
<a href="#l29.313"></a><span id="l29.313" class="difflineminus">-      do_check_eq(aData.type, PlacesUtils.bookmarks.TYPE_BOOKMARK);</span>
<a href="#l29.314"></a><span id="l29.314" class="difflineminus">-      do_check_eq(aData.index, 8);</span>
<a href="#l29.315"></a><span id="l29.315" class="difflineminus">-      run_next_test();</span>
<a href="#l29.316"></a><span id="l29.316" class="difflineminus">-    });</span>
<a href="#l29.317"></a><span id="l29.317" class="difflineminus">-</span>
<a href="#l29.318"></a><span id="l29.318" class="difflineminus">-    try {</span>
<a href="#l29.319"></a><span id="l29.319" class="difflineminus">-    let node = wrapNodeByIdAndParent(aData.id, PlacesUtils.unfiledBookmarksFolderId);</span>
<a href="#l29.320"></a><span id="l29.320" class="difflineminus">-    // Simulate a not-bookmarked node, will copy it to a new bookmark.</span>
<a href="#l29.321"></a><span id="l29.321" class="difflineminus">-    node.id = -1;</span>
<a href="#l29.322"></a><span id="l29.322" class="difflineminus">-    let txn = PlacesUIUtils.makeTransaction(</span>
<a href="#l29.323"></a><span id="l29.323" class="difflineminus">-      node,</span>
<a href="#l29.324"></a><span id="l29.324" class="difflineminus">-      0, // Unused for real nodes.</span>
<a href="#l29.325"></a><span id="l29.325" class="difflineminus">-      PlacesUtils.unfiledBookmarksFolderId,</span>
<a href="#l29.326"></a><span id="l29.326" class="difflineminus">-      PlacesUtils.bookmarks.DEFAULT_INDEX,</span>
<a href="#l29.327"></a><span id="l29.327" class="difflineminus">-      true</span>
<a href="#l29.328"></a><span id="l29.328" class="difflineminus">-    );</span>
<a href="#l29.329"></a><span id="l29.329" class="difflineminus">-    PlacesUtils.transactionManager.doTransaction(txn);</span>
<a href="#l29.330"></a><span id="l29.330" class="difflineminus">-    } catch(ex) {</span>
<a href="#l29.331"></a><span id="l29.331" class="difflineminus">-      do_throw(ex);</span>
<a href="#l29.332"></a><span id="l29.332" class="difflineminus">-    }</span>
<a href="#l29.333"></a><span id="l29.333" class="difflineminus">-  });</span>
<a href="#l29.334"></a><span id="l29.334" class="difflineminus">-</span>
<a href="#l29.335"></a><span id="l29.335" class="difflineminus">-  PlacesUtils.bookmarks.insertBookmark(PlacesUtils.unfiledBookmarksFolderId,</span>
<a href="#l29.336"></a><span id="l29.336" class="difflineminus">-                                       NetUtil.newURI(TEST_URL),</span>
<a href="#l29.337"></a><span id="l29.337" class="difflineminus">-                                       PlacesUtils.bookmarks.DEFAULT_INDEX,</span>
<a href="#l29.338"></a><span id="l29.338" class="difflineminus">-                                       TEST_TITLE);</span>
<a href="#l29.339"></a><span id="l29.339" class="difflineminus">-});</span>
<a href="#l29.340"></a><span id="l29.340" class="difflineminus">-</span>
<a href="#l29.341"></a><span id="l29.341" class="difflineminus">-add_test(function check_annotations() {</span>
<a href="#l29.342"></a><span id="l29.342" class="difflineminus">-  // As last step check how many items for each annotation exist.</span>
<a href="#l29.343"></a><span id="l29.343" class="difflineminus">-</span>
<a href="#l29.344"></a><span id="l29.344" class="difflineminus">-  // Copies should retain the description annotation.</span>
<a href="#l29.345"></a><span id="l29.345" class="difflineminus">-  let descriptions =</span>
<a href="#l29.346"></a><span id="l29.346" class="difflineminus">-    PlacesUtils.annotations.getItemsWithAnnotation(PlacesUIUtils.DESCRIPTION_ANNO, {});</span>
<a href="#l29.347"></a><span id="l29.347" class="difflineminus">-  do_check_eq(descriptions.length, 4);</span>
<a href="#l29.348"></a><span id="l29.348" class="difflineminus">-</span>
<a href="#l29.349"></a><span id="l29.349" class="difflineminus">-  // Only the original bookmarks should have this annotation.</span>
<a href="#l29.350"></a><span id="l29.350" class="difflineminus">-  let others = PlacesUtils.annotations.getItemsWithAnnotation(&quot;random-anno&quot;, {});</span>
<a href="#l29.351"></a><span id="l29.351" class="difflineminus">-  do_check_eq(others.length, 3);</span>
<a href="#l29.352"></a><span id="l29.352" class="difflineminus">-  run_next_test();</span>
<a href="#l29.353"></a><span id="l29.353" class="difflineminus">-});</span>
<a href="#l29.354"></a><span id="l29.354" class="difflineminus">-</span>
<a href="#l29.355"></a><span id="l29.355" class="difflineminus">-function run_test()</span>
<a href="#l29.356"></a><span id="l29.356" class="difflineminus">-{</span>
<a href="#l29.357"></a><span id="l29.357" class="difflineminus">-  run_next_test();</span>
<a href="#l29.358"></a><span id="l29.358" class="difflineminus">-}</span>
<a href="#l29.359"></a><span id="l29.359" class="difflineplus">+/* Any copyright is dedicated to the Public Domain.</span>
<a href="#l29.360"></a><span id="l29.360" class="difflineplus">+   http://creativecommons.org/publicdomain/zero/1.0/ */</span>
<a href="#l29.361"></a><span id="l29.361" class="difflineplus">+</span>
<a href="#l29.362"></a><span id="l29.362" class="difflineplus">+function waitForBookmarkNotification(aNotification, aCallback, aProperty)</span>
<a href="#l29.363"></a><span id="l29.363" class="difflineplus">+{</span>
<a href="#l29.364"></a><span id="l29.364" class="difflineplus">+  PlacesUtils.bookmarks.addObserver({</span>
<a href="#l29.365"></a><span id="l29.365" class="difflineplus">+    validate: function (aMethodName, aData)</span>
<a href="#l29.366"></a><span id="l29.366" class="difflineplus">+    {</span>
<a href="#l29.367"></a><span id="l29.367" class="difflineplus">+      if (aMethodName == aNotification &amp;&amp;</span>
<a href="#l29.368"></a><span id="l29.368" class="difflineplus">+          (!aProperty || aProperty == aData.property)) {</span>
<a href="#l29.369"></a><span id="l29.369" class="difflineplus">+        PlacesUtils.bookmarks.removeObserver(this);</span>
<a href="#l29.370"></a><span id="l29.370" class="difflineplus">+        aCallback(aData);</span>
<a href="#l29.371"></a><span id="l29.371" class="difflineplus">+      }</span>
<a href="#l29.372"></a><span id="l29.372" class="difflineplus">+    },</span>
<a href="#l29.373"></a><span id="l29.373" class="difflineplus">+</span>
<a href="#l29.374"></a><span id="l29.374" class="difflineplus">+    // nsINavBookmarkObserver</span>
<a href="#l29.375"></a><span id="l29.375" class="difflineplus">+    QueryInterface: XPCOMUtils.generateQI([Ci.nsINavBookmarkObserver]),</span>
<a href="#l29.376"></a><span id="l29.376" class="difflineplus">+    onBeginUpdateBatch: function onBeginUpdateBatch() {</span>
<a href="#l29.377"></a><span id="l29.377" class="difflineplus">+      return this.validate(arguments.callee.name, arguments);</span>
<a href="#l29.378"></a><span id="l29.378" class="difflineplus">+    },</span>
<a href="#l29.379"></a><span id="l29.379" class="difflineplus">+    onEndUpdateBatch: function onEndUpdateBatch() {</span>
<a href="#l29.380"></a><span id="l29.380" class="difflineplus">+      return this.validate(arguments.callee.name, arguments);</span>
<a href="#l29.381"></a><span id="l29.381" class="difflineplus">+    },</span>
<a href="#l29.382"></a><span id="l29.382" class="difflineplus">+    onItemAdded: function onItemAdded(aItemId, aParentId, aIndex, aItemType,</span>
<a href="#l29.383"></a><span id="l29.383" class="difflineplus">+                                      aURI, aTitle)</span>
<a href="#l29.384"></a><span id="l29.384" class="difflineplus">+    {</span>
<a href="#l29.385"></a><span id="l29.385" class="difflineplus">+      return this.validate(arguments.callee.name, { id: aItemId,</span>
<a href="#l29.386"></a><span id="l29.386" class="difflineplus">+                                                    index: aIndex,</span>
<a href="#l29.387"></a><span id="l29.387" class="difflineplus">+                                                    type: aItemType,</span>
<a href="#l29.388"></a><span id="l29.388" class="difflineplus">+                                                    url: aURI ? aURI.spec : null,</span>
<a href="#l29.389"></a><span id="l29.389" class="difflineplus">+                                                    title: aTitle });</span>
<a href="#l29.390"></a><span id="l29.390" class="difflineplus">+    },</span>
<a href="#l29.391"></a><span id="l29.391" class="difflineplus">+    onItemRemoved: function onItemRemoved() {</span>
<a href="#l29.392"></a><span id="l29.392" class="difflineplus">+      return this.validate(arguments.callee.name, arguments);</span>
<a href="#l29.393"></a><span id="l29.393" class="difflineplus">+    },</span>
<a href="#l29.394"></a><span id="l29.394" class="difflineplus">+    onItemChanged: function onItemChanged(aItemId, aProperty, aIsAnno,</span>
<a href="#l29.395"></a><span id="l29.395" class="difflineplus">+                                          aNewValue, aLastModified, aItemType)</span>
<a href="#l29.396"></a><span id="l29.396" class="difflineplus">+    {</span>
<a href="#l29.397"></a><span id="l29.397" class="difflineplus">+      return this.validate(arguments.callee.name,</span>
<a href="#l29.398"></a><span id="l29.398" class="difflineplus">+                           { id: aItemId,</span>
<a href="#l29.399"></a><span id="l29.399" class="difflineplus">+                             get index() { return PlacesUtils.bookmarks.getItemIndex(this.id); },</span>
<a href="#l29.400"></a><span id="l29.400" class="difflineplus">+                             type: aItemType,</span>
<a href="#l29.401"></a><span id="l29.401" class="difflineplus">+                             property: aProperty,</span>
<a href="#l29.402"></a><span id="l29.402" class="difflineplus">+                             get url() { return aItemType == PlacesUtils.bookmarks.TYPE_BOOKMARK ?</span>
<a href="#l29.403"></a><span id="l29.403" class="difflineplus">+                                                PlacesUtils.bookmarks.getBookmarkURI(this.id).spec :</span>
<a href="#l29.404"></a><span id="l29.404" class="difflineplus">+                                                null; },</span>
<a href="#l29.405"></a><span id="l29.405" class="difflineplus">+                             get title() { return PlacesUtils.bookmarks.getItemTitle(this.id); },</span>
<a href="#l29.406"></a><span id="l29.406" class="difflineplus">+                           });</span>
<a href="#l29.407"></a><span id="l29.407" class="difflineplus">+    },</span>
<a href="#l29.408"></a><span id="l29.408" class="difflineplus">+    onItemVisited: function onItemVisited() {</span>
<a href="#l29.409"></a><span id="l29.409" class="difflineplus">+      return this.validate(arguments.callee.name, arguments);</span>
<a href="#l29.410"></a><span id="l29.410" class="difflineplus">+    },</span>
<a href="#l29.411"></a><span id="l29.411" class="difflineplus">+    onItemMoved: function onItemMoved(aItemId, aOldParentId, aOldIndex,</span>
<a href="#l29.412"></a><span id="l29.412" class="difflineplus">+                                      aNewParentId, aNewIndex, aItemType)</span>
<a href="#l29.413"></a><span id="l29.413" class="difflineplus">+    {</span>
<a href="#l29.414"></a><span id="l29.414" class="difflineplus">+      this.validate(arguments.callee.name, { id: aItemId,</span>
<a href="#l29.415"></a><span id="l29.415" class="difflineplus">+                                             index: aNewIndex,</span>
<a href="#l29.416"></a><span id="l29.416" class="difflineplus">+                                             type: aItemType });</span>
<a href="#l29.417"></a><span id="l29.417" class="difflineplus">+    }</span>
<a href="#l29.418"></a><span id="l29.418" class="difflineplus">+  }, false);</span>
<a href="#l29.419"></a><span id="l29.419" class="difflineplus">+}</span>
<a href="#l29.420"></a><span id="l29.420" class="difflineplus">+</span>
<a href="#l29.421"></a><span id="l29.421" class="difflineplus">+function wrapNodeByIdAndParent(aItemId, aParentId)</span>
<a href="#l29.422"></a><span id="l29.422" class="difflineplus">+{</span>
<a href="#l29.423"></a><span id="l29.423" class="difflineplus">+  let wrappedNode;</span>
<a href="#l29.424"></a><span id="l29.424" class="difflineplus">+  let root = PlacesUtils.getFolderContents(aParentId, false, false).root;</span>
<a href="#l29.425"></a><span id="l29.425" class="difflineplus">+  for (let i = 0; i &lt; root.childCount; ++i) {</span>
<a href="#l29.426"></a><span id="l29.426" class="difflineplus">+    let node = root.getChild(i);</span>
<a href="#l29.427"></a><span id="l29.427" class="difflineplus">+    if (node.itemId == aItemId) {</span>
<a href="#l29.428"></a><span id="l29.428" class="difflineplus">+      let type;</span>
<a href="#l29.429"></a><span id="l29.429" class="difflineplus">+      if (PlacesUtils.nodeIsContainer(node)) {</span>
<a href="#l29.430"></a><span id="l29.430" class="difflineplus">+        type = PlacesUtils.TYPE_X_MOZ_PLACE_CONTAINER;</span>
<a href="#l29.431"></a><span id="l29.431" class="difflineplus">+      }</span>
<a href="#l29.432"></a><span id="l29.432" class="difflineplus">+      else if (PlacesUtils.nodeIsURI(node)) {</span>
<a href="#l29.433"></a><span id="l29.433" class="difflineplus">+        type = PlacesUtils.TYPE_X_MOZ_PLACE;</span>
<a href="#l29.434"></a><span id="l29.434" class="difflineplus">+      }</span>
<a href="#l29.435"></a><span id="l29.435" class="difflineplus">+      else if (PlacesUtils.nodeIsSeparator(node)) {</span>
<a href="#l29.436"></a><span id="l29.436" class="difflineplus">+        type = PlacesUtils.TYPE_X_MOZ_PLACE_SEPARATOR;</span>
<a href="#l29.437"></a><span id="l29.437" class="difflineplus">+      }</span>
<a href="#l29.438"></a><span id="l29.438" class="difflineplus">+      else {</span>
<a href="#l29.439"></a><span id="l29.439" class="difflineplus">+        do_throw(&quot;Unknown node type&quot;);</span>
<a href="#l29.440"></a><span id="l29.440" class="difflineplus">+      }</span>
<a href="#l29.441"></a><span id="l29.441" class="difflineplus">+      wrappedNode = PlacesUtils.wrapNode(node, type);</span>
<a href="#l29.442"></a><span id="l29.442" class="difflineplus">+    }</span>
<a href="#l29.443"></a><span id="l29.443" class="difflineplus">+  }</span>
<a href="#l29.444"></a><span id="l29.444" class="difflineplus">+  root.containerOpen = false;</span>
<a href="#l29.445"></a><span id="l29.445" class="difflineplus">+  return JSON.parse(wrappedNode);</span>
<a href="#l29.446"></a><span id="l29.446" class="difflineplus">+}</span>
<a href="#l29.447"></a><span id="l29.447" class="difflineplus">+</span>
<a href="#l29.448"></a><span id="l29.448" class="difflineplus">+add_test(function test_text_paste()</span>
<a href="#l29.449"></a><span id="l29.449" class="difflineplus">+{</span>
<a href="#l29.450"></a><span id="l29.450" class="difflineplus">+  const TEST_URL = &quot;http://places.moz.org/&quot;</span>
<a href="#l29.451"></a><span id="l29.451" class="difflineplus">+  const TEST_TITLE = &quot;Places bookmark&quot;</span>
<a href="#l29.452"></a><span id="l29.452" class="difflineplus">+</span>
<a href="#l29.453"></a><span id="l29.453" class="difflineplus">+  waitForBookmarkNotification(&quot;onItemAdded&quot;, function(aData)</span>
<a href="#l29.454"></a><span id="l29.454" class="difflineplus">+  {</span>
<a href="#l29.455"></a><span id="l29.455" class="difflineplus">+    do_check_eq(aData.title, TEST_TITLE);</span>
<a href="#l29.456"></a><span id="l29.456" class="difflineplus">+    do_check_eq(aData.url, TEST_URL);</span>
<a href="#l29.457"></a><span id="l29.457" class="difflineplus">+    do_check_eq(aData.type, PlacesUtils.bookmarks.TYPE_BOOKMARK);</span>
<a href="#l29.458"></a><span id="l29.458" class="difflineplus">+    do_check_eq(aData.index, 0);</span>
<a href="#l29.459"></a><span id="l29.459" class="difflineplus">+    run_next_test();</span>
<a href="#l29.460"></a><span id="l29.460" class="difflineplus">+  });</span>
<a href="#l29.461"></a><span id="l29.461" class="difflineplus">+</span>
<a href="#l29.462"></a><span id="l29.462" class="difflineplus">+  let txn = PlacesUIUtils.makeTransaction(</span>
<a href="#l29.463"></a><span id="l29.463" class="difflineplus">+    { title: TEST_TITLE, uri: TEST_URL },</span>
<a href="#l29.464"></a><span id="l29.464" class="difflineplus">+    PlacesUtils.TYPE_X_MOZ_URL,</span>
<a href="#l29.465"></a><span id="l29.465" class="difflineplus">+    PlacesUtils.unfiledBookmarksFolderId,</span>
<a href="#l29.466"></a><span id="l29.466" class="difflineplus">+    PlacesUtils.bookmarks.DEFAULT_INDEX,</span>
<a href="#l29.467"></a><span id="l29.467" class="difflineplus">+    true // Unused for text.</span>
<a href="#l29.468"></a><span id="l29.468" class="difflineplus">+  );</span>
<a href="#l29.469"></a><span id="l29.469" class="difflineplus">+  PlacesUtils.transactionManager.doTransaction(txn);</span>
<a href="#l29.470"></a><span id="l29.470" class="difflineplus">+});</span>
<a href="#l29.471"></a><span id="l29.471" class="difflineplus">+</span>
<a href="#l29.472"></a><span id="l29.472" class="difflineplus">+add_test(function test_container()</span>
<a href="#l29.473"></a><span id="l29.473" class="difflineplus">+{</span>
<a href="#l29.474"></a><span id="l29.474" class="difflineplus">+  const TEST_TITLE = &quot;Places folder&quot;</span>
<a href="#l29.475"></a><span id="l29.475" class="difflineplus">+</span>
<a href="#l29.476"></a><span id="l29.476" class="difflineplus">+  waitForBookmarkNotification(&quot;onItemChanged&quot;, function(aData)</span>
<a href="#l29.477"></a><span id="l29.477" class="difflineplus">+  {</span>
<a href="#l29.478"></a><span id="l29.478" class="difflineplus">+    do_check_eq(aData.title, TEST_TITLE);</span>
<a href="#l29.479"></a><span id="l29.479" class="difflineplus">+    do_check_eq(aData.type, PlacesUtils.bookmarks.TYPE_FOLDER);</span>
<a href="#l29.480"></a><span id="l29.480" class="difflineplus">+    do_check_eq(aData.index, 1);</span>
<a href="#l29.481"></a><span id="l29.481" class="difflineplus">+</span>
<a href="#l29.482"></a><span id="l29.482" class="difflineplus">+    waitForBookmarkNotification(&quot;onItemAdded&quot;, function(aData)</span>
<a href="#l29.483"></a><span id="l29.483" class="difflineplus">+    {</span>
<a href="#l29.484"></a><span id="l29.484" class="difflineplus">+      do_check_eq(aData.title, TEST_TITLE);</span>
<a href="#l29.485"></a><span id="l29.485" class="difflineplus">+      do_check_eq(aData.type, PlacesUtils.bookmarks.TYPE_FOLDER);</span>
<a href="#l29.486"></a><span id="l29.486" class="difflineplus">+      do_check_eq(aData.index, 2);</span>
<a href="#l29.487"></a><span id="l29.487" class="difflineplus">+      let id = aData.id;</span>
<a href="#l29.488"></a><span id="l29.488" class="difflineplus">+</span>
<a href="#l29.489"></a><span id="l29.489" class="difflineplus">+      waitForBookmarkNotification(&quot;onItemMoved&quot;, function(aData)</span>
<a href="#l29.490"></a><span id="l29.490" class="difflineplus">+      {</span>
<a href="#l29.491"></a><span id="l29.491" class="difflineplus">+        do_check_eq(aData.id, id);</span>
<a href="#l29.492"></a><span id="l29.492" class="difflineplus">+        do_check_eq(aData.type, PlacesUtils.bookmarks.TYPE_FOLDER);</span>
<a href="#l29.493"></a><span id="l29.493" class="difflineplus">+        do_check_eq(aData.index, 1);</span>
<a href="#l29.494"></a><span id="l29.494" class="difflineplus">+</span>
<a href="#l29.495"></a><span id="l29.495" class="difflineplus">+        run_next_test();</span>
<a href="#l29.496"></a><span id="l29.496" class="difflineplus">+      });</span>
<a href="#l29.497"></a><span id="l29.497" class="difflineplus">+</span>
<a href="#l29.498"></a><span id="l29.498" class="difflineplus">+      let txn = PlacesUIUtils.makeTransaction(</span>
<a href="#l29.499"></a><span id="l29.499" class="difflineplus">+        wrapNodeByIdAndParent(aData.id, PlacesUtils.unfiledBookmarksFolderId),</span>
<a href="#l29.500"></a><span id="l29.500" class="difflineplus">+        0, // Unused for real nodes.</span>
<a href="#l29.501"></a><span id="l29.501" class="difflineplus">+        PlacesUtils.unfiledBookmarksFolderId,</span>
<a href="#l29.502"></a><span id="l29.502" class="difflineplus">+        1, // Move to position 1.</span>
<a href="#l29.503"></a><span id="l29.503" class="difflineplus">+        false</span>
<a href="#l29.504"></a><span id="l29.504" class="difflineplus">+      );</span>
<a href="#l29.505"></a><span id="l29.505" class="difflineplus">+      PlacesUtils.transactionManager.doTransaction(txn);</span>
<a href="#l29.506"></a><span id="l29.506" class="difflineplus">+    });</span>
<a href="#l29.507"></a><span id="l29.507" class="difflineplus">+</span>
<a href="#l29.508"></a><span id="l29.508" class="difflineplus">+    try {</span>
<a href="#l29.509"></a><span id="l29.509" class="difflineplus">+    let txn = PlacesUIUtils.makeTransaction(</span>
<a href="#l29.510"></a><span id="l29.510" class="difflineplus">+      wrapNodeByIdAndParent(aData.id, PlacesUtils.unfiledBookmarksFolderId),</span>
<a href="#l29.511"></a><span id="l29.511" class="difflineplus">+      0, // Unused for real nodes.</span>
<a href="#l29.512"></a><span id="l29.512" class="difflineplus">+      PlacesUtils.unfiledBookmarksFolderId,</span>
<a href="#l29.513"></a><span id="l29.513" class="difflineplus">+      PlacesUtils.bookmarks.DEFAULT_INDEX,</span>
<a href="#l29.514"></a><span id="l29.514" class="difflineplus">+      true</span>
<a href="#l29.515"></a><span id="l29.515" class="difflineplus">+    );</span>
<a href="#l29.516"></a><span id="l29.516" class="difflineplus">+    PlacesUtils.transactionManager.doTransaction(txn);</span>
<a href="#l29.517"></a><span id="l29.517" class="difflineplus">+    } catch(ex) {</span>
<a href="#l29.518"></a><span id="l29.518" class="difflineplus">+      do_throw(ex);</span>
<a href="#l29.519"></a><span id="l29.519" class="difflineplus">+    }</span>
<a href="#l29.520"></a><span id="l29.520" class="difflineplus">+  }, &quot;random-anno&quot;);</span>
<a href="#l29.521"></a><span id="l29.521" class="difflineplus">+</span>
<a href="#l29.522"></a><span id="l29.522" class="difflineplus">+  let id = PlacesUtils.bookmarks.createFolder(PlacesUtils.unfiledBookmarksFolderId,</span>
<a href="#l29.523"></a><span id="l29.523" class="difflineplus">+                                              TEST_TITLE,</span>
<a href="#l29.524"></a><span id="l29.524" class="difflineplus">+                                              PlacesUtils.bookmarks.DEFAULT_INDEX);</span>
<a href="#l29.525"></a><span id="l29.525" class="difflineplus">+  PlacesUtils.annotations.setItemAnnotation(id, PlacesUIUtils.DESCRIPTION_ANNO,</span>
<a href="#l29.526"></a><span id="l29.526" class="difflineplus">+                                            &quot;description&quot;, 0,</span>
<a href="#l29.527"></a><span id="l29.527" class="difflineplus">+                                            PlacesUtils.annotations.EXPIRE_NEVER);</span>
<a href="#l29.528"></a><span id="l29.528" class="difflineplus">+  PlacesUtils.annotations.setItemAnnotation(id, &quot;random-anno&quot;,</span>
<a href="#l29.529"></a><span id="l29.529" class="difflineplus">+                                            &quot;random-value&quot;, 0,</span>
<a href="#l29.530"></a><span id="l29.530" class="difflineplus">+                                            PlacesUtils.annotations.EXPIRE_NEVER);</span>
<a href="#l29.531"></a><span id="l29.531" class="difflineplus">+});</span>
<a href="#l29.532"></a><span id="l29.532" class="difflineplus">+</span>
<a href="#l29.533"></a><span id="l29.533" class="difflineplus">+</span>
<a href="#l29.534"></a><span id="l29.534" class="difflineplus">+add_test(function test_separator()</span>
<a href="#l29.535"></a><span id="l29.535" class="difflineplus">+{</span>
<a href="#l29.536"></a><span id="l29.536" class="difflineplus">+  waitForBookmarkNotification(&quot;onItemChanged&quot;, function(aData)</span>
<a href="#l29.537"></a><span id="l29.537" class="difflineplus">+  {</span>
<a href="#l29.538"></a><span id="l29.538" class="difflineplus">+    do_check_eq(aData.type, PlacesUtils.bookmarks.TYPE_SEPARATOR);</span>
<a href="#l29.539"></a><span id="l29.539" class="difflineplus">+    do_check_eq(aData.index, 3);</span>
<a href="#l29.540"></a><span id="l29.540" class="difflineplus">+</span>
<a href="#l29.541"></a><span id="l29.541" class="difflineplus">+    waitForBookmarkNotification(&quot;onItemAdded&quot;, function(aData)</span>
<a href="#l29.542"></a><span id="l29.542" class="difflineplus">+    {</span>
<a href="#l29.543"></a><span id="l29.543" class="difflineplus">+      do_check_eq(aData.type, PlacesUtils.bookmarks.TYPE_SEPARATOR);</span>
<a href="#l29.544"></a><span id="l29.544" class="difflineplus">+      do_check_eq(aData.index, 4);</span>
<a href="#l29.545"></a><span id="l29.545" class="difflineplus">+      let id = aData.id;</span>
<a href="#l29.546"></a><span id="l29.546" class="difflineplus">+</span>
<a href="#l29.547"></a><span id="l29.547" class="difflineplus">+      waitForBookmarkNotification(&quot;onItemMoved&quot;, function(aData)</span>
<a href="#l29.548"></a><span id="l29.548" class="difflineplus">+      {</span>
<a href="#l29.549"></a><span id="l29.549" class="difflineplus">+        do_check_eq(aData.id, id);</span>
<a href="#l29.550"></a><span id="l29.550" class="difflineplus">+        do_check_eq(aData.type, PlacesUtils.bookmarks.TYPE_SEPARATOR);</span>
<a href="#l29.551"></a><span id="l29.551" class="difflineplus">+        do_check_eq(aData.index, 1);</span>
<a href="#l29.552"></a><span id="l29.552" class="difflineplus">+</span>
<a href="#l29.553"></a><span id="l29.553" class="difflineplus">+        run_next_test();</span>
<a href="#l29.554"></a><span id="l29.554" class="difflineplus">+      });</span>
<a href="#l29.555"></a><span id="l29.555" class="difflineplus">+</span>
<a href="#l29.556"></a><span id="l29.556" class="difflineplus">+      let txn = PlacesUIUtils.makeTransaction(</span>
<a href="#l29.557"></a><span id="l29.557" class="difflineplus">+        wrapNodeByIdAndParent(aData.id, PlacesUtils.unfiledBookmarksFolderId),</span>
<a href="#l29.558"></a><span id="l29.558" class="difflineplus">+        0, // Unused for real nodes.</span>
<a href="#l29.559"></a><span id="l29.559" class="difflineplus">+        PlacesUtils.unfiledBookmarksFolderId,</span>
<a href="#l29.560"></a><span id="l29.560" class="difflineplus">+        1, // Move to position 1.</span>
<a href="#l29.561"></a><span id="l29.561" class="difflineplus">+        false</span>
<a href="#l29.562"></a><span id="l29.562" class="difflineplus">+      );</span>
<a href="#l29.563"></a><span id="l29.563" class="difflineplus">+      PlacesUtils.transactionManager.doTransaction(txn);</span>
<a href="#l29.564"></a><span id="l29.564" class="difflineplus">+    });</span>
<a href="#l29.565"></a><span id="l29.565" class="difflineplus">+</span>
<a href="#l29.566"></a><span id="l29.566" class="difflineplus">+    try {</span>
<a href="#l29.567"></a><span id="l29.567" class="difflineplus">+    let txn = PlacesUIUtils.makeTransaction(</span>
<a href="#l29.568"></a><span id="l29.568" class="difflineplus">+      wrapNodeByIdAndParent(aData.id, PlacesUtils.unfiledBookmarksFolderId),</span>
<a href="#l29.569"></a><span id="l29.569" class="difflineplus">+      0, // Unused for real nodes.</span>
<a href="#l29.570"></a><span id="l29.570" class="difflineplus">+      PlacesUtils.unfiledBookmarksFolderId,</span>
<a href="#l29.571"></a><span id="l29.571" class="difflineplus">+      PlacesUtils.bookmarks.DEFAULT_INDEX,</span>
<a href="#l29.572"></a><span id="l29.572" class="difflineplus">+      true</span>
<a href="#l29.573"></a><span id="l29.573" class="difflineplus">+    );</span>
<a href="#l29.574"></a><span id="l29.574" class="difflineplus">+    PlacesUtils.transactionManager.doTransaction(txn);</span>
<a href="#l29.575"></a><span id="l29.575" class="difflineplus">+    } catch(ex) {</span>
<a href="#l29.576"></a><span id="l29.576" class="difflineplus">+      do_throw(ex);</span>
<a href="#l29.577"></a><span id="l29.577" class="difflineplus">+    }</span>
<a href="#l29.578"></a><span id="l29.578" class="difflineplus">+  }, &quot;random-anno&quot;);</span>
<a href="#l29.579"></a><span id="l29.579" class="difflineplus">+</span>
<a href="#l29.580"></a><span id="l29.580" class="difflineplus">+  let id = PlacesUtils.bookmarks.insertSeparator(PlacesUtils.unfiledBookmarksFolderId,</span>
<a href="#l29.581"></a><span id="l29.581" class="difflineplus">+                                                 PlacesUtils.bookmarks.DEFAULT_INDEX);</span>
<a href="#l29.582"></a><span id="l29.582" class="difflineplus">+  PlacesUtils.annotations.setItemAnnotation(id, &quot;random-anno&quot;,</span>
<a href="#l29.583"></a><span id="l29.583" class="difflineplus">+                                            &quot;random-value&quot;, 0,</span>
<a href="#l29.584"></a><span id="l29.584" class="difflineplus">+                                            PlacesUtils.annotations.EXPIRE_NEVER);</span>
<a href="#l29.585"></a><span id="l29.585" class="difflineplus">+});</span>
<a href="#l29.586"></a><span id="l29.586" class="difflineplus">+</span>
<a href="#l29.587"></a><span id="l29.587" class="difflineplus">+add_test(function test_bookmark()</span>
<a href="#l29.588"></a><span id="l29.588" class="difflineplus">+{</span>
<a href="#l29.589"></a><span id="l29.589" class="difflineplus">+  const TEST_URL = &quot;http://places.moz.org/&quot;</span>
<a href="#l29.590"></a><span id="l29.590" class="difflineplus">+  const TEST_TITLE = &quot;Places bookmark&quot;</span>
<a href="#l29.591"></a><span id="l29.591" class="difflineplus">+</span>
<a href="#l29.592"></a><span id="l29.592" class="difflineplus">+  waitForBookmarkNotification(&quot;onItemChanged&quot;, function(aData)</span>
<a href="#l29.593"></a><span id="l29.593" class="difflineplus">+  {</span>
<a href="#l29.594"></a><span id="l29.594" class="difflineplus">+    do_check_eq(aData.title, TEST_TITLE);</span>
<a href="#l29.595"></a><span id="l29.595" class="difflineplus">+    do_check_eq(aData.url, TEST_URL);</span>
<a href="#l29.596"></a><span id="l29.596" class="difflineplus">+    do_check_eq(aData.type, PlacesUtils.bookmarks.TYPE_BOOKMARK);</span>
<a href="#l29.597"></a><span id="l29.597" class="difflineplus">+    do_check_eq(aData.index, 5);</span>
<a href="#l29.598"></a><span id="l29.598" class="difflineplus">+</span>
<a href="#l29.599"></a><span id="l29.599" class="difflineplus">+    waitForBookmarkNotification(&quot;onItemAdded&quot;, function(aData)</span>
<a href="#l29.600"></a><span id="l29.600" class="difflineplus">+    {</span>
<a href="#l29.601"></a><span id="l29.601" class="difflineplus">+      do_check_eq(aData.title, TEST_TITLE);</span>
<a href="#l29.602"></a><span id="l29.602" class="difflineplus">+      do_check_eq(aData.url, TEST_URL);</span>
<a href="#l29.603"></a><span id="l29.603" class="difflineplus">+      do_check_eq(aData.type, PlacesUtils.bookmarks.TYPE_BOOKMARK);</span>
<a href="#l29.604"></a><span id="l29.604" class="difflineplus">+      do_check_eq(aData.index, 6);</span>
<a href="#l29.605"></a><span id="l29.605" class="difflineplus">+      let id = aData.id;</span>
<a href="#l29.606"></a><span id="l29.606" class="difflineplus">+</span>
<a href="#l29.607"></a><span id="l29.607" class="difflineplus">+      waitForBookmarkNotification(&quot;onItemMoved&quot;, function(aData)</span>
<a href="#l29.608"></a><span id="l29.608" class="difflineplus">+      {</span>
<a href="#l29.609"></a><span id="l29.609" class="difflineplus">+        do_check_eq(aData.id, id);</span>
<a href="#l29.610"></a><span id="l29.610" class="difflineplus">+        do_check_eq(aData.type, PlacesUtils.bookmarks.TYPE_BOOKMARK);</span>
<a href="#l29.611"></a><span id="l29.611" class="difflineplus">+        do_check_eq(aData.index, 1);</span>
<a href="#l29.612"></a><span id="l29.612" class="difflineplus">+</span>
<a href="#l29.613"></a><span id="l29.613" class="difflineplus">+        run_next_test();</span>
<a href="#l29.614"></a><span id="l29.614" class="difflineplus">+      });</span>
<a href="#l29.615"></a><span id="l29.615" class="difflineplus">+</span>
<a href="#l29.616"></a><span id="l29.616" class="difflineplus">+      let txn = PlacesUIUtils.makeTransaction(</span>
<a href="#l29.617"></a><span id="l29.617" class="difflineplus">+        wrapNodeByIdAndParent(aData.id, PlacesUtils.unfiledBookmarksFolderId),</span>
<a href="#l29.618"></a><span id="l29.618" class="difflineplus">+        0, // Unused for real nodes.</span>
<a href="#l29.619"></a><span id="l29.619" class="difflineplus">+        PlacesUtils.unfiledBookmarksFolderId,</span>
<a href="#l29.620"></a><span id="l29.620" class="difflineplus">+        1, // Move to position 1.</span>
<a href="#l29.621"></a><span id="l29.621" class="difflineplus">+        false</span>
<a href="#l29.622"></a><span id="l29.622" class="difflineplus">+      );</span>
<a href="#l29.623"></a><span id="l29.623" class="difflineplus">+      PlacesUtils.transactionManager.doTransaction(txn);</span>
<a href="#l29.624"></a><span id="l29.624" class="difflineplus">+    });</span>
<a href="#l29.625"></a><span id="l29.625" class="difflineplus">+</span>
<a href="#l29.626"></a><span id="l29.626" class="difflineplus">+    try {</span>
<a href="#l29.627"></a><span id="l29.627" class="difflineplus">+    let txn = PlacesUIUtils.makeTransaction(</span>
<a href="#l29.628"></a><span id="l29.628" class="difflineplus">+      wrapNodeByIdAndParent(aData.id, PlacesUtils.unfiledBookmarksFolderId),</span>
<a href="#l29.629"></a><span id="l29.629" class="difflineplus">+      0, // Unused for real nodes.</span>
<a href="#l29.630"></a><span id="l29.630" class="difflineplus">+      PlacesUtils.unfiledBookmarksFolderId,</span>
<a href="#l29.631"></a><span id="l29.631" class="difflineplus">+      PlacesUtils.bookmarks.DEFAULT_INDEX,</span>
<a href="#l29.632"></a><span id="l29.632" class="difflineplus">+      true</span>
<a href="#l29.633"></a><span id="l29.633" class="difflineplus">+    );</span>
<a href="#l29.634"></a><span id="l29.634" class="difflineplus">+    PlacesUtils.transactionManager.doTransaction(txn);</span>
<a href="#l29.635"></a><span id="l29.635" class="difflineplus">+    } catch(ex) {</span>
<a href="#l29.636"></a><span id="l29.636" class="difflineplus">+      do_throw(ex);</span>
<a href="#l29.637"></a><span id="l29.637" class="difflineplus">+    }</span>
<a href="#l29.638"></a><span id="l29.638" class="difflineplus">+  }, &quot;random-anno&quot;);</span>
<a href="#l29.639"></a><span id="l29.639" class="difflineplus">+</span>
<a href="#l29.640"></a><span id="l29.640" class="difflineplus">+  let id = PlacesUtils.bookmarks.insertBookmark(PlacesUtils.unfiledBookmarksFolderId,</span>
<a href="#l29.641"></a><span id="l29.641" class="difflineplus">+                                                NetUtil.newURI(TEST_URL),</span>
<a href="#l29.642"></a><span id="l29.642" class="difflineplus">+                                                PlacesUtils.bookmarks.DEFAULT_INDEX,</span>
<a href="#l29.643"></a><span id="l29.643" class="difflineplus">+                                                TEST_TITLE);</span>
<a href="#l29.644"></a><span id="l29.644" class="difflineplus">+  PlacesUtils.annotations.setItemAnnotation(id, PlacesUIUtils.DESCRIPTION_ANNO,</span>
<a href="#l29.645"></a><span id="l29.645" class="difflineplus">+                                            &quot;description&quot;, 0,</span>
<a href="#l29.646"></a><span id="l29.646" class="difflineplus">+                                            PlacesUtils.annotations.EXPIRE_NEVER);</span>
<a href="#l29.647"></a><span id="l29.647" class="difflineplus">+  PlacesUtils.annotations.setItemAnnotation(id, &quot;random-anno&quot;,</span>
<a href="#l29.648"></a><span id="l29.648" class="difflineplus">+                                            &quot;random-value&quot;, 0,</span>
<a href="#l29.649"></a><span id="l29.649" class="difflineplus">+                                            PlacesUtils.annotations.EXPIRE_NEVER);</span>
<a href="#l29.650"></a><span id="l29.650" class="difflineplus">+});</span>
<a href="#l29.651"></a><span id="l29.651" class="difflineplus">+</span>
<a href="#l29.652"></a><span id="l29.652" class="difflineplus">+add_test(function test_visit()</span>
<a href="#l29.653"></a><span id="l29.653" class="difflineplus">+{</span>
<a href="#l29.654"></a><span id="l29.654" class="difflineplus">+  const TEST_URL = &quot;http://places.moz.org/&quot;</span>
<a href="#l29.655"></a><span id="l29.655" class="difflineplus">+  const TEST_TITLE = &quot;Places bookmark&quot;</span>
<a href="#l29.656"></a><span id="l29.656" class="difflineplus">+</span>
<a href="#l29.657"></a><span id="l29.657" class="difflineplus">+  waitForBookmarkNotification(&quot;onItemAdded&quot;, function(aData)</span>
<a href="#l29.658"></a><span id="l29.658" class="difflineplus">+  {</span>
<a href="#l29.659"></a><span id="l29.659" class="difflineplus">+    do_check_eq(aData.title, TEST_TITLE);</span>
<a href="#l29.660"></a><span id="l29.660" class="difflineplus">+    do_check_eq(aData.url, TEST_URL);</span>
<a href="#l29.661"></a><span id="l29.661" class="difflineplus">+    do_check_eq(aData.type, PlacesUtils.bookmarks.TYPE_BOOKMARK);</span>
<a href="#l29.662"></a><span id="l29.662" class="difflineplus">+    do_check_eq(aData.index, 7);</span>
<a href="#l29.663"></a><span id="l29.663" class="difflineplus">+</span>
<a href="#l29.664"></a><span id="l29.664" class="difflineplus">+    waitForBookmarkNotification(&quot;onItemAdded&quot;, function(aData)</span>
<a href="#l29.665"></a><span id="l29.665" class="difflineplus">+    {</span>
<a href="#l29.666"></a><span id="l29.666" class="difflineplus">+      do_check_eq(aData.title, TEST_TITLE);</span>
<a href="#l29.667"></a><span id="l29.667" class="difflineplus">+      do_check_eq(aData.url, TEST_URL);</span>
<a href="#l29.668"></a><span id="l29.668" class="difflineplus">+      do_check_eq(aData.type, PlacesUtils.bookmarks.TYPE_BOOKMARK);</span>
<a href="#l29.669"></a><span id="l29.669" class="difflineplus">+      do_check_eq(aData.index, 8);</span>
<a href="#l29.670"></a><span id="l29.670" class="difflineplus">+      run_next_test();</span>
<a href="#l29.671"></a><span id="l29.671" class="difflineplus">+    });</span>
<a href="#l29.672"></a><span id="l29.672" class="difflineplus">+</span>
<a href="#l29.673"></a><span id="l29.673" class="difflineplus">+    try {</span>
<a href="#l29.674"></a><span id="l29.674" class="difflineplus">+    let node = wrapNodeByIdAndParent(aData.id, PlacesUtils.unfiledBookmarksFolderId);</span>
<a href="#l29.675"></a><span id="l29.675" class="difflineplus">+    // Simulate a not-bookmarked node, will copy it to a new bookmark.</span>
<a href="#l29.676"></a><span id="l29.676" class="difflineplus">+    node.id = -1;</span>
<a href="#l29.677"></a><span id="l29.677" class="difflineplus">+    let txn = PlacesUIUtils.makeTransaction(</span>
<a href="#l29.678"></a><span id="l29.678" class="difflineplus">+      node,</span>
<a href="#l29.679"></a><span id="l29.679" class="difflineplus">+      0, // Unused for real nodes.</span>
<a href="#l29.680"></a><span id="l29.680" class="difflineplus">+      PlacesUtils.unfiledBookmarksFolderId,</span>
<a href="#l29.681"></a><span id="l29.681" class="difflineplus">+      PlacesUtils.bookmarks.DEFAULT_INDEX,</span>
<a href="#l29.682"></a><span id="l29.682" class="difflineplus">+      true</span>
<a href="#l29.683"></a><span id="l29.683" class="difflineplus">+    );</span>
<a href="#l29.684"></a><span id="l29.684" class="difflineplus">+    PlacesUtils.transactionManager.doTransaction(txn);</span>
<a href="#l29.685"></a><span id="l29.685" class="difflineplus">+    } catch(ex) {</span>
<a href="#l29.686"></a><span id="l29.686" class="difflineplus">+      do_throw(ex);</span>
<a href="#l29.687"></a><span id="l29.687" class="difflineplus">+    }</span>
<a href="#l29.688"></a><span id="l29.688" class="difflineplus">+  });</span>
<a href="#l29.689"></a><span id="l29.689" class="difflineplus">+</span>
<a href="#l29.690"></a><span id="l29.690" class="difflineplus">+  PlacesUtils.bookmarks.insertBookmark(PlacesUtils.unfiledBookmarksFolderId,</span>
<a href="#l29.691"></a><span id="l29.691" class="difflineplus">+                                       NetUtil.newURI(TEST_URL),</span>
<a href="#l29.692"></a><span id="l29.692" class="difflineplus">+                                       PlacesUtils.bookmarks.DEFAULT_INDEX,</span>
<a href="#l29.693"></a><span id="l29.693" class="difflineplus">+                                       TEST_TITLE);</span>
<a href="#l29.694"></a><span id="l29.694" class="difflineplus">+});</span>
<a href="#l29.695"></a><span id="l29.695" class="difflineplus">+</span>
<a href="#l29.696"></a><span id="l29.696" class="difflineplus">+add_test(function check_annotations() {</span>
<a href="#l29.697"></a><span id="l29.697" class="difflineplus">+  // As last step check how many items for each annotation exist.</span>
<a href="#l29.698"></a><span id="l29.698" class="difflineplus">+</span>
<a href="#l29.699"></a><span id="l29.699" class="difflineplus">+  // Copies should retain the description annotation.</span>
<a href="#l29.700"></a><span id="l29.700" class="difflineplus">+  let descriptions =</span>
<a href="#l29.701"></a><span id="l29.701" class="difflineplus">+    PlacesUtils.annotations.getItemsWithAnnotation(PlacesUIUtils.DESCRIPTION_ANNO, {});</span>
<a href="#l29.702"></a><span id="l29.702" class="difflineplus">+  do_check_eq(descriptions.length, 4);</span>
<a href="#l29.703"></a><span id="l29.703" class="difflineplus">+</span>
<a href="#l29.704"></a><span id="l29.704" class="difflineplus">+  // Only the original bookmarks should have this annotation.</span>
<a href="#l29.705"></a><span id="l29.705" class="difflineplus">+  let others = PlacesUtils.annotations.getItemsWithAnnotation(&quot;random-anno&quot;, {});</span>
<a href="#l29.706"></a><span id="l29.706" class="difflineplus">+  do_check_eq(others.length, 3);</span>
<a href="#l29.707"></a><span id="l29.707" class="difflineplus">+  run_next_test();</span>
<a href="#l29.708"></a><span id="l29.708" class="difflineplus">+});</span>
<a href="#l29.709"></a><span id="l29.709" class="difflineplus">+</span>
<a href="#l29.710"></a><span id="l29.710" class="difflineplus">+function run_test()</span>
<a href="#l29.711"></a><span id="l29.711" class="difflineplus">+{</span>
<a href="#l29.712"></a><span id="l29.712" class="difflineplus">+  run_next_test();</span>
<a href="#l29.713"></a><span id="l29.713" class="difflineplus">+}</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l30.1"></a><span id="l30.1" class="difflineminus">--- a/suite/common/places/tests/unit/test_browserGlue_smartBookmarks.js</span>
<a href="#l30.2"></a><span id="l30.2" class="difflineplus">+++ b/suite/common/places/tests/unit/test_browserGlue_smartBookmarks.js</span>
<a href="#l30.3"></a><span id="l30.3" class="difflineat">@@ -215,17 +215,17 @@ tests.push({</span>
<a href="#l30.4"></a><span id="l30.4">     next_test();</span>
<a href="#l30.5"></a><span id="l30.5">   }</span>
<a href="#l30.6"></a><span id="l30.6"> });</span>
<a href="#l30.7"></a><span id="l30.7"> </span>
<a href="#l30.8"></a><span id="l30.8"> //------------------------------------------------------------------------------</span>
<a href="#l30.9"></a><span id="l30.9"> </span>
<a href="#l30.10"></a><span id="l30.10"> tests.push({</span>
<a href="#l30.11"></a><span id="l30.11">   description: &quot;An explicitly removed smart bookmark should not be recreated.&quot;,</span>
<a href="#l30.12"></a><span id="l30.12" class="difflineminus">-  exec: function() {   </span>
<a href="#l30.13"></a><span id="l30.13" class="difflineplus">+  exec: function() {</span>
<a href="#l30.14"></a><span id="l30.14">     // Remove toolbar's smart bookmarks</span>
<a href="#l30.15"></a><span id="l30.15">     PlacesUtils.bookmarks.removeItem(PlacesUtils.bookmarks.getIdForItemAt(PlacesUtils.toolbarFolderId, 0));</span>
<a href="#l30.16"></a><span id="l30.16"> </span>
<a href="#l30.17"></a><span id="l30.17">     // Sanity check items.</span>
<a href="#l30.18"></a><span id="l30.18">     do_check_eq(countFolderChildren(PlacesUtils.toolbarFolderId),</span>
<a href="#l30.19"></a><span id="l30.19">                 DEFAULT_BOOKMARKS_ON_TOOLBAR);</span>
<a href="#l30.20"></a><span id="l30.20">     do_check_eq(countFolderChildren(PlacesUtils.bookmarksMenuFolderId),</span>
<a href="#l30.21"></a><span id="l30.21">                 SMART_BOOKMARKS_ON_MENU + DEFAULT_BOOKMARKS_ON_MENU);</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l31.1"></a><span id="l31.1" class="difflineminus">--- a/suite/common/places/tests/unit/test_clearHistory_shutdown.js</span>
<a href="#l31.2"></a><span id="l31.2" class="difflineplus">+++ b/suite/common/places/tests/unit/test_clearHistory_shutdown.js</span>
<a href="#l31.3"></a><span id="l31.3" class="difflineat">@@ -132,17 +132,17 @@ function getDistinctNotifications() {</span>
<a href="#l31.4"></a><span id="l31.4"> }</span>
<a href="#l31.5"></a><span id="l31.5"> </span>
<a href="#l31.6"></a><span id="l31.6"> function storeCache(aURL, aContent) {</span>
<a href="#l31.7"></a><span id="l31.7">   let cache = Cc[&quot;@mozilla.org/network/cache-service;1&quot;].</span>
<a href="#l31.8"></a><span id="l31.8">               getService(Ci.nsICacheService);</span>
<a href="#l31.9"></a><span id="l31.9">   let session = cache.createSession(&quot;FTP&quot;, Ci.nsICache.STORE_ANYWHERE,</span>
<a href="#l31.10"></a><span id="l31.10">                                     Ci.nsICache.STREAM_BASED);</span>
<a href="#l31.11"></a><span id="l31.11"> </span>
<a href="#l31.12"></a><span id="l31.12" class="difflineminus">-  </span>
<a href="#l31.13"></a><span id="l31.13" class="difflineplus">+</span>
<a href="#l31.14"></a><span id="l31.14">   var storeCacheListener = {</span>
<a href="#l31.15"></a><span id="l31.15">     onCacheEntryAvailable: function (entry, access, status) {</span>
<a href="#l31.16"></a><span id="l31.16">       do_check_eq(status, Cr.NS_OK);</span>
<a href="#l31.17"></a><span id="l31.17"> </span>
<a href="#l31.18"></a><span id="l31.18">       entry.setMetaDataElement(&quot;servertype&quot;, &quot;0&quot;);</span>
<a href="#l31.19"></a><span id="l31.19">       var os = entry.openOutputStream(0);</span>
<a href="#l31.20"></a><span id="l31.20"> </span>
<a href="#l31.21"></a><span id="l31.21">       var written = os.write(aContent, aContent.length);</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l32.1"></a><span id="l32.1" class="difflineminus">--- a/suite/common/pref/pref-applications.js</span>
<a href="#l32.2"></a><span id="l32.2" class="difflineplus">+++ b/suite/common/pref/pref-applications.js</span>
<a href="#l32.3"></a><span id="l32.3" class="difflineat">@@ -120,17 +120,17 @@ function getLocalHandlerApp(aFile) {</span>
<a href="#l32.4"></a><span id="l32.4"> </span>
<a href="#l32.5"></a><span id="l32.5">   return localHandlerApp;</span>
<a href="#l32.6"></a><span id="l32.6"> }</span>
<a href="#l32.7"></a><span id="l32.7"> </span>
<a href="#l32.8"></a><span id="l32.8"> /**</span>
<a href="#l32.9"></a><span id="l32.9">  * An enumeration of items in a JS array.</span>
<a href="#l32.10"></a><span id="l32.10">  *</span>
<a href="#l32.11"></a><span id="l32.11">  * FIXME: use ArrayConverter once it lands (bug 380839).</span>
<a href="#l32.12"></a><span id="l32.12" class="difflineminus">- * </span>
<a href="#l32.13"></a><span id="l32.13" class="difflineplus">+ *</span>
<a href="#l32.14"></a><span id="l32.14">  * @constructor</span>
<a href="#l32.15"></a><span id="l32.15">  */</span>
<a href="#l32.16"></a><span id="l32.16"> function ArrayEnumerator(aItems) {</span>
<a href="#l32.17"></a><span id="l32.17">   this._index = 0;</span>
<a href="#l32.18"></a><span id="l32.18">   this._contents = aItems;</span>
<a href="#l32.19"></a><span id="l32.19"> }</span>
<a href="#l32.20"></a><span id="l32.20"> </span>
<a href="#l32.21"></a><span id="l32.21"> ArrayEnumerator.prototype = {</span>
<a href="#l32.22"></a><span id="l32.22" class="difflineat">@@ -993,17 +993,17 @@ var gApplicationsPane = {</span>
<a href="#l32.23"></a><span id="l32.23">    * the last one is the one that the application will use.  That may not be</span>
<a href="#l32.24"></a><span id="l32.24">    * correct, but it's how we've been doing it for years.</span>
<a href="#l32.25"></a><span id="l32.25">    *</span>
<a href="#l32.26"></a><span id="l32.26">    * Perhaps we should instead query navigator.mimeTypes for the set of types</span>
<a href="#l32.27"></a><span id="l32.27">    * supported by the application and then get the plugin from each MIME type's</span>
<a href="#l32.28"></a><span id="l32.28">    * enabledPlugin property.  But if there's a plugin for a type, we need</span>
<a href="#l32.29"></a><span id="l32.29">    * to know about it even if it isn't enabled, since we're going to give</span>
<a href="#l32.30"></a><span id="l32.30">    * the user an option to enable it.</span>
<a href="#l32.31"></a><span id="l32.31" class="difflineminus">-   * </span>
<a href="#l32.32"></a><span id="l32.32" class="difflineplus">+   *</span>
<a href="#l32.33"></a><span id="l32.33">    * I'll also note that my reading of nsPluginTag::RegisterWithCategoryManager</span>
<a href="#l32.34"></a><span id="l32.34">    * suggests that enabledPlugin is only determined during registration</span>
<a href="#l32.35"></a><span id="l32.35">    * and does not get updated when plugin.disable_full_page_plugin_for_types</span>
<a href="#l32.36"></a><span id="l32.36">    * changes (unless modification of that preference spawns reregistration).</span>
<a href="#l32.37"></a><span id="l32.37">    * So even if we could use enabledPlugin to get the plugin that would be used,</span>
<a href="#l32.38"></a><span id="l32.38">    * we'd still need to check the pref ourselves to find out if it's enabled.</span>
<a href="#l32.39"></a><span id="l32.39">    */</span>
<a href="#l32.40"></a><span id="l32.40">   _loadPluginHandlers: function() {</span>
<a href="#l32.41"></a><span id="l32.41" class="difflineat">@@ -1417,17 +1417,17 @@ var gApplicationsPane = {</span>
<a href="#l32.42"></a><span id="l32.42">     // Select the item corresponding to the preferred action.  If the always</span>
<a href="#l32.43"></a><span id="l32.43">     // ask flag is set, it overrides the preferred action.  Otherwise we pick</span>
<a href="#l32.44"></a><span id="l32.44">     // the item identified by the preferred action (when the preferred action</span>
<a href="#l32.45"></a><span id="l32.45">     // is to use a helper app, we have to pick the specific helper app item).</span>
<a href="#l32.46"></a><span id="l32.46">     if (handlerInfo.alwaysAskBeforeHandling)</span>
<a href="#l32.47"></a><span id="l32.47">       menu.value = nsIHandlerInfo.alwaysAsk;</span>
<a href="#l32.48"></a><span id="l32.48">     else if (handlerInfo.preferredAction == nsIHandlerInfo.useHelperApp &amp;&amp;</span>
<a href="#l32.49"></a><span id="l32.49">              preferredApp)</span>
<a href="#l32.50"></a><span id="l32.50" class="difflineminus">-      menu.selectedItem = </span>
<a href="#l32.51"></a><span id="l32.51" class="difflineplus">+      menu.selectedItem =</span>
<a href="#l32.52"></a><span id="l32.52">         possibleAppMenuItems.filter(v =&gt; v.handlerApp.equals(preferredApp))[0];</span>
<a href="#l32.53"></a><span id="l32.53">     else</span>
<a href="#l32.54"></a><span id="l32.54">       menu.value = handlerInfo.preferredAction;</span>
<a href="#l32.55"></a><span id="l32.55">   },</span>
<a href="#l32.56"></a><span id="l32.56"> </span>
<a href="#l32.57"></a><span id="l32.57"> </span>
<a href="#l32.58"></a><span id="l32.58">   //**************************************************************************//</span>
<a href="#l32.59"></a><span id="l32.59">   // Sorting &amp; Filtering</span>
<a href="#l32.60"></a><span id="l32.60" class="difflineat">@@ -1573,17 +1573,17 @@ var gApplicationsPane = {</span>
<a href="#l32.61"></a><span id="l32.61">     var handlerApp;</span>
<a href="#l32.62"></a><span id="l32.62"> </span>
<a href="#l32.63"></a><span id="l32.63"> #ifdef XP_WIN</span>
<a href="#l32.64"></a><span id="l32.64">     var params = {};</span>
<a href="#l32.65"></a><span id="l32.65">     var handlerInfo = this._handledTypes[this._list.selectedItem.type];</span>
<a href="#l32.66"></a><span id="l32.66"> </span>
<a href="#l32.67"></a><span id="l32.67">     if (isFeedType(handlerInfo.type)) {</span>
<a href="#l32.68"></a><span id="l32.68">       // MIME info will be null, create a temp object.</span>
<a href="#l32.69"></a><span id="l32.69" class="difflineminus">-      params.mimeInfo = mimeSvc.getFromTypeAndExtension(handlerInfo.type, </span>
<a href="#l32.70"></a><span id="l32.70" class="difflineplus">+      params.mimeInfo = mimeSvc.getFromTypeAndExtension(handlerInfo.type,</span>
<a href="#l32.71"></a><span id="l32.71">                                                  handlerInfo.primaryExtension);</span>
<a href="#l32.72"></a><span id="l32.72">     } else {</span>
<a href="#l32.73"></a><span id="l32.73">       params.mimeInfo = handlerInfo.wrappedHandlerInfo;</span>
<a href="#l32.74"></a><span id="l32.74">     }</span>
<a href="#l32.75"></a><span id="l32.75"> </span>
<a href="#l32.76"></a><span id="l32.76">     params.title         = this._prefsBundle.getString(&quot;fpTitleChooseApp&quot;);</span>
<a href="#l32.77"></a><span id="l32.77">     params.description   = handlerInfo.description;</span>
<a href="#l32.78"></a><span id="l32.78">     params.filename      = null;</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l33.1"></a><span id="l33.1" class="difflineminus">--- a/suite/common/pref/pref-colors.js</span>
<a href="#l33.2"></a><span id="l33.2" class="difflineplus">+++ b/suite/common/pref/pref-colors.js</span>
<a href="#l33.3"></a><span id="l33.3" class="difflineat">@@ -14,13 +14,13 @@ function ToggleCustomColorPickers(aCheck</span>
<a href="#l33.4"></a><span id="l33.4">   TogglePickerDisability(aChecked, &quot;browserBackgroundColor&quot;);</span>
<a href="#l33.5"></a><span id="l33.5"> }</span>
<a href="#l33.6"></a><span id="l33.6"> </span>
<a href="#l33.7"></a><span id="l33.7"> function TogglePickerDisability(aDisable, aPicker)</span>
<a href="#l33.8"></a><span id="l33.8"> {</span>
<a href="#l33.9"></a><span id="l33.9">   var element = document.getElementById(aPicker);</span>
<a href="#l33.10"></a><span id="l33.10">   aDisable = aDisable ||</span>
<a href="#l33.11"></a><span id="l33.11">     document.getElementById(element.getAttribute(&quot;preference&quot;)).locked;</span>
<a href="#l33.12"></a><span id="l33.12" class="difflineminus">- </span>
<a href="#l33.13"></a><span id="l33.13" class="difflineplus">+</span>
<a href="#l33.14"></a><span id="l33.14">   element.disabled = aDisable;</span>
<a href="#l33.15"></a><span id="l33.15">   element = document.getElementById(aPicker + &quot;Label&quot;);</span>
<a href="#l33.16"></a><span id="l33.16">   element.disabled = aDisable;</span>
<a href="#l33.17"></a><span id="l33.17"> }</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l34.1"></a><span id="l34.1" class="difflineminus">--- a/suite/common/pref/pref-fonts.js</span>
<a href="#l34.2"></a><span id="l34.2" class="difflineplus">+++ b/suite/common/pref/pref-fonts.js</span>
<a href="#l34.3"></a><span id="l34.3" class="difflineat">@@ -166,17 +166,17 @@ function ReadFontLanguageGroup()</span>
<a href="#l34.4"></a><span id="l34.4">       }</span>
<a href="#l34.5"></a><span id="l34.5">     }</span>
<a href="#l34.6"></a><span id="l34.6">   }</span>
<a href="#l34.7"></a><span id="l34.7"> }</span>
<a href="#l34.8"></a><span id="l34.8"> </span>
<a href="#l34.9"></a><span id="l34.9"> function ReadFontSelection(aElement)</span>
<a href="#l34.10"></a><span id="l34.10"> {</span>
<a href="#l34.11"></a><span id="l34.11">   // Determine the appropriate value to select, for the following cases:</span>
<a href="#l34.12"></a><span id="l34.12" class="difflineminus">-  // - there is no setting </span>
<a href="#l34.13"></a><span id="l34.13" class="difflineplus">+  // - there is no setting</span>
<a href="#l34.14"></a><span id="l34.14">   // - the font selected by the user is no longer present (e.g. deleted from</span>
<a href="#l34.15"></a><span id="l34.15">   //   fonts folder)</span>
<a href="#l34.16"></a><span id="l34.16">   var preference = document.getElementById(aElement.getAttribute(&quot;preference&quot;));</span>
<a href="#l34.17"></a><span id="l34.17">   if (preference.value)</span>
<a href="#l34.18"></a><span id="l34.18">   {</span>
<a href="#l34.19"></a><span id="l34.19">     var fontItems = aElement.getElementsByAttribute(&quot;value&quot;, preference.value);</span>
<a href="#l34.20"></a><span id="l34.20"> </span>
<a href="#l34.21"></a><span id="l34.21">     // There is a setting that actually is in the list. Respect it.</span>
<a href="#l34.22"></a><span id="l34.22" class="difflineat">@@ -209,13 +209,13 @@ function ReadFontPref(aElement, aDefault</span>
<a href="#l34.23"></a><span id="l34.23">   return preference.value || aDefaultValue;</span>
<a href="#l34.24"></a><span id="l34.24"> }</span>
<a href="#l34.25"></a><span id="l34.25"> </span>
<a href="#l34.26"></a><span id="l34.26"> function ReadUseDocumentFonts()</span>
<a href="#l34.27"></a><span id="l34.27"> {</span>
<a href="#l34.28"></a><span id="l34.28">   var preference = document.getElementById(&quot;browser.display.use_document_fonts&quot;);</span>
<a href="#l34.29"></a><span id="l34.29">   return preference.value == 1;</span>
<a href="#l34.30"></a><span id="l34.30"> }</span>
<a href="#l34.31"></a><span id="l34.31" class="difflineminus">- </span>
<a href="#l34.32"></a><span id="l34.32" class="difflineplus">+</span>
<a href="#l34.33"></a><span id="l34.33"> function WriteUseDocumentFonts(aUseDocumentFonts)</span>
<a href="#l34.34"></a><span id="l34.34"> {</span>
<a href="#l34.35"></a><span id="l34.35">   return aUseDocumentFonts.checked ? 1 : 0;</span>
<a href="#l34.36"></a><span id="l34.36"> }</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l35.1"></a><span id="l35.1" class="difflineminus">--- a/suite/common/pref/pref-history.js</span>
<a href="#l35.2"></a><span id="l35.2" class="difflineplus">+++ b/suite/common/pref/pref-history.js</span>
<a href="#l35.3"></a><span id="l35.3" class="difflineat">@@ -1,14 +1,14 @@</span>
<a href="#l35.4"></a><span id="l35.4"> /* This Source Code Form is subject to the terms of the Mozilla Public</span>
<a href="#l35.5"></a><span id="l35.5"> * License, v. 2.0. If a copy of the MPL was not distributed with this</span>
<a href="#l35.6"></a><span id="l35.6"> * file, You can obtain one at http://mozilla.org/MPL/2.0/. */</span>
<a href="#l35.7"></a><span id="l35.7"> </span>
<a href="#l35.8"></a><span id="l35.8"> function Startup()</span>
<a href="#l35.9"></a><span id="l35.9" class="difflineminus">-{ </span>
<a href="#l35.10"></a><span id="l35.10" class="difflineplus">+{</span>
<a href="#l35.11"></a><span id="l35.11">   var urlbarHistButton = document.getElementById(&quot;ClearUrlBarHistoryButton&quot;);</span>
<a href="#l35.12"></a><span id="l35.12">   var lastUrlPref = document.getElementById(&quot;general.open_location.last_url&quot;);</span>
<a href="#l35.13"></a><span id="l35.13">   var locBarPref = document.getElementById(&quot;browser.urlbar.historyEnabled&quot;);</span>
<a href="#l35.14"></a><span id="l35.14"> </span>
<a href="#l35.15"></a><span id="l35.15">   var isBtnDisabled = lastUrlPref.locked || !locBarPref.value;</span>
<a href="#l35.16"></a><span id="l35.16"> </span>
<a href="#l35.17"></a><span id="l35.17">   try {</span>
<a href="#l35.18"></a><span id="l35.18">     if (!isBtnDisabled &amp;&amp; !lastUrlPref.hasUserValue) {</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l36.1"></a><span id="l36.1" class="difflineminus">--- a/suite/common/pref/pref-http.js</span>
<a href="#l36.2"></a><span id="l36.2" class="difflineplus">+++ b/suite/common/pref/pref-http.js</span>
<a href="#l36.3"></a><span id="l36.3" class="difflineat">@@ -3,17 +3,17 @@</span>
<a href="#l36.4"></a><span id="l36.4">  * License, v. 2.0. If a copy of the MPL was not distributed with this</span>
<a href="#l36.5"></a><span id="l36.5">  * file, You can obtain one at http://mozilla.org/MPL/2.0/. */</span>
<a href="#l36.6"></a><span id="l36.6"> </span>
<a href="#l36.7"></a><span id="l36.7"> function Startup()</span>
<a href="#l36.8"></a><span id="l36.8"> {</span>
<a href="#l36.9"></a><span id="l36.9">   CheckPipelining();</span>
<a href="#l36.10"></a><span id="l36.10">   CheckPipeliningProxy();</span>
<a href="#l36.11"></a><span id="l36.11"> }</span>
<a href="#l36.12"></a><span id="l36.12" class="difflineminus">- </span>
<a href="#l36.13"></a><span id="l36.13" class="difflineplus">+</span>
<a href="#l36.14"></a><span id="l36.14"> function CheckPipelining()</span>
<a href="#l36.15"></a><span id="l36.15"> {</span>
<a href="#l36.16"></a><span id="l36.16">   var prefHTTPVersion = document.getElementById(&quot;network.http.version&quot;);</span>
<a href="#l36.17"></a><span id="l36.17"> </span>
<a href="#l36.18"></a><span id="l36.18">   var enabled = prefHTTPVersion.value == &quot;1.1&quot;;</span>
<a href="#l36.19"></a><span id="l36.19">   EnableElementById(&quot;enablePipelining&quot;, enabled, false);</span>
<a href="#l36.20"></a><span id="l36.20"> }</span>
<a href="#l36.21"></a><span id="l36.21"> </span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l37.1"></a><span id="l37.1" class="difflineminus">--- a/suite/common/pref/pref-languages.js</span>
<a href="#l37.2"></a><span id="l37.2" class="difflineplus">+++ b/suite/common/pref/pref-languages.js</span>
<a href="#l37.3"></a><span id="l37.3" class="difflineat">@@ -144,17 +144,17 @@ function MoveUp()</span>
<a href="#l37.4"></a><span id="l37.4">   var selected = gActiveLanguages.selectedItem;</span>
<a href="#l37.5"></a><span id="l37.5">   var before = selected.previousSibling;</span>
<a href="#l37.6"></a><span id="l37.6">   if (before)</span>
<a href="#l37.7"></a><span id="l37.7">   {</span>
<a href="#l37.8"></a><span id="l37.8">     before.parentNode.insertBefore(selected, before);</span>
<a href="#l37.9"></a><span id="l37.9">     gActiveLanguages.selectItem(selected);</span>
<a href="#l37.10"></a><span id="l37.10">     gActiveLanguages.ensureElementIsVisible(selected);</span>
<a href="#l37.11"></a><span id="l37.11">   }</span>
<a href="#l37.12"></a><span id="l37.12" class="difflineminus">- </span>
<a href="#l37.13"></a><span id="l37.13" class="difflineplus">+</span>
<a href="#l37.14"></a><span id="l37.14">   SelectLanguage();</span>
<a href="#l37.15"></a><span id="l37.15">   gActiveLanguages.doCommand();</span>
<a href="#l37.16"></a><span id="l37.16"> }</span>
<a href="#l37.17"></a><span id="l37.17"> </span>
<a href="#l37.18"></a><span id="l37.18"> function MoveDown()</span>
<a href="#l37.19"></a><span id="l37.19"> {</span>
<a href="#l37.20"></a><span id="l37.20">   var selected = gActiveLanguages.selectedItem;</span>
<a href="#l37.21"></a><span id="l37.21">   if (selected.nextSibling)</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l38.1"></a><span id="l38.1" class="difflineminus">--- a/suite/common/pref/pref-navigator.js</span>
<a href="#l38.2"></a><span id="l38.2" class="difflineplus">+++ b/suite/common/pref/pref-navigator.js</span>
<a href="#l38.3"></a><span id="l38.3" class="difflineat">@@ -135,17 +135,17 @@ function UpdateHomePagePrefs()</span>
<a href="#l38.4"></a><span id="l38.4">     {</span>
<a href="#l38.5"></a><span id="l38.5">       var pref = GetHomePagePref(i) || AddHomePagePref(i);</span>
<a href="#l38.6"></a><span id="l38.6">       pref.value = homePageGroup[i];</span>
<a href="#l38.7"></a><span id="l38.7">     }</span>
<a href="#l38.8"></a><span id="l38.8">   }</span>
<a href="#l38.9"></a><span id="l38.9"> </span>
<a href="#l38.10"></a><span id="l38.10">   // work around bug 410562:</span>
<a href="#l38.11"></a><span id="l38.11">   // reset unneeded preferences on dialogaccept only</span>
<a href="#l38.12"></a><span id="l38.12" class="difflineminus">-  </span>
<a href="#l38.13"></a><span id="l38.13" class="difflineplus">+</span>
<a href="#l38.14"></a><span id="l38.14">   // update pref count watermark before setting new number of homepages</span>
<a href="#l38.15"></a><span id="l38.15">   var alreadyRequested = (gHomePagePrefPeak &gt; 0);</span>
<a href="#l38.16"></a><span id="l38.16">   var oldCount = GetHomePagePrefCount();</span>
<a href="#l38.17"></a><span id="l38.17">   if (gHomePagePrefPeak &lt; oldCount)</span>
<a href="#l38.18"></a><span id="l38.18">     gHomePagePrefPeak = oldCount;</span>
<a href="#l38.19"></a><span id="l38.19">   SetHomePagePrefCount(newCount);</span>
<a href="#l38.20"></a><span id="l38.20"> </span>
<a href="#l38.21"></a><span id="l38.21">   var needCleanup = (newCount &lt; gHomePagePrefPeak);</span>
<a href="#l38.22"></a><span id="l38.22" class="difflineat">@@ -229,17 +229,17 @@ function SetHomePageToCurrentGroup()</span>
<a href="#l38.23"></a><span id="l38.23"> function SetHomePageToDefaultPage()</span>
<a href="#l38.24"></a><span id="l38.24"> {</span>
<a href="#l38.25"></a><span id="l38.25">   UpdateHomePageList(gDefaultHomePage);</span>
<a href="#l38.26"></a><span id="l38.26"> }</span>
<a href="#l38.27"></a><span id="l38.27"> </span>
<a href="#l38.28"></a><span id="l38.28"> function Startup()</span>
<a href="#l38.29"></a><span id="l38.29"> {</span>
<a href="#l38.30"></a><span id="l38.30">   // homepage groups can have an arbitrary number of &lt;preference&gt;s,</span>
<a href="#l38.31"></a><span id="l38.31" class="difflineminus">-  // except for the default (0), thus we create them manually here </span>
<a href="#l38.32"></a><span id="l38.32" class="difflineplus">+  // except for the default (0), thus we create them manually here</span>
<a href="#l38.33"></a><span id="l38.33">   gPreferences = document.getElementById(&quot;navigator_preferences&quot;);</span>
<a href="#l38.34"></a><span id="l38.34">   var count = GetHomePagePrefCount();</span>
<a href="#l38.35"></a><span id="l38.35">   var homePageGroup = GetHomePagePref(0).value + &quot;\n&quot;;</span>
<a href="#l38.36"></a><span id="l38.36">   for (var i = 1; i &lt; count; ++i)</span>
<a href="#l38.37"></a><span id="l38.37">     homePageGroup += AddHomePagePref(i).value + &quot;\n&quot;;</span>
<a href="#l38.38"></a><span id="l38.38">   gDefaultHomePage = CanonifyURLList(GetHomePagePref(0).defaultValue);</span>
<a href="#l38.39"></a><span id="l38.39">   SetHomePageValue(homePageGroup);</span>
<a href="#l38.40"></a><span id="l38.40">   UpdateHomePageButtons();</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l39.1"></a><span id="l39.1" class="difflineminus">--- a/suite/common/pref/pref-offlineapps.js</span>
<a href="#l39.2"></a><span id="l39.2" class="difflineplus">+++ b/suite/common/pref/pref-offlineapps.js</span>
<a href="#l39.3"></a><span id="l39.3" class="difflineat">@@ -1,12 +1,12 @@</span>
<a href="#l39.4"></a><span id="l39.4"> /* This Source Code Form is subject to the terms of the Mozilla Public</span>
<a href="#l39.5"></a><span id="l39.5">  * License, v. 2.0. If a copy of the MPL was not distributed with this</span>
<a href="#l39.6"></a><span id="l39.6">  * file, You can obtain one at http://mozilla.org/MPL/2.0/. */</span>
<a href="#l39.7"></a><span id="l39.7" class="difflineminus">- </span>
<a href="#l39.8"></a><span id="l39.8" class="difflineplus">+</span>
<a href="#l39.9"></a><span id="l39.9"> Components.utils.import(&quot;resource://gre/modules/DownloadUtils.jsm&quot;);</span>
<a href="#l39.10"></a><span id="l39.10"> Components.utils.import(&quot;resource://gre/modules/Services.jsm&quot;);</span>
<a href="#l39.11"></a><span id="l39.11"> </span>
<a href="#l39.12"></a><span id="l39.12"> function Startup()</span>
<a href="#l39.13"></a><span id="l39.13"> {</span>
<a href="#l39.14"></a><span id="l39.14">   OfflineAppsObserver.init();</span>
<a href="#l39.15"></a><span id="l39.15"> </span>
<a href="#l39.16"></a><span id="l39.16">   let always = document.getElementById(&quot;offline-apps.allow_by_default&quot;).value;</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l40.1"></a><span id="l40.1" class="difflineminus">--- a/suite/common/pref/pref-popups.js</span>
<a href="#l40.2"></a><span id="l40.2" class="difflineplus">+++ b/suite/common/pref/pref-popups.js</span>
<a href="#l40.3"></a><span id="l40.3" class="difflineat">@@ -25,17 +25,17 @@ function SetLists()</span>
<a href="#l40.4"></a><span id="l40.4"> </span>
<a href="#l40.5"></a><span id="l40.5">   var pref = document.getElementById(&quot;privacy.popups.remove_blacklist&quot;);</span>
<a href="#l40.6"></a><span id="l40.6">   if (pref.value)</span>
<a href="#l40.7"></a><span id="l40.7">   {</span>
<a href="#l40.8"></a><span id="l40.8">     var enumerator = permissionManager.enumerator;</span>
<a href="#l40.9"></a><span id="l40.9">     var uris = [];</span>
<a href="#l40.10"></a><span id="l40.10"> </span>
<a href="#l40.11"></a><span id="l40.11">     while (enumerator.hasMoreElements())</span>
<a href="#l40.12"></a><span id="l40.12" class="difflineminus">-    {                </span>
<a href="#l40.13"></a><span id="l40.13" class="difflineplus">+    {</span>
<a href="#l40.14"></a><span id="l40.14">       var permission = enumerator.getNext();</span>
<a href="#l40.15"></a><span id="l40.15">       if (permission instanceof nsIPermission)</span>
<a href="#l40.16"></a><span id="l40.16">       {</span>
<a href="#l40.17"></a><span id="l40.17">         if ((permission.type == kPopupType) &amp;&amp;</span>
<a href="#l40.18"></a><span id="l40.18">             (permission.capability == nsIPermissionManager.DENY_ACTION))</span>
<a href="#l40.19"></a><span id="l40.19">           uris.push(permission.principal.URI);</span>
<a href="#l40.20"></a><span id="l40.20">       }</span>
<a href="#l40.21"></a><span id="l40.21">     }</span>
<a href="#l40.22"></a><span id="l40.22" class="difflineat">@@ -45,31 +45,31 @@ function SetLists()</span>
<a href="#l40.23"></a><span id="l40.23"> </span>
<a href="#l40.24"></a><span id="l40.24">     pref.value = false;</span>
<a href="#l40.25"></a><span id="l40.25">   }</span>
<a href="#l40.26"></a><span id="l40.26"> </span>
<a href="#l40.27"></a><span id="l40.27">   pref = document.getElementById(&quot;privacy.popups.prefill_whitelist&quot;);</span>
<a href="#l40.28"></a><span id="l40.28">   if (pref.value)</span>
<a href="#l40.29"></a><span id="l40.29">   {</span>
<a href="#l40.30"></a><span id="l40.30">     try</span>
<a href="#l40.31"></a><span id="l40.31" class="difflineminus">-    { </span>
<a href="#l40.32"></a><span id="l40.32" class="difflineplus">+    {</span>
<a href="#l40.33"></a><span id="l40.33">       var whitelist = document.getElementById(&quot;privacy.popups.default_whitelist&quot;).value;</span>
<a href="#l40.34"></a><span id="l40.34">       var hosts = whitelist.split(&quot;,&quot;);</span>
<a href="#l40.35"></a><span id="l40.35"> </span>
<a href="#l40.36"></a><span id="l40.36">       for (var i in hosts)</span>
<a href="#l40.37"></a><span id="l40.37">       {</span>
<a href="#l40.38"></a><span id="l40.38">         var host = &quot;http://&quot; + hosts[i];</span>
<a href="#l40.39"></a><span id="l40.39">         var uri = Services.io.newURI(host, null, null);</span>
<a href="#l40.40"></a><span id="l40.40">         permissionManager.add(uri, kPopupType, true);</span>
<a href="#l40.41"></a><span id="l40.41">       }</span>
<a href="#l40.42"></a><span id="l40.42" class="difflineminus">-    } </span>
<a href="#l40.43"></a><span id="l40.43" class="difflineplus">+    }</span>
<a href="#l40.44"></a><span id="l40.44">     catch (ex) {}</span>
<a href="#l40.45"></a><span id="l40.45"> </span>
<a href="#l40.46"></a><span id="l40.46">     pref.value = false;</span>
<a href="#l40.47"></a><span id="l40.47" class="difflineminus">-  }  </span>
<a href="#l40.48"></a><span id="l40.48" class="difflineplus">+  }</span>
<a href="#l40.49"></a><span id="l40.49"> }</span>
<a href="#l40.50"></a><span id="l40.50"> </span>
<a href="#l40.51"></a><span id="l40.51"> function SetButtons()</span>
<a href="#l40.52"></a><span id="l40.52"> {</span>
<a href="#l40.53"></a><span id="l40.53">   var prefString = document.getElementById(&quot;popupPolicy&quot;)</span>
<a href="#l40.54"></a><span id="l40.54">                            .getAttribute(&quot;preference&quot;);</span>
<a href="#l40.55"></a><span id="l40.55">   var enable = document.getElementById(prefString).value;</span>
<a href="#l40.56"></a><span id="l40.56">   EnableElementById(&quot;exceptionsButton&quot;, enable, false);</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l41.1"></a><span id="l41.1" class="difflineminus">--- a/suite/common/pref/pref-proxies.js</span>
<a href="#l41.2"></a><span id="l41.2" class="difflineplus">+++ b/suite/common/pref/pref-proxies.js</span>
<a href="#l41.3"></a><span id="l41.3" class="difflineat">@@ -29,17 +29,17 @@ function Startup()</span>
<a href="#l41.4"></a><span id="l41.4"> </span>
<a href="#l41.5"></a><span id="l41.5">   // Check for system proxy settings class and unhide UI if present</span>
<a href="#l41.6"></a><span id="l41.6">   if (&quot;@mozilla.org/system-proxy-settings;1&quot; in Components.classes)</span>
<a href="#l41.7"></a><span id="l41.7">     document.getElementById(&quot;systemPref&quot;).hidden = false;</span>
<a href="#l41.8"></a><span id="l41.8"> </span>
<a href="#l41.9"></a><span id="l41.9">   // Calculate a sane default for network.proxy.share_proxy_settings.</span>
<a href="#l41.10"></a><span id="l41.10">   if (gShareSettings.value == null)</span>
<a href="#l41.11"></a><span id="l41.11">     gShareSettings.value = DefaultForShareSettingsPref();</span>
<a href="#l41.12"></a><span id="l41.12" class="difflineminus">-  </span>
<a href="#l41.13"></a><span id="l41.13" class="difflineplus">+</span>
<a href="#l41.14"></a><span id="l41.14">   // The pref value 3 (kObsoleteProxy) for network.proxy.type is unused to</span>
<a href="#l41.15"></a><span id="l41.15">   // maintain backwards compatibility. Treat 3 (kObsoleteProxy) equally to</span>
<a href="#l41.16"></a><span id="l41.16">   // 0 (kNoProxy). See bug 115720.</span>
<a href="#l41.17"></a><span id="l41.17">   if (gProxyType.value == kObsoleteProxy)</span>
<a href="#l41.18"></a><span id="l41.18">     gProxyType.value = kNoProxy;</span>
<a href="#l41.19"></a><span id="l41.19"> </span>
<a href="#l41.20"></a><span id="l41.20">   DoEnabling();</span>
<a href="#l41.21"></a><span id="l41.21"> }</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l42.1"></a><span id="l42.1" class="difflineminus">--- a/suite/common/pref/pref-smartupdate.js</span>
<a href="#l42.2"></a><span id="l42.2" class="difflineplus">+++ b/suite/common/pref/pref-smartupdate.js</span>
<a href="#l42.3"></a><span id="l42.3" class="difflineat">@@ -31,17 +31,17 @@ function Startup()</span>
<a href="#l42.4"></a><span id="l42.4">  * app.update.enabled</span>
<a href="#l42.5"></a><span id="l42.5">  * - boolean:</span>
<a href="#l42.6"></a><span id="l42.6">  * - true if updates to the application are enabled, false otherwise</span>
<a href="#l42.7"></a><span id="l42.7">  * extensions.update.enabled</span>
<a href="#l42.8"></a><span id="l42.8">  * - boolean:</span>
<a href="#l42.9"></a><span id="l42.9">  * - true if updates to extensions and themes are enabled, false otherwise</span>
<a href="#l42.10"></a><span id="l42.10">  * app.update.auto</span>
<a href="#l42.11"></a><span id="l42.11">  * - true if updates should be automatically downloaded and installed,</span>
<a href="#l42.12"></a><span id="l42.12" class="difflineminus">- *   false if the user should be asked what he wants to do when an </span>
<a href="#l42.13"></a><span id="l42.13" class="difflineplus">+ *   false if the user should be asked what he wants to do when an</span>
<a href="#l42.14"></a><span id="l42.14">  *   update is available</span>
<a href="#l42.15"></a><span id="l42.15">  */</span>
<a href="#l42.16"></a><span id="l42.16"> function UpdateAddonsItems()</span>
<a href="#l42.17"></a><span id="l42.17"> {</span>
<a href="#l42.18"></a><span id="l42.18">   var addOnsCheck = !document.getElementById(&quot;xpinstall.enabled&quot;).value;</span>
<a href="#l42.19"></a><span id="l42.19"> </span>
<a href="#l42.20"></a><span id="l42.20">   document.getElementById(&quot;addOnsUpdatesEnabled&quot;).disabled =</span>
<a href="#l42.21"></a><span id="l42.21">     addOnsCheck ||</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l43.1"></a><span id="l43.1" class="difflineminus">--- a/suite/common/pref/pref-spelling.js</span>
<a href="#l43.2"></a><span id="l43.2" class="difflineplus">+++ b/suite/common/pref/pref-spelling.js</span>
<a href="#l43.3"></a><span id="l43.3" class="difflineat">@@ -41,17 +41,17 @@ function InitLanguageMenu() {</span>
<a href="#l43.4"></a><span id="l43.4">   // RFC 1766 strings to UI strings.</span>
<a href="#l43.5"></a><span id="l43.5"> </span>
<a href="#l43.6"></a><span id="l43.6">   // Load the language string bundle.</span>
<a href="#l43.7"></a><span id="l43.7">   var languageBundle = document.getElementById(&quot;languageNamesBundle&quot;);</span>
<a href="#l43.8"></a><span id="l43.8">   var regionBundle = null;</span>
<a href="#l43.9"></a><span id="l43.9">   // If we have a language string bundle, load the region string bundle.</span>
<a href="#l43.10"></a><span id="l43.10">   if (languageBundle)</span>
<a href="#l43.11"></a><span id="l43.11">     regionBundle = document.getElementById(&quot;regionNamesBundle&quot;);</span>
<a href="#l43.12"></a><span id="l43.12" class="difflineminus">-  </span>
<a href="#l43.13"></a><span id="l43.13" class="difflineplus">+</span>
<a href="#l43.14"></a><span id="l43.14">   var menuStr2;</span>
<a href="#l43.15"></a><span id="l43.15">   var isoStrArray;</span>
<a href="#l43.16"></a><span id="l43.16">   var langId;</span>
<a href="#l43.17"></a><span id="l43.17">   var langLabel;</span>
<a href="#l43.18"></a><span id="l43.18"> </span>
<a href="#l43.19"></a><span id="l43.19">   for (let i = 0; i &lt; count; i++) {</span>
<a href="#l43.20"></a><span id="l43.20">     try {</span>
<a href="#l43.21"></a><span id="l43.21">       langId = dictList[i];</span>
<a href="#l43.22"></a><span id="l43.22" class="difflineat">@@ -73,17 +73,17 @@ function InitLanguageMenu() {</span>
<a href="#l43.23"></a><span id="l43.23">         langLabel = langId;</span>
<a href="#l43.24"></a><span id="l43.24">     } catch (ex) {</span>
<a href="#l43.25"></a><span id="l43.25">       // getString throws an exception when a key is not found in the</span>
<a href="#l43.26"></a><span id="l43.26">       // bundle. In that case, just use the original dictList string.</span>
<a href="#l43.27"></a><span id="l43.27">       langLabel = langId;</span>
<a href="#l43.28"></a><span id="l43.28">     }</span>
<a href="#l43.29"></a><span id="l43.29">     dictList[i] = [langLabel, langId];</span>
<a href="#l43.30"></a><span id="l43.30">   }</span>
<a href="#l43.31"></a><span id="l43.31" class="difflineminus">-  </span>
<a href="#l43.32"></a><span id="l43.32" class="difflineplus">+</span>
<a href="#l43.33"></a><span id="l43.33">   // sort by locale-aware collation</span>
<a href="#l43.34"></a><span id="l43.34">   dictList.sort(</span>
<a href="#l43.35"></a><span id="l43.35">     function compareFn(a, b) {</span>
<a href="#l43.36"></a><span id="l43.36">       return a[0].localeCompare(b[0]);</span>
<a href="#l43.37"></a><span id="l43.37">     }</span>
<a href="#l43.38"></a><span id="l43.38">   );</span>
<a href="#l43.39"></a><span id="l43.39"> </span>
<a href="#l43.40"></a><span id="l43.40">   var languageMenuList = document.getElementById(&quot;languageMenuList&quot;);</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l44.1"></a><span id="l44.1" class="difflineminus">--- a/suite/common/pref/pref-sync.js</span>
<a href="#l44.2"></a><span id="l44.2" class="difflineplus">+++ b/suite/common/pref/pref-sync.js</span>
<a href="#l44.3"></a><span id="l44.3" class="difflineat">@@ -127,17 +127,17 @@ var gSyncPane = {</span>
<a href="#l44.4"></a><span id="l44.4">   },</span>
<a href="#l44.5"></a><span id="l44.5"> </span>
<a href="#l44.6"></a><span id="l44.6">   openAddDevice: function () {</span>
<a href="#l44.7"></a><span id="l44.7">     if (!Weave.Utils.ensureMPUnlocked())</span>
<a href="#l44.8"></a><span id="l44.8">       return;</span>
<a href="#l44.9"></a><span id="l44.9">     let win = Services.wm.getMostRecentWindow(&quot;Sync:AddDevice&quot;);</span>
<a href="#l44.10"></a><span id="l44.10">     if (win)</span>
<a href="#l44.11"></a><span id="l44.11">       win.focus();</span>
<a href="#l44.12"></a><span id="l44.12" class="difflineminus">-    else </span>
<a href="#l44.13"></a><span id="l44.13" class="difflineplus">+    else</span>
<a href="#l44.14"></a><span id="l44.14">       window.openDialog(&quot;chrome://communicator/content/sync/syncAddDevice.xul&quot;,</span>
<a href="#l44.15"></a><span id="l44.15">                         &quot;syncAddDevice&quot;, &quot;centerscreen,chrome,resizable=no&quot;);</span>
<a href="#l44.16"></a><span id="l44.16">   },</span>
<a href="#l44.17"></a><span id="l44.17"> </span>
<a href="#l44.18"></a><span id="l44.18">   resetSync: function () {</span>
<a href="#l44.19"></a><span id="l44.19">     this.openSetup(true);</span>
<a href="#l44.20"></a><span id="l44.20">   }</span>
<a href="#l44.21"></a><span id="l44.21"> };</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l45.1"></a><span id="l45.1" class="difflineminus">--- a/suite/common/sidebar/customize.js</span>
<a href="#l45.2"></a><span id="l45.2" class="difflineplus">+++ b/suite/common/sidebar/customize.js</span>
<a href="#l45.3"></a><span id="l45.3" class="difflineat">@@ -75,17 +75,17 @@ function sidebar_customize_init()</span>
<a href="#l45.4"></a><span id="l45.4">     }</span>
<a href="#l45.5"></a><span id="l45.5">   }</span>
<a href="#l45.6"></a><span id="l45.6"> </span>
<a href="#l45.7"></a><span id="l45.7">   var links =</span>
<a href="#l45.8"></a><span id="l45.8">     all_panels.database.GetSources(RDF.GetResource(NC + &quot;haslink&quot;),</span>
<a href="#l45.9"></a><span id="l45.9">                                    RDF.GetLiteral(&quot;true&quot;), true);</span>
<a href="#l45.10"></a><span id="l45.10"> </span>
<a href="#l45.11"></a><span id="l45.11">   while (links.hasMoreElements()) {</span>
<a href="#l45.12"></a><span id="l45.12" class="difflineminus">-    var folder = </span>
<a href="#l45.13"></a><span id="l45.13" class="difflineplus">+    var folder =</span>
<a href="#l45.14"></a><span id="l45.14">       links.getNext().QueryInterface(Components.interfaces.nsIRDFResource);</span>
<a href="#l45.15"></a><span id="l45.15">     var folder_name = folder.Value;</span>
<a href="#l45.16"></a><span id="l45.16">     debug(&quot;+++ fixing up remote container &quot; + folder_name + &quot;\n&quot;);</span>
<a href="#l45.17"></a><span id="l45.17">     fixup_remote_container(folder_name);</span>
<a href="#l45.18"></a><span id="l45.18">   }</span>
<a href="#l45.19"></a><span id="l45.19"> </span>
<a href="#l45.20"></a><span id="l45.20">   sizeToContent();</span>
<a href="#l45.21"></a><span id="l45.21"> }</span>
<a href="#l45.22"></a><span id="l45.22" class="difflineat">@@ -167,32 +167,32 @@ function get_attr(registry,service,attr_</span>
<a href="#l45.23"></a><span id="l45.23"> function SelectChangeForOtherPanels(event, target)</span>
<a href="#l45.24"></a><span id="l45.24"> {</span>
<a href="#l45.25"></a><span id="l45.25">   enable_buttons_for_other_panels();</span>
<a href="#l45.26"></a><span id="l45.26"> }</span>
<a href="#l45.27"></a><span id="l45.27"> </span>
<a href="#l45.28"></a><span id="l45.28"> function ClickOnOtherPanels(event)</span>
<a href="#l45.29"></a><span id="l45.29"> {</span>
<a href="#l45.30"></a><span id="l45.30">   var tree = document.getElementById(&quot;other-panels&quot;);</span>
<a href="#l45.31"></a><span id="l45.31" class="difflineminus">-  </span>
<a href="#l45.32"></a><span id="l45.32" class="difflineplus">+</span>
<a href="#l45.33"></a><span id="l45.33">   var rowIndex = -1;</span>
<a href="#l45.34"></a><span id="l45.34">   if (event.type == &quot;click&quot; &amp;&amp; event.button == 0) {</span>
<a href="#l45.35"></a><span id="l45.35">     var b = tree.treeBoxObject;</span>
<a href="#l45.36"></a><span id="l45.36">     var cell = b.getCellAt(event.clientX, event.clientY);</span>
<a href="#l45.37"></a><span id="l45.37"> </span>
<a href="#l45.38"></a><span id="l45.38">     if (cell.childElt == &quot;twisty&quot; || event.detail == 2) {</span>
<a href="#l45.39"></a><span id="l45.39">       rowIndex = cell.row;</span>
<a href="#l45.40"></a><span id="l45.40">     }</span>
<a href="#l45.41"></a><span id="l45.41">   }</span>
<a href="#l45.42"></a><span id="l45.42"> </span>
<a href="#l45.43"></a><span id="l45.43">   if (rowIndex &lt; 0) return;</span>
<a href="#l45.44"></a><span id="l45.44" class="difflineminus">-  </span>
<a href="#l45.45"></a><span id="l45.45" class="difflineplus">+</span>
<a href="#l45.46"></a><span id="l45.46">   var treeitem = tree.contentView.getItemAtIndex(rowIndex);</span>
<a href="#l45.47"></a><span id="l45.47">   var res = RDF.GetResource(treeitem.id);</span>
<a href="#l45.48"></a><span id="l45.48" class="difflineminus">-  </span>
<a href="#l45.49"></a><span id="l45.49" class="difflineplus">+</span>
<a href="#l45.50"></a><span id="l45.50">   if (treeitem.getAttribute('container') == 'true') {</span>
<a href="#l45.51"></a><span id="l45.51">     if (treeitem.getAttribute('open') == 'true') {</span>
<a href="#l45.52"></a><span id="l45.52">       var link = treeitem.getAttribute('link');</span>
<a href="#l45.53"></a><span id="l45.53">       var loaded_link = treeitem.getAttribute('loaded_link');</span>
<a href="#l45.54"></a><span id="l45.54">       if (link != '' &amp;&amp; !loaded_link) {</span>
<a href="#l45.55"></a><span id="l45.55">         debug(&quot;Has remote datasource: &quot;+link);</span>
<a href="#l45.56"></a><span id="l45.56">         add_datasource_to_other_panels(link);</span>
<a href="#l45.57"></a><span id="l45.57">         treeitem.setAttribute('loaded_link', 'true');</span>
<a href="#l45.58"></a><span id="l45.58" class="difflineat">@@ -294,17 +294,17 @@ function PreviewPanel()</span>
<a href="#l45.59"></a><span id="l45.59">     }</span>
<a href="#l45.60"></a><span id="l45.60">   }</span>
<a href="#l45.61"></a><span id="l45.61"> }</span>
<a href="#l45.62"></a><span id="l45.62"> </span>
<a href="#l45.63"></a><span id="l45.63"> // Add the selected panel(s).</span>
<a href="#l45.64"></a><span id="l45.64"> function AddPanel()</span>
<a href="#l45.65"></a><span id="l45.65"> {</span>
<a href="#l45.66"></a><span id="l45.66">   var added = -1;</span>
<a href="#l45.67"></a><span id="l45.67" class="difflineminus">-  </span>
<a href="#l45.68"></a><span id="l45.68" class="difflineplus">+</span>
<a href="#l45.69"></a><span id="l45.69">   var tree = document.getElementById('other-panels');</span>
<a href="#l45.70"></a><span id="l45.70">   var database = tree.database;</span>
<a href="#l45.71"></a><span id="l45.71">   var sel = tree.view.selection;</span>
<a href="#l45.72"></a><span id="l45.72">   var ranges = sel.getRangeCount();</span>
<a href="#l45.73"></a><span id="l45.73">   for (var range = 0; range &lt; ranges; ++range) {</span>
<a href="#l45.74"></a><span id="l45.74">     var min = {}, max = {};</span>
<a href="#l45.75"></a><span id="l45.75">     sel.getRangeAt(range, min, max);</span>
<a href="#l45.76"></a><span id="l45.76">     for (var index = min.value; index &lt;= max.value; ++index) {</span>
<a href="#l45.77"></a><span id="l45.77" class="difflineat">@@ -337,17 +337,17 @@ function add_node_to_current_list(regist</span>
<a href="#l45.78"></a><span id="l45.78">   var option_title     = get_attr(registry, service, 'title');</span>
<a href="#l45.79"></a><span id="l45.79">   var option_customize = get_attr(registry, service, 'customize');</span>
<a href="#l45.80"></a><span id="l45.80">   var option_content   = get_attr(registry, service, 'content');</span>
<a href="#l45.81"></a><span id="l45.81">   if (!option_title || !option_content)</span>
<a href="#l45.82"></a><span id="l45.82">     return -1;</span>
<a href="#l45.83"></a><span id="l45.83"> </span>
<a href="#l45.84"></a><span id="l45.84">   var tree = document.getElementById('current-panels');</span>
<a href="#l45.85"></a><span id="l45.85">   var tree_root = tree.lastChild;</span>
<a href="#l45.86"></a><span id="l45.86" class="difflineminus">-  </span>
<a href="#l45.87"></a><span id="l45.87" class="difflineplus">+</span>
<a href="#l45.88"></a><span id="l45.88">   // Check to see if the panel already exists...</span>
<a href="#l45.89"></a><span id="l45.89">   var i = 0;</span>
<a href="#l45.90"></a><span id="l45.90">   for (var treeitem = tree_root.firstChild; treeitem; treeitem = treeitem.nextSibling) {</span>
<a href="#l45.91"></a><span id="l45.91">     if (treeitem.id == service.Value)</span>
<a href="#l45.92"></a><span id="l45.92">       // The panel is already in the current panel list.</span>
<a href="#l45.93"></a><span id="l45.93">       // Avoid adding it twice.</span>
<a href="#l45.94"></a><span id="l45.94">       return i;</span>
<a href="#l45.95"></a><span id="l45.95">     ++i;</span>
<a href="#l45.96"></a><span id="l45.96" class="difflineat">@@ -369,17 +369,17 @@ function add_node_to_current_list(regist</span>
<a href="#l45.97"></a><span id="l45.97">   return i;</span>
<a href="#l45.98"></a><span id="l45.98"> }</span>
<a href="#l45.99"></a><span id="l45.99"> </span>
<a href="#l45.100"></a><span id="l45.100"> // Remove the selected panel(s) from the current list tree.</span>
<a href="#l45.101"></a><span id="l45.101"> function RemovePanel()</span>
<a href="#l45.102"></a><span id="l45.102"> {</span>
<a href="#l45.103"></a><span id="l45.103">   var tree = document.getElementById('current-panels');</span>
<a href="#l45.104"></a><span id="l45.104">   var sel = tree.view.selection;</span>
<a href="#l45.105"></a><span id="l45.105" class="difflineminus">-  </span>
<a href="#l45.106"></a><span id="l45.106" class="difflineplus">+</span>
<a href="#l45.107"></a><span id="l45.107">   var nextNode = -1;</span>
<a href="#l45.108"></a><span id="l45.108">   var rangeCount = sel.getRangeCount();</span>
<a href="#l45.109"></a><span id="l45.109">   for (var range = rangeCount-1; range &gt;= 0; --range) {</span>
<a href="#l45.110"></a><span id="l45.110">     var min = {}, max = {};</span>
<a href="#l45.111"></a><span id="l45.111">     sel.getRangeAt(range, min, max);</span>
<a href="#l45.112"></a><span id="l45.112">     for (var index = max.value; index &gt;= min.value; --index) {</span>
<a href="#l45.113"></a><span id="l45.113">       var item = tree.contentView.getItemAtIndex(index);</span>
<a href="#l45.114"></a><span id="l45.114">       nextNode = item.nextSibling ? index : -1;</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l46.1"></a><span id="l46.1" class="difflineminus">--- a/suite/common/sidebar/sidebarOverlay.js</span>
<a href="#l46.2"></a><span id="l46.2" class="difflineplus">+++ b/suite/common/sidebar/sidebarOverlay.js</span>
<a href="#l46.3"></a><span id="l46.3" class="difflineat">@@ -257,17 +257,17 @@ function ()</span>
<a href="#l46.4"></a><span id="l46.4"> </span>
<a href="#l46.5"></a><span id="l46.5"> // panel_loader(): called from a timer that is set in sbPanelList.update()</span>
<a href="#l46.6"></a><span id="l46.6"> // Removes the &quot;Loading...&quot; screen when the panel has finished loading.</span>
<a href="#l46.7"></a><span id="l46.7"> function panel_loader() {</span>
<a href="#l46.8"></a><span id="l46.8">   debug(&quot;panel_loader()&quot;);</span>
<a href="#l46.9"></a><span id="l46.9"> </span>
<a href="#l46.10"></a><span id="l46.10">   if (gTimeoutID != null) {</span>
<a href="#l46.11"></a><span id="l46.11">       clearTimeout(gTimeoutID);</span>
<a href="#l46.12"></a><span id="l46.12" class="difflineminus">-      gTimeoutID = null; </span>
<a href="#l46.13"></a><span id="l46.13" class="difflineplus">+      gTimeoutID = null;</span>
<a href="#l46.14"></a><span id="l46.14">   }</span>
<a href="#l46.15"></a><span id="l46.15"> </span>
<a href="#l46.16"></a><span id="l46.16">   this.removeEventListener(&quot;load&quot;, panel_loader, true);</span>
<a href="#l46.17"></a><span id="l46.17">   this.removeAttribute('collapsed');</span>
<a href="#l46.18"></a><span id="l46.18">   // uncollapse the notificationbox element</span>
<a href="#l46.19"></a><span id="l46.19">   this.parentNode.removeAttribute('collapsed');</span>
<a href="#l46.20"></a><span id="l46.20">   // register a progress listener for the notificationbox,</span>
<a href="#l46.21"></a><span id="l46.21">   // now that this browser has a docShell</span>
<a href="#l46.22"></a><span id="l46.22" class="difflineat">@@ -319,63 +319,63 @@ function (force_reload)</span>
<a href="#l46.23"></a><span id="l46.23">   debug(&quot;this.initialized: &quot; + this.initialized);</span>
<a href="#l46.24"></a><span id="l46.24">   for (var ii=2; ii &lt; this.node.childNodes.length; ii += 2) {</span>
<a href="#l46.25"></a><span id="l46.25">     var header = this.node.childNodes.item(ii);</span>
<a href="#l46.26"></a><span id="l46.26">     var content = this.node.childNodes.item(ii+1);</span>
<a href="#l46.27"></a><span id="l46.27">     var id = header.getAttribute('id');</span>
<a href="#l46.28"></a><span id="l46.28">     var panel = new sbPanel(id, header, ii);</span>
<a href="#l46.29"></a><span id="l46.29">     var excluded = panel.is_excluded();</span>
<a href="#l46.30"></a><span id="l46.30">     var in_view = false;</span>
<a href="#l46.31"></a><span id="l46.31" class="difflineminus">-    if (!this.initialized) </span>
<a href="#l46.32"></a><span id="l46.32" class="difflineplus">+    if (!this.initialized)</span>
<a href="#l46.33"></a><span id="l46.33">     {</span>
<a href="#l46.34"></a><span id="l46.34">       if (num_in_view &lt; gNumTabsInViewPref)</span>
<a href="#l46.35"></a><span id="l46.35">         in_view = true;</span>
<a href="#l46.36"></a><span id="l46.36">     }</span>
<a href="#l46.37"></a><span id="l46.37">     else</span>
<a href="#l46.38"></a><span id="l46.38">     {</span>
<a href="#l46.39"></a><span id="l46.39">       if (header.getAttribute(&quot;in-view&quot;) == &quot;true&quot;)</span>
<a href="#l46.40"></a><span id="l46.40">         in_view = true;</span>
<a href="#l46.41"></a><span id="l46.41">     }</span>
<a href="#l46.42"></a><span id="l46.42">     if (excluded || !in_view)</span>
<a href="#l46.43"></a><span id="l46.43">     {</span>
<a href="#l46.44"></a><span id="l46.44" class="difflineminus">-      debug(&quot;item(&quot;+ii/2+&quot;) excluded: &quot; + excluded + </span>
<a href="#l46.45"></a><span id="l46.45" class="difflineplus">+      debug(&quot;item(&quot;+ii/2+&quot;) excluded: &quot; + excluded +</span>
<a href="#l46.46"></a><span id="l46.46">                           &quot; in view: &quot; + in_view);</span>
<a href="#l46.47"></a><span id="l46.47">       header.setAttribute('hidden','true');</span>
<a href="#l46.48"></a><span id="l46.48">       content.setAttribute('hidden','true');</span>
<a href="#l46.49"></a><span id="l46.49">       if (!in_view)</span>
<a href="#l46.50"></a><span id="l46.50">       {</span>
<a href="#l46.51"></a><span id="l46.51">         header.setAttribute(&quot;in-view&quot;, false);</span>
<a href="#l46.52"></a><span id="l46.52">         header.removeAttribute(&quot;top-panel&quot;);</span>
<a href="#l46.53"></a><span id="l46.53">         header.removeAttribute(&quot;last-panel&quot;);</span>
<a href="#l46.54"></a><span id="l46.54">       }</span>
<a href="#l46.55"></a><span id="l46.55">     } else {</span>
<a href="#l46.56"></a><span id="l46.56">       // only set if in view</span>
<a href="#l46.57"></a><span id="l46.57">       if (!this.initialized || (num_in_view &lt; gNumTabsInViewPref))</span>
<a href="#l46.58"></a><span id="l46.58">         last_header = header;</span>
<a href="#l46.59"></a><span id="l46.59">       header.removeAttribute('last-panel');</span>
<a href="#l46.60"></a><span id="l46.60">       // only set if in view</span>
<a href="#l46.61"></a><span id="l46.61" class="difflineminus">-      if (!have_set_top &amp;&amp; </span>
<a href="#l46.62"></a><span id="l46.62" class="difflineplus">+      if (!have_set_top &amp;&amp;</span>
<a href="#l46.63"></a><span id="l46.63">           (!this.initialized || (header.getAttribute(&quot;in-view&quot;) == &quot;true&quot;)))</span>
<a href="#l46.64"></a><span id="l46.64">       {</span>
<a href="#l46.65"></a><span id="l46.65">         header.setAttribute('top-panel','true');</span>
<a href="#l46.66"></a><span id="l46.66">         have_set_top = 1;</span>
<a href="#l46.67"></a><span id="l46.67">       } else {</span>
<a href="#l46.68"></a><span id="l46.68">         header.removeAttribute('top-panel');</span>
<a href="#l46.69"></a><span id="l46.69">       }</span>
<a href="#l46.70"></a><span id="l46.70">       if (!have_set_after_selected &amp;&amp; is_after_selected) {</span>
<a href="#l46.71"></a><span id="l46.71">         header.setAttribute('first-panel-after-selected','true');</span>
<a href="#l46.72"></a><span id="l46.72">         have_set_after_selected = 1</span>
<a href="#l46.73"></a><span id="l46.73">       } else {</span>
<a href="#l46.74"></a><span id="l46.74">         header.removeAttribute('first-panel-after-selected');</span>
<a href="#l46.75"></a><span id="l46.75">       }</span>
<a href="#l46.76"></a><span id="l46.76">       header.removeAttribute('hidden');</span>
<a href="#l46.77"></a><span id="l46.77">       header.setAttribute(&quot;in-view&quot;, true);</span>
<a href="#l46.78"></a><span id="l46.78">       num_in_view++;</span>
<a href="#l46.79"></a><span id="l46.79" class="difflineminus">-      </span>
<a href="#l46.80"></a><span id="l46.80" class="difflineminus">-      // (a) when we have hit the maximum number of tabs that can be in view and no tab </span>
<a href="#l46.81"></a><span id="l46.81" class="difflineplus">+</span>
<a href="#l46.82"></a><span id="l46.82" class="difflineplus">+      // (a) when we have hit the maximum number of tabs that can be in view and no tab</span>
<a href="#l46.83"></a><span id="l46.83">       //     has been selected yet</span>
<a href="#l46.84"></a><span id="l46.84">       //     -or-</span>
<a href="#l46.85"></a><span id="l46.85">       // (b) when we have reached the last tab we are about to display</span>
<a href="#l46.86"></a><span id="l46.86">       if ( ((num_in_view == num_included) ||</span>
<a href="#l46.87"></a><span id="l46.87">             (num_in_view == gNumTabsInViewPref)) &amp;&amp;</span>
<a href="#l46.88"></a><span id="l46.88">           !is_after_selected )</span>
<a href="#l46.89"></a><span id="l46.89">       {</span>
<a href="#l46.90"></a><span id="l46.90">         selected_id = id;</span>
<a href="#l46.91"></a><span id="l46.91" class="difflineat">@@ -507,17 +507,17 @@ function ()</span>
<a href="#l46.92"></a><span id="l46.92">   return this.sandboxed;</span>
<a href="#l46.93"></a><span id="l46.93"> }</span>
<a href="#l46.94"></a><span id="l46.94"> </span>
<a href="#l46.95"></a><span id="l46.95"> sbPanel.prototype.get_iframe =</span>
<a href="#l46.96"></a><span id="l46.96"> function ()</span>
<a href="#l46.97"></a><span id="l46.97"> {</span>
<a href="#l46.98"></a><span id="l46.98">   if (typeof this.iframe == &quot;undefined&quot;) {</span>
<a href="#l46.99"></a><span id="l46.99">     var notificationbox = this.get_content().childNodes.item(1);</span>
<a href="#l46.100"></a><span id="l46.100" class="difflineminus">-    this.iframe = this.is_sandboxed() ? notificationbox.lastChild : </span>
<a href="#l46.101"></a><span id="l46.101" class="difflineplus">+    this.iframe = this.is_sandboxed() ? notificationbox.lastChild :</span>
<a href="#l46.102"></a><span id="l46.102">                                         notificationbox.firstChild;</span>
<a href="#l46.103"></a><span id="l46.103">   }</span>
<a href="#l46.104"></a><span id="l46.104">   return this.iframe;</span>
<a href="#l46.105"></a><span id="l46.105"> }</span>
<a href="#l46.106"></a><span id="l46.106"> </span>
<a href="#l46.107"></a><span id="l46.107"> // This exclude function is used on panels and on the panel picker menu.</span>
<a href="#l46.108"></a><span id="l46.108"> // That is why it is hanging out in the global name space instead of</span>
<a href="#l46.109"></a><span id="l46.109"> // minding its own business in the class.</span>
<a href="#l46.110"></a><span id="l46.110" class="difflineat">@@ -550,17 +550,17 @@ function ()</span>
<a href="#l46.111"></a><span id="l46.111"> {</span>
<a href="#l46.112"></a><span id="l46.112">     var rv = false;</span>
<a href="#l46.113"></a><span id="l46.113">     var datasource = sidebarObj.datasource;</span>
<a href="#l46.114"></a><span id="l46.114">     var persistNode = datasource.GetTarget(RDF.GetResource(this.id),</span>
<a href="#l46.115"></a><span id="l46.115">                                            RDF.GetResource(NC + &quot;persist&quot;),</span>
<a href="#l46.116"></a><span id="l46.116">                                            true);</span>
<a href="#l46.117"></a><span id="l46.117">     if (persistNode)</span>
<a href="#l46.118"></a><span id="l46.118">     {</span>
<a href="#l46.119"></a><span id="l46.119" class="difflineminus">-        persistNode = </span>
<a href="#l46.120"></a><span id="l46.120" class="difflineplus">+        persistNode =</span>
<a href="#l46.121"></a><span id="l46.121">           persistNode.QueryInterface(Components.interfaces.nsIRDFLiteral);</span>
<a href="#l46.122"></a><span id="l46.122">         rv = persistNode.Value == 'true';</span>
<a href="#l46.123"></a><span id="l46.123">     }</span>
<a href="#l46.124"></a><span id="l46.124"> </span>
<a href="#l46.125"></a><span id="l46.125">     return rv;</span>
<a href="#l46.126"></a><span id="l46.126"> }</span>
<a href="#l46.127"></a><span id="l46.127"> </span>
<a href="#l46.128"></a><span id="l46.128"> sbPanel.prototype.select =</span>
<a href="#l46.129"></a><span id="l46.129" class="difflineat">@@ -730,20 +730,20 @@ function sidebar_overlay_init() {</span>
<a href="#l46.130"></a><span id="l46.130">     if (sidebar_menuitem) {</span>
<a href="#l46.131"></a><span id="l46.131">       sidebar_menuitem.setAttribute('checked', 'true');</span>
<a href="#l46.132"></a><span id="l46.132">     }</span>
<a href="#l46.133"></a><span id="l46.133"> </span>
<a href="#l46.134"></a><span id="l46.134">     // for old profiles that don't persist the hidden attribute when splitter is not hidden.</span>
<a href="#l46.135"></a><span id="l46.135">     var sidebar_splitter = document.getElementById('sidebar-splitter')</span>
<a href="#l46.136"></a><span id="l46.136">     if (sidebar_splitter)</span>
<a href="#l46.137"></a><span id="l46.137">       sidebar_splitter.setAttribute('hidden', 'false');</span>
<a href="#l46.138"></a><span id="l46.138" class="difflineminus">-    </span>
<a href="#l46.139"></a><span id="l46.139" class="difflineplus">+</span>
<a href="#l46.140"></a><span id="l46.140">     if (sidebarObj.never_built) {</span>
<a href="#l46.141"></a><span id="l46.141">       sidebarObj.never_built = false;</span>
<a href="#l46.142"></a><span id="l46.142" class="difflineminus">-      </span>
<a href="#l46.143"></a><span id="l46.143" class="difflineplus">+</span>
<a href="#l46.144"></a><span id="l46.144">       debug(&quot;sidebar = &quot; + sidebarObj);</span>
<a href="#l46.145"></a><span id="l46.145">       debug(&quot;sidebarObj.resource = &quot; + sidebarObj.resource);</span>
<a href="#l46.146"></a><span id="l46.146">       debug(&quot;sidebarObj.datasource_uri = &quot; + sidebarObj.datasource_uri);</span>
<a href="#l46.147"></a><span id="l46.147"> </span>
<a href="#l46.148"></a><span id="l46.148">       // Obtain the pref for limiting the number of tabs in view, defaults to 8.</span>
<a href="#l46.149"></a><span id="l46.149">       gNumTabsInViewPref = GetIntPref(&quot;sidebar.num_tabs_in_view&quot;, 8);</span>
<a href="#l46.150"></a><span id="l46.150"> </span>
<a href="#l46.151"></a><span id="l46.151">       // Show the header for the panels area. Use a splitter if there</span>
<a href="#l46.152"></a><span id="l46.152" class="difflineat">@@ -783,17 +783,17 @@ function sidebar_open_default_panel(wait</span>
<a href="#l46.153"></a><span id="l46.153">   var panelListRes = RDF.GetResource(&quot;http://home.netscape.com/NC-rdf#panel-list&quot;);</span>
<a href="#l46.154"></a><span id="l46.154">   var container = ds.GetTarget(currentListRes, panelListRes, true);</span>
<a href="#l46.155"></a><span id="l46.155">   if (container) {</span>
<a href="#l46.156"></a><span id="l46.156">     // Add the user's current panel choices to the template builder,</span>
<a href="#l46.157"></a><span id="l46.157">     // which will aggregate it with the other datasources that describe</span>
<a href="#l46.158"></a><span id="l46.158">     // the individual panel's title, customize URL, and content URL.</span>
<a href="#l46.159"></a><span id="l46.159">     var panels = document.getElementById('sidebar-panels');</span>
<a href="#l46.160"></a><span id="l46.160">     panels.database.AddDataSource(ds);</span>
<a href="#l46.161"></a><span id="l46.161" class="difflineminus">-    </span>
<a href="#l46.162"></a><span id="l46.162" class="difflineplus">+</span>
<a href="#l46.163"></a><span id="l46.163">     debug(&quot;Adding observer to database.&quot;);</span>
<a href="#l46.164"></a><span id="l46.164">     panels.database.AddObserver(panel_observer);</span>
<a href="#l46.165"></a><span id="l46.165"> </span>
<a href="#l46.166"></a><span id="l46.166">     // XXX This is a hack to force re-display</span>
<a href="#l46.167"></a><span id="l46.167">     panels.builder.rebuild();</span>
<a href="#l46.168"></a><span id="l46.168">   } else {</span>
<a href="#l46.169"></a><span id="l46.169">     if (tries &lt; 3) {</span>
<a href="#l46.170"></a><span id="l46.170">       // No children yet, try again later</span>
<a href="#l46.171"></a><span id="l46.171" class="difflineat">@@ -838,17 +838,17 @@ function check_for_missing_panels() {</span>
<a href="#l46.172"></a><span id="l46.172">           channel.open();</span>
<a href="#l46.173"></a><span id="l46.173">         }</span>
<a href="#l46.174"></a><span id="l46.174">         catch(ex if (ex.result == Components.results.NS_ERROR_FILE_NOT_FOUND)) {</span>
<a href="#l46.175"></a><span id="l46.175">           sidebarObj.datasource.Assert(RDF.GetResource(currHeader.getAttribute(&quot;id&quot;)),</span>
<a href="#l46.176"></a><span id="l46.176">                                        RDF.GetResource(NC + &quot;exclude&quot;),</span>
<a href="#l46.177"></a><span id="l46.177">                                        RDF.GetLiteral(sidebarObj.component),</span>
<a href="#l46.178"></a><span id="l46.178">                                        true);</span>
<a href="#l46.179"></a><span id="l46.179">           currTab.exclude();</span>
<a href="#l46.180"></a><span id="l46.180" class="difflineminus">-        }        </span>
<a href="#l46.181"></a><span id="l46.181" class="difflineplus">+        }</span>
<a href="#l46.182"></a><span id="l46.182">       }</span>
<a href="#l46.183"></a><span id="l46.183">     }</span>
<a href="#l46.184"></a><span id="l46.184">   }</span>
<a href="#l46.185"></a><span id="l46.185">   gCheckMissingPanels = false;</span>
<a href="#l46.186"></a><span id="l46.186"> }</span>
<a href="#l46.187"></a><span id="l46.187"> </span>
<a href="#l46.188"></a><span id="l46.188"> //////////////////////////////////////////////////////////////</span>
<a href="#l46.189"></a><span id="l46.189"> // Sidebar File and Datasource functions</span>
<a href="#l46.190"></a><span id="l46.190" class="difflineat">@@ -894,19 +894,19 @@ function sidebar_revert_to_default_panel</span>
<a href="#l46.191"></a><span id="l46.191">     debug(&quot;Error: Unable to reload panel defaults file.\n&quot;);</span>
<a href="#l46.192"></a><span id="l46.192">   }</span>
<a href="#l46.193"></a><span id="l46.193">   return null;</span>
<a href="#l46.194"></a><span id="l46.194"> }</span>
<a href="#l46.195"></a><span id="l46.195"> </span>
<a href="#l46.196"></a><span id="l46.196"> function get_sidebar_datasource_uri() {</span>
<a href="#l46.197"></a><span id="l46.197">   try {</span>
<a href="#l46.198"></a><span id="l46.198">     var sidebar_file = sidebar_get_panels_file();</span>
<a href="#l46.199"></a><span id="l46.199" class="difflineminus">-    </span>
<a href="#l46.200"></a><span id="l46.200" class="difflineplus">+</span>
<a href="#l46.201"></a><span id="l46.201">     var fileHandler = Services.io.getProtocolHandler(&quot;file&quot;).QueryInterface(Components.interfaces.nsIFileProtocolHandler);</span>
<a href="#l46.202"></a><span id="l46.202" class="difflineminus">-    </span>
<a href="#l46.203"></a><span id="l46.203" class="difflineplus">+</span>
<a href="#l46.204"></a><span id="l46.204">     return fileHandler.getURLSpecFromFile(sidebar_file);</span>
<a href="#l46.205"></a><span id="l46.205">   } catch (ex) {</span>
<a href="#l46.206"></a><span id="l46.206">     // This should not happen</span>
<a href="#l46.207"></a><span id="l46.207">     debug(&quot;Error: Unable to load panels file.\n&quot;);</span>
<a href="#l46.208"></a><span id="l46.208">   }</span>
<a href="#l46.209"></a><span id="l46.209">   return null;</span>
<a href="#l46.210"></a><span id="l46.210"> }</span>
<a href="#l46.211"></a><span id="l46.211"> </span>
<a href="#l46.212"></a><span id="l46.212" class="difflineat">@@ -979,30 +979,30 @@ function SidebarSelectPanel(header, shou</span>
<a href="#l46.213"></a><span id="l46.213">       popopen = true;</span>
<a href="#l46.214"></a><span id="l46.214">     } else {</span>
<a href="#l46.215"></a><span id="l46.215">       return false;</span>
<a href="#l46.216"></a><span id="l46.216">     }</span>
<a href="#l46.217"></a><span id="l46.217">   }</span>
<a href="#l46.218"></a><span id="l46.218">   if (unhide)  SidebarShowHide();</span>
<a href="#l46.219"></a><span id="l46.219">   if (popopen) SidebarExpandCollapse();</span>
<a href="#l46.220"></a><span id="l46.220"> </span>
<a href="#l46.221"></a><span id="l46.221" class="difflineminus">-  try { </span>
<a href="#l46.222"></a><span id="l46.222" class="difflineminus">-    panel.get_iframe().setAttribute('focusOnLoad', true); </span>
<a href="#l46.223"></a><span id="l46.223" class="difflineminus">-  } catch (ex) { </span>
<a href="#l46.224"></a><span id="l46.224" class="difflineplus">+  try {</span>
<a href="#l46.225"></a><span id="l46.225" class="difflineplus">+    panel.get_iframe().setAttribute('focusOnLoad', true);</span>
<a href="#l46.226"></a><span id="l46.226" class="difflineplus">+  } catch (ex) {</span>
<a href="#l46.227"></a><span id="l46.227">     // ignore exception for cases where content isn't built yet</span>
<a href="#l46.228"></a><span id="l46.228">     // e.g., auto opening search tab: we don't want to focus search field</span>
<a href="#l46.229"></a><span id="l46.229">   }</span>
<a href="#l46.230"></a><span id="l46.230">   if (!panel.is_selected()) panel.select(false);</span>
<a href="#l46.231"></a><span id="l46.231"> </span>
<a href="#l46.232"></a><span id="l46.232">   return true;</span>
<a href="#l46.233"></a><span id="l46.233"> }</span>
<a href="#l46.234"></a><span id="l46.234"> </span>
<a href="#l46.235"></a><span id="l46.235"> function SidebarGetLastSelectedPanel()</span>
<a href="#l46.236"></a><span id="l46.236"> {</span>
<a href="#l46.237"></a><span id="l46.237" class="difflineminus">-  return (sidebarObj.panels &amp;&amp; </span>
<a href="#l46.238"></a><span id="l46.238" class="difflineplus">+  return (sidebarObj.panels &amp;&amp;</span>
<a href="#l46.239"></a><span id="l46.239">           sidebarObj.panels.node.getAttribute('last-selected-panel'));</span>
<a href="#l46.240"></a><span id="l46.240"> }</span>
<a href="#l46.241"></a><span id="l46.241"> </span>
<a href="#l46.242"></a><span id="l46.242"> function SidebarGetRelativePanel(direction)</span>
<a href="#l46.243"></a><span id="l46.243"> {</span>
<a href="#l46.244"></a><span id="l46.244">   // direction == 1 to view next panel, -1 to view prev panel</span>
<a href="#l46.245"></a><span id="l46.245"> </span>
<a href="#l46.246"></a><span id="l46.246">   if (sidebar_is_hidden())</span>
<a href="#l46.247"></a><span id="l46.247" class="difflineat">@@ -1017,17 +1017,17 @@ function SidebarGetRelativePanel(directi</span>
<a href="#l46.248"></a><span id="l46.248">   }</span>
<a href="#l46.249"></a><span id="l46.249"> </span>
<a href="#l46.250"></a><span id="l46.250">   var newPanel = currentPanel;</span>
<a href="#l46.251"></a><span id="l46.251"> </span>
<a href="#l46.252"></a><span id="l46.252">   do {</span>
<a href="#l46.253"></a><span id="l46.253">     var newPanelIndex = newPanel.index + (direction * 2);</span>
<a href="#l46.254"></a><span id="l46.254">     if (newPanelIndex &lt; 2 || newPanelIndex &gt;= sidebarObj.panels.node.childNodes.length)</span>
<a href="#l46.255"></a><span id="l46.255">       newPanel = (direction == 1)? sidebarObj.panels.find_first(): sidebarObj.panels.find_last();</span>
<a href="#l46.256"></a><span id="l46.256" class="difflineminus">-    else </span>
<a href="#l46.257"></a><span id="l46.257" class="difflineplus">+    else</span>
<a href="#l46.258"></a><span id="l46.258">       newPanel = sidebarObj.panels.get_panel_from_header_index(newPanelIndex);</span>
<a href="#l46.259"></a><span id="l46.259"> </span>
<a href="#l46.260"></a><span id="l46.260">     if (!newPanel)</span>
<a href="#l46.261"></a><span id="l46.261">       break;</span>
<a href="#l46.262"></a><span id="l46.262"> </span>
<a href="#l46.263"></a><span id="l46.263">     if (!newPanel.is_excluded()) {</span>
<a href="#l46.264"></a><span id="l46.264">       SidebarSelectPanel(newPanel.header, true, true);  // found a panel that's not excluded to select -- do it</span>
<a href="#l46.265"></a><span id="l46.265">       break;</span>
<a href="#l46.266"></a><span id="l46.266" class="difflineat">@@ -1044,17 +1044,17 @@ function SidebarReloadPanel(header) {</span>
<a href="#l46.267"></a><span id="l46.267">   var panel = sidebarObj.panels.get_panel_from_header_node(header);</span>
<a href="#l46.268"></a><span id="l46.268">   panel.reload();</span>
<a href="#l46.269"></a><span id="l46.269"> }</span>
<a href="#l46.270"></a><span id="l46.270"> </span>
<a href="#l46.271"></a><span id="l46.271"> // No one is calling this right now.</span>
<a href="#l46.272"></a><span id="l46.272"> function SidebarReload() {</span>
<a href="#l46.273"></a><span id="l46.273">   sidebarObj.panels.refresh();</span>
<a href="#l46.274"></a><span id="l46.274"> }</span>
<a href="#l46.275"></a><span id="l46.275" class="difflineminus">- </span>
<a href="#l46.276"></a><span id="l46.276" class="difflineplus">+</span>
<a href="#l46.277"></a><span id="l46.277"> // Set up a lame hack to avoid opening two customize</span>
<a href="#l46.278"></a><span id="l46.278"> // windows on a double click.</span>
<a href="#l46.279"></a><span id="l46.279"> var gDisableCustomize = false;</span>
<a href="#l46.280"></a><span id="l46.280"> function enable_customize() {</span>
<a href="#l46.281"></a><span id="l46.281">   gDisableCustomize = false;</span>
<a href="#l46.282"></a><span id="l46.282"> }</span>
<a href="#l46.283"></a><span id="l46.283"> </span>
<a href="#l46.284"></a><span id="l46.284"> // Bring up the Sidebar customize dialog.</span>
<a href="#l46.285"></a><span id="l46.285" class="difflineat">@@ -1144,19 +1144,19 @@ function SidebarShowHide() {</span>
<a href="#l46.286"></a><span id="l46.286">   var sidebar_panels_splitter_box = document.getElementById('sidebar-panels-splitter-box');</span>
<a href="#l46.287"></a><span id="l46.287">   var sidebar_splitter = document.getElementById('sidebar-splitter');</span>
<a href="#l46.288"></a><span id="l46.288">   var sidebar_menu_item = document.getElementById('sidebar-menu');</span>
<a href="#l46.289"></a><span id="l46.289">   var tabs_menu = document.getElementById('sidebar-panel-picker');</span>
<a href="#l46.290"></a><span id="l46.290"> </span>
<a href="#l46.291"></a><span id="l46.291">   if (sidebar_is_hidden()) {</span>
<a href="#l46.292"></a><span id="l46.292">     debug(&quot;Showing the sidebar&quot;);</span>
<a href="#l46.293"></a><span id="l46.293"> </span>
<a href="#l46.294"></a><span id="l46.294" class="difflineminus">-    // for older profiles: </span>
<a href="#l46.295"></a><span id="l46.295" class="difflineminus">-    sidebar_box.setAttribute('hidden', 'false'); </span>
<a href="#l46.296"></a><span id="l46.296" class="difflineminus">-    sidebar_panels_splitter_box.setAttribute('hidden', 'false'); </span>
<a href="#l46.297"></a><span id="l46.297" class="difflineplus">+    // for older profiles:</span>
<a href="#l46.298"></a><span id="l46.298" class="difflineplus">+    sidebar_box.setAttribute('hidden', 'false');</span>
<a href="#l46.299"></a><span id="l46.299" class="difflineplus">+    sidebar_panels_splitter_box.setAttribute('hidden', 'false');</span>
<a href="#l46.300"></a><span id="l46.300"> </span>
<a href="#l46.301"></a><span id="l46.301">     sidebar_box.removeAttribute('collapsed');</span>
<a href="#l46.302"></a><span id="l46.302">     if (sidebar_splitter.getAttribute('state') == 'collapsed')</span>
<a href="#l46.303"></a><span id="l46.303">       sidebar_splitter.removeAttribute('state');</span>
<a href="#l46.304"></a><span id="l46.304">     title_box.removeAttribute('hidden');</span>
<a href="#l46.305"></a><span id="l46.305">     sidebar_panels_splitter_box.removeAttribute('collapsed');</span>
<a href="#l46.306"></a><span id="l46.306">     sidebar_splitter.setAttribute('hidden', 'false');</span>
<a href="#l46.307"></a><span id="l46.307">     if (sidebar_box.firstChild != sidebar_panels_splitter) {</span>
<a href="#l46.308"></a><span id="l46.308" class="difflineat">@@ -1347,58 +1347,58 @@ function SidebarNavigate(aDirection)</span>
<a href="#l46.309"></a><span id="l46.309">   var tabs = sidebarObj.panels.node.childNodes;</span>
<a href="#l46.310"></a><span id="l46.310">   var i;</span>
<a href="#l46.311"></a><span id="l46.311">   var currHeader;</span>
<a href="#l46.312"></a><span id="l46.312">   var currTab;</span>
<a href="#l46.313"></a><span id="l46.313">   // move forward a tab (down in the template)</span>
<a href="#l46.314"></a><span id="l46.314">   if (aDirection &gt; 0)</span>
<a href="#l46.315"></a><span id="l46.315">   {</span>
<a href="#l46.316"></a><span id="l46.316">     // ensure we have a tab below the last one</span>
<a href="#l46.317"></a><span id="l46.317" class="difflineminus">-    var foundLast = false; </span>
<a href="#l46.318"></a><span id="l46.318" class="difflineplus">+    var foundLast = false;</span>
<a href="#l46.319"></a><span id="l46.319">     var oldFirst = null;</span>
<a href="#l46.320"></a><span id="l46.320" class="difflineminus">-    for (i = 2; i &lt; tabs.length; i += 2) </span>
<a href="#l46.321"></a><span id="l46.321" class="difflineplus">+    for (i = 2; i &lt; tabs.length; i += 2)</span>
<a href="#l46.322"></a><span id="l46.322">     {</span>
<a href="#l46.323"></a><span id="l46.323">       currHeader = tabs[i];</span>
<a href="#l46.324"></a><span id="l46.324">       currTab = new sbPanel(currHeader.getAttribute(&quot;id&quot;), currHeader, i);</span>
<a href="#l46.325"></a><span id="l46.325" class="difflineminus">-  </span>
<a href="#l46.326"></a><span id="l46.326" class="difflineplus">+</span>
<a href="#l46.327"></a><span id="l46.327">       if (!currTab.is_excluded())</span>
<a href="#l46.328"></a><span id="l46.328" class="difflineminus">-      {     </span>
<a href="#l46.329"></a><span id="l46.329" class="difflineplus">+      {</span>
<a href="#l46.330"></a><span id="l46.330">         if (foundLast)</span>
<a href="#l46.331"></a><span id="l46.331">         {</span>
<a href="#l46.332"></a><span id="l46.332">           debug(&quot;toggling old first and new last&quot;);</span>
<a href="#l46.333"></a><span id="l46.333">           debug(&quot;new last:  &quot; + currHeader.getAttribute(&quot;id&quot;));</span>
<a href="#l46.334"></a><span id="l46.334">           debug(&quot;old first: &quot; + oldFirst.getAttribute(&quot;id&quot;));</span>
<a href="#l46.335"></a><span id="l46.335">           currHeader.setAttribute(&quot;in-view&quot;, true);</span>
<a href="#l46.336"></a><span id="l46.336">           oldFirst.setAttribute(&quot;in-view&quot;, false);</span>
<a href="#l46.337"></a><span id="l46.337" class="difflineminus">-          </span>
<a href="#l46.338"></a><span id="l46.338" class="difflineplus">+</span>
<a href="#l46.339"></a><span id="l46.339">           // if old first was selected select new first instead</span>
<a href="#l46.340"></a><span id="l46.340" class="difflineminus">-          if (oldFirst.getAttribute(&quot;id&quot;) == </span>
<a href="#l46.341"></a><span id="l46.341" class="difflineplus">+          if (oldFirst.getAttribute(&quot;id&quot;) ==</span>
<a href="#l46.342"></a><span id="l46.342">               sidebarObj.panels.node.getAttribute(&quot;last-selected-panel&quot;))</span>
<a href="#l46.343"></a><span id="l46.343">           {</span>
<a href="#l46.344"></a><span id="l46.344" class="difflineminus">-            sidebarObj.panels.node.setAttribute('last-selected-panel', </span>
<a href="#l46.345"></a><span id="l46.345" class="difflineplus">+            sidebarObj.panels.node.setAttribute('last-selected-panel',</span>
<a href="#l46.346"></a><span id="l46.346">               currTab.id);</span>
<a href="#l46.347"></a><span id="l46.347">           }</span>
<a href="#l46.348"></a><span id="l46.348" class="difflineminus">-          </span>
<a href="#l46.349"></a><span id="l46.349" class="difflineplus">+</span>
<a href="#l46.350"></a><span id="l46.350">           break;</span>
<a href="#l46.351"></a><span id="l46.351">         }</span>
<a href="#l46.352"></a><span id="l46.352"> </span>
<a href="#l46.353"></a><span id="l46.353">         if (!foundLast &amp;&amp; currHeader.hasAttribute(&quot;last-panel&quot;))</span>
<a href="#l46.354"></a><span id="l46.354">         {</span>
<a href="#l46.355"></a><span id="l46.355">           debug(&quot;found last&quot;);</span>
<a href="#l46.356"></a><span id="l46.356">           foundLast = true;</span>
<a href="#l46.357"></a><span id="l46.357">         }</span>
<a href="#l46.358"></a><span id="l46.358"> </span>
<a href="#l46.359"></a><span id="l46.359">         // set the old first in case we find a new last below</span>
<a href="#l46.360"></a><span id="l46.360">         // the old last and need to toggle the new first's ``in-view''</span>
<a href="#l46.361"></a><span id="l46.361">         if (!oldFirst &amp;&amp; currTab.is_in_view())</span>
<a href="#l46.362"></a><span id="l46.362">           oldFirst = currHeader;</span>
<a href="#l46.363"></a><span id="l46.363">       }</span>
<a href="#l46.364"></a><span id="l46.364">     }</span>
<a href="#l46.365"></a><span id="l46.365">   }</span>
<a href="#l46.366"></a><span id="l46.366" class="difflineminus">-  </span>
<a href="#l46.367"></a><span id="l46.367" class="difflineplus">+</span>
<a href="#l46.368"></a><span id="l46.368">   // move back a tab (up in the template)</span>
<a href="#l46.369"></a><span id="l46.369">   else if (aDirection &lt; 0)</span>
<a href="#l46.370"></a><span id="l46.370">   {</span>
<a href="#l46.371"></a><span id="l46.371">     var newFirst = null, newLast = null;</span>
<a href="#l46.372"></a><span id="l46.372">     var foundFirst = false;</span>
<a href="#l46.373"></a><span id="l46.373">     for (i = 2; i &lt; tabs.length; i += 2)</span>
<a href="#l46.374"></a><span id="l46.374">     {</span>
<a href="#l46.375"></a><span id="l46.375">       currHeader = tabs[i];</span>
<a href="#l46.376"></a><span id="l46.376" class="difflineat">@@ -1425,22 +1425,22 @@ function SidebarNavigate(aDirection)</span>
<a href="#l46.377"></a><span id="l46.377">           if (newFirst)</span>
<a href="#l46.378"></a><span id="l46.378">           {</span>
<a href="#l46.379"></a><span id="l46.379">             debug(&quot;toggling new first and old last&quot;);</span>
<a href="#l46.380"></a><span id="l46.380">             debug(&quot;new first: &quot; + newFirst.getAttribute(&quot;id&quot;));</span>
<a href="#l46.381"></a><span id="l46.381">             debug(&quot;old last:  &quot; + currHeader.getAttribute(&quot;id&quot;));</span>
<a href="#l46.382"></a><span id="l46.382"> </span>
<a href="#l46.383"></a><span id="l46.383">             newFirst.setAttribute(&quot;in-view&quot;, true);</span>
<a href="#l46.384"></a><span id="l46.384">             currHeader.setAttribute(&quot;in-view&quot;, false); // hide old last</span>
<a href="#l46.385"></a><span id="l46.385" class="difflineminus">-          </span>
<a href="#l46.386"></a><span id="l46.386" class="difflineplus">+</span>
<a href="#l46.387"></a><span id="l46.387">             // if old last was selected, now select one above it</span>
<a href="#l46.388"></a><span id="l46.388">             if (sidebarObj.panels.node.getAttribute(&quot;last-selected-panel&quot;) ==</span>
<a href="#l46.389"></a><span id="l46.389">                 currTab.id)</span>
<a href="#l46.390"></a><span id="l46.390">             {</span>
<a href="#l46.391"></a><span id="l46.391" class="difflineminus">-              sidebarObj.panels.node.setAttribute(&quot;last-selected-panel&quot;, </span>
<a href="#l46.392"></a><span id="l46.392" class="difflineplus">+              sidebarObj.panels.node.setAttribute(&quot;last-selected-panel&quot;,</span>
<a href="#l46.393"></a><span id="l46.393">                 newLast.getAttribute(&quot;id&quot;));</span>
<a href="#l46.394"></a><span id="l46.394">             }</span>
<a href="#l46.395"></a><span id="l46.395"> </span>
<a href="#l46.396"></a><span id="l46.396">             break;</span>
<a href="#l46.397"></a><span id="l46.397">           }</span>
<a href="#l46.398"></a><span id="l46.398">         }</span>
<a href="#l46.399"></a><span id="l46.399">         if (currTab.is_in_view())</span>
<a href="#l46.400"></a><span id="l46.400">           newLast = currHeader;</span>
<a href="#l46.401"></a><span id="l46.401" class="difflineat">@@ -1506,37 +1506,37 @@ function SidebarSetButtonOpen(aSidebarNo</span>
<a href="#l46.402"></a><span id="l46.402"> {</span>
<a href="#l46.403"></a><span id="l46.403">   // change state so toolbar icon can be updated</span>
<a href="#l46.404"></a><span id="l46.404">   var pt = document.getElementById(&quot;PersonalToolbar&quot;);</span>
<a href="#l46.405"></a><span id="l46.405">   if (pt) {</span>
<a href="#l46.406"></a><span id="l46.406">     pt.setAttribute(&quot;prefixopen&quot;, aSidebarNowOpen);</span>
<a href="#l46.407"></a><span id="l46.407"> </span>
<a href="#l46.408"></a><span id="l46.408">     // set tooltip for toolbar icon</span>
<a href="#l46.409"></a><span id="l46.409">     var header = document.getElementById(&quot;sidebar-title-box&quot;);</span>
<a href="#l46.410"></a><span id="l46.410" class="difflineminus">-    var tooltip = header.getAttribute(aSidebarNowOpen ? </span>
<a href="#l46.411"></a><span id="l46.411" class="difflineplus">+    var tooltip = header.getAttribute(aSidebarNowOpen ?</span>
<a href="#l46.412"></a><span id="l46.412">                   &quot;tooltipclose&quot; : &quot;tooltipopen&quot;);</span>
<a href="#l46.413"></a><span id="l46.413">     pt.setAttribute(&quot;prefixtooltip&quot;, tooltip);</span>
<a href="#l46.414"></a><span id="l46.414">   }</span>
<a href="#l46.415"></a><span id="l46.415"> }</span>
<a href="#l46.416"></a><span id="l46.416"> </span>
<a href="#l46.417"></a><span id="l46.417"> function SidebarInitContextMenu(aMenu, aPopupNode)</span>
<a href="#l46.418"></a><span id="l46.418"> {</span>
<a href="#l46.419"></a><span id="l46.419">   var panel = sidebarObj.panels.get_panel_from_header_node(aPopupNode);</span>
<a href="#l46.420"></a><span id="l46.420">   var switchItem = document.getElementById(&quot;switch-ctx-item&quot;);</span>
<a href="#l46.421"></a><span id="l46.421">   var reloadItem = document.getElementById(&quot;reload-ctx-item&quot;);</span>
<a href="#l46.422"></a><span id="l46.422">   var stopItem = document.getElementById(&quot;stop-ctx-item&quot;);</span>
<a href="#l46.423"></a><span id="l46.423"> </span>
<a href="#l46.424"></a><span id="l46.424" class="difflineminus">-  // the current panel can be reloaded, but other panels are not showing </span>
<a href="#l46.425"></a><span id="l46.425" class="difflineplus">+  // the current panel can be reloaded, but other panels are not showing</span>
<a href="#l46.426"></a><span id="l46.426">   // any content, so we only allow you to switch to other panels</span>
<a href="#l46.427"></a><span id="l46.427" class="difflineminus">-  if (panel.is_selected()) </span>
<a href="#l46.428"></a><span id="l46.428" class="difflineplus">+  if (panel.is_selected())</span>
<a href="#l46.429"></a><span id="l46.429">   {</span>
<a href="#l46.430"></a><span id="l46.430" class="difflineminus">-    switchItem.setAttribute(&quot;collapsed&quot;, &quot;true&quot;); </span>
<a href="#l46.431"></a><span id="l46.431" class="difflineplus">+    switchItem.setAttribute(&quot;collapsed&quot;, &quot;true&quot;);</span>
<a href="#l46.432"></a><span id="l46.432">     reloadItem.removeAttribute(&quot;disabled&quot;);</span>
<a href="#l46.433"></a><span id="l46.433">   }</span>
<a href="#l46.434"></a><span id="l46.434" class="difflineminus">-  else </span>
<a href="#l46.435"></a><span id="l46.435" class="difflineplus">+  else</span>
<a href="#l46.436"></a><span id="l46.436">   {</span>
<a href="#l46.437"></a><span id="l46.437">     switchItem.removeAttribute(&quot;collapsed&quot;);</span>
<a href="#l46.438"></a><span id="l46.438">     reloadItem.setAttribute(&quot;disabled&quot;, &quot;true&quot;);</span>
<a href="#l46.439"></a><span id="l46.439">   }</span>
<a href="#l46.440"></a><span id="l46.440"> </span>
<a href="#l46.441"></a><span id="l46.441">   // only if a panel is currently loading enable the ``Stop'' item</span>
<a href="#l46.442"></a><span id="l46.442">   if (panel.get_iframe().getAttribute(&quot;loadstate&quot;) == &quot;loading&quot;)</span>
<a href="#l46.443"></a><span id="l46.443">     stopItem.removeAttribute(&quot;disabled&quot;);</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l47.1"></a><span id="l47.1" class="difflineminus">--- a/suite/common/src/nsGopherProtocolStubHandler.js</span>
<a href="#l47.2"></a><span id="l47.2" class="difflineplus">+++ b/suite/common/src/nsGopherProtocolStubHandler.js</span>
<a href="#l47.3"></a><span id="l47.3" class="difflineat">@@ -24,17 +24,17 @@ GopherProtocol.prototype = {</span>
<a href="#l47.4"></a><span id="l47.4">   QueryInterface: XPCOMUtils.generateQI([Components.interfaces.nsIProtocolHandler]),</span>
<a href="#l47.5"></a><span id="l47.5"> </span>
<a href="#l47.6"></a><span id="l47.6">   // nsIProtocolHandler</span>
<a href="#l47.7"></a><span id="l47.7">   scheme: &quot;gopher&quot;,</span>
<a href="#l47.8"></a><span id="l47.8">   defaultPort: 70,</span>
<a href="#l47.9"></a><span id="l47.9">   protocolFlags: Components.interfaces.nsIProtocolHandler.URI_NORELATIVE |</span>
<a href="#l47.10"></a><span id="l47.10">                  Components.interfaces.nsIProtocolHandler.URI_NOAUTH |</span>
<a href="#l47.11"></a><span id="l47.11">                  Components.interfaces.nsIProtocolHandler.URI_LOADABLE_BY_ANYONE,</span>
<a href="#l47.12"></a><span id="l47.12" class="difflineminus">-  </span>
<a href="#l47.13"></a><span id="l47.13" class="difflineplus">+</span>
<a href="#l47.14"></a><span id="l47.14">   allowPort: function GP_allowPort(port, scheme) {</span>
<a href="#l47.15"></a><span id="l47.15">     return false; // meaningless.</span>
<a href="#l47.16"></a><span id="l47.16">   },</span>
<a href="#l47.17"></a><span id="l47.17"> </span>
<a href="#l47.18"></a><span id="l47.18">   newURI: function GP_newURI(spec, charset, baseURI) {</span>
<a href="#l47.19"></a><span id="l47.19">     var uri = Components.classes[&quot;@mozilla.org/network/standard-url;1&quot;]</span>
<a href="#l47.20"></a><span id="l47.20">                         .createInstance(Components.interfaces.nsIStandardURL);</span>
<a href="#l47.21"></a><span id="l47.21">     uri.init(Components.interfaces.nsIStandardURL.URLTYPE_STANDARD,</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l48.1"></a><span id="l48.1" class="difflineminus">--- a/suite/common/src/nsSessionStore.js</span>
<a href="#l48.2"></a><span id="l48.2" class="difflineplus">+++ b/suite/common/src/nsSessionStore.js</span>
<a href="#l48.3"></a><span id="l48.3" class="difflineat">@@ -147,17 +147,17 @@ SessionStoreService.prototype = {</span>
<a href="#l48.4"></a><span id="l48.4">   _lastSaveTime: 0,</span>
<a href="#l48.5"></a><span id="l48.5"> </span>
<a href="#l48.6"></a><span id="l48.6">   // time in milliseconds when the session was started (saved across sessions),</span>
<a href="#l48.7"></a><span id="l48.7">   // defaults to now if no session was restored or timestamp doesn't exist</span>
<a href="#l48.8"></a><span id="l48.8">   _sessionStartTime: Date.now(),</span>
<a href="#l48.9"></a><span id="l48.9"> </span>
<a href="#l48.10"></a><span id="l48.10">   // states for all currently opened windows</span>
<a href="#l48.11"></a><span id="l48.11">   _windows: {},</span>
<a href="#l48.12"></a><span id="l48.12" class="difflineminus">-  </span>
<a href="#l48.13"></a><span id="l48.13" class="difflineplus">+</span>
<a href="#l48.14"></a><span id="l48.14">   // states for all recently closed windows</span>
<a href="#l48.15"></a><span id="l48.15">   _closedWindows: [],</span>
<a href="#l48.16"></a><span id="l48.16"> </span>
<a href="#l48.17"></a><span id="l48.17">   // collection of session states yet to be restored</span>
<a href="#l48.18"></a><span id="l48.18">   _statesToRestore: {},</span>
<a href="#l48.19"></a><span id="l48.19"> </span>
<a href="#l48.20"></a><span id="l48.20">   // counts the number of crashes since the last clean start</span>
<a href="#l48.21"></a><span id="l48.21">   _recentCrashes: 0,</span>
<a href="#l48.22"></a><span id="l48.22" class="difflineat">@@ -249,17 +249,17 @@ SessionStoreService.prototype = {</span>
<a href="#l48.23"></a><span id="l48.23">         }</span>
<a href="#l48.24"></a><span id="l48.24">         else {</span>
<a href="#l48.25"></a><span id="l48.25">           let lastSessionCrashed =</span>
<a href="#l48.26"></a><span id="l48.26">             this._initialState.session &amp;&amp; this._initialState.session.state &amp;&amp;</span>
<a href="#l48.27"></a><span id="l48.27">             this._initialState.session.state == STATE_RUNNING_STR;</span>
<a href="#l48.28"></a><span id="l48.28">           if (lastSessionCrashed) {</span>
<a href="#l48.29"></a><span id="l48.29">             this._recentCrashes = (this._initialState.session &amp;&amp;</span>
<a href="#l48.30"></a><span id="l48.30">                                    this._initialState.session.recentCrashes || 0) + 1;</span>
<a href="#l48.31"></a><span id="l48.31" class="difflineminus">-            </span>
<a href="#l48.32"></a><span id="l48.32" class="difflineplus">+</span>
<a href="#l48.33"></a><span id="l48.33">             if (this._needsRestorePage(this._initialState, this._recentCrashes)) {</span>
<a href="#l48.34"></a><span id="l48.34">               // replace the crashed session with a restore-page-only session</span>
<a href="#l48.35"></a><span id="l48.35">               let pageData = {</span>
<a href="#l48.36"></a><span id="l48.36">                 url: &quot;about:sessionrestore&quot;,</span>
<a href="#l48.37"></a><span id="l48.37">                 formdata: { &quot;#sessionData&quot;: JSON.stringify(this._initialState) }</span>
<a href="#l48.38"></a><span id="l48.38">               };</span>
<a href="#l48.39"></a><span id="l48.39">               this._initialState = { windows: [{ tabs: [{ entries: [pageData] }] }] };</span>
<a href="#l48.40"></a><span id="l48.40">             }</span>
<a href="#l48.41"></a><span id="l48.41" class="difflineat">@@ -1942,17 +1942,17 @@ SessionStoreService.prototype = {</span>
<a href="#l48.42"></a><span id="l48.42">    * @param aCheckPrivacy</span>
<a href="#l48.43"></a><span id="l48.43">    *        should we check the privacy level for https</span>
<a href="#l48.44"></a><span id="l48.44">    * @param aIsPinned</span>
<a href="#l48.45"></a><span id="l48.45">    *        is the entry we're evaluating for a pinned tab; used only if</span>
<a href="#l48.46"></a><span id="l48.46">    *        aCheckPrivacy</span>
<a href="#l48.47"></a><span id="l48.47">    */</span>
<a href="#l48.48"></a><span id="l48.48">   _extractHostsForCookiesFromEntry:</span>
<a href="#l48.49"></a><span id="l48.49">     function sss__extractHostsForCookiesFromEntry(aEntry, aHosts, aCheckPrivacy, aIsPinned) {</span>
<a href="#l48.50"></a><span id="l48.50" class="difflineminus">- </span>
<a href="#l48.51"></a><span id="l48.51" class="difflineplus">+</span>
<a href="#l48.52"></a><span id="l48.52">     if (aEntry.children) {</span>
<a href="#l48.53"></a><span id="l48.53">       aEntry.children.forEach(function(entry) {</span>
<a href="#l48.54"></a><span id="l48.54">         this._extractHostsForCookiesFromEntry(entry, aHosts, aCheckPrivacy, aIsPinned);</span>
<a href="#l48.55"></a><span id="l48.55">       }, this);</span>
<a href="#l48.56"></a><span id="l48.56">     }</span>
<a href="#l48.57"></a><span id="l48.57">   },</span>
<a href="#l48.58"></a><span id="l48.58"> </span>
<a href="#l48.59"></a><span id="l48.59">   /**</span>
<a href="#l48.60"></a><span id="l48.60" class="difflineat">@@ -2278,17 +2278,17 @@ SessionStoreService.prototype = {</span>
<a href="#l48.61"></a><span id="l48.61">     var openTabCount = aOverwriteTabs ? tabbrowser.browsers.length : -1;</span>
<a href="#l48.62"></a><span id="l48.62">     var newTabCount = winData.tabs.length;</span>
<a href="#l48.63"></a><span id="l48.63">     var tabs = [];</span>
<a href="#l48.64"></a><span id="l48.64"> </span>
<a href="#l48.65"></a><span id="l48.65">     // disable smooth scrolling while adding, moving, removing and selecting tabs</span>
<a href="#l48.66"></a><span id="l48.66">     var tabstrip = tabbrowser.tabContainer.mTabstrip;</span>
<a href="#l48.67"></a><span id="l48.67">     var smoothScroll = tabstrip.smoothScroll;</span>
<a href="#l48.68"></a><span id="l48.68">     tabstrip.smoothScroll = false;</span>
<a href="#l48.69"></a><span id="l48.69" class="difflineminus">-    </span>
<a href="#l48.70"></a><span id="l48.70" class="difflineplus">+</span>
<a href="#l48.71"></a><span id="l48.71">     // make sure that the selected tab won't be closed in order to</span>
<a href="#l48.72"></a><span id="l48.72">     // prevent unnecessary flickering</span>
<a href="#l48.73"></a><span id="l48.73">     if (aOverwriteTabs &amp;&amp; tabbrowser.tabContainer.selectedIndex &gt;= newTabCount)</span>
<a href="#l48.74"></a><span id="l48.74">       tabbrowser.moveTabTo(tabbrowser.selectedTab, newTabCount - 1);</span>
<a href="#l48.75"></a><span id="l48.75"> </span>
<a href="#l48.76"></a><span id="l48.76">     for (var t = 0; t &lt; newTabCount; t++) {</span>
<a href="#l48.77"></a><span id="l48.77">       tabs.push(t &lt; openTabCount ?</span>
<a href="#l48.78"></a><span id="l48.78">                 tabbrowser.tabs[t] :</span>
<a href="#l48.79"></a><span id="l48.79" class="difflineat">@@ -3090,17 +3090,17 @@ SessionStoreService.prototype = {</span>
<a href="#l48.80"></a><span id="l48.80">         aLeft = screenLeft.value + screenWidth.value - aWidth;</span>
<a href="#l48.81"></a><span id="l48.81">       }</span>
<a href="#l48.82"></a><span id="l48.82">       if (aTop &lt; screenTop.value) {</span>
<a href="#l48.83"></a><span id="l48.83">         aTop = screenTop.value;</span>
<a href="#l48.84"></a><span id="l48.84">       } else if (aTop + aHeight &gt; screenTop.value + screenHeight.value) {</span>
<a href="#l48.85"></a><span id="l48.85">         aTop = screenTop.value + screenHeight.value - aHeight;</span>
<a href="#l48.86"></a><span id="l48.86">       }</span>
<a href="#l48.87"></a><span id="l48.87">     }</span>
<a href="#l48.88"></a><span id="l48.88" class="difflineminus">- </span>
<a href="#l48.89"></a><span id="l48.89" class="difflineplus">+</span>
<a href="#l48.90"></a><span id="l48.90">     // only modify those aspects which aren't correct yet</span>
<a href="#l48.91"></a><span id="l48.91">     if (aWidth &amp;&amp; aHeight &amp;&amp; (aWidth != win_(&quot;width&quot;) || aHeight != win_(&quot;height&quot;))) {</span>
<a href="#l48.92"></a><span id="l48.92">       aWindow.resizeTo(aWidth, aHeight);</span>
<a href="#l48.93"></a><span id="l48.93">     }</span>
<a href="#l48.94"></a><span id="l48.94">     if (!isNaN(aLeft) &amp;&amp; !isNaN(aTop) &amp;&amp; (aLeft != win_(&quot;screenX&quot;) || aTop != win_(&quot;screenY&quot;))) {</span>
<a href="#l48.95"></a><span id="l48.95">       aWindow.moveTo(aLeft, aTop);</span>
<a href="#l48.96"></a><span id="l48.96">     }</span>
<a href="#l48.97"></a><span id="l48.97">     if (aSizeMode &amp;&amp; win_(&quot;sizemode&quot;) != aSizeMode)</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l49.1"></a><span id="l49.1" class="difflineminus">--- a/suite/common/src/nsSuiteGlue.js</span>
<a href="#l49.2"></a><span id="l49.2" class="difflineplus">+++ b/suite/common/src/nsSuiteGlue.js</span>
<a href="#l49.3"></a><span id="l49.3" class="difflineat">@@ -350,17 +350,17 @@ SuiteGlue.prototype = {</span>
<a href="#l49.4"></a><span id="l49.4">               .addProgressListener(this, Components.interfaces.nsIWebProgress.NOTIFY_LOCATION);</span>
<a href="#l49.5"></a><span id="l49.5">   },</span>
<a href="#l49.6"></a><span id="l49.6"> </span>
<a href="#l49.7"></a><span id="l49.7">   // profile is available</span>
<a href="#l49.8"></a><span id="l49.8">   _onProfileAfterChange: function()</span>
<a href="#l49.9"></a><span id="l49.9">   {</span>
<a href="#l49.10"></a><span id="l49.10">     // check if we're in safe mode</span>
<a href="#l49.11"></a><span id="l49.11">     if (Services.appinfo.inSafeMode) {</span>
<a href="#l49.12"></a><span id="l49.12" class="difflineminus">-      Services.ww.openWindow(null, &quot;chrome://communicator/content/safeMode.xul&quot;, </span>
<a href="#l49.13"></a><span id="l49.13" class="difflineplus">+      Services.ww.openWindow(null, &quot;chrome://communicator/content/safeMode.xul&quot;,</span>
<a href="#l49.14"></a><span id="l49.14">                              &quot;_blank&quot;, &quot;chrome,centerscreen,modal,resizable=no&quot;, null);</span>
<a href="#l49.15"></a><span id="l49.15">     }</span>
<a href="#l49.16"></a><span id="l49.16">   },</span>
<a href="#l49.17"></a><span id="l49.17"> </span>
<a href="#l49.18"></a><span id="l49.18">   // profile startup handler (contains profile initialization routines)</span>
<a href="#l49.19"></a><span id="l49.19">   _onProfileStartup: function()</span>
<a href="#l49.20"></a><span id="l49.20">   {</span>
<a href="#l49.21"></a><span id="l49.21">     this._updatePrefs();</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l50.1"></a><span id="l50.1" class="difflineminus">--- a/suite/common/sync/syncSetup.js</span>
<a href="#l50.2"></a><span id="l50.2" class="difflineplus">+++ b/suite/common/sync/syncSetup.js</span>
<a href="#l50.3"></a><span id="l50.3" class="difflineat">@@ -560,17 +560,17 @@ var gSyncSetup = {</span>
<a href="#l50.4"></a><span id="l50.4">   startEasySetup: function () {</span>
<a href="#l50.5"></a><span id="l50.5">     // Don't do anything if we have a client already (e.g. we went to</span>
<a href="#l50.6"></a><span id="l50.6">     // Sync Options and just came back).</span>
<a href="#l50.7"></a><span id="l50.7">     if (this._jpakeclient)</span>
<a href="#l50.8"></a><span id="l50.8">       return;</span>
<a href="#l50.9"></a><span id="l50.9"> </span>
<a href="#l50.10"></a><span id="l50.10">     // When onAbort is called, Weave may already be gone.</span>
<a href="#l50.11"></a><span id="l50.11">     const JPAKE_ERROR_USERABORT = Weave.JPAKE_ERROR_USERABORT;</span>
<a href="#l50.12"></a><span id="l50.12" class="difflineminus">-  </span>
<a href="#l50.13"></a><span id="l50.13" class="difflineplus">+</span>
<a href="#l50.14"></a><span id="l50.14">     let self = this;</span>
<a href="#l50.15"></a><span id="l50.15">     this._jpakeclient = new Weave.JPAKEClient({</span>
<a href="#l50.16"></a><span id="l50.16">       displayPIN: function displayPIN(pin) {</span>
<a href="#l50.17"></a><span id="l50.17">         document.getElementById(&quot;easySetupPIN1&quot;).value = pin.slice(0, 4);</span>
<a href="#l50.18"></a><span id="l50.18">         document.getElementById(&quot;easySetupPIN2&quot;).value = pin.slice(4, 8);</span>
<a href="#l50.19"></a><span id="l50.19">         document.getElementById(&quot;easySetupPIN3&quot;).value = pin.slice(8);</span>
<a href="#l50.20"></a><span id="l50.20">       },</span>
<a href="#l50.21"></a><span id="l50.21"> </span>
<a href="#l50.22"></a><span id="l50.22" class="difflineat">@@ -659,17 +659,17 @@ var gSyncSetup = {</span>
<a href="#l50.23"></a><span id="l50.23">       control.editable = true;</span>
<a href="#l50.24"></a><span id="l50.24">       control.value = &quot;&quot;;</span>
<a href="#l50.25"></a><span id="l50.25">     }</span>
<a href="#l50.26"></a><span id="l50.26">     // Force a style flush to ensure that the binding is attached.</span>
<a href="#l50.27"></a><span id="l50.27">     control.clientTop;</span>
<a href="#l50.28"></a><span id="l50.28">     control.focus();</span>
<a href="#l50.29"></a><span id="l50.29">     return control;</span>
<a href="#l50.30"></a><span id="l50.30">   },</span>
<a href="#l50.31"></a><span id="l50.31" class="difflineminus">-  </span>
<a href="#l50.32"></a><span id="l50.32" class="difflineplus">+</span>
<a href="#l50.33"></a><span id="l50.33">   onExistingServerCommand: function () {</span>
<a href="#l50.34"></a><span id="l50.34">     this._updateControl(&quot;existingServer&quot;);</span>
<a href="#l50.35"></a><span id="l50.35">     document.getElementById(&quot;existingServerFeedbackRow&quot;).hidden = true;</span>
<a href="#l50.36"></a><span id="l50.36">     this.checkFields();</span>
<a href="#l50.37"></a><span id="l50.37">   },</span>
<a href="#l50.38"></a><span id="l50.38"> </span>
<a href="#l50.39"></a><span id="l50.39">   onExistingServerInput: function () {</span>
<a href="#l50.40"></a><span id="l50.40">     // Check custom server validity when the user stops typing for 1 second.</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l51.1"></a><span id="l51.1" class="difflineminus">--- a/suite/common/sync/syncUI.js</span>
<a href="#l51.2"></a><span id="l51.2" class="difflineplus">+++ b/suite/common/sync/syncUI.js</span>
<a href="#l51.3"></a><span id="l51.3" class="difflineat">@@ -27,17 +27,17 @@ var gSyncUI = {</span>
<a href="#l51.4"></a><span id="l51.4"> </span>
<a href="#l51.5"></a><span id="l51.5">     // Proceed to set up the UI if Sync has already started up.</span>
<a href="#l51.6"></a><span id="l51.6">     // Otherwise we'll do it when Sync is firing up.</span>
<a href="#l51.7"></a><span id="l51.7">     if (Components.classes[&quot;@mozilla.org/weave/service;1&quot;]</span>
<a href="#l51.8"></a><span id="l51.8">                   .getService().wrappedJSObject.ready) {</span>
<a href="#l51.9"></a><span id="l51.9">       this.initUI();</span>
<a href="#l51.10"></a><span id="l51.10">       return;</span>
<a href="#l51.11"></a><span id="l51.11">     }</span>
<a href="#l51.12"></a><span id="l51.12" class="difflineminus">-    </span>
<a href="#l51.13"></a><span id="l51.13" class="difflineplus">+</span>
<a href="#l51.14"></a><span id="l51.14">     Services.obs.addObserver(this, &quot;weave:service:ready&quot;, true);</span>
<a href="#l51.15"></a><span id="l51.15"> </span>
<a href="#l51.16"></a><span id="l51.16">     // Remove the observer if the window is closed before the observer</span>
<a href="#l51.17"></a><span id="l51.17">     // was triggered.</span>
<a href="#l51.18"></a><span id="l51.18">     window.addEventListener(&quot;unload&quot;, function SUI_unload() {</span>
<a href="#l51.19"></a><span id="l51.19">       gSyncUI._unloaded = true;</span>
<a href="#l51.20"></a><span id="l51.20">       window.removeEventListener(&quot;unload&quot;, SUI_unload, false);</span>
<a href="#l51.21"></a><span id="l51.21">       Services.obs.removeObserver(gSyncUI, &quot;weave:service:ready&quot;);</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l52.1"></a><span id="l52.1" class="difflineminus">--- a/suite/common/tests/browser/browser_345898.js</span>
<a href="#l52.2"></a><span id="l52.2" class="difflineplus">+++ b/suite/common/tests/browser/browser_345898.js</span>
<a href="#l52.3"></a><span id="l52.3" class="difflineat">@@ -1,25 +1,25 @@</span>
<a href="#l52.4"></a><span id="l52.4"> /* This Source Code Form is subject to the terms of the Mozilla Public</span>
<a href="#l52.5"></a><span id="l52.5">  * License, v. 2.0. If a copy of the MPL was not distributed with this</span>
<a href="#l52.6"></a><span id="l52.6">  * file, You can obtain one at http://mozilla.org/MPL/2.0/. */</span>
<a href="#l52.7"></a><span id="l52.7"> </span>
<a href="#l52.8"></a><span id="l52.8"> function test() {</span>
<a href="#l52.9"></a><span id="l52.9">   /** Test for Bug 345898 **/</span>
<a href="#l52.10"></a><span id="l52.10" class="difflineminus">-  </span>
<a href="#l52.11"></a><span id="l52.11" class="difflineplus">+</span>
<a href="#l52.12"></a><span id="l52.12">   function test(aLambda) {</span>
<a href="#l52.13"></a><span id="l52.13">     try {</span>
<a href="#l52.14"></a><span id="l52.14">       aLambda();</span>
<a href="#l52.15"></a><span id="l52.15">       return false;</span>
<a href="#l52.16"></a><span id="l52.16">     }</span>
<a href="#l52.17"></a><span id="l52.17">     catch (ex) {</span>
<a href="#l52.18"></a><span id="l52.18">       return ex.name == &quot;NS_ERROR_ILLEGAL_VALUE&quot;;</span>
<a href="#l52.19"></a><span id="l52.19">     }</span>
<a href="#l52.20"></a><span id="l52.20">   }</span>
<a href="#l52.21"></a><span id="l52.21" class="difflineminus">-  </span>
<a href="#l52.22"></a><span id="l52.22" class="difflineplus">+</span>
<a href="#l52.23"></a><span id="l52.23">   // all of the following calls with illegal arguments should throw NS_ERROR_ILLEGAL_VALUE</span>
<a href="#l52.24"></a><span id="l52.24">   ok(test(() =&gt; ss.getWindowState({})),</span>
<a href="#l52.25"></a><span id="l52.25">      &quot;Invalid window for getWindowState throws&quot;);</span>
<a href="#l52.26"></a><span id="l52.26">   ok(test(() =&gt; ss.setWindowState({}, &quot;&quot;, false)),</span>
<a href="#l52.27"></a><span id="l52.27">      &quot;Invalid window for setWindowState throws&quot;);</span>
<a href="#l52.28"></a><span id="l52.28">   ok(test(() =&gt; ss.getTabState({})),</span>
<a href="#l52.29"></a><span id="l52.29">      &quot;Invalid tab for getTabState throws&quot;);</span>
<a href="#l52.30"></a><span id="l52.30">   ok(test(() =&gt; ss.setTabState({}, &quot;{}&quot;)),</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l53.1"></a><span id="l53.1" class="difflineminus">--- a/suite/common/tests/browser/browser_350525.js</span>
<a href="#l53.2"></a><span id="l53.2" class="difflineplus">+++ b/suite/common/tests/browser/browser_350525.js</span>
<a href="#l53.3"></a><span id="l53.3" class="difflineat">@@ -1,100 +1,100 @@</span>
<a href="#l53.4"></a><span id="l53.4"> function test() {</span>
<a href="#l53.5"></a><span id="l53.5">   /** Test for Bug 350525 **/</span>
<a href="#l53.6"></a><span id="l53.6" class="difflineminus">-  </span>
<a href="#l53.7"></a><span id="l53.7" class="difflineplus">+</span>
<a href="#l53.8"></a><span id="l53.8">   function test(aLambda) {</span>
<a href="#l53.9"></a><span id="l53.9">     try {</span>
<a href="#l53.10"></a><span id="l53.10">       return aLambda() || true;</span>
<a href="#l53.11"></a><span id="l53.11">     }</span>
<a href="#l53.12"></a><span id="l53.12">     catch (ex) { }</span>
<a href="#l53.13"></a><span id="l53.13">     return false;</span>
<a href="#l53.14"></a><span id="l53.14">   }</span>
<a href="#l53.15"></a><span id="l53.15" class="difflineminus">-  </span>
<a href="#l53.16"></a><span id="l53.16" class="difflineplus">+</span>
<a href="#l53.17"></a><span id="l53.17">   waitForExplicitFinish();</span>
<a href="#l53.18"></a><span id="l53.18" class="difflineminus">-  </span>
<a href="#l53.19"></a><span id="l53.19" class="difflineplus">+</span>
<a href="#l53.20"></a><span id="l53.20">   ////////////////////////////</span>
<a href="#l53.21"></a><span id="l53.21">   // setWindowValue, et al. //</span>
<a href="#l53.22"></a><span id="l53.22">   ////////////////////////////</span>
<a href="#l53.23"></a><span id="l53.23">   let key = &quot;Unique name: &quot; + Date.now();</span>
<a href="#l53.24"></a><span id="l53.24">   let value = &quot;Unique value: &quot; + Math.random();</span>
<a href="#l53.25"></a><span id="l53.25" class="difflineminus">-  </span>
<a href="#l53.26"></a><span id="l53.26" class="difflineplus">+</span>
<a href="#l53.27"></a><span id="l53.27">   // test adding</span>
<a href="#l53.28"></a><span id="l53.28">   ok(test(() =&gt; ss.setWindowValue(window, key, value)), &quot;set a window value&quot;);</span>
<a href="#l53.29"></a><span id="l53.29" class="difflineminus">-  </span>
<a href="#l53.30"></a><span id="l53.30" class="difflineplus">+</span>
<a href="#l53.31"></a><span id="l53.31">   // test retrieving</span>
<a href="#l53.32"></a><span id="l53.32">   is(ss.getWindowValue(window, key), value, &quot;stored window value matches original&quot;);</span>
<a href="#l53.33"></a><span id="l53.33" class="difflineminus">-  </span>
<a href="#l53.34"></a><span id="l53.34" class="difflineminus">-  // test deleting </span>
<a href="#l53.35"></a><span id="l53.35" class="difflineplus">+</span>
<a href="#l53.36"></a><span id="l53.36" class="difflineplus">+  // test deleting</span>
<a href="#l53.37"></a><span id="l53.37">   ok(test(() =&gt; ss.deleteWindowValue(window, key)), &quot;delete the window value&quot;);</span>
<a href="#l53.38"></a><span id="l53.38" class="difflineminus">-  </span>
<a href="#l53.39"></a><span id="l53.39" class="difflineplus">+</span>
<a href="#l53.40"></a><span id="l53.40">   // value should not exist post-delete</span>
<a href="#l53.41"></a><span id="l53.41">   is(ss.getWindowValue(window, key), &quot;&quot;, &quot;window value was deleted&quot;);</span>
<a href="#l53.42"></a><span id="l53.42" class="difflineminus">-  </span>
<a href="#l53.43"></a><span id="l53.43" class="difflineplus">+</span>
<a href="#l53.44"></a><span id="l53.44">   // test deleting a non-existent value</span>
<a href="#l53.45"></a><span id="l53.45">   ok(test(() =&gt; ss.deleteWindowValue(window, key)), &quot;delete non-existent window value&quot;);</span>
<a href="#l53.46"></a><span id="l53.46" class="difflineminus">-  </span>
<a href="#l53.47"></a><span id="l53.47" class="difflineplus">+</span>
<a href="#l53.48"></a><span id="l53.48">   /////////////////////////</span>
<a href="#l53.49"></a><span id="l53.49">   // setTabValue, et al. //</span>
<a href="#l53.50"></a><span id="l53.50">   /////////////////////////</span>
<a href="#l53.51"></a><span id="l53.51">   key = &quot;Unique name: &quot; + Math.random();</span>
<a href="#l53.52"></a><span id="l53.52">   value = &quot;Unique value: &quot; + Date.now();</span>
<a href="#l53.53"></a><span id="l53.53">   let tab = getBrowser().addTab();</span>
<a href="#l53.54"></a><span id="l53.54">   tab.linkedBrowser.stop();</span>
<a href="#l53.55"></a><span id="l53.55" class="difflineminus">-  </span>
<a href="#l53.56"></a><span id="l53.56" class="difflineplus">+</span>
<a href="#l53.57"></a><span id="l53.57">   // test adding</span>
<a href="#l53.58"></a><span id="l53.58">   ok(test(() =&gt; ss.setTabValue(tab, key, value)), &quot;store a tab value&quot;);</span>
<a href="#l53.59"></a><span id="l53.59" class="difflineminus">-  </span>
<a href="#l53.60"></a><span id="l53.60" class="difflineplus">+</span>
<a href="#l53.61"></a><span id="l53.61">   // test retrieving</span>
<a href="#l53.62"></a><span id="l53.62">   is(ss.getTabValue(tab, key), value, &quot;stored tab value match original&quot;);</span>
<a href="#l53.63"></a><span id="l53.63" class="difflineminus">-  </span>
<a href="#l53.64"></a><span id="l53.64" class="difflineminus">-  // test deleting </span>
<a href="#l53.65"></a><span id="l53.65" class="difflineplus">+</span>
<a href="#l53.66"></a><span id="l53.66" class="difflineplus">+  // test deleting</span>
<a href="#l53.67"></a><span id="l53.67">   ok(test(() =&gt; ss.deleteTabValue(tab, key)), &quot;delete the tab value&quot;);</span>
<a href="#l53.68"></a><span id="l53.68">   // value should not exist post-delete</span>
<a href="#l53.69"></a><span id="l53.69">   is(ss.getTabValue(tab, key), &quot;&quot;, &quot;tab value was deleted&quot;);</span>
<a href="#l53.70"></a><span id="l53.70" class="difflineminus">-  </span>
<a href="#l53.71"></a><span id="l53.71" class="difflineplus">+</span>
<a href="#l53.72"></a><span id="l53.72">   // test deleting a non-existent value</span>
<a href="#l53.73"></a><span id="l53.73">   ok(test(() =&gt; ss.deleteTabValue(tab, key)), &quot;delete non-existent tab value&quot;);</span>
<a href="#l53.74"></a><span id="l53.74" class="difflineminus">-  </span>
<a href="#l53.75"></a><span id="l53.75" class="difflineplus">+</span>
<a href="#l53.76"></a><span id="l53.76">   // clean up</span>
<a href="#l53.77"></a><span id="l53.77">   getBrowser().removeTab(tab);</span>
<a href="#l53.78"></a><span id="l53.78" class="difflineminus">-  </span>
<a href="#l53.79"></a><span id="l53.79" class="difflineplus">+</span>
<a href="#l53.80"></a><span id="l53.80">   /////////////////////////////////////</span>
<a href="#l53.81"></a><span id="l53.81">   // getClosedTabCount, undoCloseTab //</span>
<a href="#l53.82"></a><span id="l53.82">   /////////////////////////////////////</span>
<a href="#l53.83"></a><span id="l53.83" class="difflineminus">-  </span>
<a href="#l53.84"></a><span id="l53.84" class="difflineplus">+</span>
<a href="#l53.85"></a><span id="l53.85">   // get closed tab count</span>
<a href="#l53.86"></a><span id="l53.86">   let count = ss.getClosedTabCount(window);</span>
<a href="#l53.87"></a><span id="l53.87">   let max_tabs_undo = Services.prefs.getIntPref(&quot;browser.sessionstore.max_tabs_undo&quot;);</span>
<a href="#l53.88"></a><span id="l53.88">   ok(0 &lt;= count &amp;&amp; count &lt;= max_tabs_undo,</span>
<a href="#l53.89"></a><span id="l53.89">      &quot;getClosedTabCount returns zero or at most max_tabs_undo&quot;);</span>
<a href="#l53.90"></a><span id="l53.90" class="difflineminus">-  </span>
<a href="#l53.91"></a><span id="l53.91" class="difflineplus">+</span>
<a href="#l53.92"></a><span id="l53.92">   // create a new tab</span>
<a href="#l53.93"></a><span id="l53.93">   let testURL = &quot;about:&quot;;</span>
<a href="#l53.94"></a><span id="l53.94">   tab = getBrowser().addTab(testURL);</span>
<a href="#l53.95"></a><span id="l53.95">   tab.linkedBrowser.addEventListener(&quot;load&quot;, function testTabLBLoad(aEvent) {</span>
<a href="#l53.96"></a><span id="l53.96">     this.removeEventListener(&quot;load&quot;, testTabLBLoad, true);</span>
<a href="#l53.97"></a><span id="l53.97">     // make sure that the next closed tab will increase getClosedTabCount</span>
<a href="#l53.98"></a><span id="l53.98">     Services.prefs.setIntPref(&quot;browser.sessionstore.max_tabs_undo&quot;, max_tabs_undo + 1);</span>
<a href="#l53.99"></a><span id="l53.99" class="difflineminus">-    </span>
<a href="#l53.100"></a><span id="l53.100" class="difflineplus">+</span>
<a href="#l53.101"></a><span id="l53.101">     // remove tab</span>
<a href="#l53.102"></a><span id="l53.102">     getBrowser().removeTab(tab);</span>
<a href="#l53.103"></a><span id="l53.103" class="difflineminus">-    </span>
<a href="#l53.104"></a><span id="l53.104" class="difflineplus">+</span>
<a href="#l53.105"></a><span id="l53.105">     // getClosedTabCount</span>
<a href="#l53.106"></a><span id="l53.106">     var newcount = ss.getClosedTabCount(window);</span>
<a href="#l53.107"></a><span id="l53.107">     ok(newcount &gt; count, &quot;after closing a tab, getClosedTabCount has been incremented&quot;);</span>
<a href="#l53.108"></a><span id="l53.108" class="difflineminus">-    </span>
<a href="#l53.109"></a><span id="l53.109" class="difflineplus">+</span>
<a href="#l53.110"></a><span id="l53.110">     // undoCloseTab</span>
<a href="#l53.111"></a><span id="l53.111">     tab = test(() =&gt; ss.undoCloseTab(window, 0));</span>
<a href="#l53.112"></a><span id="l53.112">     ok(tab, &quot;undoCloseTab doesn't throw&quot;)</span>
<a href="#l53.113"></a><span id="l53.113" class="difflineminus">-    </span>
<a href="#l53.114"></a><span id="l53.114" class="difflineplus">+</span>
<a href="#l53.115"></a><span id="l53.115">     tab.linkedBrowser.addEventListener(&quot;load&quot;, function testTabLBLoad2(aEvent) {</span>
<a href="#l53.116"></a><span id="l53.116">       this.removeEventListener(&quot;load&quot;, testTabLBLoad2, true);</span>
<a href="#l53.117"></a><span id="l53.117">       is(this.currentURI.spec, testURL, &quot;correct tab was reopened&quot;);</span>
<a href="#l53.118"></a><span id="l53.118" class="difflineminus">-      </span>
<a href="#l53.119"></a><span id="l53.119" class="difflineplus">+</span>
<a href="#l53.120"></a><span id="l53.120">       // clean up</span>
<a href="#l53.121"></a><span id="l53.121">       if (Services.prefs.prefHasUserValue(&quot;browser.sessionstore.max_tabs_undo&quot;))</span>
<a href="#l53.122"></a><span id="l53.122">         Services.prefs.clearUserPref(&quot;browser.sessionstore.max_tabs_undo&quot;);</span>
<a href="#l53.123"></a><span id="l53.123">       getBrowser().removeTab(tab);</span>
<a href="#l53.124"></a><span id="l53.124">       finish();</span>
<a href="#l53.125"></a><span id="l53.125">     }, true);</span>
<a href="#l53.126"></a><span id="l53.126">   }, true);</span>
<a href="#l53.127"></a><span id="l53.127"> }</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l54.1"></a><span id="l54.1" class="difflineminus">--- a/suite/common/tests/browser/browser_393716.js</span>
<a href="#l54.2"></a><span id="l54.2" class="difflineplus">+++ b/suite/common/tests/browser/browser_393716.js</span>
<a href="#l54.3"></a><span id="l54.3" class="difflineat">@@ -1,74 +1,74 @@</span>
<a href="#l54.4"></a><span id="l54.4"> function test() {</span>
<a href="#l54.5"></a><span id="l54.5">   /** Test for Bug 393716 **/</span>
<a href="#l54.6"></a><span id="l54.6" class="difflineminus">-  </span>
<a href="#l54.7"></a><span id="l54.7" class="difflineplus">+</span>
<a href="#l54.8"></a><span id="l54.8">   waitForExplicitFinish();</span>
<a href="#l54.9"></a><span id="l54.9" class="difflineminus">-  </span>
<a href="#l54.10"></a><span id="l54.10" class="difflineplus">+</span>
<a href="#l54.11"></a><span id="l54.11">   /////////////////</span>
<a href="#l54.12"></a><span id="l54.12">   // getTabState //</span>
<a href="#l54.13"></a><span id="l54.13">   /////////////////</span>
<a href="#l54.14"></a><span id="l54.14">   let key = &quot;Unique key: &quot; + Date.now();</span>
<a href="#l54.15"></a><span id="l54.15">   let value = &quot;Unique value: &quot; + Math.random();</span>
<a href="#l54.16"></a><span id="l54.16">   let testURL = &quot;about:config&quot;;</span>
<a href="#l54.17"></a><span id="l54.17" class="difflineminus">-  </span>
<a href="#l54.18"></a><span id="l54.18" class="difflineplus">+</span>
<a href="#l54.19"></a><span id="l54.19">   // create a new tab</span>
<a href="#l54.20"></a><span id="l54.20">   let tab = getBrowser().addTab(testURL);</span>
<a href="#l54.21"></a><span id="l54.21">   ss.setTabValue(tab, key, value);</span>
<a href="#l54.22"></a><span id="l54.22">   tab.linkedBrowser.addEventListener(&quot;load&quot;, function testTabLBLoad(aEvent) {</span>
<a href="#l54.23"></a><span id="l54.23">     this.removeEventListener(&quot;load&quot;, testTabLBLoad, true);</span>
<a href="#l54.24"></a><span id="l54.24">     // get the tab's state</span>
<a href="#l54.25"></a><span id="l54.25">     let state = ss.getTabState(tab);</span>
<a href="#l54.26"></a><span id="l54.26">     ok(state, &quot;get the tab's state&quot;);</span>
<a href="#l54.27"></a><span id="l54.27" class="difflineminus">-    </span>
<a href="#l54.28"></a><span id="l54.28" class="difflineplus">+</span>
<a href="#l54.29"></a><span id="l54.29">     // verify the tab state's integrity</span>
<a href="#l54.30"></a><span id="l54.30">     state = eval(&quot;(&quot; + state + &quot;)&quot;);</span>
<a href="#l54.31"></a><span id="l54.31">     ok(state instanceof Object &amp;&amp; state.entries instanceof Array &amp;&amp; state.entries.length &gt; 0,</span>
<a href="#l54.32"></a><span id="l54.32">        &quot;state object seems valid&quot;);</span>
<a href="#l54.33"></a><span id="l54.33">     ok(state.entries.length == 1 &amp;&amp; state.entries[0].url == testURL,</span>
<a href="#l54.34"></a><span id="l54.34">        &quot;Got the expected state object (test URL)&quot;);</span>
<a href="#l54.35"></a><span id="l54.35">     ok(state.extData &amp;&amp; state.extData[key] == value,</span>
<a href="#l54.36"></a><span id="l54.36">        &quot;Got the expected state object (test manually set tab value)&quot;);</span>
<a href="#l54.37"></a><span id="l54.37" class="difflineminus">-    </span>
<a href="#l54.38"></a><span id="l54.38" class="difflineplus">+</span>
<a href="#l54.39"></a><span id="l54.39">     // clean up</span>
<a href="#l54.40"></a><span id="l54.40">     getBrowser().removeTab(tab);</span>
<a href="#l54.41"></a><span id="l54.41">   }, true);</span>
<a href="#l54.42"></a><span id="l54.42" class="difflineminus">-  </span>
<a href="#l54.43"></a><span id="l54.43" class="difflineplus">+</span>
<a href="#l54.44"></a><span id="l54.44">   //////////////////////////////////</span>
<a href="#l54.45"></a><span id="l54.45">   // setTabState and duplicateTab //</span>
<a href="#l54.46"></a><span id="l54.46">   //////////////////////////////////</span>
<a href="#l54.47"></a><span id="l54.47">   let key2 = &quot;key2&quot;;</span>
<a href="#l54.48"></a><span id="l54.48">   let value2 = &quot;Value &quot; + Math.random();</span>
<a href="#l54.49"></a><span id="l54.49">   let value3 = &quot;Another value: &quot; + Date.now();</span>
<a href="#l54.50"></a><span id="l54.50">   let state = { entries: [{ url: testURL }], extData: { key2: value2 } };</span>
<a href="#l54.51"></a><span id="l54.51" class="difflineminus">-  </span>
<a href="#l54.52"></a><span id="l54.52" class="difflineplus">+</span>
<a href="#l54.53"></a><span id="l54.53">   // create a new tab</span>
<a href="#l54.54"></a><span id="l54.54">   let tab2 = getBrowser().addTab();</span>
<a href="#l54.55"></a><span id="l54.55">   // set the tab's state</span>
<a href="#l54.56"></a><span id="l54.56">   ss.setTabState(tab2, JSON.stringify(state));</span>
<a href="#l54.57"></a><span id="l54.57">   tab2.linkedBrowser.addEventListener(&quot;load&quot;, function testTab2LBLoad(aEvent) {</span>
<a href="#l54.58"></a><span id="l54.58">     this.removeEventListener(&quot;load&quot;, testTab2LBLoad, true);</span>
<a href="#l54.59"></a><span id="l54.59">    // verify the correctness of the restored tab</span>
<a href="#l54.60"></a><span id="l54.60">     ok(ss.getTabValue(tab2, key2) == value2 &amp;&amp; this.currentURI.spec == testURL,</span>
<a href="#l54.61"></a><span id="l54.61">        &quot;the tab's state was correctly restored&quot;);</span>
<a href="#l54.62"></a><span id="l54.62" class="difflineminus">-    </span>
<a href="#l54.63"></a><span id="l54.63" class="difflineplus">+</span>
<a href="#l54.64"></a><span id="l54.64">     // add text data</span>
<a href="#l54.65"></a><span id="l54.65">     let textbox = this.contentDocument.getElementById(&quot;textbox&quot;);</span>
<a href="#l54.66"></a><span id="l54.66">     textbox.value = value3;</span>
<a href="#l54.67"></a><span id="l54.67" class="difflineminus">-    </span>
<a href="#l54.68"></a><span id="l54.68" class="difflineplus">+</span>
<a href="#l54.69"></a><span id="l54.69">     // duplicate the tab</span>
<a href="#l54.70"></a><span id="l54.70">     let duplicateTab = ss.duplicateTab(window, tab2);</span>
<a href="#l54.71"></a><span id="l54.71">     getBrowser().removeTab(tab2);</span>
<a href="#l54.72"></a><span id="l54.72" class="difflineminus">-    </span>
<a href="#l54.73"></a><span id="l54.73" class="difflineplus">+</span>
<a href="#l54.74"></a><span id="l54.74">     duplicateTab.linkedBrowser.addEventListener(&quot;load&quot;, function testTab2DupLBLoad(aEvent) {</span>
<a href="#l54.75"></a><span id="l54.75">       this.removeEventListener(&quot;load&quot;, testTab2DupLBLoad, true);</span>
<a href="#l54.76"></a><span id="l54.76">       // verify the correctness of the duplicated tab</span>
<a href="#l54.77"></a><span id="l54.77">       ok(ss.getTabValue(duplicateTab, key2) == value2 &amp;&amp; this.currentURI.spec == testURL,</span>
<a href="#l54.78"></a><span id="l54.78">          &quot;correctly duplicated the tab's state&quot;);</span>
<a href="#l54.79"></a><span id="l54.79">       let textbox = this.contentDocument.getElementById(&quot;textbox&quot;);</span>
<a href="#l54.80"></a><span id="l54.80">       is(textbox.value, value3, &quot;also duplicated text data&quot;);</span>
<a href="#l54.81"></a><span id="l54.81" class="difflineminus">-      </span>
<a href="#l54.82"></a><span id="l54.82" class="difflineplus">+</span>
<a href="#l54.83"></a><span id="l54.83">       // clean up</span>
<a href="#l54.84"></a><span id="l54.84">       getBrowser().removeTab(duplicateTab);</span>
<a href="#l54.85"></a><span id="l54.85">       finish();</span>
<a href="#l54.86"></a><span id="l54.86">     }, true);</span>
<a href="#l54.87"></a><span id="l54.87">   }, true);</span>
<a href="#l54.88"></a><span id="l54.88"> }</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l55.1"></a><span id="l55.1" class="difflineminus">--- a/suite/common/tests/browser/browser_408470.js</span>
<a href="#l55.2"></a><span id="l55.2" class="difflineplus">+++ b/suite/common/tests/browser/browser_408470.js</span>
<a href="#l55.3"></a><span id="l55.3" class="difflineat">@@ -1,57 +1,57 @@</span>
<a href="#l55.4"></a><span id="l55.4"> /* This Source Code Form is subject to the terms of the Mozilla Public</span>
<a href="#l55.5"></a><span id="l55.5">  * License, v. 2.0. If a copy of the MPL was not distributed with this</span>
<a href="#l55.6"></a><span id="l55.6">  * file, You can obtain one at http://mozilla.org/MPL/2.0/. */</span>
<a href="#l55.7"></a><span id="l55.7"> </span>
<a href="#l55.8"></a><span id="l55.8"> function test() {</span>
<a href="#l55.9"></a><span id="l55.9">   /** Test for Bug 408470 **/</span>
<a href="#l55.10"></a><span id="l55.10" class="difflineminus">-  </span>
<a href="#l55.11"></a><span id="l55.11" class="difflineplus">+</span>
<a href="#l55.12"></a><span id="l55.12">   waitForExplicitFinish();</span>
<a href="#l55.13"></a><span id="l55.13" class="difflineminus">-  </span>
<a href="#l55.14"></a><span id="l55.14" class="difflineplus">+</span>
<a href="#l55.15"></a><span id="l55.15">   let pendingCount = 1;</span>
<a href="#l55.16"></a><span id="l55.16">   let rootDir = getRootDirectory(gTestPath);</span>
<a href="#l55.17"></a><span id="l55.17">   let testURL = rootDir + &quot;browser_408470_sample.html&quot;;</span>
<a href="#l55.18"></a><span id="l55.18">   let tab = getBrowser().addTab(testURL);</span>
<a href="#l55.19"></a><span id="l55.19">   let window = tab.ownerDocument.defaultView;</span>
<a href="#l55.20"></a><span id="l55.20" class="difflineminus">-  </span>
<a href="#l55.21"></a><span id="l55.21" class="difflineplus">+</span>
<a href="#l55.22"></a><span id="l55.22">   tab.linkedBrowser.addEventListener(&quot;load&quot;, function loadListener1(aEvent) {</span>
<a href="#l55.23"></a><span id="l55.23">     tab.linkedBrowser.removeEventListener(&quot;load&quot;, loadListener1, true);</span>
<a href="#l55.24"></a><span id="l55.24">     // enable all stylesheets and verify that they're correctly persisted</span>
<a href="#l55.25"></a><span id="l55.25">     Array.forEach(tab.linkedBrowser.contentDocument.styleSheets, function(aSS, aIx) {</span>
<a href="#l55.26"></a><span id="l55.26">       pendingCount++;</span>
<a href="#l55.27"></a><span id="l55.27">       let ssTitle = aSS.title;</span>
<a href="#l55.28"></a><span id="l55.28">       stylesheetSwitchAll(tab.linkedBrowser.contentWindow, ssTitle);</span>
<a href="#l55.29"></a><span id="l55.29" class="difflineminus">-      </span>
<a href="#l55.30"></a><span id="l55.30" class="difflineplus">+</span>
<a href="#l55.31"></a><span id="l55.31">       let newTab = ss.duplicateTab(window,tab);</span>
<a href="#l55.32"></a><span id="l55.32">       newTab.linkedBrowser.addEventListener(&quot;load&quot;, function loadListener2(aEvent) {</span>
<a href="#l55.33"></a><span id="l55.33">         newTab.linkedBrowser.removeEventListener(&quot;load&quot;, loadListener2, true);</span>
<a href="#l55.34"></a><span id="l55.34">         let states = Array.map(newTab.linkedBrowser.contentDocument.styleSheets,</span>
<a href="#l55.35"></a><span id="l55.35">                                aSS =&gt; !aSS.disabled);</span>
<a href="#l55.36"></a><span id="l55.36">         let correct = states.indexOf(true) == aIx &amp;&amp; states.indexOf(true, aIx + 1) == -1;</span>
<a href="#l55.37"></a><span id="l55.37" class="difflineminus">-        </span>
<a href="#l55.38"></a><span id="l55.38" class="difflineplus">+</span>
<a href="#l55.39"></a><span id="l55.39">         if (/^fail_/.test(ssTitle))</span>
<a href="#l55.40"></a><span id="l55.40">           ok(!correct, &quot;didn't restore stylesheet &quot; + ssTitle);</span>
<a href="#l55.41"></a><span id="l55.41">         else</span>
<a href="#l55.42"></a><span id="l55.42">           ok(correct, &quot;restored stylesheet &quot; + ssTitle);</span>
<a href="#l55.43"></a><span id="l55.43" class="difflineminus">-        </span>
<a href="#l55.44"></a><span id="l55.44" class="difflineplus">+</span>
<a href="#l55.45"></a><span id="l55.45">         getBrowser().removeTab(newTab);</span>
<a href="#l55.46"></a><span id="l55.46">         if (--pendingCount == 0)</span>
<a href="#l55.47"></a><span id="l55.47">           finish();</span>
<a href="#l55.48"></a><span id="l55.48">       }, true);</span>
<a href="#l55.49"></a><span id="l55.49">     });</span>
<a href="#l55.50"></a><span id="l55.50" class="difflineminus">-    </span>
<a href="#l55.51"></a><span id="l55.51" class="difflineplus">+</span>
<a href="#l55.52"></a><span id="l55.52">     // disable all styles and verify that this is correctly persisted</span>
<a href="#l55.53"></a><span id="l55.53">     tab.linkedBrowser.markupDocumentViewer.authorStyleDisabled = true;</span>
<a href="#l55.54"></a><span id="l55.54">     let newTab = ss.duplicateTab(window,tab);</span>
<a href="#l55.55"></a><span id="l55.55">     newTab.linkedBrowser.addEventListener(&quot;load&quot;, function loadListener3(aEvent) {</span>
<a href="#l55.56"></a><span id="l55.56">       newTab.linkedBrowser.removeEventListener(&quot;load&quot;, loadListener3, true);</span>
<a href="#l55.57"></a><span id="l55.57">       is(newTab.linkedBrowser.markupDocumentViewer.authorStyleDisabled, true,</span>
<a href="#l55.58"></a><span id="l55.58">          &quot;disabled all stylesheets&quot;);</span>
<a href="#l55.59"></a><span id="l55.59" class="difflineminus">-      </span>
<a href="#l55.60"></a><span id="l55.60" class="difflineplus">+</span>
<a href="#l55.61"></a><span id="l55.61">       getBrowser().removeTab(newTab);</span>
<a href="#l55.62"></a><span id="l55.62">       if (--pendingCount == 0)</span>
<a href="#l55.63"></a><span id="l55.63">         finish();</span>
<a href="#l55.64"></a><span id="l55.64">     }, true);</span>
<a href="#l55.65"></a><span id="l55.65" class="difflineminus">-    </span>
<a href="#l55.66"></a><span id="l55.66" class="difflineplus">+</span>
<a href="#l55.67"></a><span id="l55.67">     getBrowser().removeTab(tab);</span>
<a href="#l55.68"></a><span id="l55.68">   }, true);</span>
<a href="#l55.69"></a><span id="l55.69"> }</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l56.1"></a><span id="l56.1" class="difflineminus">--- a/suite/common/tests/browser/browser_447951.js</span>
<a href="#l56.2"></a><span id="l56.2" class="difflineplus">+++ b/suite/common/tests/browser/browser_447951.js</span>
<a href="#l56.3"></a><span id="l56.3" class="difflineat">@@ -1,50 +1,50 @@</span>
<a href="#l56.4"></a><span id="l56.4"> /* This Source Code Form is subject to the terms of the Mozilla Public</span>
<a href="#l56.5"></a><span id="l56.5">  * License, v. 2.0. If a copy of the MPL was not distributed with this</span>
<a href="#l56.6"></a><span id="l56.6">  * file, You can obtain one at http://mozilla.org/MPL/2.0/. */</span>
<a href="#l56.7"></a><span id="l56.7"> </span>
<a href="#l56.8"></a><span id="l56.8"> function test() {</span>
<a href="#l56.9"></a><span id="l56.9">   /** Test for Bug 447951 **/</span>
<a href="#l56.10"></a><span id="l56.10" class="difflineminus">-  </span>
<a href="#l56.11"></a><span id="l56.11" class="difflineplus">+</span>
<a href="#l56.12"></a><span id="l56.12">   waitForExplicitFinish();</span>
<a href="#l56.13"></a><span id="l56.13">   const baseURL = &quot;http://mochi.test:8888/browser/&quot; +</span>
<a href="#l56.14"></a><span id="l56.14">     &quot;suite/common/tests/browser/browser_447951_sample.html#&quot;;</span>
<a href="#l56.15"></a><span id="l56.15"> </span>
<a href="#l56.16"></a><span id="l56.16">   let tab = getBrowser().addTab();</span>
<a href="#l56.17"></a><span id="l56.17">   tab.linkedBrowser.addEventListener(&quot;load&quot;, function testTabLBLoad(aEvent) {</span>
<a href="#l56.18"></a><span id="l56.18">     tab.linkedBrowser.removeEventListener(&quot;load&quot;, testTabLBLoad, true);</span>
<a href="#l56.19"></a><span id="l56.19" class="difflineminus">-    </span>
<a href="#l56.20"></a><span id="l56.20" class="difflineplus">+</span>
<a href="#l56.21"></a><span id="l56.21">     let tabState = { entries: [] };</span>
<a href="#l56.22"></a><span id="l56.22">     let max_entries = Services.prefs.getIntPref(&quot;browser.sessionhistory.max_entries&quot;);</span>
<a href="#l56.23"></a><span id="l56.23">     for (let i = 0; i &lt; max_entries; i++)</span>
<a href="#l56.24"></a><span id="l56.24">       tabState.entries.push({ url: baseURL + i });</span>
<a href="#l56.25"></a><span id="l56.25" class="difflineminus">-    </span>
<a href="#l56.26"></a><span id="l56.26" class="difflineplus">+</span>
<a href="#l56.27"></a><span id="l56.27">     ss.setTabState(tab, JSON.stringify(tabState));</span>
<a href="#l56.28"></a><span id="l56.28">     tab.addEventListener(&quot;SSTabRestored&quot;, function testTabSSTabRestored(aEvent) {</span>
<a href="#l56.29"></a><span id="l56.29">       tab.removeEventListener(&quot;SSTabRestored&quot;, testTabSSTabRestored, false);</span>
<a href="#l56.30"></a><span id="l56.30">       tabState = JSON.parse(ss.getTabState(tab));</span>
<a href="#l56.31"></a><span id="l56.31">       is(tabState.entries.length, max_entries, &quot;session history filled to the limit&quot;);</span>
<a href="#l56.32"></a><span id="l56.32">       is(tabState.entries[0].url, baseURL + 0, &quot;... but not more&quot;);</span>
<a href="#l56.33"></a><span id="l56.33" class="difflineminus">-      </span>
<a href="#l56.34"></a><span id="l56.34" class="difflineplus">+</span>
<a href="#l56.35"></a><span id="l56.35">       // visit yet another anchor (appending it to session history)</span>
<a href="#l56.36"></a><span id="l56.36">       let doc = tab.linkedBrowser.contentDocument;</span>
<a href="#l56.37"></a><span id="l56.37">       let event = doc.createEvent(&quot;MouseEvents&quot;);</span>
<a href="#l56.38"></a><span id="l56.38">       event.initMouseEvent(&quot;click&quot;, true, true, doc.defaultView, 1,</span>
<a href="#l56.39"></a><span id="l56.39">                            0, 0, 0, 0, false, false, false, false, 0, null);</span>
<a href="#l56.40"></a><span id="l56.40">       doc.querySelector(&quot;a&quot;).dispatchEvent(event);</span>
<a href="#l56.41"></a><span id="l56.41" class="difflineminus">-      </span>
<a href="#l56.42"></a><span id="l56.42" class="difflineplus">+</span>
<a href="#l56.43"></a><span id="l56.43">       executeSoon(function() {</span>
<a href="#l56.44"></a><span id="l56.44">         tabState = JSON.parse(ss.getTabState(tab));</span>
<a href="#l56.45"></a><span id="l56.45">         is(tab.linkedBrowser.currentURI.spec, baseURL + &quot;end&quot;,</span>
<a href="#l56.46"></a><span id="l56.46">            &quot;the new anchor was loaded&quot;);</span>
<a href="#l56.47"></a><span id="l56.47">         is(tabState.entries[tabState.entries.length - 1].url, baseURL + &quot;end&quot;,</span>
<a href="#l56.48"></a><span id="l56.48">            &quot;... and ignored&quot;);</span>
<a href="#l56.49"></a><span id="l56.49">         is(tabState.entries[0].url, baseURL + 1,</span>
<a href="#l56.50"></a><span id="l56.50">            &quot;... and the first item was removed&quot;);</span>
<a href="#l56.51"></a><span id="l56.51" class="difflineminus">-        </span>
<a href="#l56.52"></a><span id="l56.52" class="difflineplus">+</span>
<a href="#l56.53"></a><span id="l56.53">         // clean up</span>
<a href="#l56.54"></a><span id="l56.54">         getBrowser().removeTab(tab);</span>
<a href="#l56.55"></a><span id="l56.55">         finish();</span>
<a href="#l56.56"></a><span id="l56.56">       });</span>
<a href="#l56.57"></a><span id="l56.57">     }, false);</span>
<a href="#l56.58"></a><span id="l56.58">   }, true);</span>
<a href="#l56.59"></a><span id="l56.59"> }</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l57.1"></a><span id="l57.1" class="difflineminus">--- a/suite/common/tests/browser/browser_448741.js</span>
<a href="#l57.2"></a><span id="l57.2" class="difflineplus">+++ b/suite/common/tests/browser/browser_448741.js</span>
<a href="#l57.3"></a><span id="l57.3" class="difflineat">@@ -1,26 +1,26 @@</span>
<a href="#l57.4"></a><span id="l57.4"> /* This Source Code Form is subject to the terms of the Mozilla Public</span>
<a href="#l57.5"></a><span id="l57.5">  * License, v. 2.0. If a copy of the MPL was not distributed with this</span>
<a href="#l57.6"></a><span id="l57.6">  * file, You can obtain one at http://mozilla.org/MPL/2.0/. */</span>
<a href="#l57.7"></a><span id="l57.7"> </span>
<a href="#l57.8"></a><span id="l57.8"> function test() {</span>
<a href="#l57.9"></a><span id="l57.9">   /** Test for Bug 448741 **/</span>
<a href="#l57.10"></a><span id="l57.10" class="difflineminus">-  </span>
<a href="#l57.11"></a><span id="l57.11" class="difflineplus">+</span>
<a href="#l57.12"></a><span id="l57.12">   waitForExplicitFinish();</span>
<a href="#l57.13"></a><span id="l57.13" class="difflineminus">-  </span>
<a href="#l57.14"></a><span id="l57.14" class="difflineplus">+</span>
<a href="#l57.15"></a><span id="l57.15">   let uniqueName = &quot;bug 448741&quot;;</span>
<a href="#l57.16"></a><span id="l57.16">   let uniqueValue = &quot;as good as unique: &quot; + Date.now();</span>
<a href="#l57.17"></a><span id="l57.17" class="difflineminus">-  </span>
<a href="#l57.18"></a><span id="l57.18" class="difflineplus">+</span>
<a href="#l57.19"></a><span id="l57.19">   // set a unique value on a new, blank tab</span>
<a href="#l57.20"></a><span id="l57.20">   var tab = getBrowser().addTab();</span>
<a href="#l57.21"></a><span id="l57.21">   tab.linkedBrowser.stop();</span>
<a href="#l57.22"></a><span id="l57.22">   ss.setTabValue(tab, uniqueName, uniqueValue);</span>
<a href="#l57.23"></a><span id="l57.23">   let valueWasCleaned = false;</span>
<a href="#l57.24"></a><span id="l57.24" class="difflineminus">-  </span>
<a href="#l57.25"></a><span id="l57.25" class="difflineplus">+</span>
<a href="#l57.26"></a><span id="l57.26">   // prevent our value from being written to disk</span>
<a href="#l57.27"></a><span id="l57.27">   function cleaningObserver(aSubject, aTopic, aData) {</span>
<a href="#l57.28"></a><span id="l57.28">     ok(aTopic == &quot;sessionstore-state-write&quot;, &quot;observed correct topic?&quot;);</span>
<a href="#l57.29"></a><span id="l57.29">     ok(aSubject instanceof Ci.nsISupportsString, &quot;subject is a string?&quot;);</span>
<a href="#l57.30"></a><span id="l57.30">     ok(aSubject.data.indexOf(uniqueValue) &gt; -1, &quot;data contains our value?&quot;);</span>
<a href="#l57.31"></a><span id="l57.31"> </span>
<a href="#l57.32"></a><span id="l57.32">     // find the data for the newly added tab and delete it</span>
<a href="#l57.33"></a><span id="l57.33">     let state = JSON.parse(aSubject.data);</span>
<a href="#l57.34"></a><span id="l57.34" class="difflineat">@@ -33,30 +33,30 @@ function test() {</span>
<a href="#l57.35"></a><span id="l57.35">         }</span>
<a href="#l57.36"></a><span id="l57.36">       });</span>
<a href="#l57.37"></a><span id="l57.37">     });</span>
<a href="#l57.38"></a><span id="l57.38"> </span>
<a href="#l57.39"></a><span id="l57.39">     ok(valueWasCleaned, &quot;found and removed the specific tab value&quot;);</span>
<a href="#l57.40"></a><span id="l57.40">     aSubject.data = JSON.stringify(state);</span>
<a href="#l57.41"></a><span id="l57.41">     Services.obs.removeObserver(cleaningObserver, aTopic, false);</span>
<a href="#l57.42"></a><span id="l57.42">   }</span>
<a href="#l57.43"></a><span id="l57.43" class="difflineminus">-  </span>
<a href="#l57.44"></a><span id="l57.44" class="difflineplus">+</span>
<a href="#l57.45"></a><span id="l57.45">   // make sure that all later observers don't see that value any longer</span>
<a href="#l57.46"></a><span id="l57.46">   function checkingObserver(aSubject, aTopic, aData) {</span>
<a href="#l57.47"></a><span id="l57.47">     ok(valueWasCleaned &amp;&amp; aSubject instanceof Ci.nsISupportsString,</span>
<a href="#l57.48"></a><span id="l57.48">        &quot;ready to check the cleaned state?&quot;);</span>
<a href="#l57.49"></a><span id="l57.49">     ok(aSubject.data.indexOf(uniqueValue) == -1, &quot;data no longer contains our value?&quot;);</span>
<a href="#l57.50"></a><span id="l57.50"> </span>
<a href="#l57.51"></a><span id="l57.51">     // clean up</span>
<a href="#l57.52"></a><span id="l57.52">     getBrowser().removeTab(tab);</span>
<a href="#l57.53"></a><span id="l57.53">     Services.obs.removeObserver(checkingObserver, aTopic, false);</span>
<a href="#l57.54"></a><span id="l57.54">     if (Services.prefs.prefHasUserValue(&quot;browser.sessionstore.interval&quot;))</span>
<a href="#l57.55"></a><span id="l57.55">       Services.prefs.clearUserPref(&quot;browser.sessionstore.interval&quot;);</span>
<a href="#l57.56"></a><span id="l57.56">     finish();</span>
<a href="#l57.57"></a><span id="l57.57">   }</span>
<a href="#l57.58"></a><span id="l57.58" class="difflineminus">-  </span>
<a href="#l57.59"></a><span id="l57.59" class="difflineplus">+</span>
<a href="#l57.60"></a><span id="l57.60">   // last added observers are invoked first</span>
<a href="#l57.61"></a><span id="l57.61">   Services.obs.addObserver(checkingObserver, &quot;sessionstore-state-write&quot;, false);</span>
<a href="#l57.62"></a><span id="l57.62">   Services.obs.addObserver(cleaningObserver, &quot;sessionstore-state-write&quot;, false);</span>
<a href="#l57.63"></a><span id="l57.63" class="difflineminus">-  </span>
<a href="#l57.64"></a><span id="l57.64" class="difflineplus">+</span>
<a href="#l57.65"></a><span id="l57.65">   // trigger an immediate save operation</span>
<a href="#l57.66"></a><span id="l57.66">   Services.prefs.setIntPref(&quot;browser.sessionstore.interval&quot;, 0);</span>
<a href="#l57.67"></a><span id="l57.67"> }</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l58.1"></a><span id="l58.1" class="difflineminus">--- a/suite/common/tests/browser/browser_454908.js</span>
<a href="#l58.2"></a><span id="l58.2" class="difflineplus">+++ b/suite/common/tests/browser/browser_454908.js</span>
<a href="#l58.3"></a><span id="l58.3" class="difflineat">@@ -1,48 +1,48 @@</span>
<a href="#l58.4"></a><span id="l58.4"> /* This Source Code Form is subject to the terms of the Mozilla Public</span>
<a href="#l58.5"></a><span id="l58.5">  * License, v. 2.0. If a copy of the MPL was not distributed with this</span>
<a href="#l58.6"></a><span id="l58.6">  * file, You can obtain one at http://mozilla.org/MPL/2.0/. */</span>
<a href="#l58.7"></a><span id="l58.7"> </span>
<a href="#l58.8"></a><span id="l58.8"> function test() {</span>
<a href="#l58.9"></a><span id="l58.9">   /** Test for Bug 454908 **/</span>
<a href="#l58.10"></a><span id="l58.10" class="difflineminus">-  </span>
<a href="#l58.11"></a><span id="l58.11" class="difflineplus">+</span>
<a href="#l58.12"></a><span id="l58.12">   waitForExplicitFinish();</span>
<a href="#l58.13"></a><span id="l58.13" class="difflineminus">-  </span>
<a href="#l58.14"></a><span id="l58.14" class="difflineplus">+</span>
<a href="#l58.15"></a><span id="l58.15">   let fieldValues = {</span>
<a href="#l58.16"></a><span id="l58.16">     username: &quot;User &quot; + Math.random(),</span>
<a href="#l58.17"></a><span id="l58.17">     passwd:   &quot;pwd&quot; + Date.now()</span>
<a href="#l58.18"></a><span id="l58.18">   };</span>
<a href="#l58.19"></a><span id="l58.19"> </span>
<a href="#l58.20"></a><span id="l58.20">   // make sure we do save form data</span>
<a href="#l58.21"></a><span id="l58.21">   Services.prefs.setIntPref(&quot;browser.sessionstore.privacy_level&quot;, 0);</span>
<a href="#l58.22"></a><span id="l58.22" class="difflineminus">-  </span>
<a href="#l58.23"></a><span id="l58.23" class="difflineplus">+</span>
<a href="#l58.24"></a><span id="l58.24">   let rootDir = getRootDirectory(gTestPath);</span>
<a href="#l58.25"></a><span id="l58.25">   let testURL = rootDir + &quot;browser_454908_sample.html&quot;;</span>
<a href="#l58.26"></a><span id="l58.26">   let tab = getBrowser().addTab(testURL);</span>
<a href="#l58.27"></a><span id="l58.27">   tab.linkedBrowser.addEventListener(&quot;load&quot;, function testTabLBLoad(aEvent) {</span>
<a href="#l58.28"></a><span id="l58.28">     tab.linkedBrowser.removeEventListener(&quot;load&quot;, testTabLBLoad, true);</span>
<a href="#l58.29"></a><span id="l58.29">     let doc = tab.linkedBrowser.contentDocument;</span>
<a href="#l58.30"></a><span id="l58.30">     for (let id in fieldValues)</span>
<a href="#l58.31"></a><span id="l58.31">       doc.getElementById(id).value = fieldValues[id];</span>
<a href="#l58.32"></a><span id="l58.32" class="difflineminus">-    </span>
<a href="#l58.33"></a><span id="l58.33" class="difflineplus">+</span>
<a href="#l58.34"></a><span id="l58.34">     getBrowser().removeTab(tab);</span>
<a href="#l58.35"></a><span id="l58.35" class="difflineminus">-    </span>
<a href="#l58.36"></a><span id="l58.36" class="difflineplus">+</span>
<a href="#l58.37"></a><span id="l58.37">     tab = getBrowser().undoCloseTab();</span>
<a href="#l58.38"></a><span id="l58.38">     tab.linkedBrowser.addEventListener(&quot;load&quot;, function testTabLBLoad2(aEvent) {</span>
<a href="#l58.39"></a><span id="l58.39">       tab.linkedBrowser.removeEventListener(&quot;load&quot;, testTabLBLoad2, true);</span>
<a href="#l58.40"></a><span id="l58.40">       let doc = tab.linkedBrowser.contentDocument;</span>
<a href="#l58.41"></a><span id="l58.41">       for (let id in fieldValues) {</span>
<a href="#l58.42"></a><span id="l58.42">         let node = doc.getElementById(id);</span>
<a href="#l58.43"></a><span id="l58.43">         if (node.type == &quot;password&quot;)</span>
<a href="#l58.44"></a><span id="l58.44">           is(node.value, &quot;&quot;, &quot;password wasn't saved/restored&quot;);</span>
<a href="#l58.45"></a><span id="l58.45">         else</span>
<a href="#l58.46"></a><span id="l58.46">           is(node.value, fieldValues[id], &quot;username was saved/restored&quot;);</span>
<a href="#l58.47"></a><span id="l58.47">       }</span>
<a href="#l58.48"></a><span id="l58.48" class="difflineminus">-      </span>
<a href="#l58.49"></a><span id="l58.49" class="difflineplus">+</span>
<a href="#l58.50"></a><span id="l58.50">       // clean up</span>
<a href="#l58.51"></a><span id="l58.51">       if (Services.prefs.prefHasUserValue(&quot;browser.sessionstore.privacy_level&quot;))</span>
<a href="#l58.52"></a><span id="l58.52">         Services.prefs.clearUserPref(&quot;browser.sessionstore.privacy_level&quot;);</span>
<a href="#l58.53"></a><span id="l58.53">       // undoCloseTab can reuse a single blank tab, so we have to</span>
<a href="#l58.54"></a><span id="l58.54">       // make sure not to close the window when closing our last tab</span>
<a href="#l58.55"></a><span id="l58.55">       if (gBrowser.tabContainer.childNodes.length == 1)</span>
<a href="#l58.56"></a><span id="l58.56">         gBrowser.addTab();</span>
<a href="#l58.57"></a><span id="l58.57">       gBrowser.removeTab(tab);</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l59.1"></a><span id="l59.1" class="difflineminus">--- a/suite/common/tests/browser/browser_456342.js</span>
<a href="#l59.2"></a><span id="l59.2" class="difflineplus">+++ b/suite/common/tests/browser/browser_456342.js</span>
<a href="#l59.3"></a><span id="l59.3" class="difflineat">@@ -1,47 +1,47 @@</span>
<a href="#l59.4"></a><span id="l59.4"> /* This Source Code Form is subject to the terms of the Mozilla Public</span>
<a href="#l59.5"></a><span id="l59.5">  * License, v. 2.0. If a copy of the MPL was not distributed with this</span>
<a href="#l59.6"></a><span id="l59.6">  * file, You can obtain one at http://mozilla.org/MPL/2.0/. */</span>
<a href="#l59.7"></a><span id="l59.7"> </span>
<a href="#l59.8"></a><span id="l59.8"> function test() {</span>
<a href="#l59.9"></a><span id="l59.9">   /** Test for Bug 456342 **/</span>
<a href="#l59.10"></a><span id="l59.10" class="difflineminus">-  </span>
<a href="#l59.11"></a><span id="l59.11" class="difflineplus">+</span>
<a href="#l59.12"></a><span id="l59.12">   waitForExplicitFinish();</span>
<a href="#l59.13"></a><span id="l59.13" class="difflineminus">-  </span>
<a href="#l59.14"></a><span id="l59.14" class="difflineplus">+</span>
<a href="#l59.15"></a><span id="l59.15">   // make sure we do save form data</span>
<a href="#l59.16"></a><span id="l59.16">   Services.prefs.setIntPref(&quot;browser.sessionstore.privacy_level&quot;, 0);</span>
<a href="#l59.17"></a><span id="l59.17" class="difflineminus">-  </span>
<a href="#l59.18"></a><span id="l59.18" class="difflineplus">+</span>
<a href="#l59.19"></a><span id="l59.19">   let rootDir = getRootDirectory(gTestPath);</span>
<a href="#l59.20"></a><span id="l59.20">   let testURL = rootDir + &quot;browser_456342_sample.xhtml&quot;;</span>
<a href="#l59.21"></a><span id="l59.21">   let tab = getBrowser().addTab(testURL);</span>
<a href="#l59.22"></a><span id="l59.22">   tab.linkedBrowser.addEventListener(&quot;load&quot;, function testTabLBLoad(aEvent) {</span>
<a href="#l59.23"></a><span id="l59.23">     this.removeEventListener(&quot;load&quot;, testTabLBLoad, true);</span>
<a href="#l59.24"></a><span id="l59.24"> </span>
<a href="#l59.25"></a><span id="l59.25">     let expectedValue = &quot;try to save me&quot;;</span>
<a href="#l59.26"></a><span id="l59.26">     // Since bug 537289 we only save non-default values, so we need to set each</span>
<a href="#l59.27"></a><span id="l59.27">     // form field's value after load.</span>
<a href="#l59.28"></a><span id="l59.28">     let formEls = aEvent.originalTarget.forms[0].elements;</span>
<a href="#l59.29"></a><span id="l59.29">     for (let i = 0; i &lt; formEls.length; i++)</span>
<a href="#l59.30"></a><span id="l59.30">       formEls[i].value = expectedValue;</span>
<a href="#l59.31"></a><span id="l59.31"> </span>
<a href="#l59.32"></a><span id="l59.32">     getBrowser().removeTab(tab);</span>
<a href="#l59.33"></a><span id="l59.33" class="difflineminus">-    </span>
<a href="#l59.34"></a><span id="l59.34" class="difflineplus">+</span>
<a href="#l59.35"></a><span id="l59.35">     let undoItems = JSON.parse(ss.getClosedTabData(window));</span>
<a href="#l59.36"></a><span id="l59.36">     let savedFormData = undoItems[0].state.entries[0].formdata;</span>
<a href="#l59.37"></a><span id="l59.37" class="difflineminus">-    </span>
<a href="#l59.38"></a><span id="l59.38" class="difflineplus">+</span>
<a href="#l59.39"></a><span id="l59.39">     let countGood = 0, countBad = 0;</span>
<a href="#l59.40"></a><span id="l59.40">     for each (let value in savedFormData) {</span>
<a href="#l59.41"></a><span id="l59.41">       if (value == expectedValue)</span>
<a href="#l59.42"></a><span id="l59.42">         countGood++;</span>
<a href="#l59.43"></a><span id="l59.43">       else</span>
<a href="#l59.44"></a><span id="l59.44">         countBad++;</span>
<a href="#l59.45"></a><span id="l59.45">     }</span>
<a href="#l59.46"></a><span id="l59.46" class="difflineminus">-    </span>
<a href="#l59.47"></a><span id="l59.47" class="difflineplus">+</span>
<a href="#l59.48"></a><span id="l59.48">     is(countGood, 4, &quot;Saved text for non-standard input fields&quot;);</span>
<a href="#l59.49"></a><span id="l59.49">     is(countBad,  0, &quot;Didn't save text for ignored field types&quot;);</span>
<a href="#l59.50"></a><span id="l59.50" class="difflineminus">-    </span>
<a href="#l59.51"></a><span id="l59.51" class="difflineplus">+</span>
<a href="#l59.52"></a><span id="l59.52">     // clean up</span>
<a href="#l59.53"></a><span id="l59.53">     if (Services.prefs.prefHasUserValue(&quot;browser.sessionstore.privacy_level&quot;))</span>
<a href="#l59.54"></a><span id="l59.54">       Services.prefs.clearUserPref(&quot;browser.sessionstore.privacy_level&quot;);</span>
<a href="#l59.55"></a><span id="l59.55">     finish();</span>
<a href="#l59.56"></a><span id="l59.56">   }, true);</span>
<a href="#l59.57"></a><span id="l59.57"> }</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l60.1"></a><span id="l60.1" class="difflineminus">--- a/suite/common/tests/browser/browser_463206.js</span>
<a href="#l60.2"></a><span id="l60.2" class="difflineplus">+++ b/suite/common/tests/browser/browser_463206.js</span>
<a href="#l60.3"></a><span id="l60.3" class="difflineat">@@ -1,41 +1,41 @@</span>
<a href="#l60.4"></a><span id="l60.4"> /* This Source Code Form is subject to the terms of the Mozilla Public</span>
<a href="#l60.5"></a><span id="l60.5">  * License, v. 2.0. If a copy of the MPL was not distributed with this</span>
<a href="#l60.6"></a><span id="l60.6">  * file, You can obtain one at http://mozilla.org/MPL/2.0/. */</span>
<a href="#l60.7"></a><span id="l60.7"> </span>
<a href="#l60.8"></a><span id="l60.8"> function test() {</span>
<a href="#l60.9"></a><span id="l60.9">   /** Test for Bug 463206 **/</span>
<a href="#l60.10"></a><span id="l60.10" class="difflineminus">-  </span>
<a href="#l60.11"></a><span id="l60.11" class="difflineplus">+</span>
<a href="#l60.12"></a><span id="l60.12">   waitForExplicitFinish();</span>
<a href="#l60.13"></a><span id="l60.13" class="difflineminus">-  </span>
<a href="#l60.14"></a><span id="l60.14" class="difflineplus">+</span>
<a href="#l60.15"></a><span id="l60.15">   let testURL = &quot;http://mochi.test:8888/browser/&quot; +</span>
<a href="#l60.16"></a><span id="l60.16">     &quot;suite/common/tests/browser/browser_463206_sample.html&quot;;</span>
<a href="#l60.17"></a><span id="l60.17" class="difflineminus">-  </span>
<a href="#l60.18"></a><span id="l60.18" class="difflineplus">+</span>
<a href="#l60.19"></a><span id="l60.19">   var frameCount = 0;</span>
<a href="#l60.20"></a><span id="l60.20">   let tab = getBrowser().addTab(testURL);</span>
<a href="#l60.21"></a><span id="l60.21">   let window = tab.ownerDocument.defaultView;</span>
<a href="#l60.22"></a><span id="l60.22">   tab.linkedBrowser.addEventListener(&quot;load&quot;, function testTabLBLoad(aEvent) {</span>
<a href="#l60.23"></a><span id="l60.23">     // wait for all frames to load completely</span>
<a href="#l60.24"></a><span id="l60.24">     if (frameCount++ &lt; 5)</span>
<a href="#l60.25"></a><span id="l60.25">       return;</span>
<a href="#l60.26"></a><span id="l60.26">     tab.linkedBrowser.removeEventListener(&quot;load&quot;, testTabLBLoad, true);</span>
<a href="#l60.27"></a><span id="l60.27">     function typeText(aTextField, aValue) {</span>
<a href="#l60.28"></a><span id="l60.28">       aTextField.value = aValue;</span>
<a href="#l60.29"></a><span id="l60.29" class="difflineminus">-      </span>
<a href="#l60.30"></a><span id="l60.30" class="difflineplus">+</span>
<a href="#l60.31"></a><span id="l60.31">       let event = aTextField.ownerDocument.createEvent(&quot;UIEvents&quot;);</span>
<a href="#l60.32"></a><span id="l60.32">       event.initUIEvent(&quot;input&quot;, true, true, aTextField.ownerDocument.defaultView, 0);</span>
<a href="#l60.33"></a><span id="l60.33">       aTextField.dispatchEvent(event);</span>
<a href="#l60.34"></a><span id="l60.34">     }</span>
<a href="#l60.35"></a><span id="l60.35" class="difflineminus">-    </span>
<a href="#l60.36"></a><span id="l60.36" class="difflineplus">+</span>
<a href="#l60.37"></a><span id="l60.37">     let doc = tab.linkedBrowser.contentDocument;</span>
<a href="#l60.38"></a><span id="l60.38">     typeText(doc.getElementById(&quot;out1&quot;), Date.now());</span>
<a href="#l60.39"></a><span id="l60.39">     typeText(doc.getElementsByName(&quot;1|#out2&quot;)[0], Math.random());</span>
<a href="#l60.40"></a><span id="l60.40">     typeText(doc.defaultView.frames[0].frames[1].document.getElementById(&quot;in1&quot;), new Date());</span>
<a href="#l60.41"></a><span id="l60.41" class="difflineminus">-    </span>
<a href="#l60.42"></a><span id="l60.42" class="difflineplus">+</span>
<a href="#l60.43"></a><span id="l60.43">     frameCount = 0;</span>
<a href="#l60.44"></a><span id="l60.44">     let tab2 = ss.duplicateTab(window,tab);</span>
<a href="#l60.45"></a><span id="l60.45">     tab2.linkedBrowser.addEventListener(&quot;load&quot;, function testTab2LBLoad(aEvent) {</span>
<a href="#l60.46"></a><span id="l60.46">       // wait for all frames to load completely</span>
<a href="#l60.47"></a><span id="l60.47">       if (frameCount++ &lt; 5)</span>
<a href="#l60.48"></a><span id="l60.48">         return;</span>
<a href="#l60.49"></a><span id="l60.49">       tab2.linkedBrowser.removeEventListener(&quot;load&quot;, testTab2LBLoad, true);</span>
<a href="#l60.50"></a><span id="l60.50"> </span>
<a href="#l60.51"></a><span id="l60.51" class="difflineat">@@ -48,17 +48,17 @@ function test() {</span>
<a href="#l60.52"></a><span id="l60.52">             &quot;text containing | and # is correctly restored&quot;);</span>
<a href="#l60.53"></a><span id="l60.53">       is(win.frames[1].document.getElementById(&quot;out2&quot;).value, &quot;&quot;,</span>
<a href="#l60.54"></a><span id="l60.54">             &quot;id prefixes can't be faked&quot;);</span>
<a href="#l60.55"></a><span id="l60.55">       // Disabled for now, Bug 588077</span>
<a href="#l60.56"></a><span id="l60.56">       // isnot(win.frames[0].frames[1].document.getElementById(&quot;in1&quot;).value, &quot;&quot;,</span>
<a href="#l60.57"></a><span id="l60.57">       //       &quot;id prefixes aren't mixed up&quot;);</span>
<a href="#l60.58"></a><span id="l60.58">       is(win.frames[1].frames[0].document.getElementById(&quot;in1&quot;).value, &quot;&quot;,</span>
<a href="#l60.59"></a><span id="l60.59">             &quot;id prefixes aren't mixed up&quot;);</span>
<a href="#l60.60"></a><span id="l60.60" class="difflineminus">-      </span>
<a href="#l60.61"></a><span id="l60.61" class="difflineplus">+</span>
<a href="#l60.62"></a><span id="l60.62">       // clean up</span>
<a href="#l60.63"></a><span id="l60.63">       getBrowser().removeTab(tab2);</span>
<a href="#l60.64"></a><span id="l60.64">       getBrowser().removeTab(tab);</span>
<a href="#l60.65"></a><span id="l60.65" class="difflineminus">-      </span>
<a href="#l60.66"></a><span id="l60.66" class="difflineplus">+</span>
<a href="#l60.67"></a><span id="l60.67">       finish();</span>
<a href="#l60.68"></a><span id="l60.68">     }, true);</span>
<a href="#l60.69"></a><span id="l60.69">   }, true);</span>
<a href="#l60.70"></a><span id="l60.70"> }</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l61.1"></a><span id="l61.1" class="difflineminus">--- a/suite/common/tests/browser/browser_465215.js</span>
<a href="#l61.2"></a><span id="l61.2" class="difflineplus">+++ b/suite/common/tests/browser/browser_465215.js</span>
<a href="#l61.3"></a><span id="l61.3" class="difflineat">@@ -1,39 +1,39 @@</span>
<a href="#l61.4"></a><span id="l61.4"> /* This Source Code Form is subject to the terms of the Mozilla Public</span>
<a href="#l61.5"></a><span id="l61.5">  * License, v. 2.0. If a copy of the MPL was not distributed with this</span>
<a href="#l61.6"></a><span id="l61.6">  * file, You can obtain one at http://mozilla.org/MPL/2.0/. */</span>
<a href="#l61.7"></a><span id="l61.7"> </span>
<a href="#l61.8"></a><span id="l61.8"> function test() {</span>
<a href="#l61.9"></a><span id="l61.9">   /** Test for Bug 465215 **/</span>
<a href="#l61.10"></a><span id="l61.10" class="difflineminus">-  </span>
<a href="#l61.11"></a><span id="l61.11" class="difflineplus">+</span>
<a href="#l61.12"></a><span id="l61.12">   waitForExplicitFinish();</span>
<a href="#l61.13"></a><span id="l61.13" class="difflineminus">-  </span>
<a href="#l61.14"></a><span id="l61.14" class="difflineplus">+</span>
<a href="#l61.15"></a><span id="l61.15">   let uniqueName = &quot;bug 465215&quot;;</span>
<a href="#l61.16"></a><span id="l61.16">   let uniqueValue1 = &quot;as good as unique: &quot; + Date.now();</span>
<a href="#l61.17"></a><span id="l61.17">   let uniqueValue2 = &quot;as good as unique: &quot; + Math.random();</span>
<a href="#l61.18"></a><span id="l61.18" class="difflineminus">-  </span>
<a href="#l61.19"></a><span id="l61.19" class="difflineplus">+</span>
<a href="#l61.20"></a><span id="l61.20">   // set a unique value on a new, blank tab</span>
<a href="#l61.21"></a><span id="l61.21">   let tab1 = gBrowser.addTab();</span>
<a href="#l61.22"></a><span id="l61.22">   tab1.linkedBrowser.addEventListener(&quot;load&quot;, function testTab1LBLoad() {</span>
<a href="#l61.23"></a><span id="l61.23">     tab1.linkedBrowser.removeEventListener(&quot;load&quot;, testTab1LBLoad, true);</span>
<a href="#l61.24"></a><span id="l61.24">     ss.setTabValue(tab1, uniqueName, uniqueValue1);</span>
<a href="#l61.25"></a><span id="l61.25" class="difflineminus">-    </span>
<a href="#l61.26"></a><span id="l61.26" class="difflineplus">+</span>
<a href="#l61.27"></a><span id="l61.27">     // duplicate the tab with that value</span>
<a href="#l61.28"></a><span id="l61.28">     let tab2 = ss.duplicateTab(window, tab1);</span>
<a href="#l61.29"></a><span id="l61.29">     is(ss.getTabValue(tab2, uniqueName), uniqueValue1, &quot;tab value was duplicated&quot;);</span>
<a href="#l61.30"></a><span id="l61.30" class="difflineminus">-    </span>
<a href="#l61.31"></a><span id="l61.31" class="difflineplus">+</span>
<a href="#l61.32"></a><span id="l61.32">     ss.setTabValue(tab2, uniqueName, uniqueValue2);</span>
<a href="#l61.33"></a><span id="l61.33">     isnot(ss.getTabValue(tab1, uniqueName), uniqueValue2, &quot;tab values aren't sync'd&quot;);</span>
<a href="#l61.34"></a><span id="l61.34" class="difflineminus">-    </span>
<a href="#l61.35"></a><span id="l61.35" class="difflineplus">+</span>
<a href="#l61.36"></a><span id="l61.36">     // overwrite the tab with the value which should remove it</span>
<a href="#l61.37"></a><span id="l61.37">     ss.setTabState(tab1, JSON.stringify({ entries: [] }));</span>
<a href="#l61.38"></a><span id="l61.38">     tab1.linkedBrowser.addEventListener(&quot;load&quot;, function testTab1LBLoad2() {</span>
<a href="#l61.39"></a><span id="l61.39">       tab1.linkedBrowser.removeEventListener(&quot;load&quot;, testTab1LBLoad2, true);</span>
<a href="#l61.40"></a><span id="l61.40">       is(ss.getTabValue(tab1, uniqueName), &quot;&quot;, &quot;tab value was cleared&quot;);</span>
<a href="#l61.41"></a><span id="l61.41" class="difflineminus">-      </span>
<a href="#l61.42"></a><span id="l61.42" class="difflineplus">+</span>
<a href="#l61.43"></a><span id="l61.43">       // clean up</span>
<a href="#l61.44"></a><span id="l61.44">       gBrowser.removeTab(tab2);</span>
<a href="#l61.45"></a><span id="l61.45">       gBrowser.removeTab(tab1);</span>
<a href="#l61.46"></a><span id="l61.46">       finish();</span>
<a href="#l61.47"></a><span id="l61.47">     }, true);</span>
<a href="#l61.48"></a><span id="l61.48">   }, true);</span>
<a href="#l61.49"></a><span id="l61.49"> }</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l62.1"></a><span id="l62.1" class="difflineminus">--- a/suite/common/tests/browser/browser_466937.js</span>
<a href="#l62.2"></a><span id="l62.2" class="difflineplus">+++ b/suite/common/tests/browser/browser_466937.js</span>
<a href="#l62.3"></a><span id="l62.3" class="difflineat">@@ -1,45 +1,45 @@</span>
<a href="#l62.4"></a><span id="l62.4"> /* This Source Code Form is subject to the terms of the Mozilla Public</span>
<a href="#l62.5"></a><span id="l62.5">  * License, v. 2.0. If a copy of the MPL was not distributed with this</span>
<a href="#l62.6"></a><span id="l62.6">  * file, You can obtain one at http://mozilla.org/MPL/2.0/. */</span>
<a href="#l62.7"></a><span id="l62.7"> </span>
<a href="#l62.8"></a><span id="l62.8"> function test() {</span>
<a href="#l62.9"></a><span id="l62.9">   /** Test for Bug 466937 **/</span>
<a href="#l62.10"></a><span id="l62.10" class="difflineminus">-  </span>
<a href="#l62.11"></a><span id="l62.11" class="difflineplus">+</span>
<a href="#l62.12"></a><span id="l62.12">   waitForExplicitFinish();</span>
<a href="#l62.13"></a><span id="l62.13" class="difflineminus">-  </span>
<a href="#l62.14"></a><span id="l62.14" class="difflineplus">+</span>
<a href="#l62.15"></a><span id="l62.15">   var file = Components.classes[&quot;@mozilla.org/file/directory_service;1&quot;]</span>
<a href="#l62.16"></a><span id="l62.16">              .getService(Components.interfaces.nsIProperties)</span>
<a href="#l62.17"></a><span id="l62.17">              .get(&quot;TmpD&quot;, Components.interfaces.nsILocalFile);</span>
<a href="#l62.18"></a><span id="l62.18">   file.append(&quot;466937_test.file&quot;);</span>
<a href="#l62.19"></a><span id="l62.19">   let testPath = file.path;</span>
<a href="#l62.20"></a><span id="l62.20" class="difflineminus">-  </span>
<a href="#l62.21"></a><span id="l62.21" class="difflineplus">+</span>
<a href="#l62.22"></a><span id="l62.22">   let testURL = &quot;http://mochi.test:8888/browser/&quot; +</span>
<a href="#l62.23"></a><span id="l62.23">     &quot;suite/common/tests/browser/browser_466937_sample.html&quot;;</span>
<a href="#l62.24"></a><span id="l62.24" class="difflineminus">-  </span>
<a href="#l62.25"></a><span id="l62.25" class="difflineplus">+</span>
<a href="#l62.26"></a><span id="l62.26">   let tab = getBrowser().addTab(testURL);</span>
<a href="#l62.27"></a><span id="l62.27">   let window = tab.ownerDocument.defaultView;</span>
<a href="#l62.28"></a><span id="l62.28">   tab.linkedBrowser.addEventListener(&quot;load&quot;, function testTabLBLoad(aEvent) {</span>
<a href="#l62.29"></a><span id="l62.29">     tab.linkedBrowser.removeEventListener(&quot;load&quot;, testTabLBLoad, true);</span>
<a href="#l62.30"></a><span id="l62.30">     let doc = tab.linkedBrowser.contentDocument;</span>
<a href="#l62.31"></a><span id="l62.31">     doc.getElementById(&quot;reverse_thief&quot;).value = &quot;/home/user/secret2&quot;;</span>
<a href="#l62.32"></a><span id="l62.32">     doc.getElementById(&quot;bystander&quot;).value = testPath;</span>
<a href="#l62.33"></a><span id="l62.33" class="difflineminus">-    </span>
<a href="#l62.34"></a><span id="l62.34" class="difflineplus">+</span>
<a href="#l62.35"></a><span id="l62.35">     let tab2 = ss.duplicateTab(window,tab);</span>
<a href="#l62.36"></a><span id="l62.36">     tab2.linkedBrowser.addEventListener(&quot;load&quot;, function testTab2LBLoad(aEvent) {</span>
<a href="#l62.37"></a><span id="l62.37">       tab2.linkedBrowser.removeEventListener(&quot;load&quot;, testTab2LBLoad, true);</span>
<a href="#l62.38"></a><span id="l62.38">       doc = tab2.linkedBrowser.contentDocument;</span>
<a href="#l62.39"></a><span id="l62.39">       is(doc.getElementById(&quot;thief&quot;).value, &quot;&quot;,</span>
<a href="#l62.40"></a><span id="l62.40">          &quot;file path wasn't set to text field value&quot;);</span>
<a href="#l62.41"></a><span id="l62.41">       is(doc.getElementById(&quot;reverse_thief&quot;).value, &quot;&quot;,</span>
<a href="#l62.42"></a><span id="l62.42">          &quot;text field value wasn't set to full file path&quot;);</span>
<a href="#l62.43"></a><span id="l62.43">       is(doc.getElementById(&quot;bystander&quot;).value, testPath,</span>
<a href="#l62.44"></a><span id="l62.44">          &quot;normal case: file path was correctly preserved&quot;);</span>
<a href="#l62.45"></a><span id="l62.45" class="difflineminus">-      </span>
<a href="#l62.46"></a><span id="l62.46" class="difflineplus">+</span>
<a href="#l62.47"></a><span id="l62.47">       // clean up</span>
<a href="#l62.48"></a><span id="l62.48">       gBrowser.removeTab(tab2);</span>
<a href="#l62.49"></a><span id="l62.49">       gBrowser.removeTab(tab);</span>
<a href="#l62.50"></a><span id="l62.50" class="difflineminus">-      </span>
<a href="#l62.51"></a><span id="l62.51" class="difflineplus">+</span>
<a href="#l62.52"></a><span id="l62.52">       finish();</span>
<a href="#l62.53"></a><span id="l62.53">     }, true);</span>
<a href="#l62.54"></a><span id="l62.54">   }, true);</span>
<a href="#l62.55"></a><span id="l62.55"> }</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l63.1"></a><span id="l63.1" class="difflineminus">--- a/suite/common/tests/browser/browser_477657.js</span>
<a href="#l63.2"></a><span id="l63.2" class="difflineplus">+++ b/suite/common/tests/browser/browser_477657.js</span>
<a href="#l63.3"></a><span id="l63.3" class="difflineat">@@ -10,23 +10,23 @@ function browserWindowsCount() {</span>
<a href="#l63.4"></a><span id="l63.4">       ++count;</span>
<a href="#l63.5"></a><span id="l63.5">   }</span>
<a href="#l63.6"></a><span id="l63.6">   return count;</span>
<a href="#l63.7"></a><span id="l63.7"> }</span>
<a href="#l63.8"></a><span id="l63.8"> </span>
<a href="#l63.9"></a><span id="l63.9"> function test() {</span>
<a href="#l63.10"></a><span id="l63.10">   /** Test for Bug 477657 **/</span>
<a href="#l63.11"></a><span id="l63.11">   is(browserWindowsCount(), 1, &quot;Only one browser window should be open initially&quot;);</span>
<a href="#l63.12"></a><span id="l63.12" class="difflineminus">-  </span>
<a href="#l63.13"></a><span id="l63.13" class="difflineplus">+</span>
<a href="#l63.14"></a><span id="l63.14">   // Test fails randomly on OS X (bug 482975)</span>
<a href="#l63.15"></a><span id="l63.15">   if (&quot;nsILocalFileMac&quot; in Components.interfaces)</span>
<a href="#l63.16"></a><span id="l63.16">     return;</span>
<a href="#l63.17"></a><span id="l63.17"> </span>
<a href="#l63.18"></a><span id="l63.18">   waitForExplicitFinish();</span>
<a href="#l63.19"></a><span id="l63.19" class="difflineminus">-  </span>
<a href="#l63.20"></a><span id="l63.20" class="difflineplus">+</span>
<a href="#l63.21"></a><span id="l63.21">   let newWin = openDialog(location, &quot;_blank&quot;, &quot;chrome,all,dialog=no&quot;);</span>
<a href="#l63.22"></a><span id="l63.22">   newWin.addEventListener(&quot;load&quot;, function loadListener(aEvent) {</span>
<a href="#l63.23"></a><span id="l63.23">     newWin.removeEventListener(&quot;load&quot;, loadListener, false);</span>
<a href="#l63.24"></a><span id="l63.24"> </span>
<a href="#l63.25"></a><span id="l63.25">     let newState = { windows: [{</span>
<a href="#l63.26"></a><span id="l63.26">       tabs: [{ entries: [] }],</span>
<a href="#l63.27"></a><span id="l63.27">       _closedTabs: [{</span>
<a href="#l63.28"></a><span id="l63.28">         state: { entries: [{ url: &quot;about:&quot; }]},</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l64.1"></a><span id="l64.1" class="difflineminus">--- a/suite/common/tests/browser/browser_480893.js</span>
<a href="#l64.2"></a><span id="l64.2" class="difflineplus">+++ b/suite/common/tests/browser/browser_480893.js</span>
<a href="#l64.3"></a><span id="l64.3" class="difflineat">@@ -40,17 +40,17 @@ function test() {</span>
<a href="#l64.4"></a><span id="l64.4">         browser.addEventListener(&quot;load&quot;, function testBrowserLoad4(aEvent) {</span>
<a href="#l64.5"></a><span id="l64.5">           browser.removeEventListener(&quot;load&quot;, testBrowserLoad4, true);</span>
<a href="#l64.6"></a><span id="l64.6">           let doc = browser.contentDocument;</span>
<a href="#l64.7"></a><span id="l64.7"> </span>
<a href="#l64.8"></a><span id="l64.8">           is(doc.URL, homepage, &quot;loaded page is the homepage&quot;);</span>
<a href="#l64.9"></a><span id="l64.9"> </span>
<a href="#l64.10"></a><span id="l64.10">           // close tab, restore default values and finish the test</span>
<a href="#l64.11"></a><span id="l64.11">           getBrowser().removeTab(tab);</span>
<a href="#l64.12"></a><span id="l64.12" class="difflineminus">-          // we need this if-statement because if there is no user set value, </span>
<a href="#l64.13"></a><span id="l64.13" class="difflineplus">+          // we need this if-statement because if there is no user set value,</span>
<a href="#l64.14"></a><span id="l64.14">           // clearUserPref throws a uncatched exception and finish is not called</span>
<a href="#l64.15"></a><span id="l64.15">           if (Services.prefs.prefHasUserValue(&quot;browser.startup.page&quot;))</span>
<a href="#l64.16"></a><span id="l64.16">             Services.prefs.clearUserPref(&quot;browser.startup.page&quot;);</span>
<a href="#l64.17"></a><span id="l64.17">           Services.prefs.clearUserPref(&quot;browser.startup.homepage&quot;);</span>
<a href="#l64.18"></a><span id="l64.18">           finish();</span>
<a href="#l64.19"></a><span id="l64.19">         }, true);</span>
<a href="#l64.20"></a><span id="l64.20">       }, true);</span>
<a href="#l64.21"></a><span id="l64.21">     }, true);</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l65.1"></a><span id="l65.1" class="difflineminus">--- a/suite/common/tests/browser/browser_485482.js</span>
<a href="#l65.2"></a><span id="l65.2" class="difflineplus">+++ b/suite/common/tests/browser/browser_485482.js</span>
<a href="#l65.3"></a><span id="l65.3" class="difflineat">@@ -1,36 +1,36 @@</span>
<a href="#l65.4"></a><span id="l65.4"> /* This Source Code Form is subject to the terms of the Mozilla Public</span>
<a href="#l65.5"></a><span id="l65.5">  * License, v. 2.0. If a copy of the MPL was not distributed with this</span>
<a href="#l65.6"></a><span id="l65.6">  * file, You can obtain one at http://mozilla.org/MPL/2.0/. */</span>
<a href="#l65.7"></a><span id="l65.7"> </span>
<a href="#l65.8"></a><span id="l65.8"> function test() {</span>
<a href="#l65.9"></a><span id="l65.9">   /** Test for Bug 485482, ported by Bug 487922 **/</span>
<a href="#l65.10"></a><span id="l65.10" class="difflineminus">-  </span>
<a href="#l65.11"></a><span id="l65.11" class="difflineplus">+</span>
<a href="#l65.12"></a><span id="l65.12">   waitForExplicitFinish();</span>
<a href="#l65.13"></a><span id="l65.13" class="difflineminus">-  </span>
<a href="#l65.14"></a><span id="l65.14" class="difflineplus">+</span>
<a href="#l65.15"></a><span id="l65.15">   let uniqueValue = Math.random();</span>
<a href="#l65.16"></a><span id="l65.16"> </span>
<a href="#l65.17"></a><span id="l65.17">   let rootDir = getRootDirectory(gTestPath);</span>
<a href="#l65.18"></a><span id="l65.18">   let testURL = rootDir + &quot;browser_485482_sample.html&quot;;</span>
<a href="#l65.19"></a><span id="l65.19">   let tab = getBrowser().addTab(testURL);</span>
<a href="#l65.20"></a><span id="l65.20">   tab.linkedBrowser.addEventListener(&quot;load&quot;, function testTabLBLoad(aEvent) {</span>
<a href="#l65.21"></a><span id="l65.21">     tab.linkedBrowser.removeEventListener(&quot;load&quot;, testTabLBLoad, true);</span>
<a href="#l65.22"></a><span id="l65.22">     let doc = tab.linkedBrowser.contentDocument;</span>
<a href="#l65.23"></a><span id="l65.23">     doc.querySelector(&quot;input[type=text]&quot;).value = uniqueValue;</span>
<a href="#l65.24"></a><span id="l65.24">     doc.querySelector(&quot;input[type=checkbox]&quot;).checked = true;</span>
<a href="#l65.25"></a><span id="l65.25" class="difflineminus">-    </span>
<a href="#l65.26"></a><span id="l65.26" class="difflineplus">+</span>
<a href="#l65.27"></a><span id="l65.27">     let tab2 = ss.duplicateTab(window, tab);</span>
<a href="#l65.28"></a><span id="l65.28">     tab2.linkedBrowser.addEventListener(&quot;load&quot;, function testTab2LBLoad(aEvent) {</span>
<a href="#l65.29"></a><span id="l65.29">       tab2.linkedBrowser.removeEventListener(&quot;load&quot;, testTab2LBLoad, true);</span>
<a href="#l65.30"></a><span id="l65.30">       doc = tab2.linkedBrowser.contentDocument;</span>
<a href="#l65.31"></a><span id="l65.31">       is(doc.querySelector(&quot;input[type=text]&quot;).value, uniqueValue,</span>
<a href="#l65.32"></a><span id="l65.32">          &quot;generated XPath expression was valid&quot;);</span>
<a href="#l65.33"></a><span id="l65.33">       ok(doc.querySelector(&quot;input[type=checkbox]&quot;).checked,</span>
<a href="#l65.34"></a><span id="l65.34">          &quot;generated XPath expression was valid&quot;);</span>
<a href="#l65.35"></a><span id="l65.35" class="difflineminus">-      </span>
<a href="#l65.36"></a><span id="l65.36" class="difflineplus">+</span>
<a href="#l65.37"></a><span id="l65.37">       // clean up</span>
<a href="#l65.38"></a><span id="l65.38">       getBrowser().removeTab(tab2);</span>
<a href="#l65.39"></a><span id="l65.39">       getBrowser().removeTab(tab);</span>
<a href="#l65.40"></a><span id="l65.40">       finish();</span>
<a href="#l65.41"></a><span id="l65.41">     }, true);</span>
<a href="#l65.42"></a><span id="l65.42">   }, true);</span>
<a href="#l65.43"></a><span id="l65.43"> }</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l66.1"></a><span id="l66.1" class="difflineminus">--- a/suite/common/tests/browser/browser_493467.js</span>
<a href="#l66.2"></a><span id="l66.2" class="difflineplus">+++ b/suite/common/tests/browser/browser_493467.js</span>
<a href="#l66.3"></a><span id="l66.3" class="difflineat">@@ -28,21 +28,21 @@ function test() {</span>
<a href="#l66.4"></a><span id="l66.4">   let permissions = [];</span>
<a href="#l66.5"></a><span id="l66.5">   let docShell = tab.linkedBrowser.docShell;</span>
<a href="#l66.6"></a><span id="l66.6">   for (let attribute in docShell) {</span>
<a href="#l66.7"></a><span id="l66.7">     if (/^allow([A-Z].*)/.test(attribute)) {</span>
<a href="#l66.8"></a><span id="l66.8">       permissions.push(RegExp.$1);</span>
<a href="#l66.9"></a><span id="l66.9">       docShell[attribute] = false;</span>
<a href="#l66.10"></a><span id="l66.10">     }</span>
<a href="#l66.11"></a><span id="l66.11">   }</span>
<a href="#l66.12"></a><span id="l66.12" class="difflineminus">-  </span>
<a href="#l66.13"></a><span id="l66.13" class="difflineplus">+</span>
<a href="#l66.14"></a><span id="l66.14">   // make sure that all available permissions have been remembered</span>
<a href="#l66.15"></a><span id="l66.15">   tabState = JSON.parse(ss.getTabState(tab));</span>
<a href="#l66.16"></a><span id="l66.16">   let disallow = tabState.disallow.split(&quot;,&quot;);</span>
<a href="#l66.17"></a><span id="l66.17">   permissions.forEach(function(aName) {</span>
<a href="#l66.18"></a><span id="l66.18">     ok(disallow.indexOf(aName) &gt; -1, &quot;Saved state of allow&quot; + aName);</span>
<a href="#l66.19"></a><span id="l66.19">   });</span>
<a href="#l66.20"></a><span id="l66.20">   // IF A TEST FAILS, please add the missing permission's name (without the</span>
<a href="#l66.21"></a><span id="l66.21">   // leading &quot;allow&quot;) to nsSessionStore.js's CAPABILITIES array. Thanks.</span>
<a href="#l66.22"></a><span id="l66.22" class="difflineminus">-  </span>
<a href="#l66.23"></a><span id="l66.23" class="difflineplus">+</span>
<a href="#l66.24"></a><span id="l66.24">   getBrowser().removeTab(tab);</span>
<a href="#l66.25"></a><span id="l66.25">   is(browserWindowsCount(), 1, &quot;Only one browser window should be open eventually&quot;);</span>
<a href="#l66.26"></a><span id="l66.26"> }</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l67.1"></a><span id="l67.1" class="difflineminus">--- a/suite/common/tests/browser/browser_522545.js</span>
<a href="#l67.2"></a><span id="l67.2" class="difflineplus">+++ b/suite/common/tests/browser/browser_522545.js</span>
<a href="#l67.3"></a><span id="l67.3" class="difflineat">@@ -209,17 +209,17 @@ function test() {</span>
<a href="#l67.4"></a><span id="l67.4">       event.initEvent(&quot;input&quot;, true, false);</span>
<a href="#l67.5"></a><span id="l67.5">       gURLBar.dispatchEvent(event);</span>
<a href="#l67.6"></a><span id="l67.6"> </span>
<a href="#l67.7"></a><span id="l67.7">       executeSoon(function() {</span>
<a href="#l67.8"></a><span id="l67.8">         is(browser.userTypedValue, &quot;example.org&quot;,</span>
<a href="#l67.9"></a><span id="l67.9">            &quot;userTypedValue was set when changing gURLBar.value&quot;);</span>
<a href="#l67.10"></a><span id="l67.10">         is(browser.userTypedClear, 0,</span>
<a href="#l67.11"></a><span id="l67.11">            &quot;userTypedClear was not changed when changing gURLBar.value&quot;);</span>
<a href="#l67.12"></a><span id="l67.12" class="difflineminus">-  </span>
<a href="#l67.13"></a><span id="l67.13" class="difflineplus">+</span>
<a href="#l67.14"></a><span id="l67.14">         // Now make sure ss gets these values too</span>
<a href="#l67.15"></a><span id="l67.15">         let newState = JSON.parse(ss.getBrowserState());</span>
<a href="#l67.16"></a><span id="l67.16">         is(newState.windows[0].tabs[0].userTypedValue, &quot;example.org&quot;,</span>
<a href="#l67.17"></a><span id="l67.17">            &quot;sessionstore got correct userTypedValue&quot;);</span>
<a href="#l67.18"></a><span id="l67.18">         is(newState.windows[0].tabs[0].userTypedClear, 0,</span>
<a href="#l67.19"></a><span id="l67.19">            &quot;sessionstore got correct userTypedClear&quot;);</span>
<a href="#l67.20"></a><span id="l67.20">         runNextTest();</span>
<a href="#l67.21"></a><span id="l67.21">        });</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l68.1"></a><span id="l68.1" class="difflineminus">--- a/suite/common/tests/browser/browser_586068-cascaded_restore.js</span>
<a href="#l68.2"></a><span id="l68.2" class="difflineplus">+++ b/suite/common/tests/browser/browser_586068-cascaded_restore.js</span>
<a href="#l68.3"></a><span id="l68.3" class="difflineat">@@ -301,17 +301,17 @@ function test_setWindowStateNoOverwrite(</span>
<a href="#l68.4"></a><span id="l68.4"> </span>
<a href="#l68.5"></a><span id="l68.5">   let numTabs = state1.windows[0].tabs.length + state2.windows[0].tabs.length;</span>
<a href="#l68.6"></a><span id="l68.6"> </span>
<a href="#l68.7"></a><span id="l68.7">   let loadCount = 0;</span>
<a href="#l68.8"></a><span id="l68.8">   function test_setWindowStateNoOverwrite_progressCallback(aBrowser) {</span>
<a href="#l68.9"></a><span id="l68.9">     loadCount++;</span>
<a href="#l68.10"></a><span id="l68.10"> </span>
<a href="#l68.11"></a><span id="l68.11">     // When loadCount == 2, we'll also restore state2 into the window</span>
<a href="#l68.12"></a><span id="l68.12" class="difflineminus">-    if (loadCount == 2) </span>
<a href="#l68.13"></a><span id="l68.13" class="difflineplus">+    if (loadCount == 2)</span>
<a href="#l68.14"></a><span id="l68.14">       ss.setWindowState(window, JSON.stringify(state2), false);</span>
<a href="#l68.15"></a><span id="l68.15"> </span>
<a href="#l68.16"></a><span id="l68.16">     if (loadCount &lt; numTabs)</span>
<a href="#l68.17"></a><span id="l68.17">       return;</span>
<a href="#l68.18"></a><span id="l68.18"> </span>
<a href="#l68.19"></a><span id="l68.19">     // We don't actually care about load order in this test, just that they all</span>
<a href="#l68.20"></a><span id="l68.20">     // do load.</span>
<a href="#l68.21"></a><span id="l68.21">     is(loadCount, numTabs, &quot;test_setWindowStateNoOverwrite: all tabs were restored&quot;);</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l69.1"></a><span id="l69.1" class="difflineminus">--- a/suite/common/tests/browser/browser_isempty.js</span>
<a href="#l69.2"></a><span id="l69.2" class="difflineplus">+++ b/suite/common/tests/browser/browser_isempty.js</span>
<a href="#l69.3"></a><span id="l69.3" class="difflineat">@@ -1,28 +1,28 @@</span>
<a href="#l69.4"></a><span id="l69.4" class="difflineminus">-/* Any copyright is dedicated to the Public Domain.</span>
<a href="#l69.5"></a><span id="l69.5" class="difflineminus">- * http://creativecommons.org/publicdomain/zero/1.0/</span>
<a href="#l69.6"></a><span id="l69.6" class="difflineminus">- */</span>
<a href="#l69.7"></a><span id="l69.7" class="difflineminus">-</span>
<a href="#l69.8"></a><span id="l69.8" class="difflineminus">-// Bug 589659 - Lots of mozapps/extensions/test/ failures</span>
<a href="#l69.9"></a><span id="l69.9" class="difflineminus">-// This introduced isTabEmpty() and isBrowserEmpty() functions, the latter</span>
<a href="#l69.10"></a><span id="l69.10" class="difflineminus">-// being used in openUILinkIn() which in turn is used by switchToTabHavingURI()</span>
<a href="#l69.11"></a><span id="l69.11" class="difflineminus">-</span>
<a href="#l69.12"></a><span id="l69.12" class="difflineminus">-var gWindowObject;</span>
<a href="#l69.13"></a><span id="l69.13" class="difflineminus">-var gTabCount;</span>
<a href="#l69.14"></a><span id="l69.14" class="difflineminus">-</span>
<a href="#l69.15"></a><span id="l69.15" class="difflineminus">-function test() {</span>
<a href="#l69.16"></a><span id="l69.16" class="difflineminus">-  waitForExplicitFinish();</span>
<a href="#l69.17"></a><span id="l69.17" class="difflineminus">-  gTabCount = gBrowser.tabs.length;</span>
<a href="#l69.18"></a><span id="l69.18" class="difflineminus">-</span>
<a href="#l69.19"></a><span id="l69.19" class="difflineminus">-  gBrowser.selectedTab = gBrowser.addTab();</span>
<a href="#l69.20"></a><span id="l69.20" class="difflineminus">-  is(isTabEmpty(gBrowser.selectedTab), true, &quot;Added tab is empty&quot;);</span>
<a href="#l69.21"></a><span id="l69.21" class="difflineminus">-  switchToTabHavingURI(&quot;about:&quot;, true, function(aBrowser) {</span>
<a href="#l69.22"></a><span id="l69.22" class="difflineminus">-    gWindowObject = aBrowser.contentWindow.wrappedJSObject;</span>
<a href="#l69.23"></a><span id="l69.23" class="difflineminus">-    end_test();</span>
<a href="#l69.24"></a><span id="l69.24" class="difflineminus">-  });</span>
<a href="#l69.25"></a><span id="l69.25" class="difflineminus">-}</span>
<a href="#l69.26"></a><span id="l69.26" class="difflineminus">-</span>
<a href="#l69.27"></a><span id="l69.27" class="difflineminus">-function end_test() {</span>
<a href="#l69.28"></a><span id="l69.28" class="difflineminus">-  gWindowObject.close();</span>
<a href="#l69.29"></a><span id="l69.29" class="difflineminus">-  is(gBrowser.tabs.length, gTabCount, &quot;We're still at the same number of tabs&quot;);</span>
<a href="#l69.30"></a><span id="l69.30" class="difflineminus">-  finish();</span>
<a href="#l69.31"></a><span id="l69.31" class="difflineminus">-}</span>
<a href="#l69.32"></a><span id="l69.32" class="difflineplus">+/* Any copyright is dedicated to the Public Domain.</span>
<a href="#l69.33"></a><span id="l69.33" class="difflineplus">+ * http://creativecommons.org/publicdomain/zero/1.0/</span>
<a href="#l69.34"></a><span id="l69.34" class="difflineplus">+ */</span>
<a href="#l69.35"></a><span id="l69.35" class="difflineplus">+</span>
<a href="#l69.36"></a><span id="l69.36" class="difflineplus">+// Bug 589659 - Lots of mozapps/extensions/test/ failures</span>
<a href="#l69.37"></a><span id="l69.37" class="difflineplus">+// This introduced isTabEmpty() and isBrowserEmpty() functions, the latter</span>
<a href="#l69.38"></a><span id="l69.38" class="difflineplus">+// being used in openUILinkIn() which in turn is used by switchToTabHavingURI()</span>
<a href="#l69.39"></a><span id="l69.39" class="difflineplus">+</span>
<a href="#l69.40"></a><span id="l69.40" class="difflineplus">+var gWindowObject;</span>
<a href="#l69.41"></a><span id="l69.41" class="difflineplus">+var gTabCount;</span>
<a href="#l69.42"></a><span id="l69.42" class="difflineplus">+</span>
<a href="#l69.43"></a><span id="l69.43" class="difflineplus">+function test() {</span>
<a href="#l69.44"></a><span id="l69.44" class="difflineplus">+  waitForExplicitFinish();</span>
<a href="#l69.45"></a><span id="l69.45" class="difflineplus">+  gTabCount = gBrowser.tabs.length;</span>
<a href="#l69.46"></a><span id="l69.46" class="difflineplus">+</span>
<a href="#l69.47"></a><span id="l69.47" class="difflineplus">+  gBrowser.selectedTab = gBrowser.addTab();</span>
<a href="#l69.48"></a><span id="l69.48" class="difflineplus">+  is(isTabEmpty(gBrowser.selectedTab), true, &quot;Added tab is empty&quot;);</span>
<a href="#l69.49"></a><span id="l69.49" class="difflineplus">+  switchToTabHavingURI(&quot;about:&quot;, true, function(aBrowser) {</span>
<a href="#l69.50"></a><span id="l69.50" class="difflineplus">+    gWindowObject = aBrowser.contentWindow.wrappedJSObject;</span>
<a href="#l69.51"></a><span id="l69.51" class="difflineplus">+    end_test();</span>
<a href="#l69.52"></a><span id="l69.52" class="difflineplus">+  });</span>
<a href="#l69.53"></a><span id="l69.53" class="difflineplus">+}</span>
<a href="#l69.54"></a><span id="l69.54" class="difflineplus">+</span>
<a href="#l69.55"></a><span id="l69.55" class="difflineplus">+function end_test() {</span>
<a href="#l69.56"></a><span id="l69.56" class="difflineplus">+  gWindowObject.close();</span>
<a href="#l69.57"></a><span id="l69.57" class="difflineplus">+  is(gBrowser.tabs.length, gTabCount, &quot;We're still at the same number of tabs&quot;);</span>
<a href="#l69.58"></a><span id="l69.58" class="difflineplus">+  finish();</span>
<a href="#l69.59"></a><span id="l69.59" class="difflineplus">+}</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l70.1"></a><span id="l70.1" class="difflineminus">--- a/suite/mailnews/addrbook/abCardOverlay.js</span>
<a href="#l70.2"></a><span id="l70.2" class="difflineplus">+++ b/suite/mailnews/addrbook/abCardOverlay.js</span>
<a href="#l70.3"></a><span id="l70.3" class="difflineat">@@ -128,17 +128,17 @@ function OnLoadNewCard()</span>
<a href="#l70.4"></a><span id="l70.4"> </span>
<a href="#l70.5"></a><span id="l70.5">   // set popup with address book names</span>
<a href="#l70.6"></a><span id="l70.6">   var abPopup = document.getElementById('abPopup');</span>
<a href="#l70.7"></a><span id="l70.7">   abPopup.value = gEditCard.selectedAB || kPersonalAddressbookURI;</span>
<a href="#l70.8"></a><span id="l70.8"> </span>
<a href="#l70.9"></a><span id="l70.9">   if (gHideABPicker &amp;&amp; abPopup) {</span>
<a href="#l70.10"></a><span id="l70.10">     abPopup.hidden = true;</span>
<a href="#l70.11"></a><span id="l70.11">     document.getElementById(&quot;abPopupLabel&quot;).hidden = true;</span>
<a href="#l70.12"></a><span id="l70.12" class="difflineminus">-  } </span>
<a href="#l70.13"></a><span id="l70.13" class="difflineplus">+  }</span>
<a href="#l70.14"></a><span id="l70.14"> </span>
<a href="#l70.15"></a><span id="l70.15">   SetCardDialogTitle(gEditCard.card.displayName);</span>
<a href="#l70.16"></a><span id="l70.16"> </span>
<a href="#l70.17"></a><span id="l70.17">   GetCardValues(gEditCard.card, document);</span>
<a href="#l70.18"></a><span id="l70.18"> </span>
<a href="#l70.19"></a><span id="l70.19">   // FIX ME - looks like we need to focus on both the text field and the tab widget</span>
<a href="#l70.20"></a><span id="l70.20">   // probably need to do the same in the addressing widget</span>
<a href="#l70.21"></a><span id="l70.21"> </span>
<a href="#l70.22"></a><span id="l70.22" class="difflineat">@@ -183,21 +183,21 @@ function EditCardOKButton()</span>
<a href="#l70.23"></a><span id="l70.23">       for (let index = 0; index &lt; listCardsCount; index++)</span>
<a href="#l70.24"></a><span id="l70.24">       {</span>
<a href="#l70.25"></a><span id="l70.25">         let card = subdirectory.addressLists.queryElementAt(index, Components.interfaces.nsIAbCard);</span>
<a href="#l70.26"></a><span id="l70.26">         if (card.equals(gEditCard.card))</span>
<a href="#l70.27"></a><span id="l70.27">           foundDirectories.push({directory:subdirectory, cardIndex:index});</span>
<a href="#l70.28"></a><span id="l70.28">       }</span>
<a href="#l70.29"></a><span id="l70.29">     }</span>
<a href="#l70.30"></a><span id="l70.30">   }</span>
<a href="#l70.31"></a><span id="l70.31" class="difflineminus">- </span>
<a href="#l70.32"></a><span id="l70.32" class="difflineplus">+</span>
<a href="#l70.33"></a><span id="l70.33">   CheckAndSetCardValues(gEditCard.card, document, false);</span>
<a href="#l70.34"></a><span id="l70.34"> </span>
<a href="#l70.35"></a><span id="l70.35">   directory.modifyCard(gEditCard.card);</span>
<a href="#l70.36"></a><span id="l70.36" class="difflineminus">- </span>
<a href="#l70.37"></a><span id="l70.37" class="difflineplus">+</span>
<a href="#l70.38"></a><span id="l70.38">   while (foundDirectories.length)</span>
<a href="#l70.39"></a><span id="l70.39">   {</span>
<a href="#l70.40"></a><span id="l70.40">     // Update the addressLists item for this card</span>
<a href="#l70.41"></a><span id="l70.41">     let foundItem = foundDirectories.pop();</span>
<a href="#l70.42"></a><span id="l70.42">     foundItem.directory.addressLists.replaceElementAt(gEditCard.card, foundItem.cardIndex, false);</span>
<a href="#l70.43"></a><span id="l70.43">   }</span>
<a href="#l70.44"></a><span id="l70.44"> </span>
<a href="#l70.45"></a><span id="l70.45">   NotifySaveListeners(directory);</span>
<a href="#l70.46"></a><span id="l70.46" class="difflineat">@@ -242,17 +242,17 @@ function OnLoadEditCard()</span>
<a href="#l70.47"></a><span id="l70.47">   // check if selectedAB is a writeable</span>
<a href="#l70.48"></a><span id="l70.48">   // if not disable all the fields</span>
<a href="#l70.49"></a><span id="l70.49">   if (&quot;arguments&quot; in window &amp;&amp; window.arguments[0])</span>
<a href="#l70.50"></a><span id="l70.50">   {</span>
<a href="#l70.51"></a><span id="l70.51">     if (&quot;abURI&quot; in window.arguments[0]) {</span>
<a href="#l70.52"></a><span id="l70.52">       var abURI = window.arguments[0].abURI;</span>
<a href="#l70.53"></a><span id="l70.53">       var directory = GetDirectoryFromURI(abURI);</span>
<a href="#l70.54"></a><span id="l70.54"> </span>
<a href="#l70.55"></a><span id="l70.55" class="difflineminus">-      if (directory.readOnly) </span>
<a href="#l70.56"></a><span id="l70.56" class="difflineplus">+      if (directory.readOnly)</span>
<a href="#l70.57"></a><span id="l70.57">       {</span>
<a href="#l70.58"></a><span id="l70.58">         // Set all the editable vcard fields to read only</span>
<a href="#l70.59"></a><span id="l70.59">         for (var i = kVcardFields.length; i-- &gt; 0; )</span>
<a href="#l70.60"></a><span id="l70.60">           document.getElementById(kVcardFields[i][0]).readOnly = true;</span>
<a href="#l70.61"></a><span id="l70.61"> </span>
<a href="#l70.62"></a><span id="l70.62">         // the birthday fields</span>
<a href="#l70.63"></a><span id="l70.63">         document.getElementById(&quot;Birthday&quot;).readOnly = true;</span>
<a href="#l70.64"></a><span id="l70.64">         document.getElementById(&quot;BirthYear&quot;).readOnly = true;</span>
<a href="#l70.65"></a><span id="l70.65" class="difflineat">@@ -339,17 +339,17 @@ function NotifySaveListeners(directory)</span>
<a href="#l70.66"></a><span id="l70.66">   // the save listeners might have tweaked the card</span>
<a href="#l70.67"></a><span id="l70.67">   // in which case we need to commit it.</span>
<a href="#l70.68"></a><span id="l70.68">   directory.modifyCard(gEditCard.card);</span>
<a href="#l70.69"></a><span id="l70.69"> }</span>
<a href="#l70.70"></a><span id="l70.70"> </span>
<a href="#l70.71"></a><span id="l70.71"> function InitPhoneticFields()</span>
<a href="#l70.72"></a><span id="l70.72"> {</span>
<a href="#l70.73"></a><span id="l70.73">   var showPhoneticFields =</span>
<a href="#l70.74"></a><span id="l70.74" class="difflineminus">-    Services.prefs.getComplexValue(&quot;mail.addr_book.show_phonetic_fields&quot;, </span>
<a href="#l70.75"></a><span id="l70.75" class="difflineplus">+    Services.prefs.getComplexValue(&quot;mail.addr_book.show_phonetic_fields&quot;,</span>
<a href="#l70.76"></a><span id="l70.76">       Components.interfaces.nsIPrefLocalizedString).data;</span>
<a href="#l70.77"></a><span id="l70.77"> </span>
<a href="#l70.78"></a><span id="l70.78">   // show phonetic fields if indicated by the pref</span>
<a href="#l70.79"></a><span id="l70.79">   if (showPhoneticFields == &quot;true&quot;)</span>
<a href="#l70.80"></a><span id="l70.80">   {</span>
<a href="#l70.81"></a><span id="l70.81">     for (var i = kPhoneticFields.length; i-- &gt; 0; )</span>
<a href="#l70.82"></a><span id="l70.82">       document.getElementById(kPhoneticFields[i]).hidden = false;</span>
<a href="#l70.83"></a><span id="l70.83">   }</span>
<a href="#l70.84"></a><span id="l70.84" class="difflineat">@@ -362,17 +362,17 @@ function InitEditCard()</span>
<a href="#l70.85"></a><span id="l70.85">   InitCommonJS();</span>
<a href="#l70.86"></a><span id="l70.86">   // Create gEditCard object that contains global variables for the current js</span>
<a href="#l70.87"></a><span id="l70.87">   //   file.</span>
<a href="#l70.88"></a><span id="l70.88">   gEditCard = new Object();</span>
<a href="#l70.89"></a><span id="l70.89"> </span>
<a href="#l70.90"></a><span id="l70.90">   // get specific prefs that gEditCard will need</span>
<a href="#l70.91"></a><span id="l70.91">   try {</span>
<a href="#l70.92"></a><span id="l70.92">     var displayLastNameFirst =</span>
<a href="#l70.93"></a><span id="l70.93" class="difflineminus">-      Services.prefs.getComplexValue(&quot;mail.addr_book.displayName.lastnamefirst&quot;, </span>
<a href="#l70.94"></a><span id="l70.94" class="difflineplus">+      Services.prefs.getComplexValue(&quot;mail.addr_book.displayName.lastnamefirst&quot;,</span>
<a href="#l70.95"></a><span id="l70.95">         Components.interfaces.nsIPrefLocalizedString).data;</span>
<a href="#l70.96"></a><span id="l70.96">     gEditCard.displayLastNameFirst = (displayLastNameFirst == &quot;true&quot;);</span>
<a href="#l70.97"></a><span id="l70.97">     gEditCard.generateDisplayName =</span>
<a href="#l70.98"></a><span id="l70.98">       Services.prefs.getBoolPref(&quot;mail.addr_book.displayName.autoGeneration&quot;);</span>
<a href="#l70.99"></a><span id="l70.99">   }</span>
<a href="#l70.100"></a><span id="l70.100">   catch (ex) {</span>
<a href="#l70.101"></a><span id="l70.101">     dump(&quot;ex: failed to get pref&quot; + ex + &quot;\n&quot;);</span>
<a href="#l70.102"></a><span id="l70.102">   }</span>
<a href="#l70.103"></a><span id="l70.103" class="difflineat">@@ -749,17 +749,17 @@ function calculateYear(aEvent, aElement)</span>
<a href="#l70.104"></a><span id="l70.104">  *  - Hides the year</span>
<a href="#l70.105"></a><span id="l70.105">  *  - Allows the day and month to be blank</span>
<a href="#l70.106"></a><span id="l70.106">  * NOTE:</span>
<a href="#l70.107"></a><span id="l70.107">  * The datepicker's date, month, year, and dateValue properties are not always</span>
<a href="#l70.108"></a><span id="l70.108">  * what appear physically to the user in the datepicker fields.</span>
<a href="#l70.109"></a><span id="l70.109">  * If any field is blank, the corresponding property is either the previous</span>
<a href="#l70.110"></a><span id="l70.110">  * value if there was one since the card was opened or the relevant portion of</span>
<a href="#l70.111"></a><span id="l70.111">  * the current date.</span>
<a href="#l70.112"></a><span id="l70.112" class="difflineminus">- * </span>
<a href="#l70.113"></a><span id="l70.113" class="difflineplus">+ *</span>
<a href="#l70.114"></a><span id="l70.114">  * To get the displayed values, get the value of the individual field, such as</span>
<a href="#l70.115"></a><span id="l70.115">  * datepicker.yyyyField.value where yyyy is &quot;year&quot;, &quot;month&quot;, or &quot;date&quot; for the</span>
<a href="#l70.116"></a><span id="l70.116">  * year, month, and day, respectively.</span>
<a href="#l70.117"></a><span id="l70.117">  * If the value is null, then the field is blank and vice versa.</span>
<a href="#l70.118"></a><span id="l70.118">  * @param aDatepicker The datepicker to modify.</span>
<a href="#l70.119"></a><span id="l70.119">  */</span>
<a href="#l70.120"></a><span id="l70.120"> function modifyDatepicker(aDatepicker) {</span>
<a href="#l70.121"></a><span id="l70.121">   // collapse the year field and separator</span>
<a href="#l70.122"></a><span id="l70.122" class="difflineat">@@ -937,17 +937,17 @@ function removePhoto(aName) {</span>
<a href="#l70.123"></a><span id="l70.123">  *</span>
<a href="#l70.124"></a><span id="l70.124">  * @return true if the OK button was clicked and a photo was chosen</span>
<a href="#l70.125"></a><span id="l70.125">  */</span>
<a href="#l70.126"></a><span id="l70.126"> function browsePhoto() {</span>
<a href="#l70.127"></a><span id="l70.127">   var nsIFilePicker = Components.interfaces.nsIFilePicker;</span>
<a href="#l70.128"></a><span id="l70.128">   var fp = Components.classes[&quot;@mozilla.org/filepicker;1&quot;]</span>
<a href="#l70.129"></a><span id="l70.129"> 	                   .createInstance(nsIFilePicker);</span>
<a href="#l70.130"></a><span id="l70.130">   fp.init(window, gAddressBookBundle.getString(&quot;browsePhoto&quot;), nsIFilePicker.modeOpen);</span>
<a href="#l70.131"></a><span id="l70.131" class="difflineminus">-  </span>
<a href="#l70.132"></a><span id="l70.132" class="difflineplus">+</span>
<a href="#l70.133"></a><span id="l70.133">   // Add All Files &amp; Image Files filters and select the latter</span>
<a href="#l70.134"></a><span id="l70.134">   fp.appendFilters(nsIFilePicker.filterImages);</span>
<a href="#l70.135"></a><span id="l70.135">   fp.appendFilters(nsIFilePicker.filterAll);</span>
<a href="#l70.136"></a><span id="l70.136"> </span>
<a href="#l70.137"></a><span id="l70.137">   if (fp.show() == nsIFilePicker.returnOK) {</span>
<a href="#l70.138"></a><span id="l70.138">     document.getElementById(&quot;PhotoFile&quot;).file = fp.file;</span>
<a href="#l70.139"></a><span id="l70.139">     onSwitchPhotoType(document.getElementById(&quot;FilePhotoType&quot;).value);</span>
<a href="#l70.140"></a><span id="l70.140">     return true;</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l71.1"></a><span id="l71.1" class="difflineminus">--- a/suite/mailnews/addrbook/abCardViewOverlay.js</span>
<a href="#l71.2"></a><span id="l71.2" class="difflineplus">+++ b/suite/mailnews/addrbook/abCardViewOverlay.js</span>
<a href="#l71.3"></a><span id="l71.3" class="difflineat">@@ -48,17 +48,17 @@ function OnLoadCardView()</span>
<a href="#l71.4"></a><span id="l71.4">   zPager = gAddressBookBundle.getString(&quot;propertyPager&quot;);</span>
<a href="#l71.5"></a><span id="l71.5">   zBirthday = gAddressBookBundle.getString(&quot;propertyBirthday&quot;);</span>
<a href="#l71.6"></a><span id="l71.6">   zCustom1 = gAddressBookBundle.getString(&quot;propertyCustom1&quot;);</span>
<a href="#l71.7"></a><span id="l71.7">   zCustom2 = gAddressBookBundle.getString(&quot;propertyCustom2&quot;);</span>
<a href="#l71.8"></a><span id="l71.8">   zCustom3 = gAddressBookBundle.getString(&quot;propertyCustom3&quot;);</span>
<a href="#l71.9"></a><span id="l71.9">   zCustom4 = gAddressBookBundle.getString(&quot;propertyCustom4&quot;);</span>
<a href="#l71.10"></a><span id="l71.10"> </span>
<a href="#l71.11"></a><span id="l71.11"> 	var doc = document;</span>
<a href="#l71.12"></a><span id="l71.12" class="difflineminus">-	</span>
<a href="#l71.13"></a><span id="l71.13" class="difflineplus">+</span>
<a href="#l71.14"></a><span id="l71.14"> 	/* data for address book, prefixes: &quot;cvb&quot; = card view box</span>
<a href="#l71.15"></a><span id="l71.15"> 										&quot;cvh&quot; = crad view header</span>
<a href="#l71.16"></a><span id="l71.16"> 										&quot;cv&quot;  = card view (normal fields) */</span>
<a href="#l71.17"></a><span id="l71.17"> 	cvData = new Object;</span>
<a href="#l71.18"></a><span id="l71.18"> </span>
<a href="#l71.19"></a><span id="l71.19"> 	// Card View Box</span>
<a href="#l71.20"></a><span id="l71.20"> 	cvData.CardViewBox		= doc.getElementById(&quot;CardViewInnerBox&quot;);</span>
<a href="#l71.21"></a><span id="l71.21"> 	// Title</span>
<a href="#l71.22"></a><span id="l71.22" class="difflineat">@@ -125,17 +125,17 @@ function OnLoadCardView()</span>
<a href="#l71.23"></a><span id="l71.23"> 	cvData.cvWorkCountry	= doc.getElementById(&quot;cvWorkCountry&quot;);</span>
<a href="#l71.24"></a><span id="l71.24">   cvData.cvbWorkMapItBox  = doc.getElementById(&quot;cvbWorkMapItBox&quot;);</span>
<a href="#l71.25"></a><span id="l71.25">   cvData.cvWorkMapIt = doc.getElementById(&quot;cvWorkMapIt&quot;);</span>
<a href="#l71.26"></a><span id="l71.26"> 	cvData.cvWorkWebPageBox = doc.getElementById(&quot;cvWorkWebPageBox&quot;);</span>
<a href="#l71.27"></a><span id="l71.27"> 	cvData.cvWorkWebPage	= doc.getElementById(&quot;cvWorkWebPage&quot;);</span>
<a href="#l71.28"></a><span id="l71.28">   cvData.cvbPhoto = doc.getElementById(&quot;cvbPhoto&quot;);</span>
<a href="#l71.29"></a><span id="l71.29">   cvData.cvPhoto  = doc.getElementById(&quot;cvPhoto&quot;);</span>
<a href="#l71.30"></a><span id="l71.30"> }</span>
<a href="#l71.31"></a><span id="l71.31" class="difflineminus">-	</span>
<a href="#l71.32"></a><span id="l71.32" class="difflineplus">+</span>
<a href="#l71.33"></a><span id="l71.33"> // XXX todo</span>
<a href="#l71.34"></a><span id="l71.34"> // some similar code (in spirit) already exists, see OnLoadEditList()</span>
<a href="#l71.35"></a><span id="l71.35"> // perhaps we could combine and put in abCommon.js?</span>
<a href="#l71.36"></a><span id="l71.36"> function GetAddressesFromURI(uri)</span>
<a href="#l71.37"></a><span id="l71.37"> {</span>
<a href="#l71.38"></a><span id="l71.38">   var addresses = &quot;&quot;;</span>
<a href="#l71.39"></a><span id="l71.39"> </span>
<a href="#l71.40"></a><span id="l71.40">   var editList = GetDirectoryFromURI(uri);</span>
<a href="#l71.41"></a><span id="l71.41" class="difflineat">@@ -149,17 +149,17 @@ function GetAddressesFromURI(uri)</span>
<a href="#l71.42"></a><span id="l71.42">     }</span>
<a href="#l71.43"></a><span id="l71.43">   }</span>
<a href="#l71.44"></a><span id="l71.44">   return addresses;</span>
<a href="#l71.45"></a><span id="l71.45"> }</span>
<a href="#l71.46"></a><span id="l71.46"> </span>
<a href="#l71.47"></a><span id="l71.47"> function DisplayCardViewPane(realCard)</span>
<a href="#l71.48"></a><span id="l71.48"> {</span>
<a href="#l71.49"></a><span id="l71.49">   var generatedName = realCard.generateName(Services.prefs.getIntPref(&quot;mail.addr_book.lastnamefirst&quot;));</span>
<a href="#l71.50"></a><span id="l71.50" class="difflineminus">-		</span>
<a href="#l71.51"></a><span id="l71.51" class="difflineplus">+</span>
<a href="#l71.52"></a><span id="l71.52">   var data = top.cvData;</span>
<a href="#l71.53"></a><span id="l71.53">   var visible;</span>
<a href="#l71.54"></a><span id="l71.54"> </span>
<a href="#l71.55"></a><span id="l71.55">   var card = { getProperty : function (prop) {</span>
<a href="#l71.56"></a><span id="l71.56">                  return realCard.getProperty(prop, &quot;&quot;);</span>
<a href="#l71.57"></a><span id="l71.57">                },</span>
<a href="#l71.58"></a><span id="l71.58">                primaryEmail : realCard.primaryEmail,</span>
<a href="#l71.59"></a><span id="l71.59">                displayName : realCard.displayName,</span>
<a href="#l71.60"></a><span id="l71.60" class="difflineat">@@ -176,29 +176,29 @@ function DisplayCardViewPane(realCard)</span>
<a href="#l71.61"></a><span id="l71.61">   else</span>
<a href="#l71.62"></a><span id="l71.62">     titleString = generatedName;</span>
<a href="#l71.63"></a><span id="l71.63"> </span>
<a href="#l71.64"></a><span id="l71.64">   // set fields in card view pane</span>
<a href="#l71.65"></a><span id="l71.65">   if (card.isMailList)</span>
<a href="#l71.66"></a><span id="l71.66">     cvSetNode(data.CardTitle, gAddressBookBundle.getFormattedString(&quot;viewListTitle&quot;, [generatedName]));</span>
<a href="#l71.67"></a><span id="l71.67">   else</span>
<a href="#l71.68"></a><span id="l71.68">     cvSetNode(data.CardTitle, titleString);</span>
<a href="#l71.69"></a><span id="l71.69" class="difflineminus">-	</span>
<a href="#l71.70"></a><span id="l71.70" class="difflineplus">+</span>
<a href="#l71.71"></a><span id="l71.71">   // Contact section</span>
<a href="#l71.72"></a><span id="l71.72">   cvSetNodeWithLabel(data.cvNickname, zNickname, card.getProperty(&quot;NickName&quot;));</span>
<a href="#l71.73"></a><span id="l71.73"> </span>
<a href="#l71.74"></a><span id="l71.74">   if (card.isMailList) {</span>
<a href="#l71.75"></a><span id="l71.75">     // email1, display name and screenname always hidden when a mailing list.</span>
<a href="#l71.76"></a><span id="l71.76">     cvSetVisible(data.cvDisplayName, false);</span>
<a href="#l71.77"></a><span id="l71.77">     cvSetVisible(data.cvEmail1Box, false);</span>
<a href="#l71.78"></a><span id="l71.78">     cvSetVisible(data.cvScreennameBox, false);</span>
<a href="#l71.79"></a><span id="l71.79"> </span>
<a href="#l71.80"></a><span id="l71.80">     visible = HandleLink(data.cvListName, zListName, card.displayName, data.cvListNameBox, &quot;mailto:&quot; + encodeURIComponent(GenerateAddressFromCard(card))) || visible;</span>
<a href="#l71.81"></a><span id="l71.81">   }</span>
<a href="#l71.82"></a><span id="l71.82" class="difflineminus">-  else { </span>
<a href="#l71.83"></a><span id="l71.83" class="difflineplus">+  else {</span>
<a href="#l71.84"></a><span id="l71.84">     // listname always hidden if not a mailing list</span>
<a href="#l71.85"></a><span id="l71.85">     cvSetVisible(data.cvListNameBox, false);</span>
<a href="#l71.86"></a><span id="l71.86"> </span>
<a href="#l71.87"></a><span id="l71.87">     cvSetNodeWithLabel(data.cvDisplayName, zDisplayName, card.displayName);</span>
<a href="#l71.88"></a><span id="l71.88"> </span>
<a href="#l71.89"></a><span id="l71.89">     visible = HandleLink(data.cvEmail1, zPrimaryEmail, card.primaryEmail, data.cvEmail1Box, &quot;mailto:&quot; + card.primaryEmail) || visible;</span>
<a href="#l71.90"></a><span id="l71.90">   }</span>
<a href="#l71.91"></a><span id="l71.91"> </span>
<a href="#l71.92"></a><span id="l71.92" class="difflineat">@@ -227,17 +227,17 @@ function DisplayCardViewPane(realCard)</span>
<a href="#l71.93"></a><span id="l71.93">   if (card.isMailList) {</span>
<a href="#l71.94"></a><span id="l71.94">     // Description section</span>
<a href="#l71.95"></a><span id="l71.95"> 	  visible = cvSetNode(data.cvDescription, card.getProperty(&quot;Notes&quot;))</span>
<a href="#l71.96"></a><span id="l71.96">   	cvSetVisible(data.cvbDescription, visible);</span>
<a href="#l71.97"></a><span id="l71.97"> </span>
<a href="#l71.98"></a><span id="l71.98">     // Addresses section</span>
<a href="#l71.99"></a><span id="l71.99"> 	  visible = cvAddAddressNodes(data.cvAddresses, card.mailListURI);</span>
<a href="#l71.100"></a><span id="l71.100">   	cvSetVisible(data.cvbAddresses, visible);</span>
<a href="#l71.101"></a><span id="l71.101" class="difflineminus">- </span>
<a href="#l71.102"></a><span id="l71.102" class="difflineplus">+</span>
<a href="#l71.103"></a><span id="l71.103">     // Other section, not shown for mailing lists.</span>
<a href="#l71.104"></a><span id="l71.104">     cvSetVisible(data.cvbOther, false);</span>
<a href="#l71.105"></a><span id="l71.105">   }</span>
<a href="#l71.106"></a><span id="l71.106">   else {</span>
<a href="#l71.107"></a><span id="l71.107"> 	  // Other section</span>
<a href="#l71.108"></a><span id="l71.108">     /// setup the birthday information</span>
<a href="#l71.109"></a><span id="l71.109">     var day = card.getProperty(&quot;BirthDay&quot;, null);</span>
<a href="#l71.110"></a><span id="l71.110">     var month = card.getProperty(&quot;BirthMonth&quot;, null);</span>
<a href="#l71.111"></a><span id="l71.111" class="difflineat">@@ -291,17 +291,17 @@ function DisplayCardViewPane(realCard)</span>
<a href="#l71.112"></a><span id="l71.112"> 	visible = cvSetNodeWithLabel(data.cvPhCellular, zCellular, card.getProperty(&quot;CellularNumber&quot;)) || visible;</span>
<a href="#l71.113"></a><span id="l71.113"> 	visible = cvSetNodeWithLabel(data.cvPhPager, zPager, card.getProperty(&quot;PagerNumber&quot;)) || visible;</span>
<a href="#l71.114"></a><span id="l71.114"> 	cvSetVisible(data.cvhPhone, visible);</span>
<a href="#l71.115"></a><span id="l71.115"> 	cvSetVisible(data.cvbPhone, visible);</span>
<a href="#l71.116"></a><span id="l71.116"> 	// Work section</span>
<a href="#l71.117"></a><span id="l71.117"> 	visible = cvSetNode(data.cvJobTitle, card.getProperty(&quot;JobTitle&quot;));</span>
<a href="#l71.118"></a><span id="l71.118"> 	visible = cvSetNode(data.cvDepartment, card.getProperty(&quot;Department&quot;)) || visible;</span>
<a href="#l71.119"></a><span id="l71.119"> 	visible = cvSetNode(data.cvCompany, card.getProperty(&quot;Company&quot;)) || visible;</span>
<a href="#l71.120"></a><span id="l71.120" class="difflineminus">-        </span>
<a href="#l71.121"></a><span id="l71.121" class="difflineplus">+</span>
<a href="#l71.122"></a><span id="l71.122">         var addressVisible = cvSetNode(data.cvWorkAddress, card.getProperty(&quot;WorkAddress&quot;));</span>
<a href="#l71.123"></a><span id="l71.123"> 	addressVisible = cvSetNode(data.cvWorkAddress2, card.getProperty(&quot;WorkAddress2&quot;)) || addressVisible;</span>
<a href="#l71.124"></a><span id="l71.124"> 	addressVisible = cvSetCityStateZip(data.cvWorkCityStZip, card.getProperty(&quot;WorkCity&quot;), card.getProperty(&quot;WorkState&quot;), card.getProperty(&quot;WorkZipCode&quot;)) || addressVisible;</span>
<a href="#l71.125"></a><span id="l71.125"> 	addressVisible = cvSetNode(data.cvWorkCountry, card.getProperty(&quot;WorkCountry&quot;)) || addressVisible;</span>
<a href="#l71.126"></a><span id="l71.126"> </span>
<a href="#l71.127"></a><span id="l71.127">   mapURLList = data.cvWorkMapIt.firstChild;</span>
<a href="#l71.128"></a><span id="l71.128">   if (addressVisible)</span>
<a href="#l71.129"></a><span id="l71.129">     mapURLList.initMapAddressFromCard(card, &quot;Work&quot;);</span>
<a href="#l71.130"></a><span id="l71.130" class="difflineat">@@ -327,29 +327,29 @@ function setBuddyIcon(card, buddyIcon)</span>
<a href="#l71.131"></a><span id="l71.131">         gProfileDirURL = Services.io.newFileURI(GetSpecialDirectory(&quot;ProfD&quot;));</span>
<a href="#l71.132"></a><span id="l71.132">       }</span>
<a href="#l71.133"></a><span id="l71.133"> </span>
<a href="#l71.134"></a><span id="l71.134">       // if we did have a buddy icon on disk for this screenname, this would be the file url spec for it</span>
<a href="#l71.135"></a><span id="l71.135">       var iconURLStr = gProfileDirURL.spec + &quot;/NIM/&quot; + myScreenName + &quot;/picture/&quot; + card.getProperty(&quot;_AimScreenName&quot;) + &quot;.gif&quot;;</span>
<a href="#l71.136"></a><span id="l71.136"> </span>
<a href="#l71.137"></a><span id="l71.137">       // check if the file exists</span>
<a href="#l71.138"></a><span id="l71.138">       var file = gFileHandler.getFileFromURLSpec(iconURLStr);</span>
<a href="#l71.139"></a><span id="l71.139" class="difflineminus">-            </span>
<a href="#l71.140"></a><span id="l71.140" class="difflineplus">+</span>
<a href="#l71.141"></a><span id="l71.141">       // check if the file exists</span>
<a href="#l71.142"></a><span id="l71.142">       // is this a perf hit?  (how expensive is stat()?)</span>
<a href="#l71.143"></a><span id="l71.143">       if (file.exists()) {</span>
<a href="#l71.144"></a><span id="l71.144">         buddyIcon.setAttribute(&quot;src&quot;, iconURLStr);</span>
<a href="#l71.145"></a><span id="l71.145">         return true;</span>
<a href="#l71.146"></a><span id="l71.146">       }</span>
<a href="#l71.147"></a><span id="l71.147">     }</span>
<a href="#l71.148"></a><span id="l71.148">   }</span>
<a href="#l71.149"></a><span id="l71.149">   catch (ex) {</span>
<a href="#l71.150"></a><span id="l71.150">     // can get here if no screenname</span>
<a href="#l71.151"></a><span id="l71.151">   }</span>
<a href="#l71.152"></a><span id="l71.152" class="difflineminus">-  </span>
<a href="#l71.153"></a><span id="l71.153" class="difflineplus">+</span>
<a href="#l71.154"></a><span id="l71.154">   buddyIcon.setAttribute(&quot;src&quot;, &quot;&quot;);</span>
<a href="#l71.155"></a><span id="l71.155">   return false;</span>
<a href="#l71.156"></a><span id="l71.156"> }</span>
<a href="#l71.157"></a><span id="l71.157"> </span>
<a href="#l71.158"></a><span id="l71.158"> function ClearCardViewPane()</span>
<a href="#l71.159"></a><span id="l71.159"> {</span>
<a href="#l71.160"></a><span id="l71.160"> 	cvSetVisible(top.cvData.CardViewBox, false);</span>
<a href="#l71.161"></a><span id="l71.161"> }</span>
<a href="#l71.162"></a><span id="l71.162" class="difflineat">@@ -389,66 +389,66 @@ function cvSetCityStateZip(node, city, s</span>
<a href="#l71.163"></a><span id="l71.163"> </span>
<a href="#l71.164"></a><span id="l71.164"> function cvSetNode(node, text)</span>
<a href="#l71.165"></a><span id="l71.165"> {</span>
<a href="#l71.166"></a><span id="l71.166"> 	if ( node )</span>
<a href="#l71.167"></a><span id="l71.167"> 	{</span>
<a href="#l71.168"></a><span id="l71.168"> 		if ( !node.hasChildNodes() )</span>
<a href="#l71.169"></a><span id="l71.169"> 		{</span>
<a href="#l71.170"></a><span id="l71.170"> 			var textNode = document.createTextNode(text);</span>
<a href="#l71.171"></a><span id="l71.171" class="difflineminus">-			node.appendChild(textNode);                   			</span>
<a href="#l71.172"></a><span id="l71.172" class="difflineplus">+			node.appendChild(textNode);</span>
<a href="#l71.173"></a><span id="l71.173"> 		}</span>
<a href="#l71.174"></a><span id="l71.174"> 		else if ( node.childNodes.length == 1 )</span>
<a href="#l71.175"></a><span id="l71.175"> 			node.childNodes[0].nodeValue = text;</span>
<a href="#l71.176"></a><span id="l71.176"> </span>
<a href="#l71.177"></a><span id="l71.177"> 		var visible;</span>
<a href="#l71.178"></a><span id="l71.178" class="difflineminus">-		</span>
<a href="#l71.179"></a><span id="l71.179" class="difflineplus">+</span>
<a href="#l71.180"></a><span id="l71.180"> 		if ( text )</span>
<a href="#l71.181"></a><span id="l71.181"> 			visible = true;</span>
<a href="#l71.182"></a><span id="l71.182"> 		else</span>
<a href="#l71.183"></a><span id="l71.183"> 			visible = false;</span>
<a href="#l71.184"></a><span id="l71.184" class="difflineminus">-		</span>
<a href="#l71.185"></a><span id="l71.185" class="difflineplus">+</span>
<a href="#l71.186"></a><span id="l71.186"> 		cvSetVisible(node, visible);</span>
<a href="#l71.187"></a><span id="l71.187"> 	}</span>
<a href="#l71.188"></a><span id="l71.188"> </span>
<a href="#l71.189"></a><span id="l71.189"> 	return visible;</span>
<a href="#l71.190"></a><span id="l71.190"> }</span>
<a href="#l71.191"></a><span id="l71.191"> </span>
<a href="#l71.192"></a><span id="l71.192"> function cvAddAddressNodes(node, uri)</span>
<a href="#l71.193"></a><span id="l71.193"> {</span>
<a href="#l71.194"></a><span id="l71.194">   var visible = false;</span>
<a href="#l71.195"></a><span id="l71.195"> </span>
<a href="#l71.196"></a><span id="l71.196">   if (node) {</span>
<a href="#l71.197"></a><span id="l71.197">     var editList = GetDirectoryFromURI(uri);</span>
<a href="#l71.198"></a><span id="l71.198">     var addressList = editList.addressLists;</span>
<a href="#l71.199"></a><span id="l71.199" class="difflineminus">-      </span>
<a href="#l71.200"></a><span id="l71.200" class="difflineplus">+</span>
<a href="#l71.201"></a><span id="l71.201">     if (addressList) {</span>
<a href="#l71.202"></a><span id="l71.202">       var total = addressList.length;</span>
<a href="#l71.203"></a><span id="l71.203">       if (total &gt; 0) {</span>
<a href="#l71.204"></a><span id="l71.204">         while (node.hasChildNodes()) {</span>
<a href="#l71.205"></a><span id="l71.205">           node.lastChild.remove();</span>
<a href="#l71.206"></a><span id="l71.206">         }</span>
<a href="#l71.207"></a><span id="l71.207">         for (i = 0;  i &lt; total; i++ ) {</span>
<a href="#l71.208"></a><span id="l71.208" class="difflineminus">-      	   var descNode = document.createElement(&quot;description&quot;);   </span>
<a href="#l71.209"></a><span id="l71.209" class="difflineplus">+      	   var descNode = document.createElement(&quot;description&quot;);</span>
<a href="#l71.210"></a><span id="l71.210">           var card = addressList.queryElementAt(i, Components.interfaces.nsIAbCard);</span>
<a href="#l71.211"></a><span id="l71.211"> </span>
<a href="#l71.212"></a><span id="l71.212">           descNode.setAttribute(&quot;class&quot;, &quot;CardViewLink&quot;);</span>
<a href="#l71.213"></a><span id="l71.213">           node.appendChild(descNode);</span>
<a href="#l71.214"></a><span id="l71.214"> </span>
<a href="#l71.215"></a><span id="l71.215">           var linkNode = document.createElementNS(&quot;http://www.w3.org/1999/xhtml&quot;, &quot;a&quot;);</span>
<a href="#l71.216"></a><span id="l71.216">           linkNode.setAttribute(&quot;id&quot;, &quot;addr#&quot; + i);</span>
<a href="#l71.217"></a><span id="l71.217">           linkNode.setAttribute(&quot;href&quot;, &quot;mailto:&quot; + card.primaryEmail);</span>
<a href="#l71.218"></a><span id="l71.218">           descNode.appendChild(linkNode);</span>
<a href="#l71.219"></a><span id="l71.219" class="difflineminus">-          </span>
<a href="#l71.220"></a><span id="l71.220" class="difflineplus">+</span>
<a href="#l71.221"></a><span id="l71.221">           var textNode = document.createTextNode(card.displayName + &quot; &lt;&quot; + card.primaryEmail + &quot;&gt;&quot;);</span>
<a href="#l71.222"></a><span id="l71.222">           linkNode.appendChild(textNode);</span>
<a href="#l71.223"></a><span id="l71.223">         }</span>
<a href="#l71.224"></a><span id="l71.224">         visible = true;</span>
<a href="#l71.225"></a><span id="l71.225">       }</span>
<a href="#l71.226"></a><span id="l71.226" class="difflineminus">-    }    </span>
<a href="#l71.227"></a><span id="l71.227" class="difflineplus">+    }</span>
<a href="#l71.228"></a><span id="l71.228">     cvSetVisible(node, visible);</span>
<a href="#l71.229"></a><span id="l71.229">   }</span>
<a href="#l71.230"></a><span id="l71.230">   return visible;</span>
<a href="#l71.231"></a><span id="l71.231"> }</span>
<a href="#l71.232"></a><span id="l71.232"> </span>
<a href="#l71.233"></a><span id="l71.233"> function cvSetVisible(node, visible)</span>
<a href="#l71.234"></a><span id="l71.234"> {</span>
<a href="#l71.235"></a><span id="l71.235"> 	if ( visible )</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l72.1"></a><span id="l72.1" class="difflineminus">--- a/suite/mailnews/addrbook/abCommon.js</span>
<a href="#l72.2"></a><span id="l72.2" class="difflineplus">+++ b/suite/mailnews/addrbook/abCommon.js</span>
<a href="#l72.3"></a><span id="l72.3" class="difflineat">@@ -246,22 +246,22 @@ function AbDelete()</span>
<a href="#l72.4"></a><span id="l72.4">     return;</span>
<a href="#l72.5"></a><span id="l72.5"> </span>
<a href="#l72.6"></a><span id="l72.6">   var confirmDeleteMessage;</span>
<a href="#l72.7"></a><span id="l72.7"> </span>
<a href="#l72.8"></a><span id="l72.8">   if (types == kCardsOnly)</span>
<a href="#l72.9"></a><span id="l72.9">   {</span>
<a href="#l72.10"></a><span id="l72.10">     if (gAbView &amp;&amp; gAbView.selection.count &lt; 2)</span>
<a href="#l72.11"></a><span id="l72.11">       confirmDeleteMessage = gAddressBookBundle.getString(&quot;confirmDeleteContact&quot;);</span>
<a href="#l72.12"></a><span id="l72.12" class="difflineminus">-    else </span>
<a href="#l72.13"></a><span id="l72.13" class="difflineplus">+    else</span>
<a href="#l72.14"></a><span id="l72.14">       confirmDeleteMessage = gAddressBookBundle.getString(&quot;confirmDeleteContacts&quot;);</span>
<a href="#l72.15"></a><span id="l72.15">   }</span>
<a href="#l72.16"></a><span id="l72.16">   // If at least one mailing list is selected then prompt users for deletion.</span>
<a href="#l72.17"></a><span id="l72.17">   else</span>
<a href="#l72.18"></a><span id="l72.18" class="difflineminus">-  {   </span>
<a href="#l72.19"></a><span id="l72.19" class="difflineplus">+  {</span>
<a href="#l72.20"></a><span id="l72.20">     if (types == kListsAndCards)</span>
<a href="#l72.21"></a><span id="l72.21">       confirmDeleteMessage = gAddressBookBundle.getString(&quot;confirmDeleteListsAndContacts&quot;);</span>
<a href="#l72.22"></a><span id="l72.22">     else if (types == kMultipleListsOnly)</span>
<a href="#l72.23"></a><span id="l72.23">       confirmDeleteMessage = gAddressBookBundle.getString(&quot;confirmDeleteMailingLists&quot;);</span>
<a href="#l72.24"></a><span id="l72.24">     else if (types == kSingleListOnly)</span>
<a href="#l72.25"></a><span id="l72.25">       confirmDeleteMessage = gAddressBookBundle.getString(&quot;confirmDeleteMailingList&quot;);</span>
<a href="#l72.26"></a><span id="l72.26">   }</span>
<a href="#l72.27"></a><span id="l72.27"> </span>
<a href="#l72.28"></a><span id="l72.28" class="difflineat">@@ -367,21 +367,21 @@ function InitViewLayoutMenuPopup(aEvent)</span>
<a href="#l72.29"></a><span id="l72.29">           .setAttribute(&quot;checked&quot;, dirTreeVisible);</span>
<a href="#l72.30"></a><span id="l72.30"> </span>
<a href="#l72.31"></a><span id="l72.31">   let cardPaneVisible = document.getElementById(&quot;results-splitter&quot;)</span>
<a href="#l72.32"></a><span id="l72.32">                                 .getAttribute(&quot;state&quot;) != &quot;collapsed&quot;;</span>
<a href="#l72.33"></a><span id="l72.33">   document.getElementById(&quot;menu_showCardPane&quot;)</span>
<a href="#l72.34"></a><span id="l72.34">           .setAttribute(&quot;checked&quot;, cardPaneVisible);</span>
<a href="#l72.35"></a><span id="l72.35"> }</span>
<a href="#l72.36"></a><span id="l72.36"> </span>
<a href="#l72.37"></a><span id="l72.37" class="difflineminus">-// Generate a list of cards from the selected mailing list </span>
<a href="#l72.38"></a><span id="l72.38" class="difflineplus">+// Generate a list of cards from the selected mailing list</span>
<a href="#l72.39"></a><span id="l72.39"> // and get a comma separated list of card addresses. If the</span>
<a href="#l72.40"></a><span id="l72.40"> // item selected in the directory pane is not a mailing list,</span>
<a href="#l72.41"></a><span id="l72.41" class="difflineminus">-// an empty string is returned. </span>
<a href="#l72.42"></a><span id="l72.42" class="difflineminus">-function GetSelectedAddressesFromDirTree() </span>
<a href="#l72.43"></a><span id="l72.43" class="difflineplus">+// an empty string is returned.</span>
<a href="#l72.44"></a><span id="l72.44" class="difflineplus">+function GetSelectedAddressesFromDirTree()</span>
<a href="#l72.45"></a><span id="l72.45"> {</span>
<a href="#l72.46"></a><span id="l72.46">   var addresses = &quot;&quot;;</span>
<a href="#l72.47"></a><span id="l72.47"> </span>
<a href="#l72.48"></a><span id="l72.48">   if (gDirTree.currentIndex &gt;= 0) {</span>
<a href="#l72.49"></a><span id="l72.49">     var directory = gDirectoryTreeView.getDirectoryAtIndex(gDirTree.currentIndex);</span>
<a href="#l72.50"></a><span id="l72.50">     if (directory.isMailList) {</span>
<a href="#l72.51"></a><span id="l72.51">       var listCardsCount = directory.addressLists.length;</span>
<a href="#l72.52"></a><span id="l72.52">       var cards = new Array(listCardsCount);</span>
<a href="#l72.53"></a><span id="l72.53" class="difflineat">@@ -435,17 +435,17 @@ function DirPaneClick(event)</span>
<a href="#l72.54"></a><span id="l72.54"> </span>
<a href="#l72.55"></a><span id="l72.55">   // if the user clicks on the header / trecol, do nothing</span>
<a href="#l72.56"></a><span id="l72.56">   if (event.originalTarget.localName == &quot;treecol&quot;) {</span>
<a href="#l72.57"></a><span id="l72.57">     event.stopPropagation();</span>
<a href="#l72.58"></a><span id="l72.58">     return;</span>
<a href="#l72.59"></a><span id="l72.59">   }</span>
<a href="#l72.60"></a><span id="l72.60"> </span>
<a href="#l72.61"></a><span id="l72.61">   var searchInput = document.getElementById(&quot;searchInput&quot;);</span>
<a href="#l72.62"></a><span id="l72.62" class="difflineminus">-  // if there is a searchInput element, and it's not blank </span>
<a href="#l72.63"></a><span id="l72.63" class="difflineplus">+  // if there is a searchInput element, and it's not blank</span>
<a href="#l72.64"></a><span id="l72.64">   // then we need to act like the user cleared the</span>
<a href="#l72.65"></a><span id="l72.65">   // search text</span>
<a href="#l72.66"></a><span id="l72.66">   if (searchInput &amp;&amp; searchInput.value) {</span>
<a href="#l72.67"></a><span id="l72.67">     searchInput.value = &quot;&quot;;</span>
<a href="#l72.68"></a><span id="l72.68">     onEnterInSearchBar();</span>
<a href="#l72.69"></a><span id="l72.69">   }</span>
<a href="#l72.70"></a><span id="l72.70"> }</span>
<a href="#l72.71"></a><span id="l72.71"> </span>
<a href="#l72.72"></a><span id="l72.72" class="difflineat">@@ -475,17 +475,17 @@ function DirPaneSelectionChange()</span>
<a href="#l72.73"></a><span id="l72.73"> }</span>
<a href="#l72.74"></a><span id="l72.74"> </span>
<a href="#l72.75"></a><span id="l72.75"> function ChangeDirectoryByURI(uri)</span>
<a href="#l72.76"></a><span id="l72.76"> {</span>
<a href="#l72.77"></a><span id="l72.77">   if (!uri)</span>
<a href="#l72.78"></a><span id="l72.78">     uri = kPersonalAddressbookURI;</span>
<a href="#l72.79"></a><span id="l72.79"> </span>
<a href="#l72.80"></a><span id="l72.80">   SetAbView(uri);</span>
<a href="#l72.81"></a><span id="l72.81" class="difflineminus">-  </span>
<a href="#l72.82"></a><span id="l72.82" class="difflineplus">+</span>
<a href="#l72.83"></a><span id="l72.83">   // only select the first card if there is a first card</span>
<a href="#l72.84"></a><span id="l72.84">   if (gAbView &amp;&amp; gAbView.getCardFromRow(0))</span>
<a href="#l72.85"></a><span id="l72.85">     SelectFirstCard();</span>
<a href="#l72.86"></a><span id="l72.86">   else</span>
<a href="#l72.87"></a><span id="l72.87">     // the selection changes if we were switching directories.</span>
<a href="#l72.88"></a><span id="l72.88">     ResultsPaneSelectionChanged()</span>
<a href="#l72.89"></a><span id="l72.89"> }</span>
<a href="#l72.90"></a><span id="l72.90"> </span>
<a href="#l72.91"></a><span id="l72.91" class="difflineat">@@ -567,22 +567,22 @@ function InitViewSortByMenu()</span>
<a href="#l72.92"></a><span id="l72.92"> }</span>
<a href="#l72.93"></a><span id="l72.93"> </span>
<a href="#l72.94"></a><span id="l72.94"> function GenerateAddressFromCard(card)</span>
<a href="#l72.95"></a><span id="l72.95"> {</span>
<a href="#l72.96"></a><span id="l72.96">   if (!card)</span>
<a href="#l72.97"></a><span id="l72.97">     return &quot;&quot;;</span>
<a href="#l72.98"></a><span id="l72.98"> </span>
<a href="#l72.99"></a><span id="l72.99">   var email;</span>
<a href="#l72.100"></a><span id="l72.100" class="difflineminus">-  if (card.isMailList) </span>
<a href="#l72.101"></a><span id="l72.101" class="difflineplus">+  if (card.isMailList)</span>
<a href="#l72.102"></a><span id="l72.102">   {</span>
<a href="#l72.103"></a><span id="l72.103">     var directory = GetDirectoryFromURI(card.mailListURI);</span>
<a href="#l72.104"></a><span id="l72.104">     email = directory.description || card.displayName;</span>
<a href="#l72.105"></a><span id="l72.105">   }</span>
<a href="#l72.106"></a><span id="l72.106" class="difflineminus">-  else </span>
<a href="#l72.107"></a><span id="l72.107" class="difflineplus">+  else</span>
<a href="#l72.108"></a><span id="l72.108">     email = card.primaryEmail;</span>
<a href="#l72.109"></a><span id="l72.109">   return MailServices.headerParser.makeMimeAddress(card.displayName, email);</span>
<a href="#l72.110"></a><span id="l72.110"> }</span>
<a href="#l72.111"></a><span id="l72.111"> </span>
<a href="#l72.112"></a><span id="l72.112"> function GetDirectoryFromURI(uri)</span>
<a href="#l72.113"></a><span id="l72.113"> {</span>
<a href="#l72.114"></a><span id="l72.114">   return MailServices.ab.getDirectory(uri);</span>
<a href="#l72.115"></a><span id="l72.115"> }</span>
<a href="#l72.116"></a><span id="l72.116" class="difflineat">@@ -597,17 +597,17 @@ function GetParentDirectoryFromMailingLi</span>
<a href="#l72.117"></a><span id="l72.117">    then, turn [&quot;moz-abmdbdirectory:&quot;,&quot;&quot;,&quot;abook.mab&quot;,&quot;MailList6&quot;]</span>
<a href="#l72.118"></a><span id="l72.118">    into &quot;moz-abmdbdirectory://abook.mab&quot;</span>
<a href="#l72.119"></a><span id="l72.119">   */</span>
<a href="#l72.120"></a><span id="l72.120">   if (abURIArr.length == 4 &amp;&amp; abURIArr[0] == &quot;moz-abmdbdirectory:&quot; &amp;&amp; abURIArr[3] != &quot;&quot;) {</span>
<a href="#l72.121"></a><span id="l72.121">     return abURIArr[0] + &quot;/&quot; + abURIArr[1] + &quot;/&quot; + abURIArr[2];</span>
<a href="#l72.122"></a><span id="l72.122">   }</span>
<a href="#l72.123"></a><span id="l72.123"> </span>
<a href="#l72.124"></a><span id="l72.124">   return null;</span>
<a href="#l72.125"></a><span id="l72.125" class="difflineminus">-} </span>
<a href="#l72.126"></a><span id="l72.126" class="difflineplus">+}</span>
<a href="#l72.127"></a><span id="l72.127"> </span>
<a href="#l72.128"></a><span id="l72.128"> function DirPaneHasFocus()</span>
<a href="#l72.129"></a><span id="l72.129"> {</span>
<a href="#l72.130"></a><span id="l72.130">   // Returns true if directory pane has the focus. Returns false, otherwise.</span>
<a href="#l72.131"></a><span id="l72.131">   return top.document.commandDispatcher.focusedElement == gDirTree;</span>
<a href="#l72.132"></a><span id="l72.132"> }</span>
<a href="#l72.133"></a><span id="l72.133"> </span>
<a href="#l72.134"></a><span id="l72.134"> function GetSelectedDirectory()</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l73.1"></a><span id="l73.1" class="difflineminus">--- a/suite/mailnews/addrbook/abSelectAddressesDialog.js</span>
<a href="#l73.2"></a><span id="l73.2" class="difflineplus">+++ b/suite/mailnews/addrbook/abSelectAddressesDialog.js</span>
<a href="#l73.3"></a><span id="l73.3" class="difflineat">@@ -83,20 +83,20 @@ function OnLoadSelectAddress()</span>
<a href="#l73.4"></a><span id="l73.4">   abList.selectedItem = null;</span>
<a href="#l73.5"></a><span id="l73.5">   abList.value = temp;</span>
<a href="#l73.6"></a><span id="l73.6">   if (!abList.selectedItem)</span>
<a href="#l73.7"></a><span id="l73.7">     abList.selectedIndex = 0;</span>
<a href="#l73.8"></a><span id="l73.8"> </span>
<a href="#l73.9"></a><span id="l73.9">   ChangeDirectoryByURI(abList.value);</span>
<a href="#l73.10"></a><span id="l73.10"> </span>
<a href="#l73.11"></a><span id="l73.11">   DialogBucketPaneSelectionChanged();</span>
<a href="#l73.12"></a><span id="l73.12" class="difflineminus">-  </span>
<a href="#l73.13"></a><span id="l73.13" class="difflineplus">+</span>
<a href="#l73.14"></a><span id="l73.14">   var workPhoneCol = document.getElementById(&quot;WorkPhone&quot;);</span>
<a href="#l73.15"></a><span id="l73.15">   workPhoneCol.setAttribute(&quot;hidden&quot;, &quot;true&quot;);</span>
<a href="#l73.16"></a><span id="l73.16" class="difflineminus">-  </span>
<a href="#l73.17"></a><span id="l73.17" class="difflineplus">+</span>
<a href="#l73.18"></a><span id="l73.18">   var companyCol = document.getElementById(&quot;Company&quot;);</span>
<a href="#l73.19"></a><span id="l73.19">   companyCol.setAttribute(&quot;hidden&quot;, &quot;true&quot;);</span>
<a href="#l73.20"></a><span id="l73.20"> </span>
<a href="#l73.21"></a><span id="l73.21">   gToButton = document.getElementById(&quot;toButton&quot;);</span>
<a href="#l73.22"></a><span id="l73.22">   gCcButton = document.getElementById(&quot;ccButton&quot;);</span>
<a href="#l73.23"></a><span id="l73.23">   gBccButton = document.getElementById(&quot;bccButton&quot;);</span>
<a href="#l73.24"></a><span id="l73.24"> </span>
<a href="#l73.25"></a><span id="l73.25">   gAbResultsTree.focus();</span>
<a href="#l73.26"></a><span id="l73.26" class="difflineat">@@ -335,52 +335,52 @@ function UpdateCardView()</span>
<a href="#l73.27"></a><span id="l73.27"> }</span>
<a href="#l73.28"></a><span id="l73.28"> </span>
<a href="#l73.29"></a><span id="l73.29"> function DropRecipient(address)</span>
<a href="#l73.30"></a><span id="l73.30"> {</span>
<a href="#l73.31"></a><span id="l73.31">   AddAddressIntoBucket(prefixTo, address, address);</span>
<a href="#l73.32"></a><span id="l73.32"> }</span>
<a href="#l73.33"></a><span id="l73.33"> </span>
<a href="#l73.34"></a><span id="l73.34"> function OnReturnHit(event)</span>
<a href="#l73.35"></a><span id="l73.35" class="difflineminus">-{  </span>
<a href="#l73.36"></a><span id="l73.36" class="difflineplus">+{</span>
<a href="#l73.37"></a><span id="l73.37">   if (event.keyCode == 13) {</span>
<a href="#l73.38"></a><span id="l73.38">     var focusedElement = document.commandDispatcher.focusedElement;</span>
<a href="#l73.39"></a><span id="l73.39">     if (focusedElement &amp;&amp; (focusedElement.id == &quot;addressBucket&quot;))</span>
<a href="#l73.40"></a><span id="l73.40">       return;</span>
<a href="#l73.41"></a><span id="l73.41">     event.stopPropagation();</span>
<a href="#l73.42"></a><span id="l73.42">     if (focusedElement &amp;&amp; (focusedElement.id == &quot;abResultsTree&quot;))</span>
<a href="#l73.43"></a><span id="l73.43">       gActivatedButton.doCommand();</span>
<a href="#l73.44"></a><span id="l73.44">   }</span>
<a href="#l73.45"></a><span id="l73.45"> }</span>
<a href="#l73.46"></a><span id="l73.46"> </span>
<a href="#l73.47"></a><span id="l73.47"> </span>
<a href="#l73.48"></a><span id="l73.48"> function onEnterInSearchBar()</span>
<a href="#l73.49"></a><span id="l73.49"> {</span>
<a href="#l73.50"></a><span id="l73.50">   var selectedNode = abList.selectedItem;</span>
<a href="#l73.51"></a><span id="l73.51" class="difflineminus">- </span>
<a href="#l73.52"></a><span id="l73.52" class="difflineplus">+</span>
<a href="#l73.53"></a><span id="l73.53">   if (!selectedNode)</span>
<a href="#l73.54"></a><span id="l73.54">     return;</span>
<a href="#l73.55"></a><span id="l73.55"> </span>
<a href="#l73.56"></a><span id="l73.56">   if (!gQueryURIFormat) {</span>
<a href="#l73.57"></a><span id="l73.57">     // Get model query from pref, without preceding &quot;?&quot;, so we need to add it again</span>
<a href="#l73.58"></a><span id="l73.58">     gQueryURIFormat = &quot;?&quot; + getModelQuery(&quot;mail.addr_book.quicksearchquery.format&quot;);</span>
<a href="#l73.59"></a><span id="l73.59">   }</span>
<a href="#l73.60"></a><span id="l73.60" class="difflineminus">-  </span>
<a href="#l73.61"></a><span id="l73.61" class="difflineplus">+</span>
<a href="#l73.62"></a><span id="l73.62">   var searchURI = selectedNode.value;</span>
<a href="#l73.63"></a><span id="l73.63"> </span>
<a href="#l73.64"></a><span id="l73.64">   if (gSearchInput.value != &quot;&quot;) {</span>
<a href="#l73.65"></a><span id="l73.65">     searchURI += gQueryURIFormat.replace(/@V/g, encodeABTermValue(gSearchInput.value));</span>
<a href="#l73.66"></a><span id="l73.66">   }</span>
<a href="#l73.67"></a><span id="l73.67"> </span>
<a href="#l73.68"></a><span id="l73.68">   SetAbView(searchURI);</span>
<a href="#l73.69"></a><span id="l73.69" class="difflineminus">-  </span>
<a href="#l73.70"></a><span id="l73.70" class="difflineplus">+</span>
<a href="#l73.71"></a><span id="l73.71">   SelectFirstCard();</span>
<a href="#l73.72"></a><span id="l73.72"> }</span>
<a href="#l73.73"></a><span id="l73.73"> </span>
<a href="#l73.74"></a><span id="l73.74"> function DirPaneSelectionChangeMenulist()</span>
<a href="#l73.75"></a><span id="l73.75"> {</span>
<a href="#l73.76"></a><span id="l73.76">   if (abList &amp;&amp; abList.selectedItem) {</span>
<a href="#l73.77"></a><span id="l73.77" class="difflineminus">-    if (gSearchInput.value &amp;&amp; (gSearchInput.value != &quot;&quot;)) </span>
<a href="#l73.78"></a><span id="l73.78" class="difflineplus">+    if (gSearchInput.value &amp;&amp; (gSearchInput.value != &quot;&quot;))</span>
<a href="#l73.79"></a><span id="l73.79">       onEnterInSearchBar();</span>
<a href="#l73.80"></a><span id="l73.80">     else</span>
<a href="#l73.81"></a><span id="l73.81">       ChangeDirectoryByURI(abList.value);</span>
<a href="#l73.82"></a><span id="l73.82">   }</span>
<a href="#l73.83"></a><span id="l73.83"> }</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l74.1"></a><span id="l74.1" class="difflineminus">--- a/suite/mailnews/addrbook/addressbook-panel.js</span>
<a href="#l74.2"></a><span id="l74.2" class="difflineplus">+++ b/suite/mailnews/addrbook/addressbook-panel.js</span>
<a href="#l74.3"></a><span id="l74.3" class="difflineat">@@ -5,19 +5,19 @@</span>
<a href="#l74.4"></a><span id="l74.4"> var gIsMsgCompose = false;</span>
<a href="#l74.5"></a><span id="l74.5"> </span>
<a href="#l74.6"></a><span id="l74.6"> function GetAbViewListener()</span>
<a href="#l74.7"></a><span id="l74.7"> {</span>
<a href="#l74.8"></a><span id="l74.8">   // the ab panel doesn't care if the total changes, or if the selection changes</span>
<a href="#l74.9"></a><span id="l74.9">   return null;</span>
<a href="#l74.10"></a><span id="l74.10"> }</span>
<a href="#l74.11"></a><span id="l74.11"> </span>
<a href="#l74.12"></a><span id="l74.12" class="difflineminus">-function AbPanelLoad() </span>
<a href="#l74.13"></a><span id="l74.13" class="difflineplus">+function AbPanelLoad()</span>
<a href="#l74.14"></a><span id="l74.14"> {</span>
<a href="#l74.15"></a><span id="l74.15" class="difflineminus">-  InitCommonJS(); </span>
<a href="#l74.16"></a><span id="l74.16" class="difflineplus">+  InitCommonJS();</span>
<a href="#l74.17"></a><span id="l74.17"> </span>
<a href="#l74.18"></a><span id="l74.18">   UpgradeAddressBookResultsPaneUI(&quot;mailnews.ui.addressbook_panel_results.version&quot;);</span>
<a href="#l74.19"></a><span id="l74.19"> </span>
<a href="#l74.20"></a><span id="l74.20">   var abPopup = document.getElementById('addressbookList');</span>
<a href="#l74.21"></a><span id="l74.21"> </span>
<a href="#l74.22"></a><span id="l74.22">   // Reselect the persisted address book if possible, if not just select the</span>
<a href="#l74.23"></a><span id="l74.23">   // first in the list.</span>
<a href="#l74.24"></a><span id="l74.24">   var temp = abPopup.value;</span>
<a href="#l74.25"></a><span id="l74.25" class="difflineat">@@ -66,41 +66,41 @@ function AbPanelAdd(addrtype)</span>
<a href="#l74.26"></a><span id="l74.26">       top.awAddRecipient(addrtype, address);</span>
<a href="#l74.27"></a><span id="l74.27">     else</span>
<a href="#l74.28"></a><span id="l74.28">       Services.prompt.alert(window,</span>
<a href="#l74.29"></a><span id="l74.29">                             gAddressBookBundle.getString(&quot;emptyEmailAddCardTitle&quot;),</span>
<a href="#l74.30"></a><span id="l74.30">                             gAddressBookBundle.getString(&quot;emptyEmailAddCard&quot;));</span>
<a href="#l74.31"></a><span id="l74.31">   }</span>
<a href="#l74.32"></a><span id="l74.32"> }</span>
<a href="#l74.33"></a><span id="l74.33"> </span>
<a href="#l74.34"></a><span id="l74.34" class="difflineminus">-function AbPanelNewCard() </span>
<a href="#l74.35"></a><span id="l74.35" class="difflineplus">+function AbPanelNewCard()</span>
<a href="#l74.36"></a><span id="l74.36"> {</span>
<a href="#l74.37"></a><span id="l74.37">   goNewCardDialog(abList.value);</span>
<a href="#l74.38"></a><span id="l74.38"> }</span>
<a href="#l74.39"></a><span id="l74.39"> </span>
<a href="#l74.40"></a><span id="l74.40" class="difflineminus">-function AbPanelNewList() </span>
<a href="#l74.41"></a><span id="l74.41" class="difflineplus">+function AbPanelNewList()</span>
<a href="#l74.42"></a><span id="l74.42"> {</span>
<a href="#l74.43"></a><span id="l74.43">   goNewListDialog(abList.value);</span>
<a href="#l74.44"></a><span id="l74.44"> }</span>
<a href="#l74.45"></a><span id="l74.45"> </span>
<a href="#l74.46"></a><span id="l74.46" class="difflineminus">-function ResultsPaneSelectionChanged() </span>
<a href="#l74.47"></a><span id="l74.47" class="difflineplus">+function ResultsPaneSelectionChanged()</span>
<a href="#l74.48"></a><span id="l74.48"> {</span>
<a href="#l74.49"></a><span id="l74.49">   // do nothing for ab panel</span>
<a href="#l74.50"></a><span id="l74.50"> }</span>
<a href="#l74.51"></a><span id="l74.51"> </span>
<a href="#l74.52"></a><span id="l74.52" class="difflineminus">-function OnClickedCard() </span>
<a href="#l74.53"></a><span id="l74.53" class="difflineplus">+function OnClickedCard()</span>
<a href="#l74.54"></a><span id="l74.54"> {</span>
<a href="#l74.55"></a><span id="l74.55">   // do nothing for ab panel</span>
<a href="#l74.56"></a><span id="l74.56"> }</span>
<a href="#l74.57"></a><span id="l74.57"> </span>
<a href="#l74.58"></a><span id="l74.58" class="difflineminus">-function AbResultsPaneDoubleClick(card) </span>
<a href="#l74.59"></a><span id="l74.59" class="difflineplus">+function AbResultsPaneDoubleClick(card)</span>
<a href="#l74.60"></a><span id="l74.60"> {</span>
<a href="#l74.61"></a><span id="l74.61">   // double click for ab panel means &quot;send mail to this person / list&quot;</span>
<a href="#l74.62"></a><span id="l74.62">   if (gIsMsgCompose)</span>
<a href="#l74.63"></a><span id="l74.63">     AbPanelAdd('addr_to');</span>
<a href="#l74.64"></a><span id="l74.64">   else</span>
<a href="#l74.65"></a><span id="l74.65">     AbNewMessage();</span>
<a href="#l74.66"></a><span id="l74.66"> }</span>
<a href="#l74.67"></a><span id="l74.67"> </span>
<a href="#l74.68"></a><span id="l74.68" class="difflineminus">-function UpdateCardView() </span>
<a href="#l74.69"></a><span id="l74.69" class="difflineplus">+function UpdateCardView()</span>
<a href="#l74.70"></a><span id="l74.70"> {</span>
<a href="#l74.71"></a><span id="l74.71">   // do nothing for ab panel</span>
<a href="#l74.72"></a><span id="l74.72"> }</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l75.1"></a><span id="l75.1" class="difflineminus">--- a/suite/mailnews/addrbook/addressbook.js</span>
<a href="#l75.2"></a><span id="l75.2" class="difflineplus">+++ b/suite/mailnews/addrbook/addressbook.js</span>
<a href="#l75.3"></a><span id="l75.3" class="difflineat">@@ -160,23 +160,23 @@ function ResultsPaneSelectionChanged()</span>
<a href="#l75.4"></a><span id="l75.4"> function UpdateCardView()</span>
<a href="#l75.5"></a><span id="l75.5"> {</span>
<a href="#l75.6"></a><span id="l75.6">   var cards = GetSelectedAbCards();</span>
<a href="#l75.7"></a><span id="l75.7"> </span>
<a href="#l75.8"></a><span id="l75.8">   // display the selected card, if exactly one card is selected.</span>
<a href="#l75.9"></a><span id="l75.9">   // either no cards, or more than one card is selected, clear the pane.</span>
<a href="#l75.10"></a><span id="l75.10">   if (cards.length == 1)</span>
<a href="#l75.11"></a><span id="l75.11">     OnClickedCard(cards[0])</span>
<a href="#l75.12"></a><span id="l75.12" class="difflineminus">-  else </span>
<a href="#l75.13"></a><span id="l75.13" class="difflineplus">+  else</span>
<a href="#l75.14"></a><span id="l75.14">     ClearCardViewPane();</span>
<a href="#l75.15"></a><span id="l75.15"> }</span>
<a href="#l75.16"></a><span id="l75.16"> </span>
<a href="#l75.17"></a><span id="l75.17"> function OnClickedCard(card)</span>
<a href="#l75.18"></a><span id="l75.18" class="difflineminus">-{ </span>
<a href="#l75.19"></a><span id="l75.19" class="difflineminus">-  if (card) </span>
<a href="#l75.20"></a><span id="l75.20" class="difflineplus">+{</span>
<a href="#l75.21"></a><span id="l75.21" class="difflineplus">+  if (card)</span>
<a href="#l75.22"></a><span id="l75.22">     DisplayCardViewPane(card);</span>
<a href="#l75.23"></a><span id="l75.23">   else</span>
<a href="#l75.24"></a><span id="l75.24">     ClearCardViewPane();</span>
<a href="#l75.25"></a><span id="l75.25"> }</span>
<a href="#l75.26"></a><span id="l75.26"> </span>
<a href="#l75.27"></a><span id="l75.27"> function AbClose()</span>
<a href="#l75.28"></a><span id="l75.28"> {</span>
<a href="#l75.29"></a><span id="l75.29">   top.close();</span>
<a href="#l75.30"></a><span id="l75.30" class="difflineat">@@ -210,17 +210,17 @@ function AbPrintCardInternal(doPrintPrev</span>
<a href="#l75.31"></a><span id="l75.31">      {</span>
<a href="#l75.32"></a><span id="l75.32">         selectionArray[totalCard++] = printCardUrl;</span>
<a href="#l75.33"></a><span id="l75.33">      }</span>
<a href="#l75.34"></a><span id="l75.34">   }</span>
<a href="#l75.35"></a><span id="l75.35"> </span>
<a href="#l75.36"></a><span id="l75.36">   printEngineWindow = window.openDialog(&quot;chrome://messenger/content/msgPrintEngine.xul&quot;,</span>
<a href="#l75.37"></a><span id="l75.37">                                          &quot;&quot;,</span>
<a href="#l75.38"></a><span id="l75.38">                                          &quot;chrome,dialog=no,all&quot;,</span>
<a href="#l75.39"></a><span id="l75.39" class="difflineminus">-                                          totalCard, selectionArray, statusFeedback, </span>
<a href="#l75.40"></a><span id="l75.40" class="difflineplus">+                                          totalCard, selectionArray, statusFeedback,</span>
<a href="#l75.41"></a><span id="l75.41">                                           doPrintPreview, msgType);</span>
<a href="#l75.42"></a><span id="l75.42"> </span>
<a href="#l75.43"></a><span id="l75.43">   return;</span>
<a href="#l75.44"></a><span id="l75.44"> }</span>
<a href="#l75.45"></a><span id="l75.45"> </span>
<a href="#l75.46"></a><span id="l75.46"> function AbPrintCard()</span>
<a href="#l75.47"></a><span id="l75.47"> {</span>
<a href="#l75.48"></a><span id="l75.48">   AbPrintCardInternal(false, Components.interfaces.nsIMsgPrintEngine.MNAB_PRINT_AB_CARD);</span>
<a href="#l75.49"></a><span id="l75.49" class="difflineat">@@ -327,17 +327,17 @@ function AbExport(aSelectedABURI)</span>
<a href="#l75.50"></a><span id="l75.50">         message = gAddressBookBundle.getString(&quot;failedToExportMessageNoDeviceSpace&quot;);</span>
<a href="#l75.51"></a><span id="l75.51">         break;</span>
<a href="#l75.52"></a><span id="l75.52">       default:</span>
<a href="#l75.53"></a><span id="l75.53">         message = ex.message;</span>
<a href="#l75.54"></a><span id="l75.54">         break;</span>
<a href="#l75.55"></a><span id="l75.55">     }</span>
<a href="#l75.56"></a><span id="l75.56"> </span>
<a href="#l75.57"></a><span id="l75.57">     Services.prompt.alert(window,</span>
<a href="#l75.58"></a><span id="l75.58" class="difflineminus">-      gAddressBookBundle.getString(&quot;failedToExportTitle&quot;), </span>
<a href="#l75.59"></a><span id="l75.59" class="difflineplus">+      gAddressBookBundle.getString(&quot;failedToExportTitle&quot;),</span>
<a href="#l75.60"></a><span id="l75.60">       message);</span>
<a href="#l75.61"></a><span id="l75.61">   }</span>
<a href="#l75.62"></a><span id="l75.62"> }</span>
<a href="#l75.63"></a><span id="l75.63"> </span>
<a href="#l75.64"></a><span id="l75.64"> function SetStatusText(total)</span>
<a href="#l75.65"></a><span id="l75.65"> {</span>
<a href="#l75.66"></a><span id="l75.66">   if (!gStatusText)</span>
<a href="#l75.67"></a><span id="l75.67">     gStatusText = document.getElementById('statusText');</span>
<a href="#l75.68"></a><span id="l75.68" class="difflineat">@@ -347,22 +347,22 @@ function SetStatusText(total)</span>
<a href="#l75.69"></a><span id="l75.69"> </span>
<a href="#l75.70"></a><span id="l75.70">     if (gSearchInput.value) {</span>
<a href="#l75.71"></a><span id="l75.71">       if (total == 0)</span>
<a href="#l75.72"></a><span id="l75.72">         statusText = gAddressBookBundle.getString(&quot;noMatchFound&quot;);</span>
<a href="#l75.73"></a><span id="l75.73">       else</span>
<a href="#l75.74"></a><span id="l75.74">       {</span>
<a href="#l75.75"></a><span id="l75.75">         if (total == 1)</span>
<a href="#l75.76"></a><span id="l75.76">           statusText = gAddressBookBundle.getString(&quot;matchFound&quot;);</span>
<a href="#l75.77"></a><span id="l75.77" class="difflineminus">-        else  </span>
<a href="#l75.78"></a><span id="l75.78" class="difflineplus">+        else</span>
<a href="#l75.79"></a><span id="l75.79">           statusText = gAddressBookBundle.getFormattedString(&quot;matchesFound&quot;, [total]);</span>
<a href="#l75.80"></a><span id="l75.80">       }</span>
<a href="#l75.81"></a><span id="l75.81" class="difflineminus">-    } </span>
<a href="#l75.82"></a><span id="l75.82" class="difflineplus">+    }</span>
<a href="#l75.83"></a><span id="l75.83">     else</span>
<a href="#l75.84"></a><span id="l75.84" class="difflineminus">-      statusText = gAddressBookBundle.getFormattedString(&quot;totalContactStatus&quot;, [gAbView.directory.dirName, total]);   </span>
<a href="#l75.85"></a><span id="l75.85" class="difflineplus">+      statusText = gAddressBookBundle.getFormattedString(&quot;totalContactStatus&quot;, [gAbView.directory.dirName, total]);</span>
<a href="#l75.86"></a><span id="l75.86"> </span>
<a href="#l75.87"></a><span id="l75.87">     gStatusText.setAttribute(&quot;label&quot;, statusText);</span>
<a href="#l75.88"></a><span id="l75.88">   }</span>
<a href="#l75.89"></a><span id="l75.89">   catch(ex) {</span>
<a href="#l75.90"></a><span id="l75.90">     dump(&quot;failed to set status text:  &quot; + ex + &quot;\n&quot;);</span>
<a href="#l75.91"></a><span id="l75.91">   }</span>
<a href="#l75.92"></a><span id="l75.92"> }</span>
<a href="#l75.93"></a><span id="l75.93"> </span>
<a href="#l75.94"></a><span id="l75.94" class="difflineat">@@ -375,47 +375,47 @@ function onAdvancedAbSearch()</span>
<a href="#l75.95"></a><span id="l75.95"> {</span>
<a href="#l75.96"></a><span id="l75.96">   var selectedABURI = GetSelectedDirectory();</span>
<a href="#l75.97"></a><span id="l75.97">   if (!selectedABURI) return;</span>
<a href="#l75.98"></a><span id="l75.98"> </span>
<a href="#l75.99"></a><span id="l75.99">   var existingSearchWindow = Services.wm.getMostRecentWindow(&quot;mailnews:absearch&quot;);</span>
<a href="#l75.100"></a><span id="l75.100">   if (existingSearchWindow)</span>
<a href="#l75.101"></a><span id="l75.101">     existingSearchWindow.focus();</span>
<a href="#l75.102"></a><span id="l75.102">   else</span>
<a href="#l75.103"></a><span id="l75.103" class="difflineminus">-    window.openDialog(&quot;chrome://messenger/content/ABSearchDialog.xul&quot;, &quot;&quot;, </span>
<a href="#l75.104"></a><span id="l75.104" class="difflineminus">-                      &quot;chrome,resizable,status,centerscreen,dialog=no&quot;, </span>
<a href="#l75.105"></a><span id="l75.105" class="difflineplus">+    window.openDialog(&quot;chrome://messenger/content/ABSearchDialog.xul&quot;, &quot;&quot;,</span>
<a href="#l75.106"></a><span id="l75.106" class="difflineplus">+                      &quot;chrome,resizable,status,centerscreen,dialog=no&quot;,</span>
<a href="#l75.107"></a><span id="l75.107">                       {directory: selectedABURI});</span>
<a href="#l75.108"></a><span id="l75.108"> }</span>
<a href="#l75.109"></a><span id="l75.109"> </span>
<a href="#l75.110"></a><span id="l75.110"> function onEnterInSearchBar()</span>
<a href="#l75.111"></a><span id="l75.111"> {</span>
<a href="#l75.112"></a><span id="l75.112" class="difflineminus">-  ClearCardViewPane();  </span>
<a href="#l75.113"></a><span id="l75.113" class="difflineplus">+  ClearCardViewPane();</span>
<a href="#l75.114"></a><span id="l75.114"> </span>
<a href="#l75.115"></a><span id="l75.115">   if (!gQueryURIFormat) {</span>
<a href="#l75.116"></a><span id="l75.116">     // Get model query from pref, without preceding &quot;?&quot;, so we need to add it again</span>
<a href="#l75.117"></a><span id="l75.117">     gQueryURIFormat = &quot;?&quot; + getModelQuery(&quot;mail.addr_book.quicksearchquery.format&quot;);</span>
<a href="#l75.118"></a><span id="l75.118">   }</span>
<a href="#l75.119"></a><span id="l75.119">   var searchURI = GetSelectedDirectory();</span>
<a href="#l75.120"></a><span id="l75.120">   if (!searchURI) return;</span>
<a href="#l75.121"></a><span id="l75.121"> </span>
<a href="#l75.122"></a><span id="l75.122">   /*</span>
<a href="#l75.123"></a><span id="l75.123">    XXX todo, handle the case where the LDAP url</span>
<a href="#l75.124"></a><span id="l75.124" class="difflineminus">-   already has a query, like </span>
<a href="#l75.125"></a><span id="l75.125" class="difflineplus">+   already has a query, like</span>
<a href="#l75.126"></a><span id="l75.126">    moz-abldapdirectory://nsdirectory.netscape.com:389/ou=People,dc=netscape,dc=com?(or(Department,=,Applications))</span>
<a href="#l75.127"></a><span id="l75.127">   */</span>
<a href="#l75.128"></a><span id="l75.128">   if (gSearchInput.value != &quot;&quot;) {</span>
<a href="#l75.129"></a><span id="l75.129">     // replace all instances of @V with the escaped version</span>
<a href="#l75.130"></a><span id="l75.130">     // of what the user typed in the quick search text input</span>
<a href="#l75.131"></a><span id="l75.131">     searchURI += gQueryURIFormat.replace(/@V/g, encodeABTermValue(gSearchInput.value));</span>
<a href="#l75.132"></a><span id="l75.132">   }</span>
<a href="#l75.133"></a><span id="l75.133"> </span>
<a href="#l75.134"></a><span id="l75.134">   SetAbView(searchURI);</span>
<a href="#l75.135"></a><span id="l75.135" class="difflineminus">-  </span>
<a href="#l75.136"></a><span id="l75.136" class="difflineminus">-  // XXX todo </span>
<a href="#l75.137"></a><span id="l75.137" class="difflineminus">-  // this works for synchronous searches of local addressbooks, </span>
<a href="#l75.138"></a><span id="l75.138" class="difflineplus">+</span>
<a href="#l75.139"></a><span id="l75.139" class="difflineplus">+  // XXX todo</span>
<a href="#l75.140"></a><span id="l75.140" class="difflineplus">+  // this works for synchronous searches of local addressbooks,</span>
<a href="#l75.141"></a><span id="l75.141">   // but not for LDAP searches</span>
<a href="#l75.142"></a><span id="l75.142">   SelectFirstCard();</span>
<a href="#l75.143"></a><span id="l75.143"> }</span>
<a href="#l75.144"></a><span id="l75.144"> </span>
<a href="#l75.145"></a><span id="l75.145"> function SwitchPaneFocus(event)</span>
<a href="#l75.146"></a><span id="l75.146"> {</span>
<a href="#l75.147"></a><span id="l75.147">   var focusedElement    = WhichPaneHasFocus();</span>
<a href="#l75.148"></a><span id="l75.148">   var cardViewBox       = GetCardViewBox();</span>
<a href="#l75.149"></a><span id="l75.149" class="difflineat">@@ -429,47 +429,47 @@ function SwitchPaneFocus(event)</span>
<a href="#l75.150"></a><span id="l75.150">       searchInput.focus();</span>
<a href="#l75.151"></a><span id="l75.151">     else if ((focusedElement == gAbResultsTree || focusedElement == searchBox) &amp;&amp; !IsDirPaneCollapsed())</span>
<a href="#l75.152"></a><span id="l75.152">       dirTree.focus();</span>
<a href="#l75.153"></a><span id="l75.153">     else if (focusedElement != cardViewBox &amp;&amp; !IsCardViewAndAbResultsPaneSplitterCollapsed())</span>
<a href="#l75.154"></a><span id="l75.154">     {</span>
<a href="#l75.155"></a><span id="l75.155">       if(cardViewBoxEmail1)</span>
<a href="#l75.156"></a><span id="l75.156">         cardViewBoxEmail1.focus();</span>
<a href="#l75.157"></a><span id="l75.157">       else</span>
<a href="#l75.158"></a><span id="l75.158" class="difflineminus">-        cardViewBox.focus();    </span>
<a href="#l75.159"></a><span id="l75.159" class="difflineplus">+        cardViewBox.focus();</span>
<a href="#l75.160"></a><span id="l75.160">     }</span>
<a href="#l75.161"></a><span id="l75.161" class="difflineminus">-    else </span>
<a href="#l75.162"></a><span id="l75.162" class="difflineplus">+    else</span>
<a href="#l75.163"></a><span id="l75.163">       gAbResultsTree.focus();</span>
<a href="#l75.164"></a><span id="l75.164">   }</span>
<a href="#l75.165"></a><span id="l75.165">   else</span>
<a href="#l75.166"></a><span id="l75.166">   {</span>
<a href="#l75.167"></a><span id="l75.167">     if (focusedElement == searchBox)</span>
<a href="#l75.168"></a><span id="l75.168">       gAbResultsTree.focus();</span>
<a href="#l75.169"></a><span id="l75.169">     else if (focusedElement == gAbResultsTree &amp;&amp; !IsCardViewAndAbResultsPaneSplitterCollapsed())</span>
<a href="#l75.170"></a><span id="l75.170">     {</span>
<a href="#l75.171"></a><span id="l75.171">       if(cardViewBoxEmail1)</span>
<a href="#l75.172"></a><span id="l75.172">         cardViewBoxEmail1.focus();</span>
<a href="#l75.173"></a><span id="l75.173">       else</span>
<a href="#l75.174"></a><span id="l75.174" class="difflineminus">-        cardViewBox.focus();    </span>
<a href="#l75.175"></a><span id="l75.175" class="difflineplus">+        cardViewBox.focus();</span>
<a href="#l75.176"></a><span id="l75.176">     }</span>
<a href="#l75.177"></a><span id="l75.177">     else if (focusedElement != dirTree &amp;&amp; !IsDirPaneCollapsed())</span>
<a href="#l75.178"></a><span id="l75.178">       dirTree.focus();</span>
<a href="#l75.179"></a><span id="l75.179">     else if (searchBox.getAttribute('hidden') != 'true')</span>
<a href="#l75.180"></a><span id="l75.180">       gSearchInput.focus();</span>
<a href="#l75.181"></a><span id="l75.181">     else</span>
<a href="#l75.182"></a><span id="l75.182">       gAbResultsTree.focus();</span>
<a href="#l75.183"></a><span id="l75.183">   }</span>
<a href="#l75.184"></a><span id="l75.184"> }</span>
<a href="#l75.185"></a><span id="l75.185"> </span>
<a href="#l75.186"></a><span id="l75.186"> function WhichPaneHasFocus()</span>
<a href="#l75.187"></a><span id="l75.187"> {</span>
<a href="#l75.188"></a><span id="l75.188">   var cardViewBox       = GetCardViewBox();</span>
<a href="#l75.189"></a><span id="l75.189">   var searchBox         = GetSearchBox();</span>
<a href="#l75.190"></a><span id="l75.190">   var dirTree           = GetDirTree();</span>
<a href="#l75.191"></a><span id="l75.191" class="difflineminus">-    </span>
<a href="#l75.192"></a><span id="l75.192" class="difflineplus">+</span>
<a href="#l75.193"></a><span id="l75.193">   var currentNode = top.document.commandDispatcher.focusedElement;</span>
<a href="#l75.194"></a><span id="l75.194">   while (currentNode)</span>
<a href="#l75.195"></a><span id="l75.195">   {</span>
<a href="#l75.196"></a><span id="l75.196">     var nodeId = currentNode.getAttribute('id');</span>
<a href="#l75.197"></a><span id="l75.197"> </span>
<a href="#l75.198"></a><span id="l75.198">     if(currentNode == gAbResultsTree ||</span>
<a href="#l75.199"></a><span id="l75.199">        currentNode == cardViewBox ||</span>
<a href="#l75.200"></a><span id="l75.200">        currentNode == searchBox ||</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l76.1"></a><span id="l76.1" class="difflineminus">--- a/suite/mailnews/commandglue.js</span>
<a href="#l76.2"></a><span id="l76.2" class="difflineplus">+++ b/suite/mailnews/commandglue.js</span>
<a href="#l76.3"></a><span id="l76.3" class="difflineat">@@ -348,26 +348,26 @@ function SwitchView(command)</span>
<a href="#l76.4"></a><span id="l76.4"> {</span>
<a href="#l76.5"></a><span id="l76.5">   // when switching thread views, we might be coming out of quick search</span>
<a href="#l76.6"></a><span id="l76.6">   // or a message view.</span>
<a href="#l76.7"></a><span id="l76.7">   // first set view picker to all</span>
<a href="#l76.8"></a><span id="l76.8">   ViewChangeByValue(kViewItemAll);</span>
<a href="#l76.9"></a><span id="l76.9"> </span>
<a href="#l76.10"></a><span id="l76.10">   // clear the QS text, if we need to</span>
<a href="#l76.11"></a><span id="l76.11">   ClearQSIfNecessary();</span>
<a href="#l76.12"></a><span id="l76.12" class="difflineminus">-  </span>
<a href="#l76.13"></a><span id="l76.13" class="difflineplus">+</span>
<a href="#l76.14"></a><span id="l76.14">   // now switch views</span>
<a href="#l76.15"></a><span id="l76.15">   var oldSortType = gDBView ? gDBView.sortType : nsMsgViewSortType.byThread;</span>
<a href="#l76.16"></a><span id="l76.16">   var oldSortOrder = gDBView ? gDBView.sortOrder : nsMsgViewSortOrder.ascending;</span>
<a href="#l76.17"></a><span id="l76.17">   var viewFlags = gDBView ? gDBView.viewFlags : gCurViewFlags;</span>
<a href="#l76.18"></a><span id="l76.18"> </span>
<a href="#l76.19"></a><span id="l76.19">   // close existing view.</span>
<a href="#l76.20"></a><span id="l76.20">   if (gDBView) {</span>
<a href="#l76.21"></a><span id="l76.21">     gDBView.close();</span>
<a href="#l76.22"></a><span id="l76.22" class="difflineminus">-    gDBView = null; </span>
<a href="#l76.23"></a><span id="l76.23" class="difflineplus">+    gDBView = null;</span>
<a href="#l76.24"></a><span id="l76.24">   }</span>
<a href="#l76.25"></a><span id="l76.25"> </span>
<a href="#l76.26"></a><span id="l76.26">   switch(command)</span>
<a href="#l76.27"></a><span id="l76.27">   {</span>
<a href="#l76.28"></a><span id="l76.28">     // &quot;All&quot; threads and &quot;Unread&quot; threads don't change threading state</span>
<a href="#l76.29"></a><span id="l76.29">     case &quot;cmd_viewAllMsgs&quot;:</span>
<a href="#l76.30"></a><span id="l76.30">       viewFlags = viewFlags &amp; ~nsMsgViewFlagsType.kUnreadOnly;</span>
<a href="#l76.31"></a><span id="l76.31">       CreateDBView(msgWindow.openFolder, nsMsgViewType.eShowAllThreads, viewFlags,</span>
<a href="#l76.32"></a><span id="l76.32" class="difflineat">@@ -414,17 +414,17 @@ function SetSentFolderColumns(isSentFold</span>
<a href="#l76.33"></a><span id="l76.33">   var tree = GetThreadTree();</span>
<a href="#l76.34"></a><span id="l76.34">   var searchBox = document.getElementById(&quot;searchInput&quot;);</span>
<a href="#l76.35"></a><span id="l76.35"> </span>
<a href="#l76.36"></a><span id="l76.36">   var lastFolderSent = tree.getAttribute(&quot;lastfoldersent&quot;) == &quot;true&quot;;</span>
<a href="#l76.37"></a><span id="l76.37">   if (isSentFolder != lastFolderSent)</span>
<a href="#l76.38"></a><span id="l76.38">   {</span>
<a href="#l76.39"></a><span id="l76.39">     var senderColumn = document.getElementById(&quot;senderCol&quot;);</span>
<a href="#l76.40"></a><span id="l76.40">     var recipientColumn = document.getElementById(&quot;recipientCol&quot;);</span>
<a href="#l76.41"></a><span id="l76.41" class="difflineminus">-    </span>
<a href="#l76.42"></a><span id="l76.42" class="difflineplus">+</span>
<a href="#l76.43"></a><span id="l76.43">     var saveHidden = senderColumn.getAttribute(&quot;hidden&quot;);</span>
<a href="#l76.44"></a><span id="l76.44">     senderColumn.setAttribute(&quot;hidden&quot;, senderColumn.getAttribute(&quot;swappedhidden&quot;));</span>
<a href="#l76.45"></a><span id="l76.45">     senderColumn.setAttribute(&quot;swappedhidden&quot;, saveHidden);</span>
<a href="#l76.46"></a><span id="l76.46"> </span>
<a href="#l76.47"></a><span id="l76.47">     saveHidden = recipientColumn.getAttribute(&quot;hidden&quot;);</span>
<a href="#l76.48"></a><span id="l76.48">     recipientColumn.setAttribute(&quot;hidden&quot;, recipientColumn.getAttribute(&quot;swappedhidden&quot;));</span>
<a href="#l76.49"></a><span id="l76.49">     recipientColumn.setAttribute(&quot;swappedhidden&quot;, saveHidden);</span>
<a href="#l76.50"></a><span id="l76.50">   }</span>
<a href="#l76.51"></a><span id="l76.51" class="difflineat">@@ -662,17 +662,17 @@ function CreateBareDBView(originalView, </span>
<a href="#l76.52"></a><span id="l76.52">     gDBView.init(messenger, msgWindow, gThreadPaneCommandUpdater);</span>
<a href="#l76.53"></a><span id="l76.53">     gDBView.open(msgFolder, gCurSortType, sortOrder, viewFlags, count);</span>
<a href="#l76.54"></a><span id="l76.54">     if (viewType == nsMsgViewType.eShowVirtualFolderResults)</span>
<a href="#l76.55"></a><span id="l76.55">     {</span>
<a href="#l76.56"></a><span id="l76.56">       // the view is a listener on the search results</span>
<a href="#l76.57"></a><span id="l76.57">       gViewSearchListener = gDBView.QueryInterface(Components.interfaces.nsIMsgSearchNotify);</span>
<a href="#l76.58"></a><span id="l76.58">       gSearchSession.registerListener(gViewSearchListener);</span>
<a href="#l76.59"></a><span id="l76.59">     }</span>
<a href="#l76.60"></a><span id="l76.60" class="difflineminus">-  } </span>
<a href="#l76.61"></a><span id="l76.61" class="difflineplus">+  }</span>
<a href="#l76.62"></a><span id="l76.62">   else {</span>
<a href="#l76.63"></a><span id="l76.63">     gDBView = originalView.cloneDBView(messenger, msgWindow, gThreadPaneCommandUpdater);</span>
<a href="#l76.64"></a><span id="l76.64">   }</span>
<a href="#l76.65"></a><span id="l76.65"> }</span>
<a href="#l76.66"></a><span id="l76.66"> </span>
<a href="#l76.67"></a><span id="l76.67"> function CreateDBView(msgFolder, viewType, viewFlags, sortType, sortOrder)</span>
<a href="#l76.68"></a><span id="l76.68"> {</span>
<a href="#l76.69"></a><span id="l76.69">   // call the inner create method</span>
<a href="#l76.70"></a><span id="l76.70" class="difflineat">@@ -739,19 +739,19 @@ function FolderPaneSelectionChange()</span>
<a href="#l76.71"></a><span id="l76.71">             var viewType = 0;</span>
<a href="#l76.72"></a><span id="l76.72">             gDefaultSearchViewTerms = null;</span>
<a href="#l76.73"></a><span id="l76.73">             gVirtualFolderTerms = null;</span>
<a href="#l76.74"></a><span id="l76.74">             gXFVirtualFolderTerms = null;</span>
<a href="#l76.75"></a><span id="l76.75">             gPrevFolderFlags = folderFlags;</span>
<a href="#l76.76"></a><span id="l76.76">             gCurrentVirtualFolderUri = null;</span>
<a href="#l76.77"></a><span id="l76.77">             // don't get the db if this folder is a server</span>
<a href="#l76.78"></a><span id="l76.78">             // we're going to be display account central</span>
<a href="#l76.79"></a><span id="l76.79" class="difflineminus">-            if (!(msgFolder.isServer)) </span>
<a href="#l76.80"></a><span id="l76.80" class="difflineplus">+            if (!(msgFolder.isServer))</span>
<a href="#l76.81"></a><span id="l76.81">             {</span>
<a href="#l76.82"></a><span id="l76.82" class="difflineminus">-              try </span>
<a href="#l76.83"></a><span id="l76.83" class="difflineplus">+              try</span>
<a href="#l76.84"></a><span id="l76.84">               {</span>
<a href="#l76.85"></a><span id="l76.85">                 var msgDatabase = msgFolder.msgDatabase;</span>
<a href="#l76.86"></a><span id="l76.86">                 if (msgDatabase)</span>
<a href="#l76.87"></a><span id="l76.87">                 {</span>
<a href="#l76.88"></a><span id="l76.88">                   gSearchSession = null;</span>
<a href="#l76.89"></a><span id="l76.89">                   var dbFolderInfo = msgDatabase.dBFolderInfo;</span>
<a href="#l76.90"></a><span id="l76.90">                   sortType = dbFolderInfo.sortType;</span>
<a href="#l76.91"></a><span id="l76.91">                   sortOrder = dbFolderInfo.sortOrder;</span>
<a href="#l76.92"></a><span id="l76.92" class="difflineat">@@ -781,17 +781,17 @@ function FolderPaneSelectionChange()</span>
<a href="#l76.93"></a><span id="l76.93">                     else</span>
<a href="#l76.94"></a><span id="l76.94">                     {</span>
<a href="#l76.95"></a><span id="l76.95">                       uriToLoad = srchFolderUri;</span>
<a href="#l76.96"></a><span id="l76.96">                       // we need to load the db for the actual folder so that many hdrs to download</span>
<a href="#l76.97"></a><span id="l76.97">                       // will return false...</span>
<a href="#l76.98"></a><span id="l76.98">                       realFolder = GetMsgFolderFromUri(uriToLoad);</span>
<a href="#l76.99"></a><span id="l76.99">                       msgDatabase = realFolder.msgDatabase;</span>
<a href="#l76.100"></a><span id="l76.100"> //                      dump(&quot;search term string = &quot; + searchTermString + &quot;\n&quot;);</span>
<a href="#l76.101"></a><span id="l76.101" class="difflineminus">-                    </span>
<a href="#l76.102"></a><span id="l76.102" class="difflineplus">+</span>
<a href="#l76.103"></a><span id="l76.103">                       gVirtualFolderTerms = CreateGroupedSearchTerms(tempFilter.searchTerms);</span>
<a href="#l76.104"></a><span id="l76.104">                     }</span>
<a href="#l76.105"></a><span id="l76.105">                   }</span>
<a href="#l76.106"></a><span id="l76.106">                   msgDatabase = null;</span>
<a href="#l76.107"></a><span id="l76.107">                   dbFolderInfo = null;</span>
<a href="#l76.108"></a><span id="l76.108">                 }</span>
<a href="#l76.109"></a><span id="l76.109">               }</span>
<a href="#l76.110"></a><span id="l76.110">               catch (ex)</span>
<a href="#l76.111"></a><span id="l76.111" class="difflineat">@@ -800,20 +800,20 @@ function FolderPaneSelectionChange()</span>
<a href="#l76.112"></a><span id="l76.112">               }</span>
<a href="#l76.113"></a><span id="l76.113">             }</span>
<a href="#l76.114"></a><span id="l76.114">             // clear cached view if we have no db or a pending quick search</span>
<a href="#l76.115"></a><span id="l76.115">             if (!gDBView || gDBView.viewType == nsMsgViewType.eShowQuickSearchResults)</span>
<a href="#l76.116"></a><span id="l76.116">             {</span>
<a href="#l76.117"></a><span id="l76.117">               if (gPreQuickSearchView) //close cached view before quick search</span>
<a href="#l76.118"></a><span id="l76.118">               {</span>
<a href="#l76.119"></a><span id="l76.119">                 gPreQuickSearchView.close();</span>
<a href="#l76.120"></a><span id="l76.120" class="difflineminus">-                gPreQuickSearchView = null;  </span>
<a href="#l76.121"></a><span id="l76.121" class="difflineplus">+                gPreQuickSearchView = null;</span>
<a href="#l76.122"></a><span id="l76.122">               }</span>
<a href="#l76.123"></a><span id="l76.123">               var searchInput = document.getElementById(&quot;searchInput&quot;);  //reset the search input on folder switch</span>
<a href="#l76.124"></a><span id="l76.124" class="difflineminus">-              if (searchInput) </span>
<a href="#l76.125"></a><span id="l76.125" class="difflineplus">+              if (searchInput)</span>
<a href="#l76.126"></a><span id="l76.126">                 searchInput.value = &quot;&quot;;</span>
<a href="#l76.127"></a><span id="l76.127">             }</span>
<a href="#l76.128"></a><span id="l76.128">             ClearMessagePane();</span>
<a href="#l76.129"></a><span id="l76.129"> </span>
<a href="#l76.130"></a><span id="l76.130">             if (gXFVirtualFolderTerms)</span>
<a href="#l76.131"></a><span id="l76.131">               viewType = nsMsgViewType.eShowVirtualFolderResults;</span>
<a href="#l76.132"></a><span id="l76.132">             else if (gSearchEmailAddress || gVirtualFolderTerms)</span>
<a href="#l76.133"></a><span id="l76.133">               viewType = nsMsgViewType.eShowQuickSearchResults;</span>
<a href="#l76.134"></a><span id="l76.134" class="difflineat">@@ -839,36 +839,36 @@ function FolderPaneSelectionChange()</span>
<a href="#l76.135"></a><span id="l76.135">     if (gAccountCentralLoaded)</span>
<a href="#l76.136"></a><span id="l76.136">       UpdateMailToolbar(&quot;gAccountCentralLoaded&quot;);</span>
<a href="#l76.137"></a><span id="l76.137"> </span>
<a href="#l76.138"></a><span id="l76.138">     if (gDisplayStartupPage)</span>
<a href="#l76.139"></a><span id="l76.139">     {</span>
<a href="#l76.140"></a><span id="l76.140">         loadStartPage();</span>
<a href="#l76.141"></a><span id="l76.141">         gDisplayStartupPage = false;</span>
<a href="#l76.142"></a><span id="l76.142">         UpdateMailToolbar(&quot;gDisplayStartupPage&quot;);</span>
<a href="#l76.143"></a><span id="l76.143" class="difflineminus">-    }    </span>
<a href="#l76.144"></a><span id="l76.144" class="difflineplus">+    }</span>
<a href="#l76.145"></a><span id="l76.145"> }</span>
<a href="#l76.146"></a><span id="l76.146"> </span>
<a href="#l76.147"></a><span id="l76.147"> function ClearThreadPane()</span>
<a href="#l76.148"></a><span id="l76.148"> {</span>
<a href="#l76.149"></a><span id="l76.149">   if (gDBView) {</span>
<a href="#l76.150"></a><span id="l76.150">     gDBView.close();</span>
<a href="#l76.151"></a><span id="l76.151" class="difflineminus">-    gDBView = null; </span>
<a href="#l76.152"></a><span id="l76.152" class="difflineplus">+    gDBView = null;</span>
<a href="#l76.153"></a><span id="l76.153">   }</span>
<a href="#l76.154"></a><span id="l76.154"> }</span>
<a href="#l76.155"></a><span id="l76.155"> </span>
<a href="#l76.156"></a><span id="l76.156"> var mailOfflineObserver = {</span>
<a href="#l76.157"></a><span id="l76.157">   observe: function(subject, topic, state) {</span>
<a href="#l76.158"></a><span id="l76.158">     // sanity checks</span>
<a href="#l76.159"></a><span id="l76.159">     if (topic != &quot;network:offline-status-changed&quot;) return;</span>
<a href="#l76.160"></a><span id="l76.160">     MailOfflineStateChanged(state == &quot;offline&quot;);</span>
<a href="#l76.161"></a><span id="l76.161">   }</span>
<a href="#l76.162"></a><span id="l76.162"> }</span>
<a href="#l76.163"></a><span id="l76.163"> </span>
<a href="#l76.164"></a><span id="l76.164" class="difflineminus">-function AddMailOfflineObserver() </span>
<a href="#l76.165"></a><span id="l76.165" class="difflineplus">+function AddMailOfflineObserver()</span>
<a href="#l76.166"></a><span id="l76.166"> {</span>
<a href="#l76.167"></a><span id="l76.167">   Services.obs.addObserver(mailOfflineObserver, &quot;network:offline-status-changed&quot;, false);</span>
<a href="#l76.168"></a><span id="l76.168"> }</span>
<a href="#l76.169"></a><span id="l76.169"> </span>
<a href="#l76.170"></a><span id="l76.170"> function RemoveMailOfflineObserver()</span>
<a href="#l76.171"></a><span id="l76.171"> {</span>
<a href="#l76.172"></a><span id="l76.172">   Services.obs.removeObserver(mailOfflineObserver, &quot;network:offline-status-changed&quot;);</span>
<a href="#l76.173"></a><span id="l76.173"> }</span>
<a href="#l76.174"></a><span id="l76.174" class="difflineat">@@ -876,35 +876,35 @@ function RemoveMailOfflineObserver()</span>
<a href="#l76.175"></a><span id="l76.175"> function getSearchTermString(searchTerms)</span>
<a href="#l76.176"></a><span id="l76.176"> {</span>
<a href="#l76.177"></a><span id="l76.177">   var searchIndex;</span>
<a href="#l76.178"></a><span id="l76.178">   var condition = &quot;&quot;;</span>
<a href="#l76.179"></a><span id="l76.179">   var count = searchTerms.Count();</span>
<a href="#l76.180"></a><span id="l76.180">   for (searchIndex = 0; searchIndex &lt; count; )</span>
<a href="#l76.181"></a><span id="l76.181">   {</span>
<a href="#l76.182"></a><span id="l76.182">     var term = searchTerms.QueryElementAt(searchIndex++, Components.interfaces.nsIMsgSearchTerm);</span>
<a href="#l76.183"></a><span id="l76.183" class="difflineminus">-    </span>
<a href="#l76.184"></a><span id="l76.184" class="difflineplus">+</span>
<a href="#l76.185"></a><span id="l76.185">     if (condition.length &gt; 1)</span>
<a href="#l76.186"></a><span id="l76.186">       condition += ' ';</span>
<a href="#l76.187"></a><span id="l76.187" class="difflineminus">-    </span>
<a href="#l76.188"></a><span id="l76.188" class="difflineplus">+</span>
<a href="#l76.189"></a><span id="l76.189">     if (term.matchAll)</span>
<a href="#l76.190"></a><span id="l76.190">     {</span>
<a href="#l76.191"></a><span id="l76.191">         condition = &quot;ALL&quot;;</span>
<a href="#l76.192"></a><span id="l76.192">         break;</span>
<a href="#l76.193"></a><span id="l76.193">     }</span>
<a href="#l76.194"></a><span id="l76.194">     condition += (term.booleanAnd) ? &quot;AND (&quot; : &quot;OR (&quot;;</span>
<a href="#l76.195"></a><span id="l76.195">     condition += term.termAsString + ')';</span>
<a href="#l76.196"></a><span id="l76.196">   }</span>
<a href="#l76.197"></a><span id="l76.197">   return condition;</span>
<a href="#l76.198"></a><span id="l76.198"> }</span>
<a href="#l76.199"></a><span id="l76.199"> </span>
<a href="#l76.200"></a><span id="l76.200"> function  CreateVirtualFolder(newName, parentFolder, searchFolderURIs, searchTerms, searchOnline)</span>
<a href="#l76.201"></a><span id="l76.201"> {</span>
<a href="#l76.202"></a><span id="l76.202">   // ### need to make sure view/folder doesn't exist.</span>
<a href="#l76.203"></a><span id="l76.203" class="difflineminus">-  if (searchFolderURIs &amp;&amp; (searchFolderURIs != &quot;&quot;) &amp;&amp; newName &amp;&amp; (newName != &quot;&quot;)) </span>
<a href="#l76.204"></a><span id="l76.204" class="difflineplus">+  if (searchFolderURIs &amp;&amp; (searchFolderURIs != &quot;&quot;) &amp;&amp; newName &amp;&amp; (newName != &quot;&quot;))</span>
<a href="#l76.205"></a><span id="l76.205">   {</span>
<a href="#l76.206"></a><span id="l76.206">     var newFolder;</span>
<a href="#l76.207"></a><span id="l76.207">     try</span>
<a href="#l76.208"></a><span id="l76.208">     {</span>
<a href="#l76.209"></a><span id="l76.209">       if (parentFolder instanceof(Components.interfaces.nsIMsgLocalMailFolder))</span>
<a href="#l76.210"></a><span id="l76.210">         newFolder = parentFolder.createLocalSubfolder(newName);</span>
<a href="#l76.211"></a><span id="l76.211">       else</span>
<a href="#l76.212"></a><span id="l76.212">         newFolder = parentFolder.addSubfolder(newName);</span>
<a href="#l76.213"></a><span id="l76.213" class="difflineat">@@ -924,20 +924,20 @@ function  CreateVirtualFolder(newName, p</span>
<a href="#l76.214"></a><span id="l76.214">       accountManager.saveVirtualFolders();</span>
<a href="#l76.215"></a><span id="l76.215">     }</span>
<a href="#l76.216"></a><span id="l76.216">     catch(e)</span>
<a href="#l76.217"></a><span id="l76.217">     {</span>
<a href="#l76.218"></a><span id="l76.218">       throw(e); // so that the dialog does not automatically close</span>
<a href="#l76.219"></a><span id="l76.219">       dump (&quot;Exception : creating virtual folder \n&quot;);</span>
<a href="#l76.220"></a><span id="l76.220">     }</span>
<a href="#l76.221"></a><span id="l76.221">   }</span>
<a href="#l76.222"></a><span id="l76.222" class="difflineminus">-  else </span>
<a href="#l76.223"></a><span id="l76.223" class="difflineplus">+  else</span>
<a href="#l76.224"></a><span id="l76.224">   {</span>
<a href="#l76.225"></a><span id="l76.225">     dump(&quot;no name or nothing selected\n&quot;);</span>
<a href="#l76.226"></a><span id="l76.226" class="difflineminus">-  }   </span>
<a href="#l76.227"></a><span id="l76.227" class="difflineplus">+  }</span>
<a href="#l76.228"></a><span id="l76.228"> }</span>
<a href="#l76.229"></a><span id="l76.229"> </span>
<a href="#l76.230"></a><span id="l76.230"> var searchSessionContractID = &quot;@mozilla.org/messenger/searchSession;1&quot;;</span>
<a href="#l76.231"></a><span id="l76.231"> var gSearchView;</span>
<a href="#l76.232"></a><span id="l76.232"> var gSearchSession;</span>
<a href="#l76.233"></a><span id="l76.233"> </span>
<a href="#l76.234"></a><span id="l76.234"> var nsIMsgFolder = Components.interfaces.nsIMsgFolder;</span>
<a href="#l76.235"></a><span id="l76.235"> var nsIMsgWindow = Components.interfaces.nsIMsgWindow;</span>
<a href="#l76.236"></a><span id="l76.236" class="difflineat">@@ -951,17 +951,17 @@ var gMessengerBundle = null;</span>
<a href="#l76.237"></a><span id="l76.237"> </span>
<a href="#l76.238"></a><span id="l76.238"> // Datasource search listener -- made global as it has to be registered</span>
<a href="#l76.239"></a><span id="l76.239"> // and unregistered in different functions.</span>
<a href="#l76.240"></a><span id="l76.240"> var gDataSourceSearchListener;</span>
<a href="#l76.241"></a><span id="l76.241"> var gViewSearchListener;</span>
<a href="#l76.242"></a><span id="l76.242"> </span>
<a href="#l76.243"></a><span id="l76.243"> var gMailSession;</span>
<a href="#l76.244"></a><span id="l76.244"> </span>
<a href="#l76.245"></a><span id="l76.245" class="difflineminus">-function GetScopeForFolder(folder) </span>
<a href="#l76.246"></a><span id="l76.246" class="difflineplus">+function GetScopeForFolder(folder)</span>
<a href="#l76.247"></a><span id="l76.247"> {</span>
<a href="#l76.248"></a><span id="l76.248">   return folder.server.searchScope;</span>
<a href="#l76.249"></a><span id="l76.249"> }</span>
<a href="#l76.250"></a><span id="l76.250"> </span>
<a href="#l76.251"></a><span id="l76.251"> function setupXFVirtualFolderSearch(folderUrisToSearch, searchTerms, searchOnline)</span>
<a href="#l76.252"></a><span id="l76.252"> {</span>
<a href="#l76.253"></a><span id="l76.253">     var count = new Object;</span>
<a href="#l76.254"></a><span id="l76.254">   var i;</span>
<a href="#l76.255"></a><span id="l76.255" class="difflineat">@@ -983,26 +983,26 @@ function setupXFVirtualFolderSearch(fold</span>
<a href="#l76.256"></a><span id="l76.256">     for (let term in fixIterator(termsArray, nsIMsgSearchTerm)) {</span>
<a href="#l76.257"></a><span id="l76.257">       gSearchSession.appendTerm(term);</span>
<a href="#l76.258"></a><span id="l76.258">     }</span>
<a href="#l76.259"></a><span id="l76.259"> }</span>
<a href="#l76.260"></a><span id="l76.260"> </span>
<a href="#l76.261"></a><span id="l76.261"> function CreateGroupedSearchTerms(searchTermsArray)</span>
<a href="#l76.262"></a><span id="l76.262"> {</span>
<a href="#l76.263"></a><span id="l76.263"> </span>
<a href="#l76.264"></a><span id="l76.264" class="difflineminus">-  var searchSession = gSearchSession || </span>
<a href="#l76.265"></a><span id="l76.265" class="difflineplus">+  var searchSession = gSearchSession ||</span>
<a href="#l76.266"></a><span id="l76.266">     Components.classes[searchSessionContractID].createInstance(Components.interfaces.nsIMsgSearchSession);</span>
<a href="#l76.267"></a><span id="l76.267"> </span>
<a href="#l76.268"></a><span id="l76.268">   // create a temporary isupports array to store our search terms</span>
<a href="#l76.269"></a><span id="l76.269">   // since we will be modifying the terms so they work with quick search</span>
<a href="#l76.270"></a><span id="l76.270">   var searchTermsArrayForQS = Components.classes[&quot;@mozilla.org/supports-array;1&quot;].createInstance(Components.interfaces.nsISupportsArray);</span>
<a href="#l76.271"></a><span id="l76.271" class="difflineminus">-  </span>
<a href="#l76.272"></a><span id="l76.272" class="difflineplus">+</span>
<a href="#l76.273"></a><span id="l76.273">   var numEntries = searchTermsArray.Count();</span>
<a href="#l76.274"></a><span id="l76.274">   for (var i = 0; i &lt; numEntries; i++) {</span>
<a href="#l76.275"></a><span id="l76.275" class="difflineminus">-    var searchTerm = searchTermsArray.GetElementAt(i).QueryInterface(Components.interfaces.nsIMsgSearchTerm); </span>
<a href="#l76.276"></a><span id="l76.276" class="difflineplus">+    var searchTerm = searchTermsArray.GetElementAt(i).QueryInterface(Components.interfaces.nsIMsgSearchTerm);</span>
<a href="#l76.277"></a><span id="l76.277"> </span>
<a href="#l76.278"></a><span id="l76.278">     // clone the term, since we might be modifying it</span>
<a href="#l76.279"></a><span id="l76.279">     var searchTermForQS = searchSession.createTerm();</span>
<a href="#l76.280"></a><span id="l76.280">     searchTermForQS.value = searchTerm.value;</span>
<a href="#l76.281"></a><span id="l76.281">     searchTermForQS.attrib = searchTerm.attrib;</span>
<a href="#l76.282"></a><span id="l76.282">     searchTermForQS.arbitraryHeader = searchTerm.arbitraryHeader</span>
<a href="#l76.283"></a><span id="l76.283">     searchTermForQS.hdrProperty = searchTerm.hdrProperty;</span>
<a href="#l76.284"></a><span id="l76.284">     searchTermForQS.customId = searchTerm.customId</span>
<a href="#l76.285"></a><span id="l76.285" class="difflineat">@@ -1010,18 +1010,18 @@ function CreateGroupedSearchTerms(search</span>
<a href="#l76.286"></a><span id="l76.286"> </span>
<a href="#l76.287"></a><span id="l76.287">     // mark the first node as a group</span>
<a href="#l76.288"></a><span id="l76.288">     if (i == 0)</span>
<a href="#l76.289"></a><span id="l76.289">       searchTermForQS.beginsGrouping = true;</span>
<a href="#l76.290"></a><span id="l76.290">     else if (i == numEntries - 1)</span>
<a href="#l76.291"></a><span id="l76.291">       searchTermForQS.endsGrouping = true;</span>
<a href="#l76.292"></a><span id="l76.292"> </span>
<a href="#l76.293"></a><span id="l76.293">     // turn the first term to true to work with quick search...</span>
<a href="#l76.294"></a><span id="l76.294" class="difflineminus">-    searchTermForQS.booleanAnd = i ? searchTerm.booleanAnd : true; </span>
<a href="#l76.295"></a><span id="l76.295" class="difflineminus">-    </span>
<a href="#l76.296"></a><span id="l76.296" class="difflineplus">+    searchTermForQS.booleanAnd = i ? searchTerm.booleanAnd : true;</span>
<a href="#l76.297"></a><span id="l76.297" class="difflineplus">+</span>
<a href="#l76.298"></a><span id="l76.298">     searchTermsArrayForQS.AppendElement(searchTermForQS);</span>
<a href="#l76.299"></a><span id="l76.299">   }</span>
<a href="#l76.300"></a><span id="l76.300">   return searchTermsArrayForQS;</span>
<a href="#l76.301"></a><span id="l76.301"> }</span>
<a href="#l76.302"></a><span id="l76.302"> </span>
<a href="#l76.303"></a><span id="l76.303"> function OnLeavingFolder(aFolder)</span>
<a href="#l76.304"></a><span id="l76.304"> {</span>
<a href="#l76.305"></a><span id="l76.305">   try</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l77.1"></a><span id="l77.1" class="difflineminus">--- a/suite/mailnews/compose/MsgComposeCommands.js</span>
<a href="#l77.2"></a><span id="l77.2" class="difflineplus">+++ b/suite/mailnews/compose/MsgComposeCommands.js</span>
<a href="#l77.3"></a><span id="l77.3" class="difflineat">@@ -2132,37 +2132,37 @@ function ComposeCanClose()</span>
<a href="#l77.4"></a><span id="l77.4">         gCloseWindowAfterSave = true;</span>
<a href="#l77.5"></a><span id="l77.5">         GenericSendMessage(nsIMsgCompDeliverMode.AutoSaveAsDraft);</span>
<a href="#l77.6"></a><span id="l77.6">         return false;</span>
<a href="#l77.7"></a><span id="l77.7">       case 1: //Cancel</span>
<a href="#l77.8"></a><span id="l77.8">         return false;</span>
<a href="#l77.9"></a><span id="l77.9">       case 2: //Don't Save</span>
<a href="#l77.10"></a><span id="l77.10">         // only delete the draft if we didn't start off editing a draft</span>
<a href="#l77.11"></a><span id="l77.11">         if (!gEditingDraft &amp;&amp; gAutoSaveKickedIn)</span>
<a href="#l77.12"></a><span id="l77.12" class="difflineminus">-          RemoveDraft();            </span>
<a href="#l77.13"></a><span id="l77.13" class="difflineplus">+          RemoveDraft();</span>
<a href="#l77.14"></a><span id="l77.14">         break;</span>
<a href="#l77.15"></a><span id="l77.15">     }</span>
<a href="#l77.16"></a><span id="l77.16">   }</span>
<a href="#l77.17"></a><span id="l77.17"> </span>
<a href="#l77.18"></a><span id="l77.18">   return true;</span>
<a href="#l77.19"></a><span id="l77.19"> }</span>
<a href="#l77.20"></a><span id="l77.20"> </span>
<a href="#l77.21"></a><span id="l77.21"> function RemoveDraft()</span>
<a href="#l77.22"></a><span id="l77.22"> {</span>
<a href="#l77.23"></a><span id="l77.23">   try</span>
<a href="#l77.24"></a><span id="l77.24">   {</span>
<a href="#l77.25"></a><span id="l77.25">     var draftId = gMsgCompose.compFields.draftId;</span>
<a href="#l77.26"></a><span id="l77.26">     var msgKey = draftId.substr(draftId.indexOf('#') + 1);</span>
<a href="#l77.27"></a><span id="l77.27">     var folder = sRDF.GetResource(gMsgCompose.savedFolderURI);</span>
<a href="#l77.28"></a><span id="l77.28">     try {</span>
<a href="#l77.29"></a><span id="l77.29" class="difflineminus">-      if (folder instanceof Components.interfaces.nsIMsgFolder) </span>
<a href="#l77.30"></a><span id="l77.30" class="difflineplus">+      if (folder instanceof Components.interfaces.nsIMsgFolder)</span>
<a href="#l77.31"></a><span id="l77.31">       {</span>
<a href="#l77.32"></a><span id="l77.32">         var msgs = Components.classes[&quot;@mozilla.org/array;1&quot;]</span>
<a href="#l77.33"></a><span id="l77.33">                              .createInstance(Components.interfaces.nsIMutableArray);</span>
<a href="#l77.34"></a><span id="l77.34" class="difflineminus">-        msgs.appendElement(folder.GetMessageHeader(msgKey), false);    </span>
<a href="#l77.35"></a><span id="l77.35" class="difflineplus">+        msgs.appendElement(folder.GetMessageHeader(msgKey), false);</span>
<a href="#l77.36"></a><span id="l77.36">         folder.deleteMessages(msgs, null, true, false, null, false);</span>
<a href="#l77.37"></a><span id="l77.37">       }</span>
<a href="#l77.38"></a><span id="l77.38">     }</span>
<a href="#l77.39"></a><span id="l77.39">     catch (ex) // couldn't find header - perhaps an imap folder.</span>
<a href="#l77.40"></a><span id="l77.40">     {</span>
<a href="#l77.41"></a><span id="l77.41">       if (folder instanceof Components.interfaces.nsIMsgImapMailFolder)</span>
<a href="#l77.42"></a><span id="l77.42">       {</span>
<a href="#l77.43"></a><span id="l77.43">         const kImapMsgDeletedFlag = 0x0008;</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l78.1"></a><span id="l78.1" class="difflineminus">--- a/suite/mailnews/mail-offline.js</span>
<a href="#l78.2"></a><span id="l78.2" class="difflineplus">+++ b/suite/mailnews/mail-offline.js</span>
<a href="#l78.3"></a><span id="l78.3" class="difflineat">@@ -23,37 +23,37 @@ function CheckForUnsentMessages()</span>
<a href="#l78.4"></a><span id="l78.4">   return Components.classes[&quot;@mozilla.org/messengercompose/sendlater;1&quot;]</span>
<a href="#l78.5"></a><span id="l78.5">                    .getService(Components.interfaces.nsIMsgSendLater)</span>
<a href="#l78.6"></a><span id="l78.6">                    .hasUnsentMessages();</span>
<a href="#l78.7"></a><span id="l78.7"> }</span>
<a href="#l78.8"></a><span id="l78.8"> </span>
<a href="#l78.9"></a><span id="l78.9"> // Init strings.</span>
<a href="#l78.10"></a><span id="l78.10"> function InitPrompts()</span>
<a href="#l78.11"></a><span id="l78.11"> {</span>
<a href="#l78.12"></a><span id="l78.12" class="difflineminus">-  if (!gOfflinePromptsBundle) </span>
<a href="#l78.13"></a><span id="l78.13" class="difflineplus">+  if (!gOfflinePromptsBundle)</span>
<a href="#l78.14"></a><span id="l78.14">     gOfflinePromptsBundle = document.getElementById(&quot;bundle_offlinePrompts&quot;);</span>
<a href="#l78.15"></a><span id="l78.15"> }</span>
<a href="#l78.16"></a><span id="l78.16"> </span>
<a href="#l78.17"></a><span id="l78.17"> // prompt for sending messages while going online, and go online.</span>
<a href="#l78.18"></a><span id="l78.18"> function PromptSendMessages()</span>
<a href="#l78.19"></a><span id="l78.19"> {</span>
<a href="#l78.20"></a><span id="l78.20">   InitPrompts();</span>
<a href="#l78.21"></a><span id="l78.21">   InitServices();</span>
<a href="#l78.22"></a><span id="l78.22"> </span>
<a href="#l78.23"></a><span id="l78.23">   var checkValue = {value:true};</span>
<a href="#l78.24"></a><span id="l78.24">   var buttonPressed = Services.prompt.confirmEx(</span>
<a href="#l78.25"></a><span id="l78.25">       window,</span>
<a href="#l78.26"></a><span id="l78.26" class="difflineminus">-      gOfflinePromptsBundle.getString('sendMessagesWindowTitle'), </span>
<a href="#l78.27"></a><span id="l78.27" class="difflineplus">+      gOfflinePromptsBundle.getString('sendMessagesWindowTitle'),</span>
<a href="#l78.28"></a><span id="l78.28">       gOfflinePromptsBundle.getString('sendMessagesLabel2'),</span>
<a href="#l78.29"></a><span id="l78.29" class="difflineminus">-      Services.prompt.BUTTON_TITLE_IS_STRING * (Services.prompt.BUTTON_POS_0 + </span>
<a href="#l78.30"></a><span id="l78.30" class="difflineplus">+      Services.prompt.BUTTON_TITLE_IS_STRING * (Services.prompt.BUTTON_POS_0 +</span>
<a href="#l78.31"></a><span id="l78.31">       Services.prompt.BUTTON_POS_1 + Services.prompt.BUTTON_POS_2),</span>
<a href="#l78.32"></a><span id="l78.32">       gOfflinePromptsBundle.getString('sendMessagesSendButtonLabel'),</span>
<a href="#l78.33"></a><span id="l78.33">       gOfflinePromptsBundle.getString('sendMessagesCancelButtonLabel'),</span>
<a href="#l78.34"></a><span id="l78.34">       gOfflinePromptsBundle.getString('sendMessagesNoSendButtonLabel'),</span>
<a href="#l78.35"></a><span id="l78.35" class="difflineminus">-      gOfflinePromptsBundle.getString('sendMessagesCheckboxLabel'), </span>
<a href="#l78.36"></a><span id="l78.36" class="difflineplus">+      gOfflinePromptsBundle.getString('sendMessagesCheckboxLabel'),</span>
<a href="#l78.37"></a><span id="l78.37">       checkValue);</span>
<a href="#l78.38"></a><span id="l78.38">   switch (buttonPressed) {</span>
<a href="#l78.39"></a><span id="l78.39">     case 0:</span>
<a href="#l78.40"></a><span id="l78.40">       Services.prefs.setIntPref(&quot;offline.send.unsent_messages&quot;, !checkValue.value);</span>
<a href="#l78.41"></a><span id="l78.41">       gOfflineManager.goOnline(true, true, msgWindow);</span>
<a href="#l78.42"></a><span id="l78.42">       return true;</span>
<a href="#l78.43"></a><span id="l78.43"> </span>
<a href="#l78.44"></a><span id="l78.44">     case 2:</span>
<a href="#l78.45"></a><span id="l78.45" class="difflineat">@@ -67,25 +67,25 @@ function PromptSendMessages()</span>
<a href="#l78.46"></a><span id="l78.46"> // prompt for downlading messages while going offline, and synchronise</span>
<a href="#l78.47"></a><span id="l78.47"> function PromptDownloadMessages()</span>
<a href="#l78.48"></a><span id="l78.48"> {</span>
<a href="#l78.49"></a><span id="l78.49">   InitPrompts();</span>
<a href="#l78.50"></a><span id="l78.50">   InitServices();</span>
<a href="#l78.51"></a><span id="l78.51"> </span>
<a href="#l78.52"></a><span id="l78.52">   var checkValue = {value:true};</span>
<a href="#l78.53"></a><span id="l78.53">   var buttonPressed = Services.prompt.confirmEx(</span>
<a href="#l78.54"></a><span id="l78.54" class="difflineminus">-    window, </span>
<a href="#l78.55"></a><span id="l78.55" class="difflineminus">-    gOfflinePromptsBundle.getString('downloadMessagesWindowTitle'), </span>
<a href="#l78.56"></a><span id="l78.56" class="difflineplus">+    window,</span>
<a href="#l78.57"></a><span id="l78.57" class="difflineplus">+    gOfflinePromptsBundle.getString('downloadMessagesWindowTitle'),</span>
<a href="#l78.58"></a><span id="l78.58">     gOfflinePromptsBundle.getString('downloadMessagesLabel'),</span>
<a href="#l78.59"></a><span id="l78.59" class="difflineminus">-    Services.prompt.BUTTON_TITLE_IS_STRING * (Services.prompt.BUTTON_POS_0 + </span>
<a href="#l78.60"></a><span id="l78.60" class="difflineplus">+    Services.prompt.BUTTON_TITLE_IS_STRING * (Services.prompt.BUTTON_POS_0 +</span>
<a href="#l78.61"></a><span id="l78.61">     Services.prompt.BUTTON_POS_1 + Services.prompt.BUTTON_POS_2),</span>
<a href="#l78.62"></a><span id="l78.62">     gOfflinePromptsBundle.getString('downloadMessagesDownloadButtonLabel'),</span>
<a href="#l78.63"></a><span id="l78.63">     gOfflinePromptsBundle.getString('downloadMessagesCancelButtonLabel'),</span>
<a href="#l78.64"></a><span id="l78.64" class="difflineminus">-    gOfflinePromptsBundle.getString('downloadMessagesNoDownloadButtonLabel'), </span>
<a href="#l78.65"></a><span id="l78.65" class="difflineminus">-    gOfflinePromptsBundle.getString('downloadMessagesCheckboxLabel'), </span>
<a href="#l78.66"></a><span id="l78.66" class="difflineplus">+    gOfflinePromptsBundle.getString('downloadMessagesNoDownloadButtonLabel'),</span>
<a href="#l78.67"></a><span id="l78.67" class="difflineplus">+    gOfflinePromptsBundle.getString('downloadMessagesCheckboxLabel'),</span>
<a href="#l78.68"></a><span id="l78.68">     checkValue);</span>
<a href="#l78.69"></a><span id="l78.69">   switch (buttonPressed) {</span>
<a href="#l78.70"></a><span id="l78.70">     case 0:</span>
<a href="#l78.71"></a><span id="l78.71">       Services.prefs.setIntPref(&quot;offline.download.download_messages&quot;, !checkValue.value);</span>
<a href="#l78.72"></a><span id="l78.72">       gOfflineManager.synchronizeForOffline(true, true, false, true, msgWindow);</span>
<a href="#l78.73"></a><span id="l78.73">       return true;</span>
<a href="#l78.74"></a><span id="l78.74"> </span>
<a href="#l78.75"></a><span id="l78.75">     case 2:</span>
<a href="#l78.76"></a><span id="l78.76" class="difflineat">@@ -94,56 +94,56 @@ function PromptDownloadMessages()</span>
<a href="#l78.77"></a><span id="l78.77">       return true;</span>
<a href="#l78.78"></a><span id="l78.78">   }</span>
<a href="#l78.79"></a><span id="l78.79">   return false;</span>
<a href="#l78.80"></a><span id="l78.80"> }</span>
<a href="#l78.81"></a><span id="l78.81"> </span>
<a href="#l78.82"></a><span id="l78.82"> // Init Pref Service &amp; Offline Manager</span>
<a href="#l78.83"></a><span id="l78.83"> function InitServices()</span>
<a href="#l78.84"></a><span id="l78.84"> {</span>
<a href="#l78.85"></a><span id="l78.85" class="difflineminus">-  if (!gOfflineManager) </span>
<a href="#l78.86"></a><span id="l78.86" class="difflineplus">+  if (!gOfflineManager)</span>
<a href="#l78.87"></a><span id="l78.87">     GetOfflineMgrService();</span>
<a href="#l78.88"></a><span id="l78.88"> }</span>
<a href="#l78.89"></a><span id="l78.89"> </span>
<a href="#l78.90"></a><span id="l78.90"> // Init Offline Manager</span>
<a href="#l78.91"></a><span id="l78.91"> function GetOfflineMgrService()</span>
<a href="#l78.92"></a><span id="l78.92"> {</span>
<a href="#l78.93"></a><span id="l78.93">   if (!gOfflineManager) {</span>
<a href="#l78.94"></a><span id="l78.94" class="difflineminus">-    gOfflineManager = Components.classes[&quot;@mozilla.org/messenger/offline-manager;1&quot;]                 </span>
<a href="#l78.95"></a><span id="l78.95" class="difflineplus">+    gOfflineManager = Components.classes[&quot;@mozilla.org/messenger/offline-manager;1&quot;]</span>
<a href="#l78.96"></a><span id="l78.96">         .getService(Components.interfaces.nsIMsgOfflineManager);</span>
<a href="#l78.97"></a><span id="l78.97">   }</span>
<a href="#l78.98"></a><span id="l78.98"> }</span>
<a href="#l78.99"></a><span id="l78.99"> </span>
<a href="#l78.100"></a><span id="l78.100"> // This function must always return false to prevent toggling of offline state because</span>
<a href="#l78.101"></a><span id="l78.101"> // we change the offline state ourselves</span>
<a href="#l78.102"></a><span id="l78.102"> function MailCheckBeforeOfflineChange()</span>
<a href="#l78.103"></a><span id="l78.103"> {</span>
<a href="#l78.104"></a><span id="l78.104">   InitServices();</span>
<a href="#l78.105"></a><span id="l78.105"> </span>
<a href="#l78.106"></a><span id="l78.106"> </span>
<a href="#l78.107"></a><span id="l78.107">   if (Services.io.offline) {</span>
<a href="#l78.108"></a><span id="l78.108">     switch(Services.prefs.getIntPref(&quot;offline.send.unsent_messages&quot;)) {</span>
<a href="#l78.109"></a><span id="l78.109">     case 0:</span>
<a href="#l78.110"></a><span id="l78.110" class="difflineminus">-      if(CheckForUnsentMessages()) { </span>
<a href="#l78.111"></a><span id="l78.111" class="difflineminus">-        if(! PromptSendMessages()) </span>
<a href="#l78.112"></a><span id="l78.112" class="difflineplus">+      if(CheckForUnsentMessages()) {</span>
<a href="#l78.113"></a><span id="l78.113" class="difflineplus">+        if(! PromptSendMessages())</span>
<a href="#l78.114"></a><span id="l78.114">           return false;</span>
<a href="#l78.115"></a><span id="l78.115">       }</span>
<a href="#l78.116"></a><span id="l78.116" class="difflineminus">-      else </span>
<a href="#l78.117"></a><span id="l78.117" class="difflineminus">-        gOfflineManager.goOnline(false /* sendUnsentMessages */, </span>
<a href="#l78.118"></a><span id="l78.118" class="difflineminus">-                                 true /* playbackOfflineImapOperations */, </span>
<a href="#l78.119"></a><span id="l78.119" class="difflineplus">+      else</span>
<a href="#l78.120"></a><span id="l78.120" class="difflineplus">+        gOfflineManager.goOnline(false /* sendUnsentMessages */,</span>
<a href="#l78.121"></a><span id="l78.121" class="difflineplus">+                                 true /* playbackOfflineImapOperations */,</span>
<a href="#l78.122"></a><span id="l78.122">                                  msgWindow);</span>
<a href="#l78.123"></a><span id="l78.123">       break;</span>
<a href="#l78.124"></a><span id="l78.124">     case 1:</span>
<a href="#l78.125"></a><span id="l78.125" class="difflineminus">-      gOfflineManager.goOnline(CheckForUnsentMessages() /* sendUnsentMessages */, </span>
<a href="#l78.126"></a><span id="l78.126" class="difflineminus">-                               true  /* playbackOfflineImapOperations */, </span>
<a href="#l78.127"></a><span id="l78.127" class="difflineplus">+      gOfflineManager.goOnline(CheckForUnsentMessages() /* sendUnsentMessages */,</span>
<a href="#l78.128"></a><span id="l78.128" class="difflineplus">+                               true  /* playbackOfflineImapOperations */,</span>
<a href="#l78.129"></a><span id="l78.129">                                msgWindow);</span>
<a href="#l78.130"></a><span id="l78.130">       break;</span>
<a href="#l78.131"></a><span id="l78.131">     case 2:</span>
<a href="#l78.132"></a><span id="l78.132" class="difflineminus">-      gOfflineManager.goOnline(false /* sendUnsentMessages */, </span>
<a href="#l78.133"></a><span id="l78.133" class="difflineminus">-                               true /* playbackOfflineImapOperations */, </span>
<a href="#l78.134"></a><span id="l78.134" class="difflineplus">+      gOfflineManager.goOnline(false /* sendUnsentMessages */,</span>
<a href="#l78.135"></a><span id="l78.135" class="difflineplus">+                               true /* playbackOfflineImapOperations */,</span>
<a href="#l78.136"></a><span id="l78.136">                                msgWindow);</span>
<a href="#l78.137"></a><span id="l78.137">       break;</span>
<a href="#l78.138"></a><span id="l78.138">     }</span>
<a href="#l78.139"></a><span id="l78.139">   }</span>
<a href="#l78.140"></a><span id="l78.140">   else {</span>
<a href="#l78.141"></a><span id="l78.141">     // going offline</span>
<a href="#l78.142"></a><span id="l78.142">     switch(Services.prefs.getIntPref(&quot;offline.download.download_messages&quot;)) {</span>
<a href="#l78.143"></a><span id="l78.143">       case 0:</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l79.1"></a><span id="l79.1" class="difflineminus">--- a/suite/mailnews/mail3PaneWindowCommands.js</span>
<a href="#l79.2"></a><span id="l79.2" class="difflineplus">+++ b/suite/mailnews/mail3PaneWindowCommands.js</span>
<a href="#l79.3"></a><span id="l79.3" class="difflineat">@@ -14,17 +14,17 @@ var FolderPaneController =</span>
<a href="#l79.4"></a><span id="l79.4"> 			case &quot;cmd_shiftDelete&quot;:</span>
<a href="#l79.5"></a><span id="l79.5"> 			case &quot;button_delete&quot;:</span>
<a href="#l79.6"></a><span id="l79.6"> 			case &quot;button_shiftDelete&quot;:</span>
<a href="#l79.7"></a><span id="l79.7"> 			//case &quot;cmd_selectAll&quot;: the folder pane currently only handles single selection</span>
<a href="#l79.8"></a><span id="l79.8"> 			case &quot;cmd_cut&quot;:</span>
<a href="#l79.9"></a><span id="l79.9"> 			case &quot;cmd_copy&quot;:</span>
<a href="#l79.10"></a><span id="l79.10"> 			case &quot;cmd_paste&quot;:</span>
<a href="#l79.11"></a><span id="l79.11"> 				return true;</span>
<a href="#l79.12"></a><span id="l79.12" class="difflineminus">-				</span>
<a href="#l79.13"></a><span id="l79.13" class="difflineplus">+</span>
<a href="#l79.14"></a><span id="l79.14"> 			default:</span>
<a href="#l79.15"></a><span id="l79.15"> 				return false;</span>
<a href="#l79.16"></a><span id="l79.16"> 		}</span>
<a href="#l79.17"></a><span id="l79.17"> 	},</span>
<a href="#l79.18"></a><span id="l79.18"> </span>
<a href="#l79.19"></a><span id="l79.19"> 	isCommandEnabled: function(command)</span>
<a href="#l79.20"></a><span id="l79.20"> 	{</span>
<a href="#l79.21"></a><span id="l79.21"> 		switch ( command )</span>
<a href="#l79.22"></a><span id="l79.22" class="difflineat">@@ -56,17 +56,17 @@ var FolderPaneController =</span>
<a href="#l79.23"></a><span id="l79.23"> 			     	if ( command == &quot;cmd_delete&quot; ) {</span>
<a href="#l79.24"></a><span id="l79.24"> 					      goSetMenuValue(command, 'valueNewsgroup');</span>
<a href="#l79.25"></a><span id="l79.25"> 				    	  goSetAccessKey(command, 'valueNewsgroupAccessKey');</span>
<a href="#l79.26"></a><span id="l79.26">             }</span>
<a href="#l79.27"></a><span id="l79.27">           }</span>
<a href="#l79.28"></a><span id="l79.28"> 				}</span>
<a href="#l79.29"></a><span id="l79.29"> 				catch (ex) {</span>
<a href="#l79.30"></a><span id="l79.30"> 					//dump(&quot;specialFolder failure: &quot; + ex + &quot;\n&quot;);</span>
<a href="#l79.31"></a><span id="l79.31" class="difflineminus">-				} </span>
<a href="#l79.32"></a><span id="l79.32" class="difflineplus">+				}</span>
<a href="#l79.33"></a><span id="l79.33">         if (specialFolder == &quot;Inbox&quot; || specialFolder == &quot;Trash&quot; || specialFolder == &quot;Drafts&quot; ||</span>
<a href="#l79.34"></a><span id="l79.34">             specialFolder == &quot;Sent&quot; || specialFolder == &quot;Templates&quot; || specialFolder == &quot;Outbox&quot; ||</span>
<a href="#l79.35"></a><span id="l79.35">             (specialFolder == &quot;Junk&quot; &amp;&amp; !CanRenameDeleteJunkMail(GetSelectedFolderURI())) || isServer)</span>
<a href="#l79.36"></a><span id="l79.36">           canDeleteThisFolder = false;</span>
<a href="#l79.37"></a><span id="l79.37">         else</span>
<a href="#l79.38"></a><span id="l79.38">           canDeleteThisFolder = true;</span>
<a href="#l79.39"></a><span id="l79.39">         return canDeleteThisFolder &amp;&amp; isCommandEnabled(command);</span>
<a href="#l79.40"></a><span id="l79.40">       }</span>
<a href="#l79.41"></a><span id="l79.41" class="difflineat">@@ -89,17 +89,17 @@ var FolderPaneController =</span>
<a href="#l79.42"></a><span id="l79.42"> 			case &quot;cmd_delete&quot;:</span>
<a href="#l79.43"></a><span id="l79.43"> 			case &quot;cmd_shiftDelete&quot;:</span>
<a href="#l79.44"></a><span id="l79.44"> 			case &quot;button_delete&quot;:</span>
<a href="#l79.45"></a><span id="l79.45"> 			case &quot;button_shiftDelete&quot;:</span>
<a href="#l79.46"></a><span id="l79.46"> 				MsgDeleteFolder();</span>
<a href="#l79.47"></a><span id="l79.47"> 				break;</span>
<a href="#l79.48"></a><span id="l79.48"> 		}</span>
<a href="#l79.49"></a><span id="l79.49"> 	},</span>
<a href="#l79.50"></a><span id="l79.50" class="difflineminus">-	</span>
<a href="#l79.51"></a><span id="l79.51" class="difflineplus">+</span>
<a href="#l79.52"></a><span id="l79.52"> 	onEvent: function(event)</span>
<a href="#l79.53"></a><span id="l79.53"> 	{</span>
<a href="#l79.54"></a><span id="l79.54"> 	}</span>
<a href="#l79.55"></a><span id="l79.55"> };</span>
<a href="#l79.56"></a><span id="l79.56"> </span>
<a href="#l79.57"></a><span id="l79.57"> // DefaultController object (handles commands when one of the trees does not have focus)</span>
<a href="#l79.58"></a><span id="l79.58"> var DefaultController =</span>
<a href="#l79.59"></a><span id="l79.59"> {</span>
<a href="#l79.60"></a><span id="l79.60" class="difflineat">@@ -400,17 +400,17 @@ var DefaultController =</span>
<a href="#l79.61"></a><span id="l79.61">       case &quot;cmd_previousFlaggedMsg&quot;:</span>
<a href="#l79.62"></a><span id="l79.62">         return IsViewNavigationItemEnabled();</span>
<a href="#l79.63"></a><span id="l79.63">       case &quot;cmd_viewAllMsgs&quot;:</span>
<a href="#l79.64"></a><span id="l79.64">       case &quot;cmd_viewUnreadMsgs&quot;:</span>
<a href="#l79.65"></a><span id="l79.65">       case &quot;cmd_viewIgnoredThreads&quot;:</span>
<a href="#l79.66"></a><span id="l79.66">         return gDBView;</span>
<a href="#l79.67"></a><span id="l79.67">       case &quot;cmd_viewThreadsWithUnread&quot;:</span>
<a href="#l79.68"></a><span id="l79.68">       case &quot;cmd_viewWatchedThreadsWithUnread&quot;:</span>
<a href="#l79.69"></a><span id="l79.69" class="difflineminus">-        return gDBView &amp;&amp; !(GetSelectedMsgFolders()[0].flags &amp; </span>
<a href="#l79.70"></a><span id="l79.70" class="difflineplus">+        return gDBView &amp;&amp; !(GetSelectedMsgFolders()[0].flags &amp;</span>
<a href="#l79.71"></a><span id="l79.71">                             Components.interfaces.nsMsgFolderFlags.Virtual);</span>
<a href="#l79.72"></a><span id="l79.72">       case &quot;cmd_stop&quot;:</span>
<a href="#l79.73"></a><span id="l79.73">         return true;</span>
<a href="#l79.74"></a><span id="l79.74">       case &quot;cmd_undo&quot;:</span>
<a href="#l79.75"></a><span id="l79.75">       case &quot;cmd_redo&quot;:</span>
<a href="#l79.76"></a><span id="l79.76">           return SetupUndoRedoCommand(command);</span>
<a href="#l79.77"></a><span id="l79.77">       case &quot;cmd_renameFolder&quot;:</span>
<a href="#l79.78"></a><span id="l79.78">         return IsRenameFolderEnabled();</span>
<a href="#l79.79"></a><span id="l79.79" class="difflineat">@@ -504,17 +504,17 @@ var DefaultController =</span>
<a href="#l79.80"></a><span id="l79.80"> 			case &quot;cmd_forwardAttachment&quot;:</span>
<a href="#l79.81"></a><span id="l79.81"> 				MsgForwardAsAttachment(null);</span>
<a href="#l79.82"></a><span id="l79.82"> 				break;</span>
<a href="#l79.83"></a><span id="l79.83"> 			case &quot;cmd_editAsNew&quot;:</span>
<a href="#l79.84"></a><span id="l79.84"> 				MsgEditMessageAsNew();</span>
<a href="#l79.85"></a><span id="l79.85"> 				break;</span>
<a href="#l79.86"></a><span id="l79.86">       case &quot;cmd_createFilterFromMenu&quot;:</span>
<a href="#l79.87"></a><span id="l79.87">         MsgCreateFilter();</span>
<a href="#l79.88"></a><span id="l79.88" class="difflineminus">-        break;   </span>
<a href="#l79.89"></a><span id="l79.89" class="difflineplus">+        break;</span>
<a href="#l79.90"></a><span id="l79.90">       case &quot;cmd_createFilterFromPopup&quot;:</span>
<a href="#l79.91"></a><span id="l79.91">         CreateFilter(document.popupNode);</span>
<a href="#l79.92"></a><span id="l79.92">         break;</span>
<a href="#l79.93"></a><span id="l79.93">       case &quot;cmd_delete&quot;:</span>
<a href="#l79.94"></a><span id="l79.94">       case &quot;button_delete&quot;:</span>
<a href="#l79.95"></a><span id="l79.95">         MsgDeleteMessage(false);</span>
<a href="#l79.96"></a><span id="l79.96">         UpdateDeleteToolbarButton(false);</span>
<a href="#l79.97"></a><span id="l79.97">         break;</span>
<a href="#l79.98"></a><span id="l79.98" class="difflineat">@@ -726,17 +726,17 @@ var DefaultController =</span>
<a href="#l79.99"></a><span id="l79.99">             case &quot;cmd_selectThread&quot;:</span>
<a href="#l79.100"></a><span id="l79.100">                 gDBView.doCommand(nsMsgViewCommandType.selectThread);</span>
<a href="#l79.101"></a><span id="l79.101">                 break;</span>
<a href="#l79.102"></a><span id="l79.102">       case &quot;cmd_selectFlagged&quot;:</span>
<a href="#l79.103"></a><span id="l79.103">         gDBView.doCommand(nsMsgViewCommandType.selectFlagged);</span>
<a href="#l79.104"></a><span id="l79.104">         break;</span>
<a href="#l79.105"></a><span id="l79.105"> 		}</span>
<a href="#l79.106"></a><span id="l79.106"> 	},</span>
<a href="#l79.107"></a><span id="l79.107" class="difflineminus">-	</span>
<a href="#l79.108"></a><span id="l79.108" class="difflineplus">+</span>
<a href="#l79.109"></a><span id="l79.109"> 	onEvent: function(event)</span>
<a href="#l79.110"></a><span id="l79.110"> 	{</span>
<a href="#l79.111"></a><span id="l79.111"> 		// on blur events set the menu item texts back to the normal values</span>
<a href="#l79.112"></a><span id="l79.112"> 		if ( event == 'blur' )</span>
<a href="#l79.113"></a><span id="l79.113">         {</span>
<a href="#l79.114"></a><span id="l79.114">             goSetMenuValue('cmd_undo', 'valueDefault');</span>
<a href="#l79.115"></a><span id="l79.115">             goSetMenuValue('cmd_redo', 'valueDefault');</span>
<a href="#l79.116"></a><span id="l79.116">         }</span>
<a href="#l79.117"></a><span id="l79.117" class="difflineat">@@ -755,26 +755,26 @@ function GetNumSelectedMessages()</span>
<a href="#l79.118"></a><span id="l79.118"> </span>
<a href="#l79.119"></a><span id="l79.119"> var gLastFocusedElement=null;</span>
<a href="#l79.120"></a><span id="l79.120"> </span>
<a href="#l79.121"></a><span id="l79.121"> function FocusRingUpdate_Mail()</span>
<a href="#l79.122"></a><span id="l79.122"> {</span>
<a href="#l79.123"></a><span id="l79.123">   // WhichPaneHasFocus() uses on top.document.commandDispatcher.focusedElement</span>
<a href="#l79.124"></a><span id="l79.124">   // to determine which pane has focus</span>
<a href="#l79.125"></a><span id="l79.125">   // if the focusedElement is null, we're here on a blur.</span>
<a href="#l79.126"></a><span id="l79.126" class="difflineminus">-  // nsFocusController::Blur() calls nsFocusController::SetFocusedElement(null), </span>
<a href="#l79.127"></a><span id="l79.127" class="difflineplus">+  // nsFocusController::Blur() calls nsFocusController::SetFocusedElement(null),</span>
<a href="#l79.128"></a><span id="l79.128">   // which will update any commands listening for &quot;focus&quot;.</span>
<a href="#l79.129"></a><span id="l79.129" class="difflineminus">-  // we really only care about nsFocusController::Focus() happens, </span>
<a href="#l79.130"></a><span id="l79.130" class="difflineplus">+  // we really only care about nsFocusController::Focus() happens,</span>
<a href="#l79.131"></a><span id="l79.131">   // which calls nsFocusController::SetFocusedElement(element)</span>
<a href="#l79.132"></a><span id="l79.132">   var currentFocusedElement = WhichPaneHasFocus();</span>
<a href="#l79.133"></a><span id="l79.133" class="difflineminus">-      </span>
<a href="#l79.134"></a><span id="l79.134" class="difflineplus">+</span>
<a href="#l79.135"></a><span id="l79.135"> 	if (currentFocusedElement != gLastFocusedElement) {</span>
<a href="#l79.136"></a><span id="l79.136">     if (currentFocusedElement)</span>
<a href="#l79.137"></a><span id="l79.137">       currentFocusedElement.setAttribute(&quot;focusring&quot;, &quot;true&quot;);</span>
<a href="#l79.138"></a><span id="l79.138" class="difflineminus">-    </span>
<a href="#l79.139"></a><span id="l79.139" class="difflineplus">+</span>
<a href="#l79.140"></a><span id="l79.140">     if (gLastFocusedElement)</span>
<a href="#l79.141"></a><span id="l79.141">       gLastFocusedElement.removeAttribute(&quot;focusring&quot;);</span>
<a href="#l79.142"></a><span id="l79.142"> </span>
<a href="#l79.143"></a><span id="l79.143">     gLastFocusedElement = currentFocusedElement;</span>
<a href="#l79.144"></a><span id="l79.144"> </span>
<a href="#l79.145"></a><span id="l79.145">     // since we just changed the pane with focus we need to update the toolbar to reflect this</span>
<a href="#l79.146"></a><span id="l79.146">     // XXX TODO</span>
<a href="#l79.147"></a><span id="l79.147">     // can we optimize</span>
<a href="#l79.148"></a><span id="l79.148" class="difflineat">@@ -783,30 +783,30 @@ function FocusRingUpdate_Mail()</span>
<a href="#l79.149"></a><span id="l79.149">   }</span>
<a href="#l79.150"></a><span id="l79.150"> }</span>
<a href="#l79.151"></a><span id="l79.151"> </span>
<a href="#l79.152"></a><span id="l79.152"> function WhichPaneHasFocus()</span>
<a href="#l79.153"></a><span id="l79.153"> {</span>
<a href="#l79.154"></a><span id="l79.154">   var threadTree = GetThreadTree();</span>
<a href="#l79.155"></a><span id="l79.155">   var folderTree = GetFolderTree();</span>
<a href="#l79.156"></a><span id="l79.156">   var messagePane = GetMessagePane();</span>
<a href="#l79.157"></a><span id="l79.157" class="difflineminus">-    </span>
<a href="#l79.158"></a><span id="l79.158" class="difflineplus">+</span>
<a href="#l79.159"></a><span id="l79.159">   if (top.document.commandDispatcher.focusedWindow == GetMessagePaneFrame())</span>
<a href="#l79.160"></a><span id="l79.160">     return messagePane;</span>
<a href="#l79.161"></a><span id="l79.161"> </span>
<a href="#l79.162"></a><span id="l79.162" class="difflineminus">-	var currentNode = top.document.commandDispatcher.focusedElement;	</span>
<a href="#l79.163"></a><span id="l79.163" class="difflineplus">+	var currentNode = top.document.commandDispatcher.focusedElement;</span>
<a href="#l79.164"></a><span id="l79.164"> 	while (currentNode) {</span>
<a href="#l79.165"></a><span id="l79.165">     if (currentNode === threadTree ||</span>
<a href="#l79.166"></a><span id="l79.166">         currentNode === folderTree ||</span>
<a href="#l79.167"></a><span id="l79.167">         currentNode === messagePane)</span>
<a href="#l79.168"></a><span id="l79.168">       return currentNode;</span>
<a href="#l79.169"></a><span id="l79.169" class="difflineminus">-    			</span>
<a href="#l79.170"></a><span id="l79.170" class="difflineplus">+</span>
<a href="#l79.171"></a><span id="l79.171"> 		currentNode = currentNode.parentNode;</span>
<a href="#l79.172"></a><span id="l79.172">   }</span>
<a href="#l79.173"></a><span id="l79.173" class="difflineminus">-	</span>
<a href="#l79.174"></a><span id="l79.174" class="difflineplus">+</span>
<a href="#l79.175"></a><span id="l79.175"> 	return null;</span>
<a href="#l79.176"></a><span id="l79.176"> }</span>
<a href="#l79.177"></a><span id="l79.177"> </span>
<a href="#l79.178"></a><span id="l79.178"> function SetupCommandUpdateHandlers()</span>
<a href="#l79.179"></a><span id="l79.179"> {</span>
<a href="#l79.180"></a><span id="l79.180">   // folder pane</span>
<a href="#l79.181"></a><span id="l79.181">   var widget = GetFolderTree();</span>
<a href="#l79.182"></a><span id="l79.182">   if (widget)</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l80.1"></a><span id="l80.1" class="difflineminus">--- a/suite/mailnews/mailCommands.js</span>
<a href="#l80.2"></a><span id="l80.2" class="difflineplus">+++ b/suite/mailnews/mailCommands.js</span>
<a href="#l80.3"></a><span id="l80.3" class="difflineat">@@ -492,20 +492,20 @@ function deleteAllInFolder(commandName)</span>
<a href="#l80.4"></a><span id="l80.4"> </span>
<a href="#l80.5"></a><span id="l80.5">   if (!confirmToProceed(commandName))</span>
<a href="#l80.6"></a><span id="l80.6">     return;</span>
<a href="#l80.7"></a><span id="l80.7"> </span>
<a href="#l80.8"></a><span id="l80.8">   // Delete sub-folders.</span>
<a href="#l80.9"></a><span id="l80.9">   var iter = folder.subFolders;</span>
<a href="#l80.10"></a><span id="l80.10">   while (iter.hasMoreElements())</span>
<a href="#l80.11"></a><span id="l80.11">     folder.propagateDelete(iter.getNext(), true, msgWindow);</span>
<a href="#l80.12"></a><span id="l80.12" class="difflineminus">-  </span>
<a href="#l80.13"></a><span id="l80.13" class="difflineplus">+</span>
<a href="#l80.14"></a><span id="l80.14">   var children = Components.classes[&quot;@mozilla.org/array;1&quot;]</span>
<a href="#l80.15"></a><span id="l80.15">                   .createInstance(Components.interfaces.nsIMutableArray);</span>
<a href="#l80.16"></a><span id="l80.16" class="difflineminus">-                  </span>
<a href="#l80.17"></a><span id="l80.17" class="difflineplus">+</span>
<a href="#l80.18"></a><span id="l80.18">   // Delete messages.</span>
<a href="#l80.19"></a><span id="l80.19">   iter = folder.messages;</span>
<a href="#l80.20"></a><span id="l80.20">   while (iter.hasMoreElements()) {</span>
<a href="#l80.21"></a><span id="l80.21">     children.appendElement(iter.getNext(), false);</span>
<a href="#l80.22"></a><span id="l80.22">   }</span>
<a href="#l80.23"></a><span id="l80.23" class="difflineminus">-  folder.deleteMessages(children, msgWindow, true, false, null, false); </span>
<a href="#l80.24"></a><span id="l80.24" class="difflineplus">+  folder.deleteMessages(children, msgWindow, true, false, null, false);</span>
<a href="#l80.25"></a><span id="l80.25">   children.clear();</span>
<a href="#l80.26"></a><span id="l80.26"> }</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l81.1"></a><span id="l81.1" class="difflineminus">--- a/suite/mailnews/mailContextMenus.js</span>
<a href="#l81.2"></a><span id="l81.2" class="difflineplus">+++ b/suite/mailnews/mailContextMenus.js</span>
<a href="#l81.3"></a><span id="l81.3" class="difflineat">@@ -347,17 +347,17 @@ function SetupNewMenuItem(folder, numSel</span>
<a href="#l81.4"></a><span id="l81.4">     else</span>
<a href="#l81.5"></a><span id="l81.5">       SetMenuItemLabel(&quot;folderPaneContext-new&quot;, gMessengerBundle.getString(&quot;newSubfolder&quot;));</span>
<a href="#l81.6"></a><span id="l81.6">   }</span>
<a href="#l81.7"></a><span id="l81.7"> }</span>
<a href="#l81.8"></a><span id="l81.8"> </span>
<a href="#l81.9"></a><span id="l81.9"> function ShowMenuItem(id, showItem)</span>
<a href="#l81.10"></a><span id="l81.10"> {</span>
<a href="#l81.11"></a><span id="l81.11">   var item = document.getElementById(id);</span>
<a href="#l81.12"></a><span id="l81.12" class="difflineminus">-  if(item &amp;&amp; item.hidden != &quot;true&quot;) </span>
<a href="#l81.13"></a><span id="l81.13" class="difflineplus">+  if(item &amp;&amp; item.hidden != &quot;true&quot;)</span>
<a href="#l81.14"></a><span id="l81.14">     item.hidden = !showItem;</span>
<a href="#l81.15"></a><span id="l81.15"> }</span>
<a href="#l81.16"></a><span id="l81.16"> </span>
<a href="#l81.17"></a><span id="l81.17"> function EnableMenuItem(id, enableItem)</span>
<a href="#l81.18"></a><span id="l81.18"> {</span>
<a href="#l81.19"></a><span id="l81.19">   var item = document.getElementById(id);</span>
<a href="#l81.20"></a><span id="l81.20">   if(item)</span>
<a href="#l81.21"></a><span id="l81.21">   {</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l82.1"></a><span id="l82.1" class="difflineminus">--- a/suite/mailnews/mailTasksOverlay.js</span>
<a href="#l82.2"></a><span id="l82.2" class="difflineplus">+++ b/suite/mailnews/mailTasksOverlay.js</span>
<a href="#l82.3"></a><span id="l82.3" class="difflineat">@@ -7,29 +7,29 @@ const BIFF_TOPIC = &quot;mail:biff-state-chan</span>
<a href="#l82.4"></a><span id="l82.4"> </span>
<a href="#l82.5"></a><span id="l82.5"> // biff state constants used by themes</span>
<a href="#l82.6"></a><span id="l82.6"> const BIFF_STATE_MESSAGES   = &quot;NewMail&quot;;</span>
<a href="#l82.7"></a><span id="l82.7"> const BIFF_STATE_NOMESSAGES = &quot;NoMail&quot;;</span>
<a href="#l82.8"></a><span id="l82.8"> const BIFF_STATE_UNKNOWN    = &quot;UnknownMail&quot;;</span>
<a href="#l82.9"></a><span id="l82.9"> </span>
<a href="#l82.10"></a><span id="l82.10"> </span>
<a href="#l82.11"></a><span id="l82.11"> // uses &quot;toOpenWindowByType&quot; function provided by tasksOverlay.js</span>
<a href="#l82.12"></a><span id="l82.12" class="difflineminus">-// which is included by most clients. </span>
<a href="#l82.13"></a><span id="l82.13" class="difflineplus">+// which is included by most clients.</span>
<a href="#l82.14"></a><span id="l82.14"> function toMessengerWindow()</span>
<a href="#l82.15"></a><span id="l82.15"> {</span>
<a href="#l82.16"></a><span id="l82.16">   toOpenWindowByType(&quot;mail:3pane&quot;, &quot;chrome://messenger/content/&quot;);</span>
<a href="#l82.17"></a><span id="l82.17"> }</span>
<a href="#l82.18"></a><span id="l82.18"> </span>
<a href="#l82.19"></a><span id="l82.19" class="difflineminus">-function toAddressBook() </span>
<a href="#l82.20"></a><span id="l82.20" class="difflineplus">+function toAddressBook()</span>
<a href="#l82.21"></a><span id="l82.21"> {</span>
<a href="#l82.22"></a><span id="l82.22">   toOpenWindowByType(&quot;mail:addressbook&quot;,</span>
<a href="#l82.23"></a><span id="l82.23">                      &quot;chrome://messenger/content/addressbook/addressbook.xul&quot;);</span>
<a href="#l82.24"></a><span id="l82.24"> }</span>
<a href="#l82.25"></a><span id="l82.25"> </span>
<a href="#l82.26"></a><span id="l82.26" class="difflineminus">-function toNewsgroups() </span>
<a href="#l82.27"></a><span id="l82.27" class="difflineplus">+function toNewsgroups()</span>
<a href="#l82.28"></a><span id="l82.28"> {</span>
<a href="#l82.29"></a><span id="l82.29">   dump(&quot;Sorry, command not implemented.\n&quot;);</span>
<a href="#l82.30"></a><span id="l82.30"> }</span>
<a href="#l82.31"></a><span id="l82.31"> </span>
<a href="#l82.32"></a><span id="l82.32"> function toImport()</span>
<a href="#l82.33"></a><span id="l82.33"> {</span>
<a href="#l82.34"></a><span id="l82.34">   window.openDialog(&quot;chrome://messenger/content/importDialog.xul&quot;,</span>
<a href="#l82.35"></a><span id="l82.35">                     &quot;importDialog&quot;,</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l83.1"></a><span id="l83.1" class="difflineminus">--- a/suite/mailnews/mailViewSetup.js</span>
<a href="#l83.2"></a><span id="l83.2" class="difflineplus">+++ b/suite/mailnews/mailViewSetup.js</span>
<a href="#l83.3"></a><span id="l83.3" class="difflineat">@@ -9,103 +9,103 @@ var gMailView = null;</span>
<a href="#l83.4"></a><span id="l83.4"> var dialog;</span>
<a href="#l83.5"></a><span id="l83.5"> </span>
<a href="#l83.6"></a><span id="l83.6"> function mailViewOnLoad()</span>
<a href="#l83.7"></a><span id="l83.7"> {</span>
<a href="#l83.8"></a><span id="l83.8">   initializeSearchWidgets();</span>
<a href="#l83.9"></a><span id="l83.9">   initializeMailViewOverrides();</span>
<a href="#l83.10"></a><span id="l83.10">   dialog = {};</span>
<a href="#l83.11"></a><span id="l83.11"> </span>
<a href="#l83.12"></a><span id="l83.12" class="difflineminus">-  if (&quot;arguments&quot; in window &amp;&amp; window.arguments[0]) </span>
<a href="#l83.13"></a><span id="l83.13" class="difflineplus">+  if (&quot;arguments&quot; in window &amp;&amp; window.arguments[0])</span>
<a href="#l83.14"></a><span id="l83.14">   {</span>
<a href="#l83.15"></a><span id="l83.15">     var args = window.arguments[0];</span>
<a href="#l83.16"></a><span id="l83.16" class="difflineminus">-    if (&quot;mailView&quot; in args) </span>
<a href="#l83.17"></a><span id="l83.17" class="difflineminus">-      gMailView = window.arguments[0].mailView; </span>
<a href="#l83.18"></a><span id="l83.18" class="difflineplus">+    if (&quot;mailView&quot; in args)</span>
<a href="#l83.19"></a><span id="l83.19" class="difflineplus">+      gMailView = window.arguments[0].mailView;</span>
<a href="#l83.20"></a><span id="l83.20">     if (&quot;onOkCallback&quot; in args)</span>
<a href="#l83.21"></a><span id="l83.21">       dialog.okCallback =  window.arguments[0].onOkCallback;</span>
<a href="#l83.22"></a><span id="l83.22">   }</span>
<a href="#l83.23"></a><span id="l83.23"> </span>
<a href="#l83.24"></a><span id="l83.24">   dialog.OKButton = document.documentElement.getButton(&quot;accept&quot;);</span>
<a href="#l83.25"></a><span id="l83.25">   dialog.nameField = document.getElementById(&quot;name&quot;);</span>
<a href="#l83.26"></a><span id="l83.26">   dialog.nameField.focus();</span>
<a href="#l83.27"></a><span id="l83.27"> </span>
<a href="#l83.28"></a><span id="l83.28" class="difflineminus">-  setSearchScope(nsMsgSearchScope.offlineMail);  </span>
<a href="#l83.29"></a><span id="l83.29" class="difflineplus">+  setSearchScope(nsMsgSearchScope.offlineMail);</span>
<a href="#l83.30"></a><span id="l83.30"> </span>
<a href="#l83.31"></a><span id="l83.31">   if (gMailView)</span>
<a href="#l83.32"></a><span id="l83.32">   {</span>
<a href="#l83.33"></a><span id="l83.33">     dialog.nameField.value = gMailView.prettyName;</span>
<a href="#l83.34"></a><span id="l83.34">     initializeSearchRows(nsMsgSearchScope.offlineMail, gMailView.searchTerms);</span>
<a href="#l83.35"></a><span id="l83.35">   }</span>
<a href="#l83.36"></a><span id="l83.36">   else</span>
<a href="#l83.37"></a><span id="l83.37">     onMore(null);</span>
<a href="#l83.38"></a><span id="l83.38" class="difflineminus">- </span>
<a href="#l83.39"></a><span id="l83.39" class="difflineplus">+</span>
<a href="#l83.40"></a><span id="l83.40">   doEnabling();</span>
<a href="#l83.41"></a><span id="l83.41"> }</span>
<a href="#l83.42"></a><span id="l83.42"> </span>
<a href="#l83.43"></a><span id="l83.43"> function mailViewOnUnLoad()</span>
<a href="#l83.44"></a><span id="l83.44"> {</span>
<a href="#l83.45"></a><span id="l83.45"> </span>
<a href="#l83.46"></a><span id="l83.46"> }</span>
<a href="#l83.47"></a><span id="l83.47"> </span>
<a href="#l83.48"></a><span id="l83.48"> function onOK()</span>
<a href="#l83.49"></a><span id="l83.49"> {</span>
<a href="#l83.50"></a><span id="l83.50">   var mailViewList = Components.classes[&quot;@mozilla.org/messenger/mailviewlist;1&quot;].getService(Components.interfaces.nsIMsgMailViewList);</span>
<a href="#l83.51"></a><span id="l83.51" class="difflineminus">-  </span>
<a href="#l83.52"></a><span id="l83.52" class="difflineplus">+</span>
<a href="#l83.53"></a><span id="l83.53">   // reflect the search widgets back into the search session</span>
<a href="#l83.54"></a><span id="l83.54">   var newMailView = null;</span>
<a href="#l83.55"></a><span id="l83.55">   if (gMailView)</span>
<a href="#l83.56"></a><span id="l83.56">   {</span>
<a href="#l83.57"></a><span id="l83.57">     saveSearchTerms(gMailView.searchTerms, gMailView);</span>
<a href="#l83.58"></a><span id="l83.58">     // if the name of the view has been changed...</span>
<a href="#l83.59"></a><span id="l83.59">     if (gMailView.prettyName != dialog.nameField.value)</span>
<a href="#l83.60"></a><span id="l83.60">       gMailView.mailViewName = dialog.nameField.value;</span>
<a href="#l83.61"></a><span id="l83.61">   }</span>
<a href="#l83.62"></a><span id="l83.62" class="difflineminus">-  else  </span>
<a href="#l83.63"></a><span id="l83.63" class="difflineplus">+  else</span>
<a href="#l83.64"></a><span id="l83.64">   {</span>
<a href="#l83.65"></a><span id="l83.65" class="difflineminus">-    // otherwise, create a new mail view </span>
<a href="#l83.66"></a><span id="l83.66" class="difflineplus">+    // otherwise, create a new mail view</span>
<a href="#l83.67"></a><span id="l83.67">     newMailView = mailViewList.createMailView();</span>
<a href="#l83.68"></a><span id="l83.68"> </span>
<a href="#l83.69"></a><span id="l83.69">     saveSearchTerms(newMailView.searchTerms, newMailView);</span>
<a href="#l83.70"></a><span id="l83.70">     newMailView.mailViewName = dialog.nameField.value;</span>
<a href="#l83.71"></a><span id="l83.71">     // now add the mail view to our mail view list</span>
<a href="#l83.72"></a><span id="l83.72">     mailViewList.addMailView(newMailView);</span>
<a href="#l83.73"></a><span id="l83.73">   }</span>
<a href="#l83.74"></a><span id="l83.74" class="difflineminus">-    </span>
<a href="#l83.75"></a><span id="l83.75" class="difflineplus">+</span>
<a href="#l83.76"></a><span id="l83.76">   mailViewList.save();</span>
<a href="#l83.77"></a><span id="l83.77" class="difflineminus">- </span>
<a href="#l83.78"></a><span id="l83.78" class="difflineplus">+</span>
<a href="#l83.79"></a><span id="l83.79">   if (dialog.okCallback)</span>
<a href="#l83.80"></a><span id="l83.80">     dialog.okCallback(gMailView ? gMailView : newMailView);</span>
<a href="#l83.81"></a><span id="l83.81"> </span>
<a href="#l83.82"></a><span id="l83.82">   return true;</span>
<a href="#l83.83"></a><span id="l83.83"> }</span>
<a href="#l83.84"></a><span id="l83.84"> </span>
<a href="#l83.85"></a><span id="l83.85"> function initializeMailViewOverrides()</span>
<a href="#l83.86"></a><span id="l83.86"> {</span>
<a href="#l83.87"></a><span id="l83.87">   // replace some text with something we want. Need to add some ids to searchOverlay.js</span>
<a href="#l83.88"></a><span id="l83.88">   //var orButton = document.getElementById('or');</span>
<a href="#l83.89"></a><span id="l83.89">   //orButton.setAttribute('label', 'Any of the following');</span>
<a href="#l83.90"></a><span id="l83.90">   //var andButton = document.getElementById('and');</span>
<a href="#l83.91"></a><span id="l83.91">   //andButton.setAttribute('label', 'All of the following');</span>
<a href="#l83.92"></a><span id="l83.92">   // matchAll doesn't make sense for views, since views are a single folder</span>
<a href="#l83.93"></a><span id="l83.93">   hideMatchAllItem();</span>
<a href="#l83.94"></a><span id="l83.94" class="difflineminus">-  </span>
<a href="#l83.95"></a><span id="l83.95" class="difflineplus">+</span>
<a href="#l83.96"></a><span id="l83.96"> }</span>
<a href="#l83.97"></a><span id="l83.97"> </span>
<a href="#l83.98"></a><span id="l83.98"> function UpdateAfterCustomHeaderChange()</span>
<a href="#l83.99"></a><span id="l83.99"> {</span>
<a href="#l83.100"></a><span id="l83.100">   updateSearchAttributes();</span>
<a href="#l83.101"></a><span id="l83.101"> }</span>
<a href="#l83.102"></a><span id="l83.102"> </span>
<a href="#l83.103"></a><span id="l83.103"> function doEnabling()</span>
<a href="#l83.104"></a><span id="l83.104"> {</span>
<a href="#l83.105"></a><span id="l83.105" class="difflineminus">-  if (dialog.nameField.value) </span>
<a href="#l83.106"></a><span id="l83.106" class="difflineplus">+  if (dialog.nameField.value)</span>
<a href="#l83.107"></a><span id="l83.107">   {</span>
<a href="#l83.108"></a><span id="l83.108">     if (dialog.OKButton.disabled)</span>
<a href="#l83.109"></a><span id="l83.109">       dialog.OKButton.disabled = false;</span>
<a href="#l83.110"></a><span id="l83.110" class="difflineminus">-  } else </span>
<a href="#l83.111"></a><span id="l83.111" class="difflineplus">+  } else</span>
<a href="#l83.112"></a><span id="l83.112">   {</span>
<a href="#l83.113"></a><span id="l83.113">     if (!dialog.OKButton.disabled)</span>
<a href="#l83.114"></a><span id="l83.114">       dialog.OKButton.disabled = true;</span>
<a href="#l83.115"></a><span id="l83.115">   }</span>
<a href="#l83.116"></a><span id="l83.116"> }</span>
<a href="#l83.117"></a><span id="l83.117"> </span>
<a href="#l83.118"></a><span id="l83.118"> function onEnterInSearchTerm()</span>
<a href="#l83.119"></a><span id="l83.119"> {</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l84.1"></a><span id="l84.1" class="difflineminus">--- a/suite/mailnews/mailWindow.js</span>
<a href="#l84.2"></a><span id="l84.2" class="difflineplus">+++ b/suite/mailnews/mailWindow.js</span>
<a href="#l84.3"></a><span id="l84.3" class="difflineat">@@ -40,20 +40,20 @@ function OnMailWindowUnload()</span>
<a href="#l84.4"></a><span id="l84.4"> </span>
<a href="#l84.5"></a><span id="l84.5">   var searchSession = GetSearchSession();</span>
<a href="#l84.6"></a><span id="l84.6">   if (searchSession)</span>
<a href="#l84.7"></a><span id="l84.7">   {</span>
<a href="#l84.8"></a><span id="l84.8">     removeGlobalListeners();</span>
<a href="#l84.9"></a><span id="l84.9">     if (gPreQuickSearchView)     //close the cached pre quick search view</span>
<a href="#l84.10"></a><span id="l84.10">       gPreQuickSearchView.close();</span>
<a href="#l84.11"></a><span id="l84.11">   }</span>
<a href="#l84.12"></a><span id="l84.12" class="difflineminus">-  </span>
<a href="#l84.13"></a><span id="l84.13" class="difflineplus">+</span>
<a href="#l84.14"></a><span id="l84.14">   var dbview = GetDBView();</span>
<a href="#l84.15"></a><span id="l84.15">   if (dbview) {</span>
<a href="#l84.16"></a><span id="l84.16" class="difflineminus">-    dbview.close(); </span>
<a href="#l84.17"></a><span id="l84.17" class="difflineplus">+    dbview.close();</span>
<a href="#l84.18"></a><span id="l84.18">   }</span>
<a href="#l84.19"></a><span id="l84.19"> </span>
<a href="#l84.20"></a><span id="l84.20">   var mailSession = Components.classes[&quot;@mozilla.org/messenger/services/session;1&quot;]</span>
<a href="#l84.21"></a><span id="l84.21">                               .getService();</span>
<a href="#l84.22"></a><span id="l84.22">   if (mailSession instanceof Components.interfaces.nsIMsgMailSession)</span>
<a href="#l84.23"></a><span id="l84.23">     mailSession.RemoveFolderListener(folderListener);</span>
<a href="#l84.24"></a><span id="l84.24">   mailSession.RemoveMsgWindow(msgWindow);</span>
<a href="#l84.25"></a><span id="l84.25">   messenger.setWindow(null, null);</span>
<a href="#l84.26"></a><span id="l84.26" class="difflineat">@@ -61,17 +61,17 @@ function OnMailWindowUnload()</span>
<a href="#l84.27"></a><span id="l84.27">   msgWindow.closeWindow();</span>
<a href="#l84.28"></a><span id="l84.28"> }</span>
<a href="#l84.29"></a><span id="l84.29"> </span>
<a href="#l84.30"></a><span id="l84.30"> function CreateMailWindowGlobals()</span>
<a href="#l84.31"></a><span id="l84.31"> {</span>
<a href="#l84.32"></a><span id="l84.32">   // get the messenger instance</span>
<a href="#l84.33"></a><span id="l84.33">   messenger = Components.classes[&quot;@mozilla.org/messenger;1&quot;]</span>
<a href="#l84.34"></a><span id="l84.34">                         .createInstance(Components.interfaces.nsIMessenger);</span>
<a href="#l84.35"></a><span id="l84.35" class="difflineminus">-  </span>
<a href="#l84.36"></a><span id="l84.36" class="difflineplus">+</span>
<a href="#l84.37"></a><span id="l84.37">   //Create windows status feedback</span>
<a href="#l84.38"></a><span id="l84.38">   // set the JS implementation of status feedback before creating the c++ one..</span>
<a href="#l84.39"></a><span id="l84.39">   window.MsgStatusFeedback = new nsMsgStatusFeedback();</span>
<a href="#l84.40"></a><span id="l84.40">   // double register the status feedback object as the xul browser window implementation</span>
<a href="#l84.41"></a><span id="l84.41">   window.QueryInterface(Components.interfaces.nsIInterfaceRequestor)</span>
<a href="#l84.42"></a><span id="l84.42">         .getInterface(Components.interfaces.nsIWebNavigation)</span>
<a href="#l84.43"></a><span id="l84.43">         .QueryInterface(Components.interfaces.nsIDocShellTreeItem).treeOwner</span>
<a href="#l84.44"></a><span id="l84.44">         .QueryInterface(Components.interfaces.nsIInterfaceRequestor)</span>
<a href="#l84.45"></a><span id="l84.45" class="difflineat">@@ -115,17 +115,17 @@ function CreateMailWindowGlobals()</span>
<a href="#l84.46"></a><span id="l84.46"> </span>
<a href="#l84.47"></a><span id="l84.47">   msgWindow.notificationCallbacks = new nsMsgBadCertHandler();</span>
<a href="#l84.48"></a><span id="l84.48"> }</span>
<a href="#l84.49"></a><span id="l84.49"> </span>
<a href="#l84.50"></a><span id="l84.50"> function InitMsgWindow()</span>
<a href="#l84.51"></a><span id="l84.51"> {</span>
<a href="#l84.52"></a><span id="l84.52">   msgWindow.windowCommands = new nsMsgWindowCommands();</span>
<a href="#l84.53"></a><span id="l84.53">   // set the domWindow before setting the status feedback and header sink objects</span>
<a href="#l84.54"></a><span id="l84.54" class="difflineminus">-  msgWindow.domWindow = window;  </span>
<a href="#l84.55"></a><span id="l84.55" class="difflineplus">+  msgWindow.domWindow = window;</span>
<a href="#l84.56"></a><span id="l84.56">   msgWindow.statusFeedback = statusFeedback;</span>
<a href="#l84.57"></a><span id="l84.57">   msgWindow.msgHeaderSink = messageHeaderSink;</span>
<a href="#l84.58"></a><span id="l84.58">   mailSession.AddMsgWindow(msgWindow);</span>
<a href="#l84.59"></a><span id="l84.59"> </span>
<a href="#l84.60"></a><span id="l84.60">   var messagepane = getMessageBrowser();</span>
<a href="#l84.61"></a><span id="l84.61">   messagepane.docShell.allowAuth = false;</span>
<a href="#l84.62"></a><span id="l84.62">   messagepane.docShell.allowDNSPrefetch = false;</span>
<a href="#l84.63"></a><span id="l84.63">   msgWindow.rootDocShell.allowAuth = true;</span>
<a href="#l84.64"></a><span id="l84.64" class="difflineat">@@ -166,17 +166,17 @@ function messagePaneOnResize(event)</span>
<a href="#l84.65"></a><span id="l84.65"> </span>
<a href="#l84.66"></a><span id="l84.66"> function messagePaneOnClick(event)</span>
<a href="#l84.67"></a><span id="l84.67"> {</span>
<a href="#l84.68"></a><span id="l84.68">   // if this is stand alone mail (no browser)</span>
<a href="#l84.69"></a><span id="l84.69">   // or this isn't a simple left click, do nothing, and let the normal code execute</span>
<a href="#l84.70"></a><span id="l84.70">   if (event.button != 0 || event.metaKey || event.ctrlKey || event.shiftKey || event.altKey)</span>
<a href="#l84.71"></a><span id="l84.71">     return contentAreaClick(event);</span>
<a href="#l84.72"></a><span id="l84.72"> </span>
<a href="#l84.73"></a><span id="l84.73" class="difflineminus">-  // try to determine the href for what you are clicking on.  </span>
<a href="#l84.74"></a><span id="l84.74" class="difflineplus">+  // try to determine the href for what you are clicking on.</span>
<a href="#l84.75"></a><span id="l84.75">   // for example, it might be &quot;&quot; if you aren't left clicking on a link</span>
<a href="#l84.76"></a><span id="l84.76">   var ceParams = hrefAndLinkNodeForClickEvent(event);</span>
<a href="#l84.77"></a><span id="l84.77">   if (!ceParams &amp;&amp; !event.button)</span>
<a href="#l84.78"></a><span id="l84.78">   {</span>
<a href="#l84.79"></a><span id="l84.79">     var target = event.target;</span>
<a href="#l84.80"></a><span id="l84.80">     // is this an image that we might want to scale?</span>
<a href="#l84.81"></a><span id="l84.81">     if (target instanceof Components.interfaces.nsIImageLoadingContent)</span>
<a href="#l84.82"></a><span id="l84.82">     {</span>
<a href="#l84.83"></a><span id="l84.83" class="difflineat">@@ -202,41 +202,41 @@ function messagePaneOnClick(event)</span>
<a href="#l84.84"></a><span id="l84.84">           target.removeAttribute(&quot;overflowing&quot;);</span>
<a href="#l84.85"></a><span id="l84.85">         }</span>
<a href="#l84.86"></a><span id="l84.86">       }</span>
<a href="#l84.87"></a><span id="l84.87">     }</span>
<a href="#l84.88"></a><span id="l84.88">     return true;</span>
<a href="#l84.89"></a><span id="l84.89">   }</span>
<a href="#l84.90"></a><span id="l84.90">   var href = ceParams.href;</span>
<a href="#l84.91"></a><span id="l84.91"> </span>
<a href="#l84.92"></a><span id="l84.92" class="difflineminus">-  // we know that http://, https://, ftp://, file://, chrome://, </span>
<a href="#l84.93"></a><span id="l84.93" class="difflineminus">-  // resource://, and about, should load in a browser.  but if </span>
<a href="#l84.94"></a><span id="l84.94" class="difflineminus">-  // we don't have one of those (examples are mailto, imap, news, mailbox, snews, </span>
<a href="#l84.95"></a><span id="l84.95" class="difflineminus">-  // nntp, ldap, and externally handled schemes like aim) we may or may not </span>
<a href="#l84.96"></a><span id="l84.96" class="difflineminus">-  // want a browser window, in which case we return here and let the normal code </span>
<a href="#l84.97"></a><span id="l84.97" class="difflineplus">+  // we know that http://, https://, ftp://, file://, chrome://,</span>
<a href="#l84.98"></a><span id="l84.98" class="difflineplus">+  // resource://, and about, should load in a browser.  but if</span>
<a href="#l84.99"></a><span id="l84.99" class="difflineplus">+  // we don't have one of those (examples are mailto, imap, news, mailbox, snews,</span>
<a href="#l84.100"></a><span id="l84.100" class="difflineplus">+  // nntp, ldap, and externally handled schemes like aim) we may or may not</span>
<a href="#l84.101"></a><span id="l84.101" class="difflineplus">+  // want a browser window, in which case we return here and let the normal code</span>
<a href="#l84.102"></a><span id="l84.102">   // handle it</span>
<a href="#l84.103"></a><span id="l84.103">   var needABrowser = /(^http(s)?:|^ftp:|^file:|^chrome:|^resource:|^about:)/i;</span>
<a href="#l84.104"></a><span id="l84.104" class="difflineminus">-  if (href.search(needABrowser) == -1) </span>
<a href="#l84.105"></a><span id="l84.105" class="difflineplus">+  if (href.search(needABrowser) == -1)</span>
<a href="#l84.106"></a><span id="l84.106">     return true;</span>
<a href="#l84.107"></a><span id="l84.107"> </span>
<a href="#l84.108"></a><span id="l84.108">   // however, if the protocol should not be loaded internally, then we should</span>
<a href="#l84.109"></a><span id="l84.109">   // not put up a new browser window.  we should just let the usual processing</span>
<a href="#l84.110"></a><span id="l84.110">   // take place.</span>
<a href="#l84.111"></a><span id="l84.111">   try {</span>
<a href="#l84.112"></a><span id="l84.112">     var extProtService = Components.classes[&quot;@mozilla.org/uriloader/external-protocol-service;1&quot;]</span>
<a href="#l84.113"></a><span id="l84.113">                                    .getService(Components.interfaces.nsIExternalProtocolService);</span>
<a href="#l84.114"></a><span id="l84.114">     var scheme = href.substring(0, href.indexOf(&quot;:&quot;));</span>
<a href="#l84.115"></a><span id="l84.115">     if (!extProtService.isExposedProtocol(scheme))</span>
<a href="#l84.116"></a><span id="l84.116">       return true;</span>
<a href="#l84.117"></a><span id="l84.117" class="difflineminus">-  } </span>
<a href="#l84.118"></a><span id="l84.118" class="difflineplus">+  }</span>
<a href="#l84.119"></a><span id="l84.119">   catch (ex) {} // ignore errors, and just assume that we can proceed.</span>
<a href="#l84.120"></a><span id="l84.120"> </span>
<a href="#l84.121"></a><span id="l84.121">   // if you get here, the user did a simple left click on a link</span>
<a href="#l84.122"></a><span id="l84.122">   // that we know should be in a browser window.</span>
<a href="#l84.123"></a><span id="l84.123" class="difflineminus">-  // since we are in the message pane, send it to the top most browser window </span>
<a href="#l84.124"></a><span id="l84.124" class="difflineplus">+  // since we are in the message pane, send it to the top most browser window</span>
<a href="#l84.125"></a><span id="l84.125">   // (or open one) right away, instead of waiting for us to get some data and</span>
<a href="#l84.126"></a><span id="l84.126">   // determine the content type, and then open a browser window</span>
<a href="#l84.127"></a><span id="l84.127">   // we want to preventDefault, so that in</span>
<a href="#l84.128"></a><span id="l84.128">   // nsGenericHTMLElement::HandleDOMEventForAnchors(), we don't try to handle the click again</span>
<a href="#l84.129"></a><span id="l84.129">   event.preventDefault();</span>
<a href="#l84.130"></a><span id="l84.130">   if (isPhishingURL(ceParams.linkNode, false, href))</span>
<a href="#l84.131"></a><span id="l84.131">     return false;</span>
<a href="#l84.132"></a><span id="l84.132"> </span>
<a href="#l84.133"></a><span id="l84.133" class="difflineat">@@ -443,35 +443,35 @@ nsMsgWindowCommands.prototype =</span>
<a href="#l84.134"></a><span id="l84.134"> {</span>
<a href="#l84.135"></a><span id="l84.135">   QueryInterface : function(iid)</span>
<a href="#l84.136"></a><span id="l84.136">   {</span>
<a href="#l84.137"></a><span id="l84.137">     if (iid.equals(Components.interfaces.nsIMsgWindowCommands) ||</span>
<a href="#l84.138"></a><span id="l84.138">         iid.equals(Components.interfaces.nsISupports))</span>
<a href="#l84.139"></a><span id="l84.139">       return this;</span>
<a href="#l84.140"></a><span id="l84.140">     throw Components.results.NS_NOINTERFACE;</span>
<a href="#l84.141"></a><span id="l84.141">   },</span>
<a href="#l84.142"></a><span id="l84.142" class="difflineminus">-  </span>
<a href="#l84.143"></a><span id="l84.143" class="difflineplus">+</span>
<a href="#l84.144"></a><span id="l84.144">   selectFolder: function(folderUri)</span>
<a href="#l84.145"></a><span id="l84.145">   {</span>
<a href="#l84.146"></a><span id="l84.146">     SelectFolder(folderUri);</span>
<a href="#l84.147"></a><span id="l84.147">   },</span>
<a href="#l84.148"></a><span id="l84.148" class="difflineminus">-  </span>
<a href="#l84.149"></a><span id="l84.149" class="difflineplus">+</span>
<a href="#l84.150"></a><span id="l84.150">   selectMessage: function(messageUri)</span>
<a href="#l84.151"></a><span id="l84.151">   {</span>
<a href="#l84.152"></a><span id="l84.152">     SelectMessage(messageUri);</span>
<a href="#l84.153"></a><span id="l84.153">   },</span>
<a href="#l84.154"></a><span id="l84.154" class="difflineminus">-  </span>
<a href="#l84.155"></a><span id="l84.155" class="difflineplus">+</span>
<a href="#l84.156"></a><span id="l84.156">   clearMsgPane: function()</span>
<a href="#l84.157"></a><span id="l84.157">   {</span>
<a href="#l84.158"></a><span id="l84.158">     if (gDBView)</span>
<a href="#l84.159"></a><span id="l84.159">       setTitleFromFolder(gDBView.msgFolder,null);</span>
<a href="#l84.160"></a><span id="l84.160">     else</span>
<a href="#l84.161"></a><span id="l84.161">       setTitleFromFolder(null,null);</span>
<a href="#l84.162"></a><span id="l84.162">     ClearMessagePane();</span>
<a href="#l84.163"></a><span id="l84.163" class="difflineminus">-  }  </span>
<a href="#l84.164"></a><span id="l84.164" class="difflineplus">+  }</span>
<a href="#l84.165"></a><span id="l84.165"> }</span>
<a href="#l84.166"></a><span id="l84.166"> </span>
<a href="#l84.167"></a><span id="l84.167"> function StopUrls()</span>
<a href="#l84.168"></a><span id="l84.168"> {</span>
<a href="#l84.169"></a><span id="l84.169">   msgWindow.StopUrls();</span>
<a href="#l84.170"></a><span id="l84.170"> }</span>
<a href="#l84.171"></a><span id="l84.171"> </span>
<a href="#l84.172"></a><span id="l84.172"> function loadStartPage()</span>
<a href="#l84.173"></a><span id="l84.173" class="difflineat">@@ -495,17 +495,17 @@ function loadStartPage()</span>
<a href="#l84.174"></a><span id="l84.174">   catch (ex)</span>
<a href="#l84.175"></a><span id="l84.175">   {</span>
<a href="#l84.176"></a><span id="l84.176">     dump(&quot;Error loading start page.\n&quot;);</span>
<a href="#l84.177"></a><span id="l84.177">     return;</span>
<a href="#l84.178"></a><span id="l84.178">   }</span>
<a href="#l84.179"></a><span id="l84.179"> }</span>
<a href="#l84.180"></a><span id="l84.180"> </span>
<a href="#l84.181"></a><span id="l84.181"> // Given the server, open the twisty and the set the selection</span>
<a href="#l84.182"></a><span id="l84.182" class="difflineminus">-// on inbox of that server. </span>
<a href="#l84.183"></a><span id="l84.183" class="difflineplus">+// on inbox of that server.</span>
<a href="#l84.184"></a><span id="l84.184"> // prompt if offline.</span>
<a href="#l84.185"></a><span id="l84.185"> function OpenInboxForServer(server)</span>
<a href="#l84.186"></a><span id="l84.186"> {</span>
<a href="#l84.187"></a><span id="l84.187">     try {</span>
<a href="#l84.188"></a><span id="l84.188">         ShowThreadPane();</span>
<a href="#l84.189"></a><span id="l84.189">         var inboxFolder = GetInboxFolder(server);</span>
<a href="#l84.190"></a><span id="l84.190">         SelectFolder(inboxFolder.URI);</span>
<a href="#l84.191"></a><span id="l84.191"> </span>
<a href="#l84.192"></a><span id="l84.192" class="difflineat">@@ -526,19 +526,19 @@ function OpenInboxForServer(server)</span>
<a href="#l84.193"></a><span id="l84.193"> function GetSearchSession()</span>
<a href="#l84.194"></a><span id="l84.194"> {</span>
<a href="#l84.195"></a><span id="l84.195">   if ((&quot;gSearchSession&quot; in top) &amp;&amp; gSearchSession)</span>
<a href="#l84.196"></a><span id="l84.196">     return gSearchSession;</span>
<a href="#l84.197"></a><span id="l84.197">   else</span>
<a href="#l84.198"></a><span id="l84.198">     return null;</span>
<a href="#l84.199"></a><span id="l84.199"> }</span>
<a href="#l84.200"></a><span id="l84.200"> </span>
<a href="#l84.201"></a><span id="l84.201" class="difflineminus">-function SetKeywords(aKeywords) </span>
<a href="#l84.202"></a><span id="l84.202" class="difflineminus">-{ </span>
<a href="#l84.203"></a><span id="l84.203" class="difflineminus">-  // we cache the last keywords.  </span>
<a href="#l84.204"></a><span id="l84.204" class="difflineplus">+function SetKeywords(aKeywords)</span>
<a href="#l84.205"></a><span id="l84.205" class="difflineplus">+{</span>
<a href="#l84.206"></a><span id="l84.206" class="difflineplus">+  // we cache the last keywords.</span>
<a href="#l84.207"></a><span id="l84.207">   // if there is no chagne, we do nothing.</span>
<a href="#l84.208"></a><span id="l84.208">   // most of the time, this will be the case.</span>
<a href="#l84.209"></a><span id="l84.209">   if (aKeywords == gLastKeywords)</span>
<a href="#l84.210"></a><span id="l84.210">     return;</span>
<a href="#l84.211"></a><span id="l84.211"> </span>
<a href="#l84.212"></a><span id="l84.212">   // these are the UI elements who care about keywords</span>
<a href="#l84.213"></a><span id="l84.213">   var elements = document.getElementsByAttribute(&quot;keywordrelated&quot;,&quot;true&quot;);</span>
<a href="#l84.214"></a><span id="l84.214">   var len = elements.length;</span>
<a href="#l84.215"></a><span id="l84.215" class="difflineat">@@ -562,17 +562,17 @@ function SetKeywords(aKeywords)</span>
<a href="#l84.216"></a><span id="l84.216">       element.setAttribute(&quot;class&quot;, aKeywords);</span>
<a href="#l84.217"></a><span id="l84.217">     }</span>
<a href="#l84.218"></a><span id="l84.218">     else {</span>
<a href="#l84.219"></a><span id="l84.219">       // if no keywords, reset class to the original class</span>
<a href="#l84.220"></a><span id="l84.220">       element.setAttribute(&quot;class&quot;, originalclass);</span>
<a href="#l84.221"></a><span id="l84.221">     }</span>
<a href="#l84.222"></a><span id="l84.222">   }</span>
<a href="#l84.223"></a><span id="l84.223"> </span>
<a href="#l84.224"></a><span id="l84.224" class="difflineminus">-  // cache the keywords </span>
<a href="#l84.225"></a><span id="l84.225" class="difflineplus">+  // cache the keywords</span>
<a href="#l84.226"></a><span id="l84.226">   gLastKeywords = aKeywords;</span>
<a href="#l84.227"></a><span id="l84.227"> }</span>
<a href="#l84.228"></a><span id="l84.228"> </span>
<a href="#l84.229"></a><span id="l84.229"> function MailSetCharacterSet(aEvent)</span>
<a href="#l84.230"></a><span id="l84.230"> {</span>
<a href="#l84.231"></a><span id="l84.231">   if (aEvent.target.hasAttribute(&quot;charset&quot;)) {</span>
<a href="#l84.232"></a><span id="l84.232">     msgWindow.mailCharacterSet = aEvent.target.getAttribute(&quot;charset&quot;);</span>
<a href="#l84.233"></a><span id="l84.233">     msgWindow.charsetOverride = true;</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l85.1"></a><span id="l85.1" class="difflineminus">--- a/suite/mailnews/messageWindow.js</span>
<a href="#l85.2"></a><span id="l85.2" class="difflineplus">+++ b/suite/mailnews/messageWindow.js</span>
<a href="#l85.3"></a><span id="l85.3" class="difflineat">@@ -19,32 +19,32 @@ var gNextMessageViewIndexAfterDelete = -</span>
<a href="#l85.4"></a><span id="l85.4"> var gCurrentFolderToRerootForStandAlone;</span>
<a href="#l85.5"></a><span id="l85.5"> var gRerootOnFolderLoadForStandAlone = false;</span>
<a href="#l85.6"></a><span id="l85.6"> var gNextMessageAfterLoad = null;</span>
<a href="#l85.7"></a><span id="l85.7"> </span>
<a href="#l85.8"></a><span id="l85.8"> // the folderListener object</span>
<a href="#l85.9"></a><span id="l85.9"> var folderListener = {</span>
<a href="#l85.10"></a><span id="l85.10">   OnItemAdded: function(parentItem, item) {},</span>
<a href="#l85.11"></a><span id="l85.11"> </span>
<a href="#l85.12"></a><span id="l85.12" class="difflineminus">-  OnItemRemoved: function(parentItem, item) </span>
<a href="#l85.13"></a><span id="l85.13" class="difflineplus">+  OnItemRemoved: function(parentItem, item)</span>
<a href="#l85.14"></a><span id="l85.14">   {</span>
<a href="#l85.15"></a><span id="l85.15">     if (parentItem.URI != gCurrentFolderUri)</span>
<a href="#l85.16"></a><span id="l85.16">       return;</span>
<a href="#l85.17"></a><span id="l85.17"> </span>
<a href="#l85.18"></a><span id="l85.18">     if (item instanceof Components.interfaces.nsIMsgDBHdr &amp;&amp;</span>
<a href="#l85.19"></a><span id="l85.19">         extractMsgKeyFromURI() == item.messageKey)</span>
<a href="#l85.20"></a><span id="l85.20">       gCurrentMessageIsDeleted = true;</span>
<a href="#l85.21"></a><span id="l85.21">   },</span>
<a href="#l85.22"></a><span id="l85.22"> </span>
<a href="#l85.23"></a><span id="l85.23">   OnItemPropertyChanged: function(item, property, oldValue, newValue) {},</span>
<a href="#l85.24"></a><span id="l85.24" class="difflineminus">-  OnItemIntPropertyChanged: function(item, property, oldValue, newValue) { </span>
<a href="#l85.25"></a><span id="l85.25" class="difflineplus">+  OnItemIntPropertyChanged: function(item, property, oldValue, newValue) {</span>
<a href="#l85.26"></a><span id="l85.26">     if (item.URI == gCurrentFolderUri) {</span>
<a href="#l85.27"></a><span id="l85.27">       if (property.toString() == &quot;TotalMessages&quot; || property.toString() == &quot;TotalUnreadMessages&quot;) {</span>
<a href="#l85.28"></a><span id="l85.28">         UpdateStandAloneMessageCounts();</span>
<a href="#l85.29"></a><span id="l85.29" class="difflineminus">-      }      </span>
<a href="#l85.30"></a><span id="l85.30" class="difflineplus">+      }</span>
<a href="#l85.31"></a><span id="l85.31">     }</span>
<a href="#l85.32"></a><span id="l85.32">   },</span>
<a href="#l85.33"></a><span id="l85.33">   OnItemBoolPropertyChanged: function(item, property, oldValue, newValue) {},</span>
<a href="#l85.34"></a><span id="l85.34">   OnItemUnicharPropertyChanged: function(item, property, oldValue, newValue){},</span>
<a href="#l85.35"></a><span id="l85.35">   OnItemPropertyFlagChanged: function(item, property, oldFlag, newFlag) {},</span>
<a href="#l85.36"></a><span id="l85.36"> </span>
<a href="#l85.37"></a><span id="l85.37">   OnItemEvent: function(folder, event) {</span>
<a href="#l85.38"></a><span id="l85.38">     var eventType = event.toString();</span>
<a href="#l85.39"></a><span id="l85.39" class="difflineat">@@ -56,33 +56,33 @@ var folderListener = {</span>
<a href="#l85.40"></a><span id="l85.40">     else if (eventType == &quot;FolderLoaded&quot;) {</span>
<a href="#l85.41"></a><span id="l85.41">       if (folder) {</span>
<a href="#l85.42"></a><span id="l85.42">         var uri = folder.URI;</span>
<a href="#l85.43"></a><span id="l85.43">         if (uri == gCurrentFolderToRerootForStandAlone) {</span>
<a href="#l85.44"></a><span id="l85.44">           gCurrentFolderToRerootForStandAlone = null;</span>
<a href="#l85.45"></a><span id="l85.45">           folder.endFolderLoading();</span>
<a href="#l85.46"></a><span id="l85.46">           if (gRerootOnFolderLoadForStandAlone) {</span>
<a href="#l85.47"></a><span id="l85.47">             RerootFolderForStandAlone(uri);</span>
<a href="#l85.48"></a><span id="l85.48" class="difflineminus">-          }   </span>
<a href="#l85.49"></a><span id="l85.49" class="difflineplus">+          }</span>
<a href="#l85.50"></a><span id="l85.50">         }</span>
<a href="#l85.51"></a><span id="l85.51">       }</span>
<a href="#l85.52"></a><span id="l85.52">     }</span>
<a href="#l85.53"></a><span id="l85.53">     else if (eventType == &quot;JunkStatusChanged&quot;) {</span>
<a href="#l85.54"></a><span id="l85.54">       HandleJunkStatusChanged(folder);</span>
<a href="#l85.55"></a><span id="l85.55">     }</span>
<a href="#l85.56"></a><span id="l85.56" class="difflineminus">-  }   </span>
<a href="#l85.57"></a><span id="l85.57" class="difflineplus">+  }</span>
<a href="#l85.58"></a><span id="l85.58"> }</span>
<a href="#l85.59"></a><span id="l85.59"> </span>
<a href="#l85.60"></a><span id="l85.60"> var messagepaneObserver = {</span>
<a href="#l85.61"></a><span id="l85.61"> </span>
<a href="#l85.62"></a><span id="l85.62">   canHandleMultipleItems: false,</span>
<a href="#l85.63"></a><span id="l85.63"> </span>
<a href="#l85.64"></a><span id="l85.64">   onDrop: function (aEvent, aData, aDragSession)</span>
<a href="#l85.65"></a><span id="l85.65">   {</span>
<a href="#l85.66"></a><span id="l85.66" class="difflineminus">-    var sourceUri = aData.data; </span>
<a href="#l85.67"></a><span id="l85.67" class="difflineplus">+    var sourceUri = aData.data;</span>
<a href="#l85.68"></a><span id="l85.68">     if (sourceUri != gCurrentMessageUri)</span>
<a href="#l85.69"></a><span id="l85.69">     {</span>
<a href="#l85.70"></a><span id="l85.70">       var msgHdr = GetMsgHdrFromUri(sourceUri);</span>
<a href="#l85.71"></a><span id="l85.71"> </span>
<a href="#l85.72"></a><span id="l85.72">       // Reset the window's message uri and folder uri vars, and</span>
<a href="#l85.73"></a><span id="l85.73">       // update the command handlers to what's going to be used.</span>
<a href="#l85.74"></a><span id="l85.74">       // This has to be done before the call to CreateView().</span>
<a href="#l85.75"></a><span id="l85.75">       gCurrentMessageUri = sourceUri;</span>
<a href="#l85.76"></a><span id="l85.76" class="difflineat">@@ -92,36 +92,36 @@ var messagepaneObserver = {</span>
<a href="#l85.77"></a><span id="l85.77">       // even if the folder uri's match, we can't use the existing view</span>
<a href="#l85.78"></a><span id="l85.78">       // (msgHdr.folder.URI == windowID.gCurrentFolderUri)</span>
<a href="#l85.79"></a><span id="l85.79">       // the reason is quick search and mail views.</span>
<a href="#l85.80"></a><span id="l85.80">       // see bug #187673</span>
<a href="#l85.81"></a><span id="l85.81">       CreateView(aDragSession.sourceNode.ownerDocument.defaultView.gDBView);</span>
<a href="#l85.82"></a><span id="l85.82">       LoadMessageByMsgKey(msgHdr.messageKey);</span>
<a href="#l85.83"></a><span id="l85.83">     }</span>
<a href="#l85.84"></a><span id="l85.84">   },</span>
<a href="#l85.85"></a><span id="l85.85" class="difflineminus">- </span>
<a href="#l85.86"></a><span id="l85.86" class="difflineplus">+</span>
<a href="#l85.87"></a><span id="l85.87">   onDragOver: function (aEvent, aFlavour, aDragSession)</span>
<a href="#l85.88"></a><span id="l85.88">   {</span>
<a href="#l85.89"></a><span id="l85.89">     var messagepanebox = document.getElementById(&quot;messagepanebox&quot;);</span>
<a href="#l85.90"></a><span id="l85.90">     messagepanebox.setAttribute(&quot;dragover&quot;, &quot;true&quot;);</span>
<a href="#l85.91"></a><span id="l85.91">   },</span>
<a href="#l85.92"></a><span id="l85.92" class="difflineminus">- </span>
<a href="#l85.93"></a><span id="l85.93" class="difflineplus">+</span>
<a href="#l85.94"></a><span id="l85.94">   onDragExit: function (aEvent, aDragSession)</span>
<a href="#l85.95"></a><span id="l85.95">   {</span>
<a href="#l85.96"></a><span id="l85.96">     var messagepanebox = document.getElementById(&quot;messagepanebox&quot;);</span>
<a href="#l85.97"></a><span id="l85.97">     messagepanebox.removeAttribute(&quot;dragover&quot;);</span>
<a href="#l85.98"></a><span id="l85.98">   },</span>
<a href="#l85.99"></a><span id="l85.99"> </span>
<a href="#l85.100"></a><span id="l85.100">   canDrop: function(aEvent, aDragSession)  //allow drop from mail:3pane window only - 4xp</span>
<a href="#l85.101"></a><span id="l85.101">   {</span>
<a href="#l85.102"></a><span id="l85.102">     var doc = aDragSession.sourceNode.ownerDocument;</span>
<a href="#l85.103"></a><span id="l85.103">     var elem = doc.getElementById(&quot;messengerWindow&quot;);</span>
<a href="#l85.104"></a><span id="l85.104">     return (elem &amp;&amp; (elem.getAttribute(&quot;windowtype&quot;) == &quot;mail:3pane&quot;));</span>
<a href="#l85.105"></a><span id="l85.105">   },</span>
<a href="#l85.106"></a><span id="l85.106" class="difflineminus">-  </span>
<a href="#l85.107"></a><span id="l85.107" class="difflineplus">+</span>
<a href="#l85.108"></a><span id="l85.108">   getSupportedFlavours: function ()</span>
<a href="#l85.109"></a><span id="l85.109">   {</span>
<a href="#l85.110"></a><span id="l85.110">     var flavourSet = new FlavourSet();</span>
<a href="#l85.111"></a><span id="l85.111">     flavourSet.appendFlavour(&quot;text/x-moz-message&quot;);</span>
<a href="#l85.112"></a><span id="l85.112">     return flavourSet;</span>
<a href="#l85.113"></a><span id="l85.113">   }</span>
<a href="#l85.114"></a><span id="l85.114"> };</span>
<a href="#l85.115"></a><span id="l85.115"> </span>
<a href="#l85.116"></a><span id="l85.116" class="difflineat">@@ -130,17 +130,17 @@ function nsMsgDBViewCommandUpdater()</span>
<a href="#l85.117"></a><span id="l85.117"> </span>
<a href="#l85.118"></a><span id="l85.118"> function UpdateStandAloneMessageCounts()</span>
<a href="#l85.119"></a><span id="l85.119"> {</span>
<a href="#l85.120"></a><span id="l85.120">   // hook for extra toolbar items</span>
<a href="#l85.121"></a><span id="l85.121">   Services.obs.notifyObservers(window,</span>
<a href="#l85.122"></a><span id="l85.122">                                &quot;mail:updateStandAloneMessageCounts&quot;, &quot;&quot;);</span>
<a href="#l85.123"></a><span id="l85.123"> }</span>
<a href="#l85.124"></a><span id="l85.124"> </span>
<a href="#l85.125"></a><span id="l85.125" class="difflineminus">-nsMsgDBViewCommandUpdater.prototype = </span>
<a href="#l85.126"></a><span id="l85.126" class="difflineplus">+nsMsgDBViewCommandUpdater.prototype =</span>
<a href="#l85.127"></a><span id="l85.127"> {</span>
<a href="#l85.128"></a><span id="l85.128">   updateCommandStatus : function()</span>
<a href="#l85.129"></a><span id="l85.129">     {</span>
<a href="#l85.130"></a><span id="l85.130">       // the back end is smart and is only telling us to update command status</span>
<a href="#l85.131"></a><span id="l85.131">       // when the # of items in the selection has actually changed.</span>
<a href="#l85.132"></a><span id="l85.132">       UpdateMailToolbar(&quot;dbview, std alone window&quot;);</span>
<a href="#l85.133"></a><span id="l85.133">     },</span>
<a href="#l85.134"></a><span id="l85.134"> </span>
<a href="#l85.135"></a><span id="l85.135" class="difflineat">@@ -164,28 +164,28 @@ nsMsgDBViewCommandUpdater.prototype =</span>
<a href="#l85.136"></a><span id="l85.136"> </span>
<a href="#l85.137"></a><span id="l85.137">   summarizeSelection: function() {return false},</span>
<a href="#l85.138"></a><span id="l85.138"> </span>
<a href="#l85.139"></a><span id="l85.139">   QueryInterface : function(iid)</span>
<a href="#l85.140"></a><span id="l85.140">   {</span>
<a href="#l85.141"></a><span id="l85.141">     if (iid.equals(Components.interfaces.nsIMsgDBViewCommandUpdater) ||</span>
<a href="#l85.142"></a><span id="l85.142">         iid.equals(Components.interfaces.nsISupports))</span>
<a href="#l85.143"></a><span id="l85.143">       return this;</span>
<a href="#l85.144"></a><span id="l85.144" class="difflineminus">-	  </span>
<a href="#l85.145"></a><span id="l85.145" class="difflineplus">+</span>
<a href="#l85.146"></a><span id="l85.146">     throw Components.results.NS_NOINTERFACE;</span>
<a href="#l85.147"></a><span id="l85.147">   }</span>
<a href="#l85.148"></a><span id="l85.148"> }</span>
<a href="#l85.149"></a><span id="l85.149"> </span>
<a href="#l85.150"></a><span id="l85.150"> function HandleDeleteOrMoveMsgCompleted(folder)</span>
<a href="#l85.151"></a><span id="l85.151"> {</span>
<a href="#l85.152"></a><span id="l85.152">   if ((folder.URI == gCurrentFolderUri) &amp;&amp; gCurrentMessageIsDeleted)</span>
<a href="#l85.153"></a><span id="l85.153">   {</span>
<a href="#l85.154"></a><span id="l85.154">     gDBView.onDeleteCompleted(true);</span>
<a href="#l85.155"></a><span id="l85.155">     gCurrentMessageIsDeleted = false;</span>
<a href="#l85.156"></a><span id="l85.156" class="difflineminus">-    if (gNextMessageViewIndexAfterDelete != nsMsgViewIndex_None) </span>
<a href="#l85.157"></a><span id="l85.157" class="difflineplus">+    if (gNextMessageViewIndexAfterDelete != nsMsgViewIndex_None)</span>
<a href="#l85.158"></a><span id="l85.158">     {</span>
<a href="#l85.159"></a><span id="l85.159">       var nextMstKey = gDBView.getKeyAt(gNextMessageViewIndexAfterDelete);</span>
<a href="#l85.160"></a><span id="l85.160">       if (nextMstKey != nsMsgKey_None &amp;&amp;</span>
<a href="#l85.161"></a><span id="l85.161">           !Services.prefs.getBoolPref(&quot;mail.close_message_window.on_delete&quot;))</span>
<a href="#l85.162"></a><span id="l85.162">         LoadMessageByViewIndex(gNextMessageViewIndexAfterDelete);</span>
<a href="#l85.163"></a><span id="l85.163">       else</span>
<a href="#l85.164"></a><span id="l85.164">         window.close();</span>
<a href="#l85.165"></a><span id="l85.165">     }</span>
<a href="#l85.166"></a><span id="l85.166" class="difflineat">@@ -243,18 +243,18 @@ function OnLoadMessageWindow()</span>
<a href="#l85.167"></a><span id="l85.167">         messageUri = window.arguments[0];</span>
<a href="#l85.168"></a><span id="l85.168">         if (messageUri instanceof Components.interfaces.nsIURI)</span>
<a href="#l85.169"></a><span id="l85.169">         {</span>
<a href="#l85.170"></a><span id="l85.170">           loadCustomMessage = /type=application\/x-message-display/.test(messageUri.spec);</span>
<a href="#l85.171"></a><span id="l85.171">           gCurrentMessageUri = messageUri.spec;</span>
<a href="#l85.172"></a><span id="l85.172">           if (messageUri instanceof Components.interfaces.nsIMsgMailNewsUrl)</span>
<a href="#l85.173"></a><span id="l85.173">             folder = messageUri.folder;</span>
<a href="#l85.174"></a><span id="l85.174">         }</span>
<a href="#l85.175"></a><span id="l85.175" class="difflineminus">-      } </span>
<a href="#l85.176"></a><span id="l85.176" class="difflineminus">-      catch(ex) </span>
<a href="#l85.177"></a><span id="l85.177" class="difflineplus">+      }</span>
<a href="#l85.178"></a><span id="l85.178" class="difflineplus">+      catch(ex)</span>
<a href="#l85.179"></a><span id="l85.179">       {</span>
<a href="#l85.180"></a><span id="l85.180">         folder = null;</span>
<a href="#l85.181"></a><span id="l85.181">         dump(&quot;## ex=&quot; + ex + &quot;\n&quot;);</span>
<a href="#l85.182"></a><span id="l85.182">       }</span>
<a href="#l85.183"></a><span id="l85.183"> </span>
<a href="#l85.184"></a><span id="l85.184">       if (!gCurrentMessageUri)</span>
<a href="#l85.185"></a><span id="l85.185">         gCurrentMessageUri = window.arguments[0];</span>
<a href="#l85.186"></a><span id="l85.186">     }</span>
<a href="#l85.187"></a><span id="l85.187" class="difflineat">@@ -325,34 +325,34 @@ function OnLoadMessageWindowDelayed(load</span>
<a href="#l85.188"></a><span id="l85.188">     var msgKey = extractMsgKeyFromURI(gCurrentMessageUri);</span>
<a href="#l85.189"></a><span id="l85.189">     var viewIndex = gDBView.findIndexFromKey(msgKey, true);</span>
<a href="#l85.190"></a><span id="l85.190">     // the message may not appear in the view if loaded from a search dialog</span>
<a href="#l85.191"></a><span id="l85.191">     if (viewIndex != nsMsgViewIndex_None)</span>
<a href="#l85.192"></a><span id="l85.192">       LoadMessageByViewIndex(viewIndex);</span>
<a href="#l85.193"></a><span id="l85.193">     else</span>
<a href="#l85.194"></a><span id="l85.194">       messenger.openURL(gCurrentMessageUri);</span>
<a href="#l85.195"></a><span id="l85.195">   }</span>
<a href="#l85.196"></a><span id="l85.196" class="difflineminus">-  gNextMessageViewIndexAfterDelete = gDBView.msgToSelectAfterDelete; </span>
<a href="#l85.197"></a><span id="l85.197" class="difflineplus">+  gNextMessageViewIndexAfterDelete = gDBView.msgToSelectAfterDelete;</span>
<a href="#l85.198"></a><span id="l85.198">   UpdateStandAloneMessageCounts();</span>
<a href="#l85.199"></a><span id="l85.199" class="difflineminus">-   </span>
<a href="#l85.200"></a><span id="l85.200" class="difflineplus">+</span>
<a href="#l85.201"></a><span id="l85.201">   // set focus to the message pane</span>
<a href="#l85.202"></a><span id="l85.202">   window.content.focus();</span>
<a href="#l85.203"></a><span id="l85.203"> </span>
<a href="#l85.204"></a><span id="l85.204">   // since we just changed the pane with focus we need to update the toolbar to reflect this</span>
<a href="#l85.205"></a><span id="l85.205">   // XXX TODO</span>
<a href="#l85.206"></a><span id="l85.206">   // can we optimize</span>
<a href="#l85.207"></a><span id="l85.207">   // and just update cmd_delete and button_delete?</span>
<a href="#l85.208"></a><span id="l85.208">   UpdateMailToolbar(&quot;focus&quot;);</span>
<a href="#l85.209"></a><span id="l85.209"> }</span>
<a href="#l85.210"></a><span id="l85.210"> </span>
<a href="#l85.211"></a><span id="l85.211"> function CreateView(originalView)</span>
<a href="#l85.212"></a><span id="l85.212"> {</span>
<a href="#l85.213"></a><span id="l85.213">   var msgFolder = GetLoadedMsgFolder();</span>
<a href="#l85.214"></a><span id="l85.214"> </span>
<a href="#l85.215"></a><span id="l85.215" class="difflineminus">-  // extract the sort type, the sort order, </span>
<a href="#l85.216"></a><span id="l85.216" class="difflineplus">+  // extract the sort type, the sort order,</span>
<a href="#l85.217"></a><span id="l85.217">   var sortType;</span>
<a href="#l85.218"></a><span id="l85.218">   var sortOrder;</span>
<a href="#l85.219"></a><span id="l85.219">   var viewFlags;</span>
<a href="#l85.220"></a><span id="l85.220">   var viewType;</span>
<a href="#l85.221"></a><span id="l85.221"> </span>
<a href="#l85.222"></a><span id="l85.222">   if (originalView)</span>
<a href="#l85.223"></a><span id="l85.223">   {</span>
<a href="#l85.224"></a><span id="l85.224">     viewType = originalView.viewType;</span>
<a href="#l85.225"></a><span id="l85.225" class="difflineat">@@ -375,17 +375,17 @@ function CreateView(originalView)</span>
<a href="#l85.226"></a><span id="l85.226">    }</span>
<a href="#l85.227"></a><span id="l85.227">   }</span>
<a href="#l85.228"></a><span id="l85.228">   else</span>
<a href="#l85.229"></a><span id="l85.229">   {</span>
<a href="#l85.230"></a><span id="l85.230">     viewType = nsMsgViewType.eShowSearch;</span>
<a href="#l85.231"></a><span id="l85.231">   }</span>
<a href="#l85.232"></a><span id="l85.232"> </span>
<a href="#l85.233"></a><span id="l85.233">   // create a db view</span>
<a href="#l85.234"></a><span id="l85.234" class="difflineminus">-  CreateBareDBView(originalView, msgFolder, viewType, viewFlags, sortType, sortOrder); </span>
<a href="#l85.235"></a><span id="l85.235" class="difflineplus">+  CreateBareDBView(originalView, msgFolder, viewType, viewFlags, sortType, sortOrder);</span>
<a href="#l85.236"></a><span id="l85.236"> </span>
<a href="#l85.237"></a><span id="l85.237">   var uri;</span>
<a href="#l85.238"></a><span id="l85.238">   if (gCurrentMessageUri)</span>
<a href="#l85.239"></a><span id="l85.239">     uri = gCurrentMessageUri;</span>
<a href="#l85.240"></a><span id="l85.240">   else if (gCurrentFolderUri)</span>
<a href="#l85.241"></a><span id="l85.241">     uri = gCurrentFolderUri;</span>
<a href="#l85.242"></a><span id="l85.242">   else</span>
<a href="#l85.243"></a><span id="l85.243">     uri = null;</span>
<a href="#l85.244"></a><span id="l85.244" class="difflineat">@@ -472,19 +472,19 @@ function SelectFolder(folderUri)</span>
<a href="#l85.245"></a><span id="l85.245">   if (folderUri == gCurrentFolderUri)</span>
<a href="#l85.246"></a><span id="l85.246">     return;</span>
<a href="#l85.247"></a><span id="l85.247"> </span>
<a href="#l85.248"></a><span id="l85.248">   let msgfolder = GetMsgFolderFromUri(folderUri);</span>
<a href="#l85.249"></a><span id="l85.249">   if (!msgfolder || msgfolder.isServer)</span>
<a href="#l85.250"></a><span id="l85.250">     return;</span>
<a href="#l85.251"></a><span id="l85.251"> </span>
<a href="#l85.252"></a><span id="l85.252">   // close old folder view</span>
<a href="#l85.253"></a><span id="l85.253" class="difflineminus">-  var dbview = GetDBView();  </span>
<a href="#l85.254"></a><span id="l85.254" class="difflineplus">+  var dbview = GetDBView();</span>
<a href="#l85.255"></a><span id="l85.255">   if (dbview)</span>
<a href="#l85.256"></a><span id="l85.256" class="difflineminus">-    dbview.close(); </span>
<a href="#l85.257"></a><span id="l85.257" class="difflineplus">+    dbview.close();</span>
<a href="#l85.258"></a><span id="l85.258"> </span>
<a href="#l85.259"></a><span id="l85.259">   gCurrentFolderToRerootForStandAlone = folderUri;</span>
<a href="#l85.260"></a><span id="l85.260"> </span>
<a href="#l85.261"></a><span id="l85.261">   if (msgfolder.manyHeadersToDownload)</span>
<a href="#l85.262"></a><span id="l85.262">   {</span>
<a href="#l85.263"></a><span id="l85.263">     gRerootOnFolderLoadForStandAlone = true;</span>
<a href="#l85.264"></a><span id="l85.264">     try</span>
<a href="#l85.265"></a><span id="l85.265">     {</span>
<a href="#l85.266"></a><span id="l85.266" class="difflineat">@@ -500,52 +500,52 @@ function SelectFolder(folderUri)</span>
<a href="#l85.267"></a><span id="l85.267">   {</span>
<a href="#l85.268"></a><span id="l85.268">     RerootFolderForStandAlone(folderUri);</span>
<a href="#l85.269"></a><span id="l85.269">     gRerootOnFolderLoadForStandAlone = false;</span>
<a href="#l85.270"></a><span id="l85.270">     msgfolder.startFolderLoading();</span>
<a href="#l85.271"></a><span id="l85.271"> </span>
<a href="#l85.272"></a><span id="l85.272">     //Need to do this after rerooting folder.  Otherwise possibility of receiving folder loaded</span>
<a href="#l85.273"></a><span id="l85.273">     //notification before folder has actually changed.</span>
<a href="#l85.274"></a><span id="l85.274">     msgfolder.updateFolder(msgWindow);</span>
<a href="#l85.275"></a><span id="l85.275" class="difflineminus">-  }    </span>
<a href="#l85.276"></a><span id="l85.276" class="difflineplus">+  }</span>
<a href="#l85.277"></a><span id="l85.277"> }</span>
<a href="#l85.278"></a><span id="l85.278"> </span>
<a href="#l85.279"></a><span id="l85.279"> function RerootFolderForStandAlone(uri)</span>
<a href="#l85.280"></a><span id="l85.280"> {</span>
<a href="#l85.281"></a><span id="l85.281">   gCurrentFolderUri = uri;</span>
<a href="#l85.282"></a><span id="l85.282"> </span>
<a href="#l85.283"></a><span id="l85.283">   // create new folder view</span>
<a href="#l85.284"></a><span id="l85.284">   CreateView(null);</span>
<a href="#l85.285"></a><span id="l85.285" class="difflineminus">-  </span>
<a href="#l85.286"></a><span id="l85.286" class="difflineplus">+</span>
<a href="#l85.287"></a><span id="l85.287">   // now do the work to load the appropriate message</span>
<a href="#l85.288"></a><span id="l85.288">   if (gNextMessageAfterLoad) {</span>
<a href="#l85.289"></a><span id="l85.289">     var type = gNextMessageAfterLoad;</span>
<a href="#l85.290"></a><span id="l85.290">     gNextMessageAfterLoad = null;</span>
<a href="#l85.291"></a><span id="l85.291">     LoadMessageByNavigationType(type);</span>
<a href="#l85.292"></a><span id="l85.292">   }</span>
<a href="#l85.293"></a><span id="l85.293" class="difflineminus">-  </span>
<a href="#l85.294"></a><span id="l85.294" class="difflineplus">+</span>
<a href="#l85.295"></a><span id="l85.295">   SetUpToolbarButtons(gCurrentFolderUri);</span>
<a href="#l85.296"></a><span id="l85.296" class="difflineminus">-  </span>
<a href="#l85.297"></a><span id="l85.297" class="difflineplus">+</span>
<a href="#l85.298"></a><span id="l85.298">   UpdateMailToolbar(&quot;reroot folder in stand alone window&quot;);</span>
<a href="#l85.299"></a><span id="l85.299" class="difflineminus">-  </span>
<a href="#l85.300"></a><span id="l85.300" class="difflineplus">+</span>
<a href="#l85.301"></a><span id="l85.301">   // hook for extra toolbar items</span>
<a href="#l85.302"></a><span id="l85.302">   Services.obs.notifyObservers(window, &quot;mail:setupToolbarItems&quot;, uri);</span>
<a href="#l85.303"></a><span id="l85.303" class="difflineminus">-} </span>
<a href="#l85.304"></a><span id="l85.304" class="difflineplus">+}</span>
<a href="#l85.305"></a><span id="l85.305"> </span>
<a href="#l85.306"></a><span id="l85.306"> function GetMsgHdrFromUri(messageUri)</span>
<a href="#l85.307"></a><span id="l85.307"> {</span>
<a href="#l85.308"></a><span id="l85.308">   return messenger.msgHdrFromURI(messageUri);</span>
<a href="#l85.309"></a><span id="l85.309"> }</span>
<a href="#l85.310"></a><span id="l85.310"> </span>
<a href="#l85.311"></a><span id="l85.311"> function SelectMessage(messageUri)</span>
<a href="#l85.312"></a><span id="l85.312"> {</span>
<a href="#l85.313"></a><span id="l85.313">   var msgHdr = GetMsgHdrFromUri(messageUri);</span>
<a href="#l85.314"></a><span id="l85.314">   LoadMessageByMsgKey(msgHdr.messageKey);</span>
<a href="#l85.315"></a><span id="l85.315"> }</span>
<a href="#l85.316"></a><span id="l85.316" class="difflineminus">- </span>
<a href="#l85.317"></a><span id="l85.317" class="difflineplus">+</span>
<a href="#l85.318"></a><span id="l85.318"> function ReloadMessage()</span>
<a href="#l85.319"></a><span id="l85.319"> {</span>
<a href="#l85.320"></a><span id="l85.320">   gDBView.reloadMessage();</span>
<a href="#l85.321"></a><span id="l85.321"> }</span>
<a href="#l85.322"></a><span id="l85.322"> </span>
<a href="#l85.323"></a><span id="l85.323"> // MessageWindowController object (handles commands when one of the trees does not have focus)</span>
<a href="#l85.324"></a><span id="l85.324"> var MessageWindowController =</span>
<a href="#l85.325"></a><span id="l85.325"> {</span>
<a href="#l85.326"></a><span id="l85.326" class="difflineat">@@ -578,22 +578,22 @@ var MessageWindowController =</span>
<a href="#l85.327"></a><span id="l85.327">       case &quot;cmd_recalculateJunkScore&quot;:</span>
<a href="#l85.328"></a><span id="l85.328">       case &quot;cmd_markAsShowRemote&quot;:</span>
<a href="#l85.329"></a><span id="l85.329">       case &quot;cmd_markAsNotPhish&quot;:</span>
<a href="#l85.330"></a><span id="l85.330">       case &quot;cmd_applyFiltersToSelection&quot;:</span>
<a href="#l85.331"></a><span id="l85.331">       case &quot;cmd_applyFilters&quot;:</span>
<a href="#l85.332"></a><span id="l85.332">       case &quot;cmd_runJunkControls&quot;:</span>
<a href="#l85.333"></a><span id="l85.333">       case &quot;cmd_deleteJunk&quot;:</span>
<a href="#l85.334"></a><span id="l85.334">       case &quot;cmd_nextMsg&quot;:</span>
<a href="#l85.335"></a><span id="l85.335" class="difflineminus">-      case &quot;button_next&quot;: </span>
<a href="#l85.336"></a><span id="l85.336" class="difflineminus">-      case &quot;cmd_nextUnreadMsg&quot;: </span>
<a href="#l85.337"></a><span id="l85.337" class="difflineminus">-      case &quot;cmd_nextFlaggedMsg&quot;: </span>
<a href="#l85.338"></a><span id="l85.338" class="difflineminus">-      case &quot;cmd_nextUnreadThread&quot;: </span>
<a href="#l85.339"></a><span id="l85.339" class="difflineminus">-      case &quot;cmd_previousMsg&quot;: </span>
<a href="#l85.340"></a><span id="l85.340" class="difflineminus">-      case &quot;cmd_previousUnreadMsg&quot;: </span>
<a href="#l85.341"></a><span id="l85.341" class="difflineplus">+      case &quot;button_next&quot;:</span>
<a href="#l85.342"></a><span id="l85.342" class="difflineplus">+      case &quot;cmd_nextUnreadMsg&quot;:</span>
<a href="#l85.343"></a><span id="l85.343" class="difflineplus">+      case &quot;cmd_nextFlaggedMsg&quot;:</span>
<a href="#l85.344"></a><span id="l85.344" class="difflineplus">+      case &quot;cmd_nextUnreadThread&quot;:</span>
<a href="#l85.345"></a><span id="l85.345" class="difflineplus">+      case &quot;cmd_previousMsg&quot;:</span>
<a href="#l85.346"></a><span id="l85.346" class="difflineplus">+      case &quot;cmd_previousUnreadMsg&quot;:</span>
<a href="#l85.347"></a><span id="l85.347">       case &quot;cmd_previousFlaggedMsg&quot;:</span>
<a href="#l85.348"></a><span id="l85.348">       case &quot;cmd_goBack&quot;:</span>
<a href="#l85.349"></a><span id="l85.349">       case &quot;button_goBack&quot;:</span>
<a href="#l85.350"></a><span id="l85.350">       case &quot;cmd_goForward&quot;:</span>
<a href="#l85.351"></a><span id="l85.351">       case &quot;button_goForward&quot;:</span>
<a href="#l85.352"></a><span id="l85.352">         return (gDBView.keyForFirstSelectedMessage != nsMsgKey_None);</span>
<a href="#l85.353"></a><span id="l85.353">       case &quot;cmd_viewPageSource&quot;:</span>
<a href="#l85.354"></a><span id="l85.354">         return GetNumSelectedMessages() &gt; 0;</span>
<a href="#l85.355"></a><span id="l85.355" class="difflineat">@@ -715,17 +715,17 @@ var MessageWindowController =</span>
<a href="#l85.356"></a><span id="l85.356">         return (GetNumSelectedMessages() &gt; 0 &amp;&amp; checkMsgHdrPropertyIsNot(&quot;notAPhishMessage&quot;, kNotAPhishMessage));</span>
<a href="#l85.357"></a><span id="l85.357"> 			case &quot;cmd_printSetup&quot;:</span>
<a href="#l85.358"></a><span id="l85.358"> 			  return true;</span>
<a href="#l85.359"></a><span id="l85.359"> 			case &quot;cmd_getNewMessages&quot;:</span>
<a href="#l85.360"></a><span id="l85.360">       case &quot;button_getNewMessages&quot;:</span>
<a href="#l85.361"></a><span id="l85.361">       case &quot;cmd_getMsgsForAuthAccounts&quot;:</span>
<a href="#l85.362"></a><span id="l85.362"> 				return IsGetNewMessagesEnabled();</span>
<a href="#l85.363"></a><span id="l85.363"> 			case &quot;cmd_getNextNMessages&quot;:</span>
<a href="#l85.364"></a><span id="l85.364" class="difflineminus">-				return IsGetNextNMessagesEnabled();		</span>
<a href="#l85.365"></a><span id="l85.365" class="difflineplus">+				return IsGetNextNMessagesEnabled();</span>
<a href="#l85.366"></a><span id="l85.366"> 			case &quot;cmd_downloadFlagged&quot;:</span>
<a href="#l85.367"></a><span id="l85.367"> 			case &quot;cmd_downloadSelected&quot;:</span>
<a href="#l85.368"></a><span id="l85.368">       case &quot;cmd_synchronizeOffline&quot;:</span>
<a href="#l85.369"></a><span id="l85.369">         return !Services.io.offline;</span>
<a href="#l85.370"></a><span id="l85.370"> 			case &quot;cmd_settingsOffline&quot;:</span>
<a href="#l85.371"></a><span id="l85.371">                 return IsAccountOfflineEnabled();</span>
<a href="#l85.372"></a><span id="l85.372"> 			case &quot;cmd_close&quot;:</span>
<a href="#l85.373"></a><span id="l85.373"> 			case &quot;cmd_nextMsg&quot;:</span>
<a href="#l85.374"></a><span id="l85.374" class="difflineat">@@ -826,17 +826,17 @@ var MessageWindowController =</span>
<a href="#l85.375"></a><span id="l85.375"> 			case &quot;cmd_editAsNew&quot;:</span>
<a href="#l85.376"></a><span id="l85.376"> 				MsgEditMessageAsNew();</span>
<a href="#l85.377"></a><span id="l85.377"> 				break;</span>
<a href="#l85.378"></a><span id="l85.378">       case &quot;cmd_createFilterFromPopup&quot;:</span>
<a href="#l85.379"></a><span id="l85.379">         CreateFilter(document.popupNode);</span>
<a href="#l85.380"></a><span id="l85.380">         break;</span>
<a href="#l85.381"></a><span id="l85.381">       case &quot;cmd_createFilterFromMenu&quot;:</span>
<a href="#l85.382"></a><span id="l85.382">         MsgCreateFilter();</span>
<a href="#l85.383"></a><span id="l85.383" class="difflineminus">-        break;        </span>
<a href="#l85.384"></a><span id="l85.384" class="difflineplus">+        break;</span>
<a href="#l85.385"></a><span id="l85.385">       case &quot;cmd_delete&quot;:</span>
<a href="#l85.386"></a><span id="l85.386">       case &quot;button_delete&quot;:</span>
<a href="#l85.387"></a><span id="l85.387">         MsgDeleteMessage(false);</span>
<a href="#l85.388"></a><span id="l85.388">         UpdateDeleteToolbarButton(false);</span>
<a href="#l85.389"></a><span id="l85.389">         break;</span>
<a href="#l85.390"></a><span id="l85.390">       case &quot;cmd_shiftDelete&quot;:</span>
<a href="#l85.391"></a><span id="l85.391">       case &quot;button_shiftDelete&quot;:</span>
<a href="#l85.392"></a><span id="l85.392">         MsgDeleteMessage(true);</span>
<a href="#l85.393"></a><span id="l85.393" class="difflineat">@@ -923,17 +923,17 @@ var MessageWindowController =</span>
<a href="#l85.394"></a><span id="l85.394">         return;</span>
<a href="#l85.395"></a><span id="l85.395">       case &quot;cmd_settingsOffline&quot;:</span>
<a href="#l85.396"></a><span id="l85.396">         MsgSettingsOffline();</span>
<a href="#l85.397"></a><span id="l85.397">         return;</span>
<a href="#l85.398"></a><span id="l85.398">       case &quot;cmd_nextUnreadMsg&quot;:</span>
<a href="#l85.399"></a><span id="l85.399">       case &quot;button_next&quot;:</span>
<a href="#l85.400"></a><span id="l85.400">         performNavigation(nsMsgNavigationType.nextUnreadMessage);</span>
<a href="#l85.401"></a><span id="l85.401">         break;</span>
<a href="#l85.402"></a><span id="l85.402" class="difflineminus">-			case &quot;cmd_nextUnreadThread&quot;:      </span>
<a href="#l85.403"></a><span id="l85.403" class="difflineplus">+			case &quot;cmd_nextUnreadThread&quot;:</span>
<a href="#l85.404"></a><span id="l85.404">         performNavigation(nsMsgNavigationType.nextUnreadThread);</span>
<a href="#l85.405"></a><span id="l85.405"> 				break;</span>
<a href="#l85.406"></a><span id="l85.406"> 			case &quot;cmd_nextMsg&quot;:</span>
<a href="#l85.407"></a><span id="l85.407">         performNavigation(nsMsgNavigationType.nextMessage);</span>
<a href="#l85.408"></a><span id="l85.408"> 				break;</span>
<a href="#l85.409"></a><span id="l85.409"> 			case &quot;cmd_nextFlaggedMsg&quot;:</span>
<a href="#l85.410"></a><span id="l85.410">         performNavigation(nsMsgNavigationType.nextFlagged);</span>
<a href="#l85.411"></a><span id="l85.411"> 				break;</span>
<a href="#l85.412"></a><span id="l85.412" class="difflineat">@@ -952,53 +952,53 @@ var MessageWindowController =</span>
<a href="#l85.413"></a><span id="l85.413">       case &quot;cmd_goForward&quot;:</span>
<a href="#l85.414"></a><span id="l85.414">         performNavigation(nsMsgNavigationType.forward);</span>
<a href="#l85.415"></a><span id="l85.415">         break;</span>
<a href="#l85.416"></a><span id="l85.416">       case &quot;cmd_applyFiltersToSelection&quot;:</span>
<a href="#l85.417"></a><span id="l85.417">         MsgApplyFiltersToSelection();</span>
<a href="#l85.418"></a><span id="l85.418">         break;</span>
<a href="#l85.419"></a><span id="l85.419"> 		}</span>
<a href="#l85.420"></a><span id="l85.420"> 	},</span>
<a href="#l85.421"></a><span id="l85.421" class="difflineminus">-	</span>
<a href="#l85.422"></a><span id="l85.422" class="difflineplus">+</span>
<a href="#l85.423"></a><span id="l85.423"> 	onEvent: function(event)</span>
<a href="#l85.424"></a><span id="l85.424"> 	{</span>
<a href="#l85.425"></a><span id="l85.425"> 	}</span>
<a href="#l85.426"></a><span id="l85.426"> };</span>
<a href="#l85.427"></a><span id="l85.427"> </span>
<a href="#l85.428"></a><span id="l85.428"> function LoadMessageByNavigationType(type)</span>
<a href="#l85.429"></a><span id="l85.429"> {</span>
<a href="#l85.430"></a><span id="l85.430">   var resultId = new Object;</span>
<a href="#l85.431"></a><span id="l85.431">   var resultIndex = new Object;</span>
<a href="#l85.432"></a><span id="l85.432">   var threadIndex = new Object;</span>
<a href="#l85.433"></a><span id="l85.433"> </span>
<a href="#l85.434"></a><span id="l85.434">   gDBView.viewNavigate(type, resultId, resultIndex, threadIndex, true /* wrap */);</span>
<a href="#l85.435"></a><span id="l85.435"> </span>
<a href="#l85.436"></a><span id="l85.436">   // if we found something....display it.</span>
<a href="#l85.437"></a><span id="l85.437" class="difflineminus">-  if ((resultId.value != nsMsgKey_None) &amp;&amp; (resultIndex.value != nsMsgKey_None)) </span>
<a href="#l85.438"></a><span id="l85.438" class="difflineplus">+  if ((resultId.value != nsMsgKey_None) &amp;&amp; (resultIndex.value != nsMsgKey_None))</span>
<a href="#l85.439"></a><span id="l85.439">   {</span>
<a href="#l85.440"></a><span id="l85.440">     // load the message key</span>
<a href="#l85.441"></a><span id="l85.441">     LoadMessageByMsgKey(resultId.value);</span>
<a href="#l85.442"></a><span id="l85.442">     // if we changed folders, the message counts changed.</span>
<a href="#l85.443"></a><span id="l85.443">     UpdateStandAloneMessageCounts();</span>
<a href="#l85.444"></a><span id="l85.444"> </span>
<a href="#l85.445"></a><span id="l85.445">     // new message has been loaded</span>
<a href="#l85.446"></a><span id="l85.446">     return true;</span>
<a href="#l85.447"></a><span id="l85.447">   }</span>
<a href="#l85.448"></a><span id="l85.448"> </span>
<a href="#l85.449"></a><span id="l85.449">   // no message found to load</span>
<a href="#l85.450"></a><span id="l85.450">   return false;</span>
<a href="#l85.451"></a><span id="l85.451"> }</span>
<a href="#l85.452"></a><span id="l85.452" class="difflineminus">-   </span>
<a href="#l85.453"></a><span id="l85.453" class="difflineplus">+</span>
<a href="#l85.454"></a><span id="l85.454"> function performNavigation(type)</span>
<a href="#l85.455"></a><span id="l85.455"> {</span>
<a href="#l85.456"></a><span id="l85.456">   // Try to load a message by navigation type if we can find</span>
<a href="#l85.457"></a><span id="l85.457">   // the message in the same folder.</span>
<a href="#l85.458"></a><span id="l85.458">   if (LoadMessageByNavigationType(type))</span>
<a href="#l85.459"></a><span id="l85.459">     return;</span>
<a href="#l85.460"></a><span id="l85.460" class="difflineminus">-   </span>
<a href="#l85.461"></a><span id="l85.461" class="difflineplus">+</span>
<a href="#l85.462"></a><span id="l85.462">   CrossFolderNavigation(type);</span>
<a href="#l85.463"></a><span id="l85.463"> }</span>
<a href="#l85.464"></a><span id="l85.464"> </span>
<a href="#l85.465"></a><span id="l85.465"> function SetupCommandUpdateHandlers()</span>
<a href="#l85.466"></a><span id="l85.466"> {</span>
<a href="#l85.467"></a><span id="l85.467">   top.controllers.insertControllerAt(0, MessageWindowController);</span>
<a href="#l85.468"></a><span id="l85.468"> }</span>
<a href="#l85.469"></a><span id="l85.469"> </span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l86.1"></a><span id="l86.1" class="difflineminus">--- a/suite/mailnews/msgViewNavigation.js</span>
<a href="#l86.2"></a><span id="l86.2" class="difflineplus">+++ b/suite/mailnews/msgViewNavigation.js</span>
<a href="#l86.3"></a><span id="l86.3" class="difflineat">@@ -46,17 +46,17 @@ function FindNextChildFolder(aParent, aA</span>
<a href="#l86.4"></a><span id="l86.4"> </span>
<a href="#l86.5"></a><span id="l86.5">     const nsMsgFolderFlags = Components.interfaces.nsMsgFolderFlags;</span>
<a href="#l86.6"></a><span id="l86.6">     let ignoreFlags = nsMsgFolderFlags.Trash | nsMsgFolderFlags.SentMail |</span>
<a href="#l86.7"></a><span id="l86.7">                       nsMsgFolderFlags.Drafts | nsMsgFolderFlags.Queue |</span>
<a href="#l86.8"></a><span id="l86.8">                       nsMsgFolderFlags.Templates | nsMsgFolderFlags.Junk;</span>
<a href="#l86.9"></a><span id="l86.9">     while (i &lt; subFolders.length) {</span>
<a href="#l86.10"></a><span id="l86.10">       folder = subFolders[i++];</span>
<a href="#l86.11"></a><span id="l86.11">       // if there is unread mail in the trash, sent, drafts, unsent messages</span>
<a href="#l86.12"></a><span id="l86.12" class="difflineminus">-      // templates or junk special folder, </span>
<a href="#l86.13"></a><span id="l86.13" class="difflineplus">+      // templates or junk special folder,</span>
<a href="#l86.14"></a><span id="l86.14">       // we ignore it when doing cross folder &quot;next&quot; navigation</span>
<a href="#l86.15"></a><span id="l86.15">       if (!folder.isSpecialFolder(ignoreFlags, true)) {</span>
<a href="#l86.16"></a><span id="l86.16">         if (folder.getNumUnread(false) &gt; 0)</span>
<a href="#l86.17"></a><span id="l86.17">           return folder;</span>
<a href="#l86.18"></a><span id="l86.18"> </span>
<a href="#l86.19"></a><span id="l86.19">         folder = FindNextChildFolder(folder, null);</span>
<a href="#l86.20"></a><span id="l86.20">         if (folder)</span>
<a href="#l86.21"></a><span id="l86.21">           return folder;</span>
<a href="#l86.22"></a><span id="l86.22" class="difflineat">@@ -81,37 +81,37 @@ function FindNextFolder()</span>
<a href="#l86.23"></a><span id="l86.23">   // go up to the parent, and start at the folder after the current one</span>
<a href="#l86.24"></a><span id="l86.24">   // unless we are at a server, in which case bail out.</span>
<a href="#l86.25"></a><span id="l86.25">   for (folder = gDBView.msgFolder; !folder.isServer; ) {</span>
<a href="#l86.26"></a><span id="l86.26"> </span>
<a href="#l86.27"></a><span id="l86.27">     var parent = folder.parent;</span>
<a href="#l86.28"></a><span id="l86.28">     folder = FindNextChildFolder(parent, folder);</span>
<a href="#l86.29"></a><span id="l86.29">     if (folder)</span>
<a href="#l86.30"></a><span id="l86.30">       return folder;</span>
<a href="#l86.31"></a><span id="l86.31" class="difflineminus">- </span>
<a href="#l86.32"></a><span id="l86.32" class="difflineplus">+</span>
<a href="#l86.33"></a><span id="l86.33">     // none at this level after the current folder.  go up.</span>
<a href="#l86.34"></a><span id="l86.34">     folder = parent;</span>
<a href="#l86.35"></a><span id="l86.35">   }</span>
<a href="#l86.36"></a><span id="l86.36"> </span>
<a href="#l86.37"></a><span id="l86.37">   // nothing in the current account, start with the next account (below)</span>
<a href="#l86.38"></a><span id="l86.38">   // and try until we hit the bottom of the folder pane</span>
<a href="#l86.39"></a><span id="l86.39"> </span>
<a href="#l86.40"></a><span id="l86.40">   // start at the account after the current account</span>
<a href="#l86.41"></a><span id="l86.41">   var rootFolders = GetRootFoldersInFolderPaneOrder();</span>
<a href="#l86.42"></a><span id="l86.42">   for (var i = 0; i &lt; rootFolders.length; i++) {</span>
<a href="#l86.43"></a><span id="l86.43">     if (rootFolders[i].URI == gDBView.msgFolder.server.serverURI)</span>
<a href="#l86.44"></a><span id="l86.44">       break;</span>
<a href="#l86.45"></a><span id="l86.45">   }</span>
<a href="#l86.46"></a><span id="l86.46" class="difflineminus">-  </span>
<a href="#l86.47"></a><span id="l86.47" class="difflineplus">+</span>
<a href="#l86.48"></a><span id="l86.48">   for (var j = i + 1; j &lt; rootFolders.length; j++) {</span>
<a href="#l86.49"></a><span id="l86.49">     folder = FindNextChildFolder(rootFolders[j], null);</span>
<a href="#l86.50"></a><span id="l86.50">     if (folder)</span>
<a href="#l86.51"></a><span id="l86.51">       return folder;</span>
<a href="#l86.52"></a><span id="l86.52">   }</span>
<a href="#l86.53"></a><span id="l86.53" class="difflineminus">-  </span>
<a href="#l86.54"></a><span id="l86.54" class="difflineplus">+</span>
<a href="#l86.55"></a><span id="l86.55">   // if nothing from the current account down to the bottom</span>
<a href="#l86.56"></a><span id="l86.56">   // (of the folder pane), start again at the top.</span>
<a href="#l86.57"></a><span id="l86.57">   for (j = 0; j &lt;= i; j++) {</span>
<a href="#l86.58"></a><span id="l86.58">     folder = FindNextChildFolder(rootFolders[j], null);</span>
<a href="#l86.59"></a><span id="l86.59">     if (folder)</span>
<a href="#l86.60"></a><span id="l86.60">       return folder;</span>
<a href="#l86.61"></a><span id="l86.61">   }</span>
<a href="#l86.62"></a><span id="l86.62">   return null;</span>
<a href="#l86.63"></a><span id="l86.63" class="difflineat">@@ -135,41 +135,41 @@ function CrossFolderNavigation(type)</span>
<a href="#l86.64"></a><span id="l86.64">       type != nsMsgNavigationType.nextUnreadThread &amp;&amp;</span>
<a href="#l86.65"></a><span id="l86.65">       type != nsMsgNavigationType.forward &amp;&amp;</span>
<a href="#l86.66"></a><span id="l86.66">       type != nsMsgNavigationType.back)</span>
<a href="#l86.67"></a><span id="l86.67">     return;</span>
<a href="#l86.68"></a><span id="l86.68"> </span>
<a href="#l86.69"></a><span id="l86.69">   if (type == nsMsgNavigationType.nextUnreadMessage ||</span>
<a href="#l86.70"></a><span id="l86.70">       type == nsMsgNavigationType.nextUnreadThread)</span>
<a href="#l86.71"></a><span id="l86.71">   {</span>
<a href="#l86.72"></a><span id="l86.72" class="difflineminus">-    </span>
<a href="#l86.73"></a><span id="l86.73" class="difflineplus">+</span>
<a href="#l86.74"></a><span id="l86.74">     var nextMode = Services.prefs.getIntPref(&quot;mailnews.nav_crosses_folders&quot;);</span>
<a href="#l86.75"></a><span id="l86.75">     // 0: &quot;next&quot; goes to the next folder, without prompting</span>
<a href="#l86.76"></a><span id="l86.76">     // 1: &quot;next&quot; goes to the next folder, and prompts (the default)</span>
<a href="#l86.77"></a><span id="l86.77">     // 2: &quot;next&quot; does nothing when there are no unread messages</span>
<a href="#l86.78"></a><span id="l86.78"> </span>
<a href="#l86.79"></a><span id="l86.79">     // not crossing folders, don't find next</span>
<a href="#l86.80"></a><span id="l86.80">     if (nextMode == 2)</span>
<a href="#l86.81"></a><span id="l86.81">       return;</span>
<a href="#l86.82"></a><span id="l86.82"> </span>
<a href="#l86.83"></a><span id="l86.83">     var folder = FindNextFolder();</span>
<a href="#l86.84"></a><span id="l86.84" class="difflineminus">-    if (folder &amp;&amp; (gDBView.msgFolder.URI != folder.URI)) </span>
<a href="#l86.85"></a><span id="l86.85" class="difflineplus">+    if (folder &amp;&amp; (gDBView.msgFolder.URI != folder.URI))</span>
<a href="#l86.86"></a><span id="l86.86">     {</span>
<a href="#l86.87"></a><span id="l86.87" class="difflineminus">-      switch (nextMode) </span>
<a href="#l86.88"></a><span id="l86.88" class="difflineplus">+      switch (nextMode)</span>
<a href="#l86.89"></a><span id="l86.89">       {</span>
<a href="#l86.90"></a><span id="l86.90">         case 0:</span>
<a href="#l86.91"></a><span id="l86.91">           // do this unconditionally</span>
<a href="#l86.92"></a><span id="l86.92">           gNextMessageAfterLoad = type;</span>
<a href="#l86.93"></a><span id="l86.93">           SelectFolder(folder.URI);</span>
<a href="#l86.94"></a><span id="l86.94">           break;</span>
<a href="#l86.95"></a><span id="l86.95">         case 1:</span>
<a href="#l86.96"></a><span id="l86.96">         default:</span>
<a href="#l86.97"></a><span id="l86.97" class="difflineminus">-          var promptText = gMessengerBundle.getFormattedString(&quot;advanceNextPrompt&quot;, [ folder.name ], 1); </span>
<a href="#l86.98"></a><span id="l86.98" class="difflineminus">-          if (Services.prompt.confirmEx(window, null, promptText, </span>
<a href="#l86.99"></a><span id="l86.99" class="difflineminus">-                                        Services.prompt.STD_YES_NO_BUTTONS, </span>
<a href="#l86.100"></a><span id="l86.100" class="difflineplus">+          var promptText = gMessengerBundle.getFormattedString(&quot;advanceNextPrompt&quot;, [ folder.name ], 1);</span>
<a href="#l86.101"></a><span id="l86.101" class="difflineplus">+          if (Services.prompt.confirmEx(window, null, promptText,</span>
<a href="#l86.102"></a><span id="l86.102" class="difflineplus">+                                        Services.prompt.STD_YES_NO_BUTTONS,</span>
<a href="#l86.103"></a><span id="l86.103">                                         null, null, null, null, {}) == 0)</span>
<a href="#l86.104"></a><span id="l86.104">           {</span>
<a href="#l86.105"></a><span id="l86.105">             gNextMessageAfterLoad = type;</span>
<a href="#l86.106"></a><span id="l86.106">             SelectFolder(folder.URI);</span>
<a href="#l86.107"></a><span id="l86.107">           }</span>
<a href="#l86.108"></a><span id="l86.108">           break;</span>
<a href="#l86.109"></a><span id="l86.109">       }</span>
<a href="#l86.110"></a><span id="l86.110">     }</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l87.1"></a><span id="l87.1" class="difflineminus">--- a/suite/mailnews/phishingDetector.js</span>
<a href="#l87.2"></a><span id="l87.2" class="difflineplus">+++ b/suite/mailnews/phishingDetector.js</span>
<a href="#l87.3"></a><span id="l87.3" class="difflineat">@@ -16,17 +16,17 @@ const kPhishingWithMismatchedHosts = 2;</span>
<a href="#l87.4"></a><span id="l87.4"> //////////////////////////////////////////////////////////////////////////////</span>
<a href="#l87.5"></a><span id="l87.5"> // isEmailScam --&gt; examines the message currently loaded in the message pane</span>
<a href="#l87.6"></a><span id="l87.6"> //                 and returns true if we think that message is an e-mail scam.</span>
<a href="#l87.7"></a><span id="l87.7"> //                 Assumes the message has been completely loaded in the message pane (i.e. OnMsgParsed has fired)</span>
<a href="#l87.8"></a><span id="l87.8"> // aUrl: nsIURI object for the msg we want to examine...</span>
<a href="#l87.9"></a><span id="l87.9"> //////////////////////////////////////////////////////////////////////////////</span>
<a href="#l87.10"></a><span id="l87.10"> function isMsgEmailScam(aUrl)</span>
<a href="#l87.11"></a><span id="l87.11"> {</span>
<a href="#l87.12"></a><span id="l87.12" class="difflineminus">-  var isEmailScam = false; </span>
<a href="#l87.13"></a><span id="l87.13" class="difflineplus">+  var isEmailScam = false;</span>
<a href="#l87.14"></a><span id="l87.14">   if (!aUrl || !Services.prefs.getBoolPref(&quot;mail.phishing.detection.enabled&quot;))</span>
<a href="#l87.15"></a><span id="l87.15">     return isEmailScam;</span>
<a href="#l87.16"></a><span id="l87.16"> </span>
<a href="#l87.17"></a><span id="l87.17">   try {</span>
<a href="#l87.18"></a><span id="l87.18">     // nsIMsgMailNewsUrl.folder can throw an NS_ERROR_FAILURE, especially if</span>
<a href="#l87.19"></a><span id="l87.19">     // we are opening an .eml file.</span>
<a href="#l87.20"></a><span id="l87.20">     var folder = aUrl.folder;</span>
<a href="#l87.21"></a><span id="l87.21"> </span>
<a href="#l87.22"></a><span id="l87.22" class="difflineat">@@ -85,17 +85,17 @@ function isPhishingURL(aLinkNode, aSilen</span>
<a href="#l87.23"></a><span id="l87.23">   var href = aHref || aLinkNode.href;</span>
<a href="#l87.24"></a><span id="l87.24">   if (!href)</span>
<a href="#l87.25"></a><span id="l87.25">     return false;</span>
<a href="#l87.26"></a><span id="l87.26"> </span>
<a href="#l87.27"></a><span id="l87.27">   var linkTextURL = {};</span>
<a href="#l87.28"></a><span id="l87.28">   var isPhishingURL = false;</span>
<a href="#l87.29"></a><span id="l87.29"> </span>
<a href="#l87.30"></a><span id="l87.30">   var hrefURL = Services.io.newURI(href, null, null);</span>
<a href="#l87.31"></a><span id="l87.31" class="difflineminus">-  </span>
<a href="#l87.32"></a><span id="l87.32" class="difflineplus">+</span>
<a href="#l87.33"></a><span id="l87.33">   // only check for phishing urls if the url is an http or https link.</span>
<a href="#l87.34"></a><span id="l87.34">   // this prevents us from flagging imap and other internally handled urls</span>
<a href="#l87.35"></a><span id="l87.35">   if (hrefURL.schemeIs('http') || hrefURL.schemeIs('https'))</span>
<a href="#l87.36"></a><span id="l87.36">   {</span>
<a href="#l87.37"></a><span id="l87.37">     let ipAddress = isLegalIPAddress(hrefURL.host, true);</span>
<a href="#l87.38"></a><span id="l87.38">     if (ipAddress &amp;&amp; !isLegalLocalIPAddress(ipAddress))</span>
<a href="#l87.39"></a><span id="l87.39">       phishingType = kPhishingWithIPAddress;</span>
<a href="#l87.40"></a><span id="l87.40">     else if (misMatchedHostWithLinkText(aLinkNode, hrefURL, linkTextURL))</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l88.1"></a><span id="l88.1" class="difflineminus">--- a/suite/mailnews/prefs/pref-tags.js</span>
<a href="#l88.2"></a><span id="l88.2" class="difflineplus">+++ b/suite/mailnews/prefs/pref-tags.js</span>
<a href="#l88.3"></a><span id="l88.3" class="difflineat">@@ -161,17 +161,17 @@ function BisectString(aPrev, aNext)</span>
<a href="#l88.4"></a><span id="l88.4">   for (var i = 0; i &lt; lenMax; ++i)</span>
<a href="#l88.5"></a><span id="l88.5">   {</span>
<a href="#l88.6"></a><span id="l88.6">     var prevChar = (i &lt; lenPrev) ? aPrev[i] : kOrdinalPadding;</span>
<a href="#l88.7"></a><span id="l88.7">     var nextChar = constructing ? kOrdinalCharHigh</span>
<a href="#l88.8"></a><span id="l88.8">                                 : (i &lt; lenNext) ? aNext[i]</span>
<a href="#l88.9"></a><span id="l88.9">                                                 : kOrdinalPadding;</span>
<a href="#l88.10"></a><span id="l88.10">     var prevCode = prevChar.charCodeAt(0);</span>
<a href="#l88.11"></a><span id="l88.11">     var nextCode = nextChar.charCodeAt(0);</span>
<a href="#l88.12"></a><span id="l88.12" class="difflineminus">-    if (prevCode == nextCode) </span>
<a href="#l88.13"></a><span id="l88.13" class="difflineplus">+    if (prevCode == nextCode)</span>
<a href="#l88.14"></a><span id="l88.14">     {</span>
<a href="#l88.15"></a><span id="l88.15">       // copy common characters</span>
<a href="#l88.16"></a><span id="l88.16">       result += prevChar;</span>
<a href="#l88.17"></a><span id="l88.17">     }</span>
<a href="#l88.18"></a><span id="l88.18">     else if (prevCode + 1 &lt; nextCode)</span>
<a href="#l88.19"></a><span id="l88.19">     {</span>
<a href="#l88.20"></a><span id="l88.20">       // found a real bisecting string</span>
<a href="#l88.21"></a><span id="l88.21">       result += String.fromCharCode((prevCode + nextCode) / 2);</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l89.1"></a><span id="l89.1" class="difflineminus">--- a/suite/mailnews/search/ABSearchDialog.js</span>
<a href="#l89.2"></a><span id="l89.2" class="difflineplus">+++ b/suite/mailnews/search/ABSearchDialog.js</span>
<a href="#l89.3"></a><span id="l89.3" class="difflineat">@@ -84,32 +84,32 @@ function initializeSearchWindowWidgets()</span>
<a href="#l89.4"></a><span id="l89.4">   gSearchStopButton = document.getElementById(&quot;search-button&quot;);</span>
<a href="#l89.5"></a><span id="l89.5">   gPropertiesButton = document.getElementById(&quot;propertiesButton&quot;);</span>
<a href="#l89.6"></a><span id="l89.6">   gComposeButton = document.getElementById(&quot;composeButton&quot;);</span>
<a href="#l89.7"></a><span id="l89.7">   gStatusText = document.getElementById('statusText');</span>
<a href="#l89.8"></a><span id="l89.8">   // matchAll doesn't make sense for address book search</span>
<a href="#l89.9"></a><span id="l89.9">   hideMatchAllItem();</span>
<a href="#l89.10"></a><span id="l89.10"> }</span>
<a href="#l89.11"></a><span id="l89.11"> </span>
<a href="#l89.12"></a><span id="l89.12" class="difflineminus">-function onSearchStop() </span>
<a href="#l89.13"></a><span id="l89.13" class="difflineplus">+function onSearchStop()</span>
<a href="#l89.14"></a><span id="l89.14"> {</span>
<a href="#l89.15"></a><span id="l89.15"> }</span>
<a href="#l89.16"></a><span id="l89.16"> </span>
<a href="#l89.17"></a><span id="l89.17" class="difflineminus">-function onAbSearchReset(event) </span>
<a href="#l89.18"></a><span id="l89.18" class="difflineplus">+function onAbSearchReset(event)</span>
<a href="#l89.19"></a><span id="l89.19"> {</span>
<a href="#l89.20"></a><span id="l89.20">   gPropertiesButton.setAttribute(&quot;disabled&quot;,&quot;true&quot;);</span>
<a href="#l89.21"></a><span id="l89.21">   gComposeButton.setAttribute(&quot;disabled&quot;,&quot;true&quot;);</span>
<a href="#l89.22"></a><span id="l89.22"> </span>
<a href="#l89.23"></a><span id="l89.23">   CloseAbView();</span>
<a href="#l89.24"></a><span id="l89.24"> </span>
<a href="#l89.25"></a><span id="l89.25">   onReset(event);</span>
<a href="#l89.26"></a><span id="l89.26">   gStatusText.setAttribute(&quot;label&quot;, &quot;&quot;);</span>
<a href="#l89.27"></a><span id="l89.27"> }</span>
<a href="#l89.28"></a><span id="l89.28"> </span>
<a href="#l89.29"></a><span id="l89.29" class="difflineminus">-function SelectDirectory(aURI) </span>
<a href="#l89.30"></a><span id="l89.30" class="difflineplus">+function SelectDirectory(aURI)</span>
<a href="#l89.31"></a><span id="l89.31"> {</span>
<a href="#l89.32"></a><span id="l89.32">   var selectedAB = aURI;</span>
<a href="#l89.33"></a><span id="l89.33"> </span>
<a href="#l89.34"></a><span id="l89.34">   if (!selectedAB)</span>
<a href="#l89.35"></a><span id="l89.35">     selectedAB = kPersonalAddressbookURI;</span>
<a href="#l89.36"></a><span id="l89.36"> </span>
<a href="#l89.37"></a><span id="l89.37">   // set popup with address book names</span>
<a href="#l89.38"></a><span id="l89.38">   var abPopup = document.getElementById('abPopup');</span>
<a href="#l89.39"></a><span id="l89.39" class="difflineat">@@ -122,64 +122,64 @@ function SelectDirectory(aURI)</span>
<a href="#l89.40"></a><span id="l89.40"> function GetScopeForDirectoryURI(aURI)</span>
<a href="#l89.41"></a><span id="l89.41"> {</span>
<a href="#l89.42"></a><span id="l89.42">   var directory = MailServices.ab.getDirectory(aURI);</span>
<a href="#l89.43"></a><span id="l89.43">   var booleanAnd = gSearchBooleanRadiogroup.selectedItem.value == &quot;and&quot;;</span>
<a href="#l89.44"></a><span id="l89.44"> </span>
<a href="#l89.45"></a><span id="l89.45">   if (directory.isRemote) {</span>
<a href="#l89.46"></a><span id="l89.46">     if (booleanAnd)</span>
<a href="#l89.47"></a><span id="l89.47">       return nsMsgSearchScope.LDAPAnd;</span>
<a href="#l89.48"></a><span id="l89.48" class="difflineminus">-    else </span>
<a href="#l89.49"></a><span id="l89.49" class="difflineplus">+    else</span>
<a href="#l89.50"></a><span id="l89.50">       return nsMsgSearchScope.LDAP;</span>
<a href="#l89.51"></a><span id="l89.51">   }</span>
<a href="#l89.52"></a><span id="l89.52">   else {</span>
<a href="#l89.53"></a><span id="l89.53">     if (booleanAnd)</span>
<a href="#l89.54"></a><span id="l89.54">       return nsMsgSearchScope.LocalABAnd;</span>
<a href="#l89.55"></a><span id="l89.55" class="difflineminus">-    else </span>
<a href="#l89.56"></a><span id="l89.56" class="difflineplus">+    else</span>
<a href="#l89.57"></a><span id="l89.57">       return nsMsgSearchScope.LocalAB;</span>
<a href="#l89.58"></a><span id="l89.58">   }</span>
<a href="#l89.59"></a><span id="l89.59"> }</span>
<a href="#l89.60"></a><span id="l89.60"> </span>
<a href="#l89.61"></a><span id="l89.61"> function onEnterInSearchTerm()</span>
<a href="#l89.62"></a><span id="l89.62"> {</span>
<a href="#l89.63"></a><span id="l89.63">   // on enter</span>
<a href="#l89.64"></a><span id="l89.64">   // if not searching, start the search</span>
<a href="#l89.65"></a><span id="l89.65">   // if searching, stop and then start again</span>
<a href="#l89.66"></a><span id="l89.66" class="difflineminus">-  if (gSearchStopButton.getAttribute(&quot;label&quot;) == gSearchBundle.getString(&quot;labelForSearchButton&quot;)) { </span>
<a href="#l89.67"></a><span id="l89.67" class="difflineminus">-     onSearch(); </span>
<a href="#l89.68"></a><span id="l89.68" class="difflineplus">+  if (gSearchStopButton.getAttribute(&quot;label&quot;) == gSearchBundle.getString(&quot;labelForSearchButton&quot;)) {</span>
<a href="#l89.69"></a><span id="l89.69" class="difflineplus">+     onSearch();</span>
<a href="#l89.70"></a><span id="l89.70">   }</span>
<a href="#l89.71"></a><span id="l89.71">   else {</span>
<a href="#l89.72"></a><span id="l89.72">      onSearchStop();</span>
<a href="#l89.73"></a><span id="l89.73">      onSearch();</span>
<a href="#l89.74"></a><span id="l89.74">   }</span>
<a href="#l89.75"></a><span id="l89.75"> }</span>
<a href="#l89.76"></a><span id="l89.76"> </span>
<a href="#l89.77"></a><span id="l89.77"> function onSearch()</span>
<a href="#l89.78"></a><span id="l89.78"> {</span>
<a href="#l89.79"></a><span id="l89.79">     gStatusText.setAttribute(&quot;label&quot;, &quot;&quot;);</span>
<a href="#l89.80"></a><span id="l89.80">     gPropertiesButton.setAttribute(&quot;disabled&quot;,&quot;true&quot;);</span>
<a href="#l89.81"></a><span id="l89.81">     gComposeButton.setAttribute(&quot;disabled&quot;,&quot;true&quot;);</span>
<a href="#l89.82"></a><span id="l89.82"> </span>
<a href="#l89.83"></a><span id="l89.83">     gSearchSession.clearScopes();</span>
<a href="#l89.84"></a><span id="l89.84"> </span>
<a href="#l89.85"></a><span id="l89.85">     var currentAbURI = document.getElementById('abPopup').getAttribute('value');</span>
<a href="#l89.86"></a><span id="l89.86" class="difflineminus">- </span>
<a href="#l89.87"></a><span id="l89.87" class="difflineplus">+</span>
<a href="#l89.88"></a><span id="l89.88">     gSearchSession.addDirectoryScopeTerm(GetScopeForDirectoryURI(currentAbURI));</span>
<a href="#l89.89"></a><span id="l89.89">     saveSearchTerms(gSearchSession.searchTerms, gSearchSession);</span>
<a href="#l89.90"></a><span id="l89.90"> </span>
<a href="#l89.91"></a><span id="l89.91">     var searchUri = currentAbURI + &quot;?(&quot;;</span>
<a href="#l89.92"></a><span id="l89.92"> </span>
<a href="#l89.93"></a><span id="l89.93">     var count = gSearchSession.searchTerms.Count();</span>
<a href="#l89.94"></a><span id="l89.94"> </span>
<a href="#l89.95"></a><span id="l89.95">     for (var i=0; i&lt;count; i++) {</span>
<a href="#l89.96"></a><span id="l89.96">       var searchTerm = gSearchSession.searchTerms.GetElementAt(i).QueryInterface(nsIMsgSearchTerm);</span>
<a href="#l89.97"></a><span id="l89.97"> </span>
<a href="#l89.98"></a><span id="l89.98">       // get the &quot;and&quot; / &quot;or&quot; value from the first term</span>
<a href="#l89.99"></a><span id="l89.99">       if (i == 0) {</span>
<a href="#l89.100"></a><span id="l89.100" class="difflineminus">-       if (searchTerm.booleanAnd) </span>
<a href="#l89.101"></a><span id="l89.101" class="difflineplus">+       if (searchTerm.booleanAnd)</span>
<a href="#l89.102"></a><span id="l89.102">          searchUri += &quot;and&quot;;</span>
<a href="#l89.103"></a><span id="l89.103">        else</span>
<a href="#l89.104"></a><span id="l89.104">          searchUri += &quot;or&quot;;</span>
<a href="#l89.105"></a><span id="l89.105">       }</span>
<a href="#l89.106"></a><span id="l89.106"> </span>
<a href="#l89.107"></a><span id="l89.107">       var attrs;</span>
<a href="#l89.108"></a><span id="l89.108"> </span>
<a href="#l89.109"></a><span id="l89.109">       switch (searchTerm.attrib) {</span>
<a href="#l89.110"></a><span id="l89.110" class="difflineat">@@ -191,17 +191,17 @@ function onSearch()</span>
<a href="#l89.111"></a><span id="l89.111">          break;</span>
<a href="#l89.112"></a><span id="l89.112">        case nsMsgSearchAttrib.DisplayName:</span>
<a href="#l89.113"></a><span id="l89.113">          attrs = [&quot;DisplayName&quot;];</span>
<a href="#l89.114"></a><span id="l89.114">          break;</span>
<a href="#l89.115"></a><span id="l89.115">        case nsMsgSearchAttrib.Email:</span>
<a href="#l89.116"></a><span id="l89.116">          attrs = [&quot;PrimaryEmail&quot;];</span>
<a href="#l89.117"></a><span id="l89.117">          break;</span>
<a href="#l89.118"></a><span id="l89.118">        case nsMsgSearchAttrib.PhoneNumber:</span>
<a href="#l89.119"></a><span id="l89.119" class="difflineminus">-         attrs = [&quot;HomePhone&quot;,&quot;WorkPhone&quot;,&quot;FaxNumber&quot;,&quot;PagerNumber&quot;,&quot;CellularNumber&quot;]; </span>
<a href="#l89.120"></a><span id="l89.120" class="difflineplus">+         attrs = [&quot;HomePhone&quot;,&quot;WorkPhone&quot;,&quot;FaxNumber&quot;,&quot;PagerNumber&quot;,&quot;CellularNumber&quot;];</span>
<a href="#l89.121"></a><span id="l89.121">          break;</span>
<a href="#l89.122"></a><span id="l89.122">        case nsMsgSearchAttrib.Organization:</span>
<a href="#l89.123"></a><span id="l89.123">          attrs = [&quot;Company&quot;];</span>
<a href="#l89.124"></a><span id="l89.124">          break;</span>
<a href="#l89.125"></a><span id="l89.125">        case nsMsgSearchAttrib.Department:</span>
<a href="#l89.126"></a><span id="l89.126">          attrs = [&quot;Department&quot;];</span>
<a href="#l89.127"></a><span id="l89.127">          break;</span>
<a href="#l89.128"></a><span id="l89.128">        case nsMsgSearchAttrib.City:</span>
<a href="#l89.129"></a><span id="l89.129" class="difflineat">@@ -322,13 +322,13 @@ function UpdateCardView()</span>
<a href="#l89.130"></a><span id="l89.130">   if (!numSelected) {</span>
<a href="#l89.131"></a><span id="l89.131">     gPropertiesButton.setAttribute(&quot;disabled&quot;,&quot;true&quot;);</span>
<a href="#l89.132"></a><span id="l89.132">     gComposeButton.setAttribute(&quot;disabled&quot;,&quot;true&quot;);</span>
<a href="#l89.133"></a><span id="l89.133">     return;</span>
<a href="#l89.134"></a><span id="l89.134">   }</span>
<a href="#l89.135"></a><span id="l89.135"> </span>
<a href="#l89.136"></a><span id="l89.136">   gComposeButton.removeAttribute(&quot;disabled&quot;);</span>
<a href="#l89.137"></a><span id="l89.137"> </span>
<a href="#l89.138"></a><span id="l89.138" class="difflineminus">-  if (numSelected == 1) </span>
<a href="#l89.139"></a><span id="l89.139" class="difflineplus">+  if (numSelected == 1)</span>
<a href="#l89.140"></a><span id="l89.140">     gPropertiesButton.removeAttribute(&quot;disabled&quot;);</span>
<a href="#l89.141"></a><span id="l89.141">   else</span>
<a href="#l89.142"></a><span id="l89.142">     gPropertiesButton.setAttribute(&quot;disabled&quot;,&quot;true&quot;);</span>
<a href="#l89.143"></a><span id="l89.143"> }</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l90.1"></a><span id="l90.1" class="difflineminus">--- a/suite/mailnews/search/FilterListDialog.js</span>
<a href="#l90.2"></a><span id="l90.2" class="difflineplus">+++ b/suite/mailnews/search/FilterListDialog.js</span>
<a href="#l90.3"></a><span id="l90.3" class="difflineat">@@ -27,17 +27,17 @@ var gStatusFeedback = {</span>
<a href="#l90.4"></a><span id="l90.4">   },</span>
<a href="#l90.5"></a><span id="l90.5"> 	startMeteors: function()</span>
<a href="#l90.6"></a><span id="l90.6">   {</span>
<a href="#l90.7"></a><span id="l90.7">     // change run button to be a stop button</span>
<a href="#l90.8"></a><span id="l90.8">     gRunFiltersButton.setAttribute(&quot;label&quot;, gRunFiltersButton.getAttribute(&quot;stoplabel&quot;));</span>
<a href="#l90.9"></a><span id="l90.9">     gRunFiltersButton.setAttribute(&quot;accesskey&quot;, gRunFiltersButton.getAttribute(&quot;stopaccesskey&quot;));</span>
<a href="#l90.10"></a><span id="l90.10">     gStatusBar.setAttribute(&quot;mode&quot;, &quot;undetermined&quot;);</span>
<a href="#l90.11"></a><span id="l90.11">   },</span>
<a href="#l90.12"></a><span id="l90.12" class="difflineminus">-	stopMeteors: function() </span>
<a href="#l90.13"></a><span id="l90.13" class="difflineplus">+	stopMeteors: function()</span>
<a href="#l90.14"></a><span id="l90.14">   {</span>
<a href="#l90.15"></a><span id="l90.15">     try {</span>
<a href="#l90.16"></a><span id="l90.16">       // change run button to be a stop button</span>
<a href="#l90.17"></a><span id="l90.17">       gRunFiltersButton.setAttribute(&quot;label&quot;, gRunFiltersButton.getAttribute(&quot;runlabel&quot;));</span>
<a href="#l90.18"></a><span id="l90.18">       gRunFiltersButton.setAttribute(&quot;accesskey&quot;, gRunFiltersButton.getAttribute(&quot;runaccesskey&quot;));</span>
<a href="#l90.19"></a><span id="l90.19">       gStatusBar.setAttribute(&quot;mode&quot;, &quot;normal&quot;);</span>
<a href="#l90.20"></a><span id="l90.20">     }</span>
<a href="#l90.21"></a><span id="l90.21">     catch (ex) {</span>
<a href="#l90.22"></a><span id="l90.22" class="difflineat">@@ -122,18 +122,18 @@ var gFilterTreeView = {</span>
<a href="#l90.23"></a><span id="l90.23"> }</span>
<a href="#l90.24"></a><span id="l90.24"> </span>
<a href="#l90.25"></a><span id="l90.25"> const nsMsgFilterMotion = Components.interfaces.nsMsgFilterMotion;</span>
<a href="#l90.26"></a><span id="l90.26"> </span>
<a href="#l90.27"></a><span id="l90.27"> function onLoad()</span>
<a href="#l90.28"></a><span id="l90.28"> {</span>
<a href="#l90.29"></a><span id="l90.29">     setHelpFileURI(&quot;chrome://communicator/locale/help/suitehelp.rdf&quot;);</span>
<a href="#l90.30"></a><span id="l90.30">     gFilterListMsgWindow = Components.classes[&quot;@mozilla.org/messenger/msgwindow;1&quot;].createInstance(Components.interfaces.nsIMsgWindow);</span>
<a href="#l90.31"></a><span id="l90.31" class="difflineminus">-    gFilterListMsgWindow.domWindow = window; </span>
<a href="#l90.32"></a><span id="l90.32" class="difflineminus">-    gFilterListMsgWindow.rootDocShell.appType = Components.interfaces.nsIDocShell.APP_TYPE_MAIL;   </span>
<a href="#l90.33"></a><span id="l90.33" class="difflineplus">+    gFilterListMsgWindow.domWindow = window;</span>
<a href="#l90.34"></a><span id="l90.34" class="difflineplus">+    gFilterListMsgWindow.rootDocShell.appType = Components.interfaces.nsIDocShell.APP_TYPE_MAIL;</span>
<a href="#l90.35"></a><span id="l90.35">     gFilterListMsgWindow.statusFeedback = gStatusFeedback;</span>
<a href="#l90.36"></a><span id="l90.36"> </span>
<a href="#l90.37"></a><span id="l90.37">     gFilterBundle = document.getElementById(&quot;bundle_filter&quot;);</span>
<a href="#l90.38"></a><span id="l90.38">     gFilterTree = document.getElementById(&quot;filterTree&quot;);</span>
<a href="#l90.39"></a><span id="l90.39"> </span>
<a href="#l90.40"></a><span id="l90.40">     gEditButton = document.getElementById(&quot;editButton&quot;);</span>
<a href="#l90.41"></a><span id="l90.41">     gDeleteButton = document.getElementById(&quot;deleteButton&quot;);</span>
<a href="#l90.42"></a><span id="l90.42">     gReorderUpButton = document.getElementById(&quot;reorderUpButton&quot;);</span>
<a href="#l90.43"></a><span id="l90.43" class="difflineat">@@ -283,34 +283,34 @@ function currentFilterList()</span>
<a href="#l90.44"></a><span id="l90.44">   return gFilterTreeView.filterList;</span>
<a href="#l90.45"></a><span id="l90.45"> }</span>
<a href="#l90.46"></a><span id="l90.46"> </span>
<a href="#l90.47"></a><span id="l90.47"> function onFilterSelect(event)</span>
<a href="#l90.48"></a><span id="l90.48"> {</span>
<a href="#l90.49"></a><span id="l90.49">     updateButtons();</span>
<a href="#l90.50"></a><span id="l90.50"> }</span>
<a href="#l90.51"></a><span id="l90.51"> </span>
<a href="#l90.52"></a><span id="l90.52" class="difflineminus">-function onEditFilter() </span>
<a href="#l90.53"></a><span id="l90.53" class="difflineplus">+function onEditFilter()</span>
<a href="#l90.54"></a><span id="l90.54"> {</span>
<a href="#l90.55"></a><span id="l90.55">   var selectedFilter = currentFilter();</span>
<a href="#l90.56"></a><span id="l90.56">   var curFilterList = currentFilterList();</span>
<a href="#l90.57"></a><span id="l90.57">   var args = {filter: selectedFilter, filterList: curFilterList};</span>
<a href="#l90.58"></a><span id="l90.58"> </span>
<a href="#l90.59"></a><span id="l90.59">   window.openDialog(&quot;chrome://messenger/content/FilterEditor.xul&quot;, &quot;FilterEditor&quot;, &quot;chrome,modal,titlebar,resizable,centerscreen&quot;, args);</span>
<a href="#l90.60"></a><span id="l90.60"> </span>
<a href="#l90.61"></a><span id="l90.61">   // The focus change will cause a repaint of the row updating any name change</span>
<a href="#l90.62"></a><span id="l90.62"> }</span>
<a href="#l90.63"></a><span id="l90.63"> </span>
<a href="#l90.64"></a><span id="l90.64"> function onNewFilter(emailAddress)</span>
<a href="#l90.65"></a><span id="l90.65"> {</span>
<a href="#l90.66"></a><span id="l90.66">   var curFilterList = currentFilterList();</span>
<a href="#l90.67"></a><span id="l90.67">   var position = Math.max(gFilterTree.currentIndex, 0);</span>
<a href="#l90.68"></a><span id="l90.68">   var args = {filterList: curFilterList,</span>
<a href="#l90.69"></a><span id="l90.69">               filterPosition: position, refresh: false};</span>
<a href="#l90.70"></a><span id="l90.70" class="difflineminus">-  </span>
<a href="#l90.71"></a><span id="l90.71" class="difflineplus">+</span>
<a href="#l90.72"></a><span id="l90.72">   window.openDialog(&quot;chrome://messenger/content/FilterEditor.xul&quot;, &quot;FilterEditor&quot;, &quot;chrome,modal,titlebar,resizable,centerscreen&quot;, args);</span>
<a href="#l90.73"></a><span id="l90.73"> </span>
<a href="#l90.74"></a><span id="l90.74">   if (args.refresh)</span>
<a href="#l90.75"></a><span id="l90.75">   {</span>
<a href="#l90.76"></a><span id="l90.76">     gFilterTreeView.tree.rowCountChanged(position, 1);</span>
<a href="#l90.77"></a><span id="l90.77">     gFilterTree.view.selection.select(position);</span>
<a href="#l90.78"></a><span id="l90.78">     gFilterTree.treeBoxObject.ensureRowIsVisible(position);</span>
<a href="#l90.79"></a><span id="l90.79">   }</span>
<a href="#l90.80"></a><span id="l90.80" class="difflineat">@@ -319,18 +319,18 @@ function onNewFilter(emailAddress)</span>
<a href="#l90.81"></a><span id="l90.81"> function onDeleteFilter()</span>
<a href="#l90.82"></a><span id="l90.82"> {</span>
<a href="#l90.83"></a><span id="l90.83">   var filterList = currentFilterList();</span>
<a href="#l90.84"></a><span id="l90.84">   if (!filterList)</span>
<a href="#l90.85"></a><span id="l90.85">     return;</span>
<a href="#l90.86"></a><span id="l90.86"> </span>
<a href="#l90.87"></a><span id="l90.87">   var sel = gFilterTree.view.selection;</span>
<a href="#l90.88"></a><span id="l90.88">   var selCount = sel.getRangeCount();</span>
<a href="#l90.89"></a><span id="l90.89" class="difflineminus">-  if (!selCount || </span>
<a href="#l90.90"></a><span id="l90.90" class="difflineminus">-      Services.prompt.confirmEx(window, null, </span>
<a href="#l90.91"></a><span id="l90.91" class="difflineplus">+  if (!selCount ||</span>
<a href="#l90.92"></a><span id="l90.92" class="difflineplus">+      Services.prompt.confirmEx(window, null,</span>
<a href="#l90.93"></a><span id="l90.93">                         gFilterBundle.getString(&quot;deleteFilterConfirmation&quot;),</span>
<a href="#l90.94"></a><span id="l90.94">                         Services.prompt.STD_YES_NO_BUTTONS,</span>
<a href="#l90.95"></a><span id="l90.95">                         '', '', '', '', {}))</span>
<a href="#l90.96"></a><span id="l90.96">     return;</span>
<a href="#l90.97"></a><span id="l90.97"> </span>
<a href="#l90.98"></a><span id="l90.98">   for (var i = selCount - 1; i &gt;= 0; --i) {</span>
<a href="#l90.99"></a><span id="l90.99">     var start = {}, end = {};</span>
<a href="#l90.100"></a><span id="l90.100">     sel.getRangeAt(i, start, end);</span>
<a href="#l90.101"></a><span id="l90.101" class="difflineat">@@ -360,17 +360,17 @@ function viewLog()</span>
<a href="#l90.102"></a><span id="l90.102"> </span>
<a href="#l90.103"></a><span id="l90.103">   window.openDialog(&quot;chrome://messenger/content/viewLog.xul&quot;, &quot;FilterLog&quot;, &quot;chrome,modal,titlebar,resizable,centerscreen&quot;, args);</span>
<a href="#l90.104"></a><span id="l90.104"> }</span>
<a href="#l90.105"></a><span id="l90.105"> </span>
<a href="#l90.106"></a><span id="l90.106"> function onFilterUnload()</span>
<a href="#l90.107"></a><span id="l90.107"> {</span>
<a href="#l90.108"></a><span id="l90.108">   // make sure to save the filter to disk</span>
<a href="#l90.109"></a><span id="l90.109">   var filterList = currentFilterList();</span>
<a href="#l90.110"></a><span id="l90.110" class="difflineminus">-  if (filterList) </span>
<a href="#l90.111"></a><span id="l90.111" class="difflineplus">+  if (filterList)</span>
<a href="#l90.112"></a><span id="l90.112">     filterList.saveToDefaultFile();</span>
<a href="#l90.113"></a><span id="l90.113"> </span>
<a href="#l90.114"></a><span id="l90.114">   Services.obs.removeObserver(onFilterClose, &quot;quit-application-requested&quot;);</span>
<a href="#l90.115"></a><span id="l90.115">   top.controllers.removeController(gFilterController);</span>
<a href="#l90.116"></a><span id="l90.116"> }</span>
<a href="#l90.117"></a><span id="l90.117"> </span>
<a href="#l90.118"></a><span id="l90.118"> function onFilterClose(aCancelQuit, aTopic, aData)</span>
<a href="#l90.119"></a><span id="l90.119"> {</span>
<a href="#l90.120"></a><span id="l90.120" class="difflineat">@@ -402,17 +402,17 @@ function onFilterClose(aCancelQuit, aTop</span>
<a href="#l90.121"></a><span id="l90.121"> </span>
<a href="#l90.122"></a><span id="l90.122"> function runSelectedFilters()</span>
<a href="#l90.123"></a><span id="l90.123"> {</span>
<a href="#l90.124"></a><span id="l90.124">   // if run button has &quot;stop&quot; label, do stop.</span>
<a href="#l90.125"></a><span id="l90.125">   if (gRunFiltersButton.getAttribute(&quot;label&quot;) == gRunFiltersButton.getAttribute(&quot;stoplabel&quot;)) {</span>
<a href="#l90.126"></a><span id="l90.126">     gFilterListMsgWindow.StopUrls();</span>
<a href="#l90.127"></a><span id="l90.127">     return;</span>
<a href="#l90.128"></a><span id="l90.128">   }</span>
<a href="#l90.129"></a><span id="l90.129" class="difflineminus">-  </span>
<a href="#l90.130"></a><span id="l90.130" class="difflineplus">+</span>
<a href="#l90.131"></a><span id="l90.131">   var msgFolder = gRunFiltersFolderPicker._folder || gRunFiltersFolderPicker.selectedItem._folder;</span>
<a href="#l90.132"></a><span id="l90.132">   var filterList = MailServices.filters.getTempFilterList(msgFolder);</span>
<a href="#l90.133"></a><span id="l90.133">   var folders = Components.classes[&quot;@mozilla.org/array;1&quot;]</span>
<a href="#l90.134"></a><span id="l90.134">                           .createInstance(Components.interfaces.nsIMutableArray);</span>
<a href="#l90.135"></a><span id="l90.135">   folders.appendElement(msgFolder, false);</span>
<a href="#l90.136"></a><span id="l90.136"> </span>
<a href="#l90.137"></a><span id="l90.137">   // make sure the tmp filter list uses the real filter list log stream</span>
<a href="#l90.138"></a><span id="l90.138">   filterList.logStream = currentFilterList().logStream;</span>
<a href="#l90.139"></a><span id="l90.139" class="difflineat">@@ -430,17 +430,17 @@ function runSelectedFilters()</span>
<a href="#l90.140"></a><span id="l90.140"> </span>
<a href="#l90.141"></a><span id="l90.141">   MailServices.filters.applyFiltersToFolders(filterList, folders, gFilterListMsgWindow);</span>
<a href="#l90.142"></a><span id="l90.142"> }</span>
<a href="#l90.143"></a><span id="l90.143"> </span>
<a href="#l90.144"></a><span id="l90.144"> function moveCurrentFilter(motion)</span>
<a href="#l90.145"></a><span id="l90.145"> {</span>
<a href="#l90.146"></a><span id="l90.146">     var filterList = currentFilterList();</span>
<a href="#l90.147"></a><span id="l90.147">     var filter = currentFilter();</span>
<a href="#l90.148"></a><span id="l90.148" class="difflineminus">-    if (!filterList || !filter) </span>
<a href="#l90.149"></a><span id="l90.149" class="difflineplus">+    if (!filterList || !filter)</span>
<a href="#l90.150"></a><span id="l90.150">       return;</span>
<a href="#l90.151"></a><span id="l90.151"> </span>
<a href="#l90.152"></a><span id="l90.152">     filterList.moveFilter(filter, motion);</span>
<a href="#l90.153"></a><span id="l90.153">     if (motion == nsMsgFilterMotion.up)</span>
<a href="#l90.154"></a><span id="l90.154">       gFilterTree.view.selection.select(gFilterTree.currentIndex - 1);</span>
<a href="#l90.155"></a><span id="l90.155">     else</span>
<a href="#l90.156"></a><span id="l90.156">       gFilterTree.view.selection.select(gFilterTree.currentIndex + 1);</span>
<a href="#l90.157"></a><span id="l90.157"> </span>
<a href="#l90.158"></a><span id="l90.158" class="difflineat">@@ -450,17 +450,17 @@ function moveCurrentFilter(motion)</span>
<a href="#l90.159"></a><span id="l90.159"> function updateButtons()</span>
<a href="#l90.160"></a><span id="l90.160"> {</span>
<a href="#l90.161"></a><span id="l90.161">     var numFiltersSelected = gFilterTree.view.selection.count;</span>
<a href="#l90.162"></a><span id="l90.162">     var oneFilterSelected = (numFiltersSelected == 1);</span>
<a href="#l90.163"></a><span id="l90.163"> </span>
<a href="#l90.164"></a><span id="l90.164">     var filter = currentFilter();</span>
<a href="#l90.165"></a><span id="l90.165">     // &quot;edit&quot; only enabled when one filter selected or if we couldn't parse the filter</span>
<a href="#l90.166"></a><span id="l90.166">     gEditButton.disabled = !oneFilterSelected || filter.unparseable;</span>
<a href="#l90.167"></a><span id="l90.167" class="difflineminus">-    </span>
<a href="#l90.168"></a><span id="l90.168" class="difflineplus">+</span>
<a href="#l90.169"></a><span id="l90.169">     // &quot;delete&quot; only disabled when no filters are selected</span>
<a href="#l90.170"></a><span id="l90.170">     gDeleteButton.disabled = !numFiltersSelected;</span>
<a href="#l90.171"></a><span id="l90.171"> </span>
<a href="#l90.172"></a><span id="l90.172">     // we can run multiple filters on a folder</span>
<a href="#l90.173"></a><span id="l90.173">     // so only disable this UI if no filters are selected</span>
<a href="#l90.174"></a><span id="l90.174">     gRunFiltersFolderPickerLabel.disabled = !numFiltersSelected;</span>
<a href="#l90.175"></a><span id="l90.175">     gRunFiltersFolderPicker.disabled = !numFiltersSelected;</span>
<a href="#l90.176"></a><span id="l90.176">     gRunFiltersButton.disabled = !numFiltersSelected;</span>
<a href="#l90.177"></a><span id="l90.177" class="difflineat">@@ -478,17 +478,17 @@ function updateButtons()</span>
<a href="#l90.178"></a><span id="l90.178">  *</span>
<a href="#l90.179"></a><span id="l90.179">  * @param   nsIMsgFolder aFolder - selected folder, from window args</span>
<a href="#l90.180"></a><span id="l90.180">  * @returns an nsIMsgFolder where the filter is defined</span>
<a href="#l90.181"></a><span id="l90.181">  */</span>
<a href="#l90.182"></a><span id="l90.182"> function getFilterFolderForSelection()</span>
<a href="#l90.183"></a><span id="l90.183"> {</span>
<a href="#l90.184"></a><span id="l90.184">     var args = window.arguments;</span>
<a href="#l90.185"></a><span id="l90.185">     var selectedFolder = args[0].folder;</span>
<a href="#l90.186"></a><span id="l90.186" class="difflineminus">-  </span>
<a href="#l90.187"></a><span id="l90.187" class="difflineplus">+</span>
<a href="#l90.188"></a><span id="l90.188">     if (args &amp;&amp; args[0] &amp;&amp; selectedFolder)</span>
<a href="#l90.189"></a><span id="l90.189">     {</span>
<a href="#l90.190"></a><span id="l90.190">         var msgFolder = selectedFolder.QueryInterface(Components.interfaces.nsIMsgFolder);</span>
<a href="#l90.191"></a><span id="l90.191">         try</span>
<a href="#l90.192"></a><span id="l90.192">         {</span>
<a href="#l90.193"></a><span id="l90.193">             var rootFolder = msgFolder.server.rootFolder;</span>
<a href="#l90.194"></a><span id="l90.194">             if (rootFolder.isServer)</span>
<a href="#l90.195"></a><span id="l90.195">             {</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l91.1"></a><span id="l91.1" class="difflineminus">--- a/suite/mailnews/search/SearchDialog.js</span>
<a href="#l91.2"></a><span id="l91.2" class="difflineplus">+++ b/suite/mailnews/search/SearchDialog.js</span>
<a href="#l91.3"></a><span id="l91.3" class="difflineat">@@ -54,34 +54,34 @@ var nsSearchResultsController =</span>
<a href="#l91.4"></a><span id="l91.4">     },</span>
<a href="#l91.5"></a><span id="l91.5"> </span>
<a href="#l91.6"></a><span id="l91.6">     // this controller only handles commands</span>
<a href="#l91.7"></a><span id="l91.7">     // that rely on items being selected in</span>
<a href="#l91.8"></a><span id="l91.8">     // the search results pane.</span>
<a href="#l91.9"></a><span id="l91.9">     isCommandEnabled: function(command)</span>
<a href="#l91.10"></a><span id="l91.10">     {</span>
<a href="#l91.11"></a><span id="l91.11">         var enabled = true;</span>
<a href="#l91.12"></a><span id="l91.12" class="difflineminus">-        </span>
<a href="#l91.13"></a><span id="l91.13" class="difflineminus">-        switch (command) { </span>
<a href="#l91.14"></a><span id="l91.14" class="difflineplus">+</span>
<a href="#l91.15"></a><span id="l91.15" class="difflineplus">+        switch (command) {</span>
<a href="#l91.16"></a><span id="l91.16">           case &quot;goto_folder_button&quot;:</span>
<a href="#l91.17"></a><span id="l91.17">             if (GetNumSelectedMessages() != 1)</span>
<a href="#l91.18"></a><span id="l91.18">               enabled = false;</span>
<a href="#l91.19"></a><span id="l91.19">             break;</span>
<a href="#l91.20"></a><span id="l91.20">           case &quot;cmd_delete&quot;:</span>
<a href="#l91.21"></a><span id="l91.21">           case &quot;cmd_shiftDelete&quot;:</span>
<a href="#l91.22"></a><span id="l91.22">           case &quot;button_delete&quot;:</span>
<a href="#l91.23"></a><span id="l91.23">             // this assumes that advanced searches don't cross accounts</span>
<a href="#l91.24"></a><span id="l91.24">             if (GetNumSelectedMessages() &lt;= 0)</span>
<a href="#l91.25"></a><span id="l91.25">               enabled = false;</span>
<a href="#l91.26"></a><span id="l91.26">             break;</span>
<a href="#l91.27"></a><span id="l91.27">           case &quot;saveas_vf_button&quot;:</span>
<a href="#l91.28"></a><span id="l91.28">               // need someway to see if there are any search criteria...</span>
<a href="#l91.29"></a><span id="l91.29">               return true;</span>
<a href="#l91.30"></a><span id="l91.30">           case &quot;cmd_selectAll&quot;:</span>
<a href="#l91.31"></a><span id="l91.31" class="difflineminus">-            return GetDBView() != null;              </span>
<a href="#l91.32"></a><span id="l91.32" class="difflineplus">+            return GetDBView() != null;</span>
<a href="#l91.33"></a><span id="l91.33">           default:</span>
<a href="#l91.34"></a><span id="l91.34">             if (GetNumSelectedMessages() &lt;= 0)</span>
<a href="#l91.35"></a><span id="l91.35">               enabled = false;</span>
<a href="#l91.36"></a><span id="l91.36">             break;</span>
<a href="#l91.37"></a><span id="l91.37">         }</span>
<a href="#l91.38"></a><span id="l91.38"> </span>
<a href="#l91.39"></a><span id="l91.39">         return enabled;</span>
<a href="#l91.40"></a><span id="l91.40">     },</span>
<a href="#l91.41"></a><span id="l91.41" class="difflineat">@@ -173,17 +173,17 @@ var gSearchNotificationListener =</span>
<a href="#l91.42"></a><span id="l91.42">         gStatusFeedback._stopMeteors();</span>
<a href="#l91.43"></a><span id="l91.43">         SetAdvancedSearchStatusText(gDBView.QueryInterface(Components.interfaces.nsITreeView).rowCount);</span>
<a href="#l91.44"></a><span id="l91.44">     },</span>
<a href="#l91.45"></a><span id="l91.45"> </span>
<a href="#l91.46"></a><span id="l91.46">     onNewSearch: function()</span>
<a href="#l91.47"></a><span id="l91.47">     {</span>
<a href="#l91.48"></a><span id="l91.48">       gSearchStopButton.setAttribute(&quot;label&quot;, gSearchBundle.getString(&quot;labelForStopButton&quot;));</span>
<a href="#l91.49"></a><span id="l91.49">       gSearchStopButton.setAttribute(&quot;accesskey&quot;, gSearchBundle.getString(&quot;labelForStopButton.accesskey&quot;));</span>
<a href="#l91.50"></a><span id="l91.50" class="difflineminus">-      UpdateMailSearch(&quot;new-search&quot;);	</span>
<a href="#l91.51"></a><span id="l91.51" class="difflineplus">+      UpdateMailSearch(&quot;new-search&quot;);</span>
<a href="#l91.52"></a><span id="l91.52">       gStatusFeedback._startMeteors();</span>
<a href="#l91.53"></a><span id="l91.53">       gStatusFeedback.showStatusString(gSearchBundle.getString(&quot;searchingMessage&quot;));</span>
<a href="#l91.54"></a><span id="l91.54">     }</span>
<a href="#l91.55"></a><span id="l91.55"> }</span>
<a href="#l91.56"></a><span id="l91.56"> </span>
<a href="#l91.57"></a><span id="l91.57"> // the folderListener object</span>
<a href="#l91.58"></a><span id="l91.58"> var gFolderListener = {</span>
<a href="#l91.59"></a><span id="l91.59">     OnItemAdded: function(parentItem, item) {},</span>
<a href="#l91.60"></a><span id="l91.60" class="difflineat">@@ -196,20 +196,20 @@ var gFolderListener = {</span>
<a href="#l91.61"></a><span id="l91.61"> </span>
<a href="#l91.62"></a><span id="l91.62">     OnItemBoolPropertyChanged: function(item, property, oldValue, newValue) {},</span>
<a href="#l91.63"></a><span id="l91.63"> </span>
<a href="#l91.64"></a><span id="l91.64">     OnItemUnicharPropertyChanged: function(item, property, oldValue, newValue){},</span>
<a href="#l91.65"></a><span id="l91.65">     OnItemPropertyFlagChanged: function(item, property, oldFlag, newFlag) {},</span>
<a href="#l91.66"></a><span id="l91.66"> </span>
<a href="#l91.67"></a><span id="l91.67">     OnItemEvent: function(folder, event) {</span>
<a href="#l91.68"></a><span id="l91.68">         var eventType = event.toString();</span>
<a href="#l91.69"></a><span id="l91.69" class="difflineminus">-        </span>
<a href="#l91.70"></a><span id="l91.70" class="difflineplus">+</span>
<a href="#l91.71"></a><span id="l91.71">         if (eventType == &quot;DeleteOrMoveMsgCompleted&quot;) {</span>
<a href="#l91.72"></a><span id="l91.72">             HandleDeleteOrMoveMessageCompleted(folder);</span>
<a href="#l91.73"></a><span id="l91.73" class="difflineminus">-        }     </span>
<a href="#l91.74"></a><span id="l91.74" class="difflineplus">+        }</span>
<a href="#l91.75"></a><span id="l91.75">         else if (eventType == &quot;DeleteOrMoveMsgFailed&quot;) {</span>
<a href="#l91.76"></a><span id="l91.76">             HandleDeleteOrMoveMessageFailed(folder);</span>
<a href="#l91.77"></a><span id="l91.77">         }</span>
<a href="#l91.78"></a><span id="l91.78">     }</span>
<a href="#l91.79"></a><span id="l91.79"> }</span>
<a href="#l91.80"></a><span id="l91.80"> </span>
<a href="#l91.81"></a><span id="l91.81"> function HideSearchColumn(id)</span>
<a href="#l91.82"></a><span id="l91.82"> {</span>
<a href="#l91.83"></a><span id="l91.83" class="difflineat">@@ -244,40 +244,40 @@ function searchOnLoad()</span>
<a href="#l91.84"></a><span id="l91.84">   setupDatasource();</span>
<a href="#l91.85"></a><span id="l91.85">   setupSearchListener();</span>
<a href="#l91.86"></a><span id="l91.86"> </span>
<a href="#l91.87"></a><span id="l91.87">   if (window.arguments &amp;&amp; window.arguments[0])</span>
<a href="#l91.88"></a><span id="l91.88">     selectFolder(window.arguments[0].folder);</span>
<a href="#l91.89"></a><span id="l91.89"> </span>
<a href="#l91.90"></a><span id="l91.90">   onMore(null);</span>
<a href="#l91.91"></a><span id="l91.91">   UpdateMailSearch(&quot;onload&quot;);</span>
<a href="#l91.92"></a><span id="l91.92" class="difflineminus">-  </span>
<a href="#l91.93"></a><span id="l91.93" class="difflineplus">+</span>
<a href="#l91.94"></a><span id="l91.94">   // hide and remove these columns from the column picker.  you can't thread search results</span>
<a href="#l91.95"></a><span id="l91.95">   HideSearchColumn(&quot;threadCol&quot;); // since you can't thread search results</span>
<a href="#l91.96"></a><span id="l91.96">   HideSearchColumn(&quot;totalCol&quot;); // since you can't thread search results</span>
<a href="#l91.97"></a><span id="l91.97">   HideSearchColumn(&quot;unreadCol&quot;); // since you can't thread search results</span>
<a href="#l91.98"></a><span id="l91.98">   HideSearchColumn(&quot;unreadButtonColHeader&quot;);</span>
<a href="#l91.99"></a><span id="l91.99">   HideSearchColumn(&quot;idCol&quot;);</span>
<a href="#l91.100"></a><span id="l91.100">   HideSearchColumn(&quot;junkStatusCol&quot;);</span>
<a href="#l91.101"></a><span id="l91.101">   HideSearchColumn(&quot;accountCol&quot;);</span>
<a href="#l91.102"></a><span id="l91.102" class="difflineminus">-  </span>
<a href="#l91.103"></a><span id="l91.103" class="difflineplus">+</span>
<a href="#l91.104"></a><span id="l91.104">   // we want to show the location column for search</span>
<a href="#l91.105"></a><span id="l91.105">   ShowSearchColumn(&quot;locationCol&quot;);</span>
<a href="#l91.106"></a><span id="l91.106"> }</span>
<a href="#l91.107"></a><span id="l91.107"> </span>
<a href="#l91.108"></a><span id="l91.108"> function searchOnUnload()</span>
<a href="#l91.109"></a><span id="l91.109"> {</span>
<a href="#l91.110"></a><span id="l91.110">     // unregister listeners</span>
<a href="#l91.111"></a><span id="l91.111">     gSearchSession.unregisterListener(gViewSearchListener);</span>
<a href="#l91.112"></a><span id="l91.112">     gSearchSession.unregisterListener(gSearchNotificationListener);</span>
<a href="#l91.113"></a><span id="l91.113"> </span>
<a href="#l91.114"></a><span id="l91.114">     Components.classes[&quot;@mozilla.org/messenger/services/session;1&quot;]</span>
<a href="#l91.115"></a><span id="l91.115">               .getService(Components.interfaces.nsIMsgMailSession)</span>
<a href="#l91.116"></a><span id="l91.116">               .RemoveFolderListener(gFolderListener);</span>
<a href="#l91.117"></a><span id="l91.117" class="difflineminus">-	</span>
<a href="#l91.118"></a><span id="l91.118" class="difflineplus">+</span>
<a href="#l91.119"></a><span id="l91.119">     if (gDBView)</span>
<a href="#l91.120"></a><span id="l91.120">     {</span>
<a href="#l91.121"></a><span id="l91.121">         gDBView.close();</span>
<a href="#l91.122"></a><span id="l91.122">         gDBView = null;</span>
<a href="#l91.123"></a><span id="l91.123">     }</span>
<a href="#l91.124"></a><span id="l91.124"> </span>
<a href="#l91.125"></a><span id="l91.125">     top.controllers.removeController(nsSearchResultsController);</span>
<a href="#l91.126"></a><span id="l91.126"> </span>
<a href="#l91.127"></a><span id="l91.127" class="difflineat">@@ -286,17 +286,17 @@ function searchOnUnload()</span>
<a href="#l91.128"></a><span id="l91.128"> }</span>
<a href="#l91.129"></a><span id="l91.129"> </span>
<a href="#l91.130"></a><span id="l91.130"> function initializeSearchWindowWidgets()</span>
<a href="#l91.131"></a><span id="l91.131"> {</span>
<a href="#l91.132"></a><span id="l91.132">     gFolderPicker = document.getElementById(&quot;searchableFolders&quot;);</span>
<a href="#l91.133"></a><span id="l91.133">     gSearchStopButton = document.getElementById(&quot;search-button&quot;);</span>
<a href="#l91.134"></a><span id="l91.134">     gStatusBar = document.getElementById('statusbar-icon');</span>
<a href="#l91.135"></a><span id="l91.135">     hideMatchAllItem();</span>
<a href="#l91.136"></a><span id="l91.136" class="difflineminus">-    </span>
<a href="#l91.137"></a><span id="l91.137" class="difflineplus">+</span>
<a href="#l91.138"></a><span id="l91.138">     msgWindow = Components.classes[&quot;@mozilla.org/messenger/msgwindow;1&quot;]</span>
<a href="#l91.139"></a><span id="l91.139">                           .createInstance(nsIMsgWindow);</span>
<a href="#l91.140"></a><span id="l91.140">     msgWindow.domWindow = window;</span>
<a href="#l91.141"></a><span id="l91.141">     msgWindow.rootDocShell.allowAuth = true;</span>
<a href="#l91.142"></a><span id="l91.142">     msgWindow.rootDocShell.appType = Components.interfaces.nsIDocShell.APP_TYPE_MAIL;</span>
<a href="#l91.143"></a><span id="l91.143">     msgWindow.statusFeedback = gStatusFeedback;</span>
<a href="#l91.144"></a><span id="l91.144"> </span>
<a href="#l91.145"></a><span id="l91.145">     // functionality to enable/disable buttons using nsSearchResultsController</span>
<a href="#l91.146"></a><span id="l91.146" class="difflineat">@@ -306,39 +306,39 @@ function initializeSearchWindowWidgets()</span>
<a href="#l91.147"></a><span id="l91.147"> </span>
<a href="#l91.148"></a><span id="l91.148"> </span>
<a href="#l91.149"></a><span id="l91.149"> function onSearchStop() {</span>
<a href="#l91.150"></a><span id="l91.150">     gSearchSession.interruptSearch();</span>
<a href="#l91.151"></a><span id="l91.151"> }</span>
<a href="#l91.152"></a><span id="l91.152"> </span>
<a href="#l91.153"></a><span id="l91.153"> function onResetSearch(event) {</span>
<a href="#l91.154"></a><span id="l91.154">     onReset(event);</span>
<a href="#l91.155"></a><span id="l91.155" class="difflineminus">-    </span>
<a href="#l91.156"></a><span id="l91.156" class="difflineplus">+</span>
<a href="#l91.157"></a><span id="l91.157">     var tree = GetThreadTree();</span>
<a href="#l91.158"></a><span id="l91.158">     tree.treeBoxObject.view = null;</span>
<a href="#l91.159"></a><span id="l91.159">     gStatusFeedback.showStatusString(&quot;&quot;);</span>
<a href="#l91.160"></a><span id="l91.160"> }</span>
<a href="#l91.161"></a><span id="l91.161"> </span>
<a href="#l91.162"></a><span id="l91.162" class="difflineminus">-function selectFolder(folder) </span>
<a href="#l91.163"></a><span id="l91.163" class="difflineplus">+function selectFolder(folder)</span>
<a href="#l91.164"></a><span id="l91.164"> {</span>
<a href="#l91.165"></a><span id="l91.165">     var folderURI;</span>
<a href="#l91.166"></a><span id="l91.166"> </span>
<a href="#l91.167"></a><span id="l91.167">     // if we can't search messages on this folder, just select the first one</span>
<a href="#l91.168"></a><span id="l91.168">     if (!folder || !folder.server.canSearchMessages ||</span>
<a href="#l91.169"></a><span id="l91.169">         (folder.flags &amp; Components.interfaces.nsMsgFolderFlags.Virtual)) {</span>
<a href="#l91.170"></a><span id="l91.170">         // find first item in our folder picker menu list</span>
<a href="#l91.171"></a><span id="l91.171">         folderURI = gFolderPicker.firstChild.tree.builderView.getResourceAtIndex(0).Value;</span>
<a href="#l91.172"></a><span id="l91.172">     } else {</span>
<a href="#l91.173"></a><span id="l91.173">         folderURI = folder.URI;</span>
<a href="#l91.174"></a><span id="l91.174">     }</span>
<a href="#l91.175"></a><span id="l91.175">     updateSearchFolderPicker(folderURI);</span>
<a href="#l91.176"></a><span id="l91.176"> }</span>
<a href="#l91.177"></a><span id="l91.177"> </span>
<a href="#l91.178"></a><span id="l91.178" class="difflineminus">-function updateSearchFolderPicker(folderURI) </span>
<a href="#l91.179"></a><span id="l91.179" class="difflineminus">-{ </span>
<a href="#l91.180"></a><span id="l91.180" class="difflineplus">+function updateSearchFolderPicker(folderURI)</span>
<a href="#l91.181"></a><span id="l91.181" class="difflineplus">+{</span>
<a href="#l91.182"></a><span id="l91.182">     SetFolderPicker(folderURI, gFolderPicker.id);</span>
<a href="#l91.183"></a><span id="l91.183"> </span>
<a href="#l91.184"></a><span id="l91.184">     // use the URI to get the real folder</span>
<a href="#l91.185"></a><span id="l91.185">     gMsgFolderSelected = GetMsgFolderFromUri(folderURI);</span>
<a href="#l91.186"></a><span id="l91.186"> </span>
<a href="#l91.187"></a><span id="l91.187">     var searchSubFolders = document.getElementById(&quot;checkSearchSubFolders&quot;);</span>
<a href="#l91.188"></a><span id="l91.188">     if (searchSubFolders)</span>
<a href="#l91.189"></a><span id="l91.189">       searchSubFolders.disabled = !gMsgFolderSelected.hasSubFolders;</span>
<a href="#l91.190"></a><span id="l91.190" class="difflineat">@@ -365,18 +365,18 @@ function onChooseFolder(event) {</span>
<a href="#l91.191"></a><span id="l91.191">     }</span>
<a href="#l91.192"></a><span id="l91.192"> }</span>
<a href="#l91.193"></a><span id="l91.193"> </span>
<a href="#l91.194"></a><span id="l91.194"> function onEnterInSearchTerm()</span>
<a href="#l91.195"></a><span id="l91.195"> {</span>
<a href="#l91.196"></a><span id="l91.196">   // on enter</span>
<a href="#l91.197"></a><span id="l91.197">   // if not searching, start the search</span>
<a href="#l91.198"></a><span id="l91.198">   // if searching, stop and then start again</span>
<a href="#l91.199"></a><span id="l91.199" class="difflineminus">-  if (gSearchStopButton.getAttribute(&quot;label&quot;) == gSearchBundle.getString(&quot;labelForSearchButton&quot;)) { </span>
<a href="#l91.200"></a><span id="l91.200" class="difflineminus">-     onSearch(); </span>
<a href="#l91.201"></a><span id="l91.201" class="difflineplus">+  if (gSearchStopButton.getAttribute(&quot;label&quot;) == gSearchBundle.getString(&quot;labelForSearchButton&quot;)) {</span>
<a href="#l91.202"></a><span id="l91.202" class="difflineplus">+     onSearch();</span>
<a href="#l91.203"></a><span id="l91.203">   }</span>
<a href="#l91.204"></a><span id="l91.204">   else {</span>
<a href="#l91.205"></a><span id="l91.205">      onSearchStop();</span>
<a href="#l91.206"></a><span id="l91.206">      onSearch();</span>
<a href="#l91.207"></a><span id="l91.207">   }</span>
<a href="#l91.208"></a><span id="l91.208"> }</span>
<a href="#l91.209"></a><span id="l91.209"> </span>
<a href="#l91.210"></a><span id="l91.210"> function onSearch()</span>
<a href="#l91.211"></a><span id="l91.211" class="difflineat">@@ -428,17 +428,17 @@ function AddSubFolders(folder) {</span>
<a href="#l91.212"></a><span id="l91.212">       if (!nextFolder.noSelect)</span>
<a href="#l91.213"></a><span id="l91.213">         gSearchSession.addScopeTerm(GetScopeForFolder(nextFolder), nextFolder);</span>
<a href="#l91.214"></a><span id="l91.214"> </span>
<a href="#l91.215"></a><span id="l91.215">       AddSubFolders(nextFolder);</span>
<a href="#l91.216"></a><span id="l91.216">     }</span>
<a href="#l91.217"></a><span id="l91.217">   }</span>
<a href="#l91.218"></a><span id="l91.218"> }</span>
<a href="#l91.219"></a><span id="l91.219"> </span>
<a href="#l91.220"></a><span id="l91.220" class="difflineminus">-function AddSubFoldersToURI(folder) </span>
<a href="#l91.221"></a><span id="l91.221" class="difflineplus">+function AddSubFoldersToURI(folder)</span>
<a href="#l91.222"></a><span id="l91.222"> {</span>
<a href="#l91.223"></a><span id="l91.223">   var returnString = &quot;&quot;;</span>
<a href="#l91.224"></a><span id="l91.224"> </span>
<a href="#l91.225"></a><span id="l91.225">   var subFolders = folder.subFolders;</span>
<a href="#l91.226"></a><span id="l91.226"> </span>
<a href="#l91.227"></a><span id="l91.227">   while (subFolders.hasMoreElements())</span>
<a href="#l91.228"></a><span id="l91.228">   {</span>
<a href="#l91.229"></a><span id="l91.229">     var nextFolder =</span>
<a href="#l91.230"></a><span id="l91.230" class="difflineat">@@ -460,17 +460,17 @@ function AddSubFoldersToURI(folder)</span>
<a href="#l91.231"></a><span id="l91.231">         returnString += subFoldersString;</span>
<a href="#l91.232"></a><span id="l91.232">       }</span>
<a href="#l91.233"></a><span id="l91.233">     }</span>
<a href="#l91.234"></a><span id="l91.234">   }</span>
<a href="#l91.235"></a><span id="l91.235">   return returnString;</span>
<a href="#l91.236"></a><span id="l91.236"> }</span>
<a href="#l91.237"></a><span id="l91.237"> </span>
<a href="#l91.238"></a><span id="l91.238"> </span>
<a href="#l91.239"></a><span id="l91.239" class="difflineminus">-function GetScopeForFolder(folder) </span>
<a href="#l91.240"></a><span id="l91.240" class="difflineplus">+function GetScopeForFolder(folder)</span>
<a href="#l91.241"></a><span id="l91.241"> {</span>
<a href="#l91.242"></a><span id="l91.242">   var searchLocalSystem = document.getElementById(&quot;menuSearchLocalSystem&quot;);</span>
<a href="#l91.243"></a><span id="l91.243">   return searchLocalSystem &amp;&amp; searchLocalSystem.value == &quot;local&quot; ?</span>
<a href="#l91.244"></a><span id="l91.244">                               nsMsgSearchScope.offlineMail :</span>
<a href="#l91.245"></a><span id="l91.245">                               folder.server.searchScope;</span>
<a href="#l91.246"></a><span id="l91.246"> }</span>
<a href="#l91.247"></a><span id="l91.247"> </span>
<a href="#l91.248"></a><span id="l91.248"> var nsMsgViewSortType = Components.interfaces.nsMsgViewSortType;</span>
<a href="#l91.249"></a><span id="l91.249" class="difflineat">@@ -640,68 +640,68 @@ function HandleDeleteOrMoveMessageComple</span>
<a href="#l91.250"></a><span id="l91.250">     else if (treeSelection.count == 1) {</span>
<a href="#l91.251"></a><span id="l91.251">       // this can happen if you had two messages selected</span>
<a href="#l91.252"></a><span id="l91.252">       // in the search results pane, and you deleted one of them from another view</span>
<a href="#l91.253"></a><span id="l91.253">       // (like the view in the stand alone msg window or the three pane)</span>
<a href="#l91.254"></a><span id="l91.254">       // since one item is selected, we should load it.</span>
<a href="#l91.255"></a><span id="l91.255">       var startIndex = {};</span>
<a href="#l91.256"></a><span id="l91.256">       var endIndex = {};</span>
<a href="#l91.257"></a><span id="l91.257">       treeSelection.getRangeAt(0, startIndex, endIndex);</span>
<a href="#l91.258"></a><span id="l91.258" class="difflineminus">-        </span>
<a href="#l91.259"></a><span id="l91.259" class="difflineplus">+</span>
<a href="#l91.260"></a><span id="l91.260">       // select the selected item, so we'll load it</span>
<a href="#l91.261"></a><span id="l91.261" class="difflineminus">-      treeSelection.select(startIndex.value); </span>
<a href="#l91.262"></a><span id="l91.262" class="difflineplus">+      treeSelection.select(startIndex.value);</span>
<a href="#l91.263"></a><span id="l91.263">       treeView.selectionChanged();</span>
<a href="#l91.264"></a><span id="l91.264"> </span>
<a href="#l91.265"></a><span id="l91.265" class="difflineminus">-      EnsureRowInThreadTreeIsVisible(startIndex.value); </span>
<a href="#l91.266"></a><span id="l91.266" class="difflineplus">+      EnsureRowInThreadTreeIsVisible(startIndex.value);</span>
<a href="#l91.267"></a><span id="l91.267">       UpdateMailSearch(&quot;delete from another view, 1 row now selected&quot;);</span>
<a href="#l91.268"></a><span id="l91.268">     }</span>
<a href="#l91.269"></a><span id="l91.269">     else {</span>
<a href="#l91.270"></a><span id="l91.270">       // this can happen if you have more than 2 messages selected</span>
<a href="#l91.271"></a><span id="l91.271">       // in the search results pane, and you deleted one of them from another view</span>
<a href="#l91.272"></a><span id="l91.272">       // (like the view in the stand alone msg window or the three pane)</span>
<a href="#l91.273"></a><span id="l91.273">       // since multiple messages are still selected, do nothing.</span>
<a href="#l91.274"></a><span id="l91.274">     }</span>
<a href="#l91.275"></a><span id="l91.275">   }</span>
<a href="#l91.276"></a><span id="l91.276">   else {</span>
<a href="#l91.277"></a><span id="l91.277" class="difflineminus">-    if (gNextMessageViewIndexAfterDelete != nsMsgViewIndex_None &amp;&amp; gNextMessageViewIndexAfterDelete &gt;= viewSize) </span>
<a href="#l91.278"></a><span id="l91.278" class="difflineplus">+    if (gNextMessageViewIndexAfterDelete != nsMsgViewIndex_None &amp;&amp; gNextMessageViewIndexAfterDelete &gt;= viewSize)</span>
<a href="#l91.279"></a><span id="l91.279">     {</span>
<a href="#l91.280"></a><span id="l91.280">       if (viewSize &gt; 0)</span>
<a href="#l91.281"></a><span id="l91.281">         gNextMessageViewIndexAfterDelete = viewSize - 1;</span>
<a href="#l91.282"></a><span id="l91.282">       else</span>
<a href="#l91.283"></a><span id="l91.283" class="difflineminus">-      {           </span>
<a href="#l91.284"></a><span id="l91.284" class="difflineplus">+      {</span>
<a href="#l91.285"></a><span id="l91.285">         gNextMessageViewIndexAfterDelete = nsMsgViewIndex_None;</span>
<a href="#l91.286"></a><span id="l91.286"> </span>
<a href="#l91.287"></a><span id="l91.287">         // there is nothing to select since viewSize is 0</span>
<a href="#l91.288"></a><span id="l91.288">         treeSelection.clearSelection();</span>
<a href="#l91.289"></a><span id="l91.289"> </span>
<a href="#l91.290"></a><span id="l91.290">         UpdateMailSearch(&quot;delete from current view, 0 rows left&quot;);</span>
<a href="#l91.291"></a><span id="l91.291">       }</span>
<a href="#l91.292"></a><span id="l91.292">     }</span>
<a href="#l91.293"></a><span id="l91.293"> </span>
<a href="#l91.294"></a><span id="l91.294">     // if we are about to set the selection with a new element then DON'T clear</span>
<a href="#l91.295"></a><span id="l91.295">     // the selection then add the next message to select. This just generates</span>
<a href="#l91.296"></a><span id="l91.296">     // an extra round of command updating notifications that we are trying to</span>
<a href="#l91.297"></a><span id="l91.297">     // optimize away.</span>
<a href="#l91.298"></a><span id="l91.298" class="difflineminus">-    if (gNextMessageViewIndexAfterDelete != nsMsgViewIndex_None) </span>
<a href="#l91.299"></a><span id="l91.299" class="difflineplus">+    if (gNextMessageViewIndexAfterDelete != nsMsgViewIndex_None)</span>
<a href="#l91.300"></a><span id="l91.300">     {</span>
<a href="#l91.301"></a><span id="l91.301">       treeSelection.select(gNextMessageViewIndexAfterDelete);</span>
<a href="#l91.302"></a><span id="l91.302">       // since gNextMessageViewIndexAfterDelete probably has the same value</span>
<a href="#l91.303"></a><span id="l91.303">       // as the last index we had selected, the tree isn't generating a new</span>
<a href="#l91.304"></a><span id="l91.304" class="difflineminus">-      // selectionChanged notification for the tree view. So we aren't loading the </span>
<a href="#l91.305"></a><span id="l91.305" class="difflineplus">+      // selectionChanged notification for the tree view. So we aren't loading the</span>
<a href="#l91.306"></a><span id="l91.306">       // next message. to fix this, force the selection changed update.</span>
<a href="#l91.307"></a><span id="l91.307">       if (treeView)</span>
<a href="#l91.308"></a><span id="l91.308">         treeView.selectionChanged();</span>
<a href="#l91.309"></a><span id="l91.309"> </span>
<a href="#l91.310"></a><span id="l91.310" class="difflineminus">-      EnsureRowInThreadTreeIsVisible(gNextMessageViewIndexAfterDelete); </span>
<a href="#l91.311"></a><span id="l91.311" class="difflineplus">+      EnsureRowInThreadTreeIsVisible(gNextMessageViewIndexAfterDelete);</span>
<a href="#l91.312"></a><span id="l91.312"> </span>
<a href="#l91.313"></a><span id="l91.313">       // XXX TODO</span>
<a href="#l91.314"></a><span id="l91.314">       // I think there is a bug in the suppression code above.</span>
<a href="#l91.315"></a><span id="l91.315" class="difflineminus">-      // what if I have two rows selected, and I hit delete, </span>
<a href="#l91.316"></a><span id="l91.316" class="difflineplus">+      // what if I have two rows selected, and I hit delete,</span>
<a href="#l91.317"></a><span id="l91.317">       // and so we load the next row.</span>
<a href="#l91.318"></a><span id="l91.318" class="difflineminus">-      // what if I have commands that only enable where </span>
<a href="#l91.319"></a><span id="l91.319" class="difflineplus">+      // what if I have commands that only enable where</span>
<a href="#l91.320"></a><span id="l91.320">       // exactly one row is selected?</span>
<a href="#l91.321"></a><span id="l91.321">       UpdateMailSearch(&quot;delete from current view, at least one row selected&quot;);</span>
<a href="#l91.322"></a><span id="l91.322">     }</span>
<a href="#l91.323"></a><span id="l91.323">   }</span>
<a href="#l91.324"></a><span id="l91.324"> </span>
<a href="#l91.325"></a><span id="l91.325">   // default value after delete/move/copy is over</span>
<a href="#l91.326"></a><span id="l91.326">   gNextMessageViewIndexAfterDelete = -2;</span>
<a href="#l91.327"></a><span id="l91.327"> </span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l92.1"></a><span id="l92.1" class="difflineminus">--- a/suite/mailnews/searchBar.js</span>
<a href="#l92.2"></a><span id="l92.2" class="difflineplus">+++ b/suite/mailnews/searchBar.js</span>
<a href="#l92.3"></a><span id="l92.3" class="difflineat">@@ -73,24 +73,24 @@ var gSearchNotificationListener =</span>
<a href="#l92.4"></a><span id="l92.4">     },</span>
<a href="#l92.5"></a><span id="l92.5"> </span>
<a href="#l92.6"></a><span id="l92.6">     onNewSearch: function()</span>
<a href="#l92.7"></a><span id="l92.7">     {</span>
<a href="#l92.8"></a><span id="l92.8">       statusFeedback.showProgress(0);</span>
<a href="#l92.9"></a><span id="l92.9">       statusFeedback.showStatusString(gSearchBundle.getString(&quot;searchingMessage&quot;));</span>
<a href="#l92.10"></a><span id="l92.10">       gProgressMeter.setAttribute(&quot;mode&quot;, &quot;undetermined&quot;);</span>
<a href="#l92.11"></a><span id="l92.11">       gSearchInProgress = true;</span>
<a href="#l92.12"></a><span id="l92.12" class="difflineminus">-      gNumTotalMessages = 0; </span>
<a href="#l92.13"></a><span id="l92.13" class="difflineplus">+      gNumTotalMessages = 0;</span>
<a href="#l92.14"></a><span id="l92.14">       gNumUnreadMessages = 0;</span>
<a href="#l92.15"></a><span id="l92.15">     }</span>
<a href="#l92.16"></a><span id="l92.16"> }</span>
<a href="#l92.17"></a><span id="l92.17"> </span>
<a href="#l92.18"></a><span id="l92.18"> function getDocumentElements()</span>
<a href="#l92.19"></a><span id="l92.19"> {</span>
<a href="#l92.20"></a><span id="l92.20" class="difflineminus">-  gSearchBundle = document.getElementById(&quot;bundle_search&quot;);  </span>
<a href="#l92.21"></a><span id="l92.21" class="difflineplus">+  gSearchBundle = document.getElementById(&quot;bundle_search&quot;);</span>
<a href="#l92.22"></a><span id="l92.22">   gProgressMeter = document.getElementById('statusbar-icon');</span>
<a href="#l92.23"></a><span id="l92.23">   gClearButton = document.getElementById('clearButton');</span>
<a href="#l92.24"></a><span id="l92.24">   GetSearchInput();</span>
<a href="#l92.25"></a><span id="l92.25"> }</span>
<a href="#l92.26"></a><span id="l92.26"> </span>
<a href="#l92.27"></a><span id="l92.27"> function addListeners()</span>
<a href="#l92.28"></a><span id="l92.28"> {</span>
<a href="#l92.29"></a><span id="l92.29">   gViewSearchListener = gDBView.QueryInterface(Components.interfaces.nsIMsgSearchNotify);</span>
<a href="#l92.30"></a><span id="l92.30" class="difflineat">@@ -100,29 +100,29 @@ function addListeners()</span>
<a href="#l92.31"></a><span id="l92.31"> function removeListeners()</span>
<a href="#l92.32"></a><span id="l92.32"> {</span>
<a href="#l92.33"></a><span id="l92.33">   gSearchSession.unregisterListener(gViewSearchListener);</span>
<a href="#l92.34"></a><span id="l92.34"> }</span>
<a href="#l92.35"></a><span id="l92.35"> </span>
<a href="#l92.36"></a><span id="l92.36"> function removeGlobalListeners()</span>
<a href="#l92.37"></a><span id="l92.37"> {</span>
<a href="#l92.38"></a><span id="l92.38">   removeListeners();</span>
<a href="#l92.39"></a><span id="l92.39" class="difflineminus">-  gSearchSession.unregisterListener(gSearchNotificationListener); </span>
<a href="#l92.40"></a><span id="l92.40" class="difflineplus">+  gSearchSession.unregisterListener(gSearchNotificationListener);</span>
<a href="#l92.41"></a><span id="l92.41"> }</span>
<a href="#l92.42"></a><span id="l92.42"> </span>
<a href="#l92.43"></a><span id="l92.43"> function initializeGlobalListeners()</span>
<a href="#l92.44"></a><span id="l92.44"> {</span>
<a href="#l92.45"></a><span id="l92.45">   // Setup the javascript object as a listener on the search results</span>
<a href="#l92.46"></a><span id="l92.46">   gSearchSession.registerListener(gSearchNotificationListener);</span>
<a href="#l92.47"></a><span id="l92.47"> }</span>
<a href="#l92.48"></a><span id="l92.48"> </span>
<a href="#l92.49"></a><span id="l92.49"> function createQuickSearchView()</span>
<a href="#l92.50"></a><span id="l92.50"> {</span>
<a href="#l92.51"></a><span id="l92.51" class="difflineminus">-  //if not already in quick search view </span>
<a href="#l92.52"></a><span id="l92.52" class="difflineminus">-  if (gDBView.viewType != nsMsgViewType.eShowQuickSearchResults)  </span>
<a href="#l92.53"></a><span id="l92.53" class="difflineplus">+  //if not already in quick search view</span>
<a href="#l92.54"></a><span id="l92.54" class="difflineplus">+  if (gDBView.viewType != nsMsgViewType.eShowQuickSearchResults)</span>
<a href="#l92.55"></a><span id="l92.55">   {</span>
<a href="#l92.56"></a><span id="l92.56">     var treeView = gDBView.QueryInterface(Components.interfaces.nsITreeView);  //clear selection</span>
<a href="#l92.57"></a><span id="l92.57">     if (treeView &amp;&amp; treeView.selection)</span>
<a href="#l92.58"></a><span id="l92.58">       treeView.selection.clearSelection();</span>
<a href="#l92.59"></a><span id="l92.59">     gPreQuickSearchView = gDBView;</span>
<a href="#l92.60"></a><span id="l92.60">     if (gDBView.viewType == nsMsgViewType.eShowVirtualFolderResults)</span>
<a href="#l92.61"></a><span id="l92.61">     {</span>
<a href="#l92.62"></a><span id="l92.62">       // remove the view as a listener on the search results</span>
<a href="#l92.63"></a><span id="l92.63" class="difflineat">@@ -153,26 +153,26 @@ function initializeSearchBar()</span>
<a href="#l92.64"></a><span id="l92.64">    }</span>
<a href="#l92.65"></a><span id="l92.65">    addListeners();</span>
<a href="#l92.66"></a><span id="l92.66"> }</span>
<a href="#l92.67"></a><span id="l92.67"> </span>
<a href="#l92.68"></a><span id="l92.68"> function onEnterInSearchBar()</span>
<a href="#l92.69"></a><span id="l92.69"> {</span>
<a href="#l92.70"></a><span id="l92.70">    if (!gSearchBundle)</span>
<a href="#l92.71"></a><span id="l92.71">      getDocumentElements();</span>
<a href="#l92.72"></a><span id="l92.72" class="difflineminus">-   if (gSearchInput.value == &quot;&quot;) </span>
<a href="#l92.73"></a><span id="l92.73" class="difflineplus">+   if (gSearchInput.value == &quot;&quot;)</span>
<a href="#l92.74"></a><span id="l92.74">    {</span>
<a href="#l92.75"></a><span id="l92.75">     let viewType = gDBView &amp;&amp; gDBView.viewType;</span>
<a href="#l92.76"></a><span id="l92.76">     if (viewType == nsMsgViewType.eShowQuickSearchResults ||</span>
<a href="#l92.77"></a><span id="l92.77">         viewType == nsMsgViewType.eShowVirtualFolderResults)</span>
<a href="#l92.78"></a><span id="l92.78">      {</span>
<a href="#l92.79"></a><span id="l92.79">        statusFeedback.showStatusString(&quot;&quot;);</span>
<a href="#l92.80"></a><span id="l92.80">        disableQuickSearchClearButton();</span>
<a href="#l92.81"></a><span id="l92.81"> </span>
<a href="#l92.82"></a><span id="l92.82" class="difflineminus">-       viewDebug (&quot;onEnterInSearchBar gDefaultSearchViewTerms = &quot; + gDefaultSearchViewTerms + &quot;gVirtualFolderTerms = &quot; </span>
<a href="#l92.83"></a><span id="l92.83" class="difflineplus">+       viewDebug (&quot;onEnterInSearchBar gDefaultSearchViewTerms = &quot; + gDefaultSearchViewTerms + &quot;gVirtualFolderTerms = &quot;</span>
<a href="#l92.84"></a><span id="l92.84">         + gVirtualFolderTerms + &quot;gXFVirtualFolderTerms = &quot; + gXFVirtualFolderTerms + &quot;\n&quot;);</span>
<a href="#l92.85"></a><span id="l92.85">        var addTerms = gDefaultSearchViewTerms || gVirtualFolderTerms || gXFVirtualFolderTerms;</span>
<a href="#l92.86"></a><span id="l92.86">        if (addTerms)</span>
<a href="#l92.87"></a><span id="l92.87">        {</span>
<a href="#l92.88"></a><span id="l92.88">            viewDebug (&quot;addTerms = &quot; + addTerms + &quot; count = &quot; + addTerms.Count() + &quot;\n&quot;);</span>
<a href="#l92.89"></a><span id="l92.89">            initializeSearchBar();</span>
<a href="#l92.90"></a><span id="l92.90">            onSearch(addTerms);</span>
<a href="#l92.91"></a><span id="l92.91">        }</span>
<a href="#l92.92"></a><span id="l92.92" class="difflineat">@@ -184,44 +184,44 @@ function onEnterInSearchBar()</span>
<a href="#l92.93"></a><span id="l92.93"> </span>
<a href="#l92.94"></a><span id="l92.94">      gQSViewIsDirty = false;</span>
<a href="#l92.95"></a><span id="l92.95">      return;</span>
<a href="#l92.96"></a><span id="l92.96">    }</span>
<a href="#l92.97"></a><span id="l92.97"> </span>
<a href="#l92.98"></a><span id="l92.98">    initializeSearchBar();</span>
<a href="#l92.99"></a><span id="l92.99"> </span>
<a href="#l92.100"></a><span id="l92.100">    if (gClearButton)</span>
<a href="#l92.101"></a><span id="l92.101" class="difflineminus">-    gClearButton.setAttribute(&quot;disabled&quot;, false); //coming into search enable clear button   </span>
<a href="#l92.102"></a><span id="l92.102" class="difflineplus">+    gClearButton.setAttribute(&quot;disabled&quot;, false); //coming into search enable clear button</span>
<a href="#l92.103"></a><span id="l92.103"> </span>
<a href="#l92.104"></a><span id="l92.104">    ClearThreadPaneSelection();</span>
<a href="#l92.105"></a><span id="l92.105">    ClearMessagePane();</span>
<a href="#l92.106"></a><span id="l92.106"> </span>
<a href="#l92.107"></a><span id="l92.107">    onSearch(null);</span>
<a href="#l92.108"></a><span id="l92.108">    gQSViewIsDirty = false;</span>
<a href="#l92.109"></a><span id="l92.109"> }</span>
<a href="#l92.110"></a><span id="l92.110"> </span>
<a href="#l92.111"></a><span id="l92.111"> function restorePreSearchView()</span>
<a href="#l92.112"></a><span id="l92.112"> {</span>
<a href="#l92.113"></a><span id="l92.113">   var selectedHdr = null;</span>
<a href="#l92.114"></a><span id="l92.114">   //save selection</span>
<a href="#l92.115"></a><span id="l92.115" class="difflineminus">-  try </span>
<a href="#l92.116"></a><span id="l92.116" class="difflineplus">+  try</span>
<a href="#l92.117"></a><span id="l92.117">   {</span>
<a href="#l92.118"></a><span id="l92.118">     selectedHdr = gDBView.hdrForFirstSelectedMessage;</span>
<a href="#l92.119"></a><span id="l92.119">   }</span>
<a href="#l92.120"></a><span id="l92.120">   catch (ex)</span>
<a href="#l92.121"></a><span id="l92.121">   {}</span>
<a href="#l92.122"></a><span id="l92.122"> </span>
<a href="#l92.123"></a><span id="l92.123">   //we might have to sort the view coming out of quick search</span>
<a href="#l92.124"></a><span id="l92.124">   var sortType = gDBView.sortType;</span>
<a href="#l92.125"></a><span id="l92.125">   var sortOrder = gDBView.sortOrder;</span>
<a href="#l92.126"></a><span id="l92.126">   var viewFlags = gDBView.viewFlags;</span>
<a href="#l92.127"></a><span id="l92.127">   var folder = gDBView.msgFolder;</span>
<a href="#l92.128"></a><span id="l92.128"> </span>
<a href="#l92.129"></a><span id="l92.129">   gDBView.close();</span>
<a href="#l92.130"></a><span id="l92.130" class="difflineminus">-  gDBView = null; </span>
<a href="#l92.131"></a><span id="l92.131" class="difflineplus">+  gDBView = null;</span>
<a href="#l92.132"></a><span id="l92.132"> </span>
<a href="#l92.133"></a><span id="l92.133">   if (gPreQuickSearchView)</span>
<a href="#l92.134"></a><span id="l92.134">   {</span>
<a href="#l92.135"></a><span id="l92.135">     gDBView = gPreQuickSearchView;</span>
<a href="#l92.136"></a><span id="l92.136">     if (gDBView.viewType == nsMsgViewType.eShowVirtualFolderResults)</span>
<a href="#l92.137"></a><span id="l92.137">     {</span>
<a href="#l92.138"></a><span id="l92.138">       // readd the view as a listener on the search results</span>
<a href="#l92.139"></a><span id="l92.139">       var saveViewSearchListener = gDBView.QueryInterface(Components.interfaces.nsIMsgSearchNotify);</span>
<a href="#l92.140"></a><span id="l92.140" class="difflineat">@@ -231,32 +231,32 @@ function restorePreSearchView()</span>
<a href="#l92.141"></a><span id="l92.141"> //    dump (&quot;view type = &quot; + gDBView.viewType + &quot;\n&quot;);</span>
<a href="#l92.142"></a><span id="l92.142"> </span>
<a href="#l92.143"></a><span id="l92.143">     if (sortType != gDBView.sortType || sortOrder != gDBView.sortOrder)</span>
<a href="#l92.144"></a><span id="l92.144">     {</span>
<a href="#l92.145"></a><span id="l92.145">       gDBView.sort(sortType, sortOrder);</span>
<a href="#l92.146"></a><span id="l92.146">     }</span>
<a href="#l92.147"></a><span id="l92.147">     UpdateSortIndicators(sortType, sortOrder);</span>
<a href="#l92.148"></a><span id="l92.148"> </span>
<a href="#l92.149"></a><span id="l92.149" class="difflineminus">-    gPreQuickSearchView = null;    </span>
<a href="#l92.150"></a><span id="l92.150" class="difflineplus">+    gPreQuickSearchView = null;</span>
<a href="#l92.151"></a><span id="l92.151">   }</span>
<a href="#l92.152"></a><span id="l92.152">   else //create default view type</span>
<a href="#l92.153"></a><span id="l92.153">     CreateDBView(folder, nsMsgViewType.eShowAllThreads, viewFlags, sortType, sortOrder);</span>
<a href="#l92.154"></a><span id="l92.154"> </span>
<a href="#l92.155"></a><span id="l92.155">   RerootThreadPane();</span>
<a href="#l92.156"></a><span id="l92.156" class="difflineminus">-   </span>
<a href="#l92.157"></a><span id="l92.157" class="difflineplus">+</span>
<a href="#l92.158"></a><span id="l92.158">   var scrolled = false;</span>
<a href="#l92.159"></a><span id="l92.159" class="difflineminus">-  </span>
<a href="#l92.160"></a><span id="l92.160" class="difflineplus">+</span>
<a href="#l92.161"></a><span id="l92.161">   // now restore selection</span>
<a href="#l92.162"></a><span id="l92.162">   if (selectedHdr)</span>
<a href="#l92.163"></a><span id="l92.163">   {</span>
<a href="#l92.164"></a><span id="l92.164">     gDBView.selectMsgByKey(selectedHdr.messageKey);</span>
<a href="#l92.165"></a><span id="l92.165">     var treeView = gDBView.QueryInterface(Components.interfaces.nsITreeView);</span>
<a href="#l92.166"></a><span id="l92.166">     var selectedIndex = treeView.selection.currentIndex;</span>
<a href="#l92.167"></a><span id="l92.167" class="difflineminus">-    if (selectedIndex &gt;= 0) </span>
<a href="#l92.168"></a><span id="l92.168" class="difflineplus">+    if (selectedIndex &gt;= 0)</span>
<a href="#l92.169"></a><span id="l92.169">     {</span>
<a href="#l92.170"></a><span id="l92.170">       // scroll</span>
<a href="#l92.171"></a><span id="l92.171">       EnsureRowInThreadTreeIsVisible(selectedIndex);</span>
<a href="#l92.172"></a><span id="l92.172">       scrolled = true;</span>
<a href="#l92.173"></a><span id="l92.173">     }</span>
<a href="#l92.174"></a><span id="l92.174">     else</span>
<a href="#l92.175"></a><span id="l92.175">       ClearMessagePane();</span>
<a href="#l92.176"></a><span id="l92.176">   }</span>
<a href="#l92.177"></a><span id="l92.177" class="difflineat">@@ -302,17 +302,17 @@ function createSearchTermsWithList(aTerm</span>
<a href="#l92.178"></a><span id="l92.178">   {</span>
<a href="#l92.179"></a><span id="l92.179">     var msgDatabase = selectedFolder.msgDatabase;</span>
<a href="#l92.180"></a><span id="l92.180">     if (msgDatabase)</span>
<a href="#l92.181"></a><span id="l92.181">     {</span>
<a href="#l92.182"></a><span id="l92.182">       var dbFolderInfo = msgDatabase.dBFolderInfo;</span>
<a href="#l92.183"></a><span id="l92.183">       var srchFolderUri = dbFolderInfo.getCharProperty(&quot;searchFolderUri&quot;);</span>
<a href="#l92.184"></a><span id="l92.184">       viewDebug(&quot;createSearchTermsWithList xf vf scope = &quot; + srchFolderUri + &quot;\n&quot;);</span>
<a href="#l92.185"></a><span id="l92.185">       var srchFolderUriArray = srchFolderUri.split('|');</span>
<a href="#l92.186"></a><span id="l92.186" class="difflineminus">-      for (i in srchFolderUriArray) </span>
<a href="#l92.187"></a><span id="l92.187" class="difflineplus">+      for (i in srchFolderUriArray)</span>
<a href="#l92.188"></a><span id="l92.188">       {</span>
<a href="#l92.189"></a><span id="l92.189">         let realFolder = GetMsgFolderFromUri(srchFolderUriArray[i]);</span>
<a href="#l92.190"></a><span id="l92.190">         if (!realFolder.isServer)</span>
<a href="#l92.191"></a><span id="l92.191">           gSearchSession.addScopeTerm(nsMsgSearchScope.offlineMail, realFolder);</span>
<a href="#l92.192"></a><span id="l92.192">       }</span>
<a href="#l92.193"></a><span id="l92.193">     }</span>
<a href="#l92.194"></a><span id="l92.194">   }</span>
<a href="#l92.195"></a><span id="l92.195">   else</span>
<a href="#l92.196"></a><span id="l92.196" class="difflineat">@@ -328,17 +328,17 @@ function createSearchTermsWithList(aTerm</span>
<a href="#l92.197"></a><span id="l92.197"> }</span>
<a href="#l92.198"></a><span id="l92.198"> </span>
<a href="#l92.199"></a><span id="l92.199"> function createSearchTerms()</span>
<a href="#l92.200"></a><span id="l92.200"> {</span>
<a href="#l92.201"></a><span id="l92.201">   var nsMsgSearchScope = Components.interfaces.nsMsgSearchScope;</span>
<a href="#l92.202"></a><span id="l92.202">   var nsMsgSearchAttrib = Components.interfaces.nsMsgSearchAttrib;</span>
<a href="#l92.203"></a><span id="l92.203">   var nsMsgSearchOp = Components.interfaces.nsMsgSearchOp;</span>
<a href="#l92.204"></a><span id="l92.204"> </span>
<a href="#l92.205"></a><span id="l92.205" class="difflineminus">-  // create an nsISupportsArray to store our search terms </span>
<a href="#l92.206"></a><span id="l92.206" class="difflineplus">+  // create an nsISupportsArray to store our search terms</span>
<a href="#l92.207"></a><span id="l92.207">   var searchTermsArray = Components.classes[&quot;@mozilla.org/supports-array;1&quot;].createInstance(Components.interfaces.nsISupportsArray);</span>
<a href="#l92.208"></a><span id="l92.208">   var selectedFolder = GetThreadPaneFolder();</span>
<a href="#l92.209"></a><span id="l92.209"> </span>
<a href="#l92.210"></a><span id="l92.210">   // implement | for QS</span>
<a href="#l92.211"></a><span id="l92.211">   // does this break if the user types &quot;foo|bar&quot; expecting to see subjects with that string?</span>
<a href="#l92.212"></a><span id="l92.212">   // I claim no, since &quot;foo|bar&quot; will be a hit for &quot;foo&quot; || &quot;bar&quot;</span>
<a href="#l92.213"></a><span id="l92.213">   // they just might get more false positives</span>
<a href="#l92.214"></a><span id="l92.214">   var termList = gSearchInput.value.split(&quot;|&quot;);</span>
<a href="#l92.215"></a><span id="l92.215" class="difflineat">@@ -359,46 +359,46 @@ function createSearchTerms()</span>
<a href="#l92.216"></a><span id="l92.216">     searchTermsArray.AppendElement(term);</span>
<a href="#l92.217"></a><span id="l92.217"> </span>
<a href="#l92.218"></a><span id="l92.218">     // create, fill, and append the AllAddresses term</span>
<a href="#l92.219"></a><span id="l92.219">     term = gSearchSession.createTerm();</span>
<a href="#l92.220"></a><span id="l92.220">     value = term.value;</span>
<a href="#l92.221"></a><span id="l92.221">     value.str = termList[i];</span>
<a href="#l92.222"></a><span id="l92.222">     term.value = value;</span>
<a href="#l92.223"></a><span id="l92.223">     term.attrib = nsMsgSearchAttrib.AllAddresses;</span>
<a href="#l92.224"></a><span id="l92.224" class="difflineminus">-    term.op = nsMsgSearchOp.Contains; </span>
<a href="#l92.225"></a><span id="l92.225" class="difflineplus">+    term.op = nsMsgSearchOp.Contains;</span>
<a href="#l92.226"></a><span id="l92.226">     term.booleanAnd = false;</span>
<a href="#l92.227"></a><span id="l92.227">     searchTermsArray.AppendElement(term);</span>
<a href="#l92.228"></a><span id="l92.228">   }</span>
<a href="#l92.229"></a><span id="l92.229"> </span>
<a href="#l92.230"></a><span id="l92.230" class="difflineminus">-  // now append the default view or virtual folder criteria to the quick search   </span>
<a href="#l92.231"></a><span id="l92.231" class="difflineplus">+  // now append the default view or virtual folder criteria to the quick search</span>
<a href="#l92.232"></a><span id="l92.232">   // so we don't lose any default view information</span>
<a href="#l92.233"></a><span id="l92.233" class="difflineminus">-  viewDebug(&quot;gDefaultSearchViewTerms = &quot; + gDefaultSearchViewTerms + &quot;gVirtualFolderTerms = &quot; + gVirtualFolderTerms + </span>
<a href="#l92.234"></a><span id="l92.234" class="difflineplus">+  viewDebug(&quot;gDefaultSearchViewTerms = &quot; + gDefaultSearchViewTerms + &quot;gVirtualFolderTerms = &quot; + gVirtualFolderTerms +</span>
<a href="#l92.235"></a><span id="l92.235">     &quot;gXFVirtualFolderTerms = &quot; + gXFVirtualFolderTerms + &quot;\n&quot;);</span>
<a href="#l92.236"></a><span id="l92.236">   var defaultSearchTerms = (gDefaultSearchViewTerms || gVirtualFolderTerms || gXFVirtualFolderTerms);</span>
<a href="#l92.237"></a><span id="l92.237">   if (defaultSearchTerms)</span>
<a href="#l92.238"></a><span id="l92.238">   {</span>
<a href="#l92.239"></a><span id="l92.239">     var isupports = null;</span>
<a href="#l92.240"></a><span id="l92.240" class="difflineminus">-    var searchTerm; </span>
<a href="#l92.241"></a><span id="l92.241" class="difflineplus">+    var searchTerm;</span>
<a href="#l92.242"></a><span id="l92.242">     var termsArray = defaultSearchTerms.QueryInterface(Components.interfaces.nsISupportsArray);</span>
<a href="#l92.243"></a><span id="l92.243">     for (i = 0; i &lt; termsArray.Count(); i++)</span>
<a href="#l92.244"></a><span id="l92.244">     {</span>
<a href="#l92.245"></a><span id="l92.245">       isupports = termsArray.GetElementAt(i);</span>
<a href="#l92.246"></a><span id="l92.246">       searchTerm = isupports.QueryInterface(Components.interfaces.nsIMsgSearchTerm);</span>
<a href="#l92.247"></a><span id="l92.247">       searchTermsArray.AppendElement(searchTerm);</span>
<a href="#l92.248"></a><span id="l92.248">     }</span>
<a href="#l92.249"></a><span id="l92.249">   }</span>
<a href="#l92.250"></a><span id="l92.250" class="difflineminus">-  </span>
<a href="#l92.251"></a><span id="l92.251" class="difflineplus">+</span>
<a href="#l92.252"></a><span id="l92.252">   createSearchTermsWithList(searchTermsArray);</span>
<a href="#l92.253"></a><span id="l92.253" class="difflineminus">-  </span>
<a href="#l92.254"></a><span id="l92.254" class="difflineplus">+</span>
<a href="#l92.255"></a><span id="l92.255">   // now that we've added the terms, clear out our input array</span>
<a href="#l92.256"></a><span id="l92.256">   searchTermsArray.Clear();</span>
<a href="#l92.257"></a><span id="l92.257"> }</span>
<a href="#l92.258"></a><span id="l92.258"> </span>
<a href="#l92.259"></a><span id="l92.259" class="difflineminus">-function onSearchStop() </span>
<a href="#l92.260"></a><span id="l92.260" class="difflineplus">+function onSearchStop()</span>
<a href="#l92.261"></a><span id="l92.261"> {</span>
<a href="#l92.262"></a><span id="l92.262">   gSearchSession.interruptSearch();</span>
<a href="#l92.263"></a><span id="l92.263"> }</span>
<a href="#l92.264"></a><span id="l92.264"> </span>
<a href="#l92.265"></a><span id="l92.265"> function onClearSearch()</span>
<a href="#l92.266"></a><span id="l92.266"> {</span>
<a href="#l92.267"></a><span id="l92.267">   // Use the last focused element so that focus can be restored</span>
<a href="#l92.268"></a><span id="l92.268">   // if it does not exist, try and get the thread tree instead</span>
<a href="#l92.269"></a><span id="l92.269" class="difflineat">@@ -424,17 +424,17 @@ function ClearQSIfNecessary()</span>
<a href="#l92.270"></a><span id="l92.270"> }</span>
<a href="#l92.271"></a><span id="l92.271"> </span>
<a href="#l92.272"></a><span id="l92.272"> function Search(str)</span>
<a href="#l92.273"></a><span id="l92.273"> {</span>
<a href="#l92.274"></a><span id="l92.274">   GetSearchInput();</span>
<a href="#l92.275"></a><span id="l92.275"> </span>
<a href="#l92.276"></a><span id="l92.276">   if (str != gSearchInput.value)</span>
<a href="#l92.277"></a><span id="l92.277">   {</span>
<a href="#l92.278"></a><span id="l92.278" class="difflineminus">-    gQSViewIsDirty = true; </span>
<a href="#l92.279"></a><span id="l92.279" class="difflineplus">+    gQSViewIsDirty = true;</span>
<a href="#l92.280"></a><span id="l92.280">     viewDebug(&quot;in Search(), setting gQSViewIsDirty true\n&quot;);</span>
<a href="#l92.281"></a><span id="l92.281">   }</span>
<a href="#l92.282"></a><span id="l92.282"> </span>
<a href="#l92.283"></a><span id="l92.283">   gSearchInput.value = str;  //on input does not get fired for some reason</span>
<a href="#l92.284"></a><span id="l92.284">   onEnterInSearchBar();</span>
<a href="#l92.285"></a><span id="l92.285"> }</span>
<a href="#l92.286"></a><span id="l92.286"> </span>
<a href="#l92.287"></a><span id="l92.287"> function saveViewAsVirtualFolder()</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l93.1"></a><span id="l93.1" class="difflineminus">--- a/suite/mailnews/threadPane.js</span>
<a href="#l93.2"></a><span id="l93.2" class="difflineplus">+++ b/suite/mailnews/threadPane.js</span>
<a href="#l93.3"></a><span id="l93.3" class="difflineat">@@ -67,17 +67,17 @@ function ThreadPaneOnClick(event)</span>
<a href="#l93.4"></a><span id="l93.4">       event.stopPropagation();</span>
<a href="#l93.5"></a><span id="l93.5">     }</span>
<a href="#l93.6"></a><span id="l93.6">   }</span>
<a href="#l93.7"></a><span id="l93.7"> }</span>
<a href="#l93.8"></a><span id="l93.8"> </span>
<a href="#l93.9"></a><span id="l93.9"> function nsMsgDBViewCommandUpdater()</span>
<a href="#l93.10"></a><span id="l93.10"> {}</span>
<a href="#l93.11"></a><span id="l93.11"> </span>
<a href="#l93.12"></a><span id="l93.12" class="difflineminus">-nsMsgDBViewCommandUpdater.prototype = </span>
<a href="#l93.13"></a><span id="l93.13" class="difflineplus">+nsMsgDBViewCommandUpdater.prototype =</span>
<a href="#l93.14"></a><span id="l93.14"> {</span>
<a href="#l93.15"></a><span id="l93.15">   updateCommandStatus : function()</span>
<a href="#l93.16"></a><span id="l93.16">     {</span>
<a href="#l93.17"></a><span id="l93.17">       // the back end is smart and is only telling us to update command status</span>
<a href="#l93.18"></a><span id="l93.18">       // when the # of items in the selection has actually changed.</span>
<a href="#l93.19"></a><span id="l93.19">       UpdateMailToolbar(&quot;dbview driven, thread pane&quot;);</span>
<a href="#l93.20"></a><span id="l93.20">     },</span>
<a href="#l93.21"></a><span id="l93.21"> </span>
<a href="#l93.22"></a><span id="l93.22" class="difflineat">@@ -98,17 +98,17 @@ nsMsgDBViewCommandUpdater.prototype =</span>
<a href="#l93.23"></a><span id="l93.23"> </span>
<a href="#l93.24"></a><span id="l93.24">   summarizeSelection: function() {return false},</span>
<a href="#l93.25"></a><span id="l93.25"> </span>
<a href="#l93.26"></a><span id="l93.26">   QueryInterface : function(iid)</span>
<a href="#l93.27"></a><span id="l93.27">    {</span>
<a href="#l93.28"></a><span id="l93.28">      if (iid.equals(Components.interfaces.nsIMsgDBViewCommandUpdater) ||</span>
<a href="#l93.29"></a><span id="l93.29">          iid.equals(Components.interfaces.nsISupports))</span>
<a href="#l93.30"></a><span id="l93.30">        return this;</span>
<a href="#l93.31"></a><span id="l93.31" class="difflineminus">-	  </span>
<a href="#l93.32"></a><span id="l93.32" class="difflineplus">+</span>
<a href="#l93.33"></a><span id="l93.33">      throw Components.results.NS_NOINTERFACE;</span>
<a href="#l93.34"></a><span id="l93.34">     }</span>
<a href="#l93.35"></a><span id="l93.35"> }</span>
<a href="#l93.36"></a><span id="l93.36"> </span>
<a href="#l93.37"></a><span id="l93.37"> function HandleColumnClick(columnID)</span>
<a href="#l93.38"></a><span id="l93.38"> {</span>
<a href="#l93.39"></a><span id="l93.39">   const columnMap = {dateCol: 'byDate',</span>
<a href="#l93.40"></a><span id="l93.40">                      receivedCol: 'byReceived',</span>
<a href="#l93.41"></a><span id="l93.41" class="difflineat">@@ -136,17 +136,17 @@ function HandleColumnClick(columnID)</span>
<a href="#l93.42"></a><span id="l93.42">     // If the column isn't in the map, check and see if it's a custom column</span>
<a href="#l93.43"></a><span id="l93.43">     try {</span>
<a href="#l93.44"></a><span id="l93.44">       // try to grab the columnHandler (an error is thrown if it does not exist)</span>
<a href="#l93.45"></a><span id="l93.45">       columnHandler = gDBView.getColumnHandler(columnID);</span>
<a href="#l93.46"></a><span id="l93.46"> </span>
<a href="#l93.47"></a><span id="l93.47">       // it exists - save this column ID in the customSortCol property of</span>
<a href="#l93.48"></a><span id="l93.48">       // dbFolderInfo for later use (see nsIMsgDBView.cpp)</span>
<a href="#l93.49"></a><span id="l93.49">       gDBView.db.dBFolderInfo.setProperty('customSortCol', columnID);</span>
<a href="#l93.50"></a><span id="l93.50" class="difflineminus">-        </span>
<a href="#l93.51"></a><span id="l93.51" class="difflineplus">+</span>
<a href="#l93.52"></a><span id="l93.52">       sortType = &quot;byCustom&quot;;</span>
<a href="#l93.53"></a><span id="l93.53">     } catch(err) {</span>
<a href="#l93.54"></a><span id="l93.54">         dump(&quot;unsupported sort column: &quot; + columnID + &quot; - no custom handler installed. (Error was: &quot; + err + &quot;)\n&quot;);</span>
<a href="#l93.55"></a><span id="l93.55">         return; // bail out</span>
<a href="#l93.56"></a><span id="l93.56">     }</span>
<a href="#l93.57"></a><span id="l93.57">   }</span>
<a href="#l93.58"></a><span id="l93.58"> </span>
<a href="#l93.59"></a><span id="l93.59">   var dbview = GetDBView();</span>
<a href="#l93.60"></a><span id="l93.60" class="difflineat">@@ -253,34 +253,34 @@ function MsgToggleThreaded()</span>
<a href="#l93.61"></a><span id="l93.61"> </span>
<a href="#l93.62"></a><span id="l93.62"> function MsgSortThreaded()</span>
<a href="#l93.63"></a><span id="l93.63"> {</span>
<a href="#l93.64"></a><span id="l93.64">     var dbview = GetDBView();</span>
<a href="#l93.65"></a><span id="l93.65">     var viewFlags = dbview.viewFlags;</span>
<a href="#l93.66"></a><span id="l93.66">     let wasGrouped = viewFlags &amp; nsMsgViewFlagsType.kGroupBySort;</span>
<a href="#l93.67"></a><span id="l93.67">     dbview.viewFlags &amp;= ~nsMsgViewFlagsType.kGroupBySort;</span>
<a href="#l93.68"></a><span id="l93.68">     // if we were grouped, and not a saved search, just rebuild the view</span>
<a href="#l93.69"></a><span id="l93.69" class="difflineminus">-    if (wasGrouped &amp;&amp; !(gMsgFolderSelected.flags &amp; </span>
<a href="#l93.70"></a><span id="l93.70" class="difflineplus">+    if (wasGrouped &amp;&amp; !(gMsgFolderSelected.flags &amp;</span>
<a href="#l93.71"></a><span id="l93.71">                        Components.interfaces.nsMsgFolderFlags.Virtual))</span>
<a href="#l93.72"></a><span id="l93.72">       SwitchView(&quot;cmd_viewAllMsgs&quot;);</span>
<a href="#l93.73"></a><span id="l93.73">     // Toggle if not already threaded.</span>
<a href="#l93.74"></a><span id="l93.74">     else if ((viewFlags &amp; nsMsgViewFlagsType.kThreadedDisplay) == 0)</span>
<a href="#l93.75"></a><span id="l93.75">         MsgToggleThreaded();</span>
<a href="#l93.76"></a><span id="l93.76"> }</span>
<a href="#l93.77"></a><span id="l93.77"> </span>
<a href="#l93.78"></a><span id="l93.78"> function MsgGroupBySort()</span>
<a href="#l93.79"></a><span id="l93.79"> {</span>
<a href="#l93.80"></a><span id="l93.80">   var dbview = GetDBView();</span>
<a href="#l93.81"></a><span id="l93.81">   var viewFlags = dbview.viewFlags;</span>
<a href="#l93.82"></a><span id="l93.82">   var sortOrder = dbview.sortOrder;</span>
<a href="#l93.83"></a><span id="l93.83">   var sortType = dbview.sortType;</span>
<a href="#l93.84"></a><span id="l93.84">   var count = new Object;</span>
<a href="#l93.85"></a><span id="l93.85">   var msgFolder = dbview.msgFolder;</span>
<a href="#l93.86"></a><span id="l93.86"> </span>
<a href="#l93.87"></a><span id="l93.87" class="difflineminus">-  var sortTypeSupportsGrouping = (sortType == nsMsgViewSortType.byAuthor </span>
<a href="#l93.88"></a><span id="l93.88" class="difflineplus">+  var sortTypeSupportsGrouping = (sortType == nsMsgViewSortType.byAuthor</span>
<a href="#l93.89"></a><span id="l93.89">          || sortType == nsMsgViewSortType.byDate || sortType == nsMsgViewSortType.byReceived || sortType == nsMsgViewSortType.byPriority</span>
<a href="#l93.90"></a><span id="l93.90">          || sortType == nsMsgViewSortType.bySubject || sortType == nsMsgViewSortType.byTags</span>
<a href="#l93.91"></a><span id="l93.91">          || sortType == nsMsgViewSortType.byStatus  || sortType == nsMsgViewSortType.byRecipient</span>
<a href="#l93.92"></a><span id="l93.92">          || sortType == nsMsgViewSortType.byAccount || sortType == nsMsgViewSortType.byFlagged</span>
<a href="#l93.93"></a><span id="l93.93">          || sortType == nsMsgViewSortType.byAttachments);</span>
<a href="#l93.94"></a><span id="l93.94"> </span>
<a href="#l93.95"></a><span id="l93.95">   if (!sortTypeSupportsGrouping)</span>
<a href="#l93.96"></a><span id="l93.96">     return; // we shouldn't be trying to group something we don't support grouping for...</span>
<a href="#l93.97"></a><span id="l93.97" class="difflineat">@@ -331,17 +331,17 @@ function MsgSortDescending()</span>
<a href="#l93.98"></a><span id="l93.98"> {</span>
<a href="#l93.99"></a><span id="l93.99">   var dbview = GetDBView();</span>
<a href="#l93.100"></a><span id="l93.100">   dbview.sort(dbview.sortType, nsMsgViewSortOrder.descending);</span>
<a href="#l93.101"></a><span id="l93.101">   UpdateSortIndicators(dbview.sortType, nsMsgViewSortOrder.descending);</span>
<a href="#l93.102"></a><span id="l93.102"> }</span>
<a href="#l93.103"></a><span id="l93.103"> </span>
<a href="#l93.104"></a><span id="l93.104"> function groupedBySortUsingDummyRow()</span>
<a href="#l93.105"></a><span id="l93.105"> {</span>
<a href="#l93.106"></a><span id="l93.106" class="difflineminus">-  return (gDBView.viewFlags &amp; nsMsgViewFlagsType.kGroupBySort) &amp;&amp; </span>
<a href="#l93.107"></a><span id="l93.107" class="difflineplus">+  return (gDBView.viewFlags &amp; nsMsgViewFlagsType.kGroupBySort) &amp;&amp;</span>
<a href="#l93.108"></a><span id="l93.108">          (gDBView.sortType != nsMsgViewSortType.bySubject);</span>
<a href="#l93.109"></a><span id="l93.109"> }</span>
<a href="#l93.110"></a><span id="l93.110"> </span>
<a href="#l93.111"></a><span id="l93.111"> function UpdateSortIndicators(sortType, sortOrder)</span>
<a href="#l93.112"></a><span id="l93.112"> {</span>
<a href="#l93.113"></a><span id="l93.113">   // Remove the sort indicator from all the columns</span>
<a href="#l93.114"></a><span id="l93.114">   var treeColumns = document.getElementById('threadCols').childNodes;</span>
<a href="#l93.115"></a><span id="l93.115">   for (var i = 0; i &lt; treeColumns.length; i++)</span>
<a href="#l93.116"></a><span id="l93.116" class="difflineat">@@ -351,31 +351,31 @@ function UpdateSortIndicators(sortType, </span>
<a href="#l93.117"></a><span id="l93.117">   var threadCol = document.getElementById(&quot;threadCol&quot;);</span>
<a href="#l93.118"></a><span id="l93.118">   var sortedColumn;</span>
<a href="#l93.119"></a><span id="l93.119">   // set the sort indicator on the column we are sorted by</span>
<a href="#l93.120"></a><span id="l93.120">   var colID = ConvertSortTypeToColumnID(sortType);</span>
<a href="#l93.121"></a><span id="l93.121">   if (colID)</span>
<a href="#l93.122"></a><span id="l93.122">     sortedColumn = document.getElementById(colID);</span>
<a href="#l93.123"></a><span id="l93.123"> </span>
<a href="#l93.124"></a><span id="l93.124">   var dbview = GetDBView();</span>
<a href="#l93.125"></a><span id="l93.125" class="difflineminus">-  var currCol = dbview.viewFlags &amp; nsMsgViewFlagsType.kGroupBySort </span>
<a href="#l93.126"></a><span id="l93.126" class="difflineplus">+  var currCol = dbview.viewFlags &amp; nsMsgViewFlagsType.kGroupBySort</span>
<a href="#l93.127"></a><span id="l93.127">     ? sortedColumn : document.getElementById(&quot;subjectCol&quot;);</span>
<a href="#l93.128"></a><span id="l93.128"> </span>
<a href="#l93.129"></a><span id="l93.129">   if (dbview.viewFlags &amp; nsMsgViewFlagsType.kGroupBySort)</span>
<a href="#l93.130"></a><span id="l93.130">   {</span>
<a href="#l93.131"></a><span id="l93.131" class="difflineminus">-    var threadTree = document.getElementById(&quot;threadTree&quot;);  </span>
<a href="#l93.132"></a><span id="l93.132" class="difflineplus">+    var threadTree = document.getElementById(&quot;threadTree&quot;);</span>
<a href="#l93.133"></a><span id="l93.133">     var subjectCol = document.getElementById(&quot;subjectCol&quot;);</span>
<a href="#l93.134"></a><span id="l93.134"> </span>
<a href="#l93.135"></a><span id="l93.135">     if (groupedBySortUsingDummyRow())</span>
<a href="#l93.136"></a><span id="l93.136">     {</span>
<a href="#l93.137"></a><span id="l93.137">       currCol.removeAttribute(&quot;primary&quot;);</span>
<a href="#l93.138"></a><span id="l93.138">       subjectCol.setAttribute(&quot;primary&quot;, &quot;true&quot;);</span>
<a href="#l93.139"></a><span id="l93.139">     }</span>
<a href="#l93.140"></a><span id="l93.140"> </span>
<a href="#l93.141"></a><span id="l93.141" class="difflineminus">-    // hide the threaded column when in grouped view since you can't do </span>
<a href="#l93.142"></a><span id="l93.142" class="difflineplus">+    // hide the threaded column when in grouped view since you can't do</span>
<a href="#l93.143"></a><span id="l93.143">     // threads inside of a group.</span>
<a href="#l93.144"></a><span id="l93.144">     document.getElementById(&quot;threadCol&quot;).collapsed = true;</span>
<a href="#l93.145"></a><span id="l93.145">   }</span>
<a href="#l93.146"></a><span id="l93.146"> </span>
<a href="#l93.147"></a><span id="l93.147">   // clear primary attribute from group column if going to a non-grouped view.</span>
<a href="#l93.148"></a><span id="l93.148">   if (!(dbview.viewFlags &amp; nsMsgViewFlagsType.kGroupBySort))</span>
<a href="#l93.149"></a><span id="l93.149">     document.getElementById(&quot;threadCol&quot;).collapsed = false;</span>
<a href="#l93.150"></a><span id="l93.150"> </span>
<a href="#l93.151"></a><span id="l93.151" class="difflineat">@@ -420,17 +420,17 @@ function GetThreadPaneFolder()</span>
<a href="#l93.152"></a><span id="l93.152"> }</span>
<a href="#l93.153"></a><span id="l93.153"> </span>
<a href="#l93.154"></a><span id="l93.154"> function EnsureRowInThreadTreeIsVisible(index)</span>
<a href="#l93.155"></a><span id="l93.155"> {</span>
<a href="#l93.156"></a><span id="l93.156">   if (index &lt; 0)</span>
<a href="#l93.157"></a><span id="l93.157">     return;</span>
<a href="#l93.158"></a><span id="l93.158"> </span>
<a href="#l93.159"></a><span id="l93.159">   var tree = GetThreadTree();</span>
<a href="#l93.160"></a><span id="l93.160" class="difflineminus">-  tree.treeBoxObject.ensureRowIsVisible(index); </span>
<a href="#l93.161"></a><span id="l93.161" class="difflineplus">+  tree.treeBoxObject.ensureRowIsVisible(index);</span>
<a href="#l93.162"></a><span id="l93.162"> }</span>
<a href="#l93.163"></a><span id="l93.163"> </span>
<a href="#l93.164"></a><span id="l93.164"> function RerootThreadPane()</span>
<a href="#l93.165"></a><span id="l93.165"> {</span>
<a href="#l93.166"></a><span id="l93.166">   SetNewsFolderColumns();</span>
<a href="#l93.167"></a><span id="l93.167"> </span>
<a href="#l93.168"></a><span id="l93.168">   var treeView = gDBView.QueryInterface(Components.interfaces.nsITreeView);</span>
<a href="#l93.169"></a><span id="l93.169">   if (treeView)</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l94.1"></a><span id="l94.1" class="difflineminus">--- a/suite/mailnews/widgetglue.js</span>
<a href="#l94.2"></a><span id="l94.2" class="difflineplus">+++ b/suite/mailnews/widgetglue.js</span>
<a href="#l94.3"></a><span id="l94.3" class="difflineat">@@ -3,47 +3,47 @@</span>
<a href="#l94.4"></a><span id="l94.4">  * License, v. 2.0. If a copy of the MPL was not distributed with this</span>
<a href="#l94.5"></a><span id="l94.5">  * file, You can obtain one at http://mozilla.org/MPL/2.0/. */</span>
<a href="#l94.6"></a><span id="l94.6"> </span>
<a href="#l94.7"></a><span id="l94.7"> /*</span>
<a href="#l94.8"></a><span id="l94.8">  * widget-specific wrapper glue. There should be one function for every</span>
<a href="#l94.9"></a><span id="l94.9">  * widget/menu item, which gets some context (like the current selection)</span>
<a href="#l94.10"></a><span id="l94.10">  * and then calls a function/command in commandglue</span>
<a href="#l94.11"></a><span id="l94.11">  */</span>
<a href="#l94.12"></a><span id="l94.12" class="difflineminus">- </span>
<a href="#l94.13"></a><span id="l94.13" class="difflineplus">+</span>
<a href="#l94.14"></a><span id="l94.14"> //The eventual goal is for this file to go away and its contents to be brought into</span>
<a href="#l94.15"></a><span id="l94.15"> //mailWindowOverlay.js.  This is currently being done.</span>
<a href="#l94.16"></a><span id="l94.16"> </span>
<a href="#l94.17"></a><span id="l94.17"> Components.utils.import(&quot;resource:///modules/MailUtils.js&quot;);</span>
<a href="#l94.18"></a><span id="l94.18"> </span>
<a href="#l94.19"></a><span id="l94.19"> //NOTE: gMessengerBundle must be defined and set or this Overlay won't work</span>
<a href="#l94.20"></a><span id="l94.20"> </span>
<a href="#l94.21"></a><span id="l94.21"> function GetSelectedFolderURI()</span>
<a href="#l94.22"></a><span id="l94.22"> {</span>
<a href="#l94.23"></a><span id="l94.23">   let folders = GetSelectedMsgFolders();</span>
<a href="#l94.24"></a><span id="l94.24">   return folders.length == 1 ? folders[0].URI : null;</span>
<a href="#l94.25"></a><span id="l94.25"> }</span>
<a href="#l94.26"></a><span id="l94.26"> </span>
<a href="#l94.27"></a><span id="l94.27" class="difflineminus">-function MsgRenameFolder() </span>
<a href="#l94.28"></a><span id="l94.28" class="difflineplus">+function MsgRenameFolder()</span>
<a href="#l94.29"></a><span id="l94.29"> {</span>
<a href="#l94.30"></a><span id="l94.30">   let folder = GetSelectedMsgFolders()[0];</span>
<a href="#l94.31"></a><span id="l94.31">   let dialog = window.openDialog(</span>
<a href="#l94.32"></a><span id="l94.32">                &quot;chrome://messenger/content/renameFolderDialog.xul&quot;,</span>
<a href="#l94.33"></a><span id="l94.33">                &quot;&quot;,</span>
<a href="#l94.34"></a><span id="l94.34">                &quot;chrome,modal,centerscreen&quot;,</span>
<a href="#l94.35"></a><span id="l94.35">                {preselectedURI: folder.URI,</span>
<a href="#l94.36"></a><span id="l94.36">                 okCallback: RenameFolder, name: folder.prettyName});</span>
<a href="#l94.37"></a><span id="l94.37"> }</span>
<a href="#l94.38"></a><span id="l94.38"> </span>
<a href="#l94.39"></a><span id="l94.39"> function RenameFolder(name,uri)</span>
<a href="#l94.40"></a><span id="l94.40"> {</span>
<a href="#l94.41"></a><span id="l94.41">   var folderTree = GetFolderTree();</span>
<a href="#l94.42"></a><span id="l94.42">   if (folderTree)</span>
<a href="#l94.43"></a><span id="l94.43">   {</span>
<a href="#l94.44"></a><span id="l94.44" class="difflineminus">-    if (uri &amp;&amp; (uri != &quot;&quot;) &amp;&amp; name &amp;&amp; (name != &quot;&quot;)) </span>
<a href="#l94.45"></a><span id="l94.45" class="difflineplus">+    if (uri &amp;&amp; (uri != &quot;&quot;) &amp;&amp; name &amp;&amp; (name != &quot;&quot;))</span>
<a href="#l94.46"></a><span id="l94.46">     {</span>
<a href="#l94.47"></a><span id="l94.47">       var selectedFolder = GetMsgFolderFromUri(uri);</span>
<a href="#l94.48"></a><span id="l94.48">       if (gDBView)</span>
<a href="#l94.49"></a><span id="l94.49">         gCurrentlyDisplayedMessage = gDBView.currentlyDisplayedMessage;</span>
<a href="#l94.50"></a><span id="l94.50"> </span>
<a href="#l94.51"></a><span id="l94.51">       ClearThreadPane();</span>
<a href="#l94.52"></a><span id="l94.52">       ClearMessagePane();</span>
<a href="#l94.53"></a><span id="l94.53">       folderTree.view.selection.clearSelection();</span>
<a href="#l94.54"></a><span id="l94.54" class="difflineat">@@ -54,22 +54,22 @@ function RenameFolder(name,uri)</span>
<a href="#l94.55"></a><span id="l94.55">       }</span>
<a href="#l94.56"></a><span id="l94.56">       catch(e)</span>
<a href="#l94.57"></a><span id="l94.57">       {</span>
<a href="#l94.58"></a><span id="l94.58">         SelectFolder(selectedFolder.URI);  //restore selection</span>
<a href="#l94.59"></a><span id="l94.59">         throw(e); // so that the dialog does not automatically close</span>
<a href="#l94.60"></a><span id="l94.60">         dump (&quot;Exception : RenameFolder \n&quot;);</span>
<a href="#l94.61"></a><span id="l94.61">       }</span>
<a href="#l94.62"></a><span id="l94.62">     }</span>
<a href="#l94.63"></a><span id="l94.63" class="difflineminus">-    else </span>
<a href="#l94.64"></a><span id="l94.64" class="difflineplus">+    else</span>
<a href="#l94.65"></a><span id="l94.65">     {</span>
<a href="#l94.66"></a><span id="l94.66">       dump(&quot;no name or nothing selected\n&quot;);</span>
<a href="#l94.67"></a><span id="l94.67" class="difflineminus">-    }   </span>
<a href="#l94.68"></a><span id="l94.68" class="difflineplus">+    }</span>
<a href="#l94.69"></a><span id="l94.69">   }</span>
<a href="#l94.70"></a><span id="l94.70" class="difflineminus">-  else </span>
<a href="#l94.71"></a><span id="l94.71" class="difflineplus">+  else</span>
<a href="#l94.72"></a><span id="l94.72">   {</span>
<a href="#l94.73"></a><span id="l94.73">     dump(&quot;no folder tree\n&quot;);</span>
<a href="#l94.74"></a><span id="l94.74">   }</span>
<a href="#l94.75"></a><span id="l94.75"> }</span>
<a href="#l94.76"></a><span id="l94.76"> </span>
<a href="#l94.77"></a><span id="l94.77"> function MsgEmptyTrash()</span>
<a href="#l94.78"></a><span id="l94.78"> {</span>
<a href="#l94.79"></a><span id="l94.79">   let folders = GetSelectedMsgFolders();</span>
<a href="#l94.80"></a><span id="l94.80" class="difflineat">@@ -156,17 +156,17 @@ function MsgFolderProperties()</span>
<a href="#l94.81"></a><span id="l94.81"> </span>
<a href="#l94.82"></a><span id="l94.82">   // if a server is selected, view settings for that account</span>
<a href="#l94.83"></a><span id="l94.83">   if (msgFolder.isServer) {</span>
<a href="#l94.84"></a><span id="l94.84">     MsgAccountManager(null, msgFolder.server);</span>
<a href="#l94.85"></a><span id="l94.85">     return;</span>
<a href="#l94.86"></a><span id="l94.86">   }</span>
<a href="#l94.87"></a><span id="l94.87"> </span>
<a href="#l94.88"></a><span id="l94.88">   if (msgFolder.flags &amp; Components.interfaces.nsMsgFolderFlags.Virtual)</span>
<a href="#l94.89"></a><span id="l94.89" class="difflineminus">-  { </span>
<a href="#l94.90"></a><span id="l94.90" class="difflineplus">+  {</span>
<a href="#l94.91"></a><span id="l94.91">     // virtual folders get their own property dialog that contains all of the</span>
<a href="#l94.92"></a><span id="l94.92">     // search information related to the virtual folder.</span>
<a href="#l94.93"></a><span id="l94.93">     MsgVirtualFolderProperties(true);</span>
<a href="#l94.94"></a><span id="l94.94">     return;</span>
<a href="#l94.95"></a><span id="l94.95">   }</span>
<a href="#l94.96"></a><span id="l94.96"> </span>
<a href="#l94.97"></a><span id="l94.97">   var windowTitle = gMessengerBundle.getString(&quot;folderProperties&quot;);</span>
<a href="#l94.98"></a><span id="l94.98">   var dialog = window.openDialog(</span>
<a href="#l94.99"></a><span id="l94.99" class="difflineat">@@ -210,19 +210,19 @@ function RebuildSummaryFile(msgFolder)</span>
<a href="#l94.100"></a><span id="l94.100"> </span>
<a href="#l94.101"></a><span id="l94.101"> function FolderProperties(name, oldName, uri)</span>
<a href="#l94.102"></a><span id="l94.102"> {</span>
<a href="#l94.103"></a><span id="l94.103">   if (name != oldName)</span>
<a href="#l94.104"></a><span id="l94.104">     RenameFolder(name, uri);</span>
<a href="#l94.105"></a><span id="l94.105"> }</span>
<a href="#l94.106"></a><span id="l94.106"> </span>
<a href="#l94.107"></a><span id="l94.107"> // Given a URI we would like to return corresponding message folder here.</span>
<a href="#l94.108"></a><span id="l94.108" class="difflineminus">-// An additonal input param which specifies whether or not to check folder </span>
<a href="#l94.109"></a><span id="l94.109" class="difflineplus">+// An additonal input param which specifies whether or not to check folder</span>
<a href="#l94.110"></a><span id="l94.110"> // attributes (like if there exists a parent or is it a server) is also passed</span>
<a href="#l94.111"></a><span id="l94.111" class="difflineminus">-// to this routine. Qualifying against those checks would return an existing </span>
<a href="#l94.112"></a><span id="l94.112" class="difflineplus">+// to this routine. Qualifying against those checks would return an existing</span>
<a href="#l94.113"></a><span id="l94.113"> // folder. Callers who don't want to check those attributes will specify the</span>
<a href="#l94.114"></a><span id="l94.114"> // same and then this routine will simply return a msgfolder. This scenario</span>
<a href="#l94.115"></a><span id="l94.115"> // applies to a new imap account creation where special folders are created</span>
<a href="#l94.116"></a><span id="l94.116"> // on demand and hence needs to prior check of existence.</span>
<a href="#l94.117"></a><span id="l94.117"> function GetMsgFolderFromUri(uri, checkFolderAttributes)</span>
<a href="#l94.118"></a><span id="l94.118"> {</span>
<a href="#l94.119"></a><span id="l94.119">   return MailUtils.getFolderForURI(uri, checkFolderAttributes);</span>
<a href="#l94.120"></a><span id="l94.120"> }</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l95.1"></a><span id="l95.1" class="difflineminus">--- a/suite/modules/test/unit/test_browser_sanitizer.js</span>
<a href="#l95.2"></a><span id="l95.2" class="difflineplus">+++ b/suite/modules/test/unit/test_browser_sanitizer.js</span>
<a href="#l95.3"></a><span id="l95.3" class="difflineat">@@ -162,17 +162,17 @@ var sanTests = {</span>
<a href="#l95.4"></a><span id="l95.4">   formdata: {</span>
<a href="#l95.5"></a><span id="l95.5">     desc: &quot;Form history&quot;,</span>
<a href="#l95.6"></a><span id="l95.6">     setup: function() {</span>
<a href="#l95.7"></a><span id="l95.7">       this.forms = Components.classes[&quot;@mozilla.org/satchel/form-history;1&quot;]</span>
<a href="#l95.8"></a><span id="l95.8">                              .getService(Components.interfaces.nsIFormHistory2);</span>
<a href="#l95.9"></a><span id="l95.9">       this.forms.addEntry(&quot;Sanitizer&quot;, &quot;Foo&quot;);</span>
<a href="#l95.10"></a><span id="l95.10">     },</span>
<a href="#l95.11"></a><span id="l95.11"> </span>
<a href="#l95.12"></a><span id="l95.12" class="difflineminus">-    check: function(aShouldBeCleared) { </span>
<a href="#l95.13"></a><span id="l95.13" class="difflineplus">+    check: function(aShouldBeCleared) {</span>
<a href="#l95.14"></a><span id="l95.14">       do_check_eq(this.forms.entryExists(&quot;Sanitizer&quot;, &quot;Foo&quot;), !aShouldBeCleared);</span>
<a href="#l95.15"></a><span id="l95.15">     }</span>
<a href="#l95.16"></a><span id="l95.16">   },</span>
<a href="#l95.17"></a><span id="l95.17"> </span>
<a href="#l95.18"></a><span id="l95.18">   downloads: {</span>
<a href="#l95.19"></a><span id="l95.19">     desc: &quot;Download&quot;,</span>
<a href="#l95.20"></a><span id="l95.20">     setup: function() {</span>
<a href="#l95.21"></a><span id="l95.21">       var ios = Components.classes[&quot;@mozilla.org/network/io-service;1&quot;]</span>
<a href="#l95.22"></a><span id="l95.22" class="difflineat">@@ -199,17 +199,17 @@ var sanTests = {</span>
<a href="#l95.23"></a><span id="l95.23">                                     &quot;Sanitizer!&quot;, null,</span>
<a href="#l95.24"></a><span id="l95.24">                                     Math.round(Date.now() * 1000), null,</span>
<a href="#l95.25"></a><span id="l95.25">                                     persist, false);</span>
<a href="#l95.26"></a><span id="l95.26"> </span>
<a href="#l95.27"></a><span id="l95.27">       // Stupid DM...</span>
<a href="#l95.28"></a><span id="l95.28">       this.dm.cancelDownload(this.dl.id);</span>
<a href="#l95.29"></a><span id="l95.29">     },</span>
<a href="#l95.30"></a><span id="l95.30"> </span>
<a href="#l95.31"></a><span id="l95.31" class="difflineminus">-    check: function(aShouldBeCleared) { </span>
<a href="#l95.32"></a><span id="l95.32" class="difflineplus">+    check: function(aShouldBeCleared) {</span>
<a href="#l95.33"></a><span id="l95.33">       var dl = null;</span>
<a href="#l95.34"></a><span id="l95.34">       try {</span>
<a href="#l95.35"></a><span id="l95.35">         dl = this.dm.getDownload(this.dl.id);</span>
<a href="#l95.36"></a><span id="l95.36">       } catch(ex) {}</span>
<a href="#l95.37"></a><span id="l95.37"> </span>
<a href="#l95.38"></a><span id="l95.38">       if (aShouldBeCleared)</span>
<a href="#l95.39"></a><span id="l95.39">         do_check_eq(!dl, aShouldBeCleared)</span>
<a href="#l95.40"></a><span id="l95.40">       else</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l96.1"></a><span id="l96.1" class="difflineminus">--- a/suite/profile/migration.js</span>
<a href="#l96.2"></a><span id="l96.2" class="difflineplus">+++ b/suite/profile/migration.js</span>
<a href="#l96.3"></a><span id="l96.3" class="difflineat">@@ -258,17 +258,17 @@ var MigrationWizard = {</span>
<a href="#l96.4"></a><span id="l96.4">     document.getElementById(&quot;homePageImportDesc&quot;)</span>
<a href="#l96.5"></a><span id="l96.5">             .setAttribute(&quot;value&quot;, pageDesc);</span>
<a href="#l96.6"></a><span id="l96.6"> </span>
<a href="#l96.7"></a><span id="l96.7">     this._wiz._adjustWizardHeader();</span>
<a href="#l96.8"></a><span id="l96.8"> </span>
<a href="#l96.9"></a><span id="l96.9">     var homePageStart = document.getElementById(&quot;homePageStart&quot;);</span>
<a href="#l96.10"></a><span id="l96.10"> </span>
<a href="#l96.11"></a><span id="l96.11">     // Find out if the target profile already has a homepage or not</span>
<a href="#l96.12"></a><span id="l96.12" class="difflineminus">-    var mainStr = this.targetHasHomePageURL() ? </span>
<a href="#l96.13"></a><span id="l96.13" class="difflineplus">+    var mainStr = this.targetHasHomePageURL() ?</span>
<a href="#l96.14"></a><span id="l96.14">                   bundle.getString(&quot;homePageStartCurrent&quot;) :</span>
<a href="#l96.15"></a><span id="l96.15">                   bundle.getString(&quot;homePageStartDefault&quot;);</span>
<a href="#l96.16"></a><span id="l96.16"> </span>
<a href="#l96.17"></a><span id="l96.17">     homePageStart.setAttribute(&quot;label&quot;, mainStr);</span>
<a href="#l96.18"></a><span id="l96.18"> </span>
<a href="#l96.19"></a><span id="l96.19">     var source = null;</span>
<a href="#l96.20"></a><span id="l96.20">     if (this._source != &quot;&quot;) {</span>
<a href="#l96.21"></a><span id="l96.21">       source = &quot;sourceName&quot; + this._source;</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l97.1"></a><span id="l97.1" class="difflineminus">--- a/suite/profile/migration/src/SuiteProfileMigrator.js</span>
<a href="#l97.2"></a><span id="l97.2" class="difflineplus">+++ b/suite/profile/migration/src/SuiteProfileMigrator.js</span>
<a href="#l97.3"></a><span id="l97.3" class="difflineat">@@ -1,135 +1,135 @@</span>
<a href="#l97.4"></a><span id="l97.4" class="difflineminus">-/* This Source Code Form is subject to the terms of the Mozilla Public</span>
<a href="#l97.5"></a><span id="l97.5" class="difflineminus">- * License, v. 2.0. If a copy of the MPL was not distributed with this file,</span>
<a href="#l97.6"></a><span id="l97.6" class="difflineminus">- * You can obtain one at http://mozilla.org/MPL/2.0/. */</span>
<a href="#l97.7"></a><span id="l97.7" class="difflineminus">-</span>
<a href="#l97.8"></a><span id="l97.8" class="difflineminus">-&quot;use strict&quot;;</span>
<a href="#l97.9"></a><span id="l97.9" class="difflineminus">-</span>
<a href="#l97.10"></a><span id="l97.10" class="difflineminus">-Components.utils.import(&quot;resource://gre/modules/XPCOMUtils.jsm&quot;);</span>
<a href="#l97.11"></a><span id="l97.11" class="difflineminus">-Components.utils.import(&quot;resource://gre/modules/Services.jsm&quot;);</span>
<a href="#l97.12"></a><span id="l97.12" class="difflineminus">-Components.utils.import(&quot;resource://gre/modules/FileUtils.jsm&quot;);</span>
<a href="#l97.13"></a><span id="l97.13" class="difflineminus">-</span>
<a href="#l97.14"></a><span id="l97.14" class="difflineminus">-function ProfileMigrator() {</span>
<a href="#l97.15"></a><span id="l97.15" class="difflineminus">-}</span>
<a href="#l97.16"></a><span id="l97.16" class="difflineminus">-</span>
<a href="#l97.17"></a><span id="l97.17" class="difflineminus">-ProfileMigrator.prototype = {</span>
<a href="#l97.18"></a><span id="l97.18" class="difflineminus">-  migrate: function PM_migrate(aStartup) {</span>
<a href="#l97.19"></a><span id="l97.19" class="difflineminus">-    // By opening the wizard with a supplied migrator, it will automatically</span>
<a href="#l97.20"></a><span id="l97.20" class="difflineminus">-    // migrate from it.</span>
<a href="#l97.21"></a><span id="l97.21" class="difflineminus">-    let [key, migrator] = this._getDefaultMigrator();</span>
<a href="#l97.22"></a><span id="l97.22" class="difflineminus">-    if (!key)</span>
<a href="#l97.23"></a><span id="l97.23" class="difflineminus">-        return;</span>
<a href="#l97.24"></a><span id="l97.24" class="difflineminus">-</span>
<a href="#l97.25"></a><span id="l97.25" class="difflineminus">-    let params = Components.classes[&quot;@mozilla.org/array;1&quot;]</span>
<a href="#l97.26"></a><span id="l97.26" class="difflineminus">-                           .createInstance(Components.interfaces.nsIMutableArray);</span>
<a href="#l97.27"></a><span id="l97.27" class="difflineminus">-    params.appendElement(this._toString(key), false);</span>
<a href="#l97.28"></a><span id="l97.28" class="difflineminus">-    params.appendElement(migrator, false);</span>
<a href="#l97.29"></a><span id="l97.29" class="difflineminus">-    params.appendElement(aStartup, false);</span>
<a href="#l97.30"></a><span id="l97.30" class="difflineminus">-</span>
<a href="#l97.31"></a><span id="l97.31" class="difflineminus">-    Services.ww.openWindow(null,</span>
<a href="#l97.32"></a><span id="l97.32" class="difflineminus">-                           &quot;chrome://communicator/content/migration/migration.xul&quot;,</span>
<a href="#l97.33"></a><span id="l97.33" class="difflineminus">-                           &quot;_blank&quot;,</span>
<a href="#l97.34"></a><span id="l97.34" class="difflineminus">-                           &quot;chrome,dialog,modal,centerscreen,titlebar&quot;,</span>
<a href="#l97.35"></a><span id="l97.35" class="difflineminus">-                           params);</span>
<a href="#l97.36"></a><span id="l97.36" class="difflineminus">-  },</span>
<a href="#l97.37"></a><span id="l97.37" class="difflineminus">-</span>
<a href="#l97.38"></a><span id="l97.38" class="difflineminus">-  _toString: function PM__toString(aStr) {</span>
<a href="#l97.39"></a><span id="l97.39" class="difflineminus">-    let str = Components.classes[&quot;@mozilla.org/supports-string;1&quot;]</span>
<a href="#l97.40"></a><span id="l97.40" class="difflineminus">-                         .createInstance(Components.interfaces.nsISupportsString);</span>
<a href="#l97.41"></a><span id="l97.41" class="difflineminus">-    str.data = aStr;</span>
<a href="#l97.42"></a><span id="l97.42" class="difflineminus">-    return str;</span>
<a href="#l97.43"></a><span id="l97.43" class="difflineminus">-  },</span>
<a href="#l97.44"></a><span id="l97.44" class="difflineminus">-</span>
<a href="#l97.45"></a><span id="l97.45" class="difflineminus">-  _getMigratorIfSourceExists: function PM__getMigratorIfSourceExists(aKey) {</span>
<a href="#l97.46"></a><span id="l97.46" class="difflineminus">-    let cid = &quot;@mozilla.org/profile/migrator;1?app=suite&amp;type=&quot; + aKey;</span>
<a href="#l97.47"></a><span id="l97.47" class="difflineminus">-    let migrator = Components.classes[cid]</span>
<a href="#l97.48"></a><span id="l97.48" class="difflineminus">-                             .createInstance(Components.interfaces</span>
<a href="#l97.49"></a><span id="l97.49" class="difflineminus">-                                                       .nsISuiteProfileMigrator);</span>
<a href="#l97.50"></a><span id="l97.50" class="difflineminus">-    if (migrator.sourceExists)</span>
<a href="#l97.51"></a><span id="l97.51" class="difflineminus">-      return migrator;</span>
<a href="#l97.52"></a><span id="l97.52" class="difflineminus">-    return null;</span>
<a href="#l97.53"></a><span id="l97.53" class="difflineminus">-  },</span>
<a href="#l97.54"></a><span id="l97.54" class="difflineminus">-</span>
<a href="#l97.55"></a><span id="l97.55" class="difflineminus">-  // We don't yet support checking for the default browser on all platforms,</span>
<a href="#l97.56"></a><span id="l97.56" class="difflineminus">-  // needless to say we don't have migrators for all browsers.  Thus, for each</span>
<a href="#l97.57"></a><span id="l97.57" class="difflineminus">-  // platform, there's a fallback list of migrators used in these cases.</span>
<a href="#l97.58"></a><span id="l97.58" class="difflineminus">-  _PLATFORM_FALLBACK_LIST:</span>
<a href="#l97.59"></a><span id="l97.59" class="difflineminus">-     [&quot;thunderbird&quot;],</span>
<a href="#l97.60"></a><span id="l97.60" class="difflineminus">-</span>
<a href="#l97.61"></a><span id="l97.61" class="difflineminus">-  _getDefaultMigrator: function PM__getDefaultMigrator() {</span>
<a href="#l97.62"></a><span id="l97.62" class="difflineminus">-    let migratorsOrdered = Array.slice(this._PLATFORM_FALLBACK_LIST);</span>
<a href="#l97.63"></a><span id="l97.63" class="difflineminus">-#if 0</span>
<a href="#l97.64"></a><span id="l97.64" class="difflineminus">-    let defaultBrowser = &quot;&quot;;</span>
<a href="#l97.65"></a><span id="l97.65" class="difflineminus">-#ifdef XP_WIN</span>
<a href="#l97.66"></a><span id="l97.66" class="difflineminus">-    try {</span>
<a href="#l97.67"></a><span id="l97.67" class="difflineminus">-      const REG_KEY = &quot;SOFTWARE\\Classes\\HTTP\\shell\\open\\command&quot;;</span>
<a href="#l97.68"></a><span id="l97.68" class="difflineminus">-      let regKey = Components.classes[&quot;@mozilla.org/windows-registry-key;1&quot;]</span>
<a href="#l97.69"></a><span id="l97.69" class="difflineminus">-                             .createInstance(Components.interfaces.nsIWindowsRegKey);</span>
<a href="#l97.70"></a><span id="l97.70" class="difflineminus">-      regKey.open(regKey.ROOT_KEY_LOCAL_MACHINE, REG_KEY,</span>
<a href="#l97.71"></a><span id="l97.71" class="difflineminus">-                  regKey.ACCESS_READ);</span>
<a href="#l97.72"></a><span id="l97.72" class="difflineminus">-      let value = regKey.readStringValue(&quot;&quot;).toLowerCase();      </span>
<a href="#l97.73"></a><span id="l97.73" class="difflineminus">-      let pathMatches = value.match(/^&quot;?(.+?\.exe)&quot;?/);</span>
<a href="#l97.74"></a><span id="l97.74" class="difflineminus">-      if (!pathMatches) {</span>
<a href="#l97.75"></a><span id="l97.75" class="difflineminus">-        throw new Error(&quot;Could not extract path from &quot; +</span>
<a href="#l97.76"></a><span id="l97.76" class="difflineminus">-                        REG_KEY + &quot;(&quot; + value + &quot;)&quot;);</span>
<a href="#l97.77"></a><span id="l97.77" class="difflineminus">-      }</span>
<a href="#l97.78"></a><span id="l97.78" class="difflineminus">- </span>
<a href="#l97.79"></a><span id="l97.79" class="difflineminus">-      // We want to find out what the default browser is but the path in and of</span>
<a href="#l97.80"></a><span id="l97.80" class="difflineminus">-      // itself isn't enough.  Why? Because sometimes on Windows paths get</span>
<a href="#l97.81"></a><span id="l97.81" class="difflineminus">-      // truncated like so: C:\PROGRA~1\MOZILL~2\MOZILL~1.EXE.  How do we know</span>
<a href="#l97.82"></a><span id="l97.82" class="difflineminus">-      // what product that is? Mozilla's file objects do nothing to 'normalize'</span>
<a href="#l97.83"></a><span id="l97.83" class="difflineminus">-      // the path so we need to attain an actual product descriptor from the</span>
<a href="#l97.84"></a><span id="l97.84" class="difflineminus">-      // file somehow, and in this case it means getting the &quot;InternalName&quot;</span>
<a href="#l97.85"></a><span id="l97.85" class="difflineminus">-      // field of the file's VERSIONINFO resource. </span>
<a href="#l97.86"></a><span id="l97.86" class="difflineminus">-      //</span>
<a href="#l97.87"></a><span id="l97.87" class="difflineminus">-      // In the file's resource segment there is a VERSIONINFO section that is</span>
<a href="#l97.88"></a><span id="l97.88" class="difflineminus">-      // laid out like this:</span>
<a href="#l97.89"></a><span id="l97.89" class="difflineminus">-      //</span>
<a href="#l97.90"></a><span id="l97.90" class="difflineminus">-      // VERSIONINFO</span>
<a href="#l97.91"></a><span id="l97.91" class="difflineminus">-      //   StringFileInfo</span>
<a href="#l97.92"></a><span id="l97.92" class="difflineminus">-      //     &lt;TranslationID&gt;</span>
<a href="#l97.93"></a><span id="l97.93" class="difflineminus">-      //       InternalName           &quot;iexplore&quot;</span>
<a href="#l97.94"></a><span id="l97.94" class="difflineminus">-      //   VarFileInfo</span>
<a href="#l97.95"></a><span id="l97.95" class="difflineminus">-      //     Translation              &lt;TranslationID&gt;</span>
<a href="#l97.96"></a><span id="l97.96" class="difflineminus">-      //</span>
<a href="#l97.97"></a><span id="l97.97" class="difflineminus">-      // By Querying the VERSIONINFO section for its Tranlations, we can find</span>
<a href="#l97.98"></a><span id="l97.98" class="difflineminus">-      // out where the InternalName lives (A file can have more than one</span>
<a href="#l97.99"></a><span id="l97.99" class="difflineminus">-      // translation of its VERSIONINFO segment, but we just assume the first</span>
<a href="#l97.100"></a><span id="l97.100" class="difflineminus">-      // one).</span>
<a href="#l97.101"></a><span id="l97.101" class="difflineminus">-      let file = FileUtils.File(pathMatches[1])</span>
<a href="#l97.102"></a><span id="l97.102" class="difflineminus">-                          .QueryInterface(Components.interfaces.nsILocalFileWin);</span>
<a href="#l97.103"></a><span id="l97.103" class="difflineminus">-      switch (file.getVersionInfoField(&quot;InternalName&quot;).toLowerCase()) {</span>
<a href="#l97.104"></a><span id="l97.104" class="difflineminus">-        case &quot;iexplore&quot;:</span>
<a href="#l97.105"></a><span id="l97.105" class="difflineminus">-          defaultBrowser = &quot;ie&quot;;</span>
<a href="#l97.106"></a><span id="l97.106" class="difflineminus">-          break;</span>
<a href="#l97.107"></a><span id="l97.107" class="difflineminus">-        case &quot;chrome&quot;:</span>
<a href="#l97.108"></a><span id="l97.108" class="difflineminus">-          defaultBrowser = &quot;chrome&quot;;</span>
<a href="#l97.109"></a><span id="l97.109" class="difflineminus">-          break;</span>
<a href="#l97.110"></a><span id="l97.110" class="difflineminus">-      }</span>
<a href="#l97.111"></a><span id="l97.111" class="difflineminus">-    }</span>
<a href="#l97.112"></a><span id="l97.112" class="difflineminus">-    catch (ex) {</span>
<a href="#l97.113"></a><span id="l97.113" class="difflineminus">-      Components.utils.reportError(&quot;Could not retrieve default browser: &quot; + ex);</span>
<a href="#l97.114"></a><span id="l97.114" class="difflineminus">-    }</span>
<a href="#l97.115"></a><span id="l97.115" class="difflineminus">-#endif</span>
<a href="#l97.116"></a><span id="l97.116" class="difflineminus">-</span>
<a href="#l97.117"></a><span id="l97.117" class="difflineminus">-    // If we found the default browser and we have support for that browser,</span>
<a href="#l97.118"></a><span id="l97.118" class="difflineminus">-    // make sure to check it before any other browser, by moving it to the head</span>
<a href="#l97.119"></a><span id="l97.119" class="difflineminus">-    // of the array.</span>
<a href="#l97.120"></a><span id="l97.120" class="difflineminus">-    if (defaultBrowser)</span>
<a href="#l97.121"></a><span id="l97.121" class="difflineminus">-      migratorsOrdered.sort((a, b) =&gt; b == defaultBrowser ? 1 : 0);</span>
<a href="#l97.122"></a><span id="l97.122" class="difflineminus">-#endif</span>
<a href="#l97.123"></a><span id="l97.123" class="difflineminus">-    for (let key of migratorsOrdered) {</span>
<a href="#l97.124"></a><span id="l97.124" class="difflineminus">-      let migrator = this._getMigratorIfSourceExists(key);</span>
<a href="#l97.125"></a><span id="l97.125" class="difflineminus">-      if (migrator)</span>
<a href="#l97.126"></a><span id="l97.126" class="difflineminus">-        return [key, migrator];</span>
<a href="#l97.127"></a><span id="l97.127" class="difflineminus">-    }</span>
<a href="#l97.128"></a><span id="l97.128" class="difflineminus">-</span>
<a href="#l97.129"></a><span id="l97.129" class="difflineminus">-    return [&quot;&quot;, null];</span>
<a href="#l97.130"></a><span id="l97.130" class="difflineminus">-  },</span>
<a href="#l97.131"></a><span id="l97.131" class="difflineminus">-</span>
<a href="#l97.132"></a><span id="l97.132" class="difflineminus">-  QueryInterface: XPCOMUtils.generateQI([Components.interfaces.nsIProfileMigrator]),</span>
<a href="#l97.133"></a><span id="l97.133" class="difflineminus">-  classDescription: &quot;Profile Migrator&quot;,</span>
<a href="#l97.134"></a><span id="l97.134" class="difflineminus">-  contractID: &quot;@mozilla.org/toolkit/profile-migrator;1&quot;,</span>
<a href="#l97.135"></a><span id="l97.135" class="difflineminus">-  classID: Components.ID(&quot;{d5148b7c-ba4e-4f7a-a80b-1ae48b90b910}&quot;),</span>
<a href="#l97.136"></a><span id="l97.136" class="difflineminus">-};</span>
<a href="#l97.137"></a><span id="l97.137" class="difflineminus">-</span>
<a href="#l97.138"></a><span id="l97.138" class="difflineminus">-var NSGetFactory = XPCOMUtils.generateNSGetFactory([ProfileMigrator]);</span>
<a href="#l97.139"></a><span id="l97.139" class="difflineplus">+/* This Source Code Form is subject to the terms of the Mozilla Public</span>
<a href="#l97.140"></a><span id="l97.140" class="difflineplus">+ * License, v. 2.0. If a copy of the MPL was not distributed with this file,</span>
<a href="#l97.141"></a><span id="l97.141" class="difflineplus">+ * You can obtain one at http://mozilla.org/MPL/2.0/. */</span>
<a href="#l97.142"></a><span id="l97.142" class="difflineplus">+</span>
<a href="#l97.143"></a><span id="l97.143" class="difflineplus">+&quot;use strict&quot;;</span>
<a href="#l97.144"></a><span id="l97.144" class="difflineplus">+</span>
<a href="#l97.145"></a><span id="l97.145" class="difflineplus">+Components.utils.import(&quot;resource://gre/modules/XPCOMUtils.jsm&quot;);</span>
<a href="#l97.146"></a><span id="l97.146" class="difflineplus">+Components.utils.import(&quot;resource://gre/modules/Services.jsm&quot;);</span>
<a href="#l97.147"></a><span id="l97.147" class="difflineplus">+Components.utils.import(&quot;resource://gre/modules/FileUtils.jsm&quot;);</span>
<a href="#l97.148"></a><span id="l97.148" class="difflineplus">+</span>
<a href="#l97.149"></a><span id="l97.149" class="difflineplus">+function ProfileMigrator() {</span>
<a href="#l97.150"></a><span id="l97.150" class="difflineplus">+}</span>
<a href="#l97.151"></a><span id="l97.151" class="difflineplus">+</span>
<a href="#l97.152"></a><span id="l97.152" class="difflineplus">+ProfileMigrator.prototype = {</span>
<a href="#l97.153"></a><span id="l97.153" class="difflineplus">+  migrate: function PM_migrate(aStartup) {</span>
<a href="#l97.154"></a><span id="l97.154" class="difflineplus">+    // By opening the wizard with a supplied migrator, it will automatically</span>
<a href="#l97.155"></a><span id="l97.155" class="difflineplus">+    // migrate from it.</span>
<a href="#l97.156"></a><span id="l97.156" class="difflineplus">+    let [key, migrator] = this._getDefaultMigrator();</span>
<a href="#l97.157"></a><span id="l97.157" class="difflineplus">+    if (!key)</span>
<a href="#l97.158"></a><span id="l97.158" class="difflineplus">+        return;</span>
<a href="#l97.159"></a><span id="l97.159" class="difflineplus">+</span>
<a href="#l97.160"></a><span id="l97.160" class="difflineplus">+    let params = Components.classes[&quot;@mozilla.org/array;1&quot;]</span>
<a href="#l97.161"></a><span id="l97.161" class="difflineplus">+                           .createInstance(Components.interfaces.nsIMutableArray);</span>
<a href="#l97.162"></a><span id="l97.162" class="difflineplus">+    params.appendElement(this._toString(key), false);</span>
<a href="#l97.163"></a><span id="l97.163" class="difflineplus">+    params.appendElement(migrator, false);</span>
<a href="#l97.164"></a><span id="l97.164" class="difflineplus">+    params.appendElement(aStartup, false);</span>
<a href="#l97.165"></a><span id="l97.165" class="difflineplus">+</span>
<a href="#l97.166"></a><span id="l97.166" class="difflineplus">+    Services.ww.openWindow(null,</span>
<a href="#l97.167"></a><span id="l97.167" class="difflineplus">+                           &quot;chrome://communicator/content/migration/migration.xul&quot;,</span>
<a href="#l97.168"></a><span id="l97.168" class="difflineplus">+                           &quot;_blank&quot;,</span>
<a href="#l97.169"></a><span id="l97.169" class="difflineplus">+                           &quot;chrome,dialog,modal,centerscreen,titlebar&quot;,</span>
<a href="#l97.170"></a><span id="l97.170" class="difflineplus">+                           params);</span>
<a href="#l97.171"></a><span id="l97.171" class="difflineplus">+  },</span>
<a href="#l97.172"></a><span id="l97.172" class="difflineplus">+</span>
<a href="#l97.173"></a><span id="l97.173" class="difflineplus">+  _toString: function PM__toString(aStr) {</span>
<a href="#l97.174"></a><span id="l97.174" class="difflineplus">+    let str = Components.classes[&quot;@mozilla.org/supports-string;1&quot;]</span>
<a href="#l97.175"></a><span id="l97.175" class="difflineplus">+                         .createInstance(Components.interfaces.nsISupportsString);</span>
<a href="#l97.176"></a><span id="l97.176" class="difflineplus">+    str.data = aStr;</span>
<a href="#l97.177"></a><span id="l97.177" class="difflineplus">+    return str;</span>
<a href="#l97.178"></a><span id="l97.178" class="difflineplus">+  },</span>
<a href="#l97.179"></a><span id="l97.179" class="difflineplus">+</span>
<a href="#l97.180"></a><span id="l97.180" class="difflineplus">+  _getMigratorIfSourceExists: function PM__getMigratorIfSourceExists(aKey) {</span>
<a href="#l97.181"></a><span id="l97.181" class="difflineplus">+    let cid = &quot;@mozilla.org/profile/migrator;1?app=suite&amp;type=&quot; + aKey;</span>
<a href="#l97.182"></a><span id="l97.182" class="difflineplus">+    let migrator = Components.classes[cid]</span>
<a href="#l97.183"></a><span id="l97.183" class="difflineplus">+                             .createInstance(Components.interfaces</span>
<a href="#l97.184"></a><span id="l97.184" class="difflineplus">+                                                       .nsISuiteProfileMigrator);</span>
<a href="#l97.185"></a><span id="l97.185" class="difflineplus">+    if (migrator.sourceExists)</span>
<a href="#l97.186"></a><span id="l97.186" class="difflineplus">+      return migrator;</span>
<a href="#l97.187"></a><span id="l97.187" class="difflineplus">+    return null;</span>
<a href="#l97.188"></a><span id="l97.188" class="difflineplus">+  },</span>
<a href="#l97.189"></a><span id="l97.189" class="difflineplus">+</span>
<a href="#l97.190"></a><span id="l97.190" class="difflineplus">+  // We don't yet support checking for the default browser on all platforms,</span>
<a href="#l97.191"></a><span id="l97.191" class="difflineplus">+  // needless to say we don't have migrators for all browsers.  Thus, for each</span>
<a href="#l97.192"></a><span id="l97.192" class="difflineplus">+  // platform, there's a fallback list of migrators used in these cases.</span>
<a href="#l97.193"></a><span id="l97.193" class="difflineplus">+  _PLATFORM_FALLBACK_LIST:</span>
<a href="#l97.194"></a><span id="l97.194" class="difflineplus">+     [&quot;thunderbird&quot;],</span>
<a href="#l97.195"></a><span id="l97.195" class="difflineplus">+</span>
<a href="#l97.196"></a><span id="l97.196" class="difflineplus">+  _getDefaultMigrator: function PM__getDefaultMigrator() {</span>
<a href="#l97.197"></a><span id="l97.197" class="difflineplus">+    let migratorsOrdered = Array.slice(this._PLATFORM_FALLBACK_LIST);</span>
<a href="#l97.198"></a><span id="l97.198" class="difflineplus">+#if 0</span>
<a href="#l97.199"></a><span id="l97.199" class="difflineplus">+    let defaultBrowser = &quot;&quot;;</span>
<a href="#l97.200"></a><span id="l97.200" class="difflineplus">+#ifdef XP_WIN</span>
<a href="#l97.201"></a><span id="l97.201" class="difflineplus">+    try {</span>
<a href="#l97.202"></a><span id="l97.202" class="difflineplus">+      const REG_KEY = &quot;SOFTWARE\\Classes\\HTTP\\shell\\open\\command&quot;;</span>
<a href="#l97.203"></a><span id="l97.203" class="difflineplus">+      let regKey = Components.classes[&quot;@mozilla.org/windows-registry-key;1&quot;]</span>
<a href="#l97.204"></a><span id="l97.204" class="difflineplus">+                             .createInstance(Components.interfaces.nsIWindowsRegKey);</span>
<a href="#l97.205"></a><span id="l97.205" class="difflineplus">+      regKey.open(regKey.ROOT_KEY_LOCAL_MACHINE, REG_KEY,</span>
<a href="#l97.206"></a><span id="l97.206" class="difflineplus">+                  regKey.ACCESS_READ);</span>
<a href="#l97.207"></a><span id="l97.207" class="difflineplus">+      let value = regKey.readStringValue(&quot;&quot;).toLowerCase();</span>
<a href="#l97.208"></a><span id="l97.208" class="difflineplus">+      let pathMatches = value.match(/^&quot;?(.+?\.exe)&quot;?/);</span>
<a href="#l97.209"></a><span id="l97.209" class="difflineplus">+      if (!pathMatches) {</span>
<a href="#l97.210"></a><span id="l97.210" class="difflineplus">+        throw new Error(&quot;Could not extract path from &quot; +</span>
<a href="#l97.211"></a><span id="l97.211" class="difflineplus">+                        REG_KEY + &quot;(&quot; + value + &quot;)&quot;);</span>
<a href="#l97.212"></a><span id="l97.212" class="difflineplus">+      }</span>
<a href="#l97.213"></a><span id="l97.213" class="difflineplus">+</span>
<a href="#l97.214"></a><span id="l97.214" class="difflineplus">+      // We want to find out what the default browser is but the path in and of</span>
<a href="#l97.215"></a><span id="l97.215" class="difflineplus">+      // itself isn't enough.  Why? Because sometimes on Windows paths get</span>
<a href="#l97.216"></a><span id="l97.216" class="difflineplus">+      // truncated like so: C:\PROGRA~1\MOZILL~2\MOZILL~1.EXE.  How do we know</span>
<a href="#l97.217"></a><span id="l97.217" class="difflineplus">+      // what product that is? Mozilla's file objects do nothing to 'normalize'</span>
<a href="#l97.218"></a><span id="l97.218" class="difflineplus">+      // the path so we need to attain an actual product descriptor from the</span>
<a href="#l97.219"></a><span id="l97.219" class="difflineplus">+      // file somehow, and in this case it means getting the &quot;InternalName&quot;</span>
<a href="#l97.220"></a><span id="l97.220" class="difflineplus">+      // field of the file's VERSIONINFO resource.</span>
<a href="#l97.221"></a><span id="l97.221" class="difflineplus">+      //</span>
<a href="#l97.222"></a><span id="l97.222" class="difflineplus">+      // In the file's resource segment there is a VERSIONINFO section that is</span>
<a href="#l97.223"></a><span id="l97.223" class="difflineplus">+      // laid out like this:</span>
<a href="#l97.224"></a><span id="l97.224" class="difflineplus">+      //</span>
<a href="#l97.225"></a><span id="l97.225" class="difflineplus">+      // VERSIONINFO</span>
<a href="#l97.226"></a><span id="l97.226" class="difflineplus">+      //   StringFileInfo</span>
<a href="#l97.227"></a><span id="l97.227" class="difflineplus">+      //     &lt;TranslationID&gt;</span>
<a href="#l97.228"></a><span id="l97.228" class="difflineplus">+      //       InternalName           &quot;iexplore&quot;</span>
<a href="#l97.229"></a><span id="l97.229" class="difflineplus">+      //   VarFileInfo</span>
<a href="#l97.230"></a><span id="l97.230" class="difflineplus">+      //     Translation              &lt;TranslationID&gt;</span>
<a href="#l97.231"></a><span id="l97.231" class="difflineplus">+      //</span>
<a href="#l97.232"></a><span id="l97.232" class="difflineplus">+      // By Querying the VERSIONINFO section for its Tranlations, we can find</span>
<a href="#l97.233"></a><span id="l97.233" class="difflineplus">+      // out where the InternalName lives (A file can have more than one</span>
<a href="#l97.234"></a><span id="l97.234" class="difflineplus">+      // translation of its VERSIONINFO segment, but we just assume the first</span>
<a href="#l97.235"></a><span id="l97.235" class="difflineplus">+      // one).</span>
<a href="#l97.236"></a><span id="l97.236" class="difflineplus">+      let file = FileUtils.File(pathMatches[1])</span>
<a href="#l97.237"></a><span id="l97.237" class="difflineplus">+                          .QueryInterface(Components.interfaces.nsILocalFileWin);</span>
<a href="#l97.238"></a><span id="l97.238" class="difflineplus">+      switch (file.getVersionInfoField(&quot;InternalName&quot;).toLowerCase()) {</span>
<a href="#l97.239"></a><span id="l97.239" class="difflineplus">+        case &quot;iexplore&quot;:</span>
<a href="#l97.240"></a><span id="l97.240" class="difflineplus">+          defaultBrowser = &quot;ie&quot;;</span>
<a href="#l97.241"></a><span id="l97.241" class="difflineplus">+          break;</span>
<a href="#l97.242"></a><span id="l97.242" class="difflineplus">+        case &quot;chrome&quot;:</span>
<a href="#l97.243"></a><span id="l97.243" class="difflineplus">+          defaultBrowser = &quot;chrome&quot;;</span>
<a href="#l97.244"></a><span id="l97.244" class="difflineplus">+          break;</span>
<a href="#l97.245"></a><span id="l97.245" class="difflineplus">+      }</span>
<a href="#l97.246"></a><span id="l97.246" class="difflineplus">+    }</span>
<a href="#l97.247"></a><span id="l97.247" class="difflineplus">+    catch (ex) {</span>
<a href="#l97.248"></a><span id="l97.248" class="difflineplus">+      Components.utils.reportError(&quot;Could not retrieve default browser: &quot; + ex);</span>
<a href="#l97.249"></a><span id="l97.249" class="difflineplus">+    }</span>
<a href="#l97.250"></a><span id="l97.250" class="difflineplus">+#endif</span>
<a href="#l97.251"></a><span id="l97.251" class="difflineplus">+</span>
<a href="#l97.252"></a><span id="l97.252" class="difflineplus">+    // If we found the default browser and we have support for that browser,</span>
<a href="#l97.253"></a><span id="l97.253" class="difflineplus">+    // make sure to check it before any other browser, by moving it to the head</span>
<a href="#l97.254"></a><span id="l97.254" class="difflineplus">+    // of the array.</span>
<a href="#l97.255"></a><span id="l97.255" class="difflineplus">+    if (defaultBrowser)</span>
<a href="#l97.256"></a><span id="l97.256" class="difflineplus">+      migratorsOrdered.sort((a, b) =&gt; b == defaultBrowser ? 1 : 0);</span>
<a href="#l97.257"></a><span id="l97.257" class="difflineplus">+#endif</span>
<a href="#l97.258"></a><span id="l97.258" class="difflineplus">+    for (let key of migratorsOrdered) {</span>
<a href="#l97.259"></a><span id="l97.259" class="difflineplus">+      let migrator = this._getMigratorIfSourceExists(key);</span>
<a href="#l97.260"></a><span id="l97.260" class="difflineplus">+      if (migrator)</span>
<a href="#l97.261"></a><span id="l97.261" class="difflineplus">+        return [key, migrator];</span>
<a href="#l97.262"></a><span id="l97.262" class="difflineplus">+    }</span>
<a href="#l97.263"></a><span id="l97.263" class="difflineplus">+</span>
<a href="#l97.264"></a><span id="l97.264" class="difflineplus">+    return [&quot;&quot;, null];</span>
<a href="#l97.265"></a><span id="l97.265" class="difflineplus">+  },</span>
<a href="#l97.266"></a><span id="l97.266" class="difflineplus">+</span>
<a href="#l97.267"></a><span id="l97.267" class="difflineplus">+  QueryInterface: XPCOMUtils.generateQI([Components.interfaces.nsIProfileMigrator]),</span>
<a href="#l97.268"></a><span id="l97.268" class="difflineplus">+  classDescription: &quot;Profile Migrator&quot;,</span>
<a href="#l97.269"></a><span id="l97.269" class="difflineplus">+  contractID: &quot;@mozilla.org/toolkit/profile-migrator;1&quot;,</span>
<a href="#l97.270"></a><span id="l97.270" class="difflineplus">+  classID: Components.ID(&quot;{d5148b7c-ba4e-4f7a-a80b-1ae48b90b910}&quot;),</span>
<a href="#l97.271"></a><span id="l97.271" class="difflineplus">+};</span>
<a href="#l97.272"></a><span id="l97.272" class="difflineplus">+</span>
<a href="#l97.273"></a><span id="l97.273" class="difflineplus">+var NSGetFactory = XPCOMUtils.generateNSGetFactory([ProfileMigrator]);</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l98.1"></a><span id="l98.1" class="difflineminus">--- a/suite/security/prefs/pref-certs.js</span>
<a href="#l98.2"></a><span id="l98.2" class="difflineplus">+++ b/suite/security/prefs/pref-certs.js</span>
<a href="#l98.3"></a><span id="l98.3" class="difflineat">@@ -13,20 +13,20 @@ function Startup()</span>
<a href="#l98.4"></a><span id="l98.4"> function DoEnabling(aOCSPPrefValue)</span>
<a href="#l98.5"></a><span id="l98.5"> {</span>
<a href="#l98.6"></a><span id="l98.6">   EnableElementById(&quot;requireWorkingOCSP&quot;, aOCSPPrefValue != 0, false);</span>
<a href="#l98.7"></a><span id="l98.7"> }</span>
<a href="#l98.8"></a><span id="l98.8"> </span>
<a href="#l98.9"></a><span id="l98.9"> function OpenCertManager()</span>
<a href="#l98.10"></a><span id="l98.10"> {</span>
<a href="#l98.11"></a><span id="l98.11">     document.documentElement</span>
<a href="#l98.12"></a><span id="l98.12" class="difflineminus">-            .openWindow(&quot;mozilla:certmanager&quot;, </span>
<a href="#l98.13"></a><span id="l98.13" class="difflineplus">+            .openWindow(&quot;mozilla:certmanager&quot;,</span>
<a href="#l98.14"></a><span id="l98.14">                         &quot;chrome://pippki/content/certManager.xul&quot;,</span>
<a href="#l98.15"></a><span id="l98.15">                         &quot;&quot;, null);</span>
<a href="#l98.16"></a><span id="l98.16"> }</span>
<a href="#l98.17"></a><span id="l98.17"> </span>
<a href="#l98.18"></a><span id="l98.18"> function OpenDeviceManager()</span>
<a href="#l98.19"></a><span id="l98.19"> {</span>
<a href="#l98.20"></a><span id="l98.20">     document.documentElement</span>
<a href="#l98.21"></a><span id="l98.21" class="difflineminus">-            .openWindow(&quot;mozilla:devicemanager&quot;, </span>
<a href="#l98.22"></a><span id="l98.22" class="difflineplus">+            .openWindow(&quot;mozilla:devicemanager&quot;,</span>
<a href="#l98.23"></a><span id="l98.23">                         &quot;chrome://pippki/content/device_manager.xul&quot;,</span>
<a href="#l98.24"></a><span id="l98.24">                         &quot;&quot;, null);</span>
<a href="#l98.25"></a><span id="l98.25"> }</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l99.1"></a><span id="l99.1" class="difflineminus">--- a/suite/smile/test/browser_Application.js</span>
<a href="#l99.2"></a><span id="l99.2" class="difflineplus">+++ b/suite/smile/test/browser_Application.js</span>
<a href="#l99.3"></a><span id="l99.3" class="difflineat">@@ -53,22 +53,22 @@ WindowOpenListener.prototype = {</span>
<a href="#l99.4"></a><span id="l99.4">     // Let the window close complete</span>
<a href="#l99.5"></a><span id="l99.5">     executeSoon(this.closecallback);</span>
<a href="#l99.6"></a><span id="l99.6">     this.closecallback = null;</span>
<a href="#l99.7"></a><span id="l99.7">   }</span>
<a href="#l99.8"></a><span id="l99.8"> };</span>
<a href="#l99.9"></a><span id="l99.9"> </span>
<a href="#l99.10"></a><span id="l99.10"> function test() {</span>
<a href="#l99.11"></a><span id="l99.11">   ok(Application, &quot;Check global access to Application&quot;);</span>
<a href="#l99.12"></a><span id="l99.12" class="difflineminus">-  </span>
<a href="#l99.13"></a><span id="l99.13" class="difflineplus">+</span>
<a href="#l99.14"></a><span id="l99.14">   // I'd test these against a specific value, but that is bound to flucuate</span>
<a href="#l99.15"></a><span id="l99.15">   ok(Application.id, &quot;Check to see if an ID exists for the Application&quot;);</span>
<a href="#l99.16"></a><span id="l99.16">   ok(Application.name, &quot;Check to see if a name exists for the Application&quot;);</span>
<a href="#l99.17"></a><span id="l99.17">   ok(Application.version, &quot;Check to see if a version exists for the Application&quot;);</span>
<a href="#l99.18"></a><span id="l99.18" class="difflineminus">-  </span>
<a href="#l99.19"></a><span id="l99.19" class="difflineplus">+</span>
<a href="#l99.20"></a><span id="l99.20">   var wMediator = Cc[&quot;@mozilla.org/appshell/window-mediator;1&quot;].getService(Ci.nsIWindowMediator);</span>
<a href="#l99.21"></a><span id="l99.21">   var console = wMediator.getMostRecentWindow(&quot;global:console&quot;);</span>
<a href="#l99.22"></a><span id="l99.22">   waitForExplicitFinish();</span>
<a href="#l99.23"></a><span id="l99.23">   ok(!console, &quot;Console should not already be open&quot;);</span>
<a href="#l99.24"></a><span id="l99.24"> </span>
<a href="#l99.25"></a><span id="l99.25">   new WindowOpenListener(&quot;chrome://global/content/console.xul&quot;, consoleOpened, consoleClosed);</span>
<a href="#l99.26"></a><span id="l99.26">   Application.console.open();</span>
<a href="#l99.27"></a><span id="l99.27"> }</span></pre></div></div>

<div class="page_footer">
<div class="page_footer_text">comm-central</div>
<div class="page_footer_text" style="padding-left: 10px">Deployed from <a href="https://hg.mozilla.org/hgcustom/version-control-tools/rev/35f393d6769a">35f393d6769a</a> at 2020-07-16T17:23:43Z.</div>
<div class="rss_logo">
<a href="/comm-central/rss-log">RSS</a>
<a href="/comm-central/atom-log">Atom</a>
</div>
<br />

</div>
</body>
</html>

