<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en-US" lang="en-US">
<head>
<link rel="icon" href="/static/4b0de666d1a4/hgicon.png" type="image/png" />
<meta name="robots" content="index, nofollow"/>
<link rel="stylesheet" href="/static/4b0de666d1a4/style-gitweb.css" type="text/css" />

<style type="text/css">
div.feed {
  float: right;
}
a img {
  border-width: 0px;
}
div.log_link {
  width: 80px;
  background-color: white;
}

div.log_body {
  padding-left: 96px;
}
</style>
<script type="text/javascript" src="/static/4b0de666d1a4/mercurial.js"></script>

<meta property="og:image" content="/static/4b0de666d1a4/moz-logo-bw-rgb.svg"/>
<meta property="og:type" content="website"/>

<title>comm-central: changeset 25920:810588b5151e823ec39fa18ca12a834b7469926b</title>
<link rel="alternate" type="application/atom+xml"
   href="/comm-central/atom-log" title="Atom feed for comm-central"/>
<link rel="alternate" type="application/rss+xml"
   href="/comm-central/rss-log" title="RSS feed for comm-central"/>

<meta property="og:title" content="comm-central @ 810588b5151e823ec39fa18ca12a834b7469926b" />
<meta property="og:url" content="/comm-central/rev/810588b5151e823ec39fa18ca12a834b7469926b" />
<meta property="og:description" content="Bug 1529763 - Port bug 1529252: s/NewChannelFromURI2/NewChannelFromURI/. rs=bustage-fix" />

</head>
<body>

<div class="page_header">
<div class="logo">
    <a href="https://developer.mozilla.org/en/docs/Mercurial">
        <img src="/static/4b0de666d1a4/moz-logo-bw-rgb.svg" alt="mercurial" />
    </a>
</div>
<a href="/">Mercurial</a> &gt; <a href="/comm-central">comm-central</a>  / changeset / 810588b5151e823ec39fa18ca12a834b7469926b 
</div>

<div class="page_nav">
<div>
<a href="/comm-central/summary">summary</a> |
<a href="/comm-central/shortlog/810588b5151e823ec39fa18ca12a834b7469926b">shortlog</a> |
<a href="/comm-central/log/810588b5151e823ec39fa18ca12a834b7469926b">changelog</a> |
<a href="/comm-central/pushloghtml">pushlog</a> |
<a href="/comm-central/graph/810588b5151e823ec39fa18ca12a834b7469926b">graph</a> |
<a href="/comm-central/tags">tags</a> |
<a href="/comm-central/bookmarks">bookmarks</a> |
<a href="/comm-central/branches">branches</a> |
<a href="/comm-central/file/810588b5151e823ec39fa18ca12a834b7469926b">files</a> |
changeset |
<a href="/comm-central/raw-rev/810588b5151e823ec39fa18ca12a834b7469926b">raw</a>  | <a href="/comm-central/archive/810588b5151e823ec39fa18ca12a834b7469926b.zip">zip</a>  |
<a href="/comm-central/help">help</a>
</div>

<div class="search">
<form id="searchform" action="/comm-central/log">

<input name="rev" type="text" value="" size="40" />
<div id="hint">Find changesets by keywords (author, files, the commit message), revision
number or hash, or <a href="/comm-central/help/revsets">revset expression</a>.</div>
</form>
</div>
</div>

<div class="title">
<a href="https://bugzilla.mozilla.org/show_bug.cgi?id=1529763">Bug 1529763</a> - Port <a href="https://bugzilla.mozilla.org/show_bug.cgi?id=1529252">bug 1529252</a>: s/NewChannelFromURI2/NewChannelFromURI/. rs=bustage-fix
<span class="logtags"></span>
</div>
<div class="title_text">
<table cellspacing="0">

<tr><td>author</td><td>&#74;&#111;&#114;&#103;&#32;&#75;&#32;&#60;&#106;&#111;&#114;&#103;&#107;&#64;&#106;&#111;&#114;&#103;&#107;&#46;&#99;&#111;&#109;&#62;</td></tr>
<tr><td></td><td class="date age">Fri, 22 Feb 2019 00:06:55 +0100</td></tr>

<tr>
 <td>changeset 25920</td>
 <td style="font-family:monospace"><a class="list" href="/comm-central/rev/810588b5151e823ec39fa18ca12a834b7469926b">810588b5151e823ec39fa18ca12a834b7469926b</a></td>
</tr>



<tr>
<td>parent 25919</td>
<td style="font-family:monospace">
<a class="list" href="/comm-central/rev/be064625490388514884aa097ec7e780518a632f">be064625490388514884aa097ec7e780518a632f</a>
</td>
</tr>

<tr>
<td>child 25921</td>
<td style="font-family:monospace">
<a class="list" href="/comm-central/rev/99ea0ca93b9be29cc4d4b7ac61197c6e64e2dccd">99ea0ca93b9be29cc4d4b7ac61197c6e64e2dccd</a>
</td>
</tr>
<tr><td>push id</td><td><a href="/comm-central/pushloghtml?changeset=810588b5151e823ec39fa18ca12a834b7469926b">15552</a></td></tr>
<tr><td>push user</td><td>mozilla@jorgk.com</td></tr>
<tr><td>push date</td><td class="date age">Thu, 21 Feb 2019 23:19:05 +0000</td></tr>

<tr><td>treeherder</td><td>comm-central@1a4da3cb06f1 [<a href="https://treeherder.mozilla.org/#/jobs?repo=comm-central&revision=1a4da3cb06f1e8971b1111251072c034d3b3500a">default view</a>] [<a href="https://treeherder.mozilla.org/#/jobs?repo=comm-central&revision=1a4da3cb06f1e8971b1111251072c034d3b3500a&filter-resultStatus=testfailed&filter-resultStatus=busted&filter-resultStatus=exception">failures only]</td></tr>
<tr><td>perfherder</td><td>[<a href="https://treeherder.mozilla.org/perf.html#/compare?originalProject=comm-central&originalRevision=1a4da3cb06f1e8971b1111251072c034d3b3500a&newProject=comm-central&newRevision=810588b5151e823ec39fa18ca12a834b7469926b&framework=1" target="_blank">talos</a>] [<a href="https://treeherder.mozilla.org/perf.html#/compare?originalProject=comm-central&originalRevision=1a4da3cb06f1e8971b1111251072c034d3b3500a&newProject=comm-central&newRevision=810588b5151e823ec39fa18ca12a834b7469926b&framework=2" target="_blank">build metrics</a>] [<a href="https://treeherder.mozilla.org/perf.html#/compare?originalProject=comm-central&originalRevision=1a4da3cb06f1e8971b1111251072c034d3b3500a&newProject=comm-central&newRevision=810588b5151e823ec39fa18ca12a834b7469926b&framework=6" target="_blank">platform microbench</a>] (compared to previous push)</td></tr>
<tr><td>reviewers</td><td><a href="/comm-central/log?rev=reviewer%28bustage-fix%29&revcount=50">bustage-fix</a></td></tr>
<tr><td>bugs</td><td><a href="https://bugzilla.mozilla.org/show_bug.cgi?id=1529763">1529763</a>, <a href="https://bugzilla.mozilla.org/show_bug.cgi?id=1529252">1529252</a></td></tr>




</table></div>

<div class="page_body description"><a href="https://bugzilla.mozilla.org/show_bug.cgi?id=1529763">Bug 1529763</a> - Port <a href="https://bugzilla.mozilla.org/show_bug.cgi?id=1529252">bug 1529252</a>: s/NewChannelFromURI2/NewChannelFromURI/. rs=bustage-fix</div>
<div class="list_head"></div>
<div class="title_text">
<table cellspacing="0">

<tr class="parity0">
<td><a class="list" href="/comm-central/diff/810588b5151e823ec39fa18ca12a834b7469926b/calendar/base/content/calendar-dnd-listener.js">calendar/base/content/calendar-dnd-listener.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/810588b5151e823ec39fa18ca12a834b7469926b/calendar/base/content/calendar-dnd-listener.js">file</a> |
<a href="/comm-central/annotate/810588b5151e823ec39fa18ca12a834b7469926b/calendar/base/content/calendar-dnd-listener.js">annotate</a> |
<a href="/comm-central/diff/810588b5151e823ec39fa18ca12a834b7469926b/calendar/base/content/calendar-dnd-listener.js">diff</a> |
<a href="/comm-central/comparison/810588b5151e823ec39fa18ca12a834b7469926b/calendar/base/content/calendar-dnd-listener.js">comparison</a> |
<a href="/comm-central/log/810588b5151e823ec39fa18ca12a834b7469926b/calendar/base/content/calendar-dnd-listener.js">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/810588b5151e823ec39fa18ca12a834b7469926b/calendar/base/modules/utils/calProviderUtils.jsm">calendar/base/modules/utils/calProviderUtils.jsm</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/810588b5151e823ec39fa18ca12a834b7469926b/calendar/base/modules/utils/calProviderUtils.jsm">file</a> |
<a href="/comm-central/annotate/810588b5151e823ec39fa18ca12a834b7469926b/calendar/base/modules/utils/calProviderUtils.jsm">annotate</a> |
<a href="/comm-central/diff/810588b5151e823ec39fa18ca12a834b7469926b/calendar/base/modules/utils/calProviderUtils.jsm">diff</a> |
<a href="/comm-central/comparison/810588b5151e823ec39fa18ca12a834b7469926b/calendar/base/modules/utils/calProviderUtils.jsm">comparison</a> |
<a href="/comm-central/log/810588b5151e823ec39fa18ca12a834b7469926b/calendar/base/modules/utils/calProviderUtils.jsm">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/810588b5151e823ec39fa18ca12a834b7469926b/calendar/base/src/calProtocolHandler.js">calendar/base/src/calProtocolHandler.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/810588b5151e823ec39fa18ca12a834b7469926b/calendar/base/src/calProtocolHandler.js">file</a> |
<a href="/comm-central/annotate/810588b5151e823ec39fa18ca12a834b7469926b/calendar/base/src/calProtocolHandler.js">annotate</a> |
<a href="/comm-central/diff/810588b5151e823ec39fa18ca12a834b7469926b/calendar/base/src/calProtocolHandler.js">diff</a> |
<a href="/comm-central/comparison/810588b5151e823ec39fa18ca12a834b7469926b/calendar/base/src/calProtocolHandler.js">comparison</a> |
<a href="/comm-central/log/810588b5151e823ec39fa18ca12a834b7469926b/calendar/base/src/calProtocolHandler.js">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/810588b5151e823ec39fa18ca12a834b7469926b/calendar/base/src/calTimezoneService.js">calendar/base/src/calTimezoneService.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/810588b5151e823ec39fa18ca12a834b7469926b/calendar/base/src/calTimezoneService.js">file</a> |
<a href="/comm-central/annotate/810588b5151e823ec39fa18ca12a834b7469926b/calendar/base/src/calTimezoneService.js">annotate</a> |
<a href="/comm-central/diff/810588b5151e823ec39fa18ca12a834b7469926b/calendar/base/src/calTimezoneService.js">diff</a> |
<a href="/comm-central/comparison/810588b5151e823ec39fa18ca12a834b7469926b/calendar/base/src/calTimezoneService.js">comparison</a> |
<a href="/comm-central/log/810588b5151e823ec39fa18ca12a834b7469926b/calendar/base/src/calTimezoneService.js">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/810588b5151e823ec39fa18ca12a834b7469926b/calendar/providers/gdata/modules/gdataRequest.jsm">calendar/providers/gdata/modules/gdataRequest.jsm</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/810588b5151e823ec39fa18ca12a834b7469926b/calendar/providers/gdata/modules/gdataRequest.jsm">file</a> |
<a href="/comm-central/annotate/810588b5151e823ec39fa18ca12a834b7469926b/calendar/providers/gdata/modules/gdataRequest.jsm">annotate</a> |
<a href="/comm-central/diff/810588b5151e823ec39fa18ca12a834b7469926b/calendar/providers/gdata/modules/gdataRequest.jsm">diff</a> |
<a href="/comm-central/comparison/810588b5151e823ec39fa18ca12a834b7469926b/calendar/providers/gdata/modules/gdataRequest.jsm">comparison</a> |
<a href="/comm-central/log/810588b5151e823ec39fa18ca12a834b7469926b/calendar/providers/gdata/modules/gdataRequest.jsm">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/810588b5151e823ec39fa18ca12a834b7469926b/calendar/providers/ics/calICSCalendar.js">calendar/providers/ics/calICSCalendar.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/810588b5151e823ec39fa18ca12a834b7469926b/calendar/providers/ics/calICSCalendar.js">file</a> |
<a href="/comm-central/annotate/810588b5151e823ec39fa18ca12a834b7469926b/calendar/providers/ics/calICSCalendar.js">annotate</a> |
<a href="/comm-central/diff/810588b5151e823ec39fa18ca12a834b7469926b/calendar/providers/ics/calICSCalendar.js">diff</a> |
<a href="/comm-central/comparison/810588b5151e823ec39fa18ca12a834b7469926b/calendar/providers/ics/calICSCalendar.js">comparison</a> |
<a href="/comm-central/log/810588b5151e823ec39fa18ca12a834b7469926b/calendar/providers/ics/calICSCalendar.js">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/810588b5151e823ec39fa18ca12a834b7469926b/calendar/providers/wcap/calWcapRequest.js">calendar/providers/wcap/calWcapRequest.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/810588b5151e823ec39fa18ca12a834b7469926b/calendar/providers/wcap/calWcapRequest.js">file</a> |
<a href="/comm-central/annotate/810588b5151e823ec39fa18ca12a834b7469926b/calendar/providers/wcap/calWcapRequest.js">annotate</a> |
<a href="/comm-central/diff/810588b5151e823ec39fa18ca12a834b7469926b/calendar/providers/wcap/calWcapRequest.js">diff</a> |
<a href="/comm-central/comparison/810588b5151e823ec39fa18ca12a834b7469926b/calendar/providers/wcap/calWcapRequest.js">comparison</a> |
<a href="/comm-central/log/810588b5151e823ec39fa18ca12a834b7469926b/calendar/providers/wcap/calWcapRequest.js">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/810588b5151e823ec39fa18ca12a834b7469926b/calendar/resources/content/publish.js">calendar/resources/content/publish.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/810588b5151e823ec39fa18ca12a834b7469926b/calendar/resources/content/publish.js">file</a> |
<a href="/comm-central/annotate/810588b5151e823ec39fa18ca12a834b7469926b/calendar/resources/content/publish.js">annotate</a> |
<a href="/comm-central/diff/810588b5151e823ec39fa18ca12a834b7469926b/calendar/resources/content/publish.js">diff</a> |
<a href="/comm-central/comparison/810588b5151e823ec39fa18ca12a834b7469926b/calendar/resources/content/publish.js">comparison</a> |
<a href="/comm-central/log/810588b5151e823ec39fa18ca12a834b7469926b/calendar/resources/content/publish.js">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/810588b5151e823ec39fa18ca12a834b7469926b/calendar/test/unit/test_webcal.js">calendar/test/unit/test_webcal.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/810588b5151e823ec39fa18ca12a834b7469926b/calendar/test/unit/test_webcal.js">file</a> |
<a href="/comm-central/annotate/810588b5151e823ec39fa18ca12a834b7469926b/calendar/test/unit/test_webcal.js">annotate</a> |
<a href="/comm-central/diff/810588b5151e823ec39fa18ca12a834b7469926b/calendar/test/unit/test_webcal.js">diff</a> |
<a href="/comm-central/comparison/810588b5151e823ec39fa18ca12a834b7469926b/calendar/test/unit/test_webcal.js">comparison</a> |
<a href="/comm-central/log/810588b5151e823ec39fa18ca12a834b7469926b/calendar/test/unit/test_webcal.js">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/810588b5151e823ec39fa18ca12a834b7469926b/mail/base/content/msgHdrView.js">mail/base/content/msgHdrView.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/810588b5151e823ec39fa18ca12a834b7469926b/mail/base/content/msgHdrView.js">file</a> |
<a href="/comm-central/annotate/810588b5151e823ec39fa18ca12a834b7469926b/mail/base/content/msgHdrView.js">annotate</a> |
<a href="/comm-central/diff/810588b5151e823ec39fa18ca12a834b7469926b/mail/base/content/msgHdrView.js">diff</a> |
<a href="/comm-central/comparison/810588b5151e823ec39fa18ca12a834b7469926b/mail/base/content/msgHdrView.js">comparison</a> |
<a href="/comm-central/log/810588b5151e823ec39fa18ca12a834b7469926b/mail/base/content/msgHdrView.js">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/810588b5151e823ec39fa18ca12a834b7469926b/mail/components/accountcreation/content/util.js">mail/components/accountcreation/content/util.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/810588b5151e823ec39fa18ca12a834b7469926b/mail/components/accountcreation/content/util.js">file</a> |
<a href="/comm-central/annotate/810588b5151e823ec39fa18ca12a834b7469926b/mail/components/accountcreation/content/util.js">annotate</a> |
<a href="/comm-central/diff/810588b5151e823ec39fa18ca12a834b7469926b/mail/components/accountcreation/content/util.js">diff</a> |
<a href="/comm-central/comparison/810588b5151e823ec39fa18ca12a834b7469926b/mail/components/accountcreation/content/util.js">comparison</a> |
<a href="/comm-central/log/810588b5151e823ec39fa18ca12a834b7469926b/mail/components/accountcreation/content/util.js">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/810588b5151e823ec39fa18ca12a834b7469926b/mail/components/compose/content/MsgComposeCommands.js">mail/components/compose/content/MsgComposeCommands.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/810588b5151e823ec39fa18ca12a834b7469926b/mail/components/compose/content/MsgComposeCommands.js">file</a> |
<a href="/comm-central/annotate/810588b5151e823ec39fa18ca12a834b7469926b/mail/components/compose/content/MsgComposeCommands.js">annotate</a> |
<a href="/comm-central/diff/810588b5151e823ec39fa18ca12a834b7469926b/mail/components/compose/content/MsgComposeCommands.js">diff</a> |
<a href="/comm-central/comparison/810588b5151e823ec39fa18ca12a834b7469926b/mail/components/compose/content/MsgComposeCommands.js">comparison</a> |
<a href="/comm-central/log/810588b5151e823ec39fa18ca12a834b7469926b/mail/components/compose/content/MsgComposeCommands.js">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/810588b5151e823ec39fa18ca12a834b7469926b/mail/components/nsMailDefaultHandler.js">mail/components/nsMailDefaultHandler.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/810588b5151e823ec39fa18ca12a834b7469926b/mail/components/nsMailDefaultHandler.js">file</a> |
<a href="/comm-central/annotate/810588b5151e823ec39fa18ca12a834b7469926b/mail/components/nsMailDefaultHandler.js">annotate</a> |
<a href="/comm-central/diff/810588b5151e823ec39fa18ca12a834b7469926b/mail/components/nsMailDefaultHandler.js">diff</a> |
<a href="/comm-central/comparison/810588b5151e823ec39fa18ca12a834b7469926b/mail/components/nsMailDefaultHandler.js">comparison</a> |
<a href="/comm-central/log/810588b5151e823ec39fa18ca12a834b7469926b/mail/components/nsMailDefaultHandler.js">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/810588b5151e823ec39fa18ca12a834b7469926b/mail/test/resources/mozmill/mozmill/extension/content/stdlib/securable-module.jsm">mail/test/resources/mozmill/mozmill/extension/content/stdlib/securable-module.jsm</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/810588b5151e823ec39fa18ca12a834b7469926b/mail/test/resources/mozmill/mozmill/extension/content/stdlib/securable-module.jsm">file</a> |
<a href="/comm-central/annotate/810588b5151e823ec39fa18ca12a834b7469926b/mail/test/resources/mozmill/mozmill/extension/content/stdlib/securable-module.jsm">annotate</a> |
<a href="/comm-central/diff/810588b5151e823ec39fa18ca12a834b7469926b/mail/test/resources/mozmill/mozmill/extension/content/stdlib/securable-module.jsm">diff</a> |
<a href="/comm-central/comparison/810588b5151e823ec39fa18ca12a834b7469926b/mail/test/resources/mozmill/mozmill/extension/content/stdlib/securable-module.jsm">comparison</a> |
<a href="/comm-central/log/810588b5151e823ec39fa18ca12a834b7469926b/mail/test/resources/mozmill/mozmill/extension/content/stdlib/securable-module.jsm">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/810588b5151e823ec39fa18ca12a834b7469926b/mailnews/compose/src/nsMsgQuote.cpp">mailnews/compose/src/nsMsgQuote.cpp</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/810588b5151e823ec39fa18ca12a834b7469926b/mailnews/compose/src/nsMsgQuote.cpp">file</a> |
<a href="/comm-central/annotate/810588b5151e823ec39fa18ca12a834b7469926b/mailnews/compose/src/nsMsgQuote.cpp">annotate</a> |
<a href="/comm-central/diff/810588b5151e823ec39fa18ca12a834b7469926b/mailnews/compose/src/nsMsgQuote.cpp">diff</a> |
<a href="/comm-central/comparison/810588b5151e823ec39fa18ca12a834b7469926b/mailnews/compose/src/nsMsgQuote.cpp">comparison</a> |
<a href="/comm-central/log/810588b5151e823ec39fa18ca12a834b7469926b/mailnews/compose/src/nsMsgQuote.cpp">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/810588b5151e823ec39fa18ca12a834b7469926b/mailnews/extensions/bayesian-spam-filter/test/unit/resources/trainingfile.js">mailnews/extensions/bayesian-spam-filter/test/unit/resources/trainingfile.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/810588b5151e823ec39fa18ca12a834b7469926b/mailnews/extensions/bayesian-spam-filter/test/unit/resources/trainingfile.js">file</a> |
<a href="/comm-central/annotate/810588b5151e823ec39fa18ca12a834b7469926b/mailnews/extensions/bayesian-spam-filter/test/unit/resources/trainingfile.js">annotate</a> |
<a href="/comm-central/diff/810588b5151e823ec39fa18ca12a834b7469926b/mailnews/extensions/bayesian-spam-filter/test/unit/resources/trainingfile.js">diff</a> |
<a href="/comm-central/comparison/810588b5151e823ec39fa18ca12a834b7469926b/mailnews/extensions/bayesian-spam-filter/test/unit/resources/trainingfile.js">comparison</a> |
<a href="/comm-central/log/810588b5151e823ec39fa18ca12a834b7469926b/mailnews/extensions/bayesian-spam-filter/test/unit/resources/trainingfile.js">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/810588b5151e823ec39fa18ca12a834b7469926b/mailnews/imap/test/unit/test_chunkLastLF.js">mailnews/imap/test/unit/test_chunkLastLF.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/810588b5151e823ec39fa18ca12a834b7469926b/mailnews/imap/test/unit/test_chunkLastLF.js">file</a> |
<a href="/comm-central/annotate/810588b5151e823ec39fa18ca12a834b7469926b/mailnews/imap/test/unit/test_chunkLastLF.js">annotate</a> |
<a href="/comm-central/diff/810588b5151e823ec39fa18ca12a834b7469926b/mailnews/imap/test/unit/test_chunkLastLF.js">diff</a> |
<a href="/comm-central/comparison/810588b5151e823ec39fa18ca12a834b7469926b/mailnews/imap/test/unit/test_chunkLastLF.js">comparison</a> |
<a href="/comm-central/log/810588b5151e823ec39fa18ca12a834b7469926b/mailnews/imap/test/unit/test_chunkLastLF.js">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/810588b5151e823ec39fa18ca12a834b7469926b/mailnews/imap/test/unit/test_dod.js">mailnews/imap/test/unit/test_dod.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/810588b5151e823ec39fa18ca12a834b7469926b/mailnews/imap/test/unit/test_dod.js">file</a> |
<a href="/comm-central/annotate/810588b5151e823ec39fa18ca12a834b7469926b/mailnews/imap/test/unit/test_dod.js">annotate</a> |
<a href="/comm-central/diff/810588b5151e823ec39fa18ca12a834b7469926b/mailnews/imap/test/unit/test_dod.js">diff</a> |
<a href="/comm-central/comparison/810588b5151e823ec39fa18ca12a834b7469926b/mailnews/imap/test/unit/test_dod.js">comparison</a> |
<a href="/comm-central/log/810588b5151e823ec39fa18ca12a834b7469926b/mailnews/imap/test/unit/test_dod.js">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/810588b5151e823ec39fa18ca12a834b7469926b/mailnews/imap/test/unit/test_imapContentLength.js">mailnews/imap/test/unit/test_imapContentLength.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/810588b5151e823ec39fa18ca12a834b7469926b/mailnews/imap/test/unit/test_imapContentLength.js">file</a> |
<a href="/comm-central/annotate/810588b5151e823ec39fa18ca12a834b7469926b/mailnews/imap/test/unit/test_imapContentLength.js">annotate</a> |
<a href="/comm-central/diff/810588b5151e823ec39fa18ca12a834b7469926b/mailnews/imap/test/unit/test_imapContentLength.js">diff</a> |
<a href="/comm-central/comparison/810588b5151e823ec39fa18ca12a834b7469926b/mailnews/imap/test/unit/test_imapContentLength.js">comparison</a> |
<a href="/comm-central/log/810588b5151e823ec39fa18ca12a834b7469926b/mailnews/imap/test/unit/test_imapContentLength.js">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/810588b5151e823ec39fa18ca12a834b7469926b/mailnews/local/test/unit/test_mailboxContentLength.js">mailnews/local/test/unit/test_mailboxContentLength.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/810588b5151e823ec39fa18ca12a834b7469926b/mailnews/local/test/unit/test_mailboxContentLength.js">file</a> |
<a href="/comm-central/annotate/810588b5151e823ec39fa18ca12a834b7469926b/mailnews/local/test/unit/test_mailboxContentLength.js">annotate</a> |
<a href="/comm-central/diff/810588b5151e823ec39fa18ca12a834b7469926b/mailnews/local/test/unit/test_mailboxContentLength.js">diff</a> |
<a href="/comm-central/comparison/810588b5151e823ec39fa18ca12a834b7469926b/mailnews/local/test/unit/test_mailboxContentLength.js">comparison</a> |
<a href="/comm-central/log/810588b5151e823ec39fa18ca12a834b7469926b/mailnews/local/test/unit/test_mailboxContentLength.js">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/810588b5151e823ec39fa18ca12a834b7469926b/mailnews/news/test/unit/test_bug37465.js">mailnews/news/test/unit/test_bug37465.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/810588b5151e823ec39fa18ca12a834b7469926b/mailnews/news/test/unit/test_bug37465.js">file</a> |
<a href="/comm-central/annotate/810588b5151e823ec39fa18ca12a834b7469926b/mailnews/news/test/unit/test_bug37465.js">annotate</a> |
<a href="/comm-central/diff/810588b5151e823ec39fa18ca12a834b7469926b/mailnews/news/test/unit/test_bug37465.js">diff</a> |
<a href="/comm-central/comparison/810588b5151e823ec39fa18ca12a834b7469926b/mailnews/news/test/unit/test_bug37465.js">comparison</a> |
<a href="/comm-central/log/810588b5151e823ec39fa18ca12a834b7469926b/mailnews/news/test/unit/test_bug37465.js">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/810588b5151e823ec39fa18ca12a834b7469926b/mailnews/news/test/unit/test_nntpContentLength.js">mailnews/news/test/unit/test_nntpContentLength.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/810588b5151e823ec39fa18ca12a834b7469926b/mailnews/news/test/unit/test_nntpContentLength.js">file</a> |
<a href="/comm-central/annotate/810588b5151e823ec39fa18ca12a834b7469926b/mailnews/news/test/unit/test_nntpContentLength.js">annotate</a> |
<a href="/comm-central/diff/810588b5151e823ec39fa18ca12a834b7469926b/mailnews/news/test/unit/test_nntpContentLength.js">diff</a> |
<a href="/comm-central/comparison/810588b5151e823ec39fa18ca12a834b7469926b/mailnews/news/test/unit/test_nntpContentLength.js">comparison</a> |
<a href="/comm-central/log/810588b5151e823ec39fa18ca12a834b7469926b/mailnews/news/test/unit/test_nntpContentLength.js">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/810588b5151e823ec39fa18ca12a834b7469926b/suite/components/nsAbout.js">suite/components/nsAbout.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/810588b5151e823ec39fa18ca12a834b7469926b/suite/components/nsAbout.js">file</a> |
<a href="/comm-central/annotate/810588b5151e823ec39fa18ca12a834b7469926b/suite/components/nsAbout.js">annotate</a> |
<a href="/comm-central/diff/810588b5151e823ec39fa18ca12a834b7469926b/suite/components/nsAbout.js">diff</a> |
<a href="/comm-central/comparison/810588b5151e823ec39fa18ca12a834b7469926b/suite/components/nsAbout.js">comparison</a> |
<a href="/comm-central/log/810588b5151e823ec39fa18ca12a834b7469926b/suite/components/nsAbout.js">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/810588b5151e823ec39fa18ca12a834b7469926b/suite/components/nsGopherProtocolStubHandler.js">suite/components/nsGopherProtocolStubHandler.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/810588b5151e823ec39fa18ca12a834b7469926b/suite/components/nsGopherProtocolStubHandler.js">file</a> |
<a href="/comm-central/annotate/810588b5151e823ec39fa18ca12a834b7469926b/suite/components/nsGopherProtocolStubHandler.js">annotate</a> |
<a href="/comm-central/diff/810588b5151e823ec39fa18ca12a834b7469926b/suite/components/nsGopherProtocolStubHandler.js">diff</a> |
<a href="/comm-central/comparison/810588b5151e823ec39fa18ca12a834b7469926b/suite/components/nsGopherProtocolStubHandler.js">comparison</a> |
<a href="/comm-central/log/810588b5151e823ec39fa18ca12a834b7469926b/suite/components/nsGopherProtocolStubHandler.js">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/810588b5151e823ec39fa18ca12a834b7469926b/suite/mailnews/components/addrbook/content/abCommon.js">suite/mailnews/components/addrbook/content/abCommon.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/810588b5151e823ec39fa18ca12a834b7469926b/suite/mailnews/components/addrbook/content/abCommon.js">file</a> |
<a href="/comm-central/annotate/810588b5151e823ec39fa18ca12a834b7469926b/suite/mailnews/components/addrbook/content/abCommon.js">annotate</a> |
<a href="/comm-central/diff/810588b5151e823ec39fa18ca12a834b7469926b/suite/mailnews/components/addrbook/content/abCommon.js">diff</a> |
<a href="/comm-central/comparison/810588b5151e823ec39fa18ca12a834b7469926b/suite/mailnews/components/addrbook/content/abCommon.js">comparison</a> |
<a href="/comm-central/log/810588b5151e823ec39fa18ca12a834b7469926b/suite/mailnews/components/addrbook/content/abCommon.js">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/810588b5151e823ec39fa18ca12a834b7469926b/suite/mailnews/components/compose/content/MsgComposeCommands.js">suite/mailnews/components/compose/content/MsgComposeCommands.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/810588b5151e823ec39fa18ca12a834b7469926b/suite/mailnews/components/compose/content/MsgComposeCommands.js">file</a> |
<a href="/comm-central/annotate/810588b5151e823ec39fa18ca12a834b7469926b/suite/mailnews/components/compose/content/MsgComposeCommands.js">annotate</a> |
<a href="/comm-central/diff/810588b5151e823ec39fa18ca12a834b7469926b/suite/mailnews/components/compose/content/MsgComposeCommands.js">diff</a> |
<a href="/comm-central/comparison/810588b5151e823ec39fa18ca12a834b7469926b/suite/mailnews/components/compose/content/MsgComposeCommands.js">comparison</a> |
<a href="/comm-central/log/810588b5151e823ec39fa18ca12a834b7469926b/suite/mailnews/components/compose/content/MsgComposeCommands.js">revisions</a>
</td>
</tr>
</table></div>

<div class="page_body diffblocks"><div class="diffblock"><pre class="sourcelines">
<a href="#l1.1"></a><span id="l1.1" class="difflineminus">--- a/calendar/base/content/calendar-dnd-listener.js</span>
<a href="#l1.2"></a><span id="l1.2" class="difflineplus">+++ b/calendar/base/content/calendar-dnd-listener.js</span>
<a href="#l1.3"></a><span id="l1.3" class="difflineat">@@ -287,17 +287,17 @@ calDNDBaseObserver.prototype = {</span>
<a href="#l1.4"></a><span id="l1.4">                 }</span>
<a href="#l1.5"></a><span id="l1.5"> </span>
<a href="#l1.6"></a><span id="l1.6">                 break;</span>
<a href="#l1.7"></a><span id="l1.7">             }</span>
<a href="#l1.8"></a><span id="l1.8">             case &quot;application/x-moz-file-promise&quot;:</span>
<a href="#l1.9"></a><span id="l1.9">             case &quot;text/x-moz-url&quot;: {</span>
<a href="#l1.10"></a><span id="l1.10">                 let uri = Services.io.newURI(data.toString());</span>
<a href="#l1.11"></a><span id="l1.11">                 let loader = cal.provider.createStreamLoader();</span>
<a href="#l1.12"></a><span id="l1.12" class="difflineminus">-                let channel = Services.io.newChannelFromURI2(</span>
<a href="#l1.13"></a><span id="l1.13" class="difflineplus">+                let channel = Services.io.newChannelFromURI(</span>
<a href="#l1.14"></a><span id="l1.14">                     uri,</span>
<a href="#l1.15"></a><span id="l1.15">                     null,</span>
<a href="#l1.16"></a><span id="l1.16">                     Services.scriptSecurityManager.getSystemPrincipal(),</span>
<a href="#l1.17"></a><span id="l1.17">                     null,</span>
<a href="#l1.18"></a><span id="l1.18">                     Ci.nsILoadInfo.SEC_ALLOW_CROSS_ORIGIN_DATA_IS_NULL,</span>
<a href="#l1.19"></a><span id="l1.19">                     Ci.nsIContentPolicy.TYPE_OTHER</span>
<a href="#l1.20"></a><span id="l1.20">                 );</span>
<a href="#l1.21"></a><span id="l1.21">                 channel.loadFlags |= Ci.nsIRequest.LOAD_BYPASS_CACHE;</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l2.1"></a><span id="l2.1" class="difflineminus">--- a/calendar/base/modules/utils/calProviderUtils.jsm</span>
<a href="#l2.2"></a><span id="l2.2" class="difflineplus">+++ b/calendar/base/modules/utils/calProviderUtils.jsm</span>
<a href="#l2.3"></a><span id="l2.3" class="difflineat">@@ -36,22 +36,22 @@ var calprovider = {</span>
<a href="#l2.4"></a><span id="l2.4">      * @param {?nsIChannel} aExisting                           An existing channel to modify (optional)</span>
<a href="#l2.5"></a><span id="l2.5">      * @return {nsIChannel}                                     The prepared channel</span>
<a href="#l2.6"></a><span id="l2.6">      */</span>
<a href="#l2.7"></a><span id="l2.7">     prepHttpChannel: function(aUri, aUploadData, aContentType, aNotificationCallbacks, aExisting=null) {</span>
<a href="#l2.8"></a><span id="l2.8">         // We cannot use a system principal here since the connection setup will fail if</span>
<a href="#l2.9"></a><span id="l2.9">         // same-site cookie protection is enabled in TB and server-side.</span>
<a href="#l2.10"></a><span id="l2.10">         let principal = aExisting ? null</span>
<a href="#l2.11"></a><span id="l2.11">                                   : Services.scriptSecurityManager.createCodebasePrincipal(aUri, {});</span>
<a href="#l2.12"></a><span id="l2.12" class="difflineminus">-        let channel = aExisting || Services.io.newChannelFromURI2(aUri,</span>
<a href="#l2.13"></a><span id="l2.13" class="difflineminus">-                                                                  null,</span>
<a href="#l2.14"></a><span id="l2.14" class="difflineminus">-                                                                  principal,</span>
<a href="#l2.15"></a><span id="l2.15" class="difflineminus">-                                                                  null,</span>
<a href="#l2.16"></a><span id="l2.16" class="difflineminus">-                                                                  Ci.nsILoadInfo.SEC_ALLOW_CROSS_ORIGIN_DATA_IS_NULL,</span>
<a href="#l2.17"></a><span id="l2.17" class="difflineminus">-                                                                  Ci.nsIContentPolicy.TYPE_OTHER);</span>
<a href="#l2.18"></a><span id="l2.18" class="difflineplus">+        let channel = aExisting || Services.io.newChannelFromURI(aUri,</span>
<a href="#l2.19"></a><span id="l2.19" class="difflineplus">+                                                                 null,</span>
<a href="#l2.20"></a><span id="l2.20" class="difflineplus">+                                                                 principal,</span>
<a href="#l2.21"></a><span id="l2.21" class="difflineplus">+                                                                 null,</span>
<a href="#l2.22"></a><span id="l2.22" class="difflineplus">+                                                                 Ci.nsILoadInfo.SEC_ALLOW_CROSS_ORIGIN_DATA_IS_NULL,</span>
<a href="#l2.23"></a><span id="l2.23" class="difflineplus">+                                                                 Ci.nsIContentPolicy.TYPE_OTHER);</span>
<a href="#l2.24"></a><span id="l2.24">         let httpchannel = channel.QueryInterface(Ci.nsIHttpChannel);</span>
<a href="#l2.25"></a><span id="l2.25"> </span>
<a href="#l2.26"></a><span id="l2.26">         httpchannel.setRequestHeader(&quot;Accept&quot;, &quot;text/xml&quot;, false);</span>
<a href="#l2.27"></a><span id="l2.27">         httpchannel.setRequestHeader(&quot;Accept-Charset&quot;, &quot;utf-8,*;q=0.1&quot;, false);</span>
<a href="#l2.28"></a><span id="l2.28">         httpchannel.loadFlags |= Ci.nsIRequest.LOAD_BYPASS_CACHE;</span>
<a href="#l2.29"></a><span id="l2.29">         httpchannel.notificationCallbacks = aNotificationCallbacks;</span>
<a href="#l2.30"></a><span id="l2.30"> </span>
<a href="#l2.31"></a><span id="l2.31">         if (aUploadData) {</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l3.1"></a><span id="l3.1" class="difflineminus">--- a/calendar/base/src/calProtocolHandler.js</span>
<a href="#l3.2"></a><span id="l3.2" class="difflineplus">+++ b/calendar/base/src/calProtocolHandler.js</span>
<a href="#l3.3"></a><span id="l3.3" class="difflineat">@@ -29,22 +29,22 @@ calProtocolHandler.prototype = {</span>
<a href="#l3.4"></a><span id="l3.4"> </span>
<a href="#l3.5"></a><span id="l3.5">     newChannel: function(aUri, aLoadInfo) {</span>
<a href="#l3.6"></a><span id="l3.6">         let uri = aUri.mutate().setScheme(this.mHttpProtocol.scheme).finalize();</span>
<a href="#l3.7"></a><span id="l3.7"> </span>
<a href="#l3.8"></a><span id="l3.8">         let channel;</span>
<a href="#l3.9"></a><span id="l3.9">         if (aLoadInfo) {</span>
<a href="#l3.10"></a><span id="l3.10">             channel = Services.io.newChannelFromURIWithLoadInfo(uri, aLoadInfo);</span>
<a href="#l3.11"></a><span id="l3.11">         } else {</span>
<a href="#l3.12"></a><span id="l3.12" class="difflineminus">-            channel = Services.io.newChannelFromURI2(uri,</span>
<a href="#l3.13"></a><span id="l3.13" class="difflineminus">-                                                     null,</span>
<a href="#l3.14"></a><span id="l3.14" class="difflineminus">-                                                     Services.scriptSecurityManager.getSystemPrincipal(),</span>
<a href="#l3.15"></a><span id="l3.15" class="difflineminus">-                                                     null,</span>
<a href="#l3.16"></a><span id="l3.16" class="difflineminus">-                                                     Ci.nsILoadInfo.SEC_ALLOW_CROSS_ORIGIN_DATA_IS_NULL,</span>
<a href="#l3.17"></a><span id="l3.17" class="difflineminus">-                                                     Ci.nsIContentPolicy.TYPE_OTHER);</span>
<a href="#l3.18"></a><span id="l3.18" class="difflineplus">+            channel = Services.io.newChannelFromURI(uri,</span>
<a href="#l3.19"></a><span id="l3.19" class="difflineplus">+                                                    null,</span>
<a href="#l3.20"></a><span id="l3.20" class="difflineplus">+                                                    Services.scriptSecurityManager.getSystemPrincipal(),</span>
<a href="#l3.21"></a><span id="l3.21" class="difflineplus">+                                                    null,</span>
<a href="#l3.22"></a><span id="l3.22" class="difflineplus">+                                                    Ci.nsILoadInfo.SEC_ALLOW_CROSS_ORIGIN_DATA_IS_NULL,</span>
<a href="#l3.23"></a><span id="l3.23" class="difflineplus">+                                                    Ci.nsIContentPolicy.TYPE_OTHER);</span>
<a href="#l3.24"></a><span id="l3.24">         }</span>
<a href="#l3.25"></a><span id="l3.25">         channel.originalURI = aUri;</span>
<a href="#l3.26"></a><span id="l3.26">         return channel;</span>
<a href="#l3.27"></a><span id="l3.27">     },</span>
<a href="#l3.28"></a><span id="l3.28"> </span>
<a href="#l3.29"></a><span id="l3.29">     // We are not overriding any special ports</span>
<a href="#l3.30"></a><span id="l3.30">     allowPort: function(aPort, aScheme) { return false; }</span>
<a href="#l3.31"></a><span id="l3.31"> };</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l4.1"></a><span id="l4.1" class="difflineminus">--- a/calendar/base/src/calTimezoneService.js</span>
<a href="#l4.2"></a><span id="l4.2" class="difflineplus">+++ b/calendar/base/src/calTimezoneService.js</span>
<a href="#l4.3"></a><span id="l4.3" class="difflineat">@@ -69,22 +69,22 @@ calTimezoneService.prototype = {</span>
<a href="#l4.4"></a><span id="l4.4"> </span>
<a href="#l4.5"></a><span id="l4.5">     // calIStartupService:</span>
<a href="#l4.6"></a><span id="l4.6">     startup: function(aCompleteListener) {</span>
<a href="#l4.7"></a><span id="l4.7">         function fetchJSON(aURL) {</span>
<a href="#l4.8"></a><span id="l4.8">             cal.LOG(&quot;[calTimezoneService] Loading &quot; + aURL);</span>
<a href="#l4.9"></a><span id="l4.9"> </span>
<a href="#l4.10"></a><span id="l4.10">             return new Promise((resolve, reject) =&gt; {</span>
<a href="#l4.11"></a><span id="l4.11">                 let uri = Services.io.newURI(aURL);</span>
<a href="#l4.12"></a><span id="l4.12" class="difflineminus">-                let channel = Services.io.newChannelFromURI2(uri,</span>
<a href="#l4.13"></a><span id="l4.13" class="difflineminus">-                                                             null,</span>
<a href="#l4.14"></a><span id="l4.14" class="difflineminus">-                                                             Services.scriptSecurityManager.getSystemPrincipal(),</span>
<a href="#l4.15"></a><span id="l4.15" class="difflineminus">-                                                             null,</span>
<a href="#l4.16"></a><span id="l4.16" class="difflineminus">-                                                             Ci.nsILoadInfo.SEC_REQUIRE_SAME_ORIGIN_DATA_INHERITS,</span>
<a href="#l4.17"></a><span id="l4.17" class="difflineminus">-                                                             Ci.nsIContentPolicy.TYPE_OTHER);</span>
<a href="#l4.18"></a><span id="l4.18" class="difflineplus">+                let channel = Services.io.newChannelFromURI(uri,</span>
<a href="#l4.19"></a><span id="l4.19" class="difflineplus">+                                                            null,</span>
<a href="#l4.20"></a><span id="l4.20" class="difflineplus">+                                                            Services.scriptSecurityManager.getSystemPrincipal(),</span>
<a href="#l4.21"></a><span id="l4.21" class="difflineplus">+                                                            null,</span>
<a href="#l4.22"></a><span id="l4.22" class="difflineplus">+                                                            Ci.nsILoadInfo.SEC_REQUIRE_SAME_ORIGIN_DATA_INHERITS,</span>
<a href="#l4.23"></a><span id="l4.23" class="difflineplus">+                                                            Ci.nsIContentPolicy.TYPE_OTHER);</span>
<a href="#l4.24"></a><span id="l4.24"> </span>
<a href="#l4.25"></a><span id="l4.25">                 NetUtil.asyncFetch(channel, (inputStream, status) =&gt; {</span>
<a href="#l4.26"></a><span id="l4.26">                     if (!Components.isSuccessCode(status)) {</span>
<a href="#l4.27"></a><span id="l4.27">                         reject(status);</span>
<a href="#l4.28"></a><span id="l4.28">                         return;</span>
<a href="#l4.29"></a><span id="l4.29">                     }</span>
<a href="#l4.30"></a><span id="l4.30"> </span>
<a href="#l4.31"></a><span id="l4.31">                     try {</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l5.1"></a><span id="l5.1" class="difflineminus">--- a/calendar/providers/gdata/modules/gdataRequest.jsm</span>
<a href="#l5.2"></a><span id="l5.2" class="difflineplus">+++ b/calendar/providers/gdata/modules/gdataRequest.jsm</span>
<a href="#l5.3"></a><span id="l5.3" class="difflineat">@@ -193,26 +193,31 @@ calGoogleRequest.prototype = {</span>
<a href="#l5.4"></a><span id="l5.4">                 this.mQueryParameters.forEach((val, key) =&gt; {</span>
<a href="#l5.5"></a><span id="l5.5">                     params.push(key + &quot;=&quot; + encodeURIComponent(val));</span>
<a href="#l5.6"></a><span id="l5.6">                 });</span>
<a href="#l5.7"></a><span id="l5.7">                 uristring += &quot;?&quot; + params.join(&quot;&amp;&quot;);</span>
<a href="#l5.8"></a><span id="l5.8">             }</span>
<a href="#l5.9"></a><span id="l5.9">             let uri = Services.io.newURI(uristring);</span>
<a href="#l5.10"></a><span id="l5.10">             let channel;</span>
<a href="#l5.11"></a><span id="l5.11">             if (&quot;newChannelFromURI2&quot; in Services.io) {</span>
<a href="#l5.12"></a><span id="l5.12" class="difflineminus">-                // Lightning 4.3+</span>
<a href="#l5.13"></a><span id="l5.13" class="difflineplus">+                // Before mozilla67, Lightning 6.8 and below.</span>
<a href="#l5.14"></a><span id="l5.14">                 channel = Services.io.newChannelFromURI2(uri,</span>
<a href="#l5.15"></a><span id="l5.15">                                                          null,</span>
<a href="#l5.16"></a><span id="l5.16">                                                          Services.scriptSecurityManager.getSystemPrincipal(),</span>
<a href="#l5.17"></a><span id="l5.17">                                                          null,</span>
<a href="#l5.18"></a><span id="l5.18">                                                          Ci.nsILoadInfo.SEC_ALLOW_CROSS_ORIGIN_DATA_IS_NULL,</span>
<a href="#l5.19"></a><span id="l5.19">                                                          Ci.nsIContentPolicy.TYPE_OTHER);</span>
<a href="#l5.20"></a><span id="l5.20">             } else {</span>
<a href="#l5.21"></a><span id="l5.21" class="difflineminus">-                // Lightning 4.2 and older</span>
<a href="#l5.22"></a><span id="l5.22" class="difflineminus">-                channel = Services.io.newChannelFromURI(uri);</span>
<a href="#l5.23"></a><span id="l5.23" class="difflineplus">+                // mozilla67 and later, Lightning 6.9.</span>
<a href="#l5.24"></a><span id="l5.24" class="difflineplus">+                channel = Services.io.newChannelFromURI(uri,</span>
<a href="#l5.25"></a><span id="l5.25" class="difflineplus">+                                                        null,</span>
<a href="#l5.26"></a><span id="l5.26" class="difflineplus">+                                                        Services.scriptSecurityManager.getSystemPrincipal(),</span>
<a href="#l5.27"></a><span id="l5.27" class="difflineplus">+                                                        null,</span>
<a href="#l5.28"></a><span id="l5.28" class="difflineplus">+                                                        Ci.nsILoadInfo.SEC_ALLOW_CROSS_ORIGIN_DATA_IS_NULL,</span>
<a href="#l5.29"></a><span id="l5.29" class="difflineplus">+                                                        Ci.nsIContentPolicy.TYPE_OTHER);</span>
<a href="#l5.30"></a><span id="l5.30">             }</span>
<a href="#l5.31"></a><span id="l5.31"> </span>
<a href="#l5.32"></a><span id="l5.32">             cal.LOG(&quot;[calGoogleRequest] Requesting &quot; + this.method + &quot; &quot; +</span>
<a href="#l5.33"></a><span id="l5.33">                     channel.URI.spec);</span>
<a href="#l5.34"></a><span id="l5.34"> </span>
<a href="#l5.35"></a><span id="l5.35">             this.prepareChannel(channel);</span>
<a href="#l5.36"></a><span id="l5.36"> </span>
<a href="#l5.37"></a><span id="l5.37">             channel = channel.QueryInterface(Ci.nsIHttpChannel);</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l6.1"></a><span id="l6.1" class="difflineminus">--- a/calendar/providers/ics/calICSCalendar.js</span>
<a href="#l6.2"></a><span id="l6.2" class="difflineplus">+++ b/calendar/providers/ics/calICSCalendar.js</span>
<a href="#l6.3"></a><span id="l6.3" class="difflineat">@@ -101,22 +101,22 @@ calICSCalendar.prototype = {</span>
<a href="#l6.4"></a><span id="l6.4"> </span>
<a href="#l6.5"></a><span id="l6.5">     get uri() { return this.mUri; },</span>
<a href="#l6.6"></a><span id="l6.6">     set uri(aUri) {</span>
<a href="#l6.7"></a><span id="l6.7">         this.mUri = aUri;</span>
<a href="#l6.8"></a><span id="l6.8">         this.mMemoryCalendar.uri = this.mUri;</span>
<a href="#l6.9"></a><span id="l6.9"> </span>
<a href="#l6.10"></a><span id="l6.10">         // Use the ioservice, to create a channel, which makes finding the</span>
<a href="#l6.11"></a><span id="l6.11">         // right hooks to use easier.</span>
<a href="#l6.12"></a><span id="l6.12" class="difflineminus">-        let channel = Services.io.newChannelFromURI2(this.mUri,</span>
<a href="#l6.13"></a><span id="l6.13" class="difflineminus">-                                                     null,</span>
<a href="#l6.14"></a><span id="l6.14" class="difflineminus">-                                                     Services.scriptSecurityManager.getSystemPrincipal(),</span>
<a href="#l6.15"></a><span id="l6.15" class="difflineminus">-                                                     null,</span>
<a href="#l6.16"></a><span id="l6.16" class="difflineminus">-                                                     Ci.nsILoadInfo.SEC_ALLOW_CROSS_ORIGIN_DATA_IS_NULL,</span>
<a href="#l6.17"></a><span id="l6.17" class="difflineminus">-                                                     Ci.nsIContentPolicy.TYPE_OTHER);</span>
<a href="#l6.18"></a><span id="l6.18" class="difflineplus">+        let channel = Services.io.newChannelFromURI(this.mUri,</span>
<a href="#l6.19"></a><span id="l6.19" class="difflineplus">+                                                    null,</span>
<a href="#l6.20"></a><span id="l6.20" class="difflineplus">+                                                    Services.scriptSecurityManager.getSystemPrincipal(),</span>
<a href="#l6.21"></a><span id="l6.21" class="difflineplus">+                                                    null,</span>
<a href="#l6.22"></a><span id="l6.22" class="difflineplus">+                                                    Ci.nsILoadInfo.SEC_ALLOW_CROSS_ORIGIN_DATA_IS_NULL,</span>
<a href="#l6.23"></a><span id="l6.23" class="difflineplus">+                                                    Ci.nsIContentPolicy.TYPE_OTHER);</span>
<a href="#l6.24"></a><span id="l6.24">         let wHttpChannel = cal.wrapInstance(channel, Ci.nsIHttpChannel);</span>
<a href="#l6.25"></a><span id="l6.25">         let wFileChannel = cal.wrapInstance(channel, Ci.nsIFileChannel);</span>
<a href="#l6.26"></a><span id="l6.26"> </span>
<a href="#l6.27"></a><span id="l6.27">         if (wHttpChannel) {</span>
<a href="#l6.28"></a><span id="l6.28">             this.mHooks = new httpHooks(this);</span>
<a href="#l6.29"></a><span id="l6.29">         } else if (wFileChannel) {</span>
<a href="#l6.30"></a><span id="l6.30">             this.mHooks = new fileHooks(this);</span>
<a href="#l6.31"></a><span id="l6.31">         } else {</span>
<a href="#l6.32"></a><span id="l6.32" class="difflineat">@@ -163,22 +163,22 @@ calICSCalendar.prototype = {</span>
<a href="#l6.33"></a><span id="l6.33">         this.mMemoryCalendar.superCalendar = this;</span>
<a href="#l6.34"></a><span id="l6.34">     },</span>
<a href="#l6.35"></a><span id="l6.35"> </span>
<a href="#l6.36"></a><span id="l6.36">     doRefresh: function(aForce) {</span>
<a href="#l6.37"></a><span id="l6.37">         let prbForce = Cc[&quot;@mozilla.org/supports-PRBool;1&quot;]</span>
<a href="#l6.38"></a><span id="l6.38">                          .createInstance(Ci.nsISupportsPRBool);</span>
<a href="#l6.39"></a><span id="l6.39">         prbForce.data = aForce;</span>
<a href="#l6.40"></a><span id="l6.40"> </span>
<a href="#l6.41"></a><span id="l6.41" class="difflineminus">-        let channel = Services.io.newChannelFromURI2(this.mUri,</span>
<a href="#l6.42"></a><span id="l6.42" class="difflineminus">-                                                     null,</span>
<a href="#l6.43"></a><span id="l6.43" class="difflineminus">-                                                     Services.scriptSecurityManager.getSystemPrincipal(),</span>
<a href="#l6.44"></a><span id="l6.44" class="difflineminus">-                                                     null,</span>
<a href="#l6.45"></a><span id="l6.45" class="difflineminus">-                                                     Ci.nsILoadInfo.SEC_ALLOW_CROSS_ORIGIN_DATA_IS_NULL,</span>
<a href="#l6.46"></a><span id="l6.46" class="difflineminus">-                                                     Ci.nsIContentPolicy.TYPE_OTHER);</span>
<a href="#l6.47"></a><span id="l6.47" class="difflineplus">+        let channel = Services.io.newChannelFromURI(this.mUri,</span>
<a href="#l6.48"></a><span id="l6.48" class="difflineplus">+                                                    null,</span>
<a href="#l6.49"></a><span id="l6.49" class="difflineplus">+                                                    Services.scriptSecurityManager.getSystemPrincipal(),</span>
<a href="#l6.50"></a><span id="l6.50" class="difflineplus">+                                                    null,</span>
<a href="#l6.51"></a><span id="l6.51" class="difflineplus">+                                                    Ci.nsILoadInfo.SEC_ALLOW_CROSS_ORIGIN_DATA_IS_NULL,</span>
<a href="#l6.52"></a><span id="l6.52" class="difflineplus">+                                                    Ci.nsIContentPolicy.TYPE_OTHER);</span>
<a href="#l6.53"></a><span id="l6.53">         this.prepareChannel(channel, aForce);</span>
<a href="#l6.54"></a><span id="l6.54"> </span>
<a href="#l6.55"></a><span id="l6.55">         let streamLoader = Cc[&quot;@mozilla.org/network/stream-loader;1&quot;]</span>
<a href="#l6.56"></a><span id="l6.56">                              .createInstance(Ci.nsIStreamLoader);</span>
<a href="#l6.57"></a><span id="l6.57"> </span>
<a href="#l6.58"></a><span id="l6.58">         // Lock other changes to the item list.</span>
<a href="#l6.59"></a><span id="l6.59">         this.lock();</span>
<a href="#l6.60"></a><span id="l6.60"> </span>
<a href="#l6.61"></a><span id="l6.61" class="difflineat">@@ -306,22 +306,22 @@ calICSCalendar.prototype = {</span>
<a href="#l6.62"></a><span id="l6.62">             serializer: null,</span>
<a href="#l6.63"></a><span id="l6.63">             QueryInterface: ChromeUtils.generateQI([Ci.calIOperationListener]),</span>
<a href="#l6.64"></a><span id="l6.64">             onOperationComplete: function(aCalendar, aStatus, aOperationType, aId, aDetail) {</span>
<a href="#l6.65"></a><span id="l6.65">                 let inLastWindowClosingSurvivalArea = false;</span>
<a href="#l6.66"></a><span id="l6.66">                 try {</span>
<a href="#l6.67"></a><span id="l6.67">                     // All events are returned. Now set up a channel and a</span>
<a href="#l6.68"></a><span id="l6.68">                     // streamloader to upload.  onStopRequest will be called</span>
<a href="#l6.69"></a><span id="l6.69">                     // once the write has finished</span>
<a href="#l6.70"></a><span id="l6.70" class="difflineminus">-                    let channel = Services.io.newChannelFromURI2(self.mUri,</span>
<a href="#l6.71"></a><span id="l6.71" class="difflineminus">-                                                                 null,</span>
<a href="#l6.72"></a><span id="l6.72" class="difflineminus">-                                                                 Services.scriptSecurityManager.getSystemPrincipal(),</span>
<a href="#l6.73"></a><span id="l6.73" class="difflineminus">-                                                                 null,</span>
<a href="#l6.74"></a><span id="l6.74" class="difflineminus">-                                                                 Ci.nsILoadInfo.SEC_ALLOW_CROSS_ORIGIN_DATA_IS_NULL,</span>
<a href="#l6.75"></a><span id="l6.75" class="difflineminus">-                                                                 Ci.nsIContentPolicy.TYPE_OTHER);</span>
<a href="#l6.76"></a><span id="l6.76" class="difflineplus">+                    let channel = Services.io.newChannelFromURI(self.mUri,</span>
<a href="#l6.77"></a><span id="l6.77" class="difflineplus">+                                                                null,</span>
<a href="#l6.78"></a><span id="l6.78" class="difflineplus">+                                                                Services.scriptSecurityManager.getSystemPrincipal(),</span>
<a href="#l6.79"></a><span id="l6.79" class="difflineplus">+                                                                null,</span>
<a href="#l6.80"></a><span id="l6.80" class="difflineplus">+                                                                Ci.nsILoadInfo.SEC_ALLOW_CROSS_ORIGIN_DATA_IS_NULL,</span>
<a href="#l6.81"></a><span id="l6.81" class="difflineplus">+                                                                Ci.nsIContentPolicy.TYPE_OTHER);</span>
<a href="#l6.82"></a><span id="l6.82"> </span>
<a href="#l6.83"></a><span id="l6.83">                     // Allow the hook to add things to the channel, like a</span>
<a href="#l6.84"></a><span id="l6.84">                     // header that checks etags</span>
<a href="#l6.85"></a><span id="l6.85">                     let notChanged = self.mHooks.onBeforePut(channel);</span>
<a href="#l6.86"></a><span id="l6.86">                     if (notChanged) {</span>
<a href="#l6.87"></a><span id="l6.87">                         channel.notificationCallbacks = self;</span>
<a href="#l6.88"></a><span id="l6.88">                         let uploadChannel = channel.QueryInterface(Ci.nsIUploadChannel);</span>
<a href="#l6.89"></a><span id="l6.89"> </span>
<a href="#l6.90"></a><span id="l6.90" class="difflineat">@@ -769,22 +769,22 @@ calICSCalendar.prototype = {</span>
<a href="#l6.91"></a><span id="l6.91"> </span>
<a href="#l6.92"></a><span id="l6.92">         let backupFile = backupDir.clone();</span>
<a href="#l6.93"></a><span id="l6.93">         backupFile.append(makeName(&quot;edit&quot;));</span>
<a href="#l6.94"></a><span id="l6.94">         backupFile.createUnique(Ci.nsIFile.NORMAL_FILE_TYPE, parseInt(&quot;0600&quot;, 8));</span>
<a href="#l6.95"></a><span id="l6.95"> </span>
<a href="#l6.96"></a><span id="l6.96">         purgeOldBackups();</span>
<a href="#l6.97"></a><span id="l6.97"> </span>
<a href="#l6.98"></a><span id="l6.98">         // Now go download the remote file, and store it somewhere local.</span>
<a href="#l6.99"></a><span id="l6.99" class="difflineminus">-        let channel = Services.io.newChannelFromURI2(this.mUri,</span>
<a href="#l6.100"></a><span id="l6.100" class="difflineminus">-                                                     null,</span>
<a href="#l6.101"></a><span id="l6.101" class="difflineminus">-                                                     Services.scriptSecurityManager.getSystemPrincipal(),</span>
<a href="#l6.102"></a><span id="l6.102" class="difflineminus">-                                                     null,</span>
<a href="#l6.103"></a><span id="l6.103" class="difflineminus">-                                                     Ci.nsILoadInfo.SEC_ALLOW_CROSS_ORIGIN_DATA_IS_NULL,</span>
<a href="#l6.104"></a><span id="l6.104" class="difflineminus">-                                                     Ci.nsIContentPolicy.TYPE_OTHER);</span>
<a href="#l6.105"></a><span id="l6.105" class="difflineplus">+        let channel = Services.io.newChannelFromURI(this.mUri,</span>
<a href="#l6.106"></a><span id="l6.106" class="difflineplus">+                                                    null,</span>
<a href="#l6.107"></a><span id="l6.107" class="difflineplus">+                                                    Services.scriptSecurityManager.getSystemPrincipal(),</span>
<a href="#l6.108"></a><span id="l6.108" class="difflineplus">+                                                    null,</span>
<a href="#l6.109"></a><span id="l6.109" class="difflineplus">+                                                    Ci.nsILoadInfo.SEC_ALLOW_CROSS_ORIGIN_DATA_IS_NULL,</span>
<a href="#l6.110"></a><span id="l6.110" class="difflineplus">+                                                    Ci.nsIContentPolicy.TYPE_OTHER);</span>
<a href="#l6.111"></a><span id="l6.111">         channel.loadFlags |= Ci.nsIRequest.LOAD_BYPASS_CACHE;</span>
<a href="#l6.112"></a><span id="l6.112">         channel.notificationCallbacks = this;</span>
<a href="#l6.113"></a><span id="l6.113"> </span>
<a href="#l6.114"></a><span id="l6.114">         let downloader = Cc[&quot;@mozilla.org/network/downloader;1&quot;]</span>
<a href="#l6.115"></a><span id="l6.115">                            .createInstance(Ci.nsIDownloader);</span>
<a href="#l6.116"></a><span id="l6.116"> </span>
<a href="#l6.117"></a><span id="l6.117">         let self = this;</span>
<a href="#l6.118"></a><span id="l6.118">         let listener = {</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l7.1"></a><span id="l7.1" class="difflineminus">--- a/calendar/providers/wcap/calWcapRequest.js</span>
<a href="#l7.2"></a><span id="l7.2" class="difflineplus">+++ b/calendar/providers/wcap/calWcapRequest.js</span>
<a href="#l7.3"></a><span id="l7.3" class="difflineat">@@ -374,22 +374,22 @@ calWcapNetworkRequest.prototype = {</span>
<a href="#l7.4"></a><span id="l7.4"> </span>
<a href="#l7.5"></a><span id="l7.5"> function issueNetworkRequest(parentRequest, respFunc, url, bLogging) {</span>
<a href="#l7.6"></a><span id="l7.6">     let netRequest = new calWcapNetworkRequest(url, respFunc, bLogging);</span>
<a href="#l7.7"></a><span id="l7.7">     if (parentRequest) {</span>
<a href="#l7.8"></a><span id="l7.8">         parentRequest.attachSubRequest(netRequest);</span>
<a href="#l7.9"></a><span id="l7.9">     }</span>
<a href="#l7.10"></a><span id="l7.10">     try {</span>
<a href="#l7.11"></a><span id="l7.11">         let uri = Services.io.newURI(url);</span>
<a href="#l7.12"></a><span id="l7.12" class="difflineminus">-        let channel = Services.io.newChannelFromURI2(uri,</span>
<a href="#l7.13"></a><span id="l7.13" class="difflineminus">-                                                     null,</span>
<a href="#l7.14"></a><span id="l7.14" class="difflineminus">-                                                     Services.scriptSecurityManager.getSystemPrincipal(),</span>
<a href="#l7.15"></a><span id="l7.15" class="difflineminus">-                                                     null,</span>
<a href="#l7.16"></a><span id="l7.16" class="difflineminus">-                                                     Ci.nsILoadInfo.SEC_ALLOW_CROSS_ORIGIN_DATA_IS_NULL,</span>
<a href="#l7.17"></a><span id="l7.17" class="difflineminus">-                                                     Ci.nsIContentPolicy.TYPE_OTHER);</span>
<a href="#l7.18"></a><span id="l7.18" class="difflineplus">+        let channel = Services.io.newChannelFromURI(uri,</span>
<a href="#l7.19"></a><span id="l7.19" class="difflineplus">+                                                    null,</span>
<a href="#l7.20"></a><span id="l7.20" class="difflineplus">+                                                    Services.scriptSecurityManager.getSystemPrincipal(),</span>
<a href="#l7.21"></a><span id="l7.21" class="difflineplus">+                                                    null,</span>
<a href="#l7.22"></a><span id="l7.22" class="difflineplus">+                                                    Ci.nsILoadInfo.SEC_ALLOW_CROSS_ORIGIN_DATA_IS_NULL,</span>
<a href="#l7.23"></a><span id="l7.23" class="difflineplus">+                                                    Ci.nsIContentPolicy.TYPE_OTHER);</span>
<a href="#l7.24"></a><span id="l7.24">         netRequest.prepareChannel(channel);</span>
<a href="#l7.25"></a><span id="l7.25">         channel = channel.QueryInterface(Ci.nsIHttpChannel);</span>
<a href="#l7.26"></a><span id="l7.26">         channel.redirectionLimit = 3;</span>
<a href="#l7.27"></a><span id="l7.27">         channel.notificationCallbacks = netRequest;</span>
<a href="#l7.28"></a><span id="l7.28">         let loader = cal.provider.createStreamLoader();</span>
<a href="#l7.29"></a><span id="l7.29">         netRequest.m_loader = loader;</span>
<a href="#l7.30"></a><span id="l7.30"> </span>
<a href="#l7.31"></a><span id="l7.31">         log(&quot;opening channel.&quot;, netRequest);</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l8.1"></a><span id="l8.1" class="difflineminus">--- a/calendar/resources/content/publish.js</span>
<a href="#l8.2"></a><span id="l8.2" class="difflineplus">+++ b/calendar/resources/content/publish.js</span>
<a href="#l8.3"></a><span id="l8.3" class="difflineat">@@ -117,22 +117,22 @@ function publishEntireCalendarDialogResp</span>
<a href="#l8.4"></a><span id="l8.4"> </span>
<a href="#l8.5"></a><span id="l8.5"> function publishItemArray(aItemArray, aPath, aProgressDialog) {</span>
<a href="#l8.6"></a><span id="l8.6">     let outputStream;</span>
<a href="#l8.7"></a><span id="l8.7">     let inputStream;</span>
<a href="#l8.8"></a><span id="l8.8">     let storageStream;</span>
<a href="#l8.9"></a><span id="l8.9"> </span>
<a href="#l8.10"></a><span id="l8.10">     let icsURL = Services.io.newURI(aPath);</span>
<a href="#l8.11"></a><span id="l8.11"> </span>
<a href="#l8.12"></a><span id="l8.12" class="difflineminus">-    let channel = Services.io.newChannelFromURI2(icsURL,</span>
<a href="#l8.13"></a><span id="l8.13" class="difflineminus">-                                                 null,</span>
<a href="#l8.14"></a><span id="l8.14" class="difflineminus">-                                                 Services.scriptSecurityManager.getSystemPrincipal(),</span>
<a href="#l8.15"></a><span id="l8.15" class="difflineminus">-                                                 null,</span>
<a href="#l8.16"></a><span id="l8.16" class="difflineminus">-                                                 Ci.nsILoadInfo.SEC_ALLOW_CROSS_ORIGIN_DATA_IS_NULL,</span>
<a href="#l8.17"></a><span id="l8.17" class="difflineminus">-                                                 Ci.nsIContentPolicy.TYPE_OTHER);</span>
<a href="#l8.18"></a><span id="l8.18" class="difflineplus">+    let channel = Services.io.newChannelFromURI(icsURL,</span>
<a href="#l8.19"></a><span id="l8.19" class="difflineplus">+                                                null,</span>
<a href="#l8.20"></a><span id="l8.20" class="difflineplus">+                                                Services.scriptSecurityManager.getSystemPrincipal(),</span>
<a href="#l8.21"></a><span id="l8.21" class="difflineplus">+                                                null,</span>
<a href="#l8.22"></a><span id="l8.22" class="difflineplus">+                                                Ci.nsILoadInfo.SEC_ALLOW_CROSS_ORIGIN_DATA_IS_NULL,</span>
<a href="#l8.23"></a><span id="l8.23" class="difflineplus">+                                                Ci.nsIContentPolicy.TYPE_OTHER);</span>
<a href="#l8.24"></a><span id="l8.24">     if (icsURL.schemeIs(&quot;webcal&quot;)) {</span>
<a href="#l8.25"></a><span id="l8.25">         icsURL.scheme = &quot;http&quot;;</span>
<a href="#l8.26"></a><span id="l8.26">     }</span>
<a href="#l8.27"></a><span id="l8.27">     if (icsURL.schemeIs(&quot;webcals&quot;)) {</span>
<a href="#l8.28"></a><span id="l8.28">         icsURL.scheme = &quot;https&quot;;</span>
<a href="#l8.29"></a><span id="l8.29">     }</span>
<a href="#l8.30"></a><span id="l8.30"> </span>
<a href="#l8.31"></a><span id="l8.31">     switch (icsURL.scheme) {</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l9.1"></a><span id="l9.1" class="difflineminus">--- a/calendar/test/unit/test_webcal.js</span>
<a href="#l9.2"></a><span id="l9.2" class="difflineplus">+++ b/calendar/test/unit/test_webcal.js</span>
<a href="#l9.3"></a><span id="l9.3" class="difflineat">@@ -24,20 +24,20 @@ function run_test() {</span>
<a href="#l9.4"></a><span id="l9.4"> </span>
<a href="#l9.5"></a><span id="l9.5">     // Now lets go...</span>
<a href="#l9.6"></a><span id="l9.6">     run_next_test();</span>
<a href="#l9.7"></a><span id="l9.7"> }</span>
<a href="#l9.8"></a><span id="l9.8"> </span>
<a href="#l9.9"></a><span id="l9.9"> function check_webcal_uri(aUri) {</span>
<a href="#l9.10"></a><span id="l9.10">     let uri = Services.io.newURI(aUri);</span>
<a href="#l9.11"></a><span id="l9.11"> </span>
<a href="#l9.12"></a><span id="l9.12" class="difflineminus">-    let channel = Services.io.newChannelFromURI2(uri,</span>
<a href="#l9.13"></a><span id="l9.13" class="difflineminus">-                                                 null,</span>
<a href="#l9.14"></a><span id="l9.14" class="difflineminus">-                                                 Services.scriptSecurityManager.getSystemPrincipal(),</span>
<a href="#l9.15"></a><span id="l9.15" class="difflineminus">-                                                 null,</span>
<a href="#l9.16"></a><span id="l9.16" class="difflineminus">-                                                 Ci.nsILoadInfo.SEC_ALLOW_CROSS_ORIGIN_DATA_IS_NULL,</span>
<a href="#l9.17"></a><span id="l9.17" class="difflineminus">-                                                 Ci.nsIContentPolicy.TYPE_OTHER);</span>
<a href="#l9.18"></a><span id="l9.18" class="difflineplus">+    let channel = Services.io.newChannelFromURI(uri,</span>
<a href="#l9.19"></a><span id="l9.19" class="difflineplus">+                                                null,</span>
<a href="#l9.20"></a><span id="l9.20" class="difflineplus">+                                                Services.scriptSecurityManager.getSystemPrincipal(),</span>
<a href="#l9.21"></a><span id="l9.21" class="difflineplus">+                                                null,</span>
<a href="#l9.22"></a><span id="l9.22" class="difflineplus">+                                                Ci.nsILoadInfo.SEC_ALLOW_CROSS_ORIGIN_DATA_IS_NULL,</span>
<a href="#l9.23"></a><span id="l9.23" class="difflineplus">+                                                Ci.nsIContentPolicy.TYPE_OTHER);</span>
<a href="#l9.24"></a><span id="l9.24"> </span>
<a href="#l9.25"></a><span id="l9.25">     NetUtil.asyncFetch(channel, (data, status, request) =&gt; {</span>
<a href="#l9.26"></a><span id="l9.26">         ok(Components.isSuccessCode(status));</span>
<a href="#l9.27"></a><span id="l9.27">         run_next_test();</span>
<a href="#l9.28"></a><span id="l9.28">     });</span>
<a href="#l9.29"></a><span id="l9.29"> }</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l10.1"></a><span id="l10.1" class="difflineminus">--- a/mail/base/content/msgHdrView.js</span>
<a href="#l10.2"></a><span id="l10.2" class="difflineplus">+++ b/mail/base/content/msgHdrView.js</span>
<a href="#l10.3"></a><span id="l10.3" class="difflineat">@@ -1829,22 +1829,22 @@ AttachmentInfo.prototype = {</span>
<a href="#l10.4"></a><span id="l10.4">   /**</span>
<a href="#l10.5"></a><span id="l10.5">    * This method checks whether the attachment is empty or not.</span>
<a href="#l10.6"></a><span id="l10.6">    *</span>
<a href="#l10.7"></a><span id="l10.7">    * @return  true if the attachment is empty, false otherwise</span>
<a href="#l10.8"></a><span id="l10.8">    */</span>
<a href="#l10.9"></a><span id="l10.9">   get isEmpty() {</span>
<a href="#l10.10"></a><span id="l10.10">     // Create an input stream on the attachment url.</span>
<a href="#l10.11"></a><span id="l10.11">     let url = Services.io.newURI(this.url);</span>
<a href="#l10.12"></a><span id="l10.12" class="difflineminus">-    let channel = Services.io.newChannelFromURI2(url,</span>
<a href="#l10.13"></a><span id="l10.13" class="difflineminus">-                                                 null,</span>
<a href="#l10.14"></a><span id="l10.14" class="difflineminus">-                                                 Services.scriptSecurityManager.getSystemPrincipal(),</span>
<a href="#l10.15"></a><span id="l10.15" class="difflineminus">-                                                 null,</span>
<a href="#l10.16"></a><span id="l10.16" class="difflineminus">-                                                 Ci.nsILoadInfo.SEC_ALLOW_CROSS_ORIGIN_DATA_IS_NULL,</span>
<a href="#l10.17"></a><span id="l10.17" class="difflineminus">-                                                 Ci.nsIContentPolicy.TYPE_OTHER);</span>
<a href="#l10.18"></a><span id="l10.18" class="difflineplus">+    let channel = Services.io.newChannelFromURI(url,</span>
<a href="#l10.19"></a><span id="l10.19" class="difflineplus">+                                                null,</span>
<a href="#l10.20"></a><span id="l10.20" class="difflineplus">+                                                Services.scriptSecurityManager.getSystemPrincipal(),</span>
<a href="#l10.21"></a><span id="l10.21" class="difflineplus">+                                                null,</span>
<a href="#l10.22"></a><span id="l10.22" class="difflineplus">+                                                Ci.nsILoadInfo.SEC_ALLOW_CROSS_ORIGIN_DATA_IS_NULL,</span>
<a href="#l10.23"></a><span id="l10.23" class="difflineplus">+                                                Ci.nsIContentPolicy.TYPE_OTHER);</span>
<a href="#l10.24"></a><span id="l10.24">     let stream = channel.open();</span>
<a href="#l10.25"></a><span id="l10.25"> </span>
<a href="#l10.26"></a><span id="l10.26">     let inputStream = Cc[&quot;@mozilla.org/binaryinputstream;1&quot;]</span>
<a href="#l10.27"></a><span id="l10.27">                         .createInstance(Ci.nsIBinaryInputStream);</span>
<a href="#l10.28"></a><span id="l10.28">     inputStream.setInputStream(stream);</span>
<a href="#l10.29"></a><span id="l10.29"> </span>
<a href="#l10.30"></a><span id="l10.30">     let bytesAvailable = 0;</span>
<a href="#l10.31"></a><span id="l10.31"> </span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l11.1"></a><span id="l11.1" class="difflineminus">--- a/mail/components/accountcreation/content/util.js</span>
<a href="#l11.2"></a><span id="l11.2" class="difflineplus">+++ b/mail/components/accountcreation/content/util.js</span>
<a href="#l11.3"></a><span id="l11.3" class="difflineat">@@ -49,22 +49,22 @@ function makeNSIURI(uriStr) {</span>
<a href="#l11.4"></a><span id="l11.4">  * Reads UTF8 data from a URL.</span>
<a href="#l11.5"></a><span id="l11.5">  *</span>
<a href="#l11.6"></a><span id="l11.6">  * @param uri {nsIURI}   what you want to read</span>
<a href="#l11.7"></a><span id="l11.7">  * @return {Array of String}   the contents of the file, one string per line</span>
<a href="#l11.8"></a><span id="l11.8">  */</span>
<a href="#l11.9"></a><span id="l11.9"> function readURLasUTF8(uri) {</span>
<a href="#l11.10"></a><span id="l11.10">   assert(uri instanceof Ci.nsIURI, &quot;uri must be an nsIURI&quot;);</span>
<a href="#l11.11"></a><span id="l11.11">   try {</span>
<a href="#l11.12"></a><span id="l11.12" class="difflineminus">-    let chan = Services.io.newChannelFromURI2(uri,</span>
<a href="#l11.13"></a><span id="l11.13" class="difflineminus">-                                              null,</span>
<a href="#l11.14"></a><span id="l11.14" class="difflineminus">-                                              Services.scriptSecurityManager.getSystemPrincipal(),</span>
<a href="#l11.15"></a><span id="l11.15" class="difflineminus">-                                              null,</span>
<a href="#l11.16"></a><span id="l11.16" class="difflineminus">-                                              Ci.nsILoadInfo.SEC_ALLOW_CROSS_ORIGIN_DATA_IS_NULL,</span>
<a href="#l11.17"></a><span id="l11.17" class="difflineminus">-                                              Ci.nsIContentPolicy.TYPE_OTHER);</span>
<a href="#l11.18"></a><span id="l11.18" class="difflineplus">+    let chan = Services.io.newChannelFromURI(uri,</span>
<a href="#l11.19"></a><span id="l11.19" class="difflineplus">+                                             null,</span>
<a href="#l11.20"></a><span id="l11.20" class="difflineplus">+                                             Services.scriptSecurityManager.getSystemPrincipal(),</span>
<a href="#l11.21"></a><span id="l11.21" class="difflineplus">+                                             null,</span>
<a href="#l11.22"></a><span id="l11.22" class="difflineplus">+                                             Ci.nsILoadInfo.SEC_ALLOW_CROSS_ORIGIN_DATA_IS_NULL,</span>
<a href="#l11.23"></a><span id="l11.23" class="difflineplus">+                                             Ci.nsIContentPolicy.TYPE_OTHER);</span>
<a href="#l11.24"></a><span id="l11.24">     let is = Cc[&quot;@mozilla.org/intl/converter-input-stream;1&quot;]</span>
<a href="#l11.25"></a><span id="l11.25">              .createInstance(Ci.nsIConverterInputStream);</span>
<a href="#l11.26"></a><span id="l11.26">     is.init(chan.open(), &quot;UTF-8&quot;, 1024,</span>
<a href="#l11.27"></a><span id="l11.27">             Ci.nsIConverterInputStream.DEFAULT_REPLACEMENT_CHARACTER);</span>
<a href="#l11.28"></a><span id="l11.28"> </span>
<a href="#l11.29"></a><span id="l11.29">     let content = &quot;&quot;;</span>
<a href="#l11.30"></a><span id="l11.30">     let strOut = {};</span>
<a href="#l11.31"></a><span id="l11.31">     try {</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l12.1"></a><span id="l12.1" class="difflineminus">--- a/mail/components/compose/content/MsgComposeCommands.js</span>
<a href="#l12.2"></a><span id="l12.2" class="difflineplus">+++ b/mail/components/compose/content/MsgComposeCommands.js</span>
<a href="#l12.3"></a><span id="l12.3" class="difflineat">@@ -5311,22 +5311,22 @@ function OpenSelectedAttachment() {</span>
<a href="#l12.4"></a><span id="l12.4">       // we must be dealing with a forwarded attachment, treat this special</span>
<a href="#l12.5"></a><span id="l12.5">       let msgHdr = gMessenger.messageServiceFromURI(attachmentUrl).messageURIToMsgHdr(attachmentUrl);</span>
<a href="#l12.6"></a><span id="l12.6">       if (msgHdr)</span>
<a href="#l12.7"></a><span id="l12.7">         MailUtils.openMessageInNewWindow(msgHdr);</span>
<a href="#l12.8"></a><span id="l12.8">     } else {</span>
<a href="#l12.9"></a><span id="l12.9">       // Turn the URL into a nsIURI object then open it.</span>
<a href="#l12.10"></a><span id="l12.10">       let uri = Services.io.newURI(attachmentUrl);</span>
<a href="#l12.11"></a><span id="l12.11">       if (uri) {</span>
<a href="#l12.12"></a><span id="l12.12" class="difflineminus">-        let channel = Services.io.newChannelFromURI2(uri,</span>
<a href="#l12.13"></a><span id="l12.13" class="difflineminus">-                                                     null,</span>
<a href="#l12.14"></a><span id="l12.14" class="difflineminus">-                                                     Services.scriptSecurityManager.getSystemPrincipal(),</span>
<a href="#l12.15"></a><span id="l12.15" class="difflineminus">-                                                     null,</span>
<a href="#l12.16"></a><span id="l12.16" class="difflineminus">-                                                     Ci.nsILoadInfo.SEC_ALLOW_CROSS_ORIGIN_DATA_IS_NULL,</span>
<a href="#l12.17"></a><span id="l12.17" class="difflineminus">-                                                     Ci.nsIContentPolicy.TYPE_OTHER);</span>
<a href="#l12.18"></a><span id="l12.18" class="difflineplus">+        let channel = Services.io.newChannelFromURI(uri,</span>
<a href="#l12.19"></a><span id="l12.19" class="difflineplus">+                                                    null,</span>
<a href="#l12.20"></a><span id="l12.20" class="difflineplus">+                                                    Services.scriptSecurityManager.getSystemPrincipal(),</span>
<a href="#l12.21"></a><span id="l12.21" class="difflineplus">+                                                    null,</span>
<a href="#l12.22"></a><span id="l12.22" class="difflineplus">+                                                    Ci.nsILoadInfo.SEC_ALLOW_CROSS_ORIGIN_DATA_IS_NULL,</span>
<a href="#l12.23"></a><span id="l12.23" class="difflineplus">+                                                    Ci.nsIContentPolicy.TYPE_OTHER);</span>
<a href="#l12.24"></a><span id="l12.24">         if (channel) {</span>
<a href="#l12.25"></a><span id="l12.25">           let uriLoader = Cc[&quot;@mozilla.org/uriloader;1&quot;].getService(Ci.nsIURILoader);</span>
<a href="#l12.26"></a><span id="l12.26">           uriLoader.openURI(channel, true, new nsAttachmentOpener());</span>
<a href="#l12.27"></a><span id="l12.27">         }</span>
<a href="#l12.28"></a><span id="l12.28">       }</span>
<a href="#l12.29"></a><span id="l12.29">     }</span>
<a href="#l12.30"></a><span id="l12.30">   } // if one attachment selected</span>
<a href="#l12.31"></a><span id="l12.31"> }</span>
<a href="#l12.32"></a><span id="l12.32" class="difflineat">@@ -6907,17 +6907,17 @@ function loadBlockedImage(aURL, aReturnD</span>
<a href="#l12.33"></a><span id="l12.33">       // Unsafe to unblock this. It would just be garbage either way.</span>
<a href="#l12.34"></a><span id="l12.34">       throw new Error(&quot;Won't unblock; URL=&quot; + aURL +</span>
<a href="#l12.35"></a><span id="l12.35">                       &quot;, contentType=&quot; + contentType);</span>
<a href="#l12.36"></a><span id="l12.36">     }</span>
<a href="#l12.37"></a><span id="l12.37">   } else {</span>
<a href="#l12.38"></a><span id="l12.38">     // Assuming image/png is the best we can do.</span>
<a href="#l12.39"></a><span id="l12.39">     contentType = &quot;image/png&quot;;</span>
<a href="#l12.40"></a><span id="l12.40">   }</span>
<a href="#l12.41"></a><span id="l12.41" class="difflineminus">-  let channel = Services.io.newChannelFromURI2(uri,</span>
<a href="#l12.42"></a><span id="l12.42" class="difflineplus">+  let channel = Services.io.newChannelFromURI(uri,</span>
<a href="#l12.43"></a><span id="l12.43">     null,</span>
<a href="#l12.44"></a><span id="l12.44">     Services.scriptSecurityManager.getSystemPrincipal(),</span>
<a href="#l12.45"></a><span id="l12.45">     null,</span>
<a href="#l12.46"></a><span id="l12.46">     Ci.nsILoadInfo.SEC_ALLOW_CROSS_ORIGIN_DATA_IS_NULL,</span>
<a href="#l12.47"></a><span id="l12.47">     Ci.nsIContentPolicy.TYPE_OTHER);</span>
<a href="#l12.48"></a><span id="l12.48">   let inputStream = channel.open();</span>
<a href="#l12.49"></a><span id="l12.49">   let stream = Cc[&quot;@mozilla.org/binaryinputstream;1&quot;]</span>
<a href="#l12.50"></a><span id="l12.50">     .createInstance(Ci.nsIBinaryInputStream);</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l13.1"></a><span id="l13.1" class="difflineminus">--- a/mail/components/nsMailDefaultHandler.js</span>
<a href="#l13.2"></a><span id="l13.2" class="difflineplus">+++ b/mail/components/nsMailDefaultHandler.js</span>
<a href="#l13.3"></a><span id="l13.3" class="difflineat">@@ -61,22 +61,22 @@ function mayOpenURI(uri) {</span>
<a href="#l13.4"></a><span id="l13.4"> </span>
<a href="#l13.5"></a><span id="l13.5">   return ext.isExposedProtocol(uri.scheme);</span>
<a href="#l13.6"></a><span id="l13.6"> }</span>
<a href="#l13.7"></a><span id="l13.7"> </span>
<a href="#l13.8"></a><span id="l13.8"> function openURI(uri) {</span>
<a href="#l13.9"></a><span id="l13.9">   if (!mayOpenURI(uri))</span>
<a href="#l13.10"></a><span id="l13.10">     throw Cr.NS_ERROR_FAILURE;</span>
<a href="#l13.11"></a><span id="l13.11"> </span>
<a href="#l13.12"></a><span id="l13.12" class="difflineminus">-  var channel = Services.io.newChannelFromURI2(uri,</span>
<a href="#l13.13"></a><span id="l13.13" class="difflineminus">-                                               null,</span>
<a href="#l13.14"></a><span id="l13.14" class="difflineminus">-                                               Services.scriptSecurityManager.getSystemPrincipal(),</span>
<a href="#l13.15"></a><span id="l13.15" class="difflineminus">-                                               null,</span>
<a href="#l13.16"></a><span id="l13.16" class="difflineminus">-                                               Ci.nsILoadInfo.SEC_ALLOW_CROSS_ORIGIN_DATA_IS_NULL,</span>
<a href="#l13.17"></a><span id="l13.17" class="difflineminus">-                                               Ci.nsIContentPolicy.TYPE_OTHER);</span>
<a href="#l13.18"></a><span id="l13.18" class="difflineplus">+  var channel = Services.io.newChannelFromURI(uri,</span>
<a href="#l13.19"></a><span id="l13.19" class="difflineplus">+                                              null,</span>
<a href="#l13.20"></a><span id="l13.20" class="difflineplus">+                                              Services.scriptSecurityManager.getSystemPrincipal(),</span>
<a href="#l13.21"></a><span id="l13.21" class="difflineplus">+                                              null,</span>
<a href="#l13.22"></a><span id="l13.22" class="difflineplus">+                                              Ci.nsILoadInfo.SEC_ALLOW_CROSS_ORIGIN_DATA_IS_NULL,</span>
<a href="#l13.23"></a><span id="l13.23" class="difflineplus">+                                              Ci.nsIContentPolicy.TYPE_OTHER);</span>
<a href="#l13.24"></a><span id="l13.24">   var loader = Cc[&quot;@mozilla.org/uriloader;1&quot;]</span>
<a href="#l13.25"></a><span id="l13.25">                  .getService(Ci.nsIURILoader);</span>
<a href="#l13.26"></a><span id="l13.26"> </span>
<a href="#l13.27"></a><span id="l13.27">   // We cannot load a URI on startup asynchronously without protecting</span>
<a href="#l13.28"></a><span id="l13.28">   // the startup</span>
<a href="#l13.29"></a><span id="l13.29"> </span>
<a href="#l13.30"></a><span id="l13.30">   var loadgroup = Cc[&quot;@mozilla.org/network/load-group;1&quot;]</span>
<a href="#l13.31"></a><span id="l13.31">                     .createInstance(Ci.nsILoadGroup);</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l14.1"></a><span id="l14.1" class="difflineminus">--- a/mail/test/resources/mozmill/mozmill/extension/content/stdlib/securable-module.jsm</span>
<a href="#l14.2"></a><span id="l14.2" class="difflineplus">+++ b/mail/test/resources/mozmill/mozmill/extension/content/stdlib/securable-module.jsm</span>
<a href="#l14.3"></a><span id="l14.3" class="difflineat">@@ -298,17 +298,17 @@</span>
<a href="#l14.4"></a><span id="l14.4">        path = path + &quot;.js&quot;;</span>
<a href="#l14.5"></a><span id="l14.5"> </span>
<a href="#l14.6"></a><span id="l14.6">        var baseURI;</span>
<a href="#l14.7"></a><span id="l14.7">        if (!base)</span>
<a href="#l14.8"></a><span id="l14.8">          baseURI = this._rootURI;</span>
<a href="#l14.9"></a><span id="l14.9">        else</span>
<a href="#l14.10"></a><span id="l14.10">          baseURI = Services.io.newURI(base);</span>
<a href="#l14.11"></a><span id="l14.11">        var newURI = Services.io.newURI(path, null, baseURI);</span>
<a href="#l14.12"></a><span id="l14.12" class="difflineminus">-       var channel = Services.io.newChannelFromURI2(newURI,</span>
<a href="#l14.13"></a><span id="l14.13" class="difflineplus">+       var channel = Services.io.newChannelFromURI(newURI,</span>
<a href="#l14.14"></a><span id="l14.14">                                             null,</span>
<a href="#l14.15"></a><span id="l14.15">                                             Services.scriptSecurityManager.getSystemPrincipal(),</span>
<a href="#l14.16"></a><span id="l14.16">                                             null,</span>
<a href="#l14.17"></a><span id="l14.17">                                             Ci.nsILoadInfo.SEC_ALLOW_CROSS_ORIGIN_DATA_IS_NULL,</span>
<a href="#l14.18"></a><span id="l14.18">                                             Ci.nsIContentPolicy.TYPE_OTHER);</span>
<a href="#l14.19"></a><span id="l14.19">        try {</span>
<a href="#l14.20"></a><span id="l14.20">          channel.open().close();</span>
<a href="#l14.21"></a><span id="l14.21">        } catch (e) {</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l15.1"></a><span id="l15.1" class="difflineminus">--- a/mailnews/compose/src/nsMsgQuote.cpp</span>
<a href="#l15.2"></a><span id="l15.2" class="difflineplus">+++ b/mailnews/compose/src/nsMsgQuote.cpp</span>
<a href="#l15.3"></a><span id="l15.3" class="difflineat">@@ -166,23 +166,23 @@ nsMsgQuote::QuoteMessage(const char *msg</span>
<a href="#l15.4"></a><span id="l15.4">   QueryInterface(NS_GET_IID(nsISupports), (void **) &amp;supports);</span>
<a href="#l15.5"></a><span id="l15.5">   nsCOMPtr&lt;nsISupports&gt; quoteSupport = supports;</span>
<a href="#l15.6"></a><span id="l15.6">   NS_IF_RELEASE(supports);</span>
<a href="#l15.7"></a><span id="l15.7"> </span>
<a href="#l15.8"></a><span id="l15.8">   // now we want to create a necko channel for this url and we want to open it</span>
<a href="#l15.9"></a><span id="l15.9">   mQuoteChannel = nullptr;</span>
<a href="#l15.10"></a><span id="l15.10">   nsCOMPtr&lt;nsIIOService&gt; netService = mozilla::services::GetIOService();</span>
<a href="#l15.11"></a><span id="l15.11">   NS_ENSURE_TRUE(netService, NS_ERROR_UNEXPECTED);</span>
<a href="#l15.12"></a><span id="l15.12" class="difflineminus">-  rv = netService-&gt;NewChannelFromURI2(newURI,</span>
<a href="#l15.13"></a><span id="l15.13" class="difflineminus">-                                      nullptr,</span>
<a href="#l15.14"></a><span id="l15.14" class="difflineminus">-                                      nsContentUtils::GetSystemPrincipal(),</span>
<a href="#l15.15"></a><span id="l15.15" class="difflineminus">-                                      nullptr,</span>
<a href="#l15.16"></a><span id="l15.16" class="difflineminus">-                                      nsILoadInfo::SEC_ALLOW_CROSS_ORIGIN_DATA_IS_NULL,</span>
<a href="#l15.17"></a><span id="l15.17" class="difflineminus">-                                      nsIContentPolicy::TYPE_OTHER,</span>
<a href="#l15.18"></a><span id="l15.18" class="difflineminus">-                                      getter_AddRefs(mQuoteChannel));</span>
<a href="#l15.19"></a><span id="l15.19" class="difflineplus">+  rv = netService-&gt;NewChannelFromURI(newURI,</span>
<a href="#l15.20"></a><span id="l15.20" class="difflineplus">+                                     nullptr,</span>
<a href="#l15.21"></a><span id="l15.21" class="difflineplus">+                                     nsContentUtils::GetSystemPrincipal(),</span>
<a href="#l15.22"></a><span id="l15.22" class="difflineplus">+                                     nullptr,</span>
<a href="#l15.23"></a><span id="l15.23" class="difflineplus">+                                     nsILoadInfo::SEC_ALLOW_CROSS_ORIGIN_DATA_IS_NULL,</span>
<a href="#l15.24"></a><span id="l15.24" class="difflineplus">+                                     nsIContentPolicy::TYPE_OTHER,</span>
<a href="#l15.25"></a><span id="l15.25" class="difflineplus">+                                     getter_AddRefs(mQuoteChannel));</span>
<a href="#l15.26"></a><span id="l15.26"> </span>
<a href="#l15.27"></a><span id="l15.27">   if (NS_FAILED(rv)) return rv;</span>
<a href="#l15.28"></a><span id="l15.28"> </span>
<a href="#l15.29"></a><span id="l15.29">   nsCOMPtr&lt;nsIStreamConverterService&gt; streamConverterService =</span>
<a href="#l15.30"></a><span id="l15.30">            do_GetService(&quot;@mozilla.org/streamConverters;1&quot;, &amp;rv);</span>
<a href="#l15.31"></a><span id="l15.31">   NS_ENSURE_SUCCESS(rv,rv);</span>
<a href="#l15.32"></a><span id="l15.32"> </span>
<a href="#l15.33"></a><span id="l15.33">   nsCOMPtr&lt;nsIStreamListener&gt; convertedListener;</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l16.1"></a><span id="l16.1" class="difflineminus">--- a/mailnews/extensions/bayesian-spam-filter/test/unit/resources/trainingfile.js</span>
<a href="#l16.2"></a><span id="l16.2" class="difflineplus">+++ b/mailnews/extensions/bayesian-spam-filter/test/unit/resources/trainingfile.js</span>
<a href="#l16.3"></a><span id="l16.3" class="difflineat">@@ -37,22 +37,22 @@ function TrainingData() {</span>
<a href="#l16.4"></a><span id="l16.4">   }</span>
<a href="#l16.5"></a><span id="l16.5"> </span>
<a href="#l16.6"></a><span id="l16.6">   function getBinStream(oFile) {</span>
<a href="#l16.7"></a><span id="l16.7"> </span>
<a href="#l16.8"></a><span id="l16.8">     if (oFile &amp;&amp; oFile.exists())</span>
<a href="#l16.9"></a><span id="l16.9">     {</span>
<a href="#l16.10"></a><span id="l16.10">       var oUri = Services.io.newFileURI(oFile);</span>
<a href="#l16.11"></a><span id="l16.11">       // open stream (channel)</span>
<a href="#l16.12"></a><span id="l16.12" class="difflineminus">-      let channel = Services.io.newChannelFromURI2(oUri,</span>
<a href="#l16.13"></a><span id="l16.13" class="difflineminus">-                                                   null,</span>
<a href="#l16.14"></a><span id="l16.14" class="difflineminus">-                                                   Services.scriptSecurityManager.getSystemPrincipal(),</span>
<a href="#l16.15"></a><span id="l16.15" class="difflineminus">-                                                   null,</span>
<a href="#l16.16"></a><span id="l16.16" class="difflineminus">-                                                   Ci.nsILoadInfo.SEC_ALLOW_CROSS_ORIGIN_DATA_IS_NULL,</span>
<a href="#l16.17"></a><span id="l16.17" class="difflineminus">-                                                   Ci.nsIContentPolicy.TYPE_OTHER);</span>
<a href="#l16.18"></a><span id="l16.18" class="difflineplus">+      let channel = Services.io.newChannelFromURI(oUri,</span>
<a href="#l16.19"></a><span id="l16.19" class="difflineplus">+                                                  null,</span>
<a href="#l16.20"></a><span id="l16.20" class="difflineplus">+                                                  Services.scriptSecurityManager.getSystemPrincipal(),</span>
<a href="#l16.21"></a><span id="l16.21" class="difflineplus">+                                                  null,</span>
<a href="#l16.22"></a><span id="l16.22" class="difflineplus">+                                                  Ci.nsILoadInfo.SEC_ALLOW_CROSS_ORIGIN_DATA_IS_NULL,</span>
<a href="#l16.23"></a><span id="l16.23" class="difflineplus">+                                                  Ci.nsIContentPolicy.TYPE_OTHER);</span>
<a href="#l16.24"></a><span id="l16.24">       var oStream = channel.open();</span>
<a href="#l16.25"></a><span id="l16.25">       // buffer it</span>
<a href="#l16.26"></a><span id="l16.26">       var oBufStream = Cc[&quot;@mozilla.org/network/buffered-input-stream;1&quot;].</span>
<a href="#l16.27"></a><span id="l16.27">         createInstance(Ci.nsIBufferedInputStream);</span>
<a href="#l16.28"></a><span id="l16.28">       oBufStream.init(oStream, oFile.fileSize);</span>
<a href="#l16.29"></a><span id="l16.29">       // read as binary</span>
<a href="#l16.30"></a><span id="l16.30">       var oBinStream = Cc[&quot;@mozilla.org/binaryinputstream;1&quot;].</span>
<a href="#l16.31"></a><span id="l16.31">         createInstance(Ci.nsIBinaryInputStream);</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l17.1"></a><span id="l17.1" class="difflineminus">--- a/mailnews/imap/test/unit/test_chunkLastLF.js</span>
<a href="#l17.2"></a><span id="l17.2" class="difflineplus">+++ b/mailnews/imap/test/unit/test_chunkLastLF.js</span>
<a href="#l17.3"></a><span id="l17.3" class="difflineat">@@ -65,44 +65,44 @@ function* verifyContentLength()</span>
<a href="#l17.4"></a><span id="l17.4">   let imapS = Cc[&quot;@mozilla.org/messenger/messageservice;1?type=imap&quot;]</span>
<a href="#l17.5"></a><span id="l17.5">                 .getService(Ci.nsIMsgMessageService);</span>
<a href="#l17.6"></a><span id="l17.6"> </span>
<a href="#l17.7"></a><span id="l17.7">   dump(&quot;getting uri\n&quot;);</span>
<a href="#l17.8"></a><span id="l17.8">   let uri = {};</span>
<a href="#l17.9"></a><span id="l17.9">   imapS.GetUrlForUri(&quot;imap-message://user@localhost/INBOX#1&quot;, uri, null);</span>
<a href="#l17.10"></a><span id="l17.10"> </span>
<a href="#l17.11"></a><span id="l17.11">   // Get a channel from this URI, and check its content length</span>
<a href="#l17.12"></a><span id="l17.12" class="difflineminus">-  let channel = Services.io.newChannelFromURI2(uri.value,</span>
<a href="#l17.13"></a><span id="l17.13" class="difflineminus">-                                               null,</span>
<a href="#l17.14"></a><span id="l17.14" class="difflineminus">-                                               Services.scriptSecurityManager.getSystemPrincipal(),</span>
<a href="#l17.15"></a><span id="l17.15" class="difflineminus">-                                               null,</span>
<a href="#l17.16"></a><span id="l17.16" class="difflineminus">-                                               Ci.nsILoadInfo.SEC_ALLOW_CROSS_ORIGIN_DATA_IS_NULL,</span>
<a href="#l17.17"></a><span id="l17.17" class="difflineminus">-                                               Ci.nsIContentPolicy.TYPE_OTHER);</span>
<a href="#l17.18"></a><span id="l17.18" class="difflineplus">+  let channel = Services.io.newChannelFromURI(uri.value,</span>
<a href="#l17.19"></a><span id="l17.19" class="difflineplus">+                                              null,</span>
<a href="#l17.20"></a><span id="l17.20" class="difflineplus">+                                              Services.scriptSecurityManager.getSystemPrincipal(),</span>
<a href="#l17.21"></a><span id="l17.21" class="difflineplus">+                                              null,</span>
<a href="#l17.22"></a><span id="l17.22" class="difflineplus">+                                              Ci.nsILoadInfo.SEC_ALLOW_CROSS_ORIGIN_DATA_IS_NULL,</span>
<a href="#l17.23"></a><span id="l17.23" class="difflineplus">+                                              Ci.nsIContentPolicy.TYPE_OTHER);</span>
<a href="#l17.24"></a><span id="l17.24"> </span>
<a href="#l17.25"></a><span id="l17.25">   dump(channel + &quot;\n&quot;);</span>
<a href="#l17.26"></a><span id="l17.26"> </span>
<a href="#l17.27"></a><span id="l17.27">   // Read all the contents</span>
<a href="#l17.28"></a><span id="l17.28">   channel.asyncOpen(gStreamListener, null);</span>
<a href="#l17.29"></a><span id="l17.29">   yield false;</span>
<a href="#l17.30"></a><span id="l17.30">   // Now check whether our stream listener got the right bytes</span>
<a href="#l17.31"></a><span id="l17.31">   // First, clean up line endings to avoid CRLF vs. LF differences</span>
<a href="#l17.32"></a><span id="l17.32">   let origData = IOUtils.loadFileToString(gFile).replace(/\r\n/g, &quot;\n&quot;);</span>
<a href="#l17.33"></a><span id="l17.33">   let streamData = gStreamListener._data.replace(/\r\n/g, &quot;\n&quot;);</span>
<a href="#l17.34"></a><span id="l17.34">   Assert.equal(origData.length, streamData.length);</span>
<a href="#l17.35"></a><span id="l17.35">   Assert.equal(origData, streamData);</span>
<a href="#l17.36"></a><span id="l17.36"> </span>
<a href="#l17.37"></a><span id="l17.37">   // Now try an attachment. &amp;part=1.2</span>
<a href="#l17.38"></a><span id="l17.38">   // let attachmentURL = Services.io.newURI(neckoURL.value.spec + &quot;&amp;part=1.2&quot;,</span>
<a href="#l17.39"></a><span id="l17.39">   //                                        null, null);</span>
<a href="#l17.40"></a><span id="l17.40" class="difflineminus">-  // let attachmentChannel = Services.io.newChannelFromURI2(attachmentURL,</span>
<a href="#l17.41"></a><span id="l17.41" class="difflineminus">-  //                                                        null,</span>
<a href="#l17.42"></a><span id="l17.42" class="difflineminus">-  //                                                        Services.scriptSecurityManager.getSystemPrincipal(),</span>
<a href="#l17.43"></a><span id="l17.43" class="difflineminus">-  //                                                        null,</span>
<a href="#l17.44"></a><span id="l17.44" class="difflineminus">-  //                                                        Ci.nsILoadInfo.SEC_ALLOW_CROSS_ORIGIN_DATA_IS_NULL,</span>
<a href="#l17.45"></a><span id="l17.45" class="difflineminus">-  //                                                        Ci.nsIContentPolicy.TYPE_OTHER);</span>
<a href="#l17.46"></a><span id="l17.46" class="difflineplus">+  // let attachmentChannel = Services.io.newChannelFromURI(attachmentURL,</span>
<a href="#l17.47"></a><span id="l17.47" class="difflineplus">+  //                                                       null,</span>
<a href="#l17.48"></a><span id="l17.48" class="difflineplus">+  //                                                       Services.scriptSecurityManager.getSystemPrincipal(),</span>
<a href="#l17.49"></a><span id="l17.49" class="difflineplus">+  //                                                       null,</span>
<a href="#l17.50"></a><span id="l17.50" class="difflineplus">+  //                                                       Ci.nsILoadInfo.SEC_ALLOW_CROSS_ORIGIN_DATA_IS_NULL,</span>
<a href="#l17.51"></a><span id="l17.51" class="difflineplus">+  //                                                       Ci.nsIContentPolicy.TYPE_OTHER);</span>
<a href="#l17.52"></a><span id="l17.52">   // Currently attachments have their content length set to the length of the</span>
<a href="#l17.53"></a><span id="l17.53">   // entire message</span>
<a href="#l17.54"></a><span id="l17.54">   // do_check_eq(attachmentChannel.contentLength, gFile.fileSize);</span>
<a href="#l17.55"></a><span id="l17.55"> </span>
<a href="#l17.56"></a><span id="l17.56">   yield true;</span>
<a href="#l17.57"></a><span id="l17.57"> }</span>
<a href="#l17.58"></a><span id="l17.58"> </span>
<a href="#l17.59"></a><span id="l17.59"> function* endTest()</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l18.1"></a><span id="l18.1" class="difflineminus">--- a/mailnews/imap/test/unit/test_dod.js</span>
<a href="#l18.2"></a><span id="l18.2" class="difflineplus">+++ b/mailnews/imap/test/unit/test_dod.js</span>
<a href="#l18.3"></a><span id="l18.3" class="difflineat">@@ -75,22 +75,22 @@ function* streamMessages() {</span>
<a href="#l18.4"></a><span id="l18.4">     if (isPlain)</span>
<a href="#l18.5"></a><span id="l18.5">       marker = &quot;thisplaintextneedstodisplaytopasstest&quot;;</span>
<a href="#l18.6"></a><span id="l18.6">     else</span>
<a href="#l18.7"></a><span id="l18.7">       marker = &quot;thishtmltextneedstodisplaytopasstest&quot;;</span>
<a href="#l18.8"></a><span id="l18.8"> </span>
<a href="#l18.9"></a><span id="l18.9">     for (let i = 1; i &lt; inbox.uidnext ; i++) {</span>
<a href="#l18.10"></a><span id="l18.10">       let uri = {};</span>
<a href="#l18.11"></a><span id="l18.11">       imapS.GetUrlForUri(&quot;imap-message://user@localhost/INBOX#&quot; + i, uri, null);</span>
<a href="#l18.12"></a><span id="l18.12" class="difflineminus">-      let channel = Services.io.newChannelFromURI2(uri.value,</span>
<a href="#l18.13"></a><span id="l18.13" class="difflineminus">-                                                   null,</span>
<a href="#l18.14"></a><span id="l18.14" class="difflineminus">-                                                   Services.scriptSecurityManager.getSystemPrincipal(),</span>
<a href="#l18.15"></a><span id="l18.15" class="difflineminus">-                                                   null,</span>
<a href="#l18.16"></a><span id="l18.16" class="difflineminus">-                                                   Ci.nsILoadInfo.SEC_ALLOW_CROSS_ORIGIN_DATA_IS_NULL,</span>
<a href="#l18.17"></a><span id="l18.17" class="difflineminus">-                                                   Ci.nsIContentPolicy.TYPE_OTHER);</span>
<a href="#l18.18"></a><span id="l18.18" class="difflineplus">+      let channel = Services.io.newChannelFromURI(uri.value,</span>
<a href="#l18.19"></a><span id="l18.19" class="difflineplus">+                                                  null,</span>
<a href="#l18.20"></a><span id="l18.20" class="difflineplus">+                                                  Services.scriptSecurityManager.getSystemPrincipal(),</span>
<a href="#l18.21"></a><span id="l18.21" class="difflineplus">+                                                  null,</span>
<a href="#l18.22"></a><span id="l18.22" class="difflineplus">+                                                  Ci.nsILoadInfo.SEC_ALLOW_CROSS_ORIGIN_DATA_IS_NULL,</span>
<a href="#l18.23"></a><span id="l18.23" class="difflineplus">+                                                  Ci.nsIContentPolicy.TYPE_OTHER);</span>
<a href="#l18.24"></a><span id="l18.24">       channel.asyncOpen(gStreamListener, null);</span>
<a href="#l18.25"></a><span id="l18.25">       yield false;</span>
<a href="#l18.26"></a><span id="l18.26">       let buf = gStreamListener._data;</span>
<a href="#l18.27"></a><span id="l18.27">       dump(&quot;##########\nTesting---&gt;&quot; + fileNames[i-1] +</span>
<a href="#l18.28"></a><span id="l18.28">            &quot;; 'prefer plain text': &quot; + isPlain + &quot;\n&quot; +</span>
<a href="#l18.29"></a><span id="l18.29">            buf + &quot;\n&quot; +</span>
<a href="#l18.30"></a><span id="l18.30">            &quot;##########\nTesting---&gt;&quot; + fileNames[i-1] +</span>
<a href="#l18.31"></a><span id="l18.31">            &quot;; 'prefer plain text': &quot; + isPlain + &quot;\n&quot;);</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l19.1"></a><span id="l19.1" class="difflineminus">--- a/mailnews/imap/test/unit/test_imapContentLength.js</span>
<a href="#l19.2"></a><span id="l19.2" class="difflineplus">+++ b/mailnews/imap/test/unit/test_imapContentLength.js</span>
<a href="#l19.3"></a><span id="l19.3" class="difflineat">@@ -60,32 +60,32 @@ function verifyContentLength() {</span>
<a href="#l19.4"></a><span id="l19.4">   let neckoURL = {};</span>
<a href="#l19.5"></a><span id="l19.5">   let messageService = messenger.messageServiceFromURI(messageUri);</span>
<a href="#l19.6"></a><span id="l19.6">   messageService.GetUrlForUri(messageUri, neckoURL, null);</span>
<a href="#l19.7"></a><span id="l19.7">   // Don't use the necko URL directly. Instead, get the spec and create a new</span>
<a href="#l19.8"></a><span id="l19.8">   // URL using the IO service</span>
<a href="#l19.9"></a><span id="l19.9">   let urlToRun = Services.io.newURI(neckoURL.value.spec);</span>
<a href="#l19.10"></a><span id="l19.10"> </span>
<a href="#l19.11"></a><span id="l19.11">   // Get a channel from this URI, and check its content length</span>
<a href="#l19.12"></a><span id="l19.12" class="difflineminus">-  let channel = Services.io.newChannelFromURI2(urlToRun,</span>
<a href="#l19.13"></a><span id="l19.13" class="difflineminus">-                                               null,</span>
<a href="#l19.14"></a><span id="l19.14" class="difflineminus">-                                               Services.scriptSecurityManager.getSystemPrincipal(),</span>
<a href="#l19.15"></a><span id="l19.15" class="difflineminus">-                                               null,</span>
<a href="#l19.16"></a><span id="l19.16" class="difflineminus">-                                               Ci.nsILoadInfo.SEC_ALLOW_CROSS_ORIGIN_DATA_IS_NULL,</span>
<a href="#l19.17"></a><span id="l19.17" class="difflineminus">-                                               Ci.nsIContentPolicy.TYPE_OTHER);</span>
<a href="#l19.18"></a><span id="l19.18" class="difflineplus">+  let channel = Services.io.newChannelFromURI(urlToRun,</span>
<a href="#l19.19"></a><span id="l19.19" class="difflineplus">+                                              null,</span>
<a href="#l19.20"></a><span id="l19.20" class="difflineplus">+                                              Services.scriptSecurityManager.getSystemPrincipal(),</span>
<a href="#l19.21"></a><span id="l19.21" class="difflineplus">+                                              null,</span>
<a href="#l19.22"></a><span id="l19.22" class="difflineplus">+                                              Ci.nsILoadInfo.SEC_ALLOW_CROSS_ORIGIN_DATA_IS_NULL,</span>
<a href="#l19.23"></a><span id="l19.23" class="difflineplus">+                                              Ci.nsIContentPolicy.TYPE_OTHER);</span>
<a href="#l19.24"></a><span id="l19.24">   Assert.equal(channel.contentLength, gFile.fileSize);</span>
<a href="#l19.25"></a><span id="l19.25"> </span>
<a href="#l19.26"></a><span id="l19.26">   // Now try an attachment. &amp;part=1.2</span>
<a href="#l19.27"></a><span id="l19.27">   let attachmentURL = Services.io.newURI(neckoURL.value.spec + &quot;&amp;part=1.2&quot;);</span>
<a href="#l19.28"></a><span id="l19.28" class="difflineminus">-  let attachmentChannel = Services.io.newChannelFromURI2(attachmentURL,</span>
<a href="#l19.29"></a><span id="l19.29" class="difflineminus">-                                                         null,</span>
<a href="#l19.30"></a><span id="l19.30" class="difflineminus">-                                                         Services.scriptSecurityManager.getSystemPrincipal(),</span>
<a href="#l19.31"></a><span id="l19.31" class="difflineminus">-                                                         null,</span>
<a href="#l19.32"></a><span id="l19.32" class="difflineminus">-                                                         Ci.nsILoadInfo.SEC_ALLOW_CROSS_ORIGIN_DATA_IS_NULL,</span>
<a href="#l19.33"></a><span id="l19.33" class="difflineminus">-                                                         Ci.nsIContentPolicy.TYPE_OTHER);</span>
<a href="#l19.34"></a><span id="l19.34" class="difflineplus">+  let attachmentChannel = Services.io.newChannelFromURI(attachmentURL,</span>
<a href="#l19.35"></a><span id="l19.35" class="difflineplus">+                                                        null,</span>
<a href="#l19.36"></a><span id="l19.36" class="difflineplus">+                                                        Services.scriptSecurityManager.getSystemPrincipal(),</span>
<a href="#l19.37"></a><span id="l19.37" class="difflineplus">+                                                        null,</span>
<a href="#l19.38"></a><span id="l19.38" class="difflineplus">+                                                        Ci.nsILoadInfo.SEC_ALLOW_CROSS_ORIGIN_DATA_IS_NULL,</span>
<a href="#l19.39"></a><span id="l19.39" class="difflineplus">+                                                        Ci.nsIContentPolicy.TYPE_OTHER);</span>
<a href="#l19.40"></a><span id="l19.40">   // Currently attachments have their content length set to the length of the</span>
<a href="#l19.41"></a><span id="l19.41">   // entire message</span>
<a href="#l19.42"></a><span id="l19.42">   Assert.equal(attachmentChannel.contentLength, gFile.fileSize);</span>
<a href="#l19.43"></a><span id="l19.43"> }</span>
<a href="#l19.44"></a><span id="l19.44"> </span>
<a href="#l19.45"></a><span id="l19.45"> function teardown() {</span>
<a href="#l19.46"></a><span id="l19.46">   MailServices.mfn.removeListener(msgFolderListener);</span>
<a href="#l19.47"></a><span id="l19.47">   teardownIMAPPump();</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l20.1"></a><span id="l20.1" class="difflineminus">--- a/mailnews/local/test/unit/test_mailboxContentLength.js</span>
<a href="#l20.2"></a><span id="l20.2" class="difflineplus">+++ b/mailnews/local/test/unit/test_mailboxContentLength.js</span>
<a href="#l20.3"></a><span id="l20.3" class="difflineat">@@ -29,30 +29,30 @@ function verifyContentLength(aMessageHea</span>
<a href="#l20.4"></a><span id="l20.4">   let neckoURL = {};</span>
<a href="#l20.5"></a><span id="l20.5">   let messageService = messenger.messageServiceFromURI(messageUri);</span>
<a href="#l20.6"></a><span id="l20.6">   messageService.GetUrlForUri(messageUri, neckoURL, null);</span>
<a href="#l20.7"></a><span id="l20.7">   // Don't use the necko URL directly. Instead, get the spec and create a new</span>
<a href="#l20.8"></a><span id="l20.8">   // URL using the IO service</span>
<a href="#l20.9"></a><span id="l20.9">   let urlToRun = Services.io.newURI(neckoURL.value.spec);</span>
<a href="#l20.10"></a><span id="l20.10"> </span>
<a href="#l20.11"></a><span id="l20.11">   // Get a channel from this URI, and check its content length</span>
<a href="#l20.12"></a><span id="l20.12" class="difflineminus">-  let channel = Services.io.newChannelFromURI2(urlToRun,</span>
<a href="#l20.13"></a><span id="l20.13" class="difflineminus">-                                               null,</span>
<a href="#l20.14"></a><span id="l20.14" class="difflineminus">-                                               Services.scriptSecurityManager.getSystemPrincipal(),</span>
<a href="#l20.15"></a><span id="l20.15" class="difflineminus">-                                               null,</span>
<a href="#l20.16"></a><span id="l20.16" class="difflineminus">-                                               Ci.nsILoadInfo.SEC_ALLOW_CROSS_ORIGIN_DATA_IS_NULL,</span>
<a href="#l20.17"></a><span id="l20.17" class="difflineminus">-                                               Ci.nsIContentPolicy.TYPE_OTHER);</span>
<a href="#l20.18"></a><span id="l20.18" class="difflineplus">+  let channel = Services.io.newChannelFromURI(urlToRun,</span>
<a href="#l20.19"></a><span id="l20.19" class="difflineplus">+                                              null,</span>
<a href="#l20.20"></a><span id="l20.20" class="difflineplus">+                                              Services.scriptSecurityManager.getSystemPrincipal(),</span>
<a href="#l20.21"></a><span id="l20.21" class="difflineplus">+                                              null,</span>
<a href="#l20.22"></a><span id="l20.22" class="difflineplus">+                                              Ci.nsILoadInfo.SEC_ALLOW_CROSS_ORIGIN_DATA_IS_NULL,</span>
<a href="#l20.23"></a><span id="l20.23" class="difflineplus">+                                              Ci.nsIContentPolicy.TYPE_OTHER);</span>
<a href="#l20.24"></a><span id="l20.24">   Assert.equal(channel.contentLength, gFile.fileSize);</span>
<a href="#l20.25"></a><span id="l20.25"> </span>
<a href="#l20.26"></a><span id="l20.26">   // Now try an attachment. &amp;part=1.2</span>
<a href="#l20.27"></a><span id="l20.27">   let attachmentURL = Services.io.newURI(neckoURL.value.spec + &quot;&amp;part=1.2&quot;);</span>
<a href="#l20.28"></a><span id="l20.28" class="difflineminus">-  Services.io.newChannelFromURI2(attachmentURL,</span>
<a href="#l20.29"></a><span id="l20.29" class="difflineminus">-                                 null,</span>
<a href="#l20.30"></a><span id="l20.30" class="difflineminus">-                                 Services.scriptSecurityManager.getSystemPrincipal(),</span>
<a href="#l20.31"></a><span id="l20.31" class="difflineminus">-                                 null,</span>
<a href="#l20.32"></a><span id="l20.32" class="difflineminus">-                                 Ci.nsILoadInfo.SEC_ALLOW_CROSS_ORIGIN_DATA_IS_NULL,</span>
<a href="#l20.33"></a><span id="l20.33" class="difflineminus">-                                 Ci.nsIContentPolicy.TYPE_OTHER);</span>
<a href="#l20.34"></a><span id="l20.34" class="difflineplus">+  Services.io.newChannelFromURI(attachmentURL,</span>
<a href="#l20.35"></a><span id="l20.35" class="difflineplus">+                                null,</span>
<a href="#l20.36"></a><span id="l20.36" class="difflineplus">+                                Services.scriptSecurityManager.getSystemPrincipal(),</span>
<a href="#l20.37"></a><span id="l20.37" class="difflineplus">+                                null,</span>
<a href="#l20.38"></a><span id="l20.38" class="difflineplus">+                                Ci.nsILoadInfo.SEC_ALLOW_CROSS_ORIGIN_DATA_IS_NULL,</span>
<a href="#l20.39"></a><span id="l20.39" class="difflineplus">+                                Ci.nsIContentPolicy.TYPE_OTHER);</span>
<a href="#l20.40"></a><span id="l20.40">   // Currently attachments have their content length set to the length of the</span>
<a href="#l20.41"></a><span id="l20.41">   // entire message</span>
<a href="#l20.42"></a><span id="l20.42">   Assert.equal(channel.contentLength, gFile.fileSize);</span>
<a href="#l20.43"></a><span id="l20.43"> </span>
<a href="#l20.44"></a><span id="l20.44">   do_test_finished();</span>
<a href="#l20.45"></a><span id="l20.45"> }</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l21.1"></a><span id="l21.1" class="difflineminus">--- a/mailnews/news/test/unit/test_bug37465.js</span>
<a href="#l21.2"></a><span id="l21.2" class="difflineplus">+++ b/mailnews/news/test/unit/test_bug37465.js</span>
<a href="#l21.3"></a><span id="l21.3" class="difflineat">@@ -13,22 +13,22 @@ function run_test() {</span>
<a href="#l21.4"></a><span id="l21.4">   let newsUri = uri.QueryInterface(Ci.nsINntpUrl)</span>
<a href="#l21.5"></a><span id="l21.5">                    .QueryInterface(Ci.nsIMsgMailNewsUrl);</span>
<a href="#l21.6"></a><span id="l21.6">   Assert.equal(uri.port, server.port);</span>
<a href="#l21.7"></a><span id="l21.7">   Assert.equal(newsUri.server, null);</span>
<a href="#l21.8"></a><span id="l21.8">   Assert.equal(newsUri.messageID, &quot;1@regular.invalid&quot;);</span>
<a href="#l21.9"></a><span id="l21.9">   Assert.equal(newsUri.folder, null);</span>
<a href="#l21.10"></a><span id="l21.10"> </span>
<a href="#l21.11"></a><span id="l21.11">   // Run the URI and make sure we get the message</span>
<a href="#l21.12"></a><span id="l21.12" class="difflineminus">-  let channel = Services.io.newChannelFromURI2(uri,</span>
<a href="#l21.13"></a><span id="l21.13" class="difflineminus">-                                               null,</span>
<a href="#l21.14"></a><span id="l21.14" class="difflineminus">-                                               Services.scriptSecurityManager.getSystemPrincipal(),</span>
<a href="#l21.15"></a><span id="l21.15" class="difflineminus">-                                               null,</span>
<a href="#l21.16"></a><span id="l21.16" class="difflineminus">-                                               Ci.nsILoadInfo.SEC_ALLOW_CROSS_ORIGIN_DATA_IS_NULL,</span>
<a href="#l21.17"></a><span id="l21.17" class="difflineminus">-                                               Ci.nsIContentPolicy.TYPE_OTHER);</span>
<a href="#l21.18"></a><span id="l21.18" class="difflineplus">+  let channel = Services.io.newChannelFromURI(uri,</span>
<a href="#l21.19"></a><span id="l21.19" class="difflineplus">+                                              null,</span>
<a href="#l21.20"></a><span id="l21.20" class="difflineplus">+                                              Services.scriptSecurityManager.getSystemPrincipal(),</span>
<a href="#l21.21"></a><span id="l21.21" class="difflineplus">+                                              null,</span>
<a href="#l21.22"></a><span id="l21.22" class="difflineplus">+                                              Ci.nsILoadInfo.SEC_ALLOW_CROSS_ORIGIN_DATA_IS_NULL,</span>
<a href="#l21.23"></a><span id="l21.23" class="difflineplus">+                                              Ci.nsIContentPolicy.TYPE_OTHER);</span>
<a href="#l21.24"></a><span id="l21.24">   channel.asyncOpen(articleTextListener, null);</span>
<a href="#l21.25"></a><span id="l21.25"> </span>
<a href="#l21.26"></a><span id="l21.26">   // Run the server</span>
<a href="#l21.27"></a><span id="l21.27">   var thread = gThreadManager.currentThread;</span>
<a href="#l21.28"></a><span id="l21.28">   while (!articleTextListener.finished)</span>
<a href="#l21.29"></a><span id="l21.29">     thread.processNextEvent(true);</span>
<a href="#l21.30"></a><span id="l21.30"> </span>
<a href="#l21.31"></a><span id="l21.31">   Assert.equal(articleTextListener.data,</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l22.1"></a><span id="l22.1" class="difflineminus">--- a/mailnews/news/test/unit/test_nntpContentLength.js</span>
<a href="#l22.2"></a><span id="l22.2" class="difflineplus">+++ b/mailnews/news/test/unit/test_nntpContentLength.js</span>
<a href="#l22.3"></a><span id="l22.3" class="difflineat">@@ -44,33 +44,33 @@ function run_test() {</span>
<a href="#l22.4"></a><span id="l22.4">     let neckoURL = {};</span>
<a href="#l22.5"></a><span id="l22.5">     let messageService = messenger.messageServiceFromURI(messageUri);</span>
<a href="#l22.6"></a><span id="l22.6">     messageService.GetUrlForUri(messageUri, neckoURL, null);</span>
<a href="#l22.7"></a><span id="l22.7">     // Don't use the necko URL directly. Instead, get the spec and create a new</span>
<a href="#l22.8"></a><span id="l22.8">     // URL using the IO service</span>
<a href="#l22.9"></a><span id="l22.9">     let urlToRun = Services.io.newURI(neckoURL.value.spec);</span>
<a href="#l22.10"></a><span id="l22.10"> </span>
<a href="#l22.11"></a><span id="l22.11">     // Get a channel from this URI, and check its content length</span>
<a href="#l22.12"></a><span id="l22.12" class="difflineminus">-    let channel = Services.io.newChannelFromURI2(urlToRun,</span>
<a href="#l22.13"></a><span id="l22.13" class="difflineminus">-                                                 null,</span>
<a href="#l22.14"></a><span id="l22.14" class="difflineminus">-                                                 Services.scriptSecurityManager.getSystemPrincipal(),</span>
<a href="#l22.15"></a><span id="l22.15" class="difflineminus">-                                                 null,</span>
<a href="#l22.16"></a><span id="l22.16" class="difflineminus">-                                                 Ci.nsILoadInfo.SEC_ALLOW_CROSS_ORIGIN_DATA_IS_NULL,</span>
<a href="#l22.17"></a><span id="l22.17" class="difflineminus">-                                                 Ci.nsIContentPolicy.TYPE_OTHER);</span>
<a href="#l22.18"></a><span id="l22.18" class="difflineplus">+    let channel = Services.io.newChannelFromURI(urlToRun,</span>
<a href="#l22.19"></a><span id="l22.19" class="difflineplus">+                                                null,</span>
<a href="#l22.20"></a><span id="l22.20" class="difflineplus">+                                                Services.scriptSecurityManager.getSystemPrincipal(),</span>
<a href="#l22.21"></a><span id="l22.21" class="difflineplus">+                                                null,</span>
<a href="#l22.22"></a><span id="l22.22" class="difflineplus">+                                                Ci.nsILoadInfo.SEC_ALLOW_CROSS_ORIGIN_DATA_IS_NULL,</span>
<a href="#l22.23"></a><span id="l22.23" class="difflineplus">+                                                Ci.nsIContentPolicy.TYPE_OTHER);</span>
<a href="#l22.24"></a><span id="l22.24">     Assert.equal(channel.contentLength, kSimpleNewsArticle.length);</span>
<a href="#l22.25"></a><span id="l22.25"> </span>
<a href="#l22.26"></a><span id="l22.26">     // Now try an attachment. &amp;part=1.2</span>
<a href="#l22.27"></a><span id="l22.27">     // XXX the message doesn't really have an attachment</span>
<a href="#l22.28"></a><span id="l22.28">     let attachmentURL = Services.io.newURI(neckoURL.value.spec + &quot;&amp;part=1.2&quot;);</span>
<a href="#l22.29"></a><span id="l22.29" class="difflineminus">-    Services.io.newChannelFromURI2(attachmentURL,</span>
<a href="#l22.30"></a><span id="l22.30" class="difflineminus">-                                   null,</span>
<a href="#l22.31"></a><span id="l22.31" class="difflineminus">-                                   Services.scriptSecurityManager.getSystemPrincipal(),</span>
<a href="#l22.32"></a><span id="l22.32" class="difflineminus">-                                   null,</span>
<a href="#l22.33"></a><span id="l22.33" class="difflineminus">-                                   Ci.nsILoadInfo.SEC_ALLOW_CROSS_ORIGIN_DATA_IS_NULL,</span>
<a href="#l22.34"></a><span id="l22.34" class="difflineminus">-                                   Ci.nsIContentPolicy.TYPE_OTHER);</span>
<a href="#l22.35"></a><span id="l22.35" class="difflineplus">+    Services.io.newChannelFromURI(attachmentURL,</span>
<a href="#l22.36"></a><span id="l22.36" class="difflineplus">+                                  null,</span>
<a href="#l22.37"></a><span id="l22.37" class="difflineplus">+                                  Services.scriptSecurityManager.getSystemPrincipal(),</span>
<a href="#l22.38"></a><span id="l22.38" class="difflineplus">+                                  null,</span>
<a href="#l22.39"></a><span id="l22.39" class="difflineplus">+                                  Ci.nsILoadInfo.SEC_ALLOW_CROSS_ORIGIN_DATA_IS_NULL,</span>
<a href="#l22.40"></a><span id="l22.40" class="difflineplus">+                                  Ci.nsIContentPolicy.TYPE_OTHER);</span>
<a href="#l22.41"></a><span id="l22.41">     // Currently attachments have their content length set to the length of the</span>
<a href="#l22.42"></a><span id="l22.42">     // entire message</span>
<a href="#l22.43"></a><span id="l22.43">     Assert.equal(channel.contentLength, kSimpleNewsArticle.length);</span>
<a href="#l22.44"></a><span id="l22.44">   } catch (e) {</span>
<a href="#l22.45"></a><span id="l22.45">     server.stop();</span>
<a href="#l22.46"></a><span id="l22.46">     do_throw(e);</span>
<a href="#l22.47"></a><span id="l22.47">   }</span>
<a href="#l22.48"></a><span id="l22.48"> }</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l23.1"></a><span id="l23.1" class="difflineminus">--- a/suite/components/nsAbout.js</span>
<a href="#l23.2"></a><span id="l23.2" class="difflineplus">+++ b/suite/components/nsAbout.js</span>
<a href="#l23.3"></a><span id="l23.3" class="difflineat">@@ -46,21 +46,21 @@ About.prototype = {</span>
<a href="#l23.4"></a><span id="l23.4">     return this[this.getModule(aURI) + &quot;Flags&quot;];</span>
<a href="#l23.5"></a><span id="l23.5">   },</span>
<a href="#l23.6"></a><span id="l23.6"> </span>
<a href="#l23.7"></a><span id="l23.7">   newChannel: function(aURI, aLoadInfo) {</span>
<a href="#l23.8"></a><span id="l23.8">     var module = this.getModule(aURI);</span>
<a href="#l23.9"></a><span id="l23.9">     var newURI = Services.io.newURI(this[module + &quot;URI&quot;]);</span>
<a href="#l23.10"></a><span id="l23.10">     var channel = aLoadInfo ?</span>
<a href="#l23.11"></a><span id="l23.11">                   Services.io.newChannelFromURIWithLoadInfo(newURI, aLoadInfo) :</span>
<a href="#l23.12"></a><span id="l23.12" class="difflineminus">-                  Services.io.newChannelFromURI2(newURI, null,</span>
<a href="#l23.13"></a><span id="l23.13" class="difflineminus">-                                                 Services.scriptSecurityManager.getSystemPrincipal(),</span>
<a href="#l23.14"></a><span id="l23.14" class="difflineminus">-                                                 null,</span>
<a href="#l23.15"></a><span id="l23.15" class="difflineminus">-                                                 Ci.nsILoadInfo.SEC_ALLOW_CROSS_ORIGIN_DATA_IS_NULL,</span>
<a href="#l23.16"></a><span id="l23.16" class="difflineminus">-                                                 Ci.nsIContentPolicy.TYPE_OTHER);</span>
<a href="#l23.17"></a><span id="l23.17" class="difflineplus">+                  Services.io.newChannelFromURI(newURI, null,</span>
<a href="#l23.18"></a><span id="l23.18" class="difflineplus">+                                                Services.scriptSecurityManager.getSystemPrincipal(),</span>
<a href="#l23.19"></a><span id="l23.19" class="difflineplus">+                                                null,</span>
<a href="#l23.20"></a><span id="l23.20" class="difflineplus">+                                                Ci.nsILoadInfo.SEC_ALLOW_CROSS_ORIGIN_DATA_IS_NULL,</span>
<a href="#l23.21"></a><span id="l23.21" class="difflineplus">+                                                Ci.nsIContentPolicy.TYPE_OTHER);</span>
<a href="#l23.22"></a><span id="l23.22">     channel.originalURI = aURI;</span>
<a href="#l23.23"></a><span id="l23.23">     if (this[module + &quot;Flags&quot;] &amp; UNTRUSTED)</span>
<a href="#l23.24"></a><span id="l23.24">       channel.owner = null;</span>
<a href="#l23.25"></a><span id="l23.25">     return channel;</span>
<a href="#l23.26"></a><span id="l23.26">   },</span>
<a href="#l23.27"></a><span id="l23.27"> </span>
<a href="#l23.28"></a><span id="l23.28">   getIndexedDBOriginPostfix: function(aURI) {</span>
<a href="#l23.29"></a><span id="l23.29">     if (this.getURIFlags(aURI) &amp; INDEXEDDB) {</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l24.1"></a><span id="l24.1" class="difflineminus">--- a/suite/components/nsGopherProtocolStubHandler.js</span>
<a href="#l24.2"></a><span id="l24.2" class="difflineplus">+++ b/suite/components/nsGopherProtocolStubHandler.js</span>
<a href="#l24.3"></a><span id="l24.3" class="difflineat">@@ -46,21 +46,21 @@ GopherProtocol.prototype = {</span>
<a href="#l24.4"></a><span id="l24.4">     return this.newChannel2(inputURI, null);</span>
<a href="#l24.5"></a><span id="l24.5">   },</span>
<a href="#l24.6"></a><span id="l24.6"> </span>
<a href="#l24.7"></a><span id="l24.7">   newChannel2: function GP_newChannel2(inputURI, loadinfo) {</span>
<a href="#l24.8"></a><span id="l24.8">     var ios = Services.io;</span>
<a href="#l24.9"></a><span id="l24.9">     var newURI = ios.newURI(&quot;chrome://communicator/content/gopherAddon.xhtml&quot;);</span>
<a href="#l24.10"></a><span id="l24.10">     // Create a chrome channel, and de-chrome it, to our information page.</span>
<a href="#l24.11"></a><span id="l24.11">     var chan = loadinfo ? ios.newChannelFromURIWithLoadInfo(newURI, loadinfo) :</span>
<a href="#l24.12"></a><span id="l24.12" class="difflineminus">-                          ios.newChannelFromURI2(newURI, null,</span>
<a href="#l24.13"></a><span id="l24.13" class="difflineminus">-                                                 Services.scriptSecurityManager.getSystemPrincipal(),</span>
<a href="#l24.14"></a><span id="l24.14" class="difflineminus">-                                                 null,</span>
<a href="#l24.15"></a><span id="l24.15" class="difflineminus">-                                                 Ci.nsILoadInfo.SEC_ALLOW_CROSS_ORIGIN_DATA_IS_NULL,</span>
<a href="#l24.16"></a><span id="l24.16" class="difflineminus">-                                                 Ci.nsIContentPolicy.TYPE_OTHER);</span>
<a href="#l24.17"></a><span id="l24.17" class="difflineplus">+                          ios.newChannelFromURI(newURI, null,</span>
<a href="#l24.18"></a><span id="l24.18" class="difflineplus">+                                                Services.scriptSecurityManager.getSystemPrincipal(),</span>
<a href="#l24.19"></a><span id="l24.19" class="difflineplus">+                                                null,</span>
<a href="#l24.20"></a><span id="l24.20" class="difflineplus">+                                                Ci.nsILoadInfo.SEC_ALLOW_CROSS_ORIGIN_DATA_IS_NULL,</span>
<a href="#l24.21"></a><span id="l24.21" class="difflineplus">+                                                Ci.nsIContentPolicy.TYPE_OTHER);</span>
<a href="#l24.22"></a><span id="l24.22">     chan.originalURI = inputURI;</span>
<a href="#l24.23"></a><span id="l24.23">     chan.owner = Cc[&quot;@mozilla.org/scriptsecuritymanager;1&quot;]</span>
<a href="#l24.24"></a><span id="l24.24">                    .getService(Ci.nsIScriptSecurityManager)</span>
<a href="#l24.25"></a><span id="l24.25">                    .createCodebasePrincipal(inputURI, {});</span>
<a href="#l24.26"></a><span id="l24.26">     return chan;</span>
<a href="#l24.27"></a><span id="l24.27">   }</span>
<a href="#l24.28"></a><span id="l24.28"> };</span>
<a href="#l24.29"></a><span id="l24.29"> </span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l25.1"></a><span id="l25.1" class="difflineminus">--- a/suite/mailnews/components/addrbook/content/abCommon.js</span>
<a href="#l25.2"></a><span id="l25.2" class="difflineplus">+++ b/suite/mailnews/components/addrbook/content/abCommon.js</span>
<a href="#l25.3"></a><span id="l25.3" class="difflineat">@@ -707,17 +707,17 @@ function getPhotoURI(aPhotoName) {</span>
<a href="#l25.4"></a><span id="l25.4"> function storePhoto(aUri) {</span>
<a href="#l25.5"></a><span id="l25.5">   if (!aUri)</span>
<a href="#l25.6"></a><span id="l25.6">     return false;</span>
<a href="#l25.7"></a><span id="l25.7"> </span>
<a href="#l25.8"></a><span id="l25.8">   // Get the photos directory and check that it exists</span>
<a href="#l25.9"></a><span id="l25.9">   var file = getPhotosDir();</span>
<a href="#l25.10"></a><span id="l25.10"> </span>
<a href="#l25.11"></a><span id="l25.11">   // Create a channel from the URI and open it as an input stream</span>
<a href="#l25.12"></a><span id="l25.12" class="difflineminus">-  var channel = Services.io.newChannelFromURI2(Services.io.newURI(aUri),</span>
<a href="#l25.13"></a><span id="l25.13" class="difflineplus">+  var channel = Services.io.newChannelFromURI(Services.io.newURI(aUri),</span>
<a href="#l25.14"></a><span id="l25.14">                                          null,</span>
<a href="#l25.15"></a><span id="l25.15">                                          Services.scriptSecurityManager.getSystemPrincipal(),</span>
<a href="#l25.16"></a><span id="l25.16">                                          null,</span>
<a href="#l25.17"></a><span id="l25.17">                                          Ci.nsILoadInfo.SEC_ALLOW_CROSS_ORIGIN_DATA_IS_NULL,</span>
<a href="#l25.18"></a><span id="l25.18">                                          Ci.nsIContentPolicy.TYPE_INTERNAL_IMAGE);</span>
<a href="#l25.19"></a><span id="l25.19"> </span>
<a href="#l25.20"></a><span id="l25.20">   var istream = channel.open();</span>
<a href="#l25.21"></a><span id="l25.21"> </span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l26.1"></a><span id="l26.1" class="difflineminus">--- a/suite/mailnews/components/compose/content/MsgComposeCommands.js</span>
<a href="#l26.2"></a><span id="l26.2" class="difflineplus">+++ b/suite/mailnews/components/compose/content/MsgComposeCommands.js</span>
<a href="#l26.3"></a><span id="l26.3" class="difflineat">@@ -2662,22 +2662,22 @@ function OpenSelectedAttachment()</span>
<a href="#l26.4"></a><span id="l26.4">       let msgHdr = gMessenger.msgHdrFromURI(attachmentUrl);</span>
<a href="#l26.5"></a><span id="l26.5">       if (msgHdr) {</span>
<a href="#l26.6"></a><span id="l26.6">         MailUtils.openMessageInNewWindow(msgHdr);</span>
<a href="#l26.7"></a><span id="l26.7">       }</span>
<a href="#l26.8"></a><span id="l26.8">     } else {</span>
<a href="#l26.9"></a><span id="l26.9">       // Turn the URL into a nsIURI object then open it.</span>
<a href="#l26.10"></a><span id="l26.10">       let uri = Services.io.newURI(attachmentUrl);</span>
<a href="#l26.11"></a><span id="l26.11">       if (uri) {</span>
<a href="#l26.12"></a><span id="l26.12" class="difflineminus">-        let channel = Services.io.newChannelFromURI2(uri,</span>
<a href="#l26.13"></a><span id="l26.13" class="difflineminus">-                                                     null,</span>
<a href="#l26.14"></a><span id="l26.14" class="difflineminus">-                                                     Services.scriptSecurityManager.getSystemPrincipal(),</span>
<a href="#l26.15"></a><span id="l26.15" class="difflineminus">-                                                     null,</span>
<a href="#l26.16"></a><span id="l26.16" class="difflineminus">-                                                     Ci.nsILoadInfo.SEC_ALLOW_CROSS_ORIGIN_DATA_IS_NULL,</span>
<a href="#l26.17"></a><span id="l26.17" class="difflineminus">-                                                     Ci.nsIContentPolicy.TYPE_OTHER);</span>
<a href="#l26.18"></a><span id="l26.18" class="difflineplus">+        let channel = Services.io.newChannelFromURI(uri,</span>
<a href="#l26.19"></a><span id="l26.19" class="difflineplus">+                                                    null,</span>
<a href="#l26.20"></a><span id="l26.20" class="difflineplus">+                                                    Services.scriptSecurityManager.getSystemPrincipal(),</span>
<a href="#l26.21"></a><span id="l26.21" class="difflineplus">+                                                    null,</span>
<a href="#l26.22"></a><span id="l26.22" class="difflineplus">+                                                    Ci.nsILoadInfo.SEC_ALLOW_CROSS_ORIGIN_DATA_IS_NULL,</span>
<a href="#l26.23"></a><span id="l26.23" class="difflineplus">+                                                    Ci.nsIContentPolicy.TYPE_OTHER);</span>
<a href="#l26.24"></a><span id="l26.24">         if (channel) {</span>
<a href="#l26.25"></a><span id="l26.25">           let uriLoader = Cc[&quot;@mozilla.org/uriloader;1&quot;].getService(Ci.nsIURILoader);</span>
<a href="#l26.26"></a><span id="l26.26">           uriLoader.openURI(channel, true, new nsAttachmentOpener());</span>
<a href="#l26.27"></a><span id="l26.27">         }</span>
<a href="#l26.28"></a><span id="l26.28">       }</span>
<a href="#l26.29"></a><span id="l26.29">     }</span>
<a href="#l26.30"></a><span id="l26.30">   } // if one attachment selected</span>
<a href="#l26.31"></a><span id="l26.31"> }</span>
<a href="#l26.32"></a><span id="l26.32" class="difflineat">@@ -3627,17 +3627,17 @@ function loadBlockedImage(aURL, aReturnD</span>
<a href="#l26.33"></a><span id="l26.33">     }</span>
<a href="#l26.34"></a><span id="l26.34">   }</span>
<a href="#l26.35"></a><span id="l26.35">   else {</span>
<a href="#l26.36"></a><span id="l26.36">     // Assuming image/png is the best we can do.</span>
<a href="#l26.37"></a><span id="l26.37">     contentType = &quot;image/png&quot;;</span>
<a href="#l26.38"></a><span id="l26.38">   }</span>
<a href="#l26.39"></a><span id="l26.39"> </span>
<a href="#l26.40"></a><span id="l26.40">   let channel =</span>
<a href="#l26.41"></a><span id="l26.41" class="difflineminus">-    Services.io.newChannelFromURI2(uri,</span>
<a href="#l26.42"></a><span id="l26.42" class="difflineplus">+    Services.io.newChannelFromURI(uri,</span>
<a href="#l26.43"></a><span id="l26.43">       null,</span>
<a href="#l26.44"></a><span id="l26.44">       Services.scriptSecurityManager.getSystemPrincipal(),</span>
<a href="#l26.45"></a><span id="l26.45">       null,</span>
<a href="#l26.46"></a><span id="l26.46">       Ci.nsILoadInfo.SEC_ALLOW_CROSS_ORIGIN_DATA_IS_NULL,</span>
<a href="#l26.47"></a><span id="l26.47">       Ci.nsIContentPolicy.TYPE_OTHER);</span>
<a href="#l26.48"></a><span id="l26.48"> </span>
<a href="#l26.49"></a><span id="l26.49">   let inputStream = channel.open();</span>
<a href="#l26.50"></a><span id="l26.50">   let stream = Cc[&quot;@mozilla.org/binaryinputstream;1&quot;]</span></pre></div></div>

<div class="page_footer">
<div class="page_footer_text">comm-central</div>
<div class="page_footer_text" style="padding-left: 10px">Deployed from <a href="https://hg.mozilla.org/hgcustom/version-control-tools/rev/4b0de666d1a4">4b0de666d1a4</a> at 2020-07-30T19:32:33Z.</div>
<div class="rss_logo">
<a href="/comm-central/rss-log">RSS</a>
<a href="/comm-central/atom-log">Atom</a>
</div>
<br />

</div>
</body>
</html>

