<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en-US" lang="en-US">
<head>
<link rel="icon" href="/static/35f393d6769a/hgicon.png" type="image/png" />
<meta name="robots" content="index, nofollow"/>
<link rel="stylesheet" href="/static/35f393d6769a/style-gitweb.css" type="text/css" />

<style type="text/css">
div.feed {
  float: right;
}
a img {
  border-width: 0px;
}
div.log_link {
  width: 80px;
  background-color: white;
}

div.log_body {
  padding-left: 96px;
}
</style>
<script type="text/javascript" src="/static/35f393d6769a/mercurial.js"></script>

<meta property="og:image" content="/static/35f393d6769a/moz-logo-bw-rgb.svg"/>
<meta property="og:type" content="website"/>

<title>comm-central: changeset 12841:5cdbadd8d714ab09c5180b59a9c457bc26746f64</title>
<link rel="alternate" type="application/atom+xml"
   href="/comm-central/atom-log" title="Atom feed for comm-central"/>
<link rel="alternate" type="application/rss+xml"
   href="/comm-central/rss-log" title="RSS feed for comm-central"/>

<meta property="og:title" content="comm-central @ 5cdbadd8d714ab09c5180b59a9c457bc26746f64" />
<meta property="og:url" content="/comm-central/rev/5cdbadd8d714ab09c5180b59a9c457bc26746f64" />
<meta property="og:description" content="Bug 900881 Make localAccountUtils.js into a testing module - Part 3. Move the last global into the object. r=jcranmer" />

</head>
<body>

<div class="page_header">
<div class="logo">
    <a href="https://developer.mozilla.org/en/docs/Mercurial">
        <img src="/static/35f393d6769a/moz-logo-bw-rgb.svg" alt="mercurial" />
    </a>
</div>
<a href="/">Mercurial</a> &gt; <a href="/comm-central">comm-central</a>  / changeset / 5cdbadd8d714ab09c5180b59a9c457bc26746f64 
</div>

<div class="page_nav">
<div>
<a href="/comm-central/summary">summary</a> |
<a href="/comm-central/shortlog/5cdbadd8d714ab09c5180b59a9c457bc26746f64">shortlog</a> |
<a href="/comm-central/log/5cdbadd8d714ab09c5180b59a9c457bc26746f64">changelog</a> |
<a href="/comm-central/pushloghtml">pushlog</a> |
<a href="/comm-central/graph/5cdbadd8d714ab09c5180b59a9c457bc26746f64">graph</a> |
<a href="/comm-central/tags">tags</a> |
<a href="/comm-central/bookmarks">bookmarks</a> |
<a href="/comm-central/branches">branches</a> |
<a href="/comm-central/file/5cdbadd8d714ab09c5180b59a9c457bc26746f64">files</a> |
changeset |
<a href="/comm-central/raw-rev/5cdbadd8d714ab09c5180b59a9c457bc26746f64">raw</a>  | <a href="/comm-central/archive/5cdbadd8d714ab09c5180b59a9c457bc26746f64.zip">zip</a>  |
<a href="/comm-central/help">help</a>
</div>

<div class="search">
<form id="searchform" action="/comm-central/log">

<input name="rev" type="text" value="" size="40" />
<div id="hint">Find changesets by keywords (author, files, the commit message), revision
number or hash, or <a href="/comm-central/help/revsets">revset expression</a>.</div>
</form>
</div>
</div>

<div class="title">
<a href="https://bugzilla.mozilla.org/show_bug.cgi?id=900881">Bug 900881</a> Make localAccountUtils.js into a testing module - Part 3. Move the last global into the object. r=jcranmer
<span class="logtags"></span>
</div>
<div class="title_text">
<table cellspacing="0">

<tr><td>author</td><td>&#77;&#97;&#114;&#107;&#32;&#66;&#97;&#110;&#110;&#101;&#114;&#32;&#60;&#98;&#117;&#103;&#122;&#105;&#108;&#108;&#97;&#64;&#115;&#116;&#97;&#110;&#100;&#97;&#114;&#100;&#56;&#46;&#112;&#108;&#117;&#115;&#46;&#99;&#111;&#109;&#62;</td></tr>
<tr><td></td><td class="date age">Fri, 02 Aug 2013 18:11:29 +0100</td></tr>

<tr>
 <td>changeset 12841</td>
 <td style="font-family:monospace"><a class="list" href="/comm-central/rev/5cdbadd8d714ab09c5180b59a9c457bc26746f64">5cdbadd8d714ab09c5180b59a9c457bc26746f64</a></td>
</tr>



<tr>
<td>parent 12840</td>
<td style="font-family:monospace">
<a class="list" href="/comm-central/rev/7836bd5fcf41f6810ef8ef2934e2ec03004baaab">7836bd5fcf41f6810ef8ef2934e2ec03004baaab</a>
</td>
</tr>

<tr>
<td>child 12842</td>
<td style="font-family:monospace">
<a class="list" href="/comm-central/rev/d8010865c3189b19a77f51176e74136dabf3f618">d8010865c3189b19a77f51176e74136dabf3f618</a>
</td>
</tr>
<tr><td>push id</td><td><a href="/comm-central/pushloghtml?changeset=5cdbadd8d714ab09c5180b59a9c457bc26746f64">9382</a></td></tr>
<tr><td>push user</td><td>bugzilla@standard8.plus.com</td></tr>
<tr><td>push date</td><td class="date age">Fri, 02 Aug 2013 17:36:36 +0000</td></tr>

<tr><td>treeherder</td><td>comm-central@099f9cfcdec5 [<a href="https://treeherder.mozilla.org/#/jobs?repo=comm-central&revision=099f9cfcdec5354e78f8590c6264629e4cdd6e19">default view</a>] [<a href="https://treeherder.mozilla.org/#/jobs?repo=comm-central&revision=099f9cfcdec5354e78f8590c6264629e4cdd6e19&filter-resultStatus=testfailed&filter-resultStatus=busted&filter-resultStatus=exception">failures only]</td></tr>
<tr><td>perfherder</td><td>[<a href="https://treeherder.mozilla.org/perf.html#/compare?originalProject=comm-central&originalRevision=099f9cfcdec5354e78f8590c6264629e4cdd6e19&newProject=comm-central&newRevision=c42b6328a83058d4929b9751ddc7870121b1a7a5&framework=1" target="_blank">talos</a>] [<a href="https://treeherder.mozilla.org/perf.html#/compare?originalProject=comm-central&originalRevision=099f9cfcdec5354e78f8590c6264629e4cdd6e19&newProject=comm-central&newRevision=c42b6328a83058d4929b9751ddc7870121b1a7a5&framework=2" target="_blank">build metrics</a>] [<a href="https://treeherder.mozilla.org/perf.html#/compare?originalProject=comm-central&originalRevision=099f9cfcdec5354e78f8590c6264629e4cdd6e19&newProject=comm-central&newRevision=c42b6328a83058d4929b9751ddc7870121b1a7a5&framework=6" target="_blank">platform microbench</a>] (compared to previous push)</td></tr>
<tr><td>reviewers</td><td><a href="/comm-central/log?rev=reviewer%28jcranmer%29&revcount=50">jcranmer</a></td></tr>
<tr><td>bugs</td><td><a href="https://bugzilla.mozilla.org/show_bug.cgi?id=900881">900881</a></td></tr>




</table></div>

<div class="page_body description"><a href="https://bugzilla.mozilla.org/show_bug.cgi?id=900881">Bug 900881</a> Make localAccountUtils.js into a testing module - Part 3. Move the last global into the object. r=jcranmer</div>
<div class="list_head"></div>
<div class="title_text">
<table cellspacing="0">

<tr class="parity0">
<td><a class="list" href="/comm-central/diff/5cdbadd8d714ab09c5180b59a9c457bc26746f64/mailnews/base/test/unit/test_bccInDatabase.js">mailnews/base/test/unit/test_bccInDatabase.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/5cdbadd8d714ab09c5180b59a9c457bc26746f64/mailnews/base/test/unit/test_bccInDatabase.js">file</a> |
<a href="/comm-central/annotate/5cdbadd8d714ab09c5180b59a9c457bc26746f64/mailnews/base/test/unit/test_bccInDatabase.js">annotate</a> |
<a href="/comm-central/diff/5cdbadd8d714ab09c5180b59a9c457bc26746f64/mailnews/base/test/unit/test_bccInDatabase.js">diff</a> |
<a href="/comm-central/comparison/5cdbadd8d714ab09c5180b59a9c457bc26746f64/mailnews/base/test/unit/test_bccInDatabase.js">comparison</a> |
<a href="/comm-central/log/5cdbadd8d714ab09c5180b59a9c457bc26746f64/mailnews/base/test/unit/test_bccInDatabase.js">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/5cdbadd8d714ab09c5180b59a9c457bc26746f64/mailnews/base/test/unit/test_bug404489.js">mailnews/base/test/unit/test_bug404489.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/5cdbadd8d714ab09c5180b59a9c457bc26746f64/mailnews/base/test/unit/test_bug404489.js">file</a> |
<a href="/comm-central/annotate/5cdbadd8d714ab09c5180b59a9c457bc26746f64/mailnews/base/test/unit/test_bug404489.js">annotate</a> |
<a href="/comm-central/diff/5cdbadd8d714ab09c5180b59a9c457bc26746f64/mailnews/base/test/unit/test_bug404489.js">diff</a> |
<a href="/comm-central/comparison/5cdbadd8d714ab09c5180b59a9c457bc26746f64/mailnews/base/test/unit/test_bug404489.js">comparison</a> |
<a href="/comm-central/log/5cdbadd8d714ab09c5180b59a9c457bc26746f64/mailnews/base/test/unit/test_bug404489.js">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/5cdbadd8d714ab09c5180b59a9c457bc26746f64/mailnews/base/test/unit/test_bug428427.js">mailnews/base/test/unit/test_bug428427.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/5cdbadd8d714ab09c5180b59a9c457bc26746f64/mailnews/base/test/unit/test_bug428427.js">file</a> |
<a href="/comm-central/annotate/5cdbadd8d714ab09c5180b59a9c457bc26746f64/mailnews/base/test/unit/test_bug428427.js">annotate</a> |
<a href="/comm-central/diff/5cdbadd8d714ab09c5180b59a9c457bc26746f64/mailnews/base/test/unit/test_bug428427.js">diff</a> |
<a href="/comm-central/comparison/5cdbadd8d714ab09c5180b59a9c457bc26746f64/mailnews/base/test/unit/test_bug428427.js">comparison</a> |
<a href="/comm-central/log/5cdbadd8d714ab09c5180b59a9c457bc26746f64/mailnews/base/test/unit/test_bug428427.js">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/5cdbadd8d714ab09c5180b59a9c457bc26746f64/mailnews/base/test/unit/test_bug434810.js">mailnews/base/test/unit/test_bug434810.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/5cdbadd8d714ab09c5180b59a9c457bc26746f64/mailnews/base/test/unit/test_bug434810.js">file</a> |
<a href="/comm-central/annotate/5cdbadd8d714ab09c5180b59a9c457bc26746f64/mailnews/base/test/unit/test_bug434810.js">annotate</a> |
<a href="/comm-central/diff/5cdbadd8d714ab09c5180b59a9c457bc26746f64/mailnews/base/test/unit/test_bug434810.js">diff</a> |
<a href="/comm-central/comparison/5cdbadd8d714ab09c5180b59a9c457bc26746f64/mailnews/base/test/unit/test_bug434810.js">comparison</a> |
<a href="/comm-central/log/5cdbadd8d714ab09c5180b59a9c457bc26746f64/mailnews/base/test/unit/test_bug434810.js">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/5cdbadd8d714ab09c5180b59a9c457bc26746f64/mailnews/base/test/unit/test_bug465805.js">mailnews/base/test/unit/test_bug465805.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/5cdbadd8d714ab09c5180b59a9c457bc26746f64/mailnews/base/test/unit/test_bug465805.js">file</a> |
<a href="/comm-central/annotate/5cdbadd8d714ab09c5180b59a9c457bc26746f64/mailnews/base/test/unit/test_bug465805.js">annotate</a> |
<a href="/comm-central/diff/5cdbadd8d714ab09c5180b59a9c457bc26746f64/mailnews/base/test/unit/test_bug465805.js">diff</a> |
<a href="/comm-central/comparison/5cdbadd8d714ab09c5180b59a9c457bc26746f64/mailnews/base/test/unit/test_bug465805.js">comparison</a> |
<a href="/comm-central/log/5cdbadd8d714ab09c5180b59a9c457bc26746f64/mailnews/base/test/unit/test_bug465805.js">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/5cdbadd8d714ab09c5180b59a9c457bc26746f64/mailnews/base/test/unit/test_bug471682.js">mailnews/base/test/unit/test_bug471682.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/5cdbadd8d714ab09c5180b59a9c457bc26746f64/mailnews/base/test/unit/test_bug471682.js">file</a> |
<a href="/comm-central/annotate/5cdbadd8d714ab09c5180b59a9c457bc26746f64/mailnews/base/test/unit/test_bug471682.js">annotate</a> |
<a href="/comm-central/diff/5cdbadd8d714ab09c5180b59a9c457bc26746f64/mailnews/base/test/unit/test_bug471682.js">diff</a> |
<a href="/comm-central/comparison/5cdbadd8d714ab09c5180b59a9c457bc26746f64/mailnews/base/test/unit/test_bug471682.js">comparison</a> |
<a href="/comm-central/log/5cdbadd8d714ab09c5180b59a9c457bc26746f64/mailnews/base/test/unit/test_bug471682.js">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/5cdbadd8d714ab09c5180b59a9c457bc26746f64/mailnews/base/test/unit/test_copyChaining.js">mailnews/base/test/unit/test_copyChaining.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/5cdbadd8d714ab09c5180b59a9c457bc26746f64/mailnews/base/test/unit/test_copyChaining.js">file</a> |
<a href="/comm-central/annotate/5cdbadd8d714ab09c5180b59a9c457bc26746f64/mailnews/base/test/unit/test_copyChaining.js">annotate</a> |
<a href="/comm-central/diff/5cdbadd8d714ab09c5180b59a9c457bc26746f64/mailnews/base/test/unit/test_copyChaining.js">diff</a> |
<a href="/comm-central/comparison/5cdbadd8d714ab09c5180b59a9c457bc26746f64/mailnews/base/test/unit/test_copyChaining.js">comparison</a> |
<a href="/comm-central/log/5cdbadd8d714ab09c5180b59a9c457bc26746f64/mailnews/base/test/unit/test_copyChaining.js">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/5cdbadd8d714ab09c5180b59a9c457bc26746f64/mailnews/base/test/unit/test_copyThenMoveManual.js">mailnews/base/test/unit/test_copyThenMoveManual.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/5cdbadd8d714ab09c5180b59a9c457bc26746f64/mailnews/base/test/unit/test_copyThenMoveManual.js">file</a> |
<a href="/comm-central/annotate/5cdbadd8d714ab09c5180b59a9c457bc26746f64/mailnews/base/test/unit/test_copyThenMoveManual.js">annotate</a> |
<a href="/comm-central/diff/5cdbadd8d714ab09c5180b59a9c457bc26746f64/mailnews/base/test/unit/test_copyThenMoveManual.js">diff</a> |
<a href="/comm-central/comparison/5cdbadd8d714ab09c5180b59a9c457bc26746f64/mailnews/base/test/unit/test_copyThenMoveManual.js">comparison</a> |
<a href="/comm-central/log/5cdbadd8d714ab09c5180b59a9c457bc26746f64/mailnews/base/test/unit/test_copyThenMoveManual.js">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/5cdbadd8d714ab09c5180b59a9c457bc26746f64/mailnews/base/test/unit/test_detachToFile.js">mailnews/base/test/unit/test_detachToFile.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/5cdbadd8d714ab09c5180b59a9c457bc26746f64/mailnews/base/test/unit/test_detachToFile.js">file</a> |
<a href="/comm-central/annotate/5cdbadd8d714ab09c5180b59a9c457bc26746f64/mailnews/base/test/unit/test_detachToFile.js">annotate</a> |
<a href="/comm-central/diff/5cdbadd8d714ab09c5180b59a9c457bc26746f64/mailnews/base/test/unit/test_detachToFile.js">diff</a> |
<a href="/comm-central/comparison/5cdbadd8d714ab09c5180b59a9c457bc26746f64/mailnews/base/test/unit/test_detachToFile.js">comparison</a> |
<a href="/comm-central/log/5cdbadd8d714ab09c5180b59a9c457bc26746f64/mailnews/base/test/unit/test_detachToFile.js">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/5cdbadd8d714ab09c5180b59a9c457bc26746f64/mailnews/base/test/unit/test_emptyTrash.js">mailnews/base/test/unit/test_emptyTrash.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/5cdbadd8d714ab09c5180b59a9c457bc26746f64/mailnews/base/test/unit/test_emptyTrash.js">file</a> |
<a href="/comm-central/annotate/5cdbadd8d714ab09c5180b59a9c457bc26746f64/mailnews/base/test/unit/test_emptyTrash.js">annotate</a> |
<a href="/comm-central/diff/5cdbadd8d714ab09c5180b59a9c457bc26746f64/mailnews/base/test/unit/test_emptyTrash.js">diff</a> |
<a href="/comm-central/comparison/5cdbadd8d714ab09c5180b59a9c457bc26746f64/mailnews/base/test/unit/test_emptyTrash.js">comparison</a> |
<a href="/comm-central/log/5cdbadd8d714ab09c5180b59a9c457bc26746f64/mailnews/base/test/unit/test_emptyTrash.js">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/5cdbadd8d714ab09c5180b59a9c457bc26746f64/mailnews/base/test/unit/test_folderCompact.js">mailnews/base/test/unit/test_folderCompact.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/5cdbadd8d714ab09c5180b59a9c457bc26746f64/mailnews/base/test/unit/test_folderCompact.js">file</a> |
<a href="/comm-central/annotate/5cdbadd8d714ab09c5180b59a9c457bc26746f64/mailnews/base/test/unit/test_folderCompact.js">annotate</a> |
<a href="/comm-central/diff/5cdbadd8d714ab09c5180b59a9c457bc26746f64/mailnews/base/test/unit/test_folderCompact.js">diff</a> |
<a href="/comm-central/comparison/5cdbadd8d714ab09c5180b59a9c457bc26746f64/mailnews/base/test/unit/test_folderCompact.js">comparison</a> |
<a href="/comm-central/log/5cdbadd8d714ab09c5180b59a9c457bc26746f64/mailnews/base/test/unit/test_folderCompact.js">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/5cdbadd8d714ab09c5180b59a9c457bc26746f64/mailnews/base/test/unit/test_inheritedFolderProperties.js">mailnews/base/test/unit/test_inheritedFolderProperties.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/5cdbadd8d714ab09c5180b59a9c457bc26746f64/mailnews/base/test/unit/test_inheritedFolderProperties.js">file</a> |
<a href="/comm-central/annotate/5cdbadd8d714ab09c5180b59a9c457bc26746f64/mailnews/base/test/unit/test_inheritedFolderProperties.js">annotate</a> |
<a href="/comm-central/diff/5cdbadd8d714ab09c5180b59a9c457bc26746f64/mailnews/base/test/unit/test_inheritedFolderProperties.js">diff</a> |
<a href="/comm-central/comparison/5cdbadd8d714ab09c5180b59a9c457bc26746f64/mailnews/base/test/unit/test_inheritedFolderProperties.js">comparison</a> |
<a href="/comm-central/log/5cdbadd8d714ab09c5180b59a9c457bc26746f64/mailnews/base/test/unit/test_inheritedFolderProperties.js">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/5cdbadd8d714ab09c5180b59a9c457bc26746f64/mailnews/base/test/unit/test_junkWhitelisting.js">mailnews/base/test/unit/test_junkWhitelisting.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/5cdbadd8d714ab09c5180b59a9c457bc26746f64/mailnews/base/test/unit/test_junkWhitelisting.js">file</a> |
<a href="/comm-central/annotate/5cdbadd8d714ab09c5180b59a9c457bc26746f64/mailnews/base/test/unit/test_junkWhitelisting.js">annotate</a> |
<a href="/comm-central/diff/5cdbadd8d714ab09c5180b59a9c457bc26746f64/mailnews/base/test/unit/test_junkWhitelisting.js">diff</a> |
<a href="/comm-central/comparison/5cdbadd8d714ab09c5180b59a9c457bc26746f64/mailnews/base/test/unit/test_junkWhitelisting.js">comparison</a> |
<a href="/comm-central/log/5cdbadd8d714ab09c5180b59a9c457bc26746f64/mailnews/base/test/unit/test_junkWhitelisting.js">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/5cdbadd8d714ab09c5180b59a9c457bc26746f64/mailnews/base/test/unit/test_mimemaltdetach.js">mailnews/base/test/unit/test_mimemaltdetach.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/5cdbadd8d714ab09c5180b59a9c457bc26746f64/mailnews/base/test/unit/test_mimemaltdetach.js">file</a> |
<a href="/comm-central/annotate/5cdbadd8d714ab09c5180b59a9c457bc26746f64/mailnews/base/test/unit/test_mimemaltdetach.js">annotate</a> |
<a href="/comm-central/diff/5cdbadd8d714ab09c5180b59a9c457bc26746f64/mailnews/base/test/unit/test_mimemaltdetach.js">diff</a> |
<a href="/comm-central/comparison/5cdbadd8d714ab09c5180b59a9c457bc26746f64/mailnews/base/test/unit/test_mimemaltdetach.js">comparison</a> |
<a href="/comm-central/log/5cdbadd8d714ab09c5180b59a9c457bc26746f64/mailnews/base/test/unit/test_mimemaltdetach.js">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/5cdbadd8d714ab09c5180b59a9c457bc26746f64/mailnews/base/test/unit/test_nsIMsgFolderListenerLocal.js">mailnews/base/test/unit/test_nsIMsgFolderListenerLocal.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/5cdbadd8d714ab09c5180b59a9c457bc26746f64/mailnews/base/test/unit/test_nsIMsgFolderListenerLocal.js">file</a> |
<a href="/comm-central/annotate/5cdbadd8d714ab09c5180b59a9c457bc26746f64/mailnews/base/test/unit/test_nsIMsgFolderListenerLocal.js">annotate</a> |
<a href="/comm-central/diff/5cdbadd8d714ab09c5180b59a9c457bc26746f64/mailnews/base/test/unit/test_nsIMsgFolderListenerLocal.js">diff</a> |
<a href="/comm-central/comparison/5cdbadd8d714ab09c5180b59a9c457bc26746f64/mailnews/base/test/unit/test_nsIMsgFolderListenerLocal.js">comparison</a> |
<a href="/comm-central/log/5cdbadd8d714ab09c5180b59a9c457bc26746f64/mailnews/base/test/unit/test_nsIMsgFolderListenerLocal.js">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/5cdbadd8d714ab09c5180b59a9c457bc26746f64/mailnews/base/test/unit/test_postPluginFilters.js">mailnews/base/test/unit/test_postPluginFilters.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/5cdbadd8d714ab09c5180b59a9c457bc26746f64/mailnews/base/test/unit/test_postPluginFilters.js">file</a> |
<a href="/comm-central/annotate/5cdbadd8d714ab09c5180b59a9c457bc26746f64/mailnews/base/test/unit/test_postPluginFilters.js">annotate</a> |
<a href="/comm-central/diff/5cdbadd8d714ab09c5180b59a9c457bc26746f64/mailnews/base/test/unit/test_postPluginFilters.js">diff</a> |
<a href="/comm-central/comparison/5cdbadd8d714ab09c5180b59a9c457bc26746f64/mailnews/base/test/unit/test_postPluginFilters.js">comparison</a> |
<a href="/comm-central/log/5cdbadd8d714ab09c5180b59a9c457bc26746f64/mailnews/base/test/unit/test_postPluginFilters.js">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/5cdbadd8d714ab09c5180b59a9c457bc26746f64/mailnews/base/test/unit/test_quarantineFilterMove.js">mailnews/base/test/unit/test_quarantineFilterMove.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/5cdbadd8d714ab09c5180b59a9c457bc26746f64/mailnews/base/test/unit/test_quarantineFilterMove.js">file</a> |
<a href="/comm-central/annotate/5cdbadd8d714ab09c5180b59a9c457bc26746f64/mailnews/base/test/unit/test_quarantineFilterMove.js">annotate</a> |
<a href="/comm-central/diff/5cdbadd8d714ab09c5180b59a9c457bc26746f64/mailnews/base/test/unit/test_quarantineFilterMove.js">diff</a> |
<a href="/comm-central/comparison/5cdbadd8d714ab09c5180b59a9c457bc26746f64/mailnews/base/test/unit/test_quarantineFilterMove.js">comparison</a> |
<a href="/comm-central/log/5cdbadd8d714ab09c5180b59a9c457bc26746f64/mailnews/base/test/unit/test_quarantineFilterMove.js">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/5cdbadd8d714ab09c5180b59a9c457bc26746f64/mailnews/base/test/unit/test_search.js">mailnews/base/test/unit/test_search.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/5cdbadd8d714ab09c5180b59a9c457bc26746f64/mailnews/base/test/unit/test_search.js">file</a> |
<a href="/comm-central/annotate/5cdbadd8d714ab09c5180b59a9c457bc26746f64/mailnews/base/test/unit/test_search.js">annotate</a> |
<a href="/comm-central/diff/5cdbadd8d714ab09c5180b59a9c457bc26746f64/mailnews/base/test/unit/test_search.js">diff</a> |
<a href="/comm-central/comparison/5cdbadd8d714ab09c5180b59a9c457bc26746f64/mailnews/base/test/unit/test_search.js">comparison</a> |
<a href="/comm-central/log/5cdbadd8d714ab09c5180b59a9c457bc26746f64/mailnews/base/test/unit/test_search.js">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/5cdbadd8d714ab09c5180b59a9c457bc26746f64/mailnews/base/test/unit/test_searchAddressInAb.js">mailnews/base/test/unit/test_searchAddressInAb.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/5cdbadd8d714ab09c5180b59a9c457bc26746f64/mailnews/base/test/unit/test_searchAddressInAb.js">file</a> |
<a href="/comm-central/annotate/5cdbadd8d714ab09c5180b59a9c457bc26746f64/mailnews/base/test/unit/test_searchAddressInAb.js">annotate</a> |
<a href="/comm-central/diff/5cdbadd8d714ab09c5180b59a9c457bc26746f64/mailnews/base/test/unit/test_searchAddressInAb.js">diff</a> |
<a href="/comm-central/comparison/5cdbadd8d714ab09c5180b59a9c457bc26746f64/mailnews/base/test/unit/test_searchAddressInAb.js">comparison</a> |
<a href="/comm-central/log/5cdbadd8d714ab09c5180b59a9c457bc26746f64/mailnews/base/test/unit/test_searchAddressInAb.js">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/5cdbadd8d714ab09c5180b59a9c457bc26746f64/mailnews/base/test/unit/test_searchBody.js">mailnews/base/test/unit/test_searchBody.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/5cdbadd8d714ab09c5180b59a9c457bc26746f64/mailnews/base/test/unit/test_searchBody.js">file</a> |
<a href="/comm-central/annotate/5cdbadd8d714ab09c5180b59a9c457bc26746f64/mailnews/base/test/unit/test_searchBody.js">annotate</a> |
<a href="/comm-central/diff/5cdbadd8d714ab09c5180b59a9c457bc26746f64/mailnews/base/test/unit/test_searchBody.js">diff</a> |
<a href="/comm-central/comparison/5cdbadd8d714ab09c5180b59a9c457bc26746f64/mailnews/base/test/unit/test_searchBody.js">comparison</a> |
<a href="/comm-central/log/5cdbadd8d714ab09c5180b59a9c457bc26746f64/mailnews/base/test/unit/test_searchBody.js">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/5cdbadd8d714ab09c5180b59a9c457bc26746f64/mailnews/base/test/unit/test_searchBoolean.js">mailnews/base/test/unit/test_searchBoolean.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/5cdbadd8d714ab09c5180b59a9c457bc26746f64/mailnews/base/test/unit/test_searchBoolean.js">file</a> |
<a href="/comm-central/annotate/5cdbadd8d714ab09c5180b59a9c457bc26746f64/mailnews/base/test/unit/test_searchBoolean.js">annotate</a> |
<a href="/comm-central/diff/5cdbadd8d714ab09c5180b59a9c457bc26746f64/mailnews/base/test/unit/test_searchBoolean.js">diff</a> |
<a href="/comm-central/comparison/5cdbadd8d714ab09c5180b59a9c457bc26746f64/mailnews/base/test/unit/test_searchBoolean.js">comparison</a> |
<a href="/comm-central/log/5cdbadd8d714ab09c5180b59a9c457bc26746f64/mailnews/base/test/unit/test_searchBoolean.js">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/5cdbadd8d714ab09c5180b59a9c457bc26746f64/mailnews/base/test/unit/test_searchCustomTerm.js">mailnews/base/test/unit/test_searchCustomTerm.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/5cdbadd8d714ab09c5180b59a9c457bc26746f64/mailnews/base/test/unit/test_searchCustomTerm.js">file</a> |
<a href="/comm-central/annotate/5cdbadd8d714ab09c5180b59a9c457bc26746f64/mailnews/base/test/unit/test_searchCustomTerm.js">annotate</a> |
<a href="/comm-central/diff/5cdbadd8d714ab09c5180b59a9c457bc26746f64/mailnews/base/test/unit/test_searchCustomTerm.js">diff</a> |
<a href="/comm-central/comparison/5cdbadd8d714ab09c5180b59a9c457bc26746f64/mailnews/base/test/unit/test_searchCustomTerm.js">comparison</a> |
<a href="/comm-central/log/5cdbadd8d714ab09c5180b59a9c457bc26746f64/mailnews/base/test/unit/test_searchCustomTerm.js">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/5cdbadd8d714ab09c5180b59a9c457bc26746f64/mailnews/base/test/unit/test_searchJunk.js">mailnews/base/test/unit/test_searchJunk.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/5cdbadd8d714ab09c5180b59a9c457bc26746f64/mailnews/base/test/unit/test_searchJunk.js">file</a> |
<a href="/comm-central/annotate/5cdbadd8d714ab09c5180b59a9c457bc26746f64/mailnews/base/test/unit/test_searchJunk.js">annotate</a> |
<a href="/comm-central/diff/5cdbadd8d714ab09c5180b59a9c457bc26746f64/mailnews/base/test/unit/test_searchJunk.js">diff</a> |
<a href="/comm-central/comparison/5cdbadd8d714ab09c5180b59a9c457bc26746f64/mailnews/base/test/unit/test_searchJunk.js">comparison</a> |
<a href="/comm-central/log/5cdbadd8d714ab09c5180b59a9c457bc26746f64/mailnews/base/test/unit/test_searchJunk.js">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/5cdbadd8d714ab09c5180b59a9c457bc26746f64/mailnews/base/test/unit/test_searchTag.js">mailnews/base/test/unit/test_searchTag.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/5cdbadd8d714ab09c5180b59a9c457bc26746f64/mailnews/base/test/unit/test_searchTag.js">file</a> |
<a href="/comm-central/annotate/5cdbadd8d714ab09c5180b59a9c457bc26746f64/mailnews/base/test/unit/test_searchTag.js">annotate</a> |
<a href="/comm-central/diff/5cdbadd8d714ab09c5180b59a9c457bc26746f64/mailnews/base/test/unit/test_searchTag.js">diff</a> |
<a href="/comm-central/comparison/5cdbadd8d714ab09c5180b59a9c457bc26746f64/mailnews/base/test/unit/test_searchTag.js">comparison</a> |
<a href="/comm-central/log/5cdbadd8d714ab09c5180b59a9c457bc26746f64/mailnews/base/test/unit/test_searchTag.js">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/5cdbadd8d714ab09c5180b59a9c457bc26746f64/mailnews/base/test/unit/test_searchUint32HdrProperty.js">mailnews/base/test/unit/test_searchUint32HdrProperty.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/5cdbadd8d714ab09c5180b59a9c457bc26746f64/mailnews/base/test/unit/test_searchUint32HdrProperty.js">file</a> |
<a href="/comm-central/annotate/5cdbadd8d714ab09c5180b59a9c457bc26746f64/mailnews/base/test/unit/test_searchUint32HdrProperty.js">annotate</a> |
<a href="/comm-central/diff/5cdbadd8d714ab09c5180b59a9c457bc26746f64/mailnews/base/test/unit/test_searchUint32HdrProperty.js">diff</a> |
<a href="/comm-central/comparison/5cdbadd8d714ab09c5180b59a9c457bc26746f64/mailnews/base/test/unit/test_searchUint32HdrProperty.js">comparison</a> |
<a href="/comm-central/log/5cdbadd8d714ab09c5180b59a9c457bc26746f64/mailnews/base/test/unit/test_searchUint32HdrProperty.js">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/5cdbadd8d714ab09c5180b59a9c457bc26746f64/mailnews/compose/test/unit/test_bug235432.js">mailnews/compose/test/unit/test_bug235432.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/5cdbadd8d714ab09c5180b59a9c457bc26746f64/mailnews/compose/test/unit/test_bug235432.js">file</a> |
<a href="/comm-central/annotate/5cdbadd8d714ab09c5180b59a9c457bc26746f64/mailnews/compose/test/unit/test_bug235432.js">annotate</a> |
<a href="/comm-central/diff/5cdbadd8d714ab09c5180b59a9c457bc26746f64/mailnews/compose/test/unit/test_bug235432.js">diff</a> |
<a href="/comm-central/comparison/5cdbadd8d714ab09c5180b59a9c457bc26746f64/mailnews/compose/test/unit/test_bug235432.js">comparison</a> |
<a href="/comm-central/log/5cdbadd8d714ab09c5180b59a9c457bc26746f64/mailnews/compose/test/unit/test_bug235432.js">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/5cdbadd8d714ab09c5180b59a9c457bc26746f64/mailnews/db/msgdb/test/unit/test_enumerator_cleanup.js">mailnews/db/msgdb/test/unit/test_enumerator_cleanup.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/5cdbadd8d714ab09c5180b59a9c457bc26746f64/mailnews/db/msgdb/test/unit/test_enumerator_cleanup.js">file</a> |
<a href="/comm-central/annotate/5cdbadd8d714ab09c5180b59a9c457bc26746f64/mailnews/db/msgdb/test/unit/test_enumerator_cleanup.js">annotate</a> |
<a href="/comm-central/diff/5cdbadd8d714ab09c5180b59a9c457bc26746f64/mailnews/db/msgdb/test/unit/test_enumerator_cleanup.js">diff</a> |
<a href="/comm-central/comparison/5cdbadd8d714ab09c5180b59a9c457bc26746f64/mailnews/db/msgdb/test/unit/test_enumerator_cleanup.js">comparison</a> |
<a href="/comm-central/log/5cdbadd8d714ab09c5180b59a9c457bc26746f64/mailnews/db/msgdb/test/unit/test_enumerator_cleanup.js">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/5cdbadd8d714ab09c5180b59a9c457bc26746f64/mailnews/db/msgdb/test/unit/test_filter_enumerator.js">mailnews/db/msgdb/test/unit/test_filter_enumerator.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/5cdbadd8d714ab09c5180b59a9c457bc26746f64/mailnews/db/msgdb/test/unit/test_filter_enumerator.js">file</a> |
<a href="/comm-central/annotate/5cdbadd8d714ab09c5180b59a9c457bc26746f64/mailnews/db/msgdb/test/unit/test_filter_enumerator.js">annotate</a> |
<a href="/comm-central/diff/5cdbadd8d714ab09c5180b59a9c457bc26746f64/mailnews/db/msgdb/test/unit/test_filter_enumerator.js">diff</a> |
<a href="/comm-central/comparison/5cdbadd8d714ab09c5180b59a9c457bc26746f64/mailnews/db/msgdb/test/unit/test_filter_enumerator.js">comparison</a> |
<a href="/comm-central/log/5cdbadd8d714ab09c5180b59a9c457bc26746f64/mailnews/db/msgdb/test/unit/test_filter_enumerator.js">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/5cdbadd8d714ab09c5180b59a9c457bc26746f64/mailnews/db/msgdb/test/unit/test_propertyEnumerator.js">mailnews/db/msgdb/test/unit/test_propertyEnumerator.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/5cdbadd8d714ab09c5180b59a9c457bc26746f64/mailnews/db/msgdb/test/unit/test_propertyEnumerator.js">file</a> |
<a href="/comm-central/annotate/5cdbadd8d714ab09c5180b59a9c457bc26746f64/mailnews/db/msgdb/test/unit/test_propertyEnumerator.js">annotate</a> |
<a href="/comm-central/diff/5cdbadd8d714ab09c5180b59a9c457bc26746f64/mailnews/db/msgdb/test/unit/test_propertyEnumerator.js">diff</a> |
<a href="/comm-central/comparison/5cdbadd8d714ab09c5180b59a9c457bc26746f64/mailnews/db/msgdb/test/unit/test_propertyEnumerator.js">comparison</a> |
<a href="/comm-central/log/5cdbadd8d714ab09c5180b59a9c457bc26746f64/mailnews/db/msgdb/test/unit/test_propertyEnumerator.js">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/5cdbadd8d714ab09c5180b59a9c457bc26746f64/mailnews/db/msgdb/test/unit/test_references_parsing.js">mailnews/db/msgdb/test/unit/test_references_parsing.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/5cdbadd8d714ab09c5180b59a9c457bc26746f64/mailnews/db/msgdb/test/unit/test_references_parsing.js">file</a> |
<a href="/comm-central/annotate/5cdbadd8d714ab09c5180b59a9c457bc26746f64/mailnews/db/msgdb/test/unit/test_references_parsing.js">annotate</a> |
<a href="/comm-central/diff/5cdbadd8d714ab09c5180b59a9c457bc26746f64/mailnews/db/msgdb/test/unit/test_references_parsing.js">diff</a> |
<a href="/comm-central/comparison/5cdbadd8d714ab09c5180b59a9c457bc26746f64/mailnews/db/msgdb/test/unit/test_references_parsing.js">comparison</a> |
<a href="/comm-central/log/5cdbadd8d714ab09c5180b59a9c457bc26746f64/mailnews/db/msgdb/test/unit/test_references_parsing.js">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/5cdbadd8d714ab09c5180b59a9c457bc26746f64/mailnews/extensions/mdn/test/unit/test_askuser.js">mailnews/extensions/mdn/test/unit/test_askuser.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/5cdbadd8d714ab09c5180b59a9c457bc26746f64/mailnews/extensions/mdn/test/unit/test_askuser.js">file</a> |
<a href="/comm-central/annotate/5cdbadd8d714ab09c5180b59a9c457bc26746f64/mailnews/extensions/mdn/test/unit/test_askuser.js">annotate</a> |
<a href="/comm-central/diff/5cdbadd8d714ab09c5180b59a9c457bc26746f64/mailnews/extensions/mdn/test/unit/test_askuser.js">diff</a> |
<a href="/comm-central/comparison/5cdbadd8d714ab09c5180b59a9c457bc26746f64/mailnews/extensions/mdn/test/unit/test_askuser.js">comparison</a> |
<a href="/comm-central/log/5cdbadd8d714ab09c5180b59a9c457bc26746f64/mailnews/extensions/mdn/test/unit/test_askuser.js">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/5cdbadd8d714ab09c5180b59a9c457bc26746f64/mailnews/extensions/mdn/test/unit/test_mdnFlags.js">mailnews/extensions/mdn/test/unit/test_mdnFlags.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/5cdbadd8d714ab09c5180b59a9c457bc26746f64/mailnews/extensions/mdn/test/unit/test_mdnFlags.js">file</a> |
<a href="/comm-central/annotate/5cdbadd8d714ab09c5180b59a9c457bc26746f64/mailnews/extensions/mdn/test/unit/test_mdnFlags.js">annotate</a> |
<a href="/comm-central/diff/5cdbadd8d714ab09c5180b59a9c457bc26746f64/mailnews/extensions/mdn/test/unit/test_mdnFlags.js">diff</a> |
<a href="/comm-central/comparison/5cdbadd8d714ab09c5180b59a9c457bc26746f64/mailnews/extensions/mdn/test/unit/test_mdnFlags.js">comparison</a> |
<a href="/comm-central/log/5cdbadd8d714ab09c5180b59a9c457bc26746f64/mailnews/extensions/mdn/test/unit/test_mdnFlags.js">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/5cdbadd8d714ab09c5180b59a9c457bc26746f64/mailnews/imap/test/unit/test_compactOfflineStore.js">mailnews/imap/test/unit/test_compactOfflineStore.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/5cdbadd8d714ab09c5180b59a9c457bc26746f64/mailnews/imap/test/unit/test_compactOfflineStore.js">file</a> |
<a href="/comm-central/annotate/5cdbadd8d714ab09c5180b59a9c457bc26746f64/mailnews/imap/test/unit/test_compactOfflineStore.js">annotate</a> |
<a href="/comm-central/diff/5cdbadd8d714ab09c5180b59a9c457bc26746f64/mailnews/imap/test/unit/test_compactOfflineStore.js">diff</a> |
<a href="/comm-central/comparison/5cdbadd8d714ab09c5180b59a9c457bc26746f64/mailnews/imap/test/unit/test_compactOfflineStore.js">comparison</a> |
<a href="/comm-central/log/5cdbadd8d714ab09c5180b59a9c457bc26746f64/mailnews/imap/test/unit/test_compactOfflineStore.js">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/5cdbadd8d714ab09c5180b59a9c457bc26746f64/mailnews/imap/test/unit/test_copyThenMove.js">mailnews/imap/test/unit/test_copyThenMove.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/5cdbadd8d714ab09c5180b59a9c457bc26746f64/mailnews/imap/test/unit/test_copyThenMove.js">file</a> |
<a href="/comm-central/annotate/5cdbadd8d714ab09c5180b59a9c457bc26746f64/mailnews/imap/test/unit/test_copyThenMove.js">annotate</a> |
<a href="/comm-central/diff/5cdbadd8d714ab09c5180b59a9c457bc26746f64/mailnews/imap/test/unit/test_copyThenMove.js">diff</a> |
<a href="/comm-central/comparison/5cdbadd8d714ab09c5180b59a9c457bc26746f64/mailnews/imap/test/unit/test_copyThenMove.js">comparison</a> |
<a href="/comm-central/log/5cdbadd8d714ab09c5180b59a9c457bc26746f64/mailnews/imap/test/unit/test_copyThenMove.js">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/5cdbadd8d714ab09c5180b59a9c457bc26746f64/mailnews/imap/test/unit/test_imapFilterActions.js">mailnews/imap/test/unit/test_imapFilterActions.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/5cdbadd8d714ab09c5180b59a9c457bc26746f64/mailnews/imap/test/unit/test_imapFilterActions.js">file</a> |
<a href="/comm-central/annotate/5cdbadd8d714ab09c5180b59a9c457bc26746f64/mailnews/imap/test/unit/test_imapFilterActions.js">annotate</a> |
<a href="/comm-central/diff/5cdbadd8d714ab09c5180b59a9c457bc26746f64/mailnews/imap/test/unit/test_imapFilterActions.js">diff</a> |
<a href="/comm-central/comparison/5cdbadd8d714ab09c5180b59a9c457bc26746f64/mailnews/imap/test/unit/test_imapFilterActions.js">comparison</a> |
<a href="/comm-central/log/5cdbadd8d714ab09c5180b59a9c457bc26746f64/mailnews/imap/test/unit/test_imapFilterActions.js">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/5cdbadd8d714ab09c5180b59a9c457bc26746f64/mailnews/imap/test/unit/test_localToImapFilter.js">mailnews/imap/test/unit/test_localToImapFilter.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/5cdbadd8d714ab09c5180b59a9c457bc26746f64/mailnews/imap/test/unit/test_localToImapFilter.js">file</a> |
<a href="/comm-central/annotate/5cdbadd8d714ab09c5180b59a9c457bc26746f64/mailnews/imap/test/unit/test_localToImapFilter.js">annotate</a> |
<a href="/comm-central/diff/5cdbadd8d714ab09c5180b59a9c457bc26746f64/mailnews/imap/test/unit/test_localToImapFilter.js">diff</a> |
<a href="/comm-central/comparison/5cdbadd8d714ab09c5180b59a9c457bc26746f64/mailnews/imap/test/unit/test_localToImapFilter.js">comparison</a> |
<a href="/comm-central/log/5cdbadd8d714ab09c5180b59a9c457bc26746f64/mailnews/imap/test/unit/test_localToImapFilter.js">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/5cdbadd8d714ab09c5180b59a9c457bc26746f64/mailnews/imap/test/unit/test_localToImapFilterQuarantine.js">mailnews/imap/test/unit/test_localToImapFilterQuarantine.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/5cdbadd8d714ab09c5180b59a9c457bc26746f64/mailnews/imap/test/unit/test_localToImapFilterQuarantine.js">file</a> |
<a href="/comm-central/annotate/5cdbadd8d714ab09c5180b59a9c457bc26746f64/mailnews/imap/test/unit/test_localToImapFilterQuarantine.js">annotate</a> |
<a href="/comm-central/diff/5cdbadd8d714ab09c5180b59a9c457bc26746f64/mailnews/imap/test/unit/test_localToImapFilterQuarantine.js">diff</a> |
<a href="/comm-central/comparison/5cdbadd8d714ab09c5180b59a9c457bc26746f64/mailnews/imap/test/unit/test_localToImapFilterQuarantine.js">comparison</a> |
<a href="/comm-central/log/5cdbadd8d714ab09c5180b59a9c457bc26746f64/mailnews/imap/test/unit/test_localToImapFilterQuarantine.js">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/5cdbadd8d714ab09c5180b59a9c457bc26746f64/mailnews/imap/test/unit/test_offlineStoreLocking.js">mailnews/imap/test/unit/test_offlineStoreLocking.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/5cdbadd8d714ab09c5180b59a9c457bc26746f64/mailnews/imap/test/unit/test_offlineStoreLocking.js">file</a> |
<a href="/comm-central/annotate/5cdbadd8d714ab09c5180b59a9c457bc26746f64/mailnews/imap/test/unit/test_offlineStoreLocking.js">annotate</a> |
<a href="/comm-central/diff/5cdbadd8d714ab09c5180b59a9c457bc26746f64/mailnews/imap/test/unit/test_offlineStoreLocking.js">diff</a> |
<a href="/comm-central/comparison/5cdbadd8d714ab09c5180b59a9c457bc26746f64/mailnews/imap/test/unit/test_offlineStoreLocking.js">comparison</a> |
<a href="/comm-central/log/5cdbadd8d714ab09c5180b59a9c457bc26746f64/mailnews/imap/test/unit/test_offlineStoreLocking.js">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/5cdbadd8d714ab09c5180b59a9c457bc26746f64/mailnews/imap/test/unit/test_stopMovingToLocalFolder.js">mailnews/imap/test/unit/test_stopMovingToLocalFolder.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/5cdbadd8d714ab09c5180b59a9c457bc26746f64/mailnews/imap/test/unit/test_stopMovingToLocalFolder.js">file</a> |
<a href="/comm-central/annotate/5cdbadd8d714ab09c5180b59a9c457bc26746f64/mailnews/imap/test/unit/test_stopMovingToLocalFolder.js">annotate</a> |
<a href="/comm-central/diff/5cdbadd8d714ab09c5180b59a9c457bc26746f64/mailnews/imap/test/unit/test_stopMovingToLocalFolder.js">diff</a> |
<a href="/comm-central/comparison/5cdbadd8d714ab09c5180b59a9c457bc26746f64/mailnews/imap/test/unit/test_stopMovingToLocalFolder.js">comparison</a> |
<a href="/comm-central/log/5cdbadd8d714ab09c5180b59a9c457bc26746f64/mailnews/imap/test/unit/test_stopMovingToLocalFolder.js">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/5cdbadd8d714ab09c5180b59a9c457bc26746f64/mailnews/local/test/unit/head_maillocal.js">mailnews/local/test/unit/head_maillocal.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/5cdbadd8d714ab09c5180b59a9c457bc26746f64/mailnews/local/test/unit/head_maillocal.js">file</a> |
<a href="/comm-central/annotate/5cdbadd8d714ab09c5180b59a9c457bc26746f64/mailnews/local/test/unit/head_maillocal.js">annotate</a> |
<a href="/comm-central/diff/5cdbadd8d714ab09c5180b59a9c457bc26746f64/mailnews/local/test/unit/head_maillocal.js">diff</a> |
<a href="/comm-central/comparison/5cdbadd8d714ab09c5180b59a9c457bc26746f64/mailnews/local/test/unit/head_maillocal.js">comparison</a> |
<a href="/comm-central/log/5cdbadd8d714ab09c5180b59a9c457bc26746f64/mailnews/local/test/unit/head_maillocal.js">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/5cdbadd8d714ab09c5180b59a9c457bc26746f64/mailnews/local/test/unit/test_bug457168.js">mailnews/local/test/unit/test_bug457168.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/5cdbadd8d714ab09c5180b59a9c457bc26746f64/mailnews/local/test/unit/test_bug457168.js">file</a> |
<a href="/comm-central/annotate/5cdbadd8d714ab09c5180b59a9c457bc26746f64/mailnews/local/test/unit/test_bug457168.js">annotate</a> |
<a href="/comm-central/diff/5cdbadd8d714ab09c5180b59a9c457bc26746f64/mailnews/local/test/unit/test_bug457168.js">diff</a> |
<a href="/comm-central/comparison/5cdbadd8d714ab09c5180b59a9c457bc26746f64/mailnews/local/test/unit/test_bug457168.js">comparison</a> |
<a href="/comm-central/log/5cdbadd8d714ab09c5180b59a9c457bc26746f64/mailnews/local/test/unit/test_bug457168.js">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/5cdbadd8d714ab09c5180b59a9c457bc26746f64/mailnews/local/test/unit/test_fileName.js">mailnews/local/test/unit/test_fileName.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/5cdbadd8d714ab09c5180b59a9c457bc26746f64/mailnews/local/test/unit/test_fileName.js">file</a> |
<a href="/comm-central/annotate/5cdbadd8d714ab09c5180b59a9c457bc26746f64/mailnews/local/test/unit/test_fileName.js">annotate</a> |
<a href="/comm-central/diff/5cdbadd8d714ab09c5180b59a9c457bc26746f64/mailnews/local/test/unit/test_fileName.js">diff</a> |
<a href="/comm-central/comparison/5cdbadd8d714ab09c5180b59a9c457bc26746f64/mailnews/local/test/unit/test_fileName.js">comparison</a> |
<a href="/comm-central/log/5cdbadd8d714ab09c5180b59a9c457bc26746f64/mailnews/local/test/unit/test_fileName.js">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/5cdbadd8d714ab09c5180b59a9c457bc26746f64/mailnews/local/test/unit/test_folderLoaded.js">mailnews/local/test/unit/test_folderLoaded.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/5cdbadd8d714ab09c5180b59a9c457bc26746f64/mailnews/local/test/unit/test_folderLoaded.js">file</a> |
<a href="/comm-central/annotate/5cdbadd8d714ab09c5180b59a9c457bc26746f64/mailnews/local/test/unit/test_folderLoaded.js">annotate</a> |
<a href="/comm-central/diff/5cdbadd8d714ab09c5180b59a9c457bc26746f64/mailnews/local/test/unit/test_folderLoaded.js">diff</a> |
<a href="/comm-central/comparison/5cdbadd8d714ab09c5180b59a9c457bc26746f64/mailnews/local/test/unit/test_folderLoaded.js">comparison</a> |
<a href="/comm-central/log/5cdbadd8d714ab09c5180b59a9c457bc26746f64/mailnews/local/test/unit/test_folderLoaded.js">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/5cdbadd8d714ab09c5180b59a9c457bc26746f64/mailnews/local/test/unit/test_mailboxContentLength.js">mailnews/local/test/unit/test_mailboxContentLength.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/5cdbadd8d714ab09c5180b59a9c457bc26746f64/mailnews/local/test/unit/test_mailboxContentLength.js">file</a> |
<a href="/comm-central/annotate/5cdbadd8d714ab09c5180b59a9c457bc26746f64/mailnews/local/test/unit/test_mailboxContentLength.js">annotate</a> |
<a href="/comm-central/diff/5cdbadd8d714ab09c5180b59a9c457bc26746f64/mailnews/local/test/unit/test_mailboxContentLength.js">diff</a> |
<a href="/comm-central/comparison/5cdbadd8d714ab09c5180b59a9c457bc26746f64/mailnews/local/test/unit/test_mailboxContentLength.js">comparison</a> |
<a href="/comm-central/log/5cdbadd8d714ab09c5180b59a9c457bc26746f64/mailnews/local/test/unit/test_mailboxContentLength.js">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/5cdbadd8d714ab09c5180b59a9c457bc26746f64/mailnews/local/test/unit/test_msgCopy.js">mailnews/local/test/unit/test_msgCopy.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/5cdbadd8d714ab09c5180b59a9c457bc26746f64/mailnews/local/test/unit/test_msgCopy.js">file</a> |
<a href="/comm-central/annotate/5cdbadd8d714ab09c5180b59a9c457bc26746f64/mailnews/local/test/unit/test_msgCopy.js">annotate</a> |
<a href="/comm-central/diff/5cdbadd8d714ab09c5180b59a9c457bc26746f64/mailnews/local/test/unit/test_msgCopy.js">diff</a> |
<a href="/comm-central/comparison/5cdbadd8d714ab09c5180b59a9c457bc26746f64/mailnews/local/test/unit/test_msgCopy.js">comparison</a> |
<a href="/comm-central/log/5cdbadd8d714ab09c5180b59a9c457bc26746f64/mailnews/local/test/unit/test_msgCopy.js">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/5cdbadd8d714ab09c5180b59a9c457bc26746f64/mailnews/local/test/unit/test_msgIDParsing.js">mailnews/local/test/unit/test_msgIDParsing.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/5cdbadd8d714ab09c5180b59a9c457bc26746f64/mailnews/local/test/unit/test_msgIDParsing.js">file</a> |
<a href="/comm-central/annotate/5cdbadd8d714ab09c5180b59a9c457bc26746f64/mailnews/local/test/unit/test_msgIDParsing.js">annotate</a> |
<a href="/comm-central/diff/5cdbadd8d714ab09c5180b59a9c457bc26746f64/mailnews/local/test/unit/test_msgIDParsing.js">diff</a> |
<a href="/comm-central/comparison/5cdbadd8d714ab09c5180b59a9c457bc26746f64/mailnews/local/test/unit/test_msgIDParsing.js">comparison</a> |
<a href="/comm-central/log/5cdbadd8d714ab09c5180b59a9c457bc26746f64/mailnews/local/test/unit/test_msgIDParsing.js">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/5cdbadd8d714ab09c5180b59a9c457bc26746f64/mailnews/local/test/unit/test_nsIMsgParseMailMsgState.js">mailnews/local/test/unit/test_nsIMsgParseMailMsgState.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/5cdbadd8d714ab09c5180b59a9c457bc26746f64/mailnews/local/test/unit/test_nsIMsgParseMailMsgState.js">file</a> |
<a href="/comm-central/annotate/5cdbadd8d714ab09c5180b59a9c457bc26746f64/mailnews/local/test/unit/test_nsIMsgParseMailMsgState.js">annotate</a> |
<a href="/comm-central/diff/5cdbadd8d714ab09c5180b59a9c457bc26746f64/mailnews/local/test/unit/test_nsIMsgParseMailMsgState.js">diff</a> |
<a href="/comm-central/comparison/5cdbadd8d714ab09c5180b59a9c457bc26746f64/mailnews/local/test/unit/test_nsIMsgParseMailMsgState.js">comparison</a> |
<a href="/comm-central/log/5cdbadd8d714ab09c5180b59a9c457bc26746f64/mailnews/local/test/unit/test_nsIMsgParseMailMsgState.js">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/5cdbadd8d714ab09c5180b59a9c457bc26746f64/mailnews/local/test/unit/test_over2GBMailboxes.js">mailnews/local/test/unit/test_over2GBMailboxes.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/5cdbadd8d714ab09c5180b59a9c457bc26746f64/mailnews/local/test/unit/test_over2GBMailboxes.js">file</a> |
<a href="/comm-central/annotate/5cdbadd8d714ab09c5180b59a9c457bc26746f64/mailnews/local/test/unit/test_over2GBMailboxes.js">annotate</a> |
<a href="/comm-central/diff/5cdbadd8d714ab09c5180b59a9c457bc26746f64/mailnews/local/test/unit/test_over2GBMailboxes.js">diff</a> |
<a href="/comm-central/comparison/5cdbadd8d714ab09c5180b59a9c457bc26746f64/mailnews/local/test/unit/test_over2GBMailboxes.js">comparison</a> |
<a href="/comm-central/log/5cdbadd8d714ab09c5180b59a9c457bc26746f64/mailnews/local/test/unit/test_over2GBMailboxes.js">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/5cdbadd8d714ab09c5180b59a9c457bc26746f64/mailnews/local/test/unit/test_over4GBMailboxes.js">mailnews/local/test/unit/test_over4GBMailboxes.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/5cdbadd8d714ab09c5180b59a9c457bc26746f64/mailnews/local/test/unit/test_over4GBMailboxes.js">file</a> |
<a href="/comm-central/annotate/5cdbadd8d714ab09c5180b59a9c457bc26746f64/mailnews/local/test/unit/test_over4GBMailboxes.js">annotate</a> |
<a href="/comm-central/diff/5cdbadd8d714ab09c5180b59a9c457bc26746f64/mailnews/local/test/unit/test_over4GBMailboxes.js">diff</a> |
<a href="/comm-central/comparison/5cdbadd8d714ab09c5180b59a9c457bc26746f64/mailnews/local/test/unit/test_over4GBMailboxes.js">comparison</a> |
<a href="/comm-central/log/5cdbadd8d714ab09c5180b59a9c457bc26746f64/mailnews/local/test/unit/test_over4GBMailboxes.js">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/5cdbadd8d714ab09c5180b59a9c457bc26746f64/mailnews/local/test/unit/test_pop3AuthMethods.js">mailnews/local/test/unit/test_pop3AuthMethods.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/5cdbadd8d714ab09c5180b59a9c457bc26746f64/mailnews/local/test/unit/test_pop3AuthMethods.js">file</a> |
<a href="/comm-central/annotate/5cdbadd8d714ab09c5180b59a9c457bc26746f64/mailnews/local/test/unit/test_pop3AuthMethods.js">annotate</a> |
<a href="/comm-central/diff/5cdbadd8d714ab09c5180b59a9c457bc26746f64/mailnews/local/test/unit/test_pop3AuthMethods.js">diff</a> |
<a href="/comm-central/comparison/5cdbadd8d714ab09c5180b59a9c457bc26746f64/mailnews/local/test/unit/test_pop3AuthMethods.js">comparison</a> |
<a href="/comm-central/log/5cdbadd8d714ab09c5180b59a9c457bc26746f64/mailnews/local/test/unit/test_pop3AuthMethods.js">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/5cdbadd8d714ab09c5180b59a9c457bc26746f64/mailnews/local/test/unit/test_pop3Download.js">mailnews/local/test/unit/test_pop3Download.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/5cdbadd8d714ab09c5180b59a9c457bc26746f64/mailnews/local/test/unit/test_pop3Download.js">file</a> |
<a href="/comm-central/annotate/5cdbadd8d714ab09c5180b59a9c457bc26746f64/mailnews/local/test/unit/test_pop3Download.js">annotate</a> |
<a href="/comm-central/diff/5cdbadd8d714ab09c5180b59a9c457bc26746f64/mailnews/local/test/unit/test_pop3Download.js">diff</a> |
<a href="/comm-central/comparison/5cdbadd8d714ab09c5180b59a9c457bc26746f64/mailnews/local/test/unit/test_pop3Download.js">comparison</a> |
<a href="/comm-central/log/5cdbadd8d714ab09c5180b59a9c457bc26746f64/mailnews/local/test/unit/test_pop3Download.js">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/5cdbadd8d714ab09c5180b59a9c457bc26746f64/mailnews/local/test/unit/test_pop3DownloadTempFileHandling.js">mailnews/local/test/unit/test_pop3DownloadTempFileHandling.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/5cdbadd8d714ab09c5180b59a9c457bc26746f64/mailnews/local/test/unit/test_pop3DownloadTempFileHandling.js">file</a> |
<a href="/comm-central/annotate/5cdbadd8d714ab09c5180b59a9c457bc26746f64/mailnews/local/test/unit/test_pop3DownloadTempFileHandling.js">annotate</a> |
<a href="/comm-central/diff/5cdbadd8d714ab09c5180b59a9c457bc26746f64/mailnews/local/test/unit/test_pop3DownloadTempFileHandling.js">diff</a> |
<a href="/comm-central/comparison/5cdbadd8d714ab09c5180b59a9c457bc26746f64/mailnews/local/test/unit/test_pop3DownloadTempFileHandling.js">comparison</a> |
<a href="/comm-central/log/5cdbadd8d714ab09c5180b59a9c457bc26746f64/mailnews/local/test/unit/test_pop3DownloadTempFileHandling.js">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/5cdbadd8d714ab09c5180b59a9c457bc26746f64/mailnews/local/test/unit/test_pop3Duplicates.js">mailnews/local/test/unit/test_pop3Duplicates.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/5cdbadd8d714ab09c5180b59a9c457bc26746f64/mailnews/local/test/unit/test_pop3Duplicates.js">file</a> |
<a href="/comm-central/annotate/5cdbadd8d714ab09c5180b59a9c457bc26746f64/mailnews/local/test/unit/test_pop3Duplicates.js">annotate</a> |
<a href="/comm-central/diff/5cdbadd8d714ab09c5180b59a9c457bc26746f64/mailnews/local/test/unit/test_pop3Duplicates.js">diff</a> |
<a href="/comm-central/comparison/5cdbadd8d714ab09c5180b59a9c457bc26746f64/mailnews/local/test/unit/test_pop3Duplicates.js">comparison</a> |
<a href="/comm-central/log/5cdbadd8d714ab09c5180b59a9c457bc26746f64/mailnews/local/test/unit/test_pop3Duplicates.js">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/5cdbadd8d714ab09c5180b59a9c457bc26746f64/mailnews/local/test/unit/test_pop3FilterActions.js">mailnews/local/test/unit/test_pop3FilterActions.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/5cdbadd8d714ab09c5180b59a9c457bc26746f64/mailnews/local/test/unit/test_pop3FilterActions.js">file</a> |
<a href="/comm-central/annotate/5cdbadd8d714ab09c5180b59a9c457bc26746f64/mailnews/local/test/unit/test_pop3FilterActions.js">annotate</a> |
<a href="/comm-central/diff/5cdbadd8d714ab09c5180b59a9c457bc26746f64/mailnews/local/test/unit/test_pop3FilterActions.js">diff</a> |
<a href="/comm-central/comparison/5cdbadd8d714ab09c5180b59a9c457bc26746f64/mailnews/local/test/unit/test_pop3FilterActions.js">comparison</a> |
<a href="/comm-central/log/5cdbadd8d714ab09c5180b59a9c457bc26746f64/mailnews/local/test/unit/test_pop3FilterActions.js">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/5cdbadd8d714ab09c5180b59a9c457bc26746f64/mailnews/local/test/unit/test_pop3GSSAPIFail.js">mailnews/local/test/unit/test_pop3GSSAPIFail.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/5cdbadd8d714ab09c5180b59a9c457bc26746f64/mailnews/local/test/unit/test_pop3GSSAPIFail.js">file</a> |
<a href="/comm-central/annotate/5cdbadd8d714ab09c5180b59a9c457bc26746f64/mailnews/local/test/unit/test_pop3GSSAPIFail.js">annotate</a> |
<a href="/comm-central/diff/5cdbadd8d714ab09c5180b59a9c457bc26746f64/mailnews/local/test/unit/test_pop3GSSAPIFail.js">diff</a> |
<a href="/comm-central/comparison/5cdbadd8d714ab09c5180b59a9c457bc26746f64/mailnews/local/test/unit/test_pop3GSSAPIFail.js">comparison</a> |
<a href="/comm-central/log/5cdbadd8d714ab09c5180b59a9c457bc26746f64/mailnews/local/test/unit/test_pop3GSSAPIFail.js">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/5cdbadd8d714ab09c5180b59a9c457bc26746f64/mailnews/local/test/unit/test_pop3GetNewMail.js">mailnews/local/test/unit/test_pop3GetNewMail.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/5cdbadd8d714ab09c5180b59a9c457bc26746f64/mailnews/local/test/unit/test_pop3GetNewMail.js">file</a> |
<a href="/comm-central/annotate/5cdbadd8d714ab09c5180b59a9c457bc26746f64/mailnews/local/test/unit/test_pop3GetNewMail.js">annotate</a> |
<a href="/comm-central/diff/5cdbadd8d714ab09c5180b59a9c457bc26746f64/mailnews/local/test/unit/test_pop3GetNewMail.js">diff</a> |
<a href="/comm-central/comparison/5cdbadd8d714ab09c5180b59a9c457bc26746f64/mailnews/local/test/unit/test_pop3GetNewMail.js">comparison</a> |
<a href="/comm-central/log/5cdbadd8d714ab09c5180b59a9c457bc26746f64/mailnews/local/test/unit/test_pop3GetNewMail.js">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/5cdbadd8d714ab09c5180b59a9c457bc26746f64/mailnews/local/test/unit/test_pop3MoveFilter.js">mailnews/local/test/unit/test_pop3MoveFilter.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/5cdbadd8d714ab09c5180b59a9c457bc26746f64/mailnews/local/test/unit/test_pop3MoveFilter.js">file</a> |
<a href="/comm-central/annotate/5cdbadd8d714ab09c5180b59a9c457bc26746f64/mailnews/local/test/unit/test_pop3MoveFilter.js">annotate</a> |
<a href="/comm-central/diff/5cdbadd8d714ab09c5180b59a9c457bc26746f64/mailnews/local/test/unit/test_pop3MoveFilter.js">diff</a> |
<a href="/comm-central/comparison/5cdbadd8d714ab09c5180b59a9c457bc26746f64/mailnews/local/test/unit/test_pop3MoveFilter.js">comparison</a> |
<a href="/comm-central/log/5cdbadd8d714ab09c5180b59a9c457bc26746f64/mailnews/local/test/unit/test_pop3MoveFilter.js">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/5cdbadd8d714ab09c5180b59a9c457bc26746f64/mailnews/local/test/unit/test_pop3MoveFilter2.js">mailnews/local/test/unit/test_pop3MoveFilter2.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/5cdbadd8d714ab09c5180b59a9c457bc26746f64/mailnews/local/test/unit/test_pop3MoveFilter2.js">file</a> |
<a href="/comm-central/annotate/5cdbadd8d714ab09c5180b59a9c457bc26746f64/mailnews/local/test/unit/test_pop3MoveFilter2.js">annotate</a> |
<a href="/comm-central/diff/5cdbadd8d714ab09c5180b59a9c457bc26746f64/mailnews/local/test/unit/test_pop3MoveFilter2.js">diff</a> |
<a href="/comm-central/comparison/5cdbadd8d714ab09c5180b59a9c457bc26746f64/mailnews/local/test/unit/test_pop3MoveFilter2.js">comparison</a> |
<a href="/comm-central/log/5cdbadd8d714ab09c5180b59a9c457bc26746f64/mailnews/local/test/unit/test_pop3MoveFilter2.js">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/5cdbadd8d714ab09c5180b59a9c457bc26746f64/mailnews/local/test/unit/test_pop3Password.js">mailnews/local/test/unit/test_pop3Password.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/5cdbadd8d714ab09c5180b59a9c457bc26746f64/mailnews/local/test/unit/test_pop3Password.js">file</a> |
<a href="/comm-central/annotate/5cdbadd8d714ab09c5180b59a9c457bc26746f64/mailnews/local/test/unit/test_pop3Password.js">annotate</a> |
<a href="/comm-central/diff/5cdbadd8d714ab09c5180b59a9c457bc26746f64/mailnews/local/test/unit/test_pop3Password.js">diff</a> |
<a href="/comm-central/comparison/5cdbadd8d714ab09c5180b59a9c457bc26746f64/mailnews/local/test/unit/test_pop3Password.js">comparison</a> |
<a href="/comm-central/log/5cdbadd8d714ab09c5180b59a9c457bc26746f64/mailnews/local/test/unit/test_pop3Password.js">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/5cdbadd8d714ab09c5180b59a9c457bc26746f64/mailnews/local/test/unit/test_pop3Password2.js">mailnews/local/test/unit/test_pop3Password2.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/5cdbadd8d714ab09c5180b59a9c457bc26746f64/mailnews/local/test/unit/test_pop3Password2.js">file</a> |
<a href="/comm-central/annotate/5cdbadd8d714ab09c5180b59a9c457bc26746f64/mailnews/local/test/unit/test_pop3Password2.js">annotate</a> |
<a href="/comm-central/diff/5cdbadd8d714ab09c5180b59a9c457bc26746f64/mailnews/local/test/unit/test_pop3Password2.js">diff</a> |
<a href="/comm-central/comparison/5cdbadd8d714ab09c5180b59a9c457bc26746f64/mailnews/local/test/unit/test_pop3Password2.js">comparison</a> |
<a href="/comm-central/log/5cdbadd8d714ab09c5180b59a9c457bc26746f64/mailnews/local/test/unit/test_pop3Password2.js">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/5cdbadd8d714ab09c5180b59a9c457bc26746f64/mailnews/local/test/unit/test_pop3PasswordFailure.js">mailnews/local/test/unit/test_pop3PasswordFailure.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/5cdbadd8d714ab09c5180b59a9c457bc26746f64/mailnews/local/test/unit/test_pop3PasswordFailure.js">file</a> |
<a href="/comm-central/annotate/5cdbadd8d714ab09c5180b59a9c457bc26746f64/mailnews/local/test/unit/test_pop3PasswordFailure.js">annotate</a> |
<a href="/comm-central/diff/5cdbadd8d714ab09c5180b59a9c457bc26746f64/mailnews/local/test/unit/test_pop3PasswordFailure.js">diff</a> |
<a href="/comm-central/comparison/5cdbadd8d714ab09c5180b59a9c457bc26746f64/mailnews/local/test/unit/test_pop3PasswordFailure.js">comparison</a> |
<a href="/comm-central/log/5cdbadd8d714ab09c5180b59a9c457bc26746f64/mailnews/local/test/unit/test_pop3PasswordFailure.js">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/5cdbadd8d714ab09c5180b59a9c457bc26746f64/mailnews/local/test/unit/test_pop3PasswordFailure2.js">mailnews/local/test/unit/test_pop3PasswordFailure2.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/5cdbadd8d714ab09c5180b59a9c457bc26746f64/mailnews/local/test/unit/test_pop3PasswordFailure2.js">file</a> |
<a href="/comm-central/annotate/5cdbadd8d714ab09c5180b59a9c457bc26746f64/mailnews/local/test/unit/test_pop3PasswordFailure2.js">annotate</a> |
<a href="/comm-central/diff/5cdbadd8d714ab09c5180b59a9c457bc26746f64/mailnews/local/test/unit/test_pop3PasswordFailure2.js">diff</a> |
<a href="/comm-central/comparison/5cdbadd8d714ab09c5180b59a9c457bc26746f64/mailnews/local/test/unit/test_pop3PasswordFailure2.js">comparison</a> |
<a href="/comm-central/log/5cdbadd8d714ab09c5180b59a9c457bc26746f64/mailnews/local/test/unit/test_pop3PasswordFailure2.js">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/5cdbadd8d714ab09c5180b59a9c457bc26746f64/mailnews/local/test/unit/test_pop3PasswordFailure3.js">mailnews/local/test/unit/test_pop3PasswordFailure3.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/5cdbadd8d714ab09c5180b59a9c457bc26746f64/mailnews/local/test/unit/test_pop3PasswordFailure3.js">file</a> |
<a href="/comm-central/annotate/5cdbadd8d714ab09c5180b59a9c457bc26746f64/mailnews/local/test/unit/test_pop3PasswordFailure3.js">annotate</a> |
<a href="/comm-central/diff/5cdbadd8d714ab09c5180b59a9c457bc26746f64/mailnews/local/test/unit/test_pop3PasswordFailure3.js">diff</a> |
<a href="/comm-central/comparison/5cdbadd8d714ab09c5180b59a9c457bc26746f64/mailnews/local/test/unit/test_pop3PasswordFailure3.js">comparison</a> |
<a href="/comm-central/log/5cdbadd8d714ab09c5180b59a9c457bc26746f64/mailnews/local/test/unit/test_pop3PasswordFailure3.js">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/5cdbadd8d714ab09c5180b59a9c457bc26746f64/mailnews/local/test/unit/test_pop3Pump.js">mailnews/local/test/unit/test_pop3Pump.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/5cdbadd8d714ab09c5180b59a9c457bc26746f64/mailnews/local/test/unit/test_pop3Pump.js">file</a> |
<a href="/comm-central/annotate/5cdbadd8d714ab09c5180b59a9c457bc26746f64/mailnews/local/test/unit/test_pop3Pump.js">annotate</a> |
<a href="/comm-central/diff/5cdbadd8d714ab09c5180b59a9c457bc26746f64/mailnews/local/test/unit/test_pop3Pump.js">diff</a> |
<a href="/comm-central/comparison/5cdbadd8d714ab09c5180b59a9c457bc26746f64/mailnews/local/test/unit/test_pop3Pump.js">comparison</a> |
<a href="/comm-central/log/5cdbadd8d714ab09c5180b59a9c457bc26746f64/mailnews/local/test/unit/test_pop3Pump.js">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/5cdbadd8d714ab09c5180b59a9c457bc26746f64/mailnews/local/test/unit/test_pop3ServerBrokenCRAMDisconnect.js">mailnews/local/test/unit/test_pop3ServerBrokenCRAMDisconnect.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/5cdbadd8d714ab09c5180b59a9c457bc26746f64/mailnews/local/test/unit/test_pop3ServerBrokenCRAMDisconnect.js">file</a> |
<a href="/comm-central/annotate/5cdbadd8d714ab09c5180b59a9c457bc26746f64/mailnews/local/test/unit/test_pop3ServerBrokenCRAMDisconnect.js">annotate</a> |
<a href="/comm-central/diff/5cdbadd8d714ab09c5180b59a9c457bc26746f64/mailnews/local/test/unit/test_pop3ServerBrokenCRAMDisconnect.js">diff</a> |
<a href="/comm-central/comparison/5cdbadd8d714ab09c5180b59a9c457bc26746f64/mailnews/local/test/unit/test_pop3ServerBrokenCRAMDisconnect.js">comparison</a> |
<a href="/comm-central/log/5cdbadd8d714ab09c5180b59a9c457bc26746f64/mailnews/local/test/unit/test_pop3ServerBrokenCRAMDisconnect.js">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/5cdbadd8d714ab09c5180b59a9c457bc26746f64/mailnews/local/test/unit/test_pop3ServerBrokenCRAMFail.js">mailnews/local/test/unit/test_pop3ServerBrokenCRAMFail.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/5cdbadd8d714ab09c5180b59a9c457bc26746f64/mailnews/local/test/unit/test_pop3ServerBrokenCRAMFail.js">file</a> |
<a href="/comm-central/annotate/5cdbadd8d714ab09c5180b59a9c457bc26746f64/mailnews/local/test/unit/test_pop3ServerBrokenCRAMFail.js">annotate</a> |
<a href="/comm-central/diff/5cdbadd8d714ab09c5180b59a9c457bc26746f64/mailnews/local/test/unit/test_pop3ServerBrokenCRAMFail.js">diff</a> |
<a href="/comm-central/comparison/5cdbadd8d714ab09c5180b59a9c457bc26746f64/mailnews/local/test/unit/test_pop3ServerBrokenCRAMFail.js">comparison</a> |
<a href="/comm-central/log/5cdbadd8d714ab09c5180b59a9c457bc26746f64/mailnews/local/test/unit/test_pop3ServerBrokenCRAMFail.js">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/5cdbadd8d714ab09c5180b59a9c457bc26746f64/mailnews/local/test/unit/test_preview.js">mailnews/local/test/unit/test_preview.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/5cdbadd8d714ab09c5180b59a9c457bc26746f64/mailnews/local/test/unit/test_preview.js">file</a> |
<a href="/comm-central/annotate/5cdbadd8d714ab09c5180b59a9c457bc26746f64/mailnews/local/test/unit/test_preview.js">annotate</a> |
<a href="/comm-central/diff/5cdbadd8d714ab09c5180b59a9c457bc26746f64/mailnews/local/test/unit/test_preview.js">diff</a> |
<a href="/comm-central/comparison/5cdbadd8d714ab09c5180b59a9c457bc26746f64/mailnews/local/test/unit/test_preview.js">comparison</a> |
<a href="/comm-central/log/5cdbadd8d714ab09c5180b59a9c457bc26746f64/mailnews/local/test/unit/test_preview.js">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/5cdbadd8d714ab09c5180b59a9c457bc26746f64/mailnews/local/test/unit/test_saveMessage.js">mailnews/local/test/unit/test_saveMessage.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/5cdbadd8d714ab09c5180b59a9c457bc26746f64/mailnews/local/test/unit/test_saveMessage.js">file</a> |
<a href="/comm-central/annotate/5cdbadd8d714ab09c5180b59a9c457bc26746f64/mailnews/local/test/unit/test_saveMessage.js">annotate</a> |
<a href="/comm-central/diff/5cdbadd8d714ab09c5180b59a9c457bc26746f64/mailnews/local/test/unit/test_saveMessage.js">diff</a> |
<a href="/comm-central/comparison/5cdbadd8d714ab09c5180b59a9c457bc26746f64/mailnews/local/test/unit/test_saveMessage.js">comparison</a> |
<a href="/comm-central/log/5cdbadd8d714ab09c5180b59a9c457bc26746f64/mailnews/local/test/unit/test_saveMessage.js">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/5cdbadd8d714ab09c5180b59a9c457bc26746f64/mailnews/local/test/unit/test_streamHeaders.js">mailnews/local/test/unit/test_streamHeaders.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/5cdbadd8d714ab09c5180b59a9c457bc26746f64/mailnews/local/test/unit/test_streamHeaders.js">file</a> |
<a href="/comm-central/annotate/5cdbadd8d714ab09c5180b59a9c457bc26746f64/mailnews/local/test/unit/test_streamHeaders.js">annotate</a> |
<a href="/comm-central/diff/5cdbadd8d714ab09c5180b59a9c457bc26746f64/mailnews/local/test/unit/test_streamHeaders.js">diff</a> |
<a href="/comm-central/comparison/5cdbadd8d714ab09c5180b59a9c457bc26746f64/mailnews/local/test/unit/test_streamHeaders.js">comparison</a> |
<a href="/comm-central/log/5cdbadd8d714ab09c5180b59a9c457bc26746f64/mailnews/local/test/unit/test_streamHeaders.js">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/5cdbadd8d714ab09c5180b59a9c457bc26746f64/mailnews/local/test/unit/test_undoDelete.js">mailnews/local/test/unit/test_undoDelete.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/5cdbadd8d714ab09c5180b59a9c457bc26746f64/mailnews/local/test/unit/test_undoDelete.js">file</a> |
<a href="/comm-central/annotate/5cdbadd8d714ab09c5180b59a9c457bc26746f64/mailnews/local/test/unit/test_undoDelete.js">annotate</a> |
<a href="/comm-central/diff/5cdbadd8d714ab09c5180b59a9c457bc26746f64/mailnews/local/test/unit/test_undoDelete.js">diff</a> |
<a href="/comm-central/comparison/5cdbadd8d714ab09c5180b59a9c457bc26746f64/mailnews/local/test/unit/test_undoDelete.js">comparison</a> |
<a href="/comm-central/log/5cdbadd8d714ab09c5180b59a9c457bc26746f64/mailnews/local/test/unit/test_undoDelete.js">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/5cdbadd8d714ab09c5180b59a9c457bc26746f64/mailnews/mime/test/unit/test_mimeStreaming.js">mailnews/mime/test/unit/test_mimeStreaming.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/5cdbadd8d714ab09c5180b59a9c457bc26746f64/mailnews/mime/test/unit/test_mimeStreaming.js">file</a> |
<a href="/comm-central/annotate/5cdbadd8d714ab09c5180b59a9c457bc26746f64/mailnews/mime/test/unit/test_mimeStreaming.js">annotate</a> |
<a href="/comm-central/diff/5cdbadd8d714ab09c5180b59a9c457bc26746f64/mailnews/mime/test/unit/test_mimeStreaming.js">diff</a> |
<a href="/comm-central/comparison/5cdbadd8d714ab09c5180b59a9c457bc26746f64/mailnews/mime/test/unit/test_mimeStreaming.js">comparison</a> |
<a href="/comm-central/log/5cdbadd8d714ab09c5180b59a9c457bc26746f64/mailnews/mime/test/unit/test_mimeStreaming.js">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/5cdbadd8d714ab09c5180b59a9c457bc26746f64/mailnews/test/resources/IMAPpump.js">mailnews/test/resources/IMAPpump.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/5cdbadd8d714ab09c5180b59a9c457bc26746f64/mailnews/test/resources/IMAPpump.js">file</a> |
<a href="/comm-central/annotate/5cdbadd8d714ab09c5180b59a9c457bc26746f64/mailnews/test/resources/IMAPpump.js">annotate</a> |
<a href="/comm-central/diff/5cdbadd8d714ab09c5180b59a9c457bc26746f64/mailnews/test/resources/IMAPpump.js">diff</a> |
<a href="/comm-central/comparison/5cdbadd8d714ab09c5180b59a9c457bc26746f64/mailnews/test/resources/IMAPpump.js">comparison</a> |
<a href="/comm-central/log/5cdbadd8d714ab09c5180b59a9c457bc26746f64/mailnews/test/resources/IMAPpump.js">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/5cdbadd8d714ab09c5180b59a9c457bc26746f64/mailnews/test/resources/POP3pump.js">mailnews/test/resources/POP3pump.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/5cdbadd8d714ab09c5180b59a9c457bc26746f64/mailnews/test/resources/POP3pump.js">file</a> |
<a href="/comm-central/annotate/5cdbadd8d714ab09c5180b59a9c457bc26746f64/mailnews/test/resources/POP3pump.js">annotate</a> |
<a href="/comm-central/diff/5cdbadd8d714ab09c5180b59a9c457bc26746f64/mailnews/test/resources/POP3pump.js">diff</a> |
<a href="/comm-central/comparison/5cdbadd8d714ab09c5180b59a9c457bc26746f64/mailnews/test/resources/POP3pump.js">comparison</a> |
<a href="/comm-central/log/5cdbadd8d714ab09c5180b59a9c457bc26746f64/mailnews/test/resources/POP3pump.js">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/5cdbadd8d714ab09c5180b59a9c457bc26746f64/mailnews/test/resources/localAccountUtils.js">mailnews/test/resources/localAccountUtils.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/5cdbadd8d714ab09c5180b59a9c457bc26746f64/mailnews/test/resources/localAccountUtils.js">file</a> |
<a href="/comm-central/annotate/5cdbadd8d714ab09c5180b59a9c457bc26746f64/mailnews/test/resources/localAccountUtils.js">annotate</a> |
<a href="/comm-central/diff/5cdbadd8d714ab09c5180b59a9c457bc26746f64/mailnews/test/resources/localAccountUtils.js">diff</a> |
<a href="/comm-central/comparison/5cdbadd8d714ab09c5180b59a9c457bc26746f64/mailnews/test/resources/localAccountUtils.js">comparison</a> |
<a href="/comm-central/log/5cdbadd8d714ab09c5180b59a9c457bc26746f64/mailnews/test/resources/localAccountUtils.js">revisions</a>
</td>
</tr>
</table></div>

<div class="page_body diffblocks"><div class="diffblock"><pre class="sourcelines">
<a href="#l1.1"></a><span id="l1.1" class="difflineminus">--- a/mailnews/base/test/unit/test_bccInDatabase.js</span>
<a href="#l1.2"></a><span id="l1.2" class="difflineplus">+++ b/mailnews/base/test/unit/test_bccInDatabase.js</span>
<a href="#l1.3"></a><span id="l1.3" class="difflineat">@@ -13,25 +13,27 @@ var hdr;</span>
<a href="#l1.4"></a><span id="l1.4"> function run_test()</span>
<a href="#l1.5"></a><span id="l1.5"> {</span>
<a href="#l1.6"></a><span id="l1.6">   localAccountUtils.loadLocalMailAccount();</span>
<a href="#l1.7"></a><span id="l1.7"> </span>
<a href="#l1.8"></a><span id="l1.8">   var copyListener = </span>
<a href="#l1.9"></a><span id="l1.9">   {</span>
<a href="#l1.10"></a><span id="l1.10">     OnStartCopy: function() {},</span>
<a href="#l1.11"></a><span id="l1.11">     OnProgress: function(aProgress, aProgressMax) {},</span>
<a href="#l1.12"></a><span id="l1.12" class="difflineminus">-    SetMessageKey: function(aKey) { hdr = gLocalInboxFolder.GetMessageHeader(aKey);},</span>
<a href="#l1.13"></a><span id="l1.13" class="difflineplus">+    SetMessageKey: function(aKey) {</span>
<a href="#l1.14"></a><span id="l1.14" class="difflineplus">+      hdr = localAccountUtils.inboxFolder.GetMessageHeader(aKey);</span>
<a href="#l1.15"></a><span id="l1.15" class="difflineplus">+    },</span>
<a href="#l1.16"></a><span id="l1.16">     SetMessageId: function(aMessageId) {},</span>
<a href="#l1.17"></a><span id="l1.17">     OnStopCopy: function(aStatus) { continueTest();}</span>
<a href="#l1.18"></a><span id="l1.18">   };</span>
<a href="#l1.19"></a><span id="l1.19"> </span>
<a href="#l1.20"></a><span id="l1.20">   // Get a message into the local filestore.</span>
<a href="#l1.21"></a><span id="l1.21">   var draft = do_get_file(&quot;../../../data/draft1&quot;);</span>
<a href="#l1.22"></a><span id="l1.22">   do_test_pending();</span>
<a href="#l1.23"></a><span id="l1.23" class="difflineminus">-  MailServices.copy.CopyFileMessage(draft, gLocalInboxFolder, null, false, 0,</span>
<a href="#l1.24"></a><span id="l1.24" class="difflineplus">+  MailServices.copy.CopyFileMessage(draft, localAccountUtils.inboxFolder, null, false, 0,</span>
<a href="#l1.25"></a><span id="l1.25">                                     &quot;&quot;, copyListener, null);</span>
<a href="#l1.26"></a><span id="l1.26"> }</span>
<a href="#l1.27"></a><span id="l1.27"> </span>
<a href="#l1.28"></a><span id="l1.28"> function continueTest()</span>
<a href="#l1.29"></a><span id="l1.29"> {</span>
<a href="#l1.30"></a><span id="l1.30">   //dump(&quot;\nbccList &gt;&quot; + hdr.bccList);</span>
<a href="#l1.31"></a><span id="l1.31">   //dump(&quot;\nccList &gt;&quot; + hdr.ccList);</span>
<a href="#l1.32"></a><span id="l1.32">   //dump(&quot;\n&quot;);</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l2.1"></a><span id="l2.1" class="difflineminus">--- a/mailnews/base/test/unit/test_bug404489.js</span>
<a href="#l2.2"></a><span id="l2.2" class="difflineplus">+++ b/mailnews/base/test/unit/test_bug404489.js</span>
<a href="#l2.3"></a><span id="l2.3" class="difflineat">@@ -67,17 +67,17 @@ function run_test()</span>
<a href="#l2.4"></a><span id="l2.4">     hdrs = gArrayHdrs;</span>
<a href="#l2.5"></a><span id="l2.5">   else</span>
<a href="#l2.6"></a><span id="l2.6">     hdrs = gArrayHdrs.join(&quot;: &quot;);</span>
<a href="#l2.7"></a><span id="l2.7">   Services.prefs.setCharPref(&quot;mailnews.customHeaders&quot;, hdrs);</span>
<a href="#l2.8"></a><span id="l2.8"> </span>
<a href="#l2.9"></a><span id="l2.9">   // Get a message into the local filestore. function continue_test() continues the testing after the copy.</span>
<a href="#l2.10"></a><span id="l2.10">   do_test_pending();</span>
<a href="#l2.11"></a><span id="l2.11">   var file = do_get_file(fileName);</span>
<a href="#l2.12"></a><span id="l2.12" class="difflineminus">-  MailServices.copy.CopyFileMessage(file, gLocalInboxFolder, null, false, 0,</span>
<a href="#l2.13"></a><span id="l2.13" class="difflineplus">+  MailServices.copy.CopyFileMessage(file, localAccountUtils.inboxFolder, null, false, 0,</span>
<a href="#l2.14"></a><span id="l2.14">                                     &quot;&quot;, copyListener, null);</span>
<a href="#l2.15"></a><span id="l2.15">   return true;</span>
<a href="#l2.16"></a><span id="l2.16"> }</span>
<a href="#l2.17"></a><span id="l2.17"> </span>
<a href="#l2.18"></a><span id="l2.18"> var copyListener =</span>
<a href="#l2.19"></a><span id="l2.19"> {</span>
<a href="#l2.20"></a><span id="l2.20">   OnStartCopy: function() {},</span>
<a href="#l2.21"></a><span id="l2.21">   OnProgress: function(aProgress, aProgressMax) {},</span>
<a href="#l2.22"></a><span id="l2.22" class="difflineat">@@ -88,17 +88,17 @@ var copyListener =</span>
<a href="#l2.23"></a><span id="l2.23"> </span>
<a href="#l2.24"></a><span id="l2.24"> // Runs at completion of each copy</span>
<a href="#l2.25"></a><span id="l2.25"> // process each test from queue, calls itself upon completion of each search</span>
<a href="#l2.26"></a><span id="l2.26"> var testObject;</span>
<a href="#l2.27"></a><span id="l2.27"> function continue_test()</span>
<a href="#l2.28"></a><span id="l2.28"> {</span>
<a href="#l2.29"></a><span id="l2.29">   var test = Tests.shift();</span>
<a href="#l2.30"></a><span id="l2.30">   if (test)</span>
<a href="#l2.31"></a><span id="l2.31" class="difflineminus">-    testObject = new TestSearchx(gLocalInboxFolder,</span>
<a href="#l2.32"></a><span id="l2.32" class="difflineplus">+    testObject = new TestSearchx(localAccountUtils.inboxFolder,</span>
<a href="#l2.33"></a><span id="l2.33">                                  test.testValue,</span>
<a href="#l2.34"></a><span id="l2.34">                                  test.attrib,</span>
<a href="#l2.35"></a><span id="l2.35">                                  test.op,</span>
<a href="#l2.36"></a><span id="l2.36">                                  test.count,</span>
<a href="#l2.37"></a><span id="l2.37">                                  continue_test);</span>
<a href="#l2.38"></a><span id="l2.38">   else</span>
<a href="#l2.39"></a><span id="l2.39">   {</span>
<a href="#l2.40"></a><span id="l2.40">     testObject = null;</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l3.1"></a><span id="l3.1" class="difflineminus">--- a/mailnews/base/test/unit/test_bug428427.js</span>
<a href="#l3.2"></a><span id="l3.2" class="difflineplus">+++ b/mailnews/base/test/unit/test_bug428427.js</span>
<a href="#l3.3"></a><span id="l3.3" class="difflineat">@@ -24,36 +24,36 @@ var tag1 = &quot;istag&quot;;</span>
<a href="#l3.4"></a><span id="l3.4"> function run_test()</span>
<a href="#l3.5"></a><span id="l3.5"> {</span>
<a href="#l3.6"></a><span id="l3.6">   localAccountUtils.loadLocalMailAccount();</span>
<a href="#l3.7"></a><span id="l3.7">     </span>
<a href="#l3.8"></a><span id="l3.8">   // Get messageCount messages into the local filestore.</span>
<a href="#l3.9"></a><span id="l3.9">   do_test_pending();</span>
<a href="#l3.10"></a><span id="l3.10"> </span>
<a href="#l3.11"></a><span id="l3.11">   // function setupVirtualFolder() continues the testing after CopyFileMessage.</span>
<a href="#l3.12"></a><span id="l3.12" class="difflineminus">-  MailServices.copy.CopyFileMessage(bugmail1, gLocalInboxFolder, null, false, 0,</span>
<a href="#l3.13"></a><span id="l3.13" class="difflineminus">-                                    &quot;&quot;, copyListener, null);</span>
<a href="#l3.14"></a><span id="l3.14" class="difflineplus">+  MailServices.copy.CopyFileMessage(bugmail1, localAccountUtils.inboxFolder, null, false,</span>
<a href="#l3.15"></a><span id="l3.15" class="difflineplus">+                                    0, &quot;&quot;, copyListener, null);</span>
<a href="#l3.16"></a><span id="l3.16">   return true;</span>
<a href="#l3.17"></a><span id="l3.17"> }</span>
<a href="#l3.18"></a><span id="l3.18"> </span>
<a href="#l3.19"></a><span id="l3.19"> // nsIMsgCopyServiceListener implementation</span>
<a href="#l3.20"></a><span id="l3.20"> var copyListener = </span>
<a href="#l3.21"></a><span id="l3.21"> {</span>
<a href="#l3.22"></a><span id="l3.22">   OnStartCopy: function() {},</span>
<a href="#l3.23"></a><span id="l3.23">   OnProgress: function(aProgress, aProgressMax) {},</span>
<a href="#l3.24"></a><span id="l3.24">   SetMessageKey: function(aKey)</span>
<a href="#l3.25"></a><span id="l3.25">   {</span>
<a href="#l3.26"></a><span id="l3.26" class="difflineminus">-    hdrs.push(gLocalInboxFolder.GetMessageHeader(aKey));</span>
<a href="#l3.27"></a><span id="l3.27" class="difflineplus">+    hdrs.push(localAccountUtils.inboxFolder.GetMessageHeader(aKey));</span>
<a href="#l3.28"></a><span id="l3.28">   },</span>
<a href="#l3.29"></a><span id="l3.29">   SetMessageId: function(aMessageId) {},</span>
<a href="#l3.30"></a><span id="l3.30">   OnStopCopy: function(aStatus)</span>
<a href="#l3.31"></a><span id="l3.31">   {</span>
<a href="#l3.32"></a><span id="l3.32">     if (--messageCount)</span>
<a href="#l3.33"></a><span id="l3.33" class="difflineminus">-      MailServices.copy.CopyFileMessage(bugmail1, gLocalInboxFolder, null, false, 0,</span>
<a href="#l3.34"></a><span id="l3.34" class="difflineminus">-                                  &quot;&quot;, copyListener, null);</span>
<a href="#l3.35"></a><span id="l3.35" class="difflineplus">+      MailServices.copy.CopyFileMessage(bugmail1, localAccountUtils.inboxFolder, null,</span>
<a href="#l3.36"></a><span id="l3.36" class="difflineplus">+                                  false, 0, &quot;&quot;, copyListener, null);</span>
<a href="#l3.37"></a><span id="l3.37">     else {</span>
<a href="#l3.38"></a><span id="l3.38">       try {</span>
<a href="#l3.39"></a><span id="l3.39">       setupVirtualFolder();</span>
<a href="#l3.40"></a><span id="l3.40">       } catch (ex) {dump(ex);}</span>
<a href="#l3.41"></a><span id="l3.41">     }</span>
<a href="#l3.42"></a><span id="l3.42">   }</span>
<a href="#l3.43"></a><span id="l3.43"> };</span>
<a href="#l3.44"></a><span id="l3.44"> </span>
<a href="#l3.45"></a><span id="l3.45" class="difflineat">@@ -66,43 +66,45 @@ function setupVirtualFolder()</span>
<a href="#l3.46"></a><span id="l3.46"> {</span>
<a href="#l3.47"></a><span id="l3.47">   // add as valid tag tag1, though probably not really necessary</span>
<a href="#l3.48"></a><span id="l3.48">   MailServices.tags.addTagForKey(tag1, tag1, null, null);</span>
<a href="#l3.49"></a><span id="l3.49">   </span>
<a href="#l3.50"></a><span id="l3.50">   // add tag1 to 4 messages</span>
<a href="#l3.51"></a><span id="l3.51">   var messages0to3 = Cc[&quot;@mozilla.org/array;1&quot;].createInstance(Ci.nsIMutableArray);</span>
<a href="#l3.52"></a><span id="l3.52">   for (var i = 0; i &lt;= 3; i++)</span>
<a href="#l3.53"></a><span id="l3.53">     messages0to3.appendElement(hdrs[i], false);</span>
<a href="#l3.54"></a><span id="l3.54" class="difflineminus">-  gLocalInboxFolder.addKeywordsToMessages(messages0to3, tag1);</span>
<a href="#l3.55"></a><span id="l3.55" class="difflineplus">+  localAccountUtils.inboxFolder.addKeywordsToMessages(messages0to3, tag1);</span>
<a href="#l3.56"></a><span id="l3.56"> </span>
<a href="#l3.57"></a><span id="l3.57">   // set 3 messages unread, 2 messages read</span>
<a href="#l3.58"></a><span id="l3.58">   var messages0to2 = Cc[&quot;@mozilla.org/array;1&quot;].createInstance(Ci.nsIMutableArray);</span>
<a href="#l3.59"></a><span id="l3.59">   for (i = 0; i &lt;= 2; i++)</span>
<a href="#l3.60"></a><span id="l3.60">     messages0to2.appendElement(hdrs[i], false);</span>
<a href="#l3.61"></a><span id="l3.61" class="difflineminus">-  gLocalInboxFolder.markMessagesRead(messages0to2, false);</span>
<a href="#l3.62"></a><span id="l3.62" class="difflineplus">+  localAccountUtils.inboxFolder.markMessagesRead(messages0to2, false);</span>
<a href="#l3.63"></a><span id="l3.63"> </span>
<a href="#l3.64"></a><span id="l3.64">   var messages3to4 = Cc[&quot;@mozilla.org/array;1&quot;].createInstance(Ci.nsIMutableArray);</span>
<a href="#l3.65"></a><span id="l3.65">   for (i = 3; i &lt;= 4; i++)</span>
<a href="#l3.66"></a><span id="l3.66">     messages3to4.appendElement(hdrs[i], false);</span>
<a href="#l3.67"></a><span id="l3.67" class="difflineminus">-  gLocalInboxFolder.markMessagesRead(messages3to4, true);</span>
<a href="#l3.68"></a><span id="l3.68" class="difflineplus">+  localAccountUtils.inboxFolder.markMessagesRead(messages3to4, true);</span>
<a href="#l3.69"></a><span id="l3.69"> </span>
<a href="#l3.70"></a><span id="l3.70">   // search will look for tag tag1 in the inbox folder</span>
<a href="#l3.71"></a><span id="l3.71" class="difflineminus">-  var searchTerm = makeSearchTerm(gLocalInboxFolder, tag1, </span>
<a href="#l3.72"></a><span id="l3.72" class="difflineplus">+  var searchTerm = makeSearchTerm(localAccountUtils.inboxFolder, tag1,</span>
<a href="#l3.73"></a><span id="l3.73">     Ci.nsMsgSearchAttrib.Keywords, Ci.nsMsgSearchOp.Contains);</span>
<a href="#l3.74"></a><span id="l3.74">     </span>
<a href="#l3.75"></a><span id="l3.75">   dump(&quot;creating virtual folder\n&quot;);</span>
<a href="#l3.76"></a><span id="l3.76">   var rootFolder = localAccountUtils.incomingServer.rootMsgFolder;</span>
<a href="#l3.77"></a><span id="l3.77" class="difflineminus">-  virtualFolder = CreateVirtualFolder(&quot;VfTest&quot;, rootFolder, gLocalInboxFolder.URI, searchTerm, false);</span>
<a href="#l3.78"></a><span id="l3.78" class="difflineplus">+  virtualFolder = CreateVirtualFolder(&quot;VfTest&quot;, rootFolder,</span>
<a href="#l3.79"></a><span id="l3.79" class="difflineplus">+                                      localAccountUtils.inboxFolder.URI, searchTerm, false);</span>
<a href="#l3.80"></a><span id="l3.80">   var count= new Object;</span>
<a href="#l3.81"></a><span id="l3.81">   // Setup search session. Execution continues with testVirtualFolder()</span>
<a href="#l3.82"></a><span id="l3.82">   // after search is done.</span>
<a href="#l3.83"></a><span id="l3.83">   </span>
<a href="#l3.84"></a><span id="l3.84">   var searchSession = Cc[&quot;@mozilla.org/messenger/searchSession;1&quot;]</span>
<a href="#l3.85"></a><span id="l3.85">                         .createInstance(Ci.nsIMsgSearchSession);</span>
<a href="#l3.86"></a><span id="l3.86" class="difflineminus">-  searchSession.addScopeTerm(Ci.nsMsgSearchScope.offlineMail, gLocalInboxFolder);</span>
<a href="#l3.87"></a><span id="l3.87" class="difflineplus">+  searchSession.addScopeTerm(Ci.nsMsgSearchScope.offlineMail,</span>
<a href="#l3.88"></a><span id="l3.88" class="difflineplus">+                             localAccountUtils.inboxFolder);</span>
<a href="#l3.89"></a><span id="l3.89">   searchSession.appendTerm(searchTerm, false);</span>
<a href="#l3.90"></a><span id="l3.90">   searchSession.registerListener(searchListener);</span>
<a href="#l3.91"></a><span id="l3.91">   dump(&quot;starting search of vf\n&quot;);</span>
<a href="#l3.92"></a><span id="l3.92">   searchSession.search(null);</span>
<a href="#l3.93"></a><span id="l3.93"> }</span>
<a href="#l3.94"></a><span id="l3.94"> </span>
<a href="#l3.95"></a><span id="l3.95"> // partially based on gSearchNotificationListener in searchBar.js</span>
<a href="#l3.96"></a><span id="l3.96"> // nsIMsgSearchNotify implementation</span>
<a href="#l3.97"></a><span id="l3.97" class="difflineat">@@ -142,28 +144,28 @@ function testVirtualFolder()</span>
<a href="#l3.98"></a><span id="l3.98">   do_check_eq(4, virtualFolder.getTotalMessages(false));</span>
<a href="#l3.99"></a><span id="l3.99">   </span>
<a href="#l3.100"></a><span id="l3.100">   // total unread messages in search</span>
<a href="#l3.101"></a><span id="l3.101">   do_check_eq(3, virtualFolder.getNumUnread(false));</span>
<a href="#l3.102"></a><span id="l3.102"> </span>
<a href="#l3.103"></a><span id="l3.103">   // change unread of one item in search to decrease count</span>
<a href="#l3.104"></a><span id="l3.104">   var message0 = Cc[&quot;@mozilla.org/array;1&quot;].createInstance(Ci.nsIMutableArray);</span>
<a href="#l3.105"></a><span id="l3.105">   message0.appendElement(hdrs[0], false);</span>
<a href="#l3.106"></a><span id="l3.106" class="difflineminus">-  gLocalInboxFolder.markMessagesRead(message0, true);</span>
<a href="#l3.107"></a><span id="l3.107" class="difflineplus">+  localAccountUtils.inboxFolder.markMessagesRead(message0, true);</span>
<a href="#l3.108"></a><span id="l3.108">   virtualFolder.updateSummaryTotals(true);</span>
<a href="#l3.109"></a><span id="l3.109"> </span>
<a href="#l3.110"></a><span id="l3.110">   do_check_eq(2, virtualFolder.getNumUnread(false));</span>
<a href="#l3.111"></a><span id="l3.111">   </span>
<a href="#l3.112"></a><span id="l3.112">   /*** failures fixed in this bug ***/</span>
<a href="#l3.113"></a><span id="l3.113">    </span>
<a href="#l3.114"></a><span id="l3.114">   // remove tag from one item to decrease count</span>
<a href="#l3.115"></a><span id="l3.115">   var message1 = Cc[&quot;@mozilla.org/array;1&quot;].createInstance(Ci.nsIMutableArray);</span>
<a href="#l3.116"></a><span id="l3.116">   message1.appendElement(hdrs[1], false);</span>
<a href="#l3.117"></a><span id="l3.117"> </span>
<a href="#l3.118"></a><span id="l3.118" class="difflineminus">-  gLocalInboxFolder.removeKeywordsFromMessages(message1, tag1);</span>
<a href="#l3.119"></a><span id="l3.119" class="difflineplus">+  localAccountUtils.inboxFolder.removeKeywordsFromMessages(message1, tag1);</span>
<a href="#l3.120"></a><span id="l3.120">   virtualFolder.updateSummaryTotals(true);</span>
<a href="#l3.121"></a><span id="l3.121">   do_check_eq(3, virtualFolder.getTotalMessages(false));</span>
<a href="#l3.122"></a><span id="l3.122">   do_check_eq(1, virtualFolder.getNumUnread(false));</span>
<a href="#l3.123"></a><span id="l3.123"> </span>
<a href="#l3.124"></a><span id="l3.124">   // End of test, so release our header references</span>
<a href="#l3.125"></a><span id="l3.125">   hdrs = null;</span>
<a href="#l3.126"></a><span id="l3.126"> </span>
<a href="#l3.127"></a><span id="l3.127">   do_test_finished();</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l4.1"></a><span id="l4.1" class="difflineminus">--- a/mailnews/base/test/unit/test_bug434810.js</span>
<a href="#l4.2"></a><span id="l4.2" class="difflineplus">+++ b/mailnews/base/test/unit/test_bug434810.js</span>
<a href="#l4.3"></a><span id="l4.3" class="difflineat">@@ -18,10 +18,10 @@ function run_test()</span>
<a href="#l4.4"></a><span id="l4.4"> </span>
<a href="#l4.5"></a><span id="l4.5">   // These two MailNews adds by default</span>
<a href="#l4.6"></a><span id="l4.6">   expectedFolders.push(msgProps.GetStringFromName(&quot;outboxFolderName&quot;));</span>
<a href="#l4.7"></a><span id="l4.7">   expectedFolders.push(msgProps.GetStringFromName(&quot;trashFolderName&quot;));</span>
<a href="#l4.8"></a><span id="l4.8"> </span>
<a href="#l4.9"></a><span id="l4.9">   do_check_eq(rootFolder.numSubFolders, expectedFolders.length);</span>
<a href="#l4.10"></a><span id="l4.10">   for (var i = 0; i &lt; expectedFolders.length; ++i)</span>
<a href="#l4.11"></a><span id="l4.11">     do_check_true(rootFolder.containsChildNamed(expectedFolders[i]));</span>
<a href="#l4.12"></a><span id="l4.12" class="difflineminus">-  do_check_true(rootFolder.isAncestorOf(gLocalInboxFolder));</span>
<a href="#l4.13"></a><span id="l4.13" class="difflineplus">+  do_check_true(rootFolder.isAncestorOf(localAccountUtils.inboxFolder));</span>
<a href="#l4.14"></a><span id="l4.14"> }</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l5.1"></a><span id="l5.1" class="difflineminus">--- a/mailnews/base/test/unit/test_bug465805.js</span>
<a href="#l5.2"></a><span id="l5.2" class="difflineplus">+++ b/mailnews/base/test/unit/test_bug465805.js</span>
<a href="#l5.3"></a><span id="l5.3" class="difflineat">@@ -54,35 +54,35 @@ var copyListener =</span>
<a href="#l5.4"></a><span id="l5.4">   SetMessageKey: function(aKey) {},</span>
<a href="#l5.5"></a><span id="l5.5">   SetMessageId: function(aMessageId) {},</span>
<a href="#l5.6"></a><span id="l5.6">   OnStopCopy: function(aStatus) </span>
<a href="#l5.7"></a><span id="l5.7">   {</span>
<a href="#l5.8"></a><span id="l5.8">     let fileName = Files.shift();</span>
<a href="#l5.9"></a><span id="l5.9">     if (fileName)</span>
<a href="#l5.10"></a><span id="l5.10">     { </span>
<a href="#l5.11"></a><span id="l5.11">       let file = do_get_file(fileName);</span>
<a href="#l5.12"></a><span id="l5.12" class="difflineminus">-      MailServices.copy.CopyFileMessage(file, gLocalInboxFolder, null, false, 0,</span>
<a href="#l5.13"></a><span id="l5.13" class="difflineminus">-                                        &quot;&quot;, copyListener, null);</span>
<a href="#l5.14"></a><span id="l5.14" class="difflineplus">+      MailServices.copy.CopyFileMessage(file, localAccountUtils.inboxFolder, null,</span>
<a href="#l5.15"></a><span id="l5.15" class="difflineplus">+                                        false, 0, &quot;&quot;, copyListener, null);</span>
<a href="#l5.16"></a><span id="l5.16">     }</span>
<a href="#l5.17"></a><span id="l5.17">     else</span>
<a href="#l5.18"></a><span id="l5.18">       testBodySearch();</span>
<a href="#l5.19"></a><span id="l5.19">   }</span>
<a href="#l5.20"></a><span id="l5.20"> };</span>
<a href="#l5.21"></a><span id="l5.21"> </span>
<a href="#l5.22"></a><span id="l5.22"> // Runs at completion of copy</span>
<a href="#l5.23"></a><span id="l5.23"> </span>
<a href="#l5.24"></a><span id="l5.24"> // process each test from queue, calls itself upon completion of each search</span>
<a href="#l5.25"></a><span id="l5.25"> var testObject;</span>
<a href="#l5.26"></a><span id="l5.26"> function testBodySearch()</span>
<a href="#l5.27"></a><span id="l5.27"> {</span>
<a href="#l5.28"></a><span id="l5.28">   print(&quot;Test Body Search&quot;);</span>
<a href="#l5.29"></a><span id="l5.29">   var test = Tests.shift();</span>
<a href="#l5.30"></a><span id="l5.30">   if (test)</span>
<a href="#l5.31"></a><span id="l5.31">   {</span>
<a href="#l5.32"></a><span id="l5.32" class="difflineminus">-    testObject = new TestSearch(gLocalInboxFolder,</span>
<a href="#l5.33"></a><span id="l5.33" class="difflineplus">+    testObject = new TestSearch(localAccountUtils.inboxFolder,</span>
<a href="#l5.34"></a><span id="l5.34">                          test.value,</span>
<a href="#l5.35"></a><span id="l5.35">                          test.attrib,</span>
<a href="#l5.36"></a><span id="l5.36">                          test.op,</span>
<a href="#l5.37"></a><span id="l5.37">                          test.count,</span>
<a href="#l5.38"></a><span id="l5.38">                          testBodySearch);</span>
<a href="#l5.39"></a><span id="l5.39">   }</span>
<a href="#l5.40"></a><span id="l5.40">   else</span>
<a href="#l5.41"></a><span id="l5.41">     do_test_finished();</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l6.1"></a><span id="l6.1" class="difflineminus">--- a/mailnews/base/test/unit/test_bug471682.js</span>
<a href="#l6.2"></a><span id="l6.2" class="difflineplus">+++ b/mailnews/base/test/unit/test_bug471682.js</span>
<a href="#l6.3"></a><span id="l6.3" class="difflineat">@@ -10,53 +10,53 @@</span>
<a href="#l6.4"></a><span id="l6.4">  */</span>
<a href="#l6.5"></a><span id="l6.5"> Components.utils.import(&quot;resource:///modules/mailServices.js&quot;);</span>
<a href="#l6.6"></a><span id="l6.6"> </span>
<a href="#l6.7"></a><span id="l6.7"> const bugmail1 = do_get_file(&quot;../../../data/bugmail1&quot;);</span>
<a href="#l6.8"></a><span id="l6.8"> var gHdr; // header of test message in local folder</span>
<a href="#l6.9"></a><span id="l6.9"> </span>
<a href="#l6.10"></a><span id="l6.10"> localAccountUtils.loadLocalMailAccount();</span>
<a href="#l6.11"></a><span id="l6.11"> // create a subfolder as a target for copies</span>
<a href="#l6.12"></a><span id="l6.12" class="difflineminus">-var gSubfolder = gLocalInboxFolder.createLocalSubfolder(&quot;subfolder&quot;);</span>
<a href="#l6.13"></a><span id="l6.13" class="difflineplus">+var gSubfolder = localAccountUtils.inboxFolder.createLocalSubfolder(&quot;subfolder&quot;);</span>
<a href="#l6.14"></a><span id="l6.14"> </span>
<a href="#l6.15"></a><span id="l6.15"> function run_test()</span>
<a href="#l6.16"></a><span id="l6.16"> {</span>
<a href="#l6.17"></a><span id="l6.17">   // make sure we're using berkeley mailbox format here since this test</span>
<a href="#l6.18"></a><span id="l6.18">   // assumes berkeley mailbox format.</span>
<a href="#l6.19"></a><span id="l6.19">   if (Services.prefs.getCharPref(&quot;mail.serverDefaultStoreContractID&quot;) !=</span>
<a href="#l6.20"></a><span id="l6.20">       &quot;@mozilla.org/msgstore/berkeleystore;1&quot;)</span>
<a href="#l6.21"></a><span id="l6.21">     return;</span>
<a href="#l6.22"></a><span id="l6.22"> </span>
<a href="#l6.23"></a><span id="l6.23">   do_test_pending();</span>
<a href="#l6.24"></a><span id="l6.24">   // step 1: copy a message into the local inbox</span>
<a href="#l6.25"></a><span id="l6.25" class="difflineminus">-  MailServices.copy.CopyFileMessage(bugmail1, gLocalInboxFolder, null,</span>
<a href="#l6.26"></a><span id="l6.26" class="difflineplus">+  MailServices.copy.CopyFileMessage(bugmail1, localAccountUtils.inboxFolder, null,</span>
<a href="#l6.27"></a><span id="l6.27">                                     false, 0, &quot;&quot;, step2, null);</span>
<a href="#l6.28"></a><span id="l6.28">   return;</span>
<a href="#l6.29"></a><span id="l6.29"> }</span>
<a href="#l6.30"></a><span id="l6.30"> </span>
<a href="#l6.31"></a><span id="l6.31"> // step 2: copy one message into a subfolder to establish an</span>
<a href="#l6.32"></a><span id="l6.32"> //         mbox file time and size</span>
<a href="#l6.33"></a><span id="l6.33"> // nsIMsgCopyServiceListener implementation</span>
<a href="#l6.34"></a><span id="l6.34"> var step2 = </span>
<a href="#l6.35"></a><span id="l6.35"> {</span>
<a href="#l6.36"></a><span id="l6.36">   OnStartCopy: function() {},</span>
<a href="#l6.37"></a><span id="l6.37">   OnProgress: function(aProgress, aProgressMax) {},</span>
<a href="#l6.38"></a><span id="l6.38">   SetMessageKey: function(aKey)</span>
<a href="#l6.39"></a><span id="l6.39">   {</span>
<a href="#l6.40"></a><span id="l6.40">     dump(&quot;in set message key\n&quot;);</span>
<a href="#l6.41"></a><span id="l6.41" class="difflineminus">-    gHdr = gLocalInboxFolder.GetMessageHeader(aKey);</span>
<a href="#l6.42"></a><span id="l6.42" class="difflineplus">+    gHdr = localAccountUtils.inboxFolder.GetMessageHeader(aKey);</span>
<a href="#l6.43"></a><span id="l6.43">   },</span>
<a href="#l6.44"></a><span id="l6.44">   SetMessageId: function(aMessageId) {},</span>
<a href="#l6.45"></a><span id="l6.45">   OnStopCopy: function(aStatus)</span>
<a href="#l6.46"></a><span id="l6.46">   {</span>
<a href="#l6.47"></a><span id="l6.47">     do_check_neq(gHdr, null);</span>
<a href="#l6.48"></a><span id="l6.48">     // copy the message into the subfolder</span>
<a href="#l6.49"></a><span id="l6.49">     var messages = Cc[&quot;@mozilla.org/array;1&quot;].createInstance(Ci.nsIMutableArray);</span>
<a href="#l6.50"></a><span id="l6.50">     messages.appendElement(gHdr, false);</span>
<a href="#l6.51"></a><span id="l6.51" class="difflineminus">-    MailServices.copy.CopyMessages(gLocalInboxFolder, messages, gSubfolder,</span>
<a href="#l6.52"></a><span id="l6.52" class="difflineplus">+    MailServices.copy.CopyMessages(localAccountUtils.inboxFolder, messages, gSubfolder,</span>
<a href="#l6.53"></a><span id="l6.53">                                    false, step3, null, false);</span>
<a href="#l6.54"></a><span id="l6.54">   }</span>
<a href="#l6.55"></a><span id="l6.55"> };</span>
<a href="#l6.56"></a><span id="l6.56"> </span>
<a href="#l6.57"></a><span id="l6.57"> // step 3: after the copy, delay to allow copy to complete and allow possible</span>
<a href="#l6.58"></a><span id="l6.58"> //         file error time</span>
<a href="#l6.59"></a><span id="l6.59"> // nsIMsgCopyServiceListener implementation</span>
<a href="#l6.60"></a><span id="l6.60"> var step3 = </span>
<a href="#l6.61"></a><span id="l6.61" class="difflineat">@@ -71,17 +71,17 @@ var step3 =</span>
<a href="#l6.62"></a><span id="l6.62">   }</span>
<a href="#l6.63"></a><span id="l6.63"> }</span>
<a href="#l6.64"></a><span id="l6.64"> </span>
<a href="#l6.65"></a><span id="l6.65"> // step 4: start a second copy</span>
<a href="#l6.66"></a><span id="l6.66"> function step4()</span>
<a href="#l6.67"></a><span id="l6.67"> {</span>
<a href="#l6.68"></a><span id="l6.68">   var messages = Cc[&quot;@mozilla.org/array;1&quot;].createInstance(Ci.nsIMutableArray);</span>
<a href="#l6.69"></a><span id="l6.69">   messages.appendElement(gHdr, false);</span>
<a href="#l6.70"></a><span id="l6.70" class="difflineminus">-  MailServices.copy.CopyMessages(gLocalInboxFolder, messages, gSubfolder,</span>
<a href="#l6.71"></a><span id="l6.71" class="difflineplus">+  MailServices.copy.CopyMessages(localAccountUtils.inboxFolder, messages, gSubfolder,</span>
<a href="#l6.72"></a><span id="l6.72">                                  false, step5, null, false);</span>
<a href="#l6.73"></a><span id="l6.73"> }</span>
<a href="#l6.74"></a><span id="l6.74"> </span>
<a href="#l6.75"></a><span id="l6.75"> // step 5:  actual tests of file size and date</span>
<a href="#l6.76"></a><span id="l6.76"> // nsIMsgCopyServiceListener implementation</span>
<a href="#l6.77"></a><span id="l6.77"> var step5 = </span>
<a href="#l6.78"></a><span id="l6.78"> {</span>
<a href="#l6.79"></a><span id="l6.79">   OnStartCopy: function() {},</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l7.1"></a><span id="l7.1" class="difflineminus">--- a/mailnews/base/test/unit/test_copyChaining.js</span>
<a href="#l7.2"></a><span id="l7.2" class="difflineplus">+++ b/mailnews/base/test/unit/test_copyChaining.js</span>
<a href="#l7.3"></a><span id="l7.3" class="difflineat">@@ -53,17 +53,17 @@ function run_test()</span>
<a href="#l7.4"></a><span id="l7.4">   localAccountUtils.loadLocalMailAccount();</span>
<a href="#l7.5"></a><span id="l7.5">   let messageGenerator = new MessageGenerator();</span>
<a href="#l7.6"></a><span id="l7.6">   let scenarioFactory = new MessageScenarioFactory(messageGenerator);</span>
<a href="#l7.7"></a><span id="l7.7"> </span>
<a href="#l7.8"></a><span id="l7.8">   // &quot;Master&quot; do_test_pending(), paired with a do_test_finished() at the end of</span>
<a href="#l7.9"></a><span id="l7.9">   // all the operations.</span>
<a href="#l7.10"></a><span id="l7.10">   do_test_pending();</span>
<a href="#l7.11"></a><span id="l7.11"> </span>
<a href="#l7.12"></a><span id="l7.12" class="difflineminus">-  gCopyDest = gLocalInboxFolder.createLocalSubfolder(&quot;copyDest&quot;);</span>
<a href="#l7.13"></a><span id="l7.13" class="difflineplus">+  gCopyDest = localAccountUtils.inboxFolder.createLocalSubfolder(&quot;copyDest&quot;);</span>
<a href="#l7.14"></a><span id="l7.14">   // build up a diverse list of messages</span>
<a href="#l7.15"></a><span id="l7.15">   let messages = [];</span>
<a href="#l7.16"></a><span id="l7.16">   messages = messages.concat(scenarioFactory.directReply(10));</span>
<a href="#l7.17"></a><span id="l7.17">   gCopySource = localAccountUtils.incomingServer</span>
<a href="#l7.18"></a><span id="l7.18">                                  .rootMsgFolder.createLocalSubfolder(&quot;copySource&quot;);</span>
<a href="#l7.19"></a><span id="l7.19">   addMessagesToFolder(messages, gCopySource);</span>
<a href="#l7.20"></a><span id="l7.20"> </span>
<a href="#l7.21"></a><span id="l7.21">   mailTestUtils.updateFolderAndNotify(gCopySource, doTest);</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l8.1"></a><span id="l8.1" class="difflineminus">--- a/mailnews/base/test/unit/test_copyThenMoveManual.js</span>
<a href="#l8.2"></a><span id="l8.2" class="difflineplus">+++ b/mailnews/base/test/unit/test_copyThenMoveManual.js</span>
<a href="#l8.3"></a><span id="l8.3" class="difflineat">@@ -44,53 +44,53 @@ const gTestArray =</span>
<a href="#l8.4"></a><span id="l8.4">     gPOP3Pump.onDone = doTest;</span>
<a href="#l8.5"></a><span id="l8.5">     ++gCurTestNum;</span>
<a href="#l8.6"></a><span id="l8.6">     gPOP3Pump.run();</span>
<a href="#l8.7"></a><span id="l8.7">   },</span>
<a href="#l8.8"></a><span id="l8.8">   // test applying filters to a message header</span>
<a href="#l8.9"></a><span id="l8.9">   function applyFilters() {</span>
<a href="#l8.10"></a><span id="l8.10">     let messages = Cc[&quot;@mozilla.org/array;1&quot;]</span>
<a href="#l8.11"></a><span id="l8.11">                      .createInstance(Ci.nsIMutableArray);</span>
<a href="#l8.12"></a><span id="l8.12" class="difflineminus">-    messages.appendElement(gLocalInboxFolder.firstNewMessage, false);</span>
<a href="#l8.13"></a><span id="l8.13" class="difflineplus">+    messages.appendElement(localAccountUtils.inboxFolder.firstNewMessage, false);</span>
<a href="#l8.14"></a><span id="l8.14">     ++gCurTestNum;</span>
<a href="#l8.15"></a><span id="l8.15">     MailServices.filters.applyFilters(Ci.nsMsgFilterType.Manual,</span>
<a href="#l8.16"></a><span id="l8.16" class="difflineminus">-                                      messages, gLocalInboxFolder, null);</span>
<a href="#l8.17"></a><span id="l8.17" class="difflineplus">+                                      messages, localAccountUtils.inboxFolder, null);</span>
<a href="#l8.18"></a><span id="l8.18">   },</span>
<a href="#l8.19"></a><span id="l8.19">   function verifyFolders1() {</span>
<a href="#l8.20"></a><span id="l8.20">     // Copy and Move should each now have 1 message in them.</span>
<a href="#l8.21"></a><span id="l8.21">     do_check_eq(folderCount(gCopyFolder), 1);</span>
<a href="#l8.22"></a><span id="l8.22">     do_check_eq(folderCount(gMoveFolder), 1);</span>
<a href="#l8.23"></a><span id="l8.23">     // the local inbox folder should now be empty, since the second</span>
<a href="#l8.24"></a><span id="l8.24">     // operation was a move</span>
<a href="#l8.25"></a><span id="l8.25" class="difflineminus">-    do_check_eq(folderCount(gLocalInboxFolder), 0);</span>
<a href="#l8.26"></a><span id="l8.26" class="difflineplus">+    do_check_eq(folderCount(localAccountUtils.inboxFolder), 0);</span>
<a href="#l8.27"></a><span id="l8.27">     ++gCurTestNum;</span>
<a href="#l8.28"></a><span id="l8.28">     doTest();</span>
<a href="#l8.29"></a><span id="l8.29">   },</span>
<a href="#l8.30"></a><span id="l8.30">   // just get a message into the local folder</span>
<a href="#l8.31"></a><span id="l8.31">   function getLocalMessages2() {</span>
<a href="#l8.32"></a><span id="l8.32">     gPOP3Pump.files = gFiles;</span>
<a href="#l8.33"></a><span id="l8.33">     gPOP3Pump.onDone = doTest;</span>
<a href="#l8.34"></a><span id="l8.34">     ++gCurTestNum;</span>
<a href="#l8.35"></a><span id="l8.35">     gPOP3Pump.run();</span>
<a href="#l8.36"></a><span id="l8.36">   },</span>
<a href="#l8.37"></a><span id="l8.37">   // use the alternate call into the filter service</span>
<a href="#l8.38"></a><span id="l8.38">   function applyFiltersToFolders() {</span>
<a href="#l8.39"></a><span id="l8.39">     let folders = Cc[&quot;@mozilla.org/array;1&quot;]</span>
<a href="#l8.40"></a><span id="l8.40">                     .createInstance(Ci.nsIMutableArray);</span>
<a href="#l8.41"></a><span id="l8.41" class="difflineminus">-    folders.appendElement(gLocalInboxFolder, false);</span>
<a href="#l8.42"></a><span id="l8.42" class="difflineplus">+    folders.appendElement(localAccountUtils.inboxFolder, false);</span>
<a href="#l8.43"></a><span id="l8.43">     ++gCurTestNum;</span>
<a href="#l8.44"></a><span id="l8.44">     MailServices.filters.applyFiltersToFolders(gFilterList, folders, null);</span>
<a href="#l8.45"></a><span id="l8.45">   },</span>
<a href="#l8.46"></a><span id="l8.46">   function verifyFolders2() {</span>
<a href="#l8.47"></a><span id="l8.47">     // Copy and Move should each now have 2 message in them.</span>
<a href="#l8.48"></a><span id="l8.48">     do_check_eq(folderCount(gCopyFolder), 2);</span>
<a href="#l8.49"></a><span id="l8.49">     do_check_eq(folderCount(gMoveFolder), 2);</span>
<a href="#l8.50"></a><span id="l8.50">     // the local inbox folder should now be empty, since the second</span>
<a href="#l8.51"></a><span id="l8.51">     // operation was a move</span>
<a href="#l8.52"></a><span id="l8.52" class="difflineminus">-    do_check_eq(folderCount(gLocalInboxFolder), 0);</span>
<a href="#l8.53"></a><span id="l8.53" class="difflineplus">+    do_check_eq(folderCount(localAccountUtils.inboxFolder), 0);</span>
<a href="#l8.54"></a><span id="l8.54">     ++gCurTestNum;</span>
<a href="#l8.55"></a><span id="l8.55">     doTest();</span>
<a href="#l8.56"></a><span id="l8.56">   }</span>
<a href="#l8.57"></a><span id="l8.57"> ];</span>
<a href="#l8.58"></a><span id="l8.58"> </span>
<a href="#l8.59"></a><span id="l8.59"> function folderCount(folder)</span>
<a href="#l8.60"></a><span id="l8.60"> {</span>
<a href="#l8.61"></a><span id="l8.61">   let enumerator = folder.msgDatabase.EnumerateMessages();</span>
<a href="#l8.62"></a><span id="l8.62" class="difflineat">@@ -100,17 +100,17 @@ function folderCount(folder)</span>
<a href="#l8.63"></a><span id="l8.63">     count++;</span>
<a href="#l8.64"></a><span id="l8.64">     let hdr = enumerator.getNext();</span>
<a href="#l8.65"></a><span id="l8.65">   }</span>
<a href="#l8.66"></a><span id="l8.66">   return count;</span>
<a href="#l8.67"></a><span id="l8.67"> }</span>
<a href="#l8.68"></a><span id="l8.68"> </span>
<a href="#l8.69"></a><span id="l8.69"> function run_test()</span>
<a href="#l8.70"></a><span id="l8.70"> {</span>
<a href="#l8.71"></a><span id="l8.71" class="difflineminus">-  if (!gLocalInboxFolder)</span>
<a href="#l8.72"></a><span id="l8.72" class="difflineplus">+  if (!localAccountUtils.inboxFolder)</span>
<a href="#l8.73"></a><span id="l8.73">     localAccountUtils.loadLocalMailAccount();</span>
<a href="#l8.74"></a><span id="l8.74"> </span>
<a href="#l8.75"></a><span id="l8.75">   gCopyFolder = localAccountUtils.incomingServer</span>
<a href="#l8.76"></a><span id="l8.76">                                  .rootFolder.createLocalSubfolder(&quot;CopyFolder&quot;);</span>
<a href="#l8.77"></a><span id="l8.77">   gMoveFolder = localAccountUtils.incomingServer</span>
<a href="#l8.78"></a><span id="l8.78">                                  .rootFolder.createLocalSubfolder(&quot;MoveFolder&quot;);</span>
<a href="#l8.79"></a><span id="l8.79"> </span>
<a href="#l8.80"></a><span id="l8.80">   MailServices.mailSession.AddFolderListener(FolderListener, Ci.nsIFolderListener.event |</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l9.1"></a><span id="l9.1" class="difflineminus">--- a/mailnews/base/test/unit/test_detachToFile.js</span>
<a href="#l9.2"></a><span id="l9.2" class="difflineplus">+++ b/mailnews/base/test/unit/test_detachToFile.js</span>
<a href="#l9.3"></a><span id="l9.3" class="difflineat">@@ -20,35 +20,35 @@ var tests = [</span>
<a href="#l9.4"></a><span id="l9.4">   startDetach,</span>
<a href="#l9.5"></a><span id="l9.5">   testDetach,</span>
<a href="#l9.6"></a><span id="l9.6"> ]</span>
<a href="#l9.7"></a><span id="l9.7"> </span>
<a href="#l9.8"></a><span id="l9.8"> function startCopy()</span>
<a href="#l9.9"></a><span id="l9.9"> {</span>
<a href="#l9.10"></a><span id="l9.10">   // Get a message into the local filestore.</span>
<a href="#l9.11"></a><span id="l9.11">   var mailFile = do_get_file(&quot;../../../data/external-attach-test&quot;);</span>
<a href="#l9.12"></a><span id="l9.12" class="difflineminus">-  MailServices.copy.CopyFileMessage(mailFile, gLocalInboxFolder, null, false, 0,</span>
<a href="#l9.13"></a><span id="l9.13" class="difflineminus">-                                    &quot;&quot;, asyncCopyListener, null);</span>
<a href="#l9.14"></a><span id="l9.14" class="difflineplus">+  MailServices.copy.CopyFileMessage(mailFile, localAccountUtils.inboxFolder, null,</span>
<a href="#l9.15"></a><span id="l9.15" class="difflineplus">+                                    false, 0, &quot;&quot;, asyncCopyListener, null);</span>
<a href="#l9.16"></a><span id="l9.16">   yield false;</span>
<a href="#l9.17"></a><span id="l9.17"> }</span>
<a href="#l9.18"></a><span id="l9.18"> </span>
<a href="#l9.19"></a><span id="l9.19"> // process the message through mime</span>
<a href="#l9.20"></a><span id="l9.20"> function startMime()</span>
<a href="#l9.21"></a><span id="l9.21"> {</span>
<a href="#l9.22"></a><span id="l9.22" class="difflineminus">-  let msgHdr = mailTestUtils.firstMsgHdr(gLocalInboxFolder);</span>
<a href="#l9.23"></a><span id="l9.23" class="difflineplus">+  let msgHdr = mailTestUtils.firstMsgHdr(localAccountUtils.inboxFolder);</span>
<a href="#l9.24"></a><span id="l9.24"> </span>
<a href="#l9.25"></a><span id="l9.25">   mimeMsg.MsgHdrToMimeMessage(msgHdr, gCallbackObject, gCallbackObject.callback,</span>
<a href="#l9.26"></a><span id="l9.26">                               true /* allowDownload */);</span>
<a href="#l9.27"></a><span id="l9.27">   yield false;</span>
<a href="#l9.28"></a><span id="l9.28"> }</span>
<a href="#l9.29"></a><span id="l9.29"> </span>
<a href="#l9.30"></a><span id="l9.30"> // detach any found attachments</span>
<a href="#l9.31"></a><span id="l9.31"> function startDetach()</span>
<a href="#l9.32"></a><span id="l9.32"> {</span>
<a href="#l9.33"></a><span id="l9.33" class="difflineminus">-  let msgHdr = mailTestUtils.firstMsgHdr(gLocalInboxFolder);</span>
<a href="#l9.34"></a><span id="l9.34" class="difflineplus">+  let msgHdr = mailTestUtils.firstMsgHdr(localAccountUtils.inboxFolder);</span>
<a href="#l9.35"></a><span id="l9.35">   let msgURI = msgHdr.folder.generateMessageURI(msgHdr.messageKey);</span>
<a href="#l9.36"></a><span id="l9.36"> </span>
<a href="#l9.37"></a><span id="l9.37">   let messenger = Cc[&quot;@mozilla.org/messenger;1&quot;].createInstance(Ci.nsIMessenger);</span>
<a href="#l9.38"></a><span id="l9.38">   let attachment = gCallbackObject.attachments[0];</span>
<a href="#l9.39"></a><span id="l9.39"> </span>
<a href="#l9.40"></a><span id="l9.40">   messenger.detachAttachmentsWOPrompts(gProfileDir, 1,</span>
<a href="#l9.41"></a><span id="l9.41">                                        [attachment.contentType], [attachment.url],</span>
<a href="#l9.42"></a><span id="l9.42">                                        [attachment.name], [msgURI], asyncUrlListener);</span>
<a href="#l9.43"></a><span id="l9.43" class="difflineat">@@ -66,17 +66,17 @@ function testDetach()</span>
<a href="#l9.44"></a><span id="l9.44">   let checkFile = gProfileDir.clone();</span>
<a href="#l9.45"></a><span id="l9.45">   checkFile.append(&quot;check.pdf&quot;);</span>
<a href="#l9.46"></a><span id="l9.46">   do_check_true(checkFile.exists());</span>
<a href="#l9.47"></a><span id="l9.47"> </span>
<a href="#l9.48"></a><span id="l9.48">   // The message should now have a detached attachment. Read the message,</span>
<a href="#l9.49"></a><span id="l9.49">   //  and search for &quot;AttachmentDetached&quot; which is added on detachment.</span>
<a href="#l9.50"></a><span id="l9.50"> </span>
<a href="#l9.51"></a><span id="l9.51">   // Get the message header</span>
<a href="#l9.52"></a><span id="l9.52" class="difflineminus">-  let msgHdr = mailTestUtils.firstMsgHdr(gLocalInboxFolder);</span>
<a href="#l9.53"></a><span id="l9.53" class="difflineplus">+  let msgHdr = mailTestUtils.firstMsgHdr(localAccountUtils.inboxFolder);</span>
<a href="#l9.54"></a><span id="l9.54"> </span>
<a href="#l9.55"></a><span id="l9.55">   let messageContent = getContentFromMessage(msgHdr);</span>
<a href="#l9.56"></a><span id="l9.56">   do_check_true(messageContent.contains(&quot;AttachmentDetached&quot;));</span>
<a href="#l9.57"></a><span id="l9.57"> }</span>
<a href="#l9.58"></a><span id="l9.58"> </span>
<a href="#l9.59"></a><span id="l9.59"> function SaveAttachmentCallback() {</span>
<a href="#l9.60"></a><span id="l9.60">   this.attachments = null;</span>
<a href="#l9.61"></a><span id="l9.61"> }</span>
<a href="#l9.62"></a><span id="l9.62" class="difflineat">@@ -86,17 +86,17 @@ SaveAttachmentCallback.prototype = {</span>
<a href="#l9.63"></a><span id="l9.63">     this.attachments = aMimeMessage.allAttachments;</span>
<a href="#l9.64"></a><span id="l9.64">     async_driver();</span>
<a href="#l9.65"></a><span id="l9.65">   }</span>
<a href="#l9.66"></a><span id="l9.66"> }</span>
<a href="#l9.67"></a><span id="l9.67"> let gCallbackObject = new SaveAttachmentCallback();</span>
<a href="#l9.68"></a><span id="l9.68"> </span>
<a href="#l9.69"></a><span id="l9.69"> function run_test()</span>
<a href="#l9.70"></a><span id="l9.70"> {</span>
<a href="#l9.71"></a><span id="l9.71" class="difflineminus">-  if (!gLocalInboxFolder)</span>
<a href="#l9.72"></a><span id="l9.72" class="difflineplus">+  if (!localAccountUtils.inboxFolder)</span>
<a href="#l9.73"></a><span id="l9.73">     localAccountUtils.loadLocalMailAccount();</span>
<a href="#l9.74"></a><span id="l9.74">   async_run_tests(tests);</span>
<a href="#l9.75"></a><span id="l9.75"> }</span>
<a href="#l9.76"></a><span id="l9.76"> </span>
<a href="#l9.77"></a><span id="l9.77"> /*</span>
<a href="#l9.78"></a><span id="l9.78">  * Get the full message content.</span>
<a href="#l9.79"></a><span id="l9.79">  *</span>
<a href="#l9.80"></a><span id="l9.80">  * aMsgHdr: nsIMsgDBHdr object whose text body will be read</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l10.1"></a><span id="l10.1" class="difflineminus">--- a/mailnews/base/test/unit/test_emptyTrash.js</span>
<a href="#l10.2"></a><span id="l10.2" class="difflineplus">+++ b/mailnews/base/test/unit/test_emptyTrash.js</span>
<a href="#l10.3"></a><span id="l10.3" class="difflineat">@@ -29,17 +29,17 @@ const nsIMFListener = Ci.nsIMsgFolderLis</span>
<a href="#l10.4"></a><span id="l10.4"> </span>
<a href="#l10.5"></a><span id="l10.5"> // nsIMsgCopyServiceListener implementation</span>
<a href="#l10.6"></a><span id="l10.6"> var copyListener = </span>
<a href="#l10.7"></a><span id="l10.7"> {</span>
<a href="#l10.8"></a><span id="l10.8">   OnStartCopy: function() {},</span>
<a href="#l10.9"></a><span id="l10.9">   OnProgress: function(aProgress, aProgressMax) {},</span>
<a href="#l10.10"></a><span id="l10.10">   SetMessageKey: function(aKey)</span>
<a href="#l10.11"></a><span id="l10.11">   {</span>
<a href="#l10.12"></a><span id="l10.12" class="difflineminus">-    let hdr = gLocalInboxFolder.GetMessageHeader(aKey);</span>
<a href="#l10.13"></a><span id="l10.13" class="difflineplus">+    let hdr = localAccountUtils.inboxFolder.GetMessageHeader(aKey);</span>
<a href="#l10.14"></a><span id="l10.14">     gMsgHdrs.push({hdr: hdr, ID: hdr.messageId});</span>
<a href="#l10.15"></a><span id="l10.15">   },</span>
<a href="#l10.16"></a><span id="l10.16">   SetMessageId: function(aMessageId) {},</span>
<a href="#l10.17"></a><span id="l10.17">   OnStopCopy: function(aStatus)</span>
<a href="#l10.18"></a><span id="l10.18">   {</span>
<a href="#l10.19"></a><span id="l10.19">     // Check: message successfully copied.</span>
<a href="#l10.20"></a><span id="l10.20">     do_check_eq(aStatus, 0);</span>
<a href="#l10.21"></a><span id="l10.21">     // Ugly hack: make sure we don't get stuck in a JS-&gt;C++-&gt;JS-&gt;C++... call stack</span>
<a href="#l10.22"></a><span id="l10.22" class="difflineat">@@ -83,26 +83,28 @@ function deleteMessages(srcFolder, items</span>
<a href="#l10.23"></a><span id="l10.23"> /*</span>
<a href="#l10.24"></a><span id="l10.24">  * TESTS</span>
<a href="#l10.25"></a><span id="l10.25">  */</span>
<a href="#l10.26"></a><span id="l10.26"> </span>
<a href="#l10.27"></a><span id="l10.27"> // Beware before commenting out a test -- later tests might just depend on earlier ones</span>
<a href="#l10.28"></a><span id="l10.28"> const gTestArray =</span>
<a href="#l10.29"></a><span id="l10.29"> [</span>
<a href="#l10.30"></a><span id="l10.30">   // Copying message from file</span>
<a href="#l10.31"></a><span id="l10.31" class="difflineminus">-  function testCopyFileMessage1() { copyFileMessage(gMsgFile1, gLocalInboxFolder, false); },</span>
<a href="#l10.32"></a><span id="l10.32" class="difflineplus">+  function testCopyFileMessage1() {</span>
<a href="#l10.33"></a><span id="l10.33" class="difflineplus">+    copyFileMessage(gMsgFile1, localAccountUtils.inboxFolder, false);</span>
<a href="#l10.34"></a><span id="l10.34" class="difflineplus">+  },</span>
<a href="#l10.35"></a><span id="l10.35"> </span>
<a href="#l10.36"></a><span id="l10.36">   // Delete message</span>
<a href="#l10.37"></a><span id="l10.37">   function testDeleteMessage() { // delete to trash</span>
<a href="#l10.38"></a><span id="l10.38">     // Let's take a moment to re-initialize stuff that got moved</span>
<a href="#l10.39"></a><span id="l10.39" class="difflineminus">-    let inboxDB = gLocalInboxFolder.msgDatabase;</span>
<a href="#l10.40"></a><span id="l10.40" class="difflineplus">+    let inboxDB = localAccountUtils.inboxFolder.msgDatabase;</span>
<a href="#l10.41"></a><span id="l10.41">     gMsgHdrs[0].hdr = inboxDB.getMsgHdrForMessageID(gMsgHdrs[0].ID);</span>
<a href="#l10.42"></a><span id="l10.42"> </span>
<a href="#l10.43"></a><span id="l10.43">     // Now delete the message</span>
<a href="#l10.44"></a><span id="l10.44" class="difflineminus">-    deleteMessages(gLocalInboxFolder, [gMsgHdrs[0].hdr], false, false);</span>
<a href="#l10.45"></a><span id="l10.45" class="difflineplus">+    deleteMessages(localAccountUtils.inboxFolder, [gMsgHdrs[0].hdr], false, false);</span>
<a href="#l10.46"></a><span id="l10.46">   },</span>
<a href="#l10.47"></a><span id="l10.47">   function emptyTrash()</span>
<a href="#l10.48"></a><span id="l10.48">   {</span>
<a href="#l10.49"></a><span id="l10.49">     gRootFolder = localAccountUtils.incomingServer.rootMsgFolder;</span>
<a href="#l10.50"></a><span id="l10.50">     gLocalTrashFolder = gRootFolder.getChildNamed(&quot;Trash&quot;);</span>
<a href="#l10.51"></a><span id="l10.51">     // hold onto a db to make sure that empty trash deals with the case</span>
<a href="#l10.52"></a><span id="l10.52">     // of someone holding onto the db, but the trash folder has a null db.</span>
<a href="#l10.53"></a><span id="l10.53">     let gLocalTrashDB = gLocalTrashFolder.msgDatabase;</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l11.1"></a><span id="l11.1" class="difflineminus">--- a/mailnews/base/test/unit/test_folderCompact.js</span>
<a href="#l11.2"></a><span id="l11.2" class="difflineplus">+++ b/mailnews/base/test/unit/test_folderCompact.js</span>
<a href="#l11.3"></a><span id="l11.3" class="difflineat">@@ -36,17 +36,17 @@ var gExpectedFolder3Size;</span>
<a href="#l11.4"></a><span id="l11.4"> </span>
<a href="#l11.5"></a><span id="l11.5"> // nsIMsgCopyServiceListener implementation</span>
<a href="#l11.6"></a><span id="l11.6"> var copyListener = </span>
<a href="#l11.7"></a><span id="l11.7"> {</span>
<a href="#l11.8"></a><span id="l11.8">   OnStartCopy: function() {},</span>
<a href="#l11.9"></a><span id="l11.9">   OnProgress: function(aProgress, aProgressMax) {},</span>
<a href="#l11.10"></a><span id="l11.10">   SetMessageKey: function(aKey)</span>
<a href="#l11.11"></a><span id="l11.11">   {</span>
<a href="#l11.12"></a><span id="l11.12" class="difflineminus">-    let hdr = gLocalInboxFolder.GetMessageHeader(aKey);</span>
<a href="#l11.13"></a><span id="l11.13" class="difflineplus">+    let hdr = localAccountUtils.inboxFolder.GetMessageHeader(aKey);</span>
<a href="#l11.14"></a><span id="l11.14">     gMsgHdrs.push({hdr: hdr, ID: hdr.messageId});</span>
<a href="#l11.15"></a><span id="l11.15">   },</span>
<a href="#l11.16"></a><span id="l11.16">   SetMessageId: function(aMessageId) {},</span>
<a href="#l11.17"></a><span id="l11.17">   OnStopCopy: function(aStatus)</span>
<a href="#l11.18"></a><span id="l11.18">   {</span>
<a href="#l11.19"></a><span id="l11.19">     // Check: message successfully copied.</span>
<a href="#l11.20"></a><span id="l11.20">     do_check_eq(aStatus, 0);</span>
<a href="#l11.21"></a><span id="l11.21">     // Ugly hack: make sure we don't get stuck in a JS-&gt;C++-&gt;JS-&gt;C++... call stack</span>
<a href="#l11.22"></a><span id="l11.22" class="difflineat">@@ -133,24 +133,36 @@ function verifyMsgOffsets(folder)</span>
<a href="#l11.23"></a><span id="l11.23"> /*</span>
<a href="#l11.24"></a><span id="l11.24">  * TESTS</span>
<a href="#l11.25"></a><span id="l11.25">  */</span>
<a href="#l11.26"></a><span id="l11.26"> </span>
<a href="#l11.27"></a><span id="l11.27"> // Beware before commenting out a test -- later tests might just depend on earlier ones</span>
<a href="#l11.28"></a><span id="l11.28"> const gTestArray =</span>
<a href="#l11.29"></a><span id="l11.29"> [</span>
<a href="#l11.30"></a><span id="l11.30">   // Copying messages from files</span>
<a href="#l11.31"></a><span id="l11.31" class="difflineminus">-  function testCopyFileMessage1() { copyFileMessage(gMsgFile1, gLocalInboxFolder, false); },</span>
<a href="#l11.32"></a><span id="l11.32" class="difflineminus">-  function testCopyFileMessage2() { copyFileMessage(gMsgFile2, gLocalInboxFolder, false); },</span>
<a href="#l11.33"></a><span id="l11.33" class="difflineminus">-  function testCopyFileMessage3() { copyFileMessage(gMsgFile3, gLocalInboxFolder, true); },</span>
<a href="#l11.34"></a><span id="l11.34" class="difflineplus">+  function testCopyFileMessage1() {</span>
<a href="#l11.35"></a><span id="l11.35" class="difflineplus">+    copyFileMessage(gMsgFile1, localAccountUtils.inboxFolder, false);</span>
<a href="#l11.36"></a><span id="l11.36" class="difflineplus">+  },</span>
<a href="#l11.37"></a><span id="l11.37" class="difflineplus">+  function testCopyFileMessage2() {</span>
<a href="#l11.38"></a><span id="l11.38" class="difflineplus">+    copyFileMessage(gMsgFile2, localAccountUtils.inboxFolder, false);</span>
<a href="#l11.39"></a><span id="l11.39" class="difflineplus">+  },</span>
<a href="#l11.40"></a><span id="l11.40" class="difflineplus">+  function testCopyFileMessage3() {</span>
<a href="#l11.41"></a><span id="l11.41" class="difflineplus">+    copyFileMessage(gMsgFile3, localAccountUtils.inboxFolder, true);</span>
<a href="#l11.42"></a><span id="l11.42" class="difflineplus">+  },</span>
<a href="#l11.43"></a><span id="l11.43"> </span>
<a href="#l11.44"></a><span id="l11.44">   // Moving/copying messages</span>
<a href="#l11.45"></a><span id="l11.45" class="difflineminus">-  function testCopyMessages1() { copyMessages([gMsgHdrs[0].hdr], false, gLocalInboxFolder, gLocalFolder2); },</span>
<a href="#l11.46"></a><span id="l11.46" class="difflineminus">-  function testCopyMessages2() { copyMessages([gMsgHdrs[1].hdr, gMsgHdrs[2].hdr], false, gLocalInboxFolder, gLocalFolder2); },</span>
<a href="#l11.47"></a><span id="l11.47" class="difflineminus">-  function testMoveMessages1() { copyMessages([gMsgHdrs[0].hdr, gMsgHdrs[1].hdr], true, gLocalInboxFolder, gLocalFolder3); },</span>
<a href="#l11.48"></a><span id="l11.48" class="difflineplus">+  function testCopyMessages1() {</span>
<a href="#l11.49"></a><span id="l11.49" class="difflineplus">+    copyMessages([gMsgHdrs[0].hdr], false, localAccountUtils.inboxFolder, gLocalFolder2);</span>
<a href="#l11.50"></a><span id="l11.50" class="difflineplus">+  },</span>
<a href="#l11.51"></a><span id="l11.51" class="difflineplus">+  function testCopyMessages2() {</span>
<a href="#l11.52"></a><span id="l11.52" class="difflineplus">+    copyMessages([gMsgHdrs[1].hdr, gMsgHdrs[2].hdr], false, localAccountUtils.inboxFolder, gLocalFolder2);</span>
<a href="#l11.53"></a><span id="l11.53" class="difflineplus">+  },</span>
<a href="#l11.54"></a><span id="l11.54" class="difflineplus">+  function testMoveMessages1() {</span>
<a href="#l11.55"></a><span id="l11.55" class="difflineplus">+    copyMessages([gMsgHdrs[0].hdr, gMsgHdrs[1].hdr], true, localAccountUtils.inboxFolder, gLocalFolder3);</span>
<a href="#l11.56"></a><span id="l11.56" class="difflineplus">+  },</span>
<a href="#l11.57"></a><span id="l11.57"> </span>
<a href="#l11.58"></a><span id="l11.58">   // Deleting messages</span>
<a href="#l11.59"></a><span id="l11.59">   function testDeleteMessages1() { // delete to trash</span>
<a href="#l11.60"></a><span id="l11.60">     // Let's take a moment to re-initialize stuff that got moved</span>
<a href="#l11.61"></a><span id="l11.61">     var folder3DB = gLocalFolder3.msgDatabase;</span>
<a href="#l11.62"></a><span id="l11.62">     gMsgHdrs[0].hdr = folder3DB.getMsgHdrForMessageID(gMsgHdrs[0].ID);</span>
<a href="#l11.63"></a><span id="l11.63"> </span>
<a href="#l11.64"></a><span id="l11.64">     // Now delete the message</span>
<a href="#l11.65"></a><span id="l11.65" class="difflineat">@@ -168,39 +180,39 @@ const gTestArray =</span>
<a href="#l11.66"></a><span id="l11.66">     var folder2DB = gLocalFolder2.msgDatabase;</span>
<a href="#l11.67"></a><span id="l11.67">     gMsgHdrs[0].hdr = folder2DB.getMsgHdrForMessageID(gMsgHdrs[0].ID);</span>
<a href="#l11.68"></a><span id="l11.68"> </span>
<a href="#l11.69"></a><span id="l11.69">     // Now delete the message</span>
<a href="#l11.70"></a><span id="l11.70">     deleteMessages(gLocalFolder2, [gMsgHdrs[0].hdr], false, false);</span>
<a href="#l11.71"></a><span id="l11.71">   },</span>
<a href="#l11.72"></a><span id="l11.72">   function compactAllFolders()</span>
<a href="#l11.73"></a><span id="l11.73">   {</span>
<a href="#l11.74"></a><span id="l11.74" class="difflineminus">-    gExpectedInboxSize = calculateFolderSize(gLocalInboxFolder);</span>
<a href="#l11.75"></a><span id="l11.75" class="difflineplus">+    gExpectedInboxSize = calculateFolderSize(localAccountUtils.inboxFolder);</span>
<a href="#l11.76"></a><span id="l11.76">     gExpectedFolder2Size = calculateFolderSize(gLocalFolder2);</span>
<a href="#l11.77"></a><span id="l11.77">     gExpectedFolder3Size = calculateFolderSize(gLocalFolder3);</span>
<a href="#l11.78"></a><span id="l11.78">     // force expunged bytes count to get cached.</span>
<a href="#l11.79"></a><span id="l11.79">     let localFolder2ExpungedBytes = gLocalFolder2.expungedBytes;</span>
<a href="#l11.80"></a><span id="l11.80">     // mark localFolder2 as having an invalid db, and remove it</span>
<a href="#l11.81"></a><span id="l11.81">     // for good measure.</span>
<a href="#l11.82"></a><span id="l11.82">     gLocalFolder2.msgDatabase.summaryValid = false;</span>
<a href="#l11.83"></a><span id="l11.83">     gLocalFolder2.msgDatabase = null;</span>
<a href="#l11.84"></a><span id="l11.84">     gLocalFolder2.ForceDBClosed();</span>
<a href="#l11.85"></a><span id="l11.85">     let dbPath = gLocalFolder2.filePath;</span>
<a href="#l11.86"></a><span id="l11.86">     dbPath.leafName = dbPath.leafName + &quot;.msf&quot;;</span>
<a href="#l11.87"></a><span id="l11.87">     dbPath.remove(false);</span>
<a href="#l11.88"></a><span id="l11.88" class="difflineminus">-    gLocalInboxFolder.compactAll(urlListener, null, true);</span>
<a href="#l11.89"></a><span id="l11.89" class="difflineplus">+    localAccountUtils.inboxFolder.compactAll(urlListener, null, true);</span>
<a href="#l11.90"></a><span id="l11.90">   },</span>
<a href="#l11.91"></a><span id="l11.91">   function lastTestCheck()</span>
<a href="#l11.92"></a><span id="l11.92">   {</span>
<a href="#l11.93"></a><span id="l11.93" class="difflineminus">-    do_check_eq(gExpectedInboxSize, gLocalInboxFolder.filePath.fileSize);</span>
<a href="#l11.94"></a><span id="l11.94" class="difflineplus">+    do_check_eq(gExpectedInboxSize, localAccountUtils.inboxFolder.filePath.fileSize);</span>
<a href="#l11.95"></a><span id="l11.95">     do_check_eq(gExpectedFolder2Size, gLocalFolder2.filePath.fileSize);</span>
<a href="#l11.96"></a><span id="l11.96">     do_check_eq(gExpectedFolder3Size, gLocalFolder3.filePath.fileSize);</span>
<a href="#l11.97"></a><span id="l11.97">     verifyMsgOffsets(gLocalFolder2);</span>
<a href="#l11.98"></a><span id="l11.98">     verifyMsgOffsets(gLocalFolder3);</span>
<a href="#l11.99"></a><span id="l11.99" class="difflineminus">-    verifyMsgOffsets(gLocalInboxFolder);</span>
<a href="#l11.100"></a><span id="l11.100" class="difflineplus">+    verifyMsgOffsets(localAccountUtils.inboxFolder);</span>
<a href="#l11.101"></a><span id="l11.101">     urlListener.OnStopRunningUrl(null, 0);</span>
<a href="#l11.102"></a><span id="l11.102">   }</span>
<a href="#l11.103"></a><span id="l11.103"> ];</span>
<a href="#l11.104"></a><span id="l11.104"> </span>
<a href="#l11.105"></a><span id="l11.105"> function run_test()</span>
<a href="#l11.106"></a><span id="l11.106"> {</span>
<a href="#l11.107"></a><span id="l11.107">   localAccountUtils.loadLocalMailAccount();</span>
<a href="#l11.108"></a><span id="l11.108">   // Load up some messages so that we can copy them in later.</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l12.1"></a><span id="l12.1" class="difflineminus">--- a/mailnews/base/test/unit/test_inheritedFolderProperties.js</span>
<a href="#l12.2"></a><span id="l12.2" class="difflineplus">+++ b/mailnews/base/test/unit/test_inheritedFolderProperties.js</span>
<a href="#l12.3"></a><span id="l12.3" class="difflineat">@@ -7,19 +7,19 @@</span>
<a href="#l12.4"></a><span id="l12.4">  */</span>
<a href="#l12.5"></a><span id="l12.5"> </span>
<a href="#l12.6"></a><span id="l12.6"> function run_test()</span>
<a href="#l12.7"></a><span id="l12.7"> { </span>
<a href="#l12.8"></a><span id="l12.8">   localAccountUtils.loadLocalMailAccount();</span>
<a href="#l12.9"></a><span id="l12.9">   var rootFolder = localAccountUtils.incomingServer.rootMsgFolder;</span>
<a href="#l12.10"></a><span id="l12.10"> </span>
<a href="#l12.11"></a><span id="l12.11">   // add subfolders to the inbox</span>
<a href="#l12.12"></a><span id="l12.12" class="difflineminus">-  const subFolder11 = gLocalInboxFolder.createLocalSubfolder(&quot;subfolder11&quot;)</span>
<a href="#l12.13"></a><span id="l12.13" class="difflineplus">+  const subFolder11 = localAccountUtils.inboxFolder.createLocalSubfolder(&quot;subfolder11&quot;)</span>
<a href="#l12.14"></a><span id="l12.14">                          .QueryInterface(Ci.nsIMsgLocalMailFolder);</span>
<a href="#l12.15"></a><span id="l12.15" class="difflineminus">-  const subFolder12 = gLocalInboxFolder.createLocalSubfolder(&quot;subfolder12&quot;)</span>
<a href="#l12.16"></a><span id="l12.16" class="difflineplus">+  const subFolder12 = localAccountUtils.inboxFolder.createLocalSubfolder(&quot;subfolder12&quot;)</span>
<a href="#l12.17"></a><span id="l12.17">                          .QueryInterface(Ci.nsIMsgLocalMailFolder);</span>
<a href="#l12.18"></a><span id="l12.18">   const subFolder21 = subFolder11.createLocalSubfolder(&quot;subfolder21&quot;);</span>
<a href="#l12.19"></a><span id="l12.19">   const subFolder22 = subFolder12.createLocalSubfolder(&quot;subfolder22&quot;);</span>
<a href="#l12.20"></a><span id="l12.20"> </span>
<a href="#l12.21"></a><span id="l12.21">   // add a global preference</span>
<a href="#l12.22"></a><span id="l12.22">   const propertyName = &quot;iexist&quot;;</span>
<a href="#l12.23"></a><span id="l12.23">   const invalidName = &quot;idontexist&quot;;</span>
<a href="#l12.24"></a><span id="l12.24">   const globalPref = &quot;mail.server.default.&quot; + propertyName;</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l13.1"></a><span id="l13.1" class="difflineminus">--- a/mailnews/base/test/unit/test_junkWhitelisting.js</span>
<a href="#l13.2"></a><span id="l13.2" class="difflineplus">+++ b/mailnews/base/test/unit/test_junkWhitelisting.js</span>
<a href="#l13.3"></a><span id="l13.3" class="difflineat">@@ -53,17 +53,17 @@ function run_test()</span>
<a href="#l13.4"></a><span id="l13.4">   gPOP3Pump.files = Files;</span>
<a href="#l13.5"></a><span id="l13.5">   gPOP3Pump.onDone = continueTest;</span>
<a href="#l13.6"></a><span id="l13.6">   gPOP3Pump.run();</span>
<a href="#l13.7"></a><span id="l13.7"> }</span>
<a href="#l13.8"></a><span id="l13.8"> </span>
<a href="#l13.9"></a><span id="l13.9"> function continueTest()</span>
<a href="#l13.10"></a><span id="l13.10"> {</span>
<a href="#l13.11"></a><span id="l13.11">   // get the message headers</span>
<a href="#l13.12"></a><span id="l13.12" class="difflineminus">-  let headerEnum = gLocalInboxFolder.messages;</span>
<a href="#l13.13"></a><span id="l13.13" class="difflineplus">+  let headerEnum = localAccountUtils.inboxFolder.messages;</span>
<a href="#l13.14"></a><span id="l13.14">   while (headerEnum.hasMoreElements())</span>
<a href="#l13.15"></a><span id="l13.15">     hdrs.push(headerEnum.getNext().QueryInterface(Ci.nsIMsgDBHdr));</span>
<a href="#l13.16"></a><span id="l13.16"> </span>
<a href="#l13.17"></a><span id="l13.17">   // check with spam properties set on the local server</span>
<a href="#l13.18"></a><span id="l13.18">   doChecks(localAccountUtils.incomingServer);</span>
<a href="#l13.19"></a><span id="l13.19"> </span>
<a href="#l13.20"></a><span id="l13.20">   // Free our globals</span>
<a href="#l13.21"></a><span id="l13.21">   hdrs = null;</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l14.1"></a><span id="l14.1" class="difflineminus">--- a/mailnews/base/test/unit/test_mimemaltdetach.js</span>
<a href="#l14.2"></a><span id="l14.2" class="difflineplus">+++ b/mailnews/base/test/unit/test_mimemaltdetach.js</span>
<a href="#l14.3"></a><span id="l14.3" class="difflineat">@@ -21,35 +21,35 @@ var tests = [</span>
<a href="#l14.4"></a><span id="l14.4">   startDetach,</span>
<a href="#l14.5"></a><span id="l14.5">   testDetach,</span>
<a href="#l14.6"></a><span id="l14.6"> ]</span>
<a href="#l14.7"></a><span id="l14.7"> </span>
<a href="#l14.8"></a><span id="l14.8"> function startCopy()</span>
<a href="#l14.9"></a><span id="l14.9"> {</span>
<a href="#l14.10"></a><span id="l14.10">   // Get a message into the local filestore.</span>
<a href="#l14.11"></a><span id="l14.11">   let mailFile = do_get_file(&quot;../../../data/multipartmalt-detach&quot;);</span>
<a href="#l14.12"></a><span id="l14.12" class="difflineminus">-  MailServices.copy.CopyFileMessage(mailFile, gLocalInboxFolder, null, false, 0,</span>
<a href="#l14.13"></a><span id="l14.13" class="difflineminus">-                                    &quot;&quot;, asyncCopyListener, null);</span>
<a href="#l14.14"></a><span id="l14.14" class="difflineplus">+  MailServices.copy.CopyFileMessage(mailFile, localAccountUtils.inboxFolder, null,</span>
<a href="#l14.15"></a><span id="l14.15" class="difflineplus">+                                    false, 0, &quot;&quot;, asyncCopyListener, null);</span>
<a href="#l14.16"></a><span id="l14.16">   yield false;</span>
<a href="#l14.17"></a><span id="l14.17"> }</span>
<a href="#l14.18"></a><span id="l14.18"> </span>
<a href="#l14.19"></a><span id="l14.19"> // process the message through mime</span>
<a href="#l14.20"></a><span id="l14.20"> function startMime()</span>
<a href="#l14.21"></a><span id="l14.21"> {</span>
<a href="#l14.22"></a><span id="l14.22" class="difflineminus">-  let msgHdr = mailTestUtils.firstMsgHdr(gLocalInboxFolder);</span>
<a href="#l14.23"></a><span id="l14.23" class="difflineplus">+  let msgHdr = mailTestUtils.firstMsgHdr(localAccountUtils.inboxFolder);</span>
<a href="#l14.24"></a><span id="l14.24"> </span>
<a href="#l14.25"></a><span id="l14.25">   mimeMsg.MsgHdrToMimeMessage(msgHdr, gCallbackObject, gCallbackObject.callback,</span>
<a href="#l14.26"></a><span id="l14.26">                               true /* allowDownload */);</span>
<a href="#l14.27"></a><span id="l14.27">   yield false;</span>
<a href="#l14.28"></a><span id="l14.28"> }</span>
<a href="#l14.29"></a><span id="l14.29"> </span>
<a href="#l14.30"></a><span id="l14.30"> // detach any found attachments</span>
<a href="#l14.31"></a><span id="l14.31"> function startDetach()</span>
<a href="#l14.32"></a><span id="l14.32"> {</span>
<a href="#l14.33"></a><span id="l14.33" class="difflineminus">-  let msgHdr = mailTestUtils.firstMsgHdr(gLocalInboxFolder);</span>
<a href="#l14.34"></a><span id="l14.34" class="difflineplus">+  let msgHdr = mailTestUtils.firstMsgHdr(localAccountUtils.inboxFolder);</span>
<a href="#l14.35"></a><span id="l14.35">   let msgURI = msgHdr.folder.generateMessageURI(msgHdr.messageKey);</span>
<a href="#l14.36"></a><span id="l14.36"> </span>
<a href="#l14.37"></a><span id="l14.37">   let messenger = Cc[&quot;@mozilla.org/messenger;1&quot;].createInstance(Ci.nsIMessenger);</span>
<a href="#l14.38"></a><span id="l14.38">   let attachment = gCallbackObject.attachments[0];</span>
<a href="#l14.39"></a><span id="l14.39"> </span>
<a href="#l14.40"></a><span id="l14.40">   messenger.detachAttachmentsWOPrompts(gProfileDir, 1,</span>
<a href="#l14.41"></a><span id="l14.41">                                        [attachment.contentType], [attachment.url],</span>
<a href="#l14.42"></a><span id="l14.42">                                        [attachment.name], [msgURI], asyncUrlListener);</span>
<a href="#l14.43"></a><span id="l14.43" class="difflineat">@@ -68,17 +68,17 @@ function testDetach()</span>
<a href="#l14.44"></a><span id="l14.44">   checkFile.append(&quot;head_update.txt&quot;);</span>
<a href="#l14.45"></a><span id="l14.45">   do_check_true(checkFile.exists());</span>
<a href="#l14.46"></a><span id="l14.46">   do_check_true(checkFile.fileSize &gt; 0);</span>
<a href="#l14.47"></a><span id="l14.47"> </span>
<a href="#l14.48"></a><span id="l14.48">   // The message should now have a detached attachment. Read the message,</span>
<a href="#l14.49"></a><span id="l14.49">   //  and search for &quot;AttachmentDetached&quot; which is added on detachment.</span>
<a href="#l14.50"></a><span id="l14.50"> </span>
<a href="#l14.51"></a><span id="l14.51">   // Get the message header</span>
<a href="#l14.52"></a><span id="l14.52" class="difflineminus">-  let msgHdr = mailTestUtils.firstMsgHdr(gLocalInboxFolder);</span>
<a href="#l14.53"></a><span id="l14.53" class="difflineplus">+  let msgHdr = mailTestUtils.firstMsgHdr(localAccountUtils.inboxFolder);</span>
<a href="#l14.54"></a><span id="l14.54"> </span>
<a href="#l14.55"></a><span id="l14.55">   let messageContent = getContentFromMessage(msgHdr);</span>
<a href="#l14.56"></a><span id="l14.56">   do_check_true(messageContent.contains(&quot;AttachmentDetached&quot;));</span>
<a href="#l14.57"></a><span id="l14.57">   // Make sure the body survived the detach.</span>
<a href="#l14.58"></a><span id="l14.58">   do_check_true(messageContent.contains(&quot;body hello&quot;));</span>
<a href="#l14.59"></a><span id="l14.59"> }</span>
<a href="#l14.60"></a><span id="l14.60"> </span>
<a href="#l14.61"></a><span id="l14.61"> function SaveAttachmentCallback() {</span>
<a href="#l14.62"></a><span id="l14.62" class="difflineat">@@ -90,17 +90,17 @@ SaveAttachmentCallback.prototype = {</span>
<a href="#l14.63"></a><span id="l14.63">     this.attachments = aMimeMessage.allAttachments;</span>
<a href="#l14.64"></a><span id="l14.64">     async_driver();</span>
<a href="#l14.65"></a><span id="l14.65">   }</span>
<a href="#l14.66"></a><span id="l14.66"> }</span>
<a href="#l14.67"></a><span id="l14.67"> let gCallbackObject = new SaveAttachmentCallback();</span>
<a href="#l14.68"></a><span id="l14.68"> </span>
<a href="#l14.69"></a><span id="l14.69"> function run_test()</span>
<a href="#l14.70"></a><span id="l14.70"> {</span>
<a href="#l14.71"></a><span id="l14.71" class="difflineminus">-  if (!gLocalInboxFolder)</span>
<a href="#l14.72"></a><span id="l14.72" class="difflineplus">+  if (!localAccountUtils.inboxFolder)</span>
<a href="#l14.73"></a><span id="l14.73">     localAccountUtils.loadLocalMailAccount();</span>
<a href="#l14.74"></a><span id="l14.74">   async_run_tests(tests);</span>
<a href="#l14.75"></a><span id="l14.75"> }</span>
<a href="#l14.76"></a><span id="l14.76"> </span>
<a href="#l14.77"></a><span id="l14.77"> /*</span>
<a href="#l14.78"></a><span id="l14.78">  * Get the full message content.</span>
<a href="#l14.79"></a><span id="l14.79">  *</span>
<a href="#l14.80"></a><span id="l14.80">  * aMsgHdr: nsIMsgDBHdr object whose text body will be read</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l15.1"></a><span id="l15.1" class="difflineminus">--- a/mailnews/base/test/unit/test_nsIMsgFolderListenerLocal.js</span>
<a href="#l15.2"></a><span id="l15.2" class="difflineplus">+++ b/mailnews/base/test/unit/test_nsIMsgFolderListenerLocal.js</span>
<a href="#l15.3"></a><span id="l15.3" class="difflineat">@@ -173,47 +173,65 @@ const gTestArray =</span>
<a href="#l15.4"></a><span id="l15.4">   function addFolder2() { addFolder(gRootFolder, &quot;folder3&quot;, &quot;gLocalFolder3&quot;); },</span>
<a href="#l15.5"></a><span id="l15.5">   // Folder structure is now</span>
<a href="#l15.6"></a><span id="l15.6">   // Inbox</span>
<a href="#l15.7"></a><span id="l15.7">   // Trash</span>
<a href="#l15.8"></a><span id="l15.8">   // folder2</span>
<a href="#l15.9"></a><span id="l15.9">   // folder3</span>
<a href="#l15.10"></a><span id="l15.10"> </span>
<a href="#l15.11"></a><span id="l15.11">   // Copying messages from files</span>
<a href="#l15.12"></a><span id="l15.12" class="difflineminus">-  function testCopyFileMessage1() { copyFileMessage(gMsgFile1, gLocalInboxFolder, false); },</span>
<a href="#l15.13"></a><span id="l15.13" class="difflineminus">-  function testCopyFileMessage2() { copyFileMessage(gMsgFile2, gLocalInboxFolder, false); },</span>
<a href="#l15.14"></a><span id="l15.14" class="difflineminus">-  function testCopyFileMessage3() { copyFileMessage(gMsgFile3, gLocalInboxFolder, true); },</span>
<a href="#l15.15"></a><span id="l15.15" class="difflineplus">+  function testCopyFileMessage1() {</span>
<a href="#l15.16"></a><span id="l15.16" class="difflineplus">+    copyFileMessage(gMsgFile1, localAccountUtils.inboxFolder, false);</span>
<a href="#l15.17"></a><span id="l15.17" class="difflineplus">+  },</span>
<a href="#l15.18"></a><span id="l15.18" class="difflineplus">+  function testCopyFileMessage2() {</span>
<a href="#l15.19"></a><span id="l15.19" class="difflineplus">+    copyFileMessage(gMsgFile2, localAccountUtils.inboxFolder, false);</span>
<a href="#l15.20"></a><span id="l15.20" class="difflineplus">+  },</span>
<a href="#l15.21"></a><span id="l15.21" class="difflineplus">+  function testCopyFileMessage3() {</span>
<a href="#l15.22"></a><span id="l15.22" class="difflineplus">+    copyFileMessage(gMsgFile3, localAccountUtils.inboxFolder, true);</span>
<a href="#l15.23"></a><span id="l15.23" class="difflineplus">+  },</span>
<a href="#l15.24"></a><span id="l15.24"> </span>
<a href="#l15.25"></a><span id="l15.25">   // Moving/copying messages</span>
<a href="#l15.26"></a><span id="l15.26" class="difflineminus">-  function testCopyMessages1() { copyMessages([gMsgHdrs[0].hdr], false, gLocalInboxFolder, gLocalFolder2); },</span>
<a href="#l15.27"></a><span id="l15.27" class="difflineminus">-  function testCopyMessages2() { copyMessages([gMsgHdrs[1].hdr, gMsgHdrs[2].hdr], false, gLocalInboxFolder, gLocalFolder2); },</span>
<a href="#l15.28"></a><span id="l15.28" class="difflineminus">-  function testMoveMessages1() { copyMessages([gMsgHdrs[0].hdr, gMsgHdrs[1].hdr], true, gLocalInboxFolder, gLocalFolder3); },</span>
<a href="#l15.29"></a><span id="l15.29" class="difflineminus">-  function testMoveMessages2() { copyMessages([gMsgHdrs[2].hdr], true, gLocalInboxFolder, gLocalTrashFolder); },</span>
<a href="#l15.30"></a><span id="l15.30" class="difflineplus">+  function testCopyMessages1() {</span>
<a href="#l15.31"></a><span id="l15.31" class="difflineplus">+    copyMessages([gMsgHdrs[0].hdr], false, localAccountUtils.inboxFolder, gLocalFolder2);</span>
<a href="#l15.32"></a><span id="l15.32" class="difflineplus">+  },</span>
<a href="#l15.33"></a><span id="l15.33" class="difflineplus">+  function testCopyMessages2() {</span>
<a href="#l15.34"></a><span id="l15.34" class="difflineplus">+    copyMessages([gMsgHdrs[1].hdr, gMsgHdrs[2].hdr], false, localAccountUtils.inboxFolder, gLocalFolder2);</span>
<a href="#l15.35"></a><span id="l15.35" class="difflineplus">+  },</span>
<a href="#l15.36"></a><span id="l15.36" class="difflineplus">+  function testMoveMessages1() {</span>
<a href="#l15.37"></a><span id="l15.37" class="difflineplus">+    copyMessages([gMsgHdrs[0].hdr, gMsgHdrs[1].hdr], true, localAccountUtils.inboxFolder, gLocalFolder3);</span>
<a href="#l15.38"></a><span id="l15.38" class="difflineplus">+  },</span>
<a href="#l15.39"></a><span id="l15.39" class="difflineplus">+  function testMoveMessages2() {</span>
<a href="#l15.40"></a><span id="l15.40" class="difflineplus">+    copyMessages([gMsgHdrs[2].hdr], true, localAccountUtils.inboxFolder, gLocalTrashFolder);</span>
<a href="#l15.41"></a><span id="l15.41" class="difflineplus">+  },</span>
<a href="#l15.42"></a><span id="l15.42">   function testMoveMessages3() {</span>
<a href="#l15.43"></a><span id="l15.43">     // This is to test whether the notification is correct for moving from trash</span>
<a href="#l15.44"></a><span id="l15.44">     gMsgHdrs[2].hdr = gLocalTrashFolder.msgDatabase</span>
<a href="#l15.45"></a><span id="l15.45">                                        .getMsgHdrForMessageID(gMsgHdrs[2].ID);</span>
<a href="#l15.46"></a><span id="l15.46">     copyMessages([gMsgHdrs[2].hdr], true, gLocalTrashFolder, gLocalFolder3);</span>
<a href="#l15.47"></a><span id="l15.47">   },</span>
<a href="#l15.48"></a><span id="l15.48"> </span>
<a href="#l15.49"></a><span id="l15.49">   // Moving/copying folders</span>
<a href="#l15.50"></a><span id="l15.50">   function testCopyFolder1() { copyFolders([gLocalFolder3], false, gLocalFolder2); },</span>
<a href="#l15.51"></a><span id="l15.51" class="difflineminus">-  function testMoveFolder1() { copyFolders([gLocalFolder3], true, gLocalInboxFolder); },</span>
<a href="#l15.52"></a><span id="l15.52" class="difflineminus">-  function testMoveFolder2() { copyFolders([gLocalFolder2], true, gLocalInboxFolder); },</span>
<a href="#l15.53"></a><span id="l15.53" class="difflineplus">+  function testMoveFolder1() {</span>
<a href="#l15.54"></a><span id="l15.54" class="difflineplus">+    copyFolders([gLocalFolder3], true, localAccountUtils.inboxFolder);</span>
<a href="#l15.55"></a><span id="l15.55" class="difflineplus">+  },</span>
<a href="#l15.56"></a><span id="l15.56" class="difflineplus">+  function testMoveFolder2() {</span>
<a href="#l15.57"></a><span id="l15.57" class="difflineplus">+    copyFolders([gLocalFolder2], true, localAccountUtils.inboxFolder);</span>
<a href="#l15.58"></a><span id="l15.58" class="difflineplus">+  },</span>
<a href="#l15.59"></a><span id="l15.59">   // Folder structure should now be</span>
<a href="#l15.60"></a><span id="l15.60">   // Inbox</span>
<a href="#l15.61"></a><span id="l15.61">   // -folder2</span>
<a href="#l15.62"></a><span id="l15.62">   // --folder3</span>
<a href="#l15.63"></a><span id="l15.63">   // -folder3</span>
<a href="#l15.64"></a><span id="l15.64">   // Trash</span>
<a href="#l15.65"></a><span id="l15.65"> </span>
<a href="#l15.66"></a><span id="l15.66">   // Deleting messages</span>
<a href="#l15.67"></a><span id="l15.67">   function testDeleteMessages1() { // delete to trash</span>
<a href="#l15.68"></a><span id="l15.68">     // Let's take a moment to re-initialize stuff that got moved</span>
<a href="#l15.69"></a><span id="l15.69" class="difflineminus">-    gLocalFolder2 = gLocalInboxFolder.getChildNamed(&quot;folder2&quot;);</span>
<a href="#l15.70"></a><span id="l15.70" class="difflineplus">+    gLocalFolder2 = localAccountUtils.inboxFolder.getChildNamed(&quot;folder2&quot;);</span>
<a href="#l15.71"></a><span id="l15.71">     gLocalFolder3 = gLocalFolder2.getChildNamed(&quot;folder3&quot;);</span>
<a href="#l15.72"></a><span id="l15.72">     var folder3DB = gLocalFolder3.msgDatabase;</span>
<a href="#l15.73"></a><span id="l15.73">     for (var i = 0; i &lt; gMsgHdrs.length; i++)</span>
<a href="#l15.74"></a><span id="l15.74">       gMsgHdrs[i].hdr = folder3DB.getMsgHdrForMessageID(gMsgHdrs[i].ID);</span>
<a href="#l15.75"></a><span id="l15.75"> </span>
<a href="#l15.76"></a><span id="l15.76">     // Now delete the message</span>
<a href="#l15.77"></a><span id="l15.77">     deleteMessages(gLocalFolder3, [gMsgHdrs[0].hdr, gMsgHdrs[1].hdr], false, false);</span>
<a href="#l15.78"></a><span id="l15.78">   },</span>
<a href="#l15.79"></a><span id="l15.79" class="difflineat">@@ -227,53 +245,62 @@ const gTestArray =</span>
<a href="#l15.80"></a><span id="l15.80">   },</span>
<a href="#l15.81"></a><span id="l15.81">   // shift delete from trash</span>
<a href="#l15.82"></a><span id="l15.82">   function testDeleteMessages4() { deleteMessages(gLocalTrashFolder, [gMsgHdrs[1].hdr], true, false); },</span>
<a href="#l15.83"></a><span id="l15.83"> </span>
<a href="#l15.84"></a><span id="l15.84">   // Renaming folders</span>
<a href="#l15.85"></a><span id="l15.85">   function testRename1() { renameFolder(gLocalFolder3, &quot;folder4&quot;); },</span>
<a href="#l15.86"></a><span id="l15.86">   function testRename2() { renameFolder(gLocalFolder2.getChildNamed(&quot;folder4&quot;), &quot;folder3&quot;); },</span>
<a href="#l15.87"></a><span id="l15.87">   function testRename3() { renameFolder(gLocalFolder2, &quot;folder4&quot;); },</span>
<a href="#l15.88"></a><span id="l15.88" class="difflineminus">-  function testRename4() { renameFolder(gLocalInboxFolder.getChildNamed(&quot;folder4&quot;), &quot;folder2&quot;); },</span>
<a href="#l15.89"></a><span id="l15.89" class="difflineplus">+  function testRename4() {</span>
<a href="#l15.90"></a><span id="l15.90" class="difflineplus">+    renameFolder(localAccountUtils.inboxFolder.getChildNamed(&quot;folder4&quot;), &quot;folder2&quot;);</span>
<a href="#l15.91"></a><span id="l15.91" class="difflineplus">+  },</span>
<a href="#l15.92"></a><span id="l15.92" class="difflineplus">+</span>
<a href="#l15.93"></a><span id="l15.93">   // Folder structure should still be</span>
<a href="#l15.94"></a><span id="l15.94">   // Inbox</span>
<a href="#l15.95"></a><span id="l15.95">   // -folder2</span>
<a href="#l15.96"></a><span id="l15.96">   // --folder3</span>
<a href="#l15.97"></a><span id="l15.97">   // -folder3</span>
<a href="#l15.98"></a><span id="l15.98">   // Trash</span>
<a href="#l15.99"></a><span id="l15.99"> </span>
<a href="#l15.100"></a><span id="l15.100">   // Deleting folders (currently only one folder delete is supported through the UI)</span>
<a href="#l15.101"></a><span id="l15.101" class="difflineminus">-  function deleteFolder1() { deleteFolder(gLocalInboxFolder.getChildNamed(&quot;folder3&quot;), null); },</span>
<a href="#l15.102"></a><span id="l15.102" class="difflineplus">+  function deleteFolder1() {</span>
<a href="#l15.103"></a><span id="l15.103" class="difflineplus">+    deleteFolder(localAccountUtils.inboxFolder.getChildNamed(&quot;folder3&quot;), null);</span>
<a href="#l15.104"></a><span id="l15.104" class="difflineplus">+  },</span>
<a href="#l15.105"></a><span id="l15.105">   // Folder structure should now be</span>
<a href="#l15.106"></a><span id="l15.106">   // Inbox</span>
<a href="#l15.107"></a><span id="l15.107">   // -folder2</span>
<a href="#l15.108"></a><span id="l15.108">   // --folder3</span>
<a href="#l15.109"></a><span id="l15.109">   // Trash</span>
<a href="#l15.110"></a><span id="l15.110">   // -folder3</span>
<a href="#l15.111"></a><span id="l15.111" class="difflineminus">-  function deleteFolder2() { deleteFolder(gLocalInboxFolder.getChildNamed(&quot;folder2&quot;), null); },</span>
<a href="#l15.112"></a><span id="l15.112" class="difflineplus">+  function deleteFolder2() {</span>
<a href="#l15.113"></a><span id="l15.113" class="difflineplus">+    deleteFolder(localAccountUtils.inboxFolder.getChildNamed(&quot;folder2&quot;), null);</span>
<a href="#l15.114"></a><span id="l15.114" class="difflineplus">+  },</span>
<a href="#l15.115"></a><span id="l15.115">   // Folder structure should now be</span>
<a href="#l15.116"></a><span id="l15.116">   // Inbox</span>
<a href="#l15.117"></a><span id="l15.117">   // Trash</span>
<a href="#l15.118"></a><span id="l15.118">   // -folder2</span>
<a href="#l15.119"></a><span id="l15.119">   // --folder3</span>
<a href="#l15.120"></a><span id="l15.120">   // -folder3</span>
<a href="#l15.121"></a><span id="l15.121" class="difflineminus">-  function deleteFolder3() { deleteFolder(gLocalTrashFolder.getChildNamed(&quot;folder3&quot;), null); },</span>
<a href="#l15.122"></a><span id="l15.122" class="difflineplus">+  function deleteFolder3() {</span>
<a href="#l15.123"></a><span id="l15.123" class="difflineplus">+    deleteFolder(gLocalTrashFolder.getChildNamed(&quot;folder3&quot;), null);</span>
<a href="#l15.124"></a><span id="l15.124" class="difflineplus">+  },</span>
<a href="#l15.125"></a><span id="l15.125">   // Folder structure should now be</span>
<a href="#l15.126"></a><span id="l15.126">   // Inbox</span>
<a href="#l15.127"></a><span id="l15.127">   // Trash</span>
<a href="#l15.128"></a><span id="l15.128">   // -folder2</span>
<a href="#l15.129"></a><span id="l15.129">   // --folder3</span>
<a href="#l15.130"></a><span id="l15.130">   function deleteFolder4() {</span>
<a href="#l15.131"></a><span id="l15.131">     // Let's take a moment to re-initialize stuff that got moved</span>
<a href="#l15.132"></a><span id="l15.132">     gLocalFolder2 = gLocalTrashFolder.getChildNamed(&quot;folder2&quot;);</span>
<a href="#l15.133"></a><span id="l15.133">     gLocalFolder3 = gLocalFolder2.getChildNamed(&quot;folder3&quot;);</span>
<a href="#l15.134"></a><span id="l15.134">     deleteFolder(gLocalFolder2, gLocalFolder3); },</span>
<a href="#l15.135"></a><span id="l15.135">   function compactInbox() {</span>
<a href="#l15.136"></a><span id="l15.136" class="difflineminus">-    if (gLocalInboxFolder.msgStore.supportsCompaction)</span>
<a href="#l15.137"></a><span id="l15.137" class="difflineminus">-      compactFolder(gLocalInboxFolder);</span>
<a href="#l15.138"></a><span id="l15.138" class="difflineplus">+    if (localAccountUtils.inboxFolder.msgStore.supportsCompaction)</span>
<a href="#l15.139"></a><span id="l15.139" class="difflineplus">+      compactFolder(localAccountUtils.inboxFolder);</span>
<a href="#l15.140"></a><span id="l15.140">     else</span>
<a href="#l15.141"></a><span id="l15.141">       doTest(++gTest);</span>
<a href="#l15.142"></a><span id="l15.142">   }</span>
<a href="#l15.143"></a><span id="l15.143"> ];</span>
<a href="#l15.144"></a><span id="l15.144">   // Folder structure should just be</span>
<a href="#l15.145"></a><span id="l15.145">   // Inbox</span>
<a href="#l15.146"></a><span id="l15.146">   // Trash</span>
<a href="#l15.147"></a><span id="l15.147"> </span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l16.1"></a><span id="l16.1" class="difflineminus">--- a/mailnews/base/test/unit/test_postPluginFilters.js</span>
<a href="#l16.2"></a><span id="l16.2" class="difflineplus">+++ b/mailnews/base/test/unit/test_postPluginFilters.js</span>
<a href="#l16.3"></a><span id="l16.3" class="difflineat">@@ -104,17 +104,17 @@ function run_test()</span>
<a href="#l16.4"></a><span id="l16.4">   filter.appendAction(action);</span>
<a href="#l16.5"></a><span id="l16.5">   filter.filterType = Ci.nsMsgFilterType.PostPlugin;</span>
<a href="#l16.6"></a><span id="l16.6">   filter.enabled = true;</span>
<a href="#l16.7"></a><span id="l16.7">   filterList.insertFilterAt(1, filter);</span>
<a href="#l16.8"></a><span id="l16.8"> </span>
<a href="#l16.9"></a><span id="l16.9">   // setup a db listener to grab the message headers. There's probably an</span>
<a href="#l16.10"></a><span id="l16.10">   // easier way, but this works.</span>
<a href="#l16.11"></a><span id="l16.11">   gInboxListener = new DBListener();</span>
<a href="#l16.12"></a><span id="l16.12" class="difflineminus">-  gDbService.registerPendingListener(gLocalInboxFolder, gInboxListener);</span>
<a href="#l16.13"></a><span id="l16.13" class="difflineplus">+  gDbService.registerPendingListener(localAccountUtils.inboxFolder, gInboxListener);</span>
<a href="#l16.14"></a><span id="l16.14"> </span>
<a href="#l16.15"></a><span id="l16.15">   do_test_pending();</span>
<a href="#l16.16"></a><span id="l16.16"> </span>
<a href="#l16.17"></a><span id="l16.17">   startCommand();</span>
<a href="#l16.18"></a><span id="l16.18"> }</span>
<a href="#l16.19"></a><span id="l16.19"> </span>
<a href="#l16.20"></a><span id="l16.20"> function endTest()</span>
<a href="#l16.21"></a><span id="l16.21"> {</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l17.1"></a><span id="l17.1" class="difflineminus">--- a/mailnews/base/test/unit/test_quarantineFilterMove.js</span>
<a href="#l17.2"></a><span id="l17.2" class="difflineplus">+++ b/mailnews/base/test/unit/test_quarantineFilterMove.js</span>
<a href="#l17.3"></a><span id="l17.3" class="difflineat">@@ -44,17 +44,17 @@ const gTestArray =</span>
<a href="#l17.4"></a><span id="l17.4">   },</span>
<a href="#l17.5"></a><span id="l17.5">   function waitForCopyToFinish() {</span>
<a href="#l17.6"></a><span id="l17.6">     do_timeout(1000, function() {++gCurTestNum; doTest();});</span>
<a href="#l17.7"></a><span id="l17.7">   },</span>
<a href="#l17.8"></a><span id="l17.8">   function verifyFolders1() {</span>
<a href="#l17.9"></a><span id="l17.9">     do_check_eq(folderCount(gMoveFolder), 2);</span>
<a href="#l17.10"></a><span id="l17.10">     // the local inbox folder should now be empty, since the second</span>
<a href="#l17.11"></a><span id="l17.11">     // operation was a move</span>
<a href="#l17.12"></a><span id="l17.12" class="difflineminus">-    do_check_eq(folderCount(gLocalInboxFolder), 0);</span>
<a href="#l17.13"></a><span id="l17.13" class="difflineplus">+    do_check_eq(folderCount(localAccountUtils.inboxFolder), 0);</span>
<a href="#l17.14"></a><span id="l17.14"> </span>
<a href="#l17.15"></a><span id="l17.15">     let enumerator = gMoveFolder.msgDatabase.EnumerateMessages();</span>
<a href="#l17.16"></a><span id="l17.16">     let firstMsgHdr = enumerator.getNext().QueryInterface(Ci.nsIMsgDBHdr);</span>
<a href="#l17.17"></a><span id="l17.17">     let secondMsgHdr = enumerator.getNext().QueryInterface(Ci.nsIMsgDBHdr);</span>
<a href="#l17.18"></a><span id="l17.18">     // Check that the messages have content</span>
<a href="#l17.19"></a><span id="l17.19">     messageContent = getContentFromMessage(firstMsgHdr);</span>
<a href="#l17.20"></a><span id="l17.20">     do_check_true(messageContent.contains(&quot;Some User &lt;bugmail@example.org&gt; changed&quot;));</span>
<a href="#l17.21"></a><span id="l17.21">     messageContent = getContentFromMessage(secondMsgHdr);</span>
<a href="#l17.22"></a><span id="l17.22" class="difflineat">@@ -107,17 +107,17 @@ function run_test()</span>
<a href="#l17.23"></a><span id="l17.23"> {</span>
<a href="#l17.24"></a><span id="l17.24">   /* may not work in Linux */</span>
<a href="#l17.25"></a><span id="l17.25">   //if (&quot;@mozilla.org/gnome-gconf-service;1&quot; in Cc)</span>
<a href="#l17.26"></a><span id="l17.26">   //  return;</span>
<a href="#l17.27"></a><span id="l17.27">   /**/</span>
<a href="#l17.28"></a><span id="l17.28"> </span>
<a href="#l17.29"></a><span id="l17.29">   // quarantine messages</span>
<a href="#l17.30"></a><span id="l17.30">   Services.prefs.setBoolPref(&quot;mailnews.downloadToTempFile&quot;, true);</span>
<a href="#l17.31"></a><span id="l17.31" class="difflineminus">-  if (!gLocalInboxFolder)</span>
<a href="#l17.32"></a><span id="l17.32" class="difflineplus">+  if (!localAccountUtils.inboxFolder)</span>
<a href="#l17.33"></a><span id="l17.33">     localAccountUtils.loadLocalMailAccount();</span>
<a href="#l17.34"></a><span id="l17.34"> </span>
<a href="#l17.35"></a><span id="l17.35">   gMoveFolder = localAccountUtils.incomingServer.rootMsgFolder</span>
<a href="#l17.36"></a><span id="l17.36">                   .createLocalSubfolder(&quot;MoveFolder&quot;);</span>
<a href="#l17.37"></a><span id="l17.37">   gMoveFolder2 = localAccountUtils.incomingServer.rootMsgFolder</span>
<a href="#l17.38"></a><span id="l17.38">                   .createLocalSubfolder(&quot;MoveFolder2&quot;);</span>
<a href="#l17.39"></a><span id="l17.39"> </span>
<a href="#l17.40"></a><span id="l17.40">   MailServices.mailSession.AddFolderListener(FolderListener, Ci.nsIFolderListener.event |</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l18.1"></a><span id="l18.1" class="difflineminus">--- a/mailnews/base/test/unit/test_search.js</span>
<a href="#l18.2"></a><span id="l18.2" class="difflineplus">+++ b/mailnews/base/test/unit/test_search.js</span>
<a href="#l18.3"></a><span id="l18.3" class="difflineat">@@ -245,38 +245,38 @@ function run_test()</span>
<a href="#l18.4"></a><span id="l18.4"> </span>
<a href="#l18.5"></a><span id="l18.5">   // set value of headers we want parsed into the db</span>
<a href="#l18.6"></a><span id="l18.6">   Services.prefs.setCharPref(&quot;mailnews.customDBHeaders&quot;,</span>
<a href="#l18.7"></a><span id="l18.7">                              &quot;oneLiner twoLiner threeLiner noSpace withSpace&quot;);</span>
<a href="#l18.8"></a><span id="l18.8">   // Get a message into the local filestore. function testSearch() continues</span>
<a href="#l18.9"></a><span id="l18.9">   // the testing after the copy.</span>
<a href="#l18.10"></a><span id="l18.10">   var bugmail12 = do_get_file(&quot;../../../data/bugmail12&quot;);</span>
<a href="#l18.11"></a><span id="l18.11">   do_test_pending();</span>
<a href="#l18.12"></a><span id="l18.12" class="difflineminus">-  MailServices.copy.CopyFileMessage(bugmail12, gLocalInboxFolder, null, false, 0,</span>
<a href="#l18.13"></a><span id="l18.13" class="difflineminus">-                                    &quot;&quot;, copyListener, null);</span>
<a href="#l18.14"></a><span id="l18.14" class="difflineplus">+  MailServices.copy.CopyFileMessage(bugmail12, localAccountUtils.inboxFolder, null,</span>
<a href="#l18.15"></a><span id="l18.15" class="difflineplus">+                                    false, 0, &quot;&quot;, copyListener, null);</span>
<a href="#l18.16"></a><span id="l18.16"> }</span>
<a href="#l18.17"></a><span id="l18.17"> </span>
<a href="#l18.18"></a><span id="l18.18"> // process each test from queue, calls itself upon completion of each search</span>
<a href="#l18.19"></a><span id="l18.19"> var testObject;</span>
<a href="#l18.20"></a><span id="l18.20"> function testSearch()</span>
<a href="#l18.21"></a><span id="l18.21"> {</span>
<a href="#l18.22"></a><span id="l18.22">   var test = Tests.shift();</span>
<a href="#l18.23"></a><span id="l18.23">   if (test &amp;&amp; test.dbHeader)</span>
<a href="#l18.24"></a><span id="l18.24">   {</span>
<a href="#l18.25"></a><span id="l18.25">     //  test of a custom db header</span>
<a href="#l18.26"></a><span id="l18.26">     dump(&quot;testing dbHeader &quot; + test.dbHeader + &quot;\n&quot;);</span>
<a href="#l18.27"></a><span id="l18.27" class="difflineminus">-    customValue = mailTestUtils.firstMsgHdr(gLocalInboxFolder)</span>
<a href="#l18.28"></a><span id="l18.28" class="difflineplus">+    customValue = mailTestUtils.firstMsgHdr(localAccountUtils.inboxFolder)</span>
<a href="#l18.29"></a><span id="l18.29">                                .getProperty(test.dbHeader);</span>
<a href="#l18.30"></a><span id="l18.30">     do_check_eq(customValue, test.testString);</span>
<a href="#l18.31"></a><span id="l18.31">     do_timeout(0, testSearch);</span>
<a href="#l18.32"></a><span id="l18.32">   }</span>
<a href="#l18.33"></a><span id="l18.33">   else if (test)</span>
<a href="#l18.34"></a><span id="l18.34">   {</span>
<a href="#l18.35"></a><span id="l18.35">     dump(&quot;testing for string '&quot; + test.testString + &quot;'\n&quot;);</span>
<a href="#l18.36"></a><span id="l18.36" class="difflineminus">-    testObject = new TestSearch(gLocalInboxFolder,</span>
<a href="#l18.37"></a><span id="l18.37" class="difflineplus">+    testObject = new TestSearch(localAccountUtils.inboxFolder,</span>
<a href="#l18.38"></a><span id="l18.38">                          test.testString,</span>
<a href="#l18.39"></a><span id="l18.39">                          test.testAttribute,</span>
<a href="#l18.40"></a><span id="l18.40">                          test.op,</span>
<a href="#l18.41"></a><span id="l18.41">                          test.count,</span>
<a href="#l18.42"></a><span id="l18.42">                          testSearch,</span>
<a href="#l18.43"></a><span id="l18.43">                          null,</span>
<a href="#l18.44"></a><span id="l18.44">                          test.customHeader ? test.customHeader : &quot;X-Bugzilla-Watch-Reason&quot;);</span>
<a href="#l18.45"></a><span id="l18.45">   }</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l19.1"></a><span id="l19.1" class="difflineminus">--- a/mailnews/base/test/unit/test_searchAddressInAb.js</span>
<a href="#l19.2"></a><span id="l19.2" class="difflineplus">+++ b/mailnews/base/test/unit/test_searchAddressInAb.js</span>
<a href="#l19.3"></a><span id="l19.3" class="difflineat">@@ -230,35 +230,35 @@ var copyListener =</span>
<a href="#l19.4"></a><span id="l19.4">   SetMessageKey: function(aKey) {},</span>
<a href="#l19.5"></a><span id="l19.5">   SetMessageId: function(aMessageId) {},</span>
<a href="#l19.6"></a><span id="l19.6">   OnStopCopy: function(aStatus) </span>
<a href="#l19.7"></a><span id="l19.7">   {</span>
<a href="#l19.8"></a><span id="l19.8">     var fileName = Files.shift();</span>
<a href="#l19.9"></a><span id="l19.9">     if (fileName)</span>
<a href="#l19.10"></a><span id="l19.10">     { </span>
<a href="#l19.11"></a><span id="l19.11">       var file = do_get_file(fileName);</span>
<a href="#l19.12"></a><span id="l19.12" class="difflineminus">-      MailServices.copy.CopyFileMessage(file, gLocalInboxFolder, null, false, 0,</span>
<a href="#l19.13"></a><span id="l19.13" class="difflineminus">-                                        &quot;&quot;, copyListener, null);</span>
<a href="#l19.14"></a><span id="l19.14" class="difflineplus">+      MailServices.copy.CopyFileMessage(file, localAccountUtils.inboxFolder, null,</span>
<a href="#l19.15"></a><span id="l19.15" class="difflineplus">+                                        false, 0, &quot;&quot;, copyListener, null);</span>
<a href="#l19.16"></a><span id="l19.16">     }</span>
<a href="#l19.17"></a><span id="l19.17">     else</span>
<a href="#l19.18"></a><span id="l19.18">       testAbSearch();</span>
<a href="#l19.19"></a><span id="l19.19">   }</span>
<a href="#l19.20"></a><span id="l19.20"> };</span>
<a href="#l19.21"></a><span id="l19.21"> </span>
<a href="#l19.22"></a><span id="l19.22"> // Runs at completion of copy</span>
<a href="#l19.23"></a><span id="l19.23"> </span>
<a href="#l19.24"></a><span id="l19.24"> // process each test from queue, calls itself upon completion of each search</span>
<a href="#l19.25"></a><span id="l19.25"> var testObject;</span>
<a href="#l19.26"></a><span id="l19.26"> function testAbSearch()</span>
<a href="#l19.27"></a><span id="l19.27"> {</span>
<a href="#l19.28"></a><span id="l19.28">   print(&quot;Test AbSearch&quot;);</span>
<a href="#l19.29"></a><span id="l19.29">   var test = Tests.shift();</span>
<a href="#l19.30"></a><span id="l19.30">   if (test)</span>
<a href="#l19.31"></a><span id="l19.31">   {</span>
<a href="#l19.32"></a><span id="l19.32" class="difflineminus">-    testObject = new TestSearch(gLocalInboxFolder,</span>
<a href="#l19.33"></a><span id="l19.33" class="difflineplus">+    testObject = new TestSearch(localAccountUtils.inboxFolder,</span>
<a href="#l19.34"></a><span id="l19.34">                          test.value,</span>
<a href="#l19.35"></a><span id="l19.35">                          test.attrib,</span>
<a href="#l19.36"></a><span id="l19.36">                          test.op,</span>
<a href="#l19.37"></a><span id="l19.37">                          test.count,</span>
<a href="#l19.38"></a><span id="l19.38">                          testAbSearch);</span>
<a href="#l19.39"></a><span id="l19.39">   }</span>
<a href="#l19.40"></a><span id="l19.40">   else</span>
<a href="#l19.41"></a><span id="l19.41">     do_test_finished();</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l20.1"></a><span id="l20.1" class="difflineminus">--- a/mailnews/base/test/unit/test_searchBody.js</span>
<a href="#l20.2"></a><span id="l20.2" class="difflineplus">+++ b/mailnews/base/test/unit/test_searchBody.js</span>
<a href="#l20.3"></a><span id="l20.3" class="difflineat">@@ -98,18 +98,18 @@ var copyListener =</span>
<a href="#l20.4"></a><span id="l20.4">   SetMessageKey: function(aKey) {},</span>
<a href="#l20.5"></a><span id="l20.5">   SetMessageId: function(aMessageId) {},</span>
<a href="#l20.6"></a><span id="l20.6">   OnStopCopy: function(aStatus) </span>
<a href="#l20.7"></a><span id="l20.7">   {</span>
<a href="#l20.8"></a><span id="l20.8">     var fileName = Files.shift();</span>
<a href="#l20.9"></a><span id="l20.9">     if (fileName)</span>
<a href="#l20.10"></a><span id="l20.10">     { </span>
<a href="#l20.11"></a><span id="l20.11">       var file = fixFile(do_get_file(fileName));</span>
<a href="#l20.12"></a><span id="l20.12" class="difflineminus">-      MailServices.copy.CopyFileMessage(file, gLocalInboxFolder, null, false, 0,</span>
<a href="#l20.13"></a><span id="l20.13" class="difflineminus">-                                        &quot;&quot;, copyListener, null);</span>
<a href="#l20.14"></a><span id="l20.14" class="difflineplus">+      MailServices.copy.CopyFileMessage(file, localAccountUtils.inboxFolder, null,</span>
<a href="#l20.15"></a><span id="l20.15" class="difflineplus">+                                        false, 0, &quot;&quot;, copyListener, null);</span>
<a href="#l20.16"></a><span id="l20.16">     }</span>
<a href="#l20.17"></a><span id="l20.17">     else</span>
<a href="#l20.18"></a><span id="l20.18">       testBodySearch();</span>
<a href="#l20.19"></a><span id="l20.19">   }</span>
<a href="#l20.20"></a><span id="l20.20"> };</span>
<a href="#l20.21"></a><span id="l20.21"> </span>
<a href="#l20.22"></a><span id="l20.22"> function run_test()</span>
<a href="#l20.23"></a><span id="l20.23"> {</span>
<a href="#l20.24"></a><span id="l20.24" class="difflineat">@@ -168,17 +168,17 @@ function run_test()</span>
<a href="#l20.25"></a><span id="l20.25"> </span>
<a href="#l20.26"></a><span id="l20.26"> // process each test from queue, calls itself upon completion of each search</span>
<a href="#l20.27"></a><span id="l20.27"> var testObject;</span>
<a href="#l20.28"></a><span id="l20.28"> function testBodySearch()</span>
<a href="#l20.29"></a><span id="l20.29"> {</span>
<a href="#l20.30"></a><span id="l20.30">   var test = Tests.shift();</span>
<a href="#l20.31"></a><span id="l20.31">   if (test)</span>
<a href="#l20.32"></a><span id="l20.32">   {</span>
<a href="#l20.33"></a><span id="l20.33" class="difflineminus">-    testObject = new TestSearch(gLocalInboxFolder,</span>
<a href="#l20.34"></a><span id="l20.34" class="difflineplus">+    testObject = new TestSearch(localAccountUtils.inboxFolder,</span>
<a href="#l20.35"></a><span id="l20.35">                          test.value,</span>
<a href="#l20.36"></a><span id="l20.36">                          Body,</span>
<a href="#l20.37"></a><span id="l20.37">                          test.op,</span>
<a href="#l20.38"></a><span id="l20.38">                          test.count,</span>
<a href="#l20.39"></a><span id="l20.39">                          testBodySearch);</span>
<a href="#l20.40"></a><span id="l20.40">   }</span>
<a href="#l20.41"></a><span id="l20.41">   else</span>
<a href="#l20.42"></a><span id="l20.42">   {</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l21.1"></a><span id="l21.1" class="difflineminus">--- a/mailnews/base/test/unit/test_searchBoolean.js</span>
<a href="#l21.2"></a><span id="l21.2" class="difflineplus">+++ b/mailnews/base/test/unit/test_searchBoolean.js</span>
<a href="#l21.3"></a><span id="l21.3" class="difflineat">@@ -135,39 +135,42 @@ function run_test()</span>
<a href="#l21.4"></a><span id="l21.4">     searchTerm.op = Ci.nsMsgSearchOp.Is;</span>
<a href="#l21.5"></a><span id="l21.5">     searchTerm.booleanAnd = aBoolAnd;</span>
<a href="#l21.6"></a><span id="l21.6">     searchTerm.beginsGrouping = aBeginGrouping;</span>
<a href="#l21.7"></a><span id="l21.7">     searchTerm.endsGrouping = aEndGrouping;</span>
<a href="#l21.8"></a><span id="l21.8">     searchTerm.hdrProperty = aHdrProperty;</span>
<a href="#l21.9"></a><span id="l21.9">     gSearchSession.appendTerm(searchTerm);</span>
<a href="#l21.10"></a><span id="l21.10">   }</span>
<a href="#l21.11"></a><span id="l21.11"> </span>
<a href="#l21.12"></a><span id="l21.12" class="difflineminus">-  gSearchSession.addScopeTerm(Ci.nsMsgSearchScope.offlineMail, gLocalInboxFolder);</span>
<a href="#l21.13"></a><span id="l21.13" class="difflineplus">+  gSearchSession.addScopeTerm(Ci.nsMsgSearchScope.offlineMail,</span>
<a href="#l21.14"></a><span id="l21.14" class="difflineplus">+                              localAccountUtils.inboxFolder);</span>
<a href="#l21.15"></a><span id="l21.15">   gSearchSession.registerListener(searchListener);</span>
<a href="#l21.16"></a><span id="l21.16">   // I tried using capital &quot;A&quot; but something makes it lower case internally, so it failed</span>
<a href="#l21.17"></a><span id="l21.17">   addSearchTerm(&quot;a&quot;, true, false, true);  // &quot;(A&quot;</span>
<a href="#l21.18"></a><span id="l21.18">   addSearchTerm(&quot;b&quot;, false, true, false); // &quot; || B)&quot;</span>
<a href="#l21.19"></a><span id="l21.19">   addSearchTerm(&quot;c&quot;, true, false, true);  // &quot; &amp;&amp; (C&quot;</span>
<a href="#l21.20"></a><span id="l21.20">   addSearchTerm(&quot;d&quot;, false, true, false); // &quot; || D)&quot;</span>
<a href="#l21.21"></a><span id="l21.21"> </span>
<a href="#l21.22"></a><span id="l21.22">   var copyListener = </span>
<a href="#l21.23"></a><span id="l21.23">   {</span>
<a href="#l21.24"></a><span id="l21.24">     OnStartCopy: function() {},</span>
<a href="#l21.25"></a><span id="l21.25">     OnProgress: function(aProgress, aProgressMax) {},</span>
<a href="#l21.26"></a><span id="l21.26" class="difflineminus">-    SetMessageKey: function(aKey) { gHdr = gLocalInboxFolder.GetMessageHeader(aKey);},</span>
<a href="#l21.27"></a><span id="l21.27" class="difflineplus">+    SetMessageKey: function(aKey) {</span>
<a href="#l21.28"></a><span id="l21.28" class="difflineplus">+      gHdr = localAccountUtils.inboxFolder.GetMessageHeader(aKey);</span>
<a href="#l21.29"></a><span id="l21.29" class="difflineplus">+    },</span>
<a href="#l21.30"></a><span id="l21.30">     SetMessageId: function(aMessageId) {},</span>
<a href="#l21.31"></a><span id="l21.31">     OnStopCopy: function(aStatus) { testSearch();}</span>
<a href="#l21.32"></a><span id="l21.32">   };</span>
<a href="#l21.33"></a><span id="l21.33"> </span>
<a href="#l21.34"></a><span id="l21.34">   // Get a message into the local filestore. function testSearch() continues</span>
<a href="#l21.35"></a><span id="l21.35">   // the testing after the copy.</span>
<a href="#l21.36"></a><span id="l21.36">   var bugmail1 = do_get_file(&quot;../../../data/bugmail1&quot;);</span>
<a href="#l21.37"></a><span id="l21.37">   do_test_pending();</span>
<a href="#l21.38"></a><span id="l21.38" class="difflineminus">-  MailServices.copy.CopyFileMessage(bugmail1, gLocalInboxFolder, null, false, 0,</span>
<a href="#l21.39"></a><span id="l21.39" class="difflineminus">-                                    &quot;&quot;, copyListener, null);</span>
<a href="#l21.40"></a><span id="l21.40" class="difflineplus">+  MailServices.copy.CopyFileMessage(bugmail1, localAccountUtils.inboxFolder, null,</span>
<a href="#l21.41"></a><span id="l21.41" class="difflineplus">+                                    false, 0, &quot;&quot;, copyListener, null);</span>
<a href="#l21.42"></a><span id="l21.42"> }</span>
<a href="#l21.43"></a><span id="l21.43"> </span>
<a href="#l21.44"></a><span id="l21.44"> let gTest = null;</span>
<a href="#l21.45"></a><span id="l21.45"> // process each test from queue, calls itself upon completion of each search</span>
<a href="#l21.46"></a><span id="l21.46"> function testSearch()</span>
<a href="#l21.47"></a><span id="l21.47"> {</span>
<a href="#l21.48"></a><span id="l21.48">   // tests the previous search</span>
<a href="#l21.49"></a><span id="l21.49">   if (gTest)</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l22.1"></a><span id="l22.1" class="difflineminus">--- a/mailnews/base/test/unit/test_searchCustomTerm.js</span>
<a href="#l22.2"></a><span id="l22.2" class="difflineplus">+++ b/mailnews/base/test/unit/test_searchCustomTerm.js</span>
<a href="#l22.3"></a><span id="l22.3" class="difflineat">@@ -28,22 +28,22 @@ var Tests =</span>
<a href="#l22.4"></a><span id="l22.4"> // nsIMsgSearchCustomTerm object</span>
<a href="#l22.5"></a><span id="l22.5"> var customTerm =</span>
<a href="#l22.6"></a><span id="l22.6"> {</span>
<a href="#l22.7"></a><span id="l22.7">   id: kCustomId,</span>
<a href="#l22.8"></a><span id="l22.8">   name: &quot;term name&quot;,</span>
<a href="#l22.9"></a><span id="l22.9">   getEnabled: function(scope, op)</span>
<a href="#l22.10"></a><span id="l22.10">     {</span>
<a href="#l22.11"></a><span id="l22.11">       return scope == Ci.nsMsgSearchScope.offlineMail &amp;&amp;</span>
<a href="#l22.12"></a><span id="l22.12" class="difflineminus">-             op == Ci.nsMsgSearchOp.Is</span>
<a href="#l22.13"></a><span id="l22.13" class="difflineplus">+             op == Ci.nsMsgSearchOp.Is;</span>
<a href="#l22.14"></a><span id="l22.14">     },</span>
<a href="#l22.15"></a><span id="l22.15">   getAvailable: function(scope, op)</span>
<a href="#l22.16"></a><span id="l22.16">     {</span>
<a href="#l22.17"></a><span id="l22.17">       return scope == Ci.nsMsgSearchScope.offlineMail &amp;&amp;</span>
<a href="#l22.18"></a><span id="l22.18" class="difflineminus">-             op == Ci.nsMsgSearchOp.Is</span>
<a href="#l22.19"></a><span id="l22.19" class="difflineplus">+             op == Ci.nsMsgSearchOp.Is;</span>
<a href="#l22.20"></a><span id="l22.20">     },</span>
<a href="#l22.21"></a><span id="l22.21">   getAvailableOperators: function(scope, length)</span>
<a href="#l22.22"></a><span id="l22.22">     {</span>
<a href="#l22.23"></a><span id="l22.23">        length.value = 1;</span>
<a href="#l22.24"></a><span id="l22.24">        return [Ci.nsMsgSearchOp.Is];</span>
<a href="#l22.25"></a><span id="l22.25">     },</span>
<a href="#l22.26"></a><span id="l22.26">   match: function(msgHdr, searchValue, searchOp)</span>
<a href="#l22.27"></a><span id="l22.27">     {</span>
<a href="#l22.28"></a><span id="l22.28" class="difflineat">@@ -61,39 +61,41 @@ function run_test()</span>
<a href="#l22.29"></a><span id="l22.29"> {</span>
<a href="#l22.30"></a><span id="l22.30">   localAccountUtils.loadLocalMailAccount();</span>
<a href="#l22.31"></a><span id="l22.31">   MailServices.filters.addCustomTerm(customTerm);</span>
<a href="#l22.32"></a><span id="l22.32"> </span>
<a href="#l22.33"></a><span id="l22.33">   var copyListener = </span>
<a href="#l22.34"></a><span id="l22.34">   {</span>
<a href="#l22.35"></a><span id="l22.35">     OnStartCopy: function() {},</span>
<a href="#l22.36"></a><span id="l22.36">     OnProgress: function(aProgress, aProgressMax) {},</span>
<a href="#l22.37"></a><span id="l22.37" class="difflineminus">-    SetMessageKey: function(aKey) { gHdr = gLocalInboxFolder.GetMessageHeader(aKey);},</span>
<a href="#l22.38"></a><span id="l22.38" class="difflineplus">+    SetMessageKey: function(aKey) {</span>
<a href="#l22.39"></a><span id="l22.39" class="difflineplus">+      gHdr = localAccountUtils.inboxFolder.GetMessageHeader(aKey);</span>
<a href="#l22.40"></a><span id="l22.40" class="difflineplus">+    },</span>
<a href="#l22.41"></a><span id="l22.41">     SetMessageId: function(aMessageId) {},</span>
<a href="#l22.42"></a><span id="l22.42">     OnStopCopy: function(aStatus) { doTest();}</span>
<a href="#l22.43"></a><span id="l22.43">   };</span>
<a href="#l22.44"></a><span id="l22.44"> </span>
<a href="#l22.45"></a><span id="l22.45">   // Get a message into the local filestore.</span>
<a href="#l22.46"></a><span id="l22.46">   // function testSearch() continues the testing after the copy.</span>
<a href="#l22.47"></a><span id="l22.47">   let bugmail1 = do_get_file(&quot;../../../data/bugmail1&quot;);</span>
<a href="#l22.48"></a><span id="l22.48">   do_test_pending();</span>
<a href="#l22.49"></a><span id="l22.49"> </span>
<a href="#l22.50"></a><span id="l22.50" class="difflineminus">-  MailServices.copy.CopyFileMessage(bugmail1, gLocalInboxFolder, null, false, 0,</span>
<a href="#l22.51"></a><span id="l22.51" class="difflineminus">-                                    &quot;&quot;, copyListener, null);</span>
<a href="#l22.52"></a><span id="l22.52" class="difflineplus">+  MailServices.copy.CopyFileMessage(bugmail1, localAccountUtils.inboxFolder, null,</span>
<a href="#l22.53"></a><span id="l22.53" class="difflineplus">+                                    false, 0, &quot;&quot;, copyListener, null);</span>
<a href="#l22.54"></a><span id="l22.54"> }</span>
<a href="#l22.55"></a><span id="l22.55"> </span>
<a href="#l22.56"></a><span id="l22.56"> var testObject;</span>
<a href="#l22.57"></a><span id="l22.57"> </span>
<a href="#l22.58"></a><span id="l22.58"> function doTest()</span>
<a href="#l22.59"></a><span id="l22.59"> {</span>
<a href="#l22.60"></a><span id="l22.60">   let test = Tests.shift();</span>
<a href="#l22.61"></a><span id="l22.61">   if (test)</span>
<a href="#l22.62"></a><span id="l22.62">   {</span>
<a href="#l22.63"></a><span id="l22.63">     gHdr.setStringProperty(&quot;theTestProperty&quot;, test.setValue);</span>
<a href="#l22.64"></a><span id="l22.64" class="difflineminus">-    testObject = new TestSearch(gLocalInboxFolder,</span>
<a href="#l22.65"></a><span id="l22.65" class="difflineplus">+    testObject = new TestSearch(localAccountUtils.inboxFolder,</span>
<a href="#l22.66"></a><span id="l22.66">                          test.testValue,</span>
<a href="#l22.67"></a><span id="l22.67">                          Ci.nsMsgSearchAttrib.Custom,</span>
<a href="#l22.68"></a><span id="l22.68">                          test.op,</span>
<a href="#l22.69"></a><span id="l22.69">                          test.count,</span>
<a href="#l22.70"></a><span id="l22.70">                          doTest,</span>
<a href="#l22.71"></a><span id="l22.71">                          kCustomId);</span>
<a href="#l22.72"></a><span id="l22.72">   }</span>
<a href="#l22.73"></a><span id="l22.73">   else</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l23.1"></a><span id="l23.1" class="difflineminus">--- a/mailnews/base/test/unit/test_searchJunk.js</span>
<a href="#l23.2"></a><span id="l23.2" class="difflineplus">+++ b/mailnews/base/test/unit/test_searchJunk.js</span>
<a href="#l23.3"></a><span id="l23.3" class="difflineat">@@ -224,27 +224,27 @@ function run_test()</span>
<a href="#l23.4"></a><span id="l23.4">   testValidityTable(offlineMail, Is, JunkScoreOrigin, true);</span>
<a href="#l23.5"></a><span id="l23.5">   testValidityTable(offlineMail, Isnt, JunkScoreOrigin, true);</span>
<a href="#l23.6"></a><span id="l23.6">   testValidityTable(offlineMail, IsGreaterThan, JunkScoreOrigin, false);</span>
<a href="#l23.7"></a><span id="l23.7">   testValidityTable(offlineMail, IsLessThan, JunkScoreOrigin, false);</span>
<a href="#l23.8"></a><span id="l23.8"> </span>
<a href="#l23.9"></a><span id="l23.9">   // Get a message into the local filestore. function testJunkSearch() continues the testing after the copy.</span>
<a href="#l23.10"></a><span id="l23.10">   do_test_pending();</span>
<a href="#l23.11"></a><span id="l23.11">   var file = do_get_file(fileName);</span>
<a href="#l23.12"></a><span id="l23.12" class="difflineminus">-  MailServices.copy.CopyFileMessage(file, gLocalInboxFolder, null, false, 0,</span>
<a href="#l23.13"></a><span id="l23.13" class="difflineplus">+  MailServices.copy.CopyFileMessage(file, localAccountUtils.inboxFolder, null, false, 0,</span>
<a href="#l23.14"></a><span id="l23.14">                                     &quot;&quot;, copyListener, null);</span>
<a href="#l23.15"></a><span id="l23.15">   return true;</span>
<a href="#l23.16"></a><span id="l23.16"> }</span>
<a href="#l23.17"></a><span id="l23.17"> </span>
<a href="#l23.18"></a><span id="l23.18"> var hdr;</span>
<a href="#l23.19"></a><span id="l23.19"> var copyListener = </span>
<a href="#l23.20"></a><span id="l23.20"> {</span>
<a href="#l23.21"></a><span id="l23.21">   OnStartCopy: function() {},</span>
<a href="#l23.22"></a><span id="l23.22">   OnProgress: function(aProgress, aProgressMax) {},</span>
<a href="#l23.23"></a><span id="l23.23" class="difflineminus">-  SetMessageKey: function(aKey) { hdr = gLocalInboxFolder.GetMessageHeader(aKey);},</span>
<a href="#l23.24"></a><span id="l23.24" class="difflineplus">+  SetMessageKey: function(aKey) { hdr = localAccountUtils.inboxFolder.GetMessageHeader(aKey);},</span>
<a href="#l23.25"></a><span id="l23.25">   SetMessageId: function(aMessageId) {},</span>
<a href="#l23.26"></a><span id="l23.26">   OnStopCopy: function(aStatus) { testJunkSearch();}</span>
<a href="#l23.27"></a><span id="l23.27"> };</span>
<a href="#l23.28"></a><span id="l23.28"> </span>
<a href="#l23.29"></a><span id="l23.29"> // Runs at completion of each copy</span>
<a href="#l23.30"></a><span id="l23.30"> // process each test from queue, calls itself upon completion of each search</span>
<a href="#l23.31"></a><span id="l23.31"> var testObject;</span>
<a href="#l23.32"></a><span id="l23.32"> function testJunkSearch()</span>
<a href="#l23.33"></a><span id="l23.33" class="difflineat">@@ -254,17 +254,17 @@ function testJunkSearch()</span>
<a href="#l23.34"></a><span id="l23.34">   {</span>
<a href="#l23.35"></a><span id="l23.35">     if (test.junkScore)</span>
<a href="#l23.36"></a><span id="l23.36">     {</span>
<a href="#l23.37"></a><span id="l23.37">       hdr.setStringProperty(&quot;junkpercent&quot;, test.junkPercent);</span>
<a href="#l23.38"></a><span id="l23.38">       hdr.setStringProperty(&quot;junkscoreorigin&quot;, test.junkScoreOrigin);</span>
<a href="#l23.39"></a><span id="l23.39">       hdr.setStringProperty(&quot;junkscore&quot;, test.junkScore);</span>
<a href="#l23.40"></a><span id="l23.40">     }</span>
<a href="#l23.41"></a><span id="l23.41"> </span>
<a href="#l23.42"></a><span id="l23.42" class="difflineminus">-    testObject = new TestSearch(gLocalInboxFolder,</span>
<a href="#l23.43"></a><span id="l23.43" class="difflineplus">+    testObject = new TestSearch(localAccountUtils.inboxFolder,</span>
<a href="#l23.44"></a><span id="l23.44">                          test.testValue,</span>
<a href="#l23.45"></a><span id="l23.45">                          test.attrib,</span>
<a href="#l23.46"></a><span id="l23.46">                          test.op,</span>
<a href="#l23.47"></a><span id="l23.47">                          test.count,</span>
<a href="#l23.48"></a><span id="l23.48">                          testJunkSearch);</span>
<a href="#l23.49"></a><span id="l23.49">   }</span>
<a href="#l23.50"></a><span id="l23.50">   else</span>
<a href="#l23.51"></a><span id="l23.51">   {</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l24.1"></a><span id="l24.1" class="difflineminus">--- a/mailnews/base/test/unit/test_searchTag.js</span>
<a href="#l24.2"></a><span id="l24.2" class="difflineplus">+++ b/mailnews/base/test/unit/test_searchTag.js</span>
<a href="#l24.3"></a><span id="l24.3" class="difflineat">@@ -337,37 +337,39 @@ function run_test()</span>
<a href="#l24.4"></a><span id="l24.4">   // add as valid tags Tag1 and Tag4</span>
<a href="#l24.5"></a><span id="l24.5">   MailServices.tags.addTagForKey(Tag1, Tag1, null, null);</span>
<a href="#l24.6"></a><span id="l24.6">   MailServices.tags.addTagForKey(Tag4, Tag4, null, null);</span>
<a href="#l24.7"></a><span id="l24.7"> </span>
<a href="#l24.8"></a><span id="l24.8">   var copyListener = </span>
<a href="#l24.9"></a><span id="l24.9">   {</span>
<a href="#l24.10"></a><span id="l24.10">     OnStartCopy: function() {},</span>
<a href="#l24.11"></a><span id="l24.11">     OnProgress: function(aProgress, aProgressMax) {},</span>
<a href="#l24.12"></a><span id="l24.12" class="difflineminus">-    SetMessageKey: function(aKey) { hdr = gLocalInboxFolder.GetMessageHeader(aKey);},</span>
<a href="#l24.13"></a><span id="l24.13" class="difflineplus">+    SetMessageKey: function(aKey) {</span>
<a href="#l24.14"></a><span id="l24.14" class="difflineplus">+      hdr = localAccountUtils.inboxFolder.GetMessageHeader(aKey);</span>
<a href="#l24.15"></a><span id="l24.15" class="difflineplus">+    },</span>
<a href="#l24.16"></a><span id="l24.16">     SetMessageId: function(aMessageId) {},</span>
<a href="#l24.17"></a><span id="l24.17">     OnStopCopy: function(aStatus) { testKeywordSearch();}</span>
<a href="#l24.18"></a><span id="l24.18">   };</span>
<a href="#l24.19"></a><span id="l24.19"> </span>
<a href="#l24.20"></a><span id="l24.20">   // Get a message into the local filestore. function testKeywordSearch() continues the testing after the copy.</span>
<a href="#l24.21"></a><span id="l24.21">   var bugmail1 = do_get_file(&quot;../../../data/bugmail1&quot;);</span>
<a href="#l24.22"></a><span id="l24.22">   do_test_pending();</span>
<a href="#l24.23"></a><span id="l24.23" class="difflineminus">-  MailServices.copy.CopyFileMessage(bugmail1, gLocalInboxFolder, null, false, 0,</span>
<a href="#l24.24"></a><span id="l24.24" class="difflineminus">-                                    &quot;&quot;, copyListener, null);</span>
<a href="#l24.25"></a><span id="l24.25" class="difflineplus">+  MailServices.copy.CopyFileMessage(bugmail1, localAccountUtils.inboxFolder, null,</span>
<a href="#l24.26"></a><span id="l24.26" class="difflineplus">+                                    false, 0, &quot;&quot;, copyListener, null);</span>
<a href="#l24.27"></a><span id="l24.27"> }</span>
<a href="#l24.28"></a><span id="l24.28"> </span>
<a href="#l24.29"></a><span id="l24.29"> // process each test from queue, calls itself upon completion of each search</span>
<a href="#l24.30"></a><span id="l24.30"> var testObject;</span>
<a href="#l24.31"></a><span id="l24.31"> function testKeywordSearch()</span>
<a href="#l24.32"></a><span id="l24.32"> {</span>
<a href="#l24.33"></a><span id="l24.33">   var test = Tests.shift();</span>
<a href="#l24.34"></a><span id="l24.34">   if (test)</span>
<a href="#l24.35"></a><span id="l24.35">   {</span>
<a href="#l24.36"></a><span id="l24.36">     hdr.setStringProperty(&quot;keywords&quot;, test.msgTag);</span>
<a href="#l24.37"></a><span id="l24.37" class="difflineminus">-    testObject = new TestSearch(gLocalInboxFolder,</span>
<a href="#l24.38"></a><span id="l24.38" class="difflineplus">+    testObject = new TestSearch(localAccountUtils.inboxFolder,</span>
<a href="#l24.39"></a><span id="l24.39">                          test.testTag,</span>
<a href="#l24.40"></a><span id="l24.40">                          nsMsgSearchAttrib.Keywords,</span>
<a href="#l24.41"></a><span id="l24.41">                          test.op,</span>
<a href="#l24.42"></a><span id="l24.42">                          test.count,</span>
<a href="#l24.43"></a><span id="l24.43">                          testKeywordSearch);</span>
<a href="#l24.44"></a><span id="l24.44">   }</span>
<a href="#l24.45"></a><span id="l24.45">   else</span>
<a href="#l24.46"></a><span id="l24.46">   {</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l25.1"></a><span id="l25.1" class="difflineminus">--- a/mailnews/base/test/unit/test_searchUint32HdrProperty.js</span>
<a href="#l25.2"></a><span id="l25.2" class="difflineplus">+++ b/mailnews/base/test/unit/test_searchUint32HdrProperty.js</span>
<a href="#l25.3"></a><span id="l25.3" class="difflineat">@@ -28,17 +28,17 @@ var Tests =</span>
<a href="#l25.4"></a><span id="l25.4">     value: 1,</span>
<a href="#l25.5"></a><span id="l25.5">     count: 0 },</span>
<a href="#l25.6"></a><span id="l25.6">   { hdrProperty: &quot;idonotexist&quot;,</span>
<a href="#l25.7"></a><span id="l25.7">     op: Isnt,</span>
<a href="#l25.8"></a><span id="l25.8">     value: 1,</span>
<a href="#l25.9"></a><span id="l25.9">     count: 1 },</span>
<a href="#l25.10"></a><span id="l25.10">   // add a property and test its value</span>
<a href="#l25.11"></a><span id="l25.11">   { setup: function setupProperty() {</span>
<a href="#l25.12"></a><span id="l25.12" class="difflineminus">-      let enumerator = gLocalInboxFolder.msgDatabase.EnumerateMessages();</span>
<a href="#l25.13"></a><span id="l25.13" class="difflineplus">+      let enumerator = localAccountUtils.inboxFolder.msgDatabase.EnumerateMessages();</span>
<a href="#l25.14"></a><span id="l25.14">       while(enumerator.hasMoreElements())</span>
<a href="#l25.15"></a><span id="l25.15">         enumerator.getNext().QueryInterface(Ci.nsIMsgDBHdr).setUint32Property(&quot;iam23&quot;, 23);</span>
<a href="#l25.16"></a><span id="l25.16">     },</span>
<a href="#l25.17"></a><span id="l25.17">     hdrProperty: &quot;iam23&quot;,</span>
<a href="#l25.18"></a><span id="l25.18">     op: Is,</span>
<a href="#l25.19"></a><span id="l25.19">     value: 23,</span>
<a href="#l25.20"></a><span id="l25.20">     count: 1 },</span>
<a href="#l25.21"></a><span id="l25.21">   { hdrProperty: &quot;iam23&quot;,</span>
<a href="#l25.22"></a><span id="l25.22" class="difflineat">@@ -83,30 +83,30 @@ function run_test()</span>
<a href="#l25.23"></a><span id="l25.23">     SetMessageId: function(aMessageId) {},</span>
<a href="#l25.24"></a><span id="l25.24">     OnStopCopy: function(aStatus) { testSearch();}</span>
<a href="#l25.25"></a><span id="l25.25">   };</span>
<a href="#l25.26"></a><span id="l25.26"> </span>
<a href="#l25.27"></a><span id="l25.27">   // Get a message into the local filestore. function testSearch() continues</span>
<a href="#l25.28"></a><span id="l25.28">   // the testing after the copy.</span>
<a href="#l25.29"></a><span id="l25.29">   var bugmail1 = do_get_file(&quot;../../../data/bugmail1&quot;);</span>
<a href="#l25.30"></a><span id="l25.30">   do_test_pending();</span>
<a href="#l25.31"></a><span id="l25.31" class="difflineminus">-  MailServices.copy.CopyFileMessage(bugmail1, gLocalInboxFolder, null, false, 0,</span>
<a href="#l25.32"></a><span id="l25.32" class="difflineminus">-                                    &quot;&quot;, copyListener, null);</span>
<a href="#l25.33"></a><span id="l25.33" class="difflineplus">+  MailServices.copy.CopyFileMessage(bugmail1, localAccountUtils.inboxFolder, null,</span>
<a href="#l25.34"></a><span id="l25.34" class="difflineplus">+                                    false, 0, &quot;&quot;, copyListener, null);</span>
<a href="#l25.35"></a><span id="l25.35"> }</span>
<a href="#l25.36"></a><span id="l25.36"> </span>
<a href="#l25.37"></a><span id="l25.37"> // process each test from queue, calls itself upon completion of each search</span>
<a href="#l25.38"></a><span id="l25.38"> var testObject;</span>
<a href="#l25.39"></a><span id="l25.39"> function testSearch()</span>
<a href="#l25.40"></a><span id="l25.40"> {</span>
<a href="#l25.41"></a><span id="l25.41">   var test = Tests.shift();</span>
<a href="#l25.42"></a><span id="l25.42">   if (test)</span>
<a href="#l25.43"></a><span id="l25.43">   {</span>
<a href="#l25.44"></a><span id="l25.44">     if (test.setup)</span>
<a href="#l25.45"></a><span id="l25.45">       test.setup();</span>
<a href="#l25.46"></a><span id="l25.46" class="difflineminus">-    testObject = new TestSearch(gLocalInboxFolder,</span>
<a href="#l25.47"></a><span id="l25.47" class="difflineplus">+    testObject = new TestSearch(localAccountUtils.inboxFolder,</span>
<a href="#l25.48"></a><span id="l25.48">                          test.value,</span>
<a href="#l25.49"></a><span id="l25.49">                          nsMsgSearchAttrib.Uint32HdrProperty,</span>
<a href="#l25.50"></a><span id="l25.50">                          test.op,</span>
<a href="#l25.51"></a><span id="l25.51">                          test.count,</span>
<a href="#l25.52"></a><span id="l25.52">                          testSearch,</span>
<a href="#l25.53"></a><span id="l25.53">                          null,</span>
<a href="#l25.54"></a><span id="l25.54">                          null,</span>
<a href="#l25.55"></a><span id="l25.55">                          test.hdrProperty);</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l26.1"></a><span id="l26.1" class="difflineminus">--- a/mailnews/compose/test/unit/test_bug235432.js</span>
<a href="#l26.2"></a><span id="l26.2" class="difflineplus">+++ b/mailnews/compose/test/unit/test_bug235432.js</span>
<a href="#l26.3"></a><span id="l26.3" class="difflineat">@@ -58,17 +58,17 @@ function copyFileMessageInLocalFolder(aM</span>
<a href="#l26.4"></a><span id="l26.4">                                       aMessageWindow,</span>
<a href="#l26.5"></a><span id="l26.5">                                       aCallback) {</span>
<a href="#l26.6"></a><span id="l26.6">   // Set up local folders</span>
<a href="#l26.7"></a><span id="l26.7">   localAccountUtils.loadLocalMailAccount();</span>
<a href="#l26.8"></a><span id="l26.8"> </span>
<a href="#l26.9"></a><span id="l26.9">   gCopyListener.callbackFunction = aCallback;</span>
<a href="#l26.10"></a><span id="l26.10">   // Copy a message into the local folder</span>
<a href="#l26.11"></a><span id="l26.11">   MailServices.copy.CopyFileMessage(aMessageFile,</span>
<a href="#l26.12"></a><span id="l26.12" class="difflineminus">-                                    gLocalInboxFolder,</span>
<a href="#l26.13"></a><span id="l26.13" class="difflineplus">+                                    localAccountUtils.inboxFolder,</span>
<a href="#l26.14"></a><span id="l26.14">                                     null, false,</span>
<a href="#l26.15"></a><span id="l26.15">                                     aMessageFlags,</span>
<a href="#l26.16"></a><span id="l26.16">                                     aMessageKeywords,</span>
<a href="#l26.17"></a><span id="l26.17">                                     gCopyListener,</span>
<a href="#l26.18"></a><span id="l26.18">                                     aMessageWindow);</span>
<a href="#l26.19"></a><span id="l26.19"> }</span>
<a href="#l26.20"></a><span id="l26.20"> </span>
<a href="#l26.21"></a><span id="l26.21"> // The attatchment file can not be obtained from js test,</span>
<a href="#l26.22"></a><span id="l26.22" class="difflineat">@@ -116,18 +116,18 @@ function send_message_later(aMessageHead</span>
<a href="#l26.23"></a><span id="l26.23">   rootFolder.createLocalSubfolder(&quot;Drafts&quot;);</span>
<a href="#l26.24"></a><span id="l26.24"> </span>
<a href="#l26.25"></a><span id="l26.25">   let smtpServer = getBasicSmtpServer();</span>
<a href="#l26.26"></a><span id="l26.26">   let identity = getSmtpIdentity(kSender, smtpServer);</span>
<a href="#l26.27"></a><span id="l26.27"> </span>
<a href="#l26.28"></a><span id="l26.28">   compFields.from = identity.email;</span>
<a href="#l26.29"></a><span id="l26.29">   compFields.to = kTo;</span>
<a href="#l26.30"></a><span id="l26.30"> </span>
<a href="#l26.31"></a><span id="l26.31" class="difflineminus">-  let msgHdr = gLocalInboxFolder.GetMessageHeader(aMessageHeaderKeys[0]);</span>
<a href="#l26.32"></a><span id="l26.32" class="difflineminus">-  let messageUri = gLocalInboxFolder.getUriForMsg(msgHdr);</span>
<a href="#l26.33"></a><span id="l26.33" class="difflineplus">+  let msgHdr = localAccountUtils.inboxFolder.GetMessageHeader(aMessageHeaderKeys[0]);</span>
<a href="#l26.34"></a><span id="l26.34" class="difflineplus">+  let messageUri = localAccountUtils.inboxFolder.getUriForMsg(msgHdr);</span>
<a href="#l26.35"></a><span id="l26.35"> </span>
<a href="#l26.36"></a><span id="l26.36">   let attachment = Cc[&quot;@mozilla.org/messengercompose/attachment;1&quot;]</span>
<a href="#l26.37"></a><span id="l26.37">                      .createInstance(Ci.nsIMsgAttachment);</span>
<a href="#l26.38"></a><span id="l26.38">   attachment.url = messageUri;</span>
<a href="#l26.39"></a><span id="l26.39">   attachment.contentType = 'message/rfc822';</span>
<a href="#l26.40"></a><span id="l26.40">   attachment.name = 'Attachment e-mail';</span>
<a href="#l26.41"></a><span id="l26.41">   compFields.addAttachment(attachment);</span>
<a href="#l26.42"></a><span id="l26.42"> </span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l27.1"></a><span id="l27.1" class="difflineminus">--- a/mailnews/db/msgdb/test/unit/test_enumerator_cleanup.js</span>
<a href="#l27.2"></a><span id="l27.2" class="difflineplus">+++ b/mailnews/db/msgdb/test/unit/test_enumerator_cleanup.js</span>
<a href="#l27.3"></a><span id="l27.3" class="difflineat">@@ -5,38 +5,38 @@</span>
<a href="#l27.4"></a><span id="l27.4"> Components.utils.import(&quot;resource:///modules/mailServices.js&quot;);</span>
<a href="#l27.5"></a><span id="l27.5"> </span>
<a href="#l27.6"></a><span id="l27.6"> const anyOldMessage = do_get_file(&quot;../../../../data/bugmail1&quot;);</span>
<a href="#l27.7"></a><span id="l27.7"> </span>
<a href="#l27.8"></a><span id="l27.8"> /**</span>
<a href="#l27.9"></a><span id="l27.9">  * Test closing a db with an outstanding enumerator.</span>
<a href="#l27.10"></a><span id="l27.10">  */</span>
<a href="#l27.11"></a><span id="l27.11"> function test_enumerator_cleanup() {</span>
<a href="#l27.12"></a><span id="l27.12" class="difflineminus">-  let db = gLocalInboxFolder.msgDatabase;</span>
<a href="#l27.13"></a><span id="l27.13" class="difflineplus">+  let db = localAccountUtils.inboxFolder.msgDatabase;</span>
<a href="#l27.14"></a><span id="l27.14">   let enumerator = db.EnumerateMessages();</span>
<a href="#l27.15"></a><span id="l27.15" class="difflineminus">-  db.forceFolderDBClosed(gLocalInboxFolder);</span>
<a href="#l27.16"></a><span id="l27.16" class="difflineminus">-  gLocalInboxFolder.msgDatabase = null;</span>
<a href="#l27.17"></a><span id="l27.17" class="difflineplus">+  db.forceFolderDBClosed(localAccountUtils.inboxFolder);</span>
<a href="#l27.18"></a><span id="l27.18" class="difflineplus">+  localAccountUtils.inboxFolder.msgDatabase = null;</span>
<a href="#l27.19"></a><span id="l27.19">   db = null;</span>
<a href="#l27.20"></a><span id="l27.20">   gc();</span>
<a href="#l27.21"></a><span id="l27.21">   while (enumerator.hasMoreElements())</span>
<a href="#l27.22"></a><span id="l27.22">     var header = enumerator.getNext();</span>
<a href="#l27.23"></a><span id="l27.23"> </span>
<a href="#l27.24"></a><span id="l27.24">   do_test_finished();</span>
<a href="#l27.25"></a><span id="l27.25"> }</span>
<a href="#l27.26"></a><span id="l27.26"> </span>
<a href="#l27.27"></a><span id="l27.27"> /*</span>
<a href="#l27.28"></a><span id="l27.28">  * This infrastructure down here exists just to get</span>
<a href="#l27.29"></a><span id="l27.29">  *  test_references_header_parsing its message header.</span>
<a href="#l27.30"></a><span id="l27.30">  */</span>
<a href="#l27.31"></a><span id="l27.31"> </span>
<a href="#l27.32"></a><span id="l27.32"> function run_test() {</span>
<a href="#l27.33"></a><span id="l27.33">   localAccountUtils.loadLocalMailAccount();</span>
<a href="#l27.34"></a><span id="l27.34">   do_test_pending();</span>
<a href="#l27.35"></a><span id="l27.35" class="difflineminus">-  MailServices.copy.CopyFileMessage(anyOldMessage, gLocalInboxFolder, null, false, 0,</span>
<a href="#l27.36"></a><span id="l27.36" class="difflineminus">-                                    &quot;&quot;, messageHeaderGetterListener, null);</span>
<a href="#l27.37"></a><span id="l27.37" class="difflineplus">+  MailServices.copy.CopyFileMessage(anyOldMessage, localAccountUtils.inboxFolder, null,</span>
<a href="#l27.38"></a><span id="l27.38" class="difflineplus">+                                    false, 0, &quot;&quot;, messageHeaderGetterListener, null);</span>
<a href="#l27.39"></a><span id="l27.39">   return true;</span>
<a href="#l27.40"></a><span id="l27.40"> }</span>
<a href="#l27.41"></a><span id="l27.41"> </span>
<a href="#l27.42"></a><span id="l27.42"> var messageHeaderGetterListener = {</span>
<a href="#l27.43"></a><span id="l27.43">   OnStartCopy: function() {},</span>
<a href="#l27.44"></a><span id="l27.44">   OnProgress: function(aProgress, aProgressMax) {},</span>
<a href="#l27.45"></a><span id="l27.45">   GetMessageId: function (aMessageId) {},</span>
<a href="#l27.46"></a><span id="l27.46">   SetMessageKey: function(aKey) {</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l28.1"></a><span id="l28.1" class="difflineminus">--- a/mailnews/db/msgdb/test/unit/test_filter_enumerator.js</span>
<a href="#l28.2"></a><span id="l28.2" class="difflineplus">+++ b/mailnews/db/msgdb/test/unit/test_filter_enumerator.js</span>
<a href="#l28.3"></a><span id="l28.3" class="difflineat">@@ -10,44 +10,45 @@ const nsMsgFolderFlags = Ci.nsMsgFolderF</span>
<a href="#l28.4"></a><span id="l28.4"> const kSetCount = 13;</span>
<a href="#l28.5"></a><span id="l28.5"> const kNumExpectedMatches = 10;</span>
<a href="#l28.6"></a><span id="l28.6"> </span>
<a href="#l28.7"></a><span id="l28.7"> function setupGlobals()</span>
<a href="#l28.8"></a><span id="l28.8"> {</span>
<a href="#l28.9"></a><span id="l28.9">   localAccountUtils.loadLocalMailAccount();</span>
<a href="#l28.10"></a><span id="l28.10">   // Create a message generator</span>
<a href="#l28.11"></a><span id="l28.11">   let messageGenerator = new MessageGenerator();</span>
<a href="#l28.12"></a><span id="l28.12" class="difflineminus">-  let localInbox = gLocalInboxFolder.QueryInterface(Ci.nsIMsgLocalMailFolder);</span>
<a href="#l28.13"></a><span id="l28.13" class="difflineplus">+  let localInbox = localAccountUtils.inboxFolder.QueryInterface(Ci.nsIMsgLocalMailFolder);</span>
<a href="#l28.14"></a><span id="l28.14"> </span>
<a href="#l28.15"></a><span id="l28.15">   for (let i = 0; i &lt; kSetCount; i++) {</span>
<a href="#l28.16"></a><span id="l28.16">     let message = messageGenerator.makeMessage();</span>
<a href="#l28.17"></a><span id="l28.17">     gMessages.push(message);</span>
<a href="#l28.18"></a><span id="l28.18">     localInbox.addMessage(message.toMboxString());</span>
<a href="#l28.19"></a><span id="l28.19">   }</span>
<a href="#l28.20"></a><span id="l28.20"> }</span>
<a href="#l28.21"></a><span id="l28.21"> </span>
<a href="#l28.22"></a><span id="l28.22"> function run_test() {</span>
<a href="#l28.23"></a><span id="l28.23">   setupGlobals();</span>
<a href="#l28.24"></a><span id="l28.24">   do_test_pending();</span>
<a href="#l28.25"></a><span id="l28.25" class="difflineminus">-  let inboxDB = gLocalInboxFolder.msgDatabase;</span>
<a href="#l28.26"></a><span id="l28.26" class="difflineplus">+  let inboxDB = localAccountUtils.inboxFolder.msgDatabase;</span>
<a href="#l28.27"></a><span id="l28.27"> </span>
<a href="#l28.28"></a><span id="l28.28">   // give messages 1,3,5 gloda-ids. These won't end up in our search hits.</span>
<a href="#l28.29"></a><span id="l28.29">   let msgHdr1 = inboxDB.getMsgHdrForMessageID(gMessages[0].messageId);</span>
<a href="#l28.30"></a><span id="l28.30">   msgHdr1.setUint32Property(&quot;gloda-id&quot;, 11111);</span>
<a href="#l28.31"></a><span id="l28.31">   let msgHdr3 = inboxDB.getMsgHdrForMessageID(gMessages[2].messageId);</span>
<a href="#l28.32"></a><span id="l28.32">   msgHdr3.setUint32Property(&quot;gloda-id&quot;, 33333);</span>
<a href="#l28.33"></a><span id="l28.33">   let msgHdr5 = inboxDB.getMsgHdrForMessageID(gMessages[4].messageId);</span>
<a href="#l28.34"></a><span id="l28.34">   msgHdr5.setUint32Property(&quot;gloda-id&quot;, 5555);</span>
<a href="#l28.35"></a><span id="l28.35">   // set up a search term array that will give us the array of messages</span>
<a href="#l28.36"></a><span id="l28.36">   // that gloda should index, as defined by this function:</span>
<a href="#l28.37"></a><span id="l28.37">   let searchSession = Cc[&quot;@mozilla.org/messenger/searchSession;1&quot;]</span>
<a href="#l28.38"></a><span id="l28.38">                         .createInstance(Ci.nsIMsgSearchSession);</span>
<a href="#l28.39"></a><span id="l28.39">   let searchTerms = Cc[&quot;@mozilla.org/array;1&quot;].createInstance(Ci.nsIMutableArray);</span>
<a href="#l28.40"></a><span id="l28.40"> </span>
<a href="#l28.41"></a><span id="l28.41" class="difflineminus">-  searchSession.addScopeTerm(Ci.nsMsgSearchScope.offlineMail, gLocalInboxFolder);</span>
<a href="#l28.42"></a><span id="l28.42" class="difflineplus">+  searchSession.addScopeTerm(Ci.nsMsgSearchScope.offlineMail,</span>
<a href="#l28.43"></a><span id="l28.43" class="difflineplus">+                             localAccountUtils.inboxFolder);</span>
<a href="#l28.44"></a><span id="l28.44">   let searchTerm = searchSession.createTerm();</span>
<a href="#l28.45"></a><span id="l28.45"> </span>
<a href="#l28.46"></a><span id="l28.46">   // Create the following search term:</span>
<a href="#l28.47"></a><span id="l28.47">   // (folderFlag &amp; Mail &amp;&amp; folderFlag != ImapBox) &amp;&amp;</span>
<a href="#l28.48"></a><span id="l28.48">   //    msg property.gloda-id isEmpty</span>
<a href="#l28.49"></a><span id="l28.49"> </span>
<a href="#l28.50"></a><span id="l28.50">   searchTerm.beginsGrouping = true;</span>
<a href="#l28.51"></a><span id="l28.51">   searchTerm.booleanAnd = true;</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l29.1"></a><span id="l29.1" class="difflineminus">--- a/mailnews/db/msgdb/test/unit/test_propertyEnumerator.js</span>
<a href="#l29.2"></a><span id="l29.2" class="difflineplus">+++ b/mailnews/db/msgdb/test/unit/test_propertyEnumerator.js</span>
<a href="#l29.3"></a><span id="l29.3" class="difflineat">@@ -9,25 +9,25 @@ Components.utils.import(&quot;resource:///mod</span>
<a href="#l29.4"></a><span id="l29.4"> var gHdr;</span>
<a href="#l29.5"></a><span id="l29.5"> </span>
<a href="#l29.6"></a><span id="l29.6"> function run_test() {</span>
<a href="#l29.7"></a><span id="l29.7">   localAccountUtils.loadLocalMailAccount();</span>
<a href="#l29.8"></a><span id="l29.8">   // Get a message into the local filestore.</span>
<a href="#l29.9"></a><span id="l29.9">   // Function continue_test() continues the testing after the copy.</span>
<a href="#l29.10"></a><span id="l29.10">   var bugmail1 = do_get_file(&quot;../../../../data/bugmail1&quot;);</span>
<a href="#l29.11"></a><span id="l29.11">   do_test_pending();</span>
<a href="#l29.12"></a><span id="l29.12" class="difflineminus">-  MailServices.copy.CopyFileMessage(bugmail1, gLocalInboxFolder, null, false, 0,</span>
<a href="#l29.13"></a><span id="l29.13" class="difflineminus">-                                    &quot;&quot;, copyListener, null);</span>
<a href="#l29.14"></a><span id="l29.14" class="difflineplus">+  MailServices.copy.CopyFileMessage(bugmail1, localAccountUtils.inboxFolder, null,</span>
<a href="#l29.15"></a><span id="l29.15" class="difflineplus">+                                    false, 0, &quot;&quot;, copyListener, null);</span>
<a href="#l29.16"></a><span id="l29.16"> }</span>
<a href="#l29.17"></a><span id="l29.17"> </span>
<a href="#l29.18"></a><span id="l29.18"> var copyListener =</span>
<a href="#l29.19"></a><span id="l29.19"> {</span>
<a href="#l29.20"></a><span id="l29.20">   OnStartCopy: function() {},</span>
<a href="#l29.21"></a><span id="l29.21">   OnProgress: function(aProgress, aProgressMax) {},</span>
<a href="#l29.22"></a><span id="l29.22" class="difflineminus">-  SetMessageKey: function(aKey) { gHdr = gLocalInboxFolder.GetMessageHeader(aKey);},</span>
<a href="#l29.23"></a><span id="l29.23" class="difflineplus">+  SetMessageKey: function(aKey) { gHdr = localAccountUtils.inboxFolder.GetMessageHeader(aKey);},</span>
<a href="#l29.24"></a><span id="l29.24">   SetMessageId: function(aMessageId) {},</span>
<a href="#l29.25"></a><span id="l29.25">   OnStopCopy: function(aStatus) { continue_test();}</span>
<a href="#l29.26"></a><span id="l29.26"> };</span>
<a href="#l29.27"></a><span id="l29.27"> </span>
<a href="#l29.28"></a><span id="l29.28"> function continue_test()</span>
<a href="#l29.29"></a><span id="l29.29"> {</span>
<a href="#l29.30"></a><span id="l29.30">   // test some of the default properties</span>
<a href="#l29.31"></a><span id="l29.31">   var enumerator = gHdr.propertyEnumerator;</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l30.1"></a><span id="l30.1" class="difflineminus">--- a/mailnews/db/msgdb/test/unit/test_references_parsing.js</span>
<a href="#l30.2"></a><span id="l30.2" class="difflineplus">+++ b/mailnews/db/msgdb/test/unit/test_references_parsing.js</span>
<a href="#l30.3"></a><span id="l30.3" class="difflineat">@@ -82,27 +82,27 @@ function test_references_header_parsing(</span>
<a href="#l30.4"></a><span id="l30.4"> /*</span>
<a href="#l30.5"></a><span id="l30.5">  * This infrastructure down here exists just to get</span>
<a href="#l30.6"></a><span id="l30.6">  *  test_references_header_parsing its message header.</span>
<a href="#l30.7"></a><span id="l30.7">  */</span>
<a href="#l30.8"></a><span id="l30.8"> </span>
<a href="#l30.9"></a><span id="l30.9"> function run_test() {</span>
<a href="#l30.10"></a><span id="l30.10">   localAccountUtils.loadLocalMailAccount();</span>
<a href="#l30.11"></a><span id="l30.11">   do_test_pending();</span>
<a href="#l30.12"></a><span id="l30.12" class="difflineminus">-  MailServices.copy.CopyFileMessage(anyOldMessage, gLocalInboxFolder, null, false, 0,</span>
<a href="#l30.13"></a><span id="l30.13" class="difflineminus">-                                    &quot;&quot;, messageHeaderGetterListener, null);</span>
<a href="#l30.14"></a><span id="l30.14" class="difflineplus">+  MailServices.copy.CopyFileMessage(anyOldMessage, localAccountUtils.inboxFolder, null,</span>
<a href="#l30.15"></a><span id="l30.15" class="difflineplus">+                                    false, 0, &quot;&quot;, messageHeaderGetterListener, null);</span>
<a href="#l30.16"></a><span id="l30.16">   return true;</span>
<a href="#l30.17"></a><span id="l30.17"> }</span>
<a href="#l30.18"></a><span id="l30.18"> </span>
<a href="#l30.19"></a><span id="l30.19"> var messageHeaderGetterListener = {</span>
<a href="#l30.20"></a><span id="l30.20">   msgKey: null,</span>
<a href="#l30.21"></a><span id="l30.21">   </span>
<a href="#l30.22"></a><span id="l30.22">   OnStartCopy: function() {},</span>
<a href="#l30.23"></a><span id="l30.23">   OnProgress: function(aProgress, aProgressMax) {},</span>
<a href="#l30.24"></a><span id="l30.24">   GetMessageId: function (aMessageId) {},</span>
<a href="#l30.25"></a><span id="l30.25">   SetMessageKey: function(aKey) {</span>
<a href="#l30.26"></a><span id="l30.26">     this.msgKey = aKey;</span>
<a href="#l30.27"></a><span id="l30.27">   },</span>
<a href="#l30.28"></a><span id="l30.28">   OnStopCopy: function(aStatus) {</span>
<a href="#l30.29"></a><span id="l30.29">     test_references_header_parsing(</span>
<a href="#l30.30"></a><span id="l30.30" class="difflineminus">-      gLocalInboxFolder.GetMessageHeader(this.msgKey));</span>
<a href="#l30.31"></a><span id="l30.31" class="difflineplus">+      localAccountUtils.inboxFolder.GetMessageHeader(this.msgKey));</span>
<a href="#l30.32"></a><span id="l30.32">   },</span>
<a href="#l30.33"></a><span id="l30.33"> }</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l31.1"></a><span id="l31.1" class="difflineminus">--- a/mailnews/extensions/mdn/test/unit/test_askuser.js</span>
<a href="#l31.2"></a><span id="l31.2" class="difflineplus">+++ b/mailnews/extensions/mdn/test/unit/test_askuser.js</span>
<a href="#l31.3"></a><span id="l31.3" class="difflineat">@@ -19,29 +19,29 @@ function run_test()</span>
<a href="#l31.4"></a><span id="l31.4">     &quot;Disposition-Notification-To: alice@t1.example.com\r\n&quot;;</span>
<a href="#l31.5"></a><span id="l31.5"> </span>
<a href="#l31.6"></a><span id="l31.6">   let mimeHdr = Components.classes[&quot;@mozilla.org/messenger/mimeheaders;1&quot;]</span>
<a href="#l31.7"></a><span id="l31.7">                   .createInstance(Components.interfaces.nsIMimeHeaders);</span>
<a href="#l31.8"></a><span id="l31.8">   mimeHdr.initialize(headers);</span>
<a href="#l31.9"></a><span id="l31.9">   let receivedHeader = mimeHdr.extractHeader(&quot;To&quot;, false);</span>
<a href="#l31.10"></a><span id="l31.10">   dump(receivedHeader+&quot;\n&quot;);</span>
<a href="#l31.11"></a><span id="l31.11"> </span>
<a href="#l31.12"></a><span id="l31.12" class="difflineminus">-  let localFolder = gLocalInboxFolder.QueryInterface(Ci.nsIMsgLocalMailFolder);</span>
<a href="#l31.13"></a><span id="l31.13" class="difflineminus">-  gLocalInboxFolder.addMessage(&quot;From \r\n&quot;+ headers + &quot;\r\nhello\r\n&quot;);</span>
<a href="#l31.14"></a><span id="l31.14" class="difflineplus">+  let localFolder = localAccountUtils.inboxFolder.QueryInterface(Ci.nsIMsgLocalMailFolder);</span>
<a href="#l31.15"></a><span id="l31.15" class="difflineplus">+  localAccountUtils.inboxFolder.addMessage(&quot;From \r\n&quot;+ headers + &quot;\r\nhello\r\n&quot;);</span>
<a href="#l31.16"></a><span id="l31.16">   // Need to setup some prefs  </span>
<a href="#l31.17"></a><span id="l31.17">   Services.prefs.setBoolPref(&quot;mail.mdn.report.enabled&quot;, true);</span>
<a href="#l31.18"></a><span id="l31.18">   Services.prefs.setIntPref(&quot;mail.mdn.report.not_in_to_cc&quot;, 2);</span>
<a href="#l31.19"></a><span id="l31.19">   Services.prefs.setIntPref(&quot;mail.mdn.report.other&quot;, 2);</span>
<a href="#l31.20"></a><span id="l31.20">   Services.prefs.setIntPref(&quot;mail.mdn.report.outside_domain&quot;, 2);</span>
<a href="#l31.21"></a><span id="l31.21">   </span>
<a href="#l31.22"></a><span id="l31.22" class="difflineminus">-  var msgFolder = gLocalInboxFolder;</span>
<a href="#l31.23"></a><span id="l31.23" class="difflineplus">+  var msgFolder = localAccountUtils.inboxFolder;</span>
<a href="#l31.24"></a><span id="l31.24"> </span>
<a href="#l31.25"></a><span id="l31.25">   var msgWindow = {};</span>
<a href="#l31.26"></a><span id="l31.26">  </span>
<a href="#l31.27"></a><span id="l31.27" class="difflineminus">-  var msgHdr = mailTestUtils.firstMsgHdr(gLocalInboxFolder);</span>
<a href="#l31.28"></a><span id="l31.28" class="difflineplus">+  var msgHdr = mailTestUtils.firstMsgHdr(localAccountUtils.inboxFolder);</span>
<a href="#l31.29"></a><span id="l31.29"> </span>
<a href="#l31.30"></a><span id="l31.30">   // Everything looks good so far, let's generate the MDN response.</span>
<a href="#l31.31"></a><span id="l31.31">   var mdnGenerator = Components.classes[&quot;@mozilla.org/messenger-mdn/generator;1&quot;]</span>
<a href="#l31.32"></a><span id="l31.32">                                .createInstance(Components.interfaces.nsIMsgMdnGenerator);</span>
<a href="#l31.33"></a><span id="l31.33">   const MDN_DISPOSE_TYPE_DISPLAYED = 0;</span>
<a href="#l31.34"></a><span id="l31.34"> </span>
<a href="#l31.35"></a><span id="l31.35">   Services.prefs.setIntPref(&quot;mail.mdn.report.outside_domain&quot;, 1);</span>
<a href="#l31.36"></a><span id="l31.36">   var askUser = mdnGenerator.process(MDN_DISPOSE_TYPE_DISPLAYED, msgWindow, msgFolder,</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l32.1"></a><span id="l32.1" class="difflineminus">--- a/mailnews/extensions/mdn/test/unit/test_mdnFlags.js</span>
<a href="#l32.2"></a><span id="l32.2" class="difflineplus">+++ b/mailnews/extensions/mdn/test/unit/test_mdnFlags.js</span>
<a href="#l32.3"></a><span id="l32.3" class="difflineat">@@ -25,29 +25,29 @@ function run_test()</span>
<a href="#l32.4"></a><span id="l32.4">     &quot;return-path: alice@t1.example.com\r\n&quot; +</span>
<a href="#l32.5"></a><span id="l32.5">     &quot;Disposition-Notification-To: alice@t1.example.com\r\n&quot;;</span>
<a href="#l32.6"></a><span id="l32.6"> </span>
<a href="#l32.7"></a><span id="l32.7">   let mimeHdr = Components.classes[&quot;@mozilla.org/messenger/mimeheaders;1&quot;]</span>
<a href="#l32.8"></a><span id="l32.8">                   .createInstance(Components.interfaces.nsIMimeHeaders);</span>
<a href="#l32.9"></a><span id="l32.9">   mimeHdr.initialize(headers);</span>
<a href="#l32.10"></a><span id="l32.10">   let receivedHeader = mimeHdr.extractHeader(&quot;To&quot;, false);</span>
<a href="#l32.11"></a><span id="l32.11"> </span>
<a href="#l32.12"></a><span id="l32.12" class="difflineminus">-  let localFolder = gLocalInboxFolder.QueryInterface(Ci.nsIMsgLocalMailFolder);</span>
<a href="#l32.13"></a><span id="l32.13" class="difflineminus">-  gLocalInboxFolder.addMessage(&quot;From \r\n&quot;+ headers + &quot;\r\nhello\r\n&quot;);</span>
<a href="#l32.14"></a><span id="l32.14" class="difflineplus">+  let localFolder = localAccountUtils.inboxFolder.QueryInterface(Ci.nsIMsgLocalMailFolder);</span>
<a href="#l32.15"></a><span id="l32.15" class="difflineplus">+  localAccountUtils.inboxFolder.addMessage(&quot;From \r\n&quot;+ headers + &quot;\r\nhello\r\n&quot;);</span>
<a href="#l32.16"></a><span id="l32.16">   // Need to setup some prefs  </span>
<a href="#l32.17"></a><span id="l32.17">   Services.prefs.setBoolPref(&quot;mail.mdn.report.enabled&quot;, true);</span>
<a href="#l32.18"></a><span id="l32.18">   Services.prefs.setIntPref(&quot;mail.mdn.report.not_in_to_cc&quot;, 2);</span>
<a href="#l32.19"></a><span id="l32.19">   Services.prefs.setIntPref(&quot;mail.mdn.report.other&quot;, 2);</span>
<a href="#l32.20"></a><span id="l32.20">   Services.prefs.setIntPref(&quot;mail.mdn.report.outside_domain&quot;, 2);</span>
<a href="#l32.21"></a><span id="l32.21">   </span>
<a href="#l32.22"></a><span id="l32.22" class="difflineminus">-  var msgFolder = gLocalInboxFolder;</span>
<a href="#l32.23"></a><span id="l32.23" class="difflineplus">+  var msgFolder = localAccountUtils.inboxFolder;</span>
<a href="#l32.24"></a><span id="l32.24"> </span>
<a href="#l32.25"></a><span id="l32.25">   var msgWindow = {};</span>
<a href="#l32.26"></a><span id="l32.26">  </span>
<a href="#l32.27"></a><span id="l32.27" class="difflineminus">-  var msgHdr = mailTestUtils.firstMsgHdr(gLocalInboxFolder);</span>
<a href="#l32.28"></a><span id="l32.28" class="difflineplus">+  var msgHdr = mailTestUtils.firstMsgHdr(localAccountUtils.inboxFolder);</span>
<a href="#l32.29"></a><span id="l32.29"> </span>
<a href="#l32.30"></a><span id="l32.30">   // Everything looks good so far, let's generate the MDN response.</span>
<a href="#l32.31"></a><span id="l32.31">   var mdnGenerator = Components.classes[&quot;@mozilla.org/messenger-mdn/generator;1&quot;]</span>
<a href="#l32.32"></a><span id="l32.32">                                .createInstance(Components.interfaces.nsIMsgMdnGenerator);</span>
<a href="#l32.33"></a><span id="l32.33">   const MDN_DISPOSE_TYPE_DISPLAYED = 0;</span>
<a href="#l32.34"></a><span id="l32.34"> </span>
<a href="#l32.35"></a><span id="l32.35">   mdnGenerator.process(MDN_DISPOSE_TYPE_DISPLAYED, msgWindow, msgFolder,</span>
<a href="#l32.36"></a><span id="l32.36">                        msgHdr.messageKey, mimeHdr, false);</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l33.1"></a><span id="l33.1" class="difflineminus">--- a/mailnews/imap/test/unit/test_compactOfflineStore.js</span>
<a href="#l33.2"></a><span id="l33.2" class="difflineplus">+++ b/mailnews/imap/test/unit/test_compactOfflineStore.js</span>
<a href="#l33.3"></a><span id="l33.3" class="difflineat">@@ -186,17 +186,17 @@ function setup() {</span>
<a href="#l33.4"></a><span id="l33.4"> }</span>
<a href="#l33.5"></a><span id="l33.5"> </span>
<a href="#l33.6"></a><span id="l33.6"> // nsIMsgCopyServiceListener implementation - runs next test when copy</span>
<a href="#l33.7"></a><span id="l33.7"> // is completed.</span>
<a href="#l33.8"></a><span id="l33.8"> var CopyListener = {</span>
<a href="#l33.9"></a><span id="l33.9">   OnStartCopy: function() {},</span>
<a href="#l33.10"></a><span id="l33.10">   OnProgress: function(aProgress, aProgressMax) {},</span>
<a href="#l33.11"></a><span id="l33.11">   SetMessageKey: function(aKey) {</span>
<a href="#l33.12"></a><span id="l33.12" class="difflineminus">-    let hdr = gLocalInboxFolder.GetMessageHeader(aKey);</span>
<a href="#l33.13"></a><span id="l33.13" class="difflineplus">+    let hdr = localAccountUtils.inboxFolder.GetMessageHeader(aKey);</span>
<a href="#l33.14"></a><span id="l33.14">     gMsgHdrs.push({hdr: hdr, ID: hdr.messageId});</span>
<a href="#l33.15"></a><span id="l33.15">   },</span>
<a href="#l33.16"></a><span id="l33.16">   SetMessageId: function(aMessageId) {},</span>
<a href="#l33.17"></a><span id="l33.17">   OnStopCopy: function(aStatus) {</span>
<a href="#l33.18"></a><span id="l33.18">     // Check: message successfully copied.</span>
<a href="#l33.19"></a><span id="l33.19">     do_check_eq(aStatus, 0);</span>
<a href="#l33.20"></a><span id="l33.20">     async_driver();</span>
<a href="#l33.21"></a><span id="l33.21">   }</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l34.1"></a><span id="l34.1" class="difflineminus">--- a/mailnews/imap/test/unit/test_copyThenMove.js</span>
<a href="#l34.2"></a><span id="l34.2" class="difflineplus">+++ b/mailnews/imap/test/unit/test_copyThenMove.js</span>
<a href="#l34.3"></a><span id="l34.3" class="difflineat">@@ -35,37 +35,41 @@ var tests = [</span>
<a href="#l34.4"></a><span id="l34.4">     folders.push(gEmptyLocal2);</span>
<a href="#l34.5"></a><span id="l34.5">     let array = toXPCOMArray(folders, Ci.nsIMutableArray);</span>
<a href="#l34.6"></a><span id="l34.6">     gCopyService.CopyFolders(array, gIMAPInbox, false, CopyListener, null);</span>
<a href="#l34.7"></a><span id="l34.7">     yield false;</span>
<a href="#l34.8"></a><span id="l34.8">   },</span>
<a href="#l34.9"></a><span id="l34.9">   function getLocalMessage1() {</span>
<a href="#l34.10"></a><span id="l34.10">     dump(&quot;getLocalMessage\n&quot;);</span>
<a href="#l34.11"></a><span id="l34.11">     var file = do_get_file(&quot;../../../data/bugmail1&quot;);</span>
<a href="#l34.12"></a><span id="l34.12" class="difflineminus">-    gCopyService.CopyFileMessage(file, gLocalInboxFolder, null, false, 0,</span>
<a href="#l34.13"></a><span id="l34.13" class="difflineplus">+    gCopyService.CopyFileMessage(file, localAccountUtils.inboxFolder, null, false, 0,</span>
<a href="#l34.14"></a><span id="l34.14">                                 &quot;&quot;, CopyListener, null);</span>
<a href="#l34.15"></a><span id="l34.15">     yield false;</span>
<a href="#l34.16"></a><span id="l34.16">   },</span>
<a href="#l34.17"></a><span id="l34.17">   function getLocalMessage2() {</span>
<a href="#l34.18"></a><span id="l34.18" class="difflineminus">-    gMessages.appendElement(gLocalInboxFolder.GetMessageHeader(gLastKey), false);</span>
<a href="#l34.19"></a><span id="l34.19" class="difflineplus">+    gMessages.appendElement(localAccountUtils.inboxFolder.GetMessageHeader(gLastKey),</span>
<a href="#l34.20"></a><span id="l34.20" class="difflineplus">+                            false);</span>
<a href="#l34.21"></a><span id="l34.21">     dump(&quot;getLocalMessage\n&quot;);</span>
<a href="#l34.22"></a><span id="l34.22">     var file = do_get_file(&quot;../../../data/draft1&quot;);</span>
<a href="#l34.23"></a><span id="l34.23" class="difflineminus">-    gCopyService.CopyFileMessage(file, gLocalInboxFolder, null, false, 0,</span>
<a href="#l34.24"></a><span id="l34.24" class="difflineplus">+    gCopyService.CopyFileMessage(file, localAccountUtils.inboxFolder, null, false, 0,</span>
<a href="#l34.25"></a><span id="l34.25">                                 &quot;&quot;, CopyListener, null);</span>
<a href="#l34.26"></a><span id="l34.26">     yield false;</span>
<a href="#l34.27"></a><span id="l34.27">   },</span>
<a href="#l34.28"></a><span id="l34.28">   function copyMessages() {</span>
<a href="#l34.29"></a><span id="l34.29" class="difflineminus">-    gMessages.appendElement(gLocalInboxFolder.GetMessageHeader(gLastKey), false);</span>
<a href="#l34.30"></a><span id="l34.30" class="difflineplus">+    gMessages.appendElement(localAccountUtils.inboxFolder.GetMessageHeader(gLastKey),</span>
<a href="#l34.31"></a><span id="l34.31" class="difflineplus">+                            false);</span>
<a href="#l34.32"></a><span id="l34.32">     let folder1 = gIMAPInbox.getChildNamed(&quot;empty 1&quot;);</span>
<a href="#l34.33"></a><span id="l34.33" class="difflineminus">-    gCopyService.CopyMessages(gLocalInboxFolder, gMessages, folder1, false, CopyListener, null, false);</span>
<a href="#l34.34"></a><span id="l34.34" class="difflineplus">+    gCopyService.CopyMessages(localAccountUtils.inboxFolder, gMessages, folder1, false,</span>
<a href="#l34.35"></a><span id="l34.35" class="difflineplus">+                              CopyListener, null, false);</span>
<a href="#l34.36"></a><span id="l34.36">     yield false;</span>
<a href="#l34.37"></a><span id="l34.37">   },</span>
<a href="#l34.38"></a><span id="l34.38">   function moveMessages() {</span>
<a href="#l34.39"></a><span id="l34.39">     let folder2 = gIMAPInbox.getChildNamed(&quot;empty 2&quot;);</span>
<a href="#l34.40"></a><span id="l34.40" class="difflineminus">-    gCopyService.CopyMessages(gLocalInboxFolder, gMessages, folder2, true, CopyListener, null, false);</span>
<a href="#l34.41"></a><span id="l34.41" class="difflineplus">+      gCopyService.CopyMessages(localAccountUtils.inboxFolder, gMessages, folder2, true,</span>
<a href="#l34.42"></a><span id="l34.42" class="difflineplus">+                                CopyListener, null, false);</span>
<a href="#l34.43"></a><span id="l34.43">     yield false;</span>
<a href="#l34.44"></a><span id="l34.44">   },</span>
<a href="#l34.45"></a><span id="l34.45">   function update1() {</span>
<a href="#l34.46"></a><span id="l34.46">     let folder1 = gIMAPInbox.getChildNamed(&quot;empty 1&quot;).QueryInterface(Ci.nsIMsgImapMailFolder);</span>
<a href="#l34.47"></a><span id="l34.47">     folder1.updateFolderWithListener(null, asyncUrlListener);</span>
<a href="#l34.48"></a><span id="l34.48">     yield false;</span>
<a href="#l34.49"></a><span id="l34.49">   },</span>
<a href="#l34.50"></a><span id="l34.50">   function update2() {</span>
<a href="#l34.51"></a><span id="l34.51" class="difflineat">@@ -78,17 +82,17 @@ var tests = [</span>
<a href="#l34.52"></a><span id="l34.52">     do_check_eq(folderCount(folder1), 2);</span>
<a href="#l34.53"></a><span id="l34.53">     let folder2 = gIMAPInbox.getChildNamed(&quot;empty 2&quot;);</span>
<a href="#l34.54"></a><span id="l34.54">     do_check_neq(folder2, null);</span>
<a href="#l34.55"></a><span id="l34.55">     // folder 1 and 2 should each now have two messages in them.</span>
<a href="#l34.56"></a><span id="l34.56">     do_check_neq(folder1, null);</span>
<a href="#l34.57"></a><span id="l34.57">     do_check_eq(folderCount(folder2), 2);</span>
<a href="#l34.58"></a><span id="l34.58">     // The local inbox folder should now be empty, since the second</span>
<a href="#l34.59"></a><span id="l34.59">     // operation was a move.</span>
<a href="#l34.60"></a><span id="l34.60" class="difflineminus">-    do_check_eq(folderCount(gLocalInboxFolder), 0);</span>
<a href="#l34.61"></a><span id="l34.61" class="difflineplus">+    do_check_eq(folderCount(localAccountUtils.inboxFolder), 0);</span>
<a href="#l34.62"></a><span id="l34.62">   },</span>
<a href="#l34.63"></a><span id="l34.63">   teardown</span>
<a href="#l34.64"></a><span id="l34.64"> ];</span>
<a href="#l34.65"></a><span id="l34.65"> </span>
<a href="#l34.66"></a><span id="l34.66"> function folderCount(folder)</span>
<a href="#l34.67"></a><span id="l34.67"> {</span>
<a href="#l34.68"></a><span id="l34.68">   let enumerator = folder.msgDatabase.EnumerateMessages();</span>
<a href="#l34.69"></a><span id="l34.69">   let count = 0;</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l35.1"></a><span id="l35.1" class="difflineminus">--- a/mailnews/imap/test/unit/test_imapFilterActions.js</span>
<a href="#l35.2"></a><span id="l35.2" class="difflineplus">+++ b/mailnews/imap/test/unit/test_imapFilterActions.js</span>
<a href="#l35.3"></a><span id="l35.3" class="difflineat">@@ -324,17 +324,17 @@ const gTestArray =</span>
<a href="#l35.4"></a><span id="l35.4"> function run_test()</span>
<a href="#l35.5"></a><span id="l35.5"> {</span>
<a href="#l35.6"></a><span id="l35.6">   // Add a listener.</span>
<a href="#l35.7"></a><span id="l35.7">   gIMAPDaemon = new imapDaemon();</span>
<a href="#l35.8"></a><span id="l35.8">   gServer = makeServer(gIMAPDaemon, &quot;&quot;);</span>
<a href="#l35.9"></a><span id="l35.9"> </span>
<a href="#l35.10"></a><span id="l35.10">   gIMAPIncomingServer = createLocalIMAPServer();</span>
<a href="#l35.11"></a><span id="l35.11"> </span>
<a href="#l35.12"></a><span id="l35.12" class="difflineminus">-  if (!gLocalInboxFolder)</span>
<a href="#l35.13"></a><span id="l35.13" class="difflineplus">+  if (!localAccountUtils.inboxFolder)</span>
<a href="#l35.14"></a><span id="l35.14">     localAccountUtils.loadLocalMailAccount();</span>
<a href="#l35.15"></a><span id="l35.15"> </span>
<a href="#l35.16"></a><span id="l35.16">   // We need an identity so that updateFolder doesn't fail</span>
<a href="#l35.17"></a><span id="l35.17">   let localAccount = MailServices.accounts.createAccount();</span>
<a href="#l35.18"></a><span id="l35.18">   let identity = MailServices.accounts.createIdentity();</span>
<a href="#l35.19"></a><span id="l35.19">   localAccount.addIdentity(identity);</span>
<a href="#l35.20"></a><span id="l35.20">   localAccount.defaultIdentity = identity;</span>
<a href="#l35.21"></a><span id="l35.21">   localAccount.incomingServer = localAccountUtils.incomingServer;</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l36.1"></a><span id="l36.1" class="difflineminus">--- a/mailnews/imap/test/unit/test_localToImapFilter.js</span>
<a href="#l36.2"></a><span id="l36.2" class="difflineplus">+++ b/mailnews/imap/test/unit/test_localToImapFilter.js</span>
<a href="#l36.3"></a><span id="l36.3" class="difflineat">@@ -73,25 +73,25 @@ var tests = [</span>
<a href="#l36.4"></a><span id="l36.4">     folder2.updateFolderWithListener(null, asyncUrlListener);</span>
<a href="#l36.5"></a><span id="l36.5">     yield false;</span>
<a href="#l36.6"></a><span id="l36.6">   },</span>
<a href="#l36.7"></a><span id="l36.7">   function verifyFolders() {</span>
<a href="#l36.8"></a><span id="l36.8">     let folder1 = gIMAPInbox.getChildNamed(&quot;empty 1&quot;);</span>
<a href="#l36.9"></a><span id="l36.9">     listMessages(folder1);</span>
<a href="#l36.10"></a><span id="l36.10">     let folder2 = gIMAPInbox.getChildNamed(&quot;empty 2&quot;);</span>
<a href="#l36.11"></a><span id="l36.11">     listMessages(folder2);</span>
<a href="#l36.12"></a><span id="l36.12" class="difflineminus">-    listMessages(gLocalInboxFolder);</span>
<a href="#l36.13"></a><span id="l36.13" class="difflineplus">+    listMessages(localAccountUtils.inboxFolder);</span>
<a href="#l36.14"></a><span id="l36.14">     do_check_neq(folder1, null);</span>
<a href="#l36.15"></a><span id="l36.15">     do_check_neq(folder2, null);</span>
<a href="#l36.16"></a><span id="l36.16">     // folder 1 and 2 should each now have 2 messages in them.</span>
<a href="#l36.17"></a><span id="l36.17">     do_check_eq(folderCount(folder1), 2);</span>
<a href="#l36.18"></a><span id="l36.18">     do_check_eq(folderCount(folder2), 2);</span>
<a href="#l36.19"></a><span id="l36.19">     // the local inbox folder should now be empty, since the second</span>
<a href="#l36.20"></a><span id="l36.20">     // operation was a move</span>
<a href="#l36.21"></a><span id="l36.21" class="difflineminus">-    do_check_eq(folderCount(gLocalInboxFolder), 0);</span>
<a href="#l36.22"></a><span id="l36.22" class="difflineplus">+    do_check_eq(folderCount(localAccountUtils.inboxFolder), 0);</span>
<a href="#l36.23"></a><span id="l36.23">   },</span>
<a href="#l36.24"></a><span id="l36.24">   teardown</span>
<a href="#l36.25"></a><span id="l36.25"> ];</span>
<a href="#l36.26"></a><span id="l36.26"> </span>
<a href="#l36.27"></a><span id="l36.27"> function folderCount(folder)</span>
<a href="#l36.28"></a><span id="l36.28"> {</span>
<a href="#l36.29"></a><span id="l36.29">   let enumerator = folder.msgDatabase.EnumerateMessages();</span>
<a href="#l36.30"></a><span id="l36.30">   let count = 0;</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l37.1"></a><span id="l37.1" class="difflineminus">--- a/mailnews/imap/test/unit/test_localToImapFilterQuarantine.js</span>
<a href="#l37.2"></a><span id="l37.2" class="difflineplus">+++ b/mailnews/imap/test/unit/test_localToImapFilterQuarantine.js</span>
<a href="#l37.3"></a><span id="l37.3" class="difflineat">@@ -99,19 +99,19 @@ function updateSubfolderAndTest() {</span>
<a href="#l37.4"></a><span id="l37.4">   yield false;</span>
<a href="#l37.5"></a><span id="l37.5"> </span>
<a href="#l37.6"></a><span id="l37.6">   // kill some time</span>
<a href="#l37.7"></a><span id="l37.7">   do_timeout(200, async_driver);</span>
<a href="#l37.8"></a><span id="l37.8">   yield false;</span>
<a href="#l37.9"></a><span id="l37.9"> </span>
<a href="#l37.10"></a><span id="l37.10">   // test</span>
<a href="#l37.11"></a><span id="l37.11">   listMessages(gSubfolder);</span>
<a href="#l37.12"></a><span id="l37.12" class="difflineminus">-  listMessages(gLocalInboxFolder);</span>
<a href="#l37.13"></a><span id="l37.13" class="difflineplus">+  listMessages(localAccountUtils.inboxFolder);</span>
<a href="#l37.14"></a><span id="l37.14">   do_check_eq(folderCount(gSubfolder), 1);</span>
<a href="#l37.15"></a><span id="l37.15" class="difflineminus">-  do_check_eq(folderCount(gLocalInboxFolder), 1);</span>
<a href="#l37.16"></a><span id="l37.16" class="difflineplus">+  do_check_eq(folderCount(localAccountUtils.inboxFolder), 1);</span>
<a href="#l37.17"></a><span id="l37.17"> }</span>
<a href="#l37.18"></a><span id="l37.18"> </span>
<a href="#l37.19"></a><span id="l37.19"> function get2Messages()</span>
<a href="#l37.20"></a><span id="l37.20"> {</span>
<a href="#l37.21"></a><span id="l37.21">   gPOP3Pump.files = [&quot;../../../data/bugmail10&quot;,</span>
<a href="#l37.22"></a><span id="l37.22">                      &quot;../../../data/draft1&quot;];</span>
<a href="#l37.23"></a><span id="l37.23">   gPOP3Pump.onDone = function() {dump('POP3Pump done\n');async_driver();};</span>
<a href="#l37.24"></a><span id="l37.24">   gPOP3Pump.run();</span>
<a href="#l37.25"></a><span id="l37.25" class="difflineat">@@ -132,19 +132,19 @@ function updateSubfolderAndTest2() {</span>
<a href="#l37.26"></a><span id="l37.26">   yield false;</span>
<a href="#l37.27"></a><span id="l37.27"> </span>
<a href="#l37.28"></a><span id="l37.28">   // kill some time</span>
<a href="#l37.29"></a><span id="l37.29">   do_timeout(1000, async_driver);</span>
<a href="#l37.30"></a><span id="l37.30">   yield false;</span>
<a href="#l37.31"></a><span id="l37.31"> </span>
<a href="#l37.32"></a><span id="l37.32">   //test</span>
<a href="#l37.33"></a><span id="l37.33">   listMessages(gSubfolder);</span>
<a href="#l37.34"></a><span id="l37.34" class="difflineminus">-  listMessages(gLocalInboxFolder);</span>
<a href="#l37.35"></a><span id="l37.35" class="difflineplus">+  listMessages(localAccountUtils.inboxFolder);</span>
<a href="#l37.36"></a><span id="l37.36">   do_check_eq(folderCount(gSubfolder), 3);</span>
<a href="#l37.37"></a><span id="l37.37" class="difflineminus">-  do_check_eq(folderCount(gLocalInboxFolder), 3);</span>
<a href="#l37.38"></a><span id="l37.38" class="difflineplus">+  do_check_eq(folderCount(localAccountUtils.inboxFolder), 3);</span>
<a href="#l37.39"></a><span id="l37.39"> }</span>
<a href="#l37.40"></a><span id="l37.40"> </span>
<a href="#l37.41"></a><span id="l37.41"> function endTest()</span>
<a href="#l37.42"></a><span id="l37.42"> {</span>
<a href="#l37.43"></a><span id="l37.43">   // Cleanup, null out everything, close all cached connections and stop the</span>
<a href="#l37.44"></a><span id="l37.44">   // server</span>
<a href="#l37.45"></a><span id="l37.45">   dl(&quot;Exiting mail tests&quot;);</span>
<a href="#l37.46"></a><span id="l37.46">   gPOP3Pump = null;</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l38.1"></a><span id="l38.1" class="difflineminus">--- a/mailnews/imap/test/unit/test_offlineStoreLocking.js</span>
<a href="#l38.2"></a><span id="l38.2" class="difflineplus">+++ b/mailnews/imap/test/unit/test_offlineStoreLocking.js</span>
<a href="#l38.3"></a><span id="l38.3" class="difflineat">@@ -185,17 +185,17 @@ function setup() {</span>
<a href="#l38.4"></a><span id="l38.4"> // nsIMsgCopyServiceListener implementation - runs next test when copy</span>
<a href="#l38.5"></a><span id="l38.5"> // is completed.</span>
<a href="#l38.6"></a><span id="l38.6"> var CopyListener = </span>
<a href="#l38.7"></a><span id="l38.7"> {</span>
<a href="#l38.8"></a><span id="l38.8">   OnStartCopy: function() {},</span>
<a href="#l38.9"></a><span id="l38.9">   OnProgress: function(aProgress, aProgressMax) {},</span>
<a href="#l38.10"></a><span id="l38.10">   SetMessageKey: function(aKey)</span>
<a href="#l38.11"></a><span id="l38.11">   {</span>
<a href="#l38.12"></a><span id="l38.12" class="difflineminus">-    let hdr = gLocalInboxFolder.GetMessageHeader(aKey);</span>
<a href="#l38.13"></a><span id="l38.13" class="difflineplus">+    let hdr = localAccountUtils.inboxFolder.GetMessageHeader(aKey);</span>
<a href="#l38.14"></a><span id="l38.14">     gMsgHdrs.push({hdr: hdr, ID: hdr.messageId});</span>
<a href="#l38.15"></a><span id="l38.15">   },</span>
<a href="#l38.16"></a><span id="l38.16">   SetMessageId: function(aMessageId) {},</span>
<a href="#l38.17"></a><span id="l38.17">   OnStopCopy: function(aStatus)</span>
<a href="#l38.18"></a><span id="l38.18">   {</span>
<a href="#l38.19"></a><span id="l38.19">     // Check: message successfully copied.</span>
<a href="#l38.20"></a><span id="l38.20">     do_check_eq(aStatus, 0);</span>
<a href="#l38.21"></a><span id="l38.21">     async_driver();</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l39.1"></a><span id="l39.1" class="difflineminus">--- a/mailnews/imap/test/unit/test_stopMovingToLocalFolder.js</span>
<a href="#l39.2"></a><span id="l39.2" class="difflineplus">+++ b/mailnews/imap/test/unit/test_stopMovingToLocalFolder.js</span>
<a href="#l39.3"></a><span id="l39.3" class="difflineat">@@ -55,24 +55,24 @@ function setup_messages() {</span>
<a href="#l39.4"></a><span id="l39.4">   gIMAPInbox.updateFolderWithListener(null, asyncUrlListener);</span>
<a href="#l39.5"></a><span id="l39.5">   yield false;</span>
<a href="#l39.6"></a><span id="l39.6"> }</span>
<a href="#l39.7"></a><span id="l39.7"> </span>
<a href="#l39.8"></a><span id="l39.8"> function move_messages() {</span>
<a href="#l39.9"></a><span id="l39.9">   let messages = Cc[&quot;@mozilla.org/array;1&quot;].createInstance(Ci.nsIMutableArray);</span>
<a href="#l39.10"></a><span id="l39.10">   let msg = gIMAPInbox.msgDatabase.GetMsgHdrForKey(gIMAPMailbox.uidnext - 1);</span>
<a href="#l39.11"></a><span id="l39.11">   messages.appendElement(msg, false);</span>
<a href="#l39.12"></a><span id="l39.12" class="difflineminus">-  MailServices.copy.CopyMessages(gIMAPInbox, messages, gLocalInboxFolder,</span>
<a href="#l39.13"></a><span id="l39.13" class="difflineplus">+  MailServices.copy.CopyMessages(gIMAPInbox, messages, localAccountUtils.inboxFolder,</span>
<a href="#l39.14"></a><span id="l39.14">                                  true, asyncCopyListener, null, false);</span>
<a href="#l39.15"></a><span id="l39.15">   yield false;</span>
<a href="#l39.16"></a><span id="l39.16"> }</span>
<a href="#l39.17"></a><span id="l39.17"> </span>
<a href="#l39.18"></a><span id="l39.18"> function check_messages() {</span>
<a href="#l39.19"></a><span id="l39.19">   do_check_eq(gIMAPInbox.getTotalMessages(false), 1);</span>
<a href="#l39.20"></a><span id="l39.20" class="difflineminus">-  do_check_eq(gLocalInboxFolder.getTotalMessages(false), 0);</span>
<a href="#l39.21"></a><span id="l39.21" class="difflineplus">+  do_check_eq(localAccountUtils.inboxFolder.getTotalMessages(false), 0);</span>
<a href="#l39.22"></a><span id="l39.22">   yield true;</span>
<a href="#l39.23"></a><span id="l39.23"> }</span>
<a href="#l39.24"></a><span id="l39.24"> </span>
<a href="#l39.25"></a><span id="l39.25"> function run_test() {</span>
<a href="#l39.26"></a><span id="l39.26">   do_register_cleanup(function() {</span>
<a href="#l39.27"></a><span id="l39.27">     // gIMAPServer.performTest() brings this test to a halt,</span>
<a href="#l39.28"></a><span id="l39.28">     // so we need teardownIMAPPump() without gIMAPServer.performTest().</span>
<a href="#l39.29"></a><span id="l39.29">     gIMAPInbox = null;</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l40.1"></a><span id="l40.1" class="difflineminus">--- a/mailnews/local/test/unit/head_maillocal.js</span>
<a href="#l40.2"></a><span id="l40.2" class="difflineplus">+++ b/mailnews/local/test/unit/head_maillocal.js</span>
<a href="#l40.3"></a><span id="l40.3" class="difflineat">@@ -93,17 +93,17 @@ function copyFileMessageInLocalFolder(aM</span>
<a href="#l40.4"></a><span id="l40.4">                                       aMessageWindow,</span>
<a href="#l40.5"></a><span id="l40.5">                                       aCallback) {</span>
<a href="#l40.6"></a><span id="l40.6">   // Set up local folders</span>
<a href="#l40.7"></a><span id="l40.7">   localAccountUtils.loadLocalMailAccount();</span>
<a href="#l40.8"></a><span id="l40.8"> </span>
<a href="#l40.9"></a><span id="l40.9">   gCopyListener.callbackFunction = aCallback;</span>
<a href="#l40.10"></a><span id="l40.10">   // Copy a message into the local folder</span>
<a href="#l40.11"></a><span id="l40.11">   MailServices.copy.CopyFileMessage(aMessageFile,</span>
<a href="#l40.12"></a><span id="l40.12" class="difflineminus">-                                    gLocalInboxFolder,</span>
<a href="#l40.13"></a><span id="l40.13" class="difflineplus">+                                    localAccountUtils.inboxFolder,</span>
<a href="#l40.14"></a><span id="l40.14">                                     null, false,</span>
<a href="#l40.15"></a><span id="l40.15">                                     aMessageFlags,</span>
<a href="#l40.16"></a><span id="l40.16">                                     aMessageKeywords,</span>
<a href="#l40.17"></a><span id="l40.17">                                     gCopyListener,</span>
<a href="#l40.18"></a><span id="l40.18">                                     aMessageWindow);</span>
<a href="#l40.19"></a><span id="l40.19"> }</span>
<a href="#l40.20"></a><span id="l40.20"> </span>
<a href="#l40.21"></a><span id="l40.21"> function do_check_transaction(real, expected) {</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l41.1"></a><span id="l41.1" class="difflineminus">--- a/mailnews/local/test/unit/test_bug457168.js</span>
<a href="#l41.2"></a><span id="l41.2" class="difflineplus">+++ b/mailnews/local/test/unit/test_bug457168.js</span>
<a href="#l41.3"></a><span id="l41.3" class="difflineat">@@ -24,18 +24,18 @@ var urlListener =</span>
<a href="#l41.4"></a><span id="l41.4">   OnStartRunningUrl: function (url) {</span>
<a href="#l41.5"></a><span id="l41.5">   },</span>
<a href="#l41.6"></a><span id="l41.6">   OnStopRunningUrl: function (url, result) {</span>
<a href="#l41.7"></a><span id="l41.7">     try {</span>
<a href="#l41.8"></a><span id="l41.8">       var transaction = server.playTransaction();</span>
<a href="#l41.9"></a><span id="l41.9"> </span>
<a href="#l41.10"></a><span id="l41.10">       do_check_transaction(transaction, thisTest.transaction);</span>
<a href="#l41.11"></a><span id="l41.11"> </span>
<a href="#l41.12"></a><span id="l41.12" class="difflineminus">-      do_check_eq(gLocalInboxFolder.getTotalMessages(false), 2);</span>
<a href="#l41.13"></a><span id="l41.13" class="difflineminus">-      do_check_eq(gLocalInboxFolder.getNumUnread(false), 1);</span>
<a href="#l41.14"></a><span id="l41.14" class="difflineplus">+      do_check_eq(localAccountUtils.inboxFolder.getTotalMessages(false), 2);</span>
<a href="#l41.15"></a><span id="l41.15" class="difflineplus">+      do_check_eq(localAccountUtils.inboxFolder.getNumUnread(false), 1);</span>
<a href="#l41.16"></a><span id="l41.16"> </span>
<a href="#l41.17"></a><span id="l41.17">       do_check_eq(result, 0);</span>
<a href="#l41.18"></a><span id="l41.18">     }</span>
<a href="#l41.19"></a><span id="l41.19">     catch (e) {</span>
<a href="#l41.20"></a><span id="l41.20">       // If we have an error, clean up nicely before we throw it.</span>
<a href="#l41.21"></a><span id="l41.21">       server.stop();</span>
<a href="#l41.22"></a><span id="l41.22"> </span>
<a href="#l41.23"></a><span id="l41.23">       var thread = gThreadManager.currentThread;</span>
<a href="#l41.24"></a><span id="l41.24" class="difflineat">@@ -92,17 +92,17 @@ function testNext() {</span>
<a href="#l41.25"></a><span id="l41.25">       server.resetTest();</span>
<a href="#l41.26"></a><span id="l41.26"> </span>
<a href="#l41.27"></a><span id="l41.27">     // Set up the test</span>
<a href="#l41.28"></a><span id="l41.28">     test = thisTest.title;</span>
<a href="#l41.29"></a><span id="l41.29"> </span>
<a href="#l41.30"></a><span id="l41.30">     daemon.setMessages(thisTest.messages);</span>
<a href="#l41.31"></a><span id="l41.31"> </span>
<a href="#l41.32"></a><span id="l41.32">     // Now get the mail</span>
<a href="#l41.33"></a><span id="l41.33" class="difflineminus">-    MailServices.pop3.GetNewMail(null, urlListener, gLocalInboxFolder,</span>
<a href="#l41.34"></a><span id="l41.34" class="difflineplus">+    MailServices.pop3.GetNewMail(null, urlListener, localAccountUtils.inboxFolder,</span>
<a href="#l41.35"></a><span id="l41.35">                                  incomingServer);</span>
<a href="#l41.36"></a><span id="l41.36"> </span>
<a href="#l41.37"></a><span id="l41.37">     server.performTest();</span>
<a href="#l41.38"></a><span id="l41.38">   } catch (e) {</span>
<a href="#l41.39"></a><span id="l41.39">     server.stop();</span>
<a href="#l41.40"></a><span id="l41.40"> </span>
<a href="#l41.41"></a><span id="l41.41">     do_throw(e);</span>
<a href="#l41.42"></a><span id="l41.42">   } finally {</span>
<a href="#l41.43"></a><span id="l41.43" class="difflineat">@@ -148,14 +148,14 @@ function run_test() {</span>
<a href="#l41.44"></a><span id="l41.44">   filter.enabled = true;</span>
<a href="#l41.45"></a><span id="l41.45"> </span>
<a href="#l41.46"></a><span id="l41.46">   filters.insertFilterAt(0, filter);</span>
<a href="#l41.47"></a><span id="l41.47"> </span>
<a href="#l41.48"></a><span id="l41.48">   incomingServer.setFilterList(filters);</span>
<a href="#l41.49"></a><span id="l41.49"> </span>
<a href="#l41.50"></a><span id="l41.50">   // Check that we haven't got any messages in the folder, if we have its a test</span>
<a href="#l41.51"></a><span id="l41.51">   // setup issue.</span>
<a href="#l41.52"></a><span id="l41.52" class="difflineminus">-  do_check_eq(gLocalInboxFolder.getTotalMessages(false), 0);</span>
<a href="#l41.53"></a><span id="l41.53" class="difflineplus">+  do_check_eq(localAccountUtils.inboxFolder.getTotalMessages(false), 0);</span>
<a href="#l41.54"></a><span id="l41.54"> </span>
<a href="#l41.55"></a><span id="l41.55">   do_test_pending();</span>
<a href="#l41.56"></a><span id="l41.56"> </span>
<a href="#l41.57"></a><span id="l41.57">   testNext();</span>
<a href="#l41.58"></a><span id="l41.58"> }</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l42.1"></a><span id="l42.1" class="difflineminus">--- a/mailnews/local/test/unit/test_fileName.js</span>
<a href="#l42.2"></a><span id="l42.2" class="difflineplus">+++ b/mailnews/local/test/unit/test_fileName.js</span>
<a href="#l42.3"></a><span id="l42.3" class="difflineat">@@ -57,18 +57,18 @@ function run_test() {</span>
<a href="#l42.4"></a><span id="l42.4"> </span>
<a href="#l42.5"></a><span id="l42.5">   let pop3Server = MailServices.accounts.FindServer(&quot;user&quot;, &quot;poptest&quot;, &quot;pop3&quot;);</span>
<a href="#l42.6"></a><span id="l42.6">   var rootFolder = localAccountUtils.incomingServer.rootMsgFolder</span>
<a href="#l42.7"></a><span id="l42.7">     .QueryInterface(Ci.nsIMsgLocalMailFolder);</span>
<a href="#l42.8"></a><span id="l42.8">   let pop3Root = pop3Server.rootMsgFolder;</span>
<a href="#l42.9"></a><span id="l42.9">   </span>
<a href="#l42.10"></a><span id="l42.10">   // Note: Inbox is not created automatically when there is no deferred server,</span>
<a href="#l42.11"></a><span id="l42.11">   // so we need to create it.</span>
<a href="#l42.12"></a><span id="l42.12" class="difflineminus">-  gLocalInboxFolder = rootFolder.createLocalSubfolder(&quot;Inbox&quot;);</span>
<a href="#l42.13"></a><span id="l42.13" class="difflineplus">+  localAccountUtils.inboxFolder = rootFolder.createLocalSubfolder(&quot;Inbox&quot;);</span>
<a href="#l42.14"></a><span id="l42.14">   // a local inbox should have a Mail flag!</span>
<a href="#l42.15"></a><span id="l42.15" class="difflineminus">-  gLocalInboxFolder.setFlag(Ci.nsMsgFolderFlags.Mail);</span>
<a href="#l42.16"></a><span id="l42.16" class="difflineplus">+  localAccountUtils.inboxFolder.setFlag(Ci.nsMsgFolderFlags.Mail);</span>
<a href="#l42.17"></a><span id="l42.17">   </span>
<a href="#l42.18"></a><span id="l42.18">   let rootFolder = localAccountUtils.incomingServer.rootMsgFolder;</span>
<a href="#l42.19"></a><span id="l42.19">   let bugmail = rootFolder.getChildNamed(&quot;bugmail:1&quot;);</span>
<a href="#l42.20"></a><span id="l42.20">   do_check_eq(bugmail.getTotalMessages(false), 1);</span>
<a href="#l42.21"></a><span id="l42.21">   bugmail = pop3Root.getChildNamed(&quot;bugmail:1&quot;);</span>
<a href="#l42.22"></a><span id="l42.22">   do_check_eq(bugmail.getTotalMessages(false), 1);</span>
<a href="#l42.23"></a><span id="l42.23"> }</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l43.1"></a><span id="l43.1" class="difflineminus">--- a/mailnews/local/test/unit/test_folderLoaded.js</span>
<a href="#l43.2"></a><span id="l43.2" class="difflineplus">+++ b/mailnews/local/test/unit/test_folderLoaded.js</span>
<a href="#l43.3"></a><span id="l43.3" class="difflineat">@@ -24,17 +24,17 @@ var gTargetFolder = null;</span>
<a href="#l43.4"></a><span id="l43.4"> var tests = [</span>
<a href="#l43.5"></a><span id="l43.5">   function setup()</span>
<a href="#l43.6"></a><span id="l43.6">   {</span>
<a href="#l43.7"></a><span id="l43.7">     do_timeout(5000, function() {</span>
<a href="#l43.8"></a><span id="l43.8">       // should be done by now</span>
<a href="#l43.9"></a><span id="l43.9">       do_check_true(false);</span>
<a href="#l43.10"></a><span id="l43.10">     });</span>
<a href="#l43.11"></a><span id="l43.11">  </span>
<a href="#l43.12"></a><span id="l43.12" class="difflineminus">-    if (typeof gLocalInboxFolder == 'undefined')</span>
<a href="#l43.13"></a><span id="l43.13" class="difflineplus">+    if (typeof localAccountUtils.inboxFolder == 'undefined')</span>
<a href="#l43.14"></a><span id="l43.14">       localAccountUtils.loadLocalMailAccount();</span>
<a href="#l43.15"></a><span id="l43.15">     localAccountUtils.rootFolder.createSubfolder(&quot;target&quot;, null);</span>
<a href="#l43.16"></a><span id="l43.16">     gTargetFolder = localAccountUtils.rootFolder.getChildNamed(&quot;target&quot;);</span>
<a href="#l43.17"></a><span id="l43.17"> </span>
<a href="#l43.18"></a><span id="l43.18">     MailServices.copy.CopyFileMessage(gMsgFile1, gTargetFolder, null, false, 0,</span>
<a href="#l43.19"></a><span id="l43.19">                                       &quot;&quot;, asyncCopyListener, null);</span>
<a href="#l43.20"></a><span id="l43.20">     yield false;</span>
<a href="#l43.21"></a><span id="l43.21"> </span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l44.1"></a><span id="l44.1" class="difflineminus">--- a/mailnews/local/test/unit/test_mailboxContentLength.js</span>
<a href="#l44.2"></a><span id="l44.2" class="difflineplus">+++ b/mailnews/local/test/unit/test_mailboxContentLength.js</span>
<a href="#l44.3"></a><span id="l44.3" class="difflineat">@@ -19,18 +19,18 @@ function run_test()</span>
<a href="#l44.4"></a><span id="l44.4">   do_test_pending();</span>
<a href="#l44.5"></a><span id="l44.5">   copyFileMessageInLocalFolder(gFile, 0, &quot;&quot;, null, verifyContentLength);</span>
<a href="#l44.6"></a><span id="l44.6"> }</span>
<a href="#l44.7"></a><span id="l44.7"> </span>
<a href="#l44.8"></a><span id="l44.8"> function verifyContentLength(aMessageHeaderKeys, aStatus)</span>
<a href="#l44.9"></a><span id="l44.9"> {</span>
<a href="#l44.10"></a><span id="l44.10">   do_check_neq(aMessageHeaderKeys, null);</span>
<a href="#l44.11"></a><span id="l44.11">   // First get the message URI</span>
<a href="#l44.12"></a><span id="l44.12" class="difflineminus">-  let msgHdr = gLocalInboxFolder.GetMessageHeader(aMessageHeaderKeys[0]);</span>
<a href="#l44.13"></a><span id="l44.13" class="difflineminus">-  let messageUri = gLocalInboxFolder.getUriForMsg(msgHdr);</span>
<a href="#l44.14"></a><span id="l44.14" class="difflineplus">+  let msgHdr = localAccountUtils.inboxFolder.GetMessageHeader(aMessageHeaderKeys[0]);</span>
<a href="#l44.15"></a><span id="l44.15" class="difflineplus">+  let messageUri = localAccountUtils.inboxFolder.getUriForMsg(msgHdr);</span>
<a href="#l44.16"></a><span id="l44.16">   // Convert this to a URI that necko can run</span>
<a href="#l44.17"></a><span id="l44.17">   let messenger = Cc[&quot;@mozilla.org/messenger;1&quot;].createInstance(Ci.nsIMessenger);</span>
<a href="#l44.18"></a><span id="l44.18">   let neckoURL = {};</span>
<a href="#l44.19"></a><span id="l44.19">   let messageService = messenger.messageServiceFromURI(messageUri);</span>
<a href="#l44.20"></a><span id="l44.20">   messageService.GetUrlForUri(messageUri, neckoURL, null);</span>
<a href="#l44.21"></a><span id="l44.21">   // Don't use the necko URL directly. Instead, get the spec and create a new</span>
<a href="#l44.22"></a><span id="l44.22">   // URL using the IO service</span>
<a href="#l44.23"></a><span id="l44.23">   let urlToRun = Services.io.newURI(neckoURL.value.spec, null, null);</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l45.1"></a><span id="l45.1" class="difflineminus">--- a/mailnews/local/test/unit/test_msgCopy.js</span>
<a href="#l45.2"></a><span id="l45.2" class="difflineplus">+++ b/mailnews/local/test/unit/test_msgCopy.js</span>
<a href="#l45.3"></a><span id="l45.3" class="difflineat">@@ -15,12 +15,12 @@ function run_test()</span>
<a href="#l45.4"></a><span id="l45.4"> {</span>
<a href="#l45.5"></a><span id="l45.5">   do_test_pending();</span>
<a href="#l45.6"></a><span id="l45.6">   copyFileMessageInLocalFolder(bugmail11, 0, tag1, null, test_keywords);</span>
<a href="#l45.7"></a><span id="l45.7"> }</span>
<a href="#l45.8"></a><span id="l45.8"> </span>
<a href="#l45.9"></a><span id="l45.9"> function test_keywords(aMessageHeaderKeys, aStatus) {</span>
<a href="#l45.10"></a><span id="l45.10">   let headerKeys = aMessageHeaderKeys;</span>
<a href="#l45.11"></a><span id="l45.11">   do_check_neq(headerKeys, null);</span>
<a href="#l45.12"></a><span id="l45.12" class="difflineminus">-  let copiedMessage = gLocalInboxFolder.GetMessageHeader(headerKeys[0]);</span>
<a href="#l45.13"></a><span id="l45.13" class="difflineplus">+  let copiedMessage = localAccountUtils.inboxFolder.GetMessageHeader(headerKeys[0]);</span>
<a href="#l45.14"></a><span id="l45.14">   do_check_eq(copiedMessage.getStringProperty(&quot;keywords&quot;), tag1);</span>
<a href="#l45.15"></a><span id="l45.15">   do_test_finished();</span>
<a href="#l45.16"></a><span id="l45.16"> }</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l46.1"></a><span id="l46.1" class="difflineminus">--- a/mailnews/local/test/unit/test_msgIDParsing.js</span>
<a href="#l46.2"></a><span id="l46.2" class="difflineplus">+++ b/mailnews/local/test/unit/test_msgIDParsing.js</span>
<a href="#l46.3"></a><span id="l46.3" class="difflineat">@@ -19,13 +19,13 @@ localAccount.defaultIdentity = identity;</span>
<a href="#l46.4"></a><span id="l46.4"> </span>
<a href="#l46.5"></a><span id="l46.5"> function run_test()</span>
<a href="#l46.6"></a><span id="l46.6"> {</span>
<a href="#l46.7"></a><span id="l46.7">   var headers = </span>
<a href="#l46.8"></a><span id="l46.8">     &quot;from: alice@t1.example.com\r\n&quot; + </span>
<a href="#l46.9"></a><span id="l46.9">     &quot;to: bob@t2.example.net\r\n&quot; + </span>
<a href="#l46.10"></a><span id="l46.10">     &quot;message-id:   \r\n   &lt;abcmessageid&gt;\r\n&quot;;</span>
<a href="#l46.11"></a><span id="l46.11"> </span>
<a href="#l46.12"></a><span id="l46.12" class="difflineminus">-  let localFolder = gLocalInboxFolder.QueryInterface(Ci.nsIMsgLocalMailFolder);</span>
<a href="#l46.13"></a><span id="l46.13" class="difflineminus">-  gLocalInboxFolder.addMessage(&quot;From \r\n&quot;+ headers + &quot;\r\nhello\r\n&quot;);</span>
<a href="#l46.14"></a><span id="l46.14" class="difflineminus">-  var msgHdr = gLocalInboxFolder.GetMessageHeader(0);</span>
<a href="#l46.15"></a><span id="l46.15" class="difflineplus">+  let localFolder = localAccountUtils.inboxFolder.QueryInterface(Ci.nsIMsgLocalMailFolder);</span>
<a href="#l46.16"></a><span id="l46.16" class="difflineplus">+  localAccountUtils.inboxFolder.addMessage(&quot;From \r\n&quot;+ headers + &quot;\r\nhello\r\n&quot;);</span>
<a href="#l46.17"></a><span id="l46.17" class="difflineplus">+  var msgHdr = localAccountUtils.inboxFolder.GetMessageHeader(0);</span>
<a href="#l46.18"></a><span id="l46.18">   do_check_eq(msgHdr.messageId, &quot;abcmessageid&quot;);</span>
<a href="#l46.19"></a><span id="l46.19"> }</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l47.1"></a><span id="l47.1" class="difflineminus">--- a/mailnews/local/test/unit/test_nsIMsgParseMailMsgState.js</span>
<a href="#l47.2"></a><span id="l47.2" class="difflineplus">+++ b/mailnews/local/test/unit/test_nsIMsgParseMailMsgState.js</span>
<a href="#l47.3"></a><span id="l47.3" class="difflineat">@@ -15,17 +15,17 @@ function run_test() {</span>
<a href="#l47.4"></a><span id="l47.4"> }</span>
<a href="#l47.5"></a><span id="l47.5"> </span>
<a href="#l47.6"></a><span id="l47.6"> function test_parse_headers_without_crash(eml) {</span>
<a href="#l47.7"></a><span id="l47.7">   let file = do_get_file(eml);</span>
<a href="#l47.8"></a><span id="l47.8"> </span>
<a href="#l47.9"></a><span id="l47.9">   let parser = Cc[&quot;@mozilla.org/messenger/messagestateparser;1&quot;]</span>
<a href="#l47.10"></a><span id="l47.10">                  .createInstance(Ci.nsIMsgParseMailMsgState);</span>
<a href="#l47.11"></a><span id="l47.11"> </span>
<a href="#l47.12"></a><span id="l47.12" class="difflineminus">-  parser.SetMailDB(gLocalInboxFolder.getDatabaseWOReparse());</span>
<a href="#l47.13"></a><span id="l47.13" class="difflineplus">+  parser.SetMailDB(localAccountUtils.inboxFolder.getDatabaseWOReparse());</span>
<a href="#l47.14"></a><span id="l47.14">   parser.state = Ci.nsIMsgParseMailMsgState.ParseHeadersState;</span>
<a href="#l47.15"></a><span id="l47.15"> </span>
<a href="#l47.16"></a><span id="l47.16">   let mailData = IOUtils.loadFileToString(file);</span>
<a href="#l47.17"></a><span id="l47.17">   let lines = mailData.split(MSG_LINEBREAK);</span>
<a href="#l47.18"></a><span id="l47.18"> </span>
<a href="#l47.19"></a><span id="l47.19">   for (let line = 0; line &lt; lines.length; line++) {</span>
<a href="#l47.20"></a><span id="l47.20">     parser.ParseAFolderLine(lines[line] + MSG_LINEBREAK, lines[line].length + 2);</span>
<a href="#l47.21"></a><span id="l47.21">   }</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l48.1"></a><span id="l48.1" class="difflineminus">--- a/mailnews/local/test/unit/test_over2GBMailboxes.js</span>
<a href="#l48.2"></a><span id="l48.2" class="difflineplus">+++ b/mailnews/local/test/unit/test_over2GBMailboxes.js</span>
<a href="#l48.3"></a><span id="l48.3" class="difflineat">@@ -14,17 +14,17 @@ var gLocalTrashFolder;</span>
<a href="#l48.4"></a><span id="l48.4"> function run_test()</span>
<a href="#l48.5"></a><span id="l48.5"> {</span>
<a href="#l48.6"></a><span id="l48.6">   localAccountUtils.loadLocalMailAccount();</span>
<a href="#l48.7"></a><span id="l48.7"> </span>
<a href="#l48.8"></a><span id="l48.8">   // &quot;Master&quot; do_test_pending(), paired with a do_test_finished() at the end of</span>
<a href="#l48.9"></a><span id="l48.9">   // all the operations.</span>
<a href="#l48.10"></a><span id="l48.10">   do_test_pending();</span>
<a href="#l48.11"></a><span id="l48.11"> </span>
<a href="#l48.12"></a><span id="l48.12" class="difflineminus">-  let inboxFile = gLocalInboxFolder.filePath;</span>
<a href="#l48.13"></a><span id="l48.13" class="difflineplus">+  let inboxFile = localAccountUtils.inboxFolder.filePath;</span>
<a href="#l48.14"></a><span id="l48.14"> </span>
<a href="#l48.15"></a><span id="l48.15">   let neededFreeSpace = 0x100000000;</span>
<a href="#l48.16"></a><span id="l48.16">   let freeDiskSpace = inboxFile.diskSpaceAvailable;</span>
<a href="#l48.17"></a><span id="l48.17">   do_print(&quot;Free disk space = &quot; + mailTestUtils.toMiBString(freeDiskSpace));</span>
<a href="#l48.18"></a><span id="l48.18">   if (freeDiskSpace &lt; neededFreeSpace) {</span>
<a href="#l48.19"></a><span id="l48.19">     do_print(&quot;This test needs &quot; + mailTestUtils.toMiBString(neededFreeSpace) +</span>
<a href="#l48.20"></a><span id="l48.20">              &quot; free space to run. Aborting.&quot;);</span>
<a href="#l48.21"></a><span id="l48.21">     todo_check_true(false);</span>
<a href="#l48.22"></a><span id="l48.22" class="difflineat">@@ -45,50 +45,51 @@ function run_test()</span>
<a href="#l48.23"></a><span id="l48.23">   outputStream.init(inboxFile, 0x02, -1, 0);</span>
<a href="#l48.24"></a><span id="l48.24">   // seek past 2GB.</span>
<a href="#l48.25"></a><span id="l48.25">   outputStream.seek(0, 0x80000010);</span>
<a href="#l48.26"></a><span id="l48.26">   // Write a &quot;space&quot; character.</span>
<a href="#l48.27"></a><span id="l48.27">   outputStream.write(&quot; &quot;, 1);</span>
<a href="#l48.28"></a><span id="l48.28">   outputStream.close();</span>
<a href="#l48.29"></a><span id="l48.29"> </span>
<a href="#l48.30"></a><span id="l48.30">   // Save initial file size.</span>
<a href="#l48.31"></a><span id="l48.31" class="difflineminus">-  gLocalInboxSize = gLocalInboxFolder.filePath.fileSize;</span>
<a href="#l48.32"></a><span id="l48.32" class="difflineplus">+  gLocalInboxSize = localAccountUtils.inboxFolder.filePath.fileSize;</span>
<a href="#l48.33"></a><span id="l48.33">   do_print(&quot;Local inbox size (before copyFileMessageInLocalFolder()) = &quot; +</span>
<a href="#l48.34"></a><span id="l48.34">            gLocalInboxSize);</span>
<a href="#l48.35"></a><span id="l48.35"> </span>
<a href="#l48.36"></a><span id="l48.36">   // Append mail data to over 2 GiB position for over 2 GiB msgkey.</span>
<a href="#l48.37"></a><span id="l48.37">   copyFileMessageInLocalFolder(bugmail10, 0, &quot;&quot;, null, copyMessages);</span>
<a href="#l48.38"></a><span id="l48.38"> }</span>
<a href="#l48.39"></a><span id="l48.39"> </span>
<a href="#l48.40"></a><span id="l48.40"> // Get message whose msg key is over 2 GiB.</span>
<a href="#l48.41"></a><span id="l48.41"> function getMessageHdr()</span>
<a href="#l48.42"></a><span id="l48.42"> {</span>
<a href="#l48.43"></a><span id="l48.43" class="difflineminus">-  let msgEnum = gLocalInboxFolder.msgDatabase.EnumerateMessages();</span>
<a href="#l48.44"></a><span id="l48.44" class="difflineplus">+  let msgEnum = localAccountUtils.inboxFolder.msgDatabase.EnumerateMessages();</span>
<a href="#l48.45"></a><span id="l48.45">   while (msgEnum.hasMoreElements()) {</span>
<a href="#l48.46"></a><span id="l48.46">     let header = msgEnum.getNext().QueryInterface(Ci.nsIMsgDBHdr);</span>
<a href="#l48.47"></a><span id="l48.47">     if (header.messageKey &gt;= 0x80000000) {</span>
<a href="#l48.48"></a><span id="l48.48">       return header;</span>
<a href="#l48.49"></a><span id="l48.49">     }</span>
<a href="#l48.50"></a><span id="l48.50">   }</span>
<a href="#l48.51"></a><span id="l48.51"> </span>
<a href="#l48.52"></a><span id="l48.52">   do_throw(&quot;Over 2 GiB msgkey was not found!&quot;);</span>
<a href="#l48.53"></a><span id="l48.53"> }</span>
<a href="#l48.54"></a><span id="l48.54"> </span>
<a href="#l48.55"></a><span id="l48.55"> function copyMessages()</span>
<a href="#l48.56"></a><span id="l48.56"> {</span>
<a href="#l48.57"></a><span id="l48.57">   // Make sure inbox file grew (i.e., we were not writing over data).</span>
<a href="#l48.58"></a><span id="l48.58" class="difflineminus">-  let localInboxSize = gLocalInboxFolder.filePath.fileSize;</span>
<a href="#l48.59"></a><span id="l48.59" class="difflineplus">+  let localInboxSize = localAccountUtils.inboxFolder.filePath.fileSize;</span>
<a href="#l48.60"></a><span id="l48.60">   do_print(&quot;Local inbox size (after copyFileMessageInLocalFolder()) = &quot; +</span>
<a href="#l48.61"></a><span id="l48.61">            localInboxSize);</span>
<a href="#l48.62"></a><span id="l48.62">   do_check_true(localInboxSize &gt; gLocalInboxSize);</span>
<a href="#l48.63"></a><span id="l48.63"> </span>
<a href="#l48.64"></a><span id="l48.64">   // Copy the message into the subfolder.</span>
<a href="#l48.65"></a><span id="l48.65">   let messages = Cc[&quot;@mozilla.org/array;1&quot;].createInstance(Ci.nsIMutableArray);</span>
<a href="#l48.66"></a><span id="l48.66">   messages.appendElement(getMessageHdr(), false);</span>
<a href="#l48.67"></a><span id="l48.67" class="difflineminus">-  MailServices.copy.CopyMessages(gLocalInboxFolder, messages, gLocalTrashFolder,</span>
<a href="#l48.68"></a><span id="l48.68" class="difflineplus">+  MailServices.copy.CopyMessages(localAccountUtils.inboxFolder, messages,</span>
<a href="#l48.69"></a><span id="l48.69" class="difflineplus">+                                 gLocalTrashFolder,</span>
<a href="#l48.70"></a><span id="l48.70">                                  false, copyListener2, null, false);</span>
<a href="#l48.71"></a><span id="l48.71"> }</span>
<a href="#l48.72"></a><span id="l48.72"> </span>
<a href="#l48.73"></a><span id="l48.73"> var copyListener2 = {</span>
<a href="#l48.74"></a><span id="l48.74">   OnStartCopy : function() {},</span>
<a href="#l48.75"></a><span id="l48.75">   OnProgress: function(aProgress, aProgressMax) {},</span>
<a href="#l48.76"></a><span id="l48.76">   SetMessageKey : function(aKey) {},</span>
<a href="#l48.77"></a><span id="l48.77">   OnStopCopy : function(aStatus) {</span>
<a href="#l48.78"></a><span id="l48.78" class="difflineat">@@ -135,12 +136,12 @@ gStreamListener = {</span>
<a href="#l48.79"></a><span id="l48.79">     }</span>
<a href="#l48.80"></a><span id="l48.80">     this._data += this._stream.read(aCount);</span>
<a href="#l48.81"></a><span id="l48.81">   },</span>
<a href="#l48.82"></a><span id="l48.82"> };</span>
<a href="#l48.83"></a><span id="l48.83"> </span>
<a href="#l48.84"></a><span id="l48.84"> function endTest() {</span>
<a href="#l48.85"></a><span id="l48.85">   // Free up disk space - if you want to look at the file after running</span>
<a href="#l48.86"></a><span id="l48.86">   // this test, comment out this line.</span>
<a href="#l48.87"></a><span id="l48.87" class="difflineminus">-  gLocalInboxFolder.filePath.remove(false);</span>
<a href="#l48.88"></a><span id="l48.88" class="difflineplus">+  localAccountUtils.inboxFolder.filePath.remove(false);</span>
<a href="#l48.89"></a><span id="l48.89"> </span>
<a href="#l48.90"></a><span id="l48.90">   do_test_finished();</span>
<a href="#l48.91"></a><span id="l48.91"> }</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l49.1"></a><span id="l49.1" class="difflineminus">--- a/mailnews/local/test/unit/test_over4GBMailboxes.js</span>
<a href="#l49.2"></a><span id="l49.2" class="difflineplus">+++ b/mailnews/local/test/unit/test_over4GBMailboxes.js</span>
<a href="#l49.3"></a><span id="l49.3" class="difflineat">@@ -52,30 +52,30 @@ function alert(aDialogTitle, aText) {</span>
<a href="#l49.4"></a><span id="l49.4">  * really take 4GiB and working with it is faster.</span>
<a href="#l49.5"></a><span id="l49.5">  */</span>
<a href="#l49.6"></a><span id="l49.6"> function growInbox(aWantedSize) {</span>
<a href="#l49.7"></a><span id="l49.7">   // Put a single message in the Inbox.</span>
<a href="#l49.8"></a><span id="l49.8">   let messageGenerator = new MessageGenerator();</span>
<a href="#l49.9"></a><span id="l49.9">   let message = messageGenerator.makeMessage();</span>
<a href="#l49.10"></a><span id="l49.10"> </span>
<a href="#l49.11"></a><span id="l49.11">   // Refresh 'gInboxFile'.</span>
<a href="#l49.12"></a><span id="l49.12" class="difflineminus">-  gInboxFile = gLocalInboxFolder.filePath;</span>
<a href="#l49.13"></a><span id="l49.13" class="difflineplus">+  gInboxFile = localAccountUtils.inboxFolder.filePath;</span>
<a href="#l49.14"></a><span id="l49.14"> </span>
<a href="#l49.15"></a><span id="l49.15">   let mboxString = message.toMboxString();</span>
<a href="#l49.16"></a><span id="l49.16" class="difflineminus">-  let plugStore = gLocalInboxFolder.msgStore;</span>
<a href="#l49.17"></a><span id="l49.17" class="difflineplus">+  let plugStore = localAccountUtils.inboxFolder.msgStore;</span>
<a href="#l49.18"></a><span id="l49.18">   // Grow local inbox to our wished size that is below the max limit.</span>
<a href="#l49.19"></a><span id="l49.19">   do {</span>
<a href="#l49.20"></a><span id="l49.20">     let nextOffset = gInboxFile.fileSize +</span>
<a href="#l49.21"></a><span id="l49.21">       Math.min(kSparseBlockSize + mboxString.length,</span>
<a href="#l49.22"></a><span id="l49.22">                aWantedSize - gInboxFile.fileSize) - 2;</span>
<a href="#l49.23"></a><span id="l49.23"> </span>
<a href="#l49.24"></a><span id="l49.24">     // Get stream to write a new message.</span>
<a href="#l49.25"></a><span id="l49.25">     let reusable = new Object;</span>
<a href="#l49.26"></a><span id="l49.26">     let newMsgHdr = new Object;</span>
<a href="#l49.27"></a><span id="l49.27" class="difflineminus">-    let outputStream = plugStore.getNewMsgOutputStream(gLocalInboxFolder,</span>
<a href="#l49.28"></a><span id="l49.28" class="difflineplus">+    let outputStream = plugStore.getNewMsgOutputStream(localAccountUtils.inboxFolder,</span>
<a href="#l49.29"></a><span id="l49.29">                                                        newMsgHdr, reusable)</span>
<a href="#l49.30"></a><span id="l49.30">                                 .QueryInterface(Ci.nsISeekableStream);</span>
<a href="#l49.31"></a><span id="l49.31">     // Write message header.</span>
<a href="#l49.32"></a><span id="l49.32">     outputStream.write(mboxString, mboxString.length);</span>
<a href="#l49.33"></a><span id="l49.33"> </span>
<a href="#l49.34"></a><span id="l49.34">     // &quot;Add&quot; a new (empty) sparse block at the end of the file.</span>
<a href="#l49.35"></a><span id="l49.35">     mailTestUtils.mark_file_region_sparse(gInboxFile,</span>
<a href="#l49.36"></a><span id="l49.36">       gInboxFile.fileSize + mboxString.length,</span>
<a href="#l49.37"></a><span id="l49.37" class="difflineat">@@ -84,33 +84,33 @@ function growInbox(aWantedSize) {</span>
<a href="#l49.38"></a><span id="l49.38">     // Skip to the wished end of the message.</span>
<a href="#l49.39"></a><span id="l49.39">     outputStream.seek(0, nextOffset);</span>
<a href="#l49.40"></a><span id="l49.40">     // Add a CR+LF to terminate the message.</span>
<a href="#l49.41"></a><span id="l49.41">     outputStream.write(&quot;\r\n&quot;, 2);</span>
<a href="#l49.42"></a><span id="l49.42">     outputStream.close();</span>
<a href="#l49.43"></a><span id="l49.43">     plugStore.finishNewMessage(outputStream, newMsgHdr);</span>
<a href="#l49.44"></a><span id="l49.44"> </span>
<a href="#l49.45"></a><span id="l49.45">     // Refresh 'gInboxFile'.</span>
<a href="#l49.46"></a><span id="l49.46" class="difflineminus">-    gInboxFile = gLocalInboxFolder.filePath;</span>
<a href="#l49.47"></a><span id="l49.47" class="difflineplus">+    gInboxFile = localAccountUtils.inboxFolder.filePath;</span>
<a href="#l49.48"></a><span id="l49.48">   }</span>
<a href="#l49.49"></a><span id="l49.49">   while (gInboxFile.fileSize &lt; aWantedSize);</span>
<a href="#l49.50"></a><span id="l49.50"> </span>
<a href="#l49.51"></a><span id="l49.51">   do_print(&quot;Local inbox size = &quot; + gInboxFile.fileSize + &quot;bytes = &quot; +</span>
<a href="#l49.52"></a><span id="l49.52">            gInboxFile.fileSize / 1024 / 1024 + &quot;MiB&quot;);</span>
<a href="#l49.53"></a><span id="l49.53"> }</span>
<a href="#l49.54"></a><span id="l49.54"> </span>
<a href="#l49.55"></a><span id="l49.55"> function run_test()</span>
<a href="#l49.56"></a><span id="l49.56"> {</span>
<a href="#l49.57"></a><span id="l49.57">   localAccountUtils.loadLocalMailAccount();</span>
<a href="#l49.58"></a><span id="l49.58"> </span>
<a href="#l49.59"></a><span id="l49.59">   // &quot;Master&quot; do_test_pending(), paired with a do_test_finished() at the end of</span>
<a href="#l49.60"></a><span id="l49.60">   // all the operations.</span>
<a href="#l49.61"></a><span id="l49.61">   do_test_pending();</span>
<a href="#l49.62"></a><span id="l49.62"> </span>
<a href="#l49.63"></a><span id="l49.63" class="difflineminus">-  gInboxFile = gLocalInboxFolder.filePath;</span>
<a href="#l49.64"></a><span id="l49.64" class="difflineplus">+  gInboxFile = localAccountUtils.inboxFolder.filePath;</span>
<a href="#l49.65"></a><span id="l49.65"> </span>
<a href="#l49.66"></a><span id="l49.66">   let neededFreeSpace = kSizeLimit + 0x10000000; // +256MiB</span>
<a href="#l49.67"></a><span id="l49.67">   // On Windows, check whether the drive is NTFS. If it is, mark the file as</span>
<a href="#l49.68"></a><span id="l49.68">   // sparse. If it isn't, then bail out now, because in all probability it is</span>
<a href="#l49.69"></a><span id="l49.69">   // FAT32, which doesn't support file sizes greater than 4 GiB.</span>
<a href="#l49.70"></a><span id="l49.70">   if (&quot;@mozilla.org/windows-registry-key;1&quot; in Cc &amp;&amp;</span>
<a href="#l49.71"></a><span id="l49.71">       mailTestUtils.get_file_system(gInboxFile) != &quot;NTFS&quot;)</span>
<a href="#l49.72"></a><span id="l49.72">   {</span>
<a href="#l49.73"></a><span id="l49.73" class="difflineat">@@ -131,20 +131,20 @@ function run_test()</span>
<a href="#l49.74"></a><span id="l49.74">     return;</span>
<a href="#l49.75"></a><span id="l49.75">   }</span>
<a href="#l49.76"></a><span id="l49.76"> </span>
<a href="#l49.77"></a><span id="l49.77">   // Grow inbox to size near the max limit.</span>
<a href="#l49.78"></a><span id="l49.78">   growInbox(kNearLimit);</span>
<a href="#l49.79"></a><span id="l49.79"> </span>
<a href="#l49.80"></a><span id="l49.80">   // Force the db closed, so that getDatabaseWithReparse will notice</span>
<a href="#l49.81"></a><span id="l49.81">   // that it's out of date.</span>
<a href="#l49.82"></a><span id="l49.82" class="difflineminus">-  gLocalInboxFolder.msgDatabase.ForceClosed();</span>
<a href="#l49.83"></a><span id="l49.83" class="difflineminus">-  gLocalInboxFolder.msgDatabase = null;</span>
<a href="#l49.84"></a><span id="l49.84" class="difflineplus">+  localAccountUtils.inboxFolder.msgDatabase.ForceClosed();</span>
<a href="#l49.85"></a><span id="l49.85" class="difflineplus">+  localAccountUtils.inboxFolder.msgDatabase = null;</span>
<a href="#l49.86"></a><span id="l49.86">   try {</span>
<a href="#l49.87"></a><span id="l49.87" class="difflineminus">-    gLocalInboxFolder.getDatabaseWithReparse(ParseListener1, gDummyMsgWindow);</span>
<a href="#l49.88"></a><span id="l49.88" class="difflineplus">+    localAccountUtils.inboxFolder.getDatabaseWithReparse(ParseListener1, gDummyMsgWindow);</span>
<a href="#l49.89"></a><span id="l49.89">   } catch (ex) {</span>
<a href="#l49.90"></a><span id="l49.90">     do_check_eq(ex.result, Cr.NS_ERROR_NOT_INITIALIZED);</span>
<a href="#l49.91"></a><span id="l49.91">   }</span>
<a href="#l49.92"></a><span id="l49.92">   // Execution continues in downloadUnder4GiB() when done.</span>
<a href="#l49.93"></a><span id="l49.93"> }</span>
<a href="#l49.94"></a><span id="l49.94"> </span>
<a href="#l49.95"></a><span id="l49.95"> /**</span>
<a href="#l49.96"></a><span id="l49.96">  * Check we can download new mail when we are near 4GiB limit but do not cross it.</span>
<a href="#l49.97"></a><span id="l49.97" class="difflineat">@@ -199,20 +199,20 @@ function growOver4GiB()</span>
<a href="#l49.98"></a><span id="l49.98">   gPOP3Pump = null;</span>
<a href="#l49.99"></a><span id="l49.99"> </span>
<a href="#l49.100"></a><span id="l49.100">   // Grow inbox to size greater than the max limit (+16 MiB).</span>
<a href="#l49.101"></a><span id="l49.101">   growInbox(kSizeLimit + 0x1000000);</span>
<a href="#l49.102"></a><span id="l49.102">   do_check_true(gInboxFile.fileSize &gt; kSizeLimit);</span>
<a href="#l49.103"></a><span id="l49.103"> </span>
<a href="#l49.104"></a><span id="l49.104">   // Force the db closed, so that getDatabaseWithReparse will notice</span>
<a href="#l49.105"></a><span id="l49.105">   // that it's out of date.</span>
<a href="#l49.106"></a><span id="l49.106" class="difflineminus">-  gLocalInboxFolder.msgDatabase.ForceClosed();</span>
<a href="#l49.107"></a><span id="l49.107" class="difflineminus">-  gLocalInboxFolder.msgDatabase = null;</span>
<a href="#l49.108"></a><span id="l49.108" class="difflineplus">+  localAccountUtils.inboxFolder.msgDatabase.ForceClosed();</span>
<a href="#l49.109"></a><span id="l49.109" class="difflineplus">+  localAccountUtils.inboxFolder.msgDatabase = null;</span>
<a href="#l49.110"></a><span id="l49.110">   try {</span>
<a href="#l49.111"></a><span id="l49.111" class="difflineminus">-    gLocalInboxFolder.getDatabaseWithReparse(ParseListener2, gDummyMsgWindow);</span>
<a href="#l49.112"></a><span id="l49.112" class="difflineplus">+    localAccountUtils.inboxFolder.getDatabaseWithReparse(ParseListener2, gDummyMsgWindow);</span>
<a href="#l49.113"></a><span id="l49.113">   } catch (ex) {</span>
<a href="#l49.114"></a><span id="l49.114">     do_check_eq(ex.result, Cr.NS_ERROR_NOT_INITIALIZED);</span>
<a href="#l49.115"></a><span id="l49.115">   }</span>
<a href="#l49.116"></a><span id="l49.116">   // Execution continues in copyOver4GiB() when done.</span>
<a href="#l49.117"></a><span id="l49.117"> }</span>
<a href="#l49.118"></a><span id="l49.118"> </span>
<a href="#l49.119"></a><span id="l49.119"> /**</span>
<a href="#l49.120"></a><span id="l49.120">  * Bug 598104</span>
<a href="#l49.121"></a><span id="l49.121" class="difflineat">@@ -230,96 +230,96 @@ function copyIntoOver4GiB()</span>
<a href="#l49.122"></a><span id="l49.122">   let file = do_get_file(&quot;../../../data/multipart-complex2&quot;);</span>
<a href="#l49.123"></a><span id="l49.123">   copyFileMessageInLocalFolder(file, 0, &quot;&quot;, gDummyMsgWindow,</span>
<a href="#l49.124"></a><span id="l49.124">                                function(aMessageHeadersKeys, aStatus) {</span>
<a href="#l49.125"></a><span id="l49.125">     do_check_false(Components.isSuccessCode(aStatus));</span>
<a href="#l49.126"></a><span id="l49.126">   });</span>
<a href="#l49.127"></a><span id="l49.127">   do_check_true(gGotAlert);</span>
<a href="#l49.128"></a><span id="l49.128"> </span>
<a href="#l49.129"></a><span id="l49.129">   // Make sure inbox file did not grow (i.e., no data were appended).</span>
<a href="#l49.130"></a><span id="l49.130" class="difflineminus">-  let newLocalInboxSize = gLocalInboxFolder.filePath.fileSize;</span>
<a href="#l49.131"></a><span id="l49.131" class="difflineplus">+  let newLocalInboxSize = localAccountUtils.inboxFolder.filePath.fileSize;</span>
<a href="#l49.132"></a><span id="l49.132">   do_print(&quot;Local inbox size (after copyFileMessageInLocalFolder()) = &quot; +</span>
<a href="#l49.133"></a><span id="l49.133">            newLocalInboxSize);</span>
<a href="#l49.134"></a><span id="l49.134">   do_check_eq(newLocalInboxSize, localInboxSize);</span>
<a href="#l49.135"></a><span id="l49.135"> </span>
<a href="#l49.136"></a><span id="l49.136">   do_timeout(0, compactUnder4GiB);</span>
<a href="#l49.137"></a><span id="l49.137"> }</span>
<a href="#l49.138"></a><span id="l49.138"> </span>
<a href="#l49.139"></a><span id="l49.139"> /**</span>
<a href="#l49.140"></a><span id="l49.140">  * Bug 608449</span>
<a href="#l49.141"></a><span id="l49.141">  * Check we compact a folder to get it under 4 GiB.</span>
<a href="#l49.142"></a><span id="l49.142">  */</span>
<a href="#l49.143"></a><span id="l49.143"> function compactUnder4GiB()</span>
<a href="#l49.144"></a><span id="l49.144"> {</span>
<a href="#l49.145"></a><span id="l49.145">   do_check_true(gInboxFile.fileSize &gt; kSizeLimit);</span>
<a href="#l49.146"></a><span id="l49.146">   // Very first header in msgDB is retained,</span>
<a href="#l49.147"></a><span id="l49.147">   // then all other headers are marked as deleted.</span>
<a href="#l49.148"></a><span id="l49.148" class="difflineminus">-  let msgDB = gLocalInboxFolder.msgDatabase;</span>
<a href="#l49.149"></a><span id="l49.149" class="difflineplus">+  let msgDB = localAccountUtils.inboxFolder.msgDatabase;</span>
<a href="#l49.150"></a><span id="l49.150">   let enumerator = msgDB.EnumerateMessages();</span>
<a href="#l49.151"></a><span id="l49.151">   let firstHdr = true;</span>
<a href="#l49.152"></a><span id="l49.152">   let messages = Cc[&quot;@mozilla.org/array;1&quot;].createInstance(Ci.nsIMutableArray);</span>
<a href="#l49.153"></a><span id="l49.153">   while (enumerator.hasMoreElements()) {</span>
<a href="#l49.154"></a><span id="l49.154">     let header = enumerator.getNext();</span>
<a href="#l49.155"></a><span id="l49.155">     if (header instanceof Components.interfaces.nsIMsgDBHdr &amp;&amp; !firstHdr)</span>
<a href="#l49.156"></a><span id="l49.156">       messages.appendElement(header, false);</span>
<a href="#l49.157"></a><span id="l49.157">     firstHdr = false;</span>
<a href="#l49.158"></a><span id="l49.158">   }</span>
<a href="#l49.159"></a><span id="l49.159" class="difflineminus">-  gLocalInboxFolder.deleteMessages(messages, null, true, false, null, false);</span>
<a href="#l49.160"></a><span id="l49.160" class="difflineplus">+  localAccountUtils.inboxFolder.deleteMessages(messages, null, true, false, null, false);</span>
<a href="#l49.161"></a><span id="l49.161"> </span>
<a href="#l49.162"></a><span id="l49.162">   // Note: compact() will also add 'X-Mozilla-Status' and 'X-Mozilla-Status2'</span>
<a href="#l49.163"></a><span id="l49.163">   // lines to message(s).</span>
<a href="#l49.164"></a><span id="l49.164" class="difflineminus">-  gLocalInboxFolder.compact(CompactListener2, null);</span>
<a href="#l49.165"></a><span id="l49.165" class="difflineplus">+  localAccountUtils.inboxFolder.compact(CompactListener2, null);</span>
<a href="#l49.166"></a><span id="l49.166">   // Test ends after compaction is done.</span>
<a href="#l49.167"></a><span id="l49.167"> }</span>
<a href="#l49.168"></a><span id="l49.168"> </span>
<a href="#l49.169"></a><span id="l49.169"> var ParseListener1 =</span>
<a href="#l49.170"></a><span id="l49.170"> {</span>
<a href="#l49.171"></a><span id="l49.171">   OnStartRunningUrl: function (aUrl) {},</span>
<a href="#l49.172"></a><span id="l49.172">   OnStopRunningUrl: function (aUrl, aExitCode) {</span>
<a href="#l49.173"></a><span id="l49.173">     // Check: reparse successful</span>
<a href="#l49.174"></a><span id="l49.174">     do_check_eq(aExitCode, 0);</span>
<a href="#l49.175"></a><span id="l49.175" class="difflineminus">-    do_check_neq(gLocalInboxFolder.msgDatabase, null);</span>
<a href="#l49.176"></a><span id="l49.176" class="difflineminus">-    do_check_true(gLocalInboxFolder.msgDatabase.summaryValid);</span>
<a href="#l49.177"></a><span id="l49.177" class="difflineplus">+    do_check_neq(localAccountUtils.inboxFolder.msgDatabase, null);</span>
<a href="#l49.178"></a><span id="l49.178" class="difflineplus">+    do_check_true(localAccountUtils.inboxFolder.msgDatabase.summaryValid);</span>
<a href="#l49.179"></a><span id="l49.179"> </span>
<a href="#l49.180"></a><span id="l49.180">     downloadUnder4GiB();</span>
<a href="#l49.181"></a><span id="l49.181">   }</span>
<a href="#l49.182"></a><span id="l49.182"> };</span>
<a href="#l49.183"></a><span id="l49.183"> </span>
<a href="#l49.184"></a><span id="l49.184"> var ParseListener2 =</span>
<a href="#l49.185"></a><span id="l49.185"> {</span>
<a href="#l49.186"></a><span id="l49.186">   OnStartRunningUrl: function (aUrl) {},</span>
<a href="#l49.187"></a><span id="l49.187">   OnStopRunningUrl: function (aUrl, aExitCode) {</span>
<a href="#l49.188"></a><span id="l49.188">     // Check: reparse successful</span>
<a href="#l49.189"></a><span id="l49.189">     do_check_eq(aExitCode, 0);</span>
<a href="#l49.190"></a><span id="l49.190" class="difflineminus">-    do_check_neq(gLocalInboxFolder.msgDatabase, null);</span>
<a href="#l49.191"></a><span id="l49.191" class="difflineminus">-    do_check_true(gLocalInboxFolder.msgDatabase.summaryValid);</span>
<a href="#l49.192"></a><span id="l49.192" class="difflineplus">+    do_check_neq(localAccountUtils.inboxFolder.msgDatabase, null);</span>
<a href="#l49.193"></a><span id="l49.193" class="difflineplus">+    do_check_true(localAccountUtils.inboxFolder.msgDatabase.summaryValid);</span>
<a href="#l49.194"></a><span id="l49.194"> </span>
<a href="#l49.195"></a><span id="l49.195">     copyIntoOver4GiB();</span>
<a href="#l49.196"></a><span id="l49.196">   }</span>
<a href="#l49.197"></a><span id="l49.197"> };</span>
<a href="#l49.198"></a><span id="l49.198"> </span>
<a href="#l49.199"></a><span id="l49.199"> var CompactListener2 =</span>
<a href="#l49.200"></a><span id="l49.200"> {</span>
<a href="#l49.201"></a><span id="l49.201">   OnStartRunningUrl: function (aUrl) {},</span>
<a href="#l49.202"></a><span id="l49.202">   OnStopRunningUrl: function (aUrl, aExitCode) {</span>
<a href="#l49.203"></a><span id="l49.203">     // Check: message successfully copied.</span>
<a href="#l49.204"></a><span id="l49.204">     do_check_eq(aExitCode, 0);</span>
<a href="#l49.205"></a><span id="l49.205" class="difflineminus">-    do_check_true(gLocalInboxFolder.msgDatabase.summaryValid);</span>
<a href="#l49.206"></a><span id="l49.206" class="difflineplus">+    do_check_true(localAccountUtils.inboxFolder.msgDatabase.summaryValid);</span>
<a href="#l49.207"></a><span id="l49.207"> </span>
<a href="#l49.208"></a><span id="l49.208">     // Check that folder size isn't much bigger than our sparse block size, ...</span>
<a href="#l49.209"></a><span id="l49.209" class="difflineminus">-    let localInboxSize = gLocalInboxFolder.filePath.fileSize;</span>
<a href="#l49.210"></a><span id="l49.210" class="difflineplus">+    let localInboxSize = localAccountUtils.inboxFolder.filePath.fileSize;</span>
<a href="#l49.211"></a><span id="l49.211">     do_print(&quot;Local inbox size (after compact()) = &quot; + localInboxSize);</span>
<a href="#l49.212"></a><span id="l49.212">     do_check_true(localInboxSize &lt; kSparseBlockSize + 1000);</span>
<a href="#l49.213"></a><span id="l49.213">     // ... i.e., that we just have one message.</span>
<a href="#l49.214"></a><span id="l49.214" class="difflineminus">-    do_check_eq(gLocalInboxFolder.getTotalMessages(false), 1);</span>
<a href="#l49.215"></a><span id="l49.215" class="difflineplus">+    do_check_eq(localAccountUtils.inboxFolder.getTotalMessages(false), 1);</span>
<a href="#l49.216"></a><span id="l49.216"> </span>
<a href="#l49.217"></a><span id="l49.217">     endTest();</span>
<a href="#l49.218"></a><span id="l49.218">   }</span>
<a href="#l49.219"></a><span id="l49.219"> };</span>
<a href="#l49.220"></a><span id="l49.220"> </span>
<a href="#l49.221"></a><span id="l49.221"> function endTest()</span>
<a href="#l49.222"></a><span id="l49.222"> {</span>
<a href="#l49.223"></a><span id="l49.223">   // Free up disk space - if you want to look at the file after running</span>
<a href="#l49.224"></a><span id="l49.224">   // this test, comment out this line.</span>
<a href="#l49.225"></a><span id="l49.225" class="difflineminus">-  gLocalInboxFolder.filePath.remove(false);</span>
<a href="#l49.226"></a><span id="l49.226" class="difflineplus">+  localAccountUtils.inboxFolder.filePath.remove(false);</span>
<a href="#l49.227"></a><span id="l49.227"> </span>
<a href="#l49.228"></a><span id="l49.228">   do_test_finished();</span>
<a href="#l49.229"></a><span id="l49.229"> }</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l50.1"></a><span id="l50.1" class="difflineminus">--- a/mailnews/local/test/unit/test_pop3AuthMethods.js</span>
<a href="#l50.2"></a><span id="l50.2" class="difflineplus">+++ b/mailnews/local/test/unit/test_pop3AuthMethods.js</span>
<a href="#l50.3"></a><span id="l50.3" class="difflineat">@@ -127,17 +127,17 @@ function testNext() {</span>
<a href="#l50.4"></a><span id="l50.4">     // (alternative would be .pop3CapabilityFlags = 0, but this is safer)</span>
<a href="#l50.5"></a><span id="l50.5">     deletePop3Server();</span>
<a href="#l50.6"></a><span id="l50.6">     incomingServer = createPop3Server();</span>
<a href="#l50.7"></a><span id="l50.7"> </span>
<a href="#l50.8"></a><span id="l50.8">     let msgServer = incomingServer;</span>
<a href="#l50.9"></a><span id="l50.9">     msgServer.QueryInterface(Ci.nsIMsgIncomingServer);</span>
<a href="#l50.10"></a><span id="l50.10">     msgServer.authMethod = thisTest.clientAuthMethod;</span>
<a href="#l50.11"></a><span id="l50.11"> </span>
<a href="#l50.12"></a><span id="l50.12" class="difflineminus">-    MailServices.pop3.GetNewMail(null, urlListener, gLocalInboxFolder,</span>
<a href="#l50.13"></a><span id="l50.13" class="difflineplus">+    MailServices.pop3.GetNewMail(null, urlListener, localAccountUtils.inboxFolder,</span>
<a href="#l50.14"></a><span id="l50.14">                                  incomingServer);</span>
<a href="#l50.15"></a><span id="l50.15">     server.performTest();</span>
<a href="#l50.16"></a><span id="l50.16">   } catch (e) {</span>
<a href="#l50.17"></a><span id="l50.17">     server.stop();</span>
<a href="#l50.18"></a><span id="l50.18">     do_throw(e);</span>
<a href="#l50.19"></a><span id="l50.19">   }</span>
<a href="#l50.20"></a><span id="l50.20"> }</span>
<a href="#l50.21"></a><span id="l50.21"> </span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l51.1"></a><span id="l51.1" class="difflineminus">--- a/mailnews/local/test/unit/test_pop3Download.js</span>
<a href="#l51.2"></a><span id="l51.2" class="difflineplus">+++ b/mailnews/local/test/unit/test_pop3Download.js</span>
<a href="#l51.3"></a><span id="l51.3" class="difflineat">@@ -27,17 +27,17 @@ function run_test()</span>
<a href="#l51.4"></a><span id="l51.4">   gPOP3Pump.onDone = continueTest;</span>
<a href="#l51.5"></a><span id="l51.5">   do_test_pending();</span>
<a href="#l51.6"></a><span id="l51.6">   gPOP3Pump.run();</span>
<a href="#l51.7"></a><span id="l51.7"> }</span>
<a href="#l51.8"></a><span id="l51.8"> </span>
<a href="#l51.9"></a><span id="l51.9"> function continueTest()</span>
<a href="#l51.10"></a><span id="l51.10"> {</span>
<a href="#l51.11"></a><span id="l51.11">   // get message headers for the inbox folder</span>
<a href="#l51.12"></a><span id="l51.12" class="difflineminus">-  let enumerator = gLocalInboxFolder.msgDatabase.EnumerateMessages();</span>
<a href="#l51.13"></a><span id="l51.13" class="difflineplus">+  let enumerator = localAccountUtils.inboxFolder.msgDatabase.EnumerateMessages();</span>
<a href="#l51.14"></a><span id="l51.14">   var msgCount = 0;</span>
<a href="#l51.15"></a><span id="l51.15">   let hdr;</span>
<a href="#l51.16"></a><span id="l51.16">   while (enumerator.hasMoreElements())</span>
<a href="#l51.17"></a><span id="l51.17">   {</span>
<a href="#l51.18"></a><span id="l51.18">     let hdr = enumerator.getNext().QueryInterface(Ci.nsIMsgDBHdr);</span>
<a href="#l51.19"></a><span id="l51.19">     gMsgHdrs.push(hdr);</span>
<a href="#l51.20"></a><span id="l51.20">     do_check_eq(hdr.subject, testSubjects[msgCount++]);</span>
<a href="#l51.21"></a><span id="l51.21">   }</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l52.1"></a><span id="l52.1" class="difflineminus">--- a/mailnews/local/test/unit/test_pop3DownloadTempFileHandling.js</span>
<a href="#l52.2"></a><span id="l52.2" class="difflineplus">+++ b/mailnews/local/test/unit/test_pop3DownloadTempFileHandling.js</span>
<a href="#l52.3"></a><span id="l52.3" class="difflineat">@@ -26,17 +26,17 @@ function run_test()</span>
<a href="#l52.4"></a><span id="l52.4"> function continueTest()</span>
<a href="#l52.5"></a><span id="l52.5"> {</span>
<a href="#l52.6"></a><span id="l52.6">   dump(&quot;temp file path = &quot; + gExpectedFiles[0].path + &quot;\n&quot;);</span>
<a href="#l52.7"></a><span id="l52.7">   dump(&quot;temp file path = &quot; + gExpectedFiles[1].path + &quot;\n&quot;);</span>
<a href="#l52.8"></a><span id="l52.8">   for each (let expectedFile in gExpectedFiles)</span>
<a href="#l52.9"></a><span id="l52.9">     do_check_false(expectedFile.exists());</span>
<a href="#l52.10"></a><span id="l52.10"> </span>
<a href="#l52.11"></a><span id="l52.11">   // get message headers for the inbox folder</span>
<a href="#l52.12"></a><span id="l52.12" class="difflineminus">-  let enumerator = gLocalInboxFolder.msgDatabase.EnumerateMessages();</span>
<a href="#l52.13"></a><span id="l52.13" class="difflineplus">+  let enumerator = localAccountUtils.inboxFolder.msgDatabase.EnumerateMessages();</span>
<a href="#l52.14"></a><span id="l52.14">   var msgCount = 0;</span>
<a href="#l52.15"></a><span id="l52.15">   while (enumerator.hasMoreElements())</span>
<a href="#l52.16"></a><span id="l52.16">   {</span>
<a href="#l52.17"></a><span id="l52.17">     let hdr = enumerator.getNext().QueryInterface(Ci.nsIMsgDBHdr);</span>
<a href="#l52.18"></a><span id="l52.18">     do_check_eq(hdr.subject, testSubjects[msgCount++]);</span>
<a href="#l52.19"></a><span id="l52.19">   }</span>
<a href="#l52.20"></a><span id="l52.20">   do_check_eq(msgCount, 2);</span>
<a href="#l52.21"></a><span id="l52.21">   gPOP3Pump = null;</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l53.1"></a><span id="l53.1" class="difflineminus">--- a/mailnews/local/test/unit/test_pop3Duplicates.js</span>
<a href="#l53.2"></a><span id="l53.2" class="difflineplus">+++ b/mailnews/local/test/unit/test_pop3Duplicates.js</span>
<a href="#l53.3"></a><span id="l53.3" class="difflineat">@@ -20,17 +20,17 @@ function run_test()</span>
<a href="#l53.4"></a><span id="l53.4">   gPOP3Pump.onDone = continueTest;</span>
<a href="#l53.5"></a><span id="l53.5">   do_test_pending();</span>
<a href="#l53.6"></a><span id="l53.6">   gPOP3Pump.run();</span>
<a href="#l53.7"></a><span id="l53.7"> }</span>
<a href="#l53.8"></a><span id="l53.8"> </span>
<a href="#l53.9"></a><span id="l53.9"> function continueTest()</span>
<a href="#l53.10"></a><span id="l53.10"> {</span>
<a href="#l53.11"></a><span id="l53.11">   // get message headers for the inbox folder</span>
<a href="#l53.12"></a><span id="l53.12" class="difflineminus">-  let enumerator = gLocalInboxFolder.msgDatabase.EnumerateMessages();</span>
<a href="#l53.13"></a><span id="l53.13" class="difflineplus">+  let enumerator = localAccountUtils.inboxFolder.msgDatabase.EnumerateMessages();</span>
<a href="#l53.14"></a><span id="l53.14">   var msgCount = 0;</span>
<a href="#l53.15"></a><span id="l53.15">   while (enumerator.hasMoreElements())</span>
<a href="#l53.16"></a><span id="l53.16">   {</span>
<a href="#l53.17"></a><span id="l53.17">     let hdr = enumerator.getNext().QueryInterface(Ci.nsIMsgDBHdr);</span>
<a href="#l53.18"></a><span id="l53.18">     do_check_eq(hdr.subject, testSubjects[msgCount++]);</span>
<a href="#l53.19"></a><span id="l53.19">   }</span>
<a href="#l53.20"></a><span id="l53.20">   do_check_eq(msgCount, 2);</span>
<a href="#l53.21"></a><span id="l53.21">   gPOP3Pump = null;</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l54.1"></a><span id="l54.1" class="difflineminus">--- a/mailnews/local/test/unit/test_pop3FilterActions.js</span>
<a href="#l54.2"></a><span id="l54.2" class="difflineplus">+++ b/mailnews/local/test/unit/test_pop3FilterActions.js</span>
<a href="#l54.3"></a><span id="l54.3" class="difflineat">@@ -48,41 +48,41 @@ const gTestArray =</span>
<a href="#l54.4"></a><span id="l54.4">   // just get a message into the local folder</span>
<a href="#l54.5"></a><span id="l54.5">   function getLocalMessages1() {</span>
<a href="#l54.6"></a><span id="l54.6">     gPOP3Pump.files = gFiles;</span>
<a href="#l54.7"></a><span id="l54.7">     gPOP3Pump.onDone = doTest;</span>
<a href="#l54.8"></a><span id="l54.8">     ++gCurTestNum;</span>
<a href="#l54.9"></a><span id="l54.9">     gPOP3Pump.run();</span>
<a href="#l54.10"></a><span id="l54.10">   },</span>
<a href="#l54.11"></a><span id="l54.11">   function verifyFolders2() {</span>
<a href="#l54.12"></a><span id="l54.12" class="difflineminus">-    do_check_eq(folderCount(gLocalInboxFolder), 2);</span>
<a href="#l54.13"></a><span id="l54.13" class="difflineplus">+    do_check_eq(folderCount(localAccountUtils.inboxFolder), 2);</span>
<a href="#l54.14"></a><span id="l54.14"> </span>
<a href="#l54.15"></a><span id="l54.15">     // invalidate the inbox summary file, to be sure that we wrote the keywords</span>
<a href="#l54.16"></a><span id="l54.16">     // into the mailbox.</span>
<a href="#l54.17"></a><span id="l54.17" class="difflineminus">-    gLocalInboxFolder.msgDatabase.summaryValid = false;</span>
<a href="#l54.18"></a><span id="l54.18" class="difflineminus">-    gLocalInboxFolder.msgDatabase = null;</span>
<a href="#l54.19"></a><span id="l54.19" class="difflineminus">-    gLocalInboxFolder.ForceDBClosed();</span>
<a href="#l54.20"></a><span id="l54.20" class="difflineplus">+    localAccountUtils.inboxFolder.msgDatabase.summaryValid = false;</span>
<a href="#l54.21"></a><span id="l54.21" class="difflineplus">+    localAccountUtils.inboxFolder.msgDatabase = null;</span>
<a href="#l54.22"></a><span id="l54.22" class="difflineplus">+    localAccountUtils.inboxFolder.ForceDBClosed();</span>
<a href="#l54.23"></a><span id="l54.23">     try {</span>
<a href="#l54.24"></a><span id="l54.24" class="difflineminus">-      gLocalInboxFolder.getDatabaseWithReparse(ParseListener, null);</span>
<a href="#l54.25"></a><span id="l54.25" class="difflineplus">+      localAccountUtils.inboxFolder.getDatabaseWithReparse(ParseListener, null);</span>
<a href="#l54.26"></a><span id="l54.26">     } catch (ex) {</span>
<a href="#l54.27"></a><span id="l54.27">       do_check_true(ex.result == Cr.NS_ERROR_NOT_INITIALIZED);</span>
<a href="#l54.28"></a><span id="l54.28">     }</span>
<a href="#l54.29"></a><span id="l54.29">   },</span>
<a href="#l54.30"></a><span id="l54.30">   function verifyMessages() {</span>
<a href="#l54.31"></a><span id="l54.31">     let hdrs = [];</span>
<a href="#l54.32"></a><span id="l54.32">     let keys = [];</span>
<a href="#l54.33"></a><span id="l54.33">     let asyncResults = new Object;</span>
<a href="#l54.34"></a><span id="l54.34" class="difflineminus">-    let enumerator = gLocalInboxFolder.msgDatabase.EnumerateMessages();</span>
<a href="#l54.35"></a><span id="l54.35" class="difflineplus">+    let enumerator = localAccountUtils.inboxFolder.msgDatabase.EnumerateMessages();</span>
<a href="#l54.36"></a><span id="l54.36">     while (enumerator.hasMoreElements())</span>
<a href="#l54.37"></a><span id="l54.37">     {</span>
<a href="#l54.38"></a><span id="l54.38">       let hdr = enumerator.getNext().QueryInterface(Ci.nsIMsgDBHdr);</span>
<a href="#l54.39"></a><span id="l54.39">       keys.push(hdr.messageKey);</span>
<a href="#l54.40"></a><span id="l54.40">       hdrs.push(hdr);</span>
<a href="#l54.41"></a><span id="l54.41">     }</span>
<a href="#l54.42"></a><span id="l54.42" class="difflineminus">-    gLocalInboxFolder.fetchMsgPreviewText(keys, keys.length, false, null, asyncResults);</span>
<a href="#l54.43"></a><span id="l54.43" class="difflineplus">+    localAccountUtils.inboxFolder.fetchMsgPreviewText(keys, keys.length, false, null, asyncResults);</span>
<a href="#l54.44"></a><span id="l54.44">     do_check_eq(hdrs[0].getStringProperty('preview'), bugmail10_preview);</span>
<a href="#l54.45"></a><span id="l54.45">     do_check_eq(hdrs[1].getStringProperty('preview'), bugmail11_preview);</span>
<a href="#l54.46"></a><span id="l54.46">     do_check_eq(hdrs[0].getStringProperty('keywords'), &quot;TheTag&quot;);</span>
<a href="#l54.47"></a><span id="l54.47">     do_check_eq(hdrs[1].getStringProperty('keywords'), &quot;TheTag&quot;);</span>
<a href="#l54.48"></a><span id="l54.48">     do_check_eq(hdrs[0].flags, Ci.nsMsgMessageFlags.Read |</span>
<a href="#l54.49"></a><span id="l54.49">                                Ci.nsMsgMessageFlags.Marked);</span>
<a href="#l54.50"></a><span id="l54.50">     do_check_eq(hdrs[1].flags, Ci.nsMsgMessageFlags.Read |</span>
<a href="#l54.51"></a><span id="l54.51">                                Ci.nsMsgMessageFlags.Marked);</span>
<a href="#l54.52"></a><span id="l54.52" class="difflineat">@@ -92,18 +92,18 @@ const gTestArray =</span>
<a href="#l54.53"></a><span id="l54.53"> ];</span>
<a href="#l54.54"></a><span id="l54.54"> </span>
<a href="#l54.55"></a><span id="l54.55"> var ParseListener =</span>
<a href="#l54.56"></a><span id="l54.56"> {</span>
<a href="#l54.57"></a><span id="l54.57">   OnStartRunningUrl: function (aUrl) {</span>
<a href="#l54.58"></a><span id="l54.58">   },</span>
<a href="#l54.59"></a><span id="l54.59">   OnStopRunningUrl: function (aUrl, aExitCode) {</span>
<a href="#l54.60"></a><span id="l54.60">     do_check_eq(aExitCode, 0);</span>
<a href="#l54.61"></a><span id="l54.61" class="difflineminus">-    do_check_true(gLocalInboxFolder.msgDatabase.summaryValid);</span>
<a href="#l54.62"></a><span id="l54.62" class="difflineminus">-    do_check_eq(folderCount(gLocalInboxFolder), 2);</span>
<a href="#l54.63"></a><span id="l54.63" class="difflineplus">+    do_check_true(localAccountUtils.inboxFolder.msgDatabase.summaryValid);</span>
<a href="#l54.64"></a><span id="l54.64" class="difflineplus">+    do_check_eq(folderCount(localAccountUtils.inboxFolder), 2);</span>
<a href="#l54.65"></a><span id="l54.65">     ++gCurTestNum;</span>
<a href="#l54.66"></a><span id="l54.66">     doTest();</span>
<a href="#l54.67"></a><span id="l54.67">   }</span>
<a href="#l54.68"></a><span id="l54.68"> };</span>
<a href="#l54.69"></a><span id="l54.69"> </span>
<a href="#l54.70"></a><span id="l54.70"> function folderCount(folder)</span>
<a href="#l54.71"></a><span id="l54.71"> {</span>
<a href="#l54.72"></a><span id="l54.72">   let enumerator = folder.msgDatabase.EnumerateMessages();</span>
<a href="#l54.73"></a><span id="l54.73" class="difflineat">@@ -115,17 +115,17 @@ function folderCount(folder)</span>
<a href="#l54.74"></a><span id="l54.74">   }</span>
<a href="#l54.75"></a><span id="l54.75">   return count;</span>
<a href="#l54.76"></a><span id="l54.76"> }</span>
<a href="#l54.77"></a><span id="l54.77"> </span>
<a href="#l54.78"></a><span id="l54.78"> function run_test()</span>
<a href="#l54.79"></a><span id="l54.79"> {</span>
<a href="#l54.80"></a><span id="l54.80">   // Make sure we're not quarantining messages</span>
<a href="#l54.81"></a><span id="l54.81">   Services.prefs.setBoolPref(&quot;mailnews.downloadToTempFile&quot;, false);</span>
<a href="#l54.82"></a><span id="l54.82" class="difflineminus">-  if (!gLocalInboxFolder)</span>
<a href="#l54.83"></a><span id="l54.83" class="difflineplus">+  if (!localAccountUtils.inboxFolder)</span>
<a href="#l54.84"></a><span id="l54.84">     localAccountUtils.loadLocalMailAccount();</span>
<a href="#l54.85"></a><span id="l54.85"> </span>
<a href="#l54.86"></a><span id="l54.86">   gMoveFolder = localAccountUtils.incomingServer</span>
<a href="#l54.87"></a><span id="l54.87">                                  .rootFolder.createLocalSubfolder(&quot;MoveFolder&quot;);</span>
<a href="#l54.88"></a><span id="l54.88"> </span>
<a href="#l54.89"></a><span id="l54.89">   MailServices.mailSession.AddFolderListener(FolderListener,</span>
<a href="#l54.90"></a><span id="l54.90">                                              Ci.nsIFolderListener.event |</span>
<a href="#l54.91"></a><span id="l54.91">                                                Ci.nsIFolderListener.added |</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l55.1"></a><span id="l55.1" class="difflineminus">--- a/mailnews/local/test/unit/test_pop3GSSAPIFail.js</span>
<a href="#l55.2"></a><span id="l55.2" class="difflineplus">+++ b/mailnews/local/test/unit/test_pop3GSSAPIFail.js</span>
<a href="#l55.3"></a><span id="l55.3" class="difflineat">@@ -124,17 +124,17 @@ function testNext() {</span>
<a href="#l55.4"></a><span id="l55.4">     // Mailnews caches server capabilities, so try to reset it</span>
<a href="#l55.5"></a><span id="l55.5">     deletePop3Server();</span>
<a href="#l55.6"></a><span id="l55.6">     incomingServer = createPop3Server();</span>
<a href="#l55.7"></a><span id="l55.7"> </span>
<a href="#l55.8"></a><span id="l55.8">     let msgServer = incomingServer;</span>
<a href="#l55.9"></a><span id="l55.9">     msgServer.QueryInterface(Ci.nsIMsgIncomingServer);</span>
<a href="#l55.10"></a><span id="l55.10">     msgServer.authMethod = thisTest.clientAuthMethod;</span>
<a href="#l55.11"></a><span id="l55.11"> </span>
<a href="#l55.12"></a><span id="l55.12" class="difflineminus">-    MailServices.pop3.GetNewMail(null, urlListener, gLocalInboxFolder,</span>
<a href="#l55.13"></a><span id="l55.13" class="difflineplus">+    MailServices.pop3.GetNewMail(null, urlListener, localAccountUtils.inboxFolder,</span>
<a href="#l55.14"></a><span id="l55.14">                                  incomingServer);</span>
<a href="#l55.15"></a><span id="l55.15">     server.performTest();</span>
<a href="#l55.16"></a><span id="l55.16">   } catch (e) {</span>
<a href="#l55.17"></a><span id="l55.17">     server.stop();</span>
<a href="#l55.18"></a><span id="l55.18">     do_throw(e);</span>
<a href="#l55.19"></a><span id="l55.19">   }</span>
<a href="#l55.20"></a><span id="l55.20"> }</span>
<a href="#l55.21"></a><span id="l55.21"> </span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l56.1"></a><span id="l56.1" class="difflineminus">--- a/mailnews/local/test/unit/test_pop3GetNewMail.js</span>
<a href="#l56.2"></a><span id="l56.2" class="difflineplus">+++ b/mailnews/local/test/unit/test_pop3GetNewMail.js</span>
<a href="#l56.3"></a><span id="l56.3" class="difflineat">@@ -27,17 +27,18 @@ var urlListener =</span>
<a href="#l56.4"></a><span id="l56.4">   OnStartRunningUrl: function (url) {</span>
<a href="#l56.5"></a><span id="l56.5">   },</span>
<a href="#l56.6"></a><span id="l56.6">   OnStopRunningUrl: function (url, result) {</span>
<a href="#l56.7"></a><span id="l56.7">     try {</span>
<a href="#l56.8"></a><span id="l56.8">       var transaction = server.playTransaction();</span>
<a href="#l56.9"></a><span id="l56.9"> </span>
<a href="#l56.10"></a><span id="l56.10">       do_check_transaction(transaction, thisTest.transaction);</span>
<a href="#l56.11"></a><span id="l56.11"> </span>
<a href="#l56.12"></a><span id="l56.12" class="difflineminus">-      do_check_eq(gLocalInboxFolder.getTotalMessages(false), thisTest.messages.length);</span>
<a href="#l56.13"></a><span id="l56.13" class="difflineplus">+      do_check_eq(localAccountUtils.inboxFolder.getTotalMessages(false),</span>
<a href="#l56.14"></a><span id="l56.14" class="difflineplus">+                  thisTest.messages.length);</span>
<a href="#l56.15"></a><span id="l56.15"> </span>
<a href="#l56.16"></a><span id="l56.16">       do_check_eq(result, 0);</span>
<a href="#l56.17"></a><span id="l56.17">     }</span>
<a href="#l56.18"></a><span id="l56.18">     catch (e) {</span>
<a href="#l56.19"></a><span id="l56.19">       // If we have an error, clean up nicely before we throw it.</span>
<a href="#l56.20"></a><span id="l56.20">       server.stop();</span>
<a href="#l56.21"></a><span id="l56.21"> </span>
<a href="#l56.22"></a><span id="l56.22">       var thread = gThreadManager.currentThread;</span>
<a href="#l56.23"></a><span id="l56.23" class="difflineat">@@ -93,17 +94,17 @@ function testNext() {</span>
<a href="#l56.24"></a><span id="l56.24">     else</span>
<a href="#l56.25"></a><span id="l56.25">       server.resetTest();</span>
<a href="#l56.26"></a><span id="l56.26"> </span>
<a href="#l56.27"></a><span id="l56.27">     // Set up the test</span>
<a href="#l56.28"></a><span id="l56.28">     test = thisTest.title;</span>
<a href="#l56.29"></a><span id="l56.29">     daemon.setMessages(thisTest.messages);</span>
<a href="#l56.30"></a><span id="l56.30"> </span>
<a href="#l56.31"></a><span id="l56.31">     // Now get the mail</span>
<a href="#l56.32"></a><span id="l56.32" class="difflineminus">-    MailServices.pop3.GetNewMail(null, urlListener, gLocalInboxFolder,</span>
<a href="#l56.33"></a><span id="l56.33" class="difflineplus">+    MailServices.pop3.GetNewMail(null, urlListener, localAccountUtils.inboxFolder,</span>
<a href="#l56.34"></a><span id="l56.34">                                  incomingServer);</span>
<a href="#l56.35"></a><span id="l56.35"> </span>
<a href="#l56.36"></a><span id="l56.36">     server.performTest();</span>
<a href="#l56.37"></a><span id="l56.37">   } catch (e) {</span>
<a href="#l56.38"></a><span id="l56.38">     server.stop();</span>
<a href="#l56.39"></a><span id="l56.39"> </span>
<a href="#l56.40"></a><span id="l56.40">     do_throw(e);</span>
<a href="#l56.41"></a><span id="l56.41">   } finally {</span>
<a href="#l56.42"></a><span id="l56.42" class="difflineat">@@ -124,14 +125,14 @@ function run_test() {</span>
<a href="#l56.43"></a><span id="l56.43">   daemon = server[0];</span>
<a href="#l56.44"></a><span id="l56.44">   server = server[1];</span>
<a href="#l56.45"></a><span id="l56.45"> </span>
<a href="#l56.46"></a><span id="l56.46">   // Set up the basic accounts and folders</span>
<a href="#l56.47"></a><span id="l56.47">   incomingServer = createPop3ServerAndLocalFolders();</span>
<a href="#l56.48"></a><span id="l56.48"> </span>
<a href="#l56.49"></a><span id="l56.49">   // Check that we haven't got any messages in the folder, if we have its a test</span>
<a href="#l56.50"></a><span id="l56.50">   // setup issue.</span>
<a href="#l56.51"></a><span id="l56.51" class="difflineminus">-  do_check_eq(gLocalInboxFolder.getTotalMessages(false), 0);</span>
<a href="#l56.52"></a><span id="l56.52" class="difflineplus">+  do_check_eq(localAccountUtils.inboxFolder.getTotalMessages(false), 0);</span>
<a href="#l56.53"></a><span id="l56.53"> </span>
<a href="#l56.54"></a><span id="l56.54">   do_test_pending();</span>
<a href="#l56.55"></a><span id="l56.55"> </span>
<a href="#l56.56"></a><span id="l56.56">   testNext();</span>
<a href="#l56.57"></a><span id="l56.57"> }</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l57.1"></a><span id="l57.1" class="difflineminus">--- a/mailnews/local/test/unit/test_pop3MoveFilter.js</span>
<a href="#l57.2"></a><span id="l57.2" class="difflineplus">+++ b/mailnews/local/test/unit/test_pop3MoveFilter.js</span>
<a href="#l57.3"></a><span id="l57.3" class="difflineat">@@ -46,25 +46,25 @@ const gTestArray =</span>
<a href="#l57.4"></a><span id="l57.4">     gPOP3Pump.files = gFiles;</span>
<a href="#l57.5"></a><span id="l57.5">     gPOP3Pump.onDone = doTest;</span>
<a href="#l57.6"></a><span id="l57.6">     ++gCurTestNum;</span>
<a href="#l57.7"></a><span id="l57.7">     gPOP3Pump.run();</span>
<a href="#l57.8"></a><span id="l57.8">   },</span>
<a href="#l57.9"></a><span id="l57.9">   function verifyFolders2() {</span>
<a href="#l57.10"></a><span id="l57.10">     do_check_eq(folderCount(gMoveFolder), 2);</span>
<a href="#l57.11"></a><span id="l57.11">     // the local inbox folder should now be empty, since we moved incoming mail.</span>
<a href="#l57.12"></a><span id="l57.12" class="difflineminus">-    do_check_eq(folderCount(gLocalInboxFolder), 0);</span>
<a href="#l57.13"></a><span id="l57.13" class="difflineplus">+    do_check_eq(folderCount(localAccountUtils.inboxFolder), 0);</span>
<a href="#l57.14"></a><span id="l57.14"> </span>
<a href="#l57.15"></a><span id="l57.15">     // invalidate the inbox summary file, to be sure that we really moved</span>
<a href="#l57.16"></a><span id="l57.16">     // the mail.</span>
<a href="#l57.17"></a><span id="l57.17" class="difflineminus">-    gLocalInboxFolder.msgDatabase.summaryValid = false;</span>
<a href="#l57.18"></a><span id="l57.18" class="difflineminus">-    gLocalInboxFolder.msgDatabase = null;</span>
<a href="#l57.19"></a><span id="l57.19" class="difflineminus">-    gLocalInboxFolder.ForceDBClosed();</span>
<a href="#l57.20"></a><span id="l57.20" class="difflineplus">+    localAccountUtils.inboxFolder.msgDatabase.summaryValid = false;</span>
<a href="#l57.21"></a><span id="l57.21" class="difflineplus">+    localAccountUtils.inboxFolder.msgDatabase = null;</span>
<a href="#l57.22"></a><span id="l57.22" class="difflineplus">+    localAccountUtils.inboxFolder.ForceDBClosed();</span>
<a href="#l57.23"></a><span id="l57.23">     try {</span>
<a href="#l57.24"></a><span id="l57.24" class="difflineminus">-      gLocalInboxFolder.getDatabaseWithReparse(ParseListener, null);</span>
<a href="#l57.25"></a><span id="l57.25" class="difflineplus">+      localAccountUtils.inboxFolder.getDatabaseWithReparse(ParseListener, null);</span>
<a href="#l57.26"></a><span id="l57.26">     } catch (ex) {</span>
<a href="#l57.27"></a><span id="l57.27">       do_check_true(ex.result == Cr.NS_ERROR_NOT_INITIALIZED);</span>
<a href="#l57.28"></a><span id="l57.28">     }</span>
<a href="#l57.29"></a><span id="l57.29">   },</span>
<a href="#l57.30"></a><span id="l57.30">   function verifyMessages() {</span>
<a href="#l57.31"></a><span id="l57.31">     let hdrs = [];</span>
<a href="#l57.32"></a><span id="l57.32">     let keys = [];</span>
<a href="#l57.33"></a><span id="l57.33">     let asyncResults = new Object;</span>
<a href="#l57.34"></a><span id="l57.34" class="difflineat">@@ -84,18 +84,18 @@ const gTestArray =</span>
<a href="#l57.35"></a><span id="l57.35"> ];</span>
<a href="#l57.36"></a><span id="l57.36"> </span>
<a href="#l57.37"></a><span id="l57.37"> var ParseListener =</span>
<a href="#l57.38"></a><span id="l57.38"> {</span>
<a href="#l57.39"></a><span id="l57.39">   OnStartRunningUrl: function (aUrl) {</span>
<a href="#l57.40"></a><span id="l57.40">   },</span>
<a href="#l57.41"></a><span id="l57.41">   OnStopRunningUrl: function (aUrl, aExitCode) {</span>
<a href="#l57.42"></a><span id="l57.42">     do_check_eq(aExitCode, 0);</span>
<a href="#l57.43"></a><span id="l57.43" class="difflineminus">-    do_check_true(gLocalInboxFolder.msgDatabase.summaryValid);</span>
<a href="#l57.44"></a><span id="l57.44" class="difflineminus">-    do_check_eq(folderCount(gLocalInboxFolder), 0);</span>
<a href="#l57.45"></a><span id="l57.45" class="difflineplus">+    do_check_true(localAccountUtils.inboxFolder.msgDatabase.summaryValid);</span>
<a href="#l57.46"></a><span id="l57.46" class="difflineplus">+    do_check_eq(folderCount(localAccountUtils.inboxFolder), 0);</span>
<a href="#l57.47"></a><span id="l57.47">     ++gCurTestNum;</span>
<a href="#l57.48"></a><span id="l57.48">     doTest();</span>
<a href="#l57.49"></a><span id="l57.49">   }</span>
<a href="#l57.50"></a><span id="l57.50"> };</span>
<a href="#l57.51"></a><span id="l57.51"> </span>
<a href="#l57.52"></a><span id="l57.52"> function folderCount(folder)</span>
<a href="#l57.53"></a><span id="l57.53"> {</span>
<a href="#l57.54"></a><span id="l57.54">   let enumerator = folder.msgDatabase.EnumerateMessages();</span>
<a href="#l57.55"></a><span id="l57.55" class="difflineat">@@ -107,17 +107,17 @@ function folderCount(folder)</span>
<a href="#l57.56"></a><span id="l57.56">   }</span>
<a href="#l57.57"></a><span id="l57.57">   return count;</span>
<a href="#l57.58"></a><span id="l57.58"> }</span>
<a href="#l57.59"></a><span id="l57.59"> </span>
<a href="#l57.60"></a><span id="l57.60"> function run_test()</span>
<a href="#l57.61"></a><span id="l57.61"> {</span>
<a href="#l57.62"></a><span id="l57.62">   // Make sure we're not quarantining messages</span>
<a href="#l57.63"></a><span id="l57.63">   Services.prefs.setBoolPref(&quot;mailnews.downloadToTempFile&quot;, false);</span>
<a href="#l57.64"></a><span id="l57.64" class="difflineminus">-  if (!gLocalInboxFolder)</span>
<a href="#l57.65"></a><span id="l57.65" class="difflineplus">+  if (!localAccountUtils.inboxFolder)</span>
<a href="#l57.66"></a><span id="l57.66">     localAccountUtils.loadLocalMailAccount();</span>
<a href="#l57.67"></a><span id="l57.67"> </span>
<a href="#l57.68"></a><span id="l57.68">   gMoveFolder = localAccountUtils.incomingServer</span>
<a href="#l57.69"></a><span id="l57.69">                                  .rootFolder.createLocalSubfolder(&quot;MoveFolder&quot;);</span>
<a href="#l57.70"></a><span id="l57.70"> </span>
<a href="#l57.71"></a><span id="l57.71">   MailServices.mailSession.AddFolderListener(FolderListener,</span>
<a href="#l57.72"></a><span id="l57.72">                                              Ci.nsIFolderListener.event |</span>
<a href="#l57.73"></a><span id="l57.73">                                                Ci.nsIFolderListener.added |</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l58.1"></a><span id="l58.1" class="difflineminus">--- a/mailnews/local/test/unit/test_pop3MoveFilter2.js</span>
<a href="#l58.2"></a><span id="l58.2" class="difflineplus">+++ b/mailnews/local/test/unit/test_pop3MoveFilter2.js</span>
<a href="#l58.3"></a><span id="l58.3" class="difflineat">@@ -50,17 +50,17 @@ const gTestArray =</span>
<a href="#l58.4"></a><span id="l58.4">     gPOP3Pump.files = gFiles;</span>
<a href="#l58.5"></a><span id="l58.5">     gPOP3Pump.onDone = doTest;</span>
<a href="#l58.6"></a><span id="l58.6">     ++gCurTestNum;</span>
<a href="#l58.7"></a><span id="l58.7">     gPOP3Pump.run();</span>
<a href="#l58.8"></a><span id="l58.8">   },</span>
<a href="#l58.9"></a><span id="l58.9">   function verifyFolders2() {</span>
<a href="#l58.10"></a><span id="l58.10">     do_check_eq(folderCount(gMoveFolder), 1);</span>
<a href="#l58.11"></a><span id="l58.11">     // the local inbox folder should gave one message.</span>
<a href="#l58.12"></a><span id="l58.12" class="difflineminus">-    do_check_eq(folderCount(gLocalInboxFolder), 1);</span>
<a href="#l58.13"></a><span id="l58.13" class="difflineplus">+    do_check_eq(folderCount(localAccountUtils.inboxFolder), 1);</span>
<a href="#l58.14"></a><span id="l58.14">     ++gCurTestNum;</span>
<a href="#l58.15"></a><span id="l58.15">     doTest();</span>
<a href="#l58.16"></a><span id="l58.16"> </span>
<a href="#l58.17"></a><span id="l58.17">   },</span>
<a href="#l58.18"></a><span id="l58.18">   function verifyMessages() {</span>
<a href="#l58.19"></a><span id="l58.19">     let hdrs = [];</span>
<a href="#l58.20"></a><span id="l58.20">     let keys = [];</span>
<a href="#l58.21"></a><span id="l58.21">     let asyncResults = new Object;</span>
<a href="#l58.22"></a><span id="l58.22" class="difflineat">@@ -69,21 +69,22 @@ const gTestArray =</span>
<a href="#l58.23"></a><span id="l58.23">     keys.push(hdr.messageKey);</span>
<a href="#l58.24"></a><span id="l58.24">     hdrs.push(hdr);</span>
<a href="#l58.25"></a><span id="l58.25">     gMoveFolder.fetchMsgPreviewText(keys, keys.length, false, null, asyncResults);</span>
<a href="#l58.26"></a><span id="l58.26">     do_check_eq(hdrs[0].getStringProperty('preview'), bugmail10_preview);</span>
<a href="#l58.27"></a><span id="l58.27">     // check inbox message</span>
<a href="#l58.28"></a><span id="l58.28">     hdrs = [];</span>
<a href="#l58.29"></a><span id="l58.29">     keys = [];</span>
<a href="#l58.30"></a><span id="l58.30">     let asyncResults = new Object;</span>
<a href="#l58.31"></a><span id="l58.31" class="difflineminus">-    enumerator = gLocalInboxFolder.msgDatabase.EnumerateMessages();</span>
<a href="#l58.32"></a><span id="l58.32" class="difflineplus">+    enumerator = localAccountUtils.inboxFolder.msgDatabase.EnumerateMessages();</span>
<a href="#l58.33"></a><span id="l58.33">     let hdr = enumerator.getNext().QueryInterface(Ci.nsIMsgDBHdr);</span>
<a href="#l58.34"></a><span id="l58.34">     keys.push(hdr.messageKey);</span>
<a href="#l58.35"></a><span id="l58.35">     hdrs.push(hdr);</span>
<a href="#l58.36"></a><span id="l58.36" class="difflineminus">-    gLocalInboxFolder.fetchMsgPreviewText(keys, keys.length, false, null, asyncResults);</span>
<a href="#l58.37"></a><span id="l58.37" class="difflineplus">+    localAccountUtils.inboxFolder.fetchMsgPreviewText(keys, keys.length, false,</span>
<a href="#l58.38"></a><span id="l58.38" class="difflineplus">+                                                      null, asyncResults);</span>
<a href="#l58.39"></a><span id="l58.39">     do_check_eq(hdrs[0].getStringProperty('preview'), basic1_preview);</span>
<a href="#l58.40"></a><span id="l58.40">     ++gCurTestNum;</span>
<a href="#l58.41"></a><span id="l58.41">     doTest();</span>
<a href="#l58.42"></a><span id="l58.42">   },</span>
<a href="#l58.43"></a><span id="l58.43"> ];</span>
<a href="#l58.44"></a><span id="l58.44"> </span>
<a href="#l58.45"></a><span id="l58.45"> function folderCount(folder)</span>
<a href="#l58.46"></a><span id="l58.46"> {</span>
<a href="#l58.47"></a><span id="l58.47" class="difflineat">@@ -96,17 +97,17 @@ function folderCount(folder)</span>
<a href="#l58.48"></a><span id="l58.48">   }</span>
<a href="#l58.49"></a><span id="l58.49">   return count;</span>
<a href="#l58.50"></a><span id="l58.50"> }</span>
<a href="#l58.51"></a><span id="l58.51"> </span>
<a href="#l58.52"></a><span id="l58.52"> function run_test()</span>
<a href="#l58.53"></a><span id="l58.53"> {</span>
<a href="#l58.54"></a><span id="l58.54">   // Make sure we're not quarantining messages</span>
<a href="#l58.55"></a><span id="l58.55">   Services.prefs.setBoolPref(&quot;mailnews.downloadToTempFile&quot;, false);</span>
<a href="#l58.56"></a><span id="l58.56" class="difflineminus">-  if (!gLocalInboxFolder)</span>
<a href="#l58.57"></a><span id="l58.57" class="difflineplus">+  if (!localAccountUtils.inboxFolder)</span>
<a href="#l58.58"></a><span id="l58.58">     localAccountUtils.loadLocalMailAccount();</span>
<a href="#l58.59"></a><span id="l58.59"> </span>
<a href="#l58.60"></a><span id="l58.60">   gMoveFolder = localAccountUtils.incomingServer</span>
<a href="#l58.61"></a><span id="l58.61">                                  .rootFolder.createLocalSubfolder(&quot;MoveFolder&quot;);</span>
<a href="#l58.62"></a><span id="l58.62"> </span>
<a href="#l58.63"></a><span id="l58.63">   MailServices.mailSession.AddFolderListener(FolderListener,</span>
<a href="#l58.64"></a><span id="l58.64">                                              Ci.nsIFolderListener.event |</span>
<a href="#l58.65"></a><span id="l58.65">                                                Ci.nsIFolderListener.added |</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l59.1"></a><span id="l59.1" class="difflineminus">--- a/mailnews/local/test/unit/test_pop3Password.js</span>
<a href="#l59.2"></a><span id="l59.2" class="difflineplus">+++ b/mailnews/local/test/unit/test_pop3Password.js</span>
<a href="#l59.3"></a><span id="l59.3" class="difflineat">@@ -24,17 +24,18 @@ var urlListener =</span>
<a href="#l59.4"></a><span id="l59.4">   OnStartRunningUrl: function (url) {</span>
<a href="#l59.5"></a><span id="l59.5">   },</span>
<a href="#l59.6"></a><span id="l59.6">   OnStopRunningUrl: function (url, result) {</span>
<a href="#l59.7"></a><span id="l59.7">     try {</span>
<a href="#l59.8"></a><span id="l59.8">       var transaction = server.playTransaction();</span>
<a href="#l59.9"></a><span id="l59.9"> </span>
<a href="#l59.10"></a><span id="l59.10">       do_check_transaction(transaction, thisTest.transaction);</span>
<a href="#l59.11"></a><span id="l59.11"> </span>
<a href="#l59.12"></a><span id="l59.12" class="difflineminus">-      do_check_eq(gLocalInboxFolder.getTotalMessages(false), thisTest.messages.length);</span>
<a href="#l59.13"></a><span id="l59.13" class="difflineplus">+      do_check_eq(localAccountUtils.inboxFolder.getTotalMessages(false),</span>
<a href="#l59.14"></a><span id="l59.14" class="difflineplus">+                  thisTest.messages.length);</span>
<a href="#l59.15"></a><span id="l59.15"> </span>
<a href="#l59.16"></a><span id="l59.16">       do_check_eq(result, 0);</span>
<a href="#l59.17"></a><span id="l59.17">     }</span>
<a href="#l59.18"></a><span id="l59.18">     catch (e) {</span>
<a href="#l59.19"></a><span id="l59.19">       // If we have an error, clean up nicely before we throw it.</span>
<a href="#l59.20"></a><span id="l59.20">       server.stop();</span>
<a href="#l59.21"></a><span id="l59.21"> </span>
<a href="#l59.22"></a><span id="l59.22">       var thread = gThreadManager.currentThread;</span>
<a href="#l59.23"></a><span id="l59.23" class="difflineat">@@ -90,17 +91,17 @@ function testNext() {</span>
<a href="#l59.24"></a><span id="l59.24">     else</span>
<a href="#l59.25"></a><span id="l59.25">       server.resetTest();</span>
<a href="#l59.26"></a><span id="l59.26"> </span>
<a href="#l59.27"></a><span id="l59.27">     // Set up the test</span>
<a href="#l59.28"></a><span id="l59.28">     test = thisTest.title;</span>
<a href="#l59.29"></a><span id="l59.29">     daemon.setMessages(thisTest.messages);</span>
<a href="#l59.30"></a><span id="l59.30"> </span>
<a href="#l59.31"></a><span id="l59.31">     // Now get the mail</span>
<a href="#l59.32"></a><span id="l59.32" class="difflineminus">-    MailServices.pop3.GetNewMail(null, urlListener, gLocalInboxFolder,</span>
<a href="#l59.33"></a><span id="l59.33" class="difflineplus">+    MailServices.pop3.GetNewMail(null, urlListener, localAccountUtils.inboxFolder,</span>
<a href="#l59.34"></a><span id="l59.34">                                  incomingServer);</span>
<a href="#l59.35"></a><span id="l59.35"> </span>
<a href="#l59.36"></a><span id="l59.36">     server.performTest();</span>
<a href="#l59.37"></a><span id="l59.37">   } catch (e) {</span>
<a href="#l59.38"></a><span id="l59.38">     server.stop();</span>
<a href="#l59.39"></a><span id="l59.39"> </span>
<a href="#l59.40"></a><span id="l59.40">     do_throw(e);</span>
<a href="#l59.41"></a><span id="l59.41">   } finally {</span>
<a href="#l59.42"></a><span id="l59.42" class="difflineat">@@ -140,14 +141,14 @@ function run_test() {</span>
<a href="#l59.43"></a><span id="l59.43">   localAccountUtils.loadLocalMailAccount();</span>
<a href="#l59.44"></a><span id="l59.44"> </span>
<a href="#l59.45"></a><span id="l59.45">   incomingServer = MailServices.accounts.createIncomingServer(&quot;testpop3&quot;, &quot;localhost&quot;, &quot;pop3&quot;);</span>
<a href="#l59.46"></a><span id="l59.46"> </span>
<a href="#l59.47"></a><span id="l59.47">   incomingServer.port = POP3_PORT;</span>
<a href="#l59.48"></a><span id="l59.48"> </span>
<a href="#l59.49"></a><span id="l59.49">   // Check that we haven't got any messages in the folder, if we have its a test</span>
<a href="#l59.50"></a><span id="l59.50">   // setup issue.</span>
<a href="#l59.51"></a><span id="l59.51" class="difflineminus">-  do_check_eq(gLocalInboxFolder.getTotalMessages(false), 0);</span>
<a href="#l59.52"></a><span id="l59.52" class="difflineplus">+  do_check_eq(localAccountUtils.inboxFolder.getTotalMessages(false), 0);</span>
<a href="#l59.53"></a><span id="l59.53"> </span>
<a href="#l59.54"></a><span id="l59.54">   do_test_pending();</span>
<a href="#l59.55"></a><span id="l59.55"> </span>
<a href="#l59.56"></a><span id="l59.56">   testNext();</span>
<a href="#l59.57"></a><span id="l59.57"> }</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l60.1"></a><span id="l60.1" class="difflineminus">--- a/mailnews/local/test/unit/test_pop3Password2.js</span>
<a href="#l60.2"></a><span id="l60.2" class="difflineplus">+++ b/mailnews/local/test/unit/test_pop3Password2.js</span>
<a href="#l60.3"></a><span id="l60.3" class="difflineat">@@ -26,17 +26,18 @@ var urlListener =</span>
<a href="#l60.4"></a><span id="l60.4">   OnStartRunningUrl: function (url) {</span>
<a href="#l60.5"></a><span id="l60.5">   },</span>
<a href="#l60.6"></a><span id="l60.6">   OnStopRunningUrl: function (url, result) {</span>
<a href="#l60.7"></a><span id="l60.7">     try {</span>
<a href="#l60.8"></a><span id="l60.8">       var transaction = server.playTransaction();</span>
<a href="#l60.9"></a><span id="l60.9"> </span>
<a href="#l60.10"></a><span id="l60.10">       do_check_transaction(transaction, thisTest.transaction);</span>
<a href="#l60.11"></a><span id="l60.11"> </span>
<a href="#l60.12"></a><span id="l60.12" class="difflineminus">-      do_check_eq(gLocalInboxFolder.getTotalMessages(false), thisTest.messages.length);</span>
<a href="#l60.13"></a><span id="l60.13" class="difflineplus">+      do_check_eq(localAccountUtils.inboxFolder.getTotalMessages(false),</span>
<a href="#l60.14"></a><span id="l60.14" class="difflineplus">+                  thisTest.messages.length);</span>
<a href="#l60.15"></a><span id="l60.15"> </span>
<a href="#l60.16"></a><span id="l60.16">       do_check_eq(result, 0);</span>
<a href="#l60.17"></a><span id="l60.17">     }</span>
<a href="#l60.18"></a><span id="l60.18">     catch (e) {</span>
<a href="#l60.19"></a><span id="l60.19">       // If we have an error, clean up nicely before we throw it.</span>
<a href="#l60.20"></a><span id="l60.20">       server.stop();</span>
<a href="#l60.21"></a><span id="l60.21"> </span>
<a href="#l60.22"></a><span id="l60.22">       var thread = gThreadManager.currentThread;</span>
<a href="#l60.23"></a><span id="l60.23" class="difflineat">@@ -92,17 +93,17 @@ function testNext() {</span>
<a href="#l60.24"></a><span id="l60.24">     else</span>
<a href="#l60.25"></a><span id="l60.25">       server.resetTest();</span>
<a href="#l60.26"></a><span id="l60.26"> </span>
<a href="#l60.27"></a><span id="l60.27">     // Set up the test</span>
<a href="#l60.28"></a><span id="l60.28">     test = thisTest.title;</span>
<a href="#l60.29"></a><span id="l60.29">     daemon.setMessages(thisTest.messages);</span>
<a href="#l60.30"></a><span id="l60.30"> </span>
<a href="#l60.31"></a><span id="l60.31">     // Now get the mail</span>
<a href="#l60.32"></a><span id="l60.32" class="difflineminus">-    MailServices.pop3.GetNewMail(null, urlListener, gLocalInboxFolder,</span>
<a href="#l60.33"></a><span id="l60.33" class="difflineplus">+    MailServices.pop3.GetNewMail(null, urlListener, localAccountUtils.inboxFolder,</span>
<a href="#l60.34"></a><span id="l60.34">                                  incomingServer);</span>
<a href="#l60.35"></a><span id="l60.35"> </span>
<a href="#l60.36"></a><span id="l60.36">     server.performTest();</span>
<a href="#l60.37"></a><span id="l60.37">   } catch (e) {</span>
<a href="#l60.38"></a><span id="l60.38">     server.stop();</span>
<a href="#l60.39"></a><span id="l60.39"> </span>
<a href="#l60.40"></a><span id="l60.40">     do_throw(e);</span>
<a href="#l60.41"></a><span id="l60.41">   } finally {</span>
<a href="#l60.42"></a><span id="l60.42" class="difflineat">@@ -166,23 +167,23 @@ function run_test() {</span>
<a href="#l60.43"></a><span id="l60.43"> </span>
<a href="#l60.44"></a><span id="l60.44">   localAccountUtils.incomingServer = MailServices.accounts.localFoldersServer;</span>
<a href="#l60.45"></a><span id="l60.45"> </span>
<a href="#l60.46"></a><span id="l60.46">   var rootFolder = localAccountUtils.incomingServer</span>
<a href="#l60.47"></a><span id="l60.47">                                     .rootMsgFolder.QueryInterface(Ci.nsIMsgLocalMailFolder);</span>
<a href="#l60.48"></a><span id="l60.48"> </span>
<a href="#l60.49"></a><span id="l60.49">   // Note: Inbox is not created automatically when there is no deferred server,</span>
<a href="#l60.50"></a><span id="l60.50">   // so we need to create it.</span>
<a href="#l60.51"></a><span id="l60.51" class="difflineminus">-  gLocalInboxFolder = rootFolder.createLocalSubfolder(&quot;Inbox&quot;);</span>
<a href="#l60.52"></a><span id="l60.52" class="difflineplus">+  localAccountUtils.inboxFolder = rootFolder.createLocalSubfolder(&quot;Inbox&quot;);</span>
<a href="#l60.53"></a><span id="l60.53">   // a local inbox should have a Mail flag!</span>
<a href="#l60.54"></a><span id="l60.54" class="difflineminus">-  gLocalInboxFolder.setFlag(Ci.nsMsgFolderFlags.Mail);</span>
<a href="#l60.55"></a><span id="l60.55" class="difflineplus">+  localAccountUtils.inboxFolder.setFlag(Ci.nsMsgFolderFlags.Mail);</span>
<a href="#l60.56"></a><span id="l60.56"> </span>
<a href="#l60.57"></a><span id="l60.57">   // Create the incoming server with &quot;original&quot; details.</span>
<a href="#l60.58"></a><span id="l60.58">   incomingServer = MailServices.accounts.getIncomingServer(&quot;server2&quot;);</span>
<a href="#l60.59"></a><span id="l60.59"> </span>
<a href="#l60.60"></a><span id="l60.60">   // Check that we haven't got any messages in the folder, if we have its a test</span>
<a href="#l60.61"></a><span id="l60.61">   // setup issue.</span>
<a href="#l60.62"></a><span id="l60.62" class="difflineminus">-  do_check_eq(gLocalInboxFolder.getTotalMessages(false), 0);</span>
<a href="#l60.63"></a><span id="l60.63" class="difflineplus">+  do_check_eq(localAccountUtils.inboxFolder.getTotalMessages(false), 0);</span>
<a href="#l60.64"></a><span id="l60.64"> </span>
<a href="#l60.65"></a><span id="l60.65">   do_test_pending();</span>
<a href="#l60.66"></a><span id="l60.66"> </span>
<a href="#l60.67"></a><span id="l60.67">   testNext();</span>
<a href="#l60.68"></a><span id="l60.68"> }</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l61.1"></a><span id="l61.1" class="difflineminus">--- a/mailnews/local/test/unit/test_pop3PasswordFailure.js</span>
<a href="#l61.2"></a><span id="l61.2" class="difflineplus">+++ b/mailnews/local/test/unit/test_pop3PasswordFailure.js</span>
<a href="#l61.3"></a><span id="l61.3" class="difflineat">@@ -66,33 +66,33 @@ function promptPasswordPS(aParent, aDial</span>
<a href="#l61.4"></a><span id="l61.4">     aPassword.value = kValidPassword;</span>
<a href="#l61.5"></a><span id="l61.5">     aCheckState.value = true;</span>
<a href="#l61.6"></a><span id="l61.6">     return true;</span>
<a href="#l61.7"></a><span id="l61.7">   }</span>
<a href="#l61.8"></a><span id="l61.8">   return false;</span>
<a href="#l61.9"></a><span id="l61.9"> }</span>
<a href="#l61.10"></a><span id="l61.10"> </span>
<a href="#l61.11"></a><span id="l61.11"> function getPopMail() {</span>
<a href="#l61.12"></a><span id="l61.12" class="difflineminus">-  MailServices.pop3.GetNewMail(gDummyMsgWindow, urlListener, gLocalInboxFolder,</span>
<a href="#l61.13"></a><span id="l61.13" class="difflineplus">+  MailServices.pop3.GetNewMail(gDummyMsgWindow, urlListener, localAccountUtils.inboxFolder,</span>
<a href="#l61.14"></a><span id="l61.14">                                incomingServer);</span>
<a href="#l61.15"></a><span id="l61.15"> </span>
<a href="#l61.16"></a><span id="l61.16">   server.performTest();</span>
<a href="#l61.17"></a><span id="l61.17">   return false;</span>
<a href="#l61.18"></a><span id="l61.18"> }</span>
<a href="#l61.19"></a><span id="l61.19"> </span>
<a href="#l61.20"></a><span id="l61.20"> var urlListener =</span>
<a href="#l61.21"></a><span id="l61.21"> {</span>
<a href="#l61.22"></a><span id="l61.22">   OnStartRunningUrl: function (url) {</span>
<a href="#l61.23"></a><span id="l61.23">   },</span>
<a href="#l61.24"></a><span id="l61.24">   OnStopRunningUrl: function (url, result) {</span>
<a href="#l61.25"></a><span id="l61.25">     try {</span>
<a href="#l61.26"></a><span id="l61.26">       var transaction = server.playTransaction();</span>
<a href="#l61.27"></a><span id="l61.27"> </span>
<a href="#l61.28"></a><span id="l61.28">       // On the last attempt, we should have successfully got one mail.</span>
<a href="#l61.29"></a><span id="l61.29" class="difflineminus">-      do_check_eq(gLocalInboxFolder.getTotalMessages(false),</span>
<a href="#l61.30"></a><span id="l61.30" class="difflineplus">+      do_check_eq(localAccountUtils.inboxFolder.getTotalMessages(false),</span>
<a href="#l61.31"></a><span id="l61.31">                   attempt == 4 ? 1 : 0);</span>
<a href="#l61.32"></a><span id="l61.32"> </span>
<a href="#l61.33"></a><span id="l61.33">       // If we've just cancelled, expect binding aborted rather than success.</span>
<a href="#l61.34"></a><span id="l61.34">       do_check_eq(result, attempt == 2 ? Cr.NS_BINDING_ABORTED : 0);</span>
<a href="#l61.35"></a><span id="l61.35">     }</span>
<a href="#l61.36"></a><span id="l61.36">     catch (e) {</span>
<a href="#l61.37"></a><span id="l61.37">       // If we have an error, clean up nicely before we throw it.</span>
<a href="#l61.38"></a><span id="l61.38">       server.stop();</span>
<a href="#l61.39"></a><span id="l61.39" class="difflineat">@@ -182,14 +182,14 @@ function run_test()</span>
<a href="#l61.40"></a><span id="l61.40">   localAccountUtils.loadLocalMailAccount();</span>
<a href="#l61.41"></a><span id="l61.41"> </span>
<a href="#l61.42"></a><span id="l61.42">   incomingServer = MailServices.accounts.createIncomingServer(kUserName, &quot;localhost&quot;, &quot;pop3&quot;);</span>
<a href="#l61.43"></a><span id="l61.43"> </span>
<a href="#l61.44"></a><span id="l61.44">   incomingServer.port = POP3_PORT;</span>
<a href="#l61.45"></a><span id="l61.45"> </span>
<a href="#l61.46"></a><span id="l61.46">   // Check that we haven't got any messages in the folder, if we have its a test</span>
<a href="#l61.47"></a><span id="l61.47">   // setup issue.</span>
<a href="#l61.48"></a><span id="l61.48" class="difflineminus">-  do_check_eq(gLocalInboxFolder.getTotalMessages(false), 0);</span>
<a href="#l61.49"></a><span id="l61.49" class="difflineplus">+  do_check_eq(localAccountUtils.inboxFolder.getTotalMessages(false), 0);</span>
<a href="#l61.50"></a><span id="l61.50"> </span>
<a href="#l61.51"></a><span id="l61.51">   do_test_pending();</span>
<a href="#l61.52"></a><span id="l61.52"> </span>
<a href="#l61.53"></a><span id="l61.53">   actually_run_test();</span>
<a href="#l61.54"></a><span id="l61.54"> }</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l62.1"></a><span id="l62.1" class="difflineminus">--- a/mailnews/local/test/unit/test_pop3PasswordFailure2.js</span>
<a href="#l62.2"></a><span id="l62.2" class="difflineplus">+++ b/mailnews/local/test/unit/test_pop3PasswordFailure2.js</span>
<a href="#l62.3"></a><span id="l62.3" class="difflineat">@@ -69,28 +69,28 @@ function promptPasswordPS(aParent, aDial</span>
<a href="#l62.4"></a><span id="l62.4">     aPassword.value = kValidPassword;</span>
<a href="#l62.5"></a><span id="l62.5">     aCheckState.value = true;</span>
<a href="#l62.6"></a><span id="l62.6">     return true;</span>
<a href="#l62.7"></a><span id="l62.7">   }</span>
<a href="#l62.8"></a><span id="l62.8">   return false;</span>
<a href="#l62.9"></a><span id="l62.9"> }</span>
<a href="#l62.10"></a><span id="l62.10"> </span>
<a href="#l62.11"></a><span id="l62.11"> function getPopMail() {</span>
<a href="#l62.12"></a><span id="l62.12" class="difflineminus">-  MailServices.pop3.GetNewMail(gDummyMsgWindow, urlListener, gLocalInboxFolder,</span>
<a href="#l62.13"></a><span id="l62.13" class="difflineplus">+  MailServices.pop3.GetNewMail(gDummyMsgWindow, urlListener, localAccountUtils.inboxFolder,</span>
<a href="#l62.14"></a><span id="l62.14">                                incomingServer);</span>
<a href="#l62.15"></a><span id="l62.15"> }</span>
<a href="#l62.16"></a><span id="l62.16"> </span>
<a href="#l62.17"></a><span id="l62.17"> var urlListener =</span>
<a href="#l62.18"></a><span id="l62.18"> {</span>
<a href="#l62.19"></a><span id="l62.19">   OnStartRunningUrl: function (url) {</span>
<a href="#l62.20"></a><span id="l62.20">   },</span>
<a href="#l62.21"></a><span id="l62.21">   OnStopRunningUrl: function (url, result) {</span>
<a href="#l62.22"></a><span id="l62.22">     try {</span>
<a href="#l62.23"></a><span id="l62.23">       // On the last attempt, we should have successfully got one mail.</span>
<a href="#l62.24"></a><span id="l62.24" class="difflineminus">-      do_check_eq(gLocalInboxFolder.getTotalMessages(false),</span>
<a href="#l62.25"></a><span id="l62.25" class="difflineplus">+      do_check_eq(localAccountUtils.inboxFolder.getTotalMessages(false),</span>
<a href="#l62.26"></a><span id="l62.26">                   attempt == 4 ? 1 : 0);</span>
<a href="#l62.27"></a><span id="l62.27"> </span>
<a href="#l62.28"></a><span id="l62.28">       // If we've just cancelled, expect failure rather than success</span>
<a href="#l62.29"></a><span id="l62.29">       // because the server dropped the connection.</span>
<a href="#l62.30"></a><span id="l62.30">       dump(&quot;in onStopRunning, result = &quot; + result + &quot;\n&quot;);</span>
<a href="#l62.31"></a><span id="l62.31">       do_check_eq(result, attempt == 2 ? Cr.NS_ERROR_FAILURE : 0);</span>
<a href="#l62.32"></a><span id="l62.32">       async_driver();</span>
<a href="#l62.33"></a><span id="l62.33">     }</span>
<a href="#l62.34"></a><span id="l62.34" class="difflineat">@@ -200,12 +200,12 @@ function run_test()</span>
<a href="#l62.35"></a><span id="l62.35">   localAccountUtils.loadLocalMailAccount();</span>
<a href="#l62.36"></a><span id="l62.36"> </span>
<a href="#l62.37"></a><span id="l62.37">   incomingServer = MailServices.accounts</span>
<a href="#l62.38"></a><span id="l62.38">                     .createIncomingServer(kUserName, &quot;localhost&quot;, &quot;pop3&quot;);</span>
<a href="#l62.39"></a><span id="l62.39">   incomingServer.port = POP3_PORT;</span>
<a href="#l62.40"></a><span id="l62.40"> </span>
<a href="#l62.41"></a><span id="l62.41">   // Check that we haven't got any messages in the folder, if we have its a test</span>
<a href="#l62.42"></a><span id="l62.42">   // setup issue.</span>
<a href="#l62.43"></a><span id="l62.43" class="difflineminus">-  do_check_eq(gLocalInboxFolder.getTotalMessages(false), 0);</span>
<a href="#l62.44"></a><span id="l62.44" class="difflineplus">+  do_check_eq(localAccountUtils.inboxFolder.getTotalMessages(false), 0);</span>
<a href="#l62.45"></a><span id="l62.45"> </span>
<a href="#l62.46"></a><span id="l62.46">   actually_run_test();</span>
<a href="#l62.47"></a><span id="l62.47"> }</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l63.1"></a><span id="l63.1" class="difflineminus">--- a/mailnews/local/test/unit/test_pop3PasswordFailure3.js</span>
<a href="#l63.2"></a><span id="l63.2" class="difflineplus">+++ b/mailnews/local/test/unit/test_pop3PasswordFailure3.js</span>
<a href="#l63.3"></a><span id="l63.3" class="difflineat">@@ -71,28 +71,28 @@ function promptPasswordPS(aParent, aDial</span>
<a href="#l63.4"></a><span id="l63.4">     aPassword.value = kValidPassword;</span>
<a href="#l63.5"></a><span id="l63.5">     aCheckState.value = true;</span>
<a href="#l63.6"></a><span id="l63.6">     return true;</span>
<a href="#l63.7"></a><span id="l63.7">   }</span>
<a href="#l63.8"></a><span id="l63.8">   return false;</span>
<a href="#l63.9"></a><span id="l63.9"> }</span>
<a href="#l63.10"></a><span id="l63.10"> </span>
<a href="#l63.11"></a><span id="l63.11"> function getPopMail() {</span>
<a href="#l63.12"></a><span id="l63.12" class="difflineminus">-  MailServices.pop3.GetNewMail(gDummyMsgWindow, urlListener, gLocalInboxFolder,</span>
<a href="#l63.13"></a><span id="l63.13" class="difflineplus">+  MailServices.pop3.GetNewMail(gDummyMsgWindow, urlListener, localAccountUtils.inboxFolder,</span>
<a href="#l63.14"></a><span id="l63.14">                                incomingServer);</span>
<a href="#l63.15"></a><span id="l63.15"> }</span>
<a href="#l63.16"></a><span id="l63.16"> </span>
<a href="#l63.17"></a><span id="l63.17"> var urlListener =</span>
<a href="#l63.18"></a><span id="l63.18"> {</span>
<a href="#l63.19"></a><span id="l63.19">   OnStartRunningUrl: function (url) {</span>
<a href="#l63.20"></a><span id="l63.20">   },</span>
<a href="#l63.21"></a><span id="l63.21">   OnStopRunningUrl: function (url, result) {</span>
<a href="#l63.22"></a><span id="l63.22">     try {</span>
<a href="#l63.23"></a><span id="l63.23">       // On the last attempt, we should have successfully got one mail.</span>
<a href="#l63.24"></a><span id="l63.24" class="difflineminus">-      do_check_eq(gLocalInboxFolder.getTotalMessages(false),</span>
<a href="#l63.25"></a><span id="l63.25" class="difflineplus">+      do_check_eq(localAccountUtils.inboxFolder.getTotalMessages(false),</span>
<a href="#l63.26"></a><span id="l63.26">                   attempt == 4 ? 1 : 0);</span>
<a href="#l63.27"></a><span id="l63.27"> </span>
<a href="#l63.28"></a><span id="l63.28">       // If we've just cancelled, expect failure rather than success</span>
<a href="#l63.29"></a><span id="l63.29">       // because the server dropped the connection.</span>
<a href="#l63.30"></a><span id="l63.30">       dump(&quot;in onStopRunning, result = &quot; + result + &quot;\n&quot;);</span>
<a href="#l63.31"></a><span id="l63.31">       do_check_eq(result, attempt == 2 ? Cr.NS_ERROR_FAILURE : 0);</span>
<a href="#l63.32"></a><span id="l63.32">       async_driver();</span>
<a href="#l63.33"></a><span id="l63.33">     }</span>
<a href="#l63.34"></a><span id="l63.34" class="difflineat">@@ -202,12 +202,12 @@ function run_test()</span>
<a href="#l63.35"></a><span id="l63.35">   localAccountUtils.loadLocalMailAccount();</span>
<a href="#l63.36"></a><span id="l63.36"> </span>
<a href="#l63.37"></a><span id="l63.37">   incomingServer = MailServices.accounts</span>
<a href="#l63.38"></a><span id="l63.38">                     .createIncomingServer(kUserName, &quot;localhost&quot;, &quot;pop3&quot;);</span>
<a href="#l63.39"></a><span id="l63.39">   incomingServer.port = POP3_PORT;</span>
<a href="#l63.40"></a><span id="l63.40"> </span>
<a href="#l63.41"></a><span id="l63.41">   // Check that we haven't got any messages in the folder, if we have its a test</span>
<a href="#l63.42"></a><span id="l63.42">   // setup issue.</span>
<a href="#l63.43"></a><span id="l63.43" class="difflineminus">-  do_check_eq(gLocalInboxFolder.getTotalMessages(false), 0);</span>
<a href="#l63.44"></a><span id="l63.44" class="difflineplus">+  do_check_eq(localAccountUtils.inboxFolder.getTotalMessages(false), 0);</span>
<a href="#l63.45"></a><span id="l63.45"> </span>
<a href="#l63.46"></a><span id="l63.46">   actually_run_test();</span>
<a href="#l63.47"></a><span id="l63.47"> }</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l64.1"></a><span id="l64.1" class="difflineminus">--- a/mailnews/local/test/unit/test_pop3Pump.js</span>
<a href="#l64.2"></a><span id="l64.2" class="difflineplus">+++ b/mailnews/local/test/unit/test_pop3Pump.js</span>
<a href="#l64.3"></a><span id="l64.3" class="difflineat">@@ -5,31 +5,31 @@</span>
<a href="#l64.4"></a><span id="l64.4"> load(&quot;../../../resources/POP3pump.js&quot;);</span>
<a href="#l64.5"></a><span id="l64.5"> </span>
<a href="#l64.6"></a><span id="l64.6"> var testSubjects = [&quot;[Bug 397009] A filter will let me tag, but not untag&quot;,</span>
<a href="#l64.7"></a><span id="l64.7">                     &quot;Hello, did you receive my bugmail?&quot;];</span>
<a href="#l64.8"></a><span id="l64.8"> </span>
<a href="#l64.9"></a><span id="l64.9"> function run_test()</span>
<a href="#l64.10"></a><span id="l64.10"> {</span>
<a href="#l64.11"></a><span id="l64.11">   // demonstration of access to the local inbox folder</span>
<a href="#l64.12"></a><span id="l64.12" class="difflineminus">-  dump(&quot;local inbox folder &quot; + gLocalInboxFolder.URI + &quot; is loaded\n&quot;);</span>
<a href="#l64.13"></a><span id="l64.13" class="difflineplus">+  dump(&quot;local inbox folder &quot; + localAccountUtils.inboxFolder.URI + &quot; is loaded\n&quot;);</span>
<a href="#l64.14"></a><span id="l64.14">   // demonstration of access to the fake server</span>
<a href="#l64.15"></a><span id="l64.15">   dump(&quot;Server &quot; + gPOP3Pump.fakeServer.prettyName + &quot; is loaded\n&quot;);</span>
<a href="#l64.16"></a><span id="l64.16"> </span>
<a href="#l64.17"></a><span id="l64.17">   gPOP3Pump.files = [&quot;../../../data/bugmail1&quot;,</span>
<a href="#l64.18"></a><span id="l64.18">                       &quot;../../../data/draft1&quot;];</span>
<a href="#l64.19"></a><span id="l64.19">   gPOP3Pump.onDone = continueTest;</span>
<a href="#l64.20"></a><span id="l64.20">   do_test_pending();</span>
<a href="#l64.21"></a><span id="l64.21">   gPOP3Pump.run();</span>
<a href="#l64.22"></a><span id="l64.22"> }</span>
<a href="#l64.23"></a><span id="l64.23"> </span>
<a href="#l64.24"></a><span id="l64.24"> function continueTest()</span>
<a href="#l64.25"></a><span id="l64.25"> {</span>
<a href="#l64.26"></a><span id="l64.26">   // get message headers for the inbox folder</span>
<a href="#l64.27"></a><span id="l64.27" class="difflineminus">-  let enumerator = gLocalInboxFolder.msgDatabase.EnumerateMessages();</span>
<a href="#l64.28"></a><span id="l64.28" class="difflineplus">+  let enumerator = localAccountUtils.inboxFolder.msgDatabase.EnumerateMessages();</span>
<a href="#l64.29"></a><span id="l64.29">   var msgCount = 0;</span>
<a href="#l64.30"></a><span id="l64.30">   while(enumerator.hasMoreElements())</span>
<a href="#l64.31"></a><span id="l64.31">   {</span>
<a href="#l64.32"></a><span id="l64.32">     msgCount++;</span>
<a href="#l64.33"></a><span id="l64.33">     let hdr = enumerator.getNext().QueryInterface(Ci.nsIMsgDBHdr);</span>
<a href="#l64.34"></a><span id="l64.34">     do_check_eq(hdr.subject, testSubjects[msgCount - 1]);</span>
<a href="#l64.35"></a><span id="l64.35">   }</span>
<a href="#l64.36"></a><span id="l64.36">   do_check_eq(msgCount, 2);</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l65.1"></a><span id="l65.1" class="difflineminus">--- a/mailnews/local/test/unit/test_pop3ServerBrokenCRAMDisconnect.js</span>
<a href="#l65.2"></a><span id="l65.2" class="difflineplus">+++ b/mailnews/local/test/unit/test_pop3ServerBrokenCRAMDisconnect.js</span>
<a href="#l65.3"></a><span id="l65.3" class="difflineat">@@ -105,17 +105,17 @@ function run_test() {</span>
<a href="#l65.4"></a><span id="l65.4">     incomingServer = createPop3ServerAndLocalFolders();</span>
<a href="#l65.5"></a><span id="l65.5">     let msgServer = incomingServer;</span>
<a href="#l65.6"></a><span id="l65.6">     msgServer.QueryInterface(Ci.nsIMsgIncomingServer);</span>
<a href="#l65.7"></a><span id="l65.7">     // Need to allow any auth here, although that's not use in TB really,</span>
<a href="#l65.8"></a><span id="l65.8">     // because we need to fall back to something after CRAM-MD5 and</span>
<a href="#l65.9"></a><span id="l65.9">     // check that login works after we fell back.</span>
<a href="#l65.10"></a><span id="l65.10">     msgServer.authMethod = Ci.nsMsgAuthMethod.anything;</span>
<a href="#l65.11"></a><span id="l65.11"> </span>
<a href="#l65.12"></a><span id="l65.12" class="difflineminus">-    MailServices.pop3.GetNewMail(null, urlListener, gLocalInboxFolder,</span>
<a href="#l65.13"></a><span id="l65.13" class="difflineplus">+    MailServices.pop3.GetNewMail(null, urlListener, localAccountUtils.inboxFolder,</span>
<a href="#l65.14"></a><span id="l65.14">                                  incomingServer);</span>
<a href="#l65.15"></a><span id="l65.15">     server.performTest();</span>
<a href="#l65.16"></a><span id="l65.16">   } catch (e) {</span>
<a href="#l65.17"></a><span id="l65.17">     server.stop();</span>
<a href="#l65.18"></a><span id="l65.18"> </span>
<a href="#l65.19"></a><span id="l65.19">     do_throw(e);</span>
<a href="#l65.20"></a><span id="l65.20">   } finally {</span>
<a href="#l65.21"></a><span id="l65.21">     var thread = gThreadManager.currentThread;</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l66.1"></a><span id="l66.1" class="difflineminus">--- a/mailnews/local/test/unit/test_pop3ServerBrokenCRAMFail.js</span>
<a href="#l66.2"></a><span id="l66.2" class="difflineplus">+++ b/mailnews/local/test/unit/test_pop3ServerBrokenCRAMFail.js</span>
<a href="#l66.3"></a><span id="l66.3" class="difflineat">@@ -96,17 +96,17 @@ function run_test() {</span>
<a href="#l66.4"></a><span id="l66.4">     incomingServer = createPop3ServerAndLocalFolders();</span>
<a href="#l66.5"></a><span id="l66.5">     let msgServer = incomingServer;</span>
<a href="#l66.6"></a><span id="l66.6">     msgServer.QueryInterface(Ci.nsIMsgIncomingServer);</span>
<a href="#l66.7"></a><span id="l66.7">     // Need to allow any auth here, although that's not use in TB really,</span>
<a href="#l66.8"></a><span id="l66.8">     // because we need to fall back to something after CRAM-MD5 and</span>
<a href="#l66.9"></a><span id="l66.9">     // check that login works after we fell back.</span>
<a href="#l66.10"></a><span id="l66.10">     msgServer.authMethod = Ci.nsMsgAuthMethod.anything;</span>
<a href="#l66.11"></a><span id="l66.11"> </span>
<a href="#l66.12"></a><span id="l66.12" class="difflineminus">-    MailServices.pop3.GetNewMail(null, urlListener, gLocalInboxFolder,</span>
<a href="#l66.13"></a><span id="l66.13" class="difflineplus">+    MailServices.pop3.GetNewMail(null, urlListener, localAccountUtils.inboxFolder,</span>
<a href="#l66.14"></a><span id="l66.14">                                  incomingServer);</span>
<a href="#l66.15"></a><span id="l66.15">     server.performTest();</span>
<a href="#l66.16"></a><span id="l66.16">   } catch (e) {</span>
<a href="#l66.17"></a><span id="l66.17">     server.stop();</span>
<a href="#l66.18"></a><span id="l66.18"> </span>
<a href="#l66.19"></a><span id="l66.19">     do_throw(e);</span>
<a href="#l66.20"></a><span id="l66.20">   } finally {</span>
<a href="#l66.21"></a><span id="l66.21">     var thread = gThreadManager.currentThread;</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l67.1"></a><span id="l67.1" class="difflineminus">--- a/mailnews/local/test/unit/test_preview.js</span>
<a href="#l67.2"></a><span id="l67.2" class="difflineplus">+++ b/mailnews/local/test/unit/test_preview.js</span>
<a href="#l67.3"></a><span id="l67.3" class="difflineat">@@ -12,17 +12,17 @@ function copy_next_message(aMessageHeade</span>
<a href="#l67.4"></a><span id="l67.4">   copyFileMessageInLocalFolder(bugmail11, 0, &quot;&quot;, null, test_preview);</span>
<a href="#l67.5"></a><span id="l67.5"> }</span>
<a href="#l67.6"></a><span id="l67.6"> </span>
<a href="#l67.7"></a><span id="l67.7"> function test_preview(aMessageHeaderKeys, aStatus) {</span>
<a href="#l67.8"></a><span id="l67.8">   let headerKeys = aMessageHeaderKeys;</span>
<a href="#l67.9"></a><span id="l67.9">   do_check_neq(headerKeys, null);</span>
<a href="#l67.10"></a><span id="l67.10">   do_check_eq(headerKeys.length, 2);</span>
<a href="#l67.11"></a><span id="l67.11">   try {</span>
<a href="#l67.12"></a><span id="l67.12" class="difflineminus">-    gLocalInboxFolder.fetchMsgPreviewText(headerKeys,</span>
<a href="#l67.13"></a><span id="l67.13" class="difflineplus">+    localAccountUtils.inboxFolder.fetchMsgPreviewText(headerKeys,</span>
<a href="#l67.14"></a><span id="l67.14">                                           headerKeys.length, false, null);</span>
<a href="#l67.15"></a><span id="l67.15" class="difflineminus">-    do_check_eq(gLocalInboxFolder.GetMessageHeader(headerKeys[0]).getStringProperty('preview'),</span>
<a href="#l67.16"></a><span id="l67.16" class="difflineplus">+    do_check_eq(localAccountUtils.inboxFolder.GetMessageHeader(headerKeys[0]).getStringProperty('preview'),</span>
<a href="#l67.17"></a><span id="l67.17">                 bugmail10_preview);</span>
<a href="#l67.18"></a><span id="l67.18" class="difflineminus">-    do_check_eq(gLocalInboxFolder.GetMessageHeader(headerKeys[1]).getStringProperty('preview'),</span>
<a href="#l67.19"></a><span id="l67.19" class="difflineplus">+    do_check_eq(localAccountUtils.inboxFolder.GetMessageHeader(headerKeys[1]).getStringProperty('preview'),</span>
<a href="#l67.20"></a><span id="l67.20">                 bugmail11_preview);</span>
<a href="#l67.21"></a><span id="l67.21">   } catch(ex) {dump(ex); do_throw(ex) }</span>
<a href="#l67.22"></a><span id="l67.22">   do_test_finished();</span>
<a href="#l67.23"></a><span id="l67.23"> }</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l68.1"></a><span id="l68.1" class="difflineminus">--- a/mailnews/local/test/unit/test_saveMessage.js</span>
<a href="#l68.2"></a><span id="l68.2" class="difflineplus">+++ b/mailnews/local/test/unit/test_saveMessage.js</span>
<a href="#l68.3"></a><span id="l68.3" class="difflineat">@@ -20,18 +20,18 @@ function run_test()</span>
<a href="#l68.4"></a><span id="l68.4">   });</span>
<a href="#l68.5"></a><span id="l68.5">   copyFileMessageInLocalFolder(dot, 0, &quot;&quot;, null, save_message);</span>
<a href="#l68.6"></a><span id="l68.6"> }</span>
<a href="#l68.7"></a><span id="l68.7"> </span>
<a href="#l68.8"></a><span id="l68.8"> function save_message(aMessageHeaderKeys, aStatus) {</span>
<a href="#l68.9"></a><span id="l68.9">   let headerKeys = aMessageHeaderKeys;</span>
<a href="#l68.10"></a><span id="l68.10">   do_check_neq(headerKeys, null);</span>
<a href="#l68.11"></a><span id="l68.11"> </span>
<a href="#l68.12"></a><span id="l68.12" class="difflineminus">-  let message = gLocalInboxFolder.GetMessageHeader(headerKeys[0]);</span>
<a href="#l68.13"></a><span id="l68.13" class="difflineminus">-  let msgURI = gLocalInboxFolder.getUriForMsg(message);</span>
<a href="#l68.14"></a><span id="l68.14" class="difflineplus">+  let message = localAccountUtils.inboxFolder.GetMessageHeader(headerKeys[0]);</span>
<a href="#l68.15"></a><span id="l68.15" class="difflineplus">+  let msgURI = localAccountUtils.inboxFolder.getUriForMsg(message);</span>
<a href="#l68.16"></a><span id="l68.16">   let messageService = Cc[&quot;@mozilla.org/messenger/messageservice;1?type=mailbox-message&quot;]</span>
<a href="#l68.17"></a><span id="l68.17">                        .getService(Ci.nsIMsgMessageService);</span>
<a href="#l68.18"></a><span id="l68.18">   messageService.SaveMessageToDisk(msgURI, saveFile,</span>
<a href="#l68.19"></a><span id="l68.19">                                     false, UrlListener, {}, true, null);</span>
<a href="#l68.20"></a><span id="l68.20"> }</span>
<a href="#l68.21"></a><span id="l68.21"> </span>
<a href="#l68.22"></a><span id="l68.22"> function check_each_line(aExpectedLines, aActualLines) {</span>
<a href="#l68.23"></a><span id="l68.23">   let expectedStrings = aExpectedLines.split(MSG_LINEBREAK);</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l69.1"></a><span id="l69.1" class="difflineminus">--- a/mailnews/local/test/unit/test_streamHeaders.js</span>
<a href="#l69.2"></a><span id="l69.2" class="difflineplus">+++ b/mailnews/local/test/unit/test_streamHeaders.js</span>
<a href="#l69.3"></a><span id="l69.3" class="difflineat">@@ -31,17 +31,17 @@ let gHdr;</span>
<a href="#l69.4"></a><span id="l69.4"> function loadMessages()</span>
<a href="#l69.5"></a><span id="l69.5"> {</span>
<a href="#l69.6"></a><span id="l69.6">   gPOP3Pump.files = [&quot;../../../data/draft1&quot;];</span>
<a href="#l69.7"></a><span id="l69.7">   gPOP3Pump.onDone = async_driver;</span>
<a href="#l69.8"></a><span id="l69.8">   gPOP3Pump.run();</span>
<a href="#l69.9"></a><span id="l69.9">   yield false;</span>
<a href="#l69.10"></a><span id="l69.10"> </span>
<a href="#l69.11"></a><span id="l69.11">   // get message headers for the inbox folder</span>
<a href="#l69.12"></a><span id="l69.12" class="difflineminus">-  let enumerator = gLocalInboxFolder.msgDatabase.EnumerateMessages();</span>
<a href="#l69.13"></a><span id="l69.13" class="difflineplus">+  let enumerator = localAccountUtils.inboxFolder.msgDatabase.EnumerateMessages();</span>
<a href="#l69.14"></a><span id="l69.14">   var msgCount = 0;</span>
<a href="#l69.15"></a><span id="l69.15">   while(enumerator.hasMoreElements())</span>
<a href="#l69.16"></a><span id="l69.16">   {</span>
<a href="#l69.17"></a><span id="l69.17">     msgCount++;</span>
<a href="#l69.18"></a><span id="l69.18">     gHdr = enumerator.getNext().QueryInterface(Ci.nsIMsgDBHdr);</span>
<a href="#l69.19"></a><span id="l69.19">     do_check_eq(gHdr.subject, testSubjects[msgCount - 1]);</span>
<a href="#l69.20"></a><span id="l69.20">   }</span>
<a href="#l69.21"></a><span id="l69.21">   do_check_eq(msgCount, 1);</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l70.1"></a><span id="l70.1" class="difflineminus">--- a/mailnews/local/test/unit/test_undoDelete.js</span>
<a href="#l70.2"></a><span id="l70.2" class="difflineplus">+++ b/mailnews/local/test/unit/test_undoDelete.js</span>
<a href="#l70.3"></a><span id="l70.3" class="difflineat">@@ -126,13 +126,13 @@ var URLListener =</span>
<a href="#l70.4"></a><span id="l70.4"> }</span>
<a href="#l70.5"></a><span id="l70.5"> </span>
<a href="#l70.6"></a><span id="l70.6"> function endTest()</span>
<a href="#l70.7"></a><span id="l70.7"> {</span>
<a href="#l70.8"></a><span id="l70.8">   // Cleanup, null out everything</span>
<a href="#l70.9"></a><span id="l70.9">   gMessages.clear();</span>
<a href="#l70.10"></a><span id="l70.10">   gMsgWindow.closeWindow();</span>
<a href="#l70.11"></a><span id="l70.11">   gMsgWindow = null;</span>
<a href="#l70.12"></a><span id="l70.12" class="difflineminus">-  gLocalInboxFolder = null;</span>
<a href="#l70.13"></a><span id="l70.13" class="difflineplus">+  localAccountUtils.inboxFolder = null;</span>
<a href="#l70.14"></a><span id="l70.14">   localAccountUtils.incomingServer = null;</span>
<a href="#l70.15"></a><span id="l70.15"> </span>
<a href="#l70.16"></a><span id="l70.16">   do_test_finished(); // for the one in run_test()</span>
<a href="#l70.17"></a><span id="l70.17"> }</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l71.1"></a><span id="l71.1" class="difflineminus">--- a/mailnews/mime/test/unit/test_mimeStreaming.js</span>
<a href="#l71.2"></a><span id="l71.2" class="difflineplus">+++ b/mailnews/mime/test/unit/test_mimeStreaming.js</span>
<a href="#l71.3"></a><span id="l71.3" class="difflineat">@@ -18,37 +18,37 @@ var gMsgEnumerator;</span>
<a href="#l71.4"></a><span id="l71.4"> </span>
<a href="#l71.5"></a><span id="l71.5"> var gMessenger = Cc[&quot;@mozilla.org/messenger;1&quot;].</span>
<a href="#l71.6"></a><span id="l71.6">                    createInstance(Ci.nsIMessenger);</span>
<a href="#l71.7"></a><span id="l71.7"> </span>
<a href="#l71.8"></a><span id="l71.8"> let gUrlListener = {</span>
<a href="#l71.9"></a><span id="l71.9">   OnStartRunningUrl: function (aUrl) {</span>
<a href="#l71.10"></a><span id="l71.10">   },</span>
<a href="#l71.11"></a><span id="l71.11">   OnStopRunningUrl: function (aUrl, aExitCode) {</span>
<a href="#l71.12"></a><span id="l71.12" class="difflineminus">-    do_test_finished()</span>
<a href="#l71.13"></a><span id="l71.13" class="difflineplus">+    do_test_finished();</span>
<a href="#l71.14"></a><span id="l71.14">   },</span>
<a href="#l71.15"></a><span id="l71.15"> };</span>
<a href="#l71.16"></a><span id="l71.16"> </span>
<a href="#l71.17"></a><span id="l71.17"> </span>
<a href="#l71.18"></a><span id="l71.18"> localAccountUtils.loadLocalMailAccount();</span>
<a href="#l71.19"></a><span id="l71.19"> </span>
<a href="#l71.20"></a><span id="l71.20"> function run_test()</span>
<a href="#l71.21"></a><span id="l71.21"> {</span>
<a href="#l71.22"></a><span id="l71.22">   do_test_pending();</span>
<a href="#l71.23"></a><span id="l71.23" class="difflineminus">-  gLocalInboxFolder.QueryInterface(Ci.nsIMsgLocalMailFolder);</span>
<a href="#l71.24"></a><span id="l71.24" class="difflineplus">+  localAccountUtils.inboxFolder.QueryInterface(Ci.nsIMsgLocalMailFolder);</span>
<a href="#l71.25"></a><span id="l71.25">   for each(let fileName in gTestFiles) {</span>
<a href="#l71.26"></a><span id="l71.26" class="difflineminus">-    gLocalInboxFolder.addMessage(IOUtils.loadFileToString(do_get_file(fileName)));</span>
<a href="#l71.27"></a><span id="l71.27" class="difflineplus">+    localAccountUtils.inboxFolder.addMessage(IOUtils.loadFileToString(do_get_file(fileName)));</span>
<a href="#l71.28"></a><span id="l71.28">   };</span>
<a href="#l71.29"></a><span id="l71.29" class="difflineminus">-  gMsgEnumerator = gLocalInboxFolder.msgDatabase.EnumerateMessages();</span>
<a href="#l71.30"></a><span id="l71.30" class="difflineplus">+  gMsgEnumerator = localAccountUtils.inboxFolder.msgDatabase.EnumerateMessages();</span>
<a href="#l71.31"></a><span id="l71.31">   doNextTest();</span>
<a href="#l71.32"></a><span id="l71.32"> }</span>
<a href="#l71.33"></a><span id="l71.33"> </span>
<a href="#l71.34"></a><span id="l71.34"> function streamMsg(msgHdr)</span>
<a href="#l71.35"></a><span id="l71.35"> {</span>
<a href="#l71.36"></a><span id="l71.36" class="difflineminus">-  let msgURI = gLocalInboxFolder.getUriForMsg(msgHdr);</span>
<a href="#l71.37"></a><span id="l71.37" class="difflineplus">+  let msgURI = localAccountUtils.inboxFolder.getUriForMsg(msgHdr);</span>
<a href="#l71.38"></a><span id="l71.38">   let msgService = gMessenger.messageServiceFromURI(msgURI);</span>
<a href="#l71.39"></a><span id="l71.39">   let streamURI = msgService.streamMessage(</span>
<a href="#l71.40"></a><span id="l71.40">     msgURI,</span>
<a href="#l71.41"></a><span id="l71.41">     gStreamListener,</span>
<a href="#l71.42"></a><span id="l71.42">     null,</span>
<a href="#l71.43"></a><span id="l71.43">     gUrlListener,</span>
<a href="#l71.44"></a><span id="l71.44">     true, // have them create the converter</span>
<a href="#l71.45"></a><span id="l71.45">     // additional uri payload, note that &quot;header=&quot; is prepended automatically</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l72.1"></a><span id="l72.1" class="difflineminus">--- a/mailnews/test/resources/IMAPpump.js</span>
<a href="#l72.2"></a><span id="l72.2" class="difflineplus">+++ b/mailnews/test/resources/IMAPpump.js</span>
<a href="#l72.3"></a><span id="l72.3" class="difflineat">@@ -77,17 +77,17 @@ function setupIMAPPump(extensions)</span>
<a href="#l72.4"></a><span id="l72.4"> </span>
<a href="#l72.5"></a><span id="l72.5">   // end copy from head_server.js</span>
<a href="#l72.6"></a><span id="l72.6"> </span>
<a href="#l72.7"></a><span id="l72.7">   gIMAPDaemon = new imapDaemon();</span>
<a href="#l72.8"></a><span id="l72.8">   gIMAPServer = makeServer(gIMAPDaemon, extensions);</span>
<a href="#l72.9"></a><span id="l72.9"> </span>
<a href="#l72.10"></a><span id="l72.10">   gIMAPIncomingServer = createLocalIMAPServer();</span>
<a href="#l72.11"></a><span id="l72.11"> </span>
<a href="#l72.12"></a><span id="l72.12" class="difflineminus">-  if (!this.gLocalInboxFolder)</span>
<a href="#l72.13"></a><span id="l72.13" class="difflineplus">+  if (!localAccountUtils.inboxFolder)</span>
<a href="#l72.14"></a><span id="l72.14">     localAccountUtils.loadLocalMailAccount();</span>
<a href="#l72.15"></a><span id="l72.15"> </span>
<a href="#l72.16"></a><span id="l72.16">   // We need an identity so that updateFolder doesn't fail</span>
<a href="#l72.17"></a><span id="l72.17">   let localAccount = MailServices.accounts.createAccount();</span>
<a href="#l72.18"></a><span id="l72.18">   let identity = MailServices.accounts.createIdentity();</span>
<a href="#l72.19"></a><span id="l72.19">   localAccount.addIdentity(identity);</span>
<a href="#l72.20"></a><span id="l72.20">   localAccount.defaultIdentity = identity;</span>
<a href="#l72.21"></a><span id="l72.21">   localAccount.incomingServer = localAccountUtils.incomingServer;</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l73.1"></a><span id="l73.1" class="difflineminus">--- a/mailnews/test/resources/POP3pump.js</span>
<a href="#l73.2"></a><span id="l73.2" class="difflineplus">+++ b/mailnews/test/resources/POP3pump.js</span>
<a href="#l73.3"></a><span id="l73.3" class="difflineat">@@ -83,17 +83,17 @@ POP3Pump.prototype._setupServerDaemon = </span>
<a href="#l73.4"></a><span id="l73.4">   if (aDebugOption)</span>
<a href="#l73.5"></a><span id="l73.5">     this._server.setDebugLevel(aDebugOption);</span>
<a href="#l73.6"></a><span id="l73.6">   return [this._daemon, this._server];</span>
<a href="#l73.7"></a><span id="l73.7"> };</span>
<a href="#l73.8"></a><span id="l73.8"> </span>
<a href="#l73.9"></a><span id="l73.9"> POP3Pump.prototype._createPop3ServerAndLocalFolders =</span>
<a href="#l73.10"></a><span id="l73.10">   function _createPop3ServerAndLocalFolders()</span>
<a href="#l73.11"></a><span id="l73.11"> {</span>
<a href="#l73.12"></a><span id="l73.12" class="difflineminus">-  if (typeof gLocalInboxFolder == 'undefined')</span>
<a href="#l73.13"></a><span id="l73.13" class="difflineplus">+  if (typeof localAccountUtils.inboxFolder == 'undefined')</span>
<a href="#l73.14"></a><span id="l73.14">     localAccountUtils.loadLocalMailAccount();</span>
<a href="#l73.15"></a><span id="l73.15"> </span>
<a href="#l73.16"></a><span id="l73.16">   if (!this.fakeServer)</span>
<a href="#l73.17"></a><span id="l73.17">     this.fakeServer = localAccountUtils.create_incoming_server(&quot;pop3&quot;, this.kPOP3_PORT,</span>
<a href="#l73.18"></a><span id="l73.18"> 							       &quot;fred&quot;, &quot;wilma&quot;);</span>
<a href="#l73.19"></a><span id="l73.19"> </span>
<a href="#l73.20"></a><span id="l73.20">   return this.fakeServer;</span>
<a href="#l73.21"></a><span id="l73.21"> };</span>
<a href="#l73.22"></a><span id="l73.22" class="difflineat">@@ -157,17 +157,17 @@ POP3Pump.prototype._testNext = function </span>
<a href="#l73.23"></a><span id="l73.23">     {</span>
<a href="#l73.24"></a><span id="l73.24">       this._server.resetTest();</span>
<a href="#l73.25"></a><span id="l73.25">     }</span>
<a href="#l73.26"></a><span id="l73.26"> </span>
<a href="#l73.27"></a><span id="l73.27">     // Set up the test</span>
<a href="#l73.28"></a><span id="l73.28">     this._daemon.setMessages(thisFiles);</span>
<a href="#l73.29"></a><span id="l73.29"> </span>
<a href="#l73.30"></a><span id="l73.30">     // Now get the mail</span>
<a href="#l73.31"></a><span id="l73.31" class="difflineminus">-    this._pop3Service.GetNewMail(null, this._urlListener, gLocalInboxFolder,</span>
<a href="#l73.32"></a><span id="l73.32" class="difflineplus">+    this._pop3Service.GetNewMail(null, this._urlListener, localAccountUtils.inboxFolder,</span>
<a href="#l73.33"></a><span id="l73.33">                                  this._incomingServer);</span>
<a href="#l73.34"></a><span id="l73.34"> </span>
<a href="#l73.35"></a><span id="l73.35">     this._server.performTest();</span>
<a href="#l73.36"></a><span id="l73.36">   } catch (e)</span>
<a href="#l73.37"></a><span id="l73.37">   {</span>
<a href="#l73.38"></a><span id="l73.38">     this._server.stop();</span>
<a href="#l73.39"></a><span id="l73.39"> </span>
<a href="#l73.40"></a><span id="l73.40">     do_throw(e);</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l74.1"></a><span id="l74.1" class="difflineminus">--- a/mailnews/test/resources/localAccountUtils.js</span>
<a href="#l74.2"></a><span id="l74.2" class="difflineplus">+++ b/mailnews/test/resources/localAccountUtils.js</span>
<a href="#l74.3"></a><span id="l74.3" class="difflineat">@@ -4,19 +4,18 @@</span>
<a href="#l74.4"></a><span id="l74.4"> </span>
<a href="#l74.5"></a><span id="l74.5"> // Make sure we execute this file exactly once</span>
<a href="#l74.6"></a><span id="l74.6"> var gLocalAccountUtils_js__;</span>
<a href="#l74.7"></a><span id="l74.7"> if (!gLocalAccountUtils_js__) {</span>
<a href="#l74.8"></a><span id="l74.8"> gLocalAccountUtils_js__ = true;</span>
<a href="#l74.9"></a><span id="l74.9"> </span>
<a href="#l74.10"></a><span id="l74.10"> // Local Mail Folders. Requires prior setup of profile directory</span>
<a href="#l74.11"></a><span id="l74.11"> </span>
<a href="#l74.12"></a><span id="l74.12" class="difflineminus">-var gLocalInboxFolder;</span>
<a href="#l74.13"></a><span id="l74.13" class="difflineminus">-</span>
<a href="#l74.14"></a><span id="l74.14"> var localAccountUtils = {</span>
<a href="#l74.15"></a><span id="l74.15" class="difflineplus">+  inboxFolder: undefined,</span>
<a href="#l74.16"></a><span id="l74.16">   incomingServer: undefined,</span>
<a href="#l74.17"></a><span id="l74.17">   rootFolder: undefined,</span>
<a href="#l74.18"></a><span id="l74.18">   msgAccount: undefined,</span>
<a href="#l74.19"></a><span id="l74.19"> </span>
<a href="#l74.20"></a><span id="l74.20">   _localAccountInitialized: false,</span>
<a href="#l74.21"></a><span id="l74.21"> </span>
<a href="#l74.22"></a><span id="l74.22">   loadLocalMailAccount: function() {</span>
<a href="#l74.23"></a><span id="l74.23">     // This function is idempotent</span>
<a href="#l74.24"></a><span id="l74.24" class="difflineat">@@ -29,23 +28,23 @@ var localAccountUtils = {</span>
<a href="#l74.25"></a><span id="l74.25">     this.msgAccount = MailServices.accounts.FindAccountForServer(</span>
<a href="#l74.26"></a><span id="l74.26">       this.incomingServer);</span>
<a href="#l74.27"></a><span id="l74.27"> </span>
<a href="#l74.28"></a><span id="l74.28">     this.rootFolder = this.incomingServer.rootMsgFolder</span>
<a href="#l74.29"></a><span id="l74.29">                         .QueryInterface(Ci.nsIMsgLocalMailFolder);</span>
<a href="#l74.30"></a><span id="l74.30"> </span>
<a href="#l74.31"></a><span id="l74.31">     // Note: Inbox is not created automatically when there is no deferred server,</span>
<a href="#l74.32"></a><span id="l74.32">     // so we need to create it.</span>
<a href="#l74.33"></a><span id="l74.33" class="difflineminus">-    gLocalInboxFolder = this.rootFolder.createLocalSubfolder(&quot;Inbox&quot;)</span>
<a href="#l74.34"></a><span id="l74.34" class="difflineplus">+    this.inboxFolder = this.rootFolder.createLocalSubfolder(&quot;Inbox&quot;)</span>
<a href="#l74.35"></a><span id="l74.35">                          .QueryInterface(Ci.nsIMsgLocalMailFolder);</span>
<a href="#l74.36"></a><span id="l74.36">     // a local inbox should have a Mail flag!</span>
<a href="#l74.37"></a><span id="l74.37" class="difflineminus">-    gLocalInboxFolder.setFlag(Ci.nsMsgFolderFlags.Mail);</span>
<a href="#l74.38"></a><span id="l74.38" class="difflineplus">+    this.inboxFolder.setFlag(Ci.nsMsgFolderFlags.Mail);</span>
<a href="#l74.39"></a><span id="l74.39"> </span>
<a href="#l74.40"></a><span id="l74.40">     // Force an initialization of the Inbox folder database.</span>
<a href="#l74.41"></a><span id="l74.41" class="difflineminus">-    var folderName = gLocalInboxFolder.prettiestName;</span>
<a href="#l74.42"></a><span id="l74.42" class="difflineplus">+    var folderName = this.inboxFolder.prettiestName;</span>
<a href="#l74.43"></a><span id="l74.43"> </span>
<a href="#l74.44"></a><span id="l74.44">     this._localAccountInitialized = true;</span>
<a href="#l74.45"></a><span id="l74.45">   },</span>
<a href="#l74.46"></a><span id="l74.46"> </span>
<a href="#l74.47"></a><span id="l74.47">   /**</span>
<a href="#l74.48"></a><span id="l74.48">    * Create an nsIMsgIncomingServer and an nsIMsgAccount to go with it.</span>
<a href="#l74.49"></a><span id="l74.49">    *</span>
<a href="#l74.50"></a><span id="l74.50">    * @param aType The type of the server (pop3, imap etc).</span></pre></div></div>

<div class="page_footer">
<div class="page_footer_text">comm-central</div>
<div class="page_footer_text" style="padding-left: 10px">Deployed from <a href="https://hg.mozilla.org/hgcustom/version-control-tools/rev/35f393d6769a">35f393d6769a</a> at 2020-07-16T17:23:43Z.</div>
<div class="rss_logo">
<a href="/comm-central/rss-log">RSS</a>
<a href="/comm-central/atom-log">Atom</a>
</div>
<br />

</div>
</body>
</html>

