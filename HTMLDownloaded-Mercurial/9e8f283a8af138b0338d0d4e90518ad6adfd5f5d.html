<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en-US" lang="en-US">
<head>
<link rel="icon" href="/static/35f393d6769a/hgicon.png" type="image/png" />
<meta name="robots" content="index, nofollow"/>
<link rel="stylesheet" href="/static/35f393d6769a/style-gitweb.css" type="text/css" />

<style type="text/css">
div.feed {
  float: right;
}
a img {
  border-width: 0px;
}
div.log_link {
  width: 80px;
  background-color: white;
}

div.log_body {
  padding-left: 96px;
}
</style>
<script type="text/javascript" src="/static/35f393d6769a/mercurial.js"></script>

<meta property="og:image" content="/static/35f393d6769a/moz-logo-bw-rgb.svg"/>
<meta property="og:type" content="website"/>

<title>comm-central: changeset 10371:9e8f283a8af138b0338d0d4e90518ad6adfd5f5d</title>
<link rel="alternate" type="application/atom+xml"
   href="/comm-central/atom-log" title="Atom feed for comm-central"/>
<link rel="alternate" type="application/rss+xml"
   href="/comm-central/rss-log" title="RSS feed for comm-central"/>

<meta property="og:title" content="comm-central @ 9e8f283a8af138b0338d0d4e90518ad6adfd5f5d" />
<meta property="og:url" content="/comm-central/rev/9e8f283a8af138b0338d0d4e90518ad6adfd5f5d" />
<meta property="og:description" content="Bug 749930 - Replace uses of nsILocalFile with nsIFile (compiled code only); r=Fallen,Neil sr=Standard8" />

</head>
<body>

<div class="page_header">
<div class="logo">
    <a href="https://developer.mozilla.org/en/docs/Mercurial">
        <img src="/static/35f393d6769a/moz-logo-bw-rgb.svg" alt="mercurial" />
    </a>
</div>
<a href="/">Mercurial</a> &gt; <a href="/comm-central">comm-central</a>  / changeset / 9e8f283a8af138b0338d0d4e90518ad6adfd5f5d 
</div>

<div class="page_nav">
<div>
<a href="/comm-central/summary">summary</a> |
<a href="/comm-central/shortlog/9e8f283a8af138b0338d0d4e90518ad6adfd5f5d">shortlog</a> |
<a href="/comm-central/log/9e8f283a8af138b0338d0d4e90518ad6adfd5f5d">changelog</a> |
<a href="/comm-central/pushloghtml">pushlog</a> |
<a href="/comm-central/graph/9e8f283a8af138b0338d0d4e90518ad6adfd5f5d">graph</a> |
<a href="/comm-central/tags">tags</a> |
<a href="/comm-central/bookmarks">bookmarks</a> |
<a href="/comm-central/branches">branches</a> |
<a href="/comm-central/file/9e8f283a8af138b0338d0d4e90518ad6adfd5f5d">files</a> |
changeset |
<a href="/comm-central/raw-rev/9e8f283a8af138b0338d0d4e90518ad6adfd5f5d">raw</a>  | <a href="/comm-central/archive/9e8f283a8af138b0338d0d4e90518ad6adfd5f5d.zip">zip</a>  |
<a href="/comm-central/help">help</a>
</div>

<div class="search">
<form id="searchform" action="/comm-central/log">

<input name="rev" type="text" value="" size="40" />
<div id="hint">Find changesets by keywords (author, files, the commit message), revision
number or hash, or <a href="/comm-central/help/revsets">revset expression</a>.</div>
</form>
</div>
</div>

<div class="title">
<a href="https://bugzilla.mozilla.org/show_bug.cgi?id=749930">Bug 749930</a> - Replace uses of nsILocalFile with nsIFile (compiled code only); r=Fallen,Neil sr=Standard8
<span class="logtags"></span>
</div>
<div class="title_text">
<table cellspacing="0">

<tr><td>author</td><td>&#71;&#101;&#111;&#102;&#102;&#32;&#76;&#97;&#110;&#107;&#111;&#119;&#32;&#60;&#103;&#101;&#111;&#102;&#102;&#64;&#100;&#97;&#114;&#107;&#116;&#114;&#111;&#106;&#97;&#110;&#46;&#110;&#101;&#116;&#62;</td></tr>
<tr><td></td><td class="date age">Wed, 06 Jun 2012 14:24:01 +1200</td></tr>

<tr>
 <td>changeset 10371</td>
 <td style="font-family:monospace"><a class="list" href="/comm-central/rev/9e8f283a8af138b0338d0d4e90518ad6adfd5f5d">9e8f283a8af138b0338d0d4e90518ad6adfd5f5d</a></td>
</tr>



<tr>
<td>parent 10370</td>
<td style="font-family:monospace">
<a class="list" href="/comm-central/rev/2811ac856b274ab24a5c92f82c1ddc2c51c62e0e">2811ac856b274ab24a5c92f82c1ddc2c51c62e0e</a>
</td>
</tr>

<tr>
<td>child 10372</td>
<td style="font-family:monospace">
<a class="list" href="/comm-central/rev/e622ef230d64994a56459ee3a026d09a34e0861c">e622ef230d64994a56459ee3a026d09a34e0861c</a>
</td>
</tr>
<tr><td>push id</td><td><a href="/comm-central/pushloghtml?changeset=9e8f283a8af138b0338d0d4e90518ad6adfd5f5d">7851</a></td></tr>
<tr><td>push user</td><td>geoff@darktrojan.net</td></tr>
<tr><td>push date</td><td class="date age">Wed, 06 Jun 2012 02:43:10 +0000</td></tr>

<tr><td>treeherder</td><td>comm-central@9e8f283a8af1 [<a href="https://treeherder.mozilla.org/#/jobs?repo=comm-central&revision=9e8f283a8af138b0338d0d4e90518ad6adfd5f5d">default view</a>] [<a href="https://treeherder.mozilla.org/#/jobs?repo=comm-central&revision=9e8f283a8af138b0338d0d4e90518ad6adfd5f5d&filter-resultStatus=testfailed&filter-resultStatus=busted&filter-resultStatus=exception">failures only]</td></tr>
<tr><td>perfherder</td><td>[<a href="https://treeherder.mozilla.org/perf.html#/compare?originalProject=comm-central&originalRevision=9e8f283a8af138b0338d0d4e90518ad6adfd5f5d&newProject=comm-central&newRevision=9e8f283a8af138b0338d0d4e90518ad6adfd5f5d&framework=1" target="_blank">talos</a>] [<a href="https://treeherder.mozilla.org/perf.html#/compare?originalProject=comm-central&originalRevision=9e8f283a8af138b0338d0d4e90518ad6adfd5f5d&newProject=comm-central&newRevision=9e8f283a8af138b0338d0d4e90518ad6adfd5f5d&framework=2" target="_blank">build metrics</a>] [<a href="https://treeherder.mozilla.org/perf.html#/compare?originalProject=comm-central&originalRevision=9e8f283a8af138b0338d0d4e90518ad6adfd5f5d&newProject=comm-central&newRevision=9e8f283a8af138b0338d0d4e90518ad6adfd5f5d&framework=6" target="_blank">platform microbench</a>] (compared to previous push)</td></tr>
<tr><td>reviewers</td><td><a href="/comm-central/log?rev=reviewer%28Fallen%29&revcount=50">Fallen</a>, <a href="/comm-central/log?rev=reviewer%28Neil%29&revcount=50">Neil</a>, <a href="/comm-central/log?rev=reviewer%28Standard8%29&revcount=50">Standard8</a></td></tr>
<tr><td>bugs</td><td><a href="https://bugzilla.mozilla.org/show_bug.cgi?id=749930">749930</a></td></tr>




</table></div>

<div class="page_body description"><a href="https://bugzilla.mozilla.org/show_bug.cgi?id=749930">Bug 749930</a> - Replace uses of nsILocalFile with nsIFile (compiled code only); r=Fallen,Neil sr=Standard8</div>
<div class="list_head"></div>
<div class="title_text">
<table cellspacing="0">

<tr class="parity0">
<td><a class="list" href="/comm-central/diff/9e8f283a8af138b0338d0d4e90518ad6adfd5f5d/calendar/sunbird/app/nsCalendarApp.cpp">calendar/sunbird/app/nsCalendarApp.cpp</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/9e8f283a8af138b0338d0d4e90518ad6adfd5f5d/calendar/sunbird/app/nsCalendarApp.cpp">file</a> |
<a href="/comm-central/annotate/9e8f283a8af138b0338d0d4e90518ad6adfd5f5d/calendar/sunbird/app/nsCalendarApp.cpp">annotate</a> |
<a href="/comm-central/diff/9e8f283a8af138b0338d0d4e90518ad6adfd5f5d/calendar/sunbird/app/nsCalendarApp.cpp">diff</a> |
<a href="/comm-central/comparison/9e8f283a8af138b0338d0d4e90518ad6adfd5f5d/calendar/sunbird/app/nsCalendarApp.cpp">comparison</a> |
<a href="/comm-central/log/9e8f283a8af138b0338d0d4e90518ad6adfd5f5d/calendar/sunbird/app/nsCalendarApp.cpp">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/9e8f283a8af138b0338d0d4e90518ad6adfd5f5d/chat/components/public/imIUserStatusInfo.idl">chat/components/public/imIUserStatusInfo.idl</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/9e8f283a8af138b0338d0d4e90518ad6adfd5f5d/chat/components/public/imIUserStatusInfo.idl">file</a> |
<a href="/comm-central/annotate/9e8f283a8af138b0338d0d4e90518ad6adfd5f5d/chat/components/public/imIUserStatusInfo.idl">annotate</a> |
<a href="/comm-central/diff/9e8f283a8af138b0338d0d4e90518ad6adfd5f5d/chat/components/public/imIUserStatusInfo.idl">diff</a> |
<a href="/comm-central/comparison/9e8f283a8af138b0338d0d4e90518ad6adfd5f5d/chat/components/public/imIUserStatusInfo.idl">comparison</a> |
<a href="/comm-central/log/9e8f283a8af138b0338d0d4e90518ad6adfd5f5d/chat/components/public/imIUserStatusInfo.idl">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/9e8f283a8af138b0338d0d4e90518ad6adfd5f5d/mail/app/nsMailApp.cpp">mail/app/nsMailApp.cpp</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/9e8f283a8af138b0338d0d4e90518ad6adfd5f5d/mail/app/nsMailApp.cpp">file</a> |
<a href="/comm-central/annotate/9e8f283a8af138b0338d0d4e90518ad6adfd5f5d/mail/app/nsMailApp.cpp">annotate</a> |
<a href="/comm-central/diff/9e8f283a8af138b0338d0d4e90518ad6adfd5f5d/mail/app/nsMailApp.cpp">diff</a> |
<a href="/comm-central/comparison/9e8f283a8af138b0338d0d4e90518ad6adfd5f5d/mail/app/nsMailApp.cpp">comparison</a> |
<a href="/comm-central/log/9e8f283a8af138b0338d0d4e90518ad6adfd5f5d/mail/app/nsMailApp.cpp">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/9e8f283a8af138b0338d0d4e90518ad6adfd5f5d/mail/components/cloudfile/nsIMsgCloudFileProvider.idl">mail/components/cloudfile/nsIMsgCloudFileProvider.idl</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/9e8f283a8af138b0338d0d4e90518ad6adfd5f5d/mail/components/cloudfile/nsIMsgCloudFileProvider.idl">file</a> |
<a href="/comm-central/annotate/9e8f283a8af138b0338d0d4e90518ad6adfd5f5d/mail/components/cloudfile/nsIMsgCloudFileProvider.idl">annotate</a> |
<a href="/comm-central/diff/9e8f283a8af138b0338d0d4e90518ad6adfd5f5d/mail/components/cloudfile/nsIMsgCloudFileProvider.idl">diff</a> |
<a href="/comm-central/comparison/9e8f283a8af138b0338d0d4e90518ad6adfd5f5d/mail/components/cloudfile/nsIMsgCloudFileProvider.idl">comparison</a> |
<a href="/comm-central/log/9e8f283a8af138b0338d0d4e90518ad6adfd5f5d/mail/components/cloudfile/nsIMsgCloudFileProvider.idl">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/9e8f283a8af138b0338d0d4e90518ad6adfd5f5d/mail/components/migration/src/nsEudoraProfileMigrator.h">mail/components/migration/src/nsEudoraProfileMigrator.h</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/9e8f283a8af138b0338d0d4e90518ad6adfd5f5d/mail/components/migration/src/nsEudoraProfileMigrator.h">file</a> |
<a href="/comm-central/annotate/9e8f283a8af138b0338d0d4e90518ad6adfd5f5d/mail/components/migration/src/nsEudoraProfileMigrator.h">annotate</a> |
<a href="/comm-central/diff/9e8f283a8af138b0338d0d4e90518ad6adfd5f5d/mail/components/migration/src/nsEudoraProfileMigrator.h">diff</a> |
<a href="/comm-central/comparison/9e8f283a8af138b0338d0d4e90518ad6adfd5f5d/mail/components/migration/src/nsEudoraProfileMigrator.h">comparison</a> |
<a href="/comm-central/log/9e8f283a8af138b0338d0d4e90518ad6adfd5f5d/mail/components/migration/src/nsEudoraProfileMigrator.h">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/9e8f283a8af138b0338d0d4e90518ad6adfd5f5d/mail/components/migration/src/nsMailProfileMigratorUtils.h">mail/components/migration/src/nsMailProfileMigratorUtils.h</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/9e8f283a8af138b0338d0d4e90518ad6adfd5f5d/mail/components/migration/src/nsMailProfileMigratorUtils.h">file</a> |
<a href="/comm-central/annotate/9e8f283a8af138b0338d0d4e90518ad6adfd5f5d/mail/components/migration/src/nsMailProfileMigratorUtils.h">annotate</a> |
<a href="/comm-central/diff/9e8f283a8af138b0338d0d4e90518ad6adfd5f5d/mail/components/migration/src/nsMailProfileMigratorUtils.h">diff</a> |
<a href="/comm-central/comparison/9e8f283a8af138b0338d0d4e90518ad6adfd5f5d/mail/components/migration/src/nsMailProfileMigratorUtils.h">comparison</a> |
<a href="/comm-central/log/9e8f283a8af138b0338d0d4e90518ad6adfd5f5d/mail/components/migration/src/nsMailProfileMigratorUtils.h">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/9e8f283a8af138b0338d0d4e90518ad6adfd5f5d/mail/components/migration/src/nsNetscapeProfileMigratorBase.cpp">mail/components/migration/src/nsNetscapeProfileMigratorBase.cpp</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/9e8f283a8af138b0338d0d4e90518ad6adfd5f5d/mail/components/migration/src/nsNetscapeProfileMigratorBase.cpp">file</a> |
<a href="/comm-central/annotate/9e8f283a8af138b0338d0d4e90518ad6adfd5f5d/mail/components/migration/src/nsNetscapeProfileMigratorBase.cpp">annotate</a> |
<a href="/comm-central/diff/9e8f283a8af138b0338d0d4e90518ad6adfd5f5d/mail/components/migration/src/nsNetscapeProfileMigratorBase.cpp">diff</a> |
<a href="/comm-central/comparison/9e8f283a8af138b0338d0d4e90518ad6adfd5f5d/mail/components/migration/src/nsNetscapeProfileMigratorBase.cpp">comparison</a> |
<a href="/comm-central/log/9e8f283a8af138b0338d0d4e90518ad6adfd5f5d/mail/components/migration/src/nsNetscapeProfileMigratorBase.cpp">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/9e8f283a8af138b0338d0d4e90518ad6adfd5f5d/mail/components/migration/src/nsNetscapeProfileMigratorBase.h">mail/components/migration/src/nsNetscapeProfileMigratorBase.h</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/9e8f283a8af138b0338d0d4e90518ad6adfd5f5d/mail/components/migration/src/nsNetscapeProfileMigratorBase.h">file</a> |
<a href="/comm-central/annotate/9e8f283a8af138b0338d0d4e90518ad6adfd5f5d/mail/components/migration/src/nsNetscapeProfileMigratorBase.h">annotate</a> |
<a href="/comm-central/diff/9e8f283a8af138b0338d0d4e90518ad6adfd5f5d/mail/components/migration/src/nsNetscapeProfileMigratorBase.h">diff</a> |
<a href="/comm-central/comparison/9e8f283a8af138b0338d0d4e90518ad6adfd5f5d/mail/components/migration/src/nsNetscapeProfileMigratorBase.h">comparison</a> |
<a href="/comm-central/log/9e8f283a8af138b0338d0d4e90518ad6adfd5f5d/mail/components/migration/src/nsNetscapeProfileMigratorBase.h">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/9e8f283a8af138b0338d0d4e90518ad6adfd5f5d/mail/components/migration/src/nsProfileMigrator.cpp">mail/components/migration/src/nsProfileMigrator.cpp</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/9e8f283a8af138b0338d0d4e90518ad6adfd5f5d/mail/components/migration/src/nsProfileMigrator.cpp">file</a> |
<a href="/comm-central/annotate/9e8f283a8af138b0338d0d4e90518ad6adfd5f5d/mail/components/migration/src/nsProfileMigrator.cpp">annotate</a> |
<a href="/comm-central/diff/9e8f283a8af138b0338d0d4e90518ad6adfd5f5d/mail/components/migration/src/nsProfileMigrator.cpp">diff</a> |
<a href="/comm-central/comparison/9e8f283a8af138b0338d0d4e90518ad6adfd5f5d/mail/components/migration/src/nsProfileMigrator.cpp">comparison</a> |
<a href="/comm-central/log/9e8f283a8af138b0338d0d4e90518ad6adfd5f5d/mail/components/migration/src/nsProfileMigrator.cpp">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/9e8f283a8af138b0338d0d4e90518ad6adfd5f5d/mail/components/migration/src/nsProfileMigrator.h">mail/components/migration/src/nsProfileMigrator.h</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/9e8f283a8af138b0338d0d4e90518ad6adfd5f5d/mail/components/migration/src/nsProfileMigrator.h">file</a> |
<a href="/comm-central/annotate/9e8f283a8af138b0338d0d4e90518ad6adfd5f5d/mail/components/migration/src/nsProfileMigrator.h">annotate</a> |
<a href="/comm-central/diff/9e8f283a8af138b0338d0d4e90518ad6adfd5f5d/mail/components/migration/src/nsProfileMigrator.h">diff</a> |
<a href="/comm-central/comparison/9e8f283a8af138b0338d0d4e90518ad6adfd5f5d/mail/components/migration/src/nsProfileMigrator.h">comparison</a> |
<a href="/comm-central/log/9e8f283a8af138b0338d0d4e90518ad6adfd5f5d/mail/components/migration/src/nsProfileMigrator.h">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/9e8f283a8af138b0338d0d4e90518ad6adfd5f5d/mail/components/migration/src/nsProfileMigratorBase.h">mail/components/migration/src/nsProfileMigratorBase.h</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/9e8f283a8af138b0338d0d4e90518ad6adfd5f5d/mail/components/migration/src/nsProfileMigratorBase.h">file</a> |
<a href="/comm-central/annotate/9e8f283a8af138b0338d0d4e90518ad6adfd5f5d/mail/components/migration/src/nsProfileMigratorBase.h">annotate</a> |
<a href="/comm-central/diff/9e8f283a8af138b0338d0d4e90518ad6adfd5f5d/mail/components/migration/src/nsProfileMigratorBase.h">diff</a> |
<a href="/comm-central/comparison/9e8f283a8af138b0338d0d4e90518ad6adfd5f5d/mail/components/migration/src/nsProfileMigratorBase.h">comparison</a> |
<a href="/comm-central/log/9e8f283a8af138b0338d0d4e90518ad6adfd5f5d/mail/components/migration/src/nsProfileMigratorBase.h">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/9e8f283a8af138b0338d0d4e90518ad6adfd5f5d/mail/components/migration/src/nsSeamonkeyProfileMigrator.cpp">mail/components/migration/src/nsSeamonkeyProfileMigrator.cpp</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/9e8f283a8af138b0338d0d4e90518ad6adfd5f5d/mail/components/migration/src/nsSeamonkeyProfileMigrator.cpp">file</a> |
<a href="/comm-central/annotate/9e8f283a8af138b0338d0d4e90518ad6adfd5f5d/mail/components/migration/src/nsSeamonkeyProfileMigrator.cpp">annotate</a> |
<a href="/comm-central/diff/9e8f283a8af138b0338d0d4e90518ad6adfd5f5d/mail/components/migration/src/nsSeamonkeyProfileMigrator.cpp">diff</a> |
<a href="/comm-central/comparison/9e8f283a8af138b0338d0d4e90518ad6adfd5f5d/mail/components/migration/src/nsSeamonkeyProfileMigrator.cpp">comparison</a> |
<a href="/comm-central/log/9e8f283a8af138b0338d0d4e90518ad6adfd5f5d/mail/components/migration/src/nsSeamonkeyProfileMigrator.cpp">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/9e8f283a8af138b0338d0d4e90518ad6adfd5f5d/mail/components/shell/nsMailWinIntegration.cpp">mail/components/shell/nsMailWinIntegration.cpp</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/9e8f283a8af138b0338d0d4e90518ad6adfd5f5d/mail/components/shell/nsMailWinIntegration.cpp">file</a> |
<a href="/comm-central/annotate/9e8f283a8af138b0338d0d4e90518ad6adfd5f5d/mail/components/shell/nsMailWinIntegration.cpp">annotate</a> |
<a href="/comm-central/diff/9e8f283a8af138b0338d0d4e90518ad6adfd5f5d/mail/components/shell/nsMailWinIntegration.cpp">diff</a> |
<a href="/comm-central/comparison/9e8f283a8af138b0338d0d4e90518ad6adfd5f5d/mail/components/shell/nsMailWinIntegration.cpp">comparison</a> |
<a href="/comm-central/log/9e8f283a8af138b0338d0d4e90518ad6adfd5f5d/mail/components/shell/nsMailWinIntegration.cpp">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/9e8f283a8af138b0338d0d4e90518ad6adfd5f5d/mailnews/addrbook/public/nsIAbLDAPDirectory.idl">mailnews/addrbook/public/nsIAbLDAPDirectory.idl</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/9e8f283a8af138b0338d0d4e90518ad6adfd5f5d/mailnews/addrbook/public/nsIAbLDAPDirectory.idl">file</a> |
<a href="/comm-central/annotate/9e8f283a8af138b0338d0d4e90518ad6adfd5f5d/mailnews/addrbook/public/nsIAbLDAPDirectory.idl">annotate</a> |
<a href="/comm-central/diff/9e8f283a8af138b0338d0d4e90518ad6adfd5f5d/mailnews/addrbook/public/nsIAbLDAPDirectory.idl">diff</a> |
<a href="/comm-central/comparison/9e8f283a8af138b0338d0d4e90518ad6adfd5f5d/mailnews/addrbook/public/nsIAbLDAPDirectory.idl">comparison</a> |
<a href="/comm-central/log/9e8f283a8af138b0338d0d4e90518ad6adfd5f5d/mailnews/addrbook/public/nsIAbLDAPDirectory.idl">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/9e8f283a8af138b0338d0d4e90518ad6adfd5f5d/mailnews/addrbook/public/nsIAbMDBDirectory.idl">mailnews/addrbook/public/nsIAbMDBDirectory.idl</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/9e8f283a8af138b0338d0d4e90518ad6adfd5f5d/mailnews/addrbook/public/nsIAbMDBDirectory.idl">file</a> |
<a href="/comm-central/annotate/9e8f283a8af138b0338d0d4e90518ad6adfd5f5d/mailnews/addrbook/public/nsIAbMDBDirectory.idl">annotate</a> |
<a href="/comm-central/diff/9e8f283a8af138b0338d0d4e90518ad6adfd5f5d/mailnews/addrbook/public/nsIAbMDBDirectory.idl">diff</a> |
<a href="/comm-central/comparison/9e8f283a8af138b0338d0d4e90518ad6adfd5f5d/mailnews/addrbook/public/nsIAbMDBDirectory.idl">comparison</a> |
<a href="/comm-central/log/9e8f283a8af138b0338d0d4e90518ad6adfd5f5d/mailnews/addrbook/public/nsIAbMDBDirectory.idl">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/9e8f283a8af138b0338d0d4e90518ad6adfd5f5d/mailnews/addrbook/public/nsIAbManager.idl">mailnews/addrbook/public/nsIAbManager.idl</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/9e8f283a8af138b0338d0d4e90518ad6adfd5f5d/mailnews/addrbook/public/nsIAbManager.idl">file</a> |
<a href="/comm-central/annotate/9e8f283a8af138b0338d0d4e90518ad6adfd5f5d/mailnews/addrbook/public/nsIAbManager.idl">annotate</a> |
<a href="/comm-central/diff/9e8f283a8af138b0338d0d4e90518ad6adfd5f5d/mailnews/addrbook/public/nsIAbManager.idl">diff</a> |
<a href="/comm-central/comparison/9e8f283a8af138b0338d0d4e90518ad6adfd5f5d/mailnews/addrbook/public/nsIAbManager.idl">comparison</a> |
<a href="/comm-central/log/9e8f283a8af138b0338d0d4e90518ad6adfd5f5d/mailnews/addrbook/public/nsIAbManager.idl">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/9e8f283a8af138b0338d0d4e90518ad6adfd5f5d/mailnews/addrbook/src/nsAbLDAPChangeLogData.cpp">mailnews/addrbook/src/nsAbLDAPChangeLogData.cpp</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/9e8f283a8af138b0338d0d4e90518ad6adfd5f5d/mailnews/addrbook/src/nsAbLDAPChangeLogData.cpp">file</a> |
<a href="/comm-central/annotate/9e8f283a8af138b0338d0d4e90518ad6adfd5f5d/mailnews/addrbook/src/nsAbLDAPChangeLogData.cpp">annotate</a> |
<a href="/comm-central/diff/9e8f283a8af138b0338d0d4e90518ad6adfd5f5d/mailnews/addrbook/src/nsAbLDAPChangeLogData.cpp">diff</a> |
<a href="/comm-central/comparison/9e8f283a8af138b0338d0d4e90518ad6adfd5f5d/mailnews/addrbook/src/nsAbLDAPChangeLogData.cpp">comparison</a> |
<a href="/comm-central/log/9e8f283a8af138b0338d0d4e90518ad6adfd5f5d/mailnews/addrbook/src/nsAbLDAPChangeLogData.cpp">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/9e8f283a8af138b0338d0d4e90518ad6adfd5f5d/mailnews/addrbook/src/nsAbLDAPDirectory.cpp">mailnews/addrbook/src/nsAbLDAPDirectory.cpp</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/9e8f283a8af138b0338d0d4e90518ad6adfd5f5d/mailnews/addrbook/src/nsAbLDAPDirectory.cpp">file</a> |
<a href="/comm-central/annotate/9e8f283a8af138b0338d0d4e90518ad6adfd5f5d/mailnews/addrbook/src/nsAbLDAPDirectory.cpp">annotate</a> |
<a href="/comm-central/diff/9e8f283a8af138b0338d0d4e90518ad6adfd5f5d/mailnews/addrbook/src/nsAbLDAPDirectory.cpp">diff</a> |
<a href="/comm-central/comparison/9e8f283a8af138b0338d0d4e90518ad6adfd5f5d/mailnews/addrbook/src/nsAbLDAPDirectory.cpp">comparison</a> |
<a href="/comm-central/log/9e8f283a8af138b0338d0d4e90518ad6adfd5f5d/mailnews/addrbook/src/nsAbLDAPDirectory.cpp">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/9e8f283a8af138b0338d0d4e90518ad6adfd5f5d/mailnews/addrbook/src/nsAbLDAPReplicationData.h">mailnews/addrbook/src/nsAbLDAPReplicationData.h</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/9e8f283a8af138b0338d0d4e90518ad6adfd5f5d/mailnews/addrbook/src/nsAbLDAPReplicationData.h">file</a> |
<a href="/comm-central/annotate/9e8f283a8af138b0338d0d4e90518ad6adfd5f5d/mailnews/addrbook/src/nsAbLDAPReplicationData.h">annotate</a> |
<a href="/comm-central/diff/9e8f283a8af138b0338d0d4e90518ad6adfd5f5d/mailnews/addrbook/src/nsAbLDAPReplicationData.h">diff</a> |
<a href="/comm-central/comparison/9e8f283a8af138b0338d0d4e90518ad6adfd5f5d/mailnews/addrbook/src/nsAbLDAPReplicationData.h">comparison</a> |
<a href="/comm-central/log/9e8f283a8af138b0338d0d4e90518ad6adfd5f5d/mailnews/addrbook/src/nsAbLDAPReplicationData.h">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/9e8f283a8af138b0338d0d4e90518ad6adfd5f5d/mailnews/addrbook/src/nsAbMDBDirFactory.cpp">mailnews/addrbook/src/nsAbMDBDirFactory.cpp</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/9e8f283a8af138b0338d0d4e90518ad6adfd5f5d/mailnews/addrbook/src/nsAbMDBDirFactory.cpp">file</a> |
<a href="/comm-central/annotate/9e8f283a8af138b0338d0d4e90518ad6adfd5f5d/mailnews/addrbook/src/nsAbMDBDirFactory.cpp">annotate</a> |
<a href="/comm-central/diff/9e8f283a8af138b0338d0d4e90518ad6adfd5f5d/mailnews/addrbook/src/nsAbMDBDirFactory.cpp">diff</a> |
<a href="/comm-central/comparison/9e8f283a8af138b0338d0d4e90518ad6adfd5f5d/mailnews/addrbook/src/nsAbMDBDirFactory.cpp">comparison</a> |
<a href="/comm-central/log/9e8f283a8af138b0338d0d4e90518ad6adfd5f5d/mailnews/addrbook/src/nsAbMDBDirFactory.cpp">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/9e8f283a8af138b0338d0d4e90518ad6adfd5f5d/mailnews/addrbook/src/nsAbMDBDirProperty.cpp">mailnews/addrbook/src/nsAbMDBDirProperty.cpp</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/9e8f283a8af138b0338d0d4e90518ad6adfd5f5d/mailnews/addrbook/src/nsAbMDBDirProperty.cpp">file</a> |
<a href="/comm-central/annotate/9e8f283a8af138b0338d0d4e90518ad6adfd5f5d/mailnews/addrbook/src/nsAbMDBDirProperty.cpp">annotate</a> |
<a href="/comm-central/diff/9e8f283a8af138b0338d0d4e90518ad6adfd5f5d/mailnews/addrbook/src/nsAbMDBDirProperty.cpp">diff</a> |
<a href="/comm-central/comparison/9e8f283a8af138b0338d0d4e90518ad6adfd5f5d/mailnews/addrbook/src/nsAbMDBDirProperty.cpp">comparison</a> |
<a href="/comm-central/log/9e8f283a8af138b0338d0d4e90518ad6adfd5f5d/mailnews/addrbook/src/nsAbMDBDirProperty.cpp">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/9e8f283a8af138b0338d0d4e90518ad6adfd5f5d/mailnews/addrbook/src/nsAbMDBDirectory.cpp">mailnews/addrbook/src/nsAbMDBDirectory.cpp</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/9e8f283a8af138b0338d0d4e90518ad6adfd5f5d/mailnews/addrbook/src/nsAbMDBDirectory.cpp">file</a> |
<a href="/comm-central/annotate/9e8f283a8af138b0338d0d4e90518ad6adfd5f5d/mailnews/addrbook/src/nsAbMDBDirectory.cpp">annotate</a> |
<a href="/comm-central/diff/9e8f283a8af138b0338d0d4e90518ad6adfd5f5d/mailnews/addrbook/src/nsAbMDBDirectory.cpp">diff</a> |
<a href="/comm-central/comparison/9e8f283a8af138b0338d0d4e90518ad6adfd5f5d/mailnews/addrbook/src/nsAbMDBDirectory.cpp">comparison</a> |
<a href="/comm-central/log/9e8f283a8af138b0338d0d4e90518ad6adfd5f5d/mailnews/addrbook/src/nsAbMDBDirectory.cpp">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/9e8f283a8af138b0338d0d4e90518ad6adfd5f5d/mailnews/addrbook/src/nsAbMDBDirectory.h">mailnews/addrbook/src/nsAbMDBDirectory.h</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/9e8f283a8af138b0338d0d4e90518ad6adfd5f5d/mailnews/addrbook/src/nsAbMDBDirectory.h">file</a> |
<a href="/comm-central/annotate/9e8f283a8af138b0338d0d4e90518ad6adfd5f5d/mailnews/addrbook/src/nsAbMDBDirectory.h">annotate</a> |
<a href="/comm-central/diff/9e8f283a8af138b0338d0d4e90518ad6adfd5f5d/mailnews/addrbook/src/nsAbMDBDirectory.h">diff</a> |
<a href="/comm-central/comparison/9e8f283a8af138b0338d0d4e90518ad6adfd5f5d/mailnews/addrbook/src/nsAbMDBDirectory.h">comparison</a> |
<a href="/comm-central/log/9e8f283a8af138b0338d0d4e90518ad6adfd5f5d/mailnews/addrbook/src/nsAbMDBDirectory.h">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/9e8f283a8af138b0338d0d4e90518ad6adfd5f5d/mailnews/addrbook/src/nsAbManager.cpp">mailnews/addrbook/src/nsAbManager.cpp</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/9e8f283a8af138b0338d0d4e90518ad6adfd5f5d/mailnews/addrbook/src/nsAbManager.cpp">file</a> |
<a href="/comm-central/annotate/9e8f283a8af138b0338d0d4e90518ad6adfd5f5d/mailnews/addrbook/src/nsAbManager.cpp">annotate</a> |
<a href="/comm-central/diff/9e8f283a8af138b0338d0d4e90518ad6adfd5f5d/mailnews/addrbook/src/nsAbManager.cpp">diff</a> |
<a href="/comm-central/comparison/9e8f283a8af138b0338d0d4e90518ad6adfd5f5d/mailnews/addrbook/src/nsAbManager.cpp">comparison</a> |
<a href="/comm-central/log/9e8f283a8af138b0338d0d4e90518ad6adfd5f5d/mailnews/addrbook/src/nsAbManager.cpp">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/9e8f283a8af138b0338d0d4e90518ad6adfd5f5d/mailnews/addrbook/src/nsAbManager.h">mailnews/addrbook/src/nsAbManager.h</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/9e8f283a8af138b0338d0d4e90518ad6adfd5f5d/mailnews/addrbook/src/nsAbManager.h">file</a> |
<a href="/comm-central/annotate/9e8f283a8af138b0338d0d4e90518ad6adfd5f5d/mailnews/addrbook/src/nsAbManager.h">annotate</a> |
<a href="/comm-central/diff/9e8f283a8af138b0338d0d4e90518ad6adfd5f5d/mailnews/addrbook/src/nsAbManager.h">diff</a> |
<a href="/comm-central/comparison/9e8f283a8af138b0338d0d4e90518ad6adfd5f5d/mailnews/addrbook/src/nsAbManager.h">comparison</a> |
<a href="/comm-central/log/9e8f283a8af138b0338d0d4e90518ad6adfd5f5d/mailnews/addrbook/src/nsAbManager.h">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/9e8f283a8af138b0338d0d4e90518ad6adfd5f5d/mailnews/addrbook/src/nsDirPrefs.cpp">mailnews/addrbook/src/nsDirPrefs.cpp</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/9e8f283a8af138b0338d0d4e90518ad6adfd5f5d/mailnews/addrbook/src/nsDirPrefs.cpp">file</a> |
<a href="/comm-central/annotate/9e8f283a8af138b0338d0d4e90518ad6adfd5f5d/mailnews/addrbook/src/nsDirPrefs.cpp">annotate</a> |
<a href="/comm-central/diff/9e8f283a8af138b0338d0d4e90518ad6adfd5f5d/mailnews/addrbook/src/nsDirPrefs.cpp">diff</a> |
<a href="/comm-central/comparison/9e8f283a8af138b0338d0d4e90518ad6adfd5f5d/mailnews/addrbook/src/nsDirPrefs.cpp">comparison</a> |
<a href="/comm-central/log/9e8f283a8af138b0338d0d4e90518ad6adfd5f5d/mailnews/addrbook/src/nsDirPrefs.cpp">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/9e8f283a8af138b0338d0d4e90518ad6adfd5f5d/mailnews/base/public/nsIMessenger.idl">mailnews/base/public/nsIMessenger.idl</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/9e8f283a8af138b0338d0d4e90518ad6adfd5f5d/mailnews/base/public/nsIMessenger.idl">file</a> |
<a href="/comm-central/annotate/9e8f283a8af138b0338d0d4e90518ad6adfd5f5d/mailnews/base/public/nsIMessenger.idl">annotate</a> |
<a href="/comm-central/diff/9e8f283a8af138b0338d0d4e90518ad6adfd5f5d/mailnews/base/public/nsIMessenger.idl">diff</a> |
<a href="/comm-central/comparison/9e8f283a8af138b0338d0d4e90518ad6adfd5f5d/mailnews/base/public/nsIMessenger.idl">comparison</a> |
<a href="/comm-central/log/9e8f283a8af138b0338d0d4e90518ad6adfd5f5d/mailnews/base/public/nsIMessenger.idl">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/9e8f283a8af138b0338d0d4e90518ad6adfd5f5d/mailnews/base/public/nsIMsgAccountManager.idl">mailnews/base/public/nsIMsgAccountManager.idl</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/9e8f283a8af138b0338d0d4e90518ad6adfd5f5d/mailnews/base/public/nsIMsgAccountManager.idl">file</a> |
<a href="/comm-central/annotate/9e8f283a8af138b0338d0d4e90518ad6adfd5f5d/mailnews/base/public/nsIMsgAccountManager.idl">annotate</a> |
<a href="/comm-central/diff/9e8f283a8af138b0338d0d4e90518ad6adfd5f5d/mailnews/base/public/nsIMsgAccountManager.idl">diff</a> |
<a href="/comm-central/comparison/9e8f283a8af138b0338d0d4e90518ad6adfd5f5d/mailnews/base/public/nsIMsgAccountManager.idl">comparison</a> |
<a href="/comm-central/log/9e8f283a8af138b0338d0d4e90518ad6adfd5f5d/mailnews/base/public/nsIMsgAccountManager.idl">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/9e8f283a8af138b0338d0d4e90518ad6adfd5f5d/mailnews/base/public/nsIMsgFolder.idl">mailnews/base/public/nsIMsgFolder.idl</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/9e8f283a8af138b0338d0d4e90518ad6adfd5f5d/mailnews/base/public/nsIMsgFolder.idl">file</a> |
<a href="/comm-central/annotate/9e8f283a8af138b0338d0d4e90518ad6adfd5f5d/mailnews/base/public/nsIMsgFolder.idl">annotate</a> |
<a href="/comm-central/diff/9e8f283a8af138b0338d0d4e90518ad6adfd5f5d/mailnews/base/public/nsIMsgFolder.idl">diff</a> |
<a href="/comm-central/comparison/9e8f283a8af138b0338d0d4e90518ad6adfd5f5d/mailnews/base/public/nsIMsgFolder.idl">comparison</a> |
<a href="/comm-central/log/9e8f283a8af138b0338d0d4e90518ad6adfd5f5d/mailnews/base/public/nsIMsgFolder.idl">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/9e8f283a8af138b0338d0d4e90518ad6adfd5f5d/mailnews/base/public/nsIMsgIdentity.idl">mailnews/base/public/nsIMsgIdentity.idl</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/9e8f283a8af138b0338d0d4e90518ad6adfd5f5d/mailnews/base/public/nsIMsgIdentity.idl">file</a> |
<a href="/comm-central/annotate/9e8f283a8af138b0338d0d4e90518ad6adfd5f5d/mailnews/base/public/nsIMsgIdentity.idl">annotate</a> |
<a href="/comm-central/diff/9e8f283a8af138b0338d0d4e90518ad6adfd5f5d/mailnews/base/public/nsIMsgIdentity.idl">diff</a> |
<a href="/comm-central/comparison/9e8f283a8af138b0338d0d4e90518ad6adfd5f5d/mailnews/base/public/nsIMsgIdentity.idl">comparison</a> |
<a href="/comm-central/log/9e8f283a8af138b0338d0d4e90518ad6adfd5f5d/mailnews/base/public/nsIMsgIdentity.idl">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/9e8f283a8af138b0338d0d4e90518ad6adfd5f5d/mailnews/base/public/nsIMsgIncomingServer.idl">mailnews/base/public/nsIMsgIncomingServer.idl</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/9e8f283a8af138b0338d0d4e90518ad6adfd5f5d/mailnews/base/public/nsIMsgIncomingServer.idl">file</a> |
<a href="/comm-central/annotate/9e8f283a8af138b0338d0d4e90518ad6adfd5f5d/mailnews/base/public/nsIMsgIncomingServer.idl">annotate</a> |
<a href="/comm-central/diff/9e8f283a8af138b0338d0d4e90518ad6adfd5f5d/mailnews/base/public/nsIMsgIncomingServer.idl">diff</a> |
<a href="/comm-central/comparison/9e8f283a8af138b0338d0d4e90518ad6adfd5f5d/mailnews/base/public/nsIMsgIncomingServer.idl">comparison</a> |
<a href="/comm-central/log/9e8f283a8af138b0338d0d4e90518ad6adfd5f5d/mailnews/base/public/nsIMsgIncomingServer.idl">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/9e8f283a8af138b0338d0d4e90518ad6adfd5f5d/mailnews/base/public/nsIMsgPluggableStore.idl">mailnews/base/public/nsIMsgPluggableStore.idl</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/9e8f283a8af138b0338d0d4e90518ad6adfd5f5d/mailnews/base/public/nsIMsgPluggableStore.idl">file</a> |
<a href="/comm-central/annotate/9e8f283a8af138b0338d0d4e90518ad6adfd5f5d/mailnews/base/public/nsIMsgPluggableStore.idl">annotate</a> |
<a href="/comm-central/diff/9e8f283a8af138b0338d0d4e90518ad6adfd5f5d/mailnews/base/public/nsIMsgPluggableStore.idl">diff</a> |
<a href="/comm-central/comparison/9e8f283a8af138b0338d0d4e90518ad6adfd5f5d/mailnews/base/public/nsIMsgPluggableStore.idl">comparison</a> |
<a href="/comm-central/log/9e8f283a8af138b0338d0d4e90518ad6adfd5f5d/mailnews/base/public/nsIMsgPluggableStore.idl">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/9e8f283a8af138b0338d0d4e90518ad6adfd5f5d/mailnews/base/public/nsIMsgProtocolInfo.idl">mailnews/base/public/nsIMsgProtocolInfo.idl</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/9e8f283a8af138b0338d0d4e90518ad6adfd5f5d/mailnews/base/public/nsIMsgProtocolInfo.idl">file</a> |
<a href="/comm-central/annotate/9e8f283a8af138b0338d0d4e90518ad6adfd5f5d/mailnews/base/public/nsIMsgProtocolInfo.idl">annotate</a> |
<a href="/comm-central/diff/9e8f283a8af138b0338d0d4e90518ad6adfd5f5d/mailnews/base/public/nsIMsgProtocolInfo.idl">diff</a> |
<a href="/comm-central/comparison/9e8f283a8af138b0338d0d4e90518ad6adfd5f5d/mailnews/base/public/nsIMsgProtocolInfo.idl">comparison</a> |
<a href="/comm-central/log/9e8f283a8af138b0338d0d4e90518ad6adfd5f5d/mailnews/base/public/nsIMsgProtocolInfo.idl">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/9e8f283a8af138b0338d0d4e90518ad6adfd5f5d/mailnews/base/search/public/nsIMsgFilterList.idl">mailnews/base/search/public/nsIMsgFilterList.idl</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/9e8f283a8af138b0338d0d4e90518ad6adfd5f5d/mailnews/base/search/public/nsIMsgFilterList.idl">file</a> |
<a href="/comm-central/annotate/9e8f283a8af138b0338d0d4e90518ad6adfd5f5d/mailnews/base/search/public/nsIMsgFilterList.idl">annotate</a> |
<a href="/comm-central/diff/9e8f283a8af138b0338d0d4e90518ad6adfd5f5d/mailnews/base/search/public/nsIMsgFilterList.idl">diff</a> |
<a href="/comm-central/comparison/9e8f283a8af138b0338d0d4e90518ad6adfd5f5d/mailnews/base/search/public/nsIMsgFilterList.idl">comparison</a> |
<a href="/comm-central/log/9e8f283a8af138b0338d0d4e90518ad6adfd5f5d/mailnews/base/search/public/nsIMsgFilterList.idl">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/9e8f283a8af138b0338d0d4e90518ad6adfd5f5d/mailnews/base/search/public/nsIMsgFilterPlugin.idl">mailnews/base/search/public/nsIMsgFilterPlugin.idl</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/9e8f283a8af138b0338d0d4e90518ad6adfd5f5d/mailnews/base/search/public/nsIMsgFilterPlugin.idl">file</a> |
<a href="/comm-central/annotate/9e8f283a8af138b0338d0d4e90518ad6adfd5f5d/mailnews/base/search/public/nsIMsgFilterPlugin.idl">annotate</a> |
<a href="/comm-central/diff/9e8f283a8af138b0338d0d4e90518ad6adfd5f5d/mailnews/base/search/public/nsIMsgFilterPlugin.idl">diff</a> |
<a href="/comm-central/comparison/9e8f283a8af138b0338d0d4e90518ad6adfd5f5d/mailnews/base/search/public/nsIMsgFilterPlugin.idl">comparison</a> |
<a href="/comm-central/log/9e8f283a8af138b0338d0d4e90518ad6adfd5f5d/mailnews/base/search/public/nsIMsgFilterPlugin.idl">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/9e8f283a8af138b0338d0d4e90518ad6adfd5f5d/mailnews/base/search/public/nsIMsgFilterService.idl">mailnews/base/search/public/nsIMsgFilterService.idl</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/9e8f283a8af138b0338d0d4e90518ad6adfd5f5d/mailnews/base/search/public/nsIMsgFilterService.idl">file</a> |
<a href="/comm-central/annotate/9e8f283a8af138b0338d0d4e90518ad6adfd5f5d/mailnews/base/search/public/nsIMsgFilterService.idl">annotate</a> |
<a href="/comm-central/diff/9e8f283a8af138b0338d0d4e90518ad6adfd5f5d/mailnews/base/search/public/nsIMsgFilterService.idl">diff</a> |
<a href="/comm-central/comparison/9e8f283a8af138b0338d0d4e90518ad6adfd5f5d/mailnews/base/search/public/nsIMsgFilterService.idl">comparison</a> |
<a href="/comm-central/log/9e8f283a8af138b0338d0d4e90518ad6adfd5f5d/mailnews/base/search/public/nsIMsgFilterService.idl">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/9e8f283a8af138b0338d0d4e90518ad6adfd5f5d/mailnews/base/search/public/nsIMsgSearchScopeTerm.idl">mailnews/base/search/public/nsIMsgSearchScopeTerm.idl</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/9e8f283a8af138b0338d0d4e90518ad6adfd5f5d/mailnews/base/search/public/nsIMsgSearchScopeTerm.idl">file</a> |
<a href="/comm-central/annotate/9e8f283a8af138b0338d0d4e90518ad6adfd5f5d/mailnews/base/search/public/nsIMsgSearchScopeTerm.idl">annotate</a> |
<a href="/comm-central/diff/9e8f283a8af138b0338d0d4e90518ad6adfd5f5d/mailnews/base/search/public/nsIMsgSearchScopeTerm.idl">diff</a> |
<a href="/comm-central/comparison/9e8f283a8af138b0338d0d4e90518ad6adfd5f5d/mailnews/base/search/public/nsIMsgSearchScopeTerm.idl">comparison</a> |
<a href="/comm-central/log/9e8f283a8af138b0338d0d4e90518ad6adfd5f5d/mailnews/base/search/public/nsIMsgSearchScopeTerm.idl">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/9e8f283a8af138b0338d0d4e90518ad6adfd5f5d/mailnews/base/search/public/nsMsgBodyHandler.h">mailnews/base/search/public/nsMsgBodyHandler.h</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/9e8f283a8af138b0338d0d4e90518ad6adfd5f5d/mailnews/base/search/public/nsMsgBodyHandler.h">file</a> |
<a href="/comm-central/annotate/9e8f283a8af138b0338d0d4e90518ad6adfd5f5d/mailnews/base/search/public/nsMsgBodyHandler.h">annotate</a> |
<a href="/comm-central/diff/9e8f283a8af138b0338d0d4e90518ad6adfd5f5d/mailnews/base/search/public/nsMsgBodyHandler.h">diff</a> |
<a href="/comm-central/comparison/9e8f283a8af138b0338d0d4e90518ad6adfd5f5d/mailnews/base/search/public/nsMsgBodyHandler.h">comparison</a> |
<a href="/comm-central/log/9e8f283a8af138b0338d0d4e90518ad6adfd5f5d/mailnews/base/search/public/nsMsgBodyHandler.h">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/9e8f283a8af138b0338d0d4e90518ad6adfd5f5d/mailnews/base/search/src/nsMsgBodyHandler.cpp">mailnews/base/search/src/nsMsgBodyHandler.cpp</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/9e8f283a8af138b0338d0d4e90518ad6adfd5f5d/mailnews/base/search/src/nsMsgBodyHandler.cpp">file</a> |
<a href="/comm-central/annotate/9e8f283a8af138b0338d0d4e90518ad6adfd5f5d/mailnews/base/search/src/nsMsgBodyHandler.cpp">annotate</a> |
<a href="/comm-central/diff/9e8f283a8af138b0338d0d4e90518ad6adfd5f5d/mailnews/base/search/src/nsMsgBodyHandler.cpp">diff</a> |
<a href="/comm-central/comparison/9e8f283a8af138b0338d0d4e90518ad6adfd5f5d/mailnews/base/search/src/nsMsgBodyHandler.cpp">comparison</a> |
<a href="/comm-central/log/9e8f283a8af138b0338d0d4e90518ad6adfd5f5d/mailnews/base/search/src/nsMsgBodyHandler.cpp">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/9e8f283a8af138b0338d0d4e90518ad6adfd5f5d/mailnews/base/search/src/nsMsgFilterList.cpp">mailnews/base/search/src/nsMsgFilterList.cpp</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/9e8f283a8af138b0338d0d4e90518ad6adfd5f5d/mailnews/base/search/src/nsMsgFilterList.cpp">file</a> |
<a href="/comm-central/annotate/9e8f283a8af138b0338d0d4e90518ad6adfd5f5d/mailnews/base/search/src/nsMsgFilterList.cpp">annotate</a> |
<a href="/comm-central/diff/9e8f283a8af138b0338d0d4e90518ad6adfd5f5d/mailnews/base/search/src/nsMsgFilterList.cpp">diff</a> |
<a href="/comm-central/comparison/9e8f283a8af138b0338d0d4e90518ad6adfd5f5d/mailnews/base/search/src/nsMsgFilterList.cpp">comparison</a> |
<a href="/comm-central/log/9e8f283a8af138b0338d0d4e90518ad6adfd5f5d/mailnews/base/search/src/nsMsgFilterList.cpp">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/9e8f283a8af138b0338d0d4e90518ad6adfd5f5d/mailnews/base/search/src/nsMsgFilterList.h">mailnews/base/search/src/nsMsgFilterList.h</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/9e8f283a8af138b0338d0d4e90518ad6adfd5f5d/mailnews/base/search/src/nsMsgFilterList.h">file</a> |
<a href="/comm-central/annotate/9e8f283a8af138b0338d0d4e90518ad6adfd5f5d/mailnews/base/search/src/nsMsgFilterList.h">annotate</a> |
<a href="/comm-central/diff/9e8f283a8af138b0338d0d4e90518ad6adfd5f5d/mailnews/base/search/src/nsMsgFilterList.h">diff</a> |
<a href="/comm-central/comparison/9e8f283a8af138b0338d0d4e90518ad6adfd5f5d/mailnews/base/search/src/nsMsgFilterList.h">comparison</a> |
<a href="/comm-central/log/9e8f283a8af138b0338d0d4e90518ad6adfd5f5d/mailnews/base/search/src/nsMsgFilterList.h">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/9e8f283a8af138b0338d0d4e90518ad6adfd5f5d/mailnews/base/search/src/nsMsgFilterService.cpp">mailnews/base/search/src/nsMsgFilterService.cpp</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/9e8f283a8af138b0338d0d4e90518ad6adfd5f5d/mailnews/base/search/src/nsMsgFilterService.cpp">file</a> |
<a href="/comm-central/annotate/9e8f283a8af138b0338d0d4e90518ad6adfd5f5d/mailnews/base/search/src/nsMsgFilterService.cpp">annotate</a> |
<a href="/comm-central/diff/9e8f283a8af138b0338d0d4e90518ad6adfd5f5d/mailnews/base/search/src/nsMsgFilterService.cpp">diff</a> |
<a href="/comm-central/comparison/9e8f283a8af138b0338d0d4e90518ad6adfd5f5d/mailnews/base/search/src/nsMsgFilterService.cpp">comparison</a> |
<a href="/comm-central/log/9e8f283a8af138b0338d0d4e90518ad6adfd5f5d/mailnews/base/search/src/nsMsgFilterService.cpp">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/9e8f283a8af138b0338d0d4e90518ad6adfd5f5d/mailnews/base/search/src/nsMsgFilterService.h">mailnews/base/search/src/nsMsgFilterService.h</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/9e8f283a8af138b0338d0d4e90518ad6adfd5f5d/mailnews/base/search/src/nsMsgFilterService.h">file</a> |
<a href="/comm-central/annotate/9e8f283a8af138b0338d0d4e90518ad6adfd5f5d/mailnews/base/search/src/nsMsgFilterService.h">annotate</a> |
<a href="/comm-central/diff/9e8f283a8af138b0338d0d4e90518ad6adfd5f5d/mailnews/base/search/src/nsMsgFilterService.h">diff</a> |
<a href="/comm-central/comparison/9e8f283a8af138b0338d0d4e90518ad6adfd5f5d/mailnews/base/search/src/nsMsgFilterService.h">comparison</a> |
<a href="/comm-central/log/9e8f283a8af138b0338d0d4e90518ad6adfd5f5d/mailnews/base/search/src/nsMsgFilterService.h">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/9e8f283a8af138b0338d0d4e90518ad6adfd5f5d/mailnews/base/search/src/nsMsgSearchTerm.cpp">mailnews/base/search/src/nsMsgSearchTerm.cpp</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/9e8f283a8af138b0338d0d4e90518ad6adfd5f5d/mailnews/base/search/src/nsMsgSearchTerm.cpp">file</a> |
<a href="/comm-central/annotate/9e8f283a8af138b0338d0d4e90518ad6adfd5f5d/mailnews/base/search/src/nsMsgSearchTerm.cpp">annotate</a> |
<a href="/comm-central/diff/9e8f283a8af138b0338d0d4e90518ad6adfd5f5d/mailnews/base/search/src/nsMsgSearchTerm.cpp">diff</a> |
<a href="/comm-central/comparison/9e8f283a8af138b0338d0d4e90518ad6adfd5f5d/mailnews/base/search/src/nsMsgSearchTerm.cpp">comparison</a> |
<a href="/comm-central/log/9e8f283a8af138b0338d0d4e90518ad6adfd5f5d/mailnews/base/search/src/nsMsgSearchTerm.cpp">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/9e8f283a8af138b0338d0d4e90518ad6adfd5f5d/mailnews/base/src/nsMessenger.cpp">mailnews/base/src/nsMessenger.cpp</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/9e8f283a8af138b0338d0d4e90518ad6adfd5f5d/mailnews/base/src/nsMessenger.cpp">file</a> |
<a href="/comm-central/annotate/9e8f283a8af138b0338d0d4e90518ad6adfd5f5d/mailnews/base/src/nsMessenger.cpp">annotate</a> |
<a href="/comm-central/diff/9e8f283a8af138b0338d0d4e90518ad6adfd5f5d/mailnews/base/src/nsMessenger.cpp">diff</a> |
<a href="/comm-central/comparison/9e8f283a8af138b0338d0d4e90518ad6adfd5f5d/mailnews/base/src/nsMessenger.cpp">comparison</a> |
<a href="/comm-central/log/9e8f283a8af138b0338d0d4e90518ad6adfd5f5d/mailnews/base/src/nsMessenger.cpp">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/9e8f283a8af138b0338d0d4e90518ad6adfd5f5d/mailnews/base/src/nsMessenger.h">mailnews/base/src/nsMessenger.h</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/9e8f283a8af138b0338d0d4e90518ad6adfd5f5d/mailnews/base/src/nsMessenger.h">file</a> |
<a href="/comm-central/annotate/9e8f283a8af138b0338d0d4e90518ad6adfd5f5d/mailnews/base/src/nsMessenger.h">annotate</a> |
<a href="/comm-central/diff/9e8f283a8af138b0338d0d4e90518ad6adfd5f5d/mailnews/base/src/nsMessenger.h">diff</a> |
<a href="/comm-central/comparison/9e8f283a8af138b0338d0d4e90518ad6adfd5f5d/mailnews/base/src/nsMessenger.h">comparison</a> |
<a href="/comm-central/log/9e8f283a8af138b0338d0d4e90518ad6adfd5f5d/mailnews/base/src/nsMessenger.h">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/9e8f283a8af138b0338d0d4e90518ad6adfd5f5d/mailnews/base/src/nsMsgAccountManager.cpp">mailnews/base/src/nsMsgAccountManager.cpp</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/9e8f283a8af138b0338d0d4e90518ad6adfd5f5d/mailnews/base/src/nsMsgAccountManager.cpp">file</a> |
<a href="/comm-central/annotate/9e8f283a8af138b0338d0d4e90518ad6adfd5f5d/mailnews/base/src/nsMsgAccountManager.cpp">annotate</a> |
<a href="/comm-central/diff/9e8f283a8af138b0338d0d4e90518ad6adfd5f5d/mailnews/base/src/nsMsgAccountManager.cpp">diff</a> |
<a href="/comm-central/comparison/9e8f283a8af138b0338d0d4e90518ad6adfd5f5d/mailnews/base/src/nsMsgAccountManager.cpp">comparison</a> |
<a href="/comm-central/log/9e8f283a8af138b0338d0d4e90518ad6adfd5f5d/mailnews/base/src/nsMsgAccountManager.cpp">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/9e8f283a8af138b0338d0d4e90518ad6adfd5f5d/mailnews/base/src/nsMsgAccountManager.h">mailnews/base/src/nsMsgAccountManager.h</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/9e8f283a8af138b0338d0d4e90518ad6adfd5f5d/mailnews/base/src/nsMsgAccountManager.h">file</a> |
<a href="/comm-central/annotate/9e8f283a8af138b0338d0d4e90518ad6adfd5f5d/mailnews/base/src/nsMsgAccountManager.h">annotate</a> |
<a href="/comm-central/diff/9e8f283a8af138b0338d0d4e90518ad6adfd5f5d/mailnews/base/src/nsMsgAccountManager.h">diff</a> |
<a href="/comm-central/comparison/9e8f283a8af138b0338d0d4e90518ad6adfd5f5d/mailnews/base/src/nsMsgAccountManager.h">comparison</a> |
<a href="/comm-central/log/9e8f283a8af138b0338d0d4e90518ad6adfd5f5d/mailnews/base/src/nsMsgAccountManager.h">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/9e8f283a8af138b0338d0d4e90518ad6adfd5f5d/mailnews/base/src/nsMsgFolderCompactor.cpp">mailnews/base/src/nsMsgFolderCompactor.cpp</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/9e8f283a8af138b0338d0d4e90518ad6adfd5f5d/mailnews/base/src/nsMsgFolderCompactor.cpp">file</a> |
<a href="/comm-central/annotate/9e8f283a8af138b0338d0d4e90518ad6adfd5f5d/mailnews/base/src/nsMsgFolderCompactor.cpp">annotate</a> |
<a href="/comm-central/diff/9e8f283a8af138b0338d0d4e90518ad6adfd5f5d/mailnews/base/src/nsMsgFolderCompactor.cpp">diff</a> |
<a href="/comm-central/comparison/9e8f283a8af138b0338d0d4e90518ad6adfd5f5d/mailnews/base/src/nsMsgFolderCompactor.cpp">comparison</a> |
<a href="/comm-central/log/9e8f283a8af138b0338d0d4e90518ad6adfd5f5d/mailnews/base/src/nsMsgFolderCompactor.cpp">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/9e8f283a8af138b0338d0d4e90518ad6adfd5f5d/mailnews/base/src/nsMsgFolderCompactor.h">mailnews/base/src/nsMsgFolderCompactor.h</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/9e8f283a8af138b0338d0d4e90518ad6adfd5f5d/mailnews/base/src/nsMsgFolderCompactor.h">file</a> |
<a href="/comm-central/annotate/9e8f283a8af138b0338d0d4e90518ad6adfd5f5d/mailnews/base/src/nsMsgFolderCompactor.h">annotate</a> |
<a href="/comm-central/diff/9e8f283a8af138b0338d0d4e90518ad6adfd5f5d/mailnews/base/src/nsMsgFolderCompactor.h">diff</a> |
<a href="/comm-central/comparison/9e8f283a8af138b0338d0d4e90518ad6adfd5f5d/mailnews/base/src/nsMsgFolderCompactor.h">comparison</a> |
<a href="/comm-central/log/9e8f283a8af138b0338d0d4e90518ad6adfd5f5d/mailnews/base/src/nsMsgFolderCompactor.h">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/9e8f283a8af138b0338d0d4e90518ad6adfd5f5d/mailnews/base/src/nsSpamSettings.cpp">mailnews/base/src/nsSpamSettings.cpp</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/9e8f283a8af138b0338d0d4e90518ad6adfd5f5d/mailnews/base/src/nsSpamSettings.cpp">file</a> |
<a href="/comm-central/annotate/9e8f283a8af138b0338d0d4e90518ad6adfd5f5d/mailnews/base/src/nsSpamSettings.cpp">annotate</a> |
<a href="/comm-central/diff/9e8f283a8af138b0338d0d4e90518ad6adfd5f5d/mailnews/base/src/nsSpamSettings.cpp">diff</a> |
<a href="/comm-central/comparison/9e8f283a8af138b0338d0d4e90518ad6adfd5f5d/mailnews/base/src/nsSpamSettings.cpp">comparison</a> |
<a href="/comm-central/log/9e8f283a8af138b0338d0d4e90518ad6adfd5f5d/mailnews/base/src/nsSpamSettings.cpp">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/9e8f283a8af138b0338d0d4e90518ad6adfd5f5d/mailnews/base/util/nsMsgDBFolder.cpp">mailnews/base/util/nsMsgDBFolder.cpp</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/9e8f283a8af138b0338d0d4e90518ad6adfd5f5d/mailnews/base/util/nsMsgDBFolder.cpp">file</a> |
<a href="/comm-central/annotate/9e8f283a8af138b0338d0d4e90518ad6adfd5f5d/mailnews/base/util/nsMsgDBFolder.cpp">annotate</a> |
<a href="/comm-central/diff/9e8f283a8af138b0338d0d4e90518ad6adfd5f5d/mailnews/base/util/nsMsgDBFolder.cpp">diff</a> |
<a href="/comm-central/comparison/9e8f283a8af138b0338d0d4e90518ad6adfd5f5d/mailnews/base/util/nsMsgDBFolder.cpp">comparison</a> |
<a href="/comm-central/log/9e8f283a8af138b0338d0d4e90518ad6adfd5f5d/mailnews/base/util/nsMsgDBFolder.cpp">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/9e8f283a8af138b0338d0d4e90518ad6adfd5f5d/mailnews/base/util/nsMsgDBFolder.h">mailnews/base/util/nsMsgDBFolder.h</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/9e8f283a8af138b0338d0d4e90518ad6adfd5f5d/mailnews/base/util/nsMsgDBFolder.h">file</a> |
<a href="/comm-central/annotate/9e8f283a8af138b0338d0d4e90518ad6adfd5f5d/mailnews/base/util/nsMsgDBFolder.h">annotate</a> |
<a href="/comm-central/diff/9e8f283a8af138b0338d0d4e90518ad6adfd5f5d/mailnews/base/util/nsMsgDBFolder.h">diff</a> |
<a href="/comm-central/comparison/9e8f283a8af138b0338d0d4e90518ad6adfd5f5d/mailnews/base/util/nsMsgDBFolder.h">comparison</a> |
<a href="/comm-central/log/9e8f283a8af138b0338d0d4e90518ad6adfd5f5d/mailnews/base/util/nsMsgDBFolder.h">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/9e8f283a8af138b0338d0d4e90518ad6adfd5f5d/mailnews/base/util/nsMsgFileStream.cpp">mailnews/base/util/nsMsgFileStream.cpp</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/9e8f283a8af138b0338d0d4e90518ad6adfd5f5d/mailnews/base/util/nsMsgFileStream.cpp">file</a> |
<a href="/comm-central/annotate/9e8f283a8af138b0338d0d4e90518ad6adfd5f5d/mailnews/base/util/nsMsgFileStream.cpp">annotate</a> |
<a href="/comm-central/diff/9e8f283a8af138b0338d0d4e90518ad6adfd5f5d/mailnews/base/util/nsMsgFileStream.cpp">diff</a> |
<a href="/comm-central/comparison/9e8f283a8af138b0338d0d4e90518ad6adfd5f5d/mailnews/base/util/nsMsgFileStream.cpp">comparison</a> |
<a href="/comm-central/log/9e8f283a8af138b0338d0d4e90518ad6adfd5f5d/mailnews/base/util/nsMsgFileStream.cpp">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/9e8f283a8af138b0338d0d4e90518ad6adfd5f5d/mailnews/base/util/nsMsgFileStream.h">mailnews/base/util/nsMsgFileStream.h</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/9e8f283a8af138b0338d0d4e90518ad6adfd5f5d/mailnews/base/util/nsMsgFileStream.h">file</a> |
<a href="/comm-central/annotate/9e8f283a8af138b0338d0d4e90518ad6adfd5f5d/mailnews/base/util/nsMsgFileStream.h">annotate</a> |
<a href="/comm-central/diff/9e8f283a8af138b0338d0d4e90518ad6adfd5f5d/mailnews/base/util/nsMsgFileStream.h">diff</a> |
<a href="/comm-central/comparison/9e8f283a8af138b0338d0d4e90518ad6adfd5f5d/mailnews/base/util/nsMsgFileStream.h">comparison</a> |
<a href="/comm-central/log/9e8f283a8af138b0338d0d4e90518ad6adfd5f5d/mailnews/base/util/nsMsgFileStream.h">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/9e8f283a8af138b0338d0d4e90518ad6adfd5f5d/mailnews/base/util/nsMsgI18N.cpp">mailnews/base/util/nsMsgI18N.cpp</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/9e8f283a8af138b0338d0d4e90518ad6adfd5f5d/mailnews/base/util/nsMsgI18N.cpp">file</a> |
<a href="/comm-central/annotate/9e8f283a8af138b0338d0d4e90518ad6adfd5f5d/mailnews/base/util/nsMsgI18N.cpp">annotate</a> |
<a href="/comm-central/diff/9e8f283a8af138b0338d0d4e90518ad6adfd5f5d/mailnews/base/util/nsMsgI18N.cpp">diff</a> |
<a href="/comm-central/comparison/9e8f283a8af138b0338d0d4e90518ad6adfd5f5d/mailnews/base/util/nsMsgI18N.cpp">comparison</a> |
<a href="/comm-central/log/9e8f283a8af138b0338d0d4e90518ad6adfd5f5d/mailnews/base/util/nsMsgI18N.cpp">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/9e8f283a8af138b0338d0d4e90518ad6adfd5f5d/mailnews/base/util/nsMsgI18N.h">mailnews/base/util/nsMsgI18N.h</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/9e8f283a8af138b0338d0d4e90518ad6adfd5f5d/mailnews/base/util/nsMsgI18N.h">file</a> |
<a href="/comm-central/annotate/9e8f283a8af138b0338d0d4e90518ad6adfd5f5d/mailnews/base/util/nsMsgI18N.h">annotate</a> |
<a href="/comm-central/diff/9e8f283a8af138b0338d0d4e90518ad6adfd5f5d/mailnews/base/util/nsMsgI18N.h">diff</a> |
<a href="/comm-central/comparison/9e8f283a8af138b0338d0d4e90518ad6adfd5f5d/mailnews/base/util/nsMsgI18N.h">comparison</a> |
<a href="/comm-central/log/9e8f283a8af138b0338d0d4e90518ad6adfd5f5d/mailnews/base/util/nsMsgI18N.h">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/9e8f283a8af138b0338d0d4e90518ad6adfd5f5d/mailnews/base/util/nsMsgIdentity.cpp">mailnews/base/util/nsMsgIdentity.cpp</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/9e8f283a8af138b0338d0d4e90518ad6adfd5f5d/mailnews/base/util/nsMsgIdentity.cpp">file</a> |
<a href="/comm-central/annotate/9e8f283a8af138b0338d0d4e90518ad6adfd5f5d/mailnews/base/util/nsMsgIdentity.cpp">annotate</a> |
<a href="/comm-central/diff/9e8f283a8af138b0338d0d4e90518ad6adfd5f5d/mailnews/base/util/nsMsgIdentity.cpp">diff</a> |
<a href="/comm-central/comparison/9e8f283a8af138b0338d0d4e90518ad6adfd5f5d/mailnews/base/util/nsMsgIdentity.cpp">comparison</a> |
<a href="/comm-central/log/9e8f283a8af138b0338d0d4e90518ad6adfd5f5d/mailnews/base/util/nsMsgIdentity.cpp">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/9e8f283a8af138b0338d0d4e90518ad6adfd5f5d/mailnews/base/util/nsMsgIncomingServer.cpp">mailnews/base/util/nsMsgIncomingServer.cpp</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/9e8f283a8af138b0338d0d4e90518ad6adfd5f5d/mailnews/base/util/nsMsgIncomingServer.cpp">file</a> |
<a href="/comm-central/annotate/9e8f283a8af138b0338d0d4e90518ad6adfd5f5d/mailnews/base/util/nsMsgIncomingServer.cpp">annotate</a> |
<a href="/comm-central/diff/9e8f283a8af138b0338d0d4e90518ad6adfd5f5d/mailnews/base/util/nsMsgIncomingServer.cpp">diff</a> |
<a href="/comm-central/comparison/9e8f283a8af138b0338d0d4e90518ad6adfd5f5d/mailnews/base/util/nsMsgIncomingServer.cpp">comparison</a> |
<a href="/comm-central/log/9e8f283a8af138b0338d0d4e90518ad6adfd5f5d/mailnews/base/util/nsMsgIncomingServer.cpp">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/9e8f283a8af138b0338d0d4e90518ad6adfd5f5d/mailnews/base/util/nsMsgIncomingServer.h">mailnews/base/util/nsMsgIncomingServer.h</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/9e8f283a8af138b0338d0d4e90518ad6adfd5f5d/mailnews/base/util/nsMsgIncomingServer.h">file</a> |
<a href="/comm-central/annotate/9e8f283a8af138b0338d0d4e90518ad6adfd5f5d/mailnews/base/util/nsMsgIncomingServer.h">annotate</a> |
<a href="/comm-central/diff/9e8f283a8af138b0338d0d4e90518ad6adfd5f5d/mailnews/base/util/nsMsgIncomingServer.h">diff</a> |
<a href="/comm-central/comparison/9e8f283a8af138b0338d0d4e90518ad6adfd5f5d/mailnews/base/util/nsMsgIncomingServer.h">comparison</a> |
<a href="/comm-central/log/9e8f283a8af138b0338d0d4e90518ad6adfd5f5d/mailnews/base/util/nsMsgIncomingServer.h">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/9e8f283a8af138b0338d0d4e90518ad6adfd5f5d/mailnews/base/util/nsMsgMailNewsUrl.cpp">mailnews/base/util/nsMsgMailNewsUrl.cpp</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/9e8f283a8af138b0338d0d4e90518ad6adfd5f5d/mailnews/base/util/nsMsgMailNewsUrl.cpp">file</a> |
<a href="/comm-central/annotate/9e8f283a8af138b0338d0d4e90518ad6adfd5f5d/mailnews/base/util/nsMsgMailNewsUrl.cpp">annotate</a> |
<a href="/comm-central/diff/9e8f283a8af138b0338d0d4e90518ad6adfd5f5d/mailnews/base/util/nsMsgMailNewsUrl.cpp">diff</a> |
<a href="/comm-central/comparison/9e8f283a8af138b0338d0d4e90518ad6adfd5f5d/mailnews/base/util/nsMsgMailNewsUrl.cpp">comparison</a> |
<a href="/comm-central/log/9e8f283a8af138b0338d0d4e90518ad6adfd5f5d/mailnews/base/util/nsMsgMailNewsUrl.cpp">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/9e8f283a8af138b0338d0d4e90518ad6adfd5f5d/mailnews/base/util/nsMsgUtils.cpp">mailnews/base/util/nsMsgUtils.cpp</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/9e8f283a8af138b0338d0d4e90518ad6adfd5f5d/mailnews/base/util/nsMsgUtils.cpp">file</a> |
<a href="/comm-central/annotate/9e8f283a8af138b0338d0d4e90518ad6adfd5f5d/mailnews/base/util/nsMsgUtils.cpp">annotate</a> |
<a href="/comm-central/diff/9e8f283a8af138b0338d0d4e90518ad6adfd5f5d/mailnews/base/util/nsMsgUtils.cpp">diff</a> |
<a href="/comm-central/comparison/9e8f283a8af138b0338d0d4e90518ad6adfd5f5d/mailnews/base/util/nsMsgUtils.cpp">comparison</a> |
<a href="/comm-central/log/9e8f283a8af138b0338d0d4e90518ad6adfd5f5d/mailnews/base/util/nsMsgUtils.cpp">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/9e8f283a8af138b0338d0d4e90518ad6adfd5f5d/mailnews/base/util/nsMsgUtils.h">mailnews/base/util/nsMsgUtils.h</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/9e8f283a8af138b0338d0d4e90518ad6adfd5f5d/mailnews/base/util/nsMsgUtils.h">file</a> |
<a href="/comm-central/annotate/9e8f283a8af138b0338d0d4e90518ad6adfd5f5d/mailnews/base/util/nsMsgUtils.h">annotate</a> |
<a href="/comm-central/diff/9e8f283a8af138b0338d0d4e90518ad6adfd5f5d/mailnews/base/util/nsMsgUtils.h">diff</a> |
<a href="/comm-central/comparison/9e8f283a8af138b0338d0d4e90518ad6adfd5f5d/mailnews/base/util/nsMsgUtils.h">comparison</a> |
<a href="/comm-central/log/9e8f283a8af138b0338d0d4e90518ad6adfd5f5d/mailnews/base/util/nsMsgUtils.h">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/9e8f283a8af138b0338d0d4e90518ad6adfd5f5d/mailnews/compose/public/nsIMsgSend.idl">mailnews/compose/public/nsIMsgSend.idl</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/9e8f283a8af138b0338d0d4e90518ad6adfd5f5d/mailnews/compose/public/nsIMsgSend.idl">file</a> |
<a href="/comm-central/annotate/9e8f283a8af138b0338d0d4e90518ad6adfd5f5d/mailnews/compose/public/nsIMsgSend.idl">annotate</a> |
<a href="/comm-central/diff/9e8f283a8af138b0338d0d4e90518ad6adfd5f5d/mailnews/compose/public/nsIMsgSend.idl">diff</a> |
<a href="/comm-central/comparison/9e8f283a8af138b0338d0d4e90518ad6adfd5f5d/mailnews/compose/public/nsIMsgSend.idl">comparison</a> |
<a href="/comm-central/log/9e8f283a8af138b0338d0d4e90518ad6adfd5f5d/mailnews/compose/public/nsIMsgSend.idl">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/9e8f283a8af138b0338d0d4e90518ad6adfd5f5d/mailnews/compose/public/nsIURLFetcher.idl">mailnews/compose/public/nsIURLFetcher.idl</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/9e8f283a8af138b0338d0d4e90518ad6adfd5f5d/mailnews/compose/public/nsIURLFetcher.idl">file</a> |
<a href="/comm-central/annotate/9e8f283a8af138b0338d0d4e90518ad6adfd5f5d/mailnews/compose/public/nsIURLFetcher.idl">annotate</a> |
<a href="/comm-central/diff/9e8f283a8af138b0338d0d4e90518ad6adfd5f5d/mailnews/compose/public/nsIURLFetcher.idl">diff</a> |
<a href="/comm-central/comparison/9e8f283a8af138b0338d0d4e90518ad6adfd5f5d/mailnews/compose/public/nsIURLFetcher.idl">comparison</a> |
<a href="/comm-central/log/9e8f283a8af138b0338d0d4e90518ad6adfd5f5d/mailnews/compose/public/nsIURLFetcher.idl">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/9e8f283a8af138b0338d0d4e90518ad6adfd5f5d/mailnews/compose/src/nsMsgAppleDouble.h">mailnews/compose/src/nsMsgAppleDouble.h</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/9e8f283a8af138b0338d0d4e90518ad6adfd5f5d/mailnews/compose/src/nsMsgAppleDouble.h">file</a> |
<a href="/comm-central/annotate/9e8f283a8af138b0338d0d4e90518ad6adfd5f5d/mailnews/compose/src/nsMsgAppleDouble.h">annotate</a> |
<a href="/comm-central/diff/9e8f283a8af138b0338d0d4e90518ad6adfd5f5d/mailnews/compose/src/nsMsgAppleDouble.h">diff</a> |
<a href="/comm-central/comparison/9e8f283a8af138b0338d0d4e90518ad6adfd5f5d/mailnews/compose/src/nsMsgAppleDouble.h">comparison</a> |
<a href="/comm-central/log/9e8f283a8af138b0338d0d4e90518ad6adfd5f5d/mailnews/compose/src/nsMsgAppleDouble.h">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/9e8f283a8af138b0338d0d4e90518ad6adfd5f5d/mailnews/compose/src/nsMsgAppleDoubleEncode.cpp">mailnews/compose/src/nsMsgAppleDoubleEncode.cpp</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/9e8f283a8af138b0338d0d4e90518ad6adfd5f5d/mailnews/compose/src/nsMsgAppleDoubleEncode.cpp">file</a> |
<a href="/comm-central/annotate/9e8f283a8af138b0338d0d4e90518ad6adfd5f5d/mailnews/compose/src/nsMsgAppleDoubleEncode.cpp">annotate</a> |
<a href="/comm-central/diff/9e8f283a8af138b0338d0d4e90518ad6adfd5f5d/mailnews/compose/src/nsMsgAppleDoubleEncode.cpp">diff</a> |
<a href="/comm-central/comparison/9e8f283a8af138b0338d0d4e90518ad6adfd5f5d/mailnews/compose/src/nsMsgAppleDoubleEncode.cpp">comparison</a> |
<a href="/comm-central/log/9e8f283a8af138b0338d0d4e90518ad6adfd5f5d/mailnews/compose/src/nsMsgAppleDoubleEncode.cpp">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/9e8f283a8af138b0338d0d4e90518ad6adfd5f5d/mailnews/compose/src/nsMsgAppleEncode.cpp">mailnews/compose/src/nsMsgAppleEncode.cpp</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/9e8f283a8af138b0338d0d4e90518ad6adfd5f5d/mailnews/compose/src/nsMsgAppleEncode.cpp">file</a> |
<a href="/comm-central/annotate/9e8f283a8af138b0338d0d4e90518ad6adfd5f5d/mailnews/compose/src/nsMsgAppleEncode.cpp">annotate</a> |
<a href="/comm-central/diff/9e8f283a8af138b0338d0d4e90518ad6adfd5f5d/mailnews/compose/src/nsMsgAppleEncode.cpp">diff</a> |
<a href="/comm-central/comparison/9e8f283a8af138b0338d0d4e90518ad6adfd5f5d/mailnews/compose/src/nsMsgAppleEncode.cpp">comparison</a> |
<a href="/comm-central/log/9e8f283a8af138b0338d0d4e90518ad6adfd5f5d/mailnews/compose/src/nsMsgAppleEncode.cpp">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/9e8f283a8af138b0338d0d4e90518ad6adfd5f5d/mailnews/compose/src/nsMsgAttachment.cpp">mailnews/compose/src/nsMsgAttachment.cpp</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/9e8f283a8af138b0338d0d4e90518ad6adfd5f5d/mailnews/compose/src/nsMsgAttachment.cpp">file</a> |
<a href="/comm-central/annotate/9e8f283a8af138b0338d0d4e90518ad6adfd5f5d/mailnews/compose/src/nsMsgAttachment.cpp">annotate</a> |
<a href="/comm-central/diff/9e8f283a8af138b0338d0d4e90518ad6adfd5f5d/mailnews/compose/src/nsMsgAttachment.cpp">diff</a> |
<a href="/comm-central/comparison/9e8f283a8af138b0338d0d4e90518ad6adfd5f5d/mailnews/compose/src/nsMsgAttachment.cpp">comparison</a> |
<a href="/comm-central/log/9e8f283a8af138b0338d0d4e90518ad6adfd5f5d/mailnews/compose/src/nsMsgAttachment.cpp">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/9e8f283a8af138b0338d0d4e90518ad6adfd5f5d/mailnews/compose/src/nsMsgAttachmentHandler.cpp">mailnews/compose/src/nsMsgAttachmentHandler.cpp</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/9e8f283a8af138b0338d0d4e90518ad6adfd5f5d/mailnews/compose/src/nsMsgAttachmentHandler.cpp">file</a> |
<a href="/comm-central/annotate/9e8f283a8af138b0338d0d4e90518ad6adfd5f5d/mailnews/compose/src/nsMsgAttachmentHandler.cpp">annotate</a> |
<a href="/comm-central/diff/9e8f283a8af138b0338d0d4e90518ad6adfd5f5d/mailnews/compose/src/nsMsgAttachmentHandler.cpp">diff</a> |
<a href="/comm-central/comparison/9e8f283a8af138b0338d0d4e90518ad6adfd5f5d/mailnews/compose/src/nsMsgAttachmentHandler.cpp">comparison</a> |
<a href="/comm-central/log/9e8f283a8af138b0338d0d4e90518ad6adfd5f5d/mailnews/compose/src/nsMsgAttachmentHandler.cpp">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/9e8f283a8af138b0338d0d4e90518ad6adfd5f5d/mailnews/compose/src/nsMsgAttachmentHandler.h">mailnews/compose/src/nsMsgAttachmentHandler.h</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/9e8f283a8af138b0338d0d4e90518ad6adfd5f5d/mailnews/compose/src/nsMsgAttachmentHandler.h">file</a> |
<a href="/comm-central/annotate/9e8f283a8af138b0338d0d4e90518ad6adfd5f5d/mailnews/compose/src/nsMsgAttachmentHandler.h">annotate</a> |
<a href="/comm-central/diff/9e8f283a8af138b0338d0d4e90518ad6adfd5f5d/mailnews/compose/src/nsMsgAttachmentHandler.h">diff</a> |
<a href="/comm-central/comparison/9e8f283a8af138b0338d0d4e90518ad6adfd5f5d/mailnews/compose/src/nsMsgAttachmentHandler.h">comparison</a> |
<a href="/comm-central/log/9e8f283a8af138b0338d0d4e90518ad6adfd5f5d/mailnews/compose/src/nsMsgAttachmentHandler.h">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/9e8f283a8af138b0338d0d4e90518ad6adfd5f5d/mailnews/compose/src/nsMsgCompose.cpp">mailnews/compose/src/nsMsgCompose.cpp</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/9e8f283a8af138b0338d0d4e90518ad6adfd5f5d/mailnews/compose/src/nsMsgCompose.cpp">file</a> |
<a href="/comm-central/annotate/9e8f283a8af138b0338d0d4e90518ad6adfd5f5d/mailnews/compose/src/nsMsgCompose.cpp">annotate</a> |
<a href="/comm-central/diff/9e8f283a8af138b0338d0d4e90518ad6adfd5f5d/mailnews/compose/src/nsMsgCompose.cpp">diff</a> |
<a href="/comm-central/comparison/9e8f283a8af138b0338d0d4e90518ad6adfd5f5d/mailnews/compose/src/nsMsgCompose.cpp">comparison</a> |
<a href="/comm-central/log/9e8f283a8af138b0338d0d4e90518ad6adfd5f5d/mailnews/compose/src/nsMsgCompose.cpp">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/9e8f283a8af138b0338d0d4e90518ad6adfd5f5d/mailnews/compose/src/nsMsgCompose.h">mailnews/compose/src/nsMsgCompose.h</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/9e8f283a8af138b0338d0d4e90518ad6adfd5f5d/mailnews/compose/src/nsMsgCompose.h">file</a> |
<a href="/comm-central/annotate/9e8f283a8af138b0338d0d4e90518ad6adfd5f5d/mailnews/compose/src/nsMsgCompose.h">annotate</a> |
<a href="/comm-central/diff/9e8f283a8af138b0338d0d4e90518ad6adfd5f5d/mailnews/compose/src/nsMsgCompose.h">diff</a> |
<a href="/comm-central/comparison/9e8f283a8af138b0338d0d4e90518ad6adfd5f5d/mailnews/compose/src/nsMsgCompose.h">comparison</a> |
<a href="/comm-central/log/9e8f283a8af138b0338d0d4e90518ad6adfd5f5d/mailnews/compose/src/nsMsgCompose.h">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/9e8f283a8af138b0338d0d4e90518ad6adfd5f5d/mailnews/compose/src/nsMsgCopy.cpp">mailnews/compose/src/nsMsgCopy.cpp</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/9e8f283a8af138b0338d0d4e90518ad6adfd5f5d/mailnews/compose/src/nsMsgCopy.cpp">file</a> |
<a href="/comm-central/annotate/9e8f283a8af138b0338d0d4e90518ad6adfd5f5d/mailnews/compose/src/nsMsgCopy.cpp">annotate</a> |
<a href="/comm-central/diff/9e8f283a8af138b0338d0d4e90518ad6adfd5f5d/mailnews/compose/src/nsMsgCopy.cpp">diff</a> |
<a href="/comm-central/comparison/9e8f283a8af138b0338d0d4e90518ad6adfd5f5d/mailnews/compose/src/nsMsgCopy.cpp">comparison</a> |
<a href="/comm-central/log/9e8f283a8af138b0338d0d4e90518ad6adfd5f5d/mailnews/compose/src/nsMsgCopy.cpp">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/9e8f283a8af138b0338d0d4e90518ad6adfd5f5d/mailnews/compose/src/nsMsgSend.cpp">mailnews/compose/src/nsMsgSend.cpp</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/9e8f283a8af138b0338d0d4e90518ad6adfd5f5d/mailnews/compose/src/nsMsgSend.cpp">file</a> |
<a href="/comm-central/annotate/9e8f283a8af138b0338d0d4e90518ad6adfd5f5d/mailnews/compose/src/nsMsgSend.cpp">annotate</a> |
<a href="/comm-central/diff/9e8f283a8af138b0338d0d4e90518ad6adfd5f5d/mailnews/compose/src/nsMsgSend.cpp">diff</a> |
<a href="/comm-central/comparison/9e8f283a8af138b0338d0d4e90518ad6adfd5f5d/mailnews/compose/src/nsMsgSend.cpp">comparison</a> |
<a href="/comm-central/log/9e8f283a8af138b0338d0d4e90518ad6adfd5f5d/mailnews/compose/src/nsMsgSend.cpp">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/9e8f283a8af138b0338d0d4e90518ad6adfd5f5d/mailnews/compose/src/nsMsgSendPart.cpp">mailnews/compose/src/nsMsgSendPart.cpp</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/9e8f283a8af138b0338d0d4e90518ad6adfd5f5d/mailnews/compose/src/nsMsgSendPart.cpp">file</a> |
<a href="/comm-central/annotate/9e8f283a8af138b0338d0d4e90518ad6adfd5f5d/mailnews/compose/src/nsMsgSendPart.cpp">annotate</a> |
<a href="/comm-central/diff/9e8f283a8af138b0338d0d4e90518ad6adfd5f5d/mailnews/compose/src/nsMsgSendPart.cpp">diff</a> |
<a href="/comm-central/comparison/9e8f283a8af138b0338d0d4e90518ad6adfd5f5d/mailnews/compose/src/nsMsgSendPart.cpp">comparison</a> |
<a href="/comm-central/log/9e8f283a8af138b0338d0d4e90518ad6adfd5f5d/mailnews/compose/src/nsMsgSendPart.cpp">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/9e8f283a8af138b0338d0d4e90518ad6adfd5f5d/mailnews/compose/src/nsMsgSendPart.h">mailnews/compose/src/nsMsgSendPart.h</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/9e8f283a8af138b0338d0d4e90518ad6adfd5f5d/mailnews/compose/src/nsMsgSendPart.h">file</a> |
<a href="/comm-central/annotate/9e8f283a8af138b0338d0d4e90518ad6adfd5f5d/mailnews/compose/src/nsMsgSendPart.h">annotate</a> |
<a href="/comm-central/diff/9e8f283a8af138b0338d0d4e90518ad6adfd5f5d/mailnews/compose/src/nsMsgSendPart.h">diff</a> |
<a href="/comm-central/comparison/9e8f283a8af138b0338d0d4e90518ad6adfd5f5d/mailnews/compose/src/nsMsgSendPart.h">comparison</a> |
<a href="/comm-central/log/9e8f283a8af138b0338d0d4e90518ad6adfd5f5d/mailnews/compose/src/nsMsgSendPart.h">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/9e8f283a8af138b0338d0d4e90518ad6adfd5f5d/mailnews/compose/src/nsURLFetcher.cpp">mailnews/compose/src/nsURLFetcher.cpp</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/9e8f283a8af138b0338d0d4e90518ad6adfd5f5d/mailnews/compose/src/nsURLFetcher.cpp">file</a> |
<a href="/comm-central/annotate/9e8f283a8af138b0338d0d4e90518ad6adfd5f5d/mailnews/compose/src/nsURLFetcher.cpp">annotate</a> |
<a href="/comm-central/diff/9e8f283a8af138b0338d0d4e90518ad6adfd5f5d/mailnews/compose/src/nsURLFetcher.cpp">diff</a> |
<a href="/comm-central/comparison/9e8f283a8af138b0338d0d4e90518ad6adfd5f5d/mailnews/compose/src/nsURLFetcher.cpp">comparison</a> |
<a href="/comm-central/log/9e8f283a8af138b0338d0d4e90518ad6adfd5f5d/mailnews/compose/src/nsURLFetcher.cpp">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/9e8f283a8af138b0338d0d4e90518ad6adfd5f5d/mailnews/compose/src/nsURLFetcher.h">mailnews/compose/src/nsURLFetcher.h</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/9e8f283a8af138b0338d0d4e90518ad6adfd5f5d/mailnews/compose/src/nsURLFetcher.h">file</a> |
<a href="/comm-central/annotate/9e8f283a8af138b0338d0d4e90518ad6adfd5f5d/mailnews/compose/src/nsURLFetcher.h">annotate</a> |
<a href="/comm-central/diff/9e8f283a8af138b0338d0d4e90518ad6adfd5f5d/mailnews/compose/src/nsURLFetcher.h">diff</a> |
<a href="/comm-central/comparison/9e8f283a8af138b0338d0d4e90518ad6adfd5f5d/mailnews/compose/src/nsURLFetcher.h">comparison</a> |
<a href="/comm-central/log/9e8f283a8af138b0338d0d4e90518ad6adfd5f5d/mailnews/compose/src/nsURLFetcher.h">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/9e8f283a8af138b0338d0d4e90518ad6adfd5f5d/mailnews/db/msgdb/public/nsIMsgDatabase.idl">mailnews/db/msgdb/public/nsIMsgDatabase.idl</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/9e8f283a8af138b0338d0d4e90518ad6adfd5f5d/mailnews/db/msgdb/public/nsIMsgDatabase.idl">file</a> |
<a href="/comm-central/annotate/9e8f283a8af138b0338d0d4e90518ad6adfd5f5d/mailnews/db/msgdb/public/nsIMsgDatabase.idl">annotate</a> |
<a href="/comm-central/diff/9e8f283a8af138b0338d0d4e90518ad6adfd5f5d/mailnews/db/msgdb/public/nsIMsgDatabase.idl">diff</a> |
<a href="/comm-central/comparison/9e8f283a8af138b0338d0d4e90518ad6adfd5f5d/mailnews/db/msgdb/public/nsIMsgDatabase.idl">comparison</a> |
<a href="/comm-central/log/9e8f283a8af138b0338d0d4e90518ad6adfd5f5d/mailnews/db/msgdb/public/nsIMsgDatabase.idl">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/9e8f283a8af138b0338d0d4e90518ad6adfd5f5d/mailnews/db/msgdb/public/nsMailDatabase.h">mailnews/db/msgdb/public/nsMailDatabase.h</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/9e8f283a8af138b0338d0d4e90518ad6adfd5f5d/mailnews/db/msgdb/public/nsMailDatabase.h">file</a> |
<a href="/comm-central/annotate/9e8f283a8af138b0338d0d4e90518ad6adfd5f5d/mailnews/db/msgdb/public/nsMailDatabase.h">annotate</a> |
<a href="/comm-central/diff/9e8f283a8af138b0338d0d4e90518ad6adfd5f5d/mailnews/db/msgdb/public/nsMailDatabase.h">diff</a> |
<a href="/comm-central/comparison/9e8f283a8af138b0338d0d4e90518ad6adfd5f5d/mailnews/db/msgdb/public/nsMailDatabase.h">comparison</a> |
<a href="/comm-central/log/9e8f283a8af138b0338d0d4e90518ad6adfd5f5d/mailnews/db/msgdb/public/nsMailDatabase.h">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/9e8f283a8af138b0338d0d4e90518ad6adfd5f5d/mailnews/db/msgdb/public/nsMsgDatabase.h">mailnews/db/msgdb/public/nsMsgDatabase.h</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/9e8f283a8af138b0338d0d4e90518ad6adfd5f5d/mailnews/db/msgdb/public/nsMsgDatabase.h">file</a> |
<a href="/comm-central/annotate/9e8f283a8af138b0338d0d4e90518ad6adfd5f5d/mailnews/db/msgdb/public/nsMsgDatabase.h">annotate</a> |
<a href="/comm-central/diff/9e8f283a8af138b0338d0d4e90518ad6adfd5f5d/mailnews/db/msgdb/public/nsMsgDatabase.h">diff</a> |
<a href="/comm-central/comparison/9e8f283a8af138b0338d0d4e90518ad6adfd5f5d/mailnews/db/msgdb/public/nsMsgDatabase.h">comparison</a> |
<a href="/comm-central/log/9e8f283a8af138b0338d0d4e90518ad6adfd5f5d/mailnews/db/msgdb/public/nsMsgDatabase.h">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/9e8f283a8af138b0338d0d4e90518ad6adfd5f5d/mailnews/db/msgdb/src/nsMailDatabase.cpp">mailnews/db/msgdb/src/nsMailDatabase.cpp</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/9e8f283a8af138b0338d0d4e90518ad6adfd5f5d/mailnews/db/msgdb/src/nsMailDatabase.cpp">file</a> |
<a href="/comm-central/annotate/9e8f283a8af138b0338d0d4e90518ad6adfd5f5d/mailnews/db/msgdb/src/nsMailDatabase.cpp">annotate</a> |
<a href="/comm-central/diff/9e8f283a8af138b0338d0d4e90518ad6adfd5f5d/mailnews/db/msgdb/src/nsMailDatabase.cpp">diff</a> |
<a href="/comm-central/comparison/9e8f283a8af138b0338d0d4e90518ad6adfd5f5d/mailnews/db/msgdb/src/nsMailDatabase.cpp">comparison</a> |
<a href="/comm-central/log/9e8f283a8af138b0338d0d4e90518ad6adfd5f5d/mailnews/db/msgdb/src/nsMailDatabase.cpp">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/9e8f283a8af138b0338d0d4e90518ad6adfd5f5d/mailnews/db/msgdb/src/nsMsgDatabase.cpp">mailnews/db/msgdb/src/nsMsgDatabase.cpp</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/9e8f283a8af138b0338d0d4e90518ad6adfd5f5d/mailnews/db/msgdb/src/nsMsgDatabase.cpp">file</a> |
<a href="/comm-central/annotate/9e8f283a8af138b0338d0d4e90518ad6adfd5f5d/mailnews/db/msgdb/src/nsMsgDatabase.cpp">annotate</a> |
<a href="/comm-central/diff/9e8f283a8af138b0338d0d4e90518ad6adfd5f5d/mailnews/db/msgdb/src/nsMsgDatabase.cpp">diff</a> |
<a href="/comm-central/comparison/9e8f283a8af138b0338d0d4e90518ad6adfd5f5d/mailnews/db/msgdb/src/nsMsgDatabase.cpp">comparison</a> |
<a href="/comm-central/log/9e8f283a8af138b0338d0d4e90518ad6adfd5f5d/mailnews/db/msgdb/src/nsMsgDatabase.cpp">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/9e8f283a8af138b0338d0d4e90518ad6adfd5f5d/mailnews/extensions/bayesian-spam-filter/src/nsBayesianFilter.cpp">mailnews/extensions/bayesian-spam-filter/src/nsBayesianFilter.cpp</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/9e8f283a8af138b0338d0d4e90518ad6adfd5f5d/mailnews/extensions/bayesian-spam-filter/src/nsBayesianFilter.cpp">file</a> |
<a href="/comm-central/annotate/9e8f283a8af138b0338d0d4e90518ad6adfd5f5d/mailnews/extensions/bayesian-spam-filter/src/nsBayesianFilter.cpp">annotate</a> |
<a href="/comm-central/diff/9e8f283a8af138b0338d0d4e90518ad6adfd5f5d/mailnews/extensions/bayesian-spam-filter/src/nsBayesianFilter.cpp">diff</a> |
<a href="/comm-central/comparison/9e8f283a8af138b0338d0d4e90518ad6adfd5f5d/mailnews/extensions/bayesian-spam-filter/src/nsBayesianFilter.cpp">comparison</a> |
<a href="/comm-central/log/9e8f283a8af138b0338d0d4e90518ad6adfd5f5d/mailnews/extensions/bayesian-spam-filter/src/nsBayesianFilter.cpp">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/9e8f283a8af138b0338d0d4e90518ad6adfd5f5d/mailnews/extensions/bayesian-spam-filter/src/nsBayesianFilter.h">mailnews/extensions/bayesian-spam-filter/src/nsBayesianFilter.h</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/9e8f283a8af138b0338d0d4e90518ad6adfd5f5d/mailnews/extensions/bayesian-spam-filter/src/nsBayesianFilter.h">file</a> |
<a href="/comm-central/annotate/9e8f283a8af138b0338d0d4e90518ad6adfd5f5d/mailnews/extensions/bayesian-spam-filter/src/nsBayesianFilter.h">annotate</a> |
<a href="/comm-central/diff/9e8f283a8af138b0338d0d4e90518ad6adfd5f5d/mailnews/extensions/bayesian-spam-filter/src/nsBayesianFilter.h">diff</a> |
<a href="/comm-central/comparison/9e8f283a8af138b0338d0d4e90518ad6adfd5f5d/mailnews/extensions/bayesian-spam-filter/src/nsBayesianFilter.h">comparison</a> |
<a href="/comm-central/log/9e8f283a8af138b0338d0d4e90518ad6adfd5f5d/mailnews/extensions/bayesian-spam-filter/src/nsBayesianFilter.h">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/9e8f283a8af138b0338d0d4e90518ad6adfd5f5d/mailnews/extensions/mailviews/src/nsMsgMailViewList.cpp">mailnews/extensions/mailviews/src/nsMsgMailViewList.cpp</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/9e8f283a8af138b0338d0d4e90518ad6adfd5f5d/mailnews/extensions/mailviews/src/nsMsgMailViewList.cpp">file</a> |
<a href="/comm-central/annotate/9e8f283a8af138b0338d0d4e90518ad6adfd5f5d/mailnews/extensions/mailviews/src/nsMsgMailViewList.cpp">annotate</a> |
<a href="/comm-central/diff/9e8f283a8af138b0338d0d4e90518ad6adfd5f5d/mailnews/extensions/mailviews/src/nsMsgMailViewList.cpp">diff</a> |
<a href="/comm-central/comparison/9e8f283a8af138b0338d0d4e90518ad6adfd5f5d/mailnews/extensions/mailviews/src/nsMsgMailViewList.cpp">comparison</a> |
<a href="/comm-central/log/9e8f283a8af138b0338d0d4e90518ad6adfd5f5d/mailnews/extensions/mailviews/src/nsMsgMailViewList.cpp">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/9e8f283a8af138b0338d0d4e90518ad6adfd5f5d/mailnews/extensions/mdn/src/nsMsgMdnGenerator.cpp">mailnews/extensions/mdn/src/nsMsgMdnGenerator.cpp</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/9e8f283a8af138b0338d0d4e90518ad6adfd5f5d/mailnews/extensions/mdn/src/nsMsgMdnGenerator.cpp">file</a> |
<a href="/comm-central/annotate/9e8f283a8af138b0338d0d4e90518ad6adfd5f5d/mailnews/extensions/mdn/src/nsMsgMdnGenerator.cpp">annotate</a> |
<a href="/comm-central/diff/9e8f283a8af138b0338d0d4e90518ad6adfd5f5d/mailnews/extensions/mdn/src/nsMsgMdnGenerator.cpp">diff</a> |
<a href="/comm-central/comparison/9e8f283a8af138b0338d0d4e90518ad6adfd5f5d/mailnews/extensions/mdn/src/nsMsgMdnGenerator.cpp">comparison</a> |
<a href="/comm-central/log/9e8f283a8af138b0338d0d4e90518ad6adfd5f5d/mailnews/extensions/mdn/src/nsMsgMdnGenerator.cpp">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/9e8f283a8af138b0338d0d4e90518ad6adfd5f5d/mailnews/imap/src/nsImapMailFolder.cpp">mailnews/imap/src/nsImapMailFolder.cpp</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/9e8f283a8af138b0338d0d4e90518ad6adfd5f5d/mailnews/imap/src/nsImapMailFolder.cpp">file</a> |
<a href="/comm-central/annotate/9e8f283a8af138b0338d0d4e90518ad6adfd5f5d/mailnews/imap/src/nsImapMailFolder.cpp">annotate</a> |
<a href="/comm-central/diff/9e8f283a8af138b0338d0d4e90518ad6adfd5f5d/mailnews/imap/src/nsImapMailFolder.cpp">diff</a> |
<a href="/comm-central/comparison/9e8f283a8af138b0338d0d4e90518ad6adfd5f5d/mailnews/imap/src/nsImapMailFolder.cpp">comparison</a> |
<a href="/comm-central/log/9e8f283a8af138b0338d0d4e90518ad6adfd5f5d/mailnews/imap/src/nsImapMailFolder.cpp">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/9e8f283a8af138b0338d0d4e90518ad6adfd5f5d/mailnews/imap/src/nsImapMailFolder.h">mailnews/imap/src/nsImapMailFolder.h</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/9e8f283a8af138b0338d0d4e90518ad6adfd5f5d/mailnews/imap/src/nsImapMailFolder.h">file</a> |
<a href="/comm-central/annotate/9e8f283a8af138b0338d0d4e90518ad6adfd5f5d/mailnews/imap/src/nsImapMailFolder.h">annotate</a> |
<a href="/comm-central/diff/9e8f283a8af138b0338d0d4e90518ad6adfd5f5d/mailnews/imap/src/nsImapMailFolder.h">diff</a> |
<a href="/comm-central/comparison/9e8f283a8af138b0338d0d4e90518ad6adfd5f5d/mailnews/imap/src/nsImapMailFolder.h">comparison</a> |
<a href="/comm-central/log/9e8f283a8af138b0338d0d4e90518ad6adfd5f5d/mailnews/imap/src/nsImapMailFolder.h">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/9e8f283a8af138b0338d0d4e90518ad6adfd5f5d/mailnews/imap/src/nsImapOfflineSync.h">mailnews/imap/src/nsImapOfflineSync.h</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/9e8f283a8af138b0338d0d4e90518ad6adfd5f5d/mailnews/imap/src/nsImapOfflineSync.h">file</a> |
<a href="/comm-central/annotate/9e8f283a8af138b0338d0d4e90518ad6adfd5f5d/mailnews/imap/src/nsImapOfflineSync.h">annotate</a> |
<a href="/comm-central/diff/9e8f283a8af138b0338d0d4e90518ad6adfd5f5d/mailnews/imap/src/nsImapOfflineSync.h">diff</a> |
<a href="/comm-central/comparison/9e8f283a8af138b0338d0d4e90518ad6adfd5f5d/mailnews/imap/src/nsImapOfflineSync.h">comparison</a> |
<a href="/comm-central/log/9e8f283a8af138b0338d0d4e90518ad6adfd5f5d/mailnews/imap/src/nsImapOfflineSync.h">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/9e8f283a8af138b0338d0d4e90518ad6adfd5f5d/mailnews/imap/src/nsImapProtocol.cpp">mailnews/imap/src/nsImapProtocol.cpp</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/9e8f283a8af138b0338d0d4e90518ad6adfd5f5d/mailnews/imap/src/nsImapProtocol.cpp">file</a> |
<a href="/comm-central/annotate/9e8f283a8af138b0338d0d4e90518ad6adfd5f5d/mailnews/imap/src/nsImapProtocol.cpp">annotate</a> |
<a href="/comm-central/diff/9e8f283a8af138b0338d0d4e90518ad6adfd5f5d/mailnews/imap/src/nsImapProtocol.cpp">diff</a> |
<a href="/comm-central/comparison/9e8f283a8af138b0338d0d4e90518ad6adfd5f5d/mailnews/imap/src/nsImapProtocol.cpp">comparison</a> |
<a href="/comm-central/log/9e8f283a8af138b0338d0d4e90518ad6adfd5f5d/mailnews/imap/src/nsImapProtocol.cpp">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/9e8f283a8af138b0338d0d4e90518ad6adfd5f5d/mailnews/imap/src/nsImapService.cpp">mailnews/imap/src/nsImapService.cpp</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/9e8f283a8af138b0338d0d4e90518ad6adfd5f5d/mailnews/imap/src/nsImapService.cpp">file</a> |
<a href="/comm-central/annotate/9e8f283a8af138b0338d0d4e90518ad6adfd5f5d/mailnews/imap/src/nsImapService.cpp">annotate</a> |
<a href="/comm-central/diff/9e8f283a8af138b0338d0d4e90518ad6adfd5f5d/mailnews/imap/src/nsImapService.cpp">diff</a> |
<a href="/comm-central/comparison/9e8f283a8af138b0338d0d4e90518ad6adfd5f5d/mailnews/imap/src/nsImapService.cpp">comparison</a> |
<a href="/comm-central/log/9e8f283a8af138b0338d0d4e90518ad6adfd5f5d/mailnews/imap/src/nsImapService.cpp">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/9e8f283a8af138b0338d0d4e90518ad6adfd5f5d/mailnews/import/applemail/src/nsAppleMailImport.cpp">mailnews/import/applemail/src/nsAppleMailImport.cpp</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/9e8f283a8af138b0338d0d4e90518ad6adfd5f5d/mailnews/import/applemail/src/nsAppleMailImport.cpp">file</a> |
<a href="/comm-central/annotate/9e8f283a8af138b0338d0d4e90518ad6adfd5f5d/mailnews/import/applemail/src/nsAppleMailImport.cpp">annotate</a> |
<a href="/comm-central/diff/9e8f283a8af138b0338d0d4e90518ad6adfd5f5d/mailnews/import/applemail/src/nsAppleMailImport.cpp">diff</a> |
<a href="/comm-central/comparison/9e8f283a8af138b0338d0d4e90518ad6adfd5f5d/mailnews/import/applemail/src/nsAppleMailImport.cpp">comparison</a> |
<a href="/comm-central/log/9e8f283a8af138b0338d0d4e90518ad6adfd5f5d/mailnews/import/applemail/src/nsAppleMailImport.cpp">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/9e8f283a8af138b0338d0d4e90518ad6adfd5f5d/mailnews/import/applemail/src/nsAppleMailImport.h">mailnews/import/applemail/src/nsAppleMailImport.h</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/9e8f283a8af138b0338d0d4e90518ad6adfd5f5d/mailnews/import/applemail/src/nsAppleMailImport.h">file</a> |
<a href="/comm-central/annotate/9e8f283a8af138b0338d0d4e90518ad6adfd5f5d/mailnews/import/applemail/src/nsAppleMailImport.h">annotate</a> |
<a href="/comm-central/diff/9e8f283a8af138b0338d0d4e90518ad6adfd5f5d/mailnews/import/applemail/src/nsAppleMailImport.h">diff</a> |
<a href="/comm-central/comparison/9e8f283a8af138b0338d0d4e90518ad6adfd5f5d/mailnews/import/applemail/src/nsAppleMailImport.h">comparison</a> |
<a href="/comm-central/log/9e8f283a8af138b0338d0d4e90518ad6adfd5f5d/mailnews/import/applemail/src/nsAppleMailImport.h">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/9e8f283a8af138b0338d0d4e90518ad6adfd5f5d/mailnews/import/applemail/src/nsEmlxHelperUtils.h">mailnews/import/applemail/src/nsEmlxHelperUtils.h</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/9e8f283a8af138b0338d0d4e90518ad6adfd5f5d/mailnews/import/applemail/src/nsEmlxHelperUtils.h">file</a> |
<a href="/comm-central/annotate/9e8f283a8af138b0338d0d4e90518ad6adfd5f5d/mailnews/import/applemail/src/nsEmlxHelperUtils.h">annotate</a> |
<a href="/comm-central/diff/9e8f283a8af138b0338d0d4e90518ad6adfd5f5d/mailnews/import/applemail/src/nsEmlxHelperUtils.h">diff</a> |
<a href="/comm-central/comparison/9e8f283a8af138b0338d0d4e90518ad6adfd5f5d/mailnews/import/applemail/src/nsEmlxHelperUtils.h">comparison</a> |
<a href="/comm-central/log/9e8f283a8af138b0338d0d4e90518ad6adfd5f5d/mailnews/import/applemail/src/nsEmlxHelperUtils.h">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/9e8f283a8af138b0338d0d4e90518ad6adfd5f5d/mailnews/import/applemail/src/nsEmlxHelperUtils.mm">mailnews/import/applemail/src/nsEmlxHelperUtils.mm</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/9e8f283a8af138b0338d0d4e90518ad6adfd5f5d/mailnews/import/applemail/src/nsEmlxHelperUtils.mm">file</a> |
<a href="/comm-central/annotate/9e8f283a8af138b0338d0d4e90518ad6adfd5f5d/mailnews/import/applemail/src/nsEmlxHelperUtils.mm">annotate</a> |
<a href="/comm-central/diff/9e8f283a8af138b0338d0d4e90518ad6adfd5f5d/mailnews/import/applemail/src/nsEmlxHelperUtils.mm">diff</a> |
<a href="/comm-central/comparison/9e8f283a8af138b0338d0d4e90518ad6adfd5f5d/mailnews/import/applemail/src/nsEmlxHelperUtils.mm">comparison</a> |
<a href="/comm-central/log/9e8f283a8af138b0338d0d4e90518ad6adfd5f5d/mailnews/import/applemail/src/nsEmlxHelperUtils.mm">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/9e8f283a8af138b0338d0d4e90518ad6adfd5f5d/mailnews/import/eudora/src/nsEudoraAddress.h">mailnews/import/eudora/src/nsEudoraAddress.h</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/9e8f283a8af138b0338d0d4e90518ad6adfd5f5d/mailnews/import/eudora/src/nsEudoraAddress.h">file</a> |
<a href="/comm-central/annotate/9e8f283a8af138b0338d0d4e90518ad6adfd5f5d/mailnews/import/eudora/src/nsEudoraAddress.h">annotate</a> |
<a href="/comm-central/diff/9e8f283a8af138b0338d0d4e90518ad6adfd5f5d/mailnews/import/eudora/src/nsEudoraAddress.h">diff</a> |
<a href="/comm-central/comparison/9e8f283a8af138b0338d0d4e90518ad6adfd5f5d/mailnews/import/eudora/src/nsEudoraAddress.h">comparison</a> |
<a href="/comm-central/log/9e8f283a8af138b0338d0d4e90518ad6adfd5f5d/mailnews/import/eudora/src/nsEudoraAddress.h">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/9e8f283a8af138b0338d0d4e90518ad6adfd5f5d/mailnews/import/eudora/src/nsEudoraCompose.cpp">mailnews/import/eudora/src/nsEudoraCompose.cpp</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/9e8f283a8af138b0338d0d4e90518ad6adfd5f5d/mailnews/import/eudora/src/nsEudoraCompose.cpp">file</a> |
<a href="/comm-central/annotate/9e8f283a8af138b0338d0d4e90518ad6adfd5f5d/mailnews/import/eudora/src/nsEudoraCompose.cpp">annotate</a> |
<a href="/comm-central/diff/9e8f283a8af138b0338d0d4e90518ad6adfd5f5d/mailnews/import/eudora/src/nsEudoraCompose.cpp">diff</a> |
<a href="/comm-central/comparison/9e8f283a8af138b0338d0d4e90518ad6adfd5f5d/mailnews/import/eudora/src/nsEudoraCompose.cpp">comparison</a> |
<a href="/comm-central/log/9e8f283a8af138b0338d0d4e90518ad6adfd5f5d/mailnews/import/eudora/src/nsEudoraCompose.cpp">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/9e8f283a8af138b0338d0d4e90518ad6adfd5f5d/mailnews/import/eudora/src/nsEudoraFilters.h">mailnews/import/eudora/src/nsEudoraFilters.h</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/9e8f283a8af138b0338d0d4e90518ad6adfd5f5d/mailnews/import/eudora/src/nsEudoraFilters.h">file</a> |
<a href="/comm-central/annotate/9e8f283a8af138b0338d0d4e90518ad6adfd5f5d/mailnews/import/eudora/src/nsEudoraFilters.h">annotate</a> |
<a href="/comm-central/diff/9e8f283a8af138b0338d0d4e90518ad6adfd5f5d/mailnews/import/eudora/src/nsEudoraFilters.h">diff</a> |
<a href="/comm-central/comparison/9e8f283a8af138b0338d0d4e90518ad6adfd5f5d/mailnews/import/eudora/src/nsEudoraFilters.h">comparison</a> |
<a href="/comm-central/log/9e8f283a8af138b0338d0d4e90518ad6adfd5f5d/mailnews/import/eudora/src/nsEudoraFilters.h">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/9e8f283a8af138b0338d0d4e90518ad6adfd5f5d/mailnews/import/eudora/src/nsEudoraImport.cpp">mailnews/import/eudora/src/nsEudoraImport.cpp</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/9e8f283a8af138b0338d0d4e90518ad6adfd5f5d/mailnews/import/eudora/src/nsEudoraImport.cpp">file</a> |
<a href="/comm-central/annotate/9e8f283a8af138b0338d0d4e90518ad6adfd5f5d/mailnews/import/eudora/src/nsEudoraImport.cpp">annotate</a> |
<a href="/comm-central/diff/9e8f283a8af138b0338d0d4e90518ad6adfd5f5d/mailnews/import/eudora/src/nsEudoraImport.cpp">diff</a> |
<a href="/comm-central/comparison/9e8f283a8af138b0338d0d4e90518ad6adfd5f5d/mailnews/import/eudora/src/nsEudoraImport.cpp">comparison</a> |
<a href="/comm-central/log/9e8f283a8af138b0338d0d4e90518ad6adfd5f5d/mailnews/import/eudora/src/nsEudoraImport.cpp">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/9e8f283a8af138b0338d0d4e90518ad6adfd5f5d/mailnews/import/eudora/src/nsEudoraMac.cpp">mailnews/import/eudora/src/nsEudoraMac.cpp</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/9e8f283a8af138b0338d0d4e90518ad6adfd5f5d/mailnews/import/eudora/src/nsEudoraMac.cpp">file</a> |
<a href="/comm-central/annotate/9e8f283a8af138b0338d0d4e90518ad6adfd5f5d/mailnews/import/eudora/src/nsEudoraMac.cpp">annotate</a> |
<a href="/comm-central/diff/9e8f283a8af138b0338d0d4e90518ad6adfd5f5d/mailnews/import/eudora/src/nsEudoraMac.cpp">diff</a> |
<a href="/comm-central/comparison/9e8f283a8af138b0338d0d4e90518ad6adfd5f5d/mailnews/import/eudora/src/nsEudoraMac.cpp">comparison</a> |
<a href="/comm-central/log/9e8f283a8af138b0338d0d4e90518ad6adfd5f5d/mailnews/import/eudora/src/nsEudoraMac.cpp">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/9e8f283a8af138b0338d0d4e90518ad6adfd5f5d/mailnews/import/eudora/src/nsEudoraMac.h">mailnews/import/eudora/src/nsEudoraMac.h</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/9e8f283a8af138b0338d0d4e90518ad6adfd5f5d/mailnews/import/eudora/src/nsEudoraMac.h">file</a> |
<a href="/comm-central/annotate/9e8f283a8af138b0338d0d4e90518ad6adfd5f5d/mailnews/import/eudora/src/nsEudoraMac.h">annotate</a> |
<a href="/comm-central/diff/9e8f283a8af138b0338d0d4e90518ad6adfd5f5d/mailnews/import/eudora/src/nsEudoraMac.h">diff</a> |
<a href="/comm-central/comparison/9e8f283a8af138b0338d0d4e90518ad6adfd5f5d/mailnews/import/eudora/src/nsEudoraMac.h">comparison</a> |
<a href="/comm-central/log/9e8f283a8af138b0338d0d4e90518ad6adfd5f5d/mailnews/import/eudora/src/nsEudoraMac.h">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/9e8f283a8af138b0338d0d4e90518ad6adfd5f5d/mailnews/import/eudora/src/nsEudoraMailbox.cpp">mailnews/import/eudora/src/nsEudoraMailbox.cpp</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/9e8f283a8af138b0338d0d4e90518ad6adfd5f5d/mailnews/import/eudora/src/nsEudoraMailbox.cpp">file</a> |
<a href="/comm-central/annotate/9e8f283a8af138b0338d0d4e90518ad6adfd5f5d/mailnews/import/eudora/src/nsEudoraMailbox.cpp">annotate</a> |
<a href="/comm-central/diff/9e8f283a8af138b0338d0d4e90518ad6adfd5f5d/mailnews/import/eudora/src/nsEudoraMailbox.cpp">diff</a> |
<a href="/comm-central/comparison/9e8f283a8af138b0338d0d4e90518ad6adfd5f5d/mailnews/import/eudora/src/nsEudoraMailbox.cpp">comparison</a> |
<a href="/comm-central/log/9e8f283a8af138b0338d0d4e90518ad6adfd5f5d/mailnews/import/eudora/src/nsEudoraMailbox.cpp">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/9e8f283a8af138b0338d0d4e90518ad6adfd5f5d/mailnews/import/eudora/src/nsEudoraMailbox.h">mailnews/import/eudora/src/nsEudoraMailbox.h</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/9e8f283a8af138b0338d0d4e90518ad6adfd5f5d/mailnews/import/eudora/src/nsEudoraMailbox.h">file</a> |
<a href="/comm-central/annotate/9e8f283a8af138b0338d0d4e90518ad6adfd5f5d/mailnews/import/eudora/src/nsEudoraMailbox.h">annotate</a> |
<a href="/comm-central/diff/9e8f283a8af138b0338d0d4e90518ad6adfd5f5d/mailnews/import/eudora/src/nsEudoraMailbox.h">diff</a> |
<a href="/comm-central/comparison/9e8f283a8af138b0338d0d4e90518ad6adfd5f5d/mailnews/import/eudora/src/nsEudoraMailbox.h">comparison</a> |
<a href="/comm-central/log/9e8f283a8af138b0338d0d4e90518ad6adfd5f5d/mailnews/import/eudora/src/nsEudoraMailbox.h">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/9e8f283a8af138b0338d0d4e90518ad6adfd5f5d/mailnews/import/eudora/src/nsEudoraSettings.h">mailnews/import/eudora/src/nsEudoraSettings.h</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/9e8f283a8af138b0338d0d4e90518ad6adfd5f5d/mailnews/import/eudora/src/nsEudoraSettings.h">file</a> |
<a href="/comm-central/annotate/9e8f283a8af138b0338d0d4e90518ad6adfd5f5d/mailnews/import/eudora/src/nsEudoraSettings.h">annotate</a> |
<a href="/comm-central/diff/9e8f283a8af138b0338d0d4e90518ad6adfd5f5d/mailnews/import/eudora/src/nsEudoraSettings.h">diff</a> |
<a href="/comm-central/comparison/9e8f283a8af138b0338d0d4e90518ad6adfd5f5d/mailnews/import/eudora/src/nsEudoraSettings.h">comparison</a> |
<a href="/comm-central/log/9e8f283a8af138b0338d0d4e90518ad6adfd5f5d/mailnews/import/eudora/src/nsEudoraSettings.h">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/9e8f283a8af138b0338d0d4e90518ad6adfd5f5d/mailnews/import/eudora/src/nsEudoraWin32.cpp">mailnews/import/eudora/src/nsEudoraWin32.cpp</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/9e8f283a8af138b0338d0d4e90518ad6adfd5f5d/mailnews/import/eudora/src/nsEudoraWin32.cpp">file</a> |
<a href="/comm-central/annotate/9e8f283a8af138b0338d0d4e90518ad6adfd5f5d/mailnews/import/eudora/src/nsEudoraWin32.cpp">annotate</a> |
<a href="/comm-central/diff/9e8f283a8af138b0338d0d4e90518ad6adfd5f5d/mailnews/import/eudora/src/nsEudoraWin32.cpp">diff</a> |
<a href="/comm-central/comparison/9e8f283a8af138b0338d0d4e90518ad6adfd5f5d/mailnews/import/eudora/src/nsEudoraWin32.cpp">comparison</a> |
<a href="/comm-central/log/9e8f283a8af138b0338d0d4e90518ad6adfd5f5d/mailnews/import/eudora/src/nsEudoraWin32.cpp">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/9e8f283a8af138b0338d0d4e90518ad6adfd5f5d/mailnews/import/eudora/src/nsEudoraWin32.h">mailnews/import/eudora/src/nsEudoraWin32.h</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/9e8f283a8af138b0338d0d4e90518ad6adfd5f5d/mailnews/import/eudora/src/nsEudoraWin32.h">file</a> |
<a href="/comm-central/annotate/9e8f283a8af138b0338d0d4e90518ad6adfd5f5d/mailnews/import/eudora/src/nsEudoraWin32.h">annotate</a> |
<a href="/comm-central/diff/9e8f283a8af138b0338d0d4e90518ad6adfd5f5d/mailnews/import/eudora/src/nsEudoraWin32.h">diff</a> |
<a href="/comm-central/comparison/9e8f283a8af138b0338d0d4e90518ad6adfd5f5d/mailnews/import/eudora/src/nsEudoraWin32.h">comparison</a> |
<a href="/comm-central/log/9e8f283a8af138b0338d0d4e90518ad6adfd5f5d/mailnews/import/eudora/src/nsEudoraWin32.h">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/9e8f283a8af138b0338d0d4e90518ad6adfd5f5d/mailnews/import/oexpress/WabObject.cpp">mailnews/import/oexpress/WabObject.cpp</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/9e8f283a8af138b0338d0d4e90518ad6adfd5f5d/mailnews/import/oexpress/WabObject.cpp">file</a> |
<a href="/comm-central/annotate/9e8f283a8af138b0338d0d4e90518ad6adfd5f5d/mailnews/import/oexpress/WabObject.cpp">annotate</a> |
<a href="/comm-central/diff/9e8f283a8af138b0338d0d4e90518ad6adfd5f5d/mailnews/import/oexpress/WabObject.cpp">diff</a> |
<a href="/comm-central/comparison/9e8f283a8af138b0338d0d4e90518ad6adfd5f5d/mailnews/import/oexpress/WabObject.cpp">comparison</a> |
<a href="/comm-central/log/9e8f283a8af138b0338d0d4e90518ad6adfd5f5d/mailnews/import/oexpress/WabObject.cpp">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/9e8f283a8af138b0338d0d4e90518ad6adfd5f5d/mailnews/import/oexpress/WabObject.h">mailnews/import/oexpress/WabObject.h</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/9e8f283a8af138b0338d0d4e90518ad6adfd5f5d/mailnews/import/oexpress/WabObject.h">file</a> |
<a href="/comm-central/annotate/9e8f283a8af138b0338d0d4e90518ad6adfd5f5d/mailnews/import/oexpress/WabObject.h">annotate</a> |
<a href="/comm-central/diff/9e8f283a8af138b0338d0d4e90518ad6adfd5f5d/mailnews/import/oexpress/WabObject.h">diff</a> |
<a href="/comm-central/comparison/9e8f283a8af138b0338d0d4e90518ad6adfd5f5d/mailnews/import/oexpress/WabObject.h">comparison</a> |
<a href="/comm-central/log/9e8f283a8af138b0338d0d4e90518ad6adfd5f5d/mailnews/import/oexpress/WabObject.h">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/9e8f283a8af138b0338d0d4e90518ad6adfd5f5d/mailnews/import/oexpress/nsOEImport.cpp">mailnews/import/oexpress/nsOEImport.cpp</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/9e8f283a8af138b0338d0d4e90518ad6adfd5f5d/mailnews/import/oexpress/nsOEImport.cpp">file</a> |
<a href="/comm-central/annotate/9e8f283a8af138b0338d0d4e90518ad6adfd5f5d/mailnews/import/oexpress/nsOEImport.cpp">annotate</a> |
<a href="/comm-central/diff/9e8f283a8af138b0338d0d4e90518ad6adfd5f5d/mailnews/import/oexpress/nsOEImport.cpp">diff</a> |
<a href="/comm-central/comparison/9e8f283a8af138b0338d0d4e90518ad6adfd5f5d/mailnews/import/oexpress/nsOEImport.cpp">comparison</a> |
<a href="/comm-central/log/9e8f283a8af138b0338d0d4e90518ad6adfd5f5d/mailnews/import/oexpress/nsOEImport.cpp">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/9e8f283a8af138b0338d0d4e90518ad6adfd5f5d/mailnews/import/oexpress/nsOEMailbox.cpp">mailnews/import/oexpress/nsOEMailbox.cpp</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/9e8f283a8af138b0338d0d4e90518ad6adfd5f5d/mailnews/import/oexpress/nsOEMailbox.cpp">file</a> |
<a href="/comm-central/annotate/9e8f283a8af138b0338d0d4e90518ad6adfd5f5d/mailnews/import/oexpress/nsOEMailbox.cpp">annotate</a> |
<a href="/comm-central/diff/9e8f283a8af138b0338d0d4e90518ad6adfd5f5d/mailnews/import/oexpress/nsOEMailbox.cpp">diff</a> |
<a href="/comm-central/comparison/9e8f283a8af138b0338d0d4e90518ad6adfd5f5d/mailnews/import/oexpress/nsOEMailbox.cpp">comparison</a> |
<a href="/comm-central/log/9e8f283a8af138b0338d0d4e90518ad6adfd5f5d/mailnews/import/oexpress/nsOEMailbox.cpp">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/9e8f283a8af138b0338d0d4e90518ad6adfd5f5d/mailnews/import/oexpress/nsOEScanBoxes.cpp">mailnews/import/oexpress/nsOEScanBoxes.cpp</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/9e8f283a8af138b0338d0d4e90518ad6adfd5f5d/mailnews/import/oexpress/nsOEScanBoxes.cpp">file</a> |
<a href="/comm-central/annotate/9e8f283a8af138b0338d0d4e90518ad6adfd5f5d/mailnews/import/oexpress/nsOEScanBoxes.cpp">annotate</a> |
<a href="/comm-central/diff/9e8f283a8af138b0338d0d4e90518ad6adfd5f5d/mailnews/import/oexpress/nsOEScanBoxes.cpp">diff</a> |
<a href="/comm-central/comparison/9e8f283a8af138b0338d0d4e90518ad6adfd5f5d/mailnews/import/oexpress/nsOEScanBoxes.cpp">comparison</a> |
<a href="/comm-central/log/9e8f283a8af138b0338d0d4e90518ad6adfd5f5d/mailnews/import/oexpress/nsOEScanBoxes.cpp">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/9e8f283a8af138b0338d0d4e90518ad6adfd5f5d/mailnews/import/outlook/src/MapiMessage.cpp">mailnews/import/outlook/src/MapiMessage.cpp</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/9e8f283a8af138b0338d0d4e90518ad6adfd5f5d/mailnews/import/outlook/src/MapiMessage.cpp">file</a> |
<a href="/comm-central/annotate/9e8f283a8af138b0338d0d4e90518ad6adfd5f5d/mailnews/import/outlook/src/MapiMessage.cpp">annotate</a> |
<a href="/comm-central/diff/9e8f283a8af138b0338d0d4e90518ad6adfd5f5d/mailnews/import/outlook/src/MapiMessage.cpp">diff</a> |
<a href="/comm-central/comparison/9e8f283a8af138b0338d0d4e90518ad6adfd5f5d/mailnews/import/outlook/src/MapiMessage.cpp">comparison</a> |
<a href="/comm-central/log/9e8f283a8af138b0338d0d4e90518ad6adfd5f5d/mailnews/import/outlook/src/MapiMessage.cpp">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/9e8f283a8af138b0338d0d4e90518ad6adfd5f5d/mailnews/import/outlook/src/MapiMessage.h">mailnews/import/outlook/src/MapiMessage.h</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/9e8f283a8af138b0338d0d4e90518ad6adfd5f5d/mailnews/import/outlook/src/MapiMessage.h">file</a> |
<a href="/comm-central/annotate/9e8f283a8af138b0338d0d4e90518ad6adfd5f5d/mailnews/import/outlook/src/MapiMessage.h">annotate</a> |
<a href="/comm-central/diff/9e8f283a8af138b0338d0d4e90518ad6adfd5f5d/mailnews/import/outlook/src/MapiMessage.h">diff</a> |
<a href="/comm-central/comparison/9e8f283a8af138b0338d0d4e90518ad6adfd5f5d/mailnews/import/outlook/src/MapiMessage.h">comparison</a> |
<a href="/comm-central/log/9e8f283a8af138b0338d0d4e90518ad6adfd5f5d/mailnews/import/outlook/src/MapiMessage.h">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/9e8f283a8af138b0338d0d4e90518ad6adfd5f5d/mailnews/import/outlook/src/nsOutlookImport.cpp">mailnews/import/outlook/src/nsOutlookImport.cpp</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/9e8f283a8af138b0338d0d4e90518ad6adfd5f5d/mailnews/import/outlook/src/nsOutlookImport.cpp">file</a> |
<a href="/comm-central/annotate/9e8f283a8af138b0338d0d4e90518ad6adfd5f5d/mailnews/import/outlook/src/nsOutlookImport.cpp">annotate</a> |
<a href="/comm-central/diff/9e8f283a8af138b0338d0d4e90518ad6adfd5f5d/mailnews/import/outlook/src/nsOutlookImport.cpp">diff</a> |
<a href="/comm-central/comparison/9e8f283a8af138b0338d0d4e90518ad6adfd5f5d/mailnews/import/outlook/src/nsOutlookImport.cpp">comparison</a> |
<a href="/comm-central/log/9e8f283a8af138b0338d0d4e90518ad6adfd5f5d/mailnews/import/outlook/src/nsOutlookImport.cpp">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/9e8f283a8af138b0338d0d4e90518ad6adfd5f5d/mailnews/import/public/nsIImportMailboxDescriptor.idl">mailnews/import/public/nsIImportMailboxDescriptor.idl</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/9e8f283a8af138b0338d0d4e90518ad6adfd5f5d/mailnews/import/public/nsIImportMailboxDescriptor.idl">file</a> |
<a href="/comm-central/annotate/9e8f283a8af138b0338d0d4e90518ad6adfd5f5d/mailnews/import/public/nsIImportMailboxDescriptor.idl">annotate</a> |
<a href="/comm-central/diff/9e8f283a8af138b0338d0d4e90518ad6adfd5f5d/mailnews/import/public/nsIImportMailboxDescriptor.idl">diff</a> |
<a href="/comm-central/comparison/9e8f283a8af138b0338d0d4e90518ad6adfd5f5d/mailnews/import/public/nsIImportMailboxDescriptor.idl">comparison</a> |
<a href="/comm-central/log/9e8f283a8af138b0338d0d4e90518ad6adfd5f5d/mailnews/import/public/nsIImportMailboxDescriptor.idl">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/9e8f283a8af138b0338d0d4e90518ad6adfd5f5d/mailnews/import/src/nsImportAddressBooks.cpp">mailnews/import/src/nsImportAddressBooks.cpp</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/9e8f283a8af138b0338d0d4e90518ad6adfd5f5d/mailnews/import/src/nsImportAddressBooks.cpp">file</a> |
<a href="/comm-central/annotate/9e8f283a8af138b0338d0d4e90518ad6adfd5f5d/mailnews/import/src/nsImportAddressBooks.cpp">annotate</a> |
<a href="/comm-central/diff/9e8f283a8af138b0338d0d4e90518ad6adfd5f5d/mailnews/import/src/nsImportAddressBooks.cpp">diff</a> |
<a href="/comm-central/comparison/9e8f283a8af138b0338d0d4e90518ad6adfd5f5d/mailnews/import/src/nsImportAddressBooks.cpp">comparison</a> |
<a href="/comm-central/log/9e8f283a8af138b0338d0d4e90518ad6adfd5f5d/mailnews/import/src/nsImportAddressBooks.cpp">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/9e8f283a8af138b0338d0d4e90518ad6adfd5f5d/mailnews/import/src/nsImportEncodeScan.h">mailnews/import/src/nsImportEncodeScan.h</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/9e8f283a8af138b0338d0d4e90518ad6adfd5f5d/mailnews/import/src/nsImportEncodeScan.h">file</a> |
<a href="/comm-central/annotate/9e8f283a8af138b0338d0d4e90518ad6adfd5f5d/mailnews/import/src/nsImportEncodeScan.h">annotate</a> |
<a href="/comm-central/diff/9e8f283a8af138b0338d0d4e90518ad6adfd5f5d/mailnews/import/src/nsImportEncodeScan.h">diff</a> |
<a href="/comm-central/comparison/9e8f283a8af138b0338d0d4e90518ad6adfd5f5d/mailnews/import/src/nsImportEncodeScan.h">comparison</a> |
<a href="/comm-central/log/9e8f283a8af138b0338d0d4e90518ad6adfd5f5d/mailnews/import/src/nsImportEncodeScan.h">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/9e8f283a8af138b0338d0d4e90518ad6adfd5f5d/mailnews/import/src/nsImportMail.cpp">mailnews/import/src/nsImportMail.cpp</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/9e8f283a8af138b0338d0d4e90518ad6adfd5f5d/mailnews/import/src/nsImportMail.cpp">file</a> |
<a href="/comm-central/annotate/9e8f283a8af138b0338d0d4e90518ad6adfd5f5d/mailnews/import/src/nsImportMail.cpp">annotate</a> |
<a href="/comm-central/diff/9e8f283a8af138b0338d0d4e90518ad6adfd5f5d/mailnews/import/src/nsImportMail.cpp">diff</a> |
<a href="/comm-central/comparison/9e8f283a8af138b0338d0d4e90518ad6adfd5f5d/mailnews/import/src/nsImportMail.cpp">comparison</a> |
<a href="/comm-central/log/9e8f283a8af138b0338d0d4e90518ad6adfd5f5d/mailnews/import/src/nsImportMail.cpp">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/9e8f283a8af138b0338d0d4e90518ad6adfd5f5d/mailnews/import/src/nsImportMailboxDescriptor.h">mailnews/import/src/nsImportMailboxDescriptor.h</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/9e8f283a8af138b0338d0d4e90518ad6adfd5f5d/mailnews/import/src/nsImportMailboxDescriptor.h">file</a> |
<a href="/comm-central/annotate/9e8f283a8af138b0338d0d4e90518ad6adfd5f5d/mailnews/import/src/nsImportMailboxDescriptor.h">annotate</a> |
<a href="/comm-central/diff/9e8f283a8af138b0338d0d4e90518ad6adfd5f5d/mailnews/import/src/nsImportMailboxDescriptor.h">diff</a> |
<a href="/comm-central/comparison/9e8f283a8af138b0338d0d4e90518ad6adfd5f5d/mailnews/import/src/nsImportMailboxDescriptor.h">comparison</a> |
<a href="/comm-central/log/9e8f283a8af138b0338d0d4e90518ad6adfd5f5d/mailnews/import/src/nsImportMailboxDescriptor.h">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/9e8f283a8af138b0338d0d4e90518ad6adfd5f5d/mailnews/import/src/nsImportScanFile.cpp">mailnews/import/src/nsImportScanFile.cpp</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/9e8f283a8af138b0338d0d4e90518ad6adfd5f5d/mailnews/import/src/nsImportScanFile.cpp">file</a> |
<a href="/comm-central/annotate/9e8f283a8af138b0338d0d4e90518ad6adfd5f5d/mailnews/import/src/nsImportScanFile.cpp">annotate</a> |
<a href="/comm-central/diff/9e8f283a8af138b0338d0d4e90518ad6adfd5f5d/mailnews/import/src/nsImportScanFile.cpp">diff</a> |
<a href="/comm-central/comparison/9e8f283a8af138b0338d0d4e90518ad6adfd5f5d/mailnews/import/src/nsImportScanFile.cpp">comparison</a> |
<a href="/comm-central/log/9e8f283a8af138b0338d0d4e90518ad6adfd5f5d/mailnews/import/src/nsImportScanFile.cpp">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/9e8f283a8af138b0338d0d4e90518ad6adfd5f5d/mailnews/import/text/src/nsTextImport.cpp">mailnews/import/text/src/nsTextImport.cpp</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/9e8f283a8af138b0338d0d4e90518ad6adfd5f5d/mailnews/import/text/src/nsTextImport.cpp">file</a> |
<a href="/comm-central/annotate/9e8f283a8af138b0338d0d4e90518ad6adfd5f5d/mailnews/import/text/src/nsTextImport.cpp">annotate</a> |
<a href="/comm-central/diff/9e8f283a8af138b0338d0d4e90518ad6adfd5f5d/mailnews/import/text/src/nsTextImport.cpp">diff</a> |
<a href="/comm-central/comparison/9e8f283a8af138b0338d0d4e90518ad6adfd5f5d/mailnews/import/text/src/nsTextImport.cpp">comparison</a> |
<a href="/comm-central/log/9e8f283a8af138b0338d0d4e90518ad6adfd5f5d/mailnews/import/text/src/nsTextImport.cpp">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/9e8f283a8af138b0338d0d4e90518ad6adfd5f5d/mailnews/import/vcard/src/nsVCardImport.cpp">mailnews/import/vcard/src/nsVCardImport.cpp</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/9e8f283a8af138b0338d0d4e90518ad6adfd5f5d/mailnews/import/vcard/src/nsVCardImport.cpp">file</a> |
<a href="/comm-central/annotate/9e8f283a8af138b0338d0d4e90518ad6adfd5f5d/mailnews/import/vcard/src/nsVCardImport.cpp">annotate</a> |
<a href="/comm-central/diff/9e8f283a8af138b0338d0d4e90518ad6adfd5f5d/mailnews/import/vcard/src/nsVCardImport.cpp">diff</a> |
<a href="/comm-central/comparison/9e8f283a8af138b0338d0d4e90518ad6adfd5f5d/mailnews/import/vcard/src/nsVCardImport.cpp">comparison</a> |
<a href="/comm-central/log/9e8f283a8af138b0338d0d4e90518ad6adfd5f5d/mailnews/import/vcard/src/nsVCardImport.cpp">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/9e8f283a8af138b0338d0d4e90518ad6adfd5f5d/mailnews/import/winlivemail/nsWMSettings.cpp">mailnews/import/winlivemail/nsWMSettings.cpp</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/9e8f283a8af138b0338d0d4e90518ad6adfd5f5d/mailnews/import/winlivemail/nsWMSettings.cpp">file</a> |
<a href="/comm-central/annotate/9e8f283a8af138b0338d0d4e90518ad6adfd5f5d/mailnews/import/winlivemail/nsWMSettings.cpp">annotate</a> |
<a href="/comm-central/diff/9e8f283a8af138b0338d0d4e90518ad6adfd5f5d/mailnews/import/winlivemail/nsWMSettings.cpp">diff</a> |
<a href="/comm-central/comparison/9e8f283a8af138b0338d0d4e90518ad6adfd5f5d/mailnews/import/winlivemail/nsWMSettings.cpp">comparison</a> |
<a href="/comm-central/log/9e8f283a8af138b0338d0d4e90518ad6adfd5f5d/mailnews/import/winlivemail/nsWMSettings.cpp">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/9e8f283a8af138b0338d0d4e90518ad6adfd5f5d/mailnews/local/public/nsIMailboxService.idl">mailnews/local/public/nsIMailboxService.idl</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/9e8f283a8af138b0338d0d4e90518ad6adfd5f5d/mailnews/local/public/nsIMailboxService.idl">file</a> |
<a href="/comm-central/annotate/9e8f283a8af138b0338d0d4e90518ad6adfd5f5d/mailnews/local/public/nsIMailboxService.idl">annotate</a> |
<a href="/comm-central/diff/9e8f283a8af138b0338d0d4e90518ad6adfd5f5d/mailnews/local/public/nsIMailboxService.idl">diff</a> |
<a href="/comm-central/comparison/9e8f283a8af138b0338d0d4e90518ad6adfd5f5d/mailnews/local/public/nsIMailboxService.idl">comparison</a> |
<a href="/comm-central/log/9e8f283a8af138b0338d0d4e90518ad6adfd5f5d/mailnews/local/public/nsIMailboxService.idl">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/9e8f283a8af138b0338d0d4e90518ad6adfd5f5d/mailnews/local/public/nsINoIncomingServer.idl">mailnews/local/public/nsINoIncomingServer.idl</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/9e8f283a8af138b0338d0d4e90518ad6adfd5f5d/mailnews/local/public/nsINoIncomingServer.idl">file</a> |
<a href="/comm-central/annotate/9e8f283a8af138b0338d0d4e90518ad6adfd5f5d/mailnews/local/public/nsINoIncomingServer.idl">annotate</a> |
<a href="/comm-central/diff/9e8f283a8af138b0338d0d4e90518ad6adfd5f5d/mailnews/local/public/nsINoIncomingServer.idl">diff</a> |
<a href="/comm-central/comparison/9e8f283a8af138b0338d0d4e90518ad6adfd5f5d/mailnews/local/public/nsINoIncomingServer.idl">comparison</a> |
<a href="/comm-central/log/9e8f283a8af138b0338d0d4e90518ad6adfd5f5d/mailnews/local/public/nsINoIncomingServer.idl">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/9e8f283a8af138b0338d0d4e90518ad6adfd5f5d/mailnews/local/public/nsIRssIncomingServer.idl">mailnews/local/public/nsIRssIncomingServer.idl</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/9e8f283a8af138b0338d0d4e90518ad6adfd5f5d/mailnews/local/public/nsIRssIncomingServer.idl">file</a> |
<a href="/comm-central/annotate/9e8f283a8af138b0338d0d4e90518ad6adfd5f5d/mailnews/local/public/nsIRssIncomingServer.idl">annotate</a> |
<a href="/comm-central/diff/9e8f283a8af138b0338d0d4e90518ad6adfd5f5d/mailnews/local/public/nsIRssIncomingServer.idl">diff</a> |
<a href="/comm-central/comparison/9e8f283a8af138b0338d0d4e90518ad6adfd5f5d/mailnews/local/public/nsIRssIncomingServer.idl">comparison</a> |
<a href="/comm-central/log/9e8f283a8af138b0338d0d4e90518ad6adfd5f5d/mailnews/local/public/nsIRssIncomingServer.idl">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/9e8f283a8af138b0338d0d4e90518ad6adfd5f5d/mailnews/local/src/nsLocalMailFolder.cpp">mailnews/local/src/nsLocalMailFolder.cpp</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/9e8f283a8af138b0338d0d4e90518ad6adfd5f5d/mailnews/local/src/nsLocalMailFolder.cpp">file</a> |
<a href="/comm-central/annotate/9e8f283a8af138b0338d0d4e90518ad6adfd5f5d/mailnews/local/src/nsLocalMailFolder.cpp">annotate</a> |
<a href="/comm-central/diff/9e8f283a8af138b0338d0d4e90518ad6adfd5f5d/mailnews/local/src/nsLocalMailFolder.cpp">diff</a> |
<a href="/comm-central/comparison/9e8f283a8af138b0338d0d4e90518ad6adfd5f5d/mailnews/local/src/nsLocalMailFolder.cpp">comparison</a> |
<a href="/comm-central/log/9e8f283a8af138b0338d0d4e90518ad6adfd5f5d/mailnews/local/src/nsLocalMailFolder.cpp">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/9e8f283a8af138b0338d0d4e90518ad6adfd5f5d/mailnews/local/src/nsLocalUtils.cpp">mailnews/local/src/nsLocalUtils.cpp</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/9e8f283a8af138b0338d0d4e90518ad6adfd5f5d/mailnews/local/src/nsLocalUtils.cpp">file</a> |
<a href="/comm-central/annotate/9e8f283a8af138b0338d0d4e90518ad6adfd5f5d/mailnews/local/src/nsLocalUtils.cpp">annotate</a> |
<a href="/comm-central/diff/9e8f283a8af138b0338d0d4e90518ad6adfd5f5d/mailnews/local/src/nsLocalUtils.cpp">diff</a> |
<a href="/comm-central/comparison/9e8f283a8af138b0338d0d4e90518ad6adfd5f5d/mailnews/local/src/nsLocalUtils.cpp">comparison</a> |
<a href="/comm-central/log/9e8f283a8af138b0338d0d4e90518ad6adfd5f5d/mailnews/local/src/nsLocalUtils.cpp">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/9e8f283a8af138b0338d0d4e90518ad6adfd5f5d/mailnews/local/src/nsMailboxService.cpp">mailnews/local/src/nsMailboxService.cpp</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/9e8f283a8af138b0338d0d4e90518ad6adfd5f5d/mailnews/local/src/nsMailboxService.cpp">file</a> |
<a href="/comm-central/annotate/9e8f283a8af138b0338d0d4e90518ad6adfd5f5d/mailnews/local/src/nsMailboxService.cpp">annotate</a> |
<a href="/comm-central/diff/9e8f283a8af138b0338d0d4e90518ad6adfd5f5d/mailnews/local/src/nsMailboxService.cpp">diff</a> |
<a href="/comm-central/comparison/9e8f283a8af138b0338d0d4e90518ad6adfd5f5d/mailnews/local/src/nsMailboxService.cpp">comparison</a> |
<a href="/comm-central/log/9e8f283a8af138b0338d0d4e90518ad6adfd5f5d/mailnews/local/src/nsMailboxService.cpp">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/9e8f283a8af138b0338d0d4e90518ad6adfd5f5d/mailnews/local/src/nsMailboxUrl.h">mailnews/local/src/nsMailboxUrl.h</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/9e8f283a8af138b0338d0d4e90518ad6adfd5f5d/mailnews/local/src/nsMailboxUrl.h">file</a> |
<a href="/comm-central/annotate/9e8f283a8af138b0338d0d4e90518ad6adfd5f5d/mailnews/local/src/nsMailboxUrl.h">annotate</a> |
<a href="/comm-central/diff/9e8f283a8af138b0338d0d4e90518ad6adfd5f5d/mailnews/local/src/nsMailboxUrl.h">diff</a> |
<a href="/comm-central/comparison/9e8f283a8af138b0338d0d4e90518ad6adfd5f5d/mailnews/local/src/nsMailboxUrl.h">comparison</a> |
<a href="/comm-central/log/9e8f283a8af138b0338d0d4e90518ad6adfd5f5d/mailnews/local/src/nsMailboxUrl.h">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/9e8f283a8af138b0338d0d4e90518ad6adfd5f5d/mailnews/local/src/nsMovemailService.cpp">mailnews/local/src/nsMovemailService.cpp</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/9e8f283a8af138b0338d0d4e90518ad6adfd5f5d/mailnews/local/src/nsMovemailService.cpp">file</a> |
<a href="/comm-central/annotate/9e8f283a8af138b0338d0d4e90518ad6adfd5f5d/mailnews/local/src/nsMovemailService.cpp">annotate</a> |
<a href="/comm-central/diff/9e8f283a8af138b0338d0d4e90518ad6adfd5f5d/mailnews/local/src/nsMovemailService.cpp">diff</a> |
<a href="/comm-central/comparison/9e8f283a8af138b0338d0d4e90518ad6adfd5f5d/mailnews/local/src/nsMovemailService.cpp">comparison</a> |
<a href="/comm-central/log/9e8f283a8af138b0338d0d4e90518ad6adfd5f5d/mailnews/local/src/nsMovemailService.cpp">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/9e8f283a8af138b0338d0d4e90518ad6adfd5f5d/mailnews/local/src/nsMsgBrkMBoxStore.cpp">mailnews/local/src/nsMsgBrkMBoxStore.cpp</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/9e8f283a8af138b0338d0d4e90518ad6adfd5f5d/mailnews/local/src/nsMsgBrkMBoxStore.cpp">file</a> |
<a href="/comm-central/annotate/9e8f283a8af138b0338d0d4e90518ad6adfd5f5d/mailnews/local/src/nsMsgBrkMBoxStore.cpp">annotate</a> |
<a href="/comm-central/diff/9e8f283a8af138b0338d0d4e90518ad6adfd5f5d/mailnews/local/src/nsMsgBrkMBoxStore.cpp">diff</a> |
<a href="/comm-central/comparison/9e8f283a8af138b0338d0d4e90518ad6adfd5f5d/mailnews/local/src/nsMsgBrkMBoxStore.cpp">comparison</a> |
<a href="/comm-central/log/9e8f283a8af138b0338d0d4e90518ad6adfd5f5d/mailnews/local/src/nsMsgBrkMBoxStore.cpp">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/9e8f283a8af138b0338d0d4e90518ad6adfd5f5d/mailnews/local/src/nsMsgBrkMBoxStore.h">mailnews/local/src/nsMsgBrkMBoxStore.h</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/9e8f283a8af138b0338d0d4e90518ad6adfd5f5d/mailnews/local/src/nsMsgBrkMBoxStore.h">file</a> |
<a href="/comm-central/annotate/9e8f283a8af138b0338d0d4e90518ad6adfd5f5d/mailnews/local/src/nsMsgBrkMBoxStore.h">annotate</a> |
<a href="/comm-central/diff/9e8f283a8af138b0338d0d4e90518ad6adfd5f5d/mailnews/local/src/nsMsgBrkMBoxStore.h">diff</a> |
<a href="/comm-central/comparison/9e8f283a8af138b0338d0d4e90518ad6adfd5f5d/mailnews/local/src/nsMsgBrkMBoxStore.h">comparison</a> |
<a href="/comm-central/log/9e8f283a8af138b0338d0d4e90518ad6adfd5f5d/mailnews/local/src/nsMsgBrkMBoxStore.h">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/9e8f283a8af138b0338d0d4e90518ad6adfd5f5d/mailnews/local/src/nsMsgLocalStoreUtils.cpp">mailnews/local/src/nsMsgLocalStoreUtils.cpp</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/9e8f283a8af138b0338d0d4e90518ad6adfd5f5d/mailnews/local/src/nsMsgLocalStoreUtils.cpp">file</a> |
<a href="/comm-central/annotate/9e8f283a8af138b0338d0d4e90518ad6adfd5f5d/mailnews/local/src/nsMsgLocalStoreUtils.cpp">annotate</a> |
<a href="/comm-central/diff/9e8f283a8af138b0338d0d4e90518ad6adfd5f5d/mailnews/local/src/nsMsgLocalStoreUtils.cpp">diff</a> |
<a href="/comm-central/comparison/9e8f283a8af138b0338d0d4e90518ad6adfd5f5d/mailnews/local/src/nsMsgLocalStoreUtils.cpp">comparison</a> |
<a href="/comm-central/log/9e8f283a8af138b0338d0d4e90518ad6adfd5f5d/mailnews/local/src/nsMsgLocalStoreUtils.cpp">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/9e8f283a8af138b0338d0d4e90518ad6adfd5f5d/mailnews/local/src/nsMsgLocalStoreUtils.h">mailnews/local/src/nsMsgLocalStoreUtils.h</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/9e8f283a8af138b0338d0d4e90518ad6adfd5f5d/mailnews/local/src/nsMsgLocalStoreUtils.h">file</a> |
<a href="/comm-central/annotate/9e8f283a8af138b0338d0d4e90518ad6adfd5f5d/mailnews/local/src/nsMsgLocalStoreUtils.h">annotate</a> |
<a href="/comm-central/diff/9e8f283a8af138b0338d0d4e90518ad6adfd5f5d/mailnews/local/src/nsMsgLocalStoreUtils.h">diff</a> |
<a href="/comm-central/comparison/9e8f283a8af138b0338d0d4e90518ad6adfd5f5d/mailnews/local/src/nsMsgLocalStoreUtils.h">comparison</a> |
<a href="/comm-central/log/9e8f283a8af138b0338d0d4e90518ad6adfd5f5d/mailnews/local/src/nsMsgLocalStoreUtils.h">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/9e8f283a8af138b0338d0d4e90518ad6adfd5f5d/mailnews/local/src/nsMsgMaildirStore.cpp">mailnews/local/src/nsMsgMaildirStore.cpp</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/9e8f283a8af138b0338d0d4e90518ad6adfd5f5d/mailnews/local/src/nsMsgMaildirStore.cpp">file</a> |
<a href="/comm-central/annotate/9e8f283a8af138b0338d0d4e90518ad6adfd5f5d/mailnews/local/src/nsMsgMaildirStore.cpp">annotate</a> |
<a href="/comm-central/diff/9e8f283a8af138b0338d0d4e90518ad6adfd5f5d/mailnews/local/src/nsMsgMaildirStore.cpp">diff</a> |
<a href="/comm-central/comparison/9e8f283a8af138b0338d0d4e90518ad6adfd5f5d/mailnews/local/src/nsMsgMaildirStore.cpp">comparison</a> |
<a href="/comm-central/log/9e8f283a8af138b0338d0d4e90518ad6adfd5f5d/mailnews/local/src/nsMsgMaildirStore.cpp">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/9e8f283a8af138b0338d0d4e90518ad6adfd5f5d/mailnews/local/src/nsMsgMaildirStore.h">mailnews/local/src/nsMsgMaildirStore.h</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/9e8f283a8af138b0338d0d4e90518ad6adfd5f5d/mailnews/local/src/nsMsgMaildirStore.h">file</a> |
<a href="/comm-central/annotate/9e8f283a8af138b0338d0d4e90518ad6adfd5f5d/mailnews/local/src/nsMsgMaildirStore.h">annotate</a> |
<a href="/comm-central/diff/9e8f283a8af138b0338d0d4e90518ad6adfd5f5d/mailnews/local/src/nsMsgMaildirStore.h">diff</a> |
<a href="/comm-central/comparison/9e8f283a8af138b0338d0d4e90518ad6adfd5f5d/mailnews/local/src/nsMsgMaildirStore.h">comparison</a> |
<a href="/comm-central/log/9e8f283a8af138b0338d0d4e90518ad6adfd5f5d/mailnews/local/src/nsMsgMaildirStore.h">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/9e8f283a8af138b0338d0d4e90518ad6adfd5f5d/mailnews/local/src/nsNoIncomingServer.cpp">mailnews/local/src/nsNoIncomingServer.cpp</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/9e8f283a8af138b0338d0d4e90518ad6adfd5f5d/mailnews/local/src/nsNoIncomingServer.cpp">file</a> |
<a href="/comm-central/annotate/9e8f283a8af138b0338d0d4e90518ad6adfd5f5d/mailnews/local/src/nsNoIncomingServer.cpp">annotate</a> |
<a href="/comm-central/diff/9e8f283a8af138b0338d0d4e90518ad6adfd5f5d/mailnews/local/src/nsNoIncomingServer.cpp">diff</a> |
<a href="/comm-central/comparison/9e8f283a8af138b0338d0d4e90518ad6adfd5f5d/mailnews/local/src/nsNoIncomingServer.cpp">comparison</a> |
<a href="/comm-central/log/9e8f283a8af138b0338d0d4e90518ad6adfd5f5d/mailnews/local/src/nsNoIncomingServer.cpp">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/9e8f283a8af138b0338d0d4e90518ad6adfd5f5d/mailnews/local/src/nsNoneService.cpp">mailnews/local/src/nsNoneService.cpp</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/9e8f283a8af138b0338d0d4e90518ad6adfd5f5d/mailnews/local/src/nsNoneService.cpp">file</a> |
<a href="/comm-central/annotate/9e8f283a8af138b0338d0d4e90518ad6adfd5f5d/mailnews/local/src/nsNoneService.cpp">annotate</a> |
<a href="/comm-central/diff/9e8f283a8af138b0338d0d4e90518ad6adfd5f5d/mailnews/local/src/nsNoneService.cpp">diff</a> |
<a href="/comm-central/comparison/9e8f283a8af138b0338d0d4e90518ad6adfd5f5d/mailnews/local/src/nsNoneService.cpp">comparison</a> |
<a href="/comm-central/log/9e8f283a8af138b0338d0d4e90518ad6adfd5f5d/mailnews/local/src/nsNoneService.cpp">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/9e8f283a8af138b0338d0d4e90518ad6adfd5f5d/mailnews/local/src/nsParseMailbox.cpp">mailnews/local/src/nsParseMailbox.cpp</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/9e8f283a8af138b0338d0d4e90518ad6adfd5f5d/mailnews/local/src/nsParseMailbox.cpp">file</a> |
<a href="/comm-central/annotate/9e8f283a8af138b0338d0d4e90518ad6adfd5f5d/mailnews/local/src/nsParseMailbox.cpp">annotate</a> |
<a href="/comm-central/diff/9e8f283a8af138b0338d0d4e90518ad6adfd5f5d/mailnews/local/src/nsParseMailbox.cpp">diff</a> |
<a href="/comm-central/comparison/9e8f283a8af138b0338d0d4e90518ad6adfd5f5d/mailnews/local/src/nsParseMailbox.cpp">comparison</a> |
<a href="/comm-central/log/9e8f283a8af138b0338d0d4e90518ad6adfd5f5d/mailnews/local/src/nsParseMailbox.cpp">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/9e8f283a8af138b0338d0d4e90518ad6adfd5f5d/mailnews/local/src/nsPop3IncomingServer.cpp">mailnews/local/src/nsPop3IncomingServer.cpp</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/9e8f283a8af138b0338d0d4e90518ad6adfd5f5d/mailnews/local/src/nsPop3IncomingServer.cpp">file</a> |
<a href="/comm-central/annotate/9e8f283a8af138b0338d0d4e90518ad6adfd5f5d/mailnews/local/src/nsPop3IncomingServer.cpp">annotate</a> |
<a href="/comm-central/diff/9e8f283a8af138b0338d0d4e90518ad6adfd5f5d/mailnews/local/src/nsPop3IncomingServer.cpp">diff</a> |
<a href="/comm-central/comparison/9e8f283a8af138b0338d0d4e90518ad6adfd5f5d/mailnews/local/src/nsPop3IncomingServer.cpp">comparison</a> |
<a href="/comm-central/log/9e8f283a8af138b0338d0d4e90518ad6adfd5f5d/mailnews/local/src/nsPop3IncomingServer.cpp">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/9e8f283a8af138b0338d0d4e90518ad6adfd5f5d/mailnews/local/src/nsPop3Protocol.cpp">mailnews/local/src/nsPop3Protocol.cpp</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/9e8f283a8af138b0338d0d4e90518ad6adfd5f5d/mailnews/local/src/nsPop3Protocol.cpp">file</a> |
<a href="/comm-central/annotate/9e8f283a8af138b0338d0d4e90518ad6adfd5f5d/mailnews/local/src/nsPop3Protocol.cpp">annotate</a> |
<a href="/comm-central/diff/9e8f283a8af138b0338d0d4e90518ad6adfd5f5d/mailnews/local/src/nsPop3Protocol.cpp">diff</a> |
<a href="/comm-central/comparison/9e8f283a8af138b0338d0d4e90518ad6adfd5f5d/mailnews/local/src/nsPop3Protocol.cpp">comparison</a> |
<a href="/comm-central/log/9e8f283a8af138b0338d0d4e90518ad6adfd5f5d/mailnews/local/src/nsPop3Protocol.cpp">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/9e8f283a8af138b0338d0d4e90518ad6adfd5f5d/mailnews/local/src/nsPop3Protocol.h">mailnews/local/src/nsPop3Protocol.h</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/9e8f283a8af138b0338d0d4e90518ad6adfd5f5d/mailnews/local/src/nsPop3Protocol.h">file</a> |
<a href="/comm-central/annotate/9e8f283a8af138b0338d0d4e90518ad6adfd5f5d/mailnews/local/src/nsPop3Protocol.h">annotate</a> |
<a href="/comm-central/diff/9e8f283a8af138b0338d0d4e90518ad6adfd5f5d/mailnews/local/src/nsPop3Protocol.h">diff</a> |
<a href="/comm-central/comparison/9e8f283a8af138b0338d0d4e90518ad6adfd5f5d/mailnews/local/src/nsPop3Protocol.h">comparison</a> |
<a href="/comm-central/log/9e8f283a8af138b0338d0d4e90518ad6adfd5f5d/mailnews/local/src/nsPop3Protocol.h">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/9e8f283a8af138b0338d0d4e90518ad6adfd5f5d/mailnews/local/src/nsPop3Service.cpp">mailnews/local/src/nsPop3Service.cpp</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/9e8f283a8af138b0338d0d4e90518ad6adfd5f5d/mailnews/local/src/nsPop3Service.cpp">file</a> |
<a href="/comm-central/annotate/9e8f283a8af138b0338d0d4e90518ad6adfd5f5d/mailnews/local/src/nsPop3Service.cpp">annotate</a> |
<a href="/comm-central/diff/9e8f283a8af138b0338d0d4e90518ad6adfd5f5d/mailnews/local/src/nsPop3Service.cpp">diff</a> |
<a href="/comm-central/comparison/9e8f283a8af138b0338d0d4e90518ad6adfd5f5d/mailnews/local/src/nsPop3Service.cpp">comparison</a> |
<a href="/comm-central/log/9e8f283a8af138b0338d0d4e90518ad6adfd5f5d/mailnews/local/src/nsPop3Service.cpp">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/9e8f283a8af138b0338d0d4e90518ad6adfd5f5d/mailnews/local/src/nsPop3Sink.cpp">mailnews/local/src/nsPop3Sink.cpp</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/9e8f283a8af138b0338d0d4e90518ad6adfd5f5d/mailnews/local/src/nsPop3Sink.cpp">file</a> |
<a href="/comm-central/annotate/9e8f283a8af138b0338d0d4e90518ad6adfd5f5d/mailnews/local/src/nsPop3Sink.cpp">annotate</a> |
<a href="/comm-central/diff/9e8f283a8af138b0338d0d4e90518ad6adfd5f5d/mailnews/local/src/nsPop3Sink.cpp">diff</a> |
<a href="/comm-central/comparison/9e8f283a8af138b0338d0d4e90518ad6adfd5f5d/mailnews/local/src/nsPop3Sink.cpp">comparison</a> |
<a href="/comm-central/log/9e8f283a8af138b0338d0d4e90518ad6adfd5f5d/mailnews/local/src/nsPop3Sink.cpp">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/9e8f283a8af138b0338d0d4e90518ad6adfd5f5d/mailnews/local/src/nsPop3Sink.h">mailnews/local/src/nsPop3Sink.h</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/9e8f283a8af138b0338d0d4e90518ad6adfd5f5d/mailnews/local/src/nsPop3Sink.h">file</a> |
<a href="/comm-central/annotate/9e8f283a8af138b0338d0d4e90518ad6adfd5f5d/mailnews/local/src/nsPop3Sink.h">annotate</a> |
<a href="/comm-central/diff/9e8f283a8af138b0338d0d4e90518ad6adfd5f5d/mailnews/local/src/nsPop3Sink.h">diff</a> |
<a href="/comm-central/comparison/9e8f283a8af138b0338d0d4e90518ad6adfd5f5d/mailnews/local/src/nsPop3Sink.h">comparison</a> |
<a href="/comm-central/log/9e8f283a8af138b0338d0d4e90518ad6adfd5f5d/mailnews/local/src/nsPop3Sink.h">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/9e8f283a8af138b0338d0d4e90518ad6adfd5f5d/mailnews/local/src/nsRssIncomingServer.cpp">mailnews/local/src/nsRssIncomingServer.cpp</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/9e8f283a8af138b0338d0d4e90518ad6adfd5f5d/mailnews/local/src/nsRssIncomingServer.cpp">file</a> |
<a href="/comm-central/annotate/9e8f283a8af138b0338d0d4e90518ad6adfd5f5d/mailnews/local/src/nsRssIncomingServer.cpp">annotate</a> |
<a href="/comm-central/diff/9e8f283a8af138b0338d0d4e90518ad6adfd5f5d/mailnews/local/src/nsRssIncomingServer.cpp">diff</a> |
<a href="/comm-central/comparison/9e8f283a8af138b0338d0d4e90518ad6adfd5f5d/mailnews/local/src/nsRssIncomingServer.cpp">comparison</a> |
<a href="/comm-central/log/9e8f283a8af138b0338d0d4e90518ad6adfd5f5d/mailnews/local/src/nsRssIncomingServer.cpp">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/9e8f283a8af138b0338d0d4e90518ad6adfd5f5d/mailnews/local/src/nsRssIncomingServer.h">mailnews/local/src/nsRssIncomingServer.h</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/9e8f283a8af138b0338d0d4e90518ad6adfd5f5d/mailnews/local/src/nsRssIncomingServer.h">file</a> |
<a href="/comm-central/annotate/9e8f283a8af138b0338d0d4e90518ad6adfd5f5d/mailnews/local/src/nsRssIncomingServer.h">annotate</a> |
<a href="/comm-central/diff/9e8f283a8af138b0338d0d4e90518ad6adfd5f5d/mailnews/local/src/nsRssIncomingServer.h">diff</a> |
<a href="/comm-central/comparison/9e8f283a8af138b0338d0d4e90518ad6adfd5f5d/mailnews/local/src/nsRssIncomingServer.h">comparison</a> |
<a href="/comm-central/log/9e8f283a8af138b0338d0d4e90518ad6adfd5f5d/mailnews/local/src/nsRssIncomingServer.h">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/9e8f283a8af138b0338d0d4e90518ad6adfd5f5d/mailnews/local/src/nsRssService.cpp">mailnews/local/src/nsRssService.cpp</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/9e8f283a8af138b0338d0d4e90518ad6adfd5f5d/mailnews/local/src/nsRssService.cpp">file</a> |
<a href="/comm-central/annotate/9e8f283a8af138b0338d0d4e90518ad6adfd5f5d/mailnews/local/src/nsRssService.cpp">annotate</a> |
<a href="/comm-central/diff/9e8f283a8af138b0338d0d4e90518ad6adfd5f5d/mailnews/local/src/nsRssService.cpp">diff</a> |
<a href="/comm-central/comparison/9e8f283a8af138b0338d0d4e90518ad6adfd5f5d/mailnews/local/src/nsRssService.cpp">comparison</a> |
<a href="/comm-central/log/9e8f283a8af138b0338d0d4e90518ad6adfd5f5d/mailnews/local/src/nsRssService.cpp">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/9e8f283a8af138b0338d0d4e90518ad6adfd5f5d/mailnews/mapi/mapihook/src/msgMapiHook.cpp">mailnews/mapi/mapihook/src/msgMapiHook.cpp</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/9e8f283a8af138b0338d0d4e90518ad6adfd5f5d/mailnews/mapi/mapihook/src/msgMapiHook.cpp">file</a> |
<a href="/comm-central/annotate/9e8f283a8af138b0338d0d4e90518ad6adfd5f5d/mailnews/mapi/mapihook/src/msgMapiHook.cpp">annotate</a> |
<a href="/comm-central/diff/9e8f283a8af138b0338d0d4e90518ad6adfd5f5d/mailnews/mapi/mapihook/src/msgMapiHook.cpp">diff</a> |
<a href="/comm-central/comparison/9e8f283a8af138b0338d0d4e90518ad6adfd5f5d/mailnews/mapi/mapihook/src/msgMapiHook.cpp">comparison</a> |
<a href="/comm-central/log/9e8f283a8af138b0338d0d4e90518ad6adfd5f5d/mailnews/mapi/mapihook/src/msgMapiHook.cpp">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/9e8f283a8af138b0338d0d4e90518ad6adfd5f5d/mailnews/mapi/mapihook/src/msgMapiImp.cpp">mailnews/mapi/mapihook/src/msgMapiImp.cpp</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/9e8f283a8af138b0338d0d4e90518ad6adfd5f5d/mailnews/mapi/mapihook/src/msgMapiImp.cpp">file</a> |
<a href="/comm-central/annotate/9e8f283a8af138b0338d0d4e90518ad6adfd5f5d/mailnews/mapi/mapihook/src/msgMapiImp.cpp">annotate</a> |
<a href="/comm-central/diff/9e8f283a8af138b0338d0d4e90518ad6adfd5f5d/mailnews/mapi/mapihook/src/msgMapiImp.cpp">diff</a> |
<a href="/comm-central/comparison/9e8f283a8af138b0338d0d4e90518ad6adfd5f5d/mailnews/mapi/mapihook/src/msgMapiImp.cpp">comparison</a> |
<a href="/comm-central/log/9e8f283a8af138b0338d0d4e90518ad6adfd5f5d/mailnews/mapi/mapihook/src/msgMapiImp.cpp">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/9e8f283a8af138b0338d0d4e90518ad6adfd5f5d/mailnews/mime/src/mimeebod.cpp">mailnews/mime/src/mimeebod.cpp</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/9e8f283a8af138b0338d0d4e90518ad6adfd5f5d/mailnews/mime/src/mimeebod.cpp">file</a> |
<a href="/comm-central/annotate/9e8f283a8af138b0338d0d4e90518ad6adfd5f5d/mailnews/mime/src/mimeebod.cpp">annotate</a> |
<a href="/comm-central/diff/9e8f283a8af138b0338d0d4e90518ad6adfd5f5d/mailnews/mime/src/mimeebod.cpp">diff</a> |
<a href="/comm-central/comparison/9e8f283a8af138b0338d0d4e90518ad6adfd5f5d/mailnews/mime/src/mimeebod.cpp">comparison</a> |
<a href="/comm-central/log/9e8f283a8af138b0338d0d4e90518ad6adfd5f5d/mailnews/mime/src/mimeebod.cpp">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/9e8f283a8af138b0338d0d4e90518ad6adfd5f5d/mailnews/mime/src/mimemoz2.h">mailnews/mime/src/mimemoz2.h</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/9e8f283a8af138b0338d0d4e90518ad6adfd5f5d/mailnews/mime/src/mimemoz2.h">file</a> |
<a href="/comm-central/annotate/9e8f283a8af138b0338d0d4e90518ad6adfd5f5d/mailnews/mime/src/mimemoz2.h">annotate</a> |
<a href="/comm-central/diff/9e8f283a8af138b0338d0d4e90518ad6adfd5f5d/mailnews/mime/src/mimemoz2.h">diff</a> |
<a href="/comm-central/comparison/9e8f283a8af138b0338d0d4e90518ad6adfd5f5d/mailnews/mime/src/mimemoz2.h">comparison</a> |
<a href="/comm-central/log/9e8f283a8af138b0338d0d4e90518ad6adfd5f5d/mailnews/mime/src/mimemoz2.h">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/9e8f283a8af138b0338d0d4e90518ad6adfd5f5d/mailnews/mime/src/mimemrel.h">mailnews/mime/src/mimemrel.h</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/9e8f283a8af138b0338d0d4e90518ad6adfd5f5d/mailnews/mime/src/mimemrel.h">file</a> |
<a href="/comm-central/annotate/9e8f283a8af138b0338d0d4e90518ad6adfd5f5d/mailnews/mime/src/mimemrel.h">annotate</a> |
<a href="/comm-central/diff/9e8f283a8af138b0338d0d4e90518ad6adfd5f5d/mailnews/mime/src/mimemrel.h">diff</a> |
<a href="/comm-central/comparison/9e8f283a8af138b0338d0d4e90518ad6adfd5f5d/mailnews/mime/src/mimemrel.h">comparison</a> |
<a href="/comm-central/log/9e8f283a8af138b0338d0d4e90518ad6adfd5f5d/mailnews/mime/src/mimemrel.h">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/9e8f283a8af138b0338d0d4e90518ad6adfd5f5d/mailnews/mime/src/mimepbuf.cpp">mailnews/mime/src/mimepbuf.cpp</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/9e8f283a8af138b0338d0d4e90518ad6adfd5f5d/mailnews/mime/src/mimepbuf.cpp">file</a> |
<a href="/comm-central/annotate/9e8f283a8af138b0338d0d4e90518ad6adfd5f5d/mailnews/mime/src/mimepbuf.cpp">annotate</a> |
<a href="/comm-central/diff/9e8f283a8af138b0338d0d4e90518ad6adfd5f5d/mailnews/mime/src/mimepbuf.cpp">diff</a> |
<a href="/comm-central/comparison/9e8f283a8af138b0338d0d4e90518ad6adfd5f5d/mailnews/mime/src/mimepbuf.cpp">comparison</a> |
<a href="/comm-central/log/9e8f283a8af138b0338d0d4e90518ad6adfd5f5d/mailnews/mime/src/mimepbuf.cpp">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/9e8f283a8af138b0338d0d4e90518ad6adfd5f5d/mailnews/news/public/nsINntpIncomingServer.idl">mailnews/news/public/nsINntpIncomingServer.idl</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/9e8f283a8af138b0338d0d4e90518ad6adfd5f5d/mailnews/news/public/nsINntpIncomingServer.idl">file</a> |
<a href="/comm-central/annotate/9e8f283a8af138b0338d0d4e90518ad6adfd5f5d/mailnews/news/public/nsINntpIncomingServer.idl">annotate</a> |
<a href="/comm-central/diff/9e8f283a8af138b0338d0d4e90518ad6adfd5f5d/mailnews/news/public/nsINntpIncomingServer.idl">diff</a> |
<a href="/comm-central/comparison/9e8f283a8af138b0338d0d4e90518ad6adfd5f5d/mailnews/news/public/nsINntpIncomingServer.idl">comparison</a> |
<a href="/comm-central/log/9e8f283a8af138b0338d0d4e90518ad6adfd5f5d/mailnews/news/public/nsINntpIncomingServer.idl">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/9e8f283a8af138b0338d0d4e90518ad6adfd5f5d/mailnews/news/src/nsNewsFolder.cpp">mailnews/news/src/nsNewsFolder.cpp</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/9e8f283a8af138b0338d0d4e90518ad6adfd5f5d/mailnews/news/src/nsNewsFolder.cpp">file</a> |
<a href="/comm-central/annotate/9e8f283a8af138b0338d0d4e90518ad6adfd5f5d/mailnews/news/src/nsNewsFolder.cpp">annotate</a> |
<a href="/comm-central/diff/9e8f283a8af138b0338d0d4e90518ad6adfd5f5d/mailnews/news/src/nsNewsFolder.cpp">diff</a> |
<a href="/comm-central/comparison/9e8f283a8af138b0338d0d4e90518ad6adfd5f5d/mailnews/news/src/nsNewsFolder.cpp">comparison</a> |
<a href="/comm-central/log/9e8f283a8af138b0338d0d4e90518ad6adfd5f5d/mailnews/news/src/nsNewsFolder.cpp">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/9e8f283a8af138b0338d0d4e90518ad6adfd5f5d/mailnews/news/src/nsNewsFolder.h">mailnews/news/src/nsNewsFolder.h</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/9e8f283a8af138b0338d0d4e90518ad6adfd5f5d/mailnews/news/src/nsNewsFolder.h">file</a> |
<a href="/comm-central/annotate/9e8f283a8af138b0338d0d4e90518ad6adfd5f5d/mailnews/news/src/nsNewsFolder.h">annotate</a> |
<a href="/comm-central/diff/9e8f283a8af138b0338d0d4e90518ad6adfd5f5d/mailnews/news/src/nsNewsFolder.h">diff</a> |
<a href="/comm-central/comparison/9e8f283a8af138b0338d0d4e90518ad6adfd5f5d/mailnews/news/src/nsNewsFolder.h">comparison</a> |
<a href="/comm-central/log/9e8f283a8af138b0338d0d4e90518ad6adfd5f5d/mailnews/news/src/nsNewsFolder.h">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/9e8f283a8af138b0338d0d4e90518ad6adfd5f5d/mailnews/news/src/nsNntpIncomingServer.cpp">mailnews/news/src/nsNntpIncomingServer.cpp</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/9e8f283a8af138b0338d0d4e90518ad6adfd5f5d/mailnews/news/src/nsNntpIncomingServer.cpp">file</a> |
<a href="/comm-central/annotate/9e8f283a8af138b0338d0d4e90518ad6adfd5f5d/mailnews/news/src/nsNntpIncomingServer.cpp">annotate</a> |
<a href="/comm-central/diff/9e8f283a8af138b0338d0d4e90518ad6adfd5f5d/mailnews/news/src/nsNntpIncomingServer.cpp">diff</a> |
<a href="/comm-central/comparison/9e8f283a8af138b0338d0d4e90518ad6adfd5f5d/mailnews/news/src/nsNntpIncomingServer.cpp">comparison</a> |
<a href="/comm-central/log/9e8f283a8af138b0338d0d4e90518ad6adfd5f5d/mailnews/news/src/nsNntpIncomingServer.cpp">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/9e8f283a8af138b0338d0d4e90518ad6adfd5f5d/mailnews/news/src/nsNntpIncomingServer.h">mailnews/news/src/nsNntpIncomingServer.h</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/9e8f283a8af138b0338d0d4e90518ad6adfd5f5d/mailnews/news/src/nsNntpIncomingServer.h">file</a> |
<a href="/comm-central/annotate/9e8f283a8af138b0338d0d4e90518ad6adfd5f5d/mailnews/news/src/nsNntpIncomingServer.h">annotate</a> |
<a href="/comm-central/diff/9e8f283a8af138b0338d0d4e90518ad6adfd5f5d/mailnews/news/src/nsNntpIncomingServer.h">diff</a> |
<a href="/comm-central/comparison/9e8f283a8af138b0338d0d4e90518ad6adfd5f5d/mailnews/news/src/nsNntpIncomingServer.h">comparison</a> |
<a href="/comm-central/log/9e8f283a8af138b0338d0d4e90518ad6adfd5f5d/mailnews/news/src/nsNntpIncomingServer.h">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/9e8f283a8af138b0338d0d4e90518ad6adfd5f5d/mailnews/news/src/nsNntpService.cpp">mailnews/news/src/nsNntpService.cpp</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/9e8f283a8af138b0338d0d4e90518ad6adfd5f5d/mailnews/news/src/nsNntpService.cpp">file</a> |
<a href="/comm-central/annotate/9e8f283a8af138b0338d0d4e90518ad6adfd5f5d/mailnews/news/src/nsNntpService.cpp">annotate</a> |
<a href="/comm-central/diff/9e8f283a8af138b0338d0d4e90518ad6adfd5f5d/mailnews/news/src/nsNntpService.cpp">diff</a> |
<a href="/comm-central/comparison/9e8f283a8af138b0338d0d4e90518ad6adfd5f5d/mailnews/news/src/nsNntpService.cpp">comparison</a> |
<a href="/comm-central/log/9e8f283a8af138b0338d0d4e90518ad6adfd5f5d/mailnews/news/src/nsNntpService.cpp">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/9e8f283a8af138b0338d0d4e90518ad6adfd5f5d/mailnews/news/src/nsNntpUrl.h">mailnews/news/src/nsNntpUrl.h</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/9e8f283a8af138b0338d0d4e90518ad6adfd5f5d/mailnews/news/src/nsNntpUrl.h">file</a> |
<a href="/comm-central/annotate/9e8f283a8af138b0338d0d4e90518ad6adfd5f5d/mailnews/news/src/nsNntpUrl.h">annotate</a> |
<a href="/comm-central/diff/9e8f283a8af138b0338d0d4e90518ad6adfd5f5d/mailnews/news/src/nsNntpUrl.h">diff</a> |
<a href="/comm-central/comparison/9e8f283a8af138b0338d0d4e90518ad6adfd5f5d/mailnews/news/src/nsNntpUrl.h">comparison</a> |
<a href="/comm-central/log/9e8f283a8af138b0338d0d4e90518ad6adfd5f5d/mailnews/news/src/nsNntpUrl.h">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/9e8f283a8af138b0338d0d4e90518ad6adfd5f5d/suite/app/nsSuiteApp.cpp">suite/app/nsSuiteApp.cpp</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/9e8f283a8af138b0338d0d4e90518ad6adfd5f5d/suite/app/nsSuiteApp.cpp">file</a> |
<a href="/comm-central/annotate/9e8f283a8af138b0338d0d4e90518ad6adfd5f5d/suite/app/nsSuiteApp.cpp">annotate</a> |
<a href="/comm-central/diff/9e8f283a8af138b0338d0d4e90518ad6adfd5f5d/suite/app/nsSuiteApp.cpp">diff</a> |
<a href="/comm-central/comparison/9e8f283a8af138b0338d0d4e90518ad6adfd5f5d/suite/app/nsSuiteApp.cpp">comparison</a> |
<a href="/comm-central/log/9e8f283a8af138b0338d0d4e90518ad6adfd5f5d/suite/app/nsSuiteApp.cpp">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/9e8f283a8af138b0338d0d4e90518ad6adfd5f5d/suite/profile/migration/src/nsNetscapeProfileMigratorBase.cpp">suite/profile/migration/src/nsNetscapeProfileMigratorBase.cpp</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/9e8f283a8af138b0338d0d4e90518ad6adfd5f5d/suite/profile/migration/src/nsNetscapeProfileMigratorBase.cpp">file</a> |
<a href="/comm-central/annotate/9e8f283a8af138b0338d0d4e90518ad6adfd5f5d/suite/profile/migration/src/nsNetscapeProfileMigratorBase.cpp">annotate</a> |
<a href="/comm-central/diff/9e8f283a8af138b0338d0d4e90518ad6adfd5f5d/suite/profile/migration/src/nsNetscapeProfileMigratorBase.cpp">diff</a> |
<a href="/comm-central/comparison/9e8f283a8af138b0338d0d4e90518ad6adfd5f5d/suite/profile/migration/src/nsNetscapeProfileMigratorBase.cpp">comparison</a> |
<a href="/comm-central/log/9e8f283a8af138b0338d0d4e90518ad6adfd5f5d/suite/profile/migration/src/nsNetscapeProfileMigratorBase.cpp">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/9e8f283a8af138b0338d0d4e90518ad6adfd5f5d/suite/profile/migration/src/nsNetscapeProfileMigratorBase.h">suite/profile/migration/src/nsNetscapeProfileMigratorBase.h</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/9e8f283a8af138b0338d0d4e90518ad6adfd5f5d/suite/profile/migration/src/nsNetscapeProfileMigratorBase.h">file</a> |
<a href="/comm-central/annotate/9e8f283a8af138b0338d0d4e90518ad6adfd5f5d/suite/profile/migration/src/nsNetscapeProfileMigratorBase.h">annotate</a> |
<a href="/comm-central/diff/9e8f283a8af138b0338d0d4e90518ad6adfd5f5d/suite/profile/migration/src/nsNetscapeProfileMigratorBase.h">diff</a> |
<a href="/comm-central/comparison/9e8f283a8af138b0338d0d4e90518ad6adfd5f5d/suite/profile/migration/src/nsNetscapeProfileMigratorBase.h">comparison</a> |
<a href="/comm-central/log/9e8f283a8af138b0338d0d4e90518ad6adfd5f5d/suite/profile/migration/src/nsNetscapeProfileMigratorBase.h">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/9e8f283a8af138b0338d0d4e90518ad6adfd5f5d/suite/profile/migration/src/nsProfileMigrator.cpp">suite/profile/migration/src/nsProfileMigrator.cpp</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/9e8f283a8af138b0338d0d4e90518ad6adfd5f5d/suite/profile/migration/src/nsProfileMigrator.cpp">file</a> |
<a href="/comm-central/annotate/9e8f283a8af138b0338d0d4e90518ad6adfd5f5d/suite/profile/migration/src/nsProfileMigrator.cpp">annotate</a> |
<a href="/comm-central/diff/9e8f283a8af138b0338d0d4e90518ad6adfd5f5d/suite/profile/migration/src/nsProfileMigrator.cpp">diff</a> |
<a href="/comm-central/comparison/9e8f283a8af138b0338d0d4e90518ad6adfd5f5d/suite/profile/migration/src/nsProfileMigrator.cpp">comparison</a> |
<a href="/comm-central/log/9e8f283a8af138b0338d0d4e90518ad6adfd5f5d/suite/profile/migration/src/nsProfileMigrator.cpp">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/9e8f283a8af138b0338d0d4e90518ad6adfd5f5d/suite/profile/migration/src/nsSuiteProfileMigratorUtils.h">suite/profile/migration/src/nsSuiteProfileMigratorUtils.h</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/9e8f283a8af138b0338d0d4e90518ad6adfd5f5d/suite/profile/migration/src/nsSuiteProfileMigratorUtils.h">file</a> |
<a href="/comm-central/annotate/9e8f283a8af138b0338d0d4e90518ad6adfd5f5d/suite/profile/migration/src/nsSuiteProfileMigratorUtils.h">annotate</a> |
<a href="/comm-central/diff/9e8f283a8af138b0338d0d4e90518ad6adfd5f5d/suite/profile/migration/src/nsSuiteProfileMigratorUtils.h">diff</a> |
<a href="/comm-central/comparison/9e8f283a8af138b0338d0d4e90518ad6adfd5f5d/suite/profile/migration/src/nsSuiteProfileMigratorUtils.h">comparison</a> |
<a href="/comm-central/log/9e8f283a8af138b0338d0d4e90518ad6adfd5f5d/suite/profile/migration/src/nsSuiteProfileMigratorUtils.h">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/9e8f283a8af138b0338d0d4e90518ad6adfd5f5d/suite/profile/migration/src/nsThunderbirdProfileMigrator.cpp">suite/profile/migration/src/nsThunderbirdProfileMigrator.cpp</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/9e8f283a8af138b0338d0d4e90518ad6adfd5f5d/suite/profile/migration/src/nsThunderbirdProfileMigrator.cpp">file</a> |
<a href="/comm-central/annotate/9e8f283a8af138b0338d0d4e90518ad6adfd5f5d/suite/profile/migration/src/nsThunderbirdProfileMigrator.cpp">annotate</a> |
<a href="/comm-central/diff/9e8f283a8af138b0338d0d4e90518ad6adfd5f5d/suite/profile/migration/src/nsThunderbirdProfileMigrator.cpp">diff</a> |
<a href="/comm-central/comparison/9e8f283a8af138b0338d0d4e90518ad6adfd5f5d/suite/profile/migration/src/nsThunderbirdProfileMigrator.cpp">comparison</a> |
<a href="/comm-central/log/9e8f283a8af138b0338d0d4e90518ad6adfd5f5d/suite/profile/migration/src/nsThunderbirdProfileMigrator.cpp">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/9e8f283a8af138b0338d0d4e90518ad6adfd5f5d/suite/profile/migration/src/nsThunderbirdProfileMigrator.h">suite/profile/migration/src/nsThunderbirdProfileMigrator.h</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/9e8f283a8af138b0338d0d4e90518ad6adfd5f5d/suite/profile/migration/src/nsThunderbirdProfileMigrator.h">file</a> |
<a href="/comm-central/annotate/9e8f283a8af138b0338d0d4e90518ad6adfd5f5d/suite/profile/migration/src/nsThunderbirdProfileMigrator.h">annotate</a> |
<a href="/comm-central/diff/9e8f283a8af138b0338d0d4e90518ad6adfd5f5d/suite/profile/migration/src/nsThunderbirdProfileMigrator.h">diff</a> |
<a href="/comm-central/comparison/9e8f283a8af138b0338d0d4e90518ad6adfd5f5d/suite/profile/migration/src/nsThunderbirdProfileMigrator.h">comparison</a> |
<a href="/comm-central/log/9e8f283a8af138b0338d0d4e90518ad6adfd5f5d/suite/profile/migration/src/nsThunderbirdProfileMigrator.h">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/9e8f283a8af138b0338d0d4e90518ad6adfd5f5d/suite/shell/public/nsIShellService.idl">suite/shell/public/nsIShellService.idl</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/9e8f283a8af138b0338d0d4e90518ad6adfd5f5d/suite/shell/public/nsIShellService.idl">file</a> |
<a href="/comm-central/annotate/9e8f283a8af138b0338d0d4e90518ad6adfd5f5d/suite/shell/public/nsIShellService.idl">annotate</a> |
<a href="/comm-central/diff/9e8f283a8af138b0338d0d4e90518ad6adfd5f5d/suite/shell/public/nsIShellService.idl">diff</a> |
<a href="/comm-central/comparison/9e8f283a8af138b0338d0d4e90518ad6adfd5f5d/suite/shell/public/nsIShellService.idl">comparison</a> |
<a href="/comm-central/log/9e8f283a8af138b0338d0d4e90518ad6adfd5f5d/suite/shell/public/nsIShellService.idl">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/9e8f283a8af138b0338d0d4e90518ad6adfd5f5d/suite/shell/src/nsGNOMEShellService.cpp">suite/shell/src/nsGNOMEShellService.cpp</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/9e8f283a8af138b0338d0d4e90518ad6adfd5f5d/suite/shell/src/nsGNOMEShellService.cpp">file</a> |
<a href="/comm-central/annotate/9e8f283a8af138b0338d0d4e90518ad6adfd5f5d/suite/shell/src/nsGNOMEShellService.cpp">annotate</a> |
<a href="/comm-central/diff/9e8f283a8af138b0338d0d4e90518ad6adfd5f5d/suite/shell/src/nsGNOMEShellService.cpp">diff</a> |
<a href="/comm-central/comparison/9e8f283a8af138b0338d0d4e90518ad6adfd5f5d/suite/shell/src/nsGNOMEShellService.cpp">comparison</a> |
<a href="/comm-central/log/9e8f283a8af138b0338d0d4e90518ad6adfd5f5d/suite/shell/src/nsGNOMEShellService.cpp">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/9e8f283a8af138b0338d0d4e90518ad6adfd5f5d/suite/shell/src/nsMacShellService.cpp">suite/shell/src/nsMacShellService.cpp</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/9e8f283a8af138b0338d0d4e90518ad6adfd5f5d/suite/shell/src/nsMacShellService.cpp">file</a> |
<a href="/comm-central/annotate/9e8f283a8af138b0338d0d4e90518ad6adfd5f5d/suite/shell/src/nsMacShellService.cpp">annotate</a> |
<a href="/comm-central/diff/9e8f283a8af138b0338d0d4e90518ad6adfd5f5d/suite/shell/src/nsMacShellService.cpp">diff</a> |
<a href="/comm-central/comparison/9e8f283a8af138b0338d0d4e90518ad6adfd5f5d/suite/shell/src/nsMacShellService.cpp">comparison</a> |
<a href="/comm-central/log/9e8f283a8af138b0338d0d4e90518ad6adfd5f5d/suite/shell/src/nsMacShellService.cpp">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/9e8f283a8af138b0338d0d4e90518ad6adfd5f5d/suite/shell/src/nsWindowsShellService.cpp">suite/shell/src/nsWindowsShellService.cpp</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/9e8f283a8af138b0338d0d4e90518ad6adfd5f5d/suite/shell/src/nsWindowsShellService.cpp">file</a> |
<a href="/comm-central/annotate/9e8f283a8af138b0338d0d4e90518ad6adfd5f5d/suite/shell/src/nsWindowsShellService.cpp">annotate</a> |
<a href="/comm-central/diff/9e8f283a8af138b0338d0d4e90518ad6adfd5f5d/suite/shell/src/nsWindowsShellService.cpp">diff</a> |
<a href="/comm-central/comparison/9e8f283a8af138b0338d0d4e90518ad6adfd5f5d/suite/shell/src/nsWindowsShellService.cpp">comparison</a> |
<a href="/comm-central/log/9e8f283a8af138b0338d0d4e90518ad6adfd5f5d/suite/shell/src/nsWindowsShellService.cpp">revisions</a>
</td>
</tr>
</table></div>

<div class="page_body diffblocks"><div class="diffblock"><pre class="sourcelines">
<a href="#l1.1"></a><span id="l1.1" class="difflineminus">--- a/calendar/sunbird/app/nsCalendarApp.cpp</span>
<a href="#l1.2"></a><span id="l1.2" class="difflineplus">+++ b/calendar/sunbird/app/nsCalendarApp.cpp</span>
<a href="#l1.3"></a><span id="l1.3" class="difflineat">@@ -8,17 +8,17 @@</span>
<a href="#l1.4"></a><span id="l1.4"> #include &lt;windows.h&gt;</span>
<a href="#l1.5"></a><span id="l1.5"> #include &lt;stdlib.h&gt;</span>
<a href="#l1.6"></a><span id="l1.6"> #endif</span>
<a href="#l1.7"></a><span id="l1.7"> </span>
<a href="#l1.8"></a><span id="l1.8"> #include &lt;stdio.h&gt;</span>
<a href="#l1.9"></a><span id="l1.9"> #include &lt;stdarg.h&gt;</span>
<a href="#l1.10"></a><span id="l1.10"> </span>
<a href="#l1.11"></a><span id="l1.11"> #include &quot;nsCOMPtr.h&quot;</span>
<a href="#l1.12"></a><span id="l1.12" class="difflineminus">-#include &quot;nsILocalFile.h&quot;</span>
<a href="#l1.13"></a><span id="l1.13" class="difflineplus">+#include &quot;nsIFile.h&quot;</span>
<a href="#l1.14"></a><span id="l1.14"> #include &quot;nsStringGlue.h&quot;</span>
<a href="#l1.15"></a><span id="l1.15"> </span>
<a href="#l1.16"></a><span id="l1.16"> #ifdef XP_WIN</span>
<a href="#l1.17"></a><span id="l1.17"> #include &quot;nsWindowsWMain.cpp&quot;</span>
<a href="#l1.18"></a><span id="l1.18"> #endif</span>
<a href="#l1.19"></a><span id="l1.19"> </span>
<a href="#l1.20"></a><span id="l1.20"> static void Output(const char *fmt, ... )</span>
<a href="#l1.21"></a><span id="l1.21"> {</span>
<a href="#l1.22"></a><span id="l1.22" class="difflineat">@@ -33,17 +33,17 @@ static void Output(const char *fmt, ... </span>
<a href="#l1.23"></a><span id="l1.23">   vfprintf(stderr, fmt, ap);</span>
<a href="#l1.24"></a><span id="l1.24"> #endif</span>
<a href="#l1.25"></a><span id="l1.25"> </span>
<a href="#l1.26"></a><span id="l1.26">   va_end(ap);</span>
<a href="#l1.27"></a><span id="l1.27"> }</span>
<a href="#l1.28"></a><span id="l1.28"> </span>
<a href="#l1.29"></a><span id="l1.29"> int main(int argc, char* argv[])</span>
<a href="#l1.30"></a><span id="l1.30"> {</span>
<a href="#l1.31"></a><span id="l1.31" class="difflineminus">-  nsCOMPtr&lt;nsILocalFile&gt; appini;</span>
<a href="#l1.32"></a><span id="l1.32" class="difflineplus">+  nsCOMPtr&lt;nsIFile&gt; appini;</span>
<a href="#l1.33"></a><span id="l1.33">   nsresult rv = XRE_GetBinaryPath(argv[0], getter_AddRefs(appini));</span>
<a href="#l1.34"></a><span id="l1.34">   if (NS_FAILED(rv)) {</span>
<a href="#l1.35"></a><span id="l1.35">     Output(&quot;Couldn't calculate the application directory.&quot;);</span>
<a href="#l1.36"></a><span id="l1.36">     return 255;</span>
<a href="#l1.37"></a><span id="l1.37">   }</span>
<a href="#l1.38"></a><span id="l1.38">   appini-&gt;SetNativeLeafName(NS_LITERAL_CSTRING(&quot;application.ini&quot;));</span>
<a href="#l1.39"></a><span id="l1.39"> </span>
<a href="#l1.40"></a><span id="l1.40">   nsXREAppData *appData;</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l2.1"></a><span id="l2.1" class="difflineminus">--- a/chat/components/public/imIUserStatusInfo.idl</span>
<a href="#l2.2"></a><span id="l2.2" class="difflineplus">+++ b/chat/components/public/imIUserStatusInfo.idl</span>
<a href="#l2.3"></a><span id="l2.3" class="difflineat">@@ -1,17 +1,17 @@</span>
<a href="#l2.4"></a><span id="l2.4"> /* This Source Code Form is subject to the terms of the Mozilla Public</span>
<a href="#l2.5"></a><span id="l2.5">  * License, v. 2.0. If a copy of the MPL was not distributed with this</span>
<a href="#l2.6"></a><span id="l2.6">  * file, You can obtain one at http://mozilla.org/MPL/2.0/. */</span>
<a href="#l2.7"></a><span id="l2.7"> </span>
<a href="#l2.8"></a><span id="l2.8"> #include &quot;nsISupports.idl&quot;</span>
<a href="#l2.9"></a><span id="l2.9"> #include &quot;nsIObserver.idl&quot;</span>
<a href="#l2.10"></a><span id="l2.10"> </span>
<a href="#l2.11"></a><span id="l2.11"> //forward declarations</span>
<a href="#l2.12"></a><span id="l2.12" class="difflineminus">-interface nsILocalFile;</span>
<a href="#l2.13"></a><span id="l2.13" class="difflineplus">+interface nsIFile;</span>
<a href="#l2.14"></a><span id="l2.14"> interface nsIFileURL;</span>
<a href="#l2.15"></a><span id="l2.15"> </span>
<a href="#l2.16"></a><span id="l2.16"> [scriptable, uuid(817918fa-1f4b-4254-9cdb-f906da91c45d)]</span>
<a href="#l2.17"></a><span id="l2.17"> interface imIUserStatusInfo: nsISupports {</span>
<a href="#l2.18"></a><span id="l2.18"> </span>
<a href="#l2.19"></a><span id="l2.19">   readonly attribute AUTF8String statusText;</span>
<a href="#l2.20"></a><span id="l2.20"> </span>
<a href="#l2.21"></a><span id="l2.21">   // See imIStatusInfo for the values.</span>
<a href="#l2.22"></a><span id="l2.22" class="difflineat">@@ -20,17 +20,17 @@ interface imIUserStatusInfo: nsISupports</span>
<a href="#l2.23"></a><span id="l2.23">   // Only works with STATUS_OFFLINE, STATUS_UNAVAILABLE, STATUS_AWAY,</span>
<a href="#l2.24"></a><span id="l2.24">   // STATUS_AVAILABLE and STATUS_INVISIBLE.</span>
<a href="#l2.25"></a><span id="l2.25">   // - When called with the status type STATUS_UNSET, only the status</span>
<a href="#l2.26"></a><span id="l2.26">   //   message will be changed.</span>
<a href="#l2.27"></a><span id="l2.27">   // - When called with STATUS_OFFLINE, the aMessage parameter is ignored.</span>
<a href="#l2.28"></a><span id="l2.28">   void setStatus(in short aStatus, in AUTF8String aMessage);</span>
<a href="#l2.29"></a><span id="l2.29"> </span>
<a href="#l2.30"></a><span id="l2.30">   /* Will fire an user-icon-changed notificaton. */</span>
<a href="#l2.31"></a><span id="l2.31" class="difflineminus">-  void setUserIcon(in nsILocalFile aIconFile);</span>
<a href="#l2.32"></a><span id="l2.32" class="difflineplus">+  void setUserIcon(in nsIFile aIconFile);</span>
<a href="#l2.33"></a><span id="l2.33"> </span>
<a href="#l2.34"></a><span id="l2.34">   nsIFileURL getUserIcon();</span>
<a href="#l2.35"></a><span id="l2.35"> </span>
<a href="#l2.36"></a><span id="l2.36">   /* The setter will fire an user-display-name-changed notificaton. */</span>
<a href="#l2.37"></a><span id="l2.37">   attribute AUTF8String displayName;</span>
<a href="#l2.38"></a><span id="l2.38"> </span>
<a href="#l2.39"></a><span id="l2.39">   void addObserver(in nsIObserver aObserver);</span>
<a href="#l2.40"></a><span id="l2.40">   void removeObserver(in nsIObserver aObserver);</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l3.1"></a><span id="l3.1" class="difflineminus">--- a/mail/app/nsMailApp.cpp</span>
<a href="#l3.2"></a><span id="l3.2" class="difflineplus">+++ b/mail/app/nsMailApp.cpp</span>
<a href="#l3.3"></a><span id="l3.3" class="difflineat">@@ -16,17 +16,17 @@</span>
<a href="#l3.4"></a><span id="l3.4"> #ifdef XP_MACOSX</span>
<a href="#l3.5"></a><span id="l3.5"> #include &quot;MacQuirks.h&quot;</span>
<a href="#l3.6"></a><span id="l3.6"> #endif</span>
<a href="#l3.7"></a><span id="l3.7"> </span>
<a href="#l3.8"></a><span id="l3.8"> #include &lt;stdio.h&gt;</span>
<a href="#l3.9"></a><span id="l3.9"> #include &lt;stdarg.h&gt;</span>
<a href="#l3.10"></a><span id="l3.10"> </span>
<a href="#l3.11"></a><span id="l3.11"> #include &quot;nsCOMPtr.h&quot;</span>
<a href="#l3.12"></a><span id="l3.12" class="difflineminus">-#include &quot;nsILocalFile.h&quot;</span>
<a href="#l3.13"></a><span id="l3.13" class="difflineplus">+#include &quot;nsIFile.h&quot;</span>
<a href="#l3.14"></a><span id="l3.14"> #include &quot;nsStringGlue.h&quot;</span>
<a href="#l3.15"></a><span id="l3.15"> </span>
<a href="#l3.16"></a><span id="l3.16"> #ifdef XP_WIN</span>
<a href="#l3.17"></a><span id="l3.17"> // we want a wmain entry point</span>
<a href="#l3.18"></a><span id="l3.18"> #include &quot;nsWindowsWMain.cpp&quot;</span>
<a href="#l3.19"></a><span id="l3.19"> #define snprintf _snprintf</span>
<a href="#l3.20"></a><span id="l3.20"> #define strcasecmp _stricmp</span>
<a href="#l3.21"></a><span id="l3.21"> #endif</span>
<a href="#l3.22"></a><span id="l3.22" class="difflineat">@@ -80,17 +80,17 @@ static const nsDynamicFunctionLoad kXULF</span>
<a href="#l3.23"></a><span id="l3.23"> #endif</span>
<a href="#l3.24"></a><span id="l3.24">     { &quot;XRE_TelemetryAccumulate&quot;, (NSFuncPtr*) &amp;XRE_TelemetryAccumulate },</span>
<a href="#l3.25"></a><span id="l3.25">     { &quot;XRE_main&quot;, (NSFuncPtr*) &amp;XRE_main },</span>
<a href="#l3.26"></a><span id="l3.26">     { nsnull, nsnull }</span>
<a href="#l3.27"></a><span id="l3.27"> };</span>
<a href="#l3.28"></a><span id="l3.28"> </span>
<a href="#l3.29"></a><span id="l3.29"> static int do_main(const char *exePath, int argc, char* argv[])</span>
<a href="#l3.30"></a><span id="l3.30"> {</span>
<a href="#l3.31"></a><span id="l3.31" class="difflineminus">-  nsCOMPtr&lt;nsILocalFile&gt; appini;</span>
<a href="#l3.32"></a><span id="l3.32" class="difflineplus">+  nsCOMPtr&lt;nsIFile&gt; appini;</span>
<a href="#l3.33"></a><span id="l3.33"> #ifdef XP_WIN</span>
<a href="#l3.34"></a><span id="l3.34">   // exePath comes from mozilla::BinaryPath::Get, which returns a UTF-8</span>
<a href="#l3.35"></a><span id="l3.35">   // encoded path, so it is safe to convert it</span>
<a href="#l3.36"></a><span id="l3.36">   nsresult rv = NS_NewLocalFile(NS_ConvertUTF8toUTF16(exePath), false,</span>
<a href="#l3.37"></a><span id="l3.37">                                 getter_AddRefs(appini));</span>
<a href="#l3.38"></a><span id="l3.38"> #else</span>
<a href="#l3.39"></a><span id="l3.39">   nsresult rv = NS_NewNativeLocalFile(nsDependentCString(exePath), false,</span>
<a href="#l3.40"></a><span id="l3.40">                                       getter_AddRefs(appini));</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l4.1"></a><span id="l4.1" class="difflineminus">--- a/mail/components/cloudfile/nsIMsgCloudFileProvider.idl</span>
<a href="#l4.2"></a><span id="l4.2" class="difflineplus">+++ b/mail/components/cloudfile/nsIMsgCloudFileProvider.idl</span>
<a href="#l4.3"></a><span id="l4.3" class="difflineat">@@ -1,15 +1,15 @@</span>
<a href="#l4.4"></a><span id="l4.4"> /* This Source Code Form is subject to the terms of the Mozilla Public</span>
<a href="#l4.5"></a><span id="l4.5">  * License, v. 2.0. If a copy of the MPL was not distributed with this file,</span>
<a href="#l4.6"></a><span id="l4.6">  * You can obtain one at http://mozilla.org/MPL/2.0/. */</span>
<a href="#l4.7"></a><span id="l4.7"> </span>
<a href="#l4.8"></a><span id="l4.8"> #include &quot;nsISupports.idl&quot;</span>
<a href="#l4.9"></a><span id="l4.9"> </span>
<a href="#l4.10"></a><span id="l4.10" class="difflineminus">-interface nsILocalFile;</span>
<a href="#l4.11"></a><span id="l4.11" class="difflineplus">+interface nsIFile;</span>
<a href="#l4.12"></a><span id="l4.12"> interface nsIRequestObserver;</span>
<a href="#l4.13"></a><span id="l4.13"> interface nsIPrefBranch;</span>
<a href="#l4.14"></a><span id="l4.14"> [scriptable, uuid(c961919b-980b-4adc-bcfe-dabe916d1acc)]</span>
<a href="#l4.15"></a><span id="l4.15"> interface nsIMsgCloudFileProvider : nsISupports {</span>
<a href="#l4.16"></a><span id="l4.16">   // The type is a unique string identifier used by various interface elements</span>
<a href="#l4.17"></a><span id="l4.17">   // for styling. As such, the type should be an alphanumpheric string with</span>
<a href="#l4.18"></a><span id="l4.18">   // no spaces.</span>
<a href="#l4.19"></a><span id="l4.19">   readonly attribute ACString type;</span>
<a href="#l4.20"></a><span id="l4.20" class="difflineat">@@ -33,26 +33,26 @@ interface nsIMsgCloudFileProvider : nsIS</span>
<a href="#l4.21"></a><span id="l4.21">    * upload the file to the cloud provider. The callback's OnStopRequest</span>
<a href="#l4.22"></a><span id="l4.22">    * method will be called when finished, with success or an error code.</span>
<a href="#l4.23"></a><span id="l4.23">    *</span>
<a href="#l4.24"></a><span id="l4.24">    * @param aFile file to upload</span>
<a href="#l4.25"></a><span id="l4.25">    * @param aCallback callback when finished.</span>
<a href="#l4.26"></a><span id="l4.26">    *</span>
<a href="#l4.27"></a><span id="l4.27">    * @throws nsIMsgCloudFileProvider.offlineErr if we are offline.</span>
<a href="#l4.28"></a><span id="l4.28">    */</span>
<a href="#l4.29"></a><span id="l4.29" class="difflineminus">-  void uploadFile(in nsILocalFile aFile, in nsIRequestObserver aCallback);</span>
<a href="#l4.30"></a><span id="l4.30" class="difflineminus">-  ACString urlForFile(in nsILocalFile aFile);</span>
<a href="#l4.31"></a><span id="l4.31" class="difflineplus">+  void uploadFile(in nsIFile aFile, in nsIRequestObserver aCallback);</span>
<a href="#l4.32"></a><span id="l4.32" class="difflineplus">+  ACString urlForFile(in nsIFile aFile);</span>
<a href="#l4.33"></a><span id="l4.33"> </span>
<a href="#l4.34"></a><span id="l4.34">   /**</span>
<a href="#l4.35"></a><span id="l4.35">    * Cancels the upload of the passed in file, if it hasn't finished yet.</span>
<a href="#l4.36"></a><span id="l4.36">    * If it hasn't started yet, it will be removed from the upload queue.</span>
<a href="#l4.37"></a><span id="l4.37">    *</span>
<a href="#l4.38"></a><span id="l4.38">    * @param aFile file whose upload we should cancel.</span>
<a href="#l4.39"></a><span id="l4.39">    */</span>
<a href="#l4.40"></a><span id="l4.40" class="difflineminus">-  void cancelFileUpload(in nsILocalFile aFile);</span>
<a href="#l4.41"></a><span id="l4.41" class="difflineplus">+  void cancelFileUpload(in nsIFile aFile);</span>
<a href="#l4.42"></a><span id="l4.42"> </span>
<a href="#l4.43"></a><span id="l4.43">   /**</span>
<a href="#l4.44"></a><span id="l4.44">    * Refresh the user info for this account. This will fill in the quota info,</span>
<a href="#l4.45"></a><span id="l4.45">    * if supported by the provider.</span>
<a href="#l4.46"></a><span id="l4.46">    *</span>
<a href="#l4.47"></a><span id="l4.47">    * @param aWithUI if true, we may prompt for a password, or bring up an auth</span>
<a href="#l4.48"></a><span id="l4.48">    *                page. If false, we won't, and will fail if auth is required.</span>
<a href="#l4.49"></a><span id="l4.49">    * @param aCallback callback when finished.</span>
<a href="#l4.50"></a><span id="l4.50" class="difflineat">@@ -65,17 +65,17 @@ interface nsIMsgCloudFileProvider : nsIS</span>
<a href="#l4.51"></a><span id="l4.51">    * operation is asynchronous.</span>
<a href="#l4.52"></a><span id="l4.52">    *</span>
<a href="#l4.53"></a><span id="l4.53">    * @param aFile File we previously uploaded in this session.</span>
<a href="#l4.54"></a><span id="l4.54">    * @param aCallback callback when finished</span>
<a href="#l4.55"></a><span id="l4.55">    *</span>
<a href="#l4.56"></a><span id="l4.56">    * @throws NS_ERROR_FAILURE if we don't know about the file.</span>
<a href="#l4.57"></a><span id="l4.57">    * @throws nsIMsgCloudFileProvider.offlineErr if we are offline.</span>
<a href="#l4.58"></a><span id="l4.58">    */</span>
<a href="#l4.59"></a><span id="l4.59" class="difflineminus">-  void deleteFile(in nsILocalFile aFile, in nsIRequestObserver aCallback);</span>
<a href="#l4.60"></a><span id="l4.60" class="difflineplus">+  void deleteFile(in nsIFile aFile, in nsIRequestObserver aCallback);</span>
<a href="#l4.61"></a><span id="l4.61"> </span>
<a href="#l4.62"></a><span id="l4.62">   /**</span>
<a href="#l4.63"></a><span id="l4.63">    * If the provider has an API for creating an account, this will start the</span>
<a href="#l4.64"></a><span id="l4.64">    * process of creating one. There will probably have to be some sort of</span>
<a href="#l4.65"></a><span id="l4.65">    * validation on the part of the user before the account is created.</span>
<a href="#l4.66"></a><span id="l4.66">    * If not, this will throw NS_ERROR_NOT_IMPLEMENTED.</span>
<a href="#l4.67"></a><span id="l4.67">    *</span>
<a href="#l4.68"></a><span id="l4.68">    * If the REST call succeeds, aCallback.onStopRequest will get called back</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l5.1"></a><span id="l5.1" class="difflineminus">--- a/mail/components/migration/src/nsEudoraProfileMigrator.h</span>
<a href="#l5.2"></a><span id="l5.2" class="difflineplus">+++ b/mail/components/migration/src/nsEudoraProfileMigrator.h</span>
<a href="#l5.3"></a><span id="l5.3" class="difflineat">@@ -2,17 +2,17 @@</span>
<a href="#l5.4"></a><span id="l5.4"> /* This Source Code Form is subject to the terms of the Mozilla Public</span>
<a href="#l5.5"></a><span id="l5.5">  * License, v. 2.0. If a copy of the MPL was not distributed with this</span>
<a href="#l5.6"></a><span id="l5.6">  * file, You can obtain one at http://mozilla.org/MPL/2.0/. */</span>
<a href="#l5.7"></a><span id="l5.7"> </span>
<a href="#l5.8"></a><span id="l5.8"> #ifndef eudoraprofilemigrator___h___</span>
<a href="#l5.9"></a><span id="l5.9"> #define eudoraprofilemigrator___h___</span>
<a href="#l5.10"></a><span id="l5.10"> </span>
<a href="#l5.11"></a><span id="l5.11"> #include &quot;nsIMailProfileMigrator.h&quot;</span>
<a href="#l5.12"></a><span id="l5.12" class="difflineminus">-#include &quot;nsILocalFile.h&quot;</span>
<a href="#l5.13"></a><span id="l5.13" class="difflineplus">+#include &quot;nsIFile.h&quot;</span>
<a href="#l5.14"></a><span id="l5.14"> #include &quot;nsIObserverService.h&quot;</span>
<a href="#l5.15"></a><span id="l5.15"> #include &quot;nsString.h&quot;</span>
<a href="#l5.16"></a><span id="l5.16"> #include &quot;nsITimer.h&quot;</span>
<a href="#l5.17"></a><span id="l5.17"> #include &quot;nsIImportGeneric.h&quot;</span>
<a href="#l5.18"></a><span id="l5.18"> #include &quot;nsIImportModule.h&quot;</span>
<a href="#l5.19"></a><span id="l5.19"> #include &quot;nsIMsgAccount.h&quot;</span>
<a href="#l5.20"></a><span id="l5.20"> #include &quot;nsProfileMigratorBase.h&quot;</span>
<a href="#l5.21"></a><span id="l5.21"> </span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l6.1"></a><span id="l6.1" class="difflineminus">--- a/mail/components/migration/src/nsMailProfileMigratorUtils.h</span>
<a href="#l6.2"></a><span id="l6.2" class="difflineplus">+++ b/mail/components/migration/src/nsMailProfileMigratorUtils.h</span>
<a href="#l6.3"></a><span id="l6.3" class="difflineat">@@ -36,17 +36,17 @@ void SetProxyPref(const nsACString&amp; aHos</span>
<a href="#l6.4"></a><span id="l6.4">                   const char* aPortPref, nsIPrefBranch* aPrefs);</span>
<a href="#l6.5"></a><span id="l6.5"> </span>
<a href="#l6.6"></a><span id="l6.6"> struct MigrationData { </span>
<a href="#l6.7"></a><span id="l6.7">   PRUnichar* fileName; </span>
<a href="#l6.8"></a><span id="l6.8">   PRUint32 sourceFlag;</span>
<a href="#l6.9"></a><span id="l6.9">   bool replaceOnly;</span>
<a href="#l6.10"></a><span id="l6.10"> };</span>
<a href="#l6.11"></a><span id="l6.11"> </span>
<a href="#l6.12"></a><span id="l6.12" class="difflineminus">-class nsILocalFile;</span>
<a href="#l6.13"></a><span id="l6.13" class="difflineplus">+class nsIFile;</span>
<a href="#l6.14"></a><span id="l6.14"> void GetMigrateDataFromArray(MigrationData* aDataArray, </span>
<a href="#l6.15"></a><span id="l6.15">                              PRInt32 aDataArrayLength,</span>
<a href="#l6.16"></a><span id="l6.16">                              bool aReplace,</span>
<a href="#l6.17"></a><span id="l6.17">                              nsIFile* aSourceProfile, </span>
<a href="#l6.18"></a><span id="l6.18">                              PRUint16* aResult);</span>
<a href="#l6.19"></a><span id="l6.19"> </span>
<a href="#l6.20"></a><span id="l6.20"> </span>
<a href="#l6.21"></a><span id="l6.21"> // get the base directory of the *target* profile</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l7.1"></a><span id="l7.1" class="difflineminus">--- a/mail/components/migration/src/nsNetscapeProfileMigratorBase.cpp</span>
<a href="#l7.2"></a><span id="l7.2" class="difflineplus">+++ b/mail/components/migration/src/nsNetscapeProfileMigratorBase.cpp</span>
<a href="#l7.3"></a><span id="l7.3" class="difflineat">@@ -35,25 +35,22 @@ nsNetscapeProfileMigratorBase::nsNetscap</span>
<a href="#l7.4"></a><span id="l7.4">   mCurrentProgress = LL_ZERO;</span>
<a href="#l7.5"></a><span id="l7.5">   mFileCopyTransactionIndex = 0;</span>
<a href="#l7.6"></a><span id="l7.6"> }</span>
<a href="#l7.7"></a><span id="l7.7"> </span>
<a href="#l7.8"></a><span id="l7.8"> NS_IMPL_ISUPPORTS2(nsNetscapeProfileMigratorBase, nsIMailProfileMigrator,</span>
<a href="#l7.9"></a><span id="l7.9">                    nsITimerCallback)</span>
<a href="#l7.10"></a><span id="l7.10"> </span>
<a href="#l7.11"></a><span id="l7.11"> nsresult</span>
<a href="#l7.12"></a><span id="l7.12" class="difflineminus">-nsNetscapeProfileMigratorBase::GetProfileDataFromProfilesIni(nsILocalFile* aDataDir,</span>
<a href="#l7.13"></a><span id="l7.13" class="difflineplus">+nsNetscapeProfileMigratorBase::GetProfileDataFromProfilesIni(nsIFile* aDataDir,</span>
<a href="#l7.14"></a><span id="l7.14">                                                              nsIMutableArray* aProfileNames,</span>
<a href="#l7.15"></a><span id="l7.15">                                                              nsIMutableArray* aProfileLocations)</span>
<a href="#l7.16"></a><span id="l7.16"> {</span>
<a href="#l7.17"></a><span id="l7.17" class="difflineminus">-  nsCOMPtr&lt;nsIFile&gt; dataDir;</span>
<a href="#l7.18"></a><span id="l7.18" class="difflineminus">-  nsresult rv = aDataDir-&gt;Clone(getter_AddRefs(dataDir));</span>
<a href="#l7.19"></a><span id="l7.19" class="difflineminus">-  NS_ENSURE_SUCCESS(rv, rv);</span>
<a href="#l7.20"></a><span id="l7.20" class="difflineminus">-</span>
<a href="#l7.21"></a><span id="l7.21" class="difflineminus">-  nsCOMPtr&lt;nsILocalFile&gt; profileIni(do_QueryInterface(dataDir, &amp;rv));</span>
<a href="#l7.22"></a><span id="l7.22" class="difflineplus">+  nsCOMPtr&lt;nsIFile&gt; profileIni;</span>
<a href="#l7.23"></a><span id="l7.23" class="difflineplus">+  nsresult rv = aDataDir-&gt;Clone(getter_AddRefs(profileIni));</span>
<a href="#l7.24"></a><span id="l7.24">   NS_ENSURE_SUCCESS(rv, rv);</span>
<a href="#l7.25"></a><span id="l7.25"> </span>
<a href="#l7.26"></a><span id="l7.26">   profileIni-&gt;Append(NS_LITERAL_STRING(&quot;profiles.ini&quot;));</span>
<a href="#l7.27"></a><span id="l7.27"> </span>
<a href="#l7.28"></a><span id="l7.28">   // Does it exist?</span>
<a href="#l7.29"></a><span id="l7.29">   bool profileFileExists = false;</span>
<a href="#l7.30"></a><span id="l7.30">   rv = profileIni-&gt;Exists(&amp;profileFileExists);</span>
<a href="#l7.31"></a><span id="l7.31">   NS_ENSURE_SUCCESS(rv, rv);</span>
<a href="#l7.32"></a><span id="l7.32" class="difflineat">@@ -86,17 +83,17 @@ nsNetscapeProfileMigratorBase::GetProfil</span>
<a href="#l7.33"></a><span id="l7.33">     }</span>
<a href="#l7.34"></a><span id="l7.34"> </span>
<a href="#l7.35"></a><span id="l7.35">     rv = parser.GetString(profileID.get(), &quot;Name&quot;, buffer);</span>
<a href="#l7.36"></a><span id="l7.36">     if (NS_FAILED(rv)) {</span>
<a href="#l7.37"></a><span id="l7.37">       NS_ERROR(&quot;Malformed profiles.ini: Name= not found&quot;);</span>
<a href="#l7.38"></a><span id="l7.38">       continue;</span>
<a href="#l7.39"></a><span id="l7.39">     }</span>
<a href="#l7.40"></a><span id="l7.40"> </span>
<a href="#l7.41"></a><span id="l7.41" class="difflineminus">-    nsCOMPtr&lt;nsILocalFile&gt; rootDir;</span>
<a href="#l7.42"></a><span id="l7.42" class="difflineplus">+    nsCOMPtr&lt;nsIFile&gt; rootDir;</span>
<a href="#l7.43"></a><span id="l7.43">     rv = NS_NewNativeLocalFile(EmptyCString(), true, getter_AddRefs(rootDir));</span>
<a href="#l7.44"></a><span id="l7.44">     NS_ENSURE_SUCCESS(rv, rv);</span>
<a href="#l7.45"></a><span id="l7.45"> </span>
<a href="#l7.46"></a><span id="l7.46">     rv = isRelative ? rootDir-&gt;SetRelativeDescriptor(aDataDir, filePath) :</span>
<a href="#l7.47"></a><span id="l7.47">                       rootDir-&gt;SetPersistentDescriptor(filePath);</span>
<a href="#l7.48"></a><span id="l7.48">     if (NS_FAILED(rv))</span>
<a href="#l7.49"></a><span id="l7.49">       continue;</span>
<a href="#l7.50"></a><span id="l7.50"> </span>
<a href="#l7.51"></a><span id="l7.51" class="difflineat">@@ -301,21 +298,20 @@ nsresult nsNetscapeProfileMigratorBase::</span>
<a href="#l7.52"></a><span id="l7.52">     rv = dirIterator-&gt;GetNext((nsISupports**)getter_AddRefs(dirEntry));</span>
<a href="#l7.53"></a><span id="l7.53">     if (NS_SUCCEEDED(rv))</span>
<a href="#l7.54"></a><span id="l7.54">     {</span>
<a href="#l7.55"></a><span id="l7.55">       rv = dirEntry-&gt;IsDirectory(&amp;isDir);</span>
<a href="#l7.56"></a><span id="l7.56">       if (NS_SUCCEEDED(rv))</span>
<a href="#l7.57"></a><span id="l7.57">       {</span>
<a href="#l7.58"></a><span id="l7.58">         if (isDir)</span>
<a href="#l7.59"></a><span id="l7.59">         {</span>
<a href="#l7.60"></a><span id="l7.60" class="difflineminus">-          nsCOMPtr&lt;nsIFile&gt; destClone;</span>
<a href="#l7.61"></a><span id="l7.61" class="difflineminus">-          rv = destDir-&gt;Clone(getter_AddRefs(destClone));</span>
<a href="#l7.62"></a><span id="l7.62" class="difflineplus">+          nsCOMPtr&lt;nsIFile&gt; newChild;</span>
<a href="#l7.63"></a><span id="l7.63" class="difflineplus">+          rv = destDir-&gt;Clone(getter_AddRefs(newChild));</span>
<a href="#l7.64"></a><span id="l7.64">           if (NS_SUCCEEDED(rv))</span>
<a href="#l7.65"></a><span id="l7.65">           {</span>
<a href="#l7.66"></a><span id="l7.66" class="difflineminus">-            nsCOMPtr&lt;nsILocalFile&gt; newChild(do_QueryInterface(destClone));</span>
<a href="#l7.67"></a><span id="l7.67">             nsAutoString leafName;</span>
<a href="#l7.68"></a><span id="l7.68">             dirEntry-&gt;GetLeafName(leafName);</span>
<a href="#l7.69"></a><span id="l7.69">             newChild-&gt;AppendRelativePath(leafName);</span>
<a href="#l7.70"></a><span id="l7.70">             rv = newChild-&gt;Exists(&amp;exists);</span>
<a href="#l7.71"></a><span id="l7.71">             if (NS_SUCCEEDED(rv) &amp;&amp; !exists)</span>
<a href="#l7.72"></a><span id="l7.72">               rv = newChild-&gt;Create(nsIFile::DIRECTORY_TYPE, 0775);</span>
<a href="#l7.73"></a><span id="l7.73">             rv = RecursiveCopy(dirEntry, newChild);</span>
<a href="#l7.74"></a><span id="l7.74">           }</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l8.1"></a><span id="l8.1" class="difflineminus">--- a/mail/components/migration/src/nsNetscapeProfileMigratorBase.h</span>
<a href="#l8.2"></a><span id="l8.2" class="difflineplus">+++ b/mail/components/migration/src/nsNetscapeProfileMigratorBase.h</span>
<a href="#l8.3"></a><span id="l8.3" class="difflineat">@@ -1,17 +1,17 @@</span>
<a href="#l8.4"></a><span id="l8.4"> /* -*- Mode: C++; tab-width: 2; indent-tabs-mode: nil; c-basic-offset: 2 -*- */</span>
<a href="#l8.5"></a><span id="l8.5"> /* This Source Code Form is subject to the terms of the Mozilla Public</span>
<a href="#l8.6"></a><span id="l8.6">  * License, v. 2.0. If a copy of the MPL was not distributed with this</span>
<a href="#l8.7"></a><span id="l8.7">  * file, You can obtain one at http://mozilla.org/MPL/2.0/. */</span>
<a href="#l8.8"></a><span id="l8.8"> </span>
<a href="#l8.9"></a><span id="l8.9"> #ifndef netscapeprofilemigratorbase___h___</span>
<a href="#l8.10"></a><span id="l8.10"> #define netscapeprofilemigratorbase___h___</span>
<a href="#l8.11"></a><span id="l8.11"> </span>
<a href="#l8.12"></a><span id="l8.12" class="difflineminus">-#include &quot;nsILocalFile.h&quot;</span>
<a href="#l8.13"></a><span id="l8.13" class="difflineplus">+#include &quot;nsIFile.h&quot;</span>
<a href="#l8.14"></a><span id="l8.14"> #include &quot;nsIStringBundle.h&quot;</span>
<a href="#l8.15"></a><span id="l8.15"> #include &quot;nsStringGlue.h&quot;</span>
<a href="#l8.16"></a><span id="l8.16"> #include &quot;nsTArray.h&quot;</span>
<a href="#l8.17"></a><span id="l8.17"> #include &quot;nsIObserverService.h&quot;</span>
<a href="#l8.18"></a><span id="l8.18"> #include &quot;nsITimer.h&quot;</span>
<a href="#l8.19"></a><span id="l8.19"> #include &quot;nsIMailProfileMigrator.h&quot;</span>
<a href="#l8.20"></a><span id="l8.20"> </span>
<a href="#l8.21"></a><span id="l8.21"> class nsIPrefBranch;</span>
<a href="#l8.22"></a><span id="l8.22" class="difflineat">@@ -81,26 +81,26 @@ public:</span>
<a href="#l8.23"></a><span id="l8.23">   static nsresult SetInt(PrefTransform* aTransform, nsIPrefBranch* aBranch);</span>
<a href="#l8.24"></a><span id="l8.24"> </span>
<a href="#l8.25"></a><span id="l8.25">   nsresult RecursiveCopy(nsIFile* srcDir, nsIFile* destDir); // helper routine</span>
<a href="#l8.26"></a><span id="l8.26"> </span>
<a href="#l8.27"></a><span id="l8.27"> protected:</span>
<a href="#l8.28"></a><span id="l8.28">   void CopyNextFolder();</span>
<a href="#l8.29"></a><span id="l8.29">   void EndCopyFolders();</span>
<a href="#l8.30"></a><span id="l8.30"> </span>
<a href="#l8.31"></a><span id="l8.31" class="difflineminus">-  nsresult GetProfileDataFromProfilesIni(nsILocalFile* aDataDir,</span>
<a href="#l8.32"></a><span id="l8.32" class="difflineplus">+  nsresult GetProfileDataFromProfilesIni(nsIFile* aDataDir,</span>
<a href="#l8.33"></a><span id="l8.33">                                          nsIMutableArray* aProfileNames,</span>
<a href="#l8.34"></a><span id="l8.34">                                          nsIMutableArray* aProfileLocations);</span>
<a href="#l8.35"></a><span id="l8.35"> </span>
<a href="#l8.36"></a><span id="l8.36">   nsresult CopyFile(const nsAString&amp; aSourceFileName, const nsAString&amp; aTargetFileName);</span>
<a href="#l8.37"></a><span id="l8.37"> </span>
<a href="#l8.38"></a><span id="l8.38">   nsresult GetSignonFileName(bool aReplace, char** aFileName);</span>
<a href="#l8.39"></a><span id="l8.39">   nsresult LocateSignonsFile(char** aResult);</span>
<a href="#l8.40"></a><span id="l8.40"> </span>
<a href="#l8.41"></a><span id="l8.41" class="difflineminus">-  nsCOMPtr&lt;nsILocalFile&gt; mSourceProfile;</span>
<a href="#l8.42"></a><span id="l8.42" class="difflineplus">+  nsCOMPtr&lt;nsIFile&gt; mSourceProfile;</span>
<a href="#l8.43"></a><span id="l8.43">   nsCOMPtr&lt;nsIFile&gt; mTargetProfile;</span>
<a href="#l8.44"></a><span id="l8.44"> </span>
<a href="#l8.45"></a><span id="l8.45">   // List of src/destination files we still have to copy into the new profile</span>
<a href="#l8.46"></a><span id="l8.46">   // directory.</span>
<a href="#l8.47"></a><span id="l8.47">   nsTArray&lt;fileTransactionEntry&gt; mFileCopyTransactions;</span>
<a href="#l8.48"></a><span id="l8.48">   PRUint32 mFileCopyTransactionIndex;</span>
<a href="#l8.49"></a><span id="l8.49"> </span>
<a href="#l8.50"></a><span id="l8.50">   PRInt64 mMaxProgress;</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l9.1"></a><span id="l9.1" class="difflineminus">--- a/mail/components/migration/src/nsProfileMigrator.cpp</span>
<a href="#l9.2"></a><span id="l9.2" class="difflineplus">+++ b/mail/components/migration/src/nsProfileMigrator.cpp</span>
<a href="#l9.3"></a><span id="l9.3" class="difflineat">@@ -1,14 +1,14 @@</span>
<a href="#l9.4"></a><span id="l9.4"> /* -*- Mode: C++; tab-width: 2; indent-tabs-mode: nil; c-basic-offset: 2 -*- */</span>
<a href="#l9.5"></a><span id="l9.5"> /* This Source Code Form is subject to the terms of the Mozilla Public</span>
<a href="#l9.6"></a><span id="l9.6">  * License, v. 2.0. If a copy of the MPL was not distributed with this</span>
<a href="#l9.7"></a><span id="l9.7">  * file, You can obtain one at http://mozilla.org/MPL/2.0/. */</span>
<a href="#l9.8"></a><span id="l9.8"> </span>
<a href="#l9.9"></a><span id="l9.9" class="difflineminus">-#include &quot;nsILocalFile.h&quot;</span>
<a href="#l9.10"></a><span id="l9.10" class="difflineplus">+#include &quot;nsIFile.h&quot;</span>
<a href="#l9.11"></a><span id="l9.11"> #include &quot;nsIDOMWindow.h&quot;</span>
<a href="#l9.12"></a><span id="l9.12"> #include &quot;nsIProfileMigrator.h&quot;</span>
<a href="#l9.13"></a><span id="l9.13"> #include &quot;nsIPrefService.h&quot;</span>
<a href="#l9.14"></a><span id="l9.14"> #include &quot;nsIServiceManager.h&quot;</span>
<a href="#l9.15"></a><span id="l9.15"> #include &quot;nsIToolkitProfile.h&quot;</span>
<a href="#l9.16"></a><span id="l9.16"> #include &quot;nsIToolkitProfileService.h&quot;</span>
<a href="#l9.17"></a><span id="l9.17"> #include &quot;nsIWindowWatcher.h&quot;</span>
<a href="#l9.18"></a><span id="l9.18"> #include &quot;nsISupportsPrimitives.h&quot;</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l10.1"></a><span id="l10.1" class="difflineminus">--- a/mail/components/migration/src/nsProfileMigrator.h</span>
<a href="#l10.2"></a><span id="l10.2" class="difflineplus">+++ b/mail/components/migration/src/nsProfileMigrator.h</span>
<a href="#l10.3"></a><span id="l10.3" class="difflineat">@@ -1,14 +1,14 @@</span>
<a href="#l10.4"></a><span id="l10.4"> /* -*- Mode: C++; tab-width: 2; indent-tabs-mode: nil; c-basic-offset: 2 -*- */</span>
<a href="#l10.5"></a><span id="l10.5"> /* This Source Code Form is subject to the terms of the Mozilla Public</span>
<a href="#l10.6"></a><span id="l10.6">  * License, v. 2.0. If a copy of the MPL was not distributed with this</span>
<a href="#l10.7"></a><span id="l10.7">  * file, You can obtain one at http://mozilla.org/MPL/2.0/. */</span>
<a href="#l10.8"></a><span id="l10.8"> </span>
<a href="#l10.9"></a><span id="l10.9" class="difflineminus">-#include &quot;nsILocalFile.h&quot;</span>
<a href="#l10.10"></a><span id="l10.10" class="difflineplus">+#include &quot;nsIFile.h&quot;</span>
<a href="#l10.11"></a><span id="l10.11"> #include &quot;nsIProfileMigrator.h&quot;</span>
<a href="#l10.12"></a><span id="l10.12"> #include &quot;nsIMailProfileMigrator.h&quot;</span>
<a href="#l10.13"></a><span id="l10.13"> #include &quot;nsIServiceManager.h&quot;</span>
<a href="#l10.14"></a><span id="l10.14"> #include &quot;nsIToolkitProfile.h&quot;</span>
<a href="#l10.15"></a><span id="l10.15"> #include &quot;nsIToolkitProfileService.h&quot;</span>
<a href="#l10.16"></a><span id="l10.16"> #include &quot;nsCOMPtr.h&quot;</span>
<a href="#l10.17"></a><span id="l10.17"> #include &quot;nsDirectoryServiceDefs.h&quot;</span>
<a href="#l10.18"></a><span id="l10.18"> </span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l11.1"></a><span id="l11.1" class="difflineminus">--- a/mail/components/migration/src/nsProfileMigratorBase.h</span>
<a href="#l11.2"></a><span id="l11.2" class="difflineplus">+++ b/mail/components/migration/src/nsProfileMigratorBase.h</span>
<a href="#l11.3"></a><span id="l11.3" class="difflineat">@@ -1,17 +1,17 @@</span>
<a href="#l11.4"></a><span id="l11.4"> /* -*- Mode: C++; tab-width: 2; indent-tabs-mode: nil; c-basic-offset: 2 -*- */</span>
<a href="#l11.5"></a><span id="l11.5"> /* This Source Code Form is subject to the terms of the Mozilla Public</span>
<a href="#l11.6"></a><span id="l11.6">  * License, v. 2.0. If a copy of the MPL was not distributed with this</span>
<a href="#l11.7"></a><span id="l11.7">  * file, You can obtain one at http://mozilla.org/MPL/2.0/. */</span>
<a href="#l11.8"></a><span id="l11.8"> </span>
<a href="#l11.9"></a><span id="l11.9"> #ifndef profilemigratorbase___h___</span>
<a href="#l11.10"></a><span id="l11.10"> #define profilemigratorbase___h___</span>
<a href="#l11.11"></a><span id="l11.11"> </span>
<a href="#l11.12"></a><span id="l11.12" class="difflineminus">-#include &quot;nsILocalFile.h&quot;</span>
<a href="#l11.13"></a><span id="l11.13" class="difflineplus">+#include &quot;nsIFile.h&quot;</span>
<a href="#l11.14"></a><span id="l11.14"> #include &quot;nsIObserverService.h&quot;</span>
<a href="#l11.15"></a><span id="l11.15"> #include &quot;nsString.h&quot;</span>
<a href="#l11.16"></a><span id="l11.16"> #include &quot;nsITimer.h&quot;</span>
<a href="#l11.17"></a><span id="l11.17"> #include &quot;nsIImportGeneric.h&quot;</span>
<a href="#l11.18"></a><span id="l11.18"> #include &quot;nsIImportModule.h&quot;</span>
<a href="#l11.19"></a><span id="l11.19"> #include &quot;nsIMsgAccount.h&quot;</span>
<a href="#l11.20"></a><span id="l11.20"> </span>
<a href="#l11.21"></a><span id="l11.21"> class nsProfileMigratorBase</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l12.1"></a><span id="l12.1" class="difflineminus">--- a/mail/components/migration/src/nsSeamonkeyProfileMigrator.cpp</span>
<a href="#l12.2"></a><span id="l12.2" class="difflineplus">+++ b/mail/components/migration/src/nsSeamonkeyProfileMigrator.cpp</span>
<a href="#l12.3"></a><span id="l12.3" class="difflineat">@@ -203,46 +203,46 @@ nsSeamonkeyProfileMigrator::GetSourcePro</span>
<a href="#l12.4"></a><span id="l12.4"> }</span>
<a href="#l12.5"></a><span id="l12.5"> </span>
<a href="#l12.6"></a><span id="l12.6"> nsresult</span>
<a href="#l12.7"></a><span id="l12.7"> nsSeamonkeyProfileMigrator::FillProfileDataFromSeamonkeyRegistry()</span>
<a href="#l12.8"></a><span id="l12.8"> {</span>
<a href="#l12.9"></a><span id="l12.9">   // Find the Seamonkey Registry</span>
<a href="#l12.10"></a><span id="l12.10">   nsCOMPtr&lt;nsIProperties&gt; fileLocator(</span>
<a href="#l12.11"></a><span id="l12.11">     do_GetService(&quot;@mozilla.org/file/directory_service;1&quot;));</span>
<a href="#l12.12"></a><span id="l12.12" class="difflineminus">-  nsCOMPtr&lt;nsILocalFile&gt; seamonkeyData;</span>
<a href="#l12.13"></a><span id="l12.13" class="difflineplus">+  nsCOMPtr&lt;nsIFile&gt; seamonkeyData;</span>
<a href="#l12.14"></a><span id="l12.14"> #undef EXTRA_PREPEND</span>
<a href="#l12.15"></a><span id="l12.15"> </span>
<a href="#l12.16"></a><span id="l12.16"> #ifdef XP_WIN</span>
<a href="#l12.17"></a><span id="l12.17"> #define NEW_FOLDER &quot;SeaMonkey&quot;</span>
<a href="#l12.18"></a><span id="l12.18"> #define EXTRA_PREPEND &quot;Mozilla&quot;</span>
<a href="#l12.19"></a><span id="l12.19"> </span>
<a href="#l12.20"></a><span id="l12.20" class="difflineminus">-  fileLocator-&gt;Get(NS_WIN_APPDATA_DIR, NS_GET_IID(nsILocalFile),</span>
<a href="#l12.21"></a><span id="l12.21" class="difflineplus">+  fileLocator-&gt;Get(NS_WIN_APPDATA_DIR, NS_GET_IID(nsIFile),</span>
<a href="#l12.22"></a><span id="l12.22">                    getter_AddRefs(seamonkeyData));</span>
<a href="#l12.23"></a><span id="l12.23">   NS_ENSURE_TRUE(seamonkeyData, NS_ERROR_FAILURE);</span>
<a href="#l12.24"></a><span id="l12.24"> </span>
<a href="#l12.25"></a><span id="l12.25"> #elif defined(XP_MACOSX)</span>
<a href="#l12.26"></a><span id="l12.26"> #define NEW_FOLDER &quot;SeaMonkey&quot;</span>
<a href="#l12.27"></a><span id="l12.27"> #define EXTRA_PREPEND &quot;Application Support&quot;</span>
<a href="#l12.28"></a><span id="l12.28" class="difflineminus">-  fileLocator-&gt;Get(NS_MAC_USER_LIB_DIR, NS_GET_IID(nsILocalFile),</span>
<a href="#l12.29"></a><span id="l12.29" class="difflineplus">+  fileLocator-&gt;Get(NS_MAC_USER_LIB_DIR, NS_GET_IID(nsIFile),</span>
<a href="#l12.30"></a><span id="l12.30">                    getter_AddRefs(seamonkeyData));</span>
<a href="#l12.31"></a><span id="l12.31">   NS_ENSURE_TRUE(seamonkeyData, NS_ERROR_FAILURE);</span>
<a href="#l12.32"></a><span id="l12.32"> </span>
<a href="#l12.33"></a><span id="l12.33"> #elif defined(XP_UNIX)</span>
<a href="#l12.34"></a><span id="l12.34"> #define NEW_FOLDER &quot;seamonkey&quot;</span>
<a href="#l12.35"></a><span id="l12.35"> #define EXTRA_PREPEND &quot;.mozilla&quot;</span>
<a href="#l12.36"></a><span id="l12.36" class="difflineminus">-  fileLocator-&gt;Get(NS_UNIX_HOME_DIR, NS_GET_IID(nsILocalFile),</span>
<a href="#l12.37"></a><span id="l12.37" class="difflineplus">+  fileLocator-&gt;Get(NS_UNIX_HOME_DIR, NS_GET_IID(nsIFile),</span>
<a href="#l12.38"></a><span id="l12.38">                    getter_AddRefs(seamonkeyData));</span>
<a href="#l12.39"></a><span id="l12.39">   NS_ENSURE_TRUE(seamonkeyData, NS_ERROR_FAILURE);</span>
<a href="#l12.40"></a><span id="l12.40"> </span>
<a href="#l12.41"></a><span id="l12.41"> #elif defined(XP_OS2)</span>
<a href="#l12.42"></a><span id="l12.42"> #define NEW_FOLDER &quot;SeaMonkey&quot;</span>
<a href="#l12.43"></a><span id="l12.43"> #define EXTRA_PREPEND &quot;Mozilla&quot;</span>
<a href="#l12.44"></a><span id="l12.44"> </span>
<a href="#l12.45"></a><span id="l12.45" class="difflineminus">-  fileLocator-&gt;Get(NS_OS2_HOME_DIR, NS_GET_IID(nsILocalFile),</span>
<a href="#l12.46"></a><span id="l12.46" class="difflineplus">+  fileLocator-&gt;Get(NS_OS2_HOME_DIR, NS_GET_IID(nsIFile),</span>
<a href="#l12.47"></a><span id="l12.47">                    getter_AddRefs(seamonkeyData));</span>
<a href="#l12.48"></a><span id="l12.48">   NS_ENSURE_TRUE(seamonkeyData, NS_ERROR_FAILURE);</span>
<a href="#l12.49"></a><span id="l12.49"> </span>
<a href="#l12.50"></a><span id="l12.50"> #else</span>
<a href="#l12.51"></a><span id="l12.51">   // On other OS just abort.</span>
<a href="#l12.52"></a><span id="l12.52">   return NS_ERROR_FAILURE;</span>
<a href="#l12.53"></a><span id="l12.53"> #endif</span>
<a href="#l12.54"></a><span id="l12.54"> </span>
<a href="#l12.55"></a><span id="l12.55" class="difflineat">@@ -250,20 +250,17 @@ nsSeamonkeyProfileMigrator::FillProfileD</span>
<a href="#l12.56"></a><span id="l12.56">   seamonkeyData-&gt;Clone(getter_AddRefs(newSeamonkeyData));</span>
<a href="#l12.57"></a><span id="l12.57">   NS_ENSURE_TRUE(newSeamonkeyData, NS_ERROR_FAILURE);</span>
<a href="#l12.58"></a><span id="l12.58"> </span>
<a href="#l12.59"></a><span id="l12.59"> #ifdef EXTRA_PREPEND</span>
<a href="#l12.60"></a><span id="l12.60">   newSeamonkeyData-&gt;Append(NS_LITERAL_STRING(EXTRA_PREPEND));</span>
<a href="#l12.61"></a><span id="l12.61"> #endif</span>
<a href="#l12.62"></a><span id="l12.62">   newSeamonkeyData-&gt;Append(NS_LITERAL_STRING(NEW_FOLDER));</span>
<a href="#l12.63"></a><span id="l12.63"> </span>
<a href="#l12.64"></a><span id="l12.64" class="difflineminus">-  nsCOMPtr&lt;nsILocalFile&gt; newSmDataLocal(do_QueryInterface(newSeamonkeyData));</span>
<a href="#l12.65"></a><span id="l12.65" class="difflineminus">-  NS_ENSURE_TRUE(newSmDataLocal, NS_ERROR_FAILURE);</span>
<a href="#l12.66"></a><span id="l12.66" class="difflineminus">-</span>
<a href="#l12.67"></a><span id="l12.67" class="difflineminus">-  nsresult rv = GetProfileDataFromProfilesIni(newSmDataLocal,</span>
<a href="#l12.68"></a><span id="l12.68" class="difflineplus">+  nsresult rv = GetProfileDataFromProfilesIni(newSeamonkeyData,</span>
<a href="#l12.69"></a><span id="l12.69">                                               mProfileNames,</span>
<a href="#l12.70"></a><span id="l12.70">                                               mProfileLocations);</span>
<a href="#l12.71"></a><span id="l12.71"> </span>
<a href="#l12.72"></a><span id="l12.72">   return rv;</span>
<a href="#l12.73"></a><span id="l12.73"> }</span>
<a href="#l12.74"></a><span id="l12.74"> </span>
<a href="#l12.75"></a><span id="l12.75"> static</span>
<a href="#l12.76"></a><span id="l12.76"> nsSeamonkeyProfileMigrator::PrefTransform gTransforms[] = {</span>
<a href="#l12.77"></a><span id="l12.77" class="difflineat">@@ -430,18 +427,18 @@ nsSeamonkeyProfileMigrator::CopySignatur</span>
<a href="#l12.78"></a><span id="l12.78">     // a partial fix for bug #255043</span>
<a href="#l12.79"></a><span id="l12.79">     // if the user's signature file from seamonkey lives in the</span>
<a href="#l12.80"></a><span id="l12.80">     // seamonkey profile root, we'll copy it over to the new</span>
<a href="#l12.81"></a><span id="l12.81">     // thunderbird profile root and thenn set the pref to the new value</span>
<a href="#l12.82"></a><span id="l12.82">     // note, this doesn't work for multiple signatures that live</span>
<a href="#l12.83"></a><span id="l12.83">     // below the seamonkey profile root</span>
<a href="#l12.84"></a><span id="l12.84">     if (StringEndsWith(prefName, nsDependentCString(&quot;.sig_file&quot;)))</span>
<a href="#l12.85"></a><span id="l12.85">     {</span>
<a href="#l12.86"></a><span id="l12.86" class="difflineminus">-      // turn the pref into a nsILocalFile</span>
<a href="#l12.87"></a><span id="l12.87" class="difflineminus">-      nsCOMPtr&lt;nsILocalFile&gt; srcSigFile =</span>
<a href="#l12.88"></a><span id="l12.88" class="difflineplus">+      // turn the pref into a nsIFile</span>
<a href="#l12.89"></a><span id="l12.89" class="difflineplus">+      nsCOMPtr&lt;nsIFile&gt; srcSigFile =</span>
<a href="#l12.90"></a><span id="l12.90">         do_CreateInstance(NS_LOCAL_FILE_CONTRACTID);</span>
<a href="#l12.91"></a><span id="l12.91">       srcSigFile-&gt;SetPersistentDescriptor(nsDependentCString(pref-&gt;stringValue));</span>
<a href="#l12.92"></a><span id="l12.92"> </span>
<a href="#l12.93"></a><span id="l12.93">       nsCOMPtr&lt;nsIFile&gt; targetSigFile;</span>
<a href="#l12.94"></a><span id="l12.94">       rv = mTargetProfile-&gt;Clone(getter_AddRefs(targetSigFile));</span>
<a href="#l12.95"></a><span id="l12.95">       NS_ENSURE_SUCCESS(rv, rv);</span>
<a href="#l12.96"></a><span id="l12.96"> </span>
<a href="#l12.97"></a><span id="l12.97">       // now make the copy</span>
<a href="#l12.98"></a><span id="l12.98" class="difflineat">@@ -451,18 +448,17 @@ nsSeamonkeyProfileMigrator::CopySignatur</span>
<a href="#l12.99"></a><span id="l12.99">       {</span>
<a href="#l12.100"></a><span id="l12.100">         nsAutoString leafName;</span>
<a href="#l12.101"></a><span id="l12.101">         srcSigFile-&gt;GetLeafName(leafName);</span>
<a href="#l12.102"></a><span id="l12.102">         srcSigFile-&gt;CopyTo(targetSigFile,leafName); // will fail if we've already copied a sig file here</span>
<a href="#l12.103"></a><span id="l12.103">         targetSigFile-&gt;Append(leafName);</span>
<a href="#l12.104"></a><span id="l12.104"> </span>
<a href="#l12.105"></a><span id="l12.105">         // now write out the new descriptor</span>
<a href="#l12.106"></a><span id="l12.106">         nsCAutoString descriptorString;</span>
<a href="#l12.107"></a><span id="l12.107" class="difflineminus">-        nsCOMPtr&lt;nsILocalFile&gt; localFile = do_QueryInterface(targetSigFile);</span>
<a href="#l12.108"></a><span id="l12.108" class="difflineminus">-        localFile-&gt;GetPersistentDescriptor(descriptorString);</span>
<a href="#l12.109"></a><span id="l12.109" class="difflineplus">+        targetSigFile-&gt;GetPersistentDescriptor(descriptorString);</span>
<a href="#l12.110"></a><span id="l12.110">         NS_Free(pref-&gt;stringValue);</span>
<a href="#l12.111"></a><span id="l12.111">         pref-&gt;stringValue = ToNewCString(descriptorString);</span>
<a href="#l12.112"></a><span id="l12.112">       }</span>
<a href="#l12.113"></a><span id="l12.113">     }</span>
<a href="#l12.114"></a><span id="l12.114">   }</span>
<a href="#l12.115"></a><span id="l12.115">   return NS_OK;</span>
<a href="#l12.116"></a><span id="l12.116"> }</span>
<a href="#l12.117"></a><span id="l12.117"> </span>
<a href="#l12.118"></a><span id="l12.118" class="difflineat">@@ -507,18 +503,18 @@ nsSeamonkeyProfileMigrator::CopyMailFold</span>
<a href="#l12.119"></a><span id="l12.119">       aPrefService-&gt;GetBranch(prefName.get(), getter_AddRefs(serverBranch));</span>
<a href="#l12.120"></a><span id="l12.120"> </span>
<a href="#l12.121"></a><span id="l12.121">       if (!serverBranch)</span>
<a href="#l12.122"></a><span id="l12.122">         break; // should we clear out this server pref from aMailServers?</span>
<a href="#l12.123"></a><span id="l12.123"> </span>
<a href="#l12.124"></a><span id="l12.124">       nsCString serverType;</span>
<a href="#l12.125"></a><span id="l12.125">       serverBranch-&gt;GetCharPref(&quot;type&quot;, getter_Copies(serverType));</span>
<a href="#l12.126"></a><span id="l12.126"> </span>
<a href="#l12.127"></a><span id="l12.127" class="difflineminus">-      nsCOMPtr&lt;nsILocalFile&gt; sourceMailFolder;</span>
<a href="#l12.128"></a><span id="l12.128" class="difflineminus">-      serverBranch-&gt;GetComplexValue(&quot;directory&quot;, NS_GET_IID(nsILocalFile), getter_AddRefs(sourceMailFolder));</span>
<a href="#l12.129"></a><span id="l12.129" class="difflineplus">+      nsCOMPtr&lt;nsIFile&gt; sourceMailFolder;</span>
<a href="#l12.130"></a><span id="l12.130" class="difflineplus">+      serverBranch-&gt;GetComplexValue(&quot;directory&quot;, NS_GET_IID(nsIFile), getter_AddRefs(sourceMailFolder));</span>
<a href="#l12.131"></a><span id="l12.131"> </span>
<a href="#l12.132"></a><span id="l12.132">       // now based on type, we need to build a new destination path for the mail folders for this server</span>
<a href="#l12.133"></a><span id="l12.133">       nsCOMPtr&lt;nsIFile&gt; targetMailFolder;</span>
<a href="#l12.134"></a><span id="l12.134">       if (serverType.Equals(&quot;imap&quot;))</span>
<a href="#l12.135"></a><span id="l12.135">       {</span>
<a href="#l12.136"></a><span id="l12.136">         mTargetProfile-&gt;Clone(getter_AddRefs(targetMailFolder));</span>
<a href="#l12.137"></a><span id="l12.137">         targetMailFolder-&gt;Append(IMAP_MAIL_DIR_50_NAME);</span>
<a href="#l12.138"></a><span id="l12.138">       }</span>
<a href="#l12.139"></a><span id="l12.139" class="difflineat">@@ -546,49 +542,47 @@ nsSeamonkeyProfileMigrator::CopyMailFold</span>
<a href="#l12.140"></a><span id="l12.140">         // has multiple servers with the same host name.</span>
<a href="#l12.141"></a><span id="l12.141">         targetMailFolder-&gt;CreateUnique(nsIFile::DIRECTORY_TYPE, 0777);</span>
<a href="#l12.142"></a><span id="l12.142"> </span>
<a href="#l12.143"></a><span id="l12.143">         rv = RecursiveCopy(sourceMailFolder, targetMailFolder);</span>
<a href="#l12.144"></a><span id="l12.144">         // now we want to make sure the actual directory pref that gets</span>
<a href="#l12.145"></a><span id="l12.145">         // transformed into the new profile's pref.js has the right file</span>
<a href="#l12.146"></a><span id="l12.146">         // location.</span>
<a href="#l12.147"></a><span id="l12.147">         nsCAutoString descriptorString;</span>
<a href="#l12.148"></a><span id="l12.148" class="difflineminus">-        nsCOMPtr&lt;nsILocalFile&gt; localFile = do_QueryInterface(targetMailFolder);</span>
<a href="#l12.149"></a><span id="l12.149" class="difflineminus">-        localFile-&gt;GetPersistentDescriptor(descriptorString);</span>
<a href="#l12.150"></a><span id="l12.150" class="difflineplus">+        targetMailFolder-&gt;GetPersistentDescriptor(descriptorString);</span>
<a href="#l12.151"></a><span id="l12.151">         NS_Free(pref-&gt;stringValue);</span>
<a href="#l12.152"></a><span id="l12.152">         pref-&gt;stringValue = ToNewCString(descriptorString);</span>
<a href="#l12.153"></a><span id="l12.153">       }</span>
<a href="#l12.154"></a><span id="l12.154">     }</span>
<a href="#l12.155"></a><span id="l12.155">     else if (StringEndsWith(prefName, nsDependentCString(&quot;.newsrc.file&quot;)))</span>
<a href="#l12.156"></a><span id="l12.156">     {</span>
<a href="#l12.157"></a><span id="l12.157">       // copy the news RC file into \News. this won't work if the user has different newsrc files for each account</span>
<a href="#l12.158"></a><span id="l12.158">       // I don't know what to do in that situation.</span>
<a href="#l12.159"></a><span id="l12.159"> </span>
<a href="#l12.160"></a><span id="l12.160">       nsCOMPtr&lt;nsIFile&gt; targetNewsRCFile;</span>
<a href="#l12.161"></a><span id="l12.161">       mTargetProfile-&gt;Clone(getter_AddRefs(targetNewsRCFile));</span>
<a href="#l12.162"></a><span id="l12.162">       targetNewsRCFile-&gt;Append(NEWS_DIR_50_NAME);</span>
<a href="#l12.163"></a><span id="l12.163"> </span>
<a href="#l12.164"></a><span id="l12.164" class="difflineminus">-      // turn the pref into a nsILocalFile</span>
<a href="#l12.165"></a><span id="l12.165" class="difflineminus">-      nsCOMPtr&lt;nsILocalFile&gt; srcNewsRCFile = do_CreateInstance(NS_LOCAL_FILE_CONTRACTID);</span>
<a href="#l12.166"></a><span id="l12.166" class="difflineplus">+      // turn the pref into a nsIFile</span>
<a href="#l12.167"></a><span id="l12.167" class="difflineplus">+      nsCOMPtr&lt;nsIFile&gt; srcNewsRCFile = do_CreateInstance(NS_LOCAL_FILE_CONTRACTID);</span>
<a href="#l12.168"></a><span id="l12.168">       srcNewsRCFile-&gt;SetPersistentDescriptor(nsDependentCString(pref-&gt;stringValue));</span>
<a href="#l12.169"></a><span id="l12.169"> </span>
<a href="#l12.170"></a><span id="l12.170">       // now make the copy</span>
<a href="#l12.171"></a><span id="l12.171">       bool exists;</span>
<a href="#l12.172"></a><span id="l12.172">       srcNewsRCFile-&gt;Exists(&amp;exists);</span>
<a href="#l12.173"></a><span id="l12.173">       if (exists)</span>
<a href="#l12.174"></a><span id="l12.174">       {</span>
<a href="#l12.175"></a><span id="l12.175">         nsAutoString leafName;</span>
<a href="#l12.176"></a><span id="l12.176">         srcNewsRCFile-&gt;GetLeafName(leafName);</span>
<a href="#l12.177"></a><span id="l12.177">         srcNewsRCFile-&gt;CopyTo(targetNewsRCFile,leafName); // will fail if we've already copied a newsrc file here</span>
<a href="#l12.178"></a><span id="l12.178">         targetNewsRCFile-&gt;Append(leafName);</span>
<a href="#l12.179"></a><span id="l12.179"> </span>
<a href="#l12.180"></a><span id="l12.180">         // now write out the new descriptor</span>
<a href="#l12.181"></a><span id="l12.181">         nsCAutoString descriptorString;</span>
<a href="#l12.182"></a><span id="l12.182" class="difflineminus">-        nsCOMPtr&lt;nsILocalFile&gt; localFile = do_QueryInterface(targetNewsRCFile);</span>
<a href="#l12.183"></a><span id="l12.183" class="difflineminus">-        localFile-&gt;GetPersistentDescriptor(descriptorString);</span>
<a href="#l12.184"></a><span id="l12.184" class="difflineplus">+        targetNewsRCFile-&gt;GetPersistentDescriptor(descriptorString);</span>
<a href="#l12.185"></a><span id="l12.185">         NS_Free(pref-&gt;stringValue);</span>
<a href="#l12.186"></a><span id="l12.186">         pref-&gt;stringValue = ToNewCString(descriptorString);</span>
<a href="#l12.187"></a><span id="l12.187">       }</span>
<a href="#l12.188"></a><span id="l12.188">     }</span>
<a href="#l12.189"></a><span id="l12.189">   }</span>
<a href="#l12.190"></a><span id="l12.190"> </span>
<a href="#l12.191"></a><span id="l12.191">   return NS_OK;</span>
<a href="#l12.192"></a><span id="l12.192"> }</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l13.1"></a><span id="l13.1" class="difflineminus">--- a/mail/components/shell/nsMailWinIntegration.cpp</span>
<a href="#l13.2"></a><span id="l13.2" class="difflineplus">+++ b/mail/components/shell/nsMailWinIntegration.cpp</span>
<a href="#l13.3"></a><span id="l13.3" class="difflineat">@@ -5,17 +5,17 @@</span>
<a href="#l13.4"></a><span id="l13.4"> </span>
<a href="#l13.5"></a><span id="l13.5"> #include &quot;nsMailWinIntegration.h&quot;</span>
<a href="#l13.6"></a><span id="l13.6"> #include &quot;nsIServiceManager.h&quot;</span>
<a href="#l13.7"></a><span id="l13.7"> #include &quot;nsICategoryManager.h&quot;</span>
<a href="#l13.8"></a><span id="l13.8"> #include &quot;nsNativeCharsetUtils.h&quot;</span>
<a href="#l13.9"></a><span id="l13.9"> #include &quot;nsIPrefService.h&quot;</span>
<a href="#l13.10"></a><span id="l13.10"> #include &quot;windows.h&quot;</span>
<a href="#l13.11"></a><span id="l13.11"> #include &quot;shellapi.h&quot;</span>
<a href="#l13.12"></a><span id="l13.12" class="difflineminus">-#include &quot;nsILocalFile.h&quot;</span>
<a href="#l13.13"></a><span id="l13.13" class="difflineplus">+#include &quot;nsIFile.h&quot;</span>
<a href="#l13.14"></a><span id="l13.14"> #include &quot;nsDirectoryServiceDefs.h&quot;</span>
<a href="#l13.15"></a><span id="l13.15"> #include &quot;nsUnicharUtils.h&quot;</span>
<a href="#l13.16"></a><span id="l13.16"> #include &quot;nsIWinTaskbar.h&quot;</span>
<a href="#l13.17"></a><span id="l13.17"> #include &quot;nsISupportsPrimitives.h&quot;</span>
<a href="#l13.18"></a><span id="l13.18"> </span>
<a href="#l13.19"></a><span id="l13.19"> #ifdef _WIN32_WINNT</span>
<a href="#l13.20"></a><span id="l13.20"> #undef _WIN32_WINNT</span>
<a href="#l13.21"></a><span id="l13.21"> #endif</span>
<a href="#l13.22"></a><span id="l13.22" class="difflineat">@@ -113,19 +113,19 @@ static SETTING gFeedSettings[] = {</span>
<a href="#l13.23"></a><span id="l13.23"> nsresult</span>
<a href="#l13.24"></a><span id="l13.24"> GetHelperPath(nsAutoString&amp; aPath)</span>
<a href="#l13.25"></a><span id="l13.25"> {</span>
<a href="#l13.26"></a><span id="l13.26">   nsresult rv;</span>
<a href="#l13.27"></a><span id="l13.27">   nsCOMPtr&lt;nsIProperties&gt; directoryService = </span>
<a href="#l13.28"></a><span id="l13.28">     do_GetService(NS_DIRECTORY_SERVICE_CONTRACTID, &amp;rv);</span>
<a href="#l13.29"></a><span id="l13.29">   NS_ENSURE_SUCCESS(rv, rv);</span>
<a href="#l13.30"></a><span id="l13.30"> </span>
<a href="#l13.31"></a><span id="l13.31" class="difflineminus">-  nsCOMPtr&lt;nsILocalFile&gt; appHelper;</span>
<a href="#l13.32"></a><span id="l13.32" class="difflineplus">+  nsCOMPtr&lt;nsIFile&gt; appHelper;</span>
<a href="#l13.33"></a><span id="l13.33">   rv = directoryService-&gt;Get(NS_XPCOM_CURRENT_PROCESS_DIR,</span>
<a href="#l13.34"></a><span id="l13.34" class="difflineminus">-                             NS_GET_IID(nsILocalFile),</span>
<a href="#l13.35"></a><span id="l13.35" class="difflineplus">+                             NS_GET_IID(nsIFile),</span>
<a href="#l13.36"></a><span id="l13.36">                              getter_AddRefs(appHelper));</span>
<a href="#l13.37"></a><span id="l13.37">   NS_ENSURE_SUCCESS(rv, rv);</span>
<a href="#l13.38"></a><span id="l13.38"> </span>
<a href="#l13.39"></a><span id="l13.39">   rv = appHelper-&gt;Append(NS_LITERAL_STRING(&quot;uninstall&quot;));</span>
<a href="#l13.40"></a><span id="l13.40">   NS_ENSURE_SUCCESS(rv, rv);</span>
<a href="#l13.41"></a><span id="l13.41"> </span>
<a href="#l13.42"></a><span id="l13.42">   rv = appHelper-&gt;Append(NS_LITERAL_STRING(&quot;helper.exe&quot;));</span>
<a href="#l13.43"></a><span id="l13.43">   NS_ENSURE_SUCCESS(rv, rv);</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l14.1"></a><span id="l14.1" class="difflineminus">--- a/mailnews/addrbook/public/nsIAbLDAPDirectory.idl</span>
<a href="#l14.2"></a><span id="l14.2" class="difflineplus">+++ b/mailnews/addrbook/public/nsIAbLDAPDirectory.idl</span>
<a href="#l14.3"></a><span id="l14.3" class="difflineat">@@ -1,17 +1,17 @@</span>
<a href="#l14.4"></a><span id="l14.4"> /* -*- Mode: C++; tab-width: 2; indent-tabs-mode: nil; c-basic-offset: 2 -*- */</span>
<a href="#l14.5"></a><span id="l14.5"> /* This Source Code Form is subject to the terms of the Mozilla Public</span>
<a href="#l14.6"></a><span id="l14.6">  * License, v. 2.0. If a copy of the MPL was not distributed with this</span>
<a href="#l14.7"></a><span id="l14.7">  * file, You can obtain one at http://mozilla.org/MPL/2.0/. */</span>
<a href="#l14.8"></a><span id="l14.8"> </span>
<a href="#l14.9"></a><span id="l14.9"> #include &quot;nsISupports.idl&quot;</span>
<a href="#l14.10"></a><span id="l14.10"> </span>
<a href="#l14.11"></a><span id="l14.11"> interface nsIMutableArray;</span>
<a href="#l14.12"></a><span id="l14.12" class="difflineminus">-interface nsILocalFile;</span>
<a href="#l14.13"></a><span id="l14.13" class="difflineplus">+interface nsIFile;</span>
<a href="#l14.14"></a><span id="l14.14"> interface nsIAddrDatabase;</span>
<a href="#l14.15"></a><span id="l14.15"> interface nsIAbLDAPAttributeMap;</span>
<a href="#l14.16"></a><span id="l14.16"> interface nsILDAPURL;</span>
<a href="#l14.17"></a><span id="l14.17"> </span>
<a href="#l14.18"></a><span id="l14.18"> %{C++</span>
<a href="#l14.19"></a><span id="l14.19"> #define kLDAPDirectoryRoot         &quot;moz-abldapdirectory://&quot;</span>
<a href="#l14.20"></a><span id="l14.20"> #define kLDAPDirectoryRootLen      22</span>
<a href="#l14.21"></a><span id="l14.21"> %}</span>
<a href="#l14.22"></a><span id="l14.22" class="difflineat">@@ -79,17 +79,17 @@ interface nsIAbLDAPDirectory : nsISuppor</span>
<a href="#l14.23"></a><span id="l14.23">    * url, e.g. ldap://localhost:389/ whereas the uri will give you the</span>
<a href="#l14.24"></a><span id="l14.24">    * directories rdf uri, e.g. moz-abldapdirectory://&lt;pref base name&gt;/.</span>
<a href="#l14.25"></a><span id="l14.25">    */</span>
<a href="#l14.26"></a><span id="l14.26">   attribute nsILDAPURL lDAPURL;</span>
<a href="#l14.27"></a><span id="l14.27"> </span>
<a href="#l14.28"></a><span id="l14.28">   /**</span>
<a href="#l14.29"></a><span id="l14.29">    * The replication (offline) file that this database uses.</span>
<a href="#l14.30"></a><span id="l14.30">    */</span>
<a href="#l14.31"></a><span id="l14.31" class="difflineminus">-  readonly attribute nsILocalFile replicationFile;</span>
<a href="#l14.32"></a><span id="l14.32" class="difflineplus">+  readonly attribute nsIFile replicationFile;</span>
<a href="#l14.33"></a><span id="l14.33"> </span>
<a href="#l14.34"></a><span id="l14.34">   /**</span>
<a href="#l14.35"></a><span id="l14.35">    * A database that is set up for the replication file.</span>
<a href="#l14.36"></a><span id="l14.36">    */</span>
<a href="#l14.37"></a><span id="l14.37">   readonly attribute nsIAddrDatabase replicationDatabase;</span>
<a href="#l14.38"></a><span id="l14.38"> </span>
<a href="#l14.39"></a><span id="l14.39">   /**</span>
<a href="#l14.40"></a><span id="l14.40">    * The LDAP attributes used to build the Relative Distinguished Name</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l15.1"></a><span id="l15.1" class="difflineminus">--- a/mailnews/addrbook/public/nsIAbMDBDirectory.idl</span>
<a href="#l15.2"></a><span id="l15.2" class="difflineplus">+++ b/mailnews/addrbook/public/nsIAbMDBDirectory.idl</span>
<a href="#l15.3"></a><span id="l15.3" class="difflineat">@@ -1,16 +1,16 @@</span>
<a href="#l15.4"></a><span id="l15.4"> /* -*- Mode: C++; tab-width: 2; indent-tabs-mode: nil; c-basic-offset: 2 -*- */</span>
<a href="#l15.5"></a><span id="l15.5"> /* This Source Code Form is subject to the terms of the Mozilla Public</span>
<a href="#l15.6"></a><span id="l15.6">  * License, v. 2.0. If a copy of the MPL was not distributed with this</span>
<a href="#l15.7"></a><span id="l15.7">  * file, You can obtain one at http://mozilla.org/MPL/2.0/. */</span>
<a href="#l15.8"></a><span id="l15.8">  </span>
<a href="#l15.9"></a><span id="l15.9"> #include &quot;nsISupports.idl&quot;</span>
<a href="#l15.10"></a><span id="l15.10"> </span>
<a href="#l15.11"></a><span id="l15.11" class="difflineminus">-interface nsILocalFile;</span>
<a href="#l15.12"></a><span id="l15.12" class="difflineplus">+interface nsIFile;</span>
<a href="#l15.13"></a><span id="l15.13"> interface nsIAbDirectory;</span>
<a href="#l15.14"></a><span id="l15.14"> interface nsIAbCard;</span>
<a href="#l15.15"></a><span id="l15.15"> interface nsIAddrDatabase;</span>
<a href="#l15.16"></a><span id="l15.16"> </span>
<a href="#l15.17"></a><span id="l15.17"> %{C++</span>
<a href="#l15.18"></a><span id="l15.18"> #define kMDBDirectoryRoot          &quot;moz-abmdbdirectory://&quot;</span>
<a href="#l15.19"></a><span id="l15.19"> #define kMDBDirectoryRootLen       21</span>
<a href="#l15.20"></a><span id="l15.20"> %}</span>
<a href="#l15.21"></a><span id="l15.21" class="difflineat">@@ -19,22 +19,22 @@ interface nsIAddrDatabase;</span>
<a href="#l15.22"></a><span id="l15.22"> interface nsIAbMDBDirectory : nsISupports {</span>
<a href="#l15.23"></a><span id="l15.23"> </span>
<a href="#l15.24"></a><span id="l15.24"> 	// Creates a directory component from the</span>
<a href="#l15.25"></a><span id="l15.25"> 	// uriName, adds it to its children and returns</span>
<a href="#l15.26"></a><span id="l15.26"> 	// the component</span>
<a href="#l15.27"></a><span id="l15.27"> 	nsIAbDirectory addDirectory(in string uriName);</span>
<a href="#l15.28"></a><span id="l15.28"> </span>
<a href="#l15.29"></a><span id="l15.29">   /**</span>
<a href="#l15.30"></a><span id="l15.30" class="difflineminus">-   * Supplies a nsILocalFile point to the database file for this directory</span>
<a href="#l15.31"></a><span id="l15.31" class="difflineplus">+   * Supplies a nsIFile point to the database file for this directory</span>
<a href="#l15.32"></a><span id="l15.32">    *</span>
<a href="#l15.33"></a><span id="l15.33">    * @exception NS_ERROR_NOT_INITIALIZED If there is no filename preference</span>
<a href="#l15.34"></a><span id="l15.34">    *                                     present or it is empty</span>
<a href="#l15.35"></a><span id="l15.35">    */</span>
<a href="#l15.36"></a><span id="l15.36" class="difflineminus">-  readonly attribute nsILocalFile databaseFile;</span>
<a href="#l15.37"></a><span id="l15.37" class="difflineplus">+  readonly attribute nsIFile databaseFile;</span>
<a href="#l15.38"></a><span id="l15.38"> </span>
<a href="#l15.39"></a><span id="l15.39">   /**</span>
<a href="#l15.40"></a><span id="l15.40">    * Supplies a nsIAddrDatabase that uses the databaseFile. See also</span>
<a href="#l15.41"></a><span id="l15.41">   * databaseFile for possible exceptions.</span>
<a href="#l15.42"></a><span id="l15.42">    */</span>
<a href="#l15.43"></a><span id="l15.43">   readonly attribute nsIAddrDatabase database;</span>
<a href="#l15.44"></a><span id="l15.44"> </span>
<a href="#l15.45"></a><span id="l15.45"> 	// Mail list specific</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l16.1"></a><span id="l16.1" class="difflineminus">--- a/mailnews/addrbook/public/nsIAbManager.idl</span>
<a href="#l16.2"></a><span id="l16.2" class="difflineplus">+++ b/mailnews/addrbook/public/nsIAbManager.idl</span>
<a href="#l16.3"></a><span id="l16.3" class="difflineat">@@ -5,17 +5,17 @@</span>
<a href="#l16.4"></a><span id="l16.4"> </span>
<a href="#l16.5"></a><span id="l16.5"> #include &quot;nsISupports.idl&quot;</span>
<a href="#l16.6"></a><span id="l16.6"> #include &quot;nsIAbListener.idl&quot;</span>
<a href="#l16.7"></a><span id="l16.7"> </span>
<a href="#l16.8"></a><span id="l16.8"> interface nsIDOMWindow;</span>
<a href="#l16.9"></a><span id="l16.9"> interface nsIAbDirectory;</span>
<a href="#l16.10"></a><span id="l16.10"> interface nsIAbCard;</span>
<a href="#l16.11"></a><span id="l16.11"> interface nsIAbDirectoryProperties;</span>
<a href="#l16.12"></a><span id="l16.12" class="difflineminus">-interface nsILocalFile;</span>
<a href="#l16.13"></a><span id="l16.13" class="difflineplus">+interface nsIFile;</span>
<a href="#l16.14"></a><span id="l16.14"> interface nsISimpleEnumerator;</span>
<a href="#l16.15"></a><span id="l16.15"> interface nsIAbBooleanExpression;</span>
<a href="#l16.16"></a><span id="l16.16"> </span>
<a href="#l16.17"></a><span id="l16.17"> /**</span>
<a href="#l16.18"></a><span id="l16.18">  * nsIAbManager is an interface to the main address book mananger</span>
<a href="#l16.19"></a><span id="l16.19">  * via the contract id &quot;@mozilla.org/abmanager;1&quot;</span>
<a href="#l16.20"></a><span id="l16.20">  *</span>
<a href="#l16.21"></a><span id="l16.21">  * It contains the main functions to create and delete address books as well</span>
<a href="#l16.22"></a><span id="l16.22" class="difflineat">@@ -132,17 +132,17 @@ interface nsIAbManager : nsISupports</span>
<a href="#l16.23"></a><span id="l16.23">    */</span>
<a href="#l16.24"></a><span id="l16.24">   void notifyDirectoryDeleted(in nsIAbDirectory aParentDirectory,</span>
<a href="#l16.25"></a><span id="l16.25">                               in nsISupports aDirectory);</span>
<a href="#l16.26"></a><span id="l16.26"> </span>
<a href="#l16.27"></a><span id="l16.27">   /**</span>
<a href="#l16.28"></a><span id="l16.28">    * Returns the user profile directory. NOTE: this should not be used</span>
<a href="#l16.29"></a><span id="l16.29">    * as it may go away soon.</span>
<a href="#l16.30"></a><span id="l16.30">    */</span>
<a href="#l16.31"></a><span id="l16.31" class="difflineminus">-  readonly attribute nsILocalFile userProfileDirectory;</span>
<a href="#l16.32"></a><span id="l16.32" class="difflineplus">+  readonly attribute nsIFile userProfileDirectory;</span>
<a href="#l16.33"></a><span id="l16.33"> </span>
<a href="#l16.34"></a><span id="l16.34">   /**</span>
<a href="#l16.35"></a><span id="l16.35">    * Finds out if the mailing list name exists in any *mork/MDB* based</span>
<a href="#l16.36"></a><span id="l16.36">    * address book</span>
<a href="#l16.37"></a><span id="l16.37">    *</span>
<a href="#l16.38"></a><span id="l16.38">    * @param  aName      The name of the list to try and find.</span>
<a href="#l16.39"></a><span id="l16.39">    *</span>
<a href="#l16.40"></a><span id="l16.40">    * @return            True if the name exists.</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l17.1"></a><span id="l17.1" class="difflineminus">--- a/mailnews/addrbook/src/nsAbLDAPChangeLogData.cpp</span>
<a href="#l17.2"></a><span id="l17.2" class="difflineplus">+++ b/mailnews/addrbook/src/nsAbLDAPChangeLogData.cpp</span>
<a href="#l17.3"></a><span id="l17.3" class="difflineat">@@ -155,17 +155,17 @@ nsresult nsAbLDAPProcessChangeLogData::O</span>
<a href="#l17.4"></a><span id="l17.4">                 break;</span>
<a href="#l17.5"></a><span id="l17.5">             case kSearchingRootDSE:</span>
<a href="#l17.6"></a><span id="l17.6">              {</span>
<a href="#l17.7"></a><span id="l17.7">                 // Before starting the changeLog check the DB file, if its not there or bogus</span>
<a href="#l17.8"></a><span id="l17.8">                 // we need to create a new one and set to all.</span>
<a href="#l17.9"></a><span id="l17.9">                 nsCOMPtr&lt;nsIAddrBookSession&gt; abSession = do_GetService(NS_ADDRBOOKSESSION_CONTRACTID, &amp;rv);</span>
<a href="#l17.10"></a><span id="l17.10">                 if (NS_FAILED(rv)) </span>
<a href="#l17.11"></a><span id="l17.11">                     break;</span>
<a href="#l17.12"></a><span id="l17.12" class="difflineminus">-                nsCOMPtr&lt;nsILocalFile&gt; dbPath;</span>
<a href="#l17.13"></a><span id="l17.13" class="difflineplus">+                nsCOMPtr&lt;nsIFile&gt; dbPath;</span>
<a href="#l17.14"></a><span id="l17.14">                 rv = abSession-&gt;GetUserProfileDirectory(getter_AddRefs(dbPath));</span>
<a href="#l17.15"></a><span id="l17.15">                 if (NS_FAILED(rv)) </span>
<a href="#l17.16"></a><span id="l17.16">                     break;</span>
<a href="#l17.17"></a><span id="l17.17"> </span>
<a href="#l17.18"></a><span id="l17.18">                 nsCAutoString fileName;</span>
<a href="#l17.19"></a><span id="l17.19">                 rv = mDirectory-&gt;GetReplicationFileName(fileName);</span>
<a href="#l17.20"></a><span id="l17.20">                 if (NS_FAILED(rv))</span>
<a href="#l17.21"></a><span id="l17.21">                   break;</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l18.1"></a><span id="l18.1" class="difflineminus">--- a/mailnews/addrbook/src/nsAbLDAPDirectory.cpp</span>
<a href="#l18.2"></a><span id="l18.2" class="difflineplus">+++ b/mailnews/addrbook/src/nsAbLDAPDirectory.cpp</span>
<a href="#l18.3"></a><span id="l18.3" class="difflineat">@@ -17,17 +17,17 @@</span>
<a href="#l18.4"></a><span id="l18.4"> #include &quot;nsArrayEnumerator.h&quot;</span>
<a href="#l18.5"></a><span id="l18.5"> #include &quot;nsEnumeratorUtils.h&quot;</span>
<a href="#l18.6"></a><span id="l18.6"> #include &quot;nsIAbLDAPAttributeMap.h&quot;</span>
<a href="#l18.7"></a><span id="l18.7"> #include &quot;nsIAbMDBDirectory.h&quot;</span>
<a href="#l18.8"></a><span id="l18.8"> #include &quot;nsILDAPURL.h&quot;</span>
<a href="#l18.9"></a><span id="l18.9"> #include &quot;nsILDAPConnection.h&quot;</span>
<a href="#l18.10"></a><span id="l18.10"> #include &quot;nsAppDirectoryServiceDefs.h&quot;</span>
<a href="#l18.11"></a><span id="l18.11"> #include &quot;nsDirectoryServiceUtils.h&quot;</span>
<a href="#l18.12"></a><span id="l18.12" class="difflineminus">-#include &quot;nsILocalFile.h&quot;</span>
<a href="#l18.13"></a><span id="l18.13" class="difflineplus">+#include &quot;nsIFile.h&quot;</span>
<a href="#l18.14"></a><span id="l18.14"> #include &quot;nsILDAPModification.h&quot;</span>
<a href="#l18.15"></a><span id="l18.15"> #include &quot;nsILDAPService.h&quot;</span>
<a href="#l18.16"></a><span id="l18.16"> #include &quot;nsIAbLDAPCard.h&quot;</span>
<a href="#l18.17"></a><span id="l18.17"> #include &quot;nsAbUtils.h&quot;</span>
<a href="#l18.18"></a><span id="l18.18"> #include &quot;nsArrayUtils.h&quot;</span>
<a href="#l18.19"></a><span id="l18.19"> #include &quot;nsIPrefService.h&quot;</span>
<a href="#l18.20"></a><span id="l18.20"> #include &quot;nsIMsgAccountManager.h&quot;</span>
<a href="#l18.21"></a><span id="l18.21"> #include &quot;nsMsgBaseCID.h&quot;</span>
<a href="#l18.22"></a><span id="l18.22" class="difflineat">@@ -517,17 +517,17 @@ NS_IMETHODIMP nsAbLDAPDirectory::UseForA</span>
<a href="#l18.23"></a><span id="l18.23">     NS_ENSURE_SUCCESS(rv,rv);</span>
<a href="#l18.24"></a><span id="l18.24">   }</span>
<a href="#l18.25"></a><span id="l18.25"> </span>
<a href="#l18.26"></a><span id="l18.26">   // Now see if the pref name matches our pref id.</span>
<a href="#l18.27"></a><span id="l18.27">   if (prefName.Equals(m_DirPrefId))</span>
<a href="#l18.28"></a><span id="l18.28">   {</span>
<a href="#l18.29"></a><span id="l18.29">     // Yes it does, one last check - does the replication file exist?</span>
<a href="#l18.30"></a><span id="l18.30">     nsresult rv;</span>
<a href="#l18.31"></a><span id="l18.31" class="difflineminus">-    nsCOMPtr&lt;nsILocalFile&gt; databaseFile;</span>
<a href="#l18.32"></a><span id="l18.32" class="difflineplus">+    nsCOMPtr&lt;nsIFile&gt; databaseFile;</span>
<a href="#l18.33"></a><span id="l18.33">     // If we can't get the file, then there is no database to use</span>
<a href="#l18.34"></a><span id="l18.34">     if (NS_FAILED(GetReplicationFile(getter_AddRefs(databaseFile))))</span>
<a href="#l18.35"></a><span id="l18.35">       return NS_OK;</span>
<a href="#l18.36"></a><span id="l18.36"> </span>
<a href="#l18.37"></a><span id="l18.37">     bool exists;</span>
<a href="#l18.38"></a><span id="l18.38">     rv = databaseFile-&gt;Exists(&amp;exists);</span>
<a href="#l18.39"></a><span id="l18.39">     NS_ENSURE_SUCCESS(rv, rv);</span>
<a href="#l18.40"></a><span id="l18.40"> </span>
<a href="#l18.41"></a><span id="l18.41" class="difflineat">@@ -652,17 +652,17 @@ NS_IMETHODIMP nsAbLDAPDirectory::GetAttr</span>
<a href="#l18.42"></a><span id="l18.42">   nsresult rv;</span>
<a href="#l18.43"></a><span id="l18.43">   nsCOMPtr&lt;nsIAbLDAPAttributeMapService&gt; mapSvc = </span>
<a href="#l18.44"></a><span id="l18.44">     do_GetService(&quot;@mozilla.org/addressbook/ldap-attribute-map-service;1&quot;, &amp;rv);</span>
<a href="#l18.45"></a><span id="l18.45">   NS_ENSURE_SUCCESS(rv, rv);</span>
<a href="#l18.46"></a><span id="l18.46"> </span>
<a href="#l18.47"></a><span id="l18.47">   return mapSvc-&gt;GetMapForPrefBranch(m_DirPrefId, aAttributeMap);</span>
<a href="#l18.48"></a><span id="l18.48"> }</span>
<a href="#l18.49"></a><span id="l18.49"> </span>
<a href="#l18.50"></a><span id="l18.50" class="difflineminus">-NS_IMETHODIMP nsAbLDAPDirectory::GetReplicationFile(nsILocalFile **aResult)</span>
<a href="#l18.51"></a><span id="l18.51" class="difflineplus">+NS_IMETHODIMP nsAbLDAPDirectory::GetReplicationFile(nsIFile **aResult)</span>
<a href="#l18.52"></a><span id="l18.52"> {</span>
<a href="#l18.53"></a><span id="l18.53">   NS_ENSURE_ARG_POINTER(aResult);</span>
<a href="#l18.54"></a><span id="l18.54"> </span>
<a href="#l18.55"></a><span id="l18.55">   nsCString fileName;</span>
<a href="#l18.56"></a><span id="l18.56">   nsresult rv = GetStringValue(&quot;filename&quot;, EmptyCString(), fileName);</span>
<a href="#l18.57"></a><span id="l18.57">   NS_ENSURE_SUCCESS(rv, rv);</span>
<a href="#l18.58"></a><span id="l18.58"> </span>
<a href="#l18.59"></a><span id="l18.59">  if (fileName.IsEmpty())</span>
<a href="#l18.60"></a><span id="l18.60" class="difflineat">@@ -671,30 +671,27 @@ NS_IMETHODIMP nsAbLDAPDirectory::GetRepl</span>
<a href="#l18.61"></a><span id="l18.61">   nsCOMPtr&lt;nsIFile&gt; profileDir;</span>
<a href="#l18.62"></a><span id="l18.62">   rv = NS_GetSpecialDirectory(NS_APP_USER_PROFILE_50_DIR,</span>
<a href="#l18.63"></a><span id="l18.63">                               getter_AddRefs(profileDir));</span>
<a href="#l18.64"></a><span id="l18.64">   NS_ENSURE_SUCCESS(rv, rv);</span>
<a href="#l18.65"></a><span id="l18.65"> </span>
<a href="#l18.66"></a><span id="l18.66">   rv = profileDir-&gt;AppendNative(fileName);</span>
<a href="#l18.67"></a><span id="l18.67">   NS_ENSURE_SUCCESS(rv, rv);</span>
<a href="#l18.68"></a><span id="l18.68"> </span>
<a href="#l18.69"></a><span id="l18.69" class="difflineminus">-  nsCOMPtr&lt;nsILocalFile&gt; replFile(do_QueryInterface(profileDir, &amp;rv));</span>
<a href="#l18.70"></a><span id="l18.70" class="difflineminus">-  NS_ENSURE_SUCCESS(rv, rv);</span>
<a href="#l18.71"></a><span id="l18.71" class="difflineminus">-</span>
<a href="#l18.72"></a><span id="l18.72" class="difflineminus">-  NS_ADDREF(*aResult = replFile);</span>
<a href="#l18.73"></a><span id="l18.73" class="difflineplus">+  NS_ADDREF(*aResult = profileDir);</span>
<a href="#l18.74"></a><span id="l18.74"> </span>
<a href="#l18.75"></a><span id="l18.75">   return NS_OK;</span>
<a href="#l18.76"></a><span id="l18.76"> }</span>
<a href="#l18.77"></a><span id="l18.77"> </span>
<a href="#l18.78"></a><span id="l18.78"> NS_IMETHODIMP nsAbLDAPDirectory::GetReplicationDatabase(nsIAddrDatabase **aResult)</span>
<a href="#l18.79"></a><span id="l18.79"> {</span>
<a href="#l18.80"></a><span id="l18.80">   NS_ENSURE_ARG_POINTER(aResult);</span>
<a href="#l18.81"></a><span id="l18.81"> </span>
<a href="#l18.82"></a><span id="l18.82">   nsresult rv;</span>
<a href="#l18.83"></a><span id="l18.83" class="difflineminus">-  nsCOMPtr&lt;nsILocalFile&gt; databaseFile;</span>
<a href="#l18.84"></a><span id="l18.84" class="difflineplus">+  nsCOMPtr&lt;nsIFile&gt; databaseFile;</span>
<a href="#l18.85"></a><span id="l18.85">  rv = GetReplicationFile(getter_AddRefs(databaseFile));</span>
<a href="#l18.86"></a><span id="l18.86">   NS_ENSURE_SUCCESS(rv, rv);</span>
<a href="#l18.87"></a><span id="l18.87"> </span>
<a href="#l18.88"></a><span id="l18.88">   nsCOMPtr&lt;nsIAddrDatabase&gt; addrDBFactory =</span>
<a href="#l18.89"></a><span id="l18.89">     do_GetService(NS_ADDRDATABASE_CONTRACTID, &amp;rv);</span>
<a href="#l18.90"></a><span id="l18.90">   NS_ENSURE_SUCCESS(rv, rv);</span>
<a href="#l18.91"></a><span id="l18.91"> </span>
<a href="#l18.92"></a><span id="l18.92">   return addrDBFactory-&gt;Open(databaseFile, false /* no create */, true,</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l19.1"></a><span id="l19.1" class="difflineminus">--- a/mailnews/addrbook/src/nsAbLDAPReplicationData.h</span>
<a href="#l19.2"></a><span id="l19.2" class="difflineplus">+++ b/mailnews/addrbook/src/nsAbLDAPReplicationData.h</span>
<a href="#l19.3"></a><span id="l19.3" class="difflineat">@@ -6,17 +6,17 @@</span>
<a href="#l19.4"></a><span id="l19.4"> #ifndef nsAbLDAPReplicationData_h__</span>
<a href="#l19.5"></a><span id="l19.5"> #define nsAbLDAPReplicationData_h__</span>
<a href="#l19.6"></a><span id="l19.6"> </span>
<a href="#l19.7"></a><span id="l19.7"> #include &quot;nsIAbLDAPReplicationData.h&quot;</span>
<a href="#l19.8"></a><span id="l19.8"> #include &quot;nsIWebProgressListener.h&quot;</span>
<a href="#l19.9"></a><span id="l19.9"> #include &quot;nsIAbLDAPReplicationQuery.h&quot;</span>
<a href="#l19.10"></a><span id="l19.10"> #include &quot;nsAbLDAPListenerBase.h&quot;</span>
<a href="#l19.11"></a><span id="l19.11"> #include &quot;nsIAddrDatabase.h&quot;</span>
<a href="#l19.12"></a><span id="l19.12" class="difflineminus">-#include &quot;nsILocalFile.h&quot;</span>
<a href="#l19.13"></a><span id="l19.13" class="difflineplus">+#include &quot;nsIFile.h&quot;</span>
<a href="#l19.14"></a><span id="l19.14"> #include &quot;nsDirPrefs.h&quot;</span>
<a href="#l19.15"></a><span id="l19.15"> #include &quot;nsIAbLDAPAttributeMap.h&quot;</span>
<a href="#l19.16"></a><span id="l19.16"> #include &quot;nsIAbLDAPDirectory.h&quot;</span>
<a href="#l19.17"></a><span id="l19.17"> #include &quot;nsStringGlue.h&quot;</span>
<a href="#l19.18"></a><span id="l19.18"> </span>
<a href="#l19.19"></a><span id="l19.19"> class nsAbLDAPProcessReplicationData : public nsIAbLDAPProcessReplicationData,</span>
<a href="#l19.20"></a><span id="l19.20">                                        public nsAbLDAPListenerBase</span>
<a href="#l19.21"></a><span id="l19.21"> {</span>
<a href="#l19.22"></a><span id="l19.22" class="difflineat">@@ -35,18 +35,18 @@ protected:</span>
<a href="#l19.23"></a><span id="l19.23">   virtual void InitFailed(bool aCancelled = false);</span>
<a href="#l19.24"></a><span id="l19.24"> </span>
<a href="#l19.25"></a><span id="l19.25">   // pointer to the interfaces used by this object</span>
<a href="#l19.26"></a><span id="l19.26">   nsCOMPtr&lt;nsIWebProgressListener&gt; mListener;</span>
<a href="#l19.27"></a><span id="l19.27">   // pointer to the query to call back to once we've finished</span>
<a href="#l19.28"></a><span id="l19.28">   nsCOMPtr&lt;nsIAbLDAPReplicationQuery&gt; mQuery;</span>
<a href="#l19.29"></a><span id="l19.29"> </span>
<a href="#l19.30"></a><span id="l19.30">   nsCOMPtr&lt;nsIAddrDatabase&gt; mReplicationDB;</span>
<a href="#l19.31"></a><span id="l19.31" class="difflineminus">-  nsCOMPtr &lt;nsILocalFile&gt; mReplicationFile;</span>
<a href="#l19.32"></a><span id="l19.32" class="difflineminus">-  nsCOMPtr &lt;nsILocalFile&gt; mBackupReplicationFile;</span>
<a href="#l19.33"></a><span id="l19.33" class="difflineplus">+  nsCOMPtr &lt;nsIFile&gt; mReplicationFile;</span>
<a href="#l19.34"></a><span id="l19.34" class="difflineplus">+  nsCOMPtr &lt;nsIFile&gt; mBackupReplicationFile;</span>
<a href="#l19.35"></a><span id="l19.35"> </span>
<a href="#l19.36"></a><span id="l19.36">   // state of processing, protocol used and count of results</span>
<a href="#l19.37"></a><span id="l19.37">   PRInt32         mState;</span>
<a href="#l19.38"></a><span id="l19.38">   PRInt32         mProtocol;</span>
<a href="#l19.39"></a><span id="l19.39">   PRInt32         mCount;</span>
<a href="#l19.40"></a><span id="l19.40">   bool            mDBOpen;</span>
<a href="#l19.41"></a><span id="l19.41">   bool            mInitialized;</span>
<a href="#l19.42"></a><span id="l19.42">   </span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l20.1"></a><span id="l20.1" class="difflineminus">--- a/mailnews/addrbook/src/nsAbMDBDirFactory.cpp</span>
<a href="#l20.2"></a><span id="l20.2" class="difflineplus">+++ b/mailnews/addrbook/src/nsAbMDBDirFactory.cpp</span>
<a href="#l20.3"></a><span id="l20.3" class="difflineat">@@ -2,17 +2,17 @@</span>
<a href="#l20.4"></a><span id="l20.4"> /* This Source Code Form is subject to the terms of the Mozilla Public</span>
<a href="#l20.5"></a><span id="l20.5">  * License, v. 2.0. If a copy of the MPL was not distributed with this</span>
<a href="#l20.6"></a><span id="l20.6">  * file, You can obtain one at http://mozilla.org/MPL/2.0/. */</span>
<a href="#l20.7"></a><span id="l20.7"> </span>
<a href="#l20.8"></a><span id="l20.8"> #include &quot;nsAbMDBDirFactory.h&quot;</span>
<a href="#l20.9"></a><span id="l20.9"> #include &quot;nsAbUtils.h&quot;</span>
<a href="#l20.10"></a><span id="l20.10"> #include &quot;nsStringGlue.h&quot;</span>
<a href="#l20.11"></a><span id="l20.11"> #include &quot;nsServiceManagerUtils.h&quot;</span>
<a href="#l20.12"></a><span id="l20.12" class="difflineminus">-#include &quot;nsILocalFile.h&quot;</span>
<a href="#l20.13"></a><span id="l20.13" class="difflineplus">+#include &quot;nsIFile.h&quot;</span>
<a href="#l20.14"></a><span id="l20.14"> #include &quot;nsIAbManager.h&quot;</span>
<a href="#l20.15"></a><span id="l20.15"> #include &quot;nsIAbMDBDirectory.h&quot;</span>
<a href="#l20.16"></a><span id="l20.16"> #include &quot;nsAbMDBDirFactory.h&quot;</span>
<a href="#l20.17"></a><span id="l20.17"> #include &quot;nsIAddrDBListener.h&quot;</span>
<a href="#l20.18"></a><span id="l20.18"> #include &quot;nsIAddrDatabase.h&quot;</span>
<a href="#l20.19"></a><span id="l20.19"> #include &quot;nsEnumeratorUtils.h&quot;</span>
<a href="#l20.20"></a><span id="l20.20"> #include &quot;nsIMutableArray.h&quot;</span>
<a href="#l20.21"></a><span id="l20.21"> #include &quot;nsArrayUtils.h&quot;</span>
<a href="#l20.22"></a><span id="l20.22" class="difflineat">@@ -42,17 +42,17 @@ NS_IMETHODIMP nsAbMDBDirFactory::GetDire</span>
<a href="#l20.23"></a><span id="l20.23"> </span>
<a href="#l20.24"></a><span id="l20.24">   nsCOMPtr&lt;nsIAbDirectory&gt; directory;</span>
<a href="#l20.25"></a><span id="l20.25">   rv = abManager-&gt;GetDirectory(aURI, getter_AddRefs(directory));</span>
<a href="#l20.26"></a><span id="l20.26">   NS_ENSURE_SUCCESS(rv, rv);</span>
<a href="#l20.27"></a><span id="l20.27"> </span>
<a href="#l20.28"></a><span id="l20.28">   rv = directory-&gt;SetDirPrefId(aPrefName);</span>
<a href="#l20.29"></a><span id="l20.29">   NS_ENSURE_SUCCESS(rv, rv);</span>
<a href="#l20.30"></a><span id="l20.30"> </span>
<a href="#l20.31"></a><span id="l20.31" class="difflineminus">-  nsCOMPtr&lt;nsILocalFile&gt; dbPath;</span>
<a href="#l20.32"></a><span id="l20.32" class="difflineplus">+  nsCOMPtr&lt;nsIFile&gt; dbPath;</span>
<a href="#l20.33"></a><span id="l20.33">   rv = abManager-&gt;GetUserProfileDirectory(getter_AddRefs(dbPath));</span>
<a href="#l20.34"></a><span id="l20.34"> </span>
<a href="#l20.35"></a><span id="l20.35">   nsCOMPtr&lt;nsIAddrDatabase&gt; listDatabase;</span>
<a href="#l20.36"></a><span id="l20.36">   if (NS_SUCCEEDED(rv))</span>
<a href="#l20.37"></a><span id="l20.37">   {</span>
<a href="#l20.38"></a><span id="l20.38">     nsCAutoString fileName;</span>
<a href="#l20.39"></a><span id="l20.39">       </span>
<a href="#l20.40"></a><span id="l20.40">     if (StringBeginsWith(aURI, NS_LITERAL_CSTRING(kMDBDirectoryRoot)))</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l21.1"></a><span id="l21.1" class="difflineminus">--- a/mailnews/addrbook/src/nsAbMDBDirProperty.cpp</span>
<a href="#l21.2"></a><span id="l21.2" class="difflineplus">+++ b/mailnews/addrbook/src/nsAbMDBDirProperty.cpp</span>
<a href="#l21.3"></a><span id="l21.3" class="difflineat">@@ -129,17 +129,17 @@ NS_IMETHODIMP nsAbMDBDirProperty::Notify</span>
<a href="#l21.4"></a><span id="l21.4"> }</span>
<a href="#l21.5"></a><span id="l21.5"> </span>
<a href="#l21.6"></a><span id="l21.6"> /* [noscript] void clearDatabase (); */</span>
<a href="#l21.7"></a><span id="l21.7"> NS_IMETHODIMP nsAbMDBDirProperty::ClearDatabase()</span>
<a href="#l21.8"></a><span id="l21.8"> {</span>
<a href="#l21.9"></a><span id="l21.9">     return NS_ERROR_NOT_IMPLEMENTED;</span>
<a href="#l21.10"></a><span id="l21.10"> }</span>
<a href="#l21.11"></a><span id="l21.11"> </span>
<a href="#l21.12"></a><span id="l21.12" class="difflineminus">-NS_IMETHODIMP nsAbMDBDirProperty::GetDatabaseFile(nsILocalFile **aResult)</span>
<a href="#l21.13"></a><span id="l21.13" class="difflineplus">+NS_IMETHODIMP nsAbMDBDirProperty::GetDatabaseFile(nsIFile **aResult)</span>
<a href="#l21.14"></a><span id="l21.14"> {</span>
<a href="#l21.15"></a><span id="l21.15">   return NS_ERROR_NOT_IMPLEMENTED;</span>
<a href="#l21.16"></a><span id="l21.16"> }</span>
<a href="#l21.17"></a><span id="l21.17"> </span>
<a href="#l21.18"></a><span id="l21.18"> NS_IMETHODIMP nsAbMDBDirProperty::GetDatabase(nsIAddrDatabase **aResult)</span>
<a href="#l21.19"></a><span id="l21.19"> {</span>
<a href="#l21.20"></a><span id="l21.20">   return NS_ERROR_NOT_IMPLEMENTED;</span>
<a href="#l21.21"></a><span id="l21.21"> }</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l22.1"></a><span id="l22.1" class="difflineminus">--- a/mailnews/addrbook/src/nsAbMDBDirectory.cpp</span>
<a href="#l22.2"></a><span id="l22.2" class="difflineplus">+++ b/mailnews/addrbook/src/nsAbMDBDirectory.cpp</span>
<a href="#l22.3"></a><span id="l22.3" class="difflineat">@@ -18,17 +18,17 @@</span>
<a href="#l22.4"></a><span id="l22.4"> #include &quot;nsIMutableArray.h&quot;</span>
<a href="#l22.5"></a><span id="l22.5"> #include &quot;nsArrayEnumerator.h&quot;</span>
<a href="#l22.6"></a><span id="l22.6"> #include &quot;nsEnumeratorUtils.h&quot;</span>
<a href="#l22.7"></a><span id="l22.7"> #include &quot;mdb.h&quot;</span>
<a href="#l22.8"></a><span id="l22.8"> #include &quot;prprf.h&quot;</span>
<a href="#l22.9"></a><span id="l22.9"> #include &quot;nsIPrefService.h&quot;</span>
<a href="#l22.10"></a><span id="l22.10"> #include &quot;nsAppDirectoryServiceDefs.h&quot;</span>
<a href="#l22.11"></a><span id="l22.11"> #include &quot;nsDirectoryServiceUtils.h&quot;</span>
<a href="#l22.12"></a><span id="l22.12" class="difflineminus">-#include &quot;nsILocalFile.h&quot;</span>
<a href="#l22.13"></a><span id="l22.13" class="difflineplus">+#include &quot;nsIFile.h&quot;</span>
<a href="#l22.14"></a><span id="l22.14"> #include &quot;nsComponentManagerUtils.h&quot;</span>
<a href="#l22.15"></a><span id="l22.15"> #include &quot;nsMemory.h&quot;</span>
<a href="#l22.16"></a><span id="l22.16"> #include &quot;nsArrayUtils.h&quot;</span>
<a href="#l22.17"></a><span id="l22.17"> #include &quot;nsUnicharUtils.h&quot;</span>
<a href="#l22.18"></a><span id="l22.18"> </span>
<a href="#l22.19"></a><span id="l22.19"> nsAbMDBDirectory::nsAbMDBDirectory(void):</span>
<a href="#l22.20"></a><span id="l22.20">      nsAbMDBDirProperty(),</span>
<a href="#l22.21"></a><span id="l22.21">      mPerformingQuery(false)</span>
<a href="#l22.22"></a><span id="l22.22" class="difflineat">@@ -315,49 +315,46 @@ NS_IMETHODIMP nsAbMDBDirectory::AddDirec</span>
<a href="#l22.23"></a><span id="l22.23">   NS_ENSURE_SUCCESS(rv, rv);</span>
<a href="#l22.24"></a><span id="l22.24"> </span>
<a href="#l22.25"></a><span id="l22.25">   if (mSubDirectories.IndexOf(directory) == -1)</span>
<a href="#l22.26"></a><span id="l22.26">     mSubDirectories.AppendObject(directory);</span>
<a href="#l22.27"></a><span id="l22.27">   NS_IF_ADDREF(*childDir = directory);</span>
<a href="#l22.28"></a><span id="l22.28">   return rv;</span>
<a href="#l22.29"></a><span id="l22.29"> }</span>
<a href="#l22.30"></a><span id="l22.30"> </span>
<a href="#l22.31"></a><span id="l22.31" class="difflineminus">-NS_IMETHODIMP nsAbMDBDirectory::GetDatabaseFile(nsILocalFile **aResult)</span>
<a href="#l22.32"></a><span id="l22.32" class="difflineplus">+NS_IMETHODIMP nsAbMDBDirectory::GetDatabaseFile(nsIFile **aResult)</span>
<a href="#l22.33"></a><span id="l22.33"> {</span>
<a href="#l22.34"></a><span id="l22.34">   NS_ENSURE_ARG_POINTER(aResult);</span>
<a href="#l22.35"></a><span id="l22.35"> </span>
<a href="#l22.36"></a><span id="l22.36">   nsCString fileName;</span>
<a href="#l22.37"></a><span id="l22.37">   nsresult rv = GetStringValue(&quot;filename&quot;, EmptyCString(), fileName);</span>
<a href="#l22.38"></a><span id="l22.38">   NS_ENSURE_SUCCESS(rv, rv);</span>
<a href="#l22.39"></a><span id="l22.39"> </span>
<a href="#l22.40"></a><span id="l22.40">   if (fileName.IsEmpty())</span>
<a href="#l22.41"></a><span id="l22.41">     return NS_ERROR_NOT_INITIALIZED;</span>
<a href="#l22.42"></a><span id="l22.42"> </span>
<a href="#l22.43"></a><span id="l22.43" class="difflineminus">-  nsCOMPtr&lt;nsIFile&gt; profileDir;</span>
<a href="#l22.44"></a><span id="l22.44" class="difflineplus">+  nsCOMPtr&lt;nsIFile&gt; dbFile;</span>
<a href="#l22.45"></a><span id="l22.45">   rv = NS_GetSpecialDirectory(NS_APP_USER_PROFILE_50_DIR,</span>
<a href="#l22.46"></a><span id="l22.46" class="difflineminus">-                              getter_AddRefs(profileDir));</span>
<a href="#l22.47"></a><span id="l22.47" class="difflineplus">+                              getter_AddRefs(dbFile));</span>
<a href="#l22.48"></a><span id="l22.48">   NS_ENSURE_SUCCESS(rv, rv);</span>
<a href="#l22.49"></a><span id="l22.49"> </span>
<a href="#l22.50"></a><span id="l22.50" class="difflineminus">-  rv = profileDir-&gt;AppendNative(fileName);</span>
<a href="#l22.51"></a><span id="l22.51" class="difflineminus">-  NS_ENSURE_SUCCESS(rv, rv);</span>
<a href="#l22.52"></a><span id="l22.52" class="difflineminus">-</span>
<a href="#l22.53"></a><span id="l22.53" class="difflineminus">-  nsCOMPtr&lt;nsILocalFile&gt; dbFile = do_QueryInterface(profileDir, &amp;rv);</span>
<a href="#l22.54"></a><span id="l22.54" class="difflineplus">+  rv = dbFile-&gt;AppendNative(fileName);</span>
<a href="#l22.55"></a><span id="l22.55">   NS_ENSURE_SUCCESS(rv, rv);</span>
<a href="#l22.56"></a><span id="l22.56"> </span>
<a href="#l22.57"></a><span id="l22.57">   NS_ADDREF(*aResult = dbFile);</span>
<a href="#l22.58"></a><span id="l22.58"> </span>
<a href="#l22.59"></a><span id="l22.59">   return NS_OK;</span>
<a href="#l22.60"></a><span id="l22.60"> }</span>
<a href="#l22.61"></a><span id="l22.61"> </span>
<a href="#l22.62"></a><span id="l22.62"> NS_IMETHODIMP nsAbMDBDirectory::GetDatabase(nsIAddrDatabase **aResult)</span>
<a href="#l22.63"></a><span id="l22.63"> {</span>
<a href="#l22.64"></a><span id="l22.64">   NS_ENSURE_ARG_POINTER(aResult);</span>
<a href="#l22.65"></a><span id="l22.65"> </span>
<a href="#l22.66"></a><span id="l22.66">   nsresult rv;</span>
<a href="#l22.67"></a><span id="l22.67" class="difflineminus">-  nsCOMPtr&lt;nsILocalFile&gt; databaseFile;</span>
<a href="#l22.68"></a><span id="l22.68" class="difflineplus">+  nsCOMPtr&lt;nsIFile&gt; databaseFile;</span>
<a href="#l22.69"></a><span id="l22.69">   rv = GetDatabaseFile(getter_AddRefs(databaseFile));</span>
<a href="#l22.70"></a><span id="l22.70">   NS_ENSURE_SUCCESS(rv, rv);</span>
<a href="#l22.71"></a><span id="l22.71"> </span>
<a href="#l22.72"></a><span id="l22.72">   nsCOMPtr&lt;nsIAddrDatabase&gt; addrDBFactory =</span>
<a href="#l22.73"></a><span id="l22.73">     do_GetService(NS_ADDRDATABASE_CONTRACTID, &amp;rv);</span>
<a href="#l22.74"></a><span id="l22.74">   NS_ENSURE_SUCCESS(rv, rv);</span>
<a href="#l22.75"></a><span id="l22.75"> </span>
<a href="#l22.76"></a><span id="l22.76">   return addrDBFactory-&gt;Open(databaseFile, false /* no create */, true,</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l23.1"></a><span id="l23.1" class="difflineminus">--- a/mailnews/addrbook/src/nsAbMDBDirectory.h</span>
<a href="#l23.2"></a><span id="l23.2" class="difflineplus">+++ b/mailnews/addrbook/src/nsAbMDBDirectory.h</span>
<a href="#l23.3"></a><span id="l23.3" class="difflineat">@@ -44,17 +44,17 @@ public:</span>
<a href="#l23.4"></a><span id="l23.4"> </span>
<a href="#l23.5"></a><span id="l23.5">   // nsIAbMDBDirectory methods</span>
<a href="#l23.6"></a><span id="l23.6">   NS_IMETHOD GetURI(nsACString &amp;aURI);</span>
<a href="#l23.7"></a><span id="l23.7">   NS_IMETHOD ClearDatabase();</span>
<a href="#l23.8"></a><span id="l23.8">   NS_IMETHOD NotifyDirItemAdded(nsISupports *item) { return NotifyItemAdded(item);}</span>
<a href="#l23.9"></a><span id="l23.9">   NS_IMETHOD RemoveElementsFromAddressList();</span>
<a href="#l23.10"></a><span id="l23.10">   NS_IMETHOD RemoveEmailAddressAt(PRUint32 aIndex);</span>
<a href="#l23.11"></a><span id="l23.11">   NS_IMETHOD AddDirectory(const char *uriName, nsIAbDirectory **childDir);</span>
<a href="#l23.12"></a><span id="l23.12" class="difflineminus">-  NS_IMETHOD GetDatabaseFile(nsILocalFile **aResult);</span>
<a href="#l23.13"></a><span id="l23.13" class="difflineplus">+  NS_IMETHOD GetDatabaseFile(nsIFile **aResult);</span>
<a href="#l23.14"></a><span id="l23.14">   NS_IMETHOD GetDatabase(nsIAddrDatabase **aResult);</span>
<a href="#l23.15"></a><span id="l23.15"> </span>
<a href="#l23.16"></a><span id="l23.16">   // nsIAbDirectory methods:</span>
<a href="#l23.17"></a><span id="l23.17">   NS_IMETHOD GetChildNodes(nsISimpleEnumerator* *result);</span>
<a href="#l23.18"></a><span id="l23.18">   NS_IMETHOD GetChildCards(nsISimpleEnumerator* *result);</span>
<a href="#l23.19"></a><span id="l23.19">   NS_IMETHOD GetIsQuery(bool *aResult);</span>
<a href="#l23.20"></a><span id="l23.20">   NS_IMETHOD DeleteDirectory(nsIAbDirectory *directory);</span>
<a href="#l23.21"></a><span id="l23.21">   NS_IMETHOD DeleteCards(nsIArray *cards);</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l24.1"></a><span id="l24.1" class="difflineminus">--- a/mailnews/addrbook/src/nsAbManager.cpp</span>
<a href="#l24.2"></a><span id="l24.2" class="difflineplus">+++ b/mailnews/addrbook/src/nsAbManager.cpp</span>
<a href="#l24.3"></a><span id="l24.3" class="difflineat">@@ -20,17 +20,17 @@</span>
<a href="#l24.4"></a><span id="l24.4"> #include &quot;nsIFilePicker.h&quot;</span>
<a href="#l24.5"></a><span id="l24.5"> #include &quot;plbase64.h&quot;</span>
<a href="#l24.6"></a><span id="l24.6"> #include &quot;nsIWindowWatcher.h&quot;</span>
<a href="#l24.7"></a><span id="l24.7"> #include &quot;nsDirectoryServiceUtils.h&quot;</span>
<a href="#l24.8"></a><span id="l24.8"> #include &quot;nsVCard.h&quot;</span>
<a href="#l24.9"></a><span id="l24.9"> #include &quot;nsVCardObj.h&quot;</span>
<a href="#l24.10"></a><span id="l24.10"> #include &quot;nsIAbLDAPAttributeMap.h&quot;</span>
<a href="#l24.11"></a><span id="l24.11"> #include &quot;nsICommandLine.h&quot;</span>
<a href="#l24.12"></a><span id="l24.12" class="difflineminus">-#include &quot;nsILocalFile.h&quot;</span>
<a href="#l24.13"></a><span id="l24.13" class="difflineplus">+#include &quot;nsIFile.h&quot;</span>
<a href="#l24.14"></a><span id="l24.14"> #include &quot;nsIMutableArray.h&quot;</span>
<a href="#l24.15"></a><span id="l24.15"> #include &quot;nsArrayUtils.h&quot;</span>
<a href="#l24.16"></a><span id="l24.16"> #include &quot;nsDirectoryServiceUtils.h&quot;</span>
<a href="#l24.17"></a><span id="l24.17"> #include &quot;nsIObserverService.h&quot;</span>
<a href="#l24.18"></a><span id="l24.18"> #include &quot;nsDirPrefs.h&quot;</span>
<a href="#l24.19"></a><span id="l24.19"> #include &quot;nsThreadUtils.h&quot;</span>
<a href="#l24.20"></a><span id="l24.20"> #include &quot;nsIAbDirFactory.h&quot;</span>
<a href="#l24.21"></a><span id="l24.21"> #include &quot;nsComponentManagerUtils.h&quot;</span>
<a href="#l24.22"></a><span id="l24.22" class="difflineat">@@ -416,17 +416,17 @@ NS_IMETHODIMP nsAbManager::NotifyDirecto</span>
<a href="#l24.23"></a><span id="l24.23"> NS_IMETHODIMP nsAbManager::NotifyDirectoryDeleted(nsIAbDirectory *aParentDirectory,</span>
<a href="#l24.24"></a><span id="l24.24">                                                   nsISupports *aDirectory)</span>
<a href="#l24.25"></a><span id="l24.25"> {</span>
<a href="#l24.26"></a><span id="l24.26">   NOTIFY_AB_LISTENERS(directoryRemoved, OnItemRemoved,</span>
<a href="#l24.27"></a><span id="l24.27">                       (aParentDirectory, aDirectory));</span>
<a href="#l24.28"></a><span id="l24.28">   return NS_OK;</span>
<a href="#l24.29"></a><span id="l24.29"> }</span>
<a href="#l24.30"></a><span id="l24.30"> </span>
<a href="#l24.31"></a><span id="l24.31" class="difflineminus">-NS_IMETHODIMP nsAbManager::GetUserProfileDirectory(nsILocalFile **userDir)</span>
<a href="#l24.32"></a><span id="l24.32" class="difflineplus">+NS_IMETHODIMP nsAbManager::GetUserProfileDirectory(nsIFile **userDir)</span>
<a href="#l24.33"></a><span id="l24.33"> {</span>
<a href="#l24.34"></a><span id="l24.34">   NS_ENSURE_ARG_POINTER(userDir);</span>
<a href="#l24.35"></a><span id="l24.35">   *userDir = nsnull;</span>
<a href="#l24.36"></a><span id="l24.36"> </span>
<a href="#l24.37"></a><span id="l24.37">   nsresult rv;</span>
<a href="#l24.38"></a><span id="l24.38">   nsCOMPtr&lt;nsIFile&gt; profileDir;</span>
<a href="#l24.39"></a><span id="l24.39">   nsCAutoString pathBuf;</span>
<a href="#l24.40"></a><span id="l24.40"> </span>
<a href="#l24.41"></a><span id="l24.41" class="difflineat">@@ -538,17 +538,17 @@ NS_IMETHODIMP nsAbManager::ExportAddress</span>
<a href="#l24.42"></a><span id="l24.42">   NS_ENSURE_SUCCESS(rv, rv);</span>
<a href="#l24.43"></a><span id="l24.43"> </span>
<a href="#l24.44"></a><span id="l24.44">   PRInt16 dialogResult;</span>
<a href="#l24.45"></a><span id="l24.45">   filePicker-&gt;Show(&amp;dialogResult);</span>
<a href="#l24.46"></a><span id="l24.46"> </span>
<a href="#l24.47"></a><span id="l24.47">   if (dialogResult == nsIFilePicker::returnCancel)</span>
<a href="#l24.48"></a><span id="l24.48">     return rv;</span>
<a href="#l24.49"></a><span id="l24.49"> </span>
<a href="#l24.50"></a><span id="l24.50" class="difflineminus">-  nsCOMPtr&lt;nsILocalFile&gt; localFile;</span>
<a href="#l24.51"></a><span id="l24.51" class="difflineplus">+  nsCOMPtr&lt;nsIFile&gt; localFile;</span>
<a href="#l24.52"></a><span id="l24.52">   rv = filePicker-&gt;GetFile(getter_AddRefs(localFile));</span>
<a href="#l24.53"></a><span id="l24.53">   NS_ENSURE_SUCCESS(rv, rv);</span>
<a href="#l24.54"></a><span id="l24.54"> </span>
<a href="#l24.55"></a><span id="l24.55">   if (dialogResult == nsIFilePicker::returnReplace) {</span>
<a href="#l24.56"></a><span id="l24.56">     // be extra safe and only delete when the file is really a file</span>
<a href="#l24.57"></a><span id="l24.57">     bool isFile;</span>
<a href="#l24.58"></a><span id="l24.58">     rv = localFile-&gt;IsFile(&amp;isFile);</span>
<a href="#l24.59"></a><span id="l24.59">     if (NS_SUCCEEDED(rv) &amp;&amp; isFile) {</span>
<a href="#l24.60"></a><span id="l24.60" class="difflineat">@@ -605,17 +605,17 @@ NS_IMETHODIMP nsAbManager::ExportAddress</span>
<a href="#l24.61"></a><span id="l24.61">       rv = ExportDirectoryToDelimitedText(aDirectory, TAB_DELIM, TAB_DELIM_LEN, localFile);</span>
<a href="#l24.62"></a><span id="l24.62">       break;</span>
<a href="#l24.63"></a><span id="l24.63">   };</span>
<a href="#l24.64"></a><span id="l24.64"> </span>
<a href="#l24.65"></a><span id="l24.65">   return rv;</span>
<a href="#l24.66"></a><span id="l24.66"> }</span>
<a href="#l24.67"></a><span id="l24.67"> </span>
<a href="#l24.68"></a><span id="l24.68"> nsresult</span>
<a href="#l24.69"></a><span id="l24.69" class="difflineminus">-nsAbManager::ExportDirectoryToDelimitedText(nsIAbDirectory *aDirectory, const char *aDelim, PRUint32 aDelimLen, nsILocalFile *aLocalFile)</span>
<a href="#l24.70"></a><span id="l24.70" class="difflineplus">+nsAbManager::ExportDirectoryToDelimitedText(nsIAbDirectory *aDirectory, const char *aDelim, PRUint32 aDelimLen, nsIFile *aLocalFile)</span>
<a href="#l24.71"></a><span id="l24.71"> {</span>
<a href="#l24.72"></a><span id="l24.72">   nsCOMPtr &lt;nsISimpleEnumerator&gt; cardsEnumerator;</span>
<a href="#l24.73"></a><span id="l24.73">   nsCOMPtr &lt;nsIAbCard&gt; card;</span>
<a href="#l24.74"></a><span id="l24.74"> </span>
<a href="#l24.75"></a><span id="l24.75">   nsresult rv;</span>
<a href="#l24.76"></a><span id="l24.76"> </span>
<a href="#l24.77"></a><span id="l24.77">   nsCOMPtr &lt;nsIOutputStream&gt; outputStream;</span>
<a href="#l24.78"></a><span id="l24.78">   rv = MsgNewBufferedFileOutputStream(getter_AddRefs(outputStream),</span>
<a href="#l24.79"></a><span id="l24.79" class="difflineat">@@ -787,17 +787,17 @@ nsAbManager::ExportDirectoryToDelimitedT</span>
<a href="#l24.80"></a><span id="l24.80">   NS_ENSURE_SUCCESS(rv,rv);</span>
<a href="#l24.81"></a><span id="l24.81"> </span>
<a href="#l24.82"></a><span id="l24.82">   rv = outputStream-&gt;Close();</span>
<a href="#l24.83"></a><span id="l24.83">   NS_ENSURE_SUCCESS(rv,rv);</span>
<a href="#l24.84"></a><span id="l24.84">   return NS_OK;</span>
<a href="#l24.85"></a><span id="l24.85"> }</span>
<a href="#l24.86"></a><span id="l24.86"> </span>
<a href="#l24.87"></a><span id="l24.87"> nsresult</span>
<a href="#l24.88"></a><span id="l24.88" class="difflineminus">-nsAbManager::ExportDirectoryToLDIF(nsIAbDirectory *aDirectory, nsILocalFile *aLocalFile)</span>
<a href="#l24.89"></a><span id="l24.89" class="difflineplus">+nsAbManager::ExportDirectoryToLDIF(nsIAbDirectory *aDirectory, nsIFile *aLocalFile)</span>
<a href="#l24.90"></a><span id="l24.90"> {</span>
<a href="#l24.91"></a><span id="l24.91">   nsCOMPtr &lt;nsISimpleEnumerator&gt; cardsEnumerator;</span>
<a href="#l24.92"></a><span id="l24.92">   nsCOMPtr &lt;nsIAbCard&gt; card;</span>
<a href="#l24.93"></a><span id="l24.93"> </span>
<a href="#l24.94"></a><span id="l24.94">   nsresult rv;</span>
<a href="#l24.95"></a><span id="l24.95"> </span>
<a href="#l24.96"></a><span id="l24.96">   nsCOMPtr &lt;nsIOutputStream&gt; outputStream;</span>
<a href="#l24.97"></a><span id="l24.97">   rv = MsgNewBufferedFileOutputStream(getter_AddRefs(outputStream),</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l25.1"></a><span id="l25.1" class="difflineminus">--- a/mailnews/addrbook/src/nsAbManager.h</span>
<a href="#l25.2"></a><span id="l25.2" class="difflineplus">+++ b/mailnews/addrbook/src/nsAbManager.h</span>
<a href="#l25.3"></a><span id="l25.3" class="difflineat">@@ -30,18 +30,18 @@ public:</span>
<a href="#l25.4"></a><span id="l25.4">  	NS_DECL_NSIABMANAGER</span>
<a href="#l25.5"></a><span id="l25.5">   NS_DECL_NSIOBSERVER</span>
<a href="#l25.6"></a><span id="l25.6">   NS_DECL_NSICOMMANDLINEHANDLER</span>
<a href="#l25.7"></a><span id="l25.7"> </span>
<a href="#l25.8"></a><span id="l25.8">   nsresult Init();</span>
<a href="#l25.9"></a><span id="l25.9"> </span>
<a href="#l25.10"></a><span id="l25.10"> private:</span>
<a href="#l25.11"></a><span id="l25.11">   nsresult GetRootDirectory(nsIAbDirectory **aResult);</span>
<a href="#l25.12"></a><span id="l25.12" class="difflineminus">-  nsresult ExportDirectoryToDelimitedText(nsIAbDirectory *aDirectory, const char *aDelim, PRUint32 aDelimLen, nsILocalFile *aLocalFile);</span>
<a href="#l25.13"></a><span id="l25.13" class="difflineminus">-  nsresult ExportDirectoryToLDIF(nsIAbDirectory *aDirectory, nsILocalFile *aLocalFile);</span>
<a href="#l25.14"></a><span id="l25.14" class="difflineplus">+  nsresult ExportDirectoryToDelimitedText(nsIAbDirectory *aDirectory, const char *aDelim, PRUint32 aDelimLen, nsIFile *aLocalFile);</span>
<a href="#l25.15"></a><span id="l25.15" class="difflineplus">+  nsresult ExportDirectoryToLDIF(nsIAbDirectory *aDirectory, nsIFile *aLocalFile);</span>
<a href="#l25.16"></a><span id="l25.16">   nsresult AppendLDIFForMailList(nsIAbCard *aCard, nsIAbLDAPAttributeMap *aAttrMap, nsACString &amp;aResult);</span>
<a href="#l25.17"></a><span id="l25.17">   nsresult AppendDNForCard(const char *aProperty, nsIAbCard *aCard, nsIAbLDAPAttributeMap *aAttrMap, nsACString &amp;aResult);</span>
<a href="#l25.18"></a><span id="l25.18">   nsresult AppendBasicLDIFForCard(nsIAbCard *aCard, nsIAbLDAPAttributeMap *aAttrMap, nsACString &amp;aResult);</span>
<a href="#l25.19"></a><span id="l25.19">   nsresult AppendProperty(const char *aProperty, const PRUnichar *aValue, nsACString &amp;aResult);</span>
<a href="#l25.20"></a><span id="l25.20">   bool IsSafeLDIFString(const PRUnichar *aStr);</span>
<a href="#l25.21"></a><span id="l25.21"> </span>
<a href="#l25.22"></a><span id="l25.22">   struct abListener {</span>
<a href="#l25.23"></a><span id="l25.23">     nsCOMPtr&lt;nsIAbListener&gt; mListener;</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l26.1"></a><span id="l26.1" class="difflineminus">--- a/mailnews/addrbook/src/nsDirPrefs.cpp</span>
<a href="#l26.2"></a><span id="l26.2" class="difflineplus">+++ b/mailnews/addrbook/src/nsDirPrefs.cpp</span>
<a href="#l26.3"></a><span id="l26.3" class="difflineat">@@ -11,17 +11,17 @@</span>
<a href="#l26.4"></a><span id="l26.4"> #include &quot;nsIPrefLocalizedString.h&quot;</span>
<a href="#l26.5"></a><span id="l26.5"> #include &quot;nsIObserver.h&quot;</span>
<a href="#l26.6"></a><span id="l26.6"> #include &quot;nsVoidArray.h&quot;</span>
<a href="#l26.7"></a><span id="l26.7"> #include &quot;nsServiceManagerUtils.h&quot;</span>
<a href="#l26.8"></a><span id="l26.8"> #include &quot;nsMemory.h&quot;</span>
<a href="#l26.9"></a><span id="l26.9"> #include &quot;nsIAddrDatabase.h&quot;</span>
<a href="#l26.10"></a><span id="l26.10"> #include &quot;nsAbBaseCID.h&quot;</span>
<a href="#l26.11"></a><span id="l26.11"> #include &quot;nsIAbManager.h&quot;</span>
<a href="#l26.12"></a><span id="l26.12" class="difflineminus">-#include &quot;nsILocalFile.h&quot;</span>
<a href="#l26.13"></a><span id="l26.13" class="difflineplus">+#include &quot;nsIFile.h&quot;</span>
<a href="#l26.14"></a><span id="l26.14"> #include &quot;nsWeakReference.h&quot;</span>
<a href="#l26.15"></a><span id="l26.15"> #include &quot;nsIAbMDBDirectory.h&quot;</span>
<a href="#l26.16"></a><span id="l26.16"> #if defined(MOZ_LDAP_XPCOM)</span>
<a href="#l26.17"></a><span id="l26.17"> #include &quot;nsIAbLDAPDirectory.h&quot;</span>
<a href="#l26.18"></a><span id="l26.18"> #endif</span>
<a href="#l26.19"></a><span id="l26.19"> #include &quot;prmem.h&quot;</span>
<a href="#l26.20"></a><span id="l26.20"> #include &quot;prprf.h&quot;</span>
<a href="#l26.21"></a><span id="l26.21"> #include &quot;plstr.h&quot;</span>
<a href="#l26.22"></a><span id="l26.22" class="difflineat">@@ -612,17 +612,17 @@ static void DIR_DeleteServer(DIR_Server </span>
<a href="#l26.23"></a><span id="l26.23"> }</span>
<a href="#l26.24"></a><span id="l26.24"> </span>
<a href="#l26.25"></a><span id="l26.25"> nsresult DIR_DeleteServerFromList(DIR_Server *server)</span>
<a href="#l26.26"></a><span id="l26.26"> {</span>
<a href="#l26.27"></a><span id="l26.27">   if (!server)</span>
<a href="#l26.28"></a><span id="l26.28">     return NS_ERROR_NULL_POINTER;</span>
<a href="#l26.29"></a><span id="l26.29"> </span>
<a href="#l26.30"></a><span id="l26.30">   nsresult rv = NS_OK;</span>
<a href="#l26.31"></a><span id="l26.31" class="difflineminus">-  nsCOMPtr&lt;nsILocalFile&gt; dbPath;</span>
<a href="#l26.32"></a><span id="l26.32" class="difflineplus">+  nsCOMPtr&lt;nsIFile&gt; dbPath;</span>
<a href="#l26.33"></a><span id="l26.33"> </span>
<a href="#l26.34"></a><span id="l26.34">   nsCOMPtr&lt;nsIAbManager&gt; abManager = do_GetService(NS_ABMANAGER_CONTRACTID, &amp;rv); </span>
<a href="#l26.35"></a><span id="l26.35">   if (NS_SUCCEEDED(rv))</span>
<a href="#l26.36"></a><span id="l26.36">     rv = abManager-&gt;GetUserProfileDirectory(getter_AddRefs(dbPath));</span>
<a href="#l26.37"></a><span id="l26.37">   </span>
<a href="#l26.38"></a><span id="l26.38">   if (NS_SUCCEEDED(rv))</span>
<a href="#l26.39"></a><span id="l26.39">   {</span>
<a href="#l26.40"></a><span id="l26.40">     // close the database, as long as it isn't the special ones </span>
<a href="#l26.41"></a><span id="l26.41" class="difflineat">@@ -895,17 +895,17 @@ static void DIR_ConvertServerFileName(DI</span>
<a href="#l26.42"></a><span id="l26.42">  * string.</span>
<a href="#l26.43"></a><span id="l26.43">  */</span>
<a href="#l26.44"></a><span id="l26.44"> void DIR_SetFileName(char** fileName, const char* defaultName)</span>
<a href="#l26.45"></a><span id="l26.45"> {</span>
<a href="#l26.46"></a><span id="l26.46">   if (!fileName)</span>
<a href="#l26.47"></a><span id="l26.47">     return;</span>
<a href="#l26.48"></a><span id="l26.48"> </span>
<a href="#l26.49"></a><span id="l26.49">   nsresult rv = NS_OK;</span>
<a href="#l26.50"></a><span id="l26.50" class="difflineminus">-  nsCOMPtr&lt;nsILocalFile&gt; dbPath;</span>
<a href="#l26.51"></a><span id="l26.51" class="difflineplus">+  nsCOMPtr&lt;nsIFile&gt; dbPath;</span>
<a href="#l26.52"></a><span id="l26.52"> </span>
<a href="#l26.53"></a><span id="l26.53">   *fileName = nsnull;</span>
<a href="#l26.54"></a><span id="l26.54"> </span>
<a href="#l26.55"></a><span id="l26.55">   nsCOMPtr&lt;nsIAbManager&gt; abManager = do_GetService(NS_ABMANAGER_CONTRACTID, &amp;rv); </span>
<a href="#l26.56"></a><span id="l26.56">   if (NS_SUCCEEDED(rv))</span>
<a href="#l26.57"></a><span id="l26.57">     rv = abManager-&gt;GetUserProfileDirectory(getter_AddRefs(dbPath));</span>
<a href="#l26.58"></a><span id="l26.58">   if (NS_SUCCEEDED(rv))</span>
<a href="#l26.59"></a><span id="l26.59">   {</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l27.1"></a><span id="l27.1" class="difflineminus">--- a/mailnews/base/public/nsIMessenger.idl</span>
<a href="#l27.2"></a><span id="l27.2" class="difflineplus">+++ b/mailnews/base/public/nsIMessenger.idl</span>
<a href="#l27.3"></a><span id="l27.3" class="difflineat">@@ -110,17 +110,17 @@ interface nsIMessenger : nsISupports {</span>
<a href="#l27.4"></a><span id="l27.4">                                     in nsIUrlListener aListener);</span>
<a href="#l27.5"></a><span id="l27.5"> </span>
<a href="#l27.6"></a><span id="l27.6">     void detachAttachment(in string contentTpe, in string url, in string displayName, in string messageUri, in boolean saveFirst, [optional] in boolean withoutWarning);</span>
<a href="#l27.7"></a><span id="l27.7">     void detachAllAttachments(in unsigned long count, [array, size_is(count)] in string contentTypeArray,</span>
<a href="#l27.8"></a><span id="l27.8">                              [array, size_is(count)] in string urlArray, [array, size_is(count)] in string displayNameArray,</span>
<a href="#l27.9"></a><span id="l27.9">                              [array, size_is(count)] in string messageUriArray, in boolean saveFirst, [optional] in boolean withoutWarning);</span>
<a href="#l27.10"></a><span id="l27.10">     // saveAttachmentToFolder is used by the drag and drop code to drop an attachment to a destination folder</span>
<a href="#l27.11"></a><span id="l27.11">     // We need to return the actual file path (including the filename).</span>
<a href="#l27.12"></a><span id="l27.12" class="difflineminus">-    nsILocalFile saveAttachmentToFolder(in ACString contentType, in ACString url, in ACString displayName, in ACString messageUri, in nsILocalFile aDestFolder);</span>
<a href="#l27.13"></a><span id="l27.13" class="difflineplus">+    nsIFile saveAttachmentToFolder(in ACString contentType, in ACString url, in ACString displayName, in ACString messageUri, in nsIFile aDestFolder);</span>
<a href="#l27.14"></a><span id="l27.14"> </span>
<a href="#l27.15"></a><span id="l27.15">     readonly attribute ACString lastDisplayedMessageUri;</span>
<a href="#l27.16"></a><span id="l27.16"> </span>
<a href="#l27.17"></a><span id="l27.17">     nsIMsgMessageService messageServiceFromURI(in ACString aUri);</span>
<a href="#l27.18"></a><span id="l27.18">     nsIMsgDBHdr msgHdrFromURI(in ACString aUri);</span>
<a href="#l27.19"></a><span id="l27.19">     // For back forward history, we need a list of visited messages,</span>
<a href="#l27.20"></a><span id="l27.20">     // and where we are in the list.</span>
<a href="#l27.21"></a><span id="l27.21">     </span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l28.1"></a><span id="l28.1" class="difflineminus">--- a/mailnews/base/public/nsIMsgAccountManager.idl</span>
<a href="#l28.2"></a><span id="l28.2" class="difflineplus">+++ b/mailnews/base/public/nsIMsgAccountManager.idl</span>
<a href="#l28.3"></a><span id="l28.3" class="difflineat">@@ -207,17 +207,17 @@ interface nsIMsgAccountManager : nsISupp</span>
<a href="#l28.4"></a><span id="l28.4">   /**</span>
<a href="#l28.5"></a><span id="l28.5">    * Iterates over all folders looking for one with the passed in path,</span>
<a href="#l28.6"></a><span id="l28.6">    * and returns the uri for the matching folder. In the future,</span>
<a href="#l28.7"></a><span id="l28.7">    * the folder lookup service will provide this functionality.</span>
<a href="#l28.8"></a><span id="l28.8">    *</span>
<a href="#l28.9"></a><span id="l28.9">    * @param aLocalPath path of the folder whose uri we want.</span>
<a href="#l28.10"></a><span id="l28.10">    * @return the URI of the folder that corresponds to aLocalPath</span>
<a href="#l28.11"></a><span id="l28.11">    */</span>
<a href="#l28.12"></a><span id="l28.12" class="difflineminus">-  ACString folderUriForPath(in nsILocalFile aLocalPath);</span>
<a href="#l28.13"></a><span id="l28.13" class="difflineplus">+  ACString folderUriForPath(in nsIFile aLocalPath);</span>
<a href="#l28.14"></a><span id="l28.14"> };</span>
<a href="#l28.15"></a><span id="l28.15"> </span>
<a href="#l28.16"></a><span id="l28.16"> %{C++</span>
<a href="#l28.17"></a><span id="l28.17"> #define MAILNEWS_ACCOUNTMANAGER_EXTENSIONS &quot;mailnews-accountmanager-extensions&quot;</span>
<a href="#l28.18"></a><span id="l28.18"> %}</span>
<a href="#l28.19"></a><span id="l28.19"> </span>
<a href="#l28.20"></a><span id="l28.20"> [scriptable, uuid(70032DE0-CD59-41ba-839D-FC1B65367EE7)]</span>
<a href="#l28.21"></a><span id="l28.21"> interface nsIMsgAccountManagerExtension : nsISupports</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l29.1"></a><span id="l29.1" class="difflineminus">--- a/mailnews/base/public/nsIMsgFolder.idl</span>
<a href="#l29.2"></a><span id="l29.2" class="difflineplus">+++ b/mailnews/base/public/nsIMsgFolder.idl</span>
<a href="#l29.3"></a><span id="l29.3" class="difflineat">@@ -17,17 +17,17 @@ interface nsIMsgDatabase;</span>
<a href="#l29.4"></a><span id="l29.4"> interface nsIDBFolderInfo;</span>
<a href="#l29.5"></a><span id="l29.5"> interface nsIMsgFilterList;</span>
<a href="#l29.6"></a><span id="l29.6"> </span>
<a href="#l29.7"></a><span id="l29.7"> interface nsIMsgFolderCacheElement;</span>
<a href="#l29.8"></a><span id="l29.8"> interface nsITransport;</span>
<a href="#l29.9"></a><span id="l29.9"> interface nsIFile;</span>
<a href="#l29.10"></a><span id="l29.10"> interface nsIOutputStream;</span>
<a href="#l29.11"></a><span id="l29.11"> interface nsIInputStream;</span>
<a href="#l29.12"></a><span id="l29.12" class="difflineminus">-interface nsILocalFile;</span>
<a href="#l29.13"></a><span id="l29.13" class="difflineplus">+interface nsIFile;</span>
<a href="#l29.14"></a><span id="l29.14"> interface nsIMsgIdentity;</span>
<a href="#l29.15"></a><span id="l29.15"> interface nsIArray;</span>
<a href="#l29.16"></a><span id="l29.16"> interface nsIMutableArray;</span>
<a href="#l29.17"></a><span id="l29.17"> interface nsISupportsArray;</span>
<a href="#l29.18"></a><span id="l29.18"> interface nsIMsgPluggableStore;</span>
<a href="#l29.19"></a><span id="l29.19"> </span>
<a href="#l29.20"></a><span id="l29.20"> typedef long nsMsgBiffState;</span>
<a href="#l29.21"></a><span id="l29.21"> </span>
<a href="#l29.22"></a><span id="l29.22" class="difflineat">@@ -460,17 +460,17 @@ interface nsIMsgFolder : nsISupports {</span>
<a href="#l29.23"></a><span id="l29.23">   /**</span>
<a href="#l29.24"></a><span id="l29.24">    * are we running a url as a result of the user clicking get msg?</span>
<a href="#l29.25"></a><span id="l29.25">    */</span>
<a href="#l29.26"></a><span id="l29.26">   attribute boolean gettingNewMessages;</span>
<a href="#l29.27"></a><span id="l29.27"> </span>
<a href="#l29.28"></a><span id="l29.28">   /**</span>
<a href="#l29.29"></a><span id="l29.29">    * local path of this folder</span>
<a href="#l29.30"></a><span id="l29.30">    */</span>
<a href="#l29.31"></a><span id="l29.31" class="difflineminus">-  attribute nsILocalFile filePath;</span>
<a href="#l29.32"></a><span id="l29.32" class="difflineplus">+  attribute nsIFile filePath;</span>
<a href="#l29.33"></a><span id="l29.33"> </span>
<a href="#l29.34"></a><span id="l29.34">   readonly attribute ACString baseMessageURI;</span>
<a href="#l29.35"></a><span id="l29.35">   ACString generateMessageURI(in nsMsgKey msgKey);</span>
<a href="#l29.36"></a><span id="l29.36"> </span>
<a href="#l29.37"></a><span id="l29.37">   const nsMsgDispositionState nsMsgDispositionState_None = -1;</span>
<a href="#l29.38"></a><span id="l29.38">   const nsMsgDispositionState nsMsgDispositionState_Replied = 0;</span>
<a href="#l29.39"></a><span id="l29.39">   const nsMsgDispositionState nsMsgDispositionState_Forwarded = 1;</span>
<a href="#l29.40"></a><span id="l29.40">   void addMessageDispositionState(in nsIMsgDBHdr aMessage,</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l30.1"></a><span id="l30.1" class="difflineminus">--- a/mailnews/base/public/nsIMsgIdentity.idl</span>
<a href="#l30.2"></a><span id="l30.2" class="difflineplus">+++ b/mailnews/base/public/nsIMsgIdentity.idl</span>
<a href="#l30.3"></a><span id="l30.3" class="difflineat">@@ -1,15 +1,15 @@</span>
<a href="#l30.4"></a><span id="l30.4"> /* -*- Mode: IDL; tab-width: 4; indent-tabs-mode: nil; c-basic-offset: 2 -*- */</span>
<a href="#l30.5"></a><span id="l30.5"> /* This Source Code Form is subject to the terms of the Mozilla Public</span>
<a href="#l30.6"></a><span id="l30.6">  * License, v. 2.0. If a copy of the MPL was not distributed with this</span>
<a href="#l30.7"></a><span id="l30.7">  * file, You can obtain one at http://mozilla.org/MPL/2.0/. */</span>
<a href="#l30.8"></a><span id="l30.8"> </span>
<a href="#l30.9"></a><span id="l30.9"> #include &quot;nsISupports.idl&quot;</span>
<a href="#l30.10"></a><span id="l30.10" class="difflineminus">-#include &quot;nsILocalFile.idl&quot;</span>
<a href="#l30.11"></a><span id="l30.11" class="difflineplus">+#include &quot;nsIFile.idl&quot;</span>
<a href="#l30.12"></a><span id="l30.12"> </span>
<a href="#l30.13"></a><span id="l30.13"> /**</span>
<a href="#l30.14"></a><span id="l30.14">  * This interface contains all the personal outgoing mail information</span>
<a href="#l30.15"></a><span id="l30.15">  * for a given person.</span>
<a href="#l30.16"></a><span id="l30.16">  * Each identity is identified by a key, which is the &lt;id&gt; string in</span>
<a href="#l30.17"></a><span id="l30.17">  * the identity preferences, such as in mail.identity.&lt;id&gt;.replyTo.</span>
<a href="#l30.18"></a><span id="l30.18">  */</span>
<a href="#l30.19"></a><span id="l30.19"> [scriptable, uuid(4a769f39-f8c2-41e6-962a-175a33107578)]</span>
<a href="#l30.20"></a><span id="l30.20" class="difflineat">@@ -84,17 +84,17 @@ interface nsIMsgIdentity : nsISupports {</span>
<a href="#l30.21"></a><span id="l30.21">   /**</span>
<a href="#l30.22"></a><span id="l30.22">    * Include a signature when replying to a message?</span>
<a href="#l30.23"></a><span id="l30.23">    */</span>
<a href="#l30.24"></a><span id="l30.24">   attribute boolean sigOnReply;</span>
<a href="#l30.25"></a><span id="l30.25"> </span>
<a href="#l30.26"></a><span id="l30.26">   /**</span>
<a href="#l30.27"></a><span id="l30.27">    * The current signature file.</span>
<a href="#l30.28"></a><span id="l30.28">    */</span>
<a href="#l30.29"></a><span id="l30.29" class="difflineminus">-  attribute nsILocalFile signature;</span>
<a href="#l30.30"></a><span id="l30.30" class="difflineplus">+  attribute nsIFile signature;</span>
<a href="#l30.31"></a><span id="l30.31"> </span>
<a href="#l30.32"></a><span id="l30.32">   /**</span>
<a href="#l30.33"></a><span id="l30.33">    * Modification time of the signature file.</span>
<a href="#l30.34"></a><span id="l30.34">    */</span>
<a href="#l30.35"></a><span id="l30.35">   attribute long signatureDate;</span>
<a href="#l30.36"></a><span id="l30.36"> </span>
<a href="#l30.37"></a><span id="l30.37">   /**</span>
<a href="#l30.38"></a><span id="l30.38">    * Signature text if not read from file; format depends on htmlSigFormat.</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l31.1"></a><span id="l31.1" class="difflineminus">--- a/mailnews/base/public/nsIMsgIncomingServer.idl</span>
<a href="#l31.2"></a><span id="l31.2" class="difflineplus">+++ b/mailnews/base/public/nsIMsgIncomingServer.idl</span>
<a href="#l31.3"></a><span id="l31.3" class="difflineat">@@ -11,17 +11,17 @@ interface nsIMsgFolderCache;</span>
<a href="#l31.4"></a><span id="l31.4"> interface nsIMsgWindow;</span>
<a href="#l31.5"></a><span id="l31.5"> interface nsIMsgFilterList;</span>
<a href="#l31.6"></a><span id="l31.6"> interface nsIMsgRetentionSettings;</span>
<a href="#l31.7"></a><span id="l31.7"> interface nsIMsgDownloadSettings;</span>
<a href="#l31.8"></a><span id="l31.8"> interface nsISpamSettings;</span>
<a href="#l31.9"></a><span id="l31.9"> interface nsIMsgFilterPlugin;</span>
<a href="#l31.10"></a><span id="l31.10"> interface nsIUrlListener;</span>
<a href="#l31.11"></a><span id="l31.11"> interface nsIMsgDBHdr;</span>
<a href="#l31.12"></a><span id="l31.12" class="difflineminus">-interface nsILocalFile;</span>
<a href="#l31.13"></a><span id="l31.13" class="difflineplus">+interface nsIFile;</span>
<a href="#l31.14"></a><span id="l31.14"> interface nsIURI;</span>
<a href="#l31.15"></a><span id="l31.15"> interface nsIMsgPluggableStore;</span>
<a href="#l31.16"></a><span id="l31.16"> </span>
<a href="#l31.17"></a><span id="l31.17"> /*</span>
<a href="#l31.18"></a><span id="l31.18">  * Interface for incoming mail/news host</span>
<a href="#l31.19"></a><span id="l31.19">  * this is the base interface for all mail server types (imap, pop, nntp, etc)</span>
<a href="#l31.20"></a><span id="l31.20">  * often you will want to add extra interfaces that give you server-specific</span>
<a href="#l31.21"></a><span id="l31.21">  * attributes and methods.</span>
<a href="#l31.22"></a><span id="l31.22" class="difflineat">@@ -127,17 +127,17 @@ interface nsIMsgIncomingServer : nsISupp</span>
<a href="#l31.23"></a><span id="l31.23"> </span>
<a href="#l31.24"></a><span id="l31.24">   /* current biff state */</span>
<a href="#l31.25"></a><span id="l31.25">   attribute unsigned long biffState;</span>
<a href="#l31.26"></a><span id="l31.26"> </span>
<a href="#l31.27"></a><span id="l31.27">   /* are we running a url as a result of biff going off? (different from user clicking get msg) */</span>
<a href="#l31.28"></a><span id="l31.28">   attribute boolean performingBiff; </span>
<a href="#l31.29"></a><span id="l31.29"> </span>
<a href="#l31.30"></a><span id="l31.30">   /* the on-disk path to message storage for this server */</span>
<a href="#l31.31"></a><span id="l31.31" class="difflineminus">-  attribute nsILocalFile localPath;</span>
<a href="#l31.32"></a><span id="l31.32" class="difflineplus">+  attribute nsIFile localPath;</span>
<a href="#l31.33"></a><span id="l31.33"> </span>
<a href="#l31.34"></a><span id="l31.34">   /// message store to use for the folders under this server.</span>
<a href="#l31.35"></a><span id="l31.35">   readonly attribute nsIMsgPluggableStore msgStore;</span>
<a href="#l31.36"></a><span id="l31.36"> </span>
<a href="#l31.37"></a><span id="l31.37">   /* the RDF URI for the root mail folder */</span>
<a href="#l31.38"></a><span id="l31.38">   readonly attribute ACString serverURI;</span>
<a href="#l31.39"></a><span id="l31.39"> </span>
<a href="#l31.40"></a><span id="l31.40">   /* the root folder for this server, even if server is deferred */</span>
<a href="#l31.41"></a><span id="l31.41" class="difflineat">@@ -220,17 +220,17 @@ interface nsIMsgIncomingServer : nsISupp</span>
<a href="#l31.42"></a><span id="l31.42">    * @see getEditableFilterList</span>
<a href="#l31.43"></a><span id="l31.43">    * @see setFilterList</span>
<a href="#l31.44"></a><span id="l31.44">    *</span>
<a href="#l31.45"></a><span id="l31.45">    * @param aFilterList The new list of filters.</span>
<a href="#l31.46"></a><span id="l31.46">    */</span>
<a href="#l31.47"></a><span id="l31.47">   void setEditableFilterList(in nsIMsgFilterList aFilterList);</span>
<a href="#l31.48"></a><span id="l31.48"> </span>
<a href="#l31.49"></a><span id="l31.49">   /* we use this to set the default local path.  we use this when migrating prefs */</span>
<a href="#l31.50"></a><span id="l31.50" class="difflineminus">-  void setDefaultLocalPath(in nsILocalFile aDefaultLocalPath);</span>
<a href="#l31.51"></a><span id="l31.51" class="difflineplus">+  void setDefaultLocalPath(in nsIFile aDefaultLocalPath);</span>
<a href="#l31.52"></a><span id="l31.52"> </span>
<a href="#l31.53"></a><span id="l31.53">   /**</span>
<a href="#l31.54"></a><span id="l31.54">    * Verify that we can logon</span>
<a href="#l31.55"></a><span id="l31.55">    * </span>
<a href="#l31.56"></a><span id="l31.56">    * @param  aUrlListener - gets called back with success or failure.</span>
<a href="#l31.57"></a><span id="l31.57">    * @param aMsgWindow         nsIMsgWindow to use for notification callbacks.</span>
<a href="#l31.58"></a><span id="l31.58">    * @return - the url that we run.</span>
<a href="#l31.59"></a><span id="l31.59">    */</span>
<a href="#l31.60"></a><span id="l31.60" class="difflineat">@@ -306,18 +306,18 @@ interface nsIMsgIncomingServer : nsISupp</span>
<a href="#l31.61"></a><span id="l31.61">    * parameter. Callers must still provide a valid value, though.</span>
<a href="#l31.62"></a><span id="l31.62">    *</span>
<a href="#l31.63"></a><span id="l31.63">    * @param relpref The name of the relative file preference.</span>
<a href="#l31.64"></a><span id="l31.64">    * @param absref  The name of the absolute file preference.</span>
<a href="#l31.65"></a><span id="l31.65">    * @param aValue  The value of the preference to set.</span>
<a href="#l31.66"></a><span id="l31.66">    * @return        The value of the preference.</span>
<a href="#l31.67"></a><span id="l31.67">    * @{</span>
<a href="#l31.68"></a><span id="l31.68">    */</span>
<a href="#l31.69"></a><span id="l31.69" class="difflineminus">-  nsILocalFile getFileValue(in string relpref, in string abspref);</span>
<a href="#l31.70"></a><span id="l31.70" class="difflineminus">-  void setFileValue(in string relpref, in string abspref, in nsILocalFile aValue);</span>
<a href="#l31.71"></a><span id="l31.71" class="difflineplus">+  nsIFile getFileValue(in string relpref, in string abspref);</span>
<a href="#l31.72"></a><span id="l31.72" class="difflineplus">+  void setFileValue(in string relpref, in string abspref, in nsIFile aValue);</span>
<a href="#l31.73"></a><span id="l31.73">   /** @} */</span>
<a href="#l31.74"></a><span id="l31.74"> </span>
<a href="#l31.75"></a><span id="l31.75">   /**</span>
<a href="#l31.76"></a><span id="l31.76">    * this is really dangerous. this destroys all pref values</span>
<a href="#l31.77"></a><span id="l31.77">    * do not call this unless you know what you're doing!</span>
<a href="#l31.78"></a><span id="l31.78">    */</span>
<a href="#l31.79"></a><span id="l31.79">   void clearAllValues();</span>
<a href="#l31.80"></a><span id="l31.80"> </span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l32.1"></a><span id="l32.1" class="difflineminus">--- a/mailnews/base/public/nsIMsgPluggableStore.idl</span>
<a href="#l32.2"></a><span id="l32.2" class="difflineplus">+++ b/mailnews/base/public/nsIMsgPluggableStore.idl</span>
<a href="#l32.3"></a><span id="l32.3" class="difflineat">@@ -1,16 +1,16 @@</span>
<a href="#l32.4"></a><span id="l32.4"> /* -*- Mode: C++; tab-width: 4; indent-tabs-mode: nil; c-basic-offset: 4 -*- */</span>
<a href="#l32.5"></a><span id="l32.5"> /* This Source Code Form is subject to the terms of the Mozilla Public</span>
<a href="#l32.6"></a><span id="l32.6">  * License, v. 2.0. If a copy of the MPL was not distributed with this</span>
<a href="#l32.7"></a><span id="l32.7">  * file, You can obtain one at http://mozilla.org/MPL/2.0/. */</span>
<a href="#l32.8"></a><span id="l32.8"> </span>
<a href="#l32.9"></a><span id="l32.9"> #include &quot;nsISupports.idl&quot;</span>
<a href="#l32.10"></a><span id="l32.10"> </span>
<a href="#l32.11"></a><span id="l32.11" class="difflineminus">-interface nsILocalFile;</span>
<a href="#l32.12"></a><span id="l32.12" class="difflineplus">+interface nsIFile;</span>
<a href="#l32.13"></a><span id="l32.13"> interface nsIMsgFolder;</span>
<a href="#l32.14"></a><span id="l32.14"> interface nsIMsgCopyServiceListener;</span>
<a href="#l32.15"></a><span id="l32.15"> interface nsIMsgDBHdr;</span>
<a href="#l32.16"></a><span id="l32.16"> interface nsIMsgWindow;</span>
<a href="#l32.17"></a><span id="l32.17"> interface nsISimpleEnumerator;</span>
<a href="#l32.18"></a><span id="l32.18"> interface nsIOutputStream;</span>
<a href="#l32.19"></a><span id="l32.19"> interface nsIInputStream;</span>
<a href="#l32.20"></a><span id="l32.20"> interface nsIArray;</span>
<a href="#l32.21"></a><span id="l32.21" class="difflineat">@@ -48,23 +48,23 @@ interface nsIMsgPluggableStore : nsISupp</span>
<a href="#l32.22"></a><span id="l32.22">    * @param aFolderName leaf name of folder.</span>
<a href="#l32.23"></a><span id="l32.23">    * @return newly created folder.</span>
<a href="#l32.24"></a><span id="l32.24">    * @exception NS_MSG_FOLDER_EXISTS If the child exists.</span>
<a href="#l32.25"></a><span id="l32.25">    * @exception NS_MSG_CANT_CREATE_FOLDER for other errors.</span>
<a href="#l32.26"></a><span id="l32.26">    */</span>
<a href="#l32.27"></a><span id="l32.27">   nsIMsgFolder createFolder(in nsIMsgFolder aParent, in AString aFolderName);</span>
<a href="#l32.28"></a><span id="l32.28"> </span>
<a href="#l32.29"></a><span id="l32.29">   /**</span>
<a href="#l32.30"></a><span id="l32.30" class="difflineminus">-   * Get an nsILocalFile corresponding to the .msf file. This allows stores</span>
<a href="#l32.31"></a><span id="l32.31" class="difflineplus">+   * Get an nsIFile corresponding to the .msf file. This allows stores</span>
<a href="#l32.32"></a><span id="l32.32">    * to put the .msf files where they want.</span>
<a href="#l32.33"></a><span id="l32.33">    *</span>
<a href="#l32.34"></a><span id="l32.34">    * @param aFolder folder we want summary file for</span>
<a href="#l32.35"></a><span id="l32.35">    * @return summary file</span>
<a href="#l32.36"></a><span id="l32.36">    */</span>
<a href="#l32.37"></a><span id="l32.37" class="difflineminus">-  nsILocalFile getSummaryFile(in nsIMsgFolder aFolder);</span>
<a href="#l32.38"></a><span id="l32.38" class="difflineplus">+  nsIFile getSummaryFile(in nsIMsgFolder aFolder);</span>
<a href="#l32.39"></a><span id="l32.39"> </span>
<a href="#l32.40"></a><span id="l32.40">   /**</span>
<a href="#l32.41"></a><span id="l32.41">    * Delete the passed in folder. This is a real delete, not a move</span>
<a href="#l32.42"></a><span id="l32.42">    * to the trash folder.</span>
<a href="#l32.43"></a><span id="l32.43">    *</span>
<a href="#l32.44"></a><span id="l32.44">    * @param aFolder folder to delete</span>
<a href="#l32.45"></a><span id="l32.45">    */</span>
<a href="#l32.46"></a><span id="l32.46">   void deleteFolder(in nsIMsgFolder aFolder);</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l33.1"></a><span id="l33.1" class="difflineminus">--- a/mailnews/base/public/nsIMsgProtocolInfo.idl</span>
<a href="#l33.2"></a><span id="l33.2" class="difflineplus">+++ b/mailnews/base/public/nsIMsgProtocolInfo.idl</span>
<a href="#l33.3"></a><span id="l33.3" class="difflineat">@@ -1,31 +1,31 @@</span>
<a href="#l33.4"></a><span id="l33.4"> /* -*- Mode: IDL; tab-width: 4; indent-tabs-mode: nil; c-basic-offset: 4 -*- */</span>
<a href="#l33.5"></a><span id="l33.5"> /* This Source Code Form is subject to the terms of the Mozilla Public</span>
<a href="#l33.6"></a><span id="l33.6">  * License, v. 2.0. If a copy of the MPL was not distributed with this</span>
<a href="#l33.7"></a><span id="l33.7">  * file, You can obtain one at http://mozilla.org/MPL/2.0/. */</span>
<a href="#l33.8"></a><span id="l33.8"> </span>
<a href="#l33.9"></a><span id="l33.9"> #include &quot;nsISupports.idl&quot;</span>
<a href="#l33.10"></a><span id="l33.10"> </span>
<a href="#l33.11"></a><span id="l33.11" class="difflineminus">-interface nsILocalFile;</span>
<a href="#l33.12"></a><span id="l33.12" class="difflineplus">+interface nsIFile;</span>
<a href="#l33.13"></a><span id="l33.13"> </span>
<a href="#l33.14"></a><span id="l33.14"> %{C++</span>
<a href="#l33.15"></a><span id="l33.15"> #define NS_MSGPROTOCOLINFO_CONTRACTID_PREFIX \</span>
<a href="#l33.16"></a><span id="l33.16">   &quot;@mozilla.org/messenger/protocol/info;1?type=&quot;</span>
<a href="#l33.17"></a><span id="l33.17"> %}</span>
<a href="#l33.18"></a><span id="l33.18"> </span>
<a href="#l33.19"></a><span id="l33.19"> </span>
<a href="#l33.20"></a><span id="l33.20"> [scriptable, uuid(9428b5f5-8b12-493c-aae2-18296c2877b0)]</span>
<a href="#l33.21"></a><span id="l33.21"> interface nsIMsgProtocolInfo : nsISupports</span>
<a href="#l33.22"></a><span id="l33.22"> {</span>
<a href="#l33.23"></a><span id="l33.23">     /**</span>
<a href="#l33.24"></a><span id="l33.24">      * the default path to store local data for this type of</span>
<a href="#l33.25"></a><span id="l33.25">      * server. Each server is usually in a subdirectory below this</span>
<a href="#l33.26"></a><span id="l33.26">      */</span>
<a href="#l33.27"></a><span id="l33.27" class="difflineminus">-    attribute nsILocalFile defaultLocalPath;</span>
<a href="#l33.28"></a><span id="l33.28" class="difflineplus">+    attribute nsIFile defaultLocalPath;</span>
<a href="#l33.29"></a><span id="l33.29"> </span>
<a href="#l33.30"></a><span id="l33.30">     /**</span>
<a href="#l33.31"></a><span id="l33.31">      * the IID of the protocol-specific interface for this server</span>
<a href="#l33.32"></a><span id="l33.32">      * usually used from JS to dynamically get server-specific attributes</span>
<a href="#l33.33"></a><span id="l33.33">      */</span>
<a href="#l33.34"></a><span id="l33.34">     readonly attribute nsIIDPtr serverIID;</span>
<a href="#l33.35"></a><span id="l33.35"> </span>
<a href="#l33.36"></a><span id="l33.36">     /**</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l34.1"></a><span id="l34.1" class="difflineminus">--- a/mailnews/base/search/public/nsIMsgFilterList.idl</span>
<a href="#l34.2"></a><span id="l34.2" class="difflineplus">+++ b/mailnews/base/search/public/nsIMsgFilterList.idl</span>
<a href="#l34.3"></a><span id="l34.3" class="difflineat">@@ -59,17 +59,17 @@ interface nsIMsgFilterList : nsISupports</span>
<a href="#l34.4"></a><span id="l34.4">     nsIMsgFilter createFilter(in AString name);</span>
<a href="#l34.5"></a><span id="l34.5"> </span>
<a href="#l34.6"></a><span id="l34.6">     void saveToFile(in nsIOutputStream stream);</span>
<a href="#l34.7"></a><span id="l34.7"> </span>
<a href="#l34.8"></a><span id="l34.8">     void parseCondition(in nsIMsgFilter aFilter, in string condition);</span>
<a href="#l34.9"></a><span id="l34.9">     // this is temporary so that we can save the filterlist to disk</span>
<a href="#l34.10"></a><span id="l34.10">     // without knowing where the filters were read from intially</span>
<a href="#l34.11"></a><span id="l34.11">     // (such as the filter list dialog)</span>
<a href="#l34.12"></a><span id="l34.12" class="difflineminus">-    attribute nsILocalFile defaultFile;</span>
<a href="#l34.13"></a><span id="l34.13" class="difflineplus">+    attribute nsIFile defaultFile;</span>
<a href="#l34.14"></a><span id="l34.14">     void saveToDefaultFile();</span>
<a href="#l34.15"></a><span id="l34.15">     </span>
<a href="#l34.16"></a><span id="l34.16"> </span>
<a href="#l34.17"></a><span id="l34.17">     // marking noscript because headers is a null-separated list</span>
<a href="#l34.18"></a><span id="l34.18">     // of strings, which is not scriptable</span>
<a href="#l34.19"></a><span id="l34.19">     [noscript]</span>
<a href="#l34.20"></a><span id="l34.20">     void applyFiltersToHdr(in nsMsgFilterTypeType filterType,</span>
<a href="#l34.21"></a><span id="l34.21">                            in nsIMsgDBHdr msgHdr,</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l35.1"></a><span id="l35.1" class="difflineminus">--- a/mailnews/base/search/public/nsIMsgFilterPlugin.idl</span>
<a href="#l35.2"></a><span id="l35.2" class="difflineplus">+++ b/mailnews/base/search/public/nsIMsgFilterPlugin.idl</span>
<a href="#l35.3"></a><span id="l35.3" class="difflineat">@@ -6,17 +6,17 @@</span>
<a href="#l35.4"></a><span id="l35.4"> </span>
<a href="#l35.5"></a><span id="l35.5"> #include &quot;nsISupports.idl&quot;</span>
<a href="#l35.6"></a><span id="l35.6"> #include &quot;MailNewsTypes2.idl&quot;</span>
<a href="#l35.7"></a><span id="l35.7"> </span>
<a href="#l35.8"></a><span id="l35.8"> interface nsIMsgFilterHitNotify;</span>
<a href="#l35.9"></a><span id="l35.9"> interface nsIMsgWindow;</span>
<a href="#l35.10"></a><span id="l35.10"> interface nsIMsgDBHdr;</span>
<a href="#l35.11"></a><span id="l35.11"> interface nsIStreamListener;</span>
<a href="#l35.12"></a><span id="l35.12" class="difflineminus">-interface nsILocalFile;</span>
<a href="#l35.13"></a><span id="l35.13" class="difflineplus">+interface nsIFile;</span>
<a href="#l35.14"></a><span id="l35.14"> </span>
<a href="#l35.15"></a><span id="l35.15"> /**</span>
<a href="#l35.16"></a><span id="l35.16">  * This interface is still very much under development, and is not yet stable.</span>
<a href="#l35.17"></a><span id="l35.17">  */</span>
<a href="#l35.18"></a><span id="l35.18"> </span>
<a href="#l35.19"></a><span id="l35.19"> [scriptable, uuid(e2e56690-a676-11d6-80c9-00008646b737)]</span>
<a href="#l35.20"></a><span id="l35.20"> interface nsIMsgFilterPlugin : nsISupports</span>
<a href="#l35.21"></a><span id="l35.21"> {</span>
<a href="#l35.22"></a><span id="l35.22" class="difflineat">@@ -318,17 +318,17 @@ interface nsIMsgCorpus : nsISupports</span>
<a href="#l35.23"></a><span id="l35.23">    * @param aFromTraits array of trait ids used in aFile. If aFile contains</span>
<a href="#l35.24"></a><span id="l35.24">    *                    trait ids that are not in this array, they are not</span>
<a href="#l35.25"></a><span id="l35.25">    *                    remapped, but assummed to be local trait ids.</span>
<a href="#l35.26"></a><span id="l35.26">    *</span>
<a href="#l35.27"></a><span id="l35.27">    * @param aToTraits   array of trait ids, corresponding to elements of</span>
<a href="#l35.28"></a><span id="l35.28">    *                    aFromTraits, that represent the local trait ids to</span>
<a href="#l35.29"></a><span id="l35.29">    *                    be used in storing data from aFile into the local corpus.</span>
<a href="#l35.30"></a><span id="l35.30">    */</span>
<a href="#l35.31"></a><span id="l35.31" class="difflineminus">-  void updateData(in nsILocalFile aFile, in boolean aIsAdd,</span>
<a href="#l35.32"></a><span id="l35.32" class="difflineplus">+  void updateData(in nsIFile aFile, in boolean aIsAdd,</span>
<a href="#l35.33"></a><span id="l35.33">                   [optional] in unsigned long aRemapCount,</span>
<a href="#l35.34"></a><span id="l35.34">                   [optional, array, size_is(aRemapCount)] in unsigned long aFromTraits,</span>
<a href="#l35.35"></a><span id="l35.35">                   [optional, array, size_is(aRemapCount)] in unsigned long aToTraits);</span>
<a href="#l35.36"></a><span id="l35.36"> </span>
<a href="#l35.37"></a><span id="l35.37">   /**</span>
<a href="#l35.38"></a><span id="l35.38">    * Get the corpus count for a token as a string.</span>
<a href="#l35.39"></a><span id="l35.39">    *</span>
<a href="#l35.40"></a><span id="l35.40">    * @param aWord    string of characters representing the token</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l36.1"></a><span id="l36.1" class="difflineminus">--- a/mailnews/base/search/public/nsIMsgFilterService.idl</span>
<a href="#l36.2"></a><span id="l36.2" class="difflineplus">+++ b/mailnews/base/search/public/nsIMsgFilterService.idl</span>
<a href="#l36.3"></a><span id="l36.3" class="difflineat">@@ -5,29 +5,29 @@</span>
<a href="#l36.4"></a><span id="l36.4"> </span>
<a href="#l36.5"></a><span id="l36.5"> #include &quot;nsISupports.idl&quot;</span>
<a href="#l36.6"></a><span id="l36.6"> #include &quot;nsMsgFilterCore.idl&quot;</span>
<a href="#l36.7"></a><span id="l36.7"> </span>
<a href="#l36.8"></a><span id="l36.8"> interface nsIMsgFilterList;</span>
<a href="#l36.9"></a><span id="l36.9"> interface nsIMsgWindow;</span>
<a href="#l36.10"></a><span id="l36.10"> interface nsIMsgFilterCustomAction;</span>
<a href="#l36.11"></a><span id="l36.11"> interface nsISimpleEnumerator;</span>
<a href="#l36.12"></a><span id="l36.12" class="difflineminus">-interface nsILocalFile;</span>
<a href="#l36.13"></a><span id="l36.13" class="difflineplus">+interface nsIFile;</span>
<a href="#l36.14"></a><span id="l36.14"> interface nsIMsgFolder;</span>
<a href="#l36.15"></a><span id="l36.15"> interface nsISupportsArray;</span>
<a href="#l36.16"></a><span id="l36.16"> interface nsIMsgSearchCustomTerm;</span>
<a href="#l36.17"></a><span id="l36.17"> </span>
<a href="#l36.18"></a><span id="l36.18"> [scriptable, uuid(C1A5F1BB-4D6C-447a-B70F-A12BE767DC0A)]</span>
<a href="#l36.19"></a><span id="l36.19"> interface nsIMsgFilterService : nsISupports {</span>
<a href="#l36.20"></a><span id="l36.20"> </span>
<a href="#l36.21"></a><span id="l36.21" class="difflineminus">-    nsIMsgFilterList OpenFilterList(in nsILocalFile filterFile, in nsIMsgFolder rootFolder, in nsIMsgWindow msgWindow);</span>
<a href="#l36.22"></a><span id="l36.22" class="difflineplus">+    nsIMsgFilterList OpenFilterList(in nsIFile filterFile, in nsIMsgFolder rootFolder, in nsIMsgWindow msgWindow);</span>
<a href="#l36.23"></a><span id="l36.23">     void CloseFilterList(in nsIMsgFilterList filterList);</span>
<a href="#l36.24"></a><span id="l36.24"> </span>
<a href="#l36.25"></a><span id="l36.25">     void SaveFilterList(in nsIMsgFilterList filterList,</span>
<a href="#l36.26"></a><span id="l36.26" class="difflineminus">-                        in nsILocalFile filterFile);</span>
<a href="#l36.27"></a><span id="l36.27" class="difflineplus">+                        in nsIFile filterFile);</span>
<a href="#l36.28"></a><span id="l36.28">     </span>
<a href="#l36.29"></a><span id="l36.29">     void CancelFilterList(in nsIMsgFilterList filterList);</span>
<a href="#l36.30"></a><span id="l36.30">     nsIMsgFilterList getTempFilterList(in nsIMsgFolder aFolder);</span>
<a href="#l36.31"></a><span id="l36.31">     void applyFiltersToFolders(in nsIMsgFilterList aFilterList, in nsISupportsArray aFolders, in nsIMsgWindow aMsgWindow);</span>
<a href="#l36.32"></a><span id="l36.32"> </span>
<a href="#l36.33"></a><span id="l36.33">     /*</span>
<a href="#l36.34"></a><span id="l36.34">      * Apply filters to a specific list of messages in a folder.</span>
<a href="#l36.35"></a><span id="l36.35">      * @param  aFilterType  The type of filter to match against</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l37.1"></a><span id="l37.1" class="difflineminus">--- a/mailnews/base/search/public/nsIMsgSearchScopeTerm.idl</span>
<a href="#l37.2"></a><span id="l37.2" class="difflineplus">+++ b/mailnews/base/search/public/nsIMsgSearchScopeTerm.idl</span>
<a href="#l37.3"></a><span id="l37.3" class="difflineat">@@ -1,16 +1,16 @@</span>
<a href="#l37.4"></a><span id="l37.4"> /* -*- Mode: IDL; tab-width: 4; indent-tabs-mode: nil; c-basic-offset: 4 -*- */</span>
<a href="#l37.5"></a><span id="l37.5"> /* This Source Code Form is subject to the terms of the Mozilla Public</span>
<a href="#l37.6"></a><span id="l37.6">  * License, v. 2.0. If a copy of the MPL was not distributed with this</span>
<a href="#l37.7"></a><span id="l37.7">  * file, You can obtain one at http://mozilla.org/MPL/2.0/. */</span>
<a href="#l37.8"></a><span id="l37.8"> </span>
<a href="#l37.9"></a><span id="l37.9"> #include &quot;nsIMsgSearchSession.idl&quot;</span>
<a href="#l37.10"></a><span id="l37.10"> </span>
<a href="#l37.11"></a><span id="l37.11" class="difflineminus">-interface nsILocalFile;</span>
<a href="#l37.12"></a><span id="l37.12" class="difflineplus">+interface nsIFile;</span>
<a href="#l37.13"></a><span id="l37.13"> interface nsIMsgFolder;</span>
<a href="#l37.14"></a><span id="l37.14"> interface nsIMsgDBHdr;</span>
<a href="#l37.15"></a><span id="l37.15"> interface nsILineInputStream;</span>
<a href="#l37.16"></a><span id="l37.16"> </span>
<a href="#l37.17"></a><span id="l37.17"> [scriptable, uuid(934672c3-9b8f-488a-935d-87b4023fa0be)]</span>
<a href="#l37.18"></a><span id="l37.18"> interface nsIMsgSearchScopeTerm : nsISupports {</span>
<a href="#l37.19"></a><span id="l37.19">   nsIInputStream getInputStream(in nsIMsgDBHdr aHdr);</span>
<a href="#l37.20"></a><span id="l37.20">   void closeInputStream();</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l38.1"></a><span id="l38.1" class="difflineminus">--- a/mailnews/base/search/public/nsMsgBodyHandler.h</span>
<a href="#l38.2"></a><span id="l38.2" class="difflineplus">+++ b/mailnews/base/search/public/nsMsgBodyHandler.h</span>
<a href="#l38.3"></a><span id="l38.3" class="difflineat">@@ -55,17 +55,17 @@ protected:</span>
<a href="#l38.4"></a><span id="l38.4">   // local / POP related methods</span>
<a href="#l38.5"></a><span id="l38.5">   void OpenLocalFolder();</span>
<a href="#l38.6"></a><span id="l38.6"> </span>
<a href="#l38.7"></a><span id="l38.7">   // goes through the mail folder</span>
<a href="#l38.8"></a><span id="l38.8">   PRInt32 GetNextLocalLine(nsCString &amp;buf);</span>
<a href="#l38.9"></a><span id="l38.9"> </span>
<a href="#l38.10"></a><span id="l38.10">   nsIMsgSearchScopeTerm *m_scope;</span>
<a href="#l38.11"></a><span id="l38.11">   nsCOMPtr &lt;nsILineInputStream&gt; m_fileLineStream;</span>
<a href="#l38.12"></a><span id="l38.12" class="difflineminus">-  nsCOMPtr &lt;nsILocalFile&gt; m_localFile;</span>
<a href="#l38.13"></a><span id="l38.13" class="difflineplus">+  nsCOMPtr &lt;nsIFile&gt; m_localFile;</span>
<a href="#l38.14"></a><span id="l38.14"> </span>
<a href="#l38.15"></a><span id="l38.15">   /**</span>
<a href="#l38.16"></a><span id="l38.16">    * The number of lines in the message.  If |m_lineCountInBodyLines| then this</span>
<a href="#l38.17"></a><span id="l38.17">    * is the number of body lines, otherwise this is the entire number of lines</span>
<a href="#l38.18"></a><span id="l38.18">    * in the message.  This is important so we know when to stop reading the file</span>
<a href="#l38.19"></a><span id="l38.19">    * without accidentally reading part of the next message.</span>
<a href="#l38.20"></a><span id="l38.20">    */</span>
<a href="#l38.21"></a><span id="l38.21">   PRUint32 m_numLocalLines;</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l39.1"></a><span id="l39.1" class="difflineminus">--- a/mailnews/base/search/src/nsMsgBodyHandler.cpp</span>
<a href="#l39.2"></a><span id="l39.2" class="difflineplus">+++ b/mailnews/base/search/src/nsMsgBodyHandler.cpp</span>
<a href="#l39.3"></a><span id="l39.3" class="difflineat">@@ -7,17 +7,17 @@</span>
<a href="#l39.4"></a><span id="l39.4"> #include &quot;nsMsgSearchCore.h&quot;</span>
<a href="#l39.5"></a><span id="l39.5"> #include &quot;nsMsgUtils.h&quot;</span>
<a href="#l39.6"></a><span id="l39.6"> #include &quot;nsMsgBodyHandler.h&quot;</span>
<a href="#l39.7"></a><span id="l39.7"> #include &quot;nsMsgSearchTerm.h&quot;</span>
<a href="#l39.8"></a><span id="l39.8"> #include &quot;nsIMsgHdr.h&quot;</span>
<a href="#l39.9"></a><span id="l39.9"> #include &quot;nsMsgMessageFlags.h&quot;</span>
<a href="#l39.10"></a><span id="l39.10"> #include &quot;nsISeekableStream.h&quot;</span>
<a href="#l39.11"></a><span id="l39.11"> #include &quot;nsIInputStream.h&quot;</span>
<a href="#l39.12"></a><span id="l39.12" class="difflineminus">-#include &quot;nsILocalFile.h&quot;</span>
<a href="#l39.13"></a><span id="l39.13" class="difflineplus">+#include &quot;nsIFile.h&quot;</span>
<a href="#l39.14"></a><span id="l39.14"> #include &quot;plbase64.h&quot;</span>
<a href="#l39.15"></a><span id="l39.15"> #include &quot;prmem.h&quot;</span>
<a href="#l39.16"></a><span id="l39.16"> </span>
<a href="#l39.17"></a><span id="l39.17"> nsMsgBodyHandler::nsMsgBodyHandler (nsIMsgSearchScopeTerm * scope,</span>
<a href="#l39.18"></a><span id="l39.18">                                     PRUint32 numLines,</span>
<a href="#l39.19"></a><span id="l39.19">                                     nsIMsgDBHdr* msg, nsIMsgDatabase * db)</span>
<a href="#l39.20"></a><span id="l39.20"> {</span>
<a href="#l39.21"></a><span id="l39.21">   m_scope = scope;</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l40.1"></a><span id="l40.1" class="difflineminus">--- a/mailnews/base/search/src/nsMsgFilterList.cpp</span>
<a href="#l40.2"></a><span id="l40.2" class="difflineplus">+++ b/mailnews/base/search/src/nsMsgFilterList.cpp</span>
<a href="#l40.3"></a><span id="l40.3" class="difflineat">@@ -88,17 +88,17 @@ NS_IMETHODIMP nsMsgFilterList::SaveToFil</span>
<a href="#l40.4"></a><span id="l40.4"> {</span>
<a href="#l40.5"></a><span id="l40.5">   if (!stream)</span>
<a href="#l40.6"></a><span id="l40.6">     return NS_ERROR_NULL_POINTER;</span>
<a href="#l40.7"></a><span id="l40.7">   return SaveTextFilters(stream);</span>
<a href="#l40.8"></a><span id="l40.8"> }</span>
<a href="#l40.9"></a><span id="l40.9"> </span>
<a href="#l40.10"></a><span id="l40.10"> NS_IMETHODIMP nsMsgFilterList::EnsureLogFile()</span>
<a href="#l40.11"></a><span id="l40.11"> {</span>
<a href="#l40.12"></a><span id="l40.12" class="difflineminus">-  nsCOMPtr &lt;nsILocalFile&gt; file;</span>
<a href="#l40.13"></a><span id="l40.13" class="difflineplus">+  nsCOMPtr &lt;nsIFile&gt; file;</span>
<a href="#l40.14"></a><span id="l40.14">   nsresult rv = GetLogFile(getter_AddRefs(file));</span>
<a href="#l40.15"></a><span id="l40.15">   NS_ENSURE_SUCCESS(rv,rv);</span>
<a href="#l40.16"></a><span id="l40.16"> </span>
<a href="#l40.17"></a><span id="l40.17">   bool exists;</span>
<a href="#l40.18"></a><span id="l40.18">   rv = file-&gt;Exists(&amp;exists);</span>
<a href="#l40.19"></a><span id="l40.19">   if (NS_SUCCEEDED(rv) &amp;&amp; !exists) {</span>
<a href="#l40.20"></a><span id="l40.20">     rv = file-&gt;Create(nsIFile::NORMAL_FILE_TYPE, 0644);</span>
<a href="#l40.21"></a><span id="l40.21">     NS_ENSURE_SUCCESS(rv,rv);</span>
<a href="#l40.22"></a><span id="l40.22" class="difflineat">@@ -107,17 +107,17 @@ NS_IMETHODIMP nsMsgFilterList::EnsureLog</span>
<a href="#l40.23"></a><span id="l40.23"> }</span>
<a href="#l40.24"></a><span id="l40.24"> </span>
<a href="#l40.25"></a><span id="l40.25"> nsresult nsMsgFilterList::TruncateLog()</span>
<a href="#l40.26"></a><span id="l40.26"> {</span>
<a href="#l40.27"></a><span id="l40.27">   // this will flush and close the steam</span>
<a href="#l40.28"></a><span id="l40.28">   nsresult rv = SetLogStream(nsnull);</span>
<a href="#l40.29"></a><span id="l40.29">   NS_ENSURE_SUCCESS(rv,rv);</span>
<a href="#l40.30"></a><span id="l40.30"> </span>
<a href="#l40.31"></a><span id="l40.31" class="difflineminus">-  nsCOMPtr &lt;nsILocalFile&gt; file;</span>
<a href="#l40.32"></a><span id="l40.32" class="difflineplus">+  nsCOMPtr &lt;nsIFile&gt; file;</span>
<a href="#l40.33"></a><span id="l40.33">   rv = GetLogFile(getter_AddRefs(file));</span>
<a href="#l40.34"></a><span id="l40.34">   NS_ENSURE_SUCCESS(rv,rv);</span>
<a href="#l40.35"></a><span id="l40.35"> </span>
<a href="#l40.36"></a><span id="l40.36">   file-&gt;Remove(false);</span>
<a href="#l40.37"></a><span id="l40.37">   rv = file-&gt;Create(nsIFile::NORMAL_FILE_TYPE, 0644);</span>
<a href="#l40.38"></a><span id="l40.38">   NS_ENSURE_SUCCESS(rv,rv);</span>
<a href="#l40.39"></a><span id="l40.39">   return rv;</span>
<a href="#l40.40"></a><span id="l40.40"> }</span>
<a href="#l40.41"></a><span id="l40.41" class="difflineat">@@ -136,17 +136,17 @@ NS_IMETHODIMP nsMsgFilterList::ClearLog(</span>
<a href="#l40.42"></a><span id="l40.42">   NS_ASSERTION(NS_SUCCEEDED(rv), &quot;failed to truncate filter log&quot;);</span>
<a href="#l40.43"></a><span id="l40.43"> </span>
<a href="#l40.44"></a><span id="l40.44">   m_loggingEnabled = loggingEnabled;</span>
<a href="#l40.45"></a><span id="l40.45"> </span>
<a href="#l40.46"></a><span id="l40.46">   return NS_OK;</span>
<a href="#l40.47"></a><span id="l40.47"> }</span>
<a href="#l40.48"></a><span id="l40.48"> </span>
<a href="#l40.49"></a><span id="l40.49"> nsresult</span>
<a href="#l40.50"></a><span id="l40.50" class="difflineminus">-nsMsgFilterList::GetLogFile(nsILocalFile **aFile)</span>
<a href="#l40.51"></a><span id="l40.51" class="difflineplus">+nsMsgFilterList::GetLogFile(nsIFile **aFile)</span>
<a href="#l40.52"></a><span id="l40.52"> {</span>
<a href="#l40.53"></a><span id="l40.53">   NS_ENSURE_ARG_POINTER(aFile);</span>
<a href="#l40.54"></a><span id="l40.54"> </span>
<a href="#l40.55"></a><span id="l40.55">   // XXX todo</span>
<a href="#l40.56"></a><span id="l40.56">   // the path to the log file won't change</span>
<a href="#l40.57"></a><span id="l40.57">   // should we cache it?</span>
<a href="#l40.58"></a><span id="l40.58">   nsCOMPtr &lt;nsIMsgFolder&gt; folder;</span>
<a href="#l40.59"></a><span id="l40.59">   nsresult rv = GetFolder(getter_AddRefs(folder));</span>
<a href="#l40.60"></a><span id="l40.60" class="difflineat">@@ -167,21 +167,21 @@ nsMsgFilterList::GetLogFile(nsILocalFile</span>
<a href="#l40.61"></a><span id="l40.61">   // for news folders (not servers), the filter file is</span>
<a href="#l40.62"></a><span id="l40.62">   // mcom.test.dat</span>
<a href="#l40.63"></a><span id="l40.63">   // where the summary file is</span>
<a href="#l40.64"></a><span id="l40.64">   // mcom.test.msf</span>
<a href="#l40.65"></a><span id="l40.65">   // since the log is an html file we make it</span>
<a href="#l40.66"></a><span id="l40.66">   // mcom.test.htm</span>
<a href="#l40.67"></a><span id="l40.67">   if (type.Equals(&quot;nntp&quot;) &amp;&amp; !isServer)</span>
<a href="#l40.68"></a><span id="l40.68">   {</span>
<a href="#l40.69"></a><span id="l40.69" class="difflineminus">-    nsCOMPtr&lt;nsILocalFile&gt; thisFolder;</span>
<a href="#l40.70"></a><span id="l40.70" class="difflineplus">+    nsCOMPtr&lt;nsIFile&gt; thisFolder;</span>
<a href="#l40.71"></a><span id="l40.71">     rv = m_folder-&gt;GetFilePath(getter_AddRefs(thisFolder));</span>
<a href="#l40.72"></a><span id="l40.72">     NS_ENSURE_SUCCESS(rv, rv);</span>
<a href="#l40.73"></a><span id="l40.73"> </span>
<a href="#l40.74"></a><span id="l40.74" class="difflineminus">-    nsCOMPtr&lt;nsILocalFile&gt; filterLogFile = do_CreateInstance(NS_LOCAL_FILE_CONTRACTID, &amp;rv);</span>
<a href="#l40.75"></a><span id="l40.75" class="difflineplus">+    nsCOMPtr&lt;nsIFile&gt; filterLogFile = do_CreateInstance(NS_LOCAL_FILE_CONTRACTID, &amp;rv);</span>
<a href="#l40.76"></a><span id="l40.76">     NS_ENSURE_SUCCESS(rv, rv);</span>
<a href="#l40.77"></a><span id="l40.77">     rv = filterLogFile-&gt;InitWithFile(thisFolder);</span>
<a href="#l40.78"></a><span id="l40.78">     NS_ENSURE_SUCCESS(rv, rv);</span>
<a href="#l40.79"></a><span id="l40.79"> </span>
<a href="#l40.80"></a><span id="l40.80">     // NOTE:</span>
<a href="#l40.81"></a><span id="l40.81">     // we don't we need to call NS_MsgHashIfNecessary()</span>
<a href="#l40.82"></a><span id="l40.82">     // it's already been hashed, if necessary</span>
<a href="#l40.83"></a><span id="l40.83">     nsAutoString filterLogName;</span>
<a href="#l40.84"></a><span id="l40.84" class="difflineat">@@ -203,17 +203,17 @@ nsMsgFilterList::GetLogFile(nsILocalFile</span>
<a href="#l40.85"></a><span id="l40.85">     NS_ENSURE_SUCCESS(rv,rv);</span>
<a href="#l40.86"></a><span id="l40.86">   }</span>
<a href="#l40.87"></a><span id="l40.87">   return NS_OK;</span>
<a href="#l40.88"></a><span id="l40.88"> }</span>
<a href="#l40.89"></a><span id="l40.89"> </span>
<a href="#l40.90"></a><span id="l40.90"> NS_IMETHODIMP</span>
<a href="#l40.91"></a><span id="l40.91"> nsMsgFilterList::GetLogURL(nsACString &amp;aLogURL)</span>
<a href="#l40.92"></a><span id="l40.92"> {</span>
<a href="#l40.93"></a><span id="l40.93" class="difflineminus">-  nsCOMPtr &lt;nsILocalFile&gt; file;</span>
<a href="#l40.94"></a><span id="l40.94" class="difflineplus">+  nsCOMPtr &lt;nsIFile&gt; file;</span>
<a href="#l40.95"></a><span id="l40.95">   nsresult rv = GetLogFile(getter_AddRefs(file));</span>
<a href="#l40.96"></a><span id="l40.96">   NS_ENSURE_SUCCESS(rv,rv);</span>
<a href="#l40.97"></a><span id="l40.97"> </span>
<a href="#l40.98"></a><span id="l40.98">   rv = NS_GetURLSpecFromFile(file, aLogURL);</span>
<a href="#l40.99"></a><span id="l40.99">   NS_ENSURE_SUCCESS(rv,rv);</span>
<a href="#l40.100"></a><span id="l40.100"> </span>
<a href="#l40.101"></a><span id="l40.101">   return !aLogURL.IsEmpty() ? NS_OK : NS_ERROR_OUT_OF_MEMORY;</span>
<a href="#l40.102"></a><span id="l40.102"> }</span>
<a href="#l40.103"></a><span id="l40.103" class="difflineat">@@ -238,17 +238,17 @@ nsMsgFilterList::SetLogStream(nsIOutputS</span>
<a href="#l40.104"></a><span id="l40.104"> NS_IMETHODIMP</span>
<a href="#l40.105"></a><span id="l40.105"> nsMsgFilterList::GetLogStream(nsIOutputStream **aLogStream)</span>
<a href="#l40.106"></a><span id="l40.106"> {</span>
<a href="#l40.107"></a><span id="l40.107">   NS_ENSURE_ARG_POINTER(aLogStream);</span>
<a href="#l40.108"></a><span id="l40.108"> </span>
<a href="#l40.109"></a><span id="l40.109">   nsresult rv;</span>
<a href="#l40.110"></a><span id="l40.110"> </span>
<a href="#l40.111"></a><span id="l40.111">   if (!m_logStream) {</span>
<a href="#l40.112"></a><span id="l40.112" class="difflineminus">-    nsCOMPtr &lt;nsILocalFile&gt; logFile;</span>
<a href="#l40.113"></a><span id="l40.113" class="difflineplus">+    nsCOMPtr &lt;nsIFile&gt; logFile;</span>
<a href="#l40.114"></a><span id="l40.114">     rv = GetLogFile(getter_AddRefs(logFile));</span>
<a href="#l40.115"></a><span id="l40.115">     NS_ENSURE_SUCCESS(rv,rv);</span>
<a href="#l40.116"></a><span id="l40.116"> </span>
<a href="#l40.117"></a><span id="l40.117">     // append to the end of the log file</span>
<a href="#l40.118"></a><span id="l40.118">     rv = MsgNewBufferedFileOutputStream(getter_AddRefs(m_logStream),</span>
<a href="#l40.119"></a><span id="l40.119">                                         logFile,</span>
<a href="#l40.120"></a><span id="l40.120">                                         PR_CREATE_FILE | PR_WRONLY | PR_APPEND,</span>
<a href="#l40.121"></a><span id="l40.121">                                         0600);</span>
<a href="#l40.122"></a><span id="l40.122" class="difflineat">@@ -328,24 +328,24 @@ nsMsgFilterList::ApplyFiltersToHdr(nsMsg</span>
<a href="#l40.123"></a><span id="l40.123">       }</span>
<a href="#l40.124"></a><span id="l40.124">     }</span>
<a href="#l40.125"></a><span id="l40.125">   }</span>
<a href="#l40.126"></a><span id="l40.126">   scope-&gt;Release();</span>
<a href="#l40.127"></a><span id="l40.127">   return rv;</span>
<a href="#l40.128"></a><span id="l40.128"> }</span>
<a href="#l40.129"></a><span id="l40.129"> </span>
<a href="#l40.130"></a><span id="l40.130"> NS_IMETHODIMP</span>
<a href="#l40.131"></a><span id="l40.131" class="difflineminus">-nsMsgFilterList::SetDefaultFile(nsILocalFile *aFile)</span>
<a href="#l40.132"></a><span id="l40.132" class="difflineplus">+nsMsgFilterList::SetDefaultFile(nsIFile *aFile)</span>
<a href="#l40.133"></a><span id="l40.133"> {</span>
<a href="#l40.134"></a><span id="l40.134">   m_defaultFile = aFile;</span>
<a href="#l40.135"></a><span id="l40.135">   return NS_OK;</span>
<a href="#l40.136"></a><span id="l40.136"> }</span>
<a href="#l40.137"></a><span id="l40.137"> </span>
<a href="#l40.138"></a><span id="l40.138"> NS_IMETHODIMP</span>
<a href="#l40.139"></a><span id="l40.139" class="difflineminus">-nsMsgFilterList::GetDefaultFile(nsILocalFile **aResult)</span>
<a href="#l40.140"></a><span id="l40.140" class="difflineplus">+nsMsgFilterList::GetDefaultFile(nsIFile **aResult)</span>
<a href="#l40.141"></a><span id="l40.141"> {</span>
<a href="#l40.142"></a><span id="l40.142">     NS_ENSURE_ARG_POINTER(aResult);</span>
<a href="#l40.143"></a><span id="l40.143"> </span>
<a href="#l40.144"></a><span id="l40.144">     NS_IF_ADDREF(*aResult = m_defaultFile);</span>
<a href="#l40.145"></a><span id="l40.145">     return NS_OK;</span>
<a href="#l40.146"></a><span id="l40.146"> }</span>
<a href="#l40.147"></a><span id="l40.147"> </span>
<a href="#l40.148"></a><span id="l40.148"> NS_IMETHODIMP</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l41.1"></a><span id="l41.1" class="difflineminus">--- a/mailnews/base/search/src/nsMsgFilterList.h</span>
<a href="#l41.2"></a><span id="l41.2" class="difflineplus">+++ b/mailnews/base/search/src/nsMsgFilterList.h</span>
<a href="#l41.3"></a><span id="l41.3" class="difflineat">@@ -6,17 +6,17 @@</span>
<a href="#l41.4"></a><span id="l41.4"> #ifndef _nsMsgFilterList_H_</span>
<a href="#l41.5"></a><span id="l41.5"> #define _nsMsgFilterList_H_</span>
<a href="#l41.6"></a><span id="l41.6"> </span>
<a href="#l41.7"></a><span id="l41.7"> #include &quot;nscore.h&quot;</span>
<a href="#l41.8"></a><span id="l41.8"> #include &quot;nsIMsgFolder.h&quot;</span>
<a href="#l41.9"></a><span id="l41.9"> #include &quot;nsIMsgFilterList.h&quot;</span>
<a href="#l41.10"></a><span id="l41.10"> #include &quot;nsCOMPtr.h&quot;</span>
<a href="#l41.11"></a><span id="l41.11"> #include &quot;nsISupportsArray.h&quot;</span>
<a href="#l41.12"></a><span id="l41.12" class="difflineminus">-#include &quot;nsILocalFile.h&quot;</span>
<a href="#l41.13"></a><span id="l41.13" class="difflineplus">+#include &quot;nsIFile.h&quot;</span>
<a href="#l41.14"></a><span id="l41.14"> #include &quot;nsIOutputStream.h&quot;</span>
<a href="#l41.15"></a><span id="l41.15"> </span>
<a href="#l41.16"></a><span id="l41.16"> const PRInt16 kFileVersion = 9;</span>
<a href="#l41.17"></a><span id="l41.17"> const PRInt16 kManualContextVersion = 9;</span>
<a href="#l41.18"></a><span id="l41.18"> const PRInt16 k60Beta1Version = 7;</span>
<a href="#l41.19"></a><span id="l41.19"> const PRInt16 k45Version = 6;</span>
<a href="#l41.20"></a><span id="l41.20"> </span>
<a href="#l41.21"></a><span id="l41.21"> </span>
<a href="#l41.22"></a><span id="l41.22" class="difflineat">@@ -63,21 +63,21 @@ protected:</span>
<a href="#l41.23"></a><span id="l41.23">   PRInt16 m_fileVersion;</span>
<a href="#l41.24"></a><span id="l41.24">   bool m_loggingEnabled;</span>
<a href="#l41.25"></a><span id="l41.25">   bool m_startWritingToBuffer; //tells us when to start writing one whole filter to m_unparsedBuffer</span>
<a href="#l41.26"></a><span id="l41.26">   nsCOMPtr &lt;nsIMsgFolder&gt; m_folder;</span>
<a href="#l41.27"></a><span id="l41.27">   nsMsgFilter *m_curFilter; // filter we're filing in or out(?)</span>
<a href="#l41.28"></a><span id="l41.28">   nsCString m_filterFileName;</span>
<a href="#l41.29"></a><span id="l41.29">   nsCOMPtr&lt;nsISupportsArray&gt; m_filters;</span>
<a href="#l41.30"></a><span id="l41.30">   nsCString m_arbitraryHeaders;</span>
<a href="#l41.31"></a><span id="l41.31" class="difflineminus">-  nsCOMPtr&lt;nsILocalFile&gt; m_defaultFile;</span>
<a href="#l41.32"></a><span id="l41.32" class="difflineplus">+  nsCOMPtr&lt;nsIFile&gt; m_defaultFile;</span>
<a href="#l41.33"></a><span id="l41.33">   nsCString m_unparsedFilterBuffer; //holds one entire filter unparsed </span>
<a href="#l41.34"></a><span id="l41.34"> </span>
<a href="#l41.35"></a><span id="l41.35"> private:</span>
<a href="#l41.36"></a><span id="l41.36">   nsresult TruncateLog();</span>
<a href="#l41.37"></a><span id="l41.37" class="difflineminus">-  nsresult GetLogFile(nsILocalFile **aFile);</span>
<a href="#l41.38"></a><span id="l41.38" class="difflineplus">+  nsresult GetLogFile(nsIFile **aFile);</span>
<a href="#l41.39"></a><span id="l41.39">   nsCOMPtr&lt;nsIOutputStream&gt; m_logStream;</span>
<a href="#l41.40"></a><span id="l41.40"> };</span>
<a href="#l41.41"></a><span id="l41.41"> </span>
<a href="#l41.42"></a><span id="l41.42"> #endif</span>
<a href="#l41.43"></a><span id="l41.43"> </span>
<a href="#l41.44"></a><span id="l41.44"> </span>
<a href="#l41.45"></a><span id="l41.45"> </span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l42.1"></a><span id="l42.1" class="difflineminus">--- a/mailnews/base/search/src/nsMsgFilterService.cpp</span>
<a href="#l42.2"></a><span id="l42.2" class="difflineplus">+++ b/mailnews/base/search/src/nsMsgFilterService.cpp</span>
<a href="#l42.3"></a><span id="l42.3" class="difflineat">@@ -44,17 +44,17 @@ NS_IMPL_ISUPPORTS1(nsMsgFilterService, n</span>
<a href="#l42.4"></a><span id="l42.4"> nsMsgFilterService::nsMsgFilterService()</span>
<a href="#l42.5"></a><span id="l42.5"> {</span>
<a href="#l42.6"></a><span id="l42.6"> }</span>
<a href="#l42.7"></a><span id="l42.7"> </span>
<a href="#l42.8"></a><span id="l42.8"> nsMsgFilterService::~nsMsgFilterService()</span>
<a href="#l42.9"></a><span id="l42.9"> {</span>
<a href="#l42.10"></a><span id="l42.10"> }</span>
<a href="#l42.11"></a><span id="l42.11"> </span>
<a href="#l42.12"></a><span id="l42.12" class="difflineminus">-NS_IMETHODIMP nsMsgFilterService::OpenFilterList(nsILocalFile *aFilterFile, nsIMsgFolder *rootFolder, nsIMsgWindow *aMsgWindow, nsIMsgFilterList **resultFilterList)</span>
<a href="#l42.13"></a><span id="l42.13" class="difflineplus">+NS_IMETHODIMP nsMsgFilterService::OpenFilterList(nsIFile *aFilterFile, nsIMsgFolder *rootFolder, nsIMsgWindow *aMsgWindow, nsIMsgFilterList **resultFilterList)</span>
<a href="#l42.14"></a><span id="l42.14"> {</span>
<a href="#l42.15"></a><span id="l42.15">   NS_ENSURE_ARG_POINTER(aFilterFile);</span>
<a href="#l42.16"></a><span id="l42.16"> </span>
<a href="#l42.17"></a><span id="l42.17">   nsresult rv;</span>
<a href="#l42.18"></a><span id="l42.18">   bool exists;</span>
<a href="#l42.19"></a><span id="l42.19">   aFilterFile-&gt;Exists(&amp;exists);</span>
<a href="#l42.20"></a><span id="l42.20">   if (!exists)</span>
<a href="#l42.21"></a><span id="l42.21">   {</span>
<a href="#l42.22"></a><span id="l42.22" class="difflineat">@@ -113,17 +113,17 @@ NS_IMETHODIMP nsMsgFilterService::OpenFi</span>
<a href="#l42.23"></a><span id="l42.23"> </span>
<a href="#l42.24"></a><span id="l42.24"> NS_IMETHODIMP nsMsgFilterService::CloseFilterList(nsIMsgFilterList *filterList)</span>
<a href="#l42.25"></a><span id="l42.25"> {</span>
<a href="#l42.26"></a><span id="l42.26">   //NS_ASSERTION(false,&quot;CloseFilterList doesn't do anything yet&quot;);</span>
<a href="#l42.27"></a><span id="l42.27">   return NS_OK;</span>
<a href="#l42.28"></a><span id="l42.28"> }</span>
<a href="#l42.29"></a><span id="l42.29"> </span>
<a href="#l42.30"></a><span id="l42.30"> /* save without deleting */</span>
<a href="#l42.31"></a><span id="l42.31" class="difflineminus">-NS_IMETHODIMP  nsMsgFilterService::SaveFilterList(nsIMsgFilterList *filterList, nsILocalFile *filterFile)</span>
<a href="#l42.32"></a><span id="l42.32" class="difflineplus">+NS_IMETHODIMP  nsMsgFilterService::SaveFilterList(nsIMsgFilterList *filterList, nsIFile *filterFile)</span>
<a href="#l42.33"></a><span id="l42.33"> {</span>
<a href="#l42.34"></a><span id="l42.34">   NS_ENSURE_ARG_POINTER(filterFile);</span>
<a href="#l42.35"></a><span id="l42.35">   NS_ENSURE_ARG_POINTER(filterList);</span>
<a href="#l42.36"></a><span id="l42.36"> </span>
<a href="#l42.37"></a><span id="l42.37">   nsCOMPtr&lt;nsIOutputStream&gt; out;</span>
<a href="#l42.38"></a><span id="l42.38">   nsresult rv = NS_NewSafeLocalFileOutputStream(getter_AddRefs(out),</span>
<a href="#l42.39"></a><span id="l42.39">                                                 filterFile, -1, 0600);</span>
<a href="#l42.40"></a><span id="l42.40">   NS_ENSURE_SUCCESS(rv, rv);</span>
<a href="#l42.41"></a><span id="l42.41" class="difflineat">@@ -143,17 +143,17 @@ NS_IMETHODIMP  nsMsgFilterService::SaveF</span>
<a href="#l42.42"></a><span id="l42.42">   return rv;</span>
<a href="#l42.43"></a><span id="l42.43"> }</span>
<a href="#l42.44"></a><span id="l42.44"> </span>
<a href="#l42.45"></a><span id="l42.45"> NS_IMETHODIMP nsMsgFilterService::CancelFilterList(nsIMsgFilterList *filterList)</span>
<a href="#l42.46"></a><span id="l42.46"> {</span>
<a href="#l42.47"></a><span id="l42.47">   return NS_ERROR_NOT_IMPLEMENTED;</span>
<a href="#l42.48"></a><span id="l42.48"> }</span>
<a href="#l42.49"></a><span id="l42.49"> </span>
<a href="#l42.50"></a><span id="l42.50" class="difflineminus">-nsresult nsMsgFilterService::BackUpFilterFile(nsILocalFile *aFilterFile, nsIMsgWindow *aMsgWindow)</span>
<a href="#l42.51"></a><span id="l42.51" class="difflineplus">+nsresult nsMsgFilterService::BackUpFilterFile(nsIFile *aFilterFile, nsIMsgWindow *aMsgWindow)</span>
<a href="#l42.52"></a><span id="l42.52"> {</span>
<a href="#l42.53"></a><span id="l42.53">   AlertBackingUpFilterFile(aMsgWindow);</span>
<a href="#l42.54"></a><span id="l42.54"> </span>
<a href="#l42.55"></a><span id="l42.55">   nsCOMPtr&lt;nsIFile&gt; localParentDir;</span>
<a href="#l42.56"></a><span id="l42.56">   nsresult rv = aFilterFile-&gt;GetParent(getter_AddRefs(localParentDir));</span>
<a href="#l42.57"></a><span id="l42.57">   NS_ENSURE_SUCCESS(rv,rv);</span>
<a href="#l42.58"></a><span id="l42.58"> </span>
<a href="#l42.59"></a><span id="l42.59">   //if back-up file exists delete the back up file otherwise copy fails.</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l43.1"></a><span id="l43.1" class="difflineminus">--- a/mailnews/base/search/src/nsMsgFilterService.h</span>
<a href="#l43.2"></a><span id="l43.2" class="difflineplus">+++ b/mailnews/base/search/src/nsMsgFilterService.h</span>
<a href="#l43.3"></a><span id="l43.3" class="difflineat">@@ -24,17 +24,17 @@ public:</span>
<a href="#l43.4"></a><span id="l43.4">   virtual ~nsMsgFilterService();</span>
<a href="#l43.5"></a><span id="l43.5"> </span>
<a href="#l43.6"></a><span id="l43.6">   NS_DECL_ISUPPORTS</span>
<a href="#l43.7"></a><span id="l43.7">   NS_DECL_NSIMSGFILTERSERVICE</span>
<a href="#l43.8"></a><span id="l43.8"> /* clients call OpenFilterList to get a handle to a FilterList, of existing nsMsgFilter *.</span>
<a href="#l43.9"></a><span id="l43.9">   These are manipulated by the front end as a result of user interaction</span>
<a href="#l43.10"></a><span id="l43.10">    with dialog boxes. To apply the new list call MSG_CloseFilterList.</span>
<a href="#l43.11"></a><span id="l43.11"> */</span>
<a href="#l43.12"></a><span id="l43.12" class="difflineminus">-  nsresult BackUpFilterFile(nsILocalFile *aFilterFile, nsIMsgWindow *aMsgWindow);</span>
<a href="#l43.13"></a><span id="l43.13" class="difflineplus">+  nsresult BackUpFilterFile(nsIFile *aFilterFile, nsIMsgWindow *aMsgWindow);</span>
<a href="#l43.14"></a><span id="l43.14">   nsresult AlertBackingUpFilterFile(nsIMsgWindow *aMsgWindow);</span>
<a href="#l43.15"></a><span id="l43.15">   nsresult ThrowAlertMsg(const char*aMsgName, nsIMsgWindow *aMsgWindow);</span>
<a href="#l43.16"></a><span id="l43.16">   nsresult GetStringFromBundle(const char *aMsgName, PRUnichar **aResult);</span>
<a href="#l43.17"></a><span id="l43.17">   nsresult GetFilterStringBundle(nsIStringBundle **aBundle);</span>
<a href="#l43.18"></a><span id="l43.18"> </span>
<a href="#l43.19"></a><span id="l43.19"> protected:</span>
<a href="#l43.20"></a><span id="l43.20">   nsCOMArray&lt;nsIMsgFilterCustomAction&gt; mCustomActions; // defined custom action list</span>
<a href="#l43.21"></a><span id="l43.21">   nsCOMArray&lt;nsIMsgSearchCustomTerm&gt; mCustomTerms; // defined custom term list</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l44.1"></a><span id="l44.1" class="difflineminus">--- a/mailnews/base/search/src/nsMsgSearchTerm.cpp</span>
<a href="#l44.2"></a><span id="l44.2" class="difflineplus">+++ b/mailnews/base/search/src/nsMsgSearchTerm.cpp</span>
<a href="#l44.3"></a><span id="l44.3" class="difflineat">@@ -20,17 +20,17 @@</span>
<a href="#l44.4"></a><span id="l44.4"> #include &quot;nsMsgSearchNews.h&quot;</span>
<a href="#l44.5"></a><span id="l44.5"> #include &quot;nsMsgSearchValue.h&quot;</span>
<a href="#l44.6"></a><span id="l44.6"> #include &quot;nsMsgI18N.h&quot;</span>
<a href="#l44.7"></a><span id="l44.7"> #include &quot;nsIMimeConverter.h&quot;</span>
<a href="#l44.8"></a><span id="l44.8"> #include &quot;nsMsgMimeCID.h&quot;</span>
<a href="#l44.9"></a><span id="l44.9"> #include &quot;nsIPrefBranch.h&quot;</span>
<a href="#l44.10"></a><span id="l44.10"> #include &quot;nsIPrefService.h&quot;</span>
<a href="#l44.11"></a><span id="l44.11"> #include &quot;nsIMsgFilterPlugin.h&quot;</span>
<a href="#l44.12"></a><span id="l44.12" class="difflineminus">-#include &quot;nsILocalFile.h&quot;</span>
<a href="#l44.13"></a><span id="l44.13" class="difflineplus">+#include &quot;nsIFile.h&quot;</span>
<a href="#l44.14"></a><span id="l44.14"> #include &quot;nsISupportsObsolete.h&quot;</span>
<a href="#l44.15"></a><span id="l44.15"> #include &quot;nsISeekableStream.h&quot;</span>
<a href="#l44.16"></a><span id="l44.16"> #include &quot;nsNetCID.h&quot;</span>
<a href="#l44.17"></a><span id="l44.17"> #include &quot;nsIFileStreams.h&quot;</span>
<a href="#l44.18"></a><span id="l44.18"> #include &quot;nsUnicharUtils.h&quot;</span>
<a href="#l44.19"></a><span id="l44.19"> #include &quot;nsIAbCard.h&quot;</span>
<a href="#l44.20"></a><span id="l44.20"> #include &quot;nsServiceManagerUtils.h&quot;</span>
<a href="#l44.21"></a><span id="l44.21"> #include &quot;nsComponentManagerUtils.h&quot;</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l45.1"></a><span id="l45.1" class="difflineminus">--- a/mailnews/base/src/nsMessenger.cpp</span>
<a href="#l45.2"></a><span id="l45.2" class="difflineplus">+++ b/mailnews/base/src/nsMessenger.cpp</span>
<a href="#l45.3"></a><span id="l45.3" class="difflineat">@@ -6,17 +6,17 @@</span>
<a href="#l45.4"></a><span id="l45.4"> #include &quot;prsystem.h&quot;</span>
<a href="#l45.5"></a><span id="l45.5"> </span>
<a href="#l45.6"></a><span id="l45.6"> #include &quot;nsMessenger.h&quot;</span>
<a href="#l45.7"></a><span id="l45.7"> </span>
<a href="#l45.8"></a><span id="l45.8"> // xpcom</span>
<a href="#l45.9"></a><span id="l45.9"> #include &quot;nsIComponentManager.h&quot;</span>
<a href="#l45.10"></a><span id="l45.10"> #include &quot;nsIServiceManager.h&quot;</span>
<a href="#l45.11"></a><span id="l45.11"> #include &quot;nsIStringStream.h&quot;</span>
<a href="#l45.12"></a><span id="l45.12" class="difflineminus">-#include &quot;nsILocalFile.h&quot;</span>
<a href="#l45.13"></a><span id="l45.13" class="difflineplus">+#include &quot;nsIFile.h&quot;</span>
<a href="#l45.14"></a><span id="l45.14"> #include &quot;nsDirectoryServiceDefs.h&quot;</span>
<a href="#l45.15"></a><span id="l45.15"> #include &quot;nsISupportsObsolete.h&quot;</span>
<a href="#l45.16"></a><span id="l45.16"> #include &quot;nsQuickSort.h&quot;</span>
<a href="#l45.17"></a><span id="l45.17"> #include &quot;nsAutoPtr.h&quot;</span>
<a href="#l45.18"></a><span id="l45.18"> #if defined(XP_MACOSX) &amp;&amp; !defined(__LP64__)</span>
<a href="#l45.19"></a><span id="l45.19"> #include &quot;nsIAppleFileDecoder.h&quot;</span>
<a href="#l45.20"></a><span id="l45.20"> #include &quot;nsILocalFileMac.h&quot;</span>
<a href="#l45.21"></a><span id="l45.21"> #endif</span>
<a href="#l45.22"></a><span id="l45.22" class="difflineat">@@ -311,17 +311,17 @@ NS_IMETHODIMP nsMessenger::SetDisplayCha</span>
<a href="#l45.23"></a><span id="l45.23">       mCurrentDisplayCharset = aCharset;</span>
<a href="#l45.24"></a><span id="l45.24">     }</span>
<a href="#l45.25"></a><span id="l45.25">   }</span>
<a href="#l45.26"></a><span id="l45.26"> </span>
<a href="#l45.27"></a><span id="l45.27">   return NS_OK;</span>
<a href="#l45.28"></a><span id="l45.28"> }</span>
<a href="#l45.29"></a><span id="l45.29"> </span>
<a href="#l45.30"></a><span id="l45.30"> nsresult</span>
<a href="#l45.31"></a><span id="l45.31" class="difflineminus">-nsMessenger::PromptIfFileExists(nsILocalFile *file)</span>
<a href="#l45.32"></a><span id="l45.32" class="difflineplus">+nsMessenger::PromptIfFileExists(nsIFile *file)</span>
<a href="#l45.33"></a><span id="l45.33"> {</span>
<a href="#l45.34"></a><span id="l45.34">   nsresult rv = NS_ERROR_FAILURE;</span>
<a href="#l45.35"></a><span id="l45.35">   bool exists;</span>
<a href="#l45.36"></a><span id="l45.36">   file-&gt;Exists(&amp;exists);</span>
<a href="#l45.37"></a><span id="l45.37">   if (exists)</span>
<a href="#l45.38"></a><span id="l45.38">   {</span>
<a href="#l45.39"></a><span id="l45.39">     nsCOMPtr&lt;nsIPrompt&gt; dialog(do_GetInterface(mDocShell));</span>
<a href="#l45.40"></a><span id="l45.40">     if (!dialog) return rv;</span>
<a href="#l45.41"></a><span id="l45.41" class="difflineat">@@ -347,17 +347,17 @@ nsMessenger::PromptIfFileExists(nsILocal</span>
<a href="#l45.42"></a><span id="l45.42">     if (dialogResult)</span>
<a href="#l45.43"></a><span id="l45.43">     {</span>
<a href="#l45.44"></a><span id="l45.44">       return NS_OK; // user says okay to replace</span>
<a href="#l45.45"></a><span id="l45.45">     }</span>
<a href="#l45.46"></a><span id="l45.46">     else</span>
<a href="#l45.47"></a><span id="l45.47">     {</span>
<a href="#l45.48"></a><span id="l45.48">       // if we don't re-init the path for redisplay the picker will</span>
<a href="#l45.49"></a><span id="l45.49">       // show the full path, not just the file name</span>
<a href="#l45.50"></a><span id="l45.50" class="difflineminus">-      nsCOMPtr&lt;nsILocalFile&gt; currentFile = do_CreateInstance(&quot;@mozilla.org/file/local;1&quot;);</span>
<a href="#l45.51"></a><span id="l45.51" class="difflineplus">+      nsCOMPtr&lt;nsIFile&gt; currentFile = do_CreateInstance(&quot;@mozilla.org/file/local;1&quot;);</span>
<a href="#l45.52"></a><span id="l45.52">       if (!currentFile) return NS_ERROR_FAILURE;</span>
<a href="#l45.53"></a><span id="l45.53"> </span>
<a href="#l45.54"></a><span id="l45.54">       rv = currentFile-&gt;InitWithPath(path);</span>
<a href="#l45.55"></a><span id="l45.55">       NS_ENSURE_SUCCESS(rv, rv);</span>
<a href="#l45.56"></a><span id="l45.56"> </span>
<a href="#l45.57"></a><span id="l45.57">       nsAutoString leafName;</span>
<a href="#l45.58"></a><span id="l45.58">       currentFile-&gt;GetLeafName(leafName);</span>
<a href="#l45.59"></a><span id="l45.59">       if (!leafName.IsEmpty())</span>
<a href="#l45.60"></a><span id="l45.60" class="difflineat">@@ -369,33 +369,33 @@ nsMessenger::PromptIfFileExists(nsILocal</span>
<a href="#l45.61"></a><span id="l45.61">       nsString saveAttachmentStr;</span>
<a href="#l45.62"></a><span id="l45.62">       GetString(NS_LITERAL_STRING(&quot;SaveAttachment&quot;), saveAttachmentStr);</span>
<a href="#l45.63"></a><span id="l45.63">       filePicker-&gt;Init(mWindow,</span>
<a href="#l45.64"></a><span id="l45.64">                        saveAttachmentStr,</span>
<a href="#l45.65"></a><span id="l45.65">                        nsIFilePicker::modeSave);</span>
<a href="#l45.66"></a><span id="l45.66">       filePicker-&gt;SetDefaultString(path);</span>
<a href="#l45.67"></a><span id="l45.67">       filePicker-&gt;AppendFilters(nsIFilePicker::filterAll);</span>
<a href="#l45.68"></a><span id="l45.68"> </span>
<a href="#l45.69"></a><span id="l45.69" class="difflineminus">-      nsCOMPtr &lt;nsILocalFile&gt; lastSaveDir;</span>
<a href="#l45.70"></a><span id="l45.70" class="difflineplus">+      nsCOMPtr &lt;nsIFile&gt; lastSaveDir;</span>
<a href="#l45.71"></a><span id="l45.71">       rv = GetLastSaveDirectory(getter_AddRefs(lastSaveDir));</span>
<a href="#l45.72"></a><span id="l45.72">       if (NS_SUCCEEDED(rv) &amp;&amp; lastSaveDir) {</span>
<a href="#l45.73"></a><span id="l45.73">         filePicker-&gt;SetDisplayDirectory(lastSaveDir);</span>
<a href="#l45.74"></a><span id="l45.74">       }</span>
<a href="#l45.75"></a><span id="l45.75"> </span>
<a href="#l45.76"></a><span id="l45.76">       PRInt16 dialogReturn;</span>
<a href="#l45.77"></a><span id="l45.77">       rv = filePicker-&gt;Show(&amp;dialogReturn);</span>
<a href="#l45.78"></a><span id="l45.78">       if (NS_FAILED(rv) || dialogReturn == nsIFilePicker::returnCancel) {</span>
<a href="#l45.79"></a><span id="l45.79">         // XXX todo</span>
<a href="#l45.80"></a><span id="l45.80">         // don't overload the return value like this</span>
<a href="#l45.81"></a><span id="l45.81">         // change this function to have an out boolean</span>
<a href="#l45.82"></a><span id="l45.82">         // that we check to see if the user cancelled</span>
<a href="#l45.83"></a><span id="l45.83">         return NS_ERROR_FAILURE;</span>
<a href="#l45.84"></a><span id="l45.84">       }</span>
<a href="#l45.85"></a><span id="l45.85"> </span>
<a href="#l45.86"></a><span id="l45.86" class="difflineminus">-      nsCOMPtr&lt;nsILocalFile&gt; localFile;</span>
<a href="#l45.87"></a><span id="l45.87" class="difflineplus">+      nsCOMPtr&lt;nsIFile&gt; localFile;</span>
<a href="#l45.88"></a><span id="l45.88"> </span>
<a href="#l45.89"></a><span id="l45.89">       rv = filePicker-&gt;GetFile(getter_AddRefs(localFile));</span>
<a href="#l45.90"></a><span id="l45.90">       NS_ENSURE_SUCCESS(rv, rv);</span>
<a href="#l45.91"></a><span id="l45.91"> </span>
<a href="#l45.92"></a><span id="l45.92">       rv = SetLastSaveDirectory(localFile);</span>
<a href="#l45.93"></a><span id="l45.93">       NS_ENSURE_SUCCESS(rv,rv);</span>
<a href="#l45.94"></a><span id="l45.94"> </span>
<a href="#l45.95"></a><span id="l45.95">       // reset the file to point to the new path</span>
<a href="#l45.96"></a><span id="l45.96" class="difflineat">@@ -597,21 +597,18 @@ nsMessenger::DetachAttachmentsWOPrompts(</span>
<a href="#l45.97"></a><span id="l45.97">   NS_ENSURE_ARG_POINTER(aDestFolder);</span>
<a href="#l45.98"></a><span id="l45.98">   NS_ENSURE_ARG_POINTER(aContentTypeArray);</span>
<a href="#l45.99"></a><span id="l45.99">   NS_ENSURE_ARG_POINTER(aUrlArray);</span>
<a href="#l45.100"></a><span id="l45.100">   NS_ENSURE_ARG_POINTER(aMessageUriArray);</span>
<a href="#l45.101"></a><span id="l45.101">   NS_ENSURE_ARG_POINTER(aDisplayNameArray);</span>
<a href="#l45.102"></a><span id="l45.102">   if (!aCount)</span>
<a href="#l45.103"></a><span id="l45.103">     return NS_OK;</span>
<a href="#l45.104"></a><span id="l45.104">   nsSaveAllAttachmentsState *saveState;</span>
<a href="#l45.105"></a><span id="l45.105" class="difflineminus">-  nsCOMPtr&lt;nsIFile&gt; clone;</span>
<a href="#l45.106"></a><span id="l45.106" class="difflineminus">-  nsresult rv = aDestFolder-&gt;Clone(getter_AddRefs(clone));</span>
<a href="#l45.107"></a><span id="l45.107" class="difflineminus">-  NS_ENSURE_SUCCESS(rv, rv);</span>
<a href="#l45.108"></a><span id="l45.108" class="difflineminus">-</span>
<a href="#l45.109"></a><span id="l45.109" class="difflineminus">-  nsCOMPtr&lt;nsILocalFile&gt; attachmentDestination(do_QueryInterface(clone, &amp;rv));</span>
<a href="#l45.110"></a><span id="l45.110" class="difflineplus">+  nsCOMPtr&lt;nsIFile&gt; attachmentDestination;</span>
<a href="#l45.111"></a><span id="l45.111" class="difflineplus">+  nsresult rv = aDestFolder-&gt;Clone(getter_AddRefs(attachmentDestination));</span>
<a href="#l45.112"></a><span id="l45.112">   NS_ENSURE_SUCCESS(rv, rv);</span>
<a href="#l45.113"></a><span id="l45.113"> </span>
<a href="#l45.114"></a><span id="l45.114">   nsCAutoString path;</span>
<a href="#l45.115"></a><span id="l45.115">   rv = attachmentDestination-&gt;GetNativePath(path);</span>
<a href="#l45.116"></a><span id="l45.116">   NS_ENSURE_SUCCESS(rv, rv);</span>
<a href="#l45.117"></a><span id="l45.117"> </span>
<a href="#l45.118"></a><span id="l45.118">   nsAutoString unescapedFileName;</span>
<a href="#l45.119"></a><span id="l45.119">   ConvertAndSanitizeFileName(aDisplayNameArray[0], unescapedFileName);</span>
<a href="#l45.120"></a><span id="l45.120" class="difflineat">@@ -758,27 +755,25 @@ nsMessenger::OpenAttachment(const nsACSt</span>
<a href="#l45.121"></a><span id="l45.121">                                           mDocShell, mMsgWindow, nsnull);</span>
<a href="#l45.122"></a><span id="l45.122">   }</span>
<a href="#l45.123"></a><span id="l45.123"> </span>
<a href="#l45.124"></a><span id="l45.124">   return rv;</span>
<a href="#l45.125"></a><span id="l45.125"> }</span>
<a href="#l45.126"></a><span id="l45.126"> </span>
<a href="#l45.127"></a><span id="l45.127"> NS_IMETHODIMP</span>
<a href="#l45.128"></a><span id="l45.128"> nsMessenger::SaveAttachmentToFolder(const nsACString&amp; contentType, const nsACString&amp; url, const nsACString&amp; displayName,</span>
<a href="#l45.129"></a><span id="l45.129" class="difflineminus">-                                    const nsACString&amp; messageUri, nsILocalFile * aDestFolder, nsILocalFile ** aOutFile)</span>
<a href="#l45.130"></a><span id="l45.130" class="difflineplus">+                                    const nsACString&amp; messageUri, nsIFile * aDestFolder, nsIFile ** aOutFile)</span>
<a href="#l45.131"></a><span id="l45.131"> {</span>
<a href="#l45.132"></a><span id="l45.132">   NS_ENSURE_ARG_POINTER(aDestFolder);</span>
<a href="#l45.133"></a><span id="l45.133">   nsresult rv;</span>
<a href="#l45.134"></a><span id="l45.134"> </span>
<a href="#l45.135"></a><span id="l45.135" class="difflineminus">-  nsCOMPtr&lt;nsIFile&gt; clone;</span>
<a href="#l45.136"></a><span id="l45.136" class="difflineminus">-  rv = aDestFolder-&gt;Clone(getter_AddRefs(clone));</span>
<a href="#l45.137"></a><span id="l45.137" class="difflineplus">+  nsCOMPtr&lt;nsIFile&gt; attachmentDestination;</span>
<a href="#l45.138"></a><span id="l45.138" class="difflineplus">+  rv = aDestFolder-&gt;Clone(getter_AddRefs(attachmentDestination));</span>
<a href="#l45.139"></a><span id="l45.139">   NS_ENSURE_SUCCESS(rv, rv);</span>
<a href="#l45.140"></a><span id="l45.140"> </span>
<a href="#l45.141"></a><span id="l45.141" class="difflineminus">-  nsCOMPtr&lt;nsILocalFile&gt; attachmentDestination = do_QueryInterface(clone);</span>
<a href="#l45.142"></a><span id="l45.142" class="difflineminus">-</span>
<a href="#l45.143"></a><span id="l45.143">   nsString unescapedFileName;</span>
<a href="#l45.144"></a><span id="l45.144">   ConvertAndSanitizeFileName(PromiseFlatCString(displayName).get(), unescapedFileName);</span>
<a href="#l45.145"></a><span id="l45.145">   rv = attachmentDestination-&gt;Append(unescapedFileName);</span>
<a href="#l45.146"></a><span id="l45.146">   NS_ENSURE_SUCCESS(rv, rv);</span>
<a href="#l45.147"></a><span id="l45.147"> #ifdef XP_MACOSX</span>
<a href="#l45.148"></a><span id="l45.148">   rv = attachmentDestination-&gt;CreateUnique(nsIFile::NORMAL_FILE_TYPE, ATTACHMENT_PERMISSION);</span>
<a href="#l45.149"></a><span id="l45.149">   NS_ENSURE_SUCCESS(rv, rv);</span>
<a href="#l45.150"></a><span id="l45.150"> #endif</span>
<a href="#l45.151"></a><span id="l45.151" class="difflineat">@@ -809,18 +804,18 @@ nsMessenger::SaveOneAttachment(const cha</span>
<a href="#l45.152"></a><span id="l45.152">                                bool detaching)</span>
<a href="#l45.153"></a><span id="l45.153"> {</span>
<a href="#l45.154"></a><span id="l45.154">   nsresult rv = NS_ERROR_OUT_OF_MEMORY;</span>
<a href="#l45.155"></a><span id="l45.155">   nsCOMPtr&lt;nsIFilePicker&gt; filePicker =</span>
<a href="#l45.156"></a><span id="l45.156">       do_CreateInstance(&quot;@mozilla.org/filepicker;1&quot;, &amp;rv);</span>
<a href="#l45.157"></a><span id="l45.157">   NS_ENSURE_SUCCESS(rv, rv);</span>
<a href="#l45.158"></a><span id="l45.158"> </span>
<a href="#l45.159"></a><span id="l45.159">   PRInt16 dialogResult;</span>
<a href="#l45.160"></a><span id="l45.160" class="difflineminus">-  nsCOMPtr&lt;nsILocalFile&gt; localFile;</span>
<a href="#l45.161"></a><span id="l45.161" class="difflineminus">-  nsCOMPtr&lt;nsILocalFile&gt; lastSaveDir;</span>
<a href="#l45.162"></a><span id="l45.162" class="difflineplus">+  nsCOMPtr&lt;nsIFile&gt; localFile;</span>
<a href="#l45.163"></a><span id="l45.163" class="difflineplus">+  nsCOMPtr&lt;nsIFile&gt; lastSaveDir;</span>
<a href="#l45.164"></a><span id="l45.164">   nsCString filePath;</span>
<a href="#l45.165"></a><span id="l45.165">   nsString saveAttachmentStr;</span>
<a href="#l45.166"></a><span id="l45.166">   nsString defaultDisplayString;</span>
<a href="#l45.167"></a><span id="l45.167">   ConvertAndSanitizeFileName(aDisplayName, defaultDisplayString);</span>
<a href="#l45.168"></a><span id="l45.168"> </span>
<a href="#l45.169"></a><span id="l45.169">   GetString(NS_LITERAL_STRING(&quot;SaveAttachment&quot;), saveAttachmentStr);</span>
<a href="#l45.170"></a><span id="l45.170">   filePicker-&gt;Init(mWindow, saveAttachmentStr,</span>
<a href="#l45.171"></a><span id="l45.171">                    nsIFilePicker::modeSave);</span>
<a href="#l45.172"></a><span id="l45.172" class="difflineat">@@ -876,18 +871,18 @@ nsMessenger::SaveAllAttachments(PRUint32</span>
<a href="#l45.173"></a><span id="l45.173">                                 const char **urlArray,</span>
<a href="#l45.174"></a><span id="l45.174">                                 const char **displayNameArray,</span>
<a href="#l45.175"></a><span id="l45.175">                                 const char **messageUriArray,</span>
<a href="#l45.176"></a><span id="l45.176">                                 bool detaching)</span>
<a href="#l45.177"></a><span id="l45.177"> {</span>
<a href="#l45.178"></a><span id="l45.178">   nsresult rv = NS_ERROR_OUT_OF_MEMORY;</span>
<a href="#l45.179"></a><span id="l45.179">   nsCOMPtr&lt;nsIFilePicker&gt; filePicker =</span>
<a href="#l45.180"></a><span id="l45.180">     do_CreateInstance(&quot;@mozilla.org/filepicker;1&quot;, &amp;rv);</span>
<a href="#l45.181"></a><span id="l45.181" class="difflineminus">-  nsCOMPtr&lt;nsILocalFile&gt; localFile;</span>
<a href="#l45.182"></a><span id="l45.182" class="difflineminus">-  nsCOMPtr&lt;nsILocalFile&gt; lastSaveDir;</span>
<a href="#l45.183"></a><span id="l45.183" class="difflineplus">+  nsCOMPtr&lt;nsIFile&gt; localFile;</span>
<a href="#l45.184"></a><span id="l45.184" class="difflineplus">+  nsCOMPtr&lt;nsIFile&gt; lastSaveDir;</span>
<a href="#l45.185"></a><span id="l45.185">   PRInt16 dialogResult;</span>
<a href="#l45.186"></a><span id="l45.186">   nsString saveAttachmentStr;</span>
<a href="#l45.187"></a><span id="l45.187"> </span>
<a href="#l45.188"></a><span id="l45.188">   NS_ENSURE_SUCCESS(rv, rv);</span>
<a href="#l45.189"></a><span id="l45.189">   GetString(NS_LITERAL_STRING(&quot;SaveAllAttachments&quot;), saveAttachmentStr);</span>
<a href="#l45.190"></a><span id="l45.190">   filePicker-&gt;Init(mWindow,</span>
<a href="#l45.191"></a><span id="l45.191">                    saveAttachmentStr,</span>
<a href="#l45.192"></a><span id="l45.192">                    nsIFilePicker::modeGetFolder);</span>
<a href="#l45.193"></a><span id="l45.193" class="difflineat">@@ -955,17 +950,17 @@ nsMessenger::SaveAs(const nsACString&amp; aU</span>
<a href="#l45.194"></a><span id="l45.194">   PRInt32 saveAsFileType = EML_FILE_TYPE;</span>
<a href="#l45.195"></a><span id="l45.195"> </span>
<a href="#l45.196"></a><span id="l45.196">   nsresult rv = GetMessageServiceFromURI(aURI, getter_AddRefs(messageService));</span>
<a href="#l45.197"></a><span id="l45.197">   if (NS_FAILED(rv))</span>
<a href="#l45.198"></a><span id="l45.198">     goto done;</span>
<a href="#l45.199"></a><span id="l45.199"> </span>
<a href="#l45.200"></a><span id="l45.200">   if (aAsFile)</span>
<a href="#l45.201"></a><span id="l45.201">   {</span>
<a href="#l45.202"></a><span id="l45.202" class="difflineminus">-    nsCOMPtr&lt;nsILocalFile&gt; saveAsFile;</span>
<a href="#l45.203"></a><span id="l45.203" class="difflineplus">+    nsCOMPtr&lt;nsIFile&gt; saveAsFile;</span>
<a href="#l45.204"></a><span id="l45.204">     // show the file picker if BypassFilePicker is not specified (null) or false</span>
<a href="#l45.205"></a><span id="l45.205">     if (!aBypassFilePicker) {</span>
<a href="#l45.206"></a><span id="l45.206">       rv = GetSaveAsFile(aMsgFilename, &amp;saveAsFileType, getter_AddRefs(saveAsFile));</span>
<a href="#l45.207"></a><span id="l45.207">       // A null saveAsFile means that the user canceled the save as</span>
<a href="#l45.208"></a><span id="l45.208">       if (NS_FAILED(rv) || !saveAsFile)</span>
<a href="#l45.209"></a><span id="l45.209">         goto done;</span>
<a href="#l45.210"></a><span id="l45.210">     }</span>
<a href="#l45.211"></a><span id="l45.211">     else {</span>
<a href="#l45.212"></a><span id="l45.212" class="difflineat">@@ -1058,24 +1053,23 @@ nsMessenger::SaveAs(const nsACString&amp; aU</span>
<a href="#l45.213"></a><span id="l45.213"> </span>
<a href="#l45.214"></a><span id="l45.214">       rv = messageService-&gt;DisplayMessage(urlString.get(), convertedListener, mMsgWindow,</span>
<a href="#l45.215"></a><span id="l45.215">         nsnull, nsnull, nsnull);</span>
<a href="#l45.216"></a><span id="l45.216">     }</span>
<a href="#l45.217"></a><span id="l45.217">   }</span>
<a href="#l45.218"></a><span id="l45.218">   else</span>
<a href="#l45.219"></a><span id="l45.219">   {</span>
<a href="#l45.220"></a><span id="l45.220">     // ** save as Template</span>
<a href="#l45.221"></a><span id="l45.221" class="difflineminus">-    nsCOMPtr &lt;nsIFile&gt; tmpTempFile;</span>
<a href="#l45.222"></a><span id="l45.222" class="difflineplus">+    nsCOMPtr &lt;nsIFile&gt; tmpFile;</span>
<a href="#l45.223"></a><span id="l45.223">     nsresult rv = GetSpecialDirectoryWithFileName(NS_OS_TEMP_DIR,</span>
<a href="#l45.224"></a><span id="l45.224">                                                   &quot;nsmail.tmp&quot;,</span>
<a href="#l45.225"></a><span id="l45.225" class="difflineminus">-                                                  getter_AddRefs(tmpTempFile));</span>
<a href="#l45.226"></a><span id="l45.226" class="difflineplus">+                                                  getter_AddRefs(tmpFile));</span>
<a href="#l45.227"></a><span id="l45.227"> </span>
<a href="#l45.228"></a><span id="l45.228">     NS_ENSURE_SUCCESS(rv, rv);</span>
<a href="#l45.229"></a><span id="l45.229"> </span>
<a href="#l45.230"></a><span id="l45.230" class="difflineminus">-    nsCOMPtr &lt;nsILocalFile&gt; tmpFile = do_QueryInterface(tmpTempFile, &amp;rv);</span>
<a href="#l45.231"></a><span id="l45.231">     // For temp file, we should use restrictive 00600 instead of ATTACHMENT_PERMISSION </span>
<a href="#l45.232"></a><span id="l45.232">     rv = tmpFile-&gt;CreateUnique(nsIFile::NORMAL_FILE_TYPE, 00600);</span>
<a href="#l45.233"></a><span id="l45.233">     if (NS_FAILED(rv)) goto done;</span>
<a href="#l45.234"></a><span id="l45.234"> </span>
<a href="#l45.235"></a><span id="l45.235">     // The saveListener is owned by whoever we ultimately register the</span>
<a href="#l45.236"></a><span id="l45.236">     // listener with, generally a URL.</span>
<a href="#l45.237"></a><span id="l45.237">     saveListener = new nsSaveMsgListener(tmpFile, this, nsnull);</span>
<a href="#l45.238"></a><span id="l45.238">     if (!saveListener) {</span>
<a href="#l45.239"></a><span id="l45.239" class="difflineat">@@ -1109,17 +1103,17 @@ done:</span>
<a href="#l45.240"></a><span id="l45.240">     NS_IF_RELEASE(saveListener);</span>
<a href="#l45.241"></a><span id="l45.241">     Alert(&quot;saveMessageFailed&quot;);</span>
<a href="#l45.242"></a><span id="l45.242">   }</span>
<a href="#l45.243"></a><span id="l45.243">   return rv;</span>
<a href="#l45.244"></a><span id="l45.244"> }</span>
<a href="#l45.245"></a><span id="l45.245"> </span>
<a href="#l45.246"></a><span id="l45.246"> nsresult</span>
<a href="#l45.247"></a><span id="l45.247"> nsMessenger::GetSaveAsFile(const nsAString&amp; aMsgFilename, PRInt32 *aSaveAsFileType,</span>
<a href="#l45.248"></a><span id="l45.248" class="difflineminus">-                           nsILocalFile **aSaveAsFile)</span>
<a href="#l45.249"></a><span id="l45.249" class="difflineplus">+                           nsIFile **aSaveAsFile)</span>
<a href="#l45.250"></a><span id="l45.250"> {</span>
<a href="#l45.251"></a><span id="l45.251">   nsresult rv;</span>
<a href="#l45.252"></a><span id="l45.252">   nsCOMPtr&lt;nsIFilePicker&gt; filePicker = do_CreateInstance(&quot;@mozilla.org/filepicker;1&quot;, &amp;rv);</span>
<a href="#l45.253"></a><span id="l45.253">   NS_ENSURE_SUCCESS(rv, rv);</span>
<a href="#l45.254"></a><span id="l45.254">   nsString saveMailAsStr;</span>
<a href="#l45.255"></a><span id="l45.255">   GetString(NS_LITERAL_STRING(&quot;SaveMailAs&quot;), saveMailAsStr);</span>
<a href="#l45.256"></a><span id="l45.256">   filePicker-&gt;Init(mWindow, saveMailAsStr, nsIFilePicker::modeSave);</span>
<a href="#l45.257"></a><span id="l45.257"> </span>
<a href="#l45.258"></a><span id="l45.258" class="difflineat">@@ -1153,22 +1147,22 @@ nsMessenger::GetSaveAsFile(const nsAStri</span>
<a href="#l45.259"></a><span id="l45.259">   // Yes, this is fine even if we ultimately save as HTML or text. On Windows,</span>
<a href="#l45.260"></a><span id="l45.260">   // this actually is a boolean telling the file picker to automatically add</span>
<a href="#l45.261"></a><span id="l45.261">   // the correct extension depending on the filter. On Mac or Linux this is a</span>
<a href="#l45.262"></a><span id="l45.262">   // no-op.</span>
<a href="#l45.263"></a><span id="l45.263">   filePicker-&gt;SetDefaultExtension(NS_LITERAL_STRING(&quot;eml&quot;));</span>
<a href="#l45.264"></a><span id="l45.264"> </span>
<a href="#l45.265"></a><span id="l45.265">   PRInt16 dialogResult;</span>
<a href="#l45.266"></a><span id="l45.266"> </span>
<a href="#l45.267"></a><span id="l45.267" class="difflineminus">-  nsCOMPtr &lt;nsILocalFile&gt; lastSaveDir;</span>
<a href="#l45.268"></a><span id="l45.268" class="difflineplus">+  nsCOMPtr &lt;nsIFile&gt; lastSaveDir;</span>
<a href="#l45.269"></a><span id="l45.269">   rv = GetLastSaveDirectory(getter_AddRefs(lastSaveDir));</span>
<a href="#l45.270"></a><span id="l45.270">   if (NS_SUCCEEDED(rv) &amp;&amp; lastSaveDir)</span>
<a href="#l45.271"></a><span id="l45.271">     filePicker-&gt;SetDisplayDirectory(lastSaveDir);</span>
<a href="#l45.272"></a><span id="l45.272"> </span>
<a href="#l45.273"></a><span id="l45.273" class="difflineminus">-  nsCOMPtr&lt;nsILocalFile&gt; localFile;</span>
<a href="#l45.274"></a><span id="l45.274" class="difflineplus">+  nsCOMPtr&lt;nsIFile&gt; localFile;</span>
<a href="#l45.275"></a><span id="l45.275">   rv = filePicker-&gt;Show(&amp;dialogResult);</span>
<a href="#l45.276"></a><span id="l45.276">   NS_ENSURE_SUCCESS(rv, rv);</span>
<a href="#l45.277"></a><span id="l45.277">   if (dialogResult == nsIFilePicker::returnCancel)</span>
<a href="#l45.278"></a><span id="l45.278">   {</span>
<a href="#l45.279"></a><span id="l45.279">     // We'll indicate this by setting the outparam to null.</span>
<a href="#l45.280"></a><span id="l45.280">     *aSaveAsFile = nsnull;</span>
<a href="#l45.281"></a><span id="l45.281">     return NS_OK;</span>
<a href="#l45.282"></a><span id="l45.282">   }</span>
<a href="#l45.283"></a><span id="l45.283" class="difflineat">@@ -1230,42 +1224,42 @@ nsMessenger::GetSaveAsFile(const nsAStri</span>
<a href="#l45.284"></a><span id="l45.284"> }</span>
<a href="#l45.285"></a><span id="l45.285"> </span>
<a href="#l45.286"></a><span id="l45.286"> /**</span>
<a href="#l45.287"></a><span id="l45.287">  * Show a Save All dialog allowing the user to pick which folder to save</span>
<a href="#l45.288"></a><span id="l45.288">  * messages to.</span>
<a href="#l45.289"></a><span id="l45.289">  * @param [out] aSaveDir directory to save to. Will be null on cancel.</span>
<a href="#l45.290"></a><span id="l45.290">  */</span>
<a href="#l45.291"></a><span id="l45.291"> nsresult</span>
<a href="#l45.292"></a><span id="l45.292" class="difflineminus">-nsMessenger::GetSaveToDir(nsILocalFile **aSaveDir)</span>
<a href="#l45.293"></a><span id="l45.293" class="difflineplus">+nsMessenger::GetSaveToDir(nsIFile **aSaveDir)</span>
<a href="#l45.294"></a><span id="l45.294"> {</span>
<a href="#l45.295"></a><span id="l45.295">   nsresult rv;</span>
<a href="#l45.296"></a><span id="l45.296">   nsCOMPtr&lt;nsIFilePicker&gt; filePicker =</span>
<a href="#l45.297"></a><span id="l45.297">     do_CreateInstance(&quot;@mozilla.org/filepicker;1&quot;, &amp;rv);</span>
<a href="#l45.298"></a><span id="l45.298">   NS_ENSURE_SUCCESS(rv, rv);</span>
<a href="#l45.299"></a><span id="l45.299"> </span>
<a href="#l45.300"></a><span id="l45.300">   nsString chooseFolderStr;</span>
<a href="#l45.301"></a><span id="l45.301">   GetString(NS_LITERAL_STRING(&quot;ChooseFolder&quot;), chooseFolderStr);</span>
<a href="#l45.302"></a><span id="l45.302">   filePicker-&gt;Init(mWindow, chooseFolderStr, nsIFilePicker::modeGetFolder);</span>
<a href="#l45.303"></a><span id="l45.303"> </span>
<a href="#l45.304"></a><span id="l45.304" class="difflineminus">-  nsCOMPtr&lt;nsILocalFile&gt; lastSaveDir;</span>
<a href="#l45.305"></a><span id="l45.305" class="difflineplus">+  nsCOMPtr&lt;nsIFile&gt; lastSaveDir;</span>
<a href="#l45.306"></a><span id="l45.306">   rv = GetLastSaveDirectory(getter_AddRefs(lastSaveDir));</span>
<a href="#l45.307"></a><span id="l45.307">   if (NS_SUCCEEDED(rv) &amp;&amp; lastSaveDir)</span>
<a href="#l45.308"></a><span id="l45.308">     filePicker-&gt;SetDisplayDirectory(lastSaveDir);</span>
<a href="#l45.309"></a><span id="l45.309"> </span>
<a href="#l45.310"></a><span id="l45.310">   PRInt16 dialogResult;</span>
<a href="#l45.311"></a><span id="l45.311">   rv = filePicker-&gt;Show(&amp;dialogResult);</span>
<a href="#l45.312"></a><span id="l45.312">   if (NS_FAILED(rv) || dialogResult == nsIFilePicker::returnCancel)</span>
<a href="#l45.313"></a><span id="l45.313">   {</span>
<a href="#l45.314"></a><span id="l45.314">     // We'll indicate this by setting the outparam to null.</span>
<a href="#l45.315"></a><span id="l45.315">     *aSaveDir = nsnull;</span>
<a href="#l45.316"></a><span id="l45.316">     return NS_OK;</span>
<a href="#l45.317"></a><span id="l45.317">   }</span>
<a href="#l45.318"></a><span id="l45.318"> </span>
<a href="#l45.319"></a><span id="l45.319" class="difflineminus">-  nsCOMPtr&lt;nsILocalFile&gt; dir;</span>
<a href="#l45.320"></a><span id="l45.320" class="difflineplus">+  nsCOMPtr&lt;nsIFile&gt; dir;</span>
<a href="#l45.321"></a><span id="l45.321">   rv = filePicker-&gt;GetFile(getter_AddRefs(dir));</span>
<a href="#l45.322"></a><span id="l45.322">   NS_ENSURE_SUCCESS(rv, rv);</span>
<a href="#l45.323"></a><span id="l45.323"> </span>
<a href="#l45.324"></a><span id="l45.324">   rv = SetLastSaveDirectory(dir);</span>
<a href="#l45.325"></a><span id="l45.325">   NS_ENSURE_SUCCESS(rv, rv);</span>
<a href="#l45.326"></a><span id="l45.326"> </span>
<a href="#l45.327"></a><span id="l45.327">   *aSaveDir = nsnull;</span>
<a href="#l45.328"></a><span id="l45.328">   dir.swap(*aSaveDir);</span>
<a href="#l45.329"></a><span id="l45.329" class="difflineat">@@ -1278,27 +1272,27 @@ nsMessenger::SaveMessages(PRUint32 aCoun</span>
<a href="#l45.330"></a><span id="l45.330">                           const char **aMessageUriArray)</span>
<a href="#l45.331"></a><span id="l45.331"> {</span>
<a href="#l45.332"></a><span id="l45.332">   NS_ENSURE_ARG_MIN(aCount, 1);</span>
<a href="#l45.333"></a><span id="l45.333">   NS_ENSURE_ARG_POINTER(aFilenameArray);</span>
<a href="#l45.334"></a><span id="l45.334">   NS_ENSURE_ARG_POINTER(aMessageUriArray);</span>
<a href="#l45.335"></a><span id="l45.335"> </span>
<a href="#l45.336"></a><span id="l45.336">   nsresult rv;</span>
<a href="#l45.337"></a><span id="l45.337"> </span>
<a href="#l45.338"></a><span id="l45.338" class="difflineminus">-  nsCOMPtr&lt;nsILocalFile&gt; saveDir;</span>
<a href="#l45.339"></a><span id="l45.339" class="difflineplus">+  nsCOMPtr&lt;nsIFile&gt; saveDir;</span>
<a href="#l45.340"></a><span id="l45.340">   rv = GetSaveToDir(getter_AddRefs(saveDir));</span>
<a href="#l45.341"></a><span id="l45.341">   NS_ENSURE_SUCCESS(rv, rv);</span>
<a href="#l45.342"></a><span id="l45.342">   if (!saveDir) // A null saveDir means that the user canceled the save.</span>
<a href="#l45.343"></a><span id="l45.343">     return NS_OK;</span>
<a href="#l45.344"></a><span id="l45.344"> </span>
<a href="#l45.345"></a><span id="l45.345">   for (PRUint32 i = 0; i &lt; aCount; i++) {</span>
<a href="#l45.346"></a><span id="l45.346">     if (!aFilenameArray[i]) // just to be sure</span>
<a href="#l45.347"></a><span id="l45.347">       return NS_ERROR_FAILURE;</span>
<a href="#l45.348"></a><span id="l45.348"> </span>
<a href="#l45.349"></a><span id="l45.349" class="difflineminus">-    nsCOMPtr&lt;nsILocalFile&gt; saveToFile = do_CreateInstance(NS_LOCAL_FILE_CONTRACTID, &amp;rv);</span>
<a href="#l45.350"></a><span id="l45.350" class="difflineplus">+    nsCOMPtr&lt;nsIFile&gt; saveToFile = do_CreateInstance(NS_LOCAL_FILE_CONTRACTID, &amp;rv);</span>
<a href="#l45.351"></a><span id="l45.351">     NS_ENSURE_SUCCESS(rv, rv);</span>
<a href="#l45.352"></a><span id="l45.352">     rv = saveToFile-&gt;InitWithFile(saveDir);</span>
<a href="#l45.353"></a><span id="l45.353">     NS_ENSURE_SUCCESS(rv, rv);</span>
<a href="#l45.354"></a><span id="l45.354"> </span>
<a href="#l45.355"></a><span id="l45.355">     rv = saveToFile-&gt;Append(nsDependentString(aFilenameArray[i]));</span>
<a href="#l45.356"></a><span id="l45.356">     NS_ENSURE_SUCCESS(rv, rv);</span>
<a href="#l45.357"></a><span id="l45.357"> </span>
<a href="#l45.358"></a><span id="l45.358">     rv = PromptIfFileExists(saveToFile);</span>
<a href="#l45.359"></a><span id="l45.359" class="difflineat">@@ -1698,40 +1692,38 @@ nsresult nsSaveMsgListener::InitializeDo</span>
<a href="#l45.360"></a><span id="l45.360">   </span>
<a href="#l45.361"></a><span id="l45.361">   if (!m_contentType.IsEmpty())</span>
<a href="#l45.362"></a><span id="l45.362">   {</span>
<a href="#l45.363"></a><span id="l45.363">     nsCOMPtr&lt;nsIMIMEService&gt; mimeService (do_GetService(NS_MIMESERVICE_CONTRACTID));</span>
<a href="#l45.364"></a><span id="l45.364">     nsCOMPtr&lt;nsIMIMEInfo&gt; mimeinfo;</span>
<a href="#l45.365"></a><span id="l45.365">     </span>
<a href="#l45.366"></a><span id="l45.366">     mimeService-&gt;GetFromTypeAndExtension(m_contentType, EmptyCString(), getter_AddRefs(mimeinfo));</span>
<a href="#l45.367"></a><span id="l45.367">     </span>
<a href="#l45.368"></a><span id="l45.368" class="difflineminus">-    nsCOMPtr&lt;nsILocalFile&gt; outputFile = do_QueryInterface(m_file);</span>
<a href="#l45.369"></a><span id="l45.369" class="difflineminus">-    </span>
<a href="#l45.370"></a><span id="l45.370">     // create a download progress window</span>
<a href="#l45.371"></a><span id="l45.371">     // We don't want to show the progress dialog if the download is really small.</span>
<a href="#l45.372"></a><span id="l45.372">     // but what is a small download? Well that's kind of arbitrary</span>
<a href="#l45.373"></a><span id="l45.373">     // so make an arbitrary decision based on the content length of the</span>
<a href="#l45.374"></a><span id="l45.374">     // attachment -- show it if less than half of the download has completed</span>
<a href="#l45.375"></a><span id="l45.375"> </span>
<a href="#l45.376"></a><span id="l45.376">     // When we don't allow warnings, also don't show progress, as this</span>
<a href="#l45.377"></a><span id="l45.377">     //  is an environment (typically filters) where we don't want</span>
<a href="#l45.378"></a><span id="l45.378">     //  interruption.</span>
<a href="#l45.379"></a><span id="l45.379">     bool allowProgress = true;</span>
<a href="#l45.380"></a><span id="l45.380">     if (m_saveAllAttachmentsState)</span>
<a href="#l45.381"></a><span id="l45.381">       allowProgress = !m_saveAllAttachmentsState-&gt;m_withoutWarning;</span>
<a href="#l45.382"></a><span id="l45.382">     if (allowProgress &amp;&amp; mMaxProgress != -1 &amp;&amp;</span>
<a href="#l45.383"></a><span id="l45.383">         mMaxProgress &gt; aBytesDownloaded * 2)</span>
<a href="#l45.384"></a><span id="l45.384">     {</span>
<a href="#l45.385"></a><span id="l45.385">       nsCOMPtr&lt;nsITransfer&gt; tr = do_CreateInstance(NS_TRANSFER_CONTRACTID, &amp;rv);</span>
<a href="#l45.386"></a><span id="l45.386" class="difflineminus">-      if (tr &amp;&amp; outputFile)</span>
<a href="#l45.387"></a><span id="l45.387" class="difflineplus">+      if (tr &amp;&amp; m_file)</span>
<a href="#l45.388"></a><span id="l45.388">       {</span>
<a href="#l45.389"></a><span id="l45.389">         PRTime timeDownloadStarted = PR_Now();</span>
<a href="#l45.390"></a><span id="l45.390">         </span>
<a href="#l45.391"></a><span id="l45.391">         nsCOMPtr&lt;nsIURI&gt; outputURI;</span>
<a href="#l45.392"></a><span id="l45.392" class="difflineminus">-        NS_NewFileURI(getter_AddRefs(outputURI), outputFile);</span>
<a href="#l45.393"></a><span id="l45.393" class="difflineplus">+        NS_NewFileURI(getter_AddRefs(outputURI), m_file);</span>
<a href="#l45.394"></a><span id="l45.394">         </span>
<a href="#l45.395"></a><span id="l45.395">         nsCOMPtr&lt;nsIURI&gt; url;</span>
<a href="#l45.396"></a><span id="l45.396">         channel-&gt;GetURI(getter_AddRefs(url));</span>
<a href="#l45.397"></a><span id="l45.397">         rv = tr-&gt;Init(url, outputURI, EmptyString(), mimeinfo,</span>
<a href="#l45.398"></a><span id="l45.398">                       timeDownloadStarted, nsnull, this);</span>
<a href="#l45.399"></a><span id="l45.399">         </span>
<a href="#l45.400"></a><span id="l45.400">           // now store the web progresslistener</span>
<a href="#l45.401"></a><span id="l45.401">         mTransfer = tr;</span>
<a href="#l45.402"></a><span id="l45.402" class="difflineat">@@ -1741,17 +1733,17 @@ nsresult nsSaveMsgListener::InitializeDo</span>
<a href="#l45.403"></a><span id="l45.403"> #if defined(XP_MACOSX) &amp;&amp; !defined(__LP64__)</span>
<a href="#l45.404"></a><span id="l45.404">     /* if we are saving an appledouble or applesingle attachment, we need to use an Apple File Decoder */</span>
<a href="#l45.405"></a><span id="l45.405">     if (MsgLowerCaseEqualsLiteral(m_contentType, APPLICATION_APPLEFILE) ||</span>
<a href="#l45.406"></a><span id="l45.406">         MsgLowerCaseEqualsLiteral(m_contentType, MULTIPART_APPLEDOUBLE))</span>
<a href="#l45.407"></a><span id="l45.407">     {</span>
<a href="#l45.408"></a><span id="l45.408">       nsCOMPtr&lt;nsIAppleFileDecoder&gt; appleFileDecoder = do_CreateInstance(NS_IAPPLEFILEDECODER_CONTRACTID, &amp;rv);</span>
<a href="#l45.409"></a><span id="l45.409">       if (NS_SUCCEEDED(rv) &amp;&amp; appleFileDecoder)</span>
<a href="#l45.410"></a><span id="l45.410">       {</span>
<a href="#l45.411"></a><span id="l45.411" class="difflineminus">-        rv = appleFileDecoder-&gt;Initialize(m_outputStream, outputFile);</span>
<a href="#l45.412"></a><span id="l45.412" class="difflineplus">+        rv = appleFileDecoder-&gt;Initialize(m_outputStream, m_file);</span>
<a href="#l45.413"></a><span id="l45.413">         if (NS_SUCCEEDED(rv))</span>
<a href="#l45.414"></a><span id="l45.414">           m_outputStream = do_QueryInterface(appleFileDecoder, &amp;rv);</span>
<a href="#l45.415"></a><span id="l45.415">       }</span>
<a href="#l45.416"></a><span id="l45.416">     }</span>
<a href="#l45.417"></a><span id="l45.417"> #endif // XP_MACOSX</span>
<a href="#l45.418"></a><span id="l45.418">   }</span>
<a href="#l45.419"></a><span id="l45.419">   return rv;</span>
<a href="#l45.420"></a><span id="l45.420"> }</span>
<a href="#l45.421"></a><span id="l45.421" class="difflineat">@@ -1818,17 +1810,17 @@ nsSaveMsgListener::OnStopRequest(nsIRequ</span>
<a href="#l45.422"></a><span id="l45.422">   if (m_saveAllAttachmentsState)</span>
<a href="#l45.423"></a><span id="l45.423">   {</span>
<a href="#l45.424"></a><span id="l45.424">     m_saveAllAttachmentsState-&gt;m_curIndex++;</span>
<a href="#l45.425"></a><span id="l45.425">     if (!mCanceled &amp;&amp; m_saveAllAttachmentsState-&gt;m_curIndex &lt; m_saveAllAttachmentsState-&gt;m_count)</span>
<a href="#l45.426"></a><span id="l45.426">     {</span>
<a href="#l45.427"></a><span id="l45.427">       nsSaveAllAttachmentsState *state = m_saveAllAttachmentsState;</span>
<a href="#l45.428"></a><span id="l45.428">       PRUint32 i = state-&gt;m_curIndex;</span>
<a href="#l45.429"></a><span id="l45.429">       nsString unescapedName;</span>
<a href="#l45.430"></a><span id="l45.430" class="difflineminus">-      nsCOMPtr&lt;nsILocalFile&gt; localFile = do_CreateInstance(NS_LOCAL_FILE_CONTRACTID, &amp;rv);</span>
<a href="#l45.431"></a><span id="l45.431" class="difflineplus">+      nsCOMPtr&lt;nsIFile&gt; localFile = do_CreateInstance(NS_LOCAL_FILE_CONTRACTID, &amp;rv);</span>
<a href="#l45.432"></a><span id="l45.432">       if (NS_FAILED(rv)) goto done;</span>
<a href="#l45.433"></a><span id="l45.433">       rv = localFile-&gt;InitWithNativePath(nsDependentCString(state-&gt;m_directoryName));</span>
<a href="#l45.434"></a><span id="l45.434">       </span>
<a href="#l45.435"></a><span id="l45.435">       if (NS_FAILED(rv)) goto done;</span>
<a href="#l45.436"></a><span id="l45.436">       </span>
<a href="#l45.437"></a><span id="l45.437">       ConvertAndSanitizeFileName(state-&gt;m_displayNameArray[i], unescapedName);</span>
<a href="#l45.438"></a><span id="l45.438">       rv = localFile-&gt;Append(unescapedName);</span>
<a href="#l45.439"></a><span id="l45.439">       if (NS_FAILED(rv))</span>
<a href="#l45.440"></a><span id="l45.440" class="difflineat">@@ -2020,60 +2012,57 @@ nsSaveAllAttachmentsState::~nsSaveAllAtt</span>
<a href="#l45.441"></a><span id="l45.441">     delete[] m_contentTypeArray;</span>
<a href="#l45.442"></a><span id="l45.442">     delete[] m_urlArray;</span>
<a href="#l45.443"></a><span id="l45.443">     delete[] m_displayNameArray;</span>
<a href="#l45.444"></a><span id="l45.444">     delete[] m_messageUriArray;</span>
<a href="#l45.445"></a><span id="l45.445">     NS_Free(m_directoryName);</span>
<a href="#l45.446"></a><span id="l45.446"> }</span>
<a href="#l45.447"></a><span id="l45.447"> </span>
<a href="#l45.448"></a><span id="l45.448"> nsresult</span>
<a href="#l45.449"></a><span id="l45.449" class="difflineminus">-nsMessenger::GetLastSaveDirectory(nsILocalFile **aLastSaveDir)</span>
<a href="#l45.450"></a><span id="l45.450" class="difflineplus">+nsMessenger::GetLastSaveDirectory(nsIFile **aLastSaveDir)</span>
<a href="#l45.451"></a><span id="l45.451"> {</span>
<a href="#l45.452"></a><span id="l45.452">   nsresult rv;</span>
<a href="#l45.453"></a><span id="l45.453">   nsCOMPtr&lt;nsIPrefBranch&gt; prefBranch = do_GetService(NS_PREFSERVICE_CONTRACTID, &amp;rv);</span>
<a href="#l45.454"></a><span id="l45.454">   NS_ENSURE_SUCCESS(rv,rv);</span>
<a href="#l45.455"></a><span id="l45.455"> </span>
<a href="#l45.456"></a><span id="l45.456">   // this can fail, and it will, on the first time we call it, as there is no default for this pref.</span>
<a href="#l45.457"></a><span id="l45.457" class="difflineminus">-  nsCOMPtr &lt;nsILocalFile&gt; localFile;</span>
<a href="#l45.458"></a><span id="l45.458" class="difflineminus">-  rv = prefBranch-&gt;GetComplexValue(MESSENGER_SAVE_DIR_PREF_NAME, NS_GET_IID(nsILocalFile), getter_AddRefs(localFile));</span>
<a href="#l45.459"></a><span id="l45.459" class="difflineplus">+  nsCOMPtr &lt;nsIFile&gt; localFile;</span>
<a href="#l45.460"></a><span id="l45.460" class="difflineplus">+  rv = prefBranch-&gt;GetComplexValue(MESSENGER_SAVE_DIR_PREF_NAME, NS_GET_IID(nsIFile), getter_AddRefs(localFile));</span>
<a href="#l45.461"></a><span id="l45.461">   if (NS_SUCCEEDED(rv)) {</span>
<a href="#l45.462"></a><span id="l45.462">     NS_IF_ADDREF(*aLastSaveDir = localFile);</span>
<a href="#l45.463"></a><span id="l45.463">   }</span>
<a href="#l45.464"></a><span id="l45.464">   return rv;</span>
<a href="#l45.465"></a><span id="l45.465"> }</span>
<a href="#l45.466"></a><span id="l45.466"> </span>
<a href="#l45.467"></a><span id="l45.467"> nsresult</span>
<a href="#l45.468"></a><span id="l45.468" class="difflineminus">-nsMessenger::SetLastSaveDirectory(nsILocalFile *aLocalFile)</span>
<a href="#l45.469"></a><span id="l45.469" class="difflineplus">+nsMessenger::SetLastSaveDirectory(nsIFile *aLocalFile)</span>
<a href="#l45.470"></a><span id="l45.470"> {</span>
<a href="#l45.471"></a><span id="l45.471">   nsresult rv;</span>
<a href="#l45.472"></a><span id="l45.472">   nsCOMPtr&lt;nsIPrefBranch&gt; prefBranch = do_GetService(NS_PREFSERVICE_CONTRACTID, &amp;rv);</span>
<a href="#l45.473"></a><span id="l45.473">   NS_ENSURE_SUCCESS(rv,rv);</span>
<a href="#l45.474"></a><span id="l45.474"> </span>
<a href="#l45.475"></a><span id="l45.475">   nsCOMPtr &lt;nsIFile&gt; file = do_QueryInterface(aLocalFile, &amp;rv);</span>
<a href="#l45.476"></a><span id="l45.476">   NS_ENSURE_SUCCESS(rv,rv);</span>
<a href="#l45.477"></a><span id="l45.477"> </span>
<a href="#l45.478"></a><span id="l45.478">   // if the file is a directory, just use it for the last dir chosen</span>
<a href="#l45.479"></a><span id="l45.479">   // otherwise, use the parent of the file as the last dir chosen.</span>
<a href="#l45.480"></a><span id="l45.480">   // IsDirectory() will return error on saving a file, as the</span>
<a href="#l45.481"></a><span id="l45.481">   // file doesn't exist yet.</span>
<a href="#l45.482"></a><span id="l45.482">   bool isDirectory;</span>
<a href="#l45.483"></a><span id="l45.483">   rv = file-&gt;IsDirectory(&amp;isDirectory);</span>
<a href="#l45.484"></a><span id="l45.484">   if (NS_SUCCEEDED(rv) &amp;&amp; isDirectory) {</span>
<a href="#l45.485"></a><span id="l45.485" class="difflineminus">-    rv = prefBranch-&gt;SetComplexValue(MESSENGER_SAVE_DIR_PREF_NAME, NS_GET_IID(nsILocalFile), aLocalFile);</span>
<a href="#l45.486"></a><span id="l45.486" class="difflineplus">+    rv = prefBranch-&gt;SetComplexValue(MESSENGER_SAVE_DIR_PREF_NAME, NS_GET_IID(nsIFile), aLocalFile);</span>
<a href="#l45.487"></a><span id="l45.487">     NS_ENSURE_SUCCESS(rv,rv);</span>
<a href="#l45.488"></a><span id="l45.488">   }</span>
<a href="#l45.489"></a><span id="l45.489">   else {</span>
<a href="#l45.490"></a><span id="l45.490">     nsCOMPtr &lt;nsIFile&gt; parent;</span>
<a href="#l45.491"></a><span id="l45.491">     rv = file-&gt;GetParent(getter_AddRefs(parent));</span>
<a href="#l45.492"></a><span id="l45.492">     NS_ENSURE_SUCCESS(rv,rv);</span>
<a href="#l45.493"></a><span id="l45.493"> </span>
<a href="#l45.494"></a><span id="l45.494" class="difflineminus">-    nsCOMPtr &lt;nsILocalFile&gt; parentLocalFile = do_QueryInterface(parent, &amp;rv);</span>
<a href="#l45.495"></a><span id="l45.495" class="difflineminus">-    NS_ENSURE_SUCCESS(rv,rv);</span>
<a href="#l45.496"></a><span id="l45.496" class="difflineminus">-</span>
<a href="#l45.497"></a><span id="l45.497" class="difflineminus">-    rv = prefBranch-&gt;SetComplexValue(MESSENGER_SAVE_DIR_PREF_NAME, NS_GET_IID(nsILocalFile), parentLocalFile);</span>
<a href="#l45.498"></a><span id="l45.498" class="difflineplus">+    rv = prefBranch-&gt;SetComplexValue(MESSENGER_SAVE_DIR_PREF_NAME, NS_GET_IID(nsIFile), parent);</span>
<a href="#l45.499"></a><span id="l45.499">     NS_ENSURE_SUCCESS(rv,rv);</span>
<a href="#l45.500"></a><span id="l45.500">   }</span>
<a href="#l45.501"></a><span id="l45.501">   return NS_OK;</span>
<a href="#l45.502"></a><span id="l45.502"> }</span>
<a href="#l45.503"></a><span id="l45.503"> </span>
<a href="#l45.504"></a><span id="l45.504"> /* void getUrisAtNavigatePos (in long aPos, out ACString aFolderUri, out ACString aMsgUri); */</span>
<a href="#l45.505"></a><span id="l45.505"> // aPos is relative to the current history cursor - 1 is forward, -1 is back.</span>
<a href="#l45.506"></a><span id="l45.506"> NS_IMETHODIMP nsMessenger::GetMsgUriAtNavigatePos(PRInt32 aPos, nsACString&amp; aMsgUri)</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l46.1"></a><span id="l46.1" class="difflineminus">--- a/mailnews/base/src/nsMessenger.h</span>
<a href="#l46.2"></a><span id="l46.2" class="difflineplus">+++ b/mailnews/base/src/nsMessenger.h</span>
<a href="#l46.3"></a><span id="l46.3" class="difflineat">@@ -5,20 +5,20 @@</span>
<a href="#l46.4"></a><span id="l46.4"> </span>
<a href="#l46.5"></a><span id="l46.5"> #ifndef __nsMsgAppCore_h</span>
<a href="#l46.6"></a><span id="l46.6"> #define __nsMsgAppCore_h</span>
<a href="#l46.7"></a><span id="l46.7"> </span>
<a href="#l46.8"></a><span id="l46.8"> #include &quot;nscore.h&quot;</span>
<a href="#l46.9"></a><span id="l46.9"> #include &quot;nsIMessenger.h&quot;</span>
<a href="#l46.10"></a><span id="l46.10"> #include &quot;nsCOMPtr.h&quot;</span>
<a href="#l46.11"></a><span id="l46.11"> #include &quot;nsITransactionManager.h&quot;</span>
<a href="#l46.12"></a><span id="l46.12" class="difflineminus">-#include &quot;nsILocalFile.h&quot;</span>
<a href="#l46.13"></a><span id="l46.13" class="difflineplus">+#include &quot;nsIFile.h&quot;</span>
<a href="#l46.14"></a><span id="l46.14"> #include &quot;nsIDocShell.h&quot;</span>
<a href="#l46.15"></a><span id="l46.15"> #include &quot;nsIStringBundle.h&quot;</span>
<a href="#l46.16"></a><span id="l46.16" class="difflineminus">-#include &quot;nsILocalFile.h&quot;</span>
<a href="#l46.17"></a><span id="l46.17" class="difflineplus">+#include &quot;nsIFile.h&quot;</span>
<a href="#l46.18"></a><span id="l46.18"> #include &quot;nsWeakReference.h&quot;</span>
<a href="#l46.19"></a><span id="l46.19"> #include &quot;nsIDOMWindow.h&quot;</span>
<a href="#l46.20"></a><span id="l46.20"> </span>
<a href="#l46.21"></a><span id="l46.21"> class nsMessenger : public nsIMessenger, public nsSupportsWeakReference, public nsIFolderListener</span>
<a href="#l46.22"></a><span id="l46.22"> {</span>
<a href="#l46.23"></a><span id="l46.23"> </span>
<a href="#l46.24"></a><span id="l46.24"> public:</span>
<a href="#l46.25"></a><span id="l46.25">   nsMessenger();</span>
<a href="#l46.26"></a><span id="l46.26" class="difflineat">@@ -28,17 +28,17 @@ public:</span>
<a href="#l46.27"></a><span id="l46.27">   NS_DECL_NSIMESSENGER</span>
<a href="#l46.28"></a><span id="l46.28">   NS_DECL_NSIFOLDERLISTENER</span>
<a href="#l46.29"></a><span id="l46.29"> </span>
<a href="#l46.30"></a><span id="l46.30">   nsresult Alert(const char * stringName);</span>
<a href="#l46.31"></a><span id="l46.31"> </span>
<a href="#l46.32"></a><span id="l46.32">   nsresult SaveAttachment(nsIFile *file, const nsACString&amp; unescapedUrl,</span>
<a href="#l46.33"></a><span id="l46.33">                           const nsACString&amp; messageUri, const nsACString&amp; contentType, </span>
<a href="#l46.34"></a><span id="l46.34">                           void *closure, nsIUrlListener *aListener);</span>
<a href="#l46.35"></a><span id="l46.35" class="difflineminus">-  nsresult PromptIfFileExists(nsILocalFile *file);</span>
<a href="#l46.36"></a><span id="l46.36" class="difflineplus">+  nsresult PromptIfFileExists(nsIFile *file);</span>
<a href="#l46.37"></a><span id="l46.37">   nsresult DetachAttachments(PRUint32 aCount,</span>
<a href="#l46.38"></a><span id="l46.38">                              const char ** aContentTypeArray,</span>
<a href="#l46.39"></a><span id="l46.39">                              const char ** aUrlArray,</span>
<a href="#l46.40"></a><span id="l46.40">                              const char ** aDisplayNameArray,</span>
<a href="#l46.41"></a><span id="l46.41">                              const char ** aMessageUriArray,</span>
<a href="#l46.42"></a><span id="l46.42">                              nsTArray&lt;nsCString&gt; *saveFileUris,</span>
<a href="#l46.43"></a><span id="l46.43">                              bool withoutWarning = false);</span>
<a href="#l46.44"></a><span id="l46.44">   nsresult SaveAllAttachments(PRUint32 count,</span>
<a href="#l46.45"></a><span id="l46.45" class="difflineat">@@ -54,24 +54,24 @@ public:</span>
<a href="#l46.46"></a><span id="l46.46">                              bool detaching);</span>
<a href="#l46.47"></a><span id="l46.47"> </span>
<a href="#l46.48"></a><span id="l46.48"> protected:</span>
<a href="#l46.49"></a><span id="l46.49">   void GetString(const nsString&amp; aStringName, nsString&amp; stringValue);</span>
<a href="#l46.50"></a><span id="l46.50">   nsresult InitStringBundle();</span>
<a href="#l46.51"></a><span id="l46.51">   nsresult PromptIfDeleteAttachments(bool saveFirst, PRUint32 count, const char **displayNameArray);</span>
<a href="#l46.52"></a><span id="l46.52"> </span>
<a href="#l46.53"></a><span id="l46.53"> private:</span>
<a href="#l46.54"></a><span id="l46.54" class="difflineminus">-  nsresult GetLastSaveDirectory(nsILocalFile **aLastSaveAsDir);</span>
<a href="#l46.55"></a><span id="l46.55" class="difflineplus">+  nsresult GetLastSaveDirectory(nsIFile **aLastSaveAsDir);</span>
<a href="#l46.56"></a><span id="l46.56">   // if aLocalFile is a dir, we use it.  otherwise, we use the parent of aLocalFile.</span>
<a href="#l46.57"></a><span id="l46.57" class="difflineminus">-  nsresult SetLastSaveDirectory(nsILocalFile *aLocalFile);</span>
<a href="#l46.58"></a><span id="l46.58" class="difflineplus">+  nsresult SetLastSaveDirectory(nsIFile *aLocalFile);</span>
<a href="#l46.59"></a><span id="l46.59"> </span>
<a href="#l46.60"></a><span id="l46.60">   nsresult GetSaveAsFile(const nsAString&amp; aMsgFilename, PRInt32 *aSaveAsFileType,</span>
<a href="#l46.61"></a><span id="l46.61" class="difflineminus">-                         nsILocalFile **aSaveAsFile);</span>
<a href="#l46.62"></a><span id="l46.62" class="difflineplus">+                         nsIFile **aSaveAsFile);</span>
<a href="#l46.63"></a><span id="l46.63"> </span>
<a href="#l46.64"></a><span id="l46.64" class="difflineminus">-  nsresult GetSaveToDir(nsILocalFile **aSaveToDir);</span>
<a href="#l46.65"></a><span id="l46.65" class="difflineplus">+  nsresult GetSaveToDir(nsIFile **aSaveToDir);</span>
<a href="#l46.66"></a><span id="l46.66"> </span>
<a href="#l46.67"></a><span id="l46.67">   nsString mId;</span>
<a href="#l46.68"></a><span id="l46.68">   nsCOMPtr&lt;nsITransactionManager&gt; mTxnMgr;</span>
<a href="#l46.69"></a><span id="l46.69"> </span>
<a href="#l46.70"></a><span id="l46.70">   /* rhp - need this to drive message display */</span>
<a href="#l46.71"></a><span id="l46.71">   nsCOMPtr&lt;nsIDOMWindow&gt;    mWindow;</span>
<a href="#l46.72"></a><span id="l46.72">   nsCOMPtr&lt;nsIMsgWindow&gt;    mMsgWindow;</span>
<a href="#l46.73"></a><span id="l46.73">   nsCOMPtr&lt;nsIDocShell&gt;     mDocShell;</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l47.1"></a><span id="l47.1" class="difflineminus">--- a/mailnews/base/src/nsMsgAccountManager.cpp</span>
<a href="#l47.2"></a><span id="l47.2" class="difflineplus">+++ b/mailnews/base/src/nsMsgAccountManager.cpp</span>
<a href="#l47.3"></a><span id="l47.3" class="difflineat">@@ -21,17 +21,17 @@</span>
<a href="#l47.4"></a><span id="l47.4"> #include &quot;prthread.h&quot;</span>
<a href="#l47.5"></a><span id="l47.5"> #include &quot;plstr.h&quot;</span>
<a href="#l47.6"></a><span id="l47.6"> #include &quot;nsStringGlue.h&quot;</span>
<a href="#l47.7"></a><span id="l47.7"> #include &quot;nsUnicharUtils.h&quot;</span>
<a href="#l47.8"></a><span id="l47.8"> #include &quot;nscore.h&quot;</span>
<a href="#l47.9"></a><span id="l47.9"> #include &quot;prprf.h&quot;</span>
<a href="#l47.10"></a><span id="l47.10"> #include &quot;nsIMsgFolderCache.h&quot;</span>
<a href="#l47.11"></a><span id="l47.11"> #include &quot;nsMsgUtils.h&quot;</span>
<a href="#l47.12"></a><span id="l47.12" class="difflineminus">-#include &quot;nsILocalFile.h&quot;</span>
<a href="#l47.13"></a><span id="l47.13" class="difflineplus">+#include &quot;nsIFile.h&quot;</span>
<a href="#l47.14"></a><span id="l47.14"> #include &quot;nsIURL.h&quot;</span>
<a href="#l47.15"></a><span id="l47.15"> #include &quot;nsNetCID.h&quot;</span>
<a href="#l47.16"></a><span id="l47.16"> #include &quot;nsIPrefService.h&quot;</span>
<a href="#l47.17"></a><span id="l47.17"> #include &quot;nsIPrefBranch.h&quot;</span>
<a href="#l47.18"></a><span id="l47.18"> #include &quot;nsISmtpService.h&quot;</span>
<a href="#l47.19"></a><span id="l47.19"> #include &quot;nsIMsgBiffManager.h&quot;</span>
<a href="#l47.20"></a><span id="l47.20"> #include &quot;nsIMsgPurgeService.h&quot;</span>
<a href="#l47.21"></a><span id="l47.21"> #include &quot;nsIObserverService.h&quot;</span>
<a href="#l47.22"></a><span id="l47.22" class="difflineat">@@ -2372,17 +2372,17 @@ nsMsgAccountManager::CreateLocalMailAcco</span>
<a href="#l47.23"></a><span id="l47.23">   nsCOMPtr&lt;nsINoIncomingServer&gt; noServer;</span>
<a href="#l47.24"></a><span id="l47.24">   noServer = do_QueryInterface(server, &amp;rv);</span>
<a href="#l47.25"></a><span id="l47.25">   if (NS_FAILED(rv)) return rv;</span>
<a href="#l47.26"></a><span id="l47.26"> </span>
<a href="#l47.27"></a><span id="l47.27">   // create the directory structure for old 4.x &quot;Local Mail&quot;</span>
<a href="#l47.28"></a><span id="l47.28">   // under &lt;profile dir&gt;/Mail/Local Folders or</span>
<a href="#l47.29"></a><span id="l47.29">   // &lt;&quot;mail.directory&quot; pref&gt;/Local Folders</span>
<a href="#l47.30"></a><span id="l47.30">   nsCOMPtr &lt;nsIFile&gt; mailDir;</span>
<a href="#l47.31"></a><span id="l47.31" class="difflineminus">-  nsCOMPtr &lt;nsILocalFile&gt; localFile;</span>
<a href="#l47.32"></a><span id="l47.32" class="difflineplus">+  nsCOMPtr &lt;nsIFile&gt; localFile;</span>
<a href="#l47.33"></a><span id="l47.33">   bool dirExists;</span>
<a href="#l47.34"></a><span id="l47.34"> </span>
<a href="#l47.35"></a><span id="l47.35">   // we want &lt;profile&gt;/Mail</span>
<a href="#l47.36"></a><span id="l47.36">   rv = NS_GetSpecialDirectory(NS_APP_MAIL_50_DIR, getter_AddRefs(mailDir));</span>
<a href="#l47.37"></a><span id="l47.37">   if (NS_FAILED(rv)) return rv;</span>
<a href="#l47.38"></a><span id="l47.38">   localFile = do_QueryInterface(mailDir);</span>
<a href="#l47.39"></a><span id="l47.39"> </span>
<a href="#l47.40"></a><span id="l47.40">   rv = mailDir-&gt;Exists(&amp;dirExists);</span>
<a href="#l47.41"></a><span id="l47.41" class="difflineat">@@ -2942,31 +2942,31 @@ nsresult VirtualFolderChangeListener::Po</span>
<a href="#l47.42"></a><span id="l47.42"> void VirtualFolderChangeListener::ProcessUpdateEvent(nsIMsgFolder *virtFolder,</span>
<a href="#l47.43"></a><span id="l47.43">                                                      nsIMsgDatabase *virtDB)</span>
<a href="#l47.44"></a><span id="l47.44"> {</span>
<a href="#l47.45"></a><span id="l47.45">   m_batchingEvents = false;</span>
<a href="#l47.46"></a><span id="l47.46">   virtFolder-&gt;UpdateSummaryTotals(true); // force update from db.</span>
<a href="#l47.47"></a><span id="l47.47">   virtDB-&gt;Commit(nsMsgDBCommitType::kLargeCommit);</span>
<a href="#l47.48"></a><span id="l47.48"> }</span>
<a href="#l47.49"></a><span id="l47.49"> </span>
<a href="#l47.50"></a><span id="l47.50" class="difflineminus">-nsresult nsMsgAccountManager::GetVirtualFoldersFile(nsCOMPtr&lt;nsILocalFile&gt;&amp; file)</span>
<a href="#l47.51"></a><span id="l47.51" class="difflineplus">+nsresult nsMsgAccountManager::GetVirtualFoldersFile(nsCOMPtr&lt;nsIFile&gt;&amp; file)</span>
<a href="#l47.52"></a><span id="l47.52"> {</span>
<a href="#l47.53"></a><span id="l47.53">   nsCOMPtr&lt;nsIFile&gt; profileDir;</span>
<a href="#l47.54"></a><span id="l47.54">   nsresult rv = NS_GetSpecialDirectory(NS_APP_USER_PROFILE_50_DIR, getter_AddRefs(profileDir));</span>
<a href="#l47.55"></a><span id="l47.55">   NS_ENSURE_SUCCESS(rv, rv);</span>
<a href="#l47.56"></a><span id="l47.56"> </span>
<a href="#l47.57"></a><span id="l47.57">   rv = profileDir-&gt;AppendNative(nsDependentCString(&quot;virtualFolders.dat&quot;));</span>
<a href="#l47.58"></a><span id="l47.58">   if (NS_SUCCEEDED(rv))</span>
<a href="#l47.59"></a><span id="l47.59">     file = do_QueryInterface(profileDir, &amp;rv);</span>
<a href="#l47.60"></a><span id="l47.60">   return rv;</span>
<a href="#l47.61"></a><span id="l47.61"> }</span>
<a href="#l47.62"></a><span id="l47.62"> </span>
<a href="#l47.63"></a><span id="l47.63"> NS_IMETHODIMP nsMsgAccountManager::LoadVirtualFolders()</span>
<a href="#l47.64"></a><span id="l47.64"> {</span>
<a href="#l47.65"></a><span id="l47.65" class="difflineminus">-  nsCOMPtr &lt;nsILocalFile&gt; file;</span>
<a href="#l47.66"></a><span id="l47.66" class="difflineplus">+  nsCOMPtr &lt;nsIFile&gt; file;</span>
<a href="#l47.67"></a><span id="l47.67">   GetVirtualFoldersFile(file);</span>
<a href="#l47.68"></a><span id="l47.68">   if (!file)</span>
<a href="#l47.69"></a><span id="l47.69">     return NS_ERROR_FAILURE;</span>
<a href="#l47.70"></a><span id="l47.70"> </span>
<a href="#l47.71"></a><span id="l47.71">   if (m_virtualFoldersLoaded)</span>
<a href="#l47.72"></a><span id="l47.72">     return NS_OK;</span>
<a href="#l47.73"></a><span id="l47.73"> </span>
<a href="#l47.74"></a><span id="l47.74">   m_loadingVirtualFolders = true;</span>
<a href="#l47.75"></a><span id="l47.75" class="difflineat">@@ -3106,17 +3106,17 @@ NS_IMETHODIMP nsMsgAccountManager::LoadV</span>
<a href="#l47.76"></a><span id="l47.76">   return rv;</span>
<a href="#l47.77"></a><span id="l47.77"> }</span>
<a href="#l47.78"></a><span id="l47.78"> </span>
<a href="#l47.79"></a><span id="l47.79"> NS_IMETHODIMP nsMsgAccountManager::SaveVirtualFolders()</span>
<a href="#l47.80"></a><span id="l47.80"> {</span>
<a href="#l47.81"></a><span id="l47.81">   if (!m_virtualFoldersLoaded)</span>
<a href="#l47.82"></a><span id="l47.82">     return NS_OK;</span>
<a href="#l47.83"></a><span id="l47.83"> </span>
<a href="#l47.84"></a><span id="l47.84" class="difflineminus">-  nsCOMPtr&lt;nsILocalFile&gt; file;</span>
<a href="#l47.85"></a><span id="l47.85" class="difflineplus">+  nsCOMPtr&lt;nsIFile&gt; file;</span>
<a href="#l47.86"></a><span id="l47.86">   GetVirtualFoldersFile(file);</span>
<a href="#l47.87"></a><span id="l47.87"> </span>
<a href="#l47.88"></a><span id="l47.88">   // Open a buffered, safe output stream</span>
<a href="#l47.89"></a><span id="l47.89">   nsCOMPtr&lt;nsIOutputStream&gt; outStreamSink;</span>
<a href="#l47.90"></a><span id="l47.90">   nsresult rv = NS_NewSafeLocalFileOutputStream(getter_AddRefs(outStreamSink),</span>
<a href="#l47.91"></a><span id="l47.91">                                                 file,</span>
<a href="#l47.92"></a><span id="l47.92">                                                 PR_CREATE_FILE | PR_WRONLY | PR_TRUNCATE,</span>
<a href="#l47.93"></a><span id="l47.93">                                                 0664);</span>
<a href="#l47.94"></a><span id="l47.94" class="difflineat">@@ -3678,17 +3678,17 @@ NS_IMETHODIMP nsMsgAccountManager::OnIte</span>
<a href="#l47.95"></a><span id="l47.95"> }</span>
<a href="#l47.96"></a><span id="l47.96"> </span>
<a href="#l47.97"></a><span id="l47.97"> NS_IMETHODIMP nsMsgAccountManager::OnItemEvent(nsIMsgFolder *aFolder, nsIAtom *aEvent)</span>
<a href="#l47.98"></a><span id="l47.98"> {</span>
<a href="#l47.99"></a><span id="l47.99">   return NS_ERROR_NOT_IMPLEMENTED;</span>
<a href="#l47.100"></a><span id="l47.100"> }</span>
<a href="#l47.101"></a><span id="l47.101"> </span>
<a href="#l47.102"></a><span id="l47.102"> NS_IMETHODIMP</span>
<a href="#l47.103"></a><span id="l47.103" class="difflineminus">-nsMsgAccountManager::FolderUriForPath(nsILocalFile *aLocalPath,</span>
<a href="#l47.104"></a><span id="l47.104" class="difflineplus">+nsMsgAccountManager::FolderUriForPath(nsIFile *aLocalPath,</span>
<a href="#l47.105"></a><span id="l47.105">                                                nsACString &amp;aMailboxUri)</span>
<a href="#l47.106"></a><span id="l47.106"> {</span>
<a href="#l47.107"></a><span id="l47.107">   NS_ENSURE_ARG_POINTER(aLocalPath);</span>
<a href="#l47.108"></a><span id="l47.108">   bool equals;</span>
<a href="#l47.109"></a><span id="l47.109">   if (m_lastPathLookedUp &amp;&amp;</span>
<a href="#l47.110"></a><span id="l47.110">       NS_SUCCEEDED(aLocalPath-&gt;Equals(m_lastPathLookedUp, &amp;equals)) &amp;&amp; equals)</span>
<a href="#l47.111"></a><span id="l47.111">   {</span>
<a href="#l47.112"></a><span id="l47.112">     aMailboxUri = m_lastFolderURIForPath;</span>
<a href="#l47.113"></a><span id="l47.113" class="difflineat">@@ -3702,17 +3702,17 @@ nsMsgAccountManager::FolderUriForPath(ns</span>
<a href="#l47.114"></a><span id="l47.114">   rv = folderArray-&gt;GetLength(&amp;count);</span>
<a href="#l47.115"></a><span id="l47.115">   NS_ENSURE_SUCCESS(rv, rv);</span>
<a href="#l47.116"></a><span id="l47.116"> </span>
<a href="#l47.117"></a><span id="l47.117">   for (PRUint32 i = 0; i &lt; count; i++)</span>
<a href="#l47.118"></a><span id="l47.118">   {</span>
<a href="#l47.119"></a><span id="l47.119">     nsCOMPtr&lt;nsIMsgFolder&gt; folder(do_QueryElementAt(folderArray, i, &amp;rv));</span>
<a href="#l47.120"></a><span id="l47.120">     NS_ENSURE_SUCCESS(rv, rv);</span>
<a href="#l47.121"></a><span id="l47.121"> </span>
<a href="#l47.122"></a><span id="l47.122" class="difflineminus">-    nsCOMPtr&lt;nsILocalFile&gt; folderPath;</span>
<a href="#l47.123"></a><span id="l47.123" class="difflineplus">+    nsCOMPtr&lt;nsIFile&gt; folderPath;</span>
<a href="#l47.124"></a><span id="l47.124">     rv = folder-&gt;GetFilePath(getter_AddRefs(folderPath));</span>
<a href="#l47.125"></a><span id="l47.125">     NS_ENSURE_SUCCESS(rv, rv);</span>
<a href="#l47.126"></a><span id="l47.126"> </span>
<a href="#l47.127"></a><span id="l47.127">     // Check if we're equal</span>
<a href="#l47.128"></a><span id="l47.128">     rv = folderPath-&gt;Equals(aLocalPath, &amp;equals);</span>
<a href="#l47.129"></a><span id="l47.129">     NS_ENSURE_SUCCESS(rv, rv);</span>
<a href="#l47.130"></a><span id="l47.130"> </span>
<a href="#l47.131"></a><span id="l47.131">     if (equals)</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l48.1"></a><span id="l48.1" class="difflineminus">--- a/mailnews/base/src/nsMsgAccountManager.h</span>
<a href="#l48.2"></a><span id="l48.2" class="difflineplus">+++ b/mailnews/base/src/nsMsgAccountManager.h</span>
<a href="#l48.3"></a><span id="l48.3" class="difflineat">@@ -193,17 +193,17 @@ private:</span>
<a href="#l48.4"></a><span id="l48.4">   nsresult findServerInternal(const nsACString&amp; username,</span>
<a href="#l48.5"></a><span id="l48.5">                               const nsACString&amp; hostname,</span>
<a href="#l48.6"></a><span id="l48.6">                               const nsACString&amp; type,</span>
<a href="#l48.7"></a><span id="l48.7">                               PRInt32 port,</span>
<a href="#l48.8"></a><span id="l48.8">                               bool aRealFlag,</span>
<a href="#l48.9"></a><span id="l48.9">                               nsIMsgIncomingServer** aResult);</span>
<a href="#l48.10"></a><span id="l48.10"> </span>
<a href="#l48.11"></a><span id="l48.11">   // handle virtual folders</span>
<a href="#l48.12"></a><span id="l48.12" class="difflineminus">-  static nsresult GetVirtualFoldersFile(nsCOMPtr&lt;nsILocalFile&gt;&amp; file);</span>
<a href="#l48.13"></a><span id="l48.13" class="difflineplus">+  static nsresult GetVirtualFoldersFile(nsCOMPtr&lt;nsIFile&gt;&amp; file);</span>
<a href="#l48.14"></a><span id="l48.14">   static nsresult WriteLineToOutputStream(const char *prefix, const char * line, nsIOutputStream *outputStream);</span>
<a href="#l48.15"></a><span id="l48.15">   void     ParseAndVerifyVirtualFolderScope(nsCString &amp;buffer,</span>
<a href="#l48.16"></a><span id="l48.16">                                             nsIRDFService *rdf);</span>
<a href="#l48.17"></a><span id="l48.17">   nsresult AddVFListenersForVF(nsIMsgFolder *virtualFolder,</span>
<a href="#l48.18"></a><span id="l48.18">                                const nsCString&amp; srchFolderUris,</span>
<a href="#l48.19"></a><span id="l48.19">                                nsIRDFService *rdf,</span>
<a href="#l48.20"></a><span id="l48.20">                                nsIMsgDBService *msgDBService);</span>
<a href="#l48.21"></a><span id="l48.21"> </span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l49.1"></a><span id="l49.1" class="difflineminus">--- a/mailnews/base/src/nsMsgFolderCompactor.cpp</span>
<a href="#l49.2"></a><span id="l49.2" class="difflineplus">+++ b/mailnews/base/src/nsMsgFolderCompactor.cpp</span>
<a href="#l49.3"></a><span id="l49.3" class="difflineat">@@ -2,17 +2,17 @@</span>
<a href="#l49.4"></a><span id="l49.4"> /* This Source Code Form is subject to the terms of the Mozilla Public</span>
<a href="#l49.5"></a><span id="l49.5">  * License, v. 2.0. If a copy of the MPL was not distributed with this</span>
<a href="#l49.6"></a><span id="l49.6">  * file, You can obtain one at http://mozilla.org/MPL/2.0/. */</span>
<a href="#l49.7"></a><span id="l49.7"> </span>
<a href="#l49.8"></a><span id="l49.8"> #include &quot;msgCore.h&quot;    // precompiled header...</span>
<a href="#l49.9"></a><span id="l49.9"> #include &quot;nsCOMPtr.h&quot;</span>
<a href="#l49.10"></a><span id="l49.10"> #include &quot;nsIMsgFolder.h&quot;</span>
<a href="#l49.11"></a><span id="l49.11"> #include &quot;nsAutoPtr.h&quot;</span>
<a href="#l49.12"></a><span id="l49.12" class="difflineminus">-#include &quot;nsILocalFile.h&quot;</span>
<a href="#l49.13"></a><span id="l49.13" class="difflineplus">+#include &quot;nsIFile.h&quot;</span>
<a href="#l49.14"></a><span id="l49.14"> #include &quot;nsNetUtil.h&quot;</span>
<a href="#l49.15"></a><span id="l49.15"> #include &quot;nsIMsgHdr.h&quot;</span>
<a href="#l49.16"></a><span id="l49.16"> #include &quot;nsIStreamListener.h&quot;</span>
<a href="#l49.17"></a><span id="l49.17"> #include &quot;nsIMsgMessageService.h&quot;</span>
<a href="#l49.18"></a><span id="l49.18"> #include &quot;nsMsgDBCID.h&quot;</span>
<a href="#l49.19"></a><span id="l49.19"> #include &quot;nsMsgUtils.h&quot;</span>
<a href="#l49.20"></a><span id="l49.20"> #include &quot;nsISeekableStream.h&quot;</span>
<a href="#l49.21"></a><span id="l49.21"> #include &quot;nsIDBFolderInfo.h&quot;</span>
<a href="#l49.22"></a><span id="l49.22" class="difflineat">@@ -75,17 +75,17 @@ void nsFolderCompactState::CloseOutputSt</span>
<a href="#l49.23"></a><span id="l49.23"> </span>
<a href="#l49.24"></a><span id="l49.24"> }</span>
<a href="#l49.25"></a><span id="l49.25"> </span>
<a href="#l49.26"></a><span id="l49.26"> void nsFolderCompactState::CleanupTempFilesAfterError()</span>
<a href="#l49.27"></a><span id="l49.27"> {</span>
<a href="#l49.28"></a><span id="l49.28">   CloseOutputStream();</span>
<a href="#l49.29"></a><span id="l49.29">   if (m_db)</span>
<a href="#l49.30"></a><span id="l49.30">     m_db-&gt;ForceClosed();</span>
<a href="#l49.31"></a><span id="l49.31" class="difflineminus">-  nsCOMPtr &lt;nsILocalFile&gt; summaryFile;</span>
<a href="#l49.32"></a><span id="l49.32" class="difflineplus">+  nsCOMPtr &lt;nsIFile&gt; summaryFile;</span>
<a href="#l49.33"></a><span id="l49.33">   GetSummaryFileLocation(m_file, getter_AddRefs(summaryFile)); </span>
<a href="#l49.34"></a><span id="l49.34">   m_file-&gt;Remove(false);</span>
<a href="#l49.35"></a><span id="l49.35">   summaryFile-&gt;Remove(false);</span>
<a href="#l49.36"></a><span id="l49.36"> }</span>
<a href="#l49.37"></a><span id="l49.37"> </span>
<a href="#l49.38"></a><span id="l49.38"> nsresult nsFolderCompactState::BuildMessageURI(const char *baseURI, PRUint32 key, nsCString&amp; uri)</span>
<a href="#l49.39"></a><span id="l49.39"> {</span>
<a href="#l49.40"></a><span id="l49.40">   uri.Append(baseURI);</span>
<a href="#l49.41"></a><span id="l49.41" class="difflineat">@@ -164,17 +164,17 @@ nsFolderCompactState::Compact(nsIMsgFold</span>
<a href="#l49.42"></a><span id="l49.42">     if (imapFolder)</span>
<a href="#l49.43"></a><span id="l49.43">       return imapFolder-&gt;Expunge(this, aMsgWindow);</span>
<a href="#l49.44"></a><span id="l49.44">   }</span>
<a href="#l49.45"></a><span id="l49.45">    m_window = aMsgWindow;</span>
<a href="#l49.46"></a><span id="l49.46">    nsresult rv;</span>
<a href="#l49.47"></a><span id="l49.47">    nsCOMPtr&lt;nsIMsgDatabase&gt; db;</span>
<a href="#l49.48"></a><span id="l49.48">    nsCOMPtr&lt;nsIDBFolderInfo&gt; folderInfo;</span>
<a href="#l49.49"></a><span id="l49.49">    nsCOMPtr&lt;nsIMsgDatabase&gt; mailDBFactory;</span>
<a href="#l49.50"></a><span id="l49.50" class="difflineminus">-   nsCOMPtr&lt;nsILocalFile&gt; path;</span>
<a href="#l49.51"></a><span id="l49.51" class="difflineplus">+   nsCOMPtr&lt;nsIFile&gt; path;</span>
<a href="#l49.52"></a><span id="l49.52">    nsCString baseMessageURI;</span>
<a href="#l49.53"></a><span id="l49.53"> </span>
<a href="#l49.54"></a><span id="l49.54">    nsCOMPtr &lt;nsIMsgLocalMailFolder&gt; localFolder = do_QueryInterface(folder, &amp;rv);</span>
<a href="#l49.55"></a><span id="l49.55">    if (NS_SUCCEEDED(rv) &amp;&amp; localFolder)</span>
<a href="#l49.56"></a><span id="l49.56">    {</span>
<a href="#l49.57"></a><span id="l49.57">      rv=localFolder-&gt;GetDatabaseWOReparse(getter_AddRefs(db));</span>
<a href="#l49.58"></a><span id="l49.58">      if (NS_FAILED(rv) || !db)</span>
<a href="#l49.59"></a><span id="l49.59">      {</span>
<a href="#l49.60"></a><span id="l49.60" class="difflineat">@@ -244,17 +244,17 @@ nsresult nsFolderCompactState::ShowStatu</span>
<a href="#l49.61"></a><span id="l49.61">     if (statusFeedback &amp;&amp; !aMsg.IsEmpty())</span>
<a href="#l49.62"></a><span id="l49.62">       return statusFeedback-&gt;SetStatusString(aMsg);</span>
<a href="#l49.63"></a><span id="l49.63">   }</span>
<a href="#l49.64"></a><span id="l49.64">   return NS_OK;</span>
<a href="#l49.65"></a><span id="l49.65"> }</span>
<a href="#l49.66"></a><span id="l49.66"> </span>
<a href="#l49.67"></a><span id="l49.67"> nsresult</span>
<a href="#l49.68"></a><span id="l49.68"> nsFolderCompactState::Init(nsIMsgFolder *folder, const char *baseMsgUri, nsIMsgDatabase *db,</span>
<a href="#l49.69"></a><span id="l49.69" class="difflineminus">-                           nsILocalFile *path, nsIMsgWindow *aMsgWindow)</span>
<a href="#l49.70"></a><span id="l49.70" class="difflineplus">+                           nsIFile *path, nsIMsgWindow *aMsgWindow)</span>
<a href="#l49.71"></a><span id="l49.71"> {</span>
<a href="#l49.72"></a><span id="l49.72">   nsresult rv;</span>
<a href="#l49.73"></a><span id="l49.73"> </span>
<a href="#l49.74"></a><span id="l49.74">   m_folder = folder;</span>
<a href="#l49.75"></a><span id="l49.75">   m_baseMessageUri = baseMsgUri;</span>
<a href="#l49.76"></a><span id="l49.76">   m_file = do_CreateInstance(NS_LOCAL_FILE_CONTRACTID, &amp;rv);</span>
<a href="#l49.77"></a><span id="l49.77">   NS_ENSURE_SUCCESS(rv, rv);</span>
<a href="#l49.78"></a><span id="l49.78">   m_file-&gt;InitWithFile(path);</span>
<a href="#l49.79"></a><span id="l49.79" class="difflineat">@@ -368,24 +368,24 @@ nsresult nsFolderCompactState::StartComp</span>
<a href="#l49.80"></a><span id="l49.80"> </span>
<a href="#l49.81"></a><span id="l49.81"> nsresult</span>
<a href="#l49.82"></a><span id="l49.82"> nsFolderCompactState::FinishCompact()</span>
<a href="#l49.83"></a><span id="l49.83"> {</span>
<a href="#l49.84"></a><span id="l49.84">   if (!m_folder)</span>
<a href="#l49.85"></a><span id="l49.85">     return NS_ERROR_NOT_INITIALIZED;</span>
<a href="#l49.86"></a><span id="l49.86"> </span>
<a href="#l49.87"></a><span id="l49.87">   // All okay time to finish up the compact process</span>
<a href="#l49.88"></a><span id="l49.88" class="difflineminus">-  nsCOMPtr&lt;nsILocalFile&gt; path;</span>
<a href="#l49.89"></a><span id="l49.89" class="difflineplus">+  nsCOMPtr&lt;nsIFile&gt; path;</span>
<a href="#l49.90"></a><span id="l49.90">   nsCOMPtr&lt;nsIDBFolderInfo&gt; folderInfo;</span>
<a href="#l49.91"></a><span id="l49.91"> </span>
<a href="#l49.92"></a><span id="l49.92">   // get leaf name and database name of the folder</span>
<a href="#l49.93"></a><span id="l49.93">   nsresult rv = m_folder-&gt;GetFilePath(getter_AddRefs(path));</span>
<a href="#l49.94"></a><span id="l49.94" class="difflineminus">-  nsCOMPtr &lt;nsILocalFile&gt; folderPath = do_CreateInstance(NS_LOCAL_FILE_CONTRACTID, &amp;rv);</span>
<a href="#l49.95"></a><span id="l49.95" class="difflineplus">+  nsCOMPtr &lt;nsIFile&gt; folderPath = do_CreateInstance(NS_LOCAL_FILE_CONTRACTID, &amp;rv);</span>
<a href="#l49.96"></a><span id="l49.96">   NS_ENSURE_SUCCESS(rv, rv);</span>
<a href="#l49.97"></a><span id="l49.97" class="difflineminus">-  nsCOMPtr &lt;nsILocalFile&gt; summaryFile;</span>
<a href="#l49.98"></a><span id="l49.98" class="difflineplus">+  nsCOMPtr &lt;nsIFile&gt; summaryFile;</span>
<a href="#l49.99"></a><span id="l49.99">   folderPath-&gt;InitWithFile(path);</span>
<a href="#l49.100"></a><span id="l49.100">   // need to make sure we put the .msf file in the same directory</span>
<a href="#l49.101"></a><span id="l49.101">   // as the original mailbox, so resolve symlinks.</span>
<a href="#l49.102"></a><span id="l49.102">   folderPath-&gt;SetFollowLinks(true);</span>
<a href="#l49.103"></a><span id="l49.103">   GetSummaryFileLocation(folderPath, getter_AddRefs(summaryFile));</span>
<a href="#l49.104"></a><span id="l49.104"> </span>
<a href="#l49.105"></a><span id="l49.105">   nsCString leafName;</span>
<a href="#l49.106"></a><span id="l49.106">   summaryFile-&gt;GetNativeLeafName(leafName);</span>
<a href="#l49.107"></a><span id="l49.107" class="difflineat">@@ -402,17 +402,17 @@ nsFolderCompactState::FinishCompact()</span>
<a href="#l49.108"></a><span id="l49.108">   // make sure the new database is valid.</span>
<a href="#l49.109"></a><span id="l49.109">   // Close it so we can rename the .msf file.</span>
<a href="#l49.110"></a><span id="l49.110">   if (m_db)</span>
<a href="#l49.111"></a><span id="l49.111">   {</span>
<a href="#l49.112"></a><span id="l49.112">     m_db-&gt;ForceClosed();</span>
<a href="#l49.113"></a><span id="l49.113">     m_db = nsnull;</span>
<a href="#l49.114"></a><span id="l49.114">   }</span>
<a href="#l49.115"></a><span id="l49.115"> </span>
<a href="#l49.116"></a><span id="l49.116" class="difflineminus">-  nsCOMPtr &lt;nsILocalFile&gt; newSummaryFile;</span>
<a href="#l49.117"></a><span id="l49.117" class="difflineplus">+  nsCOMPtr &lt;nsIFile&gt; newSummaryFile;</span>
<a href="#l49.118"></a><span id="l49.118">   GetSummaryFileLocation(m_file, getter_AddRefs(newSummaryFile));</span>
<a href="#l49.119"></a><span id="l49.119"> </span>
<a href="#l49.120"></a><span id="l49.120">   nsCOMPtr &lt;nsIDBFolderInfo&gt; transferInfo;</span>
<a href="#l49.121"></a><span id="l49.121">   m_folder-&gt;GetDBTransferInfo(getter_AddRefs(transferInfo));</span>
<a href="#l49.122"></a><span id="l49.122"> </span>
<a href="#l49.123"></a><span id="l49.123">   // close down database of the original folder</span>
<a href="#l49.124"></a><span id="l49.124">   m_folder-&gt;ForceDBClosed();</span>
<a href="#l49.125"></a><span id="l49.125"> </span>
<a href="#l49.126"></a><span id="l49.126" class="difflineat">@@ -989,17 +989,17 @@ done:</span>
<a href="#l49.127"></a><span id="l49.127">   return rv;</span>
<a href="#l49.128"></a><span id="l49.128"> }</span>
<a href="#l49.129"></a><span id="l49.129">  </span>
<a href="#l49.130"></a><span id="l49.130"> </span>
<a href="#l49.131"></a><span id="l49.131"> nsresult</span>
<a href="#l49.132"></a><span id="l49.132"> nsOfflineStoreCompactState::FinishCompact()</span>
<a href="#l49.133"></a><span id="l49.133"> {</span>
<a href="#l49.134"></a><span id="l49.134">   // All okay time to finish up the compact process</span>
<a href="#l49.135"></a><span id="l49.135" class="difflineminus">-  nsCOMPtr&lt;nsILocalFile&gt; path;</span>
<a href="#l49.136"></a><span id="l49.136" class="difflineplus">+  nsCOMPtr&lt;nsIFile&gt; path;</span>
<a href="#l49.137"></a><span id="l49.137">   PRUint32 flags;</span>
<a href="#l49.138"></a><span id="l49.138"> </span>
<a href="#l49.139"></a><span id="l49.139">     // get leaf name and database name of the folder</span>
<a href="#l49.140"></a><span id="l49.140">   m_folder-&gt;GetFlags(&amp;flags);</span>
<a href="#l49.141"></a><span id="l49.141">   nsresult rv = m_folder-&gt;GetFilePath(getter_AddRefs(path));</span>
<a href="#l49.142"></a><span id="l49.142"> </span>
<a href="#l49.143"></a><span id="l49.143">   nsCString leafName;</span>
<a href="#l49.144"></a><span id="l49.144">   path-&gt;GetNativeLeafName(leafName);</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l50.1"></a><span id="l50.1" class="difflineminus">--- a/mailnews/base/src/nsMsgFolderCompactor.h</span>
<a href="#l50.2"></a><span id="l50.2" class="difflineplus">+++ b/mailnews/base/src/nsMsgFolderCompactor.h</span>
<a href="#l50.3"></a><span id="l50.3" class="difflineat">@@ -36,31 +36,31 @@ public:</span>
<a href="#l50.4"></a><span id="l50.4"> protected:</span>
<a href="#l50.5"></a><span id="l50.5">   virtual nsresult InitDB(nsIMsgDatabase *db);</span>
<a href="#l50.6"></a><span id="l50.6">   virtual nsresult StartCompacting();</span>
<a href="#l50.7"></a><span id="l50.7">   virtual nsresult FinishCompact();</span>
<a href="#l50.8"></a><span id="l50.8">   void CloseOutputStream();</span>
<a href="#l50.9"></a><span id="l50.9">   void  CleanupTempFilesAfterError();</span>
<a href="#l50.10"></a><span id="l50.10"> </span>
<a href="#l50.11"></a><span id="l50.11">   nsresult Init(nsIMsgFolder *aFolder, const char* aBaseMsgUri, nsIMsgDatabase *aDb,</span>
<a href="#l50.12"></a><span id="l50.12" class="difflineminus">-                            nsILocalFile *aPath, nsIMsgWindow *aMsgWindow);</span>
<a href="#l50.13"></a><span id="l50.13" class="difflineplus">+                            nsIFile *aPath, nsIMsgWindow *aMsgWindow);</span>
<a href="#l50.14"></a><span id="l50.14">   nsresult GetMessage(nsIMsgDBHdr **message);</span>
<a href="#l50.15"></a><span id="l50.15">   nsresult BuildMessageURI(const char *baseURI, PRUint32 key, nsCString&amp; uri);</span>
<a href="#l50.16"></a><span id="l50.16">   nsresult ShowStatusMsg(const nsString&amp; aMsg);</span>
<a href="#l50.17"></a><span id="l50.17">   nsresult ReleaseFolderLock();</span>
<a href="#l50.18"></a><span id="l50.18">   void     ShowCompactingStatusMsg();</span>
<a href="#l50.19"></a><span id="l50.19">   void     CompactCompleted(nsresult exitCode);</span>
<a href="#l50.20"></a><span id="l50.20">   void     ShowDoneStatus();</span>
<a href="#l50.21"></a><span id="l50.21">   nsresult CompactNextFolder();</span>
<a href="#l50.22"></a><span id="l50.22"> </span>
<a href="#l50.23"></a><span id="l50.23">   nsCString m_baseMessageUri; // base message uri</span>
<a href="#l50.24"></a><span id="l50.24">   nsCString m_messageUri; // current message uri being copy</span>
<a href="#l50.25"></a><span id="l50.25">   nsCOMPtr&lt;nsIMsgFolder&gt; m_folder; // current folder being compact</span>
<a href="#l50.26"></a><span id="l50.26">   nsCOMPtr&lt;nsIMsgDatabase&gt; m_db; // new database for the compact folder</span>
<a href="#l50.27"></a><span id="l50.27" class="difflineminus">-  nsCOMPtr &lt;nsILocalFile&gt; m_file; // new mailbox for the compact folder</span>
<a href="#l50.28"></a><span id="l50.28" class="difflineplus">+  nsCOMPtr &lt;nsIFile&gt; m_file; // new mailbox for the compact folder</span>
<a href="#l50.29"></a><span id="l50.29">   nsCOMPtr &lt;nsIOutputStream&gt; m_fileStream; // output file stream for writing</span>
<a href="#l50.30"></a><span id="l50.30">   // all message keys that need to be copied over</span>
<a href="#l50.31"></a><span id="l50.31">   nsRefPtr&lt;nsMsgKeyArray&gt; m_keyArray;</span>
<a href="#l50.32"></a><span id="l50.32">   PRUint32 m_size;</span>
<a href="#l50.33"></a><span id="l50.33"> </span>
<a href="#l50.34"></a><span id="l50.34">    // sum of the sizes of the messages, accumulated as we visit each msg.</span>
<a href="#l50.35"></a><span id="l50.35">   PRUint32 m_totalMsgSize;</span>
<a href="#l50.36"></a><span id="l50.36"> </span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l51.1"></a><span id="l51.1" class="difflineminus">--- a/mailnews/base/src/nsSpamSettings.cpp</span>
<a href="#l51.2"></a><span id="l51.2" class="difflineplus">+++ b/mailnews/base/src/nsSpamSettings.cpp</span>
<a href="#l51.3"></a><span id="l51.3" class="difflineat">@@ -1,16 +1,16 @@</span>
<a href="#l51.4"></a><span id="l51.4"> /* -*- Mode: C++; tab-width: 2; indent-tabs-mode: nil; c-basic-offset: 2 -*- */</span>
<a href="#l51.5"></a><span id="l51.5"> /* This Source Code Form is subject to the terms of the Mozilla Public</span>
<a href="#l51.6"></a><span id="l51.6">  * License, v. 2.0. If a copy of the MPL was not distributed with this</span>
<a href="#l51.7"></a><span id="l51.7">  * file, You can obtain one at http://mozilla.org/MPL/2.0/. */</span>
<a href="#l51.8"></a><span id="l51.8"> </span>
<a href="#l51.9"></a><span id="l51.9"> #include &quot;nsSpamSettings.h&quot;</span>
<a href="#l51.10"></a><span id="l51.10"> #include &quot;nsISupportsObsolete.h&quot;</span>
<a href="#l51.11"></a><span id="l51.11" class="difflineminus">-#include &quot;nsILocalFile.h&quot;</span>
<a href="#l51.12"></a><span id="l51.12" class="difflineplus">+#include &quot;nsIFile.h&quot;</span>
<a href="#l51.13"></a><span id="l51.13"> #include &quot;plstr.h&quot;</span>
<a href="#l51.14"></a><span id="l51.14"> #include &quot;prmem.h&quot;</span>
<a href="#l51.15"></a><span id="l51.15"> #include &quot;nsIMsgHdr.h&quot;</span>
<a href="#l51.16"></a><span id="l51.16"> #include &quot;nsNetUtil.h&quot;</span>
<a href="#l51.17"></a><span id="l51.17"> #include &quot;nsIMsgFolder.h&quot;</span>
<a href="#l51.18"></a><span id="l51.18"> #include &quot;nsMsgUtils.h&quot;</span>
<a href="#l51.19"></a><span id="l51.19"> #include &quot;nsMsgFolderFlags.h&quot;</span>
<a href="#l51.20"></a><span id="l51.20"> #include &quot;nsImapCore.h&quot;</span>
<a href="#l51.21"></a><span id="l51.21" class="difflineat">@@ -202,28 +202,25 @@ nsSpamSettings::SetLogStream(nsIOutputSt</span>
<a href="#l51.22"></a><span id="l51.22"> NS_IMETHODIMP</span>
<a href="#l51.23"></a><span id="l51.23"> nsSpamSettings::GetLogStream(nsIOutputStream **aLogStream)</span>
<a href="#l51.24"></a><span id="l51.24"> {</span>
<a href="#l51.25"></a><span id="l51.25">   NS_ENSURE_ARG_POINTER(aLogStream);</span>
<a href="#l51.26"></a><span id="l51.26"> </span>
<a href="#l51.27"></a><span id="l51.27">   nsresult rv;</span>
<a href="#l51.28"></a><span id="l51.28"> </span>
<a href="#l51.29"></a><span id="l51.29">   if (!mLogStream) {</span>
<a href="#l51.30"></a><span id="l51.30" class="difflineminus">-    nsCOMPtr &lt;nsILocalFile&gt; logFile = do_QueryInterface(mLogFile, &amp;rv);</span>
<a href="#l51.31"></a><span id="l51.31" class="difflineminus">-    NS_ENSURE_SUCCESS(rv,rv);</span>
<a href="#l51.32"></a><span id="l51.32" class="difflineminus">-</span>
<a href="#l51.33"></a><span id="l51.33">     // append to the end of the log file</span>
<a href="#l51.34"></a><span id="l51.34">     rv = MsgNewBufferedFileOutputStream(getter_AddRefs(mLogStream),</span>
<a href="#l51.35"></a><span id="l51.35" class="difflineminus">-                                        logFile,</span>
<a href="#l51.36"></a><span id="l51.36" class="difflineplus">+                                        mLogFile,</span>
<a href="#l51.37"></a><span id="l51.37">                                         PR_CREATE_FILE | PR_WRONLY | PR_APPEND,</span>
<a href="#l51.38"></a><span id="l51.38">                                         0600);</span>
<a href="#l51.39"></a><span id="l51.39">     NS_ENSURE_SUCCESS(rv, rv);</span>
<a href="#l51.40"></a><span id="l51.40"> </span>
<a href="#l51.41"></a><span id="l51.41">     PRInt64 fileSize;</span>
<a href="#l51.42"></a><span id="l51.42" class="difflineminus">-    rv = logFile-&gt;GetFileSize(&amp;fileSize);</span>
<a href="#l51.43"></a><span id="l51.43" class="difflineplus">+    rv = mLogFile-&gt;GetFileSize(&amp;fileSize);</span>
<a href="#l51.44"></a><span id="l51.44">     NS_ENSURE_SUCCESS(rv, rv);</span>
<a href="#l51.45"></a><span id="l51.45"> </span>
<a href="#l51.46"></a><span id="l51.46">     PRUint32 fileLen;</span>
<a href="#l51.47"></a><span id="l51.47">     LL_L2UI(fileLen, fileSize);</span>
<a href="#l51.48"></a><span id="l51.48">     // write the header at the start</span>
<a href="#l51.49"></a><span id="l51.49">     if (fileLen == 0)</span>
<a href="#l51.50"></a><span id="l51.50">     {</span>
<a href="#l51.51"></a><span id="l51.51">       PRUint32 writeCount;</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l52.1"></a><span id="l52.1" class="difflineminus">--- a/mailnews/base/util/nsMsgDBFolder.cpp</span>
<a href="#l52.2"></a><span id="l52.2" class="difflineplus">+++ b/mailnews/base/util/nsMsgDBFolder.cpp</span>
<a href="#l52.3"></a><span id="l52.3" class="difflineat">@@ -240,29 +240,29 @@ NS_IMETHODIMP nsMsgDBFolder::ForceDBClos</span>
<a href="#l52.4"></a><span id="l52.4"> NS_IMETHODIMP nsMsgDBFolder::CloseAndBackupFolderDB(const nsACString&amp; newName)</span>
<a href="#l52.5"></a><span id="l52.5"> {</span>
<a href="#l52.6"></a><span id="l52.6">   ForceDBClosed();</span>
<a href="#l52.7"></a><span id="l52.7"> </span>
<a href="#l52.8"></a><span id="l52.8">   // We only support backup for mail at the moment</span>
<a href="#l52.9"></a><span id="l52.9">   if ( !(mFlags &amp; nsMsgFolderFlags::Mail))</span>
<a href="#l52.10"></a><span id="l52.10">     return NS_OK;</span>
<a href="#l52.11"></a><span id="l52.11"> </span>
<a href="#l52.12"></a><span id="l52.12" class="difflineminus">-  nsCOMPtr&lt;nsILocalFile&gt; folderPath;</span>
<a href="#l52.13"></a><span id="l52.13" class="difflineplus">+  nsCOMPtr&lt;nsIFile&gt; folderPath;</span>
<a href="#l52.14"></a><span id="l52.14">   nsresult rv = GetFilePath(getter_AddRefs(folderPath));</span>
<a href="#l52.15"></a><span id="l52.15">   NS_ENSURE_SUCCESS(rv, rv);</span>
<a href="#l52.16"></a><span id="l52.16"> </span>
<a href="#l52.17"></a><span id="l52.17" class="difflineminus">-  nsCOMPtr&lt;nsILocalFile&gt; dbFile;</span>
<a href="#l52.18"></a><span id="l52.18" class="difflineplus">+  nsCOMPtr&lt;nsIFile&gt; dbFile;</span>
<a href="#l52.19"></a><span id="l52.19">   rv = GetSummaryFileLocation(folderPath, getter_AddRefs(dbFile));</span>
<a href="#l52.20"></a><span id="l52.20">   NS_ENSURE_SUCCESS(rv, rv);</span>
<a href="#l52.21"></a><span id="l52.21"> </span>
<a href="#l52.22"></a><span id="l52.22" class="difflineminus">-  nsCOMPtr&lt;nsILocalFile&gt; backupDir;</span>
<a href="#l52.23"></a><span id="l52.23" class="difflineplus">+  nsCOMPtr&lt;nsIFile&gt; backupDir;</span>
<a href="#l52.24"></a><span id="l52.24">   rv = CreateBackupDirectory(getter_AddRefs(backupDir));</span>
<a href="#l52.25"></a><span id="l52.25">   NS_ENSURE_SUCCESS(rv, rv);</span>
<a href="#l52.26"></a><span id="l52.26"> </span>
<a href="#l52.27"></a><span id="l52.27" class="difflineminus">-  nsCOMPtr&lt;nsILocalFile&gt; backupDBFile;</span>
<a href="#l52.28"></a><span id="l52.28" class="difflineplus">+  nsCOMPtr&lt;nsIFile&gt; backupDBFile;</span>
<a href="#l52.29"></a><span id="l52.29">   rv = GetBackupSummaryFile(getter_AddRefs(backupDBFile), newName);</span>
<a href="#l52.30"></a><span id="l52.30">   NS_ENSURE_SUCCESS(rv, rv);</span>
<a href="#l52.31"></a><span id="l52.31"> </span>
<a href="#l52.32"></a><span id="l52.32">   if (mBackupDatabase)</span>
<a href="#l52.33"></a><span id="l52.33">   {</span>
<a href="#l52.34"></a><span id="l52.34">     mBackupDatabase-&gt;ForceClosed();</span>
<a href="#l52.35"></a><span id="l52.35">     mBackupDatabase = nsnull;</span>
<a href="#l52.36"></a><span id="l52.36">   }</span>
<a href="#l52.37"></a><span id="l52.37" class="difflineat">@@ -284,31 +284,31 @@ NS_IMETHODIMP nsMsgDBFolder::CloseAndBac</span>
<a href="#l52.38"></a><span id="l52.38">   else</span>
<a href="#l52.39"></a><span id="l52.39">     return dbFile-&gt;CopyToNative(backupDir, EmptyCString());</span>
<a href="#l52.40"></a><span id="l52.40"> }</span>
<a href="#l52.41"></a><span id="l52.41"> </span>
<a href="#l52.42"></a><span id="l52.42"> NS_IMETHODIMP nsMsgDBFolder::OpenBackupMsgDatabase()</span>
<a href="#l52.43"></a><span id="l52.43"> {</span>
<a href="#l52.44"></a><span id="l52.44">   if (mBackupDatabase)</span>
<a href="#l52.45"></a><span id="l52.45">     return NS_OK;</span>
<a href="#l52.46"></a><span id="l52.46" class="difflineminus">-  nsCOMPtr&lt;nsILocalFile&gt; folderPath;</span>
<a href="#l52.47"></a><span id="l52.47" class="difflineplus">+  nsCOMPtr&lt;nsIFile&gt; folderPath;</span>
<a href="#l52.48"></a><span id="l52.48">   nsresult rv = GetFilePath(getter_AddRefs(folderPath));</span>
<a href="#l52.49"></a><span id="l52.49">   NS_ENSURE_SUCCESS(rv, rv);</span>
<a href="#l52.50"></a><span id="l52.50"> </span>
<a href="#l52.51"></a><span id="l52.51">   nsAutoString folderName;</span>
<a href="#l52.52"></a><span id="l52.52">   rv = folderPath-&gt;GetLeafName(folderName);</span>
<a href="#l52.53"></a><span id="l52.53">   NS_ENSURE_SUCCESS(rv, rv);</span>
<a href="#l52.54"></a><span id="l52.54"> </span>
<a href="#l52.55"></a><span id="l52.55" class="difflineminus">-  nsCOMPtr&lt;nsILocalFile&gt; backupDir;</span>
<a href="#l52.56"></a><span id="l52.56" class="difflineplus">+  nsCOMPtr&lt;nsIFile&gt; backupDir;</span>
<a href="#l52.57"></a><span id="l52.57">   rv = CreateBackupDirectory(getter_AddRefs(backupDir));</span>
<a href="#l52.58"></a><span id="l52.58">   NS_ENSURE_SUCCESS(rv, rv);</span>
<a href="#l52.59"></a><span id="l52.59"> </span>
<a href="#l52.60"></a><span id="l52.60">   // We use a dummy message folder file so we can use</span>
<a href="#l52.61"></a><span id="l52.61">   // GetSummaryFileLocation to get the db file name</span>
<a href="#l52.62"></a><span id="l52.62" class="difflineminus">-  nsCOMPtr&lt;nsILocalFile&gt; backupDBDummyFolder;</span>
<a href="#l52.63"></a><span id="l52.63" class="difflineplus">+  nsCOMPtr&lt;nsIFile&gt; backupDBDummyFolder;</span>
<a href="#l52.64"></a><span id="l52.64">   rv = CreateBackupDirectory(getter_AddRefs(backupDBDummyFolder));</span>
<a href="#l52.65"></a><span id="l52.65">   NS_ENSURE_SUCCESS(rv, rv);</span>
<a href="#l52.66"></a><span id="l52.66">   rv = backupDBDummyFolder-&gt;Append(folderName);</span>
<a href="#l52.67"></a><span id="l52.67">   NS_ENSURE_SUCCESS(rv, rv);</span>
<a href="#l52.68"></a><span id="l52.68"> </span>
<a href="#l52.69"></a><span id="l52.69">   nsCOMPtr&lt;nsIMsgDBService&gt; msgDBService =</span>
<a href="#l52.70"></a><span id="l52.70">       do_GetService(NS_MSGDB_SERVICE_CONTRACTID, &amp;rv);</span>
<a href="#l52.71"></a><span id="l52.71">   NS_ENSURE_SUCCESS(rv, rv);</span>
<a href="#l52.72"></a><span id="l52.72" class="difflineat">@@ -323,37 +323,37 @@ NS_IMETHODIMP nsMsgDBFolder::OpenBackupM</span>
<a href="#l52.73"></a><span id="l52.73">   if (rv == NS_MSG_ERROR_FOLDER_SUMMARY_OUT_OF_DATE)</span>
<a href="#l52.74"></a><span id="l52.74">     // this is normal in reparsing</span>
<a href="#l52.75"></a><span id="l52.75">     rv = NS_OK;</span>
<a href="#l52.76"></a><span id="l52.76">   return rv;</span>
<a href="#l52.77"></a><span id="l52.77"> }</span>
<a href="#l52.78"></a><span id="l52.78"> </span>
<a href="#l52.79"></a><span id="l52.79"> NS_IMETHODIMP nsMsgDBFolder::RemoveBackupMsgDatabase()</span>
<a href="#l52.80"></a><span id="l52.80"> {</span>
<a href="#l52.81"></a><span id="l52.81" class="difflineminus">-  nsCOMPtr&lt;nsILocalFile&gt; folderPath;</span>
<a href="#l52.82"></a><span id="l52.82" class="difflineplus">+  nsCOMPtr&lt;nsIFile&gt; folderPath;</span>
<a href="#l52.83"></a><span id="l52.83">   nsresult rv = GetFilePath(getter_AddRefs(folderPath));</span>
<a href="#l52.84"></a><span id="l52.84">   NS_ENSURE_SUCCESS(rv, rv);</span>
<a href="#l52.85"></a><span id="l52.85"> </span>
<a href="#l52.86"></a><span id="l52.86">   nsAutoString folderName;</span>
<a href="#l52.87"></a><span id="l52.87">   rv = folderPath-&gt;GetLeafName(folderName);</span>
<a href="#l52.88"></a><span id="l52.88">   NS_ENSURE_SUCCESS(rv, rv);</span>
<a href="#l52.89"></a><span id="l52.89"> </span>
<a href="#l52.90"></a><span id="l52.90" class="difflineminus">-  nsCOMPtr&lt;nsILocalFile&gt; backupDir;</span>
<a href="#l52.91"></a><span id="l52.91" class="difflineplus">+  nsCOMPtr&lt;nsIFile&gt; backupDir;</span>
<a href="#l52.92"></a><span id="l52.92">   rv = CreateBackupDirectory(getter_AddRefs(backupDir));</span>
<a href="#l52.93"></a><span id="l52.93">   NS_ENSURE_SUCCESS(rv, rv);</span>
<a href="#l52.94"></a><span id="l52.94"> </span>
<a href="#l52.95"></a><span id="l52.95">   // We use a dummy message folder file so we can use</span>
<a href="#l52.96"></a><span id="l52.96">   // GetSummaryFileLocation to get the db file name</span>
<a href="#l52.97"></a><span id="l52.97" class="difflineminus">-  nsCOMPtr&lt;nsILocalFile&gt; backupDBDummyFolder;</span>
<a href="#l52.98"></a><span id="l52.98" class="difflineplus">+  nsCOMPtr&lt;nsIFile&gt; backupDBDummyFolder;</span>
<a href="#l52.99"></a><span id="l52.99">   rv = CreateBackupDirectory(getter_AddRefs(backupDBDummyFolder));</span>
<a href="#l52.100"></a><span id="l52.100">   NS_ENSURE_SUCCESS(rv, rv);</span>
<a href="#l52.101"></a><span id="l52.101">   rv = backupDBDummyFolder-&gt;Append(folderName);</span>
<a href="#l52.102"></a><span id="l52.102">   NS_ENSURE_SUCCESS(rv, rv);</span>
<a href="#l52.103"></a><span id="l52.103"> </span>
<a href="#l52.104"></a><span id="l52.104" class="difflineminus">-  nsCOMPtr&lt;nsILocalFile&gt; backupDBFile;</span>
<a href="#l52.105"></a><span id="l52.105" class="difflineplus">+  nsCOMPtr&lt;nsIFile&gt; backupDBFile;</span>
<a href="#l52.106"></a><span id="l52.106">   rv = GetSummaryFileLocation(backupDBDummyFolder, getter_AddRefs(backupDBFile));</span>
<a href="#l52.107"></a><span id="l52.107">   NS_ENSURE_SUCCESS(rv, rv);</span>
<a href="#l52.108"></a><span id="l52.108"> </span>
<a href="#l52.109"></a><span id="l52.109">   if (mBackupDatabase)</span>
<a href="#l52.110"></a><span id="l52.110">   {</span>
<a href="#l52.111"></a><span id="l52.111">     mBackupDatabase-&gt;ForceClosed();</span>
<a href="#l52.112"></a><span id="l52.112">     mBackupDatabase = nsnull;</span>
<a href="#l52.113"></a><span id="l52.113">   }</span>
<a href="#l52.114"></a><span id="l52.114" class="difflineat">@@ -568,17 +568,17 @@ void nsMsgDBFolder::UpdateNewMessages()</span>
<a href="#l52.115"></a><span id="l52.115">     }</span>
<a href="#l52.116"></a><span id="l52.116">     SetHasNewMessages(hasNewMessages);</span>
<a href="#l52.117"></a><span id="l52.117">   }</span>
<a href="#l52.118"></a><span id="l52.118"> }</span>
<a href="#l52.119"></a><span id="l52.119"> </span>
<a href="#l52.120"></a><span id="l52.120"> // helper function that gets the cache element that corresponds to the passed in file spec.</span>
<a href="#l52.121"></a><span id="l52.121"> // This could be static, or could live in another class - it's not specific to the current</span>
<a href="#l52.122"></a><span id="l52.122"> // nsMsgDBFolder. If it lived at a higher level, we could cache the account manager and folder cache.</span>
<a href="#l52.123"></a><span id="l52.123" class="difflineminus">-nsresult nsMsgDBFolder::GetFolderCacheElemFromFile(nsILocalFile *file, nsIMsgFolderCacheElement **cacheElement)</span>
<a href="#l52.124"></a><span id="l52.124" class="difflineplus">+nsresult nsMsgDBFolder::GetFolderCacheElemFromFile(nsIFile *file, nsIMsgFolderCacheElement **cacheElement)</span>
<a href="#l52.125"></a><span id="l52.125"> {</span>
<a href="#l52.126"></a><span id="l52.126">   nsresult result;</span>
<a href="#l52.127"></a><span id="l52.127">   NS_ENSURE_ARG_POINTER(file);</span>
<a href="#l52.128"></a><span id="l52.128">   NS_ENSURE_ARG_POINTER(cacheElement);</span>
<a href="#l52.129"></a><span id="l52.129">   nsCOMPtr &lt;nsIMsgFolderCache&gt; folderCache;</span>
<a href="#l52.130"></a><span id="l52.130"> #ifdef DEBUG_bienvenu1</span>
<a href="#l52.131"></a><span id="l52.131">   bool exists;</span>
<a href="#l52.132"></a><span id="l52.132">   NS_ASSERTION(NS_SUCCEEDED(fileSpec-&gt;Exists(&amp;exists)) &amp;&amp; exists, &quot;whoops, file doesn't exist, mac will break&quot;);</span>
<a href="#l52.133"></a><span id="l52.133" class="difflineat">@@ -604,17 +604,17 @@ nsresult nsMsgDBFolder::ReadDBFolderInfo</span>
<a href="#l52.134"></a><span id="l52.134">   // the DBs all the time, if we have to open it once, get everything</span>
<a href="#l52.135"></a><span id="l52.135">   // we might need while we're here</span>
<a href="#l52.136"></a><span id="l52.136">   nsresult result = NS_OK;</span>
<a href="#l52.137"></a><span id="l52.137"> </span>
<a href="#l52.138"></a><span id="l52.138">   // don't need to reload from cache if we've already read from cache,</span>
<a href="#l52.139"></a><span id="l52.139">   // and, we might get stale info, so don't do it.</span>
<a href="#l52.140"></a><span id="l52.140">   if (!mInitializedFromCache)</span>
<a href="#l52.141"></a><span id="l52.141">   {</span>
<a href="#l52.142"></a><span id="l52.142" class="difflineminus">-    nsCOMPtr &lt;nsILocalFile&gt; dbPath;</span>
<a href="#l52.143"></a><span id="l52.143" class="difflineplus">+    nsCOMPtr &lt;nsIFile&gt; dbPath;</span>
<a href="#l52.144"></a><span id="l52.144">     result = GetFolderCacheKey(getter_AddRefs(dbPath), true /* createDBIfMissing */);</span>
<a href="#l52.145"></a><span id="l52.145">     if (dbPath)</span>
<a href="#l52.146"></a><span id="l52.146">     {</span>
<a href="#l52.147"></a><span id="l52.147">       nsCOMPtr &lt;nsIMsgFolderCacheElement&gt; cacheElement;</span>
<a href="#l52.148"></a><span id="l52.148">       result = GetFolderCacheElemFromFile(dbPath, getter_AddRefs(cacheElement));</span>
<a href="#l52.149"></a><span id="l52.149">       if (NS_SUCCEEDED(result) &amp;&amp; cacheElement)</span>
<a href="#l52.150"></a><span id="l52.150">         result = ReadFromFolderCacheElem(cacheElement);</span>
<a href="#l52.151"></a><span id="l52.151">     }</span>
<a href="#l52.152"></a><span id="l52.152" class="difflineat">@@ -713,27 +713,27 @@ NS_IMETHODIMP nsMsgDBFolder::GetMsgStore</span>
<a href="#l52.153"></a><span id="l52.153"> {</span>
<a href="#l52.154"></a><span id="l52.154">   NS_ENSURE_ARG_POINTER(aStore);</span>
<a href="#l52.155"></a><span id="l52.155">   nsCOMPtr&lt;nsIMsgIncomingServer&gt; server;</span>
<a href="#l52.156"></a><span id="l52.156">   nsresult rv = GetServer(getter_AddRefs(server));</span>
<a href="#l52.157"></a><span id="l52.157">   NS_ENSURE_SUCCESS(rv, NS_MSG_INVALID_OR_MISSING_SERVER);</span>
<a href="#l52.158"></a><span id="l52.158">   return server-&gt;GetMsgStore(aStore);</span>
<a href="#l52.159"></a><span id="l52.159"> }</span>
<a href="#l52.160"></a><span id="l52.160"> </span>
<a href="#l52.161"></a><span id="l52.161" class="difflineminus">-nsresult nsMsgDBFolder::GetSummaryFile(nsILocalFile** aSummaryFile)</span>
<a href="#l52.162"></a><span id="l52.162" class="difflineplus">+nsresult nsMsgDBFolder::GetSummaryFile(nsIFile** aSummaryFile)</span>
<a href="#l52.163"></a><span id="l52.163"> {</span>
<a href="#l52.164"></a><span id="l52.164">   nsCOMPtr&lt;nsIMsgPluggableStore&gt; msgStore;</span>
<a href="#l52.165"></a><span id="l52.165">   nsresult rv = GetMsgStore(getter_AddRefs(msgStore));</span>
<a href="#l52.166"></a><span id="l52.166">   NS_ENSURE_SUCCESS(rv, rv);</span>
<a href="#l52.167"></a><span id="l52.167">   return msgStore-&gt;GetSummaryFile(this, aSummaryFile);</span>
<a href="#l52.168"></a><span id="l52.168"> }</span>
<a href="#l52.169"></a><span id="l52.169"> </span>
<a href="#l52.170"></a><span id="l52.170"> NS_IMETHODIMP nsMsgDBFolder::GetOfflineStoreInputStream(nsIInputStream **stream)</span>
<a href="#l52.171"></a><span id="l52.171"> {</span>
<a href="#l52.172"></a><span id="l52.172" class="difflineminus">-  nsCOMPtr &lt;nsILocalFile&gt; localStore;</span>
<a href="#l52.173"></a><span id="l52.173" class="difflineplus">+  nsCOMPtr &lt;nsIFile&gt; localStore;</span>
<a href="#l52.174"></a><span id="l52.174">   nsresult rv = GetFilePath(getter_AddRefs(localStore));</span>
<a href="#l52.175"></a><span id="l52.175">   NS_ENSURE_SUCCESS(rv, rv);</span>
<a href="#l52.176"></a><span id="l52.176">   return NS_NewLocalFileInputStream(stream, localStore);</span>
<a href="#l52.177"></a><span id="l52.177"> }</span>
<a href="#l52.178"></a><span id="l52.178"> </span>
<a href="#l52.179"></a><span id="l52.179"> bool nsMsgDBFolder::VerifyOfflineMessage(nsIMsgDBHdr *msgHdr, nsIInputStream *fileStream)</span>
<a href="#l52.180"></a><span id="l52.180"> {</span>
<a href="#l52.181"></a><span id="l52.181">   nsCOMPtr &lt;nsISeekableStream&gt; seekableStream = do_QueryInterface(fileStream);</span>
<a href="#l52.182"></a><span id="l52.182" class="difflineat">@@ -870,17 +870,17 @@ nsMsgDBFolder::GetMsgInputStream(nsIMsgD</span>
<a href="#l52.183"></a><span id="l52.183">     rv = seekableStream-&gt;Seek(PR_SEEK_SET, offset);</span>
<a href="#l52.184"></a><span id="l52.184">   NS_WARN_IF_FALSE(seekableStream || !offset,</span>
<a href="#l52.185"></a><span id="l52.185">                    &quot;non-zero offset w/ non-seekable stream&quot;);</span>
<a href="#l52.186"></a><span id="l52.186">   return rv;</span>
<a href="#l52.187"></a><span id="l52.187"> }</span>
<a href="#l52.188"></a><span id="l52.188"> </span>
<a href="#l52.189"></a><span id="l52.189"> // path coming in is the root path without the leaf name,</span>
<a href="#l52.190"></a><span id="l52.190"> // on the way out, it's the whole path.</span>
<a href="#l52.191"></a><span id="l52.191" class="difflineminus">-nsresult nsMsgDBFolder::CreateFileForDB(const nsAString&amp; userLeafName, nsILocalFile *path, nsILocalFile **dbFile)</span>
<a href="#l52.192"></a><span id="l52.192" class="difflineplus">+nsresult nsMsgDBFolder::CreateFileForDB(const nsAString&amp; userLeafName, nsIFile *path, nsIFile **dbFile)</span>
<a href="#l52.193"></a><span id="l52.193"> {</span>
<a href="#l52.194"></a><span id="l52.194">   NS_ENSURE_ARG_POINTER(dbFile);</span>
<a href="#l52.195"></a><span id="l52.195"> </span>
<a href="#l52.196"></a><span id="l52.196">   nsAutoString proposedDBName(userLeafName);</span>
<a href="#l52.197"></a><span id="l52.197">   NS_MsgHashIfNecessary(proposedDBName);</span>
<a href="#l52.198"></a><span id="l52.198"> </span>
<a href="#l52.199"></a><span id="l52.199">   // (note, the caller of this will be using the dbFile to call db-&gt;Open()</span>
<a href="#l52.200"></a><span id="l52.200">   // will turn the path into summary file path, and append the &quot;.msf&quot; extension)</span>
<a href="#l52.201"></a><span id="l52.201" class="difflineat">@@ -888,17 +888,17 @@ nsresult nsMsgDBFolder::CreateFileForDB(</span>
<a href="#l52.202"></a><span id="l52.202">   // we want db-&gt;Open() to create a new summary file</span>
<a href="#l52.203"></a><span id="l52.203">   // so we have to jump through some hoops to make sure the .msf it will</span>
<a href="#l52.204"></a><span id="l52.204">   // create is unique.  now that we've got the &quot;safe&quot; proposedDBName,</span>
<a href="#l52.205"></a><span id="l52.205">   // we append &quot;.msf&quot; to see if the file exists.  if so, we make the name</span>
<a href="#l52.206"></a><span id="l52.206">   // unique and then string off the &quot;.msf&quot; so that we pass the right thing</span>
<a href="#l52.207"></a><span id="l52.207">   // into Open().  this isn't ideal, since this is not atomic</span>
<a href="#l52.208"></a><span id="l52.208">   // but it will make do.</span>
<a href="#l52.209"></a><span id="l52.209">   nsresult rv;</span>
<a href="#l52.210"></a><span id="l52.210" class="difflineminus">-  nsCOMPtr &lt;nsILocalFile&gt; dbPath = do_CreateInstance(NS_LOCAL_FILE_CONTRACTID, &amp;rv);</span>
<a href="#l52.211"></a><span id="l52.211" class="difflineplus">+  nsCOMPtr &lt;nsIFile&gt; dbPath = do_CreateInstance(NS_LOCAL_FILE_CONTRACTID, &amp;rv);</span>
<a href="#l52.212"></a><span id="l52.212">   NS_ENSURE_SUCCESS(rv, rv);</span>
<a href="#l52.213"></a><span id="l52.213">   dbPath-&gt;InitWithFile(path);</span>
<a href="#l52.214"></a><span id="l52.214">   proposedDBName.AppendLiteral(SUMMARY_SUFFIX);</span>
<a href="#l52.215"></a><span id="l52.215">   dbPath-&gt;Append(proposedDBName);</span>
<a href="#l52.216"></a><span id="l52.216">   bool exists;</span>
<a href="#l52.217"></a><span id="l52.217">   dbPath-&gt;Exists(&amp;exists);</span>
<a href="#l52.218"></a><span id="l52.218">   if (exists)</span>
<a href="#l52.219"></a><span id="l52.219">   {</span>
<a href="#l52.220"></a><span id="l52.220" class="difflineat">@@ -1252,37 +1252,37 @@ NS_IMETHODIMP nsMsgDBFolder::ReadFromFol</span>
<a href="#l52.221"></a><span id="l52.221">   nsCString uri;</span>
<a href="#l52.222"></a><span id="l52.222">   GetURI(uri);</span>
<a href="#l52.223"></a><span id="l52.223">   printf(&quot;read total %ld for %s\n&quot;, mNumTotalMessages, uri.get());</span>
<a href="#l52.224"></a><span id="l52.224"> #endif</span>
<a href="#l52.225"></a><span id="l52.225">   mInitializedFromCache = true;</span>
<a href="#l52.226"></a><span id="l52.226">   return rv;</span>
<a href="#l52.227"></a><span id="l52.227"> }</span>
<a href="#l52.228"></a><span id="l52.228"> </span>
<a href="#l52.229"></a><span id="l52.229" class="difflineminus">-nsresult nsMsgDBFolder::GetFolderCacheKey(nsILocalFile **aFile, bool createDBIfMissing /* = false */)</span>
<a href="#l52.230"></a><span id="l52.230" class="difflineplus">+nsresult nsMsgDBFolder::GetFolderCacheKey(nsIFile **aFile, bool createDBIfMissing /* = false */)</span>
<a href="#l52.231"></a><span id="l52.231"> {</span>
<a href="#l52.232"></a><span id="l52.232">   nsresult rv;</span>
<a href="#l52.233"></a><span id="l52.233" class="difflineminus">-  nsCOMPtr &lt;nsILocalFile&gt; path;</span>
<a href="#l52.234"></a><span id="l52.234" class="difflineplus">+  nsCOMPtr &lt;nsIFile&gt; path;</span>
<a href="#l52.235"></a><span id="l52.235">   rv = GetFilePath(getter_AddRefs(path));</span>
<a href="#l52.236"></a><span id="l52.236"> </span>
<a href="#l52.237"></a><span id="l52.237">   // now we put a new file  in aFile, because we're going to change it.</span>
<a href="#l52.238"></a><span id="l52.238" class="difflineminus">-  nsCOMPtr &lt;nsILocalFile&gt; dbPath = do_CreateInstance(NS_LOCAL_FILE_CONTRACTID, &amp;rv);</span>
<a href="#l52.239"></a><span id="l52.239" class="difflineplus">+  nsCOMPtr &lt;nsIFile&gt; dbPath = do_CreateInstance(NS_LOCAL_FILE_CONTRACTID, &amp;rv);</span>
<a href="#l52.240"></a><span id="l52.240">   NS_ENSURE_SUCCESS(rv, rv);</span>
<a href="#l52.241"></a><span id="l52.241"> </span>
<a href="#l52.242"></a><span id="l52.242">   if (dbPath)</span>
<a href="#l52.243"></a><span id="l52.243">   {</span>
<a href="#l52.244"></a><span id="l52.244">     dbPath-&gt;InitWithFile(path);</span>
<a href="#l52.245"></a><span id="l52.245">     // if not a server, we need to convert to a db Path with .msf on the end</span>
<a href="#l52.246"></a><span id="l52.246">     bool isServer = false;</span>
<a href="#l52.247"></a><span id="l52.247">     GetIsServer(&amp;isServer);</span>
<a href="#l52.248"></a><span id="l52.248"> </span>
<a href="#l52.249"></a><span id="l52.249">     // if it's a server, we don't need the .msf appended to the name</span>
<a href="#l52.250"></a><span id="l52.250">     if (!isServer)</span>
<a href="#l52.251"></a><span id="l52.251">     {</span>
<a href="#l52.252"></a><span id="l52.252" class="difflineminus">-      nsCOMPtr &lt;nsILocalFile&gt; summaryName;</span>
<a href="#l52.253"></a><span id="l52.253" class="difflineplus">+      nsCOMPtr &lt;nsIFile&gt; summaryName;</span>
<a href="#l52.254"></a><span id="l52.254">       rv = GetSummaryFileLocation(dbPath, getter_AddRefs(summaryName));</span>
<a href="#l52.255"></a><span id="l52.255">       dbPath-&gt;InitWithFile(summaryName);</span>
<a href="#l52.256"></a><span id="l52.256"> </span>
<a href="#l52.257"></a><span id="l52.257">       // create the .msf file</span>
<a href="#l52.258"></a><span id="l52.258">       // see bug #244217 for details</span>
<a href="#l52.259"></a><span id="l52.259">       bool exists;</span>
<a href="#l52.260"></a><span id="l52.260">       if (createDBIfMissing &amp;&amp; NS_SUCCEEDED(dbPath-&gt;Exists(&amp;exists)) &amp;&amp; !exists)</span>
<a href="#l52.261"></a><span id="l52.261">         dbPath-&gt;Create(nsIFile::NORMAL_FILE_TYPE, 0644);</span>
<a href="#l52.262"></a><span id="l52.262" class="difflineat">@@ -1309,17 +1309,17 @@ nsresult nsMsgDBFolder::FlushToFolderCac</span>
<a href="#l52.263"></a><span id="l52.263"> </span>
<a href="#l52.264"></a><span id="l52.264"> NS_IMETHODIMP nsMsgDBFolder::WriteToFolderCache(nsIMsgFolderCache *folderCache, bool deep)</span>
<a href="#l52.265"></a><span id="l52.265"> {</span>
<a href="#l52.266"></a><span id="l52.266">   nsresult rv = NS_OK;</span>
<a href="#l52.267"></a><span id="l52.267"> </span>
<a href="#l52.268"></a><span id="l52.268">   if (folderCache)</span>
<a href="#l52.269"></a><span id="l52.269">   {</span>
<a href="#l52.270"></a><span id="l52.270">     nsCOMPtr &lt;nsIMsgFolderCacheElement&gt; cacheElement;</span>
<a href="#l52.271"></a><span id="l52.271" class="difflineminus">-    nsCOMPtr &lt;nsILocalFile&gt; dbPath;</span>
<a href="#l52.272"></a><span id="l52.272" class="difflineplus">+    nsCOMPtr &lt;nsIFile&gt; dbPath;</span>
<a href="#l52.273"></a><span id="l52.273">     rv = GetFolderCacheKey(getter_AddRefs(dbPath));</span>
<a href="#l52.274"></a><span id="l52.274"> #ifdef DEBUG_bienvenu1</span>
<a href="#l52.275"></a><span id="l52.275">     bool exists;</span>
<a href="#l52.276"></a><span id="l52.276">     NS_ASSERTION(NS_SUCCEEDED(dbPath-&gt;Exists(&amp;exists)) &amp;&amp; exists, &quot;file spec we're adding to cache should exist&quot;);</span>
<a href="#l52.277"></a><span id="l52.277"> #endif</span>
<a href="#l52.278"></a><span id="l52.278">     if (NS_SUCCEEDED(rv) &amp;&amp; dbPath)</span>
<a href="#l52.279"></a><span id="l52.279">     {</span>
<a href="#l52.280"></a><span id="l52.280">       nsCString persistentPath;</span>
<a href="#l52.281"></a><span id="l52.281" class="difflineat">@@ -1709,17 +1709,17 @@ nsresult nsMsgDBFolder::EndNewOfflineMes</span>
<a href="#l52.282"></a><span id="l52.282"> </span>
<a href="#l52.283"></a><span id="l52.283">     // We clear the offline flag on the message if the size</span>
<a href="#l52.284"></a><span id="l52.284">     // looks wrong. Check if we're off by more than one byte per line.</span>
<a href="#l52.285"></a><span id="l52.285">     if (messageSize &gt; (PRUint32) curStorePos &amp;&amp;</span>
<a href="#l52.286"></a><span id="l52.286">        (messageSize - (PRUint32) curStorePos) &gt; (PRUint32) m_numOfflineMsgLines)</span>
<a href="#l52.287"></a><span id="l52.287">     {</span>
<a href="#l52.288"></a><span id="l52.288">        mDatabase-&gt;MarkOffline(messageKey, false, nsnull);</span>
<a href="#l52.289"></a><span id="l52.289">        // we should truncate the offline store at messgeOffset</span>
<a href="#l52.290"></a><span id="l52.290" class="difflineminus">-       nsCOMPtr &lt;nsILocalFile&gt; localStore;</span>
<a href="#l52.291"></a><span id="l52.291" class="difflineplus">+       nsCOMPtr &lt;nsIFile&gt; localStore;</span>
<a href="#l52.292"></a><span id="l52.292">        rv = GetFilePath(getter_AddRefs(localStore));</span>
<a href="#l52.293"></a><span id="l52.293">        if (NS_SUCCEEDED(rv))</span>
<a href="#l52.294"></a><span id="l52.294">        {</span>
<a href="#l52.295"></a><span id="l52.295">          m_tempMessageStream-&gt;Close();</span>
<a href="#l52.296"></a><span id="l52.296">          m_tempMessageStream = nsnull;</span>
<a href="#l52.297"></a><span id="l52.297">          ReleaseSemaphore(static_cast&lt;nsIMsgFolder*&gt;(this));</span>
<a href="#l52.298"></a><span id="l52.298">          if (msgStore)</span>
<a href="#l52.299"></a><span id="l52.299">            msgStore-&gt;DiscardNewMessage(m_tempMessageStream, m_offlineHeader);</span>
<a href="#l52.300"></a><span id="l52.300" class="difflineat">@@ -2100,17 +2100,17 @@ nsMsgDBFolder::SetDBTransferInfo(nsIDBFo</span>
<a href="#l52.301"></a><span id="l52.301">   }</span>
<a href="#l52.302"></a><span id="l52.302">   return NS_OK;</span>
<a href="#l52.303"></a><span id="l52.303"> }</span>
<a href="#l52.304"></a><span id="l52.304"> </span>
<a href="#l52.305"></a><span id="l52.305"> NS_IMETHODIMP</span>
<a href="#l52.306"></a><span id="l52.306"> nsMsgDBFolder::GetStringProperty(const char *propertyName, nsACString&amp; propertyValue)</span>
<a href="#l52.307"></a><span id="l52.307"> {</span>
<a href="#l52.308"></a><span id="l52.308">   NS_ENSURE_ARG_POINTER(propertyName);</span>
<a href="#l52.309"></a><span id="l52.309" class="difflineminus">-  nsCOMPtr &lt;nsILocalFile&gt; dbPath;</span>
<a href="#l52.310"></a><span id="l52.310" class="difflineplus">+  nsCOMPtr &lt;nsIFile&gt; dbPath;</span>
<a href="#l52.311"></a><span id="l52.311">   nsresult rv = GetFolderCacheKey(getter_AddRefs(dbPath));</span>
<a href="#l52.312"></a><span id="l52.312">   if (dbPath)</span>
<a href="#l52.313"></a><span id="l52.313">   {</span>
<a href="#l52.314"></a><span id="l52.314">     nsCOMPtr &lt;nsIMsgFolderCacheElement&gt; cacheElement;</span>
<a href="#l52.315"></a><span id="l52.315">     rv = GetFolderCacheElemFromFile(dbPath, getter_AddRefs(cacheElement));</span>
<a href="#l52.316"></a><span id="l52.316">     if (cacheElement)  //try to get from cache</span>
<a href="#l52.317"></a><span id="l52.317">       rv = cacheElement-&gt;GetStringProperty(propertyName, propertyValue);</span>
<a href="#l52.318"></a><span id="l52.318">     if (NS_FAILED(rv))  //if failed, then try to get from db</span>
<a href="#l52.319"></a><span id="l52.319" class="difflineat">@@ -2128,17 +2128,17 @@ nsMsgDBFolder::GetStringProperty(const c</span>
<a href="#l52.320"></a><span id="l52.320">   }</span>
<a href="#l52.321"></a><span id="l52.321">   return rv;</span>
<a href="#l52.322"></a><span id="l52.322"> }</span>
<a href="#l52.323"></a><span id="l52.323"> </span>
<a href="#l52.324"></a><span id="l52.324"> NS_IMETHODIMP</span>
<a href="#l52.325"></a><span id="l52.325"> nsMsgDBFolder::SetStringProperty(const char *propertyName, const nsACString&amp; propertyValue)</span>
<a href="#l52.326"></a><span id="l52.326"> {</span>
<a href="#l52.327"></a><span id="l52.327">   NS_ENSURE_ARG_POINTER(propertyName);</span>
<a href="#l52.328"></a><span id="l52.328" class="difflineminus">-  nsCOMPtr &lt;nsILocalFile&gt; dbPath;</span>
<a href="#l52.329"></a><span id="l52.329" class="difflineplus">+  nsCOMPtr &lt;nsIFile&gt; dbPath;</span>
<a href="#l52.330"></a><span id="l52.330">   GetFolderCacheKey(getter_AddRefs(dbPath));</span>
<a href="#l52.331"></a><span id="l52.331">   if (dbPath)</span>
<a href="#l52.332"></a><span id="l52.332">   {</span>
<a href="#l52.333"></a><span id="l52.333">     nsCOMPtr &lt;nsIMsgFolderCacheElement&gt; cacheElement;</span>
<a href="#l52.334"></a><span id="l52.334">     GetFolderCacheElemFromFile(dbPath, getter_AddRefs(cacheElement));</span>
<a href="#l52.335"></a><span id="l52.335">     if (cacheElement)  //try to set in the cache</span>
<a href="#l52.336"></a><span id="l52.336">       cacheElement-&gt;SetStringProperty(propertyName, propertyValue);</span>
<a href="#l52.337"></a><span id="l52.337">   }</span>
<a href="#l52.338"></a><span id="l52.338" class="difflineat">@@ -3185,17 +3185,17 @@ nsMsgDBFolder::parseURI(bool needServer)</span>
<a href="#l52.339"></a><span id="l52.339">                        scheme.EqualsLiteral(&quot;snews&quot;) ||</span>
<a href="#l52.340"></a><span id="l52.340">                        scheme.EqualsLiteral(&quot;nntp&quot;);</span>
<a href="#l52.341"></a><span id="l52.341">       }</span>
<a href="#l52.342"></a><span id="l52.342">       NS_MsgCreatePathStringFromFolderURI(urlPath.get(), newPath, scheme,</span>
<a href="#l52.343"></a><span id="l52.343">                                           isNewsFolder);</span>
<a href="#l52.344"></a><span id="l52.344">     }</span>
<a href="#l52.345"></a><span id="l52.345"> </span>
<a href="#l52.346"></a><span id="l52.346">     // now append munged path onto server path</span>
<a href="#l52.347"></a><span id="l52.347" class="difflineminus">-    nsCOMPtr&lt;nsILocalFile&gt; serverPath;</span>
<a href="#l52.348"></a><span id="l52.348" class="difflineplus">+    nsCOMPtr&lt;nsIFile&gt; serverPath;</span>
<a href="#l52.349"></a><span id="l52.349">     rv = server-&gt;GetLocalPath(getter_AddRefs(serverPath));</span>
<a href="#l52.350"></a><span id="l52.350">     if (NS_FAILED(rv)) return rv;</span>
<a href="#l52.351"></a><span id="l52.351"> </span>
<a href="#l52.352"></a><span id="l52.352">     if (!mPath &amp;&amp; serverPath)</span>
<a href="#l52.353"></a><span id="l52.353">     {</span>
<a href="#l52.354"></a><span id="l52.354">       if (!newPath.IsEmpty())</span>
<a href="#l52.355"></a><span id="l52.355">       {</span>
<a href="#l52.356"></a><span id="l52.356">         // I hope this is temporary - Ultimately,</span>
<a href="#l52.357"></a><span id="l52.357" class="difflineat">@@ -3583,17 +3583,17 @@ NS_IMETHODIMP nsMsgDBFolder::PropagateDe</span>
<a href="#l52.358"></a><span id="l52.358"> NS_IMETHODIMP nsMsgDBFolder::RecursiveDelete(bool deleteStorage, nsIMsgWindow *msgWindow)</span>
<a href="#l52.359"></a><span id="l52.359"> {</span>
<a href="#l52.360"></a><span id="l52.360">   // If deleteStorage is true, recursively deletes disk storage for this folder</span>
<a href="#l52.361"></a><span id="l52.361">   // and all its subfolders.</span>
<a href="#l52.362"></a><span id="l52.362">   // Regardless of deleteStorage, always unlinks them from the children lists and</span>
<a href="#l52.363"></a><span id="l52.363">   // frees memory for the subfolders but NOT for _this_</span>
<a href="#l52.364"></a><span id="l52.364"> </span>
<a href="#l52.365"></a><span id="l52.365">   nsresult status = NS_OK;</span>
<a href="#l52.366"></a><span id="l52.366" class="difflineminus">-  nsCOMPtr &lt;nsILocalFile&gt; dbPath;</span>
<a href="#l52.367"></a><span id="l52.367" class="difflineplus">+  nsCOMPtr &lt;nsIFile&gt; dbPath;</span>
<a href="#l52.368"></a><span id="l52.368"> </span>
<a href="#l52.369"></a><span id="l52.369">   // first remove the deleted folder from the folder cache;</span>
<a href="#l52.370"></a><span id="l52.370">   nsresult result = GetFolderCacheKey(getter_AddRefs(dbPath));</span>
<a href="#l52.371"></a><span id="l52.371"> </span>
<a href="#l52.372"></a><span id="l52.372">   nsCOMPtr&lt;nsIMsgAccountManager&gt; accountMgr =</span>
<a href="#l52.373"></a><span id="l52.373">     do_GetService(NS_MSGACCOUNTMANAGER_CONTRACTID, &amp;result);</span>
<a href="#l52.374"></a><span id="l52.374">   if(NS_SUCCEEDED(result))</span>
<a href="#l52.375"></a><span id="l52.375">   {</span>
<a href="#l52.376"></a><span id="l52.376" class="difflineat">@@ -3785,33 +3785,33 @@ nsMsgDBFolder::CheckIfFolderExists(const</span>
<a href="#l52.377"></a><span id="l52.377">       return NS_MSG_FOLDER_EXISTS;</span>
<a href="#l52.378"></a><span id="l52.378">     }</span>
<a href="#l52.379"></a><span id="l52.379">   }</span>
<a href="#l52.380"></a><span id="l52.380">   return NS_OK;</span>
<a href="#l52.381"></a><span id="l52.381"> }</span>
<a href="#l52.382"></a><span id="l52.382"> </span>
<a href="#l52.383"></a><span id="l52.383"> </span>
<a href="#l52.384"></a><span id="l52.384"> nsresult</span>
<a href="#l52.385"></a><span id="l52.385" class="difflineminus">-nsMsgDBFolder::AddDirectorySeparator(nsILocalFile *path)</span>
<a href="#l52.386"></a><span id="l52.386" class="difflineplus">+nsMsgDBFolder::AddDirectorySeparator(nsIFile *path)</span>
<a href="#l52.387"></a><span id="l52.387"> {</span>
<a href="#l52.388"></a><span id="l52.388">   nsAutoString leafName;</span>
<a href="#l52.389"></a><span id="l52.389">   path-&gt;GetLeafName(leafName);</span>
<a href="#l52.390"></a><span id="l52.390">   leafName.AppendLiteral(FOLDER_SUFFIX);</span>
<a href="#l52.391"></a><span id="l52.391">   return path-&gt;SetLeafName(leafName);</span>
<a href="#l52.392"></a><span id="l52.392"> }</span>
<a href="#l52.393"></a><span id="l52.393"> </span>
<a href="#l52.394"></a><span id="l52.394"> /* Finds the directory associated with this folder.  That is if the path is</span>
<a href="#l52.395"></a><span id="l52.395">    c:\Inbox, it will return c:\Inbox.sbd if it succeeds.  If that path doesn't</span>
<a href="#l52.396"></a><span id="l52.396">    currently exist then it will create it. Path is strictly an out parameter.</span>
<a href="#l52.397"></a><span id="l52.397">   */</span>
<a href="#l52.398"></a><span id="l52.398" class="difflineminus">-nsresult nsMsgDBFolder::CreateDirectoryForFolder(nsILocalFile **resultFile)</span>
<a href="#l52.399"></a><span id="l52.399" class="difflineplus">+nsresult nsMsgDBFolder::CreateDirectoryForFolder(nsIFile **resultFile)</span>
<a href="#l52.400"></a><span id="l52.400"> {</span>
<a href="#l52.401"></a><span id="l52.401">   nsresult rv = NS_OK;</span>
<a href="#l52.402"></a><span id="l52.402"> </span>
<a href="#l52.403"></a><span id="l52.403" class="difflineminus">-  nsCOMPtr&lt;nsILocalFile&gt; path;</span>
<a href="#l52.404"></a><span id="l52.404" class="difflineplus">+  nsCOMPtr&lt;nsIFile&gt; path;</span>
<a href="#l52.405"></a><span id="l52.405">   rv = GetFilePath(getter_AddRefs(path));</span>
<a href="#l52.406"></a><span id="l52.406">   if (NS_FAILED(rv)) return rv;</span>
<a href="#l52.407"></a><span id="l52.407"> </span>
<a href="#l52.408"></a><span id="l52.408">   bool pathIsDirectory = false;</span>
<a href="#l52.409"></a><span id="l52.409">   path-&gt;IsDirectory(&amp;pathIsDirectory);</span>
<a href="#l52.410"></a><span id="l52.410">   if(!pathIsDirectory)</span>
<a href="#l52.411"></a><span id="l52.411">   {</span>
<a href="#l52.412"></a><span id="l52.412">     //If the current path isn't a directory, add directory separator</span>
<a href="#l52.413"></a><span id="l52.413" class="difflineat">@@ -3836,24 +3836,21 @@ nsresult nsMsgDBFolder::CreateDirectoryF</span>
<a href="#l52.414"></a><span id="l52.414">     path.swap(*resultFile);</span>
<a href="#l52.415"></a><span id="l52.415">   return rv;</span>
<a href="#l52.416"></a><span id="l52.416"> }</span>
<a href="#l52.417"></a><span id="l52.417"> </span>
<a href="#l52.418"></a><span id="l52.418"> /* Finds the backup directory associated with this folder, stored on the temp</span>
<a href="#l52.419"></a><span id="l52.419">    drive. If that path doesn't currently exist then it will create it. Path is</span>
<a href="#l52.420"></a><span id="l52.420">    strictly an out parameter.</span>
<a href="#l52.421"></a><span id="l52.421">   */</span>
<a href="#l52.422"></a><span id="l52.422" class="difflineminus">-nsresult nsMsgDBFolder::CreateBackupDirectory(nsILocalFile **resultFile)</span>
<a href="#l52.423"></a><span id="l52.423" class="difflineminus">-{</span>
<a href="#l52.424"></a><span id="l52.424" class="difflineminus">-  nsCOMPtr&lt;nsIFile&gt; pathIFile;</span>
<a href="#l52.425"></a><span id="l52.425" class="difflineplus">+nsresult nsMsgDBFolder::CreateBackupDirectory(nsIFile **resultFile)</span>
<a href="#l52.426"></a><span id="l52.426" class="difflineplus">+{</span>
<a href="#l52.427"></a><span id="l52.427" class="difflineplus">+  nsCOMPtr&lt;nsIFile&gt; path;</span>
<a href="#l52.428"></a><span id="l52.428">   nsresult rv = NS_GetSpecialDirectory(NS_OS_TEMP_DIR,</span>
<a href="#l52.429"></a><span id="l52.429" class="difflineminus">-                                       getter_AddRefs(pathIFile));</span>
<a href="#l52.430"></a><span id="l52.430" class="difflineminus">-  NS_ENSURE_SUCCESS(rv, rv);</span>
<a href="#l52.431"></a><span id="l52.431" class="difflineminus">-</span>
<a href="#l52.432"></a><span id="l52.432" class="difflineminus">-  nsCOMPtr&lt;nsILocalFile&gt; path = do_QueryInterface(pathIFile, &amp;rv);</span>
<a href="#l52.433"></a><span id="l52.433" class="difflineplus">+                                       getter_AddRefs(path));</span>
<a href="#l52.434"></a><span id="l52.434">   NS_ENSURE_SUCCESS(rv, rv);</span>
<a href="#l52.435"></a><span id="l52.435"> </span>
<a href="#l52.436"></a><span id="l52.436">   rv = path-&gt;Append(NS_LITERAL_STRING(&quot;MozillaMailnews&quot;));</span>
<a href="#l52.437"></a><span id="l52.437">   bool pathIsDirectory;</span>
<a href="#l52.438"></a><span id="l52.438">   path-&gt;IsDirectory(&amp;pathIsDirectory);</span>
<a href="#l52.439"></a><span id="l52.439"> </span>
<a href="#l52.440"></a><span id="l52.440">   // If that doesn't exist, then we have to create this directory</span>
<a href="#l52.441"></a><span id="l52.441">   if (!pathIsDirectory)</span>
<a href="#l52.442"></a><span id="l52.442" class="difflineat">@@ -3865,86 +3862,86 @@ nsresult nsMsgDBFolder::CreateBackupDire</span>
<a href="#l52.443"></a><span id="l52.443">     rv = pathExists ? NS_MSG_COULD_NOT_CREATE_DIRECTORY :</span>
<a href="#l52.444"></a><span id="l52.444">                       path-&gt;Create(nsIFile::DIRECTORY_TYPE, 0700);</span>
<a href="#l52.445"></a><span id="l52.445">   }</span>
<a href="#l52.446"></a><span id="l52.446">   if (NS_SUCCEEDED(rv))</span>
<a href="#l52.447"></a><span id="l52.447">     path.swap(*resultFile);</span>
<a href="#l52.448"></a><span id="l52.448">   return rv;</span>
<a href="#l52.449"></a><span id="l52.449"> }</span>
<a href="#l52.450"></a><span id="l52.450"> </span>
<a href="#l52.451"></a><span id="l52.451" class="difflineminus">-nsresult nsMsgDBFolder::GetBackupSummaryFile(nsILocalFile **aBackupFile, const nsACString&amp; newName)</span>
<a href="#l52.452"></a><span id="l52.452" class="difflineminus">-{</span>
<a href="#l52.453"></a><span id="l52.453" class="difflineminus">-  nsCOMPtr&lt;nsILocalFile&gt; backupDir;</span>
<a href="#l52.454"></a><span id="l52.454" class="difflineplus">+nsresult nsMsgDBFolder::GetBackupSummaryFile(nsIFile **aBackupFile, const nsACString&amp; newName)</span>
<a href="#l52.455"></a><span id="l52.455" class="difflineplus">+{</span>
<a href="#l52.456"></a><span id="l52.456" class="difflineplus">+  nsCOMPtr&lt;nsIFile&gt; backupDir;</span>
<a href="#l52.457"></a><span id="l52.457">   nsresult rv = CreateBackupDirectory(getter_AddRefs(backupDir));</span>
<a href="#l52.458"></a><span id="l52.458">   NS_ENSURE_SUCCESS(rv, rv);</span>
<a href="#l52.459"></a><span id="l52.459"> </span>
<a href="#l52.460"></a><span id="l52.460">   // We use a dummy message folder file so we can use</span>
<a href="#l52.461"></a><span id="l52.461">   // GetSummaryFileLocation to get the db file name</span>
<a href="#l52.462"></a><span id="l52.462" class="difflineminus">-  nsCOMPtr&lt;nsILocalFile&gt; backupDBDummyFolder;</span>
<a href="#l52.463"></a><span id="l52.463" class="difflineplus">+  nsCOMPtr&lt;nsIFile&gt; backupDBDummyFolder;</span>
<a href="#l52.464"></a><span id="l52.464">   rv = CreateBackupDirectory(getter_AddRefs(backupDBDummyFolder));</span>
<a href="#l52.465"></a><span id="l52.465">   NS_ENSURE_SUCCESS(rv, rv);</span>
<a href="#l52.466"></a><span id="l52.466"> </span>
<a href="#l52.467"></a><span id="l52.467">   if (!newName.IsEmpty())</span>
<a href="#l52.468"></a><span id="l52.468">   {</span>
<a href="#l52.469"></a><span id="l52.469">     rv = backupDBDummyFolder-&gt;AppendNative(newName);</span>
<a href="#l52.470"></a><span id="l52.470">   }</span>
<a href="#l52.471"></a><span id="l52.471">   else // if newName is null, use the folder name</span>
<a href="#l52.472"></a><span id="l52.472">   {</span>
<a href="#l52.473"></a><span id="l52.473" class="difflineminus">-    nsCOMPtr&lt;nsILocalFile&gt; folderPath;</span>
<a href="#l52.474"></a><span id="l52.474" class="difflineplus">+    nsCOMPtr&lt;nsIFile&gt; folderPath;</span>
<a href="#l52.475"></a><span id="l52.475">     rv = GetFilePath(getter_AddRefs(folderPath));</span>
<a href="#l52.476"></a><span id="l52.476">     NS_ENSURE_SUCCESS(rv, rv);</span>
<a href="#l52.477"></a><span id="l52.477"> </span>
<a href="#l52.478"></a><span id="l52.478">     nsCAutoString folderName;</span>
<a href="#l52.479"></a><span id="l52.479">     rv = folderPath-&gt;GetNativeLeafName(folderName);</span>
<a href="#l52.480"></a><span id="l52.480">     NS_ENSURE_SUCCESS(rv, rv);</span>
<a href="#l52.481"></a><span id="l52.481">     rv = backupDBDummyFolder-&gt;AppendNative(folderName);</span>
<a href="#l52.482"></a><span id="l52.482">   }</span>
<a href="#l52.483"></a><span id="l52.483">   NS_ENSURE_SUCCESS(rv, rv);</span>
<a href="#l52.484"></a><span id="l52.484"> </span>
<a href="#l52.485"></a><span id="l52.485" class="difflineminus">-  nsCOMPtr&lt;nsILocalFile&gt; backupDBFile;</span>
<a href="#l52.486"></a><span id="l52.486" class="difflineplus">+  nsCOMPtr&lt;nsIFile&gt; backupDBFile;</span>
<a href="#l52.487"></a><span id="l52.487">   rv = GetSummaryFileLocation(backupDBDummyFolder, getter_AddRefs(backupDBFile));</span>
<a href="#l52.488"></a><span id="l52.488">   NS_ENSURE_SUCCESS(rv, rv);</span>
<a href="#l52.489"></a><span id="l52.489"> </span>
<a href="#l52.490"></a><span id="l52.490">   backupDBFile.swap(*aBackupFile);</span>
<a href="#l52.491"></a><span id="l52.491">   return NS_OK;</span>
<a href="#l52.492"></a><span id="l52.492"> }</span>
<a href="#l52.493"></a><span id="l52.493"> </span>
<a href="#l52.494"></a><span id="l52.494"> NS_IMETHODIMP nsMsgDBFolder::Rename(const nsAString&amp; aNewName, nsIMsgWindow *msgWindow)</span>
<a href="#l52.495"></a><span id="l52.495"> {</span>
<a href="#l52.496"></a><span id="l52.496" class="difflineminus">-  nsCOMPtr&lt;nsILocalFile&gt; oldPathFile;</span>
<a href="#l52.497"></a><span id="l52.497" class="difflineplus">+  nsCOMPtr&lt;nsIFile&gt; oldPathFile;</span>
<a href="#l52.498"></a><span id="l52.498">   nsCOMPtr&lt;nsIAtom&gt; folderRenameAtom;</span>
<a href="#l52.499"></a><span id="l52.499">   nsresult rv = GetFilePath(getter_AddRefs(oldPathFile));</span>
<a href="#l52.500"></a><span id="l52.500">   if (NS_FAILED(rv))</span>
<a href="#l52.501"></a><span id="l52.501">     return rv;</span>
<a href="#l52.502"></a><span id="l52.502">   nsCOMPtr&lt;nsIMsgFolder&gt; parentFolder;</span>
<a href="#l52.503"></a><span id="l52.503">   rv = GetParent(getter_AddRefs(parentFolder));</span>
<a href="#l52.504"></a><span id="l52.504">   if (!parentFolder)</span>
<a href="#l52.505"></a><span id="l52.505">     return NS_ERROR_FAILURE;</span>
<a href="#l52.506"></a><span id="l52.506">   nsCOMPtr&lt;nsISupports&gt; parentSupport = do_QueryInterface(parentFolder);</span>
<a href="#l52.507"></a><span id="l52.507" class="difflineminus">-  nsCOMPtr&lt;nsILocalFile&gt; oldSummaryFile;</span>
<a href="#l52.508"></a><span id="l52.508" class="difflineplus">+  nsCOMPtr&lt;nsIFile&gt; oldSummaryFile;</span>
<a href="#l52.509"></a><span id="l52.509">   rv = GetSummaryFileLocation(oldPathFile, getter_AddRefs(oldSummaryFile));</span>
<a href="#l52.510"></a><span id="l52.510">   NS_ENSURE_SUCCESS(rv, rv);</span>
<a href="#l52.511"></a><span id="l52.511"> </span>
<a href="#l52.512"></a><span id="l52.512" class="difflineminus">-  nsCOMPtr&lt;nsILocalFile&gt; dirFile;</span>
<a href="#l52.513"></a><span id="l52.513" class="difflineplus">+  nsCOMPtr&lt;nsIFile&gt; dirFile;</span>
<a href="#l52.514"></a><span id="l52.514">   PRInt32 count = mSubFolders.Count();</span>
<a href="#l52.515"></a><span id="l52.515"> </span>
<a href="#l52.516"></a><span id="l52.516">   if (count &gt; 0)</span>
<a href="#l52.517"></a><span id="l52.517">     rv = CreateDirectoryForFolder(getter_AddRefs(dirFile));</span>
<a href="#l52.518"></a><span id="l52.518"> </span>
<a href="#l52.519"></a><span id="l52.519">   nsAutoString newDiskName(aNewName);</span>
<a href="#l52.520"></a><span id="l52.520">   NS_MsgHashIfNecessary(newDiskName);</span>
<a href="#l52.521"></a><span id="l52.521"> </span>
<a href="#l52.522"></a><span id="l52.522">   if (mName.Equals(aNewName, nsCaseInsensitiveStringComparator()))</span>
<a href="#l52.523"></a><span id="l52.523">   {</span>
<a href="#l52.524"></a><span id="l52.524">     rv = ThrowAlertMsg(&quot;folderExists&quot;, msgWindow);</span>
<a href="#l52.525"></a><span id="l52.525">     return NS_MSG_FOLDER_EXISTS;</span>
<a href="#l52.526"></a><span id="l52.526">   }</span>
<a href="#l52.527"></a><span id="l52.527">   else</span>
<a href="#l52.528"></a><span id="l52.528">   {</span>
<a href="#l52.529"></a><span id="l52.529" class="difflineminus">-    nsCOMPtr &lt;nsILocalFile&gt; parentPathFile;</span>
<a href="#l52.530"></a><span id="l52.530" class="difflineplus">+    nsCOMPtr &lt;nsIFile&gt; parentPathFile;</span>
<a href="#l52.531"></a><span id="l52.531">     parentFolder-&gt;GetFilePath(getter_AddRefs(parentPathFile));</span>
<a href="#l52.532"></a><span id="l52.532">     NS_ENSURE_SUCCESS(rv,rv);</span>
<a href="#l52.533"></a><span id="l52.533">     bool isDirectory = false;</span>
<a href="#l52.534"></a><span id="l52.534">     parentPathFile-&gt;IsDirectory(&amp;isDirectory);</span>
<a href="#l52.535"></a><span id="l52.535">     if (!isDirectory)</span>
<a href="#l52.536"></a><span id="l52.536">       AddDirectorySeparator(parentPathFile);</span>
<a href="#l52.537"></a><span id="l52.537"> </span>
<a href="#l52.538"></a><span id="l52.538">     rv = CheckIfFolderExists(aNewName, parentFolder, msgWindow);</span>
<a href="#l52.539"></a><span id="l52.539" class="difflineat">@@ -4637,30 +4634,30 @@ NS_IMETHODIMP nsMsgDBFolder::GetRootFold</span>
<a href="#l52.540"></a><span id="l52.540">   nsresult rv;</span>
<a href="#l52.541"></a><span id="l52.541">   nsCOMPtr&lt;nsIMsgIncomingServer&gt; server;</span>
<a href="#l52.542"></a><span id="l52.542">   rv = GetServer(getter_AddRefs(server));</span>
<a href="#l52.543"></a><span id="l52.543">   NS_ENSURE_SUCCESS(rv, rv);</span>
<a href="#l52.544"></a><span id="l52.544">   return server-&gt;GetRootMsgFolder(aRootFolder);</span>
<a href="#l52.545"></a><span id="l52.545"> }</span>
<a href="#l52.546"></a><span id="l52.546"> </span>
<a href="#l52.547"></a><span id="l52.547"> NS_IMETHODIMP</span>
<a href="#l52.548"></a><span id="l52.548" class="difflineminus">-nsMsgDBFolder::SetFilePath(nsILocalFile *aFile)</span>
<a href="#l52.549"></a><span id="l52.549" class="difflineplus">+nsMsgDBFolder::SetFilePath(nsIFile *aFile)</span>
<a href="#l52.550"></a><span id="l52.550"> {</span>
<a href="#l52.551"></a><span id="l52.551">   mPath = aFile;</span>
<a href="#l52.552"></a><span id="l52.552">   return NS_OK;</span>
<a href="#l52.553"></a><span id="l52.553"> }</span>
<a href="#l52.554"></a><span id="l52.554"> </span>
<a href="#l52.555"></a><span id="l52.555"> NS_IMETHODIMP</span>
<a href="#l52.556"></a><span id="l52.556" class="difflineminus">-nsMsgDBFolder::GetFilePath(nsILocalFile * *aFile)</span>
<a href="#l52.557"></a><span id="l52.557" class="difflineplus">+nsMsgDBFolder::GetFilePath(nsIFile * *aFile)</span>
<a href="#l52.558"></a><span id="l52.558"> {</span>
<a href="#l52.559"></a><span id="l52.559">   NS_ENSURE_ARG_POINTER(aFile);</span>
<a href="#l52.560"></a><span id="l52.560">   nsresult rv;</span>
<a href="#l52.561"></a><span id="l52.561" class="difflineminus">-  // make a new nsILocalFile object in case the caller</span>
<a href="#l52.562"></a><span id="l52.562" class="difflineplus">+  // make a new nsIFile object in case the caller</span>
<a href="#l52.563"></a><span id="l52.563">   // alters the underlying file object.</span>
<a href="#l52.564"></a><span id="l52.564" class="difflineminus">-  nsCOMPtr &lt;nsILocalFile&gt; file = do_CreateInstance(NS_LOCAL_FILE_CONTRACTID, &amp;rv);</span>
<a href="#l52.565"></a><span id="l52.565" class="difflineplus">+  nsCOMPtr &lt;nsIFile&gt; file = do_CreateInstance(NS_LOCAL_FILE_CONTRACTID, &amp;rv);</span>
<a href="#l52.566"></a><span id="l52.566">   NS_ENSURE_SUCCESS(rv, rv);</span>
<a href="#l52.567"></a><span id="l52.567">   if (!mPath)</span>
<a href="#l52.568"></a><span id="l52.568">     parseURI(true);</span>
<a href="#l52.569"></a><span id="l52.569">   rv = file-&gt;InitWithFile(mPath);</span>
<a href="#l52.570"></a><span id="l52.570">   file.swap(*aFile);</span>
<a href="#l52.571"></a><span id="l52.571">   return NS_OK;</span>
<a href="#l52.572"></a><span id="l52.572"> }</span>
<a href="#l52.573"></a><span id="l52.573"> </span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l53.1"></a><span id="l53.1" class="difflineminus">--- a/mailnews/base/util/nsMsgDBFolder.h</span>
<a href="#l53.2"></a><span id="l53.2" class="difflineplus">+++ b/mailnews/base/util/nsMsgDBFolder.h</span>
<a href="#l53.3"></a><span id="l53.3" class="difflineat">@@ -12,17 +12,17 @@</span>
<a href="#l53.4"></a><span id="l53.4"> #include &quot;nsIDBFolderInfo.h&quot;</span>
<a href="#l53.5"></a><span id="l53.5"> #include &quot;nsIMsgDatabase.h&quot;</span>
<a href="#l53.6"></a><span id="l53.6"> #include &quot;nsIMsgIncomingServer.h&quot;</span>
<a href="#l53.7"></a><span id="l53.7"> #include &quot;nsCOMPtr.h&quot;</span>
<a href="#l53.8"></a><span id="l53.8"> #include &quot;nsStaticAtom.h&quot;</span>
<a href="#l53.9"></a><span id="l53.9"> #include &quot;nsIDBChangeListener.h&quot;</span>
<a href="#l53.10"></a><span id="l53.10"> #include &quot;nsIMsgPluggableStore.h&quot;</span>
<a href="#l53.11"></a><span id="l53.11"> #include &quot;nsIURL.h&quot;</span>
<a href="#l53.12"></a><span id="l53.12" class="difflineminus">-#include &quot;nsILocalFile.h&quot;</span>
<a href="#l53.13"></a><span id="l53.13" class="difflineplus">+#include &quot;nsIFile.h&quot;</span>
<a href="#l53.14"></a><span id="l53.14"> #include &quot;nsWeakReference.h&quot;</span>
<a href="#l53.15"></a><span id="l53.15"> #include &quot;nsIMsgFilterList.h&quot;</span>
<a href="#l53.16"></a><span id="l53.16"> #include &quot;nsIUrlListener.h&quot;</span>
<a href="#l53.17"></a><span id="l53.17"> #include &quot;nsIMsgHdr.h&quot;</span>
<a href="#l53.18"></a><span id="l53.18"> #include &quot;nsIOutputStream.h&quot;</span>
<a href="#l53.19"></a><span id="l53.19"> #include &quot;nsITransport.h&quot;</span>
<a href="#l53.20"></a><span id="l53.20"> #include &quot;nsIStringBundle.h&quot;</span>
<a href="#l53.21"></a><span id="l53.21"> #include &quot;nsTObserverArray.h&quot;</span>
<a href="#l53.22"></a><span id="l53.22" class="difflineat">@@ -72,19 +72,19 @@ public:</span>
<a href="#l53.23"></a><span id="l53.23">   // These functions are called when MSG_Master::GetFolderLineById is populating a MSG_FolderLine</span>
<a href="#l53.24"></a><span id="l53.24">   // struct used by the FE</span>
<a href="#l53.25"></a><span id="l53.25">   PRInt32 GetNumPendingUnread();</span>
<a href="#l53.26"></a><span id="l53.26">   PRInt32 GetNumPendingTotalMessages();</span>
<a href="#l53.27"></a><span id="l53.27"> </span>
<a href="#l53.28"></a><span id="l53.28">   void ChangeNumPendingUnread(PRInt32 delta);</span>
<a href="#l53.29"></a><span id="l53.29">   void ChangeNumPendingTotalMessages(PRInt32 delta);</span>
<a href="#l53.30"></a><span id="l53.30"> </span>
<a href="#l53.31"></a><span id="l53.31" class="difflineminus">-  nsresult CreateDirectoryForFolder(nsILocalFile **result);</span>
<a href="#l53.32"></a><span id="l53.32" class="difflineminus">-  nsresult CreateBackupDirectory(nsILocalFile **result);</span>
<a href="#l53.33"></a><span id="l53.33" class="difflineminus">-  nsresult GetBackupSummaryFile(nsILocalFile **result, const nsACString&amp; newName);</span>
<a href="#l53.34"></a><span id="l53.34" class="difflineplus">+  nsresult CreateDirectoryForFolder(nsIFile **result);</span>
<a href="#l53.35"></a><span id="l53.35" class="difflineplus">+  nsresult CreateBackupDirectory(nsIFile **result);</span>
<a href="#l53.36"></a><span id="l53.36" class="difflineplus">+  nsresult GetBackupSummaryFile(nsIFile **result, const nsACString&amp; newName);</span>
<a href="#l53.37"></a><span id="l53.37">   nsresult GetMsgPreviewTextFromStream(nsIMsgDBHdr *msgHdr, nsIInputStream *stream);</span>
<a href="#l53.38"></a><span id="l53.38">   nsresult HandleAutoCompactEvent(nsIMsgWindow *aMsgWindow);</span>
<a href="#l53.39"></a><span id="l53.39"> protected:</span>
<a href="#l53.40"></a><span id="l53.40">   </span>
<a href="#l53.41"></a><span id="l53.41">   // this is a little helper function that is not part of the public interface. </span>
<a href="#l53.42"></a><span id="l53.42">   // we use it to get the IID of the incoming server for the derived folder.</span>
<a href="#l53.43"></a><span id="l53.43">   // w/out a function like this we would have to implement GetServer in each</span>
<a href="#l53.44"></a><span id="l53.44">   // derived folder class.</span>
<a href="#l53.45"></a><span id="l53.45" class="difflineat">@@ -109,25 +109,25 @@ protected:</span>
<a href="#l53.46"></a><span id="l53.46">   virtual nsresult CreateChildFromURI(const nsCString &amp;uri, nsIMsgFolder **folder) = 0;</span>
<a href="#l53.47"></a><span id="l53.47">   virtual nsresult ReadDBFolderInfo(bool force);</span>
<a href="#l53.48"></a><span id="l53.48">   virtual nsresult FlushToFolderCache();</span>
<a href="#l53.49"></a><span id="l53.49">   virtual nsresult GetDatabase() = 0;</span>
<a href="#l53.50"></a><span id="l53.50">   virtual nsresult SendFlagNotifications(nsIMsgDBHdr *item, PRUint32 oldFlags, PRUint32 newFlags);</span>
<a href="#l53.51"></a><span id="l53.51">   nsresult CheckWithNewMessagesStatus(bool messageAdded);</span>
<a href="#l53.52"></a><span id="l53.52">   void     UpdateNewMessages();</span>
<a href="#l53.53"></a><span id="l53.53">   nsresult OnHdrAddedOrDeleted(nsIMsgDBHdr *hdrChanged, bool added);</span>
<a href="#l53.54"></a><span id="l53.54" class="difflineminus">-  nsresult CreateFileForDB(const nsAString&amp; userLeafName, nsILocalFile *baseDir,</span>
<a href="#l53.55"></a><span id="l53.55" class="difflineminus">-                           nsILocalFile **dbFile);</span>
<a href="#l53.56"></a><span id="l53.56" class="difflineplus">+  nsresult CreateFileForDB(const nsAString&amp; userLeafName, nsIFile *baseDir,</span>
<a href="#l53.57"></a><span id="l53.57" class="difflineplus">+                           nsIFile **dbFile);</span>
<a href="#l53.58"></a><span id="l53.58"> </span>
<a href="#l53.59"></a><span id="l53.59" class="difflineminus">-  nsresult GetFolderCacheKey(nsILocalFile **aFile, bool createDBIfMissing = false);</span>
<a href="#l53.60"></a><span id="l53.60" class="difflineminus">-  nsresult GetFolderCacheElemFromFile(nsILocalFile *file, nsIMsgFolderCacheElement **cacheElement);</span>
<a href="#l53.61"></a><span id="l53.61" class="difflineminus">-  nsresult AddDirectorySeparator(nsILocalFile *path);</span>
<a href="#l53.62"></a><span id="l53.62" class="difflineplus">+  nsresult GetFolderCacheKey(nsIFile **aFile, bool createDBIfMissing = false);</span>
<a href="#l53.63"></a><span id="l53.63" class="difflineplus">+  nsresult GetFolderCacheElemFromFile(nsIFile *file, nsIMsgFolderCacheElement **cacheElement);</span>
<a href="#l53.64"></a><span id="l53.64" class="difflineplus">+  nsresult AddDirectorySeparator(nsIFile *path);</span>
<a href="#l53.65"></a><span id="l53.65">   nsresult CheckIfFolderExists(const nsAString&amp; newFolderName, nsIMsgFolder *parentFolder, nsIMsgWindow *msgWindow);</span>
<a href="#l53.66"></a><span id="l53.66"> </span>
<a href="#l53.67"></a><span id="l53.67" class="difflineminus">-  nsresult GetSummaryFile(nsILocalFile** aSummaryFile);</span>
<a href="#l53.68"></a><span id="l53.68" class="difflineplus">+  nsresult GetSummaryFile(nsIFile** aSummaryFile);</span>
<a href="#l53.69"></a><span id="l53.69"> </span>
<a href="#l53.70"></a><span id="l53.70">   // Returns true if: a) there is no need to prompt or b) the user is already</span>
<a href="#l53.71"></a><span id="l53.71">   // logged in or c) the user logged in successfully.</span>
<a href="#l53.72"></a><span id="l53.72">   static bool PromptForMasterPasswordIfNecessary();</span>
<a href="#l53.73"></a><span id="l53.73"> </span>
<a href="#l53.74"></a><span id="l53.74">   // offline support methods.</span>
<a href="#l53.75"></a><span id="l53.75">   nsresult StartNewOfflineMessage();</span>
<a href="#l53.76"></a><span id="l53.76">   nsresult WriteStartOfNewLocalMessage();</span>
<a href="#l53.77"></a><span id="l53.77" class="difflineat">@@ -220,17 +220,17 @@ protected:</span>
<a href="#l53.78"></a><span id="l53.78"> </span>
<a href="#l53.79"></a><span id="l53.79">   //</span>
<a href="#l53.80"></a><span id="l53.80">   // stuff from the uri</span>
<a href="#l53.81"></a><span id="l53.81">   //</span>
<a href="#l53.82"></a><span id="l53.82">   bool mHaveParsedURI;        // is the URI completely parsed?</span>
<a href="#l53.83"></a><span id="l53.83">   bool mIsServerIsValid;</span>
<a href="#l53.84"></a><span id="l53.84">   bool mIsServer;</span>
<a href="#l53.85"></a><span id="l53.85">   nsString mName;</span>
<a href="#l53.86"></a><span id="l53.86" class="difflineminus">-  nsCOMPtr&lt;nsILocalFile&gt; mPath;</span>
<a href="#l53.87"></a><span id="l53.87" class="difflineplus">+  nsCOMPtr&lt;nsIFile&gt; mPath;</span>
<a href="#l53.88"></a><span id="l53.88">   nsCString mBaseMessageURI; //The uri with the message scheme</span>
<a href="#l53.89"></a><span id="l53.89"> </span>
<a href="#l53.90"></a><span id="l53.90">   bool mInVFEditSearchScope ; // non persistant state used by the virtual folder UI</span>
<a href="#l53.91"></a><span id="l53.91"> </span>
<a href="#l53.92"></a><span id="l53.92">   // static stuff for cross-instance objects like atoms</span>
<a href="#l53.93"></a><span id="l53.93">   static NS_MSG_BASE_STATIC_MEMBER_(nsrefcnt) gInstanceCount;</span>
<a href="#l53.94"></a><span id="l53.94"> </span>
<a href="#l53.95"></a><span id="l53.95">   static nsresult initializeStrings();</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l54.1"></a><span id="l54.1" class="difflineminus">--- a/mailnews/base/util/nsMsgFileStream.cpp</span>
<a href="#l54.2"></a><span id="l54.2" class="difflineplus">+++ b/mailnews/base/util/nsMsgFileStream.cpp</span>
<a href="#l54.3"></a><span id="l54.3" class="difflineat">@@ -1,13 +1,13 @@</span>
<a href="#l54.4"></a><span id="l54.4"> /* This Source Code Form is subject to the terms of the Mozilla Public</span>
<a href="#l54.5"></a><span id="l54.5">  * License, v. 2.0. If a copy of the MPL was not distributed with this</span>
<a href="#l54.6"></a><span id="l54.6">  * file, You can obtain one at http://mozilla.org/MPL/2.0/. */</span>
<a href="#l54.7"></a><span id="l54.7"> </span>
<a href="#l54.8"></a><span id="l54.8" class="difflineminus">-#include &quot;nsILocalFile.h&quot;</span>
<a href="#l54.9"></a><span id="l54.9" class="difflineplus">+#include &quot;nsIFile.h&quot;</span>
<a href="#l54.10"></a><span id="l54.10"> #include &quot;nsMsgFileStream.h&quot;</span>
<a href="#l54.11"></a><span id="l54.11"> #include &quot;prerr.h&quot;</span>
<a href="#l54.12"></a><span id="l54.12"> #include &quot;prerror.h&quot;</span>
<a href="#l54.13"></a><span id="l54.13"> </span>
<a href="#l54.14"></a><span id="l54.14"> /* From nsDebugImpl.cpp: */</span>
<a href="#l54.15"></a><span id="l54.15"> static nsresult</span>
<a href="#l54.16"></a><span id="l54.16"> ErrorAccordingToNSPR()</span>
<a href="#l54.17"></a><span id="l54.17"> {</span>
<a href="#l54.18"></a><span id="l54.18" class="difflineat">@@ -40,17 +40,17 @@ nsMsgFileStream::nsMsgFileStream()</span>
<a href="#l54.19"></a><span id="l54.19"> nsMsgFileStream::~nsMsgFileStream()</span>
<a href="#l54.20"></a><span id="l54.20"> {</span>
<a href="#l54.21"></a><span id="l54.21">   if (mFileDesc)</span>
<a href="#l54.22"></a><span id="l54.22">     PR_Close(mFileDesc);</span>
<a href="#l54.23"></a><span id="l54.23"> }</span>
<a href="#l54.24"></a><span id="l54.24"> </span>
<a href="#l54.25"></a><span id="l54.25"> NS_IMPL_ISUPPORTS3(nsMsgFileStream, nsIInputStream, nsIOutputStream, nsISeekableStream)</span>
<a href="#l54.26"></a><span id="l54.26"> </span>
<a href="#l54.27"></a><span id="l54.27" class="difflineminus">-nsresult nsMsgFileStream::InitWithFile(nsILocalFile *file)</span>
<a href="#l54.28"></a><span id="l54.28" class="difflineplus">+nsresult nsMsgFileStream::InitWithFile(nsIFile *file)</span>
<a href="#l54.29"></a><span id="l54.29"> {</span>
<a href="#l54.30"></a><span id="l54.30">   return file-&gt;OpenNSPRFileDesc(PR_RDWR|PR_CREATE_FILE, 0664, &amp;mFileDesc);</span>
<a href="#l54.31"></a><span id="l54.31"> }</span>
<a href="#l54.32"></a><span id="l54.32"> </span>
<a href="#l54.33"></a><span id="l54.33"> NS_IMETHODIMP</span>
<a href="#l54.34"></a><span id="l54.34"> nsMsgFileStream::Seek(PRInt32 whence, PRInt64 offset)</span>
<a href="#l54.35"></a><span id="l54.35"> {</span>
<a href="#l54.36"></a><span id="l54.36">   if (mFileDesc == nsnull)</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l55.1"></a><span id="l55.1" class="difflineminus">--- a/mailnews/base/util/nsMsgFileStream.h</span>
<a href="#l55.2"></a><span id="l55.2" class="difflineplus">+++ b/mailnews/base/util/nsMsgFileStream.h</span>
<a href="#l55.3"></a><span id="l55.3" class="difflineat">@@ -17,13 +17,13 @@ public:</span>
<a href="#l55.4"></a><span id="l55.4">   NS_DECL_ISUPPORTS</span>
<a href="#l55.5"></a><span id="l55.5"> </span>
<a href="#l55.6"></a><span id="l55.6">   NS_IMETHOD Available(PRUint32 *_retval); </span>
<a href="#l55.7"></a><span id="l55.7">   NS_IMETHOD Read(char * aBuf, PRUint32 aCount, PRUint32 *_retval); </span>
<a href="#l55.8"></a><span id="l55.8">   NS_IMETHOD ReadSegments(nsWriteSegmentFun aWriter, void * aClosure, PRUint32 aCount, PRUint32 *_retval);</span>
<a href="#l55.9"></a><span id="l55.9">   NS_DECL_NSIOUTPUTSTREAM</span>
<a href="#l55.10"></a><span id="l55.10">   NS_DECL_NSISEEKABLESTREAM</span>
<a href="#l55.11"></a><span id="l55.11"> </span>
<a href="#l55.12"></a><span id="l55.12" class="difflineminus">-  nsresult InitWithFile(nsILocalFile *localFile);</span>
<a href="#l55.13"></a><span id="l55.13" class="difflineplus">+  nsresult InitWithFile(nsIFile *localFile);</span>
<a href="#l55.14"></a><span id="l55.14"> protected:</span>
<a href="#l55.15"></a><span id="l55.15">   PRFileDesc *mFileDesc;</span>
<a href="#l55.16"></a><span id="l55.16">   bool mSeekedToEnd;</span>
<a href="#l55.17"></a><span id="l55.17"> };</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l56.1"></a><span id="l56.1" class="difflineminus">--- a/mailnews/base/util/nsMsgI18N.cpp</span>
<a href="#l56.2"></a><span id="l56.2" class="difflineplus">+++ b/mailnews/base/util/nsMsgI18N.cpp</span>
<a href="#l56.3"></a><span id="l56.3" class="difflineat">@@ -293,17 +293,17 @@ bool nsMsgI18Ncheck_data_in_charset_rang</span>
<a href="#l56.4"></a><span id="l56.4">   }</span>
<a href="#l56.5"></a><span id="l56.5"> </span>
<a href="#l56.6"></a><span id="l56.6">   return result;</span>
<a href="#l56.7"></a><span id="l56.7"> }</span>
<a href="#l56.8"></a><span id="l56.8"> </span>
<a href="#l56.9"></a><span id="l56.9"> // Simple parser to parse META charset. </span>
<a href="#l56.10"></a><span id="l56.10"> // It only supports the case when the description is within one line. </span>
<a href="#l56.11"></a><span id="l56.11"> const char * </span>
<a href="#l56.12"></a><span id="l56.12" class="difflineminus">-nsMsgI18NParseMetaCharset(nsILocalFile* file) </span>
<a href="#l56.13"></a><span id="l56.13" class="difflineplus">+nsMsgI18NParseMetaCharset(nsIFile* file) </span>
<a href="#l56.14"></a><span id="l56.14"> { </span>
<a href="#l56.15"></a><span id="l56.15">   static char charset[nsIMimeConverter::MAX_CHARSET_NAME_LENGTH+1];</span>
<a href="#l56.16"></a><span id="l56.16"> </span>
<a href="#l56.17"></a><span id="l56.17">   *charset = '\0'; </span>
<a href="#l56.18"></a><span id="l56.18"> </span>
<a href="#l56.19"></a><span id="l56.19">   bool isDirectory = false;</span>
<a href="#l56.20"></a><span id="l56.20">   file-&gt;IsDirectory(&amp;isDirectory);</span>
<a href="#l56.21"></a><span id="l56.21">   if (isDirectory) {</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l57.1"></a><span id="l57.1" class="difflineminus">--- a/mailnews/base/util/nsMsgI18N.h</span>
<a href="#l57.2"></a><span id="l57.2" class="difflineplus">+++ b/mailnews/base/util/nsMsgI18N.h</span>
<a href="#l57.3"></a><span id="l57.3" class="difflineat">@@ -4,17 +4,17 @@</span>
<a href="#l57.4"></a><span id="l57.4">  * file, You can obtain one at http://mozilla.org/MPL/2.0/. */</span>
<a href="#l57.5"></a><span id="l57.5"> </span>
<a href="#l57.6"></a><span id="l57.6"> #ifndef _nsMsgI18N_H_</span>
<a href="#l57.7"></a><span id="l57.7"> #define _nsMsgI18N_H_</span>
<a href="#l57.8"></a><span id="l57.8"> </span>
<a href="#l57.9"></a><span id="l57.9"> #include &quot;nscore.h&quot;</span>
<a href="#l57.10"></a><span id="l57.10"> #include &quot;msgCore.h&quot;</span>
<a href="#l57.11"></a><span id="l57.11"> #include &quot;nsStringGlue.h&quot;</span>
<a href="#l57.12"></a><span id="l57.12" class="difflineminus">-class nsILocalFile;</span>
<a href="#l57.13"></a><span id="l57.13" class="difflineplus">+class nsIFile;</span>
<a href="#l57.14"></a><span id="l57.14"> </span>
<a href="#l57.15"></a><span id="l57.15"> /**</span>
<a href="#l57.16"></a><span id="l57.16">  * Encode an input string into RFC 2047 form.</span>
<a href="#l57.17"></a><span id="l57.17">  *</span>
<a href="#l57.18"></a><span id="l57.18">  * @param header       [IN] A header to encode.</span>
<a href="#l57.19"></a><span id="l57.19">  * @param structured   [IN] Specify the header is structured or non-structured field (See RFC-822).</span>
<a href="#l57.20"></a><span id="l57.20">  * @param charset      [IN] Charset name to convert.</span>
<a href="#l57.21"></a><span id="l57.21">  * @param fieldnamelen [IN] Header field name length. (e.g. &quot;From: &quot; -&gt; 6)</span>
<a href="#l57.22"></a><span id="l57.22" class="difflineat">@@ -93,20 +93,20 @@ NS_MSG_BASE nsresult nsMsgI18NConvertFro</span>
<a href="#l57.23"></a><span id="l57.23"> NS_MSG_BASE nsresult nsMsgI18NConvertToUnicode(const char* aCharset,</span>
<a href="#l57.24"></a><span id="l57.24">                                                const nsCString&amp; inString,</span>
<a href="#l57.25"></a><span id="l57.25">                                                nsAString&amp; outString,</span>
<a href="#l57.26"></a><span id="l57.26">                                                bool aIsCharsetCanonical =</span>
<a href="#l57.27"></a><span id="l57.27">                                                       false);</span>
<a href="#l57.28"></a><span id="l57.28"> /**</span>
<a href="#l57.29"></a><span id="l57.29">  * Parse for META charset.</span>
<a href="#l57.30"></a><span id="l57.30">  *</span>
<a href="#l57.31"></a><span id="l57.31" class="difflineminus">- * @param file    [IN] A nsILocalFile.</span>
<a href="#l57.32"></a><span id="l57.32" class="difflineplus">+ * @param file    [IN] A nsIFile.</span>
<a href="#l57.33"></a><span id="l57.33">  * @return            A charset name or empty string if not found.</span>
<a href="#l57.34"></a><span id="l57.34">  */</span>
<a href="#l57.35"></a><span id="l57.35" class="difflineminus">-NS_MSG_BASE const char *nsMsgI18NParseMetaCharset(nsILocalFile* file);</span>
<a href="#l57.36"></a><span id="l57.36" class="difflineplus">+NS_MSG_BASE const char *nsMsgI18NParseMetaCharset(nsIFile* file);</span>
<a href="#l57.37"></a><span id="l57.37"> </span>
<a href="#l57.38"></a><span id="l57.38"> /**</span>
<a href="#l57.39"></a><span id="l57.39">  * Convert from charset to unicode. Also does substitution for unconverted characters (e.g. entity, '?').</span>
<a href="#l57.40"></a><span id="l57.40">  *</span>
<a href="#l57.41"></a><span id="l57.41">  * @param contentType [IN] text/plain or text/html.</span>
<a href="#l57.42"></a><span id="l57.42">  * @param charset     [IN] Charset name to convert.</span>
<a href="#l57.43"></a><span id="l57.43">  * @param inString    [IN] Input unicode string to convert.</span>
<a href="#l57.44"></a><span id="l57.44">  * @param outString   [OUT] Allocated and converted output C string. Need PR_FREE.</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l58.1"></a><span id="l58.1" class="difflineminus">--- a/mailnews/base/util/nsMsgIdentity.cpp</span>
<a href="#l58.2"></a><span id="l58.2" class="difflineplus">+++ b/mailnews/base/util/nsMsgIdentity.cpp</span>
<a href="#l58.3"></a><span id="l58.3" class="difflineat">@@ -98,30 +98,30 @@ nsMsgIdentity::ToString(nsAString&amp; aResu</span>
<a href="#l58.4"></a><span id="l58.4">   aResult.Append(NS_ConvertASCIItoUTF16(mKey));</span>
<a href="#l58.5"></a><span id="l58.5">   aResult.AppendLiteral(&quot;]&quot;);</span>
<a href="#l58.6"></a><span id="l58.6">   return NS_OK;</span>
<a href="#l58.7"></a><span id="l58.7"> }</span>
<a href="#l58.8"></a><span id="l58.8"> </span>
<a href="#l58.9"></a><span id="l58.9"> /* Identity attribute accessors */</span>
<a href="#l58.10"></a><span id="l58.10"> </span>
<a href="#l58.11"></a><span id="l58.11"> NS_IMETHODIMP</span>
<a href="#l58.12"></a><span id="l58.12" class="difflineminus">-nsMsgIdentity::GetSignature(nsILocalFile **sig)</span>
<a href="#l58.13"></a><span id="l58.13" class="difflineplus">+nsMsgIdentity::GetSignature(nsIFile **sig)</span>
<a href="#l58.14"></a><span id="l58.14"> {</span>
<a href="#l58.15"></a><span id="l58.15">   bool gotRelPref;</span>
<a href="#l58.16"></a><span id="l58.16">   nsresult rv = NS_GetPersistentFile(&quot;sig_file&quot; REL_FILE_PREF_SUFFIX, &quot;sig_file&quot;, nsnull, gotRelPref, sig, mPrefBranch);</span>
<a href="#l58.17"></a><span id="l58.17">   if (NS_SUCCEEDED(rv) &amp;&amp; !gotRelPref)</span>
<a href="#l58.18"></a><span id="l58.18">   {</span>
<a href="#l58.19"></a><span id="l58.19">     rv = NS_SetPersistentFile(&quot;sig_file&quot; REL_FILE_PREF_SUFFIX, &quot;sig_file&quot;, *sig, mPrefBranch);</span>
<a href="#l58.20"></a><span id="l58.20">     NS_ASSERTION(NS_SUCCEEDED(rv), &quot;Failed to write signature file pref.&quot;);</span>
<a href="#l58.21"></a><span id="l58.21">   }</span>
<a href="#l58.22"></a><span id="l58.22">   return NS_OK;</span>
<a href="#l58.23"></a><span id="l58.23"> }</span>
<a href="#l58.24"></a><span id="l58.24"> </span>
<a href="#l58.25"></a><span id="l58.25"> NS_IMETHODIMP</span>
<a href="#l58.26"></a><span id="l58.26" class="difflineminus">-nsMsgIdentity::SetSignature(nsILocalFile *sig)</span>
<a href="#l58.27"></a><span id="l58.27" class="difflineplus">+nsMsgIdentity::SetSignature(nsIFile *sig)</span>
<a href="#l58.28"></a><span id="l58.28"> {</span>
<a href="#l58.29"></a><span id="l58.29">   nsresult rv = NS_OK;</span>
<a href="#l58.30"></a><span id="l58.30">   if (sig)</span>
<a href="#l58.31"></a><span id="l58.31">     rv = NS_SetPersistentFile(&quot;sig_file&quot; REL_FILE_PREF_SUFFIX, &quot;sig_file&quot;, sig, mPrefBranch);</span>
<a href="#l58.32"></a><span id="l58.32">   return rv;</span>
<a href="#l58.33"></a><span id="l58.33"> }</span>
<a href="#l58.34"></a><span id="l58.34"> </span>
<a href="#l58.35"></a><span id="l58.35"> NS_IMETHODIMP</span>
<a href="#l58.36"></a><span id="l58.36" class="difflineat">@@ -514,17 +514,17 @@ NS_IMETHODIMP nsMsgIdentity::GetIntAttri</span>
<a href="#l58.37"></a><span id="l58.37">     mDefPrefBranch-&gt;GetIntPref(aName, val);</span>
<a href="#l58.38"></a><span id="l58.38"> </span>
<a href="#l58.39"></a><span id="l58.39">   return NS_OK;</span>
<a href="#l58.40"></a><span id="l58.40"> }</span>
<a href="#l58.41"></a><span id="l58.41"> </span>
<a href="#l58.42"></a><span id="l58.42"> #define COPY_IDENTITY_FILE_VALUE(SRC_ID,MACRO_GETTER,MACRO_SETTER)   \</span>
<a href="#l58.43"></a><span id="l58.43">   {  \</span>
<a href="#l58.44"></a><span id="l58.44">     nsresult macro_rv;  \</span>
<a href="#l58.45"></a><span id="l58.45" class="difflineminus">-    nsCOMPtr &lt;nsILocalFile&gt;macro_spec;   \</span>
<a href="#l58.46"></a><span id="l58.46" class="difflineplus">+    nsCOMPtr &lt;nsIFile&gt;macro_spec;   \</span>
<a href="#l58.47"></a><span id="l58.47">           macro_rv = SRC_ID-&gt;MACRO_GETTER(getter_AddRefs(macro_spec)); \</span>
<a href="#l58.48"></a><span id="l58.48">           if (NS_SUCCEEDED(macro_rv)) \</span>
<a href="#l58.49"></a><span id="l58.49">             this-&gt;MACRO_SETTER(macro_spec);     \</span>
<a href="#l58.50"></a><span id="l58.50">   }</span>
<a href="#l58.51"></a><span id="l58.51"> </span>
<a href="#l58.52"></a><span id="l58.52"> #define COPY_IDENTITY_INT_VALUE(SRC_ID,MACRO_GETTER,MACRO_SETTER)   \</span>
<a href="#l58.53"></a><span id="l58.53">   {  \</span>
<a href="#l58.54"></a><span id="l58.54">         nsresult macro_rv;  \</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l59.1"></a><span id="l59.1" class="difflineminus">--- a/mailnews/base/util/nsMsgIncomingServer.cpp</span>
<a href="#l59.2"></a><span id="l59.2" class="difflineplus">+++ b/mailnews/base/util/nsMsgIncomingServer.cpp</span>
<a href="#l59.3"></a><span id="l59.3" class="difflineat">@@ -419,34 +419,34 @@ nsMsgIncomingServer::GetIntValue(const c</span>
<a href="#l59.4"></a><span id="l59.4">     mDefPrefBranch-&gt;GetIntPref(prefname, val);</span>
<a href="#l59.5"></a><span id="l59.5"> </span>
<a href="#l59.6"></a><span id="l59.6">   return NS_OK;</span>
<a href="#l59.7"></a><span id="l59.7"> }</span>
<a href="#l59.8"></a><span id="l59.8"> </span>
<a href="#l59.9"></a><span id="l59.9"> NS_IMETHODIMP</span>
<a href="#l59.10"></a><span id="l59.10"> nsMsgIncomingServer::GetFileValue(const char* aRelPrefName,</span>
<a href="#l59.11"></a><span id="l59.11">                                   const char* aAbsPrefName,</span>
<a href="#l59.12"></a><span id="l59.12" class="difflineminus">-                                  nsILocalFile** aLocalFile)</span>
<a href="#l59.13"></a><span id="l59.13" class="difflineplus">+                                  nsIFile** aLocalFile)</span>
<a href="#l59.14"></a><span id="l59.14"> {</span>
<a href="#l59.15"></a><span id="l59.15">   if (!mPrefBranch)</span>
<a href="#l59.16"></a><span id="l59.16">     return NS_ERROR_NOT_INITIALIZED;</span>
<a href="#l59.17"></a><span id="l59.17"> </span>
<a href="#l59.18"></a><span id="l59.18">   // Get the relative first</span>
<a href="#l59.19"></a><span id="l59.19">   nsCOMPtr&lt;nsIRelativeFilePref&gt; relFilePref;</span>
<a href="#l59.20"></a><span id="l59.20">   nsresult rv = mPrefBranch-&gt;GetComplexValue(aRelPrefName,</span>
<a href="#l59.21"></a><span id="l59.21">                                              NS_GET_IID(nsIRelativeFilePref),</span>
<a href="#l59.22"></a><span id="l59.22">                                              getter_AddRefs(relFilePref));</span>
<a href="#l59.23"></a><span id="l59.23">   if (relFilePref) {</span>
<a href="#l59.24"></a><span id="l59.24">     rv = relFilePref-&gt;GetFile(aLocalFile);</span>
<a href="#l59.25"></a><span id="l59.25">     NS_ASSERTION(*aLocalFile, &quot;An nsIRelativeFilePref has no file.&quot;);</span>
<a href="#l59.26"></a><span id="l59.26">     if (NS_SUCCEEDED(rv))</span>
<a href="#l59.27"></a><span id="l59.27">       (*aLocalFile)-&gt;Normalize();</span>
<a href="#l59.28"></a><span id="l59.28">   } else {</span>
<a href="#l59.29"></a><span id="l59.29">     rv = mPrefBranch-&gt;GetComplexValue(aAbsPrefName,</span>
<a href="#l59.30"></a><span id="l59.30" class="difflineminus">-                                      NS_GET_IID(nsILocalFile),</span>
<a href="#l59.31"></a><span id="l59.31" class="difflineplus">+                                      NS_GET_IID(nsIFile),</span>
<a href="#l59.32"></a><span id="l59.32">                                       reinterpret_cast&lt;void**&gt;(aLocalFile));</span>
<a href="#l59.33"></a><span id="l59.33">     if (NS_FAILED(rv))</span>
<a href="#l59.34"></a><span id="l59.34">       return rv;</span>
<a href="#l59.35"></a><span id="l59.35"> </span>
<a href="#l59.36"></a><span id="l59.36">     rv = NS_NewRelativeFilePref(*aLocalFile,</span>
<a href="#l59.37"></a><span id="l59.37">                                 NS_LITERAL_CSTRING(NS_APP_USER_PROFILE_50_DIR),</span>
<a href="#l59.38"></a><span id="l59.38">                                 getter_AddRefs(relFilePref));</span>
<a href="#l59.39"></a><span id="l59.39">     if (relFilePref)</span>
<a href="#l59.40"></a><span id="l59.40" class="difflineat">@@ -456,34 +456,34 @@ nsMsgIncomingServer::GetFileValue(const </span>
<a href="#l59.41"></a><span id="l59.41">   }</span>
<a href="#l59.42"></a><span id="l59.42"> </span>
<a href="#l59.43"></a><span id="l59.43">   return rv;</span>
<a href="#l59.44"></a><span id="l59.44"> }</span>
<a href="#l59.45"></a><span id="l59.45"> </span>
<a href="#l59.46"></a><span id="l59.46"> NS_IMETHODIMP</span>
<a href="#l59.47"></a><span id="l59.47"> nsMsgIncomingServer::SetFileValue(const char* aRelPrefName,</span>
<a href="#l59.48"></a><span id="l59.48">                                   const char* aAbsPrefName,</span>
<a href="#l59.49"></a><span id="l59.49" class="difflineminus">-                                  nsILocalFile* aLocalFile)</span>
<a href="#l59.50"></a><span id="l59.50" class="difflineplus">+                                  nsIFile* aLocalFile)</span>
<a href="#l59.51"></a><span id="l59.51"> {</span>
<a href="#l59.52"></a><span id="l59.52">   if (!mPrefBranch)</span>
<a href="#l59.53"></a><span id="l59.53">     return NS_ERROR_NOT_INITIALIZED;</span>
<a href="#l59.54"></a><span id="l59.54"> </span>
<a href="#l59.55"></a><span id="l59.55">   // Write the relative path.</span>
<a href="#l59.56"></a><span id="l59.56">   nsCOMPtr&lt;nsIRelativeFilePref&gt; relFilePref;</span>
<a href="#l59.57"></a><span id="l59.57">   NS_NewRelativeFilePref(aLocalFile,</span>
<a href="#l59.58"></a><span id="l59.58">                          NS_LITERAL_CSTRING(NS_APP_USER_PROFILE_50_DIR),</span>
<a href="#l59.59"></a><span id="l59.59">                          getter_AddRefs(relFilePref));</span>
<a href="#l59.60"></a><span id="l59.60">   if (relFilePref) {</span>
<a href="#l59.61"></a><span id="l59.61">     nsresult rv = mPrefBranch-&gt;SetComplexValue(aRelPrefName,</span>
<a href="#l59.62"></a><span id="l59.62">                                                NS_GET_IID(nsIRelativeFilePref),</span>
<a href="#l59.63"></a><span id="l59.63">                                                relFilePref);</span>
<a href="#l59.64"></a><span id="l59.64">     if (NS_FAILED(rv))</span>
<a href="#l59.65"></a><span id="l59.65">       return rv;</span>
<a href="#l59.66"></a><span id="l59.66">   }</span>
<a href="#l59.67"></a><span id="l59.67" class="difflineminus">-  return mPrefBranch-&gt;SetComplexValue(aAbsPrefName, NS_GET_IID(nsILocalFile), aLocalFile);</span>
<a href="#l59.68"></a><span id="l59.68" class="difflineplus">+  return mPrefBranch-&gt;SetComplexValue(aAbsPrefName, NS_GET_IID(nsIFile), aLocalFile);</span>
<a href="#l59.69"></a><span id="l59.69"> }</span>
<a href="#l59.70"></a><span id="l59.70"> </span>
<a href="#l59.71"></a><span id="l59.71"> NS_IMETHODIMP</span>
<a href="#l59.72"></a><span id="l59.72"> nsMsgIncomingServer::SetIntValue(const char *prefname,</span>
<a href="#l59.73"></a><span id="l59.73">                                  PRInt32 val)</span>
<a href="#l59.74"></a><span id="l59.74"> {</span>
<a href="#l59.75"></a><span id="l59.75">   if (!mPrefBranch)</span>
<a href="#l59.76"></a><span id="l59.76">     return NS_ERROR_NOT_INITIALIZED;</span>
<a href="#l59.77"></a><span id="l59.77" class="difflineat">@@ -875,44 +875,44 @@ nsMsgIncomingServer::ForgetPassword()</span>
<a href="#l59.78"></a><span id="l59.78"> NS_IMETHODIMP</span>
<a href="#l59.79"></a><span id="l59.79"> nsMsgIncomingServer::ForgetSessionPassword()</span>
<a href="#l59.80"></a><span id="l59.80"> {</span>
<a href="#l59.81"></a><span id="l59.81">   m_password.Truncate();</span>
<a href="#l59.82"></a><span id="l59.82">   return NS_OK;</span>
<a href="#l59.83"></a><span id="l59.83"> }</span>
<a href="#l59.84"></a><span id="l59.84"> </span>
<a href="#l59.85"></a><span id="l59.85"> NS_IMETHODIMP</span>
<a href="#l59.86"></a><span id="l59.86" class="difflineminus">-nsMsgIncomingServer::SetDefaultLocalPath(nsILocalFile *aDefaultLocalPath)</span>
<a href="#l59.87"></a><span id="l59.87" class="difflineplus">+nsMsgIncomingServer::SetDefaultLocalPath(nsIFile *aDefaultLocalPath)</span>
<a href="#l59.88"></a><span id="l59.88"> {</span>
<a href="#l59.89"></a><span id="l59.89">   nsresult rv;</span>
<a href="#l59.90"></a><span id="l59.90">   nsCOMPtr&lt;nsIMsgProtocolInfo&gt; protocolInfo;</span>
<a href="#l59.91"></a><span id="l59.91">   rv = getProtocolInfo(getter_AddRefs(protocolInfo));</span>
<a href="#l59.92"></a><span id="l59.92">   NS_ENSURE_SUCCESS(rv, rv);</span>
<a href="#l59.93"></a><span id="l59.93">   return protocolInfo-&gt;SetDefaultLocalPath(aDefaultLocalPath);</span>
<a href="#l59.94"></a><span id="l59.94"> }</span>
<a href="#l59.95"></a><span id="l59.95"> </span>
<a href="#l59.96"></a><span id="l59.96"> NS_IMETHODIMP</span>
<a href="#l59.97"></a><span id="l59.97" class="difflineminus">-nsMsgIncomingServer::GetLocalPath(nsILocalFile **aLocalPath)</span>
<a href="#l59.98"></a><span id="l59.98" class="difflineplus">+nsMsgIncomingServer::GetLocalPath(nsIFile **aLocalPath)</span>
<a href="#l59.99"></a><span id="l59.99"> {</span>
<a href="#l59.100"></a><span id="l59.100">   nsresult rv;</span>
<a href="#l59.101"></a><span id="l59.101"> </span>
<a href="#l59.102"></a><span id="l59.102">   // if the local path has already been set, use it</span>
<a href="#l59.103"></a><span id="l59.103">   rv = GetFileValue(&quot;directory-rel&quot;, &quot;directory&quot;, aLocalPath);</span>
<a href="#l59.104"></a><span id="l59.104">   if (NS_SUCCEEDED(rv) &amp;&amp; *aLocalPath)</span>
<a href="#l59.105"></a><span id="l59.105">     return rv;</span>
<a href="#l59.106"></a><span id="l59.106"> </span>
<a href="#l59.107"></a><span id="l59.107">   // otherwise, create the path using the protocol info.</span>
<a href="#l59.108"></a><span id="l59.108">   // note we are using the</span>
<a href="#l59.109"></a><span id="l59.109">   // hostname, unless that directory exists.</span>
<a href="#l59.110"></a><span id="l59.110"> // this should prevent all collisions.</span>
<a href="#l59.111"></a><span id="l59.111">   nsCOMPtr&lt;nsIMsgProtocolInfo&gt; protocolInfo;</span>
<a href="#l59.112"></a><span id="l59.112">   rv = getProtocolInfo(getter_AddRefs(protocolInfo));</span>
<a href="#l59.113"></a><span id="l59.113">   NS_ENSURE_SUCCESS(rv, rv);</span>
<a href="#l59.114"></a><span id="l59.114"> </span>
<a href="#l59.115"></a><span id="l59.115" class="difflineminus">-  nsCOMPtr&lt;nsILocalFile&gt; localPath;</span>
<a href="#l59.116"></a><span id="l59.116" class="difflineplus">+  nsCOMPtr&lt;nsIFile&gt; localPath;</span>
<a href="#l59.117"></a><span id="l59.117">   rv = protocolInfo-&gt;GetDefaultLocalPath(getter_AddRefs(localPath));</span>
<a href="#l59.118"></a><span id="l59.118">   NS_ENSURE_SUCCESS(rv, rv);</span>
<a href="#l59.119"></a><span id="l59.119">   localPath-&gt;Create(nsIFile::DIRECTORY_TYPE, 0755);</span>
<a href="#l59.120"></a><span id="l59.120"> </span>
<a href="#l59.121"></a><span id="l59.121">   nsCString hostname;</span>
<a href="#l59.122"></a><span id="l59.122">   rv = GetHostName(hostname);</span>
<a href="#l59.123"></a><span id="l59.123">   NS_ENSURE_SUCCESS(rv, rv);</span>
<a href="#l59.124"></a><span id="l59.124">   </span>
<a href="#l59.125"></a><span id="l59.125" class="difflineat">@@ -955,17 +955,17 @@ nsMsgIncomingServer::GetMsgStore(nsIMsgP</span>
<a href="#l59.126"></a><span id="l59.126">     NS_ENSURE_SUCCESS(rv, rv);</span>
<a href="#l59.127"></a><span id="l59.127">   }</span>
<a href="#l59.128"></a><span id="l59.128">   NS_IF_ADDREF(*aMsgStore = m_msgStore);</span>
<a href="#l59.129"></a><span id="l59.129">   return NS_OK;</span>
<a href="#l59.130"></a><span id="l59.130"> }</span>
<a href="#l59.131"></a><span id="l59.131"> </span>
<a href="#l59.132"></a><span id="l59.132"> </span>
<a href="#l59.133"></a><span id="l59.133"> NS_IMETHODIMP</span>
<a href="#l59.134"></a><span id="l59.134" class="difflineminus">-nsMsgIncomingServer::SetLocalPath(nsILocalFile *aLocalPath)</span>
<a href="#l59.135"></a><span id="l59.135" class="difflineplus">+nsMsgIncomingServer::SetLocalPath(nsIFile *aLocalPath)</span>
<a href="#l59.136"></a><span id="l59.136"> {</span>
<a href="#l59.137"></a><span id="l59.137">   NS_ENSURE_ARG_POINTER(aLocalPath);</span>
<a href="#l59.138"></a><span id="l59.138">   aLocalPath-&gt;Create(nsIFile::DIRECTORY_TYPE, 0755);</span>
<a href="#l59.139"></a><span id="l59.139">   return SetFileValue(&quot;directory-rel&quot;, &quot;directory&quot;, aLocalPath);</span>
<a href="#l59.140"></a><span id="l59.140"> }</span>
<a href="#l59.141"></a><span id="l59.141"> </span>
<a href="#l59.142"></a><span id="l59.142"> NS_IMETHODIMP</span>
<a href="#l59.143"></a><span id="l59.143"> nsMsgIncomingServer::GetLocalStoreType(nsACString&amp; aResult)</span>
<a href="#l59.144"></a><span id="l59.144" class="difflineat">@@ -1026,17 +1026,17 @@ nsMsgIncomingServer::RemoveFiles()</span>
<a href="#l59.145"></a><span id="l59.145">   GetCharValue(&quot;deferred_to_account&quot;, deferredToAccount);</span>
<a href="#l59.146"></a><span id="l59.146">   bool isDeferredTo = true;</span>
<a href="#l59.147"></a><span id="l59.147">   GetIsDeferredTo(&amp;isDeferredTo);</span>
<a href="#l59.148"></a><span id="l59.148">   if (!deferredToAccount.IsEmpty() || isDeferredTo)</span>
<a href="#l59.149"></a><span id="l59.149">   {</span>
<a href="#l59.150"></a><span id="l59.150">     NS_ASSERTION(false, &quot;shouldn't remove files for a deferred account&quot;);</span>
<a href="#l59.151"></a><span id="l59.151">     return NS_ERROR_FAILURE;</span>
<a href="#l59.152"></a><span id="l59.152">   }</span>
<a href="#l59.153"></a><span id="l59.153" class="difflineminus">-  nsCOMPtr &lt;nsILocalFile&gt; localPath;</span>
<a href="#l59.154"></a><span id="l59.154" class="difflineplus">+  nsCOMPtr &lt;nsIFile&gt; localPath;</span>
<a href="#l59.155"></a><span id="l59.155">   nsresult rv = GetLocalPath(getter_AddRefs(localPath));</span>
<a href="#l59.156"></a><span id="l59.156">   NS_ENSURE_SUCCESS(rv, rv);</span>
<a href="#l59.157"></a><span id="l59.157">   return localPath-&gt;Remove(true);</span>
<a href="#l59.158"></a><span id="l59.158"> }</span>
<a href="#l59.159"></a><span id="l59.159"> </span>
<a href="#l59.160"></a><span id="l59.160"> NS_IMETHODIMP</span>
<a href="#l59.161"></a><span id="l59.161"> nsMsgIncomingServer::SetFilterList(nsIMsgFilterList *aFilterList)</span>
<a href="#l59.162"></a><span id="l59.162"> {</span>
<a href="#l59.163"></a><span id="l59.163" class="difflineat">@@ -1074,32 +1074,32 @@ nsMsgIncomingServer::GetFilterList(nsIMs</span>
<a href="#l59.164"></a><span id="l59.164"> </span>
<a href="#l59.165"></a><span id="l59.165">         NS_ADDREF(*aResult = mFilterList);</span>
<a href="#l59.166"></a><span id="l59.166">         return NS_OK;</span>
<a href="#l59.167"></a><span id="l59.167">       }</span>
<a href="#l59.168"></a><span id="l59.168"> </span>
<a href="#l59.169"></a><span id="l59.169">       // The default case, a local folder, is a bit special. It requires</span>
<a href="#l59.170"></a><span id="l59.170">       // more initialization.</span>
<a href="#l59.171"></a><span id="l59.171"> </span>
<a href="#l59.172"></a><span id="l59.172" class="difflineminus">-      nsCOMPtr&lt;nsILocalFile&gt; thisFolder;</span>
<a href="#l59.173"></a><span id="l59.173" class="difflineplus">+      nsCOMPtr&lt;nsIFile&gt; thisFolder;</span>
<a href="#l59.174"></a><span id="l59.174">       rv = msgFolder-&gt;GetFilePath(getter_AddRefs(thisFolder));</span>
<a href="#l59.175"></a><span id="l59.175">       NS_ENSURE_SUCCESS(rv, rv);</span>
<a href="#l59.176"></a><span id="l59.176"> </span>
<a href="#l59.177"></a><span id="l59.177">       mFilterFile = do_CreateInstance(NS_LOCAL_FILE_CONTRACTID, &amp;rv);</span>
<a href="#l59.178"></a><span id="l59.178">       NS_ENSURE_SUCCESS(rv, rv);</span>
<a href="#l59.179"></a><span id="l59.179">       rv = mFilterFile-&gt;InitWithFile(thisFolder);</span>
<a href="#l59.180"></a><span id="l59.180">       NS_ENSURE_SUCCESS(rv, rv);</span>
<a href="#l59.181"></a><span id="l59.181"> </span>
<a href="#l59.182"></a><span id="l59.182">       mFilterFile-&gt;AppendNative(NS_LITERAL_CSTRING(&quot;msgFilterRules.dat&quot;));</span>
<a href="#l59.183"></a><span id="l59.183"> </span>
<a href="#l59.184"></a><span id="l59.184">       bool fileExists;</span>
<a href="#l59.185"></a><span id="l59.185">       mFilterFile-&gt;Exists(&amp;fileExists);</span>
<a href="#l59.186"></a><span id="l59.186">       if (!fileExists)</span>
<a href="#l59.187"></a><span id="l59.187">       {</span>
<a href="#l59.188"></a><span id="l59.188" class="difflineminus">-        nsCOMPtr&lt;nsILocalFile&gt; oldFilterFile = do_CreateInstance(NS_LOCAL_FILE_CONTRACTID, &amp;rv);</span>
<a href="#l59.189"></a><span id="l59.189" class="difflineplus">+        nsCOMPtr&lt;nsIFile&gt; oldFilterFile = do_CreateInstance(NS_LOCAL_FILE_CONTRACTID, &amp;rv);</span>
<a href="#l59.190"></a><span id="l59.190">         NS_ENSURE_SUCCESS(rv, rv);</span>
<a href="#l59.191"></a><span id="l59.191">         rv = oldFilterFile-&gt;InitWithFile(thisFolder);</span>
<a href="#l59.192"></a><span id="l59.192">         NS_ENSURE_SUCCESS(rv, rv);</span>
<a href="#l59.193"></a><span id="l59.193">         oldFilterFile-&gt;AppendNative(NS_LITERAL_CSTRING(&quot;rules.dat&quot;));</span>
<a href="#l59.194"></a><span id="l59.194"> </span>
<a href="#l59.195"></a><span id="l59.195">         oldFilterFile-&gt;Exists(&amp;fileExists);</span>
<a href="#l59.196"></a><span id="l59.196">         if (fileExists)  //copy rules.dat --&gt; msgFilterRules.dat</span>
<a href="#l59.197"></a><span id="l59.197">         {</span>
<a href="#l59.198"></a><span id="l59.198" class="difflineat">@@ -1835,18 +1835,17 @@ nsMsgIncomingServer::ConfigureTemporaryS</span>
<a href="#l59.199"></a><span id="l59.199">   // it's possible that we can no longer find the sfd file (i.e. the user disabled an extnsion that</span>
<a href="#l59.200"></a><span id="l59.200">   // was supplying the .sfd file.</span>
<a href="#l59.201"></a><span id="l59.201">   if (!file)</span>
<a href="#l59.202"></a><span id="l59.202">     return NS_OK;</span>
<a href="#l59.203"></a><span id="l59.203"> </span>
<a href="#l59.204"></a><span id="l59.204">   nsCOMPtr&lt;nsIMsgFilterService&gt; filterService = do_GetService(NS_MSGFILTERSERVICE_CONTRACTID, &amp;rv);</span>
<a href="#l59.205"></a><span id="l59.205">   nsCOMPtr&lt;nsIMsgFilterList&gt; serverFilterList;</span>
<a href="#l59.206"></a><span id="l59.206"> </span>
<a href="#l59.207"></a><span id="l59.207" class="difflineminus">-  nsCOMPtr &lt;nsILocalFile&gt; localFile = do_QueryInterface(file);</span>
<a href="#l59.208"></a><span id="l59.208" class="difflineminus">-  rv = filterService-&gt;OpenFilterList(localFile, NULL, NULL, getter_AddRefs(serverFilterList));</span>
<a href="#l59.209"></a><span id="l59.209" class="difflineplus">+  rv = filterService-&gt;OpenFilterList(file, NULL, NULL, getter_AddRefs(serverFilterList));</span>
<a href="#l59.210"></a><span id="l59.210">   NS_ENSURE_SUCCESS(rv, rv);</span>
<a href="#l59.211"></a><span id="l59.211"> </span>
<a href="#l59.212"></a><span id="l59.212">   rv = serverFilterList-&gt;GetFilterNamed(yesFilterName,</span>
<a href="#l59.213"></a><span id="l59.213">                                   getter_AddRefs(newFilter));</span>
<a href="#l59.214"></a><span id="l59.214">   if (newFilter &amp;&amp; serverFilterTrustFlags &amp; nsISpamSettings::TRUST_POSITIVES)</span>
<a href="#l59.215"></a><span id="l59.215">   {</span>
<a href="#l59.216"></a><span id="l59.216">     newFilter-&gt;SetTemporary(true);</span>
<a href="#l59.217"></a><span id="l59.217">     // check if we're supposed to move junk mail to junk folder; if so,</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l60.1"></a><span id="l60.1" class="difflineminus">--- a/mailnews/base/util/nsMsgIncomingServer.h</span>
<a href="#l60.2"></a><span id="l60.2" class="difflineplus">+++ b/mailnews/base/util/nsMsgIncomingServer.h</span>
<a href="#l60.3"></a><span id="l60.3" class="difflineat">@@ -6,17 +6,17 @@</span>
<a href="#l60.4"></a><span id="l60.4"> #ifndef nsMsgIncomingServer_h__</span>
<a href="#l60.5"></a><span id="l60.5"> #define nsMsgIncomingServer_h__</span>
<a href="#l60.6"></a><span id="l60.6"> </span>
<a href="#l60.7"></a><span id="l60.7"> #include &quot;nsIMsgIncomingServer.h&quot;</span>
<a href="#l60.8"></a><span id="l60.8"> #include &quot;nsIPrefBranch.h&quot;</span>
<a href="#l60.9"></a><span id="l60.9"> #include &quot;nsIMsgFilterList.h&quot;</span>
<a href="#l60.10"></a><span id="l60.10"> #include &quot;msgCore.h&quot;</span>
<a href="#l60.11"></a><span id="l60.11"> #include &quot;nsIMsgFolder.h&quot;</span>
<a href="#l60.12"></a><span id="l60.12" class="difflineminus">-#include &quot;nsILocalFile.h&quot;</span>
<a href="#l60.13"></a><span id="l60.13" class="difflineplus">+#include &quot;nsIFile.h&quot;</span>
<a href="#l60.14"></a><span id="l60.14"> #include &quot;nsCOMPtr.h&quot;</span>
<a href="#l60.15"></a><span id="l60.15"> #include &quot;nsWeakReference.h&quot;</span>
<a href="#l60.16"></a><span id="l60.16"> #include &quot;nsIMsgDatabase.h&quot;</span>
<a href="#l60.17"></a><span id="l60.17"> #include &quot;nsISpamSettings.h&quot;</span>
<a href="#l60.18"></a><span id="l60.18"> #include &quot;nsIMsgFilterPlugin.h&quot;</span>
<a href="#l60.19"></a><span id="l60.19"> #include &quot;nsDataHashtable.h&quot;</span>
<a href="#l60.20"></a><span id="l60.20"> #include &quot;nsIMsgPluggableStore.h&quot;</span>
<a href="#l60.21"></a><span id="l60.21"> </span>
<a href="#l60.22"></a><span id="l60.22" class="difflineat">@@ -65,17 +65,17 @@ protected:</span>
<a href="#l60.23"></a><span id="l60.23"> </span>
<a href="#l60.24"></a><span id="l60.24">   nsresult CreateRootFolder();</span>
<a href="#l60.25"></a><span id="l60.25">   virtual nsresult CreateRootFolderFromUri(const nsCString &amp;serverUri,</span>
<a href="#l60.26"></a><span id="l60.26">                                            nsIMsgFolder **rootFolder) = 0;</span>
<a href="#l60.27"></a><span id="l60.27"> </span>
<a href="#l60.28"></a><span id="l60.28">   nsresult InternalSetHostName(const nsACString&amp; aHostname, const char * prefName);</span>
<a href="#l60.29"></a><span id="l60.29"> </span>
<a href="#l60.30"></a><span id="l60.30">   nsresult getProtocolInfo(nsIMsgProtocolInfo **aResult);</span>
<a href="#l60.31"></a><span id="l60.31" class="difflineminus">-  nsCOMPtr &lt;nsILocalFile&gt; mFilterFile;</span>
<a href="#l60.32"></a><span id="l60.32" class="difflineplus">+  nsCOMPtr &lt;nsIFile&gt; mFilterFile;</span>
<a href="#l60.33"></a><span id="l60.33">   nsCOMPtr &lt;nsIMsgFilterList&gt; mFilterList;</span>
<a href="#l60.34"></a><span id="l60.34">   nsCOMPtr &lt;nsIMsgFilterList&gt; mEditableFilterList;</span>
<a href="#l60.35"></a><span id="l60.35">   nsCOMPtr&lt;nsIPrefBranch&gt; mPrefBranch;</span>
<a href="#l60.36"></a><span id="l60.36">   nsCOMPtr&lt;nsIPrefBranch&gt; mDefPrefBranch;</span>
<a href="#l60.37"></a><span id="l60.37"> </span>
<a href="#l60.38"></a><span id="l60.38">   // these allow us to handle duplicate incoming messages, e.g. delete them.</span>
<a href="#l60.39"></a><span id="l60.39">   nsDataHashtable&lt;nsCStringHashKey,PRInt32&gt; m_downloadedHdrs;</span>
<a href="#l60.40"></a><span id="l60.40">   PRInt32  m_numMsgsDownloaded;</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l61.1"></a><span id="l61.1" class="difflineminus">--- a/mailnews/base/util/nsMsgMailNewsUrl.cpp</span>
<a href="#l61.2"></a><span id="l61.2" class="difflineplus">+++ b/mailnews/base/util/nsMsgMailNewsUrl.cpp</span>
<a href="#l61.3"></a><span id="l61.3" class="difflineat">@@ -925,19 +925,18 @@ nsresult nsMsgSaveAsListener::SetupMsgWr</span>
<a href="#l61.4"></a><span id="l61.4">   // nsMessenger::SaveAs now opens the stream on the nsIFile</span>
<a href="#l61.5"></a><span id="l61.5">   // object, thus creating an empty file. Actual save operations for</span>
<a href="#l61.6"></a><span id="l61.6">   // IMAP and NNTP use this nsMsgSaveAsListener here, though, so we</span>
<a href="#l61.7"></a><span id="l61.7">   // have to close the stream before deleting the file, else data</span>
<a href="#l61.8"></a><span id="l61.8">   // would still be written happily into a now non-existing file.</span>
<a href="#l61.9"></a><span id="l61.9">   // (Windows doesn't care, btw, just unixoids do...)</span>
<a href="#l61.10"></a><span id="l61.10">   aFile-&gt;Remove(false);</span>
<a href="#l61.11"></a><span id="l61.11"> </span>
<a href="#l61.12"></a><span id="l61.12" class="difflineminus">-  nsCOMPtr &lt;nsILocalFile&gt; localFile = do_QueryInterface(aFile);</span>
<a href="#l61.13"></a><span id="l61.13">   nsresult rv = MsgNewBufferedFileOutputStream(getter_AddRefs(m_outputStream),</span>
<a href="#l61.14"></a><span id="l61.14" class="difflineminus">-                                               localFile, -1, 00600);</span>
<a href="#l61.15"></a><span id="l61.15" class="difflineplus">+                                               aFile, -1, 00600);</span>
<a href="#l61.16"></a><span id="l61.16">   NS_ENSURE_SUCCESS(rv, rv);</span>
<a href="#l61.17"></a><span id="l61.17"> </span>
<a href="#l61.18"></a><span id="l61.18">   if (m_outputStream &amp;&amp; addDummyEnvelope)</span>
<a href="#l61.19"></a><span id="l61.19">   {</span>
<a href="#l61.20"></a><span id="l61.20">     nsCAutoString result;</span>
<a href="#l61.21"></a><span id="l61.21">     PRUint32 writeCount;</span>
<a href="#l61.22"></a><span id="l61.22"> </span>
<a href="#l61.23"></a><span id="l61.23">     time_t now = time((time_t*) 0);</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l62.1"></a><span id="l62.1" class="difflineminus">--- a/mailnews/base/util/nsMsgUtils.cpp</span>
<a href="#l62.2"></a><span id="l62.2" class="difflineplus">+++ b/mailnews/base/util/nsMsgUtils.cpp</span>
<a href="#l62.3"></a><span id="l62.3" class="difflineat">@@ -926,17 +926,17 @@ GetOrCreateFolder(const nsACString &amp;aURI</span>
<a href="#l62.4"></a><span id="l62.4">   nsCOMPtr &lt;nsIMsgFolder&gt; msgFolder;</span>
<a href="#l62.5"></a><span id="l62.5">   rv = server-&gt;GetMsgFolderFromURI(folderResource, aURI, getter_AddRefs(msgFolder));</span>
<a href="#l62.6"></a><span id="l62.6">   NS_ENSURE_SUCCESS(rv,rv);</span>
<a href="#l62.7"></a><span id="l62.7"> </span>
<a href="#l62.8"></a><span id="l62.8">   nsCOMPtr &lt;nsIMsgFolder&gt; parent;</span>
<a href="#l62.9"></a><span id="l62.9">   rv = msgFolder-&gt;GetParent(getter_AddRefs(parent));</span>
<a href="#l62.10"></a><span id="l62.10">   if (NS_FAILED(rv) || !parent)</span>
<a href="#l62.11"></a><span id="l62.11">   {</span>
<a href="#l62.12"></a><span id="l62.12" class="difflineminus">-    nsCOMPtr &lt;nsILocalFile&gt; folderPath;</span>
<a href="#l62.13"></a><span id="l62.13" class="difflineplus">+    nsCOMPtr &lt;nsIFile&gt; folderPath;</span>
<a href="#l62.14"></a><span id="l62.14">     // for local folders, path is to the berkeley mailbox.</span>
<a href="#l62.15"></a><span id="l62.15">     // for imap folders, path needs to have .msf appended to the name</span>
<a href="#l62.16"></a><span id="l62.16">     msgFolder-&gt;GetFilePath(getter_AddRefs(folderPath));</span>
<a href="#l62.17"></a><span id="l62.17"> </span>
<a href="#l62.18"></a><span id="l62.18">     nsCString type;</span>
<a href="#l62.19"></a><span id="l62.19">     rv = server-&gt;GetType(type);</span>
<a href="#l62.20"></a><span id="l62.20">     NS_ENSURE_SUCCESS(rv,rv);</span>
<a href="#l62.21"></a><span id="l62.21"> </span>
<a href="#l62.22"></a><span id="l62.22" class="difflineat">@@ -1147,17 +1147,17 @@ nsresult MSGApopMD5(const char *text, PR</span>
<a href="#l62.23"></a><span id="l62.23">   memcpy(digest, result.get(), DIGEST_LENGTH);</span>
<a href="#l62.24"></a><span id="l62.24">   return rv;</span>
<a href="#l62.25"></a><span id="l62.25"> }</span>
<a href="#l62.26"></a><span id="l62.26"> </span>
<a href="#l62.27"></a><span id="l62.27"> NS_MSG_BASE nsresult NS_GetPersistentFile(const char *relPrefName,</span>
<a href="#l62.28"></a><span id="l62.28">                                           const char *absPrefName,</span>
<a href="#l62.29"></a><span id="l62.29">                                           const char *dirServiceProp,</span>
<a href="#l62.30"></a><span id="l62.30">                                           bool&amp; gotRelPref,</span>
<a href="#l62.31"></a><span id="l62.31" class="difflineminus">-                                          nsILocalFile **aFile,</span>
<a href="#l62.32"></a><span id="l62.32" class="difflineplus">+                                          nsIFile **aFile,</span>
<a href="#l62.33"></a><span id="l62.33">                                           nsIPrefBranch *prefBranch)</span>
<a href="#l62.34"></a><span id="l62.34"> {</span>
<a href="#l62.35"></a><span id="l62.35">     NS_ENSURE_ARG_POINTER(aFile);</span>
<a href="#l62.36"></a><span id="l62.36">     *aFile = nsnull;</span>
<a href="#l62.37"></a><span id="l62.37">     NS_ENSURE_ARG(relPrefName);</span>
<a href="#l62.38"></a><span id="l62.38">     NS_ENSURE_ARG(absPrefName);</span>
<a href="#l62.39"></a><span id="l62.39">     gotRelPref = false;</span>
<a href="#l62.40"></a><span id="l62.40"> </span>
<a href="#l62.41"></a><span id="l62.41" class="difflineat">@@ -1165,56 +1165,56 @@ NS_MSG_BASE nsresult NS_GetPersistentFil</span>
<a href="#l62.42"></a><span id="l62.42">     if (!prefBranch) {</span>
<a href="#l62.43"></a><span id="l62.43">         nsCOMPtr&lt;nsIPrefService&gt; prefService(do_GetService(NS_PREFSERVICE_CONTRACTID));</span>
<a href="#l62.44"></a><span id="l62.44">         if (!prefService) return NS_ERROR_FAILURE;</span>
<a href="#l62.45"></a><span id="l62.45">         prefService-&gt;GetBranch(nsnull, getter_AddRefs(mainBranch));</span>
<a href="#l62.46"></a><span id="l62.46">         if (!mainBranch) return NS_ERROR_FAILURE;</span>
<a href="#l62.47"></a><span id="l62.47">         prefBranch = mainBranch;</span>
<a href="#l62.48"></a><span id="l62.48">     }</span>
<a href="#l62.49"></a><span id="l62.49"> </span>
<a href="#l62.50"></a><span id="l62.50" class="difflineminus">-    nsCOMPtr&lt;nsILocalFile&gt; localFile;</span>
<a href="#l62.51"></a><span id="l62.51" class="difflineplus">+    nsCOMPtr&lt;nsIFile&gt; localFile;</span>
<a href="#l62.52"></a><span id="l62.52"> </span>
<a href="#l62.53"></a><span id="l62.53">     // Get the relative first</span>
<a href="#l62.54"></a><span id="l62.54">     nsCOMPtr&lt;nsIRelativeFilePref&gt; relFilePref;</span>
<a href="#l62.55"></a><span id="l62.55">     prefBranch-&gt;GetComplexValue(relPrefName,</span>
<a href="#l62.56"></a><span id="l62.56">                                 NS_GET_IID(nsIRelativeFilePref), getter_AddRefs(relFilePref));</span>
<a href="#l62.57"></a><span id="l62.57">     if (relFilePref) {</span>
<a href="#l62.58"></a><span id="l62.58">         relFilePref-&gt;GetFile(getter_AddRefs(localFile));</span>
<a href="#l62.59"></a><span id="l62.59">         NS_ASSERTION(localFile, &quot;An nsIRelativeFilePref has no file.&quot;);</span>
<a href="#l62.60"></a><span id="l62.60">         if (localFile)</span>
<a href="#l62.61"></a><span id="l62.61">           gotRelPref = true;</span>
<a href="#l62.62"></a><span id="l62.62">     }</span>
<a href="#l62.63"></a><span id="l62.63"> </span>
<a href="#l62.64"></a><span id="l62.64">     // If not, get the old absolute</span>
<a href="#l62.65"></a><span id="l62.65">     if (!localFile) {</span>
<a href="#l62.66"></a><span id="l62.66">         prefBranch-&gt;GetComplexValue(absPrefName,</span>
<a href="#l62.67"></a><span id="l62.67" class="difflineminus">-                                    NS_GET_IID(nsILocalFile), getter_AddRefs(localFile));</span>
<a href="#l62.68"></a><span id="l62.68" class="difflineplus">+                                    NS_GET_IID(nsIFile), getter_AddRefs(localFile));</span>
<a href="#l62.69"></a><span id="l62.69"> </span>
<a href="#l62.70"></a><span id="l62.70">         // If not, and given a dirServiceProp, use directory service.</span>
<a href="#l62.71"></a><span id="l62.71">         if (!localFile &amp;&amp; dirServiceProp) {</span>
<a href="#l62.72"></a><span id="l62.72">             nsCOMPtr&lt;nsIProperties&gt; dirService(do_GetService(&quot;@mozilla.org/file/directory_service;1&quot;));</span>
<a href="#l62.73"></a><span id="l62.73">             if (!dirService) return NS_ERROR_FAILURE;</span>
<a href="#l62.74"></a><span id="l62.74" class="difflineminus">-            dirService-&gt;Get(dirServiceProp, NS_GET_IID(nsILocalFile), getter_AddRefs(localFile));</span>
<a href="#l62.75"></a><span id="l62.75" class="difflineplus">+            dirService-&gt;Get(dirServiceProp, NS_GET_IID(nsIFile), getter_AddRefs(localFile));</span>
<a href="#l62.76"></a><span id="l62.76">             if (!localFile) return NS_ERROR_FAILURE;</span>
<a href="#l62.77"></a><span id="l62.77">         }</span>
<a href="#l62.78"></a><span id="l62.78">     }</span>
<a href="#l62.79"></a><span id="l62.79"> </span>
<a href="#l62.80"></a><span id="l62.80">     if (localFile) {</span>
<a href="#l62.81"></a><span id="l62.81">         localFile-&gt;Normalize();</span>
<a href="#l62.82"></a><span id="l62.82">         *aFile = localFile;</span>
<a href="#l62.83"></a><span id="l62.83">         NS_ADDREF(*aFile);</span>
<a href="#l62.84"></a><span id="l62.84">         return NS_OK;</span>
<a href="#l62.85"></a><span id="l62.85">     }</span>
<a href="#l62.86"></a><span id="l62.86"> </span>
<a href="#l62.87"></a><span id="l62.87">     return NS_ERROR_FAILURE;</span>
<a href="#l62.88"></a><span id="l62.88"> }</span>
<a href="#l62.89"></a><span id="l62.89"> </span>
<a href="#l62.90"></a><span id="l62.90"> NS_MSG_BASE nsresult NS_SetPersistentFile(const char *relPrefName,</span>
<a href="#l62.91"></a><span id="l62.91">                                           const char *absPrefName,</span>
<a href="#l62.92"></a><span id="l62.92" class="difflineminus">-                                          nsILocalFile *aFile,</span>
<a href="#l62.93"></a><span id="l62.93" class="difflineplus">+                                          nsIFile *aFile,</span>
<a href="#l62.94"></a><span id="l62.94">                                           nsIPrefBranch *prefBranch)</span>
<a href="#l62.95"></a><span id="l62.95"> {</span>
<a href="#l62.96"></a><span id="l62.96">     NS_ENSURE_ARG(relPrefName);</span>
<a href="#l62.97"></a><span id="l62.97">     NS_ENSURE_ARG(absPrefName);</span>
<a href="#l62.98"></a><span id="l62.98">     NS_ENSURE_ARG(aFile);</span>
<a href="#l62.99"></a><span id="l62.99"> </span>
<a href="#l62.100"></a><span id="l62.100">     nsCOMPtr&lt;nsIPrefBranch&gt; mainBranch;</span>
<a href="#l62.101"></a><span id="l62.101">     if (!prefBranch) {</span>
<a href="#l62.102"></a><span id="l62.102" class="difflineat">@@ -1222,17 +1222,17 @@ NS_MSG_BASE nsresult NS_SetPersistentFil</span>
<a href="#l62.103"></a><span id="l62.103">         if (!prefService) return NS_ERROR_FAILURE;</span>
<a href="#l62.104"></a><span id="l62.104">         prefService-&gt;GetBranch(nsnull, getter_AddRefs(mainBranch));</span>
<a href="#l62.105"></a><span id="l62.105">         if (!mainBranch) return NS_ERROR_FAILURE;</span>
<a href="#l62.106"></a><span id="l62.106">         prefBranch = mainBranch;</span>
<a href="#l62.107"></a><span id="l62.107">     }</span>
<a href="#l62.108"></a><span id="l62.108"> </span>
<a href="#l62.109"></a><span id="l62.109">     // Write the absolute for backwards compatibilty's sake.</span>
<a href="#l62.110"></a><span id="l62.110">     // Or, if aPath is on a different drive than the profile dir.</span>
<a href="#l62.111"></a><span id="l62.111" class="difflineminus">-    nsresult rv = prefBranch-&gt;SetComplexValue(absPrefName, NS_GET_IID(nsILocalFile), aFile);</span>
<a href="#l62.112"></a><span id="l62.112" class="difflineplus">+    nsresult rv = prefBranch-&gt;SetComplexValue(absPrefName, NS_GET_IID(nsIFile), aFile);</span>
<a href="#l62.113"></a><span id="l62.113"> </span>
<a href="#l62.114"></a><span id="l62.114">     // Write the relative path.</span>
<a href="#l62.115"></a><span id="l62.115">     nsCOMPtr&lt;nsIRelativeFilePref&gt; relFilePref;</span>
<a href="#l62.116"></a><span id="l62.116">     NS_NewRelativeFilePref(aFile, nsDependentCString(NS_APP_USER_PROFILE_50_DIR), getter_AddRefs(relFilePref));</span>
<a href="#l62.117"></a><span id="l62.117">     if (relFilePref) {</span>
<a href="#l62.118"></a><span id="l62.118">         nsresult rv2 = prefBranch-&gt;SetComplexValue(relPrefName, NS_GET_IID(nsIRelativeFilePref), relFilePref);</span>
<a href="#l62.119"></a><span id="l62.119">         if (NS_FAILED(rv2) &amp;&amp; NS_SUCCEEDED(rv))</span>
<a href="#l62.120"></a><span id="l62.120">             prefBranch-&gt;ClearUserPref(relPrefName);</span>
<a href="#l62.121"></a><span id="l62.121" class="difflineat">@@ -1311,20 +1311,20 @@ void Seconds2PRTime(PRUint32 seconds, PR</span>
<a href="#l62.122"></a><span id="l62.122"> {</span>
<a href="#l62.123"></a><span id="l62.123">   PRInt64 microSecondsPerSecond, intermediateResult;</span>
<a href="#l62.124"></a><span id="l62.124"> </span>
<a href="#l62.125"></a><span id="l62.125">   LL_I2L(microSecondsPerSecond, PR_USEC_PER_SEC);</span>
<a href="#l62.126"></a><span id="l62.126">   LL_UI2L(intermediateResult, seconds);</span>
<a href="#l62.127"></a><span id="l62.127">   LL_MUL((*prTime), intermediateResult, microSecondsPerSecond);</span>
<a href="#l62.128"></a><span id="l62.128"> }</span>
<a href="#l62.129"></a><span id="l62.129"> </span>
<a href="#l62.130"></a><span id="l62.130" class="difflineminus">-nsresult GetSummaryFileLocation(nsILocalFile* fileLocation, nsILocalFile** summaryLocation)</span>
<a href="#l62.131"></a><span id="l62.131" class="difflineplus">+nsresult GetSummaryFileLocation(nsIFile* fileLocation, nsIFile** summaryLocation)</span>
<a href="#l62.132"></a><span id="l62.132"> {</span>
<a href="#l62.133"></a><span id="l62.133">   nsresult rv;</span>
<a href="#l62.134"></a><span id="l62.134" class="difflineminus">-  nsCOMPtr &lt;nsILocalFile&gt; newSummaryLocation = do_CreateInstance(NS_LOCAL_FILE_CONTRACTID, &amp;rv);</span>
<a href="#l62.135"></a><span id="l62.135" class="difflineplus">+  nsCOMPtr &lt;nsIFile&gt; newSummaryLocation = do_CreateInstance(NS_LOCAL_FILE_CONTRACTID, &amp;rv);</span>
<a href="#l62.136"></a><span id="l62.136">   NS_ENSURE_SUCCESS(rv, rv);</span>
<a href="#l62.137"></a><span id="l62.137"> </span>
<a href="#l62.138"></a><span id="l62.138">   newSummaryLocation-&gt;InitWithFile(fileLocation);</span>
<a href="#l62.139"></a><span id="l62.139">   nsString fileName;</span>
<a href="#l62.140"></a><span id="l62.140"> </span>
<a href="#l62.141"></a><span id="l62.141">   rv = newSummaryLocation-&gt;GetLeafName(fileName);</span>
<a href="#l62.142"></a><span id="l62.142">   if (NS_FAILED(rv))</span>
<a href="#l62.143"></a><span id="l62.143">     return rv;</span>
<a href="#l62.144"></a><span id="l62.144" class="difflineat">@@ -1355,27 +1355,27 @@ nsresult GetSpecialDirectoryWithFileName</span>
<a href="#l62.145"></a><span id="l62.145"> {</span>
<a href="#l62.146"></a><span id="l62.146">   nsresult rv = NS_GetSpecialDirectory(specialDirName, result);</span>
<a href="#l62.147"></a><span id="l62.147">   NS_ENSURE_SUCCESS(rv, rv);</span>
<a href="#l62.148"></a><span id="l62.148"> </span>
<a href="#l62.149"></a><span id="l62.149">   return (*result)-&gt;AppendNative(nsDependentCString(fileName));</span>
<a href="#l62.150"></a><span id="l62.150"> }</span>
<a href="#l62.151"></a><span id="l62.151"> </span>
<a href="#l62.152"></a><span id="l62.152"> </span>
<a href="#l62.153"></a><span id="l62.153" class="difflineminus">-nsresult MsgGetFileStream(nsILocalFile *file, nsIOutputStream **fileStream)</span>
<a href="#l62.154"></a><span id="l62.154" class="difflineplus">+nsresult MsgGetFileStream(nsIFile *file, nsIOutputStream **fileStream)</span>
<a href="#l62.155"></a><span id="l62.155"> {</span>
<a href="#l62.156"></a><span id="l62.156">   nsMsgFileStream *newFileStream = new nsMsgFileStream;</span>
<a href="#l62.157"></a><span id="l62.157">   NS_ENSURE_TRUE(newFileStream, NS_ERROR_OUT_OF_MEMORY);</span>
<a href="#l62.158"></a><span id="l62.158">   nsresult rv = newFileStream-&gt;InitWithFile(file);</span>
<a href="#l62.159"></a><span id="l62.159">   if (NS_SUCCEEDED(rv))</span>
<a href="#l62.160"></a><span id="l62.160">     rv = newFileStream-&gt;QueryInterface(NS_GET_IID(nsIOutputStream), (void **) fileStream);</span>
<a href="#l62.161"></a><span id="l62.161">   return rv;</span>
<a href="#l62.162"></a><span id="l62.162"> }</span>
<a href="#l62.163"></a><span id="l62.163"> </span>
<a href="#l62.164"></a><span id="l62.164" class="difflineminus">-nsresult MsgReopenFileStream(nsILocalFile *file, nsIInputStream *fileStream)</span>
<a href="#l62.165"></a><span id="l62.165" class="difflineplus">+nsresult MsgReopenFileStream(nsIFile *file, nsIInputStream *fileStream)</span>
<a href="#l62.166"></a><span id="l62.166"> {</span>
<a href="#l62.167"></a><span id="l62.167">   nsMsgFileStream *msgFileStream = static_cast&lt;nsMsgFileStream *&gt;(fileStream);</span>
<a href="#l62.168"></a><span id="l62.168">   if (msgFileStream)</span>
<a href="#l62.169"></a><span id="l62.169">     return msgFileStream-&gt;InitWithFile(file);</span>
<a href="#l62.170"></a><span id="l62.170">   else</span>
<a href="#l62.171"></a><span id="l62.171">     return NS_ERROR_FAILURE;</span>
<a href="#l62.172"></a><span id="l62.172"> }</span>
<a href="#l62.173"></a><span id="l62.173"> </span>
<a href="#l62.174"></a><span id="l62.174" class="difflineat">@@ -1470,17 +1470,17 @@ bool MsgHostDomainIsTrusted(nsCString &amp;h</span>
<a href="#l62.175"></a><span id="l62.175">       }</span>
<a href="#l62.176"></a><span id="l62.176">     }</span>
<a href="#l62.177"></a><span id="l62.177"> </span>
<a href="#l62.178"></a><span id="l62.178">     domain = end + 1;</span>
<a href="#l62.179"></a><span id="l62.179">   } while (*end);</span>
<a href="#l62.180"></a><span id="l62.180">   return domainIsTrusted;</span>
<a href="#l62.181"></a><span id="l62.181"> }</span>
<a href="#l62.182"></a><span id="l62.182"> </span>
<a href="#l62.183"></a><span id="l62.183" class="difflineminus">-nsresult MsgGetLocalFileFromURI(const nsACString &amp;aUTF8Path, nsILocalFile **aFile)</span>
<a href="#l62.184"></a><span id="l62.184" class="difflineplus">+nsresult MsgGetLocalFileFromURI(const nsACString &amp;aUTF8Path, nsIFile **aFile)</span>
<a href="#l62.185"></a><span id="l62.185"> {</span>
<a href="#l62.186"></a><span id="l62.186">   nsresult rv;</span>
<a href="#l62.187"></a><span id="l62.187">   nsCOMPtr&lt;nsIURI&gt; argURI;</span>
<a href="#l62.188"></a><span id="l62.188">   rv = NS_NewURI(getter_AddRefs(argURI), aUTF8Path);</span>
<a href="#l62.189"></a><span id="l62.189">   NS_ENSURE_SUCCESS(rv, rv);</span>
<a href="#l62.190"></a><span id="l62.190">   nsCOMPtr&lt;nsIFileURL&gt; argFileURL(do_QueryInterface(argURI, &amp;rv));</span>
<a href="#l62.191"></a><span id="l62.191">   NS_ENSURE_SUCCESS(rv, rv);</span>
<a href="#l62.192"></a><span id="l62.192"> </span>
<a href="#l62.193"></a><span id="l62.193" class="difflineat">@@ -2215,17 +2215,17 @@ public:</span>
<a href="#l62.194"></a><span id="l62.194"> </span>
<a href="#l62.195"></a><span id="l62.195"> private:</span>
<a href="#l62.196"></a><span id="l62.196">   nsCString mCharset;</span>
<a href="#l62.197"></a><span id="l62.197"> };</span>
<a href="#l62.198"></a><span id="l62.198"> </span>
<a href="#l62.199"></a><span id="l62.199"> NS_IMPL_ISUPPORTS1(CharsetDetectionObserver, nsICharsetDetectionObserver)</span>
<a href="#l62.200"></a><span id="l62.200"> </span>
<a href="#l62.201"></a><span id="l62.201"> NS_MSG_BASE nsresult</span>
<a href="#l62.202"></a><span id="l62.202" class="difflineminus">-MsgDetectCharsetFromFile(nsILocalFile *aFile, nsACString &amp;aCharset)</span>
<a href="#l62.203"></a><span id="l62.203" class="difflineplus">+MsgDetectCharsetFromFile(nsIFile *aFile, nsACString &amp;aCharset)</span>
<a href="#l62.204"></a><span id="l62.204"> {</span>
<a href="#l62.205"></a><span id="l62.205">   // First try the universal charset detector</span>
<a href="#l62.206"></a><span id="l62.206">   nsCOMPtr&lt;nsICharsetDetector&gt; detector</span>
<a href="#l62.207"></a><span id="l62.207">     = do_CreateInstance(NS_CHARSET_DETECTOR_CONTRACTID_BASE</span>
<a href="#l62.208"></a><span id="l62.208">                         &quot;universal_charset_detector&quot;);</span>
<a href="#l62.209"></a><span id="l62.209">   if (!detector) {</span>
<a href="#l62.210"></a><span id="l62.210">     // No universal charset detector, try the default charset detector</span>
<a href="#l62.211"></a><span id="l62.211">     nsString detectorName;</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l63.1"></a><span id="l63.1" class="difflineminus">--- a/mailnews/base/util/nsMsgUtils.h</span>
<a href="#l63.2"></a><span id="l63.2" class="difflineplus">+++ b/mailnews/base/util/nsMsgUtils.h</span>
<a href="#l63.3"></a><span id="l63.3" class="difflineat">@@ -15,19 +15,19 @@</span>
<a href="#l63.4"></a><span id="l63.4"> #include &quot;nsTArray.h&quot;</span>
<a href="#l63.5"></a><span id="l63.5"> #include &quot;nsIInterfaceRequestor.h&quot;</span>
<a href="#l63.6"></a><span id="l63.6"> #include &quot;nsILoadGroup.h&quot;</span>
<a href="#l63.7"></a><span id="l63.7"> #include &quot;nsISupportsArray.h&quot;</span>
<a href="#l63.8"></a><span id="l63.8"> #include &quot;nsIAtom.h&quot;</span>
<a href="#l63.9"></a><span id="l63.9"> #include &quot;nsINetUtil.h&quot;</span>
<a href="#l63.10"></a><span id="l63.10"> #include &quot;nsServiceManagerUtils.h&quot;</span>
<a href="#l63.11"></a><span id="l63.11"> #include &quot;nsUnicharUtils.h&quot;</span>
<a href="#l63.12"></a><span id="l63.12" class="difflineminus">-#include &quot;nsILocalFile.h&quot;</span>
<a href="#l63.13"></a><span id="l63.13" class="difflineplus">+#include &quot;nsIFile.h&quot;</span>
<a href="#l63.14"></a><span id="l63.14"> </span>
<a href="#l63.15"></a><span id="l63.15" class="difflineminus">-class nsILocalFile;</span>
<a href="#l63.16"></a><span id="l63.16" class="difflineplus">+class nsIFile;</span>
<a href="#l63.17"></a><span id="l63.17"> class nsIPrefBranch;</span>
<a href="#l63.18"></a><span id="l63.18"> class nsIMsgFolder;</span>
<a href="#l63.19"></a><span id="l63.19"> class nsIMsgMessageService;</span>
<a href="#l63.20"></a><span id="l63.20"> class nsIUrlListener;</span>
<a href="#l63.21"></a><span id="l63.21"> class nsIOutputStream;</span>
<a href="#l63.22"></a><span id="l63.22"> class nsIInputStream;</span>
<a href="#l63.23"></a><span id="l63.23"> class nsIMsgDatabase;</span>
<a href="#l63.24"></a><span id="l63.24"> class nsIMutableArray;</span>
<a href="#l63.25"></a><span id="l63.25" class="difflineat">@@ -114,22 +114,22 @@ NS_MSG_BASE nsresult GetExistingFolder(c</span>
<a href="#l63.26"></a><span id="l63.26"> // Escape lines starting with &quot;From &quot;, &quot;&gt;From &quot;, etc. in a buffer.</span>
<a href="#l63.27"></a><span id="l63.27"> NS_MSG_BASE nsresult EscapeFromSpaceLine(nsIOutputStream *ouputStream, char *start, const char *end);</span>
<a href="#l63.28"></a><span id="l63.28"> NS_MSG_BASE bool IsAFromSpaceLine(char *start, const char *end);</span>
<a href="#l63.29"></a><span id="l63.29"> </span>
<a href="#l63.30"></a><span id="l63.30"> NS_MSG_BASE nsresult NS_GetPersistentFile(const char *relPrefName,</span>
<a href="#l63.31"></a><span id="l63.31">                                           const char *absPrefName,</span>
<a href="#l63.32"></a><span id="l63.32">                                           const char *dirServiceProp, // Can be NULL</span>
<a href="#l63.33"></a><span id="l63.33">                                           bool&amp; gotRelPref,</span>
<a href="#l63.34"></a><span id="l63.34" class="difflineminus">-                                          nsILocalFile **aFile,</span>
<a href="#l63.35"></a><span id="l63.35" class="difflineplus">+                                          nsIFile **aFile,</span>
<a href="#l63.36"></a><span id="l63.36">                                           nsIPrefBranch *prefBranch = nsnull);</span>
<a href="#l63.37"></a><span id="l63.37"> </span>
<a href="#l63.38"></a><span id="l63.38"> NS_MSG_BASE nsresult NS_SetPersistentFile(const char *relPrefName,</span>
<a href="#l63.39"></a><span id="l63.39">                                           const char *absPrefName,</span>
<a href="#l63.40"></a><span id="l63.40" class="difflineminus">-                                          nsILocalFile *aFile,</span>
<a href="#l63.41"></a><span id="l63.41" class="difflineplus">+                                          nsIFile *aFile,</span>
<a href="#l63.42"></a><span id="l63.42">                                           nsIPrefBranch *prefBranch = nsnull);</span>
<a href="#l63.43"></a><span id="l63.43"> </span>
<a href="#l63.44"></a><span id="l63.44"> NS_MSG_BASE nsresult IsRFC822HeaderFieldName(const char *aHdr, bool *aResult);</span>
<a href="#l63.45"></a><span id="l63.45"> </span>
<a href="#l63.46"></a><span id="l63.46"> NS_MSG_BASE nsresult NS_GetUnicharPreferenceWithDefault(nsIPrefBranch *prefBranch,   //can be null, if so uses the root branch</span>
<a href="#l63.47"></a><span id="l63.47">                                                         const char *prefName,</span>
<a href="#l63.48"></a><span id="l63.48">                                                         const nsAString&amp; defValue,</span>
<a href="#l63.49"></a><span id="l63.49">                                                         nsAString&amp; prefValue);</span>
<a href="#l63.50"></a><span id="l63.50" class="difflineat">@@ -158,39 +158,39 @@ NS_MSG_BASE nsresult MSGApopMD5(const ch</span>
<a href="#l63.51"></a><span id="l63.51"> NS_MSG_BASE void PRTime2Seconds(PRTime prTime, PRUint32 *seconds);</span>
<a href="#l63.52"></a><span id="l63.52"> NS_MSG_BASE void PRTime2Seconds(PRTime prTime, PRInt32 *seconds);</span>
<a href="#l63.53"></a><span id="l63.53"> NS_MSG_BASE void Seconds2PRTime(PRUint32 seconds, PRTime *prTime);</span>
<a href="#l63.54"></a><span id="l63.54"> // helper function to generate current date+time as a string</span>
<a href="#l63.55"></a><span id="l63.55"> NS_MSG_BASE void MsgGenerateNowStr(nsACString &amp;nowStr);</span>
<a href="#l63.56"></a><span id="l63.56"> </span>
<a href="#l63.57"></a><span id="l63.57"> // Appends the correct summary file extension onto the supplied fileLocation</span>
<a href="#l63.58"></a><span id="l63.58"> // and returns it in summaryLocation.</span>
<a href="#l63.59"></a><span id="l63.59" class="difflineminus">-NS_MSG_BASE nsresult GetSummaryFileLocation(nsILocalFile* fileLocation,</span>
<a href="#l63.60"></a><span id="l63.60" class="difflineminus">-                                            nsILocalFile** summaryLocation);</span>
<a href="#l63.61"></a><span id="l63.61" class="difflineplus">+NS_MSG_BASE nsresult GetSummaryFileLocation(nsIFile* fileLocation,</span>
<a href="#l63.62"></a><span id="l63.62" class="difflineplus">+                                            nsIFile** summaryLocation);</span>
<a href="#l63.63"></a><span id="l63.63"> </span>
<a href="#l63.64"></a><span id="l63.64"> // Gets a special directory and appends the supplied file name onto it.</span>
<a href="#l63.65"></a><span id="l63.65"> NS_MSG_BASE nsresult GetSpecialDirectoryWithFileName(const char* specialDirName,</span>
<a href="#l63.66"></a><span id="l63.66">                                                      const char* fileName,</span>
<a href="#l63.67"></a><span id="l63.67">                                                      nsIFile** result);</span>
<a href="#l63.68"></a><span id="l63.68"> </span>
<a href="#l63.69"></a><span id="l63.69" class="difflineminus">-NS_MSG_BASE nsresult MsgGetFileStream(nsILocalFile *file, nsIOutputStream **fileStream);</span>
<a href="#l63.70"></a><span id="l63.70" class="difflineplus">+NS_MSG_BASE nsresult MsgGetFileStream(nsIFile *file, nsIOutputStream **fileStream);</span>
<a href="#l63.71"></a><span id="l63.71"> </span>
<a href="#l63.72"></a><span id="l63.72" class="difflineminus">-NS_MSG_BASE nsresult MsgReopenFileStream(nsILocalFile *file, nsIInputStream *fileStream);</span>
<a href="#l63.73"></a><span id="l63.73" class="difflineplus">+NS_MSG_BASE nsresult MsgReopenFileStream(nsIFile *file, nsIInputStream *fileStream);</span>
<a href="#l63.74"></a><span id="l63.74"> </span>
<a href="#l63.75"></a><span id="l63.75"> // Automatically creates an output stream with a 4K buffer</span>
<a href="#l63.76"></a><span id="l63.76"> NS_MSG_BASE nsresult MsgNewBufferedFileOutputStream(nsIOutputStream **aResult, nsIFile *aFile, PRInt32 aIOFlags = -1, PRInt32 aPerm = -1);</span>
<a href="#l63.77"></a><span id="l63.77"> </span>
<a href="#l63.78"></a><span id="l63.78"> // fills in the position of the passed in keyword in the passed in keyword list</span>
<a href="#l63.79"></a><span id="l63.79"> // and returns false if the keyword isn't present</span>
<a href="#l63.80"></a><span id="l63.80"> NS_MSG_BASE bool MsgFindKeyword(const nsCString &amp;keyword, nsCString &amp;keywords, PRInt32 *aStartOfKeyword, PRInt32 *aLength);</span>
<a href="#l63.81"></a><span id="l63.81"> </span>
<a href="#l63.82"></a><span id="l63.82"> NS_MSG_BASE bool MsgHostDomainIsTrusted(nsCString &amp;host, nsCString &amp;trustedMailDomains);</span>
<a href="#l63.83"></a><span id="l63.83"> </span>
<a href="#l63.84"></a><span id="l63.84" class="difflineminus">-// gets an nsILocalFile from a UTF-8 file:// path</span>
<a href="#l63.85"></a><span id="l63.85" class="difflineminus">-NS_MSG_BASE nsresult MsgGetLocalFileFromURI(const nsACString &amp;aUTF8Path, nsILocalFile **aFile);</span>
<a href="#l63.86"></a><span id="l63.86" class="difflineplus">+// gets an nsIFile from a UTF-8 file:// path</span>
<a href="#l63.87"></a><span id="l63.87" class="difflineplus">+NS_MSG_BASE nsresult MsgGetLocalFileFromURI(const nsACString &amp;aUTF8Path, nsIFile **aFile);</span>
<a href="#l63.88"></a><span id="l63.88"> </span>
<a href="#l63.89"></a><span id="l63.89"> NS_MSG_BASE void MsgStripQuotedPrintable (unsigned char *src);</span>
<a href="#l63.90"></a><span id="l63.90"> </span>
<a href="#l63.91"></a><span id="l63.91"> /*</span>
<a href="#l63.92"></a><span id="l63.92">  * Utility function copied from nsReadableUtils</span>
<a href="#l63.93"></a><span id="l63.93">  */</span>
<a href="#l63.94"></a><span id="l63.94"> NS_MSG_BASE bool MsgIsUTF8(const nsACString&amp; aString);</span>
<a href="#l63.95"></a><span id="l63.95"> </span>
<a href="#l63.96"></a><span id="l63.96" class="difflineat">@@ -267,20 +267,20 @@ MsgStreamMsgHeaders(nsIInputStream *aInp</span>
<a href="#l63.97"></a><span id="l63.97">  * @param str conveted string</span>
<a href="#l63.98"></a><span id="l63.98">  * @returns   PRUint64 vaule for success, 0 for parse failure</span>
<a href="#l63.99"></a><span id="l63.99">  */</span>
<a href="#l63.100"></a><span id="l63.100"> NS_MSG_BASE PRUint64 ParseUint64Str(const char *str);</span>
<a href="#l63.101"></a><span id="l63.101"> </span>
<a href="#l63.102"></a><span id="l63.102"> /**</span>
<a href="#l63.103"></a><span id="l63.103">  * Detect charset of file</span>
<a href="#l63.104"></a><span id="l63.104">  *</span>
<a href="#l63.105"></a><span id="l63.105" class="difflineminus">- * @param      aFile    The target of nsILocalFile</span>
<a href="#l63.106"></a><span id="l63.106" class="difflineplus">+ * @param      aFile    The target of nsIFile</span>
<a href="#l63.107"></a><span id="l63.107">  * @param[out] aCharset The charset string</span>
<a href="#l63.108"></a><span id="l63.108">  */</span>
<a href="#l63.109"></a><span id="l63.109" class="difflineminus">-NS_MSG_BASE nsresult MsgDetectCharsetFromFile(nsILocalFile *aFile, nsACString &amp;aCharset);</span>
<a href="#l63.110"></a><span id="l63.110" class="difflineplus">+NS_MSG_BASE nsresult MsgDetectCharsetFromFile(nsIFile *aFile, nsACString &amp;aCharset);</span>
<a href="#l63.111"></a><span id="l63.111"> </span>
<a href="#l63.112"></a><span id="l63.112"> /*</span>
<a href="#l63.113"></a><span id="l63.113">  * Converts a buffer to plain text. Some conversions may</span>
<a href="#l63.114"></a><span id="l63.114">  * or may not work with certain end charsets which is why we</span>
<a href="#l63.115"></a><span id="l63.115">  * need that as an argument to the function. If charset is</span>
<a href="#l63.116"></a><span id="l63.116">  * unknown or deemed of no importance NULL could be passed.</span>
<a href="#l63.117"></a><span id="l63.117">  * @param[in/out] aConBuf      Variable with the text to convert</span>
<a href="#l63.118"></a><span id="l63.118">  * @param         formatFlowed Use format flowed?</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l64.1"></a><span id="l64.1" class="difflineminus">--- a/mailnews/compose/public/nsIMsgSend.idl</span>
<a href="#l64.2"></a><span id="l64.2" class="difflineplus">+++ b/mailnews/compose/public/nsIMsgSend.idl</span>
<a href="#l64.3"></a><span id="l64.3" class="difflineat">@@ -29,17 +29,17 @@</span>
<a href="#l64.4"></a><span id="l64.4"> </span>
<a href="#l64.5"></a><span id="l64.5"> interface nsIMsgProgress;</span>
<a href="#l64.6"></a><span id="l64.6"> interface nsIURI;</span>
<a href="#l64.7"></a><span id="l64.7"> interface nsIRequest;</span>
<a href="#l64.8"></a><span id="l64.8"> interface nsIMsgDBHdr;</span>
<a href="#l64.9"></a><span id="l64.9"> interface nsIMsgHdr;</span>
<a href="#l64.10"></a><span id="l64.10"> interface nsIDocShell;</span>
<a href="#l64.11"></a><span id="l64.11"> interface nsIFile;</span>
<a href="#l64.12"></a><span id="l64.12" class="difflineminus">-interface nsILocalFile;</span>
<a href="#l64.13"></a><span id="l64.13" class="difflineplus">+interface nsIFile;</span>
<a href="#l64.14"></a><span id="l64.14"> interface nsIOutputStream;</span>
<a href="#l64.15"></a><span id="l64.15"> interface nsIMsgComposeSecure;</span>
<a href="#l64.16"></a><span id="l64.16"> interface nsIMsgStatusFeedback;</span>
<a href="#l64.17"></a><span id="l64.17"> interface nsIEditor;</span>
<a href="#l64.18"></a><span id="l64.18"> interface nsIArray;</span>
<a href="#l64.19"></a><span id="l64.19"> interface nsISupportsArray;</span>
<a href="#l64.20"></a><span id="l64.20"> </span>
<a href="#l64.21"></a><span id="l64.21"> typedef long nsMsgDeliverMode;</span>
<a href="#l64.22"></a><span id="l64.22" class="difflineat">@@ -95,17 +95,17 @@ interface nsIMsgAttachmentData : nsISupp</span>
<a href="#l64.23"></a><span id="l64.23">  */</span>
<a href="#l64.24"></a><span id="l64.24"> [scriptable, uuid(c552345d-c74b-40b0-a673-79bb461e920b)]</span>
<a href="#l64.25"></a><span id="l64.25"> interface nsIMsgAttachedFile : nsISupports</span>
<a href="#l64.26"></a><span id="l64.26"> {</span>
<a href="#l64.27"></a><span id="l64.27">   /// Where it came from on the network (or even elsewhere on the local disk.)</span>
<a href="#l64.28"></a><span id="l64.28">   attribute nsIURI origUrl;</span>
<a href="#l64.29"></a><span id="l64.29"> </span>
<a href="#l64.30"></a><span id="l64.30">   /// The tmp file in which the (possibly converted) data now resides.</span>
<a href="#l64.31"></a><span id="l64.31" class="difflineminus">-  attribute nsILocalFile tmpFile;</span>
<a href="#l64.32"></a><span id="l64.32" class="difflineplus">+  attribute nsIFile tmpFile;</span>
<a href="#l64.33"></a><span id="l64.33"> </span>
<a href="#l64.34"></a><span id="l64.34">   /// The type of the data in file_name (not necessarily the same as the type of orig_url.)</span>
<a href="#l64.35"></a><span id="l64.35">   attribute ACString type;</span>
<a href="#l64.36"></a><span id="l64.36"> </span>
<a href="#l64.37"></a><span id="l64.37">   /**</span>
<a href="#l64.38"></a><span id="l64.38">    * The encoding of the tmp file. This will be set only if the original</span>
<a href="#l64.39"></a><span id="l64.39">    * document had an encoding already; we don't do base64 encoding and so forth</span>
<a href="#l64.40"></a><span id="l64.40">    * until it's time to assemble a full MIME message of all parts.</span>
<a href="#l64.41"></a><span id="l64.41" class="difflineat">@@ -193,17 +193,17 @@ public:</span>
<a href="#l64.42"></a><span id="l64.42">   NS_DECL_NSIMSGATTACHEDFILE</span>
<a href="#l64.43"></a><span id="l64.43">   NS_DECL_ISUPPORTS</span>
<a href="#l64.44"></a><span id="l64.44"> </span>
<a href="#l64.45"></a><span id="l64.45">   nsMsgAttachedFile();</span>
<a href="#l64.46"></a><span id="l64.46">   ~nsMsgAttachedFile();</span>
<a href="#l64.47"></a><span id="l64.47"> </span>
<a href="#l64.48"></a><span id="l64.48">   nsCOMPtr&lt;nsIURI&gt; m_origUrl; // Where it came from on the network (or even elsewhere on the local disk.)</span>
<a href="#l64.49"></a><span id="l64.49"> </span>
<a href="#l64.50"></a><span id="l64.50" class="difflineminus">-  nsCOMPtr&lt;nsILocalFile&gt;  m_tmpFile;    // The tmp file in which the (possibly converted) data now resides.</span>
<a href="#l64.51"></a><span id="l64.51" class="difflineplus">+  nsCOMPtr&lt;nsIFile&gt;  m_tmpFile;    // The tmp file in which the (possibly converted) data now resides.</span>
<a href="#l64.52"></a><span id="l64.52"> </span>
<a href="#l64.53"></a><span id="l64.53">   nsCString m_type;        // The type of the data in file_name (not necessarily the same as the type of orig_url.)</span>
<a href="#l64.54"></a><span id="l64.54"> </span>
<a href="#l64.55"></a><span id="l64.55">   nsCString m_encoding;    // Likewise, the encoding of the tmp file. This will be set only if the original </span>
<a href="#l64.56"></a><span id="l64.56">                             // document had an encoding already; we don't do base64 encoding and so forth until </span>
<a href="#l64.57"></a><span id="l64.57">                             // it's time to assemble a full MIME message of all parts.</span>
<a href="#l64.58"></a><span id="l64.58"> </span>
<a href="#l64.59"></a><span id="l64.59"> </span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l65.1"></a><span id="l65.1" class="difflineminus">--- a/mailnews/compose/public/nsIURLFetcher.idl</span>
<a href="#l65.2"></a><span id="l65.2" class="difflineplus">+++ b/mailnews/compose/public/nsIURLFetcher.idl</span>
<a href="#l65.3"></a><span id="l65.3" class="difflineat">@@ -1,17 +1,17 @@</span>
<a href="#l65.4"></a><span id="l65.4"> /* -*- Mode: C++; tab-width: 4; indent-tabs-mode: nil; c-basic-offset: 4 -*- */</span>
<a href="#l65.5"></a><span id="l65.5"> /* This Source Code Form is subject to the terms of the Mozilla Public</span>
<a href="#l65.6"></a><span id="l65.6">  * License, v. 2.0. If a copy of the MPL was not distributed with this</span>
<a href="#l65.7"></a><span id="l65.7">  * file, You can obtain one at http://mozilla.org/MPL/2.0/. */</span>
<a href="#l65.8"></a><span id="l65.8"> </span>
<a href="#l65.9"></a><span id="l65.9"> #include &quot;nsISupports.idl&quot;</span>
<a href="#l65.10"></a><span id="l65.10"> #include &quot;nsIURI.idl&quot;</span>
<a href="#l65.11"></a><span id="l65.11"> #include &quot;nsIFileStreams.idl&quot;</span>
<a href="#l65.12"></a><span id="l65.12" class="difflineminus">-#include &quot;nsILocalFile.idl&quot;</span>
<a href="#l65.13"></a><span id="l65.13" class="difflineplus">+#include &quot;nsIFile.idl&quot;</span>
<a href="#l65.14"></a><span id="l65.14"> </span>
<a href="#l65.15"></a><span id="l65.15"> %{ C++</span>
<a href="#l65.16"></a><span id="l65.16"> </span>
<a href="#l65.17"></a><span id="l65.17"> //</span>
<a href="#l65.18"></a><span id="l65.18"> // Callback declarations for URL completion</span>
<a href="#l65.19"></a><span id="l65.19"> //</span>
<a href="#l65.20"></a><span id="l65.20"> // For completion of send/message creation operations...</span>
<a href="#l65.21"></a><span id="l65.21"> typedef nsresult (*nsAttachSaveCompletionCallback) (nsresult aStatus,</span>
<a href="#l65.22"></a><span id="l65.22" class="difflineat">@@ -25,12 +25,12 @@ typedef nsresult (*nsAttachSaveCompletio</span>
<a href="#l65.23"></a><span id="l65.23"> native nsAttachSaveCompletionCallback(nsAttachSaveCompletionCallback);</span>
<a href="#l65.24"></a><span id="l65.24"> </span>
<a href="#l65.25"></a><span id="l65.25"> </span>
<a href="#l65.26"></a><span id="l65.26"> [noscript, uuid(4f3ad52d-888d-487d-961c-9c727c35434c)]</span>
<a href="#l65.27"></a><span id="l65.27"> interface nsIURLFetcher : nsISupports</span>
<a href="#l65.28"></a><span id="l65.28"> {</span>
<a href="#l65.29"></a><span id="l65.29">   boolean stillRunning();</span>
<a href="#l65.30"></a><span id="l65.30"> </span>
<a href="#l65.31"></a><span id="l65.31" class="difflineminus">-  void fireURLRequest(in nsIURI aURL, in nsILocalFile localFile, in nsIOutputStream fileStream, in nsAttachSaveCompletionCallback cb, in voidPtr tagData);</span>
<a href="#l65.32"></a><span id="l65.32" class="difflineplus">+  void fireURLRequest(in nsIURI aURL, in nsIFile localFile, in nsIOutputStream fileStream, in nsAttachSaveCompletionCallback cb, in voidPtr tagData);</span>
<a href="#l65.33"></a><span id="l65.33"> </span>
<a href="#l65.34"></a><span id="l65.34" class="difflineminus">-  void initialize(in nsILocalFile localFile, in nsIOutputStream fileStream, in nsAttachSaveCompletionCallback cb, in voidPtr tagData);</span>
<a href="#l65.35"></a><span id="l65.35" class="difflineplus">+  void initialize(in nsIFile localFile, in nsIOutputStream fileStream, in nsAttachSaveCompletionCallback cb, in voidPtr tagData);</span>
<a href="#l65.36"></a><span id="l65.36"> };</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l66.1"></a><span id="l66.1" class="difflineminus">--- a/mailnews/compose/src/nsMsgAppleDouble.h</span>
<a href="#l66.2"></a><span id="l66.2" class="difflineplus">+++ b/mailnews/compose/src/nsMsgAppleDouble.h</span>
<a href="#l66.3"></a><span id="l66.3" class="difflineat">@@ -159,17 +159,17 @@ typedef struct _appledouble_decode_objec</span>
<a href="#l66.4"></a><span id="l66.4"> 	int		uu_bytes_written;	/* bytes written from the current tuple (uuencode) */</span>
<a href="#l66.5"></a><span id="l66.5"> 	int		uu_line_bytes;		/* encoded bytes remaining in the current line (uuencode) */</span>
<a href="#l66.6"></a><span id="l66.6"> </span>
<a href="#l66.7"></a><span id="l66.7"> 	char 	*inbuff;			/* the outbuff by the caller.           		*/</span>
<a href="#l66.8"></a><span id="l66.8"> 	int		s_inbuff;			/* the size of the buffer.						*/</span>
<a href="#l66.9"></a><span id="l66.9"> 	int		pos_inbuff;			/* the offset in the current buffer.			*/ </span>
<a href="#l66.10"></a><span id="l66.10"> </span>
<a href="#l66.11"></a><span id="l66.11"> </span>
<a href="#l66.12"></a><span id="l66.12" class="difflineminus">-	nsCOMPtr &lt;nsILocalFile&gt; tmpFile;		/* the temp file to hold the decode data fork 	*/</span>
<a href="#l66.13"></a><span id="l66.13" class="difflineplus">+	nsCOMPtr &lt;nsIFile&gt; tmpFile;		/* the temp file to hold the decode data fork 	*/</span>
<a href="#l66.14"></a><span id="l66.14"> 								                      /* when doing the binhex exporting.				*/</span>
<a href="#l66.15"></a><span id="l66.15">   nsCOMPtr &lt;nsIOutputStream&gt; tmpFileStream; /* The output File Stream */</span>
<a href="#l66.16"></a><span id="l66.16"> 	PRInt32	            data_size;			/* the size of the data in the tmp file.		*/</span>
<a href="#l66.17"></a><span id="l66.17"> </span>
<a href="#l66.18"></a><span id="l66.18"> } appledouble_decode_object;</span>
<a href="#l66.19"></a><span id="l66.19"> </span>
<a href="#l66.20"></a><span id="l66.20"> </span>
<a href="#l66.21"></a><span id="l66.21"> /*</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l67.1"></a><span id="l67.1" class="difflineminus">--- a/mailnews/compose/src/nsMsgAppleDoubleEncode.cpp</span>
<a href="#l67.2"></a><span id="l67.2" class="difflineplus">+++ b/mailnews/compose/src/nsMsgAppleDoubleEncode.cpp</span>
<a href="#l67.3"></a><span id="l67.3" class="difflineat">@@ -23,17 +23,17 @@</span>
<a href="#l67.4"></a><span id="l67.4"> #include &quot;nsCExternalHandlerService.h&quot;</span>
<a href="#l67.5"></a><span id="l67.5"> #include &quot;nsIMIMEService.h&quot;</span>
<a href="#l67.6"></a><span id="l67.6"> #include &quot;nsMimeTypes.h&quot;</span>
<a href="#l67.7"></a><span id="l67.7"> #include &quot;prmem.h&quot;</span>
<a href="#l67.8"></a><span id="l67.8"> #include &quot;nsNetUtil.h&quot;</span>
<a href="#l67.9"></a><span id="l67.9"> </span>
<a href="#l67.10"></a><span id="l67.10"> </span>
<a href="#l67.11"></a><span id="l67.11"> void	</span>
<a href="#l67.12"></a><span id="l67.12" class="difflineminus">-MacGetFileType(nsILocalFile   *fs, </span>
<a href="#l67.13"></a><span id="l67.13" class="difflineplus">+MacGetFileType(nsIFile   *fs, </span>
<a href="#l67.14"></a><span id="l67.14">                bool         *useDefault, </span>
<a href="#l67.15"></a><span id="l67.15">                char         **fileType, </span>
<a href="#l67.16"></a><span id="l67.16">                char         **encoding)</span>
<a href="#l67.17"></a><span id="l67.17"> {</span>
<a href="#l67.18"></a><span id="l67.18"> 	if ((fs == NULL) || (fileType == NULL) || (encoding == NULL))</span>
<a href="#l67.19"></a><span id="l67.19"> 		return;</span>
<a href="#l67.20"></a><span id="l67.20"> </span>
<a href="#l67.21"></a><span id="l67.21">   bool exists = false;</span>
<a href="#l67.22"></a><span id="l67.22" class="difflineat">@@ -88,17 +88,17 @@ MacGetFileType(nsILocalFile   *fs,</span>
<a href="#l67.23"></a><span id="l67.23"> *	</span>
<a href="#l67.24"></a><span id="l67.24"> *	Setup the encode envirment</span>
<a href="#l67.25"></a><span id="l67.25"> */</span>
<a href="#l67.26"></a><span id="l67.26"> </span>
<a href="#l67.27"></a><span id="l67.27"> int ap_encode_init( appledouble_encode_object *p_ap_encode_obj,</span>
<a href="#l67.28"></a><span id="l67.28">                     const char                *fname,</span>
<a href="#l67.29"></a><span id="l67.29">                     char                      *separator)</span>
<a href="#l67.30"></a><span id="l67.30"> {</span>
<a href="#l67.31"></a><span id="l67.31" class="difflineminus">-  nsCOMPtr &lt;nsILocalFile&gt; myFile;</span>
<a href="#l67.32"></a><span id="l67.32" class="difflineplus">+  nsCOMPtr &lt;nsIFile&gt; myFile;</span>
<a href="#l67.33"></a><span id="l67.33">   NS_NewNativeLocalFile(nsDependentCString(fname), true, getter_AddRefs(myFile));</span>
<a href="#l67.34"></a><span id="l67.34">   bool exists;</span>
<a href="#l67.35"></a><span id="l67.35">   if (myFile &amp;&amp; NS_SUCCEEDED(myFile-&gt;Exists(&amp;exists)) &amp;&amp; !exists)</span>
<a href="#l67.36"></a><span id="l67.36">     return -1;</span>
<a href="#l67.37"></a><span id="l67.37"> </span>
<a href="#l67.38"></a><span id="l67.38">   nsCOMPtr&lt;nsILocalFileMac&gt; macFile = do_QueryInterface(myFile);</span>
<a href="#l67.39"></a><span id="l67.39">   nsCAutoString path;</span>
<a href="#l67.40"></a><span id="l67.40">   macFile-&gt;GetNativePath(path);</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l68.1"></a><span id="l68.1" class="difflineminus">--- a/mailnews/compose/src/nsMsgAppleEncode.cpp</span>
<a href="#l68.2"></a><span id="l68.2" class="difflineplus">+++ b/mailnews/compose/src/nsMsgAppleEncode.cpp</span>
<a href="#l68.3"></a><span id="l68.3" class="difflineat">@@ -119,17 +119,17 @@ int ap_encode_file_infor(</span>
<a href="#l68.4"></a><span id="l68.4"> 	ap_header	head;</span>
<a href="#l68.5"></a><span id="l68.5"> 	ap_entry 	entries[NUM_ENTRIES];</span>
<a href="#l68.6"></a><span id="l68.6"> 	ap_dates 	dates;</span>
<a href="#l68.7"></a><span id="l68.7"> 	short 		i;</span>
<a href="#l68.8"></a><span id="l68.8"> 	long 		comlen;</span>
<a href="#l68.9"></a><span id="l68.9"> 	char 		comment[256];</span>
<a href="#l68.10"></a><span id="l68.10"> 	int	 		status;</span>
<a href="#l68.11"></a><span id="l68.11">     </span>
<a href="#l68.12"></a><span id="l68.12" class="difflineminus">-    nsCOMPtr &lt;nsILocalFile&gt; resFile;</span>
<a href="#l68.13"></a><span id="l68.13" class="difflineplus">+    nsCOMPtr &lt;nsIFile&gt; resFile;</span>
<a href="#l68.14"></a><span id="l68.14">     NS_NewNativeLocalFile(nsDependentCString(p_ap_encode_obj-&gt;fname), true,</span>
<a href="#l68.15"></a><span id="l68.15">                           getter_AddRefs(resFile));</span>
<a href="#l68.16"></a><span id="l68.16">     if (!resFile)</span>
<a href="#l68.17"></a><span id="l68.17">         return errFileOpen;</span>
<a href="#l68.18"></a><span id="l68.18"> </span>
<a href="#l68.19"></a><span id="l68.19">     FSRef ref;</span>
<a href="#l68.20"></a><span id="l68.20">     nsCOMPtr &lt;nsILocalFileMac&gt; macFile = do_QueryInterface(resFile);</span>
<a href="#l68.21"></a><span id="l68.21">     if (NS_FAILED(macFile-&gt;GetFSRef(&amp;ref)))</span>
<a href="#l68.22"></a><span id="l68.22" class="difflineat">@@ -294,17 +294,17 @@ int ap_encode_header(</span>
<a href="#l68.23"></a><span id="l68.23"> 			</span>
<a href="#l68.24"></a><span id="l68.24"> 		status = ap_encode_file_infor(p_ap_encode_obj); </span>
<a href="#l68.25"></a><span id="l68.25"> 		if (status != noErr)</span>
<a href="#l68.26"></a><span id="l68.26"> 			return status;</span>
<a href="#l68.27"></a><span id="l68.27"> 		</span>
<a href="#l68.28"></a><span id="l68.28"> 		/*</span>
<a href="#l68.29"></a><span id="l68.29"> 		** preparing to encode the resource fork.</span>
<a href="#l68.30"></a><span id="l68.30"> 		*/</span>
<a href="#l68.31"></a><span id="l68.31" class="difflineminus">-        nsCOMPtr &lt;nsILocalFile&gt; myFile;</span>
<a href="#l68.32"></a><span id="l68.32" class="difflineplus">+        nsCOMPtr &lt;nsIFile&gt; myFile;</span>
<a href="#l68.33"></a><span id="l68.33">         NS_NewNativeLocalFile(nsDependentCString(p_ap_encode_obj-&gt;fname), true, getter_AddRefs(myFile));</span>
<a href="#l68.34"></a><span id="l68.34">         if (!myFile)</span>
<a href="#l68.35"></a><span id="l68.35">             return errFileOpen;</span>
<a href="#l68.36"></a><span id="l68.36"> </span>
<a href="#l68.37"></a><span id="l68.37">         FSRef ref;</span>
<a href="#l68.38"></a><span id="l68.38">         nsCOMPtr &lt;nsILocalFileMac&gt; macFile = do_QueryInterface(myFile);</span>
<a href="#l68.39"></a><span id="l68.39">         if (NS_FAILED(macFile-&gt;GetFSRef(&amp;ref)))</span>
<a href="#l68.40"></a><span id="l68.40">             return errFileOpen;</span>
<a href="#l68.41"></a><span id="l68.41" class="difflineat">@@ -437,17 +437,17 @@ int ap_encode_data(</span>
<a href="#l68.42"></a><span id="l68.42"> 	</span>
<a href="#l68.43"></a><span id="l68.43"> 	if (firstime)</span>
<a href="#l68.44"></a><span id="l68.44"> 	{	</span>
<a href="#l68.45"></a><span id="l68.45"> 		char* magic_type;</span>
<a href="#l68.46"></a><span id="l68.46"> 			</span>
<a href="#l68.47"></a><span id="l68.47"> 		/*</span>
<a href="#l68.48"></a><span id="l68.48"> 		** preparing to encode the data fork.</span>
<a href="#l68.49"></a><span id="l68.49"> 		*/</span>
<a href="#l68.50"></a><span id="l68.50" class="difflineminus">-        nsCOMPtr &lt;nsILocalFile&gt; resFile;</span>
<a href="#l68.51"></a><span id="l68.51" class="difflineplus">+        nsCOMPtr &lt;nsIFile&gt; resFile;</span>
<a href="#l68.52"></a><span id="l68.52">         NS_NewNativeLocalFile(nsDependentCString(p_ap_encode_obj-&gt;fname), true,</span>
<a href="#l68.53"></a><span id="l68.53">                               getter_AddRefs(resFile));</span>
<a href="#l68.54"></a><span id="l68.54">         if (!resFile)</span>
<a href="#l68.55"></a><span id="l68.55">             return errFileOpen;</span>
<a href="#l68.56"></a><span id="l68.56"> </span>
<a href="#l68.57"></a><span id="l68.57">         FSRef ref;</span>
<a href="#l68.58"></a><span id="l68.58">         nsCOMPtr &lt;nsILocalFileMac&gt; macFile = do_QueryInterface(resFile);</span>
<a href="#l68.59"></a><span id="l68.59">         if (NS_FAILED(macFile-&gt;GetFSRef(&amp;ref)))</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l69.1"></a><span id="l69.1" class="difflineminus">--- a/mailnews/compose/src/nsMsgAttachment.cpp</span>
<a href="#l69.2"></a><span id="l69.2" class="difflineplus">+++ b/mailnews/compose/src/nsMsgAttachment.cpp</span>
<a href="#l69.3"></a><span id="l69.3" class="difflineat">@@ -1,15 +1,15 @@</span>
<a href="#l69.4"></a><span id="l69.4"> /* -*- Mode: C++; tab-width: 2; indent-tabs-mode: nil; c-basic-offset: 2 -*- */</span>
<a href="#l69.5"></a><span id="l69.5"> /* This Source Code Form is subject to the terms of the Mozilla Public</span>
<a href="#l69.6"></a><span id="l69.6">  * License, v. 2.0. If a copy of the MPL was not distributed with this</span>
<a href="#l69.7"></a><span id="l69.7">  * file, You can obtain one at http://mozilla.org/MPL/2.0/. */</span>
<a href="#l69.8"></a><span id="l69.8"> </span>
<a href="#l69.9"></a><span id="l69.9"> #include &quot;nsMsgAttachment.h&quot;</span>
<a href="#l69.10"></a><span id="l69.10" class="difflineminus">-#include &quot;nsILocalFile.h&quot;</span>
<a href="#l69.11"></a><span id="l69.11" class="difflineplus">+#include &quot;nsIFile.h&quot;</span>
<a href="#l69.12"></a><span id="l69.12"> #include &quot;nsNetUtil.h&quot;</span>
<a href="#l69.13"></a><span id="l69.13"> </span>
<a href="#l69.14"></a><span id="l69.14"> NS_IMPL_ISUPPORTS1(nsMsgAttachment, nsIMsgAttachment)</span>
<a href="#l69.15"></a><span id="l69.15"> </span>
<a href="#l69.16"></a><span id="l69.16"> nsMsgAttachment::nsMsgAttachment()</span>
<a href="#l69.17"></a><span id="l69.17"> {</span>
<a href="#l69.18"></a><span id="l69.18">   mTemporary = false;</span>
<a href="#l69.19"></a><span id="l69.19">   mSendViaCloud = false;</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l70.1"></a><span id="l70.1" class="difflineminus">--- a/mailnews/compose/src/nsMsgAttachmentHandler.cpp</span>
<a href="#l70.2"></a><span id="l70.2" class="difflineplus">+++ b/mailnews/compose/src/nsMsgAttachmentHandler.cpp</span>
<a href="#l70.3"></a><span id="l70.3" class="difflineat">@@ -37,17 +37,17 @@</span>
<a href="#l70.4"></a><span id="l70.4"> </span>
<a href="#l70.5"></a><span id="l70.5"> ///////////////////////////////////////////////////////////////////////////</span>
<a href="#l70.6"></a><span id="l70.6"> // Mac Specific Attachment Handling for AppleDouble Encoded Files</span>
<a href="#l70.7"></a><span id="l70.7"> ///////////////////////////////////////////////////////////////////////////</span>
<a href="#l70.8"></a><span id="l70.8"> #ifdef XP_MACOSX</span>
<a href="#l70.9"></a><span id="l70.9"> </span>
<a href="#l70.10"></a><span id="l70.10"> #define AD_WORKING_BUFF_SIZE                  8192</span>
<a href="#l70.11"></a><span id="l70.11"> </span>
<a href="#l70.12"></a><span id="l70.12" class="difflineminus">-extern void         MacGetFileType(nsILocalFile *fs, bool *useDefault, char **type, char **encoding);</span>
<a href="#l70.13"></a><span id="l70.13" class="difflineplus">+extern void         MacGetFileType(nsIFile *fs, bool *useDefault, char **type, char **encoding);</span>
<a href="#l70.14"></a><span id="l70.14"> </span>
<a href="#l70.15"></a><span id="l70.15"> #include &quot;nsILocalFileMac.h&quot;</span>
<a href="#l70.16"></a><span id="l70.16"> </span>
<a href="#l70.17"></a><span id="l70.17"> /* static */</span>
<a href="#l70.18"></a><span id="l70.18"> nsresult nsSimpleZipper::Zip(nsIFile *aInputFile, nsIFile *aOutputFile)</span>
<a href="#l70.19"></a><span id="l70.19"> {</span>
<a href="#l70.20"></a><span id="l70.20">   // create zipwriter object</span>
<a href="#l70.21"></a><span id="l70.21">   nsresult rv;</span>
<a href="#l70.22"></a><span id="l70.22" class="difflineat">@@ -426,17 +426,17 @@ DONE:</span>
<a href="#l70.23"></a><span id="l70.23"> }</span>
<a href="#l70.24"></a><span id="l70.24"> </span>
<a href="#l70.25"></a><span id="l70.25"> nsresult</span>
<a href="#l70.26"></a><span id="l70.26"> nsMsgAttachmentHandler::PickCharset()</span>
<a href="#l70.27"></a><span id="l70.27"> {</span>
<a href="#l70.28"></a><span id="l70.28">   if (!m_charset.IsEmpty() || !m_type.LowerCaseEqualsLiteral(TEXT_PLAIN))</span>
<a href="#l70.29"></a><span id="l70.29">     return NS_OK;</span>
<a href="#l70.30"></a><span id="l70.30"> </span>
<a href="#l70.31"></a><span id="l70.31" class="difflineminus">-  nsCOMPtr&lt;nsILocalFile&gt; tmpFile =</span>
<a href="#l70.32"></a><span id="l70.32" class="difflineplus">+  nsCOMPtr&lt;nsIFile&gt; tmpFile =</span>
<a href="#l70.33"></a><span id="l70.33">     do_QueryInterface(mTmpFile);</span>
<a href="#l70.34"></a><span id="l70.34">   if (!tmpFile)</span>
<a href="#l70.35"></a><span id="l70.35">     return NS_OK;</span>
<a href="#l70.36"></a><span id="l70.36">   </span>
<a href="#l70.37"></a><span id="l70.37">   return MsgDetectCharsetFromFile(tmpFile, m_charset);</span>
<a href="#l70.38"></a><span id="l70.38"> }</span>
<a href="#l70.39"></a><span id="l70.39">     </span>
<a href="#l70.40"></a><span id="l70.40"> static nsresult</span>
<a href="#l70.41"></a><span id="l70.41" class="difflineat">@@ -639,17 +639,17 @@ nsMsgAttachmentHandler::SnarfAttachment(</span>
<a href="#l70.42"></a><span id="l70.42">   if (!m_bogus_attachment &amp;&amp; StringBeginsWith(sourceURISpec, NS_LITERAL_CSTRING(&quot;file://&quot;)))</span>
<a href="#l70.43"></a><span id="l70.43">   {</span>
<a href="#l70.44"></a><span id="l70.44">     // Unescape the path (i.e. un-URLify it) before making a FSSpec</span>
<a href="#l70.45"></a><span id="l70.45">     nsCAutoString filePath;</span>
<a href="#l70.46"></a><span id="l70.46">     filePath.Adopt(nsMsgGetLocalFileFromURL(sourceURISpec.get()));</span>
<a href="#l70.47"></a><span id="l70.47">     nsCAutoString unescapedFilePath;</span>
<a href="#l70.48"></a><span id="l70.48">     MsgUnescapeString(filePath, 0, unescapedFilePath);</span>
<a href="#l70.49"></a><span id="l70.49"> </span>
<a href="#l70.50"></a><span id="l70.50" class="difflineminus">-    nsCOMPtr&lt;nsILocalFile&gt; sourceFile;</span>
<a href="#l70.51"></a><span id="l70.51" class="difflineplus">+    nsCOMPtr&lt;nsIFile&gt; sourceFile;</span>
<a href="#l70.52"></a><span id="l70.52">     NS_NewNativeLocalFile(unescapedFilePath, true, getter_AddRefs(sourceFile));</span>
<a href="#l70.53"></a><span id="l70.53">     if (!sourceFile)</span>
<a href="#l70.54"></a><span id="l70.54">       return NS_ERROR_FAILURE;</span>
<a href="#l70.55"></a><span id="l70.55">       </span>
<a href="#l70.56"></a><span id="l70.56">     // check if it is a bundle. if it is, we'll zip it. </span>
<a href="#l70.57"></a><span id="l70.57">     // if not, we'll apple encode it (applesingle or appledouble)</span>
<a href="#l70.58"></a><span id="l70.58">     nsCOMPtr&lt;nsILocalFileMac&gt; macFile(do_QueryInterface(sourceFile));</span>
<a href="#l70.59"></a><span id="l70.59">     bool isPackage;</span>
<a href="#l70.60"></a><span id="l70.60" class="difflineat">@@ -916,17 +916,17 @@ nsMsgAttachmentHandler::ConvertToAppleEn</span>
<a href="#l70.61"></a><span id="l70.61">     // don't bother to set the types if we failed in getting the file info.</span>
<a href="#l70.62"></a><span id="l70.62">   }</span>
<a href="#l70.63"></a><span id="l70.63"> </span>
<a href="#l70.64"></a><span id="l70.64">   return NS_OK;</span>
<a href="#l70.65"></a><span id="l70.65"> }</span>
<a href="#l70.66"></a><span id="l70.66"> #endif // XP_MACOSX</span>
<a href="#l70.67"></a><span id="l70.67"> </span>
<a href="#l70.68"></a><span id="l70.68"> nsresult</span>
<a href="#l70.69"></a><span id="l70.69" class="difflineminus">-nsMsgAttachmentHandler::LoadDataFromFile(nsILocalFile *file, nsString &amp;sigData, bool charsetConversion)</span>
<a href="#l70.70"></a><span id="l70.70" class="difflineplus">+nsMsgAttachmentHandler::LoadDataFromFile(nsIFile *file, nsString &amp;sigData, bool charsetConversion)</span>
<a href="#l70.71"></a><span id="l70.71"> {</span>
<a href="#l70.72"></a><span id="l70.72">   PRInt32       readSize;</span>
<a href="#l70.73"></a><span id="l70.73">   char          *readBuf;</span>
<a href="#l70.74"></a><span id="l70.74"> </span>
<a href="#l70.75"></a><span id="l70.75">   nsCOMPtr &lt;nsIInputStream&gt; inputFile;</span>
<a href="#l70.76"></a><span id="l70.76">   nsresult rv = NS_NewLocalFileInputStream(getter_AddRefs(inputFile), file);</span>
<a href="#l70.77"></a><span id="l70.77">   if (NS_FAILED(rv))</span>
<a href="#l70.78"></a><span id="l70.78">     return NS_MSG_ERROR_WRITING_FILE;</span>
<a href="#l70.79"></a><span id="l70.79" class="difflineat">@@ -993,17 +993,17 @@ nsMsgAttachmentHandler::UrlExit(nsresult</span>
<a href="#l70.80"></a><span id="l70.80">   NS_ASSERTION(m_mime_delivery_state != nsnull, &quot;not-null m_mime_delivery_state&quot;);</span>
<a href="#l70.81"></a><span id="l70.81"> </span>
<a href="#l70.82"></a><span id="l70.82">   // Close the file, but don't delete the disk file (or the file spec.)</span>
<a href="#l70.83"></a><span id="l70.83">   if (mOutFile)</span>
<a href="#l70.84"></a><span id="l70.84">   {</span>
<a href="#l70.85"></a><span id="l70.85">     mOutFile-&gt;Close();</span>
<a href="#l70.86"></a><span id="l70.86">     mOutFile = nsnull;</span>
<a href="#l70.87"></a><span id="l70.87">   }</span>
<a href="#l70.88"></a><span id="l70.88" class="difflineminus">-  // this silliness is because Windows nsILocalFile caches its file size</span>
<a href="#l70.89"></a><span id="l70.89" class="difflineplus">+  // this silliness is because Windows nsIFile caches its file size</span>
<a href="#l70.90"></a><span id="l70.90">   // so if an output stream writes to it, it will still return the original</span>
<a href="#l70.91"></a><span id="l70.91">   // cached size.</span>
<a href="#l70.92"></a><span id="l70.92">   if (mTmpFile)</span>
<a href="#l70.93"></a><span id="l70.93">   {</span>
<a href="#l70.94"></a><span id="l70.94">     nsCOMPtr &lt;nsIFile&gt; tmpFile;</span>
<a href="#l70.95"></a><span id="l70.95">     mTmpFile-&gt;Clone(getter_AddRefs(tmpFile));</span>
<a href="#l70.96"></a><span id="l70.96">     mTmpFile = do_QueryInterface(tmpFile);</span>
<a href="#l70.97"></a><span id="l70.97">   }</span>
<a href="#l70.98"></a><span id="l70.98" class="difflineat">@@ -1131,17 +1131,17 @@ nsMsgAttachmentHandler::UrlExit(nsresult</span>
<a href="#l70.99"></a><span id="l70.99">           if (NS_FAILED(ConvertFromUnicode(m_charset.get(), conData, tData)))</span>
<a href="#l70.100"></a><span id="l70.100">             LossyCopyUTF16toASCII(conData, tData);</span>
<a href="#l70.101"></a><span id="l70.101">           if (!tData.IsEmpty())</span>
<a href="#l70.102"></a><span id="l70.102">           {</span>
<a href="#l70.103"></a><span id="l70.103">             PRUint32 bytesWritten;</span>
<a href="#l70.104"></a><span id="l70.104">             (void) outputStream-&gt;Write(tData.get(), tData.Length(), &amp;bytesWritten);</span>
<a href="#l70.105"></a><span id="l70.105">           }</span>
<a href="#l70.106"></a><span id="l70.106">           outputStream-&gt;Close();</span>
<a href="#l70.107"></a><span id="l70.107" class="difflineminus">-          // this silliness is because Windows nsILocalFile caches its file size</span>
<a href="#l70.108"></a><span id="l70.108" class="difflineplus">+          // this silliness is because Windows nsIFile caches its file size</span>
<a href="#l70.109"></a><span id="l70.109">           // so if an output stream writes to it, it will still return the original</span>
<a href="#l70.110"></a><span id="l70.110">           // cached size.</span>
<a href="#l70.111"></a><span id="l70.111">           if (mTmpFile)</span>
<a href="#l70.112"></a><span id="l70.112">           {</span>
<a href="#l70.113"></a><span id="l70.113">             nsCOMPtr &lt;nsIFile&gt; tmpFile;</span>
<a href="#l70.114"></a><span id="l70.114">             mTmpFile-&gt;Clone(getter_AddRefs(tmpFile));</span>
<a href="#l70.115"></a><span id="l70.115">             mTmpFile = do_QueryInterface(tmpFile);</span>
<a href="#l70.116"></a><span id="l70.116">           }</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l71.1"></a><span id="l71.1" class="difflineminus">--- a/mailnews/compose/src/nsMsgAttachmentHandler.h</span>
<a href="#l71.2"></a><span id="l71.2" class="difflineplus">+++ b/mailnews/compose/src/nsMsgAttachmentHandler.h</span>
<a href="#l71.3"></a><span id="l71.3" class="difflineat">@@ -77,39 +77,39 @@ public:</span>
<a href="#l71.4"></a><span id="l71.4">   void                  CleanupTempFile();</span>
<a href="#l71.5"></a><span id="l71.5"> </span>
<a href="#l71.6"></a><span id="l71.6"> private:</span>
<a href="#l71.7"></a><span id="l71.7"> </span>
<a href="#l71.8"></a><span id="l71.8">   // use when a message (e.g. original message in a reply) is attached as a rfc822 attachment.</span>
<a href="#l71.9"></a><span id="l71.9">   nsresult              SnarfMsgAttachment(nsMsgCompFields *compFields);</span>
<a href="#l71.10"></a><span id="l71.10">   bool                  UseUUEncode_p(void);</span>
<a href="#l71.11"></a><span id="l71.11">   void                  AnalyzeDataChunk (const char *chunk, PRInt32 chunkSize);</span>
<a href="#l71.12"></a><span id="l71.12" class="difflineminus">-  nsresult              LoadDataFromFile(nsILocalFile *file, nsString &amp;sigData, bool charsetConversion); //A similar function already exist in nsMsgCompose!</span>
<a href="#l71.13"></a><span id="l71.13" class="difflineplus">+  nsresult              LoadDataFromFile(nsIFile *file, nsString &amp;sigData, bool charsetConversion); //A similar function already exist in nsMsgCompose!</span>
<a href="#l71.14"></a><span id="l71.14"> #ifdef XP_MACOSX</span>
<a href="#l71.15"></a><span id="l71.15">   nsresult              ConvertToAppleEncoding(const nsCString &amp;aFileSpecURI, </span>
<a href="#l71.16"></a><span id="l71.16">                                                const nsCString &amp;aFilePath, </span>
<a href="#l71.17"></a><span id="l71.17">                                                nsILocalFileMac *aSourceFile);</span>
<a href="#l71.18"></a><span id="l71.18">   // zips this attachment and does the work to make this attachment handler handle it properly.</span>
<a href="#l71.19"></a><span id="l71.19">   nsresult ConvertToZipFile(nsILocalFileMac *aSourceFile);</span>
<a href="#l71.20"></a><span id="l71.20">   bool HasResourceFork(FSRef *fsRef);</span>
<a href="#l71.21"></a><span id="l71.21"> #endif</span>
<a href="#l71.22"></a><span id="l71.22"> </span>
<a href="#l71.23"></a><span id="l71.23">   //</span>
<a href="#l71.24"></a><span id="l71.24"> public:</span>
<a href="#l71.25"></a><span id="l71.25">   nsCOMPtr&lt;nsIURI&gt; mURL;</span>
<a href="#l71.26"></a><span id="l71.26" class="difflineminus">-  nsCOMPtr&lt;nsILocalFile&gt;        mTmpFile;         // The temp file to which we save it </span>
<a href="#l71.27"></a><span id="l71.27" class="difflineplus">+  nsCOMPtr&lt;nsIFile&gt;        mTmpFile;         // The temp file to which we save it </span>
<a href="#l71.28"></a><span id="l71.28">   nsCOMPtr&lt;nsIOutputStream&gt;  mOutFile;          </span>
<a href="#l71.29"></a><span id="l71.29">   nsCOMPtr&lt;nsIRequest&gt; mRequest; // The live request used while fetching an attachment</span>
<a href="#l71.30"></a><span id="l71.30">   nsMsgCompFields       *mCompFields;       // Message composition fields for the sender</span>
<a href="#l71.31"></a><span id="l71.31">   bool                  m_bogus_attachment; // This is to catch problem children...</span>
<a href="#l71.32"></a><span id="l71.32">   </span>
<a href="#l71.33"></a><span id="l71.33"> #ifdef XP_MACOSX</span>
<a href="#l71.34"></a><span id="l71.34">   // if we need to encode this file into for example an appledouble, or zip file,</span>
<a href="#l71.35"></a><span id="l71.35">   // this file is our working file. currently only needed on mac.</span>
<a href="#l71.36"></a><span id="l71.36" class="difflineminus">-  nsCOMPtr&lt;nsILocalFile&gt; mEncodedWorkingFile;</span>
<a href="#l71.37"></a><span id="l71.37" class="difflineplus">+  nsCOMPtr&lt;nsIFile&gt; mEncodedWorkingFile;</span>
<a href="#l71.38"></a><span id="l71.38"> #endif</span>
<a href="#l71.39"></a><span id="l71.39"> </span>
<a href="#l71.40"></a><span id="l71.40">   nsCString m_xMacType;      // Mac file type</span>
<a href="#l71.41"></a><span id="l71.41">   nsCString m_xMacCreator;   // Mac file creator</span>
<a href="#l71.42"></a><span id="l71.42"> </span>
<a href="#l71.43"></a><span id="l71.43">   bool m_done;</span>
<a href="#l71.44"></a><span id="l71.44">   nsCString m_charset;         // charset name </span>
<a href="#l71.45"></a><span id="l71.45">   nsCString m_contentId;      // This is for mutipart/related Content-ID's</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l72.1"></a><span id="l72.1" class="difflineminus">--- a/mailnews/compose/src/nsMsgCompose.cpp</span>
<a href="#l72.2"></a><span id="l72.2" class="difflineplus">+++ b/mailnews/compose/src/nsMsgCompose.cpp</span>
<a href="#l72.3"></a><span id="l72.3" class="difflineat">@@ -4001,30 +4001,30 @@ NS_IMETHODIMP nsMsgComposeSendListener::</span>
<a href="#l72.4"></a><span id="l72.4"> /* void onSecurityChange (in nsIWebProgress aWebProgress, in nsIRequest aRequest, in unsigned long state); */</span>
<a href="#l72.5"></a><span id="l72.5"> NS_IMETHODIMP nsMsgComposeSendListener::OnSecurityChange(nsIWebProgress *aWebProgress, nsIRequest *aRequest, PRUint32 state)</span>
<a href="#l72.6"></a><span id="l72.6"> {</span>
<a href="#l72.7"></a><span id="l72.7">   /* Ignore this call */</span>
<a href="#l72.8"></a><span id="l72.8">   return NS_OK;</span>
<a href="#l72.9"></a><span id="l72.9"> }</span>
<a href="#l72.10"></a><span id="l72.10"> </span>
<a href="#l72.11"></a><span id="l72.11"> nsresult</span>
<a href="#l72.12"></a><span id="l72.12" class="difflineminus">-nsMsgCompose::ConvertHTMLToText(nsILocalFile *aSigFile, nsString &amp;aSigData)</span>
<a href="#l72.13"></a><span id="l72.13" class="difflineplus">+nsMsgCompose::ConvertHTMLToText(nsIFile *aSigFile, nsString &amp;aSigData)</span>
<a href="#l72.14"></a><span id="l72.14"> {</span>
<a href="#l72.15"></a><span id="l72.15">   nsAutoString origBuf;</span>
<a href="#l72.16"></a><span id="l72.16"> </span>
<a href="#l72.17"></a><span id="l72.17">   nsresult rv = LoadDataFromFile(aSigFile, origBuf);</span>
<a href="#l72.18"></a><span id="l72.18">   NS_ENSURE_SUCCESS (rv, rv);</span>
<a href="#l72.19"></a><span id="l72.19"> </span>
<a href="#l72.20"></a><span id="l72.20">   ConvertBufToPlainText(origBuf, false, true);</span>
<a href="#l72.21"></a><span id="l72.21">   aSigData = origBuf;</span>
<a href="#l72.22"></a><span id="l72.22">   return NS_OK;</span>
<a href="#l72.23"></a><span id="l72.23"> }</span>
<a href="#l72.24"></a><span id="l72.24"> </span>
<a href="#l72.25"></a><span id="l72.25"> nsresult</span>
<a href="#l72.26"></a><span id="l72.26" class="difflineminus">-nsMsgCompose::ConvertTextToHTML(nsILocalFile *aSigFile, nsString &amp;aSigData)</span>
<a href="#l72.27"></a><span id="l72.27" class="difflineplus">+nsMsgCompose::ConvertTextToHTML(nsIFile *aSigFile, nsString &amp;aSigData)</span>
<a href="#l72.28"></a><span id="l72.28"> {</span>
<a href="#l72.29"></a><span id="l72.29">   nsresult    rv;</span>
<a href="#l72.30"></a><span id="l72.30">   nsAutoString    origBuf;</span>
<a href="#l72.31"></a><span id="l72.31"> </span>
<a href="#l72.32"></a><span id="l72.32">   rv = LoadDataFromFile(aSigFile, origBuf);</span>
<a href="#l72.33"></a><span id="l72.33">   if (NS_FAILED(rv))</span>
<a href="#l72.34"></a><span id="l72.34">     return rv;</span>
<a href="#l72.35"></a><span id="l72.35"> </span>
<a href="#l72.36"></a><span id="l72.36" class="difflineat">@@ -4038,17 +4038,17 @@ nsMsgCompose::ConvertTextToHTML(nsILocal</span>
<a href="#l72.37"></a><span id="l72.37">     NS_Free(escaped);</span>
<a href="#l72.38"></a><span id="l72.38">   }</span>
<a href="#l72.39"></a><span id="l72.39">   else</span>
<a href="#l72.40"></a><span id="l72.40">     aSigData.Append(origBuf);</span>
<a href="#l72.41"></a><span id="l72.41">   return NS_OK;</span>
<a href="#l72.42"></a><span id="l72.42"> }</span>
<a href="#l72.43"></a><span id="l72.43"> </span>
<a href="#l72.44"></a><span id="l72.44"> nsresult</span>
<a href="#l72.45"></a><span id="l72.45" class="difflineminus">-nsMsgCompose::LoadDataFromFile(nsILocalFile *file, nsString &amp;sigData,</span>
<a href="#l72.46"></a><span id="l72.46" class="difflineplus">+nsMsgCompose::LoadDataFromFile(nsIFile *file, nsString &amp;sigData,</span>
<a href="#l72.47"></a><span id="l72.47">                                bool aAllowUTF8, bool aAllowUTF16)</span>
<a href="#l72.48"></a><span id="l72.48"> {</span>
<a href="#l72.49"></a><span id="l72.49">   PRInt32       readSize;</span>
<a href="#l72.50"></a><span id="l72.50">   PRUint32       nGot;</span>
<a href="#l72.51"></a><span id="l72.51">   char          *readBuf;</span>
<a href="#l72.52"></a><span id="l72.52">   char          *ptr;</span>
<a href="#l72.53"></a><span id="l72.53"> </span>
<a href="#l72.54"></a><span id="l72.54">   bool isDirectory = false;</span>
<a href="#l72.55"></a><span id="l72.55" class="difflineat">@@ -4179,17 +4179,17 @@ nsMsgCompose::ProcessSignature(nsIMsgIde</span>
<a href="#l72.56"></a><span id="l72.56">   bool          htmlSig = false;</span>
<a href="#l72.57"></a><span id="l72.57">   bool          imageSig = false;</span>
<a href="#l72.58"></a><span id="l72.58">   nsAutoString  sigData;</span>
<a href="#l72.59"></a><span id="l72.59">   nsAutoString sigOutput;</span>
<a href="#l72.60"></a><span id="l72.60">   PRInt32      reply_on_top = 0;</span>
<a href="#l72.61"></a><span id="l72.61">   bool         sig_bottom = true;</span>
<a href="#l72.62"></a><span id="l72.62">   bool          suppressSigSep = false;</span>
<a href="#l72.63"></a><span id="l72.63"> </span>
<a href="#l72.64"></a><span id="l72.64" class="difflineminus">-  nsCOMPtr&lt;nsILocalFile&gt; sigFile;</span>
<a href="#l72.65"></a><span id="l72.65" class="difflineplus">+  nsCOMPtr&lt;nsIFile&gt; sigFile;</span>
<a href="#l72.66"></a><span id="l72.66">   if (identity)</span>
<a href="#l72.67"></a><span id="l72.67">   {</span>
<a href="#l72.68"></a><span id="l72.68">     if (!CheckIncludeSignaturePrefs(identity))</span>
<a href="#l72.69"></a><span id="l72.69">       return NS_OK;</span>
<a href="#l72.70"></a><span id="l72.70"> </span>
<a href="#l72.71"></a><span id="l72.71">     identity-&gt;GetReplyOnTop(&amp;reply_on_top);</span>
<a href="#l72.72"></a><span id="l72.72">     identity-&gt;GetSigBottom(&amp;sig_bottom);</span>
<a href="#l72.73"></a><span id="l72.73">     identity-&gt;GetSuppressSigSep(&amp;suppressSigSep);</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l73.1"></a><span id="l73.1" class="difflineminus">--- a/mailnews/compose/src/nsMsgCompose.h</span>
<a href="#l73.2"></a><span id="l73.2" class="difflineplus">+++ b/mailnews/compose/src/nsMsgCompose.h</span>
<a href="#l73.3"></a><span id="l73.3" class="difflineat">@@ -45,31 +45,31 @@ class nsMsgCompose : public nsIMsgCompos</span>
<a href="#l73.4"></a><span id="l73.4">   /* nsIMsgSendListener interface */</span>
<a href="#l73.5"></a><span id="l73.5">   NS_DECL_NSIMSGSENDLISTENER</span>
<a href="#l73.6"></a><span id="l73.6"> </span>
<a href="#l73.7"></a><span id="l73.7"> private:</span>
<a href="#l73.8"></a><span id="l73.8"> </span>
<a href="#l73.9"></a><span id="l73.9">  // Deal with quoting issues...</span>
<a href="#l73.10"></a><span id="l73.10"> 	nsresult                      QuoteOriginalMessage(); // New template</span>
<a href="#l73.11"></a><span id="l73.11">   nsresult                      SetQuotingToFollow(bool aVal);</span>
<a href="#l73.12"></a><span id="l73.12" class="difflineminus">-  nsresult                      ConvertHTMLToText(nsILocalFile *aSigFile, nsString &amp;aSigData);</span>
<a href="#l73.13"></a><span id="l73.13" class="difflineminus">-  nsresult                      ConvertTextToHTML(nsILocalFile *aSigFile, nsString &amp;aSigData);</span>
<a href="#l73.14"></a><span id="l73.14" class="difflineplus">+  nsresult                      ConvertHTMLToText(nsIFile *aSigFile, nsString &amp;aSigData);</span>
<a href="#l73.15"></a><span id="l73.15" class="difflineplus">+  nsresult                      ConvertTextToHTML(nsIFile *aSigFile, nsString &amp;aSigData);</span>
<a href="#l73.16"></a><span id="l73.16">   bool                          IsEmbeddedObjectSafe(const char * originalScheme,</span>
<a href="#l73.17"></a><span id="l73.17">                                                      const char * originalHost,</span>
<a href="#l73.18"></a><span id="l73.18">                                                      const char * originalPath,</span>
<a href="#l73.19"></a><span id="l73.19">                                                      nsIDOMNode * object);</span>
<a href="#l73.20"></a><span id="l73.20">   nsresult                      ResetUrisForEmbeddedObjects();</span>
<a href="#l73.21"></a><span id="l73.21">   nsresult                      TagEmbeddedObjects(nsIEditorMailSupport *aMailEditor);</span>
<a href="#l73.22"></a><span id="l73.22"> </span>
<a href="#l73.23"></a><span id="l73.23">   nsCString                     mQuoteCharset;</span>
<a href="#l73.24"></a><span id="l73.24">   nsCString                     mOriginalMsgURI; // used so we can mark message disposition flags after we send the message</span>
<a href="#l73.25"></a><span id="l73.25"> </span>
<a href="#l73.26"></a><span id="l73.26">   PRInt32                       mWhatHolder;</span>
<a href="#l73.27"></a><span id="l73.27"> </span>
<a href="#l73.28"></a><span id="l73.28" class="difflineminus">-  nsresult                      LoadDataFromFile(nsILocalFile *file,</span>
<a href="#l73.29"></a><span id="l73.29" class="difflineplus">+  nsresult                      LoadDataFromFile(nsIFile *file,</span>
<a href="#l73.30"></a><span id="l73.30">                                                  nsString &amp;sigData,</span>
<a href="#l73.31"></a><span id="l73.31">                                                  bool aAllowUTF8 = true,</span>
<a href="#l73.32"></a><span id="l73.32">                                                  bool aAllowUTF16 = true);</span>
<a href="#l73.33"></a><span id="l73.33"> </span>
<a href="#l73.34"></a><span id="l73.34">   bool                          CheckIncludeSignaturePrefs(nsIMsgIdentity *identity);</span>
<a href="#l73.35"></a><span id="l73.35">   //m_folderName to store the value of the saved drafts folder.</span>
<a href="#l73.36"></a><span id="l73.36">   nsCString                     m_folderName;</span>
<a href="#l73.37"></a><span id="l73.37">   void InsertDivWrappedTextAtSelection(const nsAString &amp;aText,</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l74.1"></a><span id="l74.1" class="difflineminus">--- a/mailnews/compose/src/nsMsgCopy.cpp</span>
<a href="#l74.2"></a><span id="l74.2" class="difflineplus">+++ b/mailnews/compose/src/nsMsgCopy.cpp</span>
<a href="#l74.3"></a><span id="l74.3" class="difflineat">@@ -364,17 +364,17 @@ nsMsgCopy::CreateIfMissing(nsIMsgFolder </span>
<a href="#l74.4"></a><span id="l74.4"> {</span>
<a href="#l74.5"></a><span id="l74.5">   nsresult ret = NS_OK;</span>
<a href="#l74.6"></a><span id="l74.6">   if (folder &amp;&amp; *folder)</span>
<a href="#l74.7"></a><span id="l74.7">   {</span>
<a href="#l74.8"></a><span id="l74.8">     nsCOMPtr &lt;nsIMsgFolder&gt; parent;</span>
<a href="#l74.9"></a><span id="l74.9">     (*folder)-&gt;GetParent(getter_AddRefs(parent));</span>
<a href="#l74.10"></a><span id="l74.10">     if (!parent)</span>
<a href="#l74.11"></a><span id="l74.11">     {</span>
<a href="#l74.12"></a><span id="l74.12" class="difflineminus">-      nsCOMPtr &lt;nsILocalFile&gt; folderPath;</span>
<a href="#l74.13"></a><span id="l74.13" class="difflineplus">+      nsCOMPtr &lt;nsIFile&gt; folderPath;</span>
<a href="#l74.14"></a><span id="l74.14">       // for local folders, path is to the berkeley mailbox.</span>
<a href="#l74.15"></a><span id="l74.15">       // for imap folders, path needs to have .msf appended to the name</span>
<a href="#l74.16"></a><span id="l74.16">       (*folder)-&gt;GetFilePath(getter_AddRefs(folderPath));</span>
<a href="#l74.17"></a><span id="l74.17">         bool isImapFolder = !PL_strncasecmp(mSavePref, &quot;imap:&quot;, 5);</span>
<a href="#l74.18"></a><span id="l74.18">       // if we can't get the path from the folder, then try to create the storage.</span>
<a href="#l74.19"></a><span id="l74.19">       // for imap, it doesn't matter if the .msf file exists - it still might not</span>
<a href="#l74.20"></a><span id="l74.20">       // exist on the server, so we should try to create it</span>
<a href="#l74.21"></a><span id="l74.21">       bool exists = false;</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l75.1"></a><span id="l75.1" class="difflineminus">--- a/mailnews/compose/src/nsMsgSend.cpp</span>
<a href="#l75.2"></a><span id="l75.2" class="difflineplus">+++ b/mailnews/compose/src/nsMsgSend.cpp</span>
<a href="#l75.3"></a><span id="l75.3" class="difflineat">@@ -1428,43 +1428,39 @@ nsMsgComposeAndSend::GetEmbeddedObjectIn</span>
<a href="#l75.4"></a><span id="l75.4">     if (fileUrl)</span>
<a href="#l75.5"></a><span id="l75.5">     {</span>
<a href="#l75.6"></a><span id="l75.6">       bool isAValidFile = false;</span>
<a href="#l75.7"></a><span id="l75.7"> </span>
<a href="#l75.8"></a><span id="l75.8">       nsCOMPtr&lt;nsIFile&gt; aFile;</span>
<a href="#l75.9"></a><span id="l75.9">       rv = fileUrl-&gt;GetFile(getter_AddRefs(aFile));</span>
<a href="#l75.10"></a><span id="l75.10">       if (NS_SUCCEEDED(rv) &amp;&amp; aFile)</span>
<a href="#l75.11"></a><span id="l75.11">       {</span>
<a href="#l75.12"></a><span id="l75.12" class="difflineminus">-        nsCOMPtr&lt;nsILocalFile&gt; aLocalFile (do_QueryInterface(aFile));</span>
<a href="#l75.13"></a><span id="l75.13" class="difflineminus">-        if (aLocalFile)</span>
<a href="#l75.14"></a><span id="l75.14" class="difflineplus">+        rv = aFile-&gt;IsFile(&amp;isAValidFile);</span>
<a href="#l75.15"></a><span id="l75.15" class="difflineplus">+        if (NS_FAILED(rv))</span>
<a href="#l75.16"></a><span id="l75.16" class="difflineplus">+          isAValidFile = false;</span>
<a href="#l75.17"></a><span id="l75.17" class="difflineplus">+        else</span>
<a href="#l75.18"></a><span id="l75.18">         {</span>
<a href="#l75.19"></a><span id="l75.19" class="difflineminus">-          rv = aLocalFile-&gt;IsFile(&amp;isAValidFile);</span>
<a href="#l75.20"></a><span id="l75.20" class="difflineminus">-          if (NS_FAILED(rv))</span>
<a href="#l75.21"></a><span id="l75.21" class="difflineminus">-            isAValidFile = false;</span>
<a href="#l75.22"></a><span id="l75.22" class="difflineminus">-          else</span>
<a href="#l75.23"></a><span id="l75.23" class="difflineplus">+          if (anchor)</span>
<a href="#l75.24"></a><span id="l75.24">           {</span>
<a href="#l75.25"></a><span id="l75.25" class="difflineminus">-            if (anchor)</span>
<a href="#l75.26"></a><span id="l75.26" class="difflineminus">-            {</span>
<a href="#l75.27"></a><span id="l75.27" class="difflineminus">-              // One more test, if the anchor points to a local network server, let's check what the pref</span>
<a href="#l75.28"></a><span id="l75.28" class="difflineminus">-              // mail.compose.dont_attach_source_of_local_network_links tells us to do.</span>
<a href="#l75.29"></a><span id="l75.29" class="difflineminus">-              nsCAutoString urlSpec;</span>
<a href="#l75.30"></a><span id="l75.30" class="difflineminus">-              rv = attachment-&gt;m_url-&gt;GetSpec(urlSpec);</span>
<a href="#l75.31"></a><span id="l75.31" class="difflineminus">-              if (NS_SUCCEEDED(rv))</span>
<a href="#l75.32"></a><span id="l75.32" class="difflineminus">-                if (StringBeginsWith(urlSpec, NS_LITERAL_CSTRING(&quot;file://///&quot;)))</span>
<a href="#l75.33"></a><span id="l75.33" class="difflineplus">+            // One more test, if the anchor points to a local network server, let's check what the pref</span>
<a href="#l75.34"></a><span id="l75.34" class="difflineplus">+            // mail.compose.dont_attach_source_of_local_network_links tells us to do.</span>
<a href="#l75.35"></a><span id="l75.35" class="difflineplus">+            nsCAutoString urlSpec;</span>
<a href="#l75.36"></a><span id="l75.36" class="difflineplus">+            rv = attachment-&gt;m_url-&gt;GetSpec(urlSpec);</span>
<a href="#l75.37"></a><span id="l75.37" class="difflineplus">+            if (NS_SUCCEEDED(rv))</span>
<a href="#l75.38"></a><span id="l75.38" class="difflineplus">+              if (StringBeginsWith(urlSpec, NS_LITERAL_CSTRING(&quot;file://///&quot;)))</span>
<a href="#l75.39"></a><span id="l75.39" class="difflineplus">+              {</span>
<a href="#l75.40"></a><span id="l75.40" class="difflineplus">+                nsCOMPtr&lt;nsIPrefBranch&gt; pPrefBranch(do_GetService(NS_PREFSERVICE_CONTRACTID));</span>
<a href="#l75.41"></a><span id="l75.41" class="difflineplus">+                if (pPrefBranch)</span>
<a href="#l75.42"></a><span id="l75.42">                 {</span>
<a href="#l75.43"></a><span id="l75.43" class="difflineminus">-                  nsCOMPtr&lt;nsIPrefBranch&gt; pPrefBranch(do_GetService(NS_PREFSERVICE_CONTRACTID));</span>
<a href="#l75.44"></a><span id="l75.44" class="difflineminus">-                  if (pPrefBranch)</span>
<a href="#l75.45"></a><span id="l75.45" class="difflineminus">-                  {</span>
<a href="#l75.46"></a><span id="l75.46" class="difflineminus">-                    bool dontSend = false;</span>
<a href="#l75.47"></a><span id="l75.47" class="difflineminus">-                    rv = pPrefBranch-&gt;GetBoolPref(PREF_MAIL_DONT_ATTACH_SOURCE, &amp;dontSend);</span>
<a href="#l75.48"></a><span id="l75.48" class="difflineminus">-                    if (dontSend)</span>
<a href="#l75.49"></a><span id="l75.49" class="difflineminus">-                      isAValidFile = false;</span>
<a href="#l75.50"></a><span id="l75.50" class="difflineminus">-                  }</span>
<a href="#l75.51"></a><span id="l75.51" class="difflineplus">+                  bool dontSend = false;</span>
<a href="#l75.52"></a><span id="l75.52" class="difflineplus">+                  rv = pPrefBranch-&gt;GetBoolPref(PREF_MAIL_DONT_ATTACH_SOURCE, &amp;dontSend);</span>
<a href="#l75.53"></a><span id="l75.53" class="difflineplus">+                  if (dontSend)</span>
<a href="#l75.54"></a><span id="l75.54" class="difflineplus">+                    isAValidFile = false;</span>
<a href="#l75.55"></a><span id="l75.55">                 }</span>
<a href="#l75.56"></a><span id="l75.56" class="difflineminus">-            }</span>
<a href="#l75.57"></a><span id="l75.57" class="difflineplus">+              }</span>
<a href="#l75.58"></a><span id="l75.58">           }</span>
<a href="#l75.59"></a><span id="l75.59">         }</span>
<a href="#l75.60"></a><span id="l75.60">       }</span>
<a href="#l75.61"></a><span id="l75.61"> </span>
<a href="#l75.62"></a><span id="l75.62">       if (! isAValidFile)</span>
<a href="#l75.63"></a><span id="l75.63">         return NS_OK;</span>
<a href="#l75.64"></a><span id="l75.64">     }</span>
<a href="#l75.65"></a><span id="l75.65">   }</span>
<a href="#l75.66"></a><span id="l75.66" class="difflineat">@@ -2435,17 +2431,17 @@ nsMsgComposeAndSend::HackAttachments(nsI</span>
<a href="#l75.67"></a><span id="l75.67">       // If we still don't have a content type, we should really try sniff one out!</span>
<a href="#l75.68"></a><span id="l75.68">       if (m_attachments[i].m_type.IsEmpty())</span>
<a href="#l75.69"></a><span id="l75.69">         m_attachments[i].PickEncoding(mCompFields-&gt;GetCharacterSet(), this);</span>
<a href="#l75.70"></a><span id="l75.70"> </span>
<a href="#l75.71"></a><span id="l75.71">       // For local files, if they are HTML docs and we don't have a charset, we should</span>
<a href="#l75.72"></a><span id="l75.72">       // sniff the file and see if we can figure it out.</span>
<a href="#l75.73"></a><span id="l75.73">       if (!m_attachments[i].m_type.IsEmpty())</span>
<a href="#l75.74"></a><span id="l75.74">       {</span>
<a href="#l75.75"></a><span id="l75.75" class="difflineminus">-        nsCOMPtr&lt;nsILocalFile&gt; tmpFile;</span>
<a href="#l75.76"></a><span id="l75.76" class="difflineplus">+        nsCOMPtr&lt;nsIFile&gt; tmpFile;</span>
<a href="#l75.77"></a><span id="l75.77">         attachedFile-&gt;GetTmpFile(getter_AddRefs(tmpFile));</span>
<a href="#l75.78"></a><span id="l75.78">         if (m_attachments[i].m_type.LowerCaseEqualsLiteral(TEXT_HTML) &amp;&amp; tmpFile)</span>
<a href="#l75.79"></a><span id="l75.79">         {</span>
<a href="#l75.80"></a><span id="l75.80">           char *tmpCharset = (char *)nsMsgI18NParseMetaCharset(tmpFile);</span>
<a href="#l75.81"></a><span id="l75.81">           if (tmpCharset[0] != '\0')</span>
<a href="#l75.82"></a><span id="l75.82">             m_attachments[i].m_charset = tmpCharset;</span>
<a href="#l75.83"></a><span id="l75.83">         }</span>
<a href="#l75.84"></a><span id="l75.84">       }</span>
<a href="#l75.85"></a><span id="l75.85" class="difflineat">@@ -5163,24 +5159,24 @@ NS_IMETHODIMP nsMsgAttachedFile::GetOrig</span>
<a href="#l75.86"></a><span id="l75.86"> }</span>
<a href="#l75.87"></a><span id="l75.87"> </span>
<a href="#l75.88"></a><span id="l75.88"> NS_IMETHODIMP nsMsgAttachedFile::SetOrigUrl(nsIURI *aOrigUrl)</span>
<a href="#l75.89"></a><span id="l75.89"> {</span>
<a href="#l75.90"></a><span id="l75.90">   m_origUrl = aOrigUrl;</span>
<a href="#l75.91"></a><span id="l75.91">   return NS_OK;</span>
<a href="#l75.92"></a><span id="l75.92"> }</span>
<a href="#l75.93"></a><span id="l75.93"> </span>
<a href="#l75.94"></a><span id="l75.94" class="difflineminus">-NS_IMETHODIMP nsMsgAttachedFile::GetTmpFile(nsILocalFile **aTmpFile)</span>
<a href="#l75.95"></a><span id="l75.95" class="difflineplus">+NS_IMETHODIMP nsMsgAttachedFile::GetTmpFile(nsIFile **aTmpFile)</span>
<a href="#l75.96"></a><span id="l75.96"> {</span>
<a href="#l75.97"></a><span id="l75.97">   NS_ENSURE_ARG_POINTER(aTmpFile);</span>
<a href="#l75.98"></a><span id="l75.98">   NS_IF_ADDREF(*aTmpFile = m_tmpFile);</span>
<a href="#l75.99"></a><span id="l75.99">   return NS_OK;</span>
<a href="#l75.100"></a><span id="l75.100"> }</span>
<a href="#l75.101"></a><span id="l75.101"> </span>
<a href="#l75.102"></a><span id="l75.102" class="difflineminus">-NS_IMETHODIMP nsMsgAttachedFile::SetTmpFile(nsILocalFile *aTmpFile)</span>
<a href="#l75.103"></a><span id="l75.103" class="difflineplus">+NS_IMETHODIMP nsMsgAttachedFile::SetTmpFile(nsIFile *aTmpFile)</span>
<a href="#l75.104"></a><span id="l75.104"> {</span>
<a href="#l75.105"></a><span id="l75.105">   m_tmpFile = aTmpFile;</span>
<a href="#l75.106"></a><span id="l75.106">   return NS_OK;</span>
<a href="#l75.107"></a><span id="l75.107"> }</span>
<a href="#l75.108"></a><span id="l75.108"> </span>
<a href="#l75.109"></a><span id="l75.109"> NS_IMETHODIMP nsMsgAttachedFile::GetType(nsACString &amp;aType)</span>
<a href="#l75.110"></a><span id="l75.110"> {</span>
<a href="#l75.111"></a><span id="l75.111">   aType = m_type;</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l76.1"></a><span id="l76.1" class="difflineminus">--- a/mailnews/compose/src/nsMsgSendPart.cpp</span>
<a href="#l76.2"></a><span id="l76.2" class="difflineplus">+++ b/mailnews/compose/src/nsMsgSendPart.cpp</span>
<a href="#l76.3"></a><span id="l76.3" class="difflineat">@@ -75,17 +75,17 @@ int nsMsgSendPart::CopyString(char** des</span>
<a href="#l76.4"></a><span id="l76.4">     *dest = PL_strdup(&quot;&quot;);</span>
<a href="#l76.5"></a><span id="l76.5">   else</span>
<a href="#l76.6"></a><span id="l76.6">     *dest = PL_strdup(src);</span>
<a href="#l76.7"></a><span id="l76.7">   </span>
<a href="#l76.8"></a><span id="l76.8">   return *dest? 0 : NS_ERROR_OUT_OF_MEMORY;</span>
<a href="#l76.9"></a><span id="l76.9"> }</span>
<a href="#l76.10"></a><span id="l76.10"> </span>
<a href="#l76.11"></a><span id="l76.11"> </span>
<a href="#l76.12"></a><span id="l76.12" class="difflineminus">-nsresult nsMsgSendPart::SetFile(nsILocalFile *file)</span>
<a href="#l76.13"></a><span id="l76.13" class="difflineplus">+nsresult nsMsgSendPart::SetFile(nsIFile *file)</span>
<a href="#l76.14"></a><span id="l76.14"> {</span>
<a href="#l76.15"></a><span id="l76.15">   m_file = file;</span>
<a href="#l76.16"></a><span id="l76.16">   return NS_OK;</span>
<a href="#l76.17"></a><span id="l76.17"> }</span>
<a href="#l76.18"></a><span id="l76.18"> </span>
<a href="#l76.19"></a><span id="l76.19"> </span>
<a href="#l76.20"></a><span id="l76.20"> int nsMsgSendPart::SetBuffer(const char* buffer)</span>
<a href="#l76.21"></a><span id="l76.21"> {</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l77.1"></a><span id="l77.1" class="difflineminus">--- a/mailnews/compose/src/nsMsgSendPart.h</span>
<a href="#l77.2"></a><span id="l77.2" class="difflineplus">+++ b/mailnews/compose/src/nsMsgSendPart.h</span>
<a href="#l77.3"></a><span id="l77.3" class="difflineat">@@ -16,18 +16,18 @@ typedef int (*MSG_SendPartWriteFunc)(con</span>
<a href="#l77.4"></a><span id="l77.4"> class nsMsgSendPart {</span>
<a href="#l77.5"></a><span id="l77.5"> public:</span>
<a href="#l77.6"></a><span id="l77.6">     nsMsgSendPart(nsIMsgSend* state, const char *part_charset = NULL);</span>
<a href="#l77.7"></a><span id="l77.7">     virtual ~nsMsgSendPart();	  // Note that the destructor also destroys</span>
<a href="#l77.8"></a><span id="l77.8"> 								                // any children that were added.</span>
<a href="#l77.9"></a><span id="l77.9"> </span>
<a href="#l77.10"></a><span id="l77.10">     virtual int       Write();</span>
<a href="#l77.11"></a><span id="l77.11"> </span>
<a href="#l77.12"></a><span id="l77.12" class="difflineminus">-    virtual nsresult    SetFile(nsILocalFile *filename);</span>
<a href="#l77.13"></a><span id="l77.13" class="difflineminus">-    const nsILocalFile  *GetFile() {return m_file;}</span>
<a href="#l77.14"></a><span id="l77.14" class="difflineplus">+    virtual nsresult    SetFile(nsIFile *filename);</span>
<a href="#l77.15"></a><span id="l77.15" class="difflineplus">+    const nsIFile  *GetFile() {return m_file;}</span>
<a href="#l77.16"></a><span id="l77.16"> </span>
<a href="#l77.17"></a><span id="l77.17">     virtual int       SetBuffer(const char* buffer);</span>
<a href="#l77.18"></a><span id="l77.18">     const char        *GetBuffer() {return m_buffer;}</span>
<a href="#l77.19"></a><span id="l77.19"> </span>
<a href="#l77.20"></a><span id="l77.20">     virtual int       SetType(const char* type);</span>
<a href="#l77.21"></a><span id="l77.21">     const char        *GetType() {return m_type;}</span>
<a href="#l77.22"></a><span id="l77.22">     </span>
<a href="#l77.23"></a><span id="l77.23">     const char        *GetCharsetName() {return m_charset_name;}</span>
<a href="#l77.24"></a><span id="l77.24" class="difflineat">@@ -65,17 +65,17 @@ public:</span>
<a href="#l77.25"></a><span id="l77.25">                       }</span>
<a href="#l77.26"></a><span id="l77.26">   nsCString           m_partNum;</span>
<a href="#l77.27"></a><span id="l77.27"> protected:</span>
<a href="#l77.28"></a><span id="l77.28"> 	int                 CopyString(char** dest, const char* src);</span>
<a href="#l77.29"></a><span id="l77.29"> 	int                 PushBody(const char* buffer, PRInt32 length);</span>
<a href="#l77.30"></a><span id="l77.30"> </span>
<a href="#l77.31"></a><span id="l77.31"> 	nsCOMPtr&lt;nsIMsgSend&gt; m_state;</span>
<a href="#l77.32"></a><span id="l77.32"> 	nsMsgSendPart       *m_parent;</span>
<a href="#l77.33"></a><span id="l77.33" class="difflineminus">-  nsCOMPtr &lt;nsILocalFile&gt;   m_file;</span>
<a href="#l77.34"></a><span id="l77.34" class="difflineplus">+  nsCOMPtr &lt;nsIFile&gt;   m_file;</span>
<a href="#l77.35"></a><span id="l77.35"> 	char                *m_buffer;</span>
<a href="#l77.36"></a><span id="l77.36">   char                *m_type;</span>
<a href="#l77.37"></a><span id="l77.37">   char                *m_other;</span>
<a href="#l77.38"></a><span id="l77.38">   char                m_charset_name[64+1];        // charset name associated with this part</span>
<a href="#l77.39"></a><span id="l77.39"> 	bool                m_strip_sensitive_headers;</span>
<a href="#l77.40"></a><span id="l77.40"> 	MimeEncoderData     *m_encoder_data;  /* Opaque state for base64/qp encoder. */</span>
<a href="#l77.41"></a><span id="l77.41"> </span>
<a href="#l77.42"></a><span id="l77.42"> 	nsMsgSendPart       **m_children;</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l78.1"></a><span id="l78.1" class="difflineminus">--- a/mailnews/compose/src/nsURLFetcher.cpp</span>
<a href="#l78.2"></a><span id="l78.2" class="difflineplus">+++ b/mailnews/compose/src/nsURLFetcher.cpp</span>
<a href="#l78.3"></a><span id="l78.3" class="difflineat">@@ -284,33 +284,33 @@ nsURLFetcher::OnStopRequest(nsIRequest *</span>
<a href="#l78.4"></a><span id="l78.4">   if (mCallback)</span>
<a href="#l78.5"></a><span id="l78.5">     mCallback (aStatus, mContentType, mCharset, mTotalWritten, nsnull, mTagData);</span>
<a href="#l78.6"></a><span id="l78.6"> </span>
<a href="#l78.7"></a><span id="l78.7">   // Time to return...</span>
<a href="#l78.8"></a><span id="l78.8">   return NS_OK;</span>
<a href="#l78.9"></a><span id="l78.9"> }</span>
<a href="#l78.10"></a><span id="l78.10"> </span>
<a href="#l78.11"></a><span id="l78.11"> nsresult </span>
<a href="#l78.12"></a><span id="l78.12" class="difflineminus">-nsURLFetcher::Initialize(nsILocalFile *localFile, </span>
<a href="#l78.13"></a><span id="l78.13" class="difflineplus">+nsURLFetcher::Initialize(nsIFile *localFile, </span>
<a href="#l78.14"></a><span id="l78.14">                          nsIOutputStream *outputStream,</span>
<a href="#l78.15"></a><span id="l78.15">                          nsAttachSaveCompletionCallback cb, </span>
<a href="#l78.16"></a><span id="l78.16">                          void *tagData)</span>
<a href="#l78.17"></a><span id="l78.17"> {</span>
<a href="#l78.18"></a><span id="l78.18">   if (!outputStream || !localFile)</span>
<a href="#l78.19"></a><span id="l78.19">     return NS_ERROR_INVALID_ARG;</span>
<a href="#l78.20"></a><span id="l78.20"> </span>
<a href="#l78.21"></a><span id="l78.21">   mOutStream = outputStream;</span>
<a href="#l78.22"></a><span id="l78.22">   mLocalFile = localFile;</span>
<a href="#l78.23"></a><span id="l78.23">   mCallback = cb;     //JFD: Please, no more callback, use a listener...</span>
<a href="#l78.24"></a><span id="l78.24">   mTagData = tagData; //JFD: TODO, WE SHOULD USE A NSCOMPTR to hold this stuff!!!</span>
<a href="#l78.25"></a><span id="l78.25">   return NS_OK;</span>
<a href="#l78.26"></a><span id="l78.26"> }</span>
<a href="#l78.27"></a><span id="l78.27"> </span>
<a href="#l78.28"></a><span id="l78.28"> nsresult</span>
<a href="#l78.29"></a><span id="l78.29" class="difflineminus">-nsURLFetcher::FireURLRequest(nsIURI *aURL, nsILocalFile *localFile, nsIOutputStream *outputStream, </span>
<a href="#l78.30"></a><span id="l78.30" class="difflineplus">+nsURLFetcher::FireURLRequest(nsIURI *aURL, nsIFile *localFile, nsIOutputStream *outputStream, </span>
<a href="#l78.31"></a><span id="l78.31">                              nsAttachSaveCompletionCallback cb, void *tagData)</span>
<a href="#l78.32"></a><span id="l78.32"> {</span>
<a href="#l78.33"></a><span id="l78.33">   nsresult rv;</span>
<a href="#l78.34"></a><span id="l78.34"> </span>
<a href="#l78.35"></a><span id="l78.35">   rv = Initialize(localFile, outputStream, cb, tagData);</span>
<a href="#l78.36"></a><span id="l78.36">   NS_ENSURE_SUCCESS(rv, rv);</span>
<a href="#l78.37"></a><span id="l78.37"> </span>
<a href="#l78.38"></a><span id="l78.38">   //check to see if aURL is a local file or not</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l79.1"></a><span id="l79.1" class="difflineminus">--- a/mailnews/compose/src/nsURLFetcher.h</span>
<a href="#l79.2"></a><span id="l79.2" class="difflineplus">+++ b/mailnews/compose/src/nsURLFetcher.h</span>
<a href="#l79.3"></a><span id="l79.3" class="difflineat">@@ -51,17 +51,17 @@ public:</span>
<a href="#l79.4"></a><span id="l79.4">   // Methods for nsIWebProgressListener</span>
<a href="#l79.5"></a><span id="l79.5">   NS_DECL_NSIWEBPROGRESSLISTENER</span>
<a href="#l79.6"></a><span id="l79.6"> </span>
<a href="#l79.7"></a><span id="l79.7"> protected:</span>
<a href="#l79.8"></a><span id="l79.8">   nsresult InsertConverter(const char * aContentType);</span>
<a href="#l79.9"></a><span id="l79.9"> </span>
<a href="#l79.10"></a><span id="l79.10"> private:</span>
<a href="#l79.11"></a><span id="l79.11">   nsCOMPtr&lt;nsIOutputStream&gt;       mOutStream;               // the output file stream</span>
<a href="#l79.12"></a><span id="l79.12" class="difflineminus">-  nsCOMPtr&lt;nsILocalFile&gt;          mLocalFile;               // the output file itself</span>
<a href="#l79.13"></a><span id="l79.13" class="difflineplus">+  nsCOMPtr&lt;nsIFile&gt;          mLocalFile;               // the output file itself</span>
<a href="#l79.14"></a><span id="l79.14">   nsCOMPtr&lt;nsIStreamListener&gt;     mConverter;               // the stream converter, if needed</span>
<a href="#l79.15"></a><span id="l79.15">   nsCString                  mConverterContentType;    // The content type of the converter</span>
<a href="#l79.16"></a><span id="l79.16">   bool                            mStillRunning;  // Are we still running?</span>
<a href="#l79.17"></a><span id="l79.17">   PRInt32                         mTotalWritten;  // Size counter variable</span>
<a href="#l79.18"></a><span id="l79.18">   char                            *mBuffer;                 // Buffer used for reading the data</span>
<a href="#l79.19"></a><span id="l79.19">   PRUint32                        mBufferSize;              // Buffer size;</span>
<a href="#l79.20"></a><span id="l79.20">   nsCString                  mContentType;             // The content type retrieved from the server</span>
<a href="#l79.21"></a><span id="l79.21">   nsCString                  mCharset;                 // The charset retrieved from the server</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l80.1"></a><span id="l80.1" class="difflineminus">--- a/mailnews/db/msgdb/public/nsIMsgDatabase.idl</span>
<a href="#l80.2"></a><span id="l80.2" class="difflineplus">+++ b/mailnews/db/msgdb/public/nsIMsgDatabase.idl</span>
<a href="#l80.3"></a><span id="l80.3" class="difflineat">@@ -34,17 +34,17 @@ interface nsIMsgDBHdr;</span>
<a href="#l80.4"></a><span id="l80.4"> interface nsISimpleEnumerator;</span>
<a href="#l80.5"></a><span id="l80.5"> interface nsIMsgThread;</span>
<a href="#l80.6"></a><span id="l80.6"> interface nsIDBFolderInfo;</span>
<a href="#l80.7"></a><span id="l80.7"> interface nsIMsgOfflineImapOperation;</span>
<a href="#l80.8"></a><span id="l80.8"> interface nsIMsgFolder;</span>
<a href="#l80.9"></a><span id="l80.9"> interface nsIMsgKeyArray;</span>
<a href="#l80.10"></a><span id="l80.10"> interface nsIOutputStream;</span>
<a href="#l80.11"></a><span id="l80.11"> interface nsIUrlListener;</span>
<a href="#l80.12"></a><span id="l80.12" class="difflineminus">-interface nsILocalFile;</span>
<a href="#l80.13"></a><span id="l80.13" class="difflineplus">+interface nsIFile;</span>
<a href="#l80.14"></a><span id="l80.14"> interface nsIArray;</span>
<a href="#l80.15"></a><span id="l80.15"> </span>
<a href="#l80.16"></a><span id="l80.16"> typedef unsigned long nsMsgRetainByPreference;</span>
<a href="#l80.17"></a><span id="l80.17"> </span>
<a href="#l80.18"></a><span id="l80.18"> </span>
<a href="#l80.19"></a><span id="l80.19"> [scriptable, uuid(b01d6b3b-78c2-4958-b836-2259c76dbc24)]</span>
<a href="#l80.20"></a><span id="l80.20"> </span>
<a href="#l80.21"></a><span id="l80.21"> interface nsIMsgRetentionSettings : nsISupports</span>
<a href="#l80.22"></a><span id="l80.22" class="difflineat">@@ -193,17 +193,17 @@ interface nsIMsgDBService : nsISupports</span>
<a href="#l80.23"></a><span id="l80.23">    *                        is invalid.</span>
<a href="#l80.24"></a><span id="l80.24">    * @return                A new nsIMsgDatabase object encapsulating the file</span>
<a href="#l80.25"></a><span id="l80.25">    *                        passed in.</span>
<a href="#l80.26"></a><span id="l80.26">    * @exception NS_ERROR_FILE_TARGET_DOES_NOT_EXIST</span>
<a href="#l80.27"></a><span id="l80.27">    *                        The file could not be created.</span>
<a href="#l80.28"></a><span id="l80.28">    * @see nsIMsgDBService::openFolderDB</span>
<a href="#l80.29"></a><span id="l80.29">    * @see nsIMsgDatabase::Open</span>
<a href="#l80.30"></a><span id="l80.30">    */</span>
<a href="#l80.31"></a><span id="l80.31" class="difflineminus">-  nsIMsgDatabase openMailDBFromFile(in nsILocalFile aFile,</span>
<a href="#l80.32"></a><span id="l80.32" class="difflineplus">+  nsIMsgDatabase openMailDBFromFile(in nsIFile aFile,</span>
<a href="#l80.33"></a><span id="l80.33">                                     in nsIMsgFolder aFolder,</span>
<a href="#l80.34"></a><span id="l80.34">                                     in boolean aCreate,</span>
<a href="#l80.35"></a><span id="l80.35">                                     in boolean aLeaveInvalidDB);</span>
<a href="#l80.36"></a><span id="l80.36">   /**</span>
<a href="#l80.37"></a><span id="l80.37">    * Adds the given listener to the listener set for the folder.</span>
<a href="#l80.38"></a><span id="l80.38">    *</span>
<a href="#l80.39"></a><span id="l80.39">    * Since the message database will likely be opened and closed many times, by</span>
<a href="#l80.40"></a><span id="l80.40">    * registering using this method, one will be guaranteed to see all subsequent</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l81.1"></a><span id="l81.1" class="difflineminus">--- a/mailnews/db/msgdb/public/nsMailDatabase.h</span>
<a href="#l81.2"></a><span id="l81.2" class="difflineplus">+++ b/mailnews/db/msgdb/public/nsMailDatabase.h</span>
<a href="#l81.3"></a><span id="l81.3" class="difflineat">@@ -3,36 +3,36 @@</span>
<a href="#l81.4"></a><span id="l81.4">  * License, v. 2.0. If a copy of the MPL was not distributed with this</span>
<a href="#l81.5"></a><span id="l81.5">  * file, You can obtain one at http://mozilla.org/MPL/2.0/. */</span>
<a href="#l81.6"></a><span id="l81.6"> </span>
<a href="#l81.7"></a><span id="l81.7"> #ifndef _nsMailDatabase_H_</span>
<a href="#l81.8"></a><span id="l81.8"> #define _nsMailDatabase_H_</span>
<a href="#l81.9"></a><span id="l81.9"> </span>
<a href="#l81.10"></a><span id="l81.10"> #include &quot;nsMsgDatabase.h&quot;</span>
<a href="#l81.11"></a><span id="l81.11"> #include &quot;nsMsgMessageFlags.h&quot;</span>
<a href="#l81.12"></a><span id="l81.12" class="difflineminus">-#include &quot;nsILocalFile.h&quot;</span>
<a href="#l81.13"></a><span id="l81.13" class="difflineplus">+#include &quot;nsIFile.h&quot;</span>
<a href="#l81.14"></a><span id="l81.14"> #include &quot;nsTArray.h&quot;</span>
<a href="#l81.15"></a><span id="l81.15"> </span>
<a href="#l81.16"></a><span id="l81.16"> // This is the subclass of nsMsgDatabase that handles local mail messages.</span>
<a href="#l81.17"></a><span id="l81.17"> class nsIOFileStream;</span>
<a href="#l81.18"></a><span id="l81.18" class="difflineminus">-class nsILocalFile;</span>
<a href="#l81.19"></a><span id="l81.19" class="difflineplus">+class nsIFile;</span>
<a href="#l81.20"></a><span id="l81.20"> class nsOfflineImapOperation;</span>
<a href="#l81.21"></a><span id="l81.21"> </span>
<a href="#l81.22"></a><span id="l81.22"> class nsMailDatabase : public nsMsgDatabase</span>
<a href="#l81.23"></a><span id="l81.23"> {</span>
<a href="#l81.24"></a><span id="l81.24"> public:</span>
<a href="#l81.25"></a><span id="l81.25">   nsMailDatabase();</span>
<a href="#l81.26"></a><span id="l81.26">   virtual ~nsMailDatabase();</span>
<a href="#l81.27"></a><span id="l81.27">   NS_IMETHOD  ForceClosed();</span>
<a href="#l81.28"></a><span id="l81.28">   NS_IMETHOD DeleteMessages(PRUint32 aNumKeys, nsMsgKey* nsMsgKeys, nsIDBChangeListener *instigator);</span>
<a href="#l81.29"></a><span id="l81.29"> </span>
<a href="#l81.30"></a><span id="l81.30">   NS_IMETHOD StartBatch();</span>
<a href="#l81.31"></a><span id="l81.31">   NS_IMETHOD EndBatch();</span>
<a href="#l81.32"></a><span id="l81.32"> </span>
<a href="#l81.33"></a><span id="l81.33" class="difflineminus">-  nsresult  Open(nsILocalFile *aSummaryFile, bool create, bool upgrading);</span>
<a href="#l81.34"></a><span id="l81.34" class="difflineplus">+  nsresult  Open(nsIFile *aSummaryFile, bool create, bool upgrading);</span>
<a href="#l81.35"></a><span id="l81.35">   virtual nsMailDatabase  *GetMailDB() {return this;}</span>
<a href="#l81.36"></a><span id="l81.36"> </span>
<a href="#l81.37"></a><span id="l81.37">   virtual PRUint32  GetCurVersion() {return kMsgDBVersion;}</span>
<a href="#l81.38"></a><span id="l81.38">   </span>
<a href="#l81.39"></a><span id="l81.39">   NS_IMETHOD  GetOfflineOpForKey(nsMsgKey opKey, bool create, nsIMsgOfflineImapOperation **op);</span>
<a href="#l81.40"></a><span id="l81.40">   NS_IMETHOD  RemoveOfflineOp(nsIMsgOfflineImapOperation *op);</span>
<a href="#l81.41"></a><span id="l81.41"> </span>
<a href="#l81.42"></a><span id="l81.42">   NS_IMETHOD  SetSummaryValid(bool valid);</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l82.1"></a><span id="l82.1" class="difflineminus">--- a/mailnews/db/msgdb/public/nsMsgDatabase.h</span>
<a href="#l82.2"></a><span id="l82.2" class="difflineplus">+++ b/mailnews/db/msgdb/public/nsMsgDatabase.h</span>
<a href="#l82.3"></a><span id="l82.3" class="difflineat">@@ -119,24 +119,24 @@ public:</span>
<a href="#l82.4"></a><span id="l82.4">    *                        The file could not be created.</span>
<a href="#l82.5"></a><span id="l82.5">    * @exception NS_MSG_ERROR_FOLDER_SUMMARY_OUT_OF_DATE</span>
<a href="#l82.6"></a><span id="l82.6">    *                        The database is present (and was opened), but the</span>
<a href="#l82.7"></a><span id="l82.7">    *                        summary file is out of date.</span>
<a href="#l82.8"></a><span id="l82.8">    * @exception NS_MSG_ERROR_FOLDER_SUMMARY_MISSING</span>
<a href="#l82.9"></a><span id="l82.9">    *                        The database is present (and was opened), but the</span>
<a href="#l82.10"></a><span id="l82.10">    *                        summary file is missing.</span>
<a href="#l82.11"></a><span id="l82.11">    */</span>
<a href="#l82.12"></a><span id="l82.12" class="difflineminus">-  virtual nsresult Open(nsILocalFile *aFolderName, bool aCreate,</span>
<a href="#l82.13"></a><span id="l82.13" class="difflineplus">+  virtual nsresult Open(nsIFile *aFolderName, bool aCreate,</span>
<a href="#l82.14"></a><span id="l82.14">                         bool aLeaveInvalidDB);</span>
<a href="#l82.15"></a><span id="l82.15">   virtual nsresult IsHeaderRead(nsIMsgDBHdr *hdr, bool *pRead);</span>
<a href="#l82.16"></a><span id="l82.16">   virtual nsresult MarkHdrReadInDB(nsIMsgDBHdr *msgHdr, bool bRead,</span>
<a href="#l82.17"></a><span id="l82.17">                                nsIDBChangeListener *instigator);</span>
<a href="#l82.18"></a><span id="l82.18" class="difflineminus">-  nsresult OpenInternal(nsILocalFile *aFolderName, bool aCreate,</span>
<a href="#l82.19"></a><span id="l82.19" class="difflineplus">+  nsresult OpenInternal(nsIFile *aFolderName, bool aCreate,</span>
<a href="#l82.20"></a><span id="l82.20">                         bool aLeaveInvalidDB, bool sync);</span>
<a href="#l82.21"></a><span id="l82.21" class="difflineminus">-  nsresult CheckForErrors(nsresult err, bool sync, nsILocalFile *summaryFile);</span>
<a href="#l82.22"></a><span id="l82.22" class="difflineplus">+  nsresult CheckForErrors(nsresult err, bool sync, nsIFile *summaryFile);</span>
<a href="#l82.23"></a><span id="l82.23">   virtual nsresult OpenMDB(const char *dbName, bool create, bool sync);</span>
<a href="#l82.24"></a><span id="l82.24">   virtual nsresult CloseMDB(bool commit);</span>
<a href="#l82.25"></a><span id="l82.25">   virtual nsresult CreateMsgHdr(nsIMdbRow* hdrRow, nsMsgKey key, nsIMsgDBHdr **result);</span>
<a href="#l82.26"></a><span id="l82.26">   virtual nsresult GetThreadForMsgKey(nsMsgKey msgKey, nsIMsgThread **result);</span>
<a href="#l82.27"></a><span id="l82.27">   virtual nsresult EnumerateMessagesWithFlag(nsISimpleEnumerator* *result, PRUint32 *pFlag);</span>
<a href="#l82.28"></a><span id="l82.28">   nsresult         GetSearchResultsTable(const char *searchFolderUri, bool createIfMissing, nsIMdbTable **table);</span>
<a href="#l82.29"></a><span id="l82.29"> </span>
<a href="#l82.30"></a><span id="l82.30">   // this might just be for debugging - we'll see.</span>
<a href="#l82.31"></a><span id="l82.31" class="difflineat">@@ -152,17 +152,17 @@ public:</span>
<a href="#l82.32"></a><span id="l82.32">   virtual PRUint32      GetCurVersion();</span>
<a href="#l82.33"></a><span id="l82.33">   nsIMsgHeaderParser    *GetHeaderParser();</span>
<a href="#l82.34"></a><span id="l82.34">   nsresult              GetCollationKeyGenerator();</span>
<a href="#l82.35"></a><span id="l82.35">   nsIMimeConverter *    GetMimeConverter();</span>
<a href="#l82.36"></a><span id="l82.36"> </span>
<a href="#l82.37"></a><span id="l82.37">   nsresult GetTableCreateIfMissing(const char *scope, const char *kind, nsIMdbTable **table, </span>
<a href="#l82.38"></a><span id="l82.38">                                    mdb_token &amp;scopeToken, mdb_token &amp;kindToken);</span>
<a href="#l82.39"></a><span id="l82.39"> </span>
<a href="#l82.40"></a><span id="l82.40" class="difflineminus">-  static nsMsgDatabase* FindInCache(nsILocalFile *dbName);</span>
<a href="#l82.41"></a><span id="l82.41" class="difflineplus">+  static nsMsgDatabase* FindInCache(nsIFile *dbName);</span>
<a href="#l82.42"></a><span id="l82.42">   static nsIMsgDatabase* FindInCache(nsIMsgFolder *folder);</span>
<a href="#l82.43"></a><span id="l82.43"> </span>
<a href="#l82.44"></a><span id="l82.44">   //helper function to fill in nsStrings from hdr row cell contents.</span>
<a href="#l82.45"></a><span id="l82.45">   nsresult RowCellColumnTonsString(nsIMdbRow *row, mdb_token columnToken, nsAString &amp;resultStr);</span>
<a href="#l82.46"></a><span id="l82.46">   nsresult RowCellColumnToUInt32(nsIMdbRow *row, mdb_token columnToken, PRUint32 *uint32Result, PRUint32 defaultValue = 0);</span>
<a href="#l82.47"></a><span id="l82.47">   nsresult RowCellColumnToUInt32(nsIMdbRow *row, mdb_token columnToken, PRUint32 &amp;uint32Result, PRUint32 defaultValue = 0);</span>
<a href="#l82.48"></a><span id="l82.48">   nsresult RowCellColumnToUInt64(nsIMdbRow *row, mdb_token columnToken, PRUint64 *uint64Result, PRUint64 defaultValue = 0);</span>
<a href="#l82.49"></a><span id="l82.49">   nsresult RowCellColumnToMime2DecodedString(nsIMdbRow *row, mdb_token columnToken, nsAString &amp;resultStr);</span>
<a href="#l82.50"></a><span id="l82.50" class="difflineat">@@ -250,17 +250,17 @@ protected:</span>
<a href="#l82.51"></a><span id="l82.51"> #ifdef DEBUG</span>
<a href="#l82.52"></a><span id="l82.52">     nsCOMPtr&lt;nsIMsgDatabase&gt; msgDB = pMessageDB-&gt;m_folder ?</span>
<a href="#l82.53"></a><span id="l82.53">                                dont_AddRef(FindInCache(pMessageDB-&gt;m_folder)) : nsnull;</span>
<a href="#l82.54"></a><span id="l82.54">     NS_ASSERTION(!msgDB, &quot;shouldn't have db in cache&quot;);</span>
<a href="#l82.55"></a><span id="l82.55"> #endif</span>
<a href="#l82.56"></a><span id="l82.56">     GetDBCache()-&gt;AppendElement(pMessageDB);</span>
<a href="#l82.57"></a><span id="l82.57">   }</span>
<a href="#l82.58"></a><span id="l82.58">   static void    RemoveFromCache(nsMsgDatabase* pMessageDB);</span>
<a href="#l82.59"></a><span id="l82.59" class="difflineminus">-  bool    MatchDbName(nsILocalFile *dbName);  // returns TRUE if they match</span>
<a href="#l82.60"></a><span id="l82.60" class="difflineplus">+  bool    MatchDbName(nsIFile *dbName);  // returns TRUE if they match</span>
<a href="#l82.61"></a><span id="l82.61"> </span>
<a href="#l82.62"></a><span id="l82.62">   // Flag handling routines</span>
<a href="#l82.63"></a><span id="l82.63">   virtual nsresult SetKeyFlag(nsMsgKey key, bool set, PRUint32 flag,</span>
<a href="#l82.64"></a><span id="l82.64">                               nsIDBChangeListener *instigator = NULL);</span>
<a href="#l82.65"></a><span id="l82.65">   virtual nsresult SetMsgHdrFlag(nsIMsgDBHdr *msgHdr, bool set, PRUint32 flag, </span>
<a href="#l82.66"></a><span id="l82.66">                                  nsIDBChangeListener *instigator);</span>
<a href="#l82.67"></a><span id="l82.67">   </span>
<a href="#l82.68"></a><span id="l82.68">   virtual bool    SetHdrFlag(nsIMsgDBHdr *, bool bSet, nsMsgMessageFlagType flag);</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l83.1"></a><span id="l83.1" class="difflineminus">--- a/mailnews/db/msgdb/src/nsMailDatabase.cpp</span>
<a href="#l83.2"></a><span id="l83.2" class="difflineplus">+++ b/mailnews/db/msgdb/src/nsMailDatabase.cpp</span>
<a href="#l83.3"></a><span id="l83.3" class="difflineat">@@ -30,17 +30,17 @@ nsMailDatabase::nsMailDatabase() : m_rep</span>
<a href="#l83.4"></a><span id="l83.4"> </span>
<a href="#l83.5"></a><span id="l83.5"> nsMailDatabase::~nsMailDatabase()</span>
<a href="#l83.6"></a><span id="l83.6"> {</span>
<a href="#l83.7"></a><span id="l83.7"> }</span>
<a href="#l83.8"></a><span id="l83.8"> </span>
<a href="#l83.9"></a><span id="l83.9"> // caller passes in upgrading==true if they want back a db even if the db is out of date.</span>
<a href="#l83.10"></a><span id="l83.10"> // If so, they'll extract out the interesting info from the db, close it, delete it, and</span>
<a href="#l83.11"></a><span id="l83.11"> // then try to open the db again, prior to reparsing.</span>
<a href="#l83.12"></a><span id="l83.12" class="difflineminus">-nsresult nsMailDatabase::Open(nsILocalFile *aSummaryFile, bool aCreate,</span>
<a href="#l83.13"></a><span id="l83.13" class="difflineplus">+nsresult nsMailDatabase::Open(nsIFile *aSummaryFile, bool aCreate,</span>
<a href="#l83.14"></a><span id="l83.14">                               bool aUpgrading)</span>
<a href="#l83.15"></a><span id="l83.15"> {</span>
<a href="#l83.16"></a><span id="l83.16"> #ifdef DEBUG</span>
<a href="#l83.17"></a><span id="l83.17">   nsString leafName;</span>
<a href="#l83.18"></a><span id="l83.18">   aSummaryFile-&gt;GetLeafName(leafName);</span>
<a href="#l83.19"></a><span id="l83.19">   if (!StringEndsWith(leafName, NS_LITERAL_STRING(&quot;.msf&quot;),</span>
<a href="#l83.20"></a><span id="l83.20">                      nsCaseInsensitiveStringComparator()))</span>
<a href="#l83.21"></a><span id="l83.21">     NS_ERROR(&quot;non summary file passed into open\n&quot;);</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l84.1"></a><span id="l84.1" class="difflineminus">--- a/mailnews/db/msgdb/src/nsMsgDatabase.cpp</span>
<a href="#l84.2"></a><span id="l84.2" class="difflineplus">+++ b/mailnews/db/msgdb/src/nsMsgDatabase.cpp</span>
<a href="#l84.3"></a><span id="l84.3" class="difflineat">@@ -87,17 +87,17 @@ nsMsgDBService::~nsMsgDBService()</span>
<a href="#l84.4"></a><span id="l84.4"> </span>
<a href="#l84.5"></a><span id="l84.5"> NS_IMETHODIMP nsMsgDBService::OpenFolderDB(nsIMsgFolder *aFolder,</span>
<a href="#l84.6"></a><span id="l84.6">                                            bool aLeaveInvalidDB,</span>
<a href="#l84.7"></a><span id="l84.7">                                            nsIMsgDatabase **_retval)</span>
<a href="#l84.8"></a><span id="l84.8"> {</span>
<a href="#l84.9"></a><span id="l84.9">   NS_ENSURE_ARG(aFolder);</span>
<a href="#l84.10"></a><span id="l84.10">   nsCOMPtr&lt;nsIMsgPluggableStore&gt; msgStore;</span>
<a href="#l84.11"></a><span id="l84.11">   nsCOMPtr&lt;nsIMsgIncomingServer&gt; incomingServer;</span>
<a href="#l84.12"></a><span id="l84.12" class="difflineminus">-  nsCOMPtr &lt;nsILocalFile&gt; summaryFilePath;</span>
<a href="#l84.13"></a><span id="l84.13" class="difflineplus">+  nsCOMPtr &lt;nsIFile&gt; summaryFilePath;</span>
<a href="#l84.14"></a><span id="l84.14"> </span>
<a href="#l84.15"></a><span id="l84.15">   nsresult rv = aFolder-&gt;GetServer(getter_AddRefs(incomingServer));</span>
<a href="#l84.16"></a><span id="l84.16">   NS_ENSURE_SUCCESS(rv, rv);</span>
<a href="#l84.17"></a><span id="l84.17">   rv = aFolder-&gt;GetMsgStore(getter_AddRefs(msgStore));</span>
<a href="#l84.18"></a><span id="l84.18">   NS_ENSURE_SUCCESS(rv, rv);</span>
<a href="#l84.19"></a><span id="l84.19">   rv = msgStore-&gt;GetSummaryFile(aFolder, getter_AddRefs(summaryFilePath));</span>
<a href="#l84.20"></a><span id="l84.20">   NS_ENSURE_SUCCESS(rv, rv);</span>
<a href="#l84.21"></a><span id="l84.21"> </span>
<a href="#l84.22"></a><span id="l84.22" class="difflineat">@@ -170,17 +170,17 @@ NS_IMETHODIMP nsMsgDBService::AsyncOpenF</span>
<a href="#l84.23"></a><span id="l84.23">     // We don't care if an other consumer is thumbing the store. In that</span>
<a href="#l84.24"></a><span id="l84.24">     // case, they'll both thumb the store.</span>
<a href="#l84.25"></a><span id="l84.25">     return NS_OK;</span>
<a href="#l84.26"></a><span id="l84.26">   }</span>
<a href="#l84.27"></a><span id="l84.27"> </span>
<a href="#l84.28"></a><span id="l84.28">   nsCOMPtr&lt;nsIMsgPluggableStore&gt; msgStore;</span>
<a href="#l84.29"></a><span id="l84.29">   nsresult rv = aFolder-&gt;GetMsgStore(getter_AddRefs(msgStore));</span>
<a href="#l84.30"></a><span id="l84.30">   NS_ENSURE_SUCCESS(rv, rv);</span>
<a href="#l84.31"></a><span id="l84.31" class="difflineminus">-  nsCOMPtr &lt;nsILocalFile&gt; summaryFilePath;</span>
<a href="#l84.32"></a><span id="l84.32" class="difflineplus">+  nsCOMPtr &lt;nsIFile&gt; summaryFilePath;</span>
<a href="#l84.33"></a><span id="l84.33">   rv = msgStore-&gt;GetSummaryFile(aFolder, getter_AddRefs(summaryFilePath));</span>
<a href="#l84.34"></a><span id="l84.34">   NS_ENSURE_SUCCESS(rv, rv);</span>
<a href="#l84.35"></a><span id="l84.35"> </span>
<a href="#l84.36"></a><span id="l84.36">   nsCOMPtr &lt;nsIMsgIncomingServer&gt; incomingServer;</span>
<a href="#l84.37"></a><span id="l84.37">   rv = aFolder-&gt;GetServer(getter_AddRefs(incomingServer));</span>
<a href="#l84.38"></a><span id="l84.38">   NS_ENSURE_SUCCESS(rv, rv);</span>
<a href="#l84.39"></a><span id="l84.39">   nsCString localStoreType;</span>
<a href="#l84.40"></a><span id="l84.40">   incomingServer-&gt;GetLocalStoreType(localStoreType);</span>
<a href="#l84.41"></a><span id="l84.41" class="difflineat">@@ -246,19 +246,19 @@ NS_IMETHODIMP nsMsgDBService::OpenMore(n</span>
<a href="#l84.42"></a><span id="l84.42">       break;</span>
<a href="#l84.43"></a><span id="l84.43">     if (outDone)</span>
<a href="#l84.44"></a><span id="l84.44">     {</span>
<a href="#l84.45"></a><span id="l84.45">       nsCOMPtr&lt;nsIMdbFactory&gt; mdbFactory;</span>
<a href="#l84.46"></a><span id="l84.46">       msgDatabase-&gt;GetMDBFactory(getter_AddRefs(mdbFactory));</span>
<a href="#l84.47"></a><span id="l84.47">       NS_ENSURE_TRUE(mdbFactory, NS_ERROR_FAILURE);</span>
<a href="#l84.48"></a><span id="l84.48">       ret = mdbFactory-&gt;ThumbToOpenStore(msgDatabase-&gt;m_mdbEnv, msgDatabase-&gt;m_thumb, &amp;msgDatabase-&gt;m_mdbStore);</span>
<a href="#l84.49"></a><span id="l84.49">       msgDatabase-&gt;m_thumb = nsnull;</span>
<a href="#l84.50"></a><span id="l84.50" class="difflineminus">-      nsCOMPtr&lt;nsILocalFile&gt; folderPath;</span>
<a href="#l84.51"></a><span id="l84.51" class="difflineplus">+      nsCOMPtr&lt;nsIFile&gt; folderPath;</span>
<a href="#l84.52"></a><span id="l84.52">       nsresult rv = msgDatabase-&gt;m_folder-&gt;GetFilePath(getter_AddRefs(folderPath));</span>
<a href="#l84.53"></a><span id="l84.53" class="difflineminus">-      nsCOMPtr &lt;nsILocalFile&gt; summaryFile;</span>
<a href="#l84.54"></a><span id="l84.54" class="difflineplus">+      nsCOMPtr &lt;nsIFile&gt; summaryFile;</span>
<a href="#l84.55"></a><span id="l84.55">       rv = GetSummaryFileLocation(folderPath, getter_AddRefs(summaryFile));</span>
<a href="#l84.56"></a><span id="l84.56"> </span>
<a href="#l84.57"></a><span id="l84.57">       if (NS_SUCCEEDED(ret))</span>
<a href="#l84.58"></a><span id="l84.58">         ret = (msgDatabase-&gt;m_mdbStore) ? msgDatabase-&gt;InitExistingDB() : NS_ERROR_FAILURE;</span>
<a href="#l84.59"></a><span id="l84.59">       if (NS_SUCCEEDED(ret))</span>
<a href="#l84.60"></a><span id="l84.60">         ret = msgDatabase-&gt;CheckForErrors(ret, false, summaryFile);</span>
<a href="#l84.61"></a><span id="l84.61"> </span>
<a href="#l84.62"></a><span id="l84.62">       FinishDBOpen(msgDatabase-&gt;m_folder, msgDatabase);</span>
<a href="#l84.63"></a><span id="l84.63" class="difflineat">@@ -308,26 +308,26 @@ void nsMsgDBService::FinishDBOpen(nsIMsg</span>
<a href="#l84.64"></a><span id="l84.64">   HookupPendingListeners(aMsgDB, aFolder);</span>
<a href="#l84.65"></a><span id="l84.65">   aMsgDB-&gt;RememberLastUseTime();</span>
<a href="#l84.66"></a><span id="l84.66"> }</span>
<a href="#l84.67"></a><span id="l84.67"> </span>
<a href="#l84.68"></a><span id="l84.68"> // This method is called when the caller is trying to create a db without</span>
<a href="#l84.69"></a><span id="l84.69"> // having a corresponding nsIMsgFolder object.  This happens in a few</span>
<a href="#l84.70"></a><span id="l84.70"> // situations, including imap folder discovery, compacting local folders,</span>
<a href="#l84.71"></a><span id="l84.71"> // and copying local folders.</span>
<a href="#l84.72"></a><span id="l84.72" class="difflineminus">-NS_IMETHODIMP nsMsgDBService::OpenMailDBFromFile(nsILocalFile *aFolderName,</span>
<a href="#l84.73"></a><span id="l84.73" class="difflineplus">+NS_IMETHODIMP nsMsgDBService::OpenMailDBFromFile(nsIFile *aFolderName,</span>
<a href="#l84.74"></a><span id="l84.74">                                                  nsIMsgFolder *aFolder,</span>
<a href="#l84.75"></a><span id="l84.75">                                                  bool aCreate,</span>
<a href="#l84.76"></a><span id="l84.76">                                                  bool aLeaveInvalidDB,</span>
<a href="#l84.77"></a><span id="l84.77">                                                  nsIMsgDatabase** pMessageDB)</span>
<a href="#l84.78"></a><span id="l84.78"> {</span>
<a href="#l84.79"></a><span id="l84.79">   if (!aFolderName)</span>
<a href="#l84.80"></a><span id="l84.80">     return NS_ERROR_NULL_POINTER;</span>
<a href="#l84.81"></a><span id="l84.81"> </span>
<a href="#l84.82"></a><span id="l84.82" class="difflineminus">-  nsCOMPtr &lt;nsILocalFile&gt;  dbPath;</span>
<a href="#l84.83"></a><span id="l84.83" class="difflineplus">+  nsCOMPtr &lt;nsIFile&gt;  dbPath;</span>
<a href="#l84.84"></a><span id="l84.84">   nsresult rv = GetSummaryFileLocation(aFolderName, getter_AddRefs(dbPath));</span>
<a href="#l84.85"></a><span id="l84.85">   NS_ENSURE_SUCCESS(rv, rv);</span>
<a href="#l84.86"></a><span id="l84.86"> </span>
<a href="#l84.87"></a><span id="l84.87">   *pMessageDB = (nsMsgDatabase *) nsMsgDatabase::FindInCache(dbPath);</span>
<a href="#l84.88"></a><span id="l84.88">   if (*pMessageDB)</span>
<a href="#l84.89"></a><span id="l84.89">     return NS_OK;</span>
<a href="#l84.90"></a><span id="l84.90"> </span>
<a href="#l84.91"></a><span id="l84.91">   nsRefPtr&lt;nsMailDatabase&gt; msgDB = new nsMailDatabase;</span>
<a href="#l84.92"></a><span id="l84.92" class="difflineat">@@ -350,17 +350,17 @@ NS_IMETHODIMP nsMsgDBService::CreateNewD</span>
<a href="#l84.93"></a><span id="l84.93">   </span>
<a href="#l84.94"></a><span id="l84.94">   nsCOMPtr &lt;nsIMsgIncomingServer&gt; incomingServer;</span>
<a href="#l84.95"></a><span id="l84.95">   nsresult rv = aFolder-&gt;GetServer(getter_AddRefs(incomingServer));</span>
<a href="#l84.96"></a><span id="l84.96">   NS_ENSURE_SUCCESS(rv, rv);</span>
<a href="#l84.97"></a><span id="l84.97"> </span>
<a href="#l84.98"></a><span id="l84.98">   nsCOMPtr&lt;nsIMsgPluggableStore&gt; msgStore;</span>
<a href="#l84.99"></a><span id="l84.99">   rv = aFolder-&gt;GetMsgStore(getter_AddRefs(msgStore));</span>
<a href="#l84.100"></a><span id="l84.100">   NS_ENSURE_SUCCESS(rv, rv);</span>
<a href="#l84.101"></a><span id="l84.101" class="difflineminus">-  nsCOMPtr&lt;nsILocalFile&gt; summaryFilePath;</span>
<a href="#l84.102"></a><span id="l84.102" class="difflineplus">+  nsCOMPtr&lt;nsIFile&gt; summaryFilePath;</span>
<a href="#l84.103"></a><span id="l84.103">   rv = msgStore-&gt;GetSummaryFile(aFolder, getter_AddRefs(summaryFilePath));</span>
<a href="#l84.104"></a><span id="l84.104">   NS_ENSURE_SUCCESS(rv, rv);</span>
<a href="#l84.105"></a><span id="l84.105"> </span>
<a href="#l84.106"></a><span id="l84.106">   nsCString localStoreType;</span>
<a href="#l84.107"></a><span id="l84.107">   incomingServer-&gt;GetLocalStoreType(localStoreType);</span>
<a href="#l84.108"></a><span id="l84.108">   nsCAutoString dbContractID(NS_MSGDB_CONTRACTID);</span>
<a href="#l84.109"></a><span id="l84.109">   dbContractID.Append(localStoreType.get());</span>
<a href="#l84.110"></a><span id="l84.110">   </span>
<a href="#l84.111"></a><span id="l84.111" class="difflineat">@@ -921,17 +921,17 @@ nsMsgDatabase::CleanupCache()</span>
<a href="#l84.112"></a><span id="l84.112">     delete m_dbCache;</span>
<a href="#l84.113"></a><span id="l84.113">     m_dbCache = nsnull;</span>
<a href="#l84.114"></a><span id="l84.114">   }</span>
<a href="#l84.115"></a><span id="l84.115"> }</span>
<a href="#l84.116"></a><span id="l84.116"> </span>
<a href="#l84.117"></a><span id="l84.117"> //----------------------------------------------------------------------</span>
<a href="#l84.118"></a><span id="l84.118"> // FindInCache - this addrefs the db it finds.</span>
<a href="#l84.119"></a><span id="l84.119"> //----------------------------------------------------------------------</span>
<a href="#l84.120"></a><span id="l84.120" class="difflineminus">-nsMsgDatabase* nsMsgDatabase::FindInCache(nsILocalFile *dbName)</span>
<a href="#l84.121"></a><span id="l84.121" class="difflineplus">+nsMsgDatabase* nsMsgDatabase::FindInCache(nsIFile *dbName)</span>
<a href="#l84.122"></a><span id="l84.122"> {</span>
<a href="#l84.123"></a><span id="l84.123">   nsTArray&lt;nsMsgDatabase*&gt;* dbCache = GetDBCache();</span>
<a href="#l84.124"></a><span id="l84.124">   PRUint32 length = dbCache-&gt;Length();</span>
<a href="#l84.125"></a><span id="l84.125">   for (PRUint32 i = 0; i &lt; length; i++)</span>
<a href="#l84.126"></a><span id="l84.126">   {</span>
<a href="#l84.127"></a><span id="l84.127">     nsMsgDatabase* pMessageDB = dbCache-&gt;ElementAt(i);</span>
<a href="#l84.128"></a><span id="l84.128">     if (pMessageDB-&gt;MatchDbName(dbName))</span>
<a href="#l84.129"></a><span id="l84.129">     {</span>
<a href="#l84.130"></a><span id="l84.130" class="difflineat">@@ -945,29 +945,29 @@ nsMsgDatabase* nsMsgDatabase::FindInCach</span>
<a href="#l84.131"></a><span id="l84.131">   return nsnull;</span>
<a href="#l84.132"></a><span id="l84.132"> }</span>
<a href="#l84.133"></a><span id="l84.133"> </span>
<a href="#l84.134"></a><span id="l84.134"> //----------------------------------------------------------------------</span>
<a href="#l84.135"></a><span id="l84.135"> // FindInCache(nsIMsgFolder) - this addrefs the db it finds.</span>
<a href="#l84.136"></a><span id="l84.136"> //----------------------------------------------------------------------</span>
<a href="#l84.137"></a><span id="l84.137"> nsIMsgDatabase* nsMsgDatabase::FindInCache(nsIMsgFolder *folder)</span>
<a href="#l84.138"></a><span id="l84.138"> {</span>
<a href="#l84.139"></a><span id="l84.139" class="difflineminus">-  nsCOMPtr&lt;nsILocalFile&gt; folderPath;</span>
<a href="#l84.140"></a><span id="l84.140" class="difflineplus">+  nsCOMPtr&lt;nsIFile&gt; folderPath;</span>
<a href="#l84.141"></a><span id="l84.141"> </span>
<a href="#l84.142"></a><span id="l84.142">   nsresult rv = folder-&gt;GetFilePath(getter_AddRefs(folderPath));</span>
<a href="#l84.143"></a><span id="l84.143">   NS_ENSURE_SUCCESS(rv, nsnull);</span>
<a href="#l84.144"></a><span id="l84.144"> </span>
<a href="#l84.145"></a><span id="l84.145" class="difflineminus">-  nsCOMPtr &lt;nsILocalFile&gt; summaryFile;</span>
<a href="#l84.146"></a><span id="l84.146" class="difflineplus">+  nsCOMPtr &lt;nsIFile&gt; summaryFile;</span>
<a href="#l84.147"></a><span id="l84.147">   rv = GetSummaryFileLocation(folderPath, getter_AddRefs(summaryFile));</span>
<a href="#l84.148"></a><span id="l84.148">   NS_ENSURE_SUCCESS(rv, nsnull);</span>
<a href="#l84.149"></a><span id="l84.149"> </span>
<a href="#l84.150"></a><span id="l84.150">   return (nsIMsgDatabase *) FindInCache(summaryFile);</span>
<a href="#l84.151"></a><span id="l84.151"> }</span>
<a href="#l84.152"></a><span id="l84.152"> </span>
<a href="#l84.153"></a><span id="l84.153" class="difflineminus">-bool nsMsgDatabase::MatchDbName(nsILocalFile *dbName)  // returns true if they match</span>
<a href="#l84.154"></a><span id="l84.154" class="difflineplus">+bool nsMsgDatabase::MatchDbName(nsIFile *dbName)  // returns true if they match</span>
<a href="#l84.155"></a><span id="l84.155"> {</span>
<a href="#l84.156"></a><span id="l84.156">   nsCString dbPath;</span>
<a href="#l84.157"></a><span id="l84.157">   dbName-&gt;GetNativePath(dbPath);</span>
<a href="#l84.158"></a><span id="l84.158">   return dbPath.Equals(m_dbName);</span>
<a href="#l84.159"></a><span id="l84.159"> }</span>
<a href="#l84.160"></a><span id="l84.160"> </span>
<a href="#l84.161"></a><span id="l84.161"> //----------------------------------------------------------------------</span>
<a href="#l84.162"></a><span id="l84.162"> // RemoveFromCache</span>
<a href="#l84.163"></a><span id="l84.163" class="difflineat">@@ -1101,24 +1101,24 @@ void nsMsgDatabase::GetMDBFactory(nsIMdb</span>
<a href="#l84.164"></a><span id="l84.164">       mdbFactoryService-&gt;GetMdbFactory(getter_AddRefs(mMdbFactory));</span>
<a href="#l84.165"></a><span id="l84.165">   }</span>
<a href="#l84.166"></a><span id="l84.166">   NS_IF_ADDREF(*aMdbFactory = mMdbFactory);</span>
<a href="#l84.167"></a><span id="l84.167"> }</span>
<a href="#l84.168"></a><span id="l84.168"> </span>
<a href="#l84.169"></a><span id="l84.169"> // aLeaveInvalidDB: true if caller wants back a db even out of date.</span>
<a href="#l84.170"></a><span id="l84.170"> // If so, they'll extract out the interesting info from the db, close it,</span>
<a href="#l84.171"></a><span id="l84.171"> // delete it, and then try to open the db again, prior to reparsing.</span>
<a href="#l84.172"></a><span id="l84.172" class="difflineminus">-nsresult nsMsgDatabase::Open(nsILocalFile *aFolderName, bool aCreate,</span>
<a href="#l84.173"></a><span id="l84.173" class="difflineplus">+nsresult nsMsgDatabase::Open(nsIFile *aFolderName, bool aCreate,</span>
<a href="#l84.174"></a><span id="l84.174">                              bool aLeaveInvalidDB)</span>
<a href="#l84.175"></a><span id="l84.175"> {</span>
<a href="#l84.176"></a><span id="l84.176">   return nsMsgDatabase::OpenInternal(aFolderName, aCreate, aLeaveInvalidDB,</span>
<a href="#l84.177"></a><span id="l84.177">                                      true /* open synchronously */);</span>
<a href="#l84.178"></a><span id="l84.178"> }</span>
<a href="#l84.179"></a><span id="l84.179"> </span>
<a href="#l84.180"></a><span id="l84.180" class="difflineminus">-nsresult nsMsgDatabase::OpenInternal(nsILocalFile *summaryFile, bool aCreate,</span>
<a href="#l84.181"></a><span id="l84.181" class="difflineplus">+nsresult nsMsgDatabase::OpenInternal(nsIFile *summaryFile, bool aCreate,</span>
<a href="#l84.182"></a><span id="l84.182">                                      bool aLeaveInvalidDB, bool sync)</span>
<a href="#l84.183"></a><span id="l84.183"> {</span>
<a href="#l84.184"></a><span id="l84.184">   nsCAutoString summaryFilePath;</span>
<a href="#l84.185"></a><span id="l84.185">   summaryFile-&gt;GetNativePath(summaryFilePath);</span>
<a href="#l84.186"></a><span id="l84.186"> </span>
<a href="#l84.187"></a><span id="l84.187">   PR_LOG(DBLog, PR_LOG_ALWAYS, (&quot;nsMsgDatabase::Open(%s, %s, %p, %s)\n&quot;,</span>
<a href="#l84.188"></a><span id="l84.188">     (const char*)summaryFilePath.get(), aCreate ? &quot;TRUE&quot;:&quot;FALSE&quot;,</span>
<a href="#l84.189"></a><span id="l84.189">     this, aLeaveInvalidDB ? &quot;TRUE&quot;:&quot;FALSE&quot;));</span>
<a href="#l84.190"></a><span id="l84.190" class="difflineat">@@ -1141,17 +1141,17 @@ nsresult nsMsgDatabase::OpenInternal(nsI</span>
<a href="#l84.191"></a><span id="l84.191">     AddToCache(this);</span>
<a href="#l84.192"></a><span id="l84.192">     // remember open options for when the parsing is complete.</span>
<a href="#l84.193"></a><span id="l84.193">     return rv;</span>
<a href="#l84.194"></a><span id="l84.194">   }</span>
<a href="#l84.195"></a><span id="l84.195">   return CheckForErrors(rv, true, summaryFile);</span>
<a href="#l84.196"></a><span id="l84.196"> }</span>
<a href="#l84.197"></a><span id="l84.197"> </span>
<a href="#l84.198"></a><span id="l84.198"> nsresult nsMsgDatabase::CheckForErrors(nsresult err, bool sync,</span>
<a href="#l84.199"></a><span id="l84.199" class="difflineminus">-                                       nsILocalFile *summaryFile)</span>
<a href="#l84.200"></a><span id="l84.200" class="difflineplus">+                                       nsIFile *summaryFile)</span>
<a href="#l84.201"></a><span id="l84.201"> {</span>
<a href="#l84.202"></a><span id="l84.202">   nsCOMPtr&lt;nsIDBFolderInfo&gt; folderInfo;</span>
<a href="#l84.203"></a><span id="l84.203">   bool summaryFileExists;</span>
<a href="#l84.204"></a><span id="l84.204">   bool newFile = false;</span>
<a href="#l84.205"></a><span id="l84.205">   bool deleteInvalidDB = false;</span>
<a href="#l84.206"></a><span id="l84.206"> </span>
<a href="#l84.207"></a><span id="l84.207">   bool exists;</span>
<a href="#l84.208"></a><span id="l84.208">   PRInt64 fileSize;</span>
<a href="#l84.209"></a><span id="l84.209" class="difflineat">@@ -1344,21 +1344,21 @@ nsresult nsMsgDatabase::CloseMDB(bool co</span>
<a href="#l84.210"></a><span id="l84.210">     Commit(nsMsgDBCommitType::kSessionCommit);</span>
<a href="#l84.211"></a><span id="l84.211">   return(NS_OK);</span>
<a href="#l84.212"></a><span id="l84.212"> }</span>
<a href="#l84.213"></a><span id="l84.213"> </span>
<a href="#l84.214"></a><span id="l84.214"> NS_IMETHODIMP nsMsgDatabase::ForceFolderDBClosed(nsIMsgFolder *aFolder)</span>
<a href="#l84.215"></a><span id="l84.215"> {</span>
<a href="#l84.216"></a><span id="l84.216">   NS_ENSURE_ARG(aFolder);</span>
<a href="#l84.217"></a><span id="l84.217"> </span>
<a href="#l84.218"></a><span id="l84.218" class="difflineminus">-  nsCOMPtr&lt;nsILocalFile&gt; folderPath;</span>
<a href="#l84.219"></a><span id="l84.219" class="difflineplus">+  nsCOMPtr&lt;nsIFile&gt; folderPath;</span>
<a href="#l84.220"></a><span id="l84.220">   nsresult rv = aFolder-&gt;GetFilePath(getter_AddRefs(folderPath));</span>
<a href="#l84.221"></a><span id="l84.221">   NS_ENSURE_SUCCESS(rv, rv);</span>
<a href="#l84.222"></a><span id="l84.222"> </span>
<a href="#l84.223"></a><span id="l84.223" class="difflineminus">-  nsCOMPtr &lt;nsILocalFile&gt; dbPath;</span>
<a href="#l84.224"></a><span id="l84.224" class="difflineplus">+  nsCOMPtr &lt;nsIFile&gt; dbPath;</span>
<a href="#l84.225"></a><span id="l84.225">   rv = GetSummaryFileLocation(folderPath, getter_AddRefs(dbPath));</span>
<a href="#l84.226"></a><span id="l84.226">   NS_ENSURE_SUCCESS(rv, rv);</span>
<a href="#l84.227"></a><span id="l84.227"> </span>
<a href="#l84.228"></a><span id="l84.228">   nsIMsgDatabase *mailDB = (nsMsgDatabase *) FindInCache(dbPath);</span>
<a href="#l84.229"></a><span id="l84.229">   if (mailDB)</span>
<a href="#l84.230"></a><span id="l84.230">   {</span>
<a href="#l84.231"></a><span id="l84.231">     mailDB-&gt;ForceClosed();</span>
<a href="#l84.232"></a><span id="l84.232">    //FindInCache AddRef's</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l85.1"></a><span id="l85.1" class="difflineminus">--- a/mailnews/extensions/bayesian-spam-filter/src/nsBayesianFilter.cpp</span>
<a href="#l85.2"></a><span id="l85.2" class="difflineplus">+++ b/mailnews/extensions/bayesian-spam-filter/src/nsBayesianFilter.cpp</span>
<a href="#l85.3"></a><span id="l85.3" class="difflineat">@@ -2191,17 +2191,17 @@ NS_IMETHODIMP nsBayesianFilter::CorpusCo</span>
<a href="#l85.4"></a><span id="l85.4"> }</span>
<a href="#l85.5"></a><span id="l85.5"> </span>
<a href="#l85.6"></a><span id="l85.6"> NS_IMETHODIMP nsBayesianFilter::ClearTrait(PRUint32 aTrait)</span>
<a href="#l85.7"></a><span id="l85.7"> {</span>
<a href="#l85.8"></a><span id="l85.8">     return mCorpus.ClearTrait(aTrait);</span>
<a href="#l85.9"></a><span id="l85.9"> }</span>
<a href="#l85.10"></a><span id="l85.10"> </span>
<a href="#l85.11"></a><span id="l85.11"> NS_IMETHODIMP</span>
<a href="#l85.12"></a><span id="l85.12" class="difflineminus">-nsBayesianFilter::UpdateData(nsILocalFile *aFile,</span>
<a href="#l85.13"></a><span id="l85.13" class="difflineplus">+nsBayesianFilter::UpdateData(nsIFile *aFile,</span>
<a href="#l85.14"></a><span id="l85.14">                              bool aIsAdd,</span>
<a href="#l85.15"></a><span id="l85.15">                              PRUint32 aRemapCount,</span>
<a href="#l85.16"></a><span id="l85.16">                              PRUint32 *aFromTraits,</span>
<a href="#l85.17"></a><span id="l85.17">                              PRUint32 *aToTraits)</span>
<a href="#l85.18"></a><span id="l85.18"> {</span>
<a href="#l85.19"></a><span id="l85.19">   return mCorpus.UpdateData(aFile, aIsAdd, aRemapCount, aFromTraits, aToTraits);</span>
<a href="#l85.20"></a><span id="l85.20"> }</span>
<a href="#l85.21"></a><span id="l85.21"> </span>
<a href="#l85.22"></a><span id="l85.22" class="difflineat">@@ -2389,41 +2389,41 @@ bool CorpusStore::readTokens(FILE* strea</span>
<a href="#l85.23"></a><span id="l85.23">           remove(buffer, aTraitId, count);</span>
<a href="#l85.24"></a><span id="l85.24">     }</span>
<a href="#l85.25"></a><span id="l85.25"> </span>
<a href="#l85.26"></a><span id="l85.26">     delete[] buffer;</span>
<a href="#l85.27"></a><span id="l85.27"> </span>
<a href="#l85.28"></a><span id="l85.28">     return true;</span>
<a href="#l85.29"></a><span id="l85.29"> }</span>
<a href="#l85.30"></a><span id="l85.30"> </span>
<a href="#l85.31"></a><span id="l85.31" class="difflineminus">-nsresult CorpusStore::getTrainingFile(nsILocalFile ** aTrainingFile)</span>
<a href="#l85.32"></a><span id="l85.32" class="difflineplus">+nsresult CorpusStore::getTrainingFile(nsIFile ** aTrainingFile)</span>
<a href="#l85.33"></a><span id="l85.33"> {</span>
<a href="#l85.34"></a><span id="l85.34">   // should we cache the profile manager's directory?</span>
<a href="#l85.35"></a><span id="l85.35">   nsCOMPtr&lt;nsIFile&gt; profileDir;</span>
<a href="#l85.36"></a><span id="l85.36"> </span>
<a href="#l85.37"></a><span id="l85.37">   nsresult rv = NS_GetSpecialDirectory(NS_APP_USER_PROFILE_50_DIR, getter_AddRefs(profileDir));</span>
<a href="#l85.38"></a><span id="l85.38">   NS_ENSURE_SUCCESS(rv, rv);</span>
<a href="#l85.39"></a><span id="l85.39">   rv = profileDir-&gt;Append(NS_LITERAL_STRING(&quot;training.dat&quot;));</span>
<a href="#l85.40"></a><span id="l85.40">   NS_ENSURE_SUCCESS(rv, rv);</span>
<a href="#l85.41"></a><span id="l85.41"> </span>
<a href="#l85.42"></a><span id="l85.42" class="difflineminus">-  return profileDir-&gt;QueryInterface(NS_GET_IID(nsILocalFile), (void **) aTrainingFile);</span>
<a href="#l85.43"></a><span id="l85.43" class="difflineplus">+  return profileDir-&gt;QueryInterface(NS_GET_IID(nsIFile), (void **) aTrainingFile);</span>
<a href="#l85.44"></a><span id="l85.44"> }</span>
<a href="#l85.45"></a><span id="l85.45"> </span>
<a href="#l85.46"></a><span id="l85.46" class="difflineminus">-nsresult CorpusStore::getTraitFile(nsILocalFile ** aTraitFile)</span>
<a href="#l85.47"></a><span id="l85.47" class="difflineplus">+nsresult CorpusStore::getTraitFile(nsIFile ** aTraitFile)</span>
<a href="#l85.48"></a><span id="l85.48"> {</span>
<a href="#l85.49"></a><span id="l85.49">   // should we cache the profile manager's directory?</span>
<a href="#l85.50"></a><span id="l85.50">   nsCOMPtr&lt;nsIFile&gt; profileDir;</span>
<a href="#l85.51"></a><span id="l85.51"> </span>
<a href="#l85.52"></a><span id="l85.52">   nsresult rv = NS_GetSpecialDirectory(NS_APP_USER_PROFILE_50_DIR, getter_AddRefs(profileDir));</span>
<a href="#l85.53"></a><span id="l85.53">   NS_ENSURE_SUCCESS(rv, rv);</span>
<a href="#l85.54"></a><span id="l85.54"> </span>
<a href="#l85.55"></a><span id="l85.55">   rv = profileDir-&gt;Append(NS_LITERAL_STRING(&quot;traits.dat&quot;));</span>
<a href="#l85.56"></a><span id="l85.56">   NS_ENSURE_SUCCESS(rv, rv);</span>
<a href="#l85.57"></a><span id="l85.57"> </span>
<a href="#l85.58"></a><span id="l85.58" class="difflineminus">-  return profileDir-&gt;QueryInterface(NS_GET_IID(nsILocalFile), (void **) aTraitFile);</span>
<a href="#l85.59"></a><span id="l85.59" class="difflineplus">+  return profileDir-&gt;QueryInterface(NS_GET_IID(nsIFile), (void **) aTraitFile);</span>
<a href="#l85.60"></a><span id="l85.60"> }</span>
<a href="#l85.61"></a><span id="l85.61"> </span>
<a href="#l85.62"></a><span id="l85.62"> static const char kMagicCookie[] = { '\xFE', '\xED', '\xFA', '\xCE' };</span>
<a href="#l85.63"></a><span id="l85.63"> </span>
<a href="#l85.64"></a><span id="l85.64"> // random string used to identify trait file and version (last byte is version)</span>
<a href="#l85.65"></a><span id="l85.65"> static const char kTraitCookie[] = { '\xFC', '\xA9', '\x36', '\x01' };</span>
<a href="#l85.66"></a><span id="l85.66"> </span>
<a href="#l85.67"></a><span id="l85.67"> void CorpusStore::writeTrainingData(PRUint32 aMaximumTokenCount)</span>
<a href="#l85.68"></a><span id="l85.68" class="difflineat">@@ -2735,17 +2735,17 @@ void CorpusStore::setMessageCount(PRUint</span>
<a href="#l85.69"></a><span id="l85.69">   }</span>
<a href="#l85.70"></a><span id="l85.70">   else</span>
<a href="#l85.71"></a><span id="l85.71">   {</span>
<a href="#l85.72"></a><span id="l85.72">     mMessageCounts[index] = aCount;</span>
<a href="#l85.73"></a><span id="l85.73">   }</span>
<a href="#l85.74"></a><span id="l85.74"> }</span>
<a href="#l85.75"></a><span id="l85.75"> </span>
<a href="#l85.76"></a><span id="l85.76"> nsresult</span>
<a href="#l85.77"></a><span id="l85.77" class="difflineminus">-CorpusStore::UpdateData(nsILocalFile *aFile,</span>
<a href="#l85.78"></a><span id="l85.78" class="difflineplus">+CorpusStore::UpdateData(nsIFile *aFile,</span>
<a href="#l85.79"></a><span id="l85.79">                         bool aIsAdd,</span>
<a href="#l85.80"></a><span id="l85.80">                         PRUint32 aRemapCount,</span>
<a href="#l85.81"></a><span id="l85.81">                         PRUint32 *aFromTraits,</span>
<a href="#l85.82"></a><span id="l85.82">                         PRUint32 *aToTraits)</span>
<a href="#l85.83"></a><span id="l85.83"> {</span>
<a href="#l85.84"></a><span id="l85.84">   NS_ENSURE_ARG_POINTER(aFile);</span>
<a href="#l85.85"></a><span id="l85.85">   if (aRemapCount)</span>
<a href="#l85.86"></a><span id="l85.86">   {</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l86.1"></a><span id="l86.1" class="difflineminus">--- a/mailnews/extensions/bayesian-spam-filter/src/nsBayesianFilter.h</span>
<a href="#l86.2"></a><span id="l86.2" class="difflineplus">+++ b/mailnews/extensions/bayesian-spam-filter/src/nsBayesianFilter.h</span>
<a href="#l86.3"></a><span id="l86.3" class="difflineat">@@ -272,38 +272,38 @@ public:</span>
<a href="#l86.4"></a><span id="l86.4">      *                    trait ids that are not in this array, they are not</span>
<a href="#l86.5"></a><span id="l86.5">      *                    remapped, but assummed to be local trait ids.</span>
<a href="#l86.6"></a><span id="l86.6">      *</span>
<a href="#l86.7"></a><span id="l86.7">      * @param aToTraits   array of trait ids, corresponding to elements of</span>
<a href="#l86.8"></a><span id="l86.8">      *                    aFromTraits, that represent the local trait ids to be</span>
<a href="#l86.9"></a><span id="l86.9">      *                    used in storing data from aFile into the local corpus.</span>
<a href="#l86.10"></a><span id="l86.10">      *</span>
<a href="#l86.11"></a><span id="l86.11">      */</span>
<a href="#l86.12"></a><span id="l86.12" class="difflineminus">-    nsresult UpdateData(nsILocalFile *aFile, bool aIsAdd,</span>
<a href="#l86.13"></a><span id="l86.13" class="difflineplus">+    nsresult UpdateData(nsIFile *aFile, bool aIsAdd,</span>
<a href="#l86.14"></a><span id="l86.14">                         PRUint32 aRemapCount, PRUint32 *aFromTraits,</span>
<a href="#l86.15"></a><span id="l86.15">                         PRUint32 *aToTraits);</span>
<a href="#l86.16"></a><span id="l86.16"> </span>
<a href="#l86.17"></a><span id="l86.17">     /**</span>
<a href="#l86.18"></a><span id="l86.18">      * remove all counts (message and tokens) for a trait id</span>
<a href="#l86.19"></a><span id="l86.19">      *</span>
<a href="#l86.20"></a><span id="l86.20">      * @param aTrait  trait id for the trait to remove</span>
<a href="#l86.21"></a><span id="l86.21">      */</span>
<a href="#l86.22"></a><span id="l86.22">     nsresult ClearTrait(PRUint32 aTrait);</span>
<a href="#l86.23"></a><span id="l86.23"> </span>
<a href="#l86.24"></a><span id="l86.24"> protected:</span>
<a href="#l86.25"></a><span id="l86.25"> </span>
<a href="#l86.26"></a><span id="l86.26">     /**</span>
<a href="#l86.27"></a><span id="l86.27">      * return the local corpus storage file for junk traits</span>
<a href="#l86.28"></a><span id="l86.28">      */</span>
<a href="#l86.29"></a><span id="l86.29" class="difflineminus">-    nsresult getTrainingFile(nsILocalFile ** aFile);</span>
<a href="#l86.30"></a><span id="l86.30" class="difflineplus">+    nsresult getTrainingFile(nsIFile ** aFile);</span>
<a href="#l86.31"></a><span id="l86.31"> </span>
<a href="#l86.32"></a><span id="l86.32">     /**</span>
<a href="#l86.33"></a><span id="l86.33">      * return the local corpus storage file for non-junk traits</span>
<a href="#l86.34"></a><span id="l86.34">      */</span>
<a href="#l86.35"></a><span id="l86.35" class="difflineminus">-    nsresult getTraitFile(nsILocalFile ** aFile);</span>
<a href="#l86.36"></a><span id="l86.36" class="difflineplus">+    nsresult getTraitFile(nsIFile ** aFile);</span>
<a href="#l86.37"></a><span id="l86.37"> </span>
<a href="#l86.38"></a><span id="l86.38">     /**</span>
<a href="#l86.39"></a><span id="l86.39">      * read token strings from the data file</span>
<a href="#l86.40"></a><span id="l86.40">      *</span>
<a href="#l86.41"></a><span id="l86.41">      * @param stream     file stream with token data</span>
<a href="#l86.42"></a><span id="l86.42">      * @param fileSize   file size</span>
<a href="#l86.43"></a><span id="l86.43">      * @param aTraitId   id for the trait whose counts will be read</span>
<a href="#l86.44"></a><span id="l86.44">      * @param aIsAdd     true to add the counts, false to remove them</span>
<a href="#l86.45"></a><span id="l86.45" class="difflineat">@@ -328,18 +328,18 @@ protected:</span>
<a href="#l86.46"></a><span id="l86.46">      */</span>
<a href="#l86.47"></a><span id="l86.47">     CorpusToken* add(const char* word, PRUint32 aTraitId, PRUint32 aCount);</span>
<a href="#l86.48"></a><span id="l86.48"> </span>
<a href="#l86.49"></a><span id="l86.49">     /**</span>
<a href="#l86.50"></a><span id="l86.50">      * change counts in a trait in the traits array, adding the trait if needed</span>
<a href="#l86.51"></a><span id="l86.51">      */</span>
<a href="#l86.52"></a><span id="l86.52">     nsresult updateTrait(CorpusToken* token, PRUint32 aTraitId,</span>
<a href="#l86.53"></a><span id="l86.53">       PRInt32 aCountChange);</span>
<a href="#l86.54"></a><span id="l86.54" class="difflineminus">-    nsCOMPtr&lt;nsILocalFile&gt; mTrainingFile;  // file used to store junk training data</span>
<a href="#l86.55"></a><span id="l86.55" class="difflineminus">-    nsCOMPtr&lt;nsILocalFile&gt; mTraitFile;     // file used to store non-junk</span>
<a href="#l86.56"></a><span id="l86.56" class="difflineplus">+    nsCOMPtr&lt;nsIFile&gt; mTrainingFile;  // file used to store junk training data</span>
<a href="#l86.57"></a><span id="l86.57" class="difflineplus">+    nsCOMPtr&lt;nsIFile&gt; mTraitFile;     // file used to store non-junk</span>
<a href="#l86.58"></a><span id="l86.58">                                            // training data</span>
<a href="#l86.59"></a><span id="l86.59">     nsTArray&lt;TraitPerToken&gt; mTraitStore;   // memory for linked-list of counts</span>
<a href="#l86.60"></a><span id="l86.60">     PRUint32 mNextTraitIndex;              // index in mTraitStore to first empty</span>
<a href="#l86.61"></a><span id="l86.61">                                            // TraitPerToken</span>
<a href="#l86.62"></a><span id="l86.62">     nsTArray&lt;PRUint32&gt; mMessageCounts;     // count of messages per trait</span>
<a href="#l86.63"></a><span id="l86.63">                                            // represented in the store</span>
<a href="#l86.64"></a><span id="l86.64">     nsTArray&lt;PRUint32&gt; mMessageCountsId;   // Parallel array to mMessageCounts, with</span>
<a href="#l86.65"></a><span id="l86.65">                                            // the corresponding trait ID</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l87.1"></a><span id="l87.1" class="difflineminus">--- a/mailnews/extensions/mailviews/src/nsMsgMailViewList.cpp</span>
<a href="#l87.2"></a><span id="l87.2" class="difflineplus">+++ b/mailnews/extensions/mailviews/src/nsMsgMailViewList.cpp</span>
<a href="#l87.3"></a><span id="l87.3" class="difflineat">@@ -6,17 +6,17 @@</span>
<a href="#l87.4"></a><span id="l87.4"> #include &quot;nsMsgMailViewList.h&quot;</span>
<a href="#l87.5"></a><span id="l87.5"> #include &quot;nsISupportsArray.h&quot;</span>
<a href="#l87.6"></a><span id="l87.6"> #include &quot;nsIFileChannel.h&quot;</span>
<a href="#l87.7"></a><span id="l87.7"> #include &quot;nsIMsgFilterService.h&quot;</span>
<a href="#l87.8"></a><span id="l87.8"> #include &quot;nsIMsgMailSession.h&quot;</span>
<a href="#l87.9"></a><span id="l87.9"> #include &quot;nsMsgBaseCID.h&quot;</span>
<a href="#l87.10"></a><span id="l87.10"> #include &quot;nsAppDirectoryServiceDefs.h&quot;</span>
<a href="#l87.11"></a><span id="l87.11"> #include &quot;nsDirectoryServiceUtils.h&quot;</span>
<a href="#l87.12"></a><span id="l87.12" class="difflineminus">-#include &quot;nsILocalFile.h&quot;</span>
<a href="#l87.13"></a><span id="l87.13" class="difflineplus">+#include &quot;nsIFile.h&quot;</span>
<a href="#l87.14"></a><span id="l87.14"> #include &quot;nsComponentManagerUtils.h&quot;</span>
<a href="#l87.15"></a><span id="l87.15"> #include &quot;mozilla/Services.h&quot;</span>
<a href="#l87.16"></a><span id="l87.16"> </span>
<a href="#l87.17"></a><span id="l87.17"> #define kDefaultViewPeopleIKnow &quot;People I Know&quot;</span>
<a href="#l87.18"></a><span id="l87.18"> #define kDefaultViewRecent &quot;Recent Mail&quot;</span>
<a href="#l87.19"></a><span id="l87.19"> #define kDefaultViewFiveDays &quot;Last 5 Days&quot;</span>
<a href="#l87.20"></a><span id="l87.20"> #define kDefaultViewNotJunk &quot;Not Junk&quot;</span>
<a href="#l87.21"></a><span id="l87.21"> #define kDefaultViewHasAttachments &quot;Has Attachments&quot;</span>
<a href="#l87.22"></a><span id="l87.22" class="difflineat">@@ -253,25 +253,24 @@ nsresult nsMsgMailViewList::LoadMailView</span>
<a href="#l87.23"></a><span id="l87.23"> </span>
<a href="#l87.24"></a><span id="l87.24">          // get the profile directory</span>
<a href="#l87.25"></a><span id="l87.25">         rv = NS_GetSpecialDirectory(NS_APP_USER_PROFILE_50_DIR, getter_AddRefs(profileDir));</span>
<a href="#l87.26"></a><span id="l87.26">         </span>
<a href="#l87.27"></a><span id="l87.27">         // now copy the file over to the profile directory</span>
<a href="#l87.28"></a><span id="l87.28">         defaultMessagesFile-&gt;CopyToNative(profileDir, EmptyCString());</span>
<a href="#l87.29"></a><span id="l87.29">     }</span>
<a href="#l87.30"></a><span id="l87.30">     // this is kind of a hack but I think it will be an effective hack. The filter service already knows how to </span>
<a href="#l87.31"></a><span id="l87.31" class="difflineminus">-    // take a nsILocalFile and parse the contents into filters which are very similar to mail views. Intead of</span>
<a href="#l87.32"></a><span id="l87.32" class="difflineplus">+    // take a nsIFile and parse the contents into filters which are very similar to mail views. Intead of</span>
<a href="#l87.33"></a><span id="l87.33">     // re-writing all of that dirty parsing code, let's just re-use it then convert the results into a data strcuture</span>
<a href="#l87.34"></a><span id="l87.34">     // we wish to give to our consumers. </span>
<a href="#l87.35"></a><span id="l87.35">       </span>
<a href="#l87.36"></a><span id="l87.36">     nsCOMPtr&lt;nsIMsgFilterService&gt; filterService = do_GetService(NS_MSGFILTERSERVICE_CONTRACTID, &amp;rv);</span>
<a href="#l87.37"></a><span id="l87.37">     nsCOMPtr&lt;nsIMsgFilterList&gt; mfilterList;</span>
<a href="#l87.38"></a><span id="l87.38">       </span>
<a href="#l87.39"></a><span id="l87.39" class="difflineminus">-    nsCOMPtr &lt;nsILocalFile&gt; localFile = do_QueryInterface(file);</span>
<a href="#l87.40"></a><span id="l87.40" class="difflineminus">-    rv = filterService-&gt;OpenFilterList(localFile, NULL, NULL, getter_AddRefs(mFilterList));</span>
<a href="#l87.41"></a><span id="l87.41" class="difflineplus">+    rv = filterService-&gt;OpenFilterList(file, NULL, NULL, getter_AddRefs(mFilterList));</span>
<a href="#l87.42"></a><span id="l87.42">     NS_ENSURE_SUCCESS(rv, rv);</span>
<a href="#l87.43"></a><span id="l87.43"> </span>
<a href="#l87.44"></a><span id="l87.44">     // now convert the filter list into our mail view objects, stripping out just the info we need</span>
<a href="#l87.45"></a><span id="l87.45">     ConvertFilterListToMailView(mFilterList, getter_AddRefs(m_mailViews));</span>
<a href="#l87.46"></a><span id="l87.46">     return rv;</span>
<a href="#l87.47"></a><span id="l87.47"> }</span>
<a href="#l87.48"></a><span id="l87.48"> </span>
<a href="#l87.49"></a><span id="l87.49"> nsresult nsMsgMailViewList::ConvertFilterListToMailView(nsIMsgFilterList * aFilterList, nsISupportsArray ** aMailViewList)</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l88.1"></a><span id="l88.1" class="difflineminus">--- a/mailnews/extensions/mdn/src/nsMsgMdnGenerator.cpp</span>
<a href="#l88.2"></a><span id="l88.2" class="difflineplus">+++ b/mailnews/extensions/mdn/src/nsMsgMdnGenerator.cpp</span>
<a href="#l88.3"></a><span id="l88.3" class="difflineat">@@ -367,20 +367,19 @@ nsresult nsMsgMdnGenerator::CreateMdnMsg</span>
<a href="#l88.4"></a><span id="l88.4"> </span>
<a href="#l88.5"></a><span id="l88.5">     nsCOMPtr&lt;nsIFile&gt; tmpFile;</span>
<a href="#l88.6"></a><span id="l88.6">     rv = GetSpecialDirectoryWithFileName(NS_OS_TEMP_DIR,</span>
<a href="#l88.7"></a><span id="l88.7">                                          &quot;mdnmsg&quot;,</span>
<a href="#l88.8"></a><span id="l88.8">                                          getter_AddRefs(m_file));</span>
<a href="#l88.9"></a><span id="l88.9">     NS_ENSURE_SUCCESS(rv, rv);</span>
<a href="#l88.10"></a><span id="l88.10"> </span>
<a href="#l88.11"></a><span id="l88.11">     rv = m_file-&gt;CreateUnique(nsIFile::NORMAL_FILE_TYPE, 00600);</span>
<a href="#l88.12"></a><span id="l88.12" class="difflineminus">-    nsCOMPtr &lt;nsILocalFile&gt; localFile = do_QueryInterface(m_file);</span>
<a href="#l88.13"></a><span id="l88.13">     NS_ENSURE_SUCCESS(rv, rv);</span>
<a href="#l88.14"></a><span id="l88.14">     rv = NS_NewLocalFileOutputStream(getter_AddRefs(m_outputStream),</span>
<a href="#l88.15"></a><span id="l88.15" class="difflineminus">-                                     localFile,</span>
<a href="#l88.16"></a><span id="l88.16" class="difflineplus">+                                     m_file,</span>
<a href="#l88.17"></a><span id="l88.17">                                      PR_CREATE_FILE | PR_WRONLY | PR_TRUNCATE,</span>
<a href="#l88.18"></a><span id="l88.18">                                      0664);</span>
<a href="#l88.19"></a><span id="l88.19">     NS_ASSERTION(NS_SUCCEEDED(rv),&quot;creating mdn: failed to output stream&quot;);</span>
<a href="#l88.20"></a><span id="l88.20">     if (NS_FAILED(rv))</span>
<a href="#l88.21"></a><span id="l88.21">         return NS_OK;</span>
<a href="#l88.22"></a><span id="l88.22"> </span>
<a href="#l88.23"></a><span id="l88.23">     rv = CreateFirstPart();</span>
<a href="#l88.24"></a><span id="l88.24">     if (NS_SUCCEEDED(rv))</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l89.1"></a><span id="l89.1" class="difflineminus">--- a/mailnews/imap/src/nsImapMailFolder.cpp</span>
<a href="#l89.2"></a><span id="l89.2" class="difflineplus">+++ b/mailnews/imap/src/nsImapMailFolder.cpp</span>
<a href="#l89.3"></a><span id="l89.3" class="difflineat">@@ -7,17 +7,17 @@</span>
<a href="#l89.4"></a><span id="l89.4"> // sorry, this has to be before the pre-compiled header</span>
<a href="#l89.5"></a><span id="l89.5"> #define FORCE_PR_LOG /* Allow logging in the release build */</span>
<a href="#l89.6"></a><span id="l89.6"> #endif</span>
<a href="#l89.7"></a><span id="l89.7"> #include &quot;msgCore.h&quot;</span>
<a href="#l89.8"></a><span id="l89.8"> #include &quot;prmem.h&quot;</span>
<a href="#l89.9"></a><span id="l89.9"> #include &quot;nsMsgImapCID.h&quot;</span>
<a href="#l89.10"></a><span id="l89.10"> #include &quot;nsImapMailFolder.h&quot;</span>
<a href="#l89.11"></a><span id="l89.11"> #include &quot;nsIEnumerator.h&quot;</span>
<a href="#l89.12"></a><span id="l89.12" class="difflineminus">-#include &quot;nsILocalFile.h&quot;</span>
<a href="#l89.13"></a><span id="l89.13" class="difflineplus">+#include &quot;nsIFile.h&quot;</span>
<a href="#l89.14"></a><span id="l89.14"> #include &quot;nsIFolderListener.h&quot;</span>
<a href="#l89.15"></a><span id="l89.15"> #include &quot;nsCOMPtr.h&quot;</span>
<a href="#l89.16"></a><span id="l89.16"> #include &quot;nsAutoPtr.h&quot;</span>
<a href="#l89.17"></a><span id="l89.17"> #include &quot;nsIRDFService.h&quot;</span>
<a href="#l89.18"></a><span id="l89.18"> #include &quot;nsRDFCID.h&quot;</span>
<a href="#l89.19"></a><span id="l89.19"> #include &quot;nsMsgDBCID.h&quot;</span>
<a href="#l89.20"></a><span id="l89.20"> #include &quot;nsMsgFolderFlags.h&quot;</span>
<a href="#l89.21"></a><span id="l89.21"> #include &quot;nsImapFlagAndUidState.h&quot;</span>
<a href="#l89.22"></a><span id="l89.22" class="difflineat">@@ -143,21 +143,20 @@ nsresult RecursiveCopy(nsIFile* srcDir, </span>
<a href="#l89.23"></a><span id="l89.23">     rv = dirIterator-&gt;GetNext((nsISupports**)getter_AddRefs(dirEntry));</span>
<a href="#l89.24"></a><span id="l89.24">     if (NS_SUCCEEDED(rv))</span>
<a href="#l89.25"></a><span id="l89.25">     {</span>
<a href="#l89.26"></a><span id="l89.26">       rv = dirEntry-&gt;IsDirectory(&amp;isDir);</span>
<a href="#l89.27"></a><span id="l89.27">       if (NS_SUCCEEDED(rv))</span>
<a href="#l89.28"></a><span id="l89.28">       {</span>
<a href="#l89.29"></a><span id="l89.29">         if (isDir)</span>
<a href="#l89.30"></a><span id="l89.30">         {</span>
<a href="#l89.31"></a><span id="l89.31" class="difflineminus">-          nsCOMPtr&lt;nsIFile&gt; destClone;</span>
<a href="#l89.32"></a><span id="l89.32" class="difflineminus">-          rv = destDir-&gt;Clone(getter_AddRefs(destClone));</span>
<a href="#l89.33"></a><span id="l89.33" class="difflineplus">+          nsCOMPtr&lt;nsIFile&gt; newChild;</span>
<a href="#l89.34"></a><span id="l89.34" class="difflineplus">+          rv = destDir-&gt;Clone(getter_AddRefs(newChild));</span>
<a href="#l89.35"></a><span id="l89.35">           if (NS_SUCCEEDED(rv))</span>
<a href="#l89.36"></a><span id="l89.36">           {</span>
<a href="#l89.37"></a><span id="l89.37" class="difflineminus">-            nsCOMPtr&lt;nsILocalFile&gt; newChild(do_QueryInterface(destClone));</span>
<a href="#l89.38"></a><span id="l89.38">             nsAutoString leafName;</span>
<a href="#l89.39"></a><span id="l89.39">             dirEntry-&gt;GetLeafName(leafName);</span>
<a href="#l89.40"></a><span id="l89.40">             newChild-&gt;AppendRelativePath(leafName);</span>
<a href="#l89.41"></a><span id="l89.41">             rv = newChild-&gt;Exists(&amp;exists);</span>
<a href="#l89.42"></a><span id="l89.42">             if (NS_SUCCEEDED(rv) &amp;&amp; !exists)</span>
<a href="#l89.43"></a><span id="l89.43">               rv = newChild-&gt;Create(nsIFile::DIRECTORY_TYPE, 0775);</span>
<a href="#l89.44"></a><span id="l89.44">             rv = RecursiveCopy(dirEntry, newChild);</span>
<a href="#l89.45"></a><span id="l89.45">           }</span>
<a href="#l89.46"></a><span id="l89.46" class="difflineat">@@ -230,17 +229,17 @@ NS_IMPL_QUERY_HEAD(nsImapMailFolder)</span>
<a href="#l89.47"></a><span id="l89.47">     NS_IMPL_QUERY_BODY(nsIMsgImapMailFolder)</span>
<a href="#l89.48"></a><span id="l89.48">     NS_IMPL_QUERY_BODY(nsICopyMessageListener)</span>
<a href="#l89.49"></a><span id="l89.49">     NS_IMPL_QUERY_BODY(nsIImapMailFolderSink)</span>
<a href="#l89.50"></a><span id="l89.50">     NS_IMPL_QUERY_BODY(nsIImapMessageSink)</span>
<a href="#l89.51"></a><span id="l89.51">     NS_IMPL_QUERY_BODY(nsIUrlListener)</span>
<a href="#l89.52"></a><span id="l89.52">     NS_IMPL_QUERY_BODY(nsIMsgFilterHitNotify)</span>
<a href="#l89.53"></a><span id="l89.53"> NS_IMPL_QUERY_TAIL_INHERITING(nsMsgDBFolder)</span>
<a href="#l89.54"></a><span id="l89.54"> </span>
<a href="#l89.55"></a><span id="l89.55" class="difflineminus">-nsresult nsImapMailFolder::AddDirectorySeparator(nsILocalFile *path)</span>
<a href="#l89.56"></a><span id="l89.56" class="difflineplus">+nsresult nsImapMailFolder::AddDirectorySeparator(nsIFile *path)</span>
<a href="#l89.57"></a><span id="l89.57"> {</span>
<a href="#l89.58"></a><span id="l89.58">   if (mURI.Equals(kImapRootURI))</span>
<a href="#l89.59"></a><span id="l89.59">   {</span>
<a href="#l89.60"></a><span id="l89.60">     // don't concat the full separator with .sbd</span>
<a href="#l89.61"></a><span id="l89.61">   }</span>
<a href="#l89.62"></a><span id="l89.62">   else</span>
<a href="#l89.63"></a><span id="l89.63">   {</span>
<a href="#l89.64"></a><span id="l89.64">     // see if there's a dir with the same name ending with .sbd</span>
<a href="#l89.65"></a><span id="l89.65" class="difflineat">@@ -304,17 +303,17 @@ NS_IMETHODIMP nsImapMailFolder::AddSubfo</span>
<a href="#l89.66"></a><span id="l89.66">   nsCOMPtr&lt;nsIRDFResource&gt; res;</span>
<a href="#l89.67"></a><span id="l89.67">   rv = rdf-&gt;GetResource(uri, getter_AddRefs(res));</span>
<a href="#l89.68"></a><span id="l89.68">   if (NS_FAILED(rv))</span>
<a href="#l89.69"></a><span id="l89.69">     return rv;</span>
<a href="#l89.70"></a><span id="l89.70"> </span>
<a href="#l89.71"></a><span id="l89.71">   nsCOMPtr&lt;nsIMsgFolder&gt; folder(do_QueryInterface(res, &amp;rv));</span>
<a href="#l89.72"></a><span id="l89.72">   NS_ENSURE_SUCCESS(rv, rv);</span>
<a href="#l89.73"></a><span id="l89.73"> </span>
<a href="#l89.74"></a><span id="l89.74" class="difflineminus">-  nsCOMPtr &lt;nsILocalFile&gt; path;</span>
<a href="#l89.75"></a><span id="l89.75" class="difflineplus">+  nsCOMPtr &lt;nsIFile&gt; path;</span>
<a href="#l89.76"></a><span id="l89.76">   rv = CreateDirectoryForFolder(getter_AddRefs(path));</span>
<a href="#l89.77"></a><span id="l89.77">   NS_ENSURE_SUCCESS(rv, rv);</span>
<a href="#l89.78"></a><span id="l89.78"> </span>
<a href="#l89.79"></a><span id="l89.79">   folder-&gt;GetFlags((PRUint32 *)&amp;flags);</span>
<a href="#l89.80"></a><span id="l89.80"> </span>
<a href="#l89.81"></a><span id="l89.81">   flags |= nsMsgFolderFlags::Mail;</span>
<a href="#l89.82"></a><span id="l89.82"> </span>
<a href="#l89.83"></a><span id="l89.83">   nsCOMPtr&lt;nsIImapIncomingServer&gt; imapServer;</span>
<a href="#l89.84"></a><span id="l89.84" class="difflineat">@@ -339,17 +338,17 @@ NS_IMETHODIMP nsImapMailFolder::AddSubfo</span>
<a href="#l89.85"></a><span id="l89.85">   {</span>
<a href="#l89.86"></a><span id="l89.86">     imapChild-&gt;SetOnlineName(NS_LossyConvertUTF16toASCII(aName));</span>
<a href="#l89.87"></a><span id="l89.87">     imapChild-&gt;SetHierarchyDelimiter(m_hierarchyDelimiter);</span>
<a href="#l89.88"></a><span id="l89.88">   }</span>
<a href="#l89.89"></a><span id="l89.89">   NotifyItemAdded(*aChild);</span>
<a href="#l89.90"></a><span id="l89.90">   return rv;</span>
<a href="#l89.91"></a><span id="l89.91"> }</span>
<a href="#l89.92"></a><span id="l89.92"> </span>
<a href="#l89.93"></a><span id="l89.93" class="difflineminus">-nsresult nsImapMailFolder::AddSubfolderWithPath(nsAString&amp; name, nsILocalFile *dbPath,</span>
<a href="#l89.94"></a><span id="l89.94" class="difflineplus">+nsresult nsImapMailFolder::AddSubfolderWithPath(nsAString&amp; name, nsIFile *dbPath,</span>
<a href="#l89.95"></a><span id="l89.95">                                              nsIMsgFolder **child, bool brandNew)</span>
<a href="#l89.96"></a><span id="l89.96"> {</span>
<a href="#l89.97"></a><span id="l89.97">   NS_ENSURE_ARG_POINTER(child);</span>
<a href="#l89.98"></a><span id="l89.98"> </span>
<a href="#l89.99"></a><span id="l89.99">   nsresult rv;</span>
<a href="#l89.100"></a><span id="l89.100">   nsCOMPtr&lt;nsIRDFService&gt; rdf(do_GetService(kRDFServiceCID, &amp;rv));</span>
<a href="#l89.101"></a><span id="l89.101">   NS_ENSURE_SUCCESS(rv, rv);</span>
<a href="#l89.102"></a><span id="l89.102">   PRInt32 flags = 0;</span>
<a href="#l89.103"></a><span id="l89.103" class="difflineat">@@ -425,17 +424,17 @@ nsresult nsImapMailFolder::AddSubfolderW</span>
<a href="#l89.104"></a><span id="l89.104">   rv = NS_OK;</span>
<a href="#l89.105"></a><span id="l89.105"> </span>
<a href="#l89.106"></a><span id="l89.106">   if (folder)</span>
<a href="#l89.107"></a><span id="l89.107">     mSubFolders.AppendObject(folder);</span>
<a href="#l89.108"></a><span id="l89.108">   folder.swap(*child);</span>
<a href="#l89.109"></a><span id="l89.109">   return rv;</span>
<a href="#l89.110"></a><span id="l89.110"> }</span>
<a href="#l89.111"></a><span id="l89.111"> </span>
<a href="#l89.112"></a><span id="l89.112" class="difflineminus">-nsresult nsImapMailFolder::CreateSubFolders(nsILocalFile *path)</span>
<a href="#l89.113"></a><span id="l89.113" class="difflineplus">+nsresult nsImapMailFolder::CreateSubFolders(nsIFile *path)</span>
<a href="#l89.114"></a><span id="l89.114"> {</span>
<a href="#l89.115"></a><span id="l89.115">   nsresult rv = NS_OK;</span>
<a href="#l89.116"></a><span id="l89.116">   nsAutoString currentFolderNameStr;    // online name</span>
<a href="#l89.117"></a><span id="l89.117">   nsAutoString currentFolderDBNameStr;  // possibly munged name</span>
<a href="#l89.118"></a><span id="l89.118">   nsCOMPtr&lt;nsIMsgFolder&gt; child;</span>
<a href="#l89.119"></a><span id="l89.119">   nsCOMPtr&lt;nsIMsgIncomingServer&gt; server;</span>
<a href="#l89.120"></a><span id="l89.120">   rv = GetServer(getter_AddRefs(server));</span>
<a href="#l89.121"></a><span id="l89.121">   NS_ENSURE_SUCCESS(rv, rv);</span>
<a href="#l89.122"></a><span id="l89.122" class="difflineat">@@ -450,27 +449,27 @@ nsresult nsImapMailFolder::CreateSubFold</span>
<a href="#l89.123"></a><span id="l89.123">   while (more)</span>
<a href="#l89.124"></a><span id="l89.124">   {</span>
<a href="#l89.125"></a><span id="l89.125">     rv = children-&gt;GetNext((nsISupports**) getter_AddRefs(dirEntry));</span>
<a href="#l89.126"></a><span id="l89.126">     if (NS_FAILED(rv))</span>
<a href="#l89.127"></a><span id="l89.127">       break;</span>
<a href="#l89.128"></a><span id="l89.128">     rv = children-&gt;HasMoreElements(&amp;more);</span>
<a href="#l89.129"></a><span id="l89.129">     if (NS_FAILED(rv)) return rv;</span>
<a href="#l89.130"></a><span id="l89.130"> </span>
<a href="#l89.131"></a><span id="l89.131" class="difflineminus">-    nsCOMPtr &lt;nsILocalFile&gt; currentFolderPath = do_QueryInterface(dirEntry);</span>
<a href="#l89.132"></a><span id="l89.132" class="difflineplus">+    nsCOMPtr &lt;nsIFile&gt; currentFolderPath = do_QueryInterface(dirEntry);</span>
<a href="#l89.133"></a><span id="l89.133">     currentFolderPath-&gt;GetLeafName(currentFolderNameStr);</span>
<a href="#l89.134"></a><span id="l89.134">     if (nsShouldIgnoreFile(currentFolderNameStr))</span>
<a href="#l89.135"></a><span id="l89.135">       continue;</span>
<a href="#l89.136"></a><span id="l89.136"> </span>
<a href="#l89.137"></a><span id="l89.137">     // OK, here we need to get the online name from the folder cache if we can.</span>
<a href="#l89.138"></a><span id="l89.138">     // If we can, use that to create the sub-folder</span>
<a href="#l89.139"></a><span id="l89.139">     nsCOMPtr &lt;nsIMsgFolderCacheElement&gt; cacheElement;</span>
<a href="#l89.140"></a><span id="l89.140" class="difflineminus">-    nsCOMPtr &lt;nsILocalFile&gt; curFolder = do_CreateInstance(NS_LOCAL_FILE_CONTRACTID, &amp;rv);</span>
<a href="#l89.141"></a><span id="l89.141" class="difflineplus">+    nsCOMPtr &lt;nsIFile&gt; curFolder = do_CreateInstance(NS_LOCAL_FILE_CONTRACTID, &amp;rv);</span>
<a href="#l89.142"></a><span id="l89.142">     NS_ENSURE_SUCCESS(rv, rv);</span>
<a href="#l89.143"></a><span id="l89.143" class="difflineminus">-    nsCOMPtr &lt;nsILocalFile&gt; dbFile = do_CreateInstance(NS_LOCAL_FILE_CONTRACTID, &amp;rv);</span>
<a href="#l89.144"></a><span id="l89.144" class="difflineplus">+    nsCOMPtr &lt;nsIFile&gt; dbFile = do_CreateInstance(NS_LOCAL_FILE_CONTRACTID, &amp;rv);</span>
<a href="#l89.145"></a><span id="l89.145">     NS_ENSURE_SUCCESS(rv, rv);</span>
<a href="#l89.146"></a><span id="l89.146">     dbFile-&gt;InitWithFile(currentFolderPath);</span>
<a href="#l89.147"></a><span id="l89.147">     curFolder-&gt;InitWithFile(currentFolderPath);</span>
<a href="#l89.148"></a><span id="l89.148">     // don't strip off the .msf in currentFolderPath.</span>
<a href="#l89.149"></a><span id="l89.149">     currentFolderPath-&gt;SetLeafName(currentFolderNameStr);</span>
<a href="#l89.150"></a><span id="l89.150">     currentFolderDBNameStr = currentFolderNameStr;</span>
<a href="#l89.151"></a><span id="l89.151">     nsAutoString utf7LeafName = currentFolderNameStr;</span>
<a href="#l89.152"></a><span id="l89.152"> </span>
<a href="#l89.153"></a><span id="l89.153" class="difflineat">@@ -506,17 +505,17 @@ nsresult nsImapMailFolder::CreateSubFold</span>
<a href="#l89.154"></a><span id="l89.154">           CopyASCIItoUTF16(onlineFullUtf7Name, utf7LeafName);</span>
<a href="#l89.155"></a><span id="l89.155">           leafPos = utf7LeafName.RFindChar(delimiter);</span>
<a href="#l89.156"></a><span id="l89.156">           if (leafPos &gt; 0)</span>
<a href="#l89.157"></a><span id="l89.157">             utf7LeafName.Cut(0, leafPos + 1);</span>
<a href="#l89.158"></a><span id="l89.158">         }</span>
<a href="#l89.159"></a><span id="l89.159">       }</span>
<a href="#l89.160"></a><span id="l89.160">     }</span>
<a href="#l89.161"></a><span id="l89.161">       // make the imap folder remember the file spec it was created with.</span>
<a href="#l89.162"></a><span id="l89.162" class="difflineminus">-    nsCOMPtr &lt;nsILocalFile&gt; msfFilePath = do_CreateInstance(NS_LOCAL_FILE_CONTRACTID, &amp;rv);</span>
<a href="#l89.163"></a><span id="l89.163" class="difflineplus">+    nsCOMPtr &lt;nsIFile&gt; msfFilePath = do_CreateInstance(NS_LOCAL_FILE_CONTRACTID, &amp;rv);</span>
<a href="#l89.164"></a><span id="l89.164">     NS_ENSURE_SUCCESS(rv, rv);</span>
<a href="#l89.165"></a><span id="l89.165">     msfFilePath-&gt;InitWithFile(currentFolderPath);</span>
<a href="#l89.166"></a><span id="l89.166">     if (NS_SUCCEEDED(rv) &amp;&amp; msfFilePath)</span>
<a href="#l89.167"></a><span id="l89.167">     {</span>
<a href="#l89.168"></a><span id="l89.168">       // leaf name is the db name w/o .msf (nsShouldIgnoreFile strips it off)</span>
<a href="#l89.169"></a><span id="l89.169">       // so this trims the .msf off the file spec.</span>
<a href="#l89.170"></a><span id="l89.170">       msfFilePath-&gt;SetLeafName(currentFolderDBNameStr);</span>
<a href="#l89.171"></a><span id="l89.171">     }</span>
<a href="#l89.172"></a><span id="l89.172" class="difflineat">@@ -537,17 +536,17 @@ nsresult nsImapMailFolder::CreateSubFold</span>
<a href="#l89.173"></a><span id="l89.173"> NS_IMETHODIMP nsImapMailFolder::GetSubFolders(nsISimpleEnumerator **aResult)</span>
<a href="#l89.174"></a><span id="l89.174"> {</span>
<a href="#l89.175"></a><span id="l89.175">   bool isServer;</span>
<a href="#l89.176"></a><span id="l89.176">   nsresult rv = GetIsServer(&amp;isServer);</span>
<a href="#l89.177"></a><span id="l89.177">   NS_ENSURE_SUCCESS(rv, rv);</span>
<a href="#l89.178"></a><span id="l89.178"> </span>
<a href="#l89.179"></a><span id="l89.179">   if (!m_initialized)</span>
<a href="#l89.180"></a><span id="l89.180">   {</span>
<a href="#l89.181"></a><span id="l89.181" class="difflineminus">-    nsCOMPtr&lt;nsILocalFile&gt; pathFile;</span>
<a href="#l89.182"></a><span id="l89.182" class="difflineplus">+    nsCOMPtr&lt;nsIFile&gt; pathFile;</span>
<a href="#l89.183"></a><span id="l89.183">     rv = GetFilePath(getter_AddRefs(pathFile));</span>
<a href="#l89.184"></a><span id="l89.184">     if (NS_FAILED(rv)) return rv;</span>
<a href="#l89.185"></a><span id="l89.185"> </span>
<a href="#l89.186"></a><span id="l89.186">     // host directory does not need .sbd tacked on</span>
<a href="#l89.187"></a><span id="l89.187">     if (!isServer)</span>
<a href="#l89.188"></a><span id="l89.188">     {</span>
<a href="#l89.189"></a><span id="l89.189">       rv = AddDirectorySeparator(pathFile);</span>
<a href="#l89.190"></a><span id="l89.190">       if(NS_FAILED(rv)) return rv;</span>
<a href="#l89.191"></a><span id="l89.191" class="difflineat">@@ -883,17 +882,17 @@ NS_IMETHODIMP nsImapMailFolder::CreateSu</span>
<a href="#l89.192"></a><span id="l89.192"> NS_IMETHODIMP nsImapMailFolder::CreateClientSubfolderInfo(const nsACString&amp; folderName,</span>
<a href="#l89.193"></a><span id="l89.193">                                                           char hierarchyDelimiter,</span>
<a href="#l89.194"></a><span id="l89.194">                                                           PRInt32 flags,</span>
<a href="#l89.195"></a><span id="l89.195">                                                           bool suppressNotification)</span>
<a href="#l89.196"></a><span id="l89.196"> {</span>
<a href="#l89.197"></a><span id="l89.197">   nsresult rv = NS_OK;</span>
<a href="#l89.198"></a><span id="l89.198"> </span>
<a href="#l89.199"></a><span id="l89.199">   //Get a directory based on our current path.</span>
<a href="#l89.200"></a><span id="l89.200" class="difflineminus">-  nsCOMPtr &lt;nsILocalFile&gt; path;</span>
<a href="#l89.201"></a><span id="l89.201" class="difflineplus">+  nsCOMPtr &lt;nsIFile&gt; path;</span>
<a href="#l89.202"></a><span id="l89.202">   rv = CreateDirectoryForFolder(getter_AddRefs(path));</span>
<a href="#l89.203"></a><span id="l89.203">   if(NS_FAILED(rv))</span>
<a href="#l89.204"></a><span id="l89.204">     return rv;</span>
<a href="#l89.205"></a><span id="l89.205"> </span>
<a href="#l89.206"></a><span id="l89.206">   NS_ConvertASCIItoUTF16 leafName(folderName);</span>
<a href="#l89.207"></a><span id="l89.207">   nsAutoString folderNameStr;</span>
<a href="#l89.208"></a><span id="l89.208">   nsAutoString parentName = leafName;</span>
<a href="#l89.209"></a><span id="l89.209">   // use RFind, because folder can start with a delimiter and</span>
<a href="#l89.210"></a><span id="l89.210" class="difflineat">@@ -929,17 +928,17 @@ NS_IMETHODIMP nsImapMailFolder::CreateCl</span>
<a href="#l89.211"></a><span id="l89.211"> </span>
<a href="#l89.212"></a><span id="l89.212">   // Create an empty database for this mail folder, set its name from the user</span>
<a href="#l89.213"></a><span id="l89.213">   nsCOMPtr&lt;nsIMsgDatabase&gt; mailDBFactory;</span>
<a href="#l89.214"></a><span id="l89.214">   nsCOMPtr&lt;nsIMsgFolder&gt; child;</span>
<a href="#l89.215"></a><span id="l89.215"> </span>
<a href="#l89.216"></a><span id="l89.216">   nsCOMPtr&lt;nsIMsgDBService&gt; msgDBService = do_GetService(NS_MSGDB_SERVICE_CONTRACTID, &amp;rv);</span>
<a href="#l89.217"></a><span id="l89.217">   NS_ENSURE_SUCCESS(rv, rv);</span>
<a href="#l89.218"></a><span id="l89.218">   nsCOMPtr&lt;nsIMsgDatabase&gt; unusedDB;</span>
<a href="#l89.219"></a><span id="l89.219" class="difflineminus">-  nsCOMPtr &lt;nsILocalFile&gt; dbFile;</span>
<a href="#l89.220"></a><span id="l89.220" class="difflineplus">+  nsCOMPtr &lt;nsIFile&gt; dbFile;</span>
<a href="#l89.221"></a><span id="l89.221"> </span>
<a href="#l89.222"></a><span id="l89.222">   // warning, path will be changed</span>
<a href="#l89.223"></a><span id="l89.223">   rv = CreateFileForDB(folderNameStr, path, getter_AddRefs(dbFile));</span>
<a href="#l89.224"></a><span id="l89.224">   NS_ENSURE_SUCCESS(rv,rv);</span>
<a href="#l89.225"></a><span id="l89.225"> </span>
<a href="#l89.226"></a><span id="l89.226">   //Now let's create the actual new folder</span>
<a href="#l89.227"></a><span id="l89.227">   rv = AddSubfolderWithPath(folderNameStr, dbFile, getter_AddRefs(child), true);</span>
<a href="#l89.228"></a><span id="l89.228">   NS_ENSURE_SUCCESS(rv, rv);</span>
<a href="#l89.229"></a><span id="l89.229" class="difflineat">@@ -1593,21 +1592,21 @@ NS_IMETHODIMP nsImapMailFolder::Delete()</span>
<a href="#l89.230"></a><span id="l89.230">     msgDBService-&gt;CachedDBForFolder(this, getter_AddRefs(mDatabase));</span>
<a href="#l89.231"></a><span id="l89.231">   }</span>
<a href="#l89.232"></a><span id="l89.232">   if (mDatabase)</span>
<a href="#l89.233"></a><span id="l89.233">   {</span>
<a href="#l89.234"></a><span id="l89.234">     mDatabase-&gt;ForceClosed();</span>
<a href="#l89.235"></a><span id="l89.235">     mDatabase = nsnull;</span>
<a href="#l89.236"></a><span id="l89.236">   }</span>
<a href="#l89.237"></a><span id="l89.237"> </span>
<a href="#l89.238"></a><span id="l89.238" class="difflineminus">-  nsCOMPtr&lt;nsILocalFile&gt; path;</span>
<a href="#l89.239"></a><span id="l89.239" class="difflineplus">+  nsCOMPtr&lt;nsIFile&gt; path;</span>
<a href="#l89.240"></a><span id="l89.240">   rv = GetFilePath(getter_AddRefs(path));</span>
<a href="#l89.241"></a><span id="l89.241">   if (NS_SUCCEEDED(rv))</span>
<a href="#l89.242"></a><span id="l89.242">   {</span>
<a href="#l89.243"></a><span id="l89.243" class="difflineminus">-    nsCOMPtr&lt;nsILocalFile&gt; summaryLocation;</span>
<a href="#l89.244"></a><span id="l89.244" class="difflineplus">+    nsCOMPtr&lt;nsIFile&gt; summaryLocation;</span>
<a href="#l89.245"></a><span id="l89.245">     rv = GetSummaryFileLocation(path, getter_AddRefs(summaryLocation));</span>
<a href="#l89.246"></a><span id="l89.246">     if (NS_SUCCEEDED(rv))</span>
<a href="#l89.247"></a><span id="l89.247">     {</span>
<a href="#l89.248"></a><span id="l89.248">       bool exists = false;</span>
<a href="#l89.249"></a><span id="l89.249">       rv = summaryLocation-&gt;Exists(&amp;exists);</span>
<a href="#l89.250"></a><span id="l89.250">       if (NS_SUCCEEDED(rv) &amp;&amp; exists)</span>
<a href="#l89.251"></a><span id="l89.251">       {</span>
<a href="#l89.252"></a><span id="l89.252">         rv = summaryLocation-&gt;Remove(false);</span>
<a href="#l89.253"></a><span id="l89.253" class="difflineat">@@ -1709,36 +1708,36 @@ NS_IMETHODIMP nsImapMailFolder::RenameLo</span>
<a href="#l89.254"></a><span id="l89.254">   PRInt32 leafpos = leafname.RFindChar('/');</span>
<a href="#l89.255"></a><span id="l89.255">   if (leafpos &gt;0)</span>
<a href="#l89.256"></a><span id="l89.256">       leafname.Cut(0, leafpos+1);</span>
<a href="#l89.257"></a><span id="l89.257">   m_msgParser = nsnull;</span>
<a href="#l89.258"></a><span id="l89.258">   PrepareToRename();</span>
<a href="#l89.259"></a><span id="l89.259">   CloseAndBackupFolderDB(leafname);</span>
<a href="#l89.260"></a><span id="l89.260"> </span>
<a href="#l89.261"></a><span id="l89.261">   nsresult rv = NS_OK;</span>
<a href="#l89.262"></a><span id="l89.262" class="difflineminus">-  nsCOMPtr&lt;nsILocalFile&gt; oldPathFile;</span>
<a href="#l89.263"></a><span id="l89.263" class="difflineplus">+  nsCOMPtr&lt;nsIFile&gt; oldPathFile;</span>
<a href="#l89.264"></a><span id="l89.264">   rv = GetFilePath(getter_AddRefs(oldPathFile));</span>
<a href="#l89.265"></a><span id="l89.265">   if (NS_FAILED(rv)) return rv;</span>
<a href="#l89.266"></a><span id="l89.266"> </span>
<a href="#l89.267"></a><span id="l89.267" class="difflineminus">-  nsCOMPtr&lt;nsILocalFile&gt; parentPathFile;</span>
<a href="#l89.268"></a><span id="l89.268" class="difflineplus">+  nsCOMPtr&lt;nsIFile&gt; parentPathFile;</span>
<a href="#l89.269"></a><span id="l89.269">   rv = parent-&gt;GetFilePath(getter_AddRefs(parentPathFile));</span>
<a href="#l89.270"></a><span id="l89.270">   NS_ENSURE_SUCCESS(rv,rv);</span>
<a href="#l89.271"></a><span id="l89.271"> </span>
<a href="#l89.272"></a><span id="l89.272">   bool isDirectory = false;</span>
<a href="#l89.273"></a><span id="l89.273">   parentPathFile-&gt;IsDirectory(&amp;isDirectory);</span>
<a href="#l89.274"></a><span id="l89.274">   if (!isDirectory)</span>
<a href="#l89.275"></a><span id="l89.275">   AddDirectorySeparator(parentPathFile);</span>
<a href="#l89.276"></a><span id="l89.276"> </span>
<a href="#l89.277"></a><span id="l89.277" class="difflineminus">-  nsCOMPtr &lt;nsILocalFile&gt; dirFile;</span>
<a href="#l89.278"></a><span id="l89.278" class="difflineplus">+  nsCOMPtr &lt;nsIFile&gt; dirFile;</span>
<a href="#l89.279"></a><span id="l89.279"> </span>
<a href="#l89.280"></a><span id="l89.280">   PRInt32 count = mSubFolders.Count();</span>
<a href="#l89.281"></a><span id="l89.281">   if (count &gt; 0)</span>
<a href="#l89.282"></a><span id="l89.282">     rv = CreateDirectoryForFolder(getter_AddRefs(dirFile));</span>
<a href="#l89.283"></a><span id="l89.283"> </span>
<a href="#l89.284"></a><span id="l89.284" class="difflineminus">-  nsCOMPtr &lt;nsILocalFile&gt; oldSummaryFile;</span>
<a href="#l89.285"></a><span id="l89.285" class="difflineplus">+  nsCOMPtr &lt;nsIFile&gt; oldSummaryFile;</span>
<a href="#l89.286"></a><span id="l89.286">   rv = GetSummaryFileLocation(oldPathFile, getter_AddRefs(oldSummaryFile));</span>
<a href="#l89.287"></a><span id="l89.287">   NS_ENSURE_SUCCESS(rv, rv);</span>
<a href="#l89.288"></a><span id="l89.288"> </span>
<a href="#l89.289"></a><span id="l89.289">   nsCAutoString newNameStr;</span>
<a href="#l89.290"></a><span id="l89.290">   oldSummaryFile-&gt;Remove(false);</span>
<a href="#l89.291"></a><span id="l89.291">   if (count &gt; 0)</span>
<a href="#l89.292"></a><span id="l89.292">   {</span>
<a href="#l89.293"></a><span id="l89.293">     newNameStr = leafname;</span>
<a href="#l89.294"></a><span id="l89.294" class="difflineat">@@ -2703,17 +2702,17 @@ NS_IMETHODIMP nsImapMailFolder::UpdateIm</span>
<a href="#l89.295"></a><span id="l89.295">   SetSupportedUserFlags(supportedUserFlags);</span>
<a href="#l89.296"></a><span id="l89.296"> </span>
<a href="#l89.297"></a><span id="l89.297">   m_uidValidity = folderValidity;</span>
<a href="#l89.298"></a><span id="l89.298"> </span>
<a href="#l89.299"></a><span id="l89.299">   if (imapUIDValidity != folderValidity)</span>
<a href="#l89.300"></a><span id="l89.300">   {</span>
<a href="#l89.301"></a><span id="l89.301">     NS_ASSERTION(imapUIDValidity == kUidUnknown,</span>
<a href="#l89.302"></a><span id="l89.302">                  &quot;uid validity seems to have changed, blowing away db&quot;);</span>
<a href="#l89.303"></a><span id="l89.303" class="difflineminus">-    nsCOMPtr&lt;nsILocalFile&gt; pathFile;</span>
<a href="#l89.304"></a><span id="l89.304" class="difflineplus">+    nsCOMPtr&lt;nsIFile&gt; pathFile;</span>
<a href="#l89.305"></a><span id="l89.305">     rv = GetFilePath(getter_AddRefs(pathFile));</span>
<a href="#l89.306"></a><span id="l89.306">     if (NS_FAILED(rv)) return rv;</span>
<a href="#l89.307"></a><span id="l89.307"> </span>
<a href="#l89.308"></a><span id="l89.308">     nsCOMPtr&lt;nsIMsgDBService&gt; msgDBService = do_GetService(NS_MSGDB_SERVICE_CONTRACTID, &amp;rv);</span>
<a href="#l89.309"></a><span id="l89.309">     NS_ENSURE_SUCCESS(rv, rv);</span>
<a href="#l89.310"></a><span id="l89.310"> </span>
<a href="#l89.311"></a><span id="l89.311">     nsCOMPtr &lt;nsIDBFolderInfo&gt; transferInfo;</span>
<a href="#l89.312"></a><span id="l89.312">     if (dbFolderInfo)</span>
<a href="#l89.313"></a><span id="l89.313" class="difflineat">@@ -2735,17 +2734,17 @@ NS_IMETHODIMP nsImapMailFolder::UpdateIm</span>
<a href="#l89.314"></a><span id="l89.314">           mBackupDatabase = nsnull;</span>
<a href="#l89.315"></a><span id="l89.315">         }</span>
<a href="#l89.316"></a><span id="l89.316">       }</span>
<a href="#l89.317"></a><span id="l89.317">       else</span>
<a href="#l89.318"></a><span id="l89.318">         mDatabase-&gt;ForceClosed();</span>
<a href="#l89.319"></a><span id="l89.319">     }</span>
<a href="#l89.320"></a><span id="l89.320">     mDatabase = nsnull;</span>
<a href="#l89.321"></a><span id="l89.321"> </span>
<a href="#l89.322"></a><span id="l89.322" class="difflineminus">-    nsCOMPtr &lt;nsILocalFile&gt; summaryFile;</span>
<a href="#l89.323"></a><span id="l89.323" class="difflineplus">+    nsCOMPtr &lt;nsIFile&gt; summaryFile;</span>
<a href="#l89.324"></a><span id="l89.324">     rv = GetSummaryFileLocation(pathFile, getter_AddRefs(summaryFile));</span>
<a href="#l89.325"></a><span id="l89.325">     // Remove summary file.</span>
<a href="#l89.326"></a><span id="l89.326">     if (NS_SUCCEEDED(rv) &amp;&amp; summaryFile)</span>
<a href="#l89.327"></a><span id="l89.327">       summaryFile-&gt;Remove(false);</span>
<a href="#l89.328"></a><span id="l89.328"> </span>
<a href="#l89.329"></a><span id="l89.329">     // Create a new summary file, update the folder message counts, and</span>
<a href="#l89.330"></a><span id="l89.330">     // Close the summary file db.</span>
<a href="#l89.331"></a><span id="l89.331">     bool created;</span>
<a href="#l89.332"></a><span id="l89.332" class="difflineat">@@ -3241,18 +3240,18 @@ NS_IMETHODIMP nsImapMailFolder::BeginCop</span>
<a href="#l89.333"></a><span id="l89.333">         PR_LOG(IMAP, PR_LOG_ALWAYS, (&quot;couldn't create temp nscpmsg.txt:%lx\n&quot;, rv));</span>
<a href="#l89.334"></a><span id="l89.334">         OnCopyCompleted(m_copyState-&gt;m_srcSupport, rv);</span>
<a href="#l89.335"></a><span id="l89.335">         return rv;</span>
<a href="#l89.336"></a><span id="l89.336">       }</span>
<a href="#l89.337"></a><span id="l89.337">     }</span>
<a href="#l89.338"></a><span id="l89.338">   }</span>
<a href="#l89.339"></a><span id="l89.339"> </span>
<a href="#l89.340"></a><span id="l89.340">   nsCOMPtr&lt;nsIOutputStream&gt; fileOutputStream;</span>
<a href="#l89.341"></a><span id="l89.341" class="difflineminus">-  nsCOMPtr &lt;nsILocalFile&gt; localFile = do_QueryInterface(m_copyState-&gt;m_tmpFile);</span>
<a href="#l89.342"></a><span id="l89.342" class="difflineminus">-  rv = MsgNewBufferedFileOutputStream(getter_AddRefs(m_copyState-&gt;m_msgFileStream), localFile, -1, 00600);</span>
<a href="#l89.343"></a><span id="l89.343" class="difflineplus">+  rv = MsgNewBufferedFileOutputStream(getter_AddRefs(m_copyState-&gt;m_msgFileStream),</span>
<a href="#l89.344"></a><span id="l89.344" class="difflineplus">+                                      m_copyState-&gt;m_tmpFile, -1, 00600);</span>
<a href="#l89.345"></a><span id="l89.345">   if (NS_FAILED(rv))</span>
<a href="#l89.346"></a><span id="l89.346">     PR_LOG(IMAP, PR_LOG_ALWAYS, (&quot;couldn't create output file stream:%lx\n&quot;, rv));</span>
<a href="#l89.347"></a><span id="l89.347"> </span>
<a href="#l89.348"></a><span id="l89.348">   if (!m_copyState-&gt;m_dataBuffer)</span>
<a href="#l89.349"></a><span id="l89.349">     m_copyState-&gt;m_dataBuffer = (char*) PR_CALLOC(COPY_BUFFER_SIZE+1);</span>
<a href="#l89.350"></a><span id="l89.350">   NS_ENSURE_TRUE(m_copyState-&gt;m_dataBuffer, NS_ERROR_OUT_OF_MEMORY);</span>
<a href="#l89.351"></a><span id="l89.351">   m_copyState-&gt;m_dataBufferSize = COPY_BUFFER_SIZE;</span>
<a href="#l89.352"></a><span id="l89.352">   return NS_OK;</span>
<a href="#l89.353"></a><span id="l89.353" class="difflineat">@@ -4451,19 +4450,17 @@ void nsImapMailFolder::TweakHeaderFlags(</span>
<a href="#l89.354"></a><span id="l89.354">   }</span>
<a href="#l89.355"></a><span id="l89.355"> }</span>
<a href="#l89.356"></a><span id="l89.356"> </span>
<a href="#l89.357"></a><span id="l89.357"> NS_IMETHODIMP</span>
<a href="#l89.358"></a><span id="l89.358"> nsImapMailFolder::SetupMsgWriteStream(nsIFile * aFile, bool addDummyEnvelope)</span>
<a href="#l89.359"></a><span id="l89.359"> {</span>
<a href="#l89.360"></a><span id="l89.360">   nsresult rv;</span>
<a href="#l89.361"></a><span id="l89.361">   aFile-&gt;Remove(false);</span>
<a href="#l89.362"></a><span id="l89.362" class="difflineminus">-  nsCOMPtr&lt;nsILocalFile&gt;  localFile = do_QueryInterface(aFile, &amp;rv);</span>
<a href="#l89.363"></a><span id="l89.363" class="difflineminus">-  NS_ENSURE_SUCCESS(rv, rv);</span>
<a href="#l89.364"></a><span id="l89.364" class="difflineminus">-  rv = MsgNewBufferedFileOutputStream(getter_AddRefs(m_tempMessageStream), localFile, PR_WRONLY | PR_CREATE_FILE | PR_TRUNCATE, 00700);</span>
<a href="#l89.365"></a><span id="l89.365" class="difflineplus">+  rv = MsgNewBufferedFileOutputStream(getter_AddRefs(m_tempMessageStream), aFile, PR_WRONLY | PR_CREATE_FILE | PR_TRUNCATE, 00700);</span>
<a href="#l89.366"></a><span id="l89.366">   if (m_tempMessageStream &amp;&amp; addDummyEnvelope)</span>
<a href="#l89.367"></a><span id="l89.367">   {</span>
<a href="#l89.368"></a><span id="l89.368">     nsCAutoString result;</span>
<a href="#l89.369"></a><span id="l89.369">     char *ct;</span>
<a href="#l89.370"></a><span id="l89.370">     PRUint32 writeCount;</span>
<a href="#l89.371"></a><span id="l89.371">     time_t now = time ((time_t*) 0);</span>
<a href="#l89.372"></a><span id="l89.372">     ct = ctime(&amp;now);</span>
<a href="#l89.373"></a><span id="l89.373">     ct[24] = 0;</span>
<a href="#l89.374"></a><span id="l89.374" class="difflineat">@@ -6590,24 +6587,24 @@ nsresult nsMsgIMAPFolderACL::CreateACLRi</span>
<a href="#l89.375"></a><span id="l89.375">       if (!aRightsString.IsEmpty()) aRightsString.AppendLiteral(&quot;, &quot;);</span>
<a href="#l89.376"></a><span id="l89.376">       bundle-&gt;GetStringFromID(IMAP_ACL_ADMINISTER_RIGHT, getter_Copies(curRight));</span>
<a href="#l89.377"></a><span id="l89.377">       aRightsString.Append(curRight);</span>
<a href="#l89.378"></a><span id="l89.378">     }</span>
<a href="#l89.379"></a><span id="l89.379">   }</span>
<a href="#l89.380"></a><span id="l89.380">   return rv;</span>
<a href="#l89.381"></a><span id="l89.381"> }</span>
<a href="#l89.382"></a><span id="l89.382"> </span>
<a href="#l89.383"></a><span id="l89.383" class="difflineminus">-NS_IMETHODIMP nsImapMailFolder::GetFilePath(nsILocalFile ** aPathName)</span>
<a href="#l89.384"></a><span id="l89.384" class="difflineplus">+NS_IMETHODIMP nsImapMailFolder::GetFilePath(nsIFile ** aPathName)</span>
<a href="#l89.385"></a><span id="l89.385"> {</span>
<a href="#l89.386"></a><span id="l89.386">   // this will return a copy of mPath, which is what we want.</span>
<a href="#l89.387"></a><span id="l89.387">   // this will also initialize mPath using parseURI if it isn't already done</span>
<a href="#l89.388"></a><span id="l89.388">   return nsMsgDBFolder::GetFilePath(aPathName);</span>
<a href="#l89.389"></a><span id="l89.389"> }</span>
<a href="#l89.390"></a><span id="l89.390"> </span>
<a href="#l89.391"></a><span id="l89.391" class="difflineminus">-NS_IMETHODIMP nsImapMailFolder::SetFilePath(nsILocalFile * aPathName)</span>
<a href="#l89.392"></a><span id="l89.392" class="difflineplus">+NS_IMETHODIMP nsImapMailFolder::SetFilePath(nsIFile * aPathName)</span>
<a href="#l89.393"></a><span id="l89.393"> {</span>
<a href="#l89.394"></a><span id="l89.394">   return nsMsgDBFolder::SetFilePath(aPathName);   // call base class so mPath will get set</span>
<a href="#l89.395"></a><span id="l89.395"> }</span>
<a href="#l89.396"></a><span id="l89.396"> </span>
<a href="#l89.397"></a><span id="l89.397"> nsresult nsImapMailFolder::DisplayStatusMsg(nsIImapUrl *aImapUrl, const nsAString&amp; msg)</span>
<a href="#l89.398"></a><span id="l89.398"> {</span>
<a href="#l89.399"></a><span id="l89.399">   nsCOMPtr&lt;nsIImapMockChannel&gt; mockChannel;</span>
<a href="#l89.400"></a><span id="l89.400">   aImapUrl-&gt;GetMockChannel(getter_AddRefs(mockChannel));</span>
<a href="#l89.401"></a><span id="l89.401" class="difflineat">@@ -7856,24 +7853,24 @@ nsImapMailFolder::CopyFolder(nsIMsgFolde</span>
<a href="#l89.402"></a><span id="l89.402">       nsString folderName;</span>
<a href="#l89.403"></a><span id="l89.403">       srcFolder-&gt;GetName(folderName);</span>
<a href="#l89.404"></a><span id="l89.404"> </span>
<a href="#l89.405"></a><span id="l89.405">       nsAutoString safeFolderName(folderName);</span>
<a href="#l89.406"></a><span id="l89.406">       NS_MsgHashIfNecessary(safeFolderName);</span>
<a href="#l89.407"></a><span id="l89.407"> </span>
<a href="#l89.408"></a><span id="l89.408">       srcFolder-&gt;ForceDBClosed();</span>
<a href="#l89.409"></a><span id="l89.409"> </span>
<a href="#l89.410"></a><span id="l89.410" class="difflineminus">-      nsCOMPtr&lt;nsILocalFile&gt; oldPathFile;</span>
<a href="#l89.411"></a><span id="l89.411" class="difflineplus">+      nsCOMPtr&lt;nsIFile&gt; oldPathFile;</span>
<a href="#l89.412"></a><span id="l89.412">       rv = srcFolder-&gt;GetFilePath(getter_AddRefs(oldPathFile));</span>
<a href="#l89.413"></a><span id="l89.413">       NS_ENSURE_SUCCESS(rv,rv);</span>
<a href="#l89.414"></a><span id="l89.414"> </span>
<a href="#l89.415"></a><span id="l89.415" class="difflineminus">-      nsCOMPtr &lt;nsILocalFile&gt; summaryFile;</span>
<a href="#l89.416"></a><span id="l89.416" class="difflineplus">+      nsCOMPtr &lt;nsIFile&gt; summaryFile;</span>
<a href="#l89.417"></a><span id="l89.417">       GetSummaryFileLocation(oldPathFile, getter_AddRefs(summaryFile));</span>
<a href="#l89.418"></a><span id="l89.418"> </span>
<a href="#l89.419"></a><span id="l89.419" class="difflineminus">-      nsCOMPtr&lt;nsILocalFile&gt; newPathFile;</span>
<a href="#l89.420"></a><span id="l89.420" class="difflineplus">+      nsCOMPtr&lt;nsIFile&gt; newPathFile;</span>
<a href="#l89.421"></a><span id="l89.421">       rv = GetFilePath(getter_AddRefs(newPathFile));</span>
<a href="#l89.422"></a><span id="l89.422">       NS_ENSURE_SUCCESS(rv,rv);</span>
<a href="#l89.423"></a><span id="l89.423"> </span>
<a href="#l89.424"></a><span id="l89.424">       bool isDirectory = false;</span>
<a href="#l89.425"></a><span id="l89.425">       newPathFile-&gt;IsDirectory(&amp;isDirectory);</span>
<a href="#l89.426"></a><span id="l89.426">       if (!isDirectory)</span>
<a href="#l89.427"></a><span id="l89.427">       {</span>
<a href="#l89.428"></a><span id="l89.428">         AddDirectorySeparator(newPathFile);</span>
<a href="#l89.429"></a><span id="l89.429" class="difflineat">@@ -7905,17 +7902,17 @@ nsImapMailFolder::CopyFolder(nsIMsgFolde</span>
<a href="#l89.430"></a><span id="l89.430">       srcFolder-&gt;SetParent(nsnull);</span>
<a href="#l89.431"></a><span id="l89.431">       if (msgParent)</span>
<a href="#l89.432"></a><span id="l89.432">       {</span>
<a href="#l89.433"></a><span id="l89.433">         msgParent-&gt;PropagateDelete(srcFolder, false, msgWindow);  // The files have already been moved, so delete storage false</span>
<a href="#l89.434"></a><span id="l89.434">         oldPathFile-&gt;Remove(false);  //berkeley mailbox</span>
<a href="#l89.435"></a><span id="l89.435">         nsCOMPtr &lt;nsIMsgDatabase&gt; srcDB; // we need to force closed the source db</span>
<a href="#l89.436"></a><span id="l89.436">         srcFolder-&gt;Delete();</span>
<a href="#l89.437"></a><span id="l89.437"> </span>
<a href="#l89.438"></a><span id="l89.438" class="difflineminus">-        nsCOMPtr&lt;nsILocalFile&gt; parentPathFile;</span>
<a href="#l89.439"></a><span id="l89.439" class="difflineplus">+        nsCOMPtr&lt;nsIFile&gt; parentPathFile;</span>
<a href="#l89.440"></a><span id="l89.440">         rv = msgParent-&gt;GetFilePath(getter_AddRefs(parentPathFile));</span>
<a href="#l89.441"></a><span id="l89.441">         NS_ENSURE_SUCCESS(rv,rv);</span>
<a href="#l89.442"></a><span id="l89.442"> </span>
<a href="#l89.443"></a><span id="l89.443">         AddDirectorySeparator(parentPathFile);</span>
<a href="#l89.444"></a><span id="l89.444">         nsCOMPtr &lt;nsISimpleEnumerator&gt; children;</span>
<a href="#l89.445"></a><span id="l89.445">         parentPathFile-&gt;GetDirectoryEntries(getter_AddRefs(children));</span>
<a href="#l89.446"></a><span id="l89.446">         bool more;</span>
<a href="#l89.447"></a><span id="l89.447">         // checks if the directory is empty or not</span>
<a href="#l89.448"></a><span id="l89.448" class="difflineat">@@ -8213,17 +8210,17 @@ nsImapMailFolder::InitCopyState(nsISuppo</span>
<a href="#l89.449"></a><span id="l89.449">   m_copyState-&gt;m_selectedState = selectedState;</span>
<a href="#l89.450"></a><span id="l89.450">   m_copyState-&gt;m_msgWindow = msgWindow;</span>
<a href="#l89.451"></a><span id="l89.451">   if (listener)</span>
<a href="#l89.452"></a><span id="l89.452">     m_copyState-&gt;m_listener = do_QueryInterface(listener, &amp;rv);</span>
<a href="#l89.453"></a><span id="l89.453">   return rv;</span>
<a href="#l89.454"></a><span id="l89.454"> }</span>
<a href="#l89.455"></a><span id="l89.455"> </span>
<a href="#l89.456"></a><span id="l89.456"> nsresult</span>
<a href="#l89.457"></a><span id="l89.457" class="difflineminus">-nsImapMailFolder::CopyFileToOfflineStore(nsILocalFile *srcFile, nsMsgKey msgKey)</span>
<a href="#l89.458"></a><span id="l89.458" class="difflineplus">+nsImapMailFolder::CopyFileToOfflineStore(nsIFile *srcFile, nsMsgKey msgKey)</span>
<a href="#l89.459"></a><span id="l89.459"> {</span>
<a href="#l89.460"></a><span id="l89.460">   nsCOMPtr&lt;nsIMsgDatabase&gt; db;</span>
<a href="#l89.461"></a><span id="l89.461">   nsresult rv = GetMsgDatabase(getter_AddRefs(db));</span>
<a href="#l89.462"></a><span id="l89.462"> </span>
<a href="#l89.463"></a><span id="l89.463">   if (mDatabase)</span>
<a href="#l89.464"></a><span id="l89.464">   {</span>
<a href="#l89.465"></a><span id="l89.465">     if (msgKey == nsMsgKey_None)</span>
<a href="#l89.466"></a><span id="l89.466">       mDatabase-&gt;GetNextFakeOfflineMsgKey(&amp;msgKey);</span>
<a href="#l89.467"></a><span id="l89.467" class="difflineat">@@ -8326,17 +8323,17 @@ nsImapMailFolder::CopyFileToOfflineStore</span>
<a href="#l89.468"></a><span id="l89.468"> </span>
<a href="#l89.469"></a><span id="l89.469"> nsresult</span>
<a href="#l89.470"></a><span id="l89.470"> nsImapMailFolder::OnCopyCompleted(nsISupports *srcSupport, nsresult rv)</span>
<a href="#l89.471"></a><span id="l89.471"> {</span>
<a href="#l89.472"></a><span id="l89.472">   // if it's a file, and the copy succeeded, then fcc the offline</span>
<a href="#l89.473"></a><span id="l89.473">   // store, and add a kMoveResult offline op.</span>
<a href="#l89.474"></a><span id="l89.474">   if (NS_SUCCEEDED(rv) &amp;&amp; m_copyState)</span>
<a href="#l89.475"></a><span id="l89.475">   {</span>
<a href="#l89.476"></a><span id="l89.476" class="difflineminus">-    nsCOMPtr&lt;nsILocalFile&gt; srcFile(do_QueryInterface(srcSupport));</span>
<a href="#l89.477"></a><span id="l89.477" class="difflineplus">+    nsCOMPtr&lt;nsIFile&gt; srcFile(do_QueryInterface(srcSupport));</span>
<a href="#l89.478"></a><span id="l89.478">     if (srcFile &amp;&amp; (mFlags &amp; nsMsgFolderFlags::Offline) &amp;&amp; !WeAreOffline())</span>
<a href="#l89.479"></a><span id="l89.479">       (void) CopyFileToOfflineStore(srcFile, m_copyState-&gt;m_appendUID);</span>
<a href="#l89.480"></a><span id="l89.480">   }</span>
<a href="#l89.481"></a><span id="l89.481">   m_copyState = nsnull;</span>
<a href="#l89.482"></a><span id="l89.482">   nsresult result;</span>
<a href="#l89.483"></a><span id="l89.483">   nsCOMPtr&lt;nsIMsgCopyService&gt; copyService = do_GetService(NS_MSGCOPYSERVICE_CONTRACTID, &amp;result);</span>
<a href="#l89.484"></a><span id="l89.484">   NS_ENSURE_SUCCESS(result, result);</span>
<a href="#l89.485"></a><span id="l89.485">   return copyService-&gt;NotifyCompletion(srcSupport, this, rv);</span>
<a href="#l89.486"></a><span id="l89.486" class="difflineat">@@ -8596,17 +8593,17 @@ NS_IMETHODIMP nsImapMailFolder::PerformE</span>
<a href="#l89.487"></a><span id="l89.487">     rv = imapService-&gt;DiscoverChildren( this, this, m_onlineFolderName, nsnull);</span>
<a href="#l89.488"></a><span id="l89.488">   }</span>
<a href="#l89.489"></a><span id="l89.489">   return rv;</span>
<a href="#l89.490"></a><span id="l89.490"> }</span>
<a href="#l89.491"></a><span id="l89.491"> </span>
<a href="#l89.492"></a><span id="l89.492"> NS_IMETHODIMP nsImapMailFolder::RenameClient(nsIMsgWindow *msgWindow, nsIMsgFolder *msgFolder, const nsACString&amp; oldName, const nsACString&amp; newName)</span>
<a href="#l89.493"></a><span id="l89.493"> {</span>
<a href="#l89.494"></a><span id="l89.494">   nsresult rv;</span>
<a href="#l89.495"></a><span id="l89.495" class="difflineminus">-  nsCOMPtr&lt;nsILocalFile&gt; pathFile;</span>
<a href="#l89.496"></a><span id="l89.496" class="difflineplus">+  nsCOMPtr&lt;nsIFile&gt; pathFile;</span>
<a href="#l89.497"></a><span id="l89.497">   rv = GetFilePath(getter_AddRefs(pathFile));</span>
<a href="#l89.498"></a><span id="l89.498">   if (NS_FAILED(rv)) return rv;</span>
<a href="#l89.499"></a><span id="l89.499"> </span>
<a href="#l89.500"></a><span id="l89.500">   nsCOMPtr&lt;nsIMsgImapMailFolder&gt; oldImapFolder = do_QueryInterface(msgFolder, &amp;rv);</span>
<a href="#l89.501"></a><span id="l89.501">   if (NS_FAILED(rv)) return rv;</span>
<a href="#l89.502"></a><span id="l89.502"> </span>
<a href="#l89.503"></a><span id="l89.503">   char hierarchyDelimiter = '/';</span>
<a href="#l89.504"></a><span id="l89.504">   oldImapFolder-&gt;GetHierarchyDelimiter(&amp;hierarchyDelimiter);</span>
<a href="#l89.505"></a><span id="l89.505" class="difflineat">@@ -8634,17 +8631,17 @@ NS_IMETHODIMP nsImapMailFolder::RenameCl</span>
<a href="#l89.506"></a><span id="l89.506">   nsCOMPtr&lt;nsIMsgDatabase&gt; mailDBFactory;</span>
<a href="#l89.507"></a><span id="l89.507">   nsCOMPtr&lt;nsIMsgFolder&gt; child;</span>
<a href="#l89.508"></a><span id="l89.508">   nsCOMPtr &lt;nsIMsgImapMailFolder&gt; imapFolder;</span>
<a href="#l89.509"></a><span id="l89.509"> </span>
<a href="#l89.510"></a><span id="l89.510">   nsCOMPtr&lt;nsIMsgDBService&gt; msgDBService = do_GetService(NS_MSGDB_SERVICE_CONTRACTID, &amp;rv);</span>
<a href="#l89.511"></a><span id="l89.511">   NS_ENSURE_SUCCESS(rv, rv);</span>
<a href="#l89.512"></a><span id="l89.512"> </span>
<a href="#l89.513"></a><span id="l89.513">   nsCOMPtr&lt;nsIMsgDatabase&gt; unusedDB;</span>
<a href="#l89.514"></a><span id="l89.514" class="difflineminus">-  nsCOMPtr &lt;nsILocalFile&gt; dbFile;</span>
<a href="#l89.515"></a><span id="l89.515" class="difflineplus">+  nsCOMPtr &lt;nsIFile&gt; dbFile;</span>
<a href="#l89.516"></a><span id="l89.516"> </span>
<a href="#l89.517"></a><span id="l89.517">   // warning, path will be changed</span>
<a href="#l89.518"></a><span id="l89.518">   rv = CreateFileForDB(newLeafName, pathFile, getter_AddRefs(dbFile));</span>
<a href="#l89.519"></a><span id="l89.519">   NS_ENSURE_SUCCESS(rv,rv);</span>
<a href="#l89.520"></a><span id="l89.520"> </span>
<a href="#l89.521"></a><span id="l89.521">   // Use openMailDBFromFile() and not OpenFolderDB() here, since we don't use the DB.</span>
<a href="#l89.522"></a><span id="l89.522">   rv = msgDBService-&gt;OpenMailDBFromFile(dbFile, nsnull, true, true,</span>
<a href="#l89.523"></a><span id="l89.523">                                         getter_AddRefs(unusedDB));</span>
<a href="#l89.524"></a><span id="l89.524" class="difflineat">@@ -8735,37 +8732,37 @@ NS_IMETHODIMP nsImapMailFolder::RenameSu</span>
<a href="#l89.525"></a><span id="l89.525">     folder-&gt;GetHierarchyDelimiter(&amp;hierarchyDelimiter);</span>
<a href="#l89.526"></a><span id="l89.526"> </span>
<a href="#l89.527"></a><span id="l89.527">     PRInt32 boxflags;</span>
<a href="#l89.528"></a><span id="l89.528">     folder-&gt;GetBoxFlags(&amp;boxflags);</span>
<a href="#l89.529"></a><span id="l89.529"> </span>
<a href="#l89.530"></a><span id="l89.530">     bool verified;</span>
<a href="#l89.531"></a><span id="l89.531">     folder-&gt;GetVerifiedAsOnlineFolder(&amp;verified);</span>
<a href="#l89.532"></a><span id="l89.532"> </span>
<a href="#l89.533"></a><span id="l89.533" class="difflineminus">-    nsCOMPtr&lt;nsILocalFile&gt; oldPathFile;</span>
<a href="#l89.534"></a><span id="l89.534" class="difflineplus">+    nsCOMPtr&lt;nsIFile&gt; oldPathFile;</span>
<a href="#l89.535"></a><span id="l89.535">     rv = msgFolder-&gt;GetFilePath(getter_AddRefs(oldPathFile));</span>
<a href="#l89.536"></a><span id="l89.536">     if (NS_FAILED(rv)) return rv;</span>
<a href="#l89.537"></a><span id="l89.537"> </span>
<a href="#l89.538"></a><span id="l89.538" class="difflineminus">-    nsCOMPtr&lt;nsILocalFile&gt; newParentPathFile;</span>
<a href="#l89.539"></a><span id="l89.539" class="difflineplus">+    nsCOMPtr&lt;nsIFile&gt; newParentPathFile;</span>
<a href="#l89.540"></a><span id="l89.540">     rv = GetFilePath(getter_AddRefs(newParentPathFile));</span>
<a href="#l89.541"></a><span id="l89.541">     if (NS_FAILED(rv)) return rv;</span>
<a href="#l89.542"></a><span id="l89.542"> </span>
<a href="#l89.543"></a><span id="l89.543">     rv = AddDirectorySeparator(newParentPathFile);</span>
<a href="#l89.544"></a><span id="l89.544">     nsCAutoString oldLeafName;</span>
<a href="#l89.545"></a><span id="l89.545">     oldPathFile-&gt;GetNativeLeafName(oldLeafName);</span>
<a href="#l89.546"></a><span id="l89.546">     newParentPathFile-&gt;AppendNative(oldLeafName);</span>
<a href="#l89.547"></a><span id="l89.547"> </span>
<a href="#l89.548"></a><span id="l89.548">     nsCString newPathStr;</span>
<a href="#l89.549"></a><span id="l89.549">     newParentPathFile-&gt;GetNativePath(newPathStr);</span>
<a href="#l89.550"></a><span id="l89.550"> </span>
<a href="#l89.551"></a><span id="l89.551" class="difflineminus">-    nsCOMPtr&lt;nsILocalFile&gt; newPathFile = do_CreateInstance(NS_LOCAL_FILE_CONTRACTID, &amp;rv);</span>
<a href="#l89.552"></a><span id="l89.552" class="difflineplus">+    nsCOMPtr&lt;nsIFile&gt; newPathFile = do_CreateInstance(NS_LOCAL_FILE_CONTRACTID, &amp;rv);</span>
<a href="#l89.553"></a><span id="l89.553">     NS_ENSURE_SUCCESS(rv, rv);</span>
<a href="#l89.554"></a><span id="l89.554">     newPathFile-&gt;InitWithFile(newParentPathFile);</span>
<a href="#l89.555"></a><span id="l89.555"> </span>
<a href="#l89.556"></a><span id="l89.556" class="difflineminus">-    nsCOMPtr&lt;nsILocalFile&gt; dbFilePath = newPathFile;</span>
<a href="#l89.557"></a><span id="l89.557" class="difflineplus">+    nsCOMPtr&lt;nsIFile&gt; dbFilePath = newPathFile;</span>
<a href="#l89.558"></a><span id="l89.558"> </span>
<a href="#l89.559"></a><span id="l89.559">     nsCOMPtr&lt;nsIMsgFolder&gt; child;</span>
<a href="#l89.560"></a><span id="l89.560"> </span>
<a href="#l89.561"></a><span id="l89.561">     nsString folderName;</span>
<a href="#l89.562"></a><span id="l89.562">     rv = msgFolder-&gt;GetName(folderName);</span>
<a href="#l89.563"></a><span id="l89.563">     if (folderName.IsEmpty() || NS_FAILED(rv)) return rv;</span>
<a href="#l89.564"></a><span id="l89.564"> </span>
<a href="#l89.565"></a><span id="l89.565">     nsCString utf7LeafName;</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l90.1"></a><span id="l90.1" class="difflineminus">--- a/mailnews/imap/src/nsImapMailFolder.h</span>
<a href="#l90.2"></a><span id="l90.2" class="difflineplus">+++ b/mailnews/imap/src/nsImapMailFolder.h</span>
<a href="#l90.3"></a><span id="l90.3" class="difflineat">@@ -264,18 +264,18 @@ public:</span>
<a href="#l90.4"></a><span id="l90.4">                               nsIMsgDBHdr* msgToReplace,</span>
<a href="#l90.5"></a><span id="l90.5">                               bool isDraftOrTemplate,</span>
<a href="#l90.6"></a><span id="l90.6">                               PRUint32 aNewMsgFlags,</span>
<a href="#l90.7"></a><span id="l90.7">                               const nsACString &amp;aNewMsgKeywords,</span>
<a href="#l90.8"></a><span id="l90.8">                               nsIMsgWindow *msgWindow,</span>
<a href="#l90.9"></a><span id="l90.9">                               nsIMsgCopyServiceListener* listener);</span>
<a href="#l90.10"></a><span id="l90.10">   NS_IMETHOD GetNewMessages(nsIMsgWindow *aWindow, nsIUrlListener *aListener);</span>
<a href="#l90.11"></a><span id="l90.11"> </span>
<a href="#l90.12"></a><span id="l90.12" class="difflineminus">-  NS_IMETHOD GetFilePath(nsILocalFile** aPathName);</span>
<a href="#l90.13"></a><span id="l90.13" class="difflineminus">-  NS_IMETHOD SetFilePath(nsILocalFile * aPath);</span>
<a href="#l90.14"></a><span id="l90.14" class="difflineplus">+  NS_IMETHOD GetFilePath(nsIFile** aPathName);</span>
<a href="#l90.15"></a><span id="l90.15" class="difflineplus">+  NS_IMETHOD SetFilePath(nsIFile * aPath);</span>
<a href="#l90.16"></a><span id="l90.16"> </span>
<a href="#l90.17"></a><span id="l90.17">   NS_IMETHOD Shutdown(bool shutdownChildren);</span>
<a href="#l90.18"></a><span id="l90.18"> </span>
<a href="#l90.19"></a><span id="l90.19">   NS_IMETHOD DownloadMessagesForOffline(nsIArray *messages, nsIMsgWindow *msgWindow);</span>
<a href="#l90.20"></a><span id="l90.20"> </span>
<a href="#l90.21"></a><span id="l90.21">   NS_IMETHOD DownloadAllForOffline(nsIUrlListener *listener, nsIMsgWindow *msgWindow);</span>
<a href="#l90.22"></a><span id="l90.22">   NS_IMETHOD GetCanFileMessages(bool *aCanFileMessages);</span>
<a href="#l90.23"></a><span id="l90.23">   NS_IMETHOD GetCanDeleteMessages(bool *aCanDeleteMessages);</span>
<a href="#l90.24"></a><span id="l90.24" class="difflineat">@@ -300,17 +300,17 @@ public:</span>
<a href="#l90.25"></a><span id="l90.25"> </span>
<a href="#l90.26"></a><span id="l90.26">   NS_DECL_NSIMSGFILTERHITNOTIFY</span>
<a href="#l90.27"></a><span id="l90.27">   NS_DECL_NSIJUNKMAILCLASSIFICATIONLISTENER</span>
<a href="#l90.28"></a><span id="l90.28"> </span>
<a href="#l90.29"></a><span id="l90.29">   NS_IMETHOD IsCommandEnabled(const nsACString&amp; command, bool *result);</span>
<a href="#l90.30"></a><span id="l90.30">   NS_IMETHOD SetFilterList(nsIMsgFilterList *aMsgFilterList);</span>
<a href="#l90.31"></a><span id="l90.31">   NS_IMETHOD GetCustomIdentity(nsIMsgIdentity **aIdentity);</span>
<a href="#l90.32"></a><span id="l90.32"> </span>
<a href="#l90.33"></a><span id="l90.33" class="difflineminus">-  nsresult AddSubfolderWithPath(nsAString&amp; name, nsILocalFile *dbPath, nsIMsgFolder **child, bool brandNew = false);</span>
<a href="#l90.34"></a><span id="l90.34" class="difflineplus">+  nsresult AddSubfolderWithPath(nsAString&amp; name, nsIFile *dbPath, nsIMsgFolder **child, bool brandNew = false);</span>
<a href="#l90.35"></a><span id="l90.35">   nsresult MoveIncorporatedMessage(nsIMsgDBHdr *mailHdr,</span>
<a href="#l90.36"></a><span id="l90.36">                                   nsIMsgDatabase *sourceDB,</span>
<a href="#l90.37"></a><span id="l90.37">                                   const nsACString&amp; destFolder,</span>
<a href="#l90.38"></a><span id="l90.38">                                   nsIMsgFilter *filter,</span>
<a href="#l90.39"></a><span id="l90.39">                                   nsIMsgWindow *msgWindow);</span>
<a href="#l90.40"></a><span id="l90.40"> </span>
<a href="#l90.41"></a><span id="l90.41">   // send notification to copy service listener.</span>
<a href="#l90.42"></a><span id="l90.42">   nsresult OnCopyCompleted(nsISupports *srcSupport, nsresult exitCode);</span>
<a href="#l90.43"></a><span id="l90.43" class="difflineat">@@ -342,17 +342,17 @@ protected:</span>
<a href="#l90.44"></a><span id="l90.44">   nsresult NotifyMessageFlagsFromHdr(nsIMsgDBHdr *dbHdr, nsMsgKey msgKey,</span>
<a href="#l90.45"></a><span id="l90.45">                                      PRUint32 flags);</span>
<a href="#l90.46"></a><span id="l90.46"> </span>
<a href="#l90.47"></a><span id="l90.47">   nsresult SetupHeaderParseStream(PRUint32 size, const nsACString&amp; content_type, nsIMailboxSpec *boxSpec);</span>
<a href="#l90.48"></a><span id="l90.48">   nsresult  ParseAdoptedHeaderLine(const char *messageLine, PRUint32 msgKey);</span>
<a href="#l90.49"></a><span id="l90.49">   nsresult  NormalEndHeaderParseStream(nsIImapProtocol *aProtocol, nsIImapUrl *imapUrl);</span>
<a href="#l90.50"></a><span id="l90.50"> </span>
<a href="#l90.51"></a><span id="l90.51">   void EndOfflineDownload();</span>
<a href="#l90.52"></a><span id="l90.52" class="difflineminus">-  nsresult CopyFileToOfflineStore(nsILocalFile *srcFile, nsMsgKey msgKey);</span>
<a href="#l90.53"></a><span id="l90.53" class="difflineplus">+  nsresult CopyFileToOfflineStore(nsIFile *srcFile, nsMsgKey msgKey);</span>
<a href="#l90.54"></a><span id="l90.54"> </span>
<a href="#l90.55"></a><span id="l90.55">   nsresult MarkMessagesImapDeleted(nsTArray&lt;nsMsgKey&gt; *keyArray, bool deleted, nsIMsgDatabase *db);</span>
<a href="#l90.56"></a><span id="l90.56"> </span>
<a href="#l90.57"></a><span id="l90.57">   // Notifies imap autosync that it should update this folder when it</span>
<a href="#l90.58"></a><span id="l90.58">   // gets a chance.</span>
<a href="#l90.59"></a><span id="l90.59">   void NotifyHasPendingMsgs();</span>
<a href="#l90.60"></a><span id="l90.60">   void UpdatePendingCounts();</span>
<a href="#l90.61"></a><span id="l90.61">   void SetIMAPDeletedFlag(nsIMsgDatabase *mailDB, const nsTArray&lt;nsMsgKey&gt; &amp;msgids, bool markDeleted);</span>
<a href="#l90.62"></a><span id="l90.62" class="difflineat">@@ -361,18 +361,18 @@ protected:</span>
<a href="#l90.63"></a><span id="l90.63">   nsresult GetFolder(const nsACString&amp; name, nsIMsgFolder **pFolder);</span>
<a href="#l90.64"></a><span id="l90.64">   nsresult GetTrashFolder(nsIMsgFolder **pTrashFolder);</span>
<a href="#l90.65"></a><span id="l90.65">   bool TrashOrDescendentOfTrash(nsIMsgFolder* folder);</span>
<a href="#l90.66"></a><span id="l90.66">   static bool ShouldCheckAllFolders(nsIImapIncomingServer *imapServer);</span>
<a href="#l90.67"></a><span id="l90.67">   nsresult GetServerKey(nsACString&amp; serverKey);</span>
<a href="#l90.68"></a><span id="l90.68">   nsresult DisplayStatusMsg(nsIImapUrl *aImapUrl, const nsAString&amp; msg);</span>
<a href="#l90.69"></a><span id="l90.69"> </span>
<a href="#l90.70"></a><span id="l90.70">   //nsresult RenameLocal(const char *newName);</span>
<a href="#l90.71"></a><span id="l90.71" class="difflineminus">-  nsresult AddDirectorySeparator(nsILocalFile *path);</span>
<a href="#l90.72"></a><span id="l90.72" class="difflineminus">-  nsresult CreateSubFolders(nsILocalFile *path);</span>
<a href="#l90.73"></a><span id="l90.73" class="difflineplus">+  nsresult AddDirectorySeparator(nsIFile *path);</span>
<a href="#l90.74"></a><span id="l90.74" class="difflineplus">+  nsresult CreateSubFolders(nsIFile *path);</span>
<a href="#l90.75"></a><span id="l90.75">   nsresult GetDatabase();</span>
<a href="#l90.76"></a><span id="l90.76">   virtual void GetIncomingServerType(nsCString&amp; serverType) { serverType.AssignLiteral(&quot;imap&quot;);}</span>
<a href="#l90.77"></a><span id="l90.77"> </span>
<a href="#l90.78"></a><span id="l90.78">   nsresult        GetFolderOwnerUserName(nsACString&amp; userName);</span>
<a href="#l90.79"></a><span id="l90.79">   nsIMAPNamespace *GetNamespaceForFolder();</span>
<a href="#l90.80"></a><span id="l90.80">   void            SetNamespaceForFolder(nsIMAPNamespace *ns);</span>
<a href="#l90.81"></a><span id="l90.81"> </span>
<a href="#l90.82"></a><span id="l90.82">   nsMsgIMAPFolderACL * GetFolderACL();</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l91.1"></a><span id="l91.1" class="difflineminus">--- a/mailnews/imap/src/nsImapOfflineSync.h</span>
<a href="#l91.2"></a><span id="l91.2" class="difflineplus">+++ b/mailnews/imap/src/nsImapOfflineSync.h</span>
<a href="#l91.3"></a><span id="l91.3" class="difflineat">@@ -60,17 +60,17 @@ protected:</span>
<a href="#l91.4"></a><span id="l91.4"> </span>
<a href="#l91.5"></a><span id="l91.5">   nsCOMPtr &lt;nsIMsgFolder&gt; m_currentFolder;</span>
<a href="#l91.6"></a><span id="l91.6">   nsCOMPtr &lt;nsIMsgFolder&gt; m_singleFolderToUpdate;</span>
<a href="#l91.7"></a><span id="l91.7">   nsCOMPtr &lt;nsIMsgWindow&gt; m_window;</span>
<a href="#l91.8"></a><span id="l91.8">   nsCOMPtr &lt;nsISupportsArray&gt; m_allServers;</span>
<a href="#l91.9"></a><span id="l91.9">   nsCOMPtr &lt;nsISupportsArray&gt; m_allFolders;</span>
<a href="#l91.10"></a><span id="l91.10">   nsCOMPtr &lt;nsIMsgIncomingServer&gt; m_currentServer;</span>
<a href="#l91.11"></a><span id="l91.11">   nsCOMPtr &lt;nsIEnumerator&gt; m_serverEnumerator;</span>
<a href="#l91.12"></a><span id="l91.12" class="difflineminus">-  nsCOMPtr &lt;nsILocalFile&gt; m_curTempFile;</span>
<a href="#l91.13"></a><span id="l91.13" class="difflineplus">+  nsCOMPtr &lt;nsIFile&gt; m_curTempFile;</span>
<a href="#l91.14"></a><span id="l91.14">   </span>
<a href="#l91.15"></a><span id="l91.15">   nsTArray&lt;nsMsgKey&gt; m_CurrentKeys;</span>
<a href="#l91.16"></a><span id="l91.16">   nsCOMArray&lt;nsIMsgOfflineImapOperation&gt; m_currentOpsToClear;</span>
<a href="#l91.17"></a><span id="l91.17">   PRUint32      m_KeyIndex;</span>
<a href="#l91.18"></a><span id="l91.18">   nsCOMPtr &lt;nsIMsgDatabase&gt; m_currentDB;</span>
<a href="#l91.19"></a><span id="l91.19">   nsCOMPtr &lt;nsIUrlListener&gt; m_listener;</span>
<a href="#l91.20"></a><span id="l91.20">   PRInt32	mCurrentUIDValidity;</span>
<a href="#l91.21"></a><span id="l91.21">   PRInt32	mCurrentPlaybackOpType;	// kFlagsChanged -&gt; kMsgCopy -&gt; kMsgMoved</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l92.1"></a><span id="l92.1" class="difflineminus">--- a/mailnews/imap/src/nsImapProtocol.cpp</span>
<a href="#l92.2"></a><span id="l92.2" class="difflineplus">+++ b/mailnews/imap/src/nsImapProtocol.cpp</span>
<a href="#l92.3"></a><span id="l92.3" class="difflineat">@@ -5964,18 +5964,17 @@ void nsImapProtocol::UploadMessageFromFi</span>
<a href="#l92.4"></a><span id="l92.4">     }</span>
<a href="#l92.5"></a><span id="l92.5">     command.Append(&quot; {&quot;);</span>
<a href="#l92.6"></a><span id="l92.6"> </span>
<a href="#l92.7"></a><span id="l92.7">     dataBuffer = (char*) PR_CALLOC(COPY_BUFFER_SIZE+1);</span>
<a href="#l92.8"></a><span id="l92.8">     if (!dataBuffer) goto done;</span>
<a href="#l92.9"></a><span id="l92.9">     rv = file-&gt;GetFileSize(&amp;fileSize);</span>
<a href="#l92.10"></a><span id="l92.10">     NS_ASSERTION(fileSize, &quot;got empty file in UploadMessageFromFile&quot;);</span>
<a href="#l92.11"></a><span id="l92.11">     if (NS_FAILED(rv) || !fileSize) goto done;</span>
<a href="#l92.12"></a><span id="l92.12" class="difflineminus">-    nsCOMPtr &lt;nsILocalFile&gt; localFile = do_QueryInterface(file);</span>
<a href="#l92.13"></a><span id="l92.13" class="difflineminus">-    rv = NS_NewLocalFileInputStream(getter_AddRefs(fileInputStream), localFile);</span>
<a href="#l92.14"></a><span id="l92.14" class="difflineplus">+    rv = NS_NewLocalFileInputStream(getter_AddRefs(fileInputStream), file);</span>
<a href="#l92.15"></a><span id="l92.15">     if (NS_FAILED(rv) || !fileInputStream) goto done;</span>
<a href="#l92.16"></a><span id="l92.16">     command.AppendInt((PRInt32)fileSize);</span>
<a href="#l92.17"></a><span id="l92.17">     if (hasLiteralPlus)</span>
<a href="#l92.18"></a><span id="l92.18">       command.Append(&quot;+}&quot; CRLF);</span>
<a href="#l92.19"></a><span id="l92.19">     else</span>
<a href="#l92.20"></a><span id="l92.20">       command.Append(&quot;}&quot; CRLF);</span>
<a href="#l92.21"></a><span id="l92.21"> </span>
<a href="#l92.22"></a><span id="l92.22">     rv = SendData(command.get());</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l93.1"></a><span id="l93.1" class="difflineminus">--- a/mailnews/imap/src/nsImapService.cpp</span>
<a href="#l93.2"></a><span id="l93.2" class="difflineplus">+++ b/mailnews/imap/src/nsImapService.cpp</span>
<a href="#l93.3"></a><span id="l93.3" class="difflineat">@@ -2044,19 +2044,17 @@ nsresult nsImapService::OfflineAppendFro</span>
<a href="#l93.4"></a><span id="l93.4">           NS_ERROR(&quot;needs to be a random store!&quot;);</span>
<a href="#l93.5"></a><span id="l93.5">           return NS_ERROR_FAILURE;</span>
<a href="#l93.6"></a><span id="l93.6">         }</span>
<a href="#l93.7"></a><span id="l93.7"> </span>
<a href="#l93.8"></a><span id="l93.8">         nsCOMPtr &lt;nsIInputStream&gt; inputStream;</span>
<a href="#l93.9"></a><span id="l93.9">         nsCOMPtr &lt;nsIMsgParseMailMsgState&gt; msgParser = do_CreateInstance(NS_PARSEMAILMSGSTATE_CONTRACTID, &amp;rv);</span>
<a href="#l93.10"></a><span id="l93.10">         msgParser-&gt;SetMailDB(destDB);</span>
<a href="#l93.11"></a><span id="l93.11"> </span>
<a href="#l93.12"></a><span id="l93.12" class="difflineminus">-        nsCOMPtr &lt;nsILocalFile&gt; localFile = do_QueryInterface(aFile);</span>
<a href="#l93.13"></a><span id="l93.13" class="difflineminus">-        if (NS_SUCCEEDED(rv))</span>
<a href="#l93.14"></a><span id="l93.14" class="difflineminus">-          rv = NS_NewLocalFileInputStream(getter_AddRefs(inputStream), localFile);</span>
<a href="#l93.15"></a><span id="l93.15" class="difflineplus">+        rv = NS_NewLocalFileInputStream(getter_AddRefs(inputStream), aFile);</span>
<a href="#l93.16"></a><span id="l93.16">         if (NS_SUCCEEDED(rv) &amp;&amp; inputStream)</span>
<a href="#l93.17"></a><span id="l93.17">         {</span>
<a href="#l93.18"></a><span id="l93.18">           // now, copy the temp file to the offline store for the dest folder.</span>
<a href="#l93.19"></a><span id="l93.19">           PRInt32 inputBufferSize = 10240;</span>
<a href="#l93.20"></a><span id="l93.20">           nsMsgLineStreamBuffer *inputStreamBuffer = new nsMsgLineStreamBuffer(inputBufferSize, </span>
<a href="#l93.21"></a><span id="l93.21">                                                                                true,    // allocate new lines</span>
<a href="#l93.22"></a><span id="l93.22">                                                                                false);  // leave CRLFs on the returned string</span>
<a href="#l93.23"></a><span id="l93.23">           PRInt64 fileSize;</span>
<a href="#l93.24"></a><span id="l93.24" class="difflineat">@@ -2831,30 +2829,30 @@ NS_IMETHODIMP nsImapService::NewChannel(</span>
<a href="#l93.25"></a><span id="l93.25">       }</span>
<a href="#l93.26"></a><span id="l93.26">     }</span>
<a href="#l93.27"></a><span id="l93.27">   }</span>
<a href="#l93.28"></a><span id="l93.28">   if (NS_SUCCEEDED(rv))</span>
<a href="#l93.29"></a><span id="l93.29">     NS_IF_ADDREF(*aRetVal = channel);</span>
<a href="#l93.30"></a><span id="l93.30">   return rv;</span>
<a href="#l93.31"></a><span id="l93.31"> }</span>
<a href="#l93.32"></a><span id="l93.32"> </span>
<a href="#l93.33"></a><span id="l93.33" class="difflineminus">-NS_IMETHODIMP nsImapService::SetDefaultLocalPath(nsILocalFile *aPath)</span>
<a href="#l93.34"></a><span id="l93.34" class="difflineplus">+NS_IMETHODIMP nsImapService::SetDefaultLocalPath(nsIFile *aPath)</span>
<a href="#l93.35"></a><span id="l93.35"> {</span>
<a href="#l93.36"></a><span id="l93.36">   NS_ENSURE_ARG_POINTER(aPath);</span>
<a href="#l93.37"></a><span id="l93.37"> </span>
<a href="#l93.38"></a><span id="l93.38">   return NS_SetPersistentFile(PREF_MAIL_ROOT_IMAP_REL, PREF_MAIL_ROOT_IMAP, aPath);</span>
<a href="#l93.39"></a><span id="l93.39"> }</span>
<a href="#l93.40"></a><span id="l93.40"> </span>
<a href="#l93.41"></a><span id="l93.41" class="difflineminus">-NS_IMETHODIMP nsImapService::GetDefaultLocalPath(nsILocalFile **aResult)</span>
<a href="#l93.42"></a><span id="l93.42" class="difflineplus">+NS_IMETHODIMP nsImapService::GetDefaultLocalPath(nsIFile **aResult)</span>
<a href="#l93.43"></a><span id="l93.43"> {</span>
<a href="#l93.44"></a><span id="l93.44">   NS_ENSURE_ARG_POINTER(aResult);</span>
<a href="#l93.45"></a><span id="l93.45">   *aResult = nsnull;</span>
<a href="#l93.46"></a><span id="l93.46"> </span>
<a href="#l93.47"></a><span id="l93.47">   bool havePref;</span>
<a href="#l93.48"></a><span id="l93.48" class="difflineminus">-  nsCOMPtr&lt;nsILocalFile&gt; localFile;</span>
<a href="#l93.49"></a><span id="l93.49" class="difflineplus">+  nsCOMPtr&lt;nsIFile&gt; localFile;</span>
<a href="#l93.50"></a><span id="l93.50">   nsresult rv = NS_GetPersistentFile(PREF_MAIL_ROOT_IMAP_REL,</span>
<a href="#l93.51"></a><span id="l93.51">                                      PREF_MAIL_ROOT_IMAP,</span>
<a href="#l93.52"></a><span id="l93.52">                                      NS_APP_IMAP_MAIL_50_DIR,</span>
<a href="#l93.53"></a><span id="l93.53">                                      havePref,</span>
<a href="#l93.54"></a><span id="l93.54">                                      getter_AddRefs(localFile));</span>
<a href="#l93.55"></a><span id="l93.55">   NS_ENSURE_SUCCESS(rv, rv);</span>
<a href="#l93.56"></a><span id="l93.56">   NS_ENSURE_TRUE(localFile, NS_ERROR_FAILURE);</span>
<a href="#l93.57"></a><span id="l93.57"> </span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l94.1"></a><span id="l94.1" class="difflineminus">--- a/mailnews/import/applemail/src/nsAppleMailImport.cpp</span>
<a href="#l94.2"></a><span id="l94.2" class="difflineplus">+++ b/mailnews/import/applemail/src/nsAppleMailImport.cpp</span>
<a href="#l94.3"></a><span id="l94.3" class="difflineat">@@ -9,17 +9,17 @@</span>
<a href="#l94.4"></a><span id="l94.4"> #endif</span>
<a href="#l94.5"></a><span id="l94.5"> </span>
<a href="#l94.6"></a><span id="l94.6"> #include &quot;nsStringGlue.h&quot;</span>
<a href="#l94.7"></a><span id="l94.7"> #include &quot;nsCOMPtr.h&quot;</span>
<a href="#l94.8"></a><span id="l94.8"> #include &quot;nsISupportsPrimitives.h&quot;</span>
<a href="#l94.9"></a><span id="l94.9"> #include &quot;nsIImportService.h&quot;</span>
<a href="#l94.10"></a><span id="l94.10"> #include &quot;nsIImportMailboxDescriptor.h&quot;</span>
<a href="#l94.11"></a><span id="l94.11"> #include &quot;nsIImportGeneric.h&quot;</span>
<a href="#l94.12"></a><span id="l94.12" class="difflineminus">-#include &quot;nsILocalFile.h&quot;</span>
<a href="#l94.13"></a><span id="l94.13" class="difflineplus">+#include &quot;nsIFile.h&quot;</span>
<a href="#l94.14"></a><span id="l94.14"> #include &quot;nsIStringBundle.h&quot;</span>
<a href="#l94.15"></a><span id="l94.15"> #include &quot;nsIMsgFolder.h&quot;</span>
<a href="#l94.16"></a><span id="l94.16"> #include &quot;nsIMsgHdr.h&quot;</span>
<a href="#l94.17"></a><span id="l94.17"> #include &quot;nsIMsgPluggableStore.h&quot;</span>
<a href="#l94.18"></a><span id="l94.18"> #include &quot;nsNetUtil.h&quot;</span>
<a href="#l94.19"></a><span id="l94.19"> #include &quot;nsMsgUtils.h&quot;</span>
<a href="#l94.20"></a><span id="l94.20"> #include &quot;mozilla/Services.h&quot;</span>
<a href="#l94.21"></a><span id="l94.21"> </span>
<a href="#l94.22"></a><span id="l94.22" class="difflineat">@@ -160,17 +160,17 @@ NS_IMETHODIMP nsAppleMailImportMail::Get</span>
<a href="#l94.23"></a><span id="l94.23">   NS_ENSURE_ARG_POINTER(aLocation);</span>
<a href="#l94.24"></a><span id="l94.24">   NS_ENSURE_ARG_POINTER(aUserVerify);</span>
<a href="#l94.25"></a><span id="l94.25"> </span>
<a href="#l94.26"></a><span id="l94.26">   *aLocation = nsnull;</span>
<a href="#l94.27"></a><span id="l94.27">   *aFound = false;</span>
<a href="#l94.28"></a><span id="l94.28">   *aUserVerify = true;</span>
<a href="#l94.29"></a><span id="l94.29"> </span>
<a href="#l94.30"></a><span id="l94.30">   // try to find current user's top-level Mail folder</span>
<a href="#l94.31"></a><span id="l94.31" class="difflineminus">-  nsCOMPtr&lt;nsILocalFile&gt; mailFolder(do_CreateInstance(NS_LOCAL_FILE_CONTRACTID));</span>
<a href="#l94.32"></a><span id="l94.32" class="difflineplus">+  nsCOMPtr&lt;nsIFile&gt; mailFolder(do_CreateInstance(NS_LOCAL_FILE_CONTRACTID));</span>
<a href="#l94.33"></a><span id="l94.33">   if (mailFolder) {</span>
<a href="#l94.34"></a><span id="l94.34">     nsresult rv = mailFolder-&gt;InitWithNativePath(NS_LITERAL_CSTRING(DEFAULT_MAIL_FOLDER));</span>
<a href="#l94.35"></a><span id="l94.35">     if (NS_SUCCEEDED(rv)) {</span>
<a href="#l94.36"></a><span id="l94.36">       *aFound = true;</span>
<a href="#l94.37"></a><span id="l94.37">       *aUserVerify = false;</span>
<a href="#l94.38"></a><span id="l94.38">       CallQueryInterface(mailFolder, aLocation);</span>
<a href="#l94.39"></a><span id="l94.39">     }</span>
<a href="#l94.40"></a><span id="l94.40">   }</span>
<a href="#l94.41"></a><span id="l94.41" class="difflineat">@@ -204,30 +204,27 @@ NS_IMETHODIMP nsAppleMailImportMail::Fin</span>
<a href="#l94.42"></a><span id="l94.42"> </span>
<a href="#l94.43"></a><span id="l94.43">   // 1. look for accounts with mailboxes</span>
<a href="#l94.44"></a><span id="l94.44">   FindAccountMailDirs(aMailboxFile, resultsArray, importService);</span>
<a href="#l94.45"></a><span id="l94.45">   mCurDepth--;</span>
<a href="#l94.46"></a><span id="l94.46"> </span>
<a href="#l94.47"></a><span id="l94.47">   if (NS_SUCCEEDED(rv)) {</span>
<a href="#l94.48"></a><span id="l94.48">     // 2. look for &quot;global&quot; mailboxes, that don't belong to any specific account. they are inside the</span>
<a href="#l94.49"></a><span id="l94.49">     //    root's Mailboxes/ folder</span>
<a href="#l94.50"></a><span id="l94.50" class="difflineminus">-    nsCOMPtr&lt;nsILocalFile&gt; mailboxesDir(do_CreateInstance(NS_LOCAL_FILE_CONTRACTID, &amp;rv));</span>
<a href="#l94.51"></a><span id="l94.51" class="difflineplus">+    nsCOMPtr&lt;nsIFile&gt; mailboxesDir(do_CreateInstance(NS_LOCAL_FILE_CONTRACTID, &amp;rv));</span>
<a href="#l94.52"></a><span id="l94.52">     if (NS_SUCCEEDED(rv)) {  </span>
<a href="#l94.53"></a><span id="l94.53" class="difflineminus">-      nsCOMPtr&lt;nsILocalFile&gt; loc(do_QueryInterface(aMailboxFile, &amp;rv));</span>
<a href="#l94.54"></a><span id="l94.54" class="difflineminus">-      if (NS_SUCCEEDED(rv)) {</span>
<a href="#l94.55"></a><span id="l94.55" class="difflineminus">-        mailboxesDir-&gt;InitWithFile(loc);</span>
<a href="#l94.56"></a><span id="l94.56" class="difflineplus">+        mailboxesDir-&gt;InitWithFile(aMailboxFile);</span>
<a href="#l94.57"></a><span id="l94.57">         rv = mailboxesDir-&gt;Append(NS_LITERAL_STRING(&quot;Mailboxes&quot;));</span>
<a href="#l94.58"></a><span id="l94.58">         if (NS_SUCCEEDED(rv)) {</span>
<a href="#l94.59"></a><span id="l94.59">           IMPORT_LOG0(&quot;Looking for global Apple mailboxes&quot;);</span>
<a href="#l94.60"></a><span id="l94.60"> </span>
<a href="#l94.61"></a><span id="l94.61">           mCurDepth++;</span>
<a href="#l94.62"></a><span id="l94.62">           rv = FindMboxDirs(mailboxesDir, resultsArray, importService);</span>
<a href="#l94.63"></a><span id="l94.63">           mCurDepth--;</span>
<a href="#l94.64"></a><span id="l94.64">         }</span>
<a href="#l94.65"></a><span id="l94.65" class="difflineminus">-      }</span>
<a href="#l94.66"></a><span id="l94.66">     }</span>
<a href="#l94.67"></a><span id="l94.67">   }</span>
<a href="#l94.68"></a><span id="l94.68"> </span>
<a href="#l94.69"></a><span id="l94.69">   if (NS_SUCCEEDED(rv) &amp;&amp; resultsArray)</span>
<a href="#l94.70"></a><span id="l94.70">     resultsArray.swap(*aResult);</span>
<a href="#l94.71"></a><span id="l94.71"> </span>
<a href="#l94.72"></a><span id="l94.72">   return rv;</span>
<a href="#l94.73"></a><span id="l94.73"> }</span>
<a href="#l94.74"></a><span id="l94.74" class="difflineat">@@ -240,17 +237,17 @@ void nsAppleMailImportMail::FindAccountM</span>
<a href="#l94.75"></a><span id="l94.75">   nsresult rv = aRoot-&gt;GetDirectoryEntries(getter_AddRefs(directoryEnumerator));</span>
<a href="#l94.76"></a><span id="l94.76">   if (NS_FAILED(rv))</span>
<a href="#l94.77"></a><span id="l94.77">     return;</span>
<a href="#l94.78"></a><span id="l94.78"> </span>
<a href="#l94.79"></a><span id="l94.79">   bool hasMore = false;</span>
<a href="#l94.80"></a><span id="l94.80">   while (NS_SUCCEEDED(directoryEnumerator-&gt;HasMoreElements(&amp;hasMore)) &amp;&amp; hasMore) {</span>
<a href="#l94.81"></a><span id="l94.81"> </span>
<a href="#l94.82"></a><span id="l94.82">     // get the next file entry</span>
<a href="#l94.83"></a><span id="l94.83" class="difflineminus">-    nsCOMPtr&lt;nsILocalFile&gt; currentEntry;</span>
<a href="#l94.84"></a><span id="l94.84" class="difflineplus">+    nsCOMPtr&lt;nsIFile&gt; currentEntry;</span>
<a href="#l94.85"></a><span id="l94.85">     {</span>
<a href="#l94.86"></a><span id="l94.86">       nsCOMPtr&lt;nsISupports&gt; rawSupports;</span>
<a href="#l94.87"></a><span id="l94.87">       directoryEnumerator-&gt;GetNext(getter_AddRefs(rawSupports));</span>
<a href="#l94.88"></a><span id="l94.88">       if (!rawSupports)</span>
<a href="#l94.89"></a><span id="l94.89">         continue;</span>
<a href="#l94.90"></a><span id="l94.90">       currentEntry = do_QueryInterface(rawSupports);</span>
<a href="#l94.91"></a><span id="l94.91">       if (!currentEntry)</span>
<a href="#l94.92"></a><span id="l94.92">         continue;</span>
<a href="#l94.93"></a><span id="l94.93" class="difflineat">@@ -283,17 +280,17 @@ void nsAppleMailImportMail::FindAccountM</span>
<a href="#l94.94"></a><span id="l94.94">         // create a mailbox for this account, so we get a parent for &quot;Inbox&quot;, &quot;Sent Messages&quot;, etc.</span>
<a href="#l94.95"></a><span id="l94.95">         nsCOMPtr&lt;nsIImportMailboxDescriptor&gt; desc;</span>
<a href="#l94.96"></a><span id="l94.96">         nsresult rv = aImportService-&gt;CreateNewMailboxDescriptor(getter_AddRefs(desc));</span>
<a href="#l94.97"></a><span id="l94.97">         desc-&gt;SetSize(1);</span>
<a href="#l94.98"></a><span id="l94.98">         desc-&gt;SetDepth(mCurDepth);</span>
<a href="#l94.99"></a><span id="l94.99">         desc-&gt;SetDisplayName(folderName.get());</span>
<a href="#l94.100"></a><span id="l94.100">         desc-&gt;SetIdentifier(kAccountMailboxID);</span>
<a href="#l94.101"></a><span id="l94.101"> </span>
<a href="#l94.102"></a><span id="l94.102" class="difflineminus">-        nsCOMPtr&lt;nsILocalFile&gt; mailboxDescFile;</span>
<a href="#l94.103"></a><span id="l94.103" class="difflineplus">+        nsCOMPtr&lt;nsIFile&gt; mailboxDescFile;</span>
<a href="#l94.104"></a><span id="l94.104">         rv = desc-&gt;GetFile(getter_AddRefs(mailboxDescFile));</span>
<a href="#l94.105"></a><span id="l94.105">         if (!mailboxDescFile)</span>
<a href="#l94.106"></a><span id="l94.106">           continue;</span>
<a href="#l94.107"></a><span id="l94.107"> </span>
<a href="#l94.108"></a><span id="l94.108">         mailboxDescFile-&gt;InitWithFile(currentEntry);</span>
<a href="#l94.109"></a><span id="l94.109"> </span>
<a href="#l94.110"></a><span id="l94.110">         // add this mailbox descriptor to the list</span>
<a href="#l94.111"></a><span id="l94.111">         aMailboxDescs-&gt;AppendElement(desc);</span>
<a href="#l94.112"></a><span id="l94.112" class="difflineat">@@ -303,17 +300,17 @@ void nsAppleMailImportMail::FindAccountM</span>
<a href="#l94.113"></a><span id="l94.113">         FindMboxDirs(currentEntry, aMailboxDescs, aImportService);</span>
<a href="#l94.114"></a><span id="l94.114">         mCurDepth--;  </span>
<a href="#l94.115"></a><span id="l94.115">       }</span>
<a href="#l94.116"></a><span id="l94.116">     }</span>
<a href="#l94.117"></a><span id="l94.117">   }</span>
<a href="#l94.118"></a><span id="l94.118"> }</span>
<a href="#l94.119"></a><span id="l94.119"> </span>
<a href="#l94.120"></a><span id="l94.120"> // adds the specified file as a mailboxdescriptor to the array</span>
<a href="#l94.121"></a><span id="l94.121" class="difflineminus">-nsresult nsAppleMailImportMail::AddMboxDir(nsILocalFile *aFolder, nsISupportsArray *aMailboxDescs, nsIImportService *aImportService)</span>
<a href="#l94.122"></a><span id="l94.122" class="difflineplus">+nsresult nsAppleMailImportMail::AddMboxDir(nsIFile *aFolder, nsISupportsArray *aMailboxDescs, nsIImportService *aImportService)</span>
<a href="#l94.123"></a><span id="l94.123"> {</span>
<a href="#l94.124"></a><span id="l94.124">   nsAutoString folderName;</span>
<a href="#l94.125"></a><span id="l94.125">   aFolder-&gt;GetLeafName(folderName);</span>
<a href="#l94.126"></a><span id="l94.126"> </span>
<a href="#l94.127"></a><span id="l94.127">   // cut off the suffix, if any, or prefix if this is an account folder.</span>
<a href="#l94.128"></a><span id="l94.128">   if (StringEndsWith(folderName, NS_LITERAL_STRING(POP_MBOX_SUFFIX)))</span>
<a href="#l94.129"></a><span id="l94.129">     folderName.SetLength(folderName.Length()-5);</span>
<a href="#l94.130"></a><span id="l94.130">   else if (StringEndsWith(folderName, NS_LITERAL_STRING(IMAP_MBOX_SUFFIX)))</span>
<a href="#l94.131"></a><span id="l94.131" class="difflineat">@@ -342,17 +339,17 @@ nsresult nsAppleMailImportMail::AddMboxD</span>
<a href="#l94.132"></a><span id="l94.132">       if (dirEnumerator) {</span>
<a href="#l94.133"></a><span id="l94.133">         bool hasMore = false;</span>
<a href="#l94.134"></a><span id="l94.134">         while (NS_SUCCEEDED(dirEnumerator-&gt;HasMoreElements(&amp;hasMore)) &amp;&amp; hasMore) {</span>
<a href="#l94.135"></a><span id="l94.135">           nsCOMPtr&lt;nsISupports&gt; rawSupports;</span>
<a href="#l94.136"></a><span id="l94.136">           dirEnumerator-&gt;GetNext(getter_AddRefs(rawSupports));</span>
<a href="#l94.137"></a><span id="l94.137">           if (!rawSupports)</span>
<a href="#l94.138"></a><span id="l94.138">             continue;</span>
<a href="#l94.139"></a><span id="l94.139"> </span>
<a href="#l94.140"></a><span id="l94.140" class="difflineminus">-          nsCOMPtr&lt;nsILocalFile&gt; file(do_QueryInterface(rawSupports));</span>
<a href="#l94.141"></a><span id="l94.141" class="difflineplus">+          nsCOMPtr&lt;nsIFile&gt; file(do_QueryInterface(rawSupports));</span>
<a href="#l94.142"></a><span id="l94.142">           if (file) {</span>
<a href="#l94.143"></a><span id="l94.143">             bool isFile = false;</span>
<a href="#l94.144"></a><span id="l94.144">             file-&gt;IsFile(&amp;isFile);</span>
<a href="#l94.145"></a><span id="l94.145">             if (isFile)</span>
<a href="#l94.146"></a><span id="l94.146">               numMessages++;</span>
<a href="#l94.147"></a><span id="l94.147">           }</span>
<a href="#l94.148"></a><span id="l94.148">         }</span>
<a href="#l94.149"></a><span id="l94.149">       }</span>
<a href="#l94.150"></a><span id="l94.150" class="difflineat">@@ -360,17 +357,17 @@ nsresult nsAppleMailImportMail::AddMboxD</span>
<a href="#l94.151"></a><span id="l94.151"> </span>
<a href="#l94.152"></a><span id="l94.152">     desc-&gt;SetSize(numMessages);</span>
<a href="#l94.153"></a><span id="l94.153">     desc-&gt;SetDisplayName(folderName.get());</span>
<a href="#l94.154"></a><span id="l94.154">     desc-&gt;SetDepth(mCurDepth);</span>
<a href="#l94.155"></a><span id="l94.155"> </span>
<a href="#l94.156"></a><span id="l94.156">     IMPORT_LOG3(&quot;Will import %s with approx %d messages, depth is %d&quot;, NS_ConvertUTF16toUTF8(folderName).get(), numMessages, mCurDepth);</span>
<a href="#l94.157"></a><span id="l94.157"> </span>
<a href="#l94.158"></a><span id="l94.158">     // XXX: this is silly. there's no setter for the mailbox descriptor's file, so we need to get it, and then modify it.</span>
<a href="#l94.159"></a><span id="l94.159" class="difflineminus">-    nsCOMPtr&lt;nsILocalFile&gt; mailboxDescFile;</span>
<a href="#l94.160"></a><span id="l94.160" class="difflineplus">+    nsCOMPtr&lt;nsIFile&gt; mailboxDescFile;</span>
<a href="#l94.161"></a><span id="l94.161">     rv = desc-&gt;GetFile(getter_AddRefs(mailboxDescFile));</span>
<a href="#l94.162"></a><span id="l94.162">     NS_ENSURE_SUCCESS(rv, rv);</span>
<a href="#l94.163"></a><span id="l94.163"> </span>
<a href="#l94.164"></a><span id="l94.164">     if (mailboxDescFile)</span>
<a href="#l94.165"></a><span id="l94.165">       mailboxDescFile-&gt;InitWithFile(aFolder);</span>
<a href="#l94.166"></a><span id="l94.166"> </span>
<a href="#l94.167"></a><span id="l94.167">     // add this mailbox descriptor to the list</span>
<a href="#l94.168"></a><span id="l94.168">     aMailboxDescs-&gt;AppendElement(desc); </span>
<a href="#l94.169"></a><span id="l94.169" class="difflineat">@@ -384,17 +381,17 @@ nsresult nsAppleMailImportMail::AddMboxD</span>
<a href="#l94.170"></a><span id="l94.170"> //</span>
<a href="#l94.171"></a><span id="l94.171"> // If a mailbox has sub-mailboxes, they are contained in a sibling folder with the same name without the &quot;.mbox&quot; part.</span>
<a href="#l94.172"></a><span id="l94.172"> // example:</span>
<a href="#l94.173"></a><span id="l94.173"> //   MyParentMailbox.mbox/</span>
<a href="#l94.174"></a><span id="l94.174"> //   MyParentMailbox/</span>
<a href="#l94.175"></a><span id="l94.175"> //     MyChildMailbox.mbox/</span>
<a href="#l94.176"></a><span id="l94.176"> //     MyOtherChildMailbox.mbox/</span>
<a href="#l94.177"></a><span id="l94.177"> //</span>
<a href="#l94.178"></a><span id="l94.178" class="difflineminus">-nsresult nsAppleMailImportMail::FindMboxDirs(nsILocalFile *aFolder, nsISupportsArray *aMailboxDescs, nsIImportService *aImportService)</span>
<a href="#l94.179"></a><span id="l94.179" class="difflineplus">+nsresult nsAppleMailImportMail::FindMboxDirs(nsIFile *aFolder, nsISupportsArray *aMailboxDescs, nsIImportService *aImportService)</span>
<a href="#l94.180"></a><span id="l94.180"> {</span>
<a href="#l94.181"></a><span id="l94.181">   NS_ENSURE_ARG_POINTER(aFolder);</span>
<a href="#l94.182"></a><span id="l94.182">   NS_ENSURE_ARG_POINTER(aMailboxDescs);</span>
<a href="#l94.183"></a><span id="l94.183">   NS_ENSURE_ARG_POINTER(aImportService);</span>
<a href="#l94.184"></a><span id="l94.184"> </span>
<a href="#l94.185"></a><span id="l94.185">   // make sure this is a directory.</span>
<a href="#l94.186"></a><span id="l94.186">   bool isDir = false;</span>
<a href="#l94.187"></a><span id="l94.187">   if (NS_FAILED(aFolder-&gt;IsDirectory(&amp;isDir)) || !isDir)</span>
<a href="#l94.188"></a><span id="l94.188" class="difflineat">@@ -405,17 +402,17 @@ nsresult nsAppleMailImportMail::FindMbox</span>
<a href="#l94.189"></a><span id="l94.189">   nsresult rv = aFolder-&gt;GetDirectoryEntries(getter_AddRefs(directoryEnumerator));</span>
<a href="#l94.190"></a><span id="l94.190">   if (NS_FAILED(rv) || !directoryEnumerator)</span>
<a href="#l94.191"></a><span id="l94.191">     return rv;</span>
<a href="#l94.192"></a><span id="l94.192"> </span>
<a href="#l94.193"></a><span id="l94.193">   bool hasMore = false;</span>
<a href="#l94.194"></a><span id="l94.194">   while (NS_SUCCEEDED(directoryEnumerator-&gt;HasMoreElements(&amp;hasMore)) &amp;&amp; hasMore) {</span>
<a href="#l94.195"></a><span id="l94.195"> </span>
<a href="#l94.196"></a><span id="l94.196">     // get the next file entry</span>
<a href="#l94.197"></a><span id="l94.197" class="difflineminus">-    nsCOMPtr&lt;nsILocalFile&gt; currentEntry;</span>
<a href="#l94.198"></a><span id="l94.198" class="difflineplus">+    nsCOMPtr&lt;nsIFile&gt; currentEntry;</span>
<a href="#l94.199"></a><span id="l94.199">     {</span>
<a href="#l94.200"></a><span id="l94.200">       nsCOMPtr&lt;nsISupports&gt; rawSupports;</span>
<a href="#l94.201"></a><span id="l94.201">       directoryEnumerator-&gt;GetNext(getter_AddRefs(rawSupports));</span>
<a href="#l94.202"></a><span id="l94.202">       if (!rawSupports)</span>
<a href="#l94.203"></a><span id="l94.203">         continue;</span>
<a href="#l94.204"></a><span id="l94.204">       currentEntry = do_QueryInterface(rawSupports);</span>
<a href="#l94.205"></a><span id="l94.205">       if (!currentEntry)</span>
<a href="#l94.206"></a><span id="l94.206">         continue;</span>
<a href="#l94.207"></a><span id="l94.207" class="difflineat">@@ -445,17 +442,17 @@ nsresult nsAppleMailImportMail::FindMbox</span>
<a href="#l94.208"></a><span id="l94.208"> </span>
<a href="#l94.209"></a><span id="l94.209">       // cut off suffix</span>
<a href="#l94.210"></a><span id="l94.210">       if (StringEndsWith(siblingMailboxDirPath, NS_LITERAL_STRING(IMAP_MBOX_SUFFIX)))</span>
<a href="#l94.211"></a><span id="l94.211">         siblingMailboxDirPath.SetLength(siblingMailboxDirPath.Length()-9);</span>
<a href="#l94.212"></a><span id="l94.212">       else if (StringEndsWith(siblingMailboxDirPath, NS_LITERAL_STRING(POP_MBOX_SUFFIX)))</span>
<a href="#l94.213"></a><span id="l94.213">         siblingMailboxDirPath.SetLength(siblingMailboxDirPath.Length()-5);</span>
<a href="#l94.214"></a><span id="l94.214"> </span>
<a href="#l94.215"></a><span id="l94.215">       IMPORT_LOG1(&quot;trying to locate a '%s'&quot;, NS_ConvertUTF16toUTF8(siblingMailboxDirPath).get());</span>
<a href="#l94.216"></a><span id="l94.216" class="difflineminus">-      nsCOMPtr&lt;nsILocalFile&gt; siblingMailboxDir(do_CreateInstance(NS_LOCAL_FILE_CONTRACTID, &amp;rv));</span>
<a href="#l94.217"></a><span id="l94.217" class="difflineplus">+      nsCOMPtr&lt;nsIFile&gt; siblingMailboxDir(do_CreateInstance(NS_LOCAL_FILE_CONTRACTID, &amp;rv));</span>
<a href="#l94.218"></a><span id="l94.218">       if (NS_FAILED(rv))</span>
<a href="#l94.219"></a><span id="l94.219">         continue;</span>
<a href="#l94.220"></a><span id="l94.220"> </span>
<a href="#l94.221"></a><span id="l94.221">       rv = siblingMailboxDir-&gt;InitWithPath(siblingMailboxDirPath);</span>
<a href="#l94.222"></a><span id="l94.222">       bool reallyExists = false;</span>
<a href="#l94.223"></a><span id="l94.223">       siblingMailboxDir-&gt;Exists(&amp;reallyExists);</span>
<a href="#l94.224"></a><span id="l94.224"> </span>
<a href="#l94.225"></a><span id="l94.225">       if (NS_SUCCEEDED(rv) &amp;&amp; reallyExists) {</span>
<a href="#l94.226"></a><span id="l94.226" class="difflineat">@@ -481,17 +478,17 @@ nsAppleMailImportMail::ImportMailbox(nsI</span>
<a href="#l94.227"></a><span id="l94.227">   nsAutoString errorLog, successLog;</span>
<a href="#l94.228"></a><span id="l94.228"> </span>
<a href="#l94.229"></a><span id="l94.229">   // reset progress</span>
<a href="#l94.230"></a><span id="l94.230">   mProgress = 0;</span>
<a href="#l94.231"></a><span id="l94.231"> </span>
<a href="#l94.232"></a><span id="l94.232">   nsAutoString mailboxName;</span>
<a href="#l94.233"></a><span id="l94.233">   aMailbox-&gt;GetDisplayName(getter_Copies(mailboxName));</span>
<a href="#l94.234"></a><span id="l94.234"> </span>
<a href="#l94.235"></a><span id="l94.235" class="difflineminus">-  nsCOMPtr&lt;nsILocalFile&gt; mboxFolder;</span>
<a href="#l94.236"></a><span id="l94.236" class="difflineplus">+  nsCOMPtr&lt;nsIFile&gt; mboxFolder;</span>
<a href="#l94.237"></a><span id="l94.237">   nsresult rv = aMailbox-&gt;GetFile(getter_AddRefs(mboxFolder));</span>
<a href="#l94.238"></a><span id="l94.238">   if (NS_FAILED(rv) || !mboxFolder) {</span>
<a href="#l94.239"></a><span id="l94.239">     ReportStatus(APPLEMAILIMPORT_MAILBOX_CONVERTERROR, mailboxName, errorLog);</span>
<a href="#l94.240"></a><span id="l94.240">     SetLogs(successLog, errorLog, aSuccessLog, aErrorLog);</span>
<a href="#l94.241"></a><span id="l94.241">     return NS_ERROR_FAILURE;</span>
<a href="#l94.242"></a><span id="l94.242">   }</span>
<a href="#l94.243"></a><span id="l94.243"> </span>
<a href="#l94.244"></a><span id="l94.244">   // if we're an account mailbox, nothing do. if we're a real mbox</span>
<a href="#l94.245"></a><span id="l94.245" class="difflineat">@@ -538,17 +535,17 @@ nsAppleMailImportMail::ImportMailbox(nsI</span>
<a href="#l94.246"></a><span id="l94.246">       return NS_ERROR_FAILURE;</span>
<a href="#l94.247"></a><span id="l94.247">     }</span>
<a href="#l94.248"></a><span id="l94.248"> </span>
<a href="#l94.249"></a><span id="l94.249">     bool hasMore = false;</span>
<a href="#l94.250"></a><span id="l94.250">     nsCOMPtr&lt;nsIOutputStream&gt; outStream;</span>
<a href="#l94.251"></a><span id="l94.251"> </span>
<a href="#l94.252"></a><span id="l94.252">     while (NS_SUCCEEDED(directoryEnumerator-&gt;HasMoreElements(&amp;hasMore)) &amp;&amp; hasMore) {</span>
<a href="#l94.253"></a><span id="l94.253">       // get the next file entry</span>
<a href="#l94.254"></a><span id="l94.254" class="difflineminus">-      nsCOMPtr&lt;nsILocalFile&gt; currentEntry;</span>
<a href="#l94.255"></a><span id="l94.255" class="difflineplus">+      nsCOMPtr&lt;nsIFile&gt; currentEntry;</span>
<a href="#l94.256"></a><span id="l94.256">       {</span>
<a href="#l94.257"></a><span id="l94.257">         nsCOMPtr&lt;nsISupports&gt; rawSupports;</span>
<a href="#l94.258"></a><span id="l94.258">         directoryEnumerator-&gt;GetNext(getter_AddRefs(rawSupports));</span>
<a href="#l94.259"></a><span id="l94.259">         if (!rawSupports)</span>
<a href="#l94.260"></a><span id="l94.260">           continue;</span>
<a href="#l94.261"></a><span id="l94.261">         currentEntry = do_QueryInterface(rawSupports);</span>
<a href="#l94.262"></a><span id="l94.262">         if (!currentEntry)</span>
<a href="#l94.263"></a><span id="l94.263">           continue;</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l95.1"></a><span id="l95.1" class="difflineminus">--- a/mailnews/import/applemail/src/nsAppleMailImport.h</span>
<a href="#l95.2"></a><span id="l95.2" class="difflineplus">+++ b/mailnews/import/applemail/src/nsAppleMailImport.h</span>
<a href="#l95.3"></a><span id="l95.3" class="difflineat">@@ -58,18 +58,18 @@ class nsAppleMailImportMail : public nsI</span>
<a href="#l95.4"></a><span id="l95.4">   NS_DECL_ISUPPORTS</span>
<a href="#l95.5"></a><span id="l95.5">   NS_DECL_NSIIMPORTMAIL</span>
<a href="#l95.6"></a><span id="l95.6"> </span>
<a href="#l95.7"></a><span id="l95.7">   nsresult Initialize();</span>
<a href="#l95.8"></a><span id="l95.8"> </span>
<a href="#l95.9"></a><span id="l95.9">   private:</span>
<a href="#l95.10"></a><span id="l95.10"> </span>
<a href="#l95.11"></a><span id="l95.11">   void FindAccountMailDirs(nsIFile *aRoot, nsISupportsArray *aMailboxDescs, nsIImportService *aImportService);</span>
<a href="#l95.12"></a><span id="l95.12" class="difflineminus">-  nsresult FindMboxDirs(nsILocalFile *aFolder, nsISupportsArray *aMailboxDescs, nsIImportService *aImportService);</span>
<a href="#l95.13"></a><span id="l95.13" class="difflineminus">-  nsresult AddMboxDir(nsILocalFile *aFolder, nsISupportsArray *aMailboxDescs, nsIImportService *aImportService);</span>
<a href="#l95.14"></a><span id="l95.14" class="difflineplus">+  nsresult FindMboxDirs(nsIFile *aFolder, nsISupportsArray *aMailboxDescs, nsIImportService *aImportService);</span>
<a href="#l95.15"></a><span id="l95.15" class="difflineplus">+  nsresult AddMboxDir(nsIFile *aFolder, nsISupportsArray *aMailboxDescs, nsIImportService *aImportService);</span>
<a href="#l95.16"></a><span id="l95.16">     </span>
<a href="#l95.17"></a><span id="l95.17">   // aInfoString is the format to a &quot;foo %s&quot; string. It may be NULL if the error string needs no such format.</span>
<a href="#l95.18"></a><span id="l95.18">   void ReportStatus(PRInt32 aErrorNum, nsString &amp;aName, nsAString &amp;aStream);</span>
<a href="#l95.19"></a><span id="l95.19">   static void SetLogs(const nsAString&amp; success, const nsAString&amp; error, PRUnichar **aOutErrorLog, PRUnichar **aSuccessLog);</span>
<a href="#l95.20"></a><span id="l95.20"> </span>
<a href="#l95.21"></a><span id="l95.21">   nsCOMPtr&lt;nsIStringBundle&gt;  mBundle;</span>
<a href="#l95.22"></a><span id="l95.22">   PRUint32                   mProgress;</span>
<a href="#l95.23"></a><span id="l95.23">   PRUint16                   mCurDepth;</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l96.1"></a><span id="l96.1" class="difflineminus">--- a/mailnews/import/applemail/src/nsEmlxHelperUtils.h</span>
<a href="#l96.2"></a><span id="l96.2" class="difflineplus">+++ b/mailnews/import/applemail/src/nsEmlxHelperUtils.h</span>
<a href="#l96.3"></a><span id="l96.3" class="difflineat">@@ -5,17 +5,17 @@</span>
<a href="#l96.4"></a><span id="l96.4"> </span>
<a href="#l96.5"></a><span id="l96.5"> #ifndef nsEmlxHelperUtils_h___</span>
<a href="#l96.6"></a><span id="l96.6"> #define nsEmlxHelperUtils_h___</span>
<a href="#l96.7"></a><span id="l96.7"> </span>
<a href="#l96.8"></a><span id="l96.8"> #include &quot;nscore.h&quot;</span>
<a href="#l96.9"></a><span id="l96.9"> #include &quot;nsStringGlue.h&quot;</span>
<a href="#l96.10"></a><span id="l96.10"> </span>
<a href="#l96.11"></a><span id="l96.11"> class nsIOutputStream;</span>
<a href="#l96.12"></a><span id="l96.12" class="difflineminus">-class nsILocalFile;</span>
<a href="#l96.13"></a><span id="l96.13" class="difflineplus">+class nsIFile;</span>
<a href="#l96.14"></a><span id="l96.14"> </span>
<a href="#l96.15"></a><span id="l96.15"> class nsEmlxHelperUtils {</span>
<a href="#l96.16"></a><span id="l96.16">   /* All emlx messages have a &quot;flags&quot; number in the metadata. </span>
<a href="#l96.17"></a><span id="l96.17">      These are the masks to decode that, found via http://jwz.livejournal.com/505711.html */</span>
<a href="#l96.18"></a><span id="l96.18">   enum EmlxMetadataMask {</span>
<a href="#l96.19"></a><span id="l96.19">     kRead       = 1 &lt;&lt; 0,  // read</span>
<a href="#l96.20"></a><span id="l96.20">     // 1 &lt;&lt; 1,             // deleted</span>
<a href="#l96.21"></a><span id="l96.21">     kAnswered   = 1 &lt;&lt; 2,  // answered</span>
<a href="#l96.22"></a><span id="l96.22" class="difflineat">@@ -43,13 +43,13 @@ class nsEmlxHelperUtils {</span>
<a href="#l96.23"></a><span id="l96.23">   static nsresult ConvertToMboxRD(const char *aMessageBufferStart, const char *aMessageBufferEnd, nsCString &amp;aOutBuffer);</span>
<a href="#l96.24"></a><span id="l96.24"> </span>
<a href="#l96.25"></a><span id="l96.25">   // returns an int representing the X-Mozilla-Status flags set (e.g. &quot;read&quot;, &quot;flagged&quot;) converted from EMLX flags.</span>
<a href="#l96.26"></a><span id="l96.26">   static nsresult ConvertToMozillaStatusFlags(const char *aXMLBufferStart, const char *aXMLBufferEnd, PRUint32 *aMozillaStatusFlags);</span>
<a href="#l96.27"></a><span id="l96.27"> </span>
<a href="#l96.28"></a><span id="l96.28">   public:</span>
<a href="#l96.29"></a><span id="l96.29"> </span>
<a href="#l96.30"></a><span id="l96.30">   // add an .emlx message to the mbox output</span>
<a href="#l96.31"></a><span id="l96.31" class="difflineminus">-  static nsresult AddEmlxMessageToStream(nsILocalFile *aEmlxFile, nsIOutputStream *aOutoutStream); </span>
<a href="#l96.32"></a><span id="l96.32" class="difflineplus">+  static nsresult AddEmlxMessageToStream(nsIFile *aEmlxFile, nsIOutputStream *aOutoutStream); </span>
<a href="#l96.33"></a><span id="l96.33"> </span>
<a href="#l96.34"></a><span id="l96.34"> };</span>
<a href="#l96.35"></a><span id="l96.35"> </span>
<a href="#l96.36"></a><span id="l96.36"> #endif // nsEmlxHelperUtils_h___ </span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l97.1"></a><span id="l97.1" class="difflineminus">--- a/mailnews/import/applemail/src/nsEmlxHelperUtils.mm</span>
<a href="#l97.2"></a><span id="l97.2" class="difflineplus">+++ b/mailnews/import/applemail/src/nsEmlxHelperUtils.mm</span>
<a href="#l97.3"></a><span id="l97.3" class="difflineat">@@ -100,17 +100,17 @@ nsresult nsEmlxHelperUtils::ConvertToMbo</span>
<a href="#l97.4"></a><span id="l97.4">       chunkStart = foundFromLines[i];</span>
<a href="#l97.5"></a><span id="l97.5">     }</span>
<a href="#l97.6"></a><span id="l97.6">     aOutBuffer.Append(chunkStart, (aMessageBufferEnd - chunkStart));</span>
<a href="#l97.7"></a><span id="l97.7">   }</span>
<a href="#l97.8"></a><span id="l97.8"> </span>
<a href="#l97.9"></a><span id="l97.9">   return NS_OK;</span>
<a href="#l97.10"></a><span id="l97.10"> }</span>
<a href="#l97.11"></a><span id="l97.11"> </span>
<a href="#l97.12"></a><span id="l97.12" class="difflineminus">-nsresult nsEmlxHelperUtils::AddEmlxMessageToStream(nsILocalFile *aMessage, nsIOutputStream *aOut)</span>
<a href="#l97.13"></a><span id="l97.13" class="difflineplus">+nsresult nsEmlxHelperUtils::AddEmlxMessageToStream(nsIFile *aMessage, nsIOutputStream *aOut)</span>
<a href="#l97.14"></a><span id="l97.14"> {</span>
<a href="#l97.15"></a><span id="l97.15">   NS_OBJC_BEGIN_TRY_ABORT_BLOCK_NSRESULT;</span>
<a href="#l97.16"></a><span id="l97.16"> </span>
<a href="#l97.17"></a><span id="l97.17">   // needed to be sure autoreleased objects are released too, which they might not</span>
<a href="#l97.18"></a><span id="l97.18">   // in a C++ environment where the main event loop has no autorelease pool (e.g on a XPCOM thread)</span>
<a href="#l97.19"></a><span id="l97.19">   NSAutoreleasePool *pool = [[NSAutoreleasePool alloc] init];</span>
<a href="#l97.20"></a><span id="l97.20"> </span>
<a href="#l97.21"></a><span id="l97.21">   nsresult rv = NS_ERROR_FAILURE;</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l98.1"></a><span id="l98.1" class="difflineminus">--- a/mailnews/import/eudora/src/nsEudoraAddress.h</span>
<a href="#l98.2"></a><span id="l98.2" class="difflineplus">+++ b/mailnews/import/eudora/src/nsEudoraAddress.h</span>
<a href="#l98.3"></a><span id="l98.3" class="difflineat">@@ -5,17 +5,17 @@</span>
<a href="#l98.4"></a><span id="l98.4">  * file, You can obtain one at http://mozilla.org/MPL/2.0/. */</span>
<a href="#l98.5"></a><span id="l98.5"> </span>
<a href="#l98.6"></a><span id="l98.6"> #ifndef nsEudoraAddress_h__</span>
<a href="#l98.7"></a><span id="l98.7"> #define nsEudoraAddress_h__</span>
<a href="#l98.8"></a><span id="l98.8"> </span>
<a href="#l98.9"></a><span id="l98.9"> #include &quot;nscore.h&quot;</span>
<a href="#l98.10"></a><span id="l98.10"> #include &quot;nsStringGlue.h&quot;</span>
<a href="#l98.11"></a><span id="l98.11"> #include &quot;nsVoidArray.h&quot;</span>
<a href="#l98.12"></a><span id="l98.12" class="difflineminus">-#include &quot;nsILocalFile.h&quot;</span>
<a href="#l98.13"></a><span id="l98.13" class="difflineplus">+#include &quot;nsIFile.h&quot;</span>
<a href="#l98.14"></a><span id="l98.14"> #include &quot;nsISupportsArray.h&quot;</span>
<a href="#l98.15"></a><span id="l98.15"> #include &quot;nsCOMPtr.h&quot;</span>
<a href="#l98.16"></a><span id="l98.16"> #include &quot;nsIImportService.h&quot;</span>
<a href="#l98.17"></a><span id="l98.17"> </span>
<a href="#l98.18"></a><span id="l98.18"> </span>
<a href="#l98.19"></a><span id="l98.19"> class nsIAddrDatabase;</span>
<a href="#l98.20"></a><span id="l98.20"> class CAliasEntry;</span>
<a href="#l98.21"></a><span id="l98.21"> class CAliasData;</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l99.1"></a><span id="l99.1" class="difflineminus">--- a/mailnews/import/eudora/src/nsEudoraCompose.cpp</span>
<a href="#l99.2"></a><span id="l99.2" class="difflineplus">+++ b/mailnews/import/eudora/src/nsEudoraCompose.cpp</span>
<a href="#l99.3"></a><span id="l99.3" class="difflineat">@@ -516,17 +516,17 @@ nsresult nsEudoraCompose::GetLocalAttach</span>
<a href="#l99.4"></a><span id="l99.4"> </span>
<a href="#l99.5"></a><span id="l99.5">   for (PRInt32 i = 0; i &lt; count; i++) {</span>
<a href="#l99.6"></a><span id="l99.6">     nsCOMPtr&lt;nsIMsgAttachedFile&gt; a(do_CreateInstance(NS_MSGATTACHEDFILE_CONTRACTID, &amp;rv));</span>
<a href="#l99.7"></a><span id="l99.7">     NS_ENSURE_SUCCESS(rv, rv);</span>
<a href="#l99.8"></a><span id="l99.8">     // nsMsgNewURL(&amp;url, &quot;file://C:/boxster.jpg&quot;);</span>
<a href="#l99.9"></a><span id="l99.9">     // a[i].orig_url = url;</span>
<a href="#l99.10"></a><span id="l99.10"> </span>
<a href="#l99.11"></a><span id="l99.11">     pAttach = (ImportAttachment *) m_pAttachments-&gt;ElementAt(i);</span>
<a href="#l99.12"></a><span id="l99.12" class="difflineminus">-    nsCOMPtr&lt;nsILocalFile&gt; tmpFile = do_QueryInterface(pAttach-&gt;pAttachment);</span>
<a href="#l99.13"></a><span id="l99.13" class="difflineplus">+    nsCOMPtr&lt;nsIFile&gt; tmpFile = do_QueryInterface(pAttach-&gt;pAttachment);</span>
<a href="#l99.14"></a><span id="l99.14">     a-&gt;SetTmpFile(tmpFile);</span>
<a href="#l99.15"></a><span id="l99.15">     urlStr.Adopt(0);</span>
<a href="#l99.16"></a><span id="l99.16"> </span>
<a href="#l99.17"></a><span id="l99.17">     nsCOMPtr &lt;nsIURI&gt; uri;</span>
<a href="#l99.18"></a><span id="l99.18">     nsresult rv = NS_NewFileURI(getter_AddRefs(uri), pAttach-&gt;pAttachment);</span>
<a href="#l99.19"></a><span id="l99.19">     NS_ENSURE_SUCCESS(rv, nsnull);</span>
<a href="#l99.20"></a><span id="l99.20">     uri-&gt;GetSpec(urlStr);</span>
<a href="#l99.21"></a><span id="l99.21">     if (urlStr.IsEmpty())</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l100.1"></a><span id="l100.1" class="difflineminus">--- a/mailnews/import/eudora/src/nsEudoraFilters.h</span>
<a href="#l100.2"></a><span id="l100.2" class="difflineplus">+++ b/mailnews/import/eudora/src/nsEudoraFilters.h</span>
<a href="#l100.3"></a><span id="l100.3" class="difflineat">@@ -2,17 +2,17 @@</span>
<a href="#l100.4"></a><span id="l100.4"> /* This Source Code Form is subject to the terms of the Mozilla Public</span>
<a href="#l100.5"></a><span id="l100.5">  * License, v. 2.0. If a copy of the MPL was not distributed with this</span>
<a href="#l100.6"></a><span id="l100.6">  * file, You can obtain one at http://mozilla.org/MPL/2.0/. */</span>
<a href="#l100.7"></a><span id="l100.7"> </span>
<a href="#l100.8"></a><span id="l100.8"> #ifndef nsEudoraFilters_h___</span>
<a href="#l100.9"></a><span id="l100.9"> #define nsEudoraFilters_h___</span>
<a href="#l100.10"></a><span id="l100.10"> </span>
<a href="#l100.11"></a><span id="l100.11"> #include &quot;nsIImportFilters.h&quot;</span>
<a href="#l100.12"></a><span id="l100.12" class="difflineminus">-#include &quot;nsILocalFile.h&quot;</span>
<a href="#l100.13"></a><span id="l100.13" class="difflineplus">+#include &quot;nsIFile.h&quot;</span>
<a href="#l100.14"></a><span id="l100.14"> #include &quot;nsCOMPtr.h&quot;</span>
<a href="#l100.15"></a><span id="l100.15"> #include &quot;nsMsgFilterCore.h&quot;</span>
<a href="#l100.16"></a><span id="l100.16"> </span>
<a href="#l100.17"></a><span id="l100.17"> class nsIMsgFolder;</span>
<a href="#l100.18"></a><span id="l100.18"> </span>
<a href="#l100.19"></a><span id="l100.19"> class nsEudoraFilters : public nsIImportFilters {</span>
<a href="#l100.20"></a><span id="l100.20"> public:</span>
<a href="#l100.21"></a><span id="l100.21">   nsEudoraFilters();</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l101.1"></a><span id="l101.1" class="difflineminus">--- a/mailnews/import/eudora/src/nsEudoraImport.cpp</span>
<a href="#l101.2"></a><span id="l101.2" class="difflineplus">+++ b/mailnews/import/eudora/src/nsEudoraImport.cpp</span>
<a href="#l101.3"></a><span id="l101.3" class="difflineat">@@ -511,17 +511,17 @@ ImportEudoraMailImpl::ImportMailbox(nsII</span>
<a href="#l101.4"></a><span id="l101.4">   {</span>
<a href="#l101.5"></a><span id="l101.5">     IMPORT_LOG0(&quot;Mailbox size is 0, skipping mailbox.\n&quot;);</span>
<a href="#l101.6"></a><span id="l101.6">     ReportSuccess(name, 0, &amp;success);</span>
<a href="#l101.7"></a><span id="l101.7">     SetLogs(success, error, pErrorLog, pSuccessLog);</span>
<a href="#l101.8"></a><span id="l101.8">     return NS_OK;</span>
<a href="#l101.9"></a><span id="l101.9">   }</span>
<a href="#l101.10"></a><span id="l101.10"> </span>
<a href="#l101.11"></a><span id="l101.11"> </span>
<a href="#l101.12"></a><span id="l101.12" class="difflineminus">-  nsCOMPtr &lt;nsILocalFile&gt;  inFile;</span>
<a href="#l101.13"></a><span id="l101.13" class="difflineplus">+  nsCOMPtr &lt;nsIFile&gt;  inFile;</span>
<a href="#l101.14"></a><span id="l101.14">   if (NS_FAILED(pSource-&gt;GetFile(getter_AddRefs(inFile))))</span>
<a href="#l101.15"></a><span id="l101.15">   {</span>
<a href="#l101.16"></a><span id="l101.16">     ReportError(EUDORAIMPORT_MAILBOX_BADSOURCEFILE, name, &amp;error);</span>
<a href="#l101.17"></a><span id="l101.17">     SetLogs(success, error, pErrorLog, pSuccessLog);</span>
<a href="#l101.18"></a><span id="l101.18">     return NS_ERROR_FAILURE;</span>
<a href="#l101.19"></a><span id="l101.19">   }</span>
<a href="#l101.20"></a><span id="l101.20"> </span>
<a href="#l101.21"></a><span id="l101.21"> #ifdef IMPORT_DEBUG</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l102.1"></a><span id="l102.1" class="difflineminus">--- a/mailnews/import/eudora/src/nsEudoraMac.cpp</span>
<a href="#l102.2"></a><span id="l102.2" class="difflineplus">+++ b/mailnews/import/eudora/src/nsEudoraMac.cpp</span>
<a href="#l102.3"></a><span id="l102.3" class="difflineat">@@ -138,17 +138,17 @@ bool nsEudoraMac::VerifyEudoraLocation(n</span>
<a href="#l102.4"></a><span id="l102.4">   nsCOMPtr &lt;nsIFile&gt; prefFile;</span>
<a href="#l102.5"></a><span id="l102.5"> </span>
<a href="#l102.6"></a><span id="l102.6">   int count = 0;</span>
<a href="#l102.7"></a><span id="l102.7">   OSType type, creator;</span>
<a href="#l102.8"></a><span id="l102.8">   while (hasMore &amp;&amp; NS_SUCCEEDED(rv) &amp;&amp; count &lt; 2)</span>
<a href="#l102.9"></a><span id="l102.9">   {</span>
<a href="#l102.10"></a><span id="l102.10">     nsCOMPtr&lt;nsISupports&gt; aSupport;</span>
<a href="#l102.11"></a><span id="l102.11">     rv = directoryEnumerator-&gt;GetNext(getter_AddRefs(aSupport));</span>
<a href="#l102.12"></a><span id="l102.12" class="difflineminus">-    nsCOMPtr&lt;nsILocalFile&gt; entry(do_QueryInterface(aSupport, &amp;rv));</span>
<a href="#l102.13"></a><span id="l102.13" class="difflineplus">+    nsCOMPtr&lt;nsIFile&gt; entry(do_QueryInterface(aSupport, &amp;rv));</span>
<a href="#l102.14"></a><span id="l102.14">     directoryEnumerator-&gt;HasMoreElements(&amp;hasMore);</span>
<a href="#l102.15"></a><span id="l102.15"> </span>
<a href="#l102.16"></a><span id="l102.16"> </span>
<a href="#l102.17"></a><span id="l102.17">     // find a file with TEXT, CSOm that isn't the nicknames file</span>
<a href="#l102.18"></a><span id="l102.18">     // or just cheat and look for more than 1 file?</span>
<a href="#l102.19"></a><span id="l102.19">     {</span>
<a href="#l102.20"></a><span id="l102.20">       nsCOMPtr&lt;nsILocalFileMac&gt; macFile = do_QueryInterface(entry, &amp;rv);</span>
<a href="#l102.21"></a><span id="l102.21">       if (NS_SUCCEEDED(rv))</span>
<a href="#l102.22"></a><span id="l102.22" class="difflineat">@@ -255,17 +255,17 @@ nsresult nsEudoraMac::IterateMailDir(nsI</span>
<a href="#l102.23"></a><span id="l102.23">   NS_ENSURE_SUCCESS(rv, rv);</span>
<a href="#l102.24"></a><span id="l102.24"> </span>
<a href="#l102.25"></a><span id="l102.25">   directoryEnumerator-&gt;HasMoreElements(&amp;hasMore);</span>
<a href="#l102.26"></a><span id="l102.26"> </span>
<a href="#l102.27"></a><span id="l102.27">   while (hasMore &amp;&amp; NS_SUCCEEDED(rv))</span>
<a href="#l102.28"></a><span id="l102.28">   {</span>
<a href="#l102.29"></a><span id="l102.29">     nsCOMPtr&lt;nsISupports&gt; aSupport;</span>
<a href="#l102.30"></a><span id="l102.30">     rv = directoryEnumerator-&gt;GetNext(getter_AddRefs(aSupport));</span>
<a href="#l102.31"></a><span id="l102.31" class="difflineminus">-    nsCOMPtr&lt;nsILocalFile&gt; entry(do_QueryInterface(aSupport, &amp;rv));</span>
<a href="#l102.32"></a><span id="l102.32" class="difflineplus">+    nsCOMPtr&lt;nsIFile&gt; entry(do_QueryInterface(aSupport, &amp;rv));</span>
<a href="#l102.33"></a><span id="l102.33">     directoryEnumerator-&gt;HasMoreElements(&amp;hasMore);</span>
<a href="#l102.34"></a><span id="l102.34"> </span>
<a href="#l102.35"></a><span id="l102.35">     bool isFolder;</span>
<a href="#l102.36"></a><span id="l102.36">     bool isFile;</span>
<a href="#l102.37"></a><span id="l102.37">     nsCString fName;</span>
<a href="#l102.38"></a><span id="l102.38">     nsCString ext;</span>
<a href="#l102.39"></a><span id="l102.39">     nsCString name;</span>
<a href="#l102.40"></a><span id="l102.40">     OSType type;</span>
<a href="#l102.41"></a><span id="l102.41" class="difflineat">@@ -332,33 +332,32 @@ nsresult nsEudoraMac::FoundMailbox(nsIFi</span>
<a href="#l102.42"></a><span id="l102.42"> </span>
<a href="#l102.43"></a><span id="l102.43">   nsresult rv = pImport-&gt;CreateNewMailboxDescriptor(getter_AddRefs(desc));</span>
<a href="#l102.44"></a><span id="l102.44">   if (NS_SUCCEEDED(rv))</span>
<a href="#l102.45"></a><span id="l102.45">   {</span>
<a href="#l102.46"></a><span id="l102.46">     PRInt64    sz = 0;</span>
<a href="#l102.47"></a><span id="l102.47">     mailFile-&gt;GetFileSize(&amp;sz);</span>
<a href="#l102.48"></a><span id="l102.48">     desc-&gt;SetDisplayName(displayName.get());</span>
<a href="#l102.49"></a><span id="l102.49">     desc-&gt;SetDepth(m_depth);</span>
<a href="#l102.50"></a><span id="l102.50" class="difflineminus">-    nsCOMPtr &lt;nsILocalFile&gt; pLocalFile;</span>
<a href="#l102.51"></a><span id="l102.51" class="difflineplus">+    nsCOMPtr &lt;nsIFile&gt; pLocalFile;</span>
<a href="#l102.52"></a><span id="l102.52">     desc-&gt;GetFile(getter_AddRefs(pLocalFile));</span>
<a href="#l102.53"></a><span id="l102.53">     if (pLocalFile)</span>
<a href="#l102.54"></a><span id="l102.54">     {</span>
<a href="#l102.55"></a><span id="l102.55" class="difflineminus">-      nsCOMPtr &lt;nsILocalFile&gt; localMailFile = do_QueryInterface(mailFile);</span>
<a href="#l102.56"></a><span id="l102.56" class="difflineminus">-      pLocalFile-&gt;InitWithFile(localMailFile);</span>
<a href="#l102.57"></a><span id="l102.57" class="difflineplus">+      pLocalFile-&gt;InitWithFile(mailFile);</span>
<a href="#l102.58"></a><span id="l102.58">     }</span>
<a href="#l102.59"></a><span id="l102.59">     rv = desc-&gt;QueryInterface(kISupportsIID, (void **) &amp;pInterface);</span>
<a href="#l102.60"></a><span id="l102.60">     pArray-&gt;AppendElement(pInterface);</span>
<a href="#l102.61"></a><span id="l102.61">     pInterface-&gt;Release();</span>
<a href="#l102.62"></a><span id="l102.62">   }</span>
<a href="#l102.63"></a><span id="l102.63"> </span>
<a href="#l102.64"></a><span id="l102.64">   return NS_OK;</span>
<a href="#l102.65"></a><span id="l102.65"> }</span>
<a href="#l102.66"></a><span id="l102.66"> </span>
<a href="#l102.67"></a><span id="l102.67"> </span>
<a href="#l102.68"></a><span id="l102.68" class="difflineminus">-nsresult nsEudoraMac::FoundMailFolder(nsILocalFile *mailFolder, const char *pName, nsISupportsArray *pArray, nsIImportService *pImport)</span>
<a href="#l102.69"></a><span id="l102.69" class="difflineplus">+nsresult nsEudoraMac::FoundMailFolder(nsIFile *mailFolder, const char *pName, nsISupportsArray *pArray, nsIImportService *pImport)</span>
<a href="#l102.70"></a><span id="l102.70"> {</span>
<a href="#l102.71"></a><span id="l102.71">   nsAutoString          displayName;</span>
<a href="#l102.72"></a><span id="l102.72">   nsCOMPtr&lt;nsIImportMailboxDescriptor&gt;  desc;</span>
<a href="#l102.73"></a><span id="l102.73">   nsISupports *              pInterface;</span>
<a href="#l102.74"></a><span id="l102.74"> </span>
<a href="#l102.75"></a><span id="l102.75">   NS_CopyNativeToUnicode(nsDependentCString(pName), displayName);</span>
<a href="#l102.76"></a><span id="l102.76"> </span>
<a href="#l102.77"></a><span id="l102.77"> #ifdef IMPORT_DEBUG</span>
<a href="#l102.78"></a><span id="l102.78" class="difflineat">@@ -373,17 +372,17 @@ nsresult nsEudoraMac::FoundMailFolder(ns</span>
<a href="#l102.79"></a><span id="l102.79"> </span>
<a href="#l102.80"></a><span id="l102.80">   nsresult rv = pImport-&gt;CreateNewMailboxDescriptor(getter_AddRefs(desc));</span>
<a href="#l102.81"></a><span id="l102.81">   if (NS_SUCCEEDED(rv))</span>
<a href="#l102.82"></a><span id="l102.82">   {</span>
<a href="#l102.83"></a><span id="l102.83">     PRInt64    sz = 0;</span>
<a href="#l102.84"></a><span id="l102.84">     desc-&gt;SetDisplayName(displayName.get());</span>
<a href="#l102.85"></a><span id="l102.85">     desc-&gt;SetDepth(m_depth);</span>
<a href="#l102.86"></a><span id="l102.86">     desc-&gt;SetSize(sz);</span>
<a href="#l102.87"></a><span id="l102.87" class="difflineminus">-    nsCOMPtr &lt;nsILocalFile&gt; pFile;</span>
<a href="#l102.88"></a><span id="l102.88" class="difflineplus">+    nsCOMPtr &lt;nsIFile&gt; pFile;</span>
<a href="#l102.89"></a><span id="l102.89">     desc-&gt;GetFile(getter_AddRefs(pFile));</span>
<a href="#l102.90"></a><span id="l102.90">     if (pFile)</span>
<a href="#l102.91"></a><span id="l102.91">       pFile-&gt;InitWithFile(mailFolder);</span>
<a href="#l102.92"></a><span id="l102.92">     rv = desc-&gt;QueryInterface(kISupportsIID, (void **) &amp;pInterface);</span>
<a href="#l102.93"></a><span id="l102.93">     pArray-&gt;AppendElement(pInterface);</span>
<a href="#l102.94"></a><span id="l102.94">     pInterface-&gt;Release();</span>
<a href="#l102.95"></a><span id="l102.95">   }</span>
<a href="#l102.96"></a><span id="l102.96"> </span>
<a href="#l102.97"></a><span id="l102.97" class="difflineat">@@ -984,19 +983,17 @@ nsresult nsEudoraMac::GetAttachmentInfo(</span>
<a href="#l102.98"></a><span id="l102.98">   typeStr.Append((const char *)&amp;type, 4);</span>
<a href="#l102.99"></a><span id="l102.99">   IMPORT_LOG3(&quot;\tAttachment type: %s, creator: %s, fileNum: %ld\n&quot;, typeStr.get(), creatStr.get(), fNum);</span>
<a href="#l102.100"></a><span id="l102.100">   IMPORT_LOG1(&quot;\tAttachment file name: %s\n&quot;, str.get());</span>
<a href="#l102.101"></a><span id="l102.101"> #endif</span>
<a href="#l102.102"></a><span id="l102.102">   FSRef  fsRef;</span>
<a href="#l102.103"></a><span id="l102.103">   memset(&amp;fsRef, 0, sizeof(fsRef));</span>
<a href="#l102.104"></a><span id="l102.104">   {</span>
<a href="#l102.105"></a><span id="l102.105">     nsresult rv;</span>
<a href="#l102.106"></a><span id="l102.106" class="difflineminus">-    nsCOMPtr &lt;nsILocalFile&gt; pLocalFile = do_QueryInterface(pFile, &amp;rv);</span>
<a href="#l102.107"></a><span id="l102.107" class="difflineminus">-    NS_ENSURE_SUCCESS(rv, rv);</span>
<a href="#l102.108"></a><span id="l102.108" class="difflineminus">-    pLocalFile-&gt;InitWithNativePath(str);</span>
<a href="#l102.109"></a><span id="l102.109" class="difflineplus">+    rv = pFile-&gt;InitWithNativePath(str);</span>
<a href="#l102.110"></a><span id="l102.110">     if (NS_FAILED(rv))</span>
<a href="#l102.111"></a><span id="l102.111">     {</span>
<a href="#l102.112"></a><span id="l102.112">       IMPORT_LOG0(&quot;\tfailed to set native path\n&quot;);</span>
<a href="#l102.113"></a><span id="l102.113">       return rv;</span>
<a href="#l102.114"></a><span id="l102.114">     }</span>
<a href="#l102.115"></a><span id="l102.115"> </span>
<a href="#l102.116"></a><span id="l102.116">     pFile-&gt;GetNativeLeafName(aAttachment);</span>
<a href="#l102.117"></a><span id="l102.117"> </span>
<a href="#l102.118"></a><span id="l102.118" class="difflineat">@@ -1106,20 +1103,19 @@ bool nsEudoraMac::FindAddressFolder(nsIF</span>
<a href="#l102.119"></a><span id="l102.119"> }</span>
<a href="#l102.120"></a><span id="l102.120"> </span>
<a href="#l102.121"></a><span id="l102.121"> nsresult nsEudoraMac::FindAddressBooks(nsIFile *pRoot, nsISupportsArray **ppArray)</span>
<a href="#l102.122"></a><span id="l102.122"> {</span>
<a href="#l102.123"></a><span id="l102.123">   // Look for the nicknames file in this folder and then</span>
<a href="#l102.124"></a><span id="l102.124">   // additional files in the Nicknames folder</span>
<a href="#l102.125"></a><span id="l102.125">   // Try and find the nickNames file</span>
<a href="#l102.126"></a><span id="l102.126">   nsresult rv;</span>
<a href="#l102.127"></a><span id="l102.127" class="difflineminus">-  nsCOMPtr&lt;nsILocalFile&gt; file = do_CreateInstance(NS_LOCAL_FILE_CONTRACTID, &amp;rv);</span>
<a href="#l102.128"></a><span id="l102.128" class="difflineplus">+  nsCOMPtr&lt;nsIFile&gt; file = do_CreateInstance(NS_LOCAL_FILE_CONTRACTID, &amp;rv);</span>
<a href="#l102.129"></a><span id="l102.129">   NS_ENSURE_SUCCESS(rv, rv);</span>
<a href="#l102.130"></a><span id="l102.130" class="difflineminus">-  nsCOMPtr&lt;nsILocalFile&gt; localRoot = do_QueryInterface(pRoot);</span>
<a href="#l102.131"></a><span id="l102.131" class="difflineminus">-  rv = file-&gt;InitWithFile(localRoot);</span>
<a href="#l102.132"></a><span id="l102.132" class="difflineplus">+  rv = file-&gt;InitWithFile(pRoot);</span>
<a href="#l102.133"></a><span id="l102.133">   if (NS_FAILED(rv))</span>
<a href="#l102.134"></a><span id="l102.134">     return rv;</span>
<a href="#l102.135"></a><span id="l102.135">   rv = NS_NewISupportsArray(ppArray);</span>
<a href="#l102.136"></a><span id="l102.136">   if (NS_FAILED(rv))</span>
<a href="#l102.137"></a><span id="l102.137">   {</span>
<a href="#l102.138"></a><span id="l102.138">     IMPORT_LOG0(&quot;FAILED to allocate the nsISupportsArray\n&quot;);</span>
<a href="#l102.139"></a><span id="l102.139">     return rv;</span>
<a href="#l102.140"></a><span id="l102.140">   }</span>
<a href="#l102.141"></a><span id="l102.141" class="difflineat">@@ -1163,17 +1159,17 @@ nsresult nsEudoraMac::FindAddressBooks(n</span>
<a href="#l102.142"></a><span id="l102.142">     if (NS_FAILED(rv))</span>
<a href="#l102.143"></a><span id="l102.143">     {</span>
<a href="#l102.144"></a><span id="l102.144">       IMPORT_LOG0(&quot;*** Error creating address book descriptor for eudora nicknames\n&quot;);</span>
<a href="#l102.145"></a><span id="l102.145">       return rv;</span>
<a href="#l102.146"></a><span id="l102.146">     }</span>
<a href="#l102.147"></a><span id="l102.147">   }</span>
<a href="#l102.148"></a><span id="l102.148"> </span>
<a href="#l102.149"></a><span id="l102.149">   // Now try the directory of address books!</span>
<a href="#l102.150"></a><span id="l102.150" class="difflineminus">-  rv = file-&gt;InitWithFile(localRoot);</span>
<a href="#l102.151"></a><span id="l102.151" class="difflineplus">+  rv = file-&gt;InitWithFile(pRoot);</span>
<a href="#l102.152"></a><span id="l102.152">   if (NS_SUCCEEDED(rv))</span>
<a href="#l102.153"></a><span id="l102.153">     rv = file-&gt;AppendNative(NS_LITERAL_CSTRING(&quot;Nicknames Folder&quot;));</span>
<a href="#l102.154"></a><span id="l102.154">   exists = false;</span>
<a href="#l102.155"></a><span id="l102.155">   bool    isDir = false;</span>
<a href="#l102.156"></a><span id="l102.156">   if (NS_SUCCEEDED(rv))</span>
<a href="#l102.157"></a><span id="l102.157">     rv = file-&gt;Exists(&amp;exists);</span>
<a href="#l102.158"></a><span id="l102.158">   if (NS_SUCCEEDED(rv) &amp;&amp; exists)</span>
<a href="#l102.159"></a><span id="l102.159">     rv = file-&gt;IsDirectory(&amp;isDir);</span>
<a href="#l102.160"></a><span id="l102.160" class="difflineat">@@ -1191,17 +1187,17 @@ nsresult nsEudoraMac::FindAddressBooks(n</span>
<a href="#l102.161"></a><span id="l102.161">   nsCString name;</span>
<a href="#l102.162"></a><span id="l102.162">   OSType          type;</span>
<a href="#l102.163"></a><span id="l102.163">   OSType          creator;</span>
<a href="#l102.164"></a><span id="l102.164"> </span>
<a href="#l102.165"></a><span id="l102.165">   while (hasMore &amp;&amp; NS_SUCCEEDED(rv))</span>
<a href="#l102.166"></a><span id="l102.166">   {</span>
<a href="#l102.167"></a><span id="l102.167">     nsCOMPtr&lt;nsISupports&gt; aSupport;</span>
<a href="#l102.168"></a><span id="l102.168">     rv = directoryEnumerator-&gt;GetNext(getter_AddRefs(aSupport));</span>
<a href="#l102.169"></a><span id="l102.169" class="difflineminus">-    nsCOMPtr&lt;nsILocalFile&gt; entry(do_QueryInterface(aSupport, &amp;rv));</span>
<a href="#l102.170"></a><span id="l102.170" class="difflineplus">+    nsCOMPtr&lt;nsIFile&gt; entry(do_QueryInterface(aSupport, &amp;rv));</span>
<a href="#l102.171"></a><span id="l102.171">     directoryEnumerator-&gt;HasMoreElements(&amp;hasMore);</span>
<a href="#l102.172"></a><span id="l102.172"> </span>
<a href="#l102.173"></a><span id="l102.173">     if (NS_SUCCEEDED(rv))</span>
<a href="#l102.174"></a><span id="l102.174">     {</span>
<a href="#l102.175"></a><span id="l102.175">       isFile = false;</span>
<a href="#l102.176"></a><span id="l102.176">       rv = entry-&gt;IsFile(&amp;isFile);</span>
<a href="#l102.177"></a><span id="l102.177">       rv = entry-&gt;GetLeafName(displayName);</span>
<a href="#l102.178"></a><span id="l102.178">       if (NS_SUCCEEDED(rv) &amp;&amp; !displayName.IsEmpty() &amp;&amp; isFile)</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l103.1"></a><span id="l103.1" class="difflineminus">--- a/mailnews/import/eudora/src/nsEudoraMac.h</span>
<a href="#l103.2"></a><span id="l103.2" class="difflineplus">+++ b/mailnews/import/eudora/src/nsEudoraMac.h</span>
<a href="#l103.3"></a><span id="l103.3" class="difflineat">@@ -65,17 +65,17 @@ private:</span>
<a href="#l103.4"></a><span id="l103.4"> </span>
<a href="#l103.5"></a><span id="l103.5"> </span>
<a href="#l103.6"></a><span id="l103.6">   nsresult  ScanMailDir(nsIFile *pFolder,</span>
<a href="#l103.7"></a><span id="l103.7">                         nsISupportsArray *pArray,</span>
<a href="#l103.8"></a><span id="l103.8">                         nsIImportService *pImport);</span>
<a href="#l103.9"></a><span id="l103.9">   nsresult  IterateMailDir(nsIFile *pFolder,</span>
<a href="#l103.10"></a><span id="l103.10">                            nsISupportsArray *pArray,</span>
<a href="#l103.11"></a><span id="l103.11">                            nsIImportService *pImport);</span>
<a href="#l103.12"></a><span id="l103.12" class="difflineminus">-  nsresult  FoundMailFolder(nsILocalFile *mailFolder,</span>
<a href="#l103.13"></a><span id="l103.13" class="difflineplus">+  nsresult  FoundMailFolder(nsIFile *mailFolder,</span>
<a href="#l103.14"></a><span id="l103.14">                             const char *pName,</span>
<a href="#l103.15"></a><span id="l103.15">                             nsISupportsArray *pArray,</span>
<a href="#l103.16"></a><span id="l103.16">                             nsIImportService *pImport);</span>
<a href="#l103.17"></a><span id="l103.17">   nsresult  FoundMailbox(nsIFile *mailFile,</span>
<a href="#l103.18"></a><span id="l103.18">                          const char *pName,</span>
<a href="#l103.19"></a><span id="l103.19">                          nsISupportsArray *pArray,</span>
<a href="#l103.20"></a><span id="l103.20">                          nsIImportService *pImport);</span>
<a href="#l103.21"></a><span id="l103.21"> </span>
<a href="#l103.22"></a><span id="l103.22" class="difflineat">@@ -108,15 +108,15 @@ private:</span>
<a href="#l103.23"></a><span id="l103.23">   static bool    GetSettingsFromResource(nsIFile *pSettings,</span>
<a href="#l103.24"></a><span id="l103.24">                                          short resId,</span>
<a href="#l103.25"></a><span id="l103.25">                                          nsCString **pStrs,</span>
<a href="#l103.26"></a><span id="l103.26">                                          bool *pIMAP);</span>
<a href="#l103.27"></a><span id="l103.27"> </span>
<a href="#l103.28"></a><span id="l103.28"> </span>
<a href="#l103.29"></a><span id="l103.29"> private:</span>
<a href="#l103.30"></a><span id="l103.30">   PRUint32 m_depth;</span>
<a href="#l103.31"></a><span id="l103.31" class="difflineminus">-  nsCOMPtr &lt;nsILocalFile&gt; m_mailImportLocation;</span>
<a href="#l103.32"></a><span id="l103.32" class="difflineplus">+  nsCOMPtr &lt;nsIFile&gt; m_mailImportLocation;</span>
<a href="#l103.33"></a><span id="l103.33">   bool HasResourceFork(FSRef *fsRef);</span>
<a href="#l103.34"></a><span id="l103.34"> };</span>
<a href="#l103.35"></a><span id="l103.35"> </span>
<a href="#l103.36"></a><span id="l103.36"> </span>
<a href="#l103.37"></a><span id="l103.37"> #endif /* nsEudoraMac_h__ */</span>
<a href="#l103.38"></a><span id="l103.38"> </span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l104.1"></a><span id="l104.1" class="difflineminus">--- a/mailnews/import/eudora/src/nsEudoraMailbox.cpp</span>
<a href="#l104.2"></a><span id="l104.2" class="difflineplus">+++ b/mailnews/import/eudora/src/nsEudoraMailbox.cpp</span>
<a href="#l104.3"></a><span id="l104.3" class="difflineat">@@ -1308,17 +1308,17 @@ nsresult nsEudoraMailbox::ExamineAttachm</span>
<a href="#l104.4"></a><span id="l104.4">   return NS_OK;</span>
<a href="#l104.5"></a><span id="l104.5"> }</span>
<a href="#l104.6"></a><span id="l104.6"> </span>
<a href="#l104.7"></a><span id="l104.7"> bool nsEudoraMailbox::AddAttachment(nsCString&amp; fileName)</span>
<a href="#l104.8"></a><span id="l104.8"> {</span>
<a href="#l104.9"></a><span id="l104.9">   IMPORT_LOG1(&quot;Found attachment: %s\n&quot;, fileName.get());</span>
<a href="#l104.10"></a><span id="l104.10"> </span>
<a href="#l104.11"></a><span id="l104.11">   nsresult rv;</span>
<a href="#l104.12"></a><span id="l104.12" class="difflineminus">-  nsCOMPtr &lt;nsILocalFile&gt;  pFile = do_CreateInstance(NS_LOCAL_FILE_CONTRACTID, &amp;rv);</span>
<a href="#l104.13"></a><span id="l104.13" class="difflineplus">+  nsCOMPtr &lt;nsIFile&gt;  pFile = do_CreateInstance(NS_LOCAL_FILE_CONTRACTID, &amp;rv);</span>
<a href="#l104.14"></a><span id="l104.14">   if (NS_FAILED(rv))</span>
<a href="#l104.15"></a><span id="l104.15">     return false;</span>
<a href="#l104.16"></a><span id="l104.16"> </span>
<a href="#l104.17"></a><span id="l104.17">   nsCString mimeType;</span>
<a href="#l104.18"></a><span id="l104.18">   nsCString attachmentName;</span>
<a href="#l104.19"></a><span id="l104.19">   if (NS_FAILED(GetAttachmentInfo(fileName.get(), pFile, mimeType, attachmentName)))</span>
<a href="#l104.20"></a><span id="l104.20">     return false;</span>
<a href="#l104.21"></a><span id="l104.21"> </span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l105.1"></a><span id="l105.1" class="difflineminus">--- a/mailnews/import/eudora/src/nsEudoraMailbox.h</span>
<a href="#l105.2"></a><span id="l105.2" class="difflineplus">+++ b/mailnews/import/eudora/src/nsEudoraMailbox.h</span>
<a href="#l105.3"></a><span id="l105.3" class="difflineat">@@ -182,17 +182,17 @@ private:</span>
<a href="#l105.4"></a><span id="l105.4">   nsresult  ExamineAttachment(SimpleBufferTonyRCopiedOnce&amp; data);</span>
<a href="#l105.5"></a><span id="l105.5">   bool      AddAttachment(nsCString&amp; fileName);</span>
<a href="#l105.6"></a><span id="l105.6"> </span>
<a href="#l105.7"></a><span id="l105.7">   static PRInt32    AsciiToLong(const char *pChar, PRInt32 len);</span>
<a href="#l105.8"></a><span id="l105.8">   static int      IsWeekDayStr(const char *pStr);</span>
<a href="#l105.9"></a><span id="l105.9">   static int      IsMonthStr(const char *pStr);</span>
<a href="#l105.10"></a><span id="l105.10"> </span>
<a href="#l105.11"></a><span id="l105.11"> protected:</span>
<a href="#l105.12"></a><span id="l105.12" class="difflineminus">-  nsCOMPtr &lt;nsILocalFile&gt;    m_mailImportLocation;</span>
<a href="#l105.13"></a><span id="l105.13" class="difflineplus">+  nsCOMPtr &lt;nsIFile&gt;    m_mailImportLocation;</span>
<a href="#l105.14"></a><span id="l105.14"> </span>
<a href="#l105.15"></a><span id="l105.15"> private:</span>
<a href="#l105.16"></a><span id="l105.16">   PRInt64    m_mailSize;</span>
<a href="#l105.17"></a><span id="l105.17">   PRUint32      m_fromLen;</span>
<a href="#l105.18"></a><span id="l105.18">   nsVoidArray    m_attachments;</span>
<a href="#l105.19"></a><span id="l105.19"> };</span>
<a href="#l105.20"></a><span id="l105.20"> </span>
<a href="#l105.21"></a><span id="l105.21"> </span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l106.1"></a><span id="l106.1" class="difflineminus">--- a/mailnews/import/eudora/src/nsEudoraSettings.h</span>
<a href="#l106.2"></a><span id="l106.2" class="difflineplus">+++ b/mailnews/import/eudora/src/nsEudoraSettings.h</span>
<a href="#l106.3"></a><span id="l106.3" class="difflineat">@@ -3,17 +3,17 @@</span>
<a href="#l106.4"></a><span id="l106.4">  * This Source Code Form is subject to the terms of the Mozilla Public</span>
<a href="#l106.5"></a><span id="l106.5">  * License, v. 2.0. If a copy of the MPL was not distributed with this</span>
<a href="#l106.6"></a><span id="l106.6">  * file, You can obtain one at http://mozilla.org/MPL/2.0/. */</span>
<a href="#l106.7"></a><span id="l106.7"> </span>
<a href="#l106.8"></a><span id="l106.8"> #ifndef nsEudoraSettings_h___</span>
<a href="#l106.9"></a><span id="l106.9"> #define nsEudoraSettings_h___</span>
<a href="#l106.10"></a><span id="l106.10"> </span>
<a href="#l106.11"></a><span id="l106.11"> #include &quot;nsIImportSettings.h&quot;</span>
<a href="#l106.12"></a><span id="l106.12" class="difflineminus">-#include &quot;nsILocalFile.h&quot;</span>
<a href="#l106.13"></a><span id="l106.13" class="difflineplus">+#include &quot;nsIFile.h&quot;</span>
<a href="#l106.14"></a><span id="l106.14"> #include &quot;nsCOMPtr.h&quot;</span>
<a href="#l106.15"></a><span id="l106.15"> </span>
<a href="#l106.16"></a><span id="l106.16"> class nsEudoraSettings : public nsIImportSettings {</span>
<a href="#l106.17"></a><span id="l106.17"> public:</span>
<a href="#l106.18"></a><span id="l106.18">     nsEudoraSettings();</span>
<a href="#l106.19"></a><span id="l106.19">     virtual ~nsEudoraSettings();</span>
<a href="#l106.20"></a><span id="l106.20"> </span>
<a href="#l106.21"></a><span id="l106.21">   static nsresult Create(nsIImportSettings** aImport);</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l107.1"></a><span id="l107.1" class="difflineminus">--- a/mailnews/import/eudora/src/nsEudoraWin32.cpp</span>
<a href="#l107.2"></a><span id="l107.2" class="difflineplus">+++ b/mailnews/import/eudora/src/nsEudoraWin32.cpp</span>
<a href="#l107.3"></a><span id="l107.3" class="difflineat">@@ -69,17 +69,17 @@ bool nsEudoraWin32::FindMailFolder(nsIFi</span>
<a href="#l107.4"></a><span id="l107.4"> {</span>
<a href="#l107.5"></a><span id="l107.5">   return FindEudoraLocation(pFolder);</span>
<a href="#l107.6"></a><span id="l107.6"> }</span>
<a href="#l107.7"></a><span id="l107.7"> </span>
<a href="#l107.8"></a><span id="l107.8"> bool nsEudoraWin32::FindEudoraLocation(nsIFile **pFolder, bool findIni)</span>
<a href="#l107.9"></a><span id="l107.9"> {</span>
<a href="#l107.10"></a><span id="l107.10">   bool result = false;</span>
<a href="#l107.11"></a><span id="l107.11">   bool    exists = false;</span>
<a href="#l107.12"></a><span id="l107.12" class="difflineminus">-  nsCOMPtr &lt;nsILocalFile&gt; eudoraPath = do_CreateInstance(NS_LOCAL_FILE_CONTRACTID);</span>
<a href="#l107.13"></a><span id="l107.13" class="difflineplus">+  nsCOMPtr &lt;nsIFile&gt; eudoraPath = do_CreateInstance(NS_LOCAL_FILE_CONTRACTID);</span>
<a href="#l107.14"></a><span id="l107.14">   // look in the registry to see where eudora is installed?</span>
<a href="#l107.15"></a><span id="l107.15">   HKEY  sKey;</span>
<a href="#l107.16"></a><span id="l107.16">   if (::RegOpenKeyEx(HKEY_CURRENT_USER, &quot;Software\\Qualcomm\\Eudora\\CommandLine&quot;, 0, KEY_QUERY_VALUE, &amp;sKey) == ERROR_SUCCESS)</span>
<a href="#l107.17"></a><span id="l107.17">   {</span>
<a href="#l107.18"></a><span id="l107.18">     // get the value of &quot;Current&quot;</span>
<a href="#l107.19"></a><span id="l107.19">     BYTE *pBytes = GetValueBytes(sKey, &quot;Current&quot;);</span>
<a href="#l107.20"></a><span id="l107.20">     if (pBytes)</span>
<a href="#l107.21"></a><span id="l107.21">     {</span>
<a href="#l107.22"></a><span id="l107.22" class="difflineat">@@ -244,17 +244,17 @@ nsresult nsEudoraWin32::IterateMailDir(n</span>
<a href="#l107.23"></a><span id="l107.23">   nsCString         fName;</span>
<a href="#l107.24"></a><span id="l107.24">   nsCString         ext;</span>
<a href="#l107.25"></a><span id="l107.25">   nsCString         name;</span>
<a href="#l107.26"></a><span id="l107.26"> </span>
<a href="#l107.27"></a><span id="l107.27">   while (hasMore &amp;&amp; NS_SUCCEEDED(rv))</span>
<a href="#l107.28"></a><span id="l107.28">   {</span>
<a href="#l107.29"></a><span id="l107.29">     nsCOMPtr&lt;nsISupports&gt; aSupport;</span>
<a href="#l107.30"></a><span id="l107.30">     rv = directoryEnumerator-&gt;GetNext(getter_AddRefs(aSupport));</span>
<a href="#l107.31"></a><span id="l107.31" class="difflineminus">-    nsCOMPtr&lt;nsILocalFile&gt; entry(do_QueryInterface(aSupport, &amp;rv));</span>
<a href="#l107.32"></a><span id="l107.32" class="difflineplus">+    nsCOMPtr&lt;nsIFile&gt; entry(do_QueryInterface(aSupport, &amp;rv));</span>
<a href="#l107.33"></a><span id="l107.33">     directoryEnumerator-&gt;HasMoreElements(&amp;hasMore);</span>
<a href="#l107.34"></a><span id="l107.34"> </span>
<a href="#l107.35"></a><span id="l107.35">     if (NS_SUCCEEDED(rv))</span>
<a href="#l107.36"></a><span id="l107.36">     {</span>
<a href="#l107.37"></a><span id="l107.37">       rv = entry-&gt;GetNativeLeafName(fName);</span>
<a href="#l107.38"></a><span id="l107.38">       if (NS_SUCCEEDED(rv) &amp;&amp; !fName.IsEmpty())</span>
<a href="#l107.39"></a><span id="l107.39">       {</span>
<a href="#l107.40"></a><span id="l107.40">         if (fName.Length() &gt; 4)</span>
<a href="#l107.41"></a><span id="l107.41" class="difflineat">@@ -445,22 +445,21 @@ nsresult nsEudoraWin32::FoundMailbox(nsI</span>
<a href="#l107.42"></a><span id="l107.42">   nsresult rv = pImport-&gt;CreateNewMailboxDescriptor(getter_AddRefs(desc));</span>
<a href="#l107.43"></a><span id="l107.43">   if (NS_SUCCEEDED(rv))</span>
<a href="#l107.44"></a><span id="l107.44">   {</span>
<a href="#l107.45"></a><span id="l107.45">     PRInt64 sz = 0;</span>
<a href="#l107.46"></a><span id="l107.46">     mailFile-&gt;GetFileSize(&amp;sz);</span>
<a href="#l107.47"></a><span id="l107.47">     desc-&gt;SetDisplayName(displayName.get());</span>
<a href="#l107.48"></a><span id="l107.48">     desc-&gt;SetDepth(m_depth);</span>
<a href="#l107.49"></a><span id="l107.49">     desc-&gt;SetSize(sz);</span>
<a href="#l107.50"></a><span id="l107.50" class="difflineminus">-    nsCOMPtr &lt;nsILocalFile&gt; pFile = nsnull;</span>
<a href="#l107.51"></a><span id="l107.51" class="difflineplus">+    nsCOMPtr &lt;nsIFile&gt; pFile = nsnull;</span>
<a href="#l107.52"></a><span id="l107.52">     desc-&gt;GetFile(getter_AddRefs(pFile));</span>
<a href="#l107.53"></a><span id="l107.53">     if (pFile)</span>
<a href="#l107.54"></a><span id="l107.54">     {</span>
<a href="#l107.55"></a><span id="l107.55" class="difflineminus">-      nsCOMPtr &lt;nsILocalFile&gt; localMailFile = do_QueryInterface(mailFile);</span>
<a href="#l107.56"></a><span id="l107.56" class="difflineminus">-      pFile-&gt;InitWithFile(localMailFile);</span>
<a href="#l107.57"></a><span id="l107.57" class="difflineplus">+      pFile-&gt;InitWithFile(mailFile);</span>
<a href="#l107.58"></a><span id="l107.58">     }</span>
<a href="#l107.59"></a><span id="l107.59">     rv = desc-&gt;QueryInterface(kISupportsIID, (void **) &amp;pInterface);</span>
<a href="#l107.60"></a><span id="l107.60">     pArray-&gt;AppendElement(pInterface);</span>
<a href="#l107.61"></a><span id="l107.61">     pInterface-&gt;Release();</span>
<a href="#l107.62"></a><span id="l107.62">   }</span>
<a href="#l107.63"></a><span id="l107.63"> </span>
<a href="#l107.64"></a><span id="l107.64">   return NS_OK;</span>
<a href="#l107.65"></a><span id="l107.65"> }</span>
<a href="#l107.66"></a><span id="l107.66" class="difflineat">@@ -486,22 +485,21 @@ nsresult nsEudoraWin32::FoundMailFolder(</span>
<a href="#l107.67"></a><span id="l107.67"> </span>
<a href="#l107.68"></a><span id="l107.68">   nsresult rv = pImport-&gt;CreateNewMailboxDescriptor(getter_AddRefs(desc));</span>
<a href="#l107.69"></a><span id="l107.69">   if (NS_SUCCEEDED(rv))</span>
<a href="#l107.70"></a><span id="l107.70">   {</span>
<a href="#l107.71"></a><span id="l107.71">     PRUint32    sz = 0;</span>
<a href="#l107.72"></a><span id="l107.72">     desc-&gt;SetDisplayName(displayName.get());</span>
<a href="#l107.73"></a><span id="l107.73">     desc-&gt;SetDepth(m_depth);</span>
<a href="#l107.74"></a><span id="l107.74">     desc-&gt;SetSize(sz);</span>
<a href="#l107.75"></a><span id="l107.75" class="difflineminus">-    nsCOMPtr &lt;nsILocalFile&gt; pFile = nsnull;</span>
<a href="#l107.76"></a><span id="l107.76" class="difflineplus">+    nsCOMPtr &lt;nsIFile&gt; pFile = nsnull;</span>
<a href="#l107.77"></a><span id="l107.77">     desc-&gt;GetFile(getter_AddRefs(pFile));</span>
<a href="#l107.78"></a><span id="l107.78">     if (pFile)</span>
<a href="#l107.79"></a><span id="l107.79">     {</span>
<a href="#l107.80"></a><span id="l107.80" class="difflineminus">-      nsCOMPtr &lt;nsILocalFile&gt; localMailFile = do_QueryInterface(mailFolder);</span>
<a href="#l107.81"></a><span id="l107.81" class="difflineminus">-      pFile-&gt;InitWithFile(localMailFile);</span>
<a href="#l107.82"></a><span id="l107.82" class="difflineplus">+      pFile-&gt;InitWithFile(mailFolder);</span>
<a href="#l107.83"></a><span id="l107.83">     }</span>
<a href="#l107.84"></a><span id="l107.84">     rv = desc-&gt;QueryInterface(kISupportsIID, (void **) &amp;pInterface);</span>
<a href="#l107.85"></a><span id="l107.85">     pArray-&gt;AppendElement(pInterface);</span>
<a href="#l107.86"></a><span id="l107.86">     pInterface-&gt;Release();</span>
<a href="#l107.87"></a><span id="l107.87">   }</span>
<a href="#l107.88"></a><span id="l107.88"> </span>
<a href="#l107.89"></a><span id="l107.89">   return NS_OK;</span>
<a href="#l107.90"></a><span id="l107.90"> }</span>
<a href="#l107.91"></a><span id="l107.91" class="difflineat">@@ -663,17 +661,17 @@ bool nsEudoraWin32::FindFiltersFile(nsIF</span>
<a href="#l107.92"></a><span id="l107.92"> }</span>
<a href="#l107.93"></a><span id="l107.93"> </span>
<a href="#l107.94"></a><span id="l107.94"> bool nsEudoraWin32::GetMailboxNameHierarchy(const nsACString&amp; pEudoraLocation, const char* pEudoraFilePath, nsCString&amp; nameHierarchy)</span>
<a href="#l107.95"></a><span id="l107.95"> {</span>
<a href="#l107.96"></a><span id="l107.96">   if (pEudoraLocation.IsEmpty() || !pEudoraFilePath || !*pEudoraFilePath)</span>
<a href="#l107.97"></a><span id="l107.97">     return false;</span>
<a href="#l107.98"></a><span id="l107.98"> </span>
<a href="#l107.99"></a><span id="l107.99">   nsresult rv;</span>
<a href="#l107.100"></a><span id="l107.100" class="difflineminus">-  nsCOMPtr &lt;nsILocalFile&gt; descMap = do_CreateInstance(NS_LOCAL_FILE_CONTRACTID);</span>
<a href="#l107.101"></a><span id="l107.101" class="difflineplus">+  nsCOMPtr &lt;nsIFile&gt; descMap = do_CreateInstance(NS_LOCAL_FILE_CONTRACTID);</span>
<a href="#l107.102"></a><span id="l107.102"> </span>
<a href="#l107.103"></a><span id="l107.103">   rv = descMap-&gt;InitWithNativePath(pEudoraLocation);</span>
<a href="#l107.104"></a><span id="l107.104">   NS_ENSURE_SUCCESS(rv, false);</span>
<a href="#l107.105"></a><span id="l107.105">   rv = descMap-&gt;AppendNative(NS_LITERAL_CSTRING(&quot;descmap.pce&quot;));</span>
<a href="#l107.106"></a><span id="l107.106">   NS_ENSURE_SUCCESS(rv, false);</span>
<a href="#l107.107"></a><span id="l107.107"> </span>
<a href="#l107.108"></a><span id="l107.108">   nsCOMPtr &lt;nsIInputStream&gt; inputStream;</span>
<a href="#l107.109"></a><span id="l107.109">   rv = NS_NewLocalFileInputStream(getter_AddRefs(inputStream), descMap);</span>
<a href="#l107.110"></a><span id="l107.110" class="difflineat">@@ -981,19 +979,17 @@ void nsEudoraWin32::SetSmtpServer(nsIMsg</span>
<a href="#l107.111"></a><span id="l107.111">     }</span>
<a href="#l107.112"></a><span id="l107.112">   }</span>
<a href="#l107.113"></a><span id="l107.113"> }</span>
<a href="#l107.114"></a><span id="l107.114"> </span>
<a href="#l107.115"></a><span id="l107.115"> nsresult nsEudoraWin32::GetAttachmentInfo(const char *pFileName, nsIFile *pFile, nsCString&amp; mimeType, nsCString&amp; aAttachmentName)</span>
<a href="#l107.116"></a><span id="l107.116"> {</span>
<a href="#l107.117"></a><span id="l107.117">   nsresult  rv;</span>
<a href="#l107.118"></a><span id="l107.118">   mimeType.Truncate();</span>
<a href="#l107.119"></a><span id="l107.119" class="difflineminus">-  nsCOMPtr &lt;nsILocalFile&gt; pLocalFile = do_QueryInterface(pFile, &amp;rv);</span>
<a href="#l107.120"></a><span id="l107.120" class="difflineminus">-  NS_ENSURE_SUCCESS(rv, rv);</span>
<a href="#l107.121"></a><span id="l107.121" class="difflineminus">-  pLocalFile-&gt;InitWithNativePath(nsDependentCString(pFileName));</span>
<a href="#l107.122"></a><span id="l107.122" class="difflineplus">+  pFile-&gt;InitWithNativePath(nsDependentCString(pFileName));</span>
<a href="#l107.123"></a><span id="l107.123">   bool      isFile = false;</span>
<a href="#l107.124"></a><span id="l107.124">   bool      exists = false;</span>
<a href="#l107.125"></a><span id="l107.125">   if (NS_FAILED(rv = pFile-&gt;Exists(&amp;exists)))</span>
<a href="#l107.126"></a><span id="l107.126">     return rv;</span>
<a href="#l107.127"></a><span id="l107.127">   if (exists &amp;&amp; NS_FAILED(rv = pFile-&gt;IsFile(&amp;isFile)))</span>
<a href="#l107.128"></a><span id="l107.128">     return rv;</span>
<a href="#l107.129"></a><span id="l107.129"> </span>
<a href="#l107.130"></a><span id="l107.130">   if (!exists || !isFile)</span>
<a href="#l107.131"></a><span id="l107.131" class="difflineat">@@ -1035,17 +1031,17 @@ nsresult nsEudoraWin32::GetAttachmentInf</span>
<a href="#l107.132"></a><span id="l107.132">       if (exists &amp;&amp; NS_FAILED(rv = altFile-&gt;IsFile(&amp;isFile)))</span>
<a href="#l107.133"></a><span id="l107.133">         return rv;</span>
<a href="#l107.134"></a><span id="l107.134"> </span>
<a href="#l107.135"></a><span id="l107.135">       // Keep the new path if it helped us.</span>
<a href="#l107.136"></a><span id="l107.136">       if (exists &amp;&amp; isFile)</span>
<a href="#l107.137"></a><span id="l107.137">       {</span>
<a href="#l107.138"></a><span id="l107.138">         nsCString   nativePath;</span>
<a href="#l107.139"></a><span id="l107.139">         altFile-&gt;GetNativePath(nativePath);</span>
<a href="#l107.140"></a><span id="l107.140" class="difflineminus">-        pLocalFile-&gt;InitWithNativePath(nativePath);</span>
<a href="#l107.141"></a><span id="l107.141" class="difflineplus">+        pFile-&gt;InitWithNativePath(nativePath);</span>
<a href="#l107.142"></a><span id="l107.142">       }</span>
<a href="#l107.143"></a><span id="l107.143">     }</span>
<a href="#l107.144"></a><span id="l107.144">   }</span>
<a href="#l107.145"></a><span id="l107.145"> </span>
<a href="#l107.146"></a><span id="l107.146">   if (exists &amp;&amp; isFile)</span>
<a href="#l107.147"></a><span id="l107.147">   {</span>
<a href="#l107.148"></a><span id="l107.148">     nsCAutoString name;</span>
<a href="#l107.149"></a><span id="l107.149">     pFile-&gt;GetNativeLeafName(name);</span>
<a href="#l107.150"></a><span id="l107.150" class="difflineat">@@ -1080,33 +1076,30 @@ nsresult nsEudoraWin32::GetAttachmentInf</span>
<a href="#l107.151"></a><span id="l107.151"> </span>
<a href="#l107.152"></a><span id="l107.152"> bool nsEudoraWin32::FindMimeIniFile(nsIFile *pFile)</span>
<a href="#l107.153"></a><span id="l107.153"> {</span>
<a href="#l107.154"></a><span id="l107.154">   bool hasMore;</span>
<a href="#l107.155"></a><span id="l107.155">   nsCOMPtr&lt;nsISimpleEnumerator&gt; directoryEnumerator;</span>
<a href="#l107.156"></a><span id="l107.156">   nsresult rv = pFile-&gt;GetDirectoryEntries(getter_AddRefs(directoryEnumerator));</span>
<a href="#l107.157"></a><span id="l107.157">   NS_ENSURE_SUCCESS(rv, rv);</span>
<a href="#l107.158"></a><span id="l107.158"> </span>
<a href="#l107.159"></a><span id="l107.159" class="difflineminus">-  nsCOMPtr &lt;nsILocalFile&gt; pLocalFile = do_QueryInterface(pFile, &amp;rv);</span>
<a href="#l107.160"></a><span id="l107.160" class="difflineminus">-  NS_ENSURE_SUCCESS(rv, rv);</span>
<a href="#l107.161"></a><span id="l107.161" class="difflineminus">-</span>
<a href="#l107.162"></a><span id="l107.162">   directoryEnumerator-&gt;HasMoreElements(&amp;hasMore);</span>
<a href="#l107.163"></a><span id="l107.163">   bool              isFile;</span>
<a href="#l107.164"></a><span id="l107.164">   nsCOMPtr&lt;nsIFile&gt; entry;</span>
<a href="#l107.165"></a><span id="l107.165">   nsCString         fName;</span>
<a href="#l107.166"></a><span id="l107.166">   nsCString         ext;</span>
<a href="#l107.167"></a><span id="l107.167">   nsCString         name;</span>
<a href="#l107.168"></a><span id="l107.168"> </span>
<a href="#l107.169"></a><span id="l107.169">   bool found = false;</span>
<a href="#l107.170"></a><span id="l107.170"> </span>
<a href="#l107.171"></a><span id="l107.171">   while (hasMore &amp;&amp; NS_SUCCEEDED(rv))</span>
<a href="#l107.172"></a><span id="l107.172">   {</span>
<a href="#l107.173"></a><span id="l107.173">     nsCOMPtr&lt;nsISupports&gt; aSupport;</span>
<a href="#l107.174"></a><span id="l107.174">     rv = directoryEnumerator-&gt;GetNext(getter_AddRefs(aSupport));</span>
<a href="#l107.175"></a><span id="l107.175" class="difflineminus">-    nsCOMPtr&lt;nsILocalFile&gt; entry(do_QueryInterface(aSupport, &amp;rv));</span>
<a href="#l107.176"></a><span id="l107.176" class="difflineplus">+    nsCOMPtr&lt;nsIFile&gt; entry(do_QueryInterface(aSupport, &amp;rv));</span>
<a href="#l107.177"></a><span id="l107.177">     directoryEnumerator-&gt;HasMoreElements(&amp;hasMore);</span>
<a href="#l107.178"></a><span id="l107.178"> </span>
<a href="#l107.179"></a><span id="l107.179"> </span>
<a href="#l107.180"></a><span id="l107.180">     if (NS_SUCCEEDED(rv))</span>
<a href="#l107.181"></a><span id="l107.181">     {</span>
<a href="#l107.182"></a><span id="l107.182">       rv = entry-&gt;GetNativeLeafName(fName);</span>
<a href="#l107.183"></a><span id="l107.183">       if (NS_SUCCEEDED(rv) &amp;&amp; !fName.IsEmpty())</span>
<a href="#l107.184"></a><span id="l107.184">       {</span>
<a href="#l107.185"></a><span id="l107.185" class="difflineat">@@ -1129,21 +1122,21 @@ bool nsEudoraWin32::FindMimeIniFile(nsIF</span>
<a href="#l107.186"></a><span id="l107.186">           {</span>
<a href="#l107.187"></a><span id="l107.187">             if (found)</span>
<a href="#l107.188"></a><span id="l107.188">             {</span>
<a href="#l107.189"></a><span id="l107.189">               // which one of these files is newer?</span>
<a href="#l107.190"></a><span id="l107.190">               PRInt64  modDate1, modDate2;</span>
<a href="#l107.191"></a><span id="l107.191">               entry-&gt;GetLastModifiedTime(&amp;modDate2);</span>
<a href="#l107.192"></a><span id="l107.192">               pFile-&gt;GetLastModifiedTime(&amp;modDate1);</span>
<a href="#l107.193"></a><span id="l107.193">               if (modDate2 &gt; modDate1)</span>
<a href="#l107.194"></a><span id="l107.194" class="difflineminus">-                pLocalFile-&gt;InitWithFile(entry);</span>
<a href="#l107.195"></a><span id="l107.195" class="difflineplus">+                pFile-&gt;InitWithFile(entry);</span>
<a href="#l107.196"></a><span id="l107.196">             }</span>
<a href="#l107.197"></a><span id="l107.197">             else</span>
<a href="#l107.198"></a><span id="l107.198">             {</span>
<a href="#l107.199"></a><span id="l107.199" class="difflineminus">-              pLocalFile-&gt;InitWithFile(entry);</span>
<a href="#l107.200"></a><span id="l107.200" class="difflineplus">+              pFile-&gt;InitWithFile(entry);</span>
<a href="#l107.201"></a><span id="l107.201">               found = true;</span>
<a href="#l107.202"></a><span id="l107.202">             }</span>
<a href="#l107.203"></a><span id="l107.203">           }</span>
<a href="#l107.204"></a><span id="l107.204">         }</span>
<a href="#l107.205"></a><span id="l107.205">       }</span>
<a href="#l107.206"></a><span id="l107.206">     }</span>
<a href="#l107.207"></a><span id="l107.207">   }</span>
<a href="#l107.208"></a><span id="l107.208">   return found;</span>
<a href="#l107.209"></a><span id="l107.209" class="difflineat">@@ -1170,17 +1163,17 @@ void nsEudoraWin32::GetMimeTypeFromExten</span>
<a href="#l107.210"></a><span id="l107.210"> </span>
<a href="#l107.211"></a><span id="l107.211">   // TLR: FIXME: We should/could cache the extension to mime type maps we find</span>
<a href="#l107.212"></a><span id="l107.212">   // and check the cache first before scanning all of eudora's mappings?</span>
<a href="#l107.213"></a><span id="l107.213"> </span>
<a href="#l107.214"></a><span id="l107.214">   // It's not in the registry, try and find the .ini file for Eudora's private</span>
<a href="#l107.215"></a><span id="l107.215">   // mime type list</span>
<a href="#l107.216"></a><span id="l107.216">   if (!m_pMimeSection)</span>
<a href="#l107.217"></a><span id="l107.217">   {</span>
<a href="#l107.218"></a><span id="l107.218" class="difflineminus">-    nsCOMPtr &lt;nsILocalFile&gt; pFile = do_CreateInstance(NS_LOCAL_FILE_CONTRACTID);</span>
<a href="#l107.219"></a><span id="l107.219" class="difflineplus">+    nsCOMPtr &lt;nsIFile&gt; pFile = do_CreateInstance(NS_LOCAL_FILE_CONTRACTID);</span>
<a href="#l107.220"></a><span id="l107.220">     if (!pFile)</span>
<a href="#l107.221"></a><span id="l107.221">       return;</span>
<a href="#l107.222"></a><span id="l107.222"> </span>
<a href="#l107.223"></a><span id="l107.223">     pFile-&gt;InitWithFile(m_mailImportLocation);</span>
<a href="#l107.224"></a><span id="l107.224"> </span>
<a href="#l107.225"></a><span id="l107.225">     pFile-&gt;AppendNative(NS_LITERAL_CSTRING(&quot;eudora.ini&quot;));</span>
<a href="#l107.226"></a><span id="l107.226">     bool exists = false;</span>
<a href="#l107.227"></a><span id="l107.227">     bool isFile = false;</span>
<a href="#l107.228"></a><span id="l107.228" class="difflineat">@@ -1320,20 +1313,19 @@ bool nsEudoraWin32::FindAddressFolder(ns</span>
<a href="#l107.229"></a><span id="l107.229">   IMPORT_LOG0(&quot;*** Looking for Eudora address folder\n&quot;);</span>
<a href="#l107.230"></a><span id="l107.230"> </span>
<a href="#l107.231"></a><span id="l107.231">   return FindEudoraLocation(pFolder);</span>
<a href="#l107.232"></a><span id="l107.232"> }</span>
<a href="#l107.233"></a><span id="l107.233"> </span>
<a href="#l107.234"></a><span id="l107.234"> nsresult nsEudoraWin32::FindAddressBooks(nsIFile *pRoot, nsISupportsArray **ppArray)</span>
<a href="#l107.235"></a><span id="l107.235"> {</span>
<a href="#l107.236"></a><span id="l107.236">   nsresult rv;</span>
<a href="#l107.237"></a><span id="l107.237" class="difflineminus">-  nsCOMPtr&lt;nsILocalFile&gt; file = do_CreateInstance(NS_LOCAL_FILE_CONTRACTID, &amp;rv);</span>
<a href="#l107.238"></a><span id="l107.238" class="difflineplus">+  nsCOMPtr&lt;nsIFile&gt; file = do_CreateInstance(NS_LOCAL_FILE_CONTRACTID, &amp;rv);</span>
<a href="#l107.239"></a><span id="l107.239">   NS_ENSURE_SUCCESS(rv, rv);</span>
<a href="#l107.240"></a><span id="l107.240" class="difflineminus">-  nsCOMPtr&lt;nsILocalFile&gt; localRoot = do_QueryInterface(pRoot);</span>
<a href="#l107.241"></a><span id="l107.241" class="difflineminus">-  rv = file-&gt;InitWithFile(localRoot);</span>
<a href="#l107.242"></a><span id="l107.242" class="difflineplus">+  rv = file-&gt;InitWithFile(pRoot);</span>
<a href="#l107.243"></a><span id="l107.243">   NS_ENSURE_SUCCESS(rv, rv);</span>
<a href="#l107.244"></a><span id="l107.244"> </span>
<a href="#l107.245"></a><span id="l107.245">   rv = NS_NewISupportsArray(ppArray);</span>
<a href="#l107.246"></a><span id="l107.246">   if (NS_FAILED(rv))</span>
<a href="#l107.247"></a><span id="l107.247">   {</span>
<a href="#l107.248"></a><span id="l107.248">     IMPORT_LOG0(&quot;FAILED to allocate the nsISupportsArray\n&quot;);</span>
<a href="#l107.249"></a><span id="l107.249">     return rv;</span>
<a href="#l107.250"></a><span id="l107.250">   }</span>
<a href="#l107.251"></a><span id="l107.251" class="difflineat">@@ -1372,47 +1364,47 @@ nsresult nsEudoraWin32::FindAddressBooks</span>
<a href="#l107.252"></a><span id="l107.252"> </span>
<a href="#l107.253"></a><span id="l107.253">   if (exists &amp;&amp; isFile)</span>
<a href="#l107.254"></a><span id="l107.254">   {</span>
<a href="#l107.255"></a><span id="l107.255">     if (NS_FAILED(rv = FoundAddressBook(file, displayName.get(), *ppArray, impSvc)))</span>
<a href="#l107.256"></a><span id="l107.256">       return rv;</span>
<a href="#l107.257"></a><span id="l107.257">   }</span>
<a href="#l107.258"></a><span id="l107.258"> </span>
<a href="#l107.259"></a><span id="l107.259">   // Try the default directory</span>
<a href="#l107.260"></a><span id="l107.260" class="difflineminus">-  rv =   rv = file-&gt;InitWithFile(localRoot);</span>
<a href="#l107.261"></a><span id="l107.261" class="difflineplus">+  rv = file-&gt;InitWithFile(pRoot);</span>
<a href="#l107.262"></a><span id="l107.262">   if (NS_FAILED(rv))</span>
<a href="#l107.263"></a><span id="l107.263">     return rv;</span>
<a href="#l107.264"></a><span id="l107.264">   rv = file-&gt;AppendNative(NS_LITERAL_CSTRING(&quot;Nickname&quot;));</span>
<a href="#l107.265"></a><span id="l107.265">   bool isDir = false;</span>
<a href="#l107.266"></a><span id="l107.266">   exists = false;</span>
<a href="#l107.267"></a><span id="l107.267">   if (NS_SUCCEEDED(rv))</span>
<a href="#l107.268"></a><span id="l107.268">     rv = file-&gt;Exists(&amp;exists);</span>
<a href="#l107.269"></a><span id="l107.269">   if (NS_SUCCEEDED(rv) &amp;&amp; exists)</span>
<a href="#l107.270"></a><span id="l107.270">     rv = file-&gt;IsDirectory(&amp;isDir);</span>
<a href="#l107.271"></a><span id="l107.271">   if (exists &amp;&amp; isDir)</span>
<a href="#l107.272"></a><span id="l107.272">   {</span>
<a href="#l107.273"></a><span id="l107.273">     if (NS_FAILED(rv = ScanAddressDir(file, *ppArray, impSvc)))</span>
<a href="#l107.274"></a><span id="l107.274">       return rv;</span>
<a href="#l107.275"></a><span id="l107.275">   }</span>
<a href="#l107.276"></a><span id="l107.276"> </span>
<a href="#l107.277"></a><span id="l107.277">   // Try the ini file to find other directories!</span>
<a href="#l107.278"></a><span id="l107.278" class="difflineminus">-  rv =   rv = file-&gt;InitWithFile(localRoot);</span>
<a href="#l107.279"></a><span id="l107.279" class="difflineplus">+  rv = file-&gt;InitWithFile(pRoot);</span>
<a href="#l107.280"></a><span id="l107.280">   if (NS_FAILED(rv))</span>
<a href="#l107.281"></a><span id="l107.281">     return rv;</span>
<a href="#l107.282"></a><span id="l107.282">   rv = file-&gt;AppendNative(NS_LITERAL_CSTRING(&quot;eudora.ini&quot;));</span>
<a href="#l107.283"></a><span id="l107.283">   exists = false;</span>
<a href="#l107.284"></a><span id="l107.284">   isFile = false;</span>
<a href="#l107.285"></a><span id="l107.285">   if (NS_SUCCEEDED(rv))</span>
<a href="#l107.286"></a><span id="l107.286">     rv = file-&gt;Exists(&amp;exists);</span>
<a href="#l107.287"></a><span id="l107.287">   if (NS_SUCCEEDED(rv) &amp;&amp; exists)</span>
<a href="#l107.288"></a><span id="l107.288">     rv = file-&gt;IsFile(&amp;isFile);</span>
<a href="#l107.289"></a><span id="l107.289"> </span>
<a href="#l107.290"></a><span id="l107.290">   if (!isFile || !exists)</span>
<a href="#l107.291"></a><span id="l107.291">   {</span>
<a href="#l107.292"></a><span id="l107.292" class="difflineminus">-    rv = file-&gt;InitWithFile(localRoot);</span>
<a href="#l107.293"></a><span id="l107.293" class="difflineplus">+    rv = file-&gt;InitWithFile(pRoot);</span>
<a href="#l107.294"></a><span id="l107.294">     if (NS_FAILED(rv))</span>
<a href="#l107.295"></a><span id="l107.295">       return NS_OK;</span>
<a href="#l107.296"></a><span id="l107.296">     if (!FindMimeIniFile(file))</span>
<a href="#l107.297"></a><span id="l107.297">       return NS_OK;</span>
<a href="#l107.298"></a><span id="l107.298">   }</span>
<a href="#l107.299"></a><span id="l107.299"> </span>
<a href="#l107.300"></a><span id="l107.300">   nsCString fileName;</span>
<a href="#l107.301"></a><span id="l107.301">   file-&gt;GetNativePath(fileName);</span>
<a href="#l107.302"></a><span id="l107.302" class="difflineat">@@ -1476,33 +1468,30 @@ nsresult nsEudoraWin32::FindAddressBooks</span>
<a href="#l107.303"></a><span id="l107.303"> </span>
<a href="#l107.304"></a><span id="l107.304"> nsresult nsEudoraWin32::ScanAddressDir(nsIFile *pDir, nsISupportsArray *pArray, nsIImportService *impSvc)</span>
<a href="#l107.305"></a><span id="l107.305"> {</span>
<a href="#l107.306"></a><span id="l107.306">   bool hasMore;</span>
<a href="#l107.307"></a><span id="l107.307">   nsCOMPtr&lt;nsISimpleEnumerator&gt; directoryEnumerator;</span>
<a href="#l107.308"></a><span id="l107.308">   nsresult rv = pDir-&gt;GetDirectoryEntries(getter_AddRefs(directoryEnumerator));</span>
<a href="#l107.309"></a><span id="l107.309">   NS_ENSURE_SUCCESS(rv, rv);</span>
<a href="#l107.310"></a><span id="l107.310"> </span>
<a href="#l107.311"></a><span id="l107.311" class="difflineminus">-  nsCOMPtr &lt;nsILocalFile&gt; pLocalFile = do_QueryInterface(pDir, &amp;rv);</span>
<a href="#l107.312"></a><span id="l107.312" class="difflineminus">-  NS_ENSURE_SUCCESS(rv, rv);</span>
<a href="#l107.313"></a><span id="l107.313" class="difflineminus">-</span>
<a href="#l107.314"></a><span id="l107.314">   directoryEnumerator-&gt;HasMoreElements(&amp;hasMore);</span>
<a href="#l107.315"></a><span id="l107.315">   bool              isFile;</span>
<a href="#l107.316"></a><span id="l107.316">   nsCOMPtr&lt;nsIFile&gt; entry;</span>
<a href="#l107.317"></a><span id="l107.317">   nsCString         fName;</span>
<a href="#l107.318"></a><span id="l107.318">   nsCString         ext;</span>
<a href="#l107.319"></a><span id="l107.319">   nsCString         name;</span>
<a href="#l107.320"></a><span id="l107.320"> </span>
<a href="#l107.321"></a><span id="l107.321">   bool found = false;</span>
<a href="#l107.322"></a><span id="l107.322"> </span>
<a href="#l107.323"></a><span id="l107.323">   while (hasMore &amp;&amp; NS_SUCCEEDED(rv))</span>
<a href="#l107.324"></a><span id="l107.324">   {</span>
<a href="#l107.325"></a><span id="l107.325">     nsCOMPtr&lt;nsISupports&gt; aSupport;</span>
<a href="#l107.326"></a><span id="l107.326">     rv = directoryEnumerator-&gt;GetNext(getter_AddRefs(aSupport));</span>
<a href="#l107.327"></a><span id="l107.327" class="difflineminus">-    nsCOMPtr&lt;nsILocalFile&gt; entry(do_QueryInterface(aSupport, &amp;rv));</span>
<a href="#l107.328"></a><span id="l107.328" class="difflineplus">+    nsCOMPtr&lt;nsIFile&gt; entry(do_QueryInterface(aSupport, &amp;rv));</span>
<a href="#l107.329"></a><span id="l107.329">     directoryEnumerator-&gt;HasMoreElements(&amp;hasMore);</span>
<a href="#l107.330"></a><span id="l107.330"> </span>
<a href="#l107.331"></a><span id="l107.331">     if (NS_SUCCEEDED(rv))</span>
<a href="#l107.332"></a><span id="l107.332">     {</span>
<a href="#l107.333"></a><span id="l107.333">       rv = entry-&gt;GetNativeLeafName(fName);</span>
<a href="#l107.334"></a><span id="l107.334">       if (NS_SUCCEEDED(rv) &amp;&amp; !fName.IsEmpty())</span>
<a href="#l107.335"></a><span id="l107.335">       {</span>
<a href="#l107.336"></a><span id="l107.336">         if (fName.Length() &gt; 4)</span>
<a href="#l107.337"></a><span id="l107.337" class="difflineat">@@ -1552,27 +1541,24 @@ nsresult nsEudoraWin32::FoundAddressBook</span>
<a href="#l107.338"></a><span id="l107.338">     if (leaf.IsEmpty())</span>
<a href="#l107.339"></a><span id="l107.339">       return NS_ERROR_FAILURE;</span>
<a href="#l107.340"></a><span id="l107.340">     nsString  tStr;</span>
<a href="#l107.341"></a><span id="l107.341">     tStr = StringTail(leaf, 4);</span>
<a href="#l107.342"></a><span id="l107.342">     if (tStr.LowerCaseEqualsLiteral(&quot;.txt&quot;)  || tStr.LowerCaseEqualsLiteral(&quot;.nnt&quot;))</span>
<a href="#l107.343"></a><span id="l107.343">       leaf.SetLength(leaf.Length() - 4);</span>
<a href="#l107.344"></a><span id="l107.344">   }</span>
<a href="#l107.345"></a><span id="l107.345"> </span>
<a href="#l107.346"></a><span id="l107.346" class="difflineminus">-  nsCOMPtr&lt;nsILocalFile&gt; fileLoc = do_QueryInterface(file, &amp;rv);</span>
<a href="#l107.347"></a><span id="l107.347" class="difflineminus">-  NS_ENSURE_SUCCESS(rv, rv);</span>
<a href="#l107.348"></a><span id="l107.348" class="difflineminus">-</span>
<a href="#l107.349"></a><span id="l107.349">   rv = impSvc-&gt;CreateNewABDescriptor(getter_AddRefs(desc));</span>
<a href="#l107.350"></a><span id="l107.350">   if (NS_SUCCEEDED(rv))</span>
<a href="#l107.351"></a><span id="l107.351">   {</span>
<a href="#l107.352"></a><span id="l107.352">     PRInt64 sz = 0;</span>
<a href="#l107.353"></a><span id="l107.353">     file-&gt;GetFileSize(&amp;sz);</span>
<a href="#l107.354"></a><span id="l107.354">     desc-&gt;SetPreferredName(name);</span>
<a href="#l107.355"></a><span id="l107.355">     desc-&gt;SetSize((PRUint32) sz);</span>
<a href="#l107.356"></a><span id="l107.356" class="difflineminus">-    desc-&gt;SetAbFile(fileLoc);</span>
<a href="#l107.357"></a><span id="l107.357" class="difflineplus">+    desc-&gt;SetAbFile(file);</span>
<a href="#l107.358"></a><span id="l107.358">     rv = desc-&gt;QueryInterface(kISupportsIID, (void **) &amp;pInterface);</span>
<a href="#l107.359"></a><span id="l107.359">     pArray-&gt;AppendElement(pInterface);</span>
<a href="#l107.360"></a><span id="l107.360">     pInterface-&gt;Release();</span>
<a href="#l107.361"></a><span id="l107.361">   }</span>
<a href="#l107.362"></a><span id="l107.362">   if (NS_FAILED(rv))</span>
<a href="#l107.363"></a><span id="l107.363">   {</span>
<a href="#l107.364"></a><span id="l107.364">     IMPORT_LOG0(&quot;*** Error creating address book descriptor for eudora\n&quot;);</span>
<a href="#l107.365"></a><span id="l107.365">     return rv;</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l108.1"></a><span id="l108.1" class="difflineminus">--- a/mailnews/import/eudora/src/nsEudoraWin32.h</span>
<a href="#l108.2"></a><span id="l108.2" class="difflineplus">+++ b/mailnews/import/eudora/src/nsEudoraWin32.h</span>
<a href="#l108.3"></a><span id="l108.3" class="difflineat">@@ -4,17 +4,17 @@</span>
<a href="#l108.4"></a><span id="l108.4">  * License, v. 2.0. If a copy of the MPL was not distributed with this</span>
<a href="#l108.5"></a><span id="l108.5">  * file, You can obtain one at http://mozilla.org/MPL/2.0/. */</span>
<a href="#l108.6"></a><span id="l108.6"> </span>
<a href="#l108.7"></a><span id="l108.7"> #ifndef nsEudoraWin32_h__</span>
<a href="#l108.8"></a><span id="l108.8"> #define nsEudoraWin32_h__</span>
<a href="#l108.9"></a><span id="l108.9"> </span>
<a href="#l108.10"></a><span id="l108.10"> #include &quot;nscore.h&quot;</span>
<a href="#l108.11"></a><span id="l108.11"> #include &quot;nsStringGlue.h&quot;</span>
<a href="#l108.12"></a><span id="l108.12" class="difflineminus">-#include &quot;nsILocalFile.h&quot;</span>
<a href="#l108.13"></a><span id="l108.13" class="difflineplus">+#include &quot;nsIFile.h&quot;</span>
<a href="#l108.14"></a><span id="l108.14"> #include &quot;nsISupportsArray.h&quot;</span>
<a href="#l108.15"></a><span id="l108.15"> #include &quot;nsEudoraMailbox.h&quot;</span>
<a href="#l108.16"></a><span id="l108.16"> #include &quot;nsEudoraAddress.h&quot;</span>
<a href="#l108.17"></a><span id="l108.17"> </span>
<a href="#l108.18"></a><span id="l108.18"> #include &lt;windows.h&gt;</span>
<a href="#l108.19"></a><span id="l108.19"> </span>
<a href="#l108.20"></a><span id="l108.20"> class nsIImportService;</span>
<a href="#l108.21"></a><span id="l108.21"> class nsIMsgAccountManager;</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l109.1"></a><span id="l109.1" class="difflineminus">--- a/mailnews/import/oexpress/WabObject.cpp</span>
<a href="#l109.2"></a><span id="l109.2" class="difflineplus">+++ b/mailnews/import/oexpress/WabObject.cpp</span>
<a href="#l109.3"></a><span id="l109.3" class="difflineat">@@ -74,17 +74,17 @@ AddrImportField    extraUserFields[kExtr</span>
<a href="#l109.4"></a><span id="l109.4"> /*********************************************************************************/</span>
<a href="#l109.5"></a><span id="l109.5"> </span>
<a href="#l109.6"></a><span id="l109.6"> </span>
<a href="#l109.7"></a><span id="l109.7"> // contructor for CWAB object</span>
<a href="#l109.8"></a><span id="l109.8"> //</span>
<a href="#l109.9"></a><span id="l109.9"> // pszFileName - FileName of WAB file to open</span>
<a href="#l109.10"></a><span id="l109.10"> //          if no file name is specified, opens the default</span>
<a href="#l109.11"></a><span id="l109.11"> //</span>
<a href="#l109.12"></a><span id="l109.12" class="difflineminus">-CWAB::CWAB(nsILocalFile *file)</span>
<a href="#l109.13"></a><span id="l109.13" class="difflineplus">+CWAB::CWAB(nsIFile *file)</span>
<a href="#l109.14"></a><span id="l109.14"> {</span>
<a href="#l109.15"></a><span id="l109.15">     // Here we load the WAB Object and initialize it</span>
<a href="#l109.16"></a><span id="l109.16">     m_pUniBuff = NULL;</span>
<a href="#l109.17"></a><span id="l109.17">   m_uniBuffLen = 0;</span>
<a href="#l109.18"></a><span id="l109.18"> </span>
<a href="#l109.19"></a><span id="l109.19">   m_bInitialized = false;</span>
<a href="#l109.20"></a><span id="l109.20">   m_lpAdrBook = NULL;</span>
<a href="#l109.21"></a><span id="l109.21">   m_lpWABObject = NULL;</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l110.1"></a><span id="l110.1" class="difflineminus">--- a/mailnews/import/oexpress/WabObject.h</span>
<a href="#l110.2"></a><span id="l110.2" class="difflineplus">+++ b/mailnews/import/oexpress/WabObject.h</span>
<a href="#l110.3"></a><span id="l110.3" class="difflineat">@@ -4,33 +4,33 @@</span>
<a href="#l110.4"></a><span id="l110.4">  * file, You can obtain one at http://mozilla.org/MPL/2.0/. */</span>
<a href="#l110.5"></a><span id="l110.5"> </span>
<a href="#l110.6"></a><span id="l110.6"> #ifndef WabObject_h___</span>
<a href="#l110.7"></a><span id="l110.7"> #define WabObject_h___</span>
<a href="#l110.8"></a><span id="l110.8"> </span>
<a href="#l110.9"></a><span id="l110.9"> #include &quot;nscore.h&quot;</span>
<a href="#l110.10"></a><span id="l110.10"> #include &quot;prtypes.h&quot;</span>
<a href="#l110.11"></a><span id="l110.11"> #include &quot;nsStringGlue.h&quot;</span>
<a href="#l110.12"></a><span id="l110.12" class="difflineminus">-#include &quot;nsILocalFile.h&quot;</span>
<a href="#l110.13"></a><span id="l110.13" class="difflineplus">+#include &quot;nsIFile.h&quot;</span>
<a href="#l110.14"></a><span id="l110.14"> </span>
<a href="#l110.15"></a><span id="l110.15"> #include &lt;windows.h&gt;</span>
<a href="#l110.16"></a><span id="l110.16"> #include &lt;wab.h&gt;</span>
<a href="#l110.17"></a><span id="l110.17"> </span>
<a href="#l110.18"></a><span id="l110.18"> </span>
<a href="#l110.19"></a><span id="l110.19"> class CWabIterator {</span>
<a href="#l110.20"></a><span id="l110.20"> public:</span>
<a href="#l110.21"></a><span id="l110.21">   virtual nsresult  EnumUser(const PRUnichar *pName, LPENTRYID pEid, ULONG cbEid) = 0;</span>
<a href="#l110.22"></a><span id="l110.22">   virtual nsresult  EnumList(const PRUnichar *pName, LPENTRYID pEid, ULONG cbEid, LPMAPITABLE lpTable) = 0;</span>
<a href="#l110.23"></a><span id="l110.23"> };</span>
<a href="#l110.24"></a><span id="l110.24"> </span>
<a href="#l110.25"></a><span id="l110.25"> </span>
<a href="#l110.26"></a><span id="l110.26"> class CWAB</span>
<a href="#l110.27"></a><span id="l110.27"> {</span>
<a href="#l110.28"></a><span id="l110.28"> public:</span>
<a href="#l110.29"></a><span id="l110.29" class="difflineminus">-    CWAB(nsILocalFile *fileName);</span>
<a href="#l110.30"></a><span id="l110.30" class="difflineplus">+    CWAB(nsIFile *fileName);</span>
<a href="#l110.31"></a><span id="l110.31">     ~CWAB();</span>
<a href="#l110.32"></a><span id="l110.32"> </span>
<a href="#l110.33"></a><span id="l110.33">   bool      Loaded(void) { return m_bInitialized;}</span>
<a href="#l110.34"></a><span id="l110.34"> </span>
<a href="#l110.35"></a><span id="l110.35">   HRESULT    IterateWABContents(CWabIterator *pIter, int *pDone);</span>
<a href="#l110.36"></a><span id="l110.36"> </span>
<a href="#l110.37"></a><span id="l110.37">   // Methods for User entries</span>
<a href="#l110.38"></a><span id="l110.38">   LPDISTLIST    GetDistList(ULONG cbEid, LPENTRYID pEid);</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l111.1"></a><span id="l111.1" class="difflineminus">--- a/mailnews/import/oexpress/nsOEImport.cpp</span>
<a href="#l111.2"></a><span id="l111.2" class="difflineplus">+++ b/mailnews/import/oexpress/nsOEImport.cpp</span>
<a href="#l111.3"></a><span id="l111.3" class="difflineat">@@ -304,17 +304,17 @@ NS_IMETHODIMP ImportOEMailImpl::GetDefau</span>
<a href="#l111.4"></a><span id="l111.4">   NS_PRECONDITION(ppLoc != nsnull, &quot;null ptr&quot;);</span>
<a href="#l111.5"></a><span id="l111.5">   NS_PRECONDITION(found != nsnull, &quot;null ptr&quot;);</span>
<a href="#l111.6"></a><span id="l111.6">   NS_PRECONDITION(userVerify != nsnull, &quot;null ptr&quot;);</span>
<a href="#l111.7"></a><span id="l111.7">   if (!ppLoc || !found || !userVerify)</span>
<a href="#l111.8"></a><span id="l111.8">     return NS_ERROR_NULL_POINTER;</span>
<a href="#l111.9"></a><span id="l111.9"> </span>
<a href="#l111.10"></a><span id="l111.10">   // use scanboxes to find the location.</span>
<a href="#l111.11"></a><span id="l111.11">   nsresult rv;</span>
<a href="#l111.12"></a><span id="l111.12" class="difflineminus">-  nsCOMPtr &lt;nsILocalFile&gt; file = do_CreateInstance(NS_LOCAL_FILE_CONTRACTID, &amp;rv);</span>
<a href="#l111.13"></a><span id="l111.13" class="difflineplus">+  nsCOMPtr &lt;nsIFile&gt; file = do_CreateInstance(NS_LOCAL_FILE_CONTRACTID, &amp;rv);</span>
<a href="#l111.14"></a><span id="l111.14">   if (NS_FAILED(rv))</span>
<a href="#l111.15"></a><span id="l111.15">     return rv;</span>
<a href="#l111.16"></a><span id="l111.16"> </span>
<a href="#l111.17"></a><span id="l111.17">   if (nsOEScanBoxes::FindMail(file)) {</span>
<a href="#l111.18"></a><span id="l111.18">     *found = true;</span>
<a href="#l111.19"></a><span id="l111.19">     NS_IF_ADDREF(*ppLoc = file);</span>
<a href="#l111.20"></a><span id="l111.20">   }</span>
<a href="#l111.21"></a><span id="l111.21">   else {</span>
<a href="#l111.22"></a><span id="l111.22" class="difflineat">@@ -408,17 +408,17 @@ NS_IMETHODIMP ImportOEMailImpl::ImportMa</span>
<a href="#l111.23"></a><span id="l111.23">   PRUint32 mailSize = 0;</span>
<a href="#l111.24"></a><span id="l111.24">   pSource-&gt;GetSize(&amp;mailSize);</span>
<a href="#l111.25"></a><span id="l111.25">   if (mailSize == 0) {</span>
<a href="#l111.26"></a><span id="l111.26">     ReportSuccess(name, 0, &amp;success);</span>
<a href="#l111.27"></a><span id="l111.27">     SetLogs(success, error, pErrorLog, pSuccessLog);</span>
<a href="#l111.28"></a><span id="l111.28">     return NS_OK;</span>
<a href="#l111.29"></a><span id="l111.29">   }</span>
<a href="#l111.30"></a><span id="l111.30"> </span>
<a href="#l111.31"></a><span id="l111.31" class="difflineminus">-  nsCOMPtr &lt;nsILocalFile&gt; inFile;</span>
<a href="#l111.32"></a><span id="l111.32" class="difflineplus">+  nsCOMPtr &lt;nsIFile&gt; inFile;</span>
<a href="#l111.33"></a><span id="l111.33">   if (NS_FAILED(pSource-&gt;GetFile(getter_AddRefs(inFile)))) {</span>
<a href="#l111.34"></a><span id="l111.34">     ReportError(OEIMPORT_MAILBOX_BADSOURCEFILE, name, &amp;error);</span>
<a href="#l111.35"></a><span id="l111.35">     SetLogs(success, error, pErrorLog, pSuccessLog);</span>
<a href="#l111.36"></a><span id="l111.36">     return NS_ERROR_FAILURE;</span>
<a href="#l111.37"></a><span id="l111.37">   }</span>
<a href="#l111.38"></a><span id="l111.38"> </span>
<a href="#l111.39"></a><span id="l111.39">   nsCString pPath;</span>
<a href="#l111.40"></a><span id="l111.40">   inFile-&gt;GetNativePath(pPath);</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l112.1"></a><span id="l112.1" class="difflineminus">--- a/mailnews/import/oexpress/nsOEMailbox.cpp</span>
<a href="#l112.2"></a><span id="l112.2" class="difflineplus">+++ b/mailnews/import/oexpress/nsOEMailbox.cpp</span>
<a href="#l112.3"></a><span id="l112.3" class="difflineat">@@ -88,20 +88,19 @@ private:</span>
<a href="#l112.4"></a><span id="l112.4"> </span>
<a href="#l112.5"></a><span id="l112.5"> </span>
<a href="#l112.6"></a><span id="l112.6"> bool CImportMailbox::ImportMailbox(PRUint32 *pDone, bool *pAbort,</span>
<a href="#l112.7"></a><span id="l112.7">                                    nsString&amp; name, nsIFile * inFile,</span>
<a href="#l112.8"></a><span id="l112.8">                                    nsIMsgFolder *outFolder, PRUint32 *pCount)</span>
<a href="#l112.9"></a><span id="l112.9"> {</span>
<a href="#l112.10"></a><span id="l112.10">   bool    done = false;</span>
<a href="#l112.11"></a><span id="l112.11">   nsresult rv;</span>
<a href="#l112.12"></a><span id="l112.12" class="difflineminus">-  nsCOMPtr &lt;nsILocalFile&gt; localInFile = do_QueryInterface(inFile, &amp;rv);</span>
<a href="#l112.13"></a><span id="l112.13" class="difflineminus">-  nsCOMPtr &lt;nsILocalFile&gt; idxFile = do_CreateInstance(NS_LOCAL_FILE_CONTRACTID, &amp;rv);</span>
<a href="#l112.14"></a><span id="l112.14" class="difflineplus">+  nsCOMPtr &lt;nsIFile&gt; idxFile = do_CreateInstance(NS_LOCAL_FILE_CONTRACTID, &amp;rv);</span>
<a href="#l112.15"></a><span id="l112.15">   if (NS_SUCCEEDED(rv))</span>
<a href="#l112.16"></a><span id="l112.16" class="difflineminus">-    rv  = idxFile-&gt;InitWithFile(localInFile);</span>
<a href="#l112.17"></a><span id="l112.17" class="difflineplus">+    rv  = idxFile-&gt;InitWithFile(inFile);</span>
<a href="#l112.18"></a><span id="l112.18">   if (NS_FAILED(rv)) {</span>
<a href="#l112.19"></a><span id="l112.19">     IMPORT_LOG0(&quot;New file spec failed!\n&quot;);</span>
<a href="#l112.20"></a><span id="l112.20">     return false;</span>
<a href="#l112.21"></a><span id="l112.21">   }</span>
<a href="#l112.22"></a><span id="l112.22"> </span>
<a href="#l112.23"></a><span id="l112.23">   if (GetIndexFile(idxFile)) {</span>
<a href="#l112.24"></a><span id="l112.24"> </span>
<a href="#l112.25"></a><span id="l112.25">     IMPORT_LOG1(&quot;Using index file for: %S\n&quot;, name.get());</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l113.1"></a><span id="l113.1" class="difflineminus">--- a/mailnews/import/oexpress/nsOEScanBoxes.cpp</span>
<a href="#l113.2"></a><span id="l113.2" class="difflineplus">+++ b/mailnews/import/oexpress/nsOEScanBoxes.cpp</span>
<a href="#l113.3"></a><span id="l113.3" class="difflineat">@@ -2,17 +2,17 @@</span>
<a href="#l113.4"></a><span id="l113.4"> /* This Source Code Form is subject to the terms of the Mozilla Public</span>
<a href="#l113.5"></a><span id="l113.5">  * License, v. 2.0. If a copy of the MPL was not distributed with this</span>
<a href="#l113.6"></a><span id="l113.6">  * file, You can obtain one at http://mozilla.org/MPL/2.0/. */</span>
<a href="#l113.7"></a><span id="l113.7"> #include &quot;nsOEScanBoxes.h&quot;</span>
<a href="#l113.8"></a><span id="l113.8"> #include &quot;nsMsgUtils.h&quot;</span>
<a href="#l113.9"></a><span id="l113.9"> #include &quot;nsIComponentManager.h&quot;</span>
<a href="#l113.10"></a><span id="l113.10"> #include &quot;nsIServiceManager.h&quot;</span>
<a href="#l113.11"></a><span id="l113.11"> #include &quot;nsIImportService.h&quot;</span>
<a href="#l113.12"></a><span id="l113.12" class="difflineminus">-#include &quot;nsILocalFile.h&quot;</span>
<a href="#l113.13"></a><span id="l113.13" class="difflineplus">+#include &quot;nsIFile.h&quot;</span>
<a href="#l113.14"></a><span id="l113.14"> #include &quot;nsIImportMailboxDescriptor.h&quot;</span>
<a href="#l113.15"></a><span id="l113.15"> #include &quot;nsOERegUtil.h&quot;</span>
<a href="#l113.16"></a><span id="l113.16"> #include &quot;nsOE5File.h&quot;</span>
<a href="#l113.17"></a><span id="l113.17"> #include &quot;nsNetUtil.h&quot;</span>
<a href="#l113.18"></a><span id="l113.18"> #include &quot;OEDebugLog.h&quot;</span>
<a href="#l113.19"></a><span id="l113.19"> #include &quot;nsIInputStream.h&quot;</span>
<a href="#l113.20"></a><span id="l113.20"> #include &quot;nsISeekableStream.h&quot;</span>
<a href="#l113.21"></a><span id="l113.21"> #include &quot;plstr.h&quot;</span>
<a href="#l113.22"></a><span id="l113.22" class="difflineat">@@ -65,30 +65,29 @@ nsOEScanBoxes::~nsOEScanBoxes()</span>
<a href="#l113.23"></a><span id="l113.23">   Identities/{GUID}/Software/Microsoft/Outlook Express/5.0/</span>
<a href="#l113.24"></a><span id="l113.24"> */</span>
<a href="#l113.25"></a><span id="l113.25"> </span>
<a href="#l113.26"></a><span id="l113.26"> bool nsOEScanBoxes::Find50Mail(nsIFile *pWhere)</span>
<a href="#l113.27"></a><span id="l113.27"> {</span>
<a href="#l113.28"></a><span id="l113.28">   nsresult   rv;</span>
<a href="#l113.29"></a><span id="l113.29">   bool      success = false;</span>
<a href="#l113.30"></a><span id="l113.30">   HKEY    sKey;</span>
<a href="#l113.31"></a><span id="l113.31" class="difflineminus">-        nsCOMPtr &lt;nsILocalFile&gt; localWhere = do_QueryInterface(pWhere);</span>
<a href="#l113.32"></a><span id="l113.32"> </span>
<a href="#l113.33"></a><span id="l113.33">   if (::RegOpenKeyEx(HKEY_CURRENT_USER, &quot;Identities&quot;, 0, KEY_QUERY_VALUE, &amp;sKey) == ERROR_SUCCESS) {</span>
<a href="#l113.34"></a><span id="l113.34">     BYTE *  pBytes = nsOERegUtil::GetValueBytes(sKey, &quot;Default User ID&quot;);</span>
<a href="#l113.35"></a><span id="l113.35">     ::RegCloseKey(sKey);</span>
<a href="#l113.36"></a><span id="l113.36">     if (pBytes) {</span>
<a href="#l113.37"></a><span id="l113.37">       nsCString  key(&quot;Identities\\&quot;);</span>
<a href="#l113.38"></a><span id="l113.38">       key += (const char *)pBytes;</span>
<a href="#l113.39"></a><span id="l113.39">       nsOERegUtil::FreeValueBytes(pBytes);</span>
<a href="#l113.40"></a><span id="l113.40">       key += &quot;\\Software\\Microsoft\\Outlook Express\\5.0&quot;;</span>
<a href="#l113.41"></a><span id="l113.41">       if (::RegOpenKeyEx(HKEY_CURRENT_USER, key.get(), 0, KEY_QUERY_VALUE, &amp;sKey) == ERROR_SUCCESS) {</span>
<a href="#l113.42"></a><span id="l113.42">         pBytes = nsOERegUtil::GetValueBytes(sKey, &quot;Store Root&quot;);</span>
<a href="#l113.43"></a><span id="l113.43">         if (pBytes) {</span>
<a href="#l113.44"></a><span id="l113.44" class="difflineminus">-          localWhere-&gt;InitWithNativePath(nsDependentCString((const char *)pBytes));</span>
<a href="#l113.45"></a><span id="l113.45" class="difflineplus">+          pWhere-&gt;InitWithNativePath(nsDependentCString((const char *)pBytes));</span>
<a href="#l113.46"></a><span id="l113.46"> </span>
<a href="#l113.47"></a><span id="l113.47">           IMPORT_LOG1(&quot;Setting native path: %s\n&quot;, pBytes);</span>
<a href="#l113.48"></a><span id="l113.48"> </span>
<a href="#l113.49"></a><span id="l113.49">           nsOERegUtil::FreeValueBytes(pBytes);</span>
<a href="#l113.50"></a><span id="l113.50">           bool    isDir = false;</span>
<a href="#l113.51"></a><span id="l113.51">           rv = pWhere-&gt;IsDirectory(&amp;isDir);</span>
<a href="#l113.52"></a><span id="l113.52">           if (isDir &amp;&amp; NS_SUCCEEDED(rv))</span>
<a href="#l113.53"></a><span id="l113.53">             success = true;</span>
<a href="#l113.54"></a><span id="l113.54" class="difflineat">@@ -101,25 +100,24 @@ bool nsOEScanBoxes::Find50Mail(nsIFile *</span>
<a href="#l113.55"></a><span id="l113.55">   return success;</span>
<a href="#l113.56"></a><span id="l113.56"> }</span>
<a href="#l113.57"></a><span id="l113.57"> </span>
<a href="#l113.58"></a><span id="l113.58"> bool nsOEScanBoxes::FindMail(nsIFile *pWhere)</span>
<a href="#l113.59"></a><span id="l113.59"> {</span>
<a href="#l113.60"></a><span id="l113.60">   nsresult   rv;</span>
<a href="#l113.61"></a><span id="l113.61">   bool      success = false;</span>
<a href="#l113.62"></a><span id="l113.62">   HKEY    sKey;</span>
<a href="#l113.63"></a><span id="l113.63" class="difflineminus">-        nsCOMPtr &lt;nsILocalFile&gt; localWhere = do_QueryInterface(pWhere);</span>
<a href="#l113.64"></a><span id="l113.64"> </span>
<a href="#l113.65"></a><span id="l113.65">   if (Find50Mail(pWhere))</span>
<a href="#l113.66"></a><span id="l113.66">     return true;</span>
<a href="#l113.67"></a><span id="l113.67"> </span>
<a href="#l113.68"></a><span id="l113.68">   if (::RegOpenKeyEx(HKEY_CURRENT_USER, &quot;Software\\Microsoft\\Outlook Express&quot;, 0, KEY_QUERY_VALUE, &amp;sKey) == ERROR_SUCCESS) {</span>
<a href="#l113.69"></a><span id="l113.69">     LPBYTE  pBytes = nsOERegUtil::GetValueBytes(sKey, &quot;Store Root&quot;);</span>
<a href="#l113.70"></a><span id="l113.70">     if (pBytes) {</span>
<a href="#l113.71"></a><span id="l113.71" class="difflineminus">-      localWhere-&gt;InitWithNativePath(nsDependentCString((const char *) pBytes));</span>
<a href="#l113.72"></a><span id="l113.72" class="difflineplus">+      pWhere-&gt;InitWithNativePath(nsDependentCString((const char *) pBytes));</span>
<a href="#l113.73"></a><span id="l113.73">       pWhere-&gt;AppendNative(NS_LITERAL_CSTRING(&quot;Mail&quot;));</span>
<a href="#l113.74"></a><span id="l113.74">       bool    isDir = false;</span>
<a href="#l113.75"></a><span id="l113.75">       rv = pWhere-&gt;IsDirectory(&amp;isDir);</span>
<a href="#l113.76"></a><span id="l113.76">       if (isDir &amp;&amp; NS_SUCCEEDED(rv))</span>
<a href="#l113.77"></a><span id="l113.77">         success = true;</span>
<a href="#l113.78"></a><span id="l113.78">       delete [] pBytes;</span>
<a href="#l113.79"></a><span id="l113.79">     }</span>
<a href="#l113.80"></a><span id="l113.80">     ::RegCloseKey(sKey);</span>
<a href="#l113.81"></a><span id="l113.81" class="difflineat">@@ -547,17 +545,17 @@ bool nsOEScanBoxes::Scan50MailboxDir(nsI</span>
<a href="#l113.82"></a><span id="l113.82">   bool              isFile;</span>
<a href="#l113.83"></a><span id="l113.83">   nsCOMPtr&lt;nsIFile&gt; entry;</span>
<a href="#l113.84"></a><span id="l113.84">   nsCString         fName;</span>
<a href="#l113.85"></a><span id="l113.85"> </span>
<a href="#l113.86"></a><span id="l113.86">   while (hasMore &amp;&amp; NS_SUCCEEDED(rv))</span>
<a href="#l113.87"></a><span id="l113.87">   {</span>
<a href="#l113.88"></a><span id="l113.88">     nsCOMPtr&lt;nsISupports&gt; aSupport;</span>
<a href="#l113.89"></a><span id="l113.89">     rv = directoryEnumerator-&gt;GetNext(getter_AddRefs(aSupport));</span>
<a href="#l113.90"></a><span id="l113.90" class="difflineminus">-    nsCOMPtr&lt;nsILocalFile&gt; entry(do_QueryInterface(aSupport, &amp;rv));</span>
<a href="#l113.91"></a><span id="l113.91" class="difflineplus">+    nsCOMPtr&lt;nsIFile&gt; entry(do_QueryInterface(aSupport, &amp;rv));</span>
<a href="#l113.92"></a><span id="l113.92">     directoryEnumerator-&gt;HasMoreElements(&amp;hasMore);</span>
<a href="#l113.93"></a><span id="l113.93"> </span>
<a href="#l113.94"></a><span id="l113.94">     isFile = false;</span>
<a href="#l113.95"></a><span id="l113.95">     rv = entry-&gt;IsFile(&amp;isFile);</span>
<a href="#l113.96"></a><span id="l113.96">     if (NS_SUCCEEDED(rv) &amp;&amp; isFile) {</span>
<a href="#l113.97"></a><span id="l113.97">       pLeaf = nsnull;</span>
<a href="#l113.98"></a><span id="l113.98">       rv = entry-&gt;GetNativeLeafName(fName);</span>
<a href="#l113.99"></a><span id="l113.99">       if (NS_SUCCEEDED(rv)  &amp;&amp;</span>
<a href="#l113.100"></a><span id="l113.100" class="difflineat">@@ -614,17 +612,17 @@ void nsOEScanBoxes::ScanMailboxDir(nsIFi</span>
<a href="#l113.101"></a><span id="l113.101">   nsCString         fName;</span>
<a href="#l113.102"></a><span id="l113.102">   nsCString         ext;</span>
<a href="#l113.103"></a><span id="l113.103">   nsCString         name;</span>
<a href="#l113.104"></a><span id="l113.104"> </span>
<a href="#l113.105"></a><span id="l113.105">   while (hasMore &amp;&amp; NS_SUCCEEDED(rv))</span>
<a href="#l113.106"></a><span id="l113.106">   {</span>
<a href="#l113.107"></a><span id="l113.107">     nsCOMPtr&lt;nsISupports&gt; aSupport;</span>
<a href="#l113.108"></a><span id="l113.108">     rv = directoryEnumerator-&gt;GetNext(getter_AddRefs(aSupport));</span>
<a href="#l113.109"></a><span id="l113.109" class="difflineminus">-    nsCOMPtr&lt;nsILocalFile&gt; entry(do_QueryInterface(aSupport, &amp;rv));</span>
<a href="#l113.110"></a><span id="l113.110" class="difflineplus">+    nsCOMPtr&lt;nsIFile&gt; entry(do_QueryInterface(aSupport, &amp;rv));</span>
<a href="#l113.111"></a><span id="l113.111">     directoryEnumerator-&gt;HasMoreElements(&amp;hasMore);</span>
<a href="#l113.112"></a><span id="l113.112"> </span>
<a href="#l113.113"></a><span id="l113.113">     isFile = false;</span>
<a href="#l113.114"></a><span id="l113.114">     rv = entry-&gt;IsFile(&amp;isFile);</span>
<a href="#l113.115"></a><span id="l113.115">     if (NS_SUCCEEDED(rv) &amp;&amp; isFile)</span>
<a href="#l113.116"></a><span id="l113.116">     {</span>
<a href="#l113.117"></a><span id="l113.117">       rv = entry-&gt;GetNativeLeafName(pLeaf);</span>
<a href="#l113.118"></a><span id="l113.118">       if (NS_SUCCEEDED(rv) &amp;&amp; !pLeaf.IsEmpty() &amp;&amp;</span>
<a href="#l113.119"></a><span id="l113.119" class="difflineat">@@ -715,17 +713,17 @@ void nsOEScanBoxes::BuildMailboxList(Mai</span>
<a href="#l113.120"></a><span id="l113.120"> </span>
<a href="#l113.121"></a><span id="l113.121">     if (pBox == nsnull) {</span>
<a href="#l113.122"></a><span id="l113.122">       IMPORT_LOG0(&quot;ERROR ASSIGNING STARTING MAILBOX\n&quot;);</span>
<a href="#l113.123"></a><span id="l113.123">     }</span>
<a href="#l113.124"></a><span id="l113.124"> </span>
<a href="#l113.125"></a><span id="l113.125">   }</span>
<a href="#l113.126"></a><span id="l113.126"> </span>
<a href="#l113.127"></a><span id="l113.127">   nsresult            rv;</span>
<a href="#l113.128"></a><span id="l113.128" class="difflineminus">-  nsCOMPtr &lt;nsILocalFile&gt; file;</span>
<a href="#l113.129"></a><span id="l113.129" class="difflineplus">+  nsCOMPtr &lt;nsIFile&gt; file;</span>
<a href="#l113.130"></a><span id="l113.130">   MailboxEntry *  pChild;</span>
<a href="#l113.131"></a><span id="l113.131">   nsIImportMailboxDescriptor *  pID;</span>
<a href="#l113.132"></a><span id="l113.132">   nsISupports *          pInterface;</span>
<a href="#l113.133"></a><span id="l113.133">   PRInt64            size;</span>
<a href="#l113.134"></a><span id="l113.134"> </span>
<a href="#l113.135"></a><span id="l113.135">   nsCOMPtr&lt;nsIImportService&gt; impSvc(do_GetService(NS_IMPORTSERVICE_CONTRACTID, &amp;rv));</span>
<a href="#l113.136"></a><span id="l113.136">   if (NS_FAILED(rv))</span>
<a href="#l113.137"></a><span id="l113.137">     return;</span>
<a href="#l113.138"></a><span id="l113.138" class="difflineat">@@ -733,18 +731,17 @@ void nsOEScanBoxes::BuildMailboxList(Mai</span>
<a href="#l113.139"></a><span id="l113.139">   while (pBox) {</span>
<a href="#l113.140"></a><span id="l113.140">     rv = impSvc-&gt;CreateNewMailboxDescriptor(&amp;pID);</span>
<a href="#l113.141"></a><span id="l113.141">     if (NS_SUCCEEDED(rv)) {</span>
<a href="#l113.142"></a><span id="l113.142">       pID-&gt;SetDepth(depth);</span>
<a href="#l113.143"></a><span id="l113.143">       pID-&gt;SetIdentifier(pBox-&gt;index);</span>
<a href="#l113.144"></a><span id="l113.144">       pID-&gt;SetDisplayName((PRUnichar *)pBox-&gt;mailName.get());</span>
<a href="#l113.145"></a><span id="l113.145">       if (!pBox-&gt;fileName.IsEmpty()) {</span>
<a href="#l113.146"></a><span id="l113.146">         pID-&gt;GetFile(getter_AddRefs(file));</span>
<a href="#l113.147"></a><span id="l113.147" class="difflineminus">-                                nsCOMPtr &lt;nsILocalFile&gt; localRoot = do_QueryInterface(root);</span>
<a href="#l113.148"></a><span id="l113.148" class="difflineminus">-        file-&gt;InitWithFile(localRoot);</span>
<a href="#l113.149"></a><span id="l113.149" class="difflineplus">+        file-&gt;InitWithFile(root);</span>
<a href="#l113.150"></a><span id="l113.150">         file-&gt;AppendNative(pBox-&gt;fileName);</span>
<a href="#l113.151"></a><span id="l113.151">         size = 0;</span>
<a href="#l113.152"></a><span id="l113.152">         file-&gt;GetFileSize(&amp;size);</span>
<a href="#l113.153"></a><span id="l113.153">         pID-&gt;SetSize(size);</span>
<a href="#l113.154"></a><span id="l113.154">       }</span>
<a href="#l113.155"></a><span id="l113.155">       rv = pID-&gt;QueryInterface(kISupportsIID, (void **) &amp;pInterface);</span>
<a href="#l113.156"></a><span id="l113.156">       pArray-&gt;AppendElement(pInterface);</span>
<a href="#l113.157"></a><span id="l113.157">       pInterface-&gt;Release();</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l114.1"></a><span id="l114.1" class="difflineminus">--- a/mailnews/import/outlook/src/MapiMessage.cpp</span>
<a href="#l114.2"></a><span id="l114.2" class="difflineplus">+++ b/mailnews/import/outlook/src/MapiMessage.cpp</span>
<a href="#l114.3"></a><span id="l114.3" class="difflineat">@@ -824,33 +824,33 @@ bool CMapiMessage::IterateAttachTable(LP</span>
<a href="#l114.4"></a><span id="l114.4">       CMapiApi::FreeProws(lpRow);</span>
<a href="#l114.5"></a><span id="l114.5">     }</span>
<a href="#l114.6"></a><span id="l114.6"> </span>
<a href="#l114.7"></a><span id="l114.7">   } while (SUCCEEDED(hr) &amp;&amp; cNumRows &amp;&amp; lpRow);</span>
<a href="#l114.8"></a><span id="l114.8"> </span>
<a href="#l114.9"></a><span id="l114.9">   return bResult;</span>
<a href="#l114.10"></a><span id="l114.10"> }</span>
<a href="#l114.11"></a><span id="l114.11"> </span>
<a href="#l114.12"></a><span id="l114.12" class="difflineminus">-bool CMapiMessage::GetTmpFile(/*out*/ nsILocalFile **aResult)</span>
<a href="#l114.13"></a><span id="l114.13" class="difflineplus">+bool CMapiMessage::GetTmpFile(/*out*/ nsIFile **aResult)</span>
<a href="#l114.14"></a><span id="l114.14"> {</span>
<a href="#l114.15"></a><span id="l114.15">   nsCOMPtr&lt;nsIFile&gt; tmpFile;</span>
<a href="#l114.16"></a><span id="l114.16">   nsresult rv = GetSpecialDirectoryWithFileName(NS_OS_TEMP_DIR,</span>
<a href="#l114.17"></a><span id="l114.17">     &quot;mapiattach.tmp&quot;,</span>
<a href="#l114.18"></a><span id="l114.18">     getter_AddRefs(tmpFile));</span>
<a href="#l114.19"></a><span id="l114.19">   if (NS_FAILED(rv))</span>
<a href="#l114.20"></a><span id="l114.20">     return false;</span>
<a href="#l114.21"></a><span id="l114.21"> </span>
<a href="#l114.22"></a><span id="l114.22">   rv = tmpFile-&gt;CreateUnique(nsIFile::NORMAL_FILE_TYPE, 00600);</span>
<a href="#l114.23"></a><span id="l114.23">   if (NS_FAILED(rv))</span>
<a href="#l114.24"></a><span id="l114.24">     return false;</span>
<a href="#l114.25"></a><span id="l114.25"> </span>
<a href="#l114.26"></a><span id="l114.26">   return NS_SUCCEEDED(CallQueryInterface(tmpFile, aResult));</span>
<a href="#l114.27"></a><span id="l114.27"> }</span>
<a href="#l114.28"></a><span id="l114.28"> </span>
<a href="#l114.29"></a><span id="l114.29" class="difflineminus">-bool CMapiMessage::CopyMsgAttachToFile(LPATTACH lpAttach, /*out*/ nsILocalFile **tmp_file)</span>
<a href="#l114.30"></a><span id="l114.30" class="difflineplus">+bool CMapiMessage::CopyMsgAttachToFile(LPATTACH lpAttach, /*out*/ nsIFile **tmp_file)</span>
<a href="#l114.31"></a><span id="l114.31"> {</span>
<a href="#l114.32"></a><span id="l114.32">   bool bResult = true;</span>
<a href="#l114.33"></a><span id="l114.33">   LPMESSAGE  lpMsg;</span>
<a href="#l114.34"></a><span id="l114.34">   HRESULT hr = lpAttach-&gt;OpenProperty(PR_ATTACH_DATA_OBJ, &amp;IID_IMessage, 0, 0,</span>
<a href="#l114.35"></a><span id="l114.35">                                       reinterpret_cast&lt;LPUNKNOWN *&gt;(&amp;lpMsg));</span>
<a href="#l114.36"></a><span id="l114.36">   NS_ENSURE_SUCCESS(hr, false);</span>
<a href="#l114.37"></a><span id="l114.37"> </span>
<a href="#l114.38"></a><span id="l114.38">   if (!GetTmpFile(tmp_file))</span>
<a href="#l114.39"></a><span id="l114.39" class="difflineat">@@ -866,17 +866,17 @@ bool CMapiMessage::CopyMsgAttachToFile(L</span>
<a href="#l114.40"></a><span id="l114.40">     (*tmp_file)-&gt;Release();</span>
<a href="#l114.41"></a><span id="l114.41">     *tmp_file = 0;</span>
<a href="#l114.42"></a><span id="l114.42">   }</span>
<a href="#l114.43"></a><span id="l114.43"> </span>
<a href="#l114.44"></a><span id="l114.44">   return NS_SUCCEEDED(rv);</span>
<a href="#l114.45"></a><span id="l114.45"> }</span>
<a href="#l114.46"></a><span id="l114.46"> </span>
<a href="#l114.47"></a><span id="l114.47"> bool CMapiMessage::CopyBinAttachToFile(LPATTACH lpAttach,</span>
<a href="#l114.48"></a><span id="l114.48" class="difflineminus">-                                       nsILocalFile **tmp_file)</span>
<a href="#l114.49"></a><span id="l114.49" class="difflineplus">+                                       nsIFile **tmp_file)</span>
<a href="#l114.50"></a><span id="l114.50"> {</span>
<a href="#l114.51"></a><span id="l114.51">   nsCOMPtr&lt;nsIFile&gt; _tmp_file;</span>
<a href="#l114.52"></a><span id="l114.52">   nsresult rv = GetSpecialDirectoryWithFileName(NS_OS_TEMP_DIR,</span>
<a href="#l114.53"></a><span id="l114.53">     &quot;mapiattach.tmp&quot;,</span>
<a href="#l114.54"></a><span id="l114.54">     getter_AddRefs(_tmp_file));</span>
<a href="#l114.55"></a><span id="l114.55">   NS_ENSURE_SUCCESS(rv, false);</span>
<a href="#l114.56"></a><span id="l114.56"> </span>
<a href="#l114.57"></a><span id="l114.57">   rv = _tmp_file-&gt;CreateUnique(nsIFile::NORMAL_FILE_TYPE, 00600);</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l115.1"></a><span id="l115.1" class="difflineminus">--- a/mailnews/import/outlook/src/MapiMessage.h</span>
<a href="#l115.2"></a><span id="l115.2" class="difflineplus">+++ b/mailnews/import/outlook/src/MapiMessage.h</span>
<a href="#l115.3"></a><span id="l115.3" class="difflineat">@@ -2,17 +2,17 @@</span>
<a href="#l115.4"></a><span id="l115.4"> /* This Source Code Form is subject to the terms of the Mozilla Public</span>
<a href="#l115.5"></a><span id="l115.5">  * License, v. 2.0. If a copy of the MPL was not distributed with this</span>
<a href="#l115.6"></a><span id="l115.6">  * file, You can obtain one at http://mozilla.org/MPL/2.0/. */</span>
<a href="#l115.7"></a><span id="l115.7"> #ifndef MapiMessage_h___</span>
<a href="#l115.8"></a><span id="l115.8"> #define MapiMessage_h___</span>
<a href="#l115.9"></a><span id="l115.9"> </span>
<a href="#l115.10"></a><span id="l115.10"> #include &quot;nsTArray.h&quot;</span>
<a href="#l115.11"></a><span id="l115.11"> #include &quot;nsStringGlue.h&quot;</span>
<a href="#l115.12"></a><span id="l115.12" class="difflineminus">-#include &quot;nsILocalFile.h&quot;</span>
<a href="#l115.13"></a><span id="l115.13" class="difflineplus">+#include &quot;nsIFile.h&quot;</span>
<a href="#l115.14"></a><span id="l115.14"> #include &quot;MapiApi.h&quot;</span>
<a href="#l115.15"></a><span id="l115.15"> #include &quot;nsIMsgSend.h&quot;</span>
<a href="#l115.16"></a><span id="l115.16"> </span>
<a href="#l115.17"></a><span id="l115.17"> #include &lt;vector&gt;</span>
<a href="#l115.18"></a><span id="l115.18"> </span>
<a href="#l115.19"></a><span id="l115.19"> #ifndef PR_LAST_VERB_EXECUTED</span>
<a href="#l115.20"></a><span id="l115.20"> #define PR_LAST_VERB_EXECUTED PROP_TAG(PT_LONG, 0x1081)</span>
<a href="#l115.21"></a><span id="l115.21"> #endif</span>
<a href="#l115.22"></a><span id="l115.22" class="difflineat">@@ -195,17 +195,17 @@ public:</span>
<a href="#l115.23"></a><span id="l115.23"> </span>
<a href="#l115.24"></a><span id="l115.24">    // The only required part of a message is its header</span>
<a href="#l115.25"></a><span id="l115.25">   inline bool ValidState() const { return !m_headers.IsEmpty(); }</span>
<a href="#l115.26"></a><span id="l115.26">   inline bool FullMessageDownloaded() const { return !m_dldStateHeadersOnly; }</span>
<a href="#l115.27"></a><span id="l115.27"> </span>
<a href="#l115.28"></a><span id="l115.28"> private:</span>
<a href="#l115.29"></a><span id="l115.29">   struct attach_data {</span>
<a href="#l115.30"></a><span id="l115.30">     nsCOMPtr&lt;nsIURI&gt; orig_url;</span>
<a href="#l115.31"></a><span id="l115.31" class="difflineminus">-    nsCOMPtr&lt;nsILocalFile&gt; tmp_file;</span>
<a href="#l115.32"></a><span id="l115.32" class="difflineplus">+    nsCOMPtr&lt;nsIFile&gt; tmp_file;</span>
<a href="#l115.33"></a><span id="l115.33">     char *type;</span>
<a href="#l115.34"></a><span id="l115.34">     char *encoding;</span>
<a href="#l115.35"></a><span id="l115.35">     char *real_name;</span>
<a href="#l115.36"></a><span id="l115.36">     char *cid;</span>
<a href="#l115.37"></a><span id="l115.37">     bool delete_file;</span>
<a href="#l115.38"></a><span id="l115.38">     attach_data() : type(0), encoding(0), real_name(0), cid(0), delete_file(false) {}</span>
<a href="#l115.39"></a><span id="l115.39">   };</span>
<a href="#l115.40"></a><span id="l115.40"> </span>
<a href="#l115.41"></a><span id="l115.41" class="difflineat">@@ -238,19 +238,19 @@ private:</span>
<a href="#l115.42"></a><span id="l115.42">   //  PR_DISPLAY_TO, _CC, _BCC</span>
<a href="#l115.43"></a><span id="l115.43">   //  PR_SUBJECT</span>
<a href="#l115.44"></a><span id="l115.44">   //  PR_MESSAGE_RECIPIENTS</span>
<a href="#l115.45"></a><span id="l115.45">   // and PR_CREATION_TIME if needed?</span>
<a href="#l115.46"></a><span id="l115.46">   bool    FetchHeaders(void);</span>
<a href="#l115.47"></a><span id="l115.47">   bool    FetchBody(void);</span>
<a href="#l115.48"></a><span id="l115.48">   void    FetchFlags(void);</span>
<a href="#l115.49"></a><span id="l115.49"> </span>
<a href="#l115.50"></a><span id="l115.50" class="difflineminus">-  static bool GetTmpFile(/*out*/ nsILocalFile **aResult);</span>
<a href="#l115.51"></a><span id="l115.51" class="difflineminus">-  static bool CopyMsgAttachToFile(LPATTACH lpAttach, /*out*/ nsILocalFile **tmp_file);</span>
<a href="#l115.52"></a><span id="l115.52" class="difflineminus">-  static bool CopyBinAttachToFile(LPATTACH lpAttach, nsILocalFile **tmp_file);</span>
<a href="#l115.53"></a><span id="l115.53" class="difflineplus">+  static bool GetTmpFile(/*out*/ nsIFile **aResult);</span>
<a href="#l115.54"></a><span id="l115.54" class="difflineplus">+  static bool CopyMsgAttachToFile(LPATTACH lpAttach, /*out*/ nsIFile **tmp_file);</span>
<a href="#l115.55"></a><span id="l115.55" class="difflineplus">+  static bool CopyBinAttachToFile(LPATTACH lpAttach, nsIFile **tmp_file);</span>
<a href="#l115.56"></a><span id="l115.56"> </span>
<a href="#l115.57"></a><span id="l115.57">   static void ClearAttachment(attach_data* data);</span>
<a href="#l115.58"></a><span id="l115.58">   void    ClearAttachments();</span>
<a href="#l115.59"></a><span id="l115.59">   bool    AddAttachment(DWORD aNum);</span>
<a href="#l115.60"></a><span id="l115.60">   bool    IterateAttachTable(LPMAPITABLE tbl);</span>
<a href="#l115.61"></a><span id="l115.61">   bool    GetURL(nsIFile *aFile, nsIURI **url);</span>
<a href="#l115.62"></a><span id="l115.62">   void    ProcessAttachments();</span>
<a href="#l115.63"></a><span id="l115.63"> </span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l116.1"></a><span id="l116.1" class="difflineminus">--- a/mailnews/import/outlook/src/nsOutlookImport.cpp</span>
<a href="#l116.2"></a><span id="l116.2" class="difflineplus">+++ b/mailnews/import/outlook/src/nsOutlookImport.cpp</span>
<a href="#l116.3"></a><span id="l116.3" class="difflineat">@@ -321,17 +321,17 @@ NS_IMETHODIMP ImportOutlookMailImpl::Get</span>
<a href="#l116.4"></a><span id="l116.4">   if (!mapi.IterateStores(store))</span>
<a href="#l116.5"></a><span id="l116.5">     return NS_OK;</span>
<a href="#l116.6"></a><span id="l116.6"> </span>
<a href="#l116.7"></a><span id="l116.7">   if (store.GetSize() == 0)</span>
<a href="#l116.8"></a><span id="l116.8">     return NS_OK;</span>
<a href="#l116.9"></a><span id="l116.9"> </span>
<a href="#l116.10"></a><span id="l116.10"> </span>
<a href="#l116.11"></a><span id="l116.11">   nsresult  rv;</span>
<a href="#l116.12"></a><span id="l116.12" class="difflineminus">-  nsCOMPtr &lt;nsILocalFile&gt; resultFile = do_CreateInstance(NS_LOCAL_FILE_CONTRACTID, &amp;rv);</span>
<a href="#l116.13"></a><span id="l116.13" class="difflineplus">+  nsCOMPtr &lt;nsIFile&gt; resultFile = do_CreateInstance(NS_LOCAL_FILE_CONTRACTID, &amp;rv);</span>
<a href="#l116.14"></a><span id="l116.14">   if (NS_FAILED(rv))</span>
<a href="#l116.15"></a><span id="l116.15">     return rv;</span>
<a href="#l116.16"></a><span id="l116.16"> </span>
<a href="#l116.17"></a><span id="l116.17">   *found = true;</span>
<a href="#l116.18"></a><span id="l116.18">   NS_IF_ADDREF(*ppLoc = resultFile);</span>
<a href="#l116.19"></a><span id="l116.19">   *userVerify = false;</span>
<a href="#l116.20"></a><span id="l116.20"> </span>
<a href="#l116.21"></a><span id="l116.21">   return NS_OK;</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l117.1"></a><span id="l117.1" class="difflineminus">--- a/mailnews/import/public/nsIImportMailboxDescriptor.idl</span>
<a href="#l117.2"></a><span id="l117.2" class="difflineplus">+++ b/mailnews/import/public/nsIImportMailboxDescriptor.idl</span>
<a href="#l117.3"></a><span id="l117.3" class="difflineat">@@ -8,30 +8,30 @@</span>
<a href="#l117.4"></a><span id="l117.4">   Interface for importing mail - ui provided by the import module.  If</span>
<a href="#l117.5"></a><span id="l117.5">   you wish to provide your own UI then implement the nsIImportGeneric</span>
<a href="#l117.6"></a><span id="l117.6">   interface.</span>
<a href="#l117.7"></a><span id="l117.7"> </span>
<a href="#l117.8"></a><span id="l117.8">  */</span>
<a href="#l117.9"></a><span id="l117.9"> </span>
<a href="#l117.10"></a><span id="l117.10"> #include &quot;nsISupports.idl&quot;</span>
<a href="#l117.11"></a><span id="l117.11"> </span>
<a href="#l117.12"></a><span id="l117.12" class="difflineminus">-interface nsILocalFile;</span>
<a href="#l117.13"></a><span id="l117.13" class="difflineplus">+interface nsIFile;</span>
<a href="#l117.14"></a><span id="l117.14"> </span>
<a href="#l117.15"></a><span id="l117.15"> [scriptable, uuid(69eba744-9c4f-4f79-a964-2134746b3656)]</span>
<a href="#l117.16"></a><span id="l117.16"> interface nsIImportMailboxDescriptor : nsISupports</span>
<a href="#l117.17"></a><span id="l117.17"> {</span>
<a href="#l117.18"></a><span id="l117.18">   attribute unsigned long identifier;</span>
<a href="#l117.19"></a><span id="l117.19">   attribute unsigned long  depth;</span>
<a href="#l117.20"></a><span id="l117.20">   attribute unsigned long  size;</span>
<a href="#l117.21"></a><span id="l117.21"> </span>
<a href="#l117.22"></a><span id="l117.22">   wstring  GetDisplayName();</span>
<a href="#l117.23"></a><span id="l117.23">   void  SetDisplayName( [const] in wstring name);</span>
<a href="#l117.24"></a><span id="l117.24"> </span>
<a href="#l117.25"></a><span id="l117.25">   attribute boolean import;</span>
<a href="#l117.26"></a><span id="l117.26" class="difflineminus">-  readonly attribute nsILocalFile file;</span>
<a href="#l117.27"></a><span id="l117.27" class="difflineplus">+  readonly attribute nsIFile file;</span>
<a href="#l117.28"></a><span id="l117.28"> };</span>
<a href="#l117.29"></a><span id="l117.29"> </span>
<a href="#l117.30"></a><span id="l117.30"> </span>
<a href="#l117.31"></a><span id="l117.31"> </span>
<a href="#l117.32"></a><span id="l117.32"> %{ C++</span>
<a href="#l117.33"></a><span id="l117.33"> </span>
<a href="#l117.34"></a><span id="l117.34"> /*</span>
<a href="#l117.35"></a><span id="l117.35">   The default implementation can be obtained from</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l118.1"></a><span id="l118.1" class="difflineminus">--- a/mailnews/import/src/nsImportAddressBooks.cpp</span>
<a href="#l118.2"></a><span id="l118.2" class="difflineplus">+++ b/mailnews/import/src/nsImportAddressBooks.cpp</span>
<a href="#l118.3"></a><span id="l118.3" class="difflineat">@@ -9,17 +9,17 @@</span>
<a href="#l118.4"></a><span id="l118.4"> #include &quot;nsMsgUtils.h&quot;</span>
<a href="#l118.5"></a><span id="l118.5"> #include &quot;nsIImportService.h&quot;</span>
<a href="#l118.6"></a><span id="l118.6"> #include &quot;nsIImportAddressBooks.h&quot;</span>
<a href="#l118.7"></a><span id="l118.7"> #include &quot;nsIImportGeneric.h&quot;</span>
<a href="#l118.8"></a><span id="l118.8"> #include &quot;nsISupportsPrimitives.h&quot;</span>
<a href="#l118.9"></a><span id="l118.9"> #include &quot;nsIImportABDescriptor.h&quot;</span>
<a href="#l118.10"></a><span id="l118.10"> #include &quot;nsIImportFieldMap.h&quot;</span>
<a href="#l118.11"></a><span id="l118.11"> #include &quot;nsStringGlue.h&quot;</span>
<a href="#l118.12"></a><span id="l118.12" class="difflineminus">-#include &quot;nsILocalFile.h&quot;</span>
<a href="#l118.13"></a><span id="l118.13" class="difflineplus">+#include &quot;nsIFile.h&quot;</span>
<a href="#l118.14"></a><span id="l118.14"> #include &quot;nsIAddrDatabase.h&quot;</span>
<a href="#l118.15"></a><span id="l118.15"> #include &quot;nsIAbManager.h&quot;</span>
<a href="#l118.16"></a><span id="l118.16"> #include &quot;nsIAbLDIFService.h&quot;</span>
<a href="#l118.17"></a><span id="l118.17"> #include &quot;nsAbBaseCID.h&quot;</span>
<a href="#l118.18"></a><span id="l118.18"> #include &quot;nsIStringBundle.h&quot;</span>
<a href="#l118.19"></a><span id="l118.19"> #include &quot;nsImportStringBundle.h&quot;</span>
<a href="#l118.20"></a><span id="l118.20"> #include &quot;nsTextFormatter.h&quot;</span>
<a href="#l118.21"></a><span id="l118.21"> #include &quot;nsServiceManagerUtils.h&quot;</span>
<a href="#l118.22"></a><span id="l118.22" class="difflineat">@@ -518,17 +518,17 @@ already_AddRefed&lt;nsIAddrDatabase&gt; GetAdd</span>
<a href="#l118.23"></a><span id="l118.23">     // specific name.  Major bogosity!</span>
<a href="#l118.24"></a><span id="l118.24">     // For now, assume we didn't find anything with that name</span>
<a href="#l118.25"></a><span id="l118.25">   }</span>
<a href="#l118.26"></a><span id="l118.26"> </span>
<a href="#l118.27"></a><span id="l118.27">   IMPORT_LOG0(&quot;In GetAddressBook\n&quot;);</span>
<a href="#l118.28"></a><span id="l118.28"> </span>
<a href="#l118.29"></a><span id="l118.29">   nsresult rv;</span>
<a href="#l118.30"></a><span id="l118.30">   nsIAddrDatabase *pDatabase = nsnull;</span>
<a href="#l118.31"></a><span id="l118.31" class="difflineminus">-  nsCOMPtr&lt;nsILocalFile&gt; dbPath;</span>
<a href="#l118.32"></a><span id="l118.32" class="difflineplus">+  nsCOMPtr&lt;nsIFile&gt; dbPath;</span>
<a href="#l118.33"></a><span id="l118.33">   nsCOMPtr&lt;nsIAbManager&gt; abManager = do_GetService(NS_ABMANAGER_CONTRACTID, &amp;rv);</span>
<a href="#l118.34"></a><span id="l118.34">   if (NS_SUCCEEDED(rv))</span>
<a href="#l118.35"></a><span id="l118.35">   {</span>
<a href="#l118.36"></a><span id="l118.36">     /* Get the profile directory */</span>
<a href="#l118.37"></a><span id="l118.37">     rv = abManager-&gt;GetUserProfileDirectory(getter_AddRefs(dbPath));</span>
<a href="#l118.38"></a><span id="l118.38">     if (NS_SUCCEEDED(rv))</span>
<a href="#l118.39"></a><span id="l118.39">     {</span>
<a href="#l118.40"></a><span id="l118.40">       // Create a new address book file - we don't care what the file</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l119.1"></a><span id="l119.1" class="difflineminus">--- a/mailnews/import/src/nsImportEncodeScan.h</span>
<a href="#l119.2"></a><span id="l119.2" class="difflineplus">+++ b/mailnews/import/src/nsImportEncodeScan.h</span>
<a href="#l119.3"></a><span id="l119.3" class="difflineat">@@ -21,17 +21,17 @@ public:</span>
<a href="#l119.4"></a><span id="l119.4">   virtual bool    Scan(bool *pDone);</span>
<a href="#l119.5"></a><span id="l119.5"> </span>
<a href="#l119.6"></a><span id="l119.6"> protected:</span>
<a href="#l119.7"></a><span id="l119.7">   void   FillInEntries(int numEntries);</span>
<a href="#l119.8"></a><span id="l119.8">   bool     AddEntries(void);</span>
<a href="#l119.9"></a><span id="l119.9"> </span>
<a href="#l119.10"></a><span id="l119.10"> protected:</span>
<a href="#l119.11"></a><span id="l119.11">   bool        m_isAppleSingle;</span>
<a href="#l119.12"></a><span id="l119.12" class="difflineminus">-  nsCOMPtr&lt;nsILocalFile&gt;   m_pInputFile;</span>
<a href="#l119.13"></a><span id="l119.13" class="difflineplus">+  nsCOMPtr&lt;nsIFile&gt;   m_pInputFile;</span>
<a href="#l119.14"></a><span id="l119.14">         nsCOMPtr&lt;nsIInputStream&gt; m_inputStream;</span>
<a href="#l119.15"></a><span id="l119.15">   int      m_encodeScanState;</span>
<a href="#l119.16"></a><span id="l119.16">   long      m_resourceForkSize;</span>
<a href="#l119.17"></a><span id="l119.17">   long      m_dataForkSize;</span>
<a href="#l119.18"></a><span id="l119.18">   nsCString    m_useFileName;</span>
<a href="#l119.19"></a><span id="l119.19"> };</span>
<a href="#l119.20"></a><span id="l119.20"> </span>
<a href="#l119.21"></a><span id="l119.21"> #endif /* nsImportEncodeScan_h__ */</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l120.1"></a><span id="l120.1" class="difflineminus">--- a/mailnews/import/src/nsImportMail.cpp</span>
<a href="#l120.2"></a><span id="l120.2" class="difflineplus">+++ b/mailnews/import/src/nsImportMail.cpp</span>
<a href="#l120.3"></a><span id="l120.3" class="difflineat">@@ -285,17 +285,17 @@ NS_IMETHODIMP nsImportGenericMail::SetDa</span>
<a href="#l120.4"></a><span id="l120.4">       item-&gt;QueryInterface(NS_GET_IID(nsISupportsArray), (void **) &amp;m_pMailboxes);</span>
<a href="#l120.5"></a><span id="l120.5">   }</span>
<a href="#l120.6"></a><span id="l120.6"> </span>
<a href="#l120.7"></a><span id="l120.7">   if (!PL_strcasecmp(dataId, &quot;mailLocation&quot;)) {</span>
<a href="#l120.8"></a><span id="l120.8">     NS_IF_RELEASE(m_pMailboxes);</span>
<a href="#l120.9"></a><span id="l120.9">     m_pSrcLocation = nsnull;</span>
<a href="#l120.10"></a><span id="l120.10">     if (item) {</span>
<a href="#l120.11"></a><span id="l120.11">       nsresult rv;</span>
<a href="#l120.12"></a><span id="l120.12" class="difflineminus">-      nsCOMPtr &lt;nsILocalFile&gt; location = do_QueryInterface(item, &amp;rv);</span>
<a href="#l120.13"></a><span id="l120.13" class="difflineplus">+      nsCOMPtr &lt;nsIFile&gt; location = do_QueryInterface(item, &amp;rv);</span>
<a href="#l120.14"></a><span id="l120.14">       NS_ENSURE_SUCCESS(rv,rv);</span>
<a href="#l120.15"></a><span id="l120.15">       m_pSrcLocation = location;</span>
<a href="#l120.16"></a><span id="l120.16">     }</span>
<a href="#l120.17"></a><span id="l120.17">   }</span>
<a href="#l120.18"></a><span id="l120.18"> </span>
<a href="#l120.19"></a><span id="l120.19">   if (!PL_strcasecmp(dataId, &quot;mailDestination&quot;)) {</span>
<a href="#l120.20"></a><span id="l120.20">     NS_IF_RELEASE(m_pDestFolder);</span>
<a href="#l120.21"></a><span id="l120.21">     if (item)</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l121.1"></a><span id="l121.1" class="difflineminus">--- a/mailnews/import/src/nsImportMailboxDescriptor.h</span>
<a href="#l121.2"></a><span id="l121.2" class="difflineplus">+++ b/mailnews/import/src/nsImportMailboxDescriptor.h</span>
<a href="#l121.3"></a><span id="l121.3" class="difflineat">@@ -4,17 +4,17 @@</span>
<a href="#l121.4"></a><span id="l121.4">  * file, You can obtain one at http://mozilla.org/MPL/2.0/. */</span>
<a href="#l121.5"></a><span id="l121.5"> </span>
<a href="#l121.6"></a><span id="l121.6"> #ifndef nsImportMailboxDescriptor_h___</span>
<a href="#l121.7"></a><span id="l121.7"> #define nsImportMailboxDescriptor_h___</span>
<a href="#l121.8"></a><span id="l121.8"> </span>
<a href="#l121.9"></a><span id="l121.9"> #include &quot;nscore.h&quot;</span>
<a href="#l121.10"></a><span id="l121.10"> #include &quot;nsStringGlue.h&quot;</span>
<a href="#l121.11"></a><span id="l121.11"> #include &quot;nsIImportMailboxDescriptor.h&quot;</span>
<a href="#l121.12"></a><span id="l121.12" class="difflineminus">-#include &quot;nsILocalFile.h&quot;</span>
<a href="#l121.13"></a><span id="l121.13" class="difflineplus">+#include &quot;nsIFile.h&quot;</span>
<a href="#l121.14"></a><span id="l121.14"> #include &quot;nsCOMPtr.h&quot;</span>
<a href="#l121.15"></a><span id="l121.15"> </span>
<a href="#l121.16"></a><span id="l121.16"> ////////////////////////////////////////////////////////////////////////</span>
<a href="#l121.17"></a><span id="l121.17"> </span>
<a href="#l121.18"></a><span id="l121.18"> </span>
<a href="#l121.19"></a><span id="l121.19"> class nsImportMailboxDescriptor : public nsIImportMailboxDescriptor</span>
<a href="#l121.20"></a><span id="l121.20"> {</span>
<a href="#l121.21"></a><span id="l121.21"> public:</span>
<a href="#l121.22"></a><span id="l121.22" class="difflineat">@@ -34,29 +34,29 @@ public:</span>
<a href="#l121.23"></a><span id="l121.23">   /* attribute wstring displayName; */</span>
<a href="#l121.24"></a><span id="l121.24">   NS_IMETHOD  GetDisplayName(PRUnichar **pName) { *pName = ToNewUnicode(m_displayName); return NS_OK;}</span>
<a href="#l121.25"></a><span id="l121.25">   NS_IMETHOD  SetDisplayName(const PRUnichar * pName) { m_displayName = pName; return NS_OK;}</span>
<a href="#l121.26"></a><span id="l121.26"> </span>
<a href="#l121.27"></a><span id="l121.27">   /* attribute boolean import; */</span>
<a href="#l121.28"></a><span id="l121.28">   NS_IMETHOD  GetImport(bool *pImport) { *pImport = m_import; return NS_OK;}</span>
<a href="#l121.29"></a><span id="l121.29">   NS_IMETHOD  SetImport(bool doImport) { m_import = doImport; return NS_OK;}</span>
<a href="#l121.30"></a><span id="l121.30"> </span>
<a href="#l121.31"></a><span id="l121.31" class="difflineminus">-  /* readonly attribute nsILocalFile file; */</span>
<a href="#l121.32"></a><span id="l121.32" class="difflineminus">-  NS_IMETHOD GetFile(nsILocalFile * *aFile) { if (m_pFile) { NS_ADDREF(*aFile = m_pFile); return NS_OK;} else return NS_ERROR_FAILURE; }</span>
<a href="#l121.33"></a><span id="l121.33" class="difflineplus">+  /* readonly attribute nsIFile file; */</span>
<a href="#l121.34"></a><span id="l121.34" class="difflineplus">+  NS_IMETHOD GetFile(nsIFile * *aFile) { if (m_pFile) { NS_ADDREF(*aFile = m_pFile); return NS_OK;} else return NS_ERROR_FAILURE; }</span>
<a href="#l121.35"></a><span id="l121.35"> </span>
<a href="#l121.36"></a><span id="l121.36"> </span>
<a href="#l121.37"></a><span id="l121.37"> </span>
<a href="#l121.38"></a><span id="l121.38">   nsImportMailboxDescriptor();</span>
<a href="#l121.39"></a><span id="l121.39">   virtual ~nsImportMailboxDescriptor() {}</span>
<a href="#l121.40"></a><span id="l121.40"> </span>
<a href="#l121.41"></a><span id="l121.41">    static NS_METHOD Create(nsISupports *aOuter, REFNSIID aIID, void **aResult);</span>
<a href="#l121.42"></a><span id="l121.42"> </span>
<a href="#l121.43"></a><span id="l121.43"> private:</span>
<a href="#l121.44"></a><span id="l121.44">   PRUint32    m_id;      // used by creator of the structure</span>
<a href="#l121.45"></a><span id="l121.45">   PRUint32    m_depth;    // depth in the hierarchy</span>
<a href="#l121.46"></a><span id="l121.46">   nsString    m_displayName;// name of this mailbox</span>
<a href="#l121.47"></a><span id="l121.47" class="difflineminus">-  nsCOMPtr &lt;nsILocalFile&gt; m_pFile;  // source file (if applicable)</span>
<a href="#l121.48"></a><span id="l121.48" class="difflineplus">+  nsCOMPtr &lt;nsIFile&gt; m_pFile;  // source file (if applicable)</span>
<a href="#l121.49"></a><span id="l121.49">   PRUint32    m_size;</span>
<a href="#l121.50"></a><span id="l121.50">   bool        m_import;    // import it or not?</span>
<a href="#l121.51"></a><span id="l121.51"> };</span>
<a href="#l121.52"></a><span id="l121.52"> </span>
<a href="#l121.53"></a><span id="l121.53"> </span>
<a href="#l121.54"></a><span id="l121.54"> #endif</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l122.1"></a><span id="l122.1" class="difflineminus">--- a/mailnews/import/src/nsImportScanFile.cpp</span>
<a href="#l122.2"></a><span id="l122.2" class="difflineplus">+++ b/mailnews/import/src/nsImportScanFile.cpp</span>
<a href="#l122.3"></a><span id="l122.3" class="difflineat">@@ -1,15 +1,15 @@</span>
<a href="#l122.4"></a><span id="l122.4"> /* -*- Mode: C++; tab-width: 4; indent-tabs-mode: nil; c-basic-offset: 4 -*- */</span>
<a href="#l122.5"></a><span id="l122.5"> /* This Source Code Form is subject to the terms of the Mozilla Public</span>
<a href="#l122.6"></a><span id="l122.6">  * License, v. 2.0. If a copy of the MPL was not distributed with this</span>
<a href="#l122.7"></a><span id="l122.7">  * file, You can obtain one at http://mozilla.org/MPL/2.0/. */</span>
<a href="#l122.8"></a><span id="l122.8"> </span>
<a href="#l122.9"></a><span id="l122.9"> #include &quot;nscore.h&quot;</span>
<a href="#l122.10"></a><span id="l122.10" class="difflineminus">-#include &quot;nsILocalFile.h&quot;</span>
<a href="#l122.11"></a><span id="l122.11" class="difflineplus">+#include &quot;nsIFile.h&quot;</span>
<a href="#l122.12"></a><span id="l122.12"> #include &quot;nsImportScanFile.h&quot;</span>
<a href="#l122.13"></a><span id="l122.13"> #include &quot;ImportCharSet.h&quot;</span>
<a href="#l122.14"></a><span id="l122.14"> </span>
<a href="#l122.15"></a><span id="l122.15"> nsImportScanFile::nsImportScanFile()</span>
<a href="#l122.16"></a><span id="l122.16"> {</span>
<a href="#l122.17"></a><span id="l122.17">   m_allocated = false;</span>
<a href="#l122.18"></a><span id="l122.18">   m_eof = false;</span>
<a href="#l122.19"></a><span id="l122.19">   m_pBuf = nsnull;</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l123.1"></a><span id="l123.1" class="difflineminus">--- a/mailnews/import/text/src/nsTextImport.cpp</span>
<a href="#l123.2"></a><span id="l123.2" class="difflineplus">+++ b/mailnews/import/text/src/nsTextImport.cpp</span>
<a href="#l123.3"></a><span id="l123.3" class="difflineat">@@ -101,17 +101,17 @@ private:</span>
<a href="#l123.4"></a><span id="l123.4">                       PRUnichar **pSuccess);</span>
<a href="#l123.5"></a><span id="l123.5">   static void ReportError(PRInt32 errorNum, nsString&amp; name, nsString *pStream,</span>
<a href="#l123.6"></a><span id="l123.6">                           nsIStringBundle* pBundle);</span>
<a href="#l123.7"></a><span id="l123.7">   static void SanitizeSampleData(nsCString&amp; val);</span>
<a href="#l123.8"></a><span id="l123.8"> </span>
<a href="#l123.9"></a><span id="l123.9"> private:</span>
<a href="#l123.10"></a><span id="l123.10">   nsTextAddress m_text;</span>
<a href="#l123.11"></a><span id="l123.11">   bool m_haveDelim;</span>
<a href="#l123.12"></a><span id="l123.12" class="difflineminus">-  nsCOMPtr&lt;nsILocalFile&gt; m_fileLoc;</span>
<a href="#l123.13"></a><span id="l123.13" class="difflineplus">+  nsCOMPtr&lt;nsIFile&gt; m_fileLoc;</span>
<a href="#l123.14"></a><span id="l123.14">   nsCOMPtr&lt;nsIStringBundle&gt; m_notProxyBundle;</span>
<a href="#l123.15"></a><span id="l123.15">   char m_delim;</span>
<a href="#l123.16"></a><span id="l123.16">   PRUint32 m_bytesImported;</span>
<a href="#l123.17"></a><span id="l123.17"> };</span>
<a href="#l123.18"></a><span id="l123.18"> </span>
<a href="#l123.19"></a><span id="l123.19"> ////////////////////////////////////////////////////////////////////////</span>
<a href="#l123.20"></a><span id="l123.20"> ////////////////////////////////////////////////////////////////////////</span>
<a href="#l123.21"></a><span id="l123.21"> </span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l124.1"></a><span id="l124.1" class="difflineminus">--- a/mailnews/import/vcard/src/nsVCardImport.cpp</span>
<a href="#l124.2"></a><span id="l124.2" class="difflineplus">+++ b/mailnews/import/vcard/src/nsVCardImport.cpp</span>
<a href="#l124.3"></a><span id="l124.3" class="difflineat">@@ -14,17 +14,17 @@</span>
<a href="#l124.4"></a><span id="l124.4"> #include &quot;nsIAddrDatabase.h&quot;</span>
<a href="#l124.5"></a><span id="l124.5"> #include &quot;nsIFile.h&quot;</span>
<a href="#l124.6"></a><span id="l124.6"> #include &quot;nsIImportABDescriptor.h&quot;</span>
<a href="#l124.7"></a><span id="l124.7"> #include &quot;nsIImportAddressBooks.h&quot;</span>
<a href="#l124.8"></a><span id="l124.8"> #include &quot;nsIImportFieldMap.h&quot;</span>
<a href="#l124.9"></a><span id="l124.9"> #include &quot;nsIImportGeneric.h&quot;</span>
<a href="#l124.10"></a><span id="l124.10"> #include &quot;nsCOMPtr.h&quot;</span>
<a href="#l124.11"></a><span id="l124.11"> #include &quot;nsIImportService.h&quot;</span>
<a href="#l124.12"></a><span id="l124.12" class="difflineminus">-#include &quot;nsILocalFile.h&quot;</span>
<a href="#l124.13"></a><span id="l124.13" class="difflineplus">+#include &quot;nsIFile.h&quot;</span>
<a href="#l124.14"></a><span id="l124.14"> #include &quot;nsImportStringBundle.h&quot;</span>
<a href="#l124.15"></a><span id="l124.15"> #include &quot;nsMsgUtils.h&quot;</span>
<a href="#l124.16"></a><span id="l124.16"> #include &quot;nsComponentManagerUtils.h&quot;</span>
<a href="#l124.17"></a><span id="l124.17"> #include &quot;nsServiceManagerUtils.h&quot;</span>
<a href="#l124.18"></a><span id="l124.18"> #include &quot;nsTextFormatter.h&quot;</span>
<a href="#l124.19"></a><span id="l124.19"> #include &quot;nsVCardAddress.h&quot;</span>
<a href="#l124.20"></a><span id="l124.20"> #include &quot;nsVCardImport.h&quot;</span>
<a href="#l124.21"></a><span id="l124.21"> </span>
<a href="#l124.22"></a><span id="l124.22" class="difflineat">@@ -86,17 +86,17 @@ private:</span>
<a href="#l124.23"></a><span id="l124.23">       nsString&amp; success, nsString&amp; error,</span>
<a href="#l124.24"></a><span id="l124.24">       PRUnichar **pError, PRUnichar **pSuccess);</span>
<a href="#l124.25"></a><span id="l124.25">   static void ReportError(</span>
<a href="#l124.26"></a><span id="l124.26">       const char *errorName, nsString&amp; name, nsString *pStream,</span>
<a href="#l124.27"></a><span id="l124.27">       nsIStringBundle* pBundle);</span>
<a href="#l124.28"></a><span id="l124.28"> </span>
<a href="#l124.29"></a><span id="l124.29"> private:</span>
<a href="#l124.30"></a><span id="l124.30">   nsVCardAddress m_vCard;</span>
<a href="#l124.31"></a><span id="l124.31" class="difflineminus">-  nsCOMPtr&lt;nsILocalFile&gt; m_fileLoc;</span>
<a href="#l124.32"></a><span id="l124.32" class="difflineplus">+  nsCOMPtr&lt;nsIFile&gt; m_fileLoc;</span>
<a href="#l124.33"></a><span id="l124.33">   PRUint32 m_bytesImported;</span>
<a href="#l124.34"></a><span id="l124.34">   nsCOMPtr&lt;nsIStringBundle&gt; m_notProxyBundle;</span>
<a href="#l124.35"></a><span id="l124.35"> };</span>
<a href="#l124.36"></a><span id="l124.36"> </span>
<a href="#l124.37"></a><span id="l124.37"> nsVCardImport::nsVCardImport()</span>
<a href="#l124.38"></a><span id="l124.38"> {</span>
<a href="#l124.39"></a><span id="l124.39">   if (!VCARDLOGMODULE)</span>
<a href="#l124.40"></a><span id="l124.40">     VCARDLOGMODULE = PR_NewLogModule(&quot;IMPORT&quot;);</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l125.1"></a><span id="l125.1" class="difflineminus">--- a/mailnews/import/winlivemail/nsWMSettings.cpp</span>
<a href="#l125.2"></a><span id="l125.2" class="difflineplus">+++ b/mailnews/import/winlivemail/nsWMSettings.cpp</span>
<a href="#l125.3"></a><span id="l125.3" class="difflineat">@@ -26,39 +26,39 @@</span>
<a href="#l125.4"></a><span id="l125.4"> #include &quot;nsISmtpService.h&quot;</span>
<a href="#l125.5"></a><span id="l125.5"> #include &quot;nsISmtpServer.h&quot;</span>
<a href="#l125.6"></a><span id="l125.6"> #include &quot;nsWMStringBundle.h&quot;</span>
<a href="#l125.7"></a><span id="l125.7"> #include &quot;WMDebugLog.h&quot;</span>
<a href="#l125.8"></a><span id="l125.8"> #include &quot;nsIPop3IncomingServer.h&quot;</span>
<a href="#l125.9"></a><span id="l125.9"> #include &quot;nsIImapIncomingServer.h&quot;</span>
<a href="#l125.10"></a><span id="l125.10"> #include &quot;nsINntpIncomingServer.h&quot;</span>
<a href="#l125.11"></a><span id="l125.11"> #include &quot;stdlib.h&quot;</span>
<a href="#l125.12"></a><span id="l125.12" class="difflineminus">-#include &quot;nsILocalFile.h&quot;</span>
<a href="#l125.13"></a><span id="l125.13" class="difflineplus">+#include &quot;nsIFile.h&quot;</span>
<a href="#l125.14"></a><span id="l125.14"> #include &quot;nsISimpleEnumerator.h&quot;</span>
<a href="#l125.15"></a><span id="l125.15"> #include &quot;nsIMutableArray.h&quot;</span>
<a href="#l125.16"></a><span id="l125.16"> #include &quot;nsIDOMDocument.h&quot;</span>
<a href="#l125.17"></a><span id="l125.17"> #include &quot;nsNetUtil.h&quot;</span>
<a href="#l125.18"></a><span id="l125.18"> #include &quot;nsIDOMNodeList.h&quot;</span>
<a href="#l125.19"></a><span id="l125.19"> #include &quot;nsIFileStreams.h&quot;</span>
<a href="#l125.20"></a><span id="l125.20"> #include &quot;nsIDOMParser.h&quot;</span>
<a href="#l125.21"></a><span id="l125.21"> #include &quot;nsIDOMElement.h&quot;</span>
<a href="#l125.22"></a><span id="l125.22"> #include &quot;nsTArray.h&quot;</span>
<a href="#l125.23"></a><span id="l125.23"> #include &lt;windows.h&gt;</span>
<a href="#l125.24"></a><span id="l125.24"> #include &quot;nsIWindowsRegKey.h&quot;</span>
<a href="#l125.25"></a><span id="l125.25"> #include &quot;nsCOMArray.h&quot;</span>
<a href="#l125.26"></a><span id="l125.26"> </span>
<a href="#l125.27"></a><span id="l125.27"> class WMSettings {</span>
<a href="#l125.28"></a><span id="l125.28"> public:</span>
<a href="#l125.29"></a><span id="l125.29">   static nsresult FindWMKey(nsIWindowsRegKey* akey);</span>
<a href="#l125.30"></a><span id="l125.30" class="difflineminus">-  static bool getOEacctFiles(nsILocalFile* file, nsCOMArray&lt;nsILocalFile&gt;&amp; fileArray);</span>
<a href="#l125.31"></a><span id="l125.31" class="difflineplus">+  static bool getOEacctFiles(nsIFile* file, nsCOMArray&lt;nsIFile&gt;&amp; fileArray);</span>
<a href="#l125.32"></a><span id="l125.32">   static nsresult GetValueForTag(nsIDOMDocument *xmlDoc,</span>
<a href="#l125.33"></a><span id="l125.33">                                  const nsAString&amp; tagName,</span>
<a href="#l125.34"></a><span id="l125.34">                                  nsAString &amp;value);</span>
<a href="#l125.35"></a><span id="l125.35">   static nsresult MakeXMLdoc(nsIDOMDocument** xmlDoc,</span>
<a href="#l125.36"></a><span id="l125.36" class="difflineminus">-                             nsILocalFile* file);</span>
<a href="#l125.37"></a><span id="l125.37" class="difflineplus">+                             nsIFile* file);</span>
<a href="#l125.38"></a><span id="l125.38">   static bool DoImport(nsIMsgAccount **ppAccount);</span>
<a href="#l125.39"></a><span id="l125.39">   static bool DoIMAPServer(nsIMsgAccountManager *pMgr,</span>
<a href="#l125.40"></a><span id="l125.40">                              nsIDOMDocument *xmlDoc,</span>
<a href="#l125.41"></a><span id="l125.41">                              const nsString&amp; serverName,</span>
<a href="#l125.42"></a><span id="l125.42">                              nsIMsgAccount **ppAccount);</span>
<a href="#l125.43"></a><span id="l125.43">   static bool DoPOP3Server(nsIMsgAccountManager *pMgr,</span>
<a href="#l125.44"></a><span id="l125.44">                              nsIDOMDocument *xmlDoc,</span>
<a href="#l125.45"></a><span id="l125.45">                              const nsString&amp; serverName,</span>
<a href="#l125.46"></a><span id="l125.46" class="difflineat">@@ -157,32 +157,32 @@ nsresult WMSettings::FindWMKey(nsIWindow</span>
<a href="#l125.47"></a><span id="l125.47">   if (NS_SUCCEEDED(rv))</span>
<a href="#l125.48"></a><span id="l125.48">     return rv;</span>
<a href="#l125.49"></a><span id="l125.49">   rv = akey-&gt;Open(nsIWindowsRegKey::ROOT_KEY_CURRENT_USER,</span>
<a href="#l125.50"></a><span id="l125.50">                   NS_LITERAL_STRING(&quot;Software\\Microsoft\\Windows Mail&quot;),</span>
<a href="#l125.51"></a><span id="l125.51">                   nsIWindowsRegKey::ACCESS_QUERY_VALUE);</span>
<a href="#l125.52"></a><span id="l125.52">   return rv;</span>
<a href="#l125.53"></a><span id="l125.53"> }</span>
<a href="#l125.54"></a><span id="l125.54"> </span>
<a href="#l125.55"></a><span id="l125.55" class="difflineminus">-bool WMSettings::getOEacctFiles(nsILocalFile* file,</span>
<a href="#l125.56"></a><span id="l125.56" class="difflineminus">-                                  nsCOMArray&lt;nsILocalFile&gt;&amp; fileArray)</span>
<a href="#l125.57"></a><span id="l125.57" class="difflineplus">+bool WMSettings::getOEacctFiles(nsIFile* file,</span>
<a href="#l125.58"></a><span id="l125.58" class="difflineplus">+                                  nsCOMArray&lt;nsIFile&gt;&amp; fileArray)</span>
<a href="#l125.59"></a><span id="l125.59"> {</span>
<a href="#l125.60"></a><span id="l125.60">   nsresult rv;</span>
<a href="#l125.61"></a><span id="l125.61">   nsCOMPtr&lt;nsISimpleEnumerator&gt; entries;</span>
<a href="#l125.62"></a><span id="l125.62">   rv = file-&gt;GetDirectoryEntries(getter_AddRefs(entries));</span>
<a href="#l125.63"></a><span id="l125.63">   if (NS_FAILED(rv) || !entries)</span>
<a href="#l125.64"></a><span id="l125.64">     return false;</span>
<a href="#l125.65"></a><span id="l125.65"> </span>
<a href="#l125.66"></a><span id="l125.66">   bool hasMore;</span>
<a href="#l125.67"></a><span id="l125.67">   while (NS_SUCCEEDED(entries-&gt;HasMoreElements(&amp;hasMore)) &amp;&amp; hasMore) {</span>
<a href="#l125.68"></a><span id="l125.68">     nsCOMPtr&lt;nsISupports&gt; sup;</span>
<a href="#l125.69"></a><span id="l125.69">     entries-&gt;GetNext(getter_AddRefs(sup));</span>
<a href="#l125.70"></a><span id="l125.70">     if (!sup)</span>
<a href="#l125.71"></a><span id="l125.71">       return false;</span>
<a href="#l125.72"></a><span id="l125.72" class="difflineminus">-    nsCOMPtr&lt;nsILocalFile&gt; fileX = do_QueryInterface(sup);</span>
<a href="#l125.73"></a><span id="l125.73" class="difflineplus">+    nsCOMPtr&lt;nsIFile&gt; fileX = do_QueryInterface(sup);</span>
<a href="#l125.74"></a><span id="l125.74">     if (!fileX)</span>
<a href="#l125.75"></a><span id="l125.75">       return false;</span>
<a href="#l125.76"></a><span id="l125.76">     nsString name;</span>
<a href="#l125.77"></a><span id="l125.77">     if (NS_FAILED(fileX-&gt;GetLeafName(name)))</span>
<a href="#l125.78"></a><span id="l125.78">       return false;</span>
<a href="#l125.79"></a><span id="l125.79">     bool isDir;</span>
<a href="#l125.80"></a><span id="l125.80">     if (NS_FAILED(fileX-&gt;IsDirectory(&amp;isDir)))</span>
<a href="#l125.81"></a><span id="l125.81">       return false;</span>
<a href="#l125.82"></a><span id="l125.82" class="difflineat">@@ -207,17 +207,17 @@ nsresult WMSettings::GetValueForTag(nsID</span>
<a href="#l125.83"></a><span id="l125.83">   nsCOMPtr&lt;nsIDOMNode&gt; domNode;</span>
<a href="#l125.84"></a><span id="l125.84">   list-&gt;Item(0, getter_AddRefs(domNode));</span>
<a href="#l125.85"></a><span id="l125.85">   if (!domNode)</span>
<a href="#l125.86"></a><span id="l125.86">     return NS_ERROR_FAILURE;</span>
<a href="#l125.87"></a><span id="l125.87">   return domNode-&gt;GetTextContent(value);</span>
<a href="#l125.88"></a><span id="l125.88"> }</span>
<a href="#l125.89"></a><span id="l125.89"> </span>
<a href="#l125.90"></a><span id="l125.90"> nsresult WMSettings::MakeXMLdoc(nsIDOMDocument** xmlDoc,</span>
<a href="#l125.91"></a><span id="l125.91" class="difflineminus">-                                nsILocalFile* file)</span>
<a href="#l125.92"></a><span id="l125.92" class="difflineplus">+                                nsIFile* file)</span>
<a href="#l125.93"></a><span id="l125.93"> {</span>
<a href="#l125.94"></a><span id="l125.94">   nsresult rv;</span>
<a href="#l125.95"></a><span id="l125.95">   nsCOMPtr&lt;nsIFileInputStream&gt; stream =</span>
<a href="#l125.96"></a><span id="l125.96">     do_CreateInstance(NS_LOCALFILEINPUTSTREAM_CONTRACTID, &amp;rv);</span>
<a href="#l125.97"></a><span id="l125.97">   NS_ENSURE_SUCCESS(rv, rv);</span>
<a href="#l125.98"></a><span id="l125.98"> </span>
<a href="#l125.99"></a><span id="l125.99">   rv = stream-&gt;Init(file, PR_RDONLY, -1, 0);</span>
<a href="#l125.100"></a><span id="l125.100">   nsCOMPtr&lt;nsIDOMParser&gt; parser = do_CreateInstance(NS_DOMPARSER_CONTRACTID);</span>
<a href="#l125.101"></a><span id="l125.101" class="difflineat">@@ -266,19 +266,19 @@ bool WMSettings::DoImport(nsIMsgAccount </span>
<a href="#l125.102"></a><span id="l125.102">   nsString  storeRoot;</span>
<a href="#l125.103"></a><span id="l125.103">   rv = key-&gt;ReadStringValue(NS_LITERAL_STRING(&quot;Store Root&quot;), storeRoot);</span>
<a href="#l125.104"></a><span id="l125.104">   key-&gt;Close();  // Finished with windows registry key. We do not want to return before this closing</span>
<a href="#l125.105"></a><span id="l125.105">   if (NS_FAILED(rv) || storeRoot.IsEmpty()) {</span>
<a href="#l125.106"></a><span id="l125.106">     IMPORT_LOG0(&quot;*** Error finding Windows Live Mail Store Root\n&quot;);</span>
<a href="#l125.107"></a><span id="l125.107">     return false;</span>
<a href="#l125.108"></a><span id="l125.108">   }</span>
<a href="#l125.109"></a><span id="l125.109"> </span>
<a href="#l125.110"></a><span id="l125.110" class="difflineminus">-  nsCOMPtr&lt;nsILocalFile&gt; file(do_CreateInstance(NS_LOCAL_FILE_CONTRACTID));</span>
<a href="#l125.111"></a><span id="l125.111" class="difflineplus">+  nsCOMPtr&lt;nsIFile&gt; file(do_CreateInstance(NS_LOCAL_FILE_CONTRACTID));</span>
<a href="#l125.112"></a><span id="l125.112">   if (!file) {</span>
<a href="#l125.113"></a><span id="l125.113" class="difflineminus">-    IMPORT_LOG0(&quot;*** Failed to create an nsILocalFile!\n&quot;);</span>
<a href="#l125.114"></a><span id="l125.114" class="difflineplus">+    IMPORT_LOG0(&quot;*** Failed to create an nsIFile!\n&quot;);</span>
<a href="#l125.115"></a><span id="l125.115">     return false;</span>
<a href="#l125.116"></a><span id="l125.116">   }</span>
<a href="#l125.117"></a><span id="l125.117">   nsCOMPtr&lt;nsIMsgAccountManager&gt; accMgr =</span>
<a href="#l125.118"></a><span id="l125.118">            do_GetService(NS_MSGACCOUNTMANAGER_CONTRACTID, &amp;rv);</span>
<a href="#l125.119"></a><span id="l125.119">   if (NS_FAILED(rv)) {</span>
<a href="#l125.120"></a><span id="l125.120">     IMPORT_LOG0(&quot;*** Failed to create an account manager!\n&quot;);</span>
<a href="#l125.121"></a><span id="l125.121">     return false;</span>
<a href="#l125.122"></a><span id="l125.122">   }</span>
<a href="#l125.123"></a><span id="l125.123" class="difflineat">@@ -292,17 +292,17 @@ bool WMSettings::DoImport(nsIMsgAccount </span>
<a href="#l125.124"></a><span id="l125.124">                               (LPWSTR)expandedStoreRoot.BeginWriting(),</span>
<a href="#l125.125"></a><span id="l125.125">                               size);</span>
<a href="#l125.126"></a><span id="l125.126">   storeRoot = expandedStoreRoot;</span>
<a href="#l125.127"></a><span id="l125.127"> </span>
<a href="#l125.128"></a><span id="l125.128">   if (NS_FAILED(file-&gt;InitWithPath(storeRoot))) {</span>
<a href="#l125.129"></a><span id="l125.129">     IMPORT_LOG0(&quot;*** Failed get store root!\n&quot;);</span>
<a href="#l125.130"></a><span id="l125.130">     return false;</span>
<a href="#l125.131"></a><span id="l125.131">   }</span>
<a href="#l125.132"></a><span id="l125.132" class="difflineminus">-  nsCOMArray&lt;nsILocalFile&gt; fileArray;</span>
<a href="#l125.133"></a><span id="l125.133" class="difflineplus">+  nsCOMArray&lt;nsIFile&gt; fileArray;</span>
<a href="#l125.134"></a><span id="l125.134">   if (!getOEacctFiles(file, fileArray)) {</span>
<a href="#l125.135"></a><span id="l125.135">     IMPORT_LOG0(&quot;*** Failed to get OEacctFiles!\n&quot;);</span>
<a href="#l125.136"></a><span id="l125.136">     return false;</span>
<a href="#l125.137"></a><span id="l125.137">   }</span>
<a href="#l125.138"></a><span id="l125.138"> </span>
<a href="#l125.139"></a><span id="l125.139">   // Loop through *.oeaccounts files looking for POP3 &amp; IMAP &amp; NNTP accounts</span>
<a href="#l125.140"></a><span id="l125.140">   // Ignore LDAP for now!</span>
<a href="#l125.141"></a><span id="l125.141">   int accounts = 0;</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l126.1"></a><span id="l126.1" class="difflineminus">--- a/mailnews/local/public/nsIMailboxService.idl</span>
<a href="#l126.2"></a><span id="l126.2" class="difflineplus">+++ b/mailnews/local/public/nsIMailboxService.idl</span>
<a href="#l126.3"></a><span id="l126.3" class="difflineat">@@ -4,17 +4,17 @@</span>
<a href="#l126.4"></a><span id="l126.4">  * file, You can obtain one at http://mozilla.org/MPL/2.0/. */</span>
<a href="#l126.5"></a><span id="l126.5"> </span>
<a href="#l126.6"></a><span id="l126.6"> #include &quot;nsISupports.idl&quot;</span>
<a href="#l126.7"></a><span id="l126.7"> #include &quot;nsIUrlListener.idl&quot;</span>
<a href="#l126.8"></a><span id="l126.8"> </span>
<a href="#l126.9"></a><span id="l126.9"> interface nsIURI;</span>
<a href="#l126.10"></a><span id="l126.10"> interface nsIStreamListener;</span>
<a href="#l126.11"></a><span id="l126.11"> interface nsIMsgWindow;</span>
<a href="#l126.12"></a><span id="l126.12" class="difflineminus">-interface nsILocalFile;</span>
<a href="#l126.13"></a><span id="l126.13" class="difflineplus">+interface nsIFile;</span>
<a href="#l126.14"></a><span id="l126.14"> </span>
<a href="#l126.15"></a><span id="l126.15"> [scriptable, uuid(809FCD02-B9EA-4DC0-84F0-3FBC55AE11F1)]</span>
<a href="#l126.16"></a><span id="l126.16"> interface nsIMailboxService : nsISupports {</span>
<a href="#l126.17"></a><span id="l126.17"> </span>
<a href="#l126.18"></a><span id="l126.18">   /*</span>
<a href="#l126.19"></a><span id="l126.19">    * All of these functions build mailbox urls and run them. If you want a</span>
<a href="#l126.20"></a><span id="l126.20">    * handle on the running task, pass in a valid nsIURI ptr. You can later</span>
<a href="#l126.21"></a><span id="l126.21">    * interrupt this action by asking the netlib service manager to interrupt</span>
<a href="#l126.22"></a><span id="l126.22" class="difflineat">@@ -22,13 +22,13 @@ interface nsIMailboxService : nsISupport</span>
<a href="#l126.23"></a><span id="l126.23">    * with it. Pass nsnull in for aURL if you don't care about the returned URL.</span>
<a href="#l126.24"></a><span id="l126.24">    */</span>
<a href="#l126.25"></a><span id="l126.25"> </span>
<a href="#l126.26"></a><span id="l126.26">   /*</span>
<a href="#l126.27"></a><span id="l126.27">    * Pass in a file path for the mailbox you wish to parse. You also need to</span>
<a href="#l126.28"></a><span id="l126.28">    * pass in a mailbox  parser (the consumer). The url listener can be null</span>
<a href="#l126.29"></a><span id="l126.29">    * if you have no interest in tracking the url.</span>
<a href="#l126.30"></a><span id="l126.30">    */</span>
<a href="#l126.31"></a><span id="l126.31" class="difflineminus">-  nsIURI ParseMailbox(in nsIMsgWindow aMsgWindow, in nsILocalFile aMailboxPath,</span>
<a href="#l126.32"></a><span id="l126.32" class="difflineplus">+  nsIURI ParseMailbox(in nsIMsgWindow aMsgWindow, in nsIFile aMailboxPath,</span>
<a href="#l126.33"></a><span id="l126.33">                                  in nsIStreamListener aMailboxParser,</span>
<a href="#l126.34"></a><span id="l126.34">                                  in nsIUrlListener aUrlListener);</span>
<a href="#l126.35"></a><span id="l126.35"> </span>
<a href="#l126.36"></a><span id="l126.36"> };</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l127.1"></a><span id="l127.1" class="difflineminus">--- a/mailnews/local/public/nsINoIncomingServer.idl</span>
<a href="#l127.2"></a><span id="l127.2" class="difflineplus">+++ b/mailnews/local/public/nsINoIncomingServer.idl</span>
<a href="#l127.3"></a><span id="l127.3" class="difflineat">@@ -1,15 +1,15 @@</span>
<a href="#l127.4"></a><span id="l127.4"> /* -*- Mode: IDL; tab-width: 4; indent-tabs-mode: nil; c-basic-offset: 4 -*- */</span>
<a href="#l127.5"></a><span id="l127.5"> /* This Source Code Form is subject to the terms of the Mozilla Public</span>
<a href="#l127.6"></a><span id="l127.6">  * License, v. 2.0. If a copy of the MPL was not distributed with this</span>
<a href="#l127.7"></a><span id="l127.7">  * file, You can obtain one at http://mozilla.org/MPL/2.0/. */</span>
<a href="#l127.8"></a><span id="l127.8"> </span>
<a href="#l127.9"></a><span id="l127.9"> #include &quot;nsISupports.idl&quot;</span>
<a href="#l127.10"></a><span id="l127.10"> </span>
<a href="#l127.11"></a><span id="l127.11" class="difflineminus">-interface nsILocalFile;</span>
<a href="#l127.12"></a><span id="l127.12" class="difflineplus">+interface nsIFile;</span>
<a href="#l127.13"></a><span id="l127.13"> </span>
<a href="#l127.14"></a><span id="l127.14"> [scriptable, uuid(ba3071e9-39a5-4a10-b770-1809317ef2c1)]</span>
<a href="#l127.15"></a><span id="l127.15"> interface nsINoIncomingServer : nsISupports {</span>
<a href="#l127.16"></a><span id="l127.16">   /* copy (or prepend) bin/defaults/messenger/&lt;folderNameOnDisk&gt; to &lt;parentDir&gt;/&lt;folderNameOnDisk&gt; */</span>
<a href="#l127.17"></a><span id="l127.17" class="difflineminus">-  void copyDefaultMessages(in string folderNameOnDisk, in nsILocalFile parentDir);</span>
<a href="#l127.18"></a><span id="l127.18" class="difflineplus">+  void copyDefaultMessages(in string folderNameOnDisk, in nsIFile parentDir);</span>
<a href="#l127.19"></a><span id="l127.19"> };</span>
<a href="#l127.20"></a><span id="l127.20"> </span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l128.1"></a><span id="l128.1" class="difflineminus">--- a/mailnews/local/public/nsIRssIncomingServer.idl</span>
<a href="#l128.2"></a><span id="l128.2" class="difflineplus">+++ b/mailnews/local/public/nsIRssIncomingServer.idl</span>
<a href="#l128.3"></a><span id="l128.3" class="difflineat">@@ -1,16 +1,16 @@</span>
<a href="#l128.4"></a><span id="l128.4"> /* This Source Code Form is subject to the terms of the Mozilla Public</span>
<a href="#l128.5"></a><span id="l128.5">  * License, v. 2.0. If a copy of the MPL was not distributed with this</span>
<a href="#l128.6"></a><span id="l128.6">  * file, You can obtain one at http://mozilla.org/MPL/2.0/. */</span>
<a href="#l128.7"></a><span id="l128.7"> </span>
<a href="#l128.8"></a><span id="l128.8"> #include &quot;nsISupports.idl&quot;</span>
<a href="#l128.9"></a><span id="l128.9"> </span>
<a href="#l128.10"></a><span id="l128.10" class="difflineminus">-interface nsILocalFile;</span>
<a href="#l128.11"></a><span id="l128.11" class="difflineplus">+interface nsIFile;</span>
<a href="#l128.12"></a><span id="l128.12"> </span>
<a href="#l128.13"></a><span id="l128.13"> [scriptable, uuid(6d744e7f-2218-45c6-8734-998a56cb3c6d)]</span>
<a href="#l128.14"></a><span id="l128.14"> interface nsIRssIncomingServer : nsISupports {</span>
<a href="#l128.15"></a><span id="l128.15">   // Path to the subscriptions data source for this RSS server</span>
<a href="#l128.16"></a><span id="l128.16" class="difflineminus">-  readonly attribute nsILocalFile subscriptionsDataSourcePath;</span>
<a href="#l128.17"></a><span id="l128.17" class="difflineplus">+  readonly attribute nsIFile subscriptionsDataSourcePath;</span>
<a href="#l128.18"></a><span id="l128.18"> </span>
<a href="#l128.19"></a><span id="l128.19">   // Path to the feed items data source for this RSS server</span>
<a href="#l128.20"></a><span id="l128.20" class="difflineminus">-  readonly attribute nsILocalFile feedItemsDataSourcePath;</span>
<a href="#l128.21"></a><span id="l128.21" class="difflineplus">+  readonly attribute nsIFile feedItemsDataSourcePath;</span>
<a href="#l128.22"></a><span id="l128.22"> };</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l129.1"></a><span id="l129.1" class="difflineminus">--- a/mailnews/local/src/nsLocalMailFolder.cpp</span>
<a href="#l129.2"></a><span id="l129.2" class="difflineplus">+++ b/mailnews/local/src/nsLocalMailFolder.cpp</span>
<a href="#l129.3"></a><span id="l129.3" class="difflineat">@@ -223,17 +223,17 @@ nsMsgLocalMailFolder::GetSubFolders(nsIS</span>
<a href="#l129.4"></a><span id="l129.4">     nsCOMPtr&lt;nsIMsgPluggableStore&gt; msgStore;</span>
<a href="#l129.5"></a><span id="l129.5">     // need to set this flag here to avoid infinite recursion</span>
<a href="#l129.6"></a><span id="l129.6">     mInitialized = true;</span>
<a href="#l129.7"></a><span id="l129.7">     rv = server-&gt;GetMsgStore(getter_AddRefs(msgStore));</span>
<a href="#l129.8"></a><span id="l129.8">     NS_ENSURE_SUCCESS(rv, rv);</span>
<a href="#l129.9"></a><span id="l129.9">     // This should add all existing folders as sub-folders of this folder.</span>
<a href="#l129.10"></a><span id="l129.10">     rv = msgStore-&gt;DiscoverSubFolders(this, true);</span>
<a href="#l129.11"></a><span id="l129.11"> </span>
<a href="#l129.12"></a><span id="l129.12" class="difflineminus">-    nsCOMPtr&lt;nsILocalFile&gt; path;</span>
<a href="#l129.13"></a><span id="l129.13" class="difflineplus">+    nsCOMPtr&lt;nsIFile&gt; path;</span>
<a href="#l129.14"></a><span id="l129.14">     rv = GetFilePath(getter_AddRefs(path));</span>
<a href="#l129.15"></a><span id="l129.15">     if (NS_FAILED(rv))</span>
<a href="#l129.16"></a><span id="l129.16">       return rv;</span>
<a href="#l129.17"></a><span id="l129.17"> </span>
<a href="#l129.18"></a><span id="l129.18">     bool exists, directory;</span>
<a href="#l129.19"></a><span id="l129.19">     path-&gt;Exists(&amp;exists);</span>
<a href="#l129.20"></a><span id="l129.20">     if (!exists)</span>
<a href="#l129.21"></a><span id="l129.21">       path-&gt;Create(nsIFile::DIRECTORY_TYPE, 0755);</span>
<a href="#l129.22"></a><span id="l129.22" class="difflineat">@@ -318,17 +318,17 @@ NS_IMETHODIMP nsMsgLocalMailFolder::GetD</span>
<a href="#l129.23"></a><span id="l129.23">   {</span>
<a href="#l129.24"></a><span id="l129.24">     NS_ASSERTION(!mReparseListener, &quot;can't have an existing listener&quot;);</span>
<a href="#l129.25"></a><span id="l129.25">     mReparseListener = aReparseUrlListener;</span>
<a href="#l129.26"></a><span id="l129.26">     return NS_MSG_ERROR_FOLDER_SUMMARY_OUT_OF_DATE;</span>
<a href="#l129.27"></a><span id="l129.27">   }</span>
<a href="#l129.28"></a><span id="l129.28"> </span>
<a href="#l129.29"></a><span id="l129.29">   if (!mDatabase)</span>
<a href="#l129.30"></a><span id="l129.30">   {</span>
<a href="#l129.31"></a><span id="l129.31" class="difflineminus">-    nsCOMPtr &lt;nsILocalFile&gt; pathFile;</span>
<a href="#l129.32"></a><span id="l129.32" class="difflineplus">+    nsCOMPtr &lt;nsIFile&gt; pathFile;</span>
<a href="#l129.33"></a><span id="l129.33">     rv = GetFilePath(getter_AddRefs(pathFile));</span>
<a href="#l129.34"></a><span id="l129.34">     if (NS_FAILED(rv))</span>
<a href="#l129.35"></a><span id="l129.35">       return rv;</span>
<a href="#l129.36"></a><span id="l129.36"> </span>
<a href="#l129.37"></a><span id="l129.37">     bool exists;</span>
<a href="#l129.38"></a><span id="l129.38">     rv = pathFile-&gt;Exists(&amp;exists);</span>
<a href="#l129.39"></a><span id="l129.39">     NS_ENSURE_SUCCESS(rv,rv);</span>
<a href="#l129.40"></a><span id="l129.40">     if (!exists)</span>
<a href="#l129.41"></a><span id="l129.41" class="difflineat">@@ -366,17 +366,17 @@ NS_IMETHODIMP nsMsgLocalMailFolder::GetD</span>
<a href="#l129.42"></a><span id="l129.42">             mBackupDatabase = nsnull;</span>
<a href="#l129.43"></a><span id="l129.43">           }</span>
<a href="#l129.44"></a><span id="l129.44">         }</span>
<a href="#l129.45"></a><span id="l129.45">         else</span>
<a href="#l129.46"></a><span id="l129.46">           mDatabase-&gt;ForceClosed();</span>
<a href="#l129.47"></a><span id="l129.47"> </span>
<a href="#l129.48"></a><span id="l129.48">         mDatabase = nsnull;</span>
<a href="#l129.49"></a><span id="l129.49">       }</span>
<a href="#l129.50"></a><span id="l129.50" class="difflineminus">-      nsCOMPtr &lt;nsILocalFile&gt; summaryFile;</span>
<a href="#l129.51"></a><span id="l129.51" class="difflineplus">+      nsCOMPtr &lt;nsIFile&gt; summaryFile;</span>
<a href="#l129.52"></a><span id="l129.52">       rv = GetSummaryFileLocation(pathFile, getter_AddRefs(summaryFile));</span>
<a href="#l129.53"></a><span id="l129.53">       NS_ENSURE_SUCCESS(rv, rv);</span>
<a href="#l129.54"></a><span id="l129.54">       // Remove summary file.</span>
<a href="#l129.55"></a><span id="l129.55">       summaryFile-&gt;Remove(false);</span>
<a href="#l129.56"></a><span id="l129.56"> </span>
<a href="#l129.57"></a><span id="l129.57">       // if it's out of date then reopen with upgrade.</span>
<a href="#l129.58"></a><span id="l129.58">       rv = msgDBService-&gt;CreateNewDB(this, getter_AddRefs(mDatabase));</span>
<a href="#l129.59"></a><span id="l129.59">       NS_ENSURE_SUCCESS(rv, rv);</span>
<a href="#l129.60"></a><span id="l129.60" class="difflineat">@@ -474,17 +474,17 @@ nsMsgLocalMailFolder::GetMessages(nsISim</span>
<a href="#l129.61"></a><span id="l129.61">   nsCOMPtr &lt;nsIMsgDatabase&gt; msgDB;</span>
<a href="#l129.62"></a><span id="l129.62">   nsresult rv = GetDatabaseWOReparse(getter_AddRefs(msgDB));</span>
<a href="#l129.63"></a><span id="l129.63">   return NS_SUCCEEDED(rv) ? msgDB-&gt;EnumerateMessages(result) : rv;</span>
<a href="#l129.64"></a><span id="l129.64"> }</span>
<a href="#l129.65"></a><span id="l129.65"> </span>
<a href="#l129.66"></a><span id="l129.66"> NS_IMETHODIMP nsMsgLocalMailFolder::GetFolderURL(nsACString&amp; aUrl)</span>
<a href="#l129.67"></a><span id="l129.67"> {</span>
<a href="#l129.68"></a><span id="l129.68">   nsresult rv;</span>
<a href="#l129.69"></a><span id="l129.69" class="difflineminus">-  nsCOMPtr&lt;nsILocalFile&gt; path;</span>
<a href="#l129.70"></a><span id="l129.70" class="difflineplus">+  nsCOMPtr&lt;nsIFile&gt; path;</span>
<a href="#l129.71"></a><span id="l129.71">   rv = GetFilePath(getter_AddRefs(path));</span>
<a href="#l129.72"></a><span id="l129.72">   if (NS_FAILED(rv))</span>
<a href="#l129.73"></a><span id="l129.73">     return rv;</span>
<a href="#l129.74"></a><span id="l129.74"> </span>
<a href="#l129.75"></a><span id="l129.75">   rv = NS_GetURLSpecFromFile(path, aUrl);</span>
<a href="#l129.76"></a><span id="l129.76">   NS_ENSURE_SUCCESS(rv, rv);</span>
<a href="#l129.77"></a><span id="l129.77"> </span>
<a href="#l129.78"></a><span id="l129.78">   aUrl.Replace(0, strlen(&quot;file:&quot;), &quot;mailbox:&quot;);</span>
<a href="#l129.79"></a><span id="l129.79" class="difflineat">@@ -776,17 +776,17 @@ NS_IMETHODIMP nsMsgLocalMailFolder::Dele</span>
<a href="#l129.80"></a><span id="l129.80">   rv = GetServer(getter_AddRefs(server));</span>
<a href="#l129.81"></a><span id="l129.81">   NS_ENSURE_SUCCESS(rv, rv);</span>
<a href="#l129.82"></a><span id="l129.82"> </span>
<a href="#l129.83"></a><span id="l129.83">   nsCOMPtr&lt;nsIMsgPluggableStore&gt; msgStore;</span>
<a href="#l129.84"></a><span id="l129.84"> </span>
<a href="#l129.85"></a><span id="l129.85">   rv = server-&gt;GetMsgStore(getter_AddRefs(msgStore));</span>
<a href="#l129.86"></a><span id="l129.86">   NS_ENSURE_SUCCESS(rv, rv);</span>
<a href="#l129.87"></a><span id="l129.87"> </span>
<a href="#l129.88"></a><span id="l129.88" class="difflineminus">-  nsCOMPtr &lt;nsILocalFile&gt; summaryFile;</span>
<a href="#l129.89"></a><span id="l129.89" class="difflineplus">+  nsCOMPtr &lt;nsIFile&gt; summaryFile;</span>
<a href="#l129.90"></a><span id="l129.90">   rv = msgStore-&gt;GetSummaryFile(this, getter_AddRefs(summaryFile));</span>
<a href="#l129.91"></a><span id="l129.91">   NS_ENSURE_SUCCESS(rv, rv);</span>
<a href="#l129.92"></a><span id="l129.92"> </span>
<a href="#l129.93"></a><span id="l129.93">   //Clean up .sbd folder if it exists.</span>
<a href="#l129.94"></a><span id="l129.94">   // Remove summary file.</span>
<a href="#l129.95"></a><span id="l129.95">   summaryFile-&gt;Remove(false);</span>
<a href="#l129.96"></a><span id="l129.96"> </span>
<a href="#l129.97"></a><span id="l129.97">   return msgStore-&gt;DeleteFolder(this);</span>
<a href="#l129.98"></a><span id="l129.98" class="difflineat">@@ -1020,17 +1020,17 @@ NS_IMETHODIMP nsMsgLocalMailFolder::GetN</span>
<a href="#l129.99"></a><span id="l129.99"> </span>
<a href="#l129.100"></a><span id="l129.100"> nsresult nsMsgLocalMailFolder::OpenDatabase()</span>
<a href="#l129.101"></a><span id="l129.101"> {</span>
<a href="#l129.102"></a><span id="l129.102">   nsresult rv;</span>
<a href="#l129.103"></a><span id="l129.103">   nsCOMPtr&lt;nsIMsgDBService&gt; msgDBService = do_GetService(NS_MSGDB_SERVICE_CONTRACTID, &amp;rv);</span>
<a href="#l129.104"></a><span id="l129.104">   NS_ENSURE_SUCCESS(rv, rv);</span>
<a href="#l129.105"></a><span id="l129.105"> </span>
<a href="#l129.106"></a><span id="l129.106">   bool folderEmpty = false;</span>
<a href="#l129.107"></a><span id="l129.107" class="difflineminus">-  nsCOMPtr &lt;nsILocalFile&gt; file;</span>
<a href="#l129.108"></a><span id="l129.108" class="difflineplus">+  nsCOMPtr &lt;nsIFile&gt; file;</span>
<a href="#l129.109"></a><span id="l129.109">   rv = GetFilePath(getter_AddRefs(file));</span>
<a href="#l129.110"></a><span id="l129.110"> </span>
<a href="#l129.111"></a><span id="l129.111">   rv = msgDBService-&gt;OpenFolderDB(this, true, getter_AddRefs(mDatabase));</span>
<a href="#l129.112"></a><span id="l129.112">     if (rv == NS_MSG_ERROR_FOLDER_SUMMARY_MISSING)</span>
<a href="#l129.113"></a><span id="l129.113">     {</span>
<a href="#l129.114"></a><span id="l129.114">     // check if we're a real folder by looking at the parent folder.</span>
<a href="#l129.115"></a><span id="l129.115">     nsCOMPtr&lt;nsIMsgFolder&gt; parent;</span>
<a href="#l129.116"></a><span id="l129.116">     GetParent(getter_AddRefs(parent));</span>
<a href="#l129.117"></a><span id="l129.117" class="difflineat">@@ -1142,17 +1142,17 @@ NS_IMETHODIMP nsMsgLocalMailFolder::Refr</span>
<a href="#l129.118"></a><span id="l129.118"> }</span>
<a href="#l129.119"></a><span id="l129.119"> </span>
<a href="#l129.120"></a><span id="l129.120"> NS_IMETHODIMP nsMsgLocalMailFolder::GetSizeOnDisk(PRUint32* aSize)</span>
<a href="#l129.121"></a><span id="l129.121"> {</span>
<a href="#l129.122"></a><span id="l129.122">   NS_ENSURE_ARG_POINTER(aSize);</span>
<a href="#l129.123"></a><span id="l129.123">   nsresult rv = NS_OK;</span>
<a href="#l129.124"></a><span id="l129.124">   if (!mFolderSize)</span>
<a href="#l129.125"></a><span id="l129.125">   {</span>
<a href="#l129.126"></a><span id="l129.126" class="difflineminus">-    nsCOMPtr &lt;nsILocalFile&gt; file;</span>
<a href="#l129.127"></a><span id="l129.127" class="difflineplus">+    nsCOMPtr &lt;nsIFile&gt; file;</span>
<a href="#l129.128"></a><span id="l129.128">     rv = GetFilePath(getter_AddRefs(file));</span>
<a href="#l129.129"></a><span id="l129.129">     NS_ENSURE_SUCCESS(rv, rv);</span>
<a href="#l129.130"></a><span id="l129.130">     PRInt64 folderSize;</span>
<a href="#l129.131"></a><span id="l129.131">     rv = file-&gt;GetFileSize(&amp;folderSize);</span>
<a href="#l129.132"></a><span id="l129.132">     NS_ENSURE_SUCCESS(rv, rv);</span>
<a href="#l129.133"></a><span id="l129.133"> </span>
<a href="#l129.134"></a><span id="l129.134">     mFolderSize = (PRUint32) folderSize;</span>
<a href="#l129.135"></a><span id="l129.135">   }</span>
<a href="#l129.136"></a><span id="l129.136" class="difflineat">@@ -1290,17 +1290,17 @@ nsMsgLocalMailFolder::MarkMessagesFlagge</span>
<a href="#l129.137"></a><span id="l129.137"> nsresult</span>
<a href="#l129.138"></a><span id="l129.138"> nsMsgLocalMailFolder::InitCopyState(nsISupports* aSupport,</span>
<a href="#l129.139"></a><span id="l129.139">                                     nsIArray* messages,</span>
<a href="#l129.140"></a><span id="l129.140">                                     bool isMove,</span>
<a href="#l129.141"></a><span id="l129.141">                                     nsIMsgCopyServiceListener* listener,</span>
<a href="#l129.142"></a><span id="l129.142">                                     nsIMsgWindow *msgWindow, bool isFolder,</span>
<a href="#l129.143"></a><span id="l129.143">                                     bool allowUndo)</span>
<a href="#l129.144"></a><span id="l129.144"> {</span>
<a href="#l129.145"></a><span id="l129.145" class="difflineminus">-  nsCOMPtr&lt;nsILocalFile&gt; path;</span>
<a href="#l129.146"></a><span id="l129.146" class="difflineplus">+  nsCOMPtr&lt;nsIFile&gt; path;</span>
<a href="#l129.147"></a><span id="l129.147"> </span>
<a href="#l129.148"></a><span id="l129.148">   NS_ASSERTION(!mCopyState, &quot;already copying a msg into this folder&quot;);</span>
<a href="#l129.149"></a><span id="l129.149">   if (mCopyState)</span>
<a href="#l129.150"></a><span id="l129.150">     return NS_ERROR_FAILURE; // already has a  copy in progress</span>
<a href="#l129.151"></a><span id="l129.151"> </span>
<a href="#l129.152"></a><span id="l129.152">   // get mDatabase set, so we can use it to add new hdrs to this db.</span>
<a href="#l129.153"></a><span id="l129.153">   // calling GetDatabase will set mDatabase - we use the comptr</span>
<a href="#l129.154"></a><span id="l129.154">   // here to avoid doubling the refcnt on mDatabase. We don't care if this</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l130.1"></a><span id="l130.1" class="difflineminus">--- a/mailnews/local/src/nsLocalUtils.cpp</span>
<a href="#l130.2"></a><span id="l130.2" class="difflineplus">+++ b/mailnews/local/src/nsLocalUtils.cpp</span>
<a href="#l130.3"></a><span id="l130.3" class="difflineat">@@ -139,17 +139,17 @@ nsLocalURI2Path(const char* rootURI, con</span>
<a href="#l130.4"></a><span id="l130.4">   nsCOMPtr&lt;nsIMsgIncomingServer&gt; server;</span>
<a href="#l130.5"></a><span id="l130.5">   rv = nsLocalURI2Server(uriStr, getter_AddRefs(server));</span>
<a href="#l130.6"></a><span id="l130.6"> </span>
<a href="#l130.7"></a><span id="l130.7">   if (NS_FAILED(rv))</span>
<a href="#l130.8"></a><span id="l130.8">     return rv;</span>
<a href="#l130.9"></a><span id="l130.9"> </span>
<a href="#l130.10"></a><span id="l130.10">   // now ask the server what it's root is</span>
<a href="#l130.11"></a><span id="l130.11">   // and begin pathResult with the mailbox root</span>
<a href="#l130.12"></a><span id="l130.12" class="difflineminus">-  nsCOMPtr&lt;nsILocalFile&gt; localPath;</span>
<a href="#l130.13"></a><span id="l130.13" class="difflineplus">+  nsCOMPtr&lt;nsIFile&gt; localPath;</span>
<a href="#l130.14"></a><span id="l130.14">   rv = server-&gt;GetLocalPath(getter_AddRefs(localPath));</span>
<a href="#l130.15"></a><span id="l130.15">   NS_ENSURE_SUCCESS(rv, rv);</span>
<a href="#l130.16"></a><span id="l130.16"> </span>
<a href="#l130.17"></a><span id="l130.17">   nsCString localNativePath;</span>
<a href="#l130.18"></a><span id="l130.18"> </span>
<a href="#l130.19"></a><span id="l130.19">   localPath-&gt;GetNativePath(localNativePath);</span>
<a href="#l130.20"></a><span id="l130.20">   nsEscapeNativePath(localNativePath);</span>
<a href="#l130.21"></a><span id="l130.21">   pathResult = localNativePath.get();</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l131.1"></a><span id="l131.1" class="difflineminus">--- a/mailnews/local/src/nsMailboxService.cpp</span>
<a href="#l131.2"></a><span id="l131.2" class="difflineplus">+++ b/mailnews/local/src/nsMailboxService.cpp</span>
<a href="#l131.3"></a><span id="l131.3" class="difflineat">@@ -32,17 +32,17 @@ nsMailboxService::nsMailboxService()</span>
<a href="#l131.4"></a><span id="l131.4">     mPrintingOperation = false;</span>
<a href="#l131.5"></a><span id="l131.5"> }</span>
<a href="#l131.6"></a><span id="l131.6"> </span>
<a href="#l131.7"></a><span id="l131.7"> nsMailboxService::~nsMailboxService()</span>
<a href="#l131.8"></a><span id="l131.8"> {}</span>
<a href="#l131.9"></a><span id="l131.9"> </span>
<a href="#l131.10"></a><span id="l131.10"> NS_IMPL_ISUPPORTS4(nsMailboxService, nsIMailboxService, nsIMsgMessageService, nsIProtocolHandler, nsIMsgMessageFetchPartService)</span>
<a href="#l131.11"></a><span id="l131.11"> </span>
<a href="#l131.12"></a><span id="l131.12" class="difflineminus">-nsresult nsMailboxService::ParseMailbox(nsIMsgWindow *aMsgWindow, nsILocalFile *aMailboxPath, nsIStreamListener *aMailboxParser,</span>
<a href="#l131.13"></a><span id="l131.13" class="difflineplus">+nsresult nsMailboxService::ParseMailbox(nsIMsgWindow *aMsgWindow, nsIFile *aMailboxPath, nsIStreamListener *aMailboxParser,</span>
<a href="#l131.14"></a><span id="l131.14">                     nsIUrlListener * aUrlListener, nsIURI ** aURL)</span>
<a href="#l131.15"></a><span id="l131.15"> {</span>
<a href="#l131.16"></a><span id="l131.16">   NS_ENSURE_ARG_POINTER(aMailboxPath);</span>
<a href="#l131.17"></a><span id="l131.17"> </span>
<a href="#l131.18"></a><span id="l131.18">   nsresult rv;</span>
<a href="#l131.19"></a><span id="l131.19">   nsCOMPtr&lt;nsIMailboxUrl&gt; mailboxurl =</span>
<a href="#l131.20"></a><span id="l131.20">     do_CreateInstance(NS_MAILBOXURL_CONTRACTID, &amp;rv);</span>
<a href="#l131.21"></a><span id="l131.21">   if (NS_SUCCEEDED(rv) &amp;&amp; mailboxurl)</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l132.1"></a><span id="l132.1" class="difflineminus">--- a/mailnews/local/src/nsMailboxUrl.h</span>
<a href="#l132.2"></a><span id="l132.2" class="difflineplus">+++ b/mailnews/local/src/nsMailboxUrl.h</span>
<a href="#l132.3"></a><span id="l132.3" class="difflineat">@@ -54,17 +54,17 @@ protected:</span>
<a href="#l132.4"></a><span id="l132.4">   virtual nsresult ParseUrl();</span>
<a href="#l132.5"></a><span id="l132.5">   nsresult GetMsgHdrForKey(nsMsgKey  msgKey, nsIMsgDBHdr ** aMsgHdr);</span>
<a href="#l132.6"></a><span id="l132.6"> </span>
<a href="#l132.7"></a><span id="l132.7">   // mailboxurl specific state</span>
<a href="#l132.8"></a><span id="l132.8">   nsCOMPtr&lt;nsIStreamListener&gt; m_mailboxParser;</span>
<a href="#l132.9"></a><span id="l132.9">   nsCOMPtr&lt;nsIStreamListener&gt; m_mailboxCopyHandler;</span>
<a href="#l132.10"></a><span id="l132.10"> </span>
<a href="#l132.11"></a><span id="l132.11">   nsMailboxAction m_mailboxAction; // the action this url represents...parse mailbox, display messages, etc.</span>
<a href="#l132.12"></a><span id="l132.12" class="difflineminus">-  nsCOMPtr &lt;nsILocalFile&gt;  m_filePath;</span>
<a href="#l132.13"></a><span id="l132.13" class="difflineplus">+  nsCOMPtr &lt;nsIFile&gt;  m_filePath;</span>
<a href="#l132.14"></a><span id="l132.14">   char *m_messageID;</span>
<a href="#l132.15"></a><span id="l132.15">   PRUint32 m_messageSize;</span>
<a href="#l132.16"></a><span id="l132.16">   nsMsgKey m_messageKey;</span>
<a href="#l132.17"></a><span id="l132.17">   nsCString m_file;</span>
<a href="#l132.18"></a><span id="l132.18">   // This is currently only set when we're doing something with a .eml file.</span>
<a href="#l132.19"></a><span id="l132.19">   // If that changes, we should change the name of this var.</span>
<a href="#l132.20"></a><span id="l132.20">   nsCOMPtr&lt;nsIMsgDBHdr&gt; m_dummyHdr;</span>
<a href="#l132.21"></a><span id="l132.21"> </span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l133.1"></a><span id="l133.1" class="difflineminus">--- a/mailnews/local/src/nsMovemailService.cpp</span>
<a href="#l133.2"></a><span id="l133.2" class="difflineplus">+++ b/mailnews/local/src/nsMovemailService.cpp</span>
<a href="#l133.3"></a><span id="l133.3" class="difflineat">@@ -19,17 +19,17 @@</span>
<a href="#l133.4"></a><span id="l133.4"> #include &quot;nsIMovemailService.h&quot;</span>
<a href="#l133.5"></a><span id="l133.5"> #include &quot;nsIMsgIncomingServer.h&quot;</span>
<a href="#l133.6"></a><span id="l133.6"> #include &quot;nsIMovemailIncomingServer.h&quot;</span>
<a href="#l133.7"></a><span id="l133.7"> #include &quot;nsIMsgProtocolInfo.h&quot;</span>
<a href="#l133.8"></a><span id="l133.8"> #include &quot;nsParseMailbox.h&quot;</span>
<a href="#l133.9"></a><span id="l133.9"> #include &quot;nsIMsgFolder.h&quot;</span>
<a href="#l133.10"></a><span id="l133.10"> #include &quot;nsIPrompt.h&quot;</span>
<a href="#l133.11"></a><span id="l133.11"> </span>
<a href="#l133.12"></a><span id="l133.12" class="difflineminus">-#include &quot;nsILocalFile.h&quot;</span>
<a href="#l133.13"></a><span id="l133.13" class="difflineplus">+#include &quot;nsIFile.h&quot;</span>
<a href="#l133.14"></a><span id="l133.14"> #include &quot;nsMailDirServiceDefs.h&quot;</span>
<a href="#l133.15"></a><span id="l133.15"> #include &quot;nsMsgUtils.h&quot;</span>
<a href="#l133.16"></a><span id="l133.16"> </span>
<a href="#l133.17"></a><span id="l133.17"> #include &quot;nsMsgLocalCID.h&quot;</span>
<a href="#l133.18"></a><span id="l133.18"> #include &quot;nsMsgBaseCID.h&quot;</span>
<a href="#l133.19"></a><span id="l133.19"> #include &quot;nsCOMPtr.h&quot;</span>
<a href="#l133.20"></a><span id="l133.20"> #include &quot;nsMsgFolderFlags.h&quot;</span>
<a href="#l133.21"></a><span id="l133.21"> </span>
<a href="#l133.22"></a><span id="l133.22" class="difflineat">@@ -137,17 +137,17 @@ bool ObtainSpoolLock(const char *aSpoolN</span>
<a href="#l133.23"></a><span id="l133.23">    * Locking procedures:</span>
<a href="#l133.24"></a><span id="l133.24">    * If the directory is not writable, we want to use the appropriate system</span>
<a href="#l133.25"></a><span id="l133.25">    * utilites to lock the file.</span>
<a href="#l133.26"></a><span id="l133.26">    * If the directory is writable, we want to go through the create-and-link</span>
<a href="#l133.27"></a><span id="l133.27">    * locking procedures to make it atomic for certain networked file systems.</span>
<a href="#l133.28"></a><span id="l133.28">    * This involves creating a .mozlock file and attempting to hard-link it to</span>
<a href="#l133.29"></a><span id="l133.29">    * the customary .lock file.</span>
<a href="#l133.30"></a><span id="l133.30">    */</span>
<a href="#l133.31"></a><span id="l133.31" class="difflineminus">-  nsCOMPtr&lt;nsILocalFile&gt; spoolFile;</span>
<a href="#l133.32"></a><span id="l133.32" class="difflineplus">+  nsCOMPtr&lt;nsIFile&gt; spoolFile;</span>
<a href="#l133.33"></a><span id="l133.33">   nsresult rv = NS_NewNativeLocalFile(nsDependentCString(aSpoolName),</span>
<a href="#l133.34"></a><span id="l133.34">                                       true,</span>
<a href="#l133.35"></a><span id="l133.35">                                       getter_AddRefs(spoolFile));</span>
<a href="#l133.36"></a><span id="l133.36">   NS_ENSURE_SUCCESS(rv, false);</span>
<a href="#l133.37"></a><span id="l133.37"> </span>
<a href="#l133.38"></a><span id="l133.38">   nsCOMPtr&lt;nsIFile&gt; directory;</span>
<a href="#l133.39"></a><span id="l133.39">   rv = spoolFile-&gt;GetParent(getter_AddRefs(directory));</span>
<a href="#l133.40"></a><span id="l133.40">   NS_ENSURE_SUCCESS(rv, false);</span>
<a href="#l133.41"></a><span id="l133.41" class="difflineat">@@ -191,18 +191,18 @@ bool ObtainSpoolLock(const char *aSpoolN</span>
<a href="#l133.42"></a><span id="l133.42">   // (step 2a not yet implemented)</span>
<a href="#l133.43"></a><span id="l133.43"> </span>
<a href="#l133.44"></a><span id="l133.44"> </span>
<a href="#l133.45"></a><span id="l133.45">   nsCAutoString mozlockstr(aSpoolName);</span>
<a href="#l133.46"></a><span id="l133.46">   mozlockstr.Append(&quot;.mozlock&quot;);</span>
<a href="#l133.47"></a><span id="l133.47">   nsCAutoString lockstr(aSpoolName);</span>
<a href="#l133.48"></a><span id="l133.48">   lockstr.Append(&quot;.lock&quot;);</span>
<a href="#l133.49"></a><span id="l133.49"> </span>
<a href="#l133.50"></a><span id="l133.50" class="difflineminus">-  // Create nsILocalFile for the spool.mozlock file</span>
<a href="#l133.51"></a><span id="l133.51" class="difflineminus">-  nsCOMPtr&lt;nsILocalFile&gt; tmplocfile;</span>
<a href="#l133.52"></a><span id="l133.52" class="difflineplus">+  // Create nsIFile for the spool.mozlock file</span>
<a href="#l133.53"></a><span id="l133.53" class="difflineplus">+  nsCOMPtr&lt;nsIFile&gt; tmplocfile;</span>
<a href="#l133.54"></a><span id="l133.54">   rv = NS_NewNativeLocalFile(mozlockstr, true, getter_AddRefs(tmplocfile));</span>
<a href="#l133.55"></a><span id="l133.55">   if (NS_FAILED(rv))</span>
<a href="#l133.56"></a><span id="l133.56">     return false;</span>
<a href="#l133.57"></a><span id="l133.57">   // THOUGHT: hmm, perhaps use MakeUnique to generate us a unique mozlock?</span>
<a href="#l133.58"></a><span id="l133.58">   // ... perhaps not, MakeUnique implementation looks racey -- use mktemp()?</span>
<a href="#l133.59"></a><span id="l133.59"> </span>
<a href="#l133.60"></a><span id="l133.60">   // step 1: create SPOOLNAME.mozlock</span>
<a href="#l133.61"></a><span id="l133.61">   rv = tmplocfile-&gt;Create(nsIFile::NORMAL_FILE_TYPE, 0666);</span>
<a href="#l133.62"></a><span id="l133.62" class="difflineat">@@ -248,17 +248,17 @@ bool ObtainSpoolLock(const char *aSpoolN</span>
<a href="#l133.63"></a><span id="l133.63"> </span>
<a href="#l133.64"></a><span id="l133.64"> // Remove our mail-spool-file lock (n.b. we should only try this if</span>
<a href="#l133.65"></a><span id="l133.65"> // we're the ones who made the lock in the first place!)</span>
<a href="#l133.66"></a><span id="l133.66"> bool YieldSpoolLock(const char *aSpoolName, bool aUsingLockFile)</span>
<a href="#l133.67"></a><span id="l133.67"> {</span>
<a href="#l133.68"></a><span id="l133.68">   LOG((&quot;YieldSpoolLock(%s)&quot;, aSpoolName));</span>
<a href="#l133.69"></a><span id="l133.69"> </span>
<a href="#l133.70"></a><span id="l133.70">   if (!aUsingLockFile) {</span>
<a href="#l133.71"></a><span id="l133.71" class="difflineminus">-    nsCOMPtr&lt;nsILocalFile&gt; spoolFile;</span>
<a href="#l133.72"></a><span id="l133.72" class="difflineplus">+    nsCOMPtr&lt;nsIFile&gt; spoolFile;</span>
<a href="#l133.73"></a><span id="l133.73">     nsresult rv = NS_NewNativeLocalFile(nsDependentCString(aSpoolName),</span>
<a href="#l133.74"></a><span id="l133.74">                                         true,</span>
<a href="#l133.75"></a><span id="l133.75">                                         getter_AddRefs(spoolFile));</span>
<a href="#l133.76"></a><span id="l133.76">     NS_ENSURE_SUCCESS(rv, false);</span>
<a href="#l133.77"></a><span id="l133.77"> </span>
<a href="#l133.78"></a><span id="l133.78">     PRFileDesc *fd;</span>
<a href="#l133.79"></a><span id="l133.79">     rv = spoolFile-&gt;OpenNSPRFileDesc(PR_RDWR, 0, &amp;fd);</span>
<a href="#l133.80"></a><span id="l133.80">     NS_ENSURE_SUCCESS(rv, false);</span>
<a href="#l133.81"></a><span id="l133.81" class="difflineat">@@ -270,18 +270,18 @@ bool YieldSpoolLock(const char *aSpoolNa</span>
<a href="#l133.82"></a><span id="l133.82">     return unlockSucceeded;</span>
<a href="#l133.83"></a><span id="l133.83">   }</span>
<a href="#l133.84"></a><span id="l133.84"> </span>
<a href="#l133.85"></a><span id="l133.85">   nsCAutoString lockstr(aSpoolName);</span>
<a href="#l133.86"></a><span id="l133.86">   lockstr.Append(&quot;.lock&quot;);</span>
<a href="#l133.87"></a><span id="l133.87"> </span>
<a href="#l133.88"></a><span id="l133.88">   nsresult rv;</span>
<a href="#l133.89"></a><span id="l133.89"> </span>
<a href="#l133.90"></a><span id="l133.90" class="difflineminus">-  // Create nsILocalFile for the spool.lock file</span>
<a href="#l133.91"></a><span id="l133.91" class="difflineminus">-  nsCOMPtr&lt;nsILocalFile&gt; locklocfile;</span>
<a href="#l133.92"></a><span id="l133.92" class="difflineplus">+  // Create nsIFile for the spool.lock file</span>
<a href="#l133.93"></a><span id="l133.93" class="difflineplus">+  nsCOMPtr&lt;nsIFile&gt; locklocfile;</span>
<a href="#l133.94"></a><span id="l133.94">   rv = NS_NewNativeLocalFile(lockstr, true, getter_AddRefs(locklocfile));</span>
<a href="#l133.95"></a><span id="l133.95">   if (NS_FAILED(rv))</span>
<a href="#l133.96"></a><span id="l133.96">     return false;</span>
<a href="#l133.97"></a><span id="l133.97"> </span>
<a href="#l133.98"></a><span id="l133.98">   // Check if the lock file exists</span>
<a href="#l133.99"></a><span id="l133.99">   bool exists;</span>
<a href="#l133.100"></a><span id="l133.100">   rv = locklocfile-&gt;Exists(&amp;exists);</span>
<a href="#l133.101"></a><span id="l133.101">   if (NS_FAILED(rv))</span>
<a href="#l133.102"></a><span id="l133.102" class="difflineat">@@ -301,17 +301,17 @@ bool YieldSpoolLock(const char *aSpoolNa</span>
<a href="#l133.103"></a><span id="l133.103"> }</span>
<a href="#l133.104"></a><span id="l133.104"> </span>
<a href="#l133.105"></a><span id="l133.105"> static nsresult</span>
<a href="#l133.106"></a><span id="l133.106"> LocateSpoolFile(nsACString &amp; spoolPath)</span>
<a href="#l133.107"></a><span id="l133.107"> {</span>
<a href="#l133.108"></a><span id="l133.108">   bool isFile;</span>
<a href="#l133.109"></a><span id="l133.109">   nsresult rv;</span>
<a href="#l133.110"></a><span id="l133.110"> </span>
<a href="#l133.111"></a><span id="l133.111" class="difflineminus">-  nsCOMPtr&lt;nsILocalFile&gt; spoolFile;</span>
<a href="#l133.112"></a><span id="l133.112" class="difflineplus">+  nsCOMPtr&lt;nsIFile&gt; spoolFile;</span>
<a href="#l133.113"></a><span id="l133.113">   rv = NS_NewNativeLocalFile(EmptyCString(), true, getter_AddRefs(spoolFile));</span>
<a href="#l133.114"></a><span id="l133.114">   NS_ENSURE_SUCCESS(rv, rv);</span>
<a href="#l133.115"></a><span id="l133.115"> </span>
<a href="#l133.116"></a><span id="l133.116">   char * mailEnv = PR_GetEnv(&quot;MAIL&quot;);</span>
<a href="#l133.117"></a><span id="l133.117">   char * userEnv = PR_GetEnv(&quot;USER&quot;);</span>
<a href="#l133.118"></a><span id="l133.118">   if (!userEnv)</span>
<a href="#l133.119"></a><span id="l133.119">     userEnv = PR_GetEnv(&quot;USERNAME&quot;);</span>
<a href="#l133.120"></a><span id="l133.120"> </span>
<a href="#l133.121"></a><span id="l133.121" class="difflineat">@@ -365,17 +365,17 @@ nsMovemailService::GetNewMail(nsIMsgWind</span>
<a href="#l133.122"></a><span id="l133.122">   if (spoolPath.IsEmpty())</span>
<a href="#l133.123"></a><span id="l133.123">     rv = LocateSpoolFile(spoolPath);</span>
<a href="#l133.124"></a><span id="l133.124">   if (NS_FAILED(rv) || spoolPath.IsEmpty()) {</span>
<a href="#l133.125"></a><span id="l133.125">     Error(MOVEMAIL_SPOOL_FILE_NOT_FOUND, nsnull, 0);</span>
<a href="#l133.126"></a><span id="l133.126">     return NS_ERROR_FAILURE;</span>
<a href="#l133.127"></a><span id="l133.127">   }</span>
<a href="#l133.128"></a><span id="l133.128"> </span>
<a href="#l133.129"></a><span id="l133.129">   // Create an input stream for the spool file</span>
<a href="#l133.130"></a><span id="l133.130" class="difflineminus">-  nsCOMPtr&lt;nsILocalFile&gt; spoolFile;</span>
<a href="#l133.131"></a><span id="l133.131" class="difflineplus">+  nsCOMPtr&lt;nsIFile&gt; spoolFile;</span>
<a href="#l133.132"></a><span id="l133.132">   rv = NS_NewNativeLocalFile(spoolPath, true, getter_AddRefs(spoolFile));</span>
<a href="#l133.133"></a><span id="l133.133">   NS_ENSURE_SUCCESS(rv, rv);</span>
<a href="#l133.134"></a><span id="l133.134">   nsCOMPtr&lt;nsIInputStream&gt; spoolInputStream;</span>
<a href="#l133.135"></a><span id="l133.135">   rv = NS_NewLocalFileInputStream(getter_AddRefs(spoolInputStream), spoolFile);</span>
<a href="#l133.136"></a><span id="l133.136">   if (NS_FAILED(rv)) {</span>
<a href="#l133.137"></a><span id="l133.137">     const PRUnichar *params[] = {</span>
<a href="#l133.138"></a><span id="l133.138">       NS_ConvertUTF8toUTF16(spoolPath).get()</span>
<a href="#l133.139"></a><span id="l133.139">     };</span>
<a href="#l133.140"></a><span id="l133.140" class="difflineat">@@ -503,31 +503,31 @@ nsMovemailService::GetNewMail(nsIMsgWind</span>
<a href="#l133.141"></a><span id="l133.141">   in_server-&gt;SetServerBusy(false);</span>
<a href="#l133.142"></a><span id="l133.142"> </span>
<a href="#l133.143"></a><span id="l133.143">   LOG((&quot;GetNewMail returning rv=%d&quot;, rv));</span>
<a href="#l133.144"></a><span id="l133.144">   return rv;</span>
<a href="#l133.145"></a><span id="l133.145"> }</span>
<a href="#l133.146"></a><span id="l133.146"> </span>
<a href="#l133.147"></a><span id="l133.147"> </span>
<a href="#l133.148"></a><span id="l133.148"> NS_IMETHODIMP</span>
<a href="#l133.149"></a><span id="l133.149" class="difflineminus">-nsMovemailService::SetDefaultLocalPath(nsILocalFile *aPath)</span>
<a href="#l133.150"></a><span id="l133.150" class="difflineplus">+nsMovemailService::SetDefaultLocalPath(nsIFile *aPath)</span>
<a href="#l133.151"></a><span id="l133.151"> {</span>
<a href="#l133.152"></a><span id="l133.152">   NS_ENSURE_ARG(aPath);</span>
<a href="#l133.153"></a><span id="l133.153">   return NS_SetPersistentFile(PREF_MAIL_ROOT_MOVEMAIL_REL, PREF_MAIL_ROOT_MOVEMAIL, aPath);</span>
<a href="#l133.154"></a><span id="l133.154"> }</span>
<a href="#l133.155"></a><span id="l133.155"> </span>
<a href="#l133.156"></a><span id="l133.156"> NS_IMETHODIMP</span>
<a href="#l133.157"></a><span id="l133.157" class="difflineminus">-nsMovemailService::GetDefaultLocalPath(nsILocalFile ** aResult)</span>
<a href="#l133.158"></a><span id="l133.158" class="difflineplus">+nsMovemailService::GetDefaultLocalPath(nsIFile ** aResult)</span>
<a href="#l133.159"></a><span id="l133.159"> {</span>
<a href="#l133.160"></a><span id="l133.160">   NS_ENSURE_ARG_POINTER(aResult);</span>
<a href="#l133.161"></a><span id="l133.161">   *aResult = nsnull;</span>
<a href="#l133.162"></a><span id="l133.162"> </span>
<a href="#l133.163"></a><span id="l133.163">   nsresult rv;</span>
<a href="#l133.164"></a><span id="l133.164">   bool havePref;</span>
<a href="#l133.165"></a><span id="l133.165" class="difflineminus">-  nsCOMPtr&lt;nsILocalFile&gt; localFile;</span>
<a href="#l133.166"></a><span id="l133.166" class="difflineplus">+  nsCOMPtr&lt;nsIFile&gt; localFile;</span>
<a href="#l133.167"></a><span id="l133.167">   rv = NS_GetPersistentFile(PREF_MAIL_ROOT_MOVEMAIL_REL,</span>
<a href="#l133.168"></a><span id="l133.168">                             PREF_MAIL_ROOT_MOVEMAIL,</span>
<a href="#l133.169"></a><span id="l133.169">                             NS_APP_MAIL_50_DIR,</span>
<a href="#l133.170"></a><span id="l133.170">                             havePref,</span>
<a href="#l133.171"></a><span id="l133.171">                             getter_AddRefs(localFile));</span>
<a href="#l133.172"></a><span id="l133.172">   if (NS_FAILED(rv)) return rv;</span>
<a href="#l133.173"></a><span id="l133.173"> </span>
<a href="#l133.174"></a><span id="l133.174">   bool exists;</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l134.1"></a><span id="l134.1" class="difflineminus">--- a/mailnews/local/src/nsMsgBrkMBoxStore.cpp</span>
<a href="#l134.2"></a><span id="l134.2" class="difflineplus">+++ b/mailnews/local/src/nsMsgBrkMBoxStore.cpp</span>
<a href="#l134.3"></a><span id="l134.3" class="difflineat">@@ -50,17 +50,17 @@ NS_IMPL_ISUPPORTS1(nsMsgBrkMBoxStore, ns</span>
<a href="#l134.4"></a><span id="l134.4"> NS_IMETHODIMP nsMsgBrkMBoxStore::DiscoverSubFolders(nsIMsgFolder *aParentFolder,</span>
<a href="#l134.5"></a><span id="l134.5">                                                     bool aDeep)</span>
<a href="#l134.6"></a><span id="l134.6"> {</span>
<a href="#l134.7"></a><span id="l134.7">   NS_ENSURE_ARG_POINTER(aParentFolder);</span>
<a href="#l134.8"></a><span id="l134.8">   bool isServer;</span>
<a href="#l134.9"></a><span id="l134.9">   nsresult rv = aParentFolder-&gt;GetIsServer(&amp;isServer);</span>
<a href="#l134.10"></a><span id="l134.10">   NS_ENSURE_SUCCESS(rv, rv);</span>
<a href="#l134.11"></a><span id="l134.11"> </span>
<a href="#l134.12"></a><span id="l134.12" class="difflineminus">-  nsCOMPtr&lt;nsILocalFile&gt; path;</span>
<a href="#l134.13"></a><span id="l134.13" class="difflineplus">+  nsCOMPtr&lt;nsIFile&gt; path;</span>
<a href="#l134.14"></a><span id="l134.14">   rv = aParentFolder-&gt;GetFilePath(getter_AddRefs(path));</span>
<a href="#l134.15"></a><span id="l134.15">   if (NS_FAILED(rv))</span>
<a href="#l134.16"></a><span id="l134.16">     return rv;</span>
<a href="#l134.17"></a><span id="l134.17"> </span>
<a href="#l134.18"></a><span id="l134.18">   bool exists, directory;</span>
<a href="#l134.19"></a><span id="l134.19">   path-&gt;Exists(&amp;exists);</span>
<a href="#l134.20"></a><span id="l134.20">   if (!exists)</span>
<a href="#l134.21"></a><span id="l134.21">     path-&gt;Create(nsIFile::DIRECTORY_TYPE, 0755);</span>
<a href="#l134.22"></a><span id="l134.22" class="difflineat">@@ -114,17 +114,17 @@ NS_IMETHODIMP nsMsgBrkMBoxStore::Discove</span>
<a href="#l134.23"></a><span id="l134.23">   }</span>
<a href="#l134.24"></a><span id="l134.24">   return rv;</span>
<a href="#l134.25"></a><span id="l134.25"> }</span>
<a href="#l134.26"></a><span id="l134.26"> </span>
<a href="#l134.27"></a><span id="l134.27"> NS_IMETHODIMP nsMsgBrkMBoxStore::CreateFolder(nsIMsgFolder *aParent,</span>
<a href="#l134.28"></a><span id="l134.28">                                               const nsAString &amp;aFolderName,</span>
<a href="#l134.29"></a><span id="l134.29">                                               nsIMsgFolder **aResult)</span>
<a href="#l134.30"></a><span id="l134.30"> {</span>
<a href="#l134.31"></a><span id="l134.31" class="difflineminus">-  nsCOMPtr&lt;nsILocalFile&gt; path;</span>
<a href="#l134.32"></a><span id="l134.32" class="difflineplus">+  nsCOMPtr&lt;nsIFile&gt; path;</span>
<a href="#l134.33"></a><span id="l134.33">   nsCOMPtr&lt;nsIMsgFolder&gt; child;</span>
<a href="#l134.34"></a><span id="l134.34">   nsresult rv = aParent-&gt;GetFilePath(getter_AddRefs(path));</span>
<a href="#l134.35"></a><span id="l134.35">   if (NS_FAILED(rv))</span>
<a href="#l134.36"></a><span id="l134.36">     return rv;</span>
<a href="#l134.37"></a><span id="l134.37">   //Get a directory based on our current path.</span>
<a href="#l134.38"></a><span id="l134.38">   rv = CreateDirectoryForFolder(path);</span>
<a href="#l134.39"></a><span id="l134.39">   if (NS_FAILED(rv))</span>
<a href="#l134.40"></a><span id="l134.40">     return rv;</span>
<a href="#l134.41"></a><span id="l134.41" class="difflineat">@@ -179,23 +179,23 @@ NS_IMETHODIMP nsMsgBrkMBoxStore::CreateF</span>
<a href="#l134.42"></a><span id="l134.42">       rv = NS_MSG_CANT_CREATE_FOLDER;</span>
<a href="#l134.43"></a><span id="l134.43">     }</span>
<a href="#l134.44"></a><span id="l134.44">   }</span>
<a href="#l134.45"></a><span id="l134.45">   child.forget(aResult);</span>
<a href="#l134.46"></a><span id="l134.46">   return rv;</span>
<a href="#l134.47"></a><span id="l134.47"> }</span>
<a href="#l134.48"></a><span id="l134.48"> </span>
<a href="#l134.49"></a><span id="l134.49"> NS_IMETHODIMP nsMsgBrkMBoxStore::GetSummaryFile(nsIMsgFolder *aFolder,</span>
<a href="#l134.50"></a><span id="l134.50" class="difflineminus">-                                                nsILocalFile **aSummaryFile)</span>
<a href="#l134.51"></a><span id="l134.51" class="difflineplus">+                                                nsIFile **aSummaryFile)</span>
<a href="#l134.52"></a><span id="l134.52"> {</span>
<a href="#l134.53"></a><span id="l134.53">   NS_ENSURE_ARG_POINTER(aFolder);</span>
<a href="#l134.54"></a><span id="l134.54">   NS_ENSURE_ARG_POINTER(aSummaryFile);</span>
<a href="#l134.55"></a><span id="l134.55"> </span>
<a href="#l134.56"></a><span id="l134.56">   nsresult rv;</span>
<a href="#l134.57"></a><span id="l134.57" class="difflineminus">-  nsCOMPtr&lt;nsILocalFile&gt; newSummaryLocation;</span>
<a href="#l134.58"></a><span id="l134.58" class="difflineplus">+  nsCOMPtr&lt;nsIFile&gt; newSummaryLocation;</span>
<a href="#l134.59"></a><span id="l134.59">   rv = aFolder-&gt;GetFilePath(getter_AddRefs(newSummaryLocation));</span>
<a href="#l134.60"></a><span id="l134.60">   NS_ENSURE_SUCCESS(rv, rv);</span>
<a href="#l134.61"></a><span id="l134.61"> </span>
<a href="#l134.62"></a><span id="l134.62">   nsString fileName;</span>
<a href="#l134.63"></a><span id="l134.63"> </span>
<a href="#l134.64"></a><span id="l134.64">   rv = newSummaryLocation-&gt;GetLeafName(fileName);</span>
<a href="#l134.65"></a><span id="l134.65">   if (NS_FAILED(rv))</span>
<a href="#l134.66"></a><span id="l134.66">     return rv;</span>
<a href="#l134.67"></a><span id="l134.67" class="difflineat">@@ -210,17 +210,17 @@ NS_IMETHODIMP nsMsgBrkMBoxStore::GetSumm</span>
<a href="#l134.68"></a><span id="l134.68"> </span>
<a href="#l134.69"></a><span id="l134.69"> // Get the current attributes of the mbox file, corrected for caching</span>
<a href="#l134.70"></a><span id="l134.70"> void nsMsgBrkMBoxStore::GetMailboxModProperties(nsIMsgFolder *aFolder,</span>
<a href="#l134.71"></a><span id="l134.71">                                                 PRInt64 *aSize, PRUint32 *aDate)</span>
<a href="#l134.72"></a><span id="l134.72"> {</span>
<a href="#l134.73"></a><span id="l134.73">   // We'll simply return 0 on errors.</span>
<a href="#l134.74"></a><span id="l134.74">   *aDate = 0;</span>
<a href="#l134.75"></a><span id="l134.75">   *aSize = 0;</span>
<a href="#l134.76"></a><span id="l134.76" class="difflineminus">-  nsCOMPtr&lt;nsILocalFile&gt; pathFile;</span>
<a href="#l134.77"></a><span id="l134.77" class="difflineplus">+  nsCOMPtr&lt;nsIFile&gt; pathFile;</span>
<a href="#l134.78"></a><span id="l134.78">   nsresult rv = aFolder-&gt;GetFilePath(getter_AddRefs(pathFile));</span>
<a href="#l134.79"></a><span id="l134.79">   NS_ENSURE_SUCCESS(rv, );</span>
<a href="#l134.80"></a><span id="l134.80"> </span>
<a href="#l134.81"></a><span id="l134.81">   rv = pathFile-&gt;GetFileSize(aSize);</span>
<a href="#l134.82"></a><span id="l134.82">   if (NS_FAILED(rv))</span>
<a href="#l134.83"></a><span id="l134.83">     return;</span>
<a href="#l134.84"></a><span id="l134.84"> </span>
<a href="#l134.85"></a><span id="l134.85">   PRInt64 lastModTime;</span>
<a href="#l134.86"></a><span id="l134.86" class="difflineat">@@ -232,17 +232,17 @@ void nsMsgBrkMBoxStore::GetMailboxModPro</span>
<a href="#l134.87"></a><span id="l134.87"> }</span>
<a href="#l134.88"></a><span id="l134.88"> </span>
<a href="#l134.89"></a><span id="l134.89"> NS_IMETHODIMP nsMsgBrkMBoxStore::HasSpaceAvailable(nsIMsgFolder *aFolder,</span>
<a href="#l134.90"></a><span id="l134.90">                                                    PRInt64 aSpaceRequested,</span>
<a href="#l134.91"></a><span id="l134.91">                                                    bool *aResult)</span>
<a href="#l134.92"></a><span id="l134.92"> {</span>
<a href="#l134.93"></a><span id="l134.93">   NS_ENSURE_ARG_POINTER(aResult);</span>
<a href="#l134.94"></a><span id="l134.94">   NS_ENSURE_ARG_POINTER(aFolder);</span>
<a href="#l134.95"></a><span id="l134.95" class="difflineminus">-  nsCOMPtr&lt;nsILocalFile&gt; pathFile;</span>
<a href="#l134.96"></a><span id="l134.96" class="difflineplus">+  nsCOMPtr&lt;nsIFile&gt; pathFile;</span>
<a href="#l134.97"></a><span id="l134.97">   nsresult rv = aFolder-&gt;GetFilePath(getter_AddRefs(pathFile));</span>
<a href="#l134.98"></a><span id="l134.98">   NS_ENSURE_SUCCESS(rv, rv);</span>
<a href="#l134.99"></a><span id="l134.99">   PRInt64 fileSize;</span>
<a href="#l134.100"></a><span id="l134.100">   rv = pathFile-&gt;GetFileSize(&amp;fileSize);</span>
<a href="#l134.101"></a><span id="l134.101">   NS_ENSURE_SUCCESS(rv, rv);</span>
<a href="#l134.102"></a><span id="l134.102">   // ### I think we're allowing mailboxes &gt; 4GB, so we should be checking</span>
<a href="#l134.103"></a><span id="l134.103">   // for disk space here, not total file size.</span>
<a href="#l134.104"></a><span id="l134.104">   // 0xFFC00000 = 4 GiB - 4 MiB.</span>
<a href="#l134.105"></a><span id="l134.105" class="difflineat">@@ -263,17 +263,17 @@ NS_IMETHODIMP nsMsgBrkMBoxStore::IsSumma</span>
<a href="#l134.106"></a><span id="l134.106">   // We only check local folders for db validity.</span>
<a href="#l134.107"></a><span id="l134.107">   nsCOMPtr&lt;nsIMsgLocalMailFolder&gt; localFolder(do_QueryInterface(aFolder));</span>
<a href="#l134.108"></a><span id="l134.108">   if (!localFolder)</span>
<a href="#l134.109"></a><span id="l134.109">   {</span>
<a href="#l134.110"></a><span id="l134.110">     *aResult = true;</span>
<a href="#l134.111"></a><span id="l134.111">     return NS_OK;</span>
<a href="#l134.112"></a><span id="l134.112">   }</span>
<a href="#l134.113"></a><span id="l134.113"> </span>
<a href="#l134.114"></a><span id="l134.114" class="difflineminus">-  nsCOMPtr&lt;nsILocalFile&gt; pathFile;</span>
<a href="#l134.115"></a><span id="l134.115" class="difflineplus">+  nsCOMPtr&lt;nsIFile&gt; pathFile;</span>
<a href="#l134.116"></a><span id="l134.116">   nsresult rv = aFolder-&gt;GetFilePath(getter_AddRefs(pathFile));</span>
<a href="#l134.117"></a><span id="l134.117">   NS_ENSURE_SUCCESS(rv, rv);</span>
<a href="#l134.118"></a><span id="l134.118">   nsCOMPtr&lt;nsIDBFolderInfo&gt; folderInfo;</span>
<a href="#l134.119"></a><span id="l134.119">   rv = aDB-&gt;GetDBFolderInfo(getter_AddRefs(folderInfo));</span>
<a href="#l134.120"></a><span id="l134.120">   NS_ENSURE_SUCCESS(rv, rv);</span>
<a href="#l134.121"></a><span id="l134.121">   PRUint64 folderSize;</span>
<a href="#l134.122"></a><span id="l134.122">   PRUint32 folderDate;</span>
<a href="#l134.123"></a><span id="l134.123">   PRInt32 numUnreadMessages;</span>
<a href="#l134.124"></a><span id="l134.124" class="difflineat">@@ -319,17 +319,17 @@ NS_IMETHODIMP nsMsgBrkMBoxStore::SetSumm</span>
<a href="#l134.125"></a><span id="l134.125"> {</span>
<a href="#l134.126"></a><span id="l134.126">   NS_ENSURE_ARG_POINTER(aFolder);</span>
<a href="#l134.127"></a><span id="l134.127">   NS_ENSURE_ARG_POINTER(aDB);</span>
<a href="#l134.128"></a><span id="l134.128">   // We only need to do this for local folders.</span>
<a href="#l134.129"></a><span id="l134.129">   nsCOMPtr&lt;nsIMsgLocalMailFolder&gt; localFolder(do_QueryInterface(aFolder));</span>
<a href="#l134.130"></a><span id="l134.130">   if (!localFolder)</span>
<a href="#l134.131"></a><span id="l134.131">     return NS_OK;</span>
<a href="#l134.132"></a><span id="l134.132"> </span>
<a href="#l134.133"></a><span id="l134.133" class="difflineminus">-  nsCOMPtr&lt;nsILocalFile&gt; pathFile;</span>
<a href="#l134.134"></a><span id="l134.134" class="difflineplus">+  nsCOMPtr&lt;nsIFile&gt; pathFile;</span>
<a href="#l134.135"></a><span id="l134.135">   nsresult rv = aFolder-&gt;GetFilePath(getter_AddRefs(pathFile));</span>
<a href="#l134.136"></a><span id="l134.136">   NS_ENSURE_SUCCESS(rv, rv);</span>
<a href="#l134.137"></a><span id="l134.137">   nsCOMPtr&lt;nsIDBFolderInfo&gt; folderInfo;</span>
<a href="#l134.138"></a><span id="l134.138">   rv = aDB-&gt;GetDBFolderInfo(getter_AddRefs(folderInfo));</span>
<a href="#l134.139"></a><span id="l134.139">   NS_ENSURE_SUCCESS(rv, rv);</span>
<a href="#l134.140"></a><span id="l134.140">   bool exists;</span>
<a href="#l134.141"></a><span id="l134.141">   pathFile-&gt;Exists(&amp;exists);</span>
<a href="#l134.142"></a><span id="l134.142">   if (!exists)</span>
<a href="#l134.143"></a><span id="l134.143" class="difflineat">@@ -350,17 +350,17 @@ NS_IMETHODIMP nsMsgBrkMBoxStore::SetSumm</span>
<a href="#l134.144"></a><span id="l134.144">   aDB-&gt;Commit(nsMsgDBCommitType::kLargeCommit);</span>
<a href="#l134.145"></a><span id="l134.145">   return rv;</span>
<a href="#l134.146"></a><span id="l134.146"> }</span>
<a href="#l134.147"></a><span id="l134.147"> </span>
<a href="#l134.148"></a><span id="l134.148"> NS_IMETHODIMP nsMsgBrkMBoxStore::DeleteFolder(nsIMsgFolder *aFolder)</span>
<a href="#l134.149"></a><span id="l134.149"> {</span>
<a href="#l134.150"></a><span id="l134.150">   NS_ENSURE_ARG_POINTER(aFolder);</span>
<a href="#l134.151"></a><span id="l134.151">   //Delete mailbox</span>
<a href="#l134.152"></a><span id="l134.152" class="difflineminus">-  nsCOMPtr&lt;nsILocalFile&gt; pathFile;</span>
<a href="#l134.153"></a><span id="l134.153" class="difflineplus">+  nsCOMPtr&lt;nsIFile&gt; pathFile;</span>
<a href="#l134.154"></a><span id="l134.154">   nsresult rv = aFolder-&gt;GetFilePath(getter_AddRefs(pathFile));</span>
<a href="#l134.155"></a><span id="l134.155">   NS_ENSURE_SUCCESS(rv, rv);</span>
<a href="#l134.156"></a><span id="l134.156"> </span>
<a href="#l134.157"></a><span id="l134.157">   pathFile-&gt;Remove(false);</span>
<a href="#l134.158"></a><span id="l134.158"> </span>
<a href="#l134.159"></a><span id="l134.159">   bool isDirectory = false;</span>
<a href="#l134.160"></a><span id="l134.160">   pathFile-&gt;IsDirectory(&amp;isDirectory);</span>
<a href="#l134.161"></a><span id="l134.161">   if (!isDirectory)</span>
<a href="#l134.162"></a><span id="l134.162" class="difflineat">@@ -383,49 +383,48 @@ NS_IMETHODIMP nsMsgBrkMBoxStore::RenameF</span>
<a href="#l134.163"></a><span id="l134.163">   NS_ENSURE_ARG_POINTER(aFolder);</span>
<a href="#l134.164"></a><span id="l134.164">   NS_ENSURE_ARG_POINTER(aNewFolder);</span>
<a href="#l134.165"></a><span id="l134.165"> </span>
<a href="#l134.166"></a><span id="l134.166">   PRUint32 numChildren;</span>
<a href="#l134.167"></a><span id="l134.167">   aFolder-&gt;GetNumSubFolders(&amp;numChildren);</span>
<a href="#l134.168"></a><span id="l134.168">   nsString existingName;</span>
<a href="#l134.169"></a><span id="l134.169">   aFolder-&gt;GetName(existingName);</span>
<a href="#l134.170"></a><span id="l134.170"> </span>
<a href="#l134.171"></a><span id="l134.171" class="difflineminus">-  nsCOMPtr&lt;nsILocalFile&gt; oldPathFile;</span>
<a href="#l134.172"></a><span id="l134.172" class="difflineplus">+  nsCOMPtr&lt;nsIFile&gt; oldPathFile;</span>
<a href="#l134.173"></a><span id="l134.173">   nsresult rv = aFolder-&gt;GetFilePath(getter_AddRefs(oldPathFile));</span>
<a href="#l134.174"></a><span id="l134.174">   if (NS_FAILED(rv))</span>
<a href="#l134.175"></a><span id="l134.175">     return rv;</span>
<a href="#l134.176"></a><span id="l134.176"> </span>
<a href="#l134.177"></a><span id="l134.177">   nsCOMPtr&lt;nsIMsgFolder&gt; parentFolder;</span>
<a href="#l134.178"></a><span id="l134.178">   rv = aFolder-&gt;GetParent(getter_AddRefs(parentFolder));</span>
<a href="#l134.179"></a><span id="l134.179">   if (!parentFolder)</span>
<a href="#l134.180"></a><span id="l134.180">     return NS_ERROR_NULL_POINTER;</span>
<a href="#l134.181"></a><span id="l134.181"> </span>
<a href="#l134.182"></a><span id="l134.182">   nsCOMPtr&lt;nsISupports&gt; parentSupport = do_QueryInterface(parentFolder);</span>
<a href="#l134.183"></a><span id="l134.183"> </span>
<a href="#l134.184"></a><span id="l134.184" class="difflineminus">-  nsCOMPtr&lt;nsILocalFile&gt; oldSummaryFile;</span>
<a href="#l134.185"></a><span id="l134.185" class="difflineplus">+  nsCOMPtr&lt;nsIFile&gt; oldSummaryFile;</span>
<a href="#l134.186"></a><span id="l134.186">   rv = GetSummaryFile(aFolder, getter_AddRefs(oldSummaryFile));</span>
<a href="#l134.187"></a><span id="l134.187">   NS_ENSURE_SUCCESS(rv, rv);</span>
<a href="#l134.188"></a><span id="l134.188"> </span>
<a href="#l134.189"></a><span id="l134.189">   nsCOMPtr&lt;nsIFile&gt; dirFile;</span>
<a href="#l134.190"></a><span id="l134.190">   oldPathFile-&gt;Clone(getter_AddRefs(dirFile));</span>
<a href="#l134.191"></a><span id="l134.191" class="difflineminus">-  nsCOMPtr&lt;nsILocalFile&gt; localDirFile(do_QueryInterface(dirFile));</span>
<a href="#l134.192"></a><span id="l134.192"> </span>
<a href="#l134.193"></a><span id="l134.193">   if (numChildren &gt; 0)</span>
<a href="#l134.194"></a><span id="l134.194">   {</span>
<a href="#l134.195"></a><span id="l134.195" class="difflineminus">-    rv = CreateDirectoryForFolder(localDirFile);</span>
<a href="#l134.196"></a><span id="l134.196" class="difflineplus">+    rv = CreateDirectoryForFolder(dirFile);</span>
<a href="#l134.197"></a><span id="l134.197">     NS_ENSURE_SUCCESS(rv, rv);</span>
<a href="#l134.198"></a><span id="l134.198">   }</span>
<a href="#l134.199"></a><span id="l134.199"> </span>
<a href="#l134.200"></a><span id="l134.200">   nsAutoString safeName(aNewName);</span>
<a href="#l134.201"></a><span id="l134.201">   NS_MsgHashIfNecessary(safeName);</span>
<a href="#l134.202"></a><span id="l134.202"> </span>
<a href="#l134.203"></a><span id="l134.203">   nsCAutoString oldLeafName;</span>
<a href="#l134.204"></a><span id="l134.204">   oldPathFile-&gt;GetNativeLeafName(oldLeafName);</span>
<a href="#l134.205"></a><span id="l134.205"> </span>
<a href="#l134.206"></a><span id="l134.206" class="difflineminus">-  nsCOMPtr&lt;nsILocalFile&gt; parentPathFile;</span>
<a href="#l134.207"></a><span id="l134.207" class="difflineplus">+  nsCOMPtr&lt;nsIFile&gt; parentPathFile;</span>
<a href="#l134.208"></a><span id="l134.208">   parentFolder-&gt;GetFilePath(getter_AddRefs(parentPathFile));</span>
<a href="#l134.209"></a><span id="l134.209">   NS_ENSURE_SUCCESS(rv,rv);</span>
<a href="#l134.210"></a><span id="l134.210"> </span>
<a href="#l134.211"></a><span id="l134.211">   bool isDirectory = false;</span>
<a href="#l134.212"></a><span id="l134.212">   parentPathFile-&gt;IsDirectory(&amp;isDirectory);</span>
<a href="#l134.213"></a><span id="l134.213">   if (!isDirectory)</span>
<a href="#l134.214"></a><span id="l134.214">   {</span>
<a href="#l134.215"></a><span id="l134.215">     nsAutoString leafName;</span>
<a href="#l134.216"></a><span id="l134.216" class="difflineat">@@ -445,17 +444,17 @@ NS_IMETHODIMP nsMsgBrkMBoxStore::RenameF</span>
<a href="#l134.217"></a><span id="l134.217">   dbName += NS_LITERAL_STRING(SUMMARY_SUFFIX);</span>
<a href="#l134.218"></a><span id="l134.218">   oldSummaryFile-&gt;MoveTo(nsnull, dbName);</span>
<a href="#l134.219"></a><span id="l134.219"> </span>
<a href="#l134.220"></a><span id="l134.220">   if (numChildren &gt; 0)</span>
<a href="#l134.221"></a><span id="l134.221">   {</span>
<a href="#l134.222"></a><span id="l134.222">     // rename &quot;*.sbd&quot; directory</span>
<a href="#l134.223"></a><span id="l134.223">     nsAutoString newNameDirStr(safeName);</span>
<a href="#l134.224"></a><span id="l134.224">     newNameDirStr += NS_LITERAL_STRING(&quot;.sbd&quot;);</span>
<a href="#l134.225"></a><span id="l134.225" class="difflineminus">-    localDirFile-&gt;MoveTo(nsnull, newNameDirStr);</span>
<a href="#l134.226"></a><span id="l134.226" class="difflineplus">+    dirFile-&gt;MoveTo(nsnull, newNameDirStr);</span>
<a href="#l134.227"></a><span id="l134.227">   }</span>
<a href="#l134.228"></a><span id="l134.228"> </span>
<a href="#l134.229"></a><span id="l134.229">   return parentFolder-&gt;AddSubfolder(safeName, aNewFolder);</span>
<a href="#l134.230"></a><span id="l134.230"> }</span>
<a href="#l134.231"></a><span id="l134.231"> </span>
<a href="#l134.232"></a><span id="l134.232"> NS_IMETHODIMP nsMsgBrkMBoxStore::CopyFolder(nsIMsgFolder *aSrcFolder,</span>
<a href="#l134.233"></a><span id="l134.233">                                             nsIMsgFolder *aDstFolder,</span>
<a href="#l134.234"></a><span id="l134.234">                                             bool aIsMoveFolder,</span>
<a href="#l134.235"></a><span id="l134.235" class="difflineat">@@ -471,24 +470,24 @@ NS_IMETHODIMP nsMsgBrkMBoxStore::CopyFol</span>
<a href="#l134.236"></a><span id="l134.236">   nsCOMPtr&lt;nsIMsgLocalMailFolder&gt; localSrcFolder(do_QueryInterface(aSrcFolder));</span>
<a href="#l134.237"></a><span id="l134.237">   nsCOMPtr&lt;nsIMsgDatabase&gt; srcDB;</span>
<a href="#l134.238"></a><span id="l134.238">   if (localSrcFolder)</span>
<a href="#l134.239"></a><span id="l134.239">     localSrcFolder-&gt;GetDatabaseWOReparse(getter_AddRefs(srcDB));</span>
<a href="#l134.240"></a><span id="l134.240">   bool summaryValid = !!srcDB;</span>
<a href="#l134.241"></a><span id="l134.241">   srcDB = nsnull;</span>
<a href="#l134.242"></a><span id="l134.242">   aSrcFolder-&gt;ForceDBClosed();</span>
<a href="#l134.243"></a><span id="l134.243"> </span>
<a href="#l134.244"></a><span id="l134.244" class="difflineminus">-  nsCOMPtr&lt;nsILocalFile&gt; oldPath;</span>
<a href="#l134.245"></a><span id="l134.245" class="difflineplus">+  nsCOMPtr&lt;nsIFile&gt; oldPath;</span>
<a href="#l134.246"></a><span id="l134.246">   nsresult rv = aSrcFolder-&gt;GetFilePath(getter_AddRefs(oldPath));</span>
<a href="#l134.247"></a><span id="l134.247">   NS_ENSURE_SUCCESS(rv,rv);</span>
<a href="#l134.248"></a><span id="l134.248"> </span>
<a href="#l134.249"></a><span id="l134.249" class="difflineminus">-  nsCOMPtr&lt;nsILocalFile&gt; summaryFile;</span>
<a href="#l134.250"></a><span id="l134.250" class="difflineplus">+  nsCOMPtr&lt;nsIFile&gt; summaryFile;</span>
<a href="#l134.251"></a><span id="l134.251">   GetSummaryFileLocation(oldPath, getter_AddRefs(summaryFile));</span>
<a href="#l134.252"></a><span id="l134.252"> </span>
<a href="#l134.253"></a><span id="l134.253" class="difflineminus">-  nsCOMPtr&lt;nsILocalFile&gt; newPath;</span>
<a href="#l134.254"></a><span id="l134.254" class="difflineplus">+  nsCOMPtr&lt;nsIFile&gt; newPath;</span>
<a href="#l134.255"></a><span id="l134.255">   rv = aDstFolder-&gt;GetFilePath(getter_AddRefs(newPath));</span>
<a href="#l134.256"></a><span id="l134.256">   NS_ENSURE_SUCCESS(rv,rv);</span>
<a href="#l134.257"></a><span id="l134.257"> </span>
<a href="#l134.258"></a><span id="l134.258">   bool newPathIsDirectory = false;</span>
<a href="#l134.259"></a><span id="l134.259">   newPath-&gt;IsDirectory(&amp;newPathIsDirectory);</span>
<a href="#l134.260"></a><span id="l134.260">   if (!newPathIsDirectory)</span>
<a href="#l134.261"></a><span id="l134.261">   {</span>
<a href="#l134.262"></a><span id="l134.262">     AddDirectorySeparator(newPath);</span>
<a href="#l134.263"></a><span id="l134.263" class="difflineat">@@ -606,17 +605,17 @@ NS_IMETHODIMP nsMsgBrkMBoxStore::CopyFol</span>
<a href="#l134.264"></a><span id="l134.264">     {</span>
<a href="#l134.265"></a><span id="l134.265">       // The files have already been moved, so delete storage false</span>
<a href="#l134.266"></a><span id="l134.266">       msgParent-&gt;PropagateDelete(aSrcFolder, false, aMsgWindow);</span>
<a href="#l134.267"></a><span id="l134.267">       oldPath-&gt;Remove(false);  //berkeley mailbox</span>
<a href="#l134.268"></a><span id="l134.268">      // We need to force closed the source db</span>
<a href="#l134.269"></a><span id="l134.269">       nsCOMPtr&lt;nsIMsgDatabase&gt; srcDB;</span>
<a href="#l134.270"></a><span id="l134.270">       aSrcFolder-&gt;Delete();</span>
<a href="#l134.271"></a><span id="l134.271"> </span>
<a href="#l134.272"></a><span id="l134.272" class="difflineminus">-      nsCOMPtr&lt;nsILocalFile&gt; parentPath;</span>
<a href="#l134.273"></a><span id="l134.273" class="difflineplus">+      nsCOMPtr&lt;nsIFile&gt; parentPath;</span>
<a href="#l134.274"></a><span id="l134.274">       rv = msgParent-&gt;GetFilePath(getter_AddRefs(parentPath));</span>
<a href="#l134.275"></a><span id="l134.275">       NS_ENSURE_SUCCESS(rv,rv);</span>
<a href="#l134.276"></a><span id="l134.276"> </span>
<a href="#l134.277"></a><span id="l134.277">       AddDirectorySeparator(parentPath);</span>
<a href="#l134.278"></a><span id="l134.278">       nsCOMPtr&lt;nsISimpleEnumerator&gt; children;</span>
<a href="#l134.279"></a><span id="l134.279">       parentPath-&gt;GetDirectoryEntries(getter_AddRefs(children));</span>
<a href="#l134.280"></a><span id="l134.280">       bool more;</span>
<a href="#l134.281"></a><span id="l134.281">       // checks if the directory is empty or not</span>
<a href="#l134.282"></a><span id="l134.282" class="difflineat">@@ -661,17 +660,17 @@ nsMsgBrkMBoxStore::GetNewMsgOutputStream</span>
<a href="#l134.283"></a><span id="l134.283">   NS_ENSURE_ARG_POINTER(aReusable);</span>
<a href="#l134.284"></a><span id="l134.284">   NS_ENSURE_ARG_POINTER(aResult);</span>
<a href="#l134.285"></a><span id="l134.285"> </span>
<a href="#l134.286"></a><span id="l134.286"> #ifdef _DEBUG</span>
<a href="#l134.287"></a><span id="l134.287">   NS_ASSERTION(m_streamOutstandingFolder != aFolder, &quot;didn't finish prev msg&quot;);</span>
<a href="#l134.288"></a><span id="l134.288">   m_streamOutstandingFolder = aFolder;</span>
<a href="#l134.289"></a><span id="l134.289"> #endif</span>
<a href="#l134.290"></a><span id="l134.290">   *aReusable = true;</span>
<a href="#l134.291"></a><span id="l134.291" class="difflineminus">-  nsCOMPtr&lt;nsILocalFile&gt; mboxFile;</span>
<a href="#l134.292"></a><span id="l134.292" class="difflineplus">+  nsCOMPtr&lt;nsIFile&gt; mboxFile;</span>
<a href="#l134.293"></a><span id="l134.293">   aFolder-&gt;GetFilePath(getter_AddRefs(mboxFile));</span>
<a href="#l134.294"></a><span id="l134.294">   nsCOMPtr&lt;nsIMsgDatabase&gt; db;</span>
<a href="#l134.295"></a><span id="l134.295">   aFolder-&gt;GetMsgDatabase(getter_AddRefs(db));</span>
<a href="#l134.296"></a><span id="l134.296">   if (!db &amp;&amp; !*aNewMsgHdr)</span>
<a href="#l134.297"></a><span id="l134.297">     NS_WARNING(&quot;no db, and no message header&quot;);</span>
<a href="#l134.298"></a><span id="l134.298">   bool exists;</span>
<a href="#l134.299"></a><span id="l134.299">   mboxFile-&gt;Exists(&amp;exists);</span>
<a href="#l134.300"></a><span id="l134.300">   if (!exists)</span>
<a href="#l134.301"></a><span id="l134.301" class="difflineat">@@ -730,17 +729,17 @@ nsMsgBrkMBoxStore::DiscardNewMessage(nsI</span>
<a href="#l134.302"></a><span id="l134.302">   NS_ENSURE_ARG_POINTER(aOutputStream);</span>
<a href="#l134.303"></a><span id="l134.303">   NS_ENSURE_ARG_POINTER(aNewHdr);</span>
<a href="#l134.304"></a><span id="l134.304"> #ifdef _DEBUG</span>
<a href="#l134.305"></a><span id="l134.305">   m_streamOutstandingFolder = nsnull;</span>
<a href="#l134.306"></a><span id="l134.306"> #endif</span>
<a href="#l134.307"></a><span id="l134.307">   PRUint64 hdrOffset;</span>
<a href="#l134.308"></a><span id="l134.308">   aNewHdr-&gt;GetMessageOffset(&amp;hdrOffset);</span>
<a href="#l134.309"></a><span id="l134.309">   aOutputStream-&gt;Close();</span>
<a href="#l134.310"></a><span id="l134.310" class="difflineminus">-  nsCOMPtr&lt;nsILocalFile&gt; mboxFile;</span>
<a href="#l134.311"></a><span id="l134.311" class="difflineplus">+  nsCOMPtr&lt;nsIFile&gt; mboxFile;</span>
<a href="#l134.312"></a><span id="l134.312">   nsCOMPtr&lt;nsIMsgFolder&gt; folder;</span>
<a href="#l134.313"></a><span id="l134.313">   nsresult rv = aNewHdr-&gt;GetFolder(getter_AddRefs(folder));</span>
<a href="#l134.314"></a><span id="l134.314">   NS_ENSURE_SUCCESS(rv, rv);</span>
<a href="#l134.315"></a><span id="l134.315">   folder-&gt;GetFilePath(getter_AddRefs(mboxFile));</span>
<a href="#l134.316"></a><span id="l134.316">   return mboxFile-&gt;SetFileSize(hdrOffset);</span>
<a href="#l134.317"></a><span id="l134.317"> }</span>
<a href="#l134.318"></a><span id="l134.318"> </span>
<a href="#l134.319"></a><span id="l134.319"> NS_IMETHODIMP</span>
<a href="#l134.320"></a><span id="l134.320" class="difflineat">@@ -789,17 +788,17 @@ nsMsgBrkMBoxStore::GetMsgInputStream(nsI</span>
<a href="#l134.321"></a><span id="l134.321">     char storeToken[100];</span>
<a href="#l134.322"></a><span id="l134.322">     PR_snprintf(storeToken, sizeof(storeToken), &quot;%lld&quot;, *aOffset);</span>
<a href="#l134.323"></a><span id="l134.323">     aMsgHdr-&gt;SetStringProperty(&quot;storeToken&quot;, storeToken);</span>
<a href="#l134.324"></a><span id="l134.324">   }</span>
<a href="#l134.325"></a><span id="l134.325">   else</span>
<a href="#l134.326"></a><span id="l134.326">     *aOffset = ParseUint64Str(PromiseFlatCString(aMsgToken).get());</span>
<a href="#l134.327"></a><span id="l134.327">   *aReusable = true;</span>
<a href="#l134.328"></a><span id="l134.328">   nsCString URI;</span>
<a href="#l134.329"></a><span id="l134.329" class="difflineminus">-  nsCOMPtr&lt;nsILocalFile&gt; mboxFile;</span>
<a href="#l134.330"></a><span id="l134.330" class="difflineplus">+  nsCOMPtr&lt;nsIFile&gt; mboxFile;</span>
<a href="#l134.331"></a><span id="l134.331"> </span>
<a href="#l134.332"></a><span id="l134.332">   aMsgFolder-&gt;GetURI(URI);</span>
<a href="#l134.333"></a><span id="l134.333">   aMsgFolder-&gt;GetFilePath(getter_AddRefs(mboxFile));</span>
<a href="#l134.334"></a><span id="l134.334">   return NS_NewLocalFileInputStream(aResult, mboxFile);</span>
<a href="#l134.335"></a><span id="l134.335"> }</span>
<a href="#l134.336"></a><span id="l134.336"> </span>
<a href="#l134.337"></a><span id="l134.337"> NS_IMETHODIMP nsMsgBrkMBoxStore::DeleteMessages(nsIArray *aHdrArray)</span>
<a href="#l134.338"></a><span id="l134.338"> {</span>
<a href="#l134.339"></a><span id="l134.339" class="difflineat">@@ -849,17 +848,17 @@ NS_IMETHODIMP nsMsgBrkMBoxStore::Compact</span>
<a href="#l134.340"></a><span id="l134.340"> </span>
<a href="#l134.341"></a><span id="l134.341"> NS_IMETHODIMP nsMsgBrkMBoxStore::RebuildIndex(nsIMsgFolder *aFolder,</span>
<a href="#l134.342"></a><span id="l134.342">                                               nsIMsgDatabase *aMsgDB,</span>
<a href="#l134.343"></a><span id="l134.343">                                               nsIMsgWindow *aMsgWindow,</span>
<a href="#l134.344"></a><span id="l134.344">                                               nsIUrlListener *aListener)</span>
<a href="#l134.345"></a><span id="l134.345"> {</span>
<a href="#l134.346"></a><span id="l134.346">   NS_ENSURE_ARG_POINTER(aFolder);</span>
<a href="#l134.347"></a><span id="l134.347">   // We don't use aMsgDB, but I think nsMsgMailDirStore needs it.</span>
<a href="#l134.348"></a><span id="l134.348" class="difflineminus">-  nsCOMPtr&lt;nsILocalFile&gt; pathFile;</span>
<a href="#l134.349"></a><span id="l134.349" class="difflineplus">+  nsCOMPtr&lt;nsIFile&gt; pathFile;</span>
<a href="#l134.350"></a><span id="l134.350">   nsresult rv = aFolder-&gt;GetFilePath(getter_AddRefs(pathFile));</span>
<a href="#l134.351"></a><span id="l134.351">   if (NS_FAILED(rv))</span>
<a href="#l134.352"></a><span id="l134.352">     return rv;</span>
<a href="#l134.353"></a><span id="l134.353"> </span>
<a href="#l134.354"></a><span id="l134.354">   bool isLocked;</span>
<a href="#l134.355"></a><span id="l134.355">   aFolder-&gt;GetLocked(&amp;isLocked);</span>
<a href="#l134.356"></a><span id="l134.356">   if (isLocked)</span>
<a href="#l134.357"></a><span id="l134.357">   {</span>
<a href="#l134.358"></a><span id="l134.358" class="difflineat">@@ -900,17 +899,17 @@ nsMsgBrkMBoxStore::GetOutputStream(nsIAr</span>
<a href="#l134.359"></a><span id="l134.359">     seekableStream = do_QueryInterface(outputStream);</span>
<a href="#l134.360"></a><span id="l134.360">     rv = seekableStream-&gt;Tell(&amp;restorePos);</span>
<a href="#l134.361"></a><span id="l134.361">     if (NS_FAILED(rv))</span>
<a href="#l134.362"></a><span id="l134.362">     {</span>
<a href="#l134.363"></a><span id="l134.363">       outputStream = nsnull;</span>
<a href="#l134.364"></a><span id="l134.364">       m_outputStreams.Remove(URI);</span>
<a href="#l134.365"></a><span id="l134.365">     }</span>
<a href="#l134.366"></a><span id="l134.366">   }</span>
<a href="#l134.367"></a><span id="l134.367" class="difflineminus">-  nsCOMPtr&lt;nsILocalFile&gt; mboxFile;</span>
<a href="#l134.368"></a><span id="l134.368" class="difflineplus">+  nsCOMPtr&lt;nsIFile&gt; mboxFile;</span>
<a href="#l134.369"></a><span id="l134.369">   folder-&gt;GetFilePath(getter_AddRefs(mboxFile));</span>
<a href="#l134.370"></a><span id="l134.370">   if (!outputStream)</span>
<a href="#l134.371"></a><span id="l134.371">   {</span>
<a href="#l134.372"></a><span id="l134.372">     rv = MsgGetFileStream(mboxFile, getter_AddRefs(outputStream));</span>
<a href="#l134.373"></a><span id="l134.373">     seekableStream = do_QueryInterface(outputStream);</span>
<a href="#l134.374"></a><span id="l134.374">     if (NS_SUCCEEDED(rv))</span>
<a href="#l134.375"></a><span id="l134.375">       m_outputStreams.Put(URI, outputStream);</span>
<a href="#l134.376"></a><span id="l134.376">   }</span>
<a href="#l134.377"></a><span id="l134.377" class="difflineat">@@ -1091,30 +1090,30 @@ nsMsgBrkMBoxStore::AddSubFolders(nsIMsgF</span>
<a href="#l134.378"></a><span id="l134.378">     if (child)</span>
<a href="#l134.379"></a><span id="l134.379">     {</span>
<a href="#l134.380"></a><span id="l134.380">       nsString folderName;</span>
<a href="#l134.381"></a><span id="l134.381">       child-&gt;GetName(folderName);  // try to get it from cache/db</span>
<a href="#l134.382"></a><span id="l134.382">       if (folderName.IsEmpty())</span>
<a href="#l134.383"></a><span id="l134.383">         child-&gt;SetPrettyName(leafName);</span>
<a href="#l134.384"></a><span id="l134.384">       if (deep)</span>
<a href="#l134.385"></a><span id="l134.385">       {</span>
<a href="#l134.386"></a><span id="l134.386" class="difflineminus">-        nsCOMPtr&lt;nsILocalFile&gt; path;</span>
<a href="#l134.387"></a><span id="l134.387" class="difflineplus">+        nsCOMPtr&lt;nsIFile&gt; path;</span>
<a href="#l134.388"></a><span id="l134.388">         rv = child-&gt;GetFilePath(getter_AddRefs(path));</span>
<a href="#l134.389"></a><span id="l134.389">         AddSubFolders(child, path, true);</span>
<a href="#l134.390"></a><span id="l134.390">       }</span>
<a href="#l134.391"></a><span id="l134.391">     }</span>
<a href="#l134.392"></a><span id="l134.392">   }</span>
<a href="#l134.393"></a><span id="l134.393">   return rv == NS_MSG_FOLDER_EXISTS ? NS_OK : rv;</span>
<a href="#l134.394"></a><span id="l134.394"> }</span>
<a href="#l134.395"></a><span id="l134.395"> </span>
<a href="#l134.396"></a><span id="l134.396"> /* Finds the directory associated with this folder.  That is if the path is</span>
<a href="#l134.397"></a><span id="l134.397">    c:\Inbox, it will return c:\Inbox.sbd if it succeeds.  If that path doesn't</span>
<a href="#l134.398"></a><span id="l134.398">    currently exist then it will create it. Path is strictly an out parameter.</span>
<a href="#l134.399"></a><span id="l134.399">   */</span>
<a href="#l134.400"></a><span id="l134.400" class="difflineminus">-nsresult nsMsgBrkMBoxStore::CreateDirectoryForFolder(nsILocalFile *path)</span>
<a href="#l134.401"></a><span id="l134.401" class="difflineplus">+nsresult nsMsgBrkMBoxStore::CreateDirectoryForFolder(nsIFile *path)</span>
<a href="#l134.402"></a><span id="l134.402"> {</span>
<a href="#l134.403"></a><span id="l134.403">   nsresult rv = NS_OK;</span>
<a href="#l134.404"></a><span id="l134.404"> </span>
<a href="#l134.405"></a><span id="l134.405">   bool pathIsDirectory = false;</span>
<a href="#l134.406"></a><span id="l134.406">   path-&gt;IsDirectory(&amp;pathIsDirectory);</span>
<a href="#l134.407"></a><span id="l134.407">   if (!pathIsDirectory)</span>
<a href="#l134.408"></a><span id="l134.408">   {</span>
<a href="#l134.409"></a><span id="l134.409">     // If the current path isn't a directory, add directory separator</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l135.1"></a><span id="l135.1" class="difflineminus">--- a/mailnews/local/src/nsMsgBrkMBoxStore.h</span>
<a href="#l135.2"></a><span id="l135.2" class="difflineplus">+++ b/mailnews/local/src/nsMsgBrkMBoxStore.h</span>
<a href="#l135.3"></a><span id="l135.3" class="difflineat">@@ -6,34 +6,34 @@</span>
<a href="#l135.4"></a><span id="l135.4"> /**</span>
<a href="#l135.5"></a><span id="l135.5">    Class for handling Berkeley Mailbox stores.</span>
<a href="#l135.6"></a><span id="l135.6"> */</span>
<a href="#l135.7"></a><span id="l135.7"> </span>
<a href="#l135.8"></a><span id="l135.8"> #ifndef nsMsgBrkMboxStore_h__</span>
<a href="#l135.9"></a><span id="l135.9"> #define nsMsgBrkMboxStore_h__</span>
<a href="#l135.10"></a><span id="l135.10"> </span>
<a href="#l135.11"></a><span id="l135.11"> #include &quot;nsMsgLocalStoreUtils.h&quot;</span>
<a href="#l135.12"></a><span id="l135.12" class="difflineminus">-#include &quot;nsILocalFile.h&quot;</span>
<a href="#l135.13"></a><span id="l135.13" class="difflineplus">+#include &quot;nsIFile.h&quot;</span>
<a href="#l135.14"></a><span id="l135.14"> #include &quot;nsInterfaceHashtable.h&quot;</span>
<a href="#l135.15"></a><span id="l135.15"> #include &quot;nsISeekableStream.h&quot;</span>
<a href="#l135.16"></a><span id="l135.16"> </span>
<a href="#l135.17"></a><span id="l135.17"> class nsMsgBrkMBoxStore : public nsMsgLocalStoreUtils, nsIMsgPluggableStore</span>
<a href="#l135.18"></a><span id="l135.18"> {</span>
<a href="#l135.19"></a><span id="l135.19"> public:</span>
<a href="#l135.20"></a><span id="l135.20">   NS_DECL_ISUPPORTS</span>
<a href="#l135.21"></a><span id="l135.21">   NS_DECL_NSIMSGPLUGGABLESTORE</span>
<a href="#l135.22"></a><span id="l135.22"> </span>
<a href="#l135.23"></a><span id="l135.23">   nsMsgBrkMBoxStore();</span>
<a href="#l135.24"></a><span id="l135.24"> </span>
<a href="#l135.25"></a><span id="l135.25"> private:</span>
<a href="#l135.26"></a><span id="l135.26">   ~nsMsgBrkMBoxStore();</span>
<a href="#l135.27"></a><span id="l135.27"> </span>
<a href="#l135.28"></a><span id="l135.28"> protected:</span>
<a href="#l135.29"></a><span id="l135.29">   nsresult AddSubFolders(nsIMsgFolder *parent, nsIFile *path, bool deep);</span>
<a href="#l135.30"></a><span id="l135.30" class="difflineminus">-  nsresult CreateDirectoryForFolder(nsILocalFile *path);</span>
<a href="#l135.31"></a><span id="l135.31" class="difflineplus">+  nsresult CreateDirectoryForFolder(nsIFile *path);</span>
<a href="#l135.32"></a><span id="l135.32">   nsresult GetOutputStream(nsIArray *aHdrArray,</span>
<a href="#l135.33"></a><span id="l135.33">                            nsCOMPtr&lt;nsIOutputStream&gt; &amp;outputStream,</span>
<a href="#l135.34"></a><span id="l135.34">                            nsCOMPtr&lt;nsISeekableStream&gt; &amp;seekableStream,</span>
<a href="#l135.35"></a><span id="l135.35">                            PRInt64 &amp;restorePos);</span>
<a href="#l135.36"></a><span id="l135.36">   void GetMailboxModProperties(nsIMsgFolder *aFolder,</span>
<a href="#l135.37"></a><span id="l135.37">                                PRInt64 *aSize, PRUint32 *aDate);</span>
<a href="#l135.38"></a><span id="l135.38">   void SetDBValid(nsIMsgDBHdr *aHdr);</span>
<a href="#l135.39"></a><span id="l135.39">   // We don't want to keep re-opening an output stream when downloading</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l136.1"></a><span id="l136.1" class="difflineminus">--- a/mailnews/local/src/nsMsgLocalStoreUtils.cpp</span>
<a href="#l136.2"></a><span id="l136.2" class="difflineplus">+++ b/mailnews/local/src/nsMsgLocalStoreUtils.cpp</span>
<a href="#l136.3"></a><span id="l136.3" class="difflineat">@@ -1,24 +1,24 @@</span>
<a href="#l136.4"></a><span id="l136.4"> /* -*- Mode: C++; tab-width: 2; indent-tabs-mode: nil; c-basic-offset: 2 -*- */</span>
<a href="#l136.5"></a><span id="l136.5"> /* This Source Code Form is subject to the terms of the Mozilla Public</span>
<a href="#l136.6"></a><span id="l136.6">  * License, v. 2.0. If a copy of the MPL was not distributed with this</span>
<a href="#l136.7"></a><span id="l136.7">  * file, You can obtain one at http://mozilla.org/MPL/2.0/. */</span>
<a href="#l136.8"></a><span id="l136.8">  </span>
<a href="#l136.9"></a><span id="l136.9"> #include &quot;msgCore.h&quot;    // precompiled header...</span>
<a href="#l136.10"></a><span id="l136.10"> #include &quot;nsMsgLocalStoreUtils.h&quot;</span>
<a href="#l136.11"></a><span id="l136.11" class="difflineminus">-#include &quot;nsILocalFile.h&quot;</span>
<a href="#l136.12"></a><span id="l136.12" class="difflineplus">+#include &quot;nsIFile.h&quot;</span>
<a href="#l136.13"></a><span id="l136.13"> #include &quot;prprf.h&quot;</span>
<a href="#l136.14"></a><span id="l136.14"> </span>
<a href="#l136.15"></a><span id="l136.15"> nsMsgLocalStoreUtils::nsMsgLocalStoreUtils()</span>
<a href="#l136.16"></a><span id="l136.16"> {</span>
<a href="#l136.17"></a><span id="l136.17"> }</span>
<a href="#l136.18"></a><span id="l136.18"> </span>
<a href="#l136.19"></a><span id="l136.19"> nsresult</span>
<a href="#l136.20"></a><span id="l136.20" class="difflineminus">-nsMsgLocalStoreUtils::AddDirectorySeparator(nsILocalFile *path)</span>
<a href="#l136.21"></a><span id="l136.21" class="difflineplus">+nsMsgLocalStoreUtils::AddDirectorySeparator(nsIFile *path)</span>
<a href="#l136.22"></a><span id="l136.22"> {</span>
<a href="#l136.23"></a><span id="l136.23">   nsAutoString leafName;</span>
<a href="#l136.24"></a><span id="l136.24">   path-&gt;GetLeafName(leafName);</span>
<a href="#l136.25"></a><span id="l136.25">   leafName.AppendLiteral(FOLDER_SUFFIX);</span>
<a href="#l136.26"></a><span id="l136.26">   return path-&gt;SetLeafName(leafName);</span>
<a href="#l136.27"></a><span id="l136.27"> }</span>
<a href="#l136.28"></a><span id="l136.28"> </span>
<a href="#l136.29"></a><span id="l136.29"> bool</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l137.1"></a><span id="l137.1" class="difflineminus">--- a/mailnews/local/src/nsMsgLocalStoreUtils.h</span>
<a href="#l137.2"></a><span id="l137.2" class="difflineplus">+++ b/mailnews/local/src/nsMsgLocalStoreUtils.h</span>
<a href="#l137.3"></a><span id="l137.3" class="difflineat">@@ -22,17 +22,17 @@</span>
<a href="#l137.4"></a><span id="l137.4">  * and MailDir stores inherit from this class to share some code.</span>
<a href="#l137.5"></a><span id="l137.5"> */</span>
<a href="#l137.6"></a><span id="l137.6"> </span>
<a href="#l137.7"></a><span id="l137.7"> class nsMsgLocalStoreUtils</span>
<a href="#l137.8"></a><span id="l137.8"> {</span>
<a href="#l137.9"></a><span id="l137.9"> public:</span>
<a href="#l137.10"></a><span id="l137.10">   nsMsgLocalStoreUtils();</span>
<a href="#l137.11"></a><span id="l137.11"> </span>
<a href="#l137.12"></a><span id="l137.12" class="difflineminus">-  static nsresult AddDirectorySeparator(nsILocalFile *path);</span>
<a href="#l137.13"></a><span id="l137.13" class="difflineplus">+  static nsresult AddDirectorySeparator(nsIFile *path);</span>
<a href="#l137.14"></a><span id="l137.14">   static bool nsShouldIgnoreFile(nsAString&amp; name);</span>
<a href="#l137.15"></a><span id="l137.15">   static void ChangeKeywordsHelper(nsIMsgDBHdr *message,</span>
<a href="#l137.16"></a><span id="l137.16">                             PRUint64 desiredOffset,</span>
<a href="#l137.17"></a><span id="l137.17">                             nsLineBuffer&lt;char&gt; *lineBuffer,</span>
<a href="#l137.18"></a><span id="l137.18">                             nsTArray&lt;nsCString&gt; &amp;keywordArray,</span>
<a href="#l137.19"></a><span id="l137.19">                             bool aAdd,</span>
<a href="#l137.20"></a><span id="l137.20">                             nsIOutputStream *outputStream,</span>
<a href="#l137.21"></a><span id="l137.21">                             nsISeekableStream *seekableStream,</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l138.1"></a><span id="l138.1" class="difflineminus">--- a/mailnews/local/src/nsMsgMaildirStore.cpp</span>
<a href="#l138.2"></a><span id="l138.2" class="difflineplus">+++ b/mailnews/local/src/nsMsgMaildirStore.cpp</span>
<a href="#l138.3"></a><span id="l138.3" class="difflineat">@@ -93,17 +93,17 @@ nsresult nsMsgMaildirStore::AddSubFolder</span>
<a href="#l138.4"></a><span id="l138.4">     if (child)</span>
<a href="#l138.5"></a><span id="l138.5">     {</span>
<a href="#l138.6"></a><span id="l138.6">       nsString folderName;</span>
<a href="#l138.7"></a><span id="l138.7">       child-&gt;GetName(folderName);  // try to get it from cache/db</span>
<a href="#l138.8"></a><span id="l138.8">       if (folderName.IsEmpty())</span>
<a href="#l138.9"></a><span id="l138.9">         child-&gt;SetPrettyName(leafName);</span>
<a href="#l138.10"></a><span id="l138.10">       if (deep)</span>
<a href="#l138.11"></a><span id="l138.11">       {</span>
<a href="#l138.12"></a><span id="l138.12" class="difflineminus">-        nsCOMPtr&lt;nsILocalFile&gt; path;</span>
<a href="#l138.13"></a><span id="l138.13" class="difflineplus">+        nsCOMPtr&lt;nsIFile&gt; path;</span>
<a href="#l138.14"></a><span id="l138.14">         rv = child-&gt;GetFilePath(getter_AddRefs(path));</span>
<a href="#l138.15"></a><span id="l138.15">         NS_ENSURE_SUCCESS(rv, rv);</span>
<a href="#l138.16"></a><span id="l138.16"> </span>
<a href="#l138.17"></a><span id="l138.17">         // Construct the .sbd directory path for the possible children of the</span>
<a href="#l138.18"></a><span id="l138.18">         // folder.</span>
<a href="#l138.19"></a><span id="l138.19">         GetDirectoryForFolder(path);</span>
<a href="#l138.20"></a><span id="l138.20">         bool directory = false;</span>
<a href="#l138.21"></a><span id="l138.21">         // Check that &lt;folder&gt;.sbd really is a directory.</span>
<a href="#l138.22"></a><span id="l138.22" class="difflineat">@@ -116,17 +116,17 @@ nsresult nsMsgMaildirStore::AddSubFolder</span>
<a href="#l138.23"></a><span id="l138.23">   return rv == NS_MSG_FOLDER_EXISTS ? NS_OK : rv;</span>
<a href="#l138.24"></a><span id="l138.24"> }</span>
<a href="#l138.25"></a><span id="l138.25"> </span>
<a href="#l138.26"></a><span id="l138.26"> NS_IMETHODIMP nsMsgMaildirStore::DiscoverSubFolders(nsIMsgFolder *aParentFolder,</span>
<a href="#l138.27"></a><span id="l138.27">                                                     bool aDeep)</span>
<a href="#l138.28"></a><span id="l138.28"> {</span>
<a href="#l138.29"></a><span id="l138.29">   NS_ENSURE_ARG_POINTER(aParentFolder);</span>
<a href="#l138.30"></a><span id="l138.30"> </span>
<a href="#l138.31"></a><span id="l138.31" class="difflineminus">-  nsCOMPtr&lt;nsILocalFile&gt; path;</span>
<a href="#l138.32"></a><span id="l138.32" class="difflineplus">+  nsCOMPtr&lt;nsIFile&gt; path;</span>
<a href="#l138.33"></a><span id="l138.33">   nsresult rv = aParentFolder-&gt;GetFilePath(getter_AddRefs(path));</span>
<a href="#l138.34"></a><span id="l138.34">   NS_ENSURE_SUCCESS(rv, rv);</span>
<a href="#l138.35"></a><span id="l138.35"> </span>
<a href="#l138.36"></a><span id="l138.36">   bool isServer, directory = false;</span>
<a href="#l138.37"></a><span id="l138.37">   aParentFolder-&gt;GetIsServer(&amp;isServer);</span>
<a href="#l138.38"></a><span id="l138.38">   if (!isServer)</span>
<a href="#l138.39"></a><span id="l138.39">     GetDirectoryForFolder(path);</span>
<a href="#l138.40"></a><span id="l138.40"> </span>
<a href="#l138.41"></a><span id="l138.41" class="difflineat">@@ -167,23 +167,23 @@ NS_IMETHODIMP nsMsgMaildirStore::Discove</span>
<a href="#l138.42"></a><span id="l138.42"> </span>
<a href="#l138.43"></a><span id="l138.43"> /**</span>
<a href="#l138.44"></a><span id="l138.44">  *Create a Maildir-style folder with &quot;tmp&quot;, &quot; and &quot;cur&quot; subfolders</span>
<a href="#l138.45"></a><span id="l138.45">  * but no &quot;new&quot; subfolder, because it's not sensical in the mail client context.</span>
<a href="#l138.46"></a><span id="l138.46">  (&quot;new&quot; directory is for messages on the server that haven't been seen by a</span>
<a href="#l138.47"></a><span id="l138.47"> *  mail client).</span>
<a href="#l138.48"></a><span id="l138.48">  * aFolderName is already &quot;safe&quot; - it has been through NS_MsgHashIfNecessary</span>
<a href="#l138.49"></a><span id="l138.49">  */</span>
<a href="#l138.50"></a><span id="l138.50" class="difflineminus">-nsresult nsMsgMaildirStore::CreateMaildir(nsILocalFile *path)</span>
<a href="#l138.51"></a><span id="l138.51" class="difflineplus">+nsresult nsMsgMaildirStore::CreateMaildir(nsIFile *path)</span>
<a href="#l138.52"></a><span id="l138.52"> {</span>
<a href="#l138.53"></a><span id="l138.53">   nsresult rv = path-&gt;Create(nsIFile::DIRECTORY_TYPE, 0700);</span>
<a href="#l138.54"></a><span id="l138.54">   NS_ENSURE_SUCCESS(rv, rv);</span>
<a href="#l138.55"></a><span id="l138.55"> </span>
<a href="#l138.56"></a><span id="l138.56">   // Create tmp, new, cur leaves</span>
<a href="#l138.57"></a><span id="l138.57" class="difflineminus">-  nsCOMPtr&lt;nsILocalFile&gt; leaf(do_CreateInstance(NS_LOCAL_FILE_CONTRACTID, &amp;rv));</span>
<a href="#l138.58"></a><span id="l138.58" class="difflineplus">+  nsCOMPtr&lt;nsIFile&gt; leaf(do_CreateInstance(NS_LOCAL_FILE_CONTRACTID, &amp;rv));</span>
<a href="#l138.59"></a><span id="l138.59">   NS_ENSURE_SUCCESS(rv, rv);</span>
<a href="#l138.60"></a><span id="l138.60"> </span>
<a href="#l138.61"></a><span id="l138.61">   leaf-&gt;InitWithFile(path);</span>
<a href="#l138.62"></a><span id="l138.62"> </span>
<a href="#l138.63"></a><span id="l138.63">   leaf-&gt;AppendNative(NS_LITERAL_CSTRING(&quot;tmp&quot;));</span>
<a href="#l138.64"></a><span id="l138.64">   rv = leaf-&gt;Create(nsIFile::DIRECTORY_TYPE, 0700);</span>
<a href="#l138.65"></a><span id="l138.65">   NS_ENSURE_SUCCESS(rv, rv);</span>
<a href="#l138.66"></a><span id="l138.66"> </span>
<a href="#l138.67"></a><span id="l138.67" class="difflineat">@@ -193,17 +193,17 @@ nsresult nsMsgMaildirStore::CreateMaildi</span>
<a href="#l138.68"></a><span id="l138.68"> </span>
<a href="#l138.69"></a><span id="l138.69">   return NS_OK;</span>
<a href="#l138.70"></a><span id="l138.70"> }</span>
<a href="#l138.71"></a><span id="l138.71"> </span>
<a href="#l138.72"></a><span id="l138.72"> NS_IMETHODIMP nsMsgMaildirStore::CreateFolder(nsIMsgFolder *aParent,</span>
<a href="#l138.73"></a><span id="l138.73">                                               const nsAString &amp;aFolderName,</span>
<a href="#l138.74"></a><span id="l138.74">                                               nsIMsgFolder **aResult)</span>
<a href="#l138.75"></a><span id="l138.75"> {</span>
<a href="#l138.76"></a><span id="l138.76" class="difflineminus">-  nsCOMPtr &lt;nsILocalFile&gt; path;</span>
<a href="#l138.77"></a><span id="l138.77" class="difflineplus">+  nsCOMPtr &lt;nsIFile&gt; path;</span>
<a href="#l138.78"></a><span id="l138.78">   nsresult rv = aParent-&gt;GetFilePath(getter_AddRefs(path));</span>
<a href="#l138.79"></a><span id="l138.79">   NS_ENSURE_SUCCESS(rv, rv);</span>
<a href="#l138.80"></a><span id="l138.80"> </span>
<a href="#l138.81"></a><span id="l138.81">   // Get a directory based on our current path</span>
<a href="#l138.82"></a><span id="l138.82">   bool isServer;</span>
<a href="#l138.83"></a><span id="l138.83">   aParent-&gt;GetIsServer(&amp;isServer);</span>
<a href="#l138.84"></a><span id="l138.84">   rv = CreateDirectoryForFolder(path, isServer);</span>
<a href="#l138.85"></a><span id="l138.85">   NS_ENSURE_SUCCESS(rv, rv);</span>
<a href="#l138.86"></a><span id="l138.86" class="difflineat">@@ -282,17 +282,17 @@ NS_IMETHODIMP nsMsgMaildirStore::IsSumma</span>
<a href="#l138.87"></a><span id="l138.87">   NS_ENSURE_ARG_POINTER(aResult);</span>
<a href="#l138.88"></a><span id="l138.88">   *aResult = true;</span>
<a href="#l138.89"></a><span id="l138.89">   nsCOMPtr&lt;nsIDBFolderInfo&gt; dbFolderInfo;</span>
<a href="#l138.90"></a><span id="l138.90">   aDB-&gt;GetDBFolderInfo(getter_AddRefs(dbFolderInfo));</span>
<a href="#l138.91"></a><span id="l138.91">   nsresult rv = dbFolderInfo-&gt;GetBooleanProperty(&quot;maildirValid&quot;, false,</span>
<a href="#l138.92"></a><span id="l138.92">                                                  aResult);</span>
<a href="#l138.93"></a><span id="l138.93">   if (!*aResult)</span>
<a href="#l138.94"></a><span id="l138.94">   {</span>
<a href="#l138.95"></a><span id="l138.95" class="difflineminus">-    nsCOMPtr&lt;nsILocalFile&gt; newFile;</span>
<a href="#l138.96"></a><span id="l138.96" class="difflineplus">+    nsCOMPtr&lt;nsIFile&gt; newFile;</span>
<a href="#l138.97"></a><span id="l138.97">     rv = aFolder-&gt;GetFilePath(getter_AddRefs(newFile));</span>
<a href="#l138.98"></a><span id="l138.98">     NS_ENSURE_SUCCESS(rv, rv);</span>
<a href="#l138.99"></a><span id="l138.99">     newFile-&gt;Append(NS_LITERAL_STRING(&quot;cur&quot;));</span>
<a href="#l138.100"></a><span id="l138.100"> </span>
<a href="#l138.101"></a><span id="l138.101">     // If the &quot;cur&quot; sub-dir doesn't exist, and there are no messages</span>
<a href="#l138.102"></a><span id="l138.102">     // in the db, then the folder is probably new and the db is valid.</span>
<a href="#l138.103"></a><span id="l138.103">     bool exists;</span>
<a href="#l138.104"></a><span id="l138.104">     newFile-&gt;Exists(&amp;exists);</span>
<a href="#l138.105"></a><span id="l138.105" class="difflineat">@@ -314,27 +314,27 @@ NS_IMETHODIMP nsMsgMaildirStore::SetSumm</span>
<a href="#l138.106"></a><span id="l138.106">   NS_ENSURE_ARG_POINTER(aFolder);</span>
<a href="#l138.107"></a><span id="l138.107">   NS_ENSURE_ARG_POINTER(aDB);</span>
<a href="#l138.108"></a><span id="l138.108">   nsCOMPtr&lt;nsIDBFolderInfo&gt; dbFolderInfo;</span>
<a href="#l138.109"></a><span id="l138.109">   aDB-&gt;GetDBFolderInfo(getter_AddRefs(dbFolderInfo));</span>
<a href="#l138.110"></a><span id="l138.110">   return dbFolderInfo-&gt;SetBooleanProperty(&quot;maildirValid&quot;, aValid);</span>
<a href="#l138.111"></a><span id="l138.111"> }</span>
<a href="#l138.112"></a><span id="l138.112"> </span>
<a href="#l138.113"></a><span id="l138.113"> NS_IMETHODIMP nsMsgMaildirStore::GetSummaryFile(nsIMsgFolder *aFolder,</span>
<a href="#l138.114"></a><span id="l138.114" class="difflineminus">-                                                nsILocalFile **aSummaryFile)</span>
<a href="#l138.115"></a><span id="l138.115" class="difflineplus">+                                                nsIFile **aSummaryFile)</span>
<a href="#l138.116"></a><span id="l138.116"> {</span>
<a href="#l138.117"></a><span id="l138.117">   NS_ENSURE_ARG_POINTER(aFolder);</span>
<a href="#l138.118"></a><span id="l138.118">   NS_ENSURE_ARG_POINTER(aSummaryFile);</span>
<a href="#l138.119"></a><span id="l138.119"> </span>
<a href="#l138.120"></a><span id="l138.120">   nsresult rv;</span>
<a href="#l138.121"></a><span id="l138.121" class="difflineminus">-  nsCOMPtr &lt;nsILocalFile&gt; newSummaryLocation =</span>
<a href="#l138.122"></a><span id="l138.122" class="difflineplus">+  nsCOMPtr &lt;nsIFile&gt; newSummaryLocation =</span>
<a href="#l138.123"></a><span id="l138.123">     do_CreateInstance(NS_LOCAL_FILE_CONTRACTID, &amp;rv);</span>
<a href="#l138.124"></a><span id="l138.124">   NS_ENSURE_SUCCESS(rv, rv);</span>
<a href="#l138.125"></a><span id="l138.125"> </span>
<a href="#l138.126"></a><span id="l138.126" class="difflineminus">-  nsCOMPtr&lt;nsILocalFile&gt; pathFile;</span>
<a href="#l138.127"></a><span id="l138.127" class="difflineplus">+  nsCOMPtr&lt;nsIFile&gt; pathFile;</span>
<a href="#l138.128"></a><span id="l138.128">   rv = aFolder-&gt;GetFilePath(getter_AddRefs(pathFile));</span>
<a href="#l138.129"></a><span id="l138.129">   NS_ENSURE_SUCCESS(rv, rv);</span>
<a href="#l138.130"></a><span id="l138.130"> </span>
<a href="#l138.131"></a><span id="l138.131">   newSummaryLocation-&gt;InitWithFile(pathFile);</span>
<a href="#l138.132"></a><span id="l138.132">   nsString fileName;</span>
<a href="#l138.133"></a><span id="l138.133"> </span>
<a href="#l138.134"></a><span id="l138.134">   rv = newSummaryLocation-&gt;GetLeafName(fileName);</span>
<a href="#l138.135"></a><span id="l138.135">   if (NS_FAILED(rv))</span>
<a href="#l138.136"></a><span id="l138.136" class="difflineat">@@ -347,17 +347,17 @@ NS_IMETHODIMP nsMsgMaildirStore::GetSumm</span>
<a href="#l138.137"></a><span id="l138.137">   return NS_OK;</span>
<a href="#l138.138"></a><span id="l138.138"> }</span>
<a href="#l138.139"></a><span id="l138.139"> </span>
<a href="#l138.140"></a><span id="l138.140"> NS_IMETHODIMP nsMsgMaildirStore::DeleteFolder(nsIMsgFolder *aFolder)</span>
<a href="#l138.141"></a><span id="l138.141"> {</span>
<a href="#l138.142"></a><span id="l138.142">   NS_ENSURE_ARG_POINTER(aFolder);</span>
<a href="#l138.143"></a><span id="l138.143"> </span>
<a href="#l138.144"></a><span id="l138.144">   // Delete Maildir structure</span>
<a href="#l138.145"></a><span id="l138.145" class="difflineminus">-  nsCOMPtr&lt;nsILocalFile&gt; pathFile;</span>
<a href="#l138.146"></a><span id="l138.146" class="difflineplus">+  nsCOMPtr&lt;nsIFile&gt; pathFile;</span>
<a href="#l138.147"></a><span id="l138.147">   nsresult rv = aFolder-&gt;GetFilePath(getter_AddRefs(pathFile));</span>
<a href="#l138.148"></a><span id="l138.148">   NS_ENSURE_SUCCESS(rv, rv);</span>
<a href="#l138.149"></a><span id="l138.149"> </span>
<a href="#l138.150"></a><span id="l138.150">   rv = pathFile-&gt;Remove(true); // recursive</span>
<a href="#l138.151"></a><span id="l138.151">   AddDirectorySeparator(pathFile);</span>
<a href="#l138.152"></a><span id="l138.152">   bool exists;</span>
<a href="#l138.153"></a><span id="l138.153">   pathFile-&gt;Exists(&amp;exists);</span>
<a href="#l138.154"></a><span id="l138.154">   if (exists)</span>
<a href="#l138.155"></a><span id="l138.155" class="difflineat">@@ -368,35 +368,35 @@ NS_IMETHODIMP nsMsgMaildirStore::DeleteF</span>
<a href="#l138.156"></a><span id="l138.156"> NS_IMETHODIMP nsMsgMaildirStore::RenameFolder(nsIMsgFolder *aFolder,</span>
<a href="#l138.157"></a><span id="l138.157">                                               const nsAString &amp; aNewName,</span>
<a href="#l138.158"></a><span id="l138.158">                                               nsIMsgFolder **aNewFolder)</span>
<a href="#l138.159"></a><span id="l138.159"> {</span>
<a href="#l138.160"></a><span id="l138.160">   NS_ENSURE_ARG_POINTER(aFolder);</span>
<a href="#l138.161"></a><span id="l138.161">   NS_ENSURE_ARG_POINTER(aNewFolder);</span>
<a href="#l138.162"></a><span id="l138.162"> </span>
<a href="#l138.163"></a><span id="l138.163">   // old path</span>
<a href="#l138.164"></a><span id="l138.164" class="difflineminus">-  nsCOMPtr&lt;nsILocalFile&gt; oldPathFile;</span>
<a href="#l138.165"></a><span id="l138.165" class="difflineplus">+  nsCOMPtr&lt;nsIFile&gt; oldPathFile;</span>
<a href="#l138.166"></a><span id="l138.166">   nsresult rv = aFolder-&gt;GetFilePath(getter_AddRefs(oldPathFile));</span>
<a href="#l138.167"></a><span id="l138.167">   NS_ENSURE_SUCCESS(rv, rv);</span>
<a href="#l138.168"></a><span id="l138.168"> </span>
<a href="#l138.169"></a><span id="l138.169">   // old sbd directory</span>
<a href="#l138.170"></a><span id="l138.170" class="difflineminus">-  nsCOMPtr&lt;nsILocalFile&gt; sbdPathFile;</span>
<a href="#l138.171"></a><span id="l138.171" class="difflineplus">+  nsCOMPtr&lt;nsIFile&gt; sbdPathFile;</span>
<a href="#l138.172"></a><span id="l138.172">   PRUint32 numChildren;</span>
<a href="#l138.173"></a><span id="l138.173">   aFolder-&gt;GetNumSubFolders(&amp;numChildren);</span>
<a href="#l138.174"></a><span id="l138.174">   if (numChildren &gt; 0)</span>
<a href="#l138.175"></a><span id="l138.175">   {</span>
<a href="#l138.176"></a><span id="l138.176">     sbdPathFile = do_CreateInstance(NS_LOCAL_FILE_CONTRACTID, &amp;rv);</span>
<a href="#l138.177"></a><span id="l138.177">     NS_ENSURE_SUCCESS(rv, rv);</span>
<a href="#l138.178"></a><span id="l138.178">     rv = sbdPathFile-&gt;InitWithFile(oldPathFile);</span>
<a href="#l138.179"></a><span id="l138.179">     NS_ENSURE_SUCCESS(rv, rv);</span>
<a href="#l138.180"></a><span id="l138.180">     GetDirectoryForFolder(sbdPathFile);</span>
<a href="#l138.181"></a><span id="l138.181">   }</span>
<a href="#l138.182"></a><span id="l138.182"> </span>
<a href="#l138.183"></a><span id="l138.183">   // old summary</span>
<a href="#l138.184"></a><span id="l138.184" class="difflineminus">-  nsCOMPtr&lt;nsILocalFile&gt; oldSummaryFile;</span>
<a href="#l138.185"></a><span id="l138.185" class="difflineplus">+  nsCOMPtr&lt;nsIFile&gt; oldSummaryFile;</span>
<a href="#l138.186"></a><span id="l138.186">   rv = GetSummaryFile(aFolder, getter_AddRefs(oldSummaryFile));</span>
<a href="#l138.187"></a><span id="l138.187">   NS_ENSURE_SUCCESS(rv, rv);</span>
<a href="#l138.188"></a><span id="l138.188"> </span>
<a href="#l138.189"></a><span id="l138.189">   // Validate new name</span>
<a href="#l138.190"></a><span id="l138.190">   nsAutoString safeName(aNewName);</span>
<a href="#l138.191"></a><span id="l138.191">   NS_MsgHashIfNecessary(safeName);</span>
<a href="#l138.192"></a><span id="l138.192"> </span>
<a href="#l138.193"></a><span id="l138.193">   aFolder-&gt;ForceDBClosed();</span>
<a href="#l138.194"></a><span id="l138.194" class="difflineat">@@ -435,24 +435,24 @@ NS_IMETHODIMP nsMsgMaildirStore::CopyFol</span>
<a href="#l138.195"></a><span id="l138.195">   NS_ENSURE_ARG_POINTER(aDstFolder);</span>
<a href="#l138.196"></a><span id="l138.196">   nsString folderName;</span>
<a href="#l138.197"></a><span id="l138.197">   aSrcFolder-&gt;GetName(folderName);</span>
<a href="#l138.198"></a><span id="l138.198">   nsAutoString safeFolderName(folderName);</span>
<a href="#l138.199"></a><span id="l138.199">   NS_MsgHashIfNecessary(safeFolderName);</span>
<a href="#l138.200"></a><span id="l138.200">   nsCOMPtr&lt;nsIMsgLocalMailFolder&gt; localSrcFolder(do_QueryInterface(aSrcFolder));</span>
<a href="#l138.201"></a><span id="l138.201">   aSrcFolder-&gt;ForceDBClosed();</span>
<a href="#l138.202"></a><span id="l138.202"> </span>
<a href="#l138.203"></a><span id="l138.203" class="difflineminus">-  nsCOMPtr&lt;nsILocalFile&gt; oldPath;</span>
<a href="#l138.204"></a><span id="l138.204" class="difflineplus">+  nsCOMPtr&lt;nsIFile&gt; oldPath;</span>
<a href="#l138.205"></a><span id="l138.205">   nsresult rv = aSrcFolder-&gt;GetFilePath(getter_AddRefs(oldPath));</span>
<a href="#l138.206"></a><span id="l138.206">   NS_ENSURE_SUCCESS(rv,rv);</span>
<a href="#l138.207"></a><span id="l138.207"> </span>
<a href="#l138.208"></a><span id="l138.208" class="difflineminus">-  nsCOMPtr&lt;nsILocalFile&gt; summaryFile;</span>
<a href="#l138.209"></a><span id="l138.209" class="difflineplus">+  nsCOMPtr&lt;nsIFile&gt; summaryFile;</span>
<a href="#l138.210"></a><span id="l138.210">   GetSummaryFileLocation(oldPath, getter_AddRefs(summaryFile));</span>
<a href="#l138.211"></a><span id="l138.211"> </span>
<a href="#l138.212"></a><span id="l138.212" class="difflineminus">-  nsCOMPtr&lt;nsILocalFile&gt; newPath;</span>
<a href="#l138.213"></a><span id="l138.213" class="difflineplus">+  nsCOMPtr&lt;nsIFile&gt; newPath;</span>
<a href="#l138.214"></a><span id="l138.214">   rv = aDstFolder-&gt;GetFilePath(getter_AddRefs(newPath));</span>
<a href="#l138.215"></a><span id="l138.215">   NS_ENSURE_SUCCESS(rv, rv);</span>
<a href="#l138.216"></a><span id="l138.216"> </span>
<a href="#l138.217"></a><span id="l138.217">   // create target directory based on our current path</span>
<a href="#l138.218"></a><span id="l138.218">   bool isServer;</span>
<a href="#l138.219"></a><span id="l138.219">   aDstFolder-&gt;GetIsServer(&amp;isServer);</span>
<a href="#l138.220"></a><span id="l138.220">   rv = CreateDirectoryForFolder(newPath, isServer);</span>
<a href="#l138.221"></a><span id="l138.221">   NS_ENSURE_SUCCESS(rv, rv);</span>
<a href="#l138.222"></a><span id="l138.222" class="difflineat">@@ -549,17 +549,17 @@ NS_IMETHODIMP nsMsgMaildirStore::CopyFol</span>
<a href="#l138.223"></a><span id="l138.223">     if (msgParent)</span>
<a href="#l138.224"></a><span id="l138.224">     {</span>
<a href="#l138.225"></a><span id="l138.225">       // The files have already been moved, so delete storage false</span>
<a href="#l138.226"></a><span id="l138.226">       msgParent-&gt;PropagateDelete(aSrcFolder, false, aMsgWindow);</span>
<a href="#l138.227"></a><span id="l138.227">       oldPath-&gt;Remove(true);</span>
<a href="#l138.228"></a><span id="l138.228">       nsCOMPtr&lt;nsIMsgDatabase&gt; srcDB; // we need to force closed the source db</span>
<a href="#l138.229"></a><span id="l138.229">       aSrcFolder-&gt;Delete();</span>
<a href="#l138.230"></a><span id="l138.230"> </span>
<a href="#l138.231"></a><span id="l138.231" class="difflineminus">-      nsCOMPtr&lt;nsILocalFile&gt; parentPath;</span>
<a href="#l138.232"></a><span id="l138.232" class="difflineplus">+      nsCOMPtr&lt;nsIFile&gt; parentPath;</span>
<a href="#l138.233"></a><span id="l138.233">       rv = msgParent-&gt;GetFilePath(getter_AddRefs(parentPath));</span>
<a href="#l138.234"></a><span id="l138.234">       NS_ENSURE_SUCCESS(rv,rv);</span>
<a href="#l138.235"></a><span id="l138.235"> </span>
<a href="#l138.236"></a><span id="l138.236">       AddDirectorySeparator(parentPath);</span>
<a href="#l138.237"></a><span id="l138.237">       nsCOMPtr&lt;nsISimpleEnumerator&gt; children;</span>
<a href="#l138.238"></a><span id="l138.238">       parentPath-&gt;GetDirectoryEntries(getter_AddRefs(children));</span>
<a href="#l138.239"></a><span id="l138.239">       bool more;</span>
<a href="#l138.240"></a><span id="l138.240">       // checks if the directory is empty or not</span>
<a href="#l138.241"></a><span id="l138.241" class="difflineat">@@ -616,17 +616,17 @@ nsMsgMaildirStore::GetNewMsgOutputStream</span>
<a href="#l138.242"></a><span id="l138.242">   if (!*aNewMsgHdr)</span>
<a href="#l138.243"></a><span id="l138.243">   {</span>
<a href="#l138.244"></a><span id="l138.244">     rv = db-&gt;CreateNewHdr(nsMsgKey_None, aNewMsgHdr);</span>
<a href="#l138.245"></a><span id="l138.245">     NS_ENSURE_SUCCESS(rv, rv);</span>
<a href="#l138.246"></a><span id="l138.246"> </span>
<a href="#l138.247"></a><span id="l138.247">   }</span>
<a href="#l138.248"></a><span id="l138.248">   (*aNewMsgHdr)-&gt;SetMessageOffset(0);</span>
<a href="#l138.249"></a><span id="l138.249">   // path to the message download folder</span>
<a href="#l138.250"></a><span id="l138.250" class="difflineminus">-  nsCOMPtr&lt;nsILocalFile&gt; newFile;</span>
<a href="#l138.251"></a><span id="l138.251" class="difflineplus">+  nsCOMPtr&lt;nsIFile&gt; newFile;</span>
<a href="#l138.252"></a><span id="l138.252">   rv = aFolder-&gt;GetFilePath(getter_AddRefs(newFile));</span>
<a href="#l138.253"></a><span id="l138.253">   NS_ENSURE_SUCCESS(rv, rv);</span>
<a href="#l138.254"></a><span id="l138.254">   newFile-&gt;Append(NS_LITERAL_STRING(&quot;tmp&quot;));</span>
<a href="#l138.255"></a><span id="l138.255"> </span>
<a href="#l138.256"></a><span id="l138.256">   // let's check if the folder exists</span>
<a href="#l138.257"></a><span id="l138.257">   bool exists;</span>
<a href="#l138.258"></a><span id="l138.258">   newFile-&gt;Exists(&amp;exists);</span>
<a href="#l138.259"></a><span id="l138.259">   if (!exists) {</span>
<a href="#l138.260"></a><span id="l138.260" class="difflineat">@@ -658,17 +658,17 @@ nsMsgMaildirStore::DiscardNewMessage(nsI</span>
<a href="#l138.261"></a><span id="l138.261"> </span>
<a href="#l138.262"></a><span id="l138.262">   aOutputStream-&gt;Close();</span>
<a href="#l138.263"></a><span id="l138.263">   // file path is stored in message header property &quot;storeToken&quot;</span>
<a href="#l138.264"></a><span id="l138.264">   nsCAutoString fileName;</span>
<a href="#l138.265"></a><span id="l138.265">   aNewHdr-&gt;GetStringProperty(&quot;storeToken&quot;, getter_Copies(fileName));</span>
<a href="#l138.266"></a><span id="l138.266">   if (fileName.IsEmpty())</span>
<a href="#l138.267"></a><span id="l138.267">     return NS_ERROR_FAILURE;</span>
<a href="#l138.268"></a><span id="l138.268"> </span>
<a href="#l138.269"></a><span id="l138.269" class="difflineminus">-  nsCOMPtr&lt;nsILocalFile&gt; path;</span>
<a href="#l138.270"></a><span id="l138.270" class="difflineplus">+  nsCOMPtr&lt;nsIFile&gt; path;</span>
<a href="#l138.271"></a><span id="l138.271">   nsCOMPtr&lt;nsIMsgFolder&gt; folder;</span>
<a href="#l138.272"></a><span id="l138.272">   nsresult rv = aNewHdr-&gt;GetFolder(getter_AddRefs(folder));</span>
<a href="#l138.273"></a><span id="l138.273">   NS_ENSURE_SUCCESS(rv, rv);</span>
<a href="#l138.274"></a><span id="l138.274">   rv = folder-&gt;GetFilePath(getter_AddRefs(path));</span>
<a href="#l138.275"></a><span id="l138.275">   NS_ENSURE_SUCCESS(rv, rv);</span>
<a href="#l138.276"></a><span id="l138.276"> </span>
<a href="#l138.277"></a><span id="l138.277">   // path to the message download folder</span>
<a href="#l138.278"></a><span id="l138.278">   path-&gt;Append(NS_LITERAL_STRING(&quot;tmp&quot;));</span>
<a href="#l138.279"></a><span id="l138.279" class="difflineat">@@ -681,17 +681,17 @@ NS_IMETHODIMP</span>
<a href="#l138.280"></a><span id="l138.280"> nsMsgMaildirStore::FinishNewMessage(nsIOutputStream *aOutputStream,</span>
<a href="#l138.281"></a><span id="l138.281">                                     nsIMsgDBHdr *aNewHdr)</span>
<a href="#l138.282"></a><span id="l138.282"> {</span>
<a href="#l138.283"></a><span id="l138.283">   NS_ENSURE_ARG_POINTER(aOutputStream);</span>
<a href="#l138.284"></a><span id="l138.284">   NS_ENSURE_ARG_POINTER(aNewHdr);</span>
<a href="#l138.285"></a><span id="l138.285"> </span>
<a href="#l138.286"></a><span id="l138.286">   aOutputStream-&gt;Close();</span>
<a href="#l138.287"></a><span id="l138.287"> </span>
<a href="#l138.288"></a><span id="l138.288" class="difflineminus">-  nsCOMPtr&lt;nsILocalFile&gt; folderPath;</span>
<a href="#l138.289"></a><span id="l138.289" class="difflineplus">+  nsCOMPtr&lt;nsIFile&gt; folderPath;</span>
<a href="#l138.290"></a><span id="l138.290">   nsCOMPtr&lt;nsIMsgFolder&gt; folder;</span>
<a href="#l138.291"></a><span id="l138.291">   nsresult rv = aNewHdr-&gt;GetFolder(getter_AddRefs(folder));</span>
<a href="#l138.292"></a><span id="l138.292">   NS_ENSURE_SUCCESS(rv, rv);</span>
<a href="#l138.293"></a><span id="l138.293">   rv = folder-&gt;GetFilePath(getter_AddRefs(folderPath));</span>
<a href="#l138.294"></a><span id="l138.294">   NS_ENSURE_SUCCESS(rv, rv);</span>
<a href="#l138.295"></a><span id="l138.295"> </span>
<a href="#l138.296"></a><span id="l138.296">   // file path is stored in message header property</span>
<a href="#l138.297"></a><span id="l138.297">   nsCAutoString fileName;</span>
<a href="#l138.298"></a><span id="l138.298" class="difflineat">@@ -737,17 +737,17 @@ NS_IMETHODIMP</span>
<a href="#l138.299"></a><span id="l138.299"> nsMsgMaildirStore::MoveNewlyDownloadedMessage(nsIMsgDBHdr *aNewHdr,</span>
<a href="#l138.300"></a><span id="l138.300">                                               nsIMsgFolder *aDestFolder,</span>
<a href="#l138.301"></a><span id="l138.301">                                               bool *aResult)</span>
<a href="#l138.302"></a><span id="l138.302"> {</span>
<a href="#l138.303"></a><span id="l138.303">   NS_ENSURE_ARG_POINTER(aNewHdr);</span>
<a href="#l138.304"></a><span id="l138.304">   NS_ENSURE_ARG_POINTER(aDestFolder);</span>
<a href="#l138.305"></a><span id="l138.305">   NS_ENSURE_ARG_POINTER(aResult);</span>
<a href="#l138.306"></a><span id="l138.306"> </span>
<a href="#l138.307"></a><span id="l138.307" class="difflineminus">-  nsCOMPtr&lt;nsILocalFile&gt; folderPath;</span>
<a href="#l138.308"></a><span id="l138.308" class="difflineplus">+  nsCOMPtr&lt;nsIFile&gt; folderPath;</span>
<a href="#l138.309"></a><span id="l138.309">   nsCOMPtr&lt;nsIMsgFolder&gt; folder;</span>
<a href="#l138.310"></a><span id="l138.310">   nsresult rv = aNewHdr-&gt;GetFolder(getter_AddRefs(folder));</span>
<a href="#l138.311"></a><span id="l138.311">   NS_ENSURE_SUCCESS(rv, rv);</span>
<a href="#l138.312"></a><span id="l138.312">   rv = folder-&gt;GetFilePath(getter_AddRefs(folderPath));</span>
<a href="#l138.313"></a><span id="l138.313">   NS_ENSURE_SUCCESS(rv, rv);</span>
<a href="#l138.314"></a><span id="l138.314"> </span>
<a href="#l138.315"></a><span id="l138.315">   // file path is stored in message header property</span>
<a href="#l138.316"></a><span id="l138.316">   nsCAutoString fileName;</span>
<a href="#l138.317"></a><span id="l138.317" class="difflineat">@@ -803,17 +803,17 @@ nsMsgMaildirStore::GetMsgInputStream(nsI</span>
<a href="#l138.318"></a><span id="l138.318">   NS_ENSURE_ARG_POINTER(aMsgFolder);</span>
<a href="#l138.319"></a><span id="l138.319">   NS_ENSURE_ARG_POINTER(aOffset);</span>
<a href="#l138.320"></a><span id="l138.320">   NS_ENSURE_ARG_POINTER(aResult);</span>
<a href="#l138.321"></a><span id="l138.321"> </span>
<a href="#l138.322"></a><span id="l138.322">   *aReusable = false; // message per file</span>
<a href="#l138.323"></a><span id="l138.323">   *aOffset = 0;</span>
<a href="#l138.324"></a><span id="l138.324"> </span>
<a href="#l138.325"></a><span id="l138.325">   // construct path to file</span>
<a href="#l138.326"></a><span id="l138.326" class="difflineminus">-  nsCOMPtr&lt;nsILocalFile&gt; path;</span>
<a href="#l138.327"></a><span id="l138.327" class="difflineplus">+  nsCOMPtr&lt;nsIFile&gt; path;</span>
<a href="#l138.328"></a><span id="l138.328">   nsresult rv = aMsgFolder-&gt;GetFilePath(getter_AddRefs(path));</span>
<a href="#l138.329"></a><span id="l138.329">   NS_ENSURE_SUCCESS(rv, rv);</span>
<a href="#l138.330"></a><span id="l138.330"> </span>
<a href="#l138.331"></a><span id="l138.331">   if (aMsgToken.IsEmpty())</span>
<a href="#l138.332"></a><span id="l138.332">   {</span>
<a href="#l138.333"></a><span id="l138.333">     PR_LOG(MailDirLog, PR_LOG_ALWAYS,</span>
<a href="#l138.334"></a><span id="l138.334">            (&quot;GetMsgInputStream - empty storeToken!!\n&quot;));</span>
<a href="#l138.335"></a><span id="l138.335">     return NS_ERROR_FAILURE;</span>
<a href="#l138.336"></a><span id="l138.336" class="difflineat">@@ -843,17 +843,17 @@ NS_IMETHODIMP nsMsgMaildirStore::DeleteM</span>
<a href="#l138.337"></a><span id="l138.337">   nsCOMPtr&lt;nsIMsgFolder&gt; folder;</span>
<a href="#l138.338"></a><span id="l138.338"> </span>
<a href="#l138.339"></a><span id="l138.339">   for (PRUint32 i = 0; i &lt; messageCount; i++)</span>
<a href="#l138.340"></a><span id="l138.340">   {</span>
<a href="#l138.341"></a><span id="l138.341">     nsCOMPtr&lt;nsIMsgDBHdr&gt; msgHdr = do_QueryElementAt(aHdrArray, i, &amp;rv);</span>
<a href="#l138.342"></a><span id="l138.342">     if (NS_FAILED(rv))</span>
<a href="#l138.343"></a><span id="l138.343">       continue;</span>
<a href="#l138.344"></a><span id="l138.344">     msgHdr-&gt;GetFolder(getter_AddRefs(folder));</span>
<a href="#l138.345"></a><span id="l138.345" class="difflineminus">-    nsCOMPtr&lt;nsILocalFile&gt; path;</span>
<a href="#l138.346"></a><span id="l138.346" class="difflineplus">+    nsCOMPtr&lt;nsIFile&gt; path;</span>
<a href="#l138.347"></a><span id="l138.347">     rv = folder-&gt;GetFilePath(getter_AddRefs(path));</span>
<a href="#l138.348"></a><span id="l138.348">     NS_ENSURE_SUCCESS(rv, rv);</span>
<a href="#l138.349"></a><span id="l138.349">     nsCAutoString fileName;</span>
<a href="#l138.350"></a><span id="l138.350">     msgHdr-&gt;GetStringProperty(&quot;storeToken&quot;, getter_Copies(fileName));</span>
<a href="#l138.351"></a><span id="l138.351">     if (fileName.IsEmpty())</span>
<a href="#l138.352"></a><span id="l138.352">       return NS_ERROR_FAILURE;</span>
<a href="#l138.353"></a><span id="l138.353"> </span>
<a href="#l138.354"></a><span id="l138.354">     if (fileName.IsEmpty())</span>
<a href="#l138.355"></a><span id="l138.355" class="difflineat">@@ -884,17 +884,17 @@ nsMsgMaildirStore::CopyMessages(bool aIs</span>
<a href="#l138.356"></a><span id="l138.356">   NS_ENSURE_ARG_POINTER(aHdrArray);</span>
<a href="#l138.357"></a><span id="l138.357">   NS_ENSURE_ARG_POINTER(aDstFolder);</span>
<a href="#l138.358"></a><span id="l138.358">   NS_ENSURE_ARG_POINTER(aCopyDone);</span>
<a href="#l138.359"></a><span id="l138.359">   NS_ENSURE_ARG_POINTER(aUndoAction);</span>
<a href="#l138.360"></a><span id="l138.360">   PRUint32 messageCount;</span>
<a href="#l138.361"></a><span id="l138.361">   nsresult rv = aHdrArray-&gt;GetLength(&amp;messageCount);</span>
<a href="#l138.362"></a><span id="l138.362">   NS_ENSURE_SUCCESS(rv, rv);</span>
<a href="#l138.363"></a><span id="l138.363">   nsCOMPtr&lt;nsIMsgFolder&gt; srcFolder;</span>
<a href="#l138.364"></a><span id="l138.364" class="difflineminus">-  nsCOMPtr&lt;nsILocalFile&gt; destFolderPath;</span>
<a href="#l138.365"></a><span id="l138.365" class="difflineplus">+  nsCOMPtr&lt;nsIFile&gt; destFolderPath;</span>
<a href="#l138.366"></a><span id="l138.366">   nsCOMPtr&lt;nsIMsgDatabase&gt; destDB;</span>
<a href="#l138.367"></a><span id="l138.367">   nsCOMPtr&lt;nsIMsgDatabase&gt; srcDB;</span>
<a href="#l138.368"></a><span id="l138.368">   aDstFolder-&gt;GetMsgDatabase(getter_AddRefs(destDB));</span>
<a href="#l138.369"></a><span id="l138.369">   aDstFolder-&gt;GetFilePath(getter_AddRefs(destFolderPath));</span>
<a href="#l138.370"></a><span id="l138.370">   destFolderPath-&gt;Append(NS_LITERAL_STRING(&quot;cur&quot;));</span>
<a href="#l138.371"></a><span id="l138.371"> </span>
<a href="#l138.372"></a><span id="l138.372">   nsCOMPtr&lt;nsIMsgDBHdr&gt; msgHdr = do_QueryElementAt(aHdrArray, 0, &amp;rv);</span>
<a href="#l138.373"></a><span id="l138.373">   NS_ENSURE_SUCCESS(rv, rv);</span>
<a href="#l138.374"></a><span id="l138.374" class="difflineat">@@ -917,17 +917,17 @@ nsMsgMaildirStore::CopyMessages(bool aIs</span>
<a href="#l138.375"></a><span id="l138.375">   {</span>
<a href="#l138.376"></a><span id="l138.376">     nsCOMPtr&lt;nsIMsgDBHdr&gt; msgHdr = do_QueryElementAt(aHdrArray, i, &amp;rv);</span>
<a href="#l138.377"></a><span id="l138.377">     if (NS_FAILED(rv))</span>
<a href="#l138.378"></a><span id="l138.378">       continue;</span>
<a href="#l138.379"></a><span id="l138.379">     nsMsgKey srcKey;</span>
<a href="#l138.380"></a><span id="l138.380">     msgHdr-&gt;GetMessageKey(&amp;srcKey);</span>
<a href="#l138.381"></a><span id="l138.381">     msgTxn-&gt;AddSrcKey(srcKey);</span>
<a href="#l138.382"></a><span id="l138.382">     msgHdr-&gt;GetFolder(getter_AddRefs(srcFolder));</span>
<a href="#l138.383"></a><span id="l138.383" class="difflineminus">-    nsCOMPtr&lt;nsILocalFile&gt; path;</span>
<a href="#l138.384"></a><span id="l138.384" class="difflineplus">+    nsCOMPtr&lt;nsIFile&gt; path;</span>
<a href="#l138.385"></a><span id="l138.385">     rv = srcFolder-&gt;GetFilePath(getter_AddRefs(path));</span>
<a href="#l138.386"></a><span id="l138.386">     NS_ENSURE_SUCCESS(rv, rv);</span>
<a href="#l138.387"></a><span id="l138.387">     nsCAutoString fileName;</span>
<a href="#l138.388"></a><span id="l138.388">     msgHdr-&gt;GetStringProperty(&quot;storeToken&quot;, getter_Copies(fileName));</span>
<a href="#l138.389"></a><span id="l138.389">     if (fileName.IsEmpty())</span>
<a href="#l138.390"></a><span id="l138.390">       return NS_ERROR_FAILURE;</span>
<a href="#l138.391"></a><span id="l138.391"> </span>
<a href="#l138.392"></a><span id="l138.392">     if (fileName.IsEmpty())</span>
<a href="#l138.393"></a><span id="l138.393" class="difflineat">@@ -1049,19 +1049,17 @@ nsresult MaildirStoreParser::ParseNextMe</span>
<a href="#l138.394"></a><span id="l138.394">   NS_ENSURE_SUCCESS(rv, rv);</span>
<a href="#l138.395"></a><span id="l138.395">   msgParser-&gt;SetMailDB(m_db);</span>
<a href="#l138.396"></a><span id="l138.396">   nsCOMPtr&lt;nsIMsgDBHdr&gt; newMsgHdr;</span>
<a href="#l138.397"></a><span id="l138.397">   rv = m_db-&gt;CreateNewHdr(nsMsgKey_None, getter_AddRefs(newMsgHdr));</span>
<a href="#l138.398"></a><span id="l138.398">   NS_ENSURE_SUCCESS(rv, rv);</span>
<a href="#l138.399"></a><span id="l138.399"> </span>
<a href="#l138.400"></a><span id="l138.400">   newMsgHdr-&gt;SetMessageOffset(0);</span>
<a href="#l138.401"></a><span id="l138.401"> </span>
<a href="#l138.402"></a><span id="l138.402" class="difflineminus">-  nsCOMPtr&lt;nsILocalFile&gt; localFile = do_QueryInterface(aFile);</span>
<a href="#l138.403"></a><span id="l138.403" class="difflineminus">-  if (NS_SUCCEEDED(rv))</span>
<a href="#l138.404"></a><span id="l138.404" class="difflineminus">-    rv = NS_NewLocalFileInputStream(getter_AddRefs(inputStream), localFile);</span>
<a href="#l138.405"></a><span id="l138.405" class="difflineplus">+  rv = NS_NewLocalFileInputStream(getter_AddRefs(inputStream), aFile);</span>
<a href="#l138.406"></a><span id="l138.406">   if (NS_SUCCEEDED(rv) &amp;&amp; inputStream)</span>
<a href="#l138.407"></a><span id="l138.407">   {</span>
<a href="#l138.408"></a><span id="l138.408">     PRInt32 inputBufferSize = 10240;</span>
<a href="#l138.409"></a><span id="l138.409">     nsMsgLineStreamBuffer *inputStreamBuffer =</span>
<a href="#l138.410"></a><span id="l138.410">       new nsMsgLineStreamBuffer(inputBufferSize, true, false);</span>
<a href="#l138.411"></a><span id="l138.411">     PRInt64 fileSize;</span>
<a href="#l138.412"></a><span id="l138.412">     aFile-&gt;GetFileSize(&amp;fileSize);</span>
<a href="#l138.413"></a><span id="l138.413">     msgParser-&gt;SetNewMsgHdr(newMsgHdr);</span>
<a href="#l138.414"></a><span id="l138.414" class="difflineat">@@ -1083,17 +1081,17 @@ nsresult MaildirStoreParser::ParseNextMe</span>
<a href="#l138.415"></a><span id="l138.415">       }</span>
<a href="#l138.416"></a><span id="l138.416">     } while (newLine &amp;&amp; numBytesInLine &gt; 0);</span>
<a href="#l138.417"></a><span id="l138.417"> </span>
<a href="#l138.418"></a><span id="l138.418">     msgParser-&gt;FinishHeader();</span>
<a href="#l138.419"></a><span id="l138.419">     // A single message needs to be less than 4GB</span>
<a href="#l138.420"></a><span id="l138.420">     newMsgHdr-&gt;SetMessageSize((PRUint32) fileSize);</span>
<a href="#l138.421"></a><span id="l138.421">     m_db-&gt;AddNewHdrToDB(newMsgHdr, true);</span>
<a href="#l138.422"></a><span id="l138.422">     nsCAutoString storeToken;</span>
<a href="#l138.423"></a><span id="l138.423" class="difflineminus">-    localFile-&gt;GetNativeLeafName(storeToken);</span>
<a href="#l138.424"></a><span id="l138.424" class="difflineplus">+    aFile-&gt;GetNativeLeafName(storeToken);</span>
<a href="#l138.425"></a><span id="l138.425">     newMsgHdr-&gt;SetStringProperty(&quot;storeToken&quot;, storeToken.get());</span>
<a href="#l138.426"></a><span id="l138.426">   }</span>
<a href="#l138.427"></a><span id="l138.427">   NS_ENSURE_SUCCESS(rv, rv);</span>
<a href="#l138.428"></a><span id="l138.428">   return rv;</span>
<a href="#l138.429"></a><span id="l138.429"> }</span>
<a href="#l138.430"></a><span id="l138.430"> </span>
<a href="#l138.431"></a><span id="l138.431"> void MaildirStoreParser::TimerCallback(nsITimer *aTimer, void *aClosure)</span>
<a href="#l138.432"></a><span id="l138.432"> {</span>
<a href="#l138.433"></a><span id="l138.433" class="difflineat">@@ -1146,17 +1144,17 @@ nsresult MaildirStoreParser::StartTimer(</span>
<a href="#l138.434"></a><span id="l138.434"> NS_IMETHODIMP nsMsgMaildirStore::RebuildIndex(nsIMsgFolder *aFolder,</span>
<a href="#l138.435"></a><span id="l138.435">                                               nsIMsgDatabase *aMsgDB,</span>
<a href="#l138.436"></a><span id="l138.436">                                               nsIMsgWindow *aMsgWindow,</span>
<a href="#l138.437"></a><span id="l138.437">                                               nsIUrlListener *aListener)</span>
<a href="#l138.438"></a><span id="l138.438"> {</span>
<a href="#l138.439"></a><span id="l138.439">   NS_ENSURE_ARG_POINTER(aFolder);</span>
<a href="#l138.440"></a><span id="l138.440">   // This code needs to iterate over the maildir files, and parse each</span>
<a href="#l138.441"></a><span id="l138.441">   // file and add a msg hdr to the db for the file.</span>
<a href="#l138.442"></a><span id="l138.442" class="difflineminus">-  nsCOMPtr&lt;nsILocalFile&gt; path;</span>
<a href="#l138.443"></a><span id="l138.443" class="difflineplus">+  nsCOMPtr&lt;nsIFile&gt; path;</span>
<a href="#l138.444"></a><span id="l138.444">   nsresult rv = aFolder-&gt;GetFilePath(getter_AddRefs(path));</span>
<a href="#l138.445"></a><span id="l138.445">   NS_ENSURE_SUCCESS(rv, rv);</span>
<a href="#l138.446"></a><span id="l138.446">   path-&gt;Append(NS_LITERAL_STRING(&quot;cur&quot;));</span>
<a href="#l138.447"></a><span id="l138.447"> </span>
<a href="#l138.448"></a><span id="l138.448">   nsCOMPtr&lt;nsISimpleEnumerator&gt; directoryEnumerator;</span>
<a href="#l138.449"></a><span id="l138.449">   rv = path-&gt;GetDirectoryEntries(getter_AddRefs(directoryEnumerator));</span>
<a href="#l138.450"></a><span id="l138.450">   NS_ENSURE_SUCCESS(rv, rv);</span>
<a href="#l138.451"></a><span id="l138.451"> </span>
<a href="#l138.452"></a><span id="l138.452" class="difflineat">@@ -1203,27 +1201,26 @@ nsMsgMaildirStore::GetOutputStream(nsIMs</span>
<a href="#l138.453"></a><span id="l138.453">   aHdr-&gt;GetStringProperty(&quot;storeToken&quot;, getter_Copies(fileName));</span>
<a href="#l138.454"></a><span id="l138.454">   if (fileName.IsEmpty())</span>
<a href="#l138.455"></a><span id="l138.455">     return NS_ERROR_FAILURE;</span>
<a href="#l138.456"></a><span id="l138.456"> </span>
<a href="#l138.457"></a><span id="l138.457">   nsCOMPtr&lt;nsIMsgFolder&gt; folder;</span>
<a href="#l138.458"></a><span id="l138.458">   nsresult rv = aHdr-&gt;GetFolder(getter_AddRefs(folder));</span>
<a href="#l138.459"></a><span id="l138.459">   NS_ENSURE_SUCCESS(rv, rv);</span>
<a href="#l138.460"></a><span id="l138.460"> </span>
<a href="#l138.461"></a><span id="l138.461" class="difflineminus">-  nsCOMPtr&lt;nsILocalFile&gt; folderPath;</span>
<a href="#l138.462"></a><span id="l138.462" class="difflineplus">+  nsCOMPtr&lt;nsIFile&gt; folderPath;</span>
<a href="#l138.463"></a><span id="l138.463">   rv = folder-&gt;GetFilePath(getter_AddRefs(folderPath));</span>
<a href="#l138.464"></a><span id="l138.464">   NS_ENSURE_SUCCESS(rv, rv);</span>
<a href="#l138.465"></a><span id="l138.465"> </span>
<a href="#l138.466"></a><span id="l138.466">   nsCOMPtr&lt;nsIFile&gt; maildirFile;</span>
<a href="#l138.467"></a><span id="l138.467">   folderPath-&gt;Clone(getter_AddRefs(maildirFile));</span>
<a href="#l138.468"></a><span id="l138.468">   maildirFile-&gt;Append(NS_LITERAL_STRING(&quot;cur&quot;));</span>
<a href="#l138.469"></a><span id="l138.469">   maildirFile-&gt;AppendNative(fileName);</span>
<a href="#l138.470"></a><span id="l138.470"> </span>
<a href="#l138.471"></a><span id="l138.471" class="difflineminus">-  nsCOMPtr&lt;nsILocalFile&gt; localFile = do_QueryInterface(maildirFile);</span>
<a href="#l138.472"></a><span id="l138.472" class="difflineminus">-  return MsgGetFileStream(localFile, getter_AddRefs(aOutputStream));</span>
<a href="#l138.473"></a><span id="l138.473" class="difflineplus">+  return MsgGetFileStream(maildirFile, getter_AddRefs(aOutputStream));</span>
<a href="#l138.474"></a><span id="l138.474"> }</span>
<a href="#l138.475"></a><span id="l138.475"> </span>
<a href="#l138.476"></a><span id="l138.476"> NS_IMETHODIMP nsMsgMaildirStore::ChangeKeywords(nsIArray *aHdrArray,</span>
<a href="#l138.477"></a><span id="l138.477">                                              const nsACString &amp;aKeywords,</span>
<a href="#l138.478"></a><span id="l138.478">                                              bool aAdd)</span>
<a href="#l138.479"></a><span id="l138.479"> {</span>
<a href="#l138.480"></a><span id="l138.480">   NS_ENSURE_ARG_POINTER(aHdrArray);</span>
<a href="#l138.481"></a><span id="l138.481">   NS_ENSURE_ARG_POINTER(aHdrArray);</span>
<a href="#l138.482"></a><span id="l138.482" class="difflineat">@@ -1271,26 +1268,26 @@ NS_IMETHODIMP nsMsgMaildirStore::ChangeK</span>
<a href="#l138.483"></a><span id="l138.483">   return NS_OK;</span>
<a href="#l138.484"></a><span id="l138.484"> }</span>
<a href="#l138.485"></a><span id="l138.485"> </span>
<a href="#l138.486"></a><span id="l138.486"> /**</span>
<a href="#l138.487"></a><span id="l138.487">  * Finds the directory associated with this folder. That is if the path is</span>
<a href="#l138.488"></a><span id="l138.488">  * c:\Inbox, it will return c:\Inbox.sbd if it succeeds. Path is strictly</span>
<a href="#l138.489"></a><span id="l138.489">  * an out parameter.</span>
<a href="#l138.490"></a><span id="l138.490">  */</span>
<a href="#l138.491"></a><span id="l138.491" class="difflineminus">-nsresult nsMsgMaildirStore::GetDirectoryForFolder(nsILocalFile *path)</span>
<a href="#l138.492"></a><span id="l138.492" class="difflineplus">+nsresult nsMsgMaildirStore::GetDirectoryForFolder(nsIFile *path)</span>
<a href="#l138.493"></a><span id="l138.493"> {</span>
<a href="#l138.494"></a><span id="l138.494">   // add directory separator to the path</span>
<a href="#l138.495"></a><span id="l138.495">   nsAutoString leafName;</span>
<a href="#l138.496"></a><span id="l138.496">   path-&gt;GetLeafName(leafName);</span>
<a href="#l138.497"></a><span id="l138.497">   leafName.AppendLiteral(FOLDER_SUFFIX);</span>
<a href="#l138.498"></a><span id="l138.498">   return path-&gt;SetLeafName(leafName);</span>
<a href="#l138.499"></a><span id="l138.499"> }</span>
<a href="#l138.500"></a><span id="l138.500"> </span>
<a href="#l138.501"></a><span id="l138.501" class="difflineminus">-nsresult nsMsgMaildirStore::CreateDirectoryForFolder(nsILocalFile *path,</span>
<a href="#l138.502"></a><span id="l138.502" class="difflineplus">+nsresult nsMsgMaildirStore::CreateDirectoryForFolder(nsIFile *path,</span>
<a href="#l138.503"></a><span id="l138.503">                                                      bool aIsServer)</span>
<a href="#l138.504"></a><span id="l138.504"> {</span>
<a href="#l138.505"></a><span id="l138.505">   nsresult rv = NS_OK;</span>
<a href="#l138.506"></a><span id="l138.506">   if (!aIsServer)</span>
<a href="#l138.507"></a><span id="l138.507">   {</span>
<a href="#l138.508"></a><span id="l138.508">     rv = GetDirectoryForFolder(path);</span>
<a href="#l138.509"></a><span id="l138.509">     NS_ENSURE_SUCCESS(rv, rv);</span>
<a href="#l138.510"></a><span id="l138.510">   }</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l139.1"></a><span id="l139.1" class="difflineminus">--- a/mailnews/local/src/nsMsgMaildirStore.h</span>
<a href="#l139.2"></a><span id="l139.2" class="difflineplus">+++ b/mailnews/local/src/nsMsgMaildirStore.h</span>
<a href="#l139.3"></a><span id="l139.3" class="difflineat">@@ -6,34 +6,34 @@</span>
<a href="#l139.4"></a><span id="l139.4"> /**</span>
<a href="#l139.5"></a><span id="l139.5">    Class for handling Maildir stores.</span>
<a href="#l139.6"></a><span id="l139.6"> */</span>
<a href="#l139.7"></a><span id="l139.7"> </span>
<a href="#l139.8"></a><span id="l139.8"> #ifndef nsMsgMaildirStore_h__</span>
<a href="#l139.9"></a><span id="l139.9"> #define nsMsgMaildirStore_h__</span>
<a href="#l139.10"></a><span id="l139.10"> </span>
<a href="#l139.11"></a><span id="l139.11"> #include &quot;nsMsgLocalStoreUtils.h&quot;</span>
<a href="#l139.12"></a><span id="l139.12" class="difflineminus">-#include &quot;nsILocalFile.h&quot;</span>
<a href="#l139.13"></a><span id="l139.13" class="difflineplus">+#include &quot;nsIFile.h&quot;</span>
<a href="#l139.14"></a><span id="l139.14"> #include &quot;nsInterfaceHashtable.h&quot;</span>
<a href="#l139.15"></a><span id="l139.15"> #include &quot;nsMsgMessageFlags.h&quot;</span>
<a href="#l139.16"></a><span id="l139.16"> </span>
<a href="#l139.17"></a><span id="l139.17"> class nsMsgMaildirStore : public nsMsgLocalStoreUtils, nsIMsgPluggableStore</span>
<a href="#l139.18"></a><span id="l139.18"> {</span>
<a href="#l139.19"></a><span id="l139.19"> public:</span>
<a href="#l139.20"></a><span id="l139.20">   NS_DECL_ISUPPORTS</span>
<a href="#l139.21"></a><span id="l139.21">   NS_DECL_NSIMSGPLUGGABLESTORE</span>
<a href="#l139.22"></a><span id="l139.22"> </span>
<a href="#l139.23"></a><span id="l139.23">   nsMsgMaildirStore();</span>
<a href="#l139.24"></a><span id="l139.24"> </span>
<a href="#l139.25"></a><span id="l139.25"> private:</span>
<a href="#l139.26"></a><span id="l139.26">   ~nsMsgMaildirStore();</span>
<a href="#l139.27"></a><span id="l139.27"> </span>
<a href="#l139.28"></a><span id="l139.28"> protected:</span>
<a href="#l139.29"></a><span id="l139.29" class="difflineminus">-  nsresult GetDirectoryForFolder(nsILocalFile *path);</span>
<a href="#l139.30"></a><span id="l139.30" class="difflineminus">-  nsresult CreateDirectoryForFolder(nsILocalFile *path, bool aIsServer);</span>
<a href="#l139.31"></a><span id="l139.31" class="difflineplus">+  nsresult GetDirectoryForFolder(nsIFile *path);</span>
<a href="#l139.32"></a><span id="l139.32" class="difflineplus">+  nsresult CreateDirectoryForFolder(nsIFile *path, bool aIsServer);</span>
<a href="#l139.33"></a><span id="l139.33"> </span>
<a href="#l139.34"></a><span id="l139.34" class="difflineminus">-  nsresult CreateMaildir(nsILocalFile *path);</span>
<a href="#l139.35"></a><span id="l139.35" class="difflineplus">+  nsresult CreateMaildir(nsIFile *path);</span>
<a href="#l139.36"></a><span id="l139.36">   nsresult AddSubFolders(nsIMsgFolder *parent, nsIFile *path, bool deep);</span>
<a href="#l139.37"></a><span id="l139.37">   nsresult GetOutputStream(nsIMsgDBHdr *aHdr,</span>
<a href="#l139.38"></a><span id="l139.38">                            nsCOMPtr&lt;nsIOutputStream&gt; &amp;aOutputStream);</span>
<a href="#l139.39"></a><span id="l139.39"> </span>
<a href="#l139.40"></a><span id="l139.40"> };</span>
<a href="#l139.41"></a><span id="l139.41"> #endif</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l140.1"></a><span id="l140.1" class="difflineminus">--- a/mailnews/local/src/nsNoIncomingServer.cpp</span>
<a href="#l140.2"></a><span id="l140.2" class="difflineplus">+++ b/mailnews/local/src/nsNoIncomingServer.cpp</span>
<a href="#l140.3"></a><span id="l140.3" class="difflineat">@@ -68,17 +68,17 @@ nsNoIncomingServer::SetFlagsOnDefaultMai</span>
<a href="#l140.4"></a><span id="l140.4">                           nsMsgFolderFlags::Inbox |</span>
<a href="#l140.5"></a><span id="l140.5">                           nsMsgFolderFlags::Queue;</span>
<a href="#l140.6"></a><span id="l140.6"> </span>
<a href="#l140.7"></a><span id="l140.7">   localFolder-&gt;SetFlagsOnDefaultMailboxes(mailboxFlags);</span>
<a href="#l140.8"></a><span id="l140.8"> </span>
<a href="#l140.9"></a><span id="l140.9">   return NS_OK;</span>
<a href="#l140.10"></a><span id="l140.10"> }</span>
<a href="#l140.11"></a><span id="l140.11"> </span>
<a href="#l140.12"></a><span id="l140.12" class="difflineminus">-NS_IMETHODIMP nsNoIncomingServer::CopyDefaultMessages(const char *folderNameOnDisk, nsILocalFile *parentDir)</span>
<a href="#l140.13"></a><span id="l140.13" class="difflineplus">+NS_IMETHODIMP nsNoIncomingServer::CopyDefaultMessages(const char *folderNameOnDisk, nsIFile *parentDir)</span>
<a href="#l140.14"></a><span id="l140.14"> {</span>
<a href="#l140.15"></a><span id="l140.15">   nsresult rv;</span>
<a href="#l140.16"></a><span id="l140.16">   bool exists;</span>
<a href="#l140.17"></a><span id="l140.17">   if (!folderNameOnDisk || !parentDir) return NS_ERROR_NULL_POINTER;</span>
<a href="#l140.18"></a><span id="l140.18"> </span>
<a href="#l140.19"></a><span id="l140.19">   nsCOMPtr&lt;nsIMsgMailSession&gt; mailSession = do_GetService(NS_MSGMAILSESSION_CONTRACTID, &amp;rv);</span>
<a href="#l140.20"></a><span id="l140.20">   NS_ENSURE_SUCCESS(rv, rv);</span>
<a href="#l140.21"></a><span id="l140.21"> </span>
<a href="#l140.22"></a><span id="l140.22" class="difflineat">@@ -151,18 +151,17 @@ NS_IMETHODIMP nsNoIncomingServer::Create</span>
<a href="#l140.23"></a><span id="l140.23">     CreateLocalFolder(NS_LITERAL_STRING(&quot;Inbox&quot;));</span>
<a href="#l140.24"></a><span id="l140.24">   CreateLocalFolder(NS_LITERAL_STRING(&quot;Trash&quot;));</span>
<a href="#l140.25"></a><span id="l140.25">   NS_ENSURE_SUCCESS(rv, rv);</span>
<a href="#l140.26"></a><span id="l140.26"> </span>
<a href="#l140.27"></a><span id="l140.27">   // copy the default templates into the Templates folder</span>
<a href="#l140.28"></a><span id="l140.28">   nsCOMPtr&lt;nsIFile&gt; parentDir;</span>
<a href="#l140.29"></a><span id="l140.29">   rv = path-&gt;GetParent(getter_AddRefs(parentDir));</span>
<a href="#l140.30"></a><span id="l140.30">   NS_ENSURE_SUCCESS(rv, rv);</span>
<a href="#l140.31"></a><span id="l140.31" class="difflineminus">-  nsCOMPtr &lt;nsILocalFile&gt; parent = do_QueryInterface(parentDir);</span>
<a href="#l140.32"></a><span id="l140.32" class="difflineminus">-  rv = CopyDefaultMessages(&quot;Templates&quot;, parent);</span>
<a href="#l140.33"></a><span id="l140.33" class="difflineplus">+  rv = CopyDefaultMessages(&quot;Templates&quot;, parentDir);</span>
<a href="#l140.34"></a><span id="l140.34">   NS_ENSURE_SUCCESS(rv, rv);</span>
<a href="#l140.35"></a><span id="l140.35"> </span>
<a href="#l140.36"></a><span id="l140.36">   (void ) CreateLocalFolder(NS_LITERAL_STRING(&quot;Unsent Messages&quot;));</span>
<a href="#l140.37"></a><span id="l140.37">   return NS_OK;</span>
<a href="#l140.38"></a><span id="l140.38"> }</span>
<a href="#l140.39"></a><span id="l140.39"> </span>
<a href="#l140.40"></a><span id="l140.40"> NS_IMETHODIMP</span>
<a href="#l140.41"></a><span id="l140.41"> nsNoIncomingServer::GetNewMail(nsIMsgWindow *aMsgWindow, nsIUrlListener *aUrlListener, nsIMsgFolder *aInbox, nsIURI **aResult)</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l141.1"></a><span id="l141.1" class="difflineminus">--- a/mailnews/local/src/nsNoneService.cpp</span>
<a href="#l141.2"></a><span id="l141.2" class="difflineplus">+++ b/mailnews/local/src/nsNoneService.cpp</span>
<a href="#l141.3"></a><span id="l141.3" class="difflineat">@@ -7,17 +7,17 @@</span>
<a href="#l141.4"></a><span id="l141.4"> </span>
<a href="#l141.5"></a><span id="l141.5"> #include &quot;nsNoneService.h&quot;</span>
<a href="#l141.6"></a><span id="l141.6"> #include &quot;nsINoIncomingServer.h&quot;</span>
<a href="#l141.7"></a><span id="l141.7"> #include &quot;nsINoneService.h&quot;</span>
<a href="#l141.8"></a><span id="l141.8"> #include &quot;nsIMsgProtocolInfo.h&quot;</span>
<a href="#l141.9"></a><span id="l141.9"> </span>
<a href="#l141.10"></a><span id="l141.10"> #include &quot;nsMsgLocalCID.h&quot;</span>
<a href="#l141.11"></a><span id="l141.11"> #include &quot;nsMsgBaseCID.h&quot;</span>
<a href="#l141.12"></a><span id="l141.12" class="difflineminus">-#include &quot;nsILocalFile.h&quot;</span>
<a href="#l141.13"></a><span id="l141.13" class="difflineplus">+#include &quot;nsIFile.h&quot;</span>
<a href="#l141.14"></a><span id="l141.14"> #include &quot;nsCOMPtr.h&quot;</span>
<a href="#l141.15"></a><span id="l141.15"> #include &quot;nsMsgUtils.h&quot;</span>
<a href="#l141.16"></a><span id="l141.16"> </span>
<a href="#l141.17"></a><span id="l141.17"> #include &quot;nsIDirectoryService.h&quot;</span>
<a href="#l141.18"></a><span id="l141.18"> #include &quot;nsMailDirServiceDefs.h&quot;</span>
<a href="#l141.19"></a><span id="l141.19"> </span>
<a href="#l141.20"></a><span id="l141.20"> #define PREF_MAIL_ROOT_NONE &quot;mail.root.none&quot;        // old - for backward compatibility only</span>
<a href="#l141.21"></a><span id="l141.21"> #define PREF_MAIL_ROOT_NONE_REL &quot;mail.root.none-rel&quot;</span>
<a href="#l141.22"></a><span id="l141.22" class="difflineat">@@ -27,30 +27,30 @@ nsNoneService::nsNoneService()</span>
<a href="#l141.23"></a><span id="l141.23"> }</span>
<a href="#l141.24"></a><span id="l141.24"> </span>
<a href="#l141.25"></a><span id="l141.25"> nsNoneService::~nsNoneService()</span>
<a href="#l141.26"></a><span id="l141.26"> {}</span>
<a href="#l141.27"></a><span id="l141.27"> </span>
<a href="#l141.28"></a><span id="l141.28"> NS_IMPL_ISUPPORTS2(nsNoneService, nsINoneService, nsIMsgProtocolInfo)</span>
<a href="#l141.29"></a><span id="l141.29"> </span>
<a href="#l141.30"></a><span id="l141.30"> NS_IMETHODIMP</span>
<a href="#l141.31"></a><span id="l141.31" class="difflineminus">-nsNoneService::SetDefaultLocalPath(nsILocalFile *aPath)</span>
<a href="#l141.32"></a><span id="l141.32" class="difflineplus">+nsNoneService::SetDefaultLocalPath(nsIFile *aPath)</span>
<a href="#l141.33"></a><span id="l141.33"> {</span>
<a href="#l141.34"></a><span id="l141.34">     NS_ENSURE_ARG(aPath);</span>
<a href="#l141.35"></a><span id="l141.35">     return NS_SetPersistentFile(PREF_MAIL_ROOT_NONE_REL, PREF_MAIL_ROOT_NONE, aPath);</span>
<a href="#l141.36"></a><span id="l141.36"> }     </span>
<a href="#l141.37"></a><span id="l141.37"> </span>
<a href="#l141.38"></a><span id="l141.38"> NS_IMETHODIMP</span>
<a href="#l141.39"></a><span id="l141.39" class="difflineminus">-nsNoneService::GetDefaultLocalPath(nsILocalFile ** aResult)</span>
<a href="#l141.40"></a><span id="l141.40" class="difflineplus">+nsNoneService::GetDefaultLocalPath(nsIFile ** aResult)</span>
<a href="#l141.41"></a><span id="l141.41"> {</span>
<a href="#l141.42"></a><span id="l141.42">     NS_ENSURE_ARG_POINTER(aResult);</span>
<a href="#l141.43"></a><span id="l141.43">     *aResult = nsnull;</span>
<a href="#l141.44"></a><span id="l141.44">     </span>
<a href="#l141.45"></a><span id="l141.45">     bool havePref;</span>
<a href="#l141.46"></a><span id="l141.46" class="difflineminus">-    nsCOMPtr&lt;nsILocalFile&gt; localFile;    </span>
<a href="#l141.47"></a><span id="l141.47" class="difflineplus">+    nsCOMPtr&lt;nsIFile&gt; localFile;    </span>
<a href="#l141.48"></a><span id="l141.48">     nsresult rv = NS_GetPersistentFile(PREF_MAIL_ROOT_NONE_REL,</span>
<a href="#l141.49"></a><span id="l141.49">                               PREF_MAIL_ROOT_NONE,</span>
<a href="#l141.50"></a><span id="l141.50">                               NS_APP_MAIL_50_DIR,</span>
<a href="#l141.51"></a><span id="l141.51">                               havePref,</span>
<a href="#l141.52"></a><span id="l141.52">                               getter_AddRefs(localFile));</span>
<a href="#l141.53"></a><span id="l141.53">     if (NS_FAILED(rv)) return rv;</span>
<a href="#l141.54"></a><span id="l141.54">     </span>
<a href="#l141.55"></a><span id="l141.55">     bool exists;</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l142.1"></a><span id="l142.1" class="difflineminus">--- a/mailnews/local/src/nsParseMailbox.cpp</span>
<a href="#l142.2"></a><span id="l142.2" class="difflineplus">+++ b/mailnews/local/src/nsParseMailbox.cpp</span>
<a href="#l142.3"></a><span id="l142.3" class="difflineat">@@ -6,17 +6,17 @@</span>
<a href="#l142.4"></a><span id="l142.4"> #include &quot;msgCore.h&quot;</span>
<a href="#l142.5"></a><span id="l142.5"> #include &quot;nsIURI.h&quot;</span>
<a href="#l142.6"></a><span id="l142.6"> #include &quot;nsParseMailbox.h&quot;</span>
<a href="#l142.7"></a><span id="l142.7"> #include &quot;nsIMsgHdr.h&quot;</span>
<a href="#l142.8"></a><span id="l142.8"> #include &quot;nsIMsgDatabase.h&quot;</span>
<a href="#l142.9"></a><span id="l142.9"> #include &quot;nsMsgMessageFlags.h&quot;</span>
<a href="#l142.10"></a><span id="l142.10"> #include &quot;nsIDBFolderInfo.h&quot;</span>
<a href="#l142.11"></a><span id="l142.11"> #include &quot;nsIInputStream.h&quot;</span>
<a href="#l142.12"></a><span id="l142.12" class="difflineminus">-#include &quot;nsILocalFile.h&quot;</span>
<a href="#l142.13"></a><span id="l142.13" class="difflineplus">+#include &quot;nsIFile.h&quot;</span>
<a href="#l142.14"></a><span id="l142.14"> #include &quot;nsMsgLocalFolderHdrs.h&quot;</span>
<a href="#l142.15"></a><span id="l142.15"> #include &quot;nsMsgBaseCID.h&quot;</span>
<a href="#l142.16"></a><span id="l142.16"> #include &quot;nsMsgDBCID.h&quot;</span>
<a href="#l142.17"></a><span id="l142.17"> #include &quot;nsIMailboxUrl.h&quot;</span>
<a href="#l142.18"></a><span id="l142.18"> #include &quot;nsNetUtil.h&quot;</span>
<a href="#l142.19"></a><span id="l142.19"> #include &quot;nsMsgFolderFlags.h&quot;</span>
<a href="#l142.20"></a><span id="l142.20"> #include &quot;nsIMsgFolder.h&quot;</span>
<a href="#l142.21"></a><span id="l142.21"> #include &quot;nsIURL.h&quot;</span>
<a href="#l142.22"></a><span id="l142.22" class="difflineat">@@ -104,17 +104,17 @@ NS_IMETHODIMP nsMsgMailboxParser::OnStar</span>
<a href="#l142.23"></a><span id="l142.23">     {</span>
<a href="#l142.24"></a><span id="l142.24">         url-&gt;GetStatusFeedback(getter_AddRefs(m_statusFeedback));</span>
<a href="#l142.25"></a><span id="l142.25"> </span>
<a href="#l142.26"></a><span id="l142.26">         // okay, now fill in our event sinks...Note that each getter ref counts before</span>
<a href="#l142.27"></a><span id="l142.27">         // it returns the interface to us...we'll release when we are done</span>
<a href="#l142.28"></a><span id="l142.28"> </span>
<a href="#l142.29"></a><span id="l142.29">         folder-&gt;GetName(m_folderName);</span>
<a href="#l142.30"></a><span id="l142.30"> </span>
<a href="#l142.31"></a><span id="l142.31" class="difflineminus">-        nsCOMPtr&lt;nsILocalFile&gt; path;</span>
<a href="#l142.32"></a><span id="l142.32" class="difflineplus">+        nsCOMPtr&lt;nsIFile&gt; path;</span>
<a href="#l142.33"></a><span id="l142.33">         folder-&gt;GetFilePath(getter_AddRefs(path));</span>
<a href="#l142.34"></a><span id="l142.34"> </span>
<a href="#l142.35"></a><span id="l142.35">         if (path)</span>
<a href="#l142.36"></a><span id="l142.36">         {</span>
<a href="#l142.37"></a><span id="l142.37">           PRInt64 fileSize;</span>
<a href="#l142.38"></a><span id="l142.38">           path-&gt;GetFileSize(&amp;fileSize);</span>
<a href="#l142.39"></a><span id="l142.39">             // the size of the mailbox file is our total base line for measuring progress</span>
<a href="#l142.40"></a><span id="l142.40">             m_graph_progress_total = (PRUint32) fileSize;</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l143.1"></a><span id="l143.1" class="difflineminus">--- a/mailnews/local/src/nsPop3IncomingServer.cpp</span>
<a href="#l143.2"></a><span id="l143.2" class="difflineplus">+++ b/mailnews/local/src/nsPop3IncomingServer.cpp</span>
<a href="#l143.3"></a><span id="l143.3" class="difflineat">@@ -638,17 +638,17 @@ NS_IMETHODIMP nsPop3IncomingServer::Mark</span>
<a href="#l143.4"></a><span id="l143.4"> {</span>
<a href="#l143.5"></a><span id="l143.5">   nsresult rv;</span>
<a href="#l143.6"></a><span id="l143.6">   if (m_runningProtocol)</span>
<a href="#l143.7"></a><span id="l143.7">     rv = m_runningProtocol-&gt;MarkMessages(&amp;m_uidlsToMark);</span>
<a href="#l143.8"></a><span id="l143.8">   else</span>
<a href="#l143.9"></a><span id="l143.9">   {</span>
<a href="#l143.10"></a><span id="l143.10">     nsCString hostName;</span>
<a href="#l143.11"></a><span id="l143.11">     nsCString userName;</span>
<a href="#l143.12"></a><span id="l143.12" class="difflineminus">-    nsCOMPtr&lt;nsILocalFile&gt; localPath;</span>
<a href="#l143.13"></a><span id="l143.13" class="difflineplus">+    nsCOMPtr&lt;nsIFile&gt; localPath;</span>
<a href="#l143.14"></a><span id="l143.14"> </span>
<a href="#l143.15"></a><span id="l143.15">     GetLocalPath(getter_AddRefs(localPath));</span>
<a href="#l143.16"></a><span id="l143.16"> </span>
<a href="#l143.17"></a><span id="l143.17">     GetHostName(hostName);</span>
<a href="#l143.18"></a><span id="l143.18">     GetUsername(userName);</span>
<a href="#l143.19"></a><span id="l143.19">     // do it all in one fell swoop</span>
<a href="#l143.20"></a><span id="l143.20">     rv = nsPop3Protocol::MarkMsgForHost(hostName.get(), userName.get(), localPath, m_uidlsToMark);</span>
<a href="#l143.21"></a><span id="l143.21">   }</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l144.1"></a><span id="l144.1" class="difflineminus">--- a/mailnews/local/src/nsPop3Protocol.cpp</span>
<a href="#l144.2"></a><span id="l144.2" class="difflineplus">+++ b/mailnews/local/src/nsPop3Protocol.cpp</span>
<a href="#l144.3"></a><span id="l144.3" class="difflineat">@@ -139,17 +139,17 @@ static PLHashAllocOps gHashAllocOps = {</span>
<a href="#l144.4"></a><span id="l144.4">     AllocUidlTable, FreeUidlTable,</span>
<a href="#l144.5"></a><span id="l144.5">     AllocUidlInfo, FreeUidlInfo</span>
<a href="#l144.6"></a><span id="l144.6"> };</span>
<a href="#l144.7"></a><span id="l144.7"> </span>
<a href="#l144.8"></a><span id="l144.8"> </span>
<a href="#l144.9"></a><span id="l144.9"> static Pop3UidlHost*</span>
<a href="#l144.10"></a><span id="l144.10"> net_pop3_load_state(const char* searchhost,</span>
<a href="#l144.11"></a><span id="l144.11">                     const char* searchuser,</span>
<a href="#l144.12"></a><span id="l144.12" class="difflineminus">-                    nsILocalFile *mailDirectory)</span>
<a href="#l144.13"></a><span id="l144.13" class="difflineplus">+                    nsIFile *mailDirectory)</span>
<a href="#l144.14"></a><span id="l144.14"> {</span>
<a href="#l144.15"></a><span id="l144.15">   Pop3UidlHost* result = nsnull;</span>
<a href="#l144.16"></a><span id="l144.16">   Pop3UidlHost* current = nsnull;</span>
<a href="#l144.17"></a><span id="l144.17">   Pop3UidlHost* tmp;</span>
<a href="#l144.18"></a><span id="l144.18"> </span>
<a href="#l144.19"></a><span id="l144.19">   result = PR_NEWZAP(Pop3UidlHost);</span>
<a href="#l144.20"></a><span id="l144.20">   if (!result)</span>
<a href="#l144.21"></a><span id="l144.21">     return nsnull;</span>
<a href="#l144.22"></a><span id="l144.22" class="difflineat">@@ -162,21 +162,20 @@ net_pop3_load_state(const char* searchho</span>
<a href="#l144.23"></a><span id="l144.23">     PR_Free(result-&gt;host);</span>
<a href="#l144.24"></a><span id="l144.24">     PR_Free(result-&gt;user);</span>
<a href="#l144.25"></a><span id="l144.25">     if (result-&gt;hash)</span>
<a href="#l144.26"></a><span id="l144.26">       PL_HashTableDestroy(result-&gt;hash);</span>
<a href="#l144.27"></a><span id="l144.27">     PR_Free(result);</span>
<a href="#l144.28"></a><span id="l144.28">     return nsnull;</span>
<a href="#l144.29"></a><span id="l144.29">   }</span>
<a href="#l144.30"></a><span id="l144.30"> </span>
<a href="#l144.31"></a><span id="l144.31" class="difflineminus">-  nsCOMPtr &lt;nsIFile&gt; clonedDirectory;</span>
<a href="#l144.32"></a><span id="l144.32" class="difflineminus">-  mailDirectory-&gt;Clone(getter_AddRefs(clonedDirectory));</span>
<a href="#l144.33"></a><span id="l144.33" class="difflineminus">-  if (!clonedDirectory)</span>
<a href="#l144.34"></a><span id="l144.34" class="difflineplus">+  nsCOMPtr &lt;nsIFile&gt; popState;</span>
<a href="#l144.35"></a><span id="l144.35" class="difflineplus">+  mailDirectory-&gt;Clone(getter_AddRefs(popState));</span>
<a href="#l144.36"></a><span id="l144.36" class="difflineplus">+  if (!popState)</span>
<a href="#l144.37"></a><span id="l144.37">     return nsnull;</span>
<a href="#l144.38"></a><span id="l144.38" class="difflineminus">-  nsCOMPtr &lt;nsILocalFile&gt; popState = do_QueryInterface(clonedDirectory);</span>
<a href="#l144.39"></a><span id="l144.39">   popState-&gt;AppendNative(NS_LITERAL_CSTRING(&quot;popstate.dat&quot;));</span>
<a href="#l144.40"></a><span id="l144.40"> </span>
<a href="#l144.41"></a><span id="l144.41">   nsCOMPtr&lt;nsIInputStream&gt; fileStream;</span>
<a href="#l144.42"></a><span id="l144.42">   nsresult rv = NS_NewLocalFileInputStream(getter_AddRefs(fileStream), popState);</span>
<a href="#l144.43"></a><span id="l144.43">   NS_ENSURE_SUCCESS(rv, result);</span>
<a href="#l144.44"></a><span id="l144.44"> </span>
<a href="#l144.45"></a><span id="l144.45">   nsCOMPtr&lt;nsILineInputStream&gt; lineInputStream(do_QueryInterface(fileStream, &amp;rv));</span>
<a href="#l144.46"></a><span id="l144.46">   NS_ENSURE_SUCCESS(rv, result);</span>
<a href="#l144.47"></a><span id="l144.47" class="difflineat">@@ -322,25 +321,24 @@ net_pop3_delete_old_msgs_mapper(PLHashEn</span>
<a href="#l144.48"></a><span id="l144.48">   PRTime cutOffDate = (PRTime) arg;</span>
<a href="#l144.49"></a><span id="l144.49">   Pop3UidlEntry *uidlEntry = (Pop3UidlEntry *) he-&gt;value;</span>
<a href="#l144.50"></a><span id="l144.50">   if (uidlEntry-&gt;dateReceived &lt; cutOffDate)</span>
<a href="#l144.51"></a><span id="l144.51">     uidlEntry-&gt;status = DELETE_CHAR; // mark for deletion</span>
<a href="#l144.52"></a><span id="l144.52">   return HT_ENUMERATE_NEXT;</span>
<a href="#l144.53"></a><span id="l144.53"> }</span>
<a href="#l144.54"></a><span id="l144.54"> </span>
<a href="#l144.55"></a><span id="l144.55"> static void</span>
<a href="#l144.56"></a><span id="l144.56" class="difflineminus">-net_pop3_write_state(Pop3UidlHost* host, nsILocalFile *mailDirectory)</span>
<a href="#l144.57"></a><span id="l144.57" class="difflineplus">+net_pop3_write_state(Pop3UidlHost* host, nsIFile *mailDirectory)</span>
<a href="#l144.58"></a><span id="l144.58"> {</span>
<a href="#l144.59"></a><span id="l144.59">   PRInt32 len = 0;</span>
<a href="#l144.60"></a><span id="l144.60" class="difflineminus">-  nsCOMPtr &lt;nsIFile&gt; clonedDirectory;</span>
<a href="#l144.61"></a><span id="l144.61" class="difflineminus">-</span>
<a href="#l144.62"></a><span id="l144.62" class="difflineminus">-  mailDirectory-&gt;Clone(getter_AddRefs(clonedDirectory));</span>
<a href="#l144.63"></a><span id="l144.63" class="difflineminus">-  if (!clonedDirectory)</span>
<a href="#l144.64"></a><span id="l144.64" class="difflineplus">+  nsCOMPtr &lt;nsIFile&gt; popState;</span>
<a href="#l144.65"></a><span id="l144.65" class="difflineplus">+</span>
<a href="#l144.66"></a><span id="l144.66" class="difflineplus">+  mailDirectory-&gt;Clone(getter_AddRefs(popState));</span>
<a href="#l144.67"></a><span id="l144.67" class="difflineplus">+  if (!popState)</span>
<a href="#l144.68"></a><span id="l144.68">     return;</span>
<a href="#l144.69"></a><span id="l144.69" class="difflineminus">-  nsCOMPtr &lt;nsILocalFile&gt; popState = do_QueryInterface(clonedDirectory);</span>
<a href="#l144.70"></a><span id="l144.70">   popState-&gt;AppendNative(NS_LITERAL_CSTRING(&quot;popstate.dat&quot;));</span>
<a href="#l144.71"></a><span id="l144.71"> </span>
<a href="#l144.72"></a><span id="l144.72">   nsCOMPtr&lt;nsIOutputStream&gt; fileOutputStream;</span>
<a href="#l144.73"></a><span id="l144.73">   nsresult rv = MsgNewBufferedFileOutputStream(getter_AddRefs(fileOutputStream), popState, -1, 00600);</span>
<a href="#l144.74"></a><span id="l144.74">   if (NS_FAILED(rv))</span>
<a href="#l144.75"></a><span id="l144.75">     return;</span>
<a href="#l144.76"></a><span id="l144.76"> </span>
<a href="#l144.77"></a><span id="l144.77">   const char tmpBuffer[] =</span>
<a href="#l144.78"></a><span id="l144.78" class="difflineat">@@ -402,17 +400,17 @@ void nsPop3Protocol::MarkMsgInHashTable(</span>
<a href="#l144.79"></a><span id="l144.79">       }</span>
<a href="#l144.80"></a><span id="l144.80">     }</span>
<a href="#l144.81"></a><span id="l144.81">   }</span>
<a href="#l144.82"></a><span id="l144.82"> }</span>
<a href="#l144.83"></a><span id="l144.83"> </span>
<a href="#l144.84"></a><span id="l144.84"> /* static */</span>
<a href="#l144.85"></a><span id="l144.85"> nsresult</span>
<a href="#l144.86"></a><span id="l144.86"> nsPop3Protocol::MarkMsgForHost(const char *hostName, const char *userName,</span>
<a href="#l144.87"></a><span id="l144.87" class="difflineminus">-                                      nsILocalFile *mailDirectory,</span>
<a href="#l144.88"></a><span id="l144.88" class="difflineplus">+                                      nsIFile *mailDirectory,</span>
<a href="#l144.89"></a><span id="l144.89">                                        nsVoidArray &amp;UIDLArray)</span>
<a href="#l144.90"></a><span id="l144.90"> {</span>
<a href="#l144.91"></a><span id="l144.91">   if (!hostName || !userName || !mailDirectory)</span>
<a href="#l144.92"></a><span id="l144.92">     return NS_ERROR_NULL_POINTER;</span>
<a href="#l144.93"></a><span id="l144.93"> </span>
<a href="#l144.94"></a><span id="l144.94">   Pop3UidlHost *uidlHost = net_pop3_load_state(hostName, userName, mailDirectory);</span>
<a href="#l144.95"></a><span id="l144.95">   if (!uidlHost)</span>
<a href="#l144.96"></a><span id="l144.96">     return NS_ERROR_OUT_OF_MEMORY;</span>
<a href="#l144.97"></a><span id="l144.97" class="difflineat">@@ -1063,17 +1061,17 @@ nsresult nsPop3Protocol::LoadUrl(nsIURI*</span>
<a href="#l144.98"></a><span id="l144.98">     }</span>
<a href="#l144.99"></a><span id="l144.99">   }</span>
<a href="#l144.100"></a><span id="l144.100"> </span>
<a href="#l144.101"></a><span id="l144.101">   // UIDL stuff</span>
<a href="#l144.102"></a><span id="l144.102">   nsCOMPtr&lt;nsIPop3URL&gt; pop3Url = do_QueryInterface(m_url);</span>
<a href="#l144.103"></a><span id="l144.103">   if (pop3Url)</span>
<a href="#l144.104"></a><span id="l144.104">     pop3Url-&gt;GetPop3Sink(getter_AddRefs(m_nsIPop3Sink));</span>
<a href="#l144.105"></a><span id="l144.105"> </span>
<a href="#l144.106"></a><span id="l144.106" class="difflineminus">-  nsCOMPtr&lt;nsILocalFile&gt; mailDirectory;</span>
<a href="#l144.107"></a><span id="l144.107" class="difflineplus">+  nsCOMPtr&lt;nsIFile&gt; mailDirectory;</span>
<a href="#l144.108"></a><span id="l144.108"> </span>
<a href="#l144.109"></a><span id="l144.109">   nsCString hostName;</span>
<a href="#l144.110"></a><span id="l144.110">   nsCString userName;</span>
<a href="#l144.111"></a><span id="l144.111"> </span>
<a href="#l144.112"></a><span id="l144.112">   nsCOMPtr&lt;nsIMsgIncomingServer&gt; server = do_QueryInterface(m_pop3Server);</span>
<a href="#l144.113"></a><span id="l144.113">   if (server)</span>
<a href="#l144.114"></a><span id="l144.114">   {</span>
<a href="#l144.115"></a><span id="l144.115">     rv = server-&gt;GetLocalPath(getter_AddRefs(mailDirectory));</span>
<a href="#l144.116"></a><span id="l144.116" class="difflineat">@@ -2972,32 +2970,30 @@ PRInt32 nsPop3Protocol::GetMsg()</span>
<a href="#l144.117"></a><span id="l144.117">     /* get the amount of available space on the drive</span>
<a href="#l144.118"></a><span id="l144.118">      * and make sure there is enough</span>
<a href="#l144.119"></a><span id="l144.119">      */</span>
<a href="#l144.120"></a><span id="l144.120">     if (m_totalDownloadSize &gt; 0) // skip all this if there aren't any messages</span>
<a href="#l144.121"></a><span id="l144.121">     {</span>
<a href="#l144.122"></a><span id="l144.122">       nsresult rv;</span>
<a href="#l144.123"></a><span id="l144.123">       PRInt64 mailboxSpaceLeft = LL_Zero();</span>
<a href="#l144.124"></a><span id="l144.124">       nsCOMPtr &lt;nsIMsgFolder&gt; folder;</span>
<a href="#l144.125"></a><span id="l144.125" class="difflineminus">-      nsCOMPtr &lt;nsILocalFile&gt; path;</span>
<a href="#l144.126"></a><span id="l144.126" class="difflineplus">+      nsCOMPtr &lt;nsIFile&gt; path;</span>
<a href="#l144.127"></a><span id="l144.127"> </span>
<a href="#l144.128"></a><span id="l144.128">       // Get the path to the current mailbox</span>
<a href="#l144.129"></a><span id="l144.129">       //</span>
<a href="#l144.130"></a><span id="l144.130">       NS_ENSURE_TRUE(m_nsIPop3Sink, NS_ERROR_UNEXPECTED);</span>
<a href="#l144.131"></a><span id="l144.131">       rv = m_nsIPop3Sink-&gt;GetFolder(getter_AddRefs(folder));</span>
<a href="#l144.132"></a><span id="l144.132">       if (NS_FAILED(rv)) return rv;</span>
<a href="#l144.133"></a><span id="l144.133">       rv = folder-&gt;GetFilePath(getter_AddRefs(path));</span>
<a href="#l144.134"></a><span id="l144.134">       if (NS_FAILED(rv)) return rv;</span>
<a href="#l144.135"></a><span id="l144.135"> </span>
<a href="#l144.136"></a><span id="l144.136">       // call GetDiskSpaceAvailable on the directory</span>
<a href="#l144.137"></a><span id="l144.137">       nsCOMPtr &lt;nsIFile&gt; parent;</span>
<a href="#l144.138"></a><span id="l144.138">       path-&gt;GetParent(getter_AddRefs(parent));</span>
<a href="#l144.139"></a><span id="l144.139" class="difflineminus">-      nsCOMPtr &lt;nsILocalFile&gt; localParent = do_QueryInterface(parent, &amp;rv);</span>
<a href="#l144.140"></a><span id="l144.140" class="difflineminus">-      if (localParent)</span>
<a href="#l144.141"></a><span id="l144.141" class="difflineminus">-        rv = localParent-&gt;GetDiskSpaceAvailable(&amp;mailboxSpaceLeft);</span>
<a href="#l144.142"></a><span id="l144.142" class="difflineplus">+      rv = parent-&gt;GetDiskSpaceAvailable(&amp;mailboxSpaceLeft);</span>
<a href="#l144.143"></a><span id="l144.143">       if (NS_FAILED(rv))</span>
<a href="#l144.144"></a><span id="l144.144">       {</span>
<a href="#l144.145"></a><span id="l144.145">         // The call to GetDiskSpaceAvailable FAILED!</span>
<a href="#l144.146"></a><span id="l144.146">         // This will happen on certain platforms where GetDiskSpaceAvailable</span>
<a href="#l144.147"></a><span id="l144.147">         // is not implemented. Since people on those platforms still need</span>
<a href="#l144.148"></a><span id="l144.148">         // to check mail, we will simply bypass the disk-space check.</span>
<a href="#l144.149"></a><span id="l144.149">         //</span>
<a href="#l144.150"></a><span id="l144.150">         // We'll leave a debug message to warn people.</span>
<a href="#l144.151"></a><span id="l144.151" class="difflineat">@@ -3702,17 +3698,17 @@ nsPop3Protocol::CommitState(bool remove_</span>
<a href="#l144.152"></a><span id="l144.152">       // track of the messages we *did* download in this session.</span>
<a href="#l144.153"></a><span id="l144.153">       PL_HashTableEnumerateEntries(m_pop3ConData-&gt;newuidl, net_pop3_copy_hash_entries, (void *)m_pop3ConData-&gt;uidlinfo-&gt;hash);</span>
<a href="#l144.154"></a><span id="l144.154">     }</span>
<a href="#l144.155"></a><span id="l144.155">   }</span>
<a href="#l144.156"></a><span id="l144.156"> </span>
<a href="#l144.157"></a><span id="l144.157">   if (!m_pop3ConData-&gt;only_check_for_new_mail)</span>
<a href="#l144.158"></a><span id="l144.158">   {</span>
<a href="#l144.159"></a><span id="l144.159">     nsresult rv;</span>
<a href="#l144.160"></a><span id="l144.160" class="difflineminus">-    nsCOMPtr&lt;nsILocalFile&gt; mailDirectory;</span>
<a href="#l144.161"></a><span id="l144.161" class="difflineplus">+    nsCOMPtr&lt;nsIFile&gt; mailDirectory;</span>
<a href="#l144.162"></a><span id="l144.162"> </span>
<a href="#l144.163"></a><span id="l144.163">     // get the mail directory</span>
<a href="#l144.164"></a><span id="l144.164">     nsCOMPtr&lt;nsIMsgIncomingServer&gt; server =</span>
<a href="#l144.165"></a><span id="l144.165">       do_QueryInterface(m_pop3Server, &amp;rv);</span>
<a href="#l144.166"></a><span id="l144.166">     if (NS_FAILED(rv)) return -1;</span>
<a href="#l144.167"></a><span id="l144.167"> </span>
<a href="#l144.168"></a><span id="l144.168">     rv = server-&gt;GetLocalPath(getter_AddRefs(mailDirectory));</span>
<a href="#l144.169"></a><span id="l144.169">     if (NS_FAILED(rv)) return -1;</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l145.1"></a><span id="l145.1" class="difflineminus">--- a/mailnews/local/src/nsPop3Protocol.h</span>
<a href="#l145.2"></a><span id="l145.2" class="difflineplus">+++ b/mailnews/local/src/nsPop3Protocol.h</span>
<a href="#l145.3"></a><span id="l145.3" class="difflineat">@@ -273,17 +273,17 @@ public:</span>
<a href="#l145.4"></a><span id="l145.4">   NS_IMETHOD OnTransportStatus(nsITransport *transport, nsresult status, PRUint64 progress, PRUint64 progressMax);</span>
<a href="#l145.5"></a><span id="l145.5">   NS_IMETHOD OnStopRequest(nsIRequest *request, nsISupports * aContext, nsresult aStatus);</span>
<a href="#l145.6"></a><span id="l145.6">   NS_IMETHOD Cancel(nsresult status);</span>
<a href="#l145.7"></a><span id="l145.7"> </span>
<a href="#l145.8"></a><span id="l145.8">   static void MarkMsgInHashTable(PLHashTable *hashTable, const Pop3UidlEntry *uidl,</span>
<a href="#l145.9"></a><span id="l145.9">                                   bool *changed);</span>
<a href="#l145.10"></a><span id="l145.10"> </span>
<a href="#l145.11"></a><span id="l145.11">   static nsresult MarkMsgForHost(const char *hostName, const char *userName,</span>
<a href="#l145.12"></a><span id="l145.12" class="difflineminus">-                                      nsILocalFile *mailDirectory,</span>
<a href="#l145.13"></a><span id="l145.13" class="difflineplus">+                                      nsIFile *mailDirectory,</span>
<a href="#l145.14"></a><span id="l145.14">                                       nsVoidArray  &amp;UIDLArray);</span>
<a href="#l145.15"></a><span id="l145.15"> private:</span>
<a href="#l145.16"></a><span id="l145.16">   nsCString m_ApopTimestamp;</span>
<a href="#l145.17"></a><span id="l145.17">   nsCOMPtr&lt;nsIStringBundle&gt; mLocalBundle;</span>
<a href="#l145.18"></a><span id="l145.18"> </span>
<a href="#l145.19"></a><span id="l145.19">   nsCString m_username;</span>
<a href="#l145.20"></a><span id="l145.20">   nsCString m_senderInfo;</span>
<a href="#l145.21"></a><span id="l145.21">   nsCString m_commandResponse;</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l146.1"></a><span id="l146.1" class="difflineminus">--- a/mailnews/local/src/nsPop3Service.cpp</span>
<a href="#l146.2"></a><span id="l146.2" class="difflineplus">+++ b/mailnews/local/src/nsPop3Service.cpp</span>
<a href="#l146.3"></a><span id="l146.3" class="difflineat">@@ -495,30 +495,30 @@ NS_IMETHODIMP nsPop3Service::NewChannel(</span>
<a href="#l146.4"></a><span id="l146.4"> </span>
<a href="#l146.5"></a><span id="l146.5">   protocol-&gt;SetUsername(realUserName.get());</span>
<a href="#l146.6"></a><span id="l146.6"> </span>
<a href="#l146.7"></a><span id="l146.7">   return CallQueryInterface(protocol, _retval);</span>
<a href="#l146.8"></a><span id="l146.8"> }</span>
<a href="#l146.9"></a><span id="l146.9"> </span>
<a href="#l146.10"></a><span id="l146.10"> </span>
<a href="#l146.11"></a><span id="l146.11"> NS_IMETHODIMP</span>
<a href="#l146.12"></a><span id="l146.12" class="difflineminus">-nsPop3Service::SetDefaultLocalPath(nsILocalFile *aPath)</span>
<a href="#l146.13"></a><span id="l146.13" class="difflineplus">+nsPop3Service::SetDefaultLocalPath(nsIFile *aPath)</span>
<a href="#l146.14"></a><span id="l146.14"> {</span>
<a href="#l146.15"></a><span id="l146.15">     NS_ENSURE_ARG(aPath);</span>
<a href="#l146.16"></a><span id="l146.16">     return NS_SetPersistentFile(PREF_MAIL_ROOT_POP3_REL, PREF_MAIL_ROOT_POP3, aPath);</span>
<a href="#l146.17"></a><span id="l146.17"> }</span>
<a href="#l146.18"></a><span id="l146.18"> </span>
<a href="#l146.19"></a><span id="l146.19"> NS_IMETHODIMP</span>
<a href="#l146.20"></a><span id="l146.20" class="difflineminus">-nsPop3Service::GetDefaultLocalPath(nsILocalFile **aResult)</span>
<a href="#l146.21"></a><span id="l146.21" class="difflineplus">+nsPop3Service::GetDefaultLocalPath(nsIFile **aResult)</span>
<a href="#l146.22"></a><span id="l146.22"> {</span>
<a href="#l146.23"></a><span id="l146.23">     NS_ENSURE_ARG_POINTER(aResult);</span>
<a href="#l146.24"></a><span id="l146.24">     *aResult = nsnull;</span>
<a href="#l146.25"></a><span id="l146.25"> </span>
<a href="#l146.26"></a><span id="l146.26">     bool havePref;</span>
<a href="#l146.27"></a><span id="l146.27" class="difflineminus">-    nsCOMPtr&lt;nsILocalFile&gt; localFile;</span>
<a href="#l146.28"></a><span id="l146.28" class="difflineplus">+    nsCOMPtr&lt;nsIFile&gt; localFile;</span>
<a href="#l146.29"></a><span id="l146.29">     nsresult rv = NS_GetPersistentFile(PREF_MAIL_ROOT_POP3_REL,</span>
<a href="#l146.30"></a><span id="l146.30">                                        PREF_MAIL_ROOT_POP3,</span>
<a href="#l146.31"></a><span id="l146.31">                                        NS_APP_MAIL_50_DIR,</span>
<a href="#l146.32"></a><span id="l146.32">                                        havePref,</span>
<a href="#l146.33"></a><span id="l146.33">                                        getter_AddRefs(localFile));</span>
<a href="#l146.34"></a><span id="l146.34">     NS_ENSURE_SUCCESS(rv, rv);</span>
<a href="#l146.35"></a><span id="l146.35"> </span>
<a href="#l146.36"></a><span id="l146.36">     bool exists;</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l147.1"></a><span id="l147.1" class="difflineminus">--- a/mailnews/local/src/nsPop3Sink.cpp</span>
<a href="#l147.2"></a><span id="l147.2" class="difflineplus">+++ b/mailnews/local/src/nsPop3Sink.cpp</span>
<a href="#l147.3"></a><span id="l147.3" class="difflineat">@@ -456,17 +456,17 @@ nsPop3Sink::IncorporateBegin(const char*</span>
<a href="#l147.4"></a><span id="l147.4">                              PRUint32 flags,</span>
<a href="#l147.5"></a><span id="l147.5">                              void** closure)</span>
<a href="#l147.6"></a><span id="l147.6"> {</span>
<a href="#l147.7"></a><span id="l147.7"> #ifdef DEBUG</span>
<a href="#l147.8"></a><span id="l147.8">     printf(&quot;Incorporate message begin:\n&quot;);</span>
<a href="#l147.9"></a><span id="l147.9">     if (uidlString)</span>
<a href="#l147.10"></a><span id="l147.10">         printf(&quot;uidl string: %s\n&quot;, uidlString);</span>
<a href="#l147.11"></a><span id="l147.11"> #endif</span>
<a href="#l147.12"></a><span id="l147.12" class="difflineminus">-  nsCOMPtr&lt;nsILocalFile&gt; path;</span>
<a href="#l147.13"></a><span id="l147.13" class="difflineplus">+  nsCOMPtr&lt;nsIFile&gt; path;</span>
<a href="#l147.14"></a><span id="l147.14"> </span>
<a href="#l147.15"></a><span id="l147.15">   m_folder-&gt;GetFilePath(getter_AddRefs(path));</span>
<a href="#l147.16"></a><span id="l147.16"> </span>
<a href="#l147.17"></a><span id="l147.17">   nsresult rv;</span>
<a href="#l147.18"></a><span id="l147.18">   nsCOMPtr&lt;nsIPrefBranch&gt; pPrefBranch(do_GetService(NS_PREFSERVICE_CONTRACTID, &amp;rv));</span>
<a href="#l147.19"></a><span id="l147.19">   if (pPrefBranch)</span>
<a href="#l147.20"></a><span id="l147.20">   {</span>
<a href="#l147.21"></a><span id="l147.21">     nsCOMPtr&lt;nsIMsgIncomingServer&gt; server;</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l148.1"></a><span id="l148.1" class="difflineminus">--- a/mailnews/local/src/nsPop3Sink.h</span>
<a href="#l148.2"></a><span id="l148.2" class="difflineplus">+++ b/mailnews/local/src/nsPop3Sink.h</span>
<a href="#l148.3"></a><span id="l148.3" class="difflineat">@@ -62,17 +62,17 @@ protected:</span>
<a href="#l148.4"></a><span id="l148.4">     nsCOMPtr&lt;nsIMsgFolder&gt; m_folder;</span>
<a href="#l148.5"></a><span id="l148.5">     nsRefPtr&lt;nsParseNewMailState&gt; m_newMailParser;</span>
<a href="#l148.6"></a><span id="l148.6">     nsCOMPtr &lt;nsIOutputStream&gt; m_outFileStream; // the file we write to, which may be temporary</span>
<a href="#l148.7"></a><span id="l148.7">     nsCOMPtr&lt;nsIMsgPluggableStore&gt; m_msgStore;</span>
<a href="#l148.8"></a><span id="l148.8">     nsCOMPtr &lt;nsIOutputStream&gt; m_inboxOutputStream; // the actual mailbox</span>
<a href="#l148.9"></a><span id="l148.9">     bool m_uidlDownload;</span>
<a href="#l148.10"></a><span id="l148.10">     bool m_buildMessageUri;</span>
<a href="#l148.11"></a><span id="l148.11">     bool m_downloadingToTempFile;</span>
<a href="#l148.12"></a><span id="l148.12" class="difflineminus">-    nsCOMPtr &lt;nsILocalFile&gt; m_tmpDownloadFile;</span>
<a href="#l148.13"></a><span id="l148.13" class="difflineplus">+    nsCOMPtr &lt;nsIFile&gt; m_tmpDownloadFile;</span>
<a href="#l148.14"></a><span id="l148.14">     nsCOMPtr&lt;nsIMsgWindow&gt; m_window;</span>
<a href="#l148.15"></a><span id="l148.15">     nsCString m_messageUri;</span>
<a href="#l148.16"></a><span id="l148.16">     nsCString m_baseMessageUri;</span>
<a href="#l148.17"></a><span id="l148.17">     nsCString m_origMessageUri;</span>
<a href="#l148.18"></a><span id="l148.18">     nsCString m_accountKey;</span>
<a href="#l148.19"></a><span id="l148.19">     nsTArray&lt;partialRecord*&gt; m_partialMsgsArray;</span>
<a href="#l148.20"></a><span id="l148.20"> };</span>
<a href="#l148.21"></a><span id="l148.21"> </span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l149.1"></a><span id="l149.1" class="difflineminus">--- a/mailnews/local/src/nsRssIncomingServer.cpp</span>
<a href="#l149.2"></a><span id="l149.2" class="difflineplus">+++ b/mailnews/local/src/nsRssIncomingServer.cpp</span>
<a href="#l149.3"></a><span id="l149.3" class="difflineat">@@ -2,17 +2,17 @@</span>
<a href="#l149.4"></a><span id="l149.4">  * License, v. 2.0. If a copy of the MPL was not distributed with this</span>
<a href="#l149.5"></a><span id="l149.5">  * file, You can obtain one at http://mozilla.org/MPL/2.0/. */</span>
<a href="#l149.6"></a><span id="l149.6"> </span>
<a href="#l149.7"></a><span id="l149.7"> #include &quot;nsIRssService.h&quot;</span>
<a href="#l149.8"></a><span id="l149.8"> #include &quot;nsRssIncomingServer.h&quot;</span>
<a href="#l149.9"></a><span id="l149.9"> #include &quot;nsMsgFolderFlags.h&quot;</span>
<a href="#l149.10"></a><span id="l149.10"> #include &quot;nsINewsBlogFeedDownloader.h&quot;</span>
<a href="#l149.11"></a><span id="l149.11"> #include &quot;nsMsgBaseCID.h&quot;</span>
<a href="#l149.12"></a><span id="l149.12" class="difflineminus">-#include &quot;nsILocalFile.h&quot;</span>
<a href="#l149.13"></a><span id="l149.13" class="difflineplus">+#include &quot;nsIFile.h&quot;</span>
<a href="#l149.14"></a><span id="l149.14"> #include &quot;nsIMsgFolderNotificationService.h&quot;</span>
<a href="#l149.15"></a><span id="l149.15"> </span>
<a href="#l149.16"></a><span id="l149.16"> #include &quot;nsIMsgLocalMailFolder.h&quot;</span>
<a href="#l149.17"></a><span id="l149.17"> #include &quot;nsIDBFolderInfo.h&quot;</span>
<a href="#l149.18"></a><span id="l149.18"> #include &quot;nsServiceManagerUtils.h&quot;</span>
<a href="#l149.19"></a><span id="l149.19"> #include &quot;nsComponentManagerUtils.h&quot;</span>
<a href="#l149.20"></a><span id="l149.20"> #include &quot;nsMsgUtils.h&quot;</span>
<a href="#l149.21"></a><span id="l149.21"> </span>
<a href="#l149.22"></a><span id="l149.22" class="difflineat">@@ -53,37 +53,37 @@ nsRssIncomingServer::~nsRssIncomingServe</span>
<a href="#l149.23"></a><span id="l149.23">     nsresult rv;</span>
<a href="#l149.24"></a><span id="l149.24">     nsCOMPtr&lt;nsIMsgFolderNotificationService&gt; notifyService =</span>
<a href="#l149.25"></a><span id="l149.25">       do_GetService(NS_MSGNOTIFICATIONSERVICE_CONTRACTID, &amp;rv);</span>
<a href="#l149.26"></a><span id="l149.26">     if (NS_SUCCEEDED(rv))</span>
<a href="#l149.27"></a><span id="l149.27">       notifyService-&gt;RemoveListener(this);</span>
<a href="#l149.28"></a><span id="l149.28">   }</span>
<a href="#l149.29"></a><span id="l149.29"> }</span>
<a href="#l149.30"></a><span id="l149.30"> </span>
<a href="#l149.31"></a><span id="l149.31" class="difflineminus">-nsresult nsRssIncomingServer::FillInDataSourcePath(const nsAString&amp; aDataSourceName, nsILocalFile ** aLocation)</span>
<a href="#l149.32"></a><span id="l149.32" class="difflineplus">+nsresult nsRssIncomingServer::FillInDataSourcePath(const nsAString&amp; aDataSourceName, nsIFile ** aLocation)</span>
<a href="#l149.33"></a><span id="l149.33"> {</span>
<a href="#l149.34"></a><span id="l149.34">   nsresult rv;</span>
<a href="#l149.35"></a><span id="l149.35">   // start by gettting the local path for this server</span>
<a href="#l149.36"></a><span id="l149.36" class="difflineminus">-  nsCOMPtr&lt;nsILocalFile&gt; localFile;</span>
<a href="#l149.37"></a><span id="l149.37" class="difflineplus">+  nsCOMPtr&lt;nsIFile&gt; localFile;</span>
<a href="#l149.38"></a><span id="l149.38">   rv = GetLocalPath(getter_AddRefs(localFile));</span>
<a href="#l149.39"></a><span id="l149.39">   NS_ENSURE_SUCCESS(rv, rv);</span>
<a href="#l149.40"></a><span id="l149.40"> </span>
<a href="#l149.41"></a><span id="l149.41">   // now append the name of the subscriptions data source</span>
<a href="#l149.42"></a><span id="l149.42">   rv = localFile-&gt;Append(aDataSourceName);</span>
<a href="#l149.43"></a><span id="l149.43">   NS_IF_ADDREF(*aLocation = localFile);</span>
<a href="#l149.44"></a><span id="l149.44">   return rv;</span>
<a href="#l149.45"></a><span id="l149.45"> }</span>
<a href="#l149.46"></a><span id="l149.46"> </span>
<a href="#l149.47"></a><span id="l149.47"> // nsIRSSIncomingServer methods</span>
<a href="#l149.48"></a><span id="l149.48" class="difflineminus">-NS_IMETHODIMP nsRssIncomingServer::GetSubscriptionsDataSourcePath(nsILocalFile ** aLocation)</span>
<a href="#l149.49"></a><span id="l149.49" class="difflineplus">+NS_IMETHODIMP nsRssIncomingServer::GetSubscriptionsDataSourcePath(nsIFile ** aLocation)</span>
<a href="#l149.50"></a><span id="l149.50"> {</span>
<a href="#l149.51"></a><span id="l149.51">   return FillInDataSourcePath(NS_LITERAL_STRING(&quot;feeds.rdf&quot;), aLocation);</span>
<a href="#l149.52"></a><span id="l149.52"> }</span>
<a href="#l149.53"></a><span id="l149.53"> </span>
<a href="#l149.54"></a><span id="l149.54" class="difflineminus">-NS_IMETHODIMP nsRssIncomingServer::GetFeedItemsDataSourcePath(nsILocalFile ** aLocation)</span>
<a href="#l149.55"></a><span id="l149.55" class="difflineplus">+NS_IMETHODIMP nsRssIncomingServer::GetFeedItemsDataSourcePath(nsIFile ** aLocation)</span>
<a href="#l149.56"></a><span id="l149.56"> {</span>
<a href="#l149.57"></a><span id="l149.57">   return FillInDataSourcePath(NS_LITERAL_STRING(&quot;feeditems.rdf&quot;), aLocation);</span>
<a href="#l149.58"></a><span id="l149.58"> }</span>
<a href="#l149.59"></a><span id="l149.59"> </span>
<a href="#l149.60"></a><span id="l149.60"> NS_IMETHODIMP nsRssIncomingServer::CreateDefaultMailboxes(nsIFile *aPath)</span>
<a href="#l149.61"></a><span id="l149.61"> {</span>
<a href="#l149.62"></a><span id="l149.62">   NS_ENSURE_ARG_POINTER(aPath);</span>
<a href="#l149.63"></a><span id="l149.63">   nsCOMPtr &lt;nsIFile&gt; path;</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l150.1"></a><span id="l150.1" class="difflineminus">--- a/mailnews/local/src/nsRssIncomingServer.h</span>
<a href="#l150.2"></a><span id="l150.2" class="difflineplus">+++ b/mailnews/local/src/nsRssIncomingServer.h</span>
<a href="#l150.3"></a><span id="l150.3" class="difflineat">@@ -29,13 +29,13 @@ public:</span>
<a href="#l150.4"></a><span id="l150.4">     NS_IMETHOD PerformBiff(nsIMsgWindow *aMsgWindow);</span>
<a href="#l150.5"></a><span id="l150.5">     NS_IMETHOD GetServerRequiresPasswordForBiff(bool *aServerRequiresPasswordForBiff);</span>
<a href="#l150.6"></a><span id="l150.6">     NS_IMETHOD GetCanSearchMessages(bool *canSearchMessages);</span>
<a href="#l150.7"></a><span id="l150.7"> </span>
<a href="#l150.8"></a><span id="l150.8">     nsRssIncomingServer();</span>
<a href="#l150.9"></a><span id="l150.9">     virtual ~nsRssIncomingServer();</span>
<a href="#l150.10"></a><span id="l150.10"> protected:</span>
<a href="#l150.11"></a><span id="l150.11">     nsresult FolderChanged(nsIMsgFolder *aFolder, bool aUnsubscribe);</span>
<a href="#l150.12"></a><span id="l150.12" class="difflineminus">-    nsresult FillInDataSourcePath(const nsAString&amp; aDataSourceName, nsILocalFile ** aLocation);</span>
<a href="#l150.13"></a><span id="l150.13" class="difflineplus">+    nsresult FillInDataSourcePath(const nsAString&amp; aDataSourceName, nsIFile ** aLocation);</span>
<a href="#l150.14"></a><span id="l150.14">     static nsrefcnt gInstanceCount;</span>
<a href="#l150.15"></a><span id="l150.15"> };</span>
<a href="#l150.16"></a><span id="l150.16"> </span>
<a href="#l150.17"></a><span id="l150.17"> #endif /* __nsRssIncomingServer_h */</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l151.1"></a><span id="l151.1" class="difflineminus">--- a/mailnews/local/src/nsRssService.cpp</span>
<a href="#l151.2"></a><span id="l151.2" class="difflineplus">+++ b/mailnews/local/src/nsRssService.cpp</span>
<a href="#l151.3"></a><span id="l151.3" class="difflineat">@@ -1,55 +1,55 @@</span>
<a href="#l151.4"></a><span id="l151.4"> /* This Source Code Form is subject to the terms of the Mozilla Public</span>
<a href="#l151.5"></a><span id="l151.5">  * License, v. 2.0. If a copy of the MPL was not distributed with this</span>
<a href="#l151.6"></a><span id="l151.6">  * file, You can obtain one at http://mozilla.org/MPL/2.0/. */</span>
<a href="#l151.7"></a><span id="l151.7"> </span>
<a href="#l151.8"></a><span id="l151.8"> #include &quot;nsRssService.h&quot;</span>
<a href="#l151.9"></a><span id="l151.9"> #include &quot;nsIRssIncomingServer.h&quot;</span>
<a href="#l151.10"></a><span id="l151.10"> #include &quot;nsCOMPtr.h&quot;</span>
<a href="#l151.11"></a><span id="l151.11" class="difflineminus">-#include &quot;nsILocalFile.h&quot;</span>
<a href="#l151.12"></a><span id="l151.12" class="difflineplus">+#include &quot;nsIFile.h&quot;</span>
<a href="#l151.13"></a><span id="l151.13"> #include &quot;nsMailDirServiceDefs.h&quot;</span>
<a href="#l151.14"></a><span id="l151.14"> #include &quot;nsIProperties.h&quot;</span>
<a href="#l151.15"></a><span id="l151.15"> #include &quot;nsServiceManagerUtils.h&quot;</span>
<a href="#l151.16"></a><span id="l151.16"> </span>
<a href="#l151.17"></a><span id="l151.17"> nsRssService::nsRssService()</span>
<a href="#l151.18"></a><span id="l151.18"> {</span>
<a href="#l151.19"></a><span id="l151.19"> }</span>
<a href="#l151.20"></a><span id="l151.20"> </span>
<a href="#l151.21"></a><span id="l151.21"> nsRssService::~nsRssService()</span>
<a href="#l151.22"></a><span id="l151.22"> {</span>
<a href="#l151.23"></a><span id="l151.23"> }</span>
<a href="#l151.24"></a><span id="l151.24"> </span>
<a href="#l151.25"></a><span id="l151.25"> NS_IMPL_ISUPPORTS2(nsRssService,</span>
<a href="#l151.26"></a><span id="l151.26">                    nsIRssService,</span>
<a href="#l151.27"></a><span id="l151.27">                    nsIMsgProtocolInfo)</span>
<a href="#l151.28"></a><span id="l151.28">                    </span>
<a href="#l151.29"></a><span id="l151.29" class="difflineminus">-NS_IMETHODIMP nsRssService::GetDefaultLocalPath(nsILocalFile * *aDefaultLocalPath)</span>
<a href="#l151.30"></a><span id="l151.30" class="difflineplus">+NS_IMETHODIMP nsRssService::GetDefaultLocalPath(nsIFile * *aDefaultLocalPath)</span>
<a href="#l151.31"></a><span id="l151.31"> {</span>
<a href="#l151.32"></a><span id="l151.32">     NS_ENSURE_ARG_POINTER(aDefaultLocalPath);</span>
<a href="#l151.33"></a><span id="l151.33">     *aDefaultLocalPath = nsnull;</span>
<a href="#l151.34"></a><span id="l151.34">     </span>
<a href="#l151.35"></a><span id="l151.35" class="difflineminus">-    nsCOMPtr&lt;nsILocalFile&gt; localFile;</span>
<a href="#l151.36"></a><span id="l151.36" class="difflineplus">+    nsCOMPtr&lt;nsIFile&gt; localFile;</span>
<a href="#l151.37"></a><span id="l151.37">     nsCOMPtr&lt;nsIProperties&gt; dirService(do_GetService(&quot;@mozilla.org/file/directory_service;1&quot;));</span>
<a href="#l151.38"></a><span id="l151.38">     if (!dirService) return NS_ERROR_FAILURE;</span>
<a href="#l151.39"></a><span id="l151.39" class="difflineminus">-    dirService-&gt;Get(NS_APP_MAIL_50_DIR, NS_GET_IID(nsILocalFile), getter_AddRefs(localFile));</span>
<a href="#l151.40"></a><span id="l151.40" class="difflineplus">+    dirService-&gt;Get(NS_APP_MAIL_50_DIR, NS_GET_IID(nsIFile), getter_AddRefs(localFile));</span>
<a href="#l151.41"></a><span id="l151.41">     if (!localFile) return NS_ERROR_FAILURE;</span>
<a href="#l151.42"></a><span id="l151.42"> </span>
<a href="#l151.43"></a><span id="l151.43">     bool exists;</span>
<a href="#l151.44"></a><span id="l151.44">     nsresult rv = localFile-&gt;Exists(&amp;exists);</span>
<a href="#l151.45"></a><span id="l151.45">     if (NS_SUCCEEDED(rv) &amp;&amp; !exists)</span>
<a href="#l151.46"></a><span id="l151.46">         rv = localFile-&gt;Create(nsIFile::DIRECTORY_TYPE, 0775);</span>
<a href="#l151.47"></a><span id="l151.47">     if (NS_FAILED(rv)) return rv;</span>
<a href="#l151.48"></a><span id="l151.48">    </span>
<a href="#l151.49"></a><span id="l151.49">     NS_IF_ADDREF(*aDefaultLocalPath = localFile);</span>
<a href="#l151.50"></a><span id="l151.50">     return NS_OK;</span>
<a href="#l151.51"></a><span id="l151.51"> </span>
<a href="#l151.52"></a><span id="l151.52"> }</span>
<a href="#l151.53"></a><span id="l151.53"> </span>
<a href="#l151.54"></a><span id="l151.54" class="difflineminus">-NS_IMETHODIMP nsRssService::SetDefaultLocalPath(nsILocalFile * aDefaultLocalPath)</span>
<a href="#l151.55"></a><span id="l151.55" class="difflineplus">+NS_IMETHODIMP nsRssService::SetDefaultLocalPath(nsIFile * aDefaultLocalPath)</span>
<a href="#l151.56"></a><span id="l151.56"> {</span>
<a href="#l151.57"></a><span id="l151.57">     return NS_ERROR_NOT_IMPLEMENTED;</span>
<a href="#l151.58"></a><span id="l151.58"> }</span>
<a href="#l151.59"></a><span id="l151.59"> </span>
<a href="#l151.60"></a><span id="l151.60"> NS_IMETHODIMP nsRssService::GetServerIID(nsIID * *aServerIID)</span>
<a href="#l151.61"></a><span id="l151.61"> {</span>
<a href="#l151.62"></a><span id="l151.62">     return NS_ERROR_NOT_IMPLEMENTED;</span>
<a href="#l151.63"></a><span id="l151.63"> }</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l152.1"></a><span id="l152.1" class="difflineminus">--- a/mailnews/mapi/mapihook/src/msgMapiHook.cpp</span>
<a href="#l152.2"></a><span id="l152.2" class="difflineplus">+++ b/mailnews/mapi/mapihook/src/msgMapiHook.cpp</span>
<a href="#l152.3"></a><span id="l152.3" class="difflineat">@@ -451,19 +451,19 @@ nsresult nsMapiHook::PopulateCompFields(</span>
<a href="#l152.4"></a><span id="l152.4"> nsresult nsMapiHook::HandleAttachments (nsIMsgCompFields * aCompFields, PRInt32 aFileCount,</span>
<a href="#l152.5"></a><span id="l152.5">                                         lpnsMapiFileDesc aFiles, BOOL aIsUnicode)</span>
<a href="#l152.6"></a><span id="l152.6"> {</span>
<a href="#l152.7"></a><span id="l152.7">     nsresult rv = NS_OK ;</span>
<a href="#l152.8"></a><span id="l152.8"> </span>
<a href="#l152.9"></a><span id="l152.9">     nsCAutoString Attachments ;</span>
<a href="#l152.10"></a><span id="l152.10">     nsCAutoString TempFiles ;</span>
<a href="#l152.11"></a><span id="l152.11"> </span>
<a href="#l152.12"></a><span id="l152.12" class="difflineminus">-    nsCOMPtr &lt;nsILocalFile&gt; pFile = do_CreateInstance (NS_LOCAL_FILE_CONTRACTID, &amp;rv) ;</span>
<a href="#l152.13"></a><span id="l152.13" class="difflineplus">+    nsCOMPtr &lt;nsIFile&gt; pFile = do_CreateInstance (NS_LOCAL_FILE_CONTRACTID, &amp;rv) ;</span>
<a href="#l152.14"></a><span id="l152.14">     if (NS_FAILED(rv) || (!pFile) ) return rv ;</span>
<a href="#l152.15"></a><span id="l152.15" class="difflineminus">-    nsCOMPtr &lt;nsILocalFile&gt; pTempDir = do_CreateInstance (NS_LOCAL_FILE_CONTRACTID, &amp;rv) ;</span>
<a href="#l152.16"></a><span id="l152.16" class="difflineplus">+    nsCOMPtr &lt;nsIFile&gt; pTempDir = do_CreateInstance (NS_LOCAL_FILE_CONTRACTID, &amp;rv) ;</span>
<a href="#l152.17"></a><span id="l152.17">     if (NS_FAILED(rv) || (!pTempDir) ) return rv ;</span>
<a href="#l152.18"></a><span id="l152.18"> </span>
<a href="#l152.19"></a><span id="l152.19">     for (int i=0 ; i &lt; aFileCount ; i++)</span>
<a href="#l152.20"></a><span id="l152.20">     {</span>
<a href="#l152.21"></a><span id="l152.21">         bool bTempFile = false ;</span>
<a href="#l152.22"></a><span id="l152.22">         if (aFiles[i].lpszPathName)</span>
<a href="#l152.23"></a><span id="l152.23">         {</span>
<a href="#l152.24"></a><span id="l152.24">             // check if attachment exists</span>
<a href="#l152.25"></a><span id="l152.25" class="difflineat">@@ -473,19 +473,18 @@ nsresult nsMapiHook::HandleAttachments (</span>
<a href="#l152.26"></a><span id="l152.26">                 pFile-&gt;InitWithNativePath (nsDependentCString((const char*)aFiles[i].lpszPathName));</span>
<a href="#l152.27"></a><span id="l152.27"> </span>
<a href="#l152.28"></a><span id="l152.28">             bool bExist ;</span>
<a href="#l152.29"></a><span id="l152.29">             rv = pFile-&gt;Exists(&amp;bExist) ;</span>
<a href="#l152.30"></a><span id="l152.30">             PR_LOG(MAPI, PR_LOG_DEBUG, (&quot;nsMapiHook::HandleAttachments: filename: %s path: %s exists = %s \n&quot;, (const char*)aFiles[i].lpszFileName, (const char*)aFiles[i].lpszPathName, bExist ? &quot;true&quot; : &quot;false&quot;));</span>
<a href="#l152.31"></a><span id="l152.31">             if (NS_FAILED(rv) || (!bExist) ) return NS_ERROR_FILE_TARGET_DOES_NOT_EXIST ;</span>
<a href="#l152.32"></a><span id="l152.32"> </span>
<a href="#l152.33"></a><span id="l152.33">             //Temp Directory</span>
<a href="#l152.34"></a><span id="l152.34" class="difflineminus">-            nsCOMPtr &lt;nsIFile&gt; pTempFileDir;</span>
<a href="#l152.35"></a><span id="l152.35" class="difflineminus">-            NS_GetSpecialDirectory(NS_OS_TEMP_DIR, getter_AddRefs(pTempFileDir));</span>
<a href="#l152.36"></a><span id="l152.36" class="difflineminus">-            nsCOMPtr &lt;nsILocalFile&gt; pTempDir = do_QueryInterface(pTempFileDir);</span>
<a href="#l152.37"></a><span id="l152.37" class="difflineplus">+            nsCOMPtr &lt;nsIFile&gt; pTempDir;</span>
<a href="#l152.38"></a><span id="l152.38" class="difflineplus">+            NS_GetSpecialDirectory(NS_OS_TEMP_DIR, getter_AddRefs(pTempDir));</span>
<a href="#l152.39"></a><span id="l152.39"> </span>
<a href="#l152.40"></a><span id="l152.40">             // create a new sub directory called moz_mapi underneath the temp directory</span>
<a href="#l152.41"></a><span id="l152.41">             pTempDir-&gt;AppendRelativePath(NS_LITERAL_STRING(&quot;moz_mapi&quot;));</span>
<a href="#l152.42"></a><span id="l152.42">             pTempDir-&gt;Exists (&amp;bExist) ;</span>
<a href="#l152.43"></a><span id="l152.43">             if (!bExist)</span>
<a href="#l152.44"></a><span id="l152.44">             {</span>
<a href="#l152.45"></a><span id="l152.45">                 rv = pTempDir-&gt;Create(nsIFile::DIRECTORY_TYPE, 777) ;</span>
<a href="#l152.46"></a><span id="l152.46">                 if (NS_FAILED(rv)) return rv ;</span>
<a href="#l152.47"></a><span id="l152.47" class="difflineat">@@ -702,26 +701,25 @@ nsresult nsMapiHook::PopulateCompFieldsF</span>
<a href="#l152.48"></a><span id="l152.48"> </span>
<a href="#l152.49"></a><span id="l152.49">   PRInt32 offset = 0 ;</span>
<a href="#l152.50"></a><span id="l152.50">   PRInt32 FilePathsLen = strFilePaths.Length() ;</span>
<a href="#l152.51"></a><span id="l152.51">   if (FilePathsLen)</span>
<a href="#l152.52"></a><span id="l152.52">   {</span>
<a href="#l152.53"></a><span id="l152.53">     nsAutoString Subject ;</span>
<a href="#l152.54"></a><span id="l152.54"> </span>
<a href="#l152.55"></a><span id="l152.55">     // multiple files to be sent, delim specified</span>
<a href="#l152.56"></a><span id="l152.56" class="difflineminus">-    nsCOMPtr &lt;nsILocalFile&gt; pFile = do_CreateInstance (NS_LOCAL_FILE_CONTRACTID, &amp;rv) ;</span>
<a href="#l152.57"></a><span id="l152.57" class="difflineplus">+    nsCOMPtr &lt;nsIFile&gt; pFile = do_CreateInstance (NS_LOCAL_FILE_CONTRACTID, &amp;rv) ;</span>
<a href="#l152.58"></a><span id="l152.58">     if (NS_FAILED(rv) || (!pFile) ) return rv ;</span>
<a href="#l152.59"></a><span id="l152.59"> </span>
<a href="#l152.60"></a><span id="l152.60">     PRUnichar * newFilePaths = (PRUnichar *) strFilePaths.get() ;</span>
<a href="#l152.61"></a><span id="l152.61">     while (offset != kNotFound)</span>
<a href="#l152.62"></a><span id="l152.62">     {</span>
<a href="#l152.63"></a><span id="l152.63">       //Temp Directory</span>
<a href="#l152.64"></a><span id="l152.64" class="difflineminus">-      nsCOMPtr &lt;nsIFile&gt; pTempFileDir;</span>
<a href="#l152.65"></a><span id="l152.65" class="difflineminus">-      NS_GetSpecialDirectory(NS_OS_TEMP_DIR, getter_AddRefs(pTempFileDir));</span>
<a href="#l152.66"></a><span id="l152.66" class="difflineminus">-      nsCOMPtr &lt;nsILocalFile&gt; pTempDir = do_QueryInterface(pTempFileDir);</span>
<a href="#l152.67"></a><span id="l152.67" class="difflineplus">+      nsCOMPtr &lt;nsIFile&gt; pTempDir;</span>
<a href="#l152.68"></a><span id="l152.68" class="difflineplus">+      NS_GetSpecialDirectory(NS_OS_TEMP_DIR, getter_AddRefs(pTempDir));</span>
<a href="#l152.69"></a><span id="l152.69"> </span>
<a href="#l152.70"></a><span id="l152.70">       // if not already existing, create another temp dir for mapi within Win temp dir</span>
<a href="#l152.71"></a><span id="l152.71">       // this is windows only so we can do &quot;\\&quot;</span>
<a href="#l152.72"></a><span id="l152.72">       pTempDir-&gt;AppendRelativePath (NS_LITERAL_STRING(&quot;moz_mapi&quot;));</span>
<a href="#l152.73"></a><span id="l152.73">       pTempDir-&gt;Exists(&amp;bExist) ;</span>
<a href="#l152.74"></a><span id="l152.74">       if (!bExist)</span>
<a href="#l152.75"></a><span id="l152.75">       {</span>
<a href="#l152.76"></a><span id="l152.76">         rv = pTempDir-&gt;Create(nsIFile::DIRECTORY_TYPE, 777) ;</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l153.1"></a><span id="l153.1" class="difflineminus">--- a/mailnews/mapi/mapihook/src/msgMapiImp.cpp</span>
<a href="#l153.2"></a><span id="l153.2" class="difflineplus">+++ b/mailnews/mapi/mapihook/src/msgMapiImp.cpp</span>
<a href="#l153.3"></a><span id="l153.3" class="difflineat">@@ -27,17 +27,17 @@</span>
<a href="#l153.4"></a><span id="l153.4"> #include &quot;nsIMsgAccountManager.h&quot;</span>
<a href="#l153.5"></a><span id="l153.5"> #include &quot;nsIMsgFolder.h&quot;</span>
<a href="#l153.6"></a><span id="l153.6"> #include &quot;nsIMsgImapMailFolder.h&quot;</span>
<a href="#l153.7"></a><span id="l153.7"> #include &lt;time.h&gt;</span>
<a href="#l153.8"></a><span id="l153.8"> #include &quot;nsIInputStream.h&quot;</span>
<a href="#l153.9"></a><span id="l153.9"> #include &quot;nsIMsgHeaderParser.h&quot;</span>
<a href="#l153.10"></a><span id="l153.10"> #include &quot;nsILineInputStream.h&quot;</span>
<a href="#l153.11"></a><span id="l153.11"> #include &quot;nsISeekableStream.h&quot;</span>
<a href="#l153.12"></a><span id="l153.12" class="difflineminus">-#include &quot;nsILocalFile.h&quot;</span>
<a href="#l153.13"></a><span id="l153.13" class="difflineplus">+#include &quot;nsIFile.h&quot;</span>
<a href="#l153.14"></a><span id="l153.14"> #include &quot;nsIFileStreams.h&quot;</span>
<a href="#l153.15"></a><span id="l153.15"> #include &quot;nsNetCID.h&quot;</span>
<a href="#l153.16"></a><span id="l153.16"> #include &quot;nsMsgMessageFlags.h&quot;</span>
<a href="#l153.17"></a><span id="l153.17"> </span>
<a href="#l153.18"></a><span id="l153.18"> PRLogModuleInfo *MAPI;</span>
<a href="#l153.19"></a><span id="l153.19"> </span>
<a href="#l153.20"></a><span id="l153.20"> CMapiImp::CMapiImp()</span>
<a href="#l153.21"></a><span id="l153.21"> : m_cRef(1)</span>
<a href="#l153.22"></a><span id="l153.22" class="difflineat">@@ -711,17 +711,17 @@ char *MsgMapiListContext::ConvertBodyToM</span>
<a href="#l153.23"></a><span id="l153.23"> #define EMPTY_MESSAGE_LINE(buf) (buf[0] == '\r' || buf[0] == '\n' || buf[0] == '\0')</span>
<a href="#l153.24"></a><span id="l153.24"> </span>
<a href="#l153.25"></a><span id="l153.25">   nsCOMPtr &lt;nsIMsgFolder&gt; folder;</span>
<a href="#l153.26"></a><span id="l153.26">   hdr-&gt;GetFolder(getter_AddRefs(folder));</span>
<a href="#l153.27"></a><span id="l153.27">   if (!folder)</span>
<a href="#l153.28"></a><span id="l153.28">     return nsnull;</span>
<a href="#l153.29"></a><span id="l153.29"> </span>
<a href="#l153.30"></a><span id="l153.30">   nsCOMPtr &lt;nsIInputStream&gt; inputStream;</span>
<a href="#l153.31"></a><span id="l153.31" class="difflineminus">-  nsCOMPtr &lt;nsILocalFile&gt; localFile;</span>
<a href="#l153.32"></a><span id="l153.32" class="difflineplus">+  nsCOMPtr &lt;nsIFile&gt; localFile;</span>
<a href="#l153.33"></a><span id="l153.33">   folder-&gt;GetFilePath(getter_AddRefs(localFile));</span>
<a href="#l153.34"></a><span id="l153.34"> </span>
<a href="#l153.35"></a><span id="l153.35">   nsresult rv;</span>
<a href="#l153.36"></a><span id="l153.36">   nsCOMPtr&lt;nsIFileInputStream&gt; fileStream = do_CreateInstance(NS_LOCALFILEINPUTSTREAM_CONTRACTID, &amp;rv);</span>
<a href="#l153.37"></a><span id="l153.37">   NS_ENSURE_SUCCESS(rv, nsnull);</span>
<a href="#l153.38"></a><span id="l153.38"> </span>
<a href="#l153.39"></a><span id="l153.39">   rv = fileStream-&gt;Init(localFile,  PR_RDONLY, 0664, false);  //just have to read the messages</span>
<a href="#l153.40"></a><span id="l153.40">   inputStream = do_QueryInterface(fileStream);</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l154.1"></a><span id="l154.1" class="difflineminus">--- a/mailnews/mime/src/mimeebod.cpp</span>
<a href="#l154.2"></a><span id="l154.2" class="difflineplus">+++ b/mailnews/mime/src/mimeebod.cpp</span>
<a href="#l154.3"></a><span id="l154.3" class="difflineat">@@ -171,17 +171,17 @@ MimeExternalBody_make_url(const char *ct</span>
<a href="#l154.4"></a><span id="l154.4">   else if (!PL_strcasecmp(at, &quot;local-file&quot;) || !PL_strcasecmp(at, &quot;afs&quot;))</span>
<a href="#l154.5"></a><span id="l154.5">   {</span>
<a href="#l154.6"></a><span id="l154.6">     if (!name)</span>
<a href="#l154.7"></a><span id="l154.7">       return 0;</span>
<a href="#l154.8"></a><span id="l154.8"> </span>
<a href="#l154.9"></a><span id="l154.9"> #ifdef XP_UNIX</span>
<a href="#l154.10"></a><span id="l154.10">     if (!PL_strcasecmp(at, &quot;afs&quot;))   /* only if there is a /afs/ directory */</span>
<a href="#l154.11"></a><span id="l154.11">     {</span>
<a href="#l154.12"></a><span id="l154.12" class="difflineminus">-      nsCOMPtr &lt;nsILocalFile&gt; fs = do_CreateInstance(NS_LOCAL_FILE_CONTRACTID);</span>
<a href="#l154.13"></a><span id="l154.13" class="difflineplus">+      nsCOMPtr &lt;nsIFile&gt; fs = do_CreateInstance(NS_LOCAL_FILE_CONTRACTID);</span>
<a href="#l154.14"></a><span id="l154.14">       bool exists = false;</span>
<a href="#l154.15"></a><span id="l154.15">       if (fs)</span>
<a href="#l154.16"></a><span id="l154.16">       {</span>
<a href="#l154.17"></a><span id="l154.17">         fs-&gt;InitWithNativePath(NS_LITERAL_CSTRING(&quot;/afs/.&quot;));</span>
<a href="#l154.18"></a><span id="l154.18">         fs-&gt;Exists(&amp;exists);</span>
<a href="#l154.19"></a><span id="l154.19">       }</span>
<a href="#l154.20"></a><span id="l154.20">       if  (!exists)</span>
<a href="#l154.21"></a><span id="l154.21">         return 0;</span>
<a href="#l154.22"></a><span id="l154.22" class="difflineat">@@ -484,17 +484,17 @@ MimeExternalBody_displayable_inline_p (M</span>
<a href="#l154.23"></a><span id="l154.23">        !PL_strcasecmp(at, &quot;anon-ftp&quot;) ||</span>
<a href="#l154.24"></a><span id="l154.24">        !PL_strcasecmp(at, &quot;local-file&quot;) ||</span>
<a href="#l154.25"></a><span id="l154.25">        !PL_strcasecmp(at, &quot;mail-server&quot;) ||</span>
<a href="#l154.26"></a><span id="l154.26">        !PL_strcasecmp(at, &quot;url&quot;))</span>
<a href="#l154.27"></a><span id="l154.27">   inline_p = true;</span>
<a href="#l154.28"></a><span id="l154.28"> #ifdef XP_UNIX</span>
<a href="#l154.29"></a><span id="l154.29">   else if (!PL_strcasecmp(at, &quot;afs&quot;))   /* only if there is a /afs/ directory */</span>
<a href="#l154.30"></a><span id="l154.30">   {</span>
<a href="#l154.31"></a><span id="l154.31" class="difflineminus">-    nsCOMPtr &lt;nsILocalFile&gt; fs = do_CreateInstance(NS_LOCAL_FILE_CONTRACTID);</span>
<a href="#l154.32"></a><span id="l154.32" class="difflineplus">+    nsCOMPtr &lt;nsIFile&gt; fs = do_CreateInstance(NS_LOCAL_FILE_CONTRACTID);</span>
<a href="#l154.33"></a><span id="l154.33">     bool exists = false;</span>
<a href="#l154.34"></a><span id="l154.34">     if (fs)</span>
<a href="#l154.35"></a><span id="l154.35">     {</span>
<a href="#l154.36"></a><span id="l154.36">       fs-&gt;InitWithNativePath(NS_LITERAL_CSTRING(&quot;/afs/.&quot;));</span>
<a href="#l154.37"></a><span id="l154.37">       fs-&gt;Exists(&amp;exists);</span>
<a href="#l154.38"></a><span id="l154.38">     }</span>
<a href="#l154.39"></a><span id="l154.39">     if  (!exists)</span>
<a href="#l154.40"></a><span id="l154.40">       return 0;</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l155.1"></a><span id="l155.1" class="difflineminus">--- a/mailnews/mime/src/mimemoz2.h</span>
<a href="#l155.2"></a><span id="l155.2" class="difflineplus">+++ b/mailnews/mime/src/mimemoz2.h</span>
<a href="#l155.3"></a><span id="l155.3" class="difflineat">@@ -112,17 +112,17 @@ public:</span>
<a href="#l155.4"></a><span id="l155.4">   nsMIMESession       *stream;             // not used for now</span>
<a href="#l155.5"></a><span id="l155.5">   MimeObject          *obj;                // The root</span>
<a href="#l155.6"></a><span id="l155.6">   MimeDisplayOptions  *options;            // data for communicating with libmime</span>
<a href="#l155.7"></a><span id="l155.7">   MimeHeaders         *headers;            // Copy of outer most mime header</span>
<a href="#l155.8"></a><span id="l155.8">   nsTArray&lt;nsMsgAttachedFile*&gt; attachments;// attachments</span>
<a href="#l155.9"></a><span id="l155.9">   nsMsgAttachedFile   *messageBody;        // message body</span>
<a href="#l155.10"></a><span id="l155.10">   nsMsgAttachedFile   *curAttachment;       // temp</span>
<a href="#l155.11"></a><span id="l155.11"> </span>
<a href="#l155.12"></a><span id="l155.12" class="difflineminus">-  nsCOMPtr &lt;nsILocalFile&gt; tmpFile;</span>
<a href="#l155.13"></a><span id="l155.13" class="difflineplus">+  nsCOMPtr &lt;nsIFile&gt; tmpFile;</span>
<a href="#l155.14"></a><span id="l155.14">   nsCOMPtr &lt;nsIOutputStream&gt; tmpFileStream;      // output file handle</span>
<a href="#l155.15"></a><span id="l155.15"> </span>
<a href="#l155.16"></a><span id="l155.16">   MimeDecoderData     *decoder_data;</span>
<a href="#l155.17"></a><span id="l155.17">   char                *mailcharset;        // get it from CHARSET of Content-Type</span>
<a href="#l155.18"></a><span id="l155.18">   bool                forwardInline;</span>
<a href="#l155.19"></a><span id="l155.19">   bool                forwardInlineFilter;</span>
<a href="#l155.20"></a><span id="l155.20">   bool                overrideComposeFormat; // Override compose format (for forward inline).</span>
<a href="#l155.21"></a><span id="l155.21">   nsString            forwardToAddress;</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l156.1"></a><span id="l156.1" class="difflineminus">--- a/mailnews/mime/src/mimemrel.h</span>
<a href="#l156.2"></a><span id="l156.2" class="difflineplus">+++ b/mailnews/mime/src/mimemrel.h</span>
<a href="#l156.3"></a><span id="l156.3" class="difflineat">@@ -30,17 +30,17 @@ struct MimeMultipartRelated {</span>
<a href="#l156.4"></a><span id="l156.4">   char* base_url;        /* Base URL (if any) for the whole</span>
<a href="#l156.5"></a><span id="l156.5">                    multipart/related. */</span>
<a href="#l156.6"></a><span id="l156.6"> </span>
<a href="#l156.7"></a><span id="l156.7">   char* head_buffer;      /* Buffer used to remember the text/html 'head'</span>
<a href="#l156.8"></a><span id="l156.8">                    part. */</span>
<a href="#l156.9"></a><span id="l156.9">   PRInt32 head_buffer_fp;    /* Active length. */</span>
<a href="#l156.10"></a><span id="l156.10">   PRInt32 head_buffer_size;    /* How big it is. */</span>
<a href="#l156.11"></a><span id="l156.11"> </span>
<a href="#l156.12"></a><span id="l156.12" class="difflineminus">-  nsCOMPtr &lt;nsILocalFile&gt;          file_buffer;    /* The nsILocalFile of a temp file used when we</span>
<a href="#l156.13"></a><span id="l156.13" class="difflineplus">+  nsCOMPtr &lt;nsIFile&gt;          file_buffer;    /* The nsIFile of a temp file used when we</span>
<a href="#l156.14"></a><span id="l156.14">                                                run out of room in the head_buffer. */</span>
<a href="#l156.15"></a><span id="l156.15">   nsCOMPtr &lt;nsIInputStream&gt;   input_file_stream;    /* A stream to it. */</span>
<a href="#l156.16"></a><span id="l156.16">   nsCOMPtr &lt;nsIOutputStream&gt;  output_file_stream;  /* A stream to it. */</span>
<a href="#l156.17"></a><span id="l156.17"> </span>
<a href="#l156.18"></a><span id="l156.18">   MimeHeaders* buffered_hdrs;  /* The headers of the 'head' part. */</span>
<a href="#l156.19"></a><span id="l156.19"> </span>
<a href="#l156.20"></a><span id="l156.20">   bool head_loaded;    /* Whether we've already passed the 'head'</span>
<a href="#l156.21"></a><span id="l156.21">                    part. */</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l157.1"></a><span id="l157.1" class="difflineminus">--- a/mailnews/mime/src/mimepbuf.cpp</span>
<a href="#l157.2"></a><span id="l157.2" class="difflineplus">+++ b/mailnews/mime/src/mimepbuf.cpp</span>
<a href="#l157.3"></a><span id="l157.3" class="difflineat">@@ -50,17 +50,17 @@ nsMsgCreateTempFile(const char *tFileNam</span>
<a href="#l157.4"></a><span id="l157.4"> </span>
<a href="#l157.5"></a><span id="l157.5"> </span>
<a href="#l157.6"></a><span id="l157.6"> struct MimePartBufferData</span>
<a href="#l157.7"></a><span id="l157.7"> {</span>
<a href="#l157.8"></a><span id="l157.8">   char        *part_buffer;          /* Buffer used for part-lookahead. */</span>
<a href="#l157.9"></a><span id="l157.9">   PRInt32     part_buffer_fp;        /* Active length. */</span>
<a href="#l157.10"></a><span id="l157.10">   PRInt32     part_buffer_size;      /* How big it is. */</span>
<a href="#l157.11"></a><span id="l157.11"> </span>
<a href="#l157.12"></a><span id="l157.12" class="difflineminus">-  nsCOMPtr &lt;nsILocalFile&gt; file_buffer;    /* The nsILocalFile of a temp file used when we</span>
<a href="#l157.13"></a><span id="l157.13" class="difflineplus">+  nsCOMPtr &lt;nsIFile&gt; file_buffer;    /* The nsIFile of a temp file used when we</span>
<a href="#l157.14"></a><span id="l157.14">                                                           run out of room in the head_buffer. */</span>
<a href="#l157.15"></a><span id="l157.15">   nsCOMPtr &lt;nsIInputStream&gt; input_file_stream;    /* A stream to it. */</span>
<a href="#l157.16"></a><span id="l157.16">   nsCOMPtr &lt;nsIOutputStream&gt; output_file_stream;  /* A stream to it. */</span>
<a href="#l157.17"></a><span id="l157.17"> };</span>
<a href="#l157.18"></a><span id="l157.18"> </span>
<a href="#l157.19"></a><span id="l157.19"> MimePartBufferData *</span>
<a href="#l157.20"></a><span id="l157.20"> MimePartBufferCreate (void)</span>
<a href="#l157.21"></a><span id="l157.21"> {</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l158.1"></a><span id="l158.1" class="difflineminus">--- a/mailnews/news/public/nsINntpIncomingServer.idl</span>
<a href="#l158.2"></a><span id="l158.2" class="difflineplus">+++ b/mailnews/news/public/nsINntpIncomingServer.idl</span>
<a href="#l158.3"></a><span id="l158.3" class="difflineat">@@ -1,30 +1,30 @@</span>
<a href="#l158.4"></a><span id="l158.4"> /* -*- Mode: IDL; tab-width: 4; indent-tabs-mode: nil; c-basic-offset: 4 -*- */</span>
<a href="#l158.5"></a><span id="l158.5"> /* This Source Code Form is subject to the terms of the Mozilla Public</span>
<a href="#l158.6"></a><span id="l158.6">  * License, v. 2.0. If a copy of the MPL was not distributed with this</span>
<a href="#l158.7"></a><span id="l158.7">  * file, You can obtain one at http://mozilla.org/MPL/2.0/. */</span>
<a href="#l158.8"></a><span id="l158.8"> </span>
<a href="#l158.9"></a><span id="l158.9"> #include &quot;nsISupports.idl&quot;</span>
<a href="#l158.10"></a><span id="l158.10"> </span>
<a href="#l158.11"></a><span id="l158.11" class="difflineminus">-interface nsILocalFile;</span>
<a href="#l158.12"></a><span id="l158.12" class="difflineplus">+interface nsIFile;</span>
<a href="#l158.13"></a><span id="l158.13"> interface nsIMsgNewsFolder;</span>
<a href="#l158.14"></a><span id="l158.14"> interface nsINNTPProtocol;</span>
<a href="#l158.15"></a><span id="l158.15"> interface nsNNTPProtocol;</span>
<a href="#l158.16"></a><span id="l158.16"> interface nsIChannel;</span>
<a href="#l158.17"></a><span id="l158.17"> interface nsIURI;</span>
<a href="#l158.18"></a><span id="l158.18"> interface nsIMsgWindow;</span>
<a href="#l158.19"></a><span id="l158.19"> </span>
<a href="#l158.20"></a><span id="l158.20"> [scriptable, uuid(077620ed-c6c4-4d4d-bed5-4d041f924002)]</span>
<a href="#l158.21"></a><span id="l158.21"> interface nsINntpIncomingServer : nsISupports {</span>
<a href="#l158.22"></a><span id="l158.22">     /* the on-disk path to the newsrc file for this server */</span>
<a href="#l158.23"></a><span id="l158.23" class="difflineminus">-    attribute nsILocalFile newsrcFilePath;</span>
<a href="#l158.24"></a><span id="l158.24" class="difflineplus">+    attribute nsIFile newsrcFilePath;</span>
<a href="#l158.25"></a><span id="l158.25"> </span>
<a href="#l158.26"></a><span id="l158.26">     /* the newsrc root path (the directories all the newsrc files live) */</span>
<a href="#l158.27"></a><span id="l158.27" class="difflineminus">-    attribute nsILocalFile newsrcRootPath;</span>
<a href="#l158.28"></a><span id="l158.28" class="difflineplus">+    attribute nsIFile newsrcRootPath;</span>
<a href="#l158.29"></a><span id="l158.29">     </span>
<a href="#l158.30"></a><span id="l158.30">     /* ask the user before downloading more than maxArticles? */</span>
<a href="#l158.31"></a><span id="l158.31">     attribute boolean notifyOn;</span>
<a href="#l158.32"></a><span id="l158.32"> </span>
<a href="#l158.33"></a><span id="l158.33">     /* the max articles to download */</span>
<a href="#l158.34"></a><span id="l158.34">     attribute long maxArticles;</span>
<a href="#l158.35"></a><span id="l158.35"> </span>
<a href="#l158.36"></a><span id="l158.36">     /* when we don't download all, do we mark the rest read? */</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l159.1"></a><span id="l159.1" class="difflineminus">--- a/mailnews/news/src/nsNewsFolder.cpp</span>
<a href="#l159.2"></a><span id="l159.2" class="difflineplus">+++ b/mailnews/news/src/nsNewsFolder.cpp</span>
<a href="#l159.3"></a><span id="l159.3" class="difflineat">@@ -198,17 +198,17 @@ NS_IMETHODIMP nsMsgNewsFolder::QueryInte</span>
<a href="#l159.4"></a><span id="l159.4">   }</span>
<a href="#l159.5"></a><span id="l159.5"> </span>
<a href="#l159.6"></a><span id="l159.6">   return nsMsgDBFolder::QueryInterface(aIID, aInstancePtr);</span>
<a href="#l159.7"></a><span id="l159.7"> }</span>
<a href="#l159.8"></a><span id="l159.8"> </span>
<a href="#l159.9"></a><span id="l159.9"> ////////////////////////////////////////////////////////////////////////////////</span>
<a href="#l159.10"></a><span id="l159.10"> </span>
<a href="#l159.11"></a><span id="l159.11"> nsresult</span>
<a href="#l159.12"></a><span id="l159.12" class="difflineminus">-nsMsgNewsFolder::CreateSubFolders(nsILocalFile *path)</span>
<a href="#l159.13"></a><span id="l159.13" class="difflineplus">+nsMsgNewsFolder::CreateSubFolders(nsIFile *path)</span>
<a href="#l159.14"></a><span id="l159.14"> {</span>
<a href="#l159.15"></a><span id="l159.15">   nsresult rv;</span>
<a href="#l159.16"></a><span id="l159.16">   bool isNewsServer = false;</span>
<a href="#l159.17"></a><span id="l159.17">   rv = GetIsServer(&amp;isNewsServer);</span>
<a href="#l159.18"></a><span id="l159.18">   if (NS_FAILED(rv)) return rv;</span>
<a href="#l159.19"></a><span id="l159.19"> </span>
<a href="#l159.20"></a><span id="l159.20">   if (isNewsServer)</span>
<a href="#l159.21"></a><span id="l159.21">   {</span>
<a href="#l159.22"></a><span id="l159.22" class="difflineat">@@ -291,23 +291,23 @@ nsMsgNewsFolder::AddNewsgroup(const nsAC</span>
<a href="#l159.23"></a><span id="l159.23">   NS_ENSURE_SUCCESS(rv,rv);</span>
<a href="#l159.24"></a><span id="l159.24"> </span>
<a href="#l159.25"></a><span id="l159.25">   mSubFolders.AppendObject(folder);</span>
<a href="#l159.26"></a><span id="l159.26">   folder-&gt;SetParent(this);</span>
<a href="#l159.27"></a><span id="l159.27">   folder.swap(*child);</span>
<a href="#l159.28"></a><span id="l159.28">   return rv;</span>
<a href="#l159.29"></a><span id="l159.29"> }</span>
<a href="#l159.30"></a><span id="l159.30"> </span>
<a href="#l159.31"></a><span id="l159.31" class="difflineminus">-nsresult nsMsgNewsFolder::ParseFolder(nsILocalFile *path)</span>
<a href="#l159.32"></a><span id="l159.32" class="difflineplus">+nsresult nsMsgNewsFolder::ParseFolder(nsIFile *path)</span>
<a href="#l159.33"></a><span id="l159.33"> {</span>
<a href="#l159.34"></a><span id="l159.34">   return NS_ERROR_NOT_IMPLEMENTED;</span>
<a href="#l159.35"></a><span id="l159.35"> }</span>
<a href="#l159.36"></a><span id="l159.36"> </span>
<a href="#l159.37"></a><span id="l159.37"> nsresult</span>
<a href="#l159.38"></a><span id="l159.38" class="difflineminus">-nsMsgNewsFolder::AddDirectorySeparator(nsILocalFile *path)</span>
<a href="#l159.39"></a><span id="l159.39" class="difflineplus">+nsMsgNewsFolder::AddDirectorySeparator(nsIFile *path)</span>
<a href="#l159.40"></a><span id="l159.40"> {</span>
<a href="#l159.41"></a><span id="l159.41">   // don't concat the full separator with .sbd</span>
<a href="#l159.42"></a><span id="l159.42">   return (mURI.Equals(kNewsRootURI)) ?</span>
<a href="#l159.43"></a><span id="l159.43">                   NS_OK :</span>
<a href="#l159.44"></a><span id="l159.44">                   nsMsgDBFolder::AddDirectorySeparator(path);</span>
<a href="#l159.45"></a><span id="l159.45"> }</span>
<a href="#l159.46"></a><span id="l159.46"> </span>
<a href="#l159.47"></a><span id="l159.47"> </span>
<a href="#l159.48"></a><span id="l159.48" class="difflineat">@@ -315,17 +315,17 @@ NS_IMETHODIMP</span>
<a href="#l159.49"></a><span id="l159.49"> nsMsgNewsFolder::GetSubFolders(nsISimpleEnumerator **aResult)</span>
<a href="#l159.50"></a><span id="l159.50"> {</span>
<a href="#l159.51"></a><span id="l159.51">   if (!mInitialized)</span>
<a href="#l159.52"></a><span id="l159.52">   {</span>
<a href="#l159.53"></a><span id="l159.53">     // do this first, so we make sure to do it, even on failure.</span>
<a href="#l159.54"></a><span id="l159.54">     // see bug #70494</span>
<a href="#l159.55"></a><span id="l159.55">     mInitialized = true;</span>
<a href="#l159.56"></a><span id="l159.56"> </span>
<a href="#l159.57"></a><span id="l159.57" class="difflineminus">-    nsCOMPtr&lt;nsILocalFile&gt; path;</span>
<a href="#l159.58"></a><span id="l159.58" class="difflineplus">+    nsCOMPtr&lt;nsIFile&gt; path;</span>
<a href="#l159.59"></a><span id="l159.59">     nsresult rv = GetFilePath(getter_AddRefs(path));</span>
<a href="#l159.60"></a><span id="l159.60">     if (NS_FAILED(rv)) return rv;</span>
<a href="#l159.61"></a><span id="l159.61"> </span>
<a href="#l159.62"></a><span id="l159.62">     rv = CreateSubFolders(path);</span>
<a href="#l159.63"></a><span id="l159.63">     if (NS_FAILED(rv)) return rv;</span>
<a href="#l159.64"></a><span id="l159.64"> </span>
<a href="#l159.65"></a><span id="l159.65">     // force ourselves to get initialized from cache</span>
<a href="#l159.66"></a><span id="l159.66">     // Don't care if it fails.  this will fail the first time after</span>
<a href="#l159.67"></a><span id="l159.67" class="difflineat">@@ -601,22 +601,22 @@ NS_IMETHODIMP nsMsgNewsFolder::Delete()</span>
<a href="#l159.68"></a><span id="l159.68">   nsresult rv = GetDatabase();</span>
<a href="#l159.69"></a><span id="l159.69"> </span>
<a href="#l159.70"></a><span id="l159.70">   if(NS_SUCCEEDED(rv))</span>
<a href="#l159.71"></a><span id="l159.71">   {</span>
<a href="#l159.72"></a><span id="l159.72">     mDatabase-&gt;ForceClosed();</span>
<a href="#l159.73"></a><span id="l159.73">     mDatabase = nsnull;</span>
<a href="#l159.74"></a><span id="l159.74">   }</span>
<a href="#l159.75"></a><span id="l159.75"> </span>
<a href="#l159.76"></a><span id="l159.76" class="difflineminus">-  nsCOMPtr&lt;nsILocalFile&gt; folderPath;</span>
<a href="#l159.77"></a><span id="l159.77" class="difflineplus">+  nsCOMPtr&lt;nsIFile&gt; folderPath;</span>
<a href="#l159.78"></a><span id="l159.78">   rv = GetFilePath(getter_AddRefs(folderPath));</span>
<a href="#l159.79"></a><span id="l159.79"> </span>
<a href="#l159.80"></a><span id="l159.80">   if (NS_SUCCEEDED(rv))</span>
<a href="#l159.81"></a><span id="l159.81">   {</span>
<a href="#l159.82"></a><span id="l159.82" class="difflineminus">-    nsCOMPtr&lt;nsILocalFile&gt; summaryPath;</span>
<a href="#l159.83"></a><span id="l159.83" class="difflineplus">+    nsCOMPtr&lt;nsIFile&gt; summaryPath;</span>
<a href="#l159.84"></a><span id="l159.84">     rv = GetSummaryFileLocation(folderPath, getter_AddRefs(summaryPath));</span>
<a href="#l159.85"></a><span id="l159.85">     if (NS_SUCCEEDED(rv))</span>
<a href="#l159.86"></a><span id="l159.86">     {</span>
<a href="#l159.87"></a><span id="l159.87">       bool exists = false;</span>
<a href="#l159.88"></a><span id="l159.88">       rv = folderPath-&gt;Exists(&amp;exists);</span>
<a href="#l159.89"></a><span id="l159.89"> </span>
<a href="#l159.90"></a><span id="l159.90">       if (NS_SUCCEEDED(rv) &amp;&amp; exists)</span>
<a href="#l159.91"></a><span id="l159.91">         rv = folderPath-&gt;Remove(false);</span>
<a href="#l159.92"></a><span id="l159.92" class="difflineat">@@ -1949,21 +1949,21 @@ nsMsgNewsFolder::GetFilterList(nsIMsgWin</span>
<a href="#l159.93"></a><span id="l159.93">     nsCOMPtr&lt;nsIMsgIncomingServer&gt; server;</span>
<a href="#l159.94"></a><span id="l159.94">     nsresult rv = GetServer(getter_AddRefs(server));</span>
<a href="#l159.95"></a><span id="l159.95">     NS_ENSURE_SUCCESS(rv,rv);</span>
<a href="#l159.96"></a><span id="l159.96">     return server-&gt;GetFilterList(aMsgWindow, aResult);</span>
<a href="#l159.97"></a><span id="l159.97">   }</span>
<a href="#l159.98"></a><span id="l159.98"> </span>
<a href="#l159.99"></a><span id="l159.99">   if (!mFilterList)</span>
<a href="#l159.100"></a><span id="l159.100">   {</span>
<a href="#l159.101"></a><span id="l159.101" class="difflineminus">-    nsCOMPtr&lt;nsILocalFile&gt; thisFolder;</span>
<a href="#l159.102"></a><span id="l159.102" class="difflineplus">+    nsCOMPtr&lt;nsIFile&gt; thisFolder;</span>
<a href="#l159.103"></a><span id="l159.103">     nsresult rv = GetFilePath(getter_AddRefs(thisFolder));</span>
<a href="#l159.104"></a><span id="l159.104">     NS_ENSURE_SUCCESS(rv, rv);</span>
<a href="#l159.105"></a><span id="l159.105"> </span>
<a href="#l159.106"></a><span id="l159.106" class="difflineminus">-    nsCOMPtr &lt;nsILocalFile&gt; filterFile = do_CreateInstance(NS_LOCAL_FILE_CONTRACTID, &amp;rv);</span>
<a href="#l159.107"></a><span id="l159.107" class="difflineplus">+    nsCOMPtr &lt;nsIFile&gt; filterFile = do_CreateInstance(NS_LOCAL_FILE_CONTRACTID, &amp;rv);</span>
<a href="#l159.108"></a><span id="l159.108">     NS_ENSURE_SUCCESS(rv, rv);;</span>
<a href="#l159.109"></a><span id="l159.109">     rv = filterFile-&gt;InitWithFile(thisFolder);</span>
<a href="#l159.110"></a><span id="l159.110">     NS_ENSURE_SUCCESS(rv, rv);</span>
<a href="#l159.111"></a><span id="l159.111"> </span>
<a href="#l159.112"></a><span id="l159.112">     // in 4.x, the news filter file was</span>
<a href="#l159.113"></a><span id="l159.113">     // C:\Program Files\Netscape\Users\meer\News\host-news.mcom.com\mcom.test.dat</span>
<a href="#l159.114"></a><span id="l159.114">     // where the summary file was</span>
<a href="#l159.115"></a><span id="l159.115">     // C:\Program Files\Netscape\Users\meer\News\host-news.mcom.com\mcom.test.snm</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l160.1"></a><span id="l160.1" class="difflineminus">--- a/mailnews/news/src/nsNewsFolder.h</span>
<a href="#l160.2"></a><span id="l160.2" class="difflineplus">+++ b/mailnews/news/src/nsNewsFolder.h</span>
<a href="#l160.3"></a><span id="l160.3" class="difflineat">@@ -6,17 +6,17 @@</span>
<a href="#l160.4"></a><span id="l160.4"> /**</span>
<a href="#l160.5"></a><span id="l160.5">    Interface for representing News folders.</span>
<a href="#l160.6"></a><span id="l160.6"> */</span>
<a href="#l160.7"></a><span id="l160.7"> </span>
<a href="#l160.8"></a><span id="l160.8"> #ifndef nsMsgNewsFolder_h__</span>
<a href="#l160.9"></a><span id="l160.9"> #define nsMsgNewsFolder_h__</span>
<a href="#l160.10"></a><span id="l160.10"> </span>
<a href="#l160.11"></a><span id="l160.11"> #include &quot;nsMsgDBFolder.h&quot;</span>
<a href="#l160.12"></a><span id="l160.12" class="difflineminus">-#include &quot;nsILocalFile.h&quot;</span>
<a href="#l160.13"></a><span id="l160.13" class="difflineplus">+#include &quot;nsIFile.h&quot;</span>
<a href="#l160.14"></a><span id="l160.14"> #include &quot;nsINntpIncomingServer.h&quot; // need this for the IID</span>
<a href="#l160.15"></a><span id="l160.15"> #include &quot;nsNewsUtils.h&quot;</span>
<a href="#l160.16"></a><span id="l160.16"> #include &quot;nsMsgKeySet.h&quot;</span>
<a href="#l160.17"></a><span id="l160.17"> #include &quot;nsIMsgNewsFolder.h&quot;</span>
<a href="#l160.18"></a><span id="l160.18"> #include &quot;nsCOMPtr.h&quot;</span>
<a href="#l160.19"></a><span id="l160.19"> #include &quot;nsIMsgFilterService.h&quot;</span>
<a href="#l160.20"></a><span id="l160.20"> #include &quot;nsIArray.h&quot;</span>
<a href="#l160.21"></a><span id="l160.21"> </span>
<a href="#l160.22"></a><span id="l160.22" class="difflineat">@@ -79,19 +79,19 @@ public:</span>
<a href="#l160.23"></a><span id="l160.23">   NS_IMETHOD GetEditableFilterList(nsIMsgWindow *aMsgWindow, nsIMsgFilterList **aFilterList);</span>
<a href="#l160.24"></a><span id="l160.24">   NS_IMETHOD SetFilterList(nsIMsgFilterList *aFilterList);</span>
<a href="#l160.25"></a><span id="l160.25">   NS_IMETHOD SetEditableFilterList(nsIMsgFilterList *aFilterList);</span>
<a href="#l160.26"></a><span id="l160.26">   NS_IMETHOD ApplyRetentionSettings();</span>
<a href="#l160.27"></a><span id="l160.27"> </span>
<a href="#l160.28"></a><span id="l160.28"> protected:</span>
<a href="#l160.29"></a><span id="l160.29">   // helper routine to parse the URI and update member variables</span>
<a href="#l160.30"></a><span id="l160.30">   nsresult AbbreviatePrettyName(nsAString&amp; prettyName, PRInt32 fullwords);</span>
<a href="#l160.31"></a><span id="l160.31" class="difflineminus">-  nsresult ParseFolder(nsILocalFile *path);</span>
<a href="#l160.32"></a><span id="l160.32" class="difflineminus">-  nsresult CreateSubFolders(nsILocalFile *path);</span>
<a href="#l160.33"></a><span id="l160.33" class="difflineminus">-  nsresult AddDirectorySeparator(nsILocalFile *path);</span>
<a href="#l160.34"></a><span id="l160.34" class="difflineplus">+  nsresult ParseFolder(nsIFile *path);</span>
<a href="#l160.35"></a><span id="l160.35" class="difflineplus">+  nsresult CreateSubFolders(nsIFile *path);</span>
<a href="#l160.36"></a><span id="l160.36" class="difflineplus">+  nsresult AddDirectorySeparator(nsIFile *path);</span>
<a href="#l160.37"></a><span id="l160.37">   nsresult GetDatabase();</span>
<a href="#l160.38"></a><span id="l160.38">   virtual nsresult CreateChildFromURI(const nsCString &amp;uri, nsIMsgFolder **folder);</span>
<a href="#l160.39"></a><span id="l160.39"> </span>
<a href="#l160.40"></a><span id="l160.40">   nsresult LoadNewsrcFileAndCreateNewsgroups();</span>
<a href="#l160.41"></a><span id="l160.41">   PRInt32 RememberLine(const nsACString&amp; line);</span>
<a href="#l160.42"></a><span id="l160.42">   nsresult RememberUnsubscribedGroup(const nsACString&amp; newsgroup, const nsACString&amp; setStr);</span>
<a href="#l160.43"></a><span id="l160.43">   nsresult ForgetLine(void);</span>
<a href="#l160.44"></a><span id="l160.44">   nsresult GetNewsMessages(nsIMsgWindow *aMsgWindow, bool getOld, nsIUrlListener *aListener);</span>
<a href="#l160.45"></a><span id="l160.45" class="difflineat">@@ -106,17 +106,17 @@ protected:</span>
<a href="#l160.46"></a><span id="l160.46">   bool mInitialized;</span>
<a href="#l160.47"></a><span id="l160.47">   bool m_downloadMessageForOfflineUse;</span>
<a href="#l160.48"></a><span id="l160.48">   bool m_downloadingMultipleMessages;</span>
<a href="#l160.49"></a><span id="l160.49"> </span>
<a href="#l160.50"></a><span id="l160.50">   nsCString mOptionLines;</span>
<a href="#l160.51"></a><span id="l160.51">   nsCString mUnsubscribedNewsgroupLines;</span>
<a href="#l160.52"></a><span id="l160.52">   nsMsgKeySet *mReadSet;</span>
<a href="#l160.53"></a><span id="l160.53"> </span>
<a href="#l160.54"></a><span id="l160.54" class="difflineminus">-  nsCOMPtr&lt;nsILocalFile&gt; mNewsrcFilePath;</span>
<a href="#l160.55"></a><span id="l160.55" class="difflineplus">+  nsCOMPtr&lt;nsIFile&gt; mNewsrcFilePath;</span>
<a href="#l160.56"></a><span id="l160.56"> </span>
<a href="#l160.57"></a><span id="l160.57">   // used for auth news</span>
<a href="#l160.58"></a><span id="l160.58">   nsCString mGroupUsername;</span>
<a href="#l160.59"></a><span id="l160.59">   nsCString mGroupPassword;</span>
<a href="#l160.60"></a><span id="l160.60"> </span>
<a href="#l160.61"></a><span id="l160.61">   // the name of the newsgroup.</span>
<a href="#l160.62"></a><span id="l160.62">   nsCString mRawName;</span>
<a href="#l160.63"></a><span id="l160.63">   PRInt32 mSortOrder;</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l161.1"></a><span id="l161.1" class="difflineminus">--- a/mailnews/news/src/nsNntpIncomingServer.cpp</span>
<a href="#l161.2"></a><span id="l161.2" class="difflineplus">+++ b/mailnews/news/src/nsNntpIncomingServer.cpp</span>
<a href="#l161.3"></a><span id="l161.3" class="difflineat">@@ -3,17 +3,17 @@</span>
<a href="#l161.4"></a><span id="l161.4">  * License, v. 2.0. If a copy of the MPL was not distributed with this</span>
<a href="#l161.5"></a><span id="l161.5">  * file, You can obtain one at http://mozilla.org/MPL/2.0/. */</span>
<a href="#l161.6"></a><span id="l161.6"> </span>
<a href="#l161.7"></a><span id="l161.7"> #include &quot;nsNntpIncomingServer.h&quot;</span>
<a href="#l161.8"></a><span id="l161.8"> #include &quot;nsIPrefBranch.h&quot;</span>
<a href="#l161.9"></a><span id="l161.9"> #include &quot;nsIPrefService.h&quot;</span>
<a href="#l161.10"></a><span id="l161.10"> #include &quot;nsNewsFolder.h&quot;</span>
<a href="#l161.11"></a><span id="l161.11"> #include &quot;nsIMsgFolder.h&quot;</span>
<a href="#l161.12"></a><span id="l161.12" class="difflineminus">-#include &quot;nsILocalFile.h&quot;</span>
<a href="#l161.13"></a><span id="l161.13" class="difflineplus">+#include &quot;nsIFile.h&quot;</span>
<a href="#l161.14"></a><span id="l161.14"> #include &quot;nsCOMPtr.h&quot;</span>
<a href="#l161.15"></a><span id="l161.15"> #include &quot;nsINntpService.h&quot;</span>
<a href="#l161.16"></a><span id="l161.16"> #include &quot;nsINNTPProtocol.h&quot;</span>
<a href="#l161.17"></a><span id="l161.17"> #include &quot;nsMsgNewsCID.h&quot;</span>
<a href="#l161.18"></a><span id="l161.18"> #include &quot;nsNNTPProtocol.h&quot;</span>
<a href="#l161.19"></a><span id="l161.19"> #include &quot;nsIDirectoryService.h&quot;</span>
<a href="#l161.20"></a><span id="l161.20"> #include &quot;nsMailDirServiceDefs.h&quot;</span>
<a href="#l161.21"></a><span id="l161.21"> #include &quot;nsMsgUtils.h&quot;</span>
<a href="#l161.22"></a><span id="l161.22" class="difflineat">@@ -143,17 +143,17 @@ nsNntpIncomingServer::CreateRootFolderFr</span>
<a href="#l161.23"></a><span id="l161.23">   if (!newRootFolder)</span>
<a href="#l161.24"></a><span id="l161.24">     return NS_ERROR_OUT_OF_MEMORY;</span>
<a href="#l161.25"></a><span id="l161.25">   NS_ADDREF(*rootFolder = newRootFolder);</span>
<a href="#l161.26"></a><span id="l161.26">   newRootFolder-&gt;Init(serverUri.get());</span>
<a href="#l161.27"></a><span id="l161.27">   return NS_OK;</span>
<a href="#l161.28"></a><span id="l161.28"> }</span>
<a href="#l161.29"></a><span id="l161.29"> </span>
<a href="#l161.30"></a><span id="l161.30"> NS_IMETHODIMP</span>
<a href="#l161.31"></a><span id="l161.31" class="difflineminus">-nsNntpIncomingServer::GetNewsrcFilePath(nsILocalFile **aNewsrcFilePath)</span>
<a href="#l161.32"></a><span id="l161.32" class="difflineplus">+nsNntpIncomingServer::GetNewsrcFilePath(nsIFile **aNewsrcFilePath)</span>
<a href="#l161.33"></a><span id="l161.33"> {</span>
<a href="#l161.34"></a><span id="l161.34">   nsresult rv;</span>
<a href="#l161.35"></a><span id="l161.35">   if (mNewsrcFilePath)</span>
<a href="#l161.36"></a><span id="l161.36">   {</span>
<a href="#l161.37"></a><span id="l161.37">     *aNewsrcFilePath = mNewsrcFilePath;</span>
<a href="#l161.38"></a><span id="l161.38">     NS_IF_ADDREF(*aNewsrcFilePath);</span>
<a href="#l161.39"></a><span id="l161.39">     return NS_OK;</span>
<a href="#l161.40"></a><span id="l161.40">   }</span>
<a href="#l161.41"></a><span id="l161.41" class="difflineat">@@ -182,17 +182,17 @@ nsNntpIncomingServer::GetNewsrcFilePath(</span>
<a href="#l161.42"></a><span id="l161.42">   rv = SetNewsrcFilePath(mNewsrcFilePath);</span>
<a href="#l161.43"></a><span id="l161.43">   NS_ENSURE_SUCCESS(rv, rv);</span>
<a href="#l161.44"></a><span id="l161.44"> </span>
<a href="#l161.45"></a><span id="l161.45">   NS_ADDREF(*aNewsrcFilePath = mNewsrcFilePath);</span>
<a href="#l161.46"></a><span id="l161.46">   return NS_OK;</span>
<a href="#l161.47"></a><span id="l161.47"> }</span>
<a href="#l161.48"></a><span id="l161.48"> </span>
<a href="#l161.49"></a><span id="l161.49"> NS_IMETHODIMP</span>
<a href="#l161.50"></a><span id="l161.50" class="difflineminus">-nsNntpIncomingServer::SetNewsrcFilePath(nsILocalFile *aFile)</span>
<a href="#l161.51"></a><span id="l161.51" class="difflineplus">+nsNntpIncomingServer::SetNewsrcFilePath(nsIFile *aFile)</span>
<a href="#l161.52"></a><span id="l161.52"> {</span>
<a href="#l161.53"></a><span id="l161.53">     NS_ENSURE_ARG_POINTER(aFile);</span>
<a href="#l161.54"></a><span id="l161.54"> </span>
<a href="#l161.55"></a><span id="l161.55">     bool exists;</span>
<a href="#l161.56"></a><span id="l161.56">     nsresult rv = aFile-&gt;Exists(&amp;exists);</span>
<a href="#l161.57"></a><span id="l161.57">     if (!exists)</span>
<a href="#l161.58"></a><span id="l161.58">     {</span>
<a href="#l161.59"></a><span id="l161.59">       rv = aFile-&gt;CreateUnique(nsIFile::NORMAL_FILE_TYPE, 0664);</span>
<a href="#l161.60"></a><span id="l161.60" class="difflineat">@@ -204,24 +204,24 @@ nsNntpIncomingServer::SetNewsrcFilePath(</span>
<a href="#l161.61"></a><span id="l161.61"> NS_IMETHODIMP</span>
<a href="#l161.62"></a><span id="l161.62"> nsNntpIncomingServer::GetLocalStoreType(nsACString&amp; type)</span>
<a href="#l161.63"></a><span id="l161.63"> {</span>
<a href="#l161.64"></a><span id="l161.64">   type.AssignLiteral(&quot;news&quot;);</span>
<a href="#l161.65"></a><span id="l161.65">   return NS_OK;</span>
<a href="#l161.66"></a><span id="l161.66"> }</span>
<a href="#l161.67"></a><span id="l161.67"> </span>
<a href="#l161.68"></a><span id="l161.68"> NS_IMETHODIMP</span>
<a href="#l161.69"></a><span id="l161.69" class="difflineminus">-nsNntpIncomingServer::SetNewsrcRootPath(nsILocalFile *aNewsrcRootPath)</span>
<a href="#l161.70"></a><span id="l161.70" class="difflineplus">+nsNntpIncomingServer::SetNewsrcRootPath(nsIFile *aNewsrcRootPath)</span>
<a href="#l161.71"></a><span id="l161.71"> {</span>
<a href="#l161.72"></a><span id="l161.72">     NS_ENSURE_ARG(aNewsrcRootPath);</span>
<a href="#l161.73"></a><span id="l161.73">     return NS_SetPersistentFile(PREF_MAIL_NEWSRC_ROOT_REL, PREF_MAIL_NEWSRC_ROOT, aNewsrcRootPath);</span>
<a href="#l161.74"></a><span id="l161.74"> }</span>
<a href="#l161.75"></a><span id="l161.75"> </span>
<a href="#l161.76"></a><span id="l161.76"> NS_IMETHODIMP</span>
<a href="#l161.77"></a><span id="l161.77" class="difflineminus">-nsNntpIncomingServer::GetNewsrcRootPath(nsILocalFile **aNewsrcRootPath)</span>
<a href="#l161.78"></a><span id="l161.78" class="difflineplus">+nsNntpIncomingServer::GetNewsrcRootPath(nsIFile **aNewsrcRootPath)</span>
<a href="#l161.79"></a><span id="l161.79"> {</span>
<a href="#l161.80"></a><span id="l161.80">     NS_ENSURE_ARG_POINTER(aNewsrcRootPath);</span>
<a href="#l161.81"></a><span id="l161.81">     *aNewsrcRootPath = nsnull;</span>
<a href="#l161.82"></a><span id="l161.82"> </span>
<a href="#l161.83"></a><span id="l161.83">     bool havePref;</span>
<a href="#l161.84"></a><span id="l161.84">     nsresult rv = NS_GetPersistentFile(PREF_MAIL_NEWSRC_ROOT_REL,</span>
<a href="#l161.85"></a><span id="l161.85">                               PREF_MAIL_NEWSRC_ROOT,</span>
<a href="#l161.86"></a><span id="l161.86">                               NS_APP_NEWS_50_DIR,</span>
<a href="#l161.87"></a><span id="l161.87" class="difflineat">@@ -305,17 +305,17 @@ nsNntpIncomingServer::WriteNewsrcFile()</span>
<a href="#l161.88"></a><span id="l161.88">   rv = GetHostName(hostname);</span>
<a href="#l161.89"></a><span id="l161.89">   if (NS_FAILED(rv)) return rv;</span>
<a href="#l161.90"></a><span id="l161.90"> #endif /* DEBUG_NEWS */</span>
<a href="#l161.91"></a><span id="l161.91"> </span>
<a href="#l161.92"></a><span id="l161.92">     if (newsrcHasChanged) {</span>
<a href="#l161.93"></a><span id="l161.93"> #ifdef DEBUG_NEWS</span>
<a href="#l161.94"></a><span id="l161.94">         printf(&quot;write newsrc file for %s\n&quot;, hostname.get());</span>
<a href="#l161.95"></a><span id="l161.95"> #endif</span>
<a href="#l161.96"></a><span id="l161.96" class="difflineminus">-        nsCOMPtr &lt;nsILocalFile&gt; newsrcFile;</span>
<a href="#l161.97"></a><span id="l161.97" class="difflineplus">+        nsCOMPtr &lt;nsIFile&gt; newsrcFile;</span>
<a href="#l161.98"></a><span id="l161.98">         rv = GetNewsrcFilePath(getter_AddRefs(newsrcFile));</span>
<a href="#l161.99"></a><span id="l161.99">         if (NS_FAILED(rv)) return rv;</span>
<a href="#l161.100"></a><span id="l161.100"> </span>
<a href="#l161.101"></a><span id="l161.101">         nsCOMPtr&lt;nsIOutputStream&gt; newsrcStream;</span>
<a href="#l161.102"></a><span id="l161.102">         nsresult rv = MsgNewBufferedFileOutputStream(getter_AddRefs(newsrcStream), newsrcFile, -1, 00600);</span>
<a href="#l161.103"></a><span id="l161.103">         if (NS_FAILED(rv))</span>
<a href="#l161.104"></a><span id="l161.104">           return rv;</span>
<a href="#l161.105"></a><span id="l161.105"> </span>
<a href="#l161.106"></a><span id="l161.106" class="difflineat">@@ -2070,17 +2070,17 @@ nsNntpIncomingServer::OnUserOrHostNameCh</span>
<a href="#l161.107"></a><span id="l161.107"> {</span>
<a href="#l161.108"></a><span id="l161.108">   nsresult rv;</span>
<a href="#l161.109"></a><span id="l161.109">   // 1. Do common things in the base class.</span>
<a href="#l161.110"></a><span id="l161.110">   rv = nsMsgIncomingServer::OnUserOrHostNameChanged(oldName, newName, hostnameChanged);</span>
<a href="#l161.111"></a><span id="l161.111">   NS_ENSURE_SUCCESS(rv,rv);</span>
<a href="#l161.112"></a><span id="l161.112"> </span>
<a href="#l161.113"></a><span id="l161.113">   // 2. Remove file hostinfo.dat so that the new subscribe</span>
<a href="#l161.114"></a><span id="l161.114">   //    list will be reloaded from the new server.</span>
<a href="#l161.115"></a><span id="l161.115" class="difflineminus">-  nsCOMPtr &lt;nsILocalFile&gt; hostInfoFile;</span>
<a href="#l161.116"></a><span id="l161.116" class="difflineplus">+  nsCOMPtr &lt;nsIFile&gt; hostInfoFile;</span>
<a href="#l161.117"></a><span id="l161.117">   rv = GetLocalPath(getter_AddRefs(hostInfoFile));</span>
<a href="#l161.118"></a><span id="l161.118">   NS_ENSURE_SUCCESS(rv, rv);</span>
<a href="#l161.119"></a><span id="l161.119">   rv = hostInfoFile-&gt;AppendNative(NS_LITERAL_CSTRING(HOSTINFO_FILE_NAME));</span>
<a href="#l161.120"></a><span id="l161.120">   NS_ENSURE_SUCCESS(rv, rv);</span>
<a href="#l161.121"></a><span id="l161.121">   hostInfoFile-&gt;Remove(false);</span>
<a href="#l161.122"></a><span id="l161.122"> </span>
<a href="#l161.123"></a><span id="l161.123">   // 3.Unsubscribe and then subscribe the existing groups to clean up the article numbers</span>
<a href="#l161.124"></a><span id="l161.124">   //   in the rc file (this is because the old and new servers may maintain different</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l162.1"></a><span id="l162.1" class="difflineminus">--- a/mailnews/news/src/nsNntpIncomingServer.h</span>
<a href="#l162.2"></a><span id="l162.2" class="difflineplus">+++ b/mailnews/news/src/nsNntpIncomingServer.h</span>
<a href="#l162.3"></a><span id="l162.3" class="difflineat">@@ -14,17 +14,17 @@</span>
<a href="#l162.4"></a><span id="l162.4"> </span>
<a href="#l162.5"></a><span id="l162.5"> #include &quot;prmem.h&quot;</span>
<a href="#l162.6"></a><span id="l162.6"> #include &quot;plstr.h&quot;</span>
<a href="#l162.7"></a><span id="l162.7"> #include &quot;prprf.h&quot;</span>
<a href="#l162.8"></a><span id="l162.8"> </span>
<a href="#l162.9"></a><span id="l162.9"> #include &quot;nsIMsgWindow.h&quot;</span>
<a href="#l162.10"></a><span id="l162.10"> #include &quot;nsISubscribableServer.h&quot;</span>
<a href="#l162.11"></a><span id="l162.11"> #include &quot;nsITimer.h&quot;</span>
<a href="#l162.12"></a><span id="l162.12" class="difflineminus">-#include &quot;nsILocalFile.h&quot;</span>
<a href="#l162.13"></a><span id="l162.13" class="difflineplus">+#include &quot;nsIFile.h&quot;</span>
<a href="#l162.14"></a><span id="l162.14"> #include &quot;nsITreeView.h&quot;</span>
<a href="#l162.15"></a><span id="l162.15"> #include &quot;nsITreeSelection.h&quot;</span>
<a href="#l162.16"></a><span id="l162.16"> #include &quot;nsIAtom.h&quot;</span>
<a href="#l162.17"></a><span id="l162.17"> #include &quot;nsCOMArray.h&quot;</span>
<a href="#l162.18"></a><span id="l162.18"> </span>
<a href="#l162.19"></a><span id="l162.19"> #include &quot;nsNntpMockChannel.h&quot;</span>
<a href="#l162.20"></a><span id="l162.20"> #include &quot;nsAutoPtr.h&quot;</span>
<a href="#l162.21"></a><span id="l162.21"> </span>
<a href="#l162.22"></a><span id="l162.22" class="difflineat">@@ -115,28 +115,28 @@ private:</span>
<a href="#l162.23"></a><span id="l162.23">     bool     mGetOnlyNew;</span>
<a href="#l162.24"></a><span id="l162.24">     nsresult WriteHostInfoFile();</span>
<a href="#l162.25"></a><span id="l162.25">     nsresult LoadHostInfoFile();</span>
<a href="#l162.26"></a><span id="l162.26">     nsresult AddGroupOnServer(const nsACString &amp;name);</span>
<a href="#l162.27"></a><span id="l162.27"> </span>
<a href="#l162.28"></a><span id="l162.28">     bool mNewsrcHasChanged;</span>
<a href="#l162.29"></a><span id="l162.29">     bool mHostInfoLoaded;</span>
<a href="#l162.30"></a><span id="l162.30">     bool mHostInfoHasChanged;</span>
<a href="#l162.31"></a><span id="l162.31" class="difflineminus">-    nsCOMPtr &lt;nsILocalFile&gt; mHostInfoFile;</span>
<a href="#l162.32"></a><span id="l162.32" class="difflineplus">+    nsCOMPtr &lt;nsIFile&gt; mHostInfoFile;</span>
<a href="#l162.33"></a><span id="l162.33">     </span>
<a href="#l162.34"></a><span id="l162.34">     PRUint32 mLastGroupDate;</span>
<a href="#l162.35"></a><span id="l162.35">     PRTime mFirstNewDate;</span>
<a href="#l162.36"></a><span id="l162.36">     PRInt32 mUniqueId;    </span>
<a href="#l162.37"></a><span id="l162.37">     PRUint32 mLastUpdatedTime;</span>
<a href="#l162.38"></a><span id="l162.38">     PRInt32 mVersion;</span>
<a href="#l162.39"></a><span id="l162.39">     bool mPostingAllowed;</span>
<a href="#l162.40"></a><span id="l162.40"> </span>
<a href="#l162.41"></a><span id="l162.41">     nsCOMPtr&lt;nsITimer&gt; mNewsrcSaveTimer;</span>
<a href="#l162.42"></a><span id="l162.42">     nsCOMPtr &lt;nsIMsgWindow&gt; mMsgWindow;</span>
<a href="#l162.43"></a><span id="l162.43"> </span>
<a href="#l162.44"></a><span id="l162.44">     nsCOMPtr &lt;nsISubscribableServer&gt; mInner;</span>
<a href="#l162.45"></a><span id="l162.45">     nsresult EnsureInner();</span>
<a href="#l162.46"></a><span id="l162.46">     nsresult ClearInner();</span>
<a href="#l162.47"></a><span id="l162.47">     nsresult IsValidRow(PRInt32 row);</span>
<a href="#l162.48"></a><span id="l162.48" class="difflineminus">-    nsCOMPtr&lt;nsILocalFile&gt; mNewsrcFilePath;</span>
<a href="#l162.49"></a><span id="l162.49" class="difflineplus">+    nsCOMPtr&lt;nsIFile&gt; mNewsrcFilePath;</span>
<a href="#l162.50"></a><span id="l162.50"> };</span>
<a href="#l162.51"></a><span id="l162.51"> </span>
<a href="#l162.52"></a><span id="l162.52"> #endif</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l163.1"></a><span id="l163.1" class="difflineminus">--- a/mailnews/news/src/nsNntpService.cpp</span>
<a href="#l163.2"></a><span id="l163.2" class="difflineplus">+++ b/mailnews/news/src/nsNntpService.cpp</span>
<a href="#l163.3"></a><span id="l163.3" class="difflineat">@@ -1264,30 +1264,30 @@ NS_IMETHODIMP nsNntpService::NewChannel(</span>
<a href="#l163.4"></a><span id="l163.4">   nsresult rv = NS_OK;</span>
<a href="#l163.5"></a><span id="l163.5">   nsCOMPtr&lt;nsINntpIncomingServer&gt; server;</span>
<a href="#l163.6"></a><span id="l163.6">   rv = GetServerForUri(aURI, getter_AddRefs(server));</span>
<a href="#l163.7"></a><span id="l163.7">   NS_ENSURE_SUCCESS(rv, rv);</span>
<a href="#l163.8"></a><span id="l163.8">   return server-&gt;GetNntpChannel(aURI, nsnull, _retval);</span>
<a href="#l163.9"></a><span id="l163.9"> }</span>
<a href="#l163.10"></a><span id="l163.10"> </span>
<a href="#l163.11"></a><span id="l163.11"> NS_IMETHODIMP</span>
<a href="#l163.12"></a><span id="l163.12" class="difflineminus">-nsNntpService::SetDefaultLocalPath(nsILocalFile *aPath)</span>
<a href="#l163.13"></a><span id="l163.13" class="difflineplus">+nsNntpService::SetDefaultLocalPath(nsIFile *aPath)</span>
<a href="#l163.14"></a><span id="l163.14"> {</span>
<a href="#l163.15"></a><span id="l163.15">     NS_ENSURE_ARG(aPath);</span>
<a href="#l163.16"></a><span id="l163.16">     return NS_SetPersistentFile(PREF_MAIL_ROOT_NNTP_REL, PREF_MAIL_ROOT_NNTP, aPath);</span>
<a href="#l163.17"></a><span id="l163.17"> }</span>
<a href="#l163.18"></a><span id="l163.18"> </span>
<a href="#l163.19"></a><span id="l163.19"> NS_IMETHODIMP</span>
<a href="#l163.20"></a><span id="l163.20" class="difflineminus">-nsNntpService::GetDefaultLocalPath(nsILocalFile ** aResult)</span>
<a href="#l163.21"></a><span id="l163.21" class="difflineplus">+nsNntpService::GetDefaultLocalPath(nsIFile ** aResult)</span>
<a href="#l163.22"></a><span id="l163.22"> {</span>
<a href="#l163.23"></a><span id="l163.23">     NS_ENSURE_ARG_POINTER(aResult);</span>
<a href="#l163.24"></a><span id="l163.24">     *aResult = nsnull;</span>
<a href="#l163.25"></a><span id="l163.25"> </span>
<a href="#l163.26"></a><span id="l163.26">     bool havePref;</span>
<a href="#l163.27"></a><span id="l163.27" class="difflineminus">-    nsCOMPtr&lt;nsILocalFile&gt; localFile;</span>
<a href="#l163.28"></a><span id="l163.28" class="difflineplus">+    nsCOMPtr&lt;nsIFile&gt; localFile;</span>
<a href="#l163.29"></a><span id="l163.29">     nsresult rv = NS_GetPersistentFile(PREF_MAIL_ROOT_NNTP_REL,</span>
<a href="#l163.30"></a><span id="l163.30">                               PREF_MAIL_ROOT_NNTP,</span>
<a href="#l163.31"></a><span id="l163.31">                               NS_APP_NEWS_50_DIR,</span>
<a href="#l163.32"></a><span id="l163.32">                               havePref,</span>
<a href="#l163.33"></a><span id="l163.33">                               getter_AddRefs(localFile));</span>
<a href="#l163.34"></a><span id="l163.34">     if (NS_FAILED(rv)) return rv;</span>
<a href="#l163.35"></a><span id="l163.35"> </span>
<a href="#l163.36"></a><span id="l163.36">     bool exists;</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l164.1"></a><span id="l164.1" class="difflineminus">--- a/mailnews/news/src/nsNntpUrl.h</span>
<a href="#l164.2"></a><span id="l164.2" class="difflineplus">+++ b/mailnews/news/src/nsNntpUrl.h</span>
<a href="#l164.3"></a><span id="l164.3" class="difflineat">@@ -41,17 +41,17 @@ private:</span>
<a href="#l164.4"></a><span id="l164.4"> </span>
<a href="#l164.5"></a><span id="l164.5">   nsCOMPtr&lt;nsINNTPNewsgroupPost&gt; m_newsgroupPost;</span>
<a href="#l164.6"></a><span id="l164.6">   nsNewsAction m_newsAction; // the action this url represents...parse mailbox, display messages, etc.</span>
<a href="#l164.7"></a><span id="l164.7"> </span>
<a href="#l164.8"></a><span id="l164.8">   nsCString mURI; // the RDF URI associated with this url.</span>
<a href="#l164.9"></a><span id="l164.9">   nsCString mCharsetOverride; // used by nsIMsgI18NUrl...</span>
<a href="#l164.10"></a><span id="l164.10"> </span>
<a href="#l164.11"></a><span id="l164.11">   nsCString mOriginalSpec;</span>
<a href="#l164.12"></a><span id="l164.12" class="difflineminus">-  nsCOMPtr &lt;nsILocalFile&gt;  m_filePath;</span>
<a href="#l164.13"></a><span id="l164.13" class="difflineplus">+  nsCOMPtr &lt;nsIFile&gt;  m_filePath;</span>
<a href="#l164.14"></a><span id="l164.14"> </span>
<a href="#l164.15"></a><span id="l164.15">   // used by save message to disk</span>
<a href="#l164.16"></a><span id="l164.16">   nsCOMPtr&lt;nsIFile&gt; m_messageFile;</span>
<a href="#l164.17"></a><span id="l164.17"> </span>
<a href="#l164.18"></a><span id="l164.18">   bool          m_addDummyEnvelope;</span>
<a href="#l164.19"></a><span id="l164.19">   bool          m_canonicalLineEnding;</span>
<a href="#l164.20"></a><span id="l164.20">   bool          m_getOldMessages;</span>
<a href="#l164.21"></a><span id="l164.21"> </span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l165.1"></a><span id="l165.1" class="difflineminus">--- a/suite/app/nsSuiteApp.cpp</span>
<a href="#l165.2"></a><span id="l165.2" class="difflineplus">+++ b/suite/app/nsSuiteApp.cpp</span>
<a href="#l165.3"></a><span id="l165.3" class="difflineat">@@ -22,17 +22,17 @@</span>
<a href="#l165.4"></a><span id="l165.4"> #include &lt;stdarg.h&gt;</span>
<a href="#l165.5"></a><span id="l165.5"> #include &lt;string.h&gt;</span>
<a href="#l165.6"></a><span id="l165.6"> </span>
<a href="#l165.7"></a><span id="l165.7"> #include &quot;plstr.h&quot;</span>
<a href="#l165.8"></a><span id="l165.8"> #include &quot;prprf.h&quot;</span>
<a href="#l165.9"></a><span id="l165.9"> #include &quot;prenv.h&quot;</span>
<a href="#l165.10"></a><span id="l165.10"> </span>
<a href="#l165.11"></a><span id="l165.11"> #include &quot;nsCOMPtr.h&quot;</span>
<a href="#l165.12"></a><span id="l165.12" class="difflineminus">-#include &quot;nsILocalFile.h&quot;</span>
<a href="#l165.13"></a><span id="l165.13" class="difflineplus">+#include &quot;nsIFile.h&quot;</span>
<a href="#l165.14"></a><span id="l165.14"> #include &quot;nsStringGlue.h&quot;</span>
<a href="#l165.15"></a><span id="l165.15"> </span>
<a href="#l165.16"></a><span id="l165.16"> #ifdef XP_WIN</span>
<a href="#l165.17"></a><span id="l165.17"> // we want a wmain entry point</span>
<a href="#l165.18"></a><span id="l165.18"> #include &quot;nsWindowsWMain.cpp&quot;</span>
<a href="#l165.19"></a><span id="l165.19"> #define snprintf _snprintf</span>
<a href="#l165.20"></a><span id="l165.20"> #define strcasecmp _stricmp</span>
<a href="#l165.21"></a><span id="l165.21"> #endif</span>
<a href="#l165.22"></a><span id="l165.22" class="difflineat">@@ -106,17 +106,17 @@ static const nsDynamicFunctionLoad kXULF</span>
<a href="#l165.23"></a><span id="l165.23"> #endif</span>
<a href="#l165.24"></a><span id="l165.24">     { &quot;XRE_TelemetryAccumulate&quot;, (NSFuncPtr*) &amp;XRE_TelemetryAccumulate },</span>
<a href="#l165.25"></a><span id="l165.25">     { &quot;XRE_main&quot;, (NSFuncPtr*) &amp;XRE_main },</span>
<a href="#l165.26"></a><span id="l165.26">     { nsnull, nsnull }</span>
<a href="#l165.27"></a><span id="l165.27"> };</span>
<a href="#l165.28"></a><span id="l165.28"> </span>
<a href="#l165.29"></a><span id="l165.29"> static int do_main(const char *exePath, int argc, char* argv[])</span>
<a href="#l165.30"></a><span id="l165.30"> {</span>
<a href="#l165.31"></a><span id="l165.31" class="difflineminus">-  nsCOMPtr&lt;nsILocalFile&gt; appini;</span>
<a href="#l165.32"></a><span id="l165.32" class="difflineplus">+  nsCOMPtr&lt;nsIFile&gt; appini;</span>
<a href="#l165.33"></a><span id="l165.33">   nsresult rv;</span>
<a href="#l165.34"></a><span id="l165.34">   </span>
<a href="#l165.35"></a><span id="l165.35">   // Allow seamonkey.exe to launch XULRunner apps via -app &lt;application.ini&gt;</span>
<a href="#l165.36"></a><span id="l165.36">   // Note that -app must be the *first* argument.</span>
<a href="#l165.37"></a><span id="l165.37">   const char *appDataFile = getenv(&quot;XUL_APP_FILE&quot;);</span>
<a href="#l165.38"></a><span id="l165.38">   if (appDataFile &amp;&amp; *appDataFile) {</span>
<a href="#l165.39"></a><span id="l165.39">     rv = XRE_GetFileFromPath(appDataFile, getter_AddRefs(appini));</span>
<a href="#l165.40"></a><span id="l165.40">     if (NS_FAILED(rv)) {</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l166.1"></a><span id="l166.1" class="difflineminus">--- a/suite/profile/migration/src/nsNetscapeProfileMigratorBase.cpp</span>
<a href="#l166.2"></a><span id="l166.2" class="difflineplus">+++ b/suite/profile/migration/src/nsNetscapeProfileMigratorBase.cpp</span>
<a href="#l166.3"></a><span id="l166.3" class="difflineat">@@ -236,17 +236,17 @@ nsNetscapeProfileMigratorBase::SetFile(P</span>
<a href="#l166.4"></a><span id="l166.4">     nsCString fileURL(aTransform-&gt;stringValue);</span>
<a href="#l166.5"></a><span id="l166.5">     nsCOMPtr&lt;nsIFile&gt; aFile;</span>
<a href="#l166.6"></a><span id="l166.6">     // Start off by assuming fileURL is a URL spec and</span>
<a href="#l166.7"></a><span id="l166.7">     // try and get a File from it.</span>
<a href="#l166.8"></a><span id="l166.8">     rv = NS_GetFileFromURLSpec(fileURL, getter_AddRefs(aFile));</span>
<a href="#l166.9"></a><span id="l166.9">     if (NS_FAILED(rv)) {</span>
<a href="#l166.10"></a><span id="l166.10">       // Okay it wasn't a URL spec so assume it is a localfile,</span>
<a href="#l166.11"></a><span id="l166.11">       // if this fails then just don't set anything.</span>
<a href="#l166.12"></a><span id="l166.12" class="difflineminus">-      nsCOMPtr&lt;nsILocalFile&gt; localFile;</span>
<a href="#l166.13"></a><span id="l166.13" class="difflineplus">+      nsCOMPtr&lt;nsIFile&gt; localFile;</span>
<a href="#l166.14"></a><span id="l166.14">       rv = NS_NewNativeLocalFile(fileURL, false, getter_AddRefs(localFile));</span>
<a href="#l166.15"></a><span id="l166.15">       if (NS_FAILED(rv))</span>
<a href="#l166.16"></a><span id="l166.16">         return NS_OK;  </span>
<a href="#l166.17"></a><span id="l166.17">       aFile = localFile;</span>
<a href="#l166.18"></a><span id="l166.18">     }</span>
<a href="#l166.19"></a><span id="l166.19">     // Now test to see if File exists and is an actual file.</span>
<a href="#l166.20"></a><span id="l166.20">     bool exists = false;</span>
<a href="#l166.21"></a><span id="l166.21">     rv = aFile-&gt;Exists(&amp;exists);</span>
<a href="#l166.22"></a><span id="l166.22" class="difflineat">@@ -309,26 +309,23 @@ nsNetscapeProfileMigratorBase::GetSource</span>
<a href="#l166.23"></a><span id="l166.23">       break;</span>
<a href="#l166.24"></a><span id="l166.24">     }</span>
<a href="#l166.25"></a><span id="l166.25">   }</span>
<a href="#l166.26"></a><span id="l166.26"> </span>
<a href="#l166.27"></a><span id="l166.27">   return NS_OK;</span>
<a href="#l166.28"></a><span id="l166.28"> }</span>
<a href="#l166.29"></a><span id="l166.29"> </span>
<a href="#l166.30"></a><span id="l166.30"> nsresult</span>
<a href="#l166.31"></a><span id="l166.31" class="difflineminus">-nsNetscapeProfileMigratorBase::GetProfileDataFromProfilesIni(nsILocalFile* aDataDir,</span>
<a href="#l166.32"></a><span id="l166.32" class="difflineplus">+nsNetscapeProfileMigratorBase::GetProfileDataFromProfilesIni(nsIFile* aDataDir,</span>
<a href="#l166.33"></a><span id="l166.33">                                                              nsIMutableArray* aProfileNames,</span>
<a href="#l166.34"></a><span id="l166.34">                                                              nsIMutableArray* aProfileLocations)</span>
<a href="#l166.35"></a><span id="l166.35"> {</span>
<a href="#l166.36"></a><span id="l166.36">   nsresult rv;</span>
<a href="#l166.37"></a><span id="l166.37" class="difflineminus">-  nsCOMPtr&lt;nsIFile&gt; dataDir;</span>
<a href="#l166.38"></a><span id="l166.38" class="difflineminus">-  rv = aDataDir-&gt;Clone(getter_AddRefs(dataDir));</span>
<a href="#l166.39"></a><span id="l166.39" class="difflineminus">-  NS_ENSURE_SUCCESS(rv, rv);</span>
<a href="#l166.40"></a><span id="l166.40" class="difflineminus">-</span>
<a href="#l166.41"></a><span id="l166.41" class="difflineminus">-  nsCOMPtr&lt;nsILocalFile&gt; profileIni(do_QueryInterface(dataDir, &amp;rv));</span>
<a href="#l166.42"></a><span id="l166.42" class="difflineplus">+  nsCOMPtr&lt;nsIFile&gt; profileIni;</span>
<a href="#l166.43"></a><span id="l166.43" class="difflineplus">+  rv = aDataDir-&gt;Clone(getter_AddRefs(profileIni));</span>
<a href="#l166.44"></a><span id="l166.44">   NS_ENSURE_SUCCESS(rv, rv);</span>
<a href="#l166.45"></a><span id="l166.45"> </span>
<a href="#l166.46"></a><span id="l166.46">   profileIni-&gt;Append(NS_LITERAL_STRING(&quot;profiles.ini&quot;));</span>
<a href="#l166.47"></a><span id="l166.47"> </span>
<a href="#l166.48"></a><span id="l166.48">   // Does it exist?</span>
<a href="#l166.49"></a><span id="l166.49">   bool profileFileExists = false;</span>
<a href="#l166.50"></a><span id="l166.50">   rv = profileIni-&gt;Exists(&amp;profileFileExists);</span>
<a href="#l166.51"></a><span id="l166.51">   NS_ENSURE_SUCCESS(rv, rv);</span>
<a href="#l166.52"></a><span id="l166.52" class="difflineat">@@ -361,17 +358,17 @@ nsNetscapeProfileMigratorBase::GetProfil</span>
<a href="#l166.53"></a><span id="l166.53">     }</span>
<a href="#l166.54"></a><span id="l166.54"> </span>
<a href="#l166.55"></a><span id="l166.55">     rv = parser.GetString(profileID.get(), &quot;Name&quot;, buffer);</span>
<a href="#l166.56"></a><span id="l166.56">     if (NS_FAILED(rv)) {</span>
<a href="#l166.57"></a><span id="l166.57">       NS_ERROR(&quot;Malformed profiles.ini: Name= not found&quot;);</span>
<a href="#l166.58"></a><span id="l166.58">       continue;</span>
<a href="#l166.59"></a><span id="l166.59">     }</span>
<a href="#l166.60"></a><span id="l166.60"> </span>
<a href="#l166.61"></a><span id="l166.61" class="difflineminus">-    nsCOMPtr&lt;nsILocalFile&gt; rootDir;</span>
<a href="#l166.62"></a><span id="l166.62" class="difflineplus">+    nsCOMPtr&lt;nsIFile&gt; rootDir;</span>
<a href="#l166.63"></a><span id="l166.63">     rv = NS_NewNativeLocalFile(EmptyCString(), true, getter_AddRefs(rootDir));</span>
<a href="#l166.64"></a><span id="l166.64">     NS_ENSURE_SUCCESS(rv, rv);</span>
<a href="#l166.65"></a><span id="l166.65"> </span>
<a href="#l166.66"></a><span id="l166.66">     if (isRelative)</span>
<a href="#l166.67"></a><span id="l166.67">       rv = rootDir-&gt;SetRelativeDescriptor(aDataDir, filePath);</span>
<a href="#l166.68"></a><span id="l166.68">     else</span>
<a href="#l166.69"></a><span id="l166.69">       rv = rootDir-&gt;SetPersistentDescriptor(filePath);</span>
<a href="#l166.70"></a><span id="l166.70"> </span>
<a href="#l166.71"></a><span id="l166.71" class="difflineat">@@ -458,20 +455,19 @@ nsNetscapeProfileMigratorBase::Recursive</span>
<a href="#l166.72"></a><span id="l166.72">   nsCOMPtr&lt;nsIFile&gt; dirEntry;</span>
<a href="#l166.73"></a><span id="l166.73">   </span>
<a href="#l166.74"></a><span id="l166.74">   while (hasMore) {</span>
<a href="#l166.75"></a><span id="l166.75">     rv = dirIterator-&gt;GetNext((nsISupports**)getter_AddRefs(dirEntry));</span>
<a href="#l166.76"></a><span id="l166.76">     if (NS_SUCCEEDED(rv)) {</span>
<a href="#l166.77"></a><span id="l166.77">       rv = dirEntry-&gt;IsDirectory(&amp;isDir);</span>
<a href="#l166.78"></a><span id="l166.78">       if (NS_SUCCEEDED(rv)) {</span>
<a href="#l166.79"></a><span id="l166.79">         if (isDir) {</span>
<a href="#l166.80"></a><span id="l166.80" class="difflineminus">-          nsCOMPtr&lt;nsIFile&gt; destClone;</span>
<a href="#l166.81"></a><span id="l166.81" class="difflineminus">-          rv = destDir-&gt;Clone(getter_AddRefs(destClone));</span>
<a href="#l166.82"></a><span id="l166.82" class="difflineplus">+          nsCOMPtr&lt;nsIFile&gt; newChild;</span>
<a href="#l166.83"></a><span id="l166.83" class="difflineplus">+          rv = destDir-&gt;Clone(getter_AddRefs(newChild));</span>
<a href="#l166.84"></a><span id="l166.84">           if (NS_SUCCEEDED(rv)) {</span>
<a href="#l166.85"></a><span id="l166.85" class="difflineminus">-            nsCOMPtr&lt;nsILocalFile&gt; newChild(do_QueryInterface(destClone));</span>
<a href="#l166.86"></a><span id="l166.86">             nsAutoString leafName;</span>
<a href="#l166.87"></a><span id="l166.87">             dirEntry-&gt;GetLeafName(leafName);</span>
<a href="#l166.88"></a><span id="l166.88"> </span>
<a href="#l166.89"></a><span id="l166.89">             newChild-&gt;AppendRelativePath(leafName);</span>
<a href="#l166.90"></a><span id="l166.90">             rv = newChild-&gt;Exists(&amp;exists);</span>
<a href="#l166.91"></a><span id="l166.91">             if (NS_SUCCEEDED(rv) &amp;&amp; !exists)</span>
<a href="#l166.92"></a><span id="l166.92">               rv = newChild-&gt;Create(nsIFile::DIRECTORY_TYPE, 0775);</span>
<a href="#l166.93"></a><span id="l166.93"> </span>
<a href="#l166.94"></a><span id="l166.94" class="difflineat">@@ -584,36 +580,36 @@ nsNetscapeProfileMigratorBase::WriteBran</span>
<a href="#l166.95"></a><span id="l166.95">     pref-&gt;prefName = nsnull;</span>
<a href="#l166.96"></a><span id="l166.96">     delete pref;</span>
<a href="#l166.97"></a><span id="l166.97">     pref = nsnull;</span>
<a href="#l166.98"></a><span id="l166.98">   }</span>
<a href="#l166.99"></a><span id="l166.99">   aPrefs.Clear();</span>
<a href="#l166.100"></a><span id="l166.100"> }</span>
<a href="#l166.101"></a><span id="l166.101"> </span>
<a href="#l166.102"></a><span id="l166.102"> nsresult</span>
<a href="#l166.103"></a><span id="l166.103" class="difflineminus">-nsNetscapeProfileMigratorBase::GetFileValue(nsIPrefBranch* aPrefBranch, const char* aRelPrefName, const char* aPrefName, nsILocalFile** aReturnFile)</span>
<a href="#l166.104"></a><span id="l166.104" class="difflineplus">+nsNetscapeProfileMigratorBase::GetFileValue(nsIPrefBranch* aPrefBranch, const char* aRelPrefName, const char* aPrefName, nsIFile** aReturnFile)</span>
<a href="#l166.105"></a><span id="l166.105"> {</span>
<a href="#l166.106"></a><span id="l166.106">   nsCString prefValue;</span>
<a href="#l166.107"></a><span id="l166.107" class="difflineminus">-  nsCOMPtr&lt;nsILocalFile&gt; theFile;</span>
<a href="#l166.108"></a><span id="l166.108" class="difflineplus">+  nsCOMPtr&lt;nsIFile&gt; theFile;</span>
<a href="#l166.109"></a><span id="l166.109">   nsresult rv = aPrefBranch-&gt;GetCharPref(aRelPrefName, getter_Copies(prefValue));</span>
<a href="#l166.110"></a><span id="l166.110">   if (NS_SUCCEEDED(rv)) {</span>
<a href="#l166.111"></a><span id="l166.111">     // The pref has the format: [ProfD]a/b/c</span>
<a href="#l166.112"></a><span id="l166.112">     if (!StringBeginsWith(prefValue, NS_LITERAL_CSTRING(&quot;[ProfD]&quot;)))</span>
<a href="#l166.113"></a><span id="l166.113">       return NS_ERROR_FILE_NOT_FOUND;</span>
<a href="#l166.114"></a><span id="l166.114"> </span>
<a href="#l166.115"></a><span id="l166.115">     rv = NS_NewNativeLocalFile(EmptyCString(), true, getter_AddRefs(theFile));</span>
<a href="#l166.116"></a><span id="l166.116">     if (NS_FAILED(rv))</span>
<a href="#l166.117"></a><span id="l166.117">       return rv;</span>
<a href="#l166.118"></a><span id="l166.118"> </span>
<a href="#l166.119"></a><span id="l166.119">     rv = theFile-&gt;SetRelativeDescriptor(mSourceProfile, Substring(prefValue, 7));</span>
<a href="#l166.120"></a><span id="l166.120">     if (NS_FAILED(rv))</span>
<a href="#l166.121"></a><span id="l166.121">       return rv;</span>
<a href="#l166.122"></a><span id="l166.122">   } else {</span>
<a href="#l166.123"></a><span id="l166.123">     rv = aPrefBranch-&gt;GetComplexValue(aPrefName,</span>
<a href="#l166.124"></a><span id="l166.124" class="difflineminus">-                                      NS_GET_IID(nsILocalFile),</span>
<a href="#l166.125"></a><span id="l166.125" class="difflineplus">+                                      NS_GET_IID(nsIFile),</span>
<a href="#l166.126"></a><span id="l166.126">                                       getter_AddRefs(theFile));</span>
<a href="#l166.127"></a><span id="l166.127">   }</span>
<a href="#l166.128"></a><span id="l166.128"> </span>
<a href="#l166.129"></a><span id="l166.129">   theFile.forget(aReturnFile);</span>
<a href="#l166.130"></a><span id="l166.130">   return rv;</span>
<a href="#l166.131"></a><span id="l166.131"> }</span>
<a href="#l166.132"></a><span id="l166.132"> </span>
<a href="#l166.133"></a><span id="l166.133"> ///////////////////////////////////////////////////////////////////////////////</span>
<a href="#l166.134"></a><span id="l166.134" class="difflineat">@@ -842,18 +838,18 @@ nsNetscapeProfileMigratorBase::CopySigna</span>
<a href="#l166.135"></a><span id="l166.135"> </span>
<a href="#l166.136"></a><span id="l166.136">     // a partial fix for bug #255043</span>
<a href="#l166.137"></a><span id="l166.137">     // if the user's signature file from seamonkey lives in the</span>
<a href="#l166.138"></a><span id="l166.138">     // old profile root, we'll copy it over to the new profile root and</span>
<a href="#l166.139"></a><span id="l166.139">     // then set the pref to the new value. Note, this doesn't work for</span>
<a href="#l166.140"></a><span id="l166.140">     // multiple signatures that live below the seamonkey profile root</span>
<a href="#l166.141"></a><span id="l166.141">     if (StringEndsWith(prefName, NS_LITERAL_CSTRING(&quot;.sig_file&quot;)))</span>
<a href="#l166.142"></a><span id="l166.142">     {</span>
<a href="#l166.143"></a><span id="l166.143" class="difflineminus">-      // turn the pref into a nsILocalFile</span>
<a href="#l166.144"></a><span id="l166.144" class="difflineminus">-      nsCOMPtr&lt;nsILocalFile&gt; srcSigFile =</span>
<a href="#l166.145"></a><span id="l166.145" class="difflineplus">+      // turn the pref into a nsIFile</span>
<a href="#l166.146"></a><span id="l166.146" class="difflineplus">+      nsCOMPtr&lt;nsIFile&gt; srcSigFile =</span>
<a href="#l166.147"></a><span id="l166.147">         do_CreateInstance(NS_LOCAL_FILE_CONTRACTID);</span>
<a href="#l166.148"></a><span id="l166.148">       srcSigFile-&gt;SetPersistentDescriptor(nsDependentCString(pref-&gt;stringValue));</span>
<a href="#l166.149"></a><span id="l166.149"> </span>
<a href="#l166.150"></a><span id="l166.150">       nsCOMPtr&lt;nsIFile&gt; targetSigFile;</span>
<a href="#l166.151"></a><span id="l166.151">       rv = mTargetProfile-&gt;Clone(getter_AddRefs(targetSigFile));</span>
<a href="#l166.152"></a><span id="l166.152">       NS_ENSURE_SUCCESS(rv, rv);</span>
<a href="#l166.153"></a><span id="l166.153"> </span>
<a href="#l166.154"></a><span id="l166.154">       // now make the copy</span>
<a href="#l166.155"></a><span id="l166.155" class="difflineat">@@ -864,18 +860,17 @@ nsNetscapeProfileMigratorBase::CopySigna</span>
<a href="#l166.156"></a><span id="l166.156">         nsAutoString leafName;</span>
<a href="#l166.157"></a><span id="l166.157">         srcSigFile-&gt;GetLeafName(leafName);</span>
<a href="#l166.158"></a><span id="l166.158">         // will fail if we've already copied a sig file here</span>
<a href="#l166.159"></a><span id="l166.159">         srcSigFile-&gt;CopyTo(targetSigFile, leafName);</span>
<a href="#l166.160"></a><span id="l166.160">         targetSigFile-&gt;Append(leafName);</span>
<a href="#l166.161"></a><span id="l166.161"> </span>
<a href="#l166.162"></a><span id="l166.162">         // now write out the new descriptor</span>
<a href="#l166.163"></a><span id="l166.163">         nsCAutoString descriptorString;</span>
<a href="#l166.164"></a><span id="l166.164" class="difflineminus">-        nsCOMPtr&lt;nsILocalFile&gt; localFile = do_QueryInterface(targetSigFile);</span>
<a href="#l166.165"></a><span id="l166.165" class="difflineminus">-        localFile-&gt;GetPersistentDescriptor(descriptorString);</span>
<a href="#l166.166"></a><span id="l166.166" class="difflineplus">+        targetSigFile-&gt;GetPersistentDescriptor(descriptorString);</span>
<a href="#l166.167"></a><span id="l166.167">         NS_Free(pref-&gt;stringValue);</span>
<a href="#l166.168"></a><span id="l166.168">         pref-&gt;stringValue = ToNewCString(descriptorString);</span>
<a href="#l166.169"></a><span id="l166.169">       }</span>
<a href="#l166.170"></a><span id="l166.170">     }</span>
<a href="#l166.171"></a><span id="l166.171">   }</span>
<a href="#l166.172"></a><span id="l166.172">   return NS_OK;</span>
<a href="#l166.173"></a><span id="l166.173"> }</span>
<a href="#l166.174"></a><span id="l166.174"> </span>
<a href="#l166.175"></a><span id="l166.175" class="difflineat">@@ -912,17 +907,17 @@ nsNetscapeProfileMigratorBase::CopyMailF</span>
<a href="#l166.176"></a><span id="l166.176">       aPrefService-&gt;GetBranch(prefName.get(), getter_AddRefs(serverBranch));</span>
<a href="#l166.177"></a><span id="l166.177"> </span>
<a href="#l166.178"></a><span id="l166.178">       if (!serverBranch)</span>
<a href="#l166.179"></a><span id="l166.179">         break; // should we clear out this server pref from aMailServers?</span>
<a href="#l166.180"></a><span id="l166.180"> </span>
<a href="#l166.181"></a><span id="l166.181">       nsCString serverType;</span>
<a href="#l166.182"></a><span id="l166.182">       serverBranch-&gt;GetCharPref(&quot;type&quot;, getter_Copies(serverType));</span>
<a href="#l166.183"></a><span id="l166.183"> </span>
<a href="#l166.184"></a><span id="l166.184" class="difflineminus">-      nsCOMPtr&lt;nsILocalFile&gt; sourceMailFolder;</span>
<a href="#l166.185"></a><span id="l166.185" class="difflineplus">+      nsCOMPtr&lt;nsIFile&gt; sourceMailFolder;</span>
<a href="#l166.186"></a><span id="l166.186">       nsresult rv = GetFileValue(serverBranch, &quot;directory-rel&quot;, &quot;directory&quot;,</span>
<a href="#l166.187"></a><span id="l166.187">                                  getter_AddRefs(sourceMailFolder));</span>
<a href="#l166.188"></a><span id="l166.188">       NS_ENSURE_SUCCESS(rv, rv);</span>
<a href="#l166.189"></a><span id="l166.189"> </span>
<a href="#l166.190"></a><span id="l166.190">       // now based on type, we need to build a new destination path for the</span>
<a href="#l166.191"></a><span id="l166.191">       // mail folders for this server</span>
<a href="#l166.192"></a><span id="l166.192">       nsCOMPtr&lt;nsIFile&gt; targetMailFolder;</span>
<a href="#l166.193"></a><span id="l166.193">       if (serverType.Equals(&quot;imap&quot;)) {</span>
<a href="#l166.194"></a><span id="l166.194" class="difflineat">@@ -952,50 +947,48 @@ nsNetscapeProfileMigratorBase::CopyMailF</span>
<a href="#l166.195"></a><span id="l166.195">         // case where the user has multiple servers with the same host name.</span>
<a href="#l166.196"></a><span id="l166.196">         targetMailFolder-&gt;CreateUnique(nsIFile::DIRECTORY_TYPE, 0777);</span>
<a href="#l166.197"></a><span id="l166.197"> </span>
<a href="#l166.198"></a><span id="l166.198">         RecursiveCopy(sourceMailFolder, targetMailFolder);</span>
<a href="#l166.199"></a><span id="l166.199">         // now we want to make sure the actual directory pref that gets</span>
<a href="#l166.200"></a><span id="l166.200">         // transformed into the new profile's pref.js has the right file</span>
<a href="#l166.201"></a><span id="l166.201">         // location.</span>
<a href="#l166.202"></a><span id="l166.202">         nsCAutoString descriptorString;</span>
<a href="#l166.203"></a><span id="l166.203" class="difflineminus">-        nsCOMPtr&lt;nsILocalFile&gt; localFile = do_QueryInterface(targetMailFolder);</span>
<a href="#l166.204"></a><span id="l166.204" class="difflineminus">-        localFile-&gt;GetPersistentDescriptor(descriptorString);</span>
<a href="#l166.205"></a><span id="l166.205" class="difflineplus">+        targetMailFolder-&gt;GetPersistentDescriptor(descriptorString);</span>
<a href="#l166.206"></a><span id="l166.206">         NS_Free(pref-&gt;stringValue);</span>
<a href="#l166.207"></a><span id="l166.207">         pref-&gt;stringValue = ToNewCString(descriptorString);</span>
<a href="#l166.208"></a><span id="l166.208">       }</span>
<a href="#l166.209"></a><span id="l166.209">     }</span>
<a href="#l166.210"></a><span id="l166.210">     else if (StringEndsWith(prefName, NS_LITERAL_CSTRING(&quot;.newsrc.file&quot;))) {</span>
<a href="#l166.211"></a><span id="l166.211">       // copy the news RC file into \News. this won't work if the user has</span>
<a href="#l166.212"></a><span id="l166.212">       // different newsrc files for each account I don't know what to do in</span>
<a href="#l166.213"></a><span id="l166.213">       // that situation.</span>
<a href="#l166.214"></a><span id="l166.214">       nsCOMPtr&lt;nsIFile&gt; targetNewsRCFile;</span>
<a href="#l166.215"></a><span id="l166.215">       mTargetProfile-&gt;Clone(getter_AddRefs(targetNewsRCFile));</span>
<a href="#l166.216"></a><span id="l166.216">       targetNewsRCFile-&gt;Append(NEWS_DIR_50_NAME);</span>
<a href="#l166.217"></a><span id="l166.217"> </span>
<a href="#l166.218"></a><span id="l166.218" class="difflineminus">-      // turn the pref into a nsILocalFile</span>
<a href="#l166.219"></a><span id="l166.219" class="difflineminus">-      nsCOMPtr&lt;nsILocalFile&gt; srcNewsRCFile =</span>
<a href="#l166.220"></a><span id="l166.220" class="difflineplus">+      // turn the pref into a nsIFile</span>
<a href="#l166.221"></a><span id="l166.221" class="difflineplus">+      nsCOMPtr&lt;nsIFile&gt; srcNewsRCFile =</span>
<a href="#l166.222"></a><span id="l166.222">         do_CreateInstance(NS_LOCAL_FILE_CONTRACTID);</span>
<a href="#l166.223"></a><span id="l166.223">       srcNewsRCFile-&gt;SetPersistentDescriptor(</span>
<a href="#l166.224"></a><span id="l166.224">         nsDependentCString(pref-&gt;stringValue));</span>
<a href="#l166.225"></a><span id="l166.225"> </span>
<a href="#l166.226"></a><span id="l166.226">       // now make the copy</span>
<a href="#l166.227"></a><span id="l166.227">       bool exists;</span>
<a href="#l166.228"></a><span id="l166.228">       srcNewsRCFile-&gt;Exists(&amp;exists);</span>
<a href="#l166.229"></a><span id="l166.229">       if (exists) {</span>
<a href="#l166.230"></a><span id="l166.230">         nsAutoString leafName;</span>
<a href="#l166.231"></a><span id="l166.231">         srcNewsRCFile-&gt;GetLeafName(leafName);</span>
<a href="#l166.232"></a><span id="l166.232">         // will fail if we've already copied a newsrc file here</span>
<a href="#l166.233"></a><span id="l166.233">         srcNewsRCFile-&gt;CopyTo(targetNewsRCFile,leafName);</span>
<a href="#l166.234"></a><span id="l166.234">         targetNewsRCFile-&gt;Append(leafName);</span>
<a href="#l166.235"></a><span id="l166.235"> </span>
<a href="#l166.236"></a><span id="l166.236">         // now write out the new descriptor</span>
<a href="#l166.237"></a><span id="l166.237">         nsCAutoString descriptorString;</span>
<a href="#l166.238"></a><span id="l166.238" class="difflineminus">-        nsCOMPtr&lt;nsILocalFile&gt; localFile = do_QueryInterface(targetNewsRCFile);</span>
<a href="#l166.239"></a><span id="l166.239" class="difflineminus">-        localFile-&gt;GetPersistentDescriptor(descriptorString);</span>
<a href="#l166.240"></a><span id="l166.240" class="difflineplus">+        targetNewsRCFile-&gt;GetPersistentDescriptor(descriptorString);</span>
<a href="#l166.241"></a><span id="l166.241">         NS_Free(pref-&gt;stringValue);</span>
<a href="#l166.242"></a><span id="l166.242">         pref-&gt;stringValue = ToNewCString(descriptorString);</span>
<a href="#l166.243"></a><span id="l166.243">       }</span>
<a href="#l166.244"></a><span id="l166.244">     }</span>
<a href="#l166.245"></a><span id="l166.245">   }</span>
<a href="#l166.246"></a><span id="l166.246"> </span>
<a href="#l166.247"></a><span id="l166.247">   // Remove all .directory-rel prefs as those might have changed; MailNews</span>
<a href="#l166.248"></a><span id="l166.248">   // will create those prefs again on first use</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l167.1"></a><span id="l167.1" class="difflineminus">--- a/suite/profile/migration/src/nsNetscapeProfileMigratorBase.h</span>
<a href="#l167.2"></a><span id="l167.2" class="difflineplus">+++ b/suite/profile/migration/src/nsNetscapeProfileMigratorBase.h</span>
<a href="#l167.3"></a><span id="l167.3" class="difflineat">@@ -1,17 +1,17 @@</span>
<a href="#l167.4"></a><span id="l167.4"> /* -*- Mode: C++; tab-width: 2; indent-tabs-mode: nil; c-basic-offset: 2 -*- */</span>
<a href="#l167.5"></a><span id="l167.5"> /* This Source Code Form is subject to the terms of the Mozilla Public</span>
<a href="#l167.6"></a><span id="l167.6">  * License, v. 2.0. If a copy of the MPL was not distributed with this</span>
<a href="#l167.7"></a><span id="l167.7">  * file, You can obtain one at http://mozilla.org/MPL/2.0/. */</span>
<a href="#l167.8"></a><span id="l167.8"> </span>
<a href="#l167.9"></a><span id="l167.9"> #ifndef netscapeprofilemigratorbase___h___</span>
<a href="#l167.10"></a><span id="l167.10"> #define netscapeprofilemigratorbase___h___</span>
<a href="#l167.11"></a><span id="l167.11"> </span>
<a href="#l167.12"></a><span id="l167.12" class="difflineminus">-#include &quot;nsILocalFile.h&quot;</span>
<a href="#l167.13"></a><span id="l167.13" class="difflineplus">+#include &quot;nsIFile.h&quot;</span>
<a href="#l167.14"></a><span id="l167.14"> #include &quot;nsIMutableArray.h&quot;</span>
<a href="#l167.15"></a><span id="l167.15"> #include &quot;nsStringAPI.h&quot;</span>
<a href="#l167.16"></a><span id="l167.16"> #include &quot;nsTArray.h&quot;</span>
<a href="#l167.17"></a><span id="l167.17"> #include &quot;nsITimer.h&quot;</span>
<a href="#l167.18"></a><span id="l167.18"> #include &quot;nsIObserverService.h&quot;</span>
<a href="#l167.19"></a><span id="l167.19"> #include &quot;nsISuiteProfileMigrator.h&quot;</span>
<a href="#l167.20"></a><span id="l167.20"> </span>
<a href="#l167.21"></a><span id="l167.21"> class nsIPrefBranch;</span>
<a href="#l167.22"></a><span id="l167.22" class="difflineat">@@ -99,21 +99,21 @@ public:</span>
<a href="#l167.23"></a><span id="l167.23"> </span>
<a href="#l167.24"></a><span id="l167.24"> protected:</span>
<a href="#l167.25"></a><span id="l167.25">   // This function is designed to be overriden by derived classes so that</span>
<a href="#l167.26"></a><span id="l167.26">   // the required profile data for the specific application can be obtained.</span>
<a href="#l167.27"></a><span id="l167.27">   virtual nsresult FillProfileDataFromRegistry() = 0;</span>
<a href="#l167.28"></a><span id="l167.28"> </span>
<a href="#l167.29"></a><span id="l167.29">   // General Utility Methods</span>
<a href="#l167.30"></a><span id="l167.30">   nsresult GetSourceProfile(const PRUnichar* aProfile);</span>
<a href="#l167.31"></a><span id="l167.31" class="difflineminus">-  nsresult GetProfileDataFromProfilesIni(nsILocalFile* aDataDir,</span>
<a href="#l167.32"></a><span id="l167.32" class="difflineplus">+  nsresult GetProfileDataFromProfilesIni(nsIFile* aDataDir,</span>
<a href="#l167.33"></a><span id="l167.33">                                          nsIMutableArray* aProfileNames,</span>
<a href="#l167.34"></a><span id="l167.34">                                          nsIMutableArray* aProfileLocations);</span>
<a href="#l167.35"></a><span id="l167.35">   nsresult GetFileValue(nsIPrefBranch* aPrefBranch, const char* aRelPrefName,</span>
<a href="#l167.36"></a><span id="l167.36" class="difflineminus">-                        const char* aPrefName, nsILocalFile** aReturnFile);</span>
<a href="#l167.37"></a><span id="l167.37" class="difflineplus">+                        const char* aPrefName, nsIFile** aReturnFile);</span>
<a href="#l167.38"></a><span id="l167.38">   nsresult CopyFile(const char* aSourceFileName,</span>
<a href="#l167.39"></a><span id="l167.39">                     const char* aTargetFileName);</span>
<a href="#l167.40"></a><span id="l167.40">   nsresult RecursiveCopy(nsIFile* srcDir, nsIFile* destDir);</span>
<a href="#l167.41"></a><span id="l167.41">   void ReadBranch(const char * branchName, nsIPrefService* aPrefService,</span>
<a href="#l167.42"></a><span id="l167.42">                   PBStructArray &amp;aPrefs);</span>
<a href="#l167.43"></a><span id="l167.43">   void WriteBranch(const char * branchName, nsIPrefService* aPrefService,</span>
<a href="#l167.44"></a><span id="l167.44">                    PBStructArray &amp;aPrefs);</span>
<a href="#l167.45"></a><span id="l167.45"> </span>
<a href="#l167.46"></a><span id="l167.46" class="difflineat">@@ -139,17 +139,17 @@ protected:</span>
<a href="#l167.47"></a><span id="l167.47">   nsresult CopyJunkTraining(bool aReplace);</span>
<a href="#l167.48"></a><span id="l167.48">   nsresult CopyMailFolderPrefs(PBStructArray &amp;aMailServers,</span>
<a href="#l167.49"></a><span id="l167.49">                                nsIPrefService* aPrefService);</span>
<a href="#l167.50"></a><span id="l167.50">   void CopyMailFolders();</span>
<a href="#l167.51"></a><span id="l167.51">   void CopyNextFolder();</span>
<a href="#l167.52"></a><span id="l167.52">   void EndCopyFolders();</span>
<a href="#l167.53"></a><span id="l167.53"> </span>
<a href="#l167.54"></a><span id="l167.54">   // Source &amp; Target profiles</span>
<a href="#l167.55"></a><span id="l167.55" class="difflineminus">-  nsCOMPtr&lt;nsILocalFile&gt; mSourceProfile;</span>
<a href="#l167.56"></a><span id="l167.56" class="difflineplus">+  nsCOMPtr&lt;nsIFile&gt; mSourceProfile;</span>
<a href="#l167.57"></a><span id="l167.57">   nsCOMPtr&lt;nsIFile&gt; mTargetProfile;</span>
<a href="#l167.58"></a><span id="l167.58"> </span>
<a href="#l167.59"></a><span id="l167.59">   // list of src/destination files we still have to copy into the new profile</span>
<a href="#l167.60"></a><span id="l167.60">   // directory</span>
<a href="#l167.61"></a><span id="l167.61">   nsTArray&lt;fileTransactionEntry&gt; mFileCopyTransactions;</span>
<a href="#l167.62"></a><span id="l167.62">   PRUint32 mFileCopyTransactionIndex;</span>
<a href="#l167.63"></a><span id="l167.63"> </span>
<a href="#l167.64"></a><span id="l167.64">   nsCOMPtr&lt;nsIObserverService&gt; mObserverService;</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l168.1"></a><span id="l168.1" class="difflineminus">--- a/suite/profile/migration/src/nsProfileMigrator.cpp</span>
<a href="#l168.2"></a><span id="l168.2" class="difflineplus">+++ b/suite/profile/migration/src/nsProfileMigrator.cpp</span>
<a href="#l168.3"></a><span id="l168.3" class="difflineat">@@ -1,17 +1,17 @@</span>
<a href="#l168.4"></a><span id="l168.4"> /* -*- Mode: C++; tab-width: 2; indent-tabs-mode: nil; c-basic-offset: 2 -*- */</span>
<a href="#l168.5"></a><span id="l168.5"> /* This Source Code Form is subject to the terms of the Mozilla Public</span>
<a href="#l168.6"></a><span id="l168.6">  * License, v. 2.0. If a copy of the MPL was not distributed with this</span>
<a href="#l168.7"></a><span id="l168.7">  * file, You can obtain one at http://mozilla.org/MPL/2.0/. */</span>
<a href="#l168.8"></a><span id="l168.8"> </span>
<a href="#l168.9"></a><span id="l168.9"> #include &quot;nsProfileMigrator.h&quot;</span>
<a href="#l168.10"></a><span id="l168.10"> </span>
<a href="#l168.11"></a><span id="l168.11"> #include &quot;nsIDOMWindow.h&quot;</span>
<a href="#l168.12"></a><span id="l168.12" class="difflineminus">-#include &quot;nsILocalFile.h&quot;</span>
<a href="#l168.13"></a><span id="l168.13" class="difflineplus">+#include &quot;nsIFile.h&quot;</span>
<a href="#l168.14"></a><span id="l168.14"> #include &quot;nsISupportsPrimitives.h&quot;</span>
<a href="#l168.15"></a><span id="l168.15"> #include &quot;nsISupportsArray.h&quot;</span>
<a href="#l168.16"></a><span id="l168.16"> #include &quot;nsIToolkitProfile.h&quot;</span>
<a href="#l168.17"></a><span id="l168.17"> #include &quot;nsIToolkitProfileService.h&quot;</span>
<a href="#l168.18"></a><span id="l168.18"> #include &quot;nsIWindowWatcher.h&quot;</span>
<a href="#l168.19"></a><span id="l168.19"> #include &quot;nsDirectoryServiceDefs.h&quot;</span>
<a href="#l168.20"></a><span id="l168.20"> #include &quot;nsComponentManagerUtils.h&quot;</span>
<a href="#l168.21"></a><span id="l168.21"> #include &quot;nsServiceManagerUtils.h&quot;</span>
<a href="#l168.22"></a><span id="l168.22" class="difflineat">@@ -165,17 +165,17 @@ nsProfileMigrator::GetSuiteMigratorKey(n</span>
<a href="#l168.23"></a><span id="l168.23">     //     &lt;TranslationID&gt;</span>
<a href="#l168.24"></a><span id="l168.24">     //       InternalName           &quot;iexplore&quot;</span>
<a href="#l168.25"></a><span id="l168.25">     //   VarFileInfo</span>
<a href="#l168.26"></a><span id="l168.26">     //     Translation              &lt;TranslationID&gt;</span>
<a href="#l168.27"></a><span id="l168.27">     //</span>
<a href="#l168.28"></a><span id="l168.28">     // By Querying the VERSIONINFO section for its Tranlations, we can find out</span>
<a href="#l168.29"></a><span id="l168.29">     // where the InternalName lives. (A file can have more than one translation</span>
<a href="#l168.30"></a><span id="l168.30">     // of its VERSIONINFO segment, but we just assume the first one).</span>
<a href="#l168.31"></a><span id="l168.31" class="difflineminus">-    nsCOMPtr&lt;nsILocalFile&gt; lf;</span>
<a href="#l168.32"></a><span id="l168.32" class="difflineplus">+    nsCOMPtr&lt;nsIFile&gt; lf;</span>
<a href="#l168.33"></a><span id="l168.33">     NS_NewLocalFile(filePath, true, getter_AddRefs(lf));</span>
<a href="#l168.34"></a><span id="l168.34">     if (!lf)</span>
<a href="#l168.35"></a><span id="l168.35">       return NS_ERROR_FAILURE;</span>
<a href="#l168.36"></a><span id="l168.36"> </span>
<a href="#l168.37"></a><span id="l168.37">     nsCOMPtr&lt;nsILocalFileWin&gt; lfw = do_QueryInterface(lf);</span>
<a href="#l168.38"></a><span id="l168.38">     if (!lfw)</span>
<a href="#l168.39"></a><span id="l168.39">       return NS_ERROR_FAILURE;</span>
<a href="#l168.40"></a><span id="l168.40"> </span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l169.1"></a><span id="l169.1" class="difflineminus">--- a/suite/profile/migration/src/nsSuiteProfileMigratorUtils.h</span>
<a href="#l169.2"></a><span id="l169.2" class="difflineplus">+++ b/suite/profile/migration/src/nsSuiteProfileMigratorUtils.h</span>
<a href="#l169.3"></a><span id="l169.3" class="difflineat">@@ -45,17 +45,17 @@ void SetProxyPref(const nsAString&amp; aHost</span>
<a href="#l169.4"></a><span id="l169.4">                   const char* aPortPref, nsIPrefBranch* aPrefs);</span>
<a href="#l169.5"></a><span id="l169.5"> </span>
<a href="#l169.6"></a><span id="l169.6"> struct MigrationData {</span>
<a href="#l169.7"></a><span id="l169.7">   const char* fileName;</span>
<a href="#l169.8"></a><span id="l169.8">   PRUint32 sourceFlag;</span>
<a href="#l169.9"></a><span id="l169.9">   bool replaceOnly;</span>
<a href="#l169.10"></a><span id="l169.10"> };</span>
<a href="#l169.11"></a><span id="l169.11"> </span>
<a href="#l169.12"></a><span id="l169.12" class="difflineminus">-class nsILocalFile;</span>
<a href="#l169.13"></a><span id="l169.13" class="difflineplus">+class nsIFile;</span>
<a href="#l169.14"></a><span id="l169.14"> void GetMigrateDataFromArray(MigrationData* aDataArray,</span>
<a href="#l169.15"></a><span id="l169.15">                              PRInt32 aDataArrayLength,</span>
<a href="#l169.16"></a><span id="l169.16">                              bool aReplace,</span>
<a href="#l169.17"></a><span id="l169.17">                              nsIFile* aSourceProfile,</span>
<a href="#l169.18"></a><span id="l169.18">                              PRUint16* aResult);</span>
<a href="#l169.19"></a><span id="l169.19"> </span>
<a href="#l169.20"></a><span id="l169.20"> </span>
<a href="#l169.21"></a><span id="l169.21"> // get the base directory of the *target* profile</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l170.1"></a><span id="l170.1" class="difflineminus">--- a/suite/profile/migration/src/nsThunderbirdProfileMigrator.cpp</span>
<a href="#l170.2"></a><span id="l170.2" class="difflineplus">+++ b/suite/profile/migration/src/nsThunderbirdProfileMigrator.cpp</span>
<a href="#l170.3"></a><span id="l170.3" class="difflineat">@@ -194,43 +194,43 @@ nsThunderbirdProfileMigrator::GetSupport</span>
<a href="#l170.4"></a><span id="l170.4"> // nsThunderbirdProfileMigrator</span>
<a href="#l170.5"></a><span id="l170.5"> </span>
<a href="#l170.6"></a><span id="l170.6"> nsresult</span>
<a href="#l170.7"></a><span id="l170.7"> nsThunderbirdProfileMigrator::FillProfileDataFromRegistry()</span>
<a href="#l170.8"></a><span id="l170.8"> {</span>
<a href="#l170.9"></a><span id="l170.9">   // Find the Thunderbird Registry</span>
<a href="#l170.10"></a><span id="l170.10">   nsCOMPtr&lt;nsIProperties&gt; fileLocator(</span>
<a href="#l170.11"></a><span id="l170.11">     do_GetService(&quot;@mozilla.org/file/directory_service;1&quot;));</span>
<a href="#l170.12"></a><span id="l170.12" class="difflineminus">-  nsCOMPtr&lt;nsILocalFile&gt; thunderbirdData;</span>
<a href="#l170.13"></a><span id="l170.13" class="difflineplus">+  nsCOMPtr&lt;nsIFile&gt; thunderbirdData;</span>
<a href="#l170.14"></a><span id="l170.14"> #ifdef XP_WIN</span>
<a href="#l170.15"></a><span id="l170.15" class="difflineminus">-  fileLocator-&gt;Get(NS_WIN_APPDATA_DIR, NS_GET_IID(nsILocalFile),</span>
<a href="#l170.16"></a><span id="l170.16" class="difflineplus">+  fileLocator-&gt;Get(NS_WIN_APPDATA_DIR, NS_GET_IID(nsIFile),</span>
<a href="#l170.17"></a><span id="l170.17">                    getter_AddRefs(thunderbirdData));</span>
<a href="#l170.18"></a><span id="l170.18"> </span>
<a href="#l170.19"></a><span id="l170.19">   thunderbirdData-&gt;Append(NS_LITERAL_STRING(&quot;Thunderbird&quot;));</span>
<a href="#l170.20"></a><span id="l170.20"> </span>
<a href="#l170.21"></a><span id="l170.21"> #elif defined(XP_MACOSX)</span>
<a href="#l170.22"></a><span id="l170.22" class="difflineminus">-  fileLocator-&gt;Get(NS_MAC_USER_LIB_DIR, NS_GET_IID(nsILocalFile),</span>
<a href="#l170.23"></a><span id="l170.23" class="difflineplus">+  fileLocator-&gt;Get(NS_MAC_USER_LIB_DIR, NS_GET_IID(nsIFile),</span>
<a href="#l170.24"></a><span id="l170.24">                    getter_AddRefs(thunderbirdData));</span>
<a href="#l170.25"></a><span id="l170.25">   </span>
<a href="#l170.26"></a><span id="l170.26">   thunderbirdData-&gt;Append(NS_LITERAL_STRING(&quot;Thunderbird&quot;));</span>
<a href="#l170.27"></a><span id="l170.27"> </span>
<a href="#l170.28"></a><span id="l170.28"> #elif defined(XP_UNIX)</span>
<a href="#l170.29"></a><span id="l170.29" class="difflineminus">-  fileLocator-&gt;Get(NS_UNIX_HOME_DIR, NS_GET_IID(nsILocalFile),</span>
<a href="#l170.30"></a><span id="l170.30" class="difflineplus">+  fileLocator-&gt;Get(NS_UNIX_HOME_DIR, NS_GET_IID(nsIFile),</span>
<a href="#l170.31"></a><span id="l170.31">                    getter_AddRefs(thunderbirdData));</span>
<a href="#l170.32"></a><span id="l170.32">   </span>
<a href="#l170.33"></a><span id="l170.33">   thunderbirdData-&gt;Append(NS_LITERAL_STRING(&quot;.thunderbird&quot;));</span>
<a href="#l170.34"></a><span id="l170.34"> </span>
<a href="#l170.35"></a><span id="l170.35"> #elif defined(XP_BEOS)</span>
<a href="#l170.36"></a><span id="l170.36" class="difflineminus">-   fileLocator-&gt;Get(NS_BEOS_SETTINGS_DIR, NS_GET_IID(nsILocalFile),</span>
<a href="#l170.37"></a><span id="l170.37" class="difflineplus">+   fileLocator-&gt;Get(NS_BEOS_SETTINGS_DIR, NS_GET_IID(nsIFile),</span>
<a href="#l170.38"></a><span id="l170.38">                     getter_AddRefs(thunderbirdData));</span>
<a href="#l170.39"></a><span id="l170.39"> </span>
<a href="#l170.40"></a><span id="l170.40">    thunderbirdData-&gt;Append(NS_LITERAL_STRING(&quot;Thunderbird&quot;));</span>
<a href="#l170.41"></a><span id="l170.41"> </span>
<a href="#l170.42"></a><span id="l170.42"> #elif defined(XP_OS2)</span>
<a href="#l170.43"></a><span id="l170.43" class="difflineminus">-  fileLocator-&gt;Get(NS_OS2_HOME_DIR, NS_GET_IID(nsILocalFile),</span>
<a href="#l170.44"></a><span id="l170.44" class="difflineplus">+  fileLocator-&gt;Get(NS_OS2_HOME_DIR, NS_GET_IID(nsIFile),</span>
<a href="#l170.45"></a><span id="l170.45">                    getter_AddRefs(thunderbirdData));</span>
<a href="#l170.46"></a><span id="l170.46">   </span>
<a href="#l170.47"></a><span id="l170.47">   thunderbirdData-&gt;Append(NS_LITERAL_STRING(&quot;Thunderbird&quot;));</span>
<a href="#l170.48"></a><span id="l170.48"> #else</span>
<a href="#l170.49"></a><span id="l170.49">   // On other OS just abort</span>
<a href="#l170.50"></a><span id="l170.50">   return NS_ERROR_FILE_NOT_FOUND;</span>
<a href="#l170.51"></a><span id="l170.51"> #endif</span>
<a href="#l170.52"></a><span id="l170.52"> </span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l171.1"></a><span id="l171.1" class="difflineminus">--- a/suite/profile/migration/src/nsThunderbirdProfileMigrator.h</span>
<a href="#l171.2"></a><span id="l171.2" class="difflineplus">+++ b/suite/profile/migration/src/nsThunderbirdProfileMigrator.h</span>
<a href="#l171.3"></a><span id="l171.3" class="difflineat">@@ -2,17 +2,17 @@</span>
<a href="#l171.4"></a><span id="l171.4"> /* This Source Code Form is subject to the terms of the Mozilla Public</span>
<a href="#l171.5"></a><span id="l171.5">  * License, v. 2.0. If a copy of the MPL was not distributed with this</span>
<a href="#l171.6"></a><span id="l171.6">  * file, You can obtain one at http://mozilla.org/MPL/2.0/. */</span>
<a href="#l171.7"></a><span id="l171.7"> </span>
<a href="#l171.8"></a><span id="l171.8"> #ifndef ThunderbirdProfileMigrator_h__</span>
<a href="#l171.9"></a><span id="l171.9"> #define ThunderbirdProfileMigrator_h__</span>
<a href="#l171.10"></a><span id="l171.10"> </span>
<a href="#l171.11"></a><span id="l171.11"> #include &quot;nsISuiteProfileMigrator.h&quot;</span>
<a href="#l171.12"></a><span id="l171.12" class="difflineminus">-#include &quot;nsILocalFile.h&quot;</span>
<a href="#l171.13"></a><span id="l171.13" class="difflineplus">+#include &quot;nsIFile.h&quot;</span>
<a href="#l171.14"></a><span id="l171.14"> #include &quot;nsIObserverService.h&quot;</span>
<a href="#l171.15"></a><span id="l171.15"> #include &quot;nsISupportsArray.h&quot;</span>
<a href="#l171.16"></a><span id="l171.16"> #include &quot;nsNetscapeProfileMigratorBase.h&quot;</span>
<a href="#l171.17"></a><span id="l171.17"> #include &quot;nsStringAPI.h&quot;</span>
<a href="#l171.18"></a><span id="l171.18"> #include &quot;nsITimer.h&quot;</span>
<a href="#l171.19"></a><span id="l171.19"> </span>
<a href="#l171.20"></a><span id="l171.20"> class nsIFile;</span>
<a href="#l171.21"></a><span id="l171.21"> class nsIPrefBranch;</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l172.1"></a><span id="l172.1" class="difflineminus">--- a/suite/shell/public/nsIShellService.idl</span>
<a href="#l172.2"></a><span id="l172.2" class="difflineplus">+++ b/suite/shell/public/nsIShellService.idl</span>
<a href="#l172.3"></a><span id="l172.3" class="difflineat">@@ -2,17 +2,17 @@</span>
<a href="#l172.4"></a><span id="l172.4"> /* This Source Code Form is subject to the terms of the Mozilla Public</span>
<a href="#l172.5"></a><span id="l172.5">  * License, v. 2.0. If a copy of the MPL was not distributed with this</span>
<a href="#l172.6"></a><span id="l172.6">  * file, You can obtain one at http://mozilla.org/MPL/2.0/. */</span>
<a href="#l172.7"></a><span id="l172.7"> </span>
<a href="#l172.8"></a><span id="l172.8"> </span>
<a href="#l172.9"></a><span id="l172.9"> #include &quot;nsISupports.idl&quot;</span>
<a href="#l172.10"></a><span id="l172.10"> </span>
<a href="#l172.11"></a><span id="l172.11"> interface nsIDOMElement;</span>
<a href="#l172.12"></a><span id="l172.12" class="difflineminus">-interface nsILocalFile;</span>
<a href="#l172.13"></a><span id="l172.13" class="difflineplus">+interface nsIFile;</span>
<a href="#l172.14"></a><span id="l172.14"> </span>
<a href="#l172.15"></a><span id="l172.15"> [scriptable, uuid(BEBB8B6A-8AF4-4CF2-85AC-022F7C6A87A9)]</span>
<a href="#l172.16"></a><span id="l172.16"> interface nsIShellService : nsISupports</span>
<a href="#l172.17"></a><span id="l172.17"> {</span>
<a href="#l172.18"></a><span id="l172.18">   /**</span>
<a href="#l172.19"></a><span id="l172.19">    * app types we can be registered to handle</span>
<a href="#l172.20"></a><span id="l172.20">    */</span>
<a href="#l172.21"></a><span id="l172.21">   const unsigned short BROWSER = 0x0001;</span>
<a href="#l172.22"></a><span id="l172.22" class="difflineat">@@ -91,16 +91,16 @@ interface nsIShellService : nsISupports</span>
<a href="#l172.23"></a><span id="l172.23"> </span>
<a href="#l172.24"></a><span id="l172.24">   /**</span>
<a href="#l172.25"></a><span id="l172.25">    * Opens an application with a specific URI to load.</span>
<a href="#l172.26"></a><span id="l172.26">    * @param   application</span>
<a href="#l172.27"></a><span id="l172.27">    *          The application file (or bundle directory, on OS X)</span>
<a href="#l172.28"></a><span id="l172.28">    * @param   uri</span>
<a href="#l172.29"></a><span id="l172.29">    *          The uri to be loaded by the application</span>
<a href="#l172.30"></a><span id="l172.30">    */</span>
<a href="#l172.31"></a><span id="l172.31" class="difflineminus">-  void openApplicationWithURI(in nsILocalFile aApplication, in ACString aURI);</span>
<a href="#l172.32"></a><span id="l172.32" class="difflineplus">+  void openApplicationWithURI(in nsIFile aApplication, in ACString aURI);</span>
<a href="#l172.33"></a><span id="l172.33"> </span>
<a href="#l172.34"></a><span id="l172.34">   /**</span>
<a href="#l172.35"></a><span id="l172.35">    * The default system handler for web feeds</span>
<a href="#l172.36"></a><span id="l172.36">    */</span>
<a href="#l172.37"></a><span id="l172.37" class="difflineminus">-  readonly attribute nsILocalFile defaultFeedReader;</span>
<a href="#l172.38"></a><span id="l172.38" class="difflineplus">+  readonly attribute nsIFile defaultFeedReader;</span>
<a href="#l172.39"></a><span id="l172.39"> };</span>
<a href="#l172.40"></a><span id="l172.40"> </span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l173.1"></a><span id="l173.1" class="difflineminus">--- a/suite/shell/src/nsGNOMEShellService.cpp</span>
<a href="#l173.2"></a><span id="l173.2" class="difflineplus">+++ b/suite/shell/src/nsGNOMEShellService.cpp</span>
<a href="#l173.3"></a><span id="l173.3" class="difflineat">@@ -6,17 +6,17 @@</span>
<a href="#l173.4"></a><span id="l173.4"> #include &quot;nsCOMPtr.h&quot;</span>
<a href="#l173.5"></a><span id="l173.5"> #include &quot;nsComponentManagerUtils.h&quot;</span>
<a href="#l173.6"></a><span id="l173.6"> #include &quot;nsDirectoryServiceDefs.h&quot;</span>
<a href="#l173.7"></a><span id="l173.7"> #include &quot;nsDirectoryServiceUtils.h&quot;</span>
<a href="#l173.8"></a><span id="l173.8"> #include &quot;nsGNOMEShellService.h&quot;</span>
<a href="#l173.9"></a><span id="l173.9"> #include &quot;nsServiceManagerUtils.h&quot;</span>
<a href="#l173.10"></a><span id="l173.10"> #include &quot;nsIGConfService.h&quot;</span>
<a href="#l173.11"></a><span id="l173.11"> #include &quot;nsIGnomeVFSService.h&quot;</span>
<a href="#l173.12"></a><span id="l173.12" class="difflineminus">-#include &quot;nsILocalFile.h&quot;</span>
<a href="#l173.13"></a><span id="l173.13" class="difflineplus">+#include &quot;nsIFile.h&quot;</span>
<a href="#l173.14"></a><span id="l173.14"> #include &quot;nsIProcess.h&quot;</span>
<a href="#l173.15"></a><span id="l173.15"> #include &quot;prenv.h&quot;</span>
<a href="#l173.16"></a><span id="l173.16"> </span>
<a href="#l173.17"></a><span id="l173.17"> NS_IMPL_ISUPPORTS1(nsGNOMEShellService, nsIShellService)</span>
<a href="#l173.18"></a><span id="l173.18"> </span>
<a href="#l173.19"></a><span id="l173.19"> nsresult</span>
<a href="#l173.20"></a><span id="l173.20"> nsGNOMEShellService::Init()</span>
<a href="#l173.21"></a><span id="l173.21"> {</span>
<a href="#l173.22"></a><span id="l173.22" class="difflineat">@@ -90,17 +90,17 @@ nsGNOMEShellService::GetDesktopBackgroun</span>
<a href="#l173.23"></a><span id="l173.23"> </span>
<a href="#l173.24"></a><span id="l173.24"> NS_IMETHODIMP</span>
<a href="#l173.25"></a><span id="l173.25"> nsGNOMEShellService::SetDesktopBackgroundColor(PRUint32 aColor)</span>
<a href="#l173.26"></a><span id="l173.26"> {</span>
<a href="#l173.27"></a><span id="l173.27">   return NS_ERROR_NOT_IMPLEMENTED;</span>
<a href="#l173.28"></a><span id="l173.28"> }</span>
<a href="#l173.29"></a><span id="l173.29"> </span>
<a href="#l173.30"></a><span id="l173.30"> NS_IMETHODIMP</span>
<a href="#l173.31"></a><span id="l173.31" class="difflineminus">-nsGNOMEShellService::OpenApplicationWithURI(nsILocalFile* aApplication, const nsACString&amp; aURI)</span>
<a href="#l173.32"></a><span id="l173.32" class="difflineplus">+nsGNOMEShellService::OpenApplicationWithURI(nsIFile* aApplication, const nsACString&amp; aURI)</span>
<a href="#l173.33"></a><span id="l173.33"> {</span>
<a href="#l173.34"></a><span id="l173.34">   nsresult rv;</span>
<a href="#l173.35"></a><span id="l173.35">   nsCOMPtr&lt;nsIProcess&gt; process = </span>
<a href="#l173.36"></a><span id="l173.36">     do_CreateInstance(&quot;@mozilla.org/process/util;1&quot;, &amp;rv);</span>
<a href="#l173.37"></a><span id="l173.37">   if (NS_FAILED(rv))</span>
<a href="#l173.38"></a><span id="l173.38">     return rv;</span>
<a href="#l173.39"></a><span id="l173.39">   </span>
<a href="#l173.40"></a><span id="l173.40">   rv = process-&gt;Init(aApplication);</span>
<a href="#l173.41"></a><span id="l173.41" class="difflineat">@@ -108,12 +108,12 @@ nsGNOMEShellService::OpenApplicationWith</span>
<a href="#l173.42"></a><span id="l173.42">     return rv;</span>
<a href="#l173.43"></a><span id="l173.43"> </span>
<a href="#l173.44"></a><span id="l173.44">   const nsCString&amp; spec = PromiseFlatCString(aURI);</span>
<a href="#l173.45"></a><span id="l173.45">   const char* specStr = spec.get();</span>
<a href="#l173.46"></a><span id="l173.46">   return process-&gt;Run(false, &amp;specStr, 1);</span>
<a href="#l173.47"></a><span id="l173.47"> }</span>
<a href="#l173.48"></a><span id="l173.48"> </span>
<a href="#l173.49"></a><span id="l173.49"> NS_IMETHODIMP</span>
<a href="#l173.50"></a><span id="l173.50" class="difflineminus">-nsGNOMEShellService::GetDefaultFeedReader(nsILocalFile** _retval)</span>
<a href="#l173.51"></a><span id="l173.51" class="difflineplus">+nsGNOMEShellService::GetDefaultFeedReader(nsIFile** _retval)</span>
<a href="#l173.52"></a><span id="l173.52"> {</span>
<a href="#l173.53"></a><span id="l173.53">   return NS_ERROR_NOT_IMPLEMENTED;</span>
<a href="#l173.54"></a><span id="l173.54"> }</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l174.1"></a><span id="l174.1" class="difflineminus">--- a/suite/shell/src/nsMacShellService.cpp</span>
<a href="#l174.2"></a><span id="l174.2" class="difflineplus">+++ b/suite/shell/src/nsMacShellService.cpp</span>
<a href="#l174.3"></a><span id="l174.3" class="difflineat">@@ -76,17 +76,17 @@ nsMacShellService::SetDesktopBackgroundC</span>
<a href="#l174.4"></a><span id="l174.4"> {</span>
<a href="#l174.5"></a><span id="l174.5">   // This method and |GetDesktopBackgroundColor| has no meaning on Mac OS X.</span>
<a href="#l174.6"></a><span id="l174.6">   // The mac desktop preferences UI uses pictures for the few solid colors it</span>
<a href="#l174.7"></a><span id="l174.7">   // supports.</span>
<a href="#l174.8"></a><span id="l174.8">   return NS_ERROR_NOT_IMPLEMENTED;</span>
<a href="#l174.9"></a><span id="l174.9"> }</span>
<a href="#l174.10"></a><span id="l174.10"> </span>
<a href="#l174.11"></a><span id="l174.11"> NS_IMETHODIMP</span>
<a href="#l174.12"></a><span id="l174.12" class="difflineminus">-nsMacShellService::OpenApplicationWithURI(nsILocalFile* aApplication, const nsACString&amp; aURI)</span>
<a href="#l174.13"></a><span id="l174.13" class="difflineplus">+nsMacShellService::OpenApplicationWithURI(nsIFile* aApplication, const nsACString&amp; aURI)</span>
<a href="#l174.14"></a><span id="l174.14"> {</span>
<a href="#l174.15"></a><span id="l174.15">   nsCOMPtr&lt;nsILocalFileMac&gt; lfm(do_QueryInterface(aApplication));</span>
<a href="#l174.16"></a><span id="l174.16">   CFURLRef appURL;</span>
<a href="#l174.17"></a><span id="l174.17">   nsresult rv = lfm-&gt;GetCFURL(&amp;appURL);</span>
<a href="#l174.18"></a><span id="l174.18">   if (NS_FAILED(rv))</span>
<a href="#l174.19"></a><span id="l174.19">     return rv;</span>
<a href="#l174.20"></a><span id="l174.20">   </span>
<a href="#l174.21"></a><span id="l174.21">   const nsCString&amp; spec = PromiseFlatCString(aURI);</span>
<a href="#l174.22"></a><span id="l174.22" class="difflineat">@@ -113,17 +113,17 @@ nsMacShellService::OpenApplicationWithUR</span>
<a href="#l174.23"></a><span id="l174.23">   </span>
<a href="#l174.24"></a><span id="l174.24">   ::CFRelease(uris);</span>
<a href="#l174.25"></a><span id="l174.25">   ::CFRelease(uri);</span>
<a href="#l174.26"></a><span id="l174.26">   </span>
<a href="#l174.27"></a><span id="l174.27">   return err != noErr ? NS_ERROR_FAILURE : NS_OK;</span>
<a href="#l174.28"></a><span id="l174.28"> }</span>
<a href="#l174.29"></a><span id="l174.29"> </span>
<a href="#l174.30"></a><span id="l174.30"> NS_IMETHODIMP</span>
<a href="#l174.31"></a><span id="l174.31" class="difflineminus">-nsMacShellService::GetDefaultFeedReader(nsILocalFile** _retval)</span>
<a href="#l174.32"></a><span id="l174.32" class="difflineplus">+nsMacShellService::GetDefaultFeedReader(nsIFile** _retval)</span>
<a href="#l174.33"></a><span id="l174.33"> {</span>
<a href="#l174.34"></a><span id="l174.34">   nsresult rv = NS_ERROR_FAILURE;</span>
<a href="#l174.35"></a><span id="l174.35">   *_retval = nsnull;</span>
<a href="#l174.36"></a><span id="l174.36"> </span>
<a href="#l174.37"></a><span id="l174.37">   CFStringRef defaultHandlerID = ::LSCopyDefaultHandlerForURLScheme(CFSTR(&quot;feed&quot;));</span>
<a href="#l174.38"></a><span id="l174.38">   if (!defaultHandlerID) {</span>
<a href="#l174.39"></a><span id="l174.39">     defaultHandlerID = ::CFStringCreateWithCString(kCFAllocatorDefault,</span>
<a href="#l174.40"></a><span id="l174.40">                                                    SAFARI_BUNDLE_IDENTIFIER,</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l175.1"></a><span id="l175.1" class="difflineminus">--- a/suite/shell/src/nsWindowsShellService.cpp</span>
<a href="#l175.2"></a><span id="l175.2" class="difflineplus">+++ b/suite/shell/src/nsWindowsShellService.cpp</span>
<a href="#l175.3"></a><span id="l175.3" class="difflineat">@@ -7,17 +7,17 @@</span>
<a href="#l175.4"></a><span id="l175.4"> #include &quot;imgIRequest.h&quot;</span>
<a href="#l175.5"></a><span id="l175.5"> #include &quot;nsIDOMHTMLImageElement.h&quot;</span>
<a href="#l175.6"></a><span id="l175.6"> #include &quot;nsIImageLoadingContent.h&quot;</span>
<a href="#l175.7"></a><span id="l175.7"> #include &quot;nsIPrefService.h&quot;</span>
<a href="#l175.8"></a><span id="l175.8"> #include &quot;nsIPrefLocalizedString.h&quot;</span>
<a href="#l175.9"></a><span id="l175.9"> #include &quot;nsWindowsShellService.h&quot;</span>
<a href="#l175.10"></a><span id="l175.10"> #include &quot;nsIProcess.h&quot;</span>
<a href="#l175.11"></a><span id="l175.11"> #include &quot;windows.h&quot;</span>
<a href="#l175.12"></a><span id="l175.12" class="difflineminus">-#include &quot;nsILocalFile.h&quot;</span>
<a href="#l175.13"></a><span id="l175.13" class="difflineplus">+#include &quot;nsIFile.h&quot;</span>
<a href="#l175.14"></a><span id="l175.14"> #include &quot;nsNetUtil.h&quot;</span>
<a href="#l175.15"></a><span id="l175.15"> #include &quot;nsNativeCharsetUtils.h&quot;</span>
<a href="#l175.16"></a><span id="l175.16"> #include &quot;nsUnicharUtils.h&quot;</span>
<a href="#l175.17"></a><span id="l175.17"> #include &quot;nsIStringBundle.h&quot;</span>
<a href="#l175.18"></a><span id="l175.18"> #include &quot;nsIServiceManager.h&quot;</span>
<a href="#l175.19"></a><span id="l175.19"> #include &quot;nsServiceManagerUtils.h&quot;</span>
<a href="#l175.20"></a><span id="l175.20"> #include &quot;nsAppDirectoryServiceDefs.h&quot;</span>
<a href="#l175.21"></a><span id="l175.21"> #include &quot;nsDirectoryServiceDefs.h&quot;</span>
<a href="#l175.22"></a><span id="l175.22" class="difflineat">@@ -298,19 +298,19 @@ static SETTING gBrowserSettings[] = {</span>
<a href="#l175.23"></a><span id="l175.23"> nsresult</span>
<a href="#l175.24"></a><span id="l175.24"> GetHelperPath(nsString&amp; aPath)</span>
<a href="#l175.25"></a><span id="l175.25"> {</span>
<a href="#l175.26"></a><span id="l175.26">   nsresult rv;</span>
<a href="#l175.27"></a><span id="l175.27">   nsCOMPtr&lt;nsIProperties&gt; directoryService = </span>
<a href="#l175.28"></a><span id="l175.28">     do_GetService(NS_DIRECTORY_SERVICE_CONTRACTID, &amp;rv);</span>
<a href="#l175.29"></a><span id="l175.29">   NS_ENSURE_SUCCESS(rv, rv);</span>
<a href="#l175.30"></a><span id="l175.30"> </span>
<a href="#l175.31"></a><span id="l175.31" class="difflineminus">-  nsCOMPtr&lt;nsILocalFile&gt; appHelper;</span>
<a href="#l175.32"></a><span id="l175.32" class="difflineplus">+  nsCOMPtr&lt;nsIFile&gt; appHelper;</span>
<a href="#l175.33"></a><span id="l175.33">   rv = directoryService-&gt;Get(NS_XPCOM_CURRENT_PROCESS_DIR,</span>
<a href="#l175.34"></a><span id="l175.34" class="difflineminus">-                             NS_GET_IID(nsILocalFile),</span>
<a href="#l175.35"></a><span id="l175.35" class="difflineplus">+                             NS_GET_IID(nsIFile),</span>
<a href="#l175.36"></a><span id="l175.36">                              getter_AddRefs(appHelper));</span>
<a href="#l175.37"></a><span id="l175.37">   NS_ENSURE_SUCCESS(rv, rv);</span>
<a href="#l175.38"></a><span id="l175.38"> </span>
<a href="#l175.39"></a><span id="l175.39">   rv = appHelper-&gt;AppendNative(NS_LITERAL_CSTRING(&quot;uninstall&quot;));</span>
<a href="#l175.40"></a><span id="l175.40">   NS_ENSURE_SUCCESS(rv, rv);</span>
<a href="#l175.41"></a><span id="l175.41"> </span>
<a href="#l175.42"></a><span id="l175.42">   rv = appHelper-&gt;AppendNative(NS_LITERAL_CSTRING(&quot;helper.exe&quot;));</span>
<a href="#l175.43"></a><span id="l175.43">   NS_ENSURE_SUCCESS(rv, rv);</span>
<a href="#l175.44"></a><span id="l175.44" class="difflineat">@@ -546,18 +546,18 @@ NS_IMETHODIMP</span>
<a href="#l175.45"></a><span id="l175.45"> nsWindowsShellService::SetDefaultClient(bool aForAllUsers,</span>
<a href="#l175.46"></a><span id="l175.46">                                         bool aClaimAllTypes, PRUint16 aApps)</span>
<a href="#l175.47"></a><span id="l175.47"> {</span>
<a href="#l175.48"></a><span id="l175.48">   nsresult rv;</span>
<a href="#l175.49"></a><span id="l175.49">   nsCOMPtr&lt;nsIProperties&gt; directoryService = </span>
<a href="#l175.50"></a><span id="l175.50">     do_GetService(NS_DIRECTORY_SERVICE_CONTRACTID, &amp;rv);</span>
<a href="#l175.51"></a><span id="l175.51">   NS_ENSURE_SUCCESS(rv, rv);</span>
<a href="#l175.52"></a><span id="l175.52"> </span>
<a href="#l175.53"></a><span id="l175.53" class="difflineminus">-  nsCOMPtr&lt;nsILocalFile&gt; appHelper;</span>
<a href="#l175.54"></a><span id="l175.54" class="difflineminus">-  rv = directoryService-&gt;Get(NS_XPCOM_CURRENT_PROCESS_DIR, NS_GET_IID(nsILocalFile), getter_AddRefs(appHelper));</span>
<a href="#l175.55"></a><span id="l175.55" class="difflineplus">+  nsCOMPtr&lt;nsIFile&gt; appHelper;</span>
<a href="#l175.56"></a><span id="l175.56" class="difflineplus">+  rv = directoryService-&gt;Get(NS_XPCOM_CURRENT_PROCESS_DIR, NS_GET_IID(nsIFile), getter_AddRefs(appHelper));</span>
<a href="#l175.57"></a><span id="l175.57">   NS_ENSURE_SUCCESS(rv, rv);</span>
<a href="#l175.58"></a><span id="l175.58"> </span>
<a href="#l175.59"></a><span id="l175.59">   rv = appHelper-&gt;AppendNative(NS_LITERAL_CSTRING(&quot;uninstall&quot;));</span>
<a href="#l175.60"></a><span id="l175.60">   NS_ENSURE_SUCCESS(rv, rv);</span>
<a href="#l175.61"></a><span id="l175.61"> </span>
<a href="#l175.62"></a><span id="l175.62">   rv = appHelper-&gt;AppendNative(NS_LITERAL_CSTRING(&quot;helper.exe&quot;));</span>
<a href="#l175.63"></a><span id="l175.63">   NS_ENSURE_SUCCESS(rv, rv);</span>
<a href="#l175.64"></a><span id="l175.64"> </span>
<a href="#l175.65"></a><span id="l175.65" class="difflineat">@@ -859,17 +859,17 @@ nsWindowsShellService::SetDesktopBackgro</span>
<a href="#l175.66"></a><span id="l175.66">   }</span>
<a href="#l175.67"></a><span id="l175.67"> </span>
<a href="#l175.68"></a><span id="l175.68">   // Close the key we opened.</span>
<a href="#l175.69"></a><span id="l175.69">   ::RegCloseKey(key);</span>
<a href="#l175.70"></a><span id="l175.70">   return NS_OK;</span>
<a href="#l175.71"></a><span id="l175.71"> }</span>
<a href="#l175.72"></a><span id="l175.72"> </span>
<a href="#l175.73"></a><span id="l175.73"> NS_IMETHODIMP</span>
<a href="#l175.74"></a><span id="l175.74" class="difflineminus">-nsWindowsShellService::OpenApplicationWithURI(nsILocalFile* aApplication,</span>
<a href="#l175.75"></a><span id="l175.75" class="difflineplus">+nsWindowsShellService::OpenApplicationWithURI(nsIFile* aApplication,</span>
<a href="#l175.76"></a><span id="l175.76">                                               const nsACString&amp; aURI)</span>
<a href="#l175.77"></a><span id="l175.77"> {</span>
<a href="#l175.78"></a><span id="l175.78">   nsresult rv;</span>
<a href="#l175.79"></a><span id="l175.79">   nsCOMPtr&lt;nsIProcess&gt; process = </span>
<a href="#l175.80"></a><span id="l175.80">     do_CreateInstance(&quot;@mozilla.org/process/util;1&quot;, &amp;rv);</span>
<a href="#l175.81"></a><span id="l175.81">   if (NS_FAILED(rv))</span>
<a href="#l175.82"></a><span id="l175.82">     return rv;</span>
<a href="#l175.83"></a><span id="l175.83">   </span>
<a href="#l175.84"></a><span id="l175.84" class="difflineat">@@ -878,17 +878,17 @@ nsWindowsShellService::OpenApplicationWi</span>
<a href="#l175.85"></a><span id="l175.85">     return rv;</span>
<a href="#l175.86"></a><span id="l175.86">   </span>
<a href="#l175.87"></a><span id="l175.87">   const nsCString&amp; spec = PromiseFlatCString(aURI);</span>
<a href="#l175.88"></a><span id="l175.88">   const char* specStr = spec.get();</span>
<a href="#l175.89"></a><span id="l175.89">   return process-&gt;Run(false, &amp;specStr, 1);</span>
<a href="#l175.90"></a><span id="l175.90"> }</span>
<a href="#l175.91"></a><span id="l175.91"> </span>
<a href="#l175.92"></a><span id="l175.92"> NS_IMETHODIMP</span>
<a href="#l175.93"></a><span id="l175.93" class="difflineminus">-nsWindowsShellService::GetDefaultFeedReader(nsILocalFile** _retval)</span>
<a href="#l175.94"></a><span id="l175.94" class="difflineplus">+nsWindowsShellService::GetDefaultFeedReader(nsIFile** _retval)</span>
<a href="#l175.95"></a><span id="l175.95"> {</span>
<a href="#l175.96"></a><span id="l175.96">   *_retval = nsnull;</span>
<a href="#l175.97"></a><span id="l175.97"> </span>
<a href="#l175.98"></a><span id="l175.98">   HKEY theKey;</span>
<a href="#l175.99"></a><span id="l175.99">   nsresult rv = OpenKeyForReading(HKEY_CLASSES_ROOT, </span>
<a href="#l175.100"></a><span id="l175.100">                                   L&quot;feed\\shell\\open\\command&quot;,</span>
<a href="#l175.101"></a><span id="l175.101">                                   &amp;theKey);</span>
<a href="#l175.102"></a><span id="l175.102">   NS_ENSURE_SUCCESS(rv, rv);</span>
<a href="#l175.103"></a><span id="l175.103" class="difflineat">@@ -914,17 +914,17 @@ nsWindowsShellService::GetDefaultFeedRea</span>
<a href="#l175.104"></a><span id="l175.104">   if (path.First() == '&quot;') {</span>
<a href="#l175.105"></a><span id="l175.105">     // Everything inside the quotes</span>
<a href="#l175.106"></a><span id="l175.106">     path = Substring(path, 1, path.FindChar('&quot;', 1) - 1);</span>
<a href="#l175.107"></a><span id="l175.107">   } else {</span>
<a href="#l175.108"></a><span id="l175.108">     // Everything up to the first space</span>
<a href="#l175.109"></a><span id="l175.109">     path = Substring(path, 0, path.FindChar(' '));</span>
<a href="#l175.110"></a><span id="l175.110">   }</span>
<a href="#l175.111"></a><span id="l175.111"> </span>
<a href="#l175.112"></a><span id="l175.112" class="difflineminus">-  nsCOMPtr&lt;nsILocalFile&gt; defaultReader =</span>
<a href="#l175.113"></a><span id="l175.113" class="difflineplus">+  nsCOMPtr&lt;nsIFile&gt; defaultReader =</span>
<a href="#l175.114"></a><span id="l175.114">     do_CreateInstance(&quot;@mozilla.org/file/local;1&quot;, &amp;rv);</span>
<a href="#l175.115"></a><span id="l175.115">   NS_ENSURE_SUCCESS(rv, rv);</span>
<a href="#l175.116"></a><span id="l175.116"> </span>
<a href="#l175.117"></a><span id="l175.117">   rv = defaultReader-&gt;InitWithPath(path);</span>
<a href="#l175.118"></a><span id="l175.118">   NS_ENSURE_SUCCESS(rv, rv);</span>
<a href="#l175.119"></a><span id="l175.119"> </span>
<a href="#l175.120"></a><span id="l175.120">   bool exists;</span>
<a href="#l175.121"></a><span id="l175.121">   rv = defaultReader-&gt;Exists(&amp;exists);</span></pre></div></div>

<div class="page_footer">
<div class="page_footer_text">comm-central</div>
<div class="page_footer_text" style="padding-left: 10px">Deployed from <a href="https://hg.mozilla.org/hgcustom/version-control-tools/rev/35f393d6769a">35f393d6769a</a> at 2020-07-16T17:23:43Z.</div>
<div class="rss_logo">
<a href="/comm-central/rss-log">RSS</a>
<a href="/comm-central/atom-log">Atom</a>
</div>
<br />

</div>
</body>
</html>

