<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en-US" lang="en-US">
<head>
<link rel="icon" href="/static/4b0de666d1a4/hgicon.png" type="image/png" />
<meta name="robots" content="index, nofollow"/>
<link rel="stylesheet" href="/static/4b0de666d1a4/style-gitweb.css" type="text/css" />

<style type="text/css">
div.feed {
  float: right;
}
a img {
  border-width: 0px;
}
div.log_link {
  width: 80px;
  background-color: white;
}

div.log_body {
  padding-left: 96px;
}
</style>
<script type="text/javascript" src="/static/4b0de666d1a4/mercurial.js"></script>

<meta property="og:image" content="/static/4b0de666d1a4/moz-logo-bw-rgb.svg"/>
<meta property="og:type" content="website"/>

<title>comm-central: changeset 27028:99a134f08efeb1e6e54dd45f755af00f2b49669a</title>
<link rel="alternate" type="application/atom+xml"
   href="/comm-central/atom-log" title="Atom feed for comm-central"/>
<link rel="alternate" type="application/rss+xml"
   href="/comm-central/rss-log" title="RSS feed for comm-central"/>

<meta property="og:title" content="comm-central @ 99a134f08efeb1e6e54dd45f755af00f2b49669a" />
<meta property="og:url" content="/comm-central/rev/99a134f08efeb1e6e54dd45f755af00f2b49669a" />
<meta property="og:description" content="Bug 1554630 - convert the tabmail-tabs binding to custom element. rs=bustage-fix" />

</head>
<body>

<div class="page_header">
<div class="logo">
    <a href="https://developer.mozilla.org/en/docs/Mercurial">
        <img src="/static/4b0de666d1a4/moz-logo-bw-rgb.svg" alt="mercurial" />
    </a>
</div>
<a href="/">Mercurial</a> &gt; <a href="/comm-central">comm-central</a>  / changeset / 99a134f08efeb1e6e54dd45f755af00f2b49669a 
</div>

<div class="page_nav">
<div>
<a href="/comm-central/summary">summary</a> |
<a href="/comm-central/shortlog/99a134f08efeb1e6e54dd45f755af00f2b49669a">shortlog</a> |
<a href="/comm-central/log/99a134f08efeb1e6e54dd45f755af00f2b49669a">changelog</a> |
<a href="/comm-central/pushloghtml">pushlog</a> |
<a href="/comm-central/graph/99a134f08efeb1e6e54dd45f755af00f2b49669a">graph</a> |
<a href="/comm-central/tags">tags</a> |
<a href="/comm-central/bookmarks">bookmarks</a> |
<a href="/comm-central/branches">branches</a> |
<a href="/comm-central/file/99a134f08efeb1e6e54dd45f755af00f2b49669a">files</a> |
changeset |
<a href="/comm-central/raw-rev/99a134f08efeb1e6e54dd45f755af00f2b49669a">raw</a>  | <a href="/comm-central/archive/99a134f08efeb1e6e54dd45f755af00f2b49669a.zip">zip</a>  |
<a href="/comm-central/help">help</a>
</div>

<div class="search">
<form id="searchform" action="/comm-central/log">

<input name="rev" type="text" value="" size="40" />
<div id="hint">Find changesets by keywords (author, files, the commit message), revision
number or hash, or <a href="/comm-central/help/revsets">revset expression</a>.</div>
</form>
</div>
</div>

<div class="title">
<a href="https://bugzilla.mozilla.org/show_bug.cgi?id=1554630">Bug 1554630</a> - convert the tabmail-tabs binding to custom element. rs=bustage-fix
<span class="logtags"></span>
</div>
<div class="title_text">
<table cellspacing="0">

<tr><td>author</td><td>&#77;&#97;&#103;&#110;&#117;&#115;&#32;&#77;&#101;&#108;&#105;&#110;&#32;&#60;&#109;&#107;&#109;&#101;&#108;&#105;&#110;&#43;&#109;&#111;&#122;&#105;&#108;&#108;&#97;&#64;&#105;&#107;&#105;&#46;&#102;&#105;&#62;&#44;&#32;&#65;&#108;&#101;&#115;&#115;&#97;&#110;&#100;&#114;&#111;&#32;&#67;&#97;&#115;&#116;&#101;&#108;&#108;&#97;&#110;&#105;&#32;&#60;&#97;&#108;&#101;&#115;&#115;&#97;&#110;&#100;&#114;&#111;&#64;&#116;&#104;&#117;&#110;&#100;&#101;&#114;&#98;&#105;&#114;&#100;&#46;&#110;&#101;&#116;&#62;</td></tr>
<tr><td></td><td class="date age">Sat, 29 Jun 2019 23:01:55 +0300</td></tr>

<tr>
 <td>changeset 27028</td>
 <td style="font-family:monospace"><a class="list" href="/comm-central/rev/99a134f08efeb1e6e54dd45f755af00f2b49669a">99a134f08efeb1e6e54dd45f755af00f2b49669a</a></td>
</tr>



<tr>
<td>parent 27027</td>
<td style="font-family:monospace">
<a class="list" href="/comm-central/rev/5d1b0dbe9f0c97d1f10cda704aa61cc2fd4c6366">5d1b0dbe9f0c97d1f10cda704aa61cc2fd4c6366</a>
</td>
</tr>

<tr>
<td>child 27029</td>
<td style="font-family:monospace">
<a class="list" href="/comm-central/rev/68fe7b1e877f6229e081e59b683be502eac7b5a8">68fe7b1e877f6229e081e59b683be502eac7b5a8</a>
</td>
</tr>
<tr><td>push id</td><td><a href="/comm-central/pushloghtml?changeset=99a134f08efeb1e6e54dd45f755af00f2b49669a">16121</a></td></tr>
<tr><td>push user</td><td>mozilla@jorgk.com</td></tr>
<tr><td>push date</td><td class="date age">Sun, 30 Jun 2019 20:19:38 +0000</td></tr>

<tr><td>treeherder</td><td>comm-central@68fe7b1e877f [<a href="https://treeherder.mozilla.org/#/jobs?repo=comm-central&revision=68fe7b1e877f6229e081e59b683be502eac7b5a8">default view</a>] [<a href="https://treeherder.mozilla.org/#/jobs?repo=comm-central&revision=68fe7b1e877f6229e081e59b683be502eac7b5a8&filter-resultStatus=testfailed&filter-resultStatus=busted&filter-resultStatus=exception">failures only]</td></tr>
<tr><td>perfherder</td><td>[<a href="https://treeherder.mozilla.org/perf.html#/compare?originalProject=comm-central&originalRevision=68fe7b1e877f6229e081e59b683be502eac7b5a8&newProject=comm-central&newRevision=99a134f08efeb1e6e54dd45f755af00f2b49669a&framework=1" target="_blank">talos</a>] [<a href="https://treeherder.mozilla.org/perf.html#/compare?originalProject=comm-central&originalRevision=68fe7b1e877f6229e081e59b683be502eac7b5a8&newProject=comm-central&newRevision=99a134f08efeb1e6e54dd45f755af00f2b49669a&framework=2" target="_blank">build metrics</a>] [<a href="https://treeherder.mozilla.org/perf.html#/compare?originalProject=comm-central&originalRevision=68fe7b1e877f6229e081e59b683be502eac7b5a8&newProject=comm-central&newRevision=99a134f08efeb1e6e54dd45f755af00f2b49669a&framework=6" target="_blank">platform microbench</a>] (compared to previous push)</td></tr>
<tr><td>reviewers</td><td><a href="/comm-central/log?rev=reviewer%28bustage-fix%29&revcount=50">bustage-fix</a></td></tr>
<tr><td>bugs</td><td><a href="https://bugzilla.mozilla.org/show_bug.cgi?id=1554630">1554630</a></td></tr>




</table></div>

<div class="page_body description"><a href="https://bugzilla.mozilla.org/show_bug.cgi?id=1554630">Bug 1554630</a> - convert the tabmail-tabs binding to custom element. rs=bustage-fix</div>
<div class="list_head"></div>
<div class="title_text">
<table cellspacing="0">

<tr class="parity0">
<td><a class="list" href="/comm-central/diff/99a134f08efeb1e6e54dd45f755af00f2b49669a/mail/base/content/messenger.xul">mail/base/content/messenger.xul</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/99a134f08efeb1e6e54dd45f755af00f2b49669a/mail/base/content/messenger.xul">file</a> |
<a href="/comm-central/annotate/99a134f08efeb1e6e54dd45f755af00f2b49669a/mail/base/content/messenger.xul">annotate</a> |
<a href="/comm-central/diff/99a134f08efeb1e6e54dd45f755af00f2b49669a/mail/base/content/messenger.xul">diff</a> |
<a href="/comm-central/comparison/99a134f08efeb1e6e54dd45f755af00f2b49669a/mail/base/content/messenger.xul">comparison</a> |
<a href="/comm-central/log/99a134f08efeb1e6e54dd45f755af00f2b49669a/mail/base/content/messenger.xul">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/99a134f08efeb1e6e54dd45f755af00f2b49669a/mail/base/content/tabmail-tabs.js">mail/base/content/tabmail-tabs.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/99a134f08efeb1e6e54dd45f755af00f2b49669a/mail/base/content/tabmail-tabs.js">file</a> |
<a href="/comm-central/annotate/99a134f08efeb1e6e54dd45f755af00f2b49669a/mail/base/content/tabmail-tabs.js">annotate</a> |
<a href="/comm-central/diff/99a134f08efeb1e6e54dd45f755af00f2b49669a/mail/base/content/tabmail-tabs.js">diff</a> |
<a href="/comm-central/comparison/99a134f08efeb1e6e54dd45f755af00f2b49669a/mail/base/content/tabmail-tabs.js">comparison</a> |
<a href="/comm-central/log/99a134f08efeb1e6e54dd45f755af00f2b49669a/mail/base/content/tabmail-tabs.js">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/99a134f08efeb1e6e54dd45f755af00f2b49669a/mail/base/content/tabmail.css">mail/base/content/tabmail.css</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/99a134f08efeb1e6e54dd45f755af00f2b49669a/mail/base/content/tabmail.css">file</a> |
<a href="/comm-central/annotate/99a134f08efeb1e6e54dd45f755af00f2b49669a/mail/base/content/tabmail.css">annotate</a> |
<a href="/comm-central/diff/99a134f08efeb1e6e54dd45f755af00f2b49669a/mail/base/content/tabmail.css">diff</a> |
<a href="/comm-central/comparison/99a134f08efeb1e6e54dd45f755af00f2b49669a/mail/base/content/tabmail.css">comparison</a> |
<a href="/comm-central/log/99a134f08efeb1e6e54dd45f755af00f2b49669a/mail/base/content/tabmail.css">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/99a134f08efeb1e6e54dd45f755af00f2b49669a/mail/base/content/tabmail.xml">mail/base/content/tabmail.xml</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/99a134f08efeb1e6e54dd45f755af00f2b49669a/mail/base/content/tabmail.xml">file</a> |
<a href="/comm-central/annotate/99a134f08efeb1e6e54dd45f755af00f2b49669a/mail/base/content/tabmail.xml">annotate</a> |
<a href="/comm-central/diff/99a134f08efeb1e6e54dd45f755af00f2b49669a/mail/base/content/tabmail.xml">diff</a> |
<a href="/comm-central/comparison/99a134f08efeb1e6e54dd45f755af00f2b49669a/mail/base/content/tabmail.xml">comparison</a> |
<a href="/comm-central/log/99a134f08efeb1e6e54dd45f755af00f2b49669a/mail/base/content/tabmail.xml">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/99a134f08efeb1e6e54dd45f755af00f2b49669a/mail/base/jar.mn">mail/base/jar.mn</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/99a134f08efeb1e6e54dd45f755af00f2b49669a/mail/base/jar.mn">file</a> |
<a href="/comm-central/annotate/99a134f08efeb1e6e54dd45f755af00f2b49669a/mail/base/jar.mn">annotate</a> |
<a href="/comm-central/diff/99a134f08efeb1e6e54dd45f755af00f2b49669a/mail/base/jar.mn">diff</a> |
<a href="/comm-central/comparison/99a134f08efeb1e6e54dd45f755af00f2b49669a/mail/base/jar.mn">comparison</a> |
<a href="/comm-central/log/99a134f08efeb1e6e54dd45f755af00f2b49669a/mail/base/jar.mn">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/99a134f08efeb1e6e54dd45f755af00f2b49669a/mail/components/extensions/test/browser/browser_ext_menus.js">mail/components/extensions/test/browser/browser_ext_menus.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/99a134f08efeb1e6e54dd45f755af00f2b49669a/mail/components/extensions/test/browser/browser_ext_menus.js">file</a> |
<a href="/comm-central/annotate/99a134f08efeb1e6e54dd45f755af00f2b49669a/mail/components/extensions/test/browser/browser_ext_menus.js">annotate</a> |
<a href="/comm-central/diff/99a134f08efeb1e6e54dd45f755af00f2b49669a/mail/components/extensions/test/browser/browser_ext_menus.js">diff</a> |
<a href="/comm-central/comparison/99a134f08efeb1e6e54dd45f755af00f2b49669a/mail/components/extensions/test/browser/browser_ext_menus.js">comparison</a> |
<a href="/comm-central/log/99a134f08efeb1e6e54dd45f755af00f2b49669a/mail/components/extensions/test/browser/browser_ext_menus.js">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/99a134f08efeb1e6e54dd45f755af00f2b49669a/mail/test/mozmill/content-policy/test-compose-mailto.js">mail/test/mozmill/content-policy/test-compose-mailto.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/99a134f08efeb1e6e54dd45f755af00f2b49669a/mail/test/mozmill/content-policy/test-compose-mailto.js">file</a> |
<a href="/comm-central/annotate/99a134f08efeb1e6e54dd45f755af00f2b49669a/mail/test/mozmill/content-policy/test-compose-mailto.js">annotate</a> |
<a href="/comm-central/diff/99a134f08efeb1e6e54dd45f755af00f2b49669a/mail/test/mozmill/content-policy/test-compose-mailto.js">diff</a> |
<a href="/comm-central/comparison/99a134f08efeb1e6e54dd45f755af00f2b49669a/mail/test/mozmill/content-policy/test-compose-mailto.js">comparison</a> |
<a href="/comm-central/log/99a134f08efeb1e6e54dd45f755af00f2b49669a/mail/test/mozmill/content-policy/test-compose-mailto.js">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/99a134f08efeb1e6e54dd45f755af00f2b49669a/mail/test/mozmill/content-policy/test-dns-prefetch.js">mail/test/mozmill/content-policy/test-dns-prefetch.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/99a134f08efeb1e6e54dd45f755af00f2b49669a/mail/test/mozmill/content-policy/test-dns-prefetch.js">file</a> |
<a href="/comm-central/annotate/99a134f08efeb1e6e54dd45f755af00f2b49669a/mail/test/mozmill/content-policy/test-dns-prefetch.js">annotate</a> |
<a href="/comm-central/diff/99a134f08efeb1e6e54dd45f755af00f2b49669a/mail/test/mozmill/content-policy/test-dns-prefetch.js">diff</a> |
<a href="/comm-central/comparison/99a134f08efeb1e6e54dd45f755af00f2b49669a/mail/test/mozmill/content-policy/test-dns-prefetch.js">comparison</a> |
<a href="/comm-central/log/99a134f08efeb1e6e54dd45f755af00f2b49669a/mail/test/mozmill/content-policy/test-dns-prefetch.js">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/99a134f08efeb1e6e54dd45f755af00f2b49669a/mail/test/mozmill/content-policy/test-exposed-in-content-tabs.js">mail/test/mozmill/content-policy/test-exposed-in-content-tabs.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/99a134f08efeb1e6e54dd45f755af00f2b49669a/mail/test/mozmill/content-policy/test-exposed-in-content-tabs.js">file</a> |
<a href="/comm-central/annotate/99a134f08efeb1e6e54dd45f755af00f2b49669a/mail/test/mozmill/content-policy/test-exposed-in-content-tabs.js">annotate</a> |
<a href="/comm-central/diff/99a134f08efeb1e6e54dd45f755af00f2b49669a/mail/test/mozmill/content-policy/test-exposed-in-content-tabs.js">diff</a> |
<a href="/comm-central/comparison/99a134f08efeb1e6e54dd45f755af00f2b49669a/mail/test/mozmill/content-policy/test-exposed-in-content-tabs.js">comparison</a> |
<a href="/comm-central/log/99a134f08efeb1e6e54dd45f755af00f2b49669a/mail/test/mozmill/content-policy/test-exposed-in-content-tabs.js">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/99a134f08efeb1e6e54dd45f755af00f2b49669a/mail/test/mozmill/content-policy/test-general-content-policy.js">mail/test/mozmill/content-policy/test-general-content-policy.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/99a134f08efeb1e6e54dd45f755af00f2b49669a/mail/test/mozmill/content-policy/test-general-content-policy.js">file</a> |
<a href="/comm-central/annotate/99a134f08efeb1e6e54dd45f755af00f2b49669a/mail/test/mozmill/content-policy/test-general-content-policy.js">annotate</a> |
<a href="/comm-central/diff/99a134f08efeb1e6e54dd45f755af00f2b49669a/mail/test/mozmill/content-policy/test-general-content-policy.js">diff</a> |
<a href="/comm-central/comparison/99a134f08efeb1e6e54dd45f755af00f2b49669a/mail/test/mozmill/content-policy/test-general-content-policy.js">comparison</a> |
<a href="/comm-central/log/99a134f08efeb1e6e54dd45f755af00f2b49669a/mail/test/mozmill/content-policy/test-general-content-policy.js">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/99a134f08efeb1e6e54dd45f755af00f2b49669a/mail/test/mozmill/content-policy/test-plugins-policy.js">mail/test/mozmill/content-policy/test-plugins-policy.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/99a134f08efeb1e6e54dd45f755af00f2b49669a/mail/test/mozmill/content-policy/test-plugins-policy.js">file</a> |
<a href="/comm-central/annotate/99a134f08efeb1e6e54dd45f755af00f2b49669a/mail/test/mozmill/content-policy/test-plugins-policy.js">annotate</a> |
<a href="/comm-central/diff/99a134f08efeb1e6e54dd45f755af00f2b49669a/mail/test/mozmill/content-policy/test-plugins-policy.js">diff</a> |
<a href="/comm-central/comparison/99a134f08efeb1e6e54dd45f755af00f2b49669a/mail/test/mozmill/content-policy/test-plugins-policy.js">comparison</a> |
<a href="/comm-central/log/99a134f08efeb1e6e54dd45f755af00f2b49669a/mail/test/mozmill/content-policy/test-plugins-policy.js">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/99a134f08efeb1e6e54dd45f755af00f2b49669a/mail/test/mozmill/content-tabs/test-content-tab.js">mail/test/mozmill/content-tabs/test-content-tab.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/99a134f08efeb1e6e54dd45f755af00f2b49669a/mail/test/mozmill/content-tabs/test-content-tab.js">file</a> |
<a href="/comm-central/annotate/99a134f08efeb1e6e54dd45f755af00f2b49669a/mail/test/mozmill/content-tabs/test-content-tab.js">annotate</a> |
<a href="/comm-central/diff/99a134f08efeb1e6e54dd45f755af00f2b49669a/mail/test/mozmill/content-tabs/test-content-tab.js">diff</a> |
<a href="/comm-central/comparison/99a134f08efeb1e6e54dd45f755af00f2b49669a/mail/test/mozmill/content-tabs/test-content-tab.js">comparison</a> |
<a href="/comm-central/log/99a134f08efeb1e6e54dd45f755af00f2b49669a/mail/test/mozmill/content-tabs/test-content-tab.js">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/99a134f08efeb1e6e54dd45f755af00f2b49669a/mail/test/mozmill/downloads/test-about-downloads.js">mail/test/mozmill/downloads/test-about-downloads.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/99a134f08efeb1e6e54dd45f755af00f2b49669a/mail/test/mozmill/downloads/test-about-downloads.js">file</a> |
<a href="/comm-central/annotate/99a134f08efeb1e6e54dd45f755af00f2b49669a/mail/test/mozmill/downloads/test-about-downloads.js">annotate</a> |
<a href="/comm-central/diff/99a134f08efeb1e6e54dd45f755af00f2b49669a/mail/test/mozmill/downloads/test-about-downloads.js">diff</a> |
<a href="/comm-central/comparison/99a134f08efeb1e6e54dd45f755af00f2b49669a/mail/test/mozmill/downloads/test-about-downloads.js">comparison</a> |
<a href="/comm-central/log/99a134f08efeb1e6e54dd45f755af00f2b49669a/mail/test/mozmill/downloads/test-about-downloads.js">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/99a134f08efeb1e6e54dd45f755af00f2b49669a/mail/test/mozmill/folder-display/test-displaying-messages-in-folder-tabs.js">mail/test/mozmill/folder-display/test-displaying-messages-in-folder-tabs.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/99a134f08efeb1e6e54dd45f755af00f2b49669a/mail/test/mozmill/folder-display/test-displaying-messages-in-folder-tabs.js">file</a> |
<a href="/comm-central/annotate/99a134f08efeb1e6e54dd45f755af00f2b49669a/mail/test/mozmill/folder-display/test-displaying-messages-in-folder-tabs.js">annotate</a> |
<a href="/comm-central/diff/99a134f08efeb1e6e54dd45f755af00f2b49669a/mail/test/mozmill/folder-display/test-displaying-messages-in-folder-tabs.js">diff</a> |
<a href="/comm-central/comparison/99a134f08efeb1e6e54dd45f755af00f2b49669a/mail/test/mozmill/folder-display/test-displaying-messages-in-folder-tabs.js">comparison</a> |
<a href="/comm-central/log/99a134f08efeb1e6e54dd45f755af00f2b49669a/mail/test/mozmill/folder-display/test-displaying-messages-in-folder-tabs.js">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/99a134f08efeb1e6e54dd45f755af00f2b49669a/mail/test/mozmill/folder-display/test-opening-messages-without-a-backing-view.js">mail/test/mozmill/folder-display/test-opening-messages-without-a-backing-view.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/99a134f08efeb1e6e54dd45f755af00f2b49669a/mail/test/mozmill/folder-display/test-opening-messages-without-a-backing-view.js">file</a> |
<a href="/comm-central/annotate/99a134f08efeb1e6e54dd45f755af00f2b49669a/mail/test/mozmill/folder-display/test-opening-messages-without-a-backing-view.js">annotate</a> |
<a href="/comm-central/diff/99a134f08efeb1e6e54dd45f755af00f2b49669a/mail/test/mozmill/folder-display/test-opening-messages-without-a-backing-view.js">diff</a> |
<a href="/comm-central/comparison/99a134f08efeb1e6e54dd45f755af00f2b49669a/mail/test/mozmill/folder-display/test-opening-messages-without-a-backing-view.js">comparison</a> |
<a href="/comm-central/log/99a134f08efeb1e6e54dd45f755af00f2b49669a/mail/test/mozmill/folder-display/test-opening-messages-without-a-backing-view.js">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/99a134f08efeb1e6e54dd45f755af00f2b49669a/mail/test/mozmill/folder-display/test-opening-messages.js">mail/test/mozmill/folder-display/test-opening-messages.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/99a134f08efeb1e6e54dd45f755af00f2b49669a/mail/test/mozmill/folder-display/test-opening-messages.js">file</a> |
<a href="/comm-central/annotate/99a134f08efeb1e6e54dd45f755af00f2b49669a/mail/test/mozmill/folder-display/test-opening-messages.js">annotate</a> |
<a href="/comm-central/diff/99a134f08efeb1e6e54dd45f755af00f2b49669a/mail/test/mozmill/folder-display/test-opening-messages.js">diff</a> |
<a href="/comm-central/comparison/99a134f08efeb1e6e54dd45f755af00f2b49669a/mail/test/mozmill/folder-display/test-opening-messages.js">comparison</a> |
<a href="/comm-central/log/99a134f08efeb1e6e54dd45f755af00f2b49669a/mail/test/mozmill/folder-display/test-opening-messages.js">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/99a134f08efeb1e6e54dd45f755af00f2b49669a/mail/test/mozmill/im/test-chat-tab-restore.js">mail/test/mozmill/im/test-chat-tab-restore.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/99a134f08efeb1e6e54dd45f755af00f2b49669a/mail/test/mozmill/im/test-chat-tab-restore.js">file</a> |
<a href="/comm-central/annotate/99a134f08efeb1e6e54dd45f755af00f2b49669a/mail/test/mozmill/im/test-chat-tab-restore.js">annotate</a> |
<a href="/comm-central/diff/99a134f08efeb1e6e54dd45f755af00f2b49669a/mail/test/mozmill/im/test-chat-tab-restore.js">diff</a> |
<a href="/comm-central/comparison/99a134f08efeb1e6e54dd45f755af00f2b49669a/mail/test/mozmill/im/test-chat-tab-restore.js">comparison</a> |
<a href="/comm-central/log/99a134f08efeb1e6e54dd45f755af00f2b49669a/mail/test/mozmill/im/test-chat-tab-restore.js">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/99a134f08efeb1e6e54dd45f755af00f2b49669a/mail/test/mozmill/newmailaccount/test-newmailaccount.js">mail/test/mozmill/newmailaccount/test-newmailaccount.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/99a134f08efeb1e6e54dd45f755af00f2b49669a/mail/test/mozmill/newmailaccount/test-newmailaccount.js">file</a> |
<a href="/comm-central/annotate/99a134f08efeb1e6e54dd45f755af00f2b49669a/mail/test/mozmill/newmailaccount/test-newmailaccount.js">annotate</a> |
<a href="/comm-central/diff/99a134f08efeb1e6e54dd45f755af00f2b49669a/mail/test/mozmill/newmailaccount/test-newmailaccount.js">diff</a> |
<a href="/comm-central/comparison/99a134f08efeb1e6e54dd45f755af00f2b49669a/mail/test/mozmill/newmailaccount/test-newmailaccount.js">comparison</a> |
<a href="/comm-central/log/99a134f08efeb1e6e54dd45f755af00f2b49669a/mail/test/mozmill/newmailaccount/test-newmailaccount.js">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/99a134f08efeb1e6e54dd45f755af00f2b49669a/mail/test/mozmill/search-window/test-search-window.js">mail/test/mozmill/search-window/test-search-window.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/99a134f08efeb1e6e54dd45f755af00f2b49669a/mail/test/mozmill/search-window/test-search-window.js">file</a> |
<a href="/comm-central/annotate/99a134f08efeb1e6e54dd45f755af00f2b49669a/mail/test/mozmill/search-window/test-search-window.js">annotate</a> |
<a href="/comm-central/diff/99a134f08efeb1e6e54dd45f755af00f2b49669a/mail/test/mozmill/search-window/test-search-window.js">diff</a> |
<a href="/comm-central/comparison/99a134f08efeb1e6e54dd45f755af00f2b49669a/mail/test/mozmill/search-window/test-search-window.js">comparison</a> |
<a href="/comm-central/log/99a134f08efeb1e6e54dd45f755af00f2b49669a/mail/test/mozmill/search-window/test-search-window.js">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/99a134f08efeb1e6e54dd45f755af00f2b49669a/mail/test/mozmill/shared-modules/test-content-tab-helpers.js">mail/test/mozmill/shared-modules/test-content-tab-helpers.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/99a134f08efeb1e6e54dd45f755af00f2b49669a/mail/test/mozmill/shared-modules/test-content-tab-helpers.js">file</a> |
<a href="/comm-central/annotate/99a134f08efeb1e6e54dd45f755af00f2b49669a/mail/test/mozmill/shared-modules/test-content-tab-helpers.js">annotate</a> |
<a href="/comm-central/diff/99a134f08efeb1e6e54dd45f755af00f2b49669a/mail/test/mozmill/shared-modules/test-content-tab-helpers.js">diff</a> |
<a href="/comm-central/comparison/99a134f08efeb1e6e54dd45f755af00f2b49669a/mail/test/mozmill/shared-modules/test-content-tab-helpers.js">comparison</a> |
<a href="/comm-central/log/99a134f08efeb1e6e54dd45f755af00f2b49669a/mail/test/mozmill/shared-modules/test-content-tab-helpers.js">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/99a134f08efeb1e6e54dd45f755af00f2b49669a/mail/test/mozmill/shared-modules/test-folder-display-helpers.js">mail/test/mozmill/shared-modules/test-folder-display-helpers.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/99a134f08efeb1e6e54dd45f755af00f2b49669a/mail/test/mozmill/shared-modules/test-folder-display-helpers.js">file</a> |
<a href="/comm-central/annotate/99a134f08efeb1e6e54dd45f755af00f2b49669a/mail/test/mozmill/shared-modules/test-folder-display-helpers.js">annotate</a> |
<a href="/comm-central/diff/99a134f08efeb1e6e54dd45f755af00f2b49669a/mail/test/mozmill/shared-modules/test-folder-display-helpers.js">diff</a> |
<a href="/comm-central/comparison/99a134f08efeb1e6e54dd45f755af00f2b49669a/mail/test/mozmill/shared-modules/test-folder-display-helpers.js">comparison</a> |
<a href="/comm-central/log/99a134f08efeb1e6e54dd45f755af00f2b49669a/mail/test/mozmill/shared-modules/test-folder-display-helpers.js">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/99a134f08efeb1e6e54dd45f755af00f2b49669a/mail/test/mozmill/tabmail/test-tabmail-dragndrop.js">mail/test/mozmill/tabmail/test-tabmail-dragndrop.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/99a134f08efeb1e6e54dd45f755af00f2b49669a/mail/test/mozmill/tabmail/test-tabmail-dragndrop.js">file</a> |
<a href="/comm-central/annotate/99a134f08efeb1e6e54dd45f755af00f2b49669a/mail/test/mozmill/tabmail/test-tabmail-dragndrop.js">annotate</a> |
<a href="/comm-central/diff/99a134f08efeb1e6e54dd45f755af00f2b49669a/mail/test/mozmill/tabmail/test-tabmail-dragndrop.js">diff</a> |
<a href="/comm-central/comparison/99a134f08efeb1e6e54dd45f755af00f2b49669a/mail/test/mozmill/tabmail/test-tabmail-dragndrop.js">comparison</a> |
<a href="/comm-central/log/99a134f08efeb1e6e54dd45f755af00f2b49669a/mail/test/mozmill/tabmail/test-tabmail-dragndrop.js">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/99a134f08efeb1e6e54dd45f755af00f2b49669a/mail/themes/linux/mail/tabmail.css">mail/themes/linux/mail/tabmail.css</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/99a134f08efeb1e6e54dd45f755af00f2b49669a/mail/themes/linux/mail/tabmail.css">file</a> |
<a href="/comm-central/annotate/99a134f08efeb1e6e54dd45f755af00f2b49669a/mail/themes/linux/mail/tabmail.css">annotate</a> |
<a href="/comm-central/diff/99a134f08efeb1e6e54dd45f755af00f2b49669a/mail/themes/linux/mail/tabmail.css">diff</a> |
<a href="/comm-central/comparison/99a134f08efeb1e6e54dd45f755af00f2b49669a/mail/themes/linux/mail/tabmail.css">comparison</a> |
<a href="/comm-central/log/99a134f08efeb1e6e54dd45f755af00f2b49669a/mail/themes/linux/mail/tabmail.css">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/99a134f08efeb1e6e54dd45f755af00f2b49669a/mail/themes/windows/mail/tabmail.css">mail/themes/windows/mail/tabmail.css</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/99a134f08efeb1e6e54dd45f755af00f2b49669a/mail/themes/windows/mail/tabmail.css">file</a> |
<a href="/comm-central/annotate/99a134f08efeb1e6e54dd45f755af00f2b49669a/mail/themes/windows/mail/tabmail.css">annotate</a> |
<a href="/comm-central/diff/99a134f08efeb1e6e54dd45f755af00f2b49669a/mail/themes/windows/mail/tabmail.css">diff</a> |
<a href="/comm-central/comparison/99a134f08efeb1e6e54dd45f755af00f2b49669a/mail/themes/windows/mail/tabmail.css">comparison</a> |
<a href="/comm-central/log/99a134f08efeb1e6e54dd45f755af00f2b49669a/mail/themes/windows/mail/tabmail.css">revisions</a>
</td>
</tr>
</table></div>

<div class="page_body diffblocks"><div class="diffblock"><pre class="sourcelines">
<a href="#l1.1"></a><span id="l1.1" class="difflineminus">--- a/mail/base/content/messenger.xul</span>
<a href="#l1.2"></a><span id="l1.2" class="difflineplus">+++ b/mail/base/content/messenger.xul</span>
<a href="#l1.3"></a><span id="l1.3" class="difflineat">@@ -152,16 +152,17 @@</span>
<a href="#l1.4"></a><span id="l1.4"> &lt;script src=&quot;chrome://messenger/content/quickFilterBar.js&quot;/&gt;</span>
<a href="#l1.5"></a><span id="l1.5"> &lt;script src=&quot;chrome://messenger/content/newmailaccount/uriListener.js&quot;/&gt;</span>
<a href="#l1.6"></a><span id="l1.6"> &lt;script src=&quot;chrome://messenger/content/chat/chat-conversation-info.js&quot;/&gt;</span>
<a href="#l1.7"></a><span id="l1.7"> &lt;script src=&quot;chrome://gloda/content/autocomplete-richlistitem.js&quot;/&gt;</span>
<a href="#l1.8"></a><span id="l1.8"> &lt;script src=&quot;chrome://messenger/content/chat/chat-contact.js&quot;/&gt;</span>
<a href="#l1.9"></a><span id="l1.9"> &lt;script src=&quot;chrome://messenger/content/chat/chat-group.js&quot;/&gt;</span>
<a href="#l1.10"></a><span id="l1.10"> &lt;script src=&quot;chrome://messenger/content/chat/chat-imconv.js&quot;/&gt;</span>
<a href="#l1.11"></a><span id="l1.11"> &lt;script src=&quot;chrome://messenger/content/tabbrowser-tab.js&quot;/&gt;</span>
<a href="#l1.12"></a><span id="l1.12" class="difflineplus">+&lt;script src=&quot;chrome://messenger/content/tabmail-tabs.js&quot;/&gt;</span>
<a href="#l1.13"></a><span id="l1.13"> &lt;script src=&quot;chrome://messenger/content/chat/toolbarbutton-badge-button.js&quot;/&gt;</span>
<a href="#l1.14"></a><span id="l1.14"> &lt;!-- panelUI.js is for the appmenus. --&gt;</span>
<a href="#l1.15"></a><span id="l1.15"> &lt;script src=&quot;chrome://messenger/content/customizableui/panelUI.js&quot;/&gt;</span>
<a href="#l1.16"></a><span id="l1.16"> #ifdef XP_MACOSX</span>
<a href="#l1.17"></a><span id="l1.17"> &lt;script src=&quot;chrome://messenger/content/macMessengerMenu.js&quot;/&gt;</span>
<a href="#l1.18"></a><span id="l1.18"> &lt;script src=&quot;chrome://global/content/macWindowMenu.js&quot;/&gt;</span>
<a href="#l1.19"></a><span id="l1.19"> #endif</span>
<a href="#l1.20"></a><span id="l1.20"> </span>
<a href="#l1.21"></a><span id="l1.21" class="difflineat">@@ -389,30 +390,40 @@</span>
<a href="#l1.22"></a><span id="l1.22"> #endif</span>
<a href="#l1.23"></a><span id="l1.23">   &lt;/hbox&gt;</span>
<a href="#l1.24"></a><span id="l1.24"> &lt;/vbox&gt;</span>
<a href="#l1.25"></a><span id="l1.25"> </span>
<a href="#l1.26"></a><span id="l1.26">   &lt;!-- navigation-toolbox with main menubar and tabs toolbar --&gt;</span>
<a href="#l1.27"></a><span id="l1.27"> #include mainNavigationToolbox.inc.xul</span>
<a href="#l1.28"></a><span id="l1.28"> </span>
<a href="#l1.29"></a><span id="l1.29">     &lt;toolbar id=&quot;tabs-toolbar&quot; class=&quot;chromeclass-toolbar&quot;&gt;</span>
<a href="#l1.30"></a><span id="l1.30" class="difflineminus">-      &lt;!-- class tabmail-tabs is unused and only maintained for add-ons. --&gt;</span>
<a href="#l1.31"></a><span id="l1.31" class="difflineminus">-      &lt;tabs flex=&quot;1&quot;</span>
<a href="#l1.32"></a><span id="l1.32" class="difflineminus">-            id=&quot;tabmail-tabs&quot;</span>
<a href="#l1.33"></a><span id="l1.33" class="difflineplus">+      &lt;tabs is=&quot;tabmail-tabs&quot; id=&quot;tabmail-tabs&quot;</span>
<a href="#l1.34"></a><span id="l1.34" class="difflineplus">+            flex=&quot;1&quot;</span>
<a href="#l1.35"></a><span id="l1.35">             align=&quot;end&quot;</span>
<a href="#l1.36"></a><span id="l1.36">             setfocus=&quot;false&quot;</span>
<a href="#l1.37"></a><span id="l1.37">             onclick=&quot;document.getElementById('tabmail').onTabClick(event);&quot;</span>
<a href="#l1.38"></a><span id="l1.38" class="difflineminus">-            class=&quot;tabmail-tabs&quot;</span>
<a href="#l1.39"></a><span id="l1.39">             tooltip=&quot;tabmail-tabs-tooltip&quot;</span>
<a href="#l1.40"></a><span id="l1.40">             alltabsbutton=&quot;alltabs-button&quot;</span>
<a href="#l1.41"></a><span id="l1.41">             collapsetoolbar=&quot;tabs-toolbar&quot;</span>
<a href="#l1.42"></a><span id="l1.42" class="difflineminus">-            tabtoolbar=&quot;tabbar-toolbar&quot;&gt;</span>
<a href="#l1.43"></a><span id="l1.43" class="difflineminus">-            &lt;tab is=&quot;tabmail-tab&quot; selected=&quot;true&quot; validate=&quot;never&quot; type=&quot;folder&quot;</span>
<a href="#l1.44"></a><span id="l1.44" class="difflineminus">-                 maxwidth=&quot;250&quot; width=&quot;0&quot; minwidth=&quot;100&quot; flex=&quot;100&quot;</span>
<a href="#l1.45"></a><span id="l1.45" class="difflineminus">-                 class=&quot;tabmail-tab&quot; crop=&quot;end&quot; linkedpanel=&quot;mailContent&quot;/&gt;</span>
<a href="#l1.46"></a><span id="l1.46" class="difflineplus">+            tabtoolbar=&quot;tabbar-toolbar&quot;</span>
<a href="#l1.47"></a><span id="l1.47" class="difflineplus">+            context=&quot;toolbar-context-menu&quot;&gt;</span>
<a href="#l1.48"></a><span id="l1.48" class="difflineplus">+        &lt;hbox class=&quot;tab-drop-indicator-box&quot;&gt;</span>
<a href="#l1.49"></a><span id="l1.49" class="difflineplus">+          &lt;image class=&quot;tab-drop-indicator&quot; hidden=&quot;true&quot;/&gt;</span>
<a href="#l1.50"></a><span id="l1.50" class="difflineplus">+        &lt;/hbox&gt;</span>
<a href="#l1.51"></a><span id="l1.51" class="difflineplus">+        &lt;arrowscrollbox class=&quot;tabmail-arrowscrollbox&quot;</span>
<a href="#l1.52"></a><span id="l1.52" class="difflineplus">+                        orient=&quot;horizontal&quot;</span>
<a href="#l1.53"></a><span id="l1.53" class="difflineplus">+                        flex=&quot;1&quot;</span>
<a href="#l1.54"></a><span id="l1.54" class="difflineplus">+                        style=&quot;min-width: 1px;&quot;&gt;</span>
<a href="#l1.55"></a><span id="l1.55" class="difflineplus">+          &lt;tab is=&quot;tabmail-tab&quot; selected=&quot;true&quot; validate=&quot;never&quot; type=&quot;folder&quot;</span>
<a href="#l1.56"></a><span id="l1.56" class="difflineplus">+               maxwidth=&quot;250&quot; width=&quot;0&quot; minwidth=&quot;100&quot; flex=&quot;100&quot;</span>
<a href="#l1.57"></a><span id="l1.57" class="difflineplus">+               class=&quot;tabmail-tab&quot; crop=&quot;end&quot; linkedpanel=&quot;mailContent&quot;/&gt;</span>
<a href="#l1.58"></a><span id="l1.58" class="difflineplus">+        &lt;/arrowscrollbox&gt;</span>
<a href="#l1.59"></a><span id="l1.59" class="difflineplus">+        &lt;hbox class=&quot;tabs-closebutton-box&quot; align=&quot;center&quot; pack=&quot;end&quot;&gt;</span>
<a href="#l1.60"></a><span id="l1.60" class="difflineplus">+          &lt;image class=&quot;close-icon tabs-closebutton&quot;&gt;&lt;/image&gt;</span>
<a href="#l1.61"></a><span id="l1.61" class="difflineplus">+        &lt;/hbox&gt;</span>
<a href="#l1.62"></a><span id="l1.62">       &lt;/tabs&gt;</span>
<a href="#l1.63"></a><span id="l1.63"> </span>
<a href="#l1.64"></a><span id="l1.64">       &lt;!-- Use of this element for extensions is deprecated! Current</span>
<a href="#l1.65"></a><span id="l1.65">            extensions should add to #mail-toolbox and add a toolbar item to</span>
<a href="#l1.66"></a><span id="l1.66">            #tabbar-toolbar below. --&gt;</span>
<a href="#l1.67"></a><span id="l1.67">       &lt;hbox id=&quot;tabmail-buttons&quot;/&gt;</span>
<a href="#l1.68"></a><span id="l1.68"> </span>
<a href="#l1.69"></a><span id="l1.69">       &lt;box id=&quot;notification-popup-box&quot;</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l2.1"></a><span id="l2.1">new file mode 100644</span>
<a href="#l2.2"></a><span id="l2.2" class="difflineminus">--- /dev/null</span>
<a href="#l2.3"></a><span id="l2.3" class="difflineplus">+++ b/mail/base/content/tabmail-tabs.js</span>
<a href="#l2.4"></a><span id="l2.4" class="difflineat">@@ -0,0 +1,738 @@</span>
<a href="#l2.5"></a><span id="l2.5" class="difflineplus">+/* This Source Code Form is subject to the terms of the Mozilla Public</span>
<a href="#l2.6"></a><span id="l2.6" class="difflineplus">+  * License, v. 2.0. If a copy of the MPL was not distributed with this</span>
<a href="#l2.7"></a><span id="l2.7" class="difflineplus">+  * file, You can obtain one at http://mozilla.org/MPL/2.0/. */</span>
<a href="#l2.8"></a><span id="l2.8" class="difflineplus">+</span>
<a href="#l2.9"></a><span id="l2.9" class="difflineplus">+&quot;use strict&quot;;</span>
<a href="#l2.10"></a><span id="l2.10" class="difflineplus">+</span>
<a href="#l2.11"></a><span id="l2.11" class="difflineplus">+/* global MozElements, MozXULElement */</span>
<a href="#l2.12"></a><span id="l2.12" class="difflineplus">+</span>
<a href="#l2.13"></a><span id="l2.13" class="difflineplus">+{</span>
<a href="#l2.14"></a><span id="l2.14" class="difflineplus">+  const {Services} = ChromeUtils.import(&quot;resource://gre/modules/Services.jsm&quot;);</span>
<a href="#l2.15"></a><span id="l2.15" class="difflineplus">+</span>
<a href="#l2.16"></a><span id="l2.16" class="difflineplus">+  /**</span>
<a href="#l2.17"></a><span id="l2.17" class="difflineplus">+   * The MozTabs widget holds all the tabs for the main tab UI.</span>
<a href="#l2.18"></a><span id="l2.18" class="difflineplus">+   * @extends {MozTabs}</span>
<a href="#l2.19"></a><span id="l2.19" class="difflineplus">+   */</span>
<a href="#l2.20"></a><span id="l2.20" class="difflineplus">+  class MozTabmailTabs extends customElements.get(&quot;tabs&quot;) {</span>
<a href="#l2.21"></a><span id="l2.21" class="difflineplus">+    constructor() {</span>
<a href="#l2.22"></a><span id="l2.22" class="difflineplus">+      super();</span>
<a href="#l2.23"></a><span id="l2.23" class="difflineplus">+</span>
<a href="#l2.24"></a><span id="l2.24" class="difflineplus">+      this.addEventListener(&quot;dragstart&quot;, (event) =&gt; {</span>
<a href="#l2.25"></a><span id="l2.25" class="difflineplus">+        let draggedTab = this._getDragTargetTab(event);</span>
<a href="#l2.26"></a><span id="l2.26" class="difflineplus">+</span>
<a href="#l2.27"></a><span id="l2.27" class="difflineplus">+        if (!draggedTab)</span>
<a href="#l2.28"></a><span id="l2.28" class="difflineplus">+          return;</span>
<a href="#l2.29"></a><span id="l2.29" class="difflineplus">+</span>
<a href="#l2.30"></a><span id="l2.30" class="difflineplus">+        let tab = this.tabmail.selectedTab;</span>
<a href="#l2.31"></a><span id="l2.31" class="difflineplus">+</span>
<a href="#l2.32"></a><span id="l2.32" class="difflineplus">+        if (!tab || !tab.canClose)</span>
<a href="#l2.33"></a><span id="l2.33" class="difflineplus">+          return;</span>
<a href="#l2.34"></a><span id="l2.34" class="difflineplus">+</span>
<a href="#l2.35"></a><span id="l2.35" class="difflineplus">+        let dt = event.dataTransfer;</span>
<a href="#l2.36"></a><span id="l2.36" class="difflineplus">+</span>
<a href="#l2.37"></a><span id="l2.37" class="difflineplus">+        // If we drag within the same window, we use the tab directly</span>
<a href="#l2.38"></a><span id="l2.38" class="difflineplus">+        dt.mozSetDataAt(&quot;application/x-moz-tabmail-tab&quot;, draggedTab, 0);</span>
<a href="#l2.39"></a><span id="l2.39" class="difflineplus">+</span>
<a href="#l2.40"></a><span id="l2.40" class="difflineplus">+        // Otherwise we use session restore &amp; JSON to migrate the tab.</span>
<a href="#l2.41"></a><span id="l2.41" class="difflineplus">+        let uri = this.tabmail.persistTab(tab);</span>
<a href="#l2.42"></a><span id="l2.42" class="difflineplus">+</span>
<a href="#l2.43"></a><span id="l2.43" class="difflineplus">+        // In case the tab implements session restore, we use JSON to convert</span>
<a href="#l2.44"></a><span id="l2.44" class="difflineplus">+        // it into a string.</span>
<a href="#l2.45"></a><span id="l2.45" class="difflineplus">+        //</span>
<a href="#l2.46"></a><span id="l2.46" class="difflineplus">+        // If a tab does not support session restore it returns null. We can't</span>
<a href="#l2.47"></a><span id="l2.47" class="difflineplus">+        // moved such tabs to a new window. However moving them within the same</span>
<a href="#l2.48"></a><span id="l2.48" class="difflineplus">+        // window works perfectly fine.</span>
<a href="#l2.49"></a><span id="l2.49" class="difflineplus">+        if (uri)</span>
<a href="#l2.50"></a><span id="l2.50" class="difflineplus">+          uri = JSON.stringify(uri);</span>
<a href="#l2.51"></a><span id="l2.51" class="difflineplus">+</span>
<a href="#l2.52"></a><span id="l2.52" class="difflineplus">+        dt.mozSetDataAt(&quot;application/x-moz-tabmail-json&quot;, uri, 0);</span>
<a href="#l2.53"></a><span id="l2.53" class="difflineplus">+</span>
<a href="#l2.54"></a><span id="l2.54" class="difflineplus">+        dt.mozCursor = &quot;default&quot;;</span>
<a href="#l2.55"></a><span id="l2.55" class="difflineplus">+</span>
<a href="#l2.56"></a><span id="l2.56" class="difflineplus">+        // Create Drag Image.</span>
<a href="#l2.57"></a><span id="l2.57" class="difflineplus">+        let panel = document.getElementById(&quot;tabpanelcontainer&quot;);</span>
<a href="#l2.58"></a><span id="l2.58" class="difflineplus">+</span>
<a href="#l2.59"></a><span id="l2.59" class="difflineplus">+        let thumbnail = document.createElementNS(&quot;http://www.w3.org/1999/xhtml&quot;,</span>
<a href="#l2.60"></a><span id="l2.60" class="difflineplus">+                                                 &quot;canvas&quot;);</span>
<a href="#l2.61"></a><span id="l2.61" class="difflineplus">+        thumbnail.width = Math.ceil(screen.availWidth / 5.75);</span>
<a href="#l2.62"></a><span id="l2.62" class="difflineplus">+        thumbnail.height = Math.round(thumbnail.width * 0.5625);</span>
<a href="#l2.63"></a><span id="l2.63" class="difflineplus">+</span>
<a href="#l2.64"></a><span id="l2.64" class="difflineplus">+        let snippetWidth = panel.getBoundingClientRect().width * .6;</span>
<a href="#l2.65"></a><span id="l2.65" class="difflineplus">+        let scale = thumbnail.width / snippetWidth;</span>
<a href="#l2.66"></a><span id="l2.66" class="difflineplus">+</span>
<a href="#l2.67"></a><span id="l2.67" class="difflineplus">+        let ctx = thumbnail.getContext(&quot;2d&quot;);</span>
<a href="#l2.68"></a><span id="l2.68" class="difflineplus">+</span>
<a href="#l2.69"></a><span id="l2.69" class="difflineplus">+        ctx.scale(scale, scale);</span>
<a href="#l2.70"></a><span id="l2.70" class="difflineplus">+</span>
<a href="#l2.71"></a><span id="l2.71" class="difflineplus">+        ctx.drawWindow(window,</span>
<a href="#l2.72"></a><span id="l2.72" class="difflineplus">+          panel.screenX - window.mozInnerScreenX,</span>
<a href="#l2.73"></a><span id="l2.73" class="difflineplus">+          panel.screenY - window.mozInnerScreenY,</span>
<a href="#l2.74"></a><span id="l2.74" class="difflineplus">+          snippetWidth,</span>
<a href="#l2.75"></a><span id="l2.75" class="difflineplus">+          snippetWidth * 0.5625,</span>
<a href="#l2.76"></a><span id="l2.76" class="difflineplus">+          &quot;rgb(255,255,255)&quot;);</span>
<a href="#l2.77"></a><span id="l2.77" class="difflineplus">+</span>
<a href="#l2.78"></a><span id="l2.78" class="difflineplus">+        dt = event.dataTransfer;</span>
<a href="#l2.79"></a><span id="l2.79" class="difflineplus">+        dt.setDragImage(thumbnail, 0, 0);</span>
<a href="#l2.80"></a><span id="l2.80" class="difflineplus">+</span>
<a href="#l2.81"></a><span id="l2.81" class="difflineplus">+        event.stopPropagation();</span>
<a href="#l2.82"></a><span id="l2.82" class="difflineplus">+      });</span>
<a href="#l2.83"></a><span id="l2.83" class="difflineplus">+</span>
<a href="#l2.84"></a><span id="l2.84" class="difflineplus">+      this.addEventListener(&quot;dragover&quot;, (event) =&gt; {</span>
<a href="#l2.85"></a><span id="l2.85" class="difflineplus">+        let dt = event.dataTransfer;</span>
<a href="#l2.86"></a><span id="l2.86" class="difflineplus">+</span>
<a href="#l2.87"></a><span id="l2.87" class="difflineplus">+        if (dt.mozItemCount == 0)</span>
<a href="#l2.88"></a><span id="l2.88" class="difflineplus">+          return;</span>
<a href="#l2.89"></a><span id="l2.89" class="difflineplus">+</span>
<a href="#l2.90"></a><span id="l2.90" class="difflineplus">+        if (dt.mozGetDataAt(&quot;text/toolbarwrapper-id/messengerWindow&quot;, 0) !=</span>
<a href="#l2.91"></a><span id="l2.91" class="difflineplus">+            null) {</span>
<a href="#l2.92"></a><span id="l2.92" class="difflineplus">+          event.preventDefault();</span>
<a href="#l2.93"></a><span id="l2.93" class="difflineplus">+          event.stopPropagation();</span>
<a href="#l2.94"></a><span id="l2.94" class="difflineplus">+</span>
<a href="#l2.95"></a><span id="l2.95" class="difflineplus">+          // Dispatch event to the toolbar</span>
<a href="#l2.96"></a><span id="l2.96" class="difflineplus">+          let evt = document.createEvent(&quot;DragEvent&quot;);</span>
<a href="#l2.97"></a><span id="l2.97" class="difflineplus">+          evt.initDragEvent(&quot;dragover&quot;, true, true, window, 0, 0, 0, 0, 0,</span>
<a href="#l2.98"></a><span id="l2.98" class="difflineplus">+            false, false, false, false, 0, null,</span>
<a href="#l2.99"></a><span id="l2.99" class="difflineplus">+            event.dataTransfer);</span>
<a href="#l2.100"></a><span id="l2.100" class="difflineplus">+</span>
<a href="#l2.101"></a><span id="l2.101" class="difflineplus">+          if (this.mToolbar.firstChild) {</span>
<a href="#l2.102"></a><span id="l2.102" class="difflineplus">+            this.mToolbar.firstChild.dispatchEvent(evt);</span>
<a href="#l2.103"></a><span id="l2.103" class="difflineplus">+          } else {</span>
<a href="#l2.104"></a><span id="l2.104" class="difflineplus">+            this.mToolbar.dispatchEvent(evt);</span>
<a href="#l2.105"></a><span id="l2.105" class="difflineplus">+          }</span>
<a href="#l2.106"></a><span id="l2.106" class="difflineplus">+</span>
<a href="#l2.107"></a><span id="l2.107" class="difflineplus">+          return;</span>
<a href="#l2.108"></a><span id="l2.108" class="difflineplus">+        }</span>
<a href="#l2.109"></a><span id="l2.109" class="difflineplus">+</span>
<a href="#l2.110"></a><span id="l2.110" class="difflineplus">+        // Bug 516247:</span>
<a href="#l2.111"></a><span id="l2.111" class="difflineplus">+        // in case the user is dragging something else than a tab, and</span>
<a href="#l2.112"></a><span id="l2.112" class="difflineplus">+        // keeps hovering over a tab, we assume he wants to switch to this tab.</span>
<a href="#l2.113"></a><span id="l2.113" class="difflineplus">+        if ((dt.mozTypesAt(0)[0] != &quot;application/x-moz-tabmail-tab&quot;) &amp;&amp;</span>
<a href="#l2.114"></a><span id="l2.114" class="difflineplus">+            (dt.mozTypesAt(0)[1] != &quot;application/x-moz-tabmail-json&quot;)) {</span>
<a href="#l2.115"></a><span id="l2.115" class="difflineplus">+          let tab = this._getDragTargetTab(event);</span>
<a href="#l2.116"></a><span id="l2.116" class="difflineplus">+</span>
<a href="#l2.117"></a><span id="l2.117" class="difflineplus">+          if (!tab)</span>
<a href="#l2.118"></a><span id="l2.118" class="difflineplus">+            return;</span>
<a href="#l2.119"></a><span id="l2.119" class="difflineplus">+</span>
<a href="#l2.120"></a><span id="l2.120" class="difflineplus">+          event.preventDefault();</span>
<a href="#l2.121"></a><span id="l2.121" class="difflineplus">+          event.stopPropagation();</span>
<a href="#l2.122"></a><span id="l2.122" class="difflineplus">+</span>
<a href="#l2.123"></a><span id="l2.123" class="difflineplus">+          if (!this._dragTime) {</span>
<a href="#l2.124"></a><span id="l2.124" class="difflineplus">+            this._dragTime = Date.now();</span>
<a href="#l2.125"></a><span id="l2.125" class="difflineplus">+            return;</span>
<a href="#l2.126"></a><span id="l2.126" class="difflineplus">+          }</span>
<a href="#l2.127"></a><span id="l2.127" class="difflineplus">+</span>
<a href="#l2.128"></a><span id="l2.128" class="difflineplus">+          if (Date.now() &lt;= this._dragTime + this._dragOverDelay)</span>
<a href="#l2.129"></a><span id="l2.129" class="difflineplus">+            return;</span>
<a href="#l2.130"></a><span id="l2.130" class="difflineplus">+</span>
<a href="#l2.131"></a><span id="l2.131" class="difflineplus">+          if (this.tabmail.tabContainer.selectedItem == tab)</span>
<a href="#l2.132"></a><span id="l2.132" class="difflineplus">+            return;</span>
<a href="#l2.133"></a><span id="l2.133" class="difflineplus">+</span>
<a href="#l2.134"></a><span id="l2.134" class="difflineplus">+          this.tabmail.tabContainer.selectedItem = tab;</span>
<a href="#l2.135"></a><span id="l2.135" class="difflineplus">+</span>
<a href="#l2.136"></a><span id="l2.136" class="difflineplus">+          return;</span>
<a href="#l2.137"></a><span id="l2.137" class="difflineplus">+        }</span>
<a href="#l2.138"></a><span id="l2.138" class="difflineplus">+</span>
<a href="#l2.139"></a><span id="l2.139" class="difflineplus">+        // As some tabs do not support session restore they can't be</span>
<a href="#l2.140"></a><span id="l2.140" class="difflineplus">+        // moved to a different or new window. We should not show</span>
<a href="#l2.141"></a><span id="l2.141" class="difflineplus">+        // a dropmarker in such a case.</span>
<a href="#l2.142"></a><span id="l2.142" class="difflineplus">+        if (!dt.mozGetDataAt(&quot;application/x-moz-tabmail-json&quot;, 0)) {</span>
<a href="#l2.143"></a><span id="l2.143" class="difflineplus">+          let draggedTab = dt.mozGetDataAt(&quot;application/x-moz-tabmail-tab&quot;, 0);</span>
<a href="#l2.144"></a><span id="l2.144" class="difflineplus">+</span>
<a href="#l2.145"></a><span id="l2.145" class="difflineplus">+          if (!draggedTab)</span>
<a href="#l2.146"></a><span id="l2.146" class="difflineplus">+            return;</span>
<a href="#l2.147"></a><span id="l2.147" class="difflineplus">+</span>
<a href="#l2.148"></a><span id="l2.148" class="difflineplus">+          if (this.tabmail.tabContainer.getIndexOfItem(draggedTab) == -1)</span>
<a href="#l2.149"></a><span id="l2.149" class="difflineplus">+            return;</span>
<a href="#l2.150"></a><span id="l2.150" class="difflineplus">+        }</span>
<a href="#l2.151"></a><span id="l2.151" class="difflineplus">+</span>
<a href="#l2.152"></a><span id="l2.152" class="difflineplus">+        dt.effectAllowed = &quot;copyMove&quot;;</span>
<a href="#l2.153"></a><span id="l2.153" class="difflineplus">+</span>
<a href="#l2.154"></a><span id="l2.154" class="difflineplus">+        event.preventDefault();</span>
<a href="#l2.155"></a><span id="l2.155" class="difflineplus">+        event.stopPropagation();</span>
<a href="#l2.156"></a><span id="l2.156" class="difflineplus">+</span>
<a href="#l2.157"></a><span id="l2.157" class="difflineplus">+        let ltr = (window.getComputedStyle(this).direction == &quot;ltr&quot;);</span>
<a href="#l2.158"></a><span id="l2.158" class="difflineplus">+        let ind = this._tabDropIndicator;</span>
<a href="#l2.159"></a><span id="l2.159" class="difflineplus">+</span>
<a href="#l2.160"></a><span id="l2.160" class="difflineplus">+        // Let's scroll</span>
<a href="#l2.161"></a><span id="l2.161" class="difflineplus">+        if (this.hasAttribute(&quot;overflow&quot;)) {</span>
<a href="#l2.162"></a><span id="l2.162" class="difflineplus">+          let target = event.originalTarget.getAttribute(&quot;anonid&quot;);</span>
<a href="#l2.163"></a><span id="l2.163" class="difflineplus">+</span>
<a href="#l2.164"></a><span id="l2.164" class="difflineplus">+          let pixelsToScroll = 0;</span>
<a href="#l2.165"></a><span id="l2.165" class="difflineplus">+</span>
<a href="#l2.166"></a><span id="l2.166" class="difflineplus">+          if (target == &quot;scrollbutton-up&quot;)</span>
<a href="#l2.167"></a><span id="l2.167" class="difflineplus">+            pixelsToScroll = this.arrowScrollbox.scrollIncrement;</span>
<a href="#l2.168"></a><span id="l2.168" class="difflineplus">+</span>
<a href="#l2.169"></a><span id="l2.169" class="difflineplus">+          if (target == &quot;scrollbutton-down&quot;)</span>
<a href="#l2.170"></a><span id="l2.170" class="difflineplus">+            pixelsToScroll = this.arrowScrollbox.scrollIncrement * -1;</span>
<a href="#l2.171"></a><span id="l2.171" class="difflineplus">+</span>
<a href="#l2.172"></a><span id="l2.172" class="difflineplus">+          if (ltr)</span>
<a href="#l2.173"></a><span id="l2.173" class="difflineplus">+            pixelsToScroll = pixelsToScroll * -1;</span>
<a href="#l2.174"></a><span id="l2.174" class="difflineplus">+</span>
<a href="#l2.175"></a><span id="l2.175" class="difflineplus">+          if (pixelsToScroll) {</span>
<a href="#l2.176"></a><span id="l2.176" class="difflineplus">+            // Hide Indicator while Scrolling</span>
<a href="#l2.177"></a><span id="l2.177" class="difflineplus">+            ind.setAttribute(&quot;hidden&quot;, &quot;true&quot;);</span>
<a href="#l2.178"></a><span id="l2.178" class="difflineplus">+            this.arrowScrollbox.scrollByPixels(pixelsToScroll);</span>
<a href="#l2.179"></a><span id="l2.179" class="difflineplus">+            return;</span>
<a href="#l2.180"></a><span id="l2.180" class="difflineplus">+          }</span>
<a href="#l2.181"></a><span id="l2.181" class="difflineplus">+        }</span>
<a href="#l2.182"></a><span id="l2.182" class="difflineplus">+</span>
<a href="#l2.183"></a><span id="l2.183" class="difflineplus">+        let newIndex = this._getDropIndex(event);</span>
<a href="#l2.184"></a><span id="l2.184" class="difflineplus">+</span>
<a href="#l2.185"></a><span id="l2.185" class="difflineplus">+        // Fix the DropIndex in case it points to tab that can't be closed.</span>
<a href="#l2.186"></a><span id="l2.186" class="difflineplus">+        let tabInfo = this.tabmail.tabInfo;</span>
<a href="#l2.187"></a><span id="l2.187" class="difflineplus">+</span>
<a href="#l2.188"></a><span id="l2.188" class="difflineplus">+        while ((newIndex &lt; tabInfo.length) &amp;&amp; !(tabInfo[newIndex].canClose)) {</span>
<a href="#l2.189"></a><span id="l2.189" class="difflineplus">+          newIndex++;</span>
<a href="#l2.190"></a><span id="l2.190" class="difflineplus">+        }</span>
<a href="#l2.191"></a><span id="l2.191" class="difflineplus">+</span>
<a href="#l2.192"></a><span id="l2.192" class="difflineplus">+        let scrollRect = this.arrowScrollbox.scrollClientRect;</span>
<a href="#l2.193"></a><span id="l2.193" class="difflineplus">+        let rect = this.getBoundingClientRect();</span>
<a href="#l2.194"></a><span id="l2.194" class="difflineplus">+        let minMargin = scrollRect.left - rect.left;</span>
<a href="#l2.195"></a><span id="l2.195" class="difflineplus">+        let maxMargin = Math.min(minMargin + scrollRect.width, scrollRect.right);</span>
<a href="#l2.196"></a><span id="l2.196" class="difflineplus">+</span>
<a href="#l2.197"></a><span id="l2.197" class="difflineplus">+        if (!ltr)</span>
<a href="#l2.198"></a><span id="l2.198" class="difflineplus">+          [minMargin, maxMargin] = [this.clientWidth - maxMargin, this.clientWidth - minMargin];</span>
<a href="#l2.199"></a><span id="l2.199" class="difflineplus">+</span>
<a href="#l2.200"></a><span id="l2.200" class="difflineplus">+        let newMargin;</span>
<a href="#l2.201"></a><span id="l2.201" class="difflineplus">+        let tabs = this.allTabs;</span>
<a href="#l2.202"></a><span id="l2.202" class="difflineplus">+</span>
<a href="#l2.203"></a><span id="l2.203" class="difflineplus">+        if (newIndex == tabs.length) {</span>
<a href="#l2.204"></a><span id="l2.204" class="difflineplus">+          let tabRect = tabs[newIndex - 1].getBoundingClientRect();</span>
<a href="#l2.205"></a><span id="l2.205" class="difflineplus">+</span>
<a href="#l2.206"></a><span id="l2.206" class="difflineplus">+          if (ltr)</span>
<a href="#l2.207"></a><span id="l2.207" class="difflineplus">+            newMargin = tabRect.right - rect.left;</span>
<a href="#l2.208"></a><span id="l2.208" class="difflineplus">+          else</span>
<a href="#l2.209"></a><span id="l2.209" class="difflineplus">+            newMargin = rect.right - tabRect.left;</span>
<a href="#l2.210"></a><span id="l2.210" class="difflineplus">+        } else {</span>
<a href="#l2.211"></a><span id="l2.211" class="difflineplus">+          let tabRect = tabs[newIndex].getBoundingClientRect();</span>
<a href="#l2.212"></a><span id="l2.212" class="difflineplus">+</span>
<a href="#l2.213"></a><span id="l2.213" class="difflineplus">+          if (ltr)</span>
<a href="#l2.214"></a><span id="l2.214" class="difflineplus">+            newMargin = tabRect.left - rect.left;</span>
<a href="#l2.215"></a><span id="l2.215" class="difflineplus">+          else</span>
<a href="#l2.216"></a><span id="l2.216" class="difflineplus">+            newMargin = rect.right - tabRect.right;</span>
<a href="#l2.217"></a><span id="l2.217" class="difflineplus">+        }</span>
<a href="#l2.218"></a><span id="l2.218" class="difflineplus">+</span>
<a href="#l2.219"></a><span id="l2.219" class="difflineplus">+        ind.setAttribute(&quot;hidden&quot;, &quot;false&quot;);</span>
<a href="#l2.220"></a><span id="l2.220" class="difflineplus">+</span>
<a href="#l2.221"></a><span id="l2.221" class="difflineplus">+        newMargin += ind.clientWidth / 2;</span>
<a href="#l2.222"></a><span id="l2.222" class="difflineplus">+        if (!ltr)</span>
<a href="#l2.223"></a><span id="l2.223" class="difflineplus">+          newMargin *= -1;</span>
<a href="#l2.224"></a><span id="l2.224" class="difflineplus">+</span>
<a href="#l2.225"></a><span id="l2.225" class="difflineplus">+        ind.style.transform = &quot;translate(&quot; + Math.round(newMargin) + &quot;px)&quot;;</span>
<a href="#l2.226"></a><span id="l2.226" class="difflineplus">+        ind.style.marginInlineStart = (-ind.clientWidth) + &quot;px&quot;;</span>
<a href="#l2.227"></a><span id="l2.227" class="difflineplus">+      });</span>
<a href="#l2.228"></a><span id="l2.228" class="difflineplus">+</span>
<a href="#l2.229"></a><span id="l2.229" class="difflineplus">+      this.addEventListener(&quot;drop&quot;, (event) =&gt; {</span>
<a href="#l2.230"></a><span id="l2.230" class="difflineplus">+        let dt = event.dataTransfer;</span>
<a href="#l2.231"></a><span id="l2.231" class="difflineplus">+</span>
<a href="#l2.232"></a><span id="l2.232" class="difflineplus">+        if (dt.mozItemCount != 1)</span>
<a href="#l2.233"></a><span id="l2.233" class="difflineplus">+          return;</span>
<a href="#l2.234"></a><span id="l2.234" class="difflineplus">+</span>
<a href="#l2.235"></a><span id="l2.235" class="difflineplus">+        // If we're dragging a toolbar button, let's prepend the tabs toolbar</span>
<a href="#l2.236"></a><span id="l2.236" class="difflineplus">+        // with that button, and then bail out.</span>
<a href="#l2.237"></a><span id="l2.237" class="difflineplus">+        let buttonId = dt.mozGetDataAt(&quot;text/toolbarwrapper-id/messengerWindow&quot;, 0);</span>
<a href="#l2.238"></a><span id="l2.238" class="difflineplus">+</span>
<a href="#l2.239"></a><span id="l2.239" class="difflineplus">+        if (buttonId != null) {</span>
<a href="#l2.240"></a><span id="l2.240" class="difflineplus">+          event.preventDefault();</span>
<a href="#l2.241"></a><span id="l2.241" class="difflineplus">+          event.stopPropagation();</span>
<a href="#l2.242"></a><span id="l2.242" class="difflineplus">+</span>
<a href="#l2.243"></a><span id="l2.243" class="difflineplus">+          let evt = document.createEvent(&quot;DragEvent&quot;);</span>
<a href="#l2.244"></a><span id="l2.244" class="difflineplus">+          evt.initDragEvent(&quot;drop&quot;, true, true, window, 0, 0, 0, 0, 0,</span>
<a href="#l2.245"></a><span id="l2.245" class="difflineplus">+            false, false, false, false, 0, null,</span>
<a href="#l2.246"></a><span id="l2.246" class="difflineplus">+            event.dataTransfer);</span>
<a href="#l2.247"></a><span id="l2.247" class="difflineplus">+</span>
<a href="#l2.248"></a><span id="l2.248" class="difflineplus">+          if (this.mToolbar.firstChild) {</span>
<a href="#l2.249"></a><span id="l2.249" class="difflineplus">+            this.mToolbar.firstChild.dispatchEvent(evt);</span>
<a href="#l2.250"></a><span id="l2.250" class="difflineplus">+          } else {</span>
<a href="#l2.251"></a><span id="l2.251" class="difflineplus">+            this.mToolbar.dispatchEvent(evt);</span>
<a href="#l2.252"></a><span id="l2.252" class="difflineplus">+          }</span>
<a href="#l2.253"></a><span id="l2.253" class="difflineplus">+</span>
<a href="#l2.254"></a><span id="l2.254" class="difflineplus">+          return;</span>
<a href="#l2.255"></a><span id="l2.255" class="difflineplus">+        }</span>
<a href="#l2.256"></a><span id="l2.256" class="difflineplus">+</span>
<a href="#l2.257"></a><span id="l2.257" class="difflineplus">+        let draggedTab = dt.mozGetDataAt(&quot;application/x-moz-tabmail-tab&quot;, 0);</span>
<a href="#l2.258"></a><span id="l2.258" class="difflineplus">+</span>
<a href="#l2.259"></a><span id="l2.259" class="difflineplus">+        if (!draggedTab)</span>
<a href="#l2.260"></a><span id="l2.260" class="difflineplus">+          return;</span>
<a href="#l2.261"></a><span id="l2.261" class="difflineplus">+</span>
<a href="#l2.262"></a><span id="l2.262" class="difflineplus">+        event.stopPropagation();</span>
<a href="#l2.263"></a><span id="l2.263" class="difflineplus">+        this._tabDropIndicator.setAttribute(&quot;hidden&quot;, &quot;true&quot;);</span>
<a href="#l2.264"></a><span id="l2.264" class="difflineplus">+</span>
<a href="#l2.265"></a><span id="l2.265" class="difflineplus">+        // Is the tab one of our children?</span>
<a href="#l2.266"></a><span id="l2.266" class="difflineplus">+        if (this.tabmail.tabContainer.getIndexOfItem(draggedTab) == -1) {</span>
<a href="#l2.267"></a><span id="l2.267" class="difflineplus">+          // It's a tab from an other window, so we have to trigger session</span>
<a href="#l2.268"></a><span id="l2.268" class="difflineplus">+          // restore to get our tab</span>
<a href="#l2.269"></a><span id="l2.269" class="difflineplus">+</span>
<a href="#l2.270"></a><span id="l2.270" class="difflineplus">+          let tabmail2 = draggedTab.ownerDocument.getElementById(&quot;tabmail&quot;);</span>
<a href="#l2.271"></a><span id="l2.271" class="difflineplus">+          if (!tabmail2)</span>
<a href="#l2.272"></a><span id="l2.272" class="difflineplus">+            return;</span>
<a href="#l2.273"></a><span id="l2.273" class="difflineplus">+</span>
<a href="#l2.274"></a><span id="l2.274" class="difflineplus">+          let draggedJson = dt.mozGetDataAt(&quot;application/x-moz-tabmail-json&quot;, 0);</span>
<a href="#l2.275"></a><span id="l2.275" class="difflineplus">+          if (!draggedJson)</span>
<a href="#l2.276"></a><span id="l2.276" class="difflineplus">+            return;</span>
<a href="#l2.277"></a><span id="l2.277" class="difflineplus">+</span>
<a href="#l2.278"></a><span id="l2.278" class="difflineplus">+          draggedJson = JSON.parse(draggedJson);</span>
<a href="#l2.279"></a><span id="l2.279" class="difflineplus">+</span>
<a href="#l2.280"></a><span id="l2.280" class="difflineplus">+          // Some tab exist only once, so we have to gamble a bit. We close</span>
<a href="#l2.281"></a><span id="l2.281" class="difflineplus">+          // the tab and try to reopen it. If something fails the tab is gone.</span>
<a href="#l2.282"></a><span id="l2.282" class="difflineplus">+</span>
<a href="#l2.283"></a><span id="l2.283" class="difflineplus">+          tabmail2.closeTab(draggedTab, true);</span>
<a href="#l2.284"></a><span id="l2.284" class="difflineplus">+</span>
<a href="#l2.285"></a><span id="l2.285" class="difflineplus">+          if (!this.tabmail.restoreTab(draggedJson))</span>
<a href="#l2.286"></a><span id="l2.286" class="difflineplus">+            return;</span>
<a href="#l2.287"></a><span id="l2.287" class="difflineplus">+</span>
<a href="#l2.288"></a><span id="l2.288" class="difflineplus">+          draggedTab = this.tabmail.tabContainer.allTabs[</span>
<a href="#l2.289"></a><span id="l2.289" class="difflineplus">+            this.tabmail.tabContainer.allTabs.length - 1];</span>
<a href="#l2.290"></a><span id="l2.290" class="difflineplus">+        }</span>
<a href="#l2.291"></a><span id="l2.291" class="difflineplus">+</span>
<a href="#l2.292"></a><span id="l2.292" class="difflineplus">+        let idx = this._getDropIndex(event);</span>
<a href="#l2.293"></a><span id="l2.293" class="difflineplus">+</span>
<a href="#l2.294"></a><span id="l2.294" class="difflineplus">+        // Fix the DropIndex in case it points to tab that can't be closed</span>
<a href="#l2.295"></a><span id="l2.295" class="difflineplus">+        let tabInfo = this.tabmail.tabInfo;</span>
<a href="#l2.296"></a><span id="l2.296" class="difflineplus">+        while ((idx &lt; tabInfo.length) &amp;&amp; !(tabInfo[idx].canClose)) {</span>
<a href="#l2.297"></a><span id="l2.297" class="difflineplus">+          idx++;</span>
<a href="#l2.298"></a><span id="l2.298" class="difflineplus">+        }</span>
<a href="#l2.299"></a><span id="l2.299" class="difflineplus">+</span>
<a href="#l2.300"></a><span id="l2.300" class="difflineplus">+        this.tabmail.moveTabTo(draggedTab, idx);</span>
<a href="#l2.301"></a><span id="l2.301" class="difflineplus">+</span>
<a href="#l2.302"></a><span id="l2.302" class="difflineplus">+        this.tabmail.switchToTab(draggedTab);</span>
<a href="#l2.303"></a><span id="l2.303" class="difflineplus">+        this.tabmail.updateCurrentTab();</span>
<a href="#l2.304"></a><span id="l2.304" class="difflineplus">+      });</span>
<a href="#l2.305"></a><span id="l2.305" class="difflineplus">+</span>
<a href="#l2.306"></a><span id="l2.306" class="difflineplus">+      this.addEventListener(&quot;dragend&quot;, (event) =&gt; {</span>
<a href="#l2.307"></a><span id="l2.307" class="difflineplus">+        // Note: while this case is correctly handled here, this event</span>
<a href="#l2.308"></a><span id="l2.308" class="difflineplus">+        // isn't dispatched when the tab is moved within the tabstrip,</span>
<a href="#l2.309"></a><span id="l2.309" class="difflineplus">+        // see bug 460801.</span>
<a href="#l2.310"></a><span id="l2.310" class="difflineplus">+</span>
<a href="#l2.311"></a><span id="l2.311" class="difflineplus">+        // The user pressed ESC to cancel the drag, or the drag succeeded.</span>
<a href="#l2.312"></a><span id="l2.312" class="difflineplus">+        let dt = event.dataTransfer;</span>
<a href="#l2.313"></a><span id="l2.313" class="difflineplus">+        if ((dt.mozUserCancelled) || (dt.dropEffect != &quot;none&quot;))</span>
<a href="#l2.314"></a><span id="l2.314" class="difflineplus">+          return;</span>
<a href="#l2.315"></a><span id="l2.315" class="difflineplus">+</span>
<a href="#l2.316"></a><span id="l2.316" class="difflineplus">+        // Disable detach within the browser toolbox.</span>
<a href="#l2.317"></a><span id="l2.317" class="difflineplus">+        let eX = event.screenX;</span>
<a href="#l2.318"></a><span id="l2.318" class="difflineplus">+        let wX = window.screenX;</span>
<a href="#l2.319"></a><span id="l2.319" class="difflineplus">+</span>
<a href="#l2.320"></a><span id="l2.320" class="difflineplus">+        // Check if the drop point is horizontally within the window.</span>
<a href="#l2.321"></a><span id="l2.321" class="difflineplus">+        if (eX &gt; wX &amp;&amp; eX &lt; (wX + window.outerWidth)) {</span>
<a href="#l2.322"></a><span id="l2.322" class="difflineplus">+          let bo = this.arrowScrollbox;</span>
<a href="#l2.323"></a><span id="l2.323" class="difflineplus">+          // Also avoid detaching if the the tab was dropped too close to</span>
<a href="#l2.324"></a><span id="l2.324" class="difflineplus">+          // the tabbar (half a tab).</span>
<a href="#l2.325"></a><span id="l2.325" class="difflineplus">+          let endScreenY = bo.screenY + 1.5 * bo.getBoundingClientRect().height;</span>
<a href="#l2.326"></a><span id="l2.326" class="difflineplus">+          let eY = event.screenY;</span>
<a href="#l2.327"></a><span id="l2.327" class="difflineplus">+</span>
<a href="#l2.328"></a><span id="l2.328" class="difflineplus">+          if (eY &lt; endScreenY &amp;&amp; eY &gt; window.screenY)</span>
<a href="#l2.329"></a><span id="l2.329" class="difflineplus">+            return;</span>
<a href="#l2.330"></a><span id="l2.330" class="difflineplus">+        }</span>
<a href="#l2.331"></a><span id="l2.331" class="difflineplus">+</span>
<a href="#l2.332"></a><span id="l2.332" class="difflineplus">+        // User wants to deatach tab from window...</span>
<a href="#l2.333"></a><span id="l2.333" class="difflineplus">+        if (dt.mozItemCount != 1)</span>
<a href="#l2.334"></a><span id="l2.334" class="difflineplus">+          return;</span>
<a href="#l2.335"></a><span id="l2.335" class="difflineplus">+</span>
<a href="#l2.336"></a><span id="l2.336" class="difflineplus">+        let draggedTab = dt.mozGetDataAt(&quot;application/x-moz-tabmail-tab&quot;, 0);</span>
<a href="#l2.337"></a><span id="l2.337" class="difflineplus">+</span>
<a href="#l2.338"></a><span id="l2.338" class="difflineplus">+        if (!draggedTab)</span>
<a href="#l2.339"></a><span id="l2.339" class="difflineplus">+          return;</span>
<a href="#l2.340"></a><span id="l2.340" class="difflineplus">+</span>
<a href="#l2.341"></a><span id="l2.341" class="difflineplus">+        this.tabmail.replaceTabWithWindow(draggedTab);</span>
<a href="#l2.342"></a><span id="l2.342" class="difflineplus">+      });</span>
<a href="#l2.343"></a><span id="l2.343" class="difflineplus">+</span>
<a href="#l2.344"></a><span id="l2.344" class="difflineplus">+      this.addEventListener(&quot;dragexit&quot;, (event) =&gt; {</span>
<a href="#l2.345"></a><span id="l2.345" class="difflineplus">+        this._dragTime = 0;</span>
<a href="#l2.346"></a><span id="l2.346" class="difflineplus">+</span>
<a href="#l2.347"></a><span id="l2.347" class="difflineplus">+        this._tabDropIndicator.setAttribute(&quot;hidden&quot;, &quot;true&quot;);</span>
<a href="#l2.348"></a><span id="l2.348" class="difflineplus">+        event.stopPropagation();</span>
<a href="#l2.349"></a><span id="l2.349" class="difflineplus">+      });</span>
<a href="#l2.350"></a><span id="l2.350" class="difflineplus">+</span>
<a href="#l2.351"></a><span id="l2.351" class="difflineplus">+      this.addEventListener(&quot;click&quot;, (event) =&gt; {</span>
<a href="#l2.352"></a><span id="l2.352" class="difflineplus">+        if (event.button != 0) {</span>
<a href="#l2.353"></a><span id="l2.353" class="difflineplus">+          return;</span>
<a href="#l2.354"></a><span id="l2.354" class="difflineplus">+        }</span>
<a href="#l2.355"></a><span id="l2.355" class="difflineplus">+</span>
<a href="#l2.356"></a><span id="l2.356" class="difflineplus">+        if (!event.originalTarget.classList.contains(&quot;tabs-closebutton&quot;)) {</span>
<a href="#l2.357"></a><span id="l2.357" class="difflineplus">+          return;</span>
<a href="#l2.358"></a><span id="l2.358" class="difflineplus">+        }</span>
<a href="#l2.359"></a><span id="l2.359" class="difflineplus">+</span>
<a href="#l2.360"></a><span id="l2.360" class="difflineplus">+        let tabbedBrowser = document.getElementById(&quot;tabmail&quot;);</span>
<a href="#l2.361"></a><span id="l2.361" class="difflineplus">+        if (this.localName == &quot;tab&quot;) {</span>
<a href="#l2.362"></a><span id="l2.362" class="difflineplus">+          // The only sequence in which a second click event (i.e. dblclik)</span>
<a href="#l2.363"></a><span id="l2.363" class="difflineplus">+          // can be dispatched on an in-tab close button is when it is shown</span>
<a href="#l2.364"></a><span id="l2.364" class="difflineplus">+          // after the first click (i.e. the first click event was dispatched</span>
<a href="#l2.365"></a><span id="l2.365" class="difflineplus">+          // on the tab). This happens when we show the close button only on</span>
<a href="#l2.366"></a><span id="l2.366" class="difflineplus">+          // the active tab. (bug 352021)</span>
<a href="#l2.367"></a><span id="l2.367" class="difflineplus">+          // The only sequence in which a third click event can be dispatched</span>
<a href="#l2.368"></a><span id="l2.368" class="difflineplus">+          // on an in-tab close button is when the tab was opened with a</span>
<a href="#l2.369"></a><span id="l2.369" class="difflineplus">+          // double click on the tabbar. (bug 378344)</span>
<a href="#l2.370"></a><span id="l2.370" class="difflineplus">+          // In both cases, it is most likely that the close button area has</span>
<a href="#l2.371"></a><span id="l2.371" class="difflineplus">+          // been accidentally clicked, therefore we do not close the tab.</span>
<a href="#l2.372"></a><span id="l2.372" class="difflineplus">+          if (event.detail &gt; 1)</span>
<a href="#l2.373"></a><span id="l2.373" class="difflineplus">+            return;</span>
<a href="#l2.374"></a><span id="l2.374" class="difflineplus">+</span>
<a href="#l2.375"></a><span id="l2.375" class="difflineplus">+          tabbedBrowser.removeTabByNode(this);</span>
<a href="#l2.376"></a><span id="l2.376" class="difflineplus">+          tabbedBrowser._blockDblClick = true;</span>
<a href="#l2.377"></a><span id="l2.377" class="difflineplus">+          let tabContainer = tabbedBrowser.tabContainer;</span>
<a href="#l2.378"></a><span id="l2.378" class="difflineplus">+</span>
<a href="#l2.379"></a><span id="l2.379" class="difflineplus">+          // XXXmano hack (see bug 343628):</span>
<a href="#l2.380"></a><span id="l2.380" class="difflineplus">+          // Since we're removing the event target, if the user</span>
<a href="#l2.381"></a><span id="l2.381" class="difflineplus">+          // double-clicks this button, the dblclick event will be dispatched</span>
<a href="#l2.382"></a><span id="l2.382" class="difflineplus">+          // with the tabbar as its event target (and explicit/originalTarget),</span>
<a href="#l2.383"></a><span id="l2.383" class="difflineplus">+          // which treats that as a mouse gesture for opening a new tab.</span>
<a href="#l2.384"></a><span id="l2.384" class="difflineplus">+          // In this context, we're manually blocking the dblclick event</span>
<a href="#l2.385"></a><span id="l2.385" class="difflineplus">+          // (see onTabBarDblClick).</span>
<a href="#l2.386"></a><span id="l2.386" class="difflineplus">+          let clickedOnce = false;</span>
<a href="#l2.387"></a><span id="l2.387" class="difflineplus">+          let enableDblClick = function enableDblClick(event) {</span>
<a href="#l2.388"></a><span id="l2.388" class="difflineplus">+            let target = event.originalTarget;</span>
<a href="#l2.389"></a><span id="l2.389" class="difflineplus">+            if (target.className == &quot;tab-close-button&quot;)</span>
<a href="#l2.390"></a><span id="l2.390" class="difflineplus">+              target._ignoredClick = true;</span>
<a href="#l2.391"></a><span id="l2.391" class="difflineplus">+            if (!clickedOnce) {</span>
<a href="#l2.392"></a><span id="l2.392" class="difflineplus">+              clickedOnce = true;</span>
<a href="#l2.393"></a><span id="l2.393" class="difflineplus">+              return;</span>
<a href="#l2.394"></a><span id="l2.394" class="difflineplus">+            }</span>
<a href="#l2.395"></a><span id="l2.395" class="difflineplus">+            tabContainer._blockDblClick = false;</span>
<a href="#l2.396"></a><span id="l2.396" class="difflineplus">+            tabContainer.removeEventListener(&quot;click&quot;, enableDblClick, true);</span>
<a href="#l2.397"></a><span id="l2.397" class="difflineplus">+          };</span>
<a href="#l2.398"></a><span id="l2.398" class="difflineplus">+          tabContainer.addEventListener(&quot;click&quot;, enableDblClick, true);</span>
<a href="#l2.399"></a><span id="l2.399" class="difflineplus">+        } else { // &quot;tabs&quot;</span>
<a href="#l2.400"></a><span id="l2.400" class="difflineplus">+          tabbedBrowser.removeCurrentTab();</span>
<a href="#l2.401"></a><span id="l2.401" class="difflineplus">+        }</span>
<a href="#l2.402"></a><span id="l2.402" class="difflineplus">+      });</span>
<a href="#l2.403"></a><span id="l2.403" class="difflineplus">+</span>
<a href="#l2.404"></a><span id="l2.404" class="difflineplus">+      this.addEventListener(&quot;dblclick&quot;, (event) =&gt; {</span>
<a href="#l2.405"></a><span id="l2.405" class="difflineplus">+        if (event.button != 0) {</span>
<a href="#l2.406"></a><span id="l2.406" class="difflineplus">+          return;</span>
<a href="#l2.407"></a><span id="l2.407" class="difflineplus">+        }</span>
<a href="#l2.408"></a><span id="l2.408" class="difflineplus">+</span>
<a href="#l2.409"></a><span id="l2.409" class="difflineplus">+        // for the one-close-button case</span>
<a href="#l2.410"></a><span id="l2.410" class="difflineplus">+        event.stopPropagation();</span>
<a href="#l2.411"></a><span id="l2.411" class="difflineplus">+      }, true);</span>
<a href="#l2.412"></a><span id="l2.412" class="difflineplus">+    }</span>
<a href="#l2.413"></a><span id="l2.413" class="difflineplus">+</span>
<a href="#l2.414"></a><span id="l2.414" class="difflineplus">+    connectedCallback() {</span>
<a href="#l2.415"></a><span id="l2.415" class="difflineplus">+      if (this.delayConnectedCallback()) {</span>
<a href="#l2.416"></a><span id="l2.416" class="difflineplus">+        return;</span>
<a href="#l2.417"></a><span id="l2.417" class="difflineplus">+      }</span>
<a href="#l2.418"></a><span id="l2.418" class="difflineplus">+      super.connectedCallback();</span>
<a href="#l2.419"></a><span id="l2.419" class="difflineplus">+</span>
<a href="#l2.420"></a><span id="l2.420" class="difflineplus">+      this.tabmail = document.getElementById(&quot;tabmail&quot;);</span>
<a href="#l2.421"></a><span id="l2.421" class="difflineplus">+</span>
<a href="#l2.422"></a><span id="l2.422" class="difflineplus">+      this.arrowScrollboxWidth = 0;</span>
<a href="#l2.423"></a><span id="l2.423" class="difflineplus">+</span>
<a href="#l2.424"></a><span id="l2.424" class="difflineplus">+      this.arrowScrollbox = this.querySelector(&quot;arrowscrollbox&quot;);</span>
<a href="#l2.425"></a><span id="l2.425" class="difflineplus">+</span>
<a href="#l2.426"></a><span id="l2.426" class="difflineplus">+      this.arrowScrollboxClosebutton = this.querySelector(&quot;.tabs-closebutton-box&quot;);</span>
<a href="#l2.427"></a><span id="l2.427" class="difflineplus">+</span>
<a href="#l2.428"></a><span id="l2.428" class="difflineplus">+      this.mToolbar = document.getElementById(this.getAttribute(&quot;tabtoolbar&quot;));</span>
<a href="#l2.429"></a><span id="l2.429" class="difflineplus">+</span>
<a href="#l2.430"></a><span id="l2.430" class="difflineplus">+      this.mCollapseToolbar = document.getElementById(this.getAttribute(&quot;collapsetoolbar&quot;));</span>
<a href="#l2.431"></a><span id="l2.431" class="difflineplus">+</span>
<a href="#l2.432"></a><span id="l2.432" class="difflineplus">+      // @implements {nsIObserver}</span>
<a href="#l2.433"></a><span id="l2.433" class="difflineplus">+      this._prefObserver = (subject, topic, data) =&gt; {</span>
<a href="#l2.434"></a><span id="l2.434" class="difflineplus">+        if (topic == &quot;nsPref:changed&quot;) {</span>
<a href="#l2.435"></a><span id="l2.435" class="difflineplus">+          subject.QueryInterface(Ci.nsIPrefBranch);</span>
<a href="#l2.436"></a><span id="l2.436" class="difflineplus">+          switch (data) {</span>
<a href="#l2.437"></a><span id="l2.437" class="difflineplus">+            case &quot;mail.tabs.closeButtons&quot;:</span>
<a href="#l2.438"></a><span id="l2.438" class="difflineplus">+              this.mCloseButtons = subject.getIntPref(&quot;mail.tabs.closeButtons&quot;);</span>
<a href="#l2.439"></a><span id="l2.439" class="difflineplus">+              this._updateCloseButtons();</span>
<a href="#l2.440"></a><span id="l2.440" class="difflineplus">+              break;</span>
<a href="#l2.441"></a><span id="l2.441" class="difflineplus">+            case &quot;mail.tabs.autoHide&quot;:</span>
<a href="#l2.442"></a><span id="l2.442" class="difflineplus">+              this.mAutoHide = subject.getBoolPref(&quot;mail.tabs.autoHide&quot;);</span>
<a href="#l2.443"></a><span id="l2.443" class="difflineplus">+              break;</span>
<a href="#l2.444"></a><span id="l2.444" class="difflineplus">+          }</span>
<a href="#l2.445"></a><span id="l2.445" class="difflineplus">+        }</span>
<a href="#l2.446"></a><span id="l2.446" class="difflineplus">+      };</span>
<a href="#l2.447"></a><span id="l2.447" class="difflineplus">+</span>
<a href="#l2.448"></a><span id="l2.448" class="difflineplus">+      this._tabDropIndicator = this.querySelector(&quot;.tab-drop-indicator&quot;);</span>
<a href="#l2.449"></a><span id="l2.449" class="difflineplus">+</span>
<a href="#l2.450"></a><span id="l2.450" class="difflineplus">+      this._dragOverDelay = 350;</span>
<a href="#l2.451"></a><span id="l2.451" class="difflineplus">+</span>
<a href="#l2.452"></a><span id="l2.452" class="difflineplus">+      this._dragTime = 0;</span>
<a href="#l2.453"></a><span id="l2.453" class="difflineplus">+</span>
<a href="#l2.454"></a><span id="l2.454" class="difflineplus">+      this.mTabMinWidth = 100;</span>
<a href="#l2.455"></a><span id="l2.455" class="difflineplus">+</span>
<a href="#l2.456"></a><span id="l2.456" class="difflineplus">+      this.mTabMaxWidth = 250;</span>
<a href="#l2.457"></a><span id="l2.457" class="difflineplus">+</span>
<a href="#l2.458"></a><span id="l2.458" class="difflineplus">+      this.mTabClipWidth = 140;</span>
<a href="#l2.459"></a><span id="l2.459" class="difflineplus">+</span>
<a href="#l2.460"></a><span id="l2.460" class="difflineplus">+      this.mCloseButtons = 1;</span>
<a href="#l2.461"></a><span id="l2.461" class="difflineplus">+</span>
<a href="#l2.462"></a><span id="l2.462" class="difflineplus">+      this._mAutoHide = false;</span>
<a href="#l2.463"></a><span id="l2.463" class="difflineplus">+</span>
<a href="#l2.464"></a><span id="l2.464" class="difflineplus">+      this.mAllTabsButton = document.getElementById(this.getAttribute(&quot;alltabsbutton&quot;));</span>
<a href="#l2.465"></a><span id="l2.465" class="difflineplus">+      this.mAllTabsPopup = this.mAllTabsButton.menu;</span>
<a href="#l2.466"></a><span id="l2.466" class="difflineplus">+</span>
<a href="#l2.467"></a><span id="l2.467" class="difflineplus">+      // this.mAllTabsBoxAnimate = document.getAnonymousElementByAttribute(this,</span>
<a href="#l2.468"></a><span id="l2.468" class="difflineplus">+      //  &quot;anonid&quot;,</span>
<a href="#l2.469"></a><span id="l2.469" class="difflineplus">+      //  &quot;alltabs-box-animate&quot;);</span>
<a href="#l2.470"></a><span id="l2.470" class="difflineplus">+      // TODO ^^^ alltabs-box-animate seems to be dead code. remove all refs?</span>
<a href="#l2.471"></a><span id="l2.471" class="difflineplus">+</span>
<a href="#l2.472"></a><span id="l2.472" class="difflineplus">+      this.mDownBoxAnimate = this.arrowScrollbox._scrollButtonDownBoxAnimate;</span>
<a href="#l2.473"></a><span id="l2.473" class="difflineplus">+</span>
<a href="#l2.474"></a><span id="l2.474" class="difflineplus">+      this._animateTimer = null;</span>
<a href="#l2.475"></a><span id="l2.475" class="difflineplus">+</span>
<a href="#l2.476"></a><span id="l2.476" class="difflineplus">+      this._animateStep = -1;</span>
<a href="#l2.477"></a><span id="l2.477" class="difflineplus">+</span>
<a href="#l2.478"></a><span id="l2.478" class="difflineplus">+      this._animateDelay = 25;</span>
<a href="#l2.479"></a><span id="l2.479" class="difflineplus">+</span>
<a href="#l2.480"></a><span id="l2.480" class="difflineplus">+      this._animatePercents = [1.00, 0.85, 0.80, 0.75, 0.71, 0.68, 0.65, 0.62, 0.59, 0.57,</span>
<a href="#l2.481"></a><span id="l2.481" class="difflineplus">+        0.54, 0.52, 0.50, 0.47, 0.45, 0.44, 0.42, 0.40, 0.38, 0.37,</span>
<a href="#l2.482"></a><span id="l2.482" class="difflineplus">+        0.35, 0.34, 0.32, 0.31, 0.30, 0.29, 0.28, 0.27, 0.26, 0.25,</span>
<a href="#l2.483"></a><span id="l2.483" class="difflineplus">+        0.24, 0.23, 0.23, 0.22, 0.22, 0.21, 0.21, 0.21, 0.20, 0.20,</span>
<a href="#l2.484"></a><span id="l2.484" class="difflineplus">+        0.20, 0.20, 0.20, 0.20, 0.20, 0.20, 0.19, 0.19, 0.19, 0.18,</span>
<a href="#l2.485"></a><span id="l2.485" class="difflineplus">+        0.18, 0.17, 0.17, 0.16, 0.15, 0.14, 0.13, 0.11, 0.09, 0.06,</span>
<a href="#l2.486"></a><span id="l2.486" class="difflineplus">+      ];</span>
<a href="#l2.487"></a><span id="l2.487" class="difflineplus">+</span>
<a href="#l2.488"></a><span id="l2.488" class="difflineplus">+      this.mTabMinWidth = Services.prefs.getIntPref(&quot;mail.tabs.tabMinWidth&quot;);</span>
<a href="#l2.489"></a><span id="l2.489" class="difflineplus">+      this.mTabMaxWidth = Services.prefs.getIntPref(&quot;mail.tabs.tabMaxWidth&quot;);</span>
<a href="#l2.490"></a><span id="l2.490" class="difflineplus">+      this.mTabClipWidth = Services.prefs.getIntPref(&quot;mail.tabs.tabClipWidth&quot;);</span>
<a href="#l2.491"></a><span id="l2.491" class="difflineplus">+      this.mCloseButtons = Services.prefs.getIntPref(&quot;mail.tabs.closeButtons&quot;);</span>
<a href="#l2.492"></a><span id="l2.492" class="difflineplus">+      this.mAutoHide = Services.prefs.getBoolPref(&quot;mail.tabs.autoHide&quot;);</span>
<a href="#l2.493"></a><span id="l2.493" class="difflineplus">+</span>
<a href="#l2.494"></a><span id="l2.494" class="difflineplus">+      if (this.mAutoHide)</span>
<a href="#l2.495"></a><span id="l2.495" class="difflineplus">+        this.mCollapseToolbar.collapsed = true;</span>
<a href="#l2.496"></a><span id="l2.496" class="difflineplus">+</span>
<a href="#l2.497"></a><span id="l2.497" class="difflineplus">+      this.arrowScrollbox.firstChild.minWidth = this.mTabMinWidth;</span>
<a href="#l2.498"></a><span id="l2.498" class="difflineplus">+      this.arrowScrollbox.firstChild.maxWidth = this.mTabMaxWidth;</span>
<a href="#l2.499"></a><span id="l2.499" class="difflineplus">+      this._updateCloseButtons();</span>
<a href="#l2.500"></a><span id="l2.500" class="difflineplus">+</span>
<a href="#l2.501"></a><span id="l2.501" class="difflineplus">+      Services.prefs.addObserver(&quot;mail.tabs.&quot;, this._prefObserver);</span>
<a href="#l2.502"></a><span id="l2.502" class="difflineplus">+</span>
<a href="#l2.503"></a><span id="l2.503" class="difflineplus">+      window.addEventListener(&quot;resize&quot;, this);</span>
<a href="#l2.504"></a><span id="l2.504" class="difflineplus">+</span>
<a href="#l2.505"></a><span id="l2.505" class="difflineplus">+      // Listen to overflow/underflow events on the tabstrip,</span>
<a href="#l2.506"></a><span id="l2.506" class="difflineplus">+      // we cannot put these as xbl handlers on the entire binding because</span>
<a href="#l2.507"></a><span id="l2.507" class="difflineplus">+      // they would also get called for the all-tabs popup scrollbox.</span>
<a href="#l2.508"></a><span id="l2.508" class="difflineplus">+      // Also, we can't rely on event.target because these are all</span>
<a href="#l2.509"></a><span id="l2.509" class="difflineplus">+      // anonymous nodes.</span>
<a href="#l2.510"></a><span id="l2.510" class="difflineplus">+      this.arrowScrollbox.addEventListener(&quot;overflow&quot;, this);</span>
<a href="#l2.511"></a><span id="l2.511" class="difflineplus">+      this.arrowScrollbox.addEventListener(&quot;underflow&quot;, this);</span>
<a href="#l2.512"></a><span id="l2.512" class="difflineplus">+</span>
<a href="#l2.513"></a><span id="l2.513" class="difflineplus">+      this.addEventListener(&quot;select&quot;, (event) =&gt; {</span>
<a href="#l2.514"></a><span id="l2.514" class="difflineplus">+        this._handleTabSelect();</span>
<a href="#l2.515"></a><span id="l2.515" class="difflineplus">+</span>
<a href="#l2.516"></a><span id="l2.516" class="difflineplus">+        if (!(&quot;updateCurrentTab&quot; in this.tabmail) ||</span>
<a href="#l2.517"></a><span id="l2.517" class="difflineplus">+          event.target.localName != &quot;tabs&quot;)</span>
<a href="#l2.518"></a><span id="l2.518" class="difflineplus">+          return;</span>
<a href="#l2.519"></a><span id="l2.519" class="difflineplus">+</span>
<a href="#l2.520"></a><span id="l2.520" class="difflineplus">+        this.tabmail.updateCurrentTab();</span>
<a href="#l2.521"></a><span id="l2.521" class="difflineplus">+      });</span>
<a href="#l2.522"></a><span id="l2.522" class="difflineplus">+</span>
<a href="#l2.523"></a><span id="l2.523" class="difflineplus">+      this.addEventListener(&quot;TabSelect&quot;, (event) =&gt; { this._handleTabSelect(); });</span>
<a href="#l2.524"></a><span id="l2.524" class="difflineplus">+    }</span>
<a href="#l2.525"></a><span id="l2.525" class="difflineplus">+</span>
<a href="#l2.526"></a><span id="l2.526" class="difflineplus">+    get tabbox() {</span>
<a href="#l2.527"></a><span id="l2.527" class="difflineplus">+      return document.getElementById(&quot;tabmail-tabbox&quot;);</span>
<a href="#l2.528"></a><span id="l2.528" class="difflineplus">+    }</span>
<a href="#l2.529"></a><span id="l2.529" class="difflineplus">+</span>
<a href="#l2.530"></a><span id="l2.530" class="difflineplus">+    // Accessor for tabs.</span>
<a href="#l2.531"></a><span id="l2.531" class="difflineplus">+    get allTabs() {</span>
<a href="#l2.532"></a><span id="l2.532" class="difflineplus">+      if (!this.arrowScrollbox) {</span>
<a href="#l2.533"></a><span id="l2.533" class="difflineplus">+        return [];</span>
<a href="#l2.534"></a><span id="l2.534" class="difflineplus">+      }</span>
<a href="#l2.535"></a><span id="l2.535" class="difflineplus">+</span>
<a href="#l2.536"></a><span id="l2.536" class="difflineplus">+      return Array.from(this.arrowScrollbox.children);</span>
<a href="#l2.537"></a><span id="l2.537" class="difflineplus">+    }</span>
<a href="#l2.538"></a><span id="l2.538" class="difflineplus">+</span>
<a href="#l2.539"></a><span id="l2.539" class="difflineplus">+    appendChild(tab) {</span>
<a href="#l2.540"></a><span id="l2.540" class="difflineplus">+      return this.insertBefore(tab, null);</span>
<a href="#l2.541"></a><span id="l2.541" class="difflineplus">+    }</span>
<a href="#l2.542"></a><span id="l2.542" class="difflineplus">+</span>
<a href="#l2.543"></a><span id="l2.543" class="difflineplus">+    insertBefore(tab, node) {</span>
<a href="#l2.544"></a><span id="l2.544" class="difflineplus">+      if (!this.arrowScrollbox) {</span>
<a href="#l2.545"></a><span id="l2.545" class="difflineplus">+        return;</span>
<a href="#l2.546"></a><span id="l2.546" class="difflineplus">+      }</span>
<a href="#l2.547"></a><span id="l2.547" class="difflineplus">+</span>
<a href="#l2.548"></a><span id="l2.548" class="difflineplus">+      if (node == null) {</span>
<a href="#l2.549"></a><span id="l2.549" class="difflineplus">+        this.arrowScrollbox.appendChild(tab);</span>
<a href="#l2.550"></a><span id="l2.550" class="difflineplus">+        return;</span>
<a href="#l2.551"></a><span id="l2.551" class="difflineplus">+      }</span>
<a href="#l2.552"></a><span id="l2.552" class="difflineplus">+</span>
<a href="#l2.553"></a><span id="l2.553" class="difflineplus">+      this.arrowScrollbox.insertBefore(tab, node);</span>
<a href="#l2.554"></a><span id="l2.554" class="difflineplus">+    }</span>
<a href="#l2.555"></a><span id="l2.555" class="difflineplus">+</span>
<a href="#l2.556"></a><span id="l2.556" class="difflineplus">+    set mAutoHide(val) {</span>
<a href="#l2.557"></a><span id="l2.557" class="difflineplus">+      if (val != this._mAutoHide) {</span>
<a href="#l2.558"></a><span id="l2.558" class="difflineplus">+        if (this.allTabs.length == 1)</span>
<a href="#l2.559"></a><span id="l2.559" class="difflineplus">+          this.mCollapseToolbar.collapsed = val;</span>
<a href="#l2.560"></a><span id="l2.560" class="difflineplus">+        this._mAutoHide = val;</span>
<a href="#l2.561"></a><span id="l2.561" class="difflineplus">+      }</span>
<a href="#l2.562"></a><span id="l2.562" class="difflineplus">+      return val;</span>
<a href="#l2.563"></a><span id="l2.563" class="difflineplus">+    }</span>
<a href="#l2.564"></a><span id="l2.564" class="difflineplus">+</span>
<a href="#l2.565"></a><span id="l2.565" class="difflineplus">+    get mAutoHide() {</span>
<a href="#l2.566"></a><span id="l2.566" class="difflineplus">+      return this._mAutoHide;</span>
<a href="#l2.567"></a><span id="l2.567" class="difflineplus">+    }</span>
<a href="#l2.568"></a><span id="l2.568" class="difflineplus">+</span>
<a href="#l2.569"></a><span id="l2.569" class="difflineplus">+    set selectedIndex(val) {</span>
<a href="#l2.570"></a><span id="l2.570" class="difflineplus">+      let tab = this.getItemAtIndex(val);</span>
<a href="#l2.571"></a><span id="l2.571" class="difflineplus">+      let alreadySelected = tab &amp;&amp; tab.selected;</span>
<a href="#l2.572"></a><span id="l2.572" class="difflineplus">+</span>
<a href="#l2.573"></a><span id="l2.573" class="difflineplus">+      this.__proto__.__proto__.__lookupSetter__(&quot;selectedIndex&quot;).call(this, val);</span>
<a href="#l2.574"></a><span id="l2.574" class="difflineplus">+</span>
<a href="#l2.575"></a><span id="l2.575" class="difflineplus">+      if (!alreadySelected) {</span>
<a href="#l2.576"></a><span id="l2.576" class="difflineplus">+        // Fire an onselect event for the tabs element.</span>
<a href="#l2.577"></a><span id="l2.577" class="difflineplus">+        let event = document.createEvent(&quot;Events&quot;);</span>
<a href="#l2.578"></a><span id="l2.578" class="difflineplus">+        event.initEvent(&quot;select&quot;, true, true);</span>
<a href="#l2.579"></a><span id="l2.579" class="difflineplus">+        this.dispatchEvent(event);</span>
<a href="#l2.580"></a><span id="l2.580" class="difflineplus">+      }</span>
<a href="#l2.581"></a><span id="l2.581" class="difflineplus">+</span>
<a href="#l2.582"></a><span id="l2.582" class="difflineplus">+      return val;</span>
<a href="#l2.583"></a><span id="l2.583" class="difflineplus">+    }</span>
<a href="#l2.584"></a><span id="l2.584" class="difflineplus">+</span>
<a href="#l2.585"></a><span id="l2.585" class="difflineplus">+    get selectedIndex() {</span>
<a href="#l2.586"></a><span id="l2.586" class="difflineplus">+      return this.__proto__.__proto__.__lookupGetter__(&quot;selectedIndex&quot;).call(this);</span>
<a href="#l2.587"></a><span id="l2.587" class="difflineplus">+    }</span>
<a href="#l2.588"></a><span id="l2.588" class="difflineplus">+</span>
<a href="#l2.589"></a><span id="l2.589" class="difflineplus">+    _updateCloseButtons() {</span>
<a href="#l2.590"></a><span id="l2.590" class="difflineplus">+      // modes for tabstrip</span>
<a href="#l2.591"></a><span id="l2.591" class="difflineplus">+      // 0 - activetab  = close button on active tab only</span>
<a href="#l2.592"></a><span id="l2.592" class="difflineplus">+      // 1 - alltabs    = close buttons on all tabs</span>
<a href="#l2.593"></a><span id="l2.593" class="difflineplus">+      // 2 - noclose    = no close buttons at all</span>
<a href="#l2.594"></a><span id="l2.594" class="difflineplus">+      // 3 - closeatend = close button at the end of the tabstrip</span>
<a href="#l2.595"></a><span id="l2.595" class="difflineplus">+      switch (this.mCloseButtons) {</span>
<a href="#l2.596"></a><span id="l2.596" class="difflineplus">+        case 0:</span>
<a href="#l2.597"></a><span id="l2.597" class="difflineplus">+          this.setAttribute(&quot;closebuttons&quot;, &quot;activetab&quot;);</span>
<a href="#l2.598"></a><span id="l2.598" class="difflineplus">+          break;</span>
<a href="#l2.599"></a><span id="l2.599" class="difflineplus">+        case 1:</span>
<a href="#l2.600"></a><span id="l2.600" class="difflineplus">+          let width = this.arrowScrollbox.firstChild.getBoundingClientRect().width;</span>
<a href="#l2.601"></a><span id="l2.601" class="difflineplus">+          // 0 width is an invalid value and indicates</span>
<a href="#l2.602"></a><span id="l2.602" class="difflineplus">+          // an item without display, so ignore.</span>
<a href="#l2.603"></a><span id="l2.603" class="difflineplus">+          if (width &gt; this.mTabClipWidth || width == 0)</span>
<a href="#l2.604"></a><span id="l2.604" class="difflineplus">+            this.setAttribute(&quot;closebuttons&quot;, &quot;alltabs&quot;);</span>
<a href="#l2.605"></a><span id="l2.605" class="difflineplus">+          else</span>
<a href="#l2.606"></a><span id="l2.606" class="difflineplus">+            this.setAttribute(&quot;closebuttons&quot;, &quot;activetab&quot;);</span>
<a href="#l2.607"></a><span id="l2.607" class="difflineplus">+          break;</span>
<a href="#l2.608"></a><span id="l2.608" class="difflineplus">+        case 2:</span>
<a href="#l2.609"></a><span id="l2.609" class="difflineplus">+        case 3:</span>
<a href="#l2.610"></a><span id="l2.610" class="difflineplus">+          this.setAttribute(&quot;closebuttons&quot;, &quot;noclose&quot;);</span>
<a href="#l2.611"></a><span id="l2.611" class="difflineplus">+          break;</span>
<a href="#l2.612"></a><span id="l2.612" class="difflineplus">+      }</span>
<a href="#l2.613"></a><span id="l2.613" class="difflineplus">+      this.arrowScrollboxClosebutton.collapsed = this.mCloseButtons != 3;</span>
<a href="#l2.614"></a><span id="l2.614" class="difflineplus">+    }</span>
<a href="#l2.615"></a><span id="l2.615" class="difflineplus">+</span>
<a href="#l2.616"></a><span id="l2.616" class="difflineplus">+    _handleTabSelect() {</span>
<a href="#l2.617"></a><span id="l2.617" class="difflineplus">+      this.arrowScrollbox.ensureElementIsVisible(this.selectedItem);</span>
<a href="#l2.618"></a><span id="l2.618" class="difflineplus">+    }</span>
<a href="#l2.619"></a><span id="l2.619" class="difflineplus">+</span>
<a href="#l2.620"></a><span id="l2.620" class="difflineplus">+    handleEvent(aEvent) {</span>
<a href="#l2.621"></a><span id="l2.621" class="difflineplus">+      switch (aEvent.type) {</span>
<a href="#l2.622"></a><span id="l2.622" class="difflineplus">+        case &quot;overflow&quot;:</span>
<a href="#l2.623"></a><span id="l2.623" class="difflineplus">+          this.arrowScrollbox.ensureElementIsVisible(this.selectedItem);</span>
<a href="#l2.624"></a><span id="l2.624" class="difflineplus">+          break;</span>
<a href="#l2.625"></a><span id="l2.625" class="difflineplus">+        case &quot;underflow&quot;:</span>
<a href="#l2.626"></a><span id="l2.626" class="difflineplus">+          break;</span>
<a href="#l2.627"></a><span id="l2.627" class="difflineplus">+        case &quot;resize&quot;:</span>
<a href="#l2.628"></a><span id="l2.628" class="difflineplus">+          let width = this.arrowScrollbox.getBoundingClientRect().width;</span>
<a href="#l2.629"></a><span id="l2.629" class="difflineplus">+          if (width != this.arrowScrollboxWidth) {</span>
<a href="#l2.630"></a><span id="l2.630" class="difflineplus">+            this._updateCloseButtons();</span>
<a href="#l2.631"></a><span id="l2.631" class="difflineplus">+            // XXX without this line the tab bar won't budge</span>
<a href="#l2.632"></a><span id="l2.632" class="difflineplus">+            this.arrowScrollbox.scrollByPixels(1);</span>
<a href="#l2.633"></a><span id="l2.633" class="difflineplus">+            this._handleTabSelect();</span>
<a href="#l2.634"></a><span id="l2.634" class="difflineplus">+            this.arrowScrollboxWidth = width;</span>
<a href="#l2.635"></a><span id="l2.635" class="difflineplus">+          }</span>
<a href="#l2.636"></a><span id="l2.636" class="difflineplus">+          break;</span>
<a href="#l2.637"></a><span id="l2.637" class="difflineplus">+      }</span>
<a href="#l2.638"></a><span id="l2.638" class="difflineplus">+    }</span>
<a href="#l2.639"></a><span id="l2.639" class="difflineplus">+</span>
<a href="#l2.640"></a><span id="l2.640" class="difflineplus">+    _stopAnimation() {</span>
<a href="#l2.641"></a><span id="l2.641" class="difflineplus">+      if (this._animateStep != -1) {</span>
<a href="#l2.642"></a><span id="l2.642" class="difflineplus">+        if (this._animateTimer)</span>
<a href="#l2.643"></a><span id="l2.643" class="difflineplus">+          this._animateTimer.cancel();</span>
<a href="#l2.644"></a><span id="l2.644" class="difflineplus">+</span>
<a href="#l2.645"></a><span id="l2.645" class="difflineplus">+        this._animateStep = -1;</span>
<a href="#l2.646"></a><span id="l2.646" class="difflineplus">+        this.mAllTabsBoxAnimate.style.opacity = 0.0;</span>
<a href="#l2.647"></a><span id="l2.647" class="difflineplus">+        this.mDownBoxAnimate.style.opacity = 0.0;</span>
<a href="#l2.648"></a><span id="l2.648" class="difflineplus">+      }</span>
<a href="#l2.649"></a><span id="l2.649" class="difflineplus">+    }</span>
<a href="#l2.650"></a><span id="l2.650" class="difflineplus">+</span>
<a href="#l2.651"></a><span id="l2.651" class="difflineplus">+    _notifyBackgroundTab(aTab) {</span>
<a href="#l2.652"></a><span id="l2.652" class="difflineplus">+      let tsbo = this.arrowScrollbox;</span>
<a href="#l2.653"></a><span id="l2.653" class="difflineplus">+      let tsboStart = tsbo.screenX;</span>
<a href="#l2.654"></a><span id="l2.654" class="difflineplus">+      let tsboEnd = tsboStart + tsbo.getBoundingClientRect().width;</span>
<a href="#l2.655"></a><span id="l2.655" class="difflineplus">+</span>
<a href="#l2.656"></a><span id="l2.656" class="difflineplus">+      let ctboStart = aTab.screenX;</span>
<a href="#l2.657"></a><span id="l2.657" class="difflineplus">+      let ctboEnd = ctboStart + aTab.getBoundingClientRect().width;</span>
<a href="#l2.658"></a><span id="l2.658" class="difflineplus">+</span>
<a href="#l2.659"></a><span id="l2.659" class="difflineplus">+      // only start the flash timer if the new tab (which was loaded in</span>
<a href="#l2.660"></a><span id="l2.660" class="difflineplus">+      // the background) is not completely visible</span>
<a href="#l2.661"></a><span id="l2.661" class="difflineplus">+      if (tsboStart &gt; ctboStart || ctboEnd &gt; tsboEnd) {</span>
<a href="#l2.662"></a><span id="l2.662" class="difflineplus">+        this._animateStep = 0;</span>
<a href="#l2.663"></a><span id="l2.663" class="difflineplus">+</span>
<a href="#l2.664"></a><span id="l2.664" class="difflineplus">+        if (!this._animateTimer)</span>
<a href="#l2.665"></a><span id="l2.665" class="difflineplus">+          this._animateTimer =</span>
<a href="#l2.666"></a><span id="l2.666" class="difflineplus">+          Cc[&quot;@mozilla.org/timer;1&quot;]</span>
<a href="#l2.667"></a><span id="l2.667" class="difflineplus">+          .createInstance(Ci.nsITimer);</span>
<a href="#l2.668"></a><span id="l2.668" class="difflineplus">+        else</span>
<a href="#l2.669"></a><span id="l2.669" class="difflineplus">+          this._animateTimer.cancel();</span>
<a href="#l2.670"></a><span id="l2.670" class="difflineplus">+</span>
<a href="#l2.671"></a><span id="l2.671" class="difflineplus">+        this._animateTimer.initWithCallback(this,</span>
<a href="#l2.672"></a><span id="l2.672" class="difflineplus">+          this._animateDelay,</span>
<a href="#l2.673"></a><span id="l2.673" class="difflineplus">+          Ci.nsITimer.TYPE_REPEATING_SLACK);</span>
<a href="#l2.674"></a><span id="l2.674" class="difflineplus">+      }</span>
<a href="#l2.675"></a><span id="l2.675" class="difflineplus">+    }</span>
<a href="#l2.676"></a><span id="l2.676" class="difflineplus">+</span>
<a href="#l2.677"></a><span id="l2.677" class="difflineplus">+    notify(aTimer) {</span>
<a href="#l2.678"></a><span id="l2.678" class="difflineplus">+      if (!document)</span>
<a href="#l2.679"></a><span id="l2.679" class="difflineplus">+        aTimer.cancel();</span>
<a href="#l2.680"></a><span id="l2.680" class="difflineplus">+</span>
<a href="#l2.681"></a><span id="l2.681" class="difflineplus">+      let percent = this._animatePercents[this._animateStep];</span>
<a href="#l2.682"></a><span id="l2.682" class="difflineplus">+      this.mAllTabsBoxAnimate.style.opacity = percent;</span>
<a href="#l2.683"></a><span id="l2.683" class="difflineplus">+      this.mDownBoxAnimate.style.opacity = percent;</span>
<a href="#l2.684"></a><span id="l2.684" class="difflineplus">+</span>
<a href="#l2.685"></a><span id="l2.685" class="difflineplus">+      if (this._animateStep &lt; (this._animatePercents.length - 1))</span>
<a href="#l2.686"></a><span id="l2.686" class="difflineplus">+        this._animateStep++;</span>
<a href="#l2.687"></a><span id="l2.687" class="difflineplus">+      else</span>
<a href="#l2.688"></a><span id="l2.688" class="difflineplus">+        this._stopAnimation();</span>
<a href="#l2.689"></a><span id="l2.689" class="difflineplus">+    }</span>
<a href="#l2.690"></a><span id="l2.690" class="difflineplus">+</span>
<a href="#l2.691"></a><span id="l2.691" class="difflineplus">+    _getDragTargetTab(event) {</span>
<a href="#l2.692"></a><span id="l2.692" class="difflineplus">+      let tab = event.target;</span>
<a href="#l2.693"></a><span id="l2.693" class="difflineplus">+      while (tab &amp;&amp; tab.localName != &quot;tab&quot;) {</span>
<a href="#l2.694"></a><span id="l2.694" class="difflineplus">+        tab = tab.parentNode;</span>
<a href="#l2.695"></a><span id="l2.695" class="difflineplus">+      }</span>
<a href="#l2.696"></a><span id="l2.696" class="difflineplus">+</span>
<a href="#l2.697"></a><span id="l2.697" class="difflineplus">+      if ((event.type != &quot;drop&quot;) &amp;&amp; (event.type != &quot;dragover&quot;))</span>
<a href="#l2.698"></a><span id="l2.698" class="difflineplus">+        return tab;</span>
<a href="#l2.699"></a><span id="l2.699" class="difflineplus">+</span>
<a href="#l2.700"></a><span id="l2.700" class="difflineplus">+      let tabRect = tab.getBoundingClientRect();</span>
<a href="#l2.701"></a><span id="l2.701" class="difflineplus">+      if (event.screenX &lt; tab.screenX + tabRect.width * .25)</span>
<a href="#l2.702"></a><span id="l2.702" class="difflineplus">+        return null;</span>
<a href="#l2.703"></a><span id="l2.703" class="difflineplus">+</span>
<a href="#l2.704"></a><span id="l2.704" class="difflineplus">+      if (event.screenX &gt; tab.screenX + tabRect.width * .75)</span>
<a href="#l2.705"></a><span id="l2.705" class="difflineplus">+        return null;</span>
<a href="#l2.706"></a><span id="l2.706" class="difflineplus">+</span>
<a href="#l2.707"></a><span id="l2.707" class="difflineplus">+      return tab;</span>
<a href="#l2.708"></a><span id="l2.708" class="difflineplus">+    }</span>
<a href="#l2.709"></a><span id="l2.709" class="difflineplus">+</span>
<a href="#l2.710"></a><span id="l2.710" class="difflineplus">+    _getDropIndex(event) {</span>
<a href="#l2.711"></a><span id="l2.711" class="difflineplus">+      let tabs = this.allTabs;</span>
<a href="#l2.712"></a><span id="l2.712" class="difflineplus">+</span>
<a href="#l2.713"></a><span id="l2.713" class="difflineplus">+      if (window.getComputedStyle(this).direction == &quot;ltr&quot;) {</span>
<a href="#l2.714"></a><span id="l2.714" class="difflineplus">+        for (let i = 0; i &lt; tabs.length; i++)</span>
<a href="#l2.715"></a><span id="l2.715" class="difflineplus">+          if (event.screenX &lt; (tabs[i].screenX + (tabs[i].getBoundingClientRect().width / 2)))</span>
<a href="#l2.716"></a><span id="l2.716" class="difflineplus">+            return i;</span>
<a href="#l2.717"></a><span id="l2.717" class="difflineplus">+      } else {</span>
<a href="#l2.718"></a><span id="l2.718" class="difflineplus">+        for (let i = 0; i &lt; tabs.length; i++)</span>
<a href="#l2.719"></a><span id="l2.719" class="difflineplus">+          if (event.screenX &gt; (tabs[i].screenX + (tabs[i].getBoundingClientRect().width / 2)))</span>
<a href="#l2.720"></a><span id="l2.720" class="difflineplus">+            return i;</span>
<a href="#l2.721"></a><span id="l2.721" class="difflineplus">+      }</span>
<a href="#l2.722"></a><span id="l2.722" class="difflineplus">+</span>
<a href="#l2.723"></a><span id="l2.723" class="difflineplus">+      return tabs.length;</span>
<a href="#l2.724"></a><span id="l2.724" class="difflineplus">+    }</span>
<a href="#l2.725"></a><span id="l2.725" class="difflineplus">+</span>
<a href="#l2.726"></a><span id="l2.726" class="difflineplus">+    disconnectedCallback() {</span>
<a href="#l2.727"></a><span id="l2.727" class="difflineplus">+      Services.prefs.removeObserver(&quot;mail.tabs.&quot;, this._prefObserver);</span>
<a href="#l2.728"></a><span id="l2.728" class="difflineplus">+</span>
<a href="#l2.729"></a><span id="l2.729" class="difflineplus">+      // Release timer to avoid reference cycles.</span>
<a href="#l2.730"></a><span id="l2.730" class="difflineplus">+      if (this._animateTimer) {</span>
<a href="#l2.731"></a><span id="l2.731" class="difflineplus">+        this._animateTimer.cancel();</span>
<a href="#l2.732"></a><span id="l2.732" class="difflineplus">+        this._animateTimer = null;</span>
<a href="#l2.733"></a><span id="l2.733" class="difflineplus">+      }</span>
<a href="#l2.734"></a><span id="l2.734" class="difflineplus">+</span>
<a href="#l2.735"></a><span id="l2.735" class="difflineplus">+      this.arrowScrollbox.removeEventListener(&quot;overflow&quot;, this);</span>
<a href="#l2.736"></a><span id="l2.736" class="difflineplus">+      this.arrowScrollbox.removeEventListener(&quot;underflow&quot;, this);</span>
<a href="#l2.737"></a><span id="l2.737" class="difflineplus">+    }</span>
<a href="#l2.738"></a><span id="l2.738" class="difflineplus">+  }</span>
<a href="#l2.739"></a><span id="l2.739" class="difflineplus">+</span>
<a href="#l2.740"></a><span id="l2.740" class="difflineplus">+  MozXULElement.implementCustomInterface(MozTabmailTabs, [Ci.nsITimerCallback]);</span>
<a href="#l2.741"></a><span id="l2.741" class="difflineplus">+  customElements.define(&quot;tabmail-tabs&quot;, MozTabmailTabs, { extends: &quot;tabs&quot; });</span>
<a href="#l2.742"></a><span id="l2.742" class="difflineplus">+}</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l3.1"></a><span id="l3.1" class="difflineminus">--- a/mail/base/content/tabmail.css</span>
<a href="#l3.2"></a><span id="l3.2" class="difflineplus">+++ b/mail/base/content/tabmail.css</span>
<a href="#l3.3"></a><span id="l3.3" class="difflineat">@@ -1,16 +1,12 @@</span>
<a href="#l3.4"></a><span id="l3.4"> /* This Source Code Form is subject to the terms of the Mozilla Public</span>
<a href="#l3.5"></a><span id="l3.5">  * License, v. 2.0. If a copy of the MPL was not distributed with this</span>
<a href="#l3.6"></a><span id="l3.6">  * file, You can obtain one at http://mozilla.org/MPL/2.0/. */</span>
<a href="#l3.7"></a><span id="l3.7"> </span>
<a href="#l3.8"></a><span id="l3.8" class="difflineminus">-#tabmail-tabs {</span>
<a href="#l3.9"></a><span id="l3.9" class="difflineminus">-  -moz-binding: url(&quot;chrome://messenger/content/tabmail.xml#tabmail-tabs&quot;);</span>
<a href="#l3.10"></a><span id="l3.10" class="difflineminus">-}</span>
<a href="#l3.11"></a><span id="l3.11" class="difflineminus">-</span>
<a href="#l3.12"></a><span id="l3.12"> .tabs-alltabs-popup {</span>
<a href="#l3.13"></a><span id="l3.13">   -moz-binding: url(&quot;chrome://messenger/content/tabmail.xml#tabmail-alltabs-popup&quot;);</span>
<a href="#l3.14"></a><span id="l3.14"> }</span>
<a href="#l3.15"></a><span id="l3.15"> </span>
<a href="#l3.16"></a><span id="l3.16"> .tab-label-container {</span>
<a href="#l3.17"></a><span id="l3.17">   overflow: hidden;</span>
<a href="#l3.18"></a><span id="l3.18"> }</span>
<a href="#l3.19"></a><span id="l3.19"> </span>
<a href="#l3.20"></a><span id="l3.20" class="difflineat">@@ -25,28 +21,29 @@</span>
<a href="#l3.21"></a><span id="l3.21"> .tab-label {</span>
<a href="#l3.22"></a><span id="l3.22">   white-space: nowrap;</span>
<a href="#l3.23"></a><span id="l3.23"> }</span>
<a href="#l3.24"></a><span id="l3.24"> </span>
<a href="#l3.25"></a><span id="l3.25"> .tab-close-button {</span>
<a href="#l3.26"></a><span id="l3.26">   display: none;</span>
<a href="#l3.27"></a><span id="l3.27"> }</span>
<a href="#l3.28"></a><span id="l3.28"> </span>
<a href="#l3.29"></a><span id="l3.29" class="difflineminus">-#tabmail-tabs &gt; .tabmail-tab:first-child &gt; .tab-stack &gt; .tab-content &gt;</span>
<a href="#l3.30"></a><span id="l3.30" class="difflineplus">+#tabmail-tabs &gt; arrowscrollbox &gt; .tabmail-tab:first-child &gt; .tab-stack &gt; .tab-content &gt;</span>
<a href="#l3.31"></a><span id="l3.31"> .tab-close-button {</span>
<a href="#l3.32"></a><span id="l3.32">   visibility: collapse;</span>
<a href="#l3.33"></a><span id="l3.33"> }</span>
<a href="#l3.34"></a><span id="l3.34"> </span>
<a href="#l3.35"></a><span id="l3.35"> #tabmail-tabs:not([closebuttons=&quot;noclose&quot;]):not([closebuttons=&quot;closeatend&quot;]) &gt;</span>
<a href="#l3.36"></a><span id="l3.36" class="difflineminus">-.tabmail-tab[selected=&quot;true&quot;]:not(:only-child) &gt; .tab-stack &gt; .tab-content &gt; .tab-close-button {</span>
<a href="#l3.37"></a><span id="l3.37" class="difflineplus">+arrowscrollbox &gt; .tabmail-tab[selected=&quot;true&quot;]:not(:only-child) &gt; .tab-stack &gt;</span>
<a href="#l3.38"></a><span id="l3.38" class="difflineplus">+.tab-content &gt; .tab-close-button {</span>
<a href="#l3.39"></a><span id="l3.39">   display: -moz-box;</span>
<a href="#l3.40"></a><span id="l3.40"> }</span>
<a href="#l3.41"></a><span id="l3.41"> </span>
<a href="#l3.42"></a><span id="l3.42" class="difflineminus">-#tabmail-tabs[closebuttons=&quot;alltabs&quot;] &gt; .tabmail-tab:not(:only-child) &gt;</span>
<a href="#l3.43"></a><span id="l3.43" class="difflineminus">-.tab-stack &gt; .tab-content &gt; .tab-close-button {</span>
<a href="#l3.44"></a><span id="l3.44" class="difflineplus">+#tabmail-tabs[closebuttons=&quot;alltabs&quot;] &gt; arrowscrollbox &gt;</span>
<a href="#l3.45"></a><span id="l3.45" class="difflineplus">+.tabmail-tab:not(:only-child) &gt; .tab-stack &gt; .tab-content &gt; .tab-close-button {</span>
<a href="#l3.46"></a><span id="l3.46">   display: -moz-box;</span>
<a href="#l3.47"></a><span id="l3.47"> }</span>
<a href="#l3.48"></a><span id="l3.48"> </span>
<a href="#l3.49"></a><span id="l3.49"> .tab-drop-indicator-box {</span>
<a href="#l3.50"></a><span id="l3.50">   -moz-box-align: end;</span>
<a href="#l3.51"></a><span id="l3.51"> }</span>
<a href="#l3.52"></a><span id="l3.52"> </span>
<a href="#l3.53"></a><span id="l3.53"> .tab-drop-indicator {</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l4.1"></a><span id="l4.1" class="difflineminus">--- a/mail/base/content/tabmail.xml</span>
<a href="#l4.2"></a><span id="l4.2" class="difflineplus">+++ b/mail/base/content/tabmail.xml</span>
<a href="#l4.3"></a><span id="l4.3" class="difflineat">@@ -317,18 +317,23 @@</span>
<a href="#l4.4"></a><span id="l4.4">         new Set();</span>
<a href="#l4.5"></a><span id="l4.5">       &lt;/field&gt;</span>
<a href="#l4.6"></a><span id="l4.6">       &lt;field name=&quot;unrestoredTabs&quot; readonly=&quot;true&quot;&gt;</span>
<a href="#l4.7"></a><span id="l4.7">         [];</span>
<a href="#l4.8"></a><span id="l4.8">       &lt;/field&gt;</span>
<a href="#l4.9"></a><span id="l4.9">       &lt;method name=&quot;createTooltip&quot;&gt;</span>
<a href="#l4.10"></a><span id="l4.10">         &lt;parameter name=&quot;event&quot;/&gt;</span>
<a href="#l4.11"></a><span id="l4.11">         &lt;body&gt;&lt;![CDATA[</span>
<a href="#l4.12"></a><span id="l4.12" class="difflineplus">+          let tab = document.tooltipNode ? document.tooltipNode.closest(&quot;tab&quot;) : null;</span>
<a href="#l4.13"></a><span id="l4.13" class="difflineplus">+          if (!tab) {</span>
<a href="#l4.14"></a><span id="l4.14" class="difflineplus">+            event.preventDefault();</span>
<a href="#l4.15"></a><span id="l4.15" class="difflineplus">+            return;</span>
<a href="#l4.16"></a><span id="l4.16" class="difflineplus">+          }</span>
<a href="#l4.17"></a><span id="l4.17">           event.stopPropagation();</span>
<a href="#l4.18"></a><span id="l4.18" class="difflineminus">-          let tab = document.tab;</span>
<a href="#l4.19"></a><span id="l4.19" class="difflineplus">+</span>
<a href="#l4.20"></a><span id="l4.20">           if (tab.localName != &quot;tab&quot; || this.tabContainer.draggedTab) {</span>
<a href="#l4.21"></a><span id="l4.21">             event.preventDefault();</span>
<a href="#l4.22"></a><span id="l4.22">             return;</span>
<a href="#l4.23"></a><span id="l4.23">           }</span>
<a href="#l4.24"></a><span id="l4.24">           event.target.setAttribute(&quot;label&quot;, tab.mOverCloseButton ?</span>
<a href="#l4.25"></a><span id="l4.25">                                              tab.firstChild.getAttribute(&quot;closetabtext&quot;) :</span>
<a href="#l4.26"></a><span id="l4.26">                                              tab.getAttribute(&quot;label&quot;));</span>
<a href="#l4.27"></a><span id="l4.27"> </span>
<a href="#l4.28"></a><span id="l4.28" class="difflineat">@@ -417,31 +422,31 @@</span>
<a href="#l4.29"></a><span id="l4.29">         &lt;parameter name=&quot;aDefaultToCurrent&quot;/&gt;</span>
<a href="#l4.30"></a><span id="l4.30">         &lt;body&gt;&lt;![CDATA[</span>
<a href="#l4.31"></a><span id="l4.31">           let iTab, tab, tabNode;</span>
<a href="#l4.32"></a><span id="l4.32">           if (aTabIndexNodeOrInfo == null) {</span>
<a href="#l4.33"></a><span id="l4.33">             if (!aDefaultToCurrent)</span>
<a href="#l4.34"></a><span id="l4.34">               throw new Error(&quot;You need to specify a tab!&quot;);</span>
<a href="#l4.35"></a><span id="l4.35">             iTab = this.tabContainer.selectedIndex;</span>
<a href="#l4.36"></a><span id="l4.36">             return [iTab, this.tabInfo[iTab],</span>
<a href="#l4.37"></a><span id="l4.37" class="difflineminus">-                    this.tabContainer.childNodes[iTab]];</span>
<a href="#l4.38"></a><span id="l4.38" class="difflineplus">+                    this.tabContainer.allTabs[iTab]];</span>
<a href="#l4.39"></a><span id="l4.39">           }</span>
<a href="#l4.40"></a><span id="l4.40"> </span>
<a href="#l4.41"></a><span id="l4.41">           if (typeof(aTabIndexNodeOrInfo) == &quot;number&quot;) {</span>
<a href="#l4.42"></a><span id="l4.42">             iTab = aTabIndexNodeOrInfo;</span>
<a href="#l4.43"></a><span id="l4.43" class="difflineminus">-            tabNode = this.tabContainer.childNodes[iTab];</span>
<a href="#l4.44"></a><span id="l4.44" class="difflineplus">+            tabNode = this.tabContainer.allTabs[iTab];</span>
<a href="#l4.45"></a><span id="l4.45">             tab = this.tabInfo[iTab];</span>
<a href="#l4.46"></a><span id="l4.46">           } else if (aTabIndexNodeOrInfo.tagName &amp;&amp; aTabIndexNodeOrInfo.tagName == &quot;tab&quot;) {</span>
<a href="#l4.47"></a><span id="l4.47">             tabNode = aTabIndexNodeOrInfo;</span>
<a href="#l4.48"></a><span id="l4.48">             iTab = this.tabContainer.getIndexOfItem(tabNode);</span>
<a href="#l4.49"></a><span id="l4.49">             tab = this.tabInfo[iTab];</span>
<a href="#l4.50"></a><span id="l4.50">           } else {</span>
<a href="#l4.51"></a><span id="l4.51">             tab = aTabIndexNodeOrInfo;</span>
<a href="#l4.52"></a><span id="l4.52">             iTab = this.tabInfo.indexOf(tab);</span>
<a href="#l4.53"></a><span id="l4.53" class="difflineminus">-            tabNode = (iTab &gt;= 0) ? this.tabContainer.childNodes[iTab] : null;</span>
<a href="#l4.54"></a><span id="l4.54" class="difflineplus">+            tabNode = (iTab &gt;= 0) ? this.tabContainer.allTabs[iTab] : null;</span>
<a href="#l4.55"></a><span id="l4.55">           }</span>
<a href="#l4.56"></a><span id="l4.56"> </span>
<a href="#l4.57"></a><span id="l4.57">           return [iTab, tab, tabNode];</span>
<a href="#l4.58"></a><span id="l4.58">         ]]&gt;&lt;/body&gt;</span>
<a href="#l4.59"></a><span id="l4.59">       &lt;/method&gt;</span>
<a href="#l4.60"></a><span id="l4.60">       &lt;method name=&quot;openFirstTab&quot;&gt;</span>
<a href="#l4.61"></a><span id="l4.61">         &lt;body&gt;&lt;![CDATA[</span>
<a href="#l4.62"></a><span id="l4.62">           // From the moment of creation, our XBL binding already has a visible</span>
<a href="#l4.63"></a><span id="l4.63" class="difflineat">@@ -563,23 +568,23 @@</span>
<a href="#l4.64"></a><span id="l4.64">           // so that if the new tab is closed without switching, we can switch</span>
<a href="#l4.65"></a><span id="l4.65">           // back to the opener tab.</span>
<a href="#l4.66"></a><span id="l4.66">           if (disregardOpener)</span>
<a href="#l4.67"></a><span id="l4.67">             this.mLastTabOpener = null;</span>
<a href="#l4.68"></a><span id="l4.68">           else</span>
<a href="#l4.69"></a><span id="l4.69">             this.mLastTabOpener = oldTab;</span>
<a href="#l4.70"></a><span id="l4.70"> </span>
<a href="#l4.71"></a><span id="l4.71">           // the order of the following statements is important</span>
<a href="#l4.72"></a><span id="l4.72" class="difflineminus">-          this.tabInfo[this.tabContainer.childNodes.length - 1] = tab;</span>
<a href="#l4.73"></a><span id="l4.73" class="difflineplus">+          this.tabInfo[this.tabContainer.allTabs.length - 1] = tab;</span>
<a href="#l4.74"></a><span id="l4.74">           if (!background) {</span>
<a href="#l4.75"></a><span id="l4.75">             this.currentTabInfo = tab;</span>
<a href="#l4.76"></a><span id="l4.76">             // this has a side effect of calling updateCurrentTab, but our</span>
<a href="#l4.77"></a><span id="l4.77">             //  setting currentTabInfo above will cause it to take no action.</span>
<a href="#l4.78"></a><span id="l4.78">             this.tabContainer.selectedIndex =</span>
<a href="#l4.79"></a><span id="l4.79" class="difflineminus">-              this.tabContainer.childNodes.length - 1;</span>
<a href="#l4.80"></a><span id="l4.80" class="difflineplus">+              this.tabContainer.allTabs.length - 1;</span>
<a href="#l4.81"></a><span id="l4.81">           }</span>
<a href="#l4.82"></a><span id="l4.82"> </span>
<a href="#l4.83"></a><span id="l4.83">           // make sure we are on the right panel</span>
<a href="#l4.84"></a><span id="l4.84">           if (tab.mode.tabType.perTabPanel) {</span>
<a href="#l4.85"></a><span id="l4.85">             // should we create the element for them, or will they do it?</span>
<a href="#l4.86"></a><span id="l4.86">             if (typeof(tab.mode.tabType.perTabPanel) == &quot;string&quot;) {</span>
<a href="#l4.87"></a><span id="l4.87">               tab.panel = document.createXULElement(tab.mode.tabType.perTabPanel);</span>
<a href="#l4.88"></a><span id="l4.88">             } else {</span>
<a href="#l4.89"></a><span id="l4.89" class="difflineat">@@ -743,17 +748,17 @@</span>
<a href="#l4.90"></a><span id="l4.90"> </span>
<a href="#l4.91"></a><span id="l4.91">           if (!history.tab)</span>
<a href="#l4.92"></a><span id="l4.92">             return;</span>
<a href="#l4.93"></a><span id="l4.93"> </span>
<a href="#l4.94"></a><span id="l4.94">           if (!this.restoreTab(JSON.parse(history.tab)))</span>
<a href="#l4.95"></a><span id="l4.95">             return;</span>
<a href="#l4.96"></a><span id="l4.96"> </span>
<a href="#l4.97"></a><span id="l4.97">           let idx = Math.min(history.idx, this.tabInfo.length);</span>
<a href="#l4.98"></a><span id="l4.98" class="difflineminus">-          let tab = this.tabContainer.childNodes[this.tabInfo.length - 1];</span>
<a href="#l4.99"></a><span id="l4.99" class="difflineplus">+          let tab = this.tabContainer.allTabs[this.tabInfo.length - 1];</span>
<a href="#l4.100"></a><span id="l4.100">           this.moveTabTo(tab, idx);</span>
<a href="#l4.101"></a><span id="l4.101"> </span>
<a href="#l4.102"></a><span id="l4.102">           this.switchToTab(tab);</span>
<a href="#l4.103"></a><span id="l4.103"> </span>
<a href="#l4.104"></a><span id="l4.104">         ]]&gt;&lt;/body&gt;</span>
<a href="#l4.105"></a><span id="l4.105">       &lt;/method&gt;</span>
<a href="#l4.106"></a><span id="l4.106">       &lt;method name=&quot;closeTab&quot;&gt;</span>
<a href="#l4.107"></a><span id="l4.107">         &lt;parameter name=&quot;aOptTabIndexNodeOrInfo&quot;/&gt;</span>
<a href="#l4.108"></a><span id="l4.108" class="difflineat">@@ -806,17 +811,17 @@</span>
<a href="#l4.109"></a><span id="l4.109">             tab.mode.tabs.splice(tab.mode.tabs.indexOf(tab), 1);</span>
<a href="#l4.110"></a><span id="l4.110">             tabNode.remove();</span>
<a href="#l4.111"></a><span id="l4.111"> </span>
<a href="#l4.112"></a><span id="l4.112">             if (this.tabContainer.selectedIndex == -1) {</span>
<a href="#l4.113"></a><span id="l4.113">               if (this.mLastTabOpener &amp;&amp; this.tabInfo.includes(this.mLastTabOpener)) {</span>
<a href="#l4.114"></a><span id="l4.114">                 this.tabContainer.selectedIndex = this.tabInfo.indexOf(this.mLastTabOpener);</span>
<a href="#l4.115"></a><span id="l4.115">               } else {</span>
<a href="#l4.116"></a><span id="l4.116">                 this.tabContainer.selectedIndex =</span>
<a href="#l4.117"></a><span id="l4.117" class="difflineminus">-                  (iTab == this.tabContainer.childNodes.length) ? iTab - 1 : iTab;</span>
<a href="#l4.118"></a><span id="l4.118" class="difflineplus">+                  (iTab == this.tabContainer.allTabs.length) ? iTab - 1 : iTab;</span>
<a href="#l4.119"></a><span id="l4.119">               }</span>
<a href="#l4.120"></a><span id="l4.120">             }</span>
<a href="#l4.121"></a><span id="l4.121"> </span>
<a href="#l4.122"></a><span id="l4.122">             // Clear the last tab opener - we don't need this anymore.</span>
<a href="#l4.123"></a><span id="l4.123">             this.mLastTabOpener = null;</span>
<a href="#l4.124"></a><span id="l4.124"> </span>
<a href="#l4.125"></a><span id="l4.125">             if (this.currentTabInfo == tab)</span>
<a href="#l4.126"></a><span id="l4.126">               this.updateCurrentTab();</span>
<a href="#l4.127"></a><span id="l4.127" class="difflineat">@@ -825,17 +830,17 @@</span>
<a href="#l4.128"></a><span id="l4.128">               tab.panel.remove();</span>
<a href="#l4.129"></a><span id="l4.129">               delete tab.panel;</span>
<a href="#l4.130"></a><span id="l4.130"> </span>
<a href="#l4.131"></a><span id="l4.131">               // Ensure current tab is still selected and displayed in the</span>
<a href="#l4.132"></a><span id="l4.132">               // panelContainer.</span>
<a href="#l4.133"></a><span id="l4.133">               this.panelContainer.selectedPanel =</span>
<a href="#l4.134"></a><span id="l4.134">                 this.currentTabInfo.panel || this.currentTabInfo.mode.tabType.panel;</span>
<a href="#l4.135"></a><span id="l4.135">             }</span>
<a href="#l4.136"></a><span id="l4.136" class="difflineminus">-            if (this.tabContainer.childNodes.length == 1 &amp;&amp;</span>
<a href="#l4.137"></a><span id="l4.137" class="difflineplus">+            if (this.tabContainer.allTabs.length == 1 &amp;&amp;</span>
<a href="#l4.138"></a><span id="l4.138">                 this.tabContainer.mAutoHide)</span>
<a href="#l4.139"></a><span id="l4.139">               this.tabContainer.mCollapseToolbar.collapsed = true;</span>
<a href="#l4.140"></a><span id="l4.140">           ]]&gt;</span>
<a href="#l4.141"></a><span id="l4.141">         &lt;/body&gt;</span>
<a href="#l4.142"></a><span id="l4.142">       &lt;/method&gt;</span>
<a href="#l4.143"></a><span id="l4.143">       &lt;method name=&quot;removeTabByNode&quot;&gt;</span>
<a href="#l4.144"></a><span id="l4.144">         &lt;parameter name=&quot;aTabNode&quot;/&gt;</span>
<a href="#l4.145"></a><span id="l4.145">         &lt;body&gt;</span>
<a href="#l4.146"></a><span id="l4.146" class="difflineat">@@ -939,17 +944,17 @@</span>
<a href="#l4.147"></a><span id="l4.147"> </span>
<a href="#l4.148"></a><span id="l4.148">           // as we removed items, we might need to update indices</span>
<a href="#l4.149"></a><span id="l4.149">           if (oldIdx &lt; aIndex) {</span>
<a href="#l4.150"></a><span id="l4.150">             aIndex--;</span>
<a href="#l4.151"></a><span id="l4.151">           }</span>
<a href="#l4.152"></a><span id="l4.152"> </span>
<a href="#l4.153"></a><span id="l4.153">           // Read it into tabInfo and the tabContainer</span>
<a href="#l4.154"></a><span id="l4.154">           this.tabInfo.splice(aIndex, 0, tab);</span>
<a href="#l4.155"></a><span id="l4.155" class="difflineminus">-          this.tabContainer.insertBefore(tabNode, this.tabContainer.childNodes[aIndex]);</span>
<a href="#l4.156"></a><span id="l4.156" class="difflineplus">+          this.tabContainer.insertBefore(tabNode, this.tabContainer.allTabs[aIndex]);</span>
<a href="#l4.157"></a><span id="l4.157"> </span>
<a href="#l4.158"></a><span id="l4.158">           // Now it's getting a bit ugly, as tabModes stores redundant</span>
<a href="#l4.159"></a><span id="l4.159">           // information we need to get it in sync with tabInfo.</span>
<a href="#l4.160"></a><span id="l4.160">           //</span>
<a href="#l4.161"></a><span id="l4.161">           // As tabModes.tabs is a subset of tabInfo, every tab can be mapped</span>
<a href="#l4.162"></a><span id="l4.162">           // to a tabInfo index. So we check for each tab in tabModes if it is</span>
<a href="#l4.163"></a><span id="l4.163">           // directly in front of our moved tab. We do this by looking up the</span>
<a href="#l4.164"></a><span id="l4.164">           // index in tabInfo and compare it with the moved tab's index. If we</span>
<a href="#l4.165"></a><span id="l4.165" class="difflineat">@@ -1224,17 +1229,17 @@</span>
<a href="#l4.166"></a><span id="l4.166">             }</span>
<a href="#l4.167"></a><span id="l4.167">           }</span>
<a href="#l4.168"></a><span id="l4.168">           return null;</span>
<a href="#l4.169"></a><span id="l4.169">         ]]&gt;&lt;/body&gt;</span>
<a href="#l4.170"></a><span id="l4.170">       &lt;/method&gt;</span>
<a href="#l4.171"></a><span id="l4.171">       &lt;method name=&quot;removeCurrentTab&quot;&gt;</span>
<a href="#l4.172"></a><span id="l4.172">         &lt;body&gt;&lt;![CDATA[</span>
<a href="#l4.173"></a><span id="l4.173">           this.removeTabByNode(</span>
<a href="#l4.174"></a><span id="l4.174" class="difflineminus">-            this.tabContainer.childNodes[this.tabContainer.selectedIndex]);</span>
<a href="#l4.175"></a><span id="l4.175" class="difflineplus">+            this.tabContainer.allTabs[this.tabContainer.selectedIndex]);</span>
<a href="#l4.176"></a><span id="l4.176">         ]]&gt;&lt;/body&gt;</span>
<a href="#l4.177"></a><span id="l4.177">       &lt;/method&gt;</span>
<a href="#l4.178"></a><span id="l4.178">       &lt;method name=&quot;switchToTab&quot;&gt;</span>
<a href="#l4.179"></a><span id="l4.179">         &lt;parameter name=&quot;aTabIndexNodeOrInfo&quot;/&gt;</span>
<a href="#l4.180"></a><span id="l4.180">         &lt;body&gt;</span>
<a href="#l4.181"></a><span id="l4.181">           &lt;![CDATA[</span>
<a href="#l4.182"></a><span id="l4.182">             let [iTab] =</span>
<a href="#l4.183"></a><span id="l4.183">               this._getTabContextForTabbyThing(aTabIndexNodeOrInfo, false);</span>
<a href="#l4.184"></a><span id="l4.184" class="difflineat">@@ -1325,17 +1330,17 @@</span>
<a href="#l4.185"></a><span id="l4.185">         &lt;parameter name=&quot;aTabNodeOrInfo&quot;/&gt;</span>
<a href="#l4.186"></a><span id="l4.186">         &lt;body&gt;</span>
<a href="#l4.187"></a><span id="l4.187">           &lt;![CDATA[</span>
<a href="#l4.188"></a><span id="l4.188">             let [iTab, tab] =</span>
<a href="#l4.189"></a><span id="l4.189">               this._getTabContextForTabbyThing(aTabNodeOrInfo, true);</span>
<a href="#l4.190"></a><span id="l4.190"> </span>
<a href="#l4.191"></a><span id="l4.191">             if (tab) {</span>
<a href="#l4.192"></a><span id="l4.192">               let tabNode =</span>
<a href="#l4.193"></a><span id="l4.193" class="difflineminus">-                this.tabContainer.childNodes[iTab];</span>
<a href="#l4.194"></a><span id="l4.194" class="difflineplus">+                this.tabContainer.allTabs[iTab];</span>
<a href="#l4.195"></a><span id="l4.195"> </span>
<a href="#l4.196"></a><span id="l4.196">               let titleChangeFunc = tab.mode.onTitleChanged ||</span>
<a href="#l4.197"></a><span id="l4.197">                                     tab.mode.tabType.onTitleChanged;</span>
<a href="#l4.198"></a><span id="l4.198">               if (titleChangeFunc) {</span>
<a href="#l4.199"></a><span id="l4.199">                 titleChangeFunc.call(tab.mode.tabType, tab, tabNode);</span>
<a href="#l4.200"></a><span id="l4.200">               }</span>
<a href="#l4.201"></a><span id="l4.201"> </span>
<a href="#l4.202"></a><span id="l4.202">               let defaultTabTitle = document.documentElement.getAttribute(&quot;defaultTabTitle&quot;);</span>
<a href="#l4.203"></a><span id="l4.203" class="difflineat">@@ -1379,17 +1384,17 @@</span>
<a href="#l4.204"></a><span id="l4.204">         &lt;parameter name=&quot;aTabNodeOrInfo&quot;/&gt;</span>
<a href="#l4.205"></a><span id="l4.205">         &lt;parameter name=&quot;aIcon&quot;/&gt;</span>
<a href="#l4.206"></a><span id="l4.206">         &lt;body&gt;</span>
<a href="#l4.207"></a><span id="l4.207">           &lt;![CDATA[</span>
<a href="#l4.208"></a><span id="l4.208">             let [iTab, tab] =</span>
<a href="#l4.209"></a><span id="l4.209">               this._getTabContextForTabbyThing(aTabNodeOrInfo, true);</span>
<a href="#l4.210"></a><span id="l4.210"> </span>
<a href="#l4.211"></a><span id="l4.211">             if (tab) {</span>
<a href="#l4.212"></a><span id="l4.212" class="difflineminus">-              let tabNode = this.tabContainer.childNodes[iTab];</span>
<a href="#l4.213"></a><span id="l4.213" class="difflineplus">+              let tabNode = this.tabContainer.allTabs[iTab];</span>
<a href="#l4.214"></a><span id="l4.214">               let oldIcon = tabNode.getAttribute(&quot;image&quot;);</span>
<a href="#l4.215"></a><span id="l4.215"> </span>
<a href="#l4.216"></a><span id="l4.216">               if (oldIcon != aIcon &amp;&amp; !tab.beforeTabOpen) {</span>
<a href="#l4.217"></a><span id="l4.217">                 let evt = new CustomEvent(&quot;TabAttrModified&quot;, {</span>
<a href="#l4.218"></a><span id="l4.218">                   bubbles: true,</span>
<a href="#l4.219"></a><span id="l4.219">                   cancelable: false,</span>
<a href="#l4.220"></a><span id="l4.220">                   detail: { changed: [&quot;image&quot;], tabInfo: tab },</span>
<a href="#l4.221"></a><span id="l4.221">                 });</span>
<a href="#l4.222"></a><span id="l4.222" class="difflineat">@@ -1784,854 +1789,16 @@</span>
<a href="#l4.223"></a><span id="l4.223">                                     .chromeEventHandler;</span>
<a href="#l4.224"></a><span id="l4.224">           this._callTabListeners(&quot;onRefreshAttempted&quot;, [browser, ...arguments]);</span>
<a href="#l4.225"></a><span id="l4.225">         ]]&gt;&lt;/body&gt;</span>
<a href="#l4.226"></a><span id="l4.226">       &lt;/method&gt;</span>
<a href="#l4.227"></a><span id="l4.227"> </span>
<a href="#l4.228"></a><span id="l4.228">     &lt;/implementation&gt;</span>
<a href="#l4.229"></a><span id="l4.229">   &lt;/binding&gt;</span>
<a href="#l4.230"></a><span id="l4.230"> </span>
<a href="#l4.231"></a><span id="l4.231" class="difflineminus">-  &lt;binding id=&quot;tabmail-tabs&quot;</span>
<a href="#l4.232"></a><span id="l4.232" class="difflineminus">-           extends=&quot;chrome://global/content/bindings/tabbox.xml#tabs&quot;&gt;</span>
<a href="#l4.233"></a><span id="l4.233" class="difflineminus">-    &lt;content context=&quot;toolbar-context-menu&quot;&gt;</span>
<a href="#l4.234"></a><span id="l4.234" class="difflineminus">-      &lt;xul:vbox flex=&quot;1&quot;&gt;</span>
<a href="#l4.235"></a><span id="l4.235" class="difflineminus">-        &lt;xul:hbox&gt;</span>
<a href="#l4.236"></a><span id="l4.236" class="difflineminus">-          &lt;xul:hbox class=&quot;tab-drop-indicator-box&quot;&gt;</span>
<a href="#l4.237"></a><span id="l4.237" class="difflineminus">-            &lt;xul:image class=&quot;tab-drop-indicator&quot;</span>
<a href="#l4.238"></a><span id="l4.238" class="difflineminus">-                       anonid=&quot;tab-drop-indicator&quot;</span>
<a href="#l4.239"></a><span id="l4.239" class="difflineminus">-                       collapsed=&quot;true&quot;/&gt;</span>
<a href="#l4.240"></a><span id="l4.240" class="difflineminus">-          &lt;/xul:hbox&gt;</span>
<a href="#l4.241"></a><span id="l4.241" class="difflineminus">-          &lt;xul:arrowscrollbox class=&quot;tabmail-arrowscrollbox&quot;</span>
<a href="#l4.242"></a><span id="l4.242" class="difflineminus">-                              anonid=&quot;arrowscrollbox&quot;</span>
<a href="#l4.243"></a><span id="l4.243" class="difflineminus">-                              orient=&quot;horizontal&quot;</span>
<a href="#l4.244"></a><span id="l4.244" class="difflineminus">-                              flex=&quot;1&quot;</span>
<a href="#l4.245"></a><span id="l4.245" class="difflineminus">-                              style=&quot;min-width: 1px;&quot;</span>
<a href="#l4.246"></a><span id="l4.246" class="difflineminus">-                              clicktoscroll=&quot;true&quot;&gt;</span>
<a href="#l4.247"></a><span id="l4.247" class="difflineminus">-            &lt;children includes=&quot;tab&quot;/&gt;</span>
<a href="#l4.248"></a><span id="l4.248" class="difflineminus">-          &lt;/xul:arrowscrollbox&gt;</span>
<a href="#l4.249"></a><span id="l4.249" class="difflineminus">-          &lt;children/&gt;</span>
<a href="#l4.250"></a><span id="l4.250" class="difflineminus">-          &lt;xul:hbox class=&quot;tabs-closebutton-box&quot;</span>
<a href="#l4.251"></a><span id="l4.251" class="difflineminus">-                    anonid=&quot;tabstrip-closebutton&quot;</span>
<a href="#l4.252"></a><span id="l4.252" class="difflineminus">-                    align=&quot;center&quot;</span>
<a href="#l4.253"></a><span id="l4.253" class="difflineminus">-                    pack=&quot;end&quot;&gt;</span>
<a href="#l4.254"></a><span id="l4.254" class="difflineminus">-            &lt;xul:image class=&quot;close-icon tabs-closebutton&quot;/&gt;</span>
<a href="#l4.255"></a><span id="l4.255" class="difflineminus">-          &lt;/xul:hbox&gt;</span>
<a href="#l4.256"></a><span id="l4.256" class="difflineminus">-        &lt;/xul:hbox&gt;</span>
<a href="#l4.257"></a><span id="l4.257" class="difflineminus">-      &lt;/xul:vbox&gt;</span>
<a href="#l4.258"></a><span id="l4.258" class="difflineminus">-      &lt;xul:stack align=&quot;center&quot;</span>
<a href="#l4.259"></a><span id="l4.259" class="difflineminus">-                 pack=&quot;end&quot;</span>
<a href="#l4.260"></a><span id="l4.260" class="difflineminus">-                 class=&quot;scrollbutton-down-stack&quot;&gt;</span>
<a href="#l4.261"></a><span id="l4.261" class="difflineminus">-        &lt;xul:hbox flex=&quot;1&quot;</span>
<a href="#l4.262"></a><span id="l4.262" class="difflineminus">-                  class=&quot;scrollbutton-down-box&quot;</span>
<a href="#l4.263"></a><span id="l4.263" class="difflineminus">-                  collapsed=&quot;true&quot;</span>
<a href="#l4.264"></a><span id="l4.264" class="difflineminus">-                  anonid=&quot;down-box&quot;/&gt;</span>
<a href="#l4.265"></a><span id="l4.265" class="difflineminus">-        &lt;xul:hbox flex=&quot;1&quot;</span>
<a href="#l4.266"></a><span id="l4.266" class="difflineminus">-                  class=&quot;scrollbutton-down-box-animate&quot;</span>
<a href="#l4.267"></a><span id="l4.267" class="difflineminus">-                  collapsed=&quot;true&quot;</span>
<a href="#l4.268"></a><span id="l4.268" class="difflineminus">-                  anonid=&quot;down-box-animate&quot;/&gt;</span>
<a href="#l4.269"></a><span id="l4.269" class="difflineminus">-      &lt;/xul:stack&gt;</span>
<a href="#l4.270"></a><span id="l4.270" class="difflineminus">-    &lt;/content&gt;</span>
<a href="#l4.271"></a><span id="l4.271" class="difflineminus">-</span>
<a href="#l4.272"></a><span id="l4.272" class="difflineminus">-    &lt;implementation implements=&quot;nsITimerCallback&quot;&gt;</span>
<a href="#l4.273"></a><span id="l4.273" class="difflineminus">-      &lt;constructor&gt;</span>
<a href="#l4.274"></a><span id="l4.274" class="difflineminus">-        &lt;![CDATA[</span>
<a href="#l4.275"></a><span id="l4.275" class="difflineminus">-          const {Services} = ChromeUtils.import(&quot;resource://gre/modules/Services.jsm&quot;);</span>
<a href="#l4.276"></a><span id="l4.276" class="difflineminus">-</span>
<a href="#l4.277"></a><span id="l4.277" class="difflineminus">-          this.mTabMinWidth = Services.prefs.getIntPref(&quot;mail.tabs.tabMinWidth&quot;);</span>
<a href="#l4.278"></a><span id="l4.278" class="difflineminus">-          this.mTabMaxWidth = Services.prefs.getIntPref(&quot;mail.tabs.tabMaxWidth&quot;);</span>
<a href="#l4.279"></a><span id="l4.279" class="difflineminus">-          this.mTabClipWidth = Services.prefs.getIntPref(&quot;mail.tabs.tabClipWidth&quot;);</span>
<a href="#l4.280"></a><span id="l4.280" class="difflineminus">-          this.mCloseButtons = Services.prefs.getIntPref(&quot;mail.tabs.closeButtons&quot;);</span>
<a href="#l4.281"></a><span id="l4.281" class="difflineminus">-          this.mAutoHide = Services.prefs.getBoolPref(&quot;mail.tabs.autoHide&quot;);</span>
<a href="#l4.282"></a><span id="l4.282" class="difflineminus">-</span>
<a href="#l4.283"></a><span id="l4.283" class="difflineminus">-          if (this.mAutoHide)</span>
<a href="#l4.284"></a><span id="l4.284" class="difflineminus">-            this.mCollapseToolbar.collapsed = true;</span>
<a href="#l4.285"></a><span id="l4.285" class="difflineminus">-</span>
<a href="#l4.286"></a><span id="l4.286" class="difflineminus">-          this.firstChild.minWidth = this.mTabMinWidth;</span>
<a href="#l4.287"></a><span id="l4.287" class="difflineminus">-          this.firstChild.maxWidth = this.mTabMaxWidth;</span>
<a href="#l4.288"></a><span id="l4.288" class="difflineminus">-          this._updateCloseButtons();</span>
<a href="#l4.289"></a><span id="l4.289" class="difflineminus">-          this._initializeArrowScrollbox();</span>
<a href="#l4.290"></a><span id="l4.290" class="difflineminus">-</span>
<a href="#l4.291"></a><span id="l4.291" class="difflineminus">-          Services.prefs.addObserver(&quot;mail.tabs.&quot;, this._prefObserver);</span>
<a href="#l4.292"></a><span id="l4.292" class="difflineminus">-</span>
<a href="#l4.293"></a><span id="l4.293" class="difflineminus">-          window.addEventListener(&quot;resize&quot;, this);</span>
<a href="#l4.294"></a><span id="l4.294" class="difflineminus">-</span>
<a href="#l4.295"></a><span id="l4.295" class="difflineminus">-          // Listen to overflow/underflow events on the tabstrip,</span>
<a href="#l4.296"></a><span id="l4.296" class="difflineminus">-          // we cannot put these as xbl handlers on the entire binding because</span>
<a href="#l4.297"></a><span id="l4.297" class="difflineminus">-          // they would also get called for the all-tabs popup scrollbox.</span>
<a href="#l4.298"></a><span id="l4.298" class="difflineminus">-          // Also, we can't rely on event.target because these are all</span>
<a href="#l4.299"></a><span id="l4.299" class="difflineminus">-          // anonymous nodes.</span>
<a href="#l4.300"></a><span id="l4.300" class="difflineminus">-          this.arrowScrollbox.addEventListener(&quot;overflow&quot;, this);</span>
<a href="#l4.301"></a><span id="l4.301" class="difflineminus">-          this.arrowScrollbox.addEventListener(&quot;underflow&quot;, this);</span>
<a href="#l4.302"></a><span id="l4.302" class="difflineminus">-        ]]&gt;</span>
<a href="#l4.303"></a><span id="l4.303" class="difflineminus">-      &lt;/constructor&gt;</span>
<a href="#l4.304"></a><span id="l4.304" class="difflineminus">-</span>
<a href="#l4.305"></a><span id="l4.305" class="difflineminus">-      &lt;destructor&gt;</span>
<a href="#l4.306"></a><span id="l4.306" class="difflineminus">-        &lt;![CDATA[</span>
<a href="#l4.307"></a><span id="l4.307" class="difflineminus">-          const {Services} = ChromeUtils.import(&quot;resource://gre/modules/Services.jsm&quot;);</span>
<a href="#l4.308"></a><span id="l4.308" class="difflineminus">-</span>
<a href="#l4.309"></a><span id="l4.309" class="difflineminus">-          Services.prefs.removeObserver(&quot;mail.tabs.&quot;, this._prefObserver);</span>
<a href="#l4.310"></a><span id="l4.310" class="difflineminus">-</span>
<a href="#l4.311"></a><span id="l4.311" class="difflineminus">-          // Release timer to avoid reference cycles.</span>
<a href="#l4.312"></a><span id="l4.312" class="difflineminus">-          if (this._animateTimer) {</span>
<a href="#l4.313"></a><span id="l4.313" class="difflineminus">-            this._animateTimer.cancel();</span>
<a href="#l4.314"></a><span id="l4.314" class="difflineminus">-            this._animateTimer = null;</span>
<a href="#l4.315"></a><span id="l4.315" class="difflineminus">-          }</span>
<a href="#l4.316"></a><span id="l4.316" class="difflineminus">-</span>
<a href="#l4.317"></a><span id="l4.317" class="difflineminus">-          this.arrowScrollbox.removeEventListener(&quot;overflow&quot;, this);</span>
<a href="#l4.318"></a><span id="l4.318" class="difflineminus">-          this.arrowScrollbox.removeEventListener(&quot;underflow&quot;, this);</span>
<a href="#l4.319"></a><span id="l4.319" class="difflineminus">-        ]]&gt;</span>
<a href="#l4.320"></a><span id="l4.320" class="difflineminus">-      &lt;/destructor&gt;</span>
<a href="#l4.321"></a><span id="l4.321" class="difflineminus">-</span>
<a href="#l4.322"></a><span id="l4.322" class="difflineminus">-      &lt;field name=&quot;tabmail&quot; readonly=&quot;true&quot;&gt;</span>
<a href="#l4.323"></a><span id="l4.323" class="difflineminus">-        document.getElementById(&quot;tabmail&quot;);</span>
<a href="#l4.324"></a><span id="l4.324" class="difflineminus">-      &lt;/field&gt;</span>
<a href="#l4.325"></a><span id="l4.325" class="difflineminus">-</span>
<a href="#l4.326"></a><span id="l4.326" class="difflineminus">-      &lt;field name=&quot;tabbox&quot; readonly=&quot;true&quot;&gt;</span>
<a href="#l4.327"></a><span id="l4.327" class="difflineminus">-        this.tabmail.tabbox;</span>
<a href="#l4.328"></a><span id="l4.328" class="difflineminus">-      &lt;/field&gt;</span>
<a href="#l4.329"></a><span id="l4.329" class="difflineminus">-</span>
<a href="#l4.330"></a><span id="l4.330" class="difflineminus">-      &lt;field name=&quot;arrowScrollboxWidth&quot;&gt;0&lt;/field&gt;</span>
<a href="#l4.331"></a><span id="l4.331" class="difflineminus">-</span>
<a href="#l4.332"></a><span id="l4.332" class="difflineminus">-      &lt;field name=&quot;arrowScrollbox&quot;&gt;</span>
<a href="#l4.333"></a><span id="l4.333" class="difflineminus">-        document.getAnonymousElementByAttribute(this, &quot;anonid&quot;, &quot;arrowscrollbox&quot;);</span>
<a href="#l4.334"></a><span id="l4.334" class="difflineminus">-      &lt;/field&gt;</span>
<a href="#l4.335"></a><span id="l4.335" class="difflineminus">-</span>
<a href="#l4.336"></a><span id="l4.336" class="difflineminus">-      &lt;field name=&quot;arrowScrollboxClosebutton&quot;&gt;</span>
<a href="#l4.337"></a><span id="l4.337" class="difflineminus">-        document.getAnonymousElementByAttribute(this, &quot;anonid&quot;, &quot;tabstrip-closebutton&quot;);</span>
<a href="#l4.338"></a><span id="l4.338" class="difflineminus">-      &lt;/field&gt;</span>
<a href="#l4.339"></a><span id="l4.339" class="difflineminus">-</span>
<a href="#l4.340"></a><span id="l4.340" class="difflineminus">-      &lt;field name=&quot;_scrollButtonDownBox&quot;&gt;</span>
<a href="#l4.341"></a><span id="l4.341" class="difflineminus">-        document.getAnonymousElementByAttribute(this, &quot;anonid&quot;, &quot;down-box&quot;);</span>
<a href="#l4.342"></a><span id="l4.342" class="difflineminus">-      &lt;/field&gt;</span>
<a href="#l4.343"></a><span id="l4.343" class="difflineminus">-</span>
<a href="#l4.344"></a><span id="l4.344" class="difflineminus">-      &lt;field name=&quot;_scrollButtonDownBoxAnimate&quot;&gt;</span>
<a href="#l4.345"></a><span id="l4.345" class="difflineminus">-        document.getAnonymousElementByAttribute(this, &quot;anonid&quot;, &quot;down-box-animate&quot;);</span>
<a href="#l4.346"></a><span id="l4.346" class="difflineminus">-      &lt;/field&gt;</span>
<a href="#l4.347"></a><span id="l4.347" class="difflineminus">-</span>
<a href="#l4.348"></a><span id="l4.348" class="difflineminus">-      &lt;field name=&quot;mToolbar&quot;&gt;</span>
<a href="#l4.349"></a><span id="l4.349" class="difflineminus">-        document.getElementById(this.getAttribute(&quot;tabtoolbar&quot;));</span>
<a href="#l4.350"></a><span id="l4.350" class="difflineminus">-      &lt;/field&gt;</span>
<a href="#l4.351"></a><span id="l4.351" class="difflineminus">-</span>
<a href="#l4.352"></a><span id="l4.352" class="difflineminus">-      &lt;field name=&quot;mCollapseToolbar&quot;&gt;</span>
<a href="#l4.353"></a><span id="l4.353" class="difflineminus">-        document.getElementById(this.getAttribute(&quot;collapsetoolbar&quot;));</span>
<a href="#l4.354"></a><span id="l4.354" class="difflineminus">-      &lt;/field&gt;</span>
<a href="#l4.355"></a><span id="l4.355" class="difflineminus">-</span>
<a href="#l4.356"></a><span id="l4.356" class="difflineminus">-      &lt;field name=&quot;_prefObserver&quot;&gt;&lt;![CDATA[</span>
<a href="#l4.357"></a><span id="l4.357" class="difflineminus">-        ({</span>
<a href="#l4.358"></a><span id="l4.358" class="difflineminus">-        tabbox: this,</span>
<a href="#l4.359"></a><span id="l4.359" class="difflineminus">-</span>
<a href="#l4.360"></a><span id="l4.360" class="difflineminus">-        observe(subject, topic, data) {</span>
<a href="#l4.361"></a><span id="l4.361" class="difflineminus">-          if (topic == &quot;nsPref:changed&quot;) {</span>
<a href="#l4.362"></a><span id="l4.362" class="difflineminus">-            subject.QueryInterface(Ci.nsIPrefBranch);</span>
<a href="#l4.363"></a><span id="l4.363" class="difflineminus">-            switch (data) {</span>
<a href="#l4.364"></a><span id="l4.364" class="difflineminus">-            case &quot;mail.tabs.closeButtons&quot;:</span>
<a href="#l4.365"></a><span id="l4.365" class="difflineminus">-              this.tabbox.mCloseButtons = subject.getIntPref(&quot;mail.tabs.closeButtons&quot;);</span>
<a href="#l4.366"></a><span id="l4.366" class="difflineminus">-              this.tabbox._updateCloseButtons();</span>
<a href="#l4.367"></a><span id="l4.367" class="difflineminus">-              break;</span>
<a href="#l4.368"></a><span id="l4.368" class="difflineminus">-            case &quot;mail.tabs.autoHide&quot;:</span>
<a href="#l4.369"></a><span id="l4.369" class="difflineminus">-              this.tabbox.mAutoHide = subject.getBoolPref(&quot;mail.tabs.autoHide&quot;);</span>
<a href="#l4.370"></a><span id="l4.370" class="difflineminus">-              break;</span>
<a href="#l4.371"></a><span id="l4.371" class="difflineminus">-            }</span>
<a href="#l4.372"></a><span id="l4.372" class="difflineminus">-          }</span>
<a href="#l4.373"></a><span id="l4.373" class="difflineminus">-        },</span>
<a href="#l4.374"></a><span id="l4.374" class="difflineminus">-</span>
<a href="#l4.375"></a><span id="l4.375" class="difflineminus">-        QueryInterface: ChromeUtils.generateQI([&quot;nsIObserver&quot;]),</span>
<a href="#l4.376"></a><span id="l4.376" class="difflineminus">-        });</span>
<a href="#l4.377"></a><span id="l4.377" class="difflineminus">-        ]]&gt;</span>
<a href="#l4.378"></a><span id="l4.378" class="difflineminus">-      &lt;/field&gt;</span>
<a href="#l4.379"></a><span id="l4.379" class="difflineminus">-</span>
<a href="#l4.380"></a><span id="l4.380" class="difflineminus">-      &lt;field name=&quot;_tabDropIndicator&quot;&gt;</span>
<a href="#l4.381"></a><span id="l4.381" class="difflineminus">-        document.getAnonymousElementByAttribute(this, &quot;anonid&quot;,</span>
<a href="#l4.382"></a><span id="l4.382" class="difflineminus">-                                                &quot;tab-drop-indicator&quot;);</span>
<a href="#l4.383"></a><span id="l4.383" class="difflineminus">-      &lt;/field&gt;</span>
<a href="#l4.384"></a><span id="l4.384" class="difflineminus">-</span>
<a href="#l4.385"></a><span id="l4.385" class="difflineminus">-      &lt;field name=&quot;_dragOverDelay&quot;&gt;350&lt;/field&gt;</span>
<a href="#l4.386"></a><span id="l4.386" class="difflineminus">-      &lt;field name=&quot;_dragTime&quot;&gt;0&lt;/field&gt;</span>
<a href="#l4.387"></a><span id="l4.387" class="difflineminus">-</span>
<a href="#l4.388"></a><span id="l4.388" class="difflineminus">-      &lt;field name=&quot;mTabMinWidth&quot;&gt;100&lt;/field&gt;</span>
<a href="#l4.389"></a><span id="l4.389" class="difflineminus">-      &lt;field name=&quot;mTabMaxWidth&quot;&gt;250&lt;/field&gt;</span>
<a href="#l4.390"></a><span id="l4.390" class="difflineminus">-      &lt;field name=&quot;mTabClipWidth&quot;&gt;140&lt;/field&gt;</span>
<a href="#l4.391"></a><span id="l4.391" class="difflineminus">-      &lt;field name=&quot;mCloseButtons&quot;&gt;1&lt;/field&gt;</span>
<a href="#l4.392"></a><span id="l4.392" class="difflineminus">-      &lt;field name=&quot;_mAutoHide&quot;&gt;false&lt;/field&gt;</span>
<a href="#l4.393"></a><span id="l4.393" class="difflineminus">-</span>
<a href="#l4.394"></a><span id="l4.394" class="difflineminus">-      &lt;property name=&quot;mAutoHide&quot; onget=&quot;return this._mAutoHide;&quot;&gt;</span>
<a href="#l4.395"></a><span id="l4.395" class="difflineminus">-        &lt;setter&gt;&lt;![CDATA[</span>
<a href="#l4.396"></a><span id="l4.396" class="difflineminus">-          if (val != this._mAutoHide) {</span>
<a href="#l4.397"></a><span id="l4.397" class="difflineminus">-            if (this.childNodes.length == 1)</span>
<a href="#l4.398"></a><span id="l4.398" class="difflineminus">-              this.mCollapseToolbar.collapsed = val;</span>
<a href="#l4.399"></a><span id="l4.399" class="difflineminus">-            this._mAutoHide = val;</span>
<a href="#l4.400"></a><span id="l4.400" class="difflineminus">-          }</span>
<a href="#l4.401"></a><span id="l4.401" class="difflineminus">-          return val;</span>
<a href="#l4.402"></a><span id="l4.402" class="difflineminus">-        ]]&gt;&lt;/setter&gt;</span>
<a href="#l4.403"></a><span id="l4.403" class="difflineminus">-      &lt;/property&gt;</span>
<a href="#l4.404"></a><span id="l4.404" class="difflineminus">-</span>
<a href="#l4.405"></a><span id="l4.405" class="difflineminus">-      &lt;property name=&quot;selectedIndex&quot;&gt;</span>
<a href="#l4.406"></a><span id="l4.406" class="difflineminus">-        &lt;getter&gt;</span>
<a href="#l4.407"></a><span id="l4.407" class="difflineminus">-        &lt;![CDATA[</span>
<a href="#l4.408"></a><span id="l4.408" class="difflineminus">-          return this.__proto__.__proto__.__lookupGetter__(&quot;selectedIndex&quot;).call(this);</span>
<a href="#l4.409"></a><span id="l4.409" class="difflineminus">-        ]]&gt;</span>
<a href="#l4.410"></a><span id="l4.410" class="difflineminus">-        &lt;/getter&gt;</span>
<a href="#l4.411"></a><span id="l4.411" class="difflineminus">-</span>
<a href="#l4.412"></a><span id="l4.412" class="difflineminus">-        &lt;setter&gt;</span>
<a href="#l4.413"></a><span id="l4.413" class="difflineminus">-        &lt;![CDATA[</span>
<a href="#l4.414"></a><span id="l4.414" class="difflineminus">-          let tab = this.getItemAtIndex(val);</span>
<a href="#l4.415"></a><span id="l4.415" class="difflineminus">-          let alreadySelected = tab &amp;&amp; tab.selected;</span>
<a href="#l4.416"></a><span id="l4.416" class="difflineminus">-</span>
<a href="#l4.417"></a><span id="l4.417" class="difflineminus">-          this.__proto__.__proto__.__lookupSetter__(&quot;selectedIndex&quot;).call(this, val);</span>
<a href="#l4.418"></a><span id="l4.418" class="difflineminus">-</span>
<a href="#l4.419"></a><span id="l4.419" class="difflineminus">-          if (!alreadySelected) {</span>
<a href="#l4.420"></a><span id="l4.420" class="difflineminus">-            // Fire an onselect event for the tabs element.</span>
<a href="#l4.421"></a><span id="l4.421" class="difflineminus">-            var event = document.createEvent(&quot;Events&quot;);</span>
<a href="#l4.422"></a><span id="l4.422" class="difflineminus">-            event.initEvent(&quot;select&quot;, true, true);</span>
<a href="#l4.423"></a><span id="l4.423" class="difflineminus">-            this.dispatchEvent(event);</span>
<a href="#l4.424"></a><span id="l4.424" class="difflineminus">-          }</span>
<a href="#l4.425"></a><span id="l4.425" class="difflineminus">-</span>
<a href="#l4.426"></a><span id="l4.426" class="difflineminus">-          return val;</span>
<a href="#l4.427"></a><span id="l4.427" class="difflineminus">-        ]]&gt;</span>
<a href="#l4.428"></a><span id="l4.428" class="difflineminus">-        &lt;/setter&gt;</span>
<a href="#l4.429"></a><span id="l4.429" class="difflineminus">-      &lt;/property&gt;</span>
<a href="#l4.430"></a><span id="l4.430" class="difflineminus">-</span>
<a href="#l4.431"></a><span id="l4.431" class="difflineminus">-      &lt;method name=&quot;_initializeArrowScrollbox&quot;&gt;</span>
<a href="#l4.432"></a><span id="l4.432" class="difflineminus">-        &lt;body&gt;&lt;![CDATA[</span>
<a href="#l4.433"></a><span id="l4.433" class="difflineminus">-          let arrowScrollbox = this.arrowScrollbox;</span>
<a href="#l4.434"></a><span id="l4.434" class="difflineminus">-          arrowScrollbox.addEventListener(&quot;underflow&quot;, event =&gt; {</span>
<a href="#l4.435"></a><span id="l4.435" class="difflineminus">-            // filter underflow events which were dispatched on nested scrollboxes</span>
<a href="#l4.436"></a><span id="l4.436" class="difflineminus">-            if (event.target != arrowScrollbox)</span>
<a href="#l4.437"></a><span id="l4.437" class="difflineminus">-              return;</span>
<a href="#l4.438"></a><span id="l4.438" class="difflineminus">-</span>
<a href="#l4.439"></a><span id="l4.439" class="difflineminus">-            // Ignore vertical events.</span>
<a href="#l4.440"></a><span id="l4.440" class="difflineminus">-            if (event.detail == 0) {</span>
<a href="#l4.441"></a><span id="l4.441" class="difflineminus">-              return;</span>
<a href="#l4.442"></a><span id="l4.442" class="difflineminus">-            }</span>
<a href="#l4.443"></a><span id="l4.443" class="difflineminus">-</span>
<a href="#l4.444"></a><span id="l4.444" class="difflineminus">-            arrowScrollbox.setAttribute(&quot;notoverflowing&quot;, &quot;true&quot;);</span>
<a href="#l4.445"></a><span id="l4.445" class="difflineminus">-            let alltabsButton = document.getElementById(&quot;alltabs-button&quot;);</span>
<a href="#l4.446"></a><span id="l4.446" class="difflineminus">-            alltabsButton.setAttribute(&quot;hidden&quot;, &quot;true&quot;);</span>
<a href="#l4.447"></a><span id="l4.447" class="difflineminus">-          }, true);</span>
<a href="#l4.448"></a><span id="l4.448" class="difflineminus">-</span>
<a href="#l4.449"></a><span id="l4.449" class="difflineminus">-          arrowScrollbox.addEventListener(&quot;overflow&quot;, event =&gt; {</span>
<a href="#l4.450"></a><span id="l4.450" class="difflineminus">-            // filter underflow events which were dispatched on nested scrollboxes</span>
<a href="#l4.451"></a><span id="l4.451" class="difflineminus">-            if (event.target != arrowScrollbox)</span>
<a href="#l4.452"></a><span id="l4.452" class="difflineminus">-              return;</span>
<a href="#l4.453"></a><span id="l4.453" class="difflineminus">-</span>
<a href="#l4.454"></a><span id="l4.454" class="difflineminus">-            // Ignore vertical events.</span>
<a href="#l4.455"></a><span id="l4.455" class="difflineminus">-            if (event.detail == 0) {</span>
<a href="#l4.456"></a><span id="l4.456" class="difflineminus">-              return;</span>
<a href="#l4.457"></a><span id="l4.457" class="difflineminus">-            }</span>
<a href="#l4.458"></a><span id="l4.458" class="difflineminus">-</span>
<a href="#l4.459"></a><span id="l4.459" class="difflineminus">-            arrowScrollbox.removeAttribute(&quot;notoverflowing&quot;);</span>
<a href="#l4.460"></a><span id="l4.460" class="difflineminus">-            let alltabsButton = document.getElementById(&quot;alltabs-button&quot;);</span>
<a href="#l4.461"></a><span id="l4.461" class="difflineminus">-            alltabsButton.removeAttribute(&quot;hidden&quot;);</span>
<a href="#l4.462"></a><span id="l4.462" class="difflineminus">-          });</span>
<a href="#l4.463"></a><span id="l4.463" class="difflineminus">-</span>
<a href="#l4.464"></a><span id="l4.464" class="difflineminus">-          arrowScrollbox.addEventListener(&quot;UpdatedScrollButtonsDisabledState&quot;, event =&gt; {</span>
<a href="#l4.465"></a><span id="l4.465" class="difflineminus">-            // filter underflow events which were dispatched on nested scrollboxes</span>
<a href="#l4.466"></a><span id="l4.466" class="difflineminus">-            if (event.target != arrowScrollbox)</span>
<a href="#l4.467"></a><span id="l4.467" class="difflineminus">-              return;</span>
<a href="#l4.468"></a><span id="l4.468" class="difflineminus">-</span>
<a href="#l4.469"></a><span id="l4.469" class="difflineminus">-            // fix for bug #352353</span>
<a href="#l4.470"></a><span id="l4.470" class="difflineminus">-            // unlike the scrollup button on the tab strip (which is a</span>
<a href="#l4.471"></a><span id="l4.471" class="difflineminus">-            // simple toolbarbutton) the scrolldown button is</span>
<a href="#l4.472"></a><span id="l4.472" class="difflineminus">-            // a more complicated stack of boxes and a toolbarbutton</span>
<a href="#l4.473"></a><span id="l4.473" class="difflineminus">-            // so that we can animate when a tab is opened offscreen.</span>
<a href="#l4.474"></a><span id="l4.474" class="difflineminus">-            // in order to style the box with the actual background image</span>
<a href="#l4.475"></a><span id="l4.475" class="difflineminus">-            // we need to manually set the disable state to match the</span>
<a href="#l4.476"></a><span id="l4.476" class="difflineminus">-            // disable state of the toolbarbutton.</span>
<a href="#l4.477"></a><span id="l4.477" class="difflineminus">-            arrowScrollbox._scrollButtonDownBox</span>
<a href="#l4.478"></a><span id="l4.478" class="difflineminus">-                .setAttribute(&quot;disabled&quot;, arrowScrollbox._scrollButtonDown.disabled);</span>
<a href="#l4.479"></a><span id="l4.479" class="difflineminus">-          });</span>
<a href="#l4.480"></a><span id="l4.480" class="difflineminus">-        ]]&gt;&lt;/body&gt;</span>
<a href="#l4.481"></a><span id="l4.481" class="difflineminus">-      &lt;/method&gt;</span>
<a href="#l4.482"></a><span id="l4.482" class="difflineminus">-</span>
<a href="#l4.483"></a><span id="l4.483" class="difflineminus">-      &lt;method name=&quot;_updateCloseButtons&quot;&gt;</span>
<a href="#l4.484"></a><span id="l4.484" class="difflineminus">-        &lt;body&gt;&lt;![CDATA[</span>
<a href="#l4.485"></a><span id="l4.485" class="difflineminus">-          // modes for tabstrip</span>
<a href="#l4.486"></a><span id="l4.486" class="difflineminus">-          // 0 - activetab  = close button on active tab only</span>
<a href="#l4.487"></a><span id="l4.487" class="difflineminus">-          // 1 - alltabs    = close buttons on all tabs</span>
<a href="#l4.488"></a><span id="l4.488" class="difflineminus">-          // 2 - noclose    = no close buttons at all</span>
<a href="#l4.489"></a><span id="l4.489" class="difflineminus">-          // 3 - closeatend = close button at the end of the tabstrip</span>
<a href="#l4.490"></a><span id="l4.490" class="difflineminus">-          switch (this.mCloseButtons) {</span>
<a href="#l4.491"></a><span id="l4.491" class="difflineminus">-          case 0:</span>
<a href="#l4.492"></a><span id="l4.492" class="difflineminus">-            this.setAttribute(&quot;closebuttons&quot;, &quot;activetab&quot;);</span>
<a href="#l4.493"></a><span id="l4.493" class="difflineminus">-            break;</span>
<a href="#l4.494"></a><span id="l4.494" class="difflineminus">-          case 1:</span>
<a href="#l4.495"></a><span id="l4.495" class="difflineminus">-            var width = this.firstChild.getBoundingClientRect().width;</span>
<a href="#l4.496"></a><span id="l4.496" class="difflineminus">-            // 0 width is an invalid value and indicates</span>
<a href="#l4.497"></a><span id="l4.497" class="difflineminus">-            // an item without display, so ignore.</span>
<a href="#l4.498"></a><span id="l4.498" class="difflineminus">-            if (width &gt; this.mTabClipWidth || width == 0)</span>
<a href="#l4.499"></a><span id="l4.499" class="difflineminus">-              this.setAttribute(&quot;closebuttons&quot;, &quot;alltabs&quot;);</span>
<a href="#l4.500"></a><span id="l4.500" class="difflineminus">-            else</span>
<a href="#l4.501"></a><span id="l4.501" class="difflineminus">-              this.setAttribute(&quot;closebuttons&quot;, &quot;activetab&quot;);</span>
<a href="#l4.502"></a><span id="l4.502" class="difflineminus">-            break;</span>
<a href="#l4.503"></a><span id="l4.503" class="difflineminus">-          case 2:</span>
<a href="#l4.504"></a><span id="l4.504" class="difflineminus">-          case 3:</span>
<a href="#l4.505"></a><span id="l4.505" class="difflineminus">-            this.setAttribute(&quot;closebuttons&quot;, &quot;noclose&quot;);</span>
<a href="#l4.506"></a><span id="l4.506" class="difflineminus">-            break;</span>
<a href="#l4.507"></a><span id="l4.507" class="difflineminus">-          }</span>
<a href="#l4.508"></a><span id="l4.508" class="difflineminus">-          this.arrowScrollboxClosebutton.collapsed = this.mCloseButtons != 3;</span>
<a href="#l4.509"></a><span id="l4.509" class="difflineminus">-        ]]&gt;&lt;/body&gt;</span>
<a href="#l4.510"></a><span id="l4.510" class="difflineminus">-      &lt;/method&gt;</span>
<a href="#l4.511"></a><span id="l4.511" class="difflineminus">-</span>
<a href="#l4.512"></a><span id="l4.512" class="difflineminus">-      &lt;method name=&quot;_handleTabSelect&quot;&gt;</span>
<a href="#l4.513"></a><span id="l4.513" class="difflineminus">-        &lt;body&gt;&lt;![CDATA[</span>
<a href="#l4.514"></a><span id="l4.514" class="difflineminus">-          this.arrowScrollbox.ensureElementIsVisible(this.selectedItem);</span>
<a href="#l4.515"></a><span id="l4.515" class="difflineminus">-        ]]&gt;&lt;/body&gt;</span>
<a href="#l4.516"></a><span id="l4.516" class="difflineminus">-      &lt;/method&gt;</span>
<a href="#l4.517"></a><span id="l4.517" class="difflineminus">-</span>
<a href="#l4.518"></a><span id="l4.518" class="difflineminus">-      &lt;method name=&quot;handleEvent&quot;&gt;</span>
<a href="#l4.519"></a><span id="l4.519" class="difflineminus">-        &lt;parameter name=&quot;aEvent&quot;/&gt;</span>
<a href="#l4.520"></a><span id="l4.520" class="difflineminus">-        &lt;body&gt;&lt;![CDATA[</span>
<a href="#l4.521"></a><span id="l4.521" class="difflineminus">-          switch (aEvent.type) {</span>
<a href="#l4.522"></a><span id="l4.522" class="difflineminus">-            case &quot;overflow&quot;:</span>
<a href="#l4.523"></a><span id="l4.523" class="difflineminus">-              this.arrowScrollbox.ensureElementIsVisible(this.selectedItem);</span>
<a href="#l4.524"></a><span id="l4.524" class="difflineminus">-              break;</span>
<a href="#l4.525"></a><span id="l4.525" class="difflineminus">-            case &quot;underflow&quot;:</span>
<a href="#l4.526"></a><span id="l4.526" class="difflineminus">-              break;</span>
<a href="#l4.527"></a><span id="l4.527" class="difflineminus">-            case &quot;resize&quot;:</span>
<a href="#l4.528"></a><span id="l4.528" class="difflineminus">-              var width = this.arrowScrollbox.getBoundingClientRect().width;</span>
<a href="#l4.529"></a><span id="l4.529" class="difflineminus">-              if (width != this.arrowScrollboxWidth) {</span>
<a href="#l4.530"></a><span id="l4.530" class="difflineminus">-                this._updateCloseButtons();</span>
<a href="#l4.531"></a><span id="l4.531" class="difflineminus">-                // XXX without this line the tab bar won't budge</span>
<a href="#l4.532"></a><span id="l4.532" class="difflineminus">-                this.arrowScrollbox.scrollByPixels(1);</span>
<a href="#l4.533"></a><span id="l4.533" class="difflineminus">-                this._handleTabSelect();</span>
<a href="#l4.534"></a><span id="l4.534" class="difflineminus">-                this.arrowScrollboxWidth = width;</span>
<a href="#l4.535"></a><span id="l4.535" class="difflineminus">-              }</span>
<a href="#l4.536"></a><span id="l4.536" class="difflineminus">-              break;</span>
<a href="#l4.537"></a><span id="l4.537" class="difflineminus">-          }</span>
<a href="#l4.538"></a><span id="l4.538" class="difflineminus">-        ]]&gt;&lt;/body&gt;</span>
<a href="#l4.539"></a><span id="l4.539" class="difflineminus">-      &lt;/method&gt;</span>
<a href="#l4.540"></a><span id="l4.540" class="difflineminus">-</span>
<a href="#l4.541"></a><span id="l4.541" class="difflineminus">-      &lt;field name=&quot;mAllTabsPopup&quot;&gt;</span>
<a href="#l4.542"></a><span id="l4.542" class="difflineminus">-        this.mAllTabsButton.menu;</span>
<a href="#l4.543"></a><span id="l4.543" class="difflineminus">-      &lt;/field&gt;</span>
<a href="#l4.544"></a><span id="l4.544" class="difflineminus">-</span>
<a href="#l4.545"></a><span id="l4.545" class="difflineminus">-      &lt;field name=&quot;mAllTabsBoxAnimate&quot;&gt;</span>
<a href="#l4.546"></a><span id="l4.546" class="difflineminus">-        document.getAnonymousElementByAttribute(this,</span>
<a href="#l4.547"></a><span id="l4.547" class="difflineminus">-                                                &quot;anonid&quot;,</span>
<a href="#l4.548"></a><span id="l4.548" class="difflineminus">-                                                &quot;alltabs-box-animate&quot;);</span>
<a href="#l4.549"></a><span id="l4.549" class="difflineminus">-      &lt;/field&gt;</span>
<a href="#l4.550"></a><span id="l4.550" class="difflineminus">-</span>
<a href="#l4.551"></a><span id="l4.551" class="difflineminus">-      &lt;field name=&quot;mDownBoxAnimate&quot;&gt;</span>
<a href="#l4.552"></a><span id="l4.552" class="difflineminus">-        this.arrowScrollbox._scrollButtonDownBoxAnimate;</span>
<a href="#l4.553"></a><span id="l4.553" class="difflineminus">-      &lt;/field&gt;</span>
<a href="#l4.554"></a><span id="l4.554" class="difflineminus">-</span>
<a href="#l4.555"></a><span id="l4.555" class="difflineminus">-      &lt;field name=&quot;mAllTabsButton&quot;&gt;</span>
<a href="#l4.556"></a><span id="l4.556" class="difflineminus">-        document.getElementById(this.getAttribute(&quot;alltabsbutton&quot;));</span>
<a href="#l4.557"></a><span id="l4.557" class="difflineminus">-      &lt;/field&gt;</span>
<a href="#l4.558"></a><span id="l4.558" class="difflineminus">-</span>
<a href="#l4.559"></a><span id="l4.559" class="difflineminus">-      &lt;field name=&quot;_animateTimer&quot;&gt;null&lt;/field&gt;</span>
<a href="#l4.560"></a><span id="l4.560" class="difflineminus">-      &lt;field name=&quot;_animateStep&quot;&gt;-1&lt;/field&gt;</span>
<a href="#l4.561"></a><span id="l4.561" class="difflineminus">-      &lt;field name=&quot;_animateDelay&quot;&gt;25&lt;/field&gt;</span>
<a href="#l4.562"></a><span id="l4.562" class="difflineminus">-      &lt;field name=&quot;_animatePercents&quot;&gt;</span>
<a href="#l4.563"></a><span id="l4.563" class="difflineminus">-       [1.00, 0.85, 0.80, 0.75, 0.71, 0.68, 0.65, 0.62, 0.59, 0.57,</span>
<a href="#l4.564"></a><span id="l4.564" class="difflineminus">-        0.54, 0.52, 0.50, 0.47, 0.45, 0.44, 0.42, 0.40, 0.38, 0.37,</span>
<a href="#l4.565"></a><span id="l4.565" class="difflineminus">-        0.35, 0.34, 0.32, 0.31, 0.30, 0.29, 0.28, 0.27, 0.26, 0.25,</span>
<a href="#l4.566"></a><span id="l4.566" class="difflineminus">-        0.24, 0.23, 0.23, 0.22, 0.22, 0.21, 0.21, 0.21, 0.20, 0.20,</span>
<a href="#l4.567"></a><span id="l4.567" class="difflineminus">-        0.20, 0.20, 0.20, 0.20, 0.20, 0.20, 0.19, 0.19, 0.19, 0.18,</span>
<a href="#l4.568"></a><span id="l4.568" class="difflineminus">-        0.18, 0.17, 0.17, 0.16, 0.15, 0.14, 0.13, 0.11, 0.09, 0.06]</span>
<a href="#l4.569"></a><span id="l4.569" class="difflineminus">-      &lt;/field&gt;</span>
<a href="#l4.570"></a><span id="l4.570" class="difflineminus">-</span>
<a href="#l4.571"></a><span id="l4.571" class="difflineminus">-      &lt;method name=&quot;_stopAnimation&quot;&gt;</span>
<a href="#l4.572"></a><span id="l4.572" class="difflineminus">-        &lt;body&gt;&lt;![CDATA[</span>
<a href="#l4.573"></a><span id="l4.573" class="difflineminus">-          if (this._animateStep != -1) {</span>
<a href="#l4.574"></a><span id="l4.574" class="difflineminus">-            if (this._animateTimer)</span>
<a href="#l4.575"></a><span id="l4.575" class="difflineminus">-              this._animateTimer.cancel();</span>
<a href="#l4.576"></a><span id="l4.576" class="difflineminus">-</span>
<a href="#l4.577"></a><span id="l4.577" class="difflineminus">-            this._animateStep = -1;</span>
<a href="#l4.578"></a><span id="l4.578" class="difflineminus">-            this.mAllTabsBoxAnimate.style.opacity = 0.0;</span>
<a href="#l4.579"></a><span id="l4.579" class="difflineminus">-            this.mDownBoxAnimate.style.opacity = 0.0;</span>
<a href="#l4.580"></a><span id="l4.580" class="difflineminus">-          }</span>
<a href="#l4.581"></a><span id="l4.581" class="difflineminus">-        ]]&gt;&lt;/body&gt;</span>
<a href="#l4.582"></a><span id="l4.582" class="difflineminus">-      &lt;/method&gt;</span>
<a href="#l4.583"></a><span id="l4.583" class="difflineminus">-</span>
<a href="#l4.584"></a><span id="l4.584" class="difflineminus">-      &lt;method name=&quot;_notifyBackgroundTab&quot;&gt;</span>
<a href="#l4.585"></a><span id="l4.585" class="difflineminus">-        &lt;parameter name=&quot;aTab&quot;/&gt;</span>
<a href="#l4.586"></a><span id="l4.586" class="difflineminus">-        &lt;body&gt;&lt;![CDATA[</span>
<a href="#l4.587"></a><span id="l4.587" class="difflineminus">-          var tsbo = this.arrowScrollbox;</span>
<a href="#l4.588"></a><span id="l4.588" class="difflineminus">-          var tsboStart = tsbo.screenX;</span>
<a href="#l4.589"></a><span id="l4.589" class="difflineminus">-          var tsboEnd = tsboStart + tsbo.getBoundingClientRect().width;</span>
<a href="#l4.590"></a><span id="l4.590" class="difflineminus">-</span>
<a href="#l4.591"></a><span id="l4.591" class="difflineminus">-          var ctboStart = aTab.screenX;</span>
<a href="#l4.592"></a><span id="l4.592" class="difflineminus">-          var ctboEnd = ctboStart + aTab.getBoundingClientRect().width;</span>
<a href="#l4.593"></a><span id="l4.593" class="difflineminus">-</span>
<a href="#l4.594"></a><span id="l4.594" class="difflineminus">-          // only start the flash timer if the new tab (which was loaded in</span>
<a href="#l4.595"></a><span id="l4.595" class="difflineminus">-          // the background) is not completely visible</span>
<a href="#l4.596"></a><span id="l4.596" class="difflineminus">-          if (tsboStart &gt; ctboStart || ctboEnd &gt; tsboEnd) {</span>
<a href="#l4.597"></a><span id="l4.597" class="difflineminus">-            this._animateStep = 0;</span>
<a href="#l4.598"></a><span id="l4.598" class="difflineminus">-</span>
<a href="#l4.599"></a><span id="l4.599" class="difflineminus">-            if (!this._animateTimer)</span>
<a href="#l4.600"></a><span id="l4.600" class="difflineminus">-              this._animateTimer =</span>
<a href="#l4.601"></a><span id="l4.601" class="difflineminus">-                Cc[&quot;@mozilla.org/timer;1&quot;]</span>
<a href="#l4.602"></a><span id="l4.602" class="difflineminus">-                  .createInstance(Ci.nsITimer);</span>
<a href="#l4.603"></a><span id="l4.603" class="difflineminus">-            else</span>
<a href="#l4.604"></a><span id="l4.604" class="difflineminus">-               this._animateTimer.cancel();</span>
<a href="#l4.605"></a><span id="l4.605" class="difflineminus">-</span>
<a href="#l4.606"></a><span id="l4.606" class="difflineminus">-            this._animateTimer.initWithCallback(this,</span>
<a href="#l4.607"></a><span id="l4.607" class="difflineminus">-                         this._animateDelay,</span>
<a href="#l4.608"></a><span id="l4.608" class="difflineminus">-                         Ci.nsITimer.TYPE_REPEATING_SLACK);</span>
<a href="#l4.609"></a><span id="l4.609" class="difflineminus">-          }</span>
<a href="#l4.610"></a><span id="l4.610" class="difflineminus">-        ]]&gt;&lt;/body&gt;</span>
<a href="#l4.611"></a><span id="l4.611" class="difflineminus">-      &lt;/method&gt;</span>
<a href="#l4.612"></a><span id="l4.612" class="difflineminus">-</span>
<a href="#l4.613"></a><span id="l4.613" class="difflineminus">-      &lt;method name=&quot;notify&quot;&gt;</span>
<a href="#l4.614"></a><span id="l4.614" class="difflineminus">-        &lt;parameter name=&quot;aTimer&quot;/&gt;</span>
<a href="#l4.615"></a><span id="l4.615" class="difflineminus">-        &lt;body&gt;&lt;![CDATA[</span>
<a href="#l4.616"></a><span id="l4.616" class="difflineminus">-          if (!document)</span>
<a href="#l4.617"></a><span id="l4.617" class="difflineminus">-            aTimer.cancel();</span>
<a href="#l4.618"></a><span id="l4.618" class="difflineminus">-</span>
<a href="#l4.619"></a><span id="l4.619" class="difflineminus">-          var percent = this._animatePercents[this._animateStep];</span>
<a href="#l4.620"></a><span id="l4.620" class="difflineminus">-          this.mAllTabsBoxAnimate.style.opacity = percent;</span>
<a href="#l4.621"></a><span id="l4.621" class="difflineminus">-          this.mDownBoxAnimate.style.opacity = percent;</span>
<a href="#l4.622"></a><span id="l4.622" class="difflineminus">-</span>
<a href="#l4.623"></a><span id="l4.623" class="difflineminus">-          if (this._animateStep &lt; (this._animatePercents.length - 1))</span>
<a href="#l4.624"></a><span id="l4.624" class="difflineminus">-            this._animateStep++;</span>
<a href="#l4.625"></a><span id="l4.625" class="difflineminus">-          else</span>
<a href="#l4.626"></a><span id="l4.626" class="difflineminus">-            this._stopAnimation();</span>
<a href="#l4.627"></a><span id="l4.627" class="difflineminus">-        ]]&gt;&lt;/body&gt;</span>
<a href="#l4.628"></a><span id="l4.628" class="difflineminus">-      &lt;/method&gt;</span>
<a href="#l4.629"></a><span id="l4.629" class="difflineminus">-</span>
<a href="#l4.630"></a><span id="l4.630" class="difflineminus">-      &lt;method name=&quot;_getDragTargetTab&quot;&gt;</span>
<a href="#l4.631"></a><span id="l4.631" class="difflineminus">-        &lt;parameter name=&quot;event&quot;/&gt;</span>
<a href="#l4.632"></a><span id="l4.632" class="difflineminus">-        &lt;body&gt;&lt;![CDATA[</span>
<a href="#l4.633"></a><span id="l4.633" class="difflineminus">-</span>
<a href="#l4.634"></a><span id="l4.634" class="difflineminus">-          if (document.dragTab.localName != &quot;tab&quot;)</span>
<a href="#l4.635"></a><span id="l4.635" class="difflineminus">-            return null;</span>
<a href="#l4.636"></a><span id="l4.636" class="difflineminus">-</span>
<a href="#l4.637"></a><span id="l4.637" class="difflineminus">-          let tab = document.dragTab;</span>
<a href="#l4.638"></a><span id="l4.638" class="difflineminus">-</span>
<a href="#l4.639"></a><span id="l4.639" class="difflineminus">-          if ((event.type != &quot;drop&quot;) &amp;&amp; (event.type != &quot;dragover&quot;))</span>
<a href="#l4.640"></a><span id="l4.640" class="difflineminus">-            return tab;</span>
<a href="#l4.641"></a><span id="l4.641" class="difflineminus">-</span>
<a href="#l4.642"></a><span id="l4.642" class="difflineminus">-          let tabRect = tab.getBoundingClientRect();</span>
<a href="#l4.643"></a><span id="l4.643" class="difflineminus">-          if (event.screenX &lt; tab.screenX + tabRect.width * .25)</span>
<a href="#l4.644"></a><span id="l4.644" class="difflineminus">-            return null;</span>
<a href="#l4.645"></a><span id="l4.645" class="difflineminus">-</span>
<a href="#l4.646"></a><span id="l4.646" class="difflineminus">-          if (event.screenX &gt; tab.screenX + tabRect.width * .75)</span>
<a href="#l4.647"></a><span id="l4.647" class="difflineminus">-            return null;</span>
<a href="#l4.648"></a><span id="l4.648" class="difflineminus">-</span>
<a href="#l4.649"></a><span id="l4.649" class="difflineminus">-          return tab;</span>
<a href="#l4.650"></a><span id="l4.650" class="difflineminus">-        ]]&gt;&lt;/body&gt;</span>
<a href="#l4.651"></a><span id="l4.651" class="difflineminus">-      &lt;/method&gt;</span>
<a href="#l4.652"></a><span id="l4.652" class="difflineminus">-</span>
<a href="#l4.653"></a><span id="l4.653" class="difflineminus">-</span>
<a href="#l4.654"></a><span id="l4.654" class="difflineminus">-      &lt;method name=&quot;_getDropIndex&quot;&gt;</span>
<a href="#l4.655"></a><span id="l4.655" class="difflineminus">-        &lt;parameter name=&quot;event&quot;/&gt;</span>
<a href="#l4.656"></a><span id="l4.656" class="difflineminus">-        &lt;body&gt;&lt;![CDATA[</span>
<a href="#l4.657"></a><span id="l4.657" class="difflineminus">-          let tabs = this.childNodes;</span>
<a href="#l4.658"></a><span id="l4.658" class="difflineminus">-</span>
<a href="#l4.659"></a><span id="l4.659" class="difflineminus">-          if (window.getComputedStyle(this).direction == &quot;ltr&quot;) {</span>
<a href="#l4.660"></a><span id="l4.660" class="difflineminus">-            for (let i = 0; i &lt; tabs.length; i++)</span>
<a href="#l4.661"></a><span id="l4.661" class="difflineminus">-              if (event.screenX &lt; (tabs[i].screenX + (tabs[i].getBoundingClientRect().width / 2)))</span>
<a href="#l4.662"></a><span id="l4.662" class="difflineminus">-                return i;</span>
<a href="#l4.663"></a><span id="l4.663" class="difflineminus">-          } else {</span>
<a href="#l4.664"></a><span id="l4.664" class="difflineminus">-            for (let i = 0; i &lt; tabs.length; i++)</span>
<a href="#l4.665"></a><span id="l4.665" class="difflineminus">-              if (event.screenX &gt; (tabs[i].screenX + (tabs[i].getBoundingClientRect().width / 2)))</span>
<a href="#l4.666"></a><span id="l4.666" class="difflineminus">-                return i;</span>
<a href="#l4.667"></a><span id="l4.667" class="difflineminus">-          }</span>
<a href="#l4.668"></a><span id="l4.668" class="difflineminus">-</span>
<a href="#l4.669"></a><span id="l4.669" class="difflineminus">-           return tabs.length;</span>
<a href="#l4.670"></a><span id="l4.670" class="difflineminus">-        ]]&gt;&lt;/body&gt;</span>
<a href="#l4.671"></a><span id="l4.671" class="difflineminus">-      &lt;/method&gt;</span>
<a href="#l4.672"></a><span id="l4.672" class="difflineminus">-    &lt;/implementation&gt;</span>
<a href="#l4.673"></a><span id="l4.673" class="difflineminus">-    &lt;handlers&gt;</span>
<a href="#l4.674"></a><span id="l4.674" class="difflineminus">-      &lt;handler event=&quot;select&quot;&gt;&lt;![CDATA[</span>
<a href="#l4.675"></a><span id="l4.675" class="difflineminus">-          this._handleTabSelect();</span>
<a href="#l4.676"></a><span id="l4.676" class="difflineminus">-</span>
<a href="#l4.677"></a><span id="l4.677" class="difflineminus">-          if (!(&quot;updateCurrentTab&quot; in this.tabmail) ||</span>
<a href="#l4.678"></a><span id="l4.678" class="difflineminus">-              event.target.localName != &quot;tabs&quot;)</span>
<a href="#l4.679"></a><span id="l4.679" class="difflineminus">-            return;</span>
<a href="#l4.680"></a><span id="l4.680" class="difflineminus">-</span>
<a href="#l4.681"></a><span id="l4.681" class="difflineminus">-          this.tabmail.updateCurrentTab();</span>
<a href="#l4.682"></a><span id="l4.682" class="difflineminus">-      ]]&gt;&lt;/handler&gt;</span>
<a href="#l4.683"></a><span id="l4.683" class="difflineminus">-      &lt;handler event=&quot;TabSelect&quot; action=&quot;this._handleTabSelect();&quot;/&gt;</span>
<a href="#l4.684"></a><span id="l4.684" class="difflineminus">-      &lt;handler event=&quot;dragstart&quot;&gt;&lt;![CDATA[</span>
<a href="#l4.685"></a><span id="l4.685" class="difflineminus">-        let draggedTab = this._getDragTargetTab(event);</span>
<a href="#l4.686"></a><span id="l4.686" class="difflineminus">-</span>
<a href="#l4.687"></a><span id="l4.687" class="difflineminus">-        if (!draggedTab)</span>
<a href="#l4.688"></a><span id="l4.688" class="difflineminus">-          return;</span>
<a href="#l4.689"></a><span id="l4.689" class="difflineminus">-</span>
<a href="#l4.690"></a><span id="l4.690" class="difflineminus">-        let tab = this.tabmail.selectedTab;</span>
<a href="#l4.691"></a><span id="l4.691" class="difflineminus">-</span>
<a href="#l4.692"></a><span id="l4.692" class="difflineminus">-        if (!tab || !tab.canClose)</span>
<a href="#l4.693"></a><span id="l4.693" class="difflineminus">-          return;</span>
<a href="#l4.694"></a><span id="l4.694" class="difflineminus">-</span>
<a href="#l4.695"></a><span id="l4.695" class="difflineminus">-</span>
<a href="#l4.696"></a><span id="l4.696" class="difflineminus">-        let dt = event.dataTransfer;</span>
<a href="#l4.697"></a><span id="l4.697" class="difflineminus">-</span>
<a href="#l4.698"></a><span id="l4.698" class="difflineminus">-        // If we drag within the same window, we use the tab directly</span>
<a href="#l4.699"></a><span id="l4.699" class="difflineminus">-        dt.mozSetDataAt(&quot;application/x-moz-tabmail-tab&quot;, draggedTab, 0);</span>
<a href="#l4.700"></a><span id="l4.700" class="difflineminus">-</span>
<a href="#l4.701"></a><span id="l4.701" class="difflineminus">-        // otherwise we use session restore &amp; JSON to migrate the tab.</span>
<a href="#l4.702"></a><span id="l4.702" class="difflineminus">-        let uri = this.tabmail.persistTab(tab);</span>
<a href="#l4.703"></a><span id="l4.703" class="difflineminus">-</span>
<a href="#l4.704"></a><span id="l4.704" class="difflineminus">-        // In case the tab implements session restore, we use JSON to convert</span>
<a href="#l4.705"></a><span id="l4.705" class="difflineminus">-        // it into a string</span>
<a href="#l4.706"></a><span id="l4.706" class="difflineminus">-        //</span>
<a href="#l4.707"></a><span id="l4.707" class="difflineminus">-        // If a tab does not support session restore it returns null. We can't</span>
<a href="#l4.708"></a><span id="l4.708" class="difflineminus">-        // moved such tabs to a new window. However moving them within the same</span>
<a href="#l4.709"></a><span id="l4.709" class="difflineminus">-        // window works perfectly fine</span>
<a href="#l4.710"></a><span id="l4.710" class="difflineminus">-</span>
<a href="#l4.711"></a><span id="l4.711" class="difflineminus">-        if (uri)</span>
<a href="#l4.712"></a><span id="l4.712" class="difflineminus">-          uri = JSON.stringify(uri);</span>
<a href="#l4.713"></a><span id="l4.713" class="difflineminus">-</span>
<a href="#l4.714"></a><span id="l4.714" class="difflineminus">-        dt.mozSetDataAt(&quot;application/x-moz-tabmail-json&quot;, uri, 0);</span>
<a href="#l4.715"></a><span id="l4.715" class="difflineminus">-</span>
<a href="#l4.716"></a><span id="l4.716" class="difflineminus">-        dt.mozCursor = &quot;default&quot;;</span>
<a href="#l4.717"></a><span id="l4.717" class="difflineminus">-</span>
<a href="#l4.718"></a><span id="l4.718" class="difflineminus">-        // Create Drag Image</span>
<a href="#l4.719"></a><span id="l4.719" class="difflineminus">-        let panel = document.getElementById(&quot;tabpanelcontainer&quot;);</span>
<a href="#l4.720"></a><span id="l4.720" class="difflineminus">-</span>
<a href="#l4.721"></a><span id="l4.721" class="difflineminus">-        let thumbnail = document.createElementNS(&quot;http://www.w3.org/1999/xhtml&quot;, &quot;canvas&quot;);</span>
<a href="#l4.722"></a><span id="l4.722" class="difflineminus">-        thumbnail.width = Math.ceil(screen.availWidth / 5.75);</span>
<a href="#l4.723"></a><span id="l4.723" class="difflineminus">-        thumbnail.height = Math.round(thumbnail.width * 0.5625);</span>
<a href="#l4.724"></a><span id="l4.724" class="difflineminus">-</span>
<a href="#l4.725"></a><span id="l4.725" class="difflineminus">-        let snippetWidth = panel.getBoundingClientRect().width * .6;</span>
<a href="#l4.726"></a><span id="l4.726" class="difflineminus">-        let scale = thumbnail.width / snippetWidth;</span>
<a href="#l4.727"></a><span id="l4.727" class="difflineminus">-</span>
<a href="#l4.728"></a><span id="l4.728" class="difflineminus">-        let ctx = thumbnail.getContext(&quot;2d&quot;);</span>
<a href="#l4.729"></a><span id="l4.729" class="difflineminus">-</span>
<a href="#l4.730"></a><span id="l4.730" class="difflineminus">-        ctx.scale(scale, scale);</span>
<a href="#l4.731"></a><span id="l4.731" class="difflineminus">-</span>
<a href="#l4.732"></a><span id="l4.732" class="difflineminus">-        ctx.drawWindow(window,</span>
<a href="#l4.733"></a><span id="l4.733" class="difflineminus">-                panel.screenX - window.mozInnerScreenX,</span>
<a href="#l4.734"></a><span id="l4.734" class="difflineminus">-                panel.screenY - window.mozInnerScreenY,</span>
<a href="#l4.735"></a><span id="l4.735" class="difflineminus">-                snippetWidth,</span>
<a href="#l4.736"></a><span id="l4.736" class="difflineminus">-                snippetWidth * 0.5625,</span>
<a href="#l4.737"></a><span id="l4.737" class="difflineminus">-                &quot;rgb(255,255,255)&quot;);</span>
<a href="#l4.738"></a><span id="l4.738" class="difflineminus">-</span>
<a href="#l4.739"></a><span id="l4.739" class="difflineminus">-        dt = event.dataTransfer;</span>
<a href="#l4.740"></a><span id="l4.740" class="difflineminus">-        dt.setDragImage(thumbnail, 0, 0);</span>
<a href="#l4.741"></a><span id="l4.741" class="difflineminus">-</span>
<a href="#l4.742"></a><span id="l4.742" class="difflineminus">-        event.stopPropagation();</span>
<a href="#l4.743"></a><span id="l4.743" class="difflineminus">-      ]]&gt;&lt;/handler&gt;</span>
<a href="#l4.744"></a><span id="l4.744" class="difflineminus">-      &lt;handler event=&quot;dragover&quot;&gt;&lt;![CDATA[</span>
<a href="#l4.745"></a><span id="l4.745" class="difflineminus">-        let dt = event.dataTransfer;</span>
<a href="#l4.746"></a><span id="l4.746" class="difflineminus">-</span>
<a href="#l4.747"></a><span id="l4.747" class="difflineminus">-        if (dt.mozItemCount == 0)</span>
<a href="#l4.748"></a><span id="l4.748" class="difflineminus">-          return;</span>
<a href="#l4.749"></a><span id="l4.749" class="difflineminus">-</span>
<a href="#l4.750"></a><span id="l4.750" class="difflineminus">-        if (dt.mozGetDataAt(&quot;text/toolbarwrapper-id/messengerWindow&quot;, 0)</span>
<a href="#l4.751"></a><span id="l4.751" class="difflineminus">-            != null) {</span>
<a href="#l4.752"></a><span id="l4.752" class="difflineminus">-          event.preventDefault();</span>
<a href="#l4.753"></a><span id="l4.753" class="difflineminus">-          event.stopPropagation();</span>
<a href="#l4.754"></a><span id="l4.754" class="difflineminus">-</span>
<a href="#l4.755"></a><span id="l4.755" class="difflineminus">-          // Dispatch event to the toolbar</span>
<a href="#l4.756"></a><span id="l4.756" class="difflineminus">-          let evt = document.createEvent(&quot;DragEvent&quot;);</span>
<a href="#l4.757"></a><span id="l4.757" class="difflineminus">-          evt.initDragEvent(&quot;dragover&quot;, true, true, window, 0, 0, 0, 0, 0,</span>
<a href="#l4.758"></a><span id="l4.758" class="difflineminus">-                            false, false, false, false, 0, null,</span>
<a href="#l4.759"></a><span id="l4.759" class="difflineminus">-                            event.dataTransfer);</span>
<a href="#l4.760"></a><span id="l4.760" class="difflineminus">-</span>
<a href="#l4.761"></a><span id="l4.761" class="difflineminus">-          if (this.mToolbar.firstChild)</span>
<a href="#l4.762"></a><span id="l4.762" class="difflineminus">-            this.mToolbar.firstChild.dispatchEvent(evt);</span>
<a href="#l4.763"></a><span id="l4.763" class="difflineminus">-          else</span>
<a href="#l4.764"></a><span id="l4.764" class="difflineminus">-            this.mToolbar.dispatchEvent(evt);</span>
<a href="#l4.765"></a><span id="l4.765" class="difflineminus">-</span>
<a href="#l4.766"></a><span id="l4.766" class="difflineminus">-          return;</span>
<a href="#l4.767"></a><span id="l4.767" class="difflineminus">-        }</span>
<a href="#l4.768"></a><span id="l4.768" class="difflineminus">-</span>
<a href="#l4.769"></a><span id="l4.769" class="difflineminus">-        // Bug 516247:</span>
<a href="#l4.770"></a><span id="l4.770" class="difflineminus">-        // in case the user is dragging something else than a tab, and</span>
<a href="#l4.771"></a><span id="l4.771" class="difflineminus">-        // keeps hovering over a tab, we assume he wants to switch to this tab.</span>
<a href="#l4.772"></a><span id="l4.772" class="difflineminus">-        if ((dt.mozTypesAt(0)[0] != &quot;application/x-moz-tabmail-tab&quot;)</span>
<a href="#l4.773"></a><span id="l4.773" class="difflineminus">-            &amp;&amp; (dt.mozTypesAt(0)[1] != &quot;application/x-moz-tabmail-json&quot;)) {</span>
<a href="#l4.774"></a><span id="l4.774" class="difflineminus">-          let tab = this._getDragTargetTab(event);</span>
<a href="#l4.775"></a><span id="l4.775" class="difflineminus">-</span>
<a href="#l4.776"></a><span id="l4.776" class="difflineminus">-          if (!tab)</span>
<a href="#l4.777"></a><span id="l4.777" class="difflineminus">-            return;</span>
<a href="#l4.778"></a><span id="l4.778" class="difflineminus">-</span>
<a href="#l4.779"></a><span id="l4.779" class="difflineminus">-          event.preventDefault();</span>
<a href="#l4.780"></a><span id="l4.780" class="difflineminus">-          event.stopPropagation();</span>
<a href="#l4.781"></a><span id="l4.781" class="difflineminus">-</span>
<a href="#l4.782"></a><span id="l4.782" class="difflineminus">-          if (!this._dragTime) {</span>
<a href="#l4.783"></a><span id="l4.783" class="difflineminus">-            this._dragTime = Date.now();</span>
<a href="#l4.784"></a><span id="l4.784" class="difflineminus">-            return;</span>
<a href="#l4.785"></a><span id="l4.785" class="difflineminus">-          }</span>
<a href="#l4.786"></a><span id="l4.786" class="difflineminus">-</span>
<a href="#l4.787"></a><span id="l4.787" class="difflineminus">-          if (Date.now() &lt;= this._dragTime + this._dragOverDelay)</span>
<a href="#l4.788"></a><span id="l4.788" class="difflineminus">-            return;</span>
<a href="#l4.789"></a><span id="l4.789" class="difflineminus">-</span>
<a href="#l4.790"></a><span id="l4.790" class="difflineminus">-          if (this.tabmail.tabContainer.selectedItem == tab)</span>
<a href="#l4.791"></a><span id="l4.791" class="difflineminus">-            return;</span>
<a href="#l4.792"></a><span id="l4.792" class="difflineminus">-</span>
<a href="#l4.793"></a><span id="l4.793" class="difflineminus">-          this.tabmail.tabContainer.selectedItem = tab;</span>
<a href="#l4.794"></a><span id="l4.794" class="difflineminus">-</span>
<a href="#l4.795"></a><span id="l4.795" class="difflineminus">-          return;</span>
<a href="#l4.796"></a><span id="l4.796" class="difflineminus">-        }</span>
<a href="#l4.797"></a><span id="l4.797" class="difflineminus">-</span>
<a href="#l4.798"></a><span id="l4.798" class="difflineminus">-        // as some tabs do not support session restore they can't be</span>
<a href="#l4.799"></a><span id="l4.799" class="difflineminus">-        // moved to a different or new window. We should not show</span>
<a href="#l4.800"></a><span id="l4.800" class="difflineminus">-        // a dropmarker in such a case</span>
<a href="#l4.801"></a><span id="l4.801" class="difflineminus">-        if (!dt.mozGetDataAt(&quot;application/x-moz-tabmail-json&quot;, 0)) {</span>
<a href="#l4.802"></a><span id="l4.802" class="difflineminus">-          let draggedTab = dt.mozGetDataAt(&quot;application/x-moz-tabmail-tab&quot;, 0);</span>
<a href="#l4.803"></a><span id="l4.803" class="difflineminus">-</span>
<a href="#l4.804"></a><span id="l4.804" class="difflineminus">-          if (!draggedTab)</span>
<a href="#l4.805"></a><span id="l4.805" class="difflineminus">-            return;</span>
<a href="#l4.806"></a><span id="l4.806" class="difflineminus">-</span>
<a href="#l4.807"></a><span id="l4.807" class="difflineminus">-          if (this.tabmail.tabContainer.getIndexOfItem(draggedTab) == -1)</span>
<a href="#l4.808"></a><span id="l4.808" class="difflineminus">-            return;</span>
<a href="#l4.809"></a><span id="l4.809" class="difflineminus">-        }</span>
<a href="#l4.810"></a><span id="l4.810" class="difflineminus">-</span>
<a href="#l4.811"></a><span id="l4.811" class="difflineminus">-        dt.effectAllowed = &quot;copyMove&quot;;</span>
<a href="#l4.812"></a><span id="l4.812" class="difflineminus">-</span>
<a href="#l4.813"></a><span id="l4.813" class="difflineminus">-        event.preventDefault();</span>
<a href="#l4.814"></a><span id="l4.814" class="difflineminus">-        event.stopPropagation();</span>
<a href="#l4.815"></a><span id="l4.815" class="difflineminus">-</span>
<a href="#l4.816"></a><span id="l4.816" class="difflineminus">-        let ltr = (window.getComputedStyle(this).direction == &quot;ltr&quot;);</span>
<a href="#l4.817"></a><span id="l4.817" class="difflineminus">-        let ind = this._tabDropIndicator;</span>
<a href="#l4.818"></a><span id="l4.818" class="difflineminus">-</span>
<a href="#l4.819"></a><span id="l4.819" class="difflineminus">-        // Let's scroll</span>
<a href="#l4.820"></a><span id="l4.820" class="difflineminus">-        if (this.hasAttribute(&quot;overflow&quot;)) {</span>
<a href="#l4.821"></a><span id="l4.821" class="difflineminus">-          let target = event.originalTarget.getAttribute(&quot;anonid&quot;);</span>
<a href="#l4.822"></a><span id="l4.822" class="difflineminus">-</span>
<a href="#l4.823"></a><span id="l4.823" class="difflineminus">-          let pixelsToScroll = 0;</span>
<a href="#l4.824"></a><span id="l4.824" class="difflineminus">-</span>
<a href="#l4.825"></a><span id="l4.825" class="difflineminus">-          if (target == &quot;scrollbutton-up&quot;)</span>
<a href="#l4.826"></a><span id="l4.826" class="difflineminus">-            pixelsToScroll = this.arrowScrollbox.scrollIncrement;</span>
<a href="#l4.827"></a><span id="l4.827" class="difflineminus">-</span>
<a href="#l4.828"></a><span id="l4.828" class="difflineminus">-          if (target == &quot;scrollbutton-down&quot;)</span>
<a href="#l4.829"></a><span id="l4.829" class="difflineminus">-            pixelsToScroll = this.arrowScrollbox.scrollIncrement * -1;</span>
<a href="#l4.830"></a><span id="l4.830" class="difflineminus">-</span>
<a href="#l4.831"></a><span id="l4.831" class="difflineminus">-          if (ltr)</span>
<a href="#l4.832"></a><span id="l4.832" class="difflineminus">-            pixelsToScroll = pixelsToScroll * -1;</span>
<a href="#l4.833"></a><span id="l4.833" class="difflineminus">-</span>
<a href="#l4.834"></a><span id="l4.834" class="difflineminus">-          if (pixelsToScroll) {</span>
<a href="#l4.835"></a><span id="l4.835" class="difflineminus">-            // Hide Indicator while Scrolling</span>
<a href="#l4.836"></a><span id="l4.836" class="difflineminus">-            ind.collapsed = true;</span>
<a href="#l4.837"></a><span id="l4.837" class="difflineminus">-            this.arrowScrollbox.scrollByPixels(pixelsToScroll);</span>
<a href="#l4.838"></a><span id="l4.838" class="difflineminus">-            return;</span>
<a href="#l4.839"></a><span id="l4.839" class="difflineminus">-          }</span>
<a href="#l4.840"></a><span id="l4.840" class="difflineminus">-        }</span>
<a href="#l4.841"></a><span id="l4.841" class="difflineminus">-</span>
<a href="#l4.842"></a><span id="l4.842" class="difflineminus">-        let newIndex = this._getDropIndex(event);</span>
<a href="#l4.843"></a><span id="l4.843" class="difflineminus">-</span>
<a href="#l4.844"></a><span id="l4.844" class="difflineminus">-        // fix the DropIndex in case it points to tab that can't be closed</span>
<a href="#l4.845"></a><span id="l4.845" class="difflineminus">-        let tabInfo = this.tabmail.tabInfo;</span>
<a href="#l4.846"></a><span id="l4.846" class="difflineminus">-</span>
<a href="#l4.847"></a><span id="l4.847" class="difflineminus">-        while ((newIndex &lt; tabInfo.length) &amp;&amp; !(tabInfo[newIndex].canClose))</span>
<a href="#l4.848"></a><span id="l4.848" class="difflineminus">-          newIndex++;</span>
<a href="#l4.849"></a><span id="l4.849" class="difflineminus">-</span>
<a href="#l4.850"></a><span id="l4.850" class="difflineminus">-</span>
<a href="#l4.851"></a><span id="l4.851" class="difflineminus">-        var scrollRect = this.arrowScrollbox.scrollClientRect;</span>
<a href="#l4.852"></a><span id="l4.852" class="difflineminus">-        var rect = this.getBoundingClientRect();</span>
<a href="#l4.853"></a><span id="l4.853" class="difflineminus">-        var minMargin = scrollRect.left - rect.left;</span>
<a href="#l4.854"></a><span id="l4.854" class="difflineminus">-        var maxMargin = Math.min(minMargin + scrollRect.width, scrollRect.right);</span>
<a href="#l4.855"></a><span id="l4.855" class="difflineminus">-</span>
<a href="#l4.856"></a><span id="l4.856" class="difflineminus">-        if (!ltr)</span>
<a href="#l4.857"></a><span id="l4.857" class="difflineminus">-          [minMargin, maxMargin] = [this.clientWidth - maxMargin, this.clientWidth - minMargin];</span>
<a href="#l4.858"></a><span id="l4.858" class="difflineminus">-</span>
<a href="#l4.859"></a><span id="l4.859" class="difflineminus">-        var newMargin;</span>
<a href="#l4.860"></a><span id="l4.860" class="difflineminus">-</span>
<a href="#l4.861"></a><span id="l4.861" class="difflineminus">-        if (newIndex == this.childNodes.length) {</span>
<a href="#l4.862"></a><span id="l4.862" class="difflineminus">-          let tabRect = this.childNodes[newIndex - 1].getBoundingClientRect();</span>
<a href="#l4.863"></a><span id="l4.863" class="difflineminus">-</span>
<a href="#l4.864"></a><span id="l4.864" class="difflineminus">-          if (ltr)</span>
<a href="#l4.865"></a><span id="l4.865" class="difflineminus">-            newMargin = tabRect.right - rect.left;</span>
<a href="#l4.866"></a><span id="l4.866" class="difflineminus">-          else</span>
<a href="#l4.867"></a><span id="l4.867" class="difflineminus">-            newMargin = rect.right - tabRect.left;</span>
<a href="#l4.868"></a><span id="l4.868" class="difflineminus">-        } else {</span>
<a href="#l4.869"></a><span id="l4.869" class="difflineminus">-          let tabRect = this.childNodes[newIndex].getBoundingClientRect();</span>
<a href="#l4.870"></a><span id="l4.870" class="difflineminus">-</span>
<a href="#l4.871"></a><span id="l4.871" class="difflineminus">-          if (ltr)</span>
<a href="#l4.872"></a><span id="l4.872" class="difflineminus">-            newMargin = tabRect.left - rect.left;</span>
<a href="#l4.873"></a><span id="l4.873" class="difflineminus">-          else</span>
<a href="#l4.874"></a><span id="l4.874" class="difflineminus">-            newMargin = rect.right - tabRect.right;</span>
<a href="#l4.875"></a><span id="l4.875" class="difflineminus">-        }</span>
<a href="#l4.876"></a><span id="l4.876" class="difflineminus">-</span>
<a href="#l4.877"></a><span id="l4.877" class="difflineminus">-        ind.collapsed = false;</span>
<a href="#l4.878"></a><span id="l4.878" class="difflineminus">-</span>
<a href="#l4.879"></a><span id="l4.879" class="difflineminus">-        newMargin += ind.clientWidth / 2;</span>
<a href="#l4.880"></a><span id="l4.880" class="difflineminus">-        if (!ltr)</span>
<a href="#l4.881"></a><span id="l4.881" class="difflineminus">-          newMargin *= -1;</span>
<a href="#l4.882"></a><span id="l4.882" class="difflineminus">-</span>
<a href="#l4.883"></a><span id="l4.883" class="difflineminus">-        ind.style.transform = &quot;translate(&quot; + Math.round(newMargin) + &quot;px)&quot;;</span>
<a href="#l4.884"></a><span id="l4.884" class="difflineminus">-        ind.style.marginInlineStart = (-ind.clientWidth) + &quot;px&quot;;</span>
<a href="#l4.885"></a><span id="l4.885" class="difflineminus">-      ]]&gt;&lt;/handler&gt;</span>
<a href="#l4.886"></a><span id="l4.886" class="difflineminus">-      &lt;handler event=&quot;drop&quot;&gt;&lt;![CDATA[</span>
<a href="#l4.887"></a><span id="l4.887" class="difflineminus">-        let dt = event.dataTransfer;</span>
<a href="#l4.888"></a><span id="l4.888" class="difflineminus">-</span>
<a href="#l4.889"></a><span id="l4.889" class="difflineminus">-        if (dt.mozItemCount != 1)</span>
<a href="#l4.890"></a><span id="l4.890" class="difflineminus">-          return;</span>
<a href="#l4.891"></a><span id="l4.891" class="difflineminus">-</span>
<a href="#l4.892"></a><span id="l4.892" class="difflineminus">-</span>
<a href="#l4.893"></a><span id="l4.893" class="difflineminus">-        /* If we're dragging a toolbar button, let's prepend the tabs toolbar</span>
<a href="#l4.894"></a><span id="l4.894" class="difflineminus">-         * with that button, and then bail out.</span>
<a href="#l4.895"></a><span id="l4.895" class="difflineminus">-         */</span>
<a href="#l4.896"></a><span id="l4.896" class="difflineminus">-        let buttonId = dt.mozGetDataAt(&quot;text/toolbarwrapper-id/messengerWindow&quot;, 0);</span>
<a href="#l4.897"></a><span id="l4.897" class="difflineminus">-</span>
<a href="#l4.898"></a><span id="l4.898" class="difflineminus">-        if (buttonId != null) {</span>
<a href="#l4.899"></a><span id="l4.899" class="difflineminus">-          event.preventDefault();</span>
<a href="#l4.900"></a><span id="l4.900" class="difflineminus">-          event.stopPropagation();</span>
<a href="#l4.901"></a><span id="l4.901" class="difflineminus">-</span>
<a href="#l4.902"></a><span id="l4.902" class="difflineminus">-          let evt = document.createEvent(&quot;DragEvent&quot;);</span>
<a href="#l4.903"></a><span id="l4.903" class="difflineminus">-          evt.initDragEvent(&quot;drop&quot;, true, true, window, 0, 0, 0, 0, 0,</span>
<a href="#l4.904"></a><span id="l4.904" class="difflineminus">-                            false, false, false, false, 0, null,</span>
<a href="#l4.905"></a><span id="l4.905" class="difflineminus">-                            event.dataTransfer);</span>
<a href="#l4.906"></a><span id="l4.906" class="difflineminus">-</span>
<a href="#l4.907"></a><span id="l4.907" class="difflineminus">-          if (this.mToolbar.firstChild)</span>
<a href="#l4.908"></a><span id="l4.908" class="difflineminus">-            this.mToolbar.firstChild.dispatchEvent(evt);</span>
<a href="#l4.909"></a><span id="l4.909" class="difflineminus">-          else</span>
<a href="#l4.910"></a><span id="l4.910" class="difflineminus">-            this.mToolbar.dispatchEvent(evt);</span>
<a href="#l4.911"></a><span id="l4.911" class="difflineminus">-</span>
<a href="#l4.912"></a><span id="l4.912" class="difflineminus">-          return;</span>
<a href="#l4.913"></a><span id="l4.913" class="difflineminus">-        }</span>
<a href="#l4.914"></a><span id="l4.914" class="difflineminus">-</span>
<a href="#l4.915"></a><span id="l4.915" class="difflineminus">-</span>
<a href="#l4.916"></a><span id="l4.916" class="difflineminus">-        let draggedTab = dt.mozGetDataAt(&quot;application/x-moz-tabmail-tab&quot;, 0);</span>
<a href="#l4.917"></a><span id="l4.917" class="difflineminus">-</span>
<a href="#l4.918"></a><span id="l4.918" class="difflineminus">-        if (!draggedTab)</span>
<a href="#l4.919"></a><span id="l4.919" class="difflineminus">-          return;</span>
<a href="#l4.920"></a><span id="l4.920" class="difflineminus">-</span>
<a href="#l4.921"></a><span id="l4.921" class="difflineminus">-        event.stopPropagation();</span>
<a href="#l4.922"></a><span id="l4.922" class="difflineminus">-        this._tabDropIndicator.collapsed = true;</span>
<a href="#l4.923"></a><span id="l4.923" class="difflineminus">-</span>
<a href="#l4.924"></a><span id="l4.924" class="difflineminus">-        // Is the tab one of our children?</span>
<a href="#l4.925"></a><span id="l4.925" class="difflineminus">-        if (this.tabmail.tabContainer.getIndexOfItem(draggedTab) == -1) {</span>
<a href="#l4.926"></a><span id="l4.926" class="difflineminus">-          // It's a tab from an other window, so we have to trigger session</span>
<a href="#l4.927"></a><span id="l4.927" class="difflineminus">-          // restore to get our tab</span>
<a href="#l4.928"></a><span id="l4.928" class="difflineminus">-</span>
<a href="#l4.929"></a><span id="l4.929" class="difflineminus">-          let tabmail2 = draggedTab.ownerDocument.getElementById(&quot;tabmail&quot;);</span>
<a href="#l4.930"></a><span id="l4.930" class="difflineminus">-          if (!tabmail2)</span>
<a href="#l4.931"></a><span id="l4.931" class="difflineminus">-            return;</span>
<a href="#l4.932"></a><span id="l4.932" class="difflineminus">-</span>
<a href="#l4.933"></a><span id="l4.933" class="difflineminus">-          let draggedJson = dt.mozGetDataAt(&quot;application/x-moz-tabmail-json&quot;, 0);</span>
<a href="#l4.934"></a><span id="l4.934" class="difflineminus">-          if (!draggedJson)</span>
<a href="#l4.935"></a><span id="l4.935" class="difflineminus">-            return;</span>
<a href="#l4.936"></a><span id="l4.936" class="difflineminus">-</span>
<a href="#l4.937"></a><span id="l4.937" class="difflineminus">-          draggedJson = JSON.parse(draggedJson);</span>
<a href="#l4.938"></a><span id="l4.938" class="difflineminus">-</span>
<a href="#l4.939"></a><span id="l4.939" class="difflineminus">-          // Some tab exist only once, so we have to gamble a bit. We close</span>
<a href="#l4.940"></a><span id="l4.940" class="difflineminus">-          // the tab and try to reopen it. If something fails the tab is gone.</span>
<a href="#l4.941"></a><span id="l4.941" class="difflineminus">-</span>
<a href="#l4.942"></a><span id="l4.942" class="difflineminus">-          tabmail2.closeTab(draggedTab, true);</span>
<a href="#l4.943"></a><span id="l4.943" class="difflineminus">-</span>
<a href="#l4.944"></a><span id="l4.944" class="difflineminus">-          if (!this.tabmail.restoreTab(draggedJson))</span>
<a href="#l4.945"></a><span id="l4.945" class="difflineminus">-            return;</span>
<a href="#l4.946"></a><span id="l4.946" class="difflineminus">-</span>
<a href="#l4.947"></a><span id="l4.947" class="difflineminus">-          draggedTab = this.tabmail.tabContainer.childNodes[</span>
<a href="#l4.948"></a><span id="l4.948" class="difflineminus">-            this.tabmail.tabContainer.childNodes.length - 1];</span>
<a href="#l4.949"></a><span id="l4.949" class="difflineminus">-        }</span>
<a href="#l4.950"></a><span id="l4.950" class="difflineminus">-</span>
<a href="#l4.951"></a><span id="l4.951" class="difflineminus">-        let idx = this._getDropIndex(event);</span>
<a href="#l4.952"></a><span id="l4.952" class="difflineminus">-</span>
<a href="#l4.953"></a><span id="l4.953" class="difflineminus">-        // fix the DropIndex in case it points to tab that can't be closed</span>
<a href="#l4.954"></a><span id="l4.954" class="difflineminus">-        let tabInfo = this.tabmail.tabInfo;</span>
<a href="#l4.955"></a><span id="l4.955" class="difflineminus">-        while ((idx &lt; tabInfo.length) &amp;&amp; !(tabInfo[idx].canClose))</span>
<a href="#l4.956"></a><span id="l4.956" class="difflineminus">-          idx++;</span>
<a href="#l4.957"></a><span id="l4.957" class="difflineminus">-</span>
<a href="#l4.958"></a><span id="l4.958" class="difflineminus">-        this.tabmail.moveTabTo(draggedTab, idx);</span>
<a href="#l4.959"></a><span id="l4.959" class="difflineminus">-</span>
<a href="#l4.960"></a><span id="l4.960" class="difflineminus">-        this.tabmail.switchToTab(draggedTab);</span>
<a href="#l4.961"></a><span id="l4.961" class="difflineminus">-        this.tabmail.updateCurrentTab();</span>
<a href="#l4.962"></a><span id="l4.962" class="difflineminus">-      ]]&gt;&lt;/handler&gt;</span>
<a href="#l4.963"></a><span id="l4.963" class="difflineminus">-</span>
<a href="#l4.964"></a><span id="l4.964" class="difflineminus">-      &lt;handler event=&quot;dragend&quot;&gt;&lt;![CDATA[</span>
<a href="#l4.965"></a><span id="l4.965" class="difflineminus">-</span>
<a href="#l4.966"></a><span id="l4.966" class="difflineminus">-        // Note: while this case is correctly handled here, this event</span>
<a href="#l4.967"></a><span id="l4.967" class="difflineminus">-        // isn't dispatched when the tab is moved within the tabstrip,</span>
<a href="#l4.968"></a><span id="l4.968" class="difflineminus">-        // see bug 460801.</span>
<a href="#l4.969"></a><span id="l4.969" class="difflineminus">-</span>
<a href="#l4.970"></a><span id="l4.970" class="difflineminus">-        // the user pressed ESC to cancel the drag, or the drag succeeded</span>
<a href="#l4.971"></a><span id="l4.971" class="difflineminus">-        var dt = event.dataTransfer;</span>
<a href="#l4.972"></a><span id="l4.972" class="difflineminus">-        if ((dt.mozUserCancelled) || (dt.dropEffect != &quot;none&quot;))</span>
<a href="#l4.973"></a><span id="l4.973" class="difflineminus">-          return;</span>
<a href="#l4.974"></a><span id="l4.974" class="difflineminus">-</span>
<a href="#l4.975"></a><span id="l4.975" class="difflineminus">-        // Disable detach within the browser toolbox</span>
<a href="#l4.976"></a><span id="l4.976" class="difflineminus">-        var eX = event.screenX;</span>
<a href="#l4.977"></a><span id="l4.977" class="difflineminus">-        var wX = window.screenX;</span>
<a href="#l4.978"></a><span id="l4.978" class="difflineminus">-</span>
<a href="#l4.979"></a><span id="l4.979" class="difflineminus">-        // check if the drop point is horizontally within the window</span>
<a href="#l4.980"></a><span id="l4.980" class="difflineminus">-        if (eX &gt; wX &amp;&amp; eX &lt; (wX + window.outerWidth)) {</span>
<a href="#l4.981"></a><span id="l4.981" class="difflineminus">-          let bo = this.arrowScrollbox;</span>
<a href="#l4.982"></a><span id="l4.982" class="difflineminus">-          // also avoid detaching if the the tab was dropped too close to</span>
<a href="#l4.983"></a><span id="l4.983" class="difflineminus">-          // the tabbar (half a tab)</span>
<a href="#l4.984"></a><span id="l4.984" class="difflineminus">-          let endScreenY = bo.screenY + 1.5 * bo.getBoundingClientRect().height;</span>
<a href="#l4.985"></a><span id="l4.985" class="difflineminus">-          let eY = event.screenY;</span>
<a href="#l4.986"></a><span id="l4.986" class="difflineminus">-</span>
<a href="#l4.987"></a><span id="l4.987" class="difflineminus">-          if (eY &lt; endScreenY &amp;&amp; eY &gt; window.screenY)</span>
<a href="#l4.988"></a><span id="l4.988" class="difflineminus">-            return;</span>
<a href="#l4.989"></a><span id="l4.989" class="difflineminus">-        }</span>
<a href="#l4.990"></a><span id="l4.990" class="difflineminus">-</span>
<a href="#l4.991"></a><span id="l4.991" class="difflineminus">-        // user wants to deatach tab from window...</span>
<a href="#l4.992"></a><span id="l4.992" class="difflineminus">-        if (dt.mozItemCount != 1)</span>
<a href="#l4.993"></a><span id="l4.993" class="difflineminus">-          return;</span>
<a href="#l4.994"></a><span id="l4.994" class="difflineminus">-</span>
<a href="#l4.995"></a><span id="l4.995" class="difflineminus">-        let draggedTab = dt.mozGetDataAt(&quot;application/x-moz-tabmail-tab&quot;, 0);</span>
<a href="#l4.996"></a><span id="l4.996" class="difflineminus">-</span>
<a href="#l4.997"></a><span id="l4.997" class="difflineminus">-        if (!draggedTab)</span>
<a href="#l4.998"></a><span id="l4.998" class="difflineminus">-          return;</span>
<a href="#l4.999"></a><span id="l4.999" class="difflineminus">-</span>
<a href="#l4.1000"></a><span id="l4.1000" class="difflineminus">-        this.tabmail.replaceTabWithWindow(draggedTab);</span>
<a href="#l4.1001"></a><span id="l4.1001" class="difflineminus">-</span>
<a href="#l4.1002"></a><span id="l4.1002" class="difflineminus">-      ]]&gt;&lt;/handler&gt;</span>
<a href="#l4.1003"></a><span id="l4.1003" class="difflineminus">-</span>
<a href="#l4.1004"></a><span id="l4.1004" class="difflineminus">-      &lt;handler event=&quot;dragexit&quot;&gt;&lt;![CDATA[</span>
<a href="#l4.1005"></a><span id="l4.1005" class="difflineminus">-        this._dragTime = 0;</span>
<a href="#l4.1006"></a><span id="l4.1006" class="difflineminus">-</span>
<a href="#l4.1007"></a><span id="l4.1007" class="difflineminus">-        this._tabDropIndicator.collapsed = true;</span>
<a href="#l4.1008"></a><span id="l4.1008" class="difflineminus">-        event.stopPropagation();</span>
<a href="#l4.1009"></a><span id="l4.1009" class="difflineminus">-</span>
<a href="#l4.1010"></a><span id="l4.1010" class="difflineminus">-      ]]&gt;&lt;/handler&gt;</span>
<a href="#l4.1011"></a><span id="l4.1011" class="difflineminus">-      &lt;handler event=&quot;click&quot; button=&quot;0&quot;&gt;&lt;![CDATA[</span>
<a href="#l4.1012"></a><span id="l4.1012" class="difflineminus">-        if (!event.originalTarget.classList.contains(&quot;tabs-closebutton&quot;)) {</span>
<a href="#l4.1013"></a><span id="l4.1013" class="difflineminus">-          return;</span>
<a href="#l4.1014"></a><span id="l4.1014" class="difflineminus">-        }</span>
<a href="#l4.1015"></a><span id="l4.1015" class="difflineminus">-</span>
<a href="#l4.1016"></a><span id="l4.1016" class="difflineminus">-        let tabbedBrowser = document.getElementById(&quot;tabmail&quot;);</span>
<a href="#l4.1017"></a><span id="l4.1017" class="difflineminus">-        if (this.localName == &quot;tab&quot;) {</span>
<a href="#l4.1018"></a><span id="l4.1018" class="difflineminus">-          /* The only sequence in which a second click event (i.e. dblclik)</span>
<a href="#l4.1019"></a><span id="l4.1019" class="difflineminus">-           * can be dispatched on an in-tab close button is when it is shown</span>
<a href="#l4.1020"></a><span id="l4.1020" class="difflineminus">-           * after the first click (i.e. the first click event was dispatched</span>
<a href="#l4.1021"></a><span id="l4.1021" class="difflineminus">-           * on the tab). This happens when we show the close button only on</span>
<a href="#l4.1022"></a><span id="l4.1022" class="difflineminus">-           * the active tab. (bug 352021)</span>
<a href="#l4.1023"></a><span id="l4.1023" class="difflineminus">-           * The only sequence in which a third click event can be dispatched</span>
<a href="#l4.1024"></a><span id="l4.1024" class="difflineminus">-           * on an in-tab close button is when the tab was opened with a</span>
<a href="#l4.1025"></a><span id="l4.1025" class="difflineminus">-           * double click on the tabbar. (bug 378344)</span>
<a href="#l4.1026"></a><span id="l4.1026" class="difflineminus">-           * In both cases, it is most likely that the close button area has</span>
<a href="#l4.1027"></a><span id="l4.1027" class="difflineminus">-           * been accidentally clicked, therefore we do not close the tab.</span>
<a href="#l4.1028"></a><span id="l4.1028" class="difflineminus">-           */</span>
<a href="#l4.1029"></a><span id="l4.1029" class="difflineminus">-          if (event.detail &gt; 1)</span>
<a href="#l4.1030"></a><span id="l4.1030" class="difflineminus">-            return;</span>
<a href="#l4.1031"></a><span id="l4.1031" class="difflineminus">-</span>
<a href="#l4.1032"></a><span id="l4.1032" class="difflineminus">-          tabbedBrowser.removeTabByNode(this);</span>
<a href="#l4.1033"></a><span id="l4.1033" class="difflineminus">-          tabbedBrowser._blockDblClick = true;</span>
<a href="#l4.1034"></a><span id="l4.1034" class="difflineminus">-          let tabContainer = tabbedBrowser.tabContainer;</span>
<a href="#l4.1035"></a><span id="l4.1035" class="difflineminus">-</span>
<a href="#l4.1036"></a><span id="l4.1036" class="difflineminus">-          /* XXXmano hack (see bug 343628):</span>
<a href="#l4.1037"></a><span id="l4.1037" class="difflineminus">-           * Since we're removing the event target, if the user</span>
<a href="#l4.1038"></a><span id="l4.1038" class="difflineminus">-           * double-clicks this button, the dblclick event will be dispatched</span>
<a href="#l4.1039"></a><span id="l4.1039" class="difflineminus">-           * with the tabbar as its event target (and explicit/originalTarget),</span>
<a href="#l4.1040"></a><span id="l4.1040" class="difflineminus">-           * which treats that as a mouse gesture for opening a new tab.</span>
<a href="#l4.1041"></a><span id="l4.1041" class="difflineminus">-           * In this context, we're manually blocking the dblclick event</span>
<a href="#l4.1042"></a><span id="l4.1042" class="difflineminus">-           * (see onTabBarDblClick).</span>
<a href="#l4.1043"></a><span id="l4.1043" class="difflineminus">-           */</span>
<a href="#l4.1044"></a><span id="l4.1044" class="difflineminus">-          let clickedOnce = false;</span>
<a href="#l4.1045"></a><span id="l4.1045" class="difflineminus">-          let enableDblClick = function enableDblClick(event) {</span>
<a href="#l4.1046"></a><span id="l4.1046" class="difflineminus">-            let target = event.originalTarget;</span>
<a href="#l4.1047"></a><span id="l4.1047" class="difflineminus">-            if (target.className == &quot;tab-close-button&quot;) {</span>
<a href="#l4.1048"></a><span id="l4.1048" class="difflineminus">-              target._ignoredClick = true;</span>
<a href="#l4.1049"></a><span id="l4.1049" class="difflineminus">-            }</span>
<a href="#l4.1050"></a><span id="l4.1050" class="difflineminus">-            if (!clickedOnce) {</span>
<a href="#l4.1051"></a><span id="l4.1051" class="difflineminus">-              clickedOnce = true;</span>
<a href="#l4.1052"></a><span id="l4.1052" class="difflineminus">-              return;</span>
<a href="#l4.1053"></a><span id="l4.1053" class="difflineminus">-            }</span>
<a href="#l4.1054"></a><span id="l4.1054" class="difflineminus">-            tabContainer._blockDblClick = false;</span>
<a href="#l4.1055"></a><span id="l4.1055" class="difflineminus">-            tabContainer.removeEventListener(&quot;click&quot;, enableDblClick, true);</span>
<a href="#l4.1056"></a><span id="l4.1056" class="difflineminus">-          };</span>
<a href="#l4.1057"></a><span id="l4.1057" class="difflineminus">-          tabContainer.addEventListener(&quot;click&quot;, enableDblClick, true);</span>
<a href="#l4.1058"></a><span id="l4.1058" class="difflineminus">-        } else { // &quot;tabs&quot;</span>
<a href="#l4.1059"></a><span id="l4.1059" class="difflineminus">-          tabbedBrowser.removeCurrentTab();</span>
<a href="#l4.1060"></a><span id="l4.1060" class="difflineminus">-        }</span>
<a href="#l4.1061"></a><span id="l4.1061" class="difflineminus">-      ]]&gt;&lt;/handler&gt;</span>
<a href="#l4.1062"></a><span id="l4.1062" class="difflineminus">-      &lt;handler event=&quot;dblclick&quot; button=&quot;0&quot; phase=&quot;capturing&quot;&gt;&lt;![CDATA[</span>
<a href="#l4.1063"></a><span id="l4.1063" class="difflineminus">-        // for the one-close-button case</span>
<a href="#l4.1064"></a><span id="l4.1064" class="difflineminus">-        event.stopPropagation();</span>
<a href="#l4.1065"></a><span id="l4.1065" class="difflineminus">-      ]]&gt;&lt;/handler&gt;</span>
<a href="#l4.1066"></a><span id="l4.1066" class="difflineminus">-    &lt;/handlers&gt;</span>
<a href="#l4.1067"></a><span id="l4.1067" class="difflineminus">-  &lt;/binding&gt;</span>
<a href="#l4.1068"></a><span id="l4.1068" class="difflineminus">-</span>
<a href="#l4.1069"></a><span id="l4.1069">   &lt;binding id=&quot;tabmail-alltabs-popup&quot;</span>
<a href="#l4.1070"></a><span id="l4.1070">            extends=&quot;chrome://global/content/bindings/popup.xml#popup&quot;&gt;</span>
<a href="#l4.1071"></a><span id="l4.1071">     &lt;implementation&gt;</span>
<a href="#l4.1072"></a><span id="l4.1072">       &lt;field name=&quot;_xulWindow&quot;&gt;</span>
<a href="#l4.1073"></a><span id="l4.1073">         null</span>
<a href="#l4.1074"></a><span id="l4.1074">       &lt;/field&gt;</span>
<a href="#l4.1075"></a><span id="l4.1075">       &lt;field name=&quot;_mutationObserver&quot;&gt;</span>
<a href="#l4.1076"></a><span id="l4.1076">         null</span>
<a href="#l4.1077"></a><span id="l4.1077" class="difflineat">@@ -2778,17 +1945,17 @@</span>
<a href="#l4.1078"></a><span id="l4.1078">     &lt;/implementation&gt;</span>
<a href="#l4.1079"></a><span id="l4.1079"> </span>
<a href="#l4.1080"></a><span id="l4.1080">     &lt;handlers&gt;</span>
<a href="#l4.1081"></a><span id="l4.1081">       &lt;handler event=&quot;popupshowing&quot;&gt;</span>
<a href="#l4.1082"></a><span id="l4.1082">       &lt;![CDATA[</span>
<a href="#l4.1083"></a><span id="l4.1083">         // set up the menu popup</span>
<a href="#l4.1084"></a><span id="l4.1084">         let tabmail = document.getElementById(&quot;tabmail&quot;);</span>
<a href="#l4.1085"></a><span id="l4.1085">         var tabcontainer = tabmail.tabContainer;</span>
<a href="#l4.1086"></a><span id="l4.1086" class="difflineminus">-        var tabs = tabcontainer.childNodes;</span>
<a href="#l4.1087"></a><span id="l4.1087" class="difflineplus">+        var tabs = tabcontainer.allTabs;</span>
<a href="#l4.1088"></a><span id="l4.1088"> </span>
<a href="#l4.1089"></a><span id="l4.1089">         // Listen for changes in the tab bar.</span>
<a href="#l4.1090"></a><span id="l4.1090">         this._mutationObserver.observe(tabcontainer, {</span>
<a href="#l4.1091"></a><span id="l4.1091">           attributes: true,</span>
<a href="#l4.1092"></a><span id="l4.1092">           subtree: true,</span>
<a href="#l4.1093"></a><span id="l4.1093">           attributeFilter: [&quot;label&quot;, &quot;crop&quot;, &quot;busy&quot;, &quot;image&quot;, &quot;selected&quot;],</span>
<a href="#l4.1094"></a><span id="l4.1094">         });</span>
<a href="#l4.1095"></a><span id="l4.1095"> </span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l5.1"></a><span id="l5.1" class="difflineminus">--- a/mail/base/jar.mn</span>
<a href="#l5.2"></a><span id="l5.2" class="difflineplus">+++ b/mail/base/jar.mn</span>
<a href="#l5.3"></a><span id="l5.3" class="difflineat">@@ -68,16 +68,17 @@ messenger.jar:</span>
<a href="#l5.4"></a><span id="l5.4">     content/messenger/phishingDetector.js           (content/phishingDetector.js)</span>
<a href="#l5.5"></a><span id="l5.5">     content/messenger/mail-offline.js               (content/mail-offline.js)</span>
<a href="#l5.6"></a><span id="l5.6">     content/messenger/aboutDialog.css               (content/aboutDialog.css)</span>
<a href="#l5.7"></a><span id="l5.7">     content/messenger/converterDialog.css           (content/converterDialog.css)</span>
<a href="#l5.8"></a><span id="l5.8">     content/messenger/notification.css              (content/notification.css)</span>
<a href="#l5.9"></a><span id="l5.9"> *   content/messenger/messenger.css                 (content/messenger.css)</span>
<a href="#l5.10"></a><span id="l5.10">     content/messenger/search.xml                    (content/search.xml)</span>
<a href="#l5.11"></a><span id="l5.11">     content/messenger/tabmail.xml                   (content/tabmail.xml)</span>
<a href="#l5.12"></a><span id="l5.12" class="difflineplus">+    content/messenger/tabmail-tabs.js               (content/tabmail-tabs.js)</span>
<a href="#l5.13"></a><span id="l5.13">     content/messenger/tabbrowser-tab.js             (content/tabbrowser-tab.js)</span>
<a href="#l5.14"></a><span id="l5.14">     content/messenger/tabmail.css                   (content/tabmail.css)</span>
<a href="#l5.15"></a><span id="l5.15">     content/messenger/statuspanel.js                (content/statuspanel.js)</span>
<a href="#l5.16"></a><span id="l5.16">     content/messenger/newTagDialog.xul              (content/newTagDialog.xul)</span>
<a href="#l5.17"></a><span id="l5.17">     content/messenger/newTagDialog.js               (content/newTagDialog.js)</span>
<a href="#l5.18"></a><span id="l5.18">     content/messenger/composerOverlay.css           (content/composerOverlay.css)</span>
<a href="#l5.19"></a><span id="l5.19">     content/messenger/threadPane.js                 (content/threadPane.js)</span>
<a href="#l5.20"></a><span id="l5.20">     content/messenger/protovis-r2.6-modded.js       (content/protovis-r2.6-modded.js)</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l6.1"></a><span id="l6.1" class="difflineminus">--- a/mail/components/extensions/test/browser/browser_ext_menus.js</span>
<a href="#l6.2"></a><span id="l6.2" class="difflineplus">+++ b/mail/components/extensions/test/browser/browser_ext_menus.js</span>
<a href="#l6.3"></a><span id="l6.3" class="difflineat">@@ -135,17 +135,17 @@ add_task(async function test_tab() {</span>
<a href="#l6.4"></a><span id="l6.4">   let extension = createExtension();</span>
<a href="#l6.5"></a><span id="l6.5">   await extension.startup();</span>
<a href="#l6.6"></a><span id="l6.6"> </span>
<a href="#l6.7"></a><span id="l6.7">   let tabmail = document.getElementById(&quot;tabmail&quot;);</span>
<a href="#l6.8"></a><span id="l6.8">   window.openContentTab(&quot;about:config&quot;);</span>
<a href="#l6.9"></a><span id="l6.9">   window.openContentTab(&quot;about:mozilla&quot;);</span>
<a href="#l6.10"></a><span id="l6.10">   tabmail.openTab(&quot;folder&quot;, { folder: gFolders[0] });</span>
<a href="#l6.11"></a><span id="l6.11"> </span>
<a href="#l6.12"></a><span id="l6.12" class="difflineminus">-  let tabs = tabmail.tabbox.tabs.children;</span>
<a href="#l6.13"></a><span id="l6.13" class="difflineplus">+  let tabs = document.getElementById(&quot;tabmail-tabs&quot;).allTabs;</span>
<a href="#l6.14"></a><span id="l6.14">   let menu = document.getElementById(&quot;tabContextMenu&quot;);</span>
<a href="#l6.15"></a><span id="l6.15"> </span>
<a href="#l6.16"></a><span id="l6.16">   await checkTabEvent(0, false, true);</span>
<a href="#l6.17"></a><span id="l6.17">   await checkTabEvent(1, false, false);</span>
<a href="#l6.18"></a><span id="l6.18">   await checkTabEvent(2, false, false);</span>
<a href="#l6.19"></a><span id="l6.19">   await checkTabEvent(3, true, true);</span>
<a href="#l6.20"></a><span id="l6.20"> </span>
<a href="#l6.21"></a><span id="l6.21">   await extension.unload();</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l7.1"></a><span id="l7.1" class="difflineminus">--- a/mail/test/mozmill/content-policy/test-compose-mailto.js</span>
<a href="#l7.2"></a><span id="l7.2" class="difflineplus">+++ b/mail/test/mozmill/content-policy/test-compose-mailto.js</span>
<a href="#l7.3"></a><span id="l7.3" class="difflineat">@@ -44,17 +44,17 @@ function setupModule(module) {</span>
<a href="#l7.4"></a><span id="l7.4">   let cth = collector.getModule(&quot;content-tab-helpers&quot;);</span>
<a href="#l7.5"></a><span id="l7.5">   cth.installInto(module);</span>
<a href="#l7.6"></a><span id="l7.6"> }</span>
<a href="#l7.7"></a><span id="l7.7"> </span>
<a href="#l7.8"></a><span id="l7.8"> function test_openComposeFromMailToLink() {</span>
<a href="#l7.9"></a><span id="l7.9">   // Open a content tab with the mailto link in it.</span>
<a href="#l7.10"></a><span id="l7.10">     // To open a tab we're going to have to cheat and use tabmail so we can load</span>
<a href="#l7.11"></a><span id="l7.11">   // in the data of what we want.</span>
<a href="#l7.12"></a><span id="l7.12" class="difflineminus">-  gPreCount = mc.tabmail.tabContainer.childNodes.length;</span>
<a href="#l7.13"></a><span id="l7.13" class="difflineplus">+  gPreCount = mc.tabmail.tabContainer.allTabs.length;</span>
<a href="#l7.14"></a><span id="l7.14">   gNewTab = open_content_tab_with_url(url + &quot;mailtolink.html&quot;);</span>
<a href="#l7.15"></a><span id="l7.15">   gComposeWin = composeHelper.open_compose_with_element_click(&quot;mailtolink&quot;);</span>
<a href="#l7.16"></a><span id="l7.16"> }</span>
<a href="#l7.17"></a><span id="l7.17"> </span>
<a href="#l7.18"></a><span id="l7.18"> function test_checkInsertImage() {</span>
<a href="#l7.19"></a><span id="l7.19">   // First focus on the editor element</span>
<a href="#l7.20"></a><span id="l7.20">   gComposeWin.e(&quot;content-frame&quot;).focus();</span>
<a href="#l7.21"></a><span id="l7.21"> </span>
<a href="#l7.22"></a><span id="l7.22" class="difflineat">@@ -93,12 +93,12 @@ function test_checkInsertImage() {</span>
<a href="#l7.23"></a><span id="l7.23">     throw new Error(&quot;Loading of image has been unexpectedly blocked in a mailto compose window&quot;);</span>
<a href="#l7.24"></a><span id="l7.24"> }</span>
<a href="#l7.25"></a><span id="l7.25"> </span>
<a href="#l7.26"></a><span id="l7.26"> function test_closeComposeWindowAndTab() {</span>
<a href="#l7.27"></a><span id="l7.27">   composeHelper.close_compose_window(gComposeWin);</span>
<a href="#l7.28"></a><span id="l7.28"> </span>
<a href="#l7.29"></a><span id="l7.29">   mc.tabmail.closeTab(gNewTab);</span>
<a href="#l7.30"></a><span id="l7.30"> </span>
<a href="#l7.31"></a><span id="l7.31" class="difflineminus">-  if (mc.tabmail.tabContainer.childNodes.length != gPreCount)</span>
<a href="#l7.32"></a><span id="l7.32" class="difflineplus">+  if (mc.tabmail.tabContainer.allTabs.length != gPreCount)</span>
<a href="#l7.33"></a><span id="l7.33">     throw new Error(&quot;The content tab didn't close&quot;);</span>
<a href="#l7.34"></a><span id="l7.34"> }</span>
<a href="#l7.35"></a><span id="l7.35"> </span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l8.1"></a><span id="l8.1" class="difflineminus">--- a/mail/test/mozmill/content-policy/test-dns-prefetch.js</span>
<a href="#l8.2"></a><span id="l8.2" class="difflineplus">+++ b/mail/test/mozmill/content-policy/test-dns-prefetch.js</span>
<a href="#l8.3"></a><span id="l8.3" class="difflineat">@@ -154,23 +154,23 @@ function test_dnsPrefetch_compose() {</span>
<a href="#l8.4"></a><span id="l8.4">   checkComposeWindow(0);</span>
<a href="#l8.5"></a><span id="l8.5">   checkComposeWindow(1);</span>
<a href="#l8.6"></a><span id="l8.6">   checkComposeWindow(2);</span>
<a href="#l8.7"></a><span id="l8.7"> }</span>
<a href="#l8.8"></a><span id="l8.8"> </span>
<a href="#l8.9"></a><span id="l8.9"> function test_dnsPrefetch_contentTab() {</span>
<a href="#l8.10"></a><span id="l8.10">   // To open a tab we're going to have to cheat and use tabmail so we can load</span>
<a href="#l8.11"></a><span id="l8.11">   // in the data of what we want.</span>
<a href="#l8.12"></a><span id="l8.12" class="difflineminus">-  let preCount = mc.tabmail.tabContainer.childNodes.length;</span>
<a href="#l8.13"></a><span id="l8.13" class="difflineplus">+  let preCount = mc.tabmail.tabContainer.allTabs.length;</span>
<a href="#l8.14"></a><span id="l8.14"> </span>
<a href="#l8.15"></a><span id="l8.15">   let dataurl = &quot;data:text/html,&lt;html&gt;&lt;head&gt;&lt;title&gt;test dns prefetch&lt;/title&gt;&quot; +</span>
<a href="#l8.16"></a><span id="l8.16">     &quot;&lt;/head&gt;&lt;body&gt;test dns prefetch&lt;/body&gt;&lt;/html&gt;&quot;;</span>
<a href="#l8.17"></a><span id="l8.17"> </span>
<a href="#l8.18"></a><span id="l8.18">   let newTab = open_content_tab_with_url(dataurl);</span>
<a href="#l8.19"></a><span id="l8.19"> </span>
<a href="#l8.20"></a><span id="l8.20">   if (!mc.tabmail.getBrowserForSelectedTab().docShell.allowDNSPrefetch)</span>
<a href="#l8.21"></a><span id="l8.21">     throw new Error(&quot;DNS prefetch unexpectedly disabled in content tabs&quot;);</span>
<a href="#l8.22"></a><span id="l8.22"> </span>
<a href="#l8.23"></a><span id="l8.23">   mc.tabmail.closeTab(newTab);</span>
<a href="#l8.24"></a><span id="l8.24"> </span>
<a href="#l8.25"></a><span id="l8.25" class="difflineminus">-  if (mc.tabmail.tabContainer.childNodes.length != preCount)</span>
<a href="#l8.26"></a><span id="l8.26" class="difflineplus">+  if (mc.tabmail.tabContainer.allTabs.length != preCount)</span>
<a href="#l8.27"></a><span id="l8.27">     throw new Error(&quot;The content tab didn't close&quot;);</span>
<a href="#l8.28"></a><span id="l8.28"> }</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l9.1"></a><span id="l9.1" class="difflineminus">--- a/mail/test/mozmill/content-policy/test-exposed-in-content-tabs.js</span>
<a href="#l9.2"></a><span id="l9.2" class="difflineplus">+++ b/mail/test/mozmill/content-policy/test-exposed-in-content-tabs.js</span>
<a href="#l9.3"></a><span id="l9.3" class="difflineat">@@ -102,30 +102,30 @@ function addMsgToFolder(folder) {</span>
<a href="#l9.4"></a><span id="l9.4">   // This is the full url to the message that we want (i.e. passing this to</span>
<a href="#l9.5"></a><span id="l9.5">   // a browser element or iframe will display it).</span>
<a href="#l9.6"></a><span id="l9.6">   return neckoURL.value.spec;</span>
<a href="#l9.7"></a><span id="l9.7"> }</span>
<a href="#l9.8"></a><span id="l9.8"> </span>
<a href="#l9.9"></a><span id="l9.9"> function checkContentTab(msgURL) {</span>
<a href="#l9.10"></a><span id="l9.10">   // To open a tab we're going to have to cheat and use tabmail so we can load</span>
<a href="#l9.11"></a><span id="l9.11">   // in the data of what we want.</span>
<a href="#l9.12"></a><span id="l9.12" class="difflineminus">-  let preCount = mc.tabmail.tabContainer.childNodes.length;</span>
<a href="#l9.13"></a><span id="l9.13" class="difflineplus">+  let preCount = mc.tabmail.tabContainer.allTabs.length;</span>
<a href="#l9.14"></a><span id="l9.14"> </span>
<a href="#l9.15"></a><span id="l9.15">   let dataurl = &quot;data:text/html,&lt;html&gt;&lt;head&gt;&lt;title&gt;test exposed&lt;/title&gt;&quot; +</span>
<a href="#l9.16"></a><span id="l9.16">     '&lt;/head&gt;&lt;body&gt;&lt;iframe id=&quot;msgIframe&quot; src=&quot;' + msgURL + '&quot;/&gt;&lt;/body&gt;&lt;/html&gt;';</span>
<a href="#l9.17"></a><span id="l9.17"> </span>
<a href="#l9.18"></a><span id="l9.18">   let newTab = open_content_tab_with_url(dataurl);</span>
<a href="#l9.19"></a><span id="l9.19"> </span>
<a href="#l9.20"></a><span id="l9.20">   if (mc.window.content.document.getElementById(&quot;msgIframe&quot;)</span>
<a href="#l9.21"></a><span id="l9.21">         .contentDocument.URL != &quot;about:blank&quot;)</span>
<a href="#l9.22"></a><span id="l9.22">     throw new Error(&quot;Message display/access has not been blocked from remote content!&quot;);</span>
<a href="#l9.23"></a><span id="l9.23"> </span>
<a href="#l9.24"></a><span id="l9.24">   mc.tabmail.closeTab(newTab);</span>
<a href="#l9.25"></a><span id="l9.25"> </span>
<a href="#l9.26"></a><span id="l9.26" class="difflineminus">-  if (mc.tabmail.tabContainer.childNodes.length != preCount)</span>
<a href="#l9.27"></a><span id="l9.27" class="difflineplus">+  if (mc.tabmail.tabContainer.allTabs.length != preCount)</span>
<a href="#l9.28"></a><span id="l9.28">     throw new Error(&quot;The content tab didn't close&quot;);</span>
<a href="#l9.29"></a><span id="l9.29"> }</span>
<a href="#l9.30"></a><span id="l9.30"> </span>
<a href="#l9.31"></a><span id="l9.31"> function test_exposedInContentTabs() {</span>
<a href="#l9.32"></a><span id="l9.32">   be_in_folder(folder);</span>
<a href="#l9.33"></a><span id="l9.33"> </span>
<a href="#l9.34"></a><span id="l9.34">   assert_nothing_selected();</span>
<a href="#l9.35"></a><span id="l9.35"> </span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l10.1"></a><span id="l10.1" class="difflineminus">--- a/mail/test/mozmill/content-policy/test-general-content-policy.js</span>
<a href="#l10.2"></a><span id="l10.2" class="difflineplus">+++ b/mail/test/mozmill/content-policy/test-general-content-policy.js</span>
<a href="#l10.3"></a><span id="l10.3" class="difflineat">@@ -260,27 +260,27 @@ function allowRemoteContentAndCheck(test</span>
<a href="#l10.4"></a><span id="l10.4">   if (!test.checkForAllowed(mc.window.content.document</span>
<a href="#l10.5"></a><span id="l10.5">                               .getElementById(&quot;testelement&quot;)))</span>
<a href="#l10.6"></a><span id="l10.6">     throw new Error(test.type + &quot; has been unexpectedly blocked in message content&quot;);</span>
<a href="#l10.7"></a><span id="l10.7"> }</span>
<a href="#l10.8"></a><span id="l10.8"> </span>
<a href="#l10.9"></a><span id="l10.9"> function checkContentTab(test) {</span>
<a href="#l10.10"></a><span id="l10.10">   // To open a tab we're going to have to cheat and use tabmail so we can load</span>
<a href="#l10.11"></a><span id="l10.11">   // in the data of what we want.</span>
<a href="#l10.12"></a><span id="l10.12" class="difflineminus">-  let preCount = mc.tabmail.tabContainer.childNodes.length;</span>
<a href="#l10.13"></a><span id="l10.13" class="difflineplus">+  let preCount = mc.tabmail.tabContainer.allTabs.length;</span>
<a href="#l10.14"></a><span id="l10.14"> </span>
<a href="#l10.15"></a><span id="l10.15">   let newTab = open_content_tab_with_url(url + test.webPage);</span>
<a href="#l10.16"></a><span id="l10.16"> </span>
<a href="#l10.17"></a><span id="l10.17">   if (!test.checkForAllowed(mc.window.content.document</span>
<a href="#l10.18"></a><span id="l10.18">                               .getElementById(&quot;testelement&quot;)))</span>
<a href="#l10.19"></a><span id="l10.19">     throw new Error(test.type + &quot; has been unexpectedly blocked in content tab&quot;);</span>
<a href="#l10.20"></a><span id="l10.20"> </span>
<a href="#l10.21"></a><span id="l10.21">   mc.tabmail.closeTab(newTab);</span>
<a href="#l10.22"></a><span id="l10.22"> </span>
<a href="#l10.23"></a><span id="l10.23" class="difflineminus">-  if (mc.tabmail.tabContainer.childNodes.length != preCount)</span>
<a href="#l10.24"></a><span id="l10.24" class="difflineplus">+  if (mc.tabmail.tabContainer.allTabs.length != preCount)</span>
<a href="#l10.25"></a><span id="l10.25">     throw new Error(&quot;The content tab didn't close&quot;);</span>
<a href="#l10.26"></a><span id="l10.26"> }</span>
<a href="#l10.27"></a><span id="l10.27"> </span>
<a href="#l10.28"></a><span id="l10.28"> /**</span>
<a href="#l10.29"></a><span id="l10.29">  * Check remote content is not blocked in feed message (flagged with</span>
<a href="#l10.30"></a><span id="l10.30">  * nsMsgMessageFlags::FeedMsg)</span>
<a href="#l10.31"></a><span id="l10.31">  */</span>
<a href="#l10.32"></a><span id="l10.32"> function checkAllowFeedMsg(test) {</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l11.1"></a><span id="l11.1" class="difflineminus">--- a/mail/test/mozmill/content-policy/test-plugins-policy.js</span>
<a href="#l11.2"></a><span id="l11.2" class="difflineplus">+++ b/mail/test/mozmill/content-policy/test-plugins-policy.js</span>
<a href="#l11.3"></a><span id="l11.3" class="difflineat">@@ -182,20 +182,20 @@ function test_3paneWindowDeniedAgain() {</span>
<a href="#l11.4"></a><span id="l11.4"> </span>
<a href="#l11.5"></a><span id="l11.5"> function test_checkStandaloneMessageWindowDenied() {</span>
<a href="#l11.6"></a><span id="l11.6">   checkStandaloneMessageWindow(false);</span>
<a href="#l11.7"></a><span id="l11.7"> }</span>
<a href="#l11.8"></a><span id="l11.8"> </span>
<a href="#l11.9"></a><span id="l11.9"> function test_checkContentTab() {</span>
<a href="#l11.10"></a><span id="l11.10">   // To open a tab we're going to have to cheat and use tabmail so we can load</span>
<a href="#l11.11"></a><span id="l11.11">   // in the data of what we want.</span>
<a href="#l11.12"></a><span id="l11.12" class="difflineminus">-  let preCount = mc.tabmail.tabContainer.childNodes.length;</span>
<a href="#l11.13"></a><span id="l11.13" class="difflineplus">+  let preCount = mc.tabmail.tabContainer.allTabs.length;</span>
<a href="#l11.14"></a><span id="l11.14"> </span>
<a href="#l11.15"></a><span id="l11.15">   let newTab = open_content_tab_with_url(url + &quot;plugin.html&quot;);</span>
<a href="#l11.16"></a><span id="l11.16"> </span>
<a href="#l11.17"></a><span id="l11.17">   if (isPluginLoaded(mc.tabmail.getBrowserForSelectedTab().contentDocument))</span>
<a href="#l11.18"></a><span id="l11.18">     throw new Error(&quot;Plugin has been unexpectedly not blocked in content tab&quot;);</span>
<a href="#l11.19"></a><span id="l11.19"> </span>
<a href="#l11.20"></a><span id="l11.20">   mc.tabmail.closeTab(newTab);</span>
<a href="#l11.21"></a><span id="l11.21"> </span>
<a href="#l11.22"></a><span id="l11.22" class="difflineminus">-  if (mc.tabmail.tabContainer.childNodes.length != preCount)</span>
<a href="#l11.23"></a><span id="l11.23" class="difflineplus">+  if (mc.tabmail.tabContainer.allTabs.length != preCount)</span>
<a href="#l11.24"></a><span id="l11.24">     throw new Error(&quot;The content tab didn't close&quot;);</span>
<a href="#l11.25"></a><span id="l11.25"> }</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l12.1"></a><span id="l12.1" class="difflineminus">--- a/mail/test/mozmill/content-tabs/test-content-tab.js</span>
<a href="#l12.2"></a><span id="l12.2" class="difflineplus">+++ b/mail/test/mozmill/content-tabs/test-content-tab.js</span>
<a href="#l12.3"></a><span id="l12.3" class="difflineat">@@ -120,23 +120,23 @@ function test_content_tab_context_menu()</span>
<a href="#l12.4"></a><span id="l12.4">   assert_not_equals(mailContext.firstChild.label, &quot;Click me!&quot;);</span>
<a href="#l12.5"></a><span id="l12.5">   assert_element_not_visible(&quot;page-menu-separator&quot;);</span>
<a href="#l12.6"></a><span id="l12.6">   close_popup(mc, new elementslib.Elem(mailContext));</span>
<a href="#l12.7"></a><span id="l12.7"> }</span>
<a href="#l12.8"></a><span id="l12.8"> </span>
<a href="#l12.9"></a><span id="l12.9"> /*</span>
<a href="#l12.10"></a><span id="l12.10">  // We don't have an UI to test openin content tabs twice anymore.</span>
<a href="#l12.11"></a><span id="l12.11"> function test_content_tab_open_same() {</span>
<a href="#l12.12"></a><span id="l12.12" class="difflineminus">-  let preCount = mc.tabmail.tabContainer.childNodes.length;</span>
<a href="#l12.13"></a><span id="l12.13" class="difflineplus">+  let preCount = mc.tabmail.tabContainer.allTabs.length;</span>
<a href="#l12.14"></a><span id="l12.14"> </span>
<a href="#l12.15"></a><span id="l12.15">   mc.click(new elementslib.Elem(mc.menus.helpMenu.whatsNew));</span>
<a href="#l12.16"></a><span id="l12.16"> </span>
<a href="#l12.17"></a><span id="l12.17">   controller.sleep(0);</span>
<a href="#l12.18"></a><span id="l12.18"> </span>
<a href="#l12.19"></a><span id="l12.19" class="difflineminus">-  if (mc.tabmail.tabContainer.childNodes.length != preCount)</span>
<a href="#l12.20"></a><span id="l12.20" class="difflineplus">+  if (mc.tabmail.tabContainer.allTabs.length != preCount)</span>
<a href="#l12.21"></a><span id="l12.21">     throw new Error(&quot;A new content tab was opened when it shouldn't have been&quot;);</span>
<a href="#l12.22"></a><span id="l12.22"> </span>
<a href="#l12.23"></a><span id="l12.23">   // Double-check browser is still the same.</span>
<a href="#l12.24"></a><span id="l12.24">   if (mc.window.content.location != whatsUrl)</span>
<a href="#l12.25"></a><span id="l12.25">     throw new Error(&quot;window.content is not set to the url loaded, incorrect type=\&quot;...\&quot;?&quot;);</span>
<a href="#l12.26"></a><span id="l12.26"> }</span>
<a href="#l12.27"></a><span id="l12.27"> */</span>
<a href="#l12.28"></a><span id="l12.28"> </span>
<a href="#l12.29"></a><span id="l12.29" class="difflineat">@@ -146,17 +146,17 @@ function test_content_tab_default_favico</span>
<a href="#l12.30"></a><span id="l12.30"> </span>
<a href="#l12.31"></a><span id="l12.31">   assert_tab_has_title(tab, &quot;What's New Content Test 1&quot;);</span>
<a href="#l12.32"></a><span id="l12.32">   // Check the location of the favicon, this should be the site favicon in this</span>
<a href="#l12.33"></a><span id="l12.33">   // test.</span>
<a href="#l12.34"></a><span id="l12.34">   assert_content_tab_has_favicon(tab, url + &quot;favicon.ico&quot;);</span>
<a href="#l12.35"></a><span id="l12.35"> }</span>
<a href="#l12.36"></a><span id="l12.36"> </span>
<a href="#l12.37"></a><span id="l12.37"> function test_content_tab_onbeforeunload() {</span>
<a href="#l12.38"></a><span id="l12.38" class="difflineminus">-  let count = mc.tabmail.tabContainer.childNodes.length;</span>
<a href="#l12.39"></a><span id="l12.39" class="difflineplus">+  let count = mc.tabmail.tabContainer.allTabs.length;</span>
<a href="#l12.40"></a><span id="l12.40">   let tab = mc.tabmail.tabInfo[count - 1];</span>
<a href="#l12.41"></a><span id="l12.41">   tab.browser.contentWindow.addEventListener(&quot;beforeunload&quot;, function(event) {</span>
<a href="#l12.42"></a><span id="l12.42">     event.returnValue = &quot;Green llama in your car&quot;;</span>
<a href="#l12.43"></a><span id="l12.43">   });</span>
<a href="#l12.44"></a><span id="l12.44"> </span>
<a href="#l12.45"></a><span id="l12.45">   const interactionPref = &quot;dom.require_user_interaction_for_beforeunload&quot;;</span>
<a href="#l12.46"></a><span id="l12.46">   Services.prefs.setBoolPref(interactionPref, false);</span>
<a href="#l12.47"></a><span id="l12.47"> </span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l13.1"></a><span id="l13.1" class="difflineminus">--- a/mail/test/mozmill/downloads/test-about-downloads.js</span>
<a href="#l13.2"></a><span id="l13.2" class="difflineplus">+++ b/mail/test/mozmill/downloads/test-about-downloads.js</span>
<a href="#l13.3"></a><span id="l13.3" class="difflineat">@@ -119,20 +119,20 @@ function setupModule(module) {</span>
<a href="#l13.4"></a><span id="l13.4">   downloadsTab = open_about_downloads();</span>
<a href="#l13.5"></a><span id="l13.5"> }</span>
<a href="#l13.6"></a><span id="l13.6"> </span>
<a href="#l13.7"></a><span id="l13.7"> function setupTest(test) {</span>
<a href="#l13.8"></a><span id="l13.8">   downloadsView.init();</span>
<a href="#l13.9"></a><span id="l13.9"> }</span>
<a href="#l13.10"></a><span id="l13.10"> </span>
<a href="#l13.11"></a><span id="l13.11"> function open_about_downloads() {</span>
<a href="#l13.12"></a><span id="l13.12" class="difflineminus">-  let preCount = mc.tabmail.tabContainer.childNodes.length;</span>
<a href="#l13.13"></a><span id="l13.13" class="difflineplus">+  let preCount = mc.tabmail.tabContainer.allTabs.length;</span>
<a href="#l13.14"></a><span id="l13.14">   let newTab = mc.tabmail.openTab(&quot;chromeTab&quot;, { chromePage: &quot;about:downloads&quot;,</span>
<a href="#l13.15"></a><span id="l13.15">                                                  clickHandler: &quot;specialTabs.aboutClickHandler(event);&quot; });</span>
<a href="#l13.16"></a><span id="l13.16" class="difflineminus">-  mc.waitFor(() =&gt; mc.tabmail.tabContainer.childNodes.length == preCount + 1,</span>
<a href="#l13.17"></a><span id="l13.17" class="difflineplus">+  mc.waitFor(() =&gt; mc.tabmail.tabContainer.allTabs.length == preCount + 1,</span>
<a href="#l13.18"></a><span id="l13.18">              &quot;Timeout waiting for about:downloads tab&quot;);</span>
<a href="#l13.19"></a><span id="l13.19"> </span>
<a href="#l13.20"></a><span id="l13.20">   wait_for_browser_load(newTab.browser, &quot;about:downloads&quot;);</span>
<a href="#l13.21"></a><span id="l13.21">   // We append new tabs at the end, so check the last one.</span>
<a href="#l13.22"></a><span id="l13.22">   let expectedNewTab = mc.tabmail.tabInfo[preCount];</span>
<a href="#l13.23"></a><span id="l13.23">   return expectedNewTab;</span>
<a href="#l13.24"></a><span id="l13.24"> }</span>
<a href="#l13.25"></a><span id="l13.25"> </span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l14.1"></a><span id="l14.1" class="difflineminus">--- a/mail/test/mozmill/folder-display/test-displaying-messages-in-folder-tabs.js</span>
<a href="#l14.2"></a><span id="l14.2" class="difflineplus">+++ b/mail/test/mozmill/folder-display/test-displaying-messages-in-folder-tabs.js</span>
<a href="#l14.3"></a><span id="l14.3" class="difflineat">@@ -141,31 +141,31 @@ function _verify_display_in_existing_tab</span>
<a href="#l14.4"></a><span id="l14.4">   assert_selected_and_displayed(aMsgHdr);</span>
<a href="#l14.5"></a><span id="l14.5"> }</span>
<a href="#l14.6"></a><span id="l14.6"> </span>
<a href="#l14.7"></a><span id="l14.7"> /**</span>
<a href="#l14.8"></a><span id="l14.8">  * Test displaying a message with the same folder already open.</span>
<a href="#l14.9"></a><span id="l14.9">  */</span>
<a href="#l14.10"></a><span id="l14.10"> function test_display_message_in_same_folder() {</span>
<a href="#l14.11"></a><span id="l14.11">   be_in_folder(folderA);</span>
<a href="#l14.12"></a><span id="l14.12" class="difflineminus">-  let preCount = mc.tabmail.tabContainer.childNodes.length;</span>
<a href="#l14.13"></a><span id="l14.13" class="difflineplus">+  let preCount = mc.tabmail.tabContainer.allTabs.length;</span>
<a href="#l14.14"></a><span id="l14.14"> </span>
<a href="#l14.15"></a><span id="l14.15">   let msgHdr = msgHdrsInFolderA[indexes.next().value];</span>
<a href="#l14.16"></a><span id="l14.16"> </span>
<a href="#l14.17"></a><span id="l14.17">   display_message_in_folder_tab(msgHdr);</span>
<a href="#l14.18"></a><span id="l14.18">   // Verify</span>
<a href="#l14.19"></a><span id="l14.19">   _verify_display_in_existing_tab(preCount, folderA, msgHdr);</span>
<a href="#l14.20"></a><span id="l14.20"> }</span>
<a href="#l14.21"></a><span id="l14.21"> </span>
<a href="#l14.22"></a><span id="l14.22"> /**</span>
<a href="#l14.23"></a><span id="l14.23">  * Test displaying a message with a different folder open.</span>
<a href="#l14.24"></a><span id="l14.24">  */</span>
<a href="#l14.25"></a><span id="l14.25"> function test_display_message_in_different_folder() {</span>
<a href="#l14.26"></a><span id="l14.26">   be_in_folder(folderB);</span>
<a href="#l14.27"></a><span id="l14.27" class="difflineminus">-  let preCount = mc.tabmail.tabContainer.childNodes.length;</span>
<a href="#l14.28"></a><span id="l14.28" class="difflineplus">+  let preCount = mc.tabmail.tabContainer.allTabs.length;</span>
<a href="#l14.29"></a><span id="l14.29"> </span>
<a href="#l14.30"></a><span id="l14.30">   let msgHdr = msgHdrsInFolderA[indexes.next().value];</span>
<a href="#l14.31"></a><span id="l14.31"> </span>
<a href="#l14.32"></a><span id="l14.32">   display_message_in_folder_tab(msgHdr);</span>
<a href="#l14.33"></a><span id="l14.33">   // Verify</span>
<a href="#l14.34"></a><span id="l14.34">   _verify_display_in_existing_tab(preCount, folderA, msgHdr);</span>
<a href="#l14.35"></a><span id="l14.35"> }</span>
<a href="#l14.36"></a><span id="l14.36"> </span>
<a href="#l14.37"></a><span id="l14.37" class="difflineat">@@ -174,17 +174,17 @@ function test_display_message_in_differe</span>
<a href="#l14.38"></a><span id="l14.38">  */</span>
<a href="#l14.39"></a><span id="l14.39"> function test_display_message_in_same_folder_with_message_tab_active() {</span>
<a href="#l14.40"></a><span id="l14.40">   be_in_folder(folderA);</span>
<a href="#l14.41"></a><span id="l14.41"> </span>
<a href="#l14.42"></a><span id="l14.42">   let indexToOpen = indexes.next().value;</span>
<a href="#l14.43"></a><span id="l14.43">   select_click_row(indexToOpen);</span>
<a href="#l14.44"></a><span id="l14.44">   let messageTab = open_selected_message_in_new_tab(false);</span>
<a href="#l14.45"></a><span id="l14.45"> </span>
<a href="#l14.46"></a><span id="l14.46" class="difflineminus">-  let preCount = mc.tabmail.tabContainer.childNodes.length;</span>
<a href="#l14.47"></a><span id="l14.47" class="difflineplus">+  let preCount = mc.tabmail.tabContainer.allTabs.length;</span>
<a href="#l14.48"></a><span id="l14.48">   let msgHdr = msgHdrsInFolderA[indexes.next().value];</span>
<a href="#l14.49"></a><span id="l14.49">   display_message_in_folder_tab(msgHdr);</span>
<a href="#l14.50"></a><span id="l14.50">   // Verify</span>
<a href="#l14.51"></a><span id="l14.51">   _verify_display_in_existing_tab(preCount, folderA, msgHdr);</span>
<a href="#l14.52"></a><span id="l14.52"> </span>
<a href="#l14.53"></a><span id="l14.53">   // Clean up, close the message tab</span>
<a href="#l14.54"></a><span id="l14.54">   close_tab(messageTab);</span>
<a href="#l14.55"></a><span id="l14.55"> }</span>
<a href="#l14.56"></a><span id="l14.56" class="difflineat">@@ -195,17 +195,17 @@ function test_display_message_in_same_fo</span>
<a href="#l14.57"></a><span id="l14.57">  */</span>
<a href="#l14.58"></a><span id="l14.58"> function test_display_message_in_different_folder_with_message_tab_active() {</span>
<a href="#l14.59"></a><span id="l14.59">   be_in_folder(folderA);</span>
<a href="#l14.60"></a><span id="l14.60"> </span>
<a href="#l14.61"></a><span id="l14.61">   let indexToOpen = indexes.next().value;</span>
<a href="#l14.62"></a><span id="l14.62">   select_click_row(indexToOpen);</span>
<a href="#l14.63"></a><span id="l14.63">   let messageTab = open_selected_message_in_new_tab(false);</span>
<a href="#l14.64"></a><span id="l14.64"> </span>
<a href="#l14.65"></a><span id="l14.65" class="difflineminus">-  let preCount = mc.tabmail.tabContainer.childNodes.length;</span>
<a href="#l14.66"></a><span id="l14.66" class="difflineplus">+  let preCount = mc.tabmail.tabContainer.allTabs.length;</span>
<a href="#l14.67"></a><span id="l14.67">   let msgHdr = msgHdrsInFolderB[indexes.next().value];</span>
<a href="#l14.68"></a><span id="l14.68">   display_message_in_folder_tab(msgHdr);</span>
<a href="#l14.69"></a><span id="l14.69">   // Verify</span>
<a href="#l14.70"></a><span id="l14.70">   _verify_display_in_existing_tab(preCount, folderB, msgHdr);</span>
<a href="#l14.71"></a><span id="l14.71"> </span>
<a href="#l14.72"></a><span id="l14.72">   // Clean up, close the message tab</span>
<a href="#l14.73"></a><span id="l14.73">   close_tab(messageTab);</span>
<a href="#l14.74"></a><span id="l14.74"> }</span>
<a href="#l14.75"></a><span id="l14.75" class="difflineat">@@ -214,17 +214,17 @@ function test_display_message_in_differe</span>
<a href="#l14.76"></a><span id="l14.76">  * Test displaying a message with the same folder open but filtered.</span>
<a href="#l14.77"></a><span id="l14.77">  */</span>
<a href="#l14.78"></a><span id="l14.78"> function test_display_message_in_same_folder_filtered() {</span>
<a href="#l14.79"></a><span id="l14.79">   be_in_folder(folderA);</span>
<a href="#l14.80"></a><span id="l14.80">   set_mail_view(MailViewConstants.kViewItemTags, &quot;$label1&quot;);</span>
<a href="#l14.81"></a><span id="l14.81">   // Make sure all the messages have actually disappeared</span>
<a href="#l14.82"></a><span id="l14.82">   assert_messages_not_in_view(msgHdrsInFolderA);</span>
<a href="#l14.83"></a><span id="l14.83"> </span>
<a href="#l14.84"></a><span id="l14.84" class="difflineminus">-  let preCount = mc.tabmail.tabContainer.childNodes.length;</span>
<a href="#l14.85"></a><span id="l14.85" class="difflineplus">+  let preCount = mc.tabmail.tabContainer.allTabs.length;</span>
<a href="#l14.86"></a><span id="l14.86">   let msgHdr = msgHdrsInFolderA[indexes.next().value];</span>
<a href="#l14.87"></a><span id="l14.87">   display_message_in_folder_tab(msgHdr);</span>
<a href="#l14.88"></a><span id="l14.88">   // Verify</span>
<a href="#l14.89"></a><span id="l14.89">   _verify_display_in_existing_tab(preCount, folderA, msgHdr);</span>
<a href="#l14.90"></a><span id="l14.90"> </span>
<a href="#l14.91"></a><span id="l14.91">   // Reset the mail view</span>
<a href="#l14.92"></a><span id="l14.92">   set_mail_view(MailViewConstants.kViewItemAll, null);</span>
<a href="#l14.93"></a><span id="l14.93"> }</span>
<a href="#l14.94"></a><span id="l14.94" class="difflineat">@@ -238,17 +238,17 @@ function test_display_message_in_differe</span>
<a href="#l14.95"></a><span id="l14.95">   // Make sure all the messages have actually disappeared</span>
<a href="#l14.96"></a><span id="l14.96">   assert_messages_not_in_view(msgHdrsInFolderB);</span>
<a href="#l14.97"></a><span id="l14.97"> </span>
<a href="#l14.98"></a><span id="l14.98">   // Do the same for folder A</span>
<a href="#l14.99"></a><span id="l14.99">   be_in_folder(folderA);</span>
<a href="#l14.100"></a><span id="l14.100">   set_mail_view(MailViewConstants.kViewItemTags, &quot;$label2&quot;);</span>
<a href="#l14.101"></a><span id="l14.101">   assert_messages_not_in_view(msgHdrsInFolderA);</span>
<a href="#l14.102"></a><span id="l14.102"> </span>
<a href="#l14.103"></a><span id="l14.103" class="difflineminus">-  let preCount = mc.tabmail.tabContainer.childNodes.length;</span>
<a href="#l14.104"></a><span id="l14.104" class="difflineplus">+  let preCount = mc.tabmail.tabContainer.allTabs.length;</span>
<a href="#l14.105"></a><span id="l14.105">   let msgHdr = msgHdrsInFolderB[indexes.next().value];</span>
<a href="#l14.106"></a><span id="l14.106">   display_message_in_folder_tab(msgHdr);</span>
<a href="#l14.107"></a><span id="l14.107">   // Verify</span>
<a href="#l14.108"></a><span id="l14.108">   _verify_display_in_existing_tab(preCount, folderB, msgHdr);</span>
<a href="#l14.109"></a><span id="l14.109">   // Reset folder B's state</span>
<a href="#l14.110"></a><span id="l14.110">   be_in_folder(folderB);</span>
<a href="#l14.111"></a><span id="l14.111">   set_mail_view(MailViewConstants.kViewItemAll, null);</span>
<a href="#l14.112"></a><span id="l14.112"> </span>
<a href="#l14.113"></a><span id="l14.113" class="difflineat">@@ -270,17 +270,17 @@ function test_display_message_in_same_fo</span>
<a href="#l14.114"></a><span id="l14.114">   let messageTab = open_selected_message_in_new_tab(false);</span>
<a href="#l14.115"></a><span id="l14.115"> </span>
<a href="#l14.116"></a><span id="l14.116">   switch_tab(folderTab);</span>
<a href="#l14.117"></a><span id="l14.117">   set_mail_view(MailViewConstants.kViewItemTags, &quot;$label1&quot;);</span>
<a href="#l14.118"></a><span id="l14.118">   // Make sure all the messages have actually disappeared</span>
<a href="#l14.119"></a><span id="l14.119">   assert_messages_not_in_view(msgHdrsInFolderB);</span>
<a href="#l14.120"></a><span id="l14.120">   switch_tab(messageTab);</span>
<a href="#l14.121"></a><span id="l14.121"> </span>
<a href="#l14.122"></a><span id="l14.122" class="difflineminus">-  let preCount = mc.tabmail.tabContainer.childNodes.length;</span>
<a href="#l14.123"></a><span id="l14.123" class="difflineplus">+  let preCount = mc.tabmail.tabContainer.allTabs.length;</span>
<a href="#l14.124"></a><span id="l14.124">   let msgHdr = msgHdrsInFolderB[indexes.next().value];</span>
<a href="#l14.125"></a><span id="l14.125">   display_message_in_folder_tab(msgHdr);</span>
<a href="#l14.126"></a><span id="l14.126">   // Verify</span>
<a href="#l14.127"></a><span id="l14.127">   _verify_display_in_existing_tab(preCount, folderB, msgHdr);</span>
<a href="#l14.128"></a><span id="l14.128"> </span>
<a href="#l14.129"></a><span id="l14.129">   // Clean up, close the message tab and reset the mail view</span>
<a href="#l14.130"></a><span id="l14.130">   close_tab(messageTab);</span>
<a href="#l14.131"></a><span id="l14.131">   set_mail_view(MailViewConstants.kViewItemAll, null);</span>
<a href="#l14.132"></a><span id="l14.132" class="difflineat">@@ -298,17 +298,17 @@ function</span>
<a href="#l14.133"></a><span id="l14.133">   assert_messages_not_in_view(msgHdrsInFolderA);</span>
<a href="#l14.134"></a><span id="l14.134"> </span>
<a href="#l14.135"></a><span id="l14.135">   be_in_folder(folderB);</span>
<a href="#l14.136"></a><span id="l14.136">   set_mail_view(MailViewConstants.kViewItemTags, &quot;$label3&quot;);</span>
<a href="#l14.137"></a><span id="l14.137">   // There should be one message in here</span>
<a href="#l14.138"></a><span id="l14.138">   select_click_row(0);</span>
<a href="#l14.139"></a><span id="l14.139">   let messageTab = open_selected_message_in_new_tab(false);</span>
<a href="#l14.140"></a><span id="l14.140"> </span>
<a href="#l14.141"></a><span id="l14.141" class="difflineminus">-  let preCount = mc.tabmail.tabContainer.childNodes.length;</span>
<a href="#l14.142"></a><span id="l14.142" class="difflineplus">+  let preCount = mc.tabmail.tabContainer.allTabs.length;</span>
<a href="#l14.143"></a><span id="l14.143">   let msgHdr = msgHdrsInFolderA[indexes.next().value];</span>
<a href="#l14.144"></a><span id="l14.144">   display_message_in_folder_tab(msgHdr);</span>
<a href="#l14.145"></a><span id="l14.145">   // Verify</span>
<a href="#l14.146"></a><span id="l14.146">   _verify_display_in_existing_tab(preCount, folderA, msgHdr);</span>
<a href="#l14.147"></a><span id="l14.147">   // Close the message tab</span>
<a href="#l14.148"></a><span id="l14.148">   close_tab(messageTab);</span>
<a href="#l14.149"></a><span id="l14.149">   // Reset folder A's state</span>
<a href="#l14.150"></a><span id="l14.150">   be_in_folder(folderA);</span>
<a href="#l14.151"></a><span id="l14.151" class="difflineat">@@ -325,17 +325,17 @@ function</span>
<a href="#l14.152"></a><span id="l14.152">  * Test displaying a message with the folder set to show unread messages only.</span>
<a href="#l14.153"></a><span id="l14.153">  */</span>
<a href="#l14.154"></a><span id="l14.154"> function test_display_message_in_same_folder_unread() {</span>
<a href="#l14.155"></a><span id="l14.155">   be_in_folder(folderB);</span>
<a href="#l14.156"></a><span id="l14.156">   set_show_unread_only(true);</span>
<a href="#l14.157"></a><span id="l14.157">   // Make sure all the messages have actually disappeared</span>
<a href="#l14.158"></a><span id="l14.158">   assert_messages_not_in_view(msgHdrsInFolderB);</span>
<a href="#l14.159"></a><span id="l14.159"> </span>
<a href="#l14.160"></a><span id="l14.160" class="difflineminus">-  let preCount = mc.tabmail.tabContainer.childNodes.length;</span>
<a href="#l14.161"></a><span id="l14.161" class="difflineplus">+  let preCount = mc.tabmail.tabContainer.allTabs.length;</span>
<a href="#l14.162"></a><span id="l14.162">   let msgHdr = msgHdrsInFolderB[indexes.next().value];</span>
<a href="#l14.163"></a><span id="l14.163">   display_message_in_folder_tab(msgHdr);</span>
<a href="#l14.164"></a><span id="l14.164">   // Verify</span>
<a href="#l14.165"></a><span id="l14.165">   _verify_display_in_existing_tab(preCount, folderB, msgHdr);</span>
<a href="#l14.166"></a><span id="l14.166">   // Reset the state</span>
<a href="#l14.167"></a><span id="l14.167">   be_in_folder(folderB);</span>
<a href="#l14.168"></a><span id="l14.168">   set_show_unread_only(false);</span>
<a href="#l14.169"></a><span id="l14.169"> }</span>
<a href="#l14.170"></a><span id="l14.170" class="difflineat">@@ -350,17 +350,17 @@ function test_display_message_in_differe</span>
<a href="#l14.171"></a><span id="l14.171">   // Make sure all the messages have actually disappeared</span>
<a href="#l14.172"></a><span id="l14.172">   assert_messages_not_in_view(msgHdrsInFolderA);</span>
<a href="#l14.173"></a><span id="l14.173"> </span>
<a href="#l14.174"></a><span id="l14.174">   // Do the same for folder B</span>
<a href="#l14.175"></a><span id="l14.175">   be_in_folder(folderB);</span>
<a href="#l14.176"></a><span id="l14.176">   set_show_unread_only(true);</span>
<a href="#l14.177"></a><span id="l14.177">   assert_messages_not_in_view(msgHdrsInFolderB);</span>
<a href="#l14.178"></a><span id="l14.178"> </span>
<a href="#l14.179"></a><span id="l14.179" class="difflineminus">-  let preCount = mc.tabmail.tabContainer.childNodes.length;</span>
<a href="#l14.180"></a><span id="l14.180" class="difflineplus">+  let preCount = mc.tabmail.tabContainer.allTabs.length;</span>
<a href="#l14.181"></a><span id="l14.181">   let msgHdr = msgHdrsInFolderA[indexes.next().value];</span>
<a href="#l14.182"></a><span id="l14.182">   display_message_in_folder_tab(msgHdr);</span>
<a href="#l14.183"></a><span id="l14.183">   // Verify</span>
<a href="#l14.184"></a><span id="l14.184">   _verify_display_in_existing_tab(preCount, folderA, msgHdr);</span>
<a href="#l14.185"></a><span id="l14.185">   // Reset folder A's state</span>
<a href="#l14.186"></a><span id="l14.186">   be_in_folder(folderA);</span>
<a href="#l14.187"></a><span id="l14.187">   set_show_unread_only(false);</span>
<a href="#l14.188"></a><span id="l14.188"> </span>
<a href="#l14.189"></a><span id="l14.189" class="difflineat">@@ -374,17 +374,17 @@ function test_display_message_in_differe</span>
<a href="#l14.190"></a><span id="l14.190"> /**</span>
<a href="#l14.191"></a><span id="l14.191">  * Test that we correctly scroll to the index of the message in a folder.</span>
<a href="#l14.192"></a><span id="l14.192">  */</span>
<a href="#l14.193"></a><span id="l14.193"> function test_display_message_scrolls_to_message() {</span>
<a href="#l14.194"></a><span id="l14.194">   be_in_folder(folderC);</span>
<a href="#l14.195"></a><span id="l14.195">   // Scroll to the top</span>
<a href="#l14.196"></a><span id="l14.196">   mc.folderDisplay.ensureRowIsVisible(0);</span>
<a href="#l14.197"></a><span id="l14.197"> </span>
<a href="#l14.198"></a><span id="l14.198" class="difflineminus">-  let preCount = mc.tabmail.tabContainer.childNodes.length;</span>
<a href="#l14.199"></a><span id="l14.199" class="difflineplus">+  let preCount = mc.tabmail.tabContainer.allTabs.length;</span>
<a href="#l14.200"></a><span id="l14.200">   let msgHdr = mc.dbView.getMsgHdrAt(45);</span>
<a href="#l14.201"></a><span id="l14.201">   display_message_in_folder_tab(msgHdr);</span>
<a href="#l14.202"></a><span id="l14.202"> </span>
<a href="#l14.203"></a><span id="l14.203">   // Check that row 45 is visible</span>
<a href="#l14.204"></a><span id="l14.204">   assert_row_visible(45);</span>
<a href="#l14.205"></a><span id="l14.205">   // Verify the rest</span>
<a href="#l14.206"></a><span id="l14.206">   _verify_display_in_existing_tab(preCount, folderC, msgHdr);</span>
<a href="#l14.207"></a><span id="l14.207"> }</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l15.1"></a><span id="l15.1" class="difflineminus">--- a/mail/test/mozmill/folder-display/test-opening-messages-without-a-backing-view.js</span>
<a href="#l15.2"></a><span id="l15.2" class="difflineplus">+++ b/mail/test/mozmill/folder-display/test-opening-messages-without-a-backing-view.js</span>
<a href="#l15.3"></a><span id="l15.3" class="difflineat">@@ -41,17 +41,17 @@ function setupModule(module) {</span>
<a href="#l15.4"></a><span id="l15.4"> }</span>
<a href="#l15.5"></a><span id="l15.5"> </span>
<a href="#l15.6"></a><span id="l15.6"> /**</span>
<a href="#l15.7"></a><span id="l15.7">  * Test opening a single message without a backing view in a new tab.</span>
<a href="#l15.8"></a><span id="l15.8">  */</span>
<a href="#l15.9"></a><span id="l15.9"> function test_open_single_message_without_backing_view_in_tab() {</span>
<a href="#l15.10"></a><span id="l15.10">   set_open_message_behavior(&quot;NEW_TAB&quot;);</span>
<a href="#l15.11"></a><span id="l15.11">   let folderTab = mc.tabmail.currentTabInfo;</span>
<a href="#l15.12"></a><span id="l15.12" class="difflineminus">-  let preCount = mc.tabmail.tabContainer.childNodes.length;</span>
<a href="#l15.13"></a><span id="l15.13" class="difflineplus">+  let preCount = mc.tabmail.tabContainer.allTabs.length;</span>
<a href="#l15.14"></a><span id="l15.14">   be_in_folder(folder);</span>
<a href="#l15.15"></a><span id="l15.15"> </span>
<a href="#l15.16"></a><span id="l15.16">   if (!msgHdrsInFolder) {</span>
<a href="#l15.17"></a><span id="l15.17">     msgHdrsInFolder = [];</span>
<a href="#l15.18"></a><span id="l15.18">     // Make a list of all the message headers in this folder</span>
<a href="#l15.19"></a><span id="l15.19">     for (let i = 0; i &lt; 10; i++)</span>
<a href="#l15.20"></a><span id="l15.20">       msgHdrsInFolder.push(mc.dbView.getMsgHdrAt(i));</span>
<a href="#l15.21"></a><span id="l15.21">   }</span>
<a href="#l15.22"></a><span id="l15.22" class="difflineat">@@ -79,17 +79,17 @@ function test_open_single_message_withou</span>
<a href="#l15.23"></a><span id="l15.23"> }</span>
<a href="#l15.24"></a><span id="l15.24"> </span>
<a href="#l15.25"></a><span id="l15.25"> /**</span>
<a href="#l15.26"></a><span id="l15.26">  * Test opening multiple messages without backing views in new tabs.</span>
<a href="#l15.27"></a><span id="l15.27">  */</span>
<a href="#l15.28"></a><span id="l15.28"> function test_open_multiple_messages_without_backing_views_in_tabs() {</span>
<a href="#l15.29"></a><span id="l15.29">   set_open_message_behavior(&quot;NEW_TAB&quot;);</span>
<a href="#l15.30"></a><span id="l15.30">   let folderTab = mc.tabmail.currentTabInfo;</span>
<a href="#l15.31"></a><span id="l15.31" class="difflineminus">-  let preCount = mc.tabmail.tabContainer.childNodes.length;</span>
<a href="#l15.32"></a><span id="l15.32" class="difflineplus">+  let preCount = mc.tabmail.tabContainer.allTabs.length;</span>
<a href="#l15.33"></a><span id="l15.33">   be_in_folder(folder);</span>
<a href="#l15.34"></a><span id="l15.34"> </span>
<a href="#l15.35"></a><span id="l15.35">   // Get a reference to a bunch of headers</span>
<a href="#l15.36"></a><span id="l15.36">   let msgHdrs = msgHdrsInFolder.slice(0, NUM_MESSAGES_TO_OPEN);</span>
<a href="#l15.37"></a><span id="l15.37"> </span>
<a href="#l15.38"></a><span id="l15.38">   // Open them</span>
<a href="#l15.39"></a><span id="l15.39">   MailUtils.displayMessages(msgHdrs);</span>
<a href="#l15.40"></a><span id="l15.40">   // This is going to trigger a message display in the main 3pane window. Since</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l16.1"></a><span id="l16.1" class="difflineminus">--- a/mail/test/mozmill/folder-display/test-opening-messages.js</span>
<a href="#l16.2"></a><span id="l16.2" class="difflineplus">+++ b/mail/test/mozmill/folder-display/test-opening-messages.js</span>
<a href="#l16.3"></a><span id="l16.3" class="difflineat">@@ -42,17 +42,17 @@ function setupModule(module) {</span>
<a href="#l16.4"></a><span id="l16.4"> }</span>
<a href="#l16.5"></a><span id="l16.5"> </span>
<a href="#l16.6"></a><span id="l16.6"> /**</span>
<a href="#l16.7"></a><span id="l16.7">  * Test opening a single message in a new tab.</span>
<a href="#l16.8"></a><span id="l16.8">  */</span>
<a href="#l16.9"></a><span id="l16.9"> function test_open_single_message_in_tab() {</span>
<a href="#l16.10"></a><span id="l16.10">   set_open_message_behavior(&quot;NEW_TAB&quot;);</span>
<a href="#l16.11"></a><span id="l16.11">   let folderTab = mc.tabmail.currentTabInfo;</span>
<a href="#l16.12"></a><span id="l16.12" class="difflineminus">-  let preCount = mc.tabmail.tabContainer.childNodes.length;</span>
<a href="#l16.13"></a><span id="l16.13" class="difflineplus">+  let preCount = mc.tabmail.tabContainer.allTabs.length;</span>
<a href="#l16.14"></a><span id="l16.14">   be_in_folder(folder);</span>
<a href="#l16.15"></a><span id="l16.15">   // Select one message</span>
<a href="#l16.16"></a><span id="l16.16">   let msgHdr = select_click_row(1);</span>
<a href="#l16.17"></a><span id="l16.17">   // Open it</span>
<a href="#l16.18"></a><span id="l16.18">   open_selected_message();</span>
<a href="#l16.19"></a><span id="l16.19">   // This is going to trigger a message display in the main 3pane window</span>
<a href="#l16.20"></a><span id="l16.20">   wait_for_message_display_completion(mc);</span>
<a href="#l16.21"></a><span id="l16.21">   // Check that the tab count has increased by 1</span>
<a href="#l16.22"></a><span id="l16.22" class="difflineat">@@ -73,17 +73,17 @@ function test_open_single_message_in_tab</span>
<a href="#l16.23"></a><span id="l16.23"> }</span>
<a href="#l16.24"></a><span id="l16.24"> </span>
<a href="#l16.25"></a><span id="l16.25"> /**</span>
<a href="#l16.26"></a><span id="l16.26">  * Test opening multiple messages in new tabs.</span>
<a href="#l16.27"></a><span id="l16.27">  */</span>
<a href="#l16.28"></a><span id="l16.28"> function test_open_multiple_messages_in_tabs() {</span>
<a href="#l16.29"></a><span id="l16.29">   set_open_message_behavior(&quot;NEW_TAB&quot;);</span>
<a href="#l16.30"></a><span id="l16.30">   let folderTab = mc.tabmail.currentTabInfo;</span>
<a href="#l16.31"></a><span id="l16.31" class="difflineminus">-  let preCount = mc.tabmail.tabContainer.childNodes.length;</span>
<a href="#l16.32"></a><span id="l16.32" class="difflineplus">+  let preCount = mc.tabmail.tabContainer.allTabs.length;</span>
<a href="#l16.33"></a><span id="l16.33">   be_in_folder(folder);</span>
<a href="#l16.34"></a><span id="l16.34"> </span>
<a href="#l16.35"></a><span id="l16.35">   // Select a bunch of messages</span>
<a href="#l16.36"></a><span id="l16.36">   select_click_row(1);</span>
<a href="#l16.37"></a><span id="l16.37">   let selectedMessages = select_shift_click_row(NUM_MESSAGES_TO_OPEN);</span>
<a href="#l16.38"></a><span id="l16.38">   // Open them</span>
<a href="#l16.39"></a><span id="l16.39">   open_selected_messages();</span>
<a href="#l16.40"></a><span id="l16.40">   // This is going to trigger a message display in the main 3pane window</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l17.1"></a><span id="l17.1" class="difflineminus">--- a/mail/test/mozmill/im/test-chat-tab-restore.js</span>
<a href="#l17.2"></a><span id="l17.2" class="difflineplus">+++ b/mail/test/mozmill/im/test-chat-tab-restore.js</span>
<a href="#l17.3"></a><span id="l17.3" class="difflineat">@@ -11,23 +11,23 @@ var RELATIVE_ROOT = &quot;../shared-modules&quot;;</span>
<a href="#l17.4"></a><span id="l17.4"> var MODULE_REQUIRES = [&quot;folder-display-helpers&quot;];</span>
<a href="#l17.5"></a><span id="l17.5"> </span>
<a href="#l17.6"></a><span id="l17.6"> /**</span>
<a href="#l17.7"></a><span id="l17.7">  * Create a new chat tab, making that tab the current tab. We block until the</span>
<a href="#l17.8"></a><span id="l17.8">  * message finishes loading. (Inspired by open_selected_message_in_new_tab)</span>
<a href="#l17.9"></a><span id="l17.9">  */</span>
<a href="#l17.10"></a><span id="l17.10"> function open_chat_tab() {</span>
<a href="#l17.11"></a><span id="l17.11">   // Get the current tab count so we can make sure the tab actually opened.</span>
<a href="#l17.12"></a><span id="l17.12" class="difflineminus">-  let preCount = mc.tabmail.tabContainer.childNodes.length;</span>
<a href="#l17.13"></a><span id="l17.13" class="difflineplus">+  let preCount = mc.tabmail.tabContainer.allTabs.length;</span>
<a href="#l17.14"></a><span id="l17.14"> </span>
<a href="#l17.15"></a><span id="l17.15">   mc.tabmail.openTab(&quot;chat&quot;, {});</span>
<a href="#l17.16"></a><span id="l17.16">   mark_action(&quot;imh&quot;, &quot;open_chat_tab&quot;, []);</span>
<a href="#l17.17"></a><span id="l17.17">   wait_for_chat_tab_to_open(mc);</span>
<a href="#l17.18"></a><span id="l17.18"> </span>
<a href="#l17.19"></a><span id="l17.19" class="difflineminus">-  if (mc.tabmail.tabContainer.childNodes.length != preCount + 1)</span>
<a href="#l17.20"></a><span id="l17.20" class="difflineplus">+  if (mc.tabmail.tabContainer.allTabs.length != preCount + 1)</span>
<a href="#l17.21"></a><span id="l17.21">     throw new Error(&quot;The tab never actually got opened!&quot;);</span>
<a href="#l17.22"></a><span id="l17.22"> </span>
<a href="#l17.23"></a><span id="l17.23">   let newTab = mc.tabmail.tabInfo[preCount];</span>
<a href="#l17.24"></a><span id="l17.24">   return newTab;</span>
<a href="#l17.25"></a><span id="l17.25"> }</span>
<a href="#l17.26"></a><span id="l17.26"> </span>
<a href="#l17.27"></a><span id="l17.27"> function wait_for_chat_tab_to_open(aController) {</span>
<a href="#l17.28"></a><span id="l17.28">   if (aController == null)</span>
<a href="#l17.29"></a><span id="l17.29" class="difflineat">@@ -67,16 +67,16 @@ function test_chat_tab_restore() {</span>
<a href="#l17.30"></a><span id="l17.30">       mc.tabmail.closeTab(1);</span>
<a href="#l17.31"></a><span id="l17.31">   };</span>
<a href="#l17.32"></a><span id="l17.32"> </span>
<a href="#l17.33"></a><span id="l17.33">   open_chat_tab();</span>
<a href="#l17.34"></a><span id="l17.34">   let state = mc.tabmail.persistTabs();</span>
<a href="#l17.35"></a><span id="l17.35">   closeTabs();</span>
<a href="#l17.36"></a><span id="l17.36">   mc.tabmail.restoreTabs(state);</span>
<a href="#l17.37"></a><span id="l17.37"> </span>
<a href="#l17.38"></a><span id="l17.38" class="difflineminus">-  if (mc.tabmail.tabContainer.childNodes.length &lt; 2)</span>
<a href="#l17.39"></a><span id="l17.39" class="difflineplus">+  if (mc.tabmail.tabContainer.allTabs.length &lt; 2)</span>
<a href="#l17.40"></a><span id="l17.40">     throw new Error(&quot;The tab is not restored!&quot;);</span>
<a href="#l17.41"></a><span id="l17.41"> </span>
<a href="#l17.42"></a><span id="l17.42">   let tabTypes = [&quot;folder&quot;, &quot;chat&quot;];</span>
<a href="#l17.43"></a><span id="l17.43">   for (let i in tabTypes) {</span>
<a href="#l17.44"></a><span id="l17.44">     assert_tab_mode_name(mc.tabmail.tabInfo[i], tabTypes[i]);</span>
<a href="#l17.45"></a><span id="l17.45">   }</span>
<a href="#l17.46"></a><span id="l17.46"> }</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l18.1"></a><span id="l18.1" class="difflineminus">--- a/mail/test/mozmill/newmailaccount/test-newmailaccount.js</span>
<a href="#l18.2"></a><span id="l18.2" class="difflineplus">+++ b/mail/test/mozmill/newmailaccount/test-newmailaccount.js</span>
<a href="#l18.3"></a><span id="l18.3" class="difflineat">@@ -992,34 +992,34 @@ function test_external_link_opening_beha</span>
<a href="#l18.4"></a><span id="l18.4">   mc.tabmail.closeTab(tab);</span>
<a href="#l18.5"></a><span id="l18.5"> }</span>
<a href="#l18.6"></a><span id="l18.6"> </span>
<a href="#l18.7"></a><span id="l18.7"> /**</span>
<a href="#l18.8"></a><span id="l18.8">  * Test that if the provider returns XML that we can't turn into an account,</span>
<a href="#l18.9"></a><span id="l18.9">  * then we error out and go back to the Account Provisioner dialog.</span>
<a href="#l18.10"></a><span id="l18.10">  */</span>
<a href="#l18.11"></a><span id="l18.11"> function test_return_to_provisioner_on_error_XML() {</span>
<a href="#l18.12"></a><span id="l18.12" class="difflineminus">-  const kOriginalTabNum = mc.tabmail.tabContainer.childNodes.length;</span>
<a href="#l18.13"></a><span id="l18.13" class="difflineplus">+  const kOriginalTabNum = mc.tabmail.tabContainer.allTabs.length;</span>
<a href="#l18.14"></a><span id="l18.14"> </span>
<a href="#l18.15"></a><span id="l18.15">   get_to_order_form(&quot;error@error.invalid&quot;);</span>
<a href="#l18.16"></a><span id="l18.16"> </span>
<a href="#l18.17"></a><span id="l18.17">   let tab = mc.tabmail.currentTabInfo;</span>
<a href="#l18.18"></a><span id="l18.18"> </span>
<a href="#l18.19"></a><span id="l18.19">   plan_for_modal_dialog(&quot;AccountCreation&quot;, close_dialog_immediately);</span>
<a href="#l18.20"></a><span id="l18.20"> </span>
<a href="#l18.21"></a><span id="l18.21">   // Click the OK button to order the account.</span>
<a href="#l18.22"></a><span id="l18.22">   let btn = tab.browser.contentWindow.document.querySelector(&quot;input[value=Send]&quot;);</span>
<a href="#l18.23"></a><span id="l18.23">   mc.click(new elib.Elem(btn));</span>
<a href="#l18.24"></a><span id="l18.24"> </span>
<a href="#l18.25"></a><span id="l18.25">   wait_for_modal_dialog(&quot;AccountCreation&quot;);</span>
<a href="#l18.26"></a><span id="l18.26"> </span>
<a href="#l18.27"></a><span id="l18.27">   // We should be done executing the function defined in plan_for_modal_dialog</span>
<a href="#l18.28"></a><span id="l18.28">   // now, so the Account Provisioner dialog should be closed, and the order</span>
<a href="#l18.29"></a><span id="l18.29">   // form tab should have been closed.</span>
<a href="#l18.30"></a><span id="l18.30" class="difflineminus">-  assert_equals(kOriginalTabNum, mc.tabmail.tabContainer.childNodes.length,</span>
<a href="#l18.31"></a><span id="l18.31" class="difflineplus">+  assert_equals(kOriginalTabNum, mc.tabmail.tabContainer.allTabs.length,</span>
<a href="#l18.32"></a><span id="l18.32">                 &quot;Timed out waiting for the order form tab to close.&quot;);</span>
<a href="#l18.33"></a><span id="l18.33"> }</span>
<a href="#l18.34"></a><span id="l18.34"> </span>
<a href="#l18.35"></a><span id="l18.35"> /**</span>
<a href="#l18.36"></a><span id="l18.36">  * Test that if we initiate a search, then the search input, the search button,</span>
<a href="#l18.37"></a><span id="l18.37">  * and all checkboxes should be disabled. The ability to close the window should</span>
<a href="#l18.38"></a><span id="l18.38">  * still be enabled though.</span>
<a href="#l18.39"></a><span id="l18.39">  */</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l19.1"></a><span id="l19.1" class="difflineminus">--- a/mail/test/mozmill/search-window/test-search-window.js</span>
<a href="#l19.2"></a><span id="l19.2" class="difflineplus">+++ b/mail/test/mozmill/search-window/test-search-window.js</span>
<a href="#l19.3"></a><span id="l19.3" class="difflineat">@@ -125,17 +125,17 @@ function test_go_search() {</span>
<a href="#l19.4"></a><span id="l19.4"> </span>
<a href="#l19.5"></a><span id="l19.5"> /**</span>
<a href="#l19.6"></a><span id="l19.6">  * Test opening a single search result in a new tab.</span>
<a href="#l19.7"></a><span id="l19.7">  */</span>
<a href="#l19.8"></a><span id="l19.8"> function test_open_single_search_result_in_tab() {</span>
<a href="#l19.9"></a><span id="l19.9">   swc.window.focus();</span>
<a href="#l19.10"></a><span id="l19.10">   set_open_message_behavior(&quot;NEW_TAB&quot;);</span>
<a href="#l19.11"></a><span id="l19.11">   let folderTab = mc.tabmail.currentTabInfo;</span>
<a href="#l19.12"></a><span id="l19.12" class="difflineminus">-  let preCount = mc.tabmail.tabContainer.childNodes.length;</span>
<a href="#l19.13"></a><span id="l19.13" class="difflineplus">+  let preCount = mc.tabmail.tabContainer.allTabs.length;</span>
<a href="#l19.14"></a><span id="l19.14"> </span>
<a href="#l19.15"></a><span id="l19.15">   // Select one message</span>
<a href="#l19.16"></a><span id="l19.16">   swc.e(&quot;threadTree&quot;).focus();</span>
<a href="#l19.17"></a><span id="l19.17">   let msgHdr = select_click_row(1, swc);</span>
<a href="#l19.18"></a><span id="l19.18">   // Open the selected message</span>
<a href="#l19.19"></a><span id="l19.19">   open_selected_message(swc);</span>
<a href="#l19.20"></a><span id="l19.20">   // This is going to trigger a message display in the main 3pane window</span>
<a href="#l19.21"></a><span id="l19.21">   wait_for_message_display_completion(mc);</span>
<a href="#l19.22"></a><span id="l19.22" class="difflineat">@@ -154,17 +154,17 @@ function test_open_single_search_result_</span>
<a href="#l19.23"></a><span id="l19.23"> </span>
<a href="#l19.24"></a><span id="l19.24"> /**</span>
<a href="#l19.25"></a><span id="l19.25">  * Test opening multiple search results in new tabs.</span>
<a href="#l19.26"></a><span id="l19.26">  */</span>
<a href="#l19.27"></a><span id="l19.27"> function test_open_multiple_search_results_in_new_tabs() {</span>
<a href="#l19.28"></a><span id="l19.28">   swc.window.focus();</span>
<a href="#l19.29"></a><span id="l19.29">   set_open_message_behavior(&quot;NEW_TAB&quot;);</span>
<a href="#l19.30"></a><span id="l19.30">   let folderTab = mc.tabmail.currentTabInfo;</span>
<a href="#l19.31"></a><span id="l19.31" class="difflineminus">-  let preCount = mc.tabmail.tabContainer.childNodes.length;</span>
<a href="#l19.32"></a><span id="l19.32" class="difflineplus">+  let preCount = mc.tabmail.tabContainer.allTabs.length;</span>
<a href="#l19.33"></a><span id="l19.33"> </span>
<a href="#l19.34"></a><span id="l19.34">   // Select a bunch of messages</span>
<a href="#l19.35"></a><span id="l19.35">   swc.e(&quot;threadTree&quot;).focus();</span>
<a href="#l19.36"></a><span id="l19.36">   select_click_row(1, swc);</span>
<a href="#l19.37"></a><span id="l19.37">   let selectedMessages = select_shift_click_row(NUM_MESSAGES_TO_OPEN, swc);</span>
<a href="#l19.38"></a><span id="l19.38">   // Open them</span>
<a href="#l19.39"></a><span id="l19.39">   open_selected_messages(swc);</span>
<a href="#l19.40"></a><span id="l19.40">   // This is going to trigger a message display in the main 3pane window</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l20.1"></a><span id="l20.1" class="difflineminus">--- a/mail/test/mozmill/shared-modules/test-content-tab-helpers.js</span>
<a href="#l20.2"></a><span id="l20.2" class="difflineplus">+++ b/mail/test/mozmill/shared-modules/test-content-tab-helpers.js</span>
<a href="#l20.3"></a><span id="l20.3" class="difflineat">@@ -155,24 +155,24 @@ var NotificationWatcher = {</span>
<a href="#l20.4"></a><span id="l20.4"> function open_content_tab_with_url(aURL, aClickHandler, aBackground, aController) {</span>
<a href="#l20.5"></a><span id="l20.5">   if (aClickHandler === undefined)</span>
<a href="#l20.6"></a><span id="l20.6">     aClickHandler = null;</span>
<a href="#l20.7"></a><span id="l20.7">   if (aBackground === undefined)</span>
<a href="#l20.8"></a><span id="l20.8">     aBackground = false;</span>
<a href="#l20.9"></a><span id="l20.9">   if (aController === undefined)</span>
<a href="#l20.10"></a><span id="l20.10">     aController = mc;</span>
<a href="#l20.11"></a><span id="l20.11"> </span>
<a href="#l20.12"></a><span id="l20.12" class="difflineminus">-  let preCount = mc.tabmail.tabContainer.childNodes.length;</span>
<a href="#l20.13"></a><span id="l20.13" class="difflineplus">+  let preCount = mc.tabmail.tabContainer.allTabs.length;</span>
<a href="#l20.14"></a><span id="l20.14">   mc.tabmail.openTab(&quot;contentTab&quot;, {</span>
<a href="#l20.15"></a><span id="l20.15">     contentPage: aURL,</span>
<a href="#l20.16"></a><span id="l20.16">     background: aBackground,</span>
<a href="#l20.17"></a><span id="l20.17">     clickHandler: aClickHandler,</span>
<a href="#l20.18"></a><span id="l20.18">   });</span>
<a href="#l20.19"></a><span id="l20.19">   utils.waitFor(() =&gt; (</span>
<a href="#l20.20"></a><span id="l20.20" class="difflineminus">-                  aController.tabmail.tabContainer.childNodes.length == preCount + 1),</span>
<a href="#l20.21"></a><span id="l20.21" class="difflineplus">+                aController.tabmail.tabContainer.allTabs.length == preCount + 1),</span>
<a href="#l20.22"></a><span id="l20.22">                 &quot;Timeout waiting for the content tab to open with URL: &quot; + aURL,</span>
<a href="#l20.23"></a><span id="l20.23">                 FAST_TIMEOUT, FAST_INTERVAL);</span>
<a href="#l20.24"></a><span id="l20.24"> </span>
<a href="#l20.25"></a><span id="l20.25">   // We append new tabs at the end, so check the last one.</span>
<a href="#l20.26"></a><span id="l20.26">   let expectedNewTab = aController.tabmail.tabInfo[preCount];</span>
<a href="#l20.27"></a><span id="l20.27">   folderDisplayHelper.assert_selected_tab(expectedNewTab);</span>
<a href="#l20.28"></a><span id="l20.28">   wait_for_content_tab_load(expectedNewTab, aURL);</span>
<a href="#l20.29"></a><span id="l20.29">   return expectedNewTab;</span>
<a href="#l20.30"></a><span id="l20.30" class="difflineat">@@ -189,24 +189,24 @@ function open_content_tab_with_url(aURL,</span>
<a href="#l20.31"></a><span id="l20.31">  *                      to |mc|.</span>
<a href="#l20.32"></a><span id="l20.32">  * @param [aTabType]    Optional tab type to expect (string).</span>
<a href="#l20.33"></a><span id="l20.33">  * @returns The newly-opened tab.</span>
<a href="#l20.34"></a><span id="l20.34">  */</span>
<a href="#l20.35"></a><span id="l20.35"> function open_content_tab_with_click(aElem, aExpectedURL, aController, aTabType = &quot;contentTab&quot;) {</span>
<a href="#l20.36"></a><span id="l20.36">   if (aController === undefined)</span>
<a href="#l20.37"></a><span id="l20.37">     aController = mc;</span>
<a href="#l20.38"></a><span id="l20.38"> </span>
<a href="#l20.39"></a><span id="l20.39" class="difflineminus">-  let preCount = aController.tabmail.tabContainer.childNodes.length;</span>
<a href="#l20.40"></a><span id="l20.40" class="difflineplus">+  let preCount = aController.tabmail.tabContainer.allTabs.length;</span>
<a href="#l20.41"></a><span id="l20.41">   if (typeof(aElem) != &quot;function&quot;)</span>
<a href="#l20.42"></a><span id="l20.42">     aController.click(new elib.Elem(aElem));</span>
<a href="#l20.43"></a><span id="l20.43">   else</span>
<a href="#l20.44"></a><span id="l20.44">     aElem();</span>
<a href="#l20.45"></a><span id="l20.45"> </span>
<a href="#l20.46"></a><span id="l20.46">   utils.waitFor(() =&gt; (</span>
<a href="#l20.47"></a><span id="l20.47" class="difflineminus">-                  aController.tabmail.tabContainer.childNodes.length == preCount + 1),</span>
<a href="#l20.48"></a><span id="l20.48" class="difflineplus">+                aController.tabmail.tabContainer.allTabs.length == preCount + 1),</span>
<a href="#l20.49"></a><span id="l20.49">                 &quot;Timeout waiting for the content tab to open&quot;,</span>
<a href="#l20.50"></a><span id="l20.50">                 FAST_TIMEOUT, FAST_INTERVAL);</span>
<a href="#l20.51"></a><span id="l20.51"> </span>
<a href="#l20.52"></a><span id="l20.52">   // We append new tabs at the end, so check the last one.</span>
<a href="#l20.53"></a><span id="l20.53">   let expectedNewTab = aController.tabmail.tabInfo[preCount];</span>
<a href="#l20.54"></a><span id="l20.54">   folderDisplayHelper.assert_selected_tab(expectedNewTab);</span>
<a href="#l20.55"></a><span id="l20.55">   folderDisplayHelper.assert_tab_mode_name(expectedNewTab, aTabType);</span>
<a href="#l20.56"></a><span id="l20.56">   wait_for_content_tab_load(expectedNewTab, aExpectedURL);</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l21.1"></a><span id="l21.1" class="difflineminus">--- a/mail/test/mozmill/shared-modules/test-folder-display-helpers.js</span>
<a href="#l21.2"></a><span id="l21.2" class="difflineplus">+++ b/mail/test/mozmill/shared-modules/test-folder-display-helpers.js</span>
<a href="#l21.3"></a><span id="l21.3" class="difflineat">@@ -577,36 +577,36 @@ var open_selected_message = open_selecte</span>
<a href="#l21.4"></a><span id="l21.4">  *                    background. If false or not given, then the tab is opened</span>
<a href="#l21.5"></a><span id="l21.5">  *                    in the foreground.</span>
<a href="#l21.6"></a><span id="l21.6">  *</span>
<a href="#l21.7"></a><span id="l21.7">  * @return The tab info of the new tab (a more persistent identifier for tabs</span>
<a href="#l21.8"></a><span id="l21.8">  *     than the index, which will change as tabs open/close).</span>
<a href="#l21.9"></a><span id="l21.9">  */</span>
<a href="#l21.10"></a><span id="l21.10"> function open_selected_message_in_new_tab(aBackground) {</span>
<a href="#l21.11"></a><span id="l21.11">   // get the current tab count so we can make sure the tab actually opened.</span>
<a href="#l21.12"></a><span id="l21.12" class="difflineminus">-  let preCount = mc.tabmail.tabContainer.childNodes.length;</span>
<a href="#l21.13"></a><span id="l21.13" class="difflineplus">+  let preCount = mc.tabmail.tabContainer.allTabs.length;</span>
<a href="#l21.14"></a><span id="l21.14"> </span>
<a href="#l21.15"></a><span id="l21.15">   // save the current tab as the 'other' tab</span>
<a href="#l21.16"></a><span id="l21.16">   otherTab = mc.tabmail.currentTabInfo;</span>
<a href="#l21.17"></a><span id="l21.17"> </span>
<a href="#l21.18"></a><span id="l21.18">   // We won't trigger a new message load if we're in the background.</span>
<a href="#l21.19"></a><span id="l21.19">   if (!aBackground)</span>
<a href="#l21.20"></a><span id="l21.20">     plan_for_message_display(mc);</span>
<a href="#l21.21"></a><span id="l21.21">   mc.tabmail.openTab(&quot;message&quot;, {msgHdr: mc.folderDisplay.selectedMessage,</span>
<a href="#l21.22"></a><span id="l21.22">       viewWrapperToClone: mc.folderDisplay.view,</span>
<a href="#l21.23"></a><span id="l21.23">       background: aBackground});</span>
<a href="#l21.24"></a><span id="l21.24">   wait_for_message_display_completion(mc, !aBackground);</span>
<a href="#l21.25"></a><span id="l21.25"> </span>
<a href="#l21.26"></a><span id="l21.26">   // check that the tab count increased</span>
<a href="#l21.27"></a><span id="l21.27" class="difflineminus">-  if (mc.tabmail.tabContainer.childNodes.length != preCount + 1)</span>
<a href="#l21.28"></a><span id="l21.28" class="difflineplus">+  if (mc.tabmail.tabContainer.allTabs.length != preCount + 1)</span>
<a href="#l21.29"></a><span id="l21.29">     throw new Error(&quot;The tab never actually got opened!&quot;);</span>
<a href="#l21.30"></a><span id="l21.30"> </span>
<a href="#l21.31"></a><span id="l21.31">   // We append new tabs at the end, so return the last tab</span>
<a href="#l21.32"></a><span id="l21.32">   let newTab =</span>
<a href="#l21.33"></a><span id="l21.33" class="difflineminus">-    mc.tabmail.tabInfo[mc.tabmail.tabContainer.childNodes.length - 1];</span>
<a href="#l21.34"></a><span id="l21.34" class="difflineplus">+    mc.tabmail.tabInfo[mc.tabmail.tabContainer.allTabs.length - 1];</span>
<a href="#l21.35"></a><span id="l21.35">   mark_action(&quot;fdh&quot;, &quot;open_selected_message_in_new_tab&quot;,</span>
<a href="#l21.36"></a><span id="l21.36">               [&quot;message&quot;, mc.folderDisplay.selectedMessage,</span>
<a href="#l21.37"></a><span id="l21.37">                &quot;background?&quot;, Boolean(aBackground),</span>
<a href="#l21.38"></a><span id="l21.38">                &quot;new tab&quot;, _jsonize_tabmail_tab(newTab),</span>
<a href="#l21.39"></a><span id="l21.39">                &quot;current tab&quot;, _jsonize_tabmail_tab(mc.tabmail.currentTabInfo)]);</span>
<a href="#l21.40"></a><span id="l21.40">   return newTab;</span>
<a href="#l21.41"></a><span id="l21.41"> }</span>
<a href="#l21.42"></a><span id="l21.42"> </span>
<a href="#l21.43"></a><span id="l21.43" class="difflineat">@@ -784,17 +784,17 @@ function assert_tab_mode_name(aTab, aMod</span>
<a href="#l21.44"></a><span id="l21.44"> }</span>
<a href="#l21.45"></a><span id="l21.45"> </span>
<a href="#l21.46"></a><span id="l21.46"> /**</span>
<a href="#l21.47"></a><span id="l21.47">  * Assert that the number of tabs open matches the value given.</span>
<a href="#l21.48"></a><span id="l21.48">  *</span>
<a href="#l21.49"></a><span id="l21.49">  * @param aNumber The number of tabs that should be open.</span>
<a href="#l21.50"></a><span id="l21.50">  */</span>
<a href="#l21.51"></a><span id="l21.51"> function assert_number_of_tabs_open(aNumber) {</span>
<a href="#l21.52"></a><span id="l21.52" class="difflineminus">-  let actualNumber = mc.tabmail.tabContainer.childNodes.length;</span>
<a href="#l21.53"></a><span id="l21.53" class="difflineplus">+  let actualNumber = mc.tabmail.tabContainer.allTabs.length;</span>
<a href="#l21.54"></a><span id="l21.54">   if (actualNumber != aNumber)</span>
<a href="#l21.55"></a><span id="l21.55">     mark_failure([&quot;There should be &quot; + aNumber + &quot; tabs open, but there &quot; +</span>
<a href="#l21.56"></a><span id="l21.56">                   &quot;are actually &quot; + actualNumber + &quot; tabs open. Tabs:&quot;,</span>
<a href="#l21.57"></a><span id="l21.57">                    mc.tabmail.tabInfo]);</span>
<a href="#l21.58"></a><span id="l21.58"> }</span>
<a href="#l21.59"></a><span id="l21.59"> </span>
<a href="#l21.60"></a><span id="l21.60"> /**</span>
<a href="#l21.61"></a><span id="l21.61">  * Assert that the given tab's title is based on the provided folder or</span>
<a href="#l21.62"></a><span id="l21.62" class="difflineat">@@ -835,17 +835,17 @@ function assert_tab_has_title(aTab, aTit</span>
<a href="#l21.63"></a><span id="l21.63">  */</span>
<a href="#l21.64"></a><span id="l21.64"> function close_tab(aTabToClose) {</span>
<a href="#l21.65"></a><span id="l21.65">   mark_action(&quot;fdh&quot;, &quot;close_tab&quot;, [aTabToClose]);</span>
<a href="#l21.66"></a><span id="l21.66"> </span>
<a href="#l21.67"></a><span id="l21.67">   if (typeof aTabToClose == &quot;number&quot;)</span>
<a href="#l21.68"></a><span id="l21.68">     aTabToClose = mc.tabmail.tabInfo[aTabToClose];</span>
<a href="#l21.69"></a><span id="l21.69"> </span>
<a href="#l21.70"></a><span id="l21.70">   // get the current tab count so we can make sure the tab actually opened.</span>
<a href="#l21.71"></a><span id="l21.71" class="difflineminus">-  let preCount = mc.tabmail.tabContainer.childNodes.length;</span>
<a href="#l21.72"></a><span id="l21.72" class="difflineplus">+  let preCount = mc.tabmail.tabContainer.allTabs.length;</span>
<a href="#l21.73"></a><span id="l21.73"> </span>
<a href="#l21.74"></a><span id="l21.74">   // If we're closing the current tab, a message or summary might be displayed</span>
<a href="#l21.75"></a><span id="l21.75">   // in the tab we'll select next.</span>
<a href="#l21.76"></a><span id="l21.76">   let nextTab = null;</span>
<a href="#l21.77"></a><span id="l21.77">   if (aTabToClose == mc.tabmail.currentTabInfo) {</span>
<a href="#l21.78"></a><span id="l21.78">     let selectedIndex = mc.tabmail.tabContainer.selectedIndex;</span>
<a href="#l21.79"></a><span id="l21.79">     let nextIndex = (selectedIndex == preCount - 1) ? selectedIndex - 1 :</span>
<a href="#l21.80"></a><span id="l21.80">       selectedIndex + 1;</span>
<a href="#l21.81"></a><span id="l21.81" class="difflineat">@@ -861,17 +861,17 @@ function close_tab(aTabToClose) {</span>
<a href="#l21.82"></a><span id="l21.82">     if (mc.folderDisplay.selectedCount)</span>
<a href="#l21.83"></a><span id="l21.83">       wait_for_message_display_completion(mc, true);</span>
<a href="#l21.84"></a><span id="l21.84">     // otherwise wait for the pane to end up blank</span>
<a href="#l21.85"></a><span id="l21.85">     else</span>
<a href="#l21.86"></a><span id="l21.86">       wait_for_blank_content_pane();</span>
<a href="#l21.87"></a><span id="l21.87">   }</span>
<a href="#l21.88"></a><span id="l21.88"> </span>
<a href="#l21.89"></a><span id="l21.89">   // check that the tab count decreased</span>
<a href="#l21.90"></a><span id="l21.90" class="difflineminus">-  if (mc.tabmail.tabContainer.childNodes.length != preCount - 1)</span>
<a href="#l21.91"></a><span id="l21.91" class="difflineplus">+  if (mc.tabmail.tabContainer.allTabs.length != preCount - 1)</span>
<a href="#l21.92"></a><span id="l21.92">     throw new Error(&quot;The tab never actually got closed!&quot;);</span>
<a href="#l21.93"></a><span id="l21.93"> }</span>
<a href="#l21.94"></a><span id="l21.94"> </span>
<a href="#l21.95"></a><span id="l21.95"> /**</span>
<a href="#l21.96"></a><span id="l21.96">  * Close a message window by calling window.close() on the controller.</span>
<a href="#l21.97"></a><span id="l21.97">  */</span>
<a href="#l21.98"></a><span id="l21.98"> function close_message_window(aController) {</span>
<a href="#l21.99"></a><span id="l21.99">   mark_action(&quot;fdh&quot;, &quot;close_message_window&quot;, []);</span>
<a href="#l21.100"></a><span id="l21.100" class="difflineat">@@ -1164,17 +1164,17 @@ function right_click_on_row(aViewIndex) </span>
<a href="#l21.101"></a><span id="l21.101">  */</span>
<a href="#l21.102"></a><span id="l21.102"> function middle_click_on_row(aViewIndex) {</span>
<a href="#l21.103"></a><span id="l21.103">   let msgHdr = mc.dbView.getMsgHdrAt(aViewIndex);</span>
<a href="#l21.104"></a><span id="l21.104">   mark_action(&quot;fdh&quot;, &quot;middle_click_on_row&quot;,</span>
<a href="#l21.105"></a><span id="l21.105">               [&quot;index&quot;, aViewIndex, &quot;message header&quot;, msgHdr]);</span>
<a href="#l21.106"></a><span id="l21.106">   _row_click_helper(mc, mc.threadTree, aViewIndex, 1);</span>
<a href="#l21.107"></a><span id="l21.107">   // We append new tabs at the end, so return the last tab</span>
<a href="#l21.108"></a><span id="l21.108">   mark_action(&quot;fdh&quot;, &quot;/middle_click_on_row&quot;, []);</span>
<a href="#l21.109"></a><span id="l21.109" class="difflineminus">-  return [mc.tabmail.tabInfo[mc.tabmail.tabContainer.childNodes.length - 1],</span>
<a href="#l21.110"></a><span id="l21.110" class="difflineplus">+  return [mc.tabmail.tabInfo[mc.tabmail.tabContainer.allTabs.length - 1],</span>
<a href="#l21.111"></a><span id="l21.111">           msgHdr];</span>
<a href="#l21.112"></a><span id="l21.112"> }</span>
<a href="#l21.113"></a><span id="l21.113"> </span>
<a href="#l21.114"></a><span id="l21.114"> /**</span>
<a href="#l21.115"></a><span id="l21.115">  * Assert that the given row index is currently visible in the thread pane view.</span>
<a href="#l21.116"></a><span id="l21.116">  */</span>
<a href="#l21.117"></a><span id="l21.117"> function assert_row_visible(aViewIndex) {</span>
<a href="#l21.118"></a><span id="l21.118">   let tree = mc.threadTree;</span>
<a href="#l21.119"></a><span id="l21.119" class="difflineat">@@ -1377,17 +1377,17 @@ function right_click_on_folder(aFolder) </span>
<a href="#l21.120"></a><span id="l21.120">  * @return [The new tab, the view index that you clicked on.]</span>
<a href="#l21.121"></a><span id="l21.121">  */</span>
<a href="#l21.122"></a><span id="l21.122"> function middle_click_on_folder(aFolder) {</span>
<a href="#l21.123"></a><span id="l21.123">   // Figure out the view index</span>
<a href="#l21.124"></a><span id="l21.124">   let viewIndex = mc.folderTreeView.getIndexOfFolder(aFolder);</span>
<a href="#l21.125"></a><span id="l21.125">   mark_action(&quot;fdh&quot;, &quot;middle_click_on_folder&quot;, [aFolder]);</span>
<a href="#l21.126"></a><span id="l21.126">   _row_click_helper(mc, mc.folderTree, viewIndex, 1);</span>
<a href="#l21.127"></a><span id="l21.127">   // We append new tabs at the end, so return the last tab</span>
<a href="#l21.128"></a><span id="l21.128" class="difflineminus">-  return [mc.tabmail.tabInfo[mc.tabmail.tabContainer.childNodes.length - 1],</span>
<a href="#l21.129"></a><span id="l21.129" class="difflineplus">+  return [mc.tabmail.tabInfo[mc.tabmail.tabContainer.allTabs.length - 1],</span>
<a href="#l21.130"></a><span id="l21.130">           viewIndex];</span>
<a href="#l21.131"></a><span id="l21.131"> }</span>
<a href="#l21.132"></a><span id="l21.132"> </span>
<a href="#l21.133"></a><span id="l21.133"> /**</span>
<a href="#l21.134"></a><span id="l21.134">  * Get a reference to the smart folder with the given name.</span>
<a href="#l21.135"></a><span id="l21.135">  *</span>
<a href="#l21.136"></a><span id="l21.136">  * @param aFolderName The name of the smart folder (e.g. &quot;Inbox&quot;).</span>
<a href="#l21.137"></a><span id="l21.137">  * @returns An nsIMsgFolder representing the smart folder with the given name.</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l22.1"></a><span id="l22.1" class="difflineminus">--- a/mail/test/mozmill/tabmail/test-tabmail-dragndrop.js</span>
<a href="#l22.2"></a><span id="l22.2" class="difflineplus">+++ b/mail/test/mozmill/tabmail/test-tabmail-dragndrop.js</span>
<a href="#l22.3"></a><span id="l22.3" class="difflineat">@@ -98,35 +98,35 @@ function test_tab_reorder_tabbar() {</span>
<a href="#l22.4"></a><span id="l22.4"> </span>
<a href="#l22.5"></a><span id="l22.5">   assert_true(mc.tabmail.tabModes.message.tabs[2] == mc.tabmail.tabInfo[3],</span>
<a href="#l22.6"></a><span id="l22.6">       &quot; tabMode.tabs and tabInfo out of sync&quot;);</span>
<a href="#l22.7"></a><span id="l22.7"> </span>
<a href="#l22.8"></a><span id="l22.8">   // Start dragging the first tab</span>
<a href="#l22.9"></a><span id="l22.9">   switch_tab(1);</span>
<a href="#l22.10"></a><span id="l22.10">   assert_selected_and_displayed(msgHdrsInFolder[0]);</span>
<a href="#l22.11"></a><span id="l22.11"> </span>
<a href="#l22.12"></a><span id="l22.12" class="difflineminus">-  let tab1 = mc.tabmail.tabContainer.childNodes[1];</span>
<a href="#l22.13"></a><span id="l22.13" class="difflineminus">-  let tab3 = mc.tabmail.tabContainer.childNodes[3];</span>
<a href="#l22.14"></a><span id="l22.14" class="difflineplus">+  let tab1 = mc.tabmail.tabContainer.allTabs[1];</span>
<a href="#l22.15"></a><span id="l22.15" class="difflineplus">+  let tab3 = mc.tabmail.tabContainer.allTabs[3];</span>
<a href="#l22.16"></a><span id="l22.16"> </span>
<a href="#l22.17"></a><span id="l22.17">   drag_n_drop_element(tab1, mc.window, tab3, mc.window, 0.75, 0.0,</span>
<a href="#l22.18"></a><span id="l22.18">                       mc.tabmail.tabContainer);</span>
<a href="#l22.19"></a><span id="l22.19"> </span>
<a href="#l22.20"></a><span id="l22.20">   wait_for_message_display_completion(mc);</span>
<a href="#l22.21"></a><span id="l22.21"> </span>
<a href="#l22.22"></a><span id="l22.22">   // if every thing went well...</span>
<a href="#l22.23"></a><span id="l22.23">   assert_number_of_tabs_open(5);</span>
<a href="#l22.24"></a><span id="l22.24"> </span>
<a href="#l22.25"></a><span id="l22.25">   // ... we should find tab1 at the third position...</span>
<a href="#l22.26"></a><span id="l22.26" class="difflineminus">-  assert_equals(tab1, mc.tabmail.tabContainer.childNodes[3],</span>
<a href="#l22.27"></a><span id="l22.27" class="difflineplus">+  assert_equals(tab1, mc.tabmail.tabContainer.allTabs[3],</span>
<a href="#l22.28"></a><span id="l22.28">                 &quot;Moving tab1 failed&quot;);</span>
<a href="#l22.29"></a><span id="l22.29">   switch_tab(3);</span>
<a href="#l22.30"></a><span id="l22.30">   assert_selected_and_displayed(msgHdrsInFolder[0]);</span>
<a href="#l22.31"></a><span id="l22.31"> </span>
<a href="#l22.32"></a><span id="l22.32">   // ... while tab3 moves one up and gets second.</span>
<a href="#l22.33"></a><span id="l22.33" class="difflineminus">-  assert_true(tab3 == mc.tabmail.tabContainer.childNodes[2],</span>
<a href="#l22.34"></a><span id="l22.34" class="difflineplus">+  assert_true(tab3 == mc.tabmail.tabContainer.allTabs[2],</span>
<a href="#l22.35"></a><span id="l22.35">               &quot;Moving tab3 failed&quot;);</span>
<a href="#l22.36"></a><span id="l22.36">   switch_tab(2);</span>
<a href="#l22.37"></a><span id="l22.37">   assert_selected_and_displayed(msgHdrsInFolder[2]);</span>
<a href="#l22.38"></a><span id="l22.38"> </span>
<a href="#l22.39"></a><span id="l22.39">   // we have one &quot;message&quot; tab and three &quot;folder&quot; tabs, thus tabInfo[1-3] and</span>
<a href="#l22.40"></a><span id="l22.40">   // tabMode[&quot;message&quot;].tabs[0-2] have to be same, otherwise something went</span>
<a href="#l22.41"></a><span id="l22.41">   // wrong while moving tabs around</span>
<a href="#l22.42"></a><span id="l22.42">   assert_true(mc.tabmail.tabModes.message.tabs[0] == mc.tabmail.tabInfo[1],</span>
<a href="#l22.43"></a><span id="l22.43" class="difflineat">@@ -172,32 +172,32 @@ function test_tab_reorder_window() {</span>
<a href="#l22.44"></a><span id="l22.44"> </span>
<a href="#l22.45"></a><span id="l22.45">   mc2 = wait_for_new_window(&quot;mail:3pane&quot;);</span>
<a href="#l22.46"></a><span id="l22.46">   wait_for_message_display_completion(mc2, true);</span>
<a href="#l22.47"></a><span id="l22.47"> </span>
<a href="#l22.48"></a><span id="l22.48">   // Double check if we are listening to the right window.</span>
<a href="#l22.49"></a><span id="l22.49">   assert_true(aWnd2 == mc2.window, &quot;Opening Window failed&quot;);</span>
<a href="#l22.50"></a><span id="l22.50"> </span>
<a href="#l22.51"></a><span id="l22.51">   // Start dragging the first tab ...</span>
<a href="#l22.52"></a><span id="l22.52" class="difflineminus">-  let tabA = mc.tabmail.tabContainer.childNodes[1];</span>
<a href="#l22.53"></a><span id="l22.53" class="difflineplus">+  let tabA = mc.tabmail.tabContainer.allTabs[1];</span>
<a href="#l22.54"></a><span id="l22.54">   assert_true(tabA, &quot;No movable Tab&quot;);</span>
<a href="#l22.55"></a><span id="l22.55"> </span>
<a href="#l22.56"></a><span id="l22.56">   // We drop onto the Folder Tab, it is guaranteed to exist.</span>
<a href="#l22.57"></a><span id="l22.57" class="difflineminus">-  let tabB = mc2.tabmail.tabContainer.childNodes[0];</span>
<a href="#l22.58"></a><span id="l22.58" class="difflineplus">+  let tabB = mc2.tabmail.tabContainer.allTabs[0];</span>
<a href="#l22.59"></a><span id="l22.59">   assert_true(tabB, &quot;No movable Tab&quot;);</span>
<a href="#l22.60"></a><span id="l22.60"> </span>
<a href="#l22.61"></a><span id="l22.61">   drag_n_drop_element(tabA, mc.window, tabB, mc2.window, 0.75, 0.0,</span>
<a href="#l22.62"></a><span id="l22.62">                       mc.tabmail.tabContainer);</span>
<a href="#l22.63"></a><span id="l22.63"> </span>
<a href="#l22.64"></a><span id="l22.64">   wait_for_message_display_completion(mc2);</span>
<a href="#l22.65"></a><span id="l22.65"> </span>
<a href="#l22.66"></a><span id="l22.66" class="difflineminus">-  assert_true(mc.tabmail.tabContainer.childNodes.length == 1,</span>
<a href="#l22.67"></a><span id="l22.67" class="difflineplus">+  assert_true(mc.tabmail.tabContainer.allTabs.length == 1,</span>
<a href="#l22.68"></a><span id="l22.68">     &quot;Moving tab to new window failed, tab still in old window&quot;);</span>
<a href="#l22.69"></a><span id="l22.69"> </span>
<a href="#l22.70"></a><span id="l22.70" class="difflineminus">-  assert_true(mc2.tabmail.tabContainer.childNodes.length == 2,</span>
<a href="#l22.71"></a><span id="l22.71" class="difflineplus">+  assert_true(mc2.tabmail.tabContainer.allTabs.length == 2,</span>
<a href="#l22.72"></a><span id="l22.72">     &quot;Moving tab to new window failed, no new tab in new window&quot;);</span>
<a href="#l22.73"></a><span id="l22.73"> </span>
<a href="#l22.74"></a><span id="l22.74">   assert_selected_and_displayed(mc2, msgHdrsInFolder[1]);</span>
<a href="#l22.75"></a><span id="l22.75"> }</span>
<a href="#l22.76"></a><span id="l22.76"> </span>
<a href="#l22.77"></a><span id="l22.77"> /**</span>
<a href="#l22.78"></a><span id="l22.78">  * Tests detaching tabs into windows via drag'n'drop</span>
<a href="#l22.79"></a><span id="l22.79">  */</span>
<a href="#l22.80"></a><span id="l22.80" class="difflineat">@@ -218,37 +218,37 @@ function test_tab_reorder_detach() {</span>
<a href="#l22.81"></a><span id="l22.81"> </span>
<a href="#l22.82"></a><span id="l22.82">   // ... if every thing works we should expect a new window...</span>
<a href="#l22.83"></a><span id="l22.83">   plan_for_new_window(&quot;mail:3pane&quot;);</span>
<a href="#l22.84"></a><span id="l22.84"> </span>
<a href="#l22.85"></a><span id="l22.85">   // ... now start dragging</span>
<a href="#l22.86"></a><span id="l22.86"> </span>
<a href="#l22.87"></a><span id="l22.87">   mc.tabmail.switchToTab(1);</span>
<a href="#l22.88"></a><span id="l22.88"> </span>
<a href="#l22.89"></a><span id="l22.89" class="difflineminus">-  let tab1 = mc.tabmail.tabContainer.childNodes[1];</span>
<a href="#l22.90"></a><span id="l22.90" class="difflineplus">+  let tab1 = mc.tabmail.tabContainer.allTabs[1];</span>
<a href="#l22.91"></a><span id="l22.91">   let dropContent = mc.e(&quot;tabpanelcontainer&quot;);</span>
<a href="#l22.92"></a><span id="l22.92"> </span>
<a href="#l22.93"></a><span id="l22.93">   let dt = synthesize_drag_start(mc.window, tab1, mc.tabmail.tabContainer);</span>
<a href="#l22.94"></a><span id="l22.94"> </span>
<a href="#l22.95"></a><span id="l22.95">   synthesize_drag_over(mc.window, dropContent, dt);</span>
<a href="#l22.96"></a><span id="l22.96"> </span>
<a href="#l22.97"></a><span id="l22.97">   // notify tab1 drag has ended</span>
<a href="#l22.98"></a><span id="l22.98">   let dropRect = dropContent.getBoundingClientRect();</span>
<a href="#l22.99"></a><span id="l22.99">   synthesize_drag_end(mc.window, dropContent, tab1, dt,</span>
<a href="#l22.100"></a><span id="l22.100">       { screenX: (dropContent.screenX + dropRect.width / 2),</span>
<a href="#l22.101"></a><span id="l22.101">         screenY: (dropContent.screenY + dropRect.height / 2) });</span>
<a href="#l22.102"></a><span id="l22.102"> </span>
<a href="#l22.103"></a><span id="l22.103">   // ... and wait for the new window</span>
<a href="#l22.104"></a><span id="l22.104">   mc2 = wait_for_new_window(&quot;mail:3pane&quot;);</span>
<a href="#l22.105"></a><span id="l22.105">   wait_for_message_display_completion(mc2, true);</span>
<a href="#l22.106"></a><span id="l22.106"> </span>
<a href="#l22.107"></a><span id="l22.107" class="difflineminus">-  assert_true(mc.tabmail.tabContainer.childNodes.length == 1,</span>
<a href="#l22.108"></a><span id="l22.108" class="difflineplus">+  assert_true(mc.tabmail.tabContainer.allTabs.length == 1,</span>
<a href="#l22.109"></a><span id="l22.109">       &quot;Moving tab to new window failed, tab still in old window&quot;);</span>
<a href="#l22.110"></a><span id="l22.110"> </span>
<a href="#l22.111"></a><span id="l22.111" class="difflineminus">-  assert_true(mc2.tabmail.tabContainer.childNodes.length == 2,</span>
<a href="#l22.112"></a><span id="l22.112" class="difflineplus">+  assert_true(mc2.tabmail.tabContainer.allTabs.length == 2,</span>
<a href="#l22.113"></a><span id="l22.113">       &quot;Moving tab to new window failed, no new tab in new window&quot;);</span>
<a href="#l22.114"></a><span id="l22.114"> </span>
<a href="#l22.115"></a><span id="l22.115">   assert_selected_and_displayed(mc2, msgHdrsInFolder[2]);</span>
<a href="#l22.116"></a><span id="l22.116"> }</span>
<a href="#l22.117"></a><span id="l22.117"> </span>
<a href="#l22.118"></a><span id="l22.118"> /**</span>
<a href="#l22.119"></a><span id="l22.119">  * Test undo of recently closed tabs.</span>
<a href="#l22.120"></a><span id="l22.120">  */</span>
<a href="#l22.121"></a><span id="l22.121" class="difflineat">@@ -286,17 +286,17 @@ function test_tab_undo() {</span>
<a href="#l22.122"></a><span id="l22.122">   // msgHdrsInFolder[2] won't be restorend it was closed with disabled undo.</span>
<a href="#l22.123"></a><span id="l22.123"> </span>
<a href="#l22.124"></a><span id="l22.124">   mc.tabmail.undoCloseTab();</span>
<a href="#l22.125"></a><span id="l22.125">   assert_number_of_tabs_open(5);</span>
<a href="#l22.126"></a><span id="l22.126">   assert_selected_and_displayed(mc, msgHdrsInFolder[1]);</span>
<a href="#l22.127"></a><span id="l22.127"> }</span>
<a href="#l22.128"></a><span id="l22.128"> </span>
<a href="#l22.129"></a><span id="l22.129"> function _synthesizeRecentlyClosedMenu() {</span>
<a href="#l22.130"></a><span id="l22.130" class="difflineminus">-  mc.rightClick(new elib.Elem(mc.tabmail.tabContainer.childNodes[1]));</span>
<a href="#l22.131"></a><span id="l22.131" class="difflineplus">+  mc.rightClick(new elib.Elem(mc.tabmail.tabContainer.allTabs[1]));</span>
<a href="#l22.132"></a><span id="l22.132"> </span>
<a href="#l22.133"></a><span id="l22.133">   let tabContextMenu = mc.window.document.getElementById(&quot;tabContextMenu&quot;);</span>
<a href="#l22.134"></a><span id="l22.134">   wait_for_popup_to_open(tabContextMenu);</span>
<a href="#l22.135"></a><span id="l22.135"> </span>
<a href="#l22.136"></a><span id="l22.136">   let recentlyClosedTabs = tabContextMenu</span>
<a href="#l22.137"></a><span id="l22.137">                            .querySelector('[anonid=&quot;recentlyClosedTabs&quot;]');</span>
<a href="#l22.138"></a><span id="l22.138"> </span>
<a href="#l22.139"></a><span id="l22.139">   EventUtils.synthesizeMouse(recentlyClosedTabs, 5, 5, {}, mc.window);</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l23.1"></a><span id="l23.1" class="difflineminus">--- a/mail/themes/linux/mail/tabmail.css</span>
<a href="#l23.2"></a><span id="l23.2" class="difflineplus">+++ b/mail/themes/linux/mail/tabmail.css</span>
<a href="#l23.3"></a><span id="l23.3" class="difflineat">@@ -52,17 +52,16 @@ tabpanels {</span>
<a href="#l23.4"></a><span id="l23.4"> </span>
<a href="#l23.5"></a><span id="l23.5"> .tabmail-tab[selected]:focus &gt; .tab-stack &gt; .tab-content &gt; .tab-label-container {</span>
<a href="#l23.6"></a><span id="l23.6">   border-color: -moz-DialogText;</span>
<a href="#l23.7"></a><span id="l23.7"> }</span>
<a href="#l23.8"></a><span id="l23.8"> </span>
<a href="#l23.9"></a><span id="l23.9"> /* Tab drag and drop */</span>
<a href="#l23.10"></a><span id="l23.10"> .tab-drop-indicator {</span>
<a href="#l23.11"></a><span id="l23.11">   list-style-image: url(icons/dragIndicator.png);</span>
<a href="#l23.12"></a><span id="l23.12" class="difflineminus">-  margin-bottom: -11px;</span>
<a href="#l23.13"></a><span id="l23.13"> }</span>
<a href="#l23.14"></a><span id="l23.14"> </span>
<a href="#l23.15"></a><span id="l23.15"> /* Tabstrip close button */</span>
<a href="#l23.16"></a><span id="l23.16"> .tabs-closebutton {</span>
<a href="#l23.17"></a><span id="l23.17">   margin-top: 1px;</span>
<a href="#l23.18"></a><span id="l23.18"> }</span>
<a href="#l23.19"></a><span id="l23.19"> </span>
<a href="#l23.20"></a><span id="l23.20"> /**</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l24.1"></a><span id="l24.1" class="difflineminus">--- a/mail/themes/windows/mail/tabmail.css</span>
<a href="#l24.2"></a><span id="l24.2" class="difflineplus">+++ b/mail/themes/windows/mail/tabmail.css</span>
<a href="#l24.3"></a><span id="l24.3" class="difflineat">@@ -37,17 +37,16 @@ tabpanels {</span>
<a href="#l24.4"></a><span id="l24.4"> </span>
<a href="#l24.5"></a><span id="l24.5"> .tabmail-tab:focus &gt; .tab-stack &gt; .tab-content &gt; .tab-label-container {</span>
<a href="#l24.6"></a><span id="l24.6">   border-color: -moz-DialogText;</span>
<a href="#l24.7"></a><span id="l24.7"> }</span>
<a href="#l24.8"></a><span id="l24.8"> </span>
<a href="#l24.9"></a><span id="l24.9"> /* Tab DnD indicator */</span>
<a href="#l24.10"></a><span id="l24.10"> .tab-drop-indicator {</span>
<a href="#l24.11"></a><span id="l24.11">   list-style-image: url(icons/dragIndicator.png);</span>
<a href="#l24.12"></a><span id="l24.12" class="difflineminus">-  margin-bottom: -11px;</span>
<a href="#l24.13"></a><span id="l24.13"> }</span>
<a href="#l24.14"></a><span id="l24.14"> </span>
<a href="#l24.15"></a><span id="l24.15"> /**</span>
<a href="#l24.16"></a><span id="l24.16">  * close buttons</span>
<a href="#l24.17"></a><span id="l24.17">  */</span>
<a href="#l24.18"></a><span id="l24.18"> </span>
<a href="#l24.19"></a><span id="l24.19"> .tabs-closebutton-box &gt; .tabs-closebutton {</span>
<a href="#l24.20"></a><span id="l24.20">   margin-top: 1px;</span></pre></div></div>

<div class="page_footer">
<div class="page_footer_text">comm-central</div>
<div class="page_footer_text" style="padding-left: 10px">Deployed from <a href="https://hg.mozilla.org/hgcustom/version-control-tools/rev/4b0de666d1a4">4b0de666d1a4</a> at 2020-07-30T19:32:31Z.</div>
<div class="rss_logo">
<a href="/comm-central/rss-log">RSS</a>
<a href="/comm-central/atom-log">Atom</a>
</div>
<br />

</div>
</body>
</html>

