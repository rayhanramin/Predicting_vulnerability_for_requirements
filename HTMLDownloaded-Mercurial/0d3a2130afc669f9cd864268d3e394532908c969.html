<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en-US" lang="en-US">
<head>
<link rel="icon" href="/static/4b0de666d1a4/hgicon.png" type="image/png" />
<meta name="robots" content="index, nofollow"/>
<link rel="stylesheet" href="/static/4b0de666d1a4/style-gitweb.css" type="text/css" />

<style type="text/css">
div.feed {
  float: right;
}
a img {
  border-width: 0px;
}
div.log_link {
  width: 80px;
  background-color: white;
}

div.log_body {
  padding-left: 96px;
}
</style>
<script type="text/javascript" src="/static/4b0de666d1a4/mercurial.js"></script>

<meta property="og:image" content="/static/4b0de666d1a4/moz-logo-bw-rgb.svg"/>
<meta property="og:type" content="website"/>

<title>comm-central: changeset 29912:0d3a2130afc669f9cd864268d3e394532908c969</title>
<link rel="alternate" type="application/atom+xml"
   href="/comm-central/atom-log" title="Atom feed for comm-central"/>
<link rel="alternate" type="application/rss+xml"
   href="/comm-central/rss-log" title="RSS feed for comm-central"/>

<meta property="og:title" content="comm-central @ 0d3a2130afc669f9cd864268d3e394532908c969" />
<meta property="og:url" content="/comm-central/rev/0d3a2130afc669f9cd864268d3e394532908c969" />
<meta property="og:description" content="Bug 1627736 - Improve the UI and UX of the OpenPGP configuration workflow. r=mkmelin" />

</head>
<body>

<div class="page_header">
<div class="logo">
    <a href="https://developer.mozilla.org/en/docs/Mercurial">
        <img src="/static/4b0de666d1a4/moz-logo-bw-rgb.svg" alt="mercurial" />
    </a>
</div>
<a href="/">Mercurial</a> &gt; <a href="/comm-central">comm-central</a>  / changeset / 0d3a2130afc669f9cd864268d3e394532908c969 
</div>

<div class="page_nav">
<div>
<a href="/comm-central/summary">summary</a> |
<a href="/comm-central/shortlog/0d3a2130afc669f9cd864268d3e394532908c969">shortlog</a> |
<a href="/comm-central/log/0d3a2130afc669f9cd864268d3e394532908c969">changelog</a> |
<a href="/comm-central/pushloghtml">pushlog</a> |
<a href="/comm-central/graph/0d3a2130afc669f9cd864268d3e394532908c969">graph</a> |
<a href="/comm-central/tags">tags</a> |
<a href="/comm-central/bookmarks">bookmarks</a> |
<a href="/comm-central/branches">branches</a> |
<a href="/comm-central/file/0d3a2130afc669f9cd864268d3e394532908c969">files</a> |
changeset |
<a href="/comm-central/raw-rev/0d3a2130afc669f9cd864268d3e394532908c969">raw</a>  | <a href="/comm-central/archive/0d3a2130afc669f9cd864268d3e394532908c969.zip">zip</a>  |
<a href="/comm-central/help">help</a>
</div>

<div class="search">
<form id="searchform" action="/comm-central/log">

<input name="rev" type="text" value="" size="40" />
<div id="hint">Find changesets by keywords (author, files, the commit message), revision
number or hash, or <a href="/comm-central/help/revsets">revset expression</a>.</div>
</form>
</div>
</div>

<div class="title">
<a href="https://bugzilla.mozilla.org/show_bug.cgi?id=1627736">Bug 1627736</a> - Improve the UI and UX of the OpenPGP configuration workflow. r=mkmelin
<span class="logtags"></span>
</div>
<div class="title_text">
<table cellspacing="0">

<tr><td>author</td><td>&#65;&#108;&#101;&#115;&#115;&#97;&#110;&#100;&#114;&#111;&#32;&#67;&#97;&#115;&#116;&#101;&#108;&#108;&#97;&#110;&#105;&#32;&#60;&#97;&#108;&#101;&#115;&#115;&#97;&#110;&#100;&#114;&#111;&#64;&#116;&#104;&#117;&#110;&#100;&#101;&#114;&#98;&#105;&#114;&#100;&#46;&#110;&#101;&#116;&#62;</td></tr>
<tr><td></td><td class="date age">Fri, 19 Jun 2020 09:57:00 -0700</td></tr>

<tr>
 <td>changeset 29912</td>
 <td style="font-family:monospace"><a class="list" href="/comm-central/rev/0d3a2130afc669f9cd864268d3e394532908c969">0d3a2130afc669f9cd864268d3e394532908c969</a></td>
</tr>



<tr>
<td>parent 29911</td>
<td style="font-family:monospace">
<a class="list" href="/comm-central/rev/e7a6f9e44829b1e3d279f8b3585df91f6ee88a4c">e7a6f9e44829b1e3d279f8b3585df91f6ee88a4c</a>
</td>
</tr>

<tr>
<td>child 29913</td>
<td style="font-family:monospace">
<a class="list" href="/comm-central/rev/9a572242446d6e7c0cab83f464014dc8d2d6b01f">9a572242446d6e7c0cab83f464014dc8d2d6b01f</a>
</td>
</tr>
<tr><td>push id</td><td><a href="/comm-central/pushloghtml?changeset=0d3a2130afc669f9cd864268d3e394532908c969">17593</a></td></tr>
<tr><td>push user</td><td>thunderbird@calypsoblue.org</td></tr>
<tr><td>push date</td><td class="date age">Fri, 19 Jun 2020 19:32:57 +0000</td></tr>

<tr><td>treeherder</td><td>comm-central@0d3a2130afc6 [<a href="https://treeherder.mozilla.org/#/jobs?repo=comm-central&revision=0d3a2130afc669f9cd864268d3e394532908c969">default view</a>] [<a href="https://treeherder.mozilla.org/#/jobs?repo=comm-central&revision=0d3a2130afc669f9cd864268d3e394532908c969&filter-resultStatus=testfailed&filter-resultStatus=busted&filter-resultStatus=exception">failures only]</td></tr>
<tr><td>perfherder</td><td>[<a href="https://treeherder.mozilla.org/perf.html#/compare?originalProject=comm-central&originalRevision=0d3a2130afc669f9cd864268d3e394532908c969&newProject=comm-central&newRevision=c2c86d40d2a63d3e36bc081fa6cba84a9b6ce041&framework=1" target="_blank">talos</a>] [<a href="https://treeherder.mozilla.org/perf.html#/compare?originalProject=comm-central&originalRevision=0d3a2130afc669f9cd864268d3e394532908c969&newProject=comm-central&newRevision=c2c86d40d2a63d3e36bc081fa6cba84a9b6ce041&framework=2" target="_blank">build metrics</a>] [<a href="https://treeherder.mozilla.org/perf.html#/compare?originalProject=comm-central&originalRevision=0d3a2130afc669f9cd864268d3e394532908c969&newProject=comm-central&newRevision=c2c86d40d2a63d3e36bc081fa6cba84a9b6ce041&framework=6" target="_blank">platform microbench</a>] (compared to previous push)</td></tr>
<tr><td>reviewers</td><td><a href="/comm-central/log?rev=reviewer%28mkmelin%29&revcount=50">mkmelin</a></td></tr>
<tr><td>bugs</td><td><a href="https://bugzilla.mozilla.org/show_bug.cgi?id=1627736">1627736</a></td></tr>




</table></div>

<div class="page_body description"><a href="https://bugzilla.mozilla.org/show_bug.cgi?id=1627736">Bug 1627736</a> - Improve the UI and UX of the OpenPGP configuration workflow. r=mkmelin</div>
<div class="list_head"></div>
<div class="title_text">
<table cellspacing="0">

<tr class="parity0">
<td><a class="list" href="/comm-central/diff/0d3a2130afc669f9cd864268d3e394532908c969/mail/extensions/am-e2e/am-e2e.inc.xhtml">mail/extensions/am-e2e/am-e2e.inc.xhtml</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/0d3a2130afc669f9cd864268d3e394532908c969/mail/extensions/am-e2e/am-e2e.inc.xhtml">file</a> |
<a href="/comm-central/annotate/0d3a2130afc669f9cd864268d3e394532908c969/mail/extensions/am-e2e/am-e2e.inc.xhtml">annotate</a> |
<a href="/comm-central/diff/0d3a2130afc669f9cd864268d3e394532908c969/mail/extensions/am-e2e/am-e2e.inc.xhtml">diff</a> |
<a href="/comm-central/comparison/0d3a2130afc669f9cd864268d3e394532908c969/mail/extensions/am-e2e/am-e2e.inc.xhtml">comparison</a> |
<a href="/comm-central/log/0d3a2130afc669f9cd864268d3e394532908c969/mail/extensions/am-e2e/am-e2e.inc.xhtml">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/0d3a2130afc669f9cd864268d3e394532908c969/mail/extensions/am-e2e/am-e2e.js">mail/extensions/am-e2e/am-e2e.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/0d3a2130afc669f9cd864268d3e394532908c969/mail/extensions/am-e2e/am-e2e.js">file</a> |
<a href="/comm-central/annotate/0d3a2130afc669f9cd864268d3e394532908c969/mail/extensions/am-e2e/am-e2e.js">annotate</a> |
<a href="/comm-central/diff/0d3a2130afc669f9cd864268d3e394532908c969/mail/extensions/am-e2e/am-e2e.js">diff</a> |
<a href="/comm-central/comparison/0d3a2130afc669f9cd864268d3e394532908c969/mail/extensions/am-e2e/am-e2e.js">comparison</a> |
<a href="/comm-central/log/0d3a2130afc669f9cd864268d3e394532908c969/mail/extensions/am-e2e/am-e2e.js">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/0d3a2130afc669f9cd864268d3e394532908c969/mail/extensions/am-e2e/am-e2e.xhtml">mail/extensions/am-e2e/am-e2e.xhtml</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/0d3a2130afc669f9cd864268d3e394532908c969/mail/extensions/am-e2e/am-e2e.xhtml">file</a> |
<a href="/comm-central/annotate/0d3a2130afc669f9cd864268d3e394532908c969/mail/extensions/am-e2e/am-e2e.xhtml">annotate</a> |
<a href="/comm-central/diff/0d3a2130afc669f9cd864268d3e394532908c969/mail/extensions/am-e2e/am-e2e.xhtml">diff</a> |
<a href="/comm-central/comparison/0d3a2130afc669f9cd864268d3e394532908c969/mail/extensions/am-e2e/am-e2e.xhtml">comparison</a> |
<a href="/comm-central/log/0d3a2130afc669f9cd864268d3e394532908c969/mail/extensions/am-e2e/am-e2e.xhtml">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/0d3a2130afc669f9cd864268d3e394532908c969/mail/extensions/openpgp/content/modules/keyRing.jsm">mail/extensions/openpgp/content/modules/keyRing.jsm</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/0d3a2130afc669f9cd864268d3e394532908c969/mail/extensions/openpgp/content/modules/keyRing.jsm">file</a> |
<a href="/comm-central/annotate/0d3a2130afc669f9cd864268d3e394532908c969/mail/extensions/openpgp/content/modules/keyRing.jsm">annotate</a> |
<a href="/comm-central/diff/0d3a2130afc669f9cd864268d3e394532908c969/mail/extensions/openpgp/content/modules/keyRing.jsm">diff</a> |
<a href="/comm-central/comparison/0d3a2130afc669f9cd864268d3e394532908c969/mail/extensions/openpgp/content/modules/keyRing.jsm">comparison</a> |
<a href="/comm-central/log/0d3a2130afc669f9cd864268d3e394532908c969/mail/extensions/openpgp/content/modules/keyRing.jsm">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/0d3a2130afc669f9cd864268d3e394532908c969/mail/extensions/openpgp/content/strings/enigmail.ftl">mail/extensions/openpgp/content/strings/enigmail.ftl</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/0d3a2130afc669f9cd864268d3e394532908c969/mail/extensions/openpgp/content/strings/enigmail.ftl">file</a> |
<a href="/comm-central/annotate/0d3a2130afc669f9cd864268d3e394532908c969/mail/extensions/openpgp/content/strings/enigmail.ftl">annotate</a> |
<a href="/comm-central/diff/0d3a2130afc669f9cd864268d3e394532908c969/mail/extensions/openpgp/content/strings/enigmail.ftl">diff</a> |
<a href="/comm-central/comparison/0d3a2130afc669f9cd864268d3e394532908c969/mail/extensions/openpgp/content/strings/enigmail.ftl">comparison</a> |
<a href="/comm-central/log/0d3a2130afc669f9cd864268d3e394532908c969/mail/extensions/openpgp/content/strings/enigmail.ftl">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/0d3a2130afc669f9cd864268d3e394532908c969/mail/extensions/openpgp/content/strings/key-wizard.ftl">mail/extensions/openpgp/content/strings/key-wizard.ftl</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/0d3a2130afc669f9cd864268d3e394532908c969/mail/extensions/openpgp/content/strings/key-wizard.ftl">file</a> |
<a href="/comm-central/annotate/0d3a2130afc669f9cd864268d3e394532908c969/mail/extensions/openpgp/content/strings/key-wizard.ftl">annotate</a> |
<a href="/comm-central/diff/0d3a2130afc669f9cd864268d3e394532908c969/mail/extensions/openpgp/content/strings/key-wizard.ftl">diff</a> |
<a href="/comm-central/comparison/0d3a2130afc669f9cd864268d3e394532908c969/mail/extensions/openpgp/content/strings/key-wizard.ftl">comparison</a> |
<a href="/comm-central/log/0d3a2130afc669f9cd864268d3e394532908c969/mail/extensions/openpgp/content/strings/key-wizard.ftl">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/0d3a2130afc669f9cd864268d3e394532908c969/mail/extensions/openpgp/content/ui/enigmailKeygen.js">mail/extensions/openpgp/content/ui/enigmailKeygen.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/0d3a2130afc669f9cd864268d3e394532908c969/mail/extensions/openpgp/content/ui/enigmailKeygen.js">file</a> |
<a href="/comm-central/annotate/0d3a2130afc669f9cd864268d3e394532908c969/mail/extensions/openpgp/content/ui/enigmailKeygen.js">annotate</a> |
<a href="/comm-central/diff/0d3a2130afc669f9cd864268d3e394532908c969/mail/extensions/openpgp/content/ui/enigmailKeygen.js">diff</a> |
<a href="/comm-central/comparison/0d3a2130afc669f9cd864268d3e394532908c969/mail/extensions/openpgp/content/ui/enigmailKeygen.js">comparison</a> |
<a href="/comm-central/log/0d3a2130afc669f9cd864268d3e394532908c969/mail/extensions/openpgp/content/ui/enigmailKeygen.js">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/0d3a2130afc669f9cd864268d3e394532908c969/mail/extensions/openpgp/content/ui/keyDetailsDlg.js">mail/extensions/openpgp/content/ui/keyDetailsDlg.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/0d3a2130afc669f9cd864268d3e394532908c969/mail/extensions/openpgp/content/ui/keyDetailsDlg.js">file</a> |
<a href="/comm-central/annotate/0d3a2130afc669f9cd864268d3e394532908c969/mail/extensions/openpgp/content/ui/keyDetailsDlg.js">annotate</a> |
<a href="/comm-central/diff/0d3a2130afc669f9cd864268d3e394532908c969/mail/extensions/openpgp/content/ui/keyDetailsDlg.js">diff</a> |
<a href="/comm-central/comparison/0d3a2130afc669f9cd864268d3e394532908c969/mail/extensions/openpgp/content/ui/keyDetailsDlg.js">comparison</a> |
<a href="/comm-central/log/0d3a2130afc669f9cd864268d3e394532908c969/mail/extensions/openpgp/content/ui/keyDetailsDlg.js">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/0d3a2130afc669f9cd864268d3e394532908c969/mail/extensions/openpgp/content/ui/keyDetailsDlg.xhtml">mail/extensions/openpgp/content/ui/keyDetailsDlg.xhtml</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/0d3a2130afc669f9cd864268d3e394532908c969/mail/extensions/openpgp/content/ui/keyDetailsDlg.xhtml">file</a> |
<a href="/comm-central/annotate/0d3a2130afc669f9cd864268d3e394532908c969/mail/extensions/openpgp/content/ui/keyDetailsDlg.xhtml">annotate</a> |
<a href="/comm-central/diff/0d3a2130afc669f9cd864268d3e394532908c969/mail/extensions/openpgp/content/ui/keyDetailsDlg.xhtml">diff</a> |
<a href="/comm-central/comparison/0d3a2130afc669f9cd864268d3e394532908c969/mail/extensions/openpgp/content/ui/keyDetailsDlg.xhtml">comparison</a> |
<a href="/comm-central/log/0d3a2130afc669f9cd864268d3e394532908c969/mail/extensions/openpgp/content/ui/keyDetailsDlg.xhtml">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/0d3a2130afc669f9cd864268d3e394532908c969/mail/extensions/openpgp/content/ui/keyWizard.js">mail/extensions/openpgp/content/ui/keyWizard.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/0d3a2130afc669f9cd864268d3e394532908c969/mail/extensions/openpgp/content/ui/keyWizard.js">file</a> |
<a href="/comm-central/annotate/0d3a2130afc669f9cd864268d3e394532908c969/mail/extensions/openpgp/content/ui/keyWizard.js">annotate</a> |
<a href="/comm-central/diff/0d3a2130afc669f9cd864268d3e394532908c969/mail/extensions/openpgp/content/ui/keyWizard.js">diff</a> |
<a href="/comm-central/comparison/0d3a2130afc669f9cd864268d3e394532908c969/mail/extensions/openpgp/content/ui/keyWizard.js">comparison</a> |
<a href="/comm-central/log/0d3a2130afc669f9cd864268d3e394532908c969/mail/extensions/openpgp/content/ui/keyWizard.js">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/0d3a2130afc669f9cd864268d3e394532908c969/mail/extensions/openpgp/content/ui/keyWizard.xhtml">mail/extensions/openpgp/content/ui/keyWizard.xhtml</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/0d3a2130afc669f9cd864268d3e394532908c969/mail/extensions/openpgp/content/ui/keyWizard.xhtml">file</a> |
<a href="/comm-central/annotate/0d3a2130afc669f9cd864268d3e394532908c969/mail/extensions/openpgp/content/ui/keyWizard.xhtml">annotate</a> |
<a href="/comm-central/diff/0d3a2130afc669f9cd864268d3e394532908c969/mail/extensions/openpgp/content/ui/keyWizard.xhtml">diff</a> |
<a href="/comm-central/comparison/0d3a2130afc669f9cd864268d3e394532908c969/mail/extensions/openpgp/content/ui/keyWizard.xhtml">comparison</a> |
<a href="/comm-central/log/0d3a2130afc669f9cd864268d3e394532908c969/mail/extensions/openpgp/content/ui/keyWizard.xhtml">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/0d3a2130afc669f9cd864268d3e394532908c969/mail/locales/jar.mn">mail/locales/jar.mn</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/0d3a2130afc669f9cd864268d3e394532908c969/mail/locales/jar.mn">file</a> |
<a href="/comm-central/annotate/0d3a2130afc669f9cd864268d3e394532908c969/mail/locales/jar.mn">annotate</a> |
<a href="/comm-central/diff/0d3a2130afc669f9cd864268d3e394532908c969/mail/locales/jar.mn">diff</a> |
<a href="/comm-central/comparison/0d3a2130afc669f9cd864268d3e394532908c969/mail/locales/jar.mn">comparison</a> |
<a href="/comm-central/log/0d3a2130afc669f9cd864268d3e394532908c969/mail/locales/jar.mn">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/0d3a2130afc669f9cd864268d3e394532908c969/mail/themes/shared/jar.inc.mn">mail/themes/shared/jar.inc.mn</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/0d3a2130afc669f9cd864268d3e394532908c969/mail/themes/shared/jar.inc.mn">file</a> |
<a href="/comm-central/annotate/0d3a2130afc669f9cd864268d3e394532908c969/mail/themes/shared/jar.inc.mn">annotate</a> |
<a href="/comm-central/diff/0d3a2130afc669f9cd864268d3e394532908c969/mail/themes/shared/jar.inc.mn">diff</a> |
<a href="/comm-central/comparison/0d3a2130afc669f9cd864268d3e394532908c969/mail/themes/shared/jar.inc.mn">comparison</a> |
<a href="/comm-central/log/0d3a2130afc669f9cd864268d3e394532908c969/mail/themes/shared/jar.inc.mn">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/0d3a2130afc669f9cd864268d3e394532908c969/mail/themes/shared/mail/accountManage.css">mail/themes/shared/mail/accountManage.css</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/0d3a2130afc669f9cd864268d3e394532908c969/mail/themes/shared/mail/accountManage.css">file</a> |
<a href="/comm-central/annotate/0d3a2130afc669f9cd864268d3e394532908c969/mail/themes/shared/mail/accountManage.css">annotate</a> |
<a href="/comm-central/diff/0d3a2130afc669f9cd864268d3e394532908c969/mail/themes/shared/mail/accountManage.css">diff</a> |
<a href="/comm-central/comparison/0d3a2130afc669f9cd864268d3e394532908c969/mail/themes/shared/mail/accountManage.css">comparison</a> |
<a href="/comm-central/log/0d3a2130afc669f9cd864268d3e394532908c969/mail/themes/shared/mail/accountManage.css">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/0d3a2130afc669f9cd864268d3e394532908c969/mail/themes/shared/mail/icons/fingerprint.svg">mail/themes/shared/mail/icons/fingerprint.svg</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/0d3a2130afc669f9cd864268d3e394532908c969/mail/themes/shared/mail/icons/fingerprint.svg">file</a> |
<a href="/comm-central/annotate/0d3a2130afc669f9cd864268d3e394532908c969/mail/themes/shared/mail/icons/fingerprint.svg">annotate</a> |
<a href="/comm-central/diff/0d3a2130afc669f9cd864268d3e394532908c969/mail/themes/shared/mail/icons/fingerprint.svg">diff</a> |
<a href="/comm-central/comparison/0d3a2130afc669f9cd864268d3e394532908c969/mail/themes/shared/mail/icons/fingerprint.svg">comparison</a> |
<a href="/comm-central/log/0d3a2130afc669f9cd864268d3e394532908c969/mail/themes/shared/mail/icons/fingerprint.svg">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/0d3a2130afc669f9cd864268d3e394532908c969/mail/themes/shared/mail/icons/login.svg">mail/themes/shared/mail/icons/login.svg</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/0d3a2130afc669f9cd864268d3e394532908c969/mail/themes/shared/mail/icons/login.svg">file</a> |
<a href="/comm-central/annotate/0d3a2130afc669f9cd864268d3e394532908c969/mail/themes/shared/mail/icons/login.svg">annotate</a> |
<a href="/comm-central/diff/0d3a2130afc669f9cd864268d3e394532908c969/mail/themes/shared/mail/icons/login.svg">diff</a> |
<a href="/comm-central/comparison/0d3a2130afc669f9cd864268d3e394532908c969/mail/themes/shared/mail/icons/login.svg">comparison</a> |
<a href="/comm-central/log/0d3a2130afc669f9cd864268d3e394532908c969/mail/themes/shared/mail/icons/login.svg">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/0d3a2130afc669f9cd864268d3e394532908c969/mail/themes/shared/openpgp/inlineNotification.css">mail/themes/shared/openpgp/inlineNotification.css</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/0d3a2130afc669f9cd864268d3e394532908c969/mail/themes/shared/openpgp/inlineNotification.css">file</a> |
<a href="/comm-central/annotate/0d3a2130afc669f9cd864268d3e394532908c969/mail/themes/shared/openpgp/inlineNotification.css">annotate</a> |
<a href="/comm-central/diff/0d3a2130afc669f9cd864268d3e394532908c969/mail/themes/shared/openpgp/inlineNotification.css">diff</a> |
<a href="/comm-central/comparison/0d3a2130afc669f9cd864268d3e394532908c969/mail/themes/shared/openpgp/inlineNotification.css">comparison</a> |
<a href="/comm-central/log/0d3a2130afc669f9cd864268d3e394532908c969/mail/themes/shared/openpgp/inlineNotification.css">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/0d3a2130afc669f9cd864268d3e394532908c969/mail/themes/shared/openpgp/keyWizard.css">mail/themes/shared/openpgp/keyWizard.css</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/0d3a2130afc669f9cd864268d3e394532908c969/mail/themes/shared/openpgp/keyWizard.css">file</a> |
<a href="/comm-central/annotate/0d3a2130afc669f9cd864268d3e394532908c969/mail/themes/shared/openpgp/keyWizard.css">annotate</a> |
<a href="/comm-central/diff/0d3a2130afc669f9cd864268d3e394532908c969/mail/themes/shared/openpgp/keyWizard.css">diff</a> |
<a href="/comm-central/comparison/0d3a2130afc669f9cd864268d3e394532908c969/mail/themes/shared/openpgp/keyWizard.css">comparison</a> |
<a href="/comm-central/log/0d3a2130afc669f9cd864268d3e394532908c969/mail/themes/shared/openpgp/keyWizard.css">revisions</a>
</td>
</tr>
</table></div>

<div class="page_body diffblocks"><div class="diffblock"><pre class="sourcelines">
<a href="#l1.1"></a><span id="l1.1" class="difflineminus">--- a/mail/extensions/am-e2e/am-e2e.inc.xhtml</span>
<a href="#l1.2"></a><span id="l1.2" class="difflineplus">+++ b/mail/extensions/am-e2e/am-e2e.inc.xhtml</span>
<a href="#l1.3"></a><span id="l1.3" class="difflineat">@@ -6,59 +6,107 @@</span>
<a href="#l1.4"></a><span id="l1.4"> &lt;script src=&quot;chrome://openpgp/content/BondOpenPGP.jsm&quot;/&gt;</span>
<a href="#l1.5"></a><span id="l1.5"> #endif</span>
<a href="#l1.6"></a><span id="l1.6"> </span>
<a href="#l1.7"></a><span id="l1.7">     &lt;vbox id=&quot;e2eEditing&quot;&gt;</span>
<a href="#l1.8"></a><span id="l1.8"> </span>
<a href="#l1.9"></a><span id="l1.9">       &lt;stringbundle id=&quot;bundle_e2e&quot; src=&quot;chrome://messenger/locale/am-smime.properties&quot;/&gt;</span>
<a href="#l1.10"></a><span id="l1.10">       &lt;stringbundle id=&quot;bundle_brand&quot; src=&quot;chrome://branding/locale/brand.properties&quot;/&gt;</span>
<a href="#l1.11"></a><span id="l1.11"> </span>
<a href="#l1.12"></a><span id="l1.12" class="difflineplus">+      &lt;linkset&gt;</span>
<a href="#l1.13"></a><span id="l1.13" class="difflineplus">+        &lt;html:link rel=&quot;localization&quot; href=&quot;messenger/openpgp/enigmail.ftl&quot;/&gt;</span>
<a href="#l1.14"></a><span id="l1.14" class="difflineplus">+      &lt;/linkset&gt;</span>
<a href="#l1.15"></a><span id="l1.15" class="difflineplus">+</span>
<a href="#l1.16"></a><span id="l1.16">       &lt;label hidden=&quot;true&quot; wsm_persist=&quot;true&quot; id=&quot;identity_encryptionpolicy&quot;/&gt;</span>
<a href="#l1.17"></a><span id="l1.17">       &lt;label hidden=&quot;true&quot; wsm_persist=&quot;true&quot; id=&quot;identity_e2etechpref&quot;/&gt;</span>
<a href="#l1.18"></a><span id="l1.18"> </span>
<a href="#l1.19"></a><span id="l1.19">       &lt;vbox&gt;</span>
<a href="#l1.20"></a><span id="l1.20">         &lt;description flex=&quot;1&quot;&gt;</span>
<a href="#l1.21"></a><span id="l1.21">           &lt;html:span class=&quot;tail-with-learn-more&quot;&gt;&amp;e2eIntro.description;&lt;/html:span&gt;</span>
<a href="#l1.22"></a><span id="l1.22">           &lt;label is=&quot;text-link&quot; id=&quot;acceptLearnMoreE2E&quot;</span>
<a href="#l1.23"></a><span id="l1.23">                  href=&quot;https://support.mozilla.org/kb/introduction-to-e2e-encryption&quot;</span>
<a href="#l1.24"></a><span id="l1.24">                  value=&quot;&amp;e2eLearnMore.label;&quot;/&gt;</span>
<a href="#l1.25"></a><span id="l1.25">         &lt;/description&gt;</span>
<a href="#l1.26"></a><span id="l1.26">       &lt;/vbox&gt;</span>
<a href="#l1.27"></a><span id="l1.27"> </span>
<a href="#l1.28"></a><span id="l1.28"> #ifdef MOZ_OPENPGP</span>
<a href="#l1.29"></a><span id="l1.29">       &lt;html:div&gt;</span>
<a href="#l1.30"></a><span id="l1.30" class="difflineminus">-      &lt;html:fieldset id=&quot;openpgpOptions&quot; class=&quot;openpgp-item&quot;&gt;</span>
<a href="#l1.31"></a><span id="l1.31" class="difflineminus">-        &lt;html:legend&gt;&amp;openpgpKeys.label;&lt;/html:legend&gt;</span>
<a href="#l1.32"></a><span id="l1.32" class="difflineplus">+        &lt;html:fieldset id=&quot;openpgpOptions&quot; class=&quot;openpgp-item&quot;</span>
<a href="#l1.33"></a><span id="l1.33" class="difflineplus">+                       aria-describedby=&quot;openPgpgDescription&quot;&gt;</span>
<a href="#l1.34"></a><span id="l1.34" class="difflineplus">+          &lt;html:legend&gt;&amp;openpgpKeys.label;&lt;/html:legend&gt;</span>
<a href="#l1.35"></a><span id="l1.35"> </span>
<a href="#l1.36"></a><span id="l1.36" class="difflineminus">-        &lt;label id=&quot;identity_openpgp_key_nameLabel&quot;</span>
<a href="#l1.37"></a><span id="l1.37" class="difflineminus">-               value=&quot;&amp;openpgpKey.message;&quot; control=&quot;identity_openpgp_key_id&quot;/&gt;</span>
<a href="#l1.38"></a><span id="l1.38" class="difflineminus">-        &lt;hbox align=&quot;center&quot; class=&quot;input-container&quot;&gt;</span>
<a href="#l1.39"></a><span id="l1.39" class="difflineminus">-          &lt;html:input id=&quot;identity_openpgp_key_id&quot; type=&quot;text&quot;</span>
<a href="#l1.40"></a><span id="l1.40" class="difflineminus">-                      class=&quot;input-inline&quot;</span>
<a href="#l1.41"></a><span id="l1.41" class="difflineminus">-                      readonly=&quot;readonly&quot;</span>
<a href="#l1.42"></a><span id="l1.42" class="difflineminus">-                      disabled=&quot;disabled&quot;</span>
<a href="#l1.43"></a><span id="l1.43" class="difflineminus">-                      aria-labelledby=&quot;identity_openpgp_key_nameLabel&quot;</span>
<a href="#l1.44"></a><span id="l1.44" class="difflineminus">-                      wsm_persist=&quot;true&quot;</span>
<a href="#l1.45"></a><span id="l1.45" class="difflineminus">-                      prefstring=&quot;mail.identity.%identitykey%.openpgp_key_id&quot;/&gt;</span>
<a href="#l1.46"></a><span id="l1.46" class="difflineplus">+          &lt;vbox data-subcategory=&quot;openpgp&quot; class=&quot;openpgp-container&quot;&gt;</span>
<a href="#l1.47"></a><span id="l1.47" class="difflineplus">+            &lt;hbox align=&quot;center&quot; class=&quot;opengpg-intro-section&quot;&gt;</span>
<a href="#l1.48"></a><span id="l1.48" class="difflineplus">+              &lt;image id=&quot;openPgpKey&quot;/&gt;</span>
<a href="#l1.49"></a><span id="l1.49" class="difflineplus">+              &lt;vbox flex=&quot;1&quot;&gt;</span>
<a href="#l1.50"></a><span id="l1.50" class="difflineplus">+                &lt;description class=&quot;description-with-side-element openpgp-description&quot;&gt;</span>
<a href="#l1.51"></a><span id="l1.51" class="difflineplus">+                  &lt;html:p id=&quot;openPgpgDescription&quot;&gt;&lt;/html:p&gt;</span>
<a href="#l1.52"></a><span id="l1.52" class="difflineplus">+                  &lt;image id=&quot;openPgpStatusImage&quot; class=&quot;status-success&quot;</span>
<a href="#l1.53"></a><span id="l1.53" class="difflineplus">+                         hidden=&quot;true&quot;/&gt;</span>
<a href="#l1.54"></a><span id="l1.54" class="difflineplus">+                  &lt;html:span id=&quot;openPgpgSelectionStatus&quot;</span>
<a href="#l1.55"></a><span id="l1.55" class="difflineplus">+                             class=&quot;tail-with-learn-more&quot;</span>
<a href="#l1.56"></a><span id="l1.56" class="difflineplus">+                             hidden=&quot;hidden&quot;&gt;&lt;/html:span&gt;</span>
<a href="#l1.57"></a><span id="l1.57" class="difflineplus">+                  &lt;label is=&quot;text-link&quot; id=&quot;openPgpLearnMore&quot;</span>
<a href="#l1.58"></a><span id="l1.58" class="difflineplus">+                         href=&quot;https://support.mozilla.org/kb/introduction-to-e2e-encryption&quot;</span>
<a href="#l1.59"></a><span id="l1.59" class="difflineplus">+                         data-l10n-id=&quot;e2e-learn-more&quot;</span>
<a href="#l1.60"></a><span id="l1.60" class="difflineplus">+                         class=&quot;learnMore&quot;</span>
<a href="#l1.61"></a><span id="l1.61" class="difflineplus">+                         hidden=&quot;true&quot;/&gt;</span>
<a href="#l1.62"></a><span id="l1.62" class="difflineplus">+                &lt;/description&gt;</span>
<a href="#l1.63"></a><span id="l1.63" class="difflineplus">+              &lt;/vbox&gt;</span>
<a href="#l1.64"></a><span id="l1.64" class="difflineplus">+              &lt;vbox&gt;</span>
<a href="#l1.65"></a><span id="l1.65" class="difflineplus">+                &lt;!-- Please don't remove the wrapping hbox/vbox/box for these elements. It's used to properly compute the search tooltip position. --&gt;</span>
<a href="#l1.66"></a><span id="l1.66" class="difflineplus">+                &lt;hbox&gt;</span>
<a href="#l1.67"></a><span id="l1.67" class="difflineplus">+                  &lt;button id=&quot;addOpenPgpButton&quot;</span>
<a href="#l1.68"></a><span id="l1.68" class="difflineplus">+                          data-l10n-id=&quot;openpgp-add-key-button&quot;</span>
<a href="#l1.69"></a><span id="l1.69" class="difflineplus">+                          oncommand=&quot;openKeyWizard();&quot;</span>
<a href="#l1.70"></a><span id="l1.70" class="difflineplus">+                          class=&quot;accessory-button&quot;</span>
<a href="#l1.71"></a><span id="l1.71" class="difflineplus">+                          flex=&quot;1&quot;/&gt;</span>
<a href="#l1.72"></a><span id="l1.72" class="difflineplus">+                &lt;/hbox&gt;</span>
<a href="#l1.73"></a><span id="l1.73" class="difflineplus">+              &lt;/vbox&gt;</span>
<a href="#l1.74"></a><span id="l1.74" class="difflineplus">+            &lt;/hbox&gt;</span>
<a href="#l1.75"></a><span id="l1.75"> </span>
<a href="#l1.76"></a><span id="l1.76" class="difflineminus">-          &lt;button id=&quot;openpgpKeySelectButton&quot;</span>
<a href="#l1.77"></a><span id="l1.77" class="difflineminus">-                  label=&quot;&amp;openpgpKey.button;&quot;</span>
<a href="#l1.78"></a><span id="l1.78" class="difflineminus">-                  accesskey=&quot;&amp;openpgpKey.accesskey;&quot;</span>
<a href="#l1.79"></a><span id="l1.79" class="difflineminus">-                  oncommand=&quot;pgpSelectKey('identity_openpgp_key_id')&quot;/&gt;</span>
<a href="#l1.80"></a><span id="l1.80" class="difflineminus">-          &lt;button id=&quot;openpgpKeyClearButton&quot;</span>
<a href="#l1.81"></a><span id="l1.81" class="difflineminus">-                  label=&quot;&amp;encryption.certificate_clear.button;&quot;</span>
<a href="#l1.82"></a><span id="l1.82" class="difflineminus">-                  oncommand=&quot;pgpClearKey('identity_openpgp_key_id')&quot;/&gt;</span>
<a href="#l1.83"></a><span id="l1.83" class="difflineminus">-        &lt;/hbox&gt;</span>
<a href="#l1.84"></a><span id="l1.84" class="difflineplus">+            &lt;hbox id=&quot;openPgpNotification&quot;</span>
<a href="#l1.85"></a><span id="l1.85" class="difflineplus">+                  class=&quot;inline-notification-container success-container&quot;</span>
<a href="#l1.86"></a><span id="l1.86" class="difflineplus">+                  collapsed=&quot;true&quot;&gt;</span>
<a href="#l1.87"></a><span id="l1.87" class="difflineplus">+              &lt;hbox class=&quot;inline-notification-wrapper&quot;&gt;</span>
<a href="#l1.88"></a><span id="l1.88" class="difflineplus">+                &lt;image class=&quot;notification-image notification-image-success&quot;/&gt;</span>
<a href="#l1.89"></a><span id="l1.89" class="difflineplus">+                &lt;description id=&quot;openPgpNotificationDescription&quot;/&gt;</span>
<a href="#l1.90"></a><span id="l1.90" class="difflineplus">+                &lt;button class=&quot;close-icon&quot; oncommand=&quot;closeNotification()&quot;/&gt;</span>
<a href="#l1.91"></a><span id="l1.91" class="difflineplus">+              &lt;/hbox&gt;</span>
<a href="#l1.92"></a><span id="l1.92" class="difflineplus">+            &lt;/hbox&gt;</span>
<a href="#l1.93"></a><span id="l1.93"> </span>
<a href="#l1.94"></a><span id="l1.94" class="difflineminus">-        &lt;hbox align=&quot;right&quot;&gt;</span>
<a href="#l1.95"></a><span id="l1.95" class="difflineminus">-          &lt;button id=&quot;openOpenPGPKeyManagerButton&quot; oncommand=&quot;BondOpenPGP.openKeyManager(window);&quot;</span>
<a href="#l1.96"></a><span id="l1.96" class="difflineminus">-                  label=&quot;&amp;manageKeys.label;&quot;/&gt;</span>
<a href="#l1.97"></a><span id="l1.97" class="difflineminus">-        &lt;/hbox&gt;</span>
<a href="#l1.98"></a><span id="l1.98" class="difflineminus">-      &lt;/html:fieldset&gt;</span>
<a href="#l1.99"></a><span id="l1.99" class="difflineplus">+            &lt;vbox id=&quot;openPgpKeyList&quot;&gt;</span>
<a href="#l1.100"></a><span id="l1.100" class="difflineplus">+              &lt;radiogroup id=&quot;openPgpKeyListRadio&quot;&gt;</span>
<a href="#l1.101"></a><span id="l1.101" class="difflineplus">+                &lt;vbox id=&quot;openPgpOptionNone&quot; class=&quot;content-blocking-category&quot;&gt;</span>
<a href="#l1.102"></a><span id="l1.102" class="difflineplus">+                  &lt;hbox&gt;</span>
<a href="#l1.103"></a><span id="l1.103" class="difflineplus">+                    &lt;radio id=&quot;openPgpNone&quot;</span>
<a href="#l1.104"></a><span id="l1.104" class="difflineplus">+                          value=&quot;&quot;</span>
<a href="#l1.105"></a><span id="l1.105" class="difflineplus">+                          data-l10n-id=&quot;openpgp-radio-none&quot;</span>
<a href="#l1.106"></a><span id="l1.106" class="difflineplus">+                          flex=&quot;1&quot;/&gt;</span>
<a href="#l1.107"></a><span id="l1.107" class="difflineplus">+                  &lt;/hbox&gt;</span>
<a href="#l1.108"></a><span id="l1.108" class="difflineplus">+                  &lt;vbox class=&quot;indent&quot;&gt;</span>
<a href="#l1.109"></a><span id="l1.109" class="difflineplus">+                    &lt;description data-l10n-id=&quot;openpgp-radio-none-desc&quot;/&gt;</span>
<a href="#l1.110"></a><span id="l1.110" class="difflineplus">+                  &lt;/vbox&gt;</span>
<a href="#l1.111"></a><span id="l1.111" class="difflineplus">+                &lt;/vbox&gt;</span>
<a href="#l1.112"></a><span id="l1.112" class="difflineplus">+                &lt;!-- All available keys will be appended here. --&gt;</span>
<a href="#l1.113"></a><span id="l1.113" class="difflineplus">+              &lt;/radiogroup&gt;</span>
<a href="#l1.114"></a><span id="l1.114" class="difflineplus">+            &lt;/vbox&gt;</span>
<a href="#l1.115"></a><span id="l1.115" class="difflineplus">+          &lt;/vbox&gt;</span>
<a href="#l1.116"></a><span id="l1.116" class="difflineplus">+</span>
<a href="#l1.117"></a><span id="l1.117" class="difflineplus">+          &lt;separator class=&quot;thin&quot;/&gt;</span>
<a href="#l1.118"></a><span id="l1.118" class="difflineplus">+</span>
<a href="#l1.119"></a><span id="l1.119" class="difflineplus">+          &lt;hbox&gt;</span>
<a href="#l1.120"></a><span id="l1.120" class="difflineplus">+            &lt;button id=&quot;openOpenPGPKeyManagerButton&quot;</span>
<a href="#l1.121"></a><span id="l1.121" class="difflineplus">+                    oncommand=&quot;BondOpenPGP.openKeyManager(window);&quot;</span>
<a href="#l1.122"></a><span id="l1.122" class="difflineplus">+                    label=&quot;&amp;manageKeys.label;&quot;/&gt;</span>
<a href="#l1.123"></a><span id="l1.123" class="difflineplus">+          &lt;/hbox&gt;</span>
<a href="#l1.124"></a><span id="l1.124" class="difflineplus">+        &lt;/html:fieldset&gt;</span>
<a href="#l1.125"></a><span id="l1.125">       &lt;/html:div&gt;</span>
<a href="#l1.126"></a><span id="l1.126" class="difflineplus">+</span>
<a href="#l1.127"></a><span id="l1.127" class="difflineplus">+      &lt;separator/&gt;</span>
<a href="#l1.128"></a><span id="l1.128"> #endif</span>
<a href="#l1.129"></a><span id="l1.129"> </span>
<a href="#l1.130"></a><span id="l1.130">       &lt;html:div&gt;</span>
<a href="#l1.131"></a><span id="l1.131">       &lt;html:fieldset id=&quot;smimeOptions&quot;&gt;</span>
<a href="#l1.132"></a><span id="l1.132">         &lt;html:legend&gt;&amp;certificates2.label;&lt;/html:legend&gt;</span>
<a href="#l1.133"></a><span id="l1.133"> </span>
<a href="#l1.134"></a><span id="l1.134">         &lt;label id=&quot;identity_signing_cert_nameLabel&quot;</span>
<a href="#l1.135"></a><span id="l1.135">                value=&quot;&amp;signingCert2.message;&quot; control=&quot;identity_signing_cert_name&quot;</span>
<a href="#l1.136"></a><span id="l1.136" class="difflineat">@@ -79,16 +127,18 @@</span>
<a href="#l1.137"></a><span id="l1.137">                   oncommand=&quot;smimeSelectCert('identity_signing_cert_name')&quot;/&gt;</span>
<a href="#l1.138"></a><span id="l1.138"> </span>
<a href="#l1.139"></a><span id="l1.139">           &lt;button id=&quot;signingCertClearButton&quot;</span>
<a href="#l1.140"></a><span id="l1.140">                   label=&quot;&amp;digitalSign.certificate_clear.button;&quot;</span>
<a href="#l1.141"></a><span id="l1.141">                   accesskey=&quot;&amp;digitalSign.certificate_clear.accesskey;&quot;</span>
<a href="#l1.142"></a><span id="l1.142">                   oncommand=&quot;smimeClearCert('identity_signing_cert_name')&quot;/&gt;</span>
<a href="#l1.143"></a><span id="l1.143">         &lt;/hbox&gt;</span>
<a href="#l1.144"></a><span id="l1.144"> </span>
<a href="#l1.145"></a><span id="l1.145" class="difflineplus">+        &lt;separator class=&quot;thin&quot;/&gt;</span>
<a href="#l1.146"></a><span id="l1.146" class="difflineplus">+</span>
<a href="#l1.147"></a><span id="l1.147">         &lt;label value=&quot;&amp;encryptionCert2.message;&quot;</span>
<a href="#l1.148"></a><span id="l1.148">                control=&quot;identity_encryption_cert_name&quot;/&gt;</span>
<a href="#l1.149"></a><span id="l1.149"> </span>
<a href="#l1.150"></a><span id="l1.150">         &lt;hbox align=&quot;center&quot; class=&quot;input-container&quot;&gt;</span>
<a href="#l1.151"></a><span id="l1.151">           &lt;html:input id=&quot;identity_encryption_cert_name&quot; type=&quot;text&quot;</span>
<a href="#l1.152"></a><span id="l1.152">                       class=&quot;input-inline&quot;</span>
<a href="#l1.153"></a><span id="l1.153">                       readonly=&quot;readonly&quot;</span>
<a href="#l1.154"></a><span id="l1.154">                       disabled=&quot;disabled&quot;</span>
<a href="#l1.155"></a><span id="l1.155" class="difflineat">@@ -101,26 +151,30 @@</span>
<a href="#l1.156"></a><span id="l1.156">                   oncommand=&quot;smimeSelectCert('identity_encryption_cert_name')&quot;/&gt;</span>
<a href="#l1.157"></a><span id="l1.157"> </span>
<a href="#l1.158"></a><span id="l1.158">           &lt;button id=&quot;encryptionCertClearButton&quot;</span>
<a href="#l1.159"></a><span id="l1.159">                   label=&quot;&amp;encryption.certificate_clear.button;&quot;</span>
<a href="#l1.160"></a><span id="l1.160">                   accesskey=&quot;&amp;encryption.certificate_clear.accesskey;&quot;</span>
<a href="#l1.161"></a><span id="l1.161">                   oncommand=&quot;smimeClearCert('identity_encryption_cert_name')&quot;/&gt;</span>
<a href="#l1.162"></a><span id="l1.162">         &lt;/hbox&gt;</span>
<a href="#l1.163"></a><span id="l1.163"> </span>
<a href="#l1.164"></a><span id="l1.164" class="difflineplus">+        &lt;separator class=&quot;thin&quot;/&gt;</span>
<a href="#l1.165"></a><span id="l1.165" class="difflineplus">+</span>
<a href="#l1.166"></a><span id="l1.166">         &lt;hbox align=&quot;right&quot;&gt;</span>
<a href="#l1.167"></a><span id="l1.167">           &lt;button id=&quot;openCertManagerButton&quot; oncommand=&quot;openCertManager();&quot;</span>
<a href="#l1.168"></a><span id="l1.168">                   label=&quot;&amp;manageCerts3.label;&quot; accesskey=&quot;&amp;manageCerts3.accesskey;&quot;/&gt;</span>
<a href="#l1.169"></a><span id="l1.169">           &lt;button id=&quot;openDeviceManagerButton&quot; oncommand=&quot;openDeviceManager();&quot;</span>
<a href="#l1.170"></a><span id="l1.170">                   label=&quot;&amp;manageDevices2.label;&quot; accesskey=&quot;&amp;manageDevices2.accesskey;&quot;/&gt;</span>
<a href="#l1.171"></a><span id="l1.171">         &lt;/hbox&gt;</span>
<a href="#l1.172"></a><span id="l1.172"> </span>
<a href="#l1.173"></a><span id="l1.173">       &lt;/html:fieldset&gt;</span>
<a href="#l1.174"></a><span id="l1.174">       &lt;/html:div&gt;</span>
<a href="#l1.175"></a><span id="l1.175"> </span>
<a href="#l1.176"></a><span id="l1.176" class="difflineplus">+      &lt;separator/&gt;</span>
<a href="#l1.177"></a><span id="l1.177" class="difflineplus">+</span>
<a href="#l1.178"></a><span id="l1.178">       &lt;html:legend&gt;&amp;sendingDefaults.label;&lt;/html:legend&gt;</span>
<a href="#l1.179"></a><span id="l1.179"> </span>
<a href="#l1.180"></a><span id="l1.180">       &lt;html:div&gt;</span>
<a href="#l1.181"></a><span id="l1.181">       &lt;html:fieldset id=&quot;encryption_titlebox&quot;&gt;</span>
<a href="#l1.182"></a><span id="l1.182">         &lt;description flex=&quot;1&quot;&gt;&amp;e2eEnc.description;&lt;/description&gt;</span>
<a href="#l1.183"></a><span id="l1.183"> </span>
<a href="#l1.184"></a><span id="l1.184">         &lt;radiogroup id=&quot;encryptionChoices&quot; class=&quot;indent&quot;&gt;</span>
<a href="#l1.185"></a><span id="l1.185">           &lt;radio id=&quot;encrypt_no&quot; wsm_persist=&quot;true&quot; value=&quot;0&quot;</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l2.1"></a><span id="l2.1" class="difflineminus">--- a/mail/extensions/am-e2e/am-e2e.js</span>
<a href="#l2.2"></a><span id="l2.2" class="difflineplus">+++ b/mail/extensions/am-e2e/am-e2e.js</span>
<a href="#l2.3"></a><span id="l2.3" class="difflineat">@@ -1,25 +1,36 @@</span>
<a href="#l2.4"></a><span id="l2.4"> /* -*- Mode: Java; tab-width: 4; indent-tabs-mode: nil; c-basic-offset: 4 -*-</span>
<a href="#l2.5"></a><span id="l2.5">  * This Source Code Form is subject to the terms of the Mozilla Public</span>
<a href="#l2.6"></a><span id="l2.6">  * License, v. 2.0. If a copy of the MPL was not distributed with this</span>
<a href="#l2.7"></a><span id="l2.7">  * file, You can obtain one at http://mozilla.org/MPL/2.0/. */</span>
<a href="#l2.8"></a><span id="l2.8"> </span>
<a href="#l2.9"></a><span id="l2.9" class="difflineplus">+/* import-globals-from ../../../../toolkit/content/preferencesBindings.js */</span>
<a href="#l2.10"></a><span id="l2.10" class="difflineplus">+</span>
<a href="#l2.11"></a><span id="l2.11" class="difflineplus">+// Modules</span>
<a href="#l2.12"></a><span id="l2.12" class="difflineplus">+/* global GetEnigmailSvc: false, PgpSqliteDb2: false */</span>
<a href="#l2.13"></a><span id="l2.13" class="difflineplus">+</span>
<a href="#l2.14"></a><span id="l2.14"> var { Services } = ChromeUtils.import(&quot;resource://gre/modules/Services.jsm&quot;);</span>
<a href="#l2.15"></a><span id="l2.15"> var { MailConstants } = ChromeUtils.import(</span>
<a href="#l2.16"></a><span id="l2.16">   &quot;resource:///modules/MailConstants.jsm&quot;</span>
<a href="#l2.17"></a><span id="l2.17"> );</span>
<a href="#l2.18"></a><span id="l2.18"> var { BondOpenPGP } = ChromeUtils.import(</span>
<a href="#l2.19"></a><span id="l2.19">   &quot;chrome://openpgp/content/BondOpenPGP.jsm&quot;</span>
<a href="#l2.20"></a><span id="l2.20"> );</span>
<a href="#l2.21"></a><span id="l2.21" class="difflineplus">+var { EnigmailKey } = ChromeUtils.import(</span>
<a href="#l2.22"></a><span id="l2.22" class="difflineplus">+  &quot;chrome://openpgp/content/modules/key.jsm&quot;</span>
<a href="#l2.23"></a><span id="l2.23" class="difflineplus">+);</span>
<a href="#l2.24"></a><span id="l2.24"> </span>
<a href="#l2.25"></a><span id="l2.25"> if (MailConstants.MOZ_OPENPGP &amp;&amp; BondOpenPGP.allDependenciesLoaded()) {</span>
<a href="#l2.26"></a><span id="l2.26">   var { EnigmailKeyRing } = ChromeUtils.import(</span>
<a href="#l2.27"></a><span id="l2.27">     &quot;chrome://openpgp/content/modules/keyRing.jsm&quot;</span>
<a href="#l2.28"></a><span id="l2.28">   );</span>
<a href="#l2.29"></a><span id="l2.29" class="difflineplus">+  var EnigmailCryptoAPI = ChromeUtils.import(</span>
<a href="#l2.30"></a><span id="l2.30" class="difflineplus">+    &quot;chrome://openpgp/content/modules/cryptoAPI.jsm&quot;</span>
<a href="#l2.31"></a><span id="l2.31" class="difflineplus">+  ).EnigmailCryptoAPI;</span>
<a href="#l2.32"></a><span id="l2.32"> }</span>
<a href="#l2.33"></a><span id="l2.33"> </span>
<a href="#l2.34"></a><span id="l2.34"> var nsIX509CertDB = Ci.nsIX509CertDB;</span>
<a href="#l2.35"></a><span id="l2.35"> var nsX509CertDBContractID = &quot;@mozilla.org/security/x509certdb;1&quot;;</span>
<a href="#l2.36"></a><span id="l2.36"> var nsIX509Cert = Ci.nsIX509Cert;</span>
<a href="#l2.37"></a><span id="l2.37"> </span>
<a href="#l2.38"></a><span id="l2.38"> var email_signing_cert_usage = 4; // SECCertUsage.certUsageEmailSigner</span>
<a href="#l2.39"></a><span id="l2.39"> var email_recipient_cert_usage = 5; // SECCertUsage.certUsageEmailRecipient</span>
<a href="#l2.40"></a><span id="l2.40" class="difflineat">@@ -35,17 +46,16 @@ var gSignMessages = null;</span>
<a href="#l2.41"></a><span id="l2.41"> var gRequireEncrypt = null;</span>
<a href="#l2.42"></a><span id="l2.42"> var gDoNotEncrypt = null;</span>
<a href="#l2.43"></a><span id="l2.43"> var gKeyId = null;</span>
<a href="#l2.44"></a><span id="l2.44"> var gBundle = null;</span>
<a href="#l2.45"></a><span id="l2.45"> var gBrandBundle;</span>
<a href="#l2.46"></a><span id="l2.46"> var gSmimePrefbranch;</span>
<a href="#l2.47"></a><span id="l2.47"> var kEncryptionCertPref = &quot;identity_encryption_cert_name&quot;;</span>
<a href="#l2.48"></a><span id="l2.48"> var kSigningCertPref = &quot;identity_signing_cert_name&quot;;</span>
<a href="#l2.49"></a><span id="l2.49" class="difflineminus">-var kOpenPGPKeyPref = &quot;identity_openpgp_key_id&quot;;</span>
<a href="#l2.50"></a><span id="l2.50"> </span>
<a href="#l2.51"></a><span id="l2.51"> var gTechAuto = null;</span>
<a href="#l2.52"></a><span id="l2.52"> var gTechPrefOpenPGP = null;</span>
<a href="#l2.53"></a><span id="l2.53"> var gTechPrefSMIME = null;</span>
<a href="#l2.54"></a><span id="l2.54"> </span>
<a href="#l2.55"></a><span id="l2.55"> function onInit() {</span>
<a href="#l2.56"></a><span id="l2.56">   if (!MailConstants.MOZ_OPENPGP || !BondOpenPGP.allDependenciesLoaded()) {</span>
<a href="#l2.57"></a><span id="l2.57">     for (let item of document.querySelectorAll(&quot;.openpgp-item&quot;)) {</span>
<a href="#l2.58"></a><span id="l2.58" class="difflineat">@@ -66,18 +76,35 @@ function e2eInitializeFields() {</span>
<a href="#l2.59"></a><span id="l2.59">   gSignCertName = document.getElementById(kSigningCertPref);</span>
<a href="#l2.60"></a><span id="l2.60">   gSignMessages = document.getElementById(&quot;identity_sign_mail&quot;);</span>
<a href="#l2.61"></a><span id="l2.61">   gRequireEncrypt = document.getElementById(&quot;encrypt_require&quot;);</span>
<a href="#l2.62"></a><span id="l2.62">   gDoNotEncrypt = document.getElementById(&quot;encrypt_no&quot;);</span>
<a href="#l2.63"></a><span id="l2.63">   gBundle = document.getElementById(&quot;bundle_e2e&quot;);</span>
<a href="#l2.64"></a><span id="l2.64">   gBrandBundle = document.getElementById(&quot;bundle_brand&quot;);</span>
<a href="#l2.65"></a><span id="l2.65"> </span>
<a href="#l2.66"></a><span id="l2.66">   if (MailConstants.MOZ_OPENPGP &amp;&amp; BondOpenPGP.allDependenciesLoaded()) {</span>
<a href="#l2.67"></a><span id="l2.67" class="difflineplus">+    document</span>
<a href="#l2.68"></a><span id="l2.68" class="difflineplus">+      .getElementById(&quot;openPgpKeyListRadio&quot;)</span>
<a href="#l2.69"></a><span id="l2.69" class="difflineplus">+      .setAttribute(</span>
<a href="#l2.70"></a><span id="l2.70" class="difflineplus">+        &quot;preference&quot;,</span>
<a href="#l2.71"></a><span id="l2.71" class="difflineplus">+        `mail.identity.${gIdentity.key}.openpgp_key_id`</span>
<a href="#l2.72"></a><span id="l2.72" class="difflineplus">+      );</span>
<a href="#l2.73"></a><span id="l2.73" class="difflineplus">+</span>
<a href="#l2.74"></a><span id="l2.74" class="difflineplus">+    if (!Preferences.get(`mail.identity.${gIdentity.key}.openpgp_key_id`)) {</span>
<a href="#l2.75"></a><span id="l2.75" class="difflineplus">+      Preferences.add({</span>
<a href="#l2.76"></a><span id="l2.76" class="difflineplus">+        id: `mail.identity.${gIdentity.key}.openpgp_key_id`,</span>
<a href="#l2.77"></a><span id="l2.77" class="difflineplus">+        type: &quot;string&quot;,</span>
<a href="#l2.78"></a><span id="l2.78" class="difflineplus">+      });</span>
<a href="#l2.79"></a><span id="l2.79" class="difflineplus">+    }</span>
<a href="#l2.80"></a><span id="l2.80" class="difflineplus">+</span>
<a href="#l2.81"></a><span id="l2.81">     gTechChoices = document.getElementById(&quot;technologyChoices&quot;);</span>
<a href="#l2.82"></a><span id="l2.82" class="difflineminus">-    gKeyId = document.getElementById(kOpenPGPKeyPref);</span>
<a href="#l2.83"></a><span id="l2.83" class="difflineplus">+    gKeyId = Services.prefs.getStringPref(</span>
<a href="#l2.84"></a><span id="l2.84" class="difflineplus">+      `mail.identity.${gIdentity.key}.openpgp_key_id`,</span>
<a href="#l2.85"></a><span id="l2.85" class="difflineplus">+      &quot;&quot;</span>
<a href="#l2.86"></a><span id="l2.86" class="difflineplus">+    );</span>
<a href="#l2.87"></a><span id="l2.87">     gTechAuto = document.getElementById(&quot;technology_automatic&quot;);</span>
<a href="#l2.88"></a><span id="l2.88">     gTechPrefOpenPGP = document.getElementById(&quot;technology_prefer_openpgp&quot;);</span>
<a href="#l2.89"></a><span id="l2.89">     gTechPrefSMIME = document.getElementById(&quot;technology_prefer_smime&quot;);</span>
<a href="#l2.90"></a><span id="l2.90">   }</span>
<a href="#l2.91"></a><span id="l2.91"> </span>
<a href="#l2.92"></a><span id="l2.92">   if (!gIdentity) {</span>
<a href="#l2.93"></a><span id="l2.93">     // The user is going to create a new identity.</span>
<a href="#l2.94"></a><span id="l2.94">     // Set everything to default values.</span>
<a href="#l2.95"></a><span id="l2.95" class="difflineat">@@ -87,36 +114,37 @@ function e2eInitializeFields() {</span>
<a href="#l2.96"></a><span id="l2.96">     gEncryptionCertName.value = &quot;&quot;;</span>
<a href="#l2.97"></a><span id="l2.97">     gEncryptionCertName.displayName = &quot;&quot;;</span>
<a href="#l2.98"></a><span id="l2.98">     gEncryptionCertName.dbKey = &quot;&quot;;</span>
<a href="#l2.99"></a><span id="l2.99"> </span>
<a href="#l2.100"></a><span id="l2.100">     gSignCertName.value = &quot;&quot;;</span>
<a href="#l2.101"></a><span id="l2.101">     gSignCertName.displayName = &quot;&quot;;</span>
<a href="#l2.102"></a><span id="l2.102">     gSignCertName.dbKey = &quot;&quot;;</span>
<a href="#l2.103"></a><span id="l2.103"> </span>
<a href="#l2.104"></a><span id="l2.104" class="difflineplus">+    // If the user doesn't have an identity defined but OpenPGP is available,</span>
<a href="#l2.105"></a><span id="l2.105" class="difflineplus">+    // we hide the entire section to avoid issues and edge cases.</span>
<a href="#l2.106"></a><span id="l2.106">     if (MailConstants.MOZ_OPENPGP &amp;&amp; BondOpenPGP.allDependenciesLoaded()) {</span>
<a href="#l2.107"></a><span id="l2.107" class="difflineminus">-      gKeyId.value = &quot;&quot;;</span>
<a href="#l2.108"></a><span id="l2.108" class="difflineplus">+      document</span>
<a href="#l2.109"></a><span id="l2.109" class="difflineplus">+        .getElementById(&quot;openpgpOptions&quot;)</span>
<a href="#l2.110"></a><span id="l2.110" class="difflineplus">+        .setAttribute(&quot;hidden&quot;, &quot;hidden&quot;);</span>
<a href="#l2.111"></a><span id="l2.111">     }</span>
<a href="#l2.112"></a><span id="l2.112"> </span>
<a href="#l2.113"></a><span id="l2.113">     gRequireEncrypt.disabled = true;</span>
<a href="#l2.114"></a><span id="l2.114">     gDoNotEncrypt.disabled = true;</span>
<a href="#l2.115"></a><span id="l2.115">     gSignMessages.disabled = true;</span>
<a href="#l2.116"></a><span id="l2.116"> </span>
<a href="#l2.117"></a><span id="l2.117">     gSignMessages.checked = false;</span>
<a href="#l2.118"></a><span id="l2.118">     gEncryptionChoices.value = 0;</span>
<a href="#l2.119"></a><span id="l2.119">     if (MailConstants.MOZ_OPENPGP &amp;&amp; BondOpenPGP.allDependenciesLoaded()) {</span>
<a href="#l2.120"></a><span id="l2.120">       gTechChoices.value = 0;</span>
<a href="#l2.121"></a><span id="l2.121">     }</span>
<a href="#l2.122"></a><span id="l2.122">   } else {</span>
<a href="#l2.123"></a><span id="l2.123">     var certdb = Cc[nsX509CertDBContractID].getService(nsIX509CertDB);</span>
<a href="#l2.124"></a><span id="l2.124">     var x509cert = null;</span>
<a href="#l2.125"></a><span id="l2.125"> </span>
<a href="#l2.126"></a><span id="l2.126" class="difflineminus">-    if (MailConstants.MOZ_OPENPGP &amp;&amp; BondOpenPGP.allDependenciesLoaded()) {</span>
<a href="#l2.127"></a><span id="l2.127" class="difflineminus">-      gKeyId.value = gIdentity.getUnicharAttribute(&quot;openpgp_key_id&quot;);</span>
<a href="#l2.128"></a><span id="l2.128" class="difflineminus">-    }</span>
<a href="#l2.129"></a><span id="l2.129">     gEncryptionCertName.value = gIdentity.getUnicharAttribute(</span>
<a href="#l2.130"></a><span id="l2.130">       &quot;encryption_cert_name&quot;</span>
<a href="#l2.131"></a><span id="l2.131">     );</span>
<a href="#l2.132"></a><span id="l2.132">     gEncryptionCertName.dbKey = gIdentity.getCharAttribute(</span>
<a href="#l2.133"></a><span id="l2.133">       &quot;encryption_cert_dbkey&quot;</span>
<a href="#l2.134"></a><span id="l2.134">     );</span>
<a href="#l2.135"></a><span id="l2.135">     // If we succeed in looking up the certificate by the dbkey pref, then</span>
<a href="#l2.136"></a><span id="l2.136">     // append the serial number &quot; [...]&quot; to the display value, and remember the</span>
<a href="#l2.137"></a><span id="l2.137" class="difflineat">@@ -135,17 +163,17 @@ function e2eInitializeFields() {</span>
<a href="#l2.138"></a><span id="l2.138"> </span>
<a href="#l2.139"></a><span id="l2.139">     gEncryptionChoices.value = gIdentity.getIntAttribute(&quot;encryptionpolicy&quot;);</span>
<a href="#l2.140"></a><span id="l2.140">     if (MailConstants.MOZ_OPENPGP &amp;&amp; BondOpenPGP.allDependenciesLoaded()) {</span>
<a href="#l2.141"></a><span id="l2.141">       gTechChoices.value = gIdentity.getIntAttribute(&quot;e2etechpref&quot;);</span>
<a href="#l2.142"></a><span id="l2.142">     }</span>
<a href="#l2.143"></a><span id="l2.143"> </span>
<a href="#l2.144"></a><span id="l2.144">     let enableEnc = !!gEncryptionCertName.value;</span>
<a href="#l2.145"></a><span id="l2.145">     if (MailConstants.MOZ_OPENPGP &amp;&amp; BondOpenPGP.allDependenciesLoaded()) {</span>
<a href="#l2.146"></a><span id="l2.146" class="difflineminus">-      enableEnc = enableEnc || !!gKeyId.value;</span>
<a href="#l2.147"></a><span id="l2.147" class="difflineplus">+      enableEnc = enableEnc || !!gKeyId;</span>
<a href="#l2.148"></a><span id="l2.148">     }</span>
<a href="#l2.149"></a><span id="l2.149"> </span>
<a href="#l2.150"></a><span id="l2.150">     gRequireEncrypt.disabled = !enableEnc;</span>
<a href="#l2.151"></a><span id="l2.151">     gDoNotEncrypt.disabled = !enableEnc;</span>
<a href="#l2.152"></a><span id="l2.152">     enableEncryptionControls(enableEnc);</span>
<a href="#l2.153"></a><span id="l2.153"> </span>
<a href="#l2.154"></a><span id="l2.154">     gSignCertName.value = gIdentity.getUnicharAttribute(&quot;signing_cert_name&quot;);</span>
<a href="#l2.155"></a><span id="l2.155">     gSignCertName.dbKey = gIdentity.getCharAttribute(&quot;signing_cert_dbkey&quot;);</span>
<a href="#l2.156"></a><span id="l2.156" class="difflineat">@@ -162,54 +190,91 @@ function e2eInitializeFields() {</span>
<a href="#l2.157"></a><span id="l2.157">         gSignCertName.displayName = x509cert.displayName;</span>
<a href="#l2.158"></a><span id="l2.158">       }</span>
<a href="#l2.159"></a><span id="l2.159">     } catch (e) {}</span>
<a href="#l2.160"></a><span id="l2.160"> </span>
<a href="#l2.161"></a><span id="l2.161">     gSignMessages.checked = gIdentity.getBoolAttribute(&quot;sign_mail&quot;);</span>
<a href="#l2.162"></a><span id="l2.162"> </span>
<a href="#l2.163"></a><span id="l2.163">     let enableSig = gSignCertName.value;</span>
<a href="#l2.164"></a><span id="l2.164">     if (MailConstants.MOZ_OPENPGP &amp;&amp; BondOpenPGP.allDependenciesLoaded()) {</span>
<a href="#l2.165"></a><span id="l2.165" class="difflineminus">-      enableSig = enableSig || !!gKeyId.value;</span>
<a href="#l2.166"></a><span id="l2.166" class="difflineplus">+      enableSig = enableSig || !!gKeyId;</span>
<a href="#l2.167"></a><span id="l2.167">     }</span>
<a href="#l2.168"></a><span id="l2.168"> </span>
<a href="#l2.169"></a><span id="l2.169">     gSignMessages.disabled = !enableSig;</span>
<a href="#l2.170"></a><span id="l2.170">     enableSigningControls(enableSig);</span>
<a href="#l2.171"></a><span id="l2.171">   }</span>
<a href="#l2.172"></a><span id="l2.172"> </span>
<a href="#l2.173"></a><span id="l2.173">   // Always start with enabling select buttons.</span>
<a href="#l2.174"></a><span id="l2.174">   // This will keep the visibility of buttons in a sane state as user</span>
<a href="#l2.175"></a><span id="l2.175">   // jumps from security panel of one account to another.</span>
<a href="#l2.176"></a><span id="l2.176">   enableSelectButtons();</span>
<a href="#l2.177"></a><span id="l2.177">   updateTechPref();</span>
<a href="#l2.178"></a><span id="l2.178" class="difflineplus">+</span>
<a href="#l2.179"></a><span id="l2.179" class="difflineplus">+  initOpenPgpSettings();</span>
<a href="#l2.180"></a><span id="l2.180" class="difflineplus">+}</span>
<a href="#l2.181"></a><span id="l2.181" class="difflineplus">+</span>
<a href="#l2.182"></a><span id="l2.182" class="difflineplus">+/**</span>
<a href="#l2.183"></a><span id="l2.183" class="difflineplus">+ * Initialize the OpenPGP settings, apply strings, and load the key radio UI.</span>
<a href="#l2.184"></a><span id="l2.184" class="difflineplus">+ */</span>
<a href="#l2.185"></a><span id="l2.185" class="difflineplus">+async function initOpenPgpSettings() {</span>
<a href="#l2.186"></a><span id="l2.186" class="difflineplus">+  if (!MailConstants.MOZ_OPENPGP || !BondOpenPGP.allDependenciesLoaded()) {</span>
<a href="#l2.187"></a><span id="l2.187" class="difflineplus">+    return;</span>
<a href="#l2.188"></a><span id="l2.188" class="difflineplus">+  }</span>
<a href="#l2.189"></a><span id="l2.189" class="difflineplus">+</span>
<a href="#l2.190"></a><span id="l2.190" class="difflineplus">+  let result = {};</span>
<a href="#l2.191"></a><span id="l2.191" class="difflineplus">+  EnigmailKeyRing.getAllSecretKeysByEmail(gIdentity.email, result);</span>
<a href="#l2.192"></a><span id="l2.192" class="difflineplus">+</span>
<a href="#l2.193"></a><span id="l2.193" class="difflineplus">+  document.l10n.setAttributes(</span>
<a href="#l2.194"></a><span id="l2.194" class="difflineplus">+    document.getElementById(&quot;openPgpgDescription&quot;),</span>
<a href="#l2.195"></a><span id="l2.195" class="difflineplus">+    &quot;openpgp-description&quot;,</span>
<a href="#l2.196"></a><span id="l2.196" class="difflineplus">+    {</span>
<a href="#l2.197"></a><span id="l2.197" class="difflineplus">+      count: result.all.length,</span>
<a href="#l2.198"></a><span id="l2.198" class="difflineplus">+      identity: gIdentity.email,</span>
<a href="#l2.199"></a><span id="l2.199" class="difflineplus">+    }</span>
<a href="#l2.200"></a><span id="l2.200" class="difflineplus">+  );</span>
<a href="#l2.201"></a><span id="l2.201" class="difflineplus">+</span>
<a href="#l2.202"></a><span id="l2.202" class="difflineplus">+  // Force deselect the currently selected first index fo the radiogroup if</span>
<a href="#l2.203"></a><span id="l2.203" class="difflineplus">+  // an OpenPGP Key is currently set. This is necessary to allow the selection</span>
<a href="#l2.204"></a><span id="l2.204" class="difflineplus">+  // of the currently used key.</span>
<a href="#l2.205"></a><span id="l2.205" class="difflineplus">+  if (gKeyId) {</span>
<a href="#l2.206"></a><span id="l2.206" class="difflineplus">+    document.getElementById(&quot;openPgpKeyListRadio&quot;).selectedIndex = -1;</span>
<a href="#l2.207"></a><span id="l2.207" class="difflineplus">+  }</span>
<a href="#l2.208"></a><span id="l2.208" class="difflineplus">+</span>
<a href="#l2.209"></a><span id="l2.209" class="difflineplus">+  // Load all the available keys.</span>
<a href="#l2.210"></a><span id="l2.210" class="difflineplus">+  reloadOpenPgpUI();</span>
<a href="#l2.211"></a><span id="l2.211" class="difflineplus">+</span>
<a href="#l2.212"></a><span id="l2.212" class="difflineplus">+  // Listen for the preference changes.</span>
<a href="#l2.213"></a><span id="l2.213" class="difflineplus">+  Preferences.get(`mail.identity.${gIdentity.key}.openpgp_key_id`).on(</span>
<a href="#l2.214"></a><span id="l2.214" class="difflineplus">+    &quot;change&quot;,</span>
<a href="#l2.215"></a><span id="l2.215" class="difflineplus">+    updateOpenPgpSettings</span>
<a href="#l2.216"></a><span id="l2.216" class="difflineplus">+  );</span>
<a href="#l2.217"></a><span id="l2.217"> }</span>
<a href="#l2.218"></a><span id="l2.218"> </span>
<a href="#l2.219"></a><span id="l2.219"> function onPreInit(account, accountValues) {</span>
<a href="#l2.220"></a><span id="l2.220">   gIdentity = account.defaultIdentity;</span>
<a href="#l2.221"></a><span id="l2.221"> }</span>
<a href="#l2.222"></a><span id="l2.222"> </span>
<a href="#l2.223"></a><span id="l2.223"> function onSave() {</span>
<a href="#l2.224"></a><span id="l2.224">   e2eSave();</span>
<a href="#l2.225"></a><span id="l2.225">   window.dispatchEvent(new CustomEvent(&quot;prefchange&quot;));</span>
<a href="#l2.226"></a><span id="l2.226"> }</span>
<a href="#l2.227"></a><span id="l2.227"> </span>
<a href="#l2.228"></a><span id="l2.228"> function e2eSave() {</span>
<a href="#l2.229"></a><span id="l2.229" class="difflineminus">-  // find out which radio for the encryption radio group is selected and set that on our hidden encryptionChoice pref....</span>
<a href="#l2.230"></a><span id="l2.230" class="difflineplus">+  // find out which radio for the encryption radio group is selected and set</span>
<a href="#l2.231"></a><span id="l2.231" class="difflineplus">+  // that on our hidden encryptionChoice pref.</span>
<a href="#l2.232"></a><span id="l2.232">   var newValue = gEncryptionChoices.value;</span>
<a href="#l2.233"></a><span id="l2.233">   gHiddenEncryptionPolicy.setAttribute(&quot;value&quot;, newValue);</span>
<a href="#l2.234"></a><span id="l2.234">   gIdentity.setIntAttribute(&quot;encryptionpolicy&quot;, newValue);</span>
<a href="#l2.235"></a><span id="l2.235"> </span>
<a href="#l2.236"></a><span id="l2.236">   if (MailConstants.MOZ_OPENPGP &amp;&amp; BondOpenPGP.allDependenciesLoaded()) {</span>
<a href="#l2.237"></a><span id="l2.237">     newValue = gTechChoices.value;</span>
<a href="#l2.238"></a><span id="l2.238">     gHiddenTechPref.setAttribute(&quot;value&quot;, newValue);</span>
<a href="#l2.239"></a><span id="l2.239">     gIdentity.setIntAttribute(&quot;e2etechpref&quot;, newValue);</span>
<a href="#l2.240"></a><span id="l2.240">   }</span>
<a href="#l2.241"></a><span id="l2.241"> </span>
<a href="#l2.242"></a><span id="l2.242" class="difflineminus">-  if (MailConstants.MOZ_OPENPGP &amp;&amp; BondOpenPGP.allDependenciesLoaded()) {</span>
<a href="#l2.243"></a><span id="l2.243" class="difflineminus">-    gIdentity.setUnicharAttribute(&quot;openpgp_key_id&quot;, gKeyId.value);</span>
<a href="#l2.244"></a><span id="l2.244" class="difflineminus">-  }</span>
<a href="#l2.245"></a><span id="l2.245">   gIdentity.setUnicharAttribute(</span>
<a href="#l2.246"></a><span id="l2.246">     &quot;encryption_cert_name&quot;,</span>
<a href="#l2.247"></a><span id="l2.247">     gEncryptionCertName.displayName || gEncryptionCertName.value</span>
<a href="#l2.248"></a><span id="l2.248">   );</span>
<a href="#l2.249"></a><span id="l2.249">   gIdentity.setCharAttribute(</span>
<a href="#l2.250"></a><span id="l2.250">     &quot;encryption_cert_dbkey&quot;,</span>
<a href="#l2.251"></a><span id="l2.251">     gEncryptionCertName.dbKey</span>
<a href="#l2.252"></a><span id="l2.252">   );</span>
<a href="#l2.253"></a><span id="l2.253" class="difflineat">@@ -296,58 +361,16 @@ function checkOtherCert(</span>
<a href="#l2.254"></a><span id="l2.254">   if (userWantsSameCert) {</span>
<a href="#l2.255"></a><span id="l2.255">     otherCertInfo.value = cert.displayName + &quot; [&quot; + cert.serialNumber + &quot;]&quot;;</span>
<a href="#l2.256"></a><span id="l2.256">     otherCertInfo.displayName = cert.displayName;</span>
<a href="#l2.257"></a><span id="l2.257">     otherCertInfo.dbKey = cert.dbKey;</span>
<a href="#l2.258"></a><span id="l2.258">     enabler(true);</span>
<a href="#l2.259"></a><span id="l2.259">   }</span>
<a href="#l2.260"></a><span id="l2.260"> }</span>
<a href="#l2.261"></a><span id="l2.261"> </span>
<a href="#l2.262"></a><span id="l2.262" class="difflineminus">-function pgpSelectKey(pgp_key) {</span>
<a href="#l2.263"></a><span id="l2.263" class="difflineminus">-  if (!MailConstants.MOZ_OPENPGP || !BondOpenPGP.allDependenciesLoaded()) {</span>
<a href="#l2.264"></a><span id="l2.264" class="difflineminus">-    return;</span>
<a href="#l2.265"></a><span id="l2.265" class="difflineminus">-  }</span>
<a href="#l2.266"></a><span id="l2.266" class="difflineminus">-</span>
<a href="#l2.267"></a><span id="l2.267" class="difflineminus">-  var keyInfo = document.getElementById(pgp_key);</span>
<a href="#l2.268"></a><span id="l2.268" class="difflineminus">-  if (!keyInfo) {</span>
<a href="#l2.269"></a><span id="l2.269" class="difflineminus">-    return;</span>
<a href="#l2.270"></a><span id="l2.270" class="difflineminus">-  }</span>
<a href="#l2.271"></a><span id="l2.271" class="difflineminus">-</span>
<a href="#l2.272"></a><span id="l2.272" class="difflineminus">-  let result = {};</span>
<a href="#l2.273"></a><span id="l2.273" class="difflineminus">-  EnigmailKeyRing.getAllSecretKeysByEmail(gIdentity.email, result);</span>
<a href="#l2.274"></a><span id="l2.274" class="difflineminus">-</span>
<a href="#l2.275"></a><span id="l2.275" class="difflineminus">-  let params = {</span>
<a href="#l2.276"></a><span id="l2.276" class="difflineminus">-    keys: result.all,</span>
<a href="#l2.277"></a><span id="l2.277" class="difflineminus">-    identity: gIdentity.fullAddress,</span>
<a href="#l2.278"></a><span id="l2.278" class="difflineminus">-    canceled: true,</span>
<a href="#l2.279"></a><span id="l2.279" class="difflineminus">-    index: -1,</span>
<a href="#l2.280"></a><span id="l2.280" class="difflineminus">-  };</span>
<a href="#l2.281"></a><span id="l2.281" class="difflineminus">-</span>
<a href="#l2.282"></a><span id="l2.282" class="difflineminus">-  window.browsingContext.topChromeWindow.openDialog(</span>
<a href="#l2.283"></a><span id="l2.283" class="difflineminus">-    &quot;chrome://openpgp/content/ui/keyPicker.xhtml&quot;,</span>
<a href="#l2.284"></a><span id="l2.284" class="difflineminus">-    &quot;&quot;,</span>
<a href="#l2.285"></a><span id="l2.285" class="difflineminus">-    &quot;dialog,close,titlebar,modal,resizable&quot;,</span>
<a href="#l2.286"></a><span id="l2.286" class="difflineminus">-    params</span>
<a href="#l2.287"></a><span id="l2.287" class="difflineminus">-  );</span>
<a href="#l2.288"></a><span id="l2.288" class="difflineminus">-</span>
<a href="#l2.289"></a><span id="l2.289" class="difflineminus">-  if (params.canceled) {</span>
<a href="#l2.290"></a><span id="l2.290" class="difflineminus">-    return;</span>
<a href="#l2.291"></a><span id="l2.291" class="difflineminus">-  }</span>
<a href="#l2.292"></a><span id="l2.292" class="difflineminus">-</span>
<a href="#l2.293"></a><span id="l2.293" class="difflineminus">-  keyInfo.value = result.all[params.index].keyId;</span>
<a href="#l2.294"></a><span id="l2.294" class="difflineminus">-  keyInfo.displayName = result.all[params.index].keyId;</span>
<a href="#l2.295"></a><span id="l2.295" class="difflineminus">-</span>
<a href="#l2.296"></a><span id="l2.296" class="difflineminus">-  enableEncryptionControls(true);</span>
<a href="#l2.297"></a><span id="l2.297" class="difflineminus">-  enableSigningControls(true);</span>
<a href="#l2.298"></a><span id="l2.298" class="difflineminus">-</span>
<a href="#l2.299"></a><span id="l2.299" class="difflineminus">-  updateTechPref();</span>
<a href="#l2.300"></a><span id="l2.300" class="difflineminus">-  enableSelectButtons();</span>
<a href="#l2.301"></a><span id="l2.301" class="difflineminus">-  onSave();</span>
<a href="#l2.302"></a><span id="l2.302" class="difflineminus">-}</span>
<a href="#l2.303"></a><span id="l2.303" class="difflineminus">-</span>
<a href="#l2.304"></a><span id="l2.304"> function smimeSelectCert(smime_cert) {</span>
<a href="#l2.305"></a><span id="l2.305">   var certInfo = document.getElementById(smime_cert);</span>
<a href="#l2.306"></a><span id="l2.306">   if (!certInfo) {</span>
<a href="#l2.307"></a><span id="l2.307">     return;</span>
<a href="#l2.308"></a><span id="l2.308">   }</span>
<a href="#l2.309"></a><span id="l2.309"> </span>
<a href="#l2.310"></a><span id="l2.310">   var picker = Cc[&quot;@mozilla.org/user_cert_picker;1&quot;].createInstance(</span>
<a href="#l2.311"></a><span id="l2.311">     Ci.nsIUserCertPicker</span>
<a href="#l2.312"></a><span id="l2.312" class="difflineat">@@ -458,64 +481,32 @@ function enableSelectButtons() {</span>
<a href="#l2.313"></a><span id="l2.313">   document.getElementById(</span>
<a href="#l2.314"></a><span id="l2.314">     &quot;signingCertClearButton&quot;</span>
<a href="#l2.315"></a><span id="l2.315">   ).disabled = !gSignCertName.value;</span>
<a href="#l2.316"></a><span id="l2.316"> </span>
<a href="#l2.317"></a><span id="l2.317">   gEncryptionCertName.disabled = !gEncryptionCertName.value;</span>
<a href="#l2.318"></a><span id="l2.318">   document.getElementById(</span>
<a href="#l2.319"></a><span id="l2.319">     &quot;encryptionCertClearButton&quot;</span>
<a href="#l2.320"></a><span id="l2.320">   ).disabled = !gEncryptionCertName.value;</span>
<a href="#l2.321"></a><span id="l2.321" class="difflineminus">-</span>
<a href="#l2.322"></a><span id="l2.322" class="difflineminus">-  if (MailConstants.MOZ_OPENPGP &amp;&amp; BondOpenPGP.allDependenciesLoaded()) {</span>
<a href="#l2.323"></a><span id="l2.323" class="difflineminus">-    gKeyId.disabled = !gKeyId.value;</span>
<a href="#l2.324"></a><span id="l2.324" class="difflineminus">-    document.getElementById(&quot;openpgpKeyClearButton&quot;).disabled = !gKeyId.value;</span>
<a href="#l2.325"></a><span id="l2.325" class="difflineminus">-  }</span>
<a href="#l2.326"></a><span id="l2.326" class="difflineminus">-}</span>
<a href="#l2.327"></a><span id="l2.327" class="difflineminus">-</span>
<a href="#l2.328"></a><span id="l2.328" class="difflineminus">-function pgpClearKey(pgp_key) {</span>
<a href="#l2.329"></a><span id="l2.329" class="difflineminus">-  if (!MailConstants.MOZ_OPENPGP || !BondOpenPGP.allDependenciesLoaded()) {</span>
<a href="#l2.330"></a><span id="l2.330" class="difflineminus">-    return;</span>
<a href="#l2.331"></a><span id="l2.331" class="difflineminus">-  }</span>
<a href="#l2.332"></a><span id="l2.332" class="difflineminus">-  var keyInfo = document.getElementById(pgp_key);</span>
<a href="#l2.333"></a><span id="l2.333" class="difflineminus">-  if (!keyInfo) {</span>
<a href="#l2.334"></a><span id="l2.334" class="difflineminus">-    return;</span>
<a href="#l2.335"></a><span id="l2.335" class="difflineminus">-  }</span>
<a href="#l2.336"></a><span id="l2.336" class="difflineminus">-</span>
<a href="#l2.337"></a><span id="l2.337" class="difflineminus">-  keyInfo.disabled = true;</span>
<a href="#l2.338"></a><span id="l2.338" class="difflineminus">-  keyInfo.value = &quot;&quot;;</span>
<a href="#l2.339"></a><span id="l2.339" class="difflineminus">-</span>
<a href="#l2.340"></a><span id="l2.340" class="difflineminus">-  let stillHaveOtherSigning = gSignCertName &amp;&amp; gSignCertName.value;</span>
<a href="#l2.341"></a><span id="l2.341" class="difflineminus">-  let stillHaveOtherEncryption =</span>
<a href="#l2.342"></a><span id="l2.342" class="difflineminus">-    gEncryptionCertName &amp;&amp; gEncryptionCertName.value;</span>
<a href="#l2.343"></a><span id="l2.343" class="difflineminus">-</span>
<a href="#l2.344"></a><span id="l2.344" class="difflineminus">-  if (!stillHaveOtherEncryption) {</span>
<a href="#l2.345"></a><span id="l2.345" class="difflineminus">-    enableEncryptionControls(false);</span>
<a href="#l2.346"></a><span id="l2.346" class="difflineminus">-  }</span>
<a href="#l2.347"></a><span id="l2.347" class="difflineminus">-  if (!stillHaveOtherSigning) {</span>
<a href="#l2.348"></a><span id="l2.348" class="difflineminus">-    enableSigningControls(false);</span>
<a href="#l2.349"></a><span id="l2.349" class="difflineminus">-  }</span>
<a href="#l2.350"></a><span id="l2.350" class="difflineminus">-  updateTechPref();</span>
<a href="#l2.351"></a><span id="l2.351" class="difflineminus">-  enableSelectButtons();</span>
<a href="#l2.352"></a><span id="l2.352" class="difflineminus">-  onSave();</span>
<a href="#l2.353"></a><span id="l2.353"> }</span>
<a href="#l2.354"></a><span id="l2.354"> </span>
<a href="#l2.355"></a><span id="l2.355"> function smimeClearCert(smime_cert) {</span>
<a href="#l2.356"></a><span id="l2.356">   var certInfo = document.getElementById(smime_cert);</span>
<a href="#l2.357"></a><span id="l2.357">   if (!certInfo) {</span>
<a href="#l2.358"></a><span id="l2.358">     return;</span>
<a href="#l2.359"></a><span id="l2.359">   }</span>
<a href="#l2.360"></a><span id="l2.360"> </span>
<a href="#l2.361"></a><span id="l2.361">   certInfo.disabled = true;</span>
<a href="#l2.362"></a><span id="l2.362">   certInfo.value = &quot;&quot;;</span>
<a href="#l2.363"></a><span id="l2.363">   certInfo.displayName = &quot;&quot;;</span>
<a href="#l2.364"></a><span id="l2.364">   certInfo.dbKey = &quot;&quot;;</span>
<a href="#l2.365"></a><span id="l2.365"> </span>
<a href="#l2.366"></a><span id="l2.366">   let stillHaveOther = false;</span>
<a href="#l2.367"></a><span id="l2.367">   if (MailConstants.MOZ_OPENPGP &amp;&amp; BondOpenPGP.allDependenciesLoaded()) {</span>
<a href="#l2.368"></a><span id="l2.368" class="difflineminus">-    stillHaveOther = gKeyId &amp;&amp; gKeyId.value;</span>
<a href="#l2.369"></a><span id="l2.369" class="difflineplus">+    stillHaveOther = gKeyId != &quot;&quot;;</span>
<a href="#l2.370"></a><span id="l2.370">   }</span>
<a href="#l2.371"></a><span id="l2.371"> </span>
<a href="#l2.372"></a><span id="l2.372">   if (!stillHaveOther) {</span>
<a href="#l2.373"></a><span id="l2.373">     if (smime_cert == kEncryptionCertPref) {</span>
<a href="#l2.374"></a><span id="l2.374">       enableEncryptionControls(false);</span>
<a href="#l2.375"></a><span id="l2.375">     } else if (smime_cert == kSigningCertPref) {</span>
<a href="#l2.376"></a><span id="l2.376">       enableSigningControls(false);</span>
<a href="#l2.377"></a><span id="l2.377">     }</span>
<a href="#l2.378"></a><span id="l2.378" class="difflineat">@@ -528,17 +519,17 @@ function smimeClearCert(smime_cert) {</span>
<a href="#l2.379"></a><span id="l2.379"> </span>
<a href="#l2.380"></a><span id="l2.380"> function updateTechPref() {</span>
<a href="#l2.381"></a><span id="l2.381">   if (!MailConstants.MOZ_OPENPGP || !BondOpenPGP.allDependenciesLoaded()) {</span>
<a href="#l2.382"></a><span id="l2.382">     return;</span>
<a href="#l2.383"></a><span id="l2.383">   }</span>
<a href="#l2.384"></a><span id="l2.384"> </span>
<a href="#l2.385"></a><span id="l2.385">   let haveSigCert = gSignCertName &amp;&amp; gSignCertName.value;</span>
<a href="#l2.386"></a><span id="l2.386">   let haveEncCert = gEncryptionCertName &amp;&amp; gEncryptionCertName.value;</span>
<a href="#l2.387"></a><span id="l2.387" class="difflineminus">-  let havePgpkey = gKeyId &amp;&amp; gKeyId.value;</span>
<a href="#l2.388"></a><span id="l2.388" class="difflineplus">+  let havePgpkey = !!gKeyId;</span>
<a href="#l2.389"></a><span id="l2.389"> </span>
<a href="#l2.390"></a><span id="l2.390">   let enable = (haveSigCert || haveEncCert) &amp;&amp; havePgpkey;</span>
<a href="#l2.391"></a><span id="l2.391"> </span>
<a href="#l2.392"></a><span id="l2.392">   gTechAuto.disabled = !enable;</span>
<a href="#l2.393"></a><span id="l2.393">   gTechPrefOpenPGP.disabled = !enable;</span>
<a href="#l2.394"></a><span id="l2.394">   gTechPrefSMIME.disabled = !enable;</span>
<a href="#l2.395"></a><span id="l2.395"> </span>
<a href="#l2.396"></a><span id="l2.396">   if (!enable) {</span>
<a href="#l2.397"></a><span id="l2.397" class="difflineat">@@ -554,8 +545,528 @@ function openCertManager() {</span>
<a href="#l2.398"></a><span id="l2.398"> </span>
<a href="#l2.399"></a><span id="l2.399"> function openDeviceManager() {</span>
<a href="#l2.400"></a><span id="l2.400">   parent.gSubDialog.open(&quot;chrome://pippki/content/device_manager.xhtml&quot;);</span>
<a href="#l2.401"></a><span id="l2.401"> }</span>
<a href="#l2.402"></a><span id="l2.402"> </span>
<a href="#l2.403"></a><span id="l2.403"> function e2eOnLoadEditor() {</span>
<a href="#l2.404"></a><span id="l2.404">   e2eInitializeFields();</span>
<a href="#l2.405"></a><span id="l2.405"> }</span>
<a href="#l2.406"></a><span id="l2.406" class="difflineplus">+</span>
<a href="#l2.407"></a><span id="l2.407" class="difflineplus">+/**</span>
<a href="#l2.408"></a><span id="l2.408" class="difflineplus">+ * Open the subdialog to create or import an OpenPGP key.</span>
<a href="#l2.409"></a><span id="l2.409" class="difflineplus">+ */</span>
<a href="#l2.410"></a><span id="l2.410" class="difflineplus">+function openKeyWizard() {</span>
<a href="#l2.411"></a><span id="l2.411" class="difflineplus">+  if (!MailConstants.MOZ_OPENPGP || !BondOpenPGP.allDependenciesLoaded()) {</span>
<a href="#l2.412"></a><span id="l2.412" class="difflineplus">+    return;</span>
<a href="#l2.413"></a><span id="l2.413" class="difflineplus">+  }</span>
<a href="#l2.414"></a><span id="l2.414" class="difflineplus">+</span>
<a href="#l2.415"></a><span id="l2.415" class="difflineplus">+  let args = {</span>
<a href="#l2.416"></a><span id="l2.416" class="difflineplus">+    identity: gIdentity,</span>
<a href="#l2.417"></a><span id="l2.417" class="difflineplus">+    gSubDialog: parent.gSubDialog,</span>
<a href="#l2.418"></a><span id="l2.418" class="difflineplus">+    okCallback: keyWizardSuccess,</span>
<a href="#l2.419"></a><span id="l2.419" class="difflineplus">+  };</span>
<a href="#l2.420"></a><span id="l2.420" class="difflineplus">+  parent.gSubDialog.open(</span>
<a href="#l2.421"></a><span id="l2.421" class="difflineplus">+    &quot;chrome://openpgp/content/ui/keyWizard.xhtml&quot;,</span>
<a href="#l2.422"></a><span id="l2.422" class="difflineplus">+    null,</span>
<a href="#l2.423"></a><span id="l2.423" class="difflineplus">+    args</span>
<a href="#l2.424"></a><span id="l2.424" class="difflineplus">+  );</span>
<a href="#l2.425"></a><span id="l2.425" class="difflineplus">+}</span>
<a href="#l2.426"></a><span id="l2.426" class="difflineplus">+</span>
<a href="#l2.427"></a><span id="l2.427" class="difflineplus">+/**</span>
<a href="#l2.428"></a><span id="l2.428" class="difflineplus">+ * Show a succesfull notification after a new OpenPGP key was created, and</span>
<a href="#l2.429"></a><span id="l2.429" class="difflineplus">+ * trigger the reload of the key listing UI.</span>
<a href="#l2.430"></a><span id="l2.430" class="difflineplus">+ */</span>
<a href="#l2.431"></a><span id="l2.431" class="difflineplus">+async function keyWizardSuccess() {</span>
<a href="#l2.432"></a><span id="l2.432" class="difflineplus">+  document.l10n.setAttributes(</span>
<a href="#l2.433"></a><span id="l2.433" class="difflineplus">+    document.getElementById(&quot;openPgpNotificationDescription&quot;),</span>
<a href="#l2.434"></a><span id="l2.434" class="difflineplus">+    &quot;openpgp-keygen-success&quot;</span>
<a href="#l2.435"></a><span id="l2.435" class="difflineplus">+  );</span>
<a href="#l2.436"></a><span id="l2.436" class="difflineplus">+  document.getElementById(&quot;openPgpNotification&quot;).collapsed = false;</span>
<a href="#l2.437"></a><span id="l2.437" class="difflineplus">+  document.getElementById(&quot;openPgpKeyList&quot;).collapsed = false;</span>
<a href="#l2.438"></a><span id="l2.438" class="difflineplus">+</span>
<a href="#l2.439"></a><span id="l2.439" class="difflineplus">+  // Update the global key with the recently generated key that was assigned to</span>
<a href="#l2.440"></a><span id="l2.440" class="difflineplus">+  // this identity from the Key generation wizard.</span>
<a href="#l2.441"></a><span id="l2.441" class="difflineplus">+  gKeyId = gIdentity.getUnicharAttribute(&quot;openpgp_key_id&quot;);</span>
<a href="#l2.442"></a><span id="l2.442" class="difflineplus">+</span>
<a href="#l2.443"></a><span id="l2.443" class="difflineplus">+  reloadOpenPgpUI();</span>
<a href="#l2.444"></a><span id="l2.444" class="difflineplus">+}</span>
<a href="#l2.445"></a><span id="l2.445" class="difflineplus">+</span>
<a href="#l2.446"></a><span id="l2.446" class="difflineplus">+/**</span>
<a href="#l2.447"></a><span id="l2.447" class="difflineplus">+ * Collapse the inline notification.</span>
<a href="#l2.448"></a><span id="l2.448" class="difflineplus">+ */</span>
<a href="#l2.449"></a><span id="l2.449" class="difflineplus">+function closeNotification() {</span>
<a href="#l2.450"></a><span id="l2.450" class="difflineplus">+  document.getElementById(&quot;openPgpNotification&quot;).collapsed = true;</span>
<a href="#l2.451"></a><span id="l2.451" class="difflineplus">+}</span>
<a href="#l2.452"></a><span id="l2.452" class="difflineplus">+</span>
<a href="#l2.453"></a><span id="l2.453" class="difflineplus">+/**</span>
<a href="#l2.454"></a><span id="l2.454" class="difflineplus">+ * Refresh the UI on init or after a successful OpenPGP Key generation.</span>
<a href="#l2.455"></a><span id="l2.455" class="difflineplus">+ */</span>
<a href="#l2.456"></a><span id="l2.456" class="difflineplus">+async function reloadOpenPgpUI() {</span>
<a href="#l2.457"></a><span id="l2.457" class="difflineplus">+  let result = {};</span>
<a href="#l2.458"></a><span id="l2.458" class="difflineplus">+  EnigmailKeyRing.getAllSecretKeysByEmail(gIdentity.email, result);</span>
<a href="#l2.459"></a><span id="l2.459" class="difflineplus">+</span>
<a href="#l2.460"></a><span id="l2.460" class="difflineplus">+  // Show the radiogroup only if the current identity has keys.</span>
<a href="#l2.461"></a><span id="l2.461" class="difflineplus">+  document.getElementById(&quot;openPgpKeyList&quot;).collapsed = !result.all.length;</span>
<a href="#l2.462"></a><span id="l2.462" class="difflineplus">+</span>
<a href="#l2.463"></a><span id="l2.463" class="difflineplus">+  // Interrupt and udpate the UI accordingly if no Key is associated with the</span>
<a href="#l2.464"></a><span id="l2.464" class="difflineplus">+  // current identity.</span>
<a href="#l2.465"></a><span id="l2.465" class="difflineplus">+  if (!result.all.length) {</span>
<a href="#l2.466"></a><span id="l2.466" class="difflineplus">+    // Hide the selection status.</span>
<a href="#l2.467"></a><span id="l2.467" class="difflineplus">+    document</span>
<a href="#l2.468"></a><span id="l2.468" class="difflineplus">+      .getElementById(&quot;openPgpgSelectionStatus&quot;)</span>
<a href="#l2.469"></a><span id="l2.469" class="difflineplus">+      .setAttribute(&quot;hidden&quot;, &quot;hidden&quot;);</span>
<a href="#l2.470"></a><span id="l2.470" class="difflineplus">+</span>
<a href="#l2.471"></a><span id="l2.471" class="difflineplus">+    // Hide the learn more link.</span>
<a href="#l2.472"></a><span id="l2.472" class="difflineplus">+    document.getElementById(&quot;openPgpLearnMore&quot;).setAttribute(&quot;hidden&quot;, &quot;true&quot;);</span>
<a href="#l2.473"></a><span id="l2.473" class="difflineplus">+</span>
<a href="#l2.474"></a><span id="l2.474" class="difflineplus">+    gKeyId = null;</span>
<a href="#l2.475"></a><span id="l2.475" class="difflineplus">+    highlightOpenPgpKey();</span>
<a href="#l2.476"></a><span id="l2.476" class="difflineplus">+    return;</span>
<a href="#l2.477"></a><span id="l2.477" class="difflineplus">+  }</span>
<a href="#l2.478"></a><span id="l2.478" class="difflineplus">+</span>
<a href="#l2.479"></a><span id="l2.479" class="difflineplus">+  document.l10n.setAttributes(</span>
<a href="#l2.480"></a><span id="l2.480" class="difflineplus">+    document.getElementById(&quot;openPgpgDescription&quot;),</span>
<a href="#l2.481"></a><span id="l2.481" class="difflineplus">+    &quot;openpgp-description&quot;,</span>
<a href="#l2.482"></a><span id="l2.482" class="difflineplus">+    {</span>
<a href="#l2.483"></a><span id="l2.483" class="difflineplus">+      count: result.all.length,</span>
<a href="#l2.484"></a><span id="l2.484" class="difflineplus">+      identity: gIdentity.email,</span>
<a href="#l2.485"></a><span id="l2.485" class="difflineplus">+    }</span>
<a href="#l2.486"></a><span id="l2.486" class="difflineplus">+  );</span>
<a href="#l2.487"></a><span id="l2.487" class="difflineplus">+</span>
<a href="#l2.488"></a><span id="l2.488" class="difflineplus">+  let status = document.getElementById(&quot;openPgpgSelectionStatus&quot;);</span>
<a href="#l2.489"></a><span id="l2.489" class="difflineplus">+  status.removeAttribute(&quot;hidden&quot;);</span>
<a href="#l2.490"></a><span id="l2.490" class="difflineplus">+</span>
<a href="#l2.491"></a><span id="l2.491" class="difflineplus">+  document.l10n.setAttributes(status, &quot;openpgp-selection-status&quot;, {</span>
<a href="#l2.492"></a><span id="l2.492" class="difflineplus">+    count: gKeyId ? 1 : 0,</span>
<a href="#l2.493"></a><span id="l2.493" class="difflineplus">+    key: `0x${gKeyId}`,</span>
<a href="#l2.494"></a><span id="l2.494" class="difflineplus">+  });</span>
<a href="#l2.495"></a><span id="l2.495" class="difflineplus">+</span>
<a href="#l2.496"></a><span id="l2.496" class="difflineplus">+  document.getElementById(&quot;openPgpLearnMore&quot;).removeAttribute(&quot;hidden&quot;);</span>
<a href="#l2.497"></a><span id="l2.497" class="difflineplus">+</span>
<a href="#l2.498"></a><span id="l2.498" class="difflineplus">+  let radiogroup = document.getElementById(&quot;openPgpKeyListRadio&quot;);</span>
<a href="#l2.499"></a><span id="l2.499" class="difflineplus">+</span>
<a href="#l2.500"></a><span id="l2.500" class="difflineplus">+  // Remove all the previously generated radio options, except the first.</span>
<a href="#l2.501"></a><span id="l2.501" class="difflineplus">+  while (radiogroup.lastChild.id != &quot;openPgpOptionNone&quot;) {</span>
<a href="#l2.502"></a><span id="l2.502" class="difflineplus">+    radiogroup.removeChild(radiogroup.lastChild);</span>
<a href="#l2.503"></a><span id="l2.503" class="difflineplus">+  }</span>
<a href="#l2.504"></a><span id="l2.504" class="difflineplus">+</span>
<a href="#l2.505"></a><span id="l2.505" class="difflineplus">+  // List all the available keys.</span>
<a href="#l2.506"></a><span id="l2.506" class="difflineplus">+  for (let key of result.all) {</span>
<a href="#l2.507"></a><span id="l2.507" class="difflineplus">+    let container = document.createXULElement(&quot;vbox&quot;);</span>
<a href="#l2.508"></a><span id="l2.508" class="difflineplus">+    container.id = `openPgpOption${key.keyId}`;</span>
<a href="#l2.509"></a><span id="l2.509" class="difflineplus">+    container.classList.add(&quot;content-blocking-category&quot;);</span>
<a href="#l2.510"></a><span id="l2.510" class="difflineplus">+</span>
<a href="#l2.511"></a><span id="l2.511" class="difflineplus">+    let box = document.createXULElement(&quot;hbox&quot;);</span>
<a href="#l2.512"></a><span id="l2.512" class="difflineplus">+</span>
<a href="#l2.513"></a><span id="l2.513" class="difflineplus">+    let radio = document.createXULElement(&quot;radio&quot;);</span>
<a href="#l2.514"></a><span id="l2.514" class="difflineplus">+    radio.setAttribute(&quot;flex&quot;, &quot;1&quot;);</span>
<a href="#l2.515"></a><span id="l2.515" class="difflineplus">+    radio.id = `openPgp${key.keyId}`;</span>
<a href="#l2.516"></a><span id="l2.516" class="difflineplus">+    radio.value = key.keyId;</span>
<a href="#l2.517"></a><span id="l2.517" class="difflineplus">+    radio.label = `0x${key.keyId}`;</span>
<a href="#l2.518"></a><span id="l2.518" class="difflineplus">+</span>
<a href="#l2.519"></a><span id="l2.519" class="difflineplus">+    if (key.keyId == gIdentity.getUnicharAttribute(&quot;openpgp_key_id&quot;)) {</span>
<a href="#l2.520"></a><span id="l2.520" class="difflineplus">+      radio.setAttribute(&quot;selected&quot;, &quot;true&quot;);</span>
<a href="#l2.521"></a><span id="l2.521" class="difflineplus">+    }</span>
<a href="#l2.522"></a><span id="l2.522" class="difflineplus">+</span>
<a href="#l2.523"></a><span id="l2.523" class="difflineplus">+    let toggle = document.createXULElement(&quot;button&quot;);</span>
<a href="#l2.524"></a><span id="l2.524" class="difflineplus">+    toggle.classList.add(&quot;arrowhead&quot;);</span>
<a href="#l2.525"></a><span id="l2.525" class="difflineplus">+    toggle.setAttribute(&quot;aria-expanded&quot;, &quot;false&quot;);</span>
<a href="#l2.526"></a><span id="l2.526" class="difflineplus">+    document.l10n.setAttributes(toggle, &quot;openpgp-key-expand-section&quot;);</span>
<a href="#l2.527"></a><span id="l2.527" class="difflineplus">+    toggle.addEventListener(&quot;command&quot;, toggleExpansion);</span>
<a href="#l2.528"></a><span id="l2.528" class="difflineplus">+</span>
<a href="#l2.529"></a><span id="l2.529" class="difflineplus">+    box.appendChild(radio);</span>
<a href="#l2.530"></a><span id="l2.530" class="difflineplus">+    box.appendChild(toggle);</span>
<a href="#l2.531"></a><span id="l2.531" class="difflineplus">+</span>
<a href="#l2.532"></a><span id="l2.532" class="difflineplus">+    let indent = document.createXULElement(&quot;vbox&quot;);</span>
<a href="#l2.533"></a><span id="l2.533" class="difflineplus">+    indent.classList.add(&quot;indent&quot;);</span>
<a href="#l2.534"></a><span id="l2.534" class="difflineplus">+</span>
<a href="#l2.535"></a><span id="l2.535" class="difflineplus">+    let dateContainer = document.createXULElement(&quot;hbox&quot;);</span>
<a href="#l2.536"></a><span id="l2.536" class="difflineplus">+    dateContainer.classList.add(&quot;expiration-date-container&quot;);</span>
<a href="#l2.537"></a><span id="l2.537" class="difflineplus">+    dateContainer.setAttribute(&quot;align&quot;, &quot;center&quot;);</span>
<a href="#l2.538"></a><span id="l2.538" class="difflineplus">+</span>
<a href="#l2.539"></a><span id="l2.539" class="difflineplus">+    let dateIcon = document.createXULElement(&quot;image&quot;);</span>
<a href="#l2.540"></a><span id="l2.540" class="difflineplus">+    dateIcon.classList.add(&quot;expiration-date-icon&quot;);</span>
<a href="#l2.541"></a><span id="l2.541" class="difflineplus">+</span>
<a href="#l2.542"></a><span id="l2.542" class="difflineplus">+    let dateButton = document.createXULElement(&quot;button&quot;);</span>
<a href="#l2.543"></a><span id="l2.543" class="difflineplus">+    document.l10n.setAttributes(dateButton, &quot;openpgp-key-man-change-expiry&quot;);</span>
<a href="#l2.544"></a><span id="l2.544" class="difflineplus">+    dateButton.addEventListener(&quot;command&quot;, enigmailEditKeyDate);</span>
<a href="#l2.545"></a><span id="l2.545" class="difflineplus">+    dateButton.setAttribute(&quot;hidden&quot;, &quot;true&quot;);</span>
<a href="#l2.546"></a><span id="l2.546" class="difflineplus">+    dateButton.classList.add(&quot;expiration-date-button&quot;);</span>
<a href="#l2.547"></a><span id="l2.547" class="difflineplus">+</span>
<a href="#l2.548"></a><span id="l2.548" class="difflineplus">+    let today = new Date();</span>
<a href="#l2.549"></a><span id="l2.549" class="difflineplus">+    today.setMonth(today.getMonth() + 6);</span>
<a href="#l2.550"></a><span id="l2.550" class="difflineplus">+</span>
<a href="#l2.551"></a><span id="l2.551" class="difflineplus">+    // If the key expires in less than 6 months.</span>
<a href="#l2.552"></a><span id="l2.552" class="difflineplus">+    if (</span>
<a href="#l2.553"></a><span id="l2.553" class="difflineplus">+      key.expiryTime &amp;&amp;</span>
<a href="#l2.554"></a><span id="l2.554" class="difflineplus">+      Math.round(Date.parse(today) / 1000) &gt; key.expiryTime</span>
<a href="#l2.555"></a><span id="l2.555" class="difflineplus">+    ) {</span>
<a href="#l2.556"></a><span id="l2.556" class="difflineplus">+      dateContainer.classList.add(&quot;key-is-expiring&quot;);</span>
<a href="#l2.557"></a><span id="l2.557" class="difflineplus">+      document.l10n.setAttributes(dateIcon, &quot;openpgp-key-expires-image&quot;);</span>
<a href="#l2.558"></a><span id="l2.558" class="difflineplus">+      dateButton.removeAttribute(&quot;hidden&quot;);</span>
<a href="#l2.559"></a><span id="l2.559" class="difflineplus">+    }</span>
<a href="#l2.560"></a><span id="l2.560" class="difflineplus">+</span>
<a href="#l2.561"></a><span id="l2.561" class="difflineplus">+    let fluentExpireKey = &quot;openpgp-radio-key-expires&quot;;</span>
<a href="#l2.562"></a><span id="l2.562" class="difflineplus">+    // If the key passed its expiration date.</span>
<a href="#l2.563"></a><span id="l2.563" class="difflineplus">+    if (key.expiryTime &amp;&amp; Math.round(Date.now() / 1000) &gt; key.expiryTime) {</span>
<a href="#l2.564"></a><span id="l2.564" class="difflineplus">+      dateContainer.classList.add(&quot;key-expired&quot;);</span>
<a href="#l2.565"></a><span id="l2.565" class="difflineplus">+      fluentExpireKey = &quot;openpgp-radio-key-expired&quot;;</span>
<a href="#l2.566"></a><span id="l2.566" class="difflineplus">+      document.l10n.setAttributes(dateIcon, &quot;openpgp-key-expired-image&quot;);</span>
<a href="#l2.567"></a><span id="l2.567" class="difflineplus">+      dateButton.removeAttribute(&quot;hidden&quot;);</span>
<a href="#l2.568"></a><span id="l2.568" class="difflineplus">+    }</span>
<a href="#l2.569"></a><span id="l2.569" class="difflineplus">+</span>
<a href="#l2.570"></a><span id="l2.570" class="difflineplus">+    let description = document.createXULElement(&quot;description&quot;);</span>
<a href="#l2.571"></a><span id="l2.571" class="difflineplus">+    if (key.expiryTime) {</span>
<a href="#l2.572"></a><span id="l2.572" class="difflineplus">+      document.l10n.setAttributes(description, fluentExpireKey, {</span>
<a href="#l2.573"></a><span id="l2.573" class="difflineplus">+        date: key.expiry,</span>
<a href="#l2.574"></a><span id="l2.574" class="difflineplus">+      });</span>
<a href="#l2.575"></a><span id="l2.575" class="difflineplus">+    } else {</span>
<a href="#l2.576"></a><span id="l2.576" class="difflineplus">+      document.l10n.setAttributes(description, &quot;key-does-not-expire&quot;);</span>
<a href="#l2.577"></a><span id="l2.577" class="difflineplus">+    }</span>
<a href="#l2.578"></a><span id="l2.578" class="difflineplus">+</span>
<a href="#l2.579"></a><span id="l2.579" class="difflineplus">+    dateContainer.appendChild(dateIcon);</span>
<a href="#l2.580"></a><span id="l2.580" class="difflineplus">+    dateContainer.appendChild(description);</span>
<a href="#l2.581"></a><span id="l2.581" class="difflineplus">+    dateContainer.appendChild(dateButton);</span>
<a href="#l2.582"></a><span id="l2.582" class="difflineplus">+</span>
<a href="#l2.583"></a><span id="l2.583" class="difflineplus">+    let hiddenContainer = document.createXULElement(&quot;vbox&quot;);</span>
<a href="#l2.584"></a><span id="l2.584" class="difflineplus">+    hiddenContainer.classList.add(</span>
<a href="#l2.585"></a><span id="l2.585" class="difflineplus">+      &quot;content-blocking-extra-information&quot;,</span>
<a href="#l2.586"></a><span id="l2.586" class="difflineplus">+      &quot;indent&quot;</span>
<a href="#l2.587"></a><span id="l2.587" class="difflineplus">+    );</span>
<a href="#l2.588"></a><span id="l2.588" class="difflineplus">+</span>
<a href="#l2.589"></a><span id="l2.589" class="difflineplus">+    // Start key info section.</span>
<a href="#l2.590"></a><span id="l2.590" class="difflineplus">+</span>
<a href="#l2.591"></a><span id="l2.591" class="difflineplus">+    // Key type.</span>
<a href="#l2.592"></a><span id="l2.592" class="difflineplus">+    let grid = document.createXULElement(&quot;hbox&quot;);</span>
<a href="#l2.593"></a><span id="l2.593" class="difflineplus">+    grid.classList.add(&quot;extra-information-label&quot;);</span>
<a href="#l2.594"></a><span id="l2.594" class="difflineplus">+</span>
<a href="#l2.595"></a><span id="l2.595" class="difflineplus">+    let typeImage = document.createXULElement(&quot;image&quot;);</span>
<a href="#l2.596"></a><span id="l2.596" class="difflineplus">+    typeImage.classList.add(&quot;content-blocking-openpgp-type&quot;);</span>
<a href="#l2.597"></a><span id="l2.597" class="difflineplus">+</span>
<a href="#l2.598"></a><span id="l2.598" class="difflineplus">+    let typeLabel = document.createXULElement(&quot;label&quot;);</span>
<a href="#l2.599"></a><span id="l2.599" class="difflineplus">+    document.l10n.setAttributes(</span>
<a href="#l2.600"></a><span id="l2.600" class="difflineplus">+      typeLabel,</span>
<a href="#l2.601"></a><span id="l2.601" class="difflineplus">+      &quot;openpgp-key-details-key-type-label&quot;</span>
<a href="#l2.602"></a><span id="l2.602" class="difflineplus">+    );</span>
<a href="#l2.603"></a><span id="l2.603" class="difflineplus">+    typeLabel.classList.add(&quot;extra-information-label-type&quot;);</span>
<a href="#l2.604"></a><span id="l2.604" class="difflineplus">+</span>
<a href="#l2.605"></a><span id="l2.605" class="difflineplus">+    let typeValueContainer = document.createXULElement(&quot;hbox&quot;);</span>
<a href="#l2.606"></a><span id="l2.606" class="difflineplus">+    typeValueContainer.classList.add(&quot;input-container&quot;);</span>
<a href="#l2.607"></a><span id="l2.607" class="difflineplus">+    typeValueContainer.setAttribute(&quot;flex&quot;, &quot;1&quot;);</span>
<a href="#l2.608"></a><span id="l2.608" class="difflineplus">+</span>
<a href="#l2.609"></a><span id="l2.609" class="difflineplus">+    let typeValue = document.createElement(&quot;input&quot;);</span>
<a href="#l2.610"></a><span id="l2.610" class="difflineplus">+    typeValue.setAttribute(&quot;type&quot;, &quot;text&quot;);</span>
<a href="#l2.611"></a><span id="l2.611" class="difflineplus">+    typeValue.classList.add(&quot;plain&quot;);</span>
<a href="#l2.612"></a><span id="l2.612" class="difflineplus">+    typeValue.setAttribute(&quot;readonly&quot;, &quot;readonly&quot;);</span>
<a href="#l2.613"></a><span id="l2.613" class="difflineplus">+    typeValue.value = await document.l10n.formatValue(&quot;key-type-pair-2&quot;);</span>
<a href="#l2.614"></a><span id="l2.614" class="difflineplus">+</span>
<a href="#l2.615"></a><span id="l2.615" class="difflineplus">+    typeValueContainer.appendChild(typeValue);</span>
<a href="#l2.616"></a><span id="l2.616" class="difflineplus">+</span>
<a href="#l2.617"></a><span id="l2.617" class="difflineplus">+    grid.appendChild(typeImage);</span>
<a href="#l2.618"></a><span id="l2.618" class="difflineplus">+    grid.appendChild(typeLabel);</span>
<a href="#l2.619"></a><span id="l2.619" class="difflineplus">+    grid.appendChild(typeValueContainer);</span>
<a href="#l2.620"></a><span id="l2.620" class="difflineplus">+</span>
<a href="#l2.621"></a><span id="l2.621" class="difflineplus">+    // Key fingerprint.</span>
<a href="#l2.622"></a><span id="l2.622" class="difflineplus">+    let fingerprintImage = document.createXULElement(&quot;image&quot;);</span>
<a href="#l2.623"></a><span id="l2.623" class="difflineplus">+    fingerprintImage.classList.add(&quot;content-blocking-openpgp-fingerprint&quot;);</span>
<a href="#l2.624"></a><span id="l2.624" class="difflineplus">+</span>
<a href="#l2.625"></a><span id="l2.625" class="difflineplus">+    let fingerprintLabel = document.createXULElement(&quot;label&quot;);</span>
<a href="#l2.626"></a><span id="l2.626" class="difflineplus">+    document.l10n.setAttributes(</span>
<a href="#l2.627"></a><span id="l2.627" class="difflineplus">+      fingerprintLabel,</span>
<a href="#l2.628"></a><span id="l2.628" class="difflineplus">+      &quot;openpgp-key-details-fingerprint-label&quot;</span>
<a href="#l2.629"></a><span id="l2.629" class="difflineplus">+    );</span>
<a href="#l2.630"></a><span id="l2.630" class="difflineplus">+    fingerprintLabel.classList.add(&quot;extra-information-label-type&quot;);</span>
<a href="#l2.631"></a><span id="l2.631" class="difflineplus">+</span>
<a href="#l2.632"></a><span id="l2.632" class="difflineplus">+    let fgrInputContainer = document.createXULElement(&quot;hbox&quot;);</span>
<a href="#l2.633"></a><span id="l2.633" class="difflineplus">+    fgrInputContainer.classList.add(&quot;input-container&quot;);</span>
<a href="#l2.634"></a><span id="l2.634" class="difflineplus">+    fgrInputContainer.setAttribute(&quot;flex&quot;, &quot;1&quot;);</span>
<a href="#l2.635"></a><span id="l2.635" class="difflineplus">+</span>
<a href="#l2.636"></a><span id="l2.636" class="difflineplus">+    let fingerprintInput = document.createElement(&quot;input&quot;);</span>
<a href="#l2.637"></a><span id="l2.637" class="difflineplus">+    fingerprintInput.setAttribute(&quot;type&quot;, &quot;text&quot;);</span>
<a href="#l2.638"></a><span id="l2.638" class="difflineplus">+    fingerprintInput.classList.add(&quot;plain&quot;);</span>
<a href="#l2.639"></a><span id="l2.639" class="difflineplus">+    fingerprintInput.setAttribute(&quot;readonly&quot;, &quot;readonly&quot;);</span>
<a href="#l2.640"></a><span id="l2.640" class="difflineplus">+    fingerprintInput.value = EnigmailKey.formatFpr(key.fpr);</span>
<a href="#l2.641"></a><span id="l2.641" class="difflineplus">+</span>
<a href="#l2.642"></a><span id="l2.642" class="difflineplus">+    fgrInputContainer.appendChild(fingerprintInput);</span>
<a href="#l2.643"></a><span id="l2.643" class="difflineplus">+</span>
<a href="#l2.644"></a><span id="l2.644" class="difflineplus">+    grid.appendChild(fingerprintImage);</span>
<a href="#l2.645"></a><span id="l2.645" class="difflineplus">+    grid.appendChild(fingerprintLabel);</span>
<a href="#l2.646"></a><span id="l2.646" class="difflineplus">+    grid.appendChild(fgrInputContainer);</span>
<a href="#l2.647"></a><span id="l2.647" class="difflineplus">+</span>
<a href="#l2.648"></a><span id="l2.648" class="difflineplus">+    // Key creation date.</span>
<a href="#l2.649"></a><span id="l2.649" class="difflineplus">+    let createdImage = document.createXULElement(&quot;image&quot;);</span>
<a href="#l2.650"></a><span id="l2.650" class="difflineplus">+    createdImage.classList.add(&quot;content-blocking-openpgp-created&quot;);</span>
<a href="#l2.651"></a><span id="l2.651" class="difflineplus">+</span>
<a href="#l2.652"></a><span id="l2.652" class="difflineplus">+    let createdLabel = document.createXULElement(&quot;label&quot;);</span>
<a href="#l2.653"></a><span id="l2.653" class="difflineplus">+    document.l10n.setAttributes(</span>
<a href="#l2.654"></a><span id="l2.654" class="difflineplus">+      createdLabel,</span>
<a href="#l2.655"></a><span id="l2.655" class="difflineplus">+      &quot;openpgp-key-details-created-header&quot;</span>
<a href="#l2.656"></a><span id="l2.656" class="difflineplus">+    );</span>
<a href="#l2.657"></a><span id="l2.657" class="difflineplus">+    createdLabel.classList.add(&quot;extra-information-label-type&quot;);</span>
<a href="#l2.658"></a><span id="l2.658" class="difflineplus">+</span>
<a href="#l2.659"></a><span id="l2.659" class="difflineplus">+    let createdValueContainer = document.createXULElement(&quot;hbox&quot;);</span>
<a href="#l2.660"></a><span id="l2.660" class="difflineplus">+    createdValueContainer.classList.add(&quot;input-container&quot;);</span>
<a href="#l2.661"></a><span id="l2.661" class="difflineplus">+    createdValueContainer.setAttribute(&quot;flex&quot;, &quot;1&quot;);</span>
<a href="#l2.662"></a><span id="l2.662" class="difflineplus">+</span>
<a href="#l2.663"></a><span id="l2.663" class="difflineplus">+    let createdValue = document.createElement(&quot;input&quot;);</span>
<a href="#l2.664"></a><span id="l2.664" class="difflineplus">+    createdValue.setAttribute(&quot;type&quot;, &quot;text&quot;);</span>
<a href="#l2.665"></a><span id="l2.665" class="difflineplus">+    createdValue.classList.add(&quot;plain&quot;);</span>
<a href="#l2.666"></a><span id="l2.666" class="difflineplus">+    createdValue.setAttribute(&quot;readonly&quot;, &quot;readonly&quot;);</span>
<a href="#l2.667"></a><span id="l2.667" class="difflineplus">+    createdValue.value = key.created;</span>
<a href="#l2.668"></a><span id="l2.668" class="difflineplus">+</span>
<a href="#l2.669"></a><span id="l2.669" class="difflineplus">+    createdValueContainer.appendChild(createdValue);</span>
<a href="#l2.670"></a><span id="l2.670" class="difflineplus">+</span>
<a href="#l2.671"></a><span id="l2.671" class="difflineplus">+    grid.appendChild(createdImage);</span>
<a href="#l2.672"></a><span id="l2.672" class="difflineplus">+    grid.appendChild(createdLabel);</span>
<a href="#l2.673"></a><span id="l2.673" class="difflineplus">+    grid.appendChild(createdValueContainer);</span>
<a href="#l2.674"></a><span id="l2.674" class="difflineplus">+    // End key info section.</span>
<a href="#l2.675"></a><span id="l2.675" class="difflineplus">+</span>
<a href="#l2.676"></a><span id="l2.676" class="difflineplus">+    hiddenContainer.appendChild(grid);</span>
<a href="#l2.677"></a><span id="l2.677" class="difflineplus">+</span>
<a href="#l2.678"></a><span id="l2.678" class="difflineplus">+    // Action buttons.</span>
<a href="#l2.679"></a><span id="l2.679" class="difflineplus">+    let btnContainer = document.createXULElement(&quot;hbox&quot;);</span>
<a href="#l2.680"></a><span id="l2.680" class="difflineplus">+</span>
<a href="#l2.681"></a><span id="l2.681" class="difflineplus">+    let remove = document.createXULElement(&quot;button&quot;);</span>
<a href="#l2.682"></a><span id="l2.682" class="difflineplus">+    document.l10n.setAttributes(remove, &quot;openpgp-key-man-del-key&quot;);</span>
<a href="#l2.683"></a><span id="l2.683" class="difflineplus">+    remove.addEventListener(&quot;command&quot;, () =&gt; {</span>
<a href="#l2.684"></a><span id="l2.684" class="difflineplus">+      enigmailDeleteKey(key);</span>
<a href="#l2.685"></a><span id="l2.685" class="difflineplus">+    });</span>
<a href="#l2.686"></a><span id="l2.686" class="difflineplus">+</span>
<a href="#l2.687"></a><span id="l2.687" class="difflineplus">+    let edit = document.createXULElement(&quot;button&quot;);</span>
<a href="#l2.688"></a><span id="l2.688" class="difflineplus">+    document.l10n.setAttributes(edit, &quot;openpgp-key-man-edit-menu&quot;);</span>
<a href="#l2.689"></a><span id="l2.689" class="difflineplus">+    edit.addEventListener(&quot;command&quot;, enigmailEditKey);</span>
<a href="#l2.690"></a><span id="l2.690" class="difflineplus">+</span>
<a href="#l2.691"></a><span id="l2.691" class="difflineplus">+    let revoke = document.createXULElement(&quot;button&quot;);</span>
<a href="#l2.692"></a><span id="l2.692" class="difflineplus">+    document.l10n.setAttributes(revoke, &quot;openpgp-key-man-revoke-key&quot;);</span>
<a href="#l2.693"></a><span id="l2.693" class="difflineplus">+    revoke.addEventListener(&quot;command&quot;, enigmailRevokeKey);</span>
<a href="#l2.694"></a><span id="l2.694" class="difflineplus">+</span>
<a href="#l2.695"></a><span id="l2.695" class="difflineplus">+    let info = document.createXULElement(&quot;button&quot;);</span>
<a href="#l2.696"></a><span id="l2.696" class="difflineplus">+    document.l10n.setAttributes(info, &quot;openpgp-key-man-key-props&quot;);</span>
<a href="#l2.697"></a><span id="l2.697" class="difflineplus">+    info.addEventListener(&quot;command&quot;, () =&gt; {</span>
<a href="#l2.698"></a><span id="l2.698" class="difflineplus">+      enigmailKeyDetails(key.keyId);</span>
<a href="#l2.699"></a><span id="l2.699" class="difflineplus">+    });</span>
<a href="#l2.700"></a><span id="l2.700" class="difflineplus">+</span>
<a href="#l2.701"></a><span id="l2.701" class="difflineplus">+    let btnSeparator = document.createXULElement(&quot;separator&quot;);</span>
<a href="#l2.702"></a><span id="l2.702" class="difflineplus">+    btnSeparator.setAttribute(&quot;flex&quot;, &quot;1&quot;);</span>
<a href="#l2.703"></a><span id="l2.703" class="difflineplus">+</span>
<a href="#l2.704"></a><span id="l2.704" class="difflineplus">+    btnContainer.appendChild(info);</span>
<a href="#l2.705"></a><span id="l2.705" class="difflineplus">+    btnContainer.appendChild(btnSeparator);</span>
<a href="#l2.706"></a><span id="l2.706" class="difflineplus">+    btnContainer.appendChild(edit);</span>
<a href="#l2.707"></a><span id="l2.707" class="difflineplus">+    btnContainer.appendChild(revoke);</span>
<a href="#l2.708"></a><span id="l2.708" class="difflineplus">+    btnContainer.appendChild(remove);</span>
<a href="#l2.709"></a><span id="l2.709" class="difflineplus">+</span>
<a href="#l2.710"></a><span id="l2.710" class="difflineplus">+    hiddenContainer.appendChild(btnContainer);</span>
<a href="#l2.711"></a><span id="l2.711" class="difflineplus">+</span>
<a href="#l2.712"></a><span id="l2.712" class="difflineplus">+    indent.appendChild(dateContainer);</span>
<a href="#l2.713"></a><span id="l2.713" class="difflineplus">+    indent.appendChild(hiddenContainer);</span>
<a href="#l2.714"></a><span id="l2.714" class="difflineplus">+</span>
<a href="#l2.715"></a><span id="l2.715" class="difflineplus">+    container.appendChild(box);</span>
<a href="#l2.716"></a><span id="l2.716" class="difflineplus">+    container.appendChild(indent);</span>
<a href="#l2.717"></a><span id="l2.717" class="difflineplus">+</span>
<a href="#l2.718"></a><span id="l2.718" class="difflineplus">+    radiogroup.appendChild(container);</span>
<a href="#l2.719"></a><span id="l2.719" class="difflineplus">+  }</span>
<a href="#l2.720"></a><span id="l2.720" class="difflineplus">+</span>
<a href="#l2.721"></a><span id="l2.721" class="difflineplus">+  highlightOpenPgpKey();</span>
<a href="#l2.722"></a><span id="l2.722" class="difflineplus">+}</span>
<a href="#l2.723"></a><span id="l2.723" class="difflineplus">+</span>
<a href="#l2.724"></a><span id="l2.724" class="difflineplus">+/**</span>
<a href="#l2.725"></a><span id="l2.725" class="difflineplus">+ * Open the Key Properties subdialog.</span>
<a href="#l2.726"></a><span id="l2.726" class="difflineplus">+ *</span>
<a href="#l2.727"></a><span id="l2.727" class="difflineplus">+ * @param {string} keyId - The ID of the selected OpenPGP Key.</span>
<a href="#l2.728"></a><span id="l2.728" class="difflineplus">+ */</span>
<a href="#l2.729"></a><span id="l2.729" class="difflineplus">+function enigmailKeyDetails(keyId) {</span>
<a href="#l2.730"></a><span id="l2.730" class="difflineplus">+  keyId = keyId.replace(/^0x/, &quot;&quot;);</span>
<a href="#l2.731"></a><span id="l2.731" class="difflineplus">+</span>
<a href="#l2.732"></a><span id="l2.732" class="difflineplus">+  parent.gSubDialog.open(</span>
<a href="#l2.733"></a><span id="l2.733" class="difflineplus">+    &quot;chrome://openpgp/content/ui/keyDetailsDlg.xhtml&quot;,</span>
<a href="#l2.734"></a><span id="l2.734" class="difflineplus">+    null,</span>
<a href="#l2.735"></a><span id="l2.735" class="difflineplus">+    { keyId }</span>
<a href="#l2.736"></a><span id="l2.736" class="difflineplus">+  );</span>
<a href="#l2.737"></a><span id="l2.737" class="difflineplus">+}</span>
<a href="#l2.738"></a><span id="l2.738" class="difflineplus">+</span>
<a href="#l2.739"></a><span id="l2.739" class="difflineplus">+/**</span>
<a href="#l2.740"></a><span id="l2.740" class="difflineplus">+ * Delete an OpenPGP Key.</span>
<a href="#l2.741"></a><span id="l2.741" class="difflineplus">+ *</span>
<a href="#l2.742"></a><span id="l2.742" class="difflineplus">+ * @param {Object} key - The selected OpenPGP Key.</span>
<a href="#l2.743"></a><span id="l2.743" class="difflineplus">+ */</span>
<a href="#l2.744"></a><span id="l2.744" class="difflineplus">+async function enigmailDeleteKey(key) {</span>
<a href="#l2.745"></a><span id="l2.745" class="difflineplus">+  if (!GetEnigmailSvc()) {</span>
<a href="#l2.746"></a><span id="l2.746" class="difflineplus">+    return;</span>
<a href="#l2.747"></a><span id="l2.747" class="difflineplus">+  }</span>
<a href="#l2.748"></a><span id="l2.748" class="difflineplus">+</span>
<a href="#l2.749"></a><span id="l2.749" class="difflineplus">+  // Interrupt if the selected key is currently being used.</span>
<a href="#l2.750"></a><span id="l2.750" class="difflineplus">+  if (key.keyId == gIdentity.getUnicharAttribute(&quot;openpgp_key_id&quot;)) {</span>
<a href="#l2.751"></a><span id="l2.751" class="difflineplus">+    let alertTitle = await document.l10n.formatValue(&quot;delete-key-in-use-title&quot;);</span>
<a href="#l2.752"></a><span id="l2.752" class="difflineplus">+    let alertDescription = await document.l10n.formatValue(</span>
<a href="#l2.753"></a><span id="l2.753" class="difflineplus">+      &quot;delete-key-in-use-description&quot;</span>
<a href="#l2.754"></a><span id="l2.754" class="difflineplus">+    );</span>
<a href="#l2.755"></a><span id="l2.755" class="difflineplus">+</span>
<a href="#l2.756"></a><span id="l2.756" class="difflineplus">+    Services.prompt.alert(null, alertTitle, alertDescription);</span>
<a href="#l2.757"></a><span id="l2.757" class="difflineplus">+    return;</span>
<a href="#l2.758"></a><span id="l2.758" class="difflineplus">+  }</span>
<a href="#l2.759"></a><span id="l2.759" class="difflineplus">+</span>
<a href="#l2.760"></a><span id="l2.760" class="difflineplus">+  let l10nKey = key.secretAvailable ? &quot;delete-secret-key&quot; : &quot;delete-pub-key&quot;;</span>
<a href="#l2.761"></a><span id="l2.761" class="difflineplus">+  let title = await document.l10n.formatValue(&quot;delete-key-title&quot;, {</span>
<a href="#l2.762"></a><span id="l2.762" class="difflineplus">+    userId: key.userId,</span>
<a href="#l2.763"></a><span id="l2.763" class="difflineplus">+  });</span>
<a href="#l2.764"></a><span id="l2.764" class="difflineplus">+  let description = await document.l10n.formatValue(l10nKey, {</span>
<a href="#l2.765"></a><span id="l2.765" class="difflineplus">+    userId: key.userId,</span>
<a href="#l2.766"></a><span id="l2.766" class="difflineplus">+  });</span>
<a href="#l2.767"></a><span id="l2.767" class="difflineplus">+</span>
<a href="#l2.768"></a><span id="l2.768" class="difflineplus">+  // Ask for confirmation before proceeding.</span>
<a href="#l2.769"></a><span id="l2.769" class="difflineplus">+  if (!Services.prompt.confirm(null, title, description)) {</span>
<a href="#l2.770"></a><span id="l2.770" class="difflineplus">+    return;</span>
<a href="#l2.771"></a><span id="l2.771" class="difflineplus">+  }</span>
<a href="#l2.772"></a><span id="l2.772" class="difflineplus">+</span>
<a href="#l2.773"></a><span id="l2.773" class="difflineplus">+  let cApi = EnigmailCryptoAPI();</span>
<a href="#l2.774"></a><span id="l2.774" class="difflineplus">+  cApi.sync(cApi.deleteKey(key.fpr, key.secretAvailable));</span>
<a href="#l2.775"></a><span id="l2.775" class="difflineplus">+  cApi.sync(PgpSqliteDb2.deleteAcceptance(key.fpr));</span>
<a href="#l2.776"></a><span id="l2.776" class="difflineplus">+</span>
<a href="#l2.777"></a><span id="l2.777" class="difflineplus">+  EnigmailKeyRing.clearCache();</span>
<a href="#l2.778"></a><span id="l2.778" class="difflineplus">+  reloadOpenPgpUI();</span>
<a href="#l2.779"></a><span id="l2.779" class="difflineplus">+}</span>
<a href="#l2.780"></a><span id="l2.780" class="difflineplus">+</span>
<a href="#l2.781"></a><span id="l2.781" class="difflineplus">+/**</span>
<a href="#l2.782"></a><span id="l2.782" class="difflineplus">+ * Open the subdialog to enable the user to edit the the selected OpenPGP Key.</span>
<a href="#l2.783"></a><span id="l2.783" class="difflineplus">+ *</span>
<a href="#l2.784"></a><span id="l2.784" class="difflineplus">+ * @param {Event} event - The DOM event.</span>
<a href="#l2.785"></a><span id="l2.785" class="difflineplus">+ */</span>
<a href="#l2.786"></a><span id="l2.786" class="difflineplus">+async function enigmailEditKey(event) {</span>
<a href="#l2.787"></a><span id="l2.787" class="difflineplus">+  // TODO: Not yet implemented. Alert the user of the WIP status.</span>
<a href="#l2.788"></a><span id="l2.788" class="difflineplus">+  let title = await document.l10n.formatValue(&quot;openpgp-key-edit-title&quot;);</span>
<a href="#l2.789"></a><span id="l2.789" class="difflineplus">+</span>
<a href="#l2.790"></a><span id="l2.790" class="difflineplus">+  Services.prompt.alert(</span>
<a href="#l2.791"></a><span id="l2.791" class="difflineplus">+    window,</span>
<a href="#l2.792"></a><span id="l2.792" class="difflineplus">+    title,</span>
<a href="#l2.793"></a><span id="l2.793" class="difflineplus">+    &quot;Work in Progress: Key editing not yet implemented&quot;</span>
<a href="#l2.794"></a><span id="l2.794" class="difflineplus">+  );</span>
<a href="#l2.795"></a><span id="l2.795" class="difflineplus">+}</span>
<a href="#l2.796"></a><span id="l2.796" class="difflineplus">+</span>
<a href="#l2.797"></a><span id="l2.797" class="difflineplus">+/**</span>
<a href="#l2.798"></a><span id="l2.798" class="difflineplus">+ * Open the subdialog to enable the user to revoke the selected OpenPGP Key.</span>
<a href="#l2.799"></a><span id="l2.799" class="difflineplus">+ *</span>
<a href="#l2.800"></a><span id="l2.800" class="difflineplus">+ * @param {Event} event - The DOM event.</span>
<a href="#l2.801"></a><span id="l2.801" class="difflineplus">+ */</span>
<a href="#l2.802"></a><span id="l2.802" class="difflineplus">+async function enigmailRevokeKey(event) {</span>
<a href="#l2.803"></a><span id="l2.803" class="difflineplus">+  // TODO: Not yet implemented. Alert the user of the WIP status.</span>
<a href="#l2.804"></a><span id="l2.804" class="difflineplus">+  let title = await document.l10n.formatValue(&quot;openpgp-key-revoke-title&quot;);</span>
<a href="#l2.805"></a><span id="l2.805" class="difflineplus">+</span>
<a href="#l2.806"></a><span id="l2.806" class="difflineplus">+  Services.prompt.alert(</span>
<a href="#l2.807"></a><span id="l2.807" class="difflineplus">+    window,</span>
<a href="#l2.808"></a><span id="l2.808" class="difflineplus">+    title,</span>
<a href="#l2.809"></a><span id="l2.809" class="difflineplus">+    &quot;Work in Progress: Key revocation not yet implemented&quot;</span>
<a href="#l2.810"></a><span id="l2.810" class="difflineplus">+  );</span>
<a href="#l2.811"></a><span id="l2.811" class="difflineplus">+}</span>
<a href="#l2.812"></a><span id="l2.812" class="difflineplus">+</span>
<a href="#l2.813"></a><span id="l2.813" class="difflineplus">+/**</span>
<a href="#l2.814"></a><span id="l2.814" class="difflineplus">+ * Open the subdialog to enable the user to edit the expiration date of the</span>
<a href="#l2.815"></a><span id="l2.815" class="difflineplus">+ * selected OpenPGP Key.</span>
<a href="#l2.816"></a><span id="l2.816" class="difflineplus">+ *</span>
<a href="#l2.817"></a><span id="l2.817" class="difflineplus">+ * @param {Event} event - The DOM event.</span>
<a href="#l2.818"></a><span id="l2.818" class="difflineplus">+ */</span>
<a href="#l2.819"></a><span id="l2.819" class="difflineplus">+async function enigmailEditKeyDate(event) {</span>
<a href="#l2.820"></a><span id="l2.820" class="difflineplus">+  // TODO: Not yet implemented. Alert the user of the WIP status.</span>
<a href="#l2.821"></a><span id="l2.821" class="difflineplus">+  let title = await document.l10n.formatValue(&quot;openpgp-key-edit-date-title&quot;);</span>
<a href="#l2.822"></a><span id="l2.822" class="difflineplus">+</span>
<a href="#l2.823"></a><span id="l2.823" class="difflineplus">+  Services.prompt.alert(</span>
<a href="#l2.824"></a><span id="l2.824" class="difflineplus">+    window,</span>
<a href="#l2.825"></a><span id="l2.825" class="difflineplus">+    title,</span>
<a href="#l2.826"></a><span id="l2.826" class="difflineplus">+    &quot;Work in Progress: Key date extention not yet implemented&quot;</span>
<a href="#l2.827"></a><span id="l2.827" class="difflineplus">+  );</span>
<a href="#l2.828"></a><span id="l2.828" class="difflineplus">+}</span>
<a href="#l2.829"></a><span id="l2.829" class="difflineplus">+</span>
<a href="#l2.830"></a><span id="l2.830" class="difflineplus">+/**</span>
<a href="#l2.831"></a><span id="l2.831" class="difflineplus">+ * Toggle the visibility of the OpenPgp Key radio container.</span>
<a href="#l2.832"></a><span id="l2.832" class="difflineplus">+ *</span>
<a href="#l2.833"></a><span id="l2.833" class="difflineplus">+ * @param {Event} event - The DOM event.</span>
<a href="#l2.834"></a><span id="l2.834" class="difflineplus">+ */</span>
<a href="#l2.835"></a><span id="l2.835" class="difflineplus">+function toggleExpansion(event) {</span>
<a href="#l2.836"></a><span id="l2.836" class="difflineplus">+  let carat = event.target;</span>
<a href="#l2.837"></a><span id="l2.837" class="difflineplus">+  carat.classList.toggle(&quot;up&quot;);</span>
<a href="#l2.838"></a><span id="l2.838" class="difflineplus">+  carat.closest(&quot;.content-blocking-category&quot;).classList.toggle(&quot;expanded&quot;);</span>
<a href="#l2.839"></a><span id="l2.839" class="difflineplus">+  carat.setAttribute(</span>
<a href="#l2.840"></a><span id="l2.840" class="difflineplus">+    &quot;aria-expanded&quot;,</span>
<a href="#l2.841"></a><span id="l2.841" class="difflineplus">+    carat.getAttribute(&quot;aria-expanded&quot;) === &quot;false&quot;</span>
<a href="#l2.842"></a><span id="l2.842" class="difflineplus">+  );</span>
<a href="#l2.843"></a><span id="l2.843" class="difflineplus">+}</span>
<a href="#l2.844"></a><span id="l2.844" class="difflineplus">+</span>
<a href="#l2.845"></a><span id="l2.845" class="difflineplus">+/**</span>
<a href="#l2.846"></a><span id="l2.846" class="difflineplus">+ * Update all the encryption options based on the newly selected OpenPGP Key.</span>
<a href="#l2.847"></a><span id="l2.847" class="difflineplus">+ */</span>
<a href="#l2.848"></a><span id="l2.848" class="difflineplus">+function updateOpenPgpSettings() {</span>
<a href="#l2.849"></a><span id="l2.849" class="difflineplus">+  // Get the newly selected OpenPgp Key for this identity.</span>
<a href="#l2.850"></a><span id="l2.850" class="difflineplus">+  let newKey = Services.prefs.getStringPref(</span>
<a href="#l2.851"></a><span id="l2.851" class="difflineplus">+    `mail.identity.${gIdentity.key}.openpgp_key_id`,</span>
<a href="#l2.852"></a><span id="l2.852" class="difflineplus">+    &quot;&quot;</span>
<a href="#l2.853"></a><span id="l2.853" class="difflineplus">+  );</span>
<a href="#l2.854"></a><span id="l2.854" class="difflineplus">+</span>
<a href="#l2.855"></a><span id="l2.855" class="difflineplus">+  // Avoid running the method if the key didn't change.</span>
<a href="#l2.856"></a><span id="l2.856" class="difflineplus">+  if (gKeyId == newKey) {</span>
<a href="#l2.857"></a><span id="l2.857" class="difflineplus">+    return;</span>
<a href="#l2.858"></a><span id="l2.858" class="difflineplus">+  }</span>
<a href="#l2.859"></a><span id="l2.859" class="difflineplus">+</span>
<a href="#l2.860"></a><span id="l2.860" class="difflineplus">+  gKeyId = newKey;</span>
<a href="#l2.861"></a><span id="l2.861" class="difflineplus">+</span>
<a href="#l2.862"></a><span id="l2.862" class="difflineplus">+  if (gKeyId) {</span>
<a href="#l2.863"></a><span id="l2.863" class="difflineplus">+    enableEncryptionControls(true);</span>
<a href="#l2.864"></a><span id="l2.864" class="difflineplus">+    enableSigningControls(true);</span>
<a href="#l2.865"></a><span id="l2.865" class="difflineplus">+  } else {</span>
<a href="#l2.866"></a><span id="l2.866" class="difflineplus">+    let stillHaveOtherEncryption =</span>
<a href="#l2.867"></a><span id="l2.867" class="difflineplus">+      gEncryptionCertName &amp;&amp; gEncryptionCertName.value;</span>
<a href="#l2.868"></a><span id="l2.868" class="difflineplus">+    if (!stillHaveOtherEncryption) {</span>
<a href="#l2.869"></a><span id="l2.869" class="difflineplus">+      enableEncryptionControls(false);</span>
<a href="#l2.870"></a><span id="l2.870" class="difflineplus">+    }</span>
<a href="#l2.871"></a><span id="l2.871" class="difflineplus">+</span>
<a href="#l2.872"></a><span id="l2.872" class="difflineplus">+    let stillHaveOtherSigning = gSignCertName &amp;&amp; gSignCertName.value;</span>
<a href="#l2.873"></a><span id="l2.873" class="difflineplus">+    if (!stillHaveOtherSigning) {</span>
<a href="#l2.874"></a><span id="l2.874" class="difflineplus">+      enableSigningControls(false);</span>
<a href="#l2.875"></a><span id="l2.875" class="difflineplus">+    }</span>
<a href="#l2.876"></a><span id="l2.876" class="difflineplus">+  }</span>
<a href="#l2.877"></a><span id="l2.877" class="difflineplus">+</span>
<a href="#l2.878"></a><span id="l2.878" class="difflineplus">+  updateTechPref();</span>
<a href="#l2.879"></a><span id="l2.879" class="difflineplus">+  enableSelectButtons();</span>
<a href="#l2.880"></a><span id="l2.880" class="difflineplus">+  onSave();</span>
<a href="#l2.881"></a><span id="l2.881" class="difflineplus">+</span>
<a href="#l2.882"></a><span id="l2.882" class="difflineplus">+  highlightOpenPgpKey();</span>
<a href="#l2.883"></a><span id="l2.883" class="difflineplus">+}</span>
<a href="#l2.884"></a><span id="l2.884" class="difflineplus">+</span>
<a href="#l2.885"></a><span id="l2.885" class="difflineplus">+/**</span>
<a href="#l2.886"></a><span id="l2.886" class="difflineplus">+ * Apply a .selected class to the radio container of the currently selected</span>
<a href="#l2.887"></a><span id="l2.887" class="difflineplus">+ * OpenPGP Key.</span>
<a href="#l2.888"></a><span id="l2.888" class="difflineplus">+ */</span>
<a href="#l2.889"></a><span id="l2.889" class="difflineplus">+function highlightOpenPgpKey() {</span>
<a href="#l2.890"></a><span id="l2.890" class="difflineplus">+  // Remove a previously selected container, if any.</span>
<a href="#l2.891"></a><span id="l2.891" class="difflineplus">+  let current = document.querySelector(&quot;.content-blocking-category.selected&quot;);</span>
<a href="#l2.892"></a><span id="l2.892" class="difflineplus">+</span>
<a href="#l2.893"></a><span id="l2.893" class="difflineplus">+  if (current) {</span>
<a href="#l2.894"></a><span id="l2.894" class="difflineplus">+    current.classList.remove(&quot;selected&quot;);</span>
<a href="#l2.895"></a><span id="l2.895" class="difflineplus">+  }</span>
<a href="#l2.896"></a><span id="l2.896" class="difflineplus">+</span>
<a href="#l2.897"></a><span id="l2.897" class="difflineplus">+  // Highlight the parent container of the currently selected radio button.</span>
<a href="#l2.898"></a><span id="l2.898" class="difflineplus">+  // The condition needs to be sure the key is not null as a selection of &quot;None&quot;</span>
<a href="#l2.899"></a><span id="l2.899" class="difflineplus">+  // results with a value of &quot;&quot;.</span>
<a href="#l2.900"></a><span id="l2.900" class="difflineplus">+  if (gKeyId !== null) {</span>
<a href="#l2.901"></a><span id="l2.901" class="difflineplus">+    document</span>
<a href="#l2.902"></a><span id="l2.902" class="difflineplus">+      .querySelector(`radio[value=&quot;${gKeyId}&quot;]`)</span>
<a href="#l2.903"></a><span id="l2.903" class="difflineplus">+      .closest(&quot;.content-blocking-category&quot;)</span>
<a href="#l2.904"></a><span id="l2.904" class="difflineplus">+      .classList.add(&quot;selected&quot;);</span>
<a href="#l2.905"></a><span id="l2.905" class="difflineplus">+  }</span>
<a href="#l2.906"></a><span id="l2.906" class="difflineplus">+</span>
<a href="#l2.907"></a><span id="l2.907" class="difflineplus">+  document.l10n.setAttributes(</span>
<a href="#l2.908"></a><span id="l2.908" class="difflineplus">+    document.getElementById(&quot;openPgpgSelectionStatus&quot;),</span>
<a href="#l2.909"></a><span id="l2.909" class="difflineplus">+    &quot;openpgp-selection-status&quot;,</span>
<a href="#l2.910"></a><span id="l2.910" class="difflineplus">+    {</span>
<a href="#l2.911"></a><span id="l2.911" class="difflineplus">+      count: gKeyId ? 1 : 0,</span>
<a href="#l2.912"></a><span id="l2.912" class="difflineplus">+      key: `0x${gKeyId}`,</span>
<a href="#l2.913"></a><span id="l2.913" class="difflineplus">+    }</span>
<a href="#l2.914"></a><span id="l2.914" class="difflineplus">+  );</span>
<a href="#l2.915"></a><span id="l2.915" class="difflineplus">+</span>
<a href="#l2.916"></a><span id="l2.916" class="difflineplus">+  // Show a green checkmark if a key is currently being used.</span>
<a href="#l2.917"></a><span id="l2.917" class="difflineplus">+  // TODO: This needs further iterations in order to show a proper flag in case</span>
<a href="#l2.918"></a><span id="l2.918" class="difflineplus">+  // the selected Key is expired or revoked.</span>
<a href="#l2.919"></a><span id="l2.919" class="difflineplus">+  let image = document.getElementById(&quot;openPgpStatusImage&quot;);</span>
<a href="#l2.920"></a><span id="l2.920" class="difflineplus">+  if (gKeyId) {</span>
<a href="#l2.921"></a><span id="l2.921" class="difflineplus">+    image.removeAttribute(&quot;hidden&quot;);</span>
<a href="#l2.922"></a><span id="l2.922" class="difflineplus">+  } else {</span>
<a href="#l2.923"></a><span id="l2.923" class="difflineplus">+    image.setAttribute(&quot;hidden&quot;, &quot;true&quot;);</span>
<a href="#l2.924"></a><span id="l2.924" class="difflineplus">+  }</span>
<a href="#l2.925"></a><span id="l2.925" class="difflineplus">+}</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l3.1"></a><span id="l3.1" class="difflineminus">--- a/mail/extensions/am-e2e/am-e2e.xhtml</span>
<a href="#l3.2"></a><span id="l3.2" class="difflineplus">+++ b/mail/extensions/am-e2e/am-e2e.xhtml</span>
<a href="#l3.3"></a><span id="l3.3" class="difflineat">@@ -1,24 +1,27 @@</span>
<a href="#l3.4"></a><span id="l3.4"> &lt;?xml version=&quot;1.0&quot;?&gt;</span>
<a href="#l3.5"></a><span id="l3.5"> &lt;!-- This Source Code Form is subject to the terms of the Mozilla Public</span>
<a href="#l3.6"></a><span id="l3.6">    - License, v. 2.0. If a copy of the MPL was not distributed with this</span>
<a href="#l3.7"></a><span id="l3.7">    - file, You can obtain one at http://mozilla.org/MPL/2.0/. --&gt;</span>
<a href="#l3.8"></a><span id="l3.8"> </span>
<a href="#l3.9"></a><span id="l3.9"> &lt;?xml-stylesheet href=&quot;chrome://messenger/skin/accountManage.css&quot; type=&quot;text/css&quot;?&gt;</span>
<a href="#l3.10"></a><span id="l3.10" class="difflineplus">+&lt;?xml-stylesheet href=&quot;chrome://messenger/skin/openpgp/inlineNotification.css&quot; type=&quot;text/css&quot;?&gt;</span>
<a href="#l3.11"></a><span id="l3.11"> </span>
<a href="#l3.12"></a><span id="l3.12"> &lt;!DOCTYPE window SYSTEM &quot;chrome://messenger/locale/am-smime.dtd&quot;&gt;</span>
<a href="#l3.13"></a><span id="l3.13"> </span>
<a href="#l3.14"></a><span id="l3.14" class="difflineminus">-&lt;window xmlns=&quot;http://www.mozilla.org/keymaster/gatekeeper/there.is.only.xul&quot; xmlns:html=&quot;http://www.w3.org/1999/xhtml&quot;</span>
<a href="#l3.15"></a><span id="l3.15" class="difflineminus">-        class=&quot;color-dialog&quot;</span>
<a href="#l3.16"></a><span id="l3.16" class="difflineplus">+&lt;window xmlns=&quot;http://www.mozilla.org/keymaster/gatekeeper/there.is.only.xul&quot;</span>
<a href="#l3.17"></a><span id="l3.17" class="difflineplus">+        xmlns:html=&quot;http://www.w3.org/1999/xhtml&quot;</span>
<a href="#l3.18"></a><span id="l3.18">         onload=&quot;parent.onPanelLoaded('am-e2e.xhtml');&quot;&gt;</span>
<a href="#l3.19"></a><span id="l3.19"> </span>
<a href="#l3.20"></a><span id="l3.20">   &lt;script src=&quot;chrome://global/content/globalOverlay.js&quot;/&gt;</span>
<a href="#l3.21"></a><span id="l3.21">   &lt;script src=&quot;chrome://global/content/editMenuOverlay.js&quot;/&gt;</span>
<a href="#l3.22"></a><span id="l3.22" class="difflineplus">+  &lt;script src=&quot;chrome://global/content/preferencesBindings.js&quot;/&gt;</span>
<a href="#l3.23"></a><span id="l3.23">   &lt;script src=&quot;chrome://messenger/content/AccountManager.js&quot;/&gt;</span>
<a href="#l3.24"></a><span id="l3.24" class="difflineplus">+  &lt;script src=&quot;chrome://openpgp/content/ui/enigmailCommon.js&quot;/&gt;</span>
<a href="#l3.25"></a><span id="l3.25">   &lt;script src=&quot;chrome://messenger/content/am-e2e.js&quot;/&gt;</span>
<a href="#l3.26"></a><span id="l3.26"> </span>
<a href="#l3.27"></a><span id="l3.27">   &lt;vbox flex=&quot;1&quot; style=&quot;overflow: auto;&quot;&gt;&lt;vbox id=&quot;containerBox&quot; flex=&quot;1&quot;&gt;</span>
<a href="#l3.28"></a><span id="l3.28">     &lt;hbox class=&quot;dialogheader&quot;&gt;</span>
<a href="#l3.29"></a><span id="l3.29">       &lt;label class=&quot;dialogheader-title&quot; value=&quot;&amp;e2eTitle.label;&quot;/&gt;</span>
<a href="#l3.30"></a><span id="l3.30">     &lt;/hbox&gt;</span>
<a href="#l3.31"></a><span id="l3.31"> </span>
<a href="#l3.32"></a><span id="l3.32">     &lt;separator class=&quot;thin&quot;/&gt;</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l4.1"></a><span id="l4.1" class="difflineminus">--- a/mail/extensions/openpgp/content/modules/keyRing.jsm</span>
<a href="#l4.2"></a><span id="l4.2" class="difflineplus">+++ b/mail/extensions/openpgp/content/modules/keyRing.jsm</span>
<a href="#l4.3"></a><span id="l4.3" class="difflineat">@@ -229,31 +229,50 @@ var EnigmailKeyRing = {</span>
<a href="#l4.4"></a><span id="l4.4">    *</span>
<a href="#l4.5"></a><span id="l4.5">    * @param emailAddr: String - email address to search for without any angulars</span>
<a href="#l4.6"></a><span id="l4.6">    *                            or names</span>
<a href="#l4.7"></a><span id="l4.7">    *</span>
<a href="#l4.8"></a><span id="l4.8">    * @return KeyObject with the found key, or null if no key found</span>
<a href="#l4.9"></a><span id="l4.9">    */</span>
<a href="#l4.10"></a><span id="l4.10">   getSecretKeyByEmail(emailAddr) {</span>
<a href="#l4.11"></a><span id="l4.11">     let result = {};</span>
<a href="#l4.12"></a><span id="l4.12" class="difflineminus">-    this.getAllSecretKeysByEmail(emailAddr, result);</span>
<a href="#l4.13"></a><span id="l4.13" class="difflineplus">+    this.getSecretKeysByEmail(emailAddr, result);</span>
<a href="#l4.14"></a><span id="l4.14">     return result.best;</span>
<a href="#l4.15"></a><span id="l4.15">   },</span>
<a href="#l4.16"></a><span id="l4.16"> </span>
<a href="#l4.17"></a><span id="l4.17" class="difflineminus">-  getAllSecretKeysByEmail(emailAddr, result) {</span>
<a href="#l4.18"></a><span id="l4.18" class="difflineplus">+  getSecretKeysByEmail(emailAddr, result) {</span>
<a href="#l4.19"></a><span id="l4.19">     // sanitize email address</span>
<a href="#l4.20"></a><span id="l4.20">     emailAddr = emailAddr.replace(/([\.\[\]\-\\])/g, &quot;\\$1&quot;);</span>
<a href="#l4.21"></a><span id="l4.21"> </span>
<a href="#l4.22"></a><span id="l4.22">     let searchTerm =</span>
<a href="#l4.23"></a><span id="l4.23">       &quot;(&lt;&quot; + emailAddr + &quot;&gt;| &quot; + emailAddr + &quot;$|^&quot; + emailAddr + &quot;$)&quot;;</span>
<a href="#l4.24"></a><span id="l4.24"> </span>
<a href="#l4.25"></a><span id="l4.25">     this.getAllSecretKeysByUserId(searchTerm, result);</span>
<a href="#l4.26"></a><span id="l4.26">   },</span>
<a href="#l4.27"></a><span id="l4.27"> </span>
<a href="#l4.28"></a><span id="l4.28">   /**</span>
<a href="#l4.29"></a><span id="l4.29" class="difflineplus">+   * Return the full unfiltered list of keys that are specifics of email</span>
<a href="#l4.30"></a><span id="l4.30" class="difflineplus">+   * addresses in UIDs.</span>
<a href="#l4.31"></a><span id="l4.31" class="difflineplus">+   *</span>
<a href="#l4.32"></a><span id="l4.32" class="difflineplus">+   * @param {String} emailAddr - email address to search for without any</span>
<a href="#l4.33"></a><span id="l4.33" class="difflineplus">+   *   angulars or names.</span>
<a href="#l4.34"></a><span id="l4.34" class="difflineplus">+   *</span>
<a href="#l4.35"></a><span id="l4.35" class="difflineplus">+   * @return {Object | null} - Object with the found keys, or null.</span>
<a href="#l4.36"></a><span id="l4.36" class="difflineplus">+   */</span>
<a href="#l4.37"></a><span id="l4.37" class="difflineplus">+  getAllSecretKeysByEmail(emailAddr, result) {</span>
<a href="#l4.38"></a><span id="l4.38" class="difflineplus">+    // Sanitize email address.</span>
<a href="#l4.39"></a><span id="l4.39" class="difflineplus">+    emailAddr = emailAddr.replace(/([\.\[\]\-\\])/g, &quot;\\$1&quot;);</span>
<a href="#l4.40"></a><span id="l4.40" class="difflineplus">+</span>
<a href="#l4.41"></a><span id="l4.41" class="difflineplus">+    let searchTerm =</span>
<a href="#l4.42"></a><span id="l4.42" class="difflineplus">+      &quot;(&lt;&quot; + emailAddr + &quot;&gt;| &quot; + emailAddr + &quot;$|^&quot; + emailAddr + &quot;$)&quot;;</span>
<a href="#l4.43"></a><span id="l4.43" class="difflineplus">+</span>
<a href="#l4.44"></a><span id="l4.44" class="difflineplus">+    result.all = this.getKeysByUserId(searchTerm, false);</span>
<a href="#l4.45"></a><span id="l4.45" class="difflineplus">+  },</span>
<a href="#l4.46"></a><span id="l4.46" class="difflineplus">+</span>
<a href="#l4.47"></a><span id="l4.47" class="difflineplus">+  /**</span>
<a href="#l4.48"></a><span id="l4.48">    * get the &quot;best&quot; possible secret key for a given user ID</span>
<a href="#l4.49"></a><span id="l4.49">    *</span>
<a href="#l4.50"></a><span id="l4.50">    * @param searchTerm   - String: a regular expression to match against all UIDs of the keys.</span>
<a href="#l4.51"></a><span id="l4.51">    *                               The search is always performed case-insensitively</span>
<a href="#l4.52"></a><span id="l4.52">    * @return KeyObject with the found key, or null if no key found</span>
<a href="#l4.53"></a><span id="l4.53">    */</span>
<a href="#l4.54"></a><span id="l4.54">   getSecretKeyByUserId(searchTerm) {</span>
<a href="#l4.55"></a><span id="l4.55">     let result = {};</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l5.1"></a><span id="l5.1" class="difflineminus">--- a/mail/extensions/openpgp/content/strings/enigmail.ftl</span>
<a href="#l5.2"></a><span id="l5.2" class="difflineplus">+++ b/mail/extensions/openpgp/content/strings/enigmail.ftl</span>
<a href="#l5.3"></a><span id="l5.3" class="difflineat">@@ -1,8 +1,12 @@</span>
<a href="#l5.4"></a><span id="l5.4" class="difflineplus">+# This Source Code Form is subject to the terms of the Mozilla Public</span>
<a href="#l5.5"></a><span id="l5.5" class="difflineplus">+# License, v. 2.0. If a copy of the MPL was not distributed with this</span>
<a href="#l5.6"></a><span id="l5.6" class="difflineplus">+# file, You can obtain one at http://mozilla.org/MPL/2.0/.</span>
<a href="#l5.7"></a><span id="l5.7" class="difflineplus">+</span>
<a href="#l5.8"></a><span id="l5.8"> openpgp-key-user-id-label = Account / User ID</span>
<a href="#l5.9"></a><span id="l5.9"> openpgp-keygen-title-label =</span>
<a href="#l5.10"></a><span id="l5.10">     .title = Generate OpenPGP Key</span>
<a href="#l5.11"></a><span id="l5.11"> openpgp-cancel-key =</span>
<a href="#l5.12"></a><span id="l5.12">     .label = Cancel</span>
<a href="#l5.13"></a><span id="l5.13">     .tooltiptext = Cancel Key Generation</span>
<a href="#l5.14"></a><span id="l5.14"> openpgp-key-gen-expiry-title =</span>
<a href="#l5.15"></a><span id="l5.15">     .label = Key expiry</span>
<a href="#l5.16"></a><span id="l5.16" class="difflineat">@@ -182,16 +186,69 @@ openpgp-acceptance-undecided-label =</span>
<a href="#l5.17"></a><span id="l5.17"> openpgp-acceptance-unverified-label =</span>
<a href="#l5.18"></a><span id="l5.18">     .label = Yes, but I have not verified that it is the correct key.</span>
<a href="#l5.19"></a><span id="l5.19"> openpgp-acceptance-verified-label =</span>
<a href="#l5.20"></a><span id="l5.20">     .label = Yes, I've verified in person this key has the correct fingerprint.</span>
<a href="#l5.21"></a><span id="l5.21"> </span>
<a href="#l5.22"></a><span id="l5.22"> openpgp-copy-cmd-label =</span>
<a href="#l5.23"></a><span id="l5.23">     .label = Copy</span>
<a href="#l5.24"></a><span id="l5.24"> </span>
<a href="#l5.25"></a><span id="l5.25" class="difflineplus">+## e2e encryption settings</span>
<a href="#l5.26"></a><span id="l5.26" class="difflineplus">+</span>
<a href="#l5.27"></a><span id="l5.27" class="difflineplus">+#   $count (Number) - the number of configured keys associated with the current identity</span>
<a href="#l5.28"></a><span id="l5.28" class="difflineplus">+#   $identity (String) - the email address of the currently selected identity</span>
<a href="#l5.29"></a><span id="l5.29" class="difflineplus">+openpgp-description = { $count -&gt;</span>
<a href="#l5.30"></a><span id="l5.30" class="difflineplus">+    [0]     Thunderbird doesn't have a personal OpenPGP key for &lt;b&gt;{ $identity }&lt;/b&gt;</span>
<a href="#l5.31"></a><span id="l5.31" class="difflineplus">+    [one]   Thunderbird found { $count } personal OpenPGP key associated with &lt;b&gt;{ $identity }&lt;/b&gt;</span>
<a href="#l5.32"></a><span id="l5.32" class="difflineplus">+   *[other] Thunderbird found { $count } personal OpenPGP keys associated with &lt;b&gt;{ $identity }&lt;/b&gt;</span>
<a href="#l5.33"></a><span id="l5.33" class="difflineplus">+}</span>
<a href="#l5.34"></a><span id="l5.34" class="difflineplus">+</span>
<a href="#l5.35"></a><span id="l5.35" class="difflineplus">+#   $count (Number) - the number of configured keys associated with the current identity</span>
<a href="#l5.36"></a><span id="l5.36" class="difflineplus">+#   $key (String) - the currently selected OpenPGP key</span>
<a href="#l5.37"></a><span id="l5.37" class="difflineplus">+openpgp-selection-status = { $count -&gt;</span>
<a href="#l5.38"></a><span id="l5.38" class="difflineplus">+    [0]     Select a valid key to enable the OpenPGP protocol.</span>
<a href="#l5.39"></a><span id="l5.39" class="difflineplus">+   *[other] Your current configuration uses key ID &lt;b&gt;{ $key }&lt;/b&gt;</span>
<a href="#l5.40"></a><span id="l5.40" class="difflineplus">+}</span>
<a href="#l5.41"></a><span id="l5.41" class="difflineplus">+</span>
<a href="#l5.42"></a><span id="l5.42" class="difflineplus">+openpgp-add-key-button =</span>
<a href="#l5.43"></a><span id="l5.43" class="difflineplus">+    .label = Add Key</span>
<a href="#l5.44"></a><span id="l5.44" class="difflineplus">+    .accesskey = A</span>
<a href="#l5.45"></a><span id="l5.45" class="difflineplus">+</span>
<a href="#l5.46"></a><span id="l5.46" class="difflineplus">+e2e-learn-more = Learn more</span>
<a href="#l5.47"></a><span id="l5.47" class="difflineplus">+</span>
<a href="#l5.48"></a><span id="l5.48" class="difflineplus">+openpgp-keygen-success = OpenPGP Key created successfully!</span>
<a href="#l5.49"></a><span id="l5.49" class="difflineplus">+</span>
<a href="#l5.50"></a><span id="l5.50" class="difflineplus">+## OpenPGP Key selection area</span>
<a href="#l5.51"></a><span id="l5.51" class="difflineplus">+</span>
<a href="#l5.52"></a><span id="l5.52" class="difflineplus">+openpgp-radio-none =</span>
<a href="#l5.53"></a><span id="l5.53" class="difflineplus">+    .label = None</span>
<a href="#l5.54"></a><span id="l5.54" class="difflineplus">+</span>
<a href="#l5.55"></a><span id="l5.55" class="difflineplus">+openpgp-radio-none-desc = Do not use OpenPGP for this identity.</span>
<a href="#l5.56"></a><span id="l5.56" class="difflineplus">+</span>
<a href="#l5.57"></a><span id="l5.57" class="difflineplus">+#   $key (String) - the expiration date of the OpenPGP key</span>
<a href="#l5.58"></a><span id="l5.58" class="difflineplus">+openpgp-radio-key-expires = Expires on: { $date }</span>
<a href="#l5.59"></a><span id="l5.59" class="difflineplus">+</span>
<a href="#l5.60"></a><span id="l5.60" class="difflineplus">+openpgp-key-expires-image =</span>
<a href="#l5.61"></a><span id="l5.61" class="difflineplus">+    .tooltiptext = Key is expiring in less than 6 months</span>
<a href="#l5.62"></a><span id="l5.62" class="difflineplus">+</span>
<a href="#l5.63"></a><span id="l5.63" class="difflineplus">+#   $key (String) - the expiration date of the OpenPGP key</span>
<a href="#l5.64"></a><span id="l5.64" class="difflineplus">+openpgp-radio-key-expired = Expired on: { $date }</span>
<a href="#l5.65"></a><span id="l5.65" class="difflineplus">+</span>
<a href="#l5.66"></a><span id="l5.66" class="difflineplus">+openpgp-key-expired-image =</span>
<a href="#l5.67"></a><span id="l5.67" class="difflineplus">+    .tooltiptext = Key expired</span>
<a href="#l5.68"></a><span id="l5.68" class="difflineplus">+</span>
<a href="#l5.69"></a><span id="l5.69" class="difflineplus">+openpgp-key-expand-section =</span>
<a href="#l5.70"></a><span id="l5.70" class="difflineplus">+  .tooltiptext = More information</span>
<a href="#l5.71"></a><span id="l5.71" class="difflineplus">+</span>
<a href="#l5.72"></a><span id="l5.72" class="difflineplus">+openpgp-key-revoke-title = Revoke Key</span>
<a href="#l5.73"></a><span id="l5.73" class="difflineplus">+</span>
<a href="#l5.74"></a><span id="l5.74" class="difflineplus">+openpgp-key-edit-title = Change OpenPGP Key</span>
<a href="#l5.75"></a><span id="l5.75" class="difflineplus">+</span>
<a href="#l5.76"></a><span id="l5.76" class="difflineplus">+openpgp-key-edit-date-title = Extend Expiration Date</span>
<a href="#l5.77"></a><span id="l5.77" class="difflineplus">+</span>
<a href="#l5.78"></a><span id="l5.78"> # Strings in keyDetailsDlg.xhtml</span>
<a href="#l5.79"></a><span id="l5.79"> key-type-public = public key</span>
<a href="#l5.80"></a><span id="l5.80"> key-type-primary = primary key</span>
<a href="#l5.81"></a><span id="l5.81"> key-type-subkey = subkey</span>
<a href="#l5.82"></a><span id="l5.82"> key-type-pair-2 = personal key (secret key and public key)</span>
<a href="#l5.83"></a><span id="l5.83"> key-expiry-never = never</span>
<a href="#l5.84"></a><span id="l5.84"> key-usage-encrypt = Encrypt</span>
<a href="#l5.85"></a><span id="l5.85"> key-usage-sign = Sign</span>
<a href="#l5.86"></a><span id="l5.86" class="difflineat">@@ -312,16 +369,22 @@ user-att-photo = User attribute (JPEG im</span>
<a href="#l5.87"></a><span id="l5.87"> revoke-key-question = You are about to revoke the key '{ $userId }'.\n\nYou will no longer be able to sign with this key, and once distributed, others will no longer be able to encrypt with that key. You can still use the key to decrypt old messages.\n\nDo you want to proceed?</span>
<a href="#l5.88"></a><span id="l5.88"> revoke-key-not-present = You have no key (0x{ $keyId }) which matches this revocation certificate!\n\nIf you have lost your key, you must import it (e.g. from a keyserver) before importing the revocation certificate!</span>
<a href="#l5.89"></a><span id="l5.89"> revoke-key-already-revoked = The key 0x{ $keyId } has already been revoked.</span>
<a href="#l5.90"></a><span id="l5.90"> key-man-button-revoke-key = &amp;Revoke Key</span>
<a href="#l5.91"></a><span id="l5.91"> </span>
<a href="#l5.92"></a><span id="l5.92"> # Strings in keyRing.jsm &amp; decryption.jsm</span>
<a href="#l5.93"></a><span id="l5.93"> key-man-button-import = &amp;Import</span>
<a href="#l5.94"></a><span id="l5.94"> </span>
<a href="#l5.95"></a><span id="l5.95" class="difflineplus">+delete-key-title = Delete OpenPGP Key</span>
<a href="#l5.96"></a><span id="l5.96" class="difflineplus">+</span>
<a href="#l5.97"></a><span id="l5.97" class="difflineplus">+delete-key-in-use-title = OpenPGP Key currently in use</span>
<a href="#l5.98"></a><span id="l5.98" class="difflineplus">+</span>
<a href="#l5.99"></a><span id="l5.99" class="difflineplus">+delete-key-in-use-description = Unable to proceed! The Key you selected for deletion is currently being used by this identity.</span>
<a href="#l5.100"></a><span id="l5.100" class="difflineplus">+</span>
<a href="#l5.101"></a><span id="l5.101"> # Strings used in errorHandling.jsm</span>
<a href="#l5.102"></a><span id="l5.102"> key-error-key-spec-not-found = The email address '{ $keySpec }' cannot be matched to a key on your keyring.</span>
<a href="#l5.103"></a><span id="l5.103"> key-error-key-id-not-found = The configured key ID '{ $keySpec }' cannot be found on your keyring.</span>
<a href="#l5.104"></a><span id="l5.104"> </span>
<a href="#l5.105"></a><span id="l5.105"> # Strings used in enigmailKeyManager.js &amp; windows.jsm</span>
<a href="#l5.106"></a><span id="l5.106"> need-online = The function you have selected is not available in offline mode. Please go online and try again.</span>
<a href="#l5.107"></a><span id="l5.107"> </span>
<a href="#l5.108"></a><span id="l5.108"> # Strings used in keyRing.jsm &amp; keyLookupHelper.jsm</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l6.1"></a><span id="l6.1">new file mode 100644</span>
<a href="#l6.2"></a><span id="l6.2" class="difflineminus">--- /dev/null</span>
<a href="#l6.3"></a><span id="l6.3" class="difflineplus">+++ b/mail/extensions/openpgp/content/strings/key-wizard.ftl</span>
<a href="#l6.4"></a><span id="l6.4" class="difflineat">@@ -0,0 +1,110 @@</span>
<a href="#l6.5"></a><span id="l6.5" class="difflineplus">+# This Source Code Form is subject to the terms of the Mozilla Public</span>
<a href="#l6.6"></a><span id="l6.6" class="difflineplus">+# License, v. 2.0. If a copy of the MPL was not distributed with this</span>
<a href="#l6.7"></a><span id="l6.7" class="difflineplus">+# file, You can obtain one at http://mozilla.org/MPL/2.0/.</span>
<a href="#l6.8"></a><span id="l6.8" class="difflineplus">+</span>
<a href="#l6.9"></a><span id="l6.9" class="difflineplus">+#   $identity (String) - the email address of the currently selected identity</span>
<a href="#l6.10"></a><span id="l6.10" class="difflineplus">+key-wizard-dialog-window =</span>
<a href="#l6.11"></a><span id="l6.11" class="difflineplus">+    .title = Add a Personal OpenPGPG Key for { $identity }</span>
<a href="#l6.12"></a><span id="l6.12" class="difflineplus">+</span>
<a href="#l6.13"></a><span id="l6.13" class="difflineplus">+key-wizard-button =</span>
<a href="#l6.14"></a><span id="l6.14" class="difflineplus">+    .buttonlabelaccept = Continue</span>
<a href="#l6.15"></a><span id="l6.15" class="difflineplus">+    .buttonlabelhelp = Go back</span>
<a href="#l6.16"></a><span id="l6.16" class="difflineplus">+</span>
<a href="#l6.17"></a><span id="l6.17" class="difflineplus">+key-wizard-warning = &lt;b&gt;If you have an existing personal key&lt;/b&gt; for this email address, you should import it. Otherwise you will not have access to your archives of encrypted emails, nor be able to read incoming encrypted emails from people who are still using your existing key.</span>
<a href="#l6.18"></a><span id="l6.18" class="difflineplus">+</span>
<a href="#l6.19"></a><span id="l6.19" class="difflineplus">+key-wizard-learn-more = Learn more</span>
<a href="#l6.20"></a><span id="l6.20" class="difflineplus">+</span>
<a href="#l6.21"></a><span id="l6.21" class="difflineplus">+radio-create-key =</span>
<a href="#l6.22"></a><span id="l6.22" class="difflineplus">+    .label = Create a new OpenPGP Key</span>
<a href="#l6.23"></a><span id="l6.23" class="difflineplus">+    .accesskey = C</span>
<a href="#l6.24"></a><span id="l6.24" class="difflineplus">+</span>
<a href="#l6.25"></a><span id="l6.25" class="difflineplus">+radio-import-key =</span>
<a href="#l6.26"></a><span id="l6.26" class="difflineplus">+    .label = Import an existing OpenPGP Key</span>
<a href="#l6.27"></a><span id="l6.27" class="difflineplus">+    .accesskey = I</span>
<a href="#l6.28"></a><span id="l6.28" class="difflineplus">+</span>
<a href="#l6.29"></a><span id="l6.29" class="difflineplus">+radio-gnupg-key =</span>
<a href="#l6.30"></a><span id="l6.30" class="difflineplus">+    .label = Use your external key through GnuPG (e.g. from a smartcard)</span>
<a href="#l6.31"></a><span id="l6.31" class="difflineplus">+    .accesskey = U</span>
<a href="#l6.32"></a><span id="l6.32" class="difflineplus">+</span>
<a href="#l6.33"></a><span id="l6.33" class="difflineplus">+## Generate key section</span>
<a href="#l6.34"></a><span id="l6.34" class="difflineplus">+</span>
<a href="#l6.35"></a><span id="l6.35" class="difflineplus">+openpgp-generate-key-title = Generate OpenPGP Key</span>
<a href="#l6.36"></a><span id="l6.36" class="difflineplus">+</span>
<a href="#l6.37"></a><span id="l6.37" class="difflineplus">+openpgp-generate-key-info = &lt;b&gt;Key generation may take up to several minutes to complete.&lt;/b&gt; Do not exit the application while key generation is in progress. Actively browsing or performing disk-intensive operations during key generation will replenish the 'randomness pool' and speed-up the process. You will be alerted when key generation is completed.</span>
<a href="#l6.38"></a><span id="l6.38" class="difflineplus">+</span>
<a href="#l6.39"></a><span id="l6.39" class="difflineplus">+openpgp-keygen-expiry-title = Key expiry</span>
<a href="#l6.40"></a><span id="l6.40" class="difflineplus">+</span>
<a href="#l6.41"></a><span id="l6.41" class="difflineplus">+openpgp-keygen-expiry-description = Define the expiration time of your newly generated key. You can later control the date to extend it if necessary.</span>
<a href="#l6.42"></a><span id="l6.42" class="difflineplus">+</span>
<a href="#l6.43"></a><span id="l6.43" class="difflineplus">+radio-keygen-expiry =</span>
<a href="#l6.44"></a><span id="l6.44" class="difflineplus">+    .label = Key expires in</span>
<a href="#l6.45"></a><span id="l6.45" class="difflineplus">+    .accesskey = e</span>
<a href="#l6.46"></a><span id="l6.46" class="difflineplus">+</span>
<a href="#l6.47"></a><span id="l6.47" class="difflineplus">+radio-keygen-no-expiry =</span>
<a href="#l6.48"></a><span id="l6.48" class="difflineplus">+    .label = Key does not expire</span>
<a href="#l6.49"></a><span id="l6.49" class="difflineplus">+    .accesskey = d</span>
<a href="#l6.50"></a><span id="l6.50" class="difflineplus">+</span>
<a href="#l6.51"></a><span id="l6.51" class="difflineplus">+openpgp-keygen-days-label =</span>
<a href="#l6.52"></a><span id="l6.52" class="difflineplus">+    .label = days</span>
<a href="#l6.53"></a><span id="l6.53" class="difflineplus">+openpgp-keygen-months-label =</span>
<a href="#l6.54"></a><span id="l6.54" class="difflineplus">+    .label = months</span>
<a href="#l6.55"></a><span id="l6.55" class="difflineplus">+openpgp-keygen-years-label =</span>
<a href="#l6.56"></a><span id="l6.56" class="difflineplus">+    .label = years</span>
<a href="#l6.57"></a><span id="l6.57" class="difflineplus">+</span>
<a href="#l6.58"></a><span id="l6.58" class="difflineplus">+openpgp-keygen-advanced-title = Advanced settings</span>
<a href="#l6.59"></a><span id="l6.59" class="difflineplus">+</span>
<a href="#l6.60"></a><span id="l6.60" class="difflineplus">+openpgp-keygen-advanced-description = Control the advanced settings of your OpenPGP Key.</span>
<a href="#l6.61"></a><span id="l6.61" class="difflineplus">+</span>
<a href="#l6.62"></a><span id="l6.62" class="difflineplus">+openpgp-keygen-keytype =</span>
<a href="#l6.63"></a><span id="l6.63" class="difflineplus">+    .value = Key type:</span>
<a href="#l6.64"></a><span id="l6.64" class="difflineplus">+    .accesskey = t</span>
<a href="#l6.65"></a><span id="l6.65" class="difflineplus">+</span>
<a href="#l6.66"></a><span id="l6.66" class="difflineplus">+openpgp-keygen-keysize =</span>
<a href="#l6.67"></a><span id="l6.67" class="difflineplus">+    .value = Key size:</span>
<a href="#l6.68"></a><span id="l6.68" class="difflineplus">+    .accesskey = s</span>
<a href="#l6.69"></a><span id="l6.69" class="difflineplus">+</span>
<a href="#l6.70"></a><span id="l6.70" class="difflineplus">+openpgp-keygen-type-rsa =</span>
<a href="#l6.71"></a><span id="l6.71" class="difflineplus">+    .label = RSA</span>
<a href="#l6.72"></a><span id="l6.72" class="difflineplus">+</span>
<a href="#l6.73"></a><span id="l6.73" class="difflineplus">+openpgp-keygen-type-ecc =</span>
<a href="#l6.74"></a><span id="l6.74" class="difflineplus">+    .label = ECC (Elliptic Curve)</span>
<a href="#l6.75"></a><span id="l6.75" class="difflineplus">+</span>
<a href="#l6.76"></a><span id="l6.76" class="difflineplus">+openpgp-keygen-button = Generate key</span>
<a href="#l6.77"></a><span id="l6.77" class="difflineplus">+</span>
<a href="#l6.78"></a><span id="l6.78" class="difflineplus">+openpgp-keygen-progress-title = Generating your new OpenPGP Key</span>
<a href="#l6.79"></a><span id="l6.79" class="difflineplus">+</span>
<a href="#l6.80"></a><span id="l6.80" class="difflineplus">+openpgp-keygen-confirm =</span>
<a href="#l6.81"></a><span id="l6.81" class="difflineplus">+    .label = Confirm</span>
<a href="#l6.82"></a><span id="l6.82" class="difflineplus">+</span>
<a href="#l6.83"></a><span id="l6.83" class="difflineplus">+openpgp-keygen-dismiss =</span>
<a href="#l6.84"></a><span id="l6.84" class="difflineplus">+    .label = Cancel</span>
<a href="#l6.85"></a><span id="l6.85" class="difflineplus">+</span>
<a href="#l6.86"></a><span id="l6.86" class="difflineplus">+openpgp-keygen-cancel =</span>
<a href="#l6.87"></a><span id="l6.87" class="difflineplus">+    .label = Cancel process</span>
<a href="#l6.88"></a><span id="l6.88" class="difflineplus">+</span>
<a href="#l6.89"></a><span id="l6.89" class="difflineplus">+openpgp-keygen-missing-username = There is no name specified for the current account. Please enter a value in the field  &quot;Your name&quot; in the account settings.</span>
<a href="#l6.90"></a><span id="l6.90" class="difflineplus">+openpgp-keygen-long-expiry = You cannot create a key that expires in more than 100 years.</span>
<a href="#l6.91"></a><span id="l6.91" class="difflineplus">+openpgp-keygen-short-expiry = Your key must be valid for at least one day.</span>
<a href="#l6.92"></a><span id="l6.92" class="difflineplus">+</span>
<a href="#l6.93"></a><span id="l6.93" class="difflineplus">+openpgp-keygen-ongoing = Key generation already in progress!</span>
<a href="#l6.94"></a><span id="l6.94" class="difflineplus">+</span>
<a href="#l6.95"></a><span id="l6.95" class="difflineplus">+openpgp-keygen-error-core = Unable to initialize OpenPGP Core Service</span>
<a href="#l6.96"></a><span id="l6.96" class="difflineplus">+</span>
<a href="#l6.97"></a><span id="l6.97" class="difflineplus">+openpgp-keygen-error-failed = OpenPGP Key generation unexpectedly failed</span>
<a href="#l6.98"></a><span id="l6.98" class="difflineplus">+</span>
<a href="#l6.99"></a><span id="l6.99" class="difflineplus">+#   $identity (String) - the newly generate OpenPGP Key</span>
<a href="#l6.100"></a><span id="l6.100" class="difflineplus">+openpgp-keygen-error-revocation = OpenPGP Key created successfully, but failed to obtain revocation for key { $key }</span>
<a href="#l6.101"></a><span id="l6.101" class="difflineplus">+</span>
<a href="#l6.102"></a><span id="l6.102" class="difflineplus">+openpgp-keygen-abort-title = Abort key generation?</span>
<a href="#l6.103"></a><span id="l6.103" class="difflineplus">+openpgp-keygen-abort = OpenPGP Key generation currently in progress, are you sure you want to cancel it?</span>
<a href="#l6.104"></a><span id="l6.104" class="difflineplus">+</span>
<a href="#l6.105"></a><span id="l6.105" class="difflineplus">+#   $identity (String) - the name and email address of the currently selected identity</span>
<a href="#l6.106"></a><span id="l6.106" class="difflineplus">+openpgp-key-confirm = Generate public and secret key for { $identity }?</span>
<a href="#l6.107"></a><span id="l6.107" class="difflineplus">+</span>
<a href="#l6.108"></a><span id="l6.108" class="difflineplus">+## Import Key section</span>
<a href="#l6.109"></a><span id="l6.109" class="difflineplus">+</span>
<a href="#l6.110"></a><span id="l6.110" class="difflineplus">+openpgp-import-key-title = Import existing OpenPGP Key</span>
<a href="#l6.111"></a><span id="l6.111" class="difflineplus">+</span>
<a href="#l6.112"></a><span id="l6.112" class="difflineplus">+## External Key section</span>
<a href="#l6.113"></a><span id="l6.113" class="difflineplus">+</span>
<a href="#l6.114"></a><span id="l6.114" class="difflineplus">+openpgp-external-key-title = External GnuPG Key</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l7.1"></a><span id="l7.1" class="difflineminus">--- a/mail/extensions/openpgp/content/ui/enigmailKeygen.js</span>
<a href="#l7.2"></a><span id="l7.2" class="difflineplus">+++ b/mail/extensions/openpgp/content/ui/enigmailKeygen.js</span>
<a href="#l7.3"></a><span id="l7.3" class="difflineat">@@ -47,17 +47,17 @@ var gGeneratedKey = null;</span>
<a href="#l7.4"></a><span id="l7.4"> var gUsedId;</span>
<a href="#l7.5"></a><span id="l7.5"> </span>
<a href="#l7.6"></a><span id="l7.6"> const KEYGEN_CANCELLED = &quot;cancelled&quot;;</span>
<a href="#l7.7"></a><span id="l7.7"> const DEFAULT_FILE_PERMS = 0o600;</span>
<a href="#l7.8"></a><span id="l7.8"> </span>
<a href="#l7.9"></a><span id="l7.9"> let revocationFilePrefix1 =</span>
<a href="#l7.10"></a><span id="l7.10">   &quot;This is a revocation certificate for the OpenPGP key:&quot;;</span>
<a href="#l7.11"></a><span id="l7.11"> let revocationFilePrefix2 = `</span>
<a href="#l7.12"></a><span id="l7.12" class="difflineminus">-A revocation certificate is a kind of &quot;kill switch&quot; to publicly</span>
<a href="#l7.13"></a><span id="l7.13" class="difflineplus">+A revocation certificate is kind of a &quot;kill switch&quot; to publicly</span>
<a href="#l7.14"></a><span id="l7.14"> declare that a key shall no longer be used.  It is not possible</span>
<a href="#l7.15"></a><span id="l7.15"> to retract such a revocation certificate once it has been published.</span>
<a href="#l7.16"></a><span id="l7.16"> </span>
<a href="#l7.17"></a><span id="l7.17"> Use it to revoke this key in case of a secret key compromise, or loss of</span>
<a href="#l7.18"></a><span id="l7.18"> the secret key, or loss of passphrase of the secret key.</span>
<a href="#l7.19"></a><span id="l7.19"> </span>
<a href="#l7.20"></a><span id="l7.20"> To avoid an accidental use of this file, a colon has been inserted</span>
<a href="#l7.21"></a><span id="l7.21"> before the 5 dashes below.  Remove this colon with a text editor</span>
<a href="#l7.22"></a><span id="l7.22" class="difflineat">@@ -254,17 +254,17 @@ function enigmailKeygenStart() {</span>
<a href="#l7.23"></a><span id="l7.23"> </span>
<a href="#l7.24"></a><span id="l7.24">   var progMeter = document.getElementById(&quot;keygenProgress&quot;);</span>
<a href="#l7.25"></a><span id="l7.25">   progMeter.setAttribute(&quot;value&quot;, 100);</span>
<a href="#l7.26"></a><span id="l7.26"> </span>
<a href="#l7.27"></a><span id="l7.27">   if (!gGeneratedKey || gGeneratedKey == KEYGEN_CANCELLED) {</span>
<a href="#l7.28"></a><span id="l7.28">     throw new Error(&quot;key generation failed&quot;);</span>
<a href="#l7.29"></a><span id="l7.29">   } else {</span>
<a href="#l7.30"></a><span id="l7.30">     console.debug(&quot;saving new key id &quot; + gGeneratedKey);</span>
<a href="#l7.31"></a><span id="l7.31" class="difflineminus">-    curId.setCharAttribute(&quot;openpgp_key_id&quot;, gGeneratedKey);</span>
<a href="#l7.32"></a><span id="l7.32" class="difflineplus">+    curId.setUnicharAttribute(&quot;openpgp_key_id&quot;, gGeneratedKey);</span>
<a href="#l7.33"></a><span id="l7.33">     EnigSavePrefs();</span>
<a href="#l7.34"></a><span id="l7.34">   }</span>
<a href="#l7.35"></a><span id="l7.35"> </span>
<a href="#l7.36"></a><span id="l7.36">   closeAndReset();</span>
<a href="#l7.37"></a><span id="l7.37"> </span>
<a href="#l7.38"></a><span id="l7.38">   let rev = cApi.sync(cApi.getNewRevocation(&quot;0x&quot; + gGeneratedKey));</span>
<a href="#l7.39"></a><span id="l7.39">   if (!rev) {</span>
<a href="#l7.40"></a><span id="l7.40">     throw new Error(&quot;failed to obtain revocation for key &quot; + gGeneratedKey);</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l8.1"></a><span id="l8.1" class="difflineminus">--- a/mail/extensions/openpgp/content/ui/keyDetailsDlg.js</span>
<a href="#l8.2"></a><span id="l8.2" class="difflineplus">+++ b/mail/extensions/openpgp/content/ui/keyDetailsDlg.js</span>
<a href="#l8.3"></a><span id="l8.3" class="difflineat">@@ -34,17 +34,19 @@ var gTreeFuncs = null;</span>
<a href="#l8.4"></a><span id="l8.4"> var gAllEmails = [];</span>
<a href="#l8.5"></a><span id="l8.5"> var gFingerprint = &quot;&quot;;</span>
<a href="#l8.6"></a><span id="l8.6"> </span>
<a href="#l8.7"></a><span id="l8.7"> var gAcceptanceRadio = null;</span>
<a href="#l8.8"></a><span id="l8.8"> var gOriginalAcceptance;</span>
<a href="#l8.9"></a><span id="l8.9"> var gUpdateAllowed = false;</span>
<a href="#l8.10"></a><span id="l8.10"> </span>
<a href="#l8.11"></a><span id="l8.11"> async function onLoad() {</span>
<a href="#l8.12"></a><span id="l8.12" class="difflineminus">-  window.arguments[1].refresh = false;</span>
<a href="#l8.13"></a><span id="l8.13" class="difflineplus">+  if (window.arguments[1]) {</span>
<a href="#l8.14"></a><span id="l8.14" class="difflineplus">+    window.arguments[1].refresh = false;</span>
<a href="#l8.15"></a><span id="l8.15" class="difflineplus">+  }</span>
<a href="#l8.16"></a><span id="l8.16"> </span>
<a href="#l8.17"></a><span id="l8.17">   gAcceptanceRadio = document.getElementById(&quot;acceptanceRadio&quot;);</span>
<a href="#l8.18"></a><span id="l8.18"> </span>
<a href="#l8.19"></a><span id="l8.19">   gKeyId = window.arguments[0].keyId;</span>
<a href="#l8.20"></a><span id="l8.20"> </span>
<a href="#l8.21"></a><span id="l8.21">   let accept = document</span>
<a href="#l8.22"></a><span id="l8.22">     .getElementById(&quot;enigmailKeyDetailsDlg&quot;)</span>
<a href="#l8.23"></a><span id="l8.23">     .getButton(&quot;accept&quot;);</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l9.1"></a><span id="l9.1" class="difflineminus">--- a/mail/extensions/openpgp/content/ui/keyDetailsDlg.xhtml</span>
<a href="#l9.2"></a><span id="l9.2" class="difflineplus">+++ b/mail/extensions/openpgp/content/ui/keyDetailsDlg.xhtml</span>
<a href="#l9.3"></a><span id="l9.3" class="difflineat">@@ -2,26 +2,27 @@</span>
<a href="#l9.4"></a><span id="l9.4"> &lt;!--</span>
<a href="#l9.5"></a><span id="l9.5">  * This Source Code Form is subject to the terms of the Mozilla Public</span>
<a href="#l9.6"></a><span id="l9.6">  * License, v. 2.0. If a copy of the MPL was not distributed with this</span>
<a href="#l9.7"></a><span id="l9.7">  * file, You can obtain one at https://mozilla.org/MPL/2.0/.</span>
<a href="#l9.8"></a><span id="l9.8"> --&gt;</span>
<a href="#l9.9"></a><span id="l9.9"> </span>
<a href="#l9.10"></a><span id="l9.10"> &lt;?xml-stylesheet href=&quot;chrome://messenger/skin/messenger.css&quot; type=&quot;text/css&quot;?&gt;</span>
<a href="#l9.11"></a><span id="l9.11"> &lt;?xml-stylesheet href=&quot;chrome://messenger/skin/openpgp/enigmail.css&quot; type=&quot;text/css&quot;?&gt;</span>
<a href="#l9.12"></a><span id="l9.12" class="difflineplus">+&lt;?xml-stylesheet href=&quot;chrome://messenger/skin/accountManage.css&quot; type=&quot;text/css&quot;?&gt;</span>
<a href="#l9.13"></a><span id="l9.13"> </span>
<a href="#l9.14"></a><span id="l9.14"> &lt;!DOCTYPE window [</span>
<a href="#l9.15"></a><span id="l9.15"> &lt;!ENTITY % brandDTD SYSTEM &quot;chrome://branding/locale/brand.dtd&quot; &gt;</span>
<a href="#l9.16"></a><span id="l9.16"> %brandDTD;</span>
<a href="#l9.17"></a><span id="l9.17"> ]&gt;</span>
<a href="#l9.18"></a><span id="l9.18"> </span>
<a href="#l9.19"></a><span id="l9.19"> &lt;window data-l10n-id=&quot;openpgp-key-details-title&quot;</span>
<a href="#l9.20"></a><span id="l9.20">         xmlns=&quot;http://www.mozilla.org/keymaster/gatekeeper/there.is.only.xul&quot;</span>
<a href="#l9.21"></a><span id="l9.21">         xmlns:html=&quot;http://www.w3.org/1999/xhtml&quot;</span>
<a href="#l9.22"></a><span id="l9.22" class="difflineminus">-        style=&quot;min-width:60em; min-height:30em&quot;</span>
<a href="#l9.23"></a><span id="l9.23" class="difflineplus">+        style=&quot;width:60em;&quot;</span>
<a href="#l9.24"></a><span id="l9.24">         persist=&quot;width height&quot;</span>
<a href="#l9.25"></a><span id="l9.25">         onload=&quot;onLoad();&quot;&gt;</span>
<a href="#l9.26"></a><span id="l9.26"> &lt;dialog id=&quot;enigmailKeyDetailsDlg&quot;</span>
<a href="#l9.27"></a><span id="l9.27">         buttons=&quot;accept&quot;</span>
<a href="#l9.28"></a><span id="l9.28">         data-l10n-id=&quot;openpgp-card-details-close-window-label&quot;&gt;</span>
<a href="#l9.29"></a><span id="l9.29"> </span>
<a href="#l9.30"></a><span id="l9.30">   &lt;script type=&quot;application/x-javascript&quot; src=&quot;chrome://openpgp/content/ui/enigmailCommon.js&quot;/&gt;</span>
<a href="#l9.31"></a><span id="l9.31">   &lt;script type=&quot;application/x-javascript&quot; src=&quot;chrome://openpgp/content/ui/keyDetailsDlg.js&quot;/&gt;</span>
<a href="#l9.32"></a><span id="l9.32" class="difflineat">@@ -35,56 +36,58 @@</span>
<a href="#l9.33"></a><span id="l9.33">   &lt;broadcasterset&gt;</span>
<a href="#l9.34"></a><span id="l9.34">     &lt;broadcaster id=&quot;ownKeyCommands&quot; hidden=&quot;true&quot;/&gt;</span>
<a href="#l9.35"></a><span id="l9.35">   &lt;/broadcasterset&gt;</span>
<a href="#l9.36"></a><span id="l9.36"> </span>
<a href="#l9.37"></a><span id="l9.37">   &lt;vbox&gt;</span>
<a href="#l9.38"></a><span id="l9.38">     &lt;html:table&gt;</span>
<a href="#l9.39"></a><span id="l9.39">       &lt;html:tr&gt;</span>
<a href="#l9.40"></a><span id="l9.40">         &lt;html:th data-l10n-id=&quot;openpgp-key-details-user-id2-label&quot;/&gt;</span>
<a href="#l9.41"></a><span id="l9.41" class="difflineminus">-        &lt;html:td&gt;</span>
<a href="#l9.42"></a><span id="l9.42" class="difflineminus">-          &lt;html:input id=&quot;userId&quot; class=&quot;plain&quot; style=&quot;white-space: pre;&quot;</span>
<a href="#l9.43"></a><span id="l9.43" class="difflineplus">+        &lt;html:td class=&quot;input-container&quot;&gt;</span>
<a href="#l9.44"></a><span id="l9.44" class="difflineplus">+          &lt;html:input id=&quot;userId&quot; type=&quot;text&quot; class=&quot;plain&quot;</span>
<a href="#l9.45"></a><span id="l9.45">                       readonly=&quot;readonly&quot; value=&quot;?&quot; size=&quot;60&quot;/&gt;</span>
<a href="#l9.46"></a><span id="l9.46">         &lt;/html:td&gt;</span>
<a href="#l9.47"></a><span id="l9.47">       &lt;/html:tr&gt;</span>
<a href="#l9.48"></a><span id="l9.48">       &lt;html:tr&gt;</span>
<a href="#l9.49"></a><span id="l9.49">         &lt;html:th data-l10n-id=&quot;openpgp-key-details-key-type-label&quot;/&gt;</span>
<a href="#l9.50"></a><span id="l9.50" class="difflineminus">-        &lt;html:td&gt;</span>
<a href="#l9.51"></a><span id="l9.51" class="difflineminus">-          &lt;html:input id=&quot;keyType&quot; class=&quot;plain&quot; style=&quot;white-space: pre;&quot;</span>
<a href="#l9.52"></a><span id="l9.52" class="difflineplus">+        &lt;html:td class=&quot;input-container&quot;&gt;</span>
<a href="#l9.53"></a><span id="l9.53" class="difflineplus">+          &lt;html:input id=&quot;keyType&quot; type=&quot;text&quot; class=&quot;plain&quot;</span>
<a href="#l9.54"></a><span id="l9.54">                       readonly=&quot;readonly&quot; value=&quot;?&quot; size=&quot;60&quot;/&gt;</span>
<a href="#l9.55"></a><span id="l9.55">         &lt;/html:td&gt;</span>
<a href="#l9.56"></a><span id="l9.56">       &lt;/html:tr&gt;</span>
<a href="#l9.57"></a><span id="l9.57">       &lt;html:tr&gt;</span>
<a href="#l9.58"></a><span id="l9.58">         &lt;html:th data-l10n-id=&quot;openpgp-key-details-fingerprint-label&quot;/&gt;</span>
<a href="#l9.59"></a><span id="l9.59" class="difflineminus">-        &lt;html:td&gt;</span>
<a href="#l9.60"></a><span id="l9.60" class="difflineminus">-          &lt;html:input id=&quot;fingerprint&quot; class=&quot;plain&quot; style=&quot;white-space: pre;&quot;</span>
<a href="#l9.61"></a><span id="l9.61" class="difflineplus">+        &lt;html:td class=&quot;input-container&quot;&gt;</span>
<a href="#l9.62"></a><span id="l9.62" class="difflineplus">+          &lt;html:input id=&quot;fingerprint&quot; type=&quot;text&quot; class=&quot;plain&quot;</span>
<a href="#l9.63"></a><span id="l9.63">                       readonly=&quot;readonly&quot; value=&quot;?&quot; size=&quot;60&quot;/&gt;</span>
<a href="#l9.64"></a><span id="l9.64">         &lt;/html:td&gt;</span>
<a href="#l9.65"></a><span id="l9.65">       &lt;/html:tr&gt;</span>
<a href="#l9.66"></a><span id="l9.66">       &lt;html:tr&gt;</span>
<a href="#l9.67"></a><span id="l9.67">         &lt;html:th data-l10n-id=&quot;openpgp-key-details-created-header&quot;/&gt;</span>
<a href="#l9.68"></a><span id="l9.68" class="difflineminus">-        &lt;html:td&gt;</span>
<a href="#l9.69"></a><span id="l9.69" class="difflineminus">-          &lt;html:input id=&quot;keyCreated&quot; class=&quot;plain&quot; style=&quot;white-space: pre;&quot;</span>
<a href="#l9.70"></a><span id="l9.70" class="difflineplus">+        &lt;html:td class=&quot;input-container&quot;&gt;</span>
<a href="#l9.71"></a><span id="l9.71" class="difflineplus">+          &lt;html:input id=&quot;keyCreated&quot; type=&quot;text&quot; class=&quot;plain&quot;</span>
<a href="#l9.72"></a><span id="l9.72">                       readonly=&quot;readonly&quot; value=&quot;?&quot; size=&quot;60&quot;/&gt;</span>
<a href="#l9.73"></a><span id="l9.73">         &lt;/html:td&gt;</span>
<a href="#l9.74"></a><span id="l9.74">       &lt;/html:tr&gt;</span>
<a href="#l9.75"></a><span id="l9.75">       &lt;html:tr&gt;</span>
<a href="#l9.76"></a><span id="l9.76">         &lt;html:th data-l10n-id=&quot;openpgp-key-details-expiry-header&quot;/&gt;</span>
<a href="#l9.77"></a><span id="l9.77" class="difflineminus">-        &lt;html:td&gt;</span>
<a href="#l9.78"></a><span id="l9.78" class="difflineminus">-          &lt;html:input id=&quot;keyExpiry&quot; class=&quot;plain&quot; style=&quot;white-space: pre;&quot;</span>
<a href="#l9.79"></a><span id="l9.79" class="difflineplus">+        &lt;html:td class=&quot;input-container&quot;&gt;</span>
<a href="#l9.80"></a><span id="l9.80" class="difflineplus">+          &lt;html:input id=&quot;keyExpiry&quot; type=&quot;text&quot; class=&quot;plain&quot;</span>
<a href="#l9.81"></a><span id="l9.81">                       readonly=&quot;readonly&quot; value=&quot;?&quot; size=&quot;60&quot;/&gt;</span>
<a href="#l9.82"></a><span id="l9.82">         &lt;/html:td&gt;</span>
<a href="#l9.83"></a><span id="l9.83">       &lt;/html:tr&gt;</span>
<a href="#l9.84"></a><span id="l9.84">     &lt;/html:table&gt;</span>
<a href="#l9.85"></a><span id="l9.85">     &lt;vbox class=&quot;enigmailCaptionbox&quot; id=&quot;alsoknown&quot; flex=&quot;1&quot;&gt;</span>
<a href="#l9.86"></a><span id="l9.86">       &lt;html:h1 data-l10n-id=&quot;openpgp-key-details-also-known-label&quot;/&gt;</span>
<a href="#l9.87"></a><span id="l9.87">       &lt;richlistbox id=&quot;additionalUid&quot; style=&quot;height: 4em;&quot; flex=&quot;1&quot;/&gt;</span>
<a href="#l9.88"></a><span id="l9.88">     &lt;/vbox&gt;</span>
<a href="#l9.89"></a><span id="l9.89">   &lt;/vbox&gt;</span>
<a href="#l9.90"></a><span id="l9.90"> </span>
<a href="#l9.91"></a><span id="l9.91" class="difflineplus">+  &lt;separator/&gt;</span>
<a href="#l9.92"></a><span id="l9.92" class="difflineplus">+</span>
<a href="#l9.93"></a><span id="l9.93">   &lt;tabbox flex=&quot;1&quot; style=&quot;margin:5px&quot; id=&quot;mainTabs&quot;&gt;</span>
<a href="#l9.94"></a><span id="l9.94">     &lt;tabs id=&quot;mainTabBox&quot;&gt;</span>
<a href="#l9.95"></a><span id="l9.95">       &lt;tab id=&quot;acceptanceTab&quot; data-l10n-id=&quot;openpgp-acceptance-label&quot;/&gt;</span>
<a href="#l9.96"></a><span id="l9.96">       &lt;tab id=&quot;signaturesTab&quot; data-l10n-id=&quot;openpgp-key-details-signatures-tab&quot;/&gt;</span>
<a href="#l9.97"></a><span id="l9.97">       &lt;tab id=&quot;structureTab&quot; data-l10n-id=&quot;openpgp-key-details-structure-tab&quot;/&gt;</span>
<a href="#l9.98"></a><span id="l9.98">     &lt;/tabs&gt;</span>
<a href="#l9.99"></a><span id="l9.99"> </span>
<a href="#l9.100"></a><span id="l9.100">     &lt;tabpanels flex=&quot;1&quot; id=&quot;mainTabPanel&quot;&gt;</span>
<a href="#l9.101"></a><span id="l9.101" class="difflineat">@@ -112,17 +115,16 @@</span>
<a href="#l9.102"></a><span id="l9.102">               hidecolumnpicker=&quot;true&quot;</span>
<a href="#l9.103"></a><span id="l9.103">               ondblclick=&quot;sigHandleDblClick(event)&quot;&gt;</span>
<a href="#l9.104"></a><span id="l9.104"> </span>
<a href="#l9.105"></a><span id="l9.105">           &lt;treecols&gt;</span>
<a href="#l9.106"></a><span id="l9.106">             &lt;treecol id=&quot;sig_uid_col&quot; flex=&quot;1&quot;</span>
<a href="#l9.107"></a><span id="l9.107">                      data-l10n-id=&quot;openpgp-key-details-uid-certified-col&quot;</span>
<a href="#l9.108"></a><span id="l9.108">                      primary=&quot;true&quot;/&gt;</span>
<a href="#l9.109"></a><span id="l9.109">             &lt;splitter class=&quot;tree-splitter&quot;/&gt;</span>
<a href="#l9.110"></a><span id="l9.110" class="difflineminus">-            &lt;splitter class=&quot;tree-splitter&quot;/&gt;</span>
<a href="#l9.111"></a><span id="l9.111">             &lt;treecol id=&quot;sig_keyid_col&quot;</span>
<a href="#l9.112"></a><span id="l9.112">                      data-l10n-id=&quot;openpgp-key-id-label&quot;</span>
<a href="#l9.113"></a><span id="l9.113">                      persist=&quot;width&quot;/&gt;</span>
<a href="#l9.114"></a><span id="l9.114">             &lt;treecol id=&quot;sig_created_col&quot;</span>
<a href="#l9.115"></a><span id="l9.115">                      data-l10n-id=&quot;openpgp-key-details-created-label&quot;</span>
<a href="#l9.116"></a><span id="l9.116">                      persist=&quot;width&quot;/&gt;</span>
<a href="#l9.117"></a><span id="l9.117">           &lt;/treecols&gt;</span>
<a href="#l9.118"></a><span id="l9.118"> </span>
<a href="#l9.119"></a><span id="l9.119" class="difflineat">@@ -134,17 +136,17 @@</span>
<a href="#l9.120"></a><span id="l9.120">       &lt;vbox id =&quot;structurePanel&quot;&gt;</span>
<a href="#l9.121"></a><span id="l9.121">         &lt;hbox flex=&quot;1&quot;&gt;</span>
<a href="#l9.122"></a><span id="l9.122">           &lt;tree id=&quot;subkeyList&quot; flex=&quot;1&quot;</span>
<a href="#l9.123"></a><span id="l9.123">                 enableColumnDrag=&quot;true&quot;</span>
<a href="#l9.124"></a><span id="l9.124">                 style=&quot;height:100px&quot;</span>
<a href="#l9.125"></a><span id="l9.125">                 hidecolumnpicker=&quot;false&quot;&gt;</span>
<a href="#l9.126"></a><span id="l9.126"> </span>
<a href="#l9.127"></a><span id="l9.127">             &lt;treecols&gt;</span>
<a href="#l9.128"></a><span id="l9.128" class="difflineminus">-              &lt;treecol id=&quot;keyTypeCol&quot; primary=&quot;true&quot;</span>
<a href="#l9.129"></a><span id="l9.129" class="difflineplus">+              &lt;treecol id=&quot;keyTypeCol&quot;</span>
<a href="#l9.130"></a><span id="l9.130">                        data-l10n-id=&quot;openpgp-key-details-key-part-label&quot;</span>
<a href="#l9.131"></a><span id="l9.131">                        style=&quot;width:71px&quot;</span>
<a href="#l9.132"></a><span id="l9.132">                        persist=&quot;width&quot;/&gt;</span>
<a href="#l9.133"></a><span id="l9.133">               &lt;splitter class=&quot;tree-splitter&quot;/&gt;</span>
<a href="#l9.134"></a><span id="l9.134">               &lt;treecol id=&quot;keyUsageCol&quot;</span>
<a href="#l9.135"></a><span id="l9.135">                        data-l10n-id=&quot;openpgp-key-details-usage-label&quot;</span>
<a href="#l9.136"></a><span id="l9.136">                        flex=&quot;1&quot;/&gt;</span>
<a href="#l9.137"></a><span id="l9.137">               &lt;splitter class=&quot;tree-splitter&quot;/&gt;</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l10.1"></a><span id="l10.1">new file mode 100644</span>
<a href="#l10.2"></a><span id="l10.2" class="difflineminus">--- /dev/null</span>
<a href="#l10.3"></a><span id="l10.3" class="difflineplus">+++ b/mail/extensions/openpgp/content/ui/keyWizard.js</span>
<a href="#l10.4"></a><span id="l10.4" class="difflineat">@@ -0,0 +1,569 @@</span>
<a href="#l10.5"></a><span id="l10.5" class="difflineplus">+/* This Source Code Form is subject to the terms of the Mozilla Public</span>
<a href="#l10.6"></a><span id="l10.6" class="difflineplus">+ * License, v. 2.0. If a copy of the MPL was not distributed with this</span>
<a href="#l10.7"></a><span id="l10.7" class="difflineplus">+ * file, You can obtain one at http://mozilla.org/MPL/2.0/. */</span>
<a href="#l10.8"></a><span id="l10.8" class="difflineplus">+</span>
<a href="#l10.9"></a><span id="l10.9" class="difflineplus">+// Uses: chrome://openpgp/content/ui/enigmailCommon.js</span>
<a href="#l10.10"></a><span id="l10.10" class="difflineplus">+</span>
<a href="#l10.11"></a><span id="l10.11" class="difflineplus">+&quot;use strict&quot;;</span>
<a href="#l10.12"></a><span id="l10.12" class="difflineplus">+</span>
<a href="#l10.13"></a><span id="l10.13" class="difflineplus">+// Modules</span>
<a href="#l10.14"></a><span id="l10.14" class="difflineplus">+/* global EnigmailApp: false, EnigmailKeyRing: false, GetEnigmailSvc: false,</span>
<a href="#l10.15"></a><span id="l10.15" class="difflineplus">+   EnigInitCommon: false, EnigSavePrefs: false, EnigFilePicker: false,</span>
<a href="#l10.16"></a><span id="l10.16" class="difflineplus">+   EnigGetFilePath: false, EnigmailWindows: false */</span>
<a href="#l10.17"></a><span id="l10.17" class="difflineplus">+</span>
<a href="#l10.18"></a><span id="l10.18" class="difflineplus">+// Initialize enigmailCommon.</span>
<a href="#l10.19"></a><span id="l10.19" class="difflineplus">+EnigInitCommon(&quot;enigmailKeygen&quot;);</span>
<a href="#l10.20"></a><span id="l10.20" class="difflineplus">+</span>
<a href="#l10.21"></a><span id="l10.21" class="difflineplus">+var { Services } = ChromeUtils.import(&quot;resource://gre/modules/Services.jsm&quot;);</span>
<a href="#l10.22"></a><span id="l10.22" class="difflineplus">+var { AppConstants } = ChromeUtils.import(</span>
<a href="#l10.23"></a><span id="l10.23" class="difflineplus">+  &quot;resource://gre/modules/AppConstants.jsm&quot;</span>
<a href="#l10.24"></a><span id="l10.24" class="difflineplus">+);</span>
<a href="#l10.25"></a><span id="l10.25" class="difflineplus">+var EnigmailCryptoAPI = ChromeUtils.import(</span>
<a href="#l10.26"></a><span id="l10.26" class="difflineplus">+  &quot;chrome://openpgp/content/modules/cryptoAPI.jsm&quot;</span>
<a href="#l10.27"></a><span id="l10.27" class="difflineplus">+).EnigmailCryptoAPI;</span>
<a href="#l10.28"></a><span id="l10.28" class="difflineplus">+var { EnigmailFiles } = ChromeUtils.import(</span>
<a href="#l10.29"></a><span id="l10.29" class="difflineplus">+  &quot;chrome://openpgp/content/modules/files.jsm&quot;</span>
<a href="#l10.30"></a><span id="l10.30" class="difflineplus">+);</span>
<a href="#l10.31"></a><span id="l10.31" class="difflineplus">+var OpenPGPMasterpass = ChromeUtils.import(</span>
<a href="#l10.32"></a><span id="l10.32" class="difflineplus">+  &quot;chrome://openpgp/content/modules/masterpass.jsm&quot;</span>
<a href="#l10.33"></a><span id="l10.33" class="difflineplus">+).OpenPGPMasterpass;</span>
<a href="#l10.34"></a><span id="l10.34" class="difflineplus">+var { RNP } = ChromeUtils.import(&quot;chrome://openpgp/content/modules/RNP.jsm&quot;);</span>
<a href="#l10.35"></a><span id="l10.35" class="difflineplus">+</span>
<a href="#l10.36"></a><span id="l10.36" class="difflineplus">+// UI variables.</span>
<a href="#l10.37"></a><span id="l10.37" class="difflineplus">+var gIdentity;</span>
<a href="#l10.38"></a><span id="l10.38" class="difflineplus">+var gSubDialog;</span>
<a href="#l10.39"></a><span id="l10.39" class="difflineplus">+var kStartSection;</span>
<a href="#l10.40"></a><span id="l10.40" class="difflineplus">+var kDialog;</span>
<a href="#l10.41"></a><span id="l10.41" class="difflineplus">+var kCurrentSection = &quot;start&quot;;</span>
<a href="#l10.42"></a><span id="l10.42" class="difflineplus">+var kGenerating = false;</span>
<a href="#l10.43"></a><span id="l10.43" class="difflineplus">+var kButtonLabel;</span>
<a href="#l10.44"></a><span id="l10.44" class="difflineplus">+</span>
<a href="#l10.45"></a><span id="l10.45" class="difflineplus">+// OpenPGP variables.</span>
<a href="#l10.46"></a><span id="l10.46" class="difflineplus">+var gKeygenRequest;</span>
<a href="#l10.47"></a><span id="l10.47" class="difflineplus">+var gAllData = &quot;&quot;;</span>
<a href="#l10.48"></a><span id="l10.48" class="difflineplus">+var gGeneratedKey = null;</span>
<a href="#l10.49"></a><span id="l10.49" class="difflineplus">+</span>
<a href="#l10.50"></a><span id="l10.50" class="difflineplus">+const DEFAULT_FILE_PERMS = 0o600;</span>
<a href="#l10.51"></a><span id="l10.51" class="difflineplus">+</span>
<a href="#l10.52"></a><span id="l10.52" class="difflineplus">+// The revocation strings are not localization since the revocation certificate</span>
<a href="#l10.53"></a><span id="l10.53" class="difflineplus">+// will be published to others who may not know the native language of the user.</span>
<a href="#l10.54"></a><span id="l10.54" class="difflineplus">+const revocationFilePrefix1 =</span>
<a href="#l10.55"></a><span id="l10.55" class="difflineplus">+  &quot;This is a revocation certificate for the OpenPGP key:&quot;;</span>
<a href="#l10.56"></a><span id="l10.56" class="difflineplus">+const revocationFilePrefix2 = `</span>
<a href="#l10.57"></a><span id="l10.57" class="difflineplus">+A revocation certificate is kind of a &quot;kill switch&quot; to publicly</span>
<a href="#l10.58"></a><span id="l10.58" class="difflineplus">+declare that a key shall no longer be used.  It is not possible</span>
<a href="#l10.59"></a><span id="l10.59" class="difflineplus">+to retract such a revocation certificate once it has been published.</span>
<a href="#l10.60"></a><span id="l10.60" class="difflineplus">+</span>
<a href="#l10.61"></a><span id="l10.61" class="difflineplus">+Use it to revoke this key in case of a secret key compromise, or loss of</span>
<a href="#l10.62"></a><span id="l10.62" class="difflineplus">+the secret key, or loss of passphrase of the secret key.</span>
<a href="#l10.63"></a><span id="l10.63" class="difflineplus">+</span>
<a href="#l10.64"></a><span id="l10.64" class="difflineplus">+To avoid an accidental use of this file, a colon has been inserted</span>
<a href="#l10.65"></a><span id="l10.65" class="difflineplus">+before the 5 dashes below.  Remove this colon with a text editor</span>
<a href="#l10.66"></a><span id="l10.66" class="difflineplus">+before importing and publishing this revocation certificate.</span>
<a href="#l10.67"></a><span id="l10.67" class="difflineplus">+</span>
<a href="#l10.68"></a><span id="l10.68" class="difflineplus">+:`;</span>
<a href="#l10.69"></a><span id="l10.69" class="difflineplus">+</span>
<a href="#l10.70"></a><span id="l10.70" class="difflineplus">+// Dialog event listeners.</span>
<a href="#l10.71"></a><span id="l10.71" class="difflineplus">+document.addEventListener(&quot;dialogaccept&quot;, wizardContinue);</span>
<a href="#l10.72"></a><span id="l10.72" class="difflineplus">+document.addEventListener(&quot;dialoghelp&quot;, goBack);</span>
<a href="#l10.73"></a><span id="l10.73" class="difflineplus">+document.addEventListener(&quot;dialogcancel&quot;, onClose);</span>
<a href="#l10.74"></a><span id="l10.74" class="difflineplus">+</span>
<a href="#l10.75"></a><span id="l10.75" class="difflineplus">+/**</span>
<a href="#l10.76"></a><span id="l10.76" class="difflineplus">+ * Initialize the keyWizard dialog.</span>
<a href="#l10.77"></a><span id="l10.77" class="difflineplus">+ */</span>
<a href="#l10.78"></a><span id="l10.78" class="difflineplus">+async function init() {</span>
<a href="#l10.79"></a><span id="l10.79" class="difflineplus">+  gIdentity = window.arguments[0].identity;</span>
<a href="#l10.80"></a><span id="l10.80" class="difflineplus">+  gSubDialog = window.arguments[0].gSubDialog;</span>
<a href="#l10.81"></a><span id="l10.81" class="difflineplus">+</span>
<a href="#l10.82"></a><span id="l10.82" class="difflineplus">+  kStartSection = document.getElementById(&quot;wizardStart&quot;);</span>
<a href="#l10.83"></a><span id="l10.83" class="difflineplus">+  kDialog = document.querySelector(&quot;dialog&quot;);</span>
<a href="#l10.84"></a><span id="l10.84" class="difflineplus">+</span>
<a href="#l10.85"></a><span id="l10.85" class="difflineplus">+  document.l10n.setAttributes(</span>
<a href="#l10.86"></a><span id="l10.86" class="difflineplus">+    document.documentElement,</span>
<a href="#l10.87"></a><span id="l10.87" class="difflineplus">+    &quot;key-wizard-dialog-window&quot;,</span>
<a href="#l10.88"></a><span id="l10.88" class="difflineplus">+    {</span>
<a href="#l10.89"></a><span id="l10.89" class="difflineplus">+      identity: gIdentity.email,</span>
<a href="#l10.90"></a><span id="l10.90" class="difflineplus">+    }</span>
<a href="#l10.91"></a><span id="l10.91" class="difflineplus">+  );</span>
<a href="#l10.92"></a><span id="l10.92" class="difflineplus">+</span>
<a href="#l10.93"></a><span id="l10.93" class="difflineplus">+  // Show the GnuPG radio selection if the pref is enabled.</span>
<a href="#l10.94"></a><span id="l10.94" class="difflineplus">+  if (Services.prefs.getBoolPref(&quot;mail.openpgp.allow_external_gnupg&quot;)) {</span>
<a href="#l10.95"></a><span id="l10.95" class="difflineplus">+    document.getElementById(&quot;externalOpenPgp&quot;).removeAttribute(&quot;hidden&quot;);</span>
<a href="#l10.96"></a><span id="l10.96" class="difflineplus">+  }</span>
<a href="#l10.97"></a><span id="l10.97" class="difflineplus">+</span>
<a href="#l10.98"></a><span id="l10.98" class="difflineplus">+  // After the dialog is visible, disable the event listeners causing it to</span>
<a href="#l10.99"></a><span id="l10.99" class="difflineplus">+  // close when clicking on the overlay or hitting the Esc key, and remove the</span>
<a href="#l10.100"></a><span id="l10.100" class="difflineplus">+  // close button from the header. This is necessary to control the escape</span>
<a href="#l10.101"></a><span id="l10.101" class="difflineplus">+  // point and prevent the accidental dismiss of the dialog during important</span>
<a href="#l10.102"></a><span id="l10.102" class="difflineplus">+  // processes, like the generation or importing of a key.</span>
<a href="#l10.103"></a><span id="l10.103" class="difflineplus">+  setTimeout(() =&gt; {</span>
<a href="#l10.104"></a><span id="l10.104" class="difflineplus">+    gSubDialog._topDialog._removeDialogEventListeners();</span>
<a href="#l10.105"></a><span id="l10.105" class="difflineplus">+    gSubDialog._topDialog._closeButton.remove();</span>
<a href="#l10.106"></a><span id="l10.106" class="difflineplus">+  }, 150);</span>
<a href="#l10.107"></a><span id="l10.107" class="difflineplus">+}</span>
<a href="#l10.108"></a><span id="l10.108" class="difflineplus">+</span>
<a href="#l10.109"></a><span id="l10.109" class="difflineplus">+/**</span>
<a href="#l10.110"></a><span id="l10.110" class="difflineplus">+ * Intercept the dialogaccept command to implement a wizard like setup workflow.</span>
<a href="#l10.111"></a><span id="l10.111" class="difflineplus">+ *</span>
<a href="#l10.112"></a><span id="l10.112" class="difflineplus">+ * @param {Event} event - The DOM Event.</span>
<a href="#l10.113"></a><span id="l10.113" class="difflineplus">+ */</span>
<a href="#l10.114"></a><span id="l10.114" class="difflineplus">+function wizardContinue(event) {</span>
<a href="#l10.115"></a><span id="l10.115" class="difflineplus">+  event.preventDefault();</span>
<a href="#l10.116"></a><span id="l10.116" class="difflineplus">+</span>
<a href="#l10.117"></a><span id="l10.117" class="difflineplus">+  // Pretty impossible scenario but just in case if no radio button is</span>
<a href="#l10.118"></a><span id="l10.118" class="difflineplus">+  // currently selected, bail out.</span>
<a href="#l10.119"></a><span id="l10.119" class="difflineplus">+  if (!document.getElementById(&quot;openPgpKeyChoices&quot;).value) {</span>
<a href="#l10.120"></a><span id="l10.120" class="difflineplus">+    return;</span>
<a href="#l10.121"></a><span id="l10.121" class="difflineplus">+  }</span>
<a href="#l10.122"></a><span id="l10.122" class="difflineplus">+</span>
<a href="#l10.123"></a><span id="l10.123" class="difflineplus">+  // Trigger an action based on the currently visible section.</span>
<a href="#l10.124"></a><span id="l10.124" class="difflineplus">+  if (kCurrentSection != &quot;start&quot;) {</span>
<a href="#l10.125"></a><span id="l10.125" class="difflineplus">+    wizardNextStep();</span>
<a href="#l10.126"></a><span id="l10.126" class="difflineplus">+    return;</span>
<a href="#l10.127"></a><span id="l10.127" class="difflineplus">+  }</span>
<a href="#l10.128"></a><span id="l10.128" class="difflineplus">+</span>
<a href="#l10.129"></a><span id="l10.129" class="difflineplus">+  // Disable the `Continue` button.</span>
<a href="#l10.130"></a><span id="l10.130" class="difflineplus">+  kDialog.getButton(&quot;accept&quot;).setAttribute(&quot;disabled&quot;, true);</span>
<a href="#l10.131"></a><span id="l10.131" class="difflineplus">+</span>
<a href="#l10.132"></a><span id="l10.132" class="difflineplus">+  kStartSection.addEventListener(&quot;transitionend&quot;, switchSection);</span>
<a href="#l10.133"></a><span id="l10.133" class="difflineplus">+  kStartSection.classList.add(&quot;hide&quot;);</span>
<a href="#l10.134"></a><span id="l10.134" class="difflineplus">+}</span>
<a href="#l10.135"></a><span id="l10.135" class="difflineplus">+</span>
<a href="#l10.136"></a><span id="l10.136" class="difflineplus">+/**</span>
<a href="#l10.137"></a><span id="l10.137" class="difflineplus">+ * Separated method dealing with the section switching to allow the removal of</span>
<a href="#l10.138"></a><span id="l10.138" class="difflineplus">+ * the event listener to prevent stacking.</span>
<a href="#l10.139"></a><span id="l10.139" class="difflineplus">+ */</span>
<a href="#l10.140"></a><span id="l10.140" class="difflineplus">+function switchSection() {</span>
<a href="#l10.141"></a><span id="l10.141" class="difflineplus">+  kStartSection.setAttribute(&quot;hidden&quot;, true);</span>
<a href="#l10.142"></a><span id="l10.142" class="difflineplus">+  kStartSection.removeEventListener(&quot;transitionend&quot;, switchSection);</span>
<a href="#l10.143"></a><span id="l10.143" class="difflineplus">+</span>
<a href="#l10.144"></a><span id="l10.144" class="difflineplus">+  // Save the current label of the accept button in order to restore it later.</span>
<a href="#l10.145"></a><span id="l10.145" class="difflineplus">+  kButtonLabel = kDialog.getButton(&quot;accept&quot;).label;</span>
<a href="#l10.146"></a><span id="l10.146" class="difflineplus">+</span>
<a href="#l10.147"></a><span id="l10.147" class="difflineplus">+  // Update the UI based on the radiogroup selection.</span>
<a href="#l10.148"></a><span id="l10.148" class="difflineplus">+  switch (document.getElementById(&quot;openPgpKeyChoices&quot;).value) {</span>
<a href="#l10.149"></a><span id="l10.149" class="difflineplus">+    case &quot;0&quot;:</span>
<a href="#l10.150"></a><span id="l10.150" class="difflineplus">+      wizardCreateKey();</span>
<a href="#l10.151"></a><span id="l10.151" class="difflineplus">+      break;</span>
<a href="#l10.152"></a><span id="l10.152" class="difflineplus">+</span>
<a href="#l10.153"></a><span id="l10.153" class="difflineplus">+    case &quot;1&quot;:</span>
<a href="#l10.154"></a><span id="l10.154" class="difflineplus">+      wizardImportKey();</span>
<a href="#l10.155"></a><span id="l10.155" class="difflineplus">+      break;</span>
<a href="#l10.156"></a><span id="l10.156" class="difflineplus">+</span>
<a href="#l10.157"></a><span id="l10.157" class="difflineplus">+    case &quot;2&quot;:</span>
<a href="#l10.158"></a><span id="l10.158" class="difflineplus">+      wizardExternalKey();</span>
<a href="#l10.159"></a><span id="l10.159" class="difflineplus">+      break;</span>
<a href="#l10.160"></a><span id="l10.160" class="difflineplus">+  }</span>
<a href="#l10.161"></a><span id="l10.161" class="difflineplus">+</span>
<a href="#l10.162"></a><span id="l10.162" class="difflineplus">+  // Show the `Go Back` button.</span>
<a href="#l10.163"></a><span id="l10.163" class="difflineplus">+  kDialog.getButton(&quot;help&quot;).removeAttribute(&quot;hidden&quot;);</span>
<a href="#l10.164"></a><span id="l10.164" class="difflineplus">+}</span>
<a href="#l10.165"></a><span id="l10.165" class="difflineplus">+</span>
<a href="#l10.166"></a><span id="l10.166" class="difflineplus">+/**</span>
<a href="#l10.167"></a><span id="l10.167" class="difflineplus">+ * Handle the next step of the wizard based on the currently visible section.</span>
<a href="#l10.168"></a><span id="l10.168" class="difflineplus">+ */</span>
<a href="#l10.169"></a><span id="l10.169" class="difflineplus">+async function wizardNextStep() {</span>
<a href="#l10.170"></a><span id="l10.170" class="difflineplus">+  switch (kCurrentSection) {</span>
<a href="#l10.171"></a><span id="l10.171" class="difflineplus">+    case &quot;create&quot;:</span>
<a href="#l10.172"></a><span id="l10.172" class="difflineplus">+      await openPgpKeygenStart();</span>
<a href="#l10.173"></a><span id="l10.173" class="difflineplus">+      break;</span>
<a href="#l10.174"></a><span id="l10.174" class="difflineplus">+</span>
<a href="#l10.175"></a><span id="l10.175" class="difflineplus">+    case &quot;import&quot;:</span>
<a href="#l10.176"></a><span id="l10.176" class="difflineplus">+      break;</span>
<a href="#l10.177"></a><span id="l10.177" class="difflineplus">+</span>
<a href="#l10.178"></a><span id="l10.178" class="difflineplus">+    case &quot;external&quot;:</span>
<a href="#l10.179"></a><span id="l10.179" class="difflineplus">+      break;</span>
<a href="#l10.180"></a><span id="l10.180" class="difflineplus">+  }</span>
<a href="#l10.181"></a><span id="l10.181" class="difflineplus">+}</span>
<a href="#l10.182"></a><span id="l10.182" class="difflineplus">+</span>
<a href="#l10.183"></a><span id="l10.183" class="difflineplus">+/**</span>
<a href="#l10.184"></a><span id="l10.184" class="difflineplus">+ * Go back to the initial view of the wizard.</span>
<a href="#l10.185"></a><span id="l10.185" class="difflineplus">+ */</span>
<a href="#l10.186"></a><span id="l10.186" class="difflineplus">+function goBack() {</span>
<a href="#l10.187"></a><span id="l10.187" class="difflineplus">+  let section = document.querySelector(&quot;.wizard-section:not([hidden])&quot;);</span>
<a href="#l10.188"></a><span id="l10.188" class="difflineplus">+  section.addEventListener(&quot;transitionend&quot;, backToStart);</span>
<a href="#l10.189"></a><span id="l10.189" class="difflineplus">+  section.classList.add(&quot;hide-reverse&quot;);</span>
<a href="#l10.190"></a><span id="l10.190" class="difflineplus">+}</span>
<a href="#l10.191"></a><span id="l10.191" class="difflineplus">+</span>
<a href="#l10.192"></a><span id="l10.192" class="difflineplus">+/**</span>
<a href="#l10.193"></a><span id="l10.193" class="difflineplus">+ * Hide the currently visible section at the end of the animation, remove the</span>
<a href="#l10.194"></a><span id="l10.194" class="difflineplus">+ * listener to prevent stacking, and trigger the reveal of the first section.</span>
<a href="#l10.195"></a><span id="l10.195" class="difflineplus">+ *</span>
<a href="#l10.196"></a><span id="l10.196" class="difflineplus">+ * @param {Event} event - The DOM Event.</span>
<a href="#l10.197"></a><span id="l10.197" class="difflineplus">+ */</span>
<a href="#l10.198"></a><span id="l10.198" class="difflineplus">+function backToStart(event) {</span>
<a href="#l10.199"></a><span id="l10.199" class="difflineplus">+  // Hide the `Go Back` button.</span>
<a href="#l10.200"></a><span id="l10.200" class="difflineplus">+  kDialog.getButton(&quot;help&quot;).setAttribute(&quot;hidden&quot;, true);</span>
<a href="#l10.201"></a><span id="l10.201" class="difflineplus">+  // Enable the `Continue` button.</span>
<a href="#l10.202"></a><span id="l10.202" class="difflineplus">+  kDialog.getButton(&quot;accept&quot;).removeAttribute(&quot;disabled&quot;);</span>
<a href="#l10.203"></a><span id="l10.203" class="difflineplus">+  kDialog.getButton(&quot;accept&quot;).label = kButtonLabel;</span>
<a href="#l10.204"></a><span id="l10.204" class="difflineplus">+</span>
<a href="#l10.205"></a><span id="l10.205" class="difflineplus">+  event.target.setAttribute(&quot;hidden&quot;, true);</span>
<a href="#l10.206"></a><span id="l10.206" class="difflineplus">+  event.target.removeEventListener(&quot;transitionend&quot;, backToStart);</span>
<a href="#l10.207"></a><span id="l10.207" class="difflineplus">+</span>
<a href="#l10.208"></a><span id="l10.208" class="difflineplus">+  // Reset section key.</span>
<a href="#l10.209"></a><span id="l10.209" class="difflineplus">+  kCurrentSection = &quot;start&quot;;</span>
<a href="#l10.210"></a><span id="l10.210" class="difflineplus">+</span>
<a href="#l10.211"></a><span id="l10.211" class="difflineplus">+  revealSection(&quot;wizardStart&quot;);</span>
<a href="#l10.212"></a><span id="l10.212" class="difflineplus">+}</span>
<a href="#l10.213"></a><span id="l10.213" class="difflineplus">+</span>
<a href="#l10.214"></a><span id="l10.214" class="difflineplus">+/**</span>
<a href="#l10.215"></a><span id="l10.215" class="difflineplus">+ * Show the Key Creation section.</span>
<a href="#l10.216"></a><span id="l10.216" class="difflineplus">+ */</span>
<a href="#l10.217"></a><span id="l10.217" class="difflineplus">+async function wizardCreateKey() {</span>
<a href="#l10.218"></a><span id="l10.218" class="difflineplus">+  kCurrentSection = &quot;create&quot;;</span>
<a href="#l10.219"></a><span id="l10.219" class="difflineplus">+  revealSection(&quot;wizardCreateKey&quot;);</span>
<a href="#l10.220"></a><span id="l10.220" class="difflineplus">+</span>
<a href="#l10.221"></a><span id="l10.221" class="difflineplus">+  let createLabel = await document.l10n.formatValue(&quot;openpgp-keygen-button&quot;);</span>
<a href="#l10.222"></a><span id="l10.222" class="difflineplus">+</span>
<a href="#l10.223"></a><span id="l10.223" class="difflineplus">+  kDialog.getButton(&quot;accept&quot;).label = createLabel;</span>
<a href="#l10.224"></a><span id="l10.224" class="difflineplus">+</span>
<a href="#l10.225"></a><span id="l10.225" class="difflineplus">+  if (!gIdentity.fullName) {</span>
<a href="#l10.226"></a><span id="l10.226" class="difflineplus">+    document.getElementById(&quot;openPgpWarning&quot;).collapsed = false;</span>
<a href="#l10.227"></a><span id="l10.227" class="difflineplus">+    document.l10n.setAttributes(</span>
<a href="#l10.228"></a><span id="l10.228" class="difflineplus">+      document.getElementById(&quot;openPgpWarningDescription&quot;),</span>
<a href="#l10.229"></a><span id="l10.229" class="difflineplus">+      &quot;openpgp-keygen-long-expiry&quot;</span>
<a href="#l10.230"></a><span id="l10.230" class="difflineplus">+    );</span>
<a href="#l10.231"></a><span id="l10.231" class="difflineplus">+    return;</span>
<a href="#l10.232"></a><span id="l10.232" class="difflineplus">+  }</span>
<a href="#l10.233"></a><span id="l10.233" class="difflineplus">+</span>
<a href="#l10.234"></a><span id="l10.234" class="difflineplus">+  kDialog.getButton(&quot;accept&quot;).removeAttribute(&quot;disabled&quot;);</span>
<a href="#l10.235"></a><span id="l10.235" class="difflineplus">+}</span>
<a href="#l10.236"></a><span id="l10.236" class="difflineplus">+</span>
<a href="#l10.237"></a><span id="l10.237" class="difflineplus">+/**</span>
<a href="#l10.238"></a><span id="l10.238" class="difflineplus">+ * Show the Key Import section.</span>
<a href="#l10.239"></a><span id="l10.239" class="difflineplus">+ */</span>
<a href="#l10.240"></a><span id="l10.240" class="difflineplus">+function wizardImportKey() {</span>
<a href="#l10.241"></a><span id="l10.241" class="difflineplus">+  kCurrentSection = &quot;import&quot;;</span>
<a href="#l10.242"></a><span id="l10.242" class="difflineplus">+  revealSection(&quot;wizardImportKey&quot;);</span>
<a href="#l10.243"></a><span id="l10.243" class="difflineplus">+}</span>
<a href="#l10.244"></a><span id="l10.244" class="difflineplus">+</span>
<a href="#l10.245"></a><span id="l10.245" class="difflineplus">+/**</span>
<a href="#l10.246"></a><span id="l10.246" class="difflineplus">+ * Show the Key Setup via external smartcard section.</span>
<a href="#l10.247"></a><span id="l10.247" class="difflineplus">+ */</span>
<a href="#l10.248"></a><span id="l10.248" class="difflineplus">+function wizardExternalKey() {</span>
<a href="#l10.249"></a><span id="l10.249" class="difflineplus">+  kCurrentSection = &quot;external&quot;;</span>
<a href="#l10.250"></a><span id="l10.250" class="difflineplus">+  revealSection(&quot;wizardExternalKey&quot;);</span>
<a href="#l10.251"></a><span id="l10.251" class="difflineplus">+}</span>
<a href="#l10.252"></a><span id="l10.252" class="difflineplus">+</span>
<a href="#l10.253"></a><span id="l10.253" class="difflineplus">+/**</span>
<a href="#l10.254"></a><span id="l10.254" class="difflineplus">+ * Animate the reveal of a section of the wizard.</span>
<a href="#l10.255"></a><span id="l10.255" class="difflineplus">+ *</span>
<a href="#l10.256"></a><span id="l10.256" class="difflineplus">+ * @param {string} id - The id of the section to reveal.</span>
<a href="#l10.257"></a><span id="l10.257" class="difflineplus">+ */</span>
<a href="#l10.258"></a><span id="l10.258" class="difflineplus">+function revealSection(id) {</span>
<a href="#l10.259"></a><span id="l10.259" class="difflineplus">+  let section = document.getElementById(id);</span>
<a href="#l10.260"></a><span id="l10.260" class="difflineplus">+  section.removeAttribute(&quot;hidden&quot;);</span>
<a href="#l10.261"></a><span id="l10.261" class="difflineplus">+</span>
<a href="#l10.262"></a><span id="l10.262" class="difflineplus">+  // Timeout to animate after the hidden attribute has been removed.</span>
<a href="#l10.263"></a><span id="l10.263" class="difflineplus">+  setTimeout(() =&gt; {</span>
<a href="#l10.264"></a><span id="l10.264" class="difflineplus">+    section.classList.remove(&quot;hide&quot;, &quot;hide-reverse&quot;);</span>
<a href="#l10.265"></a><span id="l10.265" class="difflineplus">+  });</span>
<a href="#l10.266"></a><span id="l10.266" class="difflineplus">+</span>
<a href="#l10.267"></a><span id="l10.267" class="difflineplus">+  resizeDialog();</span>
<a href="#l10.268"></a><span id="l10.268" class="difflineplus">+}</span>
<a href="#l10.269"></a><span id="l10.269" class="difflineplus">+</span>
<a href="#l10.270"></a><span id="l10.270" class="difflineplus">+/**</span>
<a href="#l10.271"></a><span id="l10.271" class="difflineplus">+ * Enable or disable the elements based on the radiogroup selection.</span>
<a href="#l10.272"></a><span id="l10.272" class="difflineplus">+ *</span>
<a href="#l10.273"></a><span id="l10.273" class="difflineplus">+ * @param {Event} event - The DOM event triggered on change.</span>
<a href="#l10.274"></a><span id="l10.274" class="difflineplus">+ */</span>
<a href="#l10.275"></a><span id="l10.275" class="difflineplus">+function onExpirationChange(event) {</span>
<a href="#l10.276"></a><span id="l10.276" class="difflineplus">+  document</span>
<a href="#l10.277"></a><span id="l10.277" class="difflineplus">+    .getElementById(&quot;expireInput&quot;)</span>
<a href="#l10.278"></a><span id="l10.278" class="difflineplus">+    .toggleAttribute(&quot;disabled&quot;, event.target.value != 0);</span>
<a href="#l10.279"></a><span id="l10.279" class="difflineplus">+  document.getElementById(&quot;timeScale&quot;).disabled = event.target.value != 0;</span>
<a href="#l10.280"></a><span id="l10.280" class="difflineplus">+</span>
<a href="#l10.281"></a><span id="l10.281" class="difflineplus">+  validateExpiration();</span>
<a href="#l10.282"></a><span id="l10.282" class="difflineplus">+}</span>
<a href="#l10.283"></a><span id="l10.283" class="difflineplus">+</span>
<a href="#l10.284"></a><span id="l10.284" class="difflineplus">+/**</span>
<a href="#l10.285"></a><span id="l10.285" class="difflineplus">+ * Enable or disable the #keySize input field based on the current selection of</span>
<a href="#l10.286"></a><span id="l10.286" class="difflineplus">+ * the #keyType radio group.</span>
<a href="#l10.287"></a><span id="l10.287" class="difflineplus">+ *</span>
<a href="#l10.288"></a><span id="l10.288" class="difflineplus">+ * @param {Event} event - The DOM Event.</span>
<a href="#l10.289"></a><span id="l10.289" class="difflineplus">+ */</span>
<a href="#l10.290"></a><span id="l10.290" class="difflineplus">+function onKeyTypeChange(event) {</span>
<a href="#l10.291"></a><span id="l10.291" class="difflineplus">+  document.getElementById(&quot;keySize&quot;).disabled = event.target.value == &quot;ECC&quot;;</span>
<a href="#l10.292"></a><span id="l10.292" class="difflineplus">+}</span>
<a href="#l10.293"></a><span id="l10.293" class="difflineplus">+</span>
<a href="#l10.294"></a><span id="l10.294" class="difflineplus">+/**</span>
<a href="#l10.295"></a><span id="l10.295" class="difflineplus">+ * Intercept the cancel event to prevent accidental closing if the generation of</span>
<a href="#l10.296"></a><span id="l10.296" class="difflineplus">+ * a key is currently in progress.</span>
<a href="#l10.297"></a><span id="l10.297" class="difflineplus">+ *</span>
<a href="#l10.298"></a><span id="l10.298" class="difflineplus">+ * @param {Event} event - The DOM event.</span>
<a href="#l10.299"></a><span id="l10.299" class="difflineplus">+ */</span>
<a href="#l10.300"></a><span id="l10.300" class="difflineplus">+function onClose(event) {</span>
<a href="#l10.301"></a><span id="l10.301" class="difflineplus">+  if (kGenerating) {</span>
<a href="#l10.302"></a><span id="l10.302" class="difflineplus">+    event.preventDefault();</span>
<a href="#l10.303"></a><span id="l10.303" class="difflineplus">+  }</span>
<a href="#l10.304"></a><span id="l10.304" class="difflineplus">+}</span>
<a href="#l10.305"></a><span id="l10.305" class="difflineplus">+</span>
<a href="#l10.306"></a><span id="l10.306" class="difflineplus">+/**</span>
<a href="#l10.307"></a><span id="l10.307" class="difflineplus">+ * Validate the expiration time of a newly generated key when the user changes</span>
<a href="#l10.308"></a><span id="l10.308" class="difflineplus">+ * values. Disable the &quot;Generate Key&quot; button and show an alert if the selected</span>
<a href="#l10.309"></a><span id="l10.309" class="difflineplus">+ * value is less than 1 day or more than 100 years.</span>
<a href="#l10.310"></a><span id="l10.310" class="difflineplus">+ */</span>
<a href="#l10.311"></a><span id="l10.311" class="difflineplus">+async function validateExpiration() {</span>
<a href="#l10.312"></a><span id="l10.312" class="difflineplus">+  // If the key doesn't have an expiration date, hide the warning message and</span>
<a href="#l10.313"></a><span id="l10.313" class="difflineplus">+  // enable the &quot;Generate Key&quot; button.</span>
<a href="#l10.314"></a><span id="l10.314" class="difflineplus">+  if (document.getElementById(&quot;openPgpKeygeExpiry&quot;).value == 1) {</span>
<a href="#l10.315"></a><span id="l10.315" class="difflineplus">+    document.getElementById(&quot;openPgpWarning&quot;).collapsed = true;</span>
<a href="#l10.316"></a><span id="l10.316" class="difflineplus">+    kDialog.getButton(&quot;accept&quot;).removeAttribute(&quot;disabled&quot;);</span>
<a href="#l10.317"></a><span id="l10.317" class="difflineplus">+    return;</span>
<a href="#l10.318"></a><span id="l10.318" class="difflineplus">+  }</span>
<a href="#l10.319"></a><span id="l10.319" class="difflineplus">+</span>
<a href="#l10.320"></a><span id="l10.320" class="difflineplus">+  // Calculate the selected expiration date.</span>
<a href="#l10.321"></a><span id="l10.321" class="difflineplus">+  let expiryTime =</span>
<a href="#l10.322"></a><span id="l10.322" class="difflineplus">+    Number(document.getElementById(&quot;expireInput&quot;).value) *</span>
<a href="#l10.323"></a><span id="l10.323" class="difflineplus">+    Number(document.getElementById(&quot;timeScale&quot;).value);</span>
<a href="#l10.324"></a><span id="l10.324" class="difflineplus">+</span>
<a href="#l10.325"></a><span id="l10.325" class="difflineplus">+  // If the expiration date exceeds 100 years.</span>
<a href="#l10.326"></a><span id="l10.326" class="difflineplus">+  if (expiryTime &gt; 36500) {</span>
<a href="#l10.327"></a><span id="l10.327" class="difflineplus">+    document.getElementById(&quot;openPgpWarning&quot;).collapsed = false;</span>
<a href="#l10.328"></a><span id="l10.328" class="difflineplus">+    document.l10n.setAttributes(</span>
<a href="#l10.329"></a><span id="l10.329" class="difflineplus">+      document.getElementById(&quot;openPgpWarningDescription&quot;),</span>
<a href="#l10.330"></a><span id="l10.330" class="difflineplus">+      &quot;openpgp-keygen-long-expiry&quot;</span>
<a href="#l10.331"></a><span id="l10.331" class="difflineplus">+    );</span>
<a href="#l10.332"></a><span id="l10.332" class="difflineplus">+    kDialog.getButton(&quot;accept&quot;).setAttribute(&quot;disabled&quot;, true);</span>
<a href="#l10.333"></a><span id="l10.333" class="difflineplus">+    resizeDialog();</span>
<a href="#l10.334"></a><span id="l10.334" class="difflineplus">+    return;</span>
<a href="#l10.335"></a><span id="l10.335" class="difflineplus">+  }</span>
<a href="#l10.336"></a><span id="l10.336" class="difflineplus">+</span>
<a href="#l10.337"></a><span id="l10.337" class="difflineplus">+  // If the expiration date is shorter than 1 day.</span>
<a href="#l10.338"></a><span id="l10.338" class="difflineplus">+  if (expiryTime &lt;= 0) {</span>
<a href="#l10.339"></a><span id="l10.339" class="difflineplus">+    document.getElementById(&quot;openPgpWarning&quot;).collapsed = false;</span>
<a href="#l10.340"></a><span id="l10.340" class="difflineplus">+    document.l10n.setAttributes(</span>
<a href="#l10.341"></a><span id="l10.341" class="difflineplus">+      document.getElementById(&quot;openPgpWarningDescription&quot;),</span>
<a href="#l10.342"></a><span id="l10.342" class="difflineplus">+      &quot;openpgp-keygen-short-expiry&quot;</span>
<a href="#l10.343"></a><span id="l10.343" class="difflineplus">+    );</span>
<a href="#l10.344"></a><span id="l10.344" class="difflineplus">+    kDialog.getButton(&quot;accept&quot;).setAttribute(&quot;disabled&quot;, true);</span>
<a href="#l10.345"></a><span id="l10.345" class="difflineplus">+    resizeDialog();</span>
<a href="#l10.346"></a><span id="l10.346" class="difflineplus">+    return;</span>
<a href="#l10.347"></a><span id="l10.347" class="difflineplus">+  }</span>
<a href="#l10.348"></a><span id="l10.348" class="difflineplus">+</span>
<a href="#l10.349"></a><span id="l10.349" class="difflineplus">+  // If the previous conditions are false, hide the warning message and</span>
<a href="#l10.350"></a><span id="l10.350" class="difflineplus">+  // enable the &quot;Generate Key&quot; button since the expiration date is valid.</span>
<a href="#l10.351"></a><span id="l10.351" class="difflineplus">+  document.getElementById(&quot;openPgpWarning&quot;).collapsed = true;</span>
<a href="#l10.352"></a><span id="l10.352" class="difflineplus">+  kDialog.getButton(&quot;accept&quot;).removeAttribute(&quot;disabled&quot;);</span>
<a href="#l10.353"></a><span id="l10.353" class="difflineplus">+}</span>
<a href="#l10.354"></a><span id="l10.354" class="difflineplus">+</span>
<a href="#l10.355"></a><span id="l10.355" class="difflineplus">+/**</span>
<a href="#l10.356"></a><span id="l10.356" class="difflineplus">+ * Resize the dialog to account for the newly visible sections. The timeout is</span>
<a href="#l10.357"></a><span id="l10.357" class="difflineplus">+ * neccessary in order to wait until the end of revealing animations.</span>
<a href="#l10.358"></a><span id="l10.358" class="difflineplus">+ */</span>
<a href="#l10.359"></a><span id="l10.359" class="difflineplus">+function resizeDialog() {</span>
<a href="#l10.360"></a><span id="l10.360" class="difflineplus">+  // Timeout to trigger the dialog resize after the reveal animation completed.</span>
<a href="#l10.361"></a><span id="l10.361" class="difflineplus">+  setTimeout(() =&gt; {</span>
<a href="#l10.362"></a><span id="l10.362" class="difflineplus">+    gSubDialog._topDialog.resizeVertically();</span>
<a href="#l10.363"></a><span id="l10.363" class="difflineplus">+  }, 230);</span>
<a href="#l10.364"></a><span id="l10.364" class="difflineplus">+}</span>
<a href="#l10.365"></a><span id="l10.365" class="difflineplus">+</span>
<a href="#l10.366"></a><span id="l10.366" class="difflineplus">+/**</span>
<a href="#l10.367"></a><span id="l10.367" class="difflineplus">+ * Start the generation of a new OpenPGP Key.</span>
<a href="#l10.368"></a><span id="l10.368" class="difflineplus">+ */</span>
<a href="#l10.369"></a><span id="l10.369" class="difflineplus">+async function openPgpKeygenStart() {</span>
<a href="#l10.370"></a><span id="l10.370" class="difflineplus">+  let openPgpWarning = document.getElementById(&quot;openPgpWarning&quot;);</span>
<a href="#l10.371"></a><span id="l10.371" class="difflineplus">+  let openPgpWarningText = document.getElementById(&quot;openPgpWarningDescription&quot;);</span>
<a href="#l10.372"></a><span id="l10.372" class="difflineplus">+  openPgpWarning.collapsed = true;</span>
<a href="#l10.373"></a><span id="l10.373" class="difflineplus">+</span>
<a href="#l10.374"></a><span id="l10.374" class="difflineplus">+  // If a key generation request is already pending, warn the user and</span>
<a href="#l10.375"></a><span id="l10.375" class="difflineplus">+  // don't proceed.</span>
<a href="#l10.376"></a><span id="l10.376" class="difflineplus">+  if (gKeygenRequest) {</span>
<a href="#l10.377"></a><span id="l10.377" class="difflineplus">+    let req = gKeygenRequest.QueryInterface(Ci.nsIRequest);</span>
<a href="#l10.378"></a><span id="l10.378" class="difflineplus">+</span>
<a href="#l10.379"></a><span id="l10.379" class="difflineplus">+    if (req.isPending()) {</span>
<a href="#l10.380"></a><span id="l10.380" class="difflineplus">+      openPgpWarning.collapsed = false;</span>
<a href="#l10.381"></a><span id="l10.381" class="difflineplus">+      document.l10n.setAttributes(openPgpWarningText, &quot;openpgp-keygen-ongoing&quot;);</span>
<a href="#l10.382"></a><span id="l10.382" class="difflineplus">+      return;</span>
<a href="#l10.383"></a><span id="l10.383" class="difflineplus">+    }</span>
<a href="#l10.384"></a><span id="l10.384" class="difflineplus">+  }</span>
<a href="#l10.385"></a><span id="l10.385" class="difflineplus">+</span>
<a href="#l10.386"></a><span id="l10.386" class="difflineplus">+  // Reset global variables to be sure.</span>
<a href="#l10.387"></a><span id="l10.387" class="difflineplus">+  gGeneratedKey = null;</span>
<a href="#l10.388"></a><span id="l10.388" class="difflineplus">+  gAllData = &quot;&quot;;</span>
<a href="#l10.389"></a><span id="l10.389" class="difflineplus">+</span>
<a href="#l10.390"></a><span id="l10.390" class="difflineplus">+  let enigmailSvc = GetEnigmailSvc();</span>
<a href="#l10.391"></a><span id="l10.391" class="difflineplus">+  if (!enigmailSvc) {</span>
<a href="#l10.392"></a><span id="l10.392" class="difflineplus">+    openPgpWarning.collapsed = false;</span>
<a href="#l10.393"></a><span id="l10.393" class="difflineplus">+    document.l10n.setAttributes(</span>
<a href="#l10.394"></a><span id="l10.394" class="difflineplus">+      openPgpWarningText,</span>
<a href="#l10.395"></a><span id="l10.395" class="difflineplus">+      &quot;openpgp-keygen-error-core&quot;</span>
<a href="#l10.396"></a><span id="l10.396" class="difflineplus">+    );</span>
<a href="#l10.397"></a><span id="l10.397" class="difflineplus">+    closeOverlay();</span>
<a href="#l10.398"></a><span id="l10.398" class="difflineplus">+</span>
<a href="#l10.399"></a><span id="l10.399" class="difflineplus">+    throw new Error(&quot;GetEnigmailSvc failed&quot;);</span>
<a href="#l10.400"></a><span id="l10.400" class="difflineplus">+  }</span>
<a href="#l10.401"></a><span id="l10.401" class="difflineplus">+</span>
<a href="#l10.402"></a><span id="l10.402" class="difflineplus">+  // Show wizard overlay before the start of the generation process. This is</span>
<a href="#l10.403"></a><span id="l10.403" class="difflineplus">+  // necessary because the generation happens synchronously and blocks the UI.</span>
<a href="#l10.404"></a><span id="l10.404" class="difflineplus">+  // We need to show the overlay before it, otherwise it would flash and freeze.</span>
<a href="#l10.405"></a><span id="l10.405" class="difflineplus">+  // This should be moved after the Services.prompt.confirmEx() method</span>
<a href="#l10.406"></a><span id="l10.406" class="difflineplus">+  // once Bug 1617444 is implemented.</span>
<a href="#l10.407"></a><span id="l10.407" class="difflineplus">+  let overlay = document.getElementById(&quot;wizardOverlay&quot;);</span>
<a href="#l10.408"></a><span id="l10.408" class="difflineplus">+  overlay.removeAttribute(&quot;hidden&quot;);</span>
<a href="#l10.409"></a><span id="l10.409" class="difflineplus">+  overlay.classList.remove(&quot;hide&quot;);</span>
<a href="#l10.410"></a><span id="l10.410" class="difflineplus">+</span>
<a href="#l10.411"></a><span id="l10.411" class="difflineplus">+  // Ask for confirmation before triggering the generation of a new key.</span>
<a href="#l10.412"></a><span id="l10.412" class="difflineplus">+  document.l10n.setAttributes(</span>
<a href="#l10.413"></a><span id="l10.413" class="difflineplus">+    document.getElementById(&quot;wizardOverlayQuestion&quot;),</span>
<a href="#l10.414"></a><span id="l10.414" class="difflineplus">+    &quot;openpgp-key-confirm&quot;,</span>
<a href="#l10.415"></a><span id="l10.415" class="difflineplus">+    {</span>
<a href="#l10.416"></a><span id="l10.416" class="difflineplus">+      identity: `${gIdentity.fullName} &lt;b&gt;&quot;${gIdentity.email}&quot;&lt;/b&gt;`,</span>
<a href="#l10.417"></a><span id="l10.417" class="difflineplus">+    }</span>
<a href="#l10.418"></a><span id="l10.418" class="difflineplus">+  );</span>
<a href="#l10.419"></a><span id="l10.419" class="difflineplus">+</span>
<a href="#l10.420"></a><span id="l10.420" class="difflineplus">+  document.l10n.setAttributes(</span>
<a href="#l10.421"></a><span id="l10.421" class="difflineplus">+    document.getElementById(&quot;wizardOverlayTitle&quot;),</span>
<a href="#l10.422"></a><span id="l10.422" class="difflineplus">+    &quot;openpgp-keygen-progress-title&quot;</span>
<a href="#l10.423"></a><span id="l10.423" class="difflineplus">+  );</span>
<a href="#l10.424"></a><span id="l10.424" class="difflineplus">+}</span>
<a href="#l10.425"></a><span id="l10.425" class="difflineplus">+</span>
<a href="#l10.426"></a><span id="l10.426" class="difflineplus">+async function openPgpKeygenConfirm() {</span>
<a href="#l10.427"></a><span id="l10.427" class="difflineplus">+  document.getElementById(&quot;openPgpKeygenConfirm&quot;).collapsed = true;</span>
<a href="#l10.428"></a><span id="l10.428" class="difflineplus">+  document.getElementById(&quot;openPgpKeygenProcess&quot;).removeAttribute(&quot;collapsed&quot;);</span>
<a href="#l10.429"></a><span id="l10.429" class="difflineplus">+</span>
<a href="#l10.430"></a><span id="l10.430" class="difflineplus">+  let openPgpWarning = document.getElementById(&quot;openPgpWarning&quot;);</span>
<a href="#l10.431"></a><span id="l10.431" class="difflineplus">+  let openPgpWarningText = document.getElementById(&quot;openPgpWarningDescription&quot;);</span>
<a href="#l10.432"></a><span id="l10.432" class="difflineplus">+  openPgpWarning.collapsed = true;</span>
<a href="#l10.433"></a><span id="l10.433" class="difflineplus">+</span>
<a href="#l10.434"></a><span id="l10.434" class="difflineplus">+  kGenerating = true;</span>
<a href="#l10.435"></a><span id="l10.435" class="difflineplus">+</span>
<a href="#l10.436"></a><span id="l10.436" class="difflineplus">+  let cApi;</span>
<a href="#l10.437"></a><span id="l10.437" class="difflineplus">+  try {</span>
<a href="#l10.438"></a><span id="l10.438" class="difflineplus">+    let newId = null;</span>
<a href="#l10.439"></a><span id="l10.439" class="difflineplus">+    cApi = EnigmailCryptoAPI();</span>
<a href="#l10.440"></a><span id="l10.440" class="difflineplus">+    newId = cApi.sync(</span>
<a href="#l10.441"></a><span id="l10.441" class="difflineplus">+      cApi.genKey(</span>
<a href="#l10.442"></a><span id="l10.442" class="difflineplus">+        `${gIdentity.fullName} &lt;${gIdentity.email}&gt;`,</span>
<a href="#l10.443"></a><span id="l10.443" class="difflineplus">+        document.getElementById(&quot;keyType&quot;).value,</span>
<a href="#l10.444"></a><span id="l10.444" class="difflineplus">+        Number(document.getElementById(&quot;keySize&quot;).value),</span>
<a href="#l10.445"></a><span id="l10.445" class="difflineplus">+        document.getElementById(&quot;openPgpKeygeExpiry&quot;).value == 1</span>
<a href="#l10.446"></a><span id="l10.446" class="difflineplus">+          ? 0</span>
<a href="#l10.447"></a><span id="l10.447" class="difflineplus">+          : Number(document.getElementById(&quot;expireInput&quot;).value) *</span>
<a href="#l10.448"></a><span id="l10.448" class="difflineplus">+              Number(document.getElementById(&quot;timeScale&quot;).value),</span>
<a href="#l10.449"></a><span id="l10.449" class="difflineplus">+        OpenPGPMasterpass.retrieveOpenPGPPassword()</span>
<a href="#l10.450"></a><span id="l10.450" class="difflineplus">+      )</span>
<a href="#l10.451"></a><span id="l10.451" class="difflineplus">+    );</span>
<a href="#l10.452"></a><span id="l10.452" class="difflineplus">+    console.log(&quot;created new key with id: &quot; + newId);</span>
<a href="#l10.453"></a><span id="l10.453" class="difflineplus">+    gGeneratedKey = newId;</span>
<a href="#l10.454"></a><span id="l10.454" class="difflineplus">+  } catch (ex) {</span>
<a href="#l10.455"></a><span id="l10.455" class="difflineplus">+    console.log(ex);</span>
<a href="#l10.456"></a><span id="l10.456" class="difflineplus">+  }</span>
<a href="#l10.457"></a><span id="l10.457" class="difflineplus">+</span>
<a href="#l10.458"></a><span id="l10.458" class="difflineplus">+  EnigmailWindows.keyManReloadKeys();</span>
<a href="#l10.459"></a><span id="l10.459" class="difflineplus">+</span>
<a href="#l10.460"></a><span id="l10.460" class="difflineplus">+  gKeygenRequest = null;</span>
<a href="#l10.461"></a><span id="l10.461" class="difflineplus">+  kGenerating = true;</span>
<a href="#l10.462"></a><span id="l10.462" class="difflineplus">+</span>
<a href="#l10.463"></a><span id="l10.463" class="difflineplus">+  // For wathever reason, the key wasn't generated. Show an error message and</span>
<a href="#l10.464"></a><span id="l10.464" class="difflineplus">+  // hide the processing overlay.</span>
<a href="#l10.465"></a><span id="l10.465" class="difflineplus">+  if (!gGeneratedKey) {</span>
<a href="#l10.466"></a><span id="l10.466" class="difflineplus">+    openPgpWarning.collapsed = false;</span>
<a href="#l10.467"></a><span id="l10.467" class="difflineplus">+    document.l10n.setAttributes(</span>
<a href="#l10.468"></a><span id="l10.468" class="difflineplus">+      openPgpWarningText,</span>
<a href="#l10.469"></a><span id="l10.469" class="difflineplus">+      &quot;openpgp-keygen-error-failed&quot;</span>
<a href="#l10.470"></a><span id="l10.470" class="difflineplus">+    );</span>
<a href="#l10.471"></a><span id="l10.471" class="difflineplus">+    closeOverlay();</span>
<a href="#l10.472"></a><span id="l10.472" class="difflineplus">+</span>
<a href="#l10.473"></a><span id="l10.473" class="difflineplus">+    throw new Error(&quot;key generation failed&quot;);</span>
<a href="#l10.474"></a><span id="l10.474" class="difflineplus">+  }</span>
<a href="#l10.475"></a><span id="l10.475" class="difflineplus">+</span>
<a href="#l10.476"></a><span id="l10.476" class="difflineplus">+  console.debug(&quot;saving new key id &quot; + gGeneratedKey);</span>
<a href="#l10.477"></a><span id="l10.477" class="difflineplus">+  EnigSavePrefs();</span>
<a href="#l10.478"></a><span id="l10.478" class="difflineplus">+</span>
<a href="#l10.479"></a><span id="l10.479" class="difflineplus">+  // Hide wizard overlay at the end of the generation process.</span>
<a href="#l10.480"></a><span id="l10.480" class="difflineplus">+  closeOverlay();</span>
<a href="#l10.481"></a><span id="l10.481" class="difflineplus">+  EnigmailKeyRing.clearCache();</span>
<a href="#l10.482"></a><span id="l10.482" class="difflineplus">+</span>
<a href="#l10.483"></a><span id="l10.483" class="difflineplus">+  let rev = cApi.sync(cApi.getNewRevocation(`0x${gGeneratedKey}`));</span>
<a href="#l10.484"></a><span id="l10.484" class="difflineplus">+  if (!rev) {</span>
<a href="#l10.485"></a><span id="l10.485" class="difflineplus">+    openPgpWarning.collapsed = false;</span>
<a href="#l10.486"></a><span id="l10.486" class="difflineplus">+    document.l10n.setAttributes(</span>
<a href="#l10.487"></a><span id="l10.487" class="difflineplus">+      openPgpWarningText,</span>
<a href="#l10.488"></a><span id="l10.488" class="difflineplus">+      &quot;openpgp-keygen-error-revocation&quot;,</span>
<a href="#l10.489"></a><span id="l10.489" class="difflineplus">+      {</span>
<a href="#l10.490"></a><span id="l10.490" class="difflineplus">+        key: gGeneratedKey,</span>
<a href="#l10.491"></a><span id="l10.491" class="difflineplus">+      }</span>
<a href="#l10.492"></a><span id="l10.492" class="difflineplus">+    );</span>
<a href="#l10.493"></a><span id="l10.493" class="difflineplus">+    closeOverlay();</span>
<a href="#l10.494"></a><span id="l10.494" class="difflineplus">+</span>
<a href="#l10.495"></a><span id="l10.495" class="difflineplus">+    throw new Error(&quot;failed to obtain revocation for key &quot; + gGeneratedKey);</span>
<a href="#l10.496"></a><span id="l10.496" class="difflineplus">+  }</span>
<a href="#l10.497"></a><span id="l10.497" class="difflineplus">+</span>
<a href="#l10.498"></a><span id="l10.498" class="difflineplus">+  let revFull =</span>
<a href="#l10.499"></a><span id="l10.499" class="difflineplus">+    revocationFilePrefix1 +</span>
<a href="#l10.500"></a><span id="l10.500" class="difflineplus">+    &quot;\n\n&quot; +</span>
<a href="#l10.501"></a><span id="l10.501" class="difflineplus">+    gGeneratedKey +</span>
<a href="#l10.502"></a><span id="l10.502" class="difflineplus">+    &quot;\n&quot; +</span>
<a href="#l10.503"></a><span id="l10.503" class="difflineplus">+    revocationFilePrefix2 +</span>
<a href="#l10.504"></a><span id="l10.504" class="difflineplus">+    rev;</span>
<a href="#l10.505"></a><span id="l10.505" class="difflineplus">+</span>
<a href="#l10.506"></a><span id="l10.506" class="difflineplus">+  let revFile = EnigmailApp.getProfileDirectory();</span>
<a href="#l10.507"></a><span id="l10.507" class="difflineplus">+  revFile.append(`0x${gGeneratedKey}_rev.asc`);</span>
<a href="#l10.508"></a><span id="l10.508" class="difflineplus">+</span>
<a href="#l10.509"></a><span id="l10.509" class="difflineplus">+  // Create a revokation cert in the Thunderbird profile directoy.</span>
<a href="#l10.510"></a><span id="l10.510" class="difflineplus">+  EnigmailFiles.writeFileContents(revFile, revFull, DEFAULT_FILE_PERMS);</span>
<a href="#l10.511"></a><span id="l10.511" class="difflineplus">+</span>
<a href="#l10.512"></a><span id="l10.512" class="difflineplus">+  // Key succesfully created. Assign the new key to the current identity, close</span>
<a href="#l10.513"></a><span id="l10.513" class="difflineplus">+  // the dialog and show a confirmation message.</span>
<a href="#l10.514"></a><span id="l10.514" class="difflineplus">+  gIdentity.setUnicharAttribute(&quot;openpgp_key_id&quot;, gGeneratedKey);</span>
<a href="#l10.515"></a><span id="l10.515" class="difflineplus">+  window.arguments[0].okCallback();</span>
<a href="#l10.516"></a><span id="l10.516" class="difflineplus">+  window.close();</span>
<a href="#l10.517"></a><span id="l10.517" class="difflineplus">+}</span>
<a href="#l10.518"></a><span id="l10.518" class="difflineplus">+</span>
<a href="#l10.519"></a><span id="l10.519" class="difflineplus">+/**</span>
<a href="#l10.520"></a><span id="l10.520" class="difflineplus">+ * Cancel the keygen process, ask for confirmation before proceeding.</span>
<a href="#l10.521"></a><span id="l10.521" class="difflineplus">+ */</span>
<a href="#l10.522"></a><span id="l10.522" class="difflineplus">+async function openPgpKeygenCancel() {</span>
<a href="#l10.523"></a><span id="l10.523" class="difflineplus">+  let abortTitle = await document.l10n.formatValue(</span>
<a href="#l10.524"></a><span id="l10.524" class="difflineplus">+    &quot;openpgp-keygen-abort-title&quot;</span>
<a href="#l10.525"></a><span id="l10.525" class="difflineplus">+  );</span>
<a href="#l10.526"></a><span id="l10.526" class="difflineplus">+  let abortText = await document.l10n.formatValue(&quot;openpgp-keygen-abort&quot;);</span>
<a href="#l10.527"></a><span id="l10.527" class="difflineplus">+</span>
<a href="#l10.528"></a><span id="l10.528" class="difflineplus">+  if (</span>
<a href="#l10.529"></a><span id="l10.529" class="difflineplus">+    kGenerating &amp;&amp;</span>
<a href="#l10.530"></a><span id="l10.530" class="difflineplus">+    Services.prompt.confirmEx(</span>
<a href="#l10.531"></a><span id="l10.531" class="difflineplus">+      window,</span>
<a href="#l10.532"></a><span id="l10.532" class="difflineplus">+      abortTitle,</span>
<a href="#l10.533"></a><span id="l10.533" class="difflineplus">+      abortText,</span>
<a href="#l10.534"></a><span id="l10.534" class="difflineplus">+      Services.prompt.STD_YES_NO_BUTTONS,</span>
<a href="#l10.535"></a><span id="l10.535" class="difflineplus">+      &quot;&quot;,</span>
<a href="#l10.536"></a><span id="l10.536" class="difflineplus">+      &quot;&quot;,</span>
<a href="#l10.537"></a><span id="l10.537" class="difflineplus">+      &quot;&quot;,</span>
<a href="#l10.538"></a><span id="l10.538" class="difflineplus">+      &quot;&quot;,</span>
<a href="#l10.539"></a><span id="l10.539" class="difflineplus">+      {}</span>
<a href="#l10.540"></a><span id="l10.540" class="difflineplus">+    ) != 0</span>
<a href="#l10.541"></a><span id="l10.541" class="difflineplus">+  ) {</span>
<a href="#l10.542"></a><span id="l10.542" class="difflineplus">+    return;</span>
<a href="#l10.543"></a><span id="l10.543" class="difflineplus">+  }</span>
<a href="#l10.544"></a><span id="l10.544" class="difflineplus">+</span>
<a href="#l10.545"></a><span id="l10.545" class="difflineplus">+  closeOverlay();</span>
<a href="#l10.546"></a><span id="l10.546" class="difflineplus">+  gKeygenRequest.kill(false);</span>
<a href="#l10.547"></a><span id="l10.547" class="difflineplus">+  kGenerating = false;</span>
<a href="#l10.548"></a><span id="l10.548" class="difflineplus">+}</span>
<a href="#l10.549"></a><span id="l10.549" class="difflineplus">+</span>
<a href="#l10.550"></a><span id="l10.550" class="difflineplus">+/**</span>
<a href="#l10.551"></a><span id="l10.551" class="difflineplus">+ * Close the processing wizard overlay.</span>
<a href="#l10.552"></a><span id="l10.552" class="difflineplus">+ */</span>
<a href="#l10.553"></a><span id="l10.553" class="difflineplus">+function closeOverlay() {</span>
<a href="#l10.554"></a><span id="l10.554" class="difflineplus">+  document.getElementById(&quot;openPgpKeygenConfirm&quot;).removeAttribute(&quot;collapsed&quot;);</span>
<a href="#l10.555"></a><span id="l10.555" class="difflineplus">+  document.getElementById(&quot;openPgpKeygenProcess&quot;).collapsed = true;</span>
<a href="#l10.556"></a><span id="l10.556" class="difflineplus">+</span>
<a href="#l10.557"></a><span id="l10.557" class="difflineplus">+  let overlay = document.getElementById(&quot;wizardOverlay&quot;);</span>
<a href="#l10.558"></a><span id="l10.558" class="difflineplus">+</span>
<a href="#l10.559"></a><span id="l10.559" class="difflineplus">+  overlay.removeAttribute(&quot;hidden&quot;);</span>
<a href="#l10.560"></a><span id="l10.560" class="difflineplus">+  overlay.addEventListener(&quot;transitionend&quot;, hideOverlay);</span>
<a href="#l10.561"></a><span id="l10.561" class="difflineplus">+  overlay.classList.add(&quot;hide&quot;);</span>
<a href="#l10.562"></a><span id="l10.562" class="difflineplus">+}</span>
<a href="#l10.563"></a><span id="l10.563" class="difflineplus">+</span>
<a href="#l10.564"></a><span id="l10.564" class="difflineplus">+/**</span>
<a href="#l10.565"></a><span id="l10.565" class="difflineplus">+ * Add the &quot;hidden&quot; attribute tot he processing wizard overlay after the CSS</span>
<a href="#l10.566"></a><span id="l10.566" class="difflineplus">+ * transition ended.</span>
<a href="#l10.567"></a><span id="l10.567" class="difflineplus">+ *</span>
<a href="#l10.568"></a><span id="l10.568" class="difflineplus">+ * @param {Event} event - The DOM Event.</span>
<a href="#l10.569"></a><span id="l10.569" class="difflineplus">+ */</span>
<a href="#l10.570"></a><span id="l10.570" class="difflineplus">+function hideOverlay(event) {</span>
<a href="#l10.571"></a><span id="l10.571" class="difflineplus">+  event.target.setAttribute(&quot;hidden&quot;, true);</span>
<a href="#l10.572"></a><span id="l10.572" class="difflineplus">+  event.target.removeEventListener(&quot;transitionend&quot;, hideOverlay);</span>
<a href="#l10.573"></a><span id="l10.573" class="difflineplus">+}</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l11.1"></a><span id="l11.1">new file mode 100644</span>
<a href="#l11.2"></a><span id="l11.2" class="difflineminus">--- /dev/null</span>
<a href="#l11.3"></a><span id="l11.3" class="difflineplus">+++ b/mail/extensions/openpgp/content/ui/keyWizard.xhtml</span>
<a href="#l11.4"></a><span id="l11.4" class="difflineat">@@ -0,0 +1,207 @@</span>
<a href="#l11.5"></a><span id="l11.5" class="difflineplus">+&lt;?xml version=&quot;1.0&quot;?&gt;</span>
<a href="#l11.6"></a><span id="l11.6" class="difflineplus">+&lt;!-- This Source Code Form is subject to the terms of the Mozilla Public</span>
<a href="#l11.7"></a><span id="l11.7" class="difflineplus">+   - License, v. 2.0. If a copy of the MPL was not distributed with this</span>
<a href="#l11.8"></a><span id="l11.8" class="difflineplus">+   - file, You can obtain one at http://mozilla.org/MPL/2.0/. --&gt;</span>
<a href="#l11.9"></a><span id="l11.9" class="difflineplus">+</span>
<a href="#l11.10"></a><span id="l11.10" class="difflineplus">+&lt;?xml-stylesheet href=&quot;chrome://global/skin/global.css&quot;?&gt;</span>
<a href="#l11.11"></a><span id="l11.11" class="difflineplus">+&lt;?xml-stylesheet href=&quot;chrome://messenger/skin/openpgp/keyWizard.css&quot;?&gt;</span>
<a href="#l11.12"></a><span id="l11.12" class="difflineplus">+&lt;?xml-stylesheet href=&quot;chrome://messenger/skin/openpgp/inlineNotification.css&quot;?&gt;</span>
<a href="#l11.13"></a><span id="l11.13" class="difflineplus">+</span>
<a href="#l11.14"></a><span id="l11.14" class="difflineplus">+&lt;!DOCTYPE window&gt;</span>
<a href="#l11.15"></a><span id="l11.15" class="difflineplus">+</span>
<a href="#l11.16"></a><span id="l11.16" class="difflineplus">+&lt;window type=&quot;child&quot;</span>
<a href="#l11.17"></a><span id="l11.17" class="difflineplus">+        xmlns=&quot;http://www.mozilla.org/keymaster/gatekeeper/there.is.only.xul&quot;</span>
<a href="#l11.18"></a><span id="l11.18" class="difflineplus">+        xmlns:html=&quot;http://www.w3.org/1999/xhtml&quot;</span>
<a href="#l11.19"></a><span id="l11.19" class="difflineplus">+        onload=&quot;init();&quot;</span>
<a href="#l11.20"></a><span id="l11.20" class="difflineplus">+        style=&quot;width: 45em;&quot;&gt;</span>
<a href="#l11.21"></a><span id="l11.21" class="difflineplus">+&lt;dialog id=&quot;openPgpKeyWizardDialog&quot;</span>
<a href="#l11.22"></a><span id="l11.22" class="difflineplus">+        data-l10n-id=&quot;key-wizard-button&quot;</span>
<a href="#l11.23"></a><span id="l11.23" class="difflineplus">+        data-l10n-attrs=&quot;buttonlabelaccept, buttonlabelhelp&quot;</span>
<a href="#l11.24"></a><span id="l11.24" class="difflineplus">+        buttons=&quot;accept,cancel&quot;&gt;</span>
<a href="#l11.25"></a><span id="l11.25" class="difflineplus">+</span>
<a href="#l11.26"></a><span id="l11.26" class="difflineplus">+  &lt;prefpane id=&quot;openPgpKeyWizardDialogPane&quot;&gt;</span>
<a href="#l11.27"></a><span id="l11.27" class="difflineplus">+    &lt;script src=&quot;chrome://openpgp/content/ui/enigmailCommon.js&quot;/&gt;</span>
<a href="#l11.28"></a><span id="l11.28" class="difflineplus">+    &lt;script src=&quot;chrome://openpgp/content/ui/keyWizard.js&quot;/&gt;</span>
<a href="#l11.29"></a><span id="l11.29" class="difflineplus">+</span>
<a href="#l11.30"></a><span id="l11.30" class="difflineplus">+    &lt;linkset&gt;</span>
<a href="#l11.31"></a><span id="l11.31" class="difflineplus">+      &lt;html:link rel=&quot;localization&quot; href=&quot;branding/brand.ftl&quot;/&gt;</span>
<a href="#l11.32"></a><span id="l11.32" class="difflineplus">+      &lt;html:link rel=&quot;localization&quot; href=&quot;messenger/openpgp/key-wizard.ftl&quot;/&gt;</span>
<a href="#l11.33"></a><span id="l11.33" class="difflineplus">+    &lt;/linkset&gt;</span>
<a href="#l11.34"></a><span id="l11.34" class="difflineplus">+</span>
<a href="#l11.35"></a><span id="l11.35" class="difflineplus">+    &lt;html:div id=&quot;wizardOverlay&quot; class=&quot;wizard-section overlay hide&quot; hidden=&quot;hidden&quot;&gt;</span>
<a href="#l11.36"></a><span id="l11.36" class="difflineplus">+      &lt;hbox class=&quot;inline-notification-container info-container self-center&quot;&gt;</span>
<a href="#l11.37"></a><span id="l11.37" class="difflineplus">+        &lt;hbox class=&quot;inline-notification-wrapper&quot;&gt;</span>
<a href="#l11.38"></a><span id="l11.38" class="difflineplus">+          &lt;image class=&quot;notification-image notification-image-info&quot;/&gt;</span>
<a href="#l11.39"></a><span id="l11.39" class="difflineplus">+          &lt;description data-l10n-id=&quot;openpgp-generate-key-info&quot;/&gt;</span>
<a href="#l11.40"></a><span id="l11.40" class="difflineplus">+        &lt;/hbox&gt;</span>
<a href="#l11.41"></a><span id="l11.41" class="difflineplus">+      &lt;/hbox&gt;</span>
<a href="#l11.42"></a><span id="l11.42" class="difflineplus">+</span>
<a href="#l11.43"></a><span id="l11.43" class="difflineplus">+      &lt;vbox id=&quot;openPgpKeygenConfirm&quot; class=&quot;self-center&quot; align=&quot;center&quot;&gt;</span>
<a href="#l11.44"></a><span id="l11.44" class="difflineplus">+        &lt;description id=&quot;wizardOverlayQuestion&quot;/&gt;</span>
<a href="#l11.45"></a><span id="l11.45" class="difflineplus">+        &lt;separator class=&quot;thin&quot;/&gt;</span>
<a href="#l11.46"></a><span id="l11.46" class="difflineplus">+        &lt;hbox&gt;</span>
<a href="#l11.47"></a><span id="l11.47" class="difflineplus">+          &lt;button data-l10n-id=&quot;openpgp-keygen-dismiss&quot;</span>
<a href="#l11.48"></a><span id="l11.48" class="difflineplus">+                  oncommand=&quot;closeOverlay();&quot;/&gt;</span>
<a href="#l11.49"></a><span id="l11.49" class="difflineplus">+          &lt;button data-l10n-id=&quot;openpgp-keygen-confirm&quot;</span>
<a href="#l11.50"></a><span id="l11.50" class="difflineplus">+                  oncommand=&quot;openPgpKeygenConfirm();&quot;/&gt;</span>
<a href="#l11.51"></a><span id="l11.51" class="difflineplus">+        &lt;/hbox&gt;</span>
<a href="#l11.52"></a><span id="l11.52" class="difflineplus">+      &lt;/vbox&gt;</span>
<a href="#l11.53"></a><span id="l11.53" class="difflineplus">+</span>
<a href="#l11.54"></a><span id="l11.54" class="difflineplus">+      &lt;vbox id=&quot;openPgpKeygenProcess&quot; class=&quot;self-center&quot; align=&quot;center&quot;</span>
<a href="#l11.55"></a><span id="l11.55" class="difflineplus">+            collapsed=&quot;true&quot;&gt;</span>
<a href="#l11.56"></a><span id="l11.56" class="difflineplus">+        &lt;html:legend id=&quot;wizardOverlayTitle&quot;&gt;&lt;/html:legend&gt;</span>
<a href="#l11.57"></a><span id="l11.57" class="difflineplus">+        &lt;image class=&quot;loading-status&quot;/&gt;</span>
<a href="#l11.58"></a><span id="l11.58" class="difflineplus">+        &lt;button data-l10n-id=&quot;openpgp-keygen-cancel&quot;</span>
<a href="#l11.59"></a><span id="l11.59" class="difflineplus">+                class=&quot;self-center&quot;</span>
<a href="#l11.60"></a><span id="l11.60" class="difflineplus">+                oncommand=&quot;openPgpKeygenCancel();&quot;/&gt;</span>
<a href="#l11.61"></a><span id="l11.61" class="difflineplus">+      &lt;/vbox&gt;</span>
<a href="#l11.62"></a><span id="l11.62" class="difflineplus">+</span>
<a href="#l11.63"></a><span id="l11.63" class="difflineplus">+    &lt;/html:div&gt;</span>
<a href="#l11.64"></a><span id="l11.64" class="difflineplus">+</span>
<a href="#l11.65"></a><span id="l11.65" class="difflineplus">+    &lt;vbox id=&quot;wizardStart&quot; class=&quot;wizard-section&quot;&gt;</span>
<a href="#l11.66"></a><span id="l11.66" class="difflineplus">+      &lt;hbox class=&quot;inline-notification-container info-container&quot;&gt;</span>
<a href="#l11.67"></a><span id="l11.67" class="difflineplus">+        &lt;hbox class=&quot;inline-notification-wrapper&quot;&gt;</span>
<a href="#l11.68"></a><span id="l11.68" class="difflineplus">+          &lt;image class=&quot;notification-image notification-image-info&quot;/&gt;</span>
<a href="#l11.69"></a><span id="l11.69" class="difflineplus">+          &lt;description&gt;</span>
<a href="#l11.70"></a><span id="l11.70" class="difflineplus">+            &lt;html:span class=&quot;tail-with-learn-more&quot;</span>
<a href="#l11.71"></a><span id="l11.71" class="difflineplus">+                       data-l10n-id=&quot;key-wizard-warning&quot;&gt;</span>
<a href="#l11.72"></a><span id="l11.72" class="difflineplus">+            &lt;/html:span&gt;</span>
<a href="#l11.73"></a><span id="l11.73" class="difflineplus">+            &lt;label is=&quot;text-link&quot;</span>
<a href="#l11.74"></a><span id="l11.74" class="difflineplus">+                   href=&quot;https://support.mozilla.org/kb/introduction-to-e2e-encryption&quot;</span>
<a href="#l11.75"></a><span id="l11.75" class="difflineplus">+                   data-l10n-id=&quot;key-wizard-learn-more&quot;</span>
<a href="#l11.76"></a><span id="l11.76" class="difflineplus">+                   class=&quot;learnMore text-link&quot;/&gt;</span>
<a href="#l11.77"></a><span id="l11.77" class="difflineplus">+          &lt;/description&gt;</span>
<a href="#l11.78"></a><span id="l11.78" class="difflineplus">+        &lt;/hbox&gt;</span>
<a href="#l11.79"></a><span id="l11.79" class="difflineplus">+      &lt;/hbox&gt;</span>
<a href="#l11.80"></a><span id="l11.80" class="difflineplus">+</span>
<a href="#l11.81"></a><span id="l11.81" class="difflineplus">+      &lt;html:fieldset&gt;</span>
<a href="#l11.82"></a><span id="l11.82" class="difflineplus">+        &lt;radiogroup id=&quot;openPgpKeyChoices&quot; class=&quot;indent&quot;&gt;</span>
<a href="#l11.83"></a><span id="l11.83" class="difflineplus">+          &lt;radio id=&quot;createOpenPgp&quot; value=&quot;0&quot;</span>
<a href="#l11.84"></a><span id="l11.84" class="difflineplus">+                 data-l10n-id=&quot;radio-create-key&quot;/&gt;</span>
<a href="#l11.85"></a><span id="l11.85" class="difflineplus">+          &lt;radio id=&quot;importOpenPgp&quot; value=&quot;1&quot;</span>
<a href="#l11.86"></a><span id="l11.86" class="difflineplus">+                 data-l10n-id=&quot;radio-import-key&quot;/&gt;</span>
<a href="#l11.87"></a><span id="l11.87" class="difflineplus">+          &lt;radio id=&quot;externalOpenPgp&quot; value=&quot;2&quot;</span>
<a href="#l11.88"></a><span id="l11.88" class="difflineplus">+                 data-l10n-id=&quot;radio-gnupg-key&quot;</span>
<a href="#l11.89"></a><span id="l11.89" class="difflineplus">+                 hidden=&quot;true&quot;/&gt;</span>
<a href="#l11.90"></a><span id="l11.90" class="difflineplus">+        &lt;/radiogroup&gt;</span>
<a href="#l11.91"></a><span id="l11.91" class="difflineplus">+      &lt;/html:fieldset&gt;</span>
<a href="#l11.92"></a><span id="l11.92" class="difflineplus">+    &lt;/vbox&gt;</span>
<a href="#l11.93"></a><span id="l11.93" class="difflineplus">+</span>
<a href="#l11.94"></a><span id="l11.94" class="difflineplus">+    &lt;vbox id=&quot;wizardCreateKey&quot; class=&quot;wizard-section hide-reverse&quot; hidden=&quot;true&quot;&gt;</span>
<a href="#l11.95"></a><span id="l11.95" class="difflineplus">+      &lt;label data-l10n-id=&quot;openpgp-generate-key-title&quot;</span>
<a href="#l11.96"></a><span id="l11.96" class="difflineplus">+             class=&quot;dialogheader-title&quot;/&gt;</span>
<a href="#l11.97"></a><span id="l11.97" class="difflineplus">+</span>
<a href="#l11.98"></a><span id="l11.98" class="difflineplus">+      &lt;html:fieldset&gt;</span>
<a href="#l11.99"></a><span id="l11.99" class="difflineplus">+        &lt;html:legend data-l10n-id=&quot;openpgp-keygen-expiry-title&quot;&gt;&lt;/html:legend&gt;</span>
<a href="#l11.100"></a><span id="l11.100" class="difflineplus">+        &lt;description data-l10n-id=&quot;openpgp-keygen-expiry-description&quot;/&gt;</span>
<a href="#l11.101"></a><span id="l11.101" class="difflineplus">+</span>
<a href="#l11.102"></a><span id="l11.102" class="difflineplus">+        &lt;radiogroup id=&quot;openPgpKeygeExpiry&quot; class=&quot;indent&quot;&gt;</span>
<a href="#l11.103"></a><span id="l11.103" class="difflineplus">+          &lt;hbox flex=&quot;1&quot; align=&quot;center&quot;&gt;</span>
<a href="#l11.104"></a><span id="l11.104" class="difflineplus">+            &lt;radio id=&quot;keygenExpiration&quot; value=&quot;0&quot;</span>
<a href="#l11.105"></a><span id="l11.105" class="difflineplus">+                   data-l10n-id=&quot;radio-keygen-expiry&quot;</span>
<a href="#l11.106"></a><span id="l11.106" class="difflineplus">+                   oncommand=&quot;onExpirationChange(event);&quot;/&gt;</span>
<a href="#l11.107"></a><span id="l11.107" class="difflineplus">+            &lt;html:input id=&quot;expireInput&quot; type=&quot;number&quot;</span>
<a href="#l11.108"></a><span id="l11.108" class="difflineplus">+                        class=&quot;size4 input-inline autosync&quot;</span>
<a href="#l11.109"></a><span id="l11.109" class="difflineplus">+                        maxlength=&quot;5&quot; value=&quot;1&quot;</span>
<a href="#l11.110"></a><span id="l11.110" class="difflineplus">+                        aria-labelledby=&quot;keygenExpiration&quot;</span>
<a href="#l11.111"></a><span id="l11.111" class="difflineplus">+                        oninput=&quot;validateExpiration();&quot;/&gt;</span>
<a href="#l11.112"></a><span id="l11.112" class="difflineplus">+            &lt;menulist id=&quot;timeScale&quot;&gt;</span>
<a href="#l11.113"></a><span id="l11.113" class="difflineplus">+              &lt;menupopup&gt;</span>
<a href="#l11.114"></a><span id="l11.114" class="difflineplus">+                &lt;menuitem id=&quot;years&quot; value=&quot;365&quot;</span>
<a href="#l11.115"></a><span id="l11.115" class="difflineplus">+                          data-l10n-id=&quot;openpgp-keygen-years-label&quot;</span>
<a href="#l11.116"></a><span id="l11.116" class="difflineplus">+                          oncommand=&quot;validateExpiration();&quot;/&gt;</span>
<a href="#l11.117"></a><span id="l11.117" class="difflineplus">+                &lt;menuitem id=&quot;months&quot; value=&quot;30&quot;</span>
<a href="#l11.118"></a><span id="l11.118" class="difflineplus">+                          data-l10n-id=&quot;openpgp-keygen-months-label&quot;</span>
<a href="#l11.119"></a><span id="l11.119" class="difflineplus">+                          selected=&quot;true&quot;</span>
<a href="#l11.120"></a><span id="l11.120" class="difflineplus">+                          oncommand=&quot;validateExpiration();&quot;/&gt;</span>
<a href="#l11.121"></a><span id="l11.121" class="difflineplus">+                &lt;menuitem id=&quot;days&quot; value=&quot;1&quot;</span>
<a href="#l11.122"></a><span id="l11.122" class="difflineplus">+                          data-l10n-id=&quot;openpgp-keygen-days-label&quot;</span>
<a href="#l11.123"></a><span id="l11.123" class="difflineplus">+                          oncommand=&quot;validateExpiration();&quot;/&gt;</span>
<a href="#l11.124"></a><span id="l11.124" class="difflineplus">+              &lt;/menupopup&gt;</span>
<a href="#l11.125"></a><span id="l11.125" class="difflineplus">+            &lt;/menulist&gt;</span>
<a href="#l11.126"></a><span id="l11.126" class="difflineplus">+          &lt;/hbox&gt;</span>
<a href="#l11.127"></a><span id="l11.127" class="difflineplus">+          &lt;radio value=&quot;1&quot;</span>
<a href="#l11.128"></a><span id="l11.128" class="difflineplus">+                 data-l10n-id=&quot;radio-keygen-no-expiry&quot;</span>
<a href="#l11.129"></a><span id="l11.129" class="difflineplus">+                 oncommand=&quot;onExpirationChange(event);&quot;/&gt;</span>
<a href="#l11.130"></a><span id="l11.130" class="difflineplus">+        &lt;/radiogroup&gt;</span>
<a href="#l11.131"></a><span id="l11.131" class="difflineplus">+      &lt;/html:fieldset&gt;</span>
<a href="#l11.132"></a><span id="l11.132" class="difflineplus">+</span>
<a href="#l11.133"></a><span id="l11.133" class="difflineplus">+      &lt;separator/&gt;</span>
<a href="#l11.134"></a><span id="l11.134" class="difflineplus">+</span>
<a href="#l11.135"></a><span id="l11.135" class="difflineplus">+      &lt;html:fieldset&gt;</span>
<a href="#l11.136"></a><span id="l11.136" class="difflineplus">+        &lt;html:legend data-l10n-id=&quot;openpgp-keygen-advanced-title&quot;&gt;&lt;/html:legend&gt;</span>
<a href="#l11.137"></a><span id="l11.137" class="difflineplus">+        &lt;description data-l10n-id=&quot;openpgp-keygen-advanced-description&quot;/&gt;</span>
<a href="#l11.138"></a><span id="l11.138" class="difflineplus">+</span>
<a href="#l11.139"></a><span id="l11.139" class="difflineplus">+        &lt;vbox class=&quot;indent grid-size&quot;&gt;</span>
<a href="#l11.140"></a><span id="l11.140" class="difflineplus">+          &lt;hbox align=&quot;center&quot;&gt;</span>
<a href="#l11.141"></a><span id="l11.141" class="difflineplus">+            &lt;label for=&quot;keyType&quot; data-l10n-id=&quot;openpgp-keygen-keytype&quot;/&gt;</span>
<a href="#l11.142"></a><span id="l11.142" class="difflineplus">+          &lt;/hbox&gt;</span>
<a href="#l11.143"></a><span id="l11.143" class="difflineplus">+          &lt;hbox align=&quot;center&quot;&gt;</span>
<a href="#l11.144"></a><span id="l11.144" class="difflineplus">+            &lt;menulist id=&quot;keyType&quot;&gt;</span>
<a href="#l11.145"></a><span id="l11.145" class="difflineplus">+              &lt;menupopup&gt;</span>
<a href="#l11.146"></a><span id="l11.146" class="difflineplus">+                &lt;menuitem id=&quot;keySize_rsa&quot; value=&quot;RSA&quot;</span>
<a href="#l11.147"></a><span id="l11.147" class="difflineplus">+                          data-l10n-id=&quot;openpgp-keygen-type-rsa&quot;</span>
<a href="#l11.148"></a><span id="l11.148" class="difflineplus">+                          selected=&quot;true&quot;</span>
<a href="#l11.149"></a><span id="l11.149" class="difflineplus">+                          oncommand=&quot;onKeyTypeChange(event);&quot;/&gt;</span>
<a href="#l11.150"></a><span id="l11.150" class="difflineplus">+                &lt;menuitem id=&quot;keyType_ecc&quot; value=&quot;ECC&quot;</span>
<a href="#l11.151"></a><span id="l11.151" class="difflineplus">+                          data-l10n-id=&quot;openpgp-keygen-type-ecc&quot;</span>
<a href="#l11.152"></a><span id="l11.152" class="difflineplus">+                          oncommand=&quot;onKeyTypeChange(event);&quot;/&gt;</span>
<a href="#l11.153"></a><span id="l11.153" class="difflineplus">+              &lt;/menupopup&gt;</span>
<a href="#l11.154"></a><span id="l11.154" class="difflineplus">+            &lt;/menulist&gt;</span>
<a href="#l11.155"></a><span id="l11.155" class="difflineplus">+          &lt;/hbox&gt;</span>
<a href="#l11.156"></a><span id="l11.156" class="difflineplus">+          &lt;spacer/&gt;</span>
<a href="#l11.157"></a><span id="l11.157" class="difflineplus">+</span>
<a href="#l11.158"></a><span id="l11.158" class="difflineplus">+          &lt;hbox align=&quot;center&quot;&gt;</span>
<a href="#l11.159"></a><span id="l11.159" class="difflineplus">+            &lt;label for=&quot;keySize&quot; data-l10n-id=&quot;openpgp-keygen-keysize&quot;/&gt;</span>
<a href="#l11.160"></a><span id="l11.160" class="difflineplus">+          &lt;/hbox&gt;</span>
<a href="#l11.161"></a><span id="l11.161" class="difflineplus">+          &lt;hbox align=&quot;center&quot;&gt;</span>
<a href="#l11.162"></a><span id="l11.162" class="difflineplus">+            &lt;menulist id=&quot;keySize&quot;&gt;</span>
<a href="#l11.163"></a><span id="l11.163" class="difflineplus">+              &lt;menupopup&gt;</span>
<a href="#l11.164"></a><span id="l11.164" class="difflineplus">+                &lt;menuitem id=&quot;keySize_3072&quot; value=&quot;3072&quot; label=&quot;3072&quot;</span>
<a href="#l11.165"></a><span id="l11.165" class="difflineplus">+                          selected=&quot;true&quot;/&gt;</span>
<a href="#l11.166"></a><span id="l11.166" class="difflineplus">+                &lt;menuitem id=&quot;keySize_4096&quot; value=&quot;4096&quot; label=&quot;4096&quot;/&gt;</span>
<a href="#l11.167"></a><span id="l11.167" class="difflineplus">+              &lt;/menupopup&gt;</span>
<a href="#l11.168"></a><span id="l11.168" class="difflineplus">+            &lt;/menulist&gt;</span>
<a href="#l11.169"></a><span id="l11.169" class="difflineplus">+          &lt;/hbox&gt;</span>
<a href="#l11.170"></a><span id="l11.170" class="difflineplus">+          &lt;spacer/&gt;</span>
<a href="#l11.171"></a><span id="l11.171" class="difflineplus">+</span>
<a href="#l11.172"></a><span id="l11.172" class="difflineplus">+        &lt;/vbox&gt;</span>
<a href="#l11.173"></a><span id="l11.173" class="difflineplus">+      &lt;/html:fieldset&gt;</span>
<a href="#l11.174"></a><span id="l11.174" class="difflineplus">+</span>
<a href="#l11.175"></a><span id="l11.175" class="difflineplus">+      &lt;separator/&gt;</span>
<a href="#l11.176"></a><span id="l11.176" class="difflineplus">+</span>
<a href="#l11.177"></a><span id="l11.177" class="difflineplus">+      &lt;hbox id=&quot;openPgpWarning&quot;</span>
<a href="#l11.178"></a><span id="l11.178" class="difflineplus">+            class=&quot;inline-notification-container error-container self-center&quot;</span>
<a href="#l11.179"></a><span id="l11.179" class="difflineplus">+            collapsed=&quot;true&quot;&gt;</span>
<a href="#l11.180"></a><span id="l11.180" class="difflineplus">+        &lt;hbox class=&quot;inline-notification-wrapper&quot;&gt;</span>
<a href="#l11.181"></a><span id="l11.181" class="difflineplus">+          &lt;image class=&quot;notification-image notification-image-error&quot;/&gt;</span>
<a href="#l11.182"></a><span id="l11.182" class="difflineplus">+          &lt;description id=&quot;openPgpWarningDescription&quot;/&gt;</span>
<a href="#l11.183"></a><span id="l11.183" class="difflineplus">+        &lt;/hbox&gt;</span>
<a href="#l11.184"></a><span id="l11.184" class="difflineplus">+      &lt;/hbox&gt;</span>
<a href="#l11.185"></a><span id="l11.185" class="difflineplus">+</span>
<a href="#l11.186"></a><span id="l11.186" class="difflineplus">+    &lt;/vbox&gt;</span>
<a href="#l11.187"></a><span id="l11.187" class="difflineplus">+</span>
<a href="#l11.188"></a><span id="l11.188" class="difflineplus">+    &lt;vbox id=&quot;wizardImportKey&quot; class=&quot;wizard-section hide-reverse&quot; hidden=&quot;true&quot;&gt;</span>
<a href="#l11.189"></a><span id="l11.189" class="difflineplus">+      &lt;label data-l10n-id=&quot;openpgp-import-key-title&quot;</span>
<a href="#l11.190"></a><span id="l11.190" class="difflineplus">+             class=&quot;dialogheader-title&quot;/&gt;</span>
<a href="#l11.191"></a><span id="l11.191" class="difflineplus">+</span>
<a href="#l11.192"></a><span id="l11.192" class="difflineplus">+      &lt;description&gt;</span>
<a href="#l11.193"></a><span id="l11.193" class="difflineplus">+        Work in Progress: this feature is not yet implemented</span>
<a href="#l11.194"></a><span id="l11.194" class="difflineplus">+      &lt;/description&gt;</span>
<a href="#l11.195"></a><span id="l11.195" class="difflineplus">+</span>
<a href="#l11.196"></a><span id="l11.196" class="difflineplus">+      &lt;separator/&gt;</span>
<a href="#l11.197"></a><span id="l11.197" class="difflineplus">+    &lt;/vbox&gt;</span>
<a href="#l11.198"></a><span id="l11.198" class="difflineplus">+</span>
<a href="#l11.199"></a><span id="l11.199" class="difflineplus">+    &lt;vbox id=&quot;wizardExternalKey&quot; class=&quot;wizard-section hide-reverse&quot; hidden=&quot;true&quot;&gt;</span>
<a href="#l11.200"></a><span id="l11.200" class="difflineplus">+      &lt;label data-l10n-id=&quot;openpgp-external-key-title&quot;</span>
<a href="#l11.201"></a><span id="l11.201" class="difflineplus">+             class=&quot;dialogheader-title&quot;/&gt;</span>
<a href="#l11.202"></a><span id="l11.202" class="difflineplus">+</span>
<a href="#l11.203"></a><span id="l11.203" class="difflineplus">+      &lt;description&gt;</span>
<a href="#l11.204"></a><span id="l11.204" class="difflineplus">+        Work in Progress: this feature is not yet implemented</span>
<a href="#l11.205"></a><span id="l11.205" class="difflineplus">+      &lt;/description&gt;</span>
<a href="#l11.206"></a><span id="l11.206" class="difflineplus">+</span>
<a href="#l11.207"></a><span id="l11.207" class="difflineplus">+      &lt;separator/&gt;</span>
<a href="#l11.208"></a><span id="l11.208" class="difflineplus">+    &lt;/vbox&gt;</span>
<a href="#l11.209"></a><span id="l11.209" class="difflineplus">+  &lt;/prefpane&gt;</span>
<a href="#l11.210"></a><span id="l11.210" class="difflineplus">+&lt;/dialog&gt;</span>
<a href="#l11.211"></a><span id="l11.211" class="difflineplus">+&lt;/window&gt;</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l12.1"></a><span id="l12.1" class="difflineminus">--- a/mail/locales/jar.mn</span>
<a href="#l12.2"></a><span id="l12.2" class="difflineplus">+++ b/mail/locales/jar.mn</span>
<a href="#l12.3"></a><span id="l12.3" class="difflineat">@@ -9,16 +9,17 @@</span>
<a href="#l12.4"></a><span id="l12.4"> #filter substitution</span>
<a href="#l12.5"></a><span id="l12.5"> </span>
<a href="#l12.6"></a><span id="l12.6"> [localization] @AB_CD@.jar:</span>
<a href="#l12.7"></a><span id="l12.7">   messenger/openpgp/bond.ftl                                            (../extensions/openpgp/content/strings/bond.ftl)</span>
<a href="#l12.8"></a><span id="l12.8">   messenger/openpgp/composeKeyStatus.ftl                                (../extensions/openpgp/content/strings/composeKeyStatus.ftl)</span>
<a href="#l12.9"></a><span id="l12.9">   messenger/openpgp/msgReadStatus.ftl                                   (../extensions/openpgp/content/strings/msgReadStatus.ftl)</span>
<a href="#l12.10"></a><span id="l12.10">   messenger/openpgp/oneRecipientStatus.ftl                              (../extensions/openpgp/content/strings/oneRecipientStatus.ftl)</span>
<a href="#l12.11"></a><span id="l12.11">   messenger/openpgp/enigmail.ftl                                        (../extensions/openpgp/content/strings/enigmail.ftl)</span>
<a href="#l12.12"></a><span id="l12.12" class="difflineplus">+  messenger/openpgp/key-wizard.ftl                                      (../extensions/openpgp/content/strings/key-wizard.ftl)</span>
<a href="#l12.13"></a><span id="l12.13">   messenger                                                             (%messenger/**/*.ftl)</span>
<a href="#l12.14"></a><span id="l12.14"> </span>
<a href="#l12.15"></a><span id="l12.15"> </span>
<a href="#l12.16"></a><span id="l12.16"> @AB_CD@.jar:</span>
<a href="#l12.17"></a><span id="l12.17"> % locale messenger @AB_CD@ %locale/@AB_CD@/messenger/</span>
<a href="#l12.18"></a><span id="l12.18">   locale/@AB_CD@/messenger/aboutDialog.dtd                              (%chrome/messenger/aboutDialog.dtd)</span>
<a href="#l12.19"></a><span id="l12.19">   locale/@AB_CD@/messenger/aboutDownloads.dtd                           (%chrome/messenger/aboutDownloads.dtd)</span>
<a href="#l12.20"></a><span id="l12.20">   locale/@AB_CD@/messenger/aboutRights.properties                       (%chrome/messenger/aboutRights.properties)</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l13.1"></a><span id="l13.1" class="difflineminus">--- a/mail/themes/shared/jar.inc.mn</span>
<a href="#l13.2"></a><span id="l13.2" class="difflineplus">+++ b/mail/themes/shared/jar.inc.mn</span>
<a href="#l13.3"></a><span id="l13.3" class="difflineat">@@ -67,16 +67,17 @@</span>
<a href="#l13.4"></a><span id="l13.4">   skin/classic/messenger/icons/developer.svg                  (../shared/mail/icons/developer.svg)</span>
<a href="#l13.5"></a><span id="l13.5">   skin/classic/messenger/icons/exclude.svg                    (../shared/mail/icons/exclude.svg)</span>
<a href="#l13.6"></a><span id="l13.6">   skin/classic/messenger/icons/encryption-key.svg             (../shared/mail/icons/encryption-key.svg)</span>
<a href="#l13.7"></a><span id="l13.7">   skin/classic/messenger/icons/feeds.svg                      (../shared/mail/icons/feeds.svg)</span>
<a href="#l13.8"></a><span id="l13.8">   skin/classic/messenger/icons/feeds-folder.svg               (../shared/mail/icons/feeds-folder.svg)</span>
<a href="#l13.9"></a><span id="l13.9">   skin/classic/messenger/icons/file.svg                       (../shared/mail/icons/file.svg)</span>
<a href="#l13.10"></a><span id="l13.10">   skin/classic/messenger/icons/file-item.svg                  (../shared/mail/icons/file-item.svg)</span>
<a href="#l13.11"></a><span id="l13.11">   skin/classic/messenger/icons/filter.svg                     (../shared/mail/icons/filter.svg)</span>
<a href="#l13.12"></a><span id="l13.12" class="difflineplus">+  skin/classic/messenger/icons/fingerprint.svg                (../shared/mail/icons/fingerprint.svg)</span>
<a href="#l13.13"></a><span id="l13.13">   skin/classic/messenger/icons/flag-col.svg                   (../shared/mail/icons/flag-col.svg)</span>
<a href="#l13.14"></a><span id="l13.14">   skin/classic/messenger/icons/flagged.svg                    (../shared/mail/icons/flagged.svg)</span>
<a href="#l13.15"></a><span id="l13.15">   skin/classic/messenger/icons/folder.svg                     (../shared/mail/icons/folder.svg)</span>
<a href="#l13.16"></a><span id="l13.16">   skin/classic/messenger/icons/folder-local.svg               (../shared/mail/icons/folder-local.svg)</span>
<a href="#l13.17"></a><span id="l13.17">   skin/classic/messenger/icons/forget.svg                     (../shared/mail/icons/forget.svg)</span>
<a href="#l13.18"></a><span id="l13.18">   skin/classic/messenger/icons/forward.svg                    (../shared/mail/icons/forward.svg)</span>
<a href="#l13.19"></a><span id="l13.19">   skin/classic/messenger/icons/get-all.svg                    (../shared/mail/icons/get-all.svg)</span>
<a href="#l13.20"></a><span id="l13.20">   skin/classic/messenger/icons/getmsg.svg                     (../shared/mail/icons/getmsg.svg)</span>
<a href="#l13.21"></a><span id="l13.21" class="difflineat">@@ -261,16 +262,18 @@</span>
<a href="#l13.22"></a><span id="l13.22">   skin/classic/messenger/openpgp/enigSignInactiveNone.png     (../shared/openpgp/enigSignInactiveNone.png)</span>
<a href="#l13.23"></a><span id="l13.23">   skin/classic/messenger/openpgp/enigSignInactivePlus.png     (../shared/openpgp/enigSignInactivePlus.png)</span>
<a href="#l13.24"></a><span id="l13.24">   skin/classic/messenger/openpgp/enigSignNotOk.png            (../shared/openpgp/enigSignNotOk.png)</span>
<a href="#l13.25"></a><span id="l13.25">   skin/classic/messenger/openpgp/enigSignOk.png               (../shared/openpgp/enigSignOk.png)</span>
<a href="#l13.26"></a><span id="l13.26">   skin/classic/messenger/openpgp/enigSignUnkown.png           (../shared/openpgp/enigSignUnkown.png)</span>
<a href="#l13.27"></a><span id="l13.27">   skin/classic/messenger/openpgp/headerProtected-18.svg       (../shared/openpgp/headerProtected-18.svg)</span>
<a href="#l13.28"></a><span id="l13.28">   skin/classic/messenger/openpgp/headerUnprotected-18.svg     (../shared/openpgp/headerUnprotected-18.svg)</span>
<a href="#l13.29"></a><span id="l13.29">   skin/classic/messenger/openpgp/importSuccess.png            (../shared/openpgp/importSuccess.png)</span>
<a href="#l13.30"></a><span id="l13.30" class="difflineplus">+  skin/classic/messenger/openpgp/keyWizard.css                (../shared/openpgp/keyWizard.css)</span>
<a href="#l13.31"></a><span id="l13.31" class="difflineplus">+  skin/classic/messenger/openpgp/inlineNotification.css       (../shared/openpgp/inlineNotification.css)</span>
<a href="#l13.32"></a><span id="l13.32">   skin/classic/messenger/openpgp/ok-sign.svg                  (../shared/openpgp/ok-sign.svg)</span>
<a href="#l13.33"></a><span id="l13.33">   skin/classic/messenger/openpgp/password-error.svg           (../shared/openpgp/password-error.svg)</span>
<a href="#l13.34"></a><span id="l13.34">   skin/classic/messenger/openpgp/sign-active-18.svg           (../shared/openpgp/sign-active-18.svg)</span>
<a href="#l13.35"></a><span id="l13.35">   skin/classic/messenger/openpgp/sign-disabled-18.svg         (../shared/openpgp/sign-disabled-18.svg)</span>
<a href="#l13.36"></a><span id="l13.36">   skin/classic/messenger/openpgp/sign-inactive-18.svg         (../shared/openpgp/sign-inactive-18.svg)</span>
<a href="#l13.37"></a><span id="l13.37">   skin/classic/messenger/openpgp/spinning-wheel.png           (../shared/openpgp/spinning-wheel.png)</span>
<a href="#l13.38"></a><span id="l13.38">   skin/classic/messenger/openpgp/twisty-clsd.png              (../shared/openpgp/twisty-clsd.png)</span>
<a href="#l13.39"></a><span id="l13.39">   skin/classic/messenger/openpgp/twisty-open.png              (../shared/openpgp/twisty-open.png)</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l14.1"></a><span id="l14.1" class="difflineminus">--- a/mail/themes/shared/mail/accountManage.css</span>
<a href="#l14.2"></a><span id="l14.2" class="difflineplus">+++ b/mail/themes/shared/mail/accountManage.css</span>
<a href="#l14.3"></a><span id="l14.3" class="difflineat">@@ -295,8 +295,245 @@ treechildren::-moz-tree-image(folderName</span>
<a href="#l14.4"></a><span id="l14.4"> </span>
<a href="#l14.5"></a><span id="l14.5"> .identity-table td {</span>
<a href="#l14.6"></a><span id="l14.6">   padding-inline-end: 10px;</span>
<a href="#l14.7"></a><span id="l14.7"> }</span>
<a href="#l14.8"></a><span id="l14.8"> </span>
<a href="#l14.9"></a><span id="l14.9"> .identity-table td input {</span>
<a href="#l14.10"></a><span id="l14.10">   width: 100%;</span>
<a href="#l14.11"></a><span id="l14.11"> }</span>
<a href="#l14.12"></a><span id="l14.12" class="difflineplus">+</span>
<a href="#l14.13"></a><span id="l14.13" class="difflineplus">+/* ::::: e2e encryption ::::: */</span>
<a href="#l14.14"></a><span id="l14.14" class="difflineplus">+</span>
<a href="#l14.15"></a><span id="l14.15" class="difflineplus">+#openPgpKey {</span>
<a href="#l14.16"></a><span id="l14.16" class="difflineplus">+  list-style-image: url(&quot;chrome://messenger/skin/icons/login.svg&quot;);</span>
<a href="#l14.17"></a><span id="l14.17" class="difflineplus">+  -moz-context-properties: fill, fill-opacity;</span>
<a href="#l14.18"></a><span id="l14.18" class="difflineplus">+  fill: currentColor;</span>
<a href="#l14.19"></a><span id="l14.19" class="difflineplus">+  fill-opacity: 0.5;</span>
<a href="#l14.20"></a><span id="l14.20" class="difflineplus">+  width: 48px;</span>
<a href="#l14.21"></a><span id="l14.21" class="difflineplus">+  height: 48px;</span>
<a href="#l14.22"></a><span id="l14.22" class="difflineplus">+  margin-inline-end: 10px;</span>
<a href="#l14.23"></a><span id="l14.23" class="difflineplus">+}</span>
<a href="#l14.24"></a><span id="l14.24" class="difflineplus">+</span>
<a href="#l14.25"></a><span id="l14.25" class="difflineplus">+/* Add a bit of space to the end of descriptions to</span>
<a href="#l14.26"></a><span id="l14.26" class="difflineplus">+ * leave margin with e.g. additional buttons on the side. */</span>
<a href="#l14.27"></a><span id="l14.27" class="difflineplus">+.description-with-side-element {</span>
<a href="#l14.28"></a><span id="l14.28" class="difflineplus">+  margin-inline-end: 10px !important;</span>
<a href="#l14.29"></a><span id="l14.29" class="difflineplus">+}</span>
<a href="#l14.30"></a><span id="l14.30" class="difflineplus">+</span>
<a href="#l14.31"></a><span id="l14.31" class="difflineplus">+.openpgp-description p {</span>
<a href="#l14.32"></a><span id="l14.32" class="difflineplus">+  margin-block: 0 6px;</span>
<a href="#l14.33"></a><span id="l14.33" class="difflineplus">+}</span>
<a href="#l14.34"></a><span id="l14.34" class="difflineplus">+</span>
<a href="#l14.35"></a><span id="l14.35" class="difflineplus">+.status-success:not([hidden=&quot;true&quot;]) {</span>
<a href="#l14.36"></a><span id="l14.36" class="difflineplus">+  vertical-align: text-top;</span>
<a href="#l14.37"></a><span id="l14.37" class="difflineplus">+  display: inline-block;</span>
<a href="#l14.38"></a><span id="l14.38" class="difflineplus">+  list-style-image: url(&quot;chrome://global/skin/icons/check.svg&quot;);</span>
<a href="#l14.39"></a><span id="l14.39" class="difflineplus">+  -moz-context-properties: fill;</span>
<a href="#l14.40"></a><span id="l14.40" class="difflineplus">+  fill: #12bc00;</span>
<a href="#l14.41"></a><span id="l14.41" class="difflineplus">+  margin-inline-end: 2px;</span>
<a href="#l14.42"></a><span id="l14.42" class="difflineplus">+  width: 16px;</span>
<a href="#l14.43"></a><span id="l14.43" class="difflineplus">+}</span>
<a href="#l14.44"></a><span id="l14.44" class="difflineplus">+</span>
<a href="#l14.45"></a><span id="l14.45" class="difflineplus">+/* ::::: OpenPGP key selection ::::: */</span>
<a href="#l14.46"></a><span id="l14.46" class="difflineplus">+</span>
<a href="#l14.47"></a><span id="l14.47" class="difflineplus">+.openpgp-container {</span>
<a href="#l14.48"></a><span id="l14.48" class="difflineplus">+  margin-top: 10px;</span>
<a href="#l14.49"></a><span id="l14.49" class="difflineplus">+}</span>
<a href="#l14.50"></a><span id="l14.50" class="difflineplus">+</span>
<a href="#l14.51"></a><span id="l14.51" class="difflineplus">+.opengpg-intro-section {</span>
<a href="#l14.52"></a><span id="l14.52" class="difflineplus">+  margin-bottom: 10px;</span>
<a href="#l14.53"></a><span id="l14.53" class="difflineplus">+}</span>
<a href="#l14.54"></a><span id="l14.54" class="difflineplus">+</span>
<a href="#l14.55"></a><span id="l14.55" class="difflineplus">+#openPgpKeyList {</span>
<a href="#l14.56"></a><span id="l14.56" class="difflineplus">+  margin-top: 16px;</span>
<a href="#l14.57"></a><span id="l14.57" class="difflineplus">+}</span>
<a href="#l14.58"></a><span id="l14.58" class="difflineplus">+</span>
<a href="#l14.59"></a><span id="l14.59" class="difflineplus">+.content-blocking-category .checkbox-label-box,</span>
<a href="#l14.60"></a><span id="l14.60" class="difflineplus">+.extra-information-label image,</span>
<a href="#l14.61"></a><span id="l14.61" class="difflineplus">+.arrowhead,</span>
<a href="#l14.62"></a><span id="l14.62" class="difflineplus">+.content-blocking-info-image {</span>
<a href="#l14.63"></a><span id="l14.63" class="difflineplus">+  -moz-context-properties: fill;</span>
<a href="#l14.64"></a><span id="l14.64" class="difflineplus">+  fill: currentColor;</span>
<a href="#l14.65"></a><span id="l14.65" class="difflineplus">+}</span>
<a href="#l14.66"></a><span id="l14.66" class="difflineplus">+</span>
<a href="#l14.67"></a><span id="l14.67" class="difflineplus">+.content-blocking-category {</span>
<a href="#l14.68"></a><span id="l14.68" class="difflineplus">+  border-radius: 4px;</span>
<a href="#l14.69"></a><span id="l14.69" class="difflineplus">+  margin: 3px 0;</span>
<a href="#l14.70"></a><span id="l14.70" class="difflineplus">+  padding: 9px;</span>
<a href="#l14.71"></a><span id="l14.71" class="difflineplus">+  border: 1px solid var(--in-content-border-color);</span>
<a href="#l14.72"></a><span id="l14.72" class="difflineplus">+  background-color: rgba(215, 215, 219, 0.2);</span>
<a href="#l14.73"></a><span id="l14.73" class="difflineplus">+}</span>
<a href="#l14.74"></a><span id="l14.74" class="difflineplus">+</span>
<a href="#l14.75"></a><span id="l14.75" class="difflineplus">+.content-blocking-category.disabled {</span>
<a href="#l14.76"></a><span id="l14.76" class="difflineplus">+  opacity: 0.5;</span>
<a href="#l14.77"></a><span id="l14.77" class="difflineplus">+}</span>
<a href="#l14.78"></a><span id="l14.78" class="difflineplus">+</span>
<a href="#l14.79"></a><span id="l14.79" class="difflineplus">+.content-blocking-category.disabled .radio-check {</span>
<a href="#l14.80"></a><span id="l14.80" class="difflineplus">+  opacity: 1;</span>
<a href="#l14.81"></a><span id="l14.81" class="difflineplus">+}</span>
<a href="#l14.82"></a><span id="l14.82" class="difflineplus">+</span>
<a href="#l14.83"></a><span id="l14.83" class="difflineplus">+.content-blocking-warning &gt; .indent,</span>
<a href="#l14.84"></a><span id="l14.84" class="difflineplus">+.content-blocking-category &gt; .indent {</span>
<a href="#l14.85"></a><span id="l14.85" class="difflineplus">+  margin-inline-end: 28px;</span>
<a href="#l14.86"></a><span id="l14.86" class="difflineplus">+  margin-inline-start: 30px;</span>
<a href="#l14.87"></a><span id="l14.87" class="difflineplus">+}</span>
<a href="#l14.88"></a><span id="l14.88" class="difflineplus">+</span>
<a href="#l14.89"></a><span id="l14.89" class="difflineplus">+.arrowhead {</span>
<a href="#l14.90"></a><span id="l14.90" class="difflineplus">+  -moz-appearance: none;</span>
<a href="#l14.91"></a><span id="l14.91" class="difflineplus">+  border: none;</span>
<a href="#l14.92"></a><span id="l14.92" class="difflineplus">+  border-radius: 2px;</span>
<a href="#l14.93"></a><span id="l14.93" class="difflineplus">+  min-height: 20px;</span>
<a href="#l14.94"></a><span id="l14.94" class="difflineplus">+  min-width: 20px;</span>
<a href="#l14.95"></a><span id="l14.95" class="difflineplus">+  max-height: 20px;</span>
<a href="#l14.96"></a><span id="l14.96" class="difflineplus">+  max-width: 20px;</span>
<a href="#l14.97"></a><span id="l14.97" class="difflineplus">+  list-style-image: url(&quot;chrome://global/skin/icons/arrow-dropdown-12.svg&quot;);</span>
<a href="#l14.98"></a><span id="l14.98" class="difflineplus">+  background-color: transparent;</span>
<a href="#l14.99"></a><span id="l14.99" class="difflineplus">+  padding: 3px;</span>
<a href="#l14.100"></a><span id="l14.100" class="difflineplus">+}</span>
<a href="#l14.101"></a><span id="l14.101" class="difflineplus">+</span>
<a href="#l14.102"></a><span id="l14.102" class="difflineplus">+.arrowhead:not([disabled]):hover {</span>
<a href="#l14.103"></a><span id="l14.103" class="difflineplus">+  cursor: pointer;</span>
<a href="#l14.104"></a><span id="l14.104" class="difflineplus">+  background-color: var(--grey-90-a10);</span>
<a href="#l14.105"></a><span id="l14.105" class="difflineplus">+}</span>
<a href="#l14.106"></a><span id="l14.106" class="difflineplus">+</span>
<a href="#l14.107"></a><span id="l14.107" class="difflineplus">+.arrowhead:not([disabled]):hover:active {</span>
<a href="#l14.108"></a><span id="l14.108" class="difflineplus">+  background-color: var(--grey-90-a20);</span>
<a href="#l14.109"></a><span id="l14.109" class="difflineplus">+}</span>
<a href="#l14.110"></a><span id="l14.110" class="difflineplus">+</span>
<a href="#l14.111"></a><span id="l14.111" class="difflineplus">+.arrowhead.up {</span>
<a href="#l14.112"></a><span id="l14.112" class="difflineplus">+  list-style-image: url(&quot;chrome://global/skin/icons/arrow-up-12.svg&quot;);</span>
<a href="#l14.113"></a><span id="l14.113" class="difflineplus">+}</span>
<a href="#l14.114"></a><span id="l14.114" class="difflineplus">+</span>
<a href="#l14.115"></a><span id="l14.115" class="difflineplus">+.arrowhead &gt; .button-box {</span>
<a href="#l14.116"></a><span id="l14.116" class="difflineplus">+  padding: 0 !important;</span>
<a href="#l14.117"></a><span id="l14.117" class="difflineplus">+}</span>
<a href="#l14.118"></a><span id="l14.118" class="difflineplus">+</span>
<a href="#l14.119"></a><span id="l14.119" class="difflineplus">+.content-blocking-category.expanded:not(.selected) .content-blocking-warning {</span>
<a href="#l14.120"></a><span id="l14.120" class="difflineplus">+  background-color: var(--grey-90-a10);</span>
<a href="#l14.121"></a><span id="l14.121" class="difflineplus">+}</span>
<a href="#l14.122"></a><span id="l14.122" class="difflineplus">+</span>
<a href="#l14.123"></a><span id="l14.123" class="difflineplus">+.content-blocking-category.selected {</span>
<a href="#l14.124"></a><span id="l14.124" class="difflineplus">+  border: 1px solid #45A1FF;</span>
<a href="#l14.125"></a><span id="l14.125" class="difflineplus">+  background-color: rgba(69, 161, 255, 0.2);</span>
<a href="#l14.126"></a><span id="l14.126" class="difflineplus">+}</span>
<a href="#l14.127"></a><span id="l14.127" class="difflineplus">+</span>
<a href="#l14.128"></a><span id="l14.128" class="difflineplus">+.content-blocking-warning-title,</span>
<a href="#l14.129"></a><span id="l14.129" class="difflineplus">+.content-blocking-category .radio-label-box {</span>
<a href="#l14.130"></a><span id="l14.130" class="difflineplus">+  font-weight: bold;</span>
<a href="#l14.131"></a><span id="l14.131" class="difflineplus">+}</span>
<a href="#l14.132"></a><span id="l14.132" class="difflineplus">+</span>
<a href="#l14.133"></a><span id="l14.133" class="difflineplus">+.content-blocking-extra-information {</span>
<a href="#l14.134"></a><span id="l14.134" class="difflineplus">+  visibility: collapse;</span>
<a href="#l14.135"></a><span id="l14.135" class="difflineplus">+}</span>
<a href="#l14.136"></a><span id="l14.136" class="difflineplus">+</span>
<a href="#l14.137"></a><span id="l14.137" class="difflineplus">+.extra-information-label {</span>
<a href="#l14.138"></a><span id="l14.138" class="difflineplus">+  display: inline-grid;</span>
<a href="#l14.139"></a><span id="l14.139" class="difflineplus">+  grid-template-columns: auto max-content 2fr;</span>
<a href="#l14.140"></a><span id="l14.140" class="difflineplus">+  row-gap: 10px;</span>
<a href="#l14.141"></a><span id="l14.141" class="difflineplus">+  align-items: center;</span>
<a href="#l14.142"></a><span id="l14.142" class="difflineplus">+  margin-block: 18px;</span>
<a href="#l14.143"></a><span id="l14.143" class="difflineplus">+}</span>
<a href="#l14.144"></a><span id="l14.144" class="difflineplus">+</span>
<a href="#l14.145"></a><span id="l14.145" class="difflineplus">+/* Apply display: block to the containers of all the category information, as</span>
<a href="#l14.146"></a><span id="l14.146" class="difflineplus">+ * without this the flex-wrapped blocks inside don't stretch vertically to</span>
<a href="#l14.147"></a><span id="l14.147" class="difflineplus">+ * enclose their content. */</span>
<a href="#l14.148"></a><span id="l14.148" class="difflineplus">+.content-blocking-category &gt; .indent {</span>
<a href="#l14.149"></a><span id="l14.149" class="difflineplus">+  display: block;</span>
<a href="#l14.150"></a><span id="l14.150" class="difflineplus">+}</span>
<a href="#l14.151"></a><span id="l14.151" class="difflineplus">+</span>
<a href="#l14.152"></a><span id="l14.152" class="difflineplus">+.content-blocking-category.expanded .content-blocking-extra-information {</span>
<a href="#l14.153"></a><span id="l14.153" class="difflineplus">+  visibility: visible;</span>
<a href="#l14.154"></a><span id="l14.154" class="difflineplus">+  display: flex;</span>
<a href="#l14.155"></a><span id="l14.155" class="difflineplus">+  flex-direction: column;</span>
<a href="#l14.156"></a><span id="l14.156" class="difflineplus">+  align-content: stretch;</span>
<a href="#l14.157"></a><span id="l14.157" class="difflineplus">+  margin-bottom: 10px;</span>
<a href="#l14.158"></a><span id="l14.158" class="difflineplus">+}</span>
<a href="#l14.159"></a><span id="l14.159" class="difflineplus">+</span>
<a href="#l14.160"></a><span id="l14.160" class="difflineplus">+.content-blocking-extra-information &gt; .custom-option {</span>
<a href="#l14.161"></a><span id="l14.161" class="difflineplus">+  margin: 10px 0;</span>
<a href="#l14.162"></a><span id="l14.162" class="difflineplus">+}</span>
<a href="#l14.163"></a><span id="l14.163" class="difflineplus">+</span>
<a href="#l14.164"></a><span id="l14.164" class="difflineplus">+.content-blocking-warning {</span>
<a href="#l14.165"></a><span id="l14.165" class="difflineplus">+  background-color: rgba(69, 161, 255, 0.2);</span>
<a href="#l14.166"></a><span id="l14.166" class="difflineplus">+  border-radius: 4px;</span>
<a href="#l14.167"></a><span id="l14.167" class="difflineplus">+  padding: 10px 0;</span>
<a href="#l14.168"></a><span id="l14.168" class="difflineplus">+  margin: 10px 0;</span>
<a href="#l14.169"></a><span id="l14.169" class="difflineplus">+}</span>
<a href="#l14.170"></a><span id="l14.170" class="difflineplus">+</span>
<a href="#l14.171"></a><span id="l14.171" class="difflineplus">+.content-blocking-warning:not([hidden]) + .content-blocking-warning {</span>
<a href="#l14.172"></a><span id="l14.172" class="difflineplus">+  margin-top: 0;</span>
<a href="#l14.173"></a><span id="l14.173" class="difflineplus">+}</span>
<a href="#l14.174"></a><span id="l14.174" class="difflineplus">+</span>
<a href="#l14.175"></a><span id="l14.175" class="difflineplus">+.content-blocking-category-description {</span>
<a href="#l14.176"></a><span id="l14.176" class="difflineplus">+  font-size: 90%;</span>
<a href="#l14.177"></a><span id="l14.177" class="difflineplus">+  opacity: 0.6;</span>
<a href="#l14.178"></a><span id="l14.178" class="difflineplus">+}</span>
<a href="#l14.179"></a><span id="l14.179" class="difflineplus">+</span>
<a href="#l14.180"></a><span id="l14.180" class="difflineplus">+.expiration-date-icon {</span>
<a href="#l14.181"></a><span id="l14.181" class="difflineplus">+  display: none;</span>
<a href="#l14.182"></a><span id="l14.182" class="difflineplus">+  vertical-align: text-top;</span>
<a href="#l14.183"></a><span id="l14.183" class="difflineplus">+  -moz-context-properties: fill;</span>
<a href="#l14.184"></a><span id="l14.184" class="difflineplus">+  margin-inline-end: 4px;</span>
<a href="#l14.185"></a><span id="l14.185" class="difflineplus">+  fill: currentColor;</span>
<a href="#l14.186"></a><span id="l14.186" class="difflineplus">+  width: 16px;</span>
<a href="#l14.187"></a><span id="l14.187" class="difflineplus">+}</span>
<a href="#l14.188"></a><span id="l14.188" class="difflineplus">+</span>
<a href="#l14.189"></a><span id="l14.189" class="difflineplus">+.expiration-date-container.key-is-expiring .expiration-date-icon {</span>
<a href="#l14.190"></a><span id="l14.190" class="difflineplus">+  display: inline-block;</span>
<a href="#l14.191"></a><span id="l14.191" class="difflineplus">+  list-style-image: url(&quot;chrome://messenger/skin/icons/info.svg&quot;);</span>
<a href="#l14.192"></a><span id="l14.192" class="difflineplus">+  opacity: 0.9;</span>
<a href="#l14.193"></a><span id="l14.193" class="difflineplus">+}</span>
<a href="#l14.194"></a><span id="l14.194" class="difflineplus">+</span>
<a href="#l14.195"></a><span id="l14.195" class="difflineplus">+.expiration-date-container.key-expired description {</span>
<a href="#l14.196"></a><span id="l14.196" class="difflineplus">+  color: #D70022;</span>
<a href="#l14.197"></a><span id="l14.197" class="difflineplus">+  font-weight: 600;</span>
<a href="#l14.198"></a><span id="l14.198" class="difflineplus">+}</span>
<a href="#l14.199"></a><span id="l14.199" class="difflineplus">+</span>
<a href="#l14.200"></a><span id="l14.200" class="difflineplus">+.expiration-date-container.key-expired .expiration-date-icon {</span>
<a href="#l14.201"></a><span id="l14.201" class="difflineplus">+  display: inline-block;</span>
<a href="#l14.202"></a><span id="l14.202" class="difflineplus">+  list-style-image: url(&quot;chrome://global/skin/icons/warning.svg&quot;);</span>
<a href="#l14.203"></a><span id="l14.203" class="difflineplus">+  fill: #FF9400;</span>
<a href="#l14.204"></a><span id="l14.204" class="difflineplus">+}</span>
<a href="#l14.205"></a><span id="l14.205" class="difflineplus">+</span>
<a href="#l14.206"></a><span id="l14.206" class="difflineplus">+.expiration-date-button {</span>
<a href="#l14.207"></a><span id="l14.207" class="difflineplus">+  margin-inline-start: 8px;</span>
<a href="#l14.208"></a><span id="l14.208" class="difflineplus">+  font-size: 0.9em;</span>
<a href="#l14.209"></a><span id="l14.209" class="difflineplus">+  min-height: 28px;</span>
<a href="#l14.210"></a><span id="l14.210" class="difflineplus">+}</span>
<a href="#l14.211"></a><span id="l14.211" class="difflineplus">+</span>
<a href="#l14.212"></a><span id="l14.212" class="difflineplus">+.extra-information-label-type {</span>
<a href="#l14.213"></a><span id="l14.213" class="difflineplus">+  font-weight: 600;</span>
<a href="#l14.214"></a><span id="l14.214" class="difflineplus">+  margin-inline-end: 4px;</span>
<a href="#l14.215"></a><span id="l14.215" class="difflineplus">+}</span>
<a href="#l14.216"></a><span id="l14.216" class="difflineplus">+</span>
<a href="#l14.217"></a><span id="l14.217" class="difflineplus">+/* Key info icons */</span>
<a href="#l14.218"></a><span id="l14.218" class="difflineplus">+.extra-information-label image {</span>
<a href="#l14.219"></a><span id="l14.219" class="difflineplus">+  margin-inline-end: 5px;</span>
<a href="#l14.220"></a><span id="l14.220" class="difflineplus">+}</span>
<a href="#l14.221"></a><span id="l14.221" class="difflineplus">+</span>
<a href="#l14.222"></a><span id="l14.222" class="difflineplus">+.content-blocking-openpgp-type {</span>
<a href="#l14.223"></a><span id="l14.223" class="difflineplus">+  list-style-image: url(&quot;chrome://messenger/skin/icons/mark.svg&quot;);</span>
<a href="#l14.224"></a><span id="l14.224" class="difflineplus">+}</span>
<a href="#l14.225"></a><span id="l14.225" class="difflineplus">+</span>
<a href="#l14.226"></a><span id="l14.226" class="difflineplus">+.content-blocking-openpgp-fingerprint {</span>
<a href="#l14.227"></a><span id="l14.227" class="difflineplus">+  list-style-image: url(&quot;chrome://messenger/skin/icons/fingerprint.svg&quot;);</span>
<a href="#l14.228"></a><span id="l14.228" class="difflineplus">+}</span>
<a href="#l14.229"></a><span id="l14.229" class="difflineplus">+</span>
<a href="#l14.230"></a><span id="l14.230" class="difflineplus">+.content-blocking-openpgp-created {</span>
<a href="#l14.231"></a><span id="l14.231" class="difflineplus">+  list-style-image: url(&quot;chrome://messenger/skin/shared/preferences/calendar.svg&quot;);</span>
<a href="#l14.232"></a><span id="l14.232" class="difflineplus">+}</span>
<a href="#l14.233"></a><span id="l14.233" class="difflineplus">+</span>
<a href="#l14.234"></a><span id="l14.234" class="difflineplus">+.openpgp-key-details {</span>
<a href="#l14.235"></a><span id="l14.235" class="difflineplus">+  margin-bottom: 18px;</span>
<a href="#l14.236"></a><span id="l14.236" class="difflineplus">+  border: 1px solid var(--in-content-box-border-color);</span>
<a href="#l14.237"></a><span id="l14.237" class="difflineplus">+  border-radius: 4px;</span>
<a href="#l14.238"></a><span id="l14.238" class="difflineplus">+  overflow: hidden;</span>
<a href="#l14.239"></a><span id="l14.239" class="difflineplus">+  background-color: var(--in-content-page-background);</span>
<a href="#l14.240"></a><span id="l14.240" class="difflineplus">+}</span>
<a href="#l14.241"></a><span id="l14.241" class="difflineplus">+</span>
<a href="#l14.242"></a><span id="l14.242" class="difflineplus">+.openpgp-key-details tabs {</span>
<a href="#l14.243"></a><span id="l14.243" class="difflineplus">+  border-top: none;</span>
<a href="#l14.244"></a><span id="l14.244" class="difflineplus">+}</span>
<a href="#l14.245"></a><span id="l14.245" class="difflineplus">+</span>
<a href="#l14.246"></a><span id="l14.246" class="difflineplus">+.openpgp-key-details tabpanels {</span>
<a href="#l14.247"></a><span id="l14.247" class="difflineplus">+  padding: 0 10px 18px;</span>
<a href="#l14.248"></a><span id="l14.248" class="difflineplus">+}</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l15.1"></a><span id="l15.1">new file mode 100644</span>
<a href="#l15.2"></a><span id="l15.2" class="difflineminus">--- /dev/null</span>
<a href="#l15.3"></a><span id="l15.3" class="difflineplus">+++ b/mail/themes/shared/mail/icons/fingerprint.svg</span>
<a href="#l15.4"></a><span id="l15.4" class="difflineat">@@ -0,0 +1,4 @@</span>
<a href="#l15.5"></a><span id="l15.5" class="difflineplus">+&lt;!-- This Source Code Form is subject to the terms of the Mozilla Public</span>
<a href="#l15.6"></a><span id="l15.6" class="difflineplus">+   - License, v. 2.0. If a copy of the MPL was not distributed with this</span>
<a href="#l15.7"></a><span id="l15.7" class="difflineplus">+   - file, You can obtain one at http://mozilla.org/MPL/2.0/. --&gt;</span>
<a href="#l15.8"></a><span id="l15.8" class="difflineplus">+&lt;svg xmlns=&quot;http://www.w3.org/2000/svg&quot; width=&quot;16&quot; height=&quot;16&quot; viewBox=&quot;0 0 16 16&quot; fill=&quot;context-fill&quot; fill-opacity=&quot;context-fill-opacity&quot;&gt;&lt;path d=&quot;M8 0a7 7 0 0 0-7 7 1 1 0 0 0 2 0 5 5 0 0 1 10 0 8.24 8.24 0 0 1-1.14 4.28A5.75 5.75 0 0 0 11 14a1 1 0 0 0 2 0 3.91 3.91 0 0 1 .63-1.79A10.18 10.18 0 0 0 15 7a7 7 0 0 0-7-7z&quot;&gt;&lt;/path&gt;&lt;path d=&quot;M8 3a4 4 0 0 0-4 4 2 2 0 0 1-2 2 1 1 0 0 0 0 2 4 4 0 0 0 4-4 2 2 0 0 1 4 0 6.88 6.88 0 0 1-1.74 4.8 11 11 0 0 0-1.15 1.75 1 1 0 0 0 .44 1.34A.93.93 0 0 0 8 15a1 1 0 0 0 .89-.55 9.74 9.74 0 0 1 1-1.44A8.84 8.84 0 0 0 12 7a4 4 0 0 0-4-4z&quot;&gt;&lt;/path&gt;&lt;path d=&quot;M8 6a1 1 0 0 0-1 1c0 4.21-5.26 6-5.32 6.05a1 1 0 0 0-.63 1.27A1 1 0 0 0 2 15a1.25 1.25 0 0 0 .32 0C2.59 14.86 9 12.66 9 7a1 1 0 0 0-1-1z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;</span>
<a href="#l15.9"></a><span id="l15.9">\ No newline at end of file</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l16.1"></a><span id="l16.1" class="difflineminus">--- a/mail/themes/shared/mail/icons/login.svg</span>
<a href="#l16.2"></a><span id="l16.2" class="difflineplus">+++ b/mail/themes/shared/mail/icons/login.svg</span>
<a href="#l16.3"></a><span id="l16.3" class="difflineat">@@ -1,4 +1,4 @@</span>
<a href="#l16.4"></a><span id="l16.4"> &lt;!-- This Source Code Form is subject to the terms of the Mozilla Public</span>
<a href="#l16.5"></a><span id="l16.5">    - License, v. 2.0. If a copy of the MPL was not distributed with this</span>
<a href="#l16.6"></a><span id="l16.6">    - file, You can obtain one at http://mozilla.org/MPL/2.0/. --&gt;</span>
<a href="#l16.7"></a><span id="l16.7" class="difflineminus">-&lt;svg xmlns=&quot;http://www.w3.org/2000/svg&quot; width=&quot;16&quot; height=&quot;16&quot; viewBox=&quot;0 0 16 16&quot;&gt;&lt;path fill=&quot;context-fill&quot; d=&quot;M10.992 1a4.009 4.009 0 0 0-4.009 4.008c0 .1.022.187.028.282-.059.05-.119.087-.178.143L5.667 6.6a.366.366 0 0 0 0 .467A1.878 1.878 0 0 0 6 7.5.353.353 0 0 1 6 8l-5 5v1.767a.229.229 0 0 0 .233.233H3.77a.229.229 0 0 0 .23-.233v-.778h.75a.227.227 0 0 0 .233-.228v-.768H5.2s.28 0 .28-.235V12.5h.779s.233-.1.233-.244v-1.271h.855l1.12-1.118H8.7l.467.467c.233.233.233.233.365.233a.437.437 0 0 0 .275-.127l.993-1.273c.034-.053.054-.107.084-.161.036 0 .07.011.107.011a4.008 4.008 0 1 0 0-8.017zM12.5 4.489a1 1 0 1 1 1-1 1 1 0 0 1-1 1z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;</span>
<a href="#l16.8"></a><span id="l16.8" class="difflineplus">+&lt;svg xmlns=&quot;http://www.w3.org/2000/svg&quot; width=&quot;16&quot; height=&quot;16&quot; viewBox=&quot;0 0 16 16&quot;&gt;&lt;path fill=&quot;context-fill&quot; fill-opacity=&quot;context-fill-opacity&quot; d=&quot;M10.992 1a4.009 4.009 0 0 0-4.009 4.008c0 .1.022.187.028.282-.059.05-.119.087-.178.143L5.667 6.6a.366.366 0 0 0 0 .467A1.878 1.878 0 0 0 6 7.5.353.353 0 0 1 6 8l-5 5v1.767a.229.229 0 0 0 .233.233H3.77a.229.229 0 0 0 .23-.233v-.778h.75a.227.227 0 0 0 .233-.228v-.768H5.2s.28 0 .28-.235V12.5h.779s.233-.1.233-.244v-1.271h.855l1.12-1.118H8.7l.467.467c.233.233.233.233.365.233a.437.437 0 0 0 .275-.127l.993-1.273c.034-.053.054-.107.084-.161.036 0 .07.011.107.011a4.008 4.008 0 1 0 0-8.017zM12.5 4.489a1 1 0 1 1 1-1 1 1 0 0 1-1 1z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l17.1"></a><span id="l17.1">new file mode 100644</span>
<a href="#l17.2"></a><span id="l17.2" class="difflineminus">--- /dev/null</span>
<a href="#l17.3"></a><span id="l17.3" class="difflineplus">+++ b/mail/themes/shared/openpgp/inlineNotification.css</span>
<a href="#l17.4"></a><span id="l17.4" class="difflineat">@@ -0,0 +1,66 @@</span>
<a href="#l17.5"></a><span id="l17.5" class="difflineplus">+/* This Source Code Form is subject to the terms of the Mozilla Public</span>
<a href="#l17.6"></a><span id="l17.6" class="difflineplus">+ * License, v. 2.0. If a copy of the MPL was not distributed with this</span>
<a href="#l17.7"></a><span id="l17.7" class="difflineplus">+ * file, You can obtain one at http://mozilla.org/MPL/2.0/. */</span>
<a href="#l17.8"></a><span id="l17.8" class="difflineplus">+</span>
<a href="#l17.9"></a><span id="l17.9" class="difflineplus">+.inline-notification-container:not([collapsed=&quot;true&quot;]) {</span>
<a href="#l17.10"></a><span id="l17.10" class="difflineplus">+  display: block;</span>
<a href="#l17.11"></a><span id="l17.11" class="difflineplus">+  border-radius: 4px;</span>
<a href="#l17.12"></a><span id="l17.12" class="difflineplus">+  padding: 10px;</span>
<a href="#l17.13"></a><span id="l17.13" class="difflineplus">+  margin: 10px 0;</span>
<a href="#l17.14"></a><span id="l17.14" class="difflineplus">+  color: inherit;</span>
<a href="#l17.15"></a><span id="l17.15" class="difflineplus">+}</span>
<a href="#l17.16"></a><span id="l17.16" class="difflineplus">+</span>
<a href="#l17.17"></a><span id="l17.17" class="difflineplus">+.inline-notification-wrapper {</span>
<a href="#l17.18"></a><span id="l17.18" class="difflineplus">+  display: flex;</span>
<a href="#l17.19"></a><span id="l17.19" class="difflineplus">+  align-items: flex-start;</span>
<a href="#l17.20"></a><span id="l17.20" class="difflineplus">+}</span>
<a href="#l17.21"></a><span id="l17.21" class="difflineplus">+</span>
<a href="#l17.22"></a><span id="l17.22" class="difflineplus">+.inline-notification-wrapper.align-center {</span>
<a href="#l17.23"></a><span id="l17.23" class="difflineplus">+  align-items: center;</span>
<a href="#l17.24"></a><span id="l17.24" class="difflineplus">+}</span>
<a href="#l17.25"></a><span id="l17.25" class="difflineplus">+</span>
<a href="#l17.26"></a><span id="l17.26" class="difflineplus">+.inline-notification-wrapper description {</span>
<a href="#l17.27"></a><span id="l17.27" class="difflineplus">+  flex: 1;</span>
<a href="#l17.28"></a><span id="l17.28" class="difflineplus">+}</span>
<a href="#l17.29"></a><span id="l17.29" class="difflineplus">+</span>
<a href="#l17.30"></a><span id="l17.30" class="difflineplus">+.notification-image {</span>
<a href="#l17.31"></a><span id="l17.31" class="difflineplus">+  -moz-context-properties: fill;</span>
<a href="#l17.32"></a><span id="l17.32" class="difflineplus">+  fill: currentColor;</span>
<a href="#l17.33"></a><span id="l17.33" class="difflineplus">+  margin-inline: 4px 8px;</span>
<a href="#l17.34"></a><span id="l17.34" class="difflineplus">+  margin-top: 4px;</span>
<a href="#l17.35"></a><span id="l17.35" class="difflineplus">+  width: 16px;</span>
<a href="#l17.36"></a><span id="l17.36" class="difflineplus">+}</span>
<a href="#l17.37"></a><span id="l17.37" class="difflineplus">+</span>
<a href="#l17.38"></a><span id="l17.38" class="difflineplus">+.inline-notification-wrapper.align-center {</span>
<a href="#l17.39"></a><span id="l17.39" class="difflineplus">+  margin-top: 0;</span>
<a href="#l17.40"></a><span id="l17.40" class="difflineplus">+}</span>
<a href="#l17.41"></a><span id="l17.41" class="difflineplus">+</span>
<a href="#l17.42"></a><span id="l17.42" class="difflineplus">+/* Info variation */</span>
<a href="#l17.43"></a><span id="l17.43" class="difflineplus">+</span>
<a href="#l17.44"></a><span id="l17.44" class="difflineplus">+.inline-notification-container.info-container {</span>
<a href="#l17.45"></a><span id="l17.45" class="difflineplus">+  background-color: rgba(69, 161, 255, 0.2);</span>
<a href="#l17.46"></a><span id="l17.46" class="difflineplus">+}</span>
<a href="#l17.47"></a><span id="l17.47" class="difflineplus">+</span>
<a href="#l17.48"></a><span id="l17.48" class="difflineplus">+.notification-image-info {</span>
<a href="#l17.49"></a><span id="l17.49" class="difflineplus">+  list-style-image: url(&quot;chrome://messenger/skin/icons/information.svg&quot;);</span>
<a href="#l17.50"></a><span id="l17.50" class="difflineplus">+}</span>
<a href="#l17.51"></a><span id="l17.51" class="difflineplus">+</span>
<a href="#l17.52"></a><span id="l17.52" class="difflineplus">+/* error variation */</span>
<a href="#l17.53"></a><span id="l17.53" class="difflineplus">+</span>
<a href="#l17.54"></a><span id="l17.54" class="difflineplus">+.inline-notification-container.error-container {</span>
<a href="#l17.55"></a><span id="l17.55" class="difflineplus">+  background-color: rgba(255, 69, 69, 0.2);</span>
<a href="#l17.56"></a><span id="l17.56" class="difflineplus">+}</span>
<a href="#l17.57"></a><span id="l17.57" class="difflineplus">+</span>
<a href="#l17.58"></a><span id="l17.58" class="difflineplus">+.notification-image-error {</span>
<a href="#l17.59"></a><span id="l17.59" class="difflineplus">+  list-style-image: url(&quot;chrome://global/skin/icons/warning.svg&quot;);</span>
<a href="#l17.60"></a><span id="l17.60" class="difflineplus">+}</span>
<a href="#l17.61"></a><span id="l17.61" class="difflineplus">+</span>
<a href="#l17.62"></a><span id="l17.62" class="difflineplus">+/* success variation */</span>
<a href="#l17.63"></a><span id="l17.63" class="difflineplus">+</span>
<a href="#l17.64"></a><span id="l17.64" class="difflineplus">+.inline-notification-container.success-container {</span>
<a href="#l17.65"></a><span id="l17.65" class="difflineplus">+  background-color: rgba(69, 255, 100, 0.2);</span>
<a href="#l17.66"></a><span id="l17.66" class="difflineplus">+}</span>
<a href="#l17.67"></a><span id="l17.67" class="difflineplus">+</span>
<a href="#l17.68"></a><span id="l17.68" class="difflineplus">+.notification-image-success {</span>
<a href="#l17.69"></a><span id="l17.69" class="difflineplus">+  list-style-image: url(&quot;chrome://global/skin/icons/check.svg&quot;);</span>
<a href="#l17.70"></a><span id="l17.70" class="difflineplus">+}</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l18.1"></a><span id="l18.1">new file mode 100644</span>
<a href="#l18.2"></a><span id="l18.2" class="difflineminus">--- /dev/null</span>
<a href="#l18.3"></a><span id="l18.3" class="difflineplus">+++ b/mail/themes/shared/openpgp/keyWizard.css</span>
<a href="#l18.4"></a><span id="l18.4" class="difflineat">@@ -0,0 +1,58 @@</span>
<a href="#l18.5"></a><span id="l18.5" class="difflineplus">+/* This Source Code Form is subject to the terms of the Mozilla Public</span>
<a href="#l18.6"></a><span id="l18.6" class="difflineplus">+ * License, v. 2.0. If a copy of the MPL was not distributed with this</span>
<a href="#l18.7"></a><span id="l18.7" class="difflineplus">+ * file, You can obtain one at http://mozilla.org/MPL/2.0/. */</span>
<a href="#l18.8"></a><span id="l18.8" class="difflineplus">+</span>
<a href="#l18.9"></a><span id="l18.9" class="difflineplus">+@import url(&quot;chrome://messenger/skin/messenger.css&quot;);</span>
<a href="#l18.10"></a><span id="l18.10" class="difflineplus">+</span>
<a href="#l18.11"></a><span id="l18.11" class="difflineplus">+/* ::::: Warnings and inline notifications ::::: */</span>
<a href="#l18.12"></a><span id="l18.12" class="difflineplus">+</span>
<a href="#l18.13"></a><span id="l18.13" class="difflineplus">+.dialogheader-title {</span>
<a href="#l18.14"></a><span id="l18.14" class="difflineplus">+  margin-block: 0 8px;</span>
<a href="#l18.15"></a><span id="l18.15" class="difflineplus">+  margin-inline-start: 0;</span>
<a href="#l18.16"></a><span id="l18.16" class="difflineplus">+  font-size: 1.46em;</span>
<a href="#l18.17"></a><span id="l18.17" class="difflineplus">+  font-weight: 300;</span>
<a href="#l18.18"></a><span id="l18.18" class="difflineplus">+  line-height: 1.3em;</span>
<a href="#l18.19"></a><span id="l18.19" class="difflineplus">+  color: var(--in-content-text-color);</span>
<a href="#l18.20"></a><span id="l18.20" class="difflineplus">+}</span>
<a href="#l18.21"></a><span id="l18.21" class="difflineplus">+</span>
<a href="#l18.22"></a><span id="l18.22" class="difflineplus">+.wizard-section {</span>
<a href="#l18.23"></a><span id="l18.23" class="difflineplus">+  transition: transform 230ms ease, opacity 230ms ease;</span>
<a href="#l18.24"></a><span id="l18.24" class="difflineplus">+}</span>
<a href="#l18.25"></a><span id="l18.25" class="difflineplus">+</span>
<a href="#l18.26"></a><span id="l18.26" class="difflineplus">+.wizard-section.hide {</span>
<a href="#l18.27"></a><span id="l18.27" class="difflineplus">+  transform: translateY(-100%);</span>
<a href="#l18.28"></a><span id="l18.28" class="difflineplus">+  opacity: 0;</span>
<a href="#l18.29"></a><span id="l18.29" class="difflineplus">+}</span>
<a href="#l18.30"></a><span id="l18.30" class="difflineplus">+</span>
<a href="#l18.31"></a><span id="l18.31" class="difflineplus">+.wizard-section.hide-reverse {</span>
<a href="#l18.32"></a><span id="l18.32" class="difflineplus">+  transform: translateY(100%);</span>
<a href="#l18.33"></a><span id="l18.33" class="difflineplus">+  opacity: 0;</span>
<a href="#l18.34"></a><span id="l18.34" class="difflineplus">+}</span>
<a href="#l18.35"></a><span id="l18.35" class="difflineplus">+</span>
<a href="#l18.36"></a><span id="l18.36" class="difflineplus">+.grid-size {</span>
<a href="#l18.37"></a><span id="l18.37" class="difflineplus">+  display: grid;</span>
<a href="#l18.38"></a><span id="l18.38" class="difflineplus">+  grid-template-columns: auto 1fr 1fr;</span>
<a href="#l18.39"></a><span id="l18.39" class="difflineplus">+}</span>
<a href="#l18.40"></a><span id="l18.40" class="difflineplus">+</span>
<a href="#l18.41"></a><span id="l18.41" class="difflineplus">+.overlay {</span>
<a href="#l18.42"></a><span id="l18.42" class="difflineplus">+  display: flex;</span>
<a href="#l18.43"></a><span id="l18.43" class="difflineplus">+  position: fixed;</span>
<a href="#l18.44"></a><span id="l18.44" class="difflineplus">+  flex-direction: column;</span>
<a href="#l18.45"></a><span id="l18.45" class="difflineplus">+  justify-content: center;</span>
<a href="#l18.46"></a><span id="l18.46" class="difflineplus">+  background-color: var(--in-content-page-background);</span>
<a href="#l18.47"></a><span id="l18.47" class="difflineplus">+  inset: 0;</span>
<a href="#l18.48"></a><span id="l18.48" class="difflineplus">+  z-index: 1;</span>
<a href="#l18.49"></a><span id="l18.49" class="difflineplus">+}</span>
<a href="#l18.50"></a><span id="l18.50" class="difflineplus">+</span>
<a href="#l18.51"></a><span id="l18.51" class="difflineplus">+.self-center {</span>
<a href="#l18.52"></a><span id="l18.52" class="difflineplus">+  align-self: center;</span>
<a href="#l18.53"></a><span id="l18.53" class="difflineplus">+}</span>
<a href="#l18.54"></a><span id="l18.54" class="difflineplus">+</span>
<a href="#l18.55"></a><span id="l18.55" class="difflineplus">+.loading-status {</span>
<a href="#l18.56"></a><span id="l18.56" class="difflineplus">+  -moz-context-properties: fill;</span>
<a href="#l18.57"></a><span id="l18.57" class="difflineplus">+  fill: currentColor;</span>
<a href="#l18.58"></a><span id="l18.58" class="difflineplus">+  width: 16px;</span>
<a href="#l18.59"></a><span id="l18.59" class="difflineplus">+  height: 16px;</span>
<a href="#l18.60"></a><span id="l18.60" class="difflineplus">+  background: url(&quot;chrome://global/skin/icons/loading.png&quot;) no-repeat;</span>
<a href="#l18.61"></a><span id="l18.61" class="difflineplus">+  background-size: 16px 16px;</span>
<a href="#l18.62"></a><span id="l18.62" class="difflineplus">+}</span></pre></div></div>

<div class="page_footer">
<div class="page_footer_text">comm-central</div>
<div class="page_footer_text" style="padding-left: 10px">Deployed from <a href="https://hg.mozilla.org/hgcustom/version-control-tools/rev/4b0de666d1a4">4b0de666d1a4</a> at 2020-07-30T19:32:31Z.</div>
<div class="rss_logo">
<a href="/comm-central/rss-log">RSS</a>
<a href="/comm-central/atom-log">Atom</a>
</div>
<br />

</div>
</body>
</html>

