<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en-US" lang="en-US">
<head>
<link rel="icon" href="/static/35f393d6769a/hgicon.png" type="image/png" />
<meta name="robots" content="index, nofollow"/>
<link rel="stylesheet" href="/static/35f393d6769a/style-gitweb.css" type="text/css" />

<style type="text/css">
div.feed {
  float: right;
}
a img {
  border-width: 0px;
}
div.log_link {
  width: 80px;
  background-color: white;
}

div.log_body {
  padding-left: 96px;
}
</style>
<script type="text/javascript" src="/static/35f393d6769a/mercurial.js"></script>

<meta property="og:image" content="/static/35f393d6769a/moz-logo-bw-rgb.svg"/>
<meta property="og:type" content="website"/>

<title>comm-central: changeset 6959:d3121c483250becfb0d69689b527179867fe36aa</title>
<link rel="alternate" type="application/atom+xml"
   href="/comm-central/atom-log" title="Atom feed for comm-central"/>
<link rel="alternate" type="application/rss+xml"
   href="/comm-central/rss-log" title="RSS feed for comm-central"/>

<meta property="og:title" content="comm-central @ d3121c483250becfb0d69689b527179867fe36aa" />
<meta property="og:url" content="/comm-central/rev/d3121c483250becfb0d69689b527179867fe36aa" />
<meta property="og:description" content="fix bug 257735, wrong error message when error saving to draft folder, and retry saves to sent folder, r=standard8" />

</head>
<body>

<div class="page_header">
<div class="logo">
    <a href="https://developer.mozilla.org/en/docs/Mercurial">
        <img src="/static/35f393d6769a/moz-logo-bw-rgb.svg" alt="mercurial" />
    </a>
</div>
<a href="/">Mercurial</a> &gt; <a href="/comm-central">comm-central</a>  / changeset / d3121c483250becfb0d69689b527179867fe36aa 
</div>

<div class="page_nav">
<div>
<a href="/comm-central/summary">summary</a> |
<a href="/comm-central/shortlog/d3121c483250becfb0d69689b527179867fe36aa">shortlog</a> |
<a href="/comm-central/log/d3121c483250becfb0d69689b527179867fe36aa">changelog</a> |
<a href="/comm-central/pushloghtml">pushlog</a> |
<a href="/comm-central/graph/d3121c483250becfb0d69689b527179867fe36aa">graph</a> |
<a href="/comm-central/tags">tags</a> |
<a href="/comm-central/bookmarks">bookmarks</a> |
<a href="/comm-central/branches">branches</a> |
<a href="/comm-central/file/d3121c483250becfb0d69689b527179867fe36aa">files</a> |
changeset |
<a href="/comm-central/raw-rev/d3121c483250becfb0d69689b527179867fe36aa">raw</a>  | <a href="/comm-central/archive/d3121c483250becfb0d69689b527179867fe36aa.zip">zip</a>  |
<a href="/comm-central/help">help</a>
</div>

<div class="search">
<form id="searchform" action="/comm-central/log">

<input name="rev" type="text" value="" size="40" />
<div id="hint">Find changesets by keywords (author, files, the commit message), revision
number or hash, or <a href="/comm-central/help/revsets">revset expression</a>.</div>
</form>
</div>
</div>

<div class="title">
fix <a href="https://bugzilla.mozilla.org/show_bug.cgi?id=257735">bug 257735</a>, wrong error message when error saving to draft folder, and retry saves to sent folder, r=standard8
<span class="logtags"></span>
</div>
<div class="title_text">
<table cellspacing="0">

<tr><td>author</td><td>&#68;&#97;&#118;&#105;&#100;&#32;&#66;&#105;&#101;&#110;&#118;&#101;&#110;&#117;&#32;&#60;&#98;&#105;&#101;&#110;&#118;&#101;&#110;&#117;&#64;&#110;&#118;&#101;&#110;&#116;&#117;&#114;&#101;&#46;&#99;&#111;&#109;&#62;</td></tr>
<tr><td></td><td class="date age">Fri, 14 Jan 2011 13:09:51 -0800</td></tr>

<tr>
 <td>changeset 6959</td>
 <td style="font-family:monospace"><a class="list" href="/comm-central/rev/d3121c483250becfb0d69689b527179867fe36aa">d3121c483250becfb0d69689b527179867fe36aa</a></td>
</tr>



<tr>
<td>parent 6958</td>
<td style="font-family:monospace">
<a class="list" href="/comm-central/rev/95805deaae99505aad06c9191f1d42c4c02fb5f7">95805deaae99505aad06c9191f1d42c4c02fb5f7</a>
</td>
</tr>

<tr>
<td>child 6960</td>
<td style="font-family:monospace">
<a class="list" href="/comm-central/rev/cc7fcc38e0f28752e75faeb66b8721e32582da26">cc7fcc38e0f28752e75faeb66b8721e32582da26</a>
</td>
</tr>
<tr><td>push id</td><td><a href="/comm-central/pushloghtml?changeset=d3121c483250becfb0d69689b527179867fe36aa">5335</a></td></tr>
<tr><td>push user</td><td>bienvenu@nventure.com</td></tr>
<tr><td>push date</td><td class="date age">Fri, 14 Jan 2011 21:09:39 +0000</td></tr>

<tr><td>treeherder</td><td>comm-central@d3121c483250 [<a href="https://treeherder.mozilla.org/#/jobs?repo=comm-central&revision=d3121c483250becfb0d69689b527179867fe36aa">default view</a>] [<a href="https://treeherder.mozilla.org/#/jobs?repo=comm-central&revision=d3121c483250becfb0d69689b527179867fe36aa&filter-resultStatus=testfailed&filter-resultStatus=busted&filter-resultStatus=exception">failures only]</td></tr>
<tr><td>perfherder</td><td>[<a href="https://treeherder.mozilla.org/perf.html#/compare?originalProject=comm-central&originalRevision=d3121c483250becfb0d69689b527179867fe36aa&newProject=comm-central&newRevision=d3121c483250becfb0d69689b527179867fe36aa&framework=1" target="_blank">talos</a>] [<a href="https://treeherder.mozilla.org/perf.html#/compare?originalProject=comm-central&originalRevision=d3121c483250becfb0d69689b527179867fe36aa&newProject=comm-central&newRevision=d3121c483250becfb0d69689b527179867fe36aa&framework=2" target="_blank">build metrics</a>] [<a href="https://treeherder.mozilla.org/perf.html#/compare?originalProject=comm-central&originalRevision=d3121c483250becfb0d69689b527179867fe36aa&newProject=comm-central&newRevision=d3121c483250becfb0d69689b527179867fe36aa&framework=6" target="_blank">platform microbench</a>] (compared to previous push)</td></tr>
<tr><td>reviewers</td><td><a href="/comm-central/log?rev=reviewer%28standard8%29&revcount=50">standard8</a></td></tr>
<tr><td>bugs</td><td><a href="https://bugzilla.mozilla.org/show_bug.cgi?id=257735">257735</a></td></tr>




</table></div>

<div class="page_body description">fix <a href="https://bugzilla.mozilla.org/show_bug.cgi?id=257735">bug 257735</a>, wrong error message when error saving to draft folder, and retry saves to sent folder, r=standard8</div>
<div class="list_head"></div>
<div class="title_text">
<table cellspacing="0">

<tr class="parity0">
<td><a class="list" href="/comm-central/diff/d3121c483250becfb0d69689b527179867fe36aa/mail/locales/en-US/chrome/messenger/messengercompose/composeMsgs.properties">mail/locales/en-US/chrome/messenger/messengercompose/composeMsgs.properties</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/d3121c483250becfb0d69689b527179867fe36aa/mail/locales/en-US/chrome/messenger/messengercompose/composeMsgs.properties">file</a> |
<a href="/comm-central/annotate/d3121c483250becfb0d69689b527179867fe36aa/mail/locales/en-US/chrome/messenger/messengercompose/composeMsgs.properties">annotate</a> |
<a href="/comm-central/diff/d3121c483250becfb0d69689b527179867fe36aa/mail/locales/en-US/chrome/messenger/messengercompose/composeMsgs.properties">diff</a> |
<a href="/comm-central/comparison/d3121c483250becfb0d69689b527179867fe36aa/mail/locales/en-US/chrome/messenger/messengercompose/composeMsgs.properties">comparison</a> |
<a href="/comm-central/log/d3121c483250becfb0d69689b527179867fe36aa/mail/locales/en-US/chrome/messenger/messengercompose/composeMsgs.properties">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/d3121c483250becfb0d69689b527179867fe36aa/mailnews/compose/src/nsComposeStrings.h">mailnews/compose/src/nsComposeStrings.h</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/d3121c483250becfb0d69689b527179867fe36aa/mailnews/compose/src/nsComposeStrings.h">file</a> |
<a href="/comm-central/annotate/d3121c483250becfb0d69689b527179867fe36aa/mailnews/compose/src/nsComposeStrings.h">annotate</a> |
<a href="/comm-central/diff/d3121c483250becfb0d69689b527179867fe36aa/mailnews/compose/src/nsComposeStrings.h">diff</a> |
<a href="/comm-central/comparison/d3121c483250becfb0d69689b527179867fe36aa/mailnews/compose/src/nsComposeStrings.h">comparison</a> |
<a href="/comm-central/log/d3121c483250becfb0d69689b527179867fe36aa/mailnews/compose/src/nsComposeStrings.h">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/d3121c483250becfb0d69689b527179867fe36aa/mailnews/compose/src/nsMsgPrompts.cpp">mailnews/compose/src/nsMsgPrompts.cpp</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/d3121c483250becfb0d69689b527179867fe36aa/mailnews/compose/src/nsMsgPrompts.cpp">file</a> |
<a href="/comm-central/annotate/d3121c483250becfb0d69689b527179867fe36aa/mailnews/compose/src/nsMsgPrompts.cpp">annotate</a> |
<a href="/comm-central/diff/d3121c483250becfb0d69689b527179867fe36aa/mailnews/compose/src/nsMsgPrompts.cpp">diff</a> |
<a href="/comm-central/comparison/d3121c483250becfb0d69689b527179867fe36aa/mailnews/compose/src/nsMsgPrompts.cpp">comparison</a> |
<a href="/comm-central/log/d3121c483250becfb0d69689b527179867fe36aa/mailnews/compose/src/nsMsgPrompts.cpp">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/d3121c483250becfb0d69689b527179867fe36aa/mailnews/compose/src/nsMsgPrompts.h">mailnews/compose/src/nsMsgPrompts.h</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/d3121c483250becfb0d69689b527179867fe36aa/mailnews/compose/src/nsMsgPrompts.h">file</a> |
<a href="/comm-central/annotate/d3121c483250becfb0d69689b527179867fe36aa/mailnews/compose/src/nsMsgPrompts.h">annotate</a> |
<a href="/comm-central/diff/d3121c483250becfb0d69689b527179867fe36aa/mailnews/compose/src/nsMsgPrompts.h">diff</a> |
<a href="/comm-central/comparison/d3121c483250becfb0d69689b527179867fe36aa/mailnews/compose/src/nsMsgPrompts.h">comparison</a> |
<a href="/comm-central/log/d3121c483250becfb0d69689b527179867fe36aa/mailnews/compose/src/nsMsgPrompts.h">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/d3121c483250becfb0d69689b527179867fe36aa/mailnews/compose/src/nsMsgSend.cpp">mailnews/compose/src/nsMsgSend.cpp</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/d3121c483250becfb0d69689b527179867fe36aa/mailnews/compose/src/nsMsgSend.cpp">file</a> |
<a href="/comm-central/annotate/d3121c483250becfb0d69689b527179867fe36aa/mailnews/compose/src/nsMsgSend.cpp">annotate</a> |
<a href="/comm-central/diff/d3121c483250becfb0d69689b527179867fe36aa/mailnews/compose/src/nsMsgSend.cpp">diff</a> |
<a href="/comm-central/comparison/d3121c483250becfb0d69689b527179867fe36aa/mailnews/compose/src/nsMsgSend.cpp">comparison</a> |
<a href="/comm-central/log/d3121c483250becfb0d69689b527179867fe36aa/mailnews/compose/src/nsMsgSend.cpp">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/d3121c483250becfb0d69689b527179867fe36aa/mailnews/compose/src/nsMsgSend.h">mailnews/compose/src/nsMsgSend.h</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/d3121c483250becfb0d69689b527179867fe36aa/mailnews/compose/src/nsMsgSend.h">file</a> |
<a href="/comm-central/annotate/d3121c483250becfb0d69689b527179867fe36aa/mailnews/compose/src/nsMsgSend.h">annotate</a> |
<a href="/comm-central/diff/d3121c483250becfb0d69689b527179867fe36aa/mailnews/compose/src/nsMsgSend.h">diff</a> |
<a href="/comm-central/comparison/d3121c483250becfb0d69689b527179867fe36aa/mailnews/compose/src/nsMsgSend.h">comparison</a> |
<a href="/comm-central/log/d3121c483250becfb0d69689b527179867fe36aa/mailnews/compose/src/nsMsgSend.h">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/d3121c483250becfb0d69689b527179867fe36aa/suite/locales/en-US/chrome/mailnews/compose/composeMsgs.properties">suite/locales/en-US/chrome/mailnews/compose/composeMsgs.properties</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/d3121c483250becfb0d69689b527179867fe36aa/suite/locales/en-US/chrome/mailnews/compose/composeMsgs.properties">file</a> |
<a href="/comm-central/annotate/d3121c483250becfb0d69689b527179867fe36aa/suite/locales/en-US/chrome/mailnews/compose/composeMsgs.properties">annotate</a> |
<a href="/comm-central/diff/d3121c483250becfb0d69689b527179867fe36aa/suite/locales/en-US/chrome/mailnews/compose/composeMsgs.properties">diff</a> |
<a href="/comm-central/comparison/d3121c483250becfb0d69689b527179867fe36aa/suite/locales/en-US/chrome/mailnews/compose/composeMsgs.properties">comparison</a> |
<a href="/comm-central/log/d3121c483250becfb0d69689b527179867fe36aa/suite/locales/en-US/chrome/mailnews/compose/composeMsgs.properties">revisions</a>
</td>
</tr>
</table></div>

<div class="page_body diffblocks"><div class="diffblock"><pre class="sourcelines">
<a href="#l1.1"></a><span id="l1.1" class="difflineminus">--- a/mail/locales/en-US/chrome/messenger/messengercompose/composeMsgs.properties</span>
<a href="#l1.2"></a><span id="l1.2" class="difflineplus">+++ b/mail/locales/en-US/chrome/messenger/messengercompose/composeMsgs.properties</span>
<a href="#l1.3"></a><span id="l1.3" class="difflineat">@@ -194,19 +194,16 @@ 12564=The author of this message has req</span>
<a href="#l1.4"></a><span id="l1.4"> </span>
<a href="#l1.5"></a><span id="l1.5"> ## @name NS_MSG_UNDISCLOSED_RECIPIENTS</span>
<a href="#l1.6"></a><span id="l1.6"> ## LOCALIZATION NOTE: this string must be using only US_ASCII characters</span>
<a href="#l1.7"></a><span id="l1.7"> 12566=undisclosed-recipients</span>
<a href="#l1.8"></a><span id="l1.8"> </span>
<a href="#l1.9"></a><span id="l1.9"> ## @name NS_MSG_ERROR_ATTACHING_FILE</span>
<a href="#l1.10"></a><span id="l1.10"> 12570=There was an error attaching %S. Please check if you have access to the file.</span>
<a href="#l1.11"></a><span id="l1.11"> </span>
<a href="#l1.12"></a><span id="l1.12" class="difflineminus">-## @name NS_MSG_ERROR_DOING_FCC</span>
<a href="#l1.13"></a><span id="l1.13" class="difflineminus">-12571=There was an error copying the message to the Sent folder. Retry?</span>
<a href="#l1.14"></a><span id="l1.14" class="difflineminus">-</span>
<a href="#l1.15"></a><span id="l1.15"> ## @name NS_ERROR_SMTP_GREETING</span>
<a href="#l1.16"></a><span id="l1.16"> 12572=An error occurred sending mail: The mail server sent an incorrect greeting:  %s.</span>
<a href="#l1.17"></a><span id="l1.17"> </span>
<a href="#l1.18"></a><span id="l1.18"> ## @name NS_ERROR_SENDING_RCPT_COMMAND</span>
<a href="#l1.19"></a><span id="l1.19"> 12575=An error occurred while sending mail. The mail server responded:  %1$s. Please check the message recipient %2$s and try again.</span>
<a href="#l1.20"></a><span id="l1.20"> </span>
<a href="#l1.21"></a><span id="l1.21"> ## @name NS_ERROR_STARTTLS_FAILED_EHLO_STARTTLS</span>
<a href="#l1.22"></a><span id="l1.22"> 12582=An error occurred sending mail: Unable to establish a secure link with SMTP server %S using STARTTLS since it doesn't advertise that feature. Switch off STARTTLS for that server or contact your service provider.</span>
<a href="#l1.23"></a><span id="l1.23" class="difflineat">@@ -363,8 +360,12 @@ smtpEnterPasswordPrompt=Enter your passw</span>
<a href="#l1.24"></a><span id="l1.24"> ## words %1$S and %2$S. Place the word %1$S where the host name should appear,</span>
<a href="#l1.25"></a><span id="l1.25"> ## and %2$S where the user name should appear.</span>
<a href="#l1.26"></a><span id="l1.26"> smtpEnterPasswordPromptWithUsername=Enter your password for %2$S on %1$S:</span>
<a href="#l1.27"></a><span id="l1.27"> smtpEnterPasswordPromptTitle=SMTP Server Password Required</span>
<a href="#l1.28"></a><span id="l1.28"> </span>
<a href="#l1.29"></a><span id="l1.29"> # LOCALIZATION NOTE (removeAttachmentMsgs): Semi-colon list of plural forms.</span>
<a href="#l1.30"></a><span id="l1.30"> # See: http://developer.mozilla.org/en/Localization_and_Plurals</span>
<a href="#l1.31"></a><span id="l1.31"> removeAttachmentMsgs=Remove Attachment;Remove Attachments</span>
<a href="#l1.32"></a><span id="l1.32" class="difflineplus">+</span>
<a href="#l1.33"></a><span id="l1.33" class="difflineplus">+## LOCALIZATION NOTE(errorSavingMsg): Do not translate the word %S. It</span>
<a href="#l1.34"></a><span id="l1.34" class="difflineplus">+## will be replaced with the name of the folder the message is being saved to.</span>
<a href="#l1.35"></a><span id="l1.35" class="difflineplus">+errorSavingMsg=There was an error saving the message to %S. Retry?</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l2.1"></a><span id="l2.1" class="difflineminus">--- a/mailnews/compose/src/nsComposeStrings.h</span>
<a href="#l2.2"></a><span id="l2.2" class="difflineplus">+++ b/mailnews/compose/src/nsComposeStrings.h</span>
<a href="#l2.3"></a><span id="l2.3" class="difflineat">@@ -63,17 +63,16 @@</span>
<a href="#l2.4"></a><span id="l2.4"> #define NS_MSG_ASK_TO_COMEBACK_TO_COMPOSE           12561</span>
<a href="#l2.5"></a><span id="l2.5"> #define NS_MSG_GENERIC_FAILURE_EXPLANATION          12562</span>
<a href="#l2.6"></a><span id="l2.6"> #define NS_MSG_ERROR_READING_FILE                   NS_MSG_GENERATE_FAILURE(12563)</span>
<a href="#l2.7"></a><span id="l2.7"> #define NS_MSG_FOLLOWUPTO_ALERT                     12564</span>
<a href="#l2.8"></a><span id="l2.8"> </span>
<a href="#l2.9"></a><span id="l2.9"> #define NS_MSG_UNDISCLOSED_RECIPIENTS               12566</span>
<a href="#l2.10"></a><span id="l2.10"> </span>
<a href="#l2.11"></a><span id="l2.11"> #define NS_MSG_ERROR_ATTACHING_FILE                 NS_MSG_GENERATE_FAILURE(12570)</span>
<a href="#l2.12"></a><span id="l2.12" class="difflineminus">-#define NS_MSG_ERROR_DOING_FCC                      12571</span>
<a href="#l2.13"></a><span id="l2.13"> </span>
<a href="#l2.14"></a><span id="l2.14"> #define NS_ERROR_SMTP_GREETING                      NS_MSG_GENERATE_FAILURE(12572)</span>
<a href="#l2.15"></a><span id="l2.15"> </span>
<a href="#l2.16"></a><span id="l2.16"> #define NS_ERROR_SENDING_RCPT_COMMAND               NS_MSG_GENERATE_FAILURE(12575)</span>
<a href="#l2.17"></a><span id="l2.17"> </span>
<a href="#l2.18"></a><span id="l2.18"> #define NS_ERROR_STARTTLS_FAILED_EHLO_STARTTLS      NS_MSG_GENERATE_FAILURE(12582)</span>
<a href="#l2.19"></a><span id="l2.19"> </span>
<a href="#l2.20"></a><span id="l2.20"> #define NS_ERROR_SMTP_PASSWORD_UNDEFINED            NS_MSG_GENERATE_FAILURE(12584)</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l3.1"></a><span id="l3.1" class="difflineminus">--- a/mailnews/compose/src/nsMsgPrompts.cpp</span>
<a href="#l3.2"></a><span id="l3.2" class="difflineplus">+++ b/mailnews/compose/src/nsMsgPrompts.cpp</span>
<a href="#l3.3"></a><span id="l3.3" class="difflineat">@@ -122,31 +122,16 @@ nsMsgDisplayMessageByString(nsIPrompt * </span>
<a href="#l3.4"></a><span id="l3.4">   }</span>
<a href="#l3.5"></a><span id="l3.5"> </span>
<a href="#l3.6"></a><span id="l3.6">   if (prompt)</span>
<a href="#l3.7"></a><span id="l3.7">     rv = prompt-&gt;Alert(windowTitle, msg);</span>
<a href="#l3.8"></a><span id="l3.8">   return NS_OK;</span>
<a href="#l3.9"></a><span id="l3.9"> }</span>
<a href="#l3.10"></a><span id="l3.10"> </span>
<a href="#l3.11"></a><span id="l3.11"> nsresult</span>
<a href="#l3.12"></a><span id="l3.12" class="difflineminus">-nsMsgAskBooleanQuestionByID(nsIPrompt * aPrompt, PRInt32 msgID, PRBool *answer, const PRUnichar * windowTitle)</span>
<a href="#l3.13"></a><span id="l3.13" class="difflineminus">-{</span>
<a href="#l3.14"></a><span id="l3.14" class="difflineminus">-  nsresult rv;</span>
<a href="#l3.15"></a><span id="l3.15" class="difflineminus">-  nsCOMPtr&lt;nsIStringBundleService&gt; bundleService(do_GetService(&quot;@mozilla.org/intl/stringbundle;1&quot;, &amp;rv));</span>
<a href="#l3.16"></a><span id="l3.16" class="difflineminus">-  NS_ENSURE_SUCCESS(rv, rv);</span>
<a href="#l3.17"></a><span id="l3.17" class="difflineminus">-  nsCOMPtr&lt;nsIStringBundle&gt; bundle;</span>
<a href="#l3.18"></a><span id="l3.18" class="difflineminus">-  rv = bundleService-&gt;CreateBundle(&quot;chrome://messenger/locale/messengercompose/composeMsgs.properties&quot;, getter_AddRefs(bundle));</span>
<a href="#l3.19"></a><span id="l3.19" class="difflineminus">-  NS_ENSURE_SUCCESS(rv, rv);</span>
<a href="#l3.20"></a><span id="l3.20" class="difflineminus">-</span>
<a href="#l3.21"></a><span id="l3.21" class="difflineminus">-  nsString msg;</span>
<a href="#l3.22"></a><span id="l3.22" class="difflineminus">-  bundle-&gt;GetStringFromID(msgID, getter_Copies(msg));</span>
<a href="#l3.23"></a><span id="l3.23" class="difflineminus">-  return nsMsgAskBooleanQuestionByString(aPrompt, msg.get(), answer, windowTitle);</span>
<a href="#l3.24"></a><span id="l3.24" class="difflineminus">-}</span>
<a href="#l3.25"></a><span id="l3.25" class="difflineminus">-</span>
<a href="#l3.26"></a><span id="l3.26" class="difflineminus">-nsresult</span>
<a href="#l3.27"></a><span id="l3.27"> nsMsgAskBooleanQuestionByString(nsIPrompt * aPrompt, const PRUnichar * msg, PRBool *answer, const PRUnichar * windowTitle)</span>
<a href="#l3.28"></a><span id="l3.28"> {</span>
<a href="#l3.29"></a><span id="l3.29">   nsresult rv;</span>
<a href="#l3.30"></a><span id="l3.30">   PRInt32 result;</span>
<a href="#l3.31"></a><span id="l3.31">   nsCOMPtr&lt;nsIPrompt&gt; dialog = aPrompt;</span>
<a href="#l3.32"></a><span id="l3.32"> </span>
<a href="#l3.33"></a><span id="l3.33">   if ((!msg) || (!*msg))</span>
<a href="#l3.34"></a><span id="l3.34">     return NS_ERROR_INVALID_ARG;</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l4.1"></a><span id="l4.1" class="difflineminus">--- a/mailnews/compose/src/nsMsgPrompts.h</span>
<a href="#l4.2"></a><span id="l4.2" class="difflineplus">+++ b/mailnews/compose/src/nsMsgPrompts.h</span>
<a href="#l4.3"></a><span id="l4.3" class="difflineat">@@ -44,12 +44,11 @@</span>
<a href="#l4.4"></a><span id="l4.4"> </span>
<a href="#l4.5"></a><span id="l4.5"> class nsIPrompt;</span>
<a href="#l4.6"></a><span id="l4.6"> </span>
<a href="#l4.7"></a><span id="l4.7"> nsresult      nsMsgGetMessageByID(PRInt32 aMsgID, nsString&amp; aResult);</span>
<a href="#l4.8"></a><span id="l4.8"> nsresult      nsMsgBuildMessageWithFile(nsIFile * aFile, nsString&amp; aResult);</span>
<a href="#l4.9"></a><span id="l4.9"> nsresult      nsMsgBuildMessageWithTmpFile(nsIFile * aFile, nsString&amp; aResult);</span>
<a href="#l4.10"></a><span id="l4.10"> nsresult      nsMsgDisplayMessageByID(nsIPrompt * aPrompt, PRInt32 msgID, const PRUnichar * windowTitle = nsnull);</span>
<a href="#l4.11"></a><span id="l4.11"> nsresult      nsMsgDisplayMessageByString(nsIPrompt * aPrompt, const PRUnichar * msg, const PRUnichar * windowTitle = nsnull);</span>
<a href="#l4.12"></a><span id="l4.12" class="difflineminus">-nsresult      nsMsgAskBooleanQuestionByID(nsIPrompt * aPrompt, PRInt32 msgID, PRBool *answer, const PRUnichar * windowTitle = nsnull);</span>
<a href="#l4.13"></a><span id="l4.13"> nsresult      nsMsgAskBooleanQuestionByString(nsIPrompt * aPrompt, const PRUnichar * msg, PRBool *answer, const PRUnichar * windowTitle = nsnull);</span>
<a href="#l4.14"></a><span id="l4.14"> </span>
<a href="#l4.15"></a><span id="l4.15"> #endif /* _nsMsgPrompts_H_ */</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l5.1"></a><span id="l5.1" class="difflineminus">--- a/mailnews/compose/src/nsMsgSend.cpp</span>
<a href="#l5.2"></a><span id="l5.2" class="difflineplus">+++ b/mailnews/compose/src/nsMsgSend.cpp</span>
<a href="#l5.3"></a><span id="l5.3" class="difflineat">@@ -4162,23 +4162,38 @@ nsMsgComposeAndSend::NotifyListenerOnSto</span>
<a href="#l5.4"></a><span id="l5.4"> </span>
<a href="#l5.5"></a><span id="l5.5">   SetStatusMessage(msg);</span>
<a href="#l5.6"></a><span id="l5.6">   nsCOMPtr&lt;nsIPrompt&gt; prompt;</span>
<a href="#l5.7"></a><span id="l5.7">   GetDefaultPrompt(getter_AddRefs(prompt));</span>
<a href="#l5.8"></a><span id="l5.8"> </span>
<a href="#l5.9"></a><span id="l5.9">   if (NS_FAILED(aStatus))</span>
<a href="#l5.10"></a><span id="l5.10">   {</span>
<a href="#l5.11"></a><span id="l5.11">     PRBool retry = PR_FALSE;</span>
<a href="#l5.12"></a><span id="l5.12" class="difflineminus">-    nsMsgAskBooleanQuestionByID(prompt, NS_MSG_ERROR_DOING_FCC, &amp;retry, nsnull /* what title */);</span>
<a href="#l5.13"></a><span id="l5.13" class="difflineminus">-    if (retry)</span>
<a href="#l5.14"></a><span id="l5.14" class="difflineplus">+    nsresult rv;</span>
<a href="#l5.15"></a><span id="l5.15" class="difflineplus">+    nsCOMPtr&lt;nsIStringBundleService&gt; bundleService(do_GetService(&quot;@mozilla.org/intl/stringbundle;1&quot;, &amp;rv));</span>
<a href="#l5.16"></a><span id="l5.16" class="difflineplus">+    NS_ENSURE_SUCCESS(rv, rv);</span>
<a href="#l5.17"></a><span id="l5.17" class="difflineplus">+    nsCOMPtr&lt;nsIStringBundle&gt; bundle;</span>
<a href="#l5.18"></a><span id="l5.18" class="difflineplus">+    rv = bundleService-&gt;CreateBundle(&quot;chrome://messenger/locale/messengercompose/composeMsgs.properties&quot;, getter_AddRefs(bundle));</span>
<a href="#l5.19"></a><span id="l5.19" class="difflineplus">+    NS_ENSURE_SUCCESS(rv, rv);</span>
<a href="#l5.20"></a><span id="l5.20" class="difflineplus">+</span>
<a href="#l5.21"></a><span id="l5.21" class="difflineplus">+    nsString msg;</span>
<a href="#l5.22"></a><span id="l5.22" class="difflineplus">+    const PRUnichar *formatStrings[] = { mSavedToFolderName.get() };</span>
<a href="#l5.23"></a><span id="l5.23" class="difflineplus">+</span>
<a href="#l5.24"></a><span id="l5.24" class="difflineplus">+    rv = bundle-&gt;FormatStringFromName(NS_LITERAL_STRING(&quot;errorSavingMsg&quot;).get(),</span>
<a href="#l5.25"></a><span id="l5.25" class="difflineplus">+                                      formatStrings, 1,</span>
<a href="#l5.26"></a><span id="l5.26" class="difflineplus">+                                      getter_Copies(msg));</span>
<a href="#l5.27"></a><span id="l5.27" class="difflineplus">+    if (NS_SUCCEEDED(rv))</span>
<a href="#l5.28"></a><span id="l5.28">     {</span>
<a href="#l5.29"></a><span id="l5.29" class="difflineminus">-      mSendProgress = nsnull; // this was cancelled, so we need to clear it.</span>
<a href="#l5.30"></a><span id="l5.30" class="difflineminus">-      return DoFcc();</span>
<a href="#l5.31"></a><span id="l5.31" class="difflineplus">+      nsMsgAskBooleanQuestionByString(prompt, msg.get(), &amp;retry, nsnull);</span>
<a href="#l5.32"></a><span id="l5.32" class="difflineplus">+      if (retry)</span>
<a href="#l5.33"></a><span id="l5.33" class="difflineplus">+      {</span>
<a href="#l5.34"></a><span id="l5.34" class="difflineplus">+        mSendProgress = nsnull; // this was cancelled, so we need to clear it.</span>
<a href="#l5.35"></a><span id="l5.35" class="difflineplus">+        return SendToMagicFolder(m_deliver_mode);</span>
<a href="#l5.36"></a><span id="l5.36" class="difflineplus">+      }</span>
<a href="#l5.37"></a><span id="l5.37">     }</span>
<a href="#l5.38"></a><span id="l5.38" class="difflineminus">-</span>
<a href="#l5.39"></a><span id="l5.39">   }</span>
<a href="#l5.40"></a><span id="l5.40">   // Ok, now to support a second copy operation, we need to figure</span>
<a href="#l5.41"></a><span id="l5.41">   // out which copy request just finished. If the user has requested</span>
<a href="#l5.42"></a><span id="l5.42">   // a second copy operation, then we need to fire that off, but if they</span>
<a href="#l5.43"></a><span id="l5.43">   // just wanted a single copy operation, we can tell everyone we are done</span>
<a href="#l5.44"></a><span id="l5.44">   // and move on with life. Only do the second copy if the first one worked.</span>
<a href="#l5.45"></a><span id="l5.45">   //</span>
<a href="#l5.46"></a><span id="l5.46">   if ( NS_SUCCEEDED(aStatus) &amp;&amp; (mNeedToPerformSecondFCC) )</span>
<a href="#l5.47"></a><span id="l5.47" class="difflineat">@@ -4467,17 +4482,16 @@ nsMsgComposeAndSend::MimeDoFCC(nsIFile  </span>
<a href="#l5.48"></a><span id="l5.48">   nsresult      status = NS_OK;</span>
<a href="#l5.49"></a><span id="l5.49">   char          *ibuffer = 0;</span>
<a href="#l5.50"></a><span id="l5.50">   PRInt32       ibuffer_size = TEN_K;</span>
<a href="#l5.51"></a><span id="l5.51">   char          *obuffer = 0;</span>
<a href="#l5.52"></a><span id="l5.52">   PRUint32      n;</span>
<a href="#l5.53"></a><span id="l5.53">   PRBool        folderIsLocal = PR_TRUE;</span>
<a href="#l5.54"></a><span id="l5.54">   nsCString     turi;</span>
<a href="#l5.55"></a><span id="l5.55">   PRUnichar     *printfString = nsnull;</span>
<a href="#l5.56"></a><span id="l5.56" class="difflineminus">-  nsString folderName;</span>
<a href="#l5.57"></a><span id="l5.57">   nsString msg;</span>
<a href="#l5.58"></a><span id="l5.58">   nsCOMPtr&lt;nsIMsgFolder&gt; folder;</span>
<a href="#l5.59"></a><span id="l5.59"> </span>
<a href="#l5.60"></a><span id="l5.60">   // Before continuing, just check the user has not cancel the operation</span>
<a href="#l5.61"></a><span id="l5.61">   if (mSendProgress)</span>
<a href="#l5.62"></a><span id="l5.62">   {</span>
<a href="#l5.63"></a><span id="l5.63">     PRBool canceled = PR_FALSE;</span>
<a href="#l5.64"></a><span id="l5.64">     mSendProgress-&gt;GetProcessCanceledByUser(&amp;canceled);</span>
<a href="#l5.65"></a><span id="l5.65" class="difflineat">@@ -4572,20 +4586,20 @@ nsMsgComposeAndSend::MimeDoFCC(nsIFile  </span>
<a href="#l5.66"></a><span id="l5.66">   {</span>
<a href="#l5.67"></a><span id="l5.67">     nsCOMPtr&lt;nsIRDFService&gt; rdfService = do_GetService(kRDFServiceCID);</span>
<a href="#l5.68"></a><span id="l5.68">     if (rdfService)</span>
<a href="#l5.69"></a><span id="l5.69">     {</span>
<a href="#l5.70"></a><span id="l5.70">       nsCOMPtr&lt;nsIRDFResource&gt; res;</span>
<a href="#l5.71"></a><span id="l5.71">       rdfService-&gt;GetResource(turi, getter_AddRefs(res));</span>
<a href="#l5.72"></a><span id="l5.72">       nsCOMPtr&lt;nsIMsgFolder&gt; folder = do_QueryInterface(res);</span>
<a href="#l5.73"></a><span id="l5.73">       if (folder)</span>
<a href="#l5.74"></a><span id="l5.74" class="difflineminus">-        folder-&gt;GetName(folderName);</span>
<a href="#l5.75"></a><span id="l5.75" class="difflineplus">+        folder-&gt;GetName(mSavedToFolderName);</span>
<a href="#l5.76"></a><span id="l5.76">     }</span>
<a href="#l5.77"></a><span id="l5.77" class="difflineminus">-    if (!folderName.IsEmpty())</span>
<a href="#l5.78"></a><span id="l5.78" class="difflineminus">-      printfString = nsTextFormatter::smprintf(msg.get(), folderName.get());</span>
<a href="#l5.79"></a><span id="l5.79" class="difflineplus">+    if (!mSavedToFolderName.IsEmpty())</span>
<a href="#l5.80"></a><span id="l5.80" class="difflineplus">+      printfString = nsTextFormatter::smprintf(msg.get(), mSavedToFolderName.get());</span>
<a href="#l5.81"></a><span id="l5.81">     else</span>
<a href="#l5.82"></a><span id="l5.82">       printfString = nsTextFormatter::smprintf(msg.get(), &quot;?&quot;);</span>
<a href="#l5.83"></a><span id="l5.83">     if (printfString)</span>
<a href="#l5.84"></a><span id="l5.84">     {</span>
<a href="#l5.85"></a><span id="l5.85">       SetStatusMessage(nsDependentString(printfString));</span>
<a href="#l5.86"></a><span id="l5.86">       PR_Free(printfString);</span>
<a href="#l5.87"></a><span id="l5.87">     }</span>
<a href="#l5.88"></a><span id="l5.88">   }</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l6.1"></a><span id="l6.1" class="difflineminus">--- a/mailnews/compose/src/nsMsgSend.h</span>
<a href="#l6.2"></a><span id="l6.2" class="difflineplus">+++ b/mailnews/compose/src/nsMsgSend.h</span>
<a href="#l6.3"></a><span id="l6.3" class="difflineat">@@ -307,17 +307,18 @@ public:</span>
<a href="#l6.4"></a><span id="l6.4">   PRUint32                  mMessageWarningSize; // Warn if a message is over this size!</span>
<a href="#l6.5"></a><span id="l6.5"> </span>
<a href="#l6.6"></a><span id="l6.6">   PRBool                    m_dont_deliver_p;    // If set, we just return the nsIFile of the file</span>
<a href="#l6.7"></a><span id="l6.7">                                                  // created, instead of actually delivering message.</span>
<a href="#l6.8"></a><span id="l6.8">   nsMsgDeliverMode          m_deliver_mode;      // nsMsgDeliverNow, nsMsgQueueForLater, nsMsgSaveAsDraft,</span>
<a href="#l6.9"></a><span id="l6.9">                                                  // nsMsgSaveAsTemplate and nsMsgSendUnsent</span>
<a href="#l6.10"></a><span id="l6.10">   nsCOMPtr&lt;nsIMsgDBHdr&gt;     mMsgToReplace;       // If the mode is nsMsgSaveAsDraft, this is the message it will</span>
<a href="#l6.11"></a><span id="l6.11">                                                  // replace</span>
<a href="#l6.12"></a><span id="l6.12" class="difflineminus">-</span>
<a href="#l6.13"></a><span id="l6.13" class="difflineplus">+  nsString mSavedToFolderName; // Name of folder we're saving to, used when</span>
<a href="#l6.14"></a><span id="l6.14" class="difflineplus">+                               // displaying error on save.</span>
<a href="#l6.15"></a><span id="l6.15">   // These are needed for callbacks to the FE...</span>
<a href="#l6.16"></a><span id="l6.16">   nsCOMPtr&lt;nsIDOMWindowInternal&gt;  mParentWindow;</span>
<a href="#l6.17"></a><span id="l6.17">   nsCOMPtr&lt;nsIMsgProgress&gt;        mSendProgress;</span>
<a href="#l6.18"></a><span id="l6.18">   nsCOMPtr&lt;nsIMsgSendListener&gt;    mListener;</span>
<a href="#l6.19"></a><span id="l6.19">   nsCOMPtr&lt;nsIMsgStatusFeedback&gt;  mStatusFeedback;</span>
<a href="#l6.20"></a><span id="l6.20">   nsCOMPtr&lt;nsIRequest&gt;      mRunningRequest;</span>
<a href="#l6.21"></a><span id="l6.21">   PRBool                    mSendMailAlso;</span>
<a href="#l6.22"></a><span id="l6.22">   nsCOMPtr&lt;nsIFile&gt;         mReturnFile;     // a holder for file spec's to be returned to caller</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l7.1"></a><span id="l7.1" class="difflineminus">--- a/suite/locales/en-US/chrome/mailnews/compose/composeMsgs.properties</span>
<a href="#l7.2"></a><span id="l7.2" class="difflineplus">+++ b/suite/locales/en-US/chrome/mailnews/compose/composeMsgs.properties</span>
<a href="#l7.3"></a><span id="l7.3" class="difflineat">@@ -194,19 +194,16 @@ 12564=The author of this message has req</span>
<a href="#l7.4"></a><span id="l7.4"> </span>
<a href="#l7.5"></a><span id="l7.5"> ## @name NS_MSG_UNDISCLOSED_RECIPIENTS</span>
<a href="#l7.6"></a><span id="l7.6"> ## LOCALIZATION NOTE: this string must be using only US_ASCII characters</span>
<a href="#l7.7"></a><span id="l7.7"> 12566=undisclosed-recipients</span>
<a href="#l7.8"></a><span id="l7.8"> </span>
<a href="#l7.9"></a><span id="l7.9"> ## @name NS_MSG_ERROR_ATTACHING_FILE</span>
<a href="#l7.10"></a><span id="l7.10"> 12570=There was an error attaching %S. Please check if you have access to the file.</span>
<a href="#l7.11"></a><span id="l7.11"> </span>
<a href="#l7.12"></a><span id="l7.12" class="difflineminus">-## @name NS_MSG_ERROR_DOING_FCC</span>
<a href="#l7.13"></a><span id="l7.13" class="difflineminus">-12571=There was an error copying the message to the Sent folder. Retry?</span>
<a href="#l7.14"></a><span id="l7.14" class="difflineminus">-</span>
<a href="#l7.15"></a><span id="l7.15"> ## @name NS_ERROR_SMTP_GREETING</span>
<a href="#l7.16"></a><span id="l7.16"> 12572=An error occurred sending mail: The mail server sent an incorrect greeting:  %s.</span>
<a href="#l7.17"></a><span id="l7.17"> </span>
<a href="#l7.18"></a><span id="l7.18"> ## @name NS_ERROR_SENDING_RCPT_COMMAND</span>
<a href="#l7.19"></a><span id="l7.19"> 12575=An error occurred while sending mail. The mail server responded:  %1$s. Please check the message recipient %2$s and try again.</span>
<a href="#l7.20"></a><span id="l7.20"> </span>
<a href="#l7.21"></a><span id="l7.21"> ## @name NS_ERROR_STARTTLS_FAILED_EHLO_STARTTLS</span>
<a href="#l7.22"></a><span id="l7.22"> 12582=An error occurred sending mail: Unable to establish a secure link with SMTP server %S using STARTTLS since it doesn't advertise that feature. Switch off STARTTLS for that server or contact your service provider.</span>
<a href="#l7.23"></a><span id="l7.23" class="difflineat">@@ -336,8 +333,12 @@ renameAttachmentMessage=New attachment n</span>
<a href="#l7.24"></a><span id="l7.24"> ## LOCALIZATION NOTE(smtpEnterPasswordPrompt): Do not translate the</span>
<a href="#l7.25"></a><span id="l7.25"> ## word $S. Place the word $S where the host name should appear.</span>
<a href="#l7.26"></a><span id="l7.26"> smtpEnterPasswordPrompt=Enter your password for %S:</span>
<a href="#l7.27"></a><span id="l7.27"> ## LOCALIZATION NOTE(smtpEnterPasswordPromptWithUsername): Do not translate the</span>
<a href="#l7.28"></a><span id="l7.28"> ## words %1$S and %2$S. Place the word %1$S where the host name should appear,</span>
<a href="#l7.29"></a><span id="l7.29"> ## and %2$S where the user name should appear.</span>
<a href="#l7.30"></a><span id="l7.30"> smtpEnterPasswordPromptWithUsername=Enter your password for %2$S on %1$S:</span>
<a href="#l7.31"></a><span id="l7.31"> smtpEnterPasswordPromptTitle=SMTP Server Password Required</span>
<a href="#l7.32"></a><span id="l7.32" class="difflineplus">+</span>
<a href="#l7.33"></a><span id="l7.33" class="difflineplus">+## LOCALIZATION NOTE(errorSavingMsg): Do not translate the word %S. It</span>
<a href="#l7.34"></a><span id="l7.34" class="difflineplus">+## will be replaced with the name of the folder the message is being saved to.</span>
<a href="#l7.35"></a><span id="l7.35" class="difflineplus">+errorSavingMsg=There was an error saving the message to %S. Retry?</span></pre></div></div>

<div class="page_footer">
<div class="page_footer_text">comm-central</div>
<div class="page_footer_text" style="padding-left: 10px">Deployed from <a href="https://hg.mozilla.org/hgcustom/version-control-tools/rev/35f393d6769a">35f393d6769a</a> at 2020-07-16T17:23:43Z.</div>
<div class="rss_logo">
<a href="/comm-central/rss-log">RSS</a>
<a href="/comm-central/atom-log">Atom</a>
</div>
<br />

</div>
</body>
</html>

