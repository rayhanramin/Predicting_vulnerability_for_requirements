<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en-US" lang="en-US">
<head>
<link rel="icon" href="/static/35f393d6769a/hgicon.png" type="image/png" />
<meta name="robots" content="index, nofollow"/>
<link rel="stylesheet" href="/static/35f393d6769a/style-gitweb.css" type="text/css" />

<style type="text/css">
div.feed {
  float: right;
}
a img {
  border-width: 0px;
}
div.log_link {
  width: 80px;
  background-color: white;
}

div.log_body {
  padding-left: 96px;
}
</style>
<script type="text/javascript" src="/static/35f393d6769a/mercurial.js"></script>

<meta property="og:image" content="/static/35f393d6769a/moz-logo-bw-rgb.svg"/>
<meta property="og:type" content="website"/>

<title>comm-central: changeset 19720:a99800bead4c41f7918deb3e663e784e1dc78351</title>
<link rel="alternate" type="application/atom+xml"
   href="/comm-central/atom-log" title="Atom feed for comm-central"/>
<link rel="alternate" type="application/rss+xml"
   href="/comm-central/rss-log" title="RSS feed for comm-central"/>

<meta property="og:title" content="comm-central @ a99800bead4c41f7918deb3e663e784e1dc78351" />
<meta property="og:url" content="/comm-central/rev/a99800bead4c41f7918deb3e663e784e1dc78351" />
<meta property="og:description" content="Bug 722872 - Part 1: Add nsITransferable::Init(nsILoadContext*), enforce that it's called in debug builds, and add nsIDOMDocument* arguments to nsIClipboardHelper methods; r=roc" />

</head>
<body>

<div class="page_header">
<div class="logo">
    <a href="https://developer.mozilla.org/en/docs/Mercurial">
        <img src="/static/35f393d6769a/moz-logo-bw-rgb.svg" alt="mercurial" />
    </a>
</div>
<a href="/">Mercurial</a> &gt; <a href="/comm-central">comm-central</a>  / changeset / a99800bead4c41f7918deb3e663e784e1dc78351 
</div>

<div class="page_nav">
<div>
<a href="/comm-central/summary">summary</a> |
<a href="/comm-central/shortlog/a99800bead4c41f7918deb3e663e784e1dc78351">shortlog</a> |
<a href="/comm-central/log/a99800bead4c41f7918deb3e663e784e1dc78351">changelog</a> |
<a href="/comm-central/pushloghtml">pushlog</a> |
<a href="/comm-central/graph/a99800bead4c41f7918deb3e663e784e1dc78351">graph</a> |
<a href="/comm-central/tags">tags</a> |
<a href="/comm-central/bookmarks">bookmarks</a> |
<a href="/comm-central/branches">branches</a> |
<a href="/comm-central/file/a99800bead4c41f7918deb3e663e784e1dc78351">files</a> |
changeset |
<a href="/comm-central/raw-rev/a99800bead4c41f7918deb3e663e784e1dc78351">raw</a>  | <a href="/comm-central/archive/a99800bead4c41f7918deb3e663e784e1dc78351.zip">zip</a>  |
<a href="/comm-central/help">help</a>
</div>

<div class="search">
<form id="searchform" action="/comm-central/log">

<input name="rev" type="text" value="" size="40" />
<div id="hint">Find changesets by keywords (author, files, the commit message), revision
number or hash, or <a href="/comm-central/help/revsets">revset expression</a>.</div>
</form>
</div>
</div>

<div class="title">
<a href="https://bugzilla.mozilla.org/show_bug.cgi?id=722872">Bug 722872</a> - Part 1: Add nsITransferable::Init(nsILoadContext*), enforce that it's called in debug builds, and add nsIDOMDocument* arguments to nsIClipboardHelper methods; r=roc
<span class="logtags"></span>
</div>
<div class="title_text">
<table cellspacing="0">

<tr><td>author</td><td>&#69;&#104;&#115;&#97;&#110;&#32;&#65;&#107;&#104;&#103;&#97;&#114;&#105;&#32;&#60;&#101;&#104;&#115;&#97;&#110;&#64;&#109;&#111;&#122;&#105;&#108;&#108;&#97;&#46;&#99;&#111;&#109;&#62;</td></tr>
<tr><td></td><td class="date age">Mon, 16 Apr 2012 22:14:01 -0400</td></tr>

<tr>
 <td>changeset 19720</td>
 <td style="font-family:monospace"><a class="list" href="/comm-central/rev/a99800bead4c41f7918deb3e663e784e1dc78351">a99800bead4c41f7918deb3e663e784e1dc78351</a></td>
</tr>



<tr>
<td>parent 19719</td>
<td style="font-family:monospace">
<a class="list" href="/comm-central/rev/d2e04a3ffbb965e2b0f0be23342c57adbe96f8c4">d2e04a3ffbb965e2b0f0be23342c57adbe96f8c4</a>
</td>
</tr>

<tr>
<td>child 19721</td>
<td style="font-family:monospace">
<a class="list" href="/comm-central/rev/fa7dafe6fb546e93e294106379b719949d1c847a">fa7dafe6fb546e93e294106379b719949d1c847a</a>
</td>
</tr>
<tr><td>push id</td><td><a href="/comm-central/pushloghtml?changeset=a99800bead4c41f7918deb3e663e784e1dc78351">12112</a></td></tr>
<tr><td>push user</td><td>iann_cvs@blueyonder.co.uk</td></tr>
<tr><td>push date</td><td class="date age">Wed, 27 Jul 2016 00:38:30 +0000</td></tr>

<tr><td>treeherder</td><td>comm-central@fa786e755299 [<a href="https://treeherder.mozilla.org/#/jobs?repo=comm-central&revision=fa786e755299c9f591f094d38f40349f3382f389">default view</a>] [<a href="https://treeherder.mozilla.org/#/jobs?repo=comm-central&revision=fa786e755299c9f591f094d38f40349f3382f389&filter-resultStatus=testfailed&filter-resultStatus=busted&filter-resultStatus=exception">failures only]</td></tr>
<tr><td>perfherder</td><td>[<a href="https://treeherder.mozilla.org/perf.html#/compare?originalProject=comm-central&originalRevision=fa786e755299c9f591f094d38f40349f3382f389&newProject=comm-central&newRevision=90cfebf9066300eb67e60ecff464b118c723f45e&framework=1" target="_blank">talos</a>] [<a href="https://treeherder.mozilla.org/perf.html#/compare?originalProject=comm-central&originalRevision=fa786e755299c9f591f094d38f40349f3382f389&newProject=comm-central&newRevision=90cfebf9066300eb67e60ecff464b118c723f45e&framework=2" target="_blank">build metrics</a>] [<a href="https://treeherder.mozilla.org/perf.html#/compare?originalProject=comm-central&originalRevision=fa786e755299c9f591f094d38f40349f3382f389&newProject=comm-central&newRevision=90cfebf9066300eb67e60ecff464b118c723f45e&framework=6" target="_blank">platform microbench</a>] (compared to previous push)</td></tr>
<tr><td>reviewers</td><td><a href="/comm-central/log?rev=reviewer%28roc%29&revcount=50">roc</a></td></tr>
<tr><td>bugs</td><td><a href="https://bugzilla.mozilla.org/show_bug.cgi?id=722872">722872</a></td></tr>




</table></div>

<div class="page_body description"><a href="https://bugzilla.mozilla.org/show_bug.cgi?id=722872">Bug 722872</a> - Part 1: Add nsITransferable::Init(nsILoadContext*), enforce that it's called in debug builds, and add nsIDOMDocument* arguments to nsIClipboardHelper methods; r=roc

This patch does the following:

* It adds nsITransferable::Init(nsILoadContext*).  The load context
  might be null, which means that the transferable is non-private, but
  if it's non-null, we extract the boolean value for the privacy mode
  and store it in the transferable.
* It adds checks in debug builds to make sure that Init is always
  called, in form of fatal assertions.
* It adds nsIDOMDocument* agruments to nsIClipboardHelper methods which
  represent the document that the string is coming from.
  nsIClipboardHelper implementation internally gets the nsILoadContext
  from that and passes it on to the transferable upon creation.  The
  reason that I did this was that nsIClipboardHelper is supposed to be a
  high-level helper, and in most of its call sites, we have easy access
  to a document object.
* It modifies all of the call sites of the above interfaces according to
  this change.
* It adds a GetLoadContext helper to nsIDocument to help with changing
  the call sites.</div>
<div class="list_head"></div>
<div class="title_text">
<table cellspacing="0">

<tr class="parity0">
<td><a class="list" href="/comm-central/diff/a99800bead4c41f7918deb3e663e784e1dc78351/suite/common/console/consoleBindings.xml">suite/common/console/consoleBindings.xml</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/a99800bead4c41f7918deb3e663e784e1dc78351/suite/common/console/consoleBindings.xml">file</a> |
<a href="/comm-central/annotate/a99800bead4c41f7918deb3e663e784e1dc78351/suite/common/console/consoleBindings.xml">annotate</a> |
<a href="/comm-central/diff/a99800bead4c41f7918deb3e663e784e1dc78351/suite/common/console/consoleBindings.xml">diff</a> |
<a href="/comm-central/comparison/a99800bead4c41f7918deb3e663e784e1dc78351/suite/common/console/consoleBindings.xml">comparison</a> |
<a href="/comm-central/log/a99800bead4c41f7918deb3e663e784e1dc78351/suite/common/console/consoleBindings.xml">revisions</a>
</td>
</tr>
</table></div>

<div class="page_body diffblocks"><div class="diffblock"><pre class="sourcelines">
<a href="#l1.1"></a><span id="l1.1" class="difflineminus">--- a/suite/common/console/consoleBindings.xml</span>
<a href="#l1.2"></a><span id="l1.2" class="difflineplus">+++ b/suite/common/console/consoleBindings.xml</span>
<a href="#l1.3"></a><span id="l1.3" class="difflineat">@@ -255,17 +255,17 @@</span>
<a href="#l1.4"></a><span id="l1.4"> </span>
<a href="#l1.5"></a><span id="l1.5">       &lt;method name=&quot;copySelectedItem&quot;&gt;</span>
<a href="#l1.6"></a><span id="l1.6">         &lt;body&gt;&lt;![CDATA[</span>
<a href="#l1.7"></a><span id="l1.7">           if (this.mSelectedItem) try {</span>
<a href="#l1.8"></a><span id="l1.8">             const clipURI = &quot;@mozilla.org/widget/clipboardhelper;1&quot;;</span>
<a href="#l1.9"></a><span id="l1.9">             const clipI = Components.interfaces.nsIClipboardHelper;</span>
<a href="#l1.10"></a><span id="l1.10">             var clipboard = Components.classes[clipURI].getService(clipI);</span>
<a href="#l1.11"></a><span id="l1.11"> </span>
<a href="#l1.12"></a><span id="l1.12" class="difflineminus">-            clipboard.copyString(this.mSelectedItem.toString());</span>
<a href="#l1.13"></a><span id="l1.13" class="difflineplus">+            clipboard.copyString(this.mSelectedItem.toString(), document);</span>
<a href="#l1.14"></a><span id="l1.14">           } catch (ex) {</span>
<a href="#l1.15"></a><span id="l1.15">             // Unable to copy anything, die quietly</span>
<a href="#l1.16"></a><span id="l1.16">           }</span>
<a href="#l1.17"></a><span id="l1.17">         ]]&gt;&lt;/body&gt;</span>
<a href="#l1.18"></a><span id="l1.18">       &lt;/method&gt;</span>
<a href="#l1.19"></a><span id="l1.19">                   </span>
<a href="#l1.20"></a><span id="l1.20">       &lt;method name=&quot;createConsoleRow&quot;&gt;</span>
<a href="#l1.21"></a><span id="l1.21">         &lt;body&gt;&lt;![CDATA[</span></pre></div></div>

<div class="page_footer">
<div class="page_footer_text">comm-central</div>
<div class="page_footer_text" style="padding-left: 10px">Deployed from <a href="https://hg.mozilla.org/hgcustom/version-control-tools/rev/35f393d6769a">35f393d6769a</a> at 2020-07-16T17:23:43Z.</div>
<div class="rss_logo">
<a href="/comm-central/rss-log">RSS</a>
<a href="/comm-central/atom-log">Atom</a>
</div>
<br />

</div>
</body>
</html>

