<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en-US" lang="en-US">
<head>
<link rel="icon" href="/static/4b0de666d1a4/hgicon.png" type="image/png" />
<meta name="robots" content="index, nofollow"/>
<link rel="stylesheet" href="/static/4b0de666d1a4/style-gitweb.css" type="text/css" />

<style type="text/css">
div.feed {
  float: right;
}
a img {
  border-width: 0px;
}
div.log_link {
  width: 80px;
  background-color: white;
}

div.log_body {
  padding-left: 96px;
}
</style>
<script type="text/javascript" src="/static/4b0de666d1a4/mercurial.js"></script>

<meta property="og:image" content="/static/4b0de666d1a4/moz-logo-bw-rgb.svg"/>
<meta property="og:type" content="website"/>

<title>comm-central: changeset 27957:2abc5e2495fc83ffa438def667bac604c4b8be22</title>
<link rel="alternate" type="application/atom+xml"
   href="/comm-central/atom-log" title="Atom feed for comm-central"/>
<link rel="alternate" type="application/rss+xml"
   href="/comm-central/rss-log" title="RSS feed for comm-central"/>

<meta property="og:title" content="comm-central @ 2abc5e2495fc83ffa438def667bac604c4b8be22" />
<meta property="og:url" content="/comm-central/rev/2abc5e2495fc83ffa438def667bac604c4b8be22" />
<meta property="og:description" content="Bug 1588358 - Untangle suite profile and migration source and clean it up. r=IanN" />

</head>
<body>

<div class="page_header">
<div class="logo">
    <a href="https://developer.mozilla.org/en/docs/Mercurial">
        <img src="/static/4b0de666d1a4/moz-logo-bw-rgb.svg" alt="mercurial" />
    </a>
</div>
<a href="/">Mercurial</a> &gt; <a href="/comm-central">comm-central</a>  / changeset / 2abc5e2495fc83ffa438def667bac604c4b8be22 
</div>

<div class="page_nav">
<div>
<a href="/comm-central/summary">summary</a> |
<a href="/comm-central/shortlog/2abc5e2495fc83ffa438def667bac604c4b8be22">shortlog</a> |
<a href="/comm-central/log/2abc5e2495fc83ffa438def667bac604c4b8be22">changelog</a> |
<a href="/comm-central/pushloghtml">pushlog</a> |
<a href="/comm-central/graph/2abc5e2495fc83ffa438def667bac604c4b8be22">graph</a> |
<a href="/comm-central/tags">tags</a> |
<a href="/comm-central/bookmarks">bookmarks</a> |
<a href="/comm-central/branches">branches</a> |
<a href="/comm-central/file/2abc5e2495fc83ffa438def667bac604c4b8be22">files</a> |
changeset |
<a href="/comm-central/raw-rev/2abc5e2495fc83ffa438def667bac604c4b8be22">raw</a>  | <a href="/comm-central/archive/2abc5e2495fc83ffa438def667bac604c4b8be22.zip">zip</a>  |
<a href="/comm-central/help">help</a>
</div>

<div class="search">
<form id="searchform" action="/comm-central/log">

<input name="rev" type="text" value="" size="40" />
<div id="hint">Find changesets by keywords (author, files, the commit message), revision
number or hash, or <a href="/comm-central/help/revsets">revset expression</a>.</div>
</form>
</div>
</div>

<div class="title">
<a href="https://bugzilla.mozilla.org/show_bug.cgi?id=1588358">Bug 1588358</a> - Untangle suite profile and migration source and clean it up. r=IanN
<span class="logtags"></span>
</div>
<div class="title_text">
<table cellspacing="0">

<tr><td>author</td><td>&#70;&#114;&#97;&#110;&#107;&#45;&#82;&#97;&#105;&#110;&#101;&#114;&#32;&#71;&#114;&#97;&#104;&#108;&#32;&#60;&#102;&#114;&#103;&#114;&#97;&#104;&#108;&#64;&#103;&#109;&#120;&#46;&#110;&#101;&#116;&#62;</td></tr>
<tr><td></td><td class="date age">Sun, 20 Oct 2019 17:40:58 +0200</td></tr>

<tr>
 <td>changeset 27957</td>
 <td style="font-family:monospace"><a class="list" href="/comm-central/rev/2abc5e2495fc83ffa438def667bac604c4b8be22">2abc5e2495fc83ffa438def667bac604c4b8be22</a></td>
</tr>



<tr>
<td>parent 27956</td>
<td style="font-family:monospace">
<a class="list" href="/comm-central/rev/8c7735bd0dc3e7ace3f860df8749e4948227a8b4">8c7735bd0dc3e7ace3f860df8749e4948227a8b4</a>
</td>
</tr>

<tr>
<td>child 27958</td>
<td style="font-family:monospace">
<a class="list" href="/comm-central/rev/01dcc0cc8f07406220436186fd13c22d56380916">01dcc0cc8f07406220436186fd13c22d56380916</a>
</td>
</tr>
<tr><td>push id</td><td><a href="/comm-central/pushloghtml?changeset=2abc5e2495fc83ffa438def667bac604c4b8be22">16580</a></td></tr>
<tr><td>push user</td><td>frgrahl@gmx.net</td></tr>
<tr><td>push date</td><td class="date age">Sun, 20 Oct 2019 15:42:12 +0000</td></tr>

<tr><td>treeherder</td><td>comm-central@6bd51ba5b088 [<a href="https://treeherder.mozilla.org/#/jobs?repo=comm-central&revision=6bd51ba5b088386e8b2b02cf7246949e47d017a2">default view</a>] [<a href="https://treeherder.mozilla.org/#/jobs?repo=comm-central&revision=6bd51ba5b088386e8b2b02cf7246949e47d017a2&filter-resultStatus=testfailed&filter-resultStatus=busted&filter-resultStatus=exception">failures only]</td></tr>
<tr><td>perfherder</td><td>[<a href="https://treeherder.mozilla.org/perf.html#/compare?originalProject=comm-central&originalRevision=6bd51ba5b088386e8b2b02cf7246949e47d017a2&newProject=comm-central&newRevision=2abc5e2495fc83ffa438def667bac604c4b8be22&framework=1" target="_blank">talos</a>] [<a href="https://treeherder.mozilla.org/perf.html#/compare?originalProject=comm-central&originalRevision=6bd51ba5b088386e8b2b02cf7246949e47d017a2&newProject=comm-central&newRevision=2abc5e2495fc83ffa438def667bac604c4b8be22&framework=2" target="_blank">build metrics</a>] [<a href="https://treeherder.mozilla.org/perf.html#/compare?originalProject=comm-central&originalRevision=6bd51ba5b088386e8b2b02cf7246949e47d017a2&newProject=comm-central&newRevision=2abc5e2495fc83ffa438def667bac604c4b8be22&framework=6" target="_blank">platform microbench</a>] (compared to previous push)</td></tr>
<tr><td>reviewers</td><td><a href="/comm-central/log?rev=reviewer%28IanN%29&revcount=50">IanN</a></td></tr>
<tr><td>bugs</td><td><a href="https://bugzilla.mozilla.org/show_bug.cgi?id=1588358">1588358</a></td></tr>




</table></div>

<div class="page_body description"><a href="https://bugzilla.mozilla.org/show_bug.cgi?id=1588358">Bug 1588358</a> - Untangle suite profile and migration source and clean it up. r=IanN</div>
<div class="list_head"></div>
<div class="title_text">
<table cellspacing="0">

<tr class="parity0">
<td><a class="list" href="/comm-central/diff/2abc5e2495fc83ffa438def667bac604c4b8be22/suite/components/build/moz.build">suite/components/build/moz.build</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/2abc5e2495fc83ffa438def667bac604c4b8be22/suite/components/build/moz.build">file</a> |
<a href="/comm-central/annotate/2abc5e2495fc83ffa438def667bac604c4b8be22/suite/components/build/moz.build">annotate</a> |
<a href="/comm-central/diff/2abc5e2495fc83ffa438def667bac604c4b8be22/suite/components/build/moz.build">diff</a> |
<a href="/comm-central/comparison/2abc5e2495fc83ffa438def667bac604c4b8be22/suite/components/build/moz.build">comparison</a> |
<a href="/comm-central/log/2abc5e2495fc83ffa438def667bac604c4b8be22/suite/components/build/moz.build">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/2abc5e2495fc83ffa438def667bac604c4b8be22/suite/components/build/nsSuiteModule.cpp">suite/components/build/nsSuiteModule.cpp</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/2abc5e2495fc83ffa438def667bac604c4b8be22/suite/components/build/nsSuiteModule.cpp">file</a> |
<a href="/comm-central/annotate/2abc5e2495fc83ffa438def667bac604c4b8be22/suite/components/build/nsSuiteModule.cpp">annotate</a> |
<a href="/comm-central/diff/2abc5e2495fc83ffa438def667bac604c4b8be22/suite/components/build/nsSuiteModule.cpp">diff</a> |
<a href="/comm-central/comparison/2abc5e2495fc83ffa438def667bac604c4b8be22/suite/components/build/nsSuiteModule.cpp">comparison</a> |
<a href="/comm-central/log/2abc5e2495fc83ffa438def667bac604c4b8be22/suite/components/build/nsSuiteModule.cpp">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/2abc5e2495fc83ffa438def667bac604c4b8be22/suite/components/migration/SuiteProfileMigrator.js">suite/components/migration/SuiteProfileMigrator.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/2abc5e2495fc83ffa438def667bac604c4b8be22/suite/components/migration/SuiteProfileMigrator.js">file</a> |
<a href="/comm-central/annotate/2abc5e2495fc83ffa438def667bac604c4b8be22/suite/components/migration/SuiteProfileMigrator.js">annotate</a> |
<a href="/comm-central/diff/2abc5e2495fc83ffa438def667bac604c4b8be22/suite/components/migration/SuiteProfileMigrator.js">diff</a> |
<a href="/comm-central/comparison/2abc5e2495fc83ffa438def667bac604c4b8be22/suite/components/migration/SuiteProfileMigrator.js">comparison</a> |
<a href="/comm-central/log/2abc5e2495fc83ffa438def667bac604c4b8be22/suite/components/migration/SuiteProfileMigrator.js">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/2abc5e2495fc83ffa438def667bac604c4b8be22/suite/components/migration/SuiteProfileMigrator.manifest">suite/components/migration/SuiteProfileMigrator.manifest</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/2abc5e2495fc83ffa438def667bac604c4b8be22/suite/components/migration/SuiteProfileMigrator.manifest">file</a> |
<a href="/comm-central/annotate/2abc5e2495fc83ffa438def667bac604c4b8be22/suite/components/migration/SuiteProfileMigrator.manifest">annotate</a> |
<a href="/comm-central/diff/2abc5e2495fc83ffa438def667bac604c4b8be22/suite/components/migration/SuiteProfileMigrator.manifest">diff</a> |
<a href="/comm-central/comparison/2abc5e2495fc83ffa438def667bac604c4b8be22/suite/components/migration/SuiteProfileMigrator.manifest">comparison</a> |
<a href="/comm-central/log/2abc5e2495fc83ffa438def667bac604c4b8be22/suite/components/migration/SuiteProfileMigrator.manifest">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/2abc5e2495fc83ffa438def667bac604c4b8be22/suite/components/migration/content/migration.js">suite/components/migration/content/migration.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/2abc5e2495fc83ffa438def667bac604c4b8be22/suite/components/migration/content/migration.js">file</a> |
<a href="/comm-central/annotate/2abc5e2495fc83ffa438def667bac604c4b8be22/suite/components/migration/content/migration.js">annotate</a> |
<a href="/comm-central/diff/2abc5e2495fc83ffa438def667bac604c4b8be22/suite/components/migration/content/migration.js">diff</a> |
<a href="/comm-central/comparison/2abc5e2495fc83ffa438def667bac604c4b8be22/suite/components/migration/content/migration.js">comparison</a> |
<a href="/comm-central/log/2abc5e2495fc83ffa438def667bac604c4b8be22/suite/components/migration/content/migration.js">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/2abc5e2495fc83ffa438def667bac604c4b8be22/suite/components/migration/content/migration.xul">suite/components/migration/content/migration.xul</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/2abc5e2495fc83ffa438def667bac604c4b8be22/suite/components/migration/content/migration.xul">file</a> |
<a href="/comm-central/annotate/2abc5e2495fc83ffa438def667bac604c4b8be22/suite/components/migration/content/migration.xul">annotate</a> |
<a href="/comm-central/diff/2abc5e2495fc83ffa438def667bac604c4b8be22/suite/components/migration/content/migration.xul">diff</a> |
<a href="/comm-central/comparison/2abc5e2495fc83ffa438def667bac604c4b8be22/suite/components/migration/content/migration.xul">comparison</a> |
<a href="/comm-central/log/2abc5e2495fc83ffa438def667bac604c4b8be22/suite/components/migration/content/migration.xul">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/2abc5e2495fc83ffa438def667bac604c4b8be22/suite/components/migration/jar.mn">suite/components/migration/jar.mn</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/2abc5e2495fc83ffa438def667bac604c4b8be22/suite/components/migration/jar.mn">file</a> |
<a href="/comm-central/annotate/2abc5e2495fc83ffa438def667bac604c4b8be22/suite/components/migration/jar.mn">annotate</a> |
<a href="/comm-central/diff/2abc5e2495fc83ffa438def667bac604c4b8be22/suite/components/migration/jar.mn">diff</a> |
<a href="/comm-central/comparison/2abc5e2495fc83ffa438def667bac604c4b8be22/suite/components/migration/jar.mn">comparison</a> |
<a href="/comm-central/log/2abc5e2495fc83ffa438def667bac604c4b8be22/suite/components/migration/jar.mn">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/2abc5e2495fc83ffa438def667bac604c4b8be22/suite/components/migration/moz.build">suite/components/migration/moz.build</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/2abc5e2495fc83ffa438def667bac604c4b8be22/suite/components/migration/moz.build">file</a> |
<a href="/comm-central/annotate/2abc5e2495fc83ffa438def667bac604c4b8be22/suite/components/migration/moz.build">annotate</a> |
<a href="/comm-central/diff/2abc5e2495fc83ffa438def667bac604c4b8be22/suite/components/migration/moz.build">diff</a> |
<a href="/comm-central/comparison/2abc5e2495fc83ffa438def667bac604c4b8be22/suite/components/migration/moz.build">comparison</a> |
<a href="/comm-central/log/2abc5e2495fc83ffa438def667bac604c4b8be22/suite/components/migration/moz.build">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/2abc5e2495fc83ffa438def667bac604c4b8be22/suite/components/migration/public/moz.build">suite/components/migration/public/moz.build</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/2abc5e2495fc83ffa438def667bac604c4b8be22/suite/components/migration/public/moz.build">file</a> |
<a href="/comm-central/annotate/2abc5e2495fc83ffa438def667bac604c4b8be22/suite/components/migration/public/moz.build">annotate</a> |
<a href="/comm-central/diff/2abc5e2495fc83ffa438def667bac604c4b8be22/suite/components/migration/public/moz.build">diff</a> |
<a href="/comm-central/comparison/2abc5e2495fc83ffa438def667bac604c4b8be22/suite/components/migration/public/moz.build">comparison</a> |
<a href="/comm-central/log/2abc5e2495fc83ffa438def667bac604c4b8be22/suite/components/migration/public/moz.build">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/2abc5e2495fc83ffa438def667bac604c4b8be22/suite/components/migration/public/nsISuiteProfileMigrator.idl">suite/components/migration/public/nsISuiteProfileMigrator.idl</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/2abc5e2495fc83ffa438def667bac604c4b8be22/suite/components/migration/public/nsISuiteProfileMigrator.idl">file</a> |
<a href="/comm-central/annotate/2abc5e2495fc83ffa438def667bac604c4b8be22/suite/components/migration/public/nsISuiteProfileMigrator.idl">annotate</a> |
<a href="/comm-central/diff/2abc5e2495fc83ffa438def667bac604c4b8be22/suite/components/migration/public/nsISuiteProfileMigrator.idl">diff</a> |
<a href="/comm-central/comparison/2abc5e2495fc83ffa438def667bac604c4b8be22/suite/components/migration/public/nsISuiteProfileMigrator.idl">comparison</a> |
<a href="/comm-central/log/2abc5e2495fc83ffa438def667bac604c4b8be22/suite/components/migration/public/nsISuiteProfileMigrator.idl">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/2abc5e2495fc83ffa438def667bac604c4b8be22/suite/components/migration/public/nsSuiteMigrationCID.h">suite/components/migration/public/nsSuiteMigrationCID.h</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/2abc5e2495fc83ffa438def667bac604c4b8be22/suite/components/migration/public/nsSuiteMigrationCID.h">file</a> |
<a href="/comm-central/annotate/2abc5e2495fc83ffa438def667bac604c4b8be22/suite/components/migration/public/nsSuiteMigrationCID.h">annotate</a> |
<a href="/comm-central/diff/2abc5e2495fc83ffa438def667bac604c4b8be22/suite/components/migration/public/nsSuiteMigrationCID.h">diff</a> |
<a href="/comm-central/comparison/2abc5e2495fc83ffa438def667bac604c4b8be22/suite/components/migration/public/nsSuiteMigrationCID.h">comparison</a> |
<a href="/comm-central/log/2abc5e2495fc83ffa438def667bac604c4b8be22/suite/components/migration/public/nsSuiteMigrationCID.h">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/2abc5e2495fc83ffa438def667bac604c4b8be22/suite/components/migration/src/moz.build">suite/components/migration/src/moz.build</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/2abc5e2495fc83ffa438def667bac604c4b8be22/suite/components/migration/src/moz.build">file</a> |
<a href="/comm-central/annotate/2abc5e2495fc83ffa438def667bac604c4b8be22/suite/components/migration/src/moz.build">annotate</a> |
<a href="/comm-central/diff/2abc5e2495fc83ffa438def667bac604c4b8be22/suite/components/migration/src/moz.build">diff</a> |
<a href="/comm-central/comparison/2abc5e2495fc83ffa438def667bac604c4b8be22/suite/components/migration/src/moz.build">comparison</a> |
<a href="/comm-central/log/2abc5e2495fc83ffa438def667bac604c4b8be22/suite/components/migration/src/moz.build">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/2abc5e2495fc83ffa438def667bac604c4b8be22/suite/components/migration/src/nsSuiteProfileMigratorBase.cpp">suite/components/migration/src/nsSuiteProfileMigratorBase.cpp</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/2abc5e2495fc83ffa438def667bac604c4b8be22/suite/components/migration/src/nsSuiteProfileMigratorBase.cpp">file</a> |
<a href="/comm-central/annotate/2abc5e2495fc83ffa438def667bac604c4b8be22/suite/components/migration/src/nsSuiteProfileMigratorBase.cpp">annotate</a> |
<a href="/comm-central/diff/2abc5e2495fc83ffa438def667bac604c4b8be22/suite/components/migration/src/nsSuiteProfileMigratorBase.cpp">diff</a> |
<a href="/comm-central/comparison/2abc5e2495fc83ffa438def667bac604c4b8be22/suite/components/migration/src/nsSuiteProfileMigratorBase.cpp">comparison</a> |
<a href="/comm-central/log/2abc5e2495fc83ffa438def667bac604c4b8be22/suite/components/migration/src/nsSuiteProfileMigratorBase.cpp">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/2abc5e2495fc83ffa438def667bac604c4b8be22/suite/components/migration/src/nsSuiteProfileMigratorBase.h">suite/components/migration/src/nsSuiteProfileMigratorBase.h</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/2abc5e2495fc83ffa438def667bac604c4b8be22/suite/components/migration/src/nsSuiteProfileMigratorBase.h">file</a> |
<a href="/comm-central/annotate/2abc5e2495fc83ffa438def667bac604c4b8be22/suite/components/migration/src/nsSuiteProfileMigratorBase.h">annotate</a> |
<a href="/comm-central/diff/2abc5e2495fc83ffa438def667bac604c4b8be22/suite/components/migration/src/nsSuiteProfileMigratorBase.h">diff</a> |
<a href="/comm-central/comparison/2abc5e2495fc83ffa438def667bac604c4b8be22/suite/components/migration/src/nsSuiteProfileMigratorBase.h">comparison</a> |
<a href="/comm-central/log/2abc5e2495fc83ffa438def667bac604c4b8be22/suite/components/migration/src/nsSuiteProfileMigratorBase.h">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/2abc5e2495fc83ffa438def667bac604c4b8be22/suite/components/migration/src/nsSuiteProfileMigratorUtils.cpp">suite/components/migration/src/nsSuiteProfileMigratorUtils.cpp</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/2abc5e2495fc83ffa438def667bac604c4b8be22/suite/components/migration/src/nsSuiteProfileMigratorUtils.cpp">file</a> |
<a href="/comm-central/annotate/2abc5e2495fc83ffa438def667bac604c4b8be22/suite/components/migration/src/nsSuiteProfileMigratorUtils.cpp">annotate</a> |
<a href="/comm-central/diff/2abc5e2495fc83ffa438def667bac604c4b8be22/suite/components/migration/src/nsSuiteProfileMigratorUtils.cpp">diff</a> |
<a href="/comm-central/comparison/2abc5e2495fc83ffa438def667bac604c4b8be22/suite/components/migration/src/nsSuiteProfileMigratorUtils.cpp">comparison</a> |
<a href="/comm-central/log/2abc5e2495fc83ffa438def667bac604c4b8be22/suite/components/migration/src/nsSuiteProfileMigratorUtils.cpp">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/2abc5e2495fc83ffa438def667bac604c4b8be22/suite/components/migration/src/nsSuiteProfileMigratorUtils.h">suite/components/migration/src/nsSuiteProfileMigratorUtils.h</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/2abc5e2495fc83ffa438def667bac604c4b8be22/suite/components/migration/src/nsSuiteProfileMigratorUtils.h">file</a> |
<a href="/comm-central/annotate/2abc5e2495fc83ffa438def667bac604c4b8be22/suite/components/migration/src/nsSuiteProfileMigratorUtils.h">annotate</a> |
<a href="/comm-central/diff/2abc5e2495fc83ffa438def667bac604c4b8be22/suite/components/migration/src/nsSuiteProfileMigratorUtils.h">diff</a> |
<a href="/comm-central/comparison/2abc5e2495fc83ffa438def667bac604c4b8be22/suite/components/migration/src/nsSuiteProfileMigratorUtils.h">comparison</a> |
<a href="/comm-central/log/2abc5e2495fc83ffa438def667bac604c4b8be22/suite/components/migration/src/nsSuiteProfileMigratorUtils.h">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/2abc5e2495fc83ffa438def667bac604c4b8be22/suite/components/migration/src/nsThunderbirdProfileMigrator.cpp">suite/components/migration/src/nsThunderbirdProfileMigrator.cpp</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/2abc5e2495fc83ffa438def667bac604c4b8be22/suite/components/migration/src/nsThunderbirdProfileMigrator.cpp">file</a> |
<a href="/comm-central/annotate/2abc5e2495fc83ffa438def667bac604c4b8be22/suite/components/migration/src/nsThunderbirdProfileMigrator.cpp">annotate</a> |
<a href="/comm-central/diff/2abc5e2495fc83ffa438def667bac604c4b8be22/suite/components/migration/src/nsThunderbirdProfileMigrator.cpp">diff</a> |
<a href="/comm-central/comparison/2abc5e2495fc83ffa438def667bac604c4b8be22/suite/components/migration/src/nsThunderbirdProfileMigrator.cpp">comparison</a> |
<a href="/comm-central/log/2abc5e2495fc83ffa438def667bac604c4b8be22/suite/components/migration/src/nsThunderbirdProfileMigrator.cpp">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/2abc5e2495fc83ffa438def667bac604c4b8be22/suite/components/migration/src/nsThunderbirdProfileMigrator.h">suite/components/migration/src/nsThunderbirdProfileMigrator.h</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/2abc5e2495fc83ffa438def667bac604c4b8be22/suite/components/migration/src/nsThunderbirdProfileMigrator.h">file</a> |
<a href="/comm-central/annotate/2abc5e2495fc83ffa438def667bac604c4b8be22/suite/components/migration/src/nsThunderbirdProfileMigrator.h">annotate</a> |
<a href="/comm-central/diff/2abc5e2495fc83ffa438def667bac604c4b8be22/suite/components/migration/src/nsThunderbirdProfileMigrator.h">diff</a> |
<a href="/comm-central/comparison/2abc5e2495fc83ffa438def667bac604c4b8be22/suite/components/migration/src/nsThunderbirdProfileMigrator.h">comparison</a> |
<a href="/comm-central/log/2abc5e2495fc83ffa438def667bac604c4b8be22/suite/components/migration/src/nsThunderbirdProfileMigrator.h">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/2abc5e2495fc83ffa438def667bac604c4b8be22/suite/components/moz.build">suite/components/moz.build</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/2abc5e2495fc83ffa438def667bac604c4b8be22/suite/components/moz.build">file</a> |
<a href="/comm-central/annotate/2abc5e2495fc83ffa438def667bac604c4b8be22/suite/components/moz.build">annotate</a> |
<a href="/comm-central/diff/2abc5e2495fc83ffa438def667bac604c4b8be22/suite/components/moz.build">diff</a> |
<a href="/comm-central/comparison/2abc5e2495fc83ffa438def667bac604c4b8be22/suite/components/moz.build">comparison</a> |
<a href="/comm-central/log/2abc5e2495fc83ffa438def667bac604c4b8be22/suite/components/moz.build">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/2abc5e2495fc83ffa438def667bac604c4b8be22/suite/components/profile/SuiteProfileMigrator.js">suite/components/profile/SuiteProfileMigrator.js</a></td>
<td></td>
<td class="link">
file |
annotate |
<a href="/comm-central/diff/2abc5e2495fc83ffa438def667bac604c4b8be22/suite/components/profile/SuiteProfileMigrator.js">diff</a> |
<a href="/comm-central/comparison/2abc5e2495fc83ffa438def667bac604c4b8be22/suite/components/profile/SuiteProfileMigrator.js">comparison</a> |
<a href="/comm-central/log/2abc5e2495fc83ffa438def667bac604c4b8be22/suite/components/profile/SuiteProfileMigrator.js">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/2abc5e2495fc83ffa438def667bac604c4b8be22/suite/components/profile/SuiteProfileMigrator.manifest">suite/components/profile/SuiteProfileMigrator.manifest</a></td>
<td></td>
<td class="link">
file |
annotate |
<a href="/comm-central/diff/2abc5e2495fc83ffa438def667bac604c4b8be22/suite/components/profile/SuiteProfileMigrator.manifest">diff</a> |
<a href="/comm-central/comparison/2abc5e2495fc83ffa438def667bac604c4b8be22/suite/components/profile/SuiteProfileMigrator.manifest">comparison</a> |
<a href="/comm-central/log/2abc5e2495fc83ffa438def667bac604c4b8be22/suite/components/profile/SuiteProfileMigrator.manifest">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/2abc5e2495fc83ffa438def667bac604c4b8be22/suite/components/profile/content/migration.js">suite/components/profile/content/migration.js</a></td>
<td></td>
<td class="link">
file |
annotate |
<a href="/comm-central/diff/2abc5e2495fc83ffa438def667bac604c4b8be22/suite/components/profile/content/migration.js">diff</a> |
<a href="/comm-central/comparison/2abc5e2495fc83ffa438def667bac604c4b8be22/suite/components/profile/content/migration.js">comparison</a> |
<a href="/comm-central/log/2abc5e2495fc83ffa438def667bac604c4b8be22/suite/components/profile/content/migration.js">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/2abc5e2495fc83ffa438def667bac604c4b8be22/suite/components/profile/content/migration.xul">suite/components/profile/content/migration.xul</a></td>
<td></td>
<td class="link">
file |
annotate |
<a href="/comm-central/diff/2abc5e2495fc83ffa438def667bac604c4b8be22/suite/components/profile/content/migration.xul">diff</a> |
<a href="/comm-central/comparison/2abc5e2495fc83ffa438def667bac604c4b8be22/suite/components/profile/content/migration.xul">comparison</a> |
<a href="/comm-central/log/2abc5e2495fc83ffa438def667bac604c4b8be22/suite/components/profile/content/migration.xul">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/2abc5e2495fc83ffa438def667bac604c4b8be22/suite/components/profile/content/profileSelection.js">suite/components/profile/content/profileSelection.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/2abc5e2495fc83ffa438def667bac604c4b8be22/suite/components/profile/content/profileSelection.js">file</a> |
<a href="/comm-central/annotate/2abc5e2495fc83ffa438def667bac604c4b8be22/suite/components/profile/content/profileSelection.js">annotate</a> |
<a href="/comm-central/diff/2abc5e2495fc83ffa438def667bac604c4b8be22/suite/components/profile/content/profileSelection.js">diff</a> |
<a href="/comm-central/comparison/2abc5e2495fc83ffa438def667bac604c4b8be22/suite/components/profile/content/profileSelection.js">comparison</a> |
<a href="/comm-central/log/2abc5e2495fc83ffa438def667bac604c4b8be22/suite/components/profile/content/profileSelection.js">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/2abc5e2495fc83ffa438def667bac604c4b8be22/suite/components/profile/jar.mn">suite/components/profile/jar.mn</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/2abc5e2495fc83ffa438def667bac604c4b8be22/suite/components/profile/jar.mn">file</a> |
<a href="/comm-central/annotate/2abc5e2495fc83ffa438def667bac604c4b8be22/suite/components/profile/jar.mn">annotate</a> |
<a href="/comm-central/diff/2abc5e2495fc83ffa438def667bac604c4b8be22/suite/components/profile/jar.mn">diff</a> |
<a href="/comm-central/comparison/2abc5e2495fc83ffa438def667bac604c4b8be22/suite/components/profile/jar.mn">comparison</a> |
<a href="/comm-central/log/2abc5e2495fc83ffa438def667bac604c4b8be22/suite/components/profile/jar.mn">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/2abc5e2495fc83ffa438def667bac604c4b8be22/suite/components/profile/moz.build">suite/components/profile/moz.build</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/2abc5e2495fc83ffa438def667bac604c4b8be22/suite/components/profile/moz.build">file</a> |
<a href="/comm-central/annotate/2abc5e2495fc83ffa438def667bac604c4b8be22/suite/components/profile/moz.build">annotate</a> |
<a href="/comm-central/diff/2abc5e2495fc83ffa438def667bac604c4b8be22/suite/components/profile/moz.build">diff</a> |
<a href="/comm-central/comparison/2abc5e2495fc83ffa438def667bac604c4b8be22/suite/components/profile/moz.build">comparison</a> |
<a href="/comm-central/log/2abc5e2495fc83ffa438def667bac604c4b8be22/suite/components/profile/moz.build">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/2abc5e2495fc83ffa438def667bac604c4b8be22/suite/components/profile/nsISuiteProfileMigrator.idl">suite/components/profile/nsISuiteProfileMigrator.idl</a></td>
<td></td>
<td class="link">
file |
annotate |
<a href="/comm-central/diff/2abc5e2495fc83ffa438def667bac604c4b8be22/suite/components/profile/nsISuiteProfileMigrator.idl">diff</a> |
<a href="/comm-central/comparison/2abc5e2495fc83ffa438def667bac604c4b8be22/suite/components/profile/nsISuiteProfileMigrator.idl">comparison</a> |
<a href="/comm-central/log/2abc5e2495fc83ffa438def667bac604c4b8be22/suite/components/profile/nsISuiteProfileMigrator.idl">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/2abc5e2495fc83ffa438def667bac604c4b8be22/suite/components/profile/nsNetscapeProfileMigratorBase.cpp">suite/components/profile/nsNetscapeProfileMigratorBase.cpp</a></td>
<td></td>
<td class="link">
file |
annotate |
<a href="/comm-central/diff/2abc5e2495fc83ffa438def667bac604c4b8be22/suite/components/profile/nsNetscapeProfileMigratorBase.cpp">diff</a> |
<a href="/comm-central/comparison/2abc5e2495fc83ffa438def667bac604c4b8be22/suite/components/profile/nsNetscapeProfileMigratorBase.cpp">comparison</a> |
<a href="/comm-central/log/2abc5e2495fc83ffa438def667bac604c4b8be22/suite/components/profile/nsNetscapeProfileMigratorBase.cpp">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/2abc5e2495fc83ffa438def667bac604c4b8be22/suite/components/profile/nsNetscapeProfileMigratorBase.h">suite/components/profile/nsNetscapeProfileMigratorBase.h</a></td>
<td></td>
<td class="link">
file |
annotate |
<a href="/comm-central/diff/2abc5e2495fc83ffa438def667bac604c4b8be22/suite/components/profile/nsNetscapeProfileMigratorBase.h">diff</a> |
<a href="/comm-central/comparison/2abc5e2495fc83ffa438def667bac604c4b8be22/suite/components/profile/nsNetscapeProfileMigratorBase.h">comparison</a> |
<a href="/comm-central/log/2abc5e2495fc83ffa438def667bac604c4b8be22/suite/components/profile/nsNetscapeProfileMigratorBase.h">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/2abc5e2495fc83ffa438def667bac604c4b8be22/suite/components/profile/nsSuiteProfileMigratorUtils.cpp">suite/components/profile/nsSuiteProfileMigratorUtils.cpp</a></td>
<td></td>
<td class="link">
file |
annotate |
<a href="/comm-central/diff/2abc5e2495fc83ffa438def667bac604c4b8be22/suite/components/profile/nsSuiteProfileMigratorUtils.cpp">diff</a> |
<a href="/comm-central/comparison/2abc5e2495fc83ffa438def667bac604c4b8be22/suite/components/profile/nsSuiteProfileMigratorUtils.cpp">comparison</a> |
<a href="/comm-central/log/2abc5e2495fc83ffa438def667bac604c4b8be22/suite/components/profile/nsSuiteProfileMigratorUtils.cpp">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/2abc5e2495fc83ffa438def667bac604c4b8be22/suite/components/profile/nsSuiteProfileMigratorUtils.h">suite/components/profile/nsSuiteProfileMigratorUtils.h</a></td>
<td></td>
<td class="link">
file |
annotate |
<a href="/comm-central/diff/2abc5e2495fc83ffa438def667bac604c4b8be22/suite/components/profile/nsSuiteProfileMigratorUtils.h">diff</a> |
<a href="/comm-central/comparison/2abc5e2495fc83ffa438def667bac604c4b8be22/suite/components/profile/nsSuiteProfileMigratorUtils.h">comparison</a> |
<a href="/comm-central/log/2abc5e2495fc83ffa438def667bac604c4b8be22/suite/components/profile/nsSuiteProfileMigratorUtils.h">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/2abc5e2495fc83ffa438def667bac604c4b8be22/suite/components/profile/nsThunderbirdProfileMigrator.cpp">suite/components/profile/nsThunderbirdProfileMigrator.cpp</a></td>
<td></td>
<td class="link">
file |
annotate |
<a href="/comm-central/diff/2abc5e2495fc83ffa438def667bac604c4b8be22/suite/components/profile/nsThunderbirdProfileMigrator.cpp">diff</a> |
<a href="/comm-central/comparison/2abc5e2495fc83ffa438def667bac604c4b8be22/suite/components/profile/nsThunderbirdProfileMigrator.cpp">comparison</a> |
<a href="/comm-central/log/2abc5e2495fc83ffa438def667bac604c4b8be22/suite/components/profile/nsThunderbirdProfileMigrator.cpp">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/2abc5e2495fc83ffa438def667bac604c4b8be22/suite/components/profile/nsThunderbirdProfileMigrator.h">suite/components/profile/nsThunderbirdProfileMigrator.h</a></td>
<td></td>
<td class="link">
file |
annotate |
<a href="/comm-central/diff/2abc5e2495fc83ffa438def667bac604c4b8be22/suite/components/profile/nsThunderbirdProfileMigrator.h">diff</a> |
<a href="/comm-central/comparison/2abc5e2495fc83ffa438def667bac604c4b8be22/suite/components/profile/nsThunderbirdProfileMigrator.h">comparison</a> |
<a href="/comm-central/log/2abc5e2495fc83ffa438def667bac604c4b8be22/suite/components/profile/nsThunderbirdProfileMigrator.h">revisions</a>
</td>
</tr>
</table></div>

<div class="page_body diffblocks"><div class="diffblock"><pre class="sourcelines">
<a href="#l1.1"></a><span id="l1.1" class="difflineminus">--- a/suite/components/build/moz.build</span>
<a href="#l1.2"></a><span id="l1.2" class="difflineplus">+++ b/suite/components/build/moz.build</span>
<a href="#l1.3"></a><span id="l1.3" class="difflineat">@@ -12,11 +12,12 @@ SOURCES += [</span>
<a href="#l1.4"></a><span id="l1.4">     'nsSuiteModule.cpp',</span>
<a href="#l1.5"></a><span id="l1.5"> ]</span>
<a href="#l1.6"></a><span id="l1.6"> </span>
<a href="#l1.7"></a><span id="l1.7"> Library('suite')</span>
<a href="#l1.8"></a><span id="l1.8"> FINAL_LIBRARY = 'xul'</span>
<a href="#l1.9"></a><span id="l1.9"> </span>
<a href="#l1.10"></a><span id="l1.10"> LOCAL_INCLUDES += [</span>
<a href="#l1.11"></a><span id="l1.11">     '../feeds',</span>
<a href="#l1.12"></a><span id="l1.12" class="difflineplus">+    '../migration/src',</span>
<a href="#l1.13"></a><span id="l1.13">     '../profile',</span>
<a href="#l1.14"></a><span id="l1.14">     '../shell',</span>
<a href="#l1.15"></a><span id="l1.15"> ]</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l2.1"></a><span id="l2.1" class="difflineminus">--- a/suite/components/build/nsSuiteModule.cpp</span>
<a href="#l2.2"></a><span id="l2.2" class="difflineplus">+++ b/suite/components/build/nsSuiteModule.cpp</span>
<a href="#l2.3"></a><span id="l2.3" class="difflineat">@@ -1,29 +1,28 @@</span>
<a href="#l2.4"></a><span id="l2.4"> /* -*- Mode: C++; tab-width: 4; indent-tabs-mode: nil; c-basic-offset: 4 -*- */</span>
<a href="#l2.5"></a><span id="l2.5"> /* This Source Code Form is subject to the terms of the Mozilla Public</span>
<a href="#l2.6"></a><span id="l2.6">  * License, v. 2.0. If a copy of the MPL was not distributed with this</span>
<a href="#l2.7"></a><span id="l2.7">  * file, You can obtain one at http://mozilla.org/MPL/2.0/. */</span>
<a href="#l2.8"></a><span id="l2.8"> </span>
<a href="#l2.9"></a><span id="l2.9"> #include &quot;mozilla/ModuleUtils.h&quot;</span>
<a href="#l2.10"></a><span id="l2.10"> #include &quot;nsSuiteDirectoryProvider.h&quot;</span>
<a href="#l2.11"></a><span id="l2.11"> #include &quot;nsThunderbirdProfileMigrator.h&quot;</span>
<a href="#l2.12"></a><span id="l2.12" class="difflineplus">+#include &quot;nsSuiteMigrationCID.h&quot;</span>
<a href="#l2.13"></a><span id="l2.13"> #include &quot;nsNetCID.h&quot;</span>
<a href="#l2.14"></a><span id="l2.14"> #include &quot;nsFeedSniffer.h&quot;</span>
<a href="#l2.15"></a><span id="l2.15"> </span>
<a href="#l2.16"></a><span id="l2.16"> #if defined(XP_WIN)</span>
<a href="#l2.17"></a><span id="l2.17"> #include &quot;nsWindowsShellService.h&quot;</span>
<a href="#l2.18"></a><span id="l2.18"> #elif defined(XP_MACOSX)</span>
<a href="#l2.19"></a><span id="l2.19"> #include &quot;nsMacShellService.h&quot;</span>
<a href="#l2.20"></a><span id="l2.20"> #elif defined(MOZ_WIDGET_GTK)</span>
<a href="#l2.21"></a><span id="l2.21"> #include &quot;nsGNOMEShellService.h&quot;</span>
<a href="#l2.22"></a><span id="l2.22"> #endif</span>
<a href="#l2.23"></a><span id="l2.23"> </span>
<a href="#l2.24"></a><span id="l2.24" class="difflineminus">-#define NS_SUITEPROFILEMIGRATOR_CONTRACTID_PREFIX &quot;@mozilla.org/profile/migrator;1?app=suite&amp;type=&quot;</span>
<a href="#l2.25"></a><span id="l2.25" class="difflineminus">-</span>
<a href="#l2.26"></a><span id="l2.26"> using namespace mozilla;</span>
<a href="#l2.27"></a><span id="l2.27"> /////////////////////////////////////////////////////////////////////////////</span>
<a href="#l2.28"></a><span id="l2.28"> </span>
<a href="#l2.29"></a><span id="l2.29"> #if defined(XP_WIN)</span>
<a href="#l2.30"></a><span id="l2.30"> NS_GENERIC_FACTORY_CONSTRUCTOR_INIT(nsWindowsShellService, Init)</span>
<a href="#l2.31"></a><span id="l2.31"> #elif defined(XP_MACOSX)</span>
<a href="#l2.32"></a><span id="l2.32"> NS_GENERIC_FACTORY_CONSTRUCTOR(nsMacShellService)</span>
<a href="#l2.33"></a><span id="l2.33"> #elif defined(MOZ_WIDGET_GTK)</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l3.1"></a><span id="l3.1">rename from suite/components/profile/SuiteProfileMigrator.js</span>
<a href="#l3.2"></a><span id="l3.2">rename to suite/components/migration/SuiteProfileMigrator.js</span>
<a href="#l3.3"></a><span id="l3.3" class="difflineminus">--- a/suite/components/profile/SuiteProfileMigrator.js</span>
<a href="#l3.4"></a><span id="l3.4" class="difflineplus">+++ b/suite/components/migration/SuiteProfileMigrator.js</span>
<a href="#l3.5"></a><span id="l3.5" class="difflineat">@@ -2,16 +2,20 @@</span>
<a href="#l3.6"></a><span id="l3.6">  * License, v. 2.0. If a copy of the MPL was not distributed with this file,</span>
<a href="#l3.7"></a><span id="l3.7">  * You can obtain one at http://mozilla.org/MPL/2.0/. */</span>
<a href="#l3.8"></a><span id="l3.8"> </span>
<a href="#l3.9"></a><span id="l3.9"> &quot;use strict&quot;;</span>
<a href="#l3.10"></a><span id="l3.10"> </span>
<a href="#l3.11"></a><span id="l3.11"> var {Services} = ChromeUtils.import(&quot;resource://gre/modules/Services.jsm&quot;);</span>
<a href="#l3.12"></a><span id="l3.12"> var {XPCOMUtils} = ChromeUtils.import(&quot;resource://gre/modules/XPCOMUtils.jsm&quot;);</span>
<a href="#l3.13"></a><span id="l3.13"> const {FileUtils} = ChromeUtils.import(&quot;resource://gre/modules/FileUtils.jsm&quot;);</span>
<a href="#l3.14"></a><span id="l3.14" class="difflineplus">+const {AppConstants} = ChromeUtils.import('resource://gre/modules/AppConstants.jsm');</span>
<a href="#l3.15"></a><span id="l3.15" class="difflineplus">++</span>
<a href="#l3.16"></a><span id="l3.16" class="difflineplus">+ChromeUtils.defineModuleGetter(this, &quot;FileUtils&quot;,</span>
<a href="#l3.17"></a><span id="l3.17" class="difflineplus">+  &quot;resource://gre/modules/FileUtils.jsm&quot;);</span>
<a href="#l3.18"></a><span id="l3.18"> </span>
<a href="#l3.19"></a><span id="l3.19"> function ProfileMigrator() {</span>
<a href="#l3.20"></a><span id="l3.20"> }</span>
<a href="#l3.21"></a><span id="l3.21"> </span>
<a href="#l3.22"></a><span id="l3.22"> ProfileMigrator.prototype = {</span>
<a href="#l3.23"></a><span id="l3.23">   migrate: function PM_migrate(aStartup) {</span>
<a href="#l3.24"></a><span id="l3.24">     // By opening the wizard with a supplied migrator, it will automatically</span>
<a href="#l3.25"></a><span id="l3.25">     // migrate from it.</span>
<a href="#l3.26"></a><span id="l3.26" class="difflineat">@@ -29,103 +33,110 @@ ProfileMigrator.prototype = {</span>
<a href="#l3.27"></a><span id="l3.27">                            &quot;chrome://communicator/content/migration/migration.xul&quot;,</span>
<a href="#l3.28"></a><span id="l3.28">                            &quot;_blank&quot;,</span>
<a href="#l3.29"></a><span id="l3.29">                            &quot;chrome,dialog,modal,centerscreen,titlebar&quot;,</span>
<a href="#l3.30"></a><span id="l3.30">                            params);</span>
<a href="#l3.31"></a><span id="l3.31">   },</span>
<a href="#l3.32"></a><span id="l3.32"> </span>
<a href="#l3.33"></a><span id="l3.33">   _toString: function PM__toString(aStr) {</span>
<a href="#l3.34"></a><span id="l3.34">     let str = Cc[&quot;@mozilla.org/supports-string;1&quot;]</span>
<a href="#l3.35"></a><span id="l3.35" class="difflineminus">-                         .createInstance(Ci.nsISupportsString);</span>
<a href="#l3.36"></a><span id="l3.36" class="difflineplus">+                .createInstance(Ci.nsISupportsString);</span>
<a href="#l3.37"></a><span id="l3.37">     str.data = aStr;</span>
<a href="#l3.38"></a><span id="l3.38">     return str;</span>
<a href="#l3.39"></a><span id="l3.39">   },</span>
<a href="#l3.40"></a><span id="l3.40"> </span>
<a href="#l3.41"></a><span id="l3.41">   _getMigratorIfSourceExists: function PM__getMigratorIfSourceExists(aKey) {</span>
<a href="#l3.42"></a><span id="l3.42">     let cid = &quot;@mozilla.org/profile/migrator;1?app=suite&amp;type=&quot; + aKey;</span>
<a href="#l3.43"></a><span id="l3.43" class="difflineminus">-    let migrator = Cc[cid]</span>
<a href="#l3.44"></a><span id="l3.44" class="difflineminus">-                     .createInstance(Ci</span>
<a href="#l3.45"></a><span id="l3.45" class="difflineminus">-                                               .nsISuiteProfileMigrator);</span>
<a href="#l3.46"></a><span id="l3.46" class="difflineplus">+    let migrator = Cc[cid].createInstance(Ci.nsISuiteProfileMigrator);</span>
<a href="#l3.47"></a><span id="l3.47">     if (migrator.sourceExists)</span>
<a href="#l3.48"></a><span id="l3.48">       return migrator;</span>
<a href="#l3.49"></a><span id="l3.49">     return null;</span>
<a href="#l3.50"></a><span id="l3.50">   },</span>
<a href="#l3.51"></a><span id="l3.51"> </span>
<a href="#l3.52"></a><span id="l3.52">   // We don't yet support checking for the default browser on all platforms,</span>
<a href="#l3.53"></a><span id="l3.53">   // needless to say we don't have migrators for all browsers.  Thus, for each</span>
<a href="#l3.54"></a><span id="l3.54">   // platform, there's a fallback list of migrators used in these cases.</span>
<a href="#l3.55"></a><span id="l3.55">   _PLATFORM_FALLBACK_LIST:</span>
<a href="#l3.56"></a><span id="l3.56">      [&quot;thunderbird&quot;],</span>
<a href="#l3.57"></a><span id="l3.57"> </span>
<a href="#l3.58"></a><span id="l3.58">   _getDefaultMigrator: function PM__getDefaultMigrator() {</span>
<a href="#l3.59"></a><span id="l3.59" class="difflineplus">+</span>
<a href="#l3.60"></a><span id="l3.60">     let migratorsOrdered = Array.from(this._PLATFORM_FALLBACK_LIST);</span>
<a href="#l3.61"></a><span id="l3.61" class="difflineminus">-#if 0</span>
<a href="#l3.62"></a><span id="l3.62" class="difflineminus">-    let defaultBrowser = &quot;&quot;;</span>
<a href="#l3.63"></a><span id="l3.63" class="difflineminus">-#ifdef XP_WIN</span>
<a href="#l3.64"></a><span id="l3.64" class="difflineminus">-    try {</span>
<a href="#l3.65"></a><span id="l3.65" class="difflineminus">-      const REG_KEY = &quot;SOFTWARE\\Classes\\HTTP\\shell\\open\\command&quot;;</span>
<a href="#l3.66"></a><span id="l3.66" class="difflineminus">-      let regKey = Cc[&quot;@mozilla.org/windows-registry-key;1&quot;]</span>
<a href="#l3.67"></a><span id="l3.67" class="difflineminus">-                     .createInstance(Ci.nsIWindowsRegKey);</span>
<a href="#l3.68"></a><span id="l3.68" class="difflineminus">-      regKey.open(regKey.ROOT_KEY_LOCAL_MACHINE, REG_KEY,</span>
<a href="#l3.69"></a><span id="l3.69" class="difflineminus">-                  regKey.ACCESS_READ);</span>
<a href="#l3.70"></a><span id="l3.70" class="difflineminus">-      let value = regKey.readStringValue(&quot;&quot;).toLowerCase();</span>
<a href="#l3.71"></a><span id="l3.71" class="difflineminus">-      let pathMatches = value.match(/^&quot;?(.+?\.exe)&quot;?/);</span>
<a href="#l3.72"></a><span id="l3.72" class="difflineminus">-      if (!pathMatches) {</span>
<a href="#l3.73"></a><span id="l3.73" class="difflineminus">-        throw new Error(&quot;Could not extract path from &quot; +</span>
<a href="#l3.74"></a><span id="l3.74" class="difflineminus">-                        REG_KEY + &quot;(&quot; + value + &quot;)&quot;);</span>
<a href="#l3.75"></a><span id="l3.75" class="difflineplus">+</span>
<a href="#l3.76"></a><span id="l3.76" class="difflineplus">+    // FIXME This is all so not working currently.</span>
<a href="#l3.77"></a><span id="l3.77" class="difflineplus">+    // There are currently no migrators for browsers available.</span>
<a href="#l3.78"></a><span id="l3.78" class="difflineplus">+    // See Bug 739056.</span>
<a href="#l3.79"></a><span id="l3.79" class="difflineplus">+    if (false) {</span>
<a href="#l3.80"></a><span id="l3.80" class="difflineplus">+      let defaultBrowser = &quot;&quot;;</span>
<a href="#l3.81"></a><span id="l3.81" class="difflineplus">+</span>
<a href="#l3.82"></a><span id="l3.82" class="difflineplus">+      if (AppConstants.platform == &quot;win&quot;) {</span>
<a href="#l3.83"></a><span id="l3.83" class="difflineplus">+        try {</span>
<a href="#l3.84"></a><span id="l3.84" class="difflineplus">+          const REG_KEY = &quot;SOFTWARE\\Classes\\HTTP\\shell\\open\\command&quot;;</span>
<a href="#l3.85"></a><span id="l3.85" class="difflineplus">+          let regKey = Cc[&quot;@mozilla.org/windows-registry-key;1&quot;]</span>
<a href="#l3.86"></a><span id="l3.86" class="difflineplus">+                         .createInstance(Ci.nsIWindowsRegKey);</span>
<a href="#l3.87"></a><span id="l3.87" class="difflineplus">+          regKey.open(regKey.ROOT_KEY_LOCAL_MACHINE, REG_KEY,</span>
<a href="#l3.88"></a><span id="l3.88" class="difflineplus">+                      regKey.ACCESS_READ);</span>
<a href="#l3.89"></a><span id="l3.89" class="difflineplus">+          let value = regKey.readStringValue(&quot;&quot;).toLowerCase();</span>
<a href="#l3.90"></a><span id="l3.90" class="difflineplus">+          let pathMatches = value.match(/^&quot;?(.+?\.exe)&quot;?/);</span>
<a href="#l3.91"></a><span id="l3.91" class="difflineplus">+          if (!pathMatches) {</span>
<a href="#l3.92"></a><span id="l3.92" class="difflineplus">+            throw new Error(&quot;Could not extract path from &quot; +</span>
<a href="#l3.93"></a><span id="l3.93" class="difflineplus">+                            REG_KEY + &quot;(&quot; + value + &quot;)&quot;);</span>
<a href="#l3.94"></a><span id="l3.94" class="difflineplus">+          }</span>
<a href="#l3.95"></a><span id="l3.95" class="difflineplus">+</span>
<a href="#l3.96"></a><span id="l3.96" class="difflineplus">+          // We want to find out what the default browser is but the path in and of</span>
<a href="#l3.97"></a><span id="l3.97" class="difflineplus">+          // itself isn't enough.  Why? Because sometimes on Windows paths get</span>
<a href="#l3.98"></a><span id="l3.98" class="difflineplus">+          // truncated like so: C:\PROGRA~1\MOZILL~2\MOZILL~1.EXE.  How do we know</span>
<a href="#l3.99"></a><span id="l3.99" class="difflineplus">+          // what product that is? Mozilla's file objects do nothing to 'normalize'</span>
<a href="#l3.100"></a><span id="l3.100" class="difflineplus">+          // the path so we need to attain an actual product descriptor from the</span>
<a href="#l3.101"></a><span id="l3.101" class="difflineplus">+          // file somehow, and in this case it means getting the &quot;InternalName&quot;</span>
<a href="#l3.102"></a><span id="l3.102" class="difflineplus">+          // field of the file's VERSIONINFO resource.</span>
<a href="#l3.103"></a><span id="l3.103" class="difflineplus">+          //</span>
<a href="#l3.104"></a><span id="l3.104" class="difflineplus">+          // In the file's resource segment there is a VERSIONINFO section that is</span>
<a href="#l3.105"></a><span id="l3.105" class="difflineplus">+          // laid out like this:</span>
<a href="#l3.106"></a><span id="l3.106" class="difflineplus">+          //</span>
<a href="#l3.107"></a><span id="l3.107" class="difflineplus">+          // VERSIONINFO</span>
<a href="#l3.108"></a><span id="l3.108" class="difflineplus">+          //   StringFileInfo</span>
<a href="#l3.109"></a><span id="l3.109" class="difflineplus">+          //     &lt;TranslationID&gt;</span>
<a href="#l3.110"></a><span id="l3.110" class="difflineplus">+          //       InternalName           &quot;iexplore&quot;</span>
<a href="#l3.111"></a><span id="l3.111" class="difflineplus">+          //   VarFileInfo</span>
<a href="#l3.112"></a><span id="l3.112" class="difflineplus">+          //     Translation              &lt;TranslationID&gt;</span>
<a href="#l3.113"></a><span id="l3.113" class="difflineplus">+          //</span>
<a href="#l3.114"></a><span id="l3.114" class="difflineplus">+          // By Querying the VERSIONINFO section for its Tranlations, we can find</span>
<a href="#l3.115"></a><span id="l3.115" class="difflineplus">+          // out where the InternalName lives (A file can have more than one</span>
<a href="#l3.116"></a><span id="l3.116" class="difflineplus">+          // translation of its VERSIONINFO segment, but we just assume the first</span>
<a href="#l3.117"></a><span id="l3.117" class="difflineplus">+          // one).</span>
<a href="#l3.118"></a><span id="l3.118" class="difflineplus">+          let file = FileUtils.File(pathMatches[1])</span>
<a href="#l3.119"></a><span id="l3.119" class="difflineplus">+                              .QueryInterface(Ci.nsILocalFileWin);</span>
<a href="#l3.120"></a><span id="l3.120" class="difflineplus">+          switch (file.getVersionInfoField(&quot;InternalName&quot;).toLowerCase()) {</span>
<a href="#l3.121"></a><span id="l3.121" class="difflineplus">+            case &quot;iexplore&quot;:</span>
<a href="#l3.122"></a><span id="l3.122" class="difflineplus">+              defaultBrowser = &quot;ie&quot;;</span>
<a href="#l3.123"></a><span id="l3.123" class="difflineplus">+              break;</span>
<a href="#l3.124"></a><span id="l3.124" class="difflineplus">+            case &quot;chrome&quot;:</span>
<a href="#l3.125"></a><span id="l3.125" class="difflineplus">+              defaultBrowser = &quot;chrome&quot;;</span>
<a href="#l3.126"></a><span id="l3.126" class="difflineplus">+              break;</span>
<a href="#l3.127"></a><span id="l3.127" class="difflineplus">+          }</span>
<a href="#l3.128"></a><span id="l3.128" class="difflineplus">+        }</span>
<a href="#l3.129"></a><span id="l3.129" class="difflineplus">+        catch (ex) {</span>
<a href="#l3.130"></a><span id="l3.130" class="difflineplus">+          Cu.reportError(&quot;Could not retrieve default browser: &quot; + ex);</span>
<a href="#l3.131"></a><span id="l3.131" class="difflineplus">+        }</span>
<a href="#l3.132"></a><span id="l3.132">       }</span>
<a href="#l3.133"></a><span id="l3.133"> </span>
<a href="#l3.134"></a><span id="l3.134" class="difflineminus">-      // We want to find out what the default browser is but the path in and of</span>
<a href="#l3.135"></a><span id="l3.135" class="difflineminus">-      // itself isn't enough.  Why? Because sometimes on Windows paths get</span>
<a href="#l3.136"></a><span id="l3.136" class="difflineminus">-      // truncated like so: C:\PROGRA~1\MOZILL~2\MOZILL~1.EXE.  How do we know</span>
<a href="#l3.137"></a><span id="l3.137" class="difflineminus">-      // what product that is? Mozilla's file objects do nothing to 'normalize'</span>
<a href="#l3.138"></a><span id="l3.138" class="difflineminus">-      // the path so we need to attain an actual product descriptor from the</span>
<a href="#l3.139"></a><span id="l3.139" class="difflineminus">-      // file somehow, and in this case it means getting the &quot;InternalName&quot;</span>
<a href="#l3.140"></a><span id="l3.140" class="difflineminus">-      // field of the file's VERSIONINFO resource.</span>
<a href="#l3.141"></a><span id="l3.141" class="difflineminus">-      //</span>
<a href="#l3.142"></a><span id="l3.142" class="difflineminus">-      // In the file's resource segment there is a VERSIONINFO section that is</span>
<a href="#l3.143"></a><span id="l3.143" class="difflineminus">-      // laid out like this:</span>
<a href="#l3.144"></a><span id="l3.144" class="difflineminus">-      //</span>
<a href="#l3.145"></a><span id="l3.145" class="difflineminus">-      // VERSIONINFO</span>
<a href="#l3.146"></a><span id="l3.146" class="difflineminus">-      //   StringFileInfo</span>
<a href="#l3.147"></a><span id="l3.147" class="difflineminus">-      //     &lt;TranslationID&gt;</span>
<a href="#l3.148"></a><span id="l3.148" class="difflineminus">-      //       InternalName           &quot;iexplore&quot;</span>
<a href="#l3.149"></a><span id="l3.149" class="difflineminus">-      //   VarFileInfo</span>
<a href="#l3.150"></a><span id="l3.150" class="difflineminus">-      //     Translation              &lt;TranslationID&gt;</span>
<a href="#l3.151"></a><span id="l3.151" class="difflineminus">-      //</span>
<a href="#l3.152"></a><span id="l3.152" class="difflineminus">-      // By Querying the VERSIONINFO section for its Tranlations, we can find</span>
<a href="#l3.153"></a><span id="l3.153" class="difflineminus">-      // out where the InternalName lives (A file can have more than one</span>
<a href="#l3.154"></a><span id="l3.154" class="difflineminus">-      // translation of its VERSIONINFO segment, but we just assume the first</span>
<a href="#l3.155"></a><span id="l3.155" class="difflineminus">-      // one).</span>
<a href="#l3.156"></a><span id="l3.156" class="difflineminus">-      let file = FileUtils.File(pathMatches[1])</span>
<a href="#l3.157"></a><span id="l3.157" class="difflineminus">-                          .QueryInterface(Ci.nsILocalFileWin);</span>
<a href="#l3.158"></a><span id="l3.158" class="difflineminus">-      switch (file.getVersionInfoField(&quot;InternalName&quot;).toLowerCase()) {</span>
<a href="#l3.159"></a><span id="l3.159" class="difflineminus">-        case &quot;iexplore&quot;:</span>
<a href="#l3.160"></a><span id="l3.160" class="difflineminus">-          defaultBrowser = &quot;ie&quot;;</span>
<a href="#l3.161"></a><span id="l3.161" class="difflineminus">-          break;</span>
<a href="#l3.162"></a><span id="l3.162" class="difflineminus">-        case &quot;chrome&quot;:</span>
<a href="#l3.163"></a><span id="l3.163" class="difflineminus">-          defaultBrowser = &quot;chrome&quot;;</span>
<a href="#l3.164"></a><span id="l3.164" class="difflineminus">-          break;</span>
<a href="#l3.165"></a><span id="l3.165" class="difflineplus">+      // If we found the default browser and we have support for that browser,</span>
<a href="#l3.166"></a><span id="l3.166" class="difflineplus">+      // make sure to check it before any other browser, by moving it to the head</span>
<a href="#l3.167"></a><span id="l3.167" class="difflineplus">+      // of the array.</span>
<a href="#l3.168"></a><span id="l3.168" class="difflineplus">+      if (defaultBrowser) {</span>
<a href="#l3.169"></a><span id="l3.169" class="difflineplus">+        migratorsOrdered.sort((a, b) =&gt; b == defaultBrowser ? 1 : 0); </span>
<a href="#l3.170"></a><span id="l3.170">       }</span>
<a href="#l3.171"></a><span id="l3.171">     }</span>
<a href="#l3.172"></a><span id="l3.172" class="difflineminus">-    catch (ex) {</span>
<a href="#l3.173"></a><span id="l3.173" class="difflineminus">-      Cu.reportError(&quot;Could not retrieve default browser: &quot; + ex);</span>
<a href="#l3.174"></a><span id="l3.174" class="difflineminus">-    }</span>
<a href="#l3.175"></a><span id="l3.175" class="difflineminus">-#endif</span>
<a href="#l3.176"></a><span id="l3.176"> </span>
<a href="#l3.177"></a><span id="l3.177" class="difflineminus">-    // If we found the default browser and we have support for that browser,</span>
<a href="#l3.178"></a><span id="l3.178" class="difflineminus">-    // make sure to check it before any other browser, by moving it to the head</span>
<a href="#l3.179"></a><span id="l3.179" class="difflineminus">-    // of the array.</span>
<a href="#l3.180"></a><span id="l3.180" class="difflineminus">-    if (defaultBrowser)</span>
<a href="#l3.181"></a><span id="l3.181" class="difflineminus">-      migratorsOrdered.sort((a, b) =&gt; b == defaultBrowser ? 1 : 0);</span>
<a href="#l3.182"></a><span id="l3.182" class="difflineminus">-#endif</span>
<a href="#l3.183"></a><span id="l3.183">     for (let key of migratorsOrdered) {</span>
<a href="#l3.184"></a><span id="l3.184">       let migrator = this._getMigratorIfSourceExists(key);</span>
<a href="#l3.185"></a><span id="l3.185" class="difflineminus">-      if (migrator)</span>
<a href="#l3.186"></a><span id="l3.186" class="difflineplus">+      if (migrator) {</span>
<a href="#l3.187"></a><span id="l3.187">         return [key, migrator];</span>
<a href="#l3.188"></a><span id="l3.188" class="difflineplus">+      }</span>
<a href="#l3.189"></a><span id="l3.189">     }</span>
<a href="#l3.190"></a><span id="l3.190"> </span>
<a href="#l3.191"></a><span id="l3.191">     return [&quot;&quot;, null];</span>
<a href="#l3.192"></a><span id="l3.192">   },</span>
<a href="#l3.193"></a><span id="l3.193"> </span>
<a href="#l3.194"></a><span id="l3.194">   QueryInterface: XPCOMUtils.generateQI([Ci.nsIProfileMigrator]),</span>
<a href="#l3.195"></a><span id="l3.195">   classDescription: &quot;Profile Migrator&quot;,</span>
<a href="#l3.196"></a><span id="l3.196">   contractID: &quot;@mozilla.org/toolkit/profile-migrator;1&quot;,</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l4.1"></a><span id="l4.1">rename from suite/components/profile/SuiteProfileMigrator.manifest</span>
<a href="#l4.2"></a><span id="l4.2">rename to suite/components/migration/SuiteProfileMigrator.manifest</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l5.1"></a><span id="l5.1">rename from suite/components/profile/content/migration.js</span>
<a href="#l5.2"></a><span id="l5.2">rename to suite/components/migration/content/migration.js</span>
<a href="#l5.3"></a><span id="l5.3" class="difflineminus">--- a/suite/components/profile/content/migration.js</span>
<a href="#l5.4"></a><span id="l5.4" class="difflineplus">+++ b/suite/components/migration/content/migration.js</span>
<a href="#l5.5"></a><span id="l5.5" class="difflineat">@@ -1,89 +1,84 @@</span>
<a href="#l5.6"></a><span id="l5.6"> /* -*- Mode: Java; tab-width: 2; indent-tabs-mode: nil; c-basic-offset: 2 -*- */</span>
<a href="#l5.7"></a><span id="l5.7"> /* This Source Code Form is subject to the terms of the Mozilla Public</span>
<a href="#l5.8"></a><span id="l5.8">  * License, v. 2.0. If a copy of the MPL was not distributed with this</span>
<a href="#l5.9"></a><span id="l5.9">  * file, You can obtain one at http://mozilla.org/MPL/2.0/. */</span>
<a href="#l5.10"></a><span id="l5.10"> </span>
<a href="#l5.11"></a><span id="l5.11"> var {Services} = ChromeUtils.import(&quot;resource://gre/modules/Services.jsm&quot;);</span>
<a href="#l5.12"></a><span id="l5.12"> </span>
<a href="#l5.13"></a><span id="l5.13" class="difflineminus">-const nsISuiteProfileMigrator = Ci.nsISuiteProfileMigrator;</span>
<a href="#l5.14"></a><span id="l5.14" class="difflineminus">-const nsIProfileStartup       = Ci.nsIProfileStartup;</span>
<a href="#l5.15"></a><span id="l5.15" class="difflineminus">-const nsISupportsString       = Ci.nsISupportsString;</span>
<a href="#l5.16"></a><span id="l5.16" class="difflineminus">-const NS_PROFILE_MIGRATOR_CONTRACTID = &quot;@mozilla.org/profile/migrator;1?app=suite&amp;type=&quot;;</span>
<a href="#l5.17"></a><span id="l5.17" class="difflineplus">+const NS_PROFILE_MIGRATOR_CONTRACTID =</span>
<a href="#l5.18"></a><span id="l5.18" class="difflineplus">+  &quot;@mozilla.org/profile/migrator;1?app=suite&amp;type=&quot;;</span>
<a href="#l5.19"></a><span id="l5.19"> </span>
<a href="#l5.20"></a><span id="l5.20"> var MigrationWizard = {</span>
<a href="#l5.21"></a><span id="l5.21">   _source: &quot;&quot;,                  // Source Profile Migrator ContractID suffix</span>
<a href="#l5.22"></a><span id="l5.22" class="difflineminus">-  _itemsFlags: nsISuiteProfileMigrator.ALL, // Selected Import Data Sources</span>
<a href="#l5.23"></a><span id="l5.23" class="difflineplus">+  _itemsFlags: Ci.nsISuiteProfileMigrator.ALL, // Selected Import Data Sources</span>
<a href="#l5.24"></a><span id="l5.24">   _selectedProfile: null,       // Selected Profile name to import from</span>
<a href="#l5.25"></a><span id="l5.25">   _wiz: null,                   // Shortcut to the wizard</span>
<a href="#l5.26"></a><span id="l5.26">   _migrator: null,              // The actual profile migrator.</span>
<a href="#l5.27"></a><span id="l5.27">   _autoMigrate: null,           // Whether or not we are actually migrating.</span>
<a href="#l5.28"></a><span id="l5.28">   _singleItem: false,           // Are we choosing just to import a single</span>
<a href="#l5.29"></a><span id="l5.29">                                 // item into the current profile?</span>
<a href="#l5.30"></a><span id="l5.30">   _newHomePage: null,           // Are we setting a new home page - what to?</span>
<a href="#l5.31"></a><span id="l5.31"> </span>
<a href="#l5.32"></a><span id="l5.32">   init: function() {</span>
<a href="#l5.33"></a><span id="l5.33" class="difflineminus">-    var os = Cc[&quot;@mozilla.org/observer-service;1&quot;]</span>
<a href="#l5.34"></a><span id="l5.34" class="difflineminus">-               .getService(Ci.nsIObserverService);</span>
<a href="#l5.35"></a><span id="l5.35" class="difflineminus">-    os.addObserver(this, &quot;Migration:Started&quot;);</span>
<a href="#l5.36"></a><span id="l5.36" class="difflineminus">-    os.addObserver(this, &quot;Migration:ItemBeforeMigrate&quot;);</span>
<a href="#l5.37"></a><span id="l5.37" class="difflineminus">-    os.addObserver(this, &quot;Migration:ItemAfterMigrate&quot;);</span>
<a href="#l5.38"></a><span id="l5.38" class="difflineminus">-    os.addObserver(this, &quot;Migration:Ended&quot;);</span>
<a href="#l5.39"></a><span id="l5.39" class="difflineminus">-    os.addObserver(this, &quot;Migration:Progress&quot;);</span>
<a href="#l5.40"></a><span id="l5.40" class="difflineplus">+    Services.obs.addObserver(this, &quot;Migration:Started&quot;);</span>
<a href="#l5.41"></a><span id="l5.41" class="difflineplus">+    Services.obs.addObserver(this, &quot;Migration:ItemBeforeMigrate&quot;);</span>
<a href="#l5.42"></a><span id="l5.42" class="difflineplus">+    Services.obs.addObserver(this, &quot;Migration:ItemAfterMigrate&quot;);</span>
<a href="#l5.43"></a><span id="l5.43" class="difflineplus">+    Services.obs.addObserver(this, &quot;Migration:Ended&quot;);</span>
<a href="#l5.44"></a><span id="l5.44" class="difflineplus">+    Services.obs.addObserver(this, &quot;Migration:Progress&quot;);</span>
<a href="#l5.45"></a><span id="l5.45"> </span>
<a href="#l5.46"></a><span id="l5.46">     this._wiz = document.documentElement;</span>
<a href="#l5.47"></a><span id="l5.47">     this._wiz.canRewind = false;</span>
<a href="#l5.48"></a><span id="l5.48"> </span>
<a href="#l5.49"></a><span id="l5.49">     if (&quot;arguments&quot; in window) {</span>
<a href="#l5.50"></a><span id="l5.50">       if (&quot;arguments&quot; in window &amp;&amp; window.arguments[0] == &quot;bookmarks&quot;) {</span>
<a href="#l5.51"></a><span id="l5.51">         this._singleItem = true;</span>
<a href="#l5.52"></a><span id="l5.52" class="difflineminus">-        this._itemsFlags = nsISuiteProfileMigrator.BOOKMARKS;</span>
<a href="#l5.53"></a><span id="l5.53" class="difflineplus">+        this._itemsFlags = Ci.nsISuiteProfileMigrator.BOOKMARKS;</span>
<a href="#l5.54"></a><span id="l5.54">         document.getElementById(&quot;fromFile&quot;).hidden = false;</span>
<a href="#l5.55"></a><span id="l5.55">         document.getElementById(&quot;importBookmarks&quot;).hidden = false;</span>
<a href="#l5.56"></a><span id="l5.56">         document.getElementById(&quot;importAll&quot;).hidden = true;</span>
<a href="#l5.57"></a><span id="l5.57">       }</span>
<a href="#l5.58"></a><span id="l5.58">       else if (window.arguments.length &gt; 1) {</span>
<a href="#l5.59"></a><span id="l5.59">         this._source = window.arguments[0];</span>
<a href="#l5.60"></a><span id="l5.60" class="difflineminus">-        this._migrator = window.arguments[1] instanceof nsISuiteProfileMigrator ?</span>
<a href="#l5.61"></a><span id="l5.61" class="difflineminus">-                         window.arguments[1] : null;</span>
<a href="#l5.62"></a><span id="l5.62" class="difflineplus">+        this._migrator =</span>
<a href="#l5.63"></a><span id="l5.63" class="difflineplus">+          window.arguments[1] instanceof Ci.nsISuiteProfileMigrator ?</span>
<a href="#l5.64"></a><span id="l5.64" class="difflineplus">+            window.arguments[1] : null;</span>
<a href="#l5.65"></a><span id="l5.65">         this._autoMigrate = window.arguments[2]</span>
<a href="#l5.66"></a><span id="l5.66" class="difflineminus">-                                  .QueryInterface(nsIProfileStartup);</span>
<a href="#l5.67"></a><span id="l5.67" class="difflineplus">+                                  .QueryInterface(Ci.nsIProfileStartup);</span>
<a href="#l5.68"></a><span id="l5.68">         // Show the &quot;nothing&quot; option in the automigrate case to provide an</span>
<a href="#l5.69"></a><span id="l5.69">         // easily identifiable way to avoid migration and create a new profile.</span>
<a href="#l5.70"></a><span id="l5.70">         document.getElementById(&quot;nothing&quot;).hidden = false;</span>
<a href="#l5.71"></a><span id="l5.71">       }</span>
<a href="#l5.72"></a><span id="l5.72">     }</span>
<a href="#l5.73"></a><span id="l5.73"> </span>
<a href="#l5.74"></a><span id="l5.74">     this.onImportSourcePageShow();</span>
<a href="#l5.75"></a><span id="l5.75">   },</span>
<a href="#l5.76"></a><span id="l5.76"> </span>
<a href="#l5.77"></a><span id="l5.77">   uninit: function() {</span>
<a href="#l5.78"></a><span id="l5.78" class="difflineminus">-    var os = Cc[&quot;@mozilla.org/observer-service;1&quot;]</span>
<a href="#l5.79"></a><span id="l5.79" class="difflineminus">-               .getService(Ci.nsIObserverService);</span>
<a href="#l5.80"></a><span id="l5.80" class="difflineminus">-    os.removeObserver(this, &quot;Migration:Started&quot;);</span>
<a href="#l5.81"></a><span id="l5.81" class="difflineminus">-    os.removeObserver(this, &quot;Migration:ItemBeforeMigrate&quot;);</span>
<a href="#l5.82"></a><span id="l5.82" class="difflineminus">-    os.removeObserver(this, &quot;Migration:ItemAfterMigrate&quot;);</span>
<a href="#l5.83"></a><span id="l5.83" class="difflineminus">-    os.removeObserver(this, &quot;Migration:Ended&quot;);</span>
<a href="#l5.84"></a><span id="l5.84" class="difflineminus">-    os.removeObserver(this, &quot;Migration:Progress&quot;, false);</span>
<a href="#l5.85"></a><span id="l5.85" class="difflineplus">+    Services.obs.removeObserver(this, &quot;Migration:Started&quot;);</span>
<a href="#l5.86"></a><span id="l5.86" class="difflineplus">+    Services.obs.removeObserver(this, &quot;Migration:ItemBeforeMigrate&quot;);</span>
<a href="#l5.87"></a><span id="l5.87" class="difflineplus">+    Services.obs.removeObserver(this, &quot;Migration:ItemAfterMigrate&quot;);</span>
<a href="#l5.88"></a><span id="l5.88" class="difflineplus">+    Services.obs.removeObserver(this, &quot;Migration:Ended&quot;);</span>
<a href="#l5.89"></a><span id="l5.89" class="difflineplus">+    Services.obs.removeObserver(this, &quot;Migration:Progress&quot;);</span>
<a href="#l5.90"></a><span id="l5.90">   },</span>
<a href="#l5.91"></a><span id="l5.91"> </span>
<a href="#l5.92"></a><span id="l5.92">   // 1 - Import Source</span>
<a href="#l5.93"></a><span id="l5.93">   onImportSourcePageShow: function() {</span>
<a href="#l5.94"></a><span id="l5.94">     // Figure out what source apps are are available to import from:</span>
<a href="#l5.95"></a><span id="l5.95">     var group = document.getElementById(&quot;importSourceGroup&quot;);</span>
<a href="#l5.96"></a><span id="l5.96">     var firstSelectable = null;</span>
<a href="#l5.97"></a><span id="l5.97">     for (var i = 0; i &lt; group.childNodes.length; ++i) {</span>
<a href="#l5.98"></a><span id="l5.98">       var suffix = group.childNodes[i].id;</span>
<a href="#l5.99"></a><span id="l5.99">       if (suffix != &quot;nothing&quot; &amp;&amp; suffix != &quot;fromFile&quot;) {</span>
<a href="#l5.100"></a><span id="l5.100">         var contractID = NS_PROFILE_MIGRATOR_CONTRACTID + suffix;</span>
<a href="#l5.101"></a><span id="l5.101">         var migrator = null;</span>
<a href="#l5.102"></a><span id="l5.102">         if (contractID in Cc) {</span>
<a href="#l5.103"></a><span id="l5.103">           migrator = Cc[contractID]</span>
<a href="#l5.104"></a><span id="l5.104" class="difflineminus">-                       .createInstance(nsISuiteProfileMigrator);</span>
<a href="#l5.105"></a><span id="l5.105" class="difflineplus">+                       .createInstance(Ci.nsISuiteProfileMigrator);</span>
<a href="#l5.106"></a><span id="l5.106">         } else {</span>
<a href="#l5.107"></a><span id="l5.107">           dump(&quot;*** invalid contractID =&quot; + contractID + &quot;\n&quot;);</span>
<a href="#l5.108"></a><span id="l5.108">           // This is an invalid contract id, therefore hide this element</span>
<a href="#l5.109"></a><span id="l5.109">           // and allow things to continue - that way we should be able to</span>
<a href="#l5.110"></a><span id="l5.110">           // copy with anything happening.</span>
<a href="#l5.111"></a><span id="l5.111">           group.childNodes[i].hidden = true;</span>
<a href="#l5.112"></a><span id="l5.112">           break;</span>
<a href="#l5.113"></a><span id="l5.113">         }</span>
<a href="#l5.114"></a><span id="l5.114" class="difflineat">@@ -127,17 +122,17 @@ var MigrationWizard = {</span>
<a href="#l5.115"></a><span id="l5.115">       // called cancel - cancel may not get processed first.</span>
<a href="#l5.116"></a><span id="l5.116">       return false;</span>
<a href="#l5.117"></a><span id="l5.117">     }</span>
<a href="#l5.118"></a><span id="l5.118"> </span>
<a href="#l5.119"></a><span id="l5.119">     if (!this._migrator || newSource != this._source) {</span>
<a href="#l5.120"></a><span id="l5.120">       // Create the migrator for the selected source.</span>
<a href="#l5.121"></a><span id="l5.121">       var contractID = NS_PROFILE_MIGRATOR_CONTRACTID + newSource;</span>
<a href="#l5.122"></a><span id="l5.122">       this._migrator = Cc[contractID]</span>
<a href="#l5.123"></a><span id="l5.123" class="difflineminus">-                         .createInstance(nsISuiteProfileMigrator);</span>
<a href="#l5.124"></a><span id="l5.124" class="difflineplus">+                         .createInstance(Ci.nsISuiteProfileMigrator);</span>
<a href="#l5.125"></a><span id="l5.125"> </span>
<a href="#l5.126"></a><span id="l5.126">       this._selectedProfile = null;</span>
<a href="#l5.127"></a><span id="l5.127">     }</span>
<a href="#l5.128"></a><span id="l5.128">     this._source = newSource;</span>
<a href="#l5.129"></a><span id="l5.129"> </span>
<a href="#l5.130"></a><span id="l5.130">     // check for more than one source profile</span>
<a href="#l5.131"></a><span id="l5.131">     if (this._migrator.sourceHasMultipleProfiles)</span>
<a href="#l5.132"></a><span id="l5.132">       this._wiz.currentPage.next = &quot;selectProfile&quot;;</span>
<a href="#l5.133"></a><span id="l5.133" class="difflineat">@@ -147,17 +142,17 @@ var MigrationWizard = {</span>
<a href="#l5.134"></a><span id="l5.134">       else if (this._singleItem)</span>
<a href="#l5.135"></a><span id="l5.135">         this._wiz.currentPage.next = &quot;migrating&quot;;</span>
<a href="#l5.136"></a><span id="l5.136">       else</span>
<a href="#l5.137"></a><span id="l5.137">         this._wiz.currentPage.next = &quot;importItems&quot;;</span>
<a href="#l5.138"></a><span id="l5.138"> </span>
<a href="#l5.139"></a><span id="l5.139">       var sourceProfiles = this._migrator.sourceProfiles;</span>
<a href="#l5.140"></a><span id="l5.140">       if (sourceProfiles &amp;&amp; sourceProfiles.length == 1) {</span>
<a href="#l5.141"></a><span id="l5.141">         this._selectedProfile = sourceProfiles</span>
<a href="#l5.142"></a><span id="l5.142" class="difflineminus">-            .queryElementAt(0, nsISupportsString).data;</span>
<a href="#l5.143"></a><span id="l5.143" class="difflineplus">+            .queryElementAt(0, Ci.nsISupportsString).data;</span>
<a href="#l5.144"></a><span id="l5.144">       }</span>
<a href="#l5.145"></a><span id="l5.145">       else</span>
<a href="#l5.146"></a><span id="l5.146">         this._selectedProfile = &quot;&quot;;</span>
<a href="#l5.147"></a><span id="l5.147">     }</span>
<a href="#l5.148"></a><span id="l5.148">     return true;</span>
<a href="#l5.149"></a><span id="l5.149">   },</span>
<a href="#l5.150"></a><span id="l5.150"> </span>
<a href="#l5.151"></a><span id="l5.151">   // 2 - [Profile Selection]</span>
<a href="#l5.152"></a><span id="l5.152" class="difflineat">@@ -165,17 +160,17 @@ var MigrationWizard = {</span>
<a href="#l5.153"></a><span id="l5.153">     var profiles = document.getElementById(&quot;profiles&quot;);</span>
<a href="#l5.154"></a><span id="l5.154">     while (profiles.hasChildNodes())</span>
<a href="#l5.155"></a><span id="l5.155">       profiles.lastChild.remove();</span>
<a href="#l5.156"></a><span id="l5.156"> </span>
<a href="#l5.157"></a><span id="l5.157">     var sourceProfiles = this._migrator.sourceProfiles;</span>
<a href="#l5.158"></a><span id="l5.158">     var count = sourceProfiles.length;</span>
<a href="#l5.159"></a><span id="l5.159">     for (var i = 0; i &lt; count; ++i) {</span>
<a href="#l5.160"></a><span id="l5.160">       var item = document.createElement(&quot;radio&quot;);</span>
<a href="#l5.161"></a><span id="l5.161" class="difflineminus">-      item.id = sourceProfiles.queryElementAt(i, nsISupportsString).data;</span>
<a href="#l5.162"></a><span id="l5.162" class="difflineplus">+      item.id = sourceProfiles.queryElementAt(i, Ci.nsISupportsString).data;</span>
<a href="#l5.163"></a><span id="l5.163">       item.setAttribute(&quot;label&quot;, item.id);</span>
<a href="#l5.164"></a><span id="l5.164">       profiles.appendChild(item);</span>
<a href="#l5.165"></a><span id="l5.165">     }</span>
<a href="#l5.166"></a><span id="l5.166"> </span>
<a href="#l5.167"></a><span id="l5.167">     profiles.selectedItem = this._selectedProfile ?</span>
<a href="#l5.168"></a><span id="l5.168">       document.getElementById(this._selectedProfile) : profiles.firstChild;</span>
<a href="#l5.169"></a><span id="l5.169">   },</span>
<a href="#l5.170"></a><span id="l5.170"> </span>
<a href="#l5.171"></a><span id="l5.171" class="difflineat">@@ -272,17 +267,17 @@ var MigrationWizard = {</span>
<a href="#l5.172"></a><span id="l5.172">     var source = null;</span>
<a href="#l5.173"></a><span id="l5.173">     if (this._source != &quot;&quot;) {</span>
<a href="#l5.174"></a><span id="l5.174">       source = &quot;sourceName&quot; + this._source;</span>
<a href="#l5.175"></a><span id="l5.175">     }</span>
<a href="#l5.176"></a><span id="l5.176"> </span>
<a href="#l5.177"></a><span id="l5.177">     var availableItems = this._migrator.getMigrateData(this._selectedProfile,</span>
<a href="#l5.178"></a><span id="l5.178">                                                        this._autoMigrate);</span>
<a href="#l5.179"></a><span id="l5.179"> </span>
<a href="#l5.180"></a><span id="l5.180" class="difflineminus">-    if (source &amp;&amp; (availableItems &amp; nsISuiteProfileMigrator.HOMEPAGEDATA)) {</span>
<a href="#l5.181"></a><span id="l5.181" class="difflineplus">+    if (source &amp;&amp; (availableItems &amp; Ci.nsISuiteProfileMigrator.HOMEPAGEDATA)) {</span>
<a href="#l5.182"></a><span id="l5.182">       var appName = document.getElementById(&quot;bundle&quot;).getString(source);</span>
<a href="#l5.183"></a><span id="l5.183">       var oldHomePageLabel = bundle.getFormattedString(&quot;homePageImport&quot;,</span>
<a href="#l5.184"></a><span id="l5.184">                                                        [appName]);</span>
<a href="#l5.185"></a><span id="l5.185">       var oldHomePage = document.getElementById(&quot;oldHomePage&quot;);</span>
<a href="#l5.186"></a><span id="l5.186">       oldHomePage.setAttribute(&quot;label&quot;, oldHomePageLabel);</span>
<a href="#l5.187"></a><span id="l5.187">       oldHomePage.setAttribute(&quot;value&quot;, &quot;source&quot;);</span>
<a href="#l5.188"></a><span id="l5.188">       oldHomePage.removeAttribute(&quot;hidden&quot;);</span>
<a href="#l5.189"></a><span id="l5.189">       oldHomePage.focus();</span>
<a href="#l5.190"></a><span id="l5.190" class="difflineat">@@ -311,17 +306,17 @@ var MigrationWizard = {</span>
<a href="#l5.191"></a><span id="l5.191"> </span>
<a href="#l5.192"></a><span id="l5.192">     // When migrating a profile on startup, show all of the data that can be</span>
<a href="#l5.193"></a><span id="l5.193">     // received from this source, but exclude home pages if the user didn't</span>
<a href="#l5.194"></a><span id="l5.194">     // want to migrate it.</span>
<a href="#l5.195"></a><span id="l5.195">     if (this._autoMigrate) {</span>
<a href="#l5.196"></a><span id="l5.196">       this._itemsFlags = this._migrator.getMigrateData(this._selectedProfile,</span>
<a href="#l5.197"></a><span id="l5.197">                                                        this._autoMigrate);</span>
<a href="#l5.198"></a><span id="l5.198">       if (!this._newHomePage)</span>
<a href="#l5.199"></a><span id="l5.199" class="difflineminus">-        this._itemsFlags &amp;= ~nsISuiteProfileMigrator.HOMEPAGEDATA;</span>
<a href="#l5.200"></a><span id="l5.200" class="difflineplus">+        this._itemsFlags &amp;= ~Ci.nsISuiteProfileMigrator.HOMEPAGEDATA;</span>
<a href="#l5.201"></a><span id="l5.201">     }</span>
<a href="#l5.202"></a><span id="l5.202"> </span>
<a href="#l5.203"></a><span id="l5.203">     this._listItems(&quot;migratingItems&quot;);</span>
<a href="#l5.204"></a><span id="l5.204">     setTimeout(this.onMigratingMigrate, 0, this);</span>
<a href="#l5.205"></a><span id="l5.205">   },</span>
<a href="#l5.206"></a><span id="l5.206"> </span>
<a href="#l5.207"></a><span id="l5.207">   onMigratingMigrate: function(aOuter) {</span>
<a href="#l5.208"></a><span id="l5.208">     aOuter._migrator.migrate(aOuter._itemsFlags,</span>
<a href="#l5.209"></a><span id="l5.209" class="difflineat">@@ -331,17 +326,17 @@ var MigrationWizard = {</span>
<a href="#l5.210"></a><span id="l5.210"> </span>
<a href="#l5.211"></a><span id="l5.211">   _listItems: function(aID) {</span>
<a href="#l5.212"></a><span id="l5.212">     var items = document.getElementById(aID);</span>
<a href="#l5.213"></a><span id="l5.213">     while (items.hasChildNodes())</span>
<a href="#l5.214"></a><span id="l5.214">       items.lastChild.remove();</span>
<a href="#l5.215"></a><span id="l5.215"> </span>
<a href="#l5.216"></a><span id="l5.216">     var bundle = document.getElementById(&quot;bundle&quot;);</span>
<a href="#l5.217"></a><span id="l5.217">     var itemID;</span>
<a href="#l5.218"></a><span id="l5.218" class="difflineminus">-    for (var x = 1; x &lt; nsISuiteProfileMigrator.ALL;</span>
<a href="#l5.219"></a><span id="l5.219" class="difflineplus">+    for (var x = 1; x &lt; Ci.nsISuiteProfileMigrator.ALL;</span>
<a href="#l5.220"></a><span id="l5.220">          x = x &lt;&lt; 1) {</span>
<a href="#l5.221"></a><span id="l5.221">       if (x &amp; this._itemsFlags) {</span>
<a href="#l5.222"></a><span id="l5.222">         var label = document.createElement(&quot;label&quot;);</span>
<a href="#l5.223"></a><span id="l5.223">         label.id = x + &quot;_migrated&quot;;</span>
<a href="#l5.224"></a><span id="l5.224">         try {</span>
<a href="#l5.225"></a><span id="l5.225">           label.setAttribute(&quot;value&quot;,</span>
<a href="#l5.226"></a><span id="l5.226">                              bundle.stringBundle</span>
<a href="#l5.227"></a><span id="l5.227">                                    .GetStringFromName(x + &quot;_&quot;+ this._source));</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l6.1"></a><span id="l6.1">rename from suite/components/profile/content/migration.xul</span>
<a href="#l6.2"></a><span id="l6.2">rename to suite/components/migration/content/migration.xul</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l7.1"></a><span id="l7.1">copy from suite/components/profile/jar.mn</span>
<a href="#l7.2"></a><span id="l7.2">copy to suite/components/migration/jar.mn</span>
<a href="#l7.3"></a><span id="l7.3" class="difflineminus">--- a/suite/components/profile/jar.mn</span>
<a href="#l7.4"></a><span id="l7.4" class="difflineplus">+++ b/suite/components/migration/jar.mn</span>
<a href="#l7.5"></a><span id="l7.5" class="difflineat">@@ -1,11 +1,7 @@</span>
<a href="#l7.6"></a><span id="l7.6"> # This Source Code Form is subject to the terms of the Mozilla Public</span>
<a href="#l7.7"></a><span id="l7.7"> # License, v. 2.0. If a copy of the MPL was not distributed with this</span>
<a href="#l7.8"></a><span id="l7.8"> # file, You can obtain one at http://mozilla.org/MPL/2.0/.</span>
<a href="#l7.9"></a><span id="l7.9"> </span>
<a href="#l7.10"></a><span id="l7.10"> comm.jar:</span>
<a href="#l7.11"></a><span id="l7.11" class="difflineminus">-% override chrome://mozapps/content/profile/profileSelection.xul chrome://communicator/content/profile/profileSelection.xul</span>
<a href="#l7.12"></a><span id="l7.12">   content/communicator/migration/migration.xul                     (content/migration.xul)</span>
<a href="#l7.13"></a><span id="l7.13">   content/communicator/migration/migration.js                      (content/migration.js)</span>
<a href="#l7.14"></a><span id="l7.14" class="difflineminus">-  content/communicator/profile/profileSelection.js                 (content/profileSelection.js)</span>
<a href="#l7.15"></a><span id="l7.15" class="difflineminus">-  content/communicator/profile/profileSelection.xul                (content/profileSelection.xul)</span>
<a href="#l7.16"></a><span id="l7.16" class="difflineminus">-</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l8.1"></a><span id="l8.1">copy from suite/components/profile/moz.build</span>
<a href="#l8.2"></a><span id="l8.2">copy to suite/components/migration/moz.build</span>
<a href="#l8.3"></a><span id="l8.3" class="difflineminus">--- a/suite/components/profile/moz.build</span>
<a href="#l8.4"></a><span id="l8.4" class="difflineplus">+++ b/suite/components/migration/moz.build</span>
<a href="#l8.5"></a><span id="l8.5" class="difflineat">@@ -1,30 +1,19 @@</span>
<a href="#l8.6"></a><span id="l8.6"> # -*- Mode: python; indent-tabs-mode: nil; tab-width: 40 -*-</span>
<a href="#l8.7"></a><span id="l8.7"> # vim: set filetype=python:</span>
<a href="#l8.8"></a><span id="l8.8"> # This Source Code Form is subject to the terms of the Mozilla Public</span>
<a href="#l8.9"></a><span id="l8.9"> # License, v. 2.0. If a copy of the MPL was not distributed with this</span>
<a href="#l8.10"></a><span id="l8.10"> # file, You can obtain one at http://mozilla.org/MPL/2.0/.</span>
<a href="#l8.11"></a><span id="l8.11"> </span>
<a href="#l8.12"></a><span id="l8.12" class="difflineminus">-XPIDL_SOURCES += [</span>
<a href="#l8.13"></a><span id="l8.13" class="difflineminus">-    'nsISuiteProfileMigrator.idl',</span>
<a href="#l8.14"></a><span id="l8.14" class="difflineminus">-]</span>
<a href="#l8.15"></a><span id="l8.15" class="difflineminus">-</span>
<a href="#l8.16"></a><span id="l8.16" class="difflineminus">-XPIDL_MODULE = 'suitemigration'</span>
<a href="#l8.17"></a><span id="l8.17" class="difflineminus">-</span>
<a href="#l8.18"></a><span id="l8.18" class="difflineminus">-SOURCES += [</span>
<a href="#l8.19"></a><span id="l8.19" class="difflineminus">-    'nsNetscapeProfileMigratorBase.cpp',</span>
<a href="#l8.20"></a><span id="l8.20" class="difflineminus">-    'nsSuiteDirectoryProvider.cpp',</span>
<a href="#l8.21"></a><span id="l8.21" class="difflineminus">-    'nsSuiteProfileMigratorUtils.cpp',</span>
<a href="#l8.22"></a><span id="l8.22" class="difflineminus">-    'nsThunderbirdProfileMigrator.cpp',</span>
<a href="#l8.23"></a><span id="l8.23" class="difflineplus">+DIRS += [</span>
<a href="#l8.24"></a><span id="l8.24" class="difflineplus">+    'public',</span>
<a href="#l8.25"></a><span id="l8.25" class="difflineplus">+    'src',</span>
<a href="#l8.26"></a><span id="l8.26"> ]</span>
<a href="#l8.27"></a><span id="l8.27"> </span>
<a href="#l8.28"></a><span id="l8.28"> EXTRA_COMPONENTS += [</span>
<a href="#l8.29"></a><span id="l8.29" class="difflineplus">+    'SuiteProfileMigrator.js',</span>
<a href="#l8.30"></a><span id="l8.30">     'SuiteProfileMigrator.manifest',</span>
<a href="#l8.31"></a><span id="l8.31"> ]</span>
<a href="#l8.32"></a><span id="l8.32"> </span>
<a href="#l8.33"></a><span id="l8.33" class="difflineminus">-EXTRA_PP_COMPONENTS += [</span>
<a href="#l8.34"></a><span id="l8.34" class="difflineminus">-    'SuiteProfileMigrator.js',</span>
<a href="#l8.35"></a><span id="l8.35" class="difflineminus">-]</span>
<a href="#l8.36"></a><span id="l8.36" class="difflineminus">-</span>
<a href="#l8.37"></a><span id="l8.37"> FINAL_LIBRARY = 'suite'</span>
<a href="#l8.38"></a><span id="l8.38"> </span>
<a href="#l8.39"></a><span id="l8.39"> JAR_MANIFESTS += ['jar.mn']</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l9.1"></a><span id="l9.1">copy from suite/components/profile/moz.build</span>
<a href="#l9.2"></a><span id="l9.2">copy to suite/components/migration/public/moz.build</span>
<a href="#l9.3"></a><span id="l9.3" class="difflineminus">--- a/suite/components/profile/moz.build</span>
<a href="#l9.4"></a><span id="l9.4" class="difflineplus">+++ b/suite/components/migration/public/moz.build</span>
<a href="#l9.5"></a><span id="l9.5" class="difflineat">@@ -5,26 +5,11 @@</span>
<a href="#l9.6"></a><span id="l9.6"> # file, You can obtain one at http://mozilla.org/MPL/2.0/.</span>
<a href="#l9.7"></a><span id="l9.7"> </span>
<a href="#l9.8"></a><span id="l9.8"> XPIDL_SOURCES += [</span>
<a href="#l9.9"></a><span id="l9.9">     'nsISuiteProfileMigrator.idl',</span>
<a href="#l9.10"></a><span id="l9.10"> ]</span>
<a href="#l9.11"></a><span id="l9.11"> </span>
<a href="#l9.12"></a><span id="l9.12"> XPIDL_MODULE = 'suitemigration'</span>
<a href="#l9.13"></a><span id="l9.13"> </span>
<a href="#l9.14"></a><span id="l9.14" class="difflineminus">-SOURCES += [</span>
<a href="#l9.15"></a><span id="l9.15" class="difflineminus">-    'nsNetscapeProfileMigratorBase.cpp',</span>
<a href="#l9.16"></a><span id="l9.16" class="difflineminus">-    'nsSuiteDirectoryProvider.cpp',</span>
<a href="#l9.17"></a><span id="l9.17" class="difflineminus">-    'nsSuiteProfileMigratorUtils.cpp',</span>
<a href="#l9.18"></a><span id="l9.18" class="difflineminus">-    'nsThunderbirdProfileMigrator.cpp',</span>
<a href="#l9.19"></a><span id="l9.19" class="difflineplus">+EXPORTS += [</span>
<a href="#l9.20"></a><span id="l9.20" class="difflineplus">+    'nsSuiteMigrationCID.h',</span>
<a href="#l9.21"></a><span id="l9.21"> ]</span>
<a href="#l9.22"></a><span id="l9.22" class="difflineminus">-</span>
<a href="#l9.23"></a><span id="l9.23" class="difflineminus">-EXTRA_COMPONENTS += [</span>
<a href="#l9.24"></a><span id="l9.24" class="difflineminus">-    'SuiteProfileMigrator.manifest',</span>
<a href="#l9.25"></a><span id="l9.25" class="difflineminus">-]</span>
<a href="#l9.26"></a><span id="l9.26" class="difflineminus">-</span>
<a href="#l9.27"></a><span id="l9.27" class="difflineminus">-EXTRA_PP_COMPONENTS += [</span>
<a href="#l9.28"></a><span id="l9.28" class="difflineminus">-    'SuiteProfileMigrator.js',</span>
<a href="#l9.29"></a><span id="l9.29" class="difflineminus">-]</span>
<a href="#l9.30"></a><span id="l9.30" class="difflineminus">-</span>
<a href="#l9.31"></a><span id="l9.31" class="difflineminus">-FINAL_LIBRARY = 'suite'</span>
<a href="#l9.32"></a><span id="l9.32" class="difflineminus">-</span>
<a href="#l9.33"></a><span id="l9.33" class="difflineminus">-JAR_MANIFESTS += ['jar.mn']</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l10.1"></a><span id="l10.1">rename from suite/components/profile/nsISuiteProfileMigrator.idl</span>
<a href="#l10.2"></a><span id="l10.2">rename to suite/components/migration/public/nsISuiteProfileMigrator.idl</span>
<a href="#l10.3"></a><span id="l10.3" class="difflineminus">--- a/suite/components/profile/nsISuiteProfileMigrator.idl</span>
<a href="#l10.4"></a><span id="l10.4" class="difflineplus">+++ b/suite/components/migration/public/nsISuiteProfileMigrator.idl</span>
<a href="#l10.5"></a><span id="l10.5" class="difflineat">@@ -44,17 +44,16 @@ interface nsISuiteProfileMigrator : nsIS</span>
<a href="#l10.6"></a><span id="l10.6">    *</span>
<a href="#l10.7"></a><span id="l10.7">    * @param   aProfile the profile that we are looking for available data</span>
<a href="#l10.8"></a><span id="l10.8">    *          to import</span>
<a href="#l10.9"></a><span id="l10.9">    * @param   aStarting &quot;true&quot; if the profile is not currently being used.</span>
<a href="#l10.10"></a><span id="l10.10">    * @returns bit field containing profile items (see above)</span>
<a href="#l10.11"></a><span id="l10.11">    */</span>
<a href="#l10.12"></a><span id="l10.12">   unsigned short getMigrateData(in wstring aProfile, in boolean aDoingStartup);</span>
<a href="#l10.13"></a><span id="l10.13"> </span>
<a href="#l10.14"></a><span id="l10.14" class="difflineminus">-</span>
<a href="#l10.15"></a><span id="l10.15">   /**</span>
<a href="#l10.16"></a><span id="l10.16">    * A bit field containing profile items that this migrator may be able</span>
<a href="#l10.17"></a><span id="l10.17">    * to import for any source profile of its type.</span>
<a href="#l10.18"></a><span id="l10.18">    */</span>
<a href="#l10.19"></a><span id="l10.19">   readonly attribute unsigned short   supportedItems;</span>
<a href="#l10.20"></a><span id="l10.20"> </span>
<a href="#l10.21"></a><span id="l10.21">   /**</span>
<a href="#l10.22"></a><span id="l10.22">    * Whether or not there is any data that can be imported from this</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l11.1"></a><span id="l11.1">new file mode 100644</span>
<a href="#l11.2"></a><span id="l11.2" class="difflineminus">--- /dev/null</span>
<a href="#l11.3"></a><span id="l11.3" class="difflineplus">+++ b/suite/components/migration/public/nsSuiteMigrationCID.h</span>
<a href="#l11.4"></a><span id="l11.4" class="difflineat">@@ -0,0 +1,8 @@</span>
<a href="#l11.5"></a><span id="l11.5" class="difflineplus">+/* This Source Code Form is subject to the terms of the Mozilla Public</span>
<a href="#l11.6"></a><span id="l11.6" class="difflineplus">+ * License, v. 2.0. If a copy of the MPL was not distributed with this</span>
<a href="#l11.7"></a><span id="l11.7" class="difflineplus">+ * file, You can obtain one at http://mozilla.org/MPL/2.0/. */</span>
<a href="#l11.8"></a><span id="l11.8" class="difflineplus">+</span>
<a href="#l11.9"></a><span id="l11.9" class="difflineplus">+#define NS_SUITEPROFILEMIGRATOR_CONTRACTID_PREFIX &quot;@mozilla.org/profile/migrator;1?app=suite&amp;type=&quot;</span>
<a href="#l11.10"></a><span id="l11.10" class="difflineplus">+</span>
<a href="#l11.11"></a><span id="l11.11" class="difflineplus">+#define NS_THUNDERBIRDPROFILEMIGRATOR_CID \</span>
<a href="#l11.12"></a><span id="l11.12" class="difflineplus">+{ 0x6ba91adb, 0xa4ed, 0x405f, { 0xbd, 0x6c, 0xe9, 0x04, 0xa9, 0x9d, 0x9a, 0xd8 } }</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l12.1"></a><span id="l12.1">copy from suite/components/profile/moz.build</span>
<a href="#l12.2"></a><span id="l12.2">copy to suite/components/migration/src/moz.build</span>
<a href="#l12.3"></a><span id="l12.3" class="difflineminus">--- a/suite/components/profile/moz.build</span>
<a href="#l12.4"></a><span id="l12.4" class="difflineplus">+++ b/suite/components/migration/src/moz.build</span>
<a href="#l12.5"></a><span id="l12.5" class="difflineat">@@ -1,30 +1,13 @@</span>
<a href="#l12.6"></a><span id="l12.6"> # -*- Mode: python; indent-tabs-mode: nil; tab-width: 40 -*-</span>
<a href="#l12.7"></a><span id="l12.7"> # vim: set filetype=python:</span>
<a href="#l12.8"></a><span id="l12.8"> # This Source Code Form is subject to the terms of the Mozilla Public</span>
<a href="#l12.9"></a><span id="l12.9"> # License, v. 2.0. If a copy of the MPL was not distributed with this</span>
<a href="#l12.10"></a><span id="l12.10"> # file, You can obtain one at http://mozilla.org/MPL/2.0/.</span>
<a href="#l12.11"></a><span id="l12.11"> </span>
<a href="#l12.12"></a><span id="l12.12" class="difflineminus">-XPIDL_SOURCES += [</span>
<a href="#l12.13"></a><span id="l12.13" class="difflineminus">-    'nsISuiteProfileMigrator.idl',</span>
<a href="#l12.14"></a><span id="l12.14" class="difflineminus">-]</span>
<a href="#l12.15"></a><span id="l12.15" class="difflineminus">-</span>
<a href="#l12.16"></a><span id="l12.16" class="difflineminus">-XPIDL_MODULE = 'suitemigration'</span>
<a href="#l12.17"></a><span id="l12.17" class="difflineminus">-</span>
<a href="#l12.18"></a><span id="l12.18"> SOURCES += [</span>
<a href="#l12.19"></a><span id="l12.19" class="difflineminus">-    'nsNetscapeProfileMigratorBase.cpp',</span>
<a href="#l12.20"></a><span id="l12.20" class="difflineminus">-    'nsSuiteDirectoryProvider.cpp',</span>
<a href="#l12.21"></a><span id="l12.21" class="difflineplus">+    'nsSuiteProfileMigratorBase.cpp',</span>
<a href="#l12.22"></a><span id="l12.22">     'nsSuiteProfileMigratorUtils.cpp',</span>
<a href="#l12.23"></a><span id="l12.23">     'nsThunderbirdProfileMigrator.cpp',</span>
<a href="#l12.24"></a><span id="l12.24"> ]</span>
<a href="#l12.25"></a><span id="l12.25"> </span>
<a href="#l12.26"></a><span id="l12.26" class="difflineminus">-EXTRA_COMPONENTS += [</span>
<a href="#l12.27"></a><span id="l12.27" class="difflineminus">-    'SuiteProfileMigrator.manifest',</span>
<a href="#l12.28"></a><span id="l12.28" class="difflineminus">-]</span>
<a href="#l12.29"></a><span id="l12.29" class="difflineminus">-</span>
<a href="#l12.30"></a><span id="l12.30" class="difflineminus">-EXTRA_PP_COMPONENTS += [</span>
<a href="#l12.31"></a><span id="l12.31" class="difflineminus">-    'SuiteProfileMigrator.js',</span>
<a href="#l12.32"></a><span id="l12.32" class="difflineminus">-]</span>
<a href="#l12.33"></a><span id="l12.33" class="difflineminus">-</span>
<a href="#l12.34"></a><span id="l12.34"> FINAL_LIBRARY = 'suite'</span>
<a href="#l12.35"></a><span id="l12.35" class="difflineminus">-</span>
<a href="#l12.36"></a><span id="l12.36" class="difflineminus">-JAR_MANIFESTS += ['jar.mn']</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l13.1"></a><span id="l13.1">rename from suite/components/profile/nsNetscapeProfileMigratorBase.cpp</span>
<a href="#l13.2"></a><span id="l13.2">rename to suite/components/migration/src/nsSuiteProfileMigratorBase.cpp</span>
<a href="#l13.3"></a><span id="l13.3" class="difflineminus">--- a/suite/components/profile/nsNetscapeProfileMigratorBase.cpp</span>
<a href="#l13.4"></a><span id="l13.4" class="difflineplus">+++ b/suite/components/migration/src/nsSuiteProfileMigratorBase.cpp</span>
<a href="#l13.5"></a><span id="l13.5" class="difflineat">@@ -1,104 +1,98 @@</span>
<a href="#l13.6"></a><span id="l13.6"> /* -*- Mode: C++; tab-width: 2; indent-tabs-mode: nil; c-basic-offset: 2 -*- */</span>
<a href="#l13.7"></a><span id="l13.7"> /* This Source Code Form is subject to the terms of the Mozilla Public</span>
<a href="#l13.8"></a><span id="l13.8">  * License, v. 2.0. If a copy of the MPL was not distributed with this</span>
<a href="#l13.9"></a><span id="l13.9">  * file, You can obtain one at http://mozilla.org/MPL/2.0/. */</span>
<a href="#l13.10"></a><span id="l13.10"> </span>
<a href="#l13.11"></a><span id="l13.11"> #include &quot;nsAppDirectoryServiceDefs.h&quot;</span>
<a href="#l13.12"></a><span id="l13.12"> #include &quot;nsSuiteProfileMigratorUtils.h&quot;</span>
<a href="#l13.13"></a><span id="l13.13"> #include &quot;nsCRT.h&quot;</span>
<a href="#l13.14"></a><span id="l13.14" class="difflineminus">-#include &quot;nsICookieManager.h&quot;</span>
<a href="#l13.15"></a><span id="l13.15"> #include &quot;nsIFile.h&quot;</span>
<a href="#l13.16"></a><span id="l13.16"> #include &quot;nsILineInputStream.h&quot;</span>
<a href="#l13.17"></a><span id="l13.17"> #include &quot;nsIOutputStream.h&quot;</span>
<a href="#l13.18"></a><span id="l13.18"> #include &quot;nsIPrefBranch.h&quot;</span>
<a href="#l13.19"></a><span id="l13.19"> #include &quot;nsIPrefLocalizedString.h&quot;</span>
<a href="#l13.20"></a><span id="l13.20"> #include &quot;nsIPrefService.h&quot;</span>
<a href="#l13.21"></a><span id="l13.21"> #include &quot;nsIServiceManager.h&quot;</span>
<a href="#l13.22"></a><span id="l13.22"> #include &quot;nsISupportsPrimitives.h&quot;</span>
<a href="#l13.23"></a><span id="l13.23"> #include &quot;nsIURL.h&quot;</span>
<a href="#l13.24"></a><span id="l13.24" class="difflineminus">-#include &quot;nsNetscapeProfileMigratorBase.h&quot;</span>
<a href="#l13.25"></a><span id="l13.25" class="difflineplus">+#include &quot;nsSuiteProfileMigratorBase.h&quot;</span>
<a href="#l13.26"></a><span id="l13.26"> #include &quot;nsNetUtil.h&quot;</span>
<a href="#l13.27"></a><span id="l13.27"> #include &quot;nsIDirectoryEnumerator.h&quot;</span>
<a href="#l13.28"></a><span id="l13.28"> #include &quot;nsIFileProtocolHandler.h&quot;</span>
<a href="#l13.29"></a><span id="l13.29"> #include &quot;nsServiceManagerUtils.h&quot;</span>
<a href="#l13.30"></a><span id="l13.30"> #include &quot;prtime.h&quot;</span>
<a href="#l13.31"></a><span id="l13.31"> #include &quot;nsINIParser.h&quot;</span>
<a href="#l13.32"></a><span id="l13.32"> #include &quot;nsArrayUtils.h&quot;</span>
<a href="#l13.33"></a><span id="l13.33"> </span>
<a href="#l13.34"></a><span id="l13.34"> #define MAIL_DIR_50_NAME             NS_LITERAL_STRING(&quot;Mail&quot;)</span>
<a href="#l13.35"></a><span id="l13.35"> #define IMAP_MAIL_DIR_50_NAME        NS_LITERAL_STRING(&quot;ImapMail&quot;)</span>
<a href="#l13.36"></a><span id="l13.36"> #define NEWS_DIR_50_NAME             NS_LITERAL_STRING(&quot;News&quot;)</span>
<a href="#l13.37"></a><span id="l13.37"> #define DIR_NAME_CHROME              NS_LITERAL_STRING(&quot;chrome&quot;)</span>
<a href="#l13.38"></a><span id="l13.38"> </span>
<a href="#l13.39"></a><span id="l13.39" class="difflineminus">-NS_IMPL_ISUPPORTS(nsNetscapeProfileMigratorBase, nsISuiteProfileMigrator,</span>
<a href="#l13.40"></a><span id="l13.40" class="difflineminus">-                   nsITimerCallback)</span>
<a href="#l13.41"></a><span id="l13.41" class="difflineplus">+NS_IMPL_ISUPPORTS(nsSuiteProfileMigratorBase, nsISuiteProfileMigrator,</span>
<a href="#l13.42"></a><span id="l13.42" class="difflineplus">+                  nsITimerCallback)</span>
<a href="#l13.43"></a><span id="l13.43"> </span>
<a href="#l13.44"></a><span id="l13.44"> using namespace mozilla;</span>
<a href="#l13.45"></a><span id="l13.45"> </span>
<a href="#l13.46"></a><span id="l13.46"> ///////////////////////////////////////////////////////////////////////////////</span>
<a href="#l13.47"></a><span id="l13.47"> // nsITimerCallback</span>
<a href="#l13.48"></a><span id="l13.48"> </span>
<a href="#l13.49"></a><span id="l13.49"> NS_IMETHODIMP</span>
<a href="#l13.50"></a><span id="l13.50" class="difflineminus">-nsNetscapeProfileMigratorBase::Notify(nsITimer *timer)</span>
<a href="#l13.51"></a><span id="l13.51" class="difflineminus">-{</span>
<a href="#l13.52"></a><span id="l13.52" class="difflineplus">+nsSuiteProfileMigratorBase::Notify(nsITimer *timer) {</span>
<a href="#l13.53"></a><span id="l13.53">   CopyNextFolder();</span>
<a href="#l13.54"></a><span id="l13.54">   return NS_OK;</span>
<a href="#l13.55"></a><span id="l13.55"> }</span>
<a href="#l13.56"></a><span id="l13.56"> </span>
<a href="#l13.57"></a><span id="l13.57"> ///////////////////////////////////////////////////////////////////////////////</span>
<a href="#l13.58"></a><span id="l13.58" class="difflineminus">-// nsNetscapeProfileMigratorBase</span>
<a href="#l13.59"></a><span id="l13.59" class="difflineplus">+// nsSuiteProfileMigratorBase</span>
<a href="#l13.60"></a><span id="l13.60"> </span>
<a href="#l13.61"></a><span id="l13.61" class="difflineminus">-nsNetscapeProfileMigratorBase::nsNetscapeProfileMigratorBase()</span>
<a href="#l13.62"></a><span id="l13.62" class="difflineminus">-{</span>
<a href="#l13.63"></a><span id="l13.63" class="difflineplus">+nsSuiteProfileMigratorBase::nsSuiteProfileMigratorBase() {</span>
<a href="#l13.64"></a><span id="l13.64">   mFileCopyTransactionIndex = 0;</span>
<a href="#l13.65"></a><span id="l13.65">   mObserverService = do_GetService(&quot;@mozilla.org/observer-service;1&quot;);</span>
<a href="#l13.66"></a><span id="l13.66"> }</span>
<a href="#l13.67"></a><span id="l13.67"> </span>
<a href="#l13.68"></a><span id="l13.68"> ///////////////////////////////////////////////////////////////////////////////</span>
<a href="#l13.69"></a><span id="l13.69"> // nsISuiteProfileMigrator methods</span>
<a href="#l13.70"></a><span id="l13.70"> </span>
<a href="#l13.71"></a><span id="l13.71"> NS_IMETHODIMP</span>
<a href="#l13.72"></a><span id="l13.72" class="difflineminus">-nsNetscapeProfileMigratorBase::GetSourceExists(bool* aResult)</span>
<a href="#l13.73"></a><span id="l13.73" class="difflineminus">-{</span>
<a href="#l13.74"></a><span id="l13.74" class="difflineplus">+nsSuiteProfileMigratorBase::GetSourceExists(bool* aResult) {</span>
<a href="#l13.75"></a><span id="l13.75">   nsCOMPtr&lt;nsIArray&gt; profiles;</span>
<a href="#l13.76"></a><span id="l13.76">   GetSourceProfiles(getter_AddRefs(profiles));</span>
<a href="#l13.77"></a><span id="l13.77"> </span>
<a href="#l13.78"></a><span id="l13.78">   if (profiles) {</span>
<a href="#l13.79"></a><span id="l13.79">     uint32_t count;</span>
<a href="#l13.80"></a><span id="l13.80">     profiles-&gt;GetLength(&amp;count);</span>
<a href="#l13.81"></a><span id="l13.81">     *aResult = count &gt; 0;</span>
<a href="#l13.82"></a><span id="l13.82">   }</span>
<a href="#l13.83"></a><span id="l13.83">   else</span>
<a href="#l13.84"></a><span id="l13.84">     *aResult = false;</span>
<a href="#l13.85"></a><span id="l13.85"> </span>
<a href="#l13.86"></a><span id="l13.86">   return NS_OK;</span>
<a href="#l13.87"></a><span id="l13.87"> }</span>
<a href="#l13.88"></a><span id="l13.88"> </span>
<a href="#l13.89"></a><span id="l13.89"> NS_IMETHODIMP</span>
<a href="#l13.90"></a><span id="l13.90" class="difflineminus">-nsNetscapeProfileMigratorBase::GetSourceHasMultipleProfiles(bool* aResult)</span>
<a href="#l13.91"></a><span id="l13.91" class="difflineminus">-{</span>
<a href="#l13.92"></a><span id="l13.92" class="difflineplus">+nsSuiteProfileMigratorBase::GetSourceHasMultipleProfiles(bool* aResult) {</span>
<a href="#l13.93"></a><span id="l13.93">   nsCOMPtr&lt;nsIArray&gt; profiles;</span>
<a href="#l13.94"></a><span id="l13.94">   GetSourceProfiles(getter_AddRefs(profiles));</span>
<a href="#l13.95"></a><span id="l13.95"> </span>
<a href="#l13.96"></a><span id="l13.96">   if (profiles) {</span>
<a href="#l13.97"></a><span id="l13.97">     uint32_t count;</span>
<a href="#l13.98"></a><span id="l13.98">     profiles-&gt;GetLength(&amp;count);</span>
<a href="#l13.99"></a><span id="l13.99">     *aResult = count &gt; 1;</span>
<a href="#l13.100"></a><span id="l13.100">   }</span>
<a href="#l13.101"></a><span id="l13.101">   else</span>
<a href="#l13.102"></a><span id="l13.102">     *aResult = false;</span>
<a href="#l13.103"></a><span id="l13.103"> </span>
<a href="#l13.104"></a><span id="l13.104">   return NS_OK;</span>
<a href="#l13.105"></a><span id="l13.105"> }</span>
<a href="#l13.106"></a><span id="l13.106"> </span>
<a href="#l13.107"></a><span id="l13.107"> NS_IMETHODIMP</span>
<a href="#l13.108"></a><span id="l13.108" class="difflineminus">-nsNetscapeProfileMigratorBase::GetSourceProfiles(nsIArray** aResult)</span>
<a href="#l13.109"></a><span id="l13.109" class="difflineminus">-{</span>
<a href="#l13.110"></a><span id="l13.110" class="difflineplus">+nsSuiteProfileMigratorBase::GetSourceProfiles(nsIArray** aResult) {</span>
<a href="#l13.111"></a><span id="l13.111">   if (!mProfileNames &amp;&amp; !mProfileLocations) {</span>
<a href="#l13.112"></a><span id="l13.112">     nsresult rv;</span>
<a href="#l13.113"></a><span id="l13.113">     mProfileNames = do_CreateInstance(NS_ARRAY_CONTRACTID, &amp;rv);</span>
<a href="#l13.114"></a><span id="l13.114">     if (NS_FAILED(rv))</span>
<a href="#l13.115"></a><span id="l13.115">       return rv;</span>
<a href="#l13.116"></a><span id="l13.116"> </span>
<a href="#l13.117"></a><span id="l13.117">     mProfileLocations = do_CreateInstance(NS_ARRAY_CONTRACTID, &amp;rv);</span>
<a href="#l13.118"></a><span id="l13.118">     if (NS_FAILED(rv))</span>
<a href="#l13.119"></a><span id="l13.119" class="difflineat">@@ -107,73 +101,16 @@ nsNetscapeProfileMigratorBase::GetSource</span>
<a href="#l13.120"></a><span id="l13.120">     // Fills mProfileNames and mProfileLocations</span>
<a href="#l13.121"></a><span id="l13.121">     FillProfileDataFromRegistry();</span>
<a href="#l13.122"></a><span id="l13.122">   }</span>
<a href="#l13.123"></a><span id="l13.123"> </span>
<a href="#l13.124"></a><span id="l13.124">   NS_IF_ADDREF(*aResult = mProfileNames);</span>
<a href="#l13.125"></a><span id="l13.125">   return NS_OK;</span>
<a href="#l13.126"></a><span id="l13.126"> }</span>
<a href="#l13.127"></a><span id="l13.127"> </span>
<a href="#l13.128"></a><span id="l13.128" class="difflineminus">-bool</span>
<a href="#l13.129"></a><span id="l13.129" class="difflineminus">-nsNetscapeProfileMigratorBase::GetSourceHasHomePageURL()</span>
<a href="#l13.130"></a><span id="l13.130" class="difflineminus">-{</span>
<a href="#l13.131"></a><span id="l13.131" class="difflineminus">-  // Load the source pref file</span>
<a href="#l13.132"></a><span id="l13.132" class="difflineminus">-  nsCOMPtr&lt;nsIPrefService&gt; psvc(do_GetService(NS_PREFSERVICE_CONTRACTID));</span>
<a href="#l13.133"></a><span id="l13.133" class="difflineminus">-  psvc-&gt;ResetPrefs();</span>
<a href="#l13.134"></a><span id="l13.134" class="difflineminus">-</span>
<a href="#l13.135"></a><span id="l13.135" class="difflineminus">-  nsCOMPtr&lt;nsIFile&gt; sourcePrefsFile;</span>
<a href="#l13.136"></a><span id="l13.136" class="difflineminus">-</span>
<a href="#l13.137"></a><span id="l13.137" class="difflineminus">-  mSourceProfile-&gt;Clone(getter_AddRefs(sourcePrefsFile));</span>
<a href="#l13.138"></a><span id="l13.138" class="difflineminus">-  sourcePrefsFile-&gt;AppendNative(NS_LITERAL_CSTRING(FILE_NAME_PREFS));</span>
<a href="#l13.139"></a><span id="l13.139" class="difflineminus">-</span>
<a href="#l13.140"></a><span id="l13.140" class="difflineminus">-  psvc-&gt;ReadUserPrefsFromFile(sourcePrefsFile);</span>
<a href="#l13.141"></a><span id="l13.141" class="difflineminus">-</span>
<a href="#l13.142"></a><span id="l13.142" class="difflineminus">-  nsCOMPtr&lt;nsIPrefBranch&gt; branch(do_QueryInterface(psvc));</span>
<a href="#l13.143"></a><span id="l13.143" class="difflineminus">-</span>
<a href="#l13.144"></a><span id="l13.144" class="difflineminus">-  bool hasUserValue;</span>
<a href="#l13.145"></a><span id="l13.145" class="difflineminus">-  nsresult rv = branch-&gt;PrefHasUserValue(&quot;browser.startup.homepage&quot;,</span>
<a href="#l13.146"></a><span id="l13.146" class="difflineminus">-                                         &amp;hasUserValue);</span>
<a href="#l13.147"></a><span id="l13.147" class="difflineminus">-</span>
<a href="#l13.148"></a><span id="l13.148" class="difflineminus">-  return NS_SUCCEEDED(rv) &amp;&amp; hasUserValue;</span>
<a href="#l13.149"></a><span id="l13.149" class="difflineminus">-}</span>
<a href="#l13.150"></a><span id="l13.150" class="difflineminus">-</span>
<a href="#l13.151"></a><span id="l13.151" class="difflineminus">-nsresult</span>
<a href="#l13.152"></a><span id="l13.152" class="difflineminus">-nsNetscapeProfileMigratorBase::CopyHomePageData(bool aReplace)</span>
<a href="#l13.153"></a><span id="l13.153" class="difflineminus">-{</span>
<a href="#l13.154"></a><span id="l13.154" class="difflineminus">-  // Load the source pref file</span>
<a href="#l13.155"></a><span id="l13.155" class="difflineminus">-  nsCOMPtr&lt;nsIPrefService&gt; psvc(do_GetService(NS_PREFSERVICE_CONTRACTID));</span>
<a href="#l13.156"></a><span id="l13.156" class="difflineminus">-  psvc-&gt;ResetPrefs();</span>
<a href="#l13.157"></a><span id="l13.157" class="difflineminus">-</span>
<a href="#l13.158"></a><span id="l13.158" class="difflineminus">-  nsCOMPtr&lt;nsIFile&gt; sourcePrefsFile;</span>
<a href="#l13.159"></a><span id="l13.159" class="difflineminus">-  mSourceProfile-&gt;Clone(getter_AddRefs(sourcePrefsFile));</span>
<a href="#l13.160"></a><span id="l13.160" class="difflineminus">-  sourcePrefsFile-&gt;AppendNative(nsDependentCString(FILE_NAME_PREFS));</span>
<a href="#l13.161"></a><span id="l13.161" class="difflineminus">-  psvc-&gt;ReadUserPrefsFromFile(sourcePrefsFile);</span>
<a href="#l13.162"></a><span id="l13.162" class="difflineminus">-</span>
<a href="#l13.163"></a><span id="l13.163" class="difflineminus">-  PBStructArray homepageBranch;</span>
<a href="#l13.164"></a><span id="l13.164" class="difflineminus">-  ReadBranch(&quot;browser.startup.homepage&quot;, psvc, homepageBranch);</span>
<a href="#l13.165"></a><span id="l13.165" class="difflineminus">-</span>
<a href="#l13.166"></a><span id="l13.166" class="difflineminus">-  // Now that we have all the pref data in memory, load the target pref file,</span>
<a href="#l13.167"></a><span id="l13.167" class="difflineminus">-  // and write it back out</span>
<a href="#l13.168"></a><span id="l13.168" class="difflineminus">-  psvc-&gt;ResetPrefs();</span>
<a href="#l13.169"></a><span id="l13.169" class="difflineminus">-</span>
<a href="#l13.170"></a><span id="l13.170" class="difflineminus">-  nsCOMPtr&lt;nsIFile&gt; targetPrefsFile;</span>
<a href="#l13.171"></a><span id="l13.171" class="difflineminus">-  mTargetProfile-&gt;Clone(getter_AddRefs(targetPrefsFile));</span>
<a href="#l13.172"></a><span id="l13.172" class="difflineminus">-  targetPrefsFile-&gt;AppendNative(nsDependentCString(FILE_NAME_PREFS));</span>
<a href="#l13.173"></a><span id="l13.173" class="difflineminus">-</span>
<a href="#l13.174"></a><span id="l13.174" class="difflineminus">-  // Don't use nullptr here as we're too early in the cycle for the prefs</span>
<a href="#l13.175"></a><span id="l13.175" class="difflineminus">-  // service to get its default file (because the NS_GetDirectoryService items</span>
<a href="#l13.176"></a><span id="l13.176" class="difflineminus">-  // aren't fully set up yet).</span>
<a href="#l13.177"></a><span id="l13.177" class="difflineminus">-  psvc-&gt;ReadUserPrefsFromFile(targetPrefsFile);</span>
<a href="#l13.178"></a><span id="l13.178" class="difflineminus">-</span>
<a href="#l13.179"></a><span id="l13.179" class="difflineminus">-  WriteBranch(&quot;browser.startup.homepage&quot;, psvc, homepageBranch);</span>
<a href="#l13.180"></a><span id="l13.180" class="difflineminus">-</span>
<a href="#l13.181"></a><span id="l13.181" class="difflineminus">-  psvc-&gt;SavePrefFile(targetPrefsFile);</span>
<a href="#l13.182"></a><span id="l13.182" class="difflineminus">-</span>
<a href="#l13.183"></a><span id="l13.183" class="difflineminus">-  return NS_OK;</span>
<a href="#l13.184"></a><span id="l13.184" class="difflineminus">-}</span>
<a href="#l13.185"></a><span id="l13.185"> </span>
<a href="#l13.186"></a><span id="l13.186"> ///////////////////////////////////////////////////////////////////////////////</span>
<a href="#l13.187"></a><span id="l13.187"> // Pref Transform methods</span>
<a href="#l13.188"></a><span id="l13.188"> </span>
<a href="#l13.189"></a><span id="l13.189"> #define GETPREF(xform, method, value) \</span>
<a href="#l13.190"></a><span id="l13.190">   xform-&gt;prefHasValue = NS_SUCCEEDED(aBranch-&gt;method(xform-&gt;sourcePrefName, value)); \</span>
<a href="#l13.191"></a><span id="l13.191">   return NS_OK;</span>
<a href="#l13.192"></a><span id="l13.192"> </span>
<a href="#l13.193"></a><span id="l13.193" class="difflineat">@@ -181,70 +118,63 @@ nsNetscapeProfileMigratorBase::CopyHomeP</span>
<a href="#l13.194"></a><span id="l13.194">   if (xform-&gt;prefHasValue) { \</span>
<a href="#l13.195"></a><span id="l13.195">     return aBranch-&gt;method(xform-&gt;targetPrefName ? \</span>
<a href="#l13.196"></a><span id="l13.196">                            xform-&gt;targetPrefName : \</span>
<a href="#l13.197"></a><span id="l13.197">                            xform-&gt;sourcePrefName, value); \</span>
<a href="#l13.198"></a><span id="l13.198">   } \</span>
<a href="#l13.199"></a><span id="l13.199">   return NS_OK;</span>
<a href="#l13.200"></a><span id="l13.200"> </span>
<a href="#l13.201"></a><span id="l13.201"> nsresult</span>
<a href="#l13.202"></a><span id="l13.202" class="difflineminus">-nsNetscapeProfileMigratorBase::GetString(PrefTransform* aTransform,</span>
<a href="#l13.203"></a><span id="l13.203" class="difflineminus">-                                         nsIPrefBranch* aBranch)</span>
<a href="#l13.204"></a><span id="l13.204" class="difflineminus">-{</span>
<a href="#l13.205"></a><span id="l13.205" class="difflineplus">+nsSuiteProfileMigratorBase::GetString(PrefTransform* aTransform,</span>
<a href="#l13.206"></a><span id="l13.206" class="difflineplus">+                                      nsIPrefBranch* aBranch) {</span>
<a href="#l13.207"></a><span id="l13.207">   PrefTransform* xform = (PrefTransform*)aTransform;</span>
<a href="#l13.208"></a><span id="l13.208">   nsCString str;</span>
<a href="#l13.209"></a><span id="l13.209">   nsresult rv = aBranch-&gt;GetCharPref(xform-&gt;sourcePrefName, str);</span>
<a href="#l13.210"></a><span id="l13.210">   if (NS_SUCCEEDED(rv)) {</span>
<a href="#l13.211"></a><span id="l13.211">     xform-&gt;prefHasValue = true;</span>
<a href="#l13.212"></a><span id="l13.212">     xform-&gt;stringValue = moz_xstrdup(str.get());</span>
<a href="#l13.213"></a><span id="l13.213">   }</span>
<a href="#l13.214"></a><span id="l13.214">   return rv;</span>
<a href="#l13.215"></a><span id="l13.215"> }</span>
<a href="#l13.216"></a><span id="l13.216"> </span>
<a href="#l13.217"></a><span id="l13.217"> nsresult</span>
<a href="#l13.218"></a><span id="l13.218" class="difflineminus">-nsNetscapeProfileMigratorBase::SetString(PrefTransform* aTransform,</span>
<a href="#l13.219"></a><span id="l13.219" class="difflineminus">-                                         nsIPrefBranch* aBranch)</span>
<a href="#l13.220"></a><span id="l13.220" class="difflineminus">-{</span>
<a href="#l13.221"></a><span id="l13.221" class="difflineplus">+nsSuiteProfileMigratorBase::SetString(PrefTransform* aTransform,</span>
<a href="#l13.222"></a><span id="l13.222" class="difflineplus">+                                      nsIPrefBranch* aBranch) {</span>
<a href="#l13.223"></a><span id="l13.223">   PrefTransform* xform = (PrefTransform*) aTransform;</span>
<a href="#l13.224"></a><span id="l13.224">   SETPREF(aTransform, SetCharPref,</span>
<a href="#l13.225"></a><span id="l13.225">           nsDependentCString(xform-&gt;stringValue));</span>
<a href="#l13.226"></a><span id="l13.226"> }</span>
<a href="#l13.227"></a><span id="l13.227"> </span>
<a href="#l13.228"></a><span id="l13.228"> nsresult</span>
<a href="#l13.229"></a><span id="l13.229" class="difflineminus">-nsNetscapeProfileMigratorBase::GetBool(PrefTransform* aTransform,</span>
<a href="#l13.230"></a><span id="l13.230" class="difflineminus">-                                       nsIPrefBranch* aBranch)</span>
<a href="#l13.231"></a><span id="l13.231" class="difflineminus">-{</span>
<a href="#l13.232"></a><span id="l13.232" class="difflineplus">+nsSuiteProfileMigratorBase::GetBool(PrefTransform* aTransform,</span>
<a href="#l13.233"></a><span id="l13.233" class="difflineplus">+                                    nsIPrefBranch* aBranch) {</span>
<a href="#l13.234"></a><span id="l13.234">   GETPREF(aTransform, GetBoolPref, &amp;aTransform-&gt;boolValue)</span>
<a href="#l13.235"></a><span id="l13.235"> }</span>
<a href="#l13.236"></a><span id="l13.236"> </span>
<a href="#l13.237"></a><span id="l13.237"> nsresult</span>
<a href="#l13.238"></a><span id="l13.238" class="difflineminus">-nsNetscapeProfileMigratorBase::SetBool(PrefTransform* aTransform,</span>
<a href="#l13.239"></a><span id="l13.239" class="difflineminus">-                                       nsIPrefBranch* aBranch)</span>
<a href="#l13.240"></a><span id="l13.240" class="difflineminus">-{</span>
<a href="#l13.241"></a><span id="l13.241" class="difflineplus">+nsSuiteProfileMigratorBase::SetBool(PrefTransform* aTransform,</span>
<a href="#l13.242"></a><span id="l13.242" class="difflineplus">+                                    nsIPrefBranch* aBranch) {</span>
<a href="#l13.243"></a><span id="l13.243">   SETPREF(aTransform, SetBoolPref, aTransform-&gt;boolValue)</span>
<a href="#l13.244"></a><span id="l13.244"> }</span>
<a href="#l13.245"></a><span id="l13.245"> </span>
<a href="#l13.246"></a><span id="l13.246"> nsresult</span>
<a href="#l13.247"></a><span id="l13.247" class="difflineminus">-nsNetscapeProfileMigratorBase::GetInt(PrefTransform* aTransform,</span>
<a href="#l13.248"></a><span id="l13.248" class="difflineminus">-                                      nsIPrefBranch* aBranch)</span>
<a href="#l13.249"></a><span id="l13.249" class="difflineminus">-{</span>
<a href="#l13.250"></a><span id="l13.250" class="difflineplus">+nsSuiteProfileMigratorBase::GetInt(PrefTransform* aTransform,</span>
<a href="#l13.251"></a><span id="l13.251" class="difflineplus">+                                   nsIPrefBranch* aBranch) {</span>
<a href="#l13.252"></a><span id="l13.252">   GETPREF(aTransform, GetIntPref, &amp;aTransform-&gt;intValue)</span>
<a href="#l13.253"></a><span id="l13.253"> }</span>
<a href="#l13.254"></a><span id="l13.254"> </span>
<a href="#l13.255"></a><span id="l13.255"> nsresult</span>
<a href="#l13.256"></a><span id="l13.256" class="difflineminus">-nsNetscapeProfileMigratorBase::SetInt(PrefTransform* aTransform,</span>
<a href="#l13.257"></a><span id="l13.257" class="difflineminus">-                                      nsIPrefBranch* aBranch)</span>
<a href="#l13.258"></a><span id="l13.258" class="difflineminus">-{</span>
<a href="#l13.259"></a><span id="l13.259" class="difflineplus">+nsSuiteProfileMigratorBase::SetInt(PrefTransform* aTransform,</span>
<a href="#l13.260"></a><span id="l13.260" class="difflineplus">+                                   nsIPrefBranch* aBranch) {</span>
<a href="#l13.261"></a><span id="l13.261">   SETPREF(aTransform, SetIntPref, aTransform-&gt;intValue)</span>
<a href="#l13.262"></a><span id="l13.262"> }</span>
<a href="#l13.263"></a><span id="l13.263"> </span>
<a href="#l13.264"></a><span id="l13.264"> nsresult</span>
<a href="#l13.265"></a><span id="l13.265" class="difflineminus">-nsNetscapeProfileMigratorBase::SetFile(PrefTransform* aTransform,</span>
<a href="#l13.266"></a><span id="l13.266" class="difflineminus">-                                       nsIPrefBranch* aBranch)</span>
<a href="#l13.267"></a><span id="l13.267" class="difflineminus">-{</span>
<a href="#l13.268"></a><span id="l13.268" class="difflineplus">+nsSuiteProfileMigratorBase::SetFile(PrefTransform* aTransform,</span>
<a href="#l13.269"></a><span id="l13.269" class="difflineplus">+                                    nsIPrefBranch* aBranch) {</span>
<a href="#l13.270"></a><span id="l13.270">   // In this case targetPrefName is just an additional preference</span>
<a href="#l13.271"></a><span id="l13.271">   // that needs to be modified and not what the sourcePrefName is</span>
<a href="#l13.272"></a><span id="l13.272">   // going to be saved to once it is modified.</span>
<a href="#l13.273"></a><span id="l13.273">   nsresult rv = NS_OK;</span>
<a href="#l13.274"></a><span id="l13.274">   if (aTransform-&gt;prefHasValue) {</span>
<a href="#l13.275"></a><span id="l13.275">     nsCOMPtr&lt;nsIProtocolHandler&gt; handler;</span>
<a href="#l13.276"></a><span id="l13.276">     nsCOMPtr&lt;nsIIOService&gt; ioService(do_GetIOService());</span>
<a href="#l13.277"></a><span id="l13.277">     if (!ioService)</span>
<a href="#l13.278"></a><span id="l13.278" class="difflineat">@@ -283,46 +213,32 @@ nsNetscapeProfileMigratorBase::SetFile(P</span>
<a href="#l13.279"></a><span id="l13.279">       if (NS_SUCCEEDED(rv) &amp;&amp; aTransform-&gt;targetPrefName)</span>
<a href="#l13.280"></a><span id="l13.280">         rv = aBranch-&gt;SetIntPref(aTransform-&gt;targetPrefName, 1);</span>
<a href="#l13.281"></a><span id="l13.281">     }</span>
<a href="#l13.282"></a><span id="l13.282">   }</span>
<a href="#l13.283"></a><span id="l13.283">   return rv;</span>
<a href="#l13.284"></a><span id="l13.284"> }</span>
<a href="#l13.285"></a><span id="l13.285"> </span>
<a href="#l13.286"></a><span id="l13.286"> nsresult</span>
<a href="#l13.287"></a><span id="l13.287" class="difflineminus">-nsNetscapeProfileMigratorBase::SetImage(PrefTransform* aTransform,</span>
<a href="#l13.288"></a><span id="l13.288" class="difflineminus">-                                        nsIPrefBranch* aBranch)</span>
<a href="#l13.289"></a><span id="l13.289" class="difflineminus">-{</span>
<a href="#l13.290"></a><span id="l13.290" class="difflineplus">+nsSuiteProfileMigratorBase::SetImage(PrefTransform* aTransform,</span>
<a href="#l13.291"></a><span id="l13.291" class="difflineplus">+                                     nsIPrefBranch* aBranch) {</span>
<a href="#l13.292"></a><span id="l13.292">   if (aTransform-&gt;prefHasValue)</span>
<a href="#l13.293"></a><span id="l13.293">     // This transforms network.image.imageBehavior into</span>
<a href="#l13.294"></a><span id="l13.294">     // permissions.default.image</span>
<a href="#l13.295"></a><span id="l13.295">     return aBranch-&gt;SetIntPref(&quot;permissions.default.image&quot;,</span>
<a href="#l13.296"></a><span id="l13.296">                         aTransform-&gt;intValue == 1 ? 3 :</span>
<a href="#l13.297"></a><span id="l13.297">                         aTransform-&gt;intValue == 2 ? 2 : 1);</span>
<a href="#l13.298"></a><span id="l13.298">   return NS_OK;</span>
<a href="#l13.299"></a><span id="l13.299"> }</span>
<a href="#l13.300"></a><span id="l13.300"> </span>
<a href="#l13.301"></a><span id="l13.301" class="difflineminus">-nsresult</span>
<a href="#l13.302"></a><span id="l13.302" class="difflineminus">-nsNetscapeProfileMigratorBase::SetCookie(PrefTransform* aTransform,</span>
<a href="#l13.303"></a><span id="l13.303" class="difflineminus">-                                         nsIPrefBranch* aBranch)</span>
<a href="#l13.304"></a><span id="l13.304" class="difflineminus">-{</span>
<a href="#l13.305"></a><span id="l13.305" class="difflineminus">-  if (aTransform-&gt;prefHasValue)</span>
<a href="#l13.306"></a><span id="l13.306" class="difflineminus">-    return aBranch-&gt;SetIntPref(&quot;network.cookie.cookieBehavior&quot;,</span>
<a href="#l13.307"></a><span id="l13.307" class="difflineminus">-                               aTransform-&gt;intValue == 3 ? 0 :</span>
<a href="#l13.308"></a><span id="l13.308" class="difflineminus">-                               aTransform-&gt;intValue);</span>
<a href="#l13.309"></a><span id="l13.309" class="difflineminus">-</span>
<a href="#l13.310"></a><span id="l13.310" class="difflineminus">-  return NS_OK;</span>
<a href="#l13.311"></a><span id="l13.311" class="difflineminus">-}</span>
<a href="#l13.312"></a><span id="l13.312" class="difflineminus">-</span>
<a href="#l13.313"></a><span id="l13.313"> ///////////////////////////////////////////////////////////////////////////////</span>
<a href="#l13.314"></a><span id="l13.314"> // General Utility Methods</span>
<a href="#l13.315"></a><span id="l13.315"> </span>
<a href="#l13.316"></a><span id="l13.316"> nsresult</span>
<a href="#l13.317"></a><span id="l13.317" class="difflineminus">-nsNetscapeProfileMigratorBase::GetSourceProfile(const char16_t* aProfile)</span>
<a href="#l13.318"></a><span id="l13.318" class="difflineminus">-{</span>
<a href="#l13.319"></a><span id="l13.319" class="difflineplus">+nsSuiteProfileMigratorBase::GetSourceProfile(const char16_t* aProfile) {</span>
<a href="#l13.320"></a><span id="l13.320">   uint32_t count;</span>
<a href="#l13.321"></a><span id="l13.321">   mProfileNames-&gt;GetLength(&amp;count);</span>
<a href="#l13.322"></a><span id="l13.322">   for (uint32_t i = 0; i &lt; count; ++i) {</span>
<a href="#l13.323"></a><span id="l13.323">     nsCOMPtr&lt;nsISupportsString&gt; str(do_QueryElementAt(mProfileNames, i));</span>
<a href="#l13.324"></a><span id="l13.324">     nsString profileName;</span>
<a href="#l13.325"></a><span id="l13.325">     str-&gt;GetData(profileName);</span>
<a href="#l13.326"></a><span id="l13.326">     if (profileName.Equals(aProfile))</span>
<a href="#l13.327"></a><span id="l13.327">     {</span>
<a href="#l13.328"></a><span id="l13.328" class="difflineat">@@ -330,20 +246,19 @@ nsNetscapeProfileMigratorBase::GetSource</span>
<a href="#l13.329"></a><span id="l13.329">       break;</span>
<a href="#l13.330"></a><span id="l13.330">     }</span>
<a href="#l13.331"></a><span id="l13.331">   }</span>
<a href="#l13.332"></a><span id="l13.332"> </span>
<a href="#l13.333"></a><span id="l13.333">   return NS_OK;</span>
<a href="#l13.334"></a><span id="l13.334"> }</span>
<a href="#l13.335"></a><span id="l13.335"> </span>
<a href="#l13.336"></a><span id="l13.336"> nsresult</span>
<a href="#l13.337"></a><span id="l13.337" class="difflineminus">-nsNetscapeProfileMigratorBase::GetProfileDataFromProfilesIni(nsIFile* aDataDir,</span>
<a href="#l13.338"></a><span id="l13.338" class="difflineminus">-                                                             nsIMutableArray* aProfileNames,</span>
<a href="#l13.339"></a><span id="l13.339" class="difflineminus">-                                                             nsIMutableArray* aProfileLocations)</span>
<a href="#l13.340"></a><span id="l13.340" class="difflineminus">-{</span>
<a href="#l13.341"></a><span id="l13.341" class="difflineplus">+nsSuiteProfileMigratorBase::GetProfileDataFromProfilesIni(nsIFile* aDataDir,</span>
<a href="#l13.342"></a><span id="l13.342" class="difflineplus">+                                                          nsIMutableArray* aProfileNames,</span>
<a href="#l13.343"></a><span id="l13.343" class="difflineplus">+                                                          nsIMutableArray* aProfileLocations) {</span>
<a href="#l13.344"></a><span id="l13.344">   nsresult rv;</span>
<a href="#l13.345"></a><span id="l13.345">   nsCOMPtr&lt;nsIFile&gt; profileIni;</span>
<a href="#l13.346"></a><span id="l13.346">   rv = aDataDir-&gt;Clone(getter_AddRefs(profileIni));</span>
<a href="#l13.347"></a><span id="l13.347">   NS_ENSURE_SUCCESS(rv, rv);</span>
<a href="#l13.348"></a><span id="l13.348"> </span>
<a href="#l13.349"></a><span id="l13.349">   profileIni-&gt;Append(NS_LITERAL_STRING(&quot;profiles.ini&quot;));</span>
<a href="#l13.350"></a><span id="l13.350"> </span>
<a href="#l13.351"></a><span id="l13.351">   // Does it exist?</span>
<a href="#l13.352"></a><span id="l13.352" class="difflineat">@@ -407,19 +322,18 @@ nsNetscapeProfileMigratorBase::GetProfil</span>
<a href="#l13.353"></a><span id="l13.353">       profileNameString-&gt;SetData(NS_ConvertUTF8toUTF16(buffer));</span>
<a href="#l13.354"></a><span id="l13.354">       aProfileNames-&gt;AppendElement(profileNameString);</span>
<a href="#l13.355"></a><span id="l13.355">     }</span>
<a href="#l13.356"></a><span id="l13.356">   }</span>
<a href="#l13.357"></a><span id="l13.357">   return NS_OK;</span>
<a href="#l13.358"></a><span id="l13.358"> }</span>
<a href="#l13.359"></a><span id="l13.359"> </span>
<a href="#l13.360"></a><span id="l13.360"> nsresult</span>
<a href="#l13.361"></a><span id="l13.361" class="difflineminus">-nsNetscapeProfileMigratorBase::CopyFile(const char* aSourceFileName,</span>
<a href="#l13.362"></a><span id="l13.362" class="difflineminus">-                                        const char* aTargetFileName)</span>
<a href="#l13.363"></a><span id="l13.363" class="difflineminus">-{</span>
<a href="#l13.364"></a><span id="l13.364" class="difflineplus">+nsSuiteProfileMigratorBase::CopyFile(const char* aSourceFileName,</span>
<a href="#l13.365"></a><span id="l13.365" class="difflineplus">+                                     const char* aTargetFileName) {</span>
<a href="#l13.366"></a><span id="l13.366">   nsCOMPtr&lt;nsIFile&gt; sourceFile;</span>
<a href="#l13.367"></a><span id="l13.367">   mSourceProfile-&gt;Clone(getter_AddRefs(sourceFile));</span>
<a href="#l13.368"></a><span id="l13.368"> </span>
<a href="#l13.369"></a><span id="l13.369">   sourceFile-&gt;AppendNative(nsDependentCString(aSourceFileName));</span>
<a href="#l13.370"></a><span id="l13.370">   bool exists = false;</span>
<a href="#l13.371"></a><span id="l13.371">   sourceFile-&gt;Exists(&amp;exists);</span>
<a href="#l13.372"></a><span id="l13.372">   if (!exists)</span>
<a href="#l13.373"></a><span id="l13.373">     return NS_OK;</span>
<a href="#l13.374"></a><span id="l13.374" class="difflineat">@@ -434,19 +348,18 @@ nsNetscapeProfileMigratorBase::CopyFile(</span>
<a href="#l13.375"></a><span id="l13.375"> </span>
<a href="#l13.376"></a><span id="l13.376">   return sourceFile-&gt;CopyToNative(mTargetProfile,</span>
<a href="#l13.377"></a><span id="l13.377">                                   nsDependentCString(aTargetFileName));</span>
<a href="#l13.378"></a><span id="l13.378"> }</span>
<a href="#l13.379"></a><span id="l13.379"> </span>
<a href="#l13.380"></a><span id="l13.380"> // helper function, copies the contents of srcDir into destDir.</span>
<a href="#l13.381"></a><span id="l13.381"> // destDir will be created if it doesn't exist.</span>
<a href="#l13.382"></a><span id="l13.382"> nsresult</span>
<a href="#l13.383"></a><span id="l13.383" class="difflineminus">-nsNetscapeProfileMigratorBase::RecursiveCopy(nsIFile* srcDir,</span>
<a href="#l13.384"></a><span id="l13.384" class="difflineminus">-                                             nsIFile* destDir)</span>
<a href="#l13.385"></a><span id="l13.385" class="difflineminus">-{</span>
<a href="#l13.386"></a><span id="l13.386" class="difflineplus">+nsSuiteProfileMigratorBase::RecursiveCopy(nsIFile* srcDir,</span>
<a href="#l13.387"></a><span id="l13.387" class="difflineplus">+                                          nsIFile* destDir) {</span>
<a href="#l13.388"></a><span id="l13.388">   bool exists;</span>
<a href="#l13.389"></a><span id="l13.389">   nsresult rv = srcDir-&gt;Exists(&amp;exists);</span>
<a href="#l13.390"></a><span id="l13.390">   NS_ENSURE_SUCCESS(rv, rv);</span>
<a href="#l13.391"></a><span id="l13.391"> </span>
<a href="#l13.392"></a><span id="l13.392">   if (!exists)</span>
<a href="#l13.393"></a><span id="l13.393">     // We do not want to fail if the source folder does not exist because then</span>
<a href="#l13.394"></a><span id="l13.394">     // parts of the migration process following this would not get executed</span>
<a href="#l13.395"></a><span id="l13.395">     return NS_OK;</span>
<a href="#l13.396"></a><span id="l13.396" class="difflineat">@@ -504,20 +417,19 @@ nsNetscapeProfileMigratorBase::Recursive</span>
<a href="#l13.397"></a><span id="l13.397">       }</span>
<a href="#l13.398"></a><span id="l13.398">     }</span>
<a href="#l13.399"></a><span id="l13.399">   }</span>
<a href="#l13.400"></a><span id="l13.400"> </span>
<a href="#l13.401"></a><span id="l13.401">   return rv;</span>
<a href="#l13.402"></a><span id="l13.402"> }</span>
<a href="#l13.403"></a><span id="l13.403"> </span>
<a href="#l13.404"></a><span id="l13.404"> void</span>
<a href="#l13.405"></a><span id="l13.405" class="difflineminus">-nsNetscapeProfileMigratorBase::ReadBranch(const char * branchName,</span>
<a href="#l13.406"></a><span id="l13.406" class="difflineminus">-                                          nsIPrefService* aPrefService,</span>
<a href="#l13.407"></a><span id="l13.407" class="difflineminus">-                                          PBStructArray &amp;aPrefs)</span>
<a href="#l13.408"></a><span id="l13.408" class="difflineminus">-{</span>
<a href="#l13.409"></a><span id="l13.409" class="difflineplus">+nsSuiteProfileMigratorBase::ReadBranch(const char * branchName,</span>
<a href="#l13.410"></a><span id="l13.410" class="difflineplus">+                                       nsIPrefService* aPrefService,</span>
<a href="#l13.411"></a><span id="l13.411" class="difflineplus">+                                       PBStructArray &amp;aPrefs) {</span>
<a href="#l13.412"></a><span id="l13.412">   // Enumerate the branch</span>
<a href="#l13.413"></a><span id="l13.413">   nsCOMPtr&lt;nsIPrefBranch&gt; branch;</span>
<a href="#l13.414"></a><span id="l13.414">   aPrefService-&gt;GetBranch(branchName, getter_AddRefs(branch));</span>
<a href="#l13.415"></a><span id="l13.415"> </span>
<a href="#l13.416"></a><span id="l13.416">   nsTArray&lt;nsCString&gt; prefs;</span>
<a href="#l13.417"></a><span id="l13.417"> </span>
<a href="#l13.418"></a><span id="l13.418">   nsresult rv = branch-&gt;GetChildList(&quot;&quot;, prefs);</span>
<a href="#l13.419"></a><span id="l13.419">   if (NS_FAILED(rv))</span>
<a href="#l13.420"></a><span id="l13.420" class="difflineat">@@ -548,30 +460,29 @@ nsNetscapeProfileMigratorBase::ReadBranc</span>
<a href="#l13.421"></a><span id="l13.421">     case nsIPrefBranch::PREF_BOOL:</span>
<a href="#l13.422"></a><span id="l13.422">       rv = branch-&gt;GetBoolPref(currPref, &amp;prefBranch-&gt;boolValue);</span>
<a href="#l13.423"></a><span id="l13.423">       break;</span>
<a href="#l13.424"></a><span id="l13.424">     case nsIPrefBranch::PREF_INT:</span>
<a href="#l13.425"></a><span id="l13.425">       rv = branch-&gt;GetIntPref(currPref, &amp;prefBranch-&gt;intValue);</span>
<a href="#l13.426"></a><span id="l13.426">       break;</span>
<a href="#l13.427"></a><span id="l13.427">     default:</span>
<a href="#l13.428"></a><span id="l13.428">       NS_WARNING(&quot;Invalid prefBranch Type in &quot;</span>
<a href="#l13.429"></a><span id="l13.429" class="difflineminus">-                 &quot;nsNetscapeProfileMigratorBase::ReadBranch\n&quot;);</span>
<a href="#l13.430"></a><span id="l13.430" class="difflineplus">+                 &quot;nsSuiteProfileMigratorBase::ReadBranch\n&quot;);</span>
<a href="#l13.431"></a><span id="l13.431">       break;</span>
<a href="#l13.432"></a><span id="l13.432">     }</span>
<a href="#l13.433"></a><span id="l13.433"> </span>
<a href="#l13.434"></a><span id="l13.434">     if (NS_SUCCEEDED(rv))</span>
<a href="#l13.435"></a><span id="l13.435">       aPrefs.AppendElement(prefBranch);</span>
<a href="#l13.436"></a><span id="l13.436">   }</span>
<a href="#l13.437"></a><span id="l13.437"> }</span>
<a href="#l13.438"></a><span id="l13.438"> </span>
<a href="#l13.439"></a><span id="l13.439"> void</span>
<a href="#l13.440"></a><span id="l13.440" class="difflineminus">-nsNetscapeProfileMigratorBase::WriteBranch(const char * branchName,</span>
<a href="#l13.441"></a><span id="l13.441" class="difflineminus">-                                           nsIPrefService* aPrefService,</span>
<a href="#l13.442"></a><span id="l13.442" class="difflineminus">-                                           PBStructArray &amp;aPrefs)</span>
<a href="#l13.443"></a><span id="l13.443" class="difflineminus">-{</span>
<a href="#l13.444"></a><span id="l13.444" class="difflineplus">+nsSuiteProfileMigratorBase::WriteBranch(const char * branchName,</span>
<a href="#l13.445"></a><span id="l13.445" class="difflineplus">+                                        nsIPrefService* aPrefService,</span>
<a href="#l13.446"></a><span id="l13.446" class="difflineplus">+                                        PBStructArray &amp;aPrefs) {</span>
<a href="#l13.447"></a><span id="l13.447">   // Enumerate the branch</span>
<a href="#l13.448"></a><span id="l13.448">   nsCOMPtr&lt;nsIPrefBranch&gt; branch;</span>
<a href="#l13.449"></a><span id="l13.449">   aPrefService-&gt;GetBranch(branchName, getter_AddRefs(branch));</span>
<a href="#l13.450"></a><span id="l13.450"> </span>
<a href="#l13.451"></a><span id="l13.451">   uint32_t count = aPrefs.Length();</span>
<a href="#l13.452"></a><span id="l13.452">   for (uint32_t i = 0; i &lt; count; ++i) {</span>
<a href="#l13.453"></a><span id="l13.453">     PrefBranchStruct* pref = aPrefs.ElementAt(i);</span>
<a href="#l13.454"></a><span id="l13.454"> </span>
<a href="#l13.455"></a><span id="l13.455" class="difflineat">@@ -586,30 +497,32 @@ nsNetscapeProfileMigratorBase::WriteBran</span>
<a href="#l13.456"></a><span id="l13.456">     case nsIPrefBranch::PREF_BOOL:</span>
<a href="#l13.457"></a><span id="l13.457">       branch-&gt;SetBoolPref(pref-&gt;prefName, pref-&gt;boolValue);</span>
<a href="#l13.458"></a><span id="l13.458">       break;</span>
<a href="#l13.459"></a><span id="l13.459">     case nsIPrefBranch::PREF_INT:</span>
<a href="#l13.460"></a><span id="l13.460">       branch-&gt;SetIntPref(pref-&gt;prefName, pref-&gt;intValue);</span>
<a href="#l13.461"></a><span id="l13.461">       break;</span>
<a href="#l13.462"></a><span id="l13.462">     default:</span>
<a href="#l13.463"></a><span id="l13.463">       NS_WARNING(&quot;Invalid Pref Type in &quot;</span>
<a href="#l13.464"></a><span id="l13.464" class="difflineminus">-                 &quot;nsNetscapeProfileMigratorBase::WriteBranch\n&quot;);</span>
<a href="#l13.465"></a><span id="l13.465" class="difflineplus">+                 &quot;nsSuiteProfileMigratorBase::WriteBranch\n&quot;);</span>
<a href="#l13.466"></a><span id="l13.466">       break;</span>
<a href="#l13.467"></a><span id="l13.467">     }</span>
<a href="#l13.468"></a><span id="l13.468">     free(pref-&gt;prefName);</span>
<a href="#l13.469"></a><span id="l13.469">     pref-&gt;prefName = nullptr;</span>
<a href="#l13.470"></a><span id="l13.470">     delete pref;</span>
<a href="#l13.471"></a><span id="l13.471">     pref = nullptr;</span>
<a href="#l13.472"></a><span id="l13.472">   }</span>
<a href="#l13.473"></a><span id="l13.473">   aPrefs.Clear();</span>
<a href="#l13.474"></a><span id="l13.474"> }</span>
<a href="#l13.475"></a><span id="l13.475"> </span>
<a href="#l13.476"></a><span id="l13.476"> nsresult</span>
<a href="#l13.477"></a><span id="l13.477" class="difflineminus">-nsNetscapeProfileMigratorBase::GetFileValue(nsIPrefBranch* aPrefBranch, const char* aRelPrefName, const char* aPrefName, nsIFile** aReturnFile)</span>
<a href="#l13.478"></a><span id="l13.478" class="difflineminus">-{</span>
<a href="#l13.479"></a><span id="l13.479" class="difflineplus">+nsSuiteProfileMigratorBase::GetFileValue(nsIPrefBranch* aPrefBranch,</span>
<a href="#l13.480"></a><span id="l13.480" class="difflineplus">+                                         const char* aRelPrefName,</span>
<a href="#l13.481"></a><span id="l13.481" class="difflineplus">+                                         const char* aPrefName,</span>
<a href="#l13.482"></a><span id="l13.482" class="difflineplus">+                                         nsIFile** aReturnFile) {</span>
<a href="#l13.483"></a><span id="l13.483">   nsCString prefValue;</span>
<a href="#l13.484"></a><span id="l13.484">   nsCOMPtr&lt;nsIFile&gt; theFile;</span>
<a href="#l13.485"></a><span id="l13.485">   nsresult rv = aPrefBranch-&gt;GetCharPref(aRelPrefName, prefValue);</span>
<a href="#l13.486"></a><span id="l13.486">   if (NS_SUCCEEDED(rv)) {</span>
<a href="#l13.487"></a><span id="l13.487">     // The pref has the format: [ProfD]a/b/c</span>
<a href="#l13.488"></a><span id="l13.488">     if (!StringBeginsWith(prefValue, NS_LITERAL_CSTRING(&quot;[ProfD]&quot;)))</span>
<a href="#l13.489"></a><span id="l13.489">       return NS_ERROR_FILE_NOT_FOUND;</span>
<a href="#l13.490"></a><span id="l13.490"> </span>
<a href="#l13.491"></a><span id="l13.491" class="difflineat">@@ -626,125 +539,21 @@ nsNetscapeProfileMigratorBase::GetFileVa</span>
<a href="#l13.492"></a><span id="l13.492">                                       getter_AddRefs(theFile));</span>
<a href="#l13.493"></a><span id="l13.493">   }</span>
<a href="#l13.494"></a><span id="l13.494"> </span>
<a href="#l13.495"></a><span id="l13.495">   theFile.forget(aReturnFile);</span>
<a href="#l13.496"></a><span id="l13.496">   return rv;</span>
<a href="#l13.497"></a><span id="l13.497"> }</span>
<a href="#l13.498"></a><span id="l13.498"> </span>
<a href="#l13.499"></a><span id="l13.499"> ///////////////////////////////////////////////////////////////////////////////</span>
<a href="#l13.500"></a><span id="l13.500" class="difflineminus">-// Generic Import Functions</span>
<a href="#l13.501"></a><span id="l13.501" class="difflineminus">-</span>
<a href="#l13.502"></a><span id="l13.502" class="difflineminus">-nsresult</span>
<a href="#l13.503"></a><span id="l13.503" class="difflineminus">-nsNetscapeProfileMigratorBase::CopyCookies(bool aReplace)</span>
<a href="#l13.504"></a><span id="l13.504" class="difflineminus">-{</span>
<a href="#l13.505"></a><span id="l13.505" class="difflineminus">-  if (aReplace) {</span>
<a href="#l13.506"></a><span id="l13.506" class="difflineminus">-    // can't start the cookieservice, so just push files around:</span>
<a href="#l13.507"></a><span id="l13.507" class="difflineminus">-    // 1) remove target cookies.sqlite file if it exists, to force import</span>
<a href="#l13.508"></a><span id="l13.508" class="difflineminus">-    // 2) copy source cookies.txt file, which will be imported on startup</span>
<a href="#l13.509"></a><span id="l13.509" class="difflineminus">-    nsCOMPtr&lt;nsIFile&gt; targetFile;</span>
<a href="#l13.510"></a><span id="l13.510" class="difflineminus">-    mTargetProfile-&gt;Clone(getter_AddRefs(targetFile));</span>
<a href="#l13.511"></a><span id="l13.511" class="difflineminus">-    targetFile-&gt;AppendNative(NS_LITERAL_CSTRING(FILE_NAME_COOKIES_SQLITE));</span>
<a href="#l13.512"></a><span id="l13.512" class="difflineminus">-    targetFile-&gt;Remove(false);</span>
<a href="#l13.513"></a><span id="l13.513" class="difflineminus">-</span>
<a href="#l13.514"></a><span id="l13.514" class="difflineminus">-    return CopyFile(FILE_NAME_COOKIES, FILE_NAME_COOKIES);</span>
<a href="#l13.515"></a><span id="l13.515" class="difflineminus">-  }</span>
<a href="#l13.516"></a><span id="l13.516" class="difflineminus">-</span>
<a href="#l13.517"></a><span id="l13.517" class="difflineminus">-  nsresult rv;</span>
<a href="#l13.518"></a><span id="l13.518" class="difflineminus">-  nsCOMPtr&lt;nsICookieManager&gt; cookieManager(do_GetService(NS_COOKIEMANAGER_CONTRACTID, &amp;rv));</span>
<a href="#l13.519"></a><span id="l13.519" class="difflineminus">-  if (NS_FAILED(rv))</span>
<a href="#l13.520"></a><span id="l13.520" class="difflineminus">-    return rv;</span>
<a href="#l13.521"></a><span id="l13.521" class="difflineminus">-</span>
<a href="#l13.522"></a><span id="l13.522" class="difflineminus">-  nsCOMPtr&lt;nsIFile&gt; seamonkeyCookiesFile;</span>
<a href="#l13.523"></a><span id="l13.523" class="difflineminus">-  mSourceProfile-&gt;Clone(getter_AddRefs(seamonkeyCookiesFile));</span>
<a href="#l13.524"></a><span id="l13.524" class="difflineminus">-  seamonkeyCookiesFile-&gt;AppendNative(NS_LITERAL_CSTRING(FILE_NAME_COOKIES));</span>
<a href="#l13.525"></a><span id="l13.525" class="difflineminus">-</span>
<a href="#l13.526"></a><span id="l13.526" class="difflineminus">-  return cookieManager-&gt;ImportCookies(seamonkeyCookiesFile);</span>
<a href="#l13.527"></a><span id="l13.527" class="difflineminus">-}</span>
<a href="#l13.528"></a><span id="l13.528" class="difflineminus">-</span>
<a href="#l13.529"></a><span id="l13.529" class="difflineminus">-nsresult</span>
<a href="#l13.530"></a><span id="l13.530" class="difflineminus">-nsNetscapeProfileMigratorBase::CopyUserSheet(const char* aFileName)</span>
<a href="#l13.531"></a><span id="l13.531" class="difflineminus">-{</span>
<a href="#l13.532"></a><span id="l13.532" class="difflineminus">-  nsCOMPtr&lt;nsIFile&gt; sourceUserContent;</span>
<a href="#l13.533"></a><span id="l13.533" class="difflineminus">-  mSourceProfile-&gt;Clone(getter_AddRefs(sourceUserContent));</span>
<a href="#l13.534"></a><span id="l13.534" class="difflineminus">-  sourceUserContent-&gt;Append(DIR_NAME_CHROME);</span>
<a href="#l13.535"></a><span id="l13.535" class="difflineminus">-  sourceUserContent-&gt;AppendNative(nsDependentCString(aFileName));</span>
<a href="#l13.536"></a><span id="l13.536" class="difflineminus">-</span>
<a href="#l13.537"></a><span id="l13.537" class="difflineminus">-  bool exists = false;</span>
<a href="#l13.538"></a><span id="l13.538" class="difflineminus">-  sourceUserContent-&gt;Exists(&amp;exists);</span>
<a href="#l13.539"></a><span id="l13.539" class="difflineminus">-  if (!exists)</span>
<a href="#l13.540"></a><span id="l13.540" class="difflineminus">-    return NS_OK;</span>
<a href="#l13.541"></a><span id="l13.541" class="difflineminus">-</span>
<a href="#l13.542"></a><span id="l13.542" class="difflineminus">-  nsCOMPtr&lt;nsIFile&gt; targetUserContent;</span>
<a href="#l13.543"></a><span id="l13.543" class="difflineminus">-  mTargetProfile-&gt;Clone(getter_AddRefs(targetUserContent));</span>
<a href="#l13.544"></a><span id="l13.544" class="difflineminus">-  targetUserContent-&gt;Append(DIR_NAME_CHROME);</span>
<a href="#l13.545"></a><span id="l13.545" class="difflineminus">-  nsCOMPtr&lt;nsIFile&gt; targetChromeDir;</span>
<a href="#l13.546"></a><span id="l13.546" class="difflineminus">-  targetUserContent-&gt;Clone(getter_AddRefs(targetChromeDir));</span>
<a href="#l13.547"></a><span id="l13.547" class="difflineminus">-  targetUserContent-&gt;AppendNative(nsDependentCString(aFileName));</span>
<a href="#l13.548"></a><span id="l13.548" class="difflineminus">-</span>
<a href="#l13.549"></a><span id="l13.549" class="difflineminus">-  targetUserContent-&gt;Exists(&amp;exists);</span>
<a href="#l13.550"></a><span id="l13.550" class="difflineminus">-  if (exists)</span>
<a href="#l13.551"></a><span id="l13.551" class="difflineminus">-    targetUserContent-&gt;Remove(false);</span>
<a href="#l13.552"></a><span id="l13.552" class="difflineminus">-</span>
<a href="#l13.553"></a><span id="l13.553" class="difflineminus">-  return sourceUserContent-&gt;CopyToNative(targetChromeDir,</span>
<a href="#l13.554"></a><span id="l13.554" class="difflineminus">-                                         nsDependentCString(aFileName));</span>
<a href="#l13.555"></a><span id="l13.555" class="difflineminus">-}</span>
<a href="#l13.556"></a><span id="l13.556" class="difflineminus">-</span>
<a href="#l13.557"></a><span id="l13.557" class="difflineminus">-///////////////////////////////////////////////////////////////////////////////</span>
<a href="#l13.558"></a><span id="l13.558" class="difflineminus">-// Browser Import Functions</span>
<a href="#l13.559"></a><span id="l13.559" class="difflineminus">-</span>
<a href="#l13.560"></a><span id="l13.560" class="difflineminus">-nsresult</span>
<a href="#l13.561"></a><span id="l13.561" class="difflineminus">-nsNetscapeProfileMigratorBase::CopyBookmarks(bool aReplace)</span>
<a href="#l13.562"></a><span id="l13.562" class="difflineminus">-{</span>
<a href="#l13.563"></a><span id="l13.563" class="difflineminus">-  if (aReplace)</span>
<a href="#l13.564"></a><span id="l13.564" class="difflineminus">-    return CopyFile(FILE_NAME_BOOKMARKS, FILE_NAME_BOOKMARKS);</span>
<a href="#l13.565"></a><span id="l13.565" class="difflineminus">-</span>
<a href="#l13.566"></a><span id="l13.566" class="difflineminus">-  return ImportNetscapeBookmarks(FILE_NAME_BOOKMARKS, &quot;sourceNameSeamonkey&quot;);</span>
<a href="#l13.567"></a><span id="l13.567" class="difflineminus">-}</span>
<a href="#l13.568"></a><span id="l13.568" class="difflineminus">-</span>
<a href="#l13.569"></a><span id="l13.569" class="difflineminus">-nsresult</span>
<a href="#l13.570"></a><span id="l13.570" class="difflineminus">-nsNetscapeProfileMigratorBase::CopyOtherData(bool aReplace)</span>
<a href="#l13.571"></a><span id="l13.571" class="difflineminus">-{</span>
<a href="#l13.572"></a><span id="l13.572" class="difflineminus">-  if (!aReplace)</span>
<a href="#l13.573"></a><span id="l13.573" class="difflineminus">-    return NS_OK;</span>
<a href="#l13.574"></a><span id="l13.574" class="difflineminus">-</span>
<a href="#l13.575"></a><span id="l13.575" class="difflineminus">-  nsCOMPtr&lt;nsIFile&gt; sourceSearchDir;</span>
<a href="#l13.576"></a><span id="l13.576" class="difflineminus">-  mSourceProfile-&gt;Clone(getter_AddRefs(sourceSearchDir));</span>
<a href="#l13.577"></a><span id="l13.577" class="difflineminus">-  sourceSearchDir-&gt;AppendNative(nsDependentCString(DIR_NAME_SEARCH));</span>
<a href="#l13.578"></a><span id="l13.578" class="difflineminus">-</span>
<a href="#l13.579"></a><span id="l13.579" class="difflineminus">-  nsCOMPtr&lt;nsIFile&gt; targetSearchDir;</span>
<a href="#l13.580"></a><span id="l13.580" class="difflineminus">-  mTargetProfile-&gt;Clone(getter_AddRefs(targetSearchDir));</span>
<a href="#l13.581"></a><span id="l13.581" class="difflineminus">-  targetSearchDir-&gt;AppendNative(nsDependentCString(DIR_NAME_SEARCH));</span>
<a href="#l13.582"></a><span id="l13.582" class="difflineminus">-</span>
<a href="#l13.583"></a><span id="l13.583" class="difflineminus">-  nsresult rv = RecursiveCopy(sourceSearchDir, targetSearchDir);</span>
<a href="#l13.584"></a><span id="l13.584" class="difflineminus">-  if (NS_FAILED(rv))</span>
<a href="#l13.585"></a><span id="l13.585" class="difflineminus">-    return rv;</span>
<a href="#l13.586"></a><span id="l13.586" class="difflineminus">-</span>
<a href="#l13.587"></a><span id="l13.587" class="difflineminus">-  return CopyFile(FILE_NAME_DOWNLOADS, FILE_NAME_DOWNLOADS);</span>
<a href="#l13.588"></a><span id="l13.588" class="difflineminus">-}</span>
<a href="#l13.589"></a><span id="l13.589" class="difflineminus">-</span>
<a href="#l13.590"></a><span id="l13.590" class="difflineminus">-nsresult</span>
<a href="#l13.591"></a><span id="l13.591" class="difflineminus">-nsNetscapeProfileMigratorBase::ImportNetscapeBookmarks(const char* aBookmarksFileName,</span>
<a href="#l13.592"></a><span id="l13.592" class="difflineminus">-                                                       const char* aImportSourceNameKey)</span>
<a href="#l13.593"></a><span id="l13.593" class="difflineminus">-{</span>
<a href="#l13.594"></a><span id="l13.594" class="difflineminus">-  nsCOMPtr&lt;nsIFile&gt; bookmarksFile;</span>
<a href="#l13.595"></a><span id="l13.595" class="difflineminus">-  mSourceProfile-&gt;Clone(getter_AddRefs(bookmarksFile));</span>
<a href="#l13.596"></a><span id="l13.596" class="difflineminus">-  bookmarksFile-&gt;AppendNative(nsDependentCString(aBookmarksFileName));</span>
<a href="#l13.597"></a><span id="l13.597" class="difflineminus">-</span>
<a href="#l13.598"></a><span id="l13.598" class="difflineminus">-  return ImportBookmarksHTML(bookmarksFile,</span>
<a href="#l13.599"></a><span id="l13.599" class="difflineminus">-                             NS_ConvertUTF8toUTF16(aImportSourceNameKey).get());</span>
<a href="#l13.600"></a><span id="l13.600" class="difflineminus">-}</span>
<a href="#l13.601"></a><span id="l13.601" class="difflineminus">-</span>
<a href="#l13.602"></a><span id="l13.602" class="difflineminus">-///////////////////////////////////////////////////////////////////////////////</span>
<a href="#l13.603"></a><span id="l13.603"> // Mail Import Functions</span>
<a href="#l13.604"></a><span id="l13.604"> </span>
<a href="#l13.605"></a><span id="l13.605"> nsresult</span>
<a href="#l13.606"></a><span id="l13.606" class="difflineminus">-nsNetscapeProfileMigratorBase::CopyAddressBookDirectories(PBStructArray &amp;aLdapServers,</span>
<a href="#l13.607"></a><span id="l13.607" class="difflineminus">-                                                          nsIPrefService* aPrefService)</span>
<a href="#l13.608"></a><span id="l13.608" class="difflineminus">-{</span>
<a href="#l13.609"></a><span id="l13.609" class="difflineplus">+nsSuiteProfileMigratorBase::CopyAddressBookDirectories(PBStructArray &amp;aLdapServers,</span>
<a href="#l13.610"></a><span id="l13.610" class="difflineplus">+                                                       nsIPrefService* aPrefService) {</span>
<a href="#l13.611"></a><span id="l13.611">   // each server has a pref ending with .filename. The value of that pref</span>
<a href="#l13.612"></a><span id="l13.612">   // points to a profile which we need to migrate.</span>
<a href="#l13.613"></a><span id="l13.613">   nsAutoString index;</span>
<a href="#l13.614"></a><span id="l13.614">   index.AppendInt(nsISuiteProfileMigrator::ADDRESSBOOK_DATA);</span>
<a href="#l13.615"></a><span id="l13.615">   NOTIFY_OBSERVERS(MIGRATION_ITEMBEFOREMIGRATE, index.get());</span>
<a href="#l13.616"></a><span id="l13.616"> </span>
<a href="#l13.617"></a><span id="l13.617">   uint32_t count = aLdapServers.Length();</span>
<a href="#l13.618"></a><span id="l13.618">   for (uint32_t i = 0; i &lt; count; ++i) {</span>
<a href="#l13.619"></a><span id="l13.619" class="difflineat">@@ -759,19 +568,18 @@ nsNetscapeProfileMigratorBase::CopyAddre</span>
<a href="#l13.620"></a><span id="l13.620">   }</span>
<a href="#l13.621"></a><span id="l13.621"> </span>
<a href="#l13.622"></a><span id="l13.622">   NOTIFY_OBSERVERS(MIGRATION_ITEMAFTERMIGRATE, index.get());</span>
<a href="#l13.623"></a><span id="l13.623"> </span>
<a href="#l13.624"></a><span id="l13.624">   return NS_OK;</span>
<a href="#l13.625"></a><span id="l13.625"> }</span>
<a href="#l13.626"></a><span id="l13.626"> </span>
<a href="#l13.627"></a><span id="l13.627"> nsresult</span>
<a href="#l13.628"></a><span id="l13.628" class="difflineminus">-nsNetscapeProfileMigratorBase::CopySignatureFiles(PBStructArray &amp;aIdentities,</span>
<a href="#l13.629"></a><span id="l13.629" class="difflineminus">-                                                  nsIPrefService* aPrefService)</span>
<a href="#l13.630"></a><span id="l13.630" class="difflineminus">-{</span>
<a href="#l13.631"></a><span id="l13.631" class="difflineplus">+nsSuiteProfileMigratorBase::CopySignatureFiles(PBStructArray &amp;aIdentities,</span>
<a href="#l13.632"></a><span id="l13.632" class="difflineplus">+                                               nsIPrefService* aPrefService) {</span>
<a href="#l13.633"></a><span id="l13.633">   nsresult rv = NS_OK;</span>
<a href="#l13.634"></a><span id="l13.634"> </span>
<a href="#l13.635"></a><span id="l13.635">   uint32_t count = aIdentities.Length();</span>
<a href="#l13.636"></a><span id="l13.636">   for (uint32_t i = 0; i &lt; count; ++i)</span>
<a href="#l13.637"></a><span id="l13.637">   {</span>
<a href="#l13.638"></a><span id="l13.638">     PrefBranchStruct* pref = aIdentities.ElementAt(i);</span>
<a href="#l13.639"></a><span id="l13.639">     nsDependentCString prefName(pref-&gt;prefName);</span>
<a href="#l13.640"></a><span id="l13.640"> </span>
<a href="#l13.641"></a><span id="l13.641" class="difflineat">@@ -812,26 +620,25 @@ nsNetscapeProfileMigratorBase::CopySigna</span>
<a href="#l13.642"></a><span id="l13.642">         pref-&gt;stringValue = ToNewCString(descriptorString);</span>
<a href="#l13.643"></a><span id="l13.643">       }</span>
<a href="#l13.644"></a><span id="l13.644">     }</span>
<a href="#l13.645"></a><span id="l13.645">   }</span>
<a href="#l13.646"></a><span id="l13.646">   return NS_OK;</span>
<a href="#l13.647"></a><span id="l13.647"> }</span>
<a href="#l13.648"></a><span id="l13.648"> </span>
<a href="#l13.649"></a><span id="l13.649"> nsresult</span>
<a href="#l13.650"></a><span id="l13.650" class="difflineminus">-nsNetscapeProfileMigratorBase::CopyJunkTraining(bool aReplace)</span>
<a href="#l13.651"></a><span id="l13.651" class="difflineplus">+nsSuiteProfileMigratorBase::CopyJunkTraining(bool aReplace)</span>
<a href="#l13.652"></a><span id="l13.652"> {</span>
<a href="#l13.653"></a><span id="l13.653">   return aReplace ? CopyFile(FILE_NAME_JUNKTRAINING,</span>
<a href="#l13.654"></a><span id="l13.654">                              FILE_NAME_JUNKTRAINING) : NS_OK;</span>
<a href="#l13.655"></a><span id="l13.655"> }</span>
<a href="#l13.656"></a><span id="l13.656"> </span>
<a href="#l13.657"></a><span id="l13.657"> nsresult</span>
<a href="#l13.658"></a><span id="l13.658" class="difflineminus">-nsNetscapeProfileMigratorBase::CopyMailFolderPrefs(PBStructArray &amp;aMailServers,</span>
<a href="#l13.659"></a><span id="l13.659" class="difflineminus">-                                                   nsIPrefService* aPrefService)</span>
<a href="#l13.660"></a><span id="l13.660" class="difflineminus">-{</span>
<a href="#l13.661"></a><span id="l13.661" class="difflineplus">+nsSuiteProfileMigratorBase::CopyMailFolderPrefs(PBStructArray &amp;aMailServers,</span>
<a href="#l13.662"></a><span id="l13.662" class="difflineplus">+                                                nsIPrefService* aPrefService) {</span>
<a href="#l13.663"></a><span id="l13.663">   // Each server has a .directory pref which points to the location of the</span>
<a href="#l13.664"></a><span id="l13.664">   // mail data for that server. We need to do two things for that case...</span>
<a href="#l13.665"></a><span id="l13.665">   // (1) Fix up the directory path for the new profile</span>
<a href="#l13.666"></a><span id="l13.666">   // (2) copy the mail folder data from the source directory pref to the</span>
<a href="#l13.667"></a><span id="l13.667">   //     destination directory pref</span>
<a href="#l13.668"></a><span id="l13.668">   CopyFile(FILE_NAME_VIRTUALFOLDERS, FILE_NAME_VIRTUALFOLDERS);</span>
<a href="#l13.669"></a><span id="l13.669"> </span>
<a href="#l13.670"></a><span id="l13.670">   int32_t count = aMailServers.Length();</span>
<a href="#l13.671"></a><span id="l13.671" class="difflineat">@@ -951,18 +758,17 @@ nsNetscapeProfileMigratorBase::CopyMailF</span>
<a href="#l13.672"></a><span id="l13.672">       aMailServers.RemoveElementAt(i);</span>
<a href="#l13.673"></a><span id="l13.673">     }</span>
<a href="#l13.674"></a><span id="l13.674">   }</span>
<a href="#l13.675"></a><span id="l13.675"> </span>
<a href="#l13.676"></a><span id="l13.676">   return NS_OK;</span>
<a href="#l13.677"></a><span id="l13.677"> }</span>
<a href="#l13.678"></a><span id="l13.678"> </span>
<a href="#l13.679"></a><span id="l13.679"> void</span>
<a href="#l13.680"></a><span id="l13.680" class="difflineminus">-nsNetscapeProfileMigratorBase::CopyMailFolders()</span>
<a href="#l13.681"></a><span id="l13.681" class="difflineminus">-{</span>
<a href="#l13.682"></a><span id="l13.682" class="difflineplus">+nsSuiteProfileMigratorBase::CopyMailFolders() {</span>
<a href="#l13.683"></a><span id="l13.683">   nsAutoString index;</span>
<a href="#l13.684"></a><span id="l13.684">   index.AppendInt(nsISuiteProfileMigrator::MAILDATA);</span>
<a href="#l13.685"></a><span id="l13.685">   NOTIFY_OBSERVERS(MIGRATION_ITEMBEFOREMIGRATE, index.get());</span>
<a href="#l13.686"></a><span id="l13.686"> </span>
<a href="#l13.687"></a><span id="l13.687">   // Generate the max progress value now that we know all of the files we</span>
<a href="#l13.688"></a><span id="l13.688">   // need to copy</span>
<a href="#l13.689"></a><span id="l13.689">   uint32_t count = mFileCopyTransactions.Length();</span>
<a href="#l13.690"></a><span id="l13.690">   mMaxProgress = 0;</span>
<a href="#l13.691"></a><span id="l13.691" class="difflineat">@@ -974,18 +780,17 @@ nsNetscapeProfileMigratorBase::CopyMailF</span>
<a href="#l13.692"></a><span id="l13.692">     fileTransaction.srcFile-&gt;GetFileSize(&amp;fileSize);</span>
<a href="#l13.693"></a><span id="l13.693">     mMaxProgress += fileSize;</span>
<a href="#l13.694"></a><span id="l13.694">   }</span>
<a href="#l13.695"></a><span id="l13.695"> </span>
<a href="#l13.696"></a><span id="l13.696">   CopyNextFolder();</span>
<a href="#l13.697"></a><span id="l13.697"> }</span>
<a href="#l13.698"></a><span id="l13.698"> </span>
<a href="#l13.699"></a><span id="l13.699"> void</span>
<a href="#l13.700"></a><span id="l13.700" class="difflineminus">-nsNetscapeProfileMigratorBase::CopyNextFolder()</span>
<a href="#l13.701"></a><span id="l13.701" class="difflineminus">-{</span>
<a href="#l13.702"></a><span id="l13.702" class="difflineplus">+nsSuiteProfileMigratorBase::CopyNextFolder() {</span>
<a href="#l13.703"></a><span id="l13.703">   if (mFileCopyTransactionIndex &lt; mFileCopyTransactions.Length()) {</span>
<a href="#l13.704"></a><span id="l13.704">     fileTransactionEntry fileTransaction =</span>
<a href="#l13.705"></a><span id="l13.705">       mFileCopyTransactions.ElementAt(mFileCopyTransactionIndex++);</span>
<a href="#l13.706"></a><span id="l13.706"> </span>
<a href="#l13.707"></a><span id="l13.707">     // copy the file</span>
<a href="#l13.708"></a><span id="l13.708">     fileTransaction.srcFile-&gt;CopyTo(fileTransaction.destFile,</span>
<a href="#l13.709"></a><span id="l13.709">                                     EmptyString());</span>
<a href="#l13.710"></a><span id="l13.710"> </span>
<a href="#l13.711"></a><span id="l13.711" class="difflineat">@@ -1016,18 +821,17 @@ nsNetscapeProfileMigratorBase::CopyNextF</span>
<a href="#l13.712"></a><span id="l13.712">   }</span>
<a href="#l13.713"></a><span id="l13.713">   else</span>
<a href="#l13.714"></a><span id="l13.714">     EndCopyFolders();</span>
<a href="#l13.715"></a><span id="l13.715"> </span>
<a href="#l13.716"></a><span id="l13.716">   return;</span>
<a href="#l13.717"></a><span id="l13.717"> }</span>
<a href="#l13.718"></a><span id="l13.718"> </span>
<a href="#l13.719"></a><span id="l13.719"> void</span>
<a href="#l13.720"></a><span id="l13.720" class="difflineminus">-nsNetscapeProfileMigratorBase::EndCopyFolders()</span>
<a href="#l13.721"></a><span id="l13.721" class="difflineminus">-{</span>
<a href="#l13.722"></a><span id="l13.722" class="difflineplus">+nsSuiteProfileMigratorBase::EndCopyFolders() {</span>
<a href="#l13.723"></a><span id="l13.723">   mFileCopyTransactions.Clear();</span>
<a href="#l13.724"></a><span id="l13.724">   mFileCopyTransactionIndex = 0;</span>
<a href="#l13.725"></a><span id="l13.725"> </span>
<a href="#l13.726"></a><span id="l13.726">   // notify the UI that we are done with the migration process</span>
<a href="#l13.727"></a><span id="l13.727">   nsAutoString index;</span>
<a href="#l13.728"></a><span id="l13.728">   index.AppendInt(nsISuiteProfileMigrator::MAILDATA);</span>
<a href="#l13.729"></a><span id="l13.729">   NOTIFY_OBSERVERS(MIGRATION_ITEMAFTERMIGRATE, index.get());</span>
<a href="#l13.730"></a><span id="l13.730"> </span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l14.1"></a><span id="l14.1">rename from suite/components/profile/nsNetscapeProfileMigratorBase.h</span>
<a href="#l14.2"></a><span id="l14.2">rename to suite/components/migration/src/nsSuiteProfileMigratorBase.h</span>
<a href="#l14.3"></a><span id="l14.3" class="difflineminus">--- a/suite/components/profile/nsNetscapeProfileMigratorBase.h</span>
<a href="#l14.4"></a><span id="l14.4" class="difflineplus">+++ b/suite/components/migration/src/nsSuiteProfileMigratorBase.h</span>
<a href="#l14.5"></a><span id="l14.5" class="difflineat">@@ -1,59 +1,54 @@</span>
<a href="#l14.6"></a><span id="l14.6"> /* -*- Mode: C++; tab-width: 2; indent-tabs-mode: nil; c-basic-offset: 2 -*- */</span>
<a href="#l14.7"></a><span id="l14.7"> /* This Source Code Form is subject to the terms of the Mozilla Public</span>
<a href="#l14.8"></a><span id="l14.8">  * License, v. 2.0. If a copy of the MPL was not distributed with this</span>
<a href="#l14.9"></a><span id="l14.9">  * file, You can obtain one at http://mozilla.org/MPL/2.0/. */</span>
<a href="#l14.10"></a><span id="l14.10"> </span>
<a href="#l14.11"></a><span id="l14.11" class="difflineminus">-#ifndef netscapeprofilemigratorbase___h___</span>
<a href="#l14.12"></a><span id="l14.12" class="difflineminus">-#define netscapeprofilemigratorbase___h___</span>
<a href="#l14.13"></a><span id="l14.13" class="difflineplus">+#ifndef nsSuiteProfileMigratorBase___h___</span>
<a href="#l14.14"></a><span id="l14.14" class="difflineplus">+#define nsSuiteProfileMigratorBase___h___</span>
<a href="#l14.15"></a><span id="l14.15"> </span>
<a href="#l14.16"></a><span id="l14.16"> #include &quot;nsIFile.h&quot;</span>
<a href="#l14.17"></a><span id="l14.17"> #include &quot;nsIMutableArray.h&quot;</span>
<a href="#l14.18"></a><span id="l14.18"> #include &quot;nsTArray.h&quot;</span>
<a href="#l14.19"></a><span id="l14.19"> #include &quot;nsITimer.h&quot;</span>
<a href="#l14.20"></a><span id="l14.20"> #include &quot;nsIObserverService.h&quot;</span>
<a href="#l14.21"></a><span id="l14.21"> #include &quot;nsISuiteProfileMigrator.h&quot;</span>
<a href="#l14.22"></a><span id="l14.22" class="difflineplus">+#include &quot;nsSuiteMigrationCID.h&quot;</span>
<a href="#l14.23"></a><span id="l14.23"> </span>
<a href="#l14.24"></a><span id="l14.24"> class nsIPrefBranch;</span>
<a href="#l14.25"></a><span id="l14.25"> class nsIPrefService;</span>
<a href="#l14.26"></a><span id="l14.26"> </span>
<a href="#l14.27"></a><span id="l14.27"> struct fileTransactionEntry {</span>
<a href="#l14.28"></a><span id="l14.28">   nsCOMPtr&lt;nsIFile&gt; srcFile;  // the src path including leaf name</span>
<a href="#l14.29"></a><span id="l14.29">   nsCOMPtr&lt;nsIFile&gt; destFile; // the destination path</span>
<a href="#l14.30"></a><span id="l14.30">   nsString newName; // only valid if the file should be renamed after</span>
<a href="#l14.31"></a><span id="l14.31">                     // getting copied</span>
<a href="#l14.32"></a><span id="l14.32"> };</span>
<a href="#l14.33"></a><span id="l14.33"> </span>
<a href="#l14.34"></a><span id="l14.34" class="difflineminus">-#define FILE_NAME_BOOKMARKS       &quot;bookmarks.html&quot;</span>
<a href="#l14.35"></a><span id="l14.35" class="difflineminus">-#define FILE_NAME_COOKIES         &quot;cookies.txt&quot;</span>
<a href="#l14.36"></a><span id="l14.36" class="difflineminus">-#define FILE_NAME_COOKIES_SQLITE  &quot;cookies.sqlite&quot;</span>
<a href="#l14.37"></a><span id="l14.37"> #define FILE_NAME_PREFS           &quot;prefs.js&quot;</span>
<a href="#l14.38"></a><span id="l14.38"> #define FILE_NAME_JUNKTRAINING    &quot;training.dat&quot;</span>
<a href="#l14.39"></a><span id="l14.39"> #define FILE_NAME_VIRTUALFOLDERS  &quot;virtualFolders.dat&quot;</span>
<a href="#l14.40"></a><span id="l14.40" class="difflineminus">-#define FILE_NAME_USERCONTENT     &quot;userContent.css&quot;</span>
<a href="#l14.41"></a><span id="l14.41" class="difflineminus">-#define DIR_NAME_SEARCH           &quot;searchplugins&quot;</span>
<a href="#l14.42"></a><span id="l14.42" class="difflineminus">-#define FILE_NAME_DOWNLOADS       &quot;downloads.rdf&quot;</span>
<a href="#l14.43"></a><span id="l14.43"> </span>
<a href="#l14.44"></a><span id="l14.44" class="difflineminus">-#define F(a) nsNetscapeProfileMigratorBase::a</span>
<a href="#l14.45"></a><span id="l14.45" class="difflineplus">+#define F(a) nsSuiteProfileMigratorBase::a</span>
<a href="#l14.46"></a><span id="l14.46"> </span>
<a href="#l14.47"></a><span id="l14.47"> #define MAKEPREFTRANSFORM(pref, newpref, getmethod, setmethod) \</span>
<a href="#l14.48"></a><span id="l14.48">   { pref, newpref, F(Get##getmethod), F(Set##setmethod), false, { -1 } }</span>
<a href="#l14.49"></a><span id="l14.49"> </span>
<a href="#l14.50"></a><span id="l14.50"> #define MAKESAMETYPEPREFTRANSFORM(pref, method) \</span>
<a href="#l14.51"></a><span id="l14.51">   { pref, 0, F(Get##method), F(Set##method), false, { -1 } }</span>
<a href="#l14.52"></a><span id="l14.52"> </span>
<a href="#l14.53"></a><span id="l14.53" class="difflineminus">-class nsNetscapeProfileMigratorBase : public nsISuiteProfileMigrator,</span>
<a href="#l14.54"></a><span id="l14.54" class="difflineminus">-                                      public nsITimerCallback</span>
<a href="#l14.55"></a><span id="l14.55" class="difflineplus">+class nsSuiteProfileMigratorBase : public nsISuiteProfileMigrator,</span>
<a href="#l14.56"></a><span id="l14.56" class="difflineplus">+                                   public nsITimerCallback</span>
<a href="#l14.57"></a><span id="l14.57"> {</span>
<a href="#l14.58"></a><span id="l14.58"> public:</span>
<a href="#l14.59"></a><span id="l14.59">   NS_DECL_ISUPPORTS</span>
<a href="#l14.60"></a><span id="l14.60">   NS_DECL_NSITIMERCALLBACK</span>
<a href="#l14.61"></a><span id="l14.61"> </span>
<a href="#l14.62"></a><span id="l14.62" class="difflineminus">-  nsNetscapeProfileMigratorBase();</span>
<a href="#l14.63"></a><span id="l14.63" class="difflineplus">+  nsSuiteProfileMigratorBase();</span>
<a href="#l14.64"></a><span id="l14.64"> </span>
<a href="#l14.65"></a><span id="l14.65">   struct PrefTransform;</span>
<a href="#l14.66"></a><span id="l14.66">   typedef nsresult(*prefConverter)(PrefTransform*, nsIPrefBranch*);</span>
<a href="#l14.67"></a><span id="l14.67"> </span>
<a href="#l14.68"></a><span id="l14.68">   struct PrefTransform {</span>
<a href="#l14.69"></a><span id="l14.69">     const char*   sourcePrefName;</span>
<a href="#l14.70"></a><span id="l14.70">     const char*   targetPrefName;</span>
<a href="#l14.71"></a><span id="l14.71">     prefConverter prefGetterFunc;</span>
<a href="#l14.72"></a><span id="l14.72" class="difflineat">@@ -90,17 +85,17 @@ public:</span>
<a href="#l14.73"></a><span id="l14.73">   static nsresult SetBool(PrefTransform* aTransform, nsIPrefBranch* aBranch);</span>
<a href="#l14.74"></a><span id="l14.74">   static nsresult GetInt(PrefTransform* aTransform, nsIPrefBranch* aBranch);</span>
<a href="#l14.75"></a><span id="l14.75">   static nsresult SetInt(PrefTransform* aTransform, nsIPrefBranch* aBranch);</span>
<a href="#l14.76"></a><span id="l14.76">   static nsresult SetFile(PrefTransform* aTransform, nsIPrefBranch* aBranch);</span>
<a href="#l14.77"></a><span id="l14.77">   static nsresult SetImage(PrefTransform* aTransform, nsIPrefBranch* aBranch);</span>
<a href="#l14.78"></a><span id="l14.78">   static nsresult SetCookie(PrefTransform* aTransform, nsIPrefBranch* aBranch);</span>
<a href="#l14.79"></a><span id="l14.79"> </span>
<a href="#l14.80"></a><span id="l14.80"> protected:</span>
<a href="#l14.81"></a><span id="l14.81" class="difflineminus">-  virtual ~nsNetscapeProfileMigratorBase() {}</span>
<a href="#l14.82"></a><span id="l14.82" class="difflineplus">+  virtual ~nsSuiteProfileMigratorBase() {}</span>
<a href="#l14.83"></a><span id="l14.83">   // This function is designed to be overriden by derived classes so that</span>
<a href="#l14.84"></a><span id="l14.84">   // the required profile data for the specific application can be obtained.</span>
<a href="#l14.85"></a><span id="l14.85">   virtual nsresult FillProfileDataFromRegistry() = 0;</span>
<a href="#l14.86"></a><span id="l14.86"> </span>
<a href="#l14.87"></a><span id="l14.87">   // General Utility Methods</span>
<a href="#l14.88"></a><span id="l14.88">   nsresult GetSourceProfile(const char16_t* aProfile);</span>
<a href="#l14.89"></a><span id="l14.89">   nsresult GetProfileDataFromProfilesIni(nsIFile* aDataDir,</span>
<a href="#l14.90"></a><span id="l14.90">                                          nsIMutableArray* aProfileNames,</span>
<a href="#l14.91"></a><span id="l14.91" class="difflineat">@@ -110,28 +105,16 @@ protected:</span>
<a href="#l14.92"></a><span id="l14.92">   nsresult CopyFile(const char* aSourceFileName,</span>
<a href="#l14.93"></a><span id="l14.93">                     const char* aTargetFileName);</span>
<a href="#l14.94"></a><span id="l14.94">   nsresult RecursiveCopy(nsIFile* srcDir, nsIFile* destDir);</span>
<a href="#l14.95"></a><span id="l14.95">   void ReadBranch(const char * branchName, nsIPrefService* aPrefService,</span>
<a href="#l14.96"></a><span id="l14.96">                   PBStructArray &amp;aPrefs);</span>
<a href="#l14.97"></a><span id="l14.97">   void WriteBranch(const char * branchName, nsIPrefService* aPrefService,</span>
<a href="#l14.98"></a><span id="l14.98">                    PBStructArray &amp;aPrefs);</span>
<a href="#l14.99"></a><span id="l14.99"> </span>
<a href="#l14.100"></a><span id="l14.100" class="difflineminus">-  // Generic Import Functions</span>
<a href="#l14.101"></a><span id="l14.101" class="difflineminus">-  nsresult CopyCookies(bool aReplace);</span>
<a href="#l14.102"></a><span id="l14.102" class="difflineminus">-  nsresult CopyUserSheet(const char* aFileName);</span>
<a href="#l14.103"></a><span id="l14.103" class="difflineminus">-</span>
<a href="#l14.104"></a><span id="l14.104" class="difflineminus">-  // Browser Import Functions</span>
<a href="#l14.105"></a><span id="l14.105" class="difflineminus">-  nsresult CopyBookmarks(bool aReplace);</span>
<a href="#l14.106"></a><span id="l14.106" class="difflineminus">-  nsresult CopyOtherData(bool aReplace);</span>
<a href="#l14.107"></a><span id="l14.107" class="difflineminus">-  nsresult ImportNetscapeBookmarks(const char* aBookmarksFileName,</span>
<a href="#l14.108"></a><span id="l14.108" class="difflineminus">-                                   const char* aImportSourceNameKey);</span>
<a href="#l14.109"></a><span id="l14.109" class="difflineminus">-  bool GetSourceHasHomePageURL();</span>
<a href="#l14.110"></a><span id="l14.110" class="difflineminus">-  nsresult CopyHomePageData(bool aReplace);</span>
<a href="#l14.111"></a><span id="l14.111" class="difflineminus">-</span>
<a href="#l14.112"></a><span id="l14.112">   // Mail Import Functions</span>
<a href="#l14.113"></a><span id="l14.113">   nsresult CopyAddressBookDirectories(PBStructArray &amp;aLdapServers,</span>
<a href="#l14.114"></a><span id="l14.114">                                       nsIPrefService* aPrefService);</span>
<a href="#l14.115"></a><span id="l14.115">   nsresult CopySignatureFiles(PBStructArray &amp;aIdentities,</span>
<a href="#l14.116"></a><span id="l14.116">                               nsIPrefService* aPrefService);</span>
<a href="#l14.117"></a><span id="l14.117">   nsresult CopyJunkTraining(bool aReplace);</span>
<a href="#l14.118"></a><span id="l14.118">   nsresult CopyMailFolderPrefs(PBStructArray &amp;aMailServers,</span>
<a href="#l14.119"></a><span id="l14.119">                                nsIPrefService* aPrefService);</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l15.1"></a><span id="l15.1">rename from suite/components/profile/nsSuiteProfileMigratorUtils.cpp</span>
<a href="#l15.2"></a><span id="l15.2">rename to suite/components/migration/src/nsSuiteProfileMigratorUtils.cpp</span>
<a href="#l15.3"></a><span id="l15.3" class="difflineminus">--- a/suite/components/profile/nsSuiteProfileMigratorUtils.cpp</span>
<a href="#l15.4"></a><span id="l15.4" class="difflineplus">+++ b/suite/components/migration/src/nsSuiteProfileMigratorUtils.cpp</span>
<a href="#l15.5"></a><span id="l15.5" class="difflineat">@@ -19,81 +19,16 @@</span>
<a href="#l15.6"></a><span id="l15.6"> #include &quot;nsAppDirectoryServiceDefs.h&quot;</span>
<a href="#l15.7"></a><span id="l15.7"> #include &quot;nsIStringBundle.h&quot;</span>
<a href="#l15.8"></a><span id="l15.8"> #include &quot;nsCRT.h&quot;</span>
<a href="#l15.9"></a><span id="l15.9"> </span>
<a href="#l15.10"></a><span id="l15.10"> #define MIGRATION_BUNDLE &quot;chrome://communicator/migration/locale/migration.properties&quot;</span>
<a href="#l15.11"></a><span id="l15.11"> </span>
<a href="#l15.12"></a><span id="l15.12"> using namespace mozilla;</span>
<a href="#l15.13"></a><span id="l15.13"> </span>
<a href="#l15.14"></a><span id="l15.14" class="difflineminus">-void SetUnicharPref(const char* aPref, const nsAString&amp; aValue,</span>
<a href="#l15.15"></a><span id="l15.15" class="difflineminus">-                    nsIPrefBranch* aPrefs)</span>
<a href="#l15.16"></a><span id="l15.16" class="difflineminus">-{</span>
<a href="#l15.17"></a><span id="l15.17" class="difflineminus">-  nsCOMPtr&lt;nsISupportsString&gt; supportsString =</span>
<a href="#l15.18"></a><span id="l15.18" class="difflineminus">-    do_CreateInstance(NS_SUPPORTS_STRING_CONTRACTID);</span>
<a href="#l15.19"></a><span id="l15.19" class="difflineminus">-  if (supportsString) {</span>
<a href="#l15.20"></a><span id="l15.20" class="difflineminus">-     supportsString-&gt;SetData(aValue);</span>
<a href="#l15.21"></a><span id="l15.21" class="difflineminus">-     aPrefs-&gt;SetComplexValue(aPref, NS_GET_IID(nsISupportsString),</span>
<a href="#l15.22"></a><span id="l15.22" class="difflineminus">-                             supportsString);</span>
<a href="#l15.23"></a><span id="l15.23" class="difflineminus">-  }</span>
<a href="#l15.24"></a><span id="l15.24" class="difflineminus">-}</span>
<a href="#l15.25"></a><span id="l15.25" class="difflineminus">-</span>
<a href="#l15.26"></a><span id="l15.26" class="difflineminus">-void SetProxyPref(const nsAString&amp; aHostPort, const char* aPref,</span>
<a href="#l15.27"></a><span id="l15.27" class="difflineminus">-                  const char* aPortPref, nsIPrefBranch* aPrefs)</span>
<a href="#l15.28"></a><span id="l15.28" class="difflineminus">-{</span>
<a href="#l15.29"></a><span id="l15.29" class="difflineminus">-  nsCOMPtr&lt;nsIURI&gt; uri;</span>
<a href="#l15.30"></a><span id="l15.30" class="difflineminus">-  nsAutoCString host;</span>
<a href="#l15.31"></a><span id="l15.31" class="difflineminus">-  int32_t portValue;</span>
<a href="#l15.32"></a><span id="l15.32" class="difflineminus">-</span>
<a href="#l15.33"></a><span id="l15.33" class="difflineminus">-  // try parsing it as a URI first</span>
<a href="#l15.34"></a><span id="l15.34" class="difflineminus">-  if (NS_SUCCEEDED(NS_NewURI(getter_AddRefs(uri), aHostPort)) &amp;&amp;</span>
<a href="#l15.35"></a><span id="l15.35" class="difflineminus">-      NS_SUCCEEDED(uri-&gt;GetHost(host)) &amp;&amp;</span>
<a href="#l15.36"></a><span id="l15.36" class="difflineminus">-      !host.IsEmpty() &amp;&amp;</span>
<a href="#l15.37"></a><span id="l15.37" class="difflineminus">-      NS_SUCCEEDED(uri-&gt;GetPort(&amp;portValue))) {</span>
<a href="#l15.38"></a><span id="l15.38" class="difflineminus">-    SetUnicharPref(aPref, NS_ConvertUTF8toUTF16(host), aPrefs);</span>
<a href="#l15.39"></a><span id="l15.39" class="difflineminus">-    aPrefs-&gt;SetIntPref(aPortPref, portValue);</span>
<a href="#l15.40"></a><span id="l15.40" class="difflineminus">-  }</span>
<a href="#l15.41"></a><span id="l15.41" class="difflineminus">-  else {</span>
<a href="#l15.42"></a><span id="l15.42" class="difflineminus">-    nsAutoString hostPort(aHostPort);</span>
<a href="#l15.43"></a><span id="l15.43" class="difflineminus">-    int32_t portDelimOffset = hostPort.RFindChar(':');</span>
<a href="#l15.44"></a><span id="l15.44" class="difflineminus">-    if (portDelimOffset &gt; 0) {</span>
<a href="#l15.45"></a><span id="l15.45" class="difflineminus">-      SetUnicharPref(aPref, Substring(hostPort, 0, portDelimOffset), aPrefs);</span>
<a href="#l15.46"></a><span id="l15.46" class="difflineminus">-      nsAutoString port(Substring(hostPort, portDelimOffset + 1));</span>
<a href="#l15.47"></a><span id="l15.47" class="difflineminus">-      nsresult error;</span>
<a href="#l15.48"></a><span id="l15.48" class="difflineminus">-      portValue = port.ToInteger(&amp;error);</span>
<a href="#l15.49"></a><span id="l15.49" class="difflineminus">-      aPrefs-&gt;SetIntPref(aPortPref, portValue);</span>
<a href="#l15.50"></a><span id="l15.50" class="difflineminus">-    }</span>
<a href="#l15.51"></a><span id="l15.51" class="difflineminus">-    else</span>
<a href="#l15.52"></a><span id="l15.52" class="difflineminus">-      SetUnicharPref(aPref, hostPort, aPrefs);</span>
<a href="#l15.53"></a><span id="l15.53" class="difflineminus">-  }</span>
<a href="#l15.54"></a><span id="l15.54" class="difflineminus">-}</span>
<a href="#l15.55"></a><span id="l15.55" class="difflineminus">-</span>
<a href="#l15.56"></a><span id="l15.56" class="difflineminus">-void ParseOverrideServers(const nsAString&amp; aServers, nsIPrefBranch* aBranch)</span>
<a href="#l15.57"></a><span id="l15.57" class="difflineminus">-{</span>
<a href="#l15.58"></a><span id="l15.58" class="difflineminus">-  // Windows (and Opera) formats its proxy override list in the form:</span>
<a href="#l15.59"></a><span id="l15.59" class="difflineminus">-  // server;server;server where server is a server name or ip address,</span>
<a href="#l15.60"></a><span id="l15.60" class="difflineminus">-  // or &quot;&lt;local&gt;&quot;. Mozilla's format is server,server,server, and &lt;local&gt;</span>
<a href="#l15.61"></a><span id="l15.61" class="difflineminus">-  // must be translated to &quot;localhost,127.0.0.1&quot;</span>
<a href="#l15.62"></a><span id="l15.62" class="difflineminus">-  nsAutoString override(aServers);</span>
<a href="#l15.63"></a><span id="l15.63" class="difflineminus">-  int32_t left = 0, right = 0;</span>
<a href="#l15.64"></a><span id="l15.64" class="difflineminus">-  for (;;) {</span>
<a href="#l15.65"></a><span id="l15.65" class="difflineminus">-    right = override.FindChar(';', right);</span>
<a href="#l15.66"></a><span id="l15.66" class="difflineminus">-    const nsAString&amp; host =</span>
<a href="#l15.67"></a><span id="l15.67" class="difflineminus">-      Substring(override, left,</span>
<a href="#l15.68"></a><span id="l15.68" class="difflineminus">-                (right &lt; 0 ? override.Length() : right) - left);</span>
<a href="#l15.69"></a><span id="l15.69" class="difflineminus">-    if (host.EqualsLiteral(&quot;&lt;local&gt;&quot;))</span>
<a href="#l15.70"></a><span id="l15.70" class="difflineminus">-      override.Replace(left, 7, NS_LITERAL_STRING(&quot;localhost,127.0.0.1&quot;));</span>
<a href="#l15.71"></a><span id="l15.71" class="difflineminus">-    if (right &lt; 0)</span>
<a href="#l15.72"></a><span id="l15.72" class="difflineminus">-      break;</span>
<a href="#l15.73"></a><span id="l15.73" class="difflineminus">-    left = right + 1;</span>
<a href="#l15.74"></a><span id="l15.74" class="difflineminus">-    override.Replace(right, 1, NS_LITERAL_STRING(&quot;,&quot;));</span>
<a href="#l15.75"></a><span id="l15.75" class="difflineminus">-  }</span>
<a href="#l15.76"></a><span id="l15.76" class="difflineminus">-  SetUnicharPref(&quot;network.proxy.no_proxies_on&quot;, override, aBranch);</span>
<a href="#l15.77"></a><span id="l15.77" class="difflineminus">-}</span>
<a href="#l15.78"></a><span id="l15.78" class="difflineminus">-</span>
<a href="#l15.79"></a><span id="l15.79"> void GetMigrateDataFromArray(MigrationData* aDataArray,</span>
<a href="#l15.80"></a><span id="l15.80">                              int32_t aDataArrayLength,</span>
<a href="#l15.81"></a><span id="l15.81">                              bool aReplace, nsIFile* aSourceProfile,</span>
<a href="#l15.82"></a><span id="l15.82">                              uint16_t* aResult)</span>
<a href="#l15.83"></a><span id="l15.83"> {</span>
<a href="#l15.84"></a><span id="l15.84">   nsCOMPtr&lt;nsIFile&gt; sourceFile;</span>
<a href="#l15.85"></a><span id="l15.85">   bool exists;</span>
<a href="#l15.86"></a><span id="l15.86">   MigrationData* cursor;</span>
<a href="#l15.87"></a><span id="l15.87" class="difflineat">@@ -124,16 +59,8 @@ GetProfilePath(nsIProfileStartup* aStart</span>
<a href="#l15.88"></a><span id="l15.88">     nsCOMPtr&lt;nsIProperties&gt; dirSvc</span>
<a href="#l15.89"></a><span id="l15.89">       (do_GetService(NS_DIRECTORY_SERVICE_CONTRACTID));</span>
<a href="#l15.90"></a><span id="l15.90">     if (dirSvc) {</span>
<a href="#l15.91"></a><span id="l15.91">       dirSvc-&gt;Get(NS_APP_USER_PROFILE_50_DIR, NS_GET_IID(nsIFile),</span>
<a href="#l15.92"></a><span id="l15.92">                   (void**)aProfileDir);</span>
<a href="#l15.93"></a><span id="l15.93">     }</span>
<a href="#l15.94"></a><span id="l15.94">   }</span>
<a href="#l15.95"></a><span id="l15.95"> }</span>
<a href="#l15.96"></a><span id="l15.96" class="difflineminus">-</span>
<a href="#l15.97"></a><span id="l15.97" class="difflineminus">-nsresult</span>
<a href="#l15.98"></a><span id="l15.98" class="difflineminus">-ImportBookmarksHTML(nsIFile* aBookmarksFile,</span>
<a href="#l15.99"></a><span id="l15.99" class="difflineminus">-                    const char16_t* aImportSourceNameKey)</span>
<a href="#l15.100"></a><span id="l15.100" class="difflineminus">-{</span>
<a href="#l15.101"></a><span id="l15.101" class="difflineminus">-  // XXX: need to make this work with places</span>
<a href="#l15.102"></a><span id="l15.102" class="difflineminus">-  return NS_OK;</span>
<a href="#l15.103"></a><span id="l15.103" class="difflineminus">-}</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l16.1"></a><span id="l16.1">rename from suite/components/profile/nsSuiteProfileMigratorUtils.h</span>
<a href="#l16.2"></a><span id="l16.2">rename to suite/components/migration/src/nsSuiteProfileMigratorUtils.h</span>
<a href="#l16.3"></a><span id="l16.3" class="difflineminus">--- a/suite/components/profile/nsSuiteProfileMigratorUtils.h</span>
<a href="#l16.4"></a><span id="l16.4" class="difflineplus">+++ b/suite/components/migration/src/nsSuiteProfileMigratorUtils.h</span>
<a href="#l16.5"></a><span id="l16.5" class="difflineat">@@ -19,36 +19,30 @@</span>
<a href="#l16.6"></a><span id="l16.6">   if (NS_SUCCEEDED(rv) &amp;&amp; (aItems &amp; itemIndex || !aItems)) { \</span>
<a href="#l16.7"></a><span id="l16.7">     nsAutoString index; \</span>
<a href="#l16.8"></a><span id="l16.8">     index.AppendInt(itemIndex); \</span>
<a href="#l16.9"></a><span id="l16.9">     NOTIFY_OBSERVERS(MIGRATION_ITEMBEFOREMIGRATE, index.get()); \</span>
<a href="#l16.10"></a><span id="l16.10">     rv = func(replace); \</span>
<a href="#l16.11"></a><span id="l16.11">     NOTIFY_OBSERVERS(MIGRATION_ITEMAFTERMIGRATE, index.get()); \</span>
<a href="#l16.12"></a><span id="l16.12">   }</span>
<a href="#l16.13"></a><span id="l16.13"> </span>
<a href="#l16.14"></a><span id="l16.14" class="difflineminus">-#define NC_URI(property) \</span>
<a href="#l16.15"></a><span id="l16.15" class="difflineminus">-  NS_LITERAL_CSTRING(&quot;http://home.netscape.com/NC-rdf#&quot;#property)</span>
<a href="#l16.16"></a><span id="l16.16" class="difflineplus">+#define MAKEPREFTRANSFORM(pref, newpref, getmethod, setmethod) \</span>
<a href="#l16.17"></a><span id="l16.17" class="difflineplus">+  { pref, newpref, F(Get##getmethod), F(Set##setmethod), false, { -1 } }</span>
<a href="#l16.18"></a><span id="l16.18"> </span>
<a href="#l16.19"></a><span id="l16.19" class="difflineplus">+#define MAKESAMETYPEPREFTRANSFORM(pref, method) \</span>
<a href="#l16.20"></a><span id="l16.20" class="difflineplus">+  { pref, 0, F(Get##method), F(Set##method), false, { -1 } }</span>
<a href="#l16.21"></a><span id="l16.21"> </span>
<a href="#l16.22"></a><span id="l16.22"> #include &quot;nsString.h&quot;</span>
<a href="#l16.23"></a><span id="l16.23"> #include &quot;nscore.h&quot;</span>
<a href="#l16.24"></a><span id="l16.24"> #include &quot;nsCOMPtr.h&quot;</span>
<a href="#l16.25"></a><span id="l16.25"> </span>
<a href="#l16.26"></a><span id="l16.26"> class nsIPrefBranch;</span>
<a href="#l16.27"></a><span id="l16.27"> class nsIProfileStartup;</span>
<a href="#l16.28"></a><span id="l16.28"> class nsIFile;</span>
<a href="#l16.29"></a><span id="l16.29"> </span>
<a href="#l16.30"></a><span id="l16.30" class="difflineminus">-void SetUnicharPref(const char* aPref, const nsAString&amp; aValue,</span>
<a href="#l16.31"></a><span id="l16.31" class="difflineminus">-                    nsIPrefBranch* aPrefs);</span>
<a href="#l16.32"></a><span id="l16.32" class="difflineminus">-</span>
<a href="#l16.33"></a><span id="l16.33" class="difflineminus">-// Proxy utilities shared by the Opera and IE migrators</span>
<a href="#l16.34"></a><span id="l16.34" class="difflineminus">-void ParseOverrideServers(const nsAString&amp; aServers, nsIPrefBranch* aBranch);</span>
<a href="#l16.35"></a><span id="l16.35" class="difflineminus">-void SetProxyPref(const nsAString&amp; aHostPort, const char* aPref,</span>
<a href="#l16.36"></a><span id="l16.36" class="difflineminus">-                  const char* aPortPref, nsIPrefBranch* aPrefs);</span>
<a href="#l16.37"></a><span id="l16.37" class="difflineminus">-</span>
<a href="#l16.38"></a><span id="l16.38"> struct MigrationData {</span>
<a href="#l16.39"></a><span id="l16.39">   const char* fileName;</span>
<a href="#l16.40"></a><span id="l16.40">   uint32_t sourceFlag;</span>
<a href="#l16.41"></a><span id="l16.41">   bool replaceOnly;</span>
<a href="#l16.42"></a><span id="l16.42"> };</span>
<a href="#l16.43"></a><span id="l16.43"> </span>
<a href="#l16.44"></a><span id="l16.44"> class nsIFile;</span>
<a href="#l16.45"></a><span id="l16.45"> void GetMigrateDataFromArray(MigrationData* aDataArray,</span>
<a href="#l16.46"></a><span id="l16.46" class="difflineat">@@ -58,15 +52,9 @@ void GetMigrateDataFromArray(MigrationDa</span>
<a href="#l16.47"></a><span id="l16.47">                              uint16_t* aResult);</span>
<a href="#l16.48"></a><span id="l16.48"> </span>
<a href="#l16.49"></a><span id="l16.49"> </span>
<a href="#l16.50"></a><span id="l16.50"> // get the base directory of the *target* profile</span>
<a href="#l16.51"></a><span id="l16.51"> // this is already cloned, modify it to your heart's content</span>
<a href="#l16.52"></a><span id="l16.52"> void GetProfilePath(nsIProfileStartup* aStartup,</span>
<a href="#l16.53"></a><span id="l16.53">                     nsIFile** aProfileDir);</span>
<a href="#l16.54"></a><span id="l16.54"> </span>
<a href="#l16.55"></a><span id="l16.55" class="difflineminus">-// In-place import from aBookmarksFile into a folder in the user's bookmarks</span>
<a href="#l16.56"></a><span id="l16.56" class="difflineminus">-// with the name &quot;From (STR:aImportSourceNameKey)&quot; (aImportSourceNameKey</span>
<a href="#l16.57"></a><span id="l16.57" class="difflineminus">-// is a key into migration.properties with the pretty name of the application.</span>
<a href="#l16.58"></a><span id="l16.58" class="difflineminus">-nsresult ImportBookmarksHTML(nsIFile* aBookmarksFile,</span>
<a href="#l16.59"></a><span id="l16.59" class="difflineminus">-                             const char16_t* aImportSourceNameKey);</span>
<a href="#l16.60"></a><span id="l16.60" class="difflineminus">-</span>
<a href="#l16.61"></a><span id="l16.61"> #endif</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l17.1"></a><span id="l17.1">rename from suite/components/profile/nsThunderbirdProfileMigrator.cpp</span>
<a href="#l17.2"></a><span id="l17.2">rename to suite/components/migration/src/nsThunderbirdProfileMigrator.cpp</span>
<a href="#l17.3"></a><span id="l17.3" class="difflineminus">--- a/suite/components/profile/nsThunderbirdProfileMigrator.cpp</span>
<a href="#l17.4"></a><span id="l17.4" class="difflineplus">+++ b/suite/components/migration/src/nsThunderbirdProfileMigrator.cpp</span>
<a href="#l17.5"></a><span id="l17.5" class="difflineat">@@ -30,17 +30,17 @@</span>
<a href="#l17.6"></a><span id="l17.6"> #define FILE_NAME_HISTORY         &quot;history.dat&quot;</span>
<a href="#l17.7"></a><span id="l17.7"> #define FILE_NAME_SIGNONS         &quot;signons.sqlite&quot;</span>
<a href="#l17.8"></a><span id="l17.8"> #define FILE_NAME_MIMETYPES       &quot;mimeTypes.rdf&quot;</span>
<a href="#l17.9"></a><span id="l17.9"> #define FILE_NAME_USER_PREFS      &quot;user.js&quot;</span>
<a href="#l17.10"></a><span id="l17.10"> #define FILE_NAME_PERSONALDICTIONARY &quot;persdict.dat&quot;</span>
<a href="#l17.11"></a><span id="l17.11"> #define FILE_NAME_MAILVIEWS       &quot;mailViews.dat&quot;</span>
<a href="#l17.12"></a><span id="l17.12"> </span>
<a href="#l17.13"></a><span id="l17.13"> NS_IMPL_ISUPPORTS(nsThunderbirdProfileMigrator, nsISuiteProfileMigrator,</span>
<a href="#l17.14"></a><span id="l17.14" class="difflineminus">-                   nsITimerCallback)</span>
<a href="#l17.15"></a><span id="l17.15" class="difflineplus">+                  nsITimerCallback)</span>
<a href="#l17.16"></a><span id="l17.16"> </span>
<a href="#l17.17"></a><span id="l17.17"> nsThunderbirdProfileMigrator::nsThunderbirdProfileMigrator()</span>
<a href="#l17.18"></a><span id="l17.18"> {</span>
<a href="#l17.19"></a><span id="l17.19"> }</span>
<a href="#l17.20"></a><span id="l17.20"> </span>
<a href="#l17.21"></a><span id="l17.21"> nsThunderbirdProfileMigrator::~nsThunderbirdProfileMigrator()</span>
<a href="#l17.22"></a><span id="l17.22"> {</span>
<a href="#l17.23"></a><span id="l17.23"> }</span>
<a href="#l17.24"></a><span id="l17.24" class="difflineat">@@ -65,20 +65,18 @@ nsThunderbirdProfileMigrator::Migrate(ui</span>
<a href="#l17.25"></a><span id="l17.25">     GetSourceProfile(aProfile);</span>
<a href="#l17.26"></a><span id="l17.26">     if (!mSourceProfile)</span>
<a href="#l17.27"></a><span id="l17.27">       return NS_ERROR_FILE_NOT_FOUND;</span>
<a href="#l17.28"></a><span id="l17.28">   }</span>
<a href="#l17.29"></a><span id="l17.29"> </span>
<a href="#l17.30"></a><span id="l17.30">   NOTIFY_OBSERVERS(MIGRATION_STARTED, nullptr);</span>
<a href="#l17.31"></a><span id="l17.31"> </span>
<a href="#l17.32"></a><span id="l17.32">   COPY_DATA(CopyPreferences,  aReplace, nsISuiteProfileMigrator::SETTINGS);</span>
<a href="#l17.33"></a><span id="l17.33" class="difflineminus">-  COPY_DATA(CopyCookies,      aReplace, nsISuiteProfileMigrator::COOKIES);</span>
<a href="#l17.34"></a><span id="l17.34">   COPY_DATA(CopyHistory,      aReplace, nsISuiteProfileMigrator::HISTORY);</span>
<a href="#l17.35"></a><span id="l17.35">   COPY_DATA(CopyPasswords,    aReplace, nsISuiteProfileMigrator::PASSWORDS);</span>
<a href="#l17.36"></a><span id="l17.36" class="difflineminus">-  COPY_DATA(CopyOtherData,    aReplace, nsISuiteProfileMigrator::OTHERDATA);</span>
<a href="#l17.37"></a><span id="l17.37"> </span>
<a href="#l17.38"></a><span id="l17.38">   // fake notifications for things we've already imported as part of</span>
<a href="#l17.39"></a><span id="l17.39">   // CopyPreferences</span>
<a href="#l17.40"></a><span id="l17.40">   nsAutoString index;</span>
<a href="#l17.41"></a><span id="l17.41">   index.AppendInt(nsISuiteProfileMigrator::ACCOUNT_SETTINGS);</span>
<a href="#l17.42"></a><span id="l17.42">   NOTIFY_OBSERVERS(MIGRATION_ITEMBEFOREMIGRATE, index.get());</span>
<a href="#l17.43"></a><span id="l17.43">   NOTIFY_OBSERVERS(MIGRATION_ITEMAFTERMIGRATE, index.get());</span>
<a href="#l17.44"></a><span id="l17.44"> </span>
<a href="#l17.45"></a><span id="l17.45" class="difflineat">@@ -87,20 +85,19 @@ nsThunderbirdProfileMigrator::Migrate(ui</span>
<a href="#l17.46"></a><span id="l17.46">   NOTIFY_OBSERVERS(MIGRATION_ITEMBEFOREMIGRATE, index.get());</span>
<a href="#l17.47"></a><span id="l17.47">   NOTIFY_OBSERVERS(MIGRATION_ITEMAFTERMIGRATE, index.get());</span>
<a href="#l17.48"></a><span id="l17.48"> </span>
<a href="#l17.49"></a><span id="l17.49">   // copy junk mail training file</span>
<a href="#l17.50"></a><span id="l17.50">   COPY_DATA(CopyJunkTraining, aReplace, nsISuiteProfileMigrator::JUNKTRAINING);</span>
<a href="#l17.51"></a><span id="l17.51"> </span>
<a href="#l17.52"></a><span id="l17.52">   if (aReplace &amp;&amp;</span>
<a href="#l17.53"></a><span id="l17.53">       (aItems &amp; nsISuiteProfileMigrator::SETTINGS ||</span>
<a href="#l17.54"></a><span id="l17.54" class="difflineminus">-       aItems &amp; nsISuiteProfileMigrator::COOKIES ||</span>
<a href="#l17.55"></a><span id="l17.55">        aItems &amp; nsISuiteProfileMigrator::PASSWORDS ||</span>
<a href="#l17.56"></a><span id="l17.56">        !aItems)) {</span>
<a href="#l17.57"></a><span id="l17.57" class="difflineminus">-    // Permissions (Images, Cookies, Popups)</span>
<a href="#l17.58"></a><span id="l17.58" class="difflineplus">+    // Permissions (Images)</span>
<a href="#l17.59"></a><span id="l17.59">     if (NS_SUCCEEDED(rv))</span>
<a href="#l17.60"></a><span id="l17.60">       rv = CopyFile(FILE_NAME_SITEPERM_NEW, FILE_NAME_SITEPERM_NEW);</span>
<a href="#l17.61"></a><span id="l17.61">     if (NS_SUCCEEDED(rv))</span>
<a href="#l17.62"></a><span id="l17.62">       rv = CopyFile(FILE_NAME_SITEPERM_OLD, FILE_NAME_SITEPERM_OLD);</span>
<a href="#l17.63"></a><span id="l17.63">   }</span>
<a href="#l17.64"></a><span id="l17.64"> </span>
<a href="#l17.65"></a><span id="l17.65">   // the last thing to do is to actually copy over any mail folders</span>
<a href="#l17.66"></a><span id="l17.66">   // we have marked for copying we want to do this last and it will be</span>
<a href="#l17.67"></a><span id="l17.67" class="difflineat">@@ -132,50 +129,39 @@ nsThunderbirdProfileMigrator::GetMigrate</span>
<a href="#l17.68"></a><span id="l17.68">     nsISuiteProfileMigrator::ADDRESSBOOK_DATA;</span>
<a href="#l17.69"></a><span id="l17.69"> </span>
<a href="#l17.70"></a><span id="l17.70">   MigrationData data[] = { { FILE_NAME_PREFS,</span>
<a href="#l17.71"></a><span id="l17.71">                              nsISuiteProfileMigrator::SETTINGS,</span>
<a href="#l17.72"></a><span id="l17.72">                              true },</span>
<a href="#l17.73"></a><span id="l17.73">                            { FILE_NAME_USER_PREFS,</span>
<a href="#l17.74"></a><span id="l17.74">                              nsISuiteProfileMigrator::SETTINGS,</span>
<a href="#l17.75"></a><span id="l17.75">                              true },</span>
<a href="#l17.76"></a><span id="l17.76" class="difflineminus">-                           { FILE_NAME_COOKIES,</span>
<a href="#l17.77"></a><span id="l17.77" class="difflineminus">-                             nsISuiteProfileMigrator::COOKIES,</span>
<a href="#l17.78"></a><span id="l17.78" class="difflineminus">-                             false },</span>
<a href="#l17.79"></a><span id="l17.79">                            { FILE_NAME_HISTORY,</span>
<a href="#l17.80"></a><span id="l17.80">                              nsISuiteProfileMigrator::HISTORY,</span>
<a href="#l17.81"></a><span id="l17.81">                              true },</span>
<a href="#l17.82"></a><span id="l17.82">                            { FILE_NAME_SIGNONS,</span>
<a href="#l17.83"></a><span id="l17.83">                              nsISuiteProfileMigrator::PASSWORDS,</span>
<a href="#l17.84"></a><span id="l17.84">                              true },</span>
<a href="#l17.85"></a><span id="l17.85" class="difflineminus">-                           { FILE_NAME_DOWNLOADS,</span>
<a href="#l17.86"></a><span id="l17.86" class="difflineminus">-                             nsISuiteProfileMigrator::OTHERDATA,</span>
<a href="#l17.87"></a><span id="l17.87" class="difflineminus">-                             true },</span>
<a href="#l17.88"></a><span id="l17.88" class="difflineminus">-                           { FILE_NAME_MIMETYPES,</span>
<a href="#l17.89"></a><span id="l17.89" class="difflineminus">-                             nsISuiteProfileMigrator::OTHERDATA,</span>
<a href="#l17.90"></a><span id="l17.90" class="difflineminus">-                             true },</span>
<a href="#l17.91"></a><span id="l17.91">                            { FILE_NAME_JUNKTRAINING,</span>
<a href="#l17.92"></a><span id="l17.92">                              nsISuiteProfileMigrator::JUNKTRAINING,</span>
<a href="#l17.93"></a><span id="l17.93">                              true } };</span>
<a href="#l17.94"></a><span id="l17.94"> </span>
<a href="#l17.95"></a><span id="l17.95">   GetMigrateDataFromArray(data, sizeof(data)/sizeof(MigrationData),</span>
<a href="#l17.96"></a><span id="l17.96">                           aReplace, mSourceProfile, aResult);</span>
<a href="#l17.97"></a><span id="l17.97"> </span>
<a href="#l17.98"></a><span id="l17.98">   return NS_OK;</span>
<a href="#l17.99"></a><span id="l17.99"> }</span>
<a href="#l17.100"></a><span id="l17.100"> </span>
<a href="#l17.101"></a><span id="l17.101"> NS_IMETHODIMP</span>
<a href="#l17.102"></a><span id="l17.102"> nsThunderbirdProfileMigrator::GetSupportedItems(uint16_t *aSupportedItems)</span>
<a href="#l17.103"></a><span id="l17.103"> {</span>
<a href="#l17.104"></a><span id="l17.104">   NS_ENSURE_ARG_POINTER(aSupportedItems);</span>
<a href="#l17.105"></a><span id="l17.105"> </span>
<a href="#l17.106"></a><span id="l17.106">   *aSupportedItems = nsISuiteProfileMigrator::SETTINGS |</span>
<a href="#l17.107"></a><span id="l17.107" class="difflineminus">-    nsISuiteProfileMigrator::COOKIES |</span>
<a href="#l17.108"></a><span id="l17.108">     nsISuiteProfileMigrator::HISTORY |</span>
<a href="#l17.109"></a><span id="l17.109" class="difflineminus">-    nsISuiteProfileMigrator::OTHERDATA |</span>
<a href="#l17.110"></a><span id="l17.110">     nsISuiteProfileMigrator::JUNKTRAINING |</span>
<a href="#l17.111"></a><span id="l17.111">     nsISuiteProfileMigrator::PASSWORDS |</span>
<a href="#l17.112"></a><span id="l17.112">     nsISuiteProfileMigrator::ACCOUNT_SETTINGS |</span>
<a href="#l17.113"></a><span id="l17.113">     nsISuiteProfileMigrator::MAILDATA |</span>
<a href="#l17.114"></a><span id="l17.114">     nsISuiteProfileMigrator::NEWSDATA |</span>
<a href="#l17.115"></a><span id="l17.115">     nsISuiteProfileMigrator::ADDRESSBOOK_DATA;</span>
<a href="#l17.116"></a><span id="l17.116"> </span>
<a href="#l17.117"></a><span id="l17.117">   return NS_OK;</span>
<a href="#l17.118"></a><span id="l17.118" class="difflineat">@@ -404,24 +390,16 @@ nsThunderbirdProfileMigrator::PrefTransf</span>
<a href="#l17.119"></a><span id="l17.119">   MAKESAMETYPEPREFTRANSFORM(&quot;news.show_size_in_lines&quot;,                 Bool),</span>
<a href="#l17.120"></a><span id="l17.120">   MAKESAMETYPEPREFTRANSFORM(&quot;news.update_unread_on_expand&quot;,            Bool),</span>
<a href="#l17.121"></a><span id="l17.121"> </span>
<a href="#l17.122"></a><span id="l17.122">   // pdi is the new preference, but nii is the old one - so do nii first, and</span>
<a href="#l17.123"></a><span id="l17.123">   // then do pdi to account for both situations</span>
<a href="#l17.124"></a><span id="l17.124">   MAKEPREFTRANSFORM(&quot;network.image.imageBehavior&quot;, 0, Int,             Image),</span>
<a href="#l17.125"></a><span id="l17.125">   MAKESAMETYPEPREFTRANSFORM(&quot;permissions.default.image&quot;,               Int),</span>
<a href="#l17.126"></a><span id="l17.126"> </span>
<a href="#l17.127"></a><span id="l17.127" class="difflineminus">-  MAKESAMETYPEPREFTRANSFORM(&quot;network.cookie.alwaysAcceptSessionCookies&quot;,Bool),</span>
<a href="#l17.128"></a><span id="l17.128" class="difflineminus">-  MAKEPREFTRANSFORM(&quot;network.cookie.cookieBehavior&quot;, 0, Int,           Cookie),</span>
<a href="#l17.129"></a><span id="l17.129" class="difflineminus">-</span>
<a href="#l17.130"></a><span id="l17.130" class="difflineminus">-  MAKESAMETYPEPREFTRANSFORM(&quot;network.cookie.lifetime.behavior&quot;,        Int),</span>
<a href="#l17.131"></a><span id="l17.131" class="difflineminus">-  MAKESAMETYPEPREFTRANSFORM(&quot;network.cookie.lifetime.days&quot;,            Int),</span>
<a href="#l17.132"></a><span id="l17.132" class="difflineminus">-  MAKESAMETYPEPREFTRANSFORM(&quot;network.cookie.lifetime.enabled&quot;,         Bool),</span>
<a href="#l17.133"></a><span id="l17.133" class="difflineminus">-  MAKESAMETYPEPREFTRANSFORM(&quot;network.cookie.lifetimePolicy&quot;,           Int),</span>
<a href="#l17.134"></a><span id="l17.134" class="difflineminus">-  MAKESAMETYPEPREFTRANSFORM(&quot;network.cookie.warnAboutCookies&quot;,         Bool),</span>
<a href="#l17.135"></a><span id="l17.135">   MAKESAMETYPEPREFTRANSFORM(&quot;network.proxy.autoconfig_url&quot;,            String),</span>
<a href="#l17.136"></a><span id="l17.136">   MAKESAMETYPEPREFTRANSFORM(&quot;network.proxy.ftp&quot;,                       String),</span>
<a href="#l17.137"></a><span id="l17.137">   MAKESAMETYPEPREFTRANSFORM(&quot;network.proxy.ftp_port&quot;,                  Int),</span>
<a href="#l17.138"></a><span id="l17.138">   MAKESAMETYPEPREFTRANSFORM(&quot;network.proxy.http&quot;,                      String),</span>
<a href="#l17.139"></a><span id="l17.139">   MAKESAMETYPEPREFTRANSFORM(&quot;network.proxy.http_port&quot;,                 Int),</span>
<a href="#l17.140"></a><span id="l17.140">   MAKESAMETYPEPREFTRANSFORM(&quot;network.proxy.no_proxies_on&quot;,             String),</span>
<a href="#l17.141"></a><span id="l17.141">   MAKESAMETYPEPREFTRANSFORM(&quot;network.proxy.socks&quot;,                     String),</span>
<a href="#l17.142"></a><span id="l17.142">   MAKESAMETYPEPREFTRANSFORM(&quot;network.proxy.socks_port&quot;,                Int),</span>
<a href="#l17.143"></a><span id="l17.143" class="difflineat">@@ -576,19 +554,16 @@ nsThunderbirdProfileMigrator::CopyPrefer</span>
<a href="#l17.144"></a><span id="l17.144">   // User MIME Type overrides</span>
<a href="#l17.145"></a><span id="l17.145">   if (NS_SUCCEEDED(rv))</span>
<a href="#l17.146"></a><span id="l17.146">     rv = CopyFile(FILE_NAME_MIMETYPES, FILE_NAME_MIMETYPES);</span>
<a href="#l17.147"></a><span id="l17.147">   if (NS_SUCCEEDED(rv))</span>
<a href="#l17.148"></a><span id="l17.148">     rv = CopyFile(FILE_NAME_PERSONALDICTIONARY, FILE_NAME_PERSONALDICTIONARY);</span>
<a href="#l17.149"></a><span id="l17.149">   if (NS_SUCCEEDED(rv))</span>
<a href="#l17.150"></a><span id="l17.150">     rv = CopyFile(FILE_NAME_MAILVIEWS, FILE_NAME_MAILVIEWS);</span>
<a href="#l17.151"></a><span id="l17.151"> </span>
<a href="#l17.152"></a><span id="l17.152" class="difflineminus">-  if (NS_SUCCEEDED(rv))</span>
<a href="#l17.153"></a><span id="l17.153" class="difflineminus">-    rv = CopyUserSheet(FILE_NAME_USERCONTENT);</span>
<a href="#l17.154"></a><span id="l17.154" class="difflineminus">-</span>
<a href="#l17.155"></a><span id="l17.155">   return rv;</span>
<a href="#l17.156"></a><span id="l17.156"> }</span>
<a href="#l17.157"></a><span id="l17.157"> </span>
<a href="#l17.158"></a><span id="l17.158"> nsresult</span>
<a href="#l17.159"></a><span id="l17.159"> nsThunderbirdProfileMigrator::CopyHistory(bool aReplace)</span>
<a href="#l17.160"></a><span id="l17.160"> {</span>
<a href="#l17.161"></a><span id="l17.161">   return aReplace ? CopyFile(FILE_NAME_HISTORY, FILE_NAME_HISTORY) : NS_OK;</span>
<a href="#l17.162"></a><span id="l17.162"> }</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l18.1"></a><span id="l18.1">rename from suite/components/profile/nsThunderbirdProfileMigrator.h</span>
<a href="#l18.2"></a><span id="l18.2">rename to suite/components/migration/src/nsThunderbirdProfileMigrator.h</span>
<a href="#l18.3"></a><span id="l18.3" class="difflineminus">--- a/suite/components/profile/nsThunderbirdProfileMigrator.h</span>
<a href="#l18.4"></a><span id="l18.4" class="difflineplus">+++ b/suite/components/migration/src/nsThunderbirdProfileMigrator.h</span>
<a href="#l18.5"></a><span id="l18.5" class="difflineat">@@ -4,28 +4,25 @@</span>
<a href="#l18.6"></a><span id="l18.6">  * file, You can obtain one at http://mozilla.org/MPL/2.0/. */</span>
<a href="#l18.7"></a><span id="l18.7"> </span>
<a href="#l18.8"></a><span id="l18.8"> #ifndef ThunderbirdProfileMigrator_h__</span>
<a href="#l18.9"></a><span id="l18.9"> #define ThunderbirdProfileMigrator_h__</span>
<a href="#l18.10"></a><span id="l18.10"> </span>
<a href="#l18.11"></a><span id="l18.11"> #include &quot;nsISuiteProfileMigrator.h&quot;</span>
<a href="#l18.12"></a><span id="l18.12"> #include &quot;nsIFile.h&quot;</span>
<a href="#l18.13"></a><span id="l18.13"> #include &quot;nsIObserverService.h&quot;</span>
<a href="#l18.14"></a><span id="l18.14" class="difflineminus">-#include &quot;nsNetscapeProfileMigratorBase.h&quot;</span>
<a href="#l18.15"></a><span id="l18.15" class="difflineplus">+#include &quot;nsSuiteProfileMigratorBase.h&quot;</span>
<a href="#l18.16"></a><span id="l18.16"> #include &quot;nsITimer.h&quot;</span>
<a href="#l18.17"></a><span id="l18.17"> #include &quot;mozilla/Attributes.h&quot;</span>
<a href="#l18.18"></a><span id="l18.18"> </span>
<a href="#l18.19"></a><span id="l18.19"> class nsIFile;</span>
<a href="#l18.20"></a><span id="l18.20"> class nsIPrefBranch;</span>
<a href="#l18.21"></a><span id="l18.21"> class nsIPrefService;</span>
<a href="#l18.22"></a><span id="l18.22"> </span>
<a href="#l18.23"></a><span id="l18.23" class="difflineminus">-#define NS_THUNDERBIRDPROFILEMIGRATOR_CID \</span>
<a href="#l18.24"></a><span id="l18.24" class="difflineminus">-{ 0x6ba91adb, 0xa4ed, 0x405f, { 0xbd, 0x6c, 0xe9, 0x04, 0xa9, 0x9d, 0x9a, 0xd8 } }</span>
<a href="#l18.25"></a><span id="l18.25" class="difflineminus">-</span>
<a href="#l18.26"></a><span id="l18.26" class="difflineminus">-class nsThunderbirdProfileMigrator final : public nsNetscapeProfileMigratorBase</span>
<a href="#l18.27"></a><span id="l18.27" class="difflineplus">+class nsThunderbirdProfileMigrator final : public nsSuiteProfileMigratorBase</span>
<a href="#l18.28"></a><span id="l18.28"> {</span>
<a href="#l18.29"></a><span id="l18.29"> public:</span>
<a href="#l18.30"></a><span id="l18.30">   NS_DECL_ISUPPORTS</span>
<a href="#l18.31"></a><span id="l18.31"> </span>
<a href="#l18.32"></a><span id="l18.32">   nsThunderbirdProfileMigrator();</span>
<a href="#l18.33"></a><span id="l18.33"> </span>
<a href="#l18.34"></a><span id="l18.34">   // nsISuiteProfileMigrator methods</span>
<a href="#l18.35"></a><span id="l18.35">   NS_IMETHOD Migrate(uint16_t aItems, nsIProfileStartup *aStartup,</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l19.1"></a><span id="l19.1" class="difflineminus">--- a/suite/components/moz.build</span>
<a href="#l19.2"></a><span id="l19.2" class="difflineplus">+++ b/suite/components/moz.build</span>
<a href="#l19.3"></a><span id="l19.3" class="difflineat">@@ -7,16 +7,17 @@</span>
<a href="#l19.4"></a><span id="l19.4"> DIRS += [</span>
<a href="#l19.5"></a><span id="l19.5">     'autocomplete',</span>
<a href="#l19.6"></a><span id="l19.6">     'bindings',</span>
<a href="#l19.7"></a><span id="l19.7">     'console',</span>
<a href="#l19.8"></a><span id="l19.8">     'dataman',</span>
<a href="#l19.9"></a><span id="l19.9">     'downloads',</span>
<a href="#l19.10"></a><span id="l19.10">     'feeds',</span>
<a href="#l19.11"></a><span id="l19.11">     'helpviewer',</span>
<a href="#l19.12"></a><span id="l19.12" class="difflineplus">+    'migration',</span>
<a href="#l19.13"></a><span id="l19.13">     'permissions',</span>
<a href="#l19.14"></a><span id="l19.14">     'places',</span>
<a href="#l19.15"></a><span id="l19.15">     'pref',</span>
<a href="#l19.16"></a><span id="l19.16">     'profile',</span>
<a href="#l19.17"></a><span id="l19.17">     'search',</span>
<a href="#l19.18"></a><span id="l19.18">     'sessionstore',</span>
<a href="#l19.19"></a><span id="l19.19">     'shell',</span>
<a href="#l19.20"></a><span id="l19.20">     'sidebar',</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l20.1"></a><span id="l20.1" class="difflineminus">--- a/suite/components/profile/content/profileSelection.js</span>
<a href="#l20.2"></a><span id="l20.2" class="difflineplus">+++ b/suite/components/profile/content/profileSelection.js</span>
<a href="#l20.3"></a><span id="l20.3" class="difflineat">@@ -122,21 +122,21 @@ function AcceptDialog()</span>
<a href="#l20.4"></a><span id="l20.4">     gPromptService.alert(window, null, message);</span>
<a href="#l20.5"></a><span id="l20.5">     return false;</span>
<a href="#l20.6"></a><span id="l20.6">   }</span>
<a href="#l20.7"></a><span id="l20.7"> </span>
<a href="#l20.8"></a><span id="l20.8">   // Although switching profile works by performing a restart internally,</span>
<a href="#l20.9"></a><span id="l20.9">   // the user is quitting the old profile, so make it look like a quit.</span>
<a href="#l20.10"></a><span id="l20.10">   var cancelQuit = Cc[&quot;@mozilla.org/supports-PRBool;1&quot;]</span>
<a href="#l20.11"></a><span id="l20.11">                      .createInstance(Ci.nsISupportsPRBool);</span>
<a href="#l20.12"></a><span id="l20.12" class="difflineminus">-  Cc[&quot;@mozilla.org/observer-service;1&quot;]</span>
<a href="#l20.13"></a><span id="l20.13" class="difflineminus">-    .getService(Ci.nsIObserverService)</span>
<a href="#l20.14"></a><span id="l20.14" class="difflineminus">-    .notifyObservers(cancelQuit, &quot;quit-application-requested&quot;);</span>
<a href="#l20.15"></a><span id="l20.15" class="difflineminus">-  if (cancelQuit.data)</span>
<a href="#l20.16"></a><span id="l20.16" class="difflineplus">+  Services.obs.notifyObservers(cancelQuit, &quot;quit-application-requested&quot;);</span>
<a href="#l20.17"></a><span id="l20.17" class="difflineplus">+</span>
<a href="#l20.18"></a><span id="l20.18" class="difflineplus">+  if (cancelQuit.data) {</span>
<a href="#l20.19"></a><span id="l20.19">     return false;</span>
<a href="#l20.20"></a><span id="l20.20" class="difflineplus">+  }</span>
<a href="#l20.21"></a><span id="l20.21"> </span>
<a href="#l20.22"></a><span id="l20.22">   try {</span>
<a href="#l20.23"></a><span id="l20.23">     var env = Cc[&quot;@mozilla.org/process/environment;1&quot;]</span>
<a href="#l20.24"></a><span id="l20.24">                 .getService(Ci.nsIEnvironment);</span>
<a href="#l20.25"></a><span id="l20.25">     env.set(&quot;XRE_PROFILE_NAME&quot;, selected.profile.name);</span>
<a href="#l20.26"></a><span id="l20.26">     env.set(&quot;XRE_PROFILE_PATH&quot;, selected.profile.rootDir.path);</span>
<a href="#l20.27"></a><span id="l20.27">     env.set(&quot;XRE_PROFILE_LOCAL_PATH&quot;, selected.profile.localDir.path);</span>
<a href="#l20.28"></a><span id="l20.28">     var app = Cc[&quot;@mozilla.org/toolkit/app-startup;1&quot;]</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l21.1"></a><span id="l21.1" class="difflineminus">--- a/suite/components/profile/jar.mn</span>
<a href="#l21.2"></a><span id="l21.2" class="difflineplus">+++ b/suite/components/profile/jar.mn</span>
<a href="#l21.3"></a><span id="l21.3" class="difflineat">@@ -1,11 +1,8 @@</span>
<a href="#l21.4"></a><span id="l21.4"> # This Source Code Form is subject to the terms of the Mozilla Public</span>
<a href="#l21.5"></a><span id="l21.5"> # License, v. 2.0. If a copy of the MPL was not distributed with this</span>
<a href="#l21.6"></a><span id="l21.6"> # file, You can obtain one at http://mozilla.org/MPL/2.0/.</span>
<a href="#l21.7"></a><span id="l21.7"> </span>
<a href="#l21.8"></a><span id="l21.8"> comm.jar:</span>
<a href="#l21.9"></a><span id="l21.9"> % override chrome://mozapps/content/profile/profileSelection.xul chrome://communicator/content/profile/profileSelection.xul</span>
<a href="#l21.10"></a><span id="l21.10" class="difflineminus">-  content/communicator/migration/migration.xul                     (content/migration.xul)</span>
<a href="#l21.11"></a><span id="l21.11" class="difflineminus">-  content/communicator/migration/migration.js                      (content/migration.js)</span>
<a href="#l21.12"></a><span id="l21.12">   content/communicator/profile/profileSelection.js                 (content/profileSelection.js)</span>
<a href="#l21.13"></a><span id="l21.13">   content/communicator/profile/profileSelection.xul                (content/profileSelection.xul)</span>
<a href="#l21.14"></a><span id="l21.14" class="difflineminus">-</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l22.1"></a><span id="l22.1" class="difflineminus">--- a/suite/components/profile/moz.build</span>
<a href="#l22.2"></a><span id="l22.2" class="difflineplus">+++ b/suite/components/profile/moz.build</span>
<a href="#l22.3"></a><span id="l22.3" class="difflineat">@@ -1,30 +1,13 @@</span>
<a href="#l22.4"></a><span id="l22.4"> # -*- Mode: python; indent-tabs-mode: nil; tab-width: 40 -*-</span>
<a href="#l22.5"></a><span id="l22.5"> # vim: set filetype=python:</span>
<a href="#l22.6"></a><span id="l22.6"> # This Source Code Form is subject to the terms of the Mozilla Public</span>
<a href="#l22.7"></a><span id="l22.7"> # License, v. 2.0. If a copy of the MPL was not distributed with this</span>
<a href="#l22.8"></a><span id="l22.8"> # file, You can obtain one at http://mozilla.org/MPL/2.0/.</span>
<a href="#l22.9"></a><span id="l22.9"> </span>
<a href="#l22.10"></a><span id="l22.10" class="difflineminus">-XPIDL_SOURCES += [</span>
<a href="#l22.11"></a><span id="l22.11" class="difflineminus">-    'nsISuiteProfileMigrator.idl',</span>
<a href="#l22.12"></a><span id="l22.12" class="difflineminus">-]</span>
<a href="#l22.13"></a><span id="l22.13" class="difflineminus">-</span>
<a href="#l22.14"></a><span id="l22.14" class="difflineminus">-XPIDL_MODULE = 'suitemigration'</span>
<a href="#l22.15"></a><span id="l22.15" class="difflineminus">-</span>
<a href="#l22.16"></a><span id="l22.16"> SOURCES += [</span>
<a href="#l22.17"></a><span id="l22.17" class="difflineminus">-    'nsNetscapeProfileMigratorBase.cpp',</span>
<a href="#l22.18"></a><span id="l22.18">     'nsSuiteDirectoryProvider.cpp',</span>
<a href="#l22.19"></a><span id="l22.19" class="difflineminus">-    'nsSuiteProfileMigratorUtils.cpp',</span>
<a href="#l22.20"></a><span id="l22.20" class="difflineminus">-    'nsThunderbirdProfileMigrator.cpp',</span>
<a href="#l22.21"></a><span id="l22.21" class="difflineminus">-]</span>
<a href="#l22.22"></a><span id="l22.22" class="difflineminus">-</span>
<a href="#l22.23"></a><span id="l22.23" class="difflineminus">-EXTRA_COMPONENTS += [</span>
<a href="#l22.24"></a><span id="l22.24" class="difflineminus">-    'SuiteProfileMigrator.manifest',</span>
<a href="#l22.25"></a><span id="l22.25" class="difflineminus">-]</span>
<a href="#l22.26"></a><span id="l22.26" class="difflineminus">-</span>
<a href="#l22.27"></a><span id="l22.27" class="difflineminus">-EXTRA_PP_COMPONENTS += [</span>
<a href="#l22.28"></a><span id="l22.28" class="difflineminus">-    'SuiteProfileMigrator.js',</span>
<a href="#l22.29"></a><span id="l22.29"> ]</span>
<a href="#l22.30"></a><span id="l22.30"> </span>
<a href="#l22.31"></a><span id="l22.31"> FINAL_LIBRARY = 'suite'</span>
<a href="#l22.32"></a><span id="l22.32"> </span>
<a href="#l22.33"></a><span id="l22.33"> JAR_MANIFESTS += ['jar.mn']</span></pre></div></div>

<div class="page_footer">
<div class="page_footer_text">comm-central</div>
<div class="page_footer_text" style="padding-left: 10px">Deployed from <a href="https://hg.mozilla.org/hgcustom/version-control-tools/rev/4b0de666d1a4">4b0de666d1a4</a> at 2020-07-30T19:32:33Z.</div>
<div class="rss_logo">
<a href="/comm-central/rss-log">RSS</a>
<a href="/comm-central/atom-log">Atom</a>
</div>
<br />

</div>
</body>
</html>

