<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en-US" lang="en-US">
<head>
<link rel="icon" href="/static/4b0de666d1a4/hgicon.png" type="image/png" />
<meta name="robots" content="index, nofollow"/>
<link rel="stylesheet" href="/static/4b0de666d1a4/style-gitweb.css" type="text/css" />

<style type="text/css">
div.feed {
  float: right;
}
a img {
  border-width: 0px;
}
div.log_link {
  width: 80px;
  background-color: white;
}

div.log_body {
  padding-left: 96px;
}
</style>
<script type="text/javascript" src="/static/4b0de666d1a4/mercurial.js"></script>

<meta property="og:image" content="/static/4b0de666d1a4/moz-logo-bw-rgb.svg"/>
<meta property="og:type" content="website"/>

<title>comm-central: changeset 25800:d7cd1486000de536ecc74181c6d27e3b9467786a</title>
<link rel="alternate" type="application/atom+xml"
   href="/comm-central/atom-log" title="Atom feed for comm-central"/>
<link rel="alternate" type="application/rss+xml"
   href="/comm-central/rss-log" title="RSS feed for comm-central"/>

<meta property="og:title" content="comm-central @ d7cd1486000de536ecc74181c6d27e3b9467786a" />
<meta property="og:url" content="/comm-central/rev/d7cd1486000de536ecc74181c6d27e3b9467786a" />
<meta property="og:description" content="Bug 1525072 - remove unused context variables r=rjl" />

</head>
<body>

<div class="page_header">
<div class="logo">
    <a href="https://developer.mozilla.org/en/docs/Mercurial">
        <img src="/static/4b0de666d1a4/moz-logo-bw-rgb.svg" alt="mercurial" />
    </a>
</div>
<a href="/">Mercurial</a> &gt; <a href="/comm-central">comm-central</a>  / changeset / d7cd1486000de536ecc74181c6d27e3b9467786a 
</div>

<div class="page_nav">
<div>
<a href="/comm-central/summary">summary</a> |
<a href="/comm-central/shortlog/d7cd1486000de536ecc74181c6d27e3b9467786a">shortlog</a> |
<a href="/comm-central/log/d7cd1486000de536ecc74181c6d27e3b9467786a">changelog</a> |
<a href="/comm-central/pushloghtml">pushlog</a> |
<a href="/comm-central/graph/d7cd1486000de536ecc74181c6d27e3b9467786a">graph</a> |
<a href="/comm-central/tags">tags</a> |
<a href="/comm-central/bookmarks">bookmarks</a> |
<a href="/comm-central/branches">branches</a> |
<a href="/comm-central/file/d7cd1486000de536ecc74181c6d27e3b9467786a">files</a> |
changeset |
<a href="/comm-central/raw-rev/d7cd1486000de536ecc74181c6d27e3b9467786a">raw</a>  | <a href="/comm-central/archive/d7cd1486000de536ecc74181c6d27e3b9467786a.zip">zip</a>  |
<a href="/comm-central/help">help</a>
</div>

<div class="search">
<form id="searchform" action="/comm-central/log">

<input name="rev" type="text" value="" size="40" />
<div id="hint">Find changesets by keywords (author, files, the commit message), revision
number or hash, or <a href="/comm-central/help/revsets">revset expression</a>.</div>
</form>
</div>
</div>

<div class="title">
<a href="https://bugzilla.mozilla.org/show_bug.cgi?id=1525072">Bug 1525072</a> - remove unused context variables r=rjl
<span class="logtags"></span>
</div>
<div class="title_text">
<table cellspacing="0">

<tr><td>author</td><td>&#68;&#117;&#115;&#116;&#105;&#110;&#32;&#74;&#46;&#32;&#77;&#105;&#116;&#99;&#104;&#101;&#108;&#108;&#32;&#60;&#100;&#117;&#115;&#116;&#105;&#110;&#64;&#109;&#111;&#122;&#105;&#108;&#108;&#97;&#46;&#99;&#111;&#109;&#62;</td></tr>
<tr><td></td><td class="date age">Thu, 07 Feb 2019 21:57:39 +0000</td></tr>

<tr>
 <td>changeset 25800</td>
 <td style="font-family:monospace"><a class="list" href="/comm-central/rev/d7cd1486000de536ecc74181c6d27e3b9467786a">d7cd1486000de536ecc74181c6d27e3b9467786a</a></td>
</tr>



<tr>
<td>parent 25799</td>
<td style="font-family:monospace">
<a class="list" href="/comm-central/rev/88730121e453cf6d4fb047d3e61b84ce51a1f7b0">88730121e453cf6d4fb047d3e61b84ce51a1f7b0</a>
</td>
</tr>

<tr>
<td>child 25801</td>
<td style="font-family:monospace">
<a class="list" href="/comm-central/rev/681d46f5ab37ec3bea2bf9f600a152f56c06242a">681d46f5ab37ec3bea2bf9f600a152f56c06242a</a>
</td>
</tr>
<tr><td>push id</td><td><a href="/comm-central/pushloghtml?changeset=d7cd1486000de536ecc74181c6d27e3b9467786a">15482</a></td></tr>
<tr><td>push user</td><td>thunderbird@calypsoblue.org</td></tr>
<tr><td>push date</td><td class="date age">Fri, 08 Feb 2019 17:38:03 +0000</td></tr>

<tr><td>treeherder</td><td>comm-central@d7cd1486000d [<a href="https://treeherder.mozilla.org/#/jobs?repo=comm-central&revision=d7cd1486000de536ecc74181c6d27e3b9467786a">default view</a>] [<a href="https://treeherder.mozilla.org/#/jobs?repo=comm-central&revision=d7cd1486000de536ecc74181c6d27e3b9467786a&filter-resultStatus=testfailed&filter-resultStatus=busted&filter-resultStatus=exception">failures only]</td></tr>
<tr><td>perfherder</td><td>[<a href="https://treeherder.mozilla.org/perf.html#/compare?originalProject=comm-central&originalRevision=d7cd1486000de536ecc74181c6d27e3b9467786a&newProject=comm-central&newRevision=d7cd1486000de536ecc74181c6d27e3b9467786a&framework=1" target="_blank">talos</a>] [<a href="https://treeherder.mozilla.org/perf.html#/compare?originalProject=comm-central&originalRevision=d7cd1486000de536ecc74181c6d27e3b9467786a&newProject=comm-central&newRevision=d7cd1486000de536ecc74181c6d27e3b9467786a&framework=2" target="_blank">build metrics</a>] [<a href="https://treeherder.mozilla.org/perf.html#/compare?originalProject=comm-central&originalRevision=d7cd1486000de536ecc74181c6d27e3b9467786a&newProject=comm-central&newRevision=d7cd1486000de536ecc74181c6d27e3b9467786a&framework=6" target="_blank">platform microbench</a>] (compared to previous push)</td></tr>
<tr><td>reviewers</td><td><a href="/comm-central/log?rev=reviewer%28rjl%29&revcount=50">rjl</a></td></tr>
<tr><td>bugs</td><td><a href="https://bugzilla.mozilla.org/show_bug.cgi?id=1525072">1525072</a></td></tr>




</table></div>

<div class="page_body description"><a href="https://bugzilla.mozilla.org/show_bug.cgi?id=1525072">Bug 1525072</a> - remove unused context variables r=rjl

Comment is particularly critical, since it is based on push.comment which soon
won't exist.

This also copies some explanatory comments about the context in which this file
is interpreted from mozilla-central.

Differential Revision: <a href="https://phabricator.services.mozilla.com/D19036">https://phabricator.services.mozilla.com/D19036</a></div>
<div class="list_head"></div>
<div class="title_text">
<table cellspacing="0">

<tr class="parity0">
<td><a class="list" href="/comm-central/diff/d7cd1486000de536ecc74181c6d27e3b9467786a/.taskcluster.yml">.taskcluster.yml</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/d7cd1486000de536ecc74181c6d27e3b9467786a/.taskcluster.yml">file</a> |
<a href="/comm-central/annotate/d7cd1486000de536ecc74181c6d27e3b9467786a/.taskcluster.yml">annotate</a> |
<a href="/comm-central/diff/d7cd1486000de536ecc74181c6d27e3b9467786a/.taskcluster.yml">diff</a> |
<a href="/comm-central/comparison/d7cd1486000de536ecc74181c6d27e3b9467786a/.taskcluster.yml">comparison</a> |
<a href="/comm-central/log/d7cd1486000de536ecc74181c6d27e3b9467786a/.taskcluster.yml">revisions</a>
</td>
</tr>
</table></div>

<div class="page_body diffblocks"><div class="diffblock"><pre class="sourcelines">
<a href="#l1.1"></a><span id="l1.1" class="difflineminus">--- a/.taskcluster.yml</span>
<a href="#l1.2"></a><span id="l1.2" class="difflineplus">+++ b/.taskcluster.yml</span>
<a href="#l1.3"></a><span id="l1.3" class="difflineat">@@ -1,28 +1,68 @@</span>
<a href="#l1.4"></a><span id="l1.4"> ---</span>
<a href="#l1.5"></a><span id="l1.5"> # This file is rendered via JSON-e by</span>
<a href="#l1.6"></a><span id="l1.6" class="difflineminus">-# - mozilla-taskcluster - https://docs.taskcluster.net/reference/integrations/mozilla-taskcluster/docs/taskcluster-yml</span>
<a href="#l1.7"></a><span id="l1.7" class="difflineminus">-# - cron tasks - taskcluster/taskgraph/cron/decision.py</span>
<a href="#l1.8"></a><span id="l1.8" class="difflineminus">-# - action tasks - taskcluster/taskgraph/actions/registry.py</span>
<a href="#l1.9"></a><span id="l1.9" class="difflineplus">+# - mozilla-taskcluster - See</span>
<a href="#l1.10"></a><span id="l1.10" class="difflineplus">+#   https://docs.taskcluster.net/reference/integrations/mozilla-taskcluster/docs/taskcluster-yml</span>
<a href="#l1.11"></a><span id="l1.11" class="difflineplus">+#   {</span>
<a href="#l1.12"></a><span id="l1.12" class="difflineplus">+#     tasks_for: 'hg-push',</span>
<a href="#l1.13"></a><span id="l1.13" class="difflineplus">+#     push: {owner, comment, pushlog_id, pushdate},</span>
<a href="#l1.14"></a><span id="l1.14" class="difflineplus">+#     repository: {url, project, level},</span>
<a href="#l1.15"></a><span id="l1.15" class="difflineplus">+#     now,</span>
<a href="#l1.16"></a><span id="l1.16" class="difflineplus">+#     as_slugid: // function</span>
<a href="#l1.17"></a><span id="l1.17" class="difflineplus">+#     ownTaskId: // taskId of the task that will be created</span>
<a href="#l1.18"></a><span id="l1.18" class="difflineplus">+#   }</span>
<a href="#l1.19"></a><span id="l1.19" class="difflineplus">+#</span>
<a href="#l1.20"></a><span id="l1.20" class="difflineplus">+# - cron tasks - See taskcluster/taskgraph/cron/decision.py</span>
<a href="#l1.21"></a><span id="l1.21" class="difflineplus">+#   {</span>
<a href="#l1.22"></a><span id="l1.22" class="difflineplus">+#     tasks_for: 'cron',</span>
<a href="#l1.23"></a><span id="l1.23" class="difflineplus">+#     push: {revision, pushlog_id, pushdate, owner}</span>
<a href="#l1.24"></a><span id="l1.24" class="difflineplus">+#     repository: {url, project, level},</span>
<a href="#l1.25"></a><span id="l1.25" class="difflineplus">+#     cron: {task_id, job_name, job_symbol, quoted_args},</span>
<a href="#l1.26"></a><span id="l1.26" class="difflineplus">+#     now,</span>
<a href="#l1.27"></a><span id="l1.27" class="difflineplus">+#     ownTaskId: // taskId of the task that will be created</span>
<a href="#l1.28"></a><span id="l1.28" class="difflineplus">+#   }</span>
<a href="#l1.29"></a><span id="l1.29" class="difflineplus">+#</span>
<a href="#l1.30"></a><span id="l1.30" class="difflineplus">+# - action tasks - See:</span>
<a href="#l1.31"></a><span id="l1.31" class="difflineplus">+#   * taskcluster/taskgraph/actions/registry.py,</span>
<a href="#l1.32"></a><span id="l1.32" class="difflineplus">+#   * https://docs.taskcluster.net/docs/manual/using/actions/spec</span>
<a href="#l1.33"></a><span id="l1.33" class="difflineplus">+#   * ci-admin:ciadmin/generate/in_tree_actions.py</span>
<a href="#l1.34"></a><span id="l1.34" class="difflineplus">+#</span>
<a href="#l1.35"></a><span id="l1.35" class="difflineplus">+#   The registry generates the hookPayload that appears in actions.json, and</span>
<a href="#l1.36"></a><span id="l1.36" class="difflineplus">+#   contains data from the decision task as well as JSON-e code to combine that</span>
<a href="#l1.37"></a><span id="l1.37" class="difflineplus">+#   with data supplied as part of the action spec.  When the hook is fired, the</span>
<a href="#l1.38"></a><span id="l1.38" class="difflineplus">+#   hookPayload is rendered with JSON-e to produce a payload for the hook task</span>
<a href="#l1.39"></a><span id="l1.39" class="difflineplus">+#   template.</span>
<a href="#l1.40"></a><span id="l1.40" class="difflineplus">+#</span>
<a href="#l1.41"></a><span id="l1.41" class="difflineplus">+#   The ci-admin code wraps the content of this file (.taskcluster.yml) with a</span>
<a href="#l1.42"></a><span id="l1.42" class="difflineplus">+#   JSON-e $let statement that produces the context described below, and</span>
<a href="#l1.43"></a><span id="l1.43" class="difflineplus">+#   installs that as the hook task template.</span>
<a href="#l1.44"></a><span id="l1.44" class="difflineplus">+#</span>
<a href="#l1.45"></a><span id="l1.45" class="difflineplus">+#   {</span>
<a href="#l1.46"></a><span id="l1.46" class="difflineplus">+#     tasks_for: 'action',</span>
<a href="#l1.47"></a><span id="l1.47" class="difflineplus">+#     push: {owner, pushlog_id, revision},</span>
<a href="#l1.48"></a><span id="l1.48" class="difflineplus">+#     repository: {url, project, level},</span>
<a href="#l1.49"></a><span id="l1.49" class="difflineplus">+#     input,</span>
<a href="#l1.50"></a><span id="l1.50" class="difflineplus">+#     parameters,</span>
<a href="#l1.51"></a><span id="l1.51" class="difflineplus">+#     taskId,      // targetted taskId</span>
<a href="#l1.52"></a><span id="l1.52" class="difflineplus">+#     taskGroupId, // targetted taskGroupId</span>
<a href="#l1.53"></a><span id="l1.53" class="difflineplus">+#     action: {name, title, description, taskGroupId, symbol, repo_scope, cb_name}</span>
<a href="#l1.54"></a><span id="l1.54" class="difflineplus">+#     ownTaskId:   // taskId of the task that will be created</span>
<a href="#l1.55"></a><span id="l1.55" class="difflineplus">+#   }</span>
<a href="#l1.56"></a><span id="l1.56"> </span>
<a href="#l1.57"></a><span id="l1.57"> version: 1</span>
<a href="#l1.58"></a><span id="l1.58"> </span>
<a href="#l1.59"></a><span id="l1.59"> tasks:</span>
<a href="#l1.60"></a><span id="l1.60">   - $let:</span>
<a href="#l1.61"></a><span id="l1.61">       # sometimes the push user is just `ffxbld` or the like, but we want an email-like field..</span>
<a href="#l1.62"></a><span id="l1.62">       ownerEmail: {$if: '&quot;@&quot; in push.owner', then: '${push.owner}', else: '${push.owner}@noreply.mozilla.org'}</span>
<a href="#l1.63"></a><span id="l1.63">       # ensure there's no trailing `/` on the repo URL</span>
<a href="#l1.64"></a><span id="l1.64">       repoUrl: {$if: 'repository.url[-1] == &quot;/&quot;', then: {$eval: 'repository.url[:-1]'}, else: {$eval: 'repository.url'}}</span>
<a href="#l1.65"></a><span id="l1.65">       # Hardcode cron push info for now, so that we can transition to using real values without breaking callers of Chain of Trust</span>
<a href="#l1.66"></a><span id="l1.66">       _pushId: {$if: 'tasks_for == &quot;cron&quot;', then: '-1', else: {$eval: 'push.pushlog_id'}}</span>
<a href="#l1.67"></a><span id="l1.67" class="difflineminus">-      # action tasks can fail because of no pushdate or push comment information in context, so include them in</span>
<a href="#l1.68"></a><span id="l1.68" class="difflineminus">-      # hardcodes (even though they don't use these variables)</span>
<a href="#l1.69"></a><span id="l1.69" class="difflineminus">-      _pushDate: {$if: 'tasks_for == &quot;cron&quot; || tasks_for == &quot;action&quot;', then: '0', else: {$eval: 'push.pushdate'}}</span>
<a href="#l1.70"></a><span id="l1.70" class="difflineminus">-      _pushComment: {$if: 'tasks_for == &quot;cron&quot; || tasks_for == &quot;action&quot;', then: '', else: {$eval: 'push.comment'}}</span>
<a href="#l1.71"></a><span id="l1.71">     in:</span>
<a href="#l1.72"></a><span id="l1.72">       taskId: {$if: 'tasks_for != &quot;action&quot;', then: '${ownTaskId}'}</span>
<a href="#l1.73"></a><span id="l1.73">       taskGroupId:</span>
<a href="#l1.74"></a><span id="l1.74">         $if: 'tasks_for == &quot;action&quot;'</span>
<a href="#l1.75"></a><span id="l1.75">         then:</span>
<a href="#l1.76"></a><span id="l1.76">           '${action.taskGroupId}'</span>
<a href="#l1.77"></a><span id="l1.77">         else:</span>
<a href="#l1.78"></a><span id="l1.78">           '${ownTaskId}'  # same as taskId; this is how automation identifies a decision tsak</span></pre></div></div>

<div class="page_footer">
<div class="page_footer_text">comm-central</div>
<div class="page_footer_text" style="padding-left: 10px">Deployed from <a href="https://hg.mozilla.org/hgcustom/version-control-tools/rev/4b0de666d1a4">4b0de666d1a4</a> at 2020-07-30T19:32:31Z.</div>
<div class="rss_logo">
<a href="/comm-central/rss-log">RSS</a>
<a href="/comm-central/atom-log">Atom</a>
</div>
<br />

</div>
</body>
</html>

