<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en-US" lang="en-US">
<head>
<link rel="icon" href="/static/35f393d6769a/hgicon.png" type="image/png" />
<meta name="robots" content="index, nofollow"/>
<link rel="stylesheet" href="/static/35f393d6769a/style-gitweb.css" type="text/css" />

<style type="text/css">
div.feed {
  float: right;
}
a img {
  border-width: 0px;
}
div.log_link {
  width: 80px;
  background-color: white;
}

div.log_body {
  padding-left: 96px;
}
</style>
<script type="text/javascript" src="/static/35f393d6769a/mercurial.js"></script>

<meta property="og:image" content="/static/35f393d6769a/moz-logo-bw-rgb.svg"/>
<meta property="og:type" content="website"/>

<title>comm-central: changeset 21302:05be743c0ebcecaa8cfc9327cbc04e1a26262134</title>
<link rel="alternate" type="application/atom+xml"
   href="/comm-central/atom-log" title="Atom feed for comm-central"/>
<link rel="alternate" type="application/rss+xml"
   href="/comm-central/rss-log" title="RSS feed for comm-central"/>

<meta property="og:title" content="comm-central @ 05be743c0ebcecaa8cfc9327cbc04e1a26262134" />
<meta property="og:url" content="/comm-central/rev/05be743c0ebcecaa8cfc9327cbc04e1a26262134" />
<meta property="og:description" content="Bug 1105660 - Rework the /mode and /umode commands. r=clokep" />

</head>
<body>

<div class="page_header">
<div class="logo">
    <a href="https://developer.mozilla.org/en/docs/Mercurial">
        <img src="/static/35f393d6769a/moz-logo-bw-rgb.svg" alt="mercurial" />
    </a>
</div>
<a href="/">Mercurial</a> &gt; <a href="/comm-central">comm-central</a>  / changeset / 05be743c0ebcecaa8cfc9327cbc04e1a26262134 
</div>

<div class="page_nav">
<div>
<a href="/comm-central/summary">summary</a> |
<a href="/comm-central/shortlog/05be743c0ebcecaa8cfc9327cbc04e1a26262134">shortlog</a> |
<a href="/comm-central/log/05be743c0ebcecaa8cfc9327cbc04e1a26262134">changelog</a> |
<a href="/comm-central/pushloghtml">pushlog</a> |
<a href="/comm-central/graph/05be743c0ebcecaa8cfc9327cbc04e1a26262134">graph</a> |
<a href="/comm-central/tags">tags</a> |
<a href="/comm-central/bookmarks">bookmarks</a> |
<a href="/comm-central/branches">branches</a> |
<a href="/comm-central/file/05be743c0ebcecaa8cfc9327cbc04e1a26262134">files</a> |
changeset |
<a href="/comm-central/raw-rev/05be743c0ebcecaa8cfc9327cbc04e1a26262134">raw</a>  | <a href="/comm-central/archive/05be743c0ebcecaa8cfc9327cbc04e1a26262134.zip">zip</a>  |
<a href="/comm-central/help">help</a>
</div>

<div class="search">
<form id="searchform" action="/comm-central/log">

<input name="rev" type="text" value="" size="40" />
<div id="hint">Find changesets by keywords (author, files, the commit message), revision
number or hash, or <a href="/comm-central/help/revsets">revset expression</a>.</div>
</form>
</div>
</div>

<div class="title">
<a href="https://bugzilla.mozilla.org/show_bug.cgi?id=1105660">Bug 1105660</a> - Rework the /mode and /umode commands. r=clokep
<span class="logtags"></span>
</div>
<div class="title_text">
<table cellspacing="0">

<tr><td>author</td><td>&#80;&#97;&#118;&#97;&#110;&#32;&#60;&#112;&#97;&#118;&#97;&#110;&#107;&#97;&#114;&#116;&#104;&#105;&#107;&#98;&#111;&#100;&#100;&#101;&#100;&#97;&#64;&#103;&#109;&#97;&#105;&#108;&#46;&#99;&#111;&#109;&#62;</td></tr>
<tr><td></td><td class="date age">Wed, 01 Mar 2017 08:11:00 -0500</td></tr>

<tr>
 <td>changeset 21302</td>
 <td style="font-family:monospace"><a class="list" href="/comm-central/rev/05be743c0ebcecaa8cfc9327cbc04e1a26262134">05be743c0ebcecaa8cfc9327cbc04e1a26262134</a></td>
</tr>



<tr>
<td>parent 21301</td>
<td style="font-family:monospace">
<a class="list" href="/comm-central/rev/7e17ca62288483103270b0cbbf0be018cac10f39">7e17ca62288483103270b0cbbf0be018cac10f39</a>
</td>
</tr>

<tr>
<td>child 21303</td>
<td style="font-family:monospace">
<a class="list" href="/comm-central/rev/6f7b36eb5ee1c842212aab5e463ab1caca8255af">6f7b36eb5ee1c842212aab5e463ab1caca8255af</a>
</td>
</tr>
<tr><td>push id</td><td><a href="/comm-central/pushloghtml?changeset=05be743c0ebcecaa8cfc9327cbc04e1a26262134">12948</a></td></tr>
<tr><td>push user</td><td>clokep@gmail.com</td></tr>
<tr><td>push date</td><td class="date age">Tue, 14 Mar 2017 23:44:14 +0000</td></tr>

<tr><td>treeherder</td><td>comm-central@05be743c0ebc [<a href="https://treeherder.mozilla.org/#/jobs?repo=comm-central&revision=05be743c0ebcecaa8cfc9327cbc04e1a26262134">default view</a>] [<a href="https://treeherder.mozilla.org/#/jobs?repo=comm-central&revision=05be743c0ebcecaa8cfc9327cbc04e1a26262134&filter-resultStatus=testfailed&filter-resultStatus=busted&filter-resultStatus=exception">failures only]</td></tr>
<tr><td>perfherder</td><td>[<a href="https://treeherder.mozilla.org/perf.html#/compare?originalProject=comm-central&originalRevision=05be743c0ebcecaa8cfc9327cbc04e1a26262134&newProject=comm-central&newRevision=05be743c0ebcecaa8cfc9327cbc04e1a26262134&framework=1" target="_blank">talos</a>] [<a href="https://treeherder.mozilla.org/perf.html#/compare?originalProject=comm-central&originalRevision=05be743c0ebcecaa8cfc9327cbc04e1a26262134&newProject=comm-central&newRevision=05be743c0ebcecaa8cfc9327cbc04e1a26262134&framework=2" target="_blank">build metrics</a>] [<a href="https://treeherder.mozilla.org/perf.html#/compare?originalProject=comm-central&originalRevision=05be743c0ebcecaa8cfc9327cbc04e1a26262134&newProject=comm-central&newRevision=05be743c0ebcecaa8cfc9327cbc04e1a26262134&framework=6" target="_blank">platform microbench</a>] (compared to previous push)</td></tr>
<tr><td>reviewers</td><td><a href="/comm-central/log?rev=reviewer%28clokep%29&revcount=50">clokep</a></td></tr>
<tr><td>bugs</td><td><a href="https://bugzilla.mozilla.org/show_bug.cgi?id=1105660">1105660</a></td></tr>




</table></div>

<div class="page_body description"><a href="https://bugzilla.mozilla.org/show_bug.cgi?id=1105660">Bug 1105660</a> - Rework the /mode and /umode commands. r=clokep</div>
<div class="list_head"></div>
<div class="title_text">
<table cellspacing="0">

<tr class="parity0">
<td><a class="list" href="/comm-central/diff/05be743c0ebcecaa8cfc9327cbc04e1a26262134/chat/locales/en-US/irc.properties">chat/locales/en-US/irc.properties</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/05be743c0ebcecaa8cfc9327cbc04e1a26262134/chat/locales/en-US/irc.properties">file</a> |
<a href="/comm-central/annotate/05be743c0ebcecaa8cfc9327cbc04e1a26262134/chat/locales/en-US/irc.properties">annotate</a> |
<a href="/comm-central/diff/05be743c0ebcecaa8cfc9327cbc04e1a26262134/chat/locales/en-US/irc.properties">diff</a> |
<a href="/comm-central/comparison/05be743c0ebcecaa8cfc9327cbc04e1a26262134/chat/locales/en-US/irc.properties">comparison</a> |
<a href="/comm-central/log/05be743c0ebcecaa8cfc9327cbc04e1a26262134/chat/locales/en-US/irc.properties">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/05be743c0ebcecaa8cfc9327cbc04e1a26262134/chat/protocols/irc/ircCommands.jsm">chat/protocols/irc/ircCommands.jsm</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/05be743c0ebcecaa8cfc9327cbc04e1a26262134/chat/protocols/irc/ircCommands.jsm">file</a> |
<a href="/comm-central/annotate/05be743c0ebcecaa8cfc9327cbc04e1a26262134/chat/protocols/irc/ircCommands.jsm">annotate</a> |
<a href="/comm-central/diff/05be743c0ebcecaa8cfc9327cbc04e1a26262134/chat/protocols/irc/ircCommands.jsm">diff</a> |
<a href="/comm-central/comparison/05be743c0ebcecaa8cfc9327cbc04e1a26262134/chat/protocols/irc/ircCommands.jsm">comparison</a> |
<a href="/comm-central/log/05be743c0ebcecaa8cfc9327cbc04e1a26262134/chat/protocols/irc/ircCommands.jsm">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/05be743c0ebcecaa8cfc9327cbc04e1a26262134/chat/protocols/irc/test/test_ircCommands.js">chat/protocols/irc/test/test_ircCommands.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/05be743c0ebcecaa8cfc9327cbc04e1a26262134/chat/protocols/irc/test/test_ircCommands.js">file</a> |
<a href="/comm-central/annotate/05be743c0ebcecaa8cfc9327cbc04e1a26262134/chat/protocols/irc/test/test_ircCommands.js">annotate</a> |
<a href="/comm-central/diff/05be743c0ebcecaa8cfc9327cbc04e1a26262134/chat/protocols/irc/test/test_ircCommands.js">diff</a> |
<a href="/comm-central/comparison/05be743c0ebcecaa8cfc9327cbc04e1a26262134/chat/protocols/irc/test/test_ircCommands.js">comparison</a> |
<a href="/comm-central/log/05be743c0ebcecaa8cfc9327cbc04e1a26262134/chat/protocols/irc/test/test_ircCommands.js">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/05be743c0ebcecaa8cfc9327cbc04e1a26262134/chat/protocols/irc/test/xpcshell.ini">chat/protocols/irc/test/xpcshell.ini</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/05be743c0ebcecaa8cfc9327cbc04e1a26262134/chat/protocols/irc/test/xpcshell.ini">file</a> |
<a href="/comm-central/annotate/05be743c0ebcecaa8cfc9327cbc04e1a26262134/chat/protocols/irc/test/xpcshell.ini">annotate</a> |
<a href="/comm-central/diff/05be743c0ebcecaa8cfc9327cbc04e1a26262134/chat/protocols/irc/test/xpcshell.ini">diff</a> |
<a href="/comm-central/comparison/05be743c0ebcecaa8cfc9327cbc04e1a26262134/chat/protocols/irc/test/xpcshell.ini">comparison</a> |
<a href="/comm-central/log/05be743c0ebcecaa8cfc9327cbc04e1a26262134/chat/protocols/irc/test/xpcshell.ini">revisions</a>
</td>
</tr>
</table></div>

<div class="page_body diffblocks"><div class="diffblock"><pre class="sourcelines">
<a href="#l1.1"></a><span id="l1.1" class="difflineminus">--- a/chat/locales/en-US/irc.properties</span>
<a href="#l1.2"></a><span id="l1.2" class="difflineplus">+++ b/chat/locales/en-US/irc.properties</span>
<a href="#l1.3"></a><span id="l1.3" class="difflineat">@@ -53,18 +53,18 @@ command.ctcp=%S &amp;lt;nick&amp;gt; &amp;lt;msg&amp;gt;</span>
<a href="#l1.4"></a><span id="l1.4"> command.chanserv=%S &amp;lt;command&amp;gt;: Send a command to ChanServ.</span>
<a href="#l1.5"></a><span id="l1.5"> command.deop=%S &amp;lt;nick1&amp;gt;[,&amp;lt;nick2&amp;gt;]*: Remove channel operator status from someone. You must be a channel operator to do this.</span>
<a href="#l1.6"></a><span id="l1.6"> command.devoice=%S &amp;lt;nick1&amp;gt;[,&amp;lt;nick2&amp;gt;]*: Remove channel voice status from someone, preventing them from speaking if the channel is moderated (+m). You must be a channel operator to do this.</span>
<a href="#l1.7"></a><span id="l1.7"> command.invite2=%S &amp;lt;nick&amp;gt;[ &amp;lt;nick&amp;gt;]* [&amp;lt;channel&amp;gt;]: Invite one or more nicks to join you in the current channel, or to join the specified channel.</span>
<a href="#l1.8"></a><span id="l1.8"> command.join=%S &amp;lt;room1&amp;gt;[ &amp;lt;key1&amp;gt;][,&amp;lt;room2&amp;gt;[ &amp;lt;key2&amp;gt;]]*: Enter one or more channels, optionally providing a channel key for each if needed.</span>
<a href="#l1.9"></a><span id="l1.9"> command.kick=%S &amp;lt;nick&amp;gt; [&amp;lt;message&amp;gt;]: Remove someone from a channel. You must be a channel operator to do this.</span>
<a href="#l1.10"></a><span id="l1.10"> command.list=%S: Display a list of chat rooms on the network. Warning, some servers may disconnect you upon doing this.</span>
<a href="#l1.11"></a><span id="l1.11"> command.memoserv=%S &amp;lt;command&amp;gt;: Send a command to MemoServ.</span>
<a href="#l1.12"></a><span id="l1.12" class="difflineminus">-command.modeUser=%S (+|-)&amp;lt;new mode&amp;gt; [&amp;lt;nick&amp;gt;]: Set or unset a user's mode.</span>
<a href="#l1.13"></a><span id="l1.13" class="difflineminus">-command.modeChannel=%S &amp;lt;channel&amp;gt;[ (+|-)&amp;lt;new mode&amp;gt; [&amp;lt;parameter&amp;gt;][,&amp;lt;parameter&amp;gt;]*]: Get, set or unset a channel mode.</span>
<a href="#l1.14"></a><span id="l1.14" class="difflineplus">+command.modeUser2=%S &amp;lt;nick&amp;gt; [(+|-)&amp;lt;mode&amp;gt;]: Get, set or unset a user's mode.</span>
<a href="#l1.15"></a><span id="l1.15" class="difflineplus">+command.modeChannel2=%S [&amp;lt;channel&amp;gt;] [(+|-)&amp;lt;new mode&amp;gt; [&amp;lt;parameter&amp;gt;][,&amp;lt;parameter&amp;gt;]*]: Get, set, or unset a channel mode.</span>
<a href="#l1.16"></a><span id="l1.16"> command.msg=%S &amp;lt;nick&amp;gt; &amp;lt;message&amp;gt;: Send a private message to a user (as opposed to a channel).</span>
<a href="#l1.17"></a><span id="l1.17"> command.nick=%S &amp;lt;new nickname&amp;gt;: Change your nickname.</span>
<a href="#l1.18"></a><span id="l1.18"> command.nickserv=%S &amp;lt;command&amp;gt;: Send a command to NickServ.</span>
<a href="#l1.19"></a><span id="l1.19"> command.notice=%S &amp;lt;target&amp;gt; &amp;lt;message&amp;gt;: Send a notice to a user or channel.</span>
<a href="#l1.20"></a><span id="l1.20"> command.op=%S &amp;lt;nick1&amp;gt;[,&amp;lt;nick2&amp;gt;]*: Grant channel operator status to someone. You must be a channel operator to do this.</span>
<a href="#l1.21"></a><span id="l1.21"> command.operserv=%S &amp;lt;command&amp;gt;: Send a command to OperServ.</span>
<a href="#l1.22"></a><span id="l1.22"> command.part=%S [message]: Leave the current channel with an optional message.</span>
<a href="#l1.23"></a><span id="l1.23"> command.ping=%S [&amp;lt;nick&amp;gt;]: Asks how much lag a user (or the server if no user specified) has.</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l2.1"></a><span id="l2.1" class="difflineminus">--- a/chat/protocols/irc/ircCommands.jsm</span>
<a href="#l2.2"></a><span id="l2.2" class="difflineplus">+++ b/chat/protocols/irc/ircCommands.jsm</span>
<a href="#l2.3"></a><span id="l2.3" class="difflineat">@@ -312,59 +312,33 @@ var commands = [</span>
<a href="#l2.4"></a><span id="l2.4">   {</span>
<a href="#l2.5"></a><span id="l2.5">     name: &quot;memoserv&quot;,</span>
<a href="#l2.6"></a><span id="l2.6">     get helpString() { return _(&quot;command.memoserv&quot;, &quot;memoserv&quot;); },</span>
<a href="#l2.7"></a><span id="l2.7">     run: (aMsg, aConv) =&gt; privateMessage(aConv, aMsg, &quot;MemoServ&quot;)</span>
<a href="#l2.8"></a><span id="l2.8">   },</span>
<a href="#l2.9"></a><span id="l2.9">   {</span>
<a href="#l2.10"></a><span id="l2.10">     name: &quot;mode&quot;,</span>
<a href="#l2.11"></a><span id="l2.11">     get helpString() {</span>
<a href="#l2.12"></a><span id="l2.12" class="difflineminus">-      return _(&quot;command.modeUser&quot;, &quot;mode&quot;) + &quot;\n&quot; +</span>
<a href="#l2.13"></a><span id="l2.13" class="difflineminus">-             _(&quot;command.modeChannel&quot;, &quot;mode&quot;);</span>
<a href="#l2.14"></a><span id="l2.14" class="difflineplus">+      return _(&quot;command.modeUser2&quot;, &quot;mode&quot;) + &quot;\n&quot; +</span>
<a href="#l2.15"></a><span id="l2.15" class="difflineplus">+             _(&quot;command.modeChannel2&quot;, &quot;mode&quot;);</span>
<a href="#l2.16"></a><span id="l2.16">     },</span>
<a href="#l2.17"></a><span id="l2.17">     run: function(aMsg, aConv) {</span>
<a href="#l2.18"></a><span id="l2.18">       function isMode(aString) { return &quot;+-&quot;.includes(aString[0]); }</span>
<a href="#l2.19"></a><span id="l2.19">       let params = splitInput(aMsg);</span>
<a href="#l2.20"></a><span id="l2.20" class="difflineminus">-</span>
<a href="#l2.21"></a><span id="l2.21" class="difflineminus">-      // Check if we have any params, we can't just check params.length, since</span>
<a href="#l2.22"></a><span id="l2.22" class="difflineminus">-      // that will always be at least 1 (but params[0] would be empty).</span>
<a href="#l2.23"></a><span id="l2.23" class="difflineminus">-      let hasParams = !/^\s*$/.test(aMsg);</span>
<a href="#l2.24"></a><span id="l2.24" class="difflineminus">-      let account = getAccount(aConv);</span>
<a href="#l2.25"></a><span id="l2.25" class="difflineminus">-      // These must be false if we don't have any paramters!</span>
<a href="#l2.26"></a><span id="l2.26" class="difflineminus">-      let isChannelName = hasParams &amp;&amp; account.isMUCName(params[0]);</span>
<a href="#l2.27"></a><span id="l2.27" class="difflineminus">-      let isOwnNick =</span>
<a href="#l2.28"></a><span id="l2.28" class="difflineminus">-        account.normalize(params[0]) == account.normalize(account._nickname);</span>
<a href="#l2.29"></a><span id="l2.29" class="difflineplus">+      let channel = aConv.name;</span>
<a href="#l2.30"></a><span id="l2.30" class="difflineplus">+      // Add the channel as parameter when the target is not specified. i.e</span>
<a href="#l2.31"></a><span id="l2.31" class="difflineplus">+      // 1. message is empty.</span>
<a href="#l2.32"></a><span id="l2.32" class="difflineplus">+      // 2. the first parameter is a mode.</span>
<a href="#l2.33"></a><span id="l2.33" class="difflineplus">+      if (!aMsg)</span>
<a href="#l2.34"></a><span id="l2.34" class="difflineplus">+        params = [channel];</span>
<a href="#l2.35"></a><span id="l2.35" class="difflineplus">+      else if (isMode(params[0]))</span>
<a href="#l2.36"></a><span id="l2.36" class="difflineplus">+        params.unshift(channel);</span>
<a href="#l2.37"></a><span id="l2.37"> </span>
<a href="#l2.38"></a><span id="l2.38" class="difflineminus">-      // If no parameters are given, the user is requesting their own mode.</span>
<a href="#l2.39"></a><span id="l2.39" class="difflineminus">-      if (!hasParams)</span>
<a href="#l2.40"></a><span id="l2.40" class="difflineminus">-        params = [aConv.nick];</span>
<a href="#l2.41"></a><span id="l2.41" class="difflineminus">-      else if (params.length == 1) {</span>
<a href="#l2.42"></a><span id="l2.42" class="difflineminus">-        // Only a mode is given, therefore the user is trying to set their own</span>
<a href="#l2.43"></a><span id="l2.43" class="difflineminus">-        // mode. We need to provide the user's nick.</span>
<a href="#l2.44"></a><span id="l2.44" class="difflineminus">-        if (isMode(params[0]))</span>
<a href="#l2.45"></a><span id="l2.45" class="difflineminus">-          params.unshift(aConv.nick);</span>
<a href="#l2.46"></a><span id="l2.46" class="difflineminus">-        // Alternately if the user gives a channel name, they're requesting a</span>
<a href="#l2.47"></a><span id="l2.47" class="difflineminus">-        // channel's mode. If they give their own nick, they're requesting their</span>
<a href="#l2.48"></a><span id="l2.48" class="difflineminus">-        // own mode. Otherwise, this is nonsensical.</span>
<a href="#l2.49"></a><span id="l2.49" class="difflineminus">-        else if (!isChannelName &amp;&amp; !isOwnNick)</span>
<a href="#l2.50"></a><span id="l2.50" class="difflineminus">-          return false;</span>
<a href="#l2.51"></a><span id="l2.51" class="difflineminus">-      }</span>
<a href="#l2.52"></a><span id="l2.52" class="difflineminus">-      else if (params.length == 2) {</span>
<a href="#l2.53"></a><span id="l2.53" class="difflineminus">-        // If a new mode and a nick are given, then we need to provide the</span>
<a href="#l2.54"></a><span id="l2.54" class="difflineminus">-        // current conversation's name.</span>
<a href="#l2.55"></a><span id="l2.55" class="difflineminus">-        if (isMode(params[0]) &amp;&amp; !isMode(params[1]))</span>
<a href="#l2.56"></a><span id="l2.56" class="difflineminus">-          params = [aConv.name, params[0], params[1]];</span>
<a href="#l2.57"></a><span id="l2.57" class="difflineminus">-        // Otherwise, the input must be a channel name or the user's own nick</span>
<a href="#l2.58"></a><span id="l2.58" class="difflineminus">-        // and a mode.</span>
<a href="#l2.59"></a><span id="l2.59" class="difflineminus">-        else if ((!isChannelName &amp;&amp; !isOwnNick) || !isMode(params[1]))</span>
<a href="#l2.60"></a><span id="l2.60" class="difflineminus">-          return false;</span>
<a href="#l2.61"></a><span id="l2.61" class="difflineminus">-      }</span>
<a href="#l2.62"></a><span id="l2.62" class="difflineminus">-      // Otherwise a channel name, new mode, and at least one parameter</span>
<a href="#l2.63"></a><span id="l2.63" class="difflineminus">-      // was given. If this is not true, return false.</span>
<a href="#l2.64"></a><span id="l2.64" class="difflineminus">-      else if (!(isChannelName &amp;&amp; isMode(params[1])))</span>
<a href="#l2.65"></a><span id="l2.65" class="difflineplus">+      // Ensure mode string to be the second argument.</span>
<a href="#l2.66"></a><span id="l2.66" class="difflineplus">+      if (params.length &gt;= 2 &amp;&amp; !isMode(params[1]))</span>
<a href="#l2.67"></a><span id="l2.67">         return false;</span>
<a href="#l2.68"></a><span id="l2.68"> </span>
<a href="#l2.69"></a><span id="l2.69">       return simpleCommand(aConv, &quot;MODE&quot;, params);</span>
<a href="#l2.70"></a><span id="l2.70">     }</span>
<a href="#l2.71"></a><span id="l2.71">   },</span>
<a href="#l2.72"></a><span id="l2.72">   {</span>
<a href="#l2.73"></a><span id="l2.73">     name: &quot;msg&quot;,</span>
<a href="#l2.74"></a><span id="l2.74">     get helpString() { return _(&quot;command.msg&quot;, &quot;msg&quot;); },</span>
<a href="#l2.75"></a><span id="l2.75" class="difflineat">@@ -490,17 +464,21 @@ var commands = [</span>
<a href="#l2.76"></a><span id="l2.76">     run: function(aMsg, aConv) {</span>
<a href="#l2.77"></a><span id="l2.77">       aConv.topic = aMsg;</span>
<a href="#l2.78"></a><span id="l2.78">       return true;</span>
<a href="#l2.79"></a><span id="l2.79">     }</span>
<a href="#l2.80"></a><span id="l2.80">   },</span>
<a href="#l2.81"></a><span id="l2.81">   {</span>
<a href="#l2.82"></a><span id="l2.82">     name: &quot;umode&quot;,</span>
<a href="#l2.83"></a><span id="l2.83">     get helpString() { return _(&quot;command.umode&quot;, &quot;umode&quot;); },</span>
<a href="#l2.84"></a><span id="l2.84" class="difflineminus">-    run: (aMsg, aConv) =&gt; simpleCommand(aConv, &quot;MODE&quot;, aMsg)</span>
<a href="#l2.85"></a><span id="l2.85" class="difflineplus">+    run: function(aMsg, aConv) {</span>
<a href="#l2.86"></a><span id="l2.86" class="difflineplus">+      let params = aMsg ? splitInput(aMsg) : [];</span>
<a href="#l2.87"></a><span id="l2.87" class="difflineplus">+      params.unshift(getAccount(aConv)._nickname);</span>
<a href="#l2.88"></a><span id="l2.88" class="difflineplus">+      return simpleCommand(aConv, &quot;MODE&quot;, params);</span>
<a href="#l2.89"></a><span id="l2.89" class="difflineplus">+    }</span>
<a href="#l2.90"></a><span id="l2.90">   },</span>
<a href="#l2.91"></a><span id="l2.91">   {</span>
<a href="#l2.92"></a><span id="l2.92">     name: &quot;version&quot;,</span>
<a href="#l2.93"></a><span id="l2.93">     get helpString() { return _(&quot;command.version&quot;, &quot;version&quot;); },</span>
<a href="#l2.94"></a><span id="l2.94">     run: function(aMsg, aConv) {</span>
<a href="#l2.95"></a><span id="l2.95">       if (!aMsg || !aMsg.trim().length)</span>
<a href="#l2.96"></a><span id="l2.96">         return false;</span>
<a href="#l2.97"></a><span id="l2.97">       ctcpCommand(aConv, aMsg, &quot;VERSION&quot;);</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l3.1"></a><span id="l3.1">new file mode 100644</span>
<a href="#l3.2"></a><span id="l3.2" class="difflineminus">--- /dev/null</span>
<a href="#l3.3"></a><span id="l3.3" class="difflineplus">+++ b/chat/protocols/irc/test/test_ircCommands.js</span>
<a href="#l3.4"></a><span id="l3.4" class="difflineat">@@ -0,0 +1,205 @@</span>
<a href="#l3.5"></a><span id="l3.5" class="difflineplus">+/* Any copyright is dedicated to the Public Domain.</span>
<a href="#l3.6"></a><span id="l3.6" class="difflineplus">+ * http://creativecommons.org/publicdomain/zero/1.0/ */</span>
<a href="#l3.7"></a><span id="l3.7" class="difflineplus">+</span>
<a href="#l3.8"></a><span id="l3.8" class="difflineplus">+Components.utils.import(&quot;resource:///modules/imServices.jsm&quot;);</span>
<a href="#l3.9"></a><span id="l3.9" class="difflineplus">+Components.utils.import(&quot;resource:///modules/ircCommands.jsm&quot;);</span>
<a href="#l3.10"></a><span id="l3.10" class="difflineplus">+</span>
<a href="#l3.11"></a><span id="l3.11" class="difflineplus">+var irc = {};</span>
<a href="#l3.12"></a><span id="l3.12" class="difflineplus">+Services.scriptloader.loadSubScript(&quot;resource:///components/irc.js&quot;, irc);</span>
<a href="#l3.13"></a><span id="l3.13" class="difflineplus">+</span>
<a href="#l3.14"></a><span id="l3.14" class="difflineplus">+// Ensure the commands have been initialized.</span>
<a href="#l3.15"></a><span id="l3.15" class="difflineplus">+Services.conversations.initConversations();</span>
<a href="#l3.16"></a><span id="l3.16" class="difflineplus">+</span>
<a href="#l3.17"></a><span id="l3.17" class="difflineplus">+var fakeProto = {</span>
<a href="#l3.18"></a><span id="l3.18" class="difflineplus">+  id: &quot;fake-proto&quot;</span>
<a href="#l3.19"></a><span id="l3.19" class="difflineplus">+}</span>
<a href="#l3.20"></a><span id="l3.20" class="difflineplus">+</span>
<a href="#l3.21"></a><span id="l3.21" class="difflineplus">+function run_test() {</span>
<a href="#l3.22"></a><span id="l3.22" class="difflineplus">+  add_test(testUserModeCommand);</span>
<a href="#l3.23"></a><span id="l3.23" class="difflineplus">+  add_test(testModeCommand);</span>
<a href="#l3.24"></a><span id="l3.24" class="difflineplus">+  run_next_test();</span>
<a href="#l3.25"></a><span id="l3.25" class="difflineplus">+}</span>
<a href="#l3.26"></a><span id="l3.26" class="difflineplus">+</span>
<a href="#l3.27"></a><span id="l3.27" class="difflineplus">+// Test the /mode command.</span>
<a href="#l3.28"></a><span id="l3.28" class="difflineplus">+function testModeCommand() {</span>
<a href="#l3.29"></a><span id="l3.29" class="difflineplus">+  const testChannelCommands = [</span>
<a href="#l3.30"></a><span id="l3.30" class="difflineplus">+    {</span>
<a href="#l3.31"></a><span id="l3.31" class="difflineplus">+      msg: &quot;&quot;,</span>
<a href="#l3.32"></a><span id="l3.32" class="difflineplus">+      channel: &quot;#instantbird&quot;,</span>
<a href="#l3.33"></a><span id="l3.33" class="difflineplus">+      expectedMessage: &quot;MODE #instantbird&quot;</span>
<a href="#l3.34"></a><span id="l3.34" class="difflineplus">+    },</span>
<a href="#l3.35"></a><span id="l3.35" class="difflineplus">+    {</span>
<a href="#l3.36"></a><span id="l3.36" class="difflineplus">+      msg: &quot;#instantbird&quot;,</span>
<a href="#l3.37"></a><span id="l3.37" class="difflineplus">+      channel: &quot;#instantbird&quot;,</span>
<a href="#l3.38"></a><span id="l3.38" class="difflineplus">+      expectedMessage: &quot;MODE #instantbird&quot;</span>
<a href="#l3.39"></a><span id="l3.39" class="difflineplus">+    },</span>
<a href="#l3.40"></a><span id="l3.40" class="difflineplus">+    {</span>
<a href="#l3.41"></a><span id="l3.41" class="difflineplus">+      msg: &quot;-s&quot;,</span>
<a href="#l3.42"></a><span id="l3.42" class="difflineplus">+      channel: &quot;#Fins&quot;,</span>
<a href="#l3.43"></a><span id="l3.43" class="difflineplus">+      expectedMessage: &quot;MODE #Fins -s&quot;</span>
<a href="#l3.44"></a><span id="l3.44" class="difflineplus">+    },</span>
<a href="#l3.45"></a><span id="l3.45" class="difflineplus">+    {</span>
<a href="#l3.46"></a><span id="l3.46" class="difflineplus">+      msg: &quot;#introduction +is&quot;,</span>
<a href="#l3.47"></a><span id="l3.47" class="difflineplus">+      channel: &quot;#introduction&quot;,</span>
<a href="#l3.48"></a><span id="l3.48" class="difflineplus">+      expectedMessage: &quot;MODE #introduction +is&quot;</span>
<a href="#l3.49"></a><span id="l3.49" class="difflineplus">+    },</span>
<a href="#l3.50"></a><span id="l3.50" class="difflineplus">+    {</span>
<a href="#l3.51"></a><span id="l3.51" class="difflineplus">+      msg: &quot;-s&quot;,</span>
<a href="#l3.52"></a><span id="l3.52" class="difflineplus">+      channel: &quot;&amp;Gills&quot;,</span>
<a href="#l3.53"></a><span id="l3.53" class="difflineplus">+      expectedMessage: &quot;MODE &amp;Gills -s&quot;</span>
<a href="#l3.54"></a><span id="l3.54" class="difflineplus">+    },</span>
<a href="#l3.55"></a><span id="l3.55" class="difflineplus">+    {</span>
<a href="#l3.56"></a><span id="l3.56" class="difflineplus">+      msg: &quot;#Gamers +o KennyS&quot;,</span>
<a href="#l3.57"></a><span id="l3.57" class="difflineplus">+      channel: &quot;#Gamers&quot;,</span>
<a href="#l3.58"></a><span id="l3.58" class="difflineplus">+      expectedMessage: &quot;MODE #Gamers +o KennyS&quot;</span>
<a href="#l3.59"></a><span id="l3.59" class="difflineplus">+    },</span>
<a href="#l3.60"></a><span id="l3.60" class="difflineplus">+    {</span>
<a href="#l3.61"></a><span id="l3.61" class="difflineplus">+      msg: &quot;+o lisp&quot;,</span>
<a href="#l3.62"></a><span id="l3.62" class="difflineplus">+      channel: &quot;&amp;IB&quot;,</span>
<a href="#l3.63"></a><span id="l3.63" class="difflineplus">+      expectedMessage: &quot;MODE &amp;IB +o lisp&quot;</span>
<a href="#l3.64"></a><span id="l3.64" class="difflineplus">+    },</span>
<a href="#l3.65"></a><span id="l3.65" class="difflineplus">+    {</span>
<a href="#l3.66"></a><span id="l3.66" class="difflineplus">+      msg: &quot;+b nick!abc@server&quot;,</span>
<a href="#l3.67"></a><span id="l3.67" class="difflineplus">+      channel: &quot;#Alphabet&quot;,</span>
<a href="#l3.68"></a><span id="l3.68" class="difflineplus">+      expectedMessage: &quot;MODE #Alphabet +b nick!abc@server&quot;</span>
<a href="#l3.69"></a><span id="l3.69" class="difflineplus">+    },</span>
<a href="#l3.70"></a><span id="l3.70" class="difflineplus">+    {</span>
<a href="#l3.71"></a><span id="l3.71" class="difflineplus">+      msg: &quot;+b nick&quot;,</span>
<a href="#l3.72"></a><span id="l3.72" class="difflineplus">+      channel: &quot;#Alphabet&quot;,</span>
<a href="#l3.73"></a><span id="l3.73" class="difflineplus">+      expectedMessage: &quot;MODE #Alphabet +b nick&quot;</span>
<a href="#l3.74"></a><span id="l3.74" class="difflineplus">+    },</span>
<a href="#l3.75"></a><span id="l3.75" class="difflineplus">+    {</span>
<a href="#l3.76"></a><span id="l3.76" class="difflineplus">+      msg: &quot;#instantbird +b nick!abc@server&quot;,</span>
<a href="#l3.77"></a><span id="l3.77" class="difflineplus">+      channel: &quot;#instantbird&quot;,</span>
<a href="#l3.78"></a><span id="l3.78" class="difflineplus">+      expectedMessage: &quot;MODE #instantbird +b nick!abc@server&quot;</span>
<a href="#l3.79"></a><span id="l3.79" class="difflineplus">+    },</span>
<a href="#l3.80"></a><span id="l3.80" class="difflineplus">+    {</span>
<a href="#l3.81"></a><span id="l3.81" class="difflineplus">+      msg: &quot;+v Wiz&quot;,</span>
<a href="#l3.82"></a><span id="l3.82" class="difflineplus">+      channel: &quot;#TheMatrix&quot;,</span>
<a href="#l3.83"></a><span id="l3.83" class="difflineplus">+      expectedMessage: &quot;MODE #TheMatrix +v Wiz&quot;</span>
<a href="#l3.84"></a><span id="l3.84" class="difflineplus">+    },</span>
<a href="#l3.85"></a><span id="l3.85" class="difflineplus">+    {</span>
<a href="#l3.86"></a><span id="l3.86" class="difflineplus">+      msg: &quot;+k passcode&quot;,</span>
<a href="#l3.87"></a><span id="l3.87" class="difflineplus">+      channel: &quot;#TheMatrix&quot;,</span>
<a href="#l3.88"></a><span id="l3.88" class="difflineplus">+      expectedMessage: &quot;MODE #TheMatrix +k passcode&quot;</span>
<a href="#l3.89"></a><span id="l3.89" class="difflineplus">+    },</span>
<a href="#l3.90"></a><span id="l3.90" class="difflineplus">+    {</span>
<a href="#l3.91"></a><span id="l3.91" class="difflineplus">+      msg: &quot;#Mafia +k keyword&quot;,</span>
<a href="#l3.92"></a><span id="l3.92" class="difflineplus">+      channel: &quot;#Mafia&quot;,</span>
<a href="#l3.93"></a><span id="l3.93" class="difflineplus">+      expectedMessage: &quot;MODE #Mafia +k keyword&quot;</span>
<a href="#l3.94"></a><span id="l3.94" class="difflineplus">+    },</span>
<a href="#l3.95"></a><span id="l3.95" class="difflineplus">+    {</span>
<a href="#l3.96"></a><span id="l3.96" class="difflineplus">+      msg: &quot;#introduction +l 100&quot;,</span>
<a href="#l3.97"></a><span id="l3.97" class="difflineplus">+      channel: &quot;#introduction&quot;,</span>
<a href="#l3.98"></a><span id="l3.98" class="difflineplus">+      expectedMessage: &quot;MODE #introduction +l 100&quot;</span>
<a href="#l3.99"></a><span id="l3.99" class="difflineplus">+    },</span>
<a href="#l3.100"></a><span id="l3.100" class="difflineplus">+    {</span>
<a href="#l3.101"></a><span id="l3.101" class="difflineplus">+      msg: &quot;+l 100&quot;,</span>
<a href="#l3.102"></a><span id="l3.102" class="difflineplus">+      channel: &quot;#introduction&quot;,</span>
<a href="#l3.103"></a><span id="l3.103" class="difflineplus">+      expectedMessage: &quot;MODE #introduction +l 100&quot;</span>
<a href="#l3.104"></a><span id="l3.104" class="difflineplus">+    }</span>
<a href="#l3.105"></a><span id="l3.105" class="difflineplus">+  ];</span>
<a href="#l3.106"></a><span id="l3.106" class="difflineplus">+</span>
<a href="#l3.107"></a><span id="l3.107" class="difflineplus">+  const testUserCommands = [</span>
<a href="#l3.108"></a><span id="l3.108" class="difflineplus">+    {</span>
<a href="#l3.109"></a><span id="l3.109" class="difflineplus">+      msg: &quot;nickolas +x&quot;,</span>
<a href="#l3.110"></a><span id="l3.110" class="difflineplus">+      expectedMessage: &quot;MODE nickolas +x&quot;</span>
<a href="#l3.111"></a><span id="l3.111" class="difflineplus">+    },</span>
<a href="#l3.112"></a><span id="l3.112" class="difflineplus">+    {</span>
<a href="#l3.113"></a><span id="l3.113" class="difflineplus">+      msg: &quot;matrixisreal -x&quot;,</span>
<a href="#l3.114"></a><span id="l3.114" class="difflineplus">+      expectedMessage: &quot;MODE matrixisreal -x&quot;</span>
<a href="#l3.115"></a><span id="l3.115" class="difflineplus">+    },</span>
<a href="#l3.116"></a><span id="l3.116" class="difflineplus">+    {</span>
<a href="#l3.117"></a><span id="l3.117" class="difflineplus">+      msg: &quot;matrixisreal_19 +oWp&quot;,</span>
<a href="#l3.118"></a><span id="l3.118" class="difflineplus">+      expectedMessage: &quot;MODE matrixisreal_19 +oWp&quot;</span>
<a href="#l3.119"></a><span id="l3.119" class="difflineplus">+    },</span>
<a href="#l3.120"></a><span id="l3.120" class="difflineplus">+    {</span>
<a href="#l3.121"></a><span id="l3.121" class="difflineplus">+      msg: &quot;nick&quot;,</span>
<a href="#l3.122"></a><span id="l3.122" class="difflineplus">+      expectedMessage: &quot;MODE nick&quot;</span>
<a href="#l3.123"></a><span id="l3.123" class="difflineplus">+    }</span>
<a href="#l3.124"></a><span id="l3.124" class="difflineplus">+  ];</span>
<a href="#l3.125"></a><span id="l3.125" class="difflineplus">+</span>
<a href="#l3.126"></a><span id="l3.126" class="difflineplus">+  let account = new irc.ircAccount(fakeProto,</span>
<a href="#l3.127"></a><span id="l3.127" class="difflineplus">+                                   {name: &quot;defaultnick@instantbird.org&quot;});</span>
<a href="#l3.128"></a><span id="l3.128" class="difflineplus">+</span>
<a href="#l3.129"></a><span id="l3.129" class="difflineplus">+  // check if the message being sent is same as expected message.</span>
<a href="#l3.130"></a><span id="l3.130" class="difflineplus">+  account.sendRawMessage = (aMessage) =&gt; {</span>
<a href="#l3.131"></a><span id="l3.131" class="difflineplus">+    equal(aMessage, account._expectedMessage);</span>
<a href="#l3.132"></a><span id="l3.132" class="difflineplus">+  };</span>
<a href="#l3.133"></a><span id="l3.133" class="difflineplus">+</span>
<a href="#l3.134"></a><span id="l3.134" class="difflineplus">+  const command = _getRunCommand(&quot;mode&quot;);</span>
<a href="#l3.135"></a><span id="l3.135" class="difflineplus">+</span>
<a href="#l3.136"></a><span id="l3.136" class="difflineplus">+  // First test Channel Commands.</span>
<a href="#l3.137"></a><span id="l3.137" class="difflineplus">+  for (let test of testChannelCommands) {</span>
<a href="#l3.138"></a><span id="l3.138" class="difflineplus">+    let conv = new irc.ircConversation(account, test.channel);</span>
<a href="#l3.139"></a><span id="l3.139" class="difflineplus">+    account._expectedMessage = test.expectedMessage;</span>
<a href="#l3.140"></a><span id="l3.140" class="difflineplus">+    command(test.msg, conv);</span>
<a href="#l3.141"></a><span id="l3.141" class="difflineplus">+  }</span>
<a href="#l3.142"></a><span id="l3.142" class="difflineplus">+</span>
<a href="#l3.143"></a><span id="l3.143" class="difflineplus">+  // Now test the User Commands.</span>
<a href="#l3.144"></a><span id="l3.144" class="difflineplus">+  let conv = new irc.ircConversation(account, &quot;dummyConversation&quot;);</span>
<a href="#l3.145"></a><span id="l3.145" class="difflineplus">+  account._nickname = &quot;test_nick&quot;;</span>
<a href="#l3.146"></a><span id="l3.146" class="difflineplus">+  for (let test of testUserCommands) {</span>
<a href="#l3.147"></a><span id="l3.147" class="difflineplus">+    account._expectedMessage = test.expectedMessage;</span>
<a href="#l3.148"></a><span id="l3.148" class="difflineplus">+    command(test.msg, conv);</span>
<a href="#l3.149"></a><span id="l3.149" class="difflineplus">+  }</span>
<a href="#l3.150"></a><span id="l3.150" class="difflineplus">+</span>
<a href="#l3.151"></a><span id="l3.151" class="difflineplus">+  run_next_test();</span>
<a href="#l3.152"></a><span id="l3.152" class="difflineplus">+}</span>
<a href="#l3.153"></a><span id="l3.153" class="difflineplus">+</span>
<a href="#l3.154"></a><span id="l3.154" class="difflineplus">+// Test the /umode command.</span>
<a href="#l3.155"></a><span id="l3.155" class="difflineplus">+function testUserModeCommand() {</span>
<a href="#l3.156"></a><span id="l3.156" class="difflineplus">+  const testData = [</span>
<a href="#l3.157"></a><span id="l3.157" class="difflineplus">+    {</span>
<a href="#l3.158"></a><span id="l3.158" class="difflineplus">+      msg: &quot;+x&quot;,</span>
<a href="#l3.159"></a><span id="l3.159" class="difflineplus">+      expectedMessage: &quot;MODE test_nick +x&quot;</span>
<a href="#l3.160"></a><span id="l3.160" class="difflineplus">+    },</span>
<a href="#l3.161"></a><span id="l3.161" class="difflineplus">+    {</span>
<a href="#l3.162"></a><span id="l3.162" class="difflineplus">+      msg: &quot;-x&quot;,</span>
<a href="#l3.163"></a><span id="l3.163" class="difflineplus">+      expectedMessage: &quot;MODE test_nick -x&quot;</span>
<a href="#l3.164"></a><span id="l3.164" class="difflineplus">+    },</span>
<a href="#l3.165"></a><span id="l3.165" class="difflineplus">+    {</span>
<a href="#l3.166"></a><span id="l3.166" class="difflineplus">+      msg: &quot;-pa&quot;,</span>
<a href="#l3.167"></a><span id="l3.167" class="difflineplus">+      expectedMessage: &quot;MODE test_nick -pa&quot;</span>
<a href="#l3.168"></a><span id="l3.168" class="difflineplus">+    },</span>
<a href="#l3.169"></a><span id="l3.169" class="difflineplus">+    {</span>
<a href="#l3.170"></a><span id="l3.170" class="difflineplus">+      msg: &quot;+oWp&quot;,</span>
<a href="#l3.171"></a><span id="l3.171" class="difflineplus">+      expectedMessage: &quot;MODE test_nick +oWp&quot;</span>
<a href="#l3.172"></a><span id="l3.172" class="difflineplus">+    },</span>
<a href="#l3.173"></a><span id="l3.173" class="difflineplus">+    {</span>
<a href="#l3.174"></a><span id="l3.174" class="difflineplus">+      msg: &quot;&quot;,</span>
<a href="#l3.175"></a><span id="l3.175" class="difflineplus">+      expectedMessage: &quot;MODE test_nick&quot;</span>
<a href="#l3.176"></a><span id="l3.176" class="difflineplus">+    }</span>
<a href="#l3.177"></a><span id="l3.177" class="difflineplus">+  ];</span>
<a href="#l3.178"></a><span id="l3.178" class="difflineplus">+</span>
<a href="#l3.179"></a><span id="l3.179" class="difflineplus">+  let account = new irc.ircAccount(fakeProto,</span>
<a href="#l3.180"></a><span id="l3.180" class="difflineplus">+                                   {name: &quot;test_nick@instantbird.org&quot;});</span>
<a href="#l3.181"></a><span id="l3.181" class="difflineplus">+  account._nickname = 'test_nick';</span>
<a href="#l3.182"></a><span id="l3.182" class="difflineplus">+  let conv = new irc.ircConversation(account, &quot;newconv&quot;);</span>
<a href="#l3.183"></a><span id="l3.183" class="difflineplus">+</span>
<a href="#l3.184"></a><span id="l3.184" class="difflineplus">+  // check if the message being sent is same as expected message.</span>
<a href="#l3.185"></a><span id="l3.185" class="difflineplus">+  account.sendRawMessage = (aMessage) =&gt; {</span>
<a href="#l3.186"></a><span id="l3.186" class="difflineplus">+    equal(aMessage, account._expectedMessage);</span>
<a href="#l3.187"></a><span id="l3.187" class="difflineplus">+  };</span>
<a href="#l3.188"></a><span id="l3.188" class="difflineplus">+</span>
<a href="#l3.189"></a><span id="l3.189" class="difflineplus">+  const command = _getRunCommand(&quot;umode&quot;);</span>
<a href="#l3.190"></a><span id="l3.190" class="difflineplus">+</span>
<a href="#l3.191"></a><span id="l3.191" class="difflineplus">+  // change the nick and runUserModeCommand for each test</span>
<a href="#l3.192"></a><span id="l3.192" class="difflineplus">+  for (let test of testData) {</span>
<a href="#l3.193"></a><span id="l3.193" class="difflineplus">+    account._expectedMessage = test.expectedMessage;</span>
<a href="#l3.194"></a><span id="l3.194" class="difflineplus">+    command(test.msg, conv);</span>
<a href="#l3.195"></a><span id="l3.195" class="difflineplus">+  }</span>
<a href="#l3.196"></a><span id="l3.196" class="difflineplus">+</span>
<a href="#l3.197"></a><span id="l3.197" class="difflineplus">+  run_next_test();</span>
<a href="#l3.198"></a><span id="l3.198" class="difflineplus">+}</span>
<a href="#l3.199"></a><span id="l3.199" class="difflineplus">+</span>
<a href="#l3.200"></a><span id="l3.200" class="difflineplus">+// Fetch the run() of a named command.</span>
<a href="#l3.201"></a><span id="l3.201" class="difflineplus">+function _getRunCommand(aCommandName) {</span>
<a href="#l3.202"></a><span id="l3.202" class="difflineplus">+  for (let command of commands) {</span>
<a href="#l3.203"></a><span id="l3.203" class="difflineplus">+    if (command.name == aCommandName)</span>
<a href="#l3.204"></a><span id="l3.204" class="difflineplus">+      return command.run;</span>
<a href="#l3.205"></a><span id="l3.205" class="difflineplus">+  }</span>
<a href="#l3.206"></a><span id="l3.206" class="difflineplus">+</span>
<a href="#l3.207"></a><span id="l3.207" class="difflineplus">+  // Fail if no command was found.</span>
<a href="#l3.208"></a><span id="l3.208" class="difflineplus">+  ok(false, &quot;Could not find the '&quot; + aCommandName + &quot;' command.&quot;);</span>
<a href="#l3.209"></a><span id="l3.209" class="difflineplus">+}</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l4.1"></a><span id="l4.1" class="difflineminus">--- a/chat/protocols/irc/test/xpcshell.ini</span>
<a href="#l4.2"></a><span id="l4.2" class="difflineplus">+++ b/chat/protocols/irc/test/xpcshell.ini</span>
<a href="#l4.3"></a><span id="l4.3" class="difflineat">@@ -2,15 +2,16 @@</span>
<a href="#l4.4"></a><span id="l4.4"> head =</span>
<a href="#l4.5"></a><span id="l4.5"> tail =</span>
<a href="#l4.6"></a><span id="l4.6"> </span>
<a href="#l4.7"></a><span id="l4.7"> [test_ctcpFormatting.js]</span>
<a href="#l4.8"></a><span id="l4.8"> [test_ctcpColoring.js]</span>
<a href="#l4.9"></a><span id="l4.9"> [test_ctcpDequote.js]</span>
<a href="#l4.10"></a><span id="l4.10"> [test_ctcpQuote.js]</span>
<a href="#l4.11"></a><span id="l4.11"> [test_ircCAP.js]</span>
<a href="#l4.12"></a><span id="l4.12" class="difflineplus">+[test_ircCommands.js]</span>
<a href="#l4.13"></a><span id="l4.13"> [test_ircMessage.js]</span>
<a href="#l4.14"></a><span id="l4.14"> [test_ircNonStandard.js]</span>
<a href="#l4.15"></a><span id="l4.15"> [test_ircServerTime.js]</span>
<a href="#l4.16"></a><span id="l4.16"> [test_sendBufferedCommand.js]</span>
<a href="#l4.17"></a><span id="l4.17"> [test_setMode.js]</span>
<a href="#l4.18"></a><span id="l4.18"> [test_splitLongMessages.js]</span>
<a href="#l4.19"></a><span id="l4.19"> [test_tryNewNick.js]</span></pre></div></div>

<div class="page_footer">
<div class="page_footer_text">comm-central</div>
<div class="page_footer_text" style="padding-left: 10px">Deployed from <a href="https://hg.mozilla.org/hgcustom/version-control-tools/rev/35f393d6769a">35f393d6769a</a> at 2020-07-16T17:23:43Z.</div>
<div class="rss_logo">
<a href="/comm-central/rss-log">RSS</a>
<a href="/comm-central/atom-log">Atom</a>
</div>
<br />

</div>
</body>
</html>

