<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en-US" lang="en-US">
<head>
<link rel="icon" href="/static/35f393d6769a/hgicon.png" type="image/png" />
<meta name="robots" content="index, nofollow"/>
<link rel="stylesheet" href="/static/35f393d6769a/style-gitweb.css" type="text/css" />

<style type="text/css">
div.feed {
  float: right;
}
a img {
  border-width: 0px;
}
div.log_link {
  width: 80px;
  background-color: white;
}

div.log_body {
  padding-left: 96px;
}
</style>
<script type="text/javascript" src="/static/35f393d6769a/mercurial.js"></script>

<meta property="og:image" content="/static/35f393d6769a/moz-logo-bw-rgb.svg"/>
<meta property="og:type" content="website"/>

<title>comm-central: changeset 18774:ef3eebaf957dd3d48b9da69c75d288eb6882b6bf</title>
<link rel="alternate" type="application/atom+xml"
   href="/comm-central/atom-log" title="Atom feed for comm-central"/>
<link rel="alternate" type="application/rss+xml"
   href="/comm-central/rss-log" title="RSS feed for comm-central"/>

<meta property="og:title" content="comm-central @ ef3eebaf957dd3d48b9da69c75d288eb6882b6bf" />
<meta property="og:url" content="/comm-central/rev/ef3eebaf957dd3d48b9da69c75d288eb6882b6bf" />
<meta property="og:description" content="Bug 1221634 - Remove for-each from calendar/. r=Fallen" />

</head>
<body>

<div class="page_header">
<div class="logo">
    <a href="https://developer.mozilla.org/en/docs/Mercurial">
        <img src="/static/35f393d6769a/moz-logo-bw-rgb.svg" alt="mercurial" />
    </a>
</div>
<a href="/">Mercurial</a> &gt; <a href="/comm-central">comm-central</a>  / changeset / ef3eebaf957dd3d48b9da69c75d288eb6882b6bf 
</div>

<div class="page_nav">
<div>
<a href="/comm-central/summary">summary</a> |
<a href="/comm-central/shortlog/ef3eebaf957dd3d48b9da69c75d288eb6882b6bf">shortlog</a> |
<a href="/comm-central/log/ef3eebaf957dd3d48b9da69c75d288eb6882b6bf">changelog</a> |
<a href="/comm-central/pushloghtml">pushlog</a> |
<a href="/comm-central/graph/ef3eebaf957dd3d48b9da69c75d288eb6882b6bf">graph</a> |
<a href="/comm-central/tags">tags</a> |
<a href="/comm-central/bookmarks">bookmarks</a> |
<a href="/comm-central/branches">branches</a> |
<a href="/comm-central/file/ef3eebaf957dd3d48b9da69c75d288eb6882b6bf">files</a> |
changeset |
<a href="/comm-central/raw-rev/ef3eebaf957dd3d48b9da69c75d288eb6882b6bf">raw</a>  | <a href="/comm-central/archive/ef3eebaf957dd3d48b9da69c75d288eb6882b6bf.zip">zip</a>  |
<a href="/comm-central/help">help</a>
</div>

<div class="search">
<form id="searchform" action="/comm-central/log">

<input name="rev" type="text" value="" size="40" />
<div id="hint">Find changesets by keywords (author, files, the commit message), revision
number or hash, or <a href="/comm-central/help/revsets">revset expression</a>.</div>
</form>
</div>
</div>

<div class="title">
<a href="https://bugzilla.mozilla.org/show_bug.cgi?id=1221634">Bug 1221634</a> - Remove for-each from calendar/. r=Fallen
<span class="logtags"></span>
</div>
<div class="title_text">
<table cellspacing="0">

<tr><td>author</td><td>&#84;&#111;&#111;&#114;&#117;&#32;&#70;&#117;&#106;&#105;&#115;&#97;&#119;&#97;&#32;&#60;&#97;&#114;&#97;&#105;&#95;&#97;&#64;&#109;&#97;&#99;&#46;&#99;&#111;&#109;&#62;</td></tr>
<tr><td></td><td class="date age">Wed, 16 Dec 2015 04:53:38 +0900</td></tr>

<tr>
 <td>changeset 18774</td>
 <td style="font-family:monospace"><a class="list" href="/comm-central/rev/ef3eebaf957dd3d48b9da69c75d288eb6882b6bf">ef3eebaf957dd3d48b9da69c75d288eb6882b6bf</a></td>
</tr>



<tr>
<td>parent 18773</td>
<td style="font-family:monospace">
<a class="list" href="/comm-central/rev/f102a2d706b32b09812bada1b84e0f4267abffe6">f102a2d706b32b09812bada1b84e0f4267abffe6</a>
</td>
</tr>

<tr>
<td>child 18775</td>
<td style="font-family:monospace">
<a class="list" href="/comm-central/rev/55858ec8f8ffed66fbb090724f807916eed1bc14">55858ec8f8ffed66fbb090724f807916eed1bc14</a>
</td>
</tr>
<tr><td>push id</td><td><a href="/comm-central/pushloghtml?changeset=ef3eebaf957dd3d48b9da69c75d288eb6882b6bf">11506</a></td></tr>
<tr><td>push user</td><td>arai_a@mac.com</td></tr>
<tr><td>push date</td><td class="date age">Tue, 15 Dec 2015 19:58:57 +0000</td></tr>

<tr><td>treeherder</td><td>comm-central@ef3eebaf957d [<a href="https://treeherder.mozilla.org/#/jobs?repo=comm-central&revision=ef3eebaf957dd3d48b9da69c75d288eb6882b6bf">default view</a>] [<a href="https://treeherder.mozilla.org/#/jobs?repo=comm-central&revision=ef3eebaf957dd3d48b9da69c75d288eb6882b6bf&filter-resultStatus=testfailed&filter-resultStatus=busted&filter-resultStatus=exception">failures only]</td></tr>
<tr><td>perfherder</td><td>[<a href="https://treeherder.mozilla.org/perf.html#/compare?originalProject=comm-central&originalRevision=ef3eebaf957dd3d48b9da69c75d288eb6882b6bf&newProject=comm-central&newRevision=ef3eebaf957dd3d48b9da69c75d288eb6882b6bf&framework=1" target="_blank">talos</a>] [<a href="https://treeherder.mozilla.org/perf.html#/compare?originalProject=comm-central&originalRevision=ef3eebaf957dd3d48b9da69c75d288eb6882b6bf&newProject=comm-central&newRevision=ef3eebaf957dd3d48b9da69c75d288eb6882b6bf&framework=2" target="_blank">build metrics</a>] [<a href="https://treeherder.mozilla.org/perf.html#/compare?originalProject=comm-central&originalRevision=ef3eebaf957dd3d48b9da69c75d288eb6882b6bf&newProject=comm-central&newRevision=ef3eebaf957dd3d48b9da69c75d288eb6882b6bf&framework=6" target="_blank">platform microbench</a>] (compared to previous push)</td></tr>
<tr><td>reviewers</td><td><a href="/comm-central/log?rev=reviewer%28Fallen%29&revcount=50">Fallen</a></td></tr>
<tr><td>bugs</td><td><a href="https://bugzilla.mozilla.org/show_bug.cgi?id=1221634">1221634</a></td></tr>




</table></div>

<div class="page_body description"><a href="https://bugzilla.mozilla.org/show_bug.cgi?id=1221634">Bug 1221634</a> - Remove for-each from calendar/. r=Fallen</div>
<div class="list_head"></div>
<div class="title_text">
<table cellspacing="0">

<tr class="parity0">
<td><a class="list" href="/comm-central/diff/ef3eebaf957dd3d48b9da69c75d288eb6882b6bf/calendar/base/backend/icaljs/calICSService.js">calendar/base/backend/icaljs/calICSService.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/ef3eebaf957dd3d48b9da69c75d288eb6882b6bf/calendar/base/backend/icaljs/calICSService.js">file</a> |
<a href="/comm-central/annotate/ef3eebaf957dd3d48b9da69c75d288eb6882b6bf/calendar/base/backend/icaljs/calICSService.js">annotate</a> |
<a href="/comm-central/diff/ef3eebaf957dd3d48b9da69c75d288eb6882b6bf/calendar/base/backend/icaljs/calICSService.js">diff</a> |
<a href="/comm-central/comparison/ef3eebaf957dd3d48b9da69c75d288eb6882b6bf/calendar/base/backend/icaljs/calICSService.js">comparison</a> |
<a href="/comm-central/log/ef3eebaf957dd3d48b9da69c75d288eb6882b6bf/calendar/base/backend/icaljs/calICSService.js">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/ef3eebaf957dd3d48b9da69c75d288eb6882b6bf/calendar/base/content/agenda-listbox.js">calendar/base/content/agenda-listbox.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/ef3eebaf957dd3d48b9da69c75d288eb6882b6bf/calendar/base/content/agenda-listbox.js">file</a> |
<a href="/comm-central/annotate/ef3eebaf957dd3d48b9da69c75d288eb6882b6bf/calendar/base/content/agenda-listbox.js">annotate</a> |
<a href="/comm-central/diff/ef3eebaf957dd3d48b9da69c75d288eb6882b6bf/calendar/base/content/agenda-listbox.js">diff</a> |
<a href="/comm-central/comparison/ef3eebaf957dd3d48b9da69c75d288eb6882b6bf/calendar/base/content/agenda-listbox.js">comparison</a> |
<a href="/comm-central/log/ef3eebaf957dd3d48b9da69c75d288eb6882b6bf/calendar/base/content/agenda-listbox.js">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/ef3eebaf957dd3d48b9da69c75d288eb6882b6bf/calendar/base/content/calendar-base-view.xml">calendar/base/content/calendar-base-view.xml</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/ef3eebaf957dd3d48b9da69c75d288eb6882b6bf/calendar/base/content/calendar-base-view.xml">file</a> |
<a href="/comm-central/annotate/ef3eebaf957dd3d48b9da69c75d288eb6882b6bf/calendar/base/content/calendar-base-view.xml">annotate</a> |
<a href="/comm-central/diff/ef3eebaf957dd3d48b9da69c75d288eb6882b6bf/calendar/base/content/calendar-base-view.xml">diff</a> |
<a href="/comm-central/comparison/ef3eebaf957dd3d48b9da69c75d288eb6882b6bf/calendar/base/content/calendar-base-view.xml">comparison</a> |
<a href="/comm-central/log/ef3eebaf957dd3d48b9da69c75d288eb6882b6bf/calendar/base/content/calendar-base-view.xml">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/ef3eebaf957dd3d48b9da69c75d288eb6882b6bf/calendar/base/content/calendar-clipboard.js">calendar/base/content/calendar-clipboard.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/ef3eebaf957dd3d48b9da69c75d288eb6882b6bf/calendar/base/content/calendar-clipboard.js">file</a> |
<a href="/comm-central/annotate/ef3eebaf957dd3d48b9da69c75d288eb6882b6bf/calendar/base/content/calendar-clipboard.js">annotate</a> |
<a href="/comm-central/diff/ef3eebaf957dd3d48b9da69c75d288eb6882b6bf/calendar/base/content/calendar-clipboard.js">diff</a> |
<a href="/comm-central/comparison/ef3eebaf957dd3d48b9da69c75d288eb6882b6bf/calendar/base/content/calendar-clipboard.js">comparison</a> |
<a href="/comm-central/log/ef3eebaf957dd3d48b9da69c75d288eb6882b6bf/calendar/base/content/calendar-clipboard.js">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/ef3eebaf957dd3d48b9da69c75d288eb6882b6bf/calendar/base/content/calendar-common-sets.js">calendar/base/content/calendar-common-sets.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/ef3eebaf957dd3d48b9da69c75d288eb6882b6bf/calendar/base/content/calendar-common-sets.js">file</a> |
<a href="/comm-central/annotate/ef3eebaf957dd3d48b9da69c75d288eb6882b6bf/calendar/base/content/calendar-common-sets.js">annotate</a> |
<a href="/comm-central/diff/ef3eebaf957dd3d48b9da69c75d288eb6882b6bf/calendar/base/content/calendar-common-sets.js">diff</a> |
<a href="/comm-central/comparison/ef3eebaf957dd3d48b9da69c75d288eb6882b6bf/calendar/base/content/calendar-common-sets.js">comparison</a> |
<a href="/comm-central/log/ef3eebaf957dd3d48b9da69c75d288eb6882b6bf/calendar/base/content/calendar-common-sets.js">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/ef3eebaf957dd3d48b9da69c75d288eb6882b6bf/calendar/base/content/calendar-dnd-listener.js">calendar/base/content/calendar-dnd-listener.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/ef3eebaf957dd3d48b9da69c75d288eb6882b6bf/calendar/base/content/calendar-dnd-listener.js">file</a> |
<a href="/comm-central/annotate/ef3eebaf957dd3d48b9da69c75d288eb6882b6bf/calendar/base/content/calendar-dnd-listener.js">annotate</a> |
<a href="/comm-central/diff/ef3eebaf957dd3d48b9da69c75d288eb6882b6bf/calendar/base/content/calendar-dnd-listener.js">diff</a> |
<a href="/comm-central/comparison/ef3eebaf957dd3d48b9da69c75d288eb6882b6bf/calendar/base/content/calendar-dnd-listener.js">comparison</a> |
<a href="/comm-central/log/ef3eebaf957dd3d48b9da69c75d288eb6882b6bf/calendar/base/content/calendar-dnd-listener.js">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/ef3eebaf957dd3d48b9da69c75d288eb6882b6bf/calendar/base/content/calendar-invitations-manager.js">calendar/base/content/calendar-invitations-manager.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/ef3eebaf957dd3d48b9da69c75d288eb6882b6bf/calendar/base/content/calendar-invitations-manager.js">file</a> |
<a href="/comm-central/annotate/ef3eebaf957dd3d48b9da69c75d288eb6882b6bf/calendar/base/content/calendar-invitations-manager.js">annotate</a> |
<a href="/comm-central/diff/ef3eebaf957dd3d48b9da69c75d288eb6882b6bf/calendar/base/content/calendar-invitations-manager.js">diff</a> |
<a href="/comm-central/comparison/ef3eebaf957dd3d48b9da69c75d288eb6882b6bf/calendar/base/content/calendar-invitations-manager.js">comparison</a> |
<a href="/comm-central/log/ef3eebaf957dd3d48b9da69c75d288eb6882b6bf/calendar/base/content/calendar-invitations-manager.js">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/ef3eebaf957dd3d48b9da69c75d288eb6882b6bf/calendar/base/content/calendar-item-editing.js">calendar/base/content/calendar-item-editing.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/ef3eebaf957dd3d48b9da69c75d288eb6882b6bf/calendar/base/content/calendar-item-editing.js">file</a> |
<a href="/comm-central/annotate/ef3eebaf957dd3d48b9da69c75d288eb6882b6bf/calendar/base/content/calendar-item-editing.js">annotate</a> |
<a href="/comm-central/diff/ef3eebaf957dd3d48b9da69c75d288eb6882b6bf/calendar/base/content/calendar-item-editing.js">diff</a> |
<a href="/comm-central/comparison/ef3eebaf957dd3d48b9da69c75d288eb6882b6bf/calendar/base/content/calendar-item-editing.js">comparison</a> |
<a href="/comm-central/log/ef3eebaf957dd3d48b9da69c75d288eb6882b6bf/calendar/base/content/calendar-item-editing.js">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/ef3eebaf957dd3d48b9da69c75d288eb6882b6bf/calendar/base/content/calendar-month-view.xml">calendar/base/content/calendar-month-view.xml</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/ef3eebaf957dd3d48b9da69c75d288eb6882b6bf/calendar/base/content/calendar-month-view.xml">file</a> |
<a href="/comm-central/annotate/ef3eebaf957dd3d48b9da69c75d288eb6882b6bf/calendar/base/content/calendar-month-view.xml">annotate</a> |
<a href="/comm-central/diff/ef3eebaf957dd3d48b9da69c75d288eb6882b6bf/calendar/base/content/calendar-month-view.xml">diff</a> |
<a href="/comm-central/comparison/ef3eebaf957dd3d48b9da69c75d288eb6882b6bf/calendar/base/content/calendar-month-view.xml">comparison</a> |
<a href="/comm-central/log/ef3eebaf957dd3d48b9da69c75d288eb6882b6bf/calendar/base/content/calendar-month-view.xml">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/ef3eebaf957dd3d48b9da69c75d288eb6882b6bf/calendar/base/content/calendar-multiday-view.xml">calendar/base/content/calendar-multiday-view.xml</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/ef3eebaf957dd3d48b9da69c75d288eb6882b6bf/calendar/base/content/calendar-multiday-view.xml">file</a> |
<a href="/comm-central/annotate/ef3eebaf957dd3d48b9da69c75d288eb6882b6bf/calendar/base/content/calendar-multiday-view.xml">annotate</a> |
<a href="/comm-central/diff/ef3eebaf957dd3d48b9da69c75d288eb6882b6bf/calendar/base/content/calendar-multiday-view.xml">diff</a> |
<a href="/comm-central/comparison/ef3eebaf957dd3d48b9da69c75d288eb6882b6bf/calendar/base/content/calendar-multiday-view.xml">comparison</a> |
<a href="/comm-central/log/ef3eebaf957dd3d48b9da69c75d288eb6882b6bf/calendar/base/content/calendar-multiday-view.xml">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/ef3eebaf957dd3d48b9da69c75d288eb6882b6bf/calendar/base/content/calendar-task-tree.xml">calendar/base/content/calendar-task-tree.xml</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/ef3eebaf957dd3d48b9da69c75d288eb6882b6bf/calendar/base/content/calendar-task-tree.xml">file</a> |
<a href="/comm-central/annotate/ef3eebaf957dd3d48b9da69c75d288eb6882b6bf/calendar/base/content/calendar-task-tree.xml">annotate</a> |
<a href="/comm-central/diff/ef3eebaf957dd3d48b9da69c75d288eb6882b6bf/calendar/base/content/calendar-task-tree.xml">diff</a> |
<a href="/comm-central/comparison/ef3eebaf957dd3d48b9da69c75d288eb6882b6bf/calendar/base/content/calendar-task-tree.xml">comparison</a> |
<a href="/comm-central/log/ef3eebaf957dd3d48b9da69c75d288eb6882b6bf/calendar/base/content/calendar-task-tree.xml">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/ef3eebaf957dd3d48b9da69c75d288eb6882b6bf/calendar/base/content/calendar-task-view.js">calendar/base/content/calendar-task-view.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/ef3eebaf957dd3d48b9da69c75d288eb6882b6bf/calendar/base/content/calendar-task-view.js">file</a> |
<a href="/comm-central/annotate/ef3eebaf957dd3d48b9da69c75d288eb6882b6bf/calendar/base/content/calendar-task-view.js">annotate</a> |
<a href="/comm-central/diff/ef3eebaf957dd3d48b9da69c75d288eb6882b6bf/calendar/base/content/calendar-task-view.js">diff</a> |
<a href="/comm-central/comparison/ef3eebaf957dd3d48b9da69c75d288eb6882b6bf/calendar/base/content/calendar-task-view.js">comparison</a> |
<a href="/comm-central/log/ef3eebaf957dd3d48b9da69c75d288eb6882b6bf/calendar/base/content/calendar-task-view.js">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/ef3eebaf957dd3d48b9da69c75d288eb6882b6bf/calendar/base/content/calendar-ui-utils.js">calendar/base/content/calendar-ui-utils.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/ef3eebaf957dd3d48b9da69c75d288eb6882b6bf/calendar/base/content/calendar-ui-utils.js">file</a> |
<a href="/comm-central/annotate/ef3eebaf957dd3d48b9da69c75d288eb6882b6bf/calendar/base/content/calendar-ui-utils.js">annotate</a> |
<a href="/comm-central/diff/ef3eebaf957dd3d48b9da69c75d288eb6882b6bf/calendar/base/content/calendar-ui-utils.js">diff</a> |
<a href="/comm-central/comparison/ef3eebaf957dd3d48b9da69c75d288eb6882b6bf/calendar/base/content/calendar-ui-utils.js">comparison</a> |
<a href="/comm-central/log/ef3eebaf957dd3d48b9da69c75d288eb6882b6bf/calendar/base/content/calendar-ui-utils.js">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/ef3eebaf957dd3d48b9da69c75d288eb6882b6bf/calendar/base/content/calendar-unifinder.js">calendar/base/content/calendar-unifinder.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/ef3eebaf957dd3d48b9da69c75d288eb6882b6bf/calendar/base/content/calendar-unifinder.js">file</a> |
<a href="/comm-central/annotate/ef3eebaf957dd3d48b9da69c75d288eb6882b6bf/calendar/base/content/calendar-unifinder.js">annotate</a> |
<a href="/comm-central/diff/ef3eebaf957dd3d48b9da69c75d288eb6882b6bf/calendar/base/content/calendar-unifinder.js">diff</a> |
<a href="/comm-central/comparison/ef3eebaf957dd3d48b9da69c75d288eb6882b6bf/calendar/base/content/calendar-unifinder.js">comparison</a> |
<a href="/comm-central/log/ef3eebaf957dd3d48b9da69c75d288eb6882b6bf/calendar/base/content/calendar-unifinder.js">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/ef3eebaf957dd3d48b9da69c75d288eb6882b6bf/calendar/base/content/calendar-views.js">calendar/base/content/calendar-views.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/ef3eebaf957dd3d48b9da69c75d288eb6882b6bf/calendar/base/content/calendar-views.js">file</a> |
<a href="/comm-central/annotate/ef3eebaf957dd3d48b9da69c75d288eb6882b6bf/calendar/base/content/calendar-views.js">annotate</a> |
<a href="/comm-central/diff/ef3eebaf957dd3d48b9da69c75d288eb6882b6bf/calendar/base/content/calendar-views.js">diff</a> |
<a href="/comm-central/comparison/ef3eebaf957dd3d48b9da69c75d288eb6882b6bf/calendar/base/content/calendar-views.js">comparison</a> |
<a href="/comm-central/log/ef3eebaf957dd3d48b9da69c75d288eb6882b6bf/calendar/base/content/calendar-views.js">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/ef3eebaf957dd3d48b9da69c75d288eb6882b6bf/calendar/base/content/dialogs/calendar-alarm-dialog.js">calendar/base/content/dialogs/calendar-alarm-dialog.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/ef3eebaf957dd3d48b9da69c75d288eb6882b6bf/calendar/base/content/dialogs/calendar-alarm-dialog.js">file</a> |
<a href="/comm-central/annotate/ef3eebaf957dd3d48b9da69c75d288eb6882b6bf/calendar/base/content/dialogs/calendar-alarm-dialog.js">annotate</a> |
<a href="/comm-central/diff/ef3eebaf957dd3d48b9da69c75d288eb6882b6bf/calendar/base/content/dialogs/calendar-alarm-dialog.js">diff</a> |
<a href="/comm-central/comparison/ef3eebaf957dd3d48b9da69c75d288eb6882b6bf/calendar/base/content/dialogs/calendar-alarm-dialog.js">comparison</a> |
<a href="/comm-central/log/ef3eebaf957dd3d48b9da69c75d288eb6882b6bf/calendar/base/content/dialogs/calendar-alarm-dialog.js">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/ef3eebaf957dd3d48b9da69c75d288eb6882b6bf/calendar/base/content/dialogs/calendar-dialog-utils.js">calendar/base/content/dialogs/calendar-dialog-utils.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/ef3eebaf957dd3d48b9da69c75d288eb6882b6bf/calendar/base/content/dialogs/calendar-dialog-utils.js">file</a> |
<a href="/comm-central/annotate/ef3eebaf957dd3d48b9da69c75d288eb6882b6bf/calendar/base/content/dialogs/calendar-dialog-utils.js">annotate</a> |
<a href="/comm-central/diff/ef3eebaf957dd3d48b9da69c75d288eb6882b6bf/calendar/base/content/dialogs/calendar-dialog-utils.js">diff</a> |
<a href="/comm-central/comparison/ef3eebaf957dd3d48b9da69c75d288eb6882b6bf/calendar/base/content/dialogs/calendar-dialog-utils.js">comparison</a> |
<a href="/comm-central/log/ef3eebaf957dd3d48b9da69c75d288eb6882b6bf/calendar/base/content/dialogs/calendar-dialog-utils.js">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/ef3eebaf957dd3d48b9da69c75d288eb6882b6bf/calendar/base/content/dialogs/calendar-event-dialog-attendees.js">calendar/base/content/dialogs/calendar-event-dialog-attendees.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/ef3eebaf957dd3d48b9da69c75d288eb6882b6bf/calendar/base/content/dialogs/calendar-event-dialog-attendees.js">file</a> |
<a href="/comm-central/annotate/ef3eebaf957dd3d48b9da69c75d288eb6882b6bf/calendar/base/content/dialogs/calendar-event-dialog-attendees.js">annotate</a> |
<a href="/comm-central/diff/ef3eebaf957dd3d48b9da69c75d288eb6882b6bf/calendar/base/content/dialogs/calendar-event-dialog-attendees.js">diff</a> |
<a href="/comm-central/comparison/ef3eebaf957dd3d48b9da69c75d288eb6882b6bf/calendar/base/content/dialogs/calendar-event-dialog-attendees.js">comparison</a> |
<a href="/comm-central/log/ef3eebaf957dd3d48b9da69c75d288eb6882b6bf/calendar/base/content/dialogs/calendar-event-dialog-attendees.js">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/ef3eebaf957dd3d48b9da69c75d288eb6882b6bf/calendar/base/content/dialogs/calendar-event-dialog-attendees.xml">calendar/base/content/dialogs/calendar-event-dialog-attendees.xml</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/ef3eebaf957dd3d48b9da69c75d288eb6882b6bf/calendar/base/content/dialogs/calendar-event-dialog-attendees.xml">file</a> |
<a href="/comm-central/annotate/ef3eebaf957dd3d48b9da69c75d288eb6882b6bf/calendar/base/content/dialogs/calendar-event-dialog-attendees.xml">annotate</a> |
<a href="/comm-central/diff/ef3eebaf957dd3d48b9da69c75d288eb6882b6bf/calendar/base/content/dialogs/calendar-event-dialog-attendees.xml">diff</a> |
<a href="/comm-central/comparison/ef3eebaf957dd3d48b9da69c75d288eb6882b6bf/calendar/base/content/dialogs/calendar-event-dialog-attendees.xml">comparison</a> |
<a href="/comm-central/log/ef3eebaf957dd3d48b9da69c75d288eb6882b6bf/calendar/base/content/dialogs/calendar-event-dialog-attendees.xml">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/ef3eebaf957dd3d48b9da69c75d288eb6882b6bf/calendar/base/content/dialogs/calendar-event-dialog-freebusy.xml">calendar/base/content/dialogs/calendar-event-dialog-freebusy.xml</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/ef3eebaf957dd3d48b9da69c75d288eb6882b6bf/calendar/base/content/dialogs/calendar-event-dialog-freebusy.xml">file</a> |
<a href="/comm-central/annotate/ef3eebaf957dd3d48b9da69c75d288eb6882b6bf/calendar/base/content/dialogs/calendar-event-dialog-freebusy.xml">annotate</a> |
<a href="/comm-central/diff/ef3eebaf957dd3d48b9da69c75d288eb6882b6bf/calendar/base/content/dialogs/calendar-event-dialog-freebusy.xml">diff</a> |
<a href="/comm-central/comparison/ef3eebaf957dd3d48b9da69c75d288eb6882b6bf/calendar/base/content/dialogs/calendar-event-dialog-freebusy.xml">comparison</a> |
<a href="/comm-central/log/ef3eebaf957dd3d48b9da69c75d288eb6882b6bf/calendar/base/content/dialogs/calendar-event-dialog-freebusy.xml">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/ef3eebaf957dd3d48b9da69c75d288eb6882b6bf/calendar/base/content/dialogs/calendar-event-dialog-recurrence.js">calendar/base/content/dialogs/calendar-event-dialog-recurrence.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/ef3eebaf957dd3d48b9da69c75d288eb6882b6bf/calendar/base/content/dialogs/calendar-event-dialog-recurrence.js">file</a> |
<a href="/comm-central/annotate/ef3eebaf957dd3d48b9da69c75d288eb6882b6bf/calendar/base/content/dialogs/calendar-event-dialog-recurrence.js">annotate</a> |
<a href="/comm-central/diff/ef3eebaf957dd3d48b9da69c75d288eb6882b6bf/calendar/base/content/dialogs/calendar-event-dialog-recurrence.js">diff</a> |
<a href="/comm-central/comparison/ef3eebaf957dd3d48b9da69c75d288eb6882b6bf/calendar/base/content/dialogs/calendar-event-dialog-recurrence.js">comparison</a> |
<a href="/comm-central/log/ef3eebaf957dd3d48b9da69c75d288eb6882b6bf/calendar/base/content/dialogs/calendar-event-dialog-recurrence.js">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/ef3eebaf957dd3d48b9da69c75d288eb6882b6bf/calendar/base/content/dialogs/calendar-event-dialog-reminder.js">calendar/base/content/dialogs/calendar-event-dialog-reminder.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/ef3eebaf957dd3d48b9da69c75d288eb6882b6bf/calendar/base/content/dialogs/calendar-event-dialog-reminder.js">file</a> |
<a href="/comm-central/annotate/ef3eebaf957dd3d48b9da69c75d288eb6882b6bf/calendar/base/content/dialogs/calendar-event-dialog-reminder.js">annotate</a> |
<a href="/comm-central/diff/ef3eebaf957dd3d48b9da69c75d288eb6882b6bf/calendar/base/content/dialogs/calendar-event-dialog-reminder.js">diff</a> |
<a href="/comm-central/comparison/ef3eebaf957dd3d48b9da69c75d288eb6882b6bf/calendar/base/content/dialogs/calendar-event-dialog-reminder.js">comparison</a> |
<a href="/comm-central/log/ef3eebaf957dd3d48b9da69c75d288eb6882b6bf/calendar/base/content/dialogs/calendar-event-dialog-reminder.js">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/ef3eebaf957dd3d48b9da69c75d288eb6882b6bf/calendar/base/content/dialogs/calendar-event-dialog.js">calendar/base/content/dialogs/calendar-event-dialog.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/ef3eebaf957dd3d48b9da69c75d288eb6882b6bf/calendar/base/content/dialogs/calendar-event-dialog.js">file</a> |
<a href="/comm-central/annotate/ef3eebaf957dd3d48b9da69c75d288eb6882b6bf/calendar/base/content/dialogs/calendar-event-dialog.js">annotate</a> |
<a href="/comm-central/diff/ef3eebaf957dd3d48b9da69c75d288eb6882b6bf/calendar/base/content/dialogs/calendar-event-dialog.js">diff</a> |
<a href="/comm-central/comparison/ef3eebaf957dd3d48b9da69c75d288eb6882b6bf/calendar/base/content/dialogs/calendar-event-dialog.js">comparison</a> |
<a href="/comm-central/log/ef3eebaf957dd3d48b9da69c75d288eb6882b6bf/calendar/base/content/dialogs/calendar-event-dialog.js">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/ef3eebaf957dd3d48b9da69c75d288eb6882b6bf/calendar/base/content/dialogs/calendar-invitations-dialog.js">calendar/base/content/dialogs/calendar-invitations-dialog.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/ef3eebaf957dd3d48b9da69c75d288eb6882b6bf/calendar/base/content/dialogs/calendar-invitations-dialog.js">file</a> |
<a href="/comm-central/annotate/ef3eebaf957dd3d48b9da69c75d288eb6882b6bf/calendar/base/content/dialogs/calendar-invitations-dialog.js">annotate</a> |
<a href="/comm-central/diff/ef3eebaf957dd3d48b9da69c75d288eb6882b6bf/calendar/base/content/dialogs/calendar-invitations-dialog.js">diff</a> |
<a href="/comm-central/comparison/ef3eebaf957dd3d48b9da69c75d288eb6882b6bf/calendar/base/content/dialogs/calendar-invitations-dialog.js">comparison</a> |
<a href="/comm-central/log/ef3eebaf957dd3d48b9da69c75d288eb6882b6bf/calendar/base/content/dialogs/calendar-invitations-dialog.js">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/ef3eebaf957dd3d48b9da69c75d288eb6882b6bf/calendar/base/content/dialogs/calendar-migration-dialog.js">calendar/base/content/dialogs/calendar-migration-dialog.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/ef3eebaf957dd3d48b9da69c75d288eb6882b6bf/calendar/base/content/dialogs/calendar-migration-dialog.js">file</a> |
<a href="/comm-central/annotate/ef3eebaf957dd3d48b9da69c75d288eb6882b6bf/calendar/base/content/dialogs/calendar-migration-dialog.js">annotate</a> |
<a href="/comm-central/diff/ef3eebaf957dd3d48b9da69c75d288eb6882b6bf/calendar/base/content/dialogs/calendar-migration-dialog.js">diff</a> |
<a href="/comm-central/comparison/ef3eebaf957dd3d48b9da69c75d288eb6882b6bf/calendar/base/content/dialogs/calendar-migration-dialog.js">comparison</a> |
<a href="/comm-central/log/ef3eebaf957dd3d48b9da69c75d288eb6882b6bf/calendar/base/content/dialogs/calendar-migration-dialog.js">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/ef3eebaf957dd3d48b9da69c75d288eb6882b6bf/calendar/base/content/dialogs/calendar-print-dialog.js">calendar/base/content/dialogs/calendar-print-dialog.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/ef3eebaf957dd3d48b9da69c75d288eb6882b6bf/calendar/base/content/dialogs/calendar-print-dialog.js">file</a> |
<a href="/comm-central/annotate/ef3eebaf957dd3d48b9da69c75d288eb6882b6bf/calendar/base/content/dialogs/calendar-print-dialog.js">annotate</a> |
<a href="/comm-central/diff/ef3eebaf957dd3d48b9da69c75d288eb6882b6bf/calendar/base/content/dialogs/calendar-print-dialog.js">diff</a> |
<a href="/comm-central/comparison/ef3eebaf957dd3d48b9da69c75d288eb6882b6bf/calendar/base/content/dialogs/calendar-print-dialog.js">comparison</a> |
<a href="/comm-central/log/ef3eebaf957dd3d48b9da69c75d288eb6882b6bf/calendar/base/content/dialogs/calendar-print-dialog.js">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/ef3eebaf957dd3d48b9da69c75d288eb6882b6bf/calendar/base/content/dialogs/calendar-properties-dialog.js">calendar/base/content/dialogs/calendar-properties-dialog.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/ef3eebaf957dd3d48b9da69c75d288eb6882b6bf/calendar/base/content/dialogs/calendar-properties-dialog.js">file</a> |
<a href="/comm-central/annotate/ef3eebaf957dd3d48b9da69c75d288eb6882b6bf/calendar/base/content/dialogs/calendar-properties-dialog.js">annotate</a> |
<a href="/comm-central/diff/ef3eebaf957dd3d48b9da69c75d288eb6882b6bf/calendar/base/content/dialogs/calendar-properties-dialog.js">diff</a> |
<a href="/comm-central/comparison/ef3eebaf957dd3d48b9da69c75d288eb6882b6bf/calendar/base/content/dialogs/calendar-properties-dialog.js">comparison</a> |
<a href="/comm-central/log/ef3eebaf957dd3d48b9da69c75d288eb6882b6bf/calendar/base/content/dialogs/calendar-properties-dialog.js">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/ef3eebaf957dd3d48b9da69c75d288eb6882b6bf/calendar/base/content/dialogs/calendar-subscriptions-dialog.js">calendar/base/content/dialogs/calendar-subscriptions-dialog.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/ef3eebaf957dd3d48b9da69c75d288eb6882b6bf/calendar/base/content/dialogs/calendar-subscriptions-dialog.js">file</a> |
<a href="/comm-central/annotate/ef3eebaf957dd3d48b9da69c75d288eb6882b6bf/calendar/base/content/dialogs/calendar-subscriptions-dialog.js">annotate</a> |
<a href="/comm-central/diff/ef3eebaf957dd3d48b9da69c75d288eb6882b6bf/calendar/base/content/dialogs/calendar-subscriptions-dialog.js">diff</a> |
<a href="/comm-central/comparison/ef3eebaf957dd3d48b9da69c75d288eb6882b6bf/calendar/base/content/dialogs/calendar-subscriptions-dialog.js">comparison</a> |
<a href="/comm-central/log/ef3eebaf957dd3d48b9da69c75d288eb6882b6bf/calendar/base/content/dialogs/calendar-subscriptions-dialog.js">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/ef3eebaf957dd3d48b9da69c75d288eb6882b6bf/calendar/base/content/import-export.js">calendar/base/content/import-export.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/ef3eebaf957dd3d48b9da69c75d288eb6882b6bf/calendar/base/content/import-export.js">file</a> |
<a href="/comm-central/annotate/ef3eebaf957dd3d48b9da69c75d288eb6882b6bf/calendar/base/content/import-export.js">annotate</a> |
<a href="/comm-central/diff/ef3eebaf957dd3d48b9da69c75d288eb6882b6bf/calendar/base/content/import-export.js">diff</a> |
<a href="/comm-central/comparison/ef3eebaf957dd3d48b9da69c75d288eb6882b6bf/calendar/base/content/import-export.js">comparison</a> |
<a href="/comm-central/log/ef3eebaf957dd3d48b9da69c75d288eb6882b6bf/calendar/base/content/import-export.js">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/ef3eebaf957dd3d48b9da69c75d288eb6882b6bf/calendar/base/content/widgets/calendar-list-tree.xml">calendar/base/content/widgets/calendar-list-tree.xml</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/ef3eebaf957dd3d48b9da69c75d288eb6882b6bf/calendar/base/content/widgets/calendar-list-tree.xml">file</a> |
<a href="/comm-central/annotate/ef3eebaf957dd3d48b9da69c75d288eb6882b6bf/calendar/base/content/widgets/calendar-list-tree.xml">annotate</a> |
<a href="/comm-central/diff/ef3eebaf957dd3d48b9da69c75d288eb6882b6bf/calendar/base/content/widgets/calendar-list-tree.xml">diff</a> |
<a href="/comm-central/comparison/ef3eebaf957dd3d48b9da69c75d288eb6882b6bf/calendar/base/content/widgets/calendar-list-tree.xml">comparison</a> |
<a href="/comm-central/log/ef3eebaf957dd3d48b9da69c75d288eb6882b6bf/calendar/base/content/widgets/calendar-list-tree.xml">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/ef3eebaf957dd3d48b9da69c75d288eb6882b6bf/calendar/base/content/widgets/calendar-widgets.xml">calendar/base/content/widgets/calendar-widgets.xml</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/ef3eebaf957dd3d48b9da69c75d288eb6882b6bf/calendar/base/content/widgets/calendar-widgets.xml">file</a> |
<a href="/comm-central/annotate/ef3eebaf957dd3d48b9da69c75d288eb6882b6bf/calendar/base/content/widgets/calendar-widgets.xml">annotate</a> |
<a href="/comm-central/diff/ef3eebaf957dd3d48b9da69c75d288eb6882b6bf/calendar/base/content/widgets/calendar-widgets.xml">diff</a> |
<a href="/comm-central/comparison/ef3eebaf957dd3d48b9da69c75d288eb6882b6bf/calendar/base/content/widgets/calendar-widgets.xml">comparison</a> |
<a href="/comm-central/log/ef3eebaf957dd3d48b9da69c75d288eb6882b6bf/calendar/base/content/widgets/calendar-widgets.xml">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/ef3eebaf957dd3d48b9da69c75d288eb6882b6bf/calendar/base/content/widgets/minimonth.xml">calendar/base/content/widgets/minimonth.xml</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/ef3eebaf957dd3d48b9da69c75d288eb6882b6bf/calendar/base/content/widgets/minimonth.xml">file</a> |
<a href="/comm-central/annotate/ef3eebaf957dd3d48b9da69c75d288eb6882b6bf/calendar/base/content/widgets/minimonth.xml">annotate</a> |
<a href="/comm-central/diff/ef3eebaf957dd3d48b9da69c75d288eb6882b6bf/calendar/base/content/widgets/minimonth.xml">diff</a> |
<a href="/comm-central/comparison/ef3eebaf957dd3d48b9da69c75d288eb6882b6bf/calendar/base/content/widgets/minimonth.xml">comparison</a> |
<a href="/comm-central/log/ef3eebaf957dd3d48b9da69c75d288eb6882b6bf/calendar/base/content/widgets/minimonth.xml">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/ef3eebaf957dd3d48b9da69c75d288eb6882b6bf/calendar/base/modules/calAuthUtils.jsm">calendar/base/modules/calAuthUtils.jsm</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/ef3eebaf957dd3d48b9da69c75d288eb6882b6bf/calendar/base/modules/calAuthUtils.jsm">file</a> |
<a href="/comm-central/annotate/ef3eebaf957dd3d48b9da69c75d288eb6882b6bf/calendar/base/modules/calAuthUtils.jsm">annotate</a> |
<a href="/comm-central/diff/ef3eebaf957dd3d48b9da69c75d288eb6882b6bf/calendar/base/modules/calAuthUtils.jsm">diff</a> |
<a href="/comm-central/comparison/ef3eebaf957dd3d48b9da69c75d288eb6882b6bf/calendar/base/modules/calAuthUtils.jsm">comparison</a> |
<a href="/comm-central/log/ef3eebaf957dd3d48b9da69c75d288eb6882b6bf/calendar/base/modules/calAuthUtils.jsm">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/ef3eebaf957dd3d48b9da69c75d288eb6882b6bf/calendar/base/modules/calItemUtils.jsm">calendar/base/modules/calItemUtils.jsm</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/ef3eebaf957dd3d48b9da69c75d288eb6882b6bf/calendar/base/modules/calItemUtils.jsm">file</a> |
<a href="/comm-central/annotate/ef3eebaf957dd3d48b9da69c75d288eb6882b6bf/calendar/base/modules/calItemUtils.jsm">annotate</a> |
<a href="/comm-central/diff/ef3eebaf957dd3d48b9da69c75d288eb6882b6bf/calendar/base/modules/calItemUtils.jsm">diff</a> |
<a href="/comm-central/comparison/ef3eebaf957dd3d48b9da69c75d288eb6882b6bf/calendar/base/modules/calItemUtils.jsm">comparison</a> |
<a href="/comm-central/log/ef3eebaf957dd3d48b9da69c75d288eb6882b6bf/calendar/base/modules/calItemUtils.jsm">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/ef3eebaf957dd3d48b9da69c75d288eb6882b6bf/calendar/base/modules/calIteratorUtils.jsm">calendar/base/modules/calIteratorUtils.jsm</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/ef3eebaf957dd3d48b9da69c75d288eb6882b6bf/calendar/base/modules/calIteratorUtils.jsm">file</a> |
<a href="/comm-central/annotate/ef3eebaf957dd3d48b9da69c75d288eb6882b6bf/calendar/base/modules/calIteratorUtils.jsm">annotate</a> |
<a href="/comm-central/diff/ef3eebaf957dd3d48b9da69c75d288eb6882b6bf/calendar/base/modules/calIteratorUtils.jsm">diff</a> |
<a href="/comm-central/comparison/ef3eebaf957dd3d48b9da69c75d288eb6882b6bf/calendar/base/modules/calIteratorUtils.jsm">comparison</a> |
<a href="/comm-central/log/ef3eebaf957dd3d48b9da69c75d288eb6882b6bf/calendar/base/modules/calIteratorUtils.jsm">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/ef3eebaf957dd3d48b9da69c75d288eb6882b6bf/calendar/base/modules/calItipUtils.jsm">calendar/base/modules/calItipUtils.jsm</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/ef3eebaf957dd3d48b9da69c75d288eb6882b6bf/calendar/base/modules/calItipUtils.jsm">file</a> |
<a href="/comm-central/annotate/ef3eebaf957dd3d48b9da69c75d288eb6882b6bf/calendar/base/modules/calItipUtils.jsm">annotate</a> |
<a href="/comm-central/diff/ef3eebaf957dd3d48b9da69c75d288eb6882b6bf/calendar/base/modules/calItipUtils.jsm">diff</a> |
<a href="/comm-central/comparison/ef3eebaf957dd3d48b9da69c75d288eb6882b6bf/calendar/base/modules/calItipUtils.jsm">comparison</a> |
<a href="/comm-central/log/ef3eebaf957dd3d48b9da69c75d288eb6882b6bf/calendar/base/modules/calItipUtils.jsm">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/ef3eebaf957dd3d48b9da69c75d288eb6882b6bf/calendar/base/modules/calPrintUtils.jsm">calendar/base/modules/calPrintUtils.jsm</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/ef3eebaf957dd3d48b9da69c75d288eb6882b6bf/calendar/base/modules/calPrintUtils.jsm">file</a> |
<a href="/comm-central/annotate/ef3eebaf957dd3d48b9da69c75d288eb6882b6bf/calendar/base/modules/calPrintUtils.jsm">annotate</a> |
<a href="/comm-central/diff/ef3eebaf957dd3d48b9da69c75d288eb6882b6bf/calendar/base/modules/calPrintUtils.jsm">diff</a> |
<a href="/comm-central/comparison/ef3eebaf957dd3d48b9da69c75d288eb6882b6bf/calendar/base/modules/calPrintUtils.jsm">comparison</a> |
<a href="/comm-central/log/ef3eebaf957dd3d48b9da69c75d288eb6882b6bf/calendar/base/modules/calPrintUtils.jsm">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/ef3eebaf957dd3d48b9da69c75d288eb6882b6bf/calendar/base/modules/calRecurrenceUtils.jsm">calendar/base/modules/calRecurrenceUtils.jsm</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/ef3eebaf957dd3d48b9da69c75d288eb6882b6bf/calendar/base/modules/calRecurrenceUtils.jsm">file</a> |
<a href="/comm-central/annotate/ef3eebaf957dd3d48b9da69c75d288eb6882b6bf/calendar/base/modules/calRecurrenceUtils.jsm">annotate</a> |
<a href="/comm-central/diff/ef3eebaf957dd3d48b9da69c75d288eb6882b6bf/calendar/base/modules/calRecurrenceUtils.jsm">diff</a> |
<a href="/comm-central/comparison/ef3eebaf957dd3d48b9da69c75d288eb6882b6bf/calendar/base/modules/calRecurrenceUtils.jsm">comparison</a> |
<a href="/comm-central/log/ef3eebaf957dd3d48b9da69c75d288eb6882b6bf/calendar/base/modules/calRecurrenceUtils.jsm">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/ef3eebaf957dd3d48b9da69c75d288eb6882b6bf/calendar/base/modules/calUtils.jsm">calendar/base/modules/calUtils.jsm</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/ef3eebaf957dd3d48b9da69c75d288eb6882b6bf/calendar/base/modules/calUtils.jsm">file</a> |
<a href="/comm-central/annotate/ef3eebaf957dd3d48b9da69c75d288eb6882b6bf/calendar/base/modules/calUtils.jsm">annotate</a> |
<a href="/comm-central/diff/ef3eebaf957dd3d48b9da69c75d288eb6882b6bf/calendar/base/modules/calUtils.jsm">diff</a> |
<a href="/comm-central/comparison/ef3eebaf957dd3d48b9da69c75d288eb6882b6bf/calendar/base/modules/calUtils.jsm">comparison</a> |
<a href="/comm-central/log/ef3eebaf957dd3d48b9da69c75d288eb6882b6bf/calendar/base/modules/calUtils.jsm">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/ef3eebaf957dd3d48b9da69c75d288eb6882b6bf/calendar/base/src/calAlarm.js">calendar/base/src/calAlarm.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/ef3eebaf957dd3d48b9da69c75d288eb6882b6bf/calendar/base/src/calAlarm.js">file</a> |
<a href="/comm-central/annotate/ef3eebaf957dd3d48b9da69c75d288eb6882b6bf/calendar/base/src/calAlarm.js">annotate</a> |
<a href="/comm-central/diff/ef3eebaf957dd3d48b9da69c75d288eb6882b6bf/calendar/base/src/calAlarm.js">diff</a> |
<a href="/comm-central/comparison/ef3eebaf957dd3d48b9da69c75d288eb6882b6bf/calendar/base/src/calAlarm.js">comparison</a> |
<a href="/comm-central/log/ef3eebaf957dd3d48b9da69c75d288eb6882b6bf/calendar/base/src/calAlarm.js">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/ef3eebaf957dd3d48b9da69c75d288eb6882b6bf/calendar/base/src/calAlarmMonitor.js">calendar/base/src/calAlarmMonitor.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/ef3eebaf957dd3d48b9da69c75d288eb6882b6bf/calendar/base/src/calAlarmMonitor.js">file</a> |
<a href="/comm-central/annotate/ef3eebaf957dd3d48b9da69c75d288eb6882b6bf/calendar/base/src/calAlarmMonitor.js">annotate</a> |
<a href="/comm-central/diff/ef3eebaf957dd3d48b9da69c75d288eb6882b6bf/calendar/base/src/calAlarmMonitor.js">diff</a> |
<a href="/comm-central/comparison/ef3eebaf957dd3d48b9da69c75d288eb6882b6bf/calendar/base/src/calAlarmMonitor.js">comparison</a> |
<a href="/comm-central/log/ef3eebaf957dd3d48b9da69c75d288eb6882b6bf/calendar/base/src/calAlarmMonitor.js">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/ef3eebaf957dd3d48b9da69c75d288eb6882b6bf/calendar/base/src/calAlarmService.js">calendar/base/src/calAlarmService.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/ef3eebaf957dd3d48b9da69c75d288eb6882b6bf/calendar/base/src/calAlarmService.js">file</a> |
<a href="/comm-central/annotate/ef3eebaf957dd3d48b9da69c75d288eb6882b6bf/calendar/base/src/calAlarmService.js">annotate</a> |
<a href="/comm-central/diff/ef3eebaf957dd3d48b9da69c75d288eb6882b6bf/calendar/base/src/calAlarmService.js">diff</a> |
<a href="/comm-central/comparison/ef3eebaf957dd3d48b9da69c75d288eb6882b6bf/calendar/base/src/calAlarmService.js">comparison</a> |
<a href="/comm-central/log/ef3eebaf957dd3d48b9da69c75d288eb6882b6bf/calendar/base/src/calAlarmService.js">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/ef3eebaf957dd3d48b9da69c75d288eb6882b6bf/calendar/base/src/calAttachment.js">calendar/base/src/calAttachment.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/ef3eebaf957dd3d48b9da69c75d288eb6882b6bf/calendar/base/src/calAttachment.js">file</a> |
<a href="/comm-central/annotate/ef3eebaf957dd3d48b9da69c75d288eb6882b6bf/calendar/base/src/calAttachment.js">annotate</a> |
<a href="/comm-central/diff/ef3eebaf957dd3d48b9da69c75d288eb6882b6bf/calendar/base/src/calAttachment.js">diff</a> |
<a href="/comm-central/comparison/ef3eebaf957dd3d48b9da69c75d288eb6882b6bf/calendar/base/src/calAttachment.js">comparison</a> |
<a href="/comm-central/log/ef3eebaf957dd3d48b9da69c75d288eb6882b6bf/calendar/base/src/calAttachment.js">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/ef3eebaf957dd3d48b9da69c75d288eb6882b6bf/calendar/base/src/calAttendee.js">calendar/base/src/calAttendee.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/ef3eebaf957dd3d48b9da69c75d288eb6882b6bf/calendar/base/src/calAttendee.js">file</a> |
<a href="/comm-central/annotate/ef3eebaf957dd3d48b9da69c75d288eb6882b6bf/calendar/base/src/calAttendee.js">annotate</a> |
<a href="/comm-central/diff/ef3eebaf957dd3d48b9da69c75d288eb6882b6bf/calendar/base/src/calAttendee.js">diff</a> |
<a href="/comm-central/comparison/ef3eebaf957dd3d48b9da69c75d288eb6882b6bf/calendar/base/src/calAttendee.js">comparison</a> |
<a href="/comm-central/log/ef3eebaf957dd3d48b9da69c75d288eb6882b6bf/calendar/base/src/calAttendee.js">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/ef3eebaf957dd3d48b9da69c75d288eb6882b6bf/calendar/base/src/calCachedCalendar.js">calendar/base/src/calCachedCalendar.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/ef3eebaf957dd3d48b9da69c75d288eb6882b6bf/calendar/base/src/calCachedCalendar.js">file</a> |
<a href="/comm-central/annotate/ef3eebaf957dd3d48b9da69c75d288eb6882b6bf/calendar/base/src/calCachedCalendar.js">annotate</a> |
<a href="/comm-central/diff/ef3eebaf957dd3d48b9da69c75d288eb6882b6bf/calendar/base/src/calCachedCalendar.js">diff</a> |
<a href="/comm-central/comparison/ef3eebaf957dd3d48b9da69c75d288eb6882b6bf/calendar/base/src/calCachedCalendar.js">comparison</a> |
<a href="/comm-central/log/ef3eebaf957dd3d48b9da69c75d288eb6882b6bf/calendar/base/src/calCachedCalendar.js">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/ef3eebaf957dd3d48b9da69c75d288eb6882b6bf/calendar/base/src/calCalendarManager.js">calendar/base/src/calCalendarManager.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/ef3eebaf957dd3d48b9da69c75d288eb6882b6bf/calendar/base/src/calCalendarManager.js">file</a> |
<a href="/comm-central/annotate/ef3eebaf957dd3d48b9da69c75d288eb6882b6bf/calendar/base/src/calCalendarManager.js">annotate</a> |
<a href="/comm-central/diff/ef3eebaf957dd3d48b9da69c75d288eb6882b6bf/calendar/base/src/calCalendarManager.js">diff</a> |
<a href="/comm-central/comparison/ef3eebaf957dd3d48b9da69c75d288eb6882b6bf/calendar/base/src/calCalendarManager.js">comparison</a> |
<a href="/comm-central/log/ef3eebaf957dd3d48b9da69c75d288eb6882b6bf/calendar/base/src/calCalendarManager.js">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/ef3eebaf957dd3d48b9da69c75d288eb6882b6bf/calendar/base/src/calDefaultACLManager.js">calendar/base/src/calDefaultACLManager.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/ef3eebaf957dd3d48b9da69c75d288eb6882b6bf/calendar/base/src/calDefaultACLManager.js">file</a> |
<a href="/comm-central/annotate/ef3eebaf957dd3d48b9da69c75d288eb6882b6bf/calendar/base/src/calDefaultACLManager.js">annotate</a> |
<a href="/comm-central/diff/ef3eebaf957dd3d48b9da69c75d288eb6882b6bf/calendar/base/src/calDefaultACLManager.js">diff</a> |
<a href="/comm-central/comparison/ef3eebaf957dd3d48b9da69c75d288eb6882b6bf/calendar/base/src/calDefaultACLManager.js">comparison</a> |
<a href="/comm-central/log/ef3eebaf957dd3d48b9da69c75d288eb6882b6bf/calendar/base/src/calDefaultACLManager.js">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/ef3eebaf957dd3d48b9da69c75d288eb6882b6bf/calendar/base/src/calFilter.js">calendar/base/src/calFilter.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/ef3eebaf957dd3d48b9da69c75d288eb6882b6bf/calendar/base/src/calFilter.js">file</a> |
<a href="/comm-central/annotate/ef3eebaf957dd3d48b9da69c75d288eb6882b6bf/calendar/base/src/calFilter.js">annotate</a> |
<a href="/comm-central/diff/ef3eebaf957dd3d48b9da69c75d288eb6882b6bf/calendar/base/src/calFilter.js">diff</a> |
<a href="/comm-central/comparison/ef3eebaf957dd3d48b9da69c75d288eb6882b6bf/calendar/base/src/calFilter.js">comparison</a> |
<a href="/comm-central/log/ef3eebaf957dd3d48b9da69c75d288eb6882b6bf/calendar/base/src/calFilter.js">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/ef3eebaf957dd3d48b9da69c75d288eb6882b6bf/calendar/base/src/calIcsParser.js">calendar/base/src/calIcsParser.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/ef3eebaf957dd3d48b9da69c75d288eb6882b6bf/calendar/base/src/calIcsParser.js">file</a> |
<a href="/comm-central/annotate/ef3eebaf957dd3d48b9da69c75d288eb6882b6bf/calendar/base/src/calIcsParser.js">annotate</a> |
<a href="/comm-central/diff/ef3eebaf957dd3d48b9da69c75d288eb6882b6bf/calendar/base/src/calIcsParser.js">diff</a> |
<a href="/comm-central/comparison/ef3eebaf957dd3d48b9da69c75d288eb6882b6bf/calendar/base/src/calIcsParser.js">comparison</a> |
<a href="/comm-central/log/ef3eebaf957dd3d48b9da69c75d288eb6882b6bf/calendar/base/src/calIcsParser.js">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/ef3eebaf957dd3d48b9da69c75d288eb6882b6bf/calendar/base/src/calIcsSerializer.js">calendar/base/src/calIcsSerializer.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/ef3eebaf957dd3d48b9da69c75d288eb6882b6bf/calendar/base/src/calIcsSerializer.js">file</a> |
<a href="/comm-central/annotate/ef3eebaf957dd3d48b9da69c75d288eb6882b6bf/calendar/base/src/calIcsSerializer.js">annotate</a> |
<a href="/comm-central/diff/ef3eebaf957dd3d48b9da69c75d288eb6882b6bf/calendar/base/src/calIcsSerializer.js">diff</a> |
<a href="/comm-central/comparison/ef3eebaf957dd3d48b9da69c75d288eb6882b6bf/calendar/base/src/calIcsSerializer.js">comparison</a> |
<a href="/comm-central/log/ef3eebaf957dd3d48b9da69c75d288eb6882b6bf/calendar/base/src/calIcsSerializer.js">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/ef3eebaf957dd3d48b9da69c75d288eb6882b6bf/calendar/base/src/calItemBase.js">calendar/base/src/calItemBase.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/ef3eebaf957dd3d48b9da69c75d288eb6882b6bf/calendar/base/src/calItemBase.js">file</a> |
<a href="/comm-central/annotate/ef3eebaf957dd3d48b9da69c75d288eb6882b6bf/calendar/base/src/calItemBase.js">annotate</a> |
<a href="/comm-central/diff/ef3eebaf957dd3d48b9da69c75d288eb6882b6bf/calendar/base/src/calItemBase.js">diff</a> |
<a href="/comm-central/comparison/ef3eebaf957dd3d48b9da69c75d288eb6882b6bf/calendar/base/src/calItemBase.js">comparison</a> |
<a href="/comm-central/log/ef3eebaf957dd3d48b9da69c75d288eb6882b6bf/calendar/base/src/calItemBase.js">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/ef3eebaf957dd3d48b9da69c75d288eb6882b6bf/calendar/base/src/calItipItem.js">calendar/base/src/calItipItem.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/ef3eebaf957dd3d48b9da69c75d288eb6882b6bf/calendar/base/src/calItipItem.js">file</a> |
<a href="/comm-central/annotate/ef3eebaf957dd3d48b9da69c75d288eb6882b6bf/calendar/base/src/calItipItem.js">annotate</a> |
<a href="/comm-central/diff/ef3eebaf957dd3d48b9da69c75d288eb6882b6bf/calendar/base/src/calItipItem.js">diff</a> |
<a href="/comm-central/comparison/ef3eebaf957dd3d48b9da69c75d288eb6882b6bf/calendar/base/src/calItipItem.js">comparison</a> |
<a href="/comm-central/log/ef3eebaf957dd3d48b9da69c75d288eb6882b6bf/calendar/base/src/calItipItem.js">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/ef3eebaf957dd3d48b9da69c75d288eb6882b6bf/calendar/base/src/calRecurrenceInfo.js">calendar/base/src/calRecurrenceInfo.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/ef3eebaf957dd3d48b9da69c75d288eb6882b6bf/calendar/base/src/calRecurrenceInfo.js">file</a> |
<a href="/comm-central/annotate/ef3eebaf957dd3d48b9da69c75d288eb6882b6bf/calendar/base/src/calRecurrenceInfo.js">annotate</a> |
<a href="/comm-central/diff/ef3eebaf957dd3d48b9da69c75d288eb6882b6bf/calendar/base/src/calRecurrenceInfo.js">diff</a> |
<a href="/comm-central/comparison/ef3eebaf957dd3d48b9da69c75d288eb6882b6bf/calendar/base/src/calRecurrenceInfo.js">comparison</a> |
<a href="/comm-central/log/ef3eebaf957dd3d48b9da69c75d288eb6882b6bf/calendar/base/src/calRecurrenceInfo.js">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/ef3eebaf957dd3d48b9da69c75d288eb6882b6bf/calendar/base/src/calRelation.js">calendar/base/src/calRelation.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/ef3eebaf957dd3d48b9da69c75d288eb6882b6bf/calendar/base/src/calRelation.js">file</a> |
<a href="/comm-central/annotate/ef3eebaf957dd3d48b9da69c75d288eb6882b6bf/calendar/base/src/calRelation.js">annotate</a> |
<a href="/comm-central/diff/ef3eebaf957dd3d48b9da69c75d288eb6882b6bf/calendar/base/src/calRelation.js">diff</a> |
<a href="/comm-central/comparison/ef3eebaf957dd3d48b9da69c75d288eb6882b6bf/calendar/base/src/calRelation.js">comparison</a> |
<a href="/comm-central/log/ef3eebaf957dd3d48b9da69c75d288eb6882b6bf/calendar/base/src/calRelation.js">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/ef3eebaf957dd3d48b9da69c75d288eb6882b6bf/calendar/base/src/calTimezoneService.js">calendar/base/src/calTimezoneService.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/ef3eebaf957dd3d48b9da69c75d288eb6882b6bf/calendar/base/src/calTimezoneService.js">file</a> |
<a href="/comm-central/annotate/ef3eebaf957dd3d48b9da69c75d288eb6882b6bf/calendar/base/src/calTimezoneService.js">annotate</a> |
<a href="/comm-central/diff/ef3eebaf957dd3d48b9da69c75d288eb6882b6bf/calendar/base/src/calTimezoneService.js">diff</a> |
<a href="/comm-central/comparison/ef3eebaf957dd3d48b9da69c75d288eb6882b6bf/calendar/base/src/calTimezoneService.js">comparison</a> |
<a href="/comm-central/log/ef3eebaf957dd3d48b9da69c75d288eb6882b6bf/calendar/base/src/calTimezoneService.js">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/ef3eebaf957dd3d48b9da69c75d288eb6882b6bf/calendar/base/src/calUtils.js">calendar/base/src/calUtils.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/ef3eebaf957dd3d48b9da69c75d288eb6882b6bf/calendar/base/src/calUtils.js">file</a> |
<a href="/comm-central/annotate/ef3eebaf957dd3d48b9da69c75d288eb6882b6bf/calendar/base/src/calUtils.js">annotate</a> |
<a href="/comm-central/diff/ef3eebaf957dd3d48b9da69c75d288eb6882b6bf/calendar/base/src/calUtils.js">diff</a> |
<a href="/comm-central/comparison/ef3eebaf957dd3d48b9da69c75d288eb6882b6bf/calendar/base/src/calUtils.js">comparison</a> |
<a href="/comm-central/log/ef3eebaf957dd3d48b9da69c75d288eb6882b6bf/calendar/base/src/calUtils.js">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/ef3eebaf957dd3d48b9da69c75d288eb6882b6bf/calendar/import-export/calHtmlExport.js">calendar/import-export/calHtmlExport.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/ef3eebaf957dd3d48b9da69c75d288eb6882b6bf/calendar/import-export/calHtmlExport.js">file</a> |
<a href="/comm-central/annotate/ef3eebaf957dd3d48b9da69c75d288eb6882b6bf/calendar/import-export/calHtmlExport.js">annotate</a> |
<a href="/comm-central/diff/ef3eebaf957dd3d48b9da69c75d288eb6882b6bf/calendar/import-export/calHtmlExport.js">diff</a> |
<a href="/comm-central/comparison/ef3eebaf957dd3d48b9da69c75d288eb6882b6bf/calendar/import-export/calHtmlExport.js">comparison</a> |
<a href="/comm-central/log/ef3eebaf957dd3d48b9da69c75d288eb6882b6bf/calendar/import-export/calHtmlExport.js">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/ef3eebaf957dd3d48b9da69c75d288eb6882b6bf/calendar/import-export/calMonthGridPrinter.js">calendar/import-export/calMonthGridPrinter.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/ef3eebaf957dd3d48b9da69c75d288eb6882b6bf/calendar/import-export/calMonthGridPrinter.js">file</a> |
<a href="/comm-central/annotate/ef3eebaf957dd3d48b9da69c75d288eb6882b6bf/calendar/import-export/calMonthGridPrinter.js">annotate</a> |
<a href="/comm-central/diff/ef3eebaf957dd3d48b9da69c75d288eb6882b6bf/calendar/import-export/calMonthGridPrinter.js">diff</a> |
<a href="/comm-central/comparison/ef3eebaf957dd3d48b9da69c75d288eb6882b6bf/calendar/import-export/calMonthGridPrinter.js">comparison</a> |
<a href="/comm-central/log/ef3eebaf957dd3d48b9da69c75d288eb6882b6bf/calendar/import-export/calMonthGridPrinter.js">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/ef3eebaf957dd3d48b9da69c75d288eb6882b6bf/calendar/import-export/calOutlookCSVImportExport.js">calendar/import-export/calOutlookCSVImportExport.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/ef3eebaf957dd3d48b9da69c75d288eb6882b6bf/calendar/import-export/calOutlookCSVImportExport.js">file</a> |
<a href="/comm-central/annotate/ef3eebaf957dd3d48b9da69c75d288eb6882b6bf/calendar/import-export/calOutlookCSVImportExport.js">annotate</a> |
<a href="/comm-central/diff/ef3eebaf957dd3d48b9da69c75d288eb6882b6bf/calendar/import-export/calOutlookCSVImportExport.js">diff</a> |
<a href="/comm-central/comparison/ef3eebaf957dd3d48b9da69c75d288eb6882b6bf/calendar/import-export/calOutlookCSVImportExport.js">comparison</a> |
<a href="/comm-central/log/ef3eebaf957dd3d48b9da69c75d288eb6882b6bf/calendar/import-export/calOutlookCSVImportExport.js">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/ef3eebaf957dd3d48b9da69c75d288eb6882b6bf/calendar/import-export/calWeekPrinter.js">calendar/import-export/calWeekPrinter.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/ef3eebaf957dd3d48b9da69c75d288eb6882b6bf/calendar/import-export/calWeekPrinter.js">file</a> |
<a href="/comm-central/annotate/ef3eebaf957dd3d48b9da69c75d288eb6882b6bf/calendar/import-export/calWeekPrinter.js">annotate</a> |
<a href="/comm-central/diff/ef3eebaf957dd3d48b9da69c75d288eb6882b6bf/calendar/import-export/calWeekPrinter.js">diff</a> |
<a href="/comm-central/comparison/ef3eebaf957dd3d48b9da69c75d288eb6882b6bf/calendar/import-export/calWeekPrinter.js">comparison</a> |
<a href="/comm-central/log/ef3eebaf957dd3d48b9da69c75d288eb6882b6bf/calendar/import-export/calWeekPrinter.js">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/ef3eebaf957dd3d48b9da69c75d288eb6882b6bf/calendar/providers/caldav/calDavCalendar.js">calendar/providers/caldav/calDavCalendar.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/ef3eebaf957dd3d48b9da69c75d288eb6882b6bf/calendar/providers/caldav/calDavCalendar.js">file</a> |
<a href="/comm-central/annotate/ef3eebaf957dd3d48b9da69c75d288eb6882b6bf/calendar/providers/caldav/calDavCalendar.js">annotate</a> |
<a href="/comm-central/diff/ef3eebaf957dd3d48b9da69c75d288eb6882b6bf/calendar/providers/caldav/calDavCalendar.js">diff</a> |
<a href="/comm-central/comparison/ef3eebaf957dd3d48b9da69c75d288eb6882b6bf/calendar/providers/caldav/calDavCalendar.js">comparison</a> |
<a href="/comm-central/log/ef3eebaf957dd3d48b9da69c75d288eb6882b6bf/calendar/providers/caldav/calDavCalendar.js">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/ef3eebaf957dd3d48b9da69c75d288eb6882b6bf/calendar/providers/composite/calCompositeCalendar.js">calendar/providers/composite/calCompositeCalendar.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/ef3eebaf957dd3d48b9da69c75d288eb6882b6bf/calendar/providers/composite/calCompositeCalendar.js">file</a> |
<a href="/comm-central/annotate/ef3eebaf957dd3d48b9da69c75d288eb6882b6bf/calendar/providers/composite/calCompositeCalendar.js">annotate</a> |
<a href="/comm-central/diff/ef3eebaf957dd3d48b9da69c75d288eb6882b6bf/calendar/providers/composite/calCompositeCalendar.js">diff</a> |
<a href="/comm-central/comparison/ef3eebaf957dd3d48b9da69c75d288eb6882b6bf/calendar/providers/composite/calCompositeCalendar.js">comparison</a> |
<a href="/comm-central/log/ef3eebaf957dd3d48b9da69c75d288eb6882b6bf/calendar/providers/composite/calCompositeCalendar.js">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/ef3eebaf957dd3d48b9da69c75d288eb6882b6bf/calendar/providers/ics/calICSCalendar.js">calendar/providers/ics/calICSCalendar.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/ef3eebaf957dd3d48b9da69c75d288eb6882b6bf/calendar/providers/ics/calICSCalendar.js">file</a> |
<a href="/comm-central/annotate/ef3eebaf957dd3d48b9da69c75d288eb6882b6bf/calendar/providers/ics/calICSCalendar.js">annotate</a> |
<a href="/comm-central/diff/ef3eebaf957dd3d48b9da69c75d288eb6882b6bf/calendar/providers/ics/calICSCalendar.js">diff</a> |
<a href="/comm-central/comparison/ef3eebaf957dd3d48b9da69c75d288eb6882b6bf/calendar/providers/ics/calICSCalendar.js">comparison</a> |
<a href="/comm-central/log/ef3eebaf957dd3d48b9da69c75d288eb6882b6bf/calendar/providers/ics/calICSCalendar.js">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/ef3eebaf957dd3d48b9da69c75d288eb6882b6bf/calendar/providers/storage/calStorageCalendar.js">calendar/providers/storage/calStorageCalendar.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/ef3eebaf957dd3d48b9da69c75d288eb6882b6bf/calendar/providers/storage/calStorageCalendar.js">file</a> |
<a href="/comm-central/annotate/ef3eebaf957dd3d48b9da69c75d288eb6882b6bf/calendar/providers/storage/calStorageCalendar.js">annotate</a> |
<a href="/comm-central/diff/ef3eebaf957dd3d48b9da69c75d288eb6882b6bf/calendar/providers/storage/calStorageCalendar.js">diff</a> |
<a href="/comm-central/comparison/ef3eebaf957dd3d48b9da69c75d288eb6882b6bf/calendar/providers/storage/calStorageCalendar.js">comparison</a> |
<a href="/comm-central/log/ef3eebaf957dd3d48b9da69c75d288eb6882b6bf/calendar/providers/storage/calStorageCalendar.js">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/ef3eebaf957dd3d48b9da69c75d288eb6882b6bf/calendar/providers/storage/calStorageUpgrade.jsm">calendar/providers/storage/calStorageUpgrade.jsm</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/ef3eebaf957dd3d48b9da69c75d288eb6882b6bf/calendar/providers/storage/calStorageUpgrade.jsm">file</a> |
<a href="/comm-central/annotate/ef3eebaf957dd3d48b9da69c75d288eb6882b6bf/calendar/providers/storage/calStorageUpgrade.jsm">annotate</a> |
<a href="/comm-central/diff/ef3eebaf957dd3d48b9da69c75d288eb6882b6bf/calendar/providers/storage/calStorageUpgrade.jsm">diff</a> |
<a href="/comm-central/comparison/ef3eebaf957dd3d48b9da69c75d288eb6882b6bf/calendar/providers/storage/calStorageUpgrade.jsm">comparison</a> |
<a href="/comm-central/log/ef3eebaf957dd3d48b9da69c75d288eb6882b6bf/calendar/providers/storage/calStorageUpgrade.jsm">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/ef3eebaf957dd3d48b9da69c75d288eb6882b6bf/calendar/providers/wcap/calWcapCalendar.js">calendar/providers/wcap/calWcapCalendar.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/ef3eebaf957dd3d48b9da69c75d288eb6882b6bf/calendar/providers/wcap/calWcapCalendar.js">file</a> |
<a href="/comm-central/annotate/ef3eebaf957dd3d48b9da69c75d288eb6882b6bf/calendar/providers/wcap/calWcapCalendar.js">annotate</a> |
<a href="/comm-central/diff/ef3eebaf957dd3d48b9da69c75d288eb6882b6bf/calendar/providers/wcap/calWcapCalendar.js">diff</a> |
<a href="/comm-central/comparison/ef3eebaf957dd3d48b9da69c75d288eb6882b6bf/calendar/providers/wcap/calWcapCalendar.js">comparison</a> |
<a href="/comm-central/log/ef3eebaf957dd3d48b9da69c75d288eb6882b6bf/calendar/providers/wcap/calWcapCalendar.js">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/ef3eebaf957dd3d48b9da69c75d288eb6882b6bf/calendar/providers/wcap/calWcapCalendarItems.js">calendar/providers/wcap/calWcapCalendarItems.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/ef3eebaf957dd3d48b9da69c75d288eb6882b6bf/calendar/providers/wcap/calWcapCalendarItems.js">file</a> |
<a href="/comm-central/annotate/ef3eebaf957dd3d48b9da69c75d288eb6882b6bf/calendar/providers/wcap/calWcapCalendarItems.js">annotate</a> |
<a href="/comm-central/diff/ef3eebaf957dd3d48b9da69c75d288eb6882b6bf/calendar/providers/wcap/calWcapCalendarItems.js">diff</a> |
<a href="/comm-central/comparison/ef3eebaf957dd3d48b9da69c75d288eb6882b6bf/calendar/providers/wcap/calWcapCalendarItems.js">comparison</a> |
<a href="/comm-central/log/ef3eebaf957dd3d48b9da69c75d288eb6882b6bf/calendar/providers/wcap/calWcapCalendarItems.js">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/ef3eebaf957dd3d48b9da69c75d288eb6882b6bf/calendar/providers/wcap/calWcapRequest.js">calendar/providers/wcap/calWcapRequest.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/ef3eebaf957dd3d48b9da69c75d288eb6882b6bf/calendar/providers/wcap/calWcapRequest.js">file</a> |
<a href="/comm-central/annotate/ef3eebaf957dd3d48b9da69c75d288eb6882b6bf/calendar/providers/wcap/calWcapRequest.js">annotate</a> |
<a href="/comm-central/diff/ef3eebaf957dd3d48b9da69c75d288eb6882b6bf/calendar/providers/wcap/calWcapRequest.js">diff</a> |
<a href="/comm-central/comparison/ef3eebaf957dd3d48b9da69c75d288eb6882b6bf/calendar/providers/wcap/calWcapRequest.js">comparison</a> |
<a href="/comm-central/log/ef3eebaf957dd3d48b9da69c75d288eb6882b6bf/calendar/providers/wcap/calWcapRequest.js">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/ef3eebaf957dd3d48b9da69c75d288eb6882b6bf/calendar/providers/wcap/calWcapSession.js">calendar/providers/wcap/calWcapSession.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/ef3eebaf957dd3d48b9da69c75d288eb6882b6bf/calendar/providers/wcap/calWcapSession.js">file</a> |
<a href="/comm-central/annotate/ef3eebaf957dd3d48b9da69c75d288eb6882b6bf/calendar/providers/wcap/calWcapSession.js">annotate</a> |
<a href="/comm-central/diff/ef3eebaf957dd3d48b9da69c75d288eb6882b6bf/calendar/providers/wcap/calWcapSession.js">diff</a> |
<a href="/comm-central/comparison/ef3eebaf957dd3d48b9da69c75d288eb6882b6bf/calendar/providers/wcap/calWcapSession.js">comparison</a> |
<a href="/comm-central/log/ef3eebaf957dd3d48b9da69c75d288eb6882b6bf/calendar/providers/wcap/calWcapSession.js">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/ef3eebaf957dd3d48b9da69c75d288eb6882b6bf/calendar/resources/content/datetimepickers/datetimepickers.xml">calendar/resources/content/datetimepickers/datetimepickers.xml</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/ef3eebaf957dd3d48b9da69c75d288eb6882b6bf/calendar/resources/content/datetimepickers/datetimepickers.xml">file</a> |
<a href="/comm-central/annotate/ef3eebaf957dd3d48b9da69c75d288eb6882b6bf/calendar/resources/content/datetimepickers/datetimepickers.xml">annotate</a> |
<a href="/comm-central/diff/ef3eebaf957dd3d48b9da69c75d288eb6882b6bf/calendar/resources/content/datetimepickers/datetimepickers.xml">diff</a> |
<a href="/comm-central/comparison/ef3eebaf957dd3d48b9da69c75d288eb6882b6bf/calendar/resources/content/datetimepickers/datetimepickers.xml">comparison</a> |
<a href="/comm-central/log/ef3eebaf957dd3d48b9da69c75d288eb6882b6bf/calendar/resources/content/datetimepickers/datetimepickers.xml">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/ef3eebaf957dd3d48b9da69c75d288eb6882b6bf/calendar/test/mozmill/shared-modules/timezone-utils.js">calendar/test/mozmill/shared-modules/timezone-utils.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/ef3eebaf957dd3d48b9da69c75d288eb6882b6bf/calendar/test/mozmill/shared-modules/timezone-utils.js">file</a> |
<a href="/comm-central/annotate/ef3eebaf957dd3d48b9da69c75d288eb6882b6bf/calendar/test/mozmill/shared-modules/timezone-utils.js">annotate</a> |
<a href="/comm-central/diff/ef3eebaf957dd3d48b9da69c75d288eb6882b6bf/calendar/test/mozmill/shared-modules/timezone-utils.js">diff</a> |
<a href="/comm-central/comparison/ef3eebaf957dd3d48b9da69c75d288eb6882b6bf/calendar/test/mozmill/shared-modules/timezone-utils.js">comparison</a> |
<a href="/comm-central/log/ef3eebaf957dd3d48b9da69c75d288eb6882b6bf/calendar/test/mozmill/shared-modules/timezone-utils.js">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/ef3eebaf957dd3d48b9da69c75d288eb6882b6bf/calendar/test/unit/test_alarmservice.js">calendar/test/unit/test_alarmservice.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/ef3eebaf957dd3d48b9da69c75d288eb6882b6bf/calendar/test/unit/test_alarmservice.js">file</a> |
<a href="/comm-central/annotate/ef3eebaf957dd3d48b9da69c75d288eb6882b6bf/calendar/test/unit/test_alarmservice.js">annotate</a> |
<a href="/comm-central/diff/ef3eebaf957dd3d48b9da69c75d288eb6882b6bf/calendar/test/unit/test_alarmservice.js">diff</a> |
<a href="/comm-central/comparison/ef3eebaf957dd3d48b9da69c75d288eb6882b6bf/calendar/test/unit/test_alarmservice.js">comparison</a> |
<a href="/comm-central/log/ef3eebaf957dd3d48b9da69c75d288eb6882b6bf/calendar/test/unit/test_alarmservice.js">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/ef3eebaf957dd3d48b9da69c75d288eb6882b6bf/calendar/test/unit/test_ics.js">calendar/test/unit/test_ics.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/ef3eebaf957dd3d48b9da69c75d288eb6882b6bf/calendar/test/unit/test_ics.js">file</a> |
<a href="/comm-central/annotate/ef3eebaf957dd3d48b9da69c75d288eb6882b6bf/calendar/test/unit/test_ics.js">annotate</a> |
<a href="/comm-central/diff/ef3eebaf957dd3d48b9da69c75d288eb6882b6bf/calendar/test/unit/test_ics.js">diff</a> |
<a href="/comm-central/comparison/ef3eebaf957dd3d48b9da69c75d288eb6882b6bf/calendar/test/unit/test_ics.js">comparison</a> |
<a href="/comm-central/log/ef3eebaf957dd3d48b9da69c75d288eb6882b6bf/calendar/test/unit/test_ics.js">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/ef3eebaf957dd3d48b9da69c75d288eb6882b6bf/calendar/test/unit/test_ics_service.js">calendar/test/unit/test_ics_service.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/ef3eebaf957dd3d48b9da69c75d288eb6882b6bf/calendar/test/unit/test_ics_service.js">file</a> |
<a href="/comm-central/annotate/ef3eebaf957dd3d48b9da69c75d288eb6882b6bf/calendar/test/unit/test_ics_service.js">annotate</a> |
<a href="/comm-central/diff/ef3eebaf957dd3d48b9da69c75d288eb6882b6bf/calendar/test/unit/test_ics_service.js">diff</a> |
<a href="/comm-central/comparison/ef3eebaf957dd3d48b9da69c75d288eb6882b6bf/calendar/test/unit/test_ics_service.js">comparison</a> |
<a href="/comm-central/log/ef3eebaf957dd3d48b9da69c75d288eb6882b6bf/calendar/test/unit/test_ics_service.js">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/ef3eebaf957dd3d48b9da69c75d288eb6882b6bf/calendar/test/unit/test_providers.js">calendar/test/unit/test_providers.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/ef3eebaf957dd3d48b9da69c75d288eb6882b6bf/calendar/test/unit/test_providers.js">file</a> |
<a href="/comm-central/annotate/ef3eebaf957dd3d48b9da69c75d288eb6882b6bf/calendar/test/unit/test_providers.js">annotate</a> |
<a href="/comm-central/diff/ef3eebaf957dd3d48b9da69c75d288eb6882b6bf/calendar/test/unit/test_providers.js">diff</a> |
<a href="/comm-central/comparison/ef3eebaf957dd3d48b9da69c75d288eb6882b6bf/calendar/test/unit/test_providers.js">comparison</a> |
<a href="/comm-central/log/ef3eebaf957dd3d48b9da69c75d288eb6882b6bf/calendar/test/unit/test_providers.js">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/ef3eebaf957dd3d48b9da69c75d288eb6882b6bf/calendar/test/unit/test_storage.js">calendar/test/unit/test_storage.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/ef3eebaf957dd3d48b9da69c75d288eb6882b6bf/calendar/test/unit/test_storage.js">file</a> |
<a href="/comm-central/annotate/ef3eebaf957dd3d48b9da69c75d288eb6882b6bf/calendar/test/unit/test_storage.js">annotate</a> |
<a href="/comm-central/diff/ef3eebaf957dd3d48b9da69c75d288eb6882b6bf/calendar/test/unit/test_storage.js">diff</a> |
<a href="/comm-central/comparison/ef3eebaf957dd3d48b9da69c75d288eb6882b6bf/calendar/test/unit/test_storage.js">comparison</a> |
<a href="/comm-central/log/ef3eebaf957dd3d48b9da69c75d288eb6882b6bf/calendar/test/unit/test_storage.js">revisions</a>
</td>
</tr>
</table></div>

<div class="page_body diffblocks"><div class="diffblock"><pre class="sourcelines">
<a href="#l1.1"></a><span id="l1.1" class="difflineminus">--- a/calendar/base/backend/icaljs/calICSService.js</span>
<a href="#l1.2"></a><span id="l1.2" class="difflineplus">+++ b/calendar/base/backend/icaljs/calICSService.js</span>
<a href="#l1.3"></a><span id="l1.3" class="difflineat">@@ -174,17 +174,17 @@ calIcalProperty.prototype = {</span>
<a href="#l1.4"></a><span id="l1.4">                     details.defaultType != innerObject.type) {</span>
<a href="#l1.5"></a><span id="l1.5">                     // Default type doesn't match object type, so we have a VALUE</span>
<a href="#l1.6"></a><span id="l1.6">                     // parameter</span>
<a href="#l1.7"></a><span id="l1.7">                     yield &quot;VALUE&quot;;</span>
<a href="#l1.8"></a><span id="l1.8">                 }</span>
<a href="#l1.9"></a><span id="l1.9">             }</span>
<a href="#l1.10"></a><span id="l1.10"> </span>
<a href="#l1.11"></a><span id="l1.11">             let paramNames = Object.keys(innerObject.jCal[1] || {});</span>
<a href="#l1.12"></a><span id="l1.12" class="difflineminus">-            for each (let name in paramNames) {</span>
<a href="#l1.13"></a><span id="l1.13" class="difflineplus">+            for (let name of paramNames) {</span>
<a href="#l1.14"></a><span id="l1.14">                 yield name.toUpperCase();</span>
<a href="#l1.15"></a><span id="l1.15">             }</span>
<a href="#l1.16"></a><span id="l1.16">         })();</span>
<a href="#l1.17"></a><span id="l1.17">         return this.getNextParameterName();</span>
<a href="#l1.18"></a><span id="l1.18">     },</span>
<a href="#l1.19"></a><span id="l1.19"> </span>
<a href="#l1.20"></a><span id="l1.20">     getNextParameterName: function() {</span>
<a href="#l1.21"></a><span id="l1.21">         if (this.paramIterator) {</span>
<a href="#l1.22"></a><span id="l1.22" class="difflineat">@@ -231,18 +231,20 @@ calIcalComponent.prototype = {</span>
<a href="#l1.23"></a><span id="l1.23">         if (kind == &quot;ANY&quot;) {</span>
<a href="#l1.24"></a><span id="l1.24">             kind = null;</span>
<a href="#l1.25"></a><span id="l1.25">         } else if (kind) {</span>
<a href="#l1.26"></a><span id="l1.26">             kind = kind.toLowerCase();</span>
<a href="#l1.27"></a><span id="l1.27">         }</span>
<a href="#l1.28"></a><span id="l1.28">         let innerObject = this.innerObject;</span>
<a href="#l1.29"></a><span id="l1.29">         this.componentIterator = (function() {</span>
<a href="#l1.30"></a><span id="l1.30">             let comps = innerObject.getAllSubcomponents(kind);</span>
<a href="#l1.31"></a><span id="l1.31" class="difflineminus">-            for each (let comp in comps) {</span>
<a href="#l1.32"></a><span id="l1.32" class="difflineminus">-                yield new calIcalComponent(comp);</span>
<a href="#l1.33"></a><span id="l1.33" class="difflineplus">+            if (comps) {</span>
<a href="#l1.34"></a><span id="l1.34" class="difflineplus">+                for (let comp of comps) {</span>
<a href="#l1.35"></a><span id="l1.35" class="difflineplus">+                    yield new calIcalComponent(comp);</span>
<a href="#l1.36"></a><span id="l1.36" class="difflineplus">+                }</span>
<a href="#l1.37"></a><span id="l1.37">             }</span>
<a href="#l1.38"></a><span id="l1.38">         })();</span>
<a href="#l1.39"></a><span id="l1.39">         return this.getNextSubcomponent(kind)</span>
<a href="#l1.40"></a><span id="l1.40">     },</span>
<a href="#l1.41"></a><span id="l1.41">     getNextSubcomponent: function(kind) {</span>
<a href="#l1.42"></a><span id="l1.42">         if (this.componentIterator) {</span>
<a href="#l1.43"></a><span id="l1.43">             try {</span>
<a href="#l1.44"></a><span id="l1.44">                 return this.componentIterator.next();</span>
<a href="#l1.45"></a><span id="l1.45" class="difflineat">@@ -349,22 +351,25 @@ calIcalComponent.prototype = {</span>
<a href="#l1.46"></a><span id="l1.46">         if (kind == &quot;ANY&quot;) {</span>
<a href="#l1.47"></a><span id="l1.47">             kind = null;</span>
<a href="#l1.48"></a><span id="l1.48">         } else if (kind) {</span>
<a href="#l1.49"></a><span id="l1.49">             kind = kind.toLowerCase();</span>
<a href="#l1.50"></a><span id="l1.50">         }</span>
<a href="#l1.51"></a><span id="l1.51">         let innerObject = this.innerObject;</span>
<a href="#l1.52"></a><span id="l1.52">         this.propertyIterator = (function() {</span>
<a href="#l1.53"></a><span id="l1.53">             let props = innerObject.getAllProperties(kind);</span>
<a href="#l1.54"></a><span id="l1.54" class="difflineminus">-            for each (var prop in props) {</span>
<a href="#l1.55"></a><span id="l1.55" class="difflineplus">+            if (!props) {</span>
<a href="#l1.56"></a><span id="l1.56" class="difflineplus">+                return;</span>
<a href="#l1.57"></a><span id="l1.57" class="difflineplus">+            }</span>
<a href="#l1.58"></a><span id="l1.58" class="difflineplus">+            for (var prop of props) {</span>
<a href="#l1.59"></a><span id="l1.59">                 let hell = prop.getValues();</span>
<a href="#l1.60"></a><span id="l1.60">                 if (hell.length &gt; 1) {</span>
<a href="#l1.61"></a><span id="l1.61">                     // Uh oh, multiple property values. Our code expects each as one</span>
<a href="#l1.62"></a><span id="l1.62">                     // property. I hate API incompatibility!</span>
<a href="#l1.63"></a><span id="l1.63" class="difflineminus">-                    for each (var devil in hell) {</span>
<a href="#l1.64"></a><span id="l1.64" class="difflineplus">+                    for (var devil of hell) {</span>
<a href="#l1.65"></a><span id="l1.65">                         var thisprop = new ICAL.Property(prop.toJSON(),</span>
<a href="#l1.66"></a><span id="l1.66">                                                          prop.parent);</span>
<a href="#l1.67"></a><span id="l1.67">                         thisprop.removeAllValues();</span>
<a href="#l1.68"></a><span id="l1.68">                         thisprop.setValue(devil);</span>
<a href="#l1.69"></a><span id="l1.69">                         yield new calIcalProperty(thisprop);</span>
<a href="#l1.70"></a><span id="l1.70">                     }</span>
<a href="#l1.71"></a><span id="l1.71">                 } else {</span>
<a href="#l1.72"></a><span id="l1.72">                     yield new calIcalProperty(prop);</span>
<a href="#l1.73"></a><span id="l1.73" class="difflineat">@@ -418,17 +423,17 @@ calIcalComponent.prototype = {</span>
<a href="#l1.74"></a><span id="l1.74">                 }</span>
<a href="#l1.75"></a><span id="l1.75">             }</span>
<a href="#l1.76"></a><span id="l1.76"> </span>
<a href="#l1.77"></a><span id="l1.77">             this.mReferencedZones[tz.tzid] = tz;</span>
<a href="#l1.78"></a><span id="l1.78">         }</span>
<a href="#l1.79"></a><span id="l1.79">     },</span>
<a href="#l1.80"></a><span id="l1.80"> </span>
<a href="#l1.81"></a><span id="l1.81">     getReferencedTimezones: function(aCount) {</span>
<a href="#l1.82"></a><span id="l1.82" class="difflineminus">-        let vals = [ tz for each (tz in this.mReferencedZones) ];</span>
<a href="#l1.83"></a><span id="l1.83" class="difflineplus">+        let vals = Object.keys(this.mReferencedZones).map(tz =&gt; this.mReferencedZones[tz]);</span>
<a href="#l1.84"></a><span id="l1.84">         aCount.value = vals.length;</span>
<a href="#l1.85"></a><span id="l1.85">         return vals;</span>
<a href="#l1.86"></a><span id="l1.86">     },</span>
<a href="#l1.87"></a><span id="l1.87"> </span>
<a href="#l1.88"></a><span id="l1.88">     serializeToICSStream: function() {</span>
<a href="#l1.89"></a><span id="l1.89">         let unicodeConverter = Components.classes[&quot;@mozilla.org/intl/scriptableunicodeconverter&quot;]</span>
<a href="#l1.90"></a><span id="l1.90">                                          .createInstance(Components.interfaces.nsIScriptableUnicodeConverter);</span>
<a href="#l1.91"></a><span id="l1.91">         unicodeConverter.charset = &quot;UTF-8&quot;;</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l2.1"></a><span id="l2.1" class="difflineminus">--- a/calendar/base/content/agenda-listbox.js</span>
<a href="#l2.2"></a><span id="l2.2" class="difflineplus">+++ b/calendar/base/content/agenda-listbox.js</span>
<a href="#l2.3"></a><span id="l2.3" class="difflineat">@@ -63,17 +63,17 @@ function initAgendaListbox() {</span>
<a href="#l2.4"></a><span id="l2.4">  * Clean up the agenda listbox, used on window unload.</span>
<a href="#l2.5"></a><span id="l2.5">  */</span>
<a href="#l2.6"></a><span id="l2.6"> agendaListbox.uninit =</span>
<a href="#l2.7"></a><span id="l2.7"> function uninit() {</span>
<a href="#l2.8"></a><span id="l2.8">     if (this.calendar) {</span>
<a href="#l2.9"></a><span id="l2.9">         this.calendar.removeObserver(this.calendarObserver);</span>
<a href="#l2.10"></a><span id="l2.10">     }</span>
<a href="#l2.11"></a><span id="l2.11"> </span>
<a href="#l2.12"></a><span id="l2.12" class="difflineminus">-    for each (var period in this.periods) {</span>
<a href="#l2.13"></a><span id="l2.13" class="difflineplus">+    for (var period of this.periods) {</span>
<a href="#l2.14"></a><span id="l2.14">         if (period.listItem) {</span>
<a href="#l2.15"></a><span id="l2.15">             period.listItem.getCheckbox()</span>
<a href="#l2.16"></a><span id="l2.16">                   .removeEventListener(&quot;CheckboxStateChange&quot;,</span>
<a href="#l2.17"></a><span id="l2.17">                                        this.onCheckboxChange,</span>
<a href="#l2.18"></a><span id="l2.18">                                        true);</span>
<a href="#l2.19"></a><span id="l2.19">         }</span>
<a href="#l2.20"></a><span id="l2.20">     }</span>
<a href="#l2.21"></a><span id="l2.21"> };</span>
<a href="#l2.22"></a><span id="l2.22" class="difflineat">@@ -510,18 +510,18 @@ function deleteItem(aItem, aMoveSelectio</span>
<a href="#l2.23"></a><span id="l2.23"> </span>
<a href="#l2.24"></a><span id="l2.24"> /**</span>
<a href="#l2.25"></a><span id="l2.25">  * Remove all items belonging to the specified calendar.</span>
<a href="#l2.26"></a><span id="l2.26">  *</span>
<a href="#l2.27"></a><span id="l2.27">  * @param aCalendar         The item to compare.</span>
<a href="#l2.28"></a><span id="l2.28">  */</span>
<a href="#l2.29"></a><span id="l2.29"> agendaListbox.deleteItemsFromCalendar =</span>
<a href="#l2.30"></a><span id="l2.30"> function deleteItemsFromCalendar(aCalendar) {</span>
<a href="#l2.31"></a><span id="l2.31" class="difflineminus">-    let childNodes = Array.slice(this.agendaListboxControl.childNodes);</span>
<a href="#l2.32"></a><span id="l2.32" class="difflineminus">-    for each (let childNode in childNodes) {</span>
<a href="#l2.33"></a><span id="l2.33" class="difflineplus">+    let childNodes = Array.from(this.agendaListboxControl.childNodes);</span>
<a href="#l2.34"></a><span id="l2.34" class="difflineplus">+    for (let childNode of childNodes) {</span>
<a href="#l2.35"></a><span id="l2.35">         if (childNode &amp;&amp; childNode.occurrence</span>
<a href="#l2.36"></a><span id="l2.36">             &amp;&amp; childNode.occurrence.calendar.id == aCalendar.id) {</span>
<a href="#l2.37"></a><span id="l2.37">             childNode.remove();</span>
<a href="#l2.38"></a><span id="l2.38">         }</span>
<a href="#l2.39"></a><span id="l2.39">     }</span>
<a href="#l2.40"></a><span id="l2.40"> }</span>
<a href="#l2.41"></a><span id="l2.41"> </span>
<a href="#l2.42"></a><span id="l2.42"> /**</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l3.1"></a><span id="l3.1" class="difflineminus">--- a/calendar/base/content/calendar-base-view.xml</span>
<a href="#l3.2"></a><span id="l3.2" class="difflineplus">+++ b/calendar/base/content/calendar-base-view.xml</span>
<a href="#l3.3"></a><span id="l3.3" class="difflineat">@@ -90,17 +90,17 @@</span>
<a href="#l3.4"></a><span id="l3.4">                     if (aItem.isCompleted &amp;&amp; !this.calView.mShowCompleted) {</span>
<a href="#l3.5"></a><span id="l3.5">                         return;</span>
<a href="#l3.6"></a><span id="l3.6">                     }</span>
<a href="#l3.7"></a><span id="l3.7">                 }</span>
<a href="#l3.8"></a><span id="l3.8"> </span>
<a href="#l3.9"></a><span id="l3.9">                 let occs = aItem.getOccurrencesBetween(this.calView.startDate,</span>
<a href="#l3.10"></a><span id="l3.10">                                                        this.calView.queryEndDate,</span>
<a href="#l3.11"></a><span id="l3.11">                                                        {});</span>
<a href="#l3.12"></a><span id="l3.12" class="difflineminus">-                for each (let occ in occs) {</span>
<a href="#l3.13"></a><span id="l3.13" class="difflineplus">+                for (let occ of occs) {</span>
<a href="#l3.14"></a><span id="l3.14">                     this.calView.doAddItem(occ);</span>
<a href="#l3.15"></a><span id="l3.15">                 }</span>
<a href="#l3.16"></a><span id="l3.16">                 return;</span>
<a href="#l3.17"></a><span id="l3.17">             },</span>
<a href="#l3.18"></a><span id="l3.18"> </span>
<a href="#l3.19"></a><span id="l3.19">             onModifyItem: function onModifyItem(aNewItem, aOldItem) {</span>
<a href="#l3.20"></a><span id="l3.20"> </span>
<a href="#l3.21"></a><span id="l3.21">                 if (cal.isToDo(aNewItem) &amp;&amp; cal.isToDo(aOldItem) &amp;&amp;</span>
<a href="#l3.22"></a><span id="l3.22" class="difflineat">@@ -108,33 +108,33 @@</span>
<a href="#l3.23"></a><span id="l3.23">                     return;</span>
<a href="#l3.24"></a><span id="l3.24">                 }</span>
<a href="#l3.25"></a><span id="l3.25">                 let occs;</span>
<a href="#l3.26"></a><span id="l3.26"> </span>
<a href="#l3.27"></a><span id="l3.27">                 if (!cal.isToDo(aOldItem) || aOldItem.entryDate || aOldItem.dueDate) {</span>
<a href="#l3.28"></a><span id="l3.28">                     occs = aOldItem.getOccurrencesBetween(this.calView.startDate,</span>
<a href="#l3.29"></a><span id="l3.29">                                                           this.calView.queryEndDate,</span>
<a href="#l3.30"></a><span id="l3.30">                                                           {});</span>
<a href="#l3.31"></a><span id="l3.31" class="difflineminus">-                    for each (let occ in occs) {</span>
<a href="#l3.32"></a><span id="l3.32" class="difflineplus">+                    for (let occ of occs) {</span>
<a href="#l3.33"></a><span id="l3.33">                         this.calView.doDeleteItem(occ);</span>
<a href="#l3.34"></a><span id="l3.34">                     }</span>
<a href="#l3.35"></a><span id="l3.35">                 }</span>
<a href="#l3.36"></a><span id="l3.36">                 if (cal.isToDo(aNewItem)) {</span>
<a href="#l3.37"></a><span id="l3.37">                     if (!aNewItem.entryDate &amp;&amp; !aNewItem.dueDate || !this.calView.mTasksInView) {</span>
<a href="#l3.38"></a><span id="l3.38">                         return;</span>
<a href="#l3.39"></a><span id="l3.39">                     }</span>
<a href="#l3.40"></a><span id="l3.40">                     if (aNewItem.isCompleted &amp;&amp; !this.calView.mShowCompleted) {</span>
<a href="#l3.41"></a><span id="l3.41">                         return;</span>
<a href="#l3.42"></a><span id="l3.42">                     }</span>
<a href="#l3.43"></a><span id="l3.43">                 }</span>
<a href="#l3.44"></a><span id="l3.44"> </span>
<a href="#l3.45"></a><span id="l3.45">                 occs = aNewItem.getOccurrencesBetween(this.calView.startDate,</span>
<a href="#l3.46"></a><span id="l3.46">                                                       this.calView.queryEndDate,</span>
<a href="#l3.47"></a><span id="l3.47">                                                       {});</span>
<a href="#l3.48"></a><span id="l3.48" class="difflineminus">-                for each (let occ in occs) {</span>
<a href="#l3.49"></a><span id="l3.49" class="difflineplus">+                for (let occ of occs) {</span>
<a href="#l3.50"></a><span id="l3.50">                     this.calView.doAddItem(occ);</span>
<a href="#l3.51"></a><span id="l3.51">                 }</span>
<a href="#l3.52"></a><span id="l3.52">             },</span>
<a href="#l3.53"></a><span id="l3.53"> </span>
<a href="#l3.54"></a><span id="l3.54">             onDeleteItem: function onDeleteItem(aItem) {</span>
<a href="#l3.55"></a><span id="l3.55"> </span>
<a href="#l3.56"></a><span id="l3.56">                 if (cal.isToDo(aItem)) {</span>
<a href="#l3.57"></a><span id="l3.57">                     if (!this.calView.mTasksInView) {</span>
<a href="#l3.58"></a><span id="l3.58" class="difflineat">@@ -146,17 +146,17 @@</span>
<a href="#l3.59"></a><span id="l3.59">                     if (aItem.isCompleted &amp;&amp; !this.calView.mShowCompleted) {</span>
<a href="#l3.60"></a><span id="l3.60">                         return;</span>
<a href="#l3.61"></a><span id="l3.61">                     }</span>
<a href="#l3.62"></a><span id="l3.62">                 }</span>
<a href="#l3.63"></a><span id="l3.63"> </span>
<a href="#l3.64"></a><span id="l3.64">                 let occs = aItem.getOccurrencesBetween(this.calView.startDate,</span>
<a href="#l3.65"></a><span id="l3.65">                                                        this.calView.queryEndDate,</span>
<a href="#l3.66"></a><span id="l3.66">                                                        {});</span>
<a href="#l3.67"></a><span id="l3.67" class="difflineminus">-                for each (let occ in occs) {</span>
<a href="#l3.68"></a><span id="l3.68" class="difflineplus">+                for (let occ of occs) {</span>
<a href="#l3.69"></a><span id="l3.69">                     this.calView.doDeleteItem(occ);</span>
<a href="#l3.70"></a><span id="l3.70">                 }</span>
<a href="#l3.71"></a><span id="l3.71">             },</span>
<a href="#l3.72"></a><span id="l3.72"> </span>
<a href="#l3.73"></a><span id="l3.73">             onError: function onError(aCalendar, aErrNo, aMessage) { },</span>
<a href="#l3.74"></a><span id="l3.74"> </span>
<a href="#l3.75"></a><span id="l3.75">             onPropertyChanged: function(aCalendar, aName, aValue, aOldValue) {</span>
<a href="#l3.76"></a><span id="l3.76">                 switch (aName) {</span>
<a href="#l3.77"></a><span id="l3.77" class="difflineat">@@ -188,17 +188,18 @@</span>
<a href="#l3.78"></a><span id="l3.78"> </span>
<a href="#l3.79"></a><span id="l3.79">             onRemoveAlarmsByItem: function onRemoveAlarmsByItem(aItem) {</span>
<a href="#l3.80"></a><span id="l3.80">                 // Stop the flashing for the item.</span>
<a href="#l3.81"></a><span id="l3.81">                 this.calView.flashAlarm(aItem, true);</span>
<a href="#l3.82"></a><span id="l3.82">             },</span>
<a href="#l3.83"></a><span id="l3.83"> </span>
<a href="#l3.84"></a><span id="l3.84">             onRemoveAlarmsByCalendar: function onRemoveAlarmsByCalendar(aCalendar) {</span>
<a href="#l3.85"></a><span id="l3.85">                 // Stop the flashing for all items of this calendar</span>
<a href="#l3.86"></a><span id="l3.86" class="difflineminus">-                for each (let item in this.calView.mFlashingEvents) {</span>
<a href="#l3.87"></a><span id="l3.87" class="difflineplus">+                for (let key in this.calView.mFlashingEvents) {</span>
<a href="#l3.88"></a><span id="l3.88" class="difflineplus">+                    let item = this.calView.mFlashingEvents[key];</span>
<a href="#l3.89"></a><span id="l3.89">                     if (item.calendar.id == aCalendar.id) {</span>
<a href="#l3.90"></a><span id="l3.90">                         this.calView.flashAlarm(item, true);</span>
<a href="#l3.91"></a><span id="l3.91">                     }</span>
<a href="#l3.92"></a><span id="l3.92">                 }</span>
<a href="#l3.93"></a><span id="l3.93">             },</span>
<a href="#l3.94"></a><span id="l3.94"> </span>
<a href="#l3.95"></a><span id="l3.95">             onAlarmsLoaded: function _onAlarmsLoaded(aCalendar) {},</span>
<a href="#l3.96"></a><span id="l3.96"> </span>
<a href="#l3.97"></a><span id="l3.97" class="difflineat">@@ -592,17 +593,17 @@</span>
<a href="#l3.98"></a><span id="l3.98">             }</span>
<a href="#l3.99"></a><span id="l3.99">         ]]&gt;&lt;/body&gt;</span>
<a href="#l3.100"></a><span id="l3.100">       &lt;/method&gt;</span>
<a href="#l3.101"></a><span id="l3.101"> </span>
<a href="#l3.102"></a><span id="l3.102">       &lt;method name=&quot;getLongWeekdayTotalPixels&quot;&gt;</span>
<a href="#l3.103"></a><span id="l3.103">         &lt;body&gt;&lt;![CDATA[</span>
<a href="#l3.104"></a><span id="l3.104">           if (this.mLongWeekdayTotalPixels &lt;= 0) {</span>
<a href="#l3.105"></a><span id="l3.105">               let maxDayWidth = 0;</span>
<a href="#l3.106"></a><span id="l3.106" class="difflineminus">-              for each (let label in this.labeldaybox.childNodes) {</span>
<a href="#l3.107"></a><span id="l3.107" class="difflineplus">+              for (let label of this.labeldaybox.childNodes) {</span>
<a href="#l3.108"></a><span id="l3.108">                   if (label.localName &amp;&amp; label.localName == &quot;calendar-day-label&quot;) {</span>
<a href="#l3.109"></a><span id="l3.109">                       label.shortWeekNames = false;</span>
<a href="#l3.110"></a><span id="l3.110">                       let curPixelLength = label.getLongWeekdayPixels();</span>
<a href="#l3.111"></a><span id="l3.111">                       maxDayWidth = Math.max(maxDayWidth, curPixelLength);</span>
<a href="#l3.112"></a><span id="l3.112">                   }</span>
<a href="#l3.113"></a><span id="l3.113">               }</span>
<a href="#l3.114"></a><span id="l3.114">               if (maxDayWidth &gt; 0) {</span>
<a href="#l3.115"></a><span id="l3.115">                   this.mLongWeekdayTotalPixels = (maxDayWidth * this.labeldaybox.childNodes.length) + 10;</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l4.1"></a><span id="l4.1" class="difflineminus">--- a/calendar/base/content/calendar-clipboard.js</span>
<a href="#l4.2"></a><span id="l4.2" class="difflineplus">+++ b/calendar/base/content/calendar-clipboard.js</span>
<a href="#l4.3"></a><span id="l4.3" class="difflineat">@@ -139,17 +139,17 @@ function pasteFromClipboard() {</span>
<a href="#l4.4"></a><span id="l4.4">             let items = icsParser.getItems({});</span>
<a href="#l4.5"></a><span id="l4.5">             if (items.length == 0) {</span>
<a href="#l4.6"></a><span id="l4.6">                 return;</span>
<a href="#l4.7"></a><span id="l4.7">             }</span>
<a href="#l4.8"></a><span id="l4.8"> </span>
<a href="#l4.9"></a><span id="l4.9">             // If there are multiple items on the clipboard, the earliest</span>
<a href="#l4.10"></a><span id="l4.10">             // should be set to the selected day and the rest adjusted.</span>
<a href="#l4.11"></a><span id="l4.11">             let earliestDate = null;</span>
<a href="#l4.12"></a><span id="l4.12" class="difflineminus">-            for each (let item in items) {</span>
<a href="#l4.13"></a><span id="l4.13" class="difflineplus">+            for (let item of items) {</span>
<a href="#l4.14"></a><span id="l4.14">                 let date = null;</span>
<a href="#l4.15"></a><span id="l4.15">                 if (item.startDate) {</span>
<a href="#l4.16"></a><span id="l4.16">                     date = item.startDate.clone();</span>
<a href="#l4.17"></a><span id="l4.17">                 } else if (item.entryDate) {</span>
<a href="#l4.18"></a><span id="l4.18">                     date = item.entryDate.clone();</span>
<a href="#l4.19"></a><span id="l4.19">                 } else if (item.dueDate) {</span>
<a href="#l4.20"></a><span id="l4.20">                     date = item.dueDate.clone();</span>
<a href="#l4.21"></a><span id="l4.21">                 }</span>
<a href="#l4.22"></a><span id="l4.22" class="difflineat">@@ -172,17 +172,17 @@ function pasteFromClipboard() {</span>
<a href="#l4.23"></a><span id="l4.23">                 earliestDate = earliestDate.getInTimezone(calendarDefaultTimezone());</span>
<a href="#l4.24"></a><span id="l4.24">                 earliestDate.isDate = true;</span>
<a href="#l4.25"></a><span id="l4.25">                 offset = firstDate.subtractDate(earliestDate);</span>
<a href="#l4.26"></a><span id="l4.26">                 let deltaDST = firstDate.timezoneOffset - earliestDate.timezoneOffset;</span>
<a href="#l4.27"></a><span id="l4.27">                 offset.inSeconds += deltaDST;</span>
<a href="#l4.28"></a><span id="l4.28">             }</span>
<a href="#l4.29"></a><span id="l4.29"> </span>
<a href="#l4.30"></a><span id="l4.30">             startBatchTransaction();</span>
<a href="#l4.31"></a><span id="l4.31" class="difflineminus">-            for each (let item in items) {</span>
<a href="#l4.32"></a><span id="l4.32" class="difflineplus">+            for (let item of items) {</span>
<a href="#l4.33"></a><span id="l4.33">                 let newItem = item.clone();</span>
<a href="#l4.34"></a><span id="l4.34">                 // Set new UID to allow multiple paste actions of the same</span>
<a href="#l4.35"></a><span id="l4.35">                 // clipboard content.</span>
<a href="#l4.36"></a><span id="l4.36">                 newItem.id = cal.getUUID();</span>
<a href="#l4.37"></a><span id="l4.37">                 if (offset) {</span>
<a href="#l4.38"></a><span id="l4.38">                     cal.shiftItem(newItem, offset);</span>
<a href="#l4.39"></a><span id="l4.39">                 }</span>
<a href="#l4.40"></a><span id="l4.40">                 doTransaction('add', newItem, destCal, null, null);</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l5.1"></a><span id="l5.1" class="difflineminus">--- a/calendar/base/content/calendar-common-sets.js</span>
<a href="#l5.2"></a><span id="l5.2" class="difflineplus">+++ b/calendar/base/content/calendar-common-sets.js</span>
<a href="#l5.3"></a><span id="l5.3" class="difflineat">@@ -449,17 +449,17 @@ var calendarController = {</span>
<a href="#l5.4"></a><span id="l5.4">         calendarController.item_selected = selectedItems &amp;&amp; (selectedItems.length &gt; 0);</span>
<a href="#l5.5"></a><span id="l5.5"> </span>
<a href="#l5.6"></a><span id="l5.6">         let selLength = (selectedItems === undefined ? 0 : selectedItems.length);</span>
<a href="#l5.7"></a><span id="l5.7">         let selected_events_readonly = 0;</span>
<a href="#l5.8"></a><span id="l5.8">         let selected_events_requires_network = 0;</span>
<a href="#l5.9"></a><span id="l5.9">         let selected_events_invitation = 0;</span>
<a href="#l5.10"></a><span id="l5.10"> </span>
<a href="#l5.11"></a><span id="l5.11">         if (selLength &gt; 0) {</span>
<a href="#l5.12"></a><span id="l5.12" class="difflineminus">-            for each (var item in selectedItems) {</span>
<a href="#l5.13"></a><span id="l5.13" class="difflineplus">+            for (var item of selectedItems) {</span>
<a href="#l5.14"></a><span id="l5.14">                 if (item.calendar.readOnly) {</span>
<a href="#l5.15"></a><span id="l5.15">                     selected_events_readonly++;</span>
<a href="#l5.16"></a><span id="l5.16">                 }</span>
<a href="#l5.17"></a><span id="l5.17">                 if (item.calendar.getProperty(&quot;requiresNetwork&quot;) &amp;&amp;</span>
<a href="#l5.18"></a><span id="l5.18">                     !item.calendar.getProperty(&quot;cache.enabled&quot;) &amp;&amp;</span>
<a href="#l5.19"></a><span id="l5.19">                     !item.calendar.getProperty(&quot;cache.always&quot;)) {</span>
<a href="#l5.20"></a><span id="l5.20">                     selected_events_requires_network++;</span>
<a href="#l5.21"></a><span id="l5.21">                 }</span>
<a href="#l5.22"></a><span id="l5.22" class="difflineat">@@ -542,17 +542,17 @@ var calendarController = {</span>
<a href="#l5.23"></a><span id="l5.23"> </span>
<a href="#l5.24"></a><span id="l5.24">     /**</span>
<a href="#l5.25"></a><span id="l5.25">      * Returns a boolean indicating if there are cached calendars and thus that don't require</span>
<a href="#l5.26"></a><span id="l5.26">      * network access.</span>
<a href="#l5.27"></a><span id="l5.27">      */</span>
<a href="#l5.28"></a><span id="l5.28">     get has_cached_calendars() {</span>
<a href="#l5.29"></a><span id="l5.29">         let calMgr = getCalendarManager();</span>
<a href="#l5.30"></a><span id="l5.30">         let calendars = calMgr.getCalendars({});</span>
<a href="#l5.31"></a><span id="l5.31" class="difflineminus">-        for each (let calendar in calendars) {</span>
<a href="#l5.32"></a><span id="l5.32" class="difflineplus">+        for (let calendar of calendars) {</span>
<a href="#l5.33"></a><span id="l5.33">             if (calendar.getProperty(&quot;cache.enabled&quot;) || calendar.getProperty(&quot;cache.always&quot;)) {</span>
<a href="#l5.34"></a><span id="l5.34">                 return true;</span>
<a href="#l5.35"></a><span id="l5.35">             }</span>
<a href="#l5.36"></a><span id="l5.36">         }</span>
<a href="#l5.37"></a><span id="l5.37">         return false;</span>
<a href="#l5.38"></a><span id="l5.38">     },</span>
<a href="#l5.39"></a><span id="l5.39"> </span>
<a href="#l5.40"></a><span id="l5.40">     /**</span>
<a href="#l5.41"></a><span id="l5.41" class="difflineat">@@ -565,17 +565,17 @@ var calendarController = {</span>
<a href="#l5.42"></a><span id="l5.42">     /**</span>
<a href="#l5.43"></a><span id="l5.43">      * Returns a boolean indicating that all local calendars are readonly</span>
<a href="#l5.44"></a><span id="l5.44">      */</span>
<a href="#l5.45"></a><span id="l5.45">     get all_local_calendars_readonly() {</span>
<a href="#l5.46"></a><span id="l5.46">         // We might want to speed this part up by keeping track of this in the</span>
<a href="#l5.47"></a><span id="l5.47">         // calendar manager.</span>
<a href="#l5.48"></a><span id="l5.48">         var calendars = getCalendarManager().getCalendars({});</span>
<a href="#l5.49"></a><span id="l5.49">         var count = calendars.length;</span>
<a href="#l5.50"></a><span id="l5.50" class="difflineminus">-        for each (var calendar in calendars) {</span>
<a href="#l5.51"></a><span id="l5.51" class="difflineplus">+        for (var calendar of calendars) {</span>
<a href="#l5.52"></a><span id="l5.52">             if (!isCalendarWritable(calendar)) {</span>
<a href="#l5.53"></a><span id="l5.53">                 count--;</span>
<a href="#l5.54"></a><span id="l5.54">             }</span>
<a href="#l5.55"></a><span id="l5.55">         }</span>
<a href="#l5.56"></a><span id="l5.56">         return (count == 0);</span>
<a href="#l5.57"></a><span id="l5.57">     },</span>
<a href="#l5.58"></a><span id="l5.58"> </span>
<a href="#l5.59"></a><span id="l5.59">     /**</span>
<a href="#l5.60"></a><span id="l5.60" class="difflineat">@@ -597,17 +597,17 @@ var calendarController = {</span>
<a href="#l5.61"></a><span id="l5.61">         return (selectedTasks.length &gt; 0);</span>
<a href="#l5.62"></a><span id="l5.62">     },</span>
<a href="#l5.63"></a><span id="l5.63"> </span>
<a href="#l5.64"></a><span id="l5.64"> </span>
<a href="#l5.65"></a><span id="l5.65">     get todo_items_invitation() {</span>
<a href="#l5.66"></a><span id="l5.66">         let selectedTasks = getSelectedTasks();</span>
<a href="#l5.67"></a><span id="l5.67">         let selected_tasks_invitation = 0;</span>
<a href="#l5.68"></a><span id="l5.68"> </span>
<a href="#l5.69"></a><span id="l5.69" class="difflineminus">-        for each (let item in selectedTasks) {</span>
<a href="#l5.70"></a><span id="l5.70" class="difflineplus">+        for (let item of selectedTasks) {</span>
<a href="#l5.71"></a><span id="l5.71">             if (cal.isInvitation(item)) {</span>
<a href="#l5.72"></a><span id="l5.72">                 selected_tasks_invitation++;</span>
<a href="#l5.73"></a><span id="l5.73">             } else if (item.organizer) {</span>
<a href="#l5.74"></a><span id="l5.74">                 // If we are the organizer and there are attendees, then</span>
<a href="#l5.75"></a><span id="l5.75">                 // this is likely also an invitation.</span>
<a href="#l5.76"></a><span id="l5.76">                 let calOrgId = item.calendar.getProperty(&quot;organizerId&quot;);</span>
<a href="#l5.77"></a><span id="l5.77">                 if (item.organizer.id == calOrgId &amp;&amp; item.getAttendees({}).length) {</span>
<a href="#l5.78"></a><span id="l5.78">                     selected_tasks_invitation++;</span>
<a href="#l5.79"></a><span id="l5.79" class="difflineat">@@ -619,17 +619,17 @@ var calendarController = {</span>
<a href="#l5.80"></a><span id="l5.80">     },</span>
<a href="#l5.81"></a><span id="l5.81"> </span>
<a href="#l5.82"></a><span id="l5.82">     /**</span>
<a href="#l5.83"></a><span id="l5.83">      * Returns a boolean indicating that at least one task in the selection is</span>
<a href="#l5.84"></a><span id="l5.84">      * on a calendar that is writable.</span>
<a href="#l5.85"></a><span id="l5.85">      */</span>
<a href="#l5.86"></a><span id="l5.86">     get todo_items_writable() {</span>
<a href="#l5.87"></a><span id="l5.87">         var selectedTasks = getSelectedTasks();</span>
<a href="#l5.88"></a><span id="l5.88" class="difflineminus">-        for each (var task in selectedTasks) {</span>
<a href="#l5.89"></a><span id="l5.89" class="difflineplus">+        for (var task of selectedTasks) {</span>
<a href="#l5.90"></a><span id="l5.90">             if (isCalendarWritable(task.calendar)) {</span>
<a href="#l5.91"></a><span id="l5.91">                 return true;</span>
<a href="#l5.92"></a><span id="l5.92">             }</span>
<a href="#l5.93"></a><span id="l5.93">         }</span>
<a href="#l5.94"></a><span id="l5.94">         return false;</span>
<a href="#l5.95"></a><span id="l5.95">     }</span>
<a href="#l5.96"></a><span id="l5.96"> };</span>
<a href="#l5.97"></a><span id="l5.97"> </span>
<a href="#l5.98"></a><span id="l5.98" class="difflineat">@@ -902,26 +902,26 @@ function calendarUpdateNewItemsCommand()</span>
<a href="#l5.99"></a><span id="l5.99">         taskCommands.forEach(goUpdateCommand);</span>
<a href="#l5.100"></a><span id="l5.100"> }</span>
<a href="#l5.101"></a><span id="l5.101"> </span>
<a href="#l5.102"></a><span id="l5.102"> function calendarUpdateDeleteCommand(selectedItems) {</span>
<a href="#l5.103"></a><span id="l5.103">     let oldValue = CalendarDeleteCommandEnabled;</span>
<a href="#l5.104"></a><span id="l5.104">     CalendarDeleteCommandEnabled = (selectedItems.length &gt; 0);</span>
<a href="#l5.105"></a><span id="l5.105"> </span>
<a href="#l5.106"></a><span id="l5.106">     /* we must disable &quot;delete&quot; when at least one item cannot be deleted */</span>
<a href="#l5.107"></a><span id="l5.107" class="difflineminus">-    for each (let item in selectedItems) {</span>
<a href="#l5.108"></a><span id="l5.108" class="difflineplus">+    for (let item of selectedItems) {</span>
<a href="#l5.109"></a><span id="l5.109">         if (!userCanDeleteItemsFromCalendar(item.calendar)) {</span>
<a href="#l5.110"></a><span id="l5.110">             CalendarDeleteCommandEnabled = false;</span>
<a href="#l5.111"></a><span id="l5.111">             break;</span>
<a href="#l5.112"></a><span id="l5.112">         }</span>
<a href="#l5.113"></a><span id="l5.113">     }</span>
<a href="#l5.114"></a><span id="l5.114"> </span>
<a href="#l5.115"></a><span id="l5.115">     if (CalendarDeleteCommandEnabled != oldValue) {</span>
<a href="#l5.116"></a><span id="l5.116">         let commands = [&quot;calendar_delete_event_command&quot;,</span>
<a href="#l5.117"></a><span id="l5.117">                         &quot;calendar_delete_todo_command&quot;,</span>
<a href="#l5.118"></a><span id="l5.118">                         &quot;calendar_delete_focused_item_command&quot;,</span>
<a href="#l5.119"></a><span id="l5.119">                         &quot;button_delete&quot;,</span>
<a href="#l5.120"></a><span id="l5.120">                         &quot;cmd_delete&quot;];</span>
<a href="#l5.121"></a><span id="l5.121" class="difflineminus">-        for each (let command in commands) {</span>
<a href="#l5.122"></a><span id="l5.122" class="difflineplus">+        for (let command of commands) {</span>
<a href="#l5.123"></a><span id="l5.123">             goUpdateCommand(command);</span>
<a href="#l5.124"></a><span id="l5.124">         }</span>
<a href="#l5.125"></a><span id="l5.125">     }</span>
<a href="#l5.126"></a><span id="l5.126"> }</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l6.1"></a><span id="l6.1" class="difflineminus">--- a/calendar/base/content/calendar-dnd-listener.js</span>
<a href="#l6.2"></a><span id="l6.2" class="difflineplus">+++ b/calendar/base/content/calendar-dnd-listener.js</span>
<a href="#l6.3"></a><span id="l6.3" class="difflineat">@@ -56,23 +56,23 @@ var itemConversion = {</span>
<a href="#l6.4"></a><span id="l6.4">      *</span>
<a href="#l6.5"></a><span id="l6.5">      * @param aItem     The item to copy from.</span>
<a href="#l6.6"></a><span id="l6.6">      * @param aTarget   the item to copy to.</span>
<a href="#l6.7"></a><span id="l6.7">      */</span>
<a href="#l6.8"></a><span id="l6.8">     copyItemBase: function iC_copyItemBase(aItem, aTarget) {</span>
<a href="#l6.9"></a><span id="l6.9">         const copyProps = [&quot;SUMMARY&quot;, &quot;LOCATION&quot;, &quot;DESCRIPTION&quot;,</span>
<a href="#l6.10"></a><span id="l6.10">                            &quot;URL&quot;, &quot;CLASS&quot;, &quot;PRIORITY&quot;];</span>
<a href="#l6.11"></a><span id="l6.11"> </span>
<a href="#l6.12"></a><span id="l6.12" class="difflineminus">-        for each (var prop in copyProps) {</span>
<a href="#l6.13"></a><span id="l6.13" class="difflineplus">+        for (var prop of copyProps) {</span>
<a href="#l6.14"></a><span id="l6.14">             aTarget.setProperty(prop, aItem.getProperty(prop));</span>
<a href="#l6.15"></a><span id="l6.15">         }</span>
<a href="#l6.16"></a><span id="l6.16"> </span>
<a href="#l6.17"></a><span id="l6.17">         // Attendees</span>
<a href="#l6.18"></a><span id="l6.18">         var attendees = aItem.getAttendees({});</span>
<a href="#l6.19"></a><span id="l6.19" class="difflineminus">-        for each (var attendee in attendees) {</span>
<a href="#l6.20"></a><span id="l6.20" class="difflineplus">+        for (var attendee of attendees) {</span>
<a href="#l6.21"></a><span id="l6.21">             aTarget.addAttendee(attendee.clone());</span>
<a href="#l6.22"></a><span id="l6.22">         }</span>
<a href="#l6.23"></a><span id="l6.23"> </span>
<a href="#l6.24"></a><span id="l6.24">         // Categories</span>
<a href="#l6.25"></a><span id="l6.25">         var categories = aItem.getCategories({});</span>
<a href="#l6.26"></a><span id="l6.26">         aTarget.setCategories(categories.length, categories);</span>
<a href="#l6.27"></a><span id="l6.27"> </span>
<a href="#l6.28"></a><span id="l6.28">         // Organizer</span>
<a href="#l6.29"></a><span id="l6.29" class="difflineat">@@ -102,17 +102,17 @@ var itemConversion = {</span>
<a href="#l6.30"></a><span id="l6.30"> </span>
<a href="#l6.31"></a><span id="l6.31">         // Dates and alarms</span>
<a href="#l6.32"></a><span id="l6.32">         if (!aEvent.startDate.isDate &amp;&amp; !aEvent.endDate.isDate) {</span>
<a href="#l6.33"></a><span id="l6.33">             // Dates</span>
<a href="#l6.34"></a><span id="l6.34">             item.entryDate = aEvent.startDate.clone();</span>
<a href="#l6.35"></a><span id="l6.35">             item.dueDate = aEvent.endDate.clone();</span>
<a href="#l6.36"></a><span id="l6.36"> </span>
<a href="#l6.37"></a><span id="l6.37">             // Alarms</span>
<a href="#l6.38"></a><span id="l6.38" class="difflineminus">-            for each (let alarm in aEvent.getAlarms({})) {</span>
<a href="#l6.39"></a><span id="l6.39" class="difflineplus">+            for (let alarm of aEvent.getAlarms({})) {</span>
<a href="#l6.40"></a><span id="l6.40">                 item.addAlarm(alarm.clone());</span>
<a href="#l6.41"></a><span id="l6.41">             }</span>
<a href="#l6.42"></a><span id="l6.42">             item.alarmLastAck = (aEvent.alarmLastAck ?</span>
<a href="#l6.43"></a><span id="l6.43">                                  aEvent.alarmLastAck.clone() :</span>
<a href="#l6.44"></a><span id="l6.44">                                  null);</span>
<a href="#l6.45"></a><span id="l6.45">         }</span>
<a href="#l6.46"></a><span id="l6.46"> </span>
<a href="#l6.47"></a><span id="l6.47">         // Map Status values</span>
<a href="#l6.48"></a><span id="l6.48" class="difflineat">@@ -155,17 +155,17 @@ var itemConversion = {</span>
<a href="#l6.49"></a><span id="l6.49">         if (!item.endDate) {</span>
<a href="#l6.50"></a><span id="l6.50">             // Make the event be the default event length if no due date was</span>
<a href="#l6.51"></a><span id="l6.51">             // specified.</span>
<a href="#l6.52"></a><span id="l6.52">             item.endDate = item.startDate.clone();</span>
<a href="#l6.53"></a><span id="l6.53">             item.endDate.minute += Preferences.get(&quot;calendar.event.defaultlength&quot;, 60);</span>
<a href="#l6.54"></a><span id="l6.54">         }</span>
<a href="#l6.55"></a><span id="l6.55"> </span>
<a href="#l6.56"></a><span id="l6.56">         // Alarms</span>
<a href="#l6.57"></a><span id="l6.57" class="difflineminus">-        for each (let alarm in aTask.getAlarms({})) {</span>
<a href="#l6.58"></a><span id="l6.58" class="difflineplus">+        for (let alarm of aTask.getAlarms({})) {</span>
<a href="#l6.59"></a><span id="l6.59">             item.addAlarm(alarm.clone());</span>
<a href="#l6.60"></a><span id="l6.60">         }</span>
<a href="#l6.61"></a><span id="l6.61">         item.alarmLastAck = (aTask.alarmLastAck ?</span>
<a href="#l6.62"></a><span id="l6.62">                              aTask.alarmLastAck.clone() :</span>
<a href="#l6.63"></a><span id="l6.63">                              null);</span>
<a href="#l6.64"></a><span id="l6.64"> </span>
<a href="#l6.65"></a><span id="l6.65">         // Map Status values</span>
<a href="#l6.66"></a><span id="l6.66">         let statusMap = {</span>
<a href="#l6.67"></a><span id="l6.67" class="difflineat">@@ -377,17 +377,17 @@ calViewDNDObserver.prototype = {</span>
<a href="#l6.68"></a><span id="l6.68">      * Gets called in case we're dropping an array of items</span>
<a href="#l6.69"></a><span id="l6.69">      * on one of the calendar views. In this case we just</span>
<a href="#l6.70"></a><span id="l6.70">      * try to add these items to the currently selected calendar.</span>
<a href="#l6.71"></a><span id="l6.71">      */</span>
<a href="#l6.72"></a><span id="l6.72">     onDropItems: function(aItems) {</span>
<a href="#l6.73"></a><span id="l6.73">         var destCal = getSelectedCalendar();</span>
<a href="#l6.74"></a><span id="l6.74">         startBatchTransaction();</span>
<a href="#l6.75"></a><span id="l6.75">         try {</span>
<a href="#l6.76"></a><span id="l6.76" class="difflineminus">-            for each (var item in aItems) {</span>
<a href="#l6.77"></a><span id="l6.77" class="difflineplus">+            for (var item of aItems) {</span>
<a href="#l6.78"></a><span id="l6.78">                 doTransaction('add', item, destCal, null, null);</span>
<a href="#l6.79"></a><span id="l6.79">             }</span>
<a href="#l6.80"></a><span id="l6.80">         }</span>
<a href="#l6.81"></a><span id="l6.81">         finally {</span>
<a href="#l6.82"></a><span id="l6.82">             endBatchTransaction();</span>
<a href="#l6.83"></a><span id="l6.83">         }</span>
<a href="#l6.84"></a><span id="l6.84">     }</span>
<a href="#l6.85"></a><span id="l6.85"> };</span>
<a href="#l6.86"></a><span id="l6.86" class="difflineat">@@ -453,17 +453,17 @@ calCalendarButtonDNDObserver.prototype =</span>
<a href="#l6.87"></a><span id="l6.87">      * calCalendarButtonDNDObserver::onDropItems</span>
<a href="#l6.88"></a><span id="l6.88">      *</span>
<a href="#l6.89"></a><span id="l6.89">      * Gets called in case we're dropping an array of items</span>
<a href="#l6.90"></a><span id="l6.90">      * on the 'calendar mode'-button.</span>
<a href="#l6.91"></a><span id="l6.91">      *</span>
<a href="#l6.92"></a><span id="l6.92">      * @param aItems        An array of items to handle.</span>
<a href="#l6.93"></a><span id="l6.93">      */</span>
<a href="#l6.94"></a><span id="l6.94">     onDropItems: function(aItems) {</span>
<a href="#l6.95"></a><span id="l6.95" class="difflineminus">-        for each (var item in aItems) {</span>
<a href="#l6.96"></a><span id="l6.96" class="difflineplus">+        for (var item of aItems) {</span>
<a href="#l6.97"></a><span id="l6.97">             var newItem = item;</span>
<a href="#l6.98"></a><span id="l6.98">             if (isToDo(item)) {</span>
<a href="#l6.99"></a><span id="l6.99">                 newItem = itemConversion.eventFromTask(item);</span>
<a href="#l6.100"></a><span id="l6.100">             }</span>
<a href="#l6.101"></a><span id="l6.101">             createEventWithDialog(null, null, null, null, newItem);</span>
<a href="#l6.102"></a><span id="l6.102">         }</span>
<a href="#l6.103"></a><span id="l6.103">     },</span>
<a href="#l6.104"></a><span id="l6.104"> </span>
<a href="#l6.105"></a><span id="l6.105" class="difflineat">@@ -502,17 +502,17 @@ calTaskButtonDNDObserver.prototype = {</span>
<a href="#l6.106"></a><span id="l6.106">      * calTaskButtonDNDObserver::onDropItems</span>
<a href="#l6.107"></a><span id="l6.107">      *</span>
<a href="#l6.108"></a><span id="l6.108">      * Gets called in case we're dropping an array of items</span>
<a href="#l6.109"></a><span id="l6.109">      * on the 'task mode'-button.</span>
<a href="#l6.110"></a><span id="l6.110">      *</span>
<a href="#l6.111"></a><span id="l6.111">      * @param aItems        An array of items to handle.</span>
<a href="#l6.112"></a><span id="l6.112">      */</span>
<a href="#l6.113"></a><span id="l6.113">     onDropItems: function(aItems) {</span>
<a href="#l6.114"></a><span id="l6.114" class="difflineminus">-        for each (var item in aItems) {</span>
<a href="#l6.115"></a><span id="l6.115" class="difflineplus">+        for (var item of aItems) {</span>
<a href="#l6.116"></a><span id="l6.116">             var newItem = item;</span>
<a href="#l6.117"></a><span id="l6.117">             if (isEvent(item)) {</span>
<a href="#l6.118"></a><span id="l6.118">                 newItem = itemConversion.taskFromEvent(item);</span>
<a href="#l6.119"></a><span id="l6.119">             }</span>
<a href="#l6.120"></a><span id="l6.120">             createTodoWithDialog(null, null, null, newItem);</span>
<a href="#l6.121"></a><span id="l6.121">         }</span>
<a href="#l6.122"></a><span id="l6.122">     },</span>
<a href="#l6.123"></a><span id="l6.123"> </span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l7.1"></a><span id="l7.1" class="difflineminus">--- a/calendar/base/content/calendar-invitations-manager.js</span>
<a href="#l7.2"></a><span id="l7.2" class="difflineplus">+++ b/calendar/base/content/calendar-invitations-manager.js</span>
<a href="#l7.3"></a><span id="l7.3" class="difflineat">@@ -24,17 +24,18 @@ var gInvitationsRequestManager = {</span>
<a href="#l7.4"></a><span id="l7.4">             this.mRequestStatusList[calendar.id] = op;</span>
<a href="#l7.5"></a><span id="l7.5">         }</span>
<a href="#l7.6"></a><span id="l7.6">     },</span>
<a href="#l7.7"></a><span id="l7.7"> </span>
<a href="#l7.8"></a><span id="l7.8">     /**</span>
<a href="#l7.9"></a><span id="l7.9">      * Cancel all pending requests</span>
<a href="#l7.10"></a><span id="l7.10">      */</span>
<a href="#l7.11"></a><span id="l7.11">     cancelPendingRequests: function IRM_cancelPendingRequests() {</span>
<a href="#l7.12"></a><span id="l7.12" class="difflineminus">-        for each (var request in this.mRequestStatusList) {</span>
<a href="#l7.13"></a><span id="l7.13" class="difflineplus">+        for (var id in this.mRequestStatusList) {</span>
<a href="#l7.14"></a><span id="l7.14" class="difflineplus">+            let request = this.mRequestStatusList[id];</span>
<a href="#l7.15"></a><span id="l7.15">             if (request &amp;&amp; request.isPending) {</span>
<a href="#l7.16"></a><span id="l7.16">                 request.cancel(null);</span>
<a href="#l7.17"></a><span id="l7.17">             }</span>
<a href="#l7.18"></a><span id="l7.18">         }</span>
<a href="#l7.19"></a><span id="l7.19">         this.mRequestStatusList = {};</span>
<a href="#l7.20"></a><span id="l7.20">     }</span>
<a href="#l7.21"></a><span id="l7.21"> };</span>
<a href="#l7.22"></a><span id="l7.22"> </span>
<a href="#l7.23"></a><span id="l7.23" class="difflineat">@@ -143,17 +144,17 @@ InvitationsManager.prototype = {</span>
<a href="#l7.24"></a><span id="l7.24">                                           aOperationType,</span>
<a href="#l7.25"></a><span id="l7.25">                                           aId,</span>
<a href="#l7.26"></a><span id="l7.26">                                           aDetail) {</span>
<a href="#l7.27"></a><span id="l7.27">                 if (--this.mCount == 0) {</span>
<a href="#l7.28"></a><span id="l7.28">                     this.mInvitationsManager.mItemList.sort(</span>
<a href="#l7.29"></a><span id="l7.29">                         function (a, b) {</span>
<a href="#l7.30"></a><span id="l7.30">                             return a.startDate.compare(b.startDate);</span>
<a href="#l7.31"></a><span id="l7.31">                         });</span>
<a href="#l7.32"></a><span id="l7.32" class="difflineminus">-                    for each (var listener in listeners) {</span>
<a href="#l7.33"></a><span id="l7.33" class="difflineplus">+                    for (var listener of listeners) {</span>
<a href="#l7.34"></a><span id="l7.34">                         try {</span>
<a href="#l7.35"></a><span id="l7.35">                             if (this.mInvitationsManager.mItemList.length) {</span>
<a href="#l7.36"></a><span id="l7.36">                                 // Only call if there are actually items</span>
<a href="#l7.37"></a><span id="l7.37">                                 listener.onGetResult(null,</span>
<a href="#l7.38"></a><span id="l7.38">                                                      Components.results.NS_OK,</span>
<a href="#l7.39"></a><span id="l7.39">                                                      Components.interfaces.calIItemBase,</span>
<a href="#l7.40"></a><span id="l7.40">                                                      null,</span>
<a href="#l7.41"></a><span id="l7.41">                                                      this.mInvitationsManager.mItemList.length,</span>
<a href="#l7.42"></a><span id="l7.42" class="difflineat">@@ -173,31 +174,31 @@ InvitationsManager.prototype = {</span>
<a href="#l7.43"></a><span id="l7.43"> </span>
<a href="#l7.44"></a><span id="l7.44">             onGetResult: function(aCalendar,</span>
<a href="#l7.45"></a><span id="l7.45">                                   aStatus,</span>
<a href="#l7.46"></a><span id="l7.46">                                   aItemType,</span>
<a href="#l7.47"></a><span id="l7.47">                                   aDetail,</span>
<a href="#l7.48"></a><span id="l7.48">                                   aCount,</span>
<a href="#l7.49"></a><span id="l7.49">                                   aItems) {</span>
<a href="#l7.50"></a><span id="l7.50">                 if (Components.isSuccessCode(aStatus)) {</span>
<a href="#l7.51"></a><span id="l7.51" class="difflineminus">-                    for each (var item in aItems) {</span>
<a href="#l7.52"></a><span id="l7.52" class="difflineplus">+                    for (var item of aItems) {</span>
<a href="#l7.53"></a><span id="l7.53">                         // we need to retrieve by occurrence to properly filter exceptions,</span>
<a href="#l7.54"></a><span id="l7.54">                         // should be fixed with bug 416975</span>
<a href="#l7.55"></a><span id="l7.55">                         item = item.parentItem;</span>
<a href="#l7.56"></a><span id="l7.56">                         var hid = item.hashId;</span>
<a href="#l7.57"></a><span id="l7.57">                         if (!this.mHandledItems[hid]) {</span>
<a href="#l7.58"></a><span id="l7.58">                             this.mHandledItems[hid] = true;</span>
<a href="#l7.59"></a><span id="l7.59">                             this.mInvitationsManager.addItem(item);</span>
<a href="#l7.60"></a><span id="l7.60">                         }</span>
<a href="#l7.61"></a><span id="l7.61">                     }</span>
<a href="#l7.62"></a><span id="l7.62">                 }</span>
<a href="#l7.63"></a><span id="l7.63">             }</span>
<a href="#l7.64"></a><span id="l7.64">         };</span>
<a href="#l7.65"></a><span id="l7.65"> </span>
<a href="#l7.66"></a><span id="l7.66" class="difflineminus">-        for each (var calendar in cals) {</span>
<a href="#l7.67"></a><span id="l7.67" class="difflineplus">+        for (var calendar of cals) {</span>
<a href="#l7.68"></a><span id="l7.68">             if (!isCalendarWritable(calendar) || calendar.getProperty(&quot;disabled&quot;)) {</span>
<a href="#l7.69"></a><span id="l7.69">                 opListener.onOperationComplete();</span>
<a href="#l7.70"></a><span id="l7.70">                 continue;</span>
<a href="#l7.71"></a><span id="l7.71">             }</span>
<a href="#l7.72"></a><span id="l7.72"> </span>
<a href="#l7.73"></a><span id="l7.73">             // temporary hack unless calCachedCalendar supports REQUEST_NEEDS_ACTION filter:</span>
<a href="#l7.74"></a><span id="l7.74">             calendar = calendar.getProperty(&quot;cache.uncachedCalendar&quot;);</span>
<a href="#l7.75"></a><span id="l7.75">             if (!calendar) {</span>
<a href="#l7.76"></a><span id="l7.76" class="difflineat">@@ -344,17 +345,17 @@ InvitationsManager.prototype = {</span>
<a href="#l7.77"></a><span id="l7.77">      *</span>
<a href="#l7.78"></a><span id="l7.78">      * @param item      The item to add.</span>
<a href="#l7.79"></a><span id="l7.79">      */</span>
<a href="#l7.80"></a><span id="l7.80">     addItem: function IM_addItem(item) {</span>
<a href="#l7.81"></a><span id="l7.81">         var recInfo = item.recurrenceInfo;</span>
<a href="#l7.82"></a><span id="l7.82">         if (recInfo &amp;&amp; !cal.isOpenInvitation(item)) {</span>
<a href="#l7.83"></a><span id="l7.83">             // scan exceptions:</span>
<a href="#l7.84"></a><span id="l7.84">             var ids = recInfo.getExceptionIds({});</span>
<a href="#l7.85"></a><span id="l7.85" class="difflineminus">-            for each (var id in ids) {</span>
<a href="#l7.86"></a><span id="l7.86" class="difflineplus">+            for (var id of ids) {</span>
<a href="#l7.87"></a><span id="l7.87">                 var ex = recInfo.getExceptionFor(id);</span>
<a href="#l7.88"></a><span id="l7.88">                 if (ex &amp;&amp; this.validateItem(ex) &amp;&amp; !this.hasItem(ex)) {</span>
<a href="#l7.89"></a><span id="l7.89">                     this.mItemList.push(ex);</span>
<a href="#l7.90"></a><span id="l7.90">                 }</span>
<a href="#l7.91"></a><span id="l7.91">             }</span>
<a href="#l7.92"></a><span id="l7.92">         } else if (this.validateItem(item) &amp;&amp; !this.hasItem(item)) {</span>
<a href="#l7.93"></a><span id="l7.93">             this.mItemList.push(item);</span>
<a href="#l7.94"></a><span id="l7.94">         }</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l8.1"></a><span id="l8.1" class="difflineminus">--- a/calendar/base/content/calendar-item-editing.js</span>
<a href="#l8.2"></a><span id="l8.2" class="difflineplus">+++ b/calendar/base/content/calendar-item-editing.js</span>
<a href="#l8.3"></a><span id="l8.3" class="difflineat">@@ -667,17 +667,17 @@ function canRedo() {</span>
<a href="#l8.4"></a><span id="l8.4"> function updateUndoRedoMenu() {</span>
<a href="#l8.5"></a><span id="l8.5">     goUpdateCommand(&quot;cmd_undo&quot;);</span>
<a href="#l8.6"></a><span id="l8.6">     goUpdateCommand(&quot;cmd_redo&quot;);</span>
<a href="#l8.7"></a><span id="l8.7"> }</span>
<a href="#l8.8"></a><span id="l8.8"> </span>
<a href="#l8.9"></a><span id="l8.9"> function setContextPartstat(value, scope, items) {</span>
<a href="#l8.10"></a><span id="l8.10">     startBatchTransaction();</span>
<a href="#l8.11"></a><span id="l8.11">     try {</span>
<a href="#l8.12"></a><span id="l8.12" class="difflineminus">-        for each (let oldItem in items) {</span>
<a href="#l8.13"></a><span id="l8.13" class="difflineplus">+        for (let oldItem of items) {</span>
<a href="#l8.14"></a><span id="l8.14">             // Skip this item if its calendar is read only.</span>
<a href="#l8.15"></a><span id="l8.15">             if (oldItem.calendar.readOnly) {</span>
<a href="#l8.16"></a><span id="l8.16">                 continue;</span>
<a href="#l8.17"></a><span id="l8.17">             }</span>
<a href="#l8.18"></a><span id="l8.18">             if (scope == &quot;all-occurrences&quot;) {</span>
<a href="#l8.19"></a><span id="l8.19">                 oldItem = oldItem.parentItem;</span>
<a href="#l8.20"></a><span id="l8.20">             }</span>
<a href="#l8.21"></a><span id="l8.21">             let attendee = null;</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l9.1"></a><span id="l9.1" class="difflineminus">--- a/calendar/base/content/calendar-month-view.xml</span>
<a href="#l9.2"></a><span id="l9.2" class="difflineplus">+++ b/calendar/base/content/calendar-month-view.xml</span>
<a href="#l9.3"></a><span id="l9.3" class="difflineat">@@ -548,30 +548,30 @@</span>
<a href="#l9.4"></a><span id="l9.4">       &lt;/method&gt;</span>
<a href="#l9.5"></a><span id="l9.5"> </span>
<a href="#l9.6"></a><span id="l9.6">       &lt;method name=&quot;setSelectedItems&quot;&gt;</span>
<a href="#l9.7"></a><span id="l9.7">         &lt;parameter name=&quot;aCount&quot;/&gt;</span>
<a href="#l9.8"></a><span id="l9.8">         &lt;parameter name=&quot;aItems&quot;/&gt;</span>
<a href="#l9.9"></a><span id="l9.9">         &lt;parameter name=&quot;aSuppressEvent&quot;/&gt;</span>
<a href="#l9.10"></a><span id="l9.10">         &lt;body&gt;&lt;![CDATA[</span>
<a href="#l9.11"></a><span id="l9.11">           if (this.mSelectedItems.length) {</span>
<a href="#l9.12"></a><span id="l9.12" class="difflineminus">-              for each (var item in this.mSelectedItems) {</span>
<a href="#l9.13"></a><span id="l9.13" class="difflineplus">+              for (var item of this.mSelectedItems) {</span>
<a href="#l9.14"></a><span id="l9.14">                   let oldboxes = this.findDayBoxesForItem(item);</span>
<a href="#l9.15"></a><span id="l9.15" class="difflineminus">-                  for each (let oldbox in oldboxes) {</span>
<a href="#l9.16"></a><span id="l9.16" class="difflineplus">+                  for (let oldbox of oldboxes) {</span>
<a href="#l9.17"></a><span id="l9.17">                       oldbox.unselectItem(item);</span>
<a href="#l9.18"></a><span id="l9.18">                   }</span>
<a href="#l9.19"></a><span id="l9.19">               }</span>
<a href="#l9.20"></a><span id="l9.20">           }</span>
<a href="#l9.21"></a><span id="l9.21"> </span>
<a href="#l9.22"></a><span id="l9.22">           this.mSelectedItems = aItems || [];</span>
<a href="#l9.23"></a><span id="l9.23"> </span>
<a href="#l9.24"></a><span id="l9.24">           if (this.mSelectedItems.length) {</span>
<a href="#l9.25"></a><span id="l9.25" class="difflineminus">-              for each (var item in this.mSelectedItems) {</span>
<a href="#l9.26"></a><span id="l9.26" class="difflineplus">+              for (var item of this.mSelectedItems) {</span>
<a href="#l9.27"></a><span id="l9.27">                   let newboxes = this.findDayBoxesForItem(item);</span>
<a href="#l9.28"></a><span id="l9.28" class="difflineminus">-                  for each (let newbox in newboxes) {</span>
<a href="#l9.29"></a><span id="l9.29" class="difflineplus">+                  for (let newbox of newboxes) {</span>
<a href="#l9.30"></a><span id="l9.30">                       newbox.selectItem(item);</span>
<a href="#l9.31"></a><span id="l9.31">                   }</span>
<a href="#l9.32"></a><span id="l9.32">               }</span>
<a href="#l9.33"></a><span id="l9.33">           }</span>
<a href="#l9.34"></a><span id="l9.34"> </span>
<a href="#l9.35"></a><span id="l9.35">           if (!aSuppressEvent) {</span>
<a href="#l9.36"></a><span id="l9.36">               this.fireEvent(&quot;itemselect&quot;, this.mSelectedItems);</span>
<a href="#l9.37"></a><span id="l9.37">           }</span>
<a href="#l9.38"></a><span id="l9.38" class="difflineat">@@ -933,17 +933,20 @@</span>
<a href="#l9.39"></a><span id="l9.39">             headerkids[i].collapsed = dayOff &amp;&amp; !this.mDisplayDaysOff;</span>
<a href="#l9.40"></a><span id="l9.40">           }</span>
<a href="#l9.41"></a><span id="l9.41">         ]]&gt;&lt;/body&gt;</span>
<a href="#l9.42"></a><span id="l9.42">       &lt;/method&gt;</span>
<a href="#l9.43"></a><span id="l9.43"> </span>
<a href="#l9.44"></a><span id="l9.44">       &lt;method name=&quot;findDayBoxForDate&quot;&gt;</span>
<a href="#l9.45"></a><span id="l9.45">         &lt;parameter name=&quot;aDate&quot;/&gt;</span>
<a href="#l9.46"></a><span id="l9.46">         &lt;body&gt;&lt;![CDATA[</span>
<a href="#l9.47"></a><span id="l9.47" class="difflineminus">-          for each (let box in this.mDateBoxes) {</span>
<a href="#l9.48"></a><span id="l9.48" class="difflineplus">+          if (!this.mDateBoxes) {</span>
<a href="#l9.49"></a><span id="l9.49" class="difflineplus">+            return null;</span>
<a href="#l9.50"></a><span id="l9.50" class="difflineplus">+          }</span>
<a href="#l9.51"></a><span id="l9.51" class="difflineplus">+          for (let box of this.mDateBoxes) {</span>
<a href="#l9.52"></a><span id="l9.52">             if (box.mDate.compare(aDate) == 0)</span>
<a href="#l9.53"></a><span id="l9.53">               return box;</span>
<a href="#l9.54"></a><span id="l9.54">           }</span>
<a href="#l9.55"></a><span id="l9.55">           return null;</span>
<a href="#l9.56"></a><span id="l9.56">         ]]&gt;&lt;/body&gt;</span>
<a href="#l9.57"></a><span id="l9.57">       &lt;/method&gt;</span>
<a href="#l9.58"></a><span id="l9.58"> </span>
<a href="#l9.59"></a><span id="l9.59">       &lt;method name=&quot;findDayBoxesForItem&quot;&gt;</span>
<a href="#l9.60"></a><span id="l9.60" class="difflineat">@@ -1009,17 +1012,17 @@</span>
<a href="#l9.61"></a><span id="l9.61">       &lt;method name=&quot;doAddItem&quot;&gt;</span>
<a href="#l9.62"></a><span id="l9.62">         &lt;parameter name=&quot;aItem&quot;/&gt;</span>
<a href="#l9.63"></a><span id="l9.63">         &lt;body&gt;&lt;![CDATA[</span>
<a href="#l9.64"></a><span id="l9.64">           let boxes = this.findDayBoxesForItem(aItem);</span>
<a href="#l9.65"></a><span id="l9.65"> </span>
<a href="#l9.66"></a><span id="l9.66">           if (!boxes.length)</span>
<a href="#l9.67"></a><span id="l9.67">             return;</span>
<a href="#l9.68"></a><span id="l9.68"> </span>
<a href="#l9.69"></a><span id="l9.69" class="difflineminus">-          for each (let box in boxes) {</span>
<a href="#l9.70"></a><span id="l9.70" class="difflineplus">+          for (let box of boxes) {</span>
<a href="#l9.71"></a><span id="l9.71">             box.addItem(aItem);</span>
<a href="#l9.72"></a><span id="l9.72">           }</span>
<a href="#l9.73"></a><span id="l9.73">         ]]&gt;&lt;/body&gt;</span>
<a href="#l9.74"></a><span id="l9.74">       &lt;/method&gt;</span>
<a href="#l9.75"></a><span id="l9.75"> </span>
<a href="#l9.76"></a><span id="l9.76">       &lt;method name=&quot;doDeleteItem&quot;&gt;</span>
<a href="#l9.77"></a><span id="l9.77">         &lt;parameter name=&quot;aItem&quot;/&gt;</span>
<a href="#l9.78"></a><span id="l9.78">         &lt;body&gt;&lt;![CDATA[</span>
<a href="#l9.79"></a><span id="l9.79" class="difflineat">@@ -1029,33 +1032,37 @@</span>
<a href="#l9.80"></a><span id="l9.80">             return;</span>
<a href="#l9.81"></a><span id="l9.81"> </span>
<a href="#l9.82"></a><span id="l9.82">           function isNotItem(a) {</span>
<a href="#l9.83"></a><span id="l9.83">               return (a.hashId != aItem.hashId);</span>
<a href="#l9.84"></a><span id="l9.84">           }</span>
<a href="#l9.85"></a><span id="l9.85">           var oldLength = this.mSelectedItems.length;</span>
<a href="#l9.86"></a><span id="l9.86">           this.mSelectedItems = this.mSelectedItems.filter(isNotItem);</span>
<a href="#l9.87"></a><span id="l9.87"> </span>
<a href="#l9.88"></a><span id="l9.88" class="difflineminus">-          for each (let box in boxes) {</span>
<a href="#l9.89"></a><span id="l9.89" class="difflineplus">+          for (let box of boxes) {</span>
<a href="#l9.90"></a><span id="l9.90">             box.deleteItem(aItem);</span>
<a href="#l9.91"></a><span id="l9.91">           }</span>
<a href="#l9.92"></a><span id="l9.92"> </span>
<a href="#l9.93"></a><span id="l9.93">           // If a deleted event was selected, we need to announce that the</span>
<a href="#l9.94"></a><span id="l9.94">           // selection changed.</span>
<a href="#l9.95"></a><span id="l9.95">           if (oldLength != this.mSelectedItems.length) {</span>
<a href="#l9.96"></a><span id="l9.96">               this.fireEvent(&quot;itemselect&quot;, this.mSelectedItems);</span>
<a href="#l9.97"></a><span id="l9.97">           }</span>
<a href="#l9.98"></a><span id="l9.98">         ]]&gt;&lt;/body&gt;</span>
<a href="#l9.99"></a><span id="l9.99">       &lt;/method&gt;</span>
<a href="#l9.100"></a><span id="l9.100"> </span>
<a href="#l9.101"></a><span id="l9.101">       &lt;method name=&quot;deleteItemsFromCalendar&quot;&gt;</span>
<a href="#l9.102"></a><span id="l9.102">         &lt;parameter name=&quot;aCalendar&quot;/&gt;</span>
<a href="#l9.103"></a><span id="l9.103">         &lt;body&gt;&lt;![CDATA[</span>
<a href="#l9.104"></a><span id="l9.104" class="difflineminus">-          for each (let box in this.mDateBoxes) {</span>
<a href="#l9.105"></a><span id="l9.105" class="difflineminus">-            for each (let node in box.mItemHash) {</span>
<a href="#l9.106"></a><span id="l9.106" class="difflineplus">+          if (!this.mDateBoxes) {</span>
<a href="#l9.107"></a><span id="l9.107" class="difflineplus">+            return;</span>
<a href="#l9.108"></a><span id="l9.108" class="difflineplus">+          }</span>
<a href="#l9.109"></a><span id="l9.109" class="difflineplus">+          for (let box of this.mDateBoxes) {</span>
<a href="#l9.110"></a><span id="l9.110" class="difflineplus">+            for (let id in box.mItemHash) {</span>
<a href="#l9.111"></a><span id="l9.111" class="difflineplus">+              let node = box.mItemHash[id];</span>
<a href="#l9.112"></a><span id="l9.112">               let item = node.item;</span>
<a href="#l9.113"></a><span id="l9.113">               if (item.calendar.id == aCalendar.id) {</span>
<a href="#l9.114"></a><span id="l9.114">                 box.deleteItem(item);</span>
<a href="#l9.115"></a><span id="l9.115">               }</span>
<a href="#l9.116"></a><span id="l9.116">             }</span>
<a href="#l9.117"></a><span id="l9.117">           }</span>
<a href="#l9.118"></a><span id="l9.118">         ]]&gt;&lt;/body&gt;</span>
<a href="#l9.119"></a><span id="l9.119">       &lt;/method&gt;</span>
<a href="#l9.120"></a><span id="l9.120" class="difflineat">@@ -1070,18 +1077,19 @@</span>
<a href="#l9.121"></a><span id="l9.121">           if (!aStop &amp;&amp; (!showIndicator || totaltime &lt; 1)) {</span>
<a href="#l9.122"></a><span id="l9.122">             // No need to animate if the indicator should not be shown.</span>
<a href="#l9.123"></a><span id="l9.123">             return;</span>
<a href="#l9.124"></a><span id="l9.124">           }</span>
<a href="#l9.125"></a><span id="l9.125"> </span>
<a href="#l9.126"></a><span id="l9.126">           // Make sure the flashing attribute is set or reset on all visible</span>
<a href="#l9.127"></a><span id="l9.127">           // boxes.</span>
<a href="#l9.128"></a><span id="l9.128">           let boxes = this.findDayBoxesForItem(aAlarmItem);</span>
<a href="#l9.129"></a><span id="l9.129" class="difflineminus">-          for each (var box in boxes) {</span>
<a href="#l9.130"></a><span id="l9.130" class="difflineminus">-            for each (var itemData in box.mItemHash) {</span>
<a href="#l9.131"></a><span id="l9.131" class="difflineplus">+          for (var box of boxes) {</span>
<a href="#l9.132"></a><span id="l9.132" class="difflineplus">+            for (var id in box.mItemHash) {</span>
<a href="#l9.133"></a><span id="l9.133" class="difflineplus">+              let itemData = box.mItemHash[id];</span>
<a href="#l9.134"></a><span id="l9.134">               if (itemData.item.hasSameIds(aAlarmItem)) {</span>
<a href="#l9.135"></a><span id="l9.135">                 if (aStop) {</span>
<a href="#l9.136"></a><span id="l9.136">                   itemData.removeAttribute(&quot;flashing&quot;);</span>
<a href="#l9.137"></a><span id="l9.137">                 } else {</span>
<a href="#l9.138"></a><span id="l9.138">                   itemData.setAttribute(&quot;flashing&quot;, &quot;true&quot;);</span>
<a href="#l9.139"></a><span id="l9.139">                 }</span>
<a href="#l9.140"></a><span id="l9.140">               }</span>
<a href="#l9.141"></a><span id="l9.141">             }</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l10.1"></a><span id="l10.1" class="difflineminus">--- a/calendar/base/content/calendar-multiday-view.xml</span>
<a href="#l10.2"></a><span id="l10.2" class="difflineplus">+++ b/calendar/base/content/calendar-multiday-view.xml</span>
<a href="#l10.3"></a><span id="l10.3" class="difflineat">@@ -438,17 +438,17 @@</span>
<a href="#l10.4"></a><span id="l10.4">               this.mSelectedChunks.splice(index, 1);</span>
<a href="#l10.5"></a><span id="l10.5">           }</span>
<a href="#l10.6"></a><span id="l10.6">         ]]&gt;&lt;/body&gt;</span>
<a href="#l10.7"></a><span id="l10.7">       &lt;/method&gt;</span>
<a href="#l10.8"></a><span id="l10.8"> </span>
<a href="#l10.9"></a><span id="l10.9">       &lt;method name=&quot;findChunkForOccurrence&quot;&gt;</span>
<a href="#l10.10"></a><span id="l10.10">         &lt;parameter name=&quot;aOccurrence&quot;/&gt;</span>
<a href="#l10.11"></a><span id="l10.11">         &lt;body&gt;&lt;![CDATA[</span>
<a href="#l10.12"></a><span id="l10.12" class="difflineminus">-          for each (var chunk in this.mEventBoxes) {</span>
<a href="#l10.13"></a><span id="l10.13" class="difflineplus">+          for (var chunk of this.mEventBoxes) {</span>
<a href="#l10.14"></a><span id="l10.14">               if (chunk.occurrence.hashId == aOccurrence.hashId) {</span>
<a href="#l10.15"></a><span id="l10.15">                   return chunk;</span>
<a href="#l10.16"></a><span id="l10.16">               }</span>
<a href="#l10.17"></a><span id="l10.17">           }</span>
<a href="#l10.18"></a><span id="l10.18"> </span>
<a href="#l10.19"></a><span id="l10.19">           return null;</span>
<a href="#l10.20"></a><span id="l10.20">         ]]&gt;&lt;/body&gt;</span>
<a href="#l10.21"></a><span id="l10.21">       &lt;/method&gt;</span>
<a href="#l10.22"></a><span id="l10.22" class="difflineat">@@ -504,17 +504,17 @@</span>
<a href="#l10.23"></a><span id="l10.23">            } else {</span>
<a href="#l10.24"></a><span id="l10.24">                return false;</span>
<a href="#l10.25"></a><span id="l10.25">            }</span>
<a href="#l10.26"></a><span id="l10.26">         ]]&gt;&lt;/body&gt;</span>
<a href="#l10.27"></a><span id="l10.27">       &lt;/method&gt;</span>
<a href="#l10.28"></a><span id="l10.28"> </span>
<a href="#l10.29"></a><span id="l10.29">       &lt;method name=&quot;recalculateStartEndMinutes&quot;&gt;</span>
<a href="#l10.30"></a><span id="l10.30">         &lt;body&gt;&lt;![CDATA[</span>
<a href="#l10.31"></a><span id="l10.31" class="difflineminus">-          for each (var chunk in this.mEventInfos) {</span>
<a href="#l10.32"></a><span id="l10.32" class="difflineplus">+          for (var chunk of this.mEventInfos) {</span>
<a href="#l10.33"></a><span id="l10.33">               var mins = this.getStartEndMinutesForOccurrence(chunk.event);</span>
<a href="#l10.34"></a><span id="l10.34">               chunk.startMinute = mins.start;</span>
<a href="#l10.35"></a><span id="l10.35">               chunk.endMinute = mins.end;</span>
<a href="#l10.36"></a><span id="l10.36">           }</span>
<a href="#l10.37"></a><span id="l10.37"> </span>
<a href="#l10.38"></a><span id="l10.38">           this.relayout();</span>
<a href="#l10.39"></a><span id="l10.39">         ]]&gt;&lt;/body&gt;</span>
<a href="#l10.40"></a><span id="l10.40">       &lt;/method&gt;</span>
<a href="#l10.41"></a><span id="l10.41" class="difflineat">@@ -615,17 +615,17 @@</span>
<a href="#l10.42"></a><span id="l10.42">       &lt;method name=&quot;clear&quot;&gt;</span>
<a href="#l10.43"></a><span id="l10.43">         &lt;body&gt;&lt;![CDATA[</span>
<a href="#l10.44"></a><span id="l10.44">           while (this.bgbox &amp;&amp; this.bgbox.hasChildNodes()) {</span>
<a href="#l10.45"></a><span id="l10.45">               this.bgbox.lastChild.remove();</span>
<a href="#l10.46"></a><span id="l10.46">           }</span>
<a href="#l10.47"></a><span id="l10.47">           while (this.topbox &amp;&amp; this.topbox.hasChildNodes()) {</span>
<a href="#l10.48"></a><span id="l10.48">               this.topbox.lastChild.remove();</span>
<a href="#l10.49"></a><span id="l10.49">           }</span>
<a href="#l10.50"></a><span id="l10.50" class="difflineminus">-          for each (let handler in this.mHandlersToRemove) {</span>
<a href="#l10.51"></a><span id="l10.51" class="difflineplus">+          for (let handler of this.mHandlersToRemove) {</span>
<a href="#l10.52"></a><span id="l10.52">               this.calendarView.viewBroadcaster.removeEventListener(this.calendarView.getAttribute(&quot;type&quot;) + &quot;viewresized&quot;, handler, true);</span>
<a href="#l10.53"></a><span id="l10.53">           }</span>
<a href="#l10.54"></a><span id="l10.54">           this.mHandlersToRemove = [];</span>
<a href="#l10.55"></a><span id="l10.55">           this.mSelectedChunks = [];</span>
<a href="#l10.56"></a><span id="l10.56">         ]]&gt;&lt;/body&gt;</span>
<a href="#l10.57"></a><span id="l10.57">       &lt;/method&gt;</span>
<a href="#l10.58"></a><span id="l10.58"> </span>
<a href="#l10.59"></a><span id="l10.59">       &lt;method name=&quot;relayout&quot;&gt;</span>
<a href="#l10.60"></a><span id="l10.60" class="difflineat">@@ -711,17 +711,17 @@</span>
<a href="#l10.61"></a><span id="l10.61">           let stack = createXULElement(&quot;stack&quot;);</span>
<a href="#l10.62"></a><span id="l10.62">           stack.setAttribute(&quot;flex&quot;, &quot;1&quot;);</span>
<a href="#l10.63"></a><span id="l10.63">           this.topbox.appendChild(stack);</span>
<a href="#l10.64"></a><span id="l10.64"> </span>
<a href="#l10.65"></a><span id="l10.65">           let boxToEdit;</span>
<a href="#l10.66"></a><span id="l10.66">           let columnCount = 1;</span>
<a href="#l10.67"></a><span id="l10.67">           let spanTotal = 0;</span>
<a href="#l10.68"></a><span id="l10.68"> </span>
<a href="#l10.69"></a><span id="l10.69" class="difflineminus">-          for each (let layer in this.mEventMap) {</span>
<a href="#l10.70"></a><span id="l10.70" class="difflineplus">+          for (let layer of this.mEventMap) {</span>
<a href="#l10.71"></a><span id="l10.71"> </span>
<a href="#l10.72"></a><span id="l10.72">               // The event-map (this.mEventMap) contains an array of layers.</span>
<a href="#l10.73"></a><span id="l10.73">               // For each layer we create a box below the stack just created above.</span>
<a href="#l10.74"></a><span id="l10.74">               // So each different layer lives in a box that's contained in the stack.</span>
<a href="#l10.75"></a><span id="l10.75">               let xulColumn = createXULElement(&quot;box&quot;);</span>
<a href="#l10.76"></a><span id="l10.76">               xulColumn.setAttribute(&quot;orient&quot;, otherorient);</span>
<a href="#l10.77"></a><span id="l10.77">               xulColumn.setAttribute(&quot;flex&quot;, &quot;1&quot;);</span>
<a href="#l10.78"></a><span id="l10.78">               xulColumn.setAttribute(&quot;style&quot;, &quot;min-width: 1px; min-height: 1px;&quot;);</span>
<a href="#l10.79"></a><span id="l10.79" class="difflineat">@@ -732,32 +732,32 @@</span>
<a href="#l10.80"></a><span id="l10.80">               // column count determined by layer with no special span columns</span>
<a href="#l10.81"></a><span id="l10.81">               if (layer.every(e =&gt; !e.specialSpan)) {</span>
<a href="#l10.82"></a><span id="l10.82">                   columnCount = layer.length;</span>
<a href="#l10.83"></a><span id="l10.83">               }</span>
<a href="#l10.84"></a><span id="l10.84">               spanTotal = 0;</span>
<a href="#l10.85"></a><span id="l10.85"> </span>
<a href="#l10.86"></a><span id="l10.86">               // Each layer contains a list of the columns that</span>
<a href="#l10.87"></a><span id="l10.87">               // need to be created for a span.</span>
<a href="#l10.88"></a><span id="l10.88" class="difflineminus">-              for each (let column in layer) {</span>
<a href="#l10.89"></a><span id="l10.89" class="difflineplus">+              for (let column of layer) {</span>
<a href="#l10.90"></a><span id="l10.90">                   let innerColumn = createXULElement(&quot;box&quot;);</span>
<a href="#l10.91"></a><span id="l10.91">                   innerColumn.setAttribute(&quot;orient&quot;, orient);</span>
<a href="#l10.92"></a><span id="l10.92"> </span>
<a href="#l10.93"></a><span id="l10.93">                   let colFlex = column.specialSpan ? (columnCount * column.specialSpan) : 1;</span>
<a href="#l10.94"></a><span id="l10.94">                   innerColumn.setAttribute(&quot;flex&quot;, colFlex);</span>
<a href="#l10.95"></a><span id="l10.95">                   spanTotal += colFlex;</span>
<a href="#l10.96"></a><span id="l10.96"> </span>
<a href="#l10.97"></a><span id="l10.97">                   innerColumn.style.minWidth = &quot;1px&quot;;</span>
<a href="#l10.98"></a><span id="l10.98">                   innerColumn.style.minHeight = &quot;1px&quot;;</span>
<a href="#l10.99"></a><span id="l10.99">                   innerColumn.style.width = colFlex + &quot;px&quot;;</span>
<a href="#l10.100"></a><span id="l10.100">                   innerColumn.style.height = colFlex + &quot;px&quot;;</span>
<a href="#l10.101"></a><span id="l10.101"> </span>
<a href="#l10.102"></a><span id="l10.102">                   xulColumn.appendChild(innerColumn);</span>
<a href="#l10.103"></a><span id="l10.103">                   let curTime = 0;</span>
<a href="#l10.104"></a><span id="l10.104" class="difflineminus">-                  for each (let chunk in column) {</span>
<a href="#l10.105"></a><span id="l10.105" class="difflineplus">+                  for (let chunk of column) {</span>
<a href="#l10.106"></a><span id="l10.106">                       var duration = chunk.duration;</span>
<a href="#l10.107"></a><span id="l10.107">                       if (!duration) {</span>
<a href="#l10.108"></a><span id="l10.108">                           continue;</span>
<a href="#l10.109"></a><span id="l10.109">                       }</span>
<a href="#l10.110"></a><span id="l10.110"> </span>
<a href="#l10.111"></a><span id="l10.111">                       if (chunk.event) {</span>
<a href="#l10.112"></a><span id="l10.112">                           let chunkBox = createXULElement(&quot;calendar-event-box&quot;);</span>
<a href="#l10.113"></a><span id="l10.113">                           let durMinutes = duration.inSeconds / 60;</span>
<a href="#l10.114"></a><span id="l10.114" class="difflineat">@@ -1106,22 +1106,22 @@</span>
<a href="#l10.115"></a><span id="l10.115">           //   not columns).  What's more, in the 'specialSpan' case, the</span>
<a href="#l10.116"></a><span id="l10.116">           //   columns won't actually have the same size, but will only all</span>
<a href="#l10.117"></a><span id="l10.117">           //   be multiples of a common size.  See the note in the relayout</span>
<a href="#l10.118"></a><span id="l10.118">           //   function for more info on this (fairly rare) case.</span>
<a href="#l10.119"></a><span id="l10.119">           var layers = [];</span>
<a href="#l10.120"></a><span id="l10.120"> </span>
<a href="#l10.121"></a><span id="l10.121">           // When we start a new blob, move to a new set of layers</span>
<a href="#l10.122"></a><span id="l10.122">           var layerOffset = 0;</span>
<a href="#l10.123"></a><span id="l10.123" class="difflineminus">-          for each (var glob in aBlobs) {</span>
<a href="#l10.124"></a><span id="l10.124" class="difflineplus">+          for (var glob of aBlobs) {</span>
<a href="#l10.125"></a><span id="l10.125"> </span>
<a href="#l10.126"></a><span id="l10.126">               var layerArray = [];</span>
<a href="#l10.127"></a><span id="l10.127">               var layerCounter = 1;</span>
<a href="#l10.128"></a><span id="l10.128"> </span>
<a href="#l10.129"></a><span id="l10.129" class="difflineminus">-              for each (var data in glob.blob) {</span>
<a href="#l10.130"></a><span id="l10.130" class="difflineplus">+              for (var data of glob.blob) {</span>
<a href="#l10.131"></a><span id="l10.131"> </span>
<a href="#l10.132"></a><span id="l10.132">                   // from the item at hand we need to figure out on which</span>
<a href="#l10.133"></a><span id="l10.133">                   // layer and on which column it should go.</span>
<a href="#l10.134"></a><span id="l10.134">                   var layerIndex;</span>
<a href="#l10.135"></a><span id="l10.135">                   var specialSpan = null;</span>
<a href="#l10.136"></a><span id="l10.136"> </span>
<a href="#l10.137"></a><span id="l10.137">                   // each blob receives its own layer, that's the first part of the story. within</span>
<a href="#l10.138"></a><span id="l10.138">                   // a given blob we need to distribute the items on different layers depending on</span>
<a href="#l10.139"></a><span id="l10.139" class="difflineat">@@ -2106,17 +2106,17 @@</span>
<a href="#l10.140"></a><span id="l10.140">         &lt;setter&gt;&lt;![CDATA[</span>
<a href="#l10.141"></a><span id="l10.141">           this.mDate = val;</span>
<a href="#l10.142"></a><span id="l10.142">           return val;</span>
<a href="#l10.143"></a><span id="l10.143">         ]]&gt;&lt;/setter&gt;</span>
<a href="#l10.144"></a><span id="l10.144">       &lt;/property&gt;</span>
<a href="#l10.145"></a><span id="l10.145">       &lt;method name=&quot;findBoxForItem&quot;&gt;</span>
<a href="#l10.146"></a><span id="l10.146">         &lt;parameter name=&quot;aItem&quot;/&gt;</span>
<a href="#l10.147"></a><span id="l10.147">         &lt;body&gt;&lt;![CDATA[</span>
<a href="#l10.148"></a><span id="l10.148" class="difflineminus">-          for each (var item in this.mItemBoxes) {</span>
<a href="#l10.149"></a><span id="l10.149" class="difflineplus">+          for (var item of this.mItemBoxes) {</span>
<a href="#l10.150"></a><span id="l10.150">               if (aItem &amp;&amp; item.occurrence.hasSameIds(aItem)) {</span>
<a href="#l10.151"></a><span id="l10.151">                   // We can return directly, since there will only be one box per</span>
<a href="#l10.152"></a><span id="l10.152">                   // item in the header.</span>
<a href="#l10.153"></a><span id="l10.153">                   return item;</span>
<a href="#l10.154"></a><span id="l10.154">               }</span>
<a href="#l10.155"></a><span id="l10.155">           }</span>
<a href="#l10.156"></a><span id="l10.156">           return null;</span>
<a href="#l10.157"></a><span id="l10.157">         ]]&gt;&lt;/body&gt;</span>
<a href="#l10.158"></a><span id="l10.158" class="difflineat">@@ -2169,28 +2169,28 @@</span>
<a href="#l10.159"></a><span id="l10.159">          newItem = cal.setItemToAllDay(newItem, true);</span>
<a href="#l10.160"></a><span id="l10.160">          return newItem;</span>
<a href="#l10.161"></a><span id="l10.161">         ]]&gt;&lt;/body&gt;</span>
<a href="#l10.162"></a><span id="l10.162">       &lt;/method&gt;</span>
<a href="#l10.163"></a><span id="l10.163"> </span>
<a href="#l10.164"></a><span id="l10.164">       &lt;method name=&quot;selectOccurrence&quot;&gt;</span>
<a href="#l10.165"></a><span id="l10.165">         &lt;parameter name=&quot;aItem&quot;/&gt;</span>
<a href="#l10.166"></a><span id="l10.166">         &lt;body&gt;&lt;![CDATA[</span>
<a href="#l10.167"></a><span id="l10.167" class="difflineminus">-          for each (let itemBox in this.mItemBoxes) {</span>
<a href="#l10.168"></a><span id="l10.168" class="difflineplus">+          for (let itemBox of this.mItemBoxes) {</span>
<a href="#l10.169"></a><span id="l10.169">             if (aItem &amp;&amp; (itemBox.occurrence.hashId == aItem.hashId)) {</span>
<a href="#l10.170"></a><span id="l10.170">               itemBox.selected = true;</span>
<a href="#l10.171"></a><span id="l10.171">             }</span>
<a href="#l10.172"></a><span id="l10.172"> </span>
<a href="#l10.173"></a><span id="l10.173">           }</span>
<a href="#l10.174"></a><span id="l10.174">         ]]&gt;&lt;/body&gt;</span>
<a href="#l10.175"></a><span id="l10.175">       &lt;/method&gt;</span>
<a href="#l10.176"></a><span id="l10.176">       &lt;method name=&quot;unselectOccurrence&quot;&gt;</span>
<a href="#l10.177"></a><span id="l10.177">         &lt;parameter name=&quot;aItem&quot;/&gt;</span>
<a href="#l10.178"></a><span id="l10.178">         &lt;body&gt;&lt;![CDATA[</span>
<a href="#l10.179"></a><span id="l10.179" class="difflineminus">-          for each (let itemBox in this.mItemBoxes) {</span>
<a href="#l10.180"></a><span id="l10.180" class="difflineplus">+          for (let itemBox of this.mItemBoxes) {</span>
<a href="#l10.181"></a><span id="l10.181">             if (aItem &amp;&amp; (itemBox.occurrence.hashId == aItem.hashId)) {</span>
<a href="#l10.182"></a><span id="l10.182">               itemBox.selected = false;</span>
<a href="#l10.183"></a><span id="l10.183">             }</span>
<a href="#l10.184"></a><span id="l10.184">           }</span>
<a href="#l10.185"></a><span id="l10.185">         ]]&gt;&lt;/body&gt;</span>
<a href="#l10.186"></a><span id="l10.186">       &lt;/method&gt;</span>
<a href="#l10.187"></a><span id="l10.187"> </span>
<a href="#l10.188"></a><span id="l10.188">     &lt;/implementation&gt;</span>
<a href="#l10.189"></a><span id="l10.189" class="difflineat">@@ -2752,17 +2752,17 @@</span>
<a href="#l10.190"></a><span id="l10.190">             } else {</span>
<a href="#l10.191"></a><span id="l10.191">               aBox.setAttribute(&quot;flashing&quot;, &quot;true&quot;);</span>
<a href="#l10.192"></a><span id="l10.192">             }</span>
<a href="#l10.193"></a><span id="l10.193">           }</span>
<a href="#l10.194"></a><span id="l10.194"> </span>
<a href="#l10.195"></a><span id="l10.195">           // Make sure the flashing attribute is set or reset on all visible</span>
<a href="#l10.196"></a><span id="l10.196">           // boxes.</span>
<a href="#l10.197"></a><span id="l10.197">           var columns = this.findColumnsForItem(aAlarmItem);</span>
<a href="#l10.198"></a><span id="l10.198" class="difflineminus">-          for each (var col in columns) {</span>
<a href="#l10.199"></a><span id="l10.199" class="difflineplus">+          for (var col of columns) {</span>
<a href="#l10.200"></a><span id="l10.200">             var box = col.column.findChunkForOccurrence(aAlarmItem);</span>
<a href="#l10.201"></a><span id="l10.201">             if (box &amp;&amp; box.eventbox) {</span>
<a href="#l10.202"></a><span id="l10.202">               setFlashingAttribute(box.eventbox);</span>
<a href="#l10.203"></a><span id="l10.203">             }</span>
<a href="#l10.204"></a><span id="l10.204">             box = col.header.findBoxForItem(aAlarmItem);</span>
<a href="#l10.205"></a><span id="l10.205">             if (box) {</span>
<a href="#l10.206"></a><span id="l10.206">               setFlashingAttribute(box);</span>
<a href="#l10.207"></a><span id="l10.207">             }</span>
<a href="#l10.208"></a><span id="l10.208" class="difflineat">@@ -2808,17 +2808,17 @@</span>
<a href="#l10.209"></a><span id="l10.209">           var targetDate = aDate.getInTimezone(this.mTimezone);</span>
<a href="#l10.210"></a><span id="l10.210">           targetDate.isDate = true;</span>
<a href="#l10.211"></a><span id="l10.211"> </span>
<a href="#l10.212"></a><span id="l10.212">           if (this.mStartDate &amp;&amp; this.mEndDate) {</span>
<a href="#l10.213"></a><span id="l10.213">               if (this.mStartDate.compare(targetDate) &lt;= 0 &amp;&amp;</span>
<a href="#l10.214"></a><span id="l10.214">                   this.mEndDate.compare(targetDate) &gt;= 0)</span>
<a href="#l10.215"></a><span id="l10.215">                   return;</span>
<a href="#l10.216"></a><span id="l10.216">           } else if (this.mDateList) {</span>
<a href="#l10.217"></a><span id="l10.217" class="difflineminus">-              for each (var d in this.mDateList) {</span>
<a href="#l10.218"></a><span id="l10.218" class="difflineplus">+              for (var d of this.mDateList) {</span>
<a href="#l10.219"></a><span id="l10.219">                   // if date is already visible, nothing to do</span>
<a href="#l10.220"></a><span id="l10.220">                   if (d.compare(targetDate) == 0)</span>
<a href="#l10.221"></a><span id="l10.221">                       return;</span>
<a href="#l10.222"></a><span id="l10.222">               }</span>
<a href="#l10.223"></a><span id="l10.223">           }</span>
<a href="#l10.224"></a><span id="l10.224"> </span>
<a href="#l10.225"></a><span id="l10.225">           // if we're only showing one date, then continue</span>
<a href="#l10.226"></a><span id="l10.226">           // to only show one date; otherwise, show the week.</span>
<a href="#l10.227"></a><span id="l10.227" class="difflineat">@@ -2894,17 +2894,17 @@</span>
<a href="#l10.228"></a><span id="l10.228">            var dates = new Array();</span>
<a href="#l10.229"></a><span id="l10.229">            if (this.mStartDate &amp;&amp; this.mEndDate) {</span>
<a href="#l10.230"></a><span id="l10.230">                var d = this.mStartDate.clone();</span>
<a href="#l10.231"></a><span id="l10.231">                while (d.compare(this.mEndDate) &lt;= 0) {</span>
<a href="#l10.232"></a><span id="l10.232">                    dates.push(d.clone());</span>
<a href="#l10.233"></a><span id="l10.233">                    d.day += 1;</span>
<a href="#l10.234"></a><span id="l10.234">                }</span>
<a href="#l10.235"></a><span id="l10.235">            } else if (this.mDateList) {</span>
<a href="#l10.236"></a><span id="l10.236" class="difflineminus">-               for each (var d in this.mDateList)</span>
<a href="#l10.237"></a><span id="l10.237" class="difflineplus">+               for (var d of this.mDateList)</span>
<a href="#l10.238"></a><span id="l10.238">                    dates.push(d.clone());</span>
<a href="#l10.239"></a><span id="l10.239">            }</span>
<a href="#l10.240"></a><span id="l10.240"> </span>
<a href="#l10.241"></a><span id="l10.241">            aCount.value = dates.length;</span>
<a href="#l10.242"></a><span id="l10.242">            return dates;</span>
<a href="#l10.243"></a><span id="l10.243">         ]]&gt;&lt;/body&gt;</span>
<a href="#l10.244"></a><span id="l10.244">       &lt;/method&gt;</span>
<a href="#l10.245"></a><span id="l10.245"> </span>
<a href="#l10.246"></a><span id="l10.246" class="difflineat">@@ -2968,33 +2968,35 @@</span>
<a href="#l10.247"></a><span id="l10.247">           return this.mSelectedItems;</span>
<a href="#l10.248"></a><span id="l10.248">         ]]&gt;&lt;/body&gt;</span>
<a href="#l10.249"></a><span id="l10.249">       &lt;/method&gt;</span>
<a href="#l10.250"></a><span id="l10.250">       &lt;method name=&quot;setSelectedItems&quot;&gt;</span>
<a href="#l10.251"></a><span id="l10.251">         &lt;parameter name=&quot;aCount&quot;/&gt;</span>
<a href="#l10.252"></a><span id="l10.252">         &lt;parameter name=&quot;aItems&quot;/&gt;</span>
<a href="#l10.253"></a><span id="l10.253">         &lt;parameter name=&quot;aSuppressEvent&quot;/&gt;</span>
<a href="#l10.254"></a><span id="l10.254">         &lt;body&gt;&lt;![CDATA[</span>
<a href="#l10.255"></a><span id="l10.255" class="difflineminus">-          for each (var item in this.mSelectedItems) {</span>
<a href="#l10.256"></a><span id="l10.256" class="difflineminus">-              for each (var occ in this.getItemOccurrencesInView(item)) {</span>
<a href="#l10.257"></a><span id="l10.257" class="difflineminus">-                  var cols = this.findColumnsForItem(occ);</span>
<a href="#l10.258"></a><span id="l10.258" class="difflineminus">-                  for each (let col in cols) {</span>
<a href="#l10.259"></a><span id="l10.259" class="difflineminus">-                      col.header.unselectOccurrence(occ);</span>
<a href="#l10.260"></a><span id="l10.260" class="difflineminus">-                      col.column.unselectOccurrence(occ);</span>
<a href="#l10.261"></a><span id="l10.261" class="difflineplus">+          if (this.mSelectedItems) {</span>
<a href="#l10.262"></a><span id="l10.262" class="difflineplus">+              for (var item of this.mSelectedItems) {</span>
<a href="#l10.263"></a><span id="l10.263" class="difflineplus">+                  for (var occ of this.getItemOccurrencesInView(item)) {</span>
<a href="#l10.264"></a><span id="l10.264" class="difflineplus">+                      var cols = this.findColumnsForItem(occ);</span>
<a href="#l10.265"></a><span id="l10.265" class="difflineplus">+                      for (let col of cols) {</span>
<a href="#l10.266"></a><span id="l10.266" class="difflineplus">+                          col.header.unselectOccurrence(occ);</span>
<a href="#l10.267"></a><span id="l10.267" class="difflineplus">+                          col.column.unselectOccurrence(occ);</span>
<a href="#l10.268"></a><span id="l10.268" class="difflineplus">+                      }</span>
<a href="#l10.269"></a><span id="l10.269">                   }</span>
<a href="#l10.270"></a><span id="l10.270">               }</span>
<a href="#l10.271"></a><span id="l10.271">           }</span>
<a href="#l10.272"></a><span id="l10.272">           this.mSelectedItems = aItems || [];</span>
<a href="#l10.273"></a><span id="l10.273"> </span>
<a href="#l10.274"></a><span id="l10.274" class="difflineminus">-          for each (var item in this.mSelectedItems) {</span>
<a href="#l10.275"></a><span id="l10.275" class="difflineminus">-              for each (var occ in this.getItemOccurrencesInView(item)) {</span>
<a href="#l10.276"></a><span id="l10.276" class="difflineplus">+          for (var item of this.mSelectedItems) {</span>
<a href="#l10.277"></a><span id="l10.277" class="difflineplus">+              for (var occ of this.getItemOccurrencesInView(item)) {</span>
<a href="#l10.278"></a><span id="l10.278">                   let cols = this.findColumnsForItem(occ);</span>
<a href="#l10.279"></a><span id="l10.279">                   if (cols.length &gt; 0) {</span>
<a href="#l10.280"></a><span id="l10.280">                       let start = item.startDate || item.entryDate || item.dueDate;</span>
<a href="#l10.281"></a><span id="l10.281" class="difflineminus">-                      for each (let col in cols) {</span>
<a href="#l10.282"></a><span id="l10.282" class="difflineplus">+                      for (let col of cols) {</span>
<a href="#l10.283"></a><span id="l10.283">                           if (start.isDate) {</span>
<a href="#l10.284"></a><span id="l10.284">                               col.header.selectOccurrence(occ);</span>
<a href="#l10.285"></a><span id="l10.285">                           } else {</span>
<a href="#l10.286"></a><span id="l10.286">                               col.column.selectOccurrence(occ);</span>
<a href="#l10.287"></a><span id="l10.287">                           }</span>
<a href="#l10.288"></a><span id="l10.288">                       }</span>
<a href="#l10.289"></a><span id="l10.289">                   }</span>
<a href="#l10.290"></a><span id="l10.290">               }</span>
<a href="#l10.291"></a><span id="l10.291" class="difflineat">@@ -3021,29 +3023,29 @@</span>
<a href="#l10.292"></a><span id="l10.292">       &lt;/method&gt;</span>
<a href="#l10.293"></a><span id="l10.293"> </span>
<a href="#l10.294"></a><span id="l10.294">       &lt;method name=&quot;centerSelectedItems&quot;&gt;</span>
<a href="#l10.295"></a><span id="l10.295">         &lt;body&gt;&lt;![CDATA[</span>
<a href="#l10.296"></a><span id="l10.296">           var displayTZ = calendarDefaultTimezone();</span>
<a href="#l10.297"></a><span id="l10.297">           var lowMinute = 24 * 60;</span>
<a href="#l10.298"></a><span id="l10.298">           var highMinute = 0;</span>
<a href="#l10.299"></a><span id="l10.299"> </span>
<a href="#l10.300"></a><span id="l10.300" class="difflineminus">-          for each (var item in this.mSelectedItems) {</span>
<a href="#l10.301"></a><span id="l10.301" class="difflineplus">+          for (var item of this.mSelectedItems) {</span>
<a href="#l10.302"></a><span id="l10.302">               var startDateProperty = calGetStartDateProp(item);</span>
<a href="#l10.303"></a><span id="l10.303">               var endDateProperty = calGetEndDateProp(item);</span>
<a href="#l10.304"></a><span id="l10.304"> </span>
<a href="#l10.305"></a><span id="l10.305">               var occs = [];</span>
<a href="#l10.306"></a><span id="l10.306">               if (item.recurrenceInfo) {</span>
<a href="#l10.307"></a><span id="l10.307">                   // if selected a parent item, show occurrence(s) in view range</span>
<a href="#l10.308"></a><span id="l10.308">                   occs = item.getOccurrencesBetween(this.startDate, this.queryEndDate, {}, 0);</span>
<a href="#l10.309"></a><span id="l10.309">               } else {</span>
<a href="#l10.310"></a><span id="l10.310">                   occs = [item];</span>
<a href="#l10.311"></a><span id="l10.311">               }</span>
<a href="#l10.312"></a><span id="l10.312"> </span>
<a href="#l10.313"></a><span id="l10.313" class="difflineminus">-              for each (var occ in occs) {</span>
<a href="#l10.314"></a><span id="l10.314" class="difflineplus">+              for (var occ of occs) {</span>
<a href="#l10.315"></a><span id="l10.315">                   var occStart = occ[startDateProperty];</span>
<a href="#l10.316"></a><span id="l10.316">                   var occEnd = occ[endDateProperty];</span>
<a href="#l10.317"></a><span id="l10.317">                   // must have at least one of start or end</span>
<a href="#l10.318"></a><span id="l10.318">                   if (!occStart &amp;&amp; !occEnd) {</span>
<a href="#l10.319"></a><span id="l10.319">                       continue; // task with no dates</span>
<a href="#l10.320"></a><span id="l10.320">                   }</span>
<a href="#l10.321"></a><span id="l10.321"> </span>
<a href="#l10.322"></a><span id="l10.322">                   // if just has single datetime, treat as zero duration item</span>
<a href="#l10.323"></a><span id="l10.323" class="difflineat">@@ -3112,17 +3114,20 @@</span>
<a href="#l10.324"></a><span id="l10.324">           return this.mPixPerMin</span>
<a href="#l10.325"></a><span id="l10.325">         ]]&gt;&lt;/getter&gt;</span>
<a href="#l10.326"></a><span id="l10.326">         &lt;setter&gt;&lt;![CDATA[</span>
<a href="#l10.327"></a><span id="l10.327">           this.mPixPerMin = val;</span>
<a href="#l10.328"></a><span id="l10.328"> </span>
<a href="#l10.329"></a><span id="l10.329">           let timebar = document.getAnonymousElementByAttribute(this, &quot;anonid&quot;, &quot;timebar&quot;);</span>
<a href="#l10.330"></a><span id="l10.330">           timebar.pixelsPerMinute = val;</span>
<a href="#l10.331"></a><span id="l10.331"> </span>
<a href="#l10.332"></a><span id="l10.332" class="difflineminus">-          for each (let col in this.mDateColumns) {</span>
<a href="#l10.333"></a><span id="l10.333" class="difflineplus">+          if (!this.mDateColumns) {</span>
<a href="#l10.334"></a><span id="l10.334" class="difflineplus">+              return;</span>
<a href="#l10.335"></a><span id="l10.335" class="difflineplus">+          }</span>
<a href="#l10.336"></a><span id="l10.336" class="difflineplus">+          for (let col of this.mDateColumns) {</span>
<a href="#l10.337"></a><span id="l10.337">               col.column.pixelsPerMinute = val;</span>
<a href="#l10.338"></a><span id="l10.338">           }</span>
<a href="#l10.339"></a><span id="l10.339">           return val;</span>
<a href="#l10.340"></a><span id="l10.340">         ]]&gt;&lt;/setter&gt;</span>
<a href="#l10.341"></a><span id="l10.341">       &lt;/property&gt;</span>
<a href="#l10.342"></a><span id="l10.342"> </span>
<a href="#l10.343"></a><span id="l10.343">       &lt;!-- private --&gt;</span>
<a href="#l10.344"></a><span id="l10.344"> </span>
<a href="#l10.345"></a><span id="l10.345" class="difflineat">@@ -3199,20 +3204,20 @@</span>
<a href="#l10.346"></a><span id="l10.346">           } else {</span>
<a href="#l10.347"></a><span id="l10.347">               this.pixelsPerMinute = 0.6;</span>
<a href="#l10.348"></a><span id="l10.348">           }</span>
<a href="#l10.349"></a><span id="l10.349"> </span>
<a href="#l10.350"></a><span id="l10.350">           var normalelems = ['mainbox', 'timebar'];</span>
<a href="#l10.351"></a><span id="l10.351">           var otherelems = ['labelbox', 'labeldaybox', 'headertimespacer',</span>
<a href="#l10.352"></a><span id="l10.352">                             'headerbox', 'headerdaybox', 'scrollbox', 'daybox'];</span>
<a href="#l10.353"></a><span id="l10.353"> </span>
<a href="#l10.354"></a><span id="l10.354" class="difflineminus">-          for each (var id in normalelems) {</span>
<a href="#l10.355"></a><span id="l10.355" class="difflineplus">+          for (var id of normalelems) {</span>
<a href="#l10.356"></a><span id="l10.356">               document.getAnonymousElementByAttribute(this, &quot;anonid&quot;, id).setAttribute(&quot;orient&quot;, orient);</span>
<a href="#l10.357"></a><span id="l10.357">           }</span>
<a href="#l10.358"></a><span id="l10.358" class="difflineminus">-          for each (var id in otherelems) {</span>
<a href="#l10.359"></a><span id="l10.359" class="difflineplus">+          for (var id of otherelems) {</span>
<a href="#l10.360"></a><span id="l10.360">               document.getAnonymousElementByAttribute(this, &quot;anonid&quot;, id).setAttribute(&quot;orient&quot;, otherorient);</span>
<a href="#l10.361"></a><span id="l10.361">           }</span>
<a href="#l10.362"></a><span id="l10.362"> </span>
<a href="#l10.363"></a><span id="l10.363">           var scrollbox = document.getAnonymousElementByAttribute(</span>
<a href="#l10.364"></a><span id="l10.364">                          this, &quot;anonid&quot;, &quot;scrollbox&quot;);</span>
<a href="#l10.365"></a><span id="l10.365">           var mainbox = document.getAnonymousElementByAttribute(</span>
<a href="#l10.366"></a><span id="l10.366">                         this, &quot;anonid&quot;, &quot;mainbox&quot;);</span>
<a href="#l10.367"></a><span id="l10.367"> </span>
<a href="#l10.368"></a><span id="l10.368" class="difflineat">@@ -3224,17 +3229,17 @@</span>
<a href="#l10.369"></a><span id="l10.369">           } else {</span>
<a href="#l10.370"></a><span id="l10.370">               scrollbox.setAttribute(</span>
<a href="#l10.371"></a><span id="l10.371">                   &quot;style&quot;, &quot;overflow-x: auto; overflow-y: hidden;&quot;);</span>
<a href="#l10.372"></a><span id="l10.372">               mainbox.setAttribute(</span>
<a href="#l10.373"></a><span id="l10.373">                   &quot;style&quot;, &quot;overflow-x: hidden; overflow-y: auto;&quot;);</span>
<a href="#l10.374"></a><span id="l10.374">           }</span>
<a href="#l10.375"></a><span id="l10.375"> </span>
<a href="#l10.376"></a><span id="l10.376">           var boxes = [&quot;daybox&quot;, &quot;headerdaybox&quot;];</span>
<a href="#l10.377"></a><span id="l10.377" class="difflineminus">-          for each (var boxname in boxes) {</span>
<a href="#l10.378"></a><span id="l10.378" class="difflineplus">+          for (var boxname of boxes) {</span>
<a href="#l10.379"></a><span id="l10.379">               var box = document.getAnonymousElementByAttribute(this, &quot;anonid&quot;, boxname);</span>
<a href="#l10.380"></a><span id="l10.380">               setAttributeToChildren(box, &quot;orient&quot;, orient);</span>
<a href="#l10.381"></a><span id="l10.381">           }</span>
<a href="#l10.382"></a><span id="l10.382">           var box = document.getAnonymousElementByAttribute(this, &quot;anonid&quot;, &quot;labeldaybox&quot;);</span>
<a href="#l10.383"></a><span id="l10.383">           setAttributeToChildren(this.labeldaybox, &quot;orient&quot;, otherorient);</span>
<a href="#l10.384"></a><span id="l10.384"> </span>
<a href="#l10.385"></a><span id="l10.385">           // Refresh</span>
<a href="#l10.386"></a><span id="l10.386">           this.refresh();</span>
<a href="#l10.387"></a><span id="l10.387" class="difflineat">@@ -3303,17 +3308,17 @@</span>
<a href="#l10.388"></a><span id="l10.388">           // get today's date</span>
<a href="#l10.389"></a><span id="l10.389">           var today = this.today();</span>
<a href="#l10.390"></a><span id="l10.390">           var counter = 0;</span>
<a href="#l10.391"></a><span id="l10.391">           var dayboxkids = daybox.childNodes;</span>
<a href="#l10.392"></a><span id="l10.392">           var headerboxkids = headerdaybox.childNodes;</span>
<a href="#l10.393"></a><span id="l10.393">           let labelboxkids = this.labeldaybox.childNodes;</span>
<a href="#l10.394"></a><span id="l10.394">           let updateTimeIndicator = false;</span>
<a href="#l10.395"></a><span id="l10.395"> </span>
<a href="#l10.396"></a><span id="l10.396" class="difflineminus">-          for each (var d in computedDateList) {</span>
<a href="#l10.397"></a><span id="l10.397" class="difflineplus">+          for (var d of computedDateList) {</span>
<a href="#l10.398"></a><span id="l10.398">               var dayEventsBox;</span>
<a href="#l10.399"></a><span id="l10.399">               if (counter &lt; dayboxkids.length) {</span>
<a href="#l10.400"></a><span id="l10.400">                   dayEventsBox = dayboxkids[counter];</span>
<a href="#l10.401"></a><span id="l10.401">                   dayEventsBox.removeAttribute(&quot;relation&quot;);</span>
<a href="#l10.402"></a><span id="l10.402">                   dayEventsBox.mEventInfos = new Array();</span>
<a href="#l10.403"></a><span id="l10.403">               } else {</span>
<a href="#l10.404"></a><span id="l10.404">                   dayEventsBox = createXULElement(&quot;calendar-event-column&quot;);</span>
<a href="#l10.405"></a><span id="l10.405">                   dayEventsBox.setAttribute(&quot;flex&quot;, &quot;1&quot;);</span>
<a href="#l10.406"></a><span id="l10.406" class="difflineat">@@ -3409,18 +3414,20 @@</span>
<a href="#l10.407"></a><span id="l10.407">           removeExtraKids(this.labeldaybox);</span>
<a href="#l10.408"></a><span id="l10.408"> </span>
<a href="#l10.409"></a><span id="l10.409">           if (updateTimeIndicator) {</span>
<a href="#l10.410"></a><span id="l10.410">               this.updateTimeIndicatorPosition();</span>
<a href="#l10.411"></a><span id="l10.411">           }</span>
<a href="#l10.412"></a><span id="l10.412"> </span>
<a href="#l10.413"></a><span id="l10.413">           // fix pixels-per-minute</span>
<a href="#l10.414"></a><span id="l10.414">           this.onResize();</span>
<a href="#l10.415"></a><span id="l10.415" class="difflineminus">-          for each (let col in this.mDateColumns) {</span>
<a href="#l10.416"></a><span id="l10.416" class="difflineminus">-               col.column.endLayoutBatchChange();</span>
<a href="#l10.417"></a><span id="l10.417" class="difflineplus">+          if (this.mDateColumns) {</span>
<a href="#l10.418"></a><span id="l10.418" class="difflineplus">+              for (let col of this.mDateColumns) {</span>
<a href="#l10.419"></a><span id="l10.419" class="difflineplus">+                  col.column.endLayoutBatchChange();</span>
<a href="#l10.420"></a><span id="l10.420" class="difflineplus">+              }</span>
<a href="#l10.421"></a><span id="l10.421">           }</span>
<a href="#l10.422"></a><span id="l10.422"> </span>
<a href="#l10.423"></a><span id="l10.423">           // Adjust scrollbar spacers</span>
<a href="#l10.424"></a><span id="l10.424">           this.adjustScrollBarSpacers();</span>
<a href="#l10.425"></a><span id="l10.425"> </span>
<a href="#l10.426"></a><span id="l10.426">           // Store the start and end of current view. Next time when</span>
<a href="#l10.427"></a><span id="l10.427">           // setDateRange is called, it will use mViewStart and mViewEnd to</span>
<a href="#l10.428"></a><span id="l10.428">           // check if view range has been changed.</span>
<a href="#l10.429"></a><span id="l10.429" class="difflineat">@@ -3441,17 +3448,20 @@</span>
<a href="#l10.430"></a><span id="l10.430"> </span>
<a href="#l10.431"></a><span id="l10.431">           this.mToggleStatus = toggleStatus;</span>
<a href="#l10.432"></a><span id="l10.432">         ]]&gt;&lt;/body&gt;</span>
<a href="#l10.433"></a><span id="l10.433">       &lt;/method&gt;</span>
<a href="#l10.434"></a><span id="l10.434"> </span>
<a href="#l10.435"></a><span id="l10.435">       &lt;method name=&quot;findColumnForDate&quot;&gt;</span>
<a href="#l10.436"></a><span id="l10.436">         &lt;parameter name=&quot;aDate&quot;/&gt;</span>
<a href="#l10.437"></a><span id="l10.437">         &lt;body&gt;&lt;![CDATA[</span>
<a href="#l10.438"></a><span id="l10.438" class="difflineminus">-          for each (var col in this.mDateColumns) {</span>
<a href="#l10.439"></a><span id="l10.439" class="difflineplus">+          if (!this.mDateColumns) {</span>
<a href="#l10.440"></a><span id="l10.440" class="difflineplus">+              return;</span>
<a href="#l10.441"></a><span id="l10.441" class="difflineplus">+          }</span>
<a href="#l10.442"></a><span id="l10.442" class="difflineplus">+          for (var col of this.mDateColumns) {</span>
<a href="#l10.443"></a><span id="l10.443">               if (col.date.compare(aDate) == 0)</span>
<a href="#l10.444"></a><span id="l10.444">                   return col;</span>
<a href="#l10.445"></a><span id="l10.445">           }</span>
<a href="#l10.446"></a><span id="l10.446">           return null;</span>
<a href="#l10.447"></a><span id="l10.447">         ]]&gt;&lt;/body&gt;</span>
<a href="#l10.448"></a><span id="l10.448">       &lt;/method&gt;</span>
<a href="#l10.449"></a><span id="l10.449"> </span>
<a href="#l10.450"></a><span id="l10.450">       &lt;method name=&quot;findDayBoxForDate&quot;&gt;</span>
<a href="#l10.451"></a><span id="l10.451" class="difflineat">@@ -3480,17 +3490,17 @@</span>
<a href="#l10.452"></a><span id="l10.452">       &lt;method name=&quot;findColumnsForOccurrences&quot;&gt;</span>
<a href="#l10.453"></a><span id="l10.453">         &lt;parameter name=&quot;aOccurrences&quot;/&gt;</span>
<a href="#l10.454"></a><span id="l10.454">         &lt;body&gt;&lt;![CDATA[</span>
<a href="#l10.455"></a><span id="l10.455">           if (!this.mDateColumns || !this.mDateColumns.length) {</span>
<a href="#l10.456"></a><span id="l10.456">             return [];</span>
<a href="#l10.457"></a><span id="l10.457">           }</span>
<a href="#l10.458"></a><span id="l10.458"> </span>
<a href="#l10.459"></a><span id="l10.459">           var occMap = {};</span>
<a href="#l10.460"></a><span id="l10.460" class="difflineminus">-          for each (var occ in aOccurrences) {</span>
<a href="#l10.461"></a><span id="l10.461" class="difflineplus">+          for (var occ of aOccurrences) {</span>
<a href="#l10.462"></a><span id="l10.462">               var startDate = occ[calGetStartDateProp(occ)]</span>
<a href="#l10.463"></a><span id="l10.463">                               .getInTimezone(this.mStartDate.timezone);</span>
<a href="#l10.464"></a><span id="l10.464">               var endDate = occ[calGetEndDateProp(occ)]</span>
<a href="#l10.465"></a><span id="l10.465">                               .getInTimezone(this.mEndDate.timezone) || startDate;</span>
<a href="#l10.466"></a><span id="l10.466">               if (startDate.compare(this.mStartDate) &gt;= 0 &amp;&amp;</span>
<a href="#l10.467"></a><span id="l10.467">                   endDate.compare(this.mEndDate) &lt;= 0) {</span>
<a href="#l10.468"></a><span id="l10.468">                   for (var i = startDate.day; i &lt;= endDate.day; i++) {</span>
<a href="#l10.469"></a><span id="l10.469">                       occMap[i] = true;</span>
<a href="#l10.470"></a><span id="l10.470" class="difflineat">@@ -3556,17 +3566,20 @@</span>
<a href="#l10.471"></a><span id="l10.471">       &lt;!-- for the given client-coord-system point, return</span>
<a href="#l10.472"></a><span id="l10.472">          - the calendar-event-column that contains it.  If</span>
<a href="#l10.473"></a><span id="l10.473">          - no column contains it, return null.</span>
<a href="#l10.474"></a><span id="l10.474">         --&gt;</span>
<a href="#l10.475"></a><span id="l10.475">       &lt;method name=&quot;findColumnForClientPoint&quot;&gt;</span>
<a href="#l10.476"></a><span id="l10.476">         &lt;parameter name=&quot;aClientX&quot;/&gt;</span>
<a href="#l10.477"></a><span id="l10.477">         &lt;parameter name=&quot;aClientY&quot;/&gt;</span>
<a href="#l10.478"></a><span id="l10.478">         &lt;body&gt;&lt;![CDATA[</span>
<a href="#l10.479"></a><span id="l10.479" class="difflineminus">-          for each (var col in this.mDateColumns) {</span>
<a href="#l10.480"></a><span id="l10.480" class="difflineplus">+          if (!this.mDateColumns) {</span>
<a href="#l10.481"></a><span id="l10.481" class="difflineplus">+              return null;</span>
<a href="#l10.482"></a><span id="l10.482" class="difflineplus">+          }</span>
<a href="#l10.483"></a><span id="l10.483" class="difflineplus">+          for (var col of this.mDateColumns) {</span>
<a href="#l10.484"></a><span id="l10.484">               let bo = document.getAnonymousElementByAttribute(col.column, &quot;anonid&quot;, &quot;boxstack&quot;).boxObject;</span>
<a href="#l10.485"></a><span id="l10.485">               if ((aClientX &gt;= bo.screenX) &amp;&amp; (aClientX &lt;= (bo.screenX + bo.width)) &amp;&amp;</span>
<a href="#l10.486"></a><span id="l10.486">                   (aClientY &gt;= bo.screenY) &amp;&amp; (aClientY &lt;= (bo.screenY + bo.height)))</span>
<a href="#l10.487"></a><span id="l10.487">               {</span>
<a href="#l10.488"></a><span id="l10.488">                   return col.column;</span>
<a href="#l10.489"></a><span id="l10.489">               }</span>
<a href="#l10.490"></a><span id="l10.490">           }</span>
<a href="#l10.491"></a><span id="l10.491">           return null;</span>
<a href="#l10.492"></a><span id="l10.492" class="difflineat">@@ -3589,17 +3602,17 @@</span>
<a href="#l10.493"></a><span id="l10.493"> </span>
<a href="#l10.494"></a><span id="l10.494">       &lt;method name=&quot;doAddItem&quot;&gt;</span>
<a href="#l10.495"></a><span id="l10.495">         &lt;parameter name=&quot;aEvent&quot;/&gt;</span>
<a href="#l10.496"></a><span id="l10.496">         &lt;body&gt;&lt;![CDATA[</span>
<a href="#l10.497"></a><span id="l10.497">           var cols = this.findColumnsForItem(aEvent);</span>
<a href="#l10.498"></a><span id="l10.498">           if (!cols.length)</span>
<a href="#l10.499"></a><span id="l10.499">               return;</span>
<a href="#l10.500"></a><span id="l10.500"> </span>
<a href="#l10.501"></a><span id="l10.501" class="difflineminus">-          for each (let col in cols) {</span>
<a href="#l10.502"></a><span id="l10.502" class="difflineplus">+          for (let col of cols) {</span>
<a href="#l10.503"></a><span id="l10.503">               let column = col.column;</span>
<a href="#l10.504"></a><span id="l10.504">               let header = col.header;</span>
<a href="#l10.505"></a><span id="l10.505"> </span>
<a href="#l10.506"></a><span id="l10.506">               let estart = aEvent.startDate || aEvent.entryDate || aEvent.dueDate;</span>
<a href="#l10.507"></a><span id="l10.507">               if (estart.isDate) {</span>
<a href="#l10.508"></a><span id="l10.508">                   header.addEvent(aEvent);</span>
<a href="#l10.509"></a><span id="l10.509">               } else {</span>
<a href="#l10.510"></a><span id="l10.510">                   column.addEvent(aEvent);</span>
<a href="#l10.511"></a><span id="l10.511" class="difflineat">@@ -3617,17 +3630,17 @@</span>
<a href="#l10.512"></a><span id="l10.512">           if (!cols.length)</span>
<a href="#l10.513"></a><span id="l10.513">               return;</span>
<a href="#l10.514"></a><span id="l10.514"> </span>
<a href="#l10.515"></a><span id="l10.515">           var oldLength = this.mSelectedItems.length;</span>
<a href="#l10.516"></a><span id="l10.516">           this.mSelectedItems = this.mSelectedItems.filter((item) =&gt; {</span>
<a href="#l10.517"></a><span id="l10.517">               return item.hashId != aEvent.hashId;</span>
<a href="#l10.518"></a><span id="l10.518">           });</span>
<a href="#l10.519"></a><span id="l10.519"> </span>
<a href="#l10.520"></a><span id="l10.520" class="difflineminus">-          for each (let col in cols) {</span>
<a href="#l10.521"></a><span id="l10.521" class="difflineplus">+          for (let col of cols) {</span>
<a href="#l10.522"></a><span id="l10.522">               let column = col.column;</span>
<a href="#l10.523"></a><span id="l10.523">               let header = col.header;</span>
<a href="#l10.524"></a><span id="l10.524"> </span>
<a href="#l10.525"></a><span id="l10.525">               let estart = aEvent.startDate || aEvent.entryDate || aEvent.dueDate;</span>
<a href="#l10.526"></a><span id="l10.526">               if (estart.isDate) {</span>
<a href="#l10.527"></a><span id="l10.527">                   header.deleteEvent(aEvent);</span>
<a href="#l10.528"></a><span id="l10.528">               } else {</span>
<a href="#l10.529"></a><span id="l10.529">                   column.deleteEvent(aEvent);</span>
<a href="#l10.530"></a><span id="l10.530" class="difflineat">@@ -3642,22 +3655,25 @@</span>
<a href="#l10.531"></a><span id="l10.531"> </span>
<a href="#l10.532"></a><span id="l10.532">           this.adjustScrollbarSpacersForAlldayEvents(aEvent);</span>
<a href="#l10.533"></a><span id="l10.533">         ]]&gt;&lt;/body&gt;</span>
<a href="#l10.534"></a><span id="l10.534">       &lt;/method&gt;</span>
<a href="#l10.535"></a><span id="l10.535"> </span>
<a href="#l10.536"></a><span id="l10.536">       &lt;method name=&quot;deleteItemsFromCalendar&quot;&gt;</span>
<a href="#l10.537"></a><span id="l10.537">         &lt;parameter name=&quot;aCalendar&quot;/&gt;</span>
<a href="#l10.538"></a><span id="l10.538">         &lt;body&gt;&lt;![CDATA[</span>
<a href="#l10.539"></a><span id="l10.539" class="difflineminus">-          for each (let col in this.mDateColumns) {</span>
<a href="#l10.540"></a><span id="l10.540" class="difflineplus">+          if (!this.mDateColumns) {</span>
<a href="#l10.541"></a><span id="l10.541" class="difflineplus">+              return;</span>
<a href="#l10.542"></a><span id="l10.542" class="difflineplus">+          }</span>
<a href="#l10.543"></a><span id="l10.543" class="difflineplus">+          for (let col of this.mDateColumns) {</span>
<a href="#l10.544"></a><span id="l10.544">               // get all-day events in column header and events within the column</span>
<a href="#l10.545"></a><span id="l10.545" class="difflineminus">-              let colEvents = [ box.occurrence for each (box in col.header.mItemBoxes) ]</span>
<a href="#l10.546"></a><span id="l10.546" class="difflineminus">-                              .concat([ info.event for each (info in col.column.mEventInfos) ]);</span>
<a href="#l10.547"></a><span id="l10.547" class="difflineminus">-</span>
<a href="#l10.548"></a><span id="l10.548" class="difflineminus">-              for each (let event in colEvents) {</span>
<a href="#l10.549"></a><span id="l10.549" class="difflineplus">+              let colEvents = col.header.mItemBoxes.map(box =&gt; box.occurrence)</span>
<a href="#l10.550"></a><span id="l10.550" class="difflineplus">+                .concat(col.column.mEventInfos.map(info =&gt; info.event));</span>
<a href="#l10.551"></a><span id="l10.551" class="difflineplus">+</span>
<a href="#l10.552"></a><span id="l10.552" class="difflineplus">+              for (let event of colEvents) {</span>
<a href="#l10.553"></a><span id="l10.553">                   if (event.calendar.id == aCalendar.id) {</span>
<a href="#l10.554"></a><span id="l10.554">                       this.doDeleteItem(event);</span>
<a href="#l10.555"></a><span id="l10.555">                   }</span>
<a href="#l10.556"></a><span id="l10.556">               }</span>
<a href="#l10.557"></a><span id="l10.557">           }</span>
<a href="#l10.558"></a><span id="l10.558">         ]]&gt;&lt;/body&gt;</span>
<a href="#l10.559"></a><span id="l10.559">       &lt;/method&gt;</span>
<a href="#l10.560"></a><span id="l10.560"> </span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l11.1"></a><span id="l11.1" class="difflineminus">--- a/calendar/base/content/calendar-task-tree.xml</span>
<a href="#l11.2"></a><span id="l11.2" class="difflineplus">+++ b/calendar/base/content/calendar-task-tree.xml</span>
<a href="#l11.3"></a><span id="l11.3" class="difflineat">@@ -403,40 +403,40 @@</span>
<a href="#l11.4"></a><span id="l11.4">               idiff.load(aOldItems);</span>
<a href="#l11.5"></a><span id="l11.5">               idiff.difference(aNewItems);</span>
<a href="#l11.6"></a><span id="l11.6">               idiff.complete();</span>
<a href="#l11.7"></a><span id="l11.7">               let delItems = idiff.deletedItems;</span>
<a href="#l11.8"></a><span id="l11.8">               let addItems = idiff.addedItems;</span>
<a href="#l11.9"></a><span id="l11.9">               let modItems = idiff.modifiedItems;</span>
<a href="#l11.10"></a><span id="l11.10"> </span>
<a href="#l11.11"></a><span id="l11.11">               // find the indexes of the old items that need to be removed</span>
<a href="#l11.12"></a><span id="l11.12" class="difflineminus">-              for each (let item in delItems.mArray) {</span>
<a href="#l11.13"></a><span id="l11.13" class="difflineplus">+              for (let item of delItems.mArray) {</span>
<a href="#l11.14"></a><span id="l11.14">                   if (item.hashId in this.binding.mHash2Index) {</span>
<a href="#l11.15"></a><span id="l11.15">                       // the old item needs to be removed</span>
<a href="#l11.16"></a><span id="l11.16">                       remIndexes.push(this.binding.mHash2Index[item.hashId]);</span>
<a href="#l11.17"></a><span id="l11.17">                       delete this.binding.mHash2Index[item.hashId];</span>
<a href="#l11.18"></a><span id="l11.18">                   }</span>
<a href="#l11.19"></a><span id="l11.19">               }</span>
<a href="#l11.20"></a><span id="l11.20"> </span>
<a href="#l11.21"></a><span id="l11.21">               // modified items need to be updated</span>
<a href="#l11.22"></a><span id="l11.22" class="difflineminus">-              for each (let item in modItems.mArray) {</span>
<a href="#l11.23"></a><span id="l11.23" class="difflineplus">+              for (let item of modItems.mArray) {</span>
<a href="#l11.24"></a><span id="l11.24">                   if (item.hashId in this.binding.mHash2Index) {</span>
<a href="#l11.25"></a><span id="l11.25">                       // make sure we're using the new version of a modified item</span>
<a href="#l11.26"></a><span id="l11.26">                       this.binding.mTaskArray[this.binding.mHash2Index[item.hashId]] = item;</span>
<a href="#l11.27"></a><span id="l11.27">                   }</span>
<a href="#l11.28"></a><span id="l11.28">               }</span>
<a href="#l11.29"></a><span id="l11.29"> </span>
<a href="#l11.30"></a><span id="l11.30">               // remove the old items working backward from the end so the indexes stay valid</span>
<a href="#l11.31"></a><span id="l11.31">               remIndexes.sort(function(a, b) {return b - a;}).forEach(function(index) {</span>
<a href="#l11.32"></a><span id="l11.32">                   this.binding.mTaskArray.splice(index, 1);</span>
<a href="#l11.33"></a><span id="l11.33">                   this.treebox.rowCountChanged(index, -1);</span>
<a href="#l11.34"></a><span id="l11.34">               }, this);</span>
<a href="#l11.35"></a><span id="l11.35"> </span>
<a href="#l11.36"></a><span id="l11.36">               // add the new items</span>
<a href="#l11.37"></a><span id="l11.37" class="difflineminus">-              for each (let item in addItems.mArray) {</span>
<a href="#l11.38"></a><span id="l11.38" class="difflineplus">+              for (let item of addItems.mArray) {</span>
<a href="#l11.39"></a><span id="l11.39">                   if (!(item.hashId in this.binding.mHash2Index)) {</span>
<a href="#l11.40"></a><span id="l11.40">                       let index = this.binding.mTaskArray.length;</span>
<a href="#l11.41"></a><span id="l11.41">                       this.binding.mTaskArray.push(item);</span>
<a href="#l11.42"></a><span id="l11.42">                       this.binding.mHash2Index[item.hashId] = index;</span>
<a href="#l11.43"></a><span id="l11.43">                       this.treebox.rowCountChanged(index, 1);</span>
<a href="#l11.44"></a><span id="l11.44">                       firstHash = firstHash || item.hashId;</span>
<a href="#l11.45"></a><span id="l11.45">                   }</span>
<a href="#l11.46"></a><span id="l11.46">               }</span>
<a href="#l11.47"></a><span id="l11.47" class="difflineat">@@ -570,17 +570,17 @@</span>
<a href="#l11.48"></a><span id="l11.48">                       this.sortDirection = &quot;descending&quot;;</span>
<a href="#l11.49"></a><span id="l11.49">                   }</span>
<a href="#l11.50"></a><span id="l11.50">               }</span>
<a href="#l11.51"></a><span id="l11.51">               this.selectedColumn = aCol.element;</span>
<a href="#l11.52"></a><span id="l11.52">               let selectedItems = this.binding.selectedTasks;</span>
<a href="#l11.53"></a><span id="l11.53">               this.binding.sortItems();</span>
<a href="#l11.54"></a><span id="l11.54">               if (selectedItems != undefined) {</span>
<a href="#l11.55"></a><span id="l11.55">                   this.tree.view.selection.clearSelection();</span>
<a href="#l11.56"></a><span id="l11.56" class="difflineminus">-                  for each (let item in selectedItems){</span>
<a href="#l11.57"></a><span id="l11.57" class="difflineplus">+                  for (let item of selectedItems){</span>
<a href="#l11.58"></a><span id="l11.58">                       let index = this.binding.mHash2Index[item.hashId];</span>
<a href="#l11.59"></a><span id="l11.59">                       this.tree.view.selection.toggleSelect(index);</span>
<a href="#l11.60"></a><span id="l11.60">                   }</span>
<a href="#l11.61"></a><span id="l11.61">               }</span>
<a href="#l11.62"></a><span id="l11.62">           },</span>
<a href="#l11.63"></a><span id="l11.63"> </span>
<a href="#l11.64"></a><span id="l11.64">           // The text for a given cell. If a column consists only of an</span>
<a href="#l11.65"></a><span id="l11.65">           // image, then the empty string is returned.</span>
<a href="#l11.66"></a><span id="l11.66" class="difflineat">@@ -976,17 +976,17 @@</span>
<a href="#l11.67"></a><span id="l11.67">         ]]&gt;&lt;/body&gt;</span>
<a href="#l11.68"></a><span id="l11.68">       &lt;/method&gt;</span>
<a href="#l11.69"></a><span id="l11.69"> </span>
<a href="#l11.70"></a><span id="l11.70">       &lt;!-- Called by event observers to update the display --&gt;</span>
<a href="#l11.71"></a><span id="l11.71">       &lt;method name=&quot;refresh&quot;&gt;</span>
<a href="#l11.72"></a><span id="l11.72">         &lt;parameter name=&quot;aFilter&quot;/&gt;</span>
<a href="#l11.73"></a><span id="l11.73">         &lt;body&gt;&lt;![CDATA[</span>
<a href="#l11.74"></a><span id="l11.74">           let cals = getCompositeCalendar().getCalendars({}) || [];</span>
<a href="#l11.75"></a><span id="l11.75" class="difflineminus">-          for each (let calendar in cals) {</span>
<a href="#l11.76"></a><span id="l11.76" class="difflineplus">+          for (let calendar of cals) {</span>
<a href="#l11.77"></a><span id="l11.77">               if (!calendar.getProperty(&quot;disabled&quot;)) {</span>
<a href="#l11.78"></a><span id="l11.78">                   this.refreshFromCalendar(calendar, aFilter);</span>
<a href="#l11.79"></a><span id="l11.79">               }</span>
<a href="#l11.80"></a><span id="l11.80">           }</span>
<a href="#l11.81"></a><span id="l11.81">         ]]&gt;&lt;/body&gt;</span>
<a href="#l11.82"></a><span id="l11.82">       &lt;/method&gt;</span>
<a href="#l11.83"></a><span id="l11.83"> </span>
<a href="#l11.84"></a><span id="l11.84">       &lt;method name=&quot;onCalendarAdded&quot;&gt;</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l12.1"></a><span id="l12.1" class="difflineminus">--- a/calendar/base/content/calendar-task-view.js</span>
<a href="#l12.2"></a><span id="l12.2" class="difflineplus">+++ b/calendar/base/content/calendar-task-view.js</span>
<a href="#l12.3"></a><span id="l12.3" class="difflineat">@@ -125,17 +125,17 @@ var taskDetailsView = {</span>
<a href="#l12.4"></a><span id="l12.4">             var description = item.hasProperty(&quot;DESCRIPTION&quot;) ? item.getProperty(&quot;DESCRIPTION&quot;) : null;</span>
<a href="#l12.5"></a><span id="l12.5">             textbox.value = description;</span>
<a href="#l12.6"></a><span id="l12.6">             textbox.inputField.readOnly = true;</span>
<a href="#l12.7"></a><span id="l12.7">             let attachmentRows = document.getElementById(&quot;calendar-task-details-attachment-rows&quot;);</span>
<a href="#l12.8"></a><span id="l12.8">             removeChildren(attachmentRows);</span>
<a href="#l12.9"></a><span id="l12.9">             let attachments = item.getAttachments({});</span>
<a href="#l12.10"></a><span id="l12.10">             if (displayElement(&quot;calendar-task-details-attachment-row&quot;, attachments.length &gt; 0)) {</span>
<a href="#l12.11"></a><span id="l12.11">                 displayElement(&quot;calendar-task-details-attachment-rows&quot;, true);</span>
<a href="#l12.12"></a><span id="l12.12" class="difflineminus">-                for each (let attachment in attachments) {</span>
<a href="#l12.13"></a><span id="l12.13" class="difflineplus">+                for (let attachment of attachments) {</span>
<a href="#l12.14"></a><span id="l12.14">                     let url = attachment.calIAttachment.uri.spec</span>
<a href="#l12.15"></a><span id="l12.15">                     let urlLabel = createXULElement(&quot;label&quot;);</span>
<a href="#l12.16"></a><span id="l12.16">                     urlLabel.setAttribute(&quot;value&quot;, url);</span>
<a href="#l12.17"></a><span id="l12.17">                     urlLabel.setAttribute(&quot;tooltiptext&quot;, url);</span>
<a href="#l12.18"></a><span id="l12.18">                     urlLabel.setAttribute(&quot;class&quot;, &quot;text-link&quot;);</span>
<a href="#l12.19"></a><span id="l12.19">                     urlLabel.setAttribute(&quot;crop&quot;, &quot;end&quot;);</span>
<a href="#l12.20"></a><span id="l12.20">                     urlLabel.setAttribute(&quot;onclick&quot;,</span>
<a href="#l12.21"></a><span id="l12.21">                                           &quot;if (event.button != 2) launchBrowser(this.value);&quot;);</span>
<a href="#l12.22"></a><span id="l12.22" class="difflineat">@@ -152,21 +152,21 @@ var taskDetailsView = {</span>
<a href="#l12.23"></a><span id="l12.23">         panel.loadItem(item);</span>
<a href="#l12.24"></a><span id="l12.24">     },</span>
<a href="#l12.25"></a><span id="l12.25"> </span>
<a href="#l12.26"></a><span id="l12.26">     saveCategories: function saveCategories(event) {</span>
<a href="#l12.27"></a><span id="l12.27">         let panel = event.target;</span>
<a href="#l12.28"></a><span id="l12.28">         let item = document.getElementById(&quot;calendar-task-tree&quot;).currentTask;</span>
<a href="#l12.29"></a><span id="l12.29">         let categoriesMap = {};</span>
<a href="#l12.30"></a><span id="l12.30"> </span>
<a href="#l12.31"></a><span id="l12.31" class="difflineminus">-        for each (let cat in item.getCategories({})) {</span>
<a href="#l12.32"></a><span id="l12.32" class="difflineplus">+        for (let cat of item.getCategories({})) {</span>
<a href="#l12.33"></a><span id="l12.33">             categoriesMap[cat] = true;</span>
<a href="#l12.34"></a><span id="l12.34">         }</span>
<a href="#l12.35"></a><span id="l12.35"> </span>
<a href="#l12.36"></a><span id="l12.36" class="difflineminus">-        for each (let cat in panel.categories) {</span>
<a href="#l12.37"></a><span id="l12.37" class="difflineplus">+        for (let cat of panel.categories) {</span>
<a href="#l12.38"></a><span id="l12.38">             if (cat in categoriesMap) {</span>
<a href="#l12.39"></a><span id="l12.39">                 delete categoriesMap[cat];</span>
<a href="#l12.40"></a><span id="l12.40">             } else {</span>
<a href="#l12.41"></a><span id="l12.41">                 categoriesMap[cat] = false;</span>
<a href="#l12.42"></a><span id="l12.42">             }</span>
<a href="#l12.43"></a><span id="l12.43">         }</span>
<a href="#l12.44"></a><span id="l12.44"> </span>
<a href="#l12.45"></a><span id="l12.45">         if (categoriesMap.toSource() != &quot;({})&quot;) {</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l13.1"></a><span id="l13.1" class="difflineminus">--- a/calendar/base/content/calendar-ui-utils.js</span>
<a href="#l13.2"></a><span id="l13.2" class="difflineplus">+++ b/calendar/base/content/calendar-ui-utils.js</span>
<a href="#l13.3"></a><span id="l13.3" class="difflineat">@@ -530,17 +530,17 @@ function createXULElement(el) {</span>
<a href="#l13.4"></a><span id="l13.4">  * @param aXULElement   The xul element to be inspected.</span>
<a href="#l13.5"></a><span id="l13.5">  * @param aStyleProps   The css style properties for which values are to be retrieved</span>
<a href="#l13.6"></a><span id="l13.6">  *                        e.g. 'font-size', 'min-width&quot; etc.</span>
<a href="#l13.7"></a><span id="l13.7">  * @return              An integer value denoting the optimal minimum width</span>
<a href="#l13.8"></a><span id="l13.8">  */</span>
<a href="#l13.9"></a><span id="l13.9"> function getSummarizedStyleValues(aXULElement, aStyleProps) {</span>
<a href="#l13.10"></a><span id="l13.10">     var retValue = 0;</span>
<a href="#l13.11"></a><span id="l13.11">     var cssStyleDeclares = document.defaultView.getComputedStyle(aXULElement, null);</span>
<a href="#l13.12"></a><span id="l13.12" class="difflineminus">-    for each (var prop in aStyleProps) {</span>
<a href="#l13.13"></a><span id="l13.13" class="difflineplus">+    for (var prop of aStyleProps) {</span>
<a href="#l13.14"></a><span id="l13.14">         retValue += parseInt(cssStyleDeclares.getPropertyValue(prop), 10);</span>
<a href="#l13.15"></a><span id="l13.15">     }</span>
<a href="#l13.16"></a><span id="l13.16">     return retValue;</span>
<a href="#l13.17"></a><span id="l13.17"> }</span>
<a href="#l13.18"></a><span id="l13.18"> </span>
<a href="#l13.19"></a><span id="l13.19"> /**</span>
<a href="#l13.20"></a><span id="l13.20">  * Calculates the optimal minimum width based on the set css style-rules</span>
<a href="#l13.21"></a><span id="l13.21">  * by considering the css rules for the min-width, padding, border, margin</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l14.1"></a><span id="l14.1" class="difflineminus">--- a/calendar/base/content/calendar-unifinder.js</span>
<a href="#l14.2"></a><span id="l14.2" class="difflineplus">+++ b/calendar/base/content/calendar-unifinder.js</span>
<a href="#l14.3"></a><span id="l14.3" class="difflineat">@@ -409,17 +409,17 @@ var unifinderTreeView = {</span>
<a href="#l14.4"></a><span id="l14.4">     },</span>
<a href="#l14.5"></a><span id="l14.5"> </span>
<a href="#l14.6"></a><span id="l14.6">     /**</span>
<a href="#l14.7"></a><span id="l14.7">      * Sets the currently selected column in the unifinder (used for sorting).</span>
<a href="#l14.8"></a><span id="l14.8">      */</span>
<a href="#l14.9"></a><span id="l14.9">     set selectedColumn(aCol) {</span>
<a href="#l14.10"></a><span id="l14.10">         let tree = document.getElementById(&quot;unifinder-search-results-tree&quot;);</span>
<a href="#l14.11"></a><span id="l14.11">         let treecols = tree.getElementsByTagName(&quot;treecol&quot;);</span>
<a href="#l14.12"></a><span id="l14.12" class="difflineminus">-        for each (let col in Array.slice(treecols)) {</span>
<a href="#l14.13"></a><span id="l14.13" class="difflineplus">+        for (let col of treecols) {</span>
<a href="#l14.14"></a><span id="l14.14">             if (col.getAttribute(&quot;sortActive&quot;)) {</span>
<a href="#l14.15"></a><span id="l14.15">                   col.removeAttribute(&quot;sortActive&quot;);</span>
<a href="#l14.16"></a><span id="l14.16">                   col.removeAttribute(&quot;sortDirection&quot;);</span>
<a href="#l14.17"></a><span id="l14.17">             }</span>
<a href="#l14.18"></a><span id="l14.18">             if (aCol.getAttribute(&quot;itemproperty&quot;) == col.getAttribute(&quot;itemproperty&quot;)) {</span>
<a href="#l14.19"></a><span id="l14.19">                 col.setAttribute(&quot;sortActive&quot;, &quot;true&quot;);</span>
<a href="#l14.20"></a><span id="l14.20">                 col.setAttribute(&quot;sortDirection&quot;, this.sortDirection);</span>
<a href="#l14.21"></a><span id="l14.21">             }</span>
<a href="#l14.22"></a><span id="l14.22" class="difflineat">@@ -459,17 +459,17 @@ var unifinderTreeView = {</span>
<a href="#l14.23"></a><span id="l14.23">      */</span>
<a href="#l14.24"></a><span id="l14.24">     removeItems: function uTV_removeItems(aItemArray) {</span>
<a href="#l14.25"></a><span id="l14.25">         let indexesToRemove = [];</span>
<a href="#l14.26"></a><span id="l14.26">         // Removing items is a bit tricky. Our getItemRow function takes the</span>
<a href="#l14.27"></a><span id="l14.27">         // index from a cached map, so removing an item from the array will</span>
<a href="#l14.28"></a><span id="l14.28">         // remove the wrong indexes. We don't want to just invalidate the map,</span>
<a href="#l14.29"></a><span id="l14.29">         // since this will cause O(n^2) behavior. Instead, we keep a sorted</span>
<a href="#l14.30"></a><span id="l14.30">         // array of the indexes to remove:</span>
<a href="#l14.31"></a><span id="l14.31" class="difflineminus">-        for each (let item in aItemArray) {</span>
<a href="#l14.32"></a><span id="l14.32" class="difflineplus">+        for (let item of aItemArray) {</span>
<a href="#l14.33"></a><span id="l14.33">             let row = this.getItemRow(item);</span>
<a href="#l14.34"></a><span id="l14.34">             if (row &gt; -1) {</span>
<a href="#l14.35"></a><span id="l14.35">                 if (!indexesToRemove.length || row &lt;= indexesToRemove[0]) {</span>
<a href="#l14.36"></a><span id="l14.36">                     indexesToRemove.unshift(row);</span>
<a href="#l14.37"></a><span id="l14.37">                 } else {</span>
<a href="#l14.38"></a><span id="l14.38">                     indexesToRemove.push(row);</span>
<a href="#l14.39"></a><span id="l14.39">                 }</span>
<a href="#l14.40"></a><span id="l14.40">             }</span>
<a href="#l14.41"></a><span id="l14.41" class="difflineat">@@ -628,17 +628,17 @@ var unifinderTreeView = {</span>
<a href="#l14.42"></a><span id="l14.42">             // If only one item is selected, scroll to it</span>
<a href="#l14.43"></a><span id="l14.43">             let rowToScrollTo = this.getItemRow(aItemArray[0]);</span>
<a href="#l14.44"></a><span id="l14.44">             if (rowToScrollTo &gt; -1) {</span>
<a href="#l14.45"></a><span id="l14.45">                this.tree.ensureRowIsVisible(rowToScrollTo);</span>
<a href="#l14.46"></a><span id="l14.46">                this.tree.view.selection.select(rowToScrollTo);</span>
<a href="#l14.47"></a><span id="l14.47">             }</span>
<a href="#l14.48"></a><span id="l14.48">         } else if (aItemArray &amp;&amp; aItemArray.length &gt; 1) {</span>
<a href="#l14.49"></a><span id="l14.49">             // If there is more than one item, just select them all.</span>
<a href="#l14.50"></a><span id="l14.50" class="difflineminus">-            for each (let item in aItemArray) {</span>
<a href="#l14.51"></a><span id="l14.51" class="difflineplus">+            for (let item of aItemArray) {</span>
<a href="#l14.52"></a><span id="l14.52">                 let row = this.getItemRow(item);</span>
<a href="#l14.53"></a><span id="l14.53">                 this.tree.view.selection.rangedSelect(row, row, true);</span>
<a href="#l14.54"></a><span id="l14.54">             }</span>
<a href="#l14.55"></a><span id="l14.55">         }</span>
<a href="#l14.56"></a><span id="l14.56"> </span>
<a href="#l14.57"></a><span id="l14.57">         // This needs to be in a setTimeout</span>
<a href="#l14.58"></a><span id="l14.58">         setTimeout(function() { unifinderTreeView.resetAllowSelection(); }, 1);</span>
<a href="#l14.59"></a><span id="l14.59">     },</span>
<a href="#l14.60"></a><span id="l14.60" class="difflineat">@@ -921,18 +921,17 @@ function addItemsFromCalendar(aCalendar,</span>
<a href="#l14.61"></a><span id="l14.61">                        0,</span>
<a href="#l14.62"></a><span id="l14.62">                        unifinderTreeView.mFilter.startDate,</span>
<a href="#l14.63"></a><span id="l14.63">                        unifinderTreeView.mFilter.endDate,</span>
<a href="#l14.64"></a><span id="l14.64">                        refreshListener);</span>
<a href="#l14.65"></a><span id="l14.65"> }</span>
<a href="#l14.66"></a><span id="l14.66"> </span>
<a href="#l14.67"></a><span id="l14.67"> function deleteItemsFromCalendar(aCalendar) {</span>
<a href="#l14.68"></a><span id="l14.68">     let filter = unifinderTreeView.mFilter;</span>
<a href="#l14.69"></a><span id="l14.69" class="difflineminus">-    let items = [ item for each (item in unifinderTreeView.eventArray)</span>
<a href="#l14.70"></a><span id="l14.70" class="difflineminus">-                    if (item.calendar.id == aCalendar.id) ];</span>
<a href="#l14.71"></a><span id="l14.71" class="difflineplus">+    let items = unifinderTreeView.eventArray.filter(item =&gt; item.calendar.id == aCalendar.id);</span>
<a href="#l14.72"></a><span id="l14.72"> </span>
<a href="#l14.73"></a><span id="l14.73">     unifinderTreeView.removeItems(items.filter(filter.isItemInFilters, filter));</span>
<a href="#l14.74"></a><span id="l14.74"> }</span>
<a href="#l14.75"></a><span id="l14.75"> </span>
<a href="#l14.76"></a><span id="l14.76"> /**</span>
<a href="#l14.77"></a><span id="l14.77">  * Focuses the unifinder search field</span>
<a href="#l14.78"></a><span id="l14.78">  */</span>
<a href="#l14.79"></a><span id="l14.79"> function focusSearch() {</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l15.1"></a><span id="l15.1" class="difflineminus">--- a/calendar/base/content/calendar-views.js</span>
<a href="#l15.2"></a><span id="l15.2" class="difflineplus">+++ b/calendar/base/content/calendar-views.js</span>
<a href="#l15.3"></a><span id="l15.3" class="difflineat">@@ -111,17 +111,17 @@ var calendarViewController = {</span>
<a href="#l15.4"></a><span id="l15.4">         // Make sure we are modifying a copy of aOccurrences, otherwise we will</span>
<a href="#l15.5"></a><span id="l15.5">         // run into race conditions when the view's doDeleteItem removes the</span>
<a href="#l15.6"></a><span id="l15.6">         // array elements while we are iterating through them. While we are at</span>
<a href="#l15.7"></a><span id="l15.7">         // it, filter out any items that have readonly calendars, so that</span>
<a href="#l15.8"></a><span id="l15.8">         // checking for one total item below also works out if all but one item</span>
<a href="#l15.9"></a><span id="l15.9">         // are readonly.</span>
<a href="#l15.10"></a><span id="l15.10">         var occurrences = aOccurrences.filter(function(item) { return isCalendarWritable(item.calendar); });</span>
<a href="#l15.11"></a><span id="l15.11"> </span>
<a href="#l15.12"></a><span id="l15.12" class="difflineminus">-        for each (var itemToDelete in occurrences) {</span>
<a href="#l15.13"></a><span id="l15.13" class="difflineplus">+        for (var itemToDelete of occurrences) {</span>
<a href="#l15.14"></a><span id="l15.14">             if (aUseParentItems) {</span>
<a href="#l15.15"></a><span id="l15.15">                 // Usually happens when ctrl-click is used. In that case we</span>
<a href="#l15.16"></a><span id="l15.16">                 // don't need to ask the user if he wants to delete an</span>
<a href="#l15.17"></a><span id="l15.17">                 // occurrence or not.</span>
<a href="#l15.18"></a><span id="l15.18">                 itemToDelete = itemToDelete.parentItem;</span>
<a href="#l15.19"></a><span id="l15.19">             } else if (!aDoNotConfirm &amp;&amp; occurrences.length == 1) {</span>
<a href="#l15.20"></a><span id="l15.20">                 // Only give the user the selection if only one occurrence is</span>
<a href="#l15.21"></a><span id="l15.21">                 // selected. Otherwise he will get a dialog for each occurrence</span>
<a href="#l15.22"></a><span id="l15.22" class="difflineat">@@ -145,17 +145,18 @@ var calendarViewController = {</span>
<a href="#l15.23"></a><span id="l15.23">                 // parent item gets modified more than once.</span>
<a href="#l15.24"></a><span id="l15.24">             } else {</span>
<a href="#l15.25"></a><span id="l15.25">                 doTransaction('delete', itemToDelete, itemToDelete.calendar, null, null);</span>
<a href="#l15.26"></a><span id="l15.26">             }</span>
<a href="#l15.27"></a><span id="l15.27">         }</span>
<a href="#l15.28"></a><span id="l15.28"> </span>
<a href="#l15.29"></a><span id="l15.29">         // Now handle recurring events. This makes sure that all occurrences</span>
<a href="#l15.30"></a><span id="l15.30">         // that have been passed are deleted.</span>
<a href="#l15.31"></a><span id="l15.31" class="difflineminus">-        for each (var ritem in recurringItems) {</span>
<a href="#l15.32"></a><span id="l15.32" class="difflineplus">+        for (var hashVal in recurringItems) {</span>
<a href="#l15.33"></a><span id="l15.33" class="difflineplus">+            let ritem = recurringItems[hashVal];</span>
<a href="#l15.34"></a><span id="l15.34">             doTransaction('modify',</span>
<a href="#l15.35"></a><span id="l15.35">                           ritem.newItem,</span>
<a href="#l15.36"></a><span id="l15.36">                           ritem.newItem.calendar,</span>
<a href="#l15.37"></a><span id="l15.37">                           ritem.oldItem,</span>
<a href="#l15.38"></a><span id="l15.38">                           null);</span>
<a href="#l15.39"></a><span id="l15.39">         }</span>
<a href="#l15.40"></a><span id="l15.40">         endBatchTransaction();</span>
<a href="#l15.41"></a><span id="l15.41">     }</span>
<a href="#l15.42"></a><span id="l15.42" class="difflineat">@@ -342,17 +343,17 @@ function scheduleMidnightUpdate(aRefresh</span>
<a href="#l15.43"></a><span id="l15.43"> /**</span>
<a href="#l15.44"></a><span id="l15.44">  * Retuns a cached copy of the view stylesheet.</span>
<a href="#l15.45"></a><span id="l15.45">  *</span>
<a href="#l15.46"></a><span id="l15.46">  * @return      The view stylesheet object.</span>
<a href="#l15.47"></a><span id="l15.47">  */</span>
<a href="#l15.48"></a><span id="l15.48"> function getViewStyleSheet() {</span>
<a href="#l15.49"></a><span id="l15.49">   if (!getViewStyleSheet.sheet) {</span>
<a href="#l15.50"></a><span id="l15.50">       const cssUri = &quot;chrome://calendar/content/calendar-view-bindings.css&quot;;</span>
<a href="#l15.51"></a><span id="l15.51" class="difflineminus">-      for each (let sheet in document.styleSheets) {</span>
<a href="#l15.52"></a><span id="l15.52" class="difflineplus">+      for (let sheet of document.styleSheets) {</span>
<a href="#l15.53"></a><span id="l15.53">           if (sheet.href == cssUri) {</span>
<a href="#l15.54"></a><span id="l15.54">               getViewStyleSheet.sheet = sheet;</span>
<a href="#l15.55"></a><span id="l15.55">               break;</span>
<a href="#l15.56"></a><span id="l15.56">           }</span>
<a href="#l15.57"></a><span id="l15.57">       }</span>
<a href="#l15.58"></a><span id="l15.58">   }</span>
<a href="#l15.59"></a><span id="l15.59">   return getViewStyleSheet.sheet;</span>
<a href="#l15.60"></a><span id="l15.60"> }</span>
<a href="#l15.61"></a><span id="l15.61" class="difflineat">@@ -510,17 +511,17 @@ function getMinimonth() {</span>
<a href="#l15.62"></a><span id="l15.62">  * Update the view orientation based on the checked state of the command</span>
<a href="#l15.63"></a><span id="l15.63">  */</span>
<a href="#l15.64"></a><span id="l15.64"> function toggleOrientation() {</span>
<a href="#l15.65"></a><span id="l15.65">     var cmd = document.getElementById(&quot;calendar_toggle_orientation_command&quot;);</span>
<a href="#l15.66"></a><span id="l15.66">     var newValue = (cmd.getAttribute(&quot;checked&quot;) == &quot;true&quot; ? &quot;false&quot; : &quot;true&quot;);</span>
<a href="#l15.67"></a><span id="l15.67">     cmd.setAttribute(&quot;checked&quot;, newValue);</span>
<a href="#l15.68"></a><span id="l15.68"> </span>
<a href="#l15.69"></a><span id="l15.69">     var deck = getViewDeck();</span>
<a href="#l15.70"></a><span id="l15.70" class="difflineminus">-    for each (var view in deck.childNodes) {</span>
<a href="#l15.71"></a><span id="l15.71" class="difflineplus">+    for (var view of deck.childNodes) {</span>
<a href="#l15.72"></a><span id="l15.72">         view.rotated = (newValue == &quot;true&quot;);</span>
<a href="#l15.73"></a><span id="l15.73">     }</span>
<a href="#l15.74"></a><span id="l15.74"> </span>
<a href="#l15.75"></a><span id="l15.75">     // orientation refreshes automatically</span>
<a href="#l15.76"></a><span id="l15.76"> }</span>
<a href="#l15.77"></a><span id="l15.77"> </span>
<a href="#l15.78"></a><span id="l15.78"> /**</span>
<a href="#l15.79"></a><span id="l15.79">  * Toggle the workdays only checkbox and refresh the current view</span>
<a href="#l15.80"></a><span id="l15.80" class="difflineat">@@ -529,51 +530,51 @@ function toggleOrientation() {</span>
<a href="#l15.81"></a><span id="l15.81">  * should happen automatically.</span>
<a href="#l15.82"></a><span id="l15.82">  */</span>
<a href="#l15.83"></a><span id="l15.83"> function toggleWorkdaysOnly() {</span>
<a href="#l15.84"></a><span id="l15.84">     var cmd = document.getElementById(&quot;calendar_toggle_workdays_only_command&quot;);</span>
<a href="#l15.85"></a><span id="l15.85">     var newValue = (cmd.getAttribute(&quot;checked&quot;) == &quot;true&quot; ? &quot;false&quot; : &quot;true&quot;);</span>
<a href="#l15.86"></a><span id="l15.86">     cmd.setAttribute(&quot;checked&quot;, newValue);</span>
<a href="#l15.87"></a><span id="l15.87"> </span>
<a href="#l15.88"></a><span id="l15.88">     var deck = getViewDeck();</span>
<a href="#l15.89"></a><span id="l15.89" class="difflineminus">-    for each (var view in deck.childNodes) {</span>
<a href="#l15.90"></a><span id="l15.90" class="difflineplus">+    for (var view of deck.childNodes) {</span>
<a href="#l15.91"></a><span id="l15.91">         view.workdaysOnly = (newValue == &quot;true&quot;);</span>
<a href="#l15.92"></a><span id="l15.92">     }</span>
<a href="#l15.93"></a><span id="l15.93"> </span>
<a href="#l15.94"></a><span id="l15.94">     // Refresh the current view</span>
<a href="#l15.95"></a><span id="l15.95">     currentView().goToDay();</span>
<a href="#l15.96"></a><span id="l15.96"> }</span>
<a href="#l15.97"></a><span id="l15.97"> </span>
<a href="#l15.98"></a><span id="l15.98"> /**</span>
<a href="#l15.99"></a><span id="l15.99">  * Toggle the tasks in view checkbox and refresh the current view</span>
<a href="#l15.100"></a><span id="l15.100">  */</span>
<a href="#l15.101"></a><span id="l15.101"> function toggleTasksInView() {</span>
<a href="#l15.102"></a><span id="l15.102">     var cmd = document.getElementById(&quot;calendar_toggle_tasks_in_view_command&quot;);</span>
<a href="#l15.103"></a><span id="l15.103">     var newValue = (cmd.getAttribute(&quot;checked&quot;) == &quot;true&quot; ? &quot;false&quot; : &quot;true&quot;);</span>
<a href="#l15.104"></a><span id="l15.104">     cmd.setAttribute(&quot;checked&quot;, newValue);</span>
<a href="#l15.105"></a><span id="l15.105"> </span>
<a href="#l15.106"></a><span id="l15.106">     var deck = getViewDeck();</span>
<a href="#l15.107"></a><span id="l15.107" class="difflineminus">-    for each (var view in deck.childNodes) {</span>
<a href="#l15.108"></a><span id="l15.108" class="difflineplus">+    for (var view of deck.childNodes) {</span>
<a href="#l15.109"></a><span id="l15.109">         view.tasksInView = (newValue == &quot;true&quot;);</span>
<a href="#l15.110"></a><span id="l15.110">     }</span>
<a href="#l15.111"></a><span id="l15.111"> </span>
<a href="#l15.112"></a><span id="l15.112">     // Refresh the current view</span>
<a href="#l15.113"></a><span id="l15.113">     currentView().goToDay();</span>
<a href="#l15.114"></a><span id="l15.114"> }</span>
<a href="#l15.115"></a><span id="l15.115"> </span>
<a href="#l15.116"></a><span id="l15.116"> /**</span>
<a href="#l15.117"></a><span id="l15.117">  * Toggle the show completed in view checkbox and refresh the current view</span>
<a href="#l15.118"></a><span id="l15.118">  */</span>
<a href="#l15.119"></a><span id="l15.119"> function toggleShowCompletedInView() {</span>
<a href="#l15.120"></a><span id="l15.120">     var cmd = document.getElementById(&quot;calendar_toggle_show_completed_in_view_command&quot;);</span>
<a href="#l15.121"></a><span id="l15.121">     var newValue = (cmd.getAttribute(&quot;checked&quot;) == &quot;true&quot; ? &quot;false&quot; : &quot;true&quot;);</span>
<a href="#l15.122"></a><span id="l15.122">     cmd.setAttribute(&quot;checked&quot;, newValue);</span>
<a href="#l15.123"></a><span id="l15.123"> </span>
<a href="#l15.124"></a><span id="l15.124">     var deck = getViewDeck();</span>
<a href="#l15.125"></a><span id="l15.125" class="difflineminus">-    for each (var view in deck.childNodes) {</span>
<a href="#l15.126"></a><span id="l15.126" class="difflineplus">+    for (var view of deck.childNodes) {</span>
<a href="#l15.127"></a><span id="l15.127">         view.showCompleted = (newValue == &quot;true&quot;);</span>
<a href="#l15.128"></a><span id="l15.128">     }</span>
<a href="#l15.129"></a><span id="l15.129"> </span>
<a href="#l15.130"></a><span id="l15.130">     // Refresh the current view</span>
<a href="#l15.131"></a><span id="l15.131">     currentView().goToDay();</span>
<a href="#l15.132"></a><span id="l15.132"> }</span>
<a href="#l15.133"></a><span id="l15.133"> </span>
<a href="#l15.134"></a><span id="l15.134"> /**</span>
<a href="#l15.135"></a><span id="l15.135" class="difflineat">@@ -635,17 +636,17 @@ function selectAllEvents() {</span>
<a href="#l15.136"></a><span id="l15.136">         QueryInterface: XPCOMUtils.generateQI([Components.interfaces.calIOperationListener]),</span>
<a href="#l15.137"></a><span id="l15.137">         onOperationComplete: function selectAll_ooc(aCalendar, aStatus,</span>
<a href="#l15.138"></a><span id="l15.138">                                                     aOperationType, aId,</span>
<a href="#l15.139"></a><span id="l15.139">                                                     aDetail) {</span>
<a href="#l15.140"></a><span id="l15.140">             currentView().setSelectedItems(items.length, items, false);</span>
<a href="#l15.141"></a><span id="l15.141">         },</span>
<a href="#l15.142"></a><span id="l15.142">         onGetResult: function selectAll_ogr(aCalendar, aStatus, aItemType,</span>
<a href="#l15.143"></a><span id="l15.143">                                             aDetail, aCount, aItems) {</span>
<a href="#l15.144"></a><span id="l15.144" class="difflineminus">-            for each (var item in aItems) {</span>
<a href="#l15.145"></a><span id="l15.145" class="difflineplus">+            for (var item of aItems) {</span>
<a href="#l15.146"></a><span id="l15.146">                 items.push(item);</span>
<a href="#l15.147"></a><span id="l15.147">             }</span>
<a href="#l15.148"></a><span id="l15.148">         }</span>
<a href="#l15.149"></a><span id="l15.149">     };</span>
<a href="#l15.150"></a><span id="l15.150"> </span>
<a href="#l15.151"></a><span id="l15.151">     var composite = getCompositeCalendar();</span>
<a href="#l15.152"></a><span id="l15.152">     var filter = composite.ITEM_FILTER_CLASS_OCCURRENCES;</span>
<a href="#l15.153"></a><span id="l15.153"> </span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l16.1"></a><span id="l16.1" class="difflineminus">--- a/calendar/base/content/dialogs/calendar-alarm-dialog.js</span>
<a href="#l16.2"></a><span id="l16.2" class="difflineplus">+++ b/calendar/base/content/dialogs/calendar-alarm-dialog.js</span>
<a href="#l16.3"></a><span id="l16.3" class="difflineat">@@ -47,17 +47,17 @@ function onDismissAlarm(event) {</span>
<a href="#l16.4"></a><span id="l16.4">  * Called to dismiss all alarms in the alarm window.</span>
<a href="#l16.5"></a><span id="l16.5">  */</span>
<a href="#l16.6"></a><span id="l16.6"> function onDismissAllAlarms() {</span>
<a href="#l16.7"></a><span id="l16.7">     // removes widgets on the fly:</span>
<a href="#l16.8"></a><span id="l16.8">     let alarmRichlist = document.getElementById(&quot;alarm-richlist&quot;);</span>
<a href="#l16.9"></a><span id="l16.9">     let parentItems = {};</span>
<a href="#l16.10"></a><span id="l16.10"> </span>
<a href="#l16.11"></a><span id="l16.11">     // Make a copy of the child nodes as they get modified live</span>
<a href="#l16.12"></a><span id="l16.12" class="difflineminus">-    for each (let node in Array.slice(alarmRichlist.childNodes)) {</span>
<a href="#l16.13"></a><span id="l16.13" class="difflineplus">+    for (let node of alarmRichlist.childNodes) {</span>
<a href="#l16.14"></a><span id="l16.14">         // Check if the node is a valid alarm and is still part of DOM</span>
<a href="#l16.15"></a><span id="l16.15">         if (node.parentNode &amp;&amp; node.item &amp;&amp; node.alarm &amp;&amp;</span>
<a href="#l16.16"></a><span id="l16.16">             !(node.item.parentItem.hashId in parentItems)) {</span>
<a href="#l16.17"></a><span id="l16.17">             // We only need to acknowledge one occurrence for repeating items</span>
<a href="#l16.18"></a><span id="l16.18">             parentItems[node.item.parentItem.hashId] = node.item.parentItem;</span>
<a href="#l16.19"></a><span id="l16.19">             getAlarmService().dismissAlarm(node.item, node.alarm);</span>
<a href="#l16.20"></a><span id="l16.20">         }</span>
<a href="#l16.21"></a><span id="l16.21">     }</span>
<a href="#l16.22"></a><span id="l16.22" class="difflineat">@@ -135,17 +135,17 @@ function onFocusWindow() {</span>
<a href="#l16.23"></a><span id="l16.23">     }</span>
<a href="#l16.24"></a><span id="l16.24"> }</span>
<a href="#l16.25"></a><span id="l16.25"> </span>
<a href="#l16.26"></a><span id="l16.26"> /**</span>
<a href="#l16.27"></a><span id="l16.27">  * Timer callback to update all relative date labels</span>
<a href="#l16.28"></a><span id="l16.28">  */</span>
<a href="#l16.29"></a><span id="l16.29"> function updateRelativeDates() {</span>
<a href="#l16.30"></a><span id="l16.30">     let alarmRichlist = document.getElementById(&quot;alarm-richlist&quot;);</span>
<a href="#l16.31"></a><span id="l16.31" class="difflineminus">-    for each (let node in Array.slice(alarmRichlist.childNodes)) {</span>
<a href="#l16.32"></a><span id="l16.32" class="difflineplus">+    for (let node of alarmRichlist.childNodes) {</span>
<a href="#l16.33"></a><span id="l16.33">         if (node.item &amp;&amp; node.alarm) {</span>
<a href="#l16.34"></a><span id="l16.34">             node.updateRelativeDateLabel();</span>
<a href="#l16.35"></a><span id="l16.35">         }</span>
<a href="#l16.36"></a><span id="l16.36">     }</span>
<a href="#l16.37"></a><span id="l16.37"> }</span>
<a href="#l16.38"></a><span id="l16.38"> </span>
<a href="#l16.39"></a><span id="l16.39"> /**</span>
<a href="#l16.40"></a><span id="l16.40">  * Function to snooze all alarms the given number of minutes.</span>
<a href="#l16.41"></a><span id="l16.41" class="difflineat">@@ -156,17 +156,17 @@ function snoozeAllItems(aDurationMinutes</span>
<a href="#l16.42"></a><span id="l16.42">     let duration = cal.createDuration();</span>
<a href="#l16.43"></a><span id="l16.43">     duration.minutes = aDurationMinutes;</span>
<a href="#l16.44"></a><span id="l16.44">     duration.normalize();</span>
<a href="#l16.45"></a><span id="l16.45"> </span>
<a href="#l16.46"></a><span id="l16.46">     let alarmRichlist = document.getElementById(&quot;alarm-richlist&quot;);</span>
<a href="#l16.47"></a><span id="l16.47">     let parentItems = {};</span>
<a href="#l16.48"></a><span id="l16.48"> </span>
<a href="#l16.49"></a><span id="l16.49">     // Make a copy of the child nodes as they get modified live</span>
<a href="#l16.50"></a><span id="l16.50" class="difflineminus">-    for each (let node in Array.slice(alarmRichlist.childNodes)) {</span>
<a href="#l16.51"></a><span id="l16.51" class="difflineplus">+    for (let node of alarmRichlist.childNodes) {</span>
<a href="#l16.52"></a><span id="l16.52">         // Check if the node is a valid alarm and is still part of DOM</span>
<a href="#l16.53"></a><span id="l16.53">         if (node.parentNode &amp;&amp; node.item &amp;&amp; node.alarm &amp;&amp;</span>
<a href="#l16.54"></a><span id="l16.54">             !(node.item.parentItem.hashId in parentItems)) {</span>
<a href="#l16.55"></a><span id="l16.55">             // We only need to acknowledge one occurrence for repeating items</span>
<a href="#l16.56"></a><span id="l16.56">             parentItems[node.item.parentItem.hashId] = node.item.parentItem;</span>
<a href="#l16.57"></a><span id="l16.57">             getAlarmService().snoozeAlarm(node.item, node.alarm, duration);</span>
<a href="#l16.58"></a><span id="l16.58">         }</span>
<a href="#l16.59"></a><span id="l16.59">     }</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l17.1"></a><span id="l17.1" class="difflineminus">--- a/calendar/base/content/dialogs/calendar-dialog-utils.js</span>
<a href="#l17.2"></a><span id="l17.2" class="difflineplus">+++ b/calendar/base/content/dialogs/calendar-dialog-utils.js</span>
<a href="#l17.3"></a><span id="l17.3" class="difflineat">@@ -124,17 +124,17 @@ function updateReminderDetails() {</span>
<a href="#l17.4"></a><span id="l17.4">     let reminderList = document.getElementById(&quot;item-alarm&quot;);</span>
<a href="#l17.5"></a><span id="l17.5">     let reminderMultipleLabel = document.getElementById(&quot;reminder-multiple-alarms-label&quot;);</span>
<a href="#l17.6"></a><span id="l17.6">     let iconBox = document.getElementById(&quot;reminder-icon-box&quot;);</span>
<a href="#l17.7"></a><span id="l17.7">     let reminderSingleLabel = document.getElementById(&quot;reminder-single-alarms-label&quot;);</span>
<a href="#l17.8"></a><span id="l17.8">     let reminders = document.getElementById(&quot;reminder-custom-menuitem&quot;).reminders || [];</span>
<a href="#l17.9"></a><span id="l17.9">     let calendar = getCurrentCalendar();</span>
<a href="#l17.10"></a><span id="l17.10">     let actionValues = calendar.getProperty(&quot;capabilities.alarms.actionValues&quot;) || [&quot;DISPLAY&quot;];</span>
<a href="#l17.11"></a><span id="l17.11">     let actionMap = {};</span>
<a href="#l17.12"></a><span id="l17.12" class="difflineminus">-    for each (var action in actionValues) {</span>
<a href="#l17.13"></a><span id="l17.13" class="difflineplus">+    for (var action of actionValues) {</span>
<a href="#l17.14"></a><span id="l17.14">         actionMap[action] = true;</span>
<a href="#l17.15"></a><span id="l17.15">     }</span>
<a href="#l17.16"></a><span id="l17.16"> </span>
<a href="#l17.17"></a><span id="l17.17">     // Filter out any unsupported action types.</span>
<a href="#l17.18"></a><span id="l17.18">     reminders = reminders.filter(x =&gt; x.action in actionMap);</span>
<a href="#l17.19"></a><span id="l17.19"> </span>
<a href="#l17.20"></a><span id="l17.20">     if (reminderList.value == &quot;custom&quot;) {</span>
<a href="#l17.21"></a><span id="l17.21">         // Depending on how many alarms we have, show either the &quot;Multiple Alarms&quot;</span>
<a href="#l17.22"></a><span id="l17.22" class="difflineat">@@ -192,17 +192,17 @@ function matchCustomReminderToMenuitem(r</span>
<a href="#l17.23"></a><span id="l17.23">         }</span>
<a href="#l17.24"></a><span id="l17.24"> </span>
<a href="#l17.25"></a><span id="l17.25">         let unitMap = {</span>
<a href="#l17.26"></a><span id="l17.26">           days: 86400,</span>
<a href="#l17.27"></a><span id="l17.27">           hours: 3600,</span>
<a href="#l17.28"></a><span id="l17.28">           minutes: 60</span>
<a href="#l17.29"></a><span id="l17.29">         };</span>
<a href="#l17.30"></a><span id="l17.30"> </span>
<a href="#l17.31"></a><span id="l17.31" class="difflineminus">-        for each (let menuitem in Array.slice(reminderPopup.childNodes)) {</span>
<a href="#l17.32"></a><span id="l17.32" class="difflineplus">+        for (let menuitem of reminderPopup.childNodes) {</span>
<a href="#l17.33"></a><span id="l17.33">             if (menuitem.localName == &quot;menuitem&quot; &amp;&amp;</span>
<a href="#l17.34"></a><span id="l17.34">                 menuitem.hasAttribute(&quot;length&quot;) &amp;&amp;</span>
<a href="#l17.35"></a><span id="l17.35">                 menuitem.getAttribute(&quot;origin&quot;) == origin &amp;&amp;</span>
<a href="#l17.36"></a><span id="l17.36">                 menuitem.getAttribute(&quot;relation&quot;) == relation) {</span>
<a href="#l17.37"></a><span id="l17.37">                 let unitMult = unitMap[menuitem.getAttribute(&quot;unit&quot;)] || 1;</span>
<a href="#l17.38"></a><span id="l17.38">                 let length = menuitem.getAttribute(&quot;length&quot;) * unitMult;</span>
<a href="#l17.39"></a><span id="l17.39"> </span>
<a href="#l17.40"></a><span id="l17.40">                 if (Math.abs(reminder.offset.inSeconds) == length) {</span>
<a href="#l17.41"></a><span id="l17.41" class="difflineat">@@ -252,17 +252,17 @@ function loadReminders(reminders) {</span>
<a href="#l17.42"></a><span id="l17.42">  * Save the selected reminder into the passed item.</span>
<a href="#l17.43"></a><span id="l17.43">  *</span>
<a href="#l17.44"></a><span id="l17.44">  * @param item      The item save the reminder into.</span>
<a href="#l17.45"></a><span id="l17.45">  */</span>
<a href="#l17.46"></a><span id="l17.46"> function saveReminder(item) {</span>
<a href="#l17.47"></a><span id="l17.47">     // We want to compare the old alarms with the new ones. If these are not</span>
<a href="#l17.48"></a><span id="l17.48">     // the same, then clear the snooze/dismiss times</span>
<a href="#l17.49"></a><span id="l17.49">     let oldAlarmMap = {};</span>
<a href="#l17.50"></a><span id="l17.50" class="difflineminus">-    for each (let alarm in item.getAlarms({})) {</span>
<a href="#l17.51"></a><span id="l17.51" class="difflineplus">+    for (let alarm of item.getAlarms({})) {</span>
<a href="#l17.52"></a><span id="l17.52">         oldAlarmMap[alarm.icalString] = true;</span>
<a href="#l17.53"></a><span id="l17.53">     }</span>
<a href="#l17.54"></a><span id="l17.54"> </span>
<a href="#l17.55"></a><span id="l17.55">     // Clear the alarms so we can add our new ones.</span>
<a href="#l17.56"></a><span id="l17.56">     item.clearAlarms();</span>
<a href="#l17.57"></a><span id="l17.57"> </span>
<a href="#l17.58"></a><span id="l17.58">     let reminderList = document.getElementById(&quot;item-alarm&quot;);</span>
<a href="#l17.59"></a><span id="l17.59">     if (reminderList.value != 'none') {</span>
<a href="#l17.60"></a><span id="l17.60" class="difflineat">@@ -280,27 +280,27 @@ function saveReminder(item) {</span>
<a href="#l17.61"></a><span id="l17.61">             // Pre-defined entries specify the necessary information</span>
<a href="#l17.62"></a><span id="l17.62">             // as attributes attached to the menuitem elements.</span>
<a href="#l17.63"></a><span id="l17.63">             reminders = [createReminderFromMenuitem(menuitem)];</span>
<a href="#l17.64"></a><span id="l17.64">         }</span>
<a href="#l17.65"></a><span id="l17.65"> </span>
<a href="#l17.66"></a><span id="l17.66">         let alarmCaps = item.calendar.getProperty(&quot;capabilities.alarms.actionValues&quot;) ||</span>
<a href="#l17.67"></a><span id="l17.67">                         [&quot;DISPLAY&quot;];</span>
<a href="#l17.68"></a><span id="l17.68">         let alarmActions = {};</span>
<a href="#l17.69"></a><span id="l17.69" class="difflineminus">-        for each (let action in alarmCaps) {</span>
<a href="#l17.70"></a><span id="l17.70" class="difflineplus">+        for (let action of alarmCaps) {</span>
<a href="#l17.71"></a><span id="l17.71">             alarmActions[action] = true;</span>
<a href="#l17.72"></a><span id="l17.72">         }</span>
<a href="#l17.73"></a><span id="l17.73"> </span>
<a href="#l17.74"></a><span id="l17.74">         // Make sure only alarms are saved that work in the given calendar.</span>
<a href="#l17.75"></a><span id="l17.75">         reminders.filter(x =&gt; x.action in alarmActions)</span>
<a href="#l17.76"></a><span id="l17.76">                  .forEach(item.addAlarm, item);</span>
<a href="#l17.77"></a><span id="l17.77">     }</span>
<a href="#l17.78"></a><span id="l17.78"> </span>
<a href="#l17.79"></a><span id="l17.79">     // Compare alarms to see if something changed.</span>
<a href="#l17.80"></a><span id="l17.80" class="difflineminus">-    for each (let alarm in item.getAlarms({})) {</span>
<a href="#l17.81"></a><span id="l17.81" class="difflineplus">+    for (let alarm of item.getAlarms({})) {</span>
<a href="#l17.82"></a><span id="l17.82">         let ics = alarm.icalString;</span>
<a href="#l17.83"></a><span id="l17.83">         if (ics in oldAlarmMap) {</span>
<a href="#l17.84"></a><span id="l17.84">             // The new alarm is also in the old set, remember this</span>
<a href="#l17.85"></a><span id="l17.85">             delete oldAlarmMap[ics];</span>
<a href="#l17.86"></a><span id="l17.86">         } else {</span>
<a href="#l17.87"></a><span id="l17.87">             // The new alarm is not in the old set, this means the alarms</span>
<a href="#l17.88"></a><span id="l17.88">             // differ and we can break out.</span>
<a href="#l17.89"></a><span id="l17.89">             oldAlarmMap[ics] = true;</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l18.1"></a><span id="l18.1" class="difflineminus">--- a/calendar/base/content/dialogs/calendar-event-dialog-attendees.js</span>
<a href="#l18.2"></a><span id="l18.2" class="difflineplus">+++ b/calendar/base/content/dialogs/calendar-event-dialog-attendees.js</span>
<a href="#l18.3"></a><span id="l18.3" class="difflineat">@@ -82,17 +82,17 @@ function onLoad() {</span>
<a href="#l18.4"></a><span id="l18.4">     propagateDateTime();</span>
<a href="#l18.5"></a><span id="l18.5">     // Set the scroll bar at where the event is</span>
<a href="#l18.6"></a><span id="l18.6">     scrollToCurrentTime();</span>
<a href="#l18.7"></a><span id="l18.7">     updateButtons();</span>
<a href="#l18.8"></a><span id="l18.8"> </span>
<a href="#l18.9"></a><span id="l18.9">     // we need to enforce several layout constraints which can't be modelled</span>
<a href="#l18.10"></a><span id="l18.10">     // with plain xul and css, at least as far as i know.</span>
<a href="#l18.11"></a><span id="l18.11">     const kStylesheet = &quot;chrome://calendar/skin/calendar-event-dialog.css&quot;;</span>
<a href="#l18.12"></a><span id="l18.12" class="difflineminus">-    for each (var stylesheet in document.styleSheets) {</span>
<a href="#l18.13"></a><span id="l18.13" class="difflineplus">+    for (var stylesheet of document.styleSheets) {</span>
<a href="#l18.14"></a><span id="l18.14">         if (stylesheet.href == kStylesheet) {</span>
<a href="#l18.15"></a><span id="l18.15">             // make the dummy-spacer #1 [top] the same height as the timebar</span>
<a href="#l18.16"></a><span id="l18.16">             var timebar = document.getElementById(&quot;timebar&quot;);</span>
<a href="#l18.17"></a><span id="l18.17">             stylesheet.insertRule(</span>
<a href="#l18.18"></a><span id="l18.18">                 &quot;.attendee-spacer-top { height: &quot;</span>
<a href="#l18.19"></a><span id="l18.19">                     + timebar.boxObject.height+&quot;px; }&quot;, 0);</span>
<a href="#l18.20"></a><span id="l18.20">             // make the dummy-spacer #2 [bottom] the same height as the scrollbar</span>
<a href="#l18.21"></a><span id="l18.21">             var scrollbar = document.getElementById(&quot;horizontal-scrollbar&quot;);</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l19.1"></a><span id="l19.1" class="difflineminus">--- a/calendar/base/content/dialogs/calendar-event-dialog-attendees.xml</span>
<a href="#l19.2"></a><span id="l19.2" class="difflineplus">+++ b/calendar/base/content/dialogs/calendar-event-dialog-attendees.xml</span>
<a href="#l19.3"></a><span id="l19.3" class="difflineat">@@ -155,17 +155,17 @@</span>
<a href="#l19.4"></a><span id="l19.4">                   organizer.commonName = calendar.getProperty(&quot;organizerCN&quot;);</span>
<a href="#l19.5"></a><span id="l19.5">               }</span>
<a href="#l19.6"></a><span id="l19.6">               organizer.isOrganizer = true;</span>
<a href="#l19.7"></a><span id="l19.7">               this.appendAttendee(organizer, listbox, template, true);</span>
<a href="#l19.8"></a><span id="l19.8">           }</span>
<a href="#l19.9"></a><span id="l19.9"> </span>
<a href="#l19.10"></a><span id="l19.10">           var numRowsAdded = 0;</span>
<a href="#l19.11"></a><span id="l19.11">           if (attendees.length &gt; 0) {</span>
<a href="#l19.12"></a><span id="l19.12" class="difflineminus">-              for each (var attendee in attendees) {</span>
<a href="#l19.13"></a><span id="l19.13" class="difflineplus">+              for (var attendee of attendees) {</span>
<a href="#l19.14"></a><span id="l19.14">                   this.appendAttendee(attendee, listbox, template, false);</span>
<a href="#l19.15"></a><span id="l19.15">                   numRowsAdded++;</span>
<a href="#l19.16"></a><span id="l19.16">               }</span>
<a href="#l19.17"></a><span id="l19.17">           }</span>
<a href="#l19.18"></a><span id="l19.18">           if (numRowsAdded == 0) {</span>
<a href="#l19.19"></a><span id="l19.19">               this.appendAttendee(null, listbox, template, false);</span>
<a href="#l19.20"></a><span id="l19.20">           }</span>
<a href="#l19.21"></a><span id="l19.21"> </span>
<a href="#l19.22"></a><span id="l19.22" class="difflineat">@@ -596,17 +596,17 @@</span>
<a href="#l19.23"></a><span id="l19.23">                       if (entries.length &gt; 0) {</span>
<a href="#l19.24"></a><span id="l19.24">                           let currentIndex = parseInt(input.id.substr(13));</span>
<a href="#l19.25"></a><span id="l19.25">                           let template = document.getAnonymousElementByAttribute(this, &quot;anonid&quot;, &quot;item&quot;);</span>
<a href="#l19.26"></a><span id="l19.26">                           let currentNode = template.parentNode.childNodes[currentIndex];</span>
<a href="#l19.27"></a><span id="l19.27">                           this._fillListItemWithEntry(currentNode, entries[0], currentIndex);</span>
<a href="#l19.28"></a><span id="l19.28">                           entries.shift();</span>
<a href="#l19.29"></a><span id="l19.29">                           let nextNode = template.parentNode.childNodes[currentIndex+1];</span>
<a href="#l19.30"></a><span id="l19.30">                           currentIndex++;</span>
<a href="#l19.31"></a><span id="l19.31" class="difflineminus">-                          for each (let entry in entries) {</span>
<a href="#l19.32"></a><span id="l19.32" class="difflineplus">+                          for (let entry of entries) {</span>
<a href="#l19.33"></a><span id="l19.33">                               currentNode = template.cloneNode(true);</span>
<a href="#l19.34"></a><span id="l19.34">                               template.parentNode.insertBefore(currentNode, nextNode);</span>
<a href="#l19.35"></a><span id="l19.35">                               this._fillListItemWithEntry(currentNode, entry, currentIndex);</span>
<a href="#l19.36"></a><span id="l19.36">                               currentIndex++;</span>
<a href="#l19.37"></a><span id="l19.37">                           }</span>
<a href="#l19.38"></a><span id="l19.38">                           this.mMaxAttendees += entries.length;</span>
<a href="#l19.39"></a><span id="l19.39">                           for (let i = currentIndex; i &lt;= this.mMaxAttendees; i++) {</span>
<a href="#l19.40"></a><span id="l19.40">                               let row = template.parentNode.childNodes[i];</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l20.1"></a><span id="l20.1" class="difflineminus">--- a/calendar/base/content/dialogs/calendar-event-dialog-freebusy.xml</span>
<a href="#l20.2"></a><span id="l20.2" class="difflineplus">+++ b/calendar/base/content/dialogs/calendar-event-dialog-freebusy.xml</span>
<a href="#l20.3"></a><span id="l20.3" class="difflineat">@@ -768,17 +768,17 @@</span>
<a href="#l20.4"></a><span id="l20.4">               // First of all set all state slots to 'free'</span>
<a href="#l20.5"></a><span id="l20.5">               for (let i = 0; i &lt; this.mState.length; i++) {</span>
<a href="#l20.6"></a><span id="l20.6">                   this.mState[i] = Components.interfaces.calIFreeBusyInterval.FREE;</span>
<a href="#l20.7"></a><span id="l20.7">               }</span>
<a href="#l20.8"></a><span id="l20.8"> </span>
<a href="#l20.9"></a><span id="l20.9">               let numHours = this.numHours;</span>
<a href="#l20.10"></a><span id="l20.10"> </span>
<a href="#l20.11"></a><span id="l20.11">               // Iterate all incoming freebusy entries</span>
<a href="#l20.12"></a><span id="l20.12" class="difflineminus">-              for each (let entry in aEntries) {</span>
<a href="#l20.13"></a><span id="l20.13" class="difflineplus">+              for (let entry of aEntries) {</span>
<a href="#l20.14"></a><span id="l20.14">                   let rangeStart = entry.interval.start.getInTimezone(kDefaultTimezone);</span>
<a href="#l20.15"></a><span id="l20.15">                   let rangeEnd = entry.interval.end.getInTimezone(kDefaultTimezone);</span>
<a href="#l20.16"></a><span id="l20.16"> </span>
<a href="#l20.17"></a><span id="l20.17">                   if (rangeStart.compare(start) &lt; 0) {</span>
<a href="#l20.18"></a><span id="l20.18">                       rangeStart = start.clone();</span>
<a href="#l20.19"></a><span id="l20.19">                   }</span>
<a href="#l20.20"></a><span id="l20.20">                   if (rangeEnd.compare(end) &gt; 0) {</span>
<a href="#l20.21"></a><span id="l20.21">                       rangeEnd = end.clone();</span>
<a href="#l20.22"></a><span id="l20.22" class="difflineat">@@ -907,17 +907,17 @@</span>
<a href="#l20.23"></a><span id="l20.23">           var newTime = aStartTime.clone();</span>
<a href="#l20.24"></a><span id="l20.24">           var duration = aEndTime.subtractDate(aStartTime);</span>
<a href="#l20.25"></a><span id="l20.25">           var newEndTime = newTime.clone();</span>
<a href="#l20.26"></a><span id="l20.26">           newEndTime.addDuration(duration);</span>
<a href="#l20.27"></a><span id="l20.27"> </span>
<a href="#l20.28"></a><span id="l20.28">           var kDefaultTimezone = calendarDefaultTimezone();</span>
<a href="#l20.29"></a><span id="l20.29"> </span>
<a href="#l20.30"></a><span id="l20.30">           if (this.mEntries) {</span>
<a href="#l20.31"></a><span id="l20.31" class="difflineminus">-              for each (var entry in this.mEntries) {</span>
<a href="#l20.32"></a><span id="l20.32" class="difflineplus">+              for (var entry of this.mEntries) {</span>
<a href="#l20.33"></a><span id="l20.33">                 var rangeStart =</span>
<a href="#l20.34"></a><span id="l20.34">                     entry.interval.start.getInTimezone(kDefaultTimezone);</span>
<a href="#l20.35"></a><span id="l20.35">                 var rangeEnd =</span>
<a href="#l20.36"></a><span id="l20.36">                     entry.interval.end.getInTimezone(kDefaultTimezone);</span>
<a href="#l20.37"></a><span id="l20.37"> </span>
<a href="#l20.38"></a><span id="l20.38">                 var isZeroLength = !newTime.compare(newEndTime);</span>
<a href="#l20.39"></a><span id="l20.39">                 if ((isZeroLength &amp;&amp;</span>
<a href="#l20.40"></a><span id="l20.40">                      newTime.compare(rangeStart) &gt;= 0 &amp;&amp;</span>
<a href="#l20.41"></a><span id="l20.41" class="difflineat">@@ -1128,17 +1128,17 @@</span>
<a href="#l20.42"></a><span id="l20.42">         &lt;body&gt;&lt;![CDATA[</span>
<a href="#l20.43"></a><span id="l20.43">           this.onInitialize();</span>
<a href="#l20.44"></a><span id="l20.44">         ]]&gt;&lt;/body&gt;</span>
<a href="#l20.45"></a><span id="l20.45">       &lt;/method&gt;</span>
<a href="#l20.46"></a><span id="l20.46"> </span>
<a href="#l20.47"></a><span id="l20.47">       &lt;method name=&quot;onUnload&quot;&gt;</span>
<a href="#l20.48"></a><span id="l20.48">         &lt;body&gt;&lt;![CDATA[</span>
<a href="#l20.49"></a><span id="l20.49">           // Cancel pending free/busy requests</span>
<a href="#l20.50"></a><span id="l20.50" class="difflineminus">-          for each (var request in this.mPendingRequests) {</span>
<a href="#l20.51"></a><span id="l20.51" class="difflineplus">+          for (var request of this.mPendingRequests) {</span>
<a href="#l20.52"></a><span id="l20.52">               request.cancel(null);</span>
<a href="#l20.53"></a><span id="l20.53">           }</span>
<a href="#l20.54"></a><span id="l20.54"> </span>
<a href="#l20.55"></a><span id="l20.55">           this.mPendingRequests = [];</span>
<a href="#l20.56"></a><span id="l20.56">         ]]&gt;&lt;/body&gt;</span>
<a href="#l20.57"></a><span id="l20.57">       &lt;/method&gt;</span>
<a href="#l20.58"></a><span id="l20.58"> </span>
<a href="#l20.59"></a><span id="l20.59">       &lt;method name=&quot;onInitialize&quot;&gt;</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l21.1"></a><span id="l21.1" class="difflineminus">--- a/calendar/base/content/dialogs/calendar-event-dialog-recurrence.js</span>
<a href="#l21.2"></a><span id="l21.2" class="difflineplus">+++ b/calendar/base/content/dialogs/calendar-event-dialog-recurrence.js</span>
<a href="#l21.3"></a><span id="l21.3" class="difflineat">@@ -503,17 +503,17 @@ function enableRecurrenceFields(aAttribu</span>
<a href="#l21.4"></a><span id="l21.4">  * @param recurrenceInfo    An item's recurrence info to parse.</span>
<a href="#l21.5"></a><span id="l21.5">  * @return                  An array with two elements: an array of positive</span>
<a href="#l21.6"></a><span id="l21.6">  *                            rules and an array of negative rules.</span>
<a href="#l21.7"></a><span id="l21.7">  */</span>
<a href="#l21.8"></a><span id="l21.8"> function splitRecurrenceRules(recurrenceInfo) {</span>
<a href="#l21.9"></a><span id="l21.9">     var ritems = recurrenceInfo.getRecurrenceItems({});</span>
<a href="#l21.10"></a><span id="l21.10">     var rules = [];</span>
<a href="#l21.11"></a><span id="l21.11">     var exceptions = [];</span>
<a href="#l21.12"></a><span id="l21.12" class="difflineminus">-    for each (var r in ritems) {</span>
<a href="#l21.13"></a><span id="l21.13" class="difflineplus">+    for (var r of ritems) {</span>
<a href="#l21.14"></a><span id="l21.14">         if (r.isNegative) {</span>
<a href="#l21.15"></a><span id="l21.15">             exceptions.push(r);</span>
<a href="#l21.16"></a><span id="l21.16">         } else {</span>
<a href="#l21.17"></a><span id="l21.17">             rules.push(r);</span>
<a href="#l21.18"></a><span id="l21.18">         }</span>
<a href="#l21.19"></a><span id="l21.19">     }</span>
<a href="#l21.20"></a><span id="l21.20">     return [rules, exceptions];</span>
<a href="#l21.21"></a><span id="l21.21"> }</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l22.1"></a><span id="l22.1" class="difflineminus">--- a/calendar/base/content/dialogs/calendar-event-dialog-reminder.js</span>
<a href="#l22.2"></a><span id="l22.2" class="difflineplus">+++ b/calendar/base/content/dialogs/calendar-event-dialog-reminder.js</span>
<a href="#l22.3"></a><span id="l22.3" class="difflineat">@@ -34,24 +34,24 @@ function onLoad() {</span>
<a href="#l22.4"></a><span id="l22.4">     setElementValue(&quot;reminder-after-end-menuitem&quot;,</span>
<a href="#l22.5"></a><span id="l22.5">                     _sn(&quot;reminderCustomOriginEndAfter&quot;),</span>
<a href="#l22.6"></a><span id="l22.6">                     &quot;label&quot;);</span>
<a href="#l22.7"></a><span id="l22.7"> </span>
<a href="#l22.8"></a><span id="l22.8"> </span>
<a href="#l22.9"></a><span id="l22.9">     // Set up the action map</span>
<a href="#l22.10"></a><span id="l22.10">     let supportedActions = calendar.getProperty(&quot;capabilities.alarms.actionValues&quot;) ||</span>
<a href="#l22.11"></a><span id="l22.11">                            [&quot;DISPLAY&quot; /* TODO email support, &quot;EMAIL&quot; */];</span>
<a href="#l22.12"></a><span id="l22.12" class="difflineminus">-    for each (let action in supportedActions) {</span>
<a href="#l22.13"></a><span id="l22.13" class="difflineplus">+    for (let action of supportedActions) {</span>
<a href="#l22.14"></a><span id="l22.14">         allowedActionsMap[action] = true;</span>
<a href="#l22.15"></a><span id="l22.15">     }</span>
<a href="#l22.16"></a><span id="l22.16"> </span>
<a href="#l22.17"></a><span id="l22.17">     // Hide all actions that are not supported by this provider</span>
<a href="#l22.18"></a><span id="l22.18">     let firstAvailableItem;</span>
<a href="#l22.19"></a><span id="l22.19">     let actionNodes = document.getElementById(&quot;reminder-actions-menupopup&quot;).childNodes;</span>
<a href="#l22.20"></a><span id="l22.20" class="difflineminus">-    for each (let actionNode in Array.slice(actionNodes)) {</span>
<a href="#l22.21"></a><span id="l22.21" class="difflineplus">+    for (let actionNode of actionNodes) {</span>
<a href="#l22.22"></a><span id="l22.22">         let shouldHide = (!(actionNode.value in allowedActionsMap) ||</span>
<a href="#l22.23"></a><span id="l22.23">                           (actionNode.hasAttribute(&quot;provider&quot;) &amp;&amp;</span>
<a href="#l22.24"></a><span id="l22.24">                            actionNode.getAttribute(&quot;provider&quot;) != calendar.type));</span>
<a href="#l22.25"></a><span id="l22.25">         setElementValue(actionNode, shouldHide &amp;&amp; &quot;true&quot;, &quot;hidden&quot;);</span>
<a href="#l22.26"></a><span id="l22.26">         if (!firstAvailableItem &amp;&amp; !shouldHide) {</span>
<a href="#l22.27"></a><span id="l22.27">             firstAvailableItem = actionNode;</span>
<a href="#l22.28"></a><span id="l22.28">         }</span>
<a href="#l22.29"></a><span id="l22.29">     }</span>
<a href="#l22.30"></a><span id="l22.30" class="difflineat">@@ -417,18 +417,17 @@ function onRemoveReminder() {</span>
<a href="#l22.31"></a><span id="l22.31"> </span>
<a href="#l22.32"></a><span id="l22.32"> /**</span>
<a href="#l22.33"></a><span id="l22.33">  * Handler function to be called when the accept button is pressed.</span>
<a href="#l22.34"></a><span id="l22.34">  *</span>
<a href="#l22.35"></a><span id="l22.35">  * @return      Returns true if the window should be closed</span>
<a href="#l22.36"></a><span id="l22.36">  */</span>
<a href="#l22.37"></a><span id="l22.37"> function onAccept() {</span>
<a href="#l22.38"></a><span id="l22.38">     let listbox = document.getElementById(&quot;reminder-listbox&quot;);</span>
<a href="#l22.39"></a><span id="l22.39" class="difflineminus">-    let reminders = [ node.reminder </span>
<a href="#l22.40"></a><span id="l22.40" class="difflineminus">-                      for each (node in Array.slice(listbox.childNodes)) ];</span>
<a href="#l22.41"></a><span id="l22.41" class="difflineplus">+    let reminders = Array.from(listbox.childNodes).map(node =&gt; node.reminder);</span>
<a href="#l22.42"></a><span id="l22.42">     if (window.arguments[0].onOk) {</span>
<a href="#l22.43"></a><span id="l22.43">         window.arguments[0].onOk(reminders);</span>
<a href="#l22.44"></a><span id="l22.44">     }</span>
<a href="#l22.45"></a><span id="l22.45"> </span>
<a href="#l22.46"></a><span id="l22.46">     return true;</span>
<a href="#l22.47"></a><span id="l22.47"> }</span>
<a href="#l22.48"></a><span id="l22.48"> </span>
<a href="#l22.49"></a><span id="l22.49"> /**</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l23.1"></a><span id="l23.1" class="difflineminus">--- a/calendar/base/content/dialogs/calendar-event-dialog.js</span>
<a href="#l23.2"></a><span id="l23.2" class="difflineplus">+++ b/calendar/base/content/dialogs/calendar-event-dialog.js</span>
<a href="#l23.3"></a><span id="l23.3" class="difflineat">@@ -240,17 +240,17 @@ function onLoad() {</span>
<a href="#l23.4"></a><span id="l23.4">     window.initialStartDateValue = args.initialStartDateValue;</span>
<a href="#l23.5"></a><span id="l23.5"> </span>
<a href="#l23.6"></a><span id="l23.6">     // we store the array of attendees in the window.</span>
<a href="#l23.7"></a><span id="l23.7">     // clone each existing attendee since we still suffer</span>
<a href="#l23.8"></a><span id="l23.8">     // from the 'lost x-properties'-bug.</span>
<a href="#l23.9"></a><span id="l23.9">     window.attendees = [];</span>
<a href="#l23.10"></a><span id="l23.10">     var attendees = item.getAttendees({});</span>
<a href="#l23.11"></a><span id="l23.11">     if (attendees &amp;&amp; attendees.length) {</span>
<a href="#l23.12"></a><span id="l23.12" class="difflineminus">-        for each (var attendee in attendees) {</span>
<a href="#l23.13"></a><span id="l23.13" class="difflineplus">+        for (var attendee of attendees) {</span>
<a href="#l23.14"></a><span id="l23.14">             window.attendees.push(attendee.clone());</span>
<a href="#l23.15"></a><span id="l23.15">         }</span>
<a href="#l23.16"></a><span id="l23.16">     }</span>
<a href="#l23.17"></a><span id="l23.17"> </span>
<a href="#l23.18"></a><span id="l23.18">     window.organizer = null;</span>
<a href="#l23.19"></a><span id="l23.19">     if (item.organizer) {</span>
<a href="#l23.20"></a><span id="l23.20">         window.organizer = item.organizer.clone();</span>
<a href="#l23.21"></a><span id="l23.21">     } else if (item.getAttendees({}).length &gt; 0) {</span>
<a href="#l23.22"></a><span id="l23.22" class="difflineat">@@ -437,17 +437,17 @@ function loadDialog(item) {</span>
<a href="#l23.23"></a><span id="l23.23">     // Categories</span>
<a href="#l23.24"></a><span id="l23.24">     loadCategories(item);</span>
<a href="#l23.25"></a><span id="l23.25"> </span>
<a href="#l23.26"></a><span id="l23.26">     // Attachment</span>
<a href="#l23.27"></a><span id="l23.27">     loadCloudProviders();</span>
<a href="#l23.28"></a><span id="l23.28">     var hasAttachments = capSupported(&quot;attachments&quot;);</span>
<a href="#l23.29"></a><span id="l23.29">     var attachments = item.getAttachments({});</span>
<a href="#l23.30"></a><span id="l23.30">     if (hasAttachments &amp;&amp; attachments &amp;&amp; attachments.length &gt; 0) {</span>
<a href="#l23.31"></a><span id="l23.31" class="difflineminus">-        for each (var attachment in attachments) {</span>
<a href="#l23.32"></a><span id="l23.32" class="difflineplus">+        for (var attachment of attachments) {</span>
<a href="#l23.33"></a><span id="l23.33">             addAttachment(attachment);</span>
<a href="#l23.34"></a><span id="l23.34">         }</span>
<a href="#l23.35"></a><span id="l23.35">     } else {</span>
<a href="#l23.36"></a><span id="l23.36">         updateAttachment();</span>
<a href="#l23.37"></a><span id="l23.37">     }</span>
<a href="#l23.38"></a><span id="l23.38"> </span>
<a href="#l23.39"></a><span id="l23.39">     // URL link</span>
<a href="#l23.40"></a><span id="l23.40">     updateLink();</span>
<a href="#l23.41"></a><span id="l23.41" class="difflineat">@@ -922,17 +922,17 @@ function updateDateCheckboxes(aDatePicke</span>
<a href="#l23.42"></a><span id="l23.42"> function loadRepeat(item) {</span>
<a href="#l23.43"></a><span id="l23.43">     var recurrenceInfo = window.recurrenceInfo;</span>
<a href="#l23.44"></a><span id="l23.44">     setElementValue(&quot;item-repeat&quot;, &quot;none&quot;);</span>
<a href="#l23.45"></a><span id="l23.45">     if (recurrenceInfo) {</span>
<a href="#l23.46"></a><span id="l23.46">         setElementValue(&quot;item-repeat&quot;, &quot;custom&quot;);</span>
<a href="#l23.47"></a><span id="l23.47">         var ritems = recurrenceInfo.getRecurrenceItems({});</span>
<a href="#l23.48"></a><span id="l23.48">         var rules = [];</span>
<a href="#l23.49"></a><span id="l23.49">         var exceptions = [];</span>
<a href="#l23.50"></a><span id="l23.50" class="difflineminus">-        for each (var r in ritems) {</span>
<a href="#l23.51"></a><span id="l23.51" class="difflineplus">+        for (var r of ritems) {</span>
<a href="#l23.52"></a><span id="l23.52">             if (r.isNegative) {</span>
<a href="#l23.53"></a><span id="l23.53">                 exceptions.push(r);</span>
<a href="#l23.54"></a><span id="l23.54">             } else {</span>
<a href="#l23.55"></a><span id="l23.55">                 rules.push(r);</span>
<a href="#l23.56"></a><span id="l23.56">             }</span>
<a href="#l23.57"></a><span id="l23.57">         }</span>
<a href="#l23.58"></a><span id="l23.58">         if (rules.length == 1) {</span>
<a href="#l23.59"></a><span id="l23.59">             let rule = cal.wrapInstance(rules[0], Components.interfaces.calIRecurrenceRule);</span>
<a href="#l23.60"></a><span id="l23.60" class="difflineat">@@ -1095,17 +1095,18 @@ function saveDialog(item) {</span>
<a href="#l23.61"></a><span id="l23.61">     // Categories</span>
<a href="#l23.62"></a><span id="l23.62">     saveCategories(item);</span>
<a href="#l23.63"></a><span id="l23.63"> </span>
<a href="#l23.64"></a><span id="l23.64">     // Attachment</span>
<a href="#l23.65"></a><span id="l23.65">     // We want the attachments to be up to date, remove all first.</span>
<a href="#l23.66"></a><span id="l23.66">     item.removeAllAttachments();</span>
<a href="#l23.67"></a><span id="l23.67"> </span>
<a href="#l23.68"></a><span id="l23.68">     // Now add back the new ones</span>
<a href="#l23.69"></a><span id="l23.69" class="difflineminus">-    for each (var att in gAttachMap) {</span>
<a href="#l23.70"></a><span id="l23.70" class="difflineplus">+    for (var hashId in gAttachMap) {</span>
<a href="#l23.71"></a><span id="l23.71" class="difflineplus">+        var att = gAttachMap[hashId];</span>
<a href="#l23.72"></a><span id="l23.72">         item.addAttachment(att);</span>
<a href="#l23.73"></a><span id="l23.73">     }</span>
<a href="#l23.74"></a><span id="l23.74"> </span>
<a href="#l23.75"></a><span id="l23.75">     // Description</span>
<a href="#l23.76"></a><span id="l23.76">     setItemProperty(item, &quot;DESCRIPTION&quot;, getElementValue(&quot;item-description&quot;));</span>
<a href="#l23.77"></a><span id="l23.77"> </span>
<a href="#l23.78"></a><span id="l23.78">     // Event Status</span>
<a href="#l23.79"></a><span id="l23.79">     if (isEvent(item)) {</span>
<a href="#l23.80"></a><span id="l23.80" class="difflineat">@@ -1213,17 +1214,17 @@ function updateTitle() {</span>
<a href="#l23.81"></a><span id="l23.81">  *      dialog[itemType=&quot;task&quot;] .event-only,</span>
<a href="#l23.82"></a><span id="l23.82">  *      dialog[itemType=&quot;event&quot;] .task-only {</span>
<a href="#l23.83"></a><span id="l23.83">  *          display: none;</span>
<a href="#l23.84"></a><span id="l23.84">  *      }</span>
<a href="#l23.85"></a><span id="l23.85"> */</span>
<a href="#l23.86"></a><span id="l23.86"> function updateStyle() {</span>
<a href="#l23.87"></a><span id="l23.87">     const kDialogStylesheet = &quot;chrome://calendar/skin/calendar-event-dialog.css&quot;;</span>
<a href="#l23.88"></a><span id="l23.88"> </span>
<a href="#l23.89"></a><span id="l23.89" class="difflineminus">-    for each (let stylesheet in document.styleSheets) {</span>
<a href="#l23.90"></a><span id="l23.90" class="difflineplus">+    for (let stylesheet of document.styleSheets) {</span>
<a href="#l23.91"></a><span id="l23.91">         if (stylesheet.href == kDialogStylesheet) {</span>
<a href="#l23.92"></a><span id="l23.92">             if (cal.isEvent(window.calendarItem)) {</span>
<a href="#l23.93"></a><span id="l23.93">                 stylesheet.insertRule(&quot;.todo-only { display: none; }&quot;,</span>
<a href="#l23.94"></a><span id="l23.94">                                       stylesheet.cssRules.length);</span>
<a href="#l23.95"></a><span id="l23.95">             } else if (cal.isToDo(window.calendarItem)) {</span>
<a href="#l23.96"></a><span id="l23.96">                 stylesheet.insertRule(&quot;.event-only { display: none; }&quot;,</span>
<a href="#l23.97"></a><span id="l23.97">                                       stylesheet.cssRules.length);</span>
<a href="#l23.98"></a><span id="l23.98">             }</span>
<a href="#l23.99"></a><span id="l23.99" class="difflineat">@@ -2806,17 +2807,17 @@ function saveItem() {</span>
<a href="#l23.100"></a><span id="l23.100"> </span>
<a href="#l23.101"></a><span id="l23.101">     // serialize the item</span>
<a href="#l23.102"></a><span id="l23.102">     saveDialog(item);</span>
<a href="#l23.103"></a><span id="l23.103"> </span>
<a href="#l23.104"></a><span id="l23.104">     item.organizer = window.organizer;</span>
<a href="#l23.105"></a><span id="l23.105"> </span>
<a href="#l23.106"></a><span id="l23.106">     item.removeAllAttendees();</span>
<a href="#l23.107"></a><span id="l23.107">     if (window.attendees &amp;&amp; (window.attendees.length &gt; 0)) {</span>
<a href="#l23.108"></a><span id="l23.108" class="difflineminus">-        for each (var attendee in window.attendees) {</span>
<a href="#l23.109"></a><span id="l23.109" class="difflineplus">+        for (var attendee of window.attendees) {</span>
<a href="#l23.110"></a><span id="l23.110">            item.addAttendee(attendee);</span>
<a href="#l23.111"></a><span id="l23.111">         }</span>
<a href="#l23.112"></a><span id="l23.112"> </span>
<a href="#l23.113"></a><span id="l23.113">         let notifyCheckbox = document.getElementById(&quot;notify-attendees-checkbox&quot;);</span>
<a href="#l23.114"></a><span id="l23.114">         if (notifyCheckbox.disabled) {</span>
<a href="#l23.115"></a><span id="l23.115">             item.deleteProperty(&quot;X-MOZ-SEND-INVITATIONS&quot;);</span>
<a href="#l23.116"></a><span id="l23.116">         } else {</span>
<a href="#l23.117"></a><span id="l23.117">             item.setProperty(&quot;X-MOZ-SEND-INVITATIONS&quot;, notifyCheckbox.checked ? &quot;TRUE&quot; : &quot;FALSE&quot;);</span>
<a href="#l23.118"></a><span id="l23.118" class="difflineat">@@ -3152,17 +3153,17 @@ function showTimezonePopup(event, dateTi</span>
<a href="#l23.119"></a><span id="l23.119">     timezoneDefaultItem.label = defaultTimezone.displayName;</span>
<a href="#l23.120"></a><span id="l23.120"> </span>
<a href="#l23.121"></a><span id="l23.121">     // Clear out any old recent timezones</span>
<a href="#l23.122"></a><span id="l23.122">     while (timezoneDefaultItem.nextSibling != timezoneSeparator) {</span>
<a href="#l23.123"></a><span id="l23.123">         timezoneDefaultItem.nextSibling.remove();</span>
<a href="#l23.124"></a><span id="l23.124">     }</span>
<a href="#l23.125"></a><span id="l23.125"> </span>
<a href="#l23.126"></a><span id="l23.126">     // Fill in the new recent timezones</span>
<a href="#l23.127"></a><span id="l23.127" class="difflineminus">-    for each (let tz in recentTimezones) {</span>
<a href="#l23.128"></a><span id="l23.128" class="difflineplus">+    for (let tz of recentTimezones) {</span>
<a href="#l23.129"></a><span id="l23.129">         let menuItem = createXULElement(&quot;menuitem&quot;);</span>
<a href="#l23.130"></a><span id="l23.130">         menuItem.setAttribute(&quot;value&quot;, tz.tzid);</span>
<a href="#l23.131"></a><span id="l23.131">         menuItem.setAttribute(&quot;label&quot;, tz.displayName);</span>
<a href="#l23.132"></a><span id="l23.132">         timezonePopup.insertBefore(menuItem, timezoneDefaultItem.nextSibling);</span>
<a href="#l23.133"></a><span id="l23.133">     }</span>
<a href="#l23.134"></a><span id="l23.134"> </span>
<a href="#l23.135"></a><span id="l23.135">     // Show the popup</span>
<a href="#l23.136"></a><span id="l23.136">     timezonePopup.openPopup(event.target, &quot;after_start&quot;, 0, 0, true);</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l24.1"></a><span id="l24.1" class="difflineminus">--- a/calendar/base/content/dialogs/calendar-invitations-dialog.js</span>
<a href="#l24.2"></a><span id="l24.2" class="difflineplus">+++ b/calendar/base/content/dialogs/calendar-invitations-dialog.js</span>
<a href="#l24.3"></a><span id="l24.3" class="difflineat">@@ -37,17 +37,17 @@ function onLoad() {</span>
<a href="#l24.4"></a><span id="l24.4">                                              aItems) {</span>
<a href="#l24.5"></a><span id="l24.5">             if (!Components.isSuccessCode(aStatus)) {</span>
<a href="#l24.6"></a><span id="l24.6">                 return;</span>
<a href="#l24.7"></a><span id="l24.7">             }</span>
<a href="#l24.8"></a><span id="l24.8">             document.title = invitationsText + &quot; (&quot; + aCount + &quot;)&quot;;</span>
<a href="#l24.9"></a><span id="l24.9">             var updatingBox = document.getElementById(&quot;updating-box&quot;);</span>
<a href="#l24.10"></a><span id="l24.10">             updatingBox.setAttribute(&quot;hidden&quot;, &quot;true&quot;);</span>
<a href="#l24.11"></a><span id="l24.11">             var richListBox = document.getElementById(&quot;invitations-listbox&quot;);</span>
<a href="#l24.12"></a><span id="l24.12" class="difflineminus">-            for each (var item in aItems) {</span>
<a href="#l24.13"></a><span id="l24.13" class="difflineplus">+            for (var item of aItems) {</span>
<a href="#l24.14"></a><span id="l24.14">                 richListBox.addCalendarItem(item);</span>
<a href="#l24.15"></a><span id="l24.15">             }</span>
<a href="#l24.16"></a><span id="l24.16">         }</span>
<a href="#l24.17"></a><span id="l24.17">     };</span>
<a href="#l24.18"></a><span id="l24.18"> </span>
<a href="#l24.19"></a><span id="l24.19">     var updatingBox = document.getElementById(&quot;updating-box&quot;);</span>
<a href="#l24.20"></a><span id="l24.20">     updatingBox.removeAttribute(&quot;hidden&quot;);</span>
<a href="#l24.21"></a><span id="l24.21"> </span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l25.1"></a><span id="l25.1" class="difflineminus">--- a/calendar/base/content/dialogs/calendar-migration-dialog.js</span>
<a href="#l25.2"></a><span id="l25.2" class="difflineplus">+++ b/calendar/base/content/dialogs/calendar-migration-dialog.js</span>
<a href="#l25.3"></a><span id="l25.3" class="difflineat">@@ -30,17 +30,17 @@ var gMigrateWizard = {</span>
<a href="#l25.4"></a><span id="l25.4">         wizard.title = props.formatStringFromName(&quot;migrationTitle&quot;,</span>
<a href="#l25.5"></a><span id="l25.5">                                                   [&quot;Lightning&quot;],</span>
<a href="#l25.6"></a><span id="l25.6">                                                   1);</span>
<a href="#l25.7"></a><span id="l25.7">         desc.textContent = props.formatStringFromName(&quot;migrationDescription&quot;,</span>
<a href="#l25.8"></a><span id="l25.8">                                                       [&quot;Lightning&quot;],</span>
<a href="#l25.9"></a><span id="l25.9">                                                       1);</span>
<a href="#l25.10"></a><span id="l25.10"> </span>
<a href="#l25.11"></a><span id="l25.11">         migLOG(&quot;migrators: &quot; + window.arguments.length);</span>
<a href="#l25.12"></a><span id="l25.12" class="difflineminus">-        for each (var migrator in window.arguments[0]) {</span>
<a href="#l25.13"></a><span id="l25.13" class="difflineplus">+        for (var migrator of window.arguments[0]) {</span>
<a href="#l25.14"></a><span id="l25.14">             var listItem = document.createElement(&quot;listitem&quot;);</span>
<a href="#l25.15"></a><span id="l25.15">             listItem.setAttribute(&quot;type&quot;, &quot;checkbox&quot;);</span>
<a href="#l25.16"></a><span id="l25.16">             listItem.setAttribute(&quot;checked&quot;, true);</span>
<a href="#l25.17"></a><span id="l25.17">             listItem.setAttribute(&quot;label&quot;, migrator.title);</span>
<a href="#l25.18"></a><span id="l25.18">             listItem.migrator = migrator;</span>
<a href="#l25.19"></a><span id="l25.19">             listbox.appendChild(listItem);</span>
<a href="#l25.20"></a><span id="l25.20">         }</span>
<a href="#l25.21"></a><span id="l25.21">     },</span>
<a href="#l25.22"></a><span id="l25.22" class="difflineat">@@ -177,19 +177,19 @@ var gDataMigrator = {</span>
<a href="#l25.23"></a><span id="l25.23">         migLOG(&quot;mPlatform is: &quot; + this.mPlatform);</span>
<a href="#l25.24"></a><span id="l25.24"> </span>
<a href="#l25.25"></a><span id="l25.25">         var DMs = [];</span>
<a href="#l25.26"></a><span id="l25.26">         var migrators = [this.checkOldCal,</span>
<a href="#l25.27"></a><span id="l25.27">                          this.checkEvolution,</span>
<a href="#l25.28"></a><span id="l25.28">                          this.checkWindowsMail,</span>
<a href="#l25.29"></a><span id="l25.29">                          this.checkIcal];</span>
<a href="#l25.30"></a><span id="l25.30">         // XXX also define a category and an interface here for pluggability</span>
<a href="#l25.31"></a><span id="l25.31" class="difflineminus">-        for each (var migrator in migrators) {</span>
<a href="#l25.32"></a><span id="l25.32" class="difflineplus">+        for (var migrator of migrators) {</span>
<a href="#l25.33"></a><span id="l25.33">             var migs = migrator.call(this);</span>
<a href="#l25.34"></a><span id="l25.34" class="difflineminus">-            for each (var dm in migs) {</span>
<a href="#l25.35"></a><span id="l25.35" class="difflineplus">+            for (var dm of migs) {</span>
<a href="#l25.36"></a><span id="l25.36">                 DMs.push(dm);</span>
<a href="#l25.37"></a><span id="l25.37">             }</span>
<a href="#l25.38"></a><span id="l25.38">         }</span>
<a href="#l25.39"></a><span id="l25.39"> </span>
<a href="#l25.40"></a><span id="l25.40">         if (DMs.length == 0) {</span>
<a href="#l25.41"></a><span id="l25.41">             // No migration available</span>
<a href="#l25.42"></a><span id="l25.42">             return;</span>
<a href="#l25.43"></a><span id="l25.43">         }</span>
<a href="#l25.44"></a><span id="l25.44" class="difflineat">@@ -244,17 +244,17 @@ var gDataMigrator = {</span>
<a href="#l25.45"></a><span id="l25.45">         }</span>
<a href="#l25.46"></a><span id="l25.46"> </span>
<a href="#l25.47"></a><span id="l25.47">         // Callback from the XHR above.  Parses CalendarManager.rdf and imports</span>
<a href="#l25.48"></a><span id="l25.48">         // the data describe therein.</span>
<a href="#l25.49"></a><span id="l25.49">         function parseAndMigrate(aDoc, aCallback) {</span>
<a href="#l25.50"></a><span id="l25.50">             // For duplicate detection</span>
<a href="#l25.51"></a><span id="l25.51">             var calManager = getCalendarManager();</span>
<a href="#l25.52"></a><span id="l25.52">             var uris = [];</span>
<a href="#l25.53"></a><span id="l25.53" class="difflineminus">-            for each (var oldCal in calManager.getCalendars({})) {</span>
<a href="#l25.54"></a><span id="l25.54" class="difflineplus">+            for (var oldCal of calManager.getCalendars({})) {</span>
<a href="#l25.55"></a><span id="l25.55">                 uris.push(oldCal.uri);</span>
<a href="#l25.56"></a><span id="l25.56">             }</span>
<a href="#l25.57"></a><span id="l25.57"> </span>
<a href="#l25.58"></a><span id="l25.58">             function getRDFAttr(aNode, aAttr) {</span>
<a href="#l25.59"></a><span id="l25.59">                 return aNode.getAttributeNS(&quot;http://home.netscape.com/NC-rdf#&quot;,</span>
<a href="#l25.60"></a><span id="l25.60">                                             aAttr);</span>
<a href="#l25.61"></a><span id="l25.61">             }</span>
<a href="#l25.62"></a><span id="l25.62"> </span>
<a href="#l25.63"></a><span id="l25.63" class="difflineat">@@ -307,17 +307,17 @@ var gDataMigrator = {</span>
<a href="#l25.64"></a><span id="l25.64">         }</span>
<a href="#l25.65"></a><span id="l25.65"> </span>
<a href="#l25.66"></a><span id="l25.66">         // We're lightning, check Sunbird</span>
<a href="#l25.67"></a><span id="l25.67">         if ((sbProf = this.getSunbirdProfile())) {</span>
<a href="#l25.68"></a><span id="l25.68">             profiles.push(sbProf);</span>
<a href="#l25.69"></a><span id="l25.69">         }</span>
<a href="#l25.70"></a><span id="l25.70"> </span>
<a href="#l25.71"></a><span id="l25.71">         // Now check all of the profiles in each of these folders for data</span>
<a href="#l25.72"></a><span id="l25.72" class="difflineminus">-        for each (var prof in profiles) {</span>
<a href="#l25.73"></a><span id="l25.73" class="difflineplus">+        for (var prof of profiles) {</span>
<a href="#l25.74"></a><span id="l25.74">             var dirEnum = prof.directoryEntries;</span>
<a href="#l25.75"></a><span id="l25.75">             while (dirEnum.hasMoreElements()) {</span>
<a href="#l25.76"></a><span id="l25.76">                 var profile = dirEnum.getNext().QueryInterface(Components.interfaces.nsIFile);</span>
<a href="#l25.77"></a><span id="l25.77">                 if (profile.isFile()) {</span>
<a href="#l25.78"></a><span id="l25.78">                     continue;</span>
<a href="#l25.79"></a><span id="l25.79">                 } else {</span>
<a href="#l25.80"></a><span id="l25.80">                     profile.append(&quot;Calendar&quot;);</span>
<a href="#l25.81"></a><span id="l25.81">                     if (profile.exists()) {</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l26.1"></a><span id="l26.1" class="difflineminus">--- a/calendar/base/content/dialogs/calendar-print-dialog.js</span>
<a href="#l26.2"></a><span id="l26.2" class="difflineplus">+++ b/calendar/base/content/dialogs/calendar-print-dialog.js</span>
<a href="#l26.3"></a><span id="l26.3" class="difflineat">@@ -98,17 +98,17 @@ function getPrintSettings(receiverFunc) </span>
<a href="#l26.4"></a><span id="l26.4">             if (cal.isToDo(item) &amp;&amp; !settings.printTasks) return false;</span>
<a href="#l26.5"></a><span id="l26.5">             return true;</span>
<a href="#l26.6"></a><span id="l26.6">         });</span>
<a href="#l26.7"></a><span id="l26.7"> </span>
<a href="#l26.8"></a><span id="l26.8">         // If tasks should be printed, also include selected tasks from the</span>
<a href="#l26.9"></a><span id="l26.9">         // opening window.</span>
<a href="#l26.10"></a><span id="l26.10">         if (settings.printTasks) {</span>
<a href="#l26.11"></a><span id="l26.11">             let selectedTasks = window.opener.getSelectedTasks();</span>
<a href="#l26.12"></a><span id="l26.12" class="difflineminus">-            for each (var task in selectedTasks) {</span>
<a href="#l26.13"></a><span id="l26.13" class="difflineplus">+            for (var task of selectedTasks) {</span>
<a href="#l26.14"></a><span id="l26.14">                 settings.eventList.push(task);</span>
<a href="#l26.15"></a><span id="l26.15">             }</span>
<a href="#l26.16"></a><span id="l26.16">         }</span>
<a href="#l26.17"></a><span id="l26.17"> </span>
<a href="#l26.18"></a><span id="l26.18">         // We've set the event list above, no need to fetch items below.</span>
<a href="#l26.19"></a><span id="l26.19">         requiresFetch = false;</span>
<a href="#l26.20"></a><span id="l26.20">         break;</span>
<a href="#l26.21"></a><span id="l26.21">     }</span>
<a href="#l26.22"></a><span id="l26.22" class="difflineat">@@ -137,17 +137,17 @@ function getPrintSettings(receiverFunc) </span>
<a href="#l26.23"></a><span id="l26.23">             function onOperationComplete(aCalendar, aStatus, aOperationType, aId, aDateTime) {</span>
<a href="#l26.24"></a><span id="l26.24">                 receiverFunc(settings);</span>
<a href="#l26.25"></a><span id="l26.25">             },</span>
<a href="#l26.26"></a><span id="l26.26">             onGetResult:</span>
<a href="#l26.27"></a><span id="l26.27">             function onGetResult(aCalendar, aStatus, aItemType, aDetail, aCount, aItems) {</span>
<a href="#l26.28"></a><span id="l26.28">                 settings.eventList = settings.eventList.concat(aItems);</span>
<a href="#l26.29"></a><span id="l26.29">                 if (!settings.printTasksWithNoDueDate) {</span>
<a href="#l26.30"></a><span id="l26.30">                     eventWithDueDate = [];</span>
<a href="#l26.31"></a><span id="l26.31" class="difflineminus">-                    for each (var item in settings.eventList) {</span>
<a href="#l26.32"></a><span id="l26.32" class="difflineplus">+                    for (var item of settings.eventList) {</span>
<a href="#l26.33"></a><span id="l26.33">                         if (item.dueDate || item.endDate) {</span>
<a href="#l26.34"></a><span id="l26.34">                             eventWithDueDate.push(item)</span>
<a href="#l26.35"></a><span id="l26.35">                         }</span>
<a href="#l26.36"></a><span id="l26.36">                     }</span>
<a href="#l26.37"></a><span id="l26.37">                     settings.eventList = eventWithDueDate;</span>
<a href="#l26.38"></a><span id="l26.38">                 }</span>
<a href="#l26.39"></a><span id="l26.39">             }</span>
<a href="#l26.40"></a><span id="l26.40">         };</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l27.1"></a><span id="l27.1" class="difflineminus">--- a/calendar/base/content/dialogs/calendar-properties-dialog.js</span>
<a href="#l27.2"></a><span id="l27.2" class="difflineplus">+++ b/calendar/base/content/dialogs/calendar-properties-dialog.js</span>
<a href="#l27.3"></a><span id="l27.3" class="difflineat">@@ -144,17 +144,17 @@ function initRefreshInterval() {</span>
<a href="#l27.4"></a><span id="l27.4"> </span>
<a href="#l27.5"></a><span id="l27.5">     if (gCalendar.canRefresh) {</span>
<a href="#l27.6"></a><span id="l27.6">         let refreshInterval = gCalendar.getProperty(&quot;refreshInterval&quot;);</span>
<a href="#l27.7"></a><span id="l27.7">         if (refreshInterval === null) refreshInterval = 30;</span>
<a href="#l27.8"></a><span id="l27.8"> </span>
<a href="#l27.9"></a><span id="l27.9">         let foundValue = false;</span>
<a href="#l27.10"></a><span id="l27.10">         let separator = document.getElementById(&quot;calendar-refreshInterval-manual-separator&quot;);</span>
<a href="#l27.11"></a><span id="l27.11">         let menulist = document.getElementById(&quot;calendar-refreshInterval-menulist&quot;);</span>
<a href="#l27.12"></a><span id="l27.12" class="difflineminus">-        for each (let min in [1, 5, 15, 30, 60]) {</span>
<a href="#l27.13"></a><span id="l27.13" class="difflineplus">+        for (let min of [1, 5, 15, 30, 60]) {</span>
<a href="#l27.14"></a><span id="l27.14">             let menuitem = createMenuItem(min);</span>
<a href="#l27.15"></a><span id="l27.15"> </span>
<a href="#l27.16"></a><span id="l27.16">             separator.parentNode.insertBefore(menuitem, separator);</span>
<a href="#l27.17"></a><span id="l27.17">             if (refreshInterval == min) {</span>
<a href="#l27.18"></a><span id="l27.18">                 menulist.selectedItem = menuitem;</span>
<a href="#l27.19"></a><span id="l27.19">                 foundValue = true;</span>
<a href="#l27.20"></a><span id="l27.20">             }</span>
<a href="#l27.21"></a><span id="l27.21">         }</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l28.1"></a><span id="l28.1" class="difflineminus">--- a/calendar/base/content/dialogs/calendar-subscriptions-dialog.js</span>
<a href="#l28.2"></a><span id="l28.2" class="difflineplus">+++ b/calendar/base/content/dialogs/calendar-subscriptions-dialog.js</span>
<a href="#l28.3"></a><span id="l28.3" class="difflineat">@@ -92,25 +92,25 @@ function onCancel() {</span>
<a href="#l28.4"></a><span id="l28.4">  */</span>
<a href="#l28.5"></a><span id="l28.5"> function onSearch() {</span>
<a href="#l28.6"></a><span id="l28.6">     cancelPendingSearchOperation();</span>
<a href="#l28.7"></a><span id="l28.7"> </span>
<a href="#l28.8"></a><span id="l28.8">     var richListBox = document.getElementById(&quot;subscriptions-listbox&quot;);</span>
<a href="#l28.9"></a><span id="l28.9">     richListBox.clear();</span>
<a href="#l28.10"></a><span id="l28.10"> </span>
<a href="#l28.11"></a><span id="l28.11">     var registeredCals = {};</span>
<a href="#l28.12"></a><span id="l28.12" class="difflineminus">-    for each (var calendar in getCalendarManager().getCalendars({})) {</span>
<a href="#l28.13"></a><span id="l28.13" class="difflineplus">+    for (var calendar of getCalendarManager().getCalendars({})) {</span>
<a href="#l28.14"></a><span id="l28.14">         registeredCals[calendar.id] = true;</span>
<a href="#l28.15"></a><span id="l28.15">     }</span>
<a href="#l28.16"></a><span id="l28.16"> </span>
<a href="#l28.17"></a><span id="l28.17">     var opListener = {</span>
<a href="#l28.18"></a><span id="l28.18">         onResult: function search_onResult(op, result) {</span>
<a href="#l28.19"></a><span id="l28.19">             var richListBox = document.getElementById(&quot;subscriptions-listbox&quot;);</span>
<a href="#l28.20"></a><span id="l28.20">             if (result) {</span>
<a href="#l28.21"></a><span id="l28.21" class="difflineminus">-                for each (var calendar in result) {</span>
<a href="#l28.22"></a><span id="l28.22" class="difflineplus">+                for (var calendar of result) {</span>
<a href="#l28.23"></a><span id="l28.23">                     richListBox.addCalendar(calendar, registeredCals[calendar.id]);</span>
<a href="#l28.24"></a><span id="l28.24">                 }</span>
<a href="#l28.25"></a><span id="l28.25">             }</span>
<a href="#l28.26"></a><span id="l28.26">             if (!op.isPending) {</span>
<a href="#l28.27"></a><span id="l28.27">                 var statusDeck = document.getElementById(&quot;status-deck&quot;);</span>
<a href="#l28.28"></a><span id="l28.28">                 if (richListBox.getRowCount() &gt; 0) {</span>
<a href="#l28.29"></a><span id="l28.29">                     statusDeck.selectedIndex = 0;</span>
<a href="#l28.30"></a><span id="l28.30">                 } else {</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l29.1"></a><span id="l29.1" class="difflineminus">--- a/calendar/base/content/import-export.js</span>
<a href="#l29.2"></a><span id="l29.2" class="difflineplus">+++ b/calendar/base/content/import-export.js</span>
<a href="#l29.3"></a><span id="l29.3" class="difflineat">@@ -45,17 +45,17 @@ function loadEventsFromFile(aCalendar) {</span>
<a href="#l29.4"></a><span id="l29.4">         try {</span>
<a href="#l29.5"></a><span id="l29.5">             importer = Components.classes[contractid]</span>
<a href="#l29.6"></a><span id="l29.6">                                  .getService(Components.interfaces.calIImporter);</span>
<a href="#l29.7"></a><span id="l29.7">         } catch (e) {</span>
<a href="#l29.8"></a><span id="l29.8">             cal.WARN(&quot;Could not initialize importer: &quot; + contractid + &quot;\nError: &quot; + e);</span>
<a href="#l29.9"></a><span id="l29.9">             continue;</span>
<a href="#l29.10"></a><span id="l29.10">         }</span>
<a href="#l29.11"></a><span id="l29.11">         let types = importer.getFileTypes({});</span>
<a href="#l29.12"></a><span id="l29.12" class="difflineminus">-        for each (let type in types) {</span>
<a href="#l29.13"></a><span id="l29.13" class="difflineplus">+        for (let type of types) {</span>
<a href="#l29.14"></a><span id="l29.14">             fp.appendFilter(type.description, type.extensionFilter);</span>
<a href="#l29.15"></a><span id="l29.15">             if (type.extensionFilter==&quot;*.&quot; + fp.defaultExtension) {</span>
<a href="#l29.16"></a><span id="l29.16">                 fp.filterIndex = currentListLength;</span>
<a href="#l29.17"></a><span id="l29.17">                 defaultCIDIndex = currentListLength;</span>
<a href="#l29.18"></a><span id="l29.18">             }</span>
<a href="#l29.19"></a><span id="l29.19">             contractids.push(contractid);</span>
<a href="#l29.20"></a><span id="l29.20">             currentListLength++;</span>
<a href="#l29.21"></a><span id="l29.21">         }</span>
<a href="#l29.22"></a><span id="l29.22" class="difflineat">@@ -172,17 +172,17 @@ function putItemsIntoCal(destCal, aItems</span>
<a href="#l29.23"></a><span id="l29.23">                     showError(calGetString(&quot;calendar&quot;, &quot;duplicateError&quot;, [duplicateCount, aFilePath]));</span>
<a href="#l29.24"></a><span id="l29.24">                 } else if (failedCount) {</span>
<a href="#l29.25"></a><span id="l29.25">                     showError(calGetString(&quot;calendar&quot;, &quot;importItemsFailed&quot;, [failedCount, lastError.toString()]));</span>
<a href="#l29.26"></a><span id="l29.26">                 }</span>
<a href="#l29.27"></a><span id="l29.27">             }</span>
<a href="#l29.28"></a><span id="l29.28">         }</span>
<a href="#l29.29"></a><span id="l29.29">     }</span>
<a href="#l29.30"></a><span id="l29.30"> </span>
<a href="#l29.31"></a><span id="l29.31" class="difflineminus">-    for each (let item in aItems) {</span>
<a href="#l29.32"></a><span id="l29.32" class="difflineplus">+    for (let item of aItems) {</span>
<a href="#l29.33"></a><span id="l29.33">         // XXX prompt when finding a duplicate.</span>
<a href="#l29.34"></a><span id="l29.34">         try {</span>
<a href="#l29.35"></a><span id="l29.35">             destCal.addItem(item, listener);</span>
<a href="#l29.36"></a><span id="l29.36">         } catch(e) {</span>
<a href="#l29.37"></a><span id="l29.37">             failedCount++;</span>
<a href="#l29.38"></a><span id="l29.38">             lastError = e;</span>
<a href="#l29.39"></a><span id="l29.39">             // Call the listener's operationComplete, to increase the</span>
<a href="#l29.40"></a><span id="l29.40">             // counter and not miss failed items. Otherwise, endBatch might</span>
<a href="#l29.41"></a><span id="l29.41" class="difflineat">@@ -243,17 +243,17 @@ function saveEventsToFile(calendarEventA</span>
<a href="#l29.42"></a><span id="l29.42">         try {</span>
<a href="#l29.43"></a><span id="l29.43">             exporter = Components.classes[contractid]</span>
<a href="#l29.44"></a><span id="l29.44">                                  .getService(Components.interfaces.calIExporter);</span>
<a href="#l29.45"></a><span id="l29.45">         } catch (e) {</span>
<a href="#l29.46"></a><span id="l29.46">             cal.WARN(&quot;Could not initialize exporter: &quot; + contractid + &quot;\nError: &quot; + e);</span>
<a href="#l29.47"></a><span id="l29.47">             continue;</span>
<a href="#l29.48"></a><span id="l29.48">         }</span>
<a href="#l29.49"></a><span id="l29.49">         let types = exporter.getFileTypes({});</span>
<a href="#l29.50"></a><span id="l29.50" class="difflineminus">-        for each (let type in types) {</span>
<a href="#l29.51"></a><span id="l29.51" class="difflineplus">+        for (let type of types) {</span>
<a href="#l29.52"></a><span id="l29.52">             fp.appendFilter(type.description, type.extensionFilter);</span>
<a href="#l29.53"></a><span id="l29.53">             if (type.extensionFilter==&quot;*.&quot; + fp.defaultExtension) {</span>
<a href="#l29.54"></a><span id="l29.54">                 fp.filterIndex = currentListLength;</span>
<a href="#l29.55"></a><span id="l29.55">                 defaultCIDIndex = currentListLength;</span>
<a href="#l29.56"></a><span id="l29.56">             }</span>
<a href="#l29.57"></a><span id="l29.57">             contractids.push(contractid);</span>
<a href="#l29.58"></a><span id="l29.58">             currentListLength++;</span>
<a href="#l29.59"></a><span id="l29.59">         }</span>
<a href="#l29.60"></a><span id="l29.60" class="difflineat">@@ -323,17 +323,17 @@ function exportEntireCalendar(aCalendar)</span>
<a href="#l29.61"></a><span id="l29.61">     var getListener = {</span>
<a href="#l29.62"></a><span id="l29.62">         QueryInterface: XPCOMUtils.generateQI([Components.interfaces.calIOperationListener]),</span>
<a href="#l29.63"></a><span id="l29.63">         onOperationComplete: function(aCalendar, aStatus, aOperationType, aId, aDetail)</span>
<a href="#l29.64"></a><span id="l29.64">         {</span>
<a href="#l29.65"></a><span id="l29.65">             saveEventsToFile(itemArray, aCalendar.name);</span>
<a href="#l29.66"></a><span id="l29.66">         },</span>
<a href="#l29.67"></a><span id="l29.67">         onGetResult: function(aCalendar, aStatus, aItemType, aDetail, aCount, aItems)</span>
<a href="#l29.68"></a><span id="l29.68">         {</span>
<a href="#l29.69"></a><span id="l29.69" class="difflineminus">-            for each (let item in aItems) {</span>
<a href="#l29.70"></a><span id="l29.70" class="difflineplus">+            for (let item of aItems) {</span>
<a href="#l29.71"></a><span id="l29.71">                 itemArray.push(item);</span>
<a href="#l29.72"></a><span id="l29.72">             }</span>
<a href="#l29.73"></a><span id="l29.73">         }</span>
<a href="#l29.74"></a><span id="l29.74">     };</span>
<a href="#l29.75"></a><span id="l29.75"> </span>
<a href="#l29.76"></a><span id="l29.76">     function getItemsFromCal(aCal) {</span>
<a href="#l29.77"></a><span id="l29.77">         aCal.getItems(Components.interfaces.calICalendar.ITEM_FILTER_ALL_ITEMS,</span>
<a href="#l29.78"></a><span id="l29.78">                       0, null, null, getListener);</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l30.1"></a><span id="l30.1" class="difflineminus">--- a/calendar/base/content/widgets/calendar-list-tree.xml</span>
<a href="#l30.2"></a><span id="l30.2" class="difflineplus">+++ b/calendar/base/content/widgets/calendar-list-tree.xml</span>
<a href="#l30.3"></a><span id="l30.3" class="difflineat">@@ -233,17 +233,17 @@</span>
<a href="#l30.4"></a><span id="l30.4">       &lt;constructor&gt;&lt;![CDATA[</span>
<a href="#l30.5"></a><span id="l30.5">         Components.utils.import(&quot;resource://calendar/modules/calUtils.jsm&quot;);</span>
<a href="#l30.6"></a><span id="l30.6">         Components.utils.import(&quot;resource://gre/modules/XPCOMUtils.jsm&quot;);</span>
<a href="#l30.7"></a><span id="l30.7">         this.tree.view = this;</span>
<a href="#l30.8"></a><span id="l30.8">       ]]&gt;&lt;/constructor&gt;</span>
<a href="#l30.9"></a><span id="l30.9">       &lt;destructor&gt;&lt;![CDATA[</span>
<a href="#l30.10"></a><span id="l30.10">         // Clean up the calendar manager observers. Do not use removeCalendar</span>
<a href="#l30.11"></a><span id="l30.11">         // here since that will remove the calendar from the composite calendar.</span>
<a href="#l30.12"></a><span id="l30.12" class="difflineminus">-        for each (let calendar in this.mCalendarList) {</span>
<a href="#l30.13"></a><span id="l30.13" class="difflineplus">+        for (let calendar of this.mCalendarList) {</span>
<a href="#l30.14"></a><span id="l30.14">             calendar.removeObserver(this.calObserver);</span>
<a href="#l30.15"></a><span id="l30.15">         }</span>
<a href="#l30.16"></a><span id="l30.16"> </span>
<a href="#l30.17"></a><span id="l30.17">         this.tree.view = null;</span>
<a href="#l30.18"></a><span id="l30.18">         this.calObserver.listTree = null;</span>
<a href="#l30.19"></a><span id="l30.19"> </span>
<a href="#l30.20"></a><span id="l30.20">         if (this.mCompositeCalendar) {</span>
<a href="#l30.21"></a><span id="l30.21">             this.mCompositeCalendar.removeObserver(this.compositeObserver);</span>
<a href="#l30.22"></a><span id="l30.22" class="difflineat">@@ -323,17 +323,17 @@</span>
<a href="#l30.23"></a><span id="l30.23">       &lt;property name=&quot;tree&quot;</span>
<a href="#l30.24"></a><span id="l30.24">                 readonly=&quot;true&quot;</span>
<a href="#l30.25"></a><span id="l30.25">                 onget=&quot;return document.getAnonymousElementByAttribute(this, 'anonid', 'tree')&quot;/&gt;</span>
<a href="#l30.26"></a><span id="l30.26"> </span>
<a href="#l30.27"></a><span id="l30.27"> </span>
<a href="#l30.28"></a><span id="l30.28">       &lt;property name=&quot;sheet&quot; readonly=&quot;true&quot;&gt;</span>
<a href="#l30.29"></a><span id="l30.29">         &lt;getter&gt;&lt;![CDATA[</span>
<a href="#l30.30"></a><span id="l30.30">           if (!this.mCachedSheet) {</span>
<a href="#l30.31"></a><span id="l30.31" class="difflineminus">-              for each (let sheet in document.styleSheets) {</span>
<a href="#l30.32"></a><span id="l30.32" class="difflineplus">+              for (let sheet of document.styleSheets) {</span>
<a href="#l30.33"></a><span id="l30.33">                   if (sheet.href == &quot;chrome://calendar/skin/calendar-management.css&quot;) {</span>
<a href="#l30.34"></a><span id="l30.34">                       this.mCachedSheet = sheet;</span>
<a href="#l30.35"></a><span id="l30.35">                       break;</span>
<a href="#l30.36"></a><span id="l30.36">                   }</span>
<a href="#l30.37"></a><span id="l30.37">               }</span>
<a href="#l30.38"></a><span id="l30.38">               if (!this.mCachedSheet) {</span>
<a href="#l30.39"></a><span id="l30.39">                 cal.ERROR(&quot;Could not find calendar-management.css, needs to be added to &quot; +</span>
<a href="#l30.40"></a><span id="l30.40">                           window.document.title + &quot;'s stylesheets&quot;);</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l31.1"></a><span id="l31.1" class="difflineminus">--- a/calendar/base/content/widgets/calendar-widgets.xml</span>
<a href="#l31.2"></a><span id="l31.2" class="difflineplus">+++ b/calendar/base/content/widgets/calendar-widgets.xml</span>
<a href="#l31.3"></a><span id="l31.3" class="difflineat">@@ -174,28 +174,28 @@</span>
<a href="#l31.4"></a><span id="l31.4">         &lt;body&gt;&lt;![CDATA[</span>
<a href="#l31.5"></a><span id="l31.5">           let categoryListbox = document.getAnonymousElementByAttribute(this, &quot;anonid&quot;, &quot;categories-listbox&quot;);</span>
<a href="#l31.6"></a><span id="l31.6">           let categoryList = getPrefCategoriesArray();</span>
<a href="#l31.7"></a><span id="l31.7"> </span>
<a href="#l31.8"></a><span id="l31.8">           cal.sortArrayByLocaleCollator(categoryList);</span>
<a href="#l31.9"></a><span id="l31.9"> </span>
<a href="#l31.10"></a><span id="l31.10">           removeChildren(categoryListbox);</span>
<a href="#l31.11"></a><span id="l31.11"> </span>
<a href="#l31.12"></a><span id="l31.12" class="difflineminus">-          for each (let cat in categoryList) {</span>
<a href="#l31.13"></a><span id="l31.13" class="difflineplus">+          for (let cat of categoryList) {</span>
<a href="#l31.14"></a><span id="l31.14">               // First insert all categories from the prefs</span>
<a href="#l31.15"></a><span id="l31.15">               let item = categoryListbox.appendItem(cat, cat);</span>
<a href="#l31.16"></a><span id="l31.16">               item.setAttribute(&quot;type&quot;, &quot;checkbox&quot;);</span>
<a href="#l31.17"></a><span id="l31.17">           }</span>
<a href="#l31.18"></a><span id="l31.18"> </span>
<a href="#l31.19"></a><span id="l31.19">           if (aItem) {</span>
<a href="#l31.20"></a><span id="l31.20">               let localeCollator = cal.createLocaleCollator();</span>
<a href="#l31.21"></a><span id="l31.21">               let compare = localeCollator.compareString.bind(localeCollator, 0);</span>
<a href="#l31.22"></a><span id="l31.22"> </span>
<a href="#l31.23"></a><span id="l31.23">               // Ensure the item's categories are in the list and they are checked.</span>
<a href="#l31.24"></a><span id="l31.24" class="difflineminus">-              for each (let cat in aItem.getCategories({})) {</span>
<a href="#l31.25"></a><span id="l31.25" class="difflineplus">+              for (let cat of aItem.getCategories({})) {</span>
<a href="#l31.26"></a><span id="l31.26">                 this.insertCategory(cat, categoryList, categoryListbox, compare);</span>
<a href="#l31.27"></a><span id="l31.27">               }</span>
<a href="#l31.28"></a><span id="l31.28">           }</span>
<a href="#l31.29"></a><span id="l31.29">         ]]&gt;&lt;/body&gt;</span>
<a href="#l31.30"></a><span id="l31.30">       &lt;/method&gt;</span>
<a href="#l31.31"></a><span id="l31.31">     &lt;/implementation&gt;</span>
<a href="#l31.32"></a><span id="l31.32">   &lt;/binding&gt;</span>
<a href="#l31.33"></a><span id="l31.33"> </span>
<a href="#l31.34"></a><span id="l31.34" class="difflineat">@@ -562,18 +562,20 @@</span>
<a href="#l31.35"></a><span id="l31.35">         ]]&gt;&lt;/body&gt;</span>
<a href="#l31.36"></a><span id="l31.36">       &lt;/method&gt;</span>
<a href="#l31.37"></a><span id="l31.37"> </span>
<a href="#l31.38"></a><span id="l31.38">       &lt;!-- removes all dropShadows from the binding. Dropshadows are recognized</span>
<a href="#l31.39"></a><span id="l31.39">            as such by carrying an attribute &quot;dropshadow&quot; --&gt;</span>
<a href="#l31.40"></a><span id="l31.40">       &lt;method name=&quot;removeDropShadows&quot;&gt;</span>
<a href="#l31.41"></a><span id="l31.41">         &lt;body&gt;&lt;![CDATA[</span>
<a href="#l31.42"></a><span id="l31.42">             // method that may be overwritten by derived bindings...</span>
<a href="#l31.43"></a><span id="l31.43" class="difflineminus">-            for each (let shadow in this.calendarView.mDropShadows) {</span>
<a href="#l31.44"></a><span id="l31.44" class="difflineminus">-                cal.removeChildElementsByAttribute(shadow, &quot;class&quot;, &quot;dropshadow&quot;);</span>
<a href="#l31.45"></a><span id="l31.45" class="difflineplus">+            if (this.calendarView.mDropShadows) {</span>
<a href="#l31.46"></a><span id="l31.46" class="difflineplus">+                for (let shadow of this.calendarView.mDropShadows) {</span>
<a href="#l31.47"></a><span id="l31.47" class="difflineplus">+                    cal.removeChildElementsByAttribute(shadow, &quot;class&quot;, &quot;dropshadow&quot;);</span>
<a href="#l31.48"></a><span id="l31.48" class="difflineplus">+                }</span>
<a href="#l31.49"></a><span id="l31.49">             }</span>
<a href="#l31.50"></a><span id="l31.50">             this.calendarView.mDropShadows = null;</span>
<a href="#l31.51"></a><span id="l31.51">         ]]&gt;&lt;/body&gt;</span>
<a href="#l31.52"></a><span id="l31.52">       &lt;/method&gt;</span>
<a href="#l31.53"></a><span id="l31.53"> </span>
<a href="#l31.54"></a><span id="l31.54">       &lt;!-- By setting the attribute &quot;dropbox&quot; to &quot;true&quot; or &quot;false&quot; the</span>
<a href="#l31.55"></a><span id="l31.55">            dropshadows are added or removed --&gt;</span>
<a href="#l31.56"></a><span id="l31.56">       &lt;method name=&quot;setAttribute&quot;&gt;</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l32.1"></a><span id="l32.1" class="difflineminus">--- a/calendar/base/content/widgets/minimonth.xml</span>
<a href="#l32.2"></a><span id="l32.2" class="difflineplus">+++ b/calendar/base/content/widgets/minimonth.xml</span>
<a href="#l32.3"></a><span id="l32.3" class="difflineat">@@ -474,47 +474,47 @@</span>
<a href="#l32.4"></a><span id="l32.4">         &lt;parameter name=&quot;aItemType&quot;/&gt;</span>
<a href="#l32.5"></a><span id="l32.5">         &lt;parameter name=&quot;aDetail&quot;/&gt;</span>
<a href="#l32.6"></a><span id="l32.6">         &lt;parameter name=&quot;aCount&quot;/&gt;</span>
<a href="#l32.7"></a><span id="l32.7">         &lt;parameter name=&quot;aItems&quot;/&gt;</span>
<a href="#l32.8"></a><span id="l32.8">         &lt;body&gt;&lt;![CDATA[</span>
<a href="#l32.9"></a><span id="l32.9">             if (!Components.isSuccessCode(aStatus)) {</span>
<a href="#l32.10"></a><span id="l32.10">                 return;</span>
<a href="#l32.11"></a><span id="l32.11">             }</span>
<a href="#l32.12"></a><span id="l32.12" class="difflineminus">-            for each (var item in aItems) {</span>
<a href="#l32.13"></a><span id="l32.13" class="difflineplus">+            for (var item of aItems) {</span>
<a href="#l32.14"></a><span id="l32.14">                 this.setBusyDaysForOccurrence(item, true);</span>
<a href="#l32.15"></a><span id="l32.15">             }</span>
<a href="#l32.16"></a><span id="l32.16">         ]]&gt;&lt;/body&gt;</span>
<a href="#l32.17"></a><span id="l32.17">       &lt;/method&gt;</span>
<a href="#l32.18"></a><span id="l32.18"> </span>
<a href="#l32.19"></a><span id="l32.19">       &lt;method name=&quot;setBusyDaysForItem&quot;&gt;</span>
<a href="#l32.20"></a><span id="l32.20">         &lt;parameter name=&quot;aItem&quot;/&gt;</span>
<a href="#l32.21"></a><span id="l32.21">         &lt;parameter name=&quot;aState&quot;/&gt;</span>
<a href="#l32.22"></a><span id="l32.22">         &lt;body&gt;&lt;![CDATA[</span>
<a href="#l32.23"></a><span id="l32.23">           var items = [aItem];</span>
<a href="#l32.24"></a><span id="l32.24">           if (aItem.recurrenceInfo) {</span>
<a href="#l32.25"></a><span id="l32.25">               var startDate = this.firstDate;</span>
<a href="#l32.26"></a><span id="l32.26">               var endDate = this.lastDate;</span>
<a href="#l32.27"></a><span id="l32.27">               items = aItem.getOccurrencesBetween(startDate, endDate, {});</span>
<a href="#l32.28"></a><span id="l32.28">           }</span>
<a href="#l32.29"></a><span id="l32.29" class="difflineminus">-          for each (var item in items) {</span>
<a href="#l32.30"></a><span id="l32.30" class="difflineplus">+          for (var item of items) {</span>
<a href="#l32.31"></a><span id="l32.31">               this.setBusyDaysForOccurrence(item, aState);</span>
<a href="#l32.32"></a><span id="l32.32">           }</span>
<a href="#l32.33"></a><span id="l32.33">         ]]&gt;&lt;/body&gt;</span>
<a href="#l32.34"></a><span id="l32.34">       &lt;/method&gt;</span>
<a href="#l32.35"></a><span id="l32.35"> </span>
<a href="#l32.36"></a><span id="l32.36">       &lt;method name=&quot;parseBoxBusy&quot;&gt;</span>
<a href="#l32.37"></a><span id="l32.37">         &lt;parameter name=&quot;aBox&quot;/&gt;</span>
<a href="#l32.38"></a><span id="l32.38">         &lt;body&gt;&lt;![CDATA[</span>
<a href="#l32.39"></a><span id="l32.39">           let boxBusy = {};</span>
<a href="#l32.40"></a><span id="l32.40"> </span>
<a href="#l32.41"></a><span id="l32.41">           let busyStr = aBox.getAttribute(&quot;busy&quot;);</span>
<a href="#l32.42"></a><span id="l32.42">           if (busyStr &amp;&amp; busyStr.length &gt; 0) {</span>
<a href="#l32.43"></a><span id="l32.43">               let calChunks = busyStr.split(&quot;\u001A&quot;);</span>
<a href="#l32.44"></a><span id="l32.44" class="difflineminus">-              for each (let chunk in calChunks) {</span>
<a href="#l32.45"></a><span id="l32.45" class="difflineplus">+              for (let chunk of calChunks) {</span>
<a href="#l32.46"></a><span id="l32.46">                   let expr = chunk.split(&quot;=&quot;);</span>
<a href="#l32.47"></a><span id="l32.47">                   boxBusy[expr[0]] = parseInt(expr[1]);</span>
<a href="#l32.48"></a><span id="l32.48">               }</span>
<a href="#l32.49"></a><span id="l32.49">           }</span>
<a href="#l32.50"></a><span id="l32.50"> </span>
<a href="#l32.51"></a><span id="l32.51">           return boxBusy;</span>
<a href="#l32.52"></a><span id="l32.52">         ]]&gt;&lt;/body&gt;</span>
<a href="#l32.53"></a><span id="l32.53">       &lt;/method&gt;</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l33.1"></a><span id="l33.1" class="difflineminus">--- a/calendar/base/modules/calAuthUtils.jsm</span>
<a href="#l33.2"></a><span id="l33.2" class="difflineplus">+++ b/calendar/base/modules/calAuthUtils.jsm</span>
<a href="#l33.3"></a><span id="l33.3" class="difflineat">@@ -119,17 +119,17 @@ cal.auth = {</span>
<a href="#l33.4"></a><span id="l33.4">         }</span>
<a href="#l33.5"></a><span id="l33.5"> </span>
<a href="#l33.6"></a><span id="l33.6">         try {</span>
<a href="#l33.7"></a><span id="l33.7">             if (!Services.logins.getLoginSavingEnabled(aUsername)) {</span>
<a href="#l33.8"></a><span id="l33.8">                 return false;</span>
<a href="#l33.9"></a><span id="l33.9">             }</span>
<a href="#l33.10"></a><span id="l33.10"> </span>
<a href="#l33.11"></a><span id="l33.11">             let logins = Services.logins.findLogins({}, aHostName, null, aRealm);</span>
<a href="#l33.12"></a><span id="l33.12" class="difflineminus">-            for each (let loginInfo in logins) {</span>
<a href="#l33.13"></a><span id="l33.13" class="difflineplus">+            for (let loginInfo of logins) {</span>
<a href="#l33.14"></a><span id="l33.14">                 if (loginInfo.username == aUsername) {</span>
<a href="#l33.15"></a><span id="l33.15">                     aPassword.value = loginInfo.password;</span>
<a href="#l33.16"></a><span id="l33.16">                     return true;</span>
<a href="#l33.17"></a><span id="l33.17">                 }</span>
<a href="#l33.18"></a><span id="l33.18">             }</span>
<a href="#l33.19"></a><span id="l33.19">         } catch (exc) {</span>
<a href="#l33.20"></a><span id="l33.20">             cal.ASSERT(false, exc);</span>
<a href="#l33.21"></a><span id="l33.21">         }</span>
<a href="#l33.22"></a><span id="l33.22" class="difflineat">@@ -144,17 +144,17 @@ cal.auth = {</span>
<a href="#l33.23"></a><span id="l33.23">      * @param aRealm        The password realm (unused on branch)</span>
<a href="#l33.24"></a><span id="l33.24">      * @return              Could the user be removed?</span>
<a href="#l33.25"></a><span id="l33.25">      */</span>
<a href="#l33.26"></a><span id="l33.26">     passwordManagerRemove: function calPasswordManagerRemove(aUsername, aHostName, aRealm) {</span>
<a href="#l33.27"></a><span id="l33.27">         cal.ASSERT(aUsername);</span>
<a href="#l33.28"></a><span id="l33.28"> </span>
<a href="#l33.29"></a><span id="l33.29">         try {</span>
<a href="#l33.30"></a><span id="l33.30">             let logins = Services.logins.findLogins({}, aHostName, null, aRealm);</span>
<a href="#l33.31"></a><span id="l33.31" class="difflineminus">-            for each (let loginInfo in logins) {</span>
<a href="#l33.32"></a><span id="l33.32" class="difflineplus">+            for (let loginInfo of logins) {</span>
<a href="#l33.33"></a><span id="l33.33">                 if (loginInfo.username == aUsername) {</span>
<a href="#l33.34"></a><span id="l33.34">                     Services.logins.removeLogin(loginInfo);</span>
<a href="#l33.35"></a><span id="l33.35">                     return true;</span>
<a href="#l33.36"></a><span id="l33.36">                 }</span>
<a href="#l33.37"></a><span id="l33.37">             }</span>
<a href="#l33.38"></a><span id="l33.38">         } catch (exc) {</span>
<a href="#l33.39"></a><span id="l33.39">         }</span>
<a href="#l33.40"></a><span id="l33.40">         return false;</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l34.1"></a><span id="l34.1" class="difflineminus">--- a/calendar/base/modules/calItemUtils.jsm</span>
<a href="#l34.2"></a><span id="l34.2" class="difflineplus">+++ b/calendar/base/modules/calItemUtils.jsm</span>
<a href="#l34.3"></a><span id="l34.3" class="difflineat">@@ -63,17 +63,17 @@ itemDiff.prototype = {</span>
<a href="#l34.4"></a><span id="l34.4">      * Loads an array of items. This step cannot be executed</span>
<a href="#l34.5"></a><span id="l34.5">      * after calling the difference methods.</span>
<a href="#l34.6"></a><span id="l34.6">      *</span>
<a href="#l34.7"></a><span id="l34.7">      * @param items     The array of items to load</span>
<a href="#l34.8"></a><span id="l34.8">      */</span>
<a href="#l34.9"></a><span id="l34.9">     load: function load(items) {</span>
<a href="#l34.10"></a><span id="l34.10">         this._expectState(this.STATE_INITIAL | this.STATE_LOADING);</span>
<a href="#l34.11"></a><span id="l34.11"> </span>
<a href="#l34.12"></a><span id="l34.12" class="difflineminus">-        for each (let item in items) {</span>
<a href="#l34.13"></a><span id="l34.13" class="difflineplus">+        for (let item of items) {</span>
<a href="#l34.14"></a><span id="l34.14">             this.mInitialItems[item.hashId] = item;</span>
<a href="#l34.15"></a><span id="l34.15">         }</span>
<a href="#l34.16"></a><span id="l34.16"> </span>
<a href="#l34.17"></a><span id="l34.17">         this.state = this.STATE_LOADING;</span>
<a href="#l34.18"></a><span id="l34.18">     },</span>
<a href="#l34.19"></a><span id="l34.19"> </span>
<a href="#l34.20"></a><span id="l34.20">     /**</span>
<a href="#l34.21"></a><span id="l34.21">      * Calculates the difference for the passed item, see difference.</span>
<a href="#l34.22"></a><span id="l34.22" class="difflineat">@@ -92,17 +92,17 @@ itemDiff.prototype = {</span>
<a href="#l34.23"></a><span id="l34.23">      */</span>
<a href="#l34.24"></a><span id="l34.24">     difference: function difference(items) {</span>
<a href="#l34.25"></a><span id="l34.25">         this._expectState(this.STATE_INITIAL | this.STATE_LOADING | this.STATE_DIFFERING);</span>
<a href="#l34.26"></a><span id="l34.26"> </span>
<a href="#l34.27"></a><span id="l34.27">         this.mModifiedOldItems.startBatch();</span>
<a href="#l34.28"></a><span id="l34.28">         this.mModifiedItems.startBatch();</span>
<a href="#l34.29"></a><span id="l34.29">         this.mAddedItems.startBatch();</span>
<a href="#l34.30"></a><span id="l34.30"> </span>
<a href="#l34.31"></a><span id="l34.31" class="difflineminus">-        for each (let item in items) {</span>
<a href="#l34.32"></a><span id="l34.32" class="difflineplus">+        for (let item of items) {</span>
<a href="#l34.33"></a><span id="l34.33">             if (item.hashId in this.mInitialItems) {</span>
<a href="#l34.34"></a><span id="l34.34">                 let oldItem = this.mInitialItems[item.hashId];</span>
<a href="#l34.35"></a><span id="l34.35">                 this.mModifiedOldItems.addItem(oldItem);</span>
<a href="#l34.36"></a><span id="l34.36">                 this.mModifiedItems.addItem(item);</span>
<a href="#l34.37"></a><span id="l34.37">             } else {</span>
<a href="#l34.38"></a><span id="l34.38">                 this.mAddedItems.addItem(item);</span>
<a href="#l34.39"></a><span id="l34.39">             }</span>
<a href="#l34.40"></a><span id="l34.40">             delete this.mInitialItems[item.hashId];</span>
<a href="#l34.41"></a><span id="l34.41" class="difflineat">@@ -119,17 +119,18 @@ itemDiff.prototype = {</span>
<a href="#l34.42"></a><span id="l34.42">      * Tell the engine that all load and difference calls have been made, this</span>
<a href="#l34.43"></a><span id="l34.43">      * makes sure that all item states are correctly returned.</span>
<a href="#l34.44"></a><span id="l34.44">      */</span>
<a href="#l34.45"></a><span id="l34.45">     complete: function complete() {</span>
<a href="#l34.46"></a><span id="l34.46">         this._expectState(this.STATE_INITIAL | this.STATE_LOADING | this.STATE_DIFFERING);</span>
<a href="#l34.47"></a><span id="l34.47"> </span>
<a href="#l34.48"></a><span id="l34.48">         this.mDeletedItems.startBatch();</span>
<a href="#l34.49"></a><span id="l34.49"> </span>
<a href="#l34.50"></a><span id="l34.50" class="difflineminus">-        for each (let item in this.mInitialItems) {</span>
<a href="#l34.51"></a><span id="l34.51" class="difflineplus">+        for (let hashId in this.mInitialItems) {</span>
<a href="#l34.52"></a><span id="l34.52" class="difflineplus">+            let item = this.mInitialItems[hashId];</span>
<a href="#l34.53"></a><span id="l34.53">             this.mDeletedItems.addItem(item);</span>
<a href="#l34.54"></a><span id="l34.54">         }</span>
<a href="#l34.55"></a><span id="l34.55"> </span>
<a href="#l34.56"></a><span id="l34.56">         this.mDeletedItems.endBatch();</span>
<a href="#l34.57"></a><span id="l34.57">         this.mInitialItems = {};</span>
<a href="#l34.58"></a><span id="l34.58"> </span>
<a href="#l34.59"></a><span id="l34.59">         this.state = this.STATE_COMPLETED;</span>
<a href="#l34.60"></a><span id="l34.60">     },</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l35.1"></a><span id="l35.1" class="difflineminus">--- a/calendar/base/modules/calIteratorUtils.jsm</span>
<a href="#l35.2"></a><span id="l35.2" class="difflineplus">+++ b/calendar/base/modules/calIteratorUtils.jsm</span>
<a href="#l35.3"></a><span id="l35.3" class="difflineat">@@ -13,21 +13,21 @@ this.EXPORTED_SYMBOLS = [&quot;cal&quot;]; // even</span>
<a href="#l35.4"></a><span id="l35.4">  * overridden instances of a recurring series.</span>
<a href="#l35.5"></a><span id="l35.5">  *</span>
<a href="#l35.6"></a><span id="l35.6">  * @param items array of items</span>
<a href="#l35.7"></a><span id="l35.7">  */</span>
<a href="#l35.8"></a><span id="l35.8"> cal.itemIterator = function cal_itemIterator(items) {</span>
<a href="#l35.9"></a><span id="l35.9">     return {</span>
<a href="#l35.10"></a><span id="l35.10">         __iterator__: function itemIterator(aWantKeys) {</span>
<a href="#l35.11"></a><span id="l35.11">             cal.ASSERT(aWantKeys, &quot;Please use for() on the item iterator&quot;);</span>
<a href="#l35.12"></a><span id="l35.12" class="difflineminus">-            for each (let item in items) {</span>
<a href="#l35.13"></a><span id="l35.13" class="difflineplus">+            for (let item of items) {</span>
<a href="#l35.14"></a><span id="l35.14">                 yield item;</span>
<a href="#l35.15"></a><span id="l35.15">                 let rec = item.recurrenceInfo;</span>
<a href="#l35.16"></a><span id="l35.16">                 if (rec) {</span>
<a href="#l35.17"></a><span id="l35.17" class="difflineminus">-                    for each (let exid in rec.getExceptionIds({})) {</span>
<a href="#l35.18"></a><span id="l35.18" class="difflineplus">+                    for (let exid of rec.getExceptionIds({})) {</span>
<a href="#l35.19"></a><span id="l35.19">                         yield rec.getExceptionFor(exid);</span>
<a href="#l35.20"></a><span id="l35.20">                     }</span>
<a href="#l35.21"></a><span id="l35.21">                 }</span>
<a href="#l35.22"></a><span id="l35.22">             }</span>
<a href="#l35.23"></a><span id="l35.23">         }</span>
<a href="#l35.24"></a><span id="l35.24">     };</span>
<a href="#l35.25"></a><span id="l35.25"> };</span>
<a href="#l35.26"></a><span id="l35.26"> </span>
<a href="#l35.27"></a><span id="l35.27" class="difflineat">@@ -39,31 +39,39 @@ cal.itemIterator = function cal_itemIter</span>
<a href="#l35.28"></a><span id="l35.28">  *</span>
<a href="#l35.29"></a><span id="l35.29">  * If you would like to break or continue inside the body(), return either</span>
<a href="#l35.30"></a><span id="l35.30">  *     cal.forEach.BREAK or cal.forEach.CONTINUE</span>
<a href="#l35.31"></a><span id="l35.31">  *</span>
<a href="#l35.32"></a><span id="l35.32">  * Note since the event queue is used, this function will return immediately,</span>
<a href="#l35.33"></a><span id="l35.33">  * before the iteration is complete. If you need to run actions after the real</span>
<a href="#l35.34"></a><span id="l35.34">  * for each loop, use the optional completed() function.</span>
<a href="#l35.35"></a><span id="l35.35">  *</span>
<a href="#l35.36"></a><span id="l35.36" class="difflineminus">- * @param iter          The Iterator to go through in this loop.</span>
<a href="#l35.37"></a><span id="l35.37" class="difflineplus">+ * @param iter          The Iterator or the plain Object to go through in this</span>
<a href="#l35.38"></a><span id="l35.38" class="difflineplus">+ *                      loop.</span>
<a href="#l35.39"></a><span id="l35.39">  * @param body          The function called for each iteration. Its parameter is</span>
<a href="#l35.40"></a><span id="l35.40">  *                          the single item from the iterator.</span>
<a href="#l35.41"></a><span id="l35.41">  * @param completed     [optional] The function called after the loop completes.</span>
<a href="#l35.42"></a><span id="l35.42">  */</span>
<a href="#l35.43"></a><span id="l35.43"> cal.forEach = function cal_forEach(iter, body, completed) {</span>
<a href="#l35.44"></a><span id="l35.44">     // This should be a const one day, lets keep it a pref for now though until we</span>
<a href="#l35.45"></a><span id="l35.45">     // find a sane value.</span>
<a href="#l35.46"></a><span id="l35.46">     let LATENCY = Preferences.get(&quot;calendar.threading.latency&quot;, 250);</span>
<a href="#l35.47"></a><span id="l35.47"> </span>
<a href="#l35.48"></a><span id="l35.48">     let ourIter = iter;</span>
<a href="#l35.49"></a><span id="l35.49">     if (!(iter instanceof Iterator)) {</span>
<a href="#l35.50"></a><span id="l35.50" class="difflineminus">-        // If its not an iterator, we need to use a generator expression to make</span>
<a href="#l35.51"></a><span id="l35.51" class="difflineminus">-        // sure calling this function feels right.</span>
<a href="#l35.52"></a><span id="l35.52" class="difflineminus">-        ourIter = (i for each (i in iter));</span>
<a href="#l35.53"></a><span id="l35.53" class="difflineplus">+        // If its not an iterator, we need to use a generator to make sure</span>
<a href="#l35.54"></a><span id="l35.54" class="difflineplus">+        // calling this function feels right.</span>
<a href="#l35.55"></a><span id="l35.55" class="difflineplus">+        // FIXME: Dispatcher needs StopIteration, so we use legacy generator</span>
<a href="#l35.56"></a><span id="l35.56" class="difflineplus">+        // here for now.  Should be replaced with ES6 generator in the future,</span>
<a href="#l35.57"></a><span id="l35.57" class="difflineplus">+        // when removing Iterator from caller.</span>
<a href="#l35.58"></a><span id="l35.58" class="difflineplus">+        ourIter = (function() {</span>
<a href="#l35.59"></a><span id="l35.59" class="difflineplus">+            for (let key in iter) {</span>
<a href="#l35.60"></a><span id="l35.60" class="difflineplus">+              yield iter[key];</span>
<a href="#l35.61"></a><span id="l35.61" class="difflineplus">+            }</span>
<a href="#l35.62"></a><span id="l35.62" class="difflineplus">+        })();</span>
<a href="#l35.63"></a><span id="l35.63">     }</span>
<a href="#l35.64"></a><span id="l35.64"> </span>
<a href="#l35.65"></a><span id="l35.65">     let currentThread = Services.tm.currentThread;</span>
<a href="#l35.66"></a><span id="l35.66"> </span>
<a href="#l35.67"></a><span id="l35.67">     // This is our dispatcher, it will be used for the iterations</span>
<a href="#l35.68"></a><span id="l35.68">     let dispatcher = {</span>
<a href="#l35.69"></a><span id="l35.69">         run: function run() {</span>
<a href="#l35.70"></a><span id="l35.70">             try {</span>
<a href="#l35.71"></a><span id="l35.71" class="difflineat">@@ -192,27 +200,34 @@ cal.ical = {</span>
<a href="#l35.72"></a><span id="l35.72">         };</span>
<a href="#l35.73"></a><span id="l35.73">     },</span>
<a href="#l35.74"></a><span id="l35.74"> </span>
<a href="#l35.75"></a><span id="l35.75">     /**</span>
<a href="#l35.76"></a><span id="l35.76">      * Use to iterate through all parameters of a calIIcalProperty.</span>
<a href="#l35.77"></a><span id="l35.77">      * This iterator behaves similar to the object iterator. Possible uses:</span>
<a href="#l35.78"></a><span id="l35.78">      *   for (let paramName in cal.ical.paramIterator(prop)) { ... }</span>
<a href="#l35.79"></a><span id="l35.79">      * or:</span>
<a href="#l35.80"></a><span id="l35.80" class="difflineminus">-     *   for each (let [paramName, paramValue] in cal.ical.paramIterator(prop)) { ... }</span>
<a href="#l35.81"></a><span id="l35.81" class="difflineplus">+     *   for (let [paramName, paramValue] of cal.ical.paramIterator(prop)) { ... }</span>
<a href="#l35.82"></a><span id="l35.82">      *</span>
<a href="#l35.83"></a><span id="l35.83">      * @param aProperty         The property to iterate.</span>
<a href="#l35.84"></a><span id="l35.84">      * @return                  An iterator object to iterate the properties.</span>
<a href="#l35.85"></a><span id="l35.85">      */</span>
<a href="#l35.86"></a><span id="l35.86">     paramIterator: function cal_ical_paramIterator(aProperty) {</span>
<a href="#l35.87"></a><span id="l35.87">         return {</span>
<a href="#l35.88"></a><span id="l35.88">             __iterator__: function icalParamIterator(aWantKeys) {</span>
<a href="#l35.89"></a><span id="l35.89">                 for (let paramName = aProperty.getFirstParameterName();</span>
<a href="#l35.90"></a><span id="l35.90">                      paramName;</span>
<a href="#l35.91"></a><span id="l35.91">                      paramName = aProperty.getNextParameterName()) {</span>
<a href="#l35.92"></a><span id="l35.92">                     yield (aWantKeys ? paramName :</span>
<a href="#l35.93"></a><span id="l35.93">                            [paramName, aProperty.getParameter(paramName)]);</span>
<a href="#l35.94"></a><span id="l35.94">                 }</span>
<a href="#l35.95"></a><span id="l35.95" class="difflineplus">+            },</span>
<a href="#l35.96"></a><span id="l35.96" class="difflineplus">+            [Symbol.iterator]: function* icalParamIterator() {</span>
<a href="#l35.97"></a><span id="l35.97" class="difflineplus">+                for (let paramName = aProperty.getFirstParameterName();</span>
<a href="#l35.98"></a><span id="l35.98" class="difflineplus">+                     paramName;</span>
<a href="#l35.99"></a><span id="l35.99" class="difflineplus">+                     paramName = aProperty.getNextParameterName()) {</span>
<a href="#l35.100"></a><span id="l35.100" class="difflineplus">+                    yield [paramName, aProperty.getParameter(paramName)];</span>
<a href="#l35.101"></a><span id="l35.101" class="difflineplus">+                }</span>
<a href="#l35.102"></a><span id="l35.102">             }</span>
<a href="#l35.103"></a><span id="l35.103" class="difflineminus">-        }</span>
<a href="#l35.104"></a><span id="l35.104" class="difflineplus">+        };</span>
<a href="#l35.105"></a><span id="l35.105">     }</span>
<a href="#l35.106"></a><span id="l35.106"> };</span>
<a href="#l35.107"></a><span id="l35.107"> </span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l36.1"></a><span id="l36.1" class="difflineminus">--- a/calendar/base/modules/calItipUtils.jsm</span>
<a href="#l36.2"></a><span id="l36.2" class="difflineplus">+++ b/calendar/base/modules/calItipUtils.jsm</span>
<a href="#l36.3"></a><span id="l36.3" class="difflineat">@@ -544,17 +544,17 @@ cal.itip = {</span>
<a href="#l36.4"></a><span id="l36.4">                     return;</span>
<a href="#l36.5"></a><span id="l36.5">                 }</span>
<a href="#l36.6"></a><span id="l36.6">             }</span>
<a href="#l36.7"></a><span id="l36.7"> </span>
<a href="#l36.8"></a><span id="l36.8">             if (aOriginalItem.recurrenceInfo &amp;&amp; aItem.recurrenceInfo) {</span>
<a href="#l36.9"></a><span id="l36.9">                 // check whether the two differ only in EXDATEs</span>
<a href="#l36.10"></a><span id="l36.10">                 let clonedItem = aItem.clone();</span>
<a href="#l36.11"></a><span id="l36.11">                 let exdates = [];</span>
<a href="#l36.12"></a><span id="l36.12" class="difflineminus">-                for each (let ritem in clonedItem.recurrenceInfo.getRecurrenceItems({})) {</span>
<a href="#l36.13"></a><span id="l36.13" class="difflineplus">+                for (let ritem of clonedItem.recurrenceInfo.getRecurrenceItems({})) {</span>
<a href="#l36.14"></a><span id="l36.14"> </span>
<a href="#l36.15"></a><span id="l36.15">                     let wrappedRItem = cal.wrapInstance(ritem, Components.interfaces.calIRecurrenceDate);</span>
<a href="#l36.16"></a><span id="l36.16">                     if (ritem.isNegative &amp;&amp;</span>
<a href="#l36.17"></a><span id="l36.17">                         wrappedRItem &amp;&amp;</span>
<a href="#l36.18"></a><span id="l36.18">                         !aOriginalItem.recurrenceInfo.getRecurrenceItems({}).some(</span>
<a href="#l36.19"></a><span id="l36.19">                             function(r) {</span>
<a href="#l36.20"></a><span id="l36.20">                                 let wrappedR = cal.wrapInstance(r, Components.interfaces.calIRecurrenceDate);</span>
<a href="#l36.21"></a><span id="l36.21">                                 return (r.isNegative &amp;&amp;</span>
<a href="#l36.22"></a><span id="l36.22" class="difflineat">@@ -675,31 +675,32 @@ cal.itip = {</span>
<a href="#l36.23"></a><span id="l36.23"> </span>
<a href="#l36.24"></a><span id="l36.24">         let originalAtt = (aOriginalItem ? aOriginalItem.getAttendees({}) : []);</span>
<a href="#l36.25"></a><span id="l36.25">         let itemAtt = aItem.getAttendees({});</span>
<a href="#l36.26"></a><span id="l36.26">         let canceledAttendees = [];</span>
<a href="#l36.27"></a><span id="l36.27">         let addedAttendees = [];</span>
<a href="#l36.28"></a><span id="l36.28"> </span>
<a href="#l36.29"></a><span id="l36.29">         if (itemAtt.length &gt; 0 || originalAtt.length &gt; 0) {</span>
<a href="#l36.30"></a><span id="l36.30">             let attMap = {};</span>
<a href="#l36.31"></a><span id="l36.31" class="difflineminus">-            for each (let att in originalAtt) {</span>
<a href="#l36.32"></a><span id="l36.32" class="difflineplus">+            for (let att of originalAtt) {</span>
<a href="#l36.33"></a><span id="l36.33">                 attMap[att.id.toLowerCase()] = att;</span>
<a href="#l36.34"></a><span id="l36.34">             }</span>
<a href="#l36.35"></a><span id="l36.35"> </span>
<a href="#l36.36"></a><span id="l36.36" class="difflineminus">-            for each (let att in itemAtt) {</span>
<a href="#l36.37"></a><span id="l36.37" class="difflineplus">+            for (let att of itemAtt) {</span>
<a href="#l36.38"></a><span id="l36.38">                 if (att.id.toLowerCase() in attMap) {</span>
<a href="#l36.39"></a><span id="l36.39">                     // Attendee was in original item.</span>
<a href="#l36.40"></a><span id="l36.40">                     delete attMap[att.id.toLowerCase()];</span>
<a href="#l36.41"></a><span id="l36.41">                 } else {</span>
<a href="#l36.42"></a><span id="l36.42">                     // Attendee only in new item</span>
<a href="#l36.43"></a><span id="l36.43">                     addedAttendees.push(att);</span>
<a href="#l36.44"></a><span id="l36.44">                 }</span>
<a href="#l36.45"></a><span id="l36.45">             }</span>
<a href="#l36.46"></a><span id="l36.46"> </span>
<a href="#l36.47"></a><span id="l36.47" class="difflineminus">-            for each (let cancAtt in attMap) {</span>
<a href="#l36.48"></a><span id="l36.48" class="difflineplus">+            for (let id in attMap) {</span>
<a href="#l36.49"></a><span id="l36.49" class="difflineplus">+                let cancAtt = attMap[id];</span>
<a href="#l36.50"></a><span id="l36.50">                 canceledAttendees.push(cancAtt);</span>
<a href="#l36.51"></a><span id="l36.51">             }</span>
<a href="#l36.52"></a><span id="l36.52">         }</span>
<a href="#l36.53"></a><span id="l36.53"> </span>
<a href="#l36.54"></a><span id="l36.54">         // setting default value to control for sending (cancellation) messages</span>
<a href="#l36.55"></a><span id="l36.55">         // this will be set to false, once the user cancels sending manually</span>
<a href="#l36.56"></a><span id="l36.56">         let sendOut = true;</span>
<a href="#l36.57"></a><span id="l36.57">         // Check to see if some part of the item was updated, if so, re-send REQUEST</span>
<a href="#l36.58"></a><span id="l36.58" class="difflineat">@@ -717,17 +718,17 @@ cal.itip = {</span>
<a href="#l36.59"></a><span id="l36.59">                 }</span>
<a href="#l36.60"></a><span id="l36.60"> </span>
<a href="#l36.61"></a><span id="l36.61">                 // Fix up our attendees for invitations using some good defaults</span>
<a href="#l36.62"></a><span id="l36.62">                 let recipients = [];</span>
<a href="#l36.63"></a><span id="l36.63">                 let itemAtt = requestItem.getAttendees({});</span>
<a href="#l36.64"></a><span id="l36.64">                 if (!isMinorUpdate) {</span>
<a href="#l36.65"></a><span id="l36.65">                     requestItem.removeAllAttendees();</span>
<a href="#l36.66"></a><span id="l36.66">                 }</span>
<a href="#l36.67"></a><span id="l36.67" class="difflineminus">-                for each (let attendee in itemAtt) {</span>
<a href="#l36.68"></a><span id="l36.68" class="difflineplus">+                for (let attendee of itemAtt) {</span>
<a href="#l36.69"></a><span id="l36.69">                     if (!isMinorUpdate) {</span>
<a href="#l36.70"></a><span id="l36.70">                         attendee = attendee.clone();</span>
<a href="#l36.71"></a><span id="l36.71">                         if (!attendee.role) {</span>
<a href="#l36.72"></a><span id="l36.72">                             attendee.role = &quot;REQ-PARTICIPANT&quot;;</span>
<a href="#l36.73"></a><span id="l36.73">                         }</span>
<a href="#l36.74"></a><span id="l36.74">                         attendee.participationStatus = &quot;NEEDS-ACTION&quot;;</span>
<a href="#l36.75"></a><span id="l36.75">                         attendee.rsvp = &quot;TRUE&quot;;</span>
<a href="#l36.76"></a><span id="l36.76">                         requestItem.addAttendee(attendee);</span>
<a href="#l36.77"></a><span id="l36.77" class="difflineat">@@ -752,17 +753,17 @@ cal.itip = {</span>
<a href="#l36.78"></a><span id="l36.78"> </span>
<a href="#l36.79"></a><span id="l36.79">             }</span>
<a href="#l36.80"></a><span id="l36.80">         }</span>
<a href="#l36.81"></a><span id="l36.81"> </span>
<a href="#l36.82"></a><span id="l36.82">         // Cancel the event for all canceled attendees</span>
<a href="#l36.83"></a><span id="l36.83">         if (canceledAttendees.length &gt; 0) {</span>
<a href="#l36.84"></a><span id="l36.84">             let cancelItem = aOriginalItem.clone();</span>
<a href="#l36.85"></a><span id="l36.85">             cancelItem.removeAllAttendees();</span>
<a href="#l36.86"></a><span id="l36.86" class="difflineminus">-            for each (let att in canceledAttendees) {</span>
<a href="#l36.87"></a><span id="l36.87" class="difflineplus">+            for (let att of canceledAttendees) {</span>
<a href="#l36.88"></a><span id="l36.88">                 cancelItem.addAttendee(att);</span>
<a href="#l36.89"></a><span id="l36.89">             }</span>
<a href="#l36.90"></a><span id="l36.90">             if (sendOut) {</span>
<a href="#l36.91"></a><span id="l36.91">                 sendMessage(cancelItem, &quot;CANCEL&quot;, canceledAttendees, autoResponse);</span>
<a href="#l36.92"></a><span id="l36.92">             }</span>
<a href="#l36.93"></a><span id="l36.93">         }</span>
<a href="#l36.94"></a><span id="l36.94">     },</span>
<a href="#l36.95"></a><span id="l36.95"> </span>
<a href="#l36.96"></a><span id="l36.96" class="difflineat">@@ -907,33 +908,33 @@ function stripUserData(item_) {</span>
<a href="#l36.97"></a><span id="l36.97">  * @param item         the stored calendar item to update</span>
<a href="#l36.98"></a><span id="l36.98">  * @param itipItemItem the received item</span>
<a href="#l36.99"></a><span id="l36.99">  */</span>
<a href="#l36.100"></a><span id="l36.100"> function updateItem(item, itipItemItem) {</span>
<a href="#l36.101"></a><span id="l36.101">     function updateUserData(newItem, item) {</span>
<a href="#l36.102"></a><span id="l36.102">         // preserve user settings:</span>
<a href="#l36.103"></a><span id="l36.103">         newItem.generation = item.generation;</span>
<a href="#l36.104"></a><span id="l36.104">         newItem.clearAlarms();</span>
<a href="#l36.105"></a><span id="l36.105" class="difflineminus">-        for each (let alarm in item.getAlarms({})) {</span>
<a href="#l36.106"></a><span id="l36.106" class="difflineplus">+        for (let alarm of item.getAlarms({})) {</span>
<a href="#l36.107"></a><span id="l36.107">             newItem.addAlarm(alarm);</span>
<a href="#l36.108"></a><span id="l36.108">         }</span>
<a href="#l36.109"></a><span id="l36.109">         newItem.alarmLastAck = item.alarmLastAck;</span>
<a href="#l36.110"></a><span id="l36.110">         let cats = item.getCategories({});</span>
<a href="#l36.111"></a><span id="l36.111">         newItem.setCategories(cats.length, cats);</span>
<a href="#l36.112"></a><span id="l36.112">     }</span>
<a href="#l36.113"></a><span id="l36.113"> </span>
<a href="#l36.114"></a><span id="l36.114">     let newItem = item.clone();</span>
<a href="#l36.115"></a><span id="l36.115">     newItem.icalComponent = itipItemItem.icalComponent;</span>
<a href="#l36.116"></a><span id="l36.116">     setReceivedInfo(newItem, itipItemItem);</span>
<a href="#l36.117"></a><span id="l36.117">     updateUserData(newItem, item);</span>
<a href="#l36.118"></a><span id="l36.118"> </span>
<a href="#l36.119"></a><span id="l36.119">     let recInfo = itipItemItem.recurrenceInfo;</span>
<a href="#l36.120"></a><span id="l36.120">     if (recInfo) {</span>
<a href="#l36.121"></a><span id="l36.121">         // keep care of installing all overridden items, and mind existing alarms, categories:</span>
<a href="#l36.122"></a><span id="l36.122" class="difflineminus">-        for each (let rid in recInfo.getExceptionIds({})) {</span>
<a href="#l36.123"></a><span id="l36.123" class="difflineplus">+        for (let rid of recInfo.getExceptionIds({})) {</span>
<a href="#l36.124"></a><span id="l36.124">             let excItem = recInfo.getExceptionFor(rid).clone();</span>
<a href="#l36.125"></a><span id="l36.125">             cal.ASSERT(excItem, &quot;unexpected!&quot;);</span>
<a href="#l36.126"></a><span id="l36.126">             let newExc = newItem.recurrenceInfo.getOccurrenceFor(rid).clone();</span>
<a href="#l36.127"></a><span id="l36.127">             newExc.icalComponent = excItem.icalComponent;</span>
<a href="#l36.128"></a><span id="l36.128">             setReceivedInfo(newExc, itipItemItem);</span>
<a href="#l36.129"></a><span id="l36.129">             let existingExcItem = (item.recurrenceInfo &amp;&amp; item.recurrenceInfo.getExceptionFor(rid));</span>
<a href="#l36.130"></a><span id="l36.130">             if (existingExcItem) {</span>
<a href="#l36.131"></a><span id="l36.131">                 updateUserData(newExc, existingExcItem);</span>
<a href="#l36.132"></a><span id="l36.132" class="difflineat">@@ -951,17 +952,17 @@ function updateItem(item, itipItemItem) </span>
<a href="#l36.133"></a><span id="l36.133">  *</span>
<a href="#l36.134"></a><span id="l36.134">  * @param itipItem      The itip item containing the receivedMethod.</span>
<a href="#l36.135"></a><span id="l36.135">  * @param itipItemItem  The calendar item inside the itip item.</span>
<a href="#l36.136"></a><span id="l36.136">  * @param item          The target item to copy to.</span>
<a href="#l36.137"></a><span id="l36.137">  */</span>
<a href="#l36.138"></a><span id="l36.138"> function copyProviderProperties(itipItem, itipItemItem, item) {</span>
<a href="#l36.139"></a><span id="l36.139">     // Copy over itip properties to the item if requested by the provider</span>
<a href="#l36.140"></a><span id="l36.140">     let copyProps = item.calendar.getProperty(&quot;itip.copyProperties&quot;) || [];</span>
<a href="#l36.141"></a><span id="l36.141" class="difflineminus">-    for each (let prop in copyProps) {</span>
<a href="#l36.142"></a><span id="l36.142" class="difflineplus">+    for (let prop of copyProps) {</span>
<a href="#l36.143"></a><span id="l36.143">         if (prop == &quot;METHOD&quot;) {</span>
<a href="#l36.144"></a><span id="l36.144">             // Special case, this copies over the received method</span>
<a href="#l36.145"></a><span id="l36.145">             item.setProperty(&quot;METHOD&quot;, itipItem.receivedMethod.toUpperCase());</span>
<a href="#l36.146"></a><span id="l36.146">         } else if (itipItemItem.hasProperty(prop)) {</span>
<a href="#l36.147"></a><span id="l36.147">             // Otherwise just copy from the item contained in the itipItem</span>
<a href="#l36.148"></a><span id="l36.148">             item.setProperty(prop, itipItemItem.getProperty(prop));</span>
<a href="#l36.149"></a><span id="l36.149">         }</span>
<a href="#l36.150"></a><span id="l36.150">     }</span>
<a href="#l36.151"></a><span id="l36.151" class="difflineat">@@ -1033,17 +1034,17 @@ function sendMessage(aItem, aMethod, aRe</span>
<a href="#l36.152"></a><span id="l36.152">     };</span>
<a href="#l36.153"></a><span id="l36.153"> </span>
<a href="#l36.154"></a><span id="l36.154">     // split up transport, if attendee undisclosure is requested</span>
<a href="#l36.155"></a><span id="l36.155">     // and this is a message send by the organizer</span>
<a href="#l36.156"></a><span id="l36.156">     if((aItem.getProperty(&quot;X-MOZ-SEND-INVITATIONS-UNDISCLOSED&quot;) == &quot;TRUE&quot;) &amp;&amp;</span>
<a href="#l36.157"></a><span id="l36.157">        aMethod != &quot;REPLY&quot; &amp;&amp;</span>
<a href="#l36.158"></a><span id="l36.158">        aMethod != &quot;REFRESH&quot; &amp;&amp;</span>
<a href="#l36.159"></a><span id="l36.159">        aMethod != &quot;COUNTER&quot;) {</span>
<a href="#l36.160"></a><span id="l36.160" class="difflineminus">-        for each( aRecipient in aRecipientsList) {</span>
<a href="#l36.161"></a><span id="l36.161" class="difflineplus">+        for (let aRecipient of aRecipientsList) {</span>
<a href="#l36.162"></a><span id="l36.162">             // create a list with a single recipient</span>
<a href="#l36.163"></a><span id="l36.163">             let sendToList = [aRecipient];</span>
<a href="#l36.164"></a><span id="l36.164">             // remove other recipients from vevent attendee list</span>
<a href="#l36.165"></a><span id="l36.165">             let sendItem = aItem.clone();</span>
<a href="#l36.166"></a><span id="l36.166">             sendItem.removeAllAttendees();</span>
<a href="#l36.167"></a><span id="l36.167">             sendItem.addAttendee(aRecipient);</span>
<a href="#l36.168"></a><span id="l36.168">             // send message</span>
<a href="#l36.169"></a><span id="l36.169">             if (!_sendItem(sendToList, sendItem)) {</span>
<a href="#l36.170"></a><span id="l36.170" class="difflineat">@@ -1265,18 +1266,18 @@ ItipItemFinder.prototype = {</span>
<a href="#l36.171"></a><span id="l36.171">                 //           implicitly on the parent (ics/memory/storage calls modifyException),</span>
<a href="#l36.172"></a><span id="l36.172">                 //           the generation check will fail. We should really consider to allow</span>
<a href="#l36.173"></a><span id="l36.173">                 //           deletion/modification/addition of occurrences directly on the providers,</span>
<a href="#l36.174"></a><span id="l36.174">                 //           which would ease client code a lot.</span>
<a href="#l36.175"></a><span id="l36.175">                 case &quot;REFRESH&quot;:</span>
<a href="#l36.176"></a><span id="l36.176">                 case &quot;PUBLISH&quot;:</span>
<a href="#l36.177"></a><span id="l36.177">                 case &quot;REQUEST&quot;:</span>
<a href="#l36.178"></a><span id="l36.178">                 case &quot;REPLY&quot;:</span>
<a href="#l36.179"></a><span id="l36.179" class="difflineminus">-                    for each (let itipItemItem in this.mItipItem.getItemList({})) {</span>
<a href="#l36.180"></a><span id="l36.180" class="difflineminus">-                        for each (let item in this.mFoundItems) {</span>
<a href="#l36.181"></a><span id="l36.181" class="difflineplus">+                    for (let itipItemItem of this.mItipItem.getItemList({})) {</span>
<a href="#l36.182"></a><span id="l36.182" class="difflineplus">+                        for (let item of this.mFoundItems) {</span>
<a href="#l36.183"></a><span id="l36.183">                             let rid = itipItemItem.recurrenceId; //  XXX todo support multiple</span>
<a href="#l36.184"></a><span id="l36.184">                             if (rid) { // actually applies to individual occurrence(s)</span>
<a href="#l36.185"></a><span id="l36.185">                                 if (item.recurrenceInfo) {</span>
<a href="#l36.186"></a><span id="l36.186">                                     item = item.recurrenceInfo.getOccurrenceFor(rid);</span>
<a href="#l36.187"></a><span id="l36.187">                                     if (!item) {</span>
<a href="#l36.188"></a><span id="l36.188">                                         continue;</span>
<a href="#l36.189"></a><span id="l36.189">                                     }</span>
<a href="#l36.190"></a><span id="l36.190">                                 } else { // the item has been rescheduled with master:</span>
<a href="#l36.191"></a><span id="l36.191" class="difflineat">@@ -1407,18 +1408,18 @@ ItipItemFinder.prototype = {</span>
<a href="#l36.192"></a><span id="l36.192">                                     break;</span>
<a href="#l36.193"></a><span id="l36.193">                                 }</span>
<a href="#l36.194"></a><span id="l36.194">                             }</span>
<a href="#l36.195"></a><span id="l36.195">                         }</span>
<a href="#l36.196"></a><span id="l36.196">                     }</span>
<a href="#l36.197"></a><span id="l36.197">                     break;</span>
<a href="#l36.198"></a><span id="l36.198">                 case &quot;CANCEL&quot;: {</span>
<a href="#l36.199"></a><span id="l36.199">                     let modifiedItems = {};</span>
<a href="#l36.200"></a><span id="l36.200" class="difflineminus">-                    for each (let itipItemItem in this.mItipItem.getItemList({})) {</span>
<a href="#l36.201"></a><span id="l36.201" class="difflineminus">-                        for each (let item in this.mFoundItems) {</span>
<a href="#l36.202"></a><span id="l36.202" class="difflineplus">+                    for (let itipItemItem of this.mItipItem.getItemList({})) {</span>
<a href="#l36.203"></a><span id="l36.203" class="difflineplus">+                        for (let item of this.mFoundItems) {</span>
<a href="#l36.204"></a><span id="l36.204">                             let rid = itipItemItem.recurrenceId; //  XXX todo support multiple</span>
<a href="#l36.205"></a><span id="l36.205">                             if (rid) { // actually a CANCEL of occurrence(s)</span>
<a href="#l36.206"></a><span id="l36.206">                                 if (item.recurrenceInfo) {</span>
<a href="#l36.207"></a><span id="l36.207">                                     // collect all occurrence deletions into a single parent modification:</span>
<a href="#l36.208"></a><span id="l36.208">                                     let newItem = modifiedItems[item.id];</span>
<a href="#l36.209"></a><span id="l36.209">                                     if (!newItem) {</span>
<a href="#l36.210"></a><span id="l36.210">                                         newItem = item.clone();</span>
<a href="#l36.211"></a><span id="l36.211">                                         modifiedItems[item.id] = newItem;</span>
<a href="#l36.212"></a><span id="l36.212" class="difflineat">@@ -1456,17 +1457,17 @@ ItipItemFinder.prototype = {</span>
<a href="#l36.213"></a><span id="l36.213">         } else { // not found:</span>
<a href="#l36.214"></a><span id="l36.214">             cal.LOG(&quot;iTIP on &quot; + method + &quot;: no existing items.&quot;);</span>
<a href="#l36.215"></a><span id="l36.215"> </span>
<a href="#l36.216"></a><span id="l36.216">             // If the item was not found, observe the target calendar anyway.</span>
<a href="#l36.217"></a><span id="l36.217">             // It will likely be the composite calendar, so we should update</span>
<a href="#l36.218"></a><span id="l36.218">             // if an item was added or removed</span>
<a href="#l36.219"></a><span id="l36.219">             this._observeChanges(this.mItipItem.targetCalendar);</span>
<a href="#l36.220"></a><span id="l36.220"> </span>
<a href="#l36.221"></a><span id="l36.221" class="difflineminus">-            for each (let itipItemItem in this.mItipItem.getItemList({})) {</span>
<a href="#l36.222"></a><span id="l36.222" class="difflineplus">+            for (let itipItemItem of this.mItipItem.getItemList({})) {</span>
<a href="#l36.223"></a><span id="l36.223">                 switch (method) {</span>
<a href="#l36.224"></a><span id="l36.224">                     case &quot;REQUEST&quot;:</span>
<a href="#l36.225"></a><span id="l36.225">                     case &quot;PUBLISH&quot;: {</span>
<a href="#l36.226"></a><span id="l36.226">                         let this_ = this;</span>
<a href="#l36.227"></a><span id="l36.227">                         let action = function(opListener, partStat) {</span>
<a href="#l36.228"></a><span id="l36.228">                             let newItem = itipItemItem.clone();</span>
<a href="#l36.229"></a><span id="l36.229">                             setReceivedInfo(newItem, itipItemItem);</span>
<a href="#l36.230"></a><span id="l36.230">                             newItem.parentItem.calendar = this_.mItipItem.targetCalendar;</span>
<a href="#l36.231"></a><span id="l36.231" class="difflineat">@@ -1509,17 +1510,17 @@ ItipItemFinder.prototype = {</span>
<a href="#l36.232"></a><span id="l36.232">                 }</span>
<a href="#l36.233"></a><span id="l36.233">             }</span>
<a href="#l36.234"></a><span id="l36.234">         }</span>
<a href="#l36.235"></a><span id="l36.235"> </span>
<a href="#l36.236"></a><span id="l36.236">         cal.LOG(&quot;iTIP operations: &quot; + operations.length);</span>
<a href="#l36.237"></a><span id="l36.237">         let actionFunc = null;</span>
<a href="#l36.238"></a><span id="l36.238">         if (operations.length &gt; 0) {</span>
<a href="#l36.239"></a><span id="l36.239">             actionFunc = function execOperations(opListener, partStat) {</span>
<a href="#l36.240"></a><span id="l36.240" class="difflineminus">-                for each (let op in operations) {</span>
<a href="#l36.241"></a><span id="l36.241" class="difflineplus">+                for (let op of operations) {</span>
<a href="#l36.242"></a><span id="l36.242">                     try {</span>
<a href="#l36.243"></a><span id="l36.243">                         op(opListener, partStat);</span>
<a href="#l36.244"></a><span id="l36.244">                     } catch (exc) {</span>
<a href="#l36.245"></a><span id="l36.245">                         cal.ERROR(exc);</span>
<a href="#l36.246"></a><span id="l36.246">                     }</span>
<a href="#l36.247"></a><span id="l36.247">                 }</span>
<a href="#l36.248"></a><span id="l36.248">             };</span>
<a href="#l36.249"></a><span id="l36.249">             actionFunc.method = actionMethod;</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l37.1"></a><span id="l37.1" class="difflineminus">--- a/calendar/base/modules/calPrintUtils.jsm</span>
<a href="#l37.2"></a><span id="l37.2" class="difflineplus">+++ b/calendar/base/modules/calPrintUtils.jsm</span>
<a href="#l37.3"></a><span id="l37.3" class="difflineat">@@ -27,17 +27,17 @@ cal.print = {</span>
<a href="#l37.4"></a><span id="l37.4">      *</span>
<a href="#l37.5"></a><span id="l37.5">      * @param document      The document that contains &lt;style id=&quot;sheet&quot;/&gt;.</span>
<a href="#l37.6"></a><span id="l37.6">      * @param categories    Array of categories to insert rules for.</span>
<a href="#l37.7"></a><span id="l37.7">      */</span>
<a href="#l37.8"></a><span id="l37.8">     insertCategoryRules: function insertCategoryRules(document, categories) {</span>
<a href="#l37.9"></a><span id="l37.9">         let sheet = document.getElementById(&quot;sheet&quot;);</span>
<a href="#l37.10"></a><span id="l37.10">         sheet.insertedCategoryRules = sheet.insertedCategoryRules || {};</span>
<a href="#l37.11"></a><span id="l37.11"> </span>
<a href="#l37.12"></a><span id="l37.12" class="difflineminus">-        for each (let category in categories) {</span>
<a href="#l37.13"></a><span id="l37.13" class="difflineplus">+        for (let category of categories) {</span>
<a href="#l37.14"></a><span id="l37.14">             let prefName = cal.formatStringForCSSRule(category);</span>
<a href="#l37.15"></a><span id="l37.15">             let color = Preferences.get(&quot;calendar.category.color.&quot; + prefName) || &quot;transparent&quot;;</span>
<a href="#l37.16"></a><span id="l37.16">             if (!(prefName in sheet.insertedCategoryRules)) {</span>
<a href="#l37.17"></a><span id="l37.17">                 sheet.insertedCategoryRules[prefName] = true;</span>
<a href="#l37.18"></a><span id="l37.18">                 let ruleAdd = ' .category-color-box[categories~=&quot;' + prefName + '&quot;] { ' +</span>
<a href="#l37.19"></a><span id="l37.19">                               ' border: 2px solid ' + color + '; }' + &quot;\n&quot;;</span>
<a href="#l37.20"></a><span id="l37.20">                 sheet.textContent += ruleAdd;</span>
<a href="#l37.21"></a><span id="l37.21">             }</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l38.1"></a><span id="l38.1" class="difflineminus">--- a/calendar/base/modules/calRecurrenceUtils.jsm</span>
<a href="#l38.2"></a><span id="l38.2" class="difflineplus">+++ b/calendar/base/modules/calRecurrenceUtils.jsm</span>
<a href="#l38.3"></a><span id="l38.3" class="difflineat">@@ -372,17 +372,17 @@ function recurrenceRule2String(recurrenc</span>
<a href="#l38.4"></a><span id="l38.4">  * @param recurrenceInfo    An item's recurrence info to parse.</span>
<a href="#l38.5"></a><span id="l38.5">  * @return                  An array with two elements: an array of positive</span>
<a href="#l38.6"></a><span id="l38.6">  *                            rules and an array of negative rules.</span>
<a href="#l38.7"></a><span id="l38.7">  */</span>
<a href="#l38.8"></a><span id="l38.8"> function splitRecurrenceRules(recurrenceInfo) {</span>
<a href="#l38.9"></a><span id="l38.9">     var ritems = recurrenceInfo.getRecurrenceItems({});</span>
<a href="#l38.10"></a><span id="l38.10">     var rules = [];</span>
<a href="#l38.11"></a><span id="l38.11">     var exceptions = [];</span>
<a href="#l38.12"></a><span id="l38.12" class="difflineminus">-    for each (var r in ritems) {</span>
<a href="#l38.13"></a><span id="l38.13" class="difflineplus">+    for (var r of ritems) {</span>
<a href="#l38.14"></a><span id="l38.14">         if (r.isNegative) {</span>
<a href="#l38.15"></a><span id="l38.15">             exceptions.push(r);</span>
<a href="#l38.16"></a><span id="l38.16">         } else {</span>
<a href="#l38.17"></a><span id="l38.17">             rules.push(r);</span>
<a href="#l38.18"></a><span id="l38.18">         }</span>
<a href="#l38.19"></a><span id="l38.19">     }</span>
<a href="#l38.20"></a><span id="l38.20">     return [rules, exceptions];</span>
<a href="#l38.21"></a><span id="l38.21"> }</span>
<a href="#l38.22"></a><span id="l38.22" class="difflineat">@@ -391,16 +391,16 @@ function splitRecurrenceRules(recurrence</span>
<a href="#l38.23"></a><span id="l38.23">  * Check if a recurrence rule's component is valid.</span>
<a href="#l38.24"></a><span id="l38.24">  *</span>
<a href="#l38.25"></a><span id="l38.25">  * @see                     calIRecurrenceRule</span>
<a href="#l38.26"></a><span id="l38.26">  * @param aRule             The recurrence rule to check.</span>
<a href="#l38.27"></a><span id="l38.27">  * @param aArray            An array of component names to check.</span>
<a href="#l38.28"></a><span id="l38.28">  * @return                  Returns true if the rule is valid.</span>
<a href="#l38.29"></a><span id="l38.29">  */</span>
<a href="#l38.30"></a><span id="l38.30"> function checkRecurrenceRule(aRule, aArray) {</span>
<a href="#l38.31"></a><span id="l38.31" class="difflineminus">-    for each (var comp in aArray) {</span>
<a href="#l38.32"></a><span id="l38.32" class="difflineplus">+    for (var comp of aArray) {</span>
<a href="#l38.33"></a><span id="l38.33">         var ruleComp = aRule.getComponent(comp, {});</span>
<a href="#l38.34"></a><span id="l38.34">         if (ruleComp &amp;&amp; ruleComp.length &gt; 0) {</span>
<a href="#l38.35"></a><span id="l38.35">             return true;</span>
<a href="#l38.36"></a><span id="l38.36">         }</span>
<a href="#l38.37"></a><span id="l38.37">     }</span>
<a href="#l38.38"></a><span id="l38.38">     return false;</span>
<a href="#l38.39"></a><span id="l38.39"> }</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l39.1"></a><span id="l39.1" class="difflineminus">--- a/calendar/base/modules/calUtils.jsm</span>
<a href="#l39.2"></a><span id="l39.2" class="difflineplus">+++ b/calendar/base/modules/calUtils.jsm</span>
<a href="#l39.3"></a><span id="l39.3" class="difflineat">@@ -32,17 +32,17 @@ var cal = {</span>
<a href="#l39.4"></a><span id="l39.4">      * @param baseDir     base dir; defaults to calendar-js/</span>
<a href="#l39.5"></a><span id="l39.5">      */</span>
<a href="#l39.6"></a><span id="l39.6">     loadScripts: function cal_loadScripts(scriptNames, scope, baseDir) {</span>
<a href="#l39.7"></a><span id="l39.7">         if (!baseDir) {</span>
<a href="#l39.8"></a><span id="l39.8">             baseDir = __LOCATION__.parent.parent.clone();</span>
<a href="#l39.9"></a><span id="l39.9">             baseDir.append(&quot;calendar-js&quot;);</span>
<a href="#l39.10"></a><span id="l39.10">         }</span>
<a href="#l39.11"></a><span id="l39.11"> </span>
<a href="#l39.12"></a><span id="l39.12" class="difflineminus">-        for each (let script in scriptNames) {</span>
<a href="#l39.13"></a><span id="l39.13" class="difflineplus">+        for (let script of scriptNames) {</span>
<a href="#l39.14"></a><span id="l39.14">             if (!script) {</span>
<a href="#l39.15"></a><span id="l39.15">                 // If the array element is null, then just skip this script.</span>
<a href="#l39.16"></a><span id="l39.16">                 continue;</span>
<a href="#l39.17"></a><span id="l39.17">             }</span>
<a href="#l39.18"></a><span id="l39.18">             let scriptFile = baseDir.clone();</span>
<a href="#l39.19"></a><span id="l39.19">             scriptFile.append(script);</span>
<a href="#l39.20"></a><span id="l39.20">             let scriptUrlSpec = Services.io.newFileURI(scriptFile).spec;</span>
<a href="#l39.21"></a><span id="l39.21">             try {</span>
<a href="#l39.22"></a><span id="l39.22" class="difflineat">@@ -115,17 +115,17 @@ var cal = {</span>
<a href="#l39.23"></a><span id="l39.23">                 methods = [&quot;onCalendarAdded&quot;, &quot;onCalendarRemoved&quot;,</span>
<a href="#l39.24"></a><span id="l39.24">                            &quot;onDefaultCalendarChanged&quot;];</span>
<a href="#l39.25"></a><span id="l39.25">                 break;</span>
<a href="#l39.26"></a><span id="l39.26">             default:</span>
<a href="#l39.27"></a><span id="l39.27">                 methods = [];</span>
<a href="#l39.28"></a><span id="l39.28">                 break;</span>
<a href="#l39.29"></a><span id="l39.29">         }</span>
<a href="#l39.30"></a><span id="l39.30"> </span>
<a href="#l39.31"></a><span id="l39.31" class="difflineminus">-        for each (let method in methods) {</span>
<a href="#l39.32"></a><span id="l39.32" class="difflineplus">+        for (let method of methods) {</span>
<a href="#l39.33"></a><span id="l39.33">             if (!(method in template)) {</span>
<a href="#l39.34"></a><span id="l39.34">                 adapter[method] = function() {};</span>
<a href="#l39.35"></a><span id="l39.35">             }</span>
<a href="#l39.36"></a><span id="l39.36">         }</span>
<a href="#l39.37"></a><span id="l39.37">         adapter.QueryInterface = XPCOMUtils.generateQI([iface]);</span>
<a href="#l39.38"></a><span id="l39.38"> </span>
<a href="#l39.39"></a><span id="l39.39">         return adapter;</span>
<a href="#l39.40"></a><span id="l39.40">     },</span>
<a href="#l39.41"></a><span id="l39.41" class="difflineat">@@ -882,17 +882,17 @@ var cal = {</span>
<a href="#l39.42"></a><span id="l39.42"> </span>
<a href="#l39.43"></a><span id="l39.43"> // local to this module;</span>
<a href="#l39.44"></a><span id="l39.44"> // will be used to clean up global objects on shutdown</span>
<a href="#l39.45"></a><span id="l39.45"> // some objects have cyclic references due to wrappers</span>
<a href="#l39.46"></a><span id="l39.46"> function shutdownCleanup(obj, prop) {</span>
<a href="#l39.47"></a><span id="l39.47">     if (!shutdownCleanup.mEntries) {</span>
<a href="#l39.48"></a><span id="l39.48">         shutdownCleanup.mEntries = [];</span>
<a href="#l39.49"></a><span id="l39.49">         cal.addShutdownObserver(function() {</span>
<a href="#l39.50"></a><span id="l39.50" class="difflineminus">-                for each (let entry in shutdownCleanup.mEntries) {</span>
<a href="#l39.51"></a><span id="l39.51" class="difflineplus">+                for (let entry of shutdownCleanup.mEntries) {</span>
<a href="#l39.52"></a><span id="l39.52">                     if (entry.mProp) {</span>
<a href="#l39.53"></a><span id="l39.53">                         delete entry.mObj[entry.mProp];</span>
<a href="#l39.54"></a><span id="l39.54">                     } else {</span>
<a href="#l39.55"></a><span id="l39.55">                         delete entry.mObj;</span>
<a href="#l39.56"></a><span id="l39.56">                     }</span>
<a href="#l39.57"></a><span id="l39.57">                 }</span>
<a href="#l39.58"></a><span id="l39.58">                 delete shutdownCleanup.mEntries;</span>
<a href="#l39.59"></a><span id="l39.59">             });</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l40.1"></a><span id="l40.1" class="difflineminus">--- a/calendar/base/src/calAlarm.js</span>
<a href="#l40.2"></a><span id="l40.2" class="difflineplus">+++ b/calendar/base/src/calAlarm.js</span>
<a href="#l40.3"></a><span id="l40.3" class="difflineat">@@ -64,17 +64,17 @@ calAlarm.prototype = {</span>
<a href="#l40.4"></a><span id="l40.4">         if (this.mImmutable) {</span>
<a href="#l40.5"></a><span id="l40.5">             return;</span>
<a href="#l40.6"></a><span id="l40.6">         }</span>
<a href="#l40.7"></a><span id="l40.7"> </span>
<a href="#l40.8"></a><span id="l40.8">         const objectMembers = [&quot;mAbsoluteDate&quot;,</span>
<a href="#l40.9"></a><span id="l40.9">                                &quot;mOffset&quot;,</span>
<a href="#l40.10"></a><span id="l40.10">                                &quot;mDuration&quot;,</span>
<a href="#l40.11"></a><span id="l40.11">                                &quot;mLastAck&quot;];</span>
<a href="#l40.12"></a><span id="l40.12" class="difflineminus">-        for each (let member in objectMembers) {</span>
<a href="#l40.13"></a><span id="l40.13" class="difflineplus">+        for (let member of objectMembers) {</span>
<a href="#l40.14"></a><span id="l40.14">             if (this[member] &amp;&amp; this[member].isMutable) {</span>
<a href="#l40.15"></a><span id="l40.15">                 this[member].makeImmutable();</span>
<a href="#l40.16"></a><span id="l40.16">             }</span>
<a href="#l40.17"></a><span id="l40.17">         }</span>
<a href="#l40.18"></a><span id="l40.18"> </span>
<a href="#l40.19"></a><span id="l40.19">         // Properties</span>
<a href="#l40.20"></a><span id="l40.20">         let e = this.mProperties.enumerator;</span>
<a href="#l40.21"></a><span id="l40.21">         while (e.hasMoreElements()) {</span>
<a href="#l40.22"></a><span id="l40.22" class="difflineat">@@ -104,39 +104,39 @@ calAlarm.prototype = {</span>
<a href="#l40.23"></a><span id="l40.23">         const arrayMembers = [&quot;mAttendees&quot;,</span>
<a href="#l40.24"></a><span id="l40.24">                               &quot;mAttachments&quot;];</span>
<a href="#l40.25"></a><span id="l40.25"> </span>
<a href="#l40.26"></a><span id="l40.26">         const objectMembers = [&quot;mAbsoluteDate&quot;,</span>
<a href="#l40.27"></a><span id="l40.27">                                &quot;mOffset&quot;,</span>
<a href="#l40.28"></a><span id="l40.28">                                &quot;mDuration&quot;,</span>
<a href="#l40.29"></a><span id="l40.29">                                &quot;mLastAck&quot;];</span>
<a href="#l40.30"></a><span id="l40.30"> </span>
<a href="#l40.31"></a><span id="l40.31" class="difflineminus">-        for each (let member in simpleMembers) {</span>
<a href="#l40.32"></a><span id="l40.32" class="difflineplus">+        for (let member of simpleMembers) {</span>
<a href="#l40.33"></a><span id="l40.33">             m[member] = this[member];</span>
<a href="#l40.34"></a><span id="l40.34">         }</span>
<a href="#l40.35"></a><span id="l40.35"> </span>
<a href="#l40.36"></a><span id="l40.36" class="difflineminus">-        for each (let member in arrayMembers) {</span>
<a href="#l40.37"></a><span id="l40.37" class="difflineplus">+        for (let member of arrayMembers) {</span>
<a href="#l40.38"></a><span id="l40.38">             let newArray = [];</span>
<a href="#l40.39"></a><span id="l40.39" class="difflineminus">-            for each (let oldElem in this[member]) {</span>
<a href="#l40.40"></a><span id="l40.40" class="difflineplus">+            for (let oldElem of this[member]) {</span>
<a href="#l40.41"></a><span id="l40.41">                 newArray.push(oldElem.clone());</span>
<a href="#l40.42"></a><span id="l40.42">             }</span>
<a href="#l40.43"></a><span id="l40.43">             m[member] = newArray;</span>
<a href="#l40.44"></a><span id="l40.44">         }</span>
<a href="#l40.45"></a><span id="l40.45"> </span>
<a href="#l40.46"></a><span id="l40.46" class="difflineminus">-        for each (let member in objectMembers) {</span>
<a href="#l40.47"></a><span id="l40.47" class="difflineplus">+        for (let member of objectMembers) {</span>
<a href="#l40.48"></a><span id="l40.48">             if (this[member] &amp;&amp; this[member].clone) {</span>
<a href="#l40.49"></a><span id="l40.49">                 m[member] = this[member].clone();</span>
<a href="#l40.50"></a><span id="l40.50">             } else {</span>
<a href="#l40.51"></a><span id="l40.51">                 m[member] = this[member];</span>
<a href="#l40.52"></a><span id="l40.52">             }</span>
<a href="#l40.53"></a><span id="l40.53">         }</span>
<a href="#l40.54"></a><span id="l40.54"> </span>
<a href="#l40.55"></a><span id="l40.55">         // X-Props</span>
<a href="#l40.56"></a><span id="l40.56">         m.mProperties = new calPropertyBag();</span>
<a href="#l40.57"></a><span id="l40.57" class="difflineminus">-        for each (let [name, value] in this.mProperties) {</span>
<a href="#l40.58"></a><span id="l40.58" class="difflineplus">+        for (let [name, value] of this.mProperties) {</span>
<a href="#l40.59"></a><span id="l40.59">             if (value instanceof Components.interfaces.calIDateTime) {</span>
<a href="#l40.60"></a><span id="l40.60">                 value = value.clone();</span>
<a href="#l40.61"></a><span id="l40.61">             }</span>
<a href="#l40.62"></a><span id="l40.62"> </span>
<a href="#l40.63"></a><span id="l40.63">             m.mProperties.setProperty(name, value);</span>
<a href="#l40.64"></a><span id="l40.64"> </span>
<a href="#l40.65"></a><span id="l40.65">             let propBucket = this.mPropertyParams[name];</span>
<a href="#l40.66"></a><span id="l40.66">             if (propBucket) {</span>
<a href="#l40.67"></a><span id="l40.67" class="difflineat">@@ -418,26 +418,26 @@ calAlarm.prototype = {</span>
<a href="#l40.68"></a><span id="l40.68">             comp.addProperty(durationProp);</span>
<a href="#l40.69"></a><span id="l40.69">         }</span>
<a href="#l40.70"></a><span id="l40.70"> </span>
<a href="#l40.71"></a><span id="l40.71">         // Set up attendees (REQUIRED for EMAIL action)</span>
<a href="#l40.72"></a><span id="l40.72">         /* TODO should we be strict here?</span>
<a href="#l40.73"></a><span id="l40.73">         if (this.action == &quot;EMAIL&quot; &amp;&amp; !this.getAttendees({}).length) {</span>
<a href="#l40.74"></a><span id="l40.74">             throw Components.results.NS_ERROR_NOT_INITIALIZED;</span>
<a href="#l40.75"></a><span id="l40.75">         } */</span>
<a href="#l40.76"></a><span id="l40.76" class="difflineminus">-        for each (let attendee in this.getAttendees({})) {</span>
<a href="#l40.77"></a><span id="l40.77" class="difflineplus">+        for (let attendee of this.getAttendees({})) {</span>
<a href="#l40.78"></a><span id="l40.78">             comp.addProperty(attendee.icalProperty);</span>
<a href="#l40.79"></a><span id="l40.79">         }</span>
<a href="#l40.80"></a><span id="l40.80"> </span>
<a href="#l40.81"></a><span id="l40.81">         /* TODO should we be strict here?</span>
<a href="#l40.82"></a><span id="l40.82">         if (this.action == &quot;EMAIL&quot; &amp;&amp; !this.attachments.length) {</span>
<a href="#l40.83"></a><span id="l40.83">             throw Components.results.NS_ERROR_NOT_INITIALIZED;</span>
<a href="#l40.84"></a><span id="l40.84">         } */</span>
<a href="#l40.85"></a><span id="l40.85"> </span>
<a href="#l40.86"></a><span id="l40.86" class="difflineminus">-        for each (let attachment in this.getAttachments({})) {</span>
<a href="#l40.87"></a><span id="l40.87" class="difflineplus">+        for (let attachment of this.getAttachments({})) {</span>
<a href="#l40.88"></a><span id="l40.88">             comp.addProperty(attachment.icalProperty);</span>
<a href="#l40.89"></a><span id="l40.89">         }</span>
<a href="#l40.90"></a><span id="l40.90"> </span>
<a href="#l40.91"></a><span id="l40.91">         // Set up summary (REQUIRED for EMAIL)</span>
<a href="#l40.92"></a><span id="l40.92">         if (this.summary || this.action == &quot;EMAIL&quot;) {</span>
<a href="#l40.93"></a><span id="l40.93">             let summaryProp = icssvc.createIcalProperty(&quot;SUMMARY&quot;);</span>
<a href="#l40.94"></a><span id="l40.94">             // Summary needs to have a non-empty value</span>
<a href="#l40.95"></a><span id="l40.95">             summaryProp.value = this.summary ||</span>
<a href="#l40.96"></a><span id="l40.96" class="difflineat">@@ -459,17 +459,17 @@ calAlarm.prototype = {</span>
<a href="#l40.97"></a><span id="l40.97">         // Set up lastAck</span>
<a href="#l40.98"></a><span id="l40.98">         if (this.lastAck) {</span>
<a href="#l40.99"></a><span id="l40.99">             let lastAckProp = icssvc.createIcalProperty(&quot;X-MOZ-LASTACK&quot;);</span>
<a href="#l40.100"></a><span id="l40.100">             lastAckProp.value = this.lastAck;</span>
<a href="#l40.101"></a><span id="l40.101">             comp.addProperty(lastAckProp);</span>
<a href="#l40.102"></a><span id="l40.102">         }</span>
<a href="#l40.103"></a><span id="l40.103"> </span>
<a href="#l40.104"></a><span id="l40.104">         // Set up X-Props. mProperties contains only non-promoted props</span>
<a href="#l40.105"></a><span id="l40.105" class="difflineminus">-        for (let propName in this.mProperties) {</span>
<a href="#l40.106"></a><span id="l40.106" class="difflineplus">+        for (let [propName, ] of this.mProperties) {</span>
<a href="#l40.107"></a><span id="l40.107">             let icalprop = icssvc.createIcalProperty(propName);</span>
<a href="#l40.108"></a><span id="l40.108">             icalprop.value = this.mProperties.getProperty(propName);</span>
<a href="#l40.109"></a><span id="l40.109"> </span>
<a href="#l40.110"></a><span id="l40.110">             // Add parameters</span>
<a href="#l40.111"></a><span id="l40.111">             let propBucket = this.mPropertyParams[propName];</span>
<a href="#l40.112"></a><span id="l40.112">             if (propBucket) {</span>
<a href="#l40.113"></a><span id="l40.113">                 for (let paramName in propBucket) {</span>
<a href="#l40.114"></a><span id="l40.114">                     try {</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l41.1"></a><span id="l41.1" class="difflineminus">--- a/calendar/base/src/calAlarmMonitor.js</span>
<a href="#l41.2"></a><span id="l41.2" class="difflineplus">+++ b/calendar/base/src/calAlarmMonitor.js</span>
<a href="#l41.3"></a><span id="l41.3" class="difflineat">@@ -131,17 +131,17 @@ calAlarmMonitor.prototype = {</span>
<a href="#l41.4"></a><span id="l41.4">             calAlarmWindow.addWidgetFor(aItem, aAlarm);</span>
<a href="#l41.5"></a><span id="l41.5">         }</span>
<a href="#l41.6"></a><span id="l41.6">     },</span>
<a href="#l41.7"></a><span id="l41.7"> </span>
<a href="#l41.8"></a><span id="l41.8">     window_onLoad: function cAM_window_onLoad() {</span>
<a href="#l41.9"></a><span id="l41.9">         let calAlarmWindow = this.mWindowOpening;</span>
<a href="#l41.10"></a><span id="l41.10">         this.mWindowOpening = null;</span>
<a href="#l41.11"></a><span id="l41.11">         if (this.mAlarms.length &gt; 0) {</span>
<a href="#l41.12"></a><span id="l41.12" class="difflineminus">-            for each (let [item, alarm] in this.mAlarms) {</span>
<a href="#l41.13"></a><span id="l41.13" class="difflineplus">+            for (let [item, alarm] of this.mAlarms) {</span>
<a href="#l41.14"></a><span id="l41.14">                 calAlarmWindow.addWidgetFor(item, alarm);</span>
<a href="#l41.15"></a><span id="l41.15">             }</span>
<a href="#l41.16"></a><span id="l41.16">         } else {</span>
<a href="#l41.17"></a><span id="l41.17">             // Uh oh, it seems the alarms were removed even before the window</span>
<a href="#l41.18"></a><span id="l41.18">             // finished loading. Looks like we can close it again</span>
<a href="#l41.19"></a><span id="l41.19">             calAlarmWindow.closeIfEmpty();</span>
<a href="#l41.20"></a><span id="l41.20">         }</span>
<a href="#l41.21"></a><span id="l41.21">     },</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l42.1"></a><span id="l42.1" class="difflineminus">--- a/calendar/base/src/calAlarmService.js</span>
<a href="#l42.2"></a><span id="l42.2" class="difflineplus">+++ b/calendar/base/src/calAlarmService.js</span>
<a href="#l42.3"></a><span id="l42.3" class="difflineat">@@ -220,17 +220,17 @@ calAlarmService.prototype = {</span>
<a href="#l42.4"></a><span id="l42.4">         /* Tell people that we're alive so they can start monitoring alarms.</span>
<a href="#l42.5"></a><span id="l42.5">          */</span>
<a href="#l42.6"></a><span id="l42.6">         let notifier = Components.classes[&quot;@mozilla.org/embedcomp/appstartup-notifier;1&quot;]</span>
<a href="#l42.7"></a><span id="l42.7">                                  .getService(Components.interfaces.nsIObserver);</span>
<a href="#l42.8"></a><span id="l42.8">         notifier.observe(null, &quot;alarm-service-startup&quot;, null);</span>
<a href="#l42.9"></a><span id="l42.9"> </span>
<a href="#l42.10"></a><span id="l42.10">         getCalendarManager().addObserver(this.calendarManagerObserver);</span>
<a href="#l42.11"></a><span id="l42.11"> </span>
<a href="#l42.12"></a><span id="l42.12" class="difflineminus">-        for each (let calendar in getCalendarManager().getCalendars({})) {</span>
<a href="#l42.13"></a><span id="l42.13" class="difflineplus">+        for (let calendar of getCalendarManager().getCalendars({})) {</span>
<a href="#l42.14"></a><span id="l42.14">             this.observeCalendar(calendar);</span>
<a href="#l42.15"></a><span id="l42.15">         }</span>
<a href="#l42.16"></a><span id="l42.16"> </span>
<a href="#l42.17"></a><span id="l42.17">         /* set up a timer to update alarms every N hours */</span>
<a href="#l42.18"></a><span id="l42.18">         let timerCallback = {</span>
<a href="#l42.19"></a><span id="l42.19">             alarmService: this,</span>
<a href="#l42.20"></a><span id="l42.20">             notify: function timer_notify() {</span>
<a href="#l42.21"></a><span id="l42.21">                 let now = nowUTC();</span>
<a href="#l42.22"></a><span id="l42.22" class="difflineat">@@ -280,17 +280,17 @@ calAlarmService.prototype = {</span>
<a href="#l42.23"></a><span id="l42.23">             this.mUpdateTimer.cancel();</span>
<a href="#l42.24"></a><span id="l42.24">             this.mUpdateTimer = null;</span>
<a href="#l42.25"></a><span id="l42.25">         }</span>
<a href="#l42.26"></a><span id="l42.26"> </span>
<a href="#l42.27"></a><span id="l42.27">         let calmgr = cal.getCalendarManager();</span>
<a href="#l42.28"></a><span id="l42.28">         calmgr.removeObserver(this.calendarManagerObserver);</span>
<a href="#l42.29"></a><span id="l42.29"> </span>
<a href="#l42.30"></a><span id="l42.30">         // Stop observing all calendars. This will also clear the timers.</span>
<a href="#l42.31"></a><span id="l42.31" class="difflineminus">-        for each (let calendar in calmgr.getCalendars({})) {</span>
<a href="#l42.32"></a><span id="l42.32" class="difflineplus">+        for (let calendar of calmgr.getCalendars({})) {</span>
<a href="#l42.33"></a><span id="l42.33">             this.unobserveCalendar(calendar);</span>
<a href="#l42.34"></a><span id="l42.34">         }</span>
<a href="#l42.35"></a><span id="l42.35"> </span>
<a href="#l42.36"></a><span id="l42.36">         this.mRangeEnd = null;</span>
<a href="#l42.37"></a><span id="l42.37"> </span>
<a href="#l42.38"></a><span id="l42.38">         Services.obs.removeObserver(this, &quot;profile-after-change&quot;);</span>
<a href="#l42.39"></a><span id="l42.39">         Services.obs.removeObserver(this, &quot;xpcom-shutdown&quot;);</span>
<a href="#l42.40"></a><span id="l42.40">         Services.obs.removeObserver(this, &quot;wake_notification&quot;);</span>
<a href="#l42.41"></a><span id="l42.41" class="difflineat">@@ -312,17 +312,17 @@ calAlarmService.prototype = {</span>
<a href="#l42.42"></a><span id="l42.42">         if (cal.isToDo(aItem) &amp;&amp; aItem.isCompleted) {</span>
<a href="#l42.43"></a><span id="l42.43">             // If this is a task and it is completed, don't add the alarm.</span>
<a href="#l42.44"></a><span id="l42.44">             return;</span>
<a href="#l42.45"></a><span id="l42.45">         }</span>
<a href="#l42.46"></a><span id="l42.46"> </span>
<a href="#l42.47"></a><span id="l42.47">         let showMissed = Preferences.get(&quot;calendar.alarms.showmissed&quot;, true);</span>
<a href="#l42.48"></a><span id="l42.48"> </span>
<a href="#l42.49"></a><span id="l42.49">         let alarms = aItem.getAlarms({});</span>
<a href="#l42.50"></a><span id="l42.50" class="difflineminus">-        for each (let alarm in alarms) {</span>
<a href="#l42.51"></a><span id="l42.51" class="difflineplus">+        for (let alarm of alarms) {</span>
<a href="#l42.52"></a><span id="l42.52">             let alarmDate = cal.alarms.calculateAlarmDate(aItem, alarm);</span>
<a href="#l42.53"></a><span id="l42.53"> </span>
<a href="#l42.54"></a><span id="l42.54">             if (!alarmDate || alarm.action != &quot;DISPLAY&quot;) {</span>
<a href="#l42.55"></a><span id="l42.55">                 // Only take care of DISPLAY alarms with an alarm date.</span>
<a href="#l42.56"></a><span id="l42.56">                 continue;</span>
<a href="#l42.57"></a><span id="l42.57">             }</span>
<a href="#l42.58"></a><span id="l42.58"> </span>
<a href="#l42.59"></a><span id="l42.59">             // Handle all day events.  This is kinda weird, because they don't have</span>
<a href="#l42.60"></a><span id="l42.60" class="difflineat">@@ -386,17 +386,17 @@ calAlarmService.prototype = {</span>
<a href="#l42.61"></a><span id="l42.61">             }</span>
<a href="#l42.62"></a><span id="l42.62">         }</span>
<a href="#l42.63"></a><span id="l42.63">     },</span>
<a href="#l42.64"></a><span id="l42.64"> </span>
<a href="#l42.65"></a><span id="l42.65">     removeAlarmsForItem: function cAS_removeAlarmsForItem(aItem) {</span>
<a href="#l42.66"></a><span id="l42.66">         // make sure already fired alarms are purged out of the alarm window:</span>
<a href="#l42.67"></a><span id="l42.67">         this.mObservers.notify(&quot;onRemoveAlarmsByItem&quot;, [aItem]);</span>
<a href="#l42.68"></a><span id="l42.68">         // Purge alarms specifically for this item (i.e exception)</span>
<a href="#l42.69"></a><span id="l42.69" class="difflineminus">-        for each (let alarm in aItem.getAlarms({})) {</span>
<a href="#l42.70"></a><span id="l42.70" class="difflineplus">+        for (let alarm of aItem.getAlarms({})) {</span>
<a href="#l42.71"></a><span id="l42.71">             this.removeTimer(aItem, alarm);</span>
<a href="#l42.72"></a><span id="l42.72">         }</span>
<a href="#l42.73"></a><span id="l42.73">     },</span>
<a href="#l42.74"></a><span id="l42.74"> </span>
<a href="#l42.75"></a><span id="l42.75">     getOccurrencesInRange: function cAS_getOccurrencesInRange(aItem) {</span>
<a href="#l42.76"></a><span id="l42.76">         // We search 1 month in each direction for alarms.  Therefore,</span>
<a href="#l42.77"></a><span id="l42.77">         // we need occurrences between initial start date and 1 month from now</span>
<a href="#l42.78"></a><span id="l42.78">         let until = nowUTC();</span>
<a href="#l42.79"></a><span id="l42.79" class="difflineat">@@ -462,20 +462,22 @@ calAlarmService.prototype = {</span>
<a href="#l42.80"></a><span id="l42.80">             // If the calendar map is empty, remove it from the timer map</span>
<a href="#l42.81"></a><span id="l42.81">             if (this.mTimerMap[aItem.calendar.id].toSource() == &quot;({})&quot;) {</span>
<a href="#l42.82"></a><span id="l42.82">                 delete this.mTimerMap[aItem.calendar.id];</span>
<a href="#l42.83"></a><span id="l42.83">             }</span>
<a href="#l42.84"></a><span id="l42.84">         }</span>
<a href="#l42.85"></a><span id="l42.85">     },</span>
<a href="#l42.86"></a><span id="l42.86"> </span>
<a href="#l42.87"></a><span id="l42.87">     disposeCalendarTimers: function cAS_removeCalendarTimers(aCalendars) {</span>
<a href="#l42.88"></a><span id="l42.88" class="difflineminus">-        for each (let calendar in aCalendars) {</span>
<a href="#l42.89"></a><span id="l42.89" class="difflineplus">+        for (let calendar of aCalendars) {</span>
<a href="#l42.90"></a><span id="l42.90">             if (calendar.id in this.mTimerMap) {</span>
<a href="#l42.91"></a><span id="l42.91" class="difflineminus">-                for each (let itemTimerMap in this.mTimerMap[calendar.id]) {</span>
<a href="#l42.92"></a><span id="l42.92" class="difflineminus">-                    for each (let timer in itemTimerMap) {</span>
<a href="#l42.93"></a><span id="l42.93" class="difflineplus">+                for (let hashId in this.mTimerMap[calendar.id]) {</span>
<a href="#l42.94"></a><span id="l42.94" class="difflineplus">+                    let itemTimerMap = this.mTimerMap[calendar.id][hashId];</span>
<a href="#l42.95"></a><span id="l42.95" class="difflineplus">+                    for (let icalString in itemTimerMap) {</span>
<a href="#l42.96"></a><span id="l42.96" class="difflineplus">+                        let timer = itemTimerMap[icalString];</span>
<a href="#l42.97"></a><span id="l42.97">                         timer.cancel();</span>
<a href="#l42.98"></a><span id="l42.98">                     }</span>
<a href="#l42.99"></a><span id="l42.99">                 }</span>
<a href="#l42.100"></a><span id="l42.100">                 delete this.mTimerMap[calendar.id]</span>
<a href="#l42.101"></a><span id="l42.101">             }</span>
<a href="#l42.102"></a><span id="l42.102">         }</span>
<a href="#l42.103"></a><span id="l42.103">     },</span>
<a href="#l42.104"></a><span id="l42.104"> </span>
<a href="#l42.105"></a><span id="l42.105" class="difflineat">@@ -533,17 +535,17 @@ calAlarmService.prototype = {</span>
<a href="#l42.106"></a><span id="l42.106">             }</span>
<a href="#l42.107"></a><span id="l42.107">         };</span>
<a href="#l42.108"></a><span id="l42.108"> </span>
<a href="#l42.109"></a><span id="l42.109">         const calICalendar = Components.interfaces.calICalendar;</span>
<a href="#l42.110"></a><span id="l42.110">         let filter = calICalendar.ITEM_FILTER_COMPLETED_ALL |</span>
<a href="#l42.111"></a><span id="l42.111">                      calICalendar.ITEM_FILTER_CLASS_OCCURRENCES |</span>
<a href="#l42.112"></a><span id="l42.112">                      calICalendar.ITEM_FILTER_TYPE_ALL;</span>
<a href="#l42.113"></a><span id="l42.113"> </span>
<a href="#l42.114"></a><span id="l42.114" class="difflineminus">-        for each (let calendar in aCalendars) {</span>
<a href="#l42.115"></a><span id="l42.115" class="difflineplus">+        for (let calendar of aCalendars) {</span>
<a href="#l42.116"></a><span id="l42.116">             // assuming that suppressAlarms does not change anymore until refresh:</span>
<a href="#l42.117"></a><span id="l42.117">             if (!calendar.getProperty(&quot;suppressAlarms&quot;) &amp;&amp;</span>
<a href="#l42.118"></a><span id="l42.118">                 !calendar.getProperty(&quot;disabled&quot;)) {</span>
<a href="#l42.119"></a><span id="l42.119">                 this.mLoadedCalendars[calendar.id] = false;</span>
<a href="#l42.120"></a><span id="l42.120">                 calendar.getItems(filter, 0, aStart, aUntil, getListener);</span>
<a href="#l42.121"></a><span id="l42.121">             } else {</span>
<a href="#l42.122"></a><span id="l42.122">                 this.mLoadedCalendars[calendar.id] = true;</span>
<a href="#l42.123"></a><span id="l42.123">                 this.mObservers.notify(&quot;onAlarmsLoaded&quot;, [calendar]);</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l43.1"></a><span id="l43.1" class="difflineminus">--- a/calendar/base/src/calAttachment.js</span>
<a href="#l43.2"></a><span id="l43.2" class="difflineplus">+++ b/calendar/base/src/calAttachment.js</span>
<a href="#l43.3"></a><span id="l43.3" class="difflineat">@@ -95,17 +95,17 @@ calAttachment.prototype = {</span>
<a href="#l43.4"></a><span id="l43.4">     },</span>
<a href="#l43.5"></a><span id="l43.5">     set encoding(aValue) {</span>
<a href="#l43.6"></a><span id="l43.6">         return this.setParameter(&quot;ENCODING&quot;, aValue);</span>
<a href="#l43.7"></a><span id="l43.7">     },</span>
<a href="#l43.8"></a><span id="l43.8"> </span>
<a href="#l43.9"></a><span id="l43.9">     get icalProperty() {</span>
<a href="#l43.10"></a><span id="l43.10">         let icalatt = cal.getIcsService().createIcalProperty(&quot;ATTACH&quot;);</span>
<a href="#l43.11"></a><span id="l43.11"> </span>
<a href="#l43.12"></a><span id="l43.12" class="difflineminus">-        for each (let [key, value] in this.mProperties) {</span>
<a href="#l43.13"></a><span id="l43.13" class="difflineplus">+        for (let [key, value] of this.mProperties) {</span>
<a href="#l43.14"></a><span id="l43.14">             try {</span>
<a href="#l43.15"></a><span id="l43.15">                 icalatt.setParameter(key, value);</span>
<a href="#l43.16"></a><span id="l43.16">             } catch (e if e.result == Components.results.NS_ERROR_ILLEGAL_VALUE) {</span>
<a href="#l43.17"></a><span id="l43.17">                 // Illegal values should be ignored, but we could log them if</span>
<a href="#l43.18"></a><span id="l43.18">                 // the user has enabled logging.</span>
<a href="#l43.19"></a><span id="l43.19">                 cal.LOG(&quot;Warning: Invalid attachment parameter value &quot; + key + &quot;=&quot; + value);</span>
<a href="#l43.20"></a><span id="l43.20">             }</span>
<a href="#l43.21"></a><span id="l43.21">         }</span>
<a href="#l43.22"></a><span id="l43.22" class="difflineat">@@ -117,17 +117,17 @@ calAttachment.prototype = {</span>
<a href="#l43.23"></a><span id="l43.23">     },</span>
<a href="#l43.24"></a><span id="l43.24"> </span>
<a href="#l43.25"></a><span id="l43.25">     set icalProperty(attProp) {</span>
<a href="#l43.26"></a><span id="l43.26">         // Reset the property bag for the parameters, it will be re-initialized</span>
<a href="#l43.27"></a><span id="l43.27">         // from the ical property.</span>
<a href="#l43.28"></a><span id="l43.28">         this.mProperties = new cal.calPropertyBag();</span>
<a href="#l43.29"></a><span id="l43.29">         this.setData(attProp.value);</span>
<a href="#l43.30"></a><span id="l43.30"> </span>
<a href="#l43.31"></a><span id="l43.31" class="difflineminus">-        for each (let [name, value] in cal.ical.paramIterator(attProp)) {</span>
<a href="#l43.32"></a><span id="l43.32" class="difflineplus">+        for (let [name, value] of cal.ical.paramIterator(attProp)) {</span>
<a href="#l43.33"></a><span id="l43.33">             this.setParameter(name, value);</span>
<a href="#l43.34"></a><span id="l43.34">         }</span>
<a href="#l43.35"></a><span id="l43.35">     },</span>
<a href="#l43.36"></a><span id="l43.36"> </span>
<a href="#l43.37"></a><span id="l43.37">     get icalString() {</span>
<a href="#l43.38"></a><span id="l43.38">         let comp = this.icalProperty;</span>
<a href="#l43.39"></a><span id="l43.39">         return (comp ? comp.icalString : &quot;&quot;);</span>
<a href="#l43.40"></a><span id="l43.40">     },</span>
<a href="#l43.41"></a><span id="l43.41" class="difflineat">@@ -155,17 +155,17 @@ calAttachment.prototype = {</span>
<a href="#l43.42"></a><span id="l43.42">     deleteParameter: function (aName) {</span>
<a href="#l43.43"></a><span id="l43.43">         this.mProperties.deleteProperty(aName);</span>
<a href="#l43.44"></a><span id="l43.44">     },</span>
<a href="#l43.45"></a><span id="l43.45"> </span>
<a href="#l43.46"></a><span id="l43.46">     clone: function cA_clone() {</span>
<a href="#l43.47"></a><span id="l43.47">         let newAttachment = new calAttachment();</span>
<a href="#l43.48"></a><span id="l43.48">         newAttachment.mData = this.mData;</span>
<a href="#l43.49"></a><span id="l43.49">         newAttachment.mHashId = this.mHashId;</span>
<a href="#l43.50"></a><span id="l43.50" class="difflineminus">-        for each (let [name, value] in this.mProperties) {</span>
<a href="#l43.51"></a><span id="l43.51" class="difflineplus">+        for (let [name, value] of this.mProperties) {</span>
<a href="#l43.52"></a><span id="l43.52">             newAttachment.mProperties.setProperty(name, value);</span>
<a href="#l43.53"></a><span id="l43.53">         }</span>
<a href="#l43.54"></a><span id="l43.54">         return newAttachment;</span>
<a href="#l43.55"></a><span id="l43.55">     },</span>
<a href="#l43.56"></a><span id="l43.56"> </span>
<a href="#l43.57"></a><span id="l43.57">     setData: function setData(aData) {</span>
<a href="#l43.58"></a><span id="l43.58">         // Sets the data and invalidates the hash so it will be recalculated</span>
<a href="#l43.59"></a><span id="l43.59">         this.mHashId = null;</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l44.1"></a><span id="l44.1" class="difflineminus">--- a/calendar/base/src/calAttendee.js</span>
<a href="#l44.2"></a><span id="l44.2" class="difflineplus">+++ b/calendar/base/src/calAttendee.js</span>
<a href="#l44.3"></a><span id="l44.3" class="difflineat">@@ -40,21 +40,21 @@ calAttendee.prototype = {</span>
<a href="#l44.4"></a><span id="l44.4">         var a = new calAttendee();</span>
<a href="#l44.5"></a><span id="l44.5"> </span>
<a href="#l44.6"></a><span id="l44.6">         if (this.mIsOrganizer) {</span>
<a href="#l44.7"></a><span id="l44.7">             a.isOrganizer = true;</span>
<a href="#l44.8"></a><span id="l44.8">         }</span>
<a href="#l44.9"></a><span id="l44.9"> </span>
<a href="#l44.10"></a><span id="l44.10">         const allProps = [&quot;id&quot;, &quot;commonName&quot;, &quot;rsvp&quot;, &quot;role&quot;,</span>
<a href="#l44.11"></a><span id="l44.11">                           &quot;participationStatus&quot;, &quot;userType&quot;];</span>
<a href="#l44.12"></a><span id="l44.12" class="difflineminus">-        for each (let prop in allProps) {</span>
<a href="#l44.13"></a><span id="l44.13" class="difflineplus">+        for (let prop of allProps) {</span>
<a href="#l44.14"></a><span id="l44.14">             a[prop] = this[prop];</span>
<a href="#l44.15"></a><span id="l44.15">         }</span>
<a href="#l44.16"></a><span id="l44.16"> </span>
<a href="#l44.17"></a><span id="l44.17" class="difflineminus">-        for each (let [key, value] in this.mProperties) {</span>
<a href="#l44.18"></a><span id="l44.18" class="difflineplus">+        for (let [key, value] of this.mProperties) {</span>
<a href="#l44.19"></a><span id="l44.19">             a.setProperty(key, value);</span>
<a href="#l44.20"></a><span id="l44.20">         }</span>
<a href="#l44.21"></a><span id="l44.21"> </span>
<a href="#l44.22"></a><span id="l44.22">         return a;</span>
<a href="#l44.23"></a><span id="l44.23">     },</span>
<a href="#l44.24"></a><span id="l44.24">     // XXX enforce legal values for our properties;</span>
<a href="#l44.25"></a><span id="l44.25"> </span>
<a href="#l44.26"></a><span id="l44.26">     icalAttendeePropMap: [</span>
<a href="#l44.27"></a><span id="l44.27" class="difflineat">@@ -70,27 +70,27 @@ calAttendee.prototype = {</span>
<a href="#l44.28"></a><span id="l44.28"> </span>
<a href="#l44.29"></a><span id="l44.29">     // icalatt is a calIcalProperty of type attendee</span>
<a href="#l44.30"></a><span id="l44.30">     set icalProperty (icalatt) {</span>
<a href="#l44.31"></a><span id="l44.31">         this.modify();</span>
<a href="#l44.32"></a><span id="l44.32">         this.id = icalatt.valueAsIcalString;</span>
<a href="#l44.33"></a><span id="l44.33">         this.mIsOrganizer = (icalatt.propertyName == &quot;ORGANIZER&quot;);</span>
<a href="#l44.34"></a><span id="l44.34"> </span>
<a href="#l44.35"></a><span id="l44.35">         let promotedProps = { };</span>
<a href="#l44.36"></a><span id="l44.36" class="difflineminus">-        for each (let prop in this.icalAttendeePropMap) {</span>
<a href="#l44.37"></a><span id="l44.37" class="difflineplus">+        for (let prop of this.icalAttendeePropMap) {</span>
<a href="#l44.38"></a><span id="l44.38">             this[prop.cal] = icalatt.getParameter(prop.ics);</span>
<a href="#l44.39"></a><span id="l44.39">             // Don't copy these to the property bag.</span>
<a href="#l44.40"></a><span id="l44.40">             promotedProps[prop.ics] = true;</span>
<a href="#l44.41"></a><span id="l44.41">         }</span>
<a href="#l44.42"></a><span id="l44.42"> </span>
<a href="#l44.43"></a><span id="l44.43">         // Reset the property bag for the parameters, it will be re-initialized</span>
<a href="#l44.44"></a><span id="l44.44">         // from the ical property.</span>
<a href="#l44.45"></a><span id="l44.45">         this.mProperties = new calPropertyBag();</span>
<a href="#l44.46"></a><span id="l44.46"> </span>
<a href="#l44.47"></a><span id="l44.47" class="difflineminus">-        for each (let [name, value] in cal.ical.paramIterator(icalatt)) {</span>
<a href="#l44.48"></a><span id="l44.48" class="difflineplus">+        for (let [name, value] of cal.ical.paramIterator(icalatt)) {</span>
<a href="#l44.49"></a><span id="l44.49">             if (!promotedProps[name]) {</span>
<a href="#l44.50"></a><span id="l44.50">                 this.setProperty(name, value);</span>
<a href="#l44.51"></a><span id="l44.51">             }</span>
<a href="#l44.52"></a><span id="l44.52">         }</span>
<a href="#l44.53"></a><span id="l44.53">     },</span>
<a href="#l44.54"></a><span id="l44.54"> </span>
<a href="#l44.55"></a><span id="l44.55">     get icalProperty() {</span>
<a href="#l44.56"></a><span id="l44.56">         var icssvc = cal.getIcsService();</span>
<a href="#l44.57"></a><span id="l44.57" class="difflineat">@@ -112,17 +112,17 @@ calAttendee.prototype = {</span>
<a href="#l44.58"></a><span id="l44.58">                     icalatt.setParameter(prop.ics, this[prop.cal]);</span>
<a href="#l44.59"></a><span id="l44.59">                 } catch (e if e.result == Components.results.NS_ERROR_ILLEGAL_VALUE) {</span>
<a href="#l44.60"></a><span id="l44.60">                     // Illegal values should be ignored, but we could log them if</span>
<a href="#l44.61"></a><span id="l44.61">                     // the user has enabled logging.</span>
<a href="#l44.62"></a><span id="l44.62">                     cal.LOG(&quot;Warning: Invalid attendee parameter value &quot; + prop.ics + &quot;=&quot; + this[prop.cal]);</span>
<a href="#l44.63"></a><span id="l44.63">                 }</span>
<a href="#l44.64"></a><span id="l44.64">             }</span>
<a href="#l44.65"></a><span id="l44.65">         }</span>
<a href="#l44.66"></a><span id="l44.66" class="difflineminus">-        for each (let [key, value] in this.mProperties) {</span>
<a href="#l44.67"></a><span id="l44.67" class="difflineplus">+        for (let [key, value] of this.mProperties) {</span>
<a href="#l44.68"></a><span id="l44.68">             try {</span>
<a href="#l44.69"></a><span id="l44.69">                 icalatt.setParameter(key, value);</span>
<a href="#l44.70"></a><span id="l44.70">             } catch (e if e.result == Components.results.NS_ERROR_ILLEGAL_VALUE) {</span>
<a href="#l44.71"></a><span id="l44.71">                 // Illegal values should be ignored, but we could log them if</span>
<a href="#l44.72"></a><span id="l44.72">                 // the user has enabled logging.</span>
<a href="#l44.73"></a><span id="l44.73">                 cal.LOG(&quot;Warning: Invalid attendee parameter value &quot; + key + &quot;=&quot; + value);</span>
<a href="#l44.74"></a><span id="l44.74">             }</span>
<a href="#l44.75"></a><span id="l44.75">         }</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l45.1"></a><span id="l45.1" class="difflineminus">--- a/calendar/base/src/calCachedCalendar.js</span>
<a href="#l45.2"></a><span id="l45.2" class="difflineplus">+++ b/calendar/base/src/calCachedCalendar.js</span>
<a href="#l45.3"></a><span id="l45.3" class="difflineat">@@ -223,17 +223,17 @@ calCachedCalendar.prototype = {</span>
<a href="#l45.4"></a><span id="l45.4">     },</span>
<a href="#l45.5"></a><span id="l45.5"> </span>
<a href="#l45.6"></a><span id="l45.6">     getOfflineAddedItems: function cCC_getOfflineAddedItems(callbackFunc) {</span>
<a href="#l45.7"></a><span id="l45.7">         let this_ = this;</span>
<a href="#l45.8"></a><span id="l45.8">         this_.offlineCachedItems = {};</span>
<a href="#l45.9"></a><span id="l45.9">         let getListener = {</span>
<a href="#l45.10"></a><span id="l45.10">             QueryInterface: XPCOMUtils.generateQI([Components.interfaces.calIOperationListener]),</span>
<a href="#l45.11"></a><span id="l45.11">             onGetResult: function cCC_oOC_cL_onGetResult(aCalendar, aStatus, aItemType, aDetail, aCount, aItems) {</span>
<a href="#l45.12"></a><span id="l45.12" class="difflineminus">-                for each (let item in aItems) {</span>
<a href="#l45.13"></a><span id="l45.13" class="difflineplus">+                for (let item of aItems) {</span>
<a href="#l45.14"></a><span id="l45.14">                     this_.offlineCachedItems[item.hashId] = item;</span>
<a href="#l45.15"></a><span id="l45.15">                     this_.offlineCachedItemFlags[item.hashId] = cICL.OFFLINE_FLAG_CREATED_RECORD;</span>
<a href="#l45.16"></a><span id="l45.16">                 }</span>
<a href="#l45.17"></a><span id="l45.17">             },</span>
<a href="#l45.18"></a><span id="l45.18"> </span>
<a href="#l45.19"></a><span id="l45.19">             onOperationComplete: function cCC_oOC_cL_onOperationComplete(aCalendar, aStatus, aOpType, aId, aDetail) {</span>
<a href="#l45.20"></a><span id="l45.20">                 this_.getOfflineModifiedItems(callbackFunc);</span>
<a href="#l45.21"></a><span id="l45.21">             }</span>
<a href="#l45.22"></a><span id="l45.22" class="difflineat">@@ -242,17 +242,17 @@ calCachedCalendar.prototype = {</span>
<a href="#l45.23"></a><span id="l45.23">                                       0, null, null, getListener);</span>
<a href="#l45.24"></a><span id="l45.24">     },</span>
<a href="#l45.25"></a><span id="l45.25"> </span>
<a href="#l45.26"></a><span id="l45.26">     getOfflineModifiedItems: function cCC_getOfflineModifiedItems(callbackFunc) {</span>
<a href="#l45.27"></a><span id="l45.27">         let this_ = this;</span>
<a href="#l45.28"></a><span id="l45.28">         let getListener = {</span>
<a href="#l45.29"></a><span id="l45.29">             QueryInterface: XPCOMUtils.generateQI([Components.interfaces.calIOperationListener]),</span>
<a href="#l45.30"></a><span id="l45.30">             onGetResult: function cCC_oOC_cL_onGetResult(aCalendar, aStatus, aItemType, aDetail, aCount, aItems) {</span>
<a href="#l45.31"></a><span id="l45.31" class="difflineminus">-                for each (let item in aItems) {</span>
<a href="#l45.32"></a><span id="l45.32" class="difflineplus">+                for (let item of aItems) {</span>
<a href="#l45.33"></a><span id="l45.33">                     this_.offlineCachedItems[item.hashId] = item;</span>
<a href="#l45.34"></a><span id="l45.34">                     this_.offlineCachedItemFlags[item.hashId] = cICL.OFFLINE_FLAG_MODIFIED_RECORD;</span>
<a href="#l45.35"></a><span id="l45.35">                 }</span>
<a href="#l45.36"></a><span id="l45.36">             },</span>
<a href="#l45.37"></a><span id="l45.37"> </span>
<a href="#l45.38"></a><span id="l45.38">             onOperationComplete: function cCC_oOC_cL_onOperationComplete(aCalendar, aStatus, aOpType, aId, aDetail) {</span>
<a href="#l45.39"></a><span id="l45.39">                 this_.getOfflineDeletedItems(callbackFunc);</span>
<a href="#l45.40"></a><span id="l45.40">             }</span>
<a href="#l45.41"></a><span id="l45.41" class="difflineat">@@ -261,17 +261,17 @@ calCachedCalendar.prototype = {</span>
<a href="#l45.42"></a><span id="l45.42">                                       0, null, null, getListener);</span>
<a href="#l45.43"></a><span id="l45.43">     },</span>
<a href="#l45.44"></a><span id="l45.44"> </span>
<a href="#l45.45"></a><span id="l45.45">     getOfflineDeletedItems: function cCC_getOfflineDeletedItems(callbackFunc) {</span>
<a href="#l45.46"></a><span id="l45.46">         let this_ = this;</span>
<a href="#l45.47"></a><span id="l45.47">         let getListener = {</span>
<a href="#l45.48"></a><span id="l45.48">             QueryInterface: XPCOMUtils.generateQI([Components.interfaces.calIOperationListener]),</span>
<a href="#l45.49"></a><span id="l45.49">             onGetResult: function cCC_oOC_cL_onGetResult(aCalendar, aStatus, aItemType, aDetail, aCount, aItems) {</span>
<a href="#l45.50"></a><span id="l45.50" class="difflineminus">-                for each (let item in aItems) {</span>
<a href="#l45.51"></a><span id="l45.51" class="difflineplus">+                for (let item of aItems) {</span>
<a href="#l45.52"></a><span id="l45.52">                     this_.offlineCachedItems[item.hashId] = item;</span>
<a href="#l45.53"></a><span id="l45.53">                     this_.offlineCachedItemFlags[item.hashId] = cICL.OFFLINE_FLAG_DELETED_RECORD;</span>
<a href="#l45.54"></a><span id="l45.54">                 }</span>
<a href="#l45.55"></a><span id="l45.55">             },</span>
<a href="#l45.56"></a><span id="l45.56"> </span>
<a href="#l45.57"></a><span id="l45.57">             onOperationComplete: function cCC_oOC_cL_onOperationComplete(aCalendar, aStatus, aOpType, aId, aDetail) {</span>
<a href="#l45.58"></a><span id="l45.58">                 if (callbackFunc) {</span>
<a href="#l45.59"></a><span id="l45.59">                     callbackFunc();</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l46.1"></a><span id="l46.1" class="difflineminus">--- a/calendar/base/src/calCalendarManager.js</span>
<a href="#l46.2"></a><span id="l46.2" class="difflineplus">+++ b/calendar/base/src/calCalendarManager.js</span>
<a href="#l46.3"></a><span id="l46.3" class="difflineat">@@ -59,17 +59,18 @@ calCalendarManager.prototype = {</span>
<a href="#l46.4"></a><span id="l46.4">         if (Preferences.get(&quot;calendar.network.multirealm&quot;, false)) {</span>
<a href="#l46.5"></a><span id="l46.5">             Services.obs.addObserver(this, &quot;http-on-examine-response&quot;, false);</span>
<a href="#l46.6"></a><span id="l46.6">         }</span>
<a href="#l46.7"></a><span id="l46.7"> </span>
<a href="#l46.8"></a><span id="l46.8">         aCompleteListener.onResult(null, Components.results.NS_OK);</span>
<a href="#l46.9"></a><span id="l46.9">     },</span>
<a href="#l46.10"></a><span id="l46.10"> </span>
<a href="#l46.11"></a><span id="l46.11">     shutdown: function ccm_shutdown(aCompleteListener) {</span>
<a href="#l46.12"></a><span id="l46.12" class="difflineminus">-        for each (var calendar in this.mCache) {</span>
<a href="#l46.13"></a><span id="l46.13" class="difflineplus">+        for (let id in this.mCache) {</span>
<a href="#l46.14"></a><span id="l46.14" class="difflineplus">+            let calendar = this.mCache[id];</span>
<a href="#l46.15"></a><span id="l46.15">             calendar.removeObserver(this.mCalObservers[calendar.id]);</span>
<a href="#l46.16"></a><span id="l46.16">         }</span>
<a href="#l46.17"></a><span id="l46.17"> </span>
<a href="#l46.18"></a><span id="l46.18">         this.cleanupOfflineObservers();</span>
<a href="#l46.19"></a><span id="l46.19"> </span>
<a href="#l46.20"></a><span id="l46.20">         Services.obs.removeObserver(this, &quot;http-on-modify-request&quot;);</span>
<a href="#l46.21"></a><span id="l46.21"> </span>
<a href="#l46.22"></a><span id="l46.22">         AddonManager.removeAddonListener(gCalendarManagerAddonListener);</span>
<a href="#l46.23"></a><span id="l46.23" class="difflineat">@@ -93,24 +94,25 @@ calCalendarManager.prototype = {</span>
<a href="#l46.24"></a><span id="l46.24">         Services.obs.removeObserver(this, &quot;network:offline-status-changed&quot;);</span>
<a href="#l46.25"></a><span id="l46.25">     },</span>
<a href="#l46.26"></a><span id="l46.26"> </span>
<a href="#l46.27"></a><span id="l46.27">     observe: function ccm_observe(aSubject, aTopic, aData) {</span>
<a href="#l46.28"></a><span id="l46.28">         switch (aTopic) {</span>
<a href="#l46.29"></a><span id="l46.29">             case &quot;timer-callback&quot;:</span>
<a href="#l46.30"></a><span id="l46.30">                 // Refresh all the calendars that can be refreshed.</span>
<a href="#l46.31"></a><span id="l46.31">                 var cals = this.getCalendars({});</span>
<a href="#l46.32"></a><span id="l46.32" class="difflineminus">-                for each (var calendar in cals) {</span>
<a href="#l46.33"></a><span id="l46.33" class="difflineplus">+                for (var calendar of cals) {</span>
<a href="#l46.34"></a><span id="l46.34">                     if (!calendar.getProperty(&quot;disabled&quot;) &amp;&amp; calendar.canRefresh) {</span>
<a href="#l46.35"></a><span id="l46.35">                         calendar.refresh();</span>
<a href="#l46.36"></a><span id="l46.36">                     }</span>
<a href="#l46.37"></a><span id="l46.37">                 }</span>
<a href="#l46.38"></a><span id="l46.38">                 break;</span>
<a href="#l46.39"></a><span id="l46.39">             case &quot;network:offline-status-changed&quot;:</span>
<a href="#l46.40"></a><span id="l46.40" class="difflineminus">-                for each (var calendar in this.mCache) {</span>
<a href="#l46.41"></a><span id="l46.41" class="difflineplus">+                for (var id in this.mCache) {</span>
<a href="#l46.42"></a><span id="l46.42" class="difflineplus">+                    let calendar = this.mCache[id];</span>
<a href="#l46.43"></a><span id="l46.43">                     if (calendar instanceof calCachedCalendar) {</span>
<a href="#l46.44"></a><span id="l46.44">                         calendar.onOfflineStatusChanged(aData == &quot;offline&quot;);</span>
<a href="#l46.45"></a><span id="l46.45">                     }</span>
<a href="#l46.46"></a><span id="l46.46">                 }</span>
<a href="#l46.47"></a><span id="l46.47">                 break;</span>
<a href="#l46.48"></a><span id="l46.48">             case &quot;http-on-examine-response&quot;:</span>
<a href="#l46.49"></a><span id="l46.49">                 try {</span>
<a href="#l46.50"></a><span id="l46.50">                     let channel = aSubject.QueryInterface(Components.interfaces.nsIHttpChannel);</span>
<a href="#l46.51"></a><span id="l46.51" class="difflineat">@@ -294,17 +296,18 @@ calCalendarManager.prototype = {</span>
<a href="#l46.52"></a><span id="l46.52">                             Preferences.set(getPrefBranchFor(id) + name, value);</span>
<a href="#l46.53"></a><span id="l46.53">                             break;</span>
<a href="#l46.54"></a><span id="l46.54">                     }</span>
<a href="#l46.55"></a><span id="l46.55">                 }</span>
<a href="#l46.56"></a><span id="l46.56">                 selectPrefs.reset();</span>
<a href="#l46.57"></a><span id="l46.57">             }</span>
<a href="#l46.58"></a><span id="l46.58"> </span>
<a href="#l46.59"></a><span id="l46.59">             let sortOrderAr = [];</span>
<a href="#l46.60"></a><span id="l46.60" class="difflineminus">-            for each (let s in sortOrder) {</span>
<a href="#l46.61"></a><span id="l46.61" class="difflineplus">+            for (let id in sortOrder) {</span>
<a href="#l46.62"></a><span id="l46.62" class="difflineplus">+                let s = sortOrder[id];</span>
<a href="#l46.63"></a><span id="l46.63">                 sortOrderAr.push(s);</span>
<a href="#l46.64"></a><span id="l46.64">             }</span>
<a href="#l46.65"></a><span id="l46.65">             Preferences.set(&quot;calendar.list.sortOrder&quot;, sortOrderAr.join(&quot; &quot;));</span>
<a href="#l46.66"></a><span id="l46.66">             flushPrefs();</span>
<a href="#l46.67"></a><span id="l46.67"> </span>
<a href="#l46.68"></a><span id="l46.68">         } finally {</span>
<a href="#l46.69"></a><span id="l46.69">             selectPrefs.reset();</span>
<a href="#l46.70"></a><span id="l46.70">             selectCalendars.reset();</span>
<a href="#l46.71"></a><span id="l46.71" class="difflineat">@@ -639,30 +642,31 @@ calCalendarManager.prototype = {</span>
<a href="#l46.72"></a><span id="l46.72">         } else {</span>
<a href="#l46.73"></a><span id="l46.73">             return null;</span>
<a href="#l46.74"></a><span id="l46.74">         }</span>
<a href="#l46.75"></a><span id="l46.75">     },</span>
<a href="#l46.76"></a><span id="l46.76"> </span>
<a href="#l46.77"></a><span id="l46.77">     getCalendars: function cmgr_getCalendars(count) {</span>
<a href="#l46.78"></a><span id="l46.78">         this.assureCache();</span>
<a href="#l46.79"></a><span id="l46.79">         var calendars = [];</span>
<a href="#l46.80"></a><span id="l46.80" class="difflineminus">-        for each (var calendar in this.mCache) {</span>
<a href="#l46.81"></a><span id="l46.81" class="difflineplus">+        for (var id in this.mCache) {</span>
<a href="#l46.82"></a><span id="l46.82" class="difflineplus">+            let calendar = this.mCache[id];</span>
<a href="#l46.83"></a><span id="l46.83">             calendars.push(calendar);</span>
<a href="#l46.84"></a><span id="l46.84">         }</span>
<a href="#l46.85"></a><span id="l46.85">         count.value = calendars.length;</span>
<a href="#l46.86"></a><span id="l46.86">         return calendars;</span>
<a href="#l46.87"></a><span id="l46.87">     },</span>
<a href="#l46.88"></a><span id="l46.88"> </span>
<a href="#l46.89"></a><span id="l46.89">     assureCache: function cmgr_assureCache() {</span>
<a href="#l46.90"></a><span id="l46.90">         if (!this.mCache) {</span>
<a href="#l46.91"></a><span id="l46.91">             this.mCache = {};</span>
<a href="#l46.92"></a><span id="l46.92">             this.mCalObservers = {};</span>
<a href="#l46.93"></a><span id="l46.93"> </span>
<a href="#l46.94"></a><span id="l46.94">             let allCals = {};</span>
<a href="#l46.95"></a><span id="l46.95" class="difflineminus">-            for each (let key in Services.prefs.getChildList(REGISTRY_BRANCH)) { // merge down all keys</span>
<a href="#l46.96"></a><span id="l46.96" class="difflineplus">+            for (let key of Services.prefs.getChildList(REGISTRY_BRANCH)) { // merge down all keys</span>
<a href="#l46.97"></a><span id="l46.97">                 allCals[key.substring(0, key.indexOf(&quot;.&quot;, REGISTRY_BRANCH.length))] = true;</span>
<a href="#l46.98"></a><span id="l46.98">             }</span>
<a href="#l46.99"></a><span id="l46.99"> </span>
<a href="#l46.100"></a><span id="l46.100">             for (let calBranch in allCals) {</span>
<a href="#l46.101"></a><span id="l46.101">                 let id = calBranch.substring(REGISTRY_BRANCH.length);</span>
<a href="#l46.102"></a><span id="l46.102">                 let ctype = Preferences.get(calBranch + &quot;.type&quot;, null);</span>
<a href="#l46.103"></a><span id="l46.103">                 let curi = Preferences.get(calBranch + &quot;.uri&quot;, null);</span>
<a href="#l46.104"></a><span id="l46.104"> </span>
<a href="#l46.105"></a><span id="l46.105" class="difflineat">@@ -700,17 +704,18 @@ calCalendarManager.prototype = {</span>
<a href="#l46.106"></a><span id="l46.106">                     this.setupCalendar(calendar);</span>
<a href="#l46.107"></a><span id="l46.107">                 } catch (exc) {</span>
<a href="#l46.108"></a><span id="l46.108">                     cal.ERROR(&quot;Can't create calendar for &quot; + id + &quot; (&quot; + ctype + &quot;, &quot; + curi + &quot;): &quot; + exc);</span>
<a href="#l46.109"></a><span id="l46.109">                 }</span>
<a href="#l46.110"></a><span id="l46.110">             }</span>
<a href="#l46.111"></a><span id="l46.111"> </span>
<a href="#l46.112"></a><span id="l46.112">             // do refreshing in a second step, when *all* calendars are already available</span>
<a href="#l46.113"></a><span id="l46.113">             // via getCalendars():</span>
<a href="#l46.114"></a><span id="l46.114" class="difflineminus">-            for each (let calendar in this.mCache) {</span>
<a href="#l46.115"></a><span id="l46.115" class="difflineplus">+            for (let id in this.mCache) {</span>
<a href="#l46.116"></a><span id="l46.116" class="difflineplus">+                let calendar = this.mCache[id];</span>
<a href="#l46.117"></a><span id="l46.117">                 if (!calendar.getProperty(&quot;disabled&quot;) &amp;&amp; calendar.canRefresh) {</span>
<a href="#l46.118"></a><span id="l46.118">                     calendar.refresh();</span>
<a href="#l46.119"></a><span id="l46.119">                 }</span>
<a href="#l46.120"></a><span id="l46.120">             }</span>
<a href="#l46.121"></a><span id="l46.121">         }</span>
<a href="#l46.122"></a><span id="l46.122">     },</span>
<a href="#l46.123"></a><span id="l46.123"> </span>
<a href="#l46.124"></a><span id="l46.124">     getCalendarPref_: function(calendar, name) {</span>
<a href="#l46.125"></a><span id="l46.125" class="difflineat">@@ -869,17 +874,17 @@ calMgrCalendarObserver.prototype = {</span>
<a href="#l46.126"></a><span id="l46.126">                                 &quot;auto-enabled&quot;,</span>
<a href="#l46.127"></a><span id="l46.127">                                 &quot;cache.enabled&quot;,</span>
<a href="#l46.128"></a><span id="l46.128">                                 &quot;refreshInterval&quot;,</span>
<a href="#l46.129"></a><span id="l46.129">                                 &quot;suppressAlarms&quot;,</span>
<a href="#l46.130"></a><span id="l46.130">                                 &quot;calendar-main-in-composite&quot;,</span>
<a href="#l46.131"></a><span id="l46.131">                                 &quot;calendar-main-default&quot;,</span>
<a href="#l46.132"></a><span id="l46.132">                                 &quot;readOnly&quot;,</span>
<a href="#l46.133"></a><span id="l46.133">                                 &quot;imip.identity.key&quot;];</span>
<a href="#l46.134"></a><span id="l46.134" class="difflineminus">-            for each (let prop in propsToCopy ) {</span>
<a href="#l46.135"></a><span id="l46.135" class="difflineplus">+            for (let prop of propsToCopy) {</span>
<a href="#l46.136"></a><span id="l46.136">               newCal.setProperty(prop,</span>
<a href="#l46.137"></a><span id="l46.137">                                  aCalendar.getProperty(prop));</span>
<a href="#l46.138"></a><span id="l46.138">             }</span>
<a href="#l46.139"></a><span id="l46.139"> </span>
<a href="#l46.140"></a><span id="l46.140">             if (initialSortOrderPos != null) {</span>
<a href="#l46.141"></a><span id="l46.141">                 newCal.setProperty(&quot;initialSortOrderPos&quot;,</span>
<a href="#l46.142"></a><span id="l46.142">                                    initialSortOrderPos);</span>
<a href="#l46.143"></a><span id="l46.143">             }</span>
<a href="#l46.144"></a><span id="l46.144" class="difflineat">@@ -1064,18 +1069,17 @@ var gCalendarManagerAddonListener = {</span>
<a href="#l46.145"></a><span id="l46.145">         }</span>
<a href="#l46.146"></a><span id="l46.146">     },</span>
<a href="#l46.147"></a><span id="l46.147"> </span>
<a href="#l46.148"></a><span id="l46.148">     queryUninstallProvider: function(aAddon) {</span>
<a href="#l46.149"></a><span id="l46.149">         const uri = &quot;chrome://calendar/content/calendar-providerUninstall-dialog.xul&quot;;</span>
<a href="#l46.150"></a><span id="l46.150">         const features = &quot;chrome,titlebar,resizable,modal&quot;;</span>
<a href="#l46.151"></a><span id="l46.151">         let calMgr = cal.getCalendarManager();</span>
<a href="#l46.152"></a><span id="l46.152">         let affectedCalendars =</span>
<a href="#l46.153"></a><span id="l46.153" class="difflineminus">-            [ calendar for each (calendar in calMgr.getCalendars({}))</span>
<a href="#l46.154"></a><span id="l46.154" class="difflineminus">-              if (calendar.providerID == aAddon.id) ];</span>
<a href="#l46.155"></a><span id="l46.155" class="difflineplus">+            calMgr.getCalendars({}).filter(calendar =&gt; calendar.providerID == aAddon.id);</span>
<a href="#l46.156"></a><span id="l46.156">         if (!affectedCalendars.length) {</span>
<a href="#l46.157"></a><span id="l46.157">             // If no calendars are affected, then everything is fine.</span>
<a href="#l46.158"></a><span id="l46.158">             return true;</span>
<a href="#l46.159"></a><span id="l46.159">         }</span>
<a href="#l46.160"></a><span id="l46.160"> </span>
<a href="#l46.161"></a><span id="l46.161">         let args = { shouldUninstall: false, extension: aAddon };</span>
<a href="#l46.162"></a><span id="l46.162"> </span>
<a href="#l46.163"></a><span id="l46.163">         // Now find a window. The best choice would be the most recent</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l47.1"></a><span id="l47.1" class="difflineminus">--- a/calendar/base/src/calDefaultACLManager.js</span>
<a href="#l47.2"></a><span id="l47.2" class="difflineplus">+++ b/calendar/base/src/calDefaultACLManager.js</span>
<a href="#l47.3"></a><span id="l47.3" class="difflineat">@@ -76,17 +76,17 @@ calDefaultCalendarACLEntry.prototype = {</span>
<a href="#l47.4"></a><span id="l47.4">         let identities = [];</span>
<a href="#l47.5"></a><span id="l47.5">         cal.calIterateEmailIdentities(function (id, ac) { identities.push(id); });</span>
<a href="#l47.6"></a><span id="l47.6">         aCount.value = identities.length;</span>
<a href="#l47.7"></a><span id="l47.7">         return identities;</span>
<a href="#l47.8"></a><span id="l47.8">     },</span>
<a href="#l47.9"></a><span id="l47.9"> </span>
<a href="#l47.10"></a><span id="l47.10">     getUserAddresses: function calDefaultCalendarACLEntry_getUserAddresses(aCount) {</span>
<a href="#l47.11"></a><span id="l47.11">         let identities = this.getUserIdentities(aCount);</span>
<a href="#l47.12"></a><span id="l47.12" class="difflineminus">-        let addresses = [ id.email for each (id in identities) ];</span>
<a href="#l47.13"></a><span id="l47.13" class="difflineplus">+        let addresses = identities.map(id =&gt; id.email);</span>
<a href="#l47.14"></a><span id="l47.14">         return addresses;</span>
<a href="#l47.15"></a><span id="l47.15">     },</span>
<a href="#l47.16"></a><span id="l47.16"> </span>
<a href="#l47.17"></a><span id="l47.17">     getUserIdentities: function calDefaultCalendarACLEntry_getUserIdentities(aCount) {</span>
<a href="#l47.18"></a><span id="l47.18">         let identity = cal.getEmailIdentityOfCalendar(this.mCalendar);</span>
<a href="#l47.19"></a><span id="l47.19">         if (identity) {</span>
<a href="#l47.20"></a><span id="l47.20">             aCount.value = 1;</span>
<a href="#l47.21"></a><span id="l47.21">             return [identity];</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l48.1"></a><span id="l48.1" class="difflineminus">--- a/calendar/base/src/calFilter.js</span>
<a href="#l48.2"></a><span id="l48.2" class="difflineplus">+++ b/calendar/base/src/calFilter.js</span>
<a href="#l48.3"></a><span id="l48.3" class="difflineat">@@ -871,17 +871,17 @@ calFilter.prototype = {</span>
<a href="#l48.4"></a><span id="l48.4"> </span>
<a href="#l48.5"></a><span id="l48.5">             onGetResult: function(aCalendar, aStatus, aItemType, aDetail, aCount, aItems) {</span>
<a href="#l48.6"></a><span id="l48.6">                 let items;</span>
<a href="#l48.7"></a><span id="l48.7">                 if (props.occurrences == props.FILTER_OCCURRENCES_PAST_AND_NEXT) {</span>
<a href="#l48.8"></a><span id="l48.8">                     // with the FILTER_OCCURRENCES_PAST_AND_NEXT occurrence filter we will</span>
<a href="#l48.9"></a><span id="l48.9">                     // get parent items returned here, so we need to let the getOccurrences</span>
<a href="#l48.10"></a><span id="l48.10">                     // function handle occurrence expansion.</span>
<a href="#l48.11"></a><span id="l48.11">                     items = [];</span>
<a href="#l48.12"></a><span id="l48.12" class="difflineminus">-                    for each (let item in aItems) {</span>
<a href="#l48.13"></a><span id="l48.13" class="difflineplus">+                    for (let item of aItems) {</span>
<a href="#l48.14"></a><span id="l48.14">                         items = items.concat(self.getOccurrences(item));</span>
<a href="#l48.15"></a><span id="l48.15">                     }</span>
<a href="#l48.16"></a><span id="l48.16">                 } else {</span>
<a href="#l48.17"></a><span id="l48.17">                     // with other occurrence filters the calICalendar.getItems() function will</span>
<a href="#l48.18"></a><span id="l48.18">                     // return expanded occurrences appropriately, we only need to filter them.</span>
<a href="#l48.19"></a><span id="l48.19">                     items = self.filterItems(aItems);</span>
<a href="#l48.20"></a><span id="l48.20">                 }</span>
<a href="#l48.21"></a><span id="l48.21"> </span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l49.1"></a><span id="l49.1" class="difflineminus">--- a/calendar/base/src/calIcsParser.js</span>
<a href="#l49.2"></a><span id="l49.2" class="difflineplus">+++ b/calendar/base/src/calIcsParser.js</span>
<a href="#l49.3"></a><span id="l49.3" class="difflineat">@@ -58,17 +58,17 @@ calIcsParser.prototype = {</span>
<a href="#l49.4"></a><span id="l49.4">                 state.submit(subComp);</span>
<a href="#l49.5"></a><span id="l49.5">             }</span>
<a href="#l49.6"></a><span id="l49.6">             calComp = rootComp.getNextSubcomponent(&quot;VCALENDAR&quot;);</span>
<a href="#l49.7"></a><span id="l49.7">         }</span>
<a href="#l49.8"></a><span id="l49.8"> </span>
<a href="#l49.9"></a><span id="l49.9">         state.join(function() {</span>
<a href="#l49.10"></a><span id="l49.10">             let fakedParents = {};</span>
<a href="#l49.11"></a><span id="l49.11">             // tag &quot;exceptions&quot;, i.e. items with rid:</span>
<a href="#l49.12"></a><span id="l49.12" class="difflineminus">-            for each (let item in state.excItems) {</span>
<a href="#l49.13"></a><span id="l49.13" class="difflineplus">+            for (let item of state.excItems) {</span>
<a href="#l49.14"></a><span id="l49.14">                 let parent = state.uid2parent[item.id];</span>
<a href="#l49.15"></a><span id="l49.15"> </span>
<a href="#l49.16"></a><span id="l49.16">                 if (!parent) { // a parentless one, fake a master and override it's occurrence</span>
<a href="#l49.17"></a><span id="l49.17">                     parent = isEvent(item) ? createEvent() : createTodo();</span>
<a href="#l49.18"></a><span id="l49.18">                     parent.id = item.id;</span>
<a href="#l49.19"></a><span id="l49.19">                     parent.setProperty(&quot;DTSTART&quot;, item.recurrenceId);</span>
<a href="#l49.20"></a><span id="l49.20">                     parent.setProperty(&quot;X-MOZ-FAKED-MASTER&quot;, &quot;1&quot;); // this tag might be useful in the future</span>
<a href="#l49.21"></a><span id="l49.21">                     parent.recurrenceInfo = cal.createRecurrenceInfo(parent);</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l50.1"></a><span id="l50.1" class="difflineminus">--- a/calendar/base/src/calIcsSerializer.js</span>
<a href="#l50.2"></a><span id="l50.2" class="difflineplus">+++ b/calendar/base/src/calIcsSerializer.js</span>
<a href="#l50.3"></a><span id="l50.3" class="difflineat">@@ -62,20 +62,20 @@ calIcsSerializer.prototype = {</span>
<a href="#l50.4"></a><span id="l50.4"> </span>
<a href="#l50.5"></a><span id="l50.5">     getIcalComponent: function is_getIcalComponent() {</span>
<a href="#l50.6"></a><span id="l50.6">         let calComp = getIcsService().createIcalComponent(&quot;VCALENDAR&quot;);</span>
<a href="#l50.7"></a><span id="l50.7">         calSetProdidVersion(calComp);</span>
<a href="#l50.8"></a><span id="l50.8"> </span>
<a href="#l50.9"></a><span id="l50.9">         // xxx todo: think about that the below code doesn't clone the properties/components,</span>
<a href="#l50.10"></a><span id="l50.10">         //           thus ownership is moved to returned VCALENDAR...</span>
<a href="#l50.11"></a><span id="l50.11"> </span>
<a href="#l50.12"></a><span id="l50.12" class="difflineminus">-        for each (let prop in this.mProperties) {</span>
<a href="#l50.13"></a><span id="l50.13" class="difflineplus">+        for (let prop of this.mProperties) {</span>
<a href="#l50.14"></a><span id="l50.14">             calComp.addProperty(prop);</span>
<a href="#l50.15"></a><span id="l50.15">         }</span>
<a href="#l50.16"></a><span id="l50.16" class="difflineminus">-        for each (let comp in this.mComponents) {</span>
<a href="#l50.17"></a><span id="l50.17" class="difflineplus">+        for (let comp of this.mComponents) {</span>
<a href="#l50.18"></a><span id="l50.18">             calComp.addSubcomponent(comp);</span>
<a href="#l50.19"></a><span id="l50.19">         }</span>
<a href="#l50.20"></a><span id="l50.20"> </span>
<a href="#l50.21"></a><span id="l50.21">         for (let item in cal.itemIterator(this.mItems)) {</span>
<a href="#l50.22"></a><span id="l50.22">             calComp.addSubcomponent(item.icalComponent);</span>
<a href="#l50.23"></a><span id="l50.23">         }</span>
<a href="#l50.24"></a><span id="l50.24"> </span>
<a href="#l50.25"></a><span id="l50.25">         return calComp;</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l51.1"></a><span id="l51.1" class="difflineminus">--- a/calendar/base/src/calItemBase.js</span>
<a href="#l51.2"></a><span id="l51.2" class="difflineplus">+++ b/calendar/base/src/calItemBase.js</span>
<a href="#l51.3"></a><span id="l51.3" class="difflineat">@@ -192,30 +192,30 @@ calItemBase.prototype = {</span>
<a href="#l51.4"></a><span id="l51.4"> </span>
<a href="#l51.5"></a><span id="l51.5">         // make all our components immutable</span>
<a href="#l51.6"></a><span id="l51.6">         if (this.mRecurrenceInfo)</span>
<a href="#l51.7"></a><span id="l51.7">             this.mRecurrenceInfo.makeImmutable();</span>
<a href="#l51.8"></a><span id="l51.8"> </span>
<a href="#l51.9"></a><span id="l51.9">         if (this.mOrganizer)</span>
<a href="#l51.10"></a><span id="l51.10">             this.mOrganizer.makeImmutable();</span>
<a href="#l51.11"></a><span id="l51.11">         if (this.mAttendees) {</span>
<a href="#l51.12"></a><span id="l51.12" class="difflineminus">-            for each (let att in this.mAttendees) {</span>
<a href="#l51.13"></a><span id="l51.13" class="difflineplus">+            for (let att of this.mAttendees) {</span>
<a href="#l51.14"></a><span id="l51.14">                 att.makeImmutable();</span>
<a href="#l51.15"></a><span id="l51.15">             }</span>
<a href="#l51.16"></a><span id="l51.16">         }</span>
<a href="#l51.17"></a><span id="l51.17"> </span>
<a href="#l51.18"></a><span id="l51.18" class="difflineminus">-        for each (let [propKey, propValue] in this.mProperties) {</span>
<a href="#l51.19"></a><span id="l51.19" class="difflineplus">+        for (let [propKey, propValue] of this.mProperties) {</span>
<a href="#l51.20"></a><span id="l51.20">             if (propValue instanceof Components.interfaces.calIDateTime &amp;&amp;</span>
<a href="#l51.21"></a><span id="l51.21">                 propValue.isMutable) {</span>
<a href="#l51.22"></a><span id="l51.22">                 propValue.makeImmutable();</span>
<a href="#l51.23"></a><span id="l51.23">             }</span>
<a href="#l51.24"></a><span id="l51.24">         }</span>
<a href="#l51.25"></a><span id="l51.25"> </span>
<a href="#l51.26"></a><span id="l51.26">         if (this.mAlarms) {</span>
<a href="#l51.27"></a><span id="l51.27" class="difflineminus">-            for each (let alarm in this.mAlarms) {</span>
<a href="#l51.28"></a><span id="l51.28" class="difflineplus">+            for (let alarm of this.mAlarms) {</span>
<a href="#l51.29"></a><span id="l51.29">                 alarm.makeImmutable();</span>
<a href="#l51.30"></a><span id="l51.30">             }</span>
<a href="#l51.31"></a><span id="l51.31">         }</span>
<a href="#l51.32"></a><span id="l51.32"> </span>
<a href="#l51.33"></a><span id="l51.33">         if (this.mAlarmLastAck) {</span>
<a href="#l51.34"></a><span id="l51.34">             this.mAlarmLastAck.makeImmutable();</span>
<a href="#l51.35"></a><span id="l51.35">         }</span>
<a href="#l51.36"></a><span id="l51.36"> </span>
<a href="#l51.37"></a><span id="l51.37" class="difflineat">@@ -257,22 +257,22 @@ calItemBase.prototype = {</span>
<a href="#l51.38"></a><span id="l51.38"> </span>
<a href="#l51.39"></a><span id="l51.39">         let org = this.organizer;</span>
<a href="#l51.40"></a><span id="l51.40">         if (org) {</span>
<a href="#l51.41"></a><span id="l51.41">             org = org.clone();</span>
<a href="#l51.42"></a><span id="l51.42">         }</span>
<a href="#l51.43"></a><span id="l51.43">         m.mOrganizer = org;</span>
<a href="#l51.44"></a><span id="l51.44"> </span>
<a href="#l51.45"></a><span id="l51.45">         m.mAttendees = [];</span>
<a href="#l51.46"></a><span id="l51.46" class="difflineminus">-        for each (let att in this.getAttendees({})) {</span>
<a href="#l51.47"></a><span id="l51.47" class="difflineplus">+        for (let att of this.getAttendees({})) {</span>
<a href="#l51.48"></a><span id="l51.48">             m.mAttendees.push(att.clone());</span>
<a href="#l51.49"></a><span id="l51.49">         }</span>
<a href="#l51.50"></a><span id="l51.50"> </span>
<a href="#l51.51"></a><span id="l51.51">         m.mProperties = new calPropertyBag();</span>
<a href="#l51.52"></a><span id="l51.52" class="difflineminus">-        for each (let [name, value] in this.mProperties) {</span>
<a href="#l51.53"></a><span id="l51.53" class="difflineplus">+        for (let [name, value] of this.mProperties) {</span>
<a href="#l51.54"></a><span id="l51.54">             if (value instanceof Components.interfaces.calIDateTime) {</span>
<a href="#l51.55"></a><span id="l51.55">                 value = value.clone();</span>
<a href="#l51.56"></a><span id="l51.56">             }</span>
<a href="#l51.57"></a><span id="l51.57"> </span>
<a href="#l51.58"></a><span id="l51.58">             m.mProperties.setProperty(name, value);</span>
<a href="#l51.59"></a><span id="l51.59"> </span>
<a href="#l51.60"></a><span id="l51.60">             let propBucket = this.mPropertyParams[name];</span>
<a href="#l51.61"></a><span id="l51.61">             if (propBucket) {</span>
<a href="#l51.62"></a><span id="l51.62" class="difflineat">@@ -280,29 +280,29 @@ calItemBase.prototype = {</span>
<a href="#l51.63"></a><span id="l51.63">                 for (let param in propBucket) {</span>
<a href="#l51.64"></a><span id="l51.64">                     newBucket[param] = propBucket[param];</span>
<a href="#l51.65"></a><span id="l51.65">                 }</span>
<a href="#l51.66"></a><span id="l51.66">                 m.mPropertyParams[name] = newBucket;</span>
<a href="#l51.67"></a><span id="l51.67">             }</span>
<a href="#l51.68"></a><span id="l51.68">         }</span>
<a href="#l51.69"></a><span id="l51.69"> </span>
<a href="#l51.70"></a><span id="l51.70">         m.mAttachments = [];</span>
<a href="#l51.71"></a><span id="l51.71" class="difflineminus">-        for each (let att in this.getAttachments({})) {</span>
<a href="#l51.72"></a><span id="l51.72" class="difflineplus">+        for (let att of this.getAttachments({})) {</span>
<a href="#l51.73"></a><span id="l51.73">             m.mAttachments.push(att.clone());</span>
<a href="#l51.74"></a><span id="l51.74">         }</span>
<a href="#l51.75"></a><span id="l51.75"> </span>
<a href="#l51.76"></a><span id="l51.76">         m.mRelations = [];</span>
<a href="#l51.77"></a><span id="l51.77" class="difflineminus">-        for each (let rel in this.getRelations({})) {</span>
<a href="#l51.78"></a><span id="l51.78" class="difflineplus">+        for (let rel of this.getRelations({})) {</span>
<a href="#l51.79"></a><span id="l51.79">             m.mRelations.push(rel.clone());</span>
<a href="#l51.80"></a><span id="l51.80">         }</span>
<a href="#l51.81"></a><span id="l51.81"> </span>
<a href="#l51.82"></a><span id="l51.82">         m.mCategories = this.getCategories({});</span>
<a href="#l51.83"></a><span id="l51.83"> </span>
<a href="#l51.84"></a><span id="l51.84">         m.mAlarms = [];</span>
<a href="#l51.85"></a><span id="l51.85" class="difflineminus">-        for each (let alarm in this.getAlarms({})) {</span>
<a href="#l51.86"></a><span id="l51.86" class="difflineplus">+        for (let alarm of this.getAlarms({})) {</span>
<a href="#l51.87"></a><span id="l51.87">             // Clone alarms into new item, assume the alarms from the old item</span>
<a href="#l51.88"></a><span id="l51.88">             // are valid and don't need validation.</span>
<a href="#l51.89"></a><span id="l51.89">             m.mAlarms.push(alarm.clone());</span>
<a href="#l51.90"></a><span id="l51.90">         }</span>
<a href="#l51.91"></a><span id="l51.91"> </span>
<a href="#l51.92"></a><span id="l51.92">         let alarmLastAck = this.alarmLastAck;</span>
<a href="#l51.93"></a><span id="l51.93">         if (alarmLastAck) {</span>
<a href="#l51.94"></a><span id="l51.94">             alarmLastAck = alarmLastAck.clone();</span>
<a href="#l51.95"></a><span id="l51.95" class="difflineat">@@ -514,17 +514,17 @@ calItemBase.prototype = {</span>
<a href="#l51.96"></a><span id="l51.96">             return [];</span>
<a href="#l51.97"></a><span id="l51.97">         }</span>
<a href="#l51.98"></a><span id="l51.98">     },</span>
<a href="#l51.99"></a><span id="l51.99"> </span>
<a href="#l51.100"></a><span id="l51.100">     // calIAttendee getAttendeeById(in AUTF8String id);</span>
<a href="#l51.101"></a><span id="l51.101">     getAttendeeById: function cIB_getAttendeeById(id) {</span>
<a href="#l51.102"></a><span id="l51.102">         var attendees = this.getAttendees({});</span>
<a href="#l51.103"></a><span id="l51.103">         var lowerCaseId = id.toLowerCase();</span>
<a href="#l51.104"></a><span id="l51.104" class="difflineminus">-        for each (var attendee in attendees) {</span>
<a href="#l51.105"></a><span id="l51.105" class="difflineplus">+        for (var attendee of attendees) {</span>
<a href="#l51.106"></a><span id="l51.106">             // This match must be case insensitive to deal with differing</span>
<a href="#l51.107"></a><span id="l51.107">             // cases of things like MAILTO:</span>
<a href="#l51.108"></a><span id="l51.108">             if (attendee.id.toLowerCase() == lowerCaseId) {</span>
<a href="#l51.109"></a><span id="l51.109">                 return attendee;</span>
<a href="#l51.110"></a><span id="l51.110">             }</span>
<a href="#l51.111"></a><span id="l51.111">         }</span>
<a href="#l51.112"></a><span id="l51.112">         return null;</span>
<a href="#l51.113"></a><span id="l51.113">     },</span>
<a href="#l51.114"></a><span id="l51.114" class="difflineat">@@ -914,17 +914,17 @@ calItemBase.prototype = {</span>
<a href="#l51.115"></a><span id="l51.115">      * @param icalcomp      The ical component to read.</span>
<a href="#l51.116"></a><span id="l51.116">      * @param promoted      The map of promoted properties.</span>
<a href="#l51.117"></a><span id="l51.117">      */</span>
<a href="#l51.118"></a><span id="l51.118">     importUnpromotedProperties: function cIB_importUnpromotedProperties(icalcomp, promoted) {</span>
<a href="#l51.119"></a><span id="l51.119">         for (let prop in cal.ical.propertyIterator(icalcomp)) {</span>
<a href="#l51.120"></a><span id="l51.120">             let propName = prop.propertyName;</span>
<a href="#l51.121"></a><span id="l51.121">             if (!promoted[propName]) {</span>
<a href="#l51.122"></a><span id="l51.122">                 this.setProperty(propName, prop.value);</span>
<a href="#l51.123"></a><span id="l51.123" class="difflineminus">-                for each (let [paramName, paramValue] in cal.ical.paramIterator(prop)) {</span>
<a href="#l51.124"></a><span id="l51.124" class="difflineplus">+                for (let [paramName, paramValue] of cal.ical.paramIterator(prop)) {</span>
<a href="#l51.125"></a><span id="l51.125">                     if (!(propName in this.mPropertyParams)) {</span>
<a href="#l51.126"></a><span id="l51.126">                         this.mPropertyParams[propName] = {};</span>
<a href="#l51.127"></a><span id="l51.127">                     }</span>
<a href="#l51.128"></a><span id="l51.128">                     this.mPropertyParams[propName][paramName] = paramValue;</span>
<a href="#l51.129"></a><span id="l51.129">                 }</span>
<a href="#l51.130"></a><span id="l51.130">             }</span>
<a href="#l51.131"></a><span id="l51.131">         }</span>
<a href="#l51.132"></a><span id="l51.132">     },</span>
<a href="#l51.133"></a><span id="l51.133" class="difflineat">@@ -962,42 +962,44 @@ calItemBase.prototype = {</span>
<a href="#l51.134"></a><span id="l51.134"> </span>
<a href="#l51.135"></a><span id="l51.135">         this.mapPropsToICS(icalcomp, this.icsBasePropMap);</span>
<a href="#l51.136"></a><span id="l51.136"> </span>
<a href="#l51.137"></a><span id="l51.137">         let org = this.organizer;</span>
<a href="#l51.138"></a><span id="l51.138">         if (org) {</span>
<a href="#l51.139"></a><span id="l51.139">             icalcomp.addProperty(org.icalProperty);</span>
<a href="#l51.140"></a><span id="l51.140">         }</span>
<a href="#l51.141"></a><span id="l51.141"> </span>
<a href="#l51.142"></a><span id="l51.142" class="difflineminus">-        for each (let attendee in this.getAttendees({})) {</span>
<a href="#l51.143"></a><span id="l51.143" class="difflineplus">+        for (let attendee of this.getAttendees({})) {</span>
<a href="#l51.144"></a><span id="l51.144">             icalcomp.addProperty(attendee.icalProperty);</span>
<a href="#l51.145"></a><span id="l51.145">         }</span>
<a href="#l51.146"></a><span id="l51.146"> </span>
<a href="#l51.147"></a><span id="l51.147" class="difflineminus">-        for each (let attachment in this.getAttachments({})) {</span>
<a href="#l51.148"></a><span id="l51.148" class="difflineplus">+        for (let attachment of this.getAttachments({})) {</span>
<a href="#l51.149"></a><span id="l51.149">             icalcomp.addProperty(attachment.icalProperty);</span>
<a href="#l51.150"></a><span id="l51.150">         }</span>
<a href="#l51.151"></a><span id="l51.151"> </span>
<a href="#l51.152"></a><span id="l51.152" class="difflineminus">-        for each (let relation in this.getRelations({})) {</span>
<a href="#l51.153"></a><span id="l51.153" class="difflineplus">+        for (let relation of this.getRelations({})) {</span>
<a href="#l51.154"></a><span id="l51.154">             icalcomp.addProperty(relation.icalProperty);</span>
<a href="#l51.155"></a><span id="l51.155">         }</span>
<a href="#l51.156"></a><span id="l51.156"> </span>
<a href="#l51.157"></a><span id="l51.157">         if (this.mRecurrenceInfo) {</span>
<a href="#l51.158"></a><span id="l51.158" class="difflineminus">-            for each (let ritem in this.mRecurrenceInfo.getRecurrenceItems({})) {</span>
<a href="#l51.159"></a><span id="l51.159" class="difflineplus">+            for (let ritem of this.mRecurrenceInfo.getRecurrenceItems({})) {</span>
<a href="#l51.160"></a><span id="l51.160">                 icalcomp.addProperty(ritem.icalProperty);</span>
<a href="#l51.161"></a><span id="l51.161">             }</span>
<a href="#l51.162"></a><span id="l51.162">         }</span>
<a href="#l51.163"></a><span id="l51.163"> </span>
<a href="#l51.164"></a><span id="l51.164" class="difflineminus">-        for each (let cat in this.getCategories({})) {</span>
<a href="#l51.165"></a><span id="l51.165" class="difflineplus">+        for (let cat of this.getCategories({})) {</span>
<a href="#l51.166"></a><span id="l51.166">             let catprop = icssvc.createIcalProperty(&quot;CATEGORIES&quot;);</span>
<a href="#l51.167"></a><span id="l51.167">             catprop.value = cat;</span>
<a href="#l51.168"></a><span id="l51.168">             icalcomp.addProperty(catprop);</span>
<a href="#l51.169"></a><span id="l51.169">         }</span>
<a href="#l51.170"></a><span id="l51.170"> </span>
<a href="#l51.171"></a><span id="l51.171" class="difflineminus">-        for each (let alarm in this.mAlarms) {</span>
<a href="#l51.172"></a><span id="l51.172" class="difflineminus">-            icalcomp.addSubcomponent(alarm.icalComponent);</span>
<a href="#l51.173"></a><span id="l51.173" class="difflineplus">+        if (this.mAlarms) {</span>
<a href="#l51.174"></a><span id="l51.174" class="difflineplus">+            for (let alarm of this.mAlarms) {</span>
<a href="#l51.175"></a><span id="l51.175" class="difflineplus">+                icalcomp.addSubcomponent(alarm.icalComponent);</span>
<a href="#l51.176"></a><span id="l51.176" class="difflineplus">+            }</span>
<a href="#l51.177"></a><span id="l51.177">         }</span>
<a href="#l51.178"></a><span id="l51.178"> </span>
<a href="#l51.179"></a><span id="l51.179">         let alarmLastAck = this.alarmLastAck;</span>
<a href="#l51.180"></a><span id="l51.180">         if (alarmLastAck) {</span>
<a href="#l51.181"></a><span id="l51.181">             let lastAck = cal.getIcsService().createIcalProperty(&quot;X-MOZ-LASTACK&quot;);</span>
<a href="#l51.182"></a><span id="l51.182">             // - should we further ensure that those are UTC or rely on calAlarmService doing so?</span>
<a href="#l51.183"></a><span id="l51.183">             lastAck.value = alarmLastAck.icalString;</span>
<a href="#l51.184"></a><span id="l51.184">             icalcomp.addProperty(lastAck);</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l52.1"></a><span id="l52.1" class="difflineminus">--- a/calendar/base/src/calItipItem.js</span>
<a href="#l52.2"></a><span id="l52.2" class="difflineplus">+++ b/calendar/base/src/calItipItem.js</span>
<a href="#l52.3"></a><span id="l52.3" class="difflineat">@@ -140,17 +140,17 @@ calItipItem.prototype = {</span>
<a href="#l52.4"></a><span id="l52.4">             }</span>
<a href="#l52.5"></a><span id="l52.5">         }</span>
<a href="#l52.6"></a><span id="l52.6"> </span>
<a href="#l52.7"></a><span id="l52.7">         // We set both methods now for safety's sake. It's the ItipProcessor's</span>
<a href="#l52.8"></a><span id="l52.8">         // responsibility to properly ascertain what the correct response</span>
<a href="#l52.9"></a><span id="l52.9">         // method is (using user feedback, prefs, etc.) for the given</span>
<a href="#l52.10"></a><span id="l52.10">         // receivedMethod.  The RFC tells us to treat items without a METHOD</span>
<a href="#l52.11"></a><span id="l52.11">         // as if they were METHOD:REQUEST.</span>
<a href="#l52.12"></a><span id="l52.12" class="difflineminus">-        for each (let prop in parser.getProperties({})) {</span>
<a href="#l52.13"></a><span id="l52.13" class="difflineplus">+        for (let prop of parser.getProperties({})) {</span>
<a href="#l52.14"></a><span id="l52.14">             if (prop.propertyName == &quot;METHOD&quot;) {</span>
<a href="#l52.15"></a><span id="l52.15">                 this.mReceivedMethod = prop.value;</span>
<a href="#l52.16"></a><span id="l52.16">                 this.mResponseMethod = prop.value;</span>
<a href="#l52.17"></a><span id="l52.17">                 break;</span>
<a href="#l52.18"></a><span id="l52.18">             }</span>
<a href="#l52.19"></a><span id="l52.19">         }</span>
<a href="#l52.20"></a><span id="l52.20"> </span>
<a href="#l52.21"></a><span id="l52.21">         this.mIsInitialized = true;</span>
<a href="#l52.22"></a><span id="l52.22" class="difflineat">@@ -187,17 +187,17 @@ calItipItem.prototype = {</span>
<a href="#l52.23"></a><span id="l52.23">      * way, which is a current limitation of the spec.</span>
<a href="#l52.24"></a><span id="l52.24">      */</span>
<a href="#l52.25"></a><span id="l52.25">     setAttendeeStatus: function ciiSAS(aAttendeeId, aStatus) {</span>
<a href="#l52.26"></a><span id="l52.26">         // Append &quot;mailto:&quot; to the attendee if it is missing it.</span>
<a href="#l52.27"></a><span id="l52.27">         if (!aAttendeeId.match(/^mailto:/i)) {</span>
<a href="#l52.28"></a><span id="l52.28">             aAttendeeId = (&quot;mailto:&quot; + aAttendeeId);</span>
<a href="#l52.29"></a><span id="l52.29">         }</span>
<a href="#l52.30"></a><span id="l52.30"> </span>
<a href="#l52.31"></a><span id="l52.31" class="difflineminus">-        for each (let item in this.mItemList) {</span>
<a href="#l52.32"></a><span id="l52.32" class="difflineplus">+        for (let item of this.mItemList) {</span>
<a href="#l52.33"></a><span id="l52.33">             let attendee = item.getAttendeeById(aAttendeeId);</span>
<a href="#l52.34"></a><span id="l52.34">             if (attendee) {</span>
<a href="#l52.35"></a><span id="l52.35">                 // Replies should not have the RSVP property.</span>
<a href="#l52.36"></a><span id="l52.36">                 // XXX BUG 351589: workaround for updating an attendee</span>
<a href="#l52.37"></a><span id="l52.37">                 item.removeAttendee(attendee);</span>
<a href="#l52.38"></a><span id="l52.38">                 attendee = attendee.clone();</span>
<a href="#l52.39"></a><span id="l52.39">                 attendee.rsvp = null;</span>
<a href="#l52.40"></a><span id="l52.40">                 item.addAttendee(attendee);</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l53.1"></a><span id="l53.1" class="difflineminus">--- a/calendar/base/src/calRecurrenceInfo.js</span>
<a href="#l53.2"></a><span id="l53.2" class="difflineplus">+++ b/calendar/base/src/calRecurrenceInfo.js</span>
<a href="#l53.3"></a><span id="l53.3" class="difflineat">@@ -54,17 +54,17 @@ calRecurrenceInfo.prototype = {</span>
<a href="#l53.4"></a><span id="l53.4">         if (this.mImmutable) {</span>
<a href="#l53.5"></a><span id="l53.5">             throw Components.results.NS_ERROR_OBJECT_IS_IMMUTABLE;</span>
<a href="#l53.6"></a><span id="l53.6">         }</span>
<a href="#l53.7"></a><span id="l53.7">     },</span>
<a href="#l53.8"></a><span id="l53.8">     ensureSortedRecurrenceRules: function cRI_ensureSortedRecurrenceRules() {</span>
<a href="#l53.9"></a><span id="l53.9">         if (!this.mPositiveRules || !this.mNegativeRules) {</span>
<a href="#l53.10"></a><span id="l53.10">             this.mPositiveRules = [];</span>
<a href="#l53.11"></a><span id="l53.11">             this.mNegativeRules = [];</span>
<a href="#l53.12"></a><span id="l53.12" class="difflineminus">-            for each (var ritem in this.mRecurrenceItems) {</span>
<a href="#l53.13"></a><span id="l53.13" class="difflineplus">+            for (var ritem of this.mRecurrenceItems) {</span>
<a href="#l53.14"></a><span id="l53.14">                 if (ritem.isNegative) {</span>
<a href="#l53.15"></a><span id="l53.15">                     this.mNegativeRules.push(ritem);</span>
<a href="#l53.16"></a><span id="l53.16">                 } else {</span>
<a href="#l53.17"></a><span id="l53.17">                     this.mPositiveRules.push(ritem);</span>
<a href="#l53.18"></a><span id="l53.18">                 }</span>
<a href="#l53.19"></a><span id="l53.19">             }</span>
<a href="#l53.20"></a><span id="l53.20">         }</span>
<a href="#l53.21"></a><span id="l53.21">     },</span>
<a href="#l53.22"></a><span id="l53.22" class="difflineat">@@ -75,37 +75,38 @@ calRecurrenceInfo.prototype = {</span>
<a href="#l53.23"></a><span id="l53.23">     get isMutable() {</span>
<a href="#l53.24"></a><span id="l53.24">         return !this.mImmutable;</span>
<a href="#l53.25"></a><span id="l53.25">     },</span>
<a href="#l53.26"></a><span id="l53.26">     makeImmutable: function cRI_makeImmutable() {</span>
<a href="#l53.27"></a><span id="l53.27">         if (this.mImmutable) {</span>
<a href="#l53.28"></a><span id="l53.28">             return;</span>
<a href="#l53.29"></a><span id="l53.29">         }</span>
<a href="#l53.30"></a><span id="l53.30"> </span>
<a href="#l53.31"></a><span id="l53.31" class="difflineminus">-        for each (let ritem in this.mRecurrenceItems) {</span>
<a href="#l53.32"></a><span id="l53.32" class="difflineplus">+        for (let ritem of this.mRecurrenceItems) {</span>
<a href="#l53.33"></a><span id="l53.33">             if (ritem.isMutable) {</span>
<a href="#l53.34"></a><span id="l53.34">                 ritem.makeImmutable();</span>
<a href="#l53.35"></a><span id="l53.35">             }</span>
<a href="#l53.36"></a><span id="l53.36">         }</span>
<a href="#l53.37"></a><span id="l53.37"> </span>
<a href="#l53.38"></a><span id="l53.38" class="difflineminus">-        for each (let item in this.mExceptionMap) {</span>
<a href="#l53.39"></a><span id="l53.39" class="difflineplus">+        for (let ex in this.mExceptionMap) {</span>
<a href="#l53.40"></a><span id="l53.40" class="difflineplus">+            let item = this.mExceptionMap[ex];</span>
<a href="#l53.41"></a><span id="l53.41">             if (item.isMutable) {</span>
<a href="#l53.42"></a><span id="l53.42">                 item.makeImmutable();</span>
<a href="#l53.43"></a><span id="l53.43">             }</span>
<a href="#l53.44"></a><span id="l53.44">         }</span>
<a href="#l53.45"></a><span id="l53.45"> </span>
<a href="#l53.46"></a><span id="l53.46">         this.mImmutable = true;</span>
<a href="#l53.47"></a><span id="l53.47">     },</span>
<a href="#l53.48"></a><span id="l53.48"> </span>
<a href="#l53.49"></a><span id="l53.49">     clone: function cRI_clone() {</span>
<a href="#l53.50"></a><span id="l53.50">         var cloned = new calRecurrenceInfo();</span>
<a href="#l53.51"></a><span id="l53.51">         cloned.mBaseItem = this.mBaseItem;</span>
<a href="#l53.52"></a><span id="l53.52"> </span>
<a href="#l53.53"></a><span id="l53.53">         var clonedItems = [];</span>
<a href="#l53.54"></a><span id="l53.54" class="difflineminus">-        for each (var ritem in this.mRecurrenceItems) {</span>
<a href="#l53.55"></a><span id="l53.55" class="difflineplus">+        for (var ritem of this.mRecurrenceItems) {</span>
<a href="#l53.56"></a><span id="l53.56">             clonedItems.push(ritem.clone());</span>
<a href="#l53.57"></a><span id="l53.57">         }</span>
<a href="#l53.58"></a><span id="l53.58">         cloned.mRecurrenceItems = clonedItems;</span>
<a href="#l53.59"></a><span id="l53.59"> </span>
<a href="#l53.60"></a><span id="l53.60">         var clonedExceptions = {};</span>
<a href="#l53.61"></a><span id="l53.61">         for (var exitem in this.mExceptionMap) {</span>
<a href="#l53.62"></a><span id="l53.62">             clonedExceptions[exitem] = this.mExceptionMap[exitem].cloneShallow(this.mBaseItem);</span>
<a href="#l53.63"></a><span id="l53.63">         }</span>
<a href="#l53.64"></a><span id="l53.64" class="difflineat">@@ -121,25 +122,26 @@ calRecurrenceInfo.prototype = {</span>
<a href="#l53.65"></a><span id="l53.65">         return this.mBaseItem;</span>
<a href="#l53.66"></a><span id="l53.66">     },</span>
<a href="#l53.67"></a><span id="l53.67">     set item(value) {</span>
<a href="#l53.68"></a><span id="l53.68">         this.ensureMutable();</span>
<a href="#l53.69"></a><span id="l53.69"> </span>
<a href="#l53.70"></a><span id="l53.70">         value = calTryWrappedJSObject(value);</span>
<a href="#l53.71"></a><span id="l53.71">         this.mBaseItem = value;</span>
<a href="#l53.72"></a><span id="l53.72">         // patch exception's parentItem:</span>
<a href="#l53.73"></a><span id="l53.73" class="difflineminus">-        for each (let exitem in this.mExceptionMap) {</span>
<a href="#l53.74"></a><span id="l53.74" class="difflineplus">+        for (let ex in this.mExceptionMap) {</span>
<a href="#l53.75"></a><span id="l53.75" class="difflineplus">+            let exitem = this.mExceptionMap[ex];</span>
<a href="#l53.76"></a><span id="l53.76">             exitem.parentItem = value;</span>
<a href="#l53.77"></a><span id="l53.77">         }</span>
<a href="#l53.78"></a><span id="l53.78">     },</span>
<a href="#l53.79"></a><span id="l53.79"> </span>
<a href="#l53.80"></a><span id="l53.80">     get isFinite() {</span>
<a href="#l53.81"></a><span id="l53.81">         this.ensureBaseItem();</span>
<a href="#l53.82"></a><span id="l53.82"> </span>
<a href="#l53.83"></a><span id="l53.83" class="difflineminus">-        for each (let ritem in this.mRecurrenceItems) {</span>
<a href="#l53.84"></a><span id="l53.84" class="difflineplus">+        for (let ritem of this.mRecurrenceItems) {</span>
<a href="#l53.85"></a><span id="l53.85">             if (!ritem.isFinite) {</span>
<a href="#l53.86"></a><span id="l53.86">                 return false;</span>
<a href="#l53.87"></a><span id="l53.87">             }</span>
<a href="#l53.88"></a><span id="l53.88">         }</span>
<a href="#l53.89"></a><span id="l53.89">         return true;</span>
<a href="#l53.90"></a><span id="l53.90">     },</span>
<a href="#l53.91"></a><span id="l53.91"> </span>
<a href="#l53.92"></a><span id="l53.92">     getRecurrenceItems: function cRI_getRecurrenceItems(aCount) {</span>
<a href="#l53.93"></a><span id="l53.93" class="difflineat">@@ -261,33 +263,33 @@ calRecurrenceInfo.prototype = {</span>
<a href="#l53.94"></a><span id="l53.94"> </span>
<a href="#l53.95"></a><span id="l53.95">         var nextOccurrences = [];</span>
<a href="#l53.96"></a><span id="l53.96">         var invalidOccurrences;</span>
<a href="#l53.97"></a><span id="l53.97">         var negMap = {};</span>
<a href="#l53.98"></a><span id="l53.98">         var minOccRid;</span>
<a href="#l53.99"></a><span id="l53.99"> </span>
<a href="#l53.100"></a><span id="l53.100">         // Go through all negative rules to create a map of occurrences that</span>
<a href="#l53.101"></a><span id="l53.101">         // should be skipped when going through occurrences.</span>
<a href="#l53.102"></a><span id="l53.102" class="difflineminus">-        for each (var ritem in this.mNegativeRules) {</span>
<a href="#l53.103"></a><span id="l53.103" class="difflineplus">+        for (var ritem of this.mNegativeRules) {</span>
<a href="#l53.104"></a><span id="l53.104">             // TODO Infinite rules (i.e EXRULE) are not taken into account,</span>
<a href="#l53.105"></a><span id="l53.105">             // because its very performance hungry and could potentially</span>
<a href="#l53.106"></a><span id="l53.106">             // lead to a deadlock (i.e RRULE is canceled out by an EXRULE).</span>
<a href="#l53.107"></a><span id="l53.107">             // This is ok for now, since EXRULE is deprecated anyway.</span>
<a href="#l53.108"></a><span id="l53.108">             if (ritem.isFinite) {</span>
<a href="#l53.109"></a><span id="l53.109">                 // Get all occurrences starting at our recurrence start date.</span>
<a href="#l53.110"></a><span id="l53.110">                 // This is fine, since there will never be an EXDATE that</span>
<a href="#l53.111"></a><span id="l53.111">                 // occurrs before the event started and its illegal to EXDATE an</span>
<a href="#l53.112"></a><span id="l53.112">                 // RDATE.</span>
<a href="#l53.113"></a><span id="l53.113">                 var rdates = ritem.getOccurrences(startDate,</span>
<a href="#l53.114"></a><span id="l53.114">                                                   startDate,</span>
<a href="#l53.115"></a><span id="l53.115">                                                   null,</span>
<a href="#l53.116"></a><span id="l53.116">                                                   0,</span>
<a href="#l53.117"></a><span id="l53.117">                                                   {});</span>
<a href="#l53.118"></a><span id="l53.118">                 // Map all negative dates.</span>
<a href="#l53.119"></a><span id="l53.119" class="difflineminus">-                for each (var r in rdates) {</span>
<a href="#l53.120"></a><span id="l53.120" class="difflineplus">+                for (var r of rdates) {</span>
<a href="#l53.121"></a><span id="l53.121">                     negMap[getRidKey(r)] = true;</span>
<a href="#l53.122"></a><span id="l53.122">                 }</span>
<a href="#l53.123"></a><span id="l53.123">             } else {</span>
<a href="#l53.124"></a><span id="l53.124">                 WARN(&quot;Item '&quot; + this.mBaseItem.title + &quot;'&quot; +</span>
<a href="#l53.125"></a><span id="l53.125">                      (this.mBaseItem.calendar ? &quot; (&quot; + this.mBaseItem.calendar.name + &quot;)&quot; : &quot;&quot;) +</span>
<a href="#l53.126"></a><span id="l53.126">                      &quot; has an infinite negative rule (EXRULE)&quot;);</span>
<a href="#l53.127"></a><span id="l53.127">             }</span>
<a href="#l53.128"></a><span id="l53.128">         }</span>
<a href="#l53.129"></a><span id="l53.129" class="difflineat">@@ -376,17 +378,18 @@ calRecurrenceInfo.prototype = {</span>
<a href="#l53.130"></a><span id="l53.130"> </span>
<a href="#l53.131"></a><span id="l53.131">         // Since we need to compare occurrences by date, save the rid found</span>
<a href="#l53.132"></a><span id="l53.132">         // above also as a date. This works out because above we skipped</span>
<a href="#l53.133"></a><span id="l53.133">         // exceptions.</span>
<a href="#l53.134"></a><span id="l53.134">         var minOccDate = minOccRid;</span>
<a href="#l53.135"></a><span id="l53.135"> </span>
<a href="#l53.136"></a><span id="l53.136">         // Scan exceptions for any dates earlier than the above found</span>
<a href="#l53.137"></a><span id="l53.137">         // minOccDate, but still after aTime.</span>
<a href="#l53.138"></a><span id="l53.138" class="difflineminus">-        for each (var exc in this.mExceptionMap) {</span>
<a href="#l53.139"></a><span id="l53.139" class="difflineplus">+        for (var ex in this.mExceptionMap) {</span>
<a href="#l53.140"></a><span id="l53.140" class="difflineplus">+            let exc = this.mExceptionMap[ex];</span>
<a href="#l53.141"></a><span id="l53.141">             var start = exc.recurrenceStartDate;</span>
<a href="#l53.142"></a><span id="l53.142">             if (start.compare(aTime) &gt; 0 &amp;&amp;</span>
<a href="#l53.143"></a><span id="l53.143">                 (!minOccDate || start.compare(minOccDate) &lt;= 0)) {</span>
<a href="#l53.144"></a><span id="l53.144">                 // This exception is earlier, save its rid (for getting the</span>
<a href="#l53.145"></a><span id="l53.145">                 // occurrence later on) and its date (for comparing to other</span>
<a href="#l53.146"></a><span id="l53.146">                 // exceptions).</span>
<a href="#l53.147"></a><span id="l53.147">                 minOccRid = exc.recurrenceId;</span>
<a href="#l53.148"></a><span id="l53.148">                 minOccDate = start;</span>
<a href="#l53.149"></a><span id="l53.149" class="difflineat">@@ -483,17 +486,17 @@ calRecurrenceInfo.prototype = {</span>
<a href="#l53.150"></a><span id="l53.150">         var maxCount;</span>
<a href="#l53.151"></a><span id="l53.151">         if (rangeStart &amp;&amp; rangeEnd) {</span>
<a href="#l53.152"></a><span id="l53.152">             maxCount = 0;</span>
<a href="#l53.153"></a><span id="l53.153">         } else {</span>
<a href="#l53.154"></a><span id="l53.154">             maxCount = aMaxCount;</span>
<a href="#l53.155"></a><span id="l53.155">         }</span>
<a href="#l53.156"></a><span id="l53.156"> </span>
<a href="#l53.157"></a><span id="l53.157">         // Apply positive rules</span>
<a href="#l53.158"></a><span id="l53.158" class="difflineminus">-        for each (let ritem in this.mPositiveRules) {</span>
<a href="#l53.159"></a><span id="l53.159" class="difflineplus">+        for (let ritem of this.mPositiveRules) {</span>
<a href="#l53.160"></a><span id="l53.160">             var cur_dates = ritem.getOccurrences(startDate,</span>
<a href="#l53.161"></a><span id="l53.161">                                                  searchStart,</span>
<a href="#l53.162"></a><span id="l53.162">                                                  rangeEnd,</span>
<a href="#l53.163"></a><span id="l53.163">                                                  maxCount, {});</span>
<a href="#l53.164"></a><span id="l53.164">             if (cur_dates.length == 0) {</span>
<a href="#l53.165"></a><span id="l53.165">                 continue;</span>
<a href="#l53.166"></a><span id="l53.166">             }</span>
<a href="#l53.167"></a><span id="l53.167"> </span>
<a href="#l53.168"></a><span id="l53.168" class="difflineat">@@ -524,30 +527,30 @@ calRecurrenceInfo.prototype = {</span>
<a href="#l53.169"></a><span id="l53.169">                 // TODO if cur_dates[] is also sorted, then this binary</span>
<a href="#l53.170"></a><span id="l53.170">                 // search could be optimized further</span>
<a href="#l53.171"></a><span id="l53.171">                 binaryInsert(dates, { id: date, rstart: date }, ridDateSortComptor);</span>
<a href="#l53.172"></a><span id="l53.172">                 occurrenceMap[dateKey] = true;</span>
<a href="#l53.173"></a><span id="l53.173">             }</span>
<a href="#l53.174"></a><span id="l53.174">         }</span>
<a href="#l53.175"></a><span id="l53.175"> </span>
<a href="#l53.176"></a><span id="l53.176">         // Apply negative rules</span>
<a href="#l53.177"></a><span id="l53.177" class="difflineminus">-        for each (let ritem in this.mNegativeRules) {</span>
<a href="#l53.178"></a><span id="l53.178" class="difflineplus">+        for (let ritem of this.mNegativeRules) {</span>
<a href="#l53.179"></a><span id="l53.179">             var cur_dates = ritem.getOccurrences(startDate,</span>
<a href="#l53.180"></a><span id="l53.180">                                                  searchStart,</span>
<a href="#l53.181"></a><span id="l53.181">                                                  rangeEnd,</span>
<a href="#l53.182"></a><span id="l53.182">                                                  maxCount, {});</span>
<a href="#l53.183"></a><span id="l53.183">             if (cur_dates.length == 0) {</span>
<a href="#l53.184"></a><span id="l53.184">                 continue;</span>
<a href="#l53.185"></a><span id="l53.185">             }</span>
<a href="#l53.186"></a><span id="l53.186"> </span>
<a href="#l53.187"></a><span id="l53.187">             // XXX: i'm pretty sure negative dates can't really have exceptions</span>
<a href="#l53.188"></a><span id="l53.188">             // (like, you can't make a date &quot;real&quot; by defining an RECURRENCE-ID which</span>
<a href="#l53.189"></a><span id="l53.189">             // is an EXDATE, and then giving it a real DTSTART) -- so we don't</span>
<a href="#l53.190"></a><span id="l53.190">             // check exceptions here</span>
<a href="#l53.191"></a><span id="l53.191" class="difflineminus">-            for each (let dateToRemove in cur_dates) {</span>
<a href="#l53.192"></a><span id="l53.192" class="difflineplus">+            for (let dateToRemove of cur_dates) {</span>
<a href="#l53.193"></a><span id="l53.193">                 let dateToRemoveKey = getRidKey(dateToRemove);</span>
<a href="#l53.194"></a><span id="l53.194">                 if (dateToRemove.isDate) {</span>
<a href="#l53.195"></a><span id="l53.195">                     // As decided in bug 734245, an EXDATE of type DATE shall also match a DTSTART of type DATE-TIME</span>
<a href="#l53.196"></a><span id="l53.196">                     let toRemove = [];</span>
<a href="#l53.197"></a><span id="l53.197">                     for (let occurenceKey in occurrenceMap) {</span>
<a href="#l53.198"></a><span id="l53.198">                         if (occurrenceMap[occurenceKey] &amp;&amp; occurenceKey.substring(0,8) == dateToRemoveKey) {</span>
<a href="#l53.199"></a><span id="l53.199">                             dates = dates.filter(function (d) { return d.id.compare(dateToRemove) != 0; });</span>
<a href="#l53.200"></a><span id="l53.200">                             toRemove.push(occurenceKey)</span>
<a href="#l53.201"></a><span id="l53.201" class="difflineat">@@ -726,17 +729,18 @@ calRecurrenceInfo.prototype = {</span>
<a href="#l53.202"></a><span id="l53.202">         this.ensureBaseItem();</span>
<a href="#l53.203"></a><span id="l53.203">         delete this.mExceptionMap[getRidKey(aRecurrenceId)];</span>
<a href="#l53.204"></a><span id="l53.204">     },</span>
<a href="#l53.205"></a><span id="l53.205"> </span>
<a href="#l53.206"></a><span id="l53.206">     getExceptionIds: function cRI_getExceptionIds(aCount) {</span>
<a href="#l53.207"></a><span id="l53.207">         this.ensureBaseItem();</span>
<a href="#l53.208"></a><span id="l53.208"> </span>
<a href="#l53.209"></a><span id="l53.209">         var ids = [];</span>
<a href="#l53.210"></a><span id="l53.210" class="difflineminus">-        for each (var item in this.mExceptionMap) {</span>
<a href="#l53.211"></a><span id="l53.211" class="difflineplus">+        for (let ex in this.mExceptionMap) {</span>
<a href="#l53.212"></a><span id="l53.212" class="difflineplus">+            let item = this.mExceptionMap[ex];</span>
<a href="#l53.213"></a><span id="l53.213">             ids.push(item.recurrenceId);</span>
<a href="#l53.214"></a><span id="l53.214">         }</span>
<a href="#l53.215"></a><span id="l53.215"> </span>
<a href="#l53.216"></a><span id="l53.216">         aCount.value = ids.length;</span>
<a href="#l53.217"></a><span id="l53.217">         return ids;</span>
<a href="#l53.218"></a><span id="l53.218">     },</span>
<a href="#l53.219"></a><span id="l53.219"> </span>
<a href="#l53.220"></a><span id="l53.220">     // changing the startdate of an item needs to take exceptions into account.</span>
<a href="#l53.221"></a><span id="l53.221" class="difflineat">@@ -755,17 +759,17 @@ calRecurrenceInfo.prototype = {</span>
<a href="#l53.222"></a><span id="l53.222">         // convert both dates to UTC since subtractDate is not timezone aware.</span>
<a href="#l53.223"></a><span id="l53.223">         let timeDiff = aNewStartTime.getInTimezone(UTC()).subtractDate(aOldStartTime.getInTimezone(UTC()));</span>
<a href="#l53.224"></a><span id="l53.224"> </span>
<a href="#l53.225"></a><span id="l53.225">         let rdates = {};</span>
<a href="#l53.226"></a><span id="l53.226"> </span>
<a href="#l53.227"></a><span id="l53.227">         // take RDATE's and EXDATE's into account.</span>
<a href="#l53.228"></a><span id="l53.228">         const kCalIRecurrenceDate = Components.interfaces.calIRecurrenceDate;</span>
<a href="#l53.229"></a><span id="l53.229">         let ritems = this.getRecurrenceItems({});</span>
<a href="#l53.230"></a><span id="l53.230" class="difflineminus">-        for each (let ritem in ritems) {</span>
<a href="#l53.231"></a><span id="l53.231" class="difflineplus">+        for (let ritem of ritems) {</span>
<a href="#l53.232"></a><span id="l53.232">             let rDateInstance = cal.wrapInstance(ritem, kCalIRecurrenceDate);</span>
<a href="#l53.233"></a><span id="l53.233">             let rRuleInstance = cal.wrapInstance(ritem, Components.interfaces.calIRecurrenceRule);</span>
<a href="#l53.234"></a><span id="l53.234">             if (rDateInstance) {</span>
<a href="#l53.235"></a><span id="l53.235">                 ritem = rDateInstance;</span>
<a href="#l53.236"></a><span id="l53.236">                 let date = ritem.date;</span>
<a href="#l53.237"></a><span id="l53.237">                 date.addDuration(timeDiff);</span>
<a href="#l53.238"></a><span id="l53.238">                 if (!ritem.isNegative) {</span>
<a href="#l53.239"></a><span id="l53.239">                     rdates[getRidKey(date)] = date;</span>
<a href="#l53.240"></a><span id="l53.240" class="difflineat">@@ -780,36 +784,37 @@ calRecurrenceInfo.prototype = {</span>
<a href="#l53.241"></a><span id="l53.241">                         ritem.untilDate = untilDate;</span>
<a href="#l53.242"></a><span id="l53.242">                     }</span>
<a href="#l53.243"></a><span id="l53.243">                 }</span>
<a href="#l53.244"></a><span id="l53.244">             }</span>
<a href="#l53.245"></a><span id="l53.245">         }</span>
<a href="#l53.246"></a><span id="l53.246"> </span>
<a href="#l53.247"></a><span id="l53.247">         let startTimezone = aNewStartTime.timezone;</span>
<a href="#l53.248"></a><span id="l53.248">         let modifiedExceptions = [];</span>
<a href="#l53.249"></a><span id="l53.249" class="difflineminus">-        for each (let exid in this.getExceptionIds({})) {</span>
<a href="#l53.250"></a><span id="l53.250" class="difflineplus">+        for (let exid of this.getExceptionIds({})) {</span>
<a href="#l53.251"></a><span id="l53.251">             let ex = this.getExceptionFor(exid);</span>
<a href="#l53.252"></a><span id="l53.252">             if (ex) {</span>
<a href="#l53.253"></a><span id="l53.253">                 ex = ex.clone();</span>
<a href="#l53.254"></a><span id="l53.254">                 // track RECURRENCE-IDs in DTSTART's or RDATE's timezone,</span>
<a href="#l53.255"></a><span id="l53.255">                 // otherwise those won't match any longer w.r.t DST:</span>
<a href="#l53.256"></a><span id="l53.256">                 let rid = ex.recurrenceId;</span>
<a href="#l53.257"></a><span id="l53.257">                 let rdate = rdates[getRidKey(rid)];</span>
<a href="#l53.258"></a><span id="l53.258">                 rid = rid.getInTimezone(rdate ? rdate.timezone : startTimezone);</span>
<a href="#l53.259"></a><span id="l53.259">                 rid.addDuration(timeDiff);</span>
<a href="#l53.260"></a><span id="l53.260">                 ex.recurrenceId = rid;</span>
<a href="#l53.261"></a><span id="l53.261">                 cal.shiftItem(ex, timeDiff);</span>
<a href="#l53.262"></a><span id="l53.262">                 modifiedExceptions.push(ex);</span>
<a href="#l53.263"></a><span id="l53.263">                 this.removeExceptionFor(exid);</span>
<a href="#l53.264"></a><span id="l53.264">             }</span>
<a href="#l53.265"></a><span id="l53.265">         }</span>
<a href="#l53.266"></a><span id="l53.266" class="difflineminus">-        for each (let modifiedEx in modifiedExceptions) {</span>
<a href="#l53.267"></a><span id="l53.267" class="difflineplus">+        for (let modifiedEx of modifiedExceptions) {</span>
<a href="#l53.268"></a><span id="l53.268">             this.modifyException(modifiedEx, true);</span>
<a href="#l53.269"></a><span id="l53.269">         }</span>
<a href="#l53.270"></a><span id="l53.270">     },</span>
<a href="#l53.271"></a><span id="l53.271"> </span>
<a href="#l53.272"></a><span id="l53.272">     onIdChange: function cRI_onIdChange(aNewId) {</span>
<a href="#l53.273"></a><span id="l53.273">         // patch all overridden items' id:</span>
<a href="#l53.274"></a><span id="l53.274" class="difflineminus">-        for each (let item in this.mExceptionMap) {</span>
<a href="#l53.275"></a><span id="l53.275" class="difflineplus">+        for (let ex in this.mExceptionMap) {</span>
<a href="#l53.276"></a><span id="l53.276" class="difflineplus">+            let item = this.mExceptionMap[ex];</span>
<a href="#l53.277"></a><span id="l53.277">             item.id = aNewId;</span>
<a href="#l53.278"></a><span id="l53.278">         }</span>
<a href="#l53.279"></a><span id="l53.279">     }</span>
<a href="#l53.280"></a><span id="l53.280"> };</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l54.1"></a><span id="l54.1" class="difflineminus">--- a/calendar/base/src/calRelation.js</span>
<a href="#l54.2"></a><span id="l54.2" class="difflineplus">+++ b/calendar/base/src/calRelation.js</span>
<a href="#l54.3"></a><span id="l54.3" class="difflineat">@@ -55,17 +55,17 @@ calRelation.prototype = {</span>
<a href="#l54.4"></a><span id="l54.4">         if (this.mId) {</span>
<a href="#l54.5"></a><span id="l54.5">             icalatt.value = this.mId;</span>
<a href="#l54.6"></a><span id="l54.6">         }</span>
<a href="#l54.7"></a><span id="l54.7"> </span>
<a href="#l54.8"></a><span id="l54.8">         if (this.mType) {</span>
<a href="#l54.9"></a><span id="l54.9">             icalatt.setParameter(&quot;RELTYPE&quot;, this.mType);</span>
<a href="#l54.10"></a><span id="l54.10">         }</span>
<a href="#l54.11"></a><span id="l54.11"> </span>
<a href="#l54.12"></a><span id="l54.12" class="difflineminus">-        for each (let [key, value] in this.mProperties) {</span>
<a href="#l54.13"></a><span id="l54.13" class="difflineplus">+        for (let [key, value] of this.mProperties) {</span>
<a href="#l54.14"></a><span id="l54.14">             try {</span>
<a href="#l54.15"></a><span id="l54.15">                 icalatt.setParameter(key, value);</span>
<a href="#l54.16"></a><span id="l54.16">             } catch (e if e.result == Components.results.NS_ERROR_ILLEGAL_VALUE) {</span>
<a href="#l54.17"></a><span id="l54.17">                 // Illegal values should be ignored, but we could log them if</span>
<a href="#l54.18"></a><span id="l54.18">                 // the user has enabled logging.</span>
<a href="#l54.19"></a><span id="l54.19">                 cal.LOG(&quot;Warning: Invalid relation property value &quot; + key + &quot;=&quot; + value);</span>
<a href="#l54.20"></a><span id="l54.20">             }</span>
<a href="#l54.21"></a><span id="l54.21">         }</span>
<a href="#l54.22"></a><span id="l54.22" class="difflineat">@@ -75,17 +75,17 @@ calRelation.prototype = {</span>
<a href="#l54.23"></a><span id="l54.23">     set icalProperty(attProp) {</span>
<a href="#l54.24"></a><span id="l54.24">         // Reset the property bag for the parameters, it will be re-initialized</span>
<a href="#l54.25"></a><span id="l54.25">         // from the ical property.</span>
<a href="#l54.26"></a><span id="l54.26">         this.mProperties = new calPropertyBag();</span>
<a href="#l54.27"></a><span id="l54.27"> </span>
<a href="#l54.28"></a><span id="l54.28">         if (attProp.value) {</span>
<a href="#l54.29"></a><span id="l54.29">             this.mId = attProp.value;</span>
<a href="#l54.30"></a><span id="l54.30">         }</span>
<a href="#l54.31"></a><span id="l54.31" class="difflineminus">-        for each (let [name, value] in cal.ical.paramIterator(attProp)) {</span>
<a href="#l54.32"></a><span id="l54.32" class="difflineplus">+        for (let [name, value] of cal.ical.paramIterator(attProp)) {</span>
<a href="#l54.33"></a><span id="l54.33">             if (name == &quot;RELTYPE&quot;) {</span>
<a href="#l54.34"></a><span id="l54.34">                 this.mType = value;</span>
<a href="#l54.35"></a><span id="l54.35">                 continue;</span>
<a href="#l54.36"></a><span id="l54.36">             }</span>
<a href="#l54.37"></a><span id="l54.37"> </span>
<a href="#l54.38"></a><span id="l54.38">             this.setParameter(name, value);</span>
<a href="#l54.39"></a><span id="l54.39">         }</span>
<a href="#l54.40"></a><span id="l54.40">     },</span>
<a href="#l54.41"></a><span id="l54.41" class="difflineat">@@ -114,14 +114,14 @@ calRelation.prototype = {</span>
<a href="#l54.42"></a><span id="l54.42">     deleteParameter: function (aName) {</span>
<a href="#l54.43"></a><span id="l54.43">         return this.mProperties.deleteProperty(aName);</span>
<a href="#l54.44"></a><span id="l54.44">     },</span>
<a href="#l54.45"></a><span id="l54.45"> </span>
<a href="#l54.46"></a><span id="l54.46">     clone: function cR_clone() {</span>
<a href="#l54.47"></a><span id="l54.47">         let newRelation = new calRelation();</span>
<a href="#l54.48"></a><span id="l54.48">         newRelation.mId = this.mId;</span>
<a href="#l54.49"></a><span id="l54.49">         newRelation.mType = this.mType;</span>
<a href="#l54.50"></a><span id="l54.50" class="difflineminus">-        for each (let [name, value] in this.mProperties) {</span>
<a href="#l54.51"></a><span id="l54.51" class="difflineplus">+        for (let [name, value] of this.mProperties) {</span>
<a href="#l54.52"></a><span id="l54.52">             newRelation.mProperties.setProperty(name, value);</span>
<a href="#l54.53"></a><span id="l54.53">         }</span>
<a href="#l54.54"></a><span id="l54.54">         return newRelation;</span>
<a href="#l54.55"></a><span id="l54.55">     }</span>
<a href="#l54.56"></a><span id="l54.56"> };</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l55.1"></a><span id="l55.1" class="difflineminus">--- a/calendar/base/src/calTimezoneService.js</span>
<a href="#l55.2"></a><span id="l55.2" class="difflineplus">+++ b/calendar/base/src/calTimezoneService.js</span>
<a href="#l55.3"></a><span id="l55.3" class="difflineat">@@ -691,17 +691,17 @@ function guessSystemTimezone() {</span>
<a href="#l55.4"></a><span id="l55.4"> </span>
<a href="#l55.5"></a><span id="l55.5">     // Second, give priority to &quot;likelyTimezone&quot;s if provided by locale.</span>
<a href="#l55.6"></a><span id="l55.6">     try {</span>
<a href="#l55.7"></a><span id="l55.7">         // The likelyTimezone property is a comma-separated list of</span>
<a href="#l55.8"></a><span id="l55.8">         // ZoneInfo timezone ids.</span>
<a href="#l55.9"></a><span id="l55.9">         const bundleTZString =</span>
<a href="#l55.10"></a><span id="l55.10">             calProperties.GetStringFromName(&quot;likelyTimezone&quot;);</span>
<a href="#l55.11"></a><span id="l55.11">         const bundleTZIds = bundleTZString.split(/\s*,\s*/);</span>
<a href="#l55.12"></a><span id="l55.12" class="difflineminus">-        for each (var bareTZId in bundleTZIds) {</span>
<a href="#l55.13"></a><span id="l55.13" class="difflineplus">+        for (var bareTZId of bundleTZIds) {</span>
<a href="#l55.14"></a><span id="l55.14">             var tzId = bareTZId;</span>
<a href="#l55.15"></a><span id="l55.15">             try {</span>
<a href="#l55.16"></a><span id="l55.16">                 var score = checkTZ(tzId);</span>
<a href="#l55.17"></a><span id="l55.17"> </span>
<a href="#l55.18"></a><span id="l55.18">                 switch (score) {</span>
<a href="#l55.19"></a><span id="l55.19">                 case 0:</span>
<a href="#l55.20"></a><span id="l55.20">                     break;</span>
<a href="#l55.21"></a><span id="l55.21">                 case 1: case 2:</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l56.1"></a><span id="l56.1" class="difflineminus">--- a/calendar/base/src/calUtils.js</span>
<a href="#l56.2"></a><span id="l56.2" class="difflineplus">+++ b/calendar/base/src/calUtils.js</span>
<a href="#l56.3"></a><span id="l56.3" class="difflineat">@@ -300,17 +300,17 @@ function attendeeMatchesAddresses(anAtte</span>
<a href="#l56.4"></a><span id="l56.4">         // Try getting the email through the EMAIL property.</span>
<a href="#l56.5"></a><span id="l56.5">         let emailProp = anAttendee.getProperty(&quot;EMAIL&quot;);</span>
<a href="#l56.6"></a><span id="l56.6">         if (emailProp) {</span>
<a href="#l56.7"></a><span id="l56.7">             attId = emailProp;</span>
<a href="#l56.8"></a><span id="l56.8">         }</span>
<a href="#l56.9"></a><span id="l56.9">     }</span>
<a href="#l56.10"></a><span id="l56.10"> </span>
<a href="#l56.11"></a><span id="l56.11">     attId = attId.toLowerCase().replace(/^mailto:/, &quot;&quot;);</span>
<a href="#l56.12"></a><span id="l56.12" class="difflineminus">-    for each (let address in addresses) {</span>
<a href="#l56.13"></a><span id="l56.13" class="difflineplus">+    for (let address of addresses) {</span>
<a href="#l56.14"></a><span id="l56.14">         if (attId == address.toLowerCase().replace(/^mailto:/, &quot;&quot;)) {</span>
<a href="#l56.15"></a><span id="l56.15">             return true;</span>
<a href="#l56.16"></a><span id="l56.16">         }</span>
<a href="#l56.17"></a><span id="l56.17">     }</span>
<a href="#l56.18"></a><span id="l56.18"> </span>
<a href="#l56.19"></a><span id="l56.19">     return false;</span>
<a href="#l56.20"></a><span id="l56.20"> }</span>
<a href="#l56.21"></a><span id="l56.21"> </span>
<a href="#l56.22"></a><span id="l56.22" class="difflineat">@@ -560,17 +560,17 @@ function getPrefCategoriesArray() {</span>
<a href="#l56.23"></a><span id="l56.23">  */</span>
<a href="#l56.24"></a><span id="l56.24"> function setupDefaultCategories() {</span>
<a href="#l56.25"></a><span id="l56.25">     // First, set up the category names</span>
<a href="#l56.26"></a><span id="l56.26">     let categories = calGetString(&quot;categories&quot;, &quot;categories2&quot;);</span>
<a href="#l56.27"></a><span id="l56.27">     Preferences.set(&quot;calendar.categories.names&quot;, categories);</span>
<a href="#l56.28"></a><span id="l56.28"> </span>
<a href="#l56.29"></a><span id="l56.29">     // Now, initialize the category default colors</span>
<a href="#l56.30"></a><span id="l56.30">     let categoryArray = categoriesStringToArray(categories);</span>
<a href="#l56.31"></a><span id="l56.31" class="difflineminus">-    for each (let category in categoryArray) {</span>
<a href="#l56.32"></a><span id="l56.32" class="difflineplus">+    for (let category of categoryArray) {</span>
<a href="#l56.33"></a><span id="l56.33">         let prefName = formatStringForCSSRule(category);</span>
<a href="#l56.34"></a><span id="l56.34">         Preferences.set(&quot;calendar.category.color.&quot; + prefName,</span>
<a href="#l56.35"></a><span id="l56.35">                         hashColor(category));</span>
<a href="#l56.36"></a><span id="l56.36">     }</span>
<a href="#l56.37"></a><span id="l56.37"> </span>
<a href="#l56.38"></a><span id="l56.38">     // Return the list of categories for further processing</span>
<a href="#l56.39"></a><span id="l56.39">     return categories;</span>
<a href="#l56.40"></a><span id="l56.40"> }</span>
<a href="#l56.41"></a><span id="l56.41" class="difflineat">@@ -799,19 +799,21 @@ function doQueryInterface(aSelf, aProto,</span>
<a href="#l56.42"></a><span id="l56.42">         if (aIID.equals(Components.interfaces.nsIClassInfo)) {</span>
<a href="#l56.43"></a><span id="l56.43">             return aClassInfo;</span>
<a href="#l56.44"></a><span id="l56.44">         }</span>
<a href="#l56.45"></a><span id="l56.45">         if (!aList) {</span>
<a href="#l56.46"></a><span id="l56.46">             aList = aClassInfo.getInterfaces({});</span>
<a href="#l56.47"></a><span id="l56.47">         }</span>
<a href="#l56.48"></a><span id="l56.48">     }</span>
<a href="#l56.49"></a><span id="l56.49"> </span>
<a href="#l56.50"></a><span id="l56.50" class="difflineminus">-    for each (var iid in aList) {</span>
<a href="#l56.51"></a><span id="l56.51" class="difflineminus">-        if (aIID.equals(iid)) {</span>
<a href="#l56.52"></a><span id="l56.52" class="difflineminus">-            return aSelf;</span>
<a href="#l56.53"></a><span id="l56.53" class="difflineplus">+    if (aList) {</span>
<a href="#l56.54"></a><span id="l56.54" class="difflineplus">+        for (var iid of aList) {</span>
<a href="#l56.55"></a><span id="l56.55" class="difflineplus">+            if (aIID.equals(iid)) {</span>
<a href="#l56.56"></a><span id="l56.56" class="difflineplus">+                return aSelf;</span>
<a href="#l56.57"></a><span id="l56.57" class="difflineplus">+            }</span>
<a href="#l56.58"></a><span id="l56.58">         }</span>
<a href="#l56.59"></a><span id="l56.59">     }</span>
<a href="#l56.60"></a><span id="l56.60"> </span>
<a href="#l56.61"></a><span id="l56.61">     if (aIID.equals(Components.interfaces.nsISupports)) {</span>
<a href="#l56.62"></a><span id="l56.62">         return aSelf;</span>
<a href="#l56.63"></a><span id="l56.63">     }</span>
<a href="#l56.64"></a><span id="l56.64"> </span>
<a href="#l56.65"></a><span id="l56.65">     if (aProto) {</span>
<a href="#l56.66"></a><span id="l56.66" class="difflineat">@@ -1592,18 +1594,20 @@ calPropertyBag.prototype = {</span>
<a href="#l56.67"></a><span id="l56.67">         aOutValues.value = values;</span>
<a href="#l56.68"></a><span id="l56.68">     },</span>
<a href="#l56.69"></a><span id="l56.69">     deleteProperty: function cpb_deleteProperty(aName) {</span>
<a href="#l56.70"></a><span id="l56.70">         delete this.mData[aName];</span>
<a href="#l56.71"></a><span id="l56.71">     },</span>
<a href="#l56.72"></a><span id="l56.72">     get enumerator() {</span>
<a href="#l56.73"></a><span id="l56.73">         return new calPropertyBagEnumerator(this);</span>
<a href="#l56.74"></a><span id="l56.74">     },</span>
<a href="#l56.75"></a><span id="l56.75" class="difflineminus">-    __iterator__: function cpb_iterator(aWantKeys) {</span>
<a href="#l56.76"></a><span id="l56.76" class="difflineminus">-        return Iterator(this.mData, aWantKeys);</span>
<a href="#l56.77"></a><span id="l56.77" class="difflineplus">+    [Symbol.iterator]: function* cpb_iterator() {</span>
<a href="#l56.78"></a><span id="l56.78" class="difflineplus">+        for (let name of Object.keys(this.mData)) {</span>
<a href="#l56.79"></a><span id="l56.79" class="difflineplus">+            yield [name, this.mData[name]];</span>
<a href="#l56.80"></a><span id="l56.80" class="difflineplus">+        }</span>
<a href="#l56.81"></a><span id="l56.81">     }</span>
<a href="#l56.82"></a><span id="l56.82"> };</span>
<a href="#l56.83"></a><span id="l56.83"> // implementation part of calPropertyBag</span>
<a href="#l56.84"></a><span id="l56.84"> function calPropertyBagEnumerator(bag) {</span>
<a href="#l56.85"></a><span id="l56.85">     this.mIndex = 0;</span>
<a href="#l56.86"></a><span id="l56.86">     this.mBag = bag;</span>
<a href="#l56.87"></a><span id="l56.87">     this.mKeys = [ key for (key in bag.mData) ];</span>
<a href="#l56.88"></a><span id="l56.88"> }</span>
<a href="#l56.89"></a><span id="l56.89" class="difflineat">@@ -1684,17 +1688,17 @@ function compareItemContent(aFirstItem, </span>
<a href="#l56.90"></a><span id="l56.90">     let ignoreParams = aIgnoreParams ||</span>
<a href="#l56.91"></a><span id="l56.91">         { &quot;ATTENDEE&quot;: [&quot;CN&quot;], &quot;ORGANIZER&quot;: [&quot;CN&quot;] };</span>
<a href="#l56.92"></a><span id="l56.92">     for (let x in ignoreParams) {</span>
<a href="#l56.93"></a><span id="l56.93">         ignoreParams[x] = arr2hash(ignoreParams[x]);</span>
<a href="#l56.94"></a><span id="l56.94">     }</span>
<a href="#l56.95"></a><span id="l56.95"> </span>
<a href="#l56.96"></a><span id="l56.96">     function arr2hash(arr) {</span>
<a href="#l56.97"></a><span id="l56.97">         let hash = {};</span>
<a href="#l56.98"></a><span id="l56.98" class="difflineminus">-        for each (let x in arr) {</span>
<a href="#l56.99"></a><span id="l56.99" class="difflineplus">+        for (let x of arr) {</span>
<a href="#l56.100"></a><span id="l56.100">             hash[x] = true;</span>
<a href="#l56.101"></a><span id="l56.101">         }</span>
<a href="#l56.102"></a><span id="l56.102">         return hash;</span>
<a href="#l56.103"></a><span id="l56.103">     }</span>
<a href="#l56.104"></a><span id="l56.104"> </span>
<a href="#l56.105"></a><span id="l56.105">     // This doesn't have to be super correct rfc5545, it just needs to be</span>
<a href="#l56.106"></a><span id="l56.106">     // in the same order</span>
<a href="#l56.107"></a><span id="l56.107">     function normalizeComponent(comp) {</span>
<a href="#l56.108"></a><span id="l56.108" class="difflineat">@@ -1708,22 +1712,21 @@ function compareItemContent(aFirstItem, </span>
<a href="#l56.109"></a><span id="l56.109">             normalizeComponent(subcomp)</span>
<a href="#l56.110"></a><span id="l56.110">             for (subcomp in cal.ical.subcomponentIterator(comp))</span>
<a href="#l56.111"></a><span id="l56.111">         ].sort();</span>
<a href="#l56.112"></a><span id="l56.112"> </span>
<a href="#l56.113"></a><span id="l56.113">         return comp.componentType + props.join(&quot;\r\n&quot;) + comps.join(&quot;\r\n&quot;);</span>
<a href="#l56.114"></a><span id="l56.114">     }</span>
<a href="#l56.115"></a><span id="l56.115"> </span>
<a href="#l56.116"></a><span id="l56.116">     function normalizeProperty(prop) {</span>
<a href="#l56.117"></a><span id="l56.117" class="difflineminus">-        let params = [</span>
<a href="#l56.118"></a><span id="l56.118" class="difflineminus">-            k + &quot;=&quot; + v</span>
<a href="#l56.119"></a><span id="l56.119" class="difflineminus">-            for each ([k,v] in cal.ical.paramIterator(prop))</span>
<a href="#l56.120"></a><span id="l56.120" class="difflineminus">-            if (!(prop.propertyName in ignoreParams) ||</span>
<a href="#l56.121"></a><span id="l56.121" class="difflineminus">-            !(k in ignoreParams[prop.propertyName]))</span>
<a href="#l56.122"></a><span id="l56.122" class="difflineminus">-        ].sort();</span>
<a href="#l56.123"></a><span id="l56.123" class="difflineplus">+        let params = [...cal.ical.paramIterator(prop)].</span>
<a href="#l56.124"></a><span id="l56.124" class="difflineplus">+            filter(([k, v]) =&gt; !(prop.propertyName in ignoreParams) ||</span>
<a href="#l56.125"></a><span id="l56.125" class="difflineplus">+                   !(k in ignoreParams[prop.propertyName])).</span>
<a href="#l56.126"></a><span id="l56.126" class="difflineplus">+            map(([k, v]) =&gt; k + &quot;=&quot; + v).</span>
<a href="#l56.127"></a><span id="l56.127" class="difflineplus">+            sort();</span>
<a href="#l56.128"></a><span id="l56.128"> </span>
<a href="#l56.129"></a><span id="l56.129">         return prop.propertyName + &quot;;&quot; +</span>
<a href="#l56.130"></a><span id="l56.130">                params.join(&quot;;&quot;) + &quot;:&quot; +</span>
<a href="#l56.131"></a><span id="l56.131">                prop.valueAsIcalString;</span>
<a href="#l56.132"></a><span id="l56.132">     }</span>
<a href="#l56.133"></a><span id="l56.133"> </span>
<a href="#l56.134"></a><span id="l56.134">     return normalizeComponent(aFirstItem.icalComponent) ==</span>
<a href="#l56.135"></a><span id="l56.135">            normalizeComponent(aSecondItem.icalComponent);</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l57.1"></a><span id="l57.1" class="difflineminus">--- a/calendar/import-export/calHtmlExport.js</span>
<a href="#l57.2"></a><span id="l57.2" class="difflineplus">+++ b/calendar/import-export/calHtmlExport.js</span>
<a href="#l57.3"></a><span id="l57.3" class="difflineat">@@ -52,17 +52,17 @@ calHtmlExporter.prototype = {</span>
<a href="#l57.4"></a><span id="l57.4">             }</span>
<a href="#l57.5"></a><span id="l57.5">             let start_b = b[cal.calGetStartDateProp(b)];</span>
<a href="#l57.6"></a><span id="l57.6">             if (!start_b) {</span>
<a href="#l57.7"></a><span id="l57.7">                 return 1;</span>
<a href="#l57.8"></a><span id="l57.8">             }</span>
<a href="#l57.9"></a><span id="l57.9">             return start_a.compare(start_b);</span>
<a href="#l57.10"></a><span id="l57.10">         });</span>
<a href="#l57.11"></a><span id="l57.11"> </span>
<a href="#l57.12"></a><span id="l57.12" class="difflineminus">-        for each (let item in aItems) {</span>
<a href="#l57.13"></a><span id="l57.13" class="difflineplus">+        for (let item of aItems) {</span>
<a href="#l57.14"></a><span id="l57.14">             let itemNode = document.getElementById(&quot;item-template&quot;).cloneNode(true);</span>
<a href="#l57.15"></a><span id="l57.15">             itemNode.removeAttribute(&quot;id&quot;);</span>
<a href="#l57.16"></a><span id="l57.16"> </span>
<a href="#l57.17"></a><span id="l57.17">             let setupTextRow = function(classKey, propValue, prefixKey) {</span>
<a href="#l57.18"></a><span id="l57.18">                 if (propValue) {</span>
<a href="#l57.19"></a><span id="l57.19">                     let prefix = cal.calGetString(&quot;calendar&quot;, prefixKey);</span>
<a href="#l57.20"></a><span id="l57.20">                     itemNode.querySelector(&quot;.&quot; + classKey + &quot;key&quot;).textContent = prefix;</span>
<a href="#l57.21"></a><span id="l57.21">                     itemNode.querySelector(&quot;.&quot; + classKey).textContent = propValue;</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l58.1"></a><span id="l58.1" class="difflineminus">--- a/calendar/import-export/calMonthGridPrinter.js</span>
<a href="#l58.2"></a><span id="l58.2" class="difflineplus">+++ b/calendar/import-export/calMonthGridPrinter.js</span>
<a href="#l58.3"></a><span id="l58.3" class="difflineat">@@ -51,17 +51,17 @@ calMonthPrinter.prototype = {</span>
<a href="#l58.4"></a><span id="l58.4">             for (let current = startDate.clone();</span>
<a href="#l58.5"></a><span id="l58.5">                  weekInfoService.getEndOfWeek(current.endOfMonth).compare(endDate) &lt; 0;</span>
<a href="#l58.6"></a><span id="l58.6">                  current.month += 1)</span>
<a href="#l58.7"></a><span id="l58.7">             {</span>
<a href="#l58.8"></a><span id="l58.8">                 this.setupMonth(document, current, dayTable);</span>
<a href="#l58.9"></a><span id="l58.9">             }</span>
<a href="#l58.10"></a><span id="l58.10">         }</span>
<a href="#l58.11"></a><span id="l58.11"> </span>
<a href="#l58.12"></a><span id="l58.12" class="difflineminus">-        for each (let item in aItems) {</span>
<a href="#l58.13"></a><span id="l58.13" class="difflineplus">+        for (let item of aItems) {</span>
<a href="#l58.14"></a><span id="l58.14">             let itemStartDate = item[cal.calGetStartDateProp(item)] || item[cal.calGetEndDateProp(item)];</span>
<a href="#l58.15"></a><span id="l58.15">             let itemEndDate = item[cal.calGetEndDateProp(item)] || item[cal.calGetStartDateProp(item)];</span>
<a href="#l58.16"></a><span id="l58.16"> </span>
<a href="#l58.17"></a><span id="l58.17">             if (!itemStartDate &amp;&amp; !itemEndDate) {</span>
<a href="#l58.18"></a><span id="l58.18">                 cal.print.addItemToDayboxNodate(document, item);</span>
<a href="#l58.19"></a><span id="l58.19">                 continue;</span>
<a href="#l58.20"></a><span id="l58.20">             }</span>
<a href="#l58.21"></a><span id="l58.21">             itemStartDate = itemStartDate.getInTimezone(defaultTimezone);</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l59.1"></a><span id="l59.1" class="difflineminus">--- a/calendar/import-export/calOutlookCSVImportExport.js</span>
<a href="#l59.2"></a><span id="l59.2" class="difflineplus">+++ b/calendar/import-export/calOutlookCSVImportExport.js</span>
<a href="#l59.3"></a><span id="l59.3" class="difflineat">@@ -459,17 +459,17 @@ calOutlookCSVExporter.prototype = {</span>
<a href="#l59.4"></a><span id="l59.4">         headers.push(localeEn['headPrivate']);</span>
<a href="#l59.5"></a><span id="l59.5">         headers = headers.map(function(v) {</span>
<a href="#l59.6"></a><span id="l59.6">             return '&quot;' + v + '&quot;';</span>
<a href="#l59.7"></a><span id="l59.7">         });</span>
<a href="#l59.8"></a><span id="l59.8">         str = headers.join(',');</span>
<a href="#l59.9"></a><span id="l59.9">         str += exportLineEnding;</span>
<a href="#l59.10"></a><span id="l59.10">         aStream.write(str, str.length);</span>
<a href="#l59.11"></a><span id="l59.11"> </span>
<a href="#l59.12"></a><span id="l59.12" class="difflineminus">-        for each (let item in aItems) {</span>
<a href="#l59.13"></a><span id="l59.13" class="difflineplus">+        for (let item of aItems) {</span>
<a href="#l59.14"></a><span id="l59.14">             if (!cal.isEvent(item)) {</span>
<a href="#l59.15"></a><span id="l59.15">                 // XXX TODO: warn the user (once) that tasks are not supported</span>
<a href="#l59.16"></a><span id="l59.16">                 // (bug 336175)</span>
<a href="#l59.17"></a><span id="l59.17">                 continue;</span>
<a href="#l59.18"></a><span id="l59.18">             }</span>
<a href="#l59.19"></a><span id="l59.19">             let line = [];</span>
<a href="#l59.20"></a><span id="l59.20">             line.push(item.title);</span>
<a href="#l59.21"></a><span id="l59.21">             line.push(dateString(item.startDate));</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l60.1"></a><span id="l60.1" class="difflineminus">--- a/calendar/import-export/calWeekPrinter.js</span>
<a href="#l60.2"></a><span id="l60.2" class="difflineplus">+++ b/calendar/import-export/calWeekPrinter.js</span>
<a href="#l60.3"></a><span id="l60.3" class="difflineat">@@ -44,17 +44,17 @@ calWeekPrinter.prototype = {</span>
<a href="#l60.4"></a><span id="l60.4"> </span>
<a href="#l60.5"></a><span id="l60.5">         // Make sure to create tables from start to end, if passed</span>
<a href="#l60.6"></a><span id="l60.6">         if (aStart &amp;&amp; aEnd) {</span>
<a href="#l60.7"></a><span id="l60.7">             for (let current = weekInfoService.getStartOfWeek(aStart); current.compare(aEnd) &lt; 0; current.day += 7) {</span>
<a href="#l60.8"></a><span id="l60.8">                 this.setupWeek(document, current, dayTable);</span>
<a href="#l60.9"></a><span id="l60.9">             }</span>
<a href="#l60.10"></a><span id="l60.10">         }</span>
<a href="#l60.11"></a><span id="l60.11"> </span>
<a href="#l60.12"></a><span id="l60.12" class="difflineminus">-        for each (let item in aItems) {</span>
<a href="#l60.13"></a><span id="l60.13" class="difflineplus">+        for (let item of aItems) {</span>
<a href="#l60.14"></a><span id="l60.14">             let itemStartDate = item[cal.calGetStartDateProp(item)] || item[cal.calGetEndDateProp(item)];</span>
<a href="#l60.15"></a><span id="l60.15">             let itemEndDate = item[cal.calGetEndDateProp(item)] || item[cal.calGetStartDateProp(item)];</span>
<a href="#l60.16"></a><span id="l60.16"> </span>
<a href="#l60.17"></a><span id="l60.17">             if (!itemStartDate &amp;&amp; !itemEndDate) {</span>
<a href="#l60.18"></a><span id="l60.18">                 cal.print.addItemToDayboxNodate(document, item);</span>
<a href="#l60.19"></a><span id="l60.19">                 continue;</span>
<a href="#l60.20"></a><span id="l60.20">             }</span>
<a href="#l60.21"></a><span id="l60.21">             itemStartDate = itemStartDate.getInTimezone(defaultTimezone);</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l61.1"></a><span id="l61.1" class="difflineminus">--- a/calendar/providers/caldav/calDavCalendar.js</span>
<a href="#l61.2"></a><span id="l61.2" class="difflineplus">+++ b/calendar/providers/caldav/calDavCalendar.js</span>
<a href="#l61.3"></a><span id="l61.3" class="difflineat">@@ -208,26 +208,26 @@ calDavCalendar.prototype = {</span>
<a href="#l61.4"></a><span id="l61.4">     },</span>
<a href="#l61.5"></a><span id="l61.5"> </span>
<a href="#l61.6"></a><span id="l61.6">     set checkedServerInfo(val) {</span>
<a href="#l61.7"></a><span id="l61.7">         return (this.mCheckedServerInfo = val);</span>
<a href="#l61.8"></a><span id="l61.8">     },</span>
<a href="#l61.9"></a><span id="l61.9"> </span>
<a href="#l61.10"></a><span id="l61.10">     saveCalendarProperties: function caldav_saveCalendarProperties() {</span>
<a href="#l61.11"></a><span id="l61.11">         let properties = {};</span>
<a href="#l61.12"></a><span id="l61.12" class="difflineminus">-        for each (let property in this.offlineCachedProperties) {</span>
<a href="#l61.13"></a><span id="l61.13" class="difflineplus">+        for (let property of this.offlineCachedProperties) {</span>
<a href="#l61.14"></a><span id="l61.14">             if (this[property] !== undefined) {</span>
<a href="#l61.15"></a><span id="l61.15">                 properties[property] = this[property];</span>
<a href="#l61.16"></a><span id="l61.16">             }</span>
<a href="#l61.17"></a><span id="l61.17">         }</span>
<a href="#l61.18"></a><span id="l61.18">         this.mOfflineStorage.setMetaData(&quot;calendar-properties&quot;, JSON.stringify(properties));</span>
<a href="#l61.19"></a><span id="l61.19">     },</span>
<a href="#l61.20"></a><span id="l61.20">     restoreCalendarProperties: function caldav_restoreCalendarProperties(data) {</span>
<a href="#l61.21"></a><span id="l61.21">         let properties = JSON.parse(data);</span>
<a href="#l61.22"></a><span id="l61.22" class="difflineminus">-        for each (let property in this.offlineCachedProperties) {</span>
<a href="#l61.23"></a><span id="l61.23" class="difflineplus">+        for (let property of this.offlineCachedProperties) {</span>
<a href="#l61.24"></a><span id="l61.24">             if (properties[property] !== undefined) {</span>
<a href="#l61.25"></a><span id="l61.25">                 this[property] = properties[property];</span>
<a href="#l61.26"></a><span id="l61.26">             }</span>
<a href="#l61.27"></a><span id="l61.27">         }</span>
<a href="#l61.28"></a><span id="l61.28">     },</span>
<a href="#l61.29"></a><span id="l61.29"> </span>
<a href="#l61.30"></a><span id="l61.30">     // in calIGenericOperationListener aListener</span>
<a href="#l61.31"></a><span id="l61.31">     replayChangesOn: function caldav_replayChangesOn(aChangeLogListener) {</span>
<a href="#l61.32"></a><span id="l61.32" class="difflineat">@@ -257,17 +257,17 @@ calDavCalendar.prototype = {</span>
<a href="#l61.33"></a><span id="l61.33">      * changes may not be reflected</span>
<a href="#l61.34"></a><span id="l61.34">      */</span>
<a href="#l61.35"></a><span id="l61.35">     ensureMetaData: function caldav_ensureMetaData() {</span>
<a href="#l61.36"></a><span id="l61.36">         let self = this;</span>
<a href="#l61.37"></a><span id="l61.37">         let refreshNeeded = false;</span>
<a href="#l61.38"></a><span id="l61.38">         let getMetaListener = {</span>
<a href="#l61.39"></a><span id="l61.39">             QueryInterface: XPCOMUtils.generateQI([Components.interfaces.calIOperationListener]),</span>
<a href="#l61.40"></a><span id="l61.40">             onGetResult: function meta_onGetResult(aCalendar, aStatus, aItemType, aDetail, aCount, aItems) {</span>
<a href="#l61.41"></a><span id="l61.41" class="difflineminus">-                for each (let item in aItems) {</span>
<a href="#l61.42"></a><span id="l61.42" class="difflineplus">+                for (let item of aItems) {</span>
<a href="#l61.43"></a><span id="l61.43">                     if (!(item.id in self.mItemInfoCache)) {</span>
<a href="#l61.44"></a><span id="l61.44">                         let path = self.getItemLocationPath(item);</span>
<a href="#l61.45"></a><span id="l61.45">                         cal.LOG(&quot;Adding meta-data for cached item &quot; + item.id);</span>
<a href="#l61.46"></a><span id="l61.46">                         self.mItemInfoCache[item.id] = { etag: null,</span>
<a href="#l61.47"></a><span id="l61.47">                                                          isNew: false,</span>
<a href="#l61.48"></a><span id="l61.48">                                                          locationPath: path,</span>
<a href="#l61.49"></a><span id="l61.49">                                                          isInboxItem: false};</span>
<a href="#l61.50"></a><span id="l61.50">                         self.mHrefIndex[self.mLocationPath + path] = item.id;</span>
<a href="#l61.51"></a><span id="l61.51" class="difflineat">@@ -1046,17 +1046,17 @@ calDavCalendar.prototype = {</span>
<a href="#l61.52"></a><span id="l61.52">             // certain event failed.</span>
<a href="#l61.53"></a><span id="l61.53">             cal.WARN(&quot;Failed to parse item: &quot; + calData + &quot;\n\nException:&quot; + e);</span>
<a href="#l61.54"></a><span id="l61.54">             return;</span>
<a href="#l61.55"></a><span id="l61.55">         }</span>
<a href="#l61.56"></a><span id="l61.56">         // with CalDAV there really should only be one item here</span>
<a href="#l61.57"></a><span id="l61.57">         let items = parser.getItems({});</span>
<a href="#l61.58"></a><span id="l61.58">         let propertiesList = parser.getProperties({});</span>
<a href="#l61.59"></a><span id="l61.59">         let method;</span>
<a href="#l61.60"></a><span id="l61.60" class="difflineminus">-        for each (var prop in propertiesList) {</span>
<a href="#l61.61"></a><span id="l61.61" class="difflineplus">+        for (var prop of propertiesList) {</span>
<a href="#l61.62"></a><span id="l61.62">             if (prop.propertyName == &quot;METHOD&quot;) {</span>
<a href="#l61.63"></a><span id="l61.63">                 method = prop.value;</span>
<a href="#l61.64"></a><span id="l61.64">                 break;</span>
<a href="#l61.65"></a><span id="l61.65">             }</span>
<a href="#l61.66"></a><span id="l61.66">         }</span>
<a href="#l61.67"></a><span id="l61.67">         let isReply = (method == &quot;REPLY&quot;);</span>
<a href="#l61.68"></a><span id="l61.68">         let item = items[0];</span>
<a href="#l61.69"></a><span id="l61.69">         if (!item) {</span>
<a href="#l61.70"></a><span id="l61.70" class="difflineat">@@ -1837,17 +1837,17 @@ calDavCalendar.prototype = {</span>
<a href="#l61.71"></a><span id="l61.71"> </span>
<a href="#l61.72"></a><span id="l61.72"> </span>
<a href="#l61.73"></a><span id="l61.73">             // Use supported-calendar-component-set if the server supports it; some do not</span>
<a href="#l61.74"></a><span id="l61.74">             // Accept name attribute from all namespaces to workaround Cosmo bug see bug 605378 comment 6</span>
<a href="#l61.75"></a><span id="l61.75">             let supportedComponents = caldavXPath(multistatus,</span>
<a href="#l61.76"></a><span id="l61.76">                 &quot;/D:multistatus/D:response/D:propstat/D:prop/C:supported-calendar-component-set/C:comp/@*[local-name()='name']&quot;);</span>
<a href="#l61.77"></a><span id="l61.77">             if (supportedComponents &amp;&amp; supportedComponents.length) {</span>
<a href="#l61.78"></a><span id="l61.78">                 thisCalendar.mSupportedItemTypes = [ compName</span>
<a href="#l61.79"></a><span id="l61.79" class="difflineminus">-                    for each (compName in supportedComponents)</span>
<a href="#l61.80"></a><span id="l61.80" class="difflineplus">+                    for (compName of supportedComponents)</span>
<a href="#l61.81"></a><span id="l61.81">                     if (thisCalendar.mGenerallySupportedItemTypes.includes(compName))</span>
<a href="#l61.82"></a><span id="l61.82">                 ];</span>
<a href="#l61.83"></a><span id="l61.83">                 cal.LOG(&quot;Adding supported items: &quot; + thisCalendar.mSupportedItemTypes.join(&quot;,&quot;) + &quot; for calendar: &quot; + thisCalendar.name);</span>
<a href="#l61.84"></a><span id="l61.84">             }</span>
<a href="#l61.85"></a><span id="l61.85"> </span>
<a href="#l61.86"></a><span id="l61.86">             // check if owner is specified; might save some work</span>
<a href="#l61.87"></a><span id="l61.87">             let owner = caldavXPathFirst(multistatus, &quot;/D:multistatus/D:response/D:propstat/D:prop/D:owner/D:href/text()&quot;);</span>
<a href="#l61.88"></a><span id="l61.88">             let cuprincipal = caldavXPathFirst(multistatus, &quot;/D:multistatus/D:response/D:propstat/D:prop/D:current-user-principal/D:href/text()&quot;);</span>
<a href="#l61.89"></a><span id="l61.89" class="difflineat">@@ -2214,19 +2214,21 @@ calDavCalendar.prototype = {</span>
<a href="#l61.90"></a><span id="l61.90">                 return url;</span>
<a href="#l61.91"></a><span id="l61.91">             }</span>
<a href="#l61.92"></a><span id="l61.92"> </span>
<a href="#l61.93"></a><span id="l61.93">             // If there are multiple home sets, we need to match the email addresses for scheduling.</span>
<a href="#l61.94"></a><span id="l61.94">             // If there is only one, assume its the right one.</span>
<a href="#l61.95"></a><span id="l61.95">             // TODO with multiple address sets, we should just use the ACL manager.</span>
<a href="#l61.96"></a><span id="l61.96">             if (homeSets &amp;&amp; (homeSets.length == 1 || homeSets.some(homeSetMatches))) {</span>
<a href="#l61.97"></a><span id="l61.97">                 let cuaSets = caldavXPath(multistatus, &quot;/D:multistatus/D:response/D:propstat/D:prop/C:calendar-user-address-set/D:href/text()&quot;);</span>
<a href="#l61.98"></a><span id="l61.98" class="difflineminus">-                for each (let addr in cuaSets) {</span>
<a href="#l61.99"></a><span id="l61.99" class="difflineminus">-                    if (addr.match(/^mailto:/i)) {</span>
<a href="#l61.100"></a><span id="l61.100" class="difflineminus">-                        thisCalendar.mCalendarUserAddress = addr;</span>
<a href="#l61.101"></a><span id="l61.101" class="difflineplus">+                if (cuaSets) {</span>
<a href="#l61.102"></a><span id="l61.102" class="difflineplus">+                    for (let addr of cuaSets) {</span>
<a href="#l61.103"></a><span id="l61.103" class="difflineplus">+                        if (addr.match(/^mailto:/i)) {</span>
<a href="#l61.104"></a><span id="l61.104" class="difflineplus">+                            thisCalendar.mCalendarUserAddress = addr;</span>
<a href="#l61.105"></a><span id="l61.105" class="difflineplus">+                        }</span>
<a href="#l61.106"></a><span id="l61.106">                     }</span>
<a href="#l61.107"></a><span id="l61.107">                 }</span>
<a href="#l61.108"></a><span id="l61.108"> </span>
<a href="#l61.109"></a><span id="l61.109"> </span>
<a href="#l61.110"></a><span id="l61.110">                 let inboxPath = caldavXPathFirst(multistatus, &quot;/D:multistatus/D:response/D:propstat/D:prop/C:schedule-inbox-URL/D:href/text()&quot;);</span>
<a href="#l61.111"></a><span id="l61.111">                 if (!inboxPath) {</span>
<a href="#l61.112"></a><span id="l61.112">                     // most likely this is a Kerio server that omits the &quot;href&quot;</span>
<a href="#l61.113"></a><span id="l61.113">                     inboxPath = caldavXPathFirst(multistatus, &quot;/D:multistatus/D:response/D:propstat/D:prop/C:schedule-inbox-URL/text()&quot;);</span>
<a href="#l61.114"></a><span id="l61.114" class="difflineat">@@ -2653,17 +2655,17 @@ calDavCalendar.prototype = {</span>
<a href="#l61.115"></a><span id="l61.115">                                                               aCount,</span>
<a href="#l61.116"></a><span id="l61.116">                                                               aItems) {</span>
<a href="#l61.117"></a><span id="l61.117">             var itemToUpdate = aItems[0];</span>
<a href="#l61.118"></a><span id="l61.118">             if (aItem.recurrenceId &amp;&amp; itemToUpdate.recurrenceInfo) {</span>
<a href="#l61.119"></a><span id="l61.119">                 itemToUpdate = itemToUpdate.recurrenceInfo.getOccurrenceFor(aItem.recurrenceId);</span>
<a href="#l61.120"></a><span id="l61.120">             }</span>
<a href="#l61.121"></a><span id="l61.121">             var newItem = itemToUpdate.clone();</span>
<a href="#l61.122"></a><span id="l61.122"> </span>
<a href="#l61.123"></a><span id="l61.123" class="difflineminus">-            for each (var attendee in aItem.getAttendees({})) {</span>
<a href="#l61.124"></a><span id="l61.124" class="difflineplus">+            for (var attendee of aItem.getAttendees({})) {</span>
<a href="#l61.125"></a><span id="l61.125">                 var att = newItem.getAttendeeById(attendee.id);</span>
<a href="#l61.126"></a><span id="l61.126">                 if (att) {</span>
<a href="#l61.127"></a><span id="l61.127">                     newItem.removeAttendee(att);</span>
<a href="#l61.128"></a><span id="l61.128">                     att = att.clone();</span>
<a href="#l61.129"></a><span id="l61.129">                     att.participationStatus = attendee.participationStatus;</span>
<a href="#l61.130"></a><span id="l61.130">                     newItem.addAttendee(att);</span>
<a href="#l61.131"></a><span id="l61.131">                 }</span>
<a href="#l61.132"></a><span id="l61.132">             }</span>
<a href="#l61.133"></a><span id="l61.133" class="difflineat">@@ -2748,17 +2750,17 @@ calDavCalendar.prototype = {</span>
<a href="#l61.134"></a><span id="l61.134">             var attendee = aItipItem.getItemList({})[0].getAttendeeById(this.calendarUserAddress);</span>
<a href="#l61.135"></a><span id="l61.135">             if (!attendee) {</span>
<a href="#l61.136"></a><span id="l61.136">                 return false;</span>
<a href="#l61.137"></a><span id="l61.137">             }</span>
<a href="#l61.138"></a><span id="l61.138">             // work around BUG 351589, the below just removes RSVP:</span>
<a href="#l61.139"></a><span id="l61.139">             aItipItem.setAttendeeStatus(attendee.id, attendee.participationStatus);</span>
<a href="#l61.140"></a><span id="l61.140">         }</span>
<a href="#l61.141"></a><span id="l61.141"> </span>
<a href="#l61.142"></a><span id="l61.142" class="difflineminus">-        for each (var item in aItipItem.getItemList({})) {</span>
<a href="#l61.143"></a><span id="l61.143" class="difflineplus">+        for (var item of aItipItem.getItemList({})) {</span>
<a href="#l61.144"></a><span id="l61.144"> </span>
<a href="#l61.145"></a><span id="l61.145">             var serializer = Components.classes[&quot;@mozilla.org/calendar/ics-serializer;1&quot;]</span>
<a href="#l61.146"></a><span id="l61.146">                                        .createInstance(Components.interfaces.calIIcsSerializer);</span>
<a href="#l61.147"></a><span id="l61.147">             serializer.addItems([item], 1);</span>
<a href="#l61.148"></a><span id="l61.148">             var methodProp = getIcsService().createIcalProperty(&quot;METHOD&quot;);</span>
<a href="#l61.149"></a><span id="l61.149">             methodProp.value = aItipItem.responseMethod;</span>
<a href="#l61.150"></a><span id="l61.150">             serializer.addProperty(methodProp);</span>
<a href="#l61.151"></a><span id="l61.151"> </span>
<a href="#l61.152"></a><span id="l61.152" class="difflineat">@@ -2798,27 +2800,29 @@ calDavCalendar.prototype = {</span>
<a href="#l61.153"></a><span id="l61.153">                         return;</span>
<a href="#l61.154"></a><span id="l61.154">                     }</span>
<a href="#l61.155"></a><span id="l61.155"> </span>
<a href="#l61.156"></a><span id="l61.156">                     var remainingAttendees = [];</span>
<a href="#l61.157"></a><span id="l61.157">                     // TODO The following XPath expressions are currently</span>
<a href="#l61.158"></a><span id="l61.158">                     // untested code, as I don't have a caldav-sched server</span>
<a href="#l61.159"></a><span id="l61.159">                     // available. If you find someone who does, please test!</span>
<a href="#l61.160"></a><span id="l61.160">                     let responses = caldavXPath(responseXML, &quot;/C:schedule-response/C:response&quot;);</span>
<a href="#l61.161"></a><span id="l61.161" class="difflineminus">-                    for each (let response in responses) {</span>
<a href="#l61.162"></a><span id="l61.162" class="difflineminus">-                        let recip = caldavXPathFirst(response, &quot;C:recipient/D:href/text()&quot;);</span>
<a href="#l61.163"></a><span id="l61.163" class="difflineminus">-                        let status = caldavXPathFirst(response, &quot;C:request-status/text()&quot;);</span>
<a href="#l61.164"></a><span id="l61.164" class="difflineminus">-                        if (status.substr(0, 1) != &quot;2&quot;) {</span>
<a href="#l61.165"></a><span id="l61.165" class="difflineminus">-                            if (thisCalendar.verboseLogging()) {</span>
<a href="#l61.166"></a><span id="l61.166" class="difflineminus">-                                cal.LOG(&quot;CalDAV: Failed scheduling delivery to &quot; + recip);</span>
<a href="#l61.167"></a><span id="l61.167" class="difflineminus">-                            }</span>
<a href="#l61.168"></a><span id="l61.168" class="difflineminus">-                            for each (let att in aRecipients) {</span>
<a href="#l61.169"></a><span id="l61.169" class="difflineminus">-                                if (att.id.toLowerCase() == recip.toLowerCase()) {</span>
<a href="#l61.170"></a><span id="l61.170" class="difflineminus">-                                    remainingAttendees.push(att);</span>
<a href="#l61.171"></a><span id="l61.171" class="difflineminus">-                                    break;</span>
<a href="#l61.172"></a><span id="l61.172" class="difflineplus">+                    if (responses) {</span>
<a href="#l61.173"></a><span id="l61.173" class="difflineplus">+                        for (let response of responses) {</span>
<a href="#l61.174"></a><span id="l61.174" class="difflineplus">+                            let recip = caldavXPathFirst(response, &quot;C:recipient/D:href/text()&quot;);</span>
<a href="#l61.175"></a><span id="l61.175" class="difflineplus">+                            let status = caldavXPathFirst(response, &quot;C:request-status/text()&quot;);</span>
<a href="#l61.176"></a><span id="l61.176" class="difflineplus">+                            if (status.substr(0, 1) != &quot;2&quot;) {</span>
<a href="#l61.177"></a><span id="l61.177" class="difflineplus">+                                if (thisCalendar.verboseLogging()) {</span>
<a href="#l61.178"></a><span id="l61.178" class="difflineplus">+                                    cal.LOG(&quot;CalDAV: Failed scheduling delivery to &quot; + recip);</span>
<a href="#l61.179"></a><span id="l61.179" class="difflineplus">+                                }</span>
<a href="#l61.180"></a><span id="l61.180" class="difflineplus">+                                for (let att of aRecipients) {</span>
<a href="#l61.181"></a><span id="l61.181" class="difflineplus">+                                    if (att.id.toLowerCase() == recip.toLowerCase()) {</span>
<a href="#l61.182"></a><span id="l61.182" class="difflineplus">+                                        remainingAttendees.push(att);</span>
<a href="#l61.183"></a><span id="l61.183" class="difflineplus">+                                        break;</span>
<a href="#l61.184"></a><span id="l61.184" class="difflineplus">+                                    }</span>
<a href="#l61.185"></a><span id="l61.185">                                 }</span>
<a href="#l61.186"></a><span id="l61.186">                             }</span>
<a href="#l61.187"></a><span id="l61.187">                         }</span>
<a href="#l61.188"></a><span id="l61.188">                     }</span>
<a href="#l61.189"></a><span id="l61.189"> </span>
<a href="#l61.190"></a><span id="l61.190">                     if (remainingAttendees.length) {</span>
<a href="#l61.191"></a><span id="l61.191">                         // try to fall back to email delivery if CalDAV-sched</span>
<a href="#l61.192"></a><span id="l61.192">                         // didn't work</span>
<a href="#l61.193"></a><span id="l61.193" class="difflineat">@@ -2839,17 +2843,17 @@ calDavCalendar.prototype = {</span>
<a href="#l61.194"></a><span id="l61.194">             let uploadData = serializer.serializeToString();</span>
<a href="#l61.195"></a><span id="l61.195">             let requestUri = this.makeUri(null, this.outboxUrl);</span>
<a href="#l61.196"></a><span id="l61.196">             if (this.verboseLogging()) {</span>
<a href="#l61.197"></a><span id="l61.197">                 cal.LOG(&quot;CalDAV: send(&quot; + requestUri.spec + &quot;): &quot; + uploadData);</span>
<a href="#l61.198"></a><span id="l61.198">             }</span>
<a href="#l61.199"></a><span id="l61.199">             this.sendHttpRequest(requestUri, uploadData, MIME_TEXT_CALENDAR, null, (channel) =&gt; {</span>
<a href="#l61.200"></a><span id="l61.200">                 channel.requestMethod = &quot;POST&quot;;</span>
<a href="#l61.201"></a><span id="l61.201">                 channel.setRequestHeader(&quot;Originator&quot;, this.calendarUserAddress, false);</span>
<a href="#l61.202"></a><span id="l61.202" class="difflineminus">-                for each (var recipient in aRecipients) {</span>
<a href="#l61.203"></a><span id="l61.203" class="difflineplus">+                for (var recipient of aRecipients) {</span>
<a href="#l61.204"></a><span id="l61.204">                     channel.setRequestHeader(&quot;Recipient&quot;, recipient.id, true);</span>
<a href="#l61.205"></a><span id="l61.205">                 }</span>
<a href="#l61.206"></a><span id="l61.206">                 return streamListener;</span>
<a href="#l61.207"></a><span id="l61.207">             }, () =&gt; {</span>
<a href="#l61.208"></a><span id="l61.208">                 notifyListener(Components.results.NS_ERROR_NOT_AVAILABLE,</span>
<a href="#l61.209"></a><span id="l61.209">                                &quot;Error preparing http channel&quot;);</span>
<a href="#l61.210"></a><span id="l61.210">             });</span>
<a href="#l61.211"></a><span id="l61.211">         }</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l62.1"></a><span id="l62.1" class="difflineminus">--- a/calendar/providers/composite/calCompositeCalendar.js</span>
<a href="#l62.2"></a><span id="l62.2" class="difflineplus">+++ b/calendar/providers/composite/calCompositeCalendar.js</span>
<a href="#l62.3"></a><span id="l62.3" class="difflineat">@@ -125,17 +125,17 @@ calCompositeCalendar.prototype = {</span>
<a href="#l62.4"></a><span id="l62.4">     get enabledCalendars() {</span>
<a href="#l62.5"></a><span id="l62.5">       return this.mCalendars.filter(</span>
<a href="#l62.6"></a><span id="l62.6">         function(e) { return !e.getProperty(&quot;disabled&quot;); }</span>
<a href="#l62.7"></a><span id="l62.7">       );</span>
<a href="#l62.8"></a><span id="l62.8">     },</span>
<a href="#l62.9"></a><span id="l62.9"> </span>
<a href="#l62.10"></a><span id="l62.10">     set prefPrefix (aPrefPrefix) {</span>
<a href="#l62.11"></a><span id="l62.11">         if (this.mPrefPrefix) {</span>
<a href="#l62.12"></a><span id="l62.12" class="difflineminus">-            for each (let calendar in this.mCalendars) {</span>
<a href="#l62.13"></a><span id="l62.13" class="difflineplus">+            for (let calendar of this.mCalendars) {</span>
<a href="#l62.14"></a><span id="l62.14">                 this.removeCalendar(calendar);</span>
<a href="#l62.15"></a><span id="l62.15">             }</span>
<a href="#l62.16"></a><span id="l62.16">         }</span>
<a href="#l62.17"></a><span id="l62.17">         this.mPrefPrefix = aPrefPrefix;</span>
<a href="#l62.18"></a><span id="l62.18">         this.mActivePref = aPrefPrefix + &quot;-in-composite&quot;;</span>
<a href="#l62.19"></a><span id="l62.19">         this.mDefaultPref = aPrefPrefix + &quot;-default&quot;;</span>
<a href="#l62.20"></a><span id="l62.20">         let mgr = cal.getCalendarManager();</span>
<a href="#l62.21"></a><span id="l62.21">         let cals = mgr.getCalendars({});</span>
<a href="#l62.22"></a><span id="l62.22" class="difflineat">@@ -185,17 +185,17 @@ calCompositeCalendar.prototype = {</span>
<a href="#l62.23"></a><span id="l62.23">                 aCalendar.deleteProperty(this.mDefaultPref);</span>
<a href="#l62.24"></a><span id="l62.24">             }</span>
<a href="#l62.25"></a><span id="l62.25">             aCalendar.removeObserver(this.mObserverHelper);</span>
<a href="#l62.26"></a><span id="l62.26">             this.mCompositeObservers.notify(&quot;onCalendarRemoved&quot;, [aCalendar]);</span>
<a href="#l62.27"></a><span id="l62.27">         }</span>
<a href="#l62.28"></a><span id="l62.28">     },</span>
<a href="#l62.29"></a><span id="l62.29"> </span>
<a href="#l62.30"></a><span id="l62.30">     getCalendarById: function cCC_getCalendarById(aId) {</span>
<a href="#l62.31"></a><span id="l62.31" class="difflineminus">-        for each (let calendar in this.mCalendars) {</span>
<a href="#l62.32"></a><span id="l62.32" class="difflineplus">+        for (let calendar of this.mCalendars) {</span>
<a href="#l62.33"></a><span id="l62.33">             if (calendar.id == aId) {</span>
<a href="#l62.34"></a><span id="l62.34">                 return calendar;</span>
<a href="#l62.35"></a><span id="l62.35">             }</span>
<a href="#l62.36"></a><span id="l62.36">         }</span>
<a href="#l62.37"></a><span id="l62.37">         return null;</span>
<a href="#l62.38"></a><span id="l62.38">     },</span>
<a href="#l62.39"></a><span id="l62.39"> </span>
<a href="#l62.40"></a><span id="l62.40">     getCalendars: function getCalendars(count) {</span>
<a href="#l62.41"></a><span id="l62.41" class="difflineat">@@ -315,17 +315,17 @@ calCompositeCalendar.prototype = {</span>
<a href="#l62.42"></a><span id="l62.42">         }</span>
<a href="#l62.43"></a><span id="l62.43">         this.mObservers.remove(aObserver);</span>
<a href="#l62.44"></a><span id="l62.44">     },</span>
<a href="#l62.45"></a><span id="l62.45"> </span>
<a href="#l62.46"></a><span id="l62.46">     refresh: function cCC_refresh() {</span>
<a href="#l62.47"></a><span id="l62.47">         if (this.mStatusObserver) {</span>
<a href="#l62.48"></a><span id="l62.48">             this.mStatusObserver.startMeteors(Components.interfaces.calIStatusObserver.DETERMINED_PROGRESS, this.mCalendars.length);</span>
<a href="#l62.49"></a><span id="l62.49">         }</span>
<a href="#l62.50"></a><span id="l62.50" class="difflineminus">-        for each (let calendar in this.enabledCalendars) {</span>
<a href="#l62.51"></a><span id="l62.51" class="difflineplus">+        for (let calendar of this.enabledCalendars) {</span>
<a href="#l62.52"></a><span id="l62.52">             try {</span>
<a href="#l62.53"></a><span id="l62.53">                 if (calendar.canRefresh) {</span>
<a href="#l62.54"></a><span id="l62.54">                     this.mObserverHelper.pendingLoads[calendar.id] = true;</span>
<a href="#l62.55"></a><span id="l62.55">                     calendar.refresh();</span>
<a href="#l62.56"></a><span id="l62.56">                 }</span>
<a href="#l62.57"></a><span id="l62.57">             } catch (e) {</span>
<a href="#l62.58"></a><span id="l62.58">                 cal.ASSERT(false, e);</span>
<a href="#l62.59"></a><span id="l62.59">                 delete this.mObserverHelper.pendingLoads[calendar.id];</span>
<a href="#l62.60"></a><span id="l62.60" class="difflineat">@@ -358,17 +358,17 @@ calCompositeCalendar.prototype = {</span>
<a href="#l62.61"></a><span id="l62.61">     addItem: function (aItem, aListener) {</span>
<a href="#l62.62"></a><span id="l62.62">         return this.mDefaultCalendar.addItem(aItem, aListener);</span>
<a href="#l62.63"></a><span id="l62.63">     },</span>
<a href="#l62.64"></a><span id="l62.64"> </span>
<a href="#l62.65"></a><span id="l62.65">     // void getItem( in string aId, in calIOperationListener aListener );</span>
<a href="#l62.66"></a><span id="l62.66">     getItem: function (aId, aListener) {</span>
<a href="#l62.67"></a><span id="l62.67">         let enabledCalendars = this.enabledCalendars;</span>
<a href="#l62.68"></a><span id="l62.68">         let cmpListener = new calCompositeGetListenerHelper(this, aListener);</span>
<a href="#l62.69"></a><span id="l62.69" class="difflineminus">-        for each (let calendar in enabledCalendars) {</span>
<a href="#l62.70"></a><span id="l62.70" class="difflineplus">+        for (let calendar of enabledCalendars) {</span>
<a href="#l62.71"></a><span id="l62.71">             try {</span>
<a href="#l62.72"></a><span id="l62.72">                 cmpListener.opGroup.add(calendar.getItem(aId, cmpListener));</span>
<a href="#l62.73"></a><span id="l62.73">             } catch (exc) {</span>
<a href="#l62.74"></a><span id="l62.74">                 cal.ASSERT(false, exc);</span>
<a href="#l62.75"></a><span id="l62.75">             }</span>
<a href="#l62.76"></a><span id="l62.76">         }</span>
<a href="#l62.77"></a><span id="l62.77">         return cmpListener.opGroup;</span>
<a href="#l62.78"></a><span id="l62.78">     },</span>
<a href="#l62.79"></a><span id="l62.79" class="difflineat">@@ -389,17 +389,17 @@ calCompositeCalendar.prototype = {</span>
<a href="#l62.80"></a><span id="l62.80">         }</span>
<a href="#l62.81"></a><span id="l62.81">         if (this.mStatusObserver) {</span>
<a href="#l62.82"></a><span id="l62.82">             if (this.mStatusObserver.spinning == Components.interfaces.calIStatusObserver.NO_PROGRESS) {</span>
<a href="#l62.83"></a><span id="l62.83">                 this.mStatusObserver.startMeteors(Components.interfaces.calIStatusObserver.UNDETERMINED_PROGRESS, -1);</span>
<a href="#l62.84"></a><span id="l62.84">             }</span>
<a href="#l62.85"></a><span id="l62.85">         }</span>
<a href="#l62.86"></a><span id="l62.86">         let cmpListener = new calCompositeGetListenerHelper(this, aListener, aCount);</span>
<a href="#l62.87"></a><span id="l62.87"> </span>
<a href="#l62.88"></a><span id="l62.88" class="difflineminus">-        for each (let calendar in enabledCalendars) {</span>
<a href="#l62.89"></a><span id="l62.89" class="difflineplus">+        for (let calendar of enabledCalendars) {</span>
<a href="#l62.90"></a><span id="l62.90">             try {</span>
<a href="#l62.91"></a><span id="l62.91">                 cmpListener.opGroup.add(calendar.getItems(aItemFilter,</span>
<a href="#l62.92"></a><span id="l62.92">                                                           aCount,</span>
<a href="#l62.93"></a><span id="l62.93">                                                           aRangeStart,</span>
<a href="#l62.94"></a><span id="l62.94">                                                           aRangeEnd,</span>
<a href="#l62.95"></a><span id="l62.95">                                                           cmpListener));</span>
<a href="#l62.96"></a><span id="l62.96">             } catch (exc) {</span>
<a href="#l62.97"></a><span id="l62.97">                 cal.ASSERT(false, exc);</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l63.1"></a><span id="l63.1" class="difflineminus">--- a/calendar/providers/ics/calICSCalendar.js</span>
<a href="#l63.2"></a><span id="l63.2" class="difflineplus">+++ b/calendar/providers/ics/calICSCalendar.js</span>
<a href="#l63.3"></a><span id="l63.3" class="difflineat">@@ -269,17 +269,17 @@ calICSCalendar.prototype = {</span>
<a href="#l63.4"></a><span id="l63.4">         // for non-existing or empty files, but not good for invalid files.</span>
<a href="#l63.5"></a><span id="l63.5">         // That's why we put them in readOnly mode</span>
<a href="#l63.6"></a><span id="l63.6">         let parser = Components.classes[&quot;@mozilla.org/calendar/ics-parser;1&quot;]</span>
<a href="#l63.7"></a><span id="l63.7">                                .createInstance(Components.interfaces.calIIcsParser);</span>
<a href="#l63.8"></a><span id="l63.8">         let this_ = this;</span>
<a href="#l63.9"></a><span id="l63.9">         let listener = { // calIIcsParsingListener</span>
<a href="#l63.10"></a><span id="l63.10">             onParsingComplete: function ics_onParsingComplete(rc, parser_) {</span>
<a href="#l63.11"></a><span id="l63.11">                 try {</span>
<a href="#l63.12"></a><span id="l63.12" class="difflineminus">-                    for each (let item in parser_.getItems({})) {</span>
<a href="#l63.13"></a><span id="l63.13" class="difflineplus">+                    for (let item of parser_.getItems({})) {</span>
<a href="#l63.14"></a><span id="l63.14">                         this_.mMemoryCalendar.adoptItem(item, null);</span>
<a href="#l63.15"></a><span id="l63.15">                     }</span>
<a href="#l63.16"></a><span id="l63.16">                     this_.unmappedComponents = parser_.getComponents({});</span>
<a href="#l63.17"></a><span id="l63.17">                     this_.unmappedProperties = parser_.getProperties({});</span>
<a href="#l63.18"></a><span id="l63.18">                     cal.LOG(&quot;[calICSCalendar] Parsing ICS succeeded for &quot; + this_.uri.spec);</span>
<a href="#l63.19"></a><span id="l63.19">                 } catch (exc) {</span>
<a href="#l63.20"></a><span id="l63.20">                     cal.LOG(&quot;[calICSCalendar] Parsing ICS failed for &quot; + &quot;\nException: &quot;+ exc);</span>
<a href="#l63.21"></a><span id="l63.21">                     this_.mObserver.onError(this_.superCalendar, exc.result, exc.toString());</span>
<a href="#l63.22"></a><span id="l63.22" class="difflineat">@@ -376,20 +376,20 @@ calICSCalendar.prototype = {</span>
<a href="#l63.23"></a><span id="l63.23">             },</span>
<a href="#l63.24"></a><span id="l63.24">             onGetResult: function(aCalendar, aStatus, aItemType, aDetail, aCount, aItems)</span>
<a href="#l63.25"></a><span id="l63.25">             {</span>
<a href="#l63.26"></a><span id="l63.26">                 this.serializer.addItems(aItems, aCount);</span>
<a href="#l63.27"></a><span id="l63.27">             }</span>
<a href="#l63.28"></a><span id="l63.28">         };</span>
<a href="#l63.29"></a><span id="l63.29">         listener.serializer = Components.classes[&quot;@mozilla.org/calendar/ics-serializer;1&quot;].</span>
<a href="#l63.30"></a><span id="l63.30">                                          createInstance(Components.interfaces.calIIcsSerializer);</span>
<a href="#l63.31"></a><span id="l63.31" class="difflineminus">-        for each (let comp in this.unmappedComponents) {</span>
<a href="#l63.32"></a><span id="l63.32" class="difflineplus">+        for (let comp of this.unmappedComponents) {</span>
<a href="#l63.33"></a><span id="l63.33">             listener.serializer.addComponent(comp);</span>
<a href="#l63.34"></a><span id="l63.34">         }</span>
<a href="#l63.35"></a><span id="l63.35" class="difflineminus">-        for each (let prop in this.unmappedProperties) {</span>
<a href="#l63.36"></a><span id="l63.36" class="difflineplus">+        for (let prop of this.unmappedProperties) {</span>
<a href="#l63.37"></a><span id="l63.37">             switch (prop.propertyName) {</span>
<a href="#l63.38"></a><span id="l63.38">                 // we always set the current name and timezone:</span>
<a href="#l63.39"></a><span id="l63.39">                 case &quot;X-WR-CALNAME&quot;:</span>
<a href="#l63.40"></a><span id="l63.40">                 case &quot;X-WR-TIMEZONE&quot;:</span>
<a href="#l63.41"></a><span id="l63.41">                     break;</span>
<a href="#l63.42"></a><span id="l63.42">                 default:</span>
<a href="#l63.43"></a><span id="l63.43">                     listener.serializer.addProperty(prop);</span>
<a href="#l63.44"></a><span id="l63.44">                     break;</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l64.1"></a><span id="l64.1" class="difflineminus">--- a/calendar/providers/storage/calStorageCalendar.js</span>
<a href="#l64.2"></a><span id="l64.2" class="difflineplus">+++ b/calendar/providers/storage/calStorageCalendar.js</span>
<a href="#l64.3"></a><span id="l64.3" class="difflineat">@@ -67,31 +67,35 @@ calStorageCalendar.prototype = {</span>
<a href="#l64.4"></a><span id="l64.4"> </span>
<a href="#l64.5"></a><span id="l64.5">     createCalendar: function cSC_createCalendar() {</span>
<a href="#l64.6"></a><span id="l64.6">         throw NS_ERROR_NOT_IMPLEMENTED;</span>
<a href="#l64.7"></a><span id="l64.7">     },</span>
<a href="#l64.8"></a><span id="l64.8"> </span>
<a href="#l64.9"></a><span id="l64.9">     deleteCalendar: function cSC_deleteCalendar(aCalendar, listener) {</span>
<a href="#l64.10"></a><span id="l64.10">         aCalendar = aCalendar.wrappedJSObject;</span>
<a href="#l64.11"></a><span id="l64.11"> </span>
<a href="#l64.12"></a><span id="l64.12" class="difflineminus">-        for each (let stmt in this.mDeleteEventExtras) {</span>
<a href="#l64.13"></a><span id="l64.13" class="difflineminus">-            try {</span>
<a href="#l64.14"></a><span id="l64.14" class="difflineminus">-                this.prepareStatement(stmt);</span>
<a href="#l64.15"></a><span id="l64.15" class="difflineminus">-                stmt.executeStep();</span>
<a href="#l64.16"></a><span id="l64.16" class="difflineminus">-            } finally {</span>
<a href="#l64.17"></a><span id="l64.17" class="difflineplus">+        if (this.mDeleteEventExtras) {</span>
<a href="#l64.18"></a><span id="l64.18" class="difflineplus">+            for (let stmt of this.mDeleteEventExtras) {</span>
<a href="#l64.19"></a><span id="l64.19" class="difflineplus">+                try {</span>
<a href="#l64.20"></a><span id="l64.20" class="difflineplus">+                    this.prepareStatement(stmt);</span>
<a href="#l64.21"></a><span id="l64.21" class="difflineplus">+                    stmt.executeStep();</span>
<a href="#l64.22"></a><span id="l64.22" class="difflineplus">+                } finally {</span>
<a href="#l64.23"></a><span id="l64.23">                 stmt.reset();</span>
<a href="#l64.24"></a><span id="l64.24" class="difflineplus">+                }</span>
<a href="#l64.25"></a><span id="l64.25">             }</span>
<a href="#l64.26"></a><span id="l64.26">         }</span>
<a href="#l64.27"></a><span id="l64.27"> </span>
<a href="#l64.28"></a><span id="l64.28" class="difflineminus">-        for each (let stmt in this.mDeleteTodoExtras) {</span>
<a href="#l64.29"></a><span id="l64.29" class="difflineminus">-            try {</span>
<a href="#l64.30"></a><span id="l64.30" class="difflineminus">-                this.prepareStatement(stmt);</span>
<a href="#l64.31"></a><span id="l64.31" class="difflineminus">-                stmt.executeStep();</span>
<a href="#l64.32"></a><span id="l64.32" class="difflineminus">-            } finally {</span>
<a href="#l64.33"></a><span id="l64.33" class="difflineminus">-                stmt.reset();</span>
<a href="#l64.34"></a><span id="l64.34" class="difflineplus">+        if (this.mDeleteTodoExtras) {</span>
<a href="#l64.35"></a><span id="l64.35" class="difflineplus">+            for (let stmt of this.mDeleteTodoExtras) {</span>
<a href="#l64.36"></a><span id="l64.36" class="difflineplus">+                try {</span>
<a href="#l64.37"></a><span id="l64.37" class="difflineplus">+                    this.prepareStatement(stmt);</span>
<a href="#l64.38"></a><span id="l64.38" class="difflineplus">+                    stmt.executeStep();</span>
<a href="#l64.39"></a><span id="l64.39" class="difflineplus">+                } finally {</span>
<a href="#l64.40"></a><span id="l64.40" class="difflineplus">+                    stmt.reset();</span>
<a href="#l64.41"></a><span id="l64.41" class="difflineplus">+                }</span>
<a href="#l64.42"></a><span id="l64.42">             }</span>
<a href="#l64.43"></a><span id="l64.43">         }</span>
<a href="#l64.44"></a><span id="l64.44"> </span>
<a href="#l64.45"></a><span id="l64.45">         try {</span>
<a href="#l64.46"></a><span id="l64.46">             this.prepareStatement(this.mDeleteAllEvents);</span>
<a href="#l64.47"></a><span id="l64.47">             this.mDeleteAllEvents.executeStep();</span>
<a href="#l64.48"></a><span id="l64.48">         } finally {</span>
<a href="#l64.49"></a><span id="l64.49">             this.mDeleteAllEvents.reset();</span>
<a href="#l64.50"></a><span id="l64.50" class="difflineat">@@ -274,21 +278,21 @@ calStorageCalendar.prototype = {</span>
<a href="#l64.51"></a><span id="l64.51">                 /**</span>
<a href="#l64.52"></a><span id="l64.52">                  * Helper function to migrate all tables from one id to the next</span>
<a href="#l64.53"></a><span id="l64.53">                  *</span>
<a href="#l64.54"></a><span id="l64.54">                  * @param db        The database to use</span>
<a href="#l64.55"></a><span id="l64.55">                  * @param newCalId  The new calendar id to set</span>
<a href="#l64.56"></a><span id="l64.56">                  * @param oldCalId  The old calendar id to look for</span>
<a href="#l64.57"></a><span id="l64.57">                  */</span>
<a href="#l64.58"></a><span id="l64.58">                 let migrateTables = function(db, newCalId, oldCalId) {</span>
<a href="#l64.59"></a><span id="l64.59" class="difflineminus">-                    for each (let tbl in [&quot;cal_alarms&quot;, &quot;cal_attachments&quot;,</span>
<a href="#l64.60"></a><span id="l64.60" class="difflineminus">-                                          &quot;cal_attendees&quot;, &quot;cal_events&quot;,</span>
<a href="#l64.61"></a><span id="l64.61" class="difflineminus">-                                          &quot;cal_metadata&quot;, &quot;cal_properties&quot;,</span>
<a href="#l64.62"></a><span id="l64.62" class="difflineminus">-                                          &quot;cal_recurrence&quot;, &quot;cal_relations&quot;,</span>
<a href="#l64.63"></a><span id="l64.63" class="difflineminus">-                                          &quot;cal_todos&quot;]) {</span>
<a href="#l64.64"></a><span id="l64.64" class="difflineplus">+                    for (let tbl of [&quot;cal_alarms&quot;, &quot;cal_attachments&quot;,</span>
<a href="#l64.65"></a><span id="l64.65" class="difflineplus">+                                     &quot;cal_attendees&quot;, &quot;cal_events&quot;,</span>
<a href="#l64.66"></a><span id="l64.66" class="difflineplus">+                                     &quot;cal_metadata&quot;, &quot;cal_properties&quot;,</span>
<a href="#l64.67"></a><span id="l64.67" class="difflineplus">+                                     &quot;cal_recurrence&quot;, &quot;cal_relations&quot;,</span>
<a href="#l64.68"></a><span id="l64.68" class="difflineplus">+                                     &quot;cal_todos&quot;]) {</span>
<a href="#l64.69"></a><span id="l64.69">                         let stmt;</span>
<a href="#l64.70"></a><span id="l64.70">                         try {</span>
<a href="#l64.71"></a><span id="l64.71">                             stmt = db.createStatement(&quot;UPDATE &quot; + tbl +</span>
<a href="#l64.72"></a><span id="l64.72">                                                       &quot;   SET cal_id = :cal_id&quot; +</span>
<a href="#l64.73"></a><span id="l64.73">                                                       &quot; WHERE cal_id = :old_cal_id&quot;);</span>
<a href="#l64.74"></a><span id="l64.74">                             stmt.params.cal_id = newCalId;</span>
<a href="#l64.75"></a><span id="l64.75">                             stmt.params.old_cal_id = oldCalId;</span>
<a href="#l64.76"></a><span id="l64.76">                             stmt.executeStep();</span>
<a href="#l64.77"></a><span id="l64.77" class="difflineat">@@ -832,25 +836,26 @@ calStorageCalendar.prototype = {</span>
<a href="#l64.78"></a><span id="l64.78">                 }</span>
<a href="#l64.79"></a><span id="l64.79">             } catch (e) {</span>
<a href="#l64.80"></a><span id="l64.80">                 this.logError(&quot;Error selecting non recurring events by range!\n&quot;, e);</span>
<a href="#l64.81"></a><span id="l64.81">             } finally {</span>
<a href="#l64.82"></a><span id="l64.82">                 this.mSelectNonRecurringEventsByRange.reset();</span>
<a href="#l64.83"></a><span id="l64.83">             }</span>
<a href="#l64.84"></a><span id="l64.84"> </span>
<a href="#l64.85"></a><span id="l64.85">             // Process the non-recurring events:</span>
<a href="#l64.86"></a><span id="l64.86" class="difflineminus">-            for each (var evitem in resultItems) {</span>
<a href="#l64.87"></a><span id="l64.87" class="difflineplus">+            for (var evitem of resultItems) {</span>
<a href="#l64.88"></a><span id="l64.88">                 count += handleResultItem(evitem, Components.interfaces.calIEvent);</span>
<a href="#l64.89"></a><span id="l64.89">                 if (checkCount()) {</span>
<a href="#l64.90"></a><span id="l64.90">                     return;</span>
<a href="#l64.91"></a><span id="l64.91">                 }</span>
<a href="#l64.92"></a><span id="l64.92">             }</span>
<a href="#l64.93"></a><span id="l64.93"> </span>
<a href="#l64.94"></a><span id="l64.94">             // Process the recurring events from the cache</span>
<a href="#l64.95"></a><span id="l64.95" class="difflineminus">-            for each (let evitem in this.mRecEventCache) {</span>
<a href="#l64.96"></a><span id="l64.96" class="difflineplus">+            for (let id in this.mRecEventCache) {</span>
<a href="#l64.97"></a><span id="l64.97" class="difflineplus">+                let evitem = this.mRecEventCache[id];</span>
<a href="#l64.98"></a><span id="l64.98">                 let offline_journal_flag = this.mRecEventCacheOfflineFlags[evitem.id] || null;</span>
<a href="#l64.99"></a><span id="l64.99">                 // No need to return flagged unless asked i.e. sp.offline_journal == offline_journal_flag</span>
<a href="#l64.100"></a><span id="l64.100">                 // Return created and modified offline records if sp.offline_journal is null alongwith events that have no flag</span>
<a href="#l64.101"></a><span id="l64.101">                 if ((sp.offline_journal == null &amp;&amp; offline_journal_flag != cICL.OFFLINE_FLAG_DELETED_RECORD)</span>
<a href="#l64.102"></a><span id="l64.102">                     || (sp.offline_journal != null &amp;&amp; offline_journal_flag == sp.offline_journal)) {</span>
<a href="#l64.103"></a><span id="l64.103">                     count += handleResultItem(evitem, Components.interfaces.calIEvent);</span>
<a href="#l64.104"></a><span id="l64.104">                     if (checkCount()) {</span>
<a href="#l64.105"></a><span id="l64.105">                         return;</span>
<a href="#l64.106"></a><span id="l64.106" class="difflineat">@@ -883,29 +888,30 @@ calStorageCalendar.prototype = {</span>
<a href="#l64.107"></a><span id="l64.107">                 }</span>
<a href="#l64.108"></a><span id="l64.108">             } catch (e) {</span>
<a href="#l64.109"></a><span id="l64.109">                 this.logError(&quot;Error selecting non recurring todos by range&quot;, e);</span>
<a href="#l64.110"></a><span id="l64.110">             } finally {</span>
<a href="#l64.111"></a><span id="l64.111">                 this.mSelectNonRecurringTodosByRange.reset();</span>
<a href="#l64.112"></a><span id="l64.112">             }</span>
<a href="#l64.113"></a><span id="l64.113"> </span>
<a href="#l64.114"></a><span id="l64.114">             // process the non-recurring todos:</span>
<a href="#l64.115"></a><span id="l64.115" class="difflineminus">-            for each (var todoitem in resultItems) {</span>
<a href="#l64.116"></a><span id="l64.116" class="difflineplus">+            for (var todoitem of resultItems) {</span>
<a href="#l64.117"></a><span id="l64.117">                 count += handleResultItem(todoitem, Components.interfaces.calITodo, checkCompleted);</span>
<a href="#l64.118"></a><span id="l64.118">                 if (checkCount()) {</span>
<a href="#l64.119"></a><span id="l64.119">                     return;</span>
<a href="#l64.120"></a><span id="l64.120">                 }</span>
<a href="#l64.121"></a><span id="l64.121">             }</span>
<a href="#l64.122"></a><span id="l64.122"> </span>
<a href="#l64.123"></a><span id="l64.123">             // Note: Reading the code, completed *occurrences* seems to be broken, because</span>
<a href="#l64.124"></a><span id="l64.124">             //       only the parent item has been filtered; I fixed that.</span>
<a href="#l64.125"></a><span id="l64.125">             //       Moreover item.todo_complete etc seems to be a leftover...</span>
<a href="#l64.126"></a><span id="l64.126"> </span>
<a href="#l64.127"></a><span id="l64.127">             // process the recurring todos from the cache</span>
<a href="#l64.128"></a><span id="l64.128" class="difflineminus">-            for each (let todoitem in this.mRecTodoCache) {</span>
<a href="#l64.129"></a><span id="l64.129" class="difflineplus">+            for (let id in this.mRecTodoCache) {</span>
<a href="#l64.130"></a><span id="l64.130" class="difflineplus">+                let todoitem = this.mRecTodoCache[id];</span>
<a href="#l64.131"></a><span id="l64.131">                 let offline_journal_flag = this.mRecTodoCacheOfflineFlags[todoitem.id] || null;</span>
<a href="#l64.132"></a><span id="l64.132">                 if ((sp.offline_journal == null &amp;&amp;</span>
<a href="#l64.133"></a><span id="l64.133">                      (offline_journal_flag == cICL.OFFLINE_FLAG_MODIFIED_RECORD ||</span>
<a href="#l64.134"></a><span id="l64.134">                       offline_journal_flag == cICL.OFFLINE_FLAG_CREATED_RECORD ||</span>
<a href="#l64.135"></a><span id="l64.135">                       offline_journal_flag == null)) ||</span>
<a href="#l64.136"></a><span id="l64.136">                     (sp.offline_journal != null &amp;&amp;</span>
<a href="#l64.137"></a><span id="l64.137">                      (offline_journal_flag == sp.offline_journal))) {</span>
<a href="#l64.138"></a><span id="l64.138"> </span>
<a href="#l64.139"></a><span id="l64.139" class="difflineat">@@ -1464,20 +1470,20 @@ calStorageCalendar.prototype = {</span>
<a href="#l64.140"></a><span id="l64.140">             if (this.mSelectPropertiesForItemWithRecurrenceId) { this.mSelectPropertiesForItemWithRecurrenceId.finalize(); }</span>
<a href="#l64.141"></a><span id="l64.141">             if (this.mSelectRecurrenceForItem) { this.mSelectRecurrenceForItem.finalize(); }</span>
<a href="#l64.142"></a><span id="l64.142">             if (this.mSelectRelationsForItem) { this.mSelectRelationsForItem.finalize(); }</span>
<a href="#l64.143"></a><span id="l64.143">             if (this.mSelectRelationsForItemWithRecurrenceId) { this.mSelectRelationsForItemWithRecurrenceId.finalize(); }</span>
<a href="#l64.144"></a><span id="l64.144">             if (this.mSelectTodo) { this.mSelectTodo.finalize(); }</span>
<a href="#l64.145"></a><span id="l64.145">             if (this.mSelectTodoExceptions) { this.mSelectTodoExceptions.finalize(); }</span>
<a href="#l64.146"></a><span id="l64.146">             if (this.mSelectTodosWithRecurrence) { this.mSelectTodosWithRecurrence.finalize(); }</span>
<a href="#l64.147"></a><span id="l64.147">             if (this.mDeleteEventExtras) {</span>
<a href="#l64.148"></a><span id="l64.148" class="difflineminus">-                for each (let stmt in this.mDeleteEventExtras) { stmt.finalize(); }</span>
<a href="#l64.149"></a><span id="l64.149" class="difflineplus">+                for (let stmt of this.mDeleteEventExtras) { stmt.finalize(); }</span>
<a href="#l64.150"></a><span id="l64.150">             }</span>
<a href="#l64.151"></a><span id="l64.151">             if (this.mDeleteTodoExtras) {</span>
<a href="#l64.152"></a><span id="l64.152" class="difflineminus">-                for each (let stmt in this.mDeleteTodoExtras) { stmt.finalize(); }</span>
<a href="#l64.153"></a><span id="l64.153" class="difflineplus">+                for (let stmt of this.mDeleteTodoExtras) { stmt.finalize(); }</span>
<a href="#l64.154"></a><span id="l64.154">             }</span>
<a href="#l64.155"></a><span id="l64.155"> </span>
<a href="#l64.156"></a><span id="l64.156">             if (this.mDB) { this.mDB.asyncClose(); this.mDB = null; }</span>
<a href="#l64.157"></a><span id="l64.157">         } catch (e) {</span>
<a href="#l64.158"></a><span id="l64.158">             cal.ERROR(&quot;Error closing storage database: &quot; + e);</span>
<a href="#l64.159"></a><span id="l64.159">         }</span>
<a href="#l64.160"></a><span id="l64.160">     },</span>
<a href="#l64.161"></a><span id="l64.161"> </span>
<a href="#l64.162"></a><span id="l64.162" class="difflineat">@@ -2075,17 +2081,17 @@ calStorageCalendar.prototype = {</span>
<a href="#l64.163"></a><span id="l64.163"> </span>
<a href="#l64.164"></a><span id="l64.164">     writeAttendees: function cSC_writeAttendees(item, olditem) {</span>
<a href="#l64.165"></a><span id="l64.165">         var attendees = item.getAttendees({});</span>
<a href="#l64.166"></a><span id="l64.166">         if (item.organizer) {</span>
<a href="#l64.167"></a><span id="l64.167">             attendees = attendees.concat([]);</span>
<a href="#l64.168"></a><span id="l64.168">             attendees.push(item.organizer);</span>
<a href="#l64.169"></a><span id="l64.169">         }</span>
<a href="#l64.170"></a><span id="l64.170">         if (attendees.length &gt; 0) {</span>
<a href="#l64.171"></a><span id="l64.171" class="difflineminus">-            for each (var att in attendees) {</span>
<a href="#l64.172"></a><span id="l64.172" class="difflineplus">+            for (var att of attendees) {</span>
<a href="#l64.173"></a><span id="l64.173">                 var ap = this.mInsertAttendee.params;</span>
<a href="#l64.174"></a><span id="l64.174">                 ap.item_id = item.id;</span>
<a href="#l64.175"></a><span id="l64.175">                 try {</span>
<a href="#l64.176"></a><span id="l64.176">                     this.prepareStatement(this.mInsertAttendee);</span>
<a href="#l64.177"></a><span id="l64.177">                     this.setDateParamHelper(ap, &quot;recurrence_id&quot;, item.recurrenceId);</span>
<a href="#l64.178"></a><span id="l64.178">                     ap.icalString = att.icalString;</span>
<a href="#l64.179"></a><span id="l64.179">                     this.mInsertAttendee.executeStep();</span>
<a href="#l64.180"></a><span id="l64.180">                 } finally {</span>
<a href="#l64.181"></a><span id="l64.181" class="difflineat">@@ -2149,17 +2155,17 @@ calStorageCalendar.prototype = {</span>
<a href="#l64.182"></a><span id="l64.182"> </span>
<a href="#l64.183"></a><span id="l64.183">     writeRecurrence: function cSC_writeRecurrence(item, olditem) {</span>
<a href="#l64.184"></a><span id="l64.184">         var flags = 0;</span>
<a href="#l64.185"></a><span id="l64.185"> </span>
<a href="#l64.186"></a><span id="l64.186">         var rec = item.recurrenceInfo;</span>
<a href="#l64.187"></a><span id="l64.187">         if (rec) {</span>
<a href="#l64.188"></a><span id="l64.188">             flags = CAL_ITEM_FLAG.HAS_RECURRENCE;</span>
<a href="#l64.189"></a><span id="l64.189">             let ritems = rec.getRecurrenceItems({});</span>
<a href="#l64.190"></a><span id="l64.190" class="difflineminus">-            for each (let ritem in ritems) {</span>
<a href="#l64.191"></a><span id="l64.191" class="difflineplus">+            for (let ritem of ritems) {</span>
<a href="#l64.192"></a><span id="l64.192">                 let ap = this.mInsertRecurrence.params;</span>
<a href="#l64.193"></a><span id="l64.193">                 try {</span>
<a href="#l64.194"></a><span id="l64.194">                     this.prepareStatement(this.mInsertRecurrence);</span>
<a href="#l64.195"></a><span id="l64.195">                     ap.item_id = item.id;</span>
<a href="#l64.196"></a><span id="l64.196">                     ap.icalString = ritem.icalString;</span>
<a href="#l64.197"></a><span id="l64.197">                     this.mInsertRecurrence.executeStep();</span>
<a href="#l64.198"></a><span id="l64.198">                 } finally {</span>
<a href="#l64.199"></a><span id="l64.199">                     this.mInsertRecurrence.reset();</span>
<a href="#l64.200"></a><span id="l64.200" class="difflineat">@@ -2168,34 +2174,34 @@ calStorageCalendar.prototype = {</span>
<a href="#l64.201"></a><span id="l64.201"> </span>
<a href="#l64.202"></a><span id="l64.202">             var exceptions = rec.getExceptionIds ({});</span>
<a href="#l64.203"></a><span id="l64.203">             if (exceptions.length &gt; 0) {</span>
<a href="#l64.204"></a><span id="l64.204">                 flags |= CAL_ITEM_FLAG.HAS_EXCEPTIONS;</span>
<a href="#l64.205"></a><span id="l64.205"> </span>
<a href="#l64.206"></a><span id="l64.206">                 // we need to serialize each exid as a separate</span>
<a href="#l64.207"></a><span id="l64.207">                 // event/todo; setupItemBase will handle</span>
<a href="#l64.208"></a><span id="l64.208">                 // writing the recurrenceId for us</span>
<a href="#l64.209"></a><span id="l64.209" class="difflineminus">-                for each (let exid in exceptions) {</span>
<a href="#l64.210"></a><span id="l64.210" class="difflineplus">+                for (let exid of exceptions) {</span>
<a href="#l64.211"></a><span id="l64.211">                     let ex = rec.getExceptionFor(exid);</span>
<a href="#l64.212"></a><span id="l64.212">                     if (!ex)</span>
<a href="#l64.213"></a><span id="l64.213">                         throw Components.results.NS_ERROR_UNEXPECTED;</span>
<a href="#l64.214"></a><span id="l64.214">                     this.writeItem(ex, null);</span>
<a href="#l64.215"></a><span id="l64.215">                 }</span>
<a href="#l64.216"></a><span id="l64.216">             }</span>
<a href="#l64.217"></a><span id="l64.217">         } else  if (item.recurrenceId &amp;&amp; item.recurrenceId.isDate) {</span>
<a href="#l64.218"></a><span id="l64.218">             flags |= CAL_ITEM_FLAG.RECURRENCE_ID_ALLDAY;</span>
<a href="#l64.219"></a><span id="l64.219">         }</span>
<a href="#l64.220"></a><span id="l64.220"> </span>
<a href="#l64.221"></a><span id="l64.221">         return flags;</span>
<a href="#l64.222"></a><span id="l64.222">     },</span>
<a href="#l64.223"></a><span id="l64.223"> </span>
<a href="#l64.224"></a><span id="l64.224">     writeAttachments: function cSC_writeAttachments(item, olditem) {</span>
<a href="#l64.225"></a><span id="l64.225">         let attachments = item.getAttachments({});</span>
<a href="#l64.226"></a><span id="l64.226">         if (attachments &amp;&amp; attachments.length &gt; 0) {</span>
<a href="#l64.227"></a><span id="l64.227" class="difflineminus">-            for each (let att in attachments) {</span>
<a href="#l64.228"></a><span id="l64.228" class="difflineplus">+            for (let att of attachments) {</span>
<a href="#l64.229"></a><span id="l64.229">                 let ap = this.mInsertAttachment.params;</span>
<a href="#l64.230"></a><span id="l64.230">                 try {</span>
<a href="#l64.231"></a><span id="l64.231">                     this.prepareStatement(this.mInsertAttachment);</span>
<a href="#l64.232"></a><span id="l64.232">                     this.setDateParamHelper(ap, &quot;recurrence_id&quot;, item.recurrenceId);</span>
<a href="#l64.233"></a><span id="l64.233">                     ap.item_id = item.id;</span>
<a href="#l64.234"></a><span id="l64.234">                     ap.icalString = att.icalString;</span>
<a href="#l64.235"></a><span id="l64.235"> </span>
<a href="#l64.236"></a><span id="l64.236">                     this.mInsertAttachment.executeStep();</span>
<a href="#l64.237"></a><span id="l64.237" class="difflineat">@@ -2206,17 +2212,17 @@ calStorageCalendar.prototype = {</span>
<a href="#l64.238"></a><span id="l64.238">             return CAL_ITEM_FLAG.HAS_ATTACHMENTS;</span>
<a href="#l64.239"></a><span id="l64.239">         }</span>
<a href="#l64.240"></a><span id="l64.240">         return 0;</span>
<a href="#l64.241"></a><span id="l64.241">     },</span>
<a href="#l64.242"></a><span id="l64.242"> </span>
<a href="#l64.243"></a><span id="l64.243">     writeRelations: function cSC_writeRelations(item, olditem) {</span>
<a href="#l64.244"></a><span id="l64.244">         let relations = item.getRelations({});</span>
<a href="#l64.245"></a><span id="l64.245">         if (relations &amp;&amp; relations.length &gt; 0) {</span>
<a href="#l64.246"></a><span id="l64.246" class="difflineminus">-            for each (var rel in relations) {</span>
<a href="#l64.247"></a><span id="l64.247" class="difflineplus">+            for (var rel of relations) {</span>
<a href="#l64.248"></a><span id="l64.248">                 let rp = this.mInsertRelation.params;</span>
<a href="#l64.249"></a><span id="l64.249">                 try {</span>
<a href="#l64.250"></a><span id="l64.250">                     this.prepareStatement(this.mInsertRelation);</span>
<a href="#l64.251"></a><span id="l64.251">                     this.setDateParamHelper(rp, &quot;recurrence_id&quot;, item.recurrenceId);</span>
<a href="#l64.252"></a><span id="l64.252">                     rp.item_id = item.id;</span>
<a href="#l64.253"></a><span id="l64.253">                     rp.icalString = rel.icalString;</span>
<a href="#l64.254"></a><span id="l64.254"> </span>
<a href="#l64.255"></a><span id="l64.255">                     this.mInsertRelation.executeStep();</span>
<a href="#l64.256"></a><span id="l64.256" class="difflineat">@@ -2230,17 +2236,17 @@ calStorageCalendar.prototype = {</span>
<a href="#l64.257"></a><span id="l64.257">     },</span>
<a href="#l64.258"></a><span id="l64.258"> </span>
<a href="#l64.259"></a><span id="l64.259">     writeAlarms: function cSC_writeAlarms(item, olditem) {</span>
<a href="#l64.260"></a><span id="l64.260">         let alarms = item.getAlarms({});</span>
<a href="#l64.261"></a><span id="l64.261">         if (alarms.length &lt; 1) {</span>
<a href="#l64.262"></a><span id="l64.262">             return 0;</span>
<a href="#l64.263"></a><span id="l64.263">         }</span>
<a href="#l64.264"></a><span id="l64.264"> </span>
<a href="#l64.265"></a><span id="l64.265" class="difflineminus">-        for each (let alarm in alarms) {</span>
<a href="#l64.266"></a><span id="l64.266" class="difflineplus">+        for (let alarm of alarms) {</span>
<a href="#l64.267"></a><span id="l64.267">             let pp = this.mInsertAlarm.params;</span>
<a href="#l64.268"></a><span id="l64.268">             try {</span>
<a href="#l64.269"></a><span id="l64.269">                 this.prepareStatement(this.mInsertAlarm);</span>
<a href="#l64.270"></a><span id="l64.270">                 this.setDateParamHelper(pp, &quot;recurrence_id&quot;, item.recurrenceId);</span>
<a href="#l64.271"></a><span id="l64.271">                 pp.item_id = item.id;</span>
<a href="#l64.272"></a><span id="l64.272">                 pp.icalString = alarm.icalString;</span>
<a href="#l64.273"></a><span id="l64.273">                 this.mInsertAlarm.executeStep();</span>
<a href="#l64.274"></a><span id="l64.274">             } catch (e) {</span>
<a href="#l64.275"></a><span id="l64.275" class="difflineat">@@ -2425,17 +2431,17 @@ calStorageCalendar.prototype = {</span>
<a href="#l64.276"></a><span id="l64.276">             aItem.setProperty(&quot;SEQUENCE&quot;, newSequence);</span>
<a href="#l64.277"></a><span id="l64.277">         } else {</span>
<a href="#l64.278"></a><span id="l64.278">             aItem.deleteProperty(&quot;SEQUENCE&quot;);</span>
<a href="#l64.279"></a><span id="l64.279">         }</span>
<a href="#l64.280"></a><span id="l64.280">         var rec = aItem.recurrenceInfo;</span>
<a href="#l64.281"></a><span id="l64.281">         if (rec) {</span>
<a href="#l64.282"></a><span id="l64.282">             var exceptions = rec.getExceptionIds ({});</span>
<a href="#l64.283"></a><span id="l64.283">             if (exceptions.length &gt; 0) {</span>
<a href="#l64.284"></a><span id="l64.284" class="difflineminus">-                for each (exid in exceptions) {</span>
<a href="#l64.285"></a><span id="l64.285" class="difflineplus">+                for (exid of exceptions) {</span>
<a href="#l64.286"></a><span id="l64.286">                     let ex = rec.getExceptionFor(exid);</span>
<a href="#l64.287"></a><span id="l64.287">                     if (newSequence) {</span>
<a href="#l64.288"></a><span id="l64.288">                         ex.setProperty(&quot;SEQUENCE&quot;, newSequence);</span>
<a href="#l64.289"></a><span id="l64.289">                     } else {</span>
<a href="#l64.290"></a><span id="l64.290">                         ex.deleteProperty(&quot;SEQUENCE&quot;);</span>
<a href="#l64.291"></a><span id="l64.291">                     }</span>
<a href="#l64.292"></a><span id="l64.292">                 }</span>
<a href="#l64.293"></a><span id="l64.293">             }</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l65.1"></a><span id="l65.1" class="difflineminus">--- a/calendar/providers/storage/calStorageUpgrade.jsm</span>
<a href="#l65.2"></a><span id="l65.2" class="difflineplus">+++ b/calendar/providers/storage/calStorageUpgrade.jsm</span>
<a href="#l65.3"></a><span id="l65.3" class="difflineat">@@ -400,17 +400,17 @@ function ensureUpdatedTimezones(db) {</span>
<a href="#l65.4"></a><span id="l65.4">             cal.ERROR(&quot;Error updating timezones: &quot; + e +</span>
<a href="#l65.5"></a><span id="l65.5">                       &quot;\nDB Error &quot; + lastErrorString(db));</span>
<a href="#l65.6"></a><span id="l65.6">         } finally {</span>
<a href="#l65.7"></a><span id="l65.7">             getZones.reset();</span>
<a href="#l65.8"></a><span id="l65.8">         }</span>
<a href="#l65.9"></a><span id="l65.9"> </span>
<a href="#l65.10"></a><span id="l65.10">         beginTransaction(db);</span>
<a href="#l65.11"></a><span id="l65.11">         try {</span>
<a href="#l65.12"></a><span id="l65.12" class="difflineminus">-            for each (let update in zonesToUpdate) {</span>
<a href="#l65.13"></a><span id="l65.13" class="difflineplus">+            for (let update of zonesToUpdate) {</span>
<a href="#l65.14"></a><span id="l65.14">                 executeSimpleSQL(db,</span>
<a href="#l65.15"></a><span id="l65.15">                     &quot;UPDATE cal_attendees    SET recurrence_id_tz = '&quot; + update.newTzId + &quot;' WHERE recurrence_id_tz = '&quot; + update.oldTzId + &quot;'; &quot; +</span>
<a href="#l65.16"></a><span id="l65.16">                     &quot;UPDATE cal_events       SET recurrence_id_tz = '&quot; + update.newTzId + &quot;' WHERE recurrence_id_tz = '&quot; + update.oldTzId + &quot;'; &quot; +</span>
<a href="#l65.17"></a><span id="l65.17">                     &quot;UPDATE cal_events       SET event_start_tz   = '&quot; + update.newTzId + &quot;' WHERE event_start_tz   = '&quot; + update.oldTzId + &quot;'; &quot; +</span>
<a href="#l65.18"></a><span id="l65.18">                     &quot;UPDATE cal_events       SET event_end_tz     = '&quot; + update.newTzId + &quot;' WHERE event_end_tz     = '&quot; + update.oldTzId + &quot;'; &quot; +</span>
<a href="#l65.19"></a><span id="l65.19">                     &quot;UPDATE cal_properties   SET recurrence_id_tz = '&quot; + update.newTzId + &quot;' WHERE recurrence_id_tz = '&quot; + update.oldTzId + &quot;'; &quot; +</span>
<a href="#l65.20"></a><span id="l65.20">                     &quot;UPDATE cal_todos        SET recurrence_id_tz = '&quot; + update.newTzId + &quot;' WHERE recurrence_id_tz = '&quot; + update.oldTzId + &quot;'; &quot; +</span>
<a href="#l65.21"></a><span id="l65.21">                     &quot;UPDATE cal_todos        SET todo_entry_tz    = '&quot; + update.newTzId + &quot;' WHERE todo_entry_tz    = '&quot; + update.oldTzId + &quot;'; &quot; +</span>
<a href="#l65.22"></a><span id="l65.22" class="difflineat">@@ -454,17 +454,17 @@ function addColumn(tblData, tblName, col</span>
<a href="#l65.23"></a><span id="l65.23">  * Deletes columns from the given table.</span>
<a href="#l65.24"></a><span id="l65.24">  *</span>
<a href="#l65.25"></a><span id="l65.25">  * @param tblData       The table data object to apply the operation on.</span>
<a href="#l65.26"></a><span id="l65.26">  * @param tblName       The table name to delete on</span>
<a href="#l65.27"></a><span id="l65.27">  * @param colNameArray  An array of colum names to delete</span>
<a href="#l65.28"></a><span id="l65.28">  * @param db            (optional) The database to apply the operation on</span>
<a href="#l65.29"></a><span id="l65.29">  */</span>
<a href="#l65.30"></a><span id="l65.30"> function deleteColumns(tblData, tblName, colNameArray, db) {</span>
<a href="#l65.31"></a><span id="l65.31" class="difflineminus">-    for each (let colName in colNameArray) {</span>
<a href="#l65.32"></a><span id="l65.32" class="difflineplus">+    for (let colName of colNameArray) {</span>
<a href="#l65.33"></a><span id="l65.33">         delete tblData[tblName][colName];</span>
<a href="#l65.34"></a><span id="l65.34">     }</span>
<a href="#l65.35"></a><span id="l65.35"> </span>
<a href="#l65.36"></a><span id="l65.36">     let columns = [ k for (k in tblData[tblName]) ];</span>
<a href="#l65.37"></a><span id="l65.37">     executeSimpleSQL(db, getSql(tblName, tblData, tblName + &quot;_temp&quot;));</span>
<a href="#l65.38"></a><span id="l65.38">     executeSimpleSQL(db, &quot;INSERT INTO &quot; + tblName + &quot;_temp&quot; +</span>
<a href="#l65.39"></a><span id="l65.39">                          &quot;  (&quot; + columns.join(&quot;,&quot;) + &quot;) &quot; +</span>
<a href="#l65.40"></a><span id="l65.40">                          &quot;SELECT &quot; + columns.join(&quot;,&quot;) +</span>
<a href="#l65.41"></a><span id="l65.41" class="difflineat">@@ -506,17 +506,17 @@ function copyTable(tblData, tblName, new</span>
<a href="#l65.42"></a><span id="l65.42">  *</span>
<a href="#l65.43"></a><span id="l65.43">  * @param tblData       The table data object to apply the operation on.</span>
<a href="#l65.44"></a><span id="l65.44">  * @param tblName       The table name to alter</span>
<a href="#l65.45"></a><span id="l65.45">  * @param colNameArray  An array of colum names to delete</span>
<a href="#l65.46"></a><span id="l65.46">  * @param newType       The new type of the column</span>
<a href="#l65.47"></a><span id="l65.47">  * @param db            (optional) The database to apply the operation on</span>
<a href="#l65.48"></a><span id="l65.48">  */</span>
<a href="#l65.49"></a><span id="l65.49"> function alterTypes(tblData, tblName, colNameArray, newType, db) {</span>
<a href="#l65.50"></a><span id="l65.50" class="difflineminus">-    for each (let colName in colNameArray) {</span>
<a href="#l65.51"></a><span id="l65.51" class="difflineplus">+    for (let colName of colNameArray) {</span>
<a href="#l65.52"></a><span id="l65.52">         tblData[tblName][colName] = newType;</span>
<a href="#l65.53"></a><span id="l65.53">     }</span>
<a href="#l65.54"></a><span id="l65.54"> </span>
<a href="#l65.55"></a><span id="l65.55">     let columns = [ k for (k in tblData[tblName]) ];</span>
<a href="#l65.56"></a><span id="l65.56">     executeSimpleSQL(db, getSql(tblName, tblData, tblName + &quot;_temp&quot;));</span>
<a href="#l65.57"></a><span id="l65.57">     executeSimpleSQL(db, &quot;INSERT INTO &quot; + tblName + &quot;_temp&quot; +</span>
<a href="#l65.58"></a><span id="l65.58">                          &quot;  (&quot; + columns.join(&quot;,&quot;) + &quot;) &quot; +</span>
<a href="#l65.59"></a><span id="l65.59">                          &quot;SELECT &quot; + columns.join(&quot;,&quot;) +</span>
<a href="#l65.60"></a><span id="l65.60" class="difflineat">@@ -804,17 +804,17 @@ upgrade.v3 = function upgrade_v3(db, ver</span>
<a href="#l65.61"></a><span id="l65.61">  * r=shaver,p=vlad</span>
<a href="#l65.62"></a><span id="l65.62">  */</span>
<a href="#l65.63"></a><span id="l65.63"> upgrade.v4 = function upgrade_v4(db, version) {</span>
<a href="#l65.64"></a><span id="l65.64">     let tbl = upgrade.v3(version &lt; 3 &amp;&amp; db, version);</span>
<a href="#l65.65"></a><span id="l65.65">     LOGdb(db, &quot;Storage: Upgrading to v4&quot;);</span>
<a href="#l65.66"></a><span id="l65.66"> </span>
<a href="#l65.67"></a><span id="l65.67">     beginTransaction(db);</span>
<a href="#l65.68"></a><span id="l65.68">     try {</span>
<a href="#l65.69"></a><span id="l65.69" class="difflineminus">-        for each (let tblid in [&quot;events&quot;, &quot;todos&quot;, &quot;attendees&quot;, &quot;properties&quot;]) {</span>
<a href="#l65.70"></a><span id="l65.70" class="difflineplus">+        for (let tblid of [&quot;events&quot;, &quot;todos&quot;, &quot;attendees&quot;, &quot;properties&quot;]) {</span>
<a href="#l65.71"></a><span id="l65.71">             addColumn(tbl, &quot;cal_&quot; + tblid, &quot;recurrence_id&quot;, &quot;INTEGER&quot;, db);</span>
<a href="#l65.72"></a><span id="l65.72">             addColumn(tbl, &quot;cal_&quot; + tblid, &quot;recurrence_id_tz&quot;, &quot;VARCHAR&quot;, db);</span>
<a href="#l65.73"></a><span id="l65.73">         }</span>
<a href="#l65.74"></a><span id="l65.74">         setDbVersionAndCommit(db, 4);</span>
<a href="#l65.75"></a><span id="l65.75">     } catch (e) {</span>
<a href="#l65.76"></a><span id="l65.76">         throw reportErrorAndRollback(db, e);</span>
<a href="#l65.77"></a><span id="l65.77">     }</span>
<a href="#l65.78"></a><span id="l65.78"> </span>
<a href="#l65.79"></a><span id="l65.79" class="difflineat">@@ -827,17 +827,17 @@ upgrade.v4 = function upgrade_v4(db, ver</span>
<a href="#l65.80"></a><span id="l65.80">  * r=dmose, p=jminta</span>
<a href="#l65.81"></a><span id="l65.81">  */</span>
<a href="#l65.82"></a><span id="l65.82"> upgrade.v5 = function upgrade_v5(db, version) {</span>
<a href="#l65.83"></a><span id="l65.83">     let tbl = upgrade.v4(version &lt; 4 &amp;&amp; db, version);</span>
<a href="#l65.84"></a><span id="l65.84">     LOGdb(db, &quot;Storage: Upgrading to v5&quot;);</span>
<a href="#l65.85"></a><span id="l65.85"> </span>
<a href="#l65.86"></a><span id="l65.86">     beginTransaction(db);</span>
<a href="#l65.87"></a><span id="l65.87">     try {</span>
<a href="#l65.88"></a><span id="l65.88" class="difflineminus">-        for each (let tblid in [&quot;events&quot;, &quot;todos&quot;]) {</span>
<a href="#l65.89"></a><span id="l65.89" class="difflineplus">+        for (let tblid of [&quot;events&quot;, &quot;todos&quot;]) {</span>
<a href="#l65.90"></a><span id="l65.90">             addColumn(tbl, &quot;cal_&quot; + tblid, &quot;alarm_offset&quot;, &quot;INTEGER&quot;, db);</span>
<a href="#l65.91"></a><span id="l65.91">             addColumn(tbl, &quot;cal_&quot; + tblid, &quot;alarm_related&quot;, &quot;INTEGER&quot;, db);</span>
<a href="#l65.92"></a><span id="l65.92">             addColumn(tbl, &quot;cal_&quot; + tblid, &quot;alarm_last_ack&quot;, &quot;INTEGER&quot;, db);</span>
<a href="#l65.93"></a><span id="l65.93">         }</span>
<a href="#l65.94"></a><span id="l65.94">         setDbVersionAndCommit(db, 5);</span>
<a href="#l65.95"></a><span id="l65.95">     } catch (e) {</span>
<a href="#l65.96"></a><span id="l65.96">         throw reportErrorAndRollback(db, e);</span>
<a href="#l65.97"></a><span id="l65.97">     }</span>
<a href="#l65.98"></a><span id="l65.98" class="difflineat">@@ -998,32 +998,32 @@ upgrade.v13 = function upgrade_v13(db, v</span>
<a href="#l65.99"></a><span id="l65.99">     LOGdb(db, &quot;Storage: Upgrading to v13&quot;);</span>
<a href="#l65.100"></a><span id="l65.100"> </span>
<a href="#l65.101"></a><span id="l65.101">     beginTransaction(db);</span>
<a href="#l65.102"></a><span id="l65.102">     try {</span>
<a href="#l65.103"></a><span id="l65.103">         alterTypes(tbl, &quot;cal_metadata&quot;, [&quot;item_id&quot;], &quot;TEXT&quot;, db);</span>
<a href="#l65.104"></a><span id="l65.104"> </span>
<a href="#l65.105"></a><span id="l65.105">         let calIds = {};</span>
<a href="#l65.106"></a><span id="l65.106">         if (db) {</span>
<a href="#l65.107"></a><span id="l65.107" class="difflineminus">-            for each (let itemTable in [&quot;events&quot;, &quot;todos&quot;]) {</span>
<a href="#l65.108"></a><span id="l65.108" class="difflineplus">+            for (let itemTable of [&quot;events&quot;, &quot;todos&quot;]) {</span>
<a href="#l65.109"></a><span id="l65.109">                 let stmt = createStatement(db,</span>
<a href="#l65.110"></a><span id="l65.110">                                            &quot;SELECT id, cal_id FROM cal_&quot; + itemTable);</span>
<a href="#l65.111"></a><span id="l65.111">                 try {</span>
<a href="#l65.112"></a><span id="l65.112">                     while (stmt.executeStep()) {</span>
<a href="#l65.113"></a><span id="l65.113">                         calIds[stmt.row.id] = stmt.row.cal_id;</span>
<a href="#l65.114"></a><span id="l65.114">                     }</span>
<a href="#l65.115"></a><span id="l65.115">                 }</span>
<a href="#l65.116"></a><span id="l65.116">                 finally {</span>
<a href="#l65.117"></a><span id="l65.117">                     stmt.reset();</span>
<a href="#l65.118"></a><span id="l65.118">                 }</span>
<a href="#l65.119"></a><span id="l65.119">             }</span>
<a href="#l65.120"></a><span id="l65.120">         }</span>
<a href="#l65.121"></a><span id="l65.121"> </span>
<a href="#l65.122"></a><span id="l65.122" class="difflineminus">-        for each (let tblid in [&quot;attendees&quot;, &quot;recurrence&quot;, &quot;properties&quot;,</span>
<a href="#l65.123"></a><span id="l65.123" class="difflineminus">-                                &quot;attachments&quot;]) {</span>
<a href="#l65.124"></a><span id="l65.124" class="difflineplus">+        for (let tblid of [&quot;attendees&quot;, &quot;recurrence&quot;, &quot;properties&quot;,</span>
<a href="#l65.125"></a><span id="l65.125" class="difflineplus">+                           &quot;attachments&quot;]) {</span>
<a href="#l65.126"></a><span id="l65.126">             addColumn(tbl, &quot;cal_&quot; + tblid, &quot;cal_id&quot;, &quot;INTEGER&quot;, db);</span>
<a href="#l65.127"></a><span id="l65.127"> </span>
<a href="#l65.128"></a><span id="l65.128">             for (let itemId in calIds) {</span>
<a href="#l65.129"></a><span id="l65.129">                 executeSimpleSQL(db, &quot;UPDATE cal_&quot; + tblid +</span>
<a href="#l65.130"></a><span id="l65.130">                                      &quot;   SET cal_id = &quot; + calIds[itemId] +</span>
<a href="#l65.131"></a><span id="l65.131">                                      &quot; WHERE item_id = '&quot; + itemId + &quot;'&quot;);</span>
<a href="#l65.132"></a><span id="l65.132">             }</span>
<a href="#l65.133"></a><span id="l65.133">         }</span>
<a href="#l65.134"></a><span id="l65.134" class="difflineat">@@ -1180,17 +1180,17 @@ upgrade.v16 = function upgrade_v16(db, v</span>
<a href="#l65.135"></a><span id="l65.135">                              &quot;     FROM cal_alarms &quot; +</span>
<a href="#l65.136"></a><span id="l65.136">                              &quot;     WHERE cal_alarms.cal_id = cal_todos.cal_id)&quot;);</span>
<a href="#l65.137"></a><span id="l65.137"> </span>
<a href="#l65.138"></a><span id="l65.138">         // Remote obsolete columns</span>
<a href="#l65.139"></a><span id="l65.139">         let cols = [&quot;alarm_time&quot;,</span>
<a href="#l65.140"></a><span id="l65.140">                     &quot;alarm_time_tz&quot;,</span>
<a href="#l65.141"></a><span id="l65.141">                     &quot;alarm_offset&quot;,</span>
<a href="#l65.142"></a><span id="l65.142">                     &quot;alarm_related&quot;];</span>
<a href="#l65.143"></a><span id="l65.143" class="difflineminus">-        for each (let tblid in [&quot;events&quot;, &quot;todos&quot;]) {</span>
<a href="#l65.144"></a><span id="l65.144" class="difflineplus">+        for (let tblid of [&quot;events&quot;, &quot;todos&quot;]) {</span>
<a href="#l65.145"></a><span id="l65.145">             deleteColumns(tbl, &quot;cal_&quot; + tblid, cols, db);</span>
<a href="#l65.146"></a><span id="l65.146">         }</span>
<a href="#l65.147"></a><span id="l65.147"> </span>
<a href="#l65.148"></a><span id="l65.148">         setDbVersionAndCommit(db, 16);</span>
<a href="#l65.149"></a><span id="l65.149">     } catch (e) {</span>
<a href="#l65.150"></a><span id="l65.150">         throw reportErrorAndRollback(db, e);</span>
<a href="#l65.151"></a><span id="l65.151">     }</span>
<a href="#l65.152"></a><span id="l65.152"> </span>
<a href="#l65.153"></a><span id="l65.153" class="difflineat">@@ -1207,17 +1207,17 @@ upgrade.v16 = function upgrade_v16(db, v</span>
<a href="#l65.154"></a><span id="l65.154">  * Therefore all this upgrader does is handle users of 1.0pre before the</span>
<a href="#l65.155"></a><span id="l65.155">  * mentioned bug.</span>
<a href="#l65.156"></a><span id="l65.156">  */</span>
<a href="#l65.157"></a><span id="l65.157"> upgrade.v17 = function upgrade_v17(db, version) {</span>
<a href="#l65.158"></a><span id="l65.158">     let tbl = upgrade.v16(version &lt; 16 &amp;&amp; db, version);</span>
<a href="#l65.159"></a><span id="l65.159">     LOGdb(db, &quot;Storage: Upgrading to v17&quot;);</span>
<a href="#l65.160"></a><span id="l65.160">     beginTransaction(db);</span>
<a href="#l65.161"></a><span id="l65.161">     try {</span>
<a href="#l65.162"></a><span id="l65.162" class="difflineminus">-        for each (let tblName in [&quot;alarms&quot;, &quot;relations&quot;, &quot;attachments&quot;]) {</span>
<a href="#l65.163"></a><span id="l65.163" class="difflineplus">+        for (let tblName of [&quot;alarms&quot;, &quot;relations&quot;, &quot;attachments&quot;]) {</span>
<a href="#l65.164"></a><span id="l65.164">             let hasColumns = true;</span>
<a href="#l65.165"></a><span id="l65.165">             let stmt;</span>
<a href="#l65.166"></a><span id="l65.166">             try {</span>
<a href="#l65.167"></a><span id="l65.167">                 // Stepping this statement will fail if the columns don't exist.</span>
<a href="#l65.168"></a><span id="l65.168">                 // We don't use the delegate here since it would show an error to</span>
<a href="#l65.169"></a><span id="l65.169">                 // the user, even through we expect the error. If the db is null,</span>
<a href="#l65.170"></a><span id="l65.170">                 // then swallowing the error is ok too since the cols will</span>
<a href="#l65.171"></a><span id="l65.171">                 // already be added in v16.</span>
<a href="#l65.172"></a><span id="l65.172" class="difflineat">@@ -1279,22 +1279,22 @@ upgrade.v18 = function upgrade_v18(db, v</span>
<a href="#l65.173"></a><span id="l65.173">     LOGdb(db, &quot;Storage: Upgrading to v18&quot;);</span>
<a href="#l65.174"></a><span id="l65.174">     beginTransaction(db);</span>
<a href="#l65.175"></a><span id="l65.175">     try {</span>
<a href="#l65.176"></a><span id="l65.176">         // These fields are often indexed over</span>
<a href="#l65.177"></a><span id="l65.177">         let simpleIds = [&quot;cal_id&quot;, &quot;item_id&quot;];</span>
<a href="#l65.178"></a><span id="l65.178">         let allIds = simpleIds.concat([&quot;recurrence_id&quot;, &quot;recurrence_id_tz&quot;]);</span>
<a href="#l65.179"></a><span id="l65.179"> </span>
<a href="#l65.180"></a><span id="l65.180">         // Alarms, Attachments, Attendees, Relations</span>
<a href="#l65.181"></a><span id="l65.181" class="difflineminus">-        for each (let tblName in [&quot;alarms&quot;, &quot;attachments&quot;, &quot;attendees&quot;, &quot;relations&quot;]) {</span>
<a href="#l65.182"></a><span id="l65.182" class="difflineplus">+        for (let tblName of [&quot;alarms&quot;, &quot;attachments&quot;, &quot;attendees&quot;, &quot;relations&quot;]) {</span>
<a href="#l65.183"></a><span id="l65.183">             createIndex(tbl, &quot;cal_&quot; + tblName, allIds, db);</span>
<a href="#l65.184"></a><span id="l65.184">         }</span>
<a href="#l65.185"></a><span id="l65.185"> </span>
<a href="#l65.186"></a><span id="l65.186">         // Events and Tasks</span>
<a href="#l65.187"></a><span id="l65.187" class="difflineminus">-        for each (let tblName in [&quot;events&quot;, &quot;todos&quot;]) {</span>
<a href="#l65.188"></a><span id="l65.188" class="difflineplus">+        for (let tblName of [&quot;events&quot;, &quot;todos&quot;]) {</span>
<a href="#l65.189"></a><span id="l65.189">             createIndex(tbl, &quot;cal_&quot; + tblName, [&quot;flags&quot;, &quot;cal_id&quot;, &quot;recurrence_id&quot;], db);</span>
<a href="#l65.190"></a><span id="l65.190">             createIndex(tbl, &quot;cal_&quot; + tblName, [&quot;id&quot;, &quot;cal_id&quot;, &quot;recurrence_id&quot;], db);</span>
<a href="#l65.191"></a><span id="l65.191">         }</span>
<a href="#l65.192"></a><span id="l65.192"> </span>
<a href="#l65.193"></a><span id="l65.193">         // Metadata</span>
<a href="#l65.194"></a><span id="l65.194">         createIndex(tbl, &quot;cal_metadata&quot;, simpleIds, db);</span>
<a href="#l65.195"></a><span id="l65.195"> </span>
<a href="#l65.196"></a><span id="l65.196">         // Properties. Remove the index we used to create first, since our index</span>
<a href="#l65.197"></a><span id="l65.197" class="difflineat">@@ -1319,21 +1319,21 @@ upgrade.v18 = function upgrade_v18(db, v</span>
<a href="#l65.198"></a><span id="l65.198">  * r=simon.at.orcl, p=philipp,dbo</span>
<a href="#l65.199"></a><span id="l65.199">  */</span>
<a href="#l65.200"></a><span id="l65.200"> upgrade.v19 = function upgrade_v19(db, version) {</span>
<a href="#l65.201"></a><span id="l65.201">     let tbl = upgrade.v18(version &lt; 18 &amp;&amp; db, version);</span>
<a href="#l65.202"></a><span id="l65.202">     LOGdb(db, &quot;Storage: Upgrading to v19&quot;);</span>
<a href="#l65.203"></a><span id="l65.203">     beginTransaction(db);</span>
<a href="#l65.204"></a><span id="l65.204">     try {</span>
<a href="#l65.205"></a><span id="l65.205">         // Change types of column to TEXT.</span>
<a href="#l65.206"></a><span id="l65.206" class="difflineminus">-        for each (let tblName in [&quot;cal_alarms&quot;, &quot;cal_attachments&quot;,</span>
<a href="#l65.207"></a><span id="l65.207" class="difflineminus">-                                  &quot;cal_attendees&quot;, &quot;cal_events&quot;,</span>
<a href="#l65.208"></a><span id="l65.208" class="difflineminus">-                                  &quot;cal_metadata&quot;, &quot;cal_properties&quot;,</span>
<a href="#l65.209"></a><span id="l65.209" class="difflineminus">-                                  &quot;cal_recurrence&quot;, &quot;cal_relations&quot;,</span>
<a href="#l65.210"></a><span id="l65.210" class="difflineminus">-                                  &quot;cal_todos&quot;]) {</span>
<a href="#l65.211"></a><span id="l65.211" class="difflineplus">+        for (let tblName of [&quot;cal_alarms&quot;, &quot;cal_attachments&quot;,</span>
<a href="#l65.212"></a><span id="l65.212" class="difflineplus">+                             &quot;cal_attendees&quot;, &quot;cal_events&quot;,</span>
<a href="#l65.213"></a><span id="l65.213" class="difflineplus">+                             &quot;cal_metadata&quot;, &quot;cal_properties&quot;,</span>
<a href="#l65.214"></a><span id="l65.214" class="difflineplus">+                             &quot;cal_recurrence&quot;, &quot;cal_relations&quot;,</span>
<a href="#l65.215"></a><span id="l65.215" class="difflineplus">+                             &quot;cal_todos&quot;]) {</span>
<a href="#l65.216"></a><span id="l65.216">             alterTypes(tbl, tblName, [&quot;cal_id&quot;], &quot;TEXT&quot;, db);</span>
<a href="#l65.217"></a><span id="l65.217">         }</span>
<a href="#l65.218"></a><span id="l65.218">         setDbVersionAndCommit(db, 19);</span>
<a href="#l65.219"></a><span id="l65.219">     } catch (e) {</span>
<a href="#l65.220"></a><span id="l65.220">         throw reportErrorAndRollback(db, e);</span>
<a href="#l65.221"></a><span id="l65.221">     }</span>
<a href="#l65.222"></a><span id="l65.222"> </span>
<a href="#l65.223"></a><span id="l65.223">     return tbl;</span>
<a href="#l65.224"></a><span id="l65.224" class="difflineat">@@ -1345,17 +1345,17 @@ upgrade.v19 = function upgrade_v19(db, v</span>
<a href="#l65.225"></a><span id="l65.225">  * r=philipp, p=redDragon</span>
<a href="#l65.226"></a><span id="l65.226">  */</span>
<a href="#l65.227"></a><span id="l65.227"> upgrade.v20 = function upgrade_v20(db, version) {</span>
<a href="#l65.228"></a><span id="l65.228">     let tbl = upgrade.v19(version &lt; 19 &amp;&amp; db, version);</span>
<a href="#l65.229"></a><span id="l65.229">     LOGdb(db, &quot;Storage: Upgrading to v20&quot;);</span>
<a href="#l65.230"></a><span id="l65.230">     beginTransaction(db);</span>
<a href="#l65.231"></a><span id="l65.231">     try {</span>
<a href="#l65.232"></a><span id="l65.232">         //Adding a offline_journal column</span>
<a href="#l65.233"></a><span id="l65.233" class="difflineminus">-        for each (let tblName in [&quot;cal_events&quot;, &quot;cal_todos&quot;]) {</span>
<a href="#l65.234"></a><span id="l65.234" class="difflineplus">+        for (let tblName of [&quot;cal_events&quot;, &quot;cal_todos&quot;]) {</span>
<a href="#l65.235"></a><span id="l65.235">             addColumn(tbl, tblName, [&quot;offline_journal&quot;], &quot;INTEGER&quot;, db);</span>
<a href="#l65.236"></a><span id="l65.236">         }</span>
<a href="#l65.237"></a><span id="l65.237">         setDbVersionAndCommit(db, 20);</span>
<a href="#l65.238"></a><span id="l65.238">     } catch (e) {</span>
<a href="#l65.239"></a><span id="l65.239">         throw reportErrorAndRollback(db,e);</span>
<a href="#l65.240"></a><span id="l65.240">     }</span>
<a href="#l65.241"></a><span id="l65.241">     return tbl;</span>
<a href="#l65.242"></a><span id="l65.242"> }</span>
<a href="#l65.243"></a><span id="l65.243" class="difflineat">@@ -1499,17 +1499,17 @@ upgrade.v22 = function upgrade_v22(db, v</span>
<a href="#l65.244"></a><span id="l65.244">                     if (aRsvp === 1) attendee.rsvp = &quot;TRUE&quot;;</span>
<a href="#l65.245"></a><span id="l65.245">                     // default: keep undefined</span>
<a href="#l65.246"></a><span id="l65.246"> </span>
<a href="#l65.247"></a><span id="l65.247">                     attendee.role = aRole;</span>
<a href="#l65.248"></a><span id="l65.248">                     attendee.participationStatus = aStatus;</span>
<a href="#l65.249"></a><span id="l65.249">                     attendee.userType = aType;</span>
<a href="#l65.250"></a><span id="l65.250">                     attendee.isOrganizer = !!aIsOrganizer;</span>
<a href="#l65.251"></a><span id="l65.251">                     if (aProperties) {</span>
<a href="#l65.252"></a><span id="l65.252" class="difflineminus">-                        for each (let pair in aProperties.split(&quot;,&quot;)) {</span>
<a href="#l65.253"></a><span id="l65.253" class="difflineplus">+                        for (let pair of aProperties.split(&quot;,&quot;)) {</span>
<a href="#l65.254"></a><span id="l65.254">                             let [key, value] = pair.split(&quot;:&quot;);</span>
<a href="#l65.255"></a><span id="l65.255">                             attendee.setProperty(decodeURIComponent(key),</span>
<a href="#l65.256"></a><span id="l65.256">                                                  decodeURIComponent(value));</span>
<a href="#l65.257"></a><span id="l65.257">                         }</span>
<a href="#l65.258"></a><span id="l65.258">                     }</span>
<a href="#l65.259"></a><span id="l65.259"> </span>
<a href="#l65.260"></a><span id="l65.260">                     return attendee.icalString;</span>
<a href="#l65.261"></a><span id="l65.261">                 } catch (e) {</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l66.1"></a><span id="l66.1" class="difflineminus">--- a/calendar/providers/wcap/calWcapCalendar.js</span>
<a href="#l66.2"></a><span id="l66.2" class="difflineplus">+++ b/calendar/providers/wcap/calWcapCalendar.js</span>
<a href="#l66.3"></a><span id="l66.3" class="difflineat">@@ -158,17 +158,17 @@ calWcapCalendar.prototype = {</span>
<a href="#l66.4"></a><span id="l66.4">     },</span>
<a href="#l66.5"></a><span id="l66.5"> </span>
<a href="#l66.6"></a><span id="l66.6">     setProperty: function calWcapCalendar_setProperty(aName, aValue) {</span>
<a href="#l66.7"></a><span id="l66.7">         switch (aName) {</span>
<a href="#l66.8"></a><span id="l66.8">             case &quot;disabled&quot;:</span>
<a href="#l66.9"></a><span id="l66.9">                 if (this.isDefaultCalendar) {</span>
<a href="#l66.10"></a><span id="l66.10">                     // disabling/enabling the default calendar will enable/disable all calendars</span>
<a href="#l66.11"></a><span id="l66.11">                     // belonging to the same session:</span>
<a href="#l66.12"></a><span id="l66.12" class="difflineminus">-                    for each (let calendar in this.session.getRegisteredCalendars()) {</span>
<a href="#l66.13"></a><span id="l66.13" class="difflineplus">+                    for (let calendar of this.session.getRegisteredCalendars()) {</span>
<a href="#l66.14"></a><span id="l66.14">                         if (!calendar.isDefaultCalendar) {</span>
<a href="#l66.15"></a><span id="l66.15">                             calendar.setProperty(&quot;disabled&quot;, aValue);</span>
<a href="#l66.16"></a><span id="l66.16">                         }</span>
<a href="#l66.17"></a><span id="l66.17">                     }</span>
<a href="#l66.18"></a><span id="l66.18">                 }</span>
<a href="#l66.19"></a><span id="l66.19">                 // fallthru intended</span>
<a href="#l66.20"></a><span id="l66.20">             default:</span>
<a href="#l66.21"></a><span id="l66.21">                 this.__proto__.__proto__.setProperty.apply(this, arguments);</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l67.1"></a><span id="l67.1" class="difflineminus">--- a/calendar/providers/wcap/calWcapCalendarItems.js</span>
<a href="#l67.2"></a><span id="l67.2" class="difflineplus">+++ b/calendar/providers/wcap/calWcapCalendarItems.js</span>
<a href="#l67.3"></a><span id="l67.3" class="difflineat">@@ -37,17 +37,17 @@ calWcapCalendar.prototype.getRecurrenceP</span>
<a href="#l67.4"></a><span id="l67.4"> function calWcapCalendar_getRecurrenceParams(item, out_rrules, out_rdates, out_exrules, out_exdates) {</span>
<a href="#l67.5"></a><span id="l67.5">     // recurrences:</span>
<a href="#l67.6"></a><span id="l67.6">     out_rrules.value = [];</span>
<a href="#l67.7"></a><span id="l67.7">     out_rdates.value = [];</span>
<a href="#l67.8"></a><span id="l67.8">     out_exrules.value = [];</span>
<a href="#l67.9"></a><span id="l67.9">     out_exdates.value = [];</span>
<a href="#l67.10"></a><span id="l67.10">     if (item.recurrenceInfo) {</span>
<a href="#l67.11"></a><span id="l67.11">         var rItems = item.recurrenceInfo.getRecurrenceItems({});</span>
<a href="#l67.12"></a><span id="l67.12" class="difflineminus">-        for each (var rItem in rItems) {</span>
<a href="#l67.13"></a><span id="l67.13" class="difflineplus">+        for (var rItem of rItems) {</span>
<a href="#l67.14"></a><span id="l67.14">             var isNeg = rItem.isNegative;</span>
<a href="#l67.15"></a><span id="l67.15">             let rRuleInstance = cal.wrapInstance(rItem, Components.interfaces.calIRecurrenceRule);</span>
<a href="#l67.16"></a><span id="l67.16">             let rDateInstance = cal.wrapInstance(rItem, Components.interfaces.calIRecurrenceDate);</span>
<a href="#l67.17"></a><span id="l67.17">             if (rRuleInstance) {</span>
<a href="#l67.18"></a><span id="l67.18">                 var rule = (&quot;\&quot;&quot; + encodeURIComponent(rRuleInstance.icalProperty.valueAsIcalString) + &quot;\&quot;&quot;);</span>
<a href="#l67.19"></a><span id="l67.19">                 if (isNeg) {</span>
<a href="#l67.20"></a><span id="l67.20">                     out_exrules.value.push(rule);</span>
<a href="#l67.21"></a><span id="l67.21">                 } else {</span>
<a href="#l67.22"></a><span id="l67.22" class="difflineat">@@ -179,17 +179,17 @@ function calWcapCalendar_getAlarmParams(</span>
<a href="#l67.23"></a><span id="l67.23"> </span>
<a href="#l67.24"></a><span id="l67.24"> // why ever, X-S1CS-EMAIL is unsupported though documented</span>
<a href="#l67.25"></a><span id="l67.25"> // for get_calprops... WTF.</span>
<a href="#l67.26"></a><span id="l67.26"> function getCalId(att) {</span>
<a href="#l67.27"></a><span id="l67.27">     return (att ? att.getProperty(&quot;X-S1CS-CALID&quot;) : null);</span>
<a href="#l67.28"></a><span id="l67.28"> }</span>
<a href="#l67.29"></a><span id="l67.29"> </span>
<a href="#l67.30"></a><span id="l67.30"> function getAttendeeByCalId(atts, calId) {</span>
<a href="#l67.31"></a><span id="l67.31" class="difflineminus">-    for each (var att in atts) {</span>
<a href="#l67.32"></a><span id="l67.32" class="difflineplus">+    for (var att of atts) {</span>
<a href="#l67.33"></a><span id="l67.33">         if (getCalId(att) == calId) {</span>
<a href="#l67.34"></a><span id="l67.34">             return att;</span>
<a href="#l67.35"></a><span id="l67.35">         }</span>
<a href="#l67.36"></a><span id="l67.36">     }</span>
<a href="#l67.37"></a><span id="l67.37">     return null;</span>
<a href="#l67.38"></a><span id="l67.38"> }</span>
<a href="#l67.39"></a><span id="l67.39"> </span>
<a href="#l67.40"></a><span id="l67.40"> calWcapCalendar.prototype.isInvitation =</span>
<a href="#l67.41"></a><span id="l67.41" class="difflineat">@@ -304,17 +304,17 @@ function calWcapCalendar_storeItem(bAddI</span>
<a href="#l67.42"></a><span id="l67.42">     function getPrivacy(item) {</span>
<a href="#l67.43"></a><span id="l67.43">         return ((item.privacy &amp;&amp; item.privacy != &quot;&quot;) ? item.privacy : &quot;PUBLIC&quot;);</span>
<a href="#l67.44"></a><span id="l67.44">     }</span>
<a href="#l67.45"></a><span id="l67.45">     function getAttachments(item) {</span>
<a href="#l67.46"></a><span id="l67.46">         var ret;</span>
<a href="#l67.47"></a><span id="l67.47">         var attachments = item.attachments;</span>
<a href="#l67.48"></a><span id="l67.48">         if (attachments) {</span>
<a href="#l67.49"></a><span id="l67.49">             var strings = [];</span>
<a href="#l67.50"></a><span id="l67.50" class="difflineminus">-            for each (var att in attachements) {</span>
<a href="#l67.51"></a><span id="l67.51" class="difflineplus">+            for (var att of attachments) {</span>
<a href="#l67.52"></a><span id="l67.52">                 let wrappedAtt = cal.wrapInstance(att, Components.interfaces.calIAttachment);</span>
<a href="#l67.53"></a><span id="l67.53">                 if (typeof(att) == &quot;string&quot;) {</span>
<a href="#l67.54"></a><span id="l67.54">                     strings.push(encodeURIComponent(att));</span>
<a href="#l67.55"></a><span id="l67.55">                 } else if (wrappedAtt &amp;&amp; wrappedAtt.uri) {</span>
<a href="#l67.56"></a><span id="l67.56">                     strings.push(encodeURIComponent(wrappedAtt.uri.spec));</span>
<a href="#l67.57"></a><span id="l67.57">                 } else { // xxx todo</span>
<a href="#l67.58"></a><span id="l67.58">                     logError(&quot;only URLs supported as attachment, not: &quot; + att, this_);</span>
<a href="#l67.59"></a><span id="l67.59">                 }</span>
<a href="#l67.60"></a><span id="l67.60" class="difflineat">@@ -927,17 +927,17 @@ calWcapCalendar.prototype.parseItems = f</span>
<a href="#l67.61"></a><span id="l67.61">                     item.makeImmutable();</span>
<a href="#l67.62"></a><span id="l67.62">                 }</span>
<a href="#l67.63"></a><span id="l67.63">                 items.push(item);</span>
<a href="#l67.64"></a><span id="l67.64">             }</span>
<a href="#l67.65"></a><span id="l67.65">         }</span>
<a href="#l67.66"></a><span id="l67.66">     }</span>
<a href="#l67.67"></a><span id="l67.67"> </span>
<a href="#l67.68"></a><span id="l67.68">     // tag &quot;exceptions&quot;, i.e. items with rid:</span>
<a href="#l67.69"></a><span id="l67.69" class="difflineminus">-    for each (let item in excItems) {</span>
<a href="#l67.70"></a><span id="l67.70" class="difflineplus">+    for (let item of excItems) {</span>
<a href="#l67.71"></a><span id="l67.71">         let parent = uid2parent[item.id];</span>
<a href="#l67.72"></a><span id="l67.72"> </span>
<a href="#l67.73"></a><span id="l67.73">         if (!parent) { // a parentless one, fake a master and override it's occurrence</span>
<a href="#l67.74"></a><span id="l67.74">             parent = isEvent(item) ? createEvent() : createTodo();</span>
<a href="#l67.75"></a><span id="l67.75">             parent.id = item.id;</span>
<a href="#l67.76"></a><span id="l67.76">             parent.calendar = this.superCalendar;</span>
<a href="#l67.77"></a><span id="l67.77">             parent.setProperty(&quot;DTSTART&quot;, item.recurrenceId);</span>
<a href="#l67.78"></a><span id="l67.78">             parent.setProperty(&quot;X-MOZ-FAKED-MASTER&quot;, &quot;1&quot;); // this tag might be useful in the future</span>
<a href="#l67.79"></a><span id="l67.79" class="difflineat">@@ -961,27 +961,27 @@ calWcapCalendar.prototype.parseItems = f</span>
<a href="#l67.80"></a><span id="l67.80">             rid.isDate = true;</span>
<a href="#l67.81"></a><span id="l67.81">             item.recurrenceId = rid;</span>
<a href="#l67.82"></a><span id="l67.82">         }</span>
<a href="#l67.83"></a><span id="l67.83"> </span>
<a href="#l67.84"></a><span id="l67.84">         parent.recurrenceInfo.modifyException(item, true);</span>
<a href="#l67.85"></a><span id="l67.85">     }</span>
<a href="#l67.86"></a><span id="l67.86"> </span>
<a href="#l67.87"></a><span id="l67.87">     if (itemFilter &amp; calICalendar.ITEM_FILTER_CLASS_OCCURRENCES) {</span>
<a href="#l67.88"></a><span id="l67.88" class="difflineminus">-        for each (let item in unexpandedItems) {</span>
<a href="#l67.89"></a><span id="l67.89" class="difflineplus">+        for (let item of unexpandedItems) {</span>
<a href="#l67.90"></a><span id="l67.90">             if (maxResults != 0 &amp;&amp; items.length &gt;= maxResults) {</span>
<a href="#l67.91"></a><span id="l67.91">                 break;</span>
<a href="#l67.92"></a><span id="l67.92">             }</span>
<a href="#l67.93"></a><span id="l67.93"> </span>
<a href="#l67.94"></a><span id="l67.94">             let recStartDate = item.recurrenceStartDate;</span>
<a href="#l67.95"></a><span id="l67.95">             if (recStartDate &amp;&amp; !recStartDate.isDate) {</span>
<a href="#l67.96"></a><span id="l67.96">                 recStartDate = null;</span>
<a href="#l67.97"></a><span id="l67.97">             }</span>
<a href="#l67.98"></a><span id="l67.98">             let recItems = item.recurrenceInfo.getRecurrenceItems({});</span>
<a href="#l67.99"></a><span id="l67.99" class="difflineminus">-            for each (let recItem in recItems) {</span>
<a href="#l67.100"></a><span id="l67.100" class="difflineplus">+            for (let recItem of recItems) {</span>
<a href="#l67.101"></a><span id="l67.101">                 // cs bug: workaround missing COUNT</span>
<a href="#l67.102"></a><span id="l67.102">                 let rRuleInstance = cal.wrapInstance(recItem, Components.interfaces.calIRecurrenceRule);</span>
<a href="#l67.103"></a><span id="l67.103">                 let rDateInstance = cal.wrapInstance(recItem, Components.interfaces.calIRecurrenceDate);</span>
<a href="#l67.104"></a><span id="l67.104">                 if (rRuleInstance) {</span>
<a href="#l67.105"></a><span id="l67.105">                     recItem = rRuleInstance;</span>
<a href="#l67.106"></a><span id="l67.106">                     if (!recItem.isFinite &amp;&amp; !recItem.isNegative) {</span>
<a href="#l67.107"></a><span id="l67.107">                         recItem.count = recurrenceBound;</span>
<a href="#l67.108"></a><span id="l67.108">                     }</span>
<a href="#l67.109"></a><span id="l67.109" class="difflineat">@@ -1001,37 +1001,37 @@ calWcapCalendar.prototype.parseItems = f</span>
<a href="#l67.110"></a><span id="l67.110">             }</span>
<a href="#l67.111"></a><span id="l67.111">             let occurrences = item.recurrenceInfo.getOccurrences(rangeStart, rangeEnd,</span>
<a href="#l67.112"></a><span id="l67.112">                                                                  maxResults == 0 ? 0 : maxResults - items.length,</span>
<a href="#l67.113"></a><span id="l67.113">                                                                  {});</span>
<a href="#l67.114"></a><span id="l67.114">             if (LOG_LEVEL &gt; 1) {</span>
<a href="#l67.115"></a><span id="l67.115">                 log(&quot;item: &quot; + item.title + &quot; has &quot; + occurrences.length.toString() + &quot; occurrences.&quot;, this);</span>
<a href="#l67.116"></a><span id="l67.116">                 if (LOG_LEVEL &gt; 2) {</span>
<a href="#l67.117"></a><span id="l67.117">                     log(&quot;master item: &quot; + item.title + &quot;\n&quot; + item.icalString, this);</span>
<a href="#l67.118"></a><span id="l67.118" class="difflineminus">-                    for each (let occ in occurrences) {</span>
<a href="#l67.119"></a><span id="l67.119" class="difflineplus">+                    for (let occ of occurrences) {</span>
<a href="#l67.120"></a><span id="l67.120">                         log(&quot;item: &quot; + occ.title + &quot;\n&quot; + occ.icalString, this);</span>
<a href="#l67.121"></a><span id="l67.121">                     }</span>
<a href="#l67.122"></a><span id="l67.122">                 }</span>
<a href="#l67.123"></a><span id="l67.123">             }</span>
<a href="#l67.124"></a><span id="l67.124">             // only proxies returned:</span>
<a href="#l67.125"></a><span id="l67.125">             items = items.concat(occurrences);</span>
<a href="#l67.126"></a><span id="l67.126">         }</span>
<a href="#l67.127"></a><span id="l67.127"> </span>
<a href="#l67.128"></a><span id="l67.128">     } else {</span>
<a href="#l67.129"></a><span id="l67.129">         if (maxResults != 0 &amp;&amp;</span>
<a href="#l67.130"></a><span id="l67.130">             (items.length + unexpandedItems.length) &gt; maxResults) {</span>
<a href="#l67.131"></a><span id="l67.131">             unexpandedItems.length = (maxResults - items.length);</span>
<a href="#l67.132"></a><span id="l67.132">         }</span>
<a href="#l67.133"></a><span id="l67.133">         if (!bLeaveMutable) {</span>
<a href="#l67.134"></a><span id="l67.134" class="difflineminus">-            for each (let item in unexpandedItems) {</span>
<a href="#l67.135"></a><span id="l67.135" class="difflineplus">+            for (let item of unexpandedItems) {</span>
<a href="#l67.136"></a><span id="l67.136">                 item.makeImmutable();</span>
<a href="#l67.137"></a><span id="l67.137">             }</span>
<a href="#l67.138"></a><span id="l67.138">         }</span>
<a href="#l67.139"></a><span id="l67.139">         if (LOG_LEVEL &gt; 2) {</span>
<a href="#l67.140"></a><span id="l67.140" class="difflineminus">-            for each (let item in unexpandedItems) {</span>
<a href="#l67.141"></a><span id="l67.141" class="difflineplus">+            for (let item of unexpandedItems) {</span>
<a href="#l67.142"></a><span id="l67.142">                 log(&quot;item: &quot; + item.title + &quot;\n&quot; + item.icalString, this);</span>
<a href="#l67.143"></a><span id="l67.143">             }</span>
<a href="#l67.144"></a><span id="l67.144">         }</span>
<a href="#l67.145"></a><span id="l67.145">         items = items.concat(unexpandedItems);</span>
<a href="#l67.146"></a><span id="l67.146">     }</span>
<a href="#l67.147"></a><span id="l67.147"> </span>
<a href="#l67.148"></a><span id="l67.148">     if (LOG_LEVEL &gt; 1) {</span>
<a href="#l67.149"></a><span id="l67.149">         log(&quot;parseItems(): returning &quot; + items.length + &quot; items&quot;, this);</span>
<a href="#l67.150"></a><span id="l67.150" class="difflineat">@@ -1176,17 +1176,17 @@ function calWcapCalendar_getItems(itemFi</span>
<a href="#l67.151"></a><span id="l67.151">     // m_cachedResults holds the last data revtrieval. This is expecially useful when</span>
<a href="#l67.152"></a><span id="l67.152">     // switching on multiple subcriptions: the composite calendar multiplexes getItems()</span>
<a href="#l67.153"></a><span id="l67.153">     // calls to all composited calendars over and over again, most often on the same</span>
<a href="#l67.154"></a><span id="l67.154">     // date range (as the user usually looks at the same view).</span>
<a href="#l67.155"></a><span id="l67.155">     // This will most likely vanish when a better caching is implemented in the views,</span>
<a href="#l67.156"></a><span id="l67.156">     // or WCAP local storage caching has sufficient performance.</span>
<a href="#l67.157"></a><span id="l67.157">     // The cached results will be invalidated after 2 minutes to reflect incoming invitations.</span>
<a href="#l67.158"></a><span id="l67.158">     if (CACHE_LAST_RESULTS &gt; 0 &amp;&amp; this.m_cachedResults) {</span>
<a href="#l67.159"></a><span id="l67.159" class="difflineminus">-        for each (var entry in this.m_cachedResults) {</span>
<a href="#l67.160"></a><span id="l67.160" class="difflineplus">+        for (var entry of this.m_cachedResults) {</span>
<a href="#l67.161"></a><span id="l67.161">             if ((itemFilter == entry.itemFilter) &amp;&amp;</span>
<a href="#l67.162"></a><span id="l67.162">                 equalDatetimes(rangeStart, entry.rangeStart) &amp;&amp;</span>
<a href="#l67.163"></a><span id="l67.163">                 equalDatetimes(rangeEnd, entry.rangeEnd)) {</span>
<a href="#l67.164"></a><span id="l67.164">                 log(&quot;reusing last getItems() cached data.&quot;, this);</span>
<a href="#l67.165"></a><span id="l67.165">                 if (listener) {</span>
<a href="#l67.166"></a><span id="l67.166">                     listener.onGetResult(</span>
<a href="#l67.167"></a><span id="l67.167">                         this.superCalendar, NS_OK, calIItemBase,</span>
<a href="#l67.168"></a><span id="l67.168">                         &quot;getItems()&quot;, entry.results.length, entry.results);</span>
<a href="#l67.169"></a><span id="l67.169" class="difflineat">@@ -1218,17 +1218,17 @@ function calWcapCalendar_getItems(itemFi</span>
<a href="#l67.170"></a><span id="l67.170">                             rangeStart &amp;&amp; rangeEnd) {</span>
<a href="#l67.171"></a><span id="l67.171"> </span>
<a href="#l67.172"></a><span id="l67.172">                             var freeBusyListener = { // calIGenericOperationListener:</span>
<a href="#l67.173"></a><span id="l67.173">                                 onResult: function freeBusyListener_onResult(request, result) {</span>
<a href="#l67.174"></a><span id="l67.174">                                     if (!Components.isSuccessCode(request.status)) {</span>
<a href="#l67.175"></a><span id="l67.175">                                         throw request.status;</span>
<a href="#l67.176"></a><span id="l67.176">                                     }</span>
<a href="#l67.177"></a><span id="l67.177">                                     var items = [];</span>
<a href="#l67.178"></a><span id="l67.178" class="difflineminus">-                                    for each (var entry in result) {</span>
<a href="#l67.179"></a><span id="l67.179" class="difflineplus">+                                    for (var entry of result) {</span>
<a href="#l67.180"></a><span id="l67.180">                                         var item = createEvent();</span>
<a href="#l67.181"></a><span id="l67.181">                                         item.id = (g_busyPhantomItemUuidPrefix + getIcalUTC(entry.interval.start));</span>
<a href="#l67.182"></a><span id="l67.182">                                         item.calendar = this_.superCalendar;</span>
<a href="#l67.183"></a><span id="l67.183">                                         item.title = g_busyItemTitle;</span>
<a href="#l67.184"></a><span id="l67.184">                                         item.startDate = entry.interval.start;</span>
<a href="#l67.185"></a><span id="l67.185">                                         item.endDate = entry.interval.end;</span>
<a href="#l67.186"></a><span id="l67.186">                                         item.makeImmutable();</span>
<a href="#l67.187"></a><span id="l67.187">                                         items.push(item);</span>
<a href="#l67.188"></a><span id="l67.188" class="difflineat">@@ -1350,33 +1350,33 @@ function calWcapCalendar_replayChangesOn</span>
<a href="#l67.189"></a><span id="l67.189">                 if (!Components.isSuccessCode(status)) {</span>
<a href="#l67.190"></a><span id="l67.190">                     request.execRespFunc(status); // any error on writing breaks whole operation</span>
<a href="#l67.191"></a><span id="l67.191">                 }</span>
<a href="#l67.192"></a><span id="l67.192">             }</span>
<a href="#l67.193"></a><span id="l67.193">         };</span>
<a href="#l67.194"></a><span id="l67.194">         var request = new calWcapRequest(</span>
<a href="#l67.195"></a><span id="l67.195">             function netFinishedRespFunc(err, data) {</span>
<a href="#l67.196"></a><span id="l67.196">                 var modifiedIds = {};</span>
<a href="#l67.197"></a><span id="l67.197" class="difflineminus">-                for each (var item in request.m_modifiedItems) {</span>
<a href="#l67.198"></a><span id="l67.198" class="difflineplus">+                for (var item of request.m_modifiedItems) {</span>
<a href="#l67.199"></a><span id="l67.199">                     var dtCreated = item.getProperty(&quot;CREATED&quot;);</span>
<a href="#l67.200"></a><span id="l67.200">                     var bAdd = (!dtCreated || !dtFrom || dtCreated.compare(dtFrom) &gt;= 0);</span>
<a href="#l67.201"></a><span id="l67.201">                     modifiedIds[item.id] = true;</span>
<a href="#l67.202"></a><span id="l67.202">                     if (bAdd) {</span>
<a href="#l67.203"></a><span id="l67.203">                         log(&quot;replayChangesOn(): new item &quot; + item.id, this_);</span>
<a href="#l67.204"></a><span id="l67.204">                         if (this_.offlineStorage) {</span>
<a href="#l67.205"></a><span id="l67.205">                             this_.offlineStorage.addItem(item, writeListener);</span>
<a href="#l67.206"></a><span id="l67.206">                         }</span>
<a href="#l67.207"></a><span id="l67.207">                     } else {</span>
<a href="#l67.208"></a><span id="l67.208">                         log(&quot;replayChangesOn(): modified item &quot; + item.id, this_);</span>
<a href="#l67.209"></a><span id="l67.209">                         if (this_.offlineStorage) {</span>
<a href="#l67.210"></a><span id="l67.210">                             this_.modifyItem(item, null, writeListener);</span>
<a href="#l67.211"></a><span id="l67.211">                         }</span>
<a href="#l67.212"></a><span id="l67.212">                     }</span>
<a href="#l67.213"></a><span id="l67.213">                 }</span>
<a href="#l67.214"></a><span id="l67.214" class="difflineminus">-                for each (var item in request.m_deletedItems) {</span>
<a href="#l67.215"></a><span id="l67.215" class="difflineplus">+                for (var item of request.m_deletedItems) {</span>
<a href="#l67.216"></a><span id="l67.216">                     // don't delete anything that has been touched by lastmods:</span>
<a href="#l67.217"></a><span id="l67.217">                     if (modifiedIds[item.id]) {</span>
<a href="#l67.218"></a><span id="l67.218">                         log(&quot;replayChangesOn(): skipping deletion of &quot; + item.id, this_);</span>
<a href="#l67.219"></a><span id="l67.219">                     } else if (isParent(item)) {</span>
<a href="#l67.220"></a><span id="l67.220">                         log(&quot;replayChangesOn(): deleted item &quot; + item.id, this_);</span>
<a href="#l67.221"></a><span id="l67.221">                         if (this_.offlineStorage) {</span>
<a href="#l67.222"></a><span id="l67.222">                             this_.offlineStorage.deleteItem(item, writeListener);</span>
<a href="#l67.223"></a><span id="l67.223">                         }</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l68.1"></a><span id="l68.1" class="difflineminus">--- a/calendar/providers/wcap/calWcapRequest.js</span>
<a href="#l68.2"></a><span id="l68.2" class="difflineplus">+++ b/calendar/providers/wcap/calWcapRequest.js</span>
<a href="#l68.3"></a><span id="l68.3" class="difflineat">@@ -77,17 +77,17 @@ calWcapRequest.prototype = {</span>
<a href="#l68.4"></a><span id="l68.4">     },</span>
<a href="#l68.5"></a><span id="l68.5"> </span>
<a href="#l68.6"></a><span id="l68.6">     toString: function calWcapRequest_toString() {</span>
<a href="#l68.7"></a><span id="l68.7">         var ret = (&quot;calWcapRequest id=&quot; + this.id +</span>
<a href="#l68.8"></a><span id="l68.8">                    &quot;, parent-id=&quot; + (this.parentRequest ? this.parentRequest.id : &quot;&lt;none&gt;&quot;) +</span>
<a href="#l68.9"></a><span id="l68.9">                    &quot; (&quot; + this.m_logContext + &quot;)&quot;);</span>
<a href="#l68.10"></a><span id="l68.10">         if (LOG_LEVEL &gt; 2 &amp;&amp; this.m_attachedRequests.length &gt; 0) {</span>
<a href="#l68.11"></a><span id="l68.11">             ret += &quot;\nattached requests:&quot;;</span>
<a href="#l68.12"></a><span id="l68.12" class="difflineminus">-            for each (var req in this.m_attachedRequests) {</span>
<a href="#l68.13"></a><span id="l68.13" class="difflineplus">+            for (var req of this.m_attachedRequests) {</span>
<a href="#l68.14"></a><span id="l68.14">                 ret += (&quot;\n#&quot; + req.id + &quot;\t&quot; + req);</span>
<a href="#l68.15"></a><span id="l68.15">             }</span>
<a href="#l68.16"></a><span id="l68.16">         }</span>
<a href="#l68.17"></a><span id="l68.17">         ret += (&quot;, isPending=&quot; + this.isPending);</span>
<a href="#l68.18"></a><span id="l68.18">         ret += (&quot;, status=&quot; + errorToString(this.status));</span>
<a href="#l68.19"></a><span id="l68.19">         return ret;</span>
<a href="#l68.20"></a><span id="l68.20">     },</span>
<a href="#l68.21"></a><span id="l68.21"> </span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l69.1"></a><span id="l69.1" class="difflineminus">--- a/calendar/providers/wcap/calWcapSession.js</span>
<a href="#l69.2"></a><span id="l69.2" class="difflineplus">+++ b/calendar/providers/wcap/calWcapSession.js</span>
<a href="#l69.3"></a><span id="l69.3" class="difflineat">@@ -53,32 +53,32 @@ function getWcapSessionFor(calendar, uri</span>
<a href="#l69.4"></a><span id="l69.4">     let session = getWcapSessionFor.m_sessions[contextId];</span>
<a href="#l69.5"></a><span id="l69.5"> </span>
<a href="#l69.6"></a><span id="l69.6">     if (!session) {</span>
<a href="#l69.7"></a><span id="l69.7">         session = new calWcapSession(contextId);</span>
<a href="#l69.8"></a><span id="l69.8">         getWcapSessionFor.m_sessions[contextId] = session;</span>
<a href="#l69.9"></a><span id="l69.9"> </span>
<a href="#l69.10"></a><span id="l69.10">         let defaultCal = null;</span>
<a href="#l69.11"></a><span id="l69.11">         let registeredCalendars = session.getRegisteredCalendars();</span>
<a href="#l69.12"></a><span id="l69.12" class="difflineminus">-        for each (let regCal in registeredCalendars) {</span>
<a href="#l69.13"></a><span id="l69.13" class="difflineplus">+        for (let regCal of registeredCalendars) {</span>
<a href="#l69.14"></a><span id="l69.14">             if (regCal.isDefaultCalendar) {</span>
<a href="#l69.15"></a><span id="l69.15">                 defaultCal = regCal;</span>
<a href="#l69.16"></a><span id="l69.16">                 break;</span>
<a href="#l69.17"></a><span id="l69.17">             }</span>
<a href="#l69.18"></a><span id="l69.18">         }</span>
<a href="#l69.19"></a><span id="l69.19"> </span>
<a href="#l69.20"></a><span id="l69.20">         if (defaultCal) {</span>
<a href="#l69.21"></a><span id="l69.21">             session.defaultCalendar = defaultCal;</span>
<a href="#l69.22"></a><span id="l69.22">             let [defaultSpec,] = splitUriParams(defaultCal.uri);</span>
<a href="#l69.23"></a><span id="l69.23">             session.uri = cal.makeURL(defaultSpec);</span>
<a href="#l69.24"></a><span id="l69.24">             session.credentials.userId = defaultCal.getProperty(&quot;user_id&quot;);</span>
<a href="#l69.25"></a><span id="l69.25">             log(&quot;default calendar found.&quot;, defaultCal);</span>
<a href="#l69.26"></a><span id="l69.26"> </span>
<a href="#l69.27"></a><span id="l69.27">             // check and fix changing urls (autoconf) of subscribed calendars here:</span>
<a href="#l69.28"></a><span id="l69.28" class="difflineminus">-            for each (let regCal in registeredCalendars) {</span>
<a href="#l69.29"></a><span id="l69.29" class="difflineplus">+            for (let regCal of registeredCalendars) {</span>
<a href="#l69.30"></a><span id="l69.30">                 if (!regCal.isDefaultCalendar) {</span>
<a href="#l69.31"></a><span id="l69.31">                     let [spec, params] = splitUriParams(regCal.uri);</span>
<a href="#l69.32"></a><span id="l69.32">                     if (spec != defaultSpec) {</span>
<a href="#l69.33"></a><span id="l69.33">                         log(&quot;fixing url of subscribed calendar: &quot; + regCal.calId, session);</span>
<a href="#l69.34"></a><span id="l69.34">                         let uri = regCal.uri.clone();</span>
<a href="#l69.35"></a><span id="l69.35">                         uri.spec = (defaultSpec + params);</span>
<a href="#l69.36"></a><span id="l69.36">                         regCal.uri = uri;</span>
<a href="#l69.37"></a><span id="l69.37">                         regCal.setProperty(&quot;uri&quot;, uri.spec);</span>
<a href="#l69.38"></a><span id="l69.38" class="difflineat">@@ -499,20 +499,20 @@ calWcapSession.prototype = {</span>
<a href="#l69.39"></a><span id="l69.39">                     var defaultCal = this_.defaultCalendar;</span>
<a href="#l69.40"></a><span id="l69.40">                     if (defaultCal &amp;&amp; cals[defaultCal.calId] &amp;&amp; // default calendar is registered</span>
<a href="#l69.41"></a><span id="l69.41">                         getPref(&quot;calendar.wcap.subscriptions&quot;, true) &amp;&amp;</span>
<a href="#l69.42"></a><span id="l69.42">                         !defaultCal.getProperty(&quot;subscriptions_registered&quot;)) {</span>
<a href="#l69.43"></a><span id="l69.43"> </span>
<a href="#l69.44"></a><span id="l69.44">                         var hasSubscriptions = false;</span>
<a href="#l69.45"></a><span id="l69.45">                         // post register subscribed calendars:</span>
<a href="#l69.46"></a><span id="l69.46">                         var list = this_.getUserPreferences(&quot;X-NSCP-WCAP-PREF-icsSubscribed&quot;);</span>
<a href="#l69.47"></a><span id="l69.47" class="difflineminus">-                        for each (var item in list) {</span>
<a href="#l69.48"></a><span id="l69.48" class="difflineplus">+                        for (var item of list) {</span>
<a href="#l69.49"></a><span id="l69.49">                             var ar = item.split(',');</span>
<a href="#l69.50"></a><span id="l69.50">                             // ',', '$' are not encoded. ',' can be handled here. WTF.</span>
<a href="#l69.51"></a><span id="l69.51" class="difflineminus">-                            for each (var a in ar) {</span>
<a href="#l69.52"></a><span id="l69.52" class="difflineplus">+                            for (var a of ar) {</span>
<a href="#l69.53"></a><span id="l69.53">                                 var dollar = a.indexOf('$');</span>
<a href="#l69.54"></a><span id="l69.54">                                 if (dollar &gt;= 0) {</span>
<a href="#l69.55"></a><span id="l69.55">                                     var calId = a.substring(0, dollar);</span>
<a href="#l69.56"></a><span id="l69.56">                                     if (calId != this_.defaultCalId) {</span>
<a href="#l69.57"></a><span id="l69.57">                                         cals[calId] = null;</span>
<a href="#l69.58"></a><span id="l69.58">                                         hasSubscriptions = true;</span>
<a href="#l69.59"></a><span id="l69.59">                                     }</span>
<a href="#l69.60"></a><span id="l69.60">                                 }</span>
<a href="#l69.61"></a><span id="l69.61" class="difflineat">@@ -623,17 +623,17 @@ calWcapSession.prototype = {</span>
<a href="#l69.62"></a><span id="l69.62">                     onResult: function search_onResult(request, result) {</span>
<a href="#l69.63"></a><span id="l69.63">                         try {</span>
<a href="#l69.64"></a><span id="l69.64">                             if (!Components.isSuccessCode(request.status)) {</span>
<a href="#l69.65"></a><span id="l69.65">                                 throw request.status;</span>
<a href="#l69.66"></a><span id="l69.66">                             }</span>
<a href="#l69.67"></a><span id="l69.67">                             if (result.length &lt; 1) {</span>
<a href="#l69.68"></a><span id="l69.68">                                 throw Components.results.NS_ERROR_UNEXPECTED;</span>
<a href="#l69.69"></a><span id="l69.69">                             }</span>
<a href="#l69.70"></a><span id="l69.70" class="difflineminus">-                            for each (let calendar in result) {</span>
<a href="#l69.71"></a><span id="l69.71" class="difflineplus">+                            for (let calendar of result) {</span>
<a href="#l69.72"></a><span id="l69.72">                                 // user may have dangling users referred in his subscription list, so</span>
<a href="#l69.73"></a><span id="l69.73">                                 // retrieve each by each, don't break:</span>
<a href="#l69.74"></a><span id="l69.74">                                 try {</span>
<a href="#l69.75"></a><span id="l69.75">                                     var calId = calendar.calId;</span>
<a href="#l69.76"></a><span id="l69.76">                                     if ((cals[calId] !== undefined) &amp;&amp; !retrievedCals[calId]) {</span>
<a href="#l69.77"></a><span id="l69.77">                                         retrievedCals[calId] = calendar;</span>
<a href="#l69.78"></a><span id="l69.78">                                         if (respFunc) {</span>
<a href="#l69.79"></a><span id="l69.79">                                             respFunc(calendar);</span>
<a href="#l69.80"></a><span id="l69.80" class="difflineat">@@ -791,17 +791,17 @@ calWcapSession.prototype = {</span>
<a href="#l69.81"></a><span id="l69.81"> </span>
<a href="#l69.82"></a><span id="l69.82">     get userId() {</span>
<a href="#l69.83"></a><span id="l69.83">         return this.credentials.userId;</span>
<a href="#l69.84"></a><span id="l69.84">     },</span>
<a href="#l69.85"></a><span id="l69.85"> </span>
<a href="#l69.86"></a><span id="l69.86">     get defaultCalId() {</span>
<a href="#l69.87"></a><span id="l69.87">         var list = this.getUserPreferences(&quot;X-NSCP-WCAP-PREF-icsCalendar&quot;);</span>
<a href="#l69.88"></a><span id="l69.88">         var id = null;</span>
<a href="#l69.89"></a><span id="l69.89" class="difflineminus">-        for each (var item in list) {</span>
<a href="#l69.90"></a><span id="l69.90" class="difflineplus">+        for (var item of list) {</span>
<a href="#l69.91"></a><span id="l69.91">             if (item.length &gt; 0) {</span>
<a href="#l69.92"></a><span id="l69.92">                 id = item;</span>
<a href="#l69.93"></a><span id="l69.93">                 break;</span>
<a href="#l69.94"></a><span id="l69.94">             }</span>
<a href="#l69.95"></a><span id="l69.95">         }</span>
<a href="#l69.96"></a><span id="l69.96">         return (id ? id : this.credentials.userId);</span>
<a href="#l69.97"></a><span id="l69.97">     },</span>
<a href="#l69.98"></a><span id="l69.98"> </span>
<a href="#l69.99"></a><span id="l69.99" class="difflineat">@@ -822,17 +822,17 @@ calWcapSession.prototype = {</span>
<a href="#l69.100"></a><span id="l69.100">         } catch (exc) {</span>
<a href="#l69.101"></a><span id="l69.101">         }</span>
<a href="#l69.102"></a><span id="l69.102">         return null;</span>
<a href="#l69.103"></a><span id="l69.103">     },</span>
<a href="#l69.104"></a><span id="l69.104"> </span>
<a href="#l69.105"></a><span id="l69.105">     getRegisteredCalendars: function calWcapSession_getRegisteredCalendars(asAssocObj) {</span>
<a href="#l69.106"></a><span id="l69.106">         let registeredCalendars = (asAssocObj ? {} : []);</span>
<a href="#l69.107"></a><span id="l69.107">         let cals = cal.getCalendarManager().getCalendars({});</span>
<a href="#l69.108"></a><span id="l69.108" class="difflineminus">-        for each (let calendar in cals) {</span>
<a href="#l69.109"></a><span id="l69.109" class="difflineplus">+        for (let calendar of cals) {</span>
<a href="#l69.110"></a><span id="l69.110">             calendar = this.belongsTo(calendar);</span>
<a href="#l69.111"></a><span id="l69.111">             if (calendar) {</span>
<a href="#l69.112"></a><span id="l69.112">                 if (asAssocObj) {</span>
<a href="#l69.113"></a><span id="l69.113">                     registeredCalendars[calendar.calId] = calendar;</span>
<a href="#l69.114"></a><span id="l69.114">                 } else {</span>
<a href="#l69.115"></a><span id="l69.115">                     registeredCalendars.push(calendar);</span>
<a href="#l69.116"></a><span id="l69.116">                 }</span>
<a href="#l69.117"></a><span id="l69.117">             }</span>
<a href="#l69.118"></a><span id="l69.118" class="difflineat">@@ -856,17 +856,17 @@ calWcapSession.prototype = {</span>
<a href="#l69.119"></a><span id="l69.119">         }</span>
<a href="#l69.120"></a><span id="l69.120">         return alarmStart;</span>
<a href="#l69.121"></a><span id="l69.121">     },</span>
<a href="#l69.122"></a><span id="l69.122"> </span>
<a href="#l69.123"></a><span id="l69.123">     getDefaultAlarmEmails: function calWcapSession_getDefaultAlarmEmails(out_count) {</span>
<a href="#l69.124"></a><span id="l69.124">         var ret = [];</span>
<a href="#l69.125"></a><span id="l69.125">         var ar = this.getUserPreferences(&quot;X-NSCP-WCAP-PREF-ceDefaultAlarmEmail&quot;);</span>
<a href="#l69.126"></a><span id="l69.126">         if (ar.length &gt; 0 &amp;&amp; ar[0].length &gt; 0) {</span>
<a href="#l69.127"></a><span id="l69.127" class="difflineminus">-            for each (var i in ar) {</span>
<a href="#l69.128"></a><span id="l69.128" class="difflineplus">+            for (var i of ar) {</span>
<a href="#l69.129"></a><span id="l69.129">                 ret = ret.concat(i.split(/[;,]/).map(String.trim));</span>
<a href="#l69.130"></a><span id="l69.130">             }</span>
<a href="#l69.131"></a><span id="l69.131">         }</span>
<a href="#l69.132"></a><span id="l69.132">         out_count.value = ret.length;</span>
<a href="#l69.133"></a><span id="l69.133">         return ret;</span>
<a href="#l69.134"></a><span id="l69.134">     },</span>
<a href="#l69.135"></a><span id="l69.135"> </span>
<a href="#l69.136"></a><span id="l69.136">     // calICalendarSearchProvider:</span>
<a href="#l69.137"></a><span id="l69.137" class="difflineat">@@ -1097,17 +1097,17 @@ calWcapSession.prototype = {</span>
<a href="#l69.138"></a><span id="l69.138">         try {</span>
<a href="#l69.139"></a><span id="l69.139">             // make sure the calendar belongs to this session and is the default calendar,</span>
<a href="#l69.140"></a><span id="l69.140">             // then remove all subscribed calendars:</span>
<a href="#l69.141"></a><span id="l69.141">             aCalendar = this.belongsTo(aCalendar);</span>
<a href="#l69.142"></a><span id="l69.142">             if (aCalendar &amp;&amp; aCalendar.isDefaultCalendar) {</span>
<a href="#l69.143"></a><span id="l69.143">                 getFreeBusyService().removeProvider(this);</span>
<a href="#l69.144"></a><span id="l69.144">                 getCalendarSearchService().removeProvider(this);</span>
<a href="#l69.145"></a><span id="l69.145">                 var registeredCalendars = this.getRegisteredCalendars();</span>
<a href="#l69.146"></a><span id="l69.146" class="difflineminus">-                for each (var regCal in registeredCalendars) {</span>
<a href="#l69.147"></a><span id="l69.147" class="difflineplus">+                for (var regCal of registeredCalendars) {</span>
<a href="#l69.148"></a><span id="l69.148">                     try {</span>
<a href="#l69.149"></a><span id="l69.149">                         if (!regCal.isDefaultCalendar) {</span>
<a href="#l69.150"></a><span id="l69.150">                             cal.getCalendarManager().unregisterCalendar(regCal);</span>
<a href="#l69.151"></a><span id="l69.151">                         }</span>
<a href="#l69.152"></a><span id="l69.152">                     } catch (exc) {</span>
<a href="#l69.153"></a><span id="l69.153">                         this.notifyError(exc);</span>
<a href="#l69.154"></a><span id="l69.154">                     }</span>
<a href="#l69.155"></a><span id="l69.155">                 }</span>
<a href="#l69.156"></a><span id="l69.156" class="difflineat">@@ -1123,17 +1123,17 @@ calWcapSession.prototype = {</span>
<a href="#l69.157"></a><span id="l69.157"> };</span>
<a href="#l69.158"></a><span id="l69.158"> </span>
<a href="#l69.159"></a><span id="l69.159"> function confirmInsecureLogin(uri)</span>
<a href="#l69.160"></a><span id="l69.160"> {</span>
<a href="#l69.161"></a><span id="l69.161">     if (!confirmInsecureLogin.m_confirmedHttpLogins) {</span>
<a href="#l69.162"></a><span id="l69.162">         confirmInsecureLogin.m_confirmedHttpLogins = {};</span>
<a href="#l69.163"></a><span id="l69.163">         var confirmedHttpLogins = getPref(&quot;calendar.wcap.confirmed_http_logins&quot;, &quot;&quot;);</span>
<a href="#l69.164"></a><span id="l69.164">         var tuples = confirmedHttpLogins.split(',');</span>
<a href="#l69.165"></a><span id="l69.165" class="difflineminus">-        for each (var tuple in tuples) {</span>
<a href="#l69.166"></a><span id="l69.166" class="difflineplus">+        for (var tuple of tuples) {</span>
<a href="#l69.167"></a><span id="l69.167">             var ar = tuple.split(':');</span>
<a href="#l69.168"></a><span id="l69.168">             confirmInsecureLogin.m_confirmedHttpLogins[ar[0]] = ar[1];</span>
<a href="#l69.169"></a><span id="l69.169">         }</span>
<a href="#l69.170"></a><span id="l69.170">     }</span>
<a href="#l69.171"></a><span id="l69.171"> </span>
<a href="#l69.172"></a><span id="l69.172">     var bConfirmed = false;</span>
<a href="#l69.173"></a><span id="l69.173"> </span>
<a href="#l69.174"></a><span id="l69.174">     var host = uri.hostPort;</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l70.1"></a><span id="l70.1" class="difflineminus">--- a/calendar/resources/content/datetimepickers/datetimepickers.xml</span>
<a href="#l70.2"></a><span id="l70.2" class="difflineplus">+++ b/calendar/resources/content/datetimepickers/datetimepickers.xml</span>
<a href="#l70.3"></a><span id="l70.3" class="difflineat">@@ -122,17 +122,17 @@</span>
<a href="#l70.4"></a><span id="l70.4">       &lt;method name=&quot;parseLanguageDate&quot;&gt;</span>
<a href="#l70.5"></a><span id="l70.5">         &lt;parameter name=&quot;aValue&quot;/&gt;</span>
<a href="#l70.6"></a><span id="l70.6">         &lt;body&gt;&lt;![CDATA[</span>
<a href="#l70.7"></a><span id="l70.7">            if (!aValue) {</span>
<a href="#l70.8"></a><span id="l70.8">              return null;</span>
<a href="#l70.9"></a><span id="l70.9">            }</span>
<a href="#l70.10"></a><span id="l70.10">            var val = aValue.toLowerCase();</span>
<a href="#l70.11"></a><span id="l70.11">            // Look for the easy ones like today, tomorrow, etc</span>
<a href="#l70.12"></a><span id="l70.12" class="difflineminus">-           for each (var rel in this.mRelativeDates) {</span>
<a href="#l70.13"></a><span id="l70.13" class="difflineplus">+           for (var rel of this.mRelativeDates) {</span>
<a href="#l70.14"></a><span id="l70.14">              if (val == rel.word) {</span>
<a href="#l70.15"></a><span id="l70.15">                var now = new Date();</span>
<a href="#l70.16"></a><span id="l70.16">                now.setDate(now.getDate()+rel.offset);</span>
<a href="#l70.17"></a><span id="l70.17">                return now;</span>
<a href="#l70.18"></a><span id="l70.18">              }</span>
<a href="#l70.19"></a><span id="l70.19">            }</span>
<a href="#l70.20"></a><span id="l70.20"> </span>
<a href="#l70.21"></a><span id="l70.21">            var parser = this;</span>
<a href="#l70.22"></a><span id="l70.22" class="difflineat">@@ -181,18 +181,18 @@</span>
<a href="#l70.23"></a><span id="l70.23">                newVal = newVal.replace(' ', '/');</span>
<a href="#l70.24"></a><span id="l70.24">                return this.parseDateTime(newVal);</span>
<a href="#l70.25"></a><span id="l70.25">              }</span>
<a href="#l70.26"></a><span id="l70.26">           }</span>
<a href="#l70.27"></a><span id="l70.27"> </span>
<a href="#l70.28"></a><span id="l70.28">           // Now for the cool 'next' and 'last'</span>
<a href="#l70.29"></a><span id="l70.29">           var words = val.split(' ');</span>
<a href="#l70.30"></a><span id="l70.30">           var offset, day;</span>
<a href="#l70.31"></a><span id="l70.31" class="difflineminus">-          for each (let word in words) {</span>
<a href="#l70.32"></a><span id="l70.32" class="difflineminus">-            for each (let rel in this.mRelationWords) {</span>
<a href="#l70.33"></a><span id="l70.33" class="difflineplus">+          for (let word of words) {</span>
<a href="#l70.34"></a><span id="l70.34" class="difflineplus">+            for (let rel of this.mRelationWords) {</span>
<a href="#l70.35"></a><span id="l70.35">               if (word == rel.word) {</span>
<a href="#l70.36"></a><span id="l70.36">                 offset = rel.offset;</span>
<a href="#l70.37"></a><span id="l70.37">                 break;</span>
<a href="#l70.38"></a><span id="l70.38">               }</span>
<a href="#l70.39"></a><span id="l70.39">             }</span>
<a href="#l70.40"></a><span id="l70.40">             for (var i in this.mDayNames) {</span>
<a href="#l70.41"></a><span id="l70.41">               if (word == this.mDayNames[i]) {</span>
<a href="#l70.42"></a><span id="l70.42">                 day = getDateForDay(word);</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l71.1"></a><span id="l71.1" class="difflineminus">--- a/calendar/test/mozmill/shared-modules/timezone-utils.js</span>
<a href="#l71.2"></a><span id="l71.2" class="difflineplus">+++ b/calendar/test/mozmill/shared-modules/timezone-utils.js</span>
<a href="#l71.3"></a><span id="l71.3" class="difflineat">@@ -62,17 +62,17 @@ function verify(controller, dates, timez</span>
<a href="#l71.4"></a><span id="l71.4">       // previous day</span>
<a href="#l71.5"></a><span id="l71.5">       if(day != undefined &amp;&amp; day == -1) {</span>
<a href="#l71.6"></a><span id="l71.6">         calUtils.back(controller, 1);</span>
<a href="#l71.7"></a><span id="l71.7">         stackNode = (new elementslib.Lookup(controller.window.document, dayStack)).getNode();</span>
<a href="#l71.8"></a><span id="l71.8">       }</span>
<a href="#l71.9"></a><span id="l71.9">       </span>
<a href="#l71.10"></a><span id="l71.10">       calUtils.findEventsInNode(stackNode, eventNodes);</span>
<a href="#l71.11"></a><span id="l71.11">       </span>
<a href="#l71.12"></a><span id="l71.12" class="difflineminus">-      for each (node in eventNodes) {</span>
<a href="#l71.13"></a><span id="l71.13" class="difflineplus">+      for (let node of eventNodes) {</span>
<a href="#l71.14"></a><span id="l71.14">         if (Math.abs(timeY - node.boxObject.y) &lt; allowedDifference &amp;&amp;</span>
<a href="#l71.15"></a><span id="l71.15">                      timezones[tz] == node.mOccurrence.title) {</span>
<a href="#l71.16"></a><span id="l71.16">           found = true;</span>
<a href="#l71.17"></a><span id="l71.17">           break;</span>
<a href="#l71.18"></a><span id="l71.18">         }</span>
<a href="#l71.19"></a><span id="l71.19">       }</span>
<a href="#l71.20"></a><span id="l71.20">       </span>
<a href="#l71.21"></a><span id="l71.21">       if(day != undefined &amp;&amp; day == 1) {</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l72.1"></a><span id="l72.1" class="difflineminus">--- a/calendar/test/unit/test_alarmservice.js</span>
<a href="#l72.2"></a><span id="l72.2" class="difflineplus">+++ b/calendar/test/unit/test_alarmservice.js</span>
<a href="#l72.3"></a><span id="l72.3" class="difflineat">@@ -62,17 +62,17 @@ var alarmObserver = {</span>
<a href="#l72.4"></a><span id="l72.4">         this.expectedMap[aCalendar.id][aItem.hashId][aAlarm.icalString] = aExpected;</span>
<a href="#l72.5"></a><span id="l72.5">     },</span>
<a href="#l72.6"></a><span id="l72.6"> </span>
<a href="#l72.7"></a><span id="l72.7">     expectOccurrences: function obs_expectOccurrences(aCalendar, aItem, aAlarm, aExpectedArray) {</span>
<a href="#l72.8"></a><span id="l72.8">         // we need to be earlier than the first occurrence</span>
<a href="#l72.9"></a><span id="l72.9">         let dt = aItem.startDate.clone();</span>
<a href="#l72.10"></a><span id="l72.10">         dt.second -= 1;</span>
<a href="#l72.11"></a><span id="l72.11"> </span>
<a href="#l72.12"></a><span id="l72.12" class="difflineminus">-        for each (let expected in aExpectedArray) {</span>
<a href="#l72.13"></a><span id="l72.13" class="difflineplus">+        for (let expected of aExpectedArray) {</span>
<a href="#l72.14"></a><span id="l72.14">             let occ = aItem.recurrenceInfo.getNextOccurrence(dt);</span>
<a href="#l72.15"></a><span id="l72.15">             dt = occ.startDate;</span>
<a href="#l72.16"></a><span id="l72.16">             this.expectResult(aCalendar, occ, aAlarm, expected);</span>
<a href="#l72.17"></a><span id="l72.17">         }</span>
<a href="#l72.18"></a><span id="l72.18">     },</span>
<a href="#l72.19"></a><span id="l72.19"> </span>
<a href="#l72.20"></a><span id="l72.20">     checkExpected: function obs_checkExpected() {</span>
<a href="#l72.21"></a><span id="l72.21">         for (let calId in this.expectedMap) {</span>
<a href="#l72.22"></a><span id="l72.22" class="difflineat">@@ -133,17 +133,17 @@ function initializeAlarmService() {</span>
<a href="#l72.23"></a><span id="l72.23">                                        .getService(Components.interfaces.calIAlarmService)</span>
<a href="#l72.24"></a><span id="l72.24">                                        .wrappedJSObject;</span>
<a href="#l72.25"></a><span id="l72.25">     ok(!alarmObserver.service.mStarted);</span>
<a href="#l72.26"></a><span id="l72.26"> </span>
<a href="#l72.27"></a><span id="l72.27">     alarmObserver.service.startup();</span>
<a href="#l72.28"></a><span id="l72.28">     ok(alarmObserver.service.mStarted);</span>
<a href="#l72.29"></a><span id="l72.29"> </span>
<a href="#l72.30"></a><span id="l72.30">     // we need to replace the existing observers with our observer</span>
<a href="#l72.31"></a><span id="l72.31" class="difflineminus">-    for each (let obs in alarmObserver.service.mObservers.mInterfaces) {</span>
<a href="#l72.32"></a><span id="l72.32" class="difflineplus">+    for (let obs of alarmObserver.service.mObservers.mInterfaces) {</span>
<a href="#l72.33"></a><span id="l72.33">         alarmObserver.service.removeObserver(obs);</span>
<a href="#l72.34"></a><span id="l72.34">     }</span>
<a href="#l72.35"></a><span id="l72.35">     alarmObserver.service.addObserver(alarmObserver);</span>
<a href="#l72.36"></a><span id="l72.36"> }</span>
<a href="#l72.37"></a><span id="l72.37"> </span>
<a href="#l72.38"></a><span id="l72.38"> function createAlarmFromDuration(aOffset) {</span>
<a href="#l72.39"></a><span id="l72.39">     let alarm = cal.createAlarm();</span>
<a href="#l72.40"></a><span id="l72.40"> </span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l73.1"></a><span id="l73.1" class="difflineminus">--- a/calendar/test/unit/test_ics.js</span>
<a href="#l73.2"></a><span id="l73.2" class="difflineplus">+++ b/calendar/test/unit/test_ics.js</span>
<a href="#l73.3"></a><span id="l73.3" class="difflineat">@@ -111,17 +111,17 @@ function test_roundtrip() {</span>
<a href="#l73.4"></a><span id="l73.4">         if (&quot;expectedDateProps&quot; in data) {</span>
<a href="#l73.5"></a><span id="l73.5">             checkProps(data.expectedDateProps, event.startDate);</span>
<a href="#l73.6"></a><span id="l73.6">             checkProps(data.expectedDateProps, event.endDate);</span>
<a href="#l73.7"></a><span id="l73.7">         }</span>
<a href="#l73.8"></a><span id="l73.8">     }</span>
<a href="#l73.9"></a><span id="l73.9"> </span>
<a href="#l73.10"></a><span id="l73.10">     let icssrv = cal.getIcsService();</span>
<a href="#l73.11"></a><span id="l73.11"> </span>
<a href="#l73.12"></a><span id="l73.12" class="difflineminus">-    for each (var data in test_data) {</span>
<a href="#l73.13"></a><span id="l73.13" class="difflineplus">+    for (var data of test_data) {</span>
<a href="#l73.14"></a><span id="l73.14">         // First round, use the icalString setter which uses synchronous parsing</span>
<a href="#l73.15"></a><span id="l73.15">         dump(&quot;Checking&quot; + data.ics + &quot;\n&quot;);</span>
<a href="#l73.16"></a><span id="l73.16">         let event = createEventFromIcalString(data.ics);</span>
<a href="#l73.17"></a><span id="l73.17">         checkEvent(data, event);</span>
<a href="#l73.18"></a><span id="l73.18"> </span>
<a href="#l73.19"></a><span id="l73.19">         // Now, try the same thing with asynchronous parsing. We need a copy of</span>
<a href="#l73.20"></a><span id="l73.20">         // the data variable, otherwise javascript will mix the data between</span>
<a href="#l73.21"></a><span id="l73.21">         // foreach loop iterations.</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l74.1"></a><span id="l74.1" class="difflineminus">--- a/calendar/test/unit/test_ics_service.js</span>
<a href="#l74.2"></a><span id="l74.2" class="difflineplus">+++ b/calendar/test/unit/test_ics_service.js</span>
<a href="#l74.3"></a><span id="l74.3" class="difflineat">@@ -187,17 +187,17 @@ function test_icalcomponent() {</span>
<a href="#l74.4"></a><span id="l74.4">        [&quot;dueTime&quot;, cal.createDateTime(&quot;20120101T010103&quot;)],</span>
<a href="#l74.5"></a><span id="l74.5">        [&quot;stampTime&quot;, cal.createDateTime(&quot;20120101T010104&quot;)],</span>
<a href="#l74.6"></a><span id="l74.6">        [&quot;createdTime&quot;, cal.createDateTime(&quot;20120101T010105&quot;)],</span>
<a href="#l74.7"></a><span id="l74.7">        [&quot;completedTime&quot;, cal.createDateTime(&quot;20120101T010106&quot;)],</span>
<a href="#l74.8"></a><span id="l74.8">        [&quot;lastModified&quot;, cal.createDateTime(&quot;20120101T010107&quot;)],</span>
<a href="#l74.9"></a><span id="l74.9">        [&quot;recurrenceId&quot;, cal.createDateTime(&quot;20120101T010108&quot;)]</span>
<a href="#l74.10"></a><span id="l74.10">     ];</span>
<a href="#l74.11"></a><span id="l74.11"> </span>
<a href="#l74.12"></a><span id="l74.12" class="difflineminus">-    for each (let prop in props) {</span>
<a href="#l74.13"></a><span id="l74.13" class="difflineplus">+    for (let prop of props) {</span>
<a href="#l74.14"></a><span id="l74.14">         check_getset.apply(null, prop);</span>
<a href="#l74.15"></a><span id="l74.15">     }</span>
<a href="#l74.16"></a><span id="l74.16"> }</span>
<a href="#l74.17"></a><span id="l74.17"> </span>
<a href="#l74.18"></a><span id="l74.18"> function test_param() {</span>
<a href="#l74.19"></a><span id="l74.19">     let svc = cal.getIcsService();</span>
<a href="#l74.20"></a><span id="l74.20">     let prop = svc.createIcalProperty(&quot;DTSTART&quot;);</span>
<a href="#l74.21"></a><span id="l74.21">     prop.value = &quot;20120101T010101&quot;;</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l75.1"></a><span id="l75.1" class="difflineminus">--- a/calendar/test/unit/test_providers.js</span>
<a href="#l75.2"></a><span id="l75.2" class="difflineplus">+++ b/calendar/test/unit/test_providers.js</span>
<a href="#l75.3"></a><span id="l75.3" class="difflineat">@@ -314,17 +314,17 @@ function run_test() {</span>
<a href="#l75.4"></a><span id="l75.4">     * (2) Perform a getItem() call.</span>
<a href="#l75.5"></a><span id="l75.5">     * The properties of the returned item are compared with the passed item.</span>
<a href="#l75.6"></a><span id="l75.6">     */</span>
<a href="#l75.7"></a><span id="l75.7">     function testGetItem(aItem) {</span>
<a href="#l75.8"></a><span id="l75.8">         // get calendars</span>
<a href="#l75.9"></a><span id="l75.9">         var calArray = [];</span>
<a href="#l75.10"></a><span id="l75.10">         calArray.push(getStorageCal());</span>
<a href="#l75.11"></a><span id="l75.11">         calArray.push(getMemoryCal());</span>
<a href="#l75.12"></a><span id="l75.12" class="difflineminus">-        for each (let calendar in calArray) {</span>
<a href="#l75.13"></a><span id="l75.13" class="difflineplus">+        for (let calendar of calArray) {</span>
<a href="#l75.14"></a><span id="l75.14">             // implement listener</span>
<a href="#l75.15"></a><span id="l75.15">             var count = 0;</span>
<a href="#l75.16"></a><span id="l75.16">             var returnedItem = null;</span>
<a href="#l75.17"></a><span id="l75.17">             var listener = {</span>
<a href="#l75.18"></a><span id="l75.18">                 onOperationComplete: function(aCalendar,</span>
<a href="#l75.19"></a><span id="l75.19">                                               aStatus,</span>
<a href="#l75.20"></a><span id="l75.20">                                               aOperationType,</span>
<a href="#l75.21"></a><span id="l75.21">                                               aId,</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l76.1"></a><span id="l76.1" class="difflineminus">--- a/calendar/test/unit/test_storage.js</span>
<a href="#l76.2"></a><span id="l76.2" class="difflineplus">+++ b/calendar/test/unit/test_storage.js</span>
<a href="#l76.3"></a><span id="l76.3" class="difflineat">@@ -66,17 +66,17 @@ function testAttachRoundtrip() {</span>
<a href="#l76.4"></a><span id="l76.4">             let relations = item.getRelations({});</span>
<a href="#l76.5"></a><span id="l76.5">             let rel = relations[0];</span>
<a href="#l76.6"></a><span id="l76.6">             equal(relations.length, 1);</span>
<a href="#l76.7"></a><span id="l76.7">             equal(rel.relType, &quot;SIBLING&quot;);</span>
<a href="#l76.8"></a><span id="l76.8">             equal(rel.relId, &quot;VALUE&quot;);</span>
<a href="#l76.9"></a><span id="l76.9">             equal(rel.getParameter(&quot;FOO&quot;), &quot;BAR&quot;);</span>
<a href="#l76.10"></a><span id="l76.10"> </span>
<a href="#l76.11"></a><span id="l76.11">             // Check recurrence item</span>
<a href="#l76.12"></a><span id="l76.12" class="difflineminus">-            for each (let ritem in item.recurrenceInfo.getRecurrenceItems({})) {</span>
<a href="#l76.13"></a><span id="l76.13" class="difflineplus">+            for (let ritem of item.recurrenceInfo.getRecurrenceItems({})) {</span>
<a href="#l76.14"></a><span id="l76.14">                 if (ritem instanceof Components.interfaces.calIRecurrenceRule) {</span>
<a href="#l76.15"></a><span id="l76.15">                     equal(ritem.type, &quot;MONTHLY&quot;);</span>
<a href="#l76.16"></a><span id="l76.16">                     equal(ritem.interval, 2);</span>
<a href="#l76.17"></a><span id="l76.17">                     equal(ritem.count, 5);</span>
<a href="#l76.18"></a><span id="l76.18">                     equal(ritem.isByCount, true);</span>
<a href="#l76.19"></a><span id="l76.19">                     equal(ritem.getComponent(&quot;BYDAY&quot;, {}).toString(), [2].toString());</span>
<a href="#l76.20"></a><span id="l76.20">                     equal(ritem.isNegative, false);</span>
<a href="#l76.21"></a><span id="l76.21">                 } else if (ritem instanceof Components.interfaces.calIRecurrenceDate) {</span></pre></div></div>

<div class="page_footer">
<div class="page_footer_text">comm-central</div>
<div class="page_footer_text" style="padding-left: 10px">Deployed from <a href="https://hg.mozilla.org/hgcustom/version-control-tools/rev/35f393d6769a">35f393d6769a</a> at 2020-07-16T17:23:43Z.</div>
<div class="rss_logo">
<a href="/comm-central/rss-log">RSS</a>
<a href="/comm-central/atom-log">Atom</a>
</div>
<br />

</div>
</body>
</html>

