<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en-US" lang="en-US">
<head>
<link rel="icon" href="/static/35f393d6769a/hgicon.png" type="image/png" />
<meta name="robots" content="index, nofollow"/>
<link rel="stylesheet" href="/static/35f393d6769a/style-gitweb.css" type="text/css" />

<style type="text/css">
div.feed {
  float: right;
}
a img {
  border-width: 0px;
}
div.log_link {
  width: 80px;
  background-color: white;
}

div.log_body {
  padding-left: 96px;
}
</style>
<script type="text/javascript" src="/static/35f393d6769a/mercurial.js"></script>

<meta property="og:image" content="/static/35f393d6769a/moz-logo-bw-rgb.svg"/>
<meta property="og:type" content="website"/>

<title>comm-central: changeset 3707:2786301b85dbcff8c068c5c31024b78e5228732e</title>
<link rel="alternate" type="application/atom+xml"
   href="/comm-central/atom-log" title="Atom feed for comm-central"/>
<link rel="alternate" type="application/rss+xml"
   href="/comm-central/rss-log" title="RSS feed for comm-central"/>

<meta property="og:title" content="comm-central @ 2786301b85dbcff8c068c5c31024b78e5228732e" />
<meta property="og:url" content="/comm-central/rev/2786301b85dbcff8c068c5c31024b78e5228732e" />
<meta property="og:description" content="merge of add-jquery" />

</head>
<body>

<div class="page_header">
<div class="logo">
    <a href="https://developer.mozilla.org/en/docs/Mercurial">
        <img src="/static/35f393d6769a/moz-logo-bw-rgb.svg" alt="mercurial" />
    </a>
</div>
<a href="/">Mercurial</a> &gt; <a href="/comm-central">comm-central</a>  / changeset / 2786301b85dbcff8c068c5c31024b78e5228732e 
</div>

<div class="page_nav">
<div>
<a href="/comm-central/summary">summary</a> |
<a href="/comm-central/shortlog/2786301b85dbcff8c068c5c31024b78e5228732e">shortlog</a> |
<a href="/comm-central/log/2786301b85dbcff8c068c5c31024b78e5228732e">changelog</a> |
<a href="/comm-central/pushloghtml">pushlog</a> |
<a href="/comm-central/graph/2786301b85dbcff8c068c5c31024b78e5228732e">graph</a> |
<a href="/comm-central/tags">tags</a> |
<a href="/comm-central/bookmarks">bookmarks</a> |
<a href="/comm-central/branches">branches</a> |
<a href="/comm-central/file/2786301b85dbcff8c068c5c31024b78e5228732e">files</a> |
changeset |
<a href="/comm-central/raw-rev/2786301b85dbcff8c068c5c31024b78e5228732e">raw</a>  | <a href="/comm-central/archive/2786301b85dbcff8c068c5c31024b78e5228732e.zip">zip</a>  |
<a href="/comm-central/help">help</a>
</div>

<div class="search">
<form id="searchform" action="/comm-central/log">

<input name="rev" type="text" value="" size="40" />
<div id="hint">Find changesets by keywords (author, files, the commit message), revision
number or hash, or <a href="/comm-central/help/revsets">revset expression</a>.</div>
</form>
</div>
</div>

<div class="title">
merge of add-jquery
<span class="logtags"><span class="inbranchtag" title="gloda-facet">gloda-facet</span> </span>
</div>
<div class="title_text">
<table cellspacing="0">

<tr><td>author</td><td>&#65;&#110;&#100;&#114;&#101;&#119;&#32;&#83;&#117;&#116;&#104;&#101;&#114;&#108;&#97;&#110;&#100;&#32;&#60;&#97;&#115;&#117;&#116;&#104;&#101;&#114;&#108;&#97;&#110;&#100;&#64;&#97;&#115;&#117;&#116;&#104;&#101;&#114;&#108;&#97;&#110;&#100;&#46;&#111;&#114;&#103;&#62;</td></tr>
<tr><td></td><td class="date age">Mon, 07 Sep 2009 14:34:49 -0700</td></tr>
<tr><td>branch</td><td>gloda-facet</td></tr>
<tr>
 <td>changeset 3707</td>
 <td style="font-family:monospace"><a class="list" href="/comm-central/rev/2786301b85dbcff8c068c5c31024b78e5228732e">2786301b85dbcff8c068c5c31024b78e5228732e</a></td>
</tr>



<tr>
<td>parent 3704</td>
<td style="font-family:monospace">
<a class="list" href="/comm-central/rev/52d497146454f54dbc3c2768bda9f126246b6152">52d497146454f54dbc3c2768bda9f126246b6152</a> (current diff)
</td>
</tr>
<tr>
<td>parent 3706</td>
<td style="font-family:monospace">
<a class="list" href="/comm-central/rev/45fbab07d8b3e6cf7fb227e5783b1a5dcdc141d5">45fbab07d8b3e6cf7fb227e5783b1a5dcdc141d5</a> (<a href="/comm-central/rev/45fbab07d8b3e6cf7fb227e5783b1a5dcdc141d5:2786301b85db">diff</a>)
</td>
</tr>

<tr>
<td>child 3708</td>
<td style="font-family:monospace">
<a class="list" href="/comm-central/rev/991a21cf3bdeb5663b3efb013fd3d4a48071a550">991a21cf3bdeb5663b3efb013fd3d4a48071a550</a>
</td>
</tr>
<tr><td>push id</td><td><a href="/comm-central/pushloghtml?changeset=2786301b85dbcff8c068c5c31024b78e5228732e">2927</a></td></tr>
<tr><td>push user</td><td>bugmail@asutherland.org</td></tr>
<tr><td>push date</td><td class="date age">Thu, 10 Sep 2009 01:15:56 +0000</td></tr>

<tr><td>treeherder</td><td>comm-central@0b161ed73eb6 [<a href="https://treeherder.mozilla.org/#/jobs?repo=comm-central&revision=0b161ed73eb66538ade852cb5a4b9b1b2c319a33">default view</a>] [<a href="https://treeherder.mozilla.org/#/jobs?repo=comm-central&revision=0b161ed73eb66538ade852cb5a4b9b1b2c319a33&filter-resultStatus=testfailed&filter-resultStatus=busted&filter-resultStatus=exception">failures only]</td></tr>
<tr><td>perfherder</td><td>[<a href="https://treeherder.mozilla.org/perf.html#/compare?originalProject=comm-central&originalRevision=0b161ed73eb66538ade852cb5a4b9b1b2c319a33&newProject=comm-central&newRevision=b5e0aff84bf4077a47919481912ad0bd11c6a8d8&framework=1" target="_blank">talos</a>] [<a href="https://treeherder.mozilla.org/perf.html#/compare?originalProject=comm-central&originalRevision=0b161ed73eb66538ade852cb5a4b9b1b2c319a33&newProject=comm-central&newRevision=b5e0aff84bf4077a47919481912ad0bd11c6a8d8&framework=2" target="_blank">build metrics</a>] [<a href="https://treeherder.mozilla.org/perf.html#/compare?originalProject=comm-central&originalRevision=0b161ed73eb66538ade852cb5a4b9b1b2c319a33&newProject=comm-central&newRevision=b5e0aff84bf4077a47919481912ad0bd11c6a8d8&framework=6" target="_blank">platform microbench</a>] (compared to previous push)</td></tr>






</table></div>

<div class="page_body description">merge of add-jquery</div>
<div class="list_head"></div>
<div class="title_text">
<table cellspacing="0">

<tr class="parity0">
<td><a class="list" href="/comm-central/diff/2786301b85dbcff8c068c5c31024b78e5228732e/.hgpatchinfo/gloda-facet.dep">.hgpatchinfo/gloda-facet.dep</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/2786301b85dbcff8c068c5c31024b78e5228732e/.hgpatchinfo/gloda-facet.dep">file</a> |
<a href="/comm-central/annotate/2786301b85dbcff8c068c5c31024b78e5228732e/.hgpatchinfo/gloda-facet.dep">annotate</a> |
<a href="/comm-central/diff/2786301b85dbcff8c068c5c31024b78e5228732e/.hgpatchinfo/gloda-facet.dep">diff</a> |
<a href="/comm-central/comparison/2786301b85dbcff8c068c5c31024b78e5228732e/.hgpatchinfo/gloda-facet.dep">comparison</a> |
<a href="/comm-central/log/2786301b85dbcff8c068c5c31024b78e5228732e/.hgpatchinfo/gloda-facet.dep">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/2786301b85dbcff8c068c5c31024b78e5228732e/mail/base/content/mailWindowOverlay.js">mail/base/content/mailWindowOverlay.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/2786301b85dbcff8c068c5c31024b78e5228732e/mail/base/content/mailWindowOverlay.js">file</a> |
<a href="/comm-central/annotate/2786301b85dbcff8c068c5c31024b78e5228732e/mail/base/content/mailWindowOverlay.js">annotate</a> |
<a href="/comm-central/diff/2786301b85dbcff8c068c5c31024b78e5228732e/mail/base/content/mailWindowOverlay.js">diff</a> |
<a href="/comm-central/comparison/2786301b85dbcff8c068c5c31024b78e5228732e/mail/base/content/mailWindowOverlay.js">comparison</a> |
<a href="/comm-central/log/2786301b85dbcff8c068c5c31024b78e5228732e/mail/base/content/mailWindowOverlay.js">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/2786301b85dbcff8c068c5c31024b78e5228732e/mail/base/content/tabmail.xml">mail/base/content/tabmail.xml</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/2786301b85dbcff8c068c5c31024b78e5228732e/mail/base/content/tabmail.xml">file</a> |
<a href="/comm-central/annotate/2786301b85dbcff8c068c5c31024b78e5228732e/mail/base/content/tabmail.xml">annotate</a> |
<a href="/comm-central/diff/2786301b85dbcff8c068c5c31024b78e5228732e/mail/base/content/tabmail.xml">diff</a> |
<a href="/comm-central/comparison/2786301b85dbcff8c068c5c31024b78e5228732e/mail/base/content/tabmail.xml">comparison</a> |
<a href="/comm-central/log/2786301b85dbcff8c068c5c31024b78e5228732e/mail/base/content/tabmail.xml">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/2786301b85dbcff8c068c5c31024b78e5228732e/mail/locales/en-US/chrome/messenger/messenger.properties">mail/locales/en-US/chrome/messenger/messenger.properties</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/2786301b85dbcff8c068c5c31024b78e5228732e/mail/locales/en-US/chrome/messenger/messenger.properties">file</a> |
<a href="/comm-central/annotate/2786301b85dbcff8c068c5c31024b78e5228732e/mail/locales/en-US/chrome/messenger/messenger.properties">annotate</a> |
<a href="/comm-central/diff/2786301b85dbcff8c068c5c31024b78e5228732e/mail/locales/en-US/chrome/messenger/messenger.properties">diff</a> |
<a href="/comm-central/comparison/2786301b85dbcff8c068c5c31024b78e5228732e/mail/locales/en-US/chrome/messenger/messenger.properties">comparison</a> |
<a href="/comm-central/log/2786301b85dbcff8c068c5c31024b78e5228732e/mail/locales/en-US/chrome/messenger/messenger.properties">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/2786301b85dbcff8c068c5c31024b78e5228732e/mail/themes/gnomestripe/jar.mn">mail/themes/gnomestripe/jar.mn</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/2786301b85dbcff8c068c5c31024b78e5228732e/mail/themes/gnomestripe/jar.mn">file</a> |
<a href="/comm-central/annotate/2786301b85dbcff8c068c5c31024b78e5228732e/mail/themes/gnomestripe/jar.mn">annotate</a> |
<a href="/comm-central/diff/2786301b85dbcff8c068c5c31024b78e5228732e/mail/themes/gnomestripe/jar.mn">diff</a> |
<a href="/comm-central/comparison/2786301b85dbcff8c068c5c31024b78e5228732e/mail/themes/gnomestripe/jar.mn">comparison</a> |
<a href="/comm-central/log/2786301b85dbcff8c068c5c31024b78e5228732e/mail/themes/gnomestripe/jar.mn">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/2786301b85dbcff8c068c5c31024b78e5228732e/mail/themes/gnomestripe/mail/tabmailBindings.xml">mail/themes/gnomestripe/mail/tabmailBindings.xml</a></td>
<td></td>
<td class="link">
file |
annotate |
<a href="/comm-central/diff/2786301b85dbcff8c068c5c31024b78e5228732e/mail/themes/gnomestripe/mail/tabmailBindings.xml">diff</a> |
<a href="/comm-central/comparison/2786301b85dbcff8c068c5c31024b78e5228732e/mail/themes/gnomestripe/mail/tabmailBindings.xml">comparison</a> |
<a href="/comm-central/log/2786301b85dbcff8c068c5c31024b78e5228732e/mail/themes/gnomestripe/mail/tabmailBindings.xml">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/2786301b85dbcff8c068c5c31024b78e5228732e/mail/themes/pinstripe/jar.mn">mail/themes/pinstripe/jar.mn</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/2786301b85dbcff8c068c5c31024b78e5228732e/mail/themes/pinstripe/jar.mn">file</a> |
<a href="/comm-central/annotate/2786301b85dbcff8c068c5c31024b78e5228732e/mail/themes/pinstripe/jar.mn">annotate</a> |
<a href="/comm-central/diff/2786301b85dbcff8c068c5c31024b78e5228732e/mail/themes/pinstripe/jar.mn">diff</a> |
<a href="/comm-central/comparison/2786301b85dbcff8c068c5c31024b78e5228732e/mail/themes/pinstripe/jar.mn">comparison</a> |
<a href="/comm-central/log/2786301b85dbcff8c068c5c31024b78e5228732e/mail/themes/pinstripe/jar.mn">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/2786301b85dbcff8c068c5c31024b78e5228732e/mail/themes/pinstripe/mail/tabmailBindings.xml">mail/themes/pinstripe/mail/tabmailBindings.xml</a></td>
<td></td>
<td class="link">
file |
annotate |
<a href="/comm-central/diff/2786301b85dbcff8c068c5c31024b78e5228732e/mail/themes/pinstripe/mail/tabmailBindings.xml">diff</a> |
<a href="/comm-central/comparison/2786301b85dbcff8c068c5c31024b78e5228732e/mail/themes/pinstripe/mail/tabmailBindings.xml">comparison</a> |
<a href="/comm-central/log/2786301b85dbcff8c068c5c31024b78e5228732e/mail/themes/pinstripe/mail/tabmailBindings.xml">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/2786301b85dbcff8c068c5c31024b78e5228732e/mail/themes/qute/jar.mn">mail/themes/qute/jar.mn</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/2786301b85dbcff8c068c5c31024b78e5228732e/mail/themes/qute/jar.mn">file</a> |
<a href="/comm-central/annotate/2786301b85dbcff8c068c5c31024b78e5228732e/mail/themes/qute/jar.mn">annotate</a> |
<a href="/comm-central/diff/2786301b85dbcff8c068c5c31024b78e5228732e/mail/themes/qute/jar.mn">diff</a> |
<a href="/comm-central/comparison/2786301b85dbcff8c068c5c31024b78e5228732e/mail/themes/qute/jar.mn">comparison</a> |
<a href="/comm-central/log/2786301b85dbcff8c068c5c31024b78e5228732e/mail/themes/qute/jar.mn">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/2786301b85dbcff8c068c5c31024b78e5228732e/mail/themes/qute/mail/tabmailBindings.xml">mail/themes/qute/mail/tabmailBindings.xml</a></td>
<td></td>
<td class="link">
file |
annotate |
<a href="/comm-central/diff/2786301b85dbcff8c068c5c31024b78e5228732e/mail/themes/qute/mail/tabmailBindings.xml">diff</a> |
<a href="/comm-central/comparison/2786301b85dbcff8c068c5c31024b78e5228732e/mail/themes/qute/mail/tabmailBindings.xml">comparison</a> |
<a href="/comm-central/log/2786301b85dbcff8c068c5c31024b78e5228732e/mail/themes/qute/mail/tabmailBindings.xml">revisions</a>
</td>
</tr>
</table></div>

<div class="page_body diffblocks"><div class="diffblock"><pre class="sourcelines">
<a href="#l1.1"></a><span id="l1.1" class="difflineminus">--- a/.hgpatchinfo/add-jquery.dep</span>
<a href="#l1.2"></a><span id="l1.2" class="difflineplus">+++ b/.hgpatchinfo/add-jquery.dep</span>
<a href="#l1.3"></a><span id="l1.3" class="difflineat">@@ -1,1 +1,1 @@</span>
<a href="#l1.4"></a><span id="l1.4" class="difflineminus">-c6a1b52b3e3f7bfb72984e227c821aff3d1c59d5</span>
<a href="#l1.5"></a><span id="l1.5">\ No newline at end of file</span>
<a href="#l1.6"></a><span id="l1.6" class="difflineplus">+3786d789303cc727aabf6728454556705232a33e</span>
<a href="#l1.7"></a><span id="l1.7">\ No newline at end of file</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l2.1"></a><span id="l2.1" class="difflineminus">--- a/.hgpatchinfo/add-protovis.dep</span>
<a href="#l2.2"></a><span id="l2.2" class="difflineplus">+++ b/.hgpatchinfo/add-protovis.dep</span>
<a href="#l2.3"></a><span id="l2.3" class="difflineat">@@ -1,1 +1,1 @@</span>
<a href="#l2.4"></a><span id="l2.4" class="difflineminus">-b11a45aa831d50594e7f23968bda9bc010103ef1</span>
<a href="#l2.5"></a><span id="l2.5">\ No newline at end of file</span>
<a href="#l2.6"></a><span id="l2.6" class="difflineplus">+23f393649289dd4774ddd1d231b01e1de8a75cfe</span>
<a href="#l2.7"></a><span id="l2.7">\ No newline at end of file</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l3.1"></a><span id="l3.1" class="difflineminus">--- a/.hgpatchinfo/gloda-facet.dep</span>
<a href="#l3.2"></a><span id="l3.2" class="difflineplus">+++ b/.hgpatchinfo/gloda-facet.dep</span>
<a href="#l3.3"></a><span id="l3.3" class="difflineat">@@ -1,1 +1,1 @@</span>
<a href="#l3.4"></a><span id="l3.4" class="difflineminus">-b7a1e8bc053a177768b2af5c4c8c3176163a1321</span>
<a href="#l3.5"></a><span id="l3.5">\ No newline at end of file</span>
<a href="#l3.6"></a><span id="l3.6" class="difflineplus">+45fbab07d8b3e6cf7fb227e5783b1a5dcdc141d5</span>
<a href="#l3.7"></a><span id="l3.7">\ No newline at end of file</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l4.1"></a><span id="l4.1" class="difflineminus">--- a/calendar/base/content/calendar-month-view.xml</span>
<a href="#l4.2"></a><span id="l4.2" class="difflineplus">+++ b/calendar/base/content/calendar-month-view.xml</span>
<a href="#l4.3"></a><span id="l4.3" class="difflineat">@@ -78,19 +78,17 @@</span>
<a href="#l4.4"></a><span id="l4.4">                              class=&quot;calendar-month-day-box-item-label&quot;</span>
<a href="#l4.5"></a><span id="l4.5">                              xbl:inherits=&quot;context&quot;/&gt;</span>
<a href="#l4.6"></a><span id="l4.6">                   &lt;xul:vbox align=&quot;left&quot;</span>
<a href="#l4.7"></a><span id="l4.7">                             flex=&quot;1&quot;</span>
<a href="#l4.8"></a><span id="l4.8">                             xbl:inherits=&quot;context&quot;&gt;</span>
<a href="#l4.9"></a><span id="l4.9">                     &lt;xul:label anonid=&quot;event-name&quot;</span>
<a href="#l4.10"></a><span id="l4.10">                                crop=&quot;end&quot;</span>
<a href="#l4.11"></a><span id="l4.11">                                flex=&quot;1&quot;</span>
<a href="#l4.12"></a><span id="l4.12" class="difflineminus">-                               style=&quot;margin: 0;&quot;&gt;</span>
<a href="#l4.13"></a><span id="l4.13" class="difflineminus">-                        &lt;html:div anonid=&quot;event-name-div&quot;/&gt;</span>
<a href="#l4.14"></a><span id="l4.14" class="difflineminus">-                    &lt;/xul:label&gt;</span>
<a href="#l4.15"></a><span id="l4.15" class="difflineplus">+                               style=&quot;margin: 0;&quot;/&gt;</span>
<a href="#l4.16"></a><span id="l4.16">                     &lt;xul:textbox anonid=&quot;event-name-textbox&quot;</span>
<a href="#l4.17"></a><span id="l4.17">                                  class=&quot;plain calendar-event-name-textbox&quot;</span>
<a href="#l4.18"></a><span id="l4.18">                                  crop=&quot;end&quot;</span>
<a href="#l4.19"></a><span id="l4.19">                                  hidden=&quot;true&quot;</span>
<a href="#l4.20"></a><span id="l4.20">                                  wrap=&quot;true&quot;/&gt;</span>
<a href="#l4.21"></a><span id="l4.21">                     &lt;xul:spacer flex=&quot;1&quot;/&gt;</span>
<a href="#l4.22"></a><span id="l4.22">                   &lt;/xul:vbox&gt;</span>
<a href="#l4.23"></a><span id="l4.23">                   &lt;xul:stack&gt;</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l5.1"></a><span id="l5.1" class="difflineminus">--- a/calendar/base/content/calendar-multiday-view.xml</span>
<a href="#l5.2"></a><span id="l5.2" class="difflineplus">+++ b/calendar/base/content/calendar-multiday-view.xml</span>
<a href="#l5.3"></a><span id="l5.3" class="difflineat">@@ -1908,20 +1908,17 @@</span>
<a href="#l5.4"></a><span id="l5.4">             &lt;xul:box class=&quot;calendar-event-selection&quot; orient=&quot;horizontal&quot; flex=&quot;1&quot;&gt;</span>
<a href="#l5.5"></a><span id="l5.5">               &lt;xul:stack anonid=&quot;eventbox&quot;</span>
<a href="#l5.6"></a><span id="l5.6">                          align=&quot;stretch&quot;</span>
<a href="#l5.7"></a><span id="l5.7">                          class=&quot;calendar-event-box-container&quot;</span>
<a href="#l5.8"></a><span id="l5.8">                          flex=&quot;1&quot;</span>
<a href="#l5.9"></a><span id="l5.9">                          xbl:inherits=&quot;context,parentorient=orient,readonly,flashing,alarm,allday,priority,progress,status,calendar,categories&quot;&gt;</span>
<a href="#l5.10"></a><span id="l5.10">                 &lt;xul:image flex=&quot;1&quot; class=&quot;calendar-event-box-gradient&quot;/&gt;</span>
<a href="#l5.11"></a><span id="l5.11">                 &lt;xul:vbox class=&quot;calendar-event-details&quot; anonid=&quot;calendar-event-details&quot;&gt;</span>
<a href="#l5.12"></a><span id="l5.12" class="difflineminus">-                  &lt;xul:description anonid=&quot;event-name&quot; class=&quot;calendar-event-details-core&quot; flex=&quot;1&quot;&gt;</span>
<a href="#l5.13"></a><span id="l5.13" class="difflineminus">-                    &lt;html:div anonid=&quot;event-name-div&quot;/&gt;</span>
<a href="#l5.14"></a><span id="l5.14" class="difflineminus">-                  &lt;/xul:description&gt;</span>
<a href="#l5.15"></a><span id="l5.15" class="difflineminus">-</span>
<a href="#l5.16"></a><span id="l5.16" class="difflineplus">+                  &lt;xul:description anonid=&quot;event-name&quot; class=&quot;calendar-event-details-core&quot; flex=&quot;1&quot;/&gt;</span>
<a href="#l5.17"></a><span id="l5.17">                   &lt;xul:textbox anonid=&quot;event-name-textbox&quot;</span>
<a href="#l5.18"></a><span id="l5.18">                                class=&quot;plain calendar-event-details-core calendar-event-name-textbox&quot;</span>
<a href="#l5.19"></a><span id="l5.19">                                flex=&quot;1&quot;</span>
<a href="#l5.20"></a><span id="l5.20">                                hidden=&quot;true&quot;</span>
<a href="#l5.21"></a><span id="l5.21">                                wrap=&quot;true&quot;/&gt;</span>
<a href="#l5.22"></a><span id="l5.22">                 &lt;/xul:vbox&gt;</span>
<a href="#l5.23"></a><span id="l5.23">                 &lt;xul:stack mousethrough=&quot;always&quot;&gt;</span>
<a href="#l5.24"></a><span id="l5.24">                   &lt;xul:calendar-category-box anonid=&quot;category-box&quot; xbl:inherits=&quot;categories&quot; pack=&quot;end&quot; /&gt;</span>
<a href="#l5.25"></a><span id="l5.25" class="difflineat">@@ -2028,34 +2025,29 @@</span>
<a href="#l5.26"></a><span id="l5.26">                 return 0;</span>
<a href="#l5.27"></a><span id="l5.27">             var endDate = this.mOccurrence.endDate || this.mOccurrence.dueDate;</span>
<a href="#l5.28"></a><span id="l5.28">             return endDate.hour * 60 + endDate.minute;</span>
<a href="#l5.29"></a><span id="l5.29">         ]]&gt;&lt;/getter&gt;</span>
<a href="#l5.30"></a><span id="l5.30">       &lt;/property&gt;</span>
<a href="#l5.31"></a><span id="l5.31"> </span>
<a href="#l5.32"></a><span id="l5.32">       &lt;method name=&quot;setEditableLabel&quot;&gt;</span>
<a href="#l5.33"></a><span id="l5.33">         &lt;body&gt;&lt;![CDATA[</span>
<a href="#l5.34"></a><span id="l5.34" class="difflineminus">-          let evldiv = document.getAnonymousElementByAttribute(this, &quot;anonid&quot;, &quot;event-name-div&quot;);</span>
<a href="#l5.35"></a><span id="l5.35" class="difflineminus">-          let item = this.mOccurrence;</span>
<a href="#l5.36"></a><span id="l5.36" class="difflineplus">+          var evl = this.eventNameLabel;</span>
<a href="#l5.37"></a><span id="l5.37" class="difflineplus">+          var item = this.mOccurrence;</span>
<a href="#l5.38"></a><span id="l5.38"> </span>
<a href="#l5.39"></a><span id="l5.39">           if (item.title &amp;&amp; item.title != &quot;&quot;) {</span>
<a href="#l5.40"></a><span id="l5.40">             // Use &lt;description&gt; textContent so it can wrap.</span>
<a href="#l5.41"></a><span id="l5.41" class="difflineminus">-            evldiv.textContent = item.title;</span>
<a href="#l5.42"></a><span id="l5.42" class="difflineplus">+            evl.textContent = item.title;</span>
<a href="#l5.43"></a><span id="l5.43">           } else {</span>
<a href="#l5.44"></a><span id="l5.44" class="difflineminus">-            evldiv.textContent = calGetString(&quot;calendar&quot;, &quot;eventUntitled&quot;);</span>
<a href="#l5.45"></a><span id="l5.45" class="difflineplus">+            evl.textContent = calGetString(&quot;calendar&quot;, &quot;eventUntitled&quot;);</span>
<a href="#l5.46"></a><span id="l5.46">           }</span>
<a href="#l5.47"></a><span id="l5.47"> </span>
<a href="#l5.48"></a><span id="l5.48">           var gripbar = document.getAnonymousElementByAttribute(this, &quot;anonid&quot;, &quot;gripbar1&quot;).boxObject.height;</span>
<a href="#l5.49"></a><span id="l5.49">           var height = document.getAnonymousElementByAttribute(this, &quot;anonid&quot;, &quot;eventbox&quot;).boxObject.height;</span>
<a href="#l5.50"></a><span id="l5.50" class="difflineminus">-          </span>
<a href="#l5.51"></a><span id="l5.51" class="difflineminus">-          if(this.orient == &quot;vertical&quot;) {</span>
<a href="#l5.52"></a><span id="l5.52" class="difflineminus">-            evldiv.setAttribute(&quot;style&quot;, &quot;max-height: &quot; + Math.max(0, height-gripbar*2) + &quot;px&quot;);</span>
<a href="#l5.53"></a><span id="l5.53" class="difflineminus">-          } else {</span>
<a href="#l5.54"></a><span id="l5.54" class="difflineminus">-            evldiv.setAttribute(&quot;style&quot;, &quot;max-height: &quot; + height + &quot;px&quot;);</span>
<a href="#l5.55"></a><span id="l5.55" class="difflineminus">-          }</span>
<a href="#l5.56"></a><span id="l5.56" class="difflineplus">+          evl.setAttribute(&quot;style&quot;, &quot;max-height: &quot; + Math.max(0, height-gripbar*2) + &quot;px&quot;);</span>
<a href="#l5.57"></a><span id="l5.57">         ]]&gt;&lt;/body&gt;</span>
<a href="#l5.58"></a><span id="l5.58">       &lt;/method&gt;</span>
<a href="#l5.59"></a><span id="l5.59">     &lt;/implementation&gt;</span>
<a href="#l5.60"></a><span id="l5.60"> </span>
<a href="#l5.61"></a><span id="l5.61">     &lt;handlers&gt;</span>
<a href="#l5.62"></a><span id="l5.62">       &lt;handler event=&quot;mousedown&quot; button=&quot;0&quot;&gt;&lt;![CDATA[</span>
<a href="#l5.63"></a><span id="l5.63">         event.stopPropagation();</span>
<a href="#l5.64"></a><span id="l5.64"> </span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l6.1"></a><span id="l6.1" class="difflineminus">--- a/calendar/base/content/calendar-view-core.xml</span>
<a href="#l6.2"></a><span id="l6.2" class="difflineplus">+++ b/calendar/base/content/calendar-view-core.xml</span>
<a href="#l6.3"></a><span id="l6.3" class="difflineat">@@ -63,19 +63,17 @@</span>
<a href="#l6.4"></a><span id="l6.4">                          xbl:inherits=&quot;readonly,flashing,alarm,allday,priority,progress,status,calendar,categories&quot;&gt;</span>
<a href="#l6.5"></a><span id="l6.5">                 &lt;xul:hbox class=&quot;calendar-event-details&quot;&gt;</span>
<a href="#l6.6"></a><span id="l6.6">                   &lt;xul:vbox align=&quot;left&quot;</span>
<a href="#l6.7"></a><span id="l6.7">                             flex=&quot;1&quot;</span>
<a href="#l6.8"></a><span id="l6.8">                             xbl:inherits=&quot;context&quot;&gt;</span>
<a href="#l6.9"></a><span id="l6.9">                     &lt;xul:label anonid=&quot;event-name&quot;</span>
<a href="#l6.10"></a><span id="l6.10">                                crop=&quot;end&quot;</span>
<a href="#l6.11"></a><span id="l6.11">                                flex=&quot;1&quot;</span>
<a href="#l6.12"></a><span id="l6.12" class="difflineminus">-                               style=&quot;margin: 0;&quot;&gt;</span>
<a href="#l6.13"></a><span id="l6.13" class="difflineminus">-                      &lt;html:div anonid=&quot;event-name-div&quot;/&gt;</span>
<a href="#l6.14"></a><span id="l6.14" class="difflineminus">-                    &lt;/xul:label&gt;</span>
<a href="#l6.15"></a><span id="l6.15" class="difflineplus">+                               style=&quot;margin: 0;&quot;/&gt;</span>
<a href="#l6.16"></a><span id="l6.16">                     &lt;xul:textbox anonid=&quot;event-name-textbox&quot;</span>
<a href="#l6.17"></a><span id="l6.17">                                  class=&quot;plain&quot;</span>
<a href="#l6.18"></a><span id="l6.18">                                  crop=&quot;end&quot;</span>
<a href="#l6.19"></a><span id="l6.19">                                  hidden=&quot;true&quot;</span>
<a href="#l6.20"></a><span id="l6.20">                                  style=&quot;background: transparent !important;&quot;</span>
<a href="#l6.21"></a><span id="l6.21">                                  wrap=&quot;true&quot;/&gt;</span>
<a href="#l6.22"></a><span id="l6.22">                     &lt;xul:spacer flex=&quot;1&quot;/&gt;</span>
<a href="#l6.23"></a><span id="l6.23">                   &lt;/xul:vbox&gt;</span>
<a href="#l6.24"></a><span id="l6.24" class="difflineat">@@ -173,23 +171,23 @@</span>
<a href="#l6.25"></a><span id="l6.25"> </span>
<a href="#l6.26"></a><span id="l6.26">       &lt;property name=&quot;eventNameLabel&quot; readonly=&quot;true&quot;</span>
<a href="#l6.27"></a><span id="l6.27">         onget=&quot;return document.getAnonymousElementByAttribute(this, 'anonid', 'event-name');&quot;/&gt;</span>
<a href="#l6.28"></a><span id="l6.28">       &lt;property name=&quot;eventNameTextbox&quot; readonly=&quot;true&quot;</span>
<a href="#l6.29"></a><span id="l6.29">         onget=&quot;return document.getAnonymousElementByAttribute(this, 'anonid', 'event-name-textbox');&quot;/&gt;</span>
<a href="#l6.30"></a><span id="l6.30"> </span>
<a href="#l6.31"></a><span id="l6.31">       &lt;method name=&quot;setEditableLabel&quot;&gt;</span>
<a href="#l6.32"></a><span id="l6.32">         &lt;body&gt;&lt;![CDATA[</span>
<a href="#l6.33"></a><span id="l6.33" class="difflineminus">-          let evldiv = document.getAnonymousElementByAttribute(this, &quot;anonid&quot;, &quot;event-name-div&quot;);</span>
<a href="#l6.34"></a><span id="l6.34" class="difflineminus">-          let item = this.mOccurrence;</span>
<a href="#l6.35"></a><span id="l6.35" class="difflineplus">+          var evl = this.eventNameLabel;</span>
<a href="#l6.36"></a><span id="l6.36" class="difflineplus">+          var item = this.mOccurrence;</span>
<a href="#l6.37"></a><span id="l6.37"> </span>
<a href="#l6.38"></a><span id="l6.38">           if (item.title &amp;&amp; item.title != &quot;&quot;) {</span>
<a href="#l6.39"></a><span id="l6.39" class="difflineminus">-            evldiv.textContent = item.title;</span>
<a href="#l6.40"></a><span id="l6.40" class="difflineplus">+            evl.value = item.title;</span>
<a href="#l6.41"></a><span id="l6.41">           } else {</span>
<a href="#l6.42"></a><span id="l6.42" class="difflineminus">-            evldiv.textContent = calGetString(&quot;calendar&quot;, &quot;eventUntitled&quot;);</span>
<a href="#l6.43"></a><span id="l6.43" class="difflineplus">+            evl.value = calGetString(&quot;calendar&quot;, &quot;eventUntitled&quot;)</span>
<a href="#l6.44"></a><span id="l6.44">           }</span>
<a href="#l6.45"></a><span id="l6.45">         ]]&gt;&lt;/body&gt;</span>
<a href="#l6.46"></a><span id="l6.46">       &lt;/method&gt;</span>
<a href="#l6.47"></a><span id="l6.47"> </span>
<a href="#l6.48"></a><span id="l6.48">       &lt;method name=&quot;setCSSClasses&quot;&gt;</span>
<a href="#l6.49"></a><span id="l6.49">         &lt;body&gt;&lt;![CDATA[</span>
<a href="#l6.50"></a><span id="l6.50">           var item = this.mOccurrence;          </span>
<a href="#l6.51"></a><span id="l6.51">           this.setAttribute(&quot;calendar-uri&quot;, item.calendar.uri.spec);</span>
<a href="#l6.52"></a><span id="l6.52" class="difflineat">@@ -239,17 +237,17 @@</span>
<a href="#l6.53"></a><span id="l6.53">           if (item.priority &gt; 0 &amp;&amp; item.priority &lt; 5) {</span>
<a href="#l6.54"></a><span id="l6.54">               this.setAttribute(&quot;priority&quot;, &quot;high&quot;);</span>
<a href="#l6.55"></a><span id="l6.55">           } else if (item.priority &gt; 5 &amp;&amp; item.priority &lt; 10) {</span>
<a href="#l6.56"></a><span id="l6.56">               this.setAttribute(&quot;priority&quot;, &quot;low&quot;);</span>
<a href="#l6.57"></a><span id="l6.57">           }</span>
<a href="#l6.58"></a><span id="l6.58"> </span>
<a href="#l6.59"></a><span id="l6.59">           // status attribute</span>
<a href="#l6.60"></a><span id="l6.60">           if (item.status) {</span>
<a href="#l6.61"></a><span id="l6.61" class="difflineminus">-              this.setAttribute(&quot;status&quot;, item.status.toUpperCase());</span>
<a href="#l6.62"></a><span id="l6.62" class="difflineplus">+              this.setAttribute(&quot;status&quot;, item.status.toLowerCase());</span>
<a href="#l6.63"></a><span id="l6.63">           }</span>
<a href="#l6.64"></a><span id="l6.64"> </span>
<a href="#l6.65"></a><span id="l6.65">           // calendar name</span>
<a href="#l6.66"></a><span id="l6.66">           this.setAttribute(&quot;calendar&quot;, item.calendar.name.toLowerCase());</span>
<a href="#l6.67"></a><span id="l6.67"> </span>
<a href="#l6.68"></a><span id="l6.68">           // Invitation</span>
<a href="#l6.69"></a><span id="l6.69">           if (item.calendar instanceof Components.interfaces.calISchedulingSupport &amp;&amp;</span>
<a href="#l6.70"></a><span id="l6.70">               item.calendar.isInvitation(item)) {</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l7.1"></a><span id="l7.1" class="difflineminus">--- a/calendar/base/modules/calProviderUtils.jsm</span>
<a href="#l7.2"></a><span id="l7.2" class="difflineplus">+++ b/calendar/base/modules/calProviderUtils.jsm</span>
<a href="#l7.3"></a><span id="l7.3" class="difflineat">@@ -413,16 +413,49 @@ cal.toRFC3339 = function toRFC3339(aDate</span>
<a href="#l7.4"></a><span id="l7.4">             // ZULU Time, according to ISO8601's timezone-offset</span>
<a href="#l7.5"></a><span id="l7.5">             str += &quot;Z&quot;;</span>
<a href="#l7.6"></a><span id="l7.6">         }</span>
<a href="#l7.7"></a><span id="l7.7">     }</span>
<a href="#l7.8"></a><span id="l7.8">     return str;</span>
<a href="#l7.9"></a><span id="l7.9"> };</span>
<a href="#l7.10"></a><span id="l7.10"> </span>
<a href="#l7.11"></a><span id="l7.11"> /**</span>
<a href="#l7.12"></a><span id="l7.12" class="difflineplus">+ * Observer bag implementation taking care to replay open batch notifications.</span>
<a href="#l7.13"></a><span id="l7.13" class="difflineplus">+ */</span>
<a href="#l7.14"></a><span id="l7.14" class="difflineplus">+cal.observerBag = function calObserverBag(iid) {</span>
<a href="#l7.15"></a><span id="l7.15" class="difflineplus">+    this.init(iid);</span>
<a href="#l7.16"></a><span id="l7.16" class="difflineplus">+};</span>
<a href="#l7.17"></a><span id="l7.17" class="difflineplus">+cal.observerBag.prototype = {</span>
<a href="#l7.18"></a><span id="l7.18" class="difflineplus">+    __proto__: cal.calListenerBag.prototype,</span>
<a href="#l7.19"></a><span id="l7.19" class="difflineplus">+</span>
<a href="#l7.20"></a><span id="l7.20" class="difflineplus">+    mBatchCount: 0,</span>
<a href="#l7.21"></a><span id="l7.21" class="difflineplus">+    notify: function calObserverBag_notify(func, args) {</span>
<a href="#l7.22"></a><span id="l7.22" class="difflineplus">+        switch (func) {</span>
<a href="#l7.23"></a><span id="l7.23" class="difflineplus">+            case &quot;onStartBatch&quot;:</span>
<a href="#l7.24"></a><span id="l7.24" class="difflineplus">+                 ++this.mBatchCount;</span>
<a href="#l7.25"></a><span id="l7.25" class="difflineplus">+                 break;</span>
<a href="#l7.26"></a><span id="l7.26" class="difflineplus">+            case &quot;onEndBatch&quot;:</span>
<a href="#l7.27"></a><span id="l7.27" class="difflineplus">+                 --this.mBatchCount;</span>
<a href="#l7.28"></a><span id="l7.28" class="difflineplus">+                 break;</span>
<a href="#l7.29"></a><span id="l7.29" class="difflineplus">+        }</span>
<a href="#l7.30"></a><span id="l7.30" class="difflineplus">+        return this.__proto__.__proto__.notify.apply(this, arguments);</span>
<a href="#l7.31"></a><span id="l7.31" class="difflineplus">+    },</span>
<a href="#l7.32"></a><span id="l7.32" class="difflineplus">+</span>
<a href="#l7.33"></a><span id="l7.33" class="difflineplus">+    add: function calObserverBag_add(iface) {</span>
<a href="#l7.34"></a><span id="l7.34" class="difflineplus">+        if (this.__proto__.__proto__.add.apply(this, arguments) &amp;&amp; (this.mBatchCount &gt; 0)) {</span>
<a href="#l7.35"></a><span id="l7.35" class="difflineplus">+            // Replay batch notifications, because the onEndBatch notifications are yet to come.</span>
<a href="#l7.36"></a><span id="l7.36" class="difflineplus">+            // We may think about doing the reverse on remove, though I currently see no need:</span>
<a href="#l7.37"></a><span id="l7.37" class="difflineplus">+            for (var i = this.mBatchCount; i--;) {</span>
<a href="#l7.38"></a><span id="l7.38" class="difflineplus">+                iface.onStartBatch();</span>
<a href="#l7.39"></a><span id="l7.39" class="difflineplus">+            }</span>
<a href="#l7.40"></a><span id="l7.40" class="difflineplus">+        }</span>
<a href="#l7.41"></a><span id="l7.41" class="difflineplus">+    }</span>
<a href="#l7.42"></a><span id="l7.42" class="difflineplus">+};</span>
<a href="#l7.43"></a><span id="l7.43" class="difflineplus">+</span>
<a href="#l7.44"></a><span id="l7.44" class="difflineplus">+/**</span>
<a href="#l7.45"></a><span id="l7.45">  * Base prototype to be used implementing a provider.</span>
<a href="#l7.46"></a><span id="l7.46">  *</span>
<a href="#l7.47"></a><span id="l7.47">  * @see e.g. providers/gdata</span>
<a href="#l7.48"></a><span id="l7.48">  */</span>
<a href="#l7.49"></a><span id="l7.49"> cal.ProviderBase = function calProviderBase() {</span>
<a href="#l7.50"></a><span id="l7.50">     cal.ASSERT(&quot;This prototype should only be inherited!&quot;);</span>
<a href="#l7.51"></a><span id="l7.51"> };</span>
<a href="#l7.52"></a><span id="l7.52"> cal.ProviderBase.mTransientProperties = {</span>
<a href="#l7.53"></a><span id="l7.53" class="difflineat">@@ -445,17 +478,17 @@ cal.ProviderBase.prototype = {</span>
<a href="#l7.54"></a><span id="l7.54"> </span>
<a href="#l7.55"></a><span id="l7.55">     mID: null,</span>
<a href="#l7.56"></a><span id="l7.56">     mUri: null,</span>
<a href="#l7.57"></a><span id="l7.57">     mObservers: null,</span>
<a href="#l7.58"></a><span id="l7.58">     mProperties: null,</span>
<a href="#l7.59"></a><span id="l7.59"> </span>
<a href="#l7.60"></a><span id="l7.60">     initProviderBase: function cPB_initProviderBase() {</span>
<a href="#l7.61"></a><span id="l7.61">         this.wrappedJSObject = this;</span>
<a href="#l7.62"></a><span id="l7.62" class="difflineminus">-        this.mObservers = new cal.calListenerBag(Components.interfaces.calIObserver);</span>
<a href="#l7.63"></a><span id="l7.63" class="difflineplus">+        this.mObservers = new cal.observerBag(Components.interfaces.calIObserver);</span>
<a href="#l7.64"></a><span id="l7.64">         this.mProperties = {};</span>
<a href="#l7.65"></a><span id="l7.65">         this.mProperties.currentStatus = Components.results.NS_OK;</span>
<a href="#l7.66"></a><span id="l7.66">     },</span>
<a href="#l7.67"></a><span id="l7.67"> </span>
<a href="#l7.68"></a><span id="l7.68">     get observers cPB_observers_get() {</span>
<a href="#l7.69"></a><span id="l7.69">         return this.mObservers;</span>
<a href="#l7.70"></a><span id="l7.70">     },</span>
<a href="#l7.71"></a><span id="l7.71"> </span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l8.1"></a><span id="l8.1" class="difflineminus">--- a/calendar/base/src/calAlarm.js</span>
<a href="#l8.2"></a><span id="l8.2" class="difflineplus">+++ b/calendar/base/src/calAlarm.js</span>
<a href="#l8.3"></a><span id="l8.3" class="difflineat">@@ -603,16 +603,18 @@ calAlarm.prototype = {</span>
<a href="#l8.4"></a><span id="l8.4">             let formatDate = this.mAbsoluteDate.getInTimezone(cal.calendarDefaultTimezone());</span>
<a href="#l8.5"></a><span id="l8.5">             return formatter.formatDateTime(formatDate);</span>
<a href="#l8.6"></a><span id="l8.6">         } else if (this.related != ALARM_RELATED_ABSOLUTE &amp;&amp; this.mOffset) {</span>
<a href="#l8.7"></a><span id="l8.7">             function getItemBundleStringName(aPrefix) {</span>
<a href="#l8.8"></a><span id="l8.8">                 if (!aItem || isEvent(aItem)) {</span>
<a href="#l8.9"></a><span id="l8.9">                     return aPrefix + &quot;Event&quot;;</span>
<a href="#l8.10"></a><span id="l8.10">                 } else if (isToDo(aItem)) {</span>
<a href="#l8.11"></a><span id="l8.11">                     return aPrefix + &quot;Task&quot;;</span>
<a href="#l8.12"></a><span id="l8.12" class="difflineplus">+                } else {</span>
<a href="#l8.13"></a><span id="l8.13" class="difflineplus">+                    return aPrefix;</span>
<a href="#l8.14"></a><span id="l8.14">                 }</span>
<a href="#l8.15"></a><span id="l8.15">             }</span>
<a href="#l8.16"></a><span id="l8.16"> </span>
<a href="#l8.17"></a><span id="l8.17">             // Relative alarm length</span>
<a href="#l8.18"></a><span id="l8.18">             let alarmlen = Math.abs(this.mOffset.inSeconds / 60);</span>
<a href="#l8.19"></a><span id="l8.19">             if (alarmlen == 0) {</span>
<a href="#l8.20"></a><span id="l8.20">                 // No need to get the other information if the alarm is at the start</span>
<a href="#l8.21"></a><span id="l8.21">                 // of the event/task.</span>
<a href="#l8.22"></a><span id="l8.22" class="difflineat">@@ -658,11 +660,15 @@ calAlarm.prototype = {</span>
<a href="#l8.23"></a><span id="l8.23">             }</span>
<a href="#l8.24"></a><span id="l8.24"> </span>
<a href="#l8.25"></a><span id="l8.25">             let originString = calGetString(&quot;calendar-alarms&quot;,</span>
<a href="#l8.26"></a><span id="l8.26">                                             getItemBundleStringName(originStringName));</span>
<a href="#l8.27"></a><span id="l8.27">             return calGetString(&quot;calendar-alarms&quot;,</span>
<a href="#l8.28"></a><span id="l8.28">                                 &quot;reminderCustomTitle&quot;,</span>
<a href="#l8.29"></a><span id="l8.29">                                 [unitString, originString]);</span>
<a href="#l8.30"></a><span id="l8.30">                                 </span>
<a href="#l8.31"></a><span id="l8.31" class="difflineplus">+        } else {</span>
<a href="#l8.32"></a><span id="l8.32" class="difflineplus">+            // This is an incomplete alarm, but then again we should never reach</span>
<a href="#l8.33"></a><span id="l8.33" class="difflineplus">+            // this state.</span>
<a href="#l8.34"></a><span id="l8.34" class="difflineplus">+            return &quot;[Incomplete calIAlarm]&quot;;</span>
<a href="#l8.35"></a><span id="l8.35">         }</span>
<a href="#l8.36"></a><span id="l8.36">     }</span>
<a href="#l8.37"></a><span id="l8.37"> };</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l9.1"></a><span id="l9.1" class="difflineminus">--- a/calendar/base/src/calCachedCalendar.js</span>
<a href="#l9.2"></a><span id="l9.2" class="difflineplus">+++ b/calendar/base/src/calCachedCalendar.js</span>
<a href="#l9.3"></a><span id="l9.3" class="difflineat">@@ -30,16 +30,18 @@</span>
<a href="#l9.4"></a><span id="l9.4">  * use your version of this file under the terms of the MPL, indicate your</span>
<a href="#l9.5"></a><span id="l9.5">  * decision by deleting the provisions above and replace them with the notice</span>
<a href="#l9.6"></a><span id="l9.6">  * and other provisions required by the GPL or the LGPL. If you do not delete</span>
<a href="#l9.7"></a><span id="l9.7">  * the provisions above, a recipient may use your version of this file under</span>
<a href="#l9.8"></a><span id="l9.8">  * the terms of any one of the MPL, the GPL or the LGPL.</span>
<a href="#l9.9"></a><span id="l9.9">  *</span>
<a href="#l9.10"></a><span id="l9.10">  * ***** END LICENSE BLOCK ***** */</span>
<a href="#l9.11"></a><span id="l9.11"> </span>
<a href="#l9.12"></a><span id="l9.12" class="difflineplus">+Components.utils.import(&quot;resource://calendar/modules/calProviderUtils.jsm&quot;);</span>
<a href="#l9.13"></a><span id="l9.13" class="difflineplus">+</span>
<a href="#l9.14"></a><span id="l9.14"> function calCachedCalendarObserverHelper(home, isCachedObserver) {</span>
<a href="#l9.15"></a><span id="l9.15">     this.home = home;</span>
<a href="#l9.16"></a><span id="l9.16">     this.isCachedObserver = isCachedObserver;</span>
<a href="#l9.17"></a><span id="l9.17"> }</span>
<a href="#l9.18"></a><span id="l9.18"> calCachedCalendarObserverHelper.prototype = {</span>
<a href="#l9.19"></a><span id="l9.19">     isCachedObserver: false,</span>
<a href="#l9.20"></a><span id="l9.20"> </span>
<a href="#l9.21"></a><span id="l9.21">     onStartBatch: function() {</span>
<a href="#l9.22"></a><span id="l9.22" class="difflineat">@@ -99,17 +101,17 @@ calCachedCalendarObserverHelper.prototyp</span>
<a href="#l9.23"></a><span id="l9.23">             this.home.mObservers.notify(&quot;onPropertyDeleting&quot;, [this.home, aName]);</span>
<a href="#l9.24"></a><span id="l9.24">         }</span>
<a href="#l9.25"></a><span id="l9.25">     }</span>
<a href="#l9.26"></a><span id="l9.26"> };</span>
<a href="#l9.27"></a><span id="l9.27"> </span>
<a href="#l9.28"></a><span id="l9.28"> function calCachedCalendar(uncachedCalendar) {</span>
<a href="#l9.29"></a><span id="l9.29">     this.wrappedJSObject = this;</span>
<a href="#l9.30"></a><span id="l9.30">     this.mSyncQueue = [];</span>
<a href="#l9.31"></a><span id="l9.31" class="difflineminus">-    this.mObservers = new calListenerBag(Components.interfaces.calIObserver);</span>
<a href="#l9.32"></a><span id="l9.32" class="difflineplus">+    this.mObservers = new cal.observerBag(Components.interfaces.calIObserver);</span>
<a href="#l9.33"></a><span id="l9.33">     uncachedCalendar.superCalendar = this;</span>
<a href="#l9.34"></a><span id="l9.34">     uncachedCalendar.addObserver(new calCachedCalendarObserverHelper(this, false));</span>
<a href="#l9.35"></a><span id="l9.35">     this.mUncachedCalendar = uncachedCalendar;</span>
<a href="#l9.36"></a><span id="l9.36">     this.setupCachedCalendar();</span>
<a href="#l9.37"></a><span id="l9.37"> </span>
<a href="#l9.38"></a><span id="l9.38">     if (this.supportsChangeLog) {</span>
<a href="#l9.39"></a><span id="l9.39">         var updateTimer = this.getProperty(&quot;cache.updateTimer&quot;);</span>
<a href="#l9.40"></a><span id="l9.40">         if (updateTimer === null) {</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l10.1"></a><span id="l10.1" class="difflineminus">--- a/calendar/base/src/calUtils.js</span>
<a href="#l10.2"></a><span id="l10.2" class="difflineplus">+++ b/calendar/base/src/calUtils.js</span>
<a href="#l10.3"></a><span id="l10.3" class="difflineat">@@ -1185,18 +1185,20 @@ calInterfaceBag.prototype = {</span>
<a href="#l10.4"></a><span id="l10.4">     add: function calInterfaceBag_add(iface) {</span>
<a href="#l10.5"></a><span id="l10.5">         if (iface) {</span>
<a href="#l10.6"></a><span id="l10.6">             var iid = this.mIid;</span>
<a href="#l10.7"></a><span id="l10.7">             function eq(obj) {</span>
<a href="#l10.8"></a><span id="l10.8">                 return compareObjects(obj, iface, iid);</span>
<a href="#l10.9"></a><span id="l10.9">             }</span>
<a href="#l10.10"></a><span id="l10.10">             if (!this.mInterfaces.some(eq)) {</span>
<a href="#l10.11"></a><span id="l10.11">                 this.mInterfaces.push(iface);</span>
<a href="#l10.12"></a><span id="l10.12" class="difflineplus">+                return true;</span>
<a href="#l10.13"></a><span id="l10.13">             }</span>
<a href="#l10.14"></a><span id="l10.14">         }</span>
<a href="#l10.15"></a><span id="l10.15" class="difflineplus">+        return false;</span>
<a href="#l10.16"></a><span id="l10.16">     },</span>
<a href="#l10.17"></a><span id="l10.17"> </span>
<a href="#l10.18"></a><span id="l10.18">     remove: function calInterfaceBag_remove(iface) {</span>
<a href="#l10.19"></a><span id="l10.19">         if (iface) {</span>
<a href="#l10.20"></a><span id="l10.20">             var iid = this.mIid;</span>
<a href="#l10.21"></a><span id="l10.21">             function neq(obj) {</span>
<a href="#l10.22"></a><span id="l10.22">                 return !compareObjects(obj, iface, iid);</span>
<a href="#l10.23"></a><span id="l10.23">             }</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l11.1"></a><span id="l11.1" class="difflineminus">--- a/calendar/base/themes/pinstripe/calendar-views.css</span>
<a href="#l11.2"></a><span id="l11.2" class="difflineplus">+++ b/calendar/base/themes/pinstripe/calendar-views.css</span>
<a href="#l11.3"></a><span id="l11.3" class="difflineat">@@ -415,20 +415,16 @@ calendar-month-day-box-item[selected=&quot;tr</span>
<a href="#l11.4"></a><span id="l11.4">     background-color: #ffdb67 !important;</span>
<a href="#l11.5"></a><span id="l11.5"> }</span>
<a href="#l11.6"></a><span id="l11.6"> </span>
<a href="#l11.7"></a><span id="l11.7"> .calendar-color-box {</span>
<a href="#l11.8"></a><span id="l11.8">     /* This rule should be adopted if the alarm image size is changed */</span>
<a href="#l11.9"></a><span id="l11.9">     min-height: 13px;</span>
<a href="#l11.10"></a><span id="l11.10"> }</span>
<a href="#l11.11"></a><span id="l11.11"> </span>
<a href="#l11.12"></a><span id="l11.12" class="difflineminus">-calendar-month-day-box-item[selected=&quot;true&quot;] .calendar-color-box {</span>
<a href="#l11.13"></a><span id="l11.13" class="difflineminus">-    color: #000000;</span>
<a href="#l11.14"></a><span id="l11.14" class="difflineminus">-}</span>
<a href="#l11.15"></a><span id="l11.15" class="difflineminus">-</span>
<a href="#l11.16"></a><span id="l11.16"> .calendar-month-day-box-item-label {</span>
<a href="#l11.17"></a><span id="l11.17">     padding: 0px;</span>
<a href="#l11.18"></a><span id="l11.18">     margin: 0px;</span>
<a href="#l11.19"></a><span id="l11.19"> }</span>
<a href="#l11.20"></a><span id="l11.20"> </span>
<a href="#l11.21"></a><span id="l11.21"> .calendar-month-day-box-item-label[time=&quot;true&quot;] {</span>
<a href="#l11.22"></a><span id="l11.22">     -moz-margin-end: 4px;</span>
<a href="#l11.23"></a><span id="l11.23"> }</span>
<a href="#l11.24"></a><span id="l11.24" class="difflineat">@@ -589,34 +585,24 @@ calendar-event-box[invitation-status=&quot;NE</span>
<a href="#l11.25"></a><span id="l11.25"> calendar-editable-item[invitation-status=&quot;NEEDS-ACTION&quot;],</span>
<a href="#l11.26"></a><span id="l11.26"> calendar-month-day-box-item[invitation-status=&quot;NEEDS-ACTION&quot;] {</span>
<a href="#l11.27"></a><span id="l11.27">     border: 2px dotted black;</span>
<a href="#l11.28"></a><span id="l11.28">     opacity: 0.5;</span>
<a href="#l11.29"></a><span id="l11.29"> }</span>
<a href="#l11.30"></a><span id="l11.30"> </span>
<a href="#l11.31"></a><span id="l11.31"> calendar-event-box[invitation-status=&quot;TENTATIVE&quot;],</span>
<a href="#l11.32"></a><span id="l11.32"> calendar-editable-item[invitation-status=&quot;TENTATIVE&quot;],</span>
<a href="#l11.33"></a><span id="l11.33" class="difflineminus">-calendar-month-day-box-item[invitation-status=&quot;TENTATIVE&quot;],</span>
<a href="#l11.34"></a><span id="l11.34" class="difflineminus">-calendar-event-box[status=&quot;TENTATIVE&quot;],</span>
<a href="#l11.35"></a><span id="l11.35" class="difflineminus">-calendar-editable-item[status=&quot;TENTATIVE&quot;],</span>
<a href="#l11.36"></a><span id="l11.36" class="difflineminus">-calendar-month-day-box-item[status=&quot;TENTATIVE&quot;] {</span>
<a href="#l11.37"></a><span id="l11.37" class="difflineplus">+calendar-month-day-box-item[invitation-status=&quot;TENTATIVE&quot;] {</span>
<a href="#l11.38"></a><span id="l11.38">     opacity: 0.5;</span>
<a href="#l11.39"></a><span id="l11.39"> }</span>
<a href="#l11.40"></a><span id="l11.40"> </span>
<a href="#l11.41"></a><span id="l11.41"> calendar-event-box[invitation-status=&quot;DECLINED&quot;],</span>
<a href="#l11.42"></a><span id="l11.42"> calendar-editable-item[invitation-status=&quot;DECLINED&quot;],</span>
<a href="#l11.43"></a><span id="l11.43" class="difflineminus">-calendar-month-day-box-item[invitation-status=&quot;DECLINED&quot;],</span>
<a href="#l11.44"></a><span id="l11.44" class="difflineminus">-calendar-event-box[status=&quot;CANCELLED&quot;],</span>
<a href="#l11.45"></a><span id="l11.45" class="difflineminus">-calendar-editable-item[status=&quot;CANCELLED&quot;],</span>
<a href="#l11.46"></a><span id="l11.46" class="difflineminus">-calendar-month-day-box-item[status=&quot;CANCELLED&quot;] {</span>
<a href="#l11.47"></a><span id="l11.47" class="difflineminus">-    opacity: 0.5;</span>
<a href="#l11.48"></a><span id="l11.48" class="difflineminus">- }</span>
<a href="#l11.49"></a><span id="l11.49" class="difflineminus">-</span>
<a href="#l11.50"></a><span id="l11.50" class="difflineminus">-.calendar-event-box-container[status=&quot;CANCELLED&quot;] div {</span>
<a href="#l11.51"></a><span id="l11.51" class="difflineminus">-    text-decoration: line-through;</span>
<a href="#l11.52"></a><span id="l11.52" class="difflineplus">+calendar-month-day-box-item[invitation-status=&quot;DECLINED&quot;] {</span>
<a href="#l11.53"></a><span id="l11.53" class="difflineplus">+    opacity: 0.3;</span>
<a href="#l11.54"></a><span id="l11.54"> }</span>
<a href="#l11.55"></a><span id="l11.55"> </span>
<a href="#l11.56"></a><span id="l11.56"> /* Navigation controls for the views */</span>
<a href="#l11.57"></a><span id="l11.57"> #calendar-nav-control {</span>
<a href="#l11.58"></a><span id="l11.58">     background-color: white;</span>
<a href="#l11.59"></a><span id="l11.59">     border: solid ThreeDShadow;</span>
<a href="#l11.60"></a><span id="l11.60">     border-width: 1px 0 0 1px;</span>
<a href="#l11.61"></a><span id="l11.61"> }</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l12.1"></a><span id="l12.1" class="difflineminus">--- a/calendar/base/themes/winstripe/calendar-views.css</span>
<a href="#l12.2"></a><span id="l12.2" class="difflineplus">+++ b/calendar/base/themes/winstripe/calendar-views.css</span>
<a href="#l12.3"></a><span id="l12.3" class="difflineat">@@ -415,20 +415,16 @@ calendar-month-day-box-item[selected=&quot;tr</span>
<a href="#l12.4"></a><span id="l12.4">     background-color: #ffdb67 !important;</span>
<a href="#l12.5"></a><span id="l12.5"> }</span>
<a href="#l12.6"></a><span id="l12.6"> </span>
<a href="#l12.7"></a><span id="l12.7"> .calendar-color-box {</span>
<a href="#l12.8"></a><span id="l12.8">     /* This rule should be adopted if the alarm image size is changed */</span>
<a href="#l12.9"></a><span id="l12.9">     min-height: 13px;</span>
<a href="#l12.10"></a><span id="l12.10"> }</span>
<a href="#l12.11"></a><span id="l12.11"> </span>
<a href="#l12.12"></a><span id="l12.12" class="difflineminus">-calendar-month-day-box-item[selected=&quot;true&quot;] .calendar-color-box {</span>
<a href="#l12.13"></a><span id="l12.13" class="difflineminus">-    color: #000000;</span>
<a href="#l12.14"></a><span id="l12.14" class="difflineminus">-}</span>
<a href="#l12.15"></a><span id="l12.15" class="difflineminus">-</span>
<a href="#l12.16"></a><span id="l12.16"> .calendar-month-day-box-item-label {</span>
<a href="#l12.17"></a><span id="l12.17">     padding: 0px;</span>
<a href="#l12.18"></a><span id="l12.18">     margin: 0px;</span>
<a href="#l12.19"></a><span id="l12.19"> }</span>
<a href="#l12.20"></a><span id="l12.20"> </span>
<a href="#l12.21"></a><span id="l12.21"> .calendar-month-day-box-item-label[time=&quot;true&quot;] {</span>
<a href="#l12.22"></a><span id="l12.22">     -moz-margin-end: 4px;</span>
<a href="#l12.23"></a><span id="l12.23"> }</span>
<a href="#l12.24"></a><span id="l12.24" class="difflineat">@@ -589,34 +585,24 @@ calendar-event-box[invitation-status=&quot;NE</span>
<a href="#l12.25"></a><span id="l12.25"> calendar-editable-item[invitation-status=&quot;NEEDS-ACTION&quot;],</span>
<a href="#l12.26"></a><span id="l12.26"> calendar-month-day-box-item[invitation-status=&quot;NEEDS-ACTION&quot;] {</span>
<a href="#l12.27"></a><span id="l12.27">     border: 2px dotted black;</span>
<a href="#l12.28"></a><span id="l12.28">     opacity: 0.6;</span>
<a href="#l12.29"></a><span id="l12.29"> }</span>
<a href="#l12.30"></a><span id="l12.30"> </span>
<a href="#l12.31"></a><span id="l12.31"> calendar-event-box[invitation-status=&quot;TENTATIVE&quot;],</span>
<a href="#l12.32"></a><span id="l12.32"> calendar-editable-item[invitation-status=&quot;TENTATIVE&quot;],</span>
<a href="#l12.33"></a><span id="l12.33" class="difflineminus">-calendar-month-day-box-item[invitation-status=&quot;TENTATIVE&quot;],</span>
<a href="#l12.34"></a><span id="l12.34" class="difflineminus">-calendar-event-box[status=&quot;TENTATIVE&quot;],</span>
<a href="#l12.35"></a><span id="l12.35" class="difflineminus">-calendar-editable-item[status=&quot;TENTATIVE&quot;],</span>
<a href="#l12.36"></a><span id="l12.36" class="difflineminus">-calendar-month-day-box-item[status=&quot;TENTATIVE&quot;] {</span>
<a href="#l12.37"></a><span id="l12.37" class="difflineplus">+calendar-month-day-box-item[invitation-status=&quot;TENTATIVE&quot;] {</span>
<a href="#l12.38"></a><span id="l12.38">     opacity: 0.6;</span>
<a href="#l12.39"></a><span id="l12.39"> }</span>
<a href="#l12.40"></a><span id="l12.40"> </span>
<a href="#l12.41"></a><span id="l12.41"> calendar-event-box[invitation-status=&quot;DECLINED&quot;],</span>
<a href="#l12.42"></a><span id="l12.42"> calendar-editable-item[invitation-status=&quot;DECLINED&quot;],</span>
<a href="#l12.43"></a><span id="l12.43" class="difflineminus">-calendar-month-day-box-item[invitation-status=&quot;DECLINED&quot;],</span>
<a href="#l12.44"></a><span id="l12.44" class="difflineminus">-calendar-event-box[status=&quot;CANCELLED&quot;],</span>
<a href="#l12.45"></a><span id="l12.45" class="difflineminus">-calendar-editable-item[status=&quot;CANCELLED&quot;],</span>
<a href="#l12.46"></a><span id="l12.46" class="difflineminus">-calendar-month-day-box-item[status=&quot;CANCELLED&quot;] {</span>
<a href="#l12.47"></a><span id="l12.47" class="difflineminus">-    opacity: 0.5;</span>
<a href="#l12.48"></a><span id="l12.48" class="difflineminus">- }</span>
<a href="#l12.49"></a><span id="l12.49" class="difflineminus">-</span>
<a href="#l12.50"></a><span id="l12.50" class="difflineminus">-.calendar-event-box-container[status=&quot;CANCELLED&quot;] div {</span>
<a href="#l12.51"></a><span id="l12.51" class="difflineminus">-    text-decoration: line-through;</span>
<a href="#l12.52"></a><span id="l12.52" class="difflineplus">+calendar-month-day-box-item[invitation-status=&quot;DECLINED&quot;] {</span>
<a href="#l12.53"></a><span id="l12.53" class="difflineplus">+    opacity: 0.3;</span>
<a href="#l12.54"></a><span id="l12.54"> }</span>
<a href="#l12.55"></a><span id="l12.55"> </span>
<a href="#l12.56"></a><span id="l12.56"> /* Navigation controls for the views */</span>
<a href="#l12.57"></a><span id="l12.57"> #calendar-nav-control {</span>
<a href="#l12.58"></a><span id="l12.58">     background-color: white;</span>
<a href="#l12.59"></a><span id="l12.59">     border: solid ThreeDShadow;</span>
<a href="#l12.60"></a><span id="l12.60">     border-width: 1px 0 0 1px;</span>
<a href="#l12.61"></a><span id="l12.61"> }</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l13.1"></a><span id="l13.1" class="difflineminus">--- a/calendar/providers/composite/calCompositeCalendar.js</span>
<a href="#l13.2"></a><span id="l13.2" class="difflineplus">+++ b/calendar/providers/composite/calCompositeCalendar.js</span>
<a href="#l13.3"></a><span id="l13.3" class="difflineat">@@ -99,18 +99,18 @@ calCompositeCalendarObserverHelper.proto</span>
<a href="#l13.4"></a><span id="l13.4">     }</span>
<a href="#l13.5"></a><span id="l13.5"> };</span>
<a href="#l13.6"></a><span id="l13.6"> </span>
<a href="#l13.7"></a><span id="l13.7"> function calCompositeCalendar () {</span>
<a href="#l13.8"></a><span id="l13.8">     this.mObserverHelper = new calCompositeCalendarObserverHelper(this);</span>
<a href="#l13.9"></a><span id="l13.9">     this.wrappedJSObject = this;</span>
<a href="#l13.10"></a><span id="l13.10"> </span>
<a href="#l13.11"></a><span id="l13.11">     this.mCalendars = new Array();</span>
<a href="#l13.12"></a><span id="l13.12" class="difflineminus">-    this.mCompositeObservers = new calListenerBag(Components.interfaces.calICompositeObserver);</span>
<a href="#l13.13"></a><span id="l13.13" class="difflineminus">-    this.mObservers = new calListenerBag(Components.interfaces.calIObserver);</span>
<a href="#l13.14"></a><span id="l13.14" class="difflineplus">+    this.mCompositeObservers = new cal.observerBag(Components.interfaces.calICompositeObserver);</span>
<a href="#l13.15"></a><span id="l13.15" class="difflineplus">+    this.mObservers = new cal.observerBag(Components.interfaces.calIObserver);</span>
<a href="#l13.16"></a><span id="l13.16">     this.mDefaultCalendar = null;</span>
<a href="#l13.17"></a><span id="l13.17">     this.mStatusObserver = null;</span>
<a href="#l13.18"></a><span id="l13.18"> }</span>
<a href="#l13.19"></a><span id="l13.19"> </span>
<a href="#l13.20"></a><span id="l13.20"> calCompositeCalendar.prototype = {</span>
<a href="#l13.21"></a><span id="l13.21">     //</span>
<a href="#l13.22"></a><span id="l13.22">     // private members</span>
<a href="#l13.23"></a><span id="l13.23">     //</span>
<a href="#l13.24"></a><span id="l13.24" class="difflineat">@@ -599,16 +599,17 @@ var calCompositeCalendarModule = {</span>
<a href="#l13.25"></a><span id="l13.25">     mContractID: &quot;@mozilla.org/calendar/calendar;1?type=composite&quot;,</span>
<a href="#l13.26"></a><span id="l13.26"> </span>
<a href="#l13.27"></a><span id="l13.27">     mUtilsLoaded: false,</span>
<a href="#l13.28"></a><span id="l13.28">     loadUtils: function compositeLoadUtils() {</span>
<a href="#l13.29"></a><span id="l13.29">         if (this.mUtilsLoaded)</span>
<a href="#l13.30"></a><span id="l13.30">             return;</span>
<a href="#l13.31"></a><span id="l13.31"> </span>
<a href="#l13.32"></a><span id="l13.32">         Components.utils.import(&quot;resource://calendar/modules/calUtils.jsm&quot;);</span>
<a href="#l13.33"></a><span id="l13.33" class="difflineplus">+        Components.utils.import(&quot;resource://calendar/modules/calProviderUtils.jsm&quot;);</span>
<a href="#l13.34"></a><span id="l13.34">         cal.loadScripts([&quot;calUtils.js&quot;], this.__parent__);</span>
<a href="#l13.35"></a><span id="l13.35"> </span>
<a href="#l13.36"></a><span id="l13.36">         this.mUtilsLoaded = true;</span>
<a href="#l13.37"></a><span id="l13.37">     },</span>
<a href="#l13.38"></a><span id="l13.38"> </span>
<a href="#l13.39"></a><span id="l13.39">     registerSelf: function (compMgr, fileSpec, location, type) {</span>
<a href="#l13.40"></a><span id="l13.40">         compMgr = compMgr.QueryInterface(Components.interfaces.nsIComponentRegistrar);</span>
<a href="#l13.41"></a><span id="l13.41">         compMgr.registerFactoryLocation(this.mCID,</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l14.1"></a><span id="l14.1" class="difflineminus">--- a/calendar/providers/ics/calICSCalendar.js</span>
<a href="#l14.2"></a><span id="l14.2" class="difflineplus">+++ b/calendar/providers/ics/calICSCalendar.js</span>
<a href="#l14.3"></a><span id="l14.3" class="difflineat">@@ -627,17 +627,17 @@ calICSCalendar.prototype = {</span>
<a href="#l14.4"></a><span id="l14.4">             filteredFiles.sort(</span>
<a href="#l14.5"></a><span id="l14.5">                 function s(a,b) {</span>
<a href="#l14.6"></a><span id="l14.6">                     return (a.lastmodified - b.lastmodified);</span>
<a href="#l14.7"></a><span id="l14.7">                 });</span>
<a href="#l14.8"></a><span id="l14.8">             // And delete the oldest files, and keep the desired number of</span>
<a href="#l14.9"></a><span id="l14.9">             // old backups</span>
<a href="#l14.10"></a><span id="l14.10">             var i;</span>
<a href="#l14.11"></a><span id="l14.11">             for (i = 0; i &lt; filteredFiles.length - numBackupFiles; ++i) {</span>
<a href="#l14.12"></a><span id="l14.12" class="difflineminus">-                file = backupDir.clone();</span>
<a href="#l14.13"></a><span id="l14.13" class="difflineplus">+                let file = backupDir.clone();</span>
<a href="#l14.14"></a><span id="l14.14">                 file.append(filteredFiles[i].name);</span>
<a href="#l14.15"></a><span id="l14.15"> </span>
<a href="#l14.16"></a><span id="l14.16">                 // This can fail because of some crappy code in nsILocalFile.</span>
<a href="#l14.17"></a><span id="l14.17">                 // That's not the end of the world.  We can try to remove the</span>
<a href="#l14.18"></a><span id="l14.18">                 // file the next time around.</span>
<a href="#l14.19"></a><span id="l14.19">                 try {</span>
<a href="#l14.20"></a><span id="l14.20">                     file.remove(false);</span>
<a href="#l14.21"></a><span id="l14.21">                 } catch(ex) {}</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l15.1"></a><span id="l15.1" class="difflineminus">--- a/calendar/providers/memory/calMemoryCalendar.js</span>
<a href="#l15.2"></a><span id="l15.2" class="difflineplus">+++ b/calendar/providers/memory/calMemoryCalendar.js</span>
<a href="#l15.3"></a><span id="l15.3" class="difflineat">@@ -59,17 +59,17 @@ calMemoryCalendar.prototype = {</span>
<a href="#l15.4"></a><span id="l15.4">     // </span>
<a href="#l15.5"></a><span id="l15.5">     QueryInterface: function (aIID) {</span>
<a href="#l15.6"></a><span id="l15.6">         return doQueryInterface(this, calMemoryCalendar.prototype, aIID,</span>
<a href="#l15.7"></a><span id="l15.7">                                 [Components.interfaces.calISyncWriteCalendar,</span>
<a href="#l15.8"></a><span id="l15.8">                                  Components.interfaces.calICalendarProvider]);</span>
<a href="#l15.9"></a><span id="l15.9">     },</span>
<a href="#l15.10"></a><span id="l15.10"> </span>
<a href="#l15.11"></a><span id="l15.11">     initMemoryCalendar: function() {</span>
<a href="#l15.12"></a><span id="l15.12" class="difflineminus">-        this.mObservers = new calListenerBag(Components.interfaces.calIObserver);</span>
<a href="#l15.13"></a><span id="l15.13" class="difflineplus">+        this.mObservers = new cal.observerBag(Components.interfaces.calIObserver);</span>
<a href="#l15.14"></a><span id="l15.14">         this.mItems = {};</span>
<a href="#l15.15"></a><span id="l15.15">         this.mMetaData = new calPropertyBag();</span>
<a href="#l15.16"></a><span id="l15.16">     },</span>
<a href="#l15.17"></a><span id="l15.17"> </span>
<a href="#l15.18"></a><span id="l15.18">     //</span>
<a href="#l15.19"></a><span id="l15.19">     // calICalendarProvider interface</span>
<a href="#l15.20"></a><span id="l15.20">     //</span>
<a href="#l15.21"></a><span id="l15.21">     get prefChromeOverlay() {</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l16.1"></a><span id="l16.1" class="difflineminus">--- a/calendar/test/unit/test_providers.js</span>
<a href="#l16.2"></a><span id="l16.2" class="difflineplus">+++ b/calendar/test/unit/test_providers.js</span>
<a href="#l16.3"></a><span id="l16.3" class="difflineat">@@ -298,17 +298,17 @@ function run_test() {</span>
<a href="#l16.4"></a><span id="l16.4">         var filter = Ci.calICalendar.ITEM_FILTER_TYPE_ALL | </span>
<a href="#l16.5"></a><span id="l16.5">                      Ci.calICalendar.ITEM_FILTER_CLASS_OCCURRENCES |</span>
<a href="#l16.6"></a><span id="l16.6">                      Ci.calICalendar.ITEM_FILTER_COMPLETED_ALL;</span>
<a href="#l16.7"></a><span id="l16.7"> </span>
<a href="#l16.8"></a><span id="l16.8">         // get calendars</span>
<a href="#l16.9"></a><span id="l16.9">         var calArray = [];</span>
<a href="#l16.10"></a><span id="l16.10">         calArray.push(getStorageCal());</span>
<a href="#l16.11"></a><span id="l16.11">         calArray.push(getMemoryCal());</span>
<a href="#l16.12"></a><span id="l16.12" class="difflineminus">-        for each (cal in calArray) {</span>
<a href="#l16.13"></a><span id="l16.13" class="difflineplus">+        for each (let calendar in calArray) {</span>
<a href="#l16.14"></a><span id="l16.14">             // implement listener</span>
<a href="#l16.15"></a><span id="l16.15">             var count = 0;</span>
<a href="#l16.16"></a><span id="l16.16">             var listener = {</span>
<a href="#l16.17"></a><span id="l16.17">                 onOperationComplete: function(aCalendar,</span>
<a href="#l16.18"></a><span id="l16.18">                                               aStatus,</span>
<a href="#l16.19"></a><span id="l16.19">                                               aOperationType,</span>
<a href="#l16.20"></a><span id="l16.20">                                               aId,</span>
<a href="#l16.21"></a><span id="l16.21">                                               aDetail) {</span>
<a href="#l16.22"></a><span id="l16.22" class="difflineat">@@ -330,32 +330,32 @@ function run_test() {</span>
<a href="#l16.23"></a><span id="l16.23">                         count += aCount;</span>
<a href="#l16.24"></a><span id="l16.24">                         for (var i = 0; i &lt; aCount; i++) {</span>
<a href="#l16.25"></a><span id="l16.25">                             compareItemsSpecific(aItems[i].parentItem, aItem);</span>
<a href="#l16.26"></a><span id="l16.26">                         }</span>
<a href="#l16.27"></a><span id="l16.27">                     }</span>
<a href="#l16.28"></a><span id="l16.28">                 }</span>
<a href="#l16.29"></a><span id="l16.29">             };</span>
<a href="#l16.30"></a><span id="l16.30">             // add item to calendar</span>
<a href="#l16.31"></a><span id="l16.31" class="difflineminus">-            cal.addItem(aItem, listener);</span>
<a href="#l16.32"></a><span id="l16.32" class="difflineplus">+            calendar.addItem(aItem, listener);</span>
<a href="#l16.33"></a><span id="l16.33">         }</span>
<a href="#l16.34"></a><span id="l16.34">     }</span>
<a href="#l16.35"></a><span id="l16.35"> </span>
<a href="#l16.36"></a><span id="l16.36">    /**</span>
<a href="#l16.37"></a><span id="l16.37">     * (1) Add aItem to a calendar.</span>
<a href="#l16.38"></a><span id="l16.38">     * The properties of the added item are compared with the passed item.</span>
<a href="#l16.39"></a><span id="l16.39">     * (2) Perform a getItem() call.</span>
<a href="#l16.40"></a><span id="l16.40">     * The properties of the returned item are compared with the passed item.</span>
<a href="#l16.41"></a><span id="l16.41">     */</span>
<a href="#l16.42"></a><span id="l16.42">     function testGetItem(aItem) {</span>
<a href="#l16.43"></a><span id="l16.43">         // get calendars</span>
<a href="#l16.44"></a><span id="l16.44">         var calArray = [];</span>
<a href="#l16.45"></a><span id="l16.45">         calArray.push(getStorageCal());</span>
<a href="#l16.46"></a><span id="l16.46">         calArray.push(getMemoryCal());</span>
<a href="#l16.47"></a><span id="l16.47" class="difflineminus">-        for each (cal in calArray) {</span>
<a href="#l16.48"></a><span id="l16.48" class="difflineplus">+        for each (let calendar in calArray) {</span>
<a href="#l16.49"></a><span id="l16.49">             // implement listener</span>
<a href="#l16.50"></a><span id="l16.50">             var count = 0;</span>
<a href="#l16.51"></a><span id="l16.51">             var returnedItem = null;</span>
<a href="#l16.52"></a><span id="l16.52">             var listener = {</span>
<a href="#l16.53"></a><span id="l16.53">                 onOperationComplete: function(aCalendar,</span>
<a href="#l16.54"></a><span id="l16.54">                                               aStatus,</span>
<a href="#l16.55"></a><span id="l16.55">                                               aOperationType,</span>
<a href="#l16.56"></a><span id="l16.56">                                               aId,</span>
<a href="#l16.57"></a><span id="l16.57" class="difflineat">@@ -378,17 +378,17 @@ function run_test() {</span>
<a href="#l16.58"></a><span id="l16.58">                                       aItems) {</span>
<a href="#l16.59"></a><span id="l16.59">                     if (aCount) {</span>
<a href="#l16.60"></a><span id="l16.60">                         count += aCount;</span>
<a href="#l16.61"></a><span id="l16.61">                         returnedItem = aItems[0];</span>
<a href="#l16.62"></a><span id="l16.62">                     }</span>
<a href="#l16.63"></a><span id="l16.63">                 }</span>
<a href="#l16.64"></a><span id="l16.64">             };</span>
<a href="#l16.65"></a><span id="l16.65">             // add item to calendar</span>
<a href="#l16.66"></a><span id="l16.66" class="difflineminus">-            cal.addItem(aItem, listener);</span>
<a href="#l16.67"></a><span id="l16.67" class="difflineplus">+            calendar.addItem(aItem, listener);</span>
<a href="#l16.68"></a><span id="l16.68">         }</span>
<a href="#l16.69"></a><span id="l16.69">     }</span>
<a href="#l16.70"></a><span id="l16.70"> </span>
<a href="#l16.71"></a><span id="l16.71">     testMetaData();</span>
<a href="#l16.72"></a><span id="l16.72"> }</span>
<a href="#l16.73"></a><span id="l16.73"> </span>
<a href="#l16.74"></a><span id="l16.74"> function testMetaData() {</span>
<a href="#l16.75"></a><span id="l16.75">     function testMetaData_(cal) {</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l17.1"></a><span id="l17.1" class="difflineminus">--- a/calendar/test/unit/test_recur.js</span>
<a href="#l17.2"></a><span id="l17.2" class="difflineplus">+++ b/calendar/test/unit/test_recur.js</span>
<a href="#l17.3"></a><span id="l17.3" class="difflineat">@@ -272,17 +272,16 @@ function test_interface() {</span>
<a href="#l17.4"></a><span id="l17.4"> </span>
<a href="#l17.5"></a><span id="l17.5">     // deleteRecurrenceItem</span>
<a href="#l17.6"></a><span id="l17.6">     rinfo.deleteRecurrenceItem(ritems[0]);</span>
<a href="#l17.7"></a><span id="l17.7">     do_check_true(item.icalString.indexOf(RRULE) &lt; 0);</span>
<a href="#l17.8"></a><span id="l17.8"> </span>
<a href="#l17.9"></a><span id="l17.9">     // deleteRecurrenceItemAt</span>
<a href="#l17.10"></a><span id="l17.10">     rinfo.deleteRecurrenceItemAt(1);</span>
<a href="#l17.11"></a><span id="l17.11">     itemString = item.icalString;</span>
<a href="#l17.12"></a><span id="l17.12" class="difflineminus">-    dump(itemString);</span>
<a href="#l17.13"></a><span id="l17.13">     do_check_true(itemString.indexOf(EXDATE) &lt; 0);</span>
<a href="#l17.14"></a><span id="l17.14">     do_check_false(itemString.indexOf(RDATE) &lt; 0);</span>
<a href="#l17.15"></a><span id="l17.15"> </span>
<a href="#l17.16"></a><span id="l17.16">     // isFinite</span>
<a href="#l17.17"></a><span id="l17.17">     do_check_true(rinfo.isFinite);</span>
<a href="#l17.18"></a><span id="l17.18">     rinfo.appendRecurrenceItem(ritems[0]);</span>
<a href="#l17.19"></a><span id="l17.19">     do_check_true(rinfo.isFinite);</span>
<a href="#l17.20"></a><span id="l17.20"> </span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l18.1"></a><span id="l18.1" class="difflineminus">--- a/calendar/test/unit/test_relation.js</span>
<a href="#l18.2"></a><span id="l18.2" class="difflineplus">+++ b/calendar/test/unit/test_relation.js</span>
<a href="#l18.3"></a><span id="l18.3" class="difflineat">@@ -7,114 +7,103 @@</span>
<a href="#l18.4"></a><span id="l18.4">  * http://www.mozilla.org/MPL/</span>
<a href="#l18.5"></a><span id="l18.5">  *</span>
<a href="#l18.6"></a><span id="l18.6">  * Software distributed under the License is distributed on an &quot;AS IS&quot; basis,</span>
<a href="#l18.7"></a><span id="l18.7">  * WITHOUT WARRANTY OF ANY KIND, either express or implied. See the License</span>
<a href="#l18.8"></a><span id="l18.8">  * for the specific language governing rights and limitations under the</span>
<a href="#l18.9"></a><span id="l18.9">  * License.</span>
<a href="#l18.10"></a><span id="l18.10">  *</span>
<a href="#l18.11"></a><span id="l18.11">  * The Original Code is Mozilla Calendar code.</span>
<a href="#l18.12"></a><span id="l18.12" class="difflineminus">- * </span>
<a href="#l18.13"></a><span id="l18.13" class="difflineplus">+ *</span>
<a href="#l18.14"></a><span id="l18.14">  * The Initial Developer of the Original Code is</span>
<a href="#l18.15"></a><span id="l18.15">  *   Fred Jendrzejewski &lt;fred.jen@web.de&gt;</span>
<a href="#l18.16"></a><span id="l18.16">  * Portions created by the Initial Developer are Copyright (C) 2008</span>
<a href="#l18.17"></a><span id="l18.17">  * the Initial Developer. All Rights Reserved.</span>
<a href="#l18.18"></a><span id="l18.18">  *</span>
<a href="#l18.19"></a><span id="l18.19">  * Contributor(s):</span>
<a href="#l18.20"></a><span id="l18.20" class="difflineplus">+ *   Philipp Kewisch &lt;mozilla@kewis.ch&gt;</span>
<a href="#l18.21"></a><span id="l18.21">  *</span>
<a href="#l18.22"></a><span id="l18.22">  * Alternatively, the contents of this file may be used under the terms of</span>
<a href="#l18.23"></a><span id="l18.23">  * either the GNU General Public License Version 2 or later (the &quot;GPL&quot;), or</span>
<a href="#l18.24"></a><span id="l18.24">  * the GNU Lesser General Public License Version 2.1 or later (the &quot;LGPL&quot;),</span>
<a href="#l18.25"></a><span id="l18.25">  * in which case the provisions of the GPL or the LGPL are applicable instead</span>
<a href="#l18.26"></a><span id="l18.26">  * of those above. If you wish to allow use of your version of this file only</span>
<a href="#l18.27"></a><span id="l18.27">  * under the terms of either the GPL or the LGPL, and not to allow others to</span>
<a href="#l18.28"></a><span id="l18.28">  * use your version of this file under the terms of the MPL, indicate your</span>
<a href="#l18.29"></a><span id="l18.29">  * decision by deleting the provisions above and replace them with the notice</span>
<a href="#l18.30"></a><span id="l18.30">  * and other provisions required by the GPL or the LGPL. If you do not delete</span>
<a href="#l18.31"></a><span id="l18.31">  * the provisions above, a recipient may use your version of this file under</span>
<a href="#l18.32"></a><span id="l18.32">  * the terms of any one of the MPL, the GPL or the LGPL.</span>
<a href="#l18.33"></a><span id="l18.33">  *</span>
<a href="#l18.34"></a><span id="l18.34">  * ***** END LICENSE BLOCK ***** */</span>
<a href="#l18.35"></a><span id="l18.35"> </span>
<a href="#l18.36"></a><span id="l18.36"> function run_test() {</span>
<a href="#l18.37"></a><span id="l18.37" class="difflineminus">-    var eventClass = Cc[&quot;@mozilla.org/calendar/event;1&quot;];</span>
<a href="#l18.38"></a><span id="l18.38" class="difflineminus">-    var eventIID = Ci.calIEvent;</span>
<a href="#l18.39"></a><span id="l18.39" class="difflineminus">-</span>
<a href="#l18.40"></a><span id="l18.40" class="difflineminus">-    var relationClass = Cc[&quot;@mozilla.org/calendar/relation;1&quot;];</span>
<a href="#l18.41"></a><span id="l18.41" class="difflineminus">-    var relationIID = Ci.calIRelation;</span>
<a href="#l18.42"></a><span id="l18.42" class="difflineminus">-</span>
<a href="#l18.43"></a><span id="l18.43">     // Create Relation</span>
<a href="#l18.44"></a><span id="l18.44" class="difflineminus">-    var r1 = createRelation();</span>
<a href="#l18.45"></a><span id="l18.45" class="difflineplus">+    let r1 = cal.createRelation();</span>
<a href="#l18.46"></a><span id="l18.46"> </span>
<a href="#l18.47"></a><span id="l18.47">     // Create Items</span>
<a href="#l18.48"></a><span id="l18.48" class="difflineminus">-    var e1 = eventClass.createInstance(eventIID);</span>
<a href="#l18.49"></a><span id="l18.49" class="difflineminus">-    var e2 = eventClass.createInstance(eventIID);</span>
<a href="#l18.50"></a><span id="l18.50" class="difflineplus">+    let e1 = cal.createEvent();</span>
<a href="#l18.51"></a><span id="l18.51" class="difflineplus">+    let e2 = cal.createEvent();</span>
<a href="#l18.52"></a><span id="l18.52"> </span>
<a href="#l18.53"></a><span id="l18.53">     // Testing relation set/get.</span>
<a href="#l18.54"></a><span id="l18.54" class="difflineminus">-    var properties = [&quot;item&quot;, &quot;relType&quot;, &quot;relId&quot;];</span>
<a href="#l18.55"></a><span id="l18.55" class="difflineminus">-    var values = [e1, &quot;PARENT&quot;, e2.id];</span>
<a href="#l18.56"></a><span id="l18.56" class="difflineplus">+    let properties = {</span>
<a href="#l18.57"></a><span id="l18.57" class="difflineplus">+        relType: &quot;PARENT&quot;,</span>
<a href="#l18.58"></a><span id="l18.58" class="difflineplus">+        relId: e2.id</span>
<a href="#l18.59"></a><span id="l18.59" class="difflineplus">+    }</span>
<a href="#l18.60"></a><span id="l18.60"> </span>
<a href="#l18.61"></a><span id="l18.61" class="difflineminus">-    // Make sure test is valid</span>
<a href="#l18.62"></a><span id="l18.62" class="difflineminus">-    do_check_eq(properties.length, values.length);</span>
<a href="#l18.63"></a><span id="l18.63" class="difflineminus">-</span>
<a href="#l18.64"></a><span id="l18.64" class="difflineminus">-    for (var i = 0; i &lt; properties.length; i++) {</span>
<a href="#l18.65"></a><span id="l18.65" class="difflineminus">-        r1[properties[i]] = values[i];</span>
<a href="#l18.66"></a><span id="l18.66" class="difflineminus">-        do_check_eq(r1[properties[i]], values[i]);</span>
<a href="#l18.67"></a><span id="l18.67" class="difflineplus">+    for (let [property, value] in Iterator(properties)) {</span>
<a href="#l18.68"></a><span id="l18.68" class="difflineplus">+        r1[property] = value;</span>
<a href="#l18.69"></a><span id="l18.69" class="difflineplus">+        do_check_eq(r1[property], value);</span>
<a href="#l18.70"></a><span id="l18.70">     }</span>
<a href="#l18.71"></a><span id="l18.71"> </span>
<a href="#l18.72"></a><span id="l18.72">     // Add relation to event</span>
<a href="#l18.73"></a><span id="l18.73">     e1.addRelation(r1);</span>
<a href="#l18.74"></a><span id="l18.74"> </span>
<a href="#l18.75"></a><span id="l18.75" class="difflineminus">-    // Add 2nd attendee to event.</span>
<a href="#l18.76"></a><span id="l18.76" class="difflineminus">-    var r2 = relationClass.createInstance(relationIID);</span>
<a href="#l18.77"></a><span id="l18.77" class="difflineplus">+    // Add 2nd relation to event.</span>
<a href="#l18.78"></a><span id="l18.78" class="difflineplus">+    let r2 = cal.createRelation();</span>
<a href="#l18.79"></a><span id="l18.79">     r2.relId = &quot;myid2&quot;;</span>
<a href="#l18.80"></a><span id="l18.80">     e1.addRelation(r2);</span>
<a href="#l18.81"></a><span id="l18.81"> </span>
<a href="#l18.82"></a><span id="l18.82">     // Check the item functions</span>
<a href="#l18.83"></a><span id="l18.83">     checkRelations(e1, [r1, r2]);</span>
<a href="#l18.84"></a><span id="l18.84"> </span>
<a href="#l18.85"></a><span id="l18.85">     // modify the Relations</span>
<a href="#l18.86"></a><span id="l18.86">     modifyRelations(e1, [r1, r2]);</span>
<a href="#l18.87"></a><span id="l18.87"> </span>
<a href="#l18.88"></a><span id="l18.88">     // test icalproperty</span>
<a href="#l18.89"></a><span id="l18.89">     r2.icalProperty;</span>
<a href="#l18.90"></a><span id="l18.90"> }</span>
<a href="#l18.91"></a><span id="l18.91"> </span>
<a href="#l18.92"></a><span id="l18.92"> function checkRelations(event, expRel) {</span>
<a href="#l18.93"></a><span id="l18.93" class="difflineminus">-    var countObj = {}</span>
<a href="#l18.94"></a><span id="l18.94" class="difflineminus">-    var allRel = event.getRelations(countObj);</span>
<a href="#l18.95"></a><span id="l18.95" class="difflineplus">+    let countObj = {};</span>
<a href="#l18.96"></a><span id="l18.96" class="difflineplus">+    let allRel = event.getRelations(countObj);</span>
<a href="#l18.97"></a><span id="l18.97">     do_check_eq(countObj.value, allRel.length);</span>
<a href="#l18.98"></a><span id="l18.98">     do_check_eq(allRel.length, expRel.length);</span>
<a href="#l18.99"></a><span id="l18.99"> </span>
<a href="#l18.100"></a><span id="l18.100">     // check if all expacted relations are found</span>
<a href="#l18.101"></a><span id="l18.101" class="difflineminus">-    for (var i = 0; i &lt; expRel.length; i++) {</span>
<a href="#l18.102"></a><span id="l18.102" class="difflineplus">+    for (let i = 0; i &lt; expRel.length; i++) {</span>
<a href="#l18.103"></a><span id="l18.103">         do_check_neq(allRel.indexOf(expRel[i]), -1);</span>
<a href="#l18.104"></a><span id="l18.104">     }</span>
<a href="#l18.105"></a><span id="l18.105"> </span>
<a href="#l18.106"></a><span id="l18.106">     // Check if all found relations are expected</span>
<a href="#l18.107"></a><span id="l18.107" class="difflineminus">-    for (var i = 0; i &lt; allRel.length; i++) {</span>
<a href="#l18.108"></a><span id="l18.108" class="difflineplus">+    for (let i = 0; i &lt; allRel.length; i++) {</span>
<a href="#l18.109"></a><span id="l18.109">         do_check_neq(expRel.indexOf(allRel[i]), -1);</span>
<a href="#l18.110"></a><span id="l18.110">     }</span>
<a href="#l18.111"></a><span id="l18.111"> }</span>
<a href="#l18.112"></a><span id="l18.112"> </span>
<a href="#l18.113"></a><span id="l18.113"> function modifyRelations(event, oldRel) {</span>
<a href="#l18.114"></a><span id="l18.114" class="difflineminus">-    var allRel = event.getRelations({});</span>
<a href="#l18.115"></a><span id="l18.115" class="difflineminus">-    var rel = allRel[0];</span>
<a href="#l18.116"></a><span id="l18.116" class="difflineplus">+    let allRel = event.getRelations({});</span>
<a href="#l18.117"></a><span id="l18.117" class="difflineplus">+    let rel = allRel[0];</span>
<a href="#l18.118"></a><span id="l18.118"> </span>
<a href="#l18.119"></a><span id="l18.119">     // modify the properties</span>
<a href="#l18.120"></a><span id="l18.120">     rel.relType = &quot;SIBLING&quot;;</span>
<a href="#l18.121"></a><span id="l18.121">     do_check_eq(rel.relType, &quot;SIBLING&quot;);</span>
<a href="#l18.122"></a><span id="l18.122">     do_check_eq(rel.relType, allRel[0].relType);</span>
<a href="#l18.123"></a><span id="l18.123"> </span>
<a href="#l18.124"></a><span id="l18.124">     // remove one relation</span>
<a href="#l18.125"></a><span id="l18.125">     event.removeRelation(rel);</span>
<a href="#l18.126"></a><span id="l18.126" class="difflineminus">-</span>
<a href="#l18.127"></a><span id="l18.127">     do_check_eq(event.getRelations({}).length, oldRel.length - 1);</span>
<a href="#l18.128"></a><span id="l18.128"> </span>
<a href="#l18.129"></a><span id="l18.129">     // add one relation and remove all relations</span>
<a href="#l18.130"></a><span id="l18.130" class="difflineminus">-</span>
<a href="#l18.131"></a><span id="l18.131">     event.addRelation(oldRel[0]);</span>
<a href="#l18.132"></a><span id="l18.132" class="difflineminus">-</span>
<a href="#l18.133"></a><span id="l18.133">     event.removeAllRelations();</span>
<a href="#l18.134"></a><span id="l18.134" class="difflineminus">-</span>
<a href="#l18.135"></a><span id="l18.135">     do_check_eq(event.getRelations({}), 0);</span>
<a href="#l18.136"></a><span id="l18.136" class="difflineminus">-</span>
<a href="#l18.137"></a><span id="l18.137"> }</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l19.1"></a><span id="l19.1" class="difflineminus">--- a/calendar/timezones/config/version.txt</span>
<a href="#l19.2"></a><span id="l19.2" class="difflineplus">+++ b/calendar/timezones/config/version.txt</span>
<a href="#l19.3"></a><span id="l19.3" class="difflineat">@@ -1,1 +1,1 @@</span>
<a href="#l19.4"></a><span id="l19.4" class="difflineminus">-1.2009f</span>
<a href="#l19.5"></a><span id="l19.5" class="difflineplus">+1.2009l</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l20.1"></a><span id="l20.1">index d8a050d13b39cbf13e664136b783d18eeb3beaf7..521e863ef04cae0aee87b35a633d3bc0607389c0</span>
<a href="#l20.2"></a><span id="l20.2">GIT binary patch
literal 160768
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/span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l21.1"></a><span id="l21.1" class="difflineminus">--- a/config/autoconf.mk.in</span>
<a href="#l21.2"></a><span id="l21.2" class="difflineplus">+++ b/config/autoconf.mk.in</span>
<a href="#l21.3"></a><span id="l21.3" class="difflineat">@@ -462,19 +462,16 @@ DLL_SUFFIX              = @DLL_SUFFIX@</span>
<a href="#l21.4"></a><span id="l21.4"> </span>
<a href="#l21.5"></a><span id="l21.5"> NO_LD_ARCHIVE_FLAGS     = @NO_LD_ARCHIVE_FLAGS@</span>
<a href="#l21.6"></a><span id="l21.6"> </span>
<a href="#l21.7"></a><span id="l21.7"> GTK_CONFIG	= @GTK_CONFIG@</span>
<a href="#l21.8"></a><span id="l21.8"> QT_CONFIG	= @QT_CONFIG@</span>
<a href="#l21.9"></a><span id="l21.9"> TK_CFLAGS	= @TK_CFLAGS@</span>
<a href="#l21.10"></a><span id="l21.10"> TK_LIBS		= @TK_LIBS@</span>
<a href="#l21.11"></a><span id="l21.11"> </span>
<a href="#l21.12"></a><span id="l21.12" class="difflineminus">-CAIRO_FT_CFLAGS		= @CAIRO_FT_CFLAGS@</span>
<a href="#l21.13"></a><span id="l21.13" class="difflineminus">-</span>
<a href="#l21.14"></a><span id="l21.14" class="difflineminus">-MOZ_TREE_FREETYPE		= @MOZ_TREE_FREETYPE@</span>
<a href="#l21.15"></a><span id="l21.15"> MOZ_ENABLE_GTK2		= @MOZ_ENABLE_GTK2@</span>
<a href="#l21.16"></a><span id="l21.16"> MOZ_ENABLE_QT		= @MOZ_ENABLE_QT@</span>
<a href="#l21.17"></a><span id="l21.17"> MOZ_ENABLE_PHOTON	= @MOZ_ENABLE_PHOTON@</span>
<a href="#l21.18"></a><span id="l21.18"> MOZ_ENABLE_XREMOTE	= @MOZ_ENABLE_XREMOTE@</span>
<a href="#l21.19"></a><span id="l21.19"> </span>
<a href="#l21.20"></a><span id="l21.20"> MOZ_GTK2_CFLAGS		= @MOZ_GTK2_CFLAGS@</span>
<a href="#l21.21"></a><span id="l21.21"> MOZ_GTK2_LIBS		= @MOZ_GTK2_LIBS@</span>
<a href="#l21.22"></a><span id="l21.22"> </span>
<a href="#l21.23"></a><span id="l21.23" class="difflineat">@@ -483,19 +480,16 @@ MOZ_QT_LIBS		= @MOZ_QT_LIBS@</span>
<a href="#l21.24"></a><span id="l21.24"> </span>
<a href="#l21.25"></a><span id="l21.25"> MOZ_DBUS_GLIB_CFLAGS    = @MOZ_DBUS_GLIB_CFLAGS@</span>
<a href="#l21.26"></a><span id="l21.26"> MOZ_DBUS_GLIB_LIBS      = @MOZ_DBUS_GLIB_LIBS@</span>
<a href="#l21.27"></a><span id="l21.27"> MOZ_ENABLE_DBUS         = @MOZ_ENABLE_DBUS@</span>
<a href="#l21.28"></a><span id="l21.28"> </span>
<a href="#l21.29"></a><span id="l21.29"> MOZ_GTHREAD_CFLAGS      = @MOZ_GTHREAD_CFLAGS@</span>
<a href="#l21.30"></a><span id="l21.30"> MOZ_GTHREAD_LIBS        = @MOZ_GTHREAD_LIBS@</span>
<a href="#l21.31"></a><span id="l21.31"> </span>
<a href="#l21.32"></a><span id="l21.32" class="difflineminus">-FT2_CFLAGS             = @FT2_CFLAGS@</span>
<a href="#l21.33"></a><span id="l21.33" class="difflineminus">-FT2_LIBS               = @FT2_LIBS@</span>
<a href="#l21.34"></a><span id="l21.34" class="difflineminus">-</span>
<a href="#l21.35"></a><span id="l21.35"> MOZ_PANGO_LIBS          = @MOZ_PANGO_LIBS@</span>
<a href="#l21.36"></a><span id="l21.36"> </span>
<a href="#l21.37"></a><span id="l21.37"> MOZ_XIE_LIBS		= @MOZ_XIE_LIBS@</span>
<a href="#l21.38"></a><span id="l21.38"> XT_LIBS			= @XT_LIBS@</span>
<a href="#l21.39"></a><span id="l21.39"> </span>
<a href="#l21.40"></a><span id="l21.40"> MOZ_ALSA_LIBS           = @MOZ_ALSA_LIBS@</span>
<a href="#l21.41"></a><span id="l21.41"> </span>
<a href="#l21.42"></a><span id="l21.42"> GLIB_CFLAGS	= @GLIB_CFLAGS@</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l22.1"></a><span id="l22.1" class="difflineminus">--- a/configure.in</span>
<a href="#l22.2"></a><span id="l22.2" class="difflineplus">+++ b/configure.in</span>
<a href="#l22.3"></a><span id="l22.3" class="difflineat">@@ -124,16 +124,17 @@ MOZZLIB=0x1230</span>
<a href="#l22.4"></a><span id="l22.4"> NSPR_VERSION=4</span>
<a href="#l22.5"></a><span id="l22.5"> NSS_VERSION=3</span>
<a href="#l22.6"></a><span id="l22.6"> </span>
<a href="#l22.7"></a><span id="l22.7"> dnl Set the minimum version of toolkit libs used by mozilla</span>
<a href="#l22.8"></a><span id="l22.8"> dnl ========================================================</span>
<a href="#l22.9"></a><span id="l22.9"> GLIB_VERSION=1.2.0</span>
<a href="#l22.10"></a><span id="l22.10"> LIBIDL_VERSION=0.6.3</span>
<a href="#l22.11"></a><span id="l22.11"> PERL_VERSION=5.006</span>
<a href="#l22.12"></a><span id="l22.12" class="difflineplus">+CAIRO_VERSION=1.6.0</span>
<a href="#l22.13"></a><span id="l22.13"> PANGO_VERSION=1.14.0</span>
<a href="#l22.14"></a><span id="l22.14"> GTK2_VERSION=2.10.0</span>
<a href="#l22.15"></a><span id="l22.15"> MAKE_VERSION=3.78</span>
<a href="#l22.16"></a><span id="l22.16"> WINDRES_VERSION=2.14.90</span>
<a href="#l22.17"></a><span id="l22.17"> W32API_VERSION=3.8</span>
<a href="#l22.18"></a><span id="l22.18"> GNOMEVFS_VERSION=2.0</span>
<a href="#l22.19"></a><span id="l22.19"> GNOMEUI_VERSION=2.2.0</span>
<a href="#l22.20"></a><span id="l22.20"> GCONF_VERSION=1.2.1</span>
<a href="#l22.21"></a><span id="l22.21" class="difflineat">@@ -5080,20 +5081,16 @@ then</span>
<a href="#l22.22"></a><span id="l22.22">     if test &quot;$MOZ_PANGO&quot;</span>
<a href="#l22.23"></a><span id="l22.23">     then</span>
<a href="#l22.24"></a><span id="l22.24">         PKG_CHECK_MODULES(MOZ_PANGO, pango &gt;= $PANGO_VERSION pangoft2 &gt;= $PANGO_VERSION)</span>
<a href="#l22.25"></a><span id="l22.25">         AC_SUBST(MOZ_PANGO_LIBS)</span>
<a href="#l22.26"></a><span id="l22.26">         AC_DEFINE(MOZ_PANGO)</span>
<a href="#l22.27"></a><span id="l22.27">     else</span>
<a href="#l22.28"></a><span id="l22.28">         PKG_CHECK_MODULES(MOZ_PANGO, pango &gt;= $PANGO_VERSION pangoft2 &gt;= $PANGO_VERSION)</span>
<a href="#l22.29"></a><span id="l22.29">         AC_SUBST(MOZ_PANGO_LIBS)</span>
<a href="#l22.30"></a><span id="l22.30" class="difflineminus">-</span>
<a href="#l22.31"></a><span id="l22.31" class="difflineminus">-        PKG_CHECK_MODULES(FT2, freetype2 &gt; 6.1.0 fontconfig)</span>
<a href="#l22.32"></a><span id="l22.32" class="difflineminus">-        AC_SUBST(FT2_CFLAGS)</span>
<a href="#l22.33"></a><span id="l22.33" class="difflineminus">-        AC_SUBST(FT2_LIBS)</span>
<a href="#l22.34"></a><span id="l22.34">     fi</span>
<a href="#l22.35"></a><span id="l22.35"> fi</span>
<a href="#l22.36"></a><span id="l22.36"> </span>
<a href="#l22.37"></a><span id="l22.37"> dnl ========================================================</span>
<a href="#l22.38"></a><span id="l22.38"> dnl = PostScript print module</span>
<a href="#l22.39"></a><span id="l22.39"> dnl ========================================================</span>
<a href="#l22.40"></a><span id="l22.40"> MOZ_ARG_DISABLE_BOOL(postscript,</span>
<a href="#l22.41"></a><span id="l22.41"> [  --disable-postscript    Disable PostScript printing support ],</span>
<a href="#l22.42"></a><span id="l22.42" class="difflineat">@@ -5525,23 +5522,17 @@ MOZ_ARG_DISABLE_BOOL(universalchardet,</span>
<a href="#l22.43"></a><span id="l22.43"> dnl ========================================================</span>
<a href="#l22.44"></a><span id="l22.44"> dnl Build Freetype in the tree</span>
<a href="#l22.45"></a><span id="l22.45"> dnl ========================================================</span>
<a href="#l22.46"></a><span id="l22.46"> MOZ_ARG_ENABLE_BOOL(tree-freetype,</span>
<a href="#l22.47"></a><span id="l22.47"> [  --enable-tree-freetype         Enable Tree FreeType],</span>
<a href="#l22.48"></a><span id="l22.48">     MOZ_TREE_FREETYPE=1,</span>
<a href="#l22.49"></a><span id="l22.49">     MOZ_TREE_FREETYPE= )</span>
<a href="#l22.50"></a><span id="l22.50"> if test -n &quot;$MOZ_TREE_FREETYPE&quot;; then</span>
<a href="#l22.51"></a><span id="l22.51" class="difflineminus">-   AC_DEFINE(MOZ_TREE_FREETYPE)</span>
<a href="#l22.52"></a><span id="l22.52" class="difflineminus">-   AC_SUBST(MOZ_TREE_FREETYPE)</span>
<a href="#l22.53"></a><span id="l22.53" class="difflineminus">-   FT2_CFLAGS=&quot;-I${MOZILLA_SRCDIR}/modules/freetype2/include&quot;</span>
<a href="#l22.54"></a><span id="l22.54" class="difflineminus">-   CAIRO_FT_CFLAGS=&quot;-I${MOZILLA_SRCDIR}/modules/freetype2/include&quot;</span>
<a href="#l22.55"></a><span id="l22.55" class="difflineminus">-   FT2_LIBS=&quot;${LIBXUL_DIST}/lib/freetype2.lib&quot;</span>
<a href="#l22.56"></a><span id="l22.56">    CAIRO_FT_LIBS = &quot;${LIBXUL_DIST}/lib/freetype2.lib&quot;</span>
<a href="#l22.57"></a><span id="l22.57" class="difflineminus">-   AC_SUBST(CAIRO_FT_CFLAGS)</span>
<a href="#l22.58"></a><span id="l22.58"> fi</span>
<a href="#l22.59"></a><span id="l22.59"> </span>
<a href="#l22.60"></a><span id="l22.60"> dnl ========================================================</span>
<a href="#l22.61"></a><span id="l22.61"> dnl experimental ldap features</span>
<a href="#l22.62"></a><span id="l22.62"> dnl ========================================================</span>
<a href="#l22.63"></a><span id="l22.63"> MOZ_ARG_ENABLE_BOOL(ldap-experimental,</span>
<a href="#l22.64"></a><span id="l22.64"> [  --enable-ldap-experimental</span>
<a href="#l22.65"></a><span id="l22.65">                           Enable LDAP experimental features],</span>
<a href="#l22.66"></a><span id="l22.66" class="difflineat">@@ -7173,37 +7164,37 @@ MOZ_TREE_CAIRO=,</span>
<a href="#l22.67"></a><span id="l22.67"> MOZ_TREE_CAIRO=1 )</span>
<a href="#l22.68"></a><span id="l22.68"> </span>
<a href="#l22.69"></a><span id="l22.69"> # Check for headers defining standard int types.</span>
<a href="#l22.70"></a><span id="l22.70"> AC_CHECK_HEADERS(stdint.h inttypes.h sys/int_types.h)</span>
<a href="#l22.71"></a><span id="l22.71"> </span>
<a href="#l22.72"></a><span id="l22.72"> if test &quot;$MOZ_TREE_CAIRO&quot;; then</span>
<a href="#l22.73"></a><span id="l22.73">     AC_DEFINE(MOZ_TREE_CAIRO)</span>
<a href="#l22.74"></a><span id="l22.74"> </span>
<a href="#l22.75"></a><span id="l22.75" class="difflineminus">-    if test &quot;$MOZ_X11&quot;; then</span>
<a href="#l22.76"></a><span id="l22.76" class="difflineminus">-        CAIRO_FT_CFLAGS=&quot;$FT2_CFLAGS&quot;</span>
<a href="#l22.77"></a><span id="l22.77" class="difflineminus">-    fi</span>
<a href="#l22.78"></a><span id="l22.78">     if test &quot;$MOZ_WIDGET_TOOLKIT&quot; = &quot;os2&quot;; then</span>
<a href="#l22.79"></a><span id="l22.79" class="difflineminus">-        CAIRO_FT_CFLAGS=&quot;-I${MZFTCFGFT2}/include&quot;</span>
<a href="#l22.80"></a><span id="l22.80">         CAIRO_FT_LIBS=&quot;-L${MZFTCFGFT2}/lib -lmozft -lmzfntcfg&quot;</span>
<a href="#l22.81"></a><span id="l22.81">     fi</span>
<a href="#l22.82"></a><span id="l22.82" class="difflineminus">-    AC_SUBST(CAIRO_FT_CFLAGS)</span>
<a href="#l22.83"></a><span id="l22.83" class="difflineplus">+    if test &quot;$MOZ_WIDGET_TOOLKIT&quot; = &quot;beos&quot;; then</span>
<a href="#l22.84"></a><span id="l22.84" class="difflineplus">+        PKG_CHECK_MODULES(CAIRO_FT, fontconfig freetype2)</span>
<a href="#l22.85"></a><span id="l22.85" class="difflineplus">+    fi</span>
<a href="#l22.86"></a><span id="l22.86"> </span>
<a href="#l22.87"></a><span id="l22.87">     if test &quot;$_WIN32_MSVC&quot;; then</span>
<a href="#l22.88"></a><span id="l22.88">         MOZ_CAIRO_LIBS='$(DEPTH)/mozilla/gfx/cairo/cairo/src/mozcairo.lib $(DEPTH)/mozilla/gfx/cairo/libpixman/src/mozlibpixman.lib'</span>
<a href="#l22.89"></a><span id="l22.89">     else</span>
<a href="#l22.90"></a><span id="l22.90">         MOZ_CAIRO_LIBS='$(DEPTH)/mozilla/gfx/cairo/cairo/src/$(LIB_PREFIX)mozcairo.$(LIB_SUFFIX) $(DEPTH)/mozilla/gfx/cairo/libpixman/src/$(LIB_PREFIX)mozlibpixman.$(LIB_SUFFIX)'&quot; $CAIRO_FT_LIBS&quot;</span>
<a href="#l22.91"></a><span id="l22.91"> </span>
<a href="#l22.92"></a><span id="l22.92">         if test &quot;$MOZ_X11&quot;; then</span>
<a href="#l22.93"></a><span id="l22.93">             MOZ_CAIRO_LIBS=&quot;$MOZ_CAIRO_LIBS $XLDFLAGS -lXrender -lfreetype -lfontconfig&quot;</span>
<a href="#l22.94"></a><span id="l22.94">         fi</span>
<a href="#l22.95"></a><span id="l22.95">     fi</span>
<a href="#l22.96"></a><span id="l22.96"> else</span>
<a href="#l22.97"></a><span id="l22.97" class="difflineplus">+   PKG_CHECK_MODULES(CAIRO, cairo &gt;= $CAIRO_VERSION freetype2 fontconfig)</span>
<a href="#l22.98"></a><span id="l22.98">    MOZ_CAIRO_LIBS=$CAIRO_LIBS</span>
<a href="#l22.99"></a><span id="l22.99">    if test &quot;$MOZ_X11&quot;; then</span>
<a href="#l22.100"></a><span id="l22.100" class="difflineplus">+        PKG_CHECK_MODULES(CAIRO_XRENDER, cairo-xlib-xrender &gt;= $CAIRO_VERSION)</span>
<a href="#l22.101"></a><span id="l22.101">         MOZ_CAIRO_LIBS=&quot;$MOZ_CAIRO_LIBS $XLDFLAGS $CAIRO_XRENDER_LIBS&quot;</span>
<a href="#l22.102"></a><span id="l22.102">    fi</span>
<a href="#l22.103"></a><span id="l22.103"> fi</span>
<a href="#l22.104"></a><span id="l22.104"> </span>
<a href="#l22.105"></a><span id="l22.105"> AC_SUBST(MOZ_TREE_CAIRO)</span>
<a href="#l22.106"></a><span id="l22.106"> AC_SUBST(MOZ_CAIRO_LIBS)</span>
<a href="#l22.107"></a><span id="l22.107"> </span>
<a href="#l22.108"></a><span id="l22.108"> dnl qcms</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l23.1"></a><span id="l23.1" class="difflineminus">--- a/mail/base/content/SearchDialog.js</span>
<a href="#l23.2"></a><span id="l23.2" class="difflineplus">+++ b/mail/base/content/SearchDialog.js</span>
<a href="#l23.3"></a><span id="l23.3" class="difflineat">@@ -55,16 +55,19 @@ var gSearchBundle;</span>
<a href="#l23.4"></a><span id="l23.4"> </span>
<a href="#l23.5"></a><span id="l23.5"> // Datasource search listener -- made global as it has to be registered</span>
<a href="#l23.6"></a><span id="l23.6"> // and unregistered in different functions.</span>
<a href="#l23.7"></a><span id="l23.7"> var gDataSourceSearchListener;</span>
<a href="#l23.8"></a><span id="l23.8"> var gViewSearchListener;</span>
<a href="#l23.9"></a><span id="l23.9"> </span>
<a href="#l23.10"></a><span id="l23.10"> var gSearchStopButton;</span>
<a href="#l23.11"></a><span id="l23.11"> </span>
<a href="#l23.12"></a><span id="l23.12" class="difflineplus">+// Should we try to search online?</span>
<a href="#l23.13"></a><span id="l23.13" class="difflineplus">+var gSearchOnline = false;</span>
<a href="#l23.14"></a><span id="l23.14" class="difflineplus">+</span>
<a href="#l23.15"></a><span id="l23.15"> // Controller object for search results thread pane</span>
<a href="#l23.16"></a><span id="l23.16"> var nsSearchResultsController =</span>
<a href="#l23.17"></a><span id="l23.17"> {</span>
<a href="#l23.18"></a><span id="l23.18">     supportsCommand: function(command)</span>
<a href="#l23.19"></a><span id="l23.19">     {</span>
<a href="#l23.20"></a><span id="l23.20">         switch(command) {</span>
<a href="#l23.21"></a><span id="l23.21">         case &quot;cmd_delete&quot;:</span>
<a href="#l23.22"></a><span id="l23.22">         case &quot;cmd_shiftDelete&quot;:</span>
<a href="#l23.23"></a><span id="l23.23" class="difflineat">@@ -343,19 +346,36 @@ function selectFolder(folder)</span>
<a href="#l23.24"></a><span id="l23.24"> </span>
<a href="#l23.25"></a><span id="l23.25"> function updateSearchFolderPicker(folderURI)</span>
<a href="#l23.26"></a><span id="l23.26"> {</span>
<a href="#l23.27"></a><span id="l23.27">     SetFolderPicker(folderURI, gFolderPicker.id);</span>
<a href="#l23.28"></a><span id="l23.28"> </span>
<a href="#l23.29"></a><span id="l23.29">     // use the URI to get the real folder</span>
<a href="#l23.30"></a><span id="l23.30">     gCurrentFolder = GetMsgFolderFromUri(folderURI);</span>
<a href="#l23.31"></a><span id="l23.31"> </span>
<a href="#l23.32"></a><span id="l23.32" class="difflineminus">-    var searchLocalSystem = document.getElementById(&quot;checkSearchLocalSystem&quot;);</span>
<a href="#l23.33"></a><span id="l23.33" class="difflineminus">-    if (searchLocalSystem)</span>
<a href="#l23.34"></a><span id="l23.34" class="difflineminus">-        searchLocalSystem.disabled = gCurrentFolder.server.searchScope == nsMsgSearchScope.offlineMail;</span>
<a href="#l23.35"></a><span id="l23.35" class="difflineplus">+    var searchOnline = document.getElementById(&quot;checkSearchOnline&quot;);</span>
<a href="#l23.36"></a><span id="l23.36" class="difflineplus">+    if (searchOnline)</span>
<a href="#l23.37"></a><span id="l23.37" class="difflineplus">+    {</span>
<a href="#l23.38"></a><span id="l23.38" class="difflineplus">+      // We will clear and disable the search online checkbox if we are offline, or</span>
<a href="#l23.39"></a><span id="l23.39" class="difflineplus">+      // if the folder does not support online search.</span>
<a href="#l23.40"></a><span id="l23.40" class="difflineplus">+</span>
<a href="#l23.41"></a><span id="l23.41" class="difflineplus">+      // Anything greater than 0 is an online server like IMAP or news.</span>
<a href="#l23.42"></a><span id="l23.42" class="difflineplus">+      if (gCurrentFolder.server.offlineSupportLevel &amp;&amp;</span>
<a href="#l23.43"></a><span id="l23.43" class="difflineplus">+          !Components.classes[&quot;@mozilla.org/network/io-service;1&quot;]</span>
<a href="#l23.44"></a><span id="l23.44" class="difflineplus">+                             .getService(Components.interfaces.nsIIOService)</span>
<a href="#l23.45"></a><span id="l23.45" class="difflineplus">+                             .offline)</span>
<a href="#l23.46"></a><span id="l23.46" class="difflineplus">+      {</span>
<a href="#l23.47"></a><span id="l23.47" class="difflineplus">+        searchOnline.disabled = false;</span>
<a href="#l23.48"></a><span id="l23.48" class="difflineplus">+      }</span>
<a href="#l23.49"></a><span id="l23.49" class="difflineplus">+      else</span>
<a href="#l23.50"></a><span id="l23.50" class="difflineplus">+      {</span>
<a href="#l23.51"></a><span id="l23.51" class="difflineplus">+        searchOnline.checked = false;</span>
<a href="#l23.52"></a><span id="l23.52" class="difflineplus">+        searchOnline.disabled = true;</span>
<a href="#l23.53"></a><span id="l23.53" class="difflineplus">+      }</span>
<a href="#l23.54"></a><span id="l23.54" class="difflineplus">+    }</span>
<a href="#l23.55"></a><span id="l23.55">     setSearchScope(GetScopeForFolder(gCurrentFolder));</span>
<a href="#l23.56"></a><span id="l23.56"> }</span>
<a href="#l23.57"></a><span id="l23.57"> </span>
<a href="#l23.58"></a><span id="l23.58"> function updateSearchLocalSystem()</span>
<a href="#l23.59"></a><span id="l23.59"> {</span>
<a href="#l23.60"></a><span id="l23.60">   setSearchScope(GetScopeForFolder(gCurrentFolder));</span>
<a href="#l23.61"></a><span id="l23.61"> }</span>
<a href="#l23.62"></a><span id="l23.62"> </span>
<a href="#l23.63"></a><span id="l23.63" class="difflineat">@@ -387,16 +407,17 @@ function onEnterInSearchTerm()</span>
<a href="#l23.64"></a><span id="l23.64"> </span>
<a href="#l23.65"></a><span id="l23.65"> function onSearch()</span>
<a href="#l23.66"></a><span id="l23.66"> {</span>
<a href="#l23.67"></a><span id="l23.67">   let viewWrapper = gFolderDisplay.view;</span>
<a href="#l23.68"></a><span id="l23.68">   let searchTerms = getSearchTerms();</span>
<a href="#l23.69"></a><span id="l23.69"> </span>
<a href="#l23.70"></a><span id="l23.70">   viewWrapper.beginViewUpdate();</span>
<a href="#l23.71"></a><span id="l23.71">   viewWrapper.search.userTerms = searchTerms.length ? searchTerms : null;</span>
<a href="#l23.72"></a><span id="l23.72" class="difflineplus">+  viewWrapper.search.onlineSearch = gSearchOnline;</span>
<a href="#l23.73"></a><span id="l23.73">   viewWrapper.searchFolders = getSearchFolders();</span>
<a href="#l23.74"></a><span id="l23.74">   viewWrapper.endViewUpdate();</span>
<a href="#l23.75"></a><span id="l23.75"> }</span>
<a href="#l23.76"></a><span id="l23.76"> </span>
<a href="#l23.77"></a><span id="l23.77"> /**</span>
<a href="#l23.78"></a><span id="l23.78">  * Get the current set of search terms, returning them as a list.  We filter out</span>
<a href="#l23.79"></a><span id="l23.79">  *  dangerous and insane predicates.</span>
<a href="#l23.80"></a><span id="l23.80">  */</span>
<a href="#l23.81"></a><span id="l23.81" class="difflineat">@@ -481,21 +502,79 @@ function AddSubFoldersToURI(folder)</span>
<a href="#l23.82"></a><span id="l23.82">           returnString += '|';</span>
<a href="#l23.83"></a><span id="l23.83">         returnString += subFoldersString;</span>
<a href="#l23.84"></a><span id="l23.84">       }</span>
<a href="#l23.85"></a><span id="l23.85">     }</span>
<a href="#l23.86"></a><span id="l23.86">   }</span>
<a href="#l23.87"></a><span id="l23.87">   return returnString;</span>
<a href="#l23.88"></a><span id="l23.88"> }</span>
<a href="#l23.89"></a><span id="l23.89"> </span>
<a href="#l23.90"></a><span id="l23.90" class="difflineminus">-</span>
<a href="#l23.91"></a><span id="l23.91" class="difflineplus">+/**</span>
<a href="#l23.92"></a><span id="l23.92" class="difflineplus">+ * Determine the proper search scope to use for a folder, so that the user is</span>
<a href="#l23.93"></a><span id="l23.93" class="difflineplus">+ *  presented with a correct list of search capabilities. The user may manually</span>
<a href="#l23.94"></a><span id="l23.94" class="difflineplus">+ *  request on online search for certain server types. To determine if the</span>
<a href="#l23.95"></a><span id="l23.95" class="difflineplus">+ *  folder body may be searched, we ignore whether autosync is enabled,</span>
<a href="#l23.96"></a><span id="l23.96" class="difflineplus">+ *  figuring that after the user manually syncs, they would still expect that</span>
<a href="#l23.97"></a><span id="l23.97" class="difflineplus">+ *  body searches would work.</span>
<a href="#l23.98"></a><span id="l23.98" class="difflineplus">+ *  </span>
<a href="#l23.99"></a><span id="l23.99" class="difflineplus">+ * The available search capabilities also depend on whether the user is</span>
<a href="#l23.100"></a><span id="l23.100" class="difflineplus">+ *  currently online or offline. Although that is also checked by the server,</span>
<a href="#l23.101"></a><span id="l23.101" class="difflineplus">+ *  we do it ourselves because we have a more complex response to offline</span>
<a href="#l23.102"></a><span id="l23.102" class="difflineplus">+ *  than the server's searchScope attribute provides.</span>
<a href="#l23.103"></a><span id="l23.103" class="difflineplus">+ *</span>
<a href="#l23.104"></a><span id="l23.104" class="difflineplus">+ * This method only works for real folders.</span>
<a href="#l23.105"></a><span id="l23.105" class="difflineplus">+ */</span>
<a href="#l23.106"></a><span id="l23.106"> function GetScopeForFolder(folder)</span>
<a href="#l23.107"></a><span id="l23.107"> {</span>
<a href="#l23.108"></a><span id="l23.108" class="difflineminus">-  var searchLocalSystem = document.getElementById(&quot;checkSearchLocalSystem&quot;);</span>
<a href="#l23.109"></a><span id="l23.109" class="difflineminus">-  return searchLocalSystem &amp;&amp; searchLocalSystem.checked ? nsMsgSearchScope.offlineMail : folder.server.searchScope;</span>
<a href="#l23.110"></a><span id="l23.110" class="difflineplus">+  let searchOnline = document.getElementById(&quot;checkSearchOnline&quot;);</span>
<a href="#l23.111"></a><span id="l23.111" class="difflineplus">+  if (searchOnline &amp;&amp; searchOnline.checked)</span>
<a href="#l23.112"></a><span id="l23.112" class="difflineplus">+  {</span>
<a href="#l23.113"></a><span id="l23.113" class="difflineplus">+    gSearchOnline = true;</span>
<a href="#l23.114"></a><span id="l23.114" class="difflineplus">+    return folder.server.searchScope;</span>
<a href="#l23.115"></a><span id="l23.115" class="difflineplus">+  }</span>
<a href="#l23.116"></a><span id="l23.116" class="difflineplus">+  gSearchOnline = false;</span>
<a href="#l23.117"></a><span id="l23.117" class="difflineplus">+</span>
<a href="#l23.118"></a><span id="l23.118" class="difflineplus">+  // We are going to search offline. The proper search scope may depend on</span>
<a href="#l23.119"></a><span id="l23.119" class="difflineplus">+  // whether we have the body and/or junk available or not.</span>
<a href="#l23.120"></a><span id="l23.120" class="difflineplus">+  let localType;</span>
<a href="#l23.121"></a><span id="l23.121" class="difflineplus">+  try</span>
<a href="#l23.122"></a><span id="l23.122" class="difflineplus">+  {</span>
<a href="#l23.123"></a><span id="l23.123" class="difflineplus">+    localType = folder.server.localStoreType;</span>
<a href="#l23.124"></a><span id="l23.124" class="difflineplus">+  }</span>
<a href="#l23.125"></a><span id="l23.125" class="difflineplus">+  catch (e) {} // On error, we'll just assume the default mailbox type</span>
<a href="#l23.126"></a><span id="l23.126" class="difflineplus">+</span>
<a href="#l23.127"></a><span id="l23.127" class="difflineplus">+  let hasBody = folder.getFlag(Components.interfaces.nsMsgFolderFlags.Offline);</span>
<a href="#l23.128"></a><span id="l23.128" class="difflineplus">+  let nsMsgSearchScope = Components.interfaces.nsMsgSearchScope;</span>
<a href="#l23.129"></a><span id="l23.129" class="difflineplus">+  switch (localType)</span>
<a href="#l23.130"></a><span id="l23.130" class="difflineplus">+  {</span>
<a href="#l23.131"></a><span id="l23.131" class="difflineplus">+    case &quot;news&quot;:</span>
<a href="#l23.132"></a><span id="l23.132" class="difflineplus">+      // News has four offline scopes, depending on whether junk and body</span>
<a href="#l23.133"></a><span id="l23.133" class="difflineplus">+      // are available.</span>
<a href="#l23.134"></a><span id="l23.134" class="difflineplus">+      let hasJunk = </span>
<a href="#l23.135"></a><span id="l23.135" class="difflineplus">+        folder.getInheritedStringProperty(&quot;dobayes.mailnews@mozilla.org#junk&quot;)</span>
<a href="#l23.136"></a><span id="l23.136" class="difflineplus">+               == &quot;true&quot;;</span>
<a href="#l23.137"></a><span id="l23.137" class="difflineplus">+      if (hasJunk &amp;&amp; hasBody)</span>
<a href="#l23.138"></a><span id="l23.138" class="difflineplus">+        return nsMsgSearchScope.localNewsJunkBody;</span>
<a href="#l23.139"></a><span id="l23.139" class="difflineplus">+      if (hasJunk) // and no body</span>
<a href="#l23.140"></a><span id="l23.140" class="difflineplus">+        return nsMsgSearchScope.localNewsJunk;</span>
<a href="#l23.141"></a><span id="l23.141" class="difflineplus">+      if (hasBody) // and no junk</span>
<a href="#l23.142"></a><span id="l23.142" class="difflineplus">+        return nsMsgSearchScope.localNewsBody;</span>
<a href="#l23.143"></a><span id="l23.143" class="difflineplus">+      // We don't have offline message bodies or junk processing.</span>
<a href="#l23.144"></a><span id="l23.144" class="difflineplus">+      return nsMsgSearchScope.localNews;</span>
<a href="#l23.145"></a><span id="l23.145" class="difflineplus">+</span>
<a href="#l23.146"></a><span id="l23.146" class="difflineplus">+    case &quot;imap&quot;:</span>
<a href="#l23.147"></a><span id="l23.147" class="difflineplus">+      // Junk is always enabled for imap, so the offline scope only depends on</span>
<a href="#l23.148"></a><span id="l23.148" class="difflineplus">+      // whether the body is available.</span>
<a href="#l23.149"></a><span id="l23.149" class="difflineplus">+      if (!hasBody)</span>
<a href="#l23.150"></a><span id="l23.150" class="difflineplus">+        return nsMsgSearchScope.onlineManual;</span>
<a href="#l23.151"></a><span id="l23.151" class="difflineplus">+        // fall through to default</span>
<a href="#l23.152"></a><span id="l23.152" class="difflineplus">+    default:</span>
<a href="#l23.153"></a><span id="l23.153" class="difflineplus">+      return nsMsgSearchScope.offlineMail;</span>
<a href="#l23.154"></a><span id="l23.154" class="difflineplus">+  }</span>
<a href="#l23.155"></a><span id="l23.155" class="difflineplus">+</span>
<a href="#l23.156"></a><span id="l23.156"> }</span>
<a href="#l23.157"></a><span id="l23.157"> </span>
<a href="#l23.158"></a><span id="l23.158"> var nsMsgViewSortType = Components.interfaces.nsMsgViewSortType;</span>
<a href="#l23.159"></a><span id="l23.159"> var nsMsgViewSortOrder = Components.interfaces.nsMsgViewSortOrder;</span>
<a href="#l23.160"></a><span id="l23.160"> var nsMsgViewFlagsType = Components.interfaces.nsMsgViewFlagsType;</span>
<a href="#l23.161"></a><span id="l23.161"> var nsMsgViewCommandType = Components.interfaces.nsMsgViewCommandType;</span>
<a href="#l23.162"></a><span id="l23.162"> </span>
<a href="#l23.163"></a><span id="l23.163"> function goUpdateSearchItems(commandset)</span>
<a href="#l23.164"></a><span id="l23.164" class="difflineat">@@ -583,11 +662,12 @@ function saveAsVirtualFolder()</span>
<a href="#l23.165"></a><span id="l23.165">       searchFolderURIs += '|' + subFolderURIs;</span>
<a href="#l23.166"></a><span id="l23.166">   }</span>
<a href="#l23.167"></a><span id="l23.167"> </span>
<a href="#l23.168"></a><span id="l23.168">   var dialog = window.openDialog(&quot;chrome://messenger/content/virtualFolderProperties.xul&quot;, &quot;&quot;,</span>
<a href="#l23.169"></a><span id="l23.169">                                  &quot;chrome,titlebar,modal,centerscreen&quot;,</span>
<a href="#l23.170"></a><span id="l23.170">                                  {folder: window.arguments[0].folder,</span>
<a href="#l23.171"></a><span id="l23.171">                                   searchTerms: toXPCOMArray(getSearchTerms(),</span>
<a href="#l23.172"></a><span id="l23.172">                                                             Components.interfaces.nsISupportsArray),</span>
<a href="#l23.173"></a><span id="l23.173" class="difflineminus">-                                  searchFolderURIs: searchFolderURIs});</span>
<a href="#l23.174"></a><span id="l23.174" class="difflineplus">+                                  searchFolderURIs: searchFolderURIs,</span>
<a href="#l23.175"></a><span id="l23.175" class="difflineplus">+                                  searchOnline: document.getElementById(&quot;checkSearchOnline&quot;).checked});</span>
<a href="#l23.176"></a><span id="l23.176"> }</span>
<a href="#l23.177"></a><span id="l23.177"> </span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l24.1"></a><span id="l24.1" class="difflineminus">--- a/mail/base/content/SearchDialog.xul</span>
<a href="#l24.2"></a><span id="l24.2" class="difflineplus">+++ b/mail/base/content/SearchDialog.xul</span>
<a href="#l24.3"></a><span id="l24.3" class="difflineat">@@ -118,16 +118,22 @@</span>
<a href="#l24.4"></a><span id="l24.4">          &lt;button id=&quot;search-button&quot; oncommand=&quot;onSearchButton(event);&quot; default=&quot;true&quot;/&gt;</span>
<a href="#l24.5"></a><span id="l24.5">         &lt;/hbox&gt;</span>
<a href="#l24.6"></a><span id="l24.6"> </span>
<a href="#l24.7"></a><span id="l24.7">          &lt;hbox align=&quot;center&quot;&gt;</span>
<a href="#l24.8"></a><span id="l24.8">            &lt;checkbox id=&quot;checkSearchSubFolders&quot; label=&quot;&amp;searchSubfolders.label;&quot; checked=&quot;true&quot; accesskey=&quot;&amp;searchSubfolders.accesskey;&quot;/&gt;</span>
<a href="#l24.9"></a><span id="l24.9">            &lt;spacer flex=&quot;10&quot;/&gt;</span>
<a href="#l24.10"></a><span id="l24.10">            &lt;button label=&quot;&amp;resetButton.label;&quot; oncommand=&quot;onResetSearch(event);&quot; accesskey=&quot;&amp;resetButton.accesskey;&quot;/&gt;</span>
<a href="#l24.11"></a><span id="l24.11">          &lt;/hbox&gt;</span>
<a href="#l24.12"></a><span id="l24.12" class="difflineplus">+         &lt;hbox align=&quot;center&quot;&gt;</span>
<a href="#l24.13"></a><span id="l24.13" class="difflineplus">+           &lt;checkbox id=&quot;checkSearchOnline&quot;</span>
<a href="#l24.14"></a><span id="l24.14" class="difflineplus">+                     label=&quot;&amp;searchOnline.label;&quot;</span>
<a href="#l24.15"></a><span id="l24.15" class="difflineplus">+                     accesskey=&quot;&amp;searchOnline.accesskey;&quot;</span>
<a href="#l24.16"></a><span id="l24.16" class="difflineplus">+                     oncommand=&quot;updateSearchLocalSystem();&quot;/&gt;</span>
<a href="#l24.17"></a><span id="l24.17" class="difflineplus">+         &lt;/hbox&gt;</span>
<a href="#l24.18"></a><span id="l24.18">       &lt;/vbox&gt;</span>
<a href="#l24.19"></a><span id="l24.19"> </span>
<a href="#l24.20"></a><span id="l24.20">       &lt;hbox flex=&quot;1&quot;&gt;</span>
<a href="#l24.21"></a><span id="l24.21">         &lt;vbox id=&quot;searchTermListBox&quot; flex=&quot;1&quot;/&gt;</span>
<a href="#l24.22"></a><span id="l24.22">       &lt;/hbox&gt;</span>
<a href="#l24.23"></a><span id="l24.23">     &lt;/vbox&gt;</span>
<a href="#l24.24"></a><span id="l24.24"> </span>
<a href="#l24.25"></a><span id="l24.25">     &lt;splitter id=&quot;gray_horizontal_splitter&quot; collapse=&quot;after&quot; persist=&quot;state&quot;/&gt;</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l25.1"></a><span id="l25.1" class="difflineminus">--- a/mail/base/content/folderPane.js</span>
<a href="#l25.2"></a><span id="l25.2" class="difflineplus">+++ b/mail/base/content/folderPane.js</span>
<a href="#l25.3"></a><span id="l25.3" class="difflineat">@@ -202,18 +202,17 @@ let gFolderTreeView = {</span>
<a href="#l25.4"></a><span id="l25.4">   },</span>
<a href="#l25.5"></a><span id="l25.5"> </span>
<a href="#l25.6"></a><span id="l25.6">   /**</span>
<a href="#l25.7"></a><span id="l25.7">    * If the hidden pref is set, then double-clicking on a folder should open it</span>
<a href="#l25.8"></a><span id="l25.8">    *</span>
<a href="#l25.9"></a><span id="l25.9">    * @param event  the double-click event</span>
<a href="#l25.10"></a><span id="l25.10">    */</span>
<a href="#l25.11"></a><span id="l25.11">   onDoubleClick: function ftv_onDoubleClick(aEvent) {</span>
<a href="#l25.12"></a><span id="l25.12" class="difflineminus">-    if (pref.getBoolPref(&quot;mailnews.reuse_thread_window2&quot;) ||</span>
<a href="#l25.13"></a><span id="l25.13" class="difflineminus">-        aEvent.button != 0 || aEvent.originalTarget.localName == &quot;twisty&quot; ||</span>
<a href="#l25.14"></a><span id="l25.14" class="difflineplus">+    if (aEvent.button != 0 || aEvent.originalTarget.localName == &quot;twisty&quot; ||</span>
<a href="#l25.15"></a><span id="l25.15">         aEvent.originalTarget.localName == &quot;slider&quot; ||</span>
<a href="#l25.16"></a><span id="l25.16">         aEvent.originalTarget.localName == &quot;scrollbarbutton&quot;)</span>
<a href="#l25.17"></a><span id="l25.17">       return;</span>
<a href="#l25.18"></a><span id="l25.18"> </span>
<a href="#l25.19"></a><span id="l25.19">     let row = gFolderTreeView._treeElement.treeBoxObject.getRowAt(aEvent.clientX,</span>
<a href="#l25.20"></a><span id="l25.20">                                                                   aEvent.clientY);</span>
<a href="#l25.21"></a><span id="l25.21">     let folderItem = gFolderTreeView._rowMap[row];</span>
<a href="#l25.22"></a><span id="l25.22">     if (folderItem)</span>
<a href="#l25.23"></a><span id="l25.23" class="difflineat">@@ -1406,17 +1405,20 @@ ftvItem.prototype = {</span>
<a href="#l25.24"></a><span id="l25.24">   },</span>
<a href="#l25.25"></a><span id="l25.25"> </span>
<a href="#l25.26"></a><span id="l25.26">   getProperties: function ftvItem_getProperties(aProps) {</span>
<a href="#l25.27"></a><span id="l25.27">     // From folderUtils.jsm</span>
<a href="#l25.28"></a><span id="l25.28">     setPropertyAtoms(this._folder, aProps);</span>
<a href="#l25.29"></a><span id="l25.29">   },</span>
<a href="#l25.30"></a><span id="l25.30"> </span>
<a href="#l25.31"></a><span id="l25.31">   command: function fti_command() {</span>
<a href="#l25.32"></a><span id="l25.32" class="difflineminus">-    MsgOpenNewWindowForFolder(this._folder.URI, -1 /* key */);</span>
<a href="#l25.33"></a><span id="l25.33" class="difflineplus">+    let pref = Components.classes[&quot;@mozilla.org/preferences-service;1&quot;]</span>
<a href="#l25.34"></a><span id="l25.34" class="difflineplus">+                         .getService(Components.interfaces.nsIPrefBranch);</span>
<a href="#l25.35"></a><span id="l25.35" class="difflineplus">+    if (!pref.getBoolPref(&quot;mailnews.reuse_thread_window2&quot;))</span>
<a href="#l25.36"></a><span id="l25.36" class="difflineplus">+      MsgOpenNewWindowForFolder(this._folder.URI, -1 /* key */);</span>
<a href="#l25.37"></a><span id="l25.37">   },</span>
<a href="#l25.38"></a><span id="l25.38"> </span>
<a href="#l25.39"></a><span id="l25.39">   _children: null,</span>
<a href="#l25.40"></a><span id="l25.40">   get children() {</span>
<a href="#l25.41"></a><span id="l25.41">     const Ci = Components.interfaces;</span>
<a href="#l25.42"></a><span id="l25.42">     // We're caching our child list to save perf.</span>
<a href="#l25.43"></a><span id="l25.43">     if (!this._children) {</span>
<a href="#l25.44"></a><span id="l25.44">       let iter = fixIterator(this._folder.subFolders, Ci.nsIMsgFolder);</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l26.1"></a><span id="l26.1" class="difflineminus">--- a/mail/base/content/mail3PaneWindowCommands.js</span>
<a href="#l26.2"></a><span id="l26.2" class="difflineplus">+++ b/mail/base/content/mail3PaneWindowCommands.js</span>
<a href="#l26.3"></a><span id="l26.3" class="difflineat">@@ -228,16 +228,18 @@ var DefaultController =</span>
<a href="#l26.4"></a><span id="l26.4">       case &quot;cmd_selectAll&quot;:</span>
<a href="#l26.5"></a><span id="l26.5">       case &quot;cmd_selectThread&quot;:</span>
<a href="#l26.6"></a><span id="l26.6">       case &quot;cmd_moveToFolderAgain&quot;:</span>
<a href="#l26.7"></a><span id="l26.7">       case &quot;cmd_selectFlagged&quot;:</span>
<a href="#l26.8"></a><span id="l26.8">       case &quot;cmd_fullZoomReduce&quot;:</span>
<a href="#l26.9"></a><span id="l26.9">       case &quot;cmd_fullZoomEnlarge&quot;:</span>
<a href="#l26.10"></a><span id="l26.10">       case &quot;cmd_fullZoomReset&quot;:</span>
<a href="#l26.11"></a><span id="l26.11">       case &quot;cmd_fullZoomToggle&quot;:</span>
<a href="#l26.12"></a><span id="l26.12" class="difflineplus">+      case &quot;cmd_viewAllHeader&quot;:</span>
<a href="#l26.13"></a><span id="l26.13" class="difflineplus">+      case &quot;cmd_viewNormalHeader&quot;:</span>
<a href="#l26.14"></a><span id="l26.14">         return true;</span>
<a href="#l26.15"></a><span id="l26.15">       case &quot;cmd_downloadFlagged&quot;:</span>
<a href="#l26.16"></a><span id="l26.16">       case &quot;cmd_downloadSelected&quot;:</span>
<a href="#l26.17"></a><span id="l26.17">       case &quot;cmd_synchronizeOffline&quot;:</span>
<a href="#l26.18"></a><span id="l26.18">         return MailOfflineMgr.isOnline();</span>
<a href="#l26.19"></a><span id="l26.19"> </span>
<a href="#l26.20"></a><span id="l26.20">       case &quot;cmd_watchThread&quot;:</span>
<a href="#l26.21"></a><span id="l26.21">       case &quot;cmd_killThread&quot;:</span>
<a href="#l26.22"></a><span id="l26.22" class="difflineat">@@ -342,34 +344,38 @@ var DefaultController =</span>
<a href="#l26.23"></a><span id="l26.23">           return true;</span>
<a href="#l26.24"></a><span id="l26.24">         }</span>
<a href="#l26.25"></a><span id="l26.25">         return false;</span>
<a href="#l26.26"></a><span id="l26.26">       case &quot;cmd_printpreview&quot;:</span>
<a href="#l26.27"></a><span id="l26.27">         if (GetNumSelectedMessages() == 1)</span>
<a href="#l26.28"></a><span id="l26.28">           return gFolderDisplay.getCommandStatus(nsMsgViewCommandType.cmdRequiringMsgBody);</span>
<a href="#l26.29"></a><span id="l26.29">         return false;</span>
<a href="#l26.30"></a><span id="l26.30">       case &quot;cmd_printSetup&quot;:</span>
<a href="#l26.31"></a><span id="l26.31" class="difflineplus">+      case &quot;cmd_viewAllHeader&quot;:</span>
<a href="#l26.32"></a><span id="l26.32" class="difflineplus">+      case &quot;cmd_viewNormalHeader&quot;:</span>
<a href="#l26.33"></a><span id="l26.33">         return true;</span>
<a href="#l26.34"></a><span id="l26.34">       case &quot;cmd_markAsFlagged&quot;:</span>
<a href="#l26.35"></a><span id="l26.35">       case &quot;button_file&quot;:</span>
<a href="#l26.36"></a><span id="l26.36">       case &quot;cmd_file&quot;:</span>
<a href="#l26.37"></a><span id="l26.37">       case &quot;cmd_archive&quot;:</span>
<a href="#l26.38"></a><span id="l26.38">         return (gFolderDisplay.selectedCount &gt; 0 );</span>
<a href="#l26.39"></a><span id="l26.39">       case &quot;button_archive&quot;:</span>
<a href="#l26.40"></a><span id="l26.40">         return gFolderDisplay.selectedCount &gt; 0 &amp;&amp; gFolderDisplay.displayedFolder &amp;&amp;</span>
<a href="#l26.41"></a><span id="l26.41">           !gFolderDisplay.displayedFolder.isSpecialFolder(</span>
<a href="#l26.42"></a><span id="l26.42">              Components.interfaces.nsMsgFolderFlags.Archive, true);</span>
<a href="#l26.43"></a><span id="l26.43">       case &quot;cmd_markAsJunk&quot;:</span>
<a href="#l26.44"></a><span id="l26.44">       case &quot;cmd_markAsNotJunk&quot;:</span>
<a href="#l26.45"></a><span id="l26.45" class="difflineminus">-        // can't do news on junk yet.</span>
<a href="#l26.46"></a><span id="l26.46" class="difflineminus">-        return (GetNumSelectedMessages() &gt; 0 &amp;&amp; !gFolderDisplay.selectedMessageIsNews);</span>
<a href="#l26.47"></a><span id="l26.47" class="difflineplus">+        return gFolderDisplay.getCommandStatus(nsMsgViewCommandType.junk);</span>
<a href="#l26.48"></a><span id="l26.48">       case &quot;cmd_recalculateJunkScore&quot;:</span>
<a href="#l26.49"></a><span id="l26.49" class="difflineminus">-        if (GetNumSelectedMessages() &gt; 0)</span>
<a href="#l26.50"></a><span id="l26.50" class="difflineminus">-          return gFolderDisplay.getCommandStatus(nsMsgViewCommandType.runJunkControls);</span>
<a href="#l26.51"></a><span id="l26.51" class="difflineminus">-        return false;</span>
<a href="#l26.52"></a><span id="l26.52" class="difflineplus">+        // We're going to take a conservative position here, because we really</span>
<a href="#l26.53"></a><span id="l26.53" class="difflineplus">+        // don't want people running junk controls on folders that are not</span>
<a href="#l26.54"></a><span id="l26.54" class="difflineplus">+        // enabled for junk. The junk type picks up possible dummy message headers,</span>
<a href="#l26.55"></a><span id="l26.55" class="difflineplus">+        // while the runJunkControls will prevent running on XF virtual folders.</span>
<a href="#l26.56"></a><span id="l26.56" class="difflineplus">+        return gFolderDisplay.getCommandStatus(nsMsgViewCommandType.junk) &amp;&amp;</span>
<a href="#l26.57"></a><span id="l26.57" class="difflineplus">+               gFolderDisplay.getCommandStatus(nsMsgViewCommandType.runJunkControls);</span>
<a href="#l26.58"></a><span id="l26.58">       case &quot;cmd_displayMsgFilters&quot;:</span>
<a href="#l26.59"></a><span id="l26.59">         let mgr = Components.classes[&quot;@mozilla.org/messenger/account-manager;1&quot;]</span>
<a href="#l26.60"></a><span id="l26.60">                             .getService(Components.interfaces.nsIMsgAccountManager);</span>
<a href="#l26.61"></a><span id="l26.61">         return mgr.accounts.Count() &gt; 0;</span>
<a href="#l26.62"></a><span id="l26.62">       case &quot;cmd_applyFilters&quot;:</span>
<a href="#l26.63"></a><span id="l26.63">         return gFolderDisplay.getCommandStatus(nsMsgViewCommandType.applyFilters);</span>
<a href="#l26.64"></a><span id="l26.64">       case &quot;cmd_runJunkControls&quot;:</span>
<a href="#l26.65"></a><span id="l26.65">         return gFolderDisplay.getCommandStatus(nsMsgViewCommandType.runJunkControls);</span>
<a href="#l26.66"></a><span id="l26.66" class="difflineat">@@ -739,16 +745,22 @@ var DefaultController =</span>
<a href="#l26.67"></a><span id="l26.67">         MsgJunk();</span>
<a href="#l26.68"></a><span id="l26.68">         return;</span>
<a href="#l26.69"></a><span id="l26.69">       case &quot;cmd_stop&quot;:</span>
<a href="#l26.70"></a><span id="l26.70">         msgWindow.StopUrls();</span>
<a href="#l26.71"></a><span id="l26.71">         return;</span>
<a href="#l26.72"></a><span id="l26.72">       case &quot;cmd_markAsFlagged&quot;:</span>
<a href="#l26.73"></a><span id="l26.73">         MsgMarkAsFlagged();</span>
<a href="#l26.74"></a><span id="l26.74">         return;</span>
<a href="#l26.75"></a><span id="l26.75" class="difflineplus">+      case &quot;cmd_viewAllHeader&quot;:</span>
<a href="#l26.76"></a><span id="l26.76" class="difflineplus">+        MsgViewAllHeaders();</span>
<a href="#l26.77"></a><span id="l26.77" class="difflineplus">+        return;</span>
<a href="#l26.78"></a><span id="l26.78" class="difflineplus">+      case &quot;cmd_viewNormalHeader&quot;:</span>
<a href="#l26.79"></a><span id="l26.79" class="difflineplus">+        MsgViewNormalHeaders();</span>
<a href="#l26.80"></a><span id="l26.80" class="difflineplus">+        return;</span>
<a href="#l26.81"></a><span id="l26.81">       case &quot;cmd_markAsJunk&quot;:</span>
<a href="#l26.82"></a><span id="l26.82">         JunkSelectedMessages(true);</span>
<a href="#l26.83"></a><span id="l26.83">         return;</span>
<a href="#l26.84"></a><span id="l26.84">       case &quot;cmd_markAsNotJunk&quot;:</span>
<a href="#l26.85"></a><span id="l26.85">         JunkSelectedMessages(false);</span>
<a href="#l26.86"></a><span id="l26.86">         return;</span>
<a href="#l26.87"></a><span id="l26.87">       case &quot;cmd_recalculateJunkScore&quot;:</span>
<a href="#l26.88"></a><span id="l26.88">         analyzeMessagesForJunk();</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l27.1"></a><span id="l27.1" class="difflineminus">--- a/mail/base/content/mailWidgets.xml</span>
<a href="#l27.2"></a><span id="l27.2" class="difflineplus">+++ b/mail/base/content/mailWidgets.xml</span>
<a href="#l27.3"></a><span id="l27.3" class="difflineat">@@ -388,16 +388,21 @@</span>
<a href="#l27.4"></a><span id="l27.4">               aNumAddressesToShow = numAddresses;</span>
<a href="#l27.5"></a><span id="l27.5"> </span>
<a href="#l27.6"></a><span id="l27.6">             // before we try to create email address nodes, try to leverage any cached nodes...</span>
<a href="#l27.7"></a><span id="l27.7">             var remainder = this.fillCachedAddresses(aAddressesNode, aNumAddressesToShow);</span>
<a href="#l27.8"></a><span id="l27.8">             var index = numAddresses - remainder;</span>
<a href="#l27.9"></a><span id="l27.9">             while (index &lt; numAddresses &amp;&amp; index &lt; aNumAddressesToShow)</span>
<a href="#l27.10"></a><span id="l27.10">             {</span>
<a href="#l27.11"></a><span id="l27.11">               var newAddressNode = document.createElement(&quot;mail-emailaddress&quot;);</span>
<a href="#l27.12"></a><span id="l27.12" class="difflineplus">+</span>
<a href="#l27.13"></a><span id="l27.13" class="difflineplus">+              // Stash the headerName somewhere that AddExtraAddressProcessing</span>
<a href="#l27.14"></a><span id="l27.14" class="difflineplus">+              // will be able to find it.</span>
<a href="#l27.15"></a><span id="l27.15" class="difflineplus">+              newAddressNode.setAttribute(&quot;headerName&quot;, this.headerName);</span>
<a href="#l27.16"></a><span id="l27.16" class="difflineplus">+</span>
<a href="#l27.17"></a><span id="l27.17">               if (index)</span>
<a href="#l27.18"></a><span id="l27.18">               {</span>
<a href="#l27.19"></a><span id="l27.19">                 var textNode = document.createElement(&quot;text&quot;);</span>
<a href="#l27.20"></a><span id="l27.20">                 textNode.setAttribute(&quot;value&quot;, &quot;,&quot;);</span>
<a href="#l27.21"></a><span id="l27.21">                 textNode.setAttribute(&quot;class&quot;, &quot;emailSeparator&quot;);</span>
<a href="#l27.22"></a><span id="l27.22">                 aAddressesNode.appendChild(textNode);</span>
<a href="#l27.23"></a><span id="l27.23">               }</span>
<a href="#l27.24"></a><span id="l27.24"> </span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l28.1"></a><span id="l28.1" class="difflineminus">--- a/mail/base/content/mailWindowOverlay.js</span>
<a href="#l28.2"></a><span id="l28.2" class="difflineplus">+++ b/mail/base/content/mailWindowOverlay.js</span>
<a href="#l28.3"></a><span id="l28.3" class="difflineat">@@ -401,41 +401,23 @@ function initMoveToFolderAgainMenu(aMenu</span>
<a href="#l28.4"></a><span id="l28.4">       &quot;moveToFolderAgain&quot; : &quot;copyToFolderAgain&quot;, [destMsgFolder.prettyName], 1);</span>
<a href="#l28.5"></a><span id="l28.5">     aMenuItem.accesskey = gMessengerBundle.getString(isMove ?</span>
<a href="#l28.6"></a><span id="l28.6">       &quot;moveToFolderAgainAccessKey&quot; : &quot;copyToFolderAgainAccessKey&quot;);</span>
<a href="#l28.7"></a><span id="l28.7">   }</span>
<a href="#l28.8"></a><span id="l28.8"> }</span>
<a href="#l28.9"></a><span id="l28.9"> </span>
<a href="#l28.10"></a><span id="l28.10"> function InitViewHeadersMenu()</span>
<a href="#l28.11"></a><span id="l28.11"> {</span>
<a href="#l28.12"></a><span id="l28.12" class="difflineminus">-  var headerchoice = 1;</span>
<a href="#l28.13"></a><span id="l28.13" class="difflineminus">-  try</span>
<a href="#l28.14"></a><span id="l28.14" class="difflineminus">-  {</span>
<a href="#l28.15"></a><span id="l28.15" class="difflineminus">-    headerchoice = pref.getIntPref(&quot;mail.show_headers&quot;);</span>
<a href="#l28.16"></a><span id="l28.16" class="difflineminus">-  }</span>
<a href="#l28.17"></a><span id="l28.17" class="difflineminus">-  catch (ex)</span>
<a href="#l28.18"></a><span id="l28.18" class="difflineminus">-  {</span>
<a href="#l28.19"></a><span id="l28.19" class="difflineminus">-    dump(&quot;failed to get the header pref\n&quot;);</span>
<a href="#l28.20"></a><span id="l28.20" class="difflineminus">-  }</span>
<a href="#l28.21"></a><span id="l28.21" class="difflineminus">-</span>
<a href="#l28.22"></a><span id="l28.22" class="difflineminus">-  var id = null;</span>
<a href="#l28.23"></a><span id="l28.23" class="difflineminus">-  switch (headerchoice)</span>
<a href="#l28.24"></a><span id="l28.24" class="difflineminus">-  {</span>
<a href="#l28.25"></a><span id="l28.25" class="difflineminus">-    case 2:</span>
<a href="#l28.26"></a><span id="l28.26" class="difflineminus">-      id = &quot;viewallheaders&quot;;</span>
<a href="#l28.27"></a><span id="l28.27" class="difflineminus">-      break;</span>
<a href="#l28.28"></a><span id="l28.28" class="difflineminus">-    case 1:</span>
<a href="#l28.29"></a><span id="l28.29" class="difflineminus">-    default:</span>
<a href="#l28.30"></a><span id="l28.30" class="difflineminus">-      id = &quot;viewnormalheaders&quot;;</span>
<a href="#l28.31"></a><span id="l28.31" class="difflineminus">-      break;</span>
<a href="#l28.32"></a><span id="l28.32" class="difflineminus">-  }</span>
<a href="#l28.33"></a><span id="l28.33" class="difflineminus">-</span>
<a href="#l28.34"></a><span id="l28.34" class="difflineminus">-  var menuitem = document.getElementById(id);</span>
<a href="#l28.35"></a><span id="l28.35" class="difflineminus">-  if (menuitem)</span>
<a href="#l28.36"></a><span id="l28.36" class="difflineminus">-    menuitem.setAttribute(&quot;checked&quot;, &quot;true&quot;);</span>
<a href="#l28.37"></a><span id="l28.37" class="difflineplus">+  const nsMimeHeaderDisplayTypes = Components.interfaces.nsMimeHeaderDisplayTypes;</span>
<a href="#l28.38"></a><span id="l28.38" class="difflineplus">+  var headerchoice = pref.getIntPref(&quot;mail.show_headers&quot;);</span>
<a href="#l28.39"></a><span id="l28.39" class="difflineplus">+  document.getElementById(&quot;cmd_viewAllHeader&quot;)</span>
<a href="#l28.40"></a><span id="l28.40" class="difflineplus">+          .setAttribute(&quot;checked&quot;, headerchoice == nsMimeHeaderDisplayTypes.AllHeaders);</span>
<a href="#l28.41"></a><span id="l28.41" class="difflineplus">+  document.getElementById(&quot;cmd_viewNormalHeader&quot;)</span>
<a href="#l28.42"></a><span id="l28.42" class="difflineplus">+          .setAttribute(&quot;checked&quot;, headerchoice == nsMimeHeaderDisplayTypes.NormalHeaders);</span>
<a href="#l28.43"></a><span id="l28.43" class="difflineplus">+  document.commandDispatcher.updateCommands(&quot;create-menu-mark&quot;);</span>
<a href="#l28.44"></a><span id="l28.44"> }</span>
<a href="#l28.45"></a><span id="l28.45"> </span>
<a href="#l28.46"></a><span id="l28.46"> function InitViewBodyMenu()</span>
<a href="#l28.47"></a><span id="l28.47"> {</span>
<a href="#l28.48"></a><span id="l28.48">   var html_as = 0;</span>
<a href="#l28.49"></a><span id="l28.49">   var prefer_plaintext = false;</span>
<a href="#l28.50"></a><span id="l28.50">   var disallow_classes = 0;</span>
<a href="#l28.51"></a><span id="l28.51">   var isFeed = gFolderDisplay.selectedMessageIsFeed;</span>
<a href="#l28.52"></a><span id="l28.52" class="difflineat">@@ -2445,17 +2427,17 @@ function UpdateJunkButton()</span>
<a href="#l28.53"></a><span id="l28.53">   // The junk message should slave off the selected message, as the preview pane</span>
<a href="#l28.54"></a><span id="l28.54">   //  may not be visible</span>
<a href="#l28.55"></a><span id="l28.55">   let hdr = gFolderDisplay.selectedMessage;</span>
<a href="#l28.56"></a><span id="l28.56">   // But only the message display knows if we are dealing with a dummy.</span>
<a href="#l28.57"></a><span id="l28.57">   if (!hdr || gMessageDisplay.isDummy) // .eml file</span>
<a href="#l28.58"></a><span id="l28.58">     return;</span>
<a href="#l28.59"></a><span id="l28.59">   let junkScore = hdr.getStringProperty(&quot;junkscore&quot;);</span>
<a href="#l28.60"></a><span id="l28.60">   let hideJunk = (junkScore == Components.interfaces.nsIJunkMailPlugin.IS_SPAM_SCORE);</span>
<a href="#l28.61"></a><span id="l28.61" class="difflineminus">-  if (gFolderDisplay.selectedMessageIsNews)</span>
<a href="#l28.62"></a><span id="l28.62" class="difflineplus">+  if (!gFolderDisplay.getCommandStatus(nsMsgViewCommandType.junk))</span>
<a href="#l28.63"></a><span id="l28.63">     hideJunk = true;</span>
<a href="#l28.64"></a><span id="l28.64"> </span>
<a href="#l28.65"></a><span id="l28.65">   getCurrentMsgHdrButtonBox().getButton('hdrJunkButton').disabled = hideJunk;</span>
<a href="#l28.66"></a><span id="l28.66"> }</span>
<a href="#l28.67"></a><span id="l28.67"> </span>
<a href="#l28.68"></a><span id="l28.68"> function MsgMarkMsgAsRead()</span>
<a href="#l28.69"></a><span id="l28.69"> {</span>
<a href="#l28.70"></a><span id="l28.70">   MarkSelectedMessagesRead(!SelectedMessagesAreRead());</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l29.1"></a><span id="l29.1" class="difflineminus">--- a/mail/base/content/mailWindowOverlay.xul</span>
<a href="#l29.2"></a><span id="l29.2" class="difflineplus">+++ b/mail/base/content/mailWindowOverlay.xul</span>
<a href="#l29.3"></a><span id="l29.3" class="difflineat">@@ -297,16 +297,18 @@</span>
<a href="#l29.4"></a><span id="l29.4">     &lt;command id=&quot;cmd_markAsRead&quot; oncommand=&quot;goDoCommand('cmd_markAsRead'); event.stopPropagation()&quot; disabled=&quot;true&quot;/&gt;</span>
<a href="#l29.5"></a><span id="l29.5">     &lt;command id=&quot;cmd_markAllRead&quot; oncommand=&quot;goDoCommand('cmd_markAllRead'); event.stopPropagation()&quot; disabled=&quot;true&quot;/&gt;</span>
<a href="#l29.6"></a><span id="l29.6">     &lt;command id=&quot;cmd_markThreadAsRead&quot; oncommand=&quot;goDoCommand('cmd_markThreadAsRead'); event.stopPropagation()&quot; disabled=&quot;true&quot;/&gt;</span>
<a href="#l29.7"></a><span id="l29.7">     &lt;command id=&quot;cmd_markReadByDate&quot; oncommand=&quot;goDoCommand('cmd_markReadByDate');&quot; disabled=&quot;true&quot;/&gt;</span>
<a href="#l29.8"></a><span id="l29.8">     &lt;command id=&quot;cmd_markAsFlagged&quot; oncommand=&quot;goDoCommand('cmd_markAsFlagged'); event.stopPropagation()&quot; disabled=&quot;true&quot;/&gt;</span>
<a href="#l29.9"></a><span id="l29.9">     &lt;command id=&quot;cmd_markAsJunk&quot; oncommand=&quot;goDoCommand('cmd_markAsJunk'); event.stopPropagation()&quot; disabled=&quot;true&quot;/&gt;</span>
<a href="#l29.10"></a><span id="l29.10">     &lt;command id=&quot;cmd_markAsNotJunk&quot; oncommand=&quot;goDoCommand('cmd_markAsNotJunk'); event.stopPropagation()&quot; disabled=&quot;true&quot;/&gt;</span>
<a href="#l29.11"></a><span id="l29.11">     &lt;command id=&quot;cmd_recalculateJunkScore&quot; oncommand=&quot;goDoCommand('cmd_recalculateJunkScore');&quot; disabled=&quot;true&quot;/&gt;</span>
<a href="#l29.12"></a><span id="l29.12" class="difflineplus">+    &lt;command id=&quot;cmd_viewAllHeader&quot; oncommand=&quot;goDoCommand('cmd_viewAllHeader');&quot; disabled=&quot;true&quot;/&gt;</span>
<a href="#l29.13"></a><span id="l29.13" class="difflineplus">+    &lt;command id=&quot;cmd_viewNormalHeader&quot; oncommand=&quot;goDoCommand('cmd_viewNormalHeader');&quot; disabled=&quot;true&quot;/&gt;</span>
<a href="#l29.14"></a><span id="l29.14"> &lt;/commandset&gt;</span>
<a href="#l29.15"></a><span id="l29.15"> </span>
<a href="#l29.16"></a><span id="l29.16"> &lt;commandset id=&quot;mailToolsMenuItems&quot;</span>
<a href="#l29.17"></a><span id="l29.17">               commandupdater=&quot;true&quot;</span>
<a href="#l29.18"></a><span id="l29.18">               events=&quot;create-menu-tasks&quot;</span>
<a href="#l29.19"></a><span id="l29.19">               oncommandupdate=&quot;goUpdateMailMenuItems(this)&quot;&gt;</span>
<a href="#l29.20"></a><span id="l29.20">   &lt;command id=&quot;cmd_displayMsgFilters&quot;</span>
<a href="#l29.21"></a><span id="l29.21">            oncommand=&quot;goDoCommand('cmd_displayMsgFilters');&quot; disabled=&quot;true&quot;/&gt;</span>
<a href="#l29.22"></a><span id="l29.22" class="difflineat">@@ -1114,23 +1116,23 @@</span>
<a href="#l29.23"></a><span id="l29.23">           &lt;menuseparator id=&quot;viewAfterThreadsSeparator&quot;/&gt;</span>
<a href="#l29.24"></a><span id="l29.24">           &lt;menu id=&quot;viewheadersmenu&quot; label=&quot;&amp;headersMenu.label;&quot; accesskey=&quot;&amp;headersMenu.accesskey;&quot;&gt;</span>
<a href="#l29.25"></a><span id="l29.25">             &lt;menupopup id=&quot;menu_HeadersPopup&quot; onpopupshowing=&quot;InitViewHeadersMenu();&quot;&gt;</span>
<a href="#l29.26"></a><span id="l29.26">               &lt;menuitem id=&quot;viewallheaders&quot;</span>
<a href="#l29.27"></a><span id="l29.27">                type=&quot;radio&quot;</span>
<a href="#l29.28"></a><span id="l29.28">                name=&quot;viewheadergroup&quot;</span>
<a href="#l29.29"></a><span id="l29.29">                label=&quot;&amp;headersAllCmd.label;&quot;</span>
<a href="#l29.30"></a><span id="l29.30">                accesskey=&quot;&amp;headersAllCmd.accesskey;&quot;</span>
<a href="#l29.31"></a><span id="l29.31" class="difflineminus">-               oncommand=&quot;MsgViewAllHeaders();&quot;/&gt;</span>
<a href="#l29.32"></a><span id="l29.32" class="difflineplus">+               command=&quot;cmd_viewAllHeader&quot;/&gt;</span>
<a href="#l29.33"></a><span id="l29.33">               &lt;menuitem id=&quot;viewnormalheaders&quot;</span>
<a href="#l29.34"></a><span id="l29.34">                type=&quot;radio&quot;</span>
<a href="#l29.35"></a><span id="l29.35">                name=&quot;viewheadergroup&quot;</span>
<a href="#l29.36"></a><span id="l29.36">                label=&quot;&amp;headersNormalCmd.label;&quot;</span>
<a href="#l29.37"></a><span id="l29.37">                accesskey=&quot;&amp;headersNormalCmd.accesskey;&quot;</span>
<a href="#l29.38"></a><span id="l29.38" class="difflineminus">-               oncommand=&quot;MsgViewNormalHeaders();&quot;/&gt;</span>
<a href="#l29.39"></a><span id="l29.39" class="difflineplus">+               command=&quot;cmd_viewNormalHeader&quot;/&gt;</span>
<a href="#l29.40"></a><span id="l29.40">             &lt;/menupopup&gt;</span>
<a href="#l29.41"></a><span id="l29.41">           &lt;/menu&gt;</span>
<a href="#l29.42"></a><span id="l29.42">           &lt;menu id=&quot;viewBodyMenu&quot; accesskey=&quot;&amp;bodyMenu.accesskey;&quot; label=&quot;&amp;bodyMenu.label;&quot;&gt;</span>
<a href="#l29.43"></a><span id="l29.43">             &lt;menupopup id=&quot;viewBodyPopMenu&quot; onpopupshowing=&quot;InitViewBodyMenu()&quot;&gt;</span>
<a href="#l29.44"></a><span id="l29.44">               &lt;menuitem id=&quot;bodyAllowHTML&quot; type=&quot;radio&quot; name=&quot;bodyPlaintextVsHTMLPref&quot; label=&quot;&amp;bodyAllowHTML.label;&quot;</span>
<a href="#l29.45"></a><span id="l29.45">                         accesskey=&quot;&amp;bodyAllowHTML.accesskey;&quot; oncommand=&quot;MsgBodyAllowHTML()&quot;/&gt;</span>
<a href="#l29.46"></a><span id="l29.46">               &lt;menuitem id=&quot;bodySanitized&quot; type=&quot;radio&quot; name=&quot;bodyPlaintextVsHTMLPref&quot; label=&quot;&amp;bodySanitized.label;&quot;</span>
<a href="#l29.47"></a><span id="l29.47">                         accesskey=&quot;&amp;bodySanitized.accesskey;&quot;</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l30.1"></a><span id="l30.1" class="difflineminus">--- a/mail/base/content/messageDisplay.js</span>
<a href="#l30.2"></a><span id="l30.2" class="difflineplus">+++ b/mail/base/content/messageDisplay.js</span>
<a href="#l30.3"></a><span id="l30.3" class="difflineat">@@ -203,18 +203,18 @@ MessageDisplayWidget.prototype = {</span>
<a href="#l30.4"></a><span id="l30.4">     if (!this.active)</span>
<a href="#l30.5"></a><span id="l30.5">       return true;</span>
<a href="#l30.6"></a><span id="l30.6"> </span>
<a href="#l30.7"></a><span id="l30.7">     ClearPendingReadTimer();</span>
<a href="#l30.8"></a><span id="l30.8"> </span>
<a href="#l30.9"></a><span id="l30.9">     let selectedCount = this.folderDisplay.selectedCount;</span>
<a href="#l30.10"></a><span id="l30.10"> </span>
<a href="#l30.11"></a><span id="l30.11">     if (selectedCount == 0) {</span>
<a href="#l30.12"></a><span id="l30.12" class="difflineminus">-      // davida, put your folder summary stuff here.</span>
<a href="#l30.13"></a><span id="l30.13">       this.clearDisplay();</span>
<a href="#l30.14"></a><span id="l30.14" class="difflineplus">+      loadStartPage();</span>
<a href="#l30.15"></a><span id="l30.15">       this.singleMessageDisplay = true;</span>
<a href="#l30.16"></a><span id="l30.16">       return true;</span>
<a href="#l30.17"></a><span id="l30.17">     }</span>
<a href="#l30.18"></a><span id="l30.18">     else if (selectedCount == 1) {</span>
<a href="#l30.19"></a><span id="l30.19">       // the display of the message is happening without us</span>
<a href="#l30.20"></a><span id="l30.20">       this.singleMessageDisplay = true;</span>
<a href="#l30.21"></a><span id="l30.21"> </span>
<a href="#l30.22"></a><span id="l30.22">       // This is the only case we don't handle and want the nsMsgDBView to</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l31.1"></a><span id="l31.1" class="difflineminus">--- a/mail/base/content/messageWindow.js</span>
<a href="#l31.2"></a><span id="l31.2" class="difflineplus">+++ b/mail/base/content/messageWindow.js</span>
<a href="#l31.3"></a><span id="l31.3" class="difflineat">@@ -758,16 +758,18 @@ var MessageWindowController =</span>
<a href="#l31.4"></a><span id="l31.4">       case &quot;cmd_settingsOffline&quot;:</span>
<a href="#l31.5"></a><span id="l31.5">       case &quot;cmd_createFilterFromPopup&quot;:</span>
<a href="#l31.6"></a><span id="l31.6">       case &quot;cmd_createFilterFromMenu&quot;:</span>
<a href="#l31.7"></a><span id="l31.7">       case &quot;cmd_moveToFolderAgain&quot;:</span>
<a href="#l31.8"></a><span id="l31.8">       case &quot;cmd_fullZoomReduce&quot;:</span>
<a href="#l31.9"></a><span id="l31.9">       case &quot;cmd_fullZoomEnlarge&quot;:</span>
<a href="#l31.10"></a><span id="l31.10">       case &quot;cmd_fullZoomReset&quot;:</span>
<a href="#l31.11"></a><span id="l31.11">       case &quot;cmd_fullZoomToggle&quot;:</span>
<a href="#l31.12"></a><span id="l31.12" class="difflineplus">+      case &quot;cmd_viewAllHeader&quot;:</span>
<a href="#l31.13"></a><span id="l31.13" class="difflineplus">+      case &quot;cmd_viewNormalHeader&quot;:</span>
<a href="#l31.14"></a><span id="l31.14">         return true;</span>
<a href="#l31.15"></a><span id="l31.15">       case &quot;cmd_synchronizeOffline&quot;:</span>
<a href="#l31.16"></a><span id="l31.16">       case &quot;cmd_downloadFlagged&quot;:</span>
<a href="#l31.17"></a><span id="l31.17">       case &quot;cmd_downloadSelected&quot;:</span>
<a href="#l31.18"></a><span id="l31.18">         return MailOfflineMgr.isOnline();</span>
<a href="#l31.19"></a><span id="l31.19">       default:</span>
<a href="#l31.20"></a><span id="l31.20">         return false;</span>
<a href="#l31.21"></a><span id="l31.21">     }</span>
<a href="#l31.22"></a><span id="l31.22" class="difflineat">@@ -794,19 +796,20 @@ var MessageWindowController =</span>
<a href="#l31.23"></a><span id="l31.23">                gFolderDisplay.displayedFolder &amp;&amp;</span>
<a href="#l31.24"></a><span id="l31.24">                (gFolderDisplay.displayedFolder.canDeleteMessages ||</span>
<a href="#l31.25"></a><span id="l31.25">                 gFolderDisplay.view.isNewsFolder);</span>
<a href="#l31.26"></a><span id="l31.26">       case &quot;button_junk&quot;:</span>
<a href="#l31.27"></a><span id="l31.27">         UpdateJunkToolbarButton();</span>
<a href="#l31.28"></a><span id="l31.28">         // fall through</span>
<a href="#l31.29"></a><span id="l31.29">       case &quot;cmd_markAsJunk&quot;:</span>
<a href="#l31.30"></a><span id="l31.30">       case &quot;cmd_markAsNotJunk&quot;:</span>
<a href="#l31.31"></a><span id="l31.31" class="difflineplus">+        return gFolderDisplay.getCommandStatus(nsMsgViewCommandType.junk);</span>
<a href="#l31.32"></a><span id="l31.32">       case &quot;cmd_recalculateJunkScore&quot;:</span>
<a href="#l31.33"></a><span id="l31.33" class="difflineminus">-        // can't do junk on news yet</span>
<a href="#l31.34"></a><span id="l31.34" class="difflineminus">-        return (!gFolderDisplay.view.isNewsFolder);</span>
<a href="#l31.35"></a><span id="l31.35" class="difflineplus">+        return gFolderDisplay.selectedMessage &amp;&amp;</span>
<a href="#l31.36"></a><span id="l31.36" class="difflineplus">+               gFolderDisplay.getCommandStatus(nsMsgViewCommandType.runJunkControls);</span>
<a href="#l31.37"></a><span id="l31.37">       case &quot;button_archive&quot;:</span>
<a href="#l31.38"></a><span id="l31.38">         var folder = gFolderDisplay.displayedFolder;</span>
<a href="#l31.39"></a><span id="l31.39">         return folder &amp;&amp;</span>
<a href="#l31.40"></a><span id="l31.40">           !folder.isSpecialFolder(Components.interfaces.nsMsgFolderFlags.Archive,</span>
<a href="#l31.41"></a><span id="l31.41">                                   true);</span>
<a href="#l31.42"></a><span id="l31.42">       case &quot;cmd_reply&quot;:</span>
<a href="#l31.43"></a><span id="l31.43">       case &quot;button_reply&quot;:</span>
<a href="#l31.44"></a><span id="l31.44">       case &quot;cmd_replyall&quot;:</span>
<a href="#l31.45"></a><span id="l31.45" class="difflineat">@@ -832,16 +835,18 @@ var MessageWindowController =</span>
<a href="#l31.46"></a><span id="l31.46">       case &quot;cmd_reload&quot;:</span>
<a href="#l31.47"></a><span id="l31.47">       case &quot;cmd_find&quot;:</span>
<a href="#l31.48"></a><span id="l31.48">       case &quot;cmd_tag&quot;:</span>
<a href="#l31.49"></a><span id="l31.49">       case &quot;button_mark&quot;:</span>
<a href="#l31.50"></a><span id="l31.50">       case &quot;cmd_markAsRead&quot;:</span>
<a href="#l31.51"></a><span id="l31.51">       case &quot;cmd_markAllRead&quot;:</span>
<a href="#l31.52"></a><span id="l31.52">       case &quot;cmd_markThreadAsRead&quot;:</span>
<a href="#l31.53"></a><span id="l31.53">       case &quot;cmd_markReadByDate&quot;:</span>
<a href="#l31.54"></a><span id="l31.54" class="difflineplus">+      case &quot;cmd_viewAllHeader&quot;:</span>
<a href="#l31.55"></a><span id="l31.55" class="difflineplus">+      case &quot;cmd_viewNormalHeader&quot;:</span>
<a href="#l31.56"></a><span id="l31.56">         return(true);</span>
<a href="#l31.57"></a><span id="l31.57">       case &quot;cmd_markAsFlagged&quot;:</span>
<a href="#l31.58"></a><span id="l31.58">       case &quot;button_file&quot;:</span>
<a href="#l31.59"></a><span id="l31.59">       case &quot;cmd_file&quot;:</span>
<a href="#l31.60"></a><span id="l31.60">         return ( gFolderDisplay.selectedMessage != null);</span>
<a href="#l31.61"></a><span id="l31.61">       case &quot;cmd_printSetup&quot;:</span>
<a href="#l31.62"></a><span id="l31.62">         return true;</span>
<a href="#l31.63"></a><span id="l31.63">       case &quot;cmd_getNewMessages&quot;:</span>
<a href="#l31.64"></a><span id="l31.64" class="difflineat">@@ -1027,16 +1032,22 @@ var MessageWindowController =</span>
<a href="#l31.65"></a><span id="l31.65">         gFolderDisplay.doCommand(nsMsgViewCommandType.markThreadRead);</span>
<a href="#l31.66"></a><span id="l31.66">         return;</span>
<a href="#l31.67"></a><span id="l31.67">       case &quot;cmd_markAllRead&quot;:</span>
<a href="#l31.68"></a><span id="l31.68">         MsgMarkAllRead();</span>
<a href="#l31.69"></a><span id="l31.69">         return;</span>
<a href="#l31.70"></a><span id="l31.70">       case &quot;cmd_markReadByDate&quot;:</span>
<a href="#l31.71"></a><span id="l31.71">         MsgMarkReadByDate();</span>
<a href="#l31.72"></a><span id="l31.72">         return;</span>
<a href="#l31.73"></a><span id="l31.73" class="difflineplus">+      case &quot;cmd_viewAllHeader&quot;:</span>
<a href="#l31.74"></a><span id="l31.74" class="difflineplus">+        MsgViewAllHeaders();</span>
<a href="#l31.75"></a><span id="l31.75" class="difflineplus">+        return;</span>
<a href="#l31.76"></a><span id="l31.76" class="difflineplus">+      case &quot;cmd_viewNormalHeader&quot;:</span>
<a href="#l31.77"></a><span id="l31.77" class="difflineplus">+        MsgViewNormalHeaders();</span>
<a href="#l31.78"></a><span id="l31.78" class="difflineplus">+        return;</span>
<a href="#l31.79"></a><span id="l31.79">       case &quot;cmd_markAsFlagged&quot;:</span>
<a href="#l31.80"></a><span id="l31.80">         MsgMarkAsFlagged();</span>
<a href="#l31.81"></a><span id="l31.81">         return;</span>
<a href="#l31.82"></a><span id="l31.82">       case &quot;cmd_markAsJunk&quot;:</span>
<a href="#l31.83"></a><span id="l31.83">         JunkSelectedMessages(true);</span>
<a href="#l31.84"></a><span id="l31.84">         return;</span>
<a href="#l31.85"></a><span id="l31.85">       case &quot;cmd_markAsNotJunk&quot;:</span>
<a href="#l31.86"></a><span id="l31.86">         JunkSelectedMessages(false);</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l32.1"></a><span id="l32.1" class="difflineminus">--- a/mail/base/content/msgHdrViewOverlay.js</span>
<a href="#l32.2"></a><span id="l32.2" class="difflineplus">+++ b/mail/base/content/msgHdrViewOverlay.js</span>
<a href="#l32.3"></a><span id="l32.3" class="difflineat">@@ -178,16 +178,22 @@ function createHeaderEntry(prefix, heade</span>
<a href="#l32.4"></a><span id="l32.4"> </span>
<a href="#l32.5"></a><span id="l32.5">   if (this.textNode)</span>
<a href="#l32.6"></a><span id="l32.6">     this.textNode.useShortView = useShortView;</span>
<a href="#l32.7"></a><span id="l32.7"> </span>
<a href="#l32.8"></a><span id="l32.8">   if (&quot;outputFunction&quot; in headerListInfo)</span>
<a href="#l32.9"></a><span id="l32.9">     this.outputFunction = headerListInfo.outputFunction;</span>
<a href="#l32.10"></a><span id="l32.10">   else</span>
<a href="#l32.11"></a><span id="l32.11">     this.outputFunction = updateHeaderValue;</span>
<a href="#l32.12"></a><span id="l32.12" class="difflineplus">+</span>
<a href="#l32.13"></a><span id="l32.13" class="difflineplus">+  // stash this so that the &lt;mail-multi-emailheaderfield/&gt; binding can</span>
<a href="#l32.14"></a><span id="l32.14" class="difflineplus">+  // later attach it to any &lt;mail-emailaddress&gt; tags it creates for later</span>
<a href="#l32.15"></a><span id="l32.15" class="difflineplus">+  // extraction and use by AddExtraAddressProcessing.</span>
<a href="#l32.16"></a><span id="l32.16" class="difflineplus">+  this.enclosingBox.headerName = headerListInfo.name;</span>
<a href="#l32.17"></a><span id="l32.17" class="difflineplus">+</span>
<a href="#l32.18"></a><span id="l32.18"> }</span>
<a href="#l32.19"></a><span id="l32.19"> </span>
<a href="#l32.20"></a><span id="l32.20"> function initializeHeaderViewTables()</span>
<a href="#l32.21"></a><span id="l32.21"> {</span>
<a href="#l32.22"></a><span id="l32.22">   var prefBranch = Components.classes[&quot;@mozilla.org/preferences-service;1&quot;]</span>
<a href="#l32.23"></a><span id="l32.23">                              .getService(Components.interfaces.nsIPrefBranch2);</span>
<a href="#l32.24"></a><span id="l32.24">   // iterate over each header in our header list arrays and create header entries</span>
<a href="#l32.25"></a><span id="l32.25">   // for each one. These header entries are then stored in the appropriate header table</span>
<a href="#l32.26"></a><span id="l32.26" class="difflineat">@@ -1018,20 +1024,31 @@ function AddExtraAddressProcessing(email</span>
<a href="#l32.27"></a><span id="l32.27">     documentNode.setAttribute(&quot;hascard&quot;, &quot;true&quot;);</span>
<a href="#l32.28"></a><span id="l32.28">     documentNode.setAttribute(&quot;tooltipstar&quot;,</span>
<a href="#l32.29"></a><span id="l32.29">       document.getElementById(&quot;editContactItem&quot;).label);</span>
<a href="#l32.30"></a><span id="l32.30">   }</span>
<a href="#l32.31"></a><span id="l32.31"> </span>
<a href="#l32.32"></a><span id="l32.32">   if (!gShowCondensedEmailAddresses)</span>
<a href="#l32.33"></a><span id="l32.33">     return;</span>
<a href="#l32.34"></a><span id="l32.34"> </span>
<a href="#l32.35"></a><span id="l32.35" class="difflineplus">+  // If this address is one of the user's identities...</span>
<a href="#l32.36"></a><span id="l32.36">   var displayName;</span>
<a href="#l32.37"></a><span id="l32.37">   var identity = getBestIdentity(accountManager.allIdentities);</span>
<a href="#l32.38"></a><span id="l32.38">   if (emailAddress == identity.email) {</span>
<a href="#l32.39"></a><span id="l32.39" class="difflineminus">-    displayName = gMessengerBundle.getString(&quot;headerFieldYou&quot;);</span>
<a href="#l32.40"></a><span id="l32.40" class="difflineplus">+</span>
<a href="#l32.41"></a><span id="l32.41" class="difflineplus">+    // ...pick a localized version of the word &quot;You&quot; appropriate to this</span>
<a href="#l32.42"></a><span id="l32.42" class="difflineplus">+    // specific header; fall back to the version used by the &quot;to&quot; header</span>
<a href="#l32.43"></a><span id="l32.43" class="difflineplus">+    // if nothing else is available.</span>
<a href="#l32.44"></a><span id="l32.44" class="difflineplus">+    let headerName = documentNode.getAttribute(&quot;headerName&quot;);</span>
<a href="#l32.45"></a><span id="l32.45" class="difflineplus">+    try {</span>
<a href="#l32.46"></a><span id="l32.46" class="difflineplus">+      displayName = gMessengerBundle.getString(&quot;header&quot; + headerName +</span>
<a href="#l32.47"></a><span id="l32.47" class="difflineplus">+                                               &quot;FieldYou&quot;);</span>
<a href="#l32.48"></a><span id="l32.48" class="difflineplus">+    } catch (ex) {</span>
<a href="#l32.49"></a><span id="l32.49" class="difflineplus">+      displayName = gMessengerBundle.getString(&quot;headertoFieldYou&quot;);</span>
<a href="#l32.50"></a><span id="l32.50" class="difflineplus">+    }</span>
<a href="#l32.51"></a><span id="l32.51">   }</span>
<a href="#l32.52"></a><span id="l32.52">   else</span>
<a href="#l32.53"></a><span id="l32.53">   {</span>
<a href="#l32.54"></a><span id="l32.54">     if (!cardDetails.card)</span>
<a href="#l32.55"></a><span id="l32.55">       return;</span>
<a href="#l32.56"></a><span id="l32.56">     displayName = cardDetails.card.displayName;</span>
<a href="#l32.57"></a><span id="l32.57">   }</span>
<a href="#l32.58"></a><span id="l32.58"> </span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l33.1"></a><span id="l33.1" class="difflineminus">--- a/mail/base/content/tabmail.css</span>
<a href="#l33.2"></a><span id="l33.2" class="difflineplus">+++ b/mail/base/content/tabmail.css</span>
<a href="#l33.3"></a><span id="l33.3" class="difflineat">@@ -31,21 +31,21 @@</span>
<a href="#l33.4"></a><span id="l33.4">  * decision by deleting the provisions above and replace them with the notice</span>
<a href="#l33.5"></a><span id="l33.5">  * and other provisions required by the GPL or the LGPL. If you do not delete</span>
<a href="#l33.6"></a><span id="l33.6">  * the provisions above, a recipient may use your version of this file under</span>
<a href="#l33.7"></a><span id="l33.7">  * the terms of any one of the MPL, the GPL or the LGPL.</span>
<a href="#l33.8"></a><span id="l33.8">  *</span>
<a href="#l33.9"></a><span id="l33.9">  * ***** END LICENSE BLOCK ***** */</span>
<a href="#l33.10"></a><span id="l33.10"> </span>
<a href="#l33.11"></a><span id="l33.11"> .tabmail-tabs {</span>
<a href="#l33.12"></a><span id="l33.12" class="difflineminus">-  -moz-binding: url(&quot;chrome://messenger/skin/tabmailBindings.xml#tabmail-tabs&quot;);</span>
<a href="#l33.13"></a><span id="l33.13" class="difflineplus">+  -moz-binding: url(&quot;chrome://messenger/content/tabmail.xml#tabmail-tabs&quot;);</span>
<a href="#l33.14"></a><span id="l33.14"> }</span>
<a href="#l33.15"></a><span id="l33.15"> </span>
<a href="#l33.16"></a><span id="l33.16"> .tabmail-tab {</span>
<a href="#l33.17"></a><span id="l33.17" class="difflineminus">-  -moz-binding: url(&quot;chrome://messenger/skin/tabmailBindings.xml#tabmail-tab&quot;);</span>
<a href="#l33.18"></a><span id="l33.18" class="difflineplus">+  -moz-binding: url(&quot;chrome://messenger/content/tabmail.xml#tabmail-tab&quot;);</span>
<a href="#l33.19"></a><span id="l33.19"> }</span>
<a href="#l33.20"></a><span id="l33.20"> </span>
<a href="#l33.21"></a><span id="l33.21"> .tabmail-arrowscrollbox {</span>
<a href="#l33.22"></a><span id="l33.22">   -moz-binding: url(&quot;chrome://messenger/content/tabmail.xml#tabmail-arrowscrollbox&quot;);</span>
<a href="#l33.23"></a><span id="l33.23"> }</span>
<a href="#l33.24"></a><span id="l33.24"> </span>
<a href="#l33.25"></a><span id="l33.25"> .tabs-alltabs-popup {</span>
<a href="#l33.26"></a><span id="l33.26">   -moz-binding: url(&quot;chrome://messenger/content/tabmail.xml#tabmail-alltabs-popup&quot;);</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l34.1"></a><span id="l34.1" class="difflineminus">--- a/mail/base/content/tabmail.xml</span>
<a href="#l34.2"></a><span id="l34.2" class="difflineplus">+++ b/mail/base/content/tabmail.xml</span>
<a href="#l34.3"></a><span id="l34.3" class="difflineat">@@ -17,16 +17,17 @@</span>
<a href="#l34.4"></a><span id="l34.4">   - The Initial Developer of the Original Code is</span>
<a href="#l34.5"></a><span id="l34.5">   -   David Bienvenu &lt;bienvenu@nventure.com&gt;.</span>
<a href="#l34.6"></a><span id="l34.6">   - Portions created by the Initial Developer are Copyright (C) 2007</span>
<a href="#l34.7"></a><span id="l34.7">   - the Initial Developer. All Rights Reserved.</span>
<a href="#l34.8"></a><span id="l34.8">   -</span>
<a href="#l34.9"></a><span id="l34.9">   - Contributor(s):</span>
<a href="#l34.10"></a><span id="l34.10">   -  Scott MacGregor &lt;mscott@mozilla.org&gt;</span>
<a href="#l34.11"></a><span id="l34.11">   -  Andrew Sutherland &lt;asutherland@asutherland.org&gt;</span>
<a href="#l34.12"></a><span id="l34.12" class="difflineplus">+  -  Magnus Melin &lt;mkmelin+mozilla@iki.fi&gt;</span>
<a href="#l34.13"></a><span id="l34.13">   -</span>
<a href="#l34.14"></a><span id="l34.14">   - Alternatively, the contents of this file may be used under the terms of</span>
<a href="#l34.15"></a><span id="l34.15">   - either the GNU General Public License Version 2 or later (the &quot;GPL&quot;), or</span>
<a href="#l34.16"></a><span id="l34.16">   - the GNU Lesser General Public License Version 2.1 or later (the &quot;LGPL&quot;),</span>
<a href="#l34.17"></a><span id="l34.17">   - in which case the provisions of the GPL or the LGPL are applicable instead</span>
<a href="#l34.18"></a><span id="l34.18">   - of those above. If you wish to allow use of your version of this file only</span>
<a href="#l34.19"></a><span id="l34.19">   - under the terms of either the GPL or the LGPL, and not to allow others to</span>
<a href="#l34.20"></a><span id="l34.20">   - use your version of this file under the terms of the MPL, indicate your</span>
<a href="#l34.21"></a><span id="l34.21" class="difflineat">@@ -1062,26 +1063,31 @@</span>
<a href="#l34.22"></a><span id="l34.22">                                   .getAttribute(&quot;titlemodifier&quot;);</span>
<a href="#l34.23"></a><span id="l34.23"> </span>
<a href="#l34.24"></a><span id="l34.24">             document.title = docTitle;</span>
<a href="#l34.25"></a><span id="l34.25">           ]]&gt;</span>
<a href="#l34.26"></a><span id="l34.26">         &lt;/body&gt;</span>
<a href="#l34.27"></a><span id="l34.27">       &lt;/method&gt;</span>
<a href="#l34.28"></a><span id="l34.28">     &lt;/implementation&gt;</span>
<a href="#l34.29"></a><span id="l34.29">   &lt;/binding&gt;</span>
<a href="#l34.30"></a><span id="l34.30" class="difflineminus">-  </span>
<a href="#l34.31"></a><span id="l34.31" class="difflineminus">- &lt;binding id=&quot;tabmail-tab&quot; display=&quot;xul:box&quot;</span>
<a href="#l34.32"></a><span id="l34.32" class="difflineplus">+</span>
<a href="#l34.33"></a><span id="l34.33" class="difflineplus">+  &lt;binding id=&quot;tabmail-tab&quot; display=&quot;xul:box&quot;</span>
<a href="#l34.34"></a><span id="l34.34">            extends=&quot;chrome://global/content/bindings/tabbox.xml#tab&quot;&gt;</span>
<a href="#l34.35"></a><span id="l34.35">     &lt;content chromedir=&quot;&amp;locale.dir;&quot;</span>
<a href="#l34.36"></a><span id="l34.36">              closetabtext=&quot;&amp;closeTab.label;&quot;&gt;</span>
<a href="#l34.37"></a><span id="l34.37" class="difflineminus">-      &lt;xul:hbox class=&quot;tab-middle box-inherit&quot; xbl:inherits=&quot;align,dir,pack,orient,selected&quot; flex=&quot;1&quot;&gt;</span>
<a href="#l34.38"></a><span id="l34.38" class="difflineminus">-        &lt;xul:image class=&quot;tab-icon&quot; xbl:inherits=&quot;validate,src=image&quot;/&gt;</span>
<a href="#l34.39"></a><span id="l34.39" class="difflineminus">-        &lt;xul:label class=&quot;tab-text&quot; xbl:inherits=&quot;value=label,accesskey,crop,disabled&quot; flex=&quot;1&quot;/&gt;</span>
<a href="#l34.40"></a><span id="l34.40" class="difflineplus">+      &lt;xul:hbox class=&quot;tab-image-left&quot; xbl:inherits=&quot;selected&quot;/&gt;</span>
<a href="#l34.41"></a><span id="l34.41" class="difflineplus">+      &lt;xul:hbox class=&quot;tab-image-middle box-inherit&quot; align=&quot;center&quot;</span>
<a href="#l34.42"></a><span id="l34.42" class="difflineplus">+                xbl:inherits=&quot;dir,pack,orient,selected&quot; flex=&quot;1&quot;&gt;</span>
<a href="#l34.43"></a><span id="l34.43" class="difflineplus">+        &lt;xul:image class=&quot;tab-icon-image&quot; xbl:inherits=&quot;validate,src=image&quot;/&gt;</span>
<a href="#l34.44"></a><span id="l34.44" class="difflineplus">+        &lt;xul:label class=&quot;tab-text&quot;</span>
<a href="#l34.45"></a><span id="l34.45" class="difflineplus">+                  xbl:inherits=&quot;value=label,accesskey,crop,disabled&quot;</span>
<a href="#l34.46"></a><span id="l34.46" class="difflineplus">+                  crop=&quot;right&quot; flex=&quot;1&quot;/&gt;</span>
<a href="#l34.47"></a><span id="l34.47">       &lt;/xul:hbox&gt;</span>
<a href="#l34.48"></a><span id="l34.48" class="difflineminus">-      &lt;xul:toolbarbutton anonid=&quot;close-button&quot; tabindex=&quot;-1&quot; class=&quot;tab-close-button&quot;/&gt;</span>
<a href="#l34.49"></a><span id="l34.49" class="difflineplus">+      &lt;xul:toolbarbutton anonid=&quot;close-button&quot; class=&quot;tab-close-button&quot; tabindex=&quot;-1&quot;/&gt;</span>
<a href="#l34.50"></a><span id="l34.50" class="difflineplus">+      &lt;xul:hbox class=&quot;tab-image-right&quot; xbl:inherits=&quot;selected&quot;/&gt;</span>
<a href="#l34.51"></a><span id="l34.51">     &lt;/content&gt;</span>
<a href="#l34.52"></a><span id="l34.52"> </span>
<a href="#l34.53"></a><span id="l34.53">     &lt;implementation&gt;</span>
<a href="#l34.54"></a><span id="l34.54">       &lt;field name=&quot;mOverCloseButton&quot;&gt;false&lt;/field&gt;</span>
<a href="#l34.55"></a><span id="l34.55">       &lt;field name=&quot;mCorrespondingMenuitem&quot;&gt;null&lt;/field&gt;</span>
<a href="#l34.56"></a><span id="l34.56">     &lt;/implementation&gt;</span>
<a href="#l34.57"></a><span id="l34.57"> </span>
<a href="#l34.58"></a><span id="l34.58">     &lt;handlers&gt;</span>
<a href="#l34.59"></a><span id="l34.59" class="difflineat">@@ -1185,37 +1191,59 @@</span>
<a href="#l34.60"></a><span id="l34.60">       ]]&gt;&lt;/handler&gt;</span>
<a href="#l34.61"></a><span id="l34.61"> </span>
<a href="#l34.62"></a><span id="l34.62">     &lt;/handlers&gt;</span>
<a href="#l34.63"></a><span id="l34.63">   &lt;/binding&gt;</span>
<a href="#l34.64"></a><span id="l34.64"> </span>
<a href="#l34.65"></a><span id="l34.65">   &lt;binding id=&quot;tabmail-tabs&quot;</span>
<a href="#l34.66"></a><span id="l34.66">            extends=&quot;chrome://global/content/bindings/tabbox.xml#tabs&quot;&gt;</span>
<a href="#l34.67"></a><span id="l34.67">     &lt;content&gt;</span>
<a href="#l34.68"></a><span id="l34.68" class="difflineminus">-      &lt;xul:arrowscrollbox anonid=&quot;arrowscrollbox&quot; class=&quot;tabmail-arrowscrollbox&quot; flex=&quot;1&quot;</span>
<a href="#l34.69"></a><span id="l34.69" class="difflineminus">-                          xbl:inherits=&quot;smoothscroll&quot; orient=&quot;horizontal&quot; style=&quot;min-width: 1px;&quot;&gt;</span>
<a href="#l34.70"></a><span id="l34.70" class="difflineminus">-        &lt;children includes=&quot;tab&quot;/&gt;</span>
<a href="#l34.71"></a><span id="l34.71" class="difflineminus">-      &lt;/xul:arrowscrollbox&gt;</span>
<a href="#l34.72"></a><span id="l34.72" class="difflineminus">-      &lt;children/&gt;</span>
<a href="#l34.73"></a><span id="l34.73" class="difflineminus">-      &lt;xul:stack align=&quot;center&quot; pack=&quot;end&quot; class=&quot;tabs-alltabs-stack&quot;&gt;</span>
<a href="#l34.74"></a><span id="l34.74" class="difflineminus">-        &lt;xul:hbox flex=&quot;1&quot; class=&quot;tabs-alltabs-box&quot; anonid=&quot;alltabs-box&quot;/&gt;</span>
<a href="#l34.75"></a><span id="l34.75" class="difflineminus">-        &lt;xul:hbox flex=&quot;1&quot; class=&quot;tabs-alltabs-box-animate&quot; </span>
<a href="#l34.76"></a><span id="l34.76" class="difflineminus">-                  anonid=&quot;alltabs-box-animate&quot;/&gt;</span>
<a href="#l34.77"></a><span id="l34.77" class="difflineminus">-        &lt;xul:toolbarbutton class=&quot;tabs-alltabs-button&quot; type=&quot;menu&quot;</span>
<a href="#l34.78"></a><span id="l34.78" class="difflineminus">-                           anonid=&quot;alltabs-button&quot;</span>
<a href="#l34.79"></a><span id="l34.79" class="difflineminus">-                           tooltipstring=&quot;&amp;listAllTabs.label;&quot;&gt;</span>
<a href="#l34.80"></a><span id="l34.80" class="difflineminus">-          &lt;xul:menupopup class=&quot;tabs-alltabs-popup&quot;</span>
<a href="#l34.81"></a><span id="l34.81" class="difflineminus">-                         anonid=&quot;alltabs-popup&quot; </span>
<a href="#l34.82"></a><span id="l34.82" class="difflineminus">-                         position=&quot;after_end&quot;/&gt;</span>
<a href="#l34.83"></a><span id="l34.83" class="difflineminus">-        &lt;/xul:toolbarbutton&gt;</span>
<a href="#l34.84"></a><span id="l34.84" class="difflineplus">+      &lt;xul:stack flex=&quot;1&quot; class=&quot;tabs-stack&quot;&gt;</span>
<a href="#l34.85"></a><span id="l34.85" class="difflineplus">+        &lt;xul:vbox&gt;</span>
<a href="#l34.86"></a><span id="l34.86" class="difflineplus">+          &lt;xul:spacer flex=&quot;1&quot;/&gt;</span>
<a href="#l34.87"></a><span id="l34.87" class="difflineplus">+          &lt;xul:hbox class=&quot;tabs-bottom&quot; align=&quot;center&quot;/&gt;</span>
<a href="#l34.88"></a><span id="l34.88" class="difflineplus">+        &lt;/xul:vbox&gt;</span>
<a href="#l34.89"></a><span id="l34.89" class="difflineplus">+        &lt;xul:vbox&gt;</span>
<a href="#l34.90"></a><span id="l34.90" class="difflineplus">+          &lt;xul:hbox&gt;</span>
<a href="#l34.91"></a><span id="l34.91" class="difflineplus">+            &lt;xul:stack&gt;</span>
<a href="#l34.92"></a><span id="l34.92" class="difflineplus">+              &lt;xul:spacer class=&quot;tabs-left&quot;/&gt;</span>
<a href="#l34.93"></a><span id="l34.93" class="difflineplus">+            &lt;/xul:stack&gt;</span>
<a href="#l34.94"></a><span id="l34.94" class="difflineplus">+            &lt;xul:arrowscrollbox class=&quot;tabmail-arrowscrollbox&quot;</span>
<a href="#l34.95"></a><span id="l34.95" class="difflineplus">+                                anonid=&quot;arrowscrollbox&quot;</span>
<a href="#l34.96"></a><span id="l34.96" class="difflineplus">+                                orient=&quot;horizontal&quot;</span>
<a href="#l34.97"></a><span id="l34.97" class="difflineplus">+                                flex=&quot;1&quot;</span>
<a href="#l34.98"></a><span id="l34.98" class="difflineplus">+                                style=&quot;min-width: 1px;&quot;</span>
<a href="#l34.99"></a><span id="l34.99" class="difflineplus">+                                chromedir=&quot;&amp;locale.dir;&quot;&gt;</span>
<a href="#l34.100"></a><span id="l34.100" class="difflineplus">+              &lt;children includes=&quot;tab&quot;/&gt;</span>
<a href="#l34.101"></a><span id="l34.101" class="difflineplus">+            &lt;/xul:arrowscrollbox&gt;</span>
<a href="#l34.102"></a><span id="l34.102" class="difflineplus">+            &lt;children/&gt;</span>
<a href="#l34.103"></a><span id="l34.103" class="difflineplus">+            &lt;xul:stack align=&quot;center&quot; pack=&quot;end&quot; chromedir=&quot;&amp;locale.dir;&quot;&gt;</span>
<a href="#l34.104"></a><span id="l34.104" class="difflineplus">+              &lt;xul:hbox class=&quot;tabs-alltabs-box&quot; anonid=&quot;alltabs-box&quot; flex=&quot;1&quot;/&gt;</span>
<a href="#l34.105"></a><span id="l34.105" class="difflineplus">+              &lt;xul:hbox class=&quot;tabs-alltabs-box-animate&quot;</span>
<a href="#l34.106"></a><span id="l34.106" class="difflineplus">+                        anonid=&quot;alltabs-box-animate&quot;</span>
<a href="#l34.107"></a><span id="l34.107" class="difflineplus">+                        flex=&quot;1&quot;/&gt;</span>
<a href="#l34.108"></a><span id="l34.108" class="difflineplus">+              &lt;xul:toolbarbutton class=&quot;tabs-alltabs-button&quot;</span>
<a href="#l34.109"></a><span id="l34.109" class="difflineplus">+                                 anonid=&quot;alltabs-button&quot;</span>
<a href="#l34.110"></a><span id="l34.110" class="difflineplus">+                                 type=&quot;menu&quot;</span>
<a href="#l34.111"></a><span id="l34.111" class="difflineplus">+                                 tooltipstring=&quot;&amp;listAllTabs.label;&quot;&gt;</span>
<a href="#l34.112"></a><span id="l34.112" class="difflineplus">+                &lt;xul:menupopup class=&quot;tabs-alltabs-popup&quot;</span>
<a href="#l34.113"></a><span id="l34.113" class="difflineplus">+                               anonid=&quot;alltabs-popup&quot; position=&quot;after_end&quot;/&gt;</span>
<a href="#l34.114"></a><span id="l34.114" class="difflineplus">+              &lt;/xul:toolbarbutton&gt;</span>
<a href="#l34.115"></a><span id="l34.115" class="difflineplus">+            &lt;/xul:stack&gt;</span>
<a href="#l34.116"></a><span id="l34.116" class="difflineplus">+            &lt;xul:hbox class=&quot;tabs-closebutton-box&quot;</span>
<a href="#l34.117"></a><span id="l34.117" class="difflineplus">+                      anonid=&quot;tabstrip-closebutton&quot;</span>
<a href="#l34.118"></a><span id="l34.118" class="difflineplus">+                      align=&quot;center&quot; pack=&quot;end&quot;&gt;</span>
<a href="#l34.119"></a><span id="l34.119" class="difflineplus">+              &lt;xul:toolbarbutton class=&quot;close-button tabs-closebutton&quot;/&gt;</span>
<a href="#l34.120"></a><span id="l34.120" class="difflineplus">+            &lt;/xul:hbox&gt;</span>
<a href="#l34.121"></a><span id="l34.121" class="difflineplus">+          &lt;/xul:hbox&gt;</span>
<a href="#l34.122"></a><span id="l34.122" class="difflineplus">+          &lt;xul:spacer class=&quot;tabs-bottom-spacer&quot;/&gt;</span>
<a href="#l34.123"></a><span id="l34.123" class="difflineplus">+        &lt;/xul:vbox&gt;</span>
<a href="#l34.124"></a><span id="l34.124">       &lt;/xul:stack&gt;</span>
<a href="#l34.125"></a><span id="l34.125" class="difflineminus">-      &lt;xul:hbox class=&quot;tabs-closebutton-box&quot; align=&quot;center&quot; pack=&quot;end&quot; anonid=&quot;tabstrip-closebutton&quot;&gt;</span>
<a href="#l34.126"></a><span id="l34.126" class="difflineminus">-        &lt;xul:toolbarbutton class=&quot;close-button tabs-closebutton&quot;/&gt;</span>
<a href="#l34.127"></a><span id="l34.127" class="difflineminus">-      &lt;/xul:hbox&gt;</span>
<a href="#l34.128"></a><span id="l34.128">     &lt;/content&gt;</span>
<a href="#l34.129"></a><span id="l34.129" class="difflineplus">+</span>
<a href="#l34.130"></a><span id="l34.130">     &lt;implementation implements=&quot;nsITimerCallback, nsIDOMEventListener&quot;&gt;</span>
<a href="#l34.131"></a><span id="l34.131">       &lt;constructor&gt;</span>
<a href="#l34.132"></a><span id="l34.132">         &lt;![CDATA[</span>
<a href="#l34.133"></a><span id="l34.133">           var pb2 =</span>
<a href="#l34.134"></a><span id="l34.134">               Components.classes['@mozilla.org/preferences-service;1'].</span>
<a href="#l34.135"></a><span id="l34.135">               getService(Components.interfaces.nsIPrefBranch2);</span>
<a href="#l34.136"></a><span id="l34.136"> </span>
<a href="#l34.137"></a><span id="l34.137">           try {</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l35.1"></a><span id="l35.1" class="difflineminus">--- a/mail/components/addrbook/content/abCardOverlay.js</span>
<a href="#l35.2"></a><span id="l35.2" class="difflineplus">+++ b/mail/components/addrbook/content/abCardOverlay.js</span>
<a href="#l35.3"></a><span id="l35.3" class="difflineat">@@ -88,17 +88,17 @@ const kVcardFields =</span>
<a href="#l35.4"></a><span id="l35.4">           // Other &gt; Notes</span>
<a href="#l35.5"></a><span id="l35.5">          [&quot;Notes&quot;, &quot;Notes&quot;]];</span>
<a href="#l35.6"></a><span id="l35.6"> </span>
<a href="#l35.7"></a><span id="l35.7"> const kDefaultYear = 2000;</span>
<a href="#l35.8"></a><span id="l35.8"> var gEditCard;</span>
<a href="#l35.9"></a><span id="l35.9"> var gOnSaveListeners = new Array();</span>
<a href="#l35.10"></a><span id="l35.10"> var gOkCallback = null;</span>
<a href="#l35.11"></a><span id="l35.11"> var gHideABPicker = false;</span>
<a href="#l35.12"></a><span id="l35.12" class="difflineminus">-var originalPhotoURI = &quot;&quot;;</span>
<a href="#l35.13"></a><span id="l35.13" class="difflineplus">+var gOriginalPhotoURI = &quot;&quot;;</span>
<a href="#l35.14"></a><span id="l35.14"> </span>
<a href="#l35.15"></a><span id="l35.15"> function OnLoadNewCard()</span>
<a href="#l35.16"></a><span id="l35.16"> {</span>
<a href="#l35.17"></a><span id="l35.17">   InitEditCard();</span>
<a href="#l35.18"></a><span id="l35.18"> </span>
<a href="#l35.19"></a><span id="l35.19">   gEditCard.card =</span>
<a href="#l35.20"></a><span id="l35.20">     ((&quot;arguments&quot; in window) &amp;&amp; (window.arguments.length &gt; 0) &amp;&amp;</span>
<a href="#l35.21"></a><span id="l35.21">      (window.arguments[0] instanceof Components.interfaces.nsIAbCard))</span>
<a href="#l35.22"></a><span id="l35.22" class="difflineat">@@ -274,34 +274,33 @@ function OnLoadEditCard()</span>
<a href="#l35.23"></a><span id="l35.23">   if (&quot;arguments&quot; in window &amp;&amp; window.arguments[0])</span>
<a href="#l35.24"></a><span id="l35.24">   {</span>
<a href="#l35.25"></a><span id="l35.25">     if (&quot;abURI&quot; in window.arguments[0]) {</span>
<a href="#l35.26"></a><span id="l35.26">       var abURI = window.arguments[0].abURI;</span>
<a href="#l35.27"></a><span id="l35.27">       var directory = GetDirectoryFromURI(abURI);</span>
<a href="#l35.28"></a><span id="l35.28"> </span>
<a href="#l35.29"></a><span id="l35.29">       if (directory.readOnly) </span>
<a href="#l35.30"></a><span id="l35.30">       {</span>
<a href="#l35.31"></a><span id="l35.31" class="difflineminus">-        // Disable the photo field and buttons</span>
<a href="#l35.32"></a><span id="l35.32" class="difflineminus">-        document.getElementById(&quot;generic&quot;).disabled          = true;</span>
<a href="#l35.33"></a><span id="l35.33" class="difflineminus">-        document.getElementById(&quot;GenericPhotoList&quot;).disabled = true;</span>
<a href="#l35.34"></a><span id="l35.34" class="difflineminus">-        document.getElementById(&quot;file&quot;).disabled             = true;</span>
<a href="#l35.35"></a><span id="l35.35" class="difflineminus">-        document.getElementById(&quot;web&quot;).disabled              = true;</span>
<a href="#l35.36"></a><span id="l35.36" class="difflineminus">-        document.getElementById(&quot;PhotoURI&quot;).readOnly         = true;</span>
<a href="#l35.37"></a><span id="l35.37" class="difflineminus">-        document.getElementById(&quot;PhotoURI&quot;).emptyText        = &quot;&quot;;</span>
<a href="#l35.38"></a><span id="l35.38" class="difflineminus">-        document.getElementById(&quot;BrowsePhoto&quot;).disabled      = true;</span>
<a href="#l35.39"></a><span id="l35.39" class="difflineminus">-        document.getElementById(&quot;UpdatePhoto&quot;).disabled      = true;</span>
<a href="#l35.40"></a><span id="l35.40">         // Set all the editable vcard fields to read only</span>
<a href="#l35.41"></a><span id="l35.41">         for (var i = kVcardFields.length; i-- &gt; 0; )</span>
<a href="#l35.42"></a><span id="l35.42">           document.getElementById(kVcardFields[i][0]).readOnly = true;</span>
<a href="#l35.43"></a><span id="l35.43"> </span>
<a href="#l35.44"></a><span id="l35.44">         // the birthday fields</span>
<a href="#l35.45"></a><span id="l35.45">         document.getElementById(&quot;Birthday&quot;).readOnly = true;</span>
<a href="#l35.46"></a><span id="l35.46">         document.getElementById(&quot;BirthYear&quot;).readOnly = true;</span>
<a href="#l35.47"></a><span id="l35.47">         document.getElementById(&quot;Age&quot;).readOnly = true;</span>
<a href="#l35.48"></a><span id="l35.48"> </span>
<a href="#l35.49"></a><span id="l35.49" class="difflineplus">+        // the photo field and buttons</span>
<a href="#l35.50"></a><span id="l35.50" class="difflineplus">+        document.getElementById(&quot;PhotoType&quot;).disabled        = true;</span>
<a href="#l35.51"></a><span id="l35.51" class="difflineplus">+        document.getElementById(&quot;GenericPhotoList&quot;).disabled = true;</span>
<a href="#l35.52"></a><span id="l35.52" class="difflineplus">+        document.getElementById(&quot;PhotoURI&quot;).disabled         = true;</span>
<a href="#l35.53"></a><span id="l35.53" class="difflineplus">+        document.getElementById(&quot;PhotoURI&quot;).emptyText        = &quot;&quot;;</span>
<a href="#l35.54"></a><span id="l35.54" class="difflineplus">+        document.getElementById(&quot;BrowsePhoto&quot;).disabled      = true;</span>
<a href="#l35.55"></a><span id="l35.55" class="difflineplus">+        document.getElementById(&quot;UpdatePhoto&quot;).disabled      = true;</span>
<a href="#l35.56"></a><span id="l35.56" class="difflineplus">+</span>
<a href="#l35.57"></a><span id="l35.57">         // And the phonetic fields</span>
<a href="#l35.58"></a><span id="l35.58">         document.getElementById(kPhoneticFields[0]).readOnly = true;</span>
<a href="#l35.59"></a><span id="l35.59">         document.getElementById(kPhoneticFields[3]).readOnly = true;</span>
<a href="#l35.60"></a><span id="l35.60"> </span>
<a href="#l35.61"></a><span id="l35.61">         // Also disable the mail format popup and allow remote content items.</span>
<a href="#l35.62"></a><span id="l35.62">         document.getElementById(&quot;PreferMailFormatPopup&quot;).disabled = true;</span>
<a href="#l35.63"></a><span id="l35.63">         document.getElementById(&quot;allowRemoteContent&quot;).disabled = true;</span>
<a href="#l35.64"></a><span id="l35.64"> </span>
<a href="#l35.65"></a><span id="l35.65" class="difflineat">@@ -482,44 +481,42 @@ function GetCardValues(cardproperty, doc</span>
<a href="#l35.66"></a><span id="l35.66">     doc.getElementById(&quot;PhoneticFirstName&quot;).value = cardproperty.getProperty(&quot;PhoneticFirstName&quot;, &quot;&quot;);</span>
<a href="#l35.67"></a><span id="l35.67">     doc.getElementById(&quot;PhoneticLastName&quot;).value = cardproperty.getProperty(&quot;PhoneticLastName&quot;, &quot;&quot;);</span>
<a href="#l35.68"></a><span id="l35.68">   }</span>
<a href="#l35.69"></a><span id="l35.69">   catch (ex) {}</span>
<a href="#l35.70"></a><span id="l35.70"> </span>
<a href="#l35.71"></a><span id="l35.71">   // Store the original photo URI and update the photo</span>
<a href="#l35.72"></a><span id="l35.72">   // Select the type if there is a valid value stored for that type, otherwise</span>
<a href="#l35.73"></a><span id="l35.73">   // select the generic photo</span>
<a href="#l35.74"></a><span id="l35.74" class="difflineminus">-  var type = cardproperty.getProperty(&quot;PhotoType&quot;, &quot;&quot;);</span>
<a href="#l35.75"></a><span id="l35.75" class="difflineminus">-  document.getElementById(&quot;PhotoType&quot;).selectedItem =</span>
<a href="#l35.76"></a><span id="l35.76" class="difflineminus">-    document.getElementById(type ? type : &quot;generic&quot;);</span>
<a href="#l35.77"></a><span id="l35.77" class="difflineminus">-  if (type == &quot;file&quot;) {</span>
<a href="#l35.78"></a><span id="l35.78" class="difflineminus">-    originalPhotoURI = getPhotoURI(cardproperty.getProperty(&quot;PhotoName&quot;, &quot;&quot;));</span>
<a href="#l35.79"></a><span id="l35.79" class="difflineminus">-    var file = Components.classes[&quot;@mozilla.org/network/io-service;1&quot;]</span>
<a href="#l35.80"></a><span id="l35.80" class="difflineminus">-                         .getService(Components.interfaces.nsIIOService)</span>
<a href="#l35.81"></a><span id="l35.81" class="difflineminus">-                         .newURI(originalPhotoURI, null, null)</span>
<a href="#l35.82"></a><span id="l35.82" class="difflineminus">-                         .QueryInterface(Components.interfaces.nsIFileURL)</span>
<a href="#l35.83"></a><span id="l35.83" class="difflineminus">-                         .file;</span>
<a href="#l35.84"></a><span id="l35.84" class="difflineminus">-    if (file) {</span>
<a href="#l35.85"></a><span id="l35.85" class="difflineminus">-      document.getElementById(&quot;PhotoFile&quot;).file = file;</span>
<a href="#l35.86"></a><span id="l35.86" class="difflineminus">-      updatePhoto(&quot;file&quot;);</span>
<a href="#l35.87"></a><span id="l35.87" class="difflineminus">-    }</span>
<a href="#l35.88"></a><span id="l35.88" class="difflineminus">-    else</span>
<a href="#l35.89"></a><span id="l35.89" class="difflineplus">+  gOriginalPhotoURI = cardproperty.getProperty(&quot;PhotoURI&quot;, &quot;&quot;);</span>
<a href="#l35.90"></a><span id="l35.90" class="difflineplus">+  switch (cardproperty.getProperty(&quot;PhotoType&quot;, &quot;&quot;)) {</span>
<a href="#l35.91"></a><span id="l35.91" class="difflineplus">+    case &quot;file&quot;:</span>
<a href="#l35.92"></a><span id="l35.92" class="difflineplus">+      try {</span>
<a href="#l35.93"></a><span id="l35.93" class="difflineplus">+        var file = Components.classes[&quot;@mozilla.org/network/io-service;1&quot;]</span>
<a href="#l35.94"></a><span id="l35.94" class="difflineplus">+                             .getService(Components.interfaces.nsIIOService)</span>
<a href="#l35.95"></a><span id="l35.95" class="difflineplus">+                             .newURI(gOriginalPhotoURI, null, null)</span>
<a href="#l35.96"></a><span id="l35.96" class="difflineplus">+                             .QueryInterface(Components.interfaces.nsIFileURL)</span>
<a href="#l35.97"></a><span id="l35.97" class="difflineplus">+                             .file;</span>
<a href="#l35.98"></a><span id="l35.98" class="difflineplus">+      } catch (e) {}</span>
<a href="#l35.99"></a><span id="l35.99" class="difflineplus">+      if (file) {</span>
<a href="#l35.100"></a><span id="l35.100" class="difflineplus">+        document.getElementById(&quot;PhotoFile&quot;).file = file;</span>
<a href="#l35.101"></a><span id="l35.101" class="difflineplus">+        updatePhoto(&quot;file&quot;);</span>
<a href="#l35.102"></a><span id="l35.102" class="difflineplus">+      }</span>
<a href="#l35.103"></a><span id="l35.103" class="difflineplus">+      else</span>
<a href="#l35.104"></a><span id="l35.104" class="difflineplus">+        updatePhoto(&quot;generic&quot;);</span>
<a href="#l35.105"></a><span id="l35.105" class="difflineplus">+      break;</span>
<a href="#l35.106"></a><span id="l35.106" class="difflineplus">+    case &quot;web&quot;:</span>
<a href="#l35.107"></a><span id="l35.107" class="difflineplus">+      document.getElementById(&quot;PhotoURI&quot;).value = gOriginalPhotoURI;</span>
<a href="#l35.108"></a><span id="l35.108" class="difflineplus">+      updatePhoto(&quot;web&quot;);</span>
<a href="#l35.109"></a><span id="l35.109" class="difflineplus">+      break;</span>
<a href="#l35.110"></a><span id="l35.110" class="difflineplus">+    default:</span>
<a href="#l35.111"></a><span id="l35.111" class="difflineplus">+      if (gOriginalPhotoURI)</span>
<a href="#l35.112"></a><span id="l35.112" class="difflineplus">+        document.getElementById(&quot;GenericPhotoList&quot;).value = gOriginalPhotoURI;</span>
<a href="#l35.113"></a><span id="l35.113">       updatePhoto(&quot;generic&quot;);</span>
<a href="#l35.114"></a><span id="l35.114">   }</span>
<a href="#l35.115"></a><span id="l35.115" class="difflineminus">-  else if (type == &quot;web&quot;) {</span>
<a href="#l35.116"></a><span id="l35.116" class="difflineminus">-    originalPhotoURI = getPhotoURI(cardproperty.getProperty(&quot;PhotoName&quot;, &quot;&quot;));</span>
<a href="#l35.117"></a><span id="l35.117" class="difflineminus">-    document.getElementById(&quot;PhotoURI&quot;).value = originalPhotoURI;</span>
<a href="#l35.118"></a><span id="l35.118" class="difflineminus">-    updatePhoto(&quot;web&quot;);</span>
<a href="#l35.119"></a><span id="l35.119" class="difflineminus">-  }</span>
<a href="#l35.120"></a><span id="l35.120" class="difflineminus">-  else {</span>
<a href="#l35.121"></a><span id="l35.121" class="difflineminus">-    originalPhotoURI = cardproperty.getProperty(&quot;PhotoURI&quot;, &quot;&quot;);</span>
<a href="#l35.122"></a><span id="l35.122" class="difflineminus">-    if (originalPhotoURI)</span>
<a href="#l35.123"></a><span id="l35.123" class="difflineminus">-      document.getElementById(&quot;GenericPhotoList&quot;).value = originalPhotoURI;</span>
<a href="#l35.124"></a><span id="l35.124" class="difflineminus">-    updatePhoto(&quot;generic&quot;);</span>
<a href="#l35.125"></a><span id="l35.125" class="difflineminus">-  }</span>
<a href="#l35.126"></a><span id="l35.126"> }</span>
<a href="#l35.127"></a><span id="l35.127"> </span>
<a href="#l35.128"></a><span id="l35.128"> // when the ab card dialog is being loaded to show a vCard,</span>
<a href="#l35.129"></a><span id="l35.129"> // hide the fields which aren't supported</span>
<a href="#l35.130"></a><span id="l35.130"> // by vCard so the user does not try to edit them.</span>
<a href="#l35.131"></a><span id="l35.131"> function HideNonVcardFields()</span>
<a href="#l35.132"></a><span id="l35.132"> {</span>
<a href="#l35.133"></a><span id="l35.133">   document.getElementById(&quot;homeTabButton&quot;).hidden = true;</span>
<a href="#l35.134"></a><span id="l35.134" class="difflineat">@@ -567,41 +564,46 @@ function CheckAndSetCardValues(cardprope</span>
<a href="#l35.135"></a><span id="l35.135"> </span>
<a href="#l35.136"></a><span id="l35.136">   // set phonetic fields if exist</span>
<a href="#l35.137"></a><span id="l35.137">   try {</span>
<a href="#l35.138"></a><span id="l35.138">     cardproperty.setProperty(&quot;PhoneticFirstName&quot;, doc.getElementById(&quot;PhoneticFirstName&quot;).value);</span>
<a href="#l35.139"></a><span id="l35.139">     cardproperty.setProperty(&quot;PhoneticLastName&quot;, doc.getElementById(&quot;PhoneticLastName&quot;).value);</span>
<a href="#l35.140"></a><span id="l35.140">   }</span>
<a href="#l35.141"></a><span id="l35.141">   catch (ex) {}</span>
<a href="#l35.142"></a><span id="l35.142"> </span>
<a href="#l35.143"></a><span id="l35.143" class="difflineminus">-  var type = document.getElementById(&quot;PhotoType&quot;).selectedItem.id;</span>
<a href="#l35.144"></a><span id="l35.144" class="difflineminus">-  var photoURI = originalPhotoURI;</span>
<a href="#l35.145"></a><span id="l35.145" class="difflineplus">+  var type = document.getElementById(&quot;PhotoType&quot;).value;</span>
<a href="#l35.146"></a><span id="l35.146" class="difflineplus">+  var photoURI = gOriginalPhotoURI;</span>
<a href="#l35.147"></a><span id="l35.147">   if (type == &quot;file&quot; &amp;&amp; document.getElementById(&quot;PhotoFile&quot;).file)</span>
<a href="#l35.148"></a><span id="l35.148" class="difflineminus">-    photoURI = &quot;file://&quot; + document.getElementById(&quot;PhotoFile&quot;).file.path;</span>
<a href="#l35.149"></a><span id="l35.149" class="difflineplus">+    photoURI = Components.classes[&quot;@mozilla.org/network/io-service;1&quot;]</span>
<a href="#l35.150"></a><span id="l35.150" class="difflineplus">+                         .getService(Components.interfaces.nsIIOService)</span>
<a href="#l35.151"></a><span id="l35.151" class="difflineplus">+                         .newFileURI(document.getElementById(&quot;PhotoFile&quot;).file)</span>
<a href="#l35.152"></a><span id="l35.152" class="difflineplus">+                         .spec;</span>
<a href="#l35.153"></a><span id="l35.153">   else if (type == &quot;web&quot; &amp;&amp; document.getElementById(&quot;PhotoURI&quot;).value)</span>
<a href="#l35.154"></a><span id="l35.154">     photoURI = document.getElementById(&quot;PhotoURI&quot;).value;</span>
<a href="#l35.155"></a><span id="l35.155">   else {</span>
<a href="#l35.156"></a><span id="l35.156">     type = &quot;generic&quot;;</span>
<a href="#l35.157"></a><span id="l35.157">     photoURI = document.getElementById(&quot;GenericPhotoList&quot;).value;</span>
<a href="#l35.158"></a><span id="l35.158">   }</span>
<a href="#l35.159"></a><span id="l35.159" class="difflineminus">-  if (photoURI != originalPhotoURI) {</span>
<a href="#l35.160"></a><span id="l35.160" class="difflineplus">+  cardproperty.setProperty(&quot;PhotoType&quot;, type);</span>
<a href="#l35.161"></a><span id="l35.161" class="difflineplus">+  if (photoURI != gOriginalPhotoURI) {</span>
<a href="#l35.162"></a><span id="l35.162">     // Store the original URI</span>
<a href="#l35.163"></a><span id="l35.163">     cardproperty.setProperty(&quot;PhotoURI&quot;, photoURI);</span>
<a href="#l35.164"></a><span id="l35.164" class="difflineminus">-    // Remove the original, if any</span>
<a href="#l35.165"></a><span id="l35.165" class="difflineminus">-    removePhoto(cardproperty.getProperty(&quot;PhotoName&quot;, null));</span>
<a href="#l35.166"></a><span id="l35.166">     // Save the photo if it isn't one of the generic photos</span>
<a href="#l35.167"></a><span id="l35.167" class="difflineminus">-    if (type != &quot;generic&quot;) {</span>
<a href="#l35.168"></a><span id="l35.168" class="difflineminus">-      cardproperty.setProperty(&quot;PhotoType&quot;, &quot;file&quot;);</span>
<a href="#l35.169"></a><span id="l35.169" class="difflineplus">+    if (type == &quot;generic&quot;) {</span>
<a href="#l35.170"></a><span id="l35.170" class="difflineplus">+      // Remove the original, if any</span>
<a href="#l35.171"></a><span id="l35.171" class="difflineplus">+      removePhoto(cardproperty.getProperty(&quot;PhotoName&quot;, null));</span>
<a href="#l35.172"></a><span id="l35.172" class="difflineplus">+    } else {</span>
<a href="#l35.173"></a><span id="l35.173">       // Save the new file and store its URI as PhotoName </span>
<a href="#l35.174"></a><span id="l35.174">       var file = savePhoto(photoURI);</span>
<a href="#l35.175"></a><span id="l35.175" class="difflineminus">-      if (file)</span>
<a href="#l35.176"></a><span id="l35.176" class="difflineplus">+      if (file) {</span>
<a href="#l35.177"></a><span id="l35.177" class="difflineplus">+        // Remove the original, if any</span>
<a href="#l35.178"></a><span id="l35.178" class="difflineplus">+        removePhoto(cardproperty.getProperty(&quot;PhotoName&quot;, null));</span>
<a href="#l35.179"></a><span id="l35.179">         cardproperty.setProperty(&quot;PhotoName&quot;, file.leafName);</span>
<a href="#l35.180"></a><span id="l35.180" class="difflineplus">+      }</span>
<a href="#l35.181"></a><span id="l35.181">     }</span>
<a href="#l35.182"></a><span id="l35.182" class="difflineminus">-    else</span>
<a href="#l35.183"></a><span id="l35.183" class="difflineminus">-      cardproperty.setProperty(&quot;PhotoType&quot;, &quot;generic&quot;);</span>
<a href="#l35.184"></a><span id="l35.184">   }</span>
<a href="#l35.185"></a><span id="l35.185">   return true;</span>
<a href="#l35.186"></a><span id="l35.186"> }</span>
<a href="#l35.187"></a><span id="l35.187"> </span>
<a href="#l35.188"></a><span id="l35.188"> function CleanUpWebPage(webPage)</span>
<a href="#l35.189"></a><span id="l35.189"> {</span>
<a href="#l35.190"></a><span id="l35.190">   // no :// yet so we should add something</span>
<a href="#l35.191"></a><span id="l35.191">   if ( webPage.length &amp;&amp; webPage.search(&quot;://&quot;) == -1 )</span>
<a href="#l35.192"></a><span id="l35.192" class="difflineat">@@ -900,35 +902,38 @@ function modifyDatepicker(aDatepicker) {</span>
<a href="#l35.193"></a><span id="l35.193">  * Updates the photo by setting the src attribute of the photo element.</span>
<a href="#l35.194"></a><span id="l35.194">  *</span>
<a href="#l35.195"></a><span id="l35.195">  * @param aType Optional. The type of photo (web, file, or generic).</span>
<a href="#l35.196"></a><span id="l35.196">  *              If supplied the corresponding radio button will be selected.</span>
<a href="#l35.197"></a><span id="l35.197">  *              If not supplied the type will be determined by the currently</span>
<a href="#l35.198"></a><span id="l35.198">  *              selected type.</span>
<a href="#l35.199"></a><span id="l35.199">  */</span>
<a href="#l35.200"></a><span id="l35.200"> function updatePhoto(aType) {</span>
<a href="#l35.201"></a><span id="l35.201" class="difflineminus">-  if (aType) {</span>
<a href="#l35.202"></a><span id="l35.202" class="difflineplus">+  if (aType)</span>
<a href="#l35.203"></a><span id="l35.203">     // Select the type's radio button</span>
<a href="#l35.204"></a><span id="l35.204" class="difflineminus">-    document.getElementById(&quot;PhotoType&quot;).selectedItem =</span>
<a href="#l35.205"></a><span id="l35.205" class="difflineminus">-      document.getElementById(aType);</span>
<a href="#l35.206"></a><span id="l35.206" class="difflineminus">-  }</span>
<a href="#l35.207"></a><span id="l35.207" class="difflineplus">+    document.getElementById(&quot;PhotoType&quot;).value = aType;</span>
<a href="#l35.208"></a><span id="l35.208">   else</span>
<a href="#l35.209"></a><span id="l35.209" class="difflineminus">-    aType = document.getElementById(&quot;PhotoType&quot;).selectedItem.id;</span>
<a href="#l35.210"></a><span id="l35.210" class="difflineplus">+    aType = document.getElementById(&quot;PhotoType&quot;).value;</span>
<a href="#l35.211"></a><span id="l35.211"> </span>
<a href="#l35.212"></a><span id="l35.212">   var value;</span>
<a href="#l35.213"></a><span id="l35.213" class="difflineminus">-  if (aType == &quot;file&quot;) {</span>
<a href="#l35.214"></a><span id="l35.214" class="difflineminus">-    var file = document.getElementById(&quot;PhotoFile&quot;).file;</span>
<a href="#l35.215"></a><span id="l35.215" class="difflineminus">-    value = file ? &quot;file://&quot; + file.path : &quot;&quot;;</span>
<a href="#l35.216"></a><span id="l35.216" class="difflineplus">+  switch (aType) {</span>
<a href="#l35.217"></a><span id="l35.217" class="difflineplus">+    case &quot;file&quot;:</span>
<a href="#l35.218"></a><span id="l35.218" class="difflineplus">+      var file = document.getElementById(&quot;PhotoFile&quot;).file;</span>
<a href="#l35.219"></a><span id="l35.219" class="difflineplus">+      value = file ? Components.classes[&quot;@mozilla.org/network/io-service;1&quot;]</span>
<a href="#l35.220"></a><span id="l35.220" class="difflineplus">+                               .getService(Components.interfaces.nsIIOService)</span>
<a href="#l35.221"></a><span id="l35.221" class="difflineplus">+                               .newFileURI(file)</span>
<a href="#l35.222"></a><span id="l35.222" class="difflineplus">+                               .spec : &quot;&quot;;</span>
<a href="#l35.223"></a><span id="l35.223" class="difflineplus">+      break;</span>
<a href="#l35.224"></a><span id="l35.224" class="difflineplus">+    case &quot;web&quot;:</span>
<a href="#l35.225"></a><span id="l35.225" class="difflineplus">+      value = document.getElementById(&quot;PhotoURI&quot;).value;</span>
<a href="#l35.226"></a><span id="l35.226" class="difflineplus">+      break;</span>
<a href="#l35.227"></a><span id="l35.227" class="difflineplus">+    default:</span>
<a href="#l35.228"></a><span id="l35.228" class="difflineplus">+      value = document.getElementById(&quot;GenericPhotoList&quot;).value;</span>
<a href="#l35.229"></a><span id="l35.229">   }</span>
<a href="#l35.230"></a><span id="l35.230" class="difflineminus">-  else if (aType == &quot;web&quot;)</span>
<a href="#l35.231"></a><span id="l35.231" class="difflineminus">-    value = document.getElementById(&quot;PhotoURI&quot;).value;</span>
<a href="#l35.232"></a><span id="l35.232" class="difflineminus">-  else</span>
<a href="#l35.233"></a><span id="l35.233" class="difflineminus">-    value = document.getElementById(&quot;GenericPhotoList&quot;).value;</span>
<a href="#l35.234"></a><span id="l35.234" class="difflineminus">-  document.getElementById(&quot;photo&quot;).setAttribute(&quot;src&quot;, value ? value</span>
<a href="#l35.235"></a><span id="l35.235" class="difflineminus">-                                                             : defaultPhotoURI);</span>
<a href="#l35.236"></a><span id="l35.236" class="difflineplus">+  document.getElementById(&quot;photo&quot;).setAttribute(&quot;src&quot;, value || defaultPhotoURI);</span>
<a href="#l35.237"></a><span id="l35.237"> }</span>
<a href="#l35.238"></a><span id="l35.238"> </span>
<a href="#l35.239"></a><span id="l35.239"> /**</span>
<a href="#l35.240"></a><span id="l35.240">  * Removes the photo file at the given path, if present.</span>
<a href="#l35.241"></a><span id="l35.241">  *</span>
<a href="#l35.242"></a><span id="l35.242">  * @param aName The name of the photo to remove from the Photos directory.</span>
<a href="#l35.243"></a><span id="l35.243">  *</span>
<a href="#l35.244"></a><span id="l35.244">  * @return true if the file was deleted.</span>
<a href="#l35.245"></a><span id="l35.245" class="difflineat">@@ -936,27 +941,20 @@ function updatePhoto(aType) {</span>
<a href="#l35.246"></a><span id="l35.246"> function removePhoto(aName) {</span>
<a href="#l35.247"></a><span id="l35.247">   if (!aName)</span>
<a href="#l35.248"></a><span id="l35.248">     return false;</span>
<a href="#l35.249"></a><span id="l35.249">   // Get the directory with all the photos</span>
<a href="#l35.250"></a><span id="l35.250">   var file = getPhotosDir();</span>
<a href="#l35.251"></a><span id="l35.251">   // Get the photo (throws an exception for invalid names)</span>
<a href="#l35.252"></a><span id="l35.252">   try {</span>
<a href="#l35.253"></a><span id="l35.253">     file.append(aName);</span>
<a href="#l35.254"></a><span id="l35.254" class="difflineminus">-  }</span>
<a href="#l35.255"></a><span id="l35.255" class="difflineminus">-  catch (e) {</span>
<a href="#l35.256"></a><span id="l35.256" class="difflineminus">-    return false;</span>
<a href="#l35.257"></a><span id="l35.257" class="difflineplus">+    file.remove(false);</span>
<a href="#l35.258"></a><span id="l35.258" class="difflineplus">+    return true;</span>
<a href="#l35.259"></a><span id="l35.259">   }</span>
<a href="#l35.260"></a><span id="l35.260" class="difflineminus">-  if (file.exists()) {</span>
<a href="#l35.261"></a><span id="l35.261" class="difflineminus">-    try {</span>
<a href="#l35.262"></a><span id="l35.262" class="difflineminus">-      file.remove(false);</span>
<a href="#l35.263"></a><span id="l35.263" class="difflineminus">-      return true;</span>
<a href="#l35.264"></a><span id="l35.264" class="difflineminus">-    }</span>
<a href="#l35.265"></a><span id="l35.265" class="difflineminus">-    catch (e) {}</span>
<a href="#l35.266"></a><span id="l35.266" class="difflineminus">-  }</span>
<a href="#l35.267"></a><span id="l35.267" class="difflineplus">+  catch (e) {}</span>
<a href="#l35.268"></a><span id="l35.268">   return false;</span>
<a href="#l35.269"></a><span id="l35.269"> }</span>
<a href="#l35.270"></a><span id="l35.270"> </span>
<a href="#l35.271"></a><span id="l35.271"> /**</span>
<a href="#l35.272"></a><span id="l35.272">  * Opens a file picker with image filters to look for a contact photo.</span>
<a href="#l35.273"></a><span id="l35.273">  * If the user selects a file and clicks OK then the PhotoURI textbox is set</span>
<a href="#l35.274"></a><span id="l35.274">  * with a file URI pointing to that file and updatePhoto is called.</span>
<a href="#l35.275"></a><span id="l35.275">  *</span>
<a href="#l35.276"></a><span id="l35.276" class="difflineat">@@ -964,18 +962,18 @@ function removePhoto(aName) {</span>
<a href="#l35.277"></a><span id="l35.277">  */</span>
<a href="#l35.278"></a><span id="l35.278"> function browsePhoto() {</span>
<a href="#l35.279"></a><span id="l35.279">   var nsIFilePicker = Components.interfaces.nsIFilePicker;</span>
<a href="#l35.280"></a><span id="l35.280">   var fp = Components.classes[&quot;@mozilla.org/filepicker;1&quot;]</span>
<a href="#l35.281"></a><span id="l35.281">                      .createInstance(nsIFilePicker);</span>
<a href="#l35.282"></a><span id="l35.282">   fp.init(window, gAddressBookBundle.getString(&quot;browsePhoto&quot;), nsIFilePicker.modeOpen);</span>
<a href="#l35.283"></a><span id="l35.283">   </span>
<a href="#l35.284"></a><span id="l35.284">   // Add All Files &amp; Image Files filters and select the latter</span>
<a href="#l35.285"></a><span id="l35.285" class="difflineminus">-  fp.appendFilters(nsIFilePicker.filterAll | nsIFilePicker.filterImages);</span>
<a href="#l35.286"></a><span id="l35.286" class="difflineminus">-  fp.filterIndex = 1;</span>
<a href="#l35.287"></a><span id="l35.287" class="difflineplus">+  fp.appendFilters(nsIFilePicker.filterImages);</span>
<a href="#l35.288"></a><span id="l35.288" class="difflineplus">+  fp.appendFilters(nsIFilePicker.filterAll);</span>
<a href="#l35.289"></a><span id="l35.289"> </span>
<a href="#l35.290"></a><span id="l35.290">   if (fp.show() == nsIFilePicker.returnOK) {</span>
<a href="#l35.291"></a><span id="l35.291">     document.getElementById(&quot;PhotoFile&quot;).file = fp.file;</span>
<a href="#l35.292"></a><span id="l35.292">     updatePhoto(&quot;file&quot;);</span>
<a href="#l35.293"></a><span id="l35.293">     return true;</span>
<a href="#l35.294"></a><span id="l35.294">   }</span>
<a href="#l35.295"></a><span id="l35.295">   return false;</span>
<a href="#l35.296"></a><span id="l35.296"> }</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l36.1"></a><span id="l36.1" class="difflineminus">--- a/mail/components/addrbook/content/abCommon.js</span>
<a href="#l36.2"></a><span id="l36.2" class="difflineplus">+++ b/mail/components/addrbook/content/abCommon.js</span>
<a href="#l36.3"></a><span id="l36.3" class="difflineat">@@ -1019,68 +1019,56 @@ function savePhoto(aUri) {</span>
<a href="#l36.4"></a><span id="l36.4"> </span>
<a href="#l36.5"></a><span id="l36.5">   // Create a channel from the URI and open it as an input stream</span>
<a href="#l36.6"></a><span id="l36.6">   var ios = Components.classes[&quot;@mozilla.org/network/io-service;1&quot;]</span>
<a href="#l36.7"></a><span id="l36.7">                       .getService(Components.interfaces.nsIIOService);</span>
<a href="#l36.8"></a><span id="l36.8">   var channel = ios.newChannelFromURI(ios.newURI(aUri, null, null));</span>
<a href="#l36.9"></a><span id="l36.9">   var istream = channel.open();</span>
<a href="#l36.10"></a><span id="l36.10"> </span>
<a href="#l36.11"></a><span id="l36.11">   // Get the photo file</span>
<a href="#l36.12"></a><span id="l36.12" class="difflineminus">-  file.append(makePhotoFilename(file.path, findPhotoExt(aUri, channel)));</span>
<a href="#l36.13"></a><span id="l36.13" class="difflineplus">+  file = makePhotoFile(file, findPhotoExt(channel));</span>
<a href="#l36.14"></a><span id="l36.14"> </span>
<a href="#l36.15"></a><span id="l36.15">   return saveStreamToFile(istream, file);</span>
<a href="#l36.16"></a><span id="l36.16"> }</span>
<a href="#l36.17"></a><span id="l36.17"> </span>
<a href="#l36.18"></a><span id="l36.18"> /**</span>
<a href="#l36.19"></a><span id="l36.19">  * Finds the file extension of the photo identified by the URI, if possible.</span>
<a href="#l36.20"></a><span id="l36.20">  * This function can be overridden (with a copy of the original) for URIs that</span>
<a href="#l36.21"></a><span id="l36.21">  * do not identify the extension or when the Content-Type response header is</span>
<a href="#l36.22"></a><span id="l36.22">  * either not set or isn't 'image/png', 'image/jpeg', or 'image/gif'.</span>
<a href="#l36.23"></a><span id="l36.23">  * The original function can be called if the URI does not match.</span>
<a href="#l36.24"></a><span id="l36.24">  *</span>
<a href="#l36.25"></a><span id="l36.25">  * @param aUri The URI of the photo.</span>
<a href="#l36.26"></a><span id="l36.26">  * @param aChannel The opened channel for the URI.</span>
<a href="#l36.27"></a><span id="l36.27">  *</span>
<a href="#l36.28"></a><span id="l36.28">  * @return The extension of the file, if any, including the period.</span>
<a href="#l36.29"></a><span id="l36.29">  */</span>
<a href="#l36.30"></a><span id="l36.30" class="difflineminus">-function findPhotoExt(aUri, aChannel) {</span>
<a href="#l36.31"></a><span id="l36.31" class="difflineminus">-  if (aChannel) {</span>
<a href="#l36.32"></a><span id="l36.32" class="difflineminus">-    try {</span>
<a href="#l36.33"></a><span id="l36.33" class="difflineminus">-      aChannel.QueryInterface(Components.interfaces.nsIHttpChannel);</span>
<a href="#l36.34"></a><span id="l36.34" class="difflineminus">-      var header = aChannel.getResponseHeader(&quot;Content-Type&quot;);</span>
<a href="#l36.35"></a><span id="l36.35" class="difflineminus">-      var type   = header ? header.split(&quot;;&quot;)[0] : &quot;&quot;;</span>
<a href="#l36.36"></a><span id="l36.36" class="difflineminus">-      switch (type.toLowerCase()) {</span>
<a href="#l36.37"></a><span id="l36.37" class="difflineminus">-        case &quot;image/png&quot;:</span>
<a href="#l36.38"></a><span id="l36.38" class="difflineminus">-          return &quot;.png&quot;;</span>
<a href="#l36.39"></a><span id="l36.39" class="difflineminus">-        case &quot;image/jpeg&quot;:</span>
<a href="#l36.40"></a><span id="l36.40" class="difflineminus">-          return &quot;.jpg&quot;;</span>
<a href="#l36.41"></a><span id="l36.41" class="difflineminus">-        case &quot;image/gif&quot;:</span>
<a href="#l36.42"></a><span id="l36.42" class="difflineminus">-          return &quot;.gif&quot;;</span>
<a href="#l36.43"></a><span id="l36.43" class="difflineminus">-      }</span>
<a href="#l36.44"></a><span id="l36.44" class="difflineminus">-    } catch (e) {}</span>
<a href="#l36.45"></a><span id="l36.45" class="difflineminus">-  }</span>
<a href="#l36.46"></a><span id="l36.46" class="difflineminus">-</span>
<a href="#l36.47"></a><span id="l36.47" class="difflineminus">-  var index = aUri ? aUri.lastIndexOf(&quot;.&quot;) : -1;</span>
<a href="#l36.48"></a><span id="l36.48" class="difflineminus">-  if (index == -1)</span>
<a href="#l36.49"></a><span id="l36.49" class="difflineminus">-    return &quot;&quot;;</span>
<a href="#l36.50"></a><span id="l36.50" class="difflineminus">-   return aUri.substring(index);</span>
<a href="#l36.51"></a><span id="l36.51" class="difflineplus">+function findPhotoExt(aChannel) {</span>
<a href="#l36.52"></a><span id="l36.52" class="difflineplus">+  var mimeSvc = Components.classes[&quot;@mozilla.org/mime;1&quot;]</span>
<a href="#l36.53"></a><span id="l36.53" class="difflineplus">+                          .getService(Components.interfaces.nsIMIMEService);</span>
<a href="#l36.54"></a><span id="l36.54" class="difflineplus">+  var ext = &quot;&quot;;</span>
<a href="#l36.55"></a><span id="l36.55" class="difflineplus">+  var uri = aChannel.URI;</span>
<a href="#l36.56"></a><span id="l36.56" class="difflineplus">+  if (uri instanceof Components.interfaces.nsIURL)</span>
<a href="#l36.57"></a><span id="l36.57" class="difflineplus">+    ext = uri.fileExtension;</span>
<a href="#l36.58"></a><span id="l36.58" class="difflineplus">+  try {</span>
<a href="#l36.59"></a><span id="l36.59" class="difflineplus">+    return mimeSvc.getPrimaryExtension(aChannel.contentType, ext);</span>
<a href="#l36.60"></a><span id="l36.60" class="difflineplus">+  } catch (e) {}</span>
<a href="#l36.61"></a><span id="l36.61" class="difflineplus">+  return ext;</span>
<a href="#l36.62"></a><span id="l36.62"> }</span>
<a href="#l36.63"></a><span id="l36.63"> </span>
<a href="#l36.64"></a><span id="l36.64"> /**</span>
<a href="#l36.65"></a><span id="l36.65">  * Generates a unique filename to be used for a local copy of a contact's photo.</span>
<a href="#l36.66"></a><span id="l36.66">  *</span>
<a href="#l36.67"></a><span id="l36.67">  * @param aPath      The path to the folder in which the photo will be saved.</span>
<a href="#l36.68"></a><span id="l36.68">  * @param aExtension The file extension of the photo.</span>
<a href="#l36.69"></a><span id="l36.69">  *</span>
<a href="#l36.70"></a><span id="l36.70">  * @return A unique filename in the given path.</span>
<a href="#l36.71"></a><span id="l36.71">  */</span>
<a href="#l36.72"></a><span id="l36.72" class="difflineminus">-function makePhotoFilename(aPath, aExtension) {</span>
<a href="#l36.73"></a><span id="l36.73" class="difflineplus">+function makePhotoFile(aDir, aExtension) {</span>
<a href="#l36.74"></a><span id="l36.74">   var filename, newFile;</span>
<a href="#l36.75"></a><span id="l36.75">   // Find a random filename for the photo that doesn't exist yet</span>
<a href="#l36.76"></a><span id="l36.76">   do {</span>
<a href="#l36.77"></a><span id="l36.77" class="difflineminus">-    filename = new String(Math.random()).replace(&quot;0.&quot;, &quot;&quot;) + aExtension;</span>
<a href="#l36.78"></a><span id="l36.78" class="difflineminus">-    newFile = Components.classes[&quot;@mozilla.org/file/local;1&quot;]</span>
<a href="#l36.79"></a><span id="l36.79" class="difflineminus">-                        .createInstance(Components.interfaces.nsILocalFile);</span>
<a href="#l36.80"></a><span id="l36.80" class="difflineminus">-    newFile.initWithPath(aPath);</span>
<a href="#l36.81"></a><span id="l36.81" class="difflineplus">+    filename = new String(Math.random()).replace(&quot;0.&quot;, &quot;&quot;) + &quot;.&quot; + aExtension;</span>
<a href="#l36.82"></a><span id="l36.82" class="difflineplus">+    newFile = aDir.clone();</span>
<a href="#l36.83"></a><span id="l36.83">     newFile.append(filename);</span>
<a href="#l36.84"></a><span id="l36.84">   } while (newFile.exists());</span>
<a href="#l36.85"></a><span id="l36.85" class="difflineminus">-  return filename;</span>
<a href="#l36.86"></a><span id="l36.86" class="difflineplus">+  return newFile;</span>
<a href="#l36.87"></a><span id="l36.87"> }</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l37.1"></a><span id="l37.1" class="difflineminus">--- a/mail/components/migration/src/nsDogbertProfileMigrator.cpp</span>
<a href="#l37.2"></a><span id="l37.2" class="difflineplus">+++ b/mail/components/migration/src/nsDogbertProfileMigrator.cpp</span>
<a href="#l37.3"></a><span id="l37.3" class="difflineat">@@ -1002,17 +1002,17 @@ nsDogbertProfileMigrator::ProcessPrefsCa</span>
<a href="#l37.4"></a><span id="l37.4">     if (!exists)  {</span>
<a href="#l37.5"></a><span id="l37.5">       rv = newMOVEMAILMailPath-&gt;Create(nsIFile::DIRECTORY_TYPE, 0700);</span>
<a href="#l37.6"></a><span id="l37.6">       if (NS_FAILED(rv)) return rv;</span>
<a href="#l37.7"></a><span id="l37.7">     }</span>
<a href="#l37.8"></a><span id="l37.8">     rv = NS_OK;</span>
<a href="#l37.9"></a><span id="l37.9">   }</span>
<a href="#l37.10"></a><span id="l37.10"> #endif /* HAVE_MOVEMAIL */</span>
<a href="#l37.11"></a><span id="l37.11">   else {</span>
<a href="#l37.12"></a><span id="l37.12" class="difflineminus">-    NS_ASSERTION(0,&quot;failure, didn't recognize your mail server type.\n&quot;);</span>
<a href="#l37.13"></a><span id="l37.13" class="difflineplus">+    NS_ERROR(&quot;failure, didn't recognize your mail server type.&quot;);</span>
<a href="#l37.14"></a><span id="l37.14">     return NS_ERROR_UNEXPECTED;</span>
<a href="#l37.15"></a><span id="l37.15">   }</span>
<a href="#l37.16"></a><span id="l37.16"> </span>
<a href="#l37.17"></a><span id="l37.17">   ////////////////////////////////////////////////////////////////////////////</span>
<a href="#l37.18"></a><span id="l37.18">   // Set all the appropriate NEWS prefs.</span>
<a href="#l37.19"></a><span id="l37.19">   ////////////////////////////////////////////////////////////////////////////</span>
<a href="#l37.20"></a><span id="l37.20"> </span>
<a href="#l37.21"></a><span id="l37.21">   rv = newNewsPath-&gt;Exists(&amp;exists);</span>
<a href="#l37.22"></a><span id="l37.22" class="difflineat">@@ -1129,17 +1129,17 @@ nsDogbertProfileMigrator::ProcessPrefsCa</span>
<a href="#l37.23"></a><span id="l37.23">     // we'll move and rename them</span>
<a href="#l37.24"></a><span id="l37.24">     rv = DoTheCopy(oldProfilePath, newProfilePath, POP_MAIL_FILTER_FILE_NAME_IN_4x);</span>
<a href="#l37.25"></a><span id="l37.25">     if (NS_FAILED(rv)) return rv;</span>
<a href="#l37.26"></a><span id="l37.26"> </span>
<a href="#l37.27"></a><span id="l37.27">     rv = DoTheCopy(oldMOVEMAILMailPath, newMOVEMAILMailPath, PR_TRUE);</span>
<a href="#l37.28"></a><span id="l37.28">   }</span>
<a href="#l37.29"></a><span id="l37.29"> #endif /* HAVE_MOVEMAIL */</span>
<a href="#l37.30"></a><span id="l37.30">   else {</span>
<a href="#l37.31"></a><span id="l37.31" class="difflineminus">-    NS_ASSERTION(0, &quot;unknown mail server type!&quot;);</span>
<a href="#l37.32"></a><span id="l37.32" class="difflineplus">+    NS_ERROR(&quot;unknown mail server type!&quot;);</span>
<a href="#l37.33"></a><span id="l37.33">     return NS_ERROR_FAILURE;</span>
<a href="#l37.34"></a><span id="l37.34">   }</span>
<a href="#l37.35"></a><span id="l37.35"> </span>
<a href="#l37.36"></a><span id="l37.36">   // Don't inherit the 4.x cache file location for mozilla!</span>
<a href="#l37.37"></a><span id="l37.37">   // The cache pref later gets set with a default in nsAppRunner::InitCachePrefs().</span>
<a href="#l37.38"></a><span id="l37.38">   mPrefs-&gt;ClearUserPref(PREF_BROWSER_CACHE_DIRECTORY);</span>
<a href="#l37.39"></a><span id="l37.39"> </span>
<a href="#l37.40"></a><span id="l37.40">   rv = DoSpecialUpdates(newProfilePath);</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l38.1"></a><span id="l38.1" class="difflineminus">--- a/mail/locales/en-US/chrome/messenger/SearchDialog.dtd</span>
<a href="#l38.2"></a><span id="l38.2" class="difflineplus">+++ b/mail/locales/en-US/chrome/messenger/SearchDialog.dtd</span>
<a href="#l38.3"></a><span id="l38.3" class="difflineat">@@ -1,13 +1,15 @@</span>
<a href="#l38.4"></a><span id="l38.4"> &lt;!-- for SearchDialog.xul --&gt;</span>
<a href="#l38.5"></a><span id="l38.5"> &lt;!ENTITY searchHeading.label         &quot;Search for messages in:&quot;&gt;</span>
<a href="#l38.6"></a><span id="l38.6"> &lt;!ENTITY searchHeading.accesskey     &quot;h&quot;&gt;</span>
<a href="#l38.7"></a><span id="l38.7"> &lt;!ENTITY searchSubfolders.label      &quot;Search subfolders&quot;&gt;</span>
<a href="#l38.8"></a><span id="l38.8"> &lt;!ENTITY searchSubfolders.accesskey  &quot;e&quot;&gt;</span>
<a href="#l38.9"></a><span id="l38.9" class="difflineplus">+&lt;!ENTITY searchOnline.label          &quot;Search online&quot;&gt;</span>
<a href="#l38.10"></a><span id="l38.10" class="difflineplus">+&lt;!ENTITY searchOnline.accesskey      &quot;l&quot;&gt;</span>
<a href="#l38.11"></a><span id="l38.11"> &lt;!ENTITY resetButton.label           &quot;Clear&quot;&gt;</span>
<a href="#l38.12"></a><span id="l38.12"> &lt;!ENTITY resetButton.accesskey       &quot;C&quot;&gt;</span>
<a href="#l38.13"></a><span id="l38.13"> &lt;!ENTITY openButton.label            &quot;Open&quot;&gt;</span>
<a href="#l38.14"></a><span id="l38.14"> &lt;!ENTITY openButton.accesskey        &quot;n&quot;&gt;</span>
<a href="#l38.15"></a><span id="l38.15"> &lt;!ENTITY deleteButton.label          &quot;Delete&quot;&gt;</span>
<a href="#l38.16"></a><span id="l38.16"> &lt;!ENTITY deleteButton.accesskey      &quot;D&quot;&gt;</span>
<a href="#l38.17"></a><span id="l38.17"> &lt;!ENTITY searchDialogTitle.label     &quot;Search Messages&quot;&gt;</span>
<a href="#l38.18"></a><span id="l38.18"> &lt;!ENTITY results.label               &quot;Results&quot;&gt;</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l39.1"></a><span id="l39.1" class="difflineminus">--- a/mail/locales/en-US/chrome/messenger/am-identity-edit.dtd</span>
<a href="#l39.2"></a><span id="l39.2" class="difflineplus">+++ b/mail/locales/en-US/chrome/messenger/am-identity-edit.dtd</span>
<a href="#l39.3"></a><span id="l39.3" class="difflineat">@@ -1,6 +1,7 @@</span>
<a href="#l39.4"></a><span id="l39.4" class="difflineplus">+&lt;!ENTITY identityDialog.style &quot;width: 67ch;&quot;&gt;</span>
<a href="#l39.5"></a><span id="l39.5"> &lt;!ENTITY identityTitle.label &quot;Identity Settings&quot;&gt;</span>
<a href="#l39.6"></a><span id="l39.6"> &lt;!ENTITY identityListDesc.label &quot;Configure the settings for this identity:&quot;&gt;</span>
<a href="#l39.7"></a><span id="l39.7"> </span>
<a href="#l39.8"></a><span id="l39.8"> &lt;!ENTITY settingsTab.label       &quot;Settings&quot;&gt;</span>
<a href="#l39.9"></a><span id="l39.9"> &lt;!ENTITY copiesFoldersTab.label &quot;Copies &amp;amp; Folders&quot;&gt;</span>
<a href="#l39.10"></a><span id="l39.10"> &lt;!ENTITY addressingTab.label    &quot;Composition &amp;amp; Addressing&quot;&gt;</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l40.1"></a><span id="l40.1" class="difflineminus">--- a/mail/locales/en-US/chrome/messenger/messenger.properties</span>
<a href="#l40.2"></a><span id="l40.2" class="difflineplus">+++ b/mail/locales/en-US/chrome/messenger/messenger.properties</span>
<a href="#l40.3"></a><span id="l40.3" class="difflineat">@@ -481,19 +481,37 @@ processingJunkMessages=Processing Junk M</span>
<a href="#l40.4"></a><span id="l40.4"> fileNotFoundTitle = File Not Found</span>
<a href="#l40.5"></a><span id="l40.5"> #LOCALIZATION NOTE(fileNotFoundMsg): %S is the filename</span>
<a href="#l40.6"></a><span id="l40.6"> fileNotFoundMsg = The file %S does not exist.</span>
<a href="#l40.7"></a><span id="l40.7"> </span>
<a href="#l40.8"></a><span id="l40.8"> fileEmptyTitle = File Empty</span>
<a href="#l40.9"></a><span id="l40.9"> #LOCALIZATION NOTE(fileEmptyMsg): %S is the filename</span>
<a href="#l40.10"></a><span id="l40.10"> fileEmptyMsg = The file %S is empty.</span>
<a href="#l40.11"></a><span id="l40.11"> </span>
<a href="#l40.12"></a><span id="l40.12" class="difflineminus">-# second person direct object pronoun; used in the collapsed header view if</span>
<a href="#l40.13"></a><span id="l40.13" class="difflineminus">-# the user is in the To or Cc field of a message</span>
<a href="#l40.14"></a><span id="l40.14" class="difflineminus">-headerFieldYou=You</span>
<a href="#l40.15"></a><span id="l40.15" class="difflineplus">+# LOCALIZATION NOTE (headertoFieldYou): second person prepositional object</span>
<a href="#l40.16"></a><span id="l40.16" class="difflineplus">+# pronoun used in the &quot;to&quot; header of the message header pane.  This is also</span>
<a href="#l40.17"></a><span id="l40.17" class="difflineplus">+# used for the fallback case if a header-specific localization is not</span>
<a href="#l40.18"></a><span id="l40.18" class="difflineplus">+# available.</span>
<a href="#l40.19"></a><span id="l40.19" class="difflineplus">+headertoFieldYou=You</span>
<a href="#l40.20"></a><span id="l40.20" class="difflineplus">+</span>
<a href="#l40.21"></a><span id="l40.21" class="difflineplus">+# LOCALIZATION NOTE (headerfromFieldYou): second person prepositional object</span>
<a href="#l40.22"></a><span id="l40.22" class="difflineplus">+# pronoun used in the &quot;from&quot; header of the message header pane.</span>
<a href="#l40.23"></a><span id="l40.23" class="difflineplus">+headerfromFieldYou=You</span>
<a href="#l40.24"></a><span id="l40.24" class="difflineplus">+</span>
<a href="#l40.25"></a><span id="l40.25" class="difflineplus">+# LOCALIZATION NOTE (headerreply-toFieldYou): second person prepositional</span>
<a href="#l40.26"></a><span id="l40.26" class="difflineplus">+# object pronoun used in the &quot;reply-to&quot; header of the message header pane.</span>
<a href="#l40.27"></a><span id="l40.27" class="difflineplus">+headerreply-toFieldYou=You</span>
<a href="#l40.28"></a><span id="l40.28" class="difflineplus">+</span>
<a href="#l40.29"></a><span id="l40.29" class="difflineplus">+# LOCALIZATION NOTE (headerccFieldYou): second person prepositional object</span>
<a href="#l40.30"></a><span id="l40.30" class="difflineplus">+# pronoun used in the &quot;cc&quot; header of the message header pane.</span>
<a href="#l40.31"></a><span id="l40.31" class="difflineplus">+headerccFieldYou=You</span>
<a href="#l40.32"></a><span id="l40.32" class="difflineplus">+</span>
<a href="#l40.33"></a><span id="l40.33" class="difflineplus">+# LOCALIZATION NOTE (headerbccFieldYou): second person prepositional object</span>
<a href="#l40.34"></a><span id="l40.34" class="difflineplus">+# pronoun used in the &quot;bcc&quot; header of the message header pane.</span>
<a href="#l40.35"></a><span id="l40.35" class="difflineplus">+headerbccFieldYou=You</span>
<a href="#l40.36"></a><span id="l40.36"> </span>
<a href="#l40.37"></a><span id="l40.37"> # Shown when content tabs are being loaded.</span>
<a href="#l40.38"></a><span id="l40.38"> loadingTab=Loading</span>
<a href="#l40.39"></a><span id="l40.39"> </span>
<a href="#l40.40"></a><span id="l40.40"> applyToCollapsedMsgsTitle=Confirm Delete of Messages in Collapsed Thread(s)</span>
<a href="#l40.41"></a><span id="l40.41"> applyToCollapsedMsgs=Warning - this will delete messages in collapsed thread(s)</span>
<a href="#l40.42"></a><span id="l40.42"> applyToCollapsedAlwaysAskCheckbox=Always ask me before deleting messages in collapsed threads</span>
<a href="#l40.43"></a><span id="l40.43"> applyNowButton=Apply</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l41.1"></a><span id="l41.1" class="difflineminus">--- a/mail/locales/en-US/chrome/messenger/preferences/preferences.dtd</span>
<a href="#l41.2"></a><span id="l41.2" class="difflineplus">+++ b/mail/locales/en-US/chrome/messenger/preferences/preferences.dtd</span>
<a href="#l41.3"></a><span id="l41.3" class="difflineat">@@ -1,11 +1,11 @@</span>
<a href="#l41.4"></a><span id="l41.4"> &lt;!ENTITY  prefWindow.titleWin     &quot;Options&quot;&gt;</span>
<a href="#l41.5"></a><span id="l41.5"> &lt;!ENTITY  prefWindow.titleGNOME   &quot;&amp;brandShortName; Preferences&quot;&gt;</span>
<a href="#l41.6"></a><span id="l41.6" class="difflineminus">-&lt;!ENTITY  prefWindow.styleWindows &quot;width: 44em; min-height: 38.5em;&quot;&gt;</span>
<a href="#l41.7"></a><span id="l41.7" class="difflineplus">+&lt;!ENTITY  prefWindow.styleWindows &quot;width: 48em; min-height: 38.5em;&quot;&gt;</span>
<a href="#l41.8"></a><span id="l41.8"> &lt;!ENTITY  prefWindow.styleMac     &quot;width: 47em;&quot;&gt;</span>
<a href="#l41.9"></a><span id="l41.9"> &lt;!ENTITY  prefWindow.styleGNOME   &quot;width: 47em; min-height: 38em;&quot;&gt;</span>
<a href="#l41.10"></a><span id="l41.10"> </span>
<a href="#l41.11"></a><span id="l41.11"> &lt;!ENTITY paneGeneral.title        &quot;General&quot;&gt;</span>
<a href="#l41.12"></a><span id="l41.12"> &lt;!ENTITY paneDisplay.title        &quot;Display&quot;&gt;</span>
<a href="#l41.13"></a><span id="l41.13"> &lt;!ENTITY paneComposition.title    &quot;Composition&quot;&gt;</span>
<a href="#l41.14"></a><span id="l41.14"> &lt;!ENTITY paneAttachments.title    &quot;Attachments&quot;&gt;</span>
<a href="#l41.15"></a><span id="l41.15"> &lt;!ENTITY paneSecurity.title       &quot;Security&quot;&gt;</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l42.1"></a><span id="l42.1">new file mode 100644</span>
<a href="#l42.2"></a><span id="l42.2" class="difflineminus">--- /dev/null</span>
<a href="#l42.3"></a><span id="l42.3" class="difflineplus">+++ b/mail/test/mozmill/cookies/html/cookietest1.html</span>
<a href="#l42.4"></a><span id="l42.4" class="difflineat">@@ -0,0 +1,13 @@</span>
<a href="#l42.5"></a><span id="l42.5" class="difflineplus">+&lt;html&gt;</span>
<a href="#l42.6"></a><span id="l42.6" class="difflineplus">+  &lt;head&gt;</span>
<a href="#l42.7"></a><span id="l42.7" class="difflineplus">+    &lt;title&gt;Cookie Test&lt;/title&gt; </span>
<a href="#l42.8"></a><span id="l42.8" class="difflineplus">+    &lt;script type=&quot;text/javascript&quot;&gt;</span>
<a href="#l42.9"></a><span id="l42.9" class="difflineplus">+      document.cookie = &quot;name=CookieTest&quot;;</span>
<a href="#l42.10"></a><span id="l42.10" class="difflineplus">+    &lt;/script&gt;</span>
<a href="#l42.11"></a><span id="l42.11" class="difflineplus">+  &lt;/head&gt;</span>
<a href="#l42.12"></a><span id="l42.12" class="difflineplus">+  &lt;body bgcolor=&quot;#FFFFFF&quot;&gt;</span>
<a href="#l42.13"></a><span id="l42.13" class="difflineplus">+    &lt;div align=&quot;center&quot;&gt;</span>
<a href="#l42.14"></a><span id="l42.14" class="difflineplus">+      &lt;h1&gt;Cookie Test&lt;/h1&gt;</span>
<a href="#l42.15"></a><span id="l42.15" class="difflineplus">+    &lt;/div&gt;</span>
<a href="#l42.16"></a><span id="l42.16" class="difflineplus">+  &lt;/body&gt;</span>
<a href="#l42.17"></a><span id="l42.17" class="difflineplus">+&lt;/html&gt;</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l43.1"></a><span id="l43.1">new file mode 100644</span>
<a href="#l43.2"></a><span id="l43.2" class="difflineminus">--- /dev/null</span>
<a href="#l43.3"></a><span id="l43.3" class="difflineplus">+++ b/mail/test/mozmill/cookies/html/cookietest2.html</span>
<a href="#l43.4"></a><span id="l43.4" class="difflineat">@@ -0,0 +1,13 @@</span>
<a href="#l43.5"></a><span id="l43.5" class="difflineplus">+&lt;html&gt;</span>
<a href="#l43.6"></a><span id="l43.6" class="difflineplus">+  &lt;head&gt;</span>
<a href="#l43.7"></a><span id="l43.7" class="difflineplus">+    &lt;title&gt;Cookie Test 2&lt;/title&gt; </span>
<a href="#l43.8"></a><span id="l43.8" class="difflineplus">+  &lt;/head&gt;</span>
<a href="#l43.9"></a><span id="l43.9" class="difflineplus">+  &lt;body bgcolor=&quot;#FFFFFF&quot;&gt;</span>
<a href="#l43.10"></a><span id="l43.10" class="difflineplus">+    &lt;script type=&quot;text/javascript&quot;&gt;</span>
<a href="#l43.11"></a><span id="l43.11" class="difflineplus">+      var theCookie = document.cookie;</span>
<a href="#l43.12"></a><span id="l43.12" class="difflineplus">+    &lt;/script&gt;</span>
<a href="#l43.13"></a><span id="l43.13" class="difflineplus">+    &lt;div align=&quot;center&quot;&gt;</span>
<a href="#l43.14"></a><span id="l43.14" class="difflineplus">+      &lt;h1&gt;Cookie Test Result&lt;/h1&gt;</span>
<a href="#l43.15"></a><span id="l43.15" class="difflineplus">+    &lt;/div&gt;</span>
<a href="#l43.16"></a><span id="l43.16" class="difflineplus">+  &lt;/body&gt;</span>
<a href="#l43.17"></a><span id="l43.17" class="difflineplus">+&lt;/html&gt;</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l44.1"></a><span id="l44.1">new file mode 100644</span>
<a href="#l44.2"></a><span id="l44.2" class="difflineminus">--- /dev/null</span>
<a href="#l44.3"></a><span id="l44.3" class="difflineplus">+++ b/mail/test/mozmill/cookies/test-cookies.js</span>
<a href="#l44.4"></a><span id="l44.4" class="difflineat">@@ -0,0 +1,114 @@</span>
<a href="#l44.5"></a><span id="l44.5" class="difflineplus">+/* ***** BEGIN LICENSE BLOCK *****</span>
<a href="#l44.6"></a><span id="l44.6" class="difflineplus">+ * Version: MPL 1.1/GPL 2.0/LGPL 2.1</span>
<a href="#l44.7"></a><span id="l44.7" class="difflineplus">+ *</span>
<a href="#l44.8"></a><span id="l44.8" class="difflineplus">+ * The contents of this file are subject to the Mozilla Public License Version</span>
<a href="#l44.9"></a><span id="l44.9" class="difflineplus">+ * 1.1 (the &quot;License&quot;); you may not use this file except in compliance with</span>
<a href="#l44.10"></a><span id="l44.10" class="difflineplus">+ * the License. You may obtain a copy of the License at</span>
<a href="#l44.11"></a><span id="l44.11" class="difflineplus">+ * http://www.mozilla.org/MPL/</span>
<a href="#l44.12"></a><span id="l44.12" class="difflineplus">+ *</span>
<a href="#l44.13"></a><span id="l44.13" class="difflineplus">+ * Software distributed under the License is distributed on an &quot;AS IS&quot; basis,</span>
<a href="#l44.14"></a><span id="l44.14" class="difflineplus">+ * WITHOUT WARRANTY OF ANY KIND, either express or implied. See the License</span>
<a href="#l44.15"></a><span id="l44.15" class="difflineplus">+ * for the specific language governing rights and limitations under the</span>
<a href="#l44.16"></a><span id="l44.16" class="difflineplus">+ * License.</span>
<a href="#l44.17"></a><span id="l44.17" class="difflineplus">+ *</span>
<a href="#l44.18"></a><span id="l44.18" class="difflineplus">+ * The Original Code is Thunderbird Mail Client.</span>
<a href="#l44.19"></a><span id="l44.19" class="difflineplus">+ *</span>
<a href="#l44.20"></a><span id="l44.20" class="difflineplus">+ * The Initial Developer of the Original Code is</span>
<a href="#l44.21"></a><span id="l44.21" class="difflineplus">+ * Mozilla Messaging, Inc.</span>
<a href="#l44.22"></a><span id="l44.22" class="difflineplus">+ * Portions created by the Initial Developer are Copyright (C) 2009</span>
<a href="#l44.23"></a><span id="l44.23" class="difflineplus">+ * the Initial Developer. All Rights Reserved.</span>
<a href="#l44.24"></a><span id="l44.24" class="difflineplus">+ *</span>
<a href="#l44.25"></a><span id="l44.25" class="difflineplus">+ * Contributor(s):</span>
<a href="#l44.26"></a><span id="l44.26" class="difflineplus">+ *   Mark Banner &lt;bugzilla@standard8.pus.com&gt;</span>
<a href="#l44.27"></a><span id="l44.27" class="difflineplus">+ *</span>
<a href="#l44.28"></a><span id="l44.28" class="difflineplus">+ * Alternatively, the contents of this file may be used under the terms of</span>
<a href="#l44.29"></a><span id="l44.29" class="difflineplus">+ * either the GNU General Public License Version 2 or later (the &quot;GPL&quot;), or</span>
<a href="#l44.30"></a><span id="l44.30" class="difflineplus">+ * the GNU Lesser General Public License Version 2.1 or later (the &quot;LGPL&quot;),</span>
<a href="#l44.31"></a><span id="l44.31" class="difflineplus">+ * in which case the provisions of the GPL or the LGPL are applicable instead</span>
<a href="#l44.32"></a><span id="l44.32" class="difflineplus">+ * of those above. If you wish to allow use of your version of this file only</span>
<a href="#l44.33"></a><span id="l44.33" class="difflineplus">+ * under the terms of either the GPL or the LGPL, and not to allow others to</span>
<a href="#l44.34"></a><span id="l44.34" class="difflineplus">+ * use your version of this file under the terms of the MPL, indicate your</span>
<a href="#l44.35"></a><span id="l44.35" class="difflineplus">+ * decision by deleting the provisions above and replace them with the notice</span>
<a href="#l44.36"></a><span id="l44.36" class="difflineplus">+ * and other provisions required by the GPL or the LGPL. If you do not delete</span>
<a href="#l44.37"></a><span id="l44.37" class="difflineplus">+ * the provisions above, a recipient may use your version of this file under</span>
<a href="#l44.38"></a><span id="l44.38" class="difflineplus">+ * the terms of any one of the MPL, the GPL or the LGPL.</span>
<a href="#l44.39"></a><span id="l44.39" class="difflineplus">+ *</span>
<a href="#l44.40"></a><span id="l44.40" class="difflineplus">+ * ***** END LICENSE BLOCK ***** */</span>
<a href="#l44.41"></a><span id="l44.41" class="difflineplus">+</span>
<a href="#l44.42"></a><span id="l44.42" class="difflineplus">+/**</span>
<a href="#l44.43"></a><span id="l44.43" class="difflineplus">+ * Test file to check that cookies are correctly enabled in Thunderbird.</span>
<a href="#l44.44"></a><span id="l44.44" class="difflineplus">+ *</span>
<a href="#l44.45"></a><span id="l44.45" class="difflineplus">+ * XXX: Still need to check remote content in messages.</span>
<a href="#l44.46"></a><span id="l44.46" class="difflineplus">+ * XXX: Swap cookie checks when bug 501925 lands.</span>
<a href="#l44.47"></a><span id="l44.47" class="difflineplus">+ */</span>
<a href="#l44.48"></a><span id="l44.48" class="difflineplus">+</span>
<a href="#l44.49"></a><span id="l44.49" class="difflineplus">+var MODULE_NAME = 'test-cookies';</span>
<a href="#l44.50"></a><span id="l44.50" class="difflineplus">+</span>
<a href="#l44.51"></a><span id="l44.51" class="difflineplus">+var RELATIVE_ROOT = &quot;../shared-modules&quot;;</span>
<a href="#l44.52"></a><span id="l44.52" class="difflineplus">+var MODULE_REQUIRES = ['window-helpers'];</span>
<a href="#l44.53"></a><span id="l44.53" class="difflineplus">+</span>
<a href="#l44.54"></a><span id="l44.54" class="difflineplus">+var controller = {};</span>
<a href="#l44.55"></a><span id="l44.55" class="difflineplus">+Components.utils.import('resource://mozmill/modules/controller.js', controller);</span>
<a href="#l44.56"></a><span id="l44.56" class="difflineplus">+var mozmill = {}; Components.utils.import('resource://mozmill/modules/mozmill.js', mozmill);</span>
<a href="#l44.57"></a><span id="l44.57" class="difflineplus">+var elementslib = {}; Components.utils.import('resource://mozmill/modules/elementslib.js', elementslib);</span>
<a href="#l44.58"></a><span id="l44.58" class="difflineplus">+</span>
<a href="#l44.59"></a><span id="l44.59" class="difflineplus">+// The main controller and an easy alias.</span>
<a href="#l44.60"></a><span id="l44.60" class="difflineplus">+var mainController = null;</span>
<a href="#l44.61"></a><span id="l44.61" class="difflineplus">+var mc;</span>
<a href="#l44.62"></a><span id="l44.62" class="difflineplus">+</span>
<a href="#l44.63"></a><span id="l44.63" class="difflineplus">+// The windowHelper module.</span>
<a href="#l44.64"></a><span id="l44.64" class="difflineplus">+var windowHelper;</span>
<a href="#l44.65"></a><span id="l44.65" class="difflineplus">+</span>
<a href="#l44.66"></a><span id="l44.66" class="difflineplus">+var newTab = null;</span>
<a href="#l44.67"></a><span id="l44.67" class="difflineplus">+</span>
<a href="#l44.68"></a><span id="l44.68" class="difflineplus">+// RELATIVE_ROOT messes with the collector, so we have to bring the path back</span>
<a href="#l44.69"></a><span id="l44.69" class="difflineplus">+// so we get the right path for the resources.</span>
<a href="#l44.70"></a><span id="l44.70" class="difflineplus">+var url = collector.addHttpResource('../cookies/html', 'cookies');</span>
<a href="#l44.71"></a><span id="l44.71" class="difflineplus">+</span>
<a href="#l44.72"></a><span id="l44.72" class="difflineplus">+function setupModule(module) {</span>
<a href="#l44.73"></a><span id="l44.73" class="difflineplus">+  windowHelper = collector.getModule('window-helpers');</span>
<a href="#l44.74"></a><span id="l44.74" class="difflineplus">+  mc = mainController = windowHelper.wait_for_existing_window(&quot;mail:3pane&quot;);</span>
<a href="#l44.75"></a><span id="l44.75" class="difflineplus">+  windowHelper.augment_controller(mc);</span>
<a href="#l44.76"></a><span id="l44.76" class="difflineplus">+}</span>
<a href="#l44.77"></a><span id="l44.77" class="difflineplus">+</span>
<a href="#l44.78"></a><span id="l44.78" class="difflineplus">+/**</span>
<a href="#l44.79"></a><span id="l44.79" class="difflineplus">+ * Test deleting junk messages with no messages marked as junk.</span>
<a href="#l44.80"></a><span id="l44.80" class="difflineplus">+ */</span>
<a href="#l44.81"></a><span id="l44.81" class="difflineplus">+function test_load_cookie_page() {</span>
<a href="#l44.82"></a><span id="l44.82" class="difflineplus">+  newTab = mc.tabmail.openTab(&quot;contentTab&quot;,</span>
<a href="#l44.83"></a><span id="l44.83" class="difflineplus">+                              {contentPage: url + &quot;cookietest1.html&quot;});</span>
<a href="#l44.84"></a><span id="l44.84" class="difflineplus">+</span>
<a href="#l44.85"></a><span id="l44.85" class="difflineplus">+  if (!newTab)</span>
<a href="#l44.86"></a><span id="l44.86" class="difflineplus">+    throw new Error(&quot;Expected new tab info to be returned from openTab&quot;);</span>
<a href="#l44.87"></a><span id="l44.87" class="difflineplus">+</span>
<a href="#l44.88"></a><span id="l44.88" class="difflineplus">+  // XXX When bug 508999 is fixed, remove the sleep and use the waitForEval</span>
<a href="#l44.89"></a><span id="l44.89" class="difflineplus">+  // instead.</span>
<a href="#l44.90"></a><span id="l44.90" class="difflineplus">+  // controller.waitForEval(&quot;subject.busy == false&quot;, 1000, 100, newTab);</span>
<a href="#l44.91"></a><span id="l44.91" class="difflineplus">+  controller.sleep(1000);</span>
<a href="#l44.92"></a><span id="l44.92" class="difflineplus">+}</span>
<a href="#l44.93"></a><span id="l44.93" class="difflineplus">+</span>
<a href="#l44.94"></a><span id="l44.94" class="difflineplus">+function test_load_cookie_result_page() {</span>
<a href="#l44.95"></a><span id="l44.95" class="difflineplus">+  newTab = mc.tabmail.openTab(&quot;contentTab&quot;,</span>
<a href="#l44.96"></a><span id="l44.96" class="difflineplus">+                              {contentPage: url + &quot;cookietest2.html&quot;});</span>
<a href="#l44.97"></a><span id="l44.97" class="difflineplus">+</span>
<a href="#l44.98"></a><span id="l44.98" class="difflineplus">+  if (!newTab)</span>
<a href="#l44.99"></a><span id="l44.99" class="difflineplus">+    throw new Error(&quot;Expected new tab info to be returned from openTab&quot;);</span>
<a href="#l44.100"></a><span id="l44.100" class="difflineplus">+</span>
<a href="#l44.101"></a><span id="l44.101" class="difflineplus">+  // XXX When bug 508999 is fixed, remove the sleep and use the waitForEval</span>
<a href="#l44.102"></a><span id="l44.102" class="difflineplus">+  // instead.</span>
<a href="#l44.103"></a><span id="l44.103" class="difflineplus">+  // controller.waitForEval(&quot;subject.busy == false&quot;, 1000, 100, newTab);</span>
<a href="#l44.104"></a><span id="l44.104" class="difflineplus">+  controller.sleep(1000);</span>
<a href="#l44.105"></a><span id="l44.105" class="difflineplus">+</span>
<a href="#l44.106"></a><span id="l44.106" class="difflineplus">+  if (mc.window.content.document.title != &quot;Cookie Test 2&quot;)</span>
<a href="#l44.107"></a><span id="l44.107" class="difflineplus">+    throw new Error(&quot;The cookie test 2 page is not the selected tab or not content-primary&quot;);</span>
<a href="#l44.108"></a><span id="l44.108" class="difflineplus">+</span>
<a href="#l44.109"></a><span id="l44.109" class="difflineplus">+  let cookie = mc.window.content.wrappedJSObject.theCookie;</span>
<a href="#l44.110"></a><span id="l44.110" class="difflineplus">+</span>
<a href="#l44.111"></a><span id="l44.111" class="difflineplus">+  dump(&quot;Cookie is: &quot; + cookie + &quot;\n&quot;);</span>
<a href="#l44.112"></a><span id="l44.112" class="difflineplus">+</span>
<a href="#l44.113"></a><span id="l44.113" class="difflineplus">+  if (!cookie)</span>
<a href="#l44.114"></a><span id="l44.114" class="difflineplus">+    throw new Error(&quot;Document has no cookie :-(&quot;);</span>
<a href="#l44.115"></a><span id="l44.115" class="difflineplus">+</span>
<a href="#l44.116"></a><span id="l44.116" class="difflineplus">+  if (cookie != &quot;name=CookieTest&quot;)</span>
<a href="#l44.117"></a><span id="l44.117" class="difflineplus">+    throw new Error(&quot;Cookie set incorrectly, expected: name=CookieTest, got: &quot; +cookie + &quot;\n&quot;);</span>
<a href="#l44.118"></a><span id="l44.118" class="difflineplus">+}</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l45.1"></a><span id="l45.1">new file mode 100644</span>
<a href="#l45.2"></a><span id="l45.2" class="difflineminus">--- /dev/null</span>
<a href="#l45.3"></a><span id="l45.3" class="difflineplus">+++ b/mail/test/mozmill/folder-display/test-quick-search.js</span>
<a href="#l45.4"></a><span id="l45.4" class="difflineat">@@ -0,0 +1,126 @@</span>
<a href="#l45.5"></a><span id="l45.5" class="difflineplus">+/* ***** BEGIN LICENSE BLOCK *****</span>
<a href="#l45.6"></a><span id="l45.6" class="difflineplus">+ *   Version: MPL 1.1/GPL 2.0/LGPL 2.1</span>
<a href="#l45.7"></a><span id="l45.7" class="difflineplus">+ *</span>
<a href="#l45.8"></a><span id="l45.8" class="difflineplus">+ * The contents of this file are subject to the Mozilla Public License Version</span>
<a href="#l45.9"></a><span id="l45.9" class="difflineplus">+ * 1.1 (the &quot;License&quot;); you may not use this file except in compliance with</span>
<a href="#l45.10"></a><span id="l45.10" class="difflineplus">+ * the License. You may obtain a copy of the License at</span>
<a href="#l45.11"></a><span id="l45.11" class="difflineplus">+ * http://www.mozilla.org/MPL/</span>
<a href="#l45.12"></a><span id="l45.12" class="difflineplus">+ *</span>
<a href="#l45.13"></a><span id="l45.13" class="difflineplus">+ * Software distributed under the License is distributed on an &quot;AS IS&quot; basis,</span>
<a href="#l45.14"></a><span id="l45.14" class="difflineplus">+ * WITHOUT WARRANTY OF ANY KIND, either express or implied. See the License</span>
<a href="#l45.15"></a><span id="l45.15" class="difflineplus">+ * for the specific language governing rights and limitations under the</span>
<a href="#l45.16"></a><span id="l45.16" class="difflineplus">+ * License.</span>
<a href="#l45.17"></a><span id="l45.17" class="difflineplus">+ *</span>
<a href="#l45.18"></a><span id="l45.18" class="difflineplus">+ * The Original Code is Thunderbird Mail Client.</span>
<a href="#l45.19"></a><span id="l45.19" class="difflineplus">+ *</span>
<a href="#l45.20"></a><span id="l45.20" class="difflineplus">+ * The Initial Developer of the Original Code is</span>
<a href="#l45.21"></a><span id="l45.21" class="difflineplus">+ * Mozilla Messaging, Inc.</span>
<a href="#l45.22"></a><span id="l45.22" class="difflineplus">+ * Portions created by the Initial Developer are Copyright (C) 2009</span>
<a href="#l45.23"></a><span id="l45.23" class="difflineplus">+ * the Initial Developer. All Rights Reserved.</span>
<a href="#l45.24"></a><span id="l45.24" class="difflineplus">+ *</span>
<a href="#l45.25"></a><span id="l45.25" class="difflineplus">+ * Contributor(s):</span>
<a href="#l45.26"></a><span id="l45.26" class="difflineplus">+ *   Andrew Sutherland &lt;asutherland@asutherland.org&gt;</span>
<a href="#l45.27"></a><span id="l45.27" class="difflineplus">+ *</span>
<a href="#l45.28"></a><span id="l45.28" class="difflineplus">+ * Alternatively, the contents of this file may be used under the terms of</span>
<a href="#l45.29"></a><span id="l45.29" class="difflineplus">+ * either the GNU General Public License Version 2 or later (the &quot;GPL&quot;), or</span>
<a href="#l45.30"></a><span id="l45.30" class="difflineplus">+ * the GNU Lesser General Public License Version 2.1 or later (the &quot;LGPL&quot;),</span>
<a href="#l45.31"></a><span id="l45.31" class="difflineplus">+ * in which case the provisions of the GPL or the LGPL are applicable instead</span>
<a href="#l45.32"></a><span id="l45.32" class="difflineplus">+ * of those above. If you wish to allow use of your version of this file only</span>
<a href="#l45.33"></a><span id="l45.33" class="difflineplus">+ * under the terms of either the GPL or the LGPL, and not to allow others to</span>
<a href="#l45.34"></a><span id="l45.34" class="difflineplus">+ * use your version of this file under the terms of the MPL, indicate your</span>
<a href="#l45.35"></a><span id="l45.35" class="difflineplus">+ * decision by deleting the provisions above and replace them with the notice</span>
<a href="#l45.36"></a><span id="l45.36" class="difflineplus">+ * and other provisions required by the GPL or the LGPL. If you do not delete</span>
<a href="#l45.37"></a><span id="l45.37" class="difflineplus">+ * the provisions above, a recipient may use your version of this file under</span>
<a href="#l45.38"></a><span id="l45.38" class="difflineplus">+ * the terms of any one of the MPL, the GPL or the LGPL.</span>
<a href="#l45.39"></a><span id="l45.39" class="difflineplus">+ *</span>
<a href="#l45.40"></a><span id="l45.40" class="difflineplus">+ * ***** END LICENSE BLOCK ***** */</span>
<a href="#l45.41"></a><span id="l45.41" class="difflineplus">+</span>
<a href="#l45.42"></a><span id="l45.42" class="difflineplus">+var MODULE_NAME = 'test-quick-search';</span>
<a href="#l45.43"></a><span id="l45.43" class="difflineplus">+</span>
<a href="#l45.44"></a><span id="l45.44" class="difflineplus">+var RELATIVE_ROOT = '../shared-modules';</span>
<a href="#l45.45"></a><span id="l45.45" class="difflineplus">+var MODULE_REQUIRES = ['folder-display-helpers', 'window-helpers'];</span>
<a href="#l45.46"></a><span id="l45.46" class="difflineplus">+</span>
<a href="#l45.47"></a><span id="l45.47" class="difflineplus">+var folder;</span>
<a href="#l45.48"></a><span id="l45.48" class="difflineplus">+var setFoo, setBar;</span>
<a href="#l45.49"></a><span id="l45.49" class="difflineplus">+</span>
<a href="#l45.50"></a><span id="l45.50" class="difflineplus">+function setupModule(module) {</span>
<a href="#l45.51"></a><span id="l45.51" class="difflineplus">+  let fdh = collector.getModule('folder-display-helpers');</span>
<a href="#l45.52"></a><span id="l45.52" class="difflineplus">+  fdh.installInto(module);</span>
<a href="#l45.53"></a><span id="l45.53" class="difflineplus">+  let wh = collector.getModule('window-helpers');</span>
<a href="#l45.54"></a><span id="l45.54" class="difflineplus">+  wh.installInto(module);</span>
<a href="#l45.55"></a><span id="l45.55" class="difflineplus">+</span>
<a href="#l45.56"></a><span id="l45.56" class="difflineplus">+  folder = create_folder(&quot;QuickSearch&quot;);</span>
<a href="#l45.57"></a><span id="l45.57" class="difflineplus">+  [setFoo, setBar] =</span>
<a href="#l45.58"></a><span id="l45.58" class="difflineplus">+    make_new_sets_in_folder(folder, [{subject: &quot;foo&quot;, count: 1},</span>
<a href="#l45.59"></a><span id="l45.59" class="difflineplus">+                                     {subject: &quot;bar&quot;, count: 1}]);</span>
<a href="#l45.60"></a><span id="l45.60" class="difflineplus">+}</span>
<a href="#l45.61"></a><span id="l45.61" class="difflineplus">+</span>
<a href="#l45.62"></a><span id="l45.62" class="difflineplus">+/**</span>
<a href="#l45.63"></a><span id="l45.63" class="difflineplus">+ *</span>
<a href="#l45.64"></a><span id="l45.64" class="difflineplus">+ */</span>
<a href="#l45.65"></a><span id="l45.65" class="difflineplus">+function test_save_quick_search() {</span>
<a href="#l45.66"></a><span id="l45.66" class="difflineplus">+  be_in_folder(folder);</span>
<a href="#l45.67"></a><span id="l45.67" class="difflineplus">+</span>
<a href="#l45.68"></a><span id="l45.68" class="difflineplus">+  // - Type something in the quick search box.</span>
<a href="#l45.69"></a><span id="l45.69" class="difflineplus">+  mc.type(mc.eid(&quot;searchInput&quot;), &quot;foo&quot;);</span>
<a href="#l45.70"></a><span id="l45.70" class="difflineplus">+  mc.keypress(mc.eid(&quot;searchInput&quot;), &quot;VK_RETURN&quot;, {});</span>
<a href="#l45.71"></a><span id="l45.71" class="difflineplus">+  wait_for_all_messages_to_load();</span>
<a href="#l45.72"></a><span id="l45.72" class="difflineplus">+</span>
<a href="#l45.73"></a><span id="l45.73" class="difflineplus">+  // - Click the &quot;Save Search as a Folder&quot; button</span>
<a href="#l45.74"></a><span id="l45.74" class="difflineplus">+  // This will create a virtual folder properties dialog...</span>
<a href="#l45.75"></a><span id="l45.75" class="difflineplus">+  // (label: &quot;New Saved Search Folder&quot;, source: virtualFolderProperties.xul</span>
<a href="#l45.76"></a><span id="l45.76" class="difflineplus">+  //  no windowtype, id: &quot;virtualFolderPropertiesDialog&quot;)</span>
<a href="#l45.77"></a><span id="l45.77" class="difflineplus">+  plan_for_modal_dialog(&quot;mailnews:virtualFolderProperties&quot;,</span>
<a href="#l45.78"></a><span id="l45.78" class="difflineplus">+                        subtest_save_search);</span>
<a href="#l45.79"></a><span id="l45.79" class="difflineplus">+  mc.click(mc.eid(&quot;quickSearchSaveAsVirtualFolder&quot;));</span>
<a href="#l45.80"></a><span id="l45.80" class="difflineplus">+  wait_for_modal_dialog(&quot;mailnews:virtualFolderProperties&quot;);</span>
<a href="#l45.81"></a><span id="l45.81" class="difflineplus">+}</span>
<a href="#l45.82"></a><span id="l45.82" class="difflineplus">+</span>
<a href="#l45.83"></a><span id="l45.83" class="difflineplus">+/**</span>
<a href="#l45.84"></a><span id="l45.84" class="difflineplus">+ * Save the search, making sure that the &quot;subject OR from&quot; constraints are</span>
<a href="#l45.85"></a><span id="l45.85" class="difflineplus">+ *  there.</span>
<a href="#l45.86"></a><span id="l45.86" class="difflineplus">+ */</span>
<a href="#l45.87"></a><span id="l45.87" class="difflineplus">+function subtest_save_search(savc) {</span>
<a href="#l45.88"></a><span id="l45.88" class="difflineplus">+  // - make sure our constraint propagated</span>
<a href="#l45.89"></a><span id="l45.89" class="difflineplus">+  // this should be an &quot;OR&quot; constraint</span>
<a href="#l45.90"></a><span id="l45.90" class="difflineplus">+  savc.assertValue(savc.eid(&quot;booleanAndGroup&quot;), &quot;or&quot;);</span>
<a href="#l45.91"></a><span id="l45.91" class="difflineplus">+</span>
<a href="#l45.92"></a><span id="l45.92" class="difflineplus">+  // first constraint is on &quot;Subject&quot;=0 and should be &quot;foo&quot;</span>
<a href="#l45.93"></a><span id="l45.93" class="difflineplus">+  let searchAttr0 = savc.eid(&quot;searchAttr0&quot;);</span>
<a href="#l45.94"></a><span id="l45.94" class="difflineplus">+  savc.assertNode(searchAttr0);</span>
<a href="#l45.95"></a><span id="l45.95" class="difflineplus">+  savc.assertValue(searchAttr0, &quot;0&quot;);</span>
<a href="#l45.96"></a><span id="l45.96" class="difflineplus">+</span>
<a href="#l45.97"></a><span id="l45.97" class="difflineplus">+  let searchVal0 = savc.aid(&quot;searchVal0&quot;, {crazyDeck: 0});</span>
<a href="#l45.98"></a><span id="l45.98" class="difflineplus">+  savc.assertNode(searchVal0);</span>
<a href="#l45.99"></a><span id="l45.99" class="difflineplus">+  savc.assertValue(searchVal0, &quot;foo&quot;);</span>
<a href="#l45.100"></a><span id="l45.100" class="difflineplus">+</span>
<a href="#l45.101"></a><span id="l45.101" class="difflineplus">+  // second constraint is on &quot;From&quot;=1 and should be &quot;foo&quot; as well</span>
<a href="#l45.102"></a><span id="l45.102" class="difflineplus">+  let searchAttr1 = savc.eid(&quot;searchAttr1&quot;);</span>
<a href="#l45.103"></a><span id="l45.103" class="difflineplus">+  savc.assertNode(searchAttr1);</span>
<a href="#l45.104"></a><span id="l45.104" class="difflineplus">+  savc.assertValue(searchAttr1, &quot;1&quot;);</span>
<a href="#l45.105"></a><span id="l45.105" class="difflineplus">+</span>
<a href="#l45.106"></a><span id="l45.106" class="difflineplus">+  let searchVal1 = savc.aid(&quot;searchVal1&quot;, {crazyDeck: 0});</span>
<a href="#l45.107"></a><span id="l45.107" class="difflineplus">+  savc.assertNode(searchVal1);</span>
<a href="#l45.108"></a><span id="l45.108" class="difflineplus">+  savc.assertValue(searchVal1, &quot;foo&quot;);</span>
<a href="#l45.109"></a><span id="l45.109" class="difflineplus">+</span>
<a href="#l45.110"></a><span id="l45.110" class="difflineplus">+  // - Make sure the name mangling is as expected</span>
<a href="#l45.111"></a><span id="l45.111" class="difflineplus">+  savc.assertValue(savc.eid(&quot;name&quot;), &quot;QuickSearch-foo&quot;);</span>
<a href="#l45.112"></a><span id="l45.112" class="difflineplus">+</span>
<a href="#l45.113"></a><span id="l45.113" class="difflineplus">+  // - save it!</span>
<a href="#l45.114"></a><span id="l45.114" class="difflineplus">+  // this will close the dialog, which wait_for_modal_dialog is making sure</span>
<a href="#l45.115"></a><span id="l45.115" class="difflineplus">+  //  happens.</span>
<a href="#l45.116"></a><span id="l45.116" class="difflineplus">+  savc.window.onOK();</span>
<a href="#l45.117"></a><span id="l45.117" class="difflineplus">+}</span>
<a href="#l45.118"></a><span id="l45.118" class="difflineplus">+</span>
<a href="#l45.119"></a><span id="l45.119" class="difflineplus">+/**</span>
<a href="#l45.120"></a><span id="l45.120" class="difflineplus">+ * Make sure the folder showed up with the right name, and that displaying it</span>
<a href="#l45.121"></a><span id="l45.121" class="difflineplus">+ *  has the right contents.</span>
<a href="#l45.122"></a><span id="l45.122" class="difflineplus">+ */</span>
<a href="#l45.123"></a><span id="l45.123" class="difflineplus">+function test_verify_saved_search() {</span>
<a href="#l45.124"></a><span id="l45.124" class="difflineplus">+  let savedFolder = folder.findSubFolder(&quot;QuickSearch-foo&quot;);</span>
<a href="#l45.125"></a><span id="l45.125" class="difflineplus">+  if (savedFolder == null)</span>
<a href="#l45.126"></a><span id="l45.126" class="difflineplus">+    throw new Error(&quot;Saved folder did not show up.&quot;);</span>
<a href="#l45.127"></a><span id="l45.127" class="difflineplus">+</span>
<a href="#l45.128"></a><span id="l45.128" class="difflineplus">+  be_in_folder(savedFolder);</span>
<a href="#l45.129"></a><span id="l45.129" class="difflineplus">+  assert_messages_in_view(setFoo);</span>
<a href="#l45.130"></a><span id="l45.130" class="difflineplus">+}</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l46.1"></a><span id="l46.1" class="difflineminus">--- a/mail/test/mozmill/mozmilltests.list</span>
<a href="#l46.2"></a><span id="l46.2" class="difflineplus">+++ b/mail/test/mozmill/mozmilltests.list</span>
<a href="#l46.3"></a><span id="l46.3" class="difflineat">@@ -1,5 +1,6 @@</span>
<a href="#l46.4"></a><span id="l46.4"> folder-display</span>
<a href="#l46.5"></a><span id="l46.5"> junk-commands</span>
<a href="#l46.6"></a><span id="l46.6"> search-window</span>
<a href="#l46.7"></a><span id="l46.7" class="difflineplus">+cookies</span>
<a href="#l46.8"></a><span id="l46.8"> content-policy</span>
<a href="#l46.9"></a><span id="l46.9"> content-tabs</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l47.1"></a><span id="l47.1" class="difflineminus">--- a/mail/test/mozmill/runtest.py</span>
<a href="#l47.2"></a><span id="l47.2" class="difflineplus">+++ b/mail/test/mozmill/runtest.py</span>
<a href="#l47.3"></a><span id="l47.3" class="difflineat">@@ -125,17 +125,20 @@ class ThunderTestProfile(mozrunner.Thund</span>
<a href="#l47.4"></a><span id="l47.4">         'mail.server.server2.name' :  &quot;tinderbox@invalid.com&quot;,</span>
<a href="#l47.5"></a><span id="l47.5">         'mail.server.server2.type' :  &quot;pop3&quot;,</span>
<a href="#l47.6"></a><span id="l47.6">         'mail.server.server2.userName' :  &quot;tinderbox&quot;,</span>
<a href="#l47.7"></a><span id="l47.7">         'mail.smtp.defaultserver' :  &quot;smtp1&quot;,</span>
<a href="#l47.8"></a><span id="l47.8">         'mail.smtpserver.smtp1.hostname' :  &quot;tinderbox&quot;,</span>
<a href="#l47.9"></a><span id="l47.9">         'mail.smtpserver.smtp1.username' :  &quot;tinderbox&quot;,</span>
<a href="#l47.10"></a><span id="l47.10">         'mail.smtpservers' :  &quot;smtp1&quot;,</span>
<a href="#l47.11"></a><span id="l47.11">         'mail.startup.enabledMailCheckOnce' :  True,</span>
<a href="#l47.12"></a><span id="l47.12" class="difflineplus">+        # Don't load what's new or the remote start page - keep everything local</span>
<a href="#l47.13"></a><span id="l47.13" class="difflineplus">+        # under our control.</span>
<a href="#l47.14"></a><span id="l47.14">         'mailnews.start_page_override.mstone' :  &quot;ignore&quot;,</span>
<a href="#l47.15"></a><span id="l47.15" class="difflineplus">+        'mailnews.start_page.url': &quot;about:blank&quot;,</span>
<a href="#l47.16"></a><span id="l47.16">         }</span>
<a href="#l47.17"></a><span id="l47.17"> </span>
<a href="#l47.18"></a><span id="l47.18">     def __init__(self, default_profile=None, profile=None, create_new=True,</span>
<a href="#l47.19"></a><span id="l47.19">                  plugins=[], preferences={}):</span>
<a href="#l47.20"></a><span id="l47.20">         self.init_env()</span>
<a href="#l47.21"></a><span id="l47.21">         self.profile_dir = os.path.join(SCRIPT_DIRECTORY, 'mozmillprofile')</span>
<a href="#l47.22"></a><span id="l47.22"> </span>
<a href="#l47.23"></a><span id="l47.23">         mozrunner.Profile.__init__(self, default_profile, profile, create_new, plugins, preferences)</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l48.1"></a><span id="l48.1" class="difflineminus">--- a/mail/themes/gnomestripe/jar.mn</span>
<a href="#l48.2"></a><span id="l48.2" class="difflineplus">+++ b/mail/themes/gnomestripe/jar.mn</span>
<a href="#l48.3"></a><span id="l48.3" class="difflineat">@@ -25,17 +25,16 @@ classic.jar:</span>
<a href="#l48.4"></a><span id="l48.4">   skin/classic/messenger/msgSelectOffline.css                 (mail/msgSelectOffline.css)</span>
<a href="#l48.5"></a><span id="l48.5">   skin/classic/messenger/filterDialog.css                     (mail/filterDialog.css)</span>
<a href="#l48.6"></a><span id="l48.6">   skin/classic/messenger/multimessageview.css                 (mail/multimessageview.css)</span>
<a href="#l48.7"></a><span id="l48.7">   skin/classic/messenger/glodaFacetView.css                   (mail/glodaFacetView.css)</span>
<a href="#l48.8"></a><span id="l48.8">   skin/classic/messenger/icons/exclude.png                    (mail/icons/exclude.png)</span>
<a href="#l48.9"></a><span id="l48.9">   skin/classic/messenger/icons/exclude-selected.png           (mail/icons/exclude-selected.png)</span>
<a href="#l48.10"></a><span id="l48.10">   skin/classic/messenger/dialogs.css                          (mail/dialogs.css)</span>
<a href="#l48.11"></a><span id="l48.11">   skin/classic/messenger/newmailalert.css                     (mail/newmailalert.css)</span>
<a href="#l48.12"></a><span id="l48.12" class="difflineminus">-* skin/classic/messenger/tabmailBindings.xml                  (mail/tabmailBindings.xml)</span>
<a href="#l48.13"></a><span id="l48.13">   skin/classic/messenger/tabmail.css                          (mail/tabmail.css)</span>
<a href="#l48.14"></a><span id="l48.14">   skin/classic/messenger/editContactOverlay.css               (mail/editContactOverlay.css)</span>
<a href="#l48.15"></a><span id="l48.15">   skin/classic/messenger/starred48.png                        (mail/starred48.png)</span>
<a href="#l48.16"></a><span id="l48.16">   skin/classic/messenger/contactStarred.png                   (mail/contactStarred.png)</span>
<a href="#l48.17"></a><span id="l48.17">   skin/classic/messenger/starContact.png                      (mail/starContact.png)</span>
<a href="#l48.18"></a><span id="l48.18">   skin/classic/messenger/activity/activity.css                (mail/activity/activity.css)</span>
<a href="#l48.19"></a><span id="l48.19">   skin/classic/messenger/activity/buttons.png                 (mail/activity/buttons.png)</span>
<a href="#l48.20"></a><span id="l48.20">   skin/classic/messenger/activity/defaultProcessIcon.png      (mail/activity/defaultProcessIcon.png)</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l49.1"></a><span id="l49.1" class="difflineminus">--- a/mail/themes/gnomestripe/mail/dialogs.css</span>
<a href="#l49.2"></a><span id="l49.2" class="difflineplus">+++ b/mail/themes/gnomestripe/mail/dialogs.css</span>
<a href="#l49.3"></a><span id="l49.3" class="difflineat">@@ -62,32 +62,8 @@ menu.push[open=&quot;true&quot;] {</span>
<a href="#l49.4"></a><span id="l49.4">   -moz-padding-end: 1px;</span>
<a href="#l49.5"></a><span id="l49.5"> }</span>
<a href="#l49.6"></a><span id="l49.6"> </span>
<a href="#l49.7"></a><span id="l49.7"> menu.push[disabled=&quot;true&quot;],</span>
<a href="#l49.8"></a><span id="l49.8"> menu.push[disabled=&quot;true&quot;]:hover,</span>
<a href="#l49.9"></a><span id="l49.9"> menu.push[disabled=&quot;true&quot;]:hover:active {</span>
<a href="#l49.10"></a><span id="l49.10">   color: GrayText;</span>
<a href="#l49.11"></a><span id="l49.11"> }</span>
<a href="#l49.12"></a><span id="l49.12" class="difflineminus">-</span>
<a href="#l49.13"></a><span id="l49.13" class="difflineminus">-/* ::::: askSendFormat.xul ::::: */</span>
<a href="#l49.14"></a><span id="l49.14" class="difflineminus">-</span>
<a href="#l49.15"></a><span id="l49.15" class="difflineminus">-#askSendFormat {</span>
<a href="#l49.16"></a><span id="l49.16" class="difflineminus">-  width: 40em;</span>
<a href="#l49.17"></a><span id="l49.17" class="difflineminus">-}</span>
<a href="#l49.18"></a><span id="l49.18" class="difflineminus">-</span>
<a href="#l49.19"></a><span id="l49.19" class="difflineminus">-#askImageBox {</span>
<a href="#l49.20"></a><span id="l49.20" class="difflineminus">- -moz-box-align: start;</span>
<a href="#l49.21"></a><span id="l49.21" class="difflineminus">-}</span>
<a href="#l49.22"></a><span id="l49.22" class="difflineminus">-</span>
<a href="#l49.23"></a><span id="l49.23" class="difflineminus">-#convertYes,</span>
<a href="#l49.24"></a><span id="l49.24" class="difflineminus">-#convertAltering {</span>
<a href="#l49.25"></a><span id="l49.25" class="difflineminus">-  list-style-image:url(&quot;chrome://global/skin/icons/Question.png&quot;);</span>
<a href="#l49.26"></a><span id="l49.26" class="difflineminus">-}</span>
<a href="#l49.27"></a><span id="l49.27" class="difflineminus">-</span>
<a href="#l49.28"></a><span id="l49.28" class="difflineminus">-#convertNo {</span>
<a href="#l49.29"></a><span id="l49.29" class="difflineminus">-  list-style-image:url(&quot;chrome://global/skin/icons/Warning.png&quot;);</span>
<a href="#l49.30"></a><span id="l49.30" class="difflineminus">-}</span>
<a href="#l49.31"></a><span id="l49.31" class="difflineminus">-</span>
<a href="#l49.32"></a><span id="l49.32" class="difflineminus">-/* Workaround for bug 50217. Please remove this rule, when this bug is fixed. */</span>
<a href="#l49.33"></a><span id="l49.33" class="difflineminus">-#convertDefault {</span>
<a href="#l49.34"></a><span id="l49.34" class="difflineminus">-  list-style-image:url(&quot;chrome://global/skin/icons/Question.png&quot;);</span>
<a href="#l49.35"></a><span id="l49.35" class="difflineminus">-}</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l50.1"></a><span id="l50.1" class="difflineminus">--- a/mail/themes/gnomestripe/mail/folderPane.css</span>
<a href="#l50.2"></a><span id="l50.2" class="difflineplus">+++ b/mail/themes/gnomestripe/mail/folderPane.css</span>
<a href="#l50.3"></a><span id="l50.3" class="difflineat">@@ -1,11 +1,11 @@</span>
<a href="#l50.4"></a><span id="l50.4"> /* ::::: Folder Pane ::::: */</span>
<a href="#l50.5"></a><span id="l50.5"> </span>
<a href="#l50.6"></a><span id="l50.6" class="difflineminus">-.tabmail-tab[type=&quot;folder&quot;] &gt; .tab-image-middle &gt; .tab-icon &gt; .tab-icon-image,</span>
<a href="#l50.7"></a><span id="l50.7" class="difflineplus">+.tabmail-tab[type=&quot;folder&quot;] &gt; .tab-image-middle &gt; .tab-icon-image,</span>
<a href="#l50.8"></a><span id="l50.8"> treechildren::-moz-tree-image(folderNameCol) {</span>
<a href="#l50.9"></a><span id="l50.9">   background-position: center center;</span>
<a href="#l50.10"></a><span id="l50.10">   background-repeat: no-repeat;</span>
<a href="#l50.11"></a><span id="l50.11">   background-color: transparent;</span>
<a href="#l50.12"></a><span id="l50.12">   background-attachment: scroll;</span>
<a href="#l50.13"></a><span id="l50.13">   -moz-background-clip: border;</span>
<a href="#l50.14"></a><span id="l50.14">   -moz-background-inline-policy: continuous;</span>
<a href="#l50.15"></a><span id="l50.15">   -moz-background-origin: border;</span>
<a href="#l50.16"></a><span id="l50.16" class="difflineat">@@ -24,181 +24,181 @@ treechildren::-moz-tree-image(folderName</span>
<a href="#l50.17"></a><span id="l50.17"> </span>
<a href="#l50.18"></a><span id="l50.18"> treechildren::-moz-tree-image(folderNameCol, selected, open, newMessages-true) {</span>
<a href="#l50.19"></a><span id="l50.19">   background-image: url(&quot;moz-icon://stock/gtk-directory?size=menu&quot;);</span>
<a href="#l50.20"></a><span id="l50.20">   list-style-image: url(&quot;chrome://messenger/skin/icons/folder-new-star.png&quot;);</span>
<a href="#l50.21"></a><span id="l50.21"> }</span>
<a href="#l50.22"></a><span id="l50.22"> </span>
<a href="#l50.23"></a><span id="l50.23"> /* ..... Newsgroup ..... */</span>
<a href="#l50.24"></a><span id="l50.24"> </span>
<a href="#l50.25"></a><span id="l50.25" class="difflineminus">-.tabmail-tab[type=&quot;folder&quot;][ServerType=&quot;nntp&quot;] &gt; .tab-image-middle &gt; .tab-icon &gt; .tab-icon-image,</span>
<a href="#l50.26"></a><span id="l50.26" class="difflineplus">+.tabmail-tab[type=&quot;folder&quot;][ServerType=&quot;nntp&quot;] &gt; .tab-image-middle &gt; .tab-icon-image,</span>
<a href="#l50.27"></a><span id="l50.27"> treechildren::-moz-tree-image(folderNameCol, serverType-nntp) {</span>
<a href="#l50.28"></a><span id="l50.28">   background-image: none;</span>
<a href="#l50.29"></a><span id="l50.29">   list-style-image: url(&quot;chrome://messenger/skin/icons/folder.png&quot;);</span>
<a href="#l50.30"></a><span id="l50.30">   -moz-image-region: rect(0 160px 16px 144px);</span>
<a href="#l50.31"></a><span id="l50.31"> }</span>
<a href="#l50.32"></a><span id="l50.32"> </span>
<a href="#l50.33"></a><span id="l50.33"> /* ..... Feed ..... */</span>
<a href="#l50.34"></a><span id="l50.34"> </span>
<a href="#l50.35"></a><span id="l50.35" class="difflineminus">-.tabmail-tab[type=&quot;folder&quot;][ServerType=&quot;rss&quot;] &gt; .tab-image-middle &gt; .tab-icon &gt; .tab-icon-image,</span>
<a href="#l50.36"></a><span id="l50.36" class="difflineplus">+.tabmail-tab[type=&quot;folder&quot;][ServerType=&quot;rss&quot;] &gt; .tab-image-middle &gt; .tab-icon-image,</span>
<a href="#l50.37"></a><span id="l50.37"> treechildren::-moz-tree-image(folderNameCol, serverType-rss) {</span>
<a href="#l50.38"></a><span id="l50.38">   background-image: url(&quot;chrome://messenger/skin/icons/folder-pane.png&quot;);</span>
<a href="#l50.39"></a><span id="l50.39">   background-position: left -112px;</span>
<a href="#l50.40"></a><span id="l50.40">   list-style-image: url(&quot;chrome://messenger/skin/icons/folder-blank.png&quot;);</span>
<a href="#l50.41"></a><span id="l50.41"> }</span>
<a href="#l50.42"></a><span id="l50.42"> </span>
<a href="#l50.43"></a><span id="l50.43"> treechildren::-moz-tree-image(folderNameCol, serverType-rss, newMessages-true) {</span>
<a href="#l50.44"></a><span id="l50.44">   background-image: url(&quot;chrome://messenger/skin/icons/folder-pane.png&quot;);</span>
<a href="#l50.45"></a><span id="l50.45">   background-position: left -112px;</span>
<a href="#l50.46"></a><span id="l50.46">   list-style-image: url(&quot;chrome://messenger/skin/icons/folder-new-star.png&quot;);</span>
<a href="#l50.47"></a><span id="l50.47"> }</span>
<a href="#l50.48"></a><span id="l50.48"> </span>
<a href="#l50.49"></a><span id="l50.49"> /* Resets list-style-image for Feed Trash and Virtual folders */</span>
<a href="#l50.50"></a><span id="l50.50"> </span>
<a href="#l50.51"></a><span id="l50.51" class="difflineminus">-.tabmail-tab[type=&quot;folder&quot;][SpecialFolder=&quot;Trash&quot;][ServerType=&quot;rss&quot;] &gt; .tab-image-middle &gt; .tab-icon &gt; .tab-icon-image,</span>
<a href="#l50.52"></a><span id="l50.52" class="difflineminus">-.tabmail-tab[type=&quot;folder&quot;][SpecialFolder=&quot;Virtual&quot;][ServerType=&quot;rss&quot;] &gt; .tab-image-middle &gt; .tab-icon &gt; .tab-icon-image,</span>
<a href="#l50.53"></a><span id="l50.53" class="difflineplus">+.tabmail-tab[type=&quot;folder&quot;][SpecialFolder=&quot;Trash&quot;][ServerType=&quot;rss&quot;] &gt; .tab-image-middle &gt; .tab-icon-image,</span>
<a href="#l50.54"></a><span id="l50.54" class="difflineplus">+.tabmail-tab[type=&quot;folder&quot;][SpecialFolder=&quot;Virtual&quot;][ServerType=&quot;rss&quot;] &gt; .tab-image-middle &gt; .tab-icon-image,</span>
<a href="#l50.55"></a><span id="l50.55"> treechildren::-moz-tree-image(folderNameCol, serverType-rss, specialFolder-Trash),</span>
<a href="#l50.56"></a><span id="l50.56"> treechildren::-moz-tree-image(folderNameCol, serverType-rss, specialFolder-Virtual) {</span>
<a href="#l50.57"></a><span id="l50.57">   background-image: url(&quot;chrome://messenger/skin/icons/folder-pane.png&quot;);</span>
<a href="#l50.58"></a><span id="l50.58">   background-position: left -176px;</span>
<a href="#l50.59"></a><span id="l50.59">   list-style-image: url(&quot;chrome://messenger/skin/icons/folder-blank.png&quot;);</span>
<a href="#l50.60"></a><span id="l50.60"> }</span>
<a href="#l50.61"></a><span id="l50.61"> </span>
<a href="#l50.62"></a><span id="l50.62"> /* ..... Inbox ..... */</span>
<a href="#l50.63"></a><span id="l50.63"> </span>
<a href="#l50.64"></a><span id="l50.64" class="difflineminus">-.tabmail-tab[type=&quot;folder&quot;][SpecialFolder=&quot;Inbox&quot;] &gt; .tab-image-middle &gt; .tab-icon &gt; .tab-icon-image,</span>
<a href="#l50.65"></a><span id="l50.65" class="difflineplus">+.tabmail-tab[type=&quot;folder&quot;][SpecialFolder=&quot;Inbox&quot;] &gt; .tab-image-middle &gt; .tab-icon-image,</span>
<a href="#l50.66"></a><span id="l50.66"> treechildren::-moz-tree-image(folderNameCol, specialFolder-Inbox) {</span>
<a href="#l50.67"></a><span id="l50.67">   background-image: url(&quot;chrome://messenger/skin/icons/folder-pane.png&quot;);</span>
<a href="#l50.68"></a><span id="l50.68">   background-position: left -64px;</span>
<a href="#l50.69"></a><span id="l50.69">   list-style-image: url(&quot;chrome://messenger/skin/icons/folder-blank.png&quot;);</span>
<a href="#l50.70"></a><span id="l50.70"> }</span>
<a href="#l50.71"></a><span id="l50.71"> </span>
<a href="#l50.72"></a><span id="l50.72"> treechildren::-moz-tree-image(folderNameCol, specialFolder-Inbox, newMessages-true) {</span>
<a href="#l50.73"></a><span id="l50.73">   background-image: url(&quot;chrome://messenger/skin/icons/folder-pane.png&quot;);</span>
<a href="#l50.74"></a><span id="l50.74">   background-position: left -64px;</span>
<a href="#l50.75"></a><span id="l50.75">   list-style-image: url(&quot;chrome://messenger/skin/icons/folder-new-star.png&quot;);</span>
<a href="#l50.76"></a><span id="l50.76"> }</span>
<a href="#l50.77"></a><span id="l50.77"> </span>
<a href="#l50.78"></a><span id="l50.78"> /* ..... Sent ..... */</span>
<a href="#l50.79"></a><span id="l50.79"> </span>
<a href="#l50.80"></a><span id="l50.80" class="difflineminus">-.tabmail-tab[type=&quot;folder&quot;][SpecialFolder=&quot;Sent&quot;] &gt; .tab-image-middle &gt; .tab-icon &gt; .tab-icon-image,</span>
<a href="#l50.81"></a><span id="l50.81" class="difflineplus">+.tabmail-tab[type=&quot;folder&quot;][SpecialFolder=&quot;Sent&quot;] &gt; .tab-image-middle &gt; .tab-icon-image,</span>
<a href="#l50.82"></a><span id="l50.82"> treechildren::-moz-tree-image(folderNameCol, specialFolder-Sent) {</span>
<a href="#l50.83"></a><span id="l50.83">   background-image: url(&quot;chrome://messenger/skin/icons/folder-pane.png&quot;);</span>
<a href="#l50.84"></a><span id="l50.84">   background-position: left -144px;</span>
<a href="#l50.85"></a><span id="l50.85">   list-style-image: url(&quot;chrome://messenger/skin/icons/folder-blank.png&quot;);</span>
<a href="#l50.86"></a><span id="l50.86"> }</span>
<a href="#l50.87"></a><span id="l50.87"> </span>
<a href="#l50.88"></a><span id="l50.88"> /* ..... Outbox ..... */</span>
<a href="#l50.89"></a><span id="l50.89"> </span>
<a href="#l50.90"></a><span id="l50.90" class="difflineminus">-.tabmail-tab[type=&quot;folder&quot;][SpecialFolder=&quot;Outbox&quot;] &gt; .tab-image-middle &gt; .tab-icon &gt; .tab-icon-image,</span>
<a href="#l50.91"></a><span id="l50.91" class="difflineplus">+.tabmail-tab[type=&quot;folder&quot;][SpecialFolder=&quot;Outbox&quot;] &gt; .tab-image-middle &gt; .tab-icon-image,</span>
<a href="#l50.92"></a><span id="l50.92"> treechildren::-moz-tree-image(folderNameCol, specialFolder-Outbox) {</span>
<a href="#l50.93"></a><span id="l50.93">   background-image: url(&quot;chrome://messenger/skin/icons/folder-pane.png&quot;);</span>
<a href="#l50.94"></a><span id="l50.94">   background-position: left -96px;</span>
<a href="#l50.95"></a><span id="l50.95">   list-style-image: url(&quot;chrome://messenger/skin/icons/folder-blank.png&quot;);</span>
<a href="#l50.96"></a><span id="l50.96"> }</span>
<a href="#l50.97"></a><span id="l50.97"> </span>
<a href="#l50.98"></a><span id="l50.98"> /* ..... Drafts ..... */</span>
<a href="#l50.99"></a><span id="l50.99"> </span>
<a href="#l50.100"></a><span id="l50.100" class="difflineminus">-.tabmail-tab[type=&quot;folder&quot;][SpecialFolder=&quot;Drafts&quot;] &gt; .tab-image-middle &gt; .tab-icon &gt; .tab-icon-image,</span>
<a href="#l50.101"></a><span id="l50.101" class="difflineplus">+.tabmail-tab[type=&quot;folder&quot;][SpecialFolder=&quot;Drafts&quot;] &gt; .tab-image-middle &gt; .tab-icon-image,</span>
<a href="#l50.102"></a><span id="l50.102"> treechildren::-moz-tree-image(folderNameCol, specialFolder-Drafts) {</span>
<a href="#l50.103"></a><span id="l50.103">   background-image: url(&quot;chrome://messenger/skin/icons/folder-pane.png&quot;);</span>
<a href="#l50.104"></a><span id="l50.104">   background-position: left -48px;</span>
<a href="#l50.105"></a><span id="l50.105">   list-style-image: url(&quot;chrome://messenger/skin/icons/folder-blank.png&quot;);</span>
<a href="#l50.106"></a><span id="l50.106"> }</span>
<a href="#l50.107"></a><span id="l50.107"> </span>
<a href="#l50.108"></a><span id="l50.108"> /* ..... Templates ..... */</span>
<a href="#l50.109"></a><span id="l50.109"> </span>
<a href="#l50.110"></a><span id="l50.110" class="difflineminus">-.tabmail-tab[type=&quot;folder&quot;][SpecialFolder=&quot;Templates&quot;] &gt; .tab-image-middle &gt; .tab-icon &gt; .tab-icon-image,</span>
<a href="#l50.111"></a><span id="l50.111" class="difflineplus">+.tabmail-tab[type=&quot;folder&quot;][SpecialFolder=&quot;Templates&quot;] &gt; .tab-image-middle &gt; .tab-icon-image,</span>
<a href="#l50.112"></a><span id="l50.112"> treechildren::-moz-tree-image(folderNameCol, specialFolder-Templates) {</span>
<a href="#l50.113"></a><span id="l50.113">   background-image: url(&quot;chrome://messenger/skin/icons/folder-pane.png&quot;);</span>
<a href="#l50.114"></a><span id="l50.114">   background-position: left -160px;</span>
<a href="#l50.115"></a><span id="l50.115">   list-style-image: url(&quot;chrome://messenger/skin/icons/folder-blank.png&quot;);</span>
<a href="#l50.116"></a><span id="l50.116"> }</span>
<a href="#l50.117"></a><span id="l50.117"> </span>
<a href="#l50.118"></a><span id="l50.118"> /* ..... Junk ..... */</span>
<a href="#l50.119"></a><span id="l50.119"> </span>
<a href="#l50.120"></a><span id="l50.120" class="difflineminus">-.tabmail-tab[type=&quot;folder&quot;][SpecialFolder=&quot;Junk&quot;] &gt; .tab-image-middle &gt; .tab-icon &gt; .tab-icon-image,</span>
<a href="#l50.121"></a><span id="l50.121" class="difflineplus">+.tabmail-tab[type=&quot;folder&quot;][SpecialFolder=&quot;Junk&quot;] &gt; .tab-image-middle &gt; .tab-icon-image,</span>
<a href="#l50.122"></a><span id="l50.122"> treechildren::-moz-tree-image(folderNameCol, specialFolder-Junk) {</span>
<a href="#l50.123"></a><span id="l50.123">   background-image: url(&quot;chrome://messenger/skin/icons/folder-pane.png&quot;);</span>
<a href="#l50.124"></a><span id="l50.124">   background-position: left -80px;</span>
<a href="#l50.125"></a><span id="l50.125">   list-style-image: url(&quot;chrome://messenger/skin/icons/folder-blank.png&quot;);</span>
<a href="#l50.126"></a><span id="l50.126"> }</span>
<a href="#l50.127"></a><span id="l50.127"> </span>
<a href="#l50.128"></a><span id="l50.128"> /* ..... Trash ..... */</span>
<a href="#l50.129"></a><span id="l50.129"> </span>
<a href="#l50.130"></a><span id="l50.130" class="difflineminus">-.tabmail-tab[type=&quot;folder&quot;][SpecialFolder=&quot;Trash&quot;] &gt; .tab-image-middle &gt; .tab-icon &gt; .tab-icon-image,</span>
<a href="#l50.131"></a><span id="l50.131" class="difflineplus">+.tabmail-tab[type=&quot;folder&quot;][SpecialFolder=&quot;Trash&quot;] &gt; .tab-image-middle &gt; .tab-icon-image,</span>
<a href="#l50.132"></a><span id="l50.132"> treechildren::-moz-tree-image(folderNameCol, specialFolder-Trash) {</span>
<a href="#l50.133"></a><span id="l50.133">   background-image: url(&quot;chrome://messenger/skin/icons/folder-pane.png&quot;);</span>
<a href="#l50.134"></a><span id="l50.134">   background-position: left -176px;</span>
<a href="#l50.135"></a><span id="l50.135">   list-style-image: url(&quot;chrome://messenger/skin/icons/folder-blank.png&quot;);</span>
<a href="#l50.136"></a><span id="l50.136"> }</span>
<a href="#l50.137"></a><span id="l50.137"> </span>
<a href="#l50.138"></a><span id="l50.138"> /* ..... Archives ..... */</span>
<a href="#l50.139"></a><span id="l50.139"> </span>
<a href="#l50.140"></a><span id="l50.140" class="difflineminus">-.tabmail-tab[type=&quot;folder&quot;][SpecialFolder=&quot;Archive&quot;] &gt; .tab-image-middle &gt; .tab-icon &gt; .tab-icon-image,</span>
<a href="#l50.141"></a><span id="l50.141" class="difflineplus">+.tabmail-tab[type=&quot;folder&quot;][SpecialFolder=&quot;Archive&quot;] &gt; .tab-image-middle &gt; .tab-icon-image,</span>
<a href="#l50.142"></a><span id="l50.142"> treechildren::-moz-tree-image(folderNameCol, specialFolder-Archive) {</span>
<a href="#l50.143"></a><span id="l50.143">   background-image: url(&quot;chrome://messenger/skin/icons/folder-pane.png&quot;);</span>
<a href="#l50.144"></a><span id="l50.144">   background-position: left -192px;</span>
<a href="#l50.145"></a><span id="l50.145">   list-style-image: url(&quot;chrome://messenger/skin/icons/folder-blank.png&quot;);</span>
<a href="#l50.146"></a><span id="l50.146"> }</span>
<a href="#l50.147"></a><span id="l50.147"> </span>
<a href="#l50.148"></a><span id="l50.148"> /* ..... Shared folders .....</span>
<a href="#l50.149"></a><span id="l50.149"> </span>
<a href="#l50.150"></a><span id="l50.150"> treechildren::-moz-tree-image(folderNameCol, imapShared-true) {</span>
<a href="#l50.151"></a><span id="l50.151">   -moz-image-region: rect(0 192px 16px 176px);</span>
<a href="#l50.152"></a><span id="l50.152"> }</span>
<a href="#l50.153"></a><span id="l50.153"> </span>
<a href="#l50.154"></a><span id="l50.154"> */ </span>
<a href="#l50.155"></a><span id="l50.155"> </span>
<a href="#l50.156"></a><span id="l50.156"> /* ..... Saved Search Folder ..... */</span>
<a href="#l50.157"></a><span id="l50.157"> </span>
<a href="#l50.158"></a><span id="l50.158" class="difflineminus">-.tabmail-tab[type=&quot;folder&quot;][SpecialFolder=&quot;Virtual&quot;] &gt; .tab-image-middle &gt; .tab-icon &gt; .tab-icon-image,</span>
<a href="#l50.159"></a><span id="l50.159" class="difflineplus">+.tabmail-tab[type=&quot;folder&quot;][SpecialFolder=&quot;Virtual&quot;] &gt; .tab-image-middle &gt; .tab-icon-image,</span>
<a href="#l50.160"></a><span id="l50.160"> treechildren::-moz-tree-image(folderNameCol, specialFolder-Virtual) {</span>
<a href="#l50.161"></a><span id="l50.161">   background-image: url(&quot;chrome://messenger/skin/icons/folder-pane.png&quot;);</span>
<a href="#l50.162"></a><span id="l50.162">   background-position: left -128px;</span>
<a href="#l50.163"></a><span id="l50.163">   list-style-image: url(&quot;chrome://messenger/skin/icons/folder-blank.png&quot;);</span>
<a href="#l50.164"></a><span id="l50.164"> }</span>
<a href="#l50.165"></a><span id="l50.165"> </span>
<a href="#l50.166"></a><span id="l50.166"> /* .....  Newsgroup .....  */</span>
<a href="#l50.167"></a><span id="l50.167" class="difflineminus">-.tabmail-tab[type=&quot;folder&quot;][ServerType=&quot;nntp&quot;] &gt; .tab-image-middle &gt; .tab-icon &gt; .tab-icon-image {</span>
<a href="#l50.168"></a><span id="l50.168" class="difflineplus">+.tabmail-tab[type=&quot;folder&quot;][ServerType=&quot;nntp&quot;] &gt; .tab-image-middle &gt; .tab-icon-image {</span>
<a href="#l50.169"></a><span id="l50.169">   background-image: url(&quot;chrome://messenger/skin/icons/folder-pane.png&quot;);</span>
<a href="#l50.170"></a><span id="l50.170">   background-position: left -208px;</span>
<a href="#l50.171"></a><span id="l50.171">   list-style-image: url(&quot;chrome://messenger/skin/icons/folder-blank.png&quot;);</span>
<a href="#l50.172"></a><span id="l50.172"> }</span>
<a href="#l50.173"></a><span id="l50.173"> </span>
<a href="#l50.174"></a><span id="l50.174"> /* ..... Account nodes ..... */</span>
<a href="#l50.175"></a><span id="l50.175" class="difflineminus">-.tabmail-tab[type=&quot;folder&quot;][IsServer=&quot;true&quot;] &gt; .tab-image-middle &gt; .tab-icon &gt; .tab-icon-image {</span>
<a href="#l50.176"></a><span id="l50.176" class="difflineplus">+.tabmail-tab[type=&quot;folder&quot;][IsServer=&quot;true&quot;] &gt; .tab-image-middle &gt; .tab-icon-image {</span>
<a href="#l50.177"></a><span id="l50.177">   -moz-margin-start: 0px;</span>
<a href="#l50.178"></a><span id="l50.178">   background-image: url(&quot;chrome://messenger/skin/icons/folder-pane.png&quot;);</span>
<a href="#l50.179"></a><span id="l50.179">   background-position: left -16px;</span>
<a href="#l50.180"></a><span id="l50.180">   list-style-image: url(&quot;chrome://messenger/skin/icons/folder-blank.png&quot;);</span>
<a href="#l50.181"></a><span id="l50.181"> }</span>
<a href="#l50.182"></a><span id="l50.182"> </span>
<a href="#l50.183"></a><span id="l50.183"> /* ..... Secure IMAP/POP account nodes ..... */</span>
<a href="#l50.184"></a><span id="l50.184" class="difflineminus">-.tabmail-tab[type=&quot;folder&quot;][IsServer=&quot;true&quot;][ServerType=&quot;imap&quot;][IsSecure=&quot;true&quot;] &gt; .tab-image-middle &gt; .tab-icon &gt; .tab-icon-image,</span>
<a href="#l50.185"></a><span id="l50.185" class="difflineminus">-.tabmail-tab[type=&quot;folder&quot;][IsServer=&quot;true&quot;][ServerType=&quot;pop3&quot;][IsSecure=&quot;true&quot;] &gt; .tab-image-middle &gt; .tab-icon &gt; .tab-icon-image {</span>
<a href="#l50.186"></a><span id="l50.186" class="difflineplus">+.tabmail-tab[type=&quot;folder&quot;][IsServer=&quot;true&quot;][ServerType=&quot;imap&quot;][IsSecure=&quot;true&quot;] &gt; .tab-image-middle &gt; .tab-icon-image,</span>
<a href="#l50.187"></a><span id="l50.187" class="difflineplus">+.tabmail-tab[type=&quot;folder&quot;][IsServer=&quot;true&quot;][ServerType=&quot;pop3&quot;][IsSecure=&quot;true&quot;] &gt; .tab-image-middle &gt; .tab-icon-image {</span>
<a href="#l50.188"></a><span id="l50.188">   background-position: left -16px;</span>
<a href="#l50.189"></a><span id="l50.189">   list-style-image: url(&quot;chrome://messenger/skin/icons/folder-blank.png&quot;);</span>
<a href="#l50.190"></a><span id="l50.190"> }</span>
<a href="#l50.191"></a><span id="l50.191"> </span>
<a href="#l50.192"></a><span id="l50.192"> /* ..... Local folders ..... */</span>
<a href="#l50.193"></a><span id="l50.193" class="difflineminus">-.tabmail-tab[type=&quot;folder&quot;][IsServer=&quot;true&quot;][ServerType=&quot;none&quot;] &gt; .tab-image-middle &gt; .tab-icon &gt; .tab-icon-image {</span>
<a href="#l50.194"></a><span id="l50.194" class="difflineplus">+.tabmail-tab[type=&quot;folder&quot;][IsServer=&quot;true&quot;][ServerType=&quot;none&quot;] &gt; .tab-image-middle &gt; .tab-icon-image {</span>
<a href="#l50.195"></a><span id="l50.195">   background-position: left 0px;</span>
<a href="#l50.196"></a><span id="l50.196">   list-style-image: url(&quot;chrome://messenger/skin/icons/folder-blank.png&quot;);</span>
<a href="#l50.197"></a><span id="l50.197"> }</span>
<a href="#l50.198"></a><span id="l50.198"> </span>
<a href="#l50.199"></a><span id="l50.199"> /* ..... News server ..... */</span>
<a href="#l50.200"></a><span id="l50.200" class="difflineminus">-.tabmail-tab[type=&quot;folder&quot;][IsServer=&quot;true&quot;][ServerType=&quot;nntp&quot;] &gt; .tab-image-middle &gt; .tab-icon &gt; .tab-icon-image {</span>
<a href="#l50.201"></a><span id="l50.201" class="difflineplus">+.tabmail-tab[type=&quot;folder&quot;][IsServer=&quot;true&quot;][ServerType=&quot;nntp&quot;] &gt; .tab-image-middle &gt; .tab-icon-image {</span>
<a href="#l50.202"></a><span id="l50.202">   background-image: none;</span>
<a href="#l50.203"></a><span id="l50.203">   list-style-image: url(&quot;chrome://messenger/skin/icons/server.png&quot;);</span>
<a href="#l50.204"></a><span id="l50.204">   -moz-image-region: rect(0 64px 16px 48px);</span>
<a href="#l50.205"></a><span id="l50.205"> }</span>
<a href="#l50.206"></a><span id="l50.206"> </span>
<a href="#l50.207"></a><span id="l50.207"> /* ..... Secure news server ..... */</span>
<a href="#l50.208"></a><span id="l50.208" class="difflineminus">-.tabmail-tab[type=&quot;folder&quot;][IsServer=&quot;true&quot;][ServerType=&quot;nntp&quot;][IsSecure=&quot;true&quot;] &gt; .tab-image-middle &gt; .tab-icon &gt; .tab-icon-image {</span>
<a href="#l50.209"></a><span id="l50.209" class="difflineplus">+.tabmail-tab[type=&quot;folder&quot;][IsServer=&quot;true&quot;][ServerType=&quot;nntp&quot;][IsSecure=&quot;true&quot;] &gt; .tab-image-middle &gt; .tab-icon-image {</span>
<a href="#l50.210"></a><span id="l50.210">   background-image: none;</span>
<a href="#l50.211"></a><span id="l50.211">   list-style-image: url(&quot;chrome://messenger/skin/icons/server.png&quot;);</span>
<a href="#l50.212"></a><span id="l50.212">   -moz-image-region: rect(0 80px 16px 64px);</span>
<a href="#l50.213"></a><span id="l50.213"> }</span>
<a href="#l50.214"></a><span id="l50.214"> </span>
<a href="#l50.215"></a><span id="l50.215"> treechildren::-moz-tree-image(folderNameCol, specialFolder-Virtual, newMessages-true) {</span>
<a href="#l50.216"></a><span id="l50.216">   list-style-image: url(&quot;chrome://messenger/skin/icons/folder.png&quot;);</span>
<a href="#l50.217"></a><span id="l50.217">   -moz-image-region: rect(16px 176px 32px 160px);</span>
<a href="#l50.218"></a><span id="l50.218" class="difflineat">@@ -258,17 +258,17 @@ treechildren::-moz-tree-image(folderName</span>
<a href="#l50.219"></a><span id="l50.219"> treechildren::-moz-tree-image(folderNameCol, isServer-true, serverType-nntp, isSecure-true) {</span>
<a href="#l50.220"></a><span id="l50.220">   background-image: none;</span>
<a href="#l50.221"></a><span id="l50.221">   list-style-image: url(&quot;chrome://messenger/skin/icons/server.png&quot;);</span>
<a href="#l50.222"></a><span id="l50.222">   -moz-image-region: rect(0 80px 16px 64px) !important;</span>
<a href="#l50.223"></a><span id="l50.223"> }</span>
<a href="#l50.224"></a><span id="l50.224"> </span>
<a href="#l50.225"></a><span id="l50.225"> /* ..... Feed server ..... */</span>
<a href="#l50.226"></a><span id="l50.226"> </span>
<a href="#l50.227"></a><span id="l50.227" class="difflineminus">-.tabmail-tab[type=&quot;folder&quot;][IsServer=&quot;true&quot;][ServerType=&quot;rss&quot;] &gt; .tab-image-middle &gt; .tab-icon &gt; .tab-icon-image,</span>
<a href="#l50.228"></a><span id="l50.228" class="difflineplus">+.tabmail-tab[type=&quot;folder&quot;][IsServer=&quot;true&quot;][ServerType=&quot;rss&quot;] &gt; .tab-image-middle &gt; .tab-icon-image,</span>
<a href="#l50.229"></a><span id="l50.229"> treechildren::-moz-tree-image(folderNameCol, isServer-true, serverType-rss) {</span>
<a href="#l50.230"></a><span id="l50.230">   background-position: left -32px;</span>
<a href="#l50.231"></a><span id="l50.231">   list-style-image: url(&quot;chrome://messenger/skin/icons/folder-blank.png&quot;);</span>
<a href="#l50.232"></a><span id="l50.232"> }</span>
<a href="#l50.233"></a><span id="l50.233"> </span>
<a href="#l50.234"></a><span id="l50.234"> /* ::::: All Servers ::::: */</span>
<a href="#l50.235"></a><span id="l50.235"> </span>
<a href="#l50.236"></a><span id="l50.236"> treechildren::-moz-tree-cell-text(closed, subfoldersHaveUnreadMessages-true) {</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l51.1"></a><span id="l51.1">index e2fcc69546524ca030c27d8752f06c5356c8876b..c416de2d99e9331d089bfde232eaf481256e10a2</span>
<a href="#l51.2"></a><span id="l51.2">GIT binary patch
literal 4248
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/span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l52.1"></a><span id="l52.1" class="difflineminus">--- a/mail/themes/gnomestripe/mail/tabmail.css</span>
<a href="#l52.2"></a><span id="l52.2" class="difflineplus">+++ b/mail/themes/gnomestripe/mail/tabmail.css</span>
<a href="#l52.3"></a><span id="l52.3" class="difflineat">@@ -77,25 +77,25 @@ tabpanels {</span>
<a href="#l52.4"></a><span id="l52.4">   width: 16px;</span>
<a href="#l52.5"></a><span id="l52.5">   height: 16px;</span>
<a href="#l52.6"></a><span id="l52.6">   -moz-margin-start: 4px;</span>
<a href="#l52.7"></a><span id="l52.7">   -moz-margin-end: 3px;</span>
<a href="#l52.8"></a><span id="l52.8">   list-style-image: url(&quot;chrome://global/skin/icons/folder-item.png&quot;);</span>
<a href="#l52.9"></a><span id="l52.9">   -moz-image-region: rect(0px, 16px, 16px, 0px);</span>
<a href="#l52.10"></a><span id="l52.10"> }</span>
<a href="#l52.11"></a><span id="l52.11"> </span>
<a href="#l52.12"></a><span id="l52.12" class="difflineminus">-.tabmail-tab[busy] &gt; .tab-image-middle &gt; .tab-icon &gt; .tab-icon-image {</span>
<a href="#l52.13"></a><span id="l52.13" class="difflineplus">+.tabmail-tab[busy] &gt; .tab-image-middle &gt; .tab-icon-image {</span>
<a href="#l52.14"></a><span id="l52.14">   list-style-image: url(&quot;chrome://global/skin/icons/loading_16.png&quot;) !important;</span>
<a href="#l52.15"></a><span id="l52.15"> }</span>
<a href="#l52.16"></a><span id="l52.16"> </span>
<a href="#l52.17"></a><span id="l52.17" class="difflineminus">-.tabmail-tab[thinking] &gt; .tab-image-middle &gt; .tab-icon &gt; .tab-icon-image {</span>
<a href="#l52.18"></a><span id="l52.18" class="difflineplus">+.tabmail-tab[thinking] &gt; .tab-image-middle &gt; .tab-icon-image {</span>
<a href="#l52.19"></a><span id="l52.19">   list-style-image: url(&quot;chrome://global/skin/icons/loading_16.png&quot;) !important;</span>
<a href="#l52.20"></a><span id="l52.20"> }</span>
<a href="#l52.21"></a><span id="l52.21"> </span>
<a href="#l52.22"></a><span id="l52.22" class="difflineminus">-.tabmail-tab[type=&quot;glodaSearch&quot;] &gt; .tab-image-middle &gt; .tab-icon &gt; .tab-icon-image {</span>
<a href="#l52.23"></a><span id="l52.23" class="difflineplus">+.tabmail-tab[type=&quot;glodaSearch&quot;] &gt; .tab-image-middle &gt; .tab-icon-image {</span>
<a href="#l52.24"></a><span id="l52.24">   list-style-image: url(&quot;chrome://global/skin/icons/Search-glass.png&quot;);</span>
<a href="#l52.25"></a><span id="l52.25"> }</span>
<a href="#l52.26"></a><span id="l52.26"> </span>
<a href="#l52.27"></a><span id="l52.27"> .tabs-bottom {</span>
<a href="#l52.28"></a><span id="l52.28">   border-bottom: 1px solid threedshadow;</span>
<a href="#l52.29"></a><span id="l52.29"> }</span>
<a href="#l52.30"></a><span id="l52.30"> </span>
<a href="#l52.31"></a><span id="l52.31"> .tabmail-tab &gt; .tab-text {</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l53.1"></a><span id="l53.1">deleted file mode 100644</span>
<a href="#l53.2"></a><span id="l53.2" class="difflineminus">--- a/mail/themes/gnomestripe/mail/tabmailBindings.xml</span>
<a href="#l53.3"></a><span id="l53.3" class="difflineplus">+++ /dev/null</span>
<a href="#l53.4"></a><span id="l53.4" class="difflineat">@@ -1,110 +0,0 @@</span>
<a href="#l53.5"></a><span id="l53.5" class="difflineminus">-&lt;?xml version=&quot;1.0&quot;?&gt;</span>
<a href="#l53.6"></a><span id="l53.6" class="difflineminus">-# ***** BEGIN LICENSE BLOCK *****</span>
<a href="#l53.7"></a><span id="l53.7" class="difflineminus">-# Version: MPL 1.1/GPL 2.0/LGPL 2.1</span>
<a href="#l53.8"></a><span id="l53.8" class="difflineminus">-#</span>
<a href="#l53.9"></a><span id="l53.9" class="difflineminus">-# The contents of this file are subject to the Mozilla Public License Version</span>
<a href="#l53.10"></a><span id="l53.10" class="difflineminus">-# 1.1 (the &quot;License&quot;); you may not use this file except in compliance with</span>
<a href="#l53.11"></a><span id="l53.11" class="difflineminus">-# the License. You may obtain a copy of the License at</span>
<a href="#l53.12"></a><span id="l53.12" class="difflineminus">-# http://www.mozilla.org/MPL/</span>
<a href="#l53.13"></a><span id="l53.13" class="difflineminus">-#</span>
<a href="#l53.14"></a><span id="l53.14" class="difflineminus">-# Software distributed under the License is distributed on an &quot;AS IS&quot; basis,</span>
<a href="#l53.15"></a><span id="l53.15" class="difflineminus">-# WITHOUT WARRANTY OF ANY KIND, either express or implied. See the License</span>
<a href="#l53.16"></a><span id="l53.16" class="difflineminus">-# for the specific language governing rights and limitations under the</span>
<a href="#l53.17"></a><span id="l53.17" class="difflineminus">-# License.</span>
<a href="#l53.18"></a><span id="l53.18" class="difflineminus">-#</span>
<a href="#l53.19"></a><span id="l53.19" class="difflineminus">-# The Original Code is tab mail</span>
<a href="#l53.20"></a><span id="l53.20" class="difflineminus">-#</span>
<a href="#l53.21"></a><span id="l53.21" class="difflineminus">-# The Initial Developer of the Original Code is</span>
<a href="#l53.22"></a><span id="l53.22" class="difflineminus">-#   Scott MacGregor &lt;mscott@mozilla.org&gt;.</span>
<a href="#l53.23"></a><span id="l53.23" class="difflineminus">-# Portions created by the Initial Developer are Copyright (C) 2007</span>
<a href="#l53.24"></a><span id="l53.24" class="difflineminus">-# the Initial Developer. All Rights Reserved.</span>
<a href="#l53.25"></a><span id="l53.25" class="difflineminus">-#</span>
<a href="#l53.26"></a><span id="l53.26" class="difflineminus">-# Contributor(s):</span>
<a href="#l53.27"></a><span id="l53.27" class="difflineminus">-#</span>
<a href="#l53.28"></a><span id="l53.28" class="difflineminus">-# Alternatively, the contents of this file may be used under the terms of</span>
<a href="#l53.29"></a><span id="l53.29" class="difflineminus">-# either the GNU General Public License Version 2 or later (the &quot;GPL&quot;), or</span>
<a href="#l53.30"></a><span id="l53.30" class="difflineminus">-# the GNU Lesser General Public License Version 2.1 or later (the &quot;LGPL&quot;),</span>
<a href="#l53.31"></a><span id="l53.31" class="difflineminus">-# in which case the provisions of the GPL or the LGPL are applicable instead</span>
<a href="#l53.32"></a><span id="l53.32" class="difflineminus">-# of those above. If you wish to allow use of your version of this file only</span>
<a href="#l53.33"></a><span id="l53.33" class="difflineminus">-# under the terms of either the GPL or the LGPL, and not to allow others to</span>
<a href="#l53.34"></a><span id="l53.34" class="difflineminus">-# use your version of this file under the terms of the MPL, indicate your</span>
<a href="#l53.35"></a><span id="l53.35" class="difflineminus">-# decision by deleting the provisions above and replace them with the notice</span>
<a href="#l53.36"></a><span id="l53.36" class="difflineminus">-# and other provisions required by the GPL or the LGPL. If you do not delete</span>
<a href="#l53.37"></a><span id="l53.37" class="difflineminus">-# the provisions above, a recipient may use your version of this file under</span>
<a href="#l53.38"></a><span id="l53.38" class="difflineminus">-# the terms of any one of the MPL, the GPL or the LGPL.</span>
<a href="#l53.39"></a><span id="l53.39" class="difflineminus">-#</span>
<a href="#l53.40"></a><span id="l53.40" class="difflineminus">-# ***** END LICENSE BLOCK *****</span>
<a href="#l53.41"></a><span id="l53.41" class="difflineminus">-</span>
<a href="#l53.42"></a><span id="l53.42" class="difflineminus">-&lt;!DOCTYPE bindings [</span>
<a href="#l53.43"></a><span id="l53.43" class="difflineminus">-&lt;!ENTITY % tabMailDTD SYSTEM &quot;chrome://messenger/locale/tabmail.dtd&quot; &gt;</span>
<a href="#l53.44"></a><span id="l53.44" class="difflineminus">-%tabMailDTD;</span>
<a href="#l53.45"></a><span id="l53.45" class="difflineminus">-&lt;!ENTITY % globalDTD SYSTEM &quot;chrome://global/locale/global.dtd&quot;&gt;</span>
<a href="#l53.46"></a><span id="l53.46" class="difflineminus">-%globalDTD;</span>
<a href="#l53.47"></a><span id="l53.47" class="difflineminus">-]&gt;</span>
<a href="#l53.48"></a><span id="l53.48" class="difflineminus">-</span>
<a href="#l53.49"></a><span id="l53.49" class="difflineminus">-&lt;bindings id=&quot;globalBindings&quot;</span>
<a href="#l53.50"></a><span id="l53.50" class="difflineminus">-   xmlns=&quot;http://www.mozilla.org/xbl&quot;</span>
<a href="#l53.51"></a><span id="l53.51" class="difflineminus">-   xmlns:xul=&quot;http://www.mozilla.org/keymaster/gatekeeper/there.is.only.xul&quot;</span>
<a href="#l53.52"></a><span id="l53.52" class="difflineminus">-   xmlns:xbl=&quot;http://www.mozilla.org/xbl&quot;&gt;</span>
<a href="#l53.53"></a><span id="l53.53" class="difflineminus">-</span>
<a href="#l53.54"></a><span id="l53.54" class="difflineminus">-  &lt;binding id=&quot;tabmail-tab&quot; extends=&quot;chrome://messenger/content/tabmail.xml#tabmail-tab&quot;&gt;</span>
<a href="#l53.55"></a><span id="l53.55" class="difflineminus">-    &lt;content chromedir=&quot;&amp;locale.dir;&quot;</span>
<a href="#l53.56"></a><span id="l53.56" class="difflineminus">-             closetabtext=&quot;&amp;closeTab.label;&quot;&gt;</span>
<a href="#l53.57"></a><span id="l53.57" class="difflineminus">-      &lt;xul:hbox class=&quot;tab-image-left&quot; xbl:inherits=&quot;selected&quot;/&gt;</span>
<a href="#l53.58"></a><span id="l53.58" class="difflineminus">-      &lt;xul:hbox flex=&quot;1&quot; class=&quot;tab-image-middle&quot; align=&quot;center&quot; xbl:inherits=&quot;selected&quot;&gt;</span>
<a href="#l53.59"></a><span id="l53.59" class="difflineminus">-        &lt;xul:stack class=&quot;tab-icon&quot;&gt;</span>
<a href="#l53.60"></a><span id="l53.60" class="difflineminus">-          &lt;xul:image xbl:inherits=&quot;validate,src=image&quot; class=&quot;tab-icon-image&quot;/&gt;</span>
<a href="#l53.61"></a><span id="l53.61" class="difflineminus">-          &lt;xul:image class=&quot;tab-extra-status&quot;/&gt;</span>
<a href="#l53.62"></a><span id="l53.62" class="difflineminus">-        &lt;/xul:stack&gt;</span>
<a href="#l53.63"></a><span id="l53.63" class="difflineminus">-        &lt;xul:label flex=&quot;1&quot; xbl:inherits=&quot;value=label,crop,accesskey&quot; crop=&quot;right&quot; class=&quot;tab-text&quot;/&gt;</span>
<a href="#l53.64"></a><span id="l53.64" class="difflineminus">-      &lt;/xul:hbox&gt;</span>
<a href="#l53.65"></a><span id="l53.65" class="difflineminus">-      &lt;xul:toolbarbutton anonid=&quot;close-button&quot; class=&quot;tab-close-button&quot; tabindex=&quot;-1&quot;/&gt;</span>
<a href="#l53.66"></a><span id="l53.66" class="difflineminus">-        &lt;xul:hbox class=&quot;tab-image-right&quot; xbl:inherits=&quot;selected&quot;/&gt;</span>
<a href="#l53.67"></a><span id="l53.67" class="difflineminus">-    &lt;/content&gt;</span>
<a href="#l53.68"></a><span id="l53.68" class="difflineminus">-  &lt;/binding&gt;</span>
<a href="#l53.69"></a><span id="l53.69" class="difflineminus">-</span>
<a href="#l53.70"></a><span id="l53.70" class="difflineminus">-   &lt;binding id=&quot;tabmail-tabs&quot;</span>
<a href="#l53.71"></a><span id="l53.71" class="difflineminus">-            extends=&quot;chrome://messenger/content/tabmail.xml#tabmail-tabs&quot;&gt;</span>
<a href="#l53.72"></a><span id="l53.72" class="difflineminus">-    &lt;content&gt;</span>
<a href="#l53.73"></a><span id="l53.73" class="difflineminus">-      &lt;xul:stack flex=&quot;1&quot; class=&quot;tabs-stack&quot;&gt;</span>
<a href="#l53.74"></a><span id="l53.74" class="difflineminus">-        &lt;xul:vbox&gt;</span>
<a href="#l53.75"></a><span id="l53.75" class="difflineminus">-          &lt;xul:spacer flex=&quot;1&quot;/&gt;</span>
<a href="#l53.76"></a><span id="l53.76" class="difflineminus">-          &lt;xul:hbox class=&quot;tabs-bottom&quot; align=&quot;center&quot;/&gt;</span>
<a href="#l53.77"></a><span id="l53.77" class="difflineminus">-        &lt;/xul:vbox&gt;</span>
<a href="#l53.78"></a><span id="l53.78" class="difflineminus">-        &lt;xul:vbox&gt;</span>
<a href="#l53.79"></a><span id="l53.79" class="difflineminus">-          &lt;xul:hbox&gt;</span>
<a href="#l53.80"></a><span id="l53.80" class="difflineminus">-            &lt;xul:stack&gt;</span>
<a href="#l53.81"></a><span id="l53.81" class="difflineminus">-              &lt;xul:spacer class=&quot;tabs-left&quot;/&gt;</span>
<a href="#l53.82"></a><span id="l53.82" class="difflineminus">-            &lt;/xul:stack&gt;</span>
<a href="#l53.83"></a><span id="l53.83" class="difflineminus">-            &lt;xul:arrowscrollbox anonid=&quot;arrowscrollbox&quot;</span>
<a href="#l53.84"></a><span id="l53.84" class="difflineminus">-                                orient=&quot;horizontal&quot;</span>
<a href="#l53.85"></a><span id="l53.85" class="difflineminus">-                                flex=&quot;1&quot;</span>
<a href="#l53.86"></a><span id="l53.86" class="difflineminus">-                                style=&quot;min-width: 1px;&quot;</span>
<a href="#l53.87"></a><span id="l53.87" class="difflineminus">-                                chromedir=&quot;&amp;locale.dir;&quot;</span>
<a href="#l53.88"></a><span id="l53.88" class="difflineminus">-                                class=&quot;tabmail-arrowscrollbox&quot;&gt;</span>
<a href="#l53.89"></a><span id="l53.89" class="difflineminus">-              &lt;children includes=&quot;tab&quot;/&gt;</span>
<a href="#l53.90"></a><span id="l53.90" class="difflineminus">-            &lt;/xul:arrowscrollbox&gt;</span>
<a href="#l53.91"></a><span id="l53.91" class="difflineminus">-            &lt;children/&gt;</span>
<a href="#l53.92"></a><span id="l53.92" class="difflineminus">-            &lt;xul:stack align=&quot;center&quot; pack=&quot;end&quot; chromedir=&quot;&amp;locale.dir;&quot;&gt;</span>
<a href="#l53.93"></a><span id="l53.93" class="difflineminus">-              &lt;xul:hbox flex=&quot;1&quot;</span>
<a href="#l53.94"></a><span id="l53.94" class="difflineminus">-                        class=&quot;tabs-alltabs-box&quot;</span>
<a href="#l53.95"></a><span id="l53.95" class="difflineminus">-                        anonid=&quot;alltabs-box&quot;/&gt;</span>
<a href="#l53.96"></a><span id="l53.96" class="difflineminus">-              &lt;xul:hbox flex=&quot;1&quot; class=&quot;tabs-alltabs-box-animate&quot;</span>
<a href="#l53.97"></a><span id="l53.97" class="difflineminus">-                        anonid=&quot;alltabs-box-animate&quot;/&gt;</span>
<a href="#l53.98"></a><span id="l53.98" class="difflineminus">-              &lt;xul:toolbarbutton class=&quot;tabs-alltabs-button&quot; type=&quot;menu&quot;</span>
<a href="#l53.99"></a><span id="l53.99" class="difflineminus">-                                 anonid=&quot;alltabs-button&quot;</span>
<a href="#l53.100"></a><span id="l53.100" class="difflineminus">-                                 tooltipstring=&quot;&amp;listAllTabs.label;&quot;&gt;</span>
<a href="#l53.101"></a><span id="l53.101" class="difflineminus">-                &lt;xul:menupopup class=&quot;tabs-alltabs-popup&quot;</span>
<a href="#l53.102"></a><span id="l53.102" class="difflineminus">-                               anonid=&quot;alltabs-popup&quot; position=&quot;after_end&quot;/&gt;</span>
<a href="#l53.103"></a><span id="l53.103" class="difflineminus">-              &lt;/xul:toolbarbutton&gt;</span>
<a href="#l53.104"></a><span id="l53.104" class="difflineminus">-            &lt;/xul:stack&gt;</span>
<a href="#l53.105"></a><span id="l53.105" class="difflineminus">-            &lt;xul:hbox class=&quot;tabs-closebutton-box&quot; align=&quot;center&quot; pack=&quot;end&quot; anonid=&quot;tabstrip-closebutton&quot;&gt;</span>
<a href="#l53.106"></a><span id="l53.106" class="difflineminus">-              &lt;xul:toolbarbutton class=&quot;close-button tabs-closebutton&quot;/&gt;</span>
<a href="#l53.107"></a><span id="l53.107" class="difflineminus">-            &lt;/xul:hbox&gt;</span>
<a href="#l53.108"></a><span id="l53.108" class="difflineminus">-          &lt;/xul:hbox&gt;</span>
<a href="#l53.109"></a><span id="l53.109" class="difflineminus">-          &lt;xul:spacer class=&quot;tabs-bottom-spacer&quot;/&gt;</span>
<a href="#l53.110"></a><span id="l53.110" class="difflineminus">-        &lt;/xul:vbox&gt;</span>
<a href="#l53.111"></a><span id="l53.111" class="difflineminus">-      &lt;/xul:stack&gt;</span>
<a href="#l53.112"></a><span id="l53.112" class="difflineminus">-    &lt;/content&gt;</span>
<a href="#l53.113"></a><span id="l53.113" class="difflineminus">-  &lt;/binding&gt;</span>
<a href="#l53.114"></a><span id="l53.114" class="difflineminus">-&lt;/bindings&gt;</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l54.1"></a><span id="l54.1" class="difflineminus">--- a/mail/themes/pinstripe/jar.mn</span>
<a href="#l54.2"></a><span id="l54.2" class="difflineplus">+++ b/mail/themes/pinstripe/jar.mn</span>
<a href="#l54.3"></a><span id="l54.3" class="difflineat">@@ -20,17 +20,16 @@ classic.jar:</span>
<a href="#l54.4"></a><span id="l54.4">   skin/classic/messenger/tagColors.css                           (mail/tagColors.css)</span>
<a href="#l54.5"></a><span id="l54.5">   skin/classic/messenger/junkMail.css                            (mail/junkMail.css)</span>
<a href="#l54.6"></a><span id="l54.6">   skin/classic/messenger/folderMenus.css                         (mail/folderMenus.css)</span>
<a href="#l54.7"></a><span id="l54.7">   skin/classic/messenger/folderPane.css                          (mail/folderPane.css)</span>
<a href="#l54.8"></a><span id="l54.8">   skin/classic/messenger/subscribe.css                           (mail/subscribe.css)</span>
<a href="#l54.9"></a><span id="l54.9">   skin/classic/messenger/virtualFolderListDialog.css             (mail/virtualFolderListDialog.css)</span>
<a href="#l54.10"></a><span id="l54.10">   skin/classic/messenger/searchDialog.css                        (mail/searchDialog.css)</span>
<a href="#l54.11"></a><span id="l54.11">   skin/classic/messenger/filterDialog.css                        (mail/filterDialog.css)</span>
<a href="#l54.12"></a><span id="l54.12" class="difflineminus">-* skin/classic/messenger/tabmailBindings.xml                     (mail/tabmailBindings.xml)</span>
<a href="#l54.13"></a><span id="l54.13">   skin/classic/messenger/tabmail.css                             (mail/tabmail.css)</span>
<a href="#l54.14"></a><span id="l54.14">   skin/classic/messenger/editContactOverlay.css                  (mail/editContactOverlay.css)</span>
<a href="#l54.15"></a><span id="l54.15">   skin/classic/messenger/starred48.png                           (mail/starred48.png)</span>
<a href="#l54.16"></a><span id="l54.16">   skin/classic/messenger/starIcons.png                           (mail/starIcons.png)</span>
<a href="#l54.17"></a><span id="l54.17">   skin/classic/messenger/activity/activity.css                   (mail/activity/activity.css)</span>
<a href="#l54.18"></a><span id="l54.18">   skin/classic/messenger/activity/buttons.png                    (mail/activity/buttons.png)  </span>
<a href="#l54.19"></a><span id="l54.19">   skin/classic/messenger/activity/defaultProcessIcon.png         (mail/activity/defaultProcessIcon.png)</span>
<a href="#l54.20"></a><span id="l54.20">   skin/classic/messenger/activity/defaultEventIcon.png           (mail/activity/defaultEventIcon.png)</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l55.1"></a><span id="l55.1" class="difflineminus">--- a/mail/themes/pinstripe/mail/dialogs.css</span>
<a href="#l55.2"></a><span id="l55.2" class="difflineplus">+++ b/mail/themes/pinstripe/mail/dialogs.css</span>
<a href="#l55.3"></a><span id="l55.3" class="difflineat">@@ -62,38 +62,8 @@ menu.push[open=&quot;true&quot;] {</span>
<a href="#l55.4"></a><span id="l55.4">   -moz-padding-end: 1px;</span>
<a href="#l55.5"></a><span id="l55.5"> }</span>
<a href="#l55.6"></a><span id="l55.6"> </span>
<a href="#l55.7"></a><span id="l55.7"> menu.push[disabled=&quot;true&quot;],</span>
<a href="#l55.8"></a><span id="l55.8"> menu.push[disabled=&quot;true&quot;]:hover,</span>
<a href="#l55.9"></a><span id="l55.9"> menu.push[disabled=&quot;true&quot;]:hover:active {</span>
<a href="#l55.10"></a><span id="l55.10">   color: GrayText;</span>
<a href="#l55.11"></a><span id="l55.11"> }</span>
<a href="#l55.12"></a><span id="l55.12" class="difflineminus">-</span>
<a href="#l55.13"></a><span id="l55.13" class="difflineminus">-/* ::::: askSendFormat.xul ::::: */</span>
<a href="#l55.14"></a><span id="l55.14" class="difflineminus">-</span>
<a href="#l55.15"></a><span id="l55.15" class="difflineminus">-#askSendFormat {</span>
<a href="#l55.16"></a><span id="l55.16" class="difflineminus">-  width: 40em;</span>
<a href="#l55.17"></a><span id="l55.17" class="difflineminus">-}</span>
<a href="#l55.18"></a><span id="l55.18" class="difflineminus">-</span>
<a href="#l55.19"></a><span id="l55.19" class="difflineminus">-#askImageBox {</span>
<a href="#l55.20"></a><span id="l55.20" class="difflineminus">- -moz-box-align: start;</span>
<a href="#l55.21"></a><span id="l55.21" class="difflineminus">-}</span>
<a href="#l55.22"></a><span id="l55.22" class="difflineminus">-</span>
<a href="#l55.23"></a><span id="l55.23" class="difflineminus">-#convertYes {</span>
<a href="#l55.24"></a><span id="l55.24" class="difflineminus">-  list-style-image:url(&quot;chrome://global/skin/question-icon.png&quot;);</span>
<a href="#l55.25"></a><span id="l55.25" class="difflineminus">-}</span>
<a href="#l55.26"></a><span id="l55.26" class="difflineminus">-</span>
<a href="#l55.27"></a><span id="l55.27" class="difflineminus">-#convertAltering {</span>
<a href="#l55.28"></a><span id="l55.28" class="difflineminus">-  list-style-image:url(&quot;chrome://global/skin/question-icon.png&quot;);</span>
<a href="#l55.29"></a><span id="l55.29" class="difflineminus">-}</span>
<a href="#l55.30"></a><span id="l55.30" class="difflineminus">-</span>
<a href="#l55.31"></a><span id="l55.31" class="difflineminus">-#convertNo {</span>
<a href="#l55.32"></a><span id="l55.32" class="difflineminus">-  list-style-image:url(&quot;chrome://global/skin/alert-icon.png&quot;);</span>
<a href="#l55.33"></a><span id="l55.33" class="difflineminus">-}</span>
<a href="#l55.34"></a><span id="l55.34" class="difflineminus">-</span>
<a href="#l55.35"></a><span id="l55.35" class="difflineminus">-/* Workaround for bug 50217. Please remove this rule, when this bug is fixed. */</span>
<a href="#l55.36"></a><span id="l55.36" class="difflineminus">-#convertDefault {</span>
<a href="#l55.37"></a><span id="l55.37" class="difflineminus">-  list-style-image:url(&quot;chrome://global/skin/question-icon.png&quot;);</span>
<a href="#l55.38"></a><span id="l55.38" class="difflineminus">-}</span>
<a href="#l55.39"></a><span id="l55.39" class="difflineminus">-</span>
<a href="#l55.40"></a><span id="l55.40" class="difflineminus">-</span>
<a href="#l55.41"></a><span id="l55.41" class="difflineminus">-</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l56.1"></a><span id="l56.1" class="difflineminus">--- a/mail/themes/pinstripe/mail/tabmail.css</span>
<a href="#l56.2"></a><span id="l56.2" class="difflineplus">+++ b/mail/themes/pinstripe/mail/tabmail.css</span>
<a href="#l56.3"></a><span id="l56.3" class="difflineat">@@ -30,26 +30,16 @@</span>
<a href="#l56.4"></a><span id="l56.4">  * and other provisions required by the GPL or the LGPL. If you do not delete</span>
<a href="#l56.5"></a><span id="l56.5">  * the provisions above, a recipient may use your version of this file under</span>
<a href="#l56.6"></a><span id="l56.6">  * the terms of any one of the MPL, the GPL or the LGPL.</span>
<a href="#l56.7"></a><span id="l56.7">  *</span>
<a href="#l56.8"></a><span id="l56.8">  * ***** END LICENSE BLOCK ***** */</span>
<a href="#l56.9"></a><span id="l56.9"> </span>
<a href="#l56.10"></a><span id="l56.10"> /* ::::: tabmail ::::: */</span>
<a href="#l56.11"></a><span id="l56.11"> </span>
<a href="#l56.12"></a><span id="l56.12" class="difflineminus">-/* bring in the proper bindings on OS X */</span>
<a href="#l56.13"></a><span id="l56.13" class="difflineminus">-</span>
<a href="#l56.14"></a><span id="l56.14" class="difflineminus">-.tabmail-tab {</span>
<a href="#l56.15"></a><span id="l56.15" class="difflineminus">-  -moz-binding: url(&quot;chrome://messenger/skin/tabmailBindings.xml#tabmail-tab&quot;) !important;</span>
<a href="#l56.16"></a><span id="l56.16" class="difflineminus">-}</span>
<a href="#l56.17"></a><span id="l56.17" class="difflineminus">-</span>
<a href="#l56.18"></a><span id="l56.18" class="difflineminus">-.tabmail-tabs {</span>
<a href="#l56.19"></a><span id="l56.19" class="difflineminus">-  -moz-binding: url(&quot;chrome://messenger/skin/tabmailBindings.xml#tabmail-tabs&quot;) !important;</span>
<a href="#l56.20"></a><span id="l56.20" class="difflineminus">-}</span>
<a href="#l56.21"></a><span id="l56.21" class="difflineminus">-</span>
<a href="#l56.22"></a><span id="l56.22"> .tabmail-tabs &gt; .tabmail-tab:first-child &gt; .tab-close-button {</span>
<a href="#l56.23"></a><span id="l56.23">   visibility: collapse;</span>
<a href="#l56.24"></a><span id="l56.24"> }</span>
<a href="#l56.25"></a><span id="l56.25"> </span>
<a href="#l56.26"></a><span id="l56.26"> #messengerWindow:not([active=&quot;true&quot;]) .tabmail-strip {</span>
<a href="#l56.27"></a><span id="l56.27">   background-color: #e2e2e2;</span>
<a href="#l56.28"></a><span id="l56.28"> }</span>
<a href="#l56.29"></a><span id="l56.29"> </span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l57.1"></a><span id="l57.1">deleted file mode 100644</span>
<a href="#l57.2"></a><span id="l57.2" class="difflineminus">--- a/mail/themes/pinstripe/mail/tabmailBindings.xml</span>
<a href="#l57.3"></a><span id="l57.3" class="difflineplus">+++ /dev/null</span>
<a href="#l57.4"></a><span id="l57.4" class="difflineat">@@ -1,102 +0,0 @@</span>
<a href="#l57.5"></a><span id="l57.5" class="difflineminus">-&lt;?xml version=&quot;1.0&quot;?&gt;</span>
<a href="#l57.6"></a><span id="l57.6" class="difflineminus">-# ***** BEGIN LICENSE BLOCK *****</span>
<a href="#l57.7"></a><span id="l57.7" class="difflineminus">-# Version: MPL 1.1/GPL 2.0/LGPL 2.1</span>
<a href="#l57.8"></a><span id="l57.8" class="difflineminus">-#</span>
<a href="#l57.9"></a><span id="l57.9" class="difflineminus">-# The contents of this file are subject to the Mozilla Public License Version</span>
<a href="#l57.10"></a><span id="l57.10" class="difflineminus">-# 1.1 (the &quot;License&quot;); you may not use this file except in compliance with</span>
<a href="#l57.11"></a><span id="l57.11" class="difflineminus">-# the License. You may obtain a copy of the License at</span>
<a href="#l57.12"></a><span id="l57.12" class="difflineminus">-# http://www.mozilla.org/MPL/</span>
<a href="#l57.13"></a><span id="l57.13" class="difflineminus">-#</span>
<a href="#l57.14"></a><span id="l57.14" class="difflineminus">-# Software distributed under the License is distributed on an &quot;AS IS&quot; basis,</span>
<a href="#l57.15"></a><span id="l57.15" class="difflineminus">-# WITHOUT WARRANTY OF ANY KIND, either express or implied. See the License</span>
<a href="#l57.16"></a><span id="l57.16" class="difflineminus">-# for the specific language governing rights and limitations under the</span>
<a href="#l57.17"></a><span id="l57.17" class="difflineminus">-# License.</span>
<a href="#l57.18"></a><span id="l57.18" class="difflineminus">-#</span>
<a href="#l57.19"></a><span id="l57.19" class="difflineminus">-# The Original Code is tab mail</span>
<a href="#l57.20"></a><span id="l57.20" class="difflineminus">-#</span>
<a href="#l57.21"></a><span id="l57.21" class="difflineminus">-# The Initial Developer of the Original Code is</span>
<a href="#l57.22"></a><span id="l57.22" class="difflineminus">-#   Scott MacGregor &lt;mscott@mozilla.org&gt;.</span>
<a href="#l57.23"></a><span id="l57.23" class="difflineminus">-# Portions created by the Initial Developer are Copyright (C) 2007</span>
<a href="#l57.24"></a><span id="l57.24" class="difflineminus">-# the Initial Developer. All Rights Reserved.</span>
<a href="#l57.25"></a><span id="l57.25" class="difflineminus">-#</span>
<a href="#l57.26"></a><span id="l57.26" class="difflineminus">-# Contributor(s):</span>
<a href="#l57.27"></a><span id="l57.27" class="difflineminus">-#</span>
<a href="#l57.28"></a><span id="l57.28" class="difflineminus">-# Alternatively, the contents of this file may be used under the terms of</span>
<a href="#l57.29"></a><span id="l57.29" class="difflineminus">-# either the GNU General Public License Version 2 or later (the &quot;GPL&quot;), or</span>
<a href="#l57.30"></a><span id="l57.30" class="difflineminus">-# the GNU Lesser General Public License Version 2.1 or later (the &quot;LGPL&quot;),</span>
<a href="#l57.31"></a><span id="l57.31" class="difflineminus">-# in which case the provisions of the GPL or the LGPL are applicable instead</span>
<a href="#l57.32"></a><span id="l57.32" class="difflineminus">-# of those above. If you wish to allow use of your version of this file only</span>
<a href="#l57.33"></a><span id="l57.33" class="difflineminus">-# under the terms of either the GPL or the LGPL, and not to allow others to</span>
<a href="#l57.34"></a><span id="l57.34" class="difflineminus">-# use your version of this file under the terms of the MPL, indicate your</span>
<a href="#l57.35"></a><span id="l57.35" class="difflineminus">-# decision by deleting the provisions above and replace them with the notice</span>
<a href="#l57.36"></a><span id="l57.36" class="difflineminus">-# and other provisions required by the GPL or the LGPL. If you do not delete</span>
<a href="#l57.37"></a><span id="l57.37" class="difflineminus">-# the provisions above, a recipient may use your version of this file under</span>
<a href="#l57.38"></a><span id="l57.38" class="difflineminus">-# the terms of any one of the MPL, the GPL or the LGPL.</span>
<a href="#l57.39"></a><span id="l57.39" class="difflineminus">-#</span>
<a href="#l57.40"></a><span id="l57.40" class="difflineminus">-# ***** END LICENSE BLOCK *****</span>
<a href="#l57.41"></a><span id="l57.41" class="difflineminus">-</span>
<a href="#l57.42"></a><span id="l57.42" class="difflineminus">-&lt;!DOCTYPE bindings [</span>
<a href="#l57.43"></a><span id="l57.43" class="difflineminus">-&lt;!ENTITY % tabMailDTD SYSTEM &quot;chrome://messenger/locale/tabmail.dtd&quot; &gt;</span>
<a href="#l57.44"></a><span id="l57.44" class="difflineminus">-%tabMailDTD;</span>
<a href="#l57.45"></a><span id="l57.45" class="difflineminus">-&lt;!ENTITY % globalDTD SYSTEM &quot;chrome://global/locale/global.dtd&quot;&gt;</span>
<a href="#l57.46"></a><span id="l57.46" class="difflineminus">-%globalDTD;</span>
<a href="#l57.47"></a><span id="l57.47" class="difflineminus">-]&gt;</span>
<a href="#l57.48"></a><span id="l57.48" class="difflineminus">-</span>
<a href="#l57.49"></a><span id="l57.49" class="difflineminus">-&lt;bindings id=&quot;globalBindings&quot;</span>
<a href="#l57.50"></a><span id="l57.50" class="difflineminus">-   xmlns=&quot;http://www.mozilla.org/xbl&quot;</span>
<a href="#l57.51"></a><span id="l57.51" class="difflineminus">-   xmlns:xul=&quot;http://www.mozilla.org/keymaster/gatekeeper/there.is.only.xul&quot;</span>
<a href="#l57.52"></a><span id="l57.52" class="difflineminus">-   xmlns:xbl=&quot;http://www.mozilla.org/xbl&quot;&gt;</span>
<a href="#l57.53"></a><span id="l57.53" class="difflineminus">-</span>
<a href="#l57.54"></a><span id="l57.54" class="difflineminus">-  &lt;binding id=&quot;tabmail-tab&quot; extends=&quot;chrome://messenger/content/tabmail.xml#tabmail-tab&quot;&gt;</span>
<a href="#l57.55"></a><span id="l57.55" class="difflineminus">-    &lt;content chromedir=&quot;&amp;locale.dir;&quot;</span>
<a href="#l57.56"></a><span id="l57.56" class="difflineminus">-             closetabtext=&quot;&amp;closeTab.label;&quot;&gt;</span>
<a href="#l57.57"></a><span id="l57.57" class="difflineminus">-      &lt;xul:hbox class=&quot;tab-image-left&quot; xbl:inherits=&quot;selected&quot;/&gt;</span>
<a href="#l57.58"></a><span id="l57.58" class="difflineminus">-      &lt;xul:hbox flex=&quot;1&quot; class=&quot;tab-image-middle&quot; align=&quot;center&quot; xbl:inherits=&quot;selected&quot;&gt;</span>
<a href="#l57.59"></a><span id="l57.59" class="difflineminus">-        &lt;xul:image xbl:inherits=&quot;validate,src=image,selected&quot; class=&quot;tab-icon-image&quot;/&gt;</span>
<a href="#l57.60"></a><span id="l57.60" class="difflineminus">-        &lt;xul:label flex=&quot;1&quot; xbl:inherits=&quot;value=label,crop,accesskey&quot; crop=&quot;right&quot; class=&quot;tab-text&quot;/&gt;</span>
<a href="#l57.61"></a><span id="l57.61" class="difflineminus">-      &lt;/xul:hbox&gt;</span>
<a href="#l57.62"></a><span id="l57.62" class="difflineminus">-      &lt;xul:toolbarbutton anonid=&quot;close-button&quot; class=&quot;tab-close-button&quot; tabindex=&quot;-1&quot;/&gt;</span>
<a href="#l57.63"></a><span id="l57.63" class="difflineminus">-        &lt;xul:hbox class=&quot;tab-image-right&quot; xbl:inherits=&quot;selected&quot;/&gt;</span>
<a href="#l57.64"></a><span id="l57.64" class="difflineminus">-    &lt;/content&gt;</span>
<a href="#l57.65"></a><span id="l57.65" class="difflineminus">-  &lt;/binding&gt;</span>
<a href="#l57.66"></a><span id="l57.66" class="difflineminus">-</span>
<a href="#l57.67"></a><span id="l57.67" class="difflineminus">-   &lt;binding id=&quot;tabmail-tabs&quot;</span>
<a href="#l57.68"></a><span id="l57.68" class="difflineminus">-            extends=&quot;chrome://messenger/content/tabmail.xml#tabmail-tabs&quot;&gt;</span>
<a href="#l57.69"></a><span id="l57.69" class="difflineminus">-    &lt;content&gt;</span>
<a href="#l57.70"></a><span id="l57.70" class="difflineminus">-      &lt;xul:stack flex=&quot;1&quot; class=&quot;tabs-stack&quot;&gt;</span>
<a href="#l57.71"></a><span id="l57.71" class="difflineminus">-        &lt;xul:vbox&gt;</span>
<a href="#l57.72"></a><span id="l57.72" class="difflineminus">-          &lt;xul:spacer flex=&quot;1&quot;/&gt;</span>
<a href="#l57.73"></a><span id="l57.73" class="difflineminus">-          &lt;xul:hbox class=&quot;tabs-bottom&quot; align=&quot;center&quot;/&gt;</span>
<a href="#l57.74"></a><span id="l57.74" class="difflineminus">-        &lt;/xul:vbox&gt;</span>
<a href="#l57.75"></a><span id="l57.75" class="difflineminus">-        &lt;xul:vbox&gt;</span>
<a href="#l57.76"></a><span id="l57.76" class="difflineminus">-          &lt;xul:hbox&gt;</span>
<a href="#l57.77"></a><span id="l57.77" class="difflineminus">-            &lt;xul:stack&gt;</span>
<a href="#l57.78"></a><span id="l57.78" class="difflineminus">-              &lt;xul:spacer class=&quot;tabs-left&quot;/&gt;</span>
<a href="#l57.79"></a><span id="l57.79" class="difflineminus">-            &lt;/xul:stack&gt;</span>
<a href="#l57.80"></a><span id="l57.80" class="difflineminus">-            &lt;xul:arrowscrollbox anonid=&quot;arrowscrollbox&quot; orient=&quot;horizontal&quot; flex=&quot;1&quot; style=&quot;min-width: 1px;&quot; class=&quot;tabmail-arrowscrollbox&quot;&gt;</span>
<a href="#l57.81"></a><span id="l57.81" class="difflineminus">-              &lt;children includes=&quot;tab&quot;/&gt;</span>
<a href="#l57.82"></a><span id="l57.82" class="difflineminus">-            &lt;/xul:arrowscrollbox&gt;</span>
<a href="#l57.83"></a><span id="l57.83" class="difflineminus">-            &lt;children/&gt;</span>
<a href="#l57.84"></a><span id="l57.84" class="difflineminus">-            &lt;xul:stack align=&quot;center&quot; pack=&quot;end&quot;&gt;</span>
<a href="#l57.85"></a><span id="l57.85" class="difflineminus">-              &lt;xul:hbox flex=&quot;1&quot; class=&quot;tabs-alltabs-box&quot; </span>
<a href="#l57.86"></a><span id="l57.86" class="difflineminus">-                        anonid=&quot;alltabs-box&quot;/&gt;</span>
<a href="#l57.87"></a><span id="l57.87" class="difflineminus">-              &lt;xul:hbox flex=&quot;1&quot; class=&quot;tabs-alltabs-box-animate&quot; </span>
<a href="#l57.88"></a><span id="l57.88" class="difflineminus">-                        anonid=&quot;alltabs-box-animate&quot;/&gt;</span>
<a href="#l57.89"></a><span id="l57.89" class="difflineminus">-              &lt;xul:toolbarbutton class=&quot;tabs-alltabs-button&quot;</span>
<a href="#l57.90"></a><span id="l57.90" class="difflineminus">-                                 type=&quot;menu&quot;</span>
<a href="#l57.91"></a><span id="l57.91" class="difflineminus">-                                 anonid=&quot;alltabs-button&quot;</span>
<a href="#l57.92"></a><span id="l57.92" class="difflineminus">-                                 tooltipstring=&quot;&amp;listAllTabs.label;&quot;&gt;</span>
<a href="#l57.93"></a><span id="l57.93" class="difflineminus">-                &lt;xul:menupopup class=&quot;tabs-alltabs-popup&quot;</span>
<a href="#l57.94"></a><span id="l57.94" class="difflineminus">-                               anonid=&quot;alltabs-popup&quot; position=&quot;after_end&quot;/&gt;</span>
<a href="#l57.95"></a><span id="l57.95" class="difflineminus">-              &lt;/xul:toolbarbutton&gt;</span>
<a href="#l57.96"></a><span id="l57.96" class="difflineminus">-            &lt;/xul:stack&gt;</span>
<a href="#l57.97"></a><span id="l57.97" class="difflineminus">-            &lt;xul:hbox class=&quot;tabs-closebutton-box&quot; align=&quot;center&quot; pack=&quot;end&quot; anonid=&quot;tabstrip-closebutton&quot;&gt;</span>
<a href="#l57.98"></a><span id="l57.98" class="difflineminus">-              &lt;xul:toolbarbutton class=&quot;close-button tabs-closebutton&quot;/&gt;</span>
<a href="#l57.99"></a><span id="l57.99" class="difflineminus">-            &lt;/xul:hbox&gt;</span>
<a href="#l57.100"></a><span id="l57.100" class="difflineminus">-          &lt;/xul:hbox&gt;</span>
<a href="#l57.101"></a><span id="l57.101" class="difflineminus">-          &lt;xul:spacer class=&quot;tabs-bottom-spacer&quot;/&gt;</span>
<a href="#l57.102"></a><span id="l57.102" class="difflineminus">-        &lt;/xul:vbox&gt;</span>
<a href="#l57.103"></a><span id="l57.103" class="difflineminus">-      &lt;/xul:stack&gt;</span>
<a href="#l57.104"></a><span id="l57.104" class="difflineminus">-    &lt;/content&gt;</span>
<a href="#l57.105"></a><span id="l57.105" class="difflineminus">-  &lt;/binding&gt;</span>
<a href="#l57.106"></a><span id="l57.106" class="difflineminus">-&lt;/bindings&gt;</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l58.1"></a><span id="l58.1" class="difflineminus">--- a/mail/themes/qute/jar.mn</span>
<a href="#l58.2"></a><span id="l58.2" class="difflineplus">+++ b/mail/themes/qute/jar.mn</span>
<a href="#l58.3"></a><span id="l58.3" class="difflineat">@@ -64,17 +64,16 @@ classic.jar:</span>
<a href="#l58.4"></a><span id="l58.4">   skin/classic/messenger/msgSelectOffline.css                 (mail/msgSelectOffline.css)</span>
<a href="#l58.5"></a><span id="l58.5">   skin/classic/messenger/filterDialog.css                     (mail/filterDialog.css)</span>
<a href="#l58.6"></a><span id="l58.6">   skin/classic/messenger/dialogs.css                          (mail/dialogs.css)</span>
<a href="#l58.7"></a><span id="l58.7">   skin/classic/messenger/multimessageview.css                 (mail/multimessageview.css)</span>
<a href="#l58.8"></a><span id="l58.8">   skin/classic/messenger/glodaFacetView.css                   (mail/glodaFacetView.css)</span>
<a href="#l58.9"></a><span id="l58.9">   skin/classic/messenger/icons/exclude.png                    (mail/icons/exclude.png)</span>
<a href="#l58.10"></a><span id="l58.10">   skin/classic/messenger/icons/exclude-selected.png           (mail/icons/exclude-selected.png)</span>
<a href="#l58.11"></a><span id="l58.11">   skin/classic/messenger/newmailalert.css                     (mail/newmailalert.css)</span>
<a href="#l58.12"></a><span id="l58.12" class="difflineminus">-* skin/classic/messenger/tabmailBindings.xml                  (mail/tabmailBindings.xml)</span>
<a href="#l58.13"></a><span id="l58.13">   skin/classic/messenger/tabmail.css                          (mail/tabmail.css)</span>
<a href="#l58.14"></a><span id="l58.14">   skin/classic/messenger/editContactOverlay.css               (mail/editContactOverlay.css)</span>
<a href="#l58.15"></a><span id="l58.15">   skin/classic/messenger/starred48.png                        (mail/starred48.png)</span>
<a href="#l58.16"></a><span id="l58.16">   skin/classic/messenger/contactStarred.png                   (mail/contactStarred.png)</span>
<a href="#l58.17"></a><span id="l58.17">   skin/classic/messenger/starContact.png                      (mail/starContact.png)</span>
<a href="#l58.18"></a><span id="l58.18">   skin/classic/messenger/activity/activity.css                   (mail/activity/activity.css)</span>
<a href="#l58.19"></a><span id="l58.19">   skin/classic/messenger/activity/buttons.png                    (mail/activity/buttons.png)</span>
<a href="#l58.20"></a><span id="l58.20">   skin/classic/messenger/activity/defaultProcessIcon.png         (mail/activity/defaultProcessIcon.png)</span>
<a href="#l58.21"></a><span id="l58.21" class="difflineat">@@ -258,17 +257,16 @@ classic.jar:</span>
<a href="#l58.22"></a><span id="l58.22">   skin/classic/aero/messenger/msgSelectOffline.css                 (mail/msgSelectOffline.css)</span>
<a href="#l58.23"></a><span id="l58.23">   skin/classic/aero/messenger/filterDialog.css                     (mail/filterDialog.css)</span>
<a href="#l58.24"></a><span id="l58.24">   skin/classic/aero/messenger/dialogs.css                          (mail/dialogs.css)</span>
<a href="#l58.25"></a><span id="l58.25">   skin/classic/aero/messenger/multimessageview.css                 (mail/multimessageview.css)</span>
<a href="#l58.26"></a><span id="l58.26">   skin/classic/aero/messenger/glodaFacetView.css                   (mail/glodaFacetView.css)</span>
<a href="#l58.27"></a><span id="l58.27">   skin/classic/aero/messenger/icons/exclude.png                    (mail/icons/exclude.png)</span>
<a href="#l58.28"></a><span id="l58.28">   skin/classic/aero/messenger/icons/exclude-selected.png           (mail/icons/exclude-selected.png)</span>
<a href="#l58.29"></a><span id="l58.29">   skin/classic/aero/messenger/newmailalert.css                     (mail/newmailalert.css)</span>
<a href="#l58.30"></a><span id="l58.30" class="difflineminus">-* skin/classic/aero/messenger/tabmailBindings.xml                  (mail/tabmailBindings.xml)</span>
<a href="#l58.31"></a><span id="l58.31">   skin/classic/aero/messenger/tabmail.css                          (mail/tabmail.css)</span>
<a href="#l58.32"></a><span id="l58.32">   skin/classic/aero/messenger/editContactOverlay.css               (mail/editContactOverlay.css)</span>
<a href="#l58.33"></a><span id="l58.33">   skin/classic/aero/messenger/starred48.png                        (mail/starred48.png)</span>
<a href="#l58.34"></a><span id="l58.34">   skin/classic/aero/messenger/contactStarred.png                   (mail/contactStarred.png)</span>
<a href="#l58.35"></a><span id="l58.35">   skin/classic/aero/messenger/starContact.png                      (mail/starContact.png)</span>
<a href="#l58.36"></a><span id="l58.36">   skin/classic/aero/messenger/activity/activity.css                   (mail/activity/activity.css)</span>
<a href="#l58.37"></a><span id="l58.37">   skin/classic/aero/messenger/activity/buttons.png                    (mail/activity/buttons.png)</span>
<a href="#l58.38"></a><span id="l58.38">   skin/classic/aero/messenger/activity/defaultProcessIcon.png         (mail/activity/defaultProcessIcon-aero.png)</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l59.1"></a><span id="l59.1" class="difflineminus">--- a/mail/themes/qute/mail/dialogs.css</span>
<a href="#l59.2"></a><span id="l59.2" class="difflineplus">+++ b/mail/themes/qute/mail/dialogs.css</span>
<a href="#l59.3"></a><span id="l59.3" class="difflineat">@@ -62,32 +62,8 @@ menu.push[open=&quot;true&quot;] {</span>
<a href="#l59.4"></a><span id="l59.4">   -moz-padding-end: 1px;</span>
<a href="#l59.5"></a><span id="l59.5"> }</span>
<a href="#l59.6"></a><span id="l59.6"> </span>
<a href="#l59.7"></a><span id="l59.7"> menu.push[disabled=&quot;true&quot;],</span>
<a href="#l59.8"></a><span id="l59.8"> menu.push[disabled=&quot;true&quot;]:hover,</span>
<a href="#l59.9"></a><span id="l59.9"> menu.push[disabled=&quot;true&quot;]:hover:active {</span>
<a href="#l59.10"></a><span id="l59.10">   color: GrayText;</span>
<a href="#l59.11"></a><span id="l59.11"> }</span>
<a href="#l59.12"></a><span id="l59.12" class="difflineminus">-</span>
<a href="#l59.13"></a><span id="l59.13" class="difflineminus">-/* ::::: askSendFormat.xul ::::: */</span>
<a href="#l59.14"></a><span id="l59.14" class="difflineminus">-</span>
<a href="#l59.15"></a><span id="l59.15" class="difflineminus">-#askSendFormat {</span>
<a href="#l59.16"></a><span id="l59.16" class="difflineminus">-  width: 40em;</span>
<a href="#l59.17"></a><span id="l59.17" class="difflineminus">-}</span>
<a href="#l59.18"></a><span id="l59.18" class="difflineminus">-</span>
<a href="#l59.19"></a><span id="l59.19" class="difflineminus">-#askImageBox {</span>
<a href="#l59.20"></a><span id="l59.20" class="difflineminus">- -moz-box-align: start;</span>
<a href="#l59.21"></a><span id="l59.21" class="difflineminus">-}</span>
<a href="#l59.22"></a><span id="l59.22" class="difflineminus">-</span>
<a href="#l59.23"></a><span id="l59.23" class="difflineminus">-#convertYes,</span>
<a href="#l59.24"></a><span id="l59.24" class="difflineminus">-#convertAltering {</span>
<a href="#l59.25"></a><span id="l59.25" class="difflineminus">-  list-style-image:url(&quot;chrome://global/skin/icons/Question.png&quot;);</span>
<a href="#l59.26"></a><span id="l59.26" class="difflineminus">-}</span>
<a href="#l59.27"></a><span id="l59.27" class="difflineminus">-</span>
<a href="#l59.28"></a><span id="l59.28" class="difflineminus">-#convertNo {</span>
<a href="#l59.29"></a><span id="l59.29" class="difflineminus">-  list-style-image:url(&quot;chrome://global/skin/icons/Warning.png&quot;);</span>
<a href="#l59.30"></a><span id="l59.30" class="difflineminus">-}</span>
<a href="#l59.31"></a><span id="l59.31" class="difflineminus">-</span>
<a href="#l59.32"></a><span id="l59.32" class="difflineminus">-/* Workaround for bug 50217. Please remove this rule, when this bug is fixed. */</span>
<a href="#l59.33"></a><span id="l59.33" class="difflineminus">-#convertDefault {</span>
<a href="#l59.34"></a><span id="l59.34" class="difflineminus">-  list-style-image:url(&quot;chrome://global/skin/icons/Question.png&quot;);</span>
<a href="#l59.35"></a><span id="l59.35" class="difflineminus">-}</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l60.1"></a><span id="l60.1" class="difflineminus">--- a/mail/themes/qute/mail/tabmail.css</span>
<a href="#l60.2"></a><span id="l60.2" class="difflineplus">+++ b/mail/themes/qute/mail/tabmail.css</span>
<a href="#l60.3"></a><span id="l60.3" class="difflineat">@@ -33,17 +33,16 @@</span>
<a href="#l60.4"></a><span id="l60.4">  *</span>
<a href="#l60.5"></a><span id="l60.5">  * ***** END LICENSE BLOCK ***** */</span>
<a href="#l60.6"></a><span id="l60.6"> </span>
<a href="#l60.7"></a><span id="l60.7"> /**</span>
<a href="#l60.8"></a><span id="l60.8">  * Tabmail Tabs</span>
<a href="#l60.9"></a><span id="l60.9">  */</span>
<a href="#l60.10"></a><span id="l60.10"> </span>
<a href="#l60.11"></a><span id="l60.11"> .tabmail-tabs {</span>
<a href="#l60.12"></a><span id="l60.12" class="difflineminus">-  -moz-binding: url(&quot;chrome://messenger/skin/tabmailBindings.xml#tabmail-tabs&quot;) !important;</span>
<a href="#l60.13"></a><span id="l60.13">   padding-top: 0px;</span>
<a href="#l60.14"></a><span id="l60.14">   background: -moz-dialog url(&quot;chrome://messenger/skin/tabmail-tabs-bkgnd.png&quot;) !important;</span>
<a href="#l60.15"></a><span id="l60.15">   -moz-padding-start: 0px;</span>
<a href="#l60.16"></a><span id="l60.16"> }</span>
<a href="#l60.17"></a><span id="l60.17"> </span>
<a href="#l60.18"></a><span id="l60.18"> .tabmail-tabs[overflow=&quot;true&quot;] {</span>
<a href="#l60.19"></a><span id="l60.19">   -moz-padding-start: 0px;</span>
<a href="#l60.20"></a><span id="l60.20"> }</span>
<a href="#l60.21"></a><span id="l60.21" class="difflineat">@@ -53,17 +52,16 @@</span>
<a href="#l60.22"></a><span id="l60.22"> }</span>
<a href="#l60.23"></a><span id="l60.23"> </span>
<a href="#l60.24"></a><span id="l60.24"> /**</span>
<a href="#l60.25"></a><span id="l60.25">  * Tab</span>
<a href="#l60.26"></a><span id="l60.26">  */</span>
<a href="#l60.27"></a><span id="l60.27"> </span>
<a href="#l60.28"></a><span id="l60.28"> .tabmail-tab {</span>
<a href="#l60.29"></a><span id="l60.29">   -moz-appearance: none !important;</span>
<a href="#l60.30"></a><span id="l60.30" class="difflineminus">-  -moz-binding: url(&quot;chrome://messenger/skin/tabmailBindings.xml#tabmail-tab&quot;) !important;</span>
<a href="#l60.31"></a><span id="l60.31">   background: transparent !important;</span>
<a href="#l60.32"></a><span id="l60.32">   margin: 0px 0px 1px !important;</span>
<a href="#l60.33"></a><span id="l60.33">   padding: 0px !important;</span>
<a href="#l60.34"></a><span id="l60.34">   border: none !important;</span>
<a href="#l60.35"></a><span id="l60.35">   height: 22px !important;</span>
<a href="#l60.36"></a><span id="l60.36"> }</span>
<a href="#l60.37"></a><span id="l60.37"> </span>
<a href="#l60.38"></a><span id="l60.38"> .tabmail-tab &gt; .tab-image-middle {</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l61.1"></a><span id="l61.1">deleted file mode 100644</span>
<a href="#l61.2"></a><span id="l61.2" class="difflineminus">--- a/mail/themes/qute/mail/tabmailBindings.xml</span>
<a href="#l61.3"></a><span id="l61.3" class="difflineplus">+++ /dev/null</span>
<a href="#l61.4"></a><span id="l61.4" class="difflineat">@@ -1,107 +0,0 @@</span>
<a href="#l61.5"></a><span id="l61.5" class="difflineminus">-&lt;?xml version=&quot;1.0&quot;?&gt;</span>
<a href="#l61.6"></a><span id="l61.6" class="difflineminus">-# ***** BEGIN LICENSE BLOCK *****</span>
<a href="#l61.7"></a><span id="l61.7" class="difflineminus">-# Version: MPL 1.1/GPL 2.0/LGPL 2.1</span>
<a href="#l61.8"></a><span id="l61.8" class="difflineminus">-#</span>
<a href="#l61.9"></a><span id="l61.9" class="difflineminus">-# The contents of this file are subject to the Mozilla Public License Version</span>
<a href="#l61.10"></a><span id="l61.10" class="difflineminus">-# 1.1 (the &quot;License&quot;); you may not use this file except in compliance with</span>
<a href="#l61.11"></a><span id="l61.11" class="difflineminus">-# the License. You may obtain a copy of the License at</span>
<a href="#l61.12"></a><span id="l61.12" class="difflineminus">-# http://www.mozilla.org/MPL/</span>
<a href="#l61.13"></a><span id="l61.13" class="difflineminus">-#</span>
<a href="#l61.14"></a><span id="l61.14" class="difflineminus">-# Software distributed under the License is distributed on an &quot;AS IS&quot; basis,</span>
<a href="#l61.15"></a><span id="l61.15" class="difflineminus">-# WITHOUT WARRANTY OF ANY KIND, either express or implied. See the License</span>
<a href="#l61.16"></a><span id="l61.16" class="difflineminus">-# for the specific language governing rights and limitations under the</span>
<a href="#l61.17"></a><span id="l61.17" class="difflineminus">-# License.</span>
<a href="#l61.18"></a><span id="l61.18" class="difflineminus">-#</span>
<a href="#l61.19"></a><span id="l61.19" class="difflineminus">-# The Original Code is tab mail</span>
<a href="#l61.20"></a><span id="l61.20" class="difflineminus">-#</span>
<a href="#l61.21"></a><span id="l61.21" class="difflineminus">-# The Initial Developer of the Original Code is</span>
<a href="#l61.22"></a><span id="l61.22" class="difflineminus">-#   Scott MacGregor &lt;mscott@mozilla.org&gt;.</span>
<a href="#l61.23"></a><span id="l61.23" class="difflineminus">-# Portions created by the Initial Developer are Copyright (C) 2007</span>
<a href="#l61.24"></a><span id="l61.24" class="difflineminus">-# the Initial Developer. All Rights Reserved.</span>
<a href="#l61.25"></a><span id="l61.25" class="difflineminus">-#</span>
<a href="#l61.26"></a><span id="l61.26" class="difflineminus">-# Contributor(s):</span>
<a href="#l61.27"></a><span id="l61.27" class="difflineminus">-#</span>
<a href="#l61.28"></a><span id="l61.28" class="difflineminus">-# Alternatively, the contents of this file may be used under the terms of</span>
<a href="#l61.29"></a><span id="l61.29" class="difflineminus">-# either the GNU General Public License Version 2 or later (the &quot;GPL&quot;), or</span>
<a href="#l61.30"></a><span id="l61.30" class="difflineminus">-# the GNU Lesser General Public License Version 2.1 or later (the &quot;LGPL&quot;),</span>
<a href="#l61.31"></a><span id="l61.31" class="difflineminus">-# in which case the provisions of the GPL or the LGPL are applicable instead</span>
<a href="#l61.32"></a><span id="l61.32" class="difflineminus">-# of those above. If you wish to allow use of your version of this file only</span>
<a href="#l61.33"></a><span id="l61.33" class="difflineminus">-# under the terms of either the GPL or the LGPL, and not to allow others to</span>
<a href="#l61.34"></a><span id="l61.34" class="difflineminus">-# use your version of this file under the terms of the MPL, indicate your</span>
<a href="#l61.35"></a><span id="l61.35" class="difflineminus">-# decision by deleting the provisions above and replace them with the notice</span>
<a href="#l61.36"></a><span id="l61.36" class="difflineminus">-# and other provisions required by the GPL or the LGPL. If you do not delete</span>
<a href="#l61.37"></a><span id="l61.37" class="difflineminus">-# the provisions above, a recipient may use your version of this file under</span>
<a href="#l61.38"></a><span id="l61.38" class="difflineminus">-# the terms of any one of the MPL, the GPL or the LGPL.</span>
<a href="#l61.39"></a><span id="l61.39" class="difflineminus">-#</span>
<a href="#l61.40"></a><span id="l61.40" class="difflineminus">-# ***** END LICENSE BLOCK *****</span>
<a href="#l61.41"></a><span id="l61.41" class="difflineminus">-</span>
<a href="#l61.42"></a><span id="l61.42" class="difflineminus">-&lt;!DOCTYPE bindings [</span>
<a href="#l61.43"></a><span id="l61.43" class="difflineminus">-&lt;!ENTITY % tabMailDTD SYSTEM &quot;chrome://messenger/locale/tabmail.dtd&quot; &gt;</span>
<a href="#l61.44"></a><span id="l61.44" class="difflineminus">-%tabMailDTD;</span>
<a href="#l61.45"></a><span id="l61.45" class="difflineminus">-&lt;!ENTITY % globalDTD SYSTEM &quot;chrome://global/locale/global.dtd&quot;&gt;</span>
<a href="#l61.46"></a><span id="l61.46" class="difflineminus">-%globalDTD;</span>
<a href="#l61.47"></a><span id="l61.47" class="difflineminus">-]&gt;</span>
<a href="#l61.48"></a><span id="l61.48" class="difflineminus">-</span>
<a href="#l61.49"></a><span id="l61.49" class="difflineminus">-&lt;bindings id=&quot;globalBindings&quot;</span>
<a href="#l61.50"></a><span id="l61.50" class="difflineminus">-   xmlns=&quot;http://www.mozilla.org/xbl&quot;</span>
<a href="#l61.51"></a><span id="l61.51" class="difflineminus">-   xmlns:xul=&quot;http://www.mozilla.org/keymaster/gatekeeper/there.is.only.xul&quot;</span>
<a href="#l61.52"></a><span id="l61.52" class="difflineminus">-   xmlns:xbl=&quot;http://www.mozilla.org/xbl&quot;&gt;</span>
<a href="#l61.53"></a><span id="l61.53" class="difflineminus">-</span>
<a href="#l61.54"></a><span id="l61.54" class="difflineminus">-  &lt;binding id=&quot;tabmail-tab&quot; extends=&quot;chrome://messenger/content/tabmail.xml#tabmail-tab&quot;&gt;</span>
<a href="#l61.55"></a><span id="l61.55" class="difflineminus">-    &lt;content chromedir=&quot;&amp;locale.dir;&quot;</span>
<a href="#l61.56"></a><span id="l61.56" class="difflineminus">-             closetabtext=&quot;&amp;closeTab.label;&quot;&gt;</span>
<a href="#l61.57"></a><span id="l61.57" class="difflineminus">-      &lt;xul:hbox class=&quot;tab-image-left&quot; xbl:inherits=&quot;selected&quot;/&gt;</span>
<a href="#l61.58"></a><span id="l61.58" class="difflineminus">-      &lt;xul:hbox flex=&quot;1&quot; class=&quot;tab-image-middle&quot; align=&quot;center&quot; xbl:inherits=&quot;selected&quot;&gt;</span>
<a href="#l61.59"></a><span id="l61.59" class="difflineminus">-        &lt;xul:image xbl:inherits=&quot;validate,src=image&quot; class=&quot;tab-icon-image&quot;/&gt;</span>
<a href="#l61.60"></a><span id="l61.60" class="difflineminus">-        &lt;xul:label flex=&quot;1&quot; xbl:inherits=&quot;value=label,crop,accesskey&quot; crop=&quot;right&quot; class=&quot;tab-text&quot;/&gt;</span>
<a href="#l61.61"></a><span id="l61.61" class="difflineminus">-      &lt;/xul:hbox&gt;</span>
<a href="#l61.62"></a><span id="l61.62" class="difflineminus">-      &lt;xul:toolbarbutton anonid=&quot;close-button&quot; class=&quot;tab-close-button&quot; tabindex=&quot;-1&quot;/&gt;</span>
<a href="#l61.63"></a><span id="l61.63" class="difflineminus">-        &lt;xul:hbox class=&quot;tab-image-right&quot; xbl:inherits=&quot;selected&quot;/&gt;</span>
<a href="#l61.64"></a><span id="l61.64" class="difflineminus">-    &lt;/content&gt;</span>
<a href="#l61.65"></a><span id="l61.65" class="difflineminus">-  &lt;/binding&gt;</span>
<a href="#l61.66"></a><span id="l61.66" class="difflineminus">-</span>
<a href="#l61.67"></a><span id="l61.67" class="difflineminus">-   &lt;binding id=&quot;tabmail-tabs&quot;</span>
<a href="#l61.68"></a><span id="l61.68" class="difflineminus">-            extends=&quot;chrome://messenger/content/tabmail.xml#tabmail-tabs&quot;&gt;</span>
<a href="#l61.69"></a><span id="l61.69" class="difflineminus">-    &lt;content&gt;</span>
<a href="#l61.70"></a><span id="l61.70" class="difflineminus">-      &lt;xul:stack flex=&quot;1&quot; class=&quot;tabs-stack&quot;&gt;</span>
<a href="#l61.71"></a><span id="l61.71" class="difflineminus">-        &lt;xul:vbox&gt;</span>
<a href="#l61.72"></a><span id="l61.72" class="difflineminus">-          &lt;xul:spacer flex=&quot;1&quot;/&gt;</span>
<a href="#l61.73"></a><span id="l61.73" class="difflineminus">-          &lt;xul:hbox class=&quot;tabs-bottom&quot; align=&quot;center&quot;/&gt;</span>
<a href="#l61.74"></a><span id="l61.74" class="difflineminus">-        &lt;/xul:vbox&gt;</span>
<a href="#l61.75"></a><span id="l61.75" class="difflineminus">-        &lt;xul:vbox&gt;</span>
<a href="#l61.76"></a><span id="l61.76" class="difflineminus">-          &lt;xul:hbox&gt;</span>
<a href="#l61.77"></a><span id="l61.77" class="difflineminus">-            &lt;xul:stack&gt;</span>
<a href="#l61.78"></a><span id="l61.78" class="difflineminus">-              &lt;xul:spacer class=&quot;tabs-left&quot;/&gt;</span>
<a href="#l61.79"></a><span id="l61.79" class="difflineminus">-            &lt;/xul:stack&gt;</span>
<a href="#l61.80"></a><span id="l61.80" class="difflineminus">-            &lt;xul:arrowscrollbox anonid=&quot;arrowscrollbox&quot;</span>
<a href="#l61.81"></a><span id="l61.81" class="difflineminus">-                                orient=&quot;horizontal&quot;</span>
<a href="#l61.82"></a><span id="l61.82" class="difflineminus">-                                flex=&quot;1&quot;</span>
<a href="#l61.83"></a><span id="l61.83" class="difflineminus">-                                style=&quot;min-width: 1px;&quot;</span>
<a href="#l61.84"></a><span id="l61.84" class="difflineminus">-                                chromedir=&quot;&amp;locale.dir;&quot;</span>
<a href="#l61.85"></a><span id="l61.85" class="difflineminus">-                                class=&quot;tabmail-arrowscrollbox&quot;&gt;</span>
<a href="#l61.86"></a><span id="l61.86" class="difflineminus">-              &lt;children includes=&quot;tab&quot;/&gt;</span>
<a href="#l61.87"></a><span id="l61.87" class="difflineminus">-            &lt;/xul:arrowscrollbox&gt;</span>
<a href="#l61.88"></a><span id="l61.88" class="difflineminus">-            &lt;children/&gt;</span>
<a href="#l61.89"></a><span id="l61.89" class="difflineminus">-            &lt;xul:stack align=&quot;center&quot; pack=&quot;end&quot; chromedir=&quot;&amp;locale.dir;&quot;&gt;</span>
<a href="#l61.90"></a><span id="l61.90" class="difflineminus">-              &lt;xul:hbox flex=&quot;1&quot;</span>
<a href="#l61.91"></a><span id="l61.91" class="difflineminus">-                        class=&quot;tabs-alltabs-box&quot;</span>
<a href="#l61.92"></a><span id="l61.92" class="difflineminus">-                        anonid=&quot;alltabs-box&quot;/&gt;</span>
<a href="#l61.93"></a><span id="l61.93" class="difflineminus">-              &lt;xul:hbox flex=&quot;1&quot; class=&quot;tabs-alltabs-box-animate&quot;</span>
<a href="#l61.94"></a><span id="l61.94" class="difflineminus">-                        anonid=&quot;alltabs-box-animate&quot;/&gt;</span>
<a href="#l61.95"></a><span id="l61.95" class="difflineminus">-              &lt;xul:toolbarbutton class=&quot;tabs-alltabs-button&quot; type=&quot;menu&quot;</span>
<a href="#l61.96"></a><span id="l61.96" class="difflineminus">-                                 anonid=&quot;alltabs-button&quot;</span>
<a href="#l61.97"></a><span id="l61.97" class="difflineminus">-                                 tooltipstring=&quot;&amp;listAllTabs.label;&quot;&gt;</span>
<a href="#l61.98"></a><span id="l61.98" class="difflineminus">-                &lt;xul:menupopup class=&quot;tabs-alltabs-popup&quot;</span>
<a href="#l61.99"></a><span id="l61.99" class="difflineminus">-                               anonid=&quot;alltabs-popup&quot; position=&quot;after_end&quot;/&gt;</span>
<a href="#l61.100"></a><span id="l61.100" class="difflineminus">-              &lt;/xul:toolbarbutton&gt;</span>
<a href="#l61.101"></a><span id="l61.101" class="difflineminus">-            &lt;/xul:stack&gt;</span>
<a href="#l61.102"></a><span id="l61.102" class="difflineminus">-            &lt;xul:hbox class=&quot;tabs-closebutton-box&quot; align=&quot;center&quot; pack=&quot;end&quot; anonid=&quot;tabstrip-closebutton&quot;&gt;</span>
<a href="#l61.103"></a><span id="l61.103" class="difflineminus">-              &lt;xul:toolbarbutton class=&quot;close-button tabs-closebutton&quot;/&gt;</span>
<a href="#l61.104"></a><span id="l61.104" class="difflineminus">-            &lt;/xul:hbox&gt;</span>
<a href="#l61.105"></a><span id="l61.105" class="difflineminus">-          &lt;/xul:hbox&gt;</span>
<a href="#l61.106"></a><span id="l61.106" class="difflineminus">-          &lt;xul:spacer class=&quot;tabs-bottom-spacer&quot;/&gt;</span>
<a href="#l61.107"></a><span id="l61.107" class="difflineminus">-        &lt;/xul:vbox&gt;</span>
<a href="#l61.108"></a><span id="l61.108" class="difflineminus">-      &lt;/xul:stack&gt;</span>
<a href="#l61.109"></a><span id="l61.109" class="difflineminus">-    &lt;/content&gt;</span>
<a href="#l61.110"></a><span id="l61.110" class="difflineminus">-  &lt;/binding&gt;</span>
<a href="#l61.111"></a><span id="l61.111" class="difflineminus">-&lt;/bindings&gt;</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l62.1"></a><span id="l62.1" class="difflineminus">--- a/mailnews/addrbook/content/abCardOverlay.xul</span>
<a href="#l62.2"></a><span id="l62.2" class="difflineplus">+++ b/mailnews/addrbook/content/abCardOverlay.xul</span>
<a href="#l62.3"></a><span id="l62.3" class="difflineat">@@ -388,72 +388,49 @@</span>
<a href="#l62.4"></a><span id="l62.4">           &lt;/hbox&gt;</span>
<a href="#l62.5"></a><span id="l62.5">         &lt;/vbox&gt;</span>
<a href="#l62.6"></a><span id="l62.6">         &lt;label control=&quot;Notes&quot; value=&quot;&amp;Notes.label;&quot;</span>
<a href="#l62.7"></a><span id="l62.7">                accesskey=&quot;&amp;Notes.accesskey;&quot;/&gt;</span>
<a href="#l62.8"></a><span id="l62.8">         &lt;textbox id=&quot;Notes&quot; multiline=&quot;true&quot; wrap=&quot;virtual&quot; flex=&quot;1&quot;/&gt;</span>
<a href="#l62.9"></a><span id="l62.9">       &lt;/vbox&gt;</span>
<a href="#l62.10"></a><span id="l62.10"> </span>
<a href="#l62.11"></a><span id="l62.11">       &lt;!-- ** Photo Tab ** --&gt;</span>
<a href="#l62.12"></a><span id="l62.12" class="difflineminus">-      &lt;vbox id=&quot;abPhotoTab&quot; &gt;</span>
<a href="#l62.13"></a><span id="l62.13" class="difflineminus">-        &lt;hbox flex=&quot;1&quot;&gt;</span>
<a href="#l62.14"></a><span id="l62.14" class="difflineminus">-          &lt;vbox align=&quot;left&quot;&gt;</span>
<a href="#l62.15"></a><span id="l62.15" class="difflineminus">-            &lt;spacer flex=&quot;1&quot;/&gt;</span>
<a href="#l62.16"></a><span id="l62.16" class="difflineminus">-            &lt;hbox id=&quot;photoBox&quot; style=&quot;min-width: 25ch; max-width: 25ch;&quot;&gt;</span>
<a href="#l62.17"></a><span id="l62.17" class="difflineminus">-              &lt;spacer flex=&quot;1&quot;/&gt;</span>
<a href="#l62.18"></a><span id="l62.18" class="difflineminus">-              &lt;html:img align=&quot;center&quot; src=&quot;&quot; id=&quot;photo&quot;</span>
<a href="#l62.19"></a><span id="l62.19" class="difflineminus">-                        style=&quot;max-width: 25ch; max-height: 25ch; min-width: 1ch;&quot;/&gt;</span>
<a href="#l62.20"></a><span id="l62.20" class="difflineminus">-              &lt;spacer flex=&quot;1&quot;/&gt;</span>
<a href="#l62.21"></a><span id="l62.21" class="difflineplus">+      &lt;hbox id=&quot;abPhotoTab&quot; align=&quot;center&quot;&gt;</span>
<a href="#l62.22"></a><span id="l62.22" class="difflineplus">+        &lt;description style=&quot;min-width: 25ch; max-width: 25ch; text-align: center&quot;&gt;</span>
<a href="#l62.23"></a><span id="l62.23" class="difflineplus">+          &lt;html:img id=&quot;photo&quot; style=&quot;max-width: 25ch; max-height: 25ch;&quot;/&gt;</span>
<a href="#l62.24"></a><span id="l62.24" class="difflineplus">+        &lt;/description&gt;</span>
<a href="#l62.25"></a><span id="l62.25" class="difflineplus">+        &lt;groupbox flex=&quot;1&quot;&gt;</span>
<a href="#l62.26"></a><span id="l62.26" class="difflineplus">+          &lt;caption label=&quot;&amp;PhotoDesc.label;&quot;/&gt;</span>
<a href="#l62.27"></a><span id="l62.27" class="difflineplus">+          &lt;radiogroup id=&quot;PhotoType&quot; onselect=&quot;updatePhoto();&quot;&gt;</span>
<a href="#l62.28"></a><span id="l62.28" class="difflineplus">+            &lt;radio value=&quot;generic&quot; label=&quot;&amp;GenericPhoto.label;&quot;</span>
<a href="#l62.29"></a><span id="l62.29" class="difflineplus">+                   accesskey=&quot;&amp;GenericPhoto.accesskey;&quot;/&gt;</span>
<a href="#l62.30"></a><span id="l62.30" class="difflineplus">+            &lt;menulist id=&quot;GenericPhotoList&quot; class=&quot;indent&quot; flex=&quot;1&quot;</span>
<a href="#l62.31"></a><span id="l62.31" class="difflineplus">+                      oncommand=&quot;updatePhoto('generic');&quot;&gt;</span>
<a href="#l62.32"></a><span id="l62.32" class="difflineplus">+              &lt;menupopup&gt;</span>
<a href="#l62.33"></a><span id="l62.33" class="difflineplus">+                &lt;menuitem label=&quot;&amp;DefaultPhoto.label;&quot; selected=&quot;true&quot;</span>
<a href="#l62.34"></a><span id="l62.34" class="difflineplus">+                          value=&quot;chrome://messenger/skin/addressbook/icons/contact-generic.png&quot;</span>
<a href="#l62.35"></a><span id="l62.35" class="difflineplus">+                          image=&quot;chrome://messenger/skin/addressbook/icons/contact-generic-tiny.png&quot;/&gt;</span>
<a href="#l62.36"></a><span id="l62.36" class="difflineplus">+              &lt;/menupopup&gt;</span>
<a href="#l62.37"></a><span id="l62.37" class="difflineplus">+            &lt;/menulist&gt;</span>
<a href="#l62.38"></a><span id="l62.38" class="difflineplus">+            &lt;radio value=&quot;file&quot; label=&quot;&amp;PhotoFile.label;&quot;</span>
<a href="#l62.39"></a><span id="l62.39" class="difflineplus">+                   accesskey=&quot;&amp;PhotoFile.accesskey;&quot;/&gt;</span>
<a href="#l62.40"></a><span id="l62.40" class="difflineplus">+            &lt;hbox class=&quot;indent&quot;&gt;</span>
<a href="#l62.41"></a><span id="l62.41" class="difflineplus">+              &lt;filefield id=&quot;PhotoFile&quot; maxlength=&quot;255&quot; flex=&quot;1&quot;/&gt;</span>
<a href="#l62.42"></a><span id="l62.42" class="difflineplus">+              &lt;button oncommand=&quot;browsePhoto();&quot; id=&quot;BrowsePhoto&quot;</span>
<a href="#l62.43"></a><span id="l62.43" class="difflineplus">+                      label=&quot;&amp;BrowsePhoto.label;&quot;</span>
<a href="#l62.44"></a><span id="l62.44" class="difflineplus">+                      accesskey=&quot;&amp;BrowsePhoto.accesskey;&quot;/&gt;</span>
<a href="#l62.45"></a><span id="l62.45">             &lt;/hbox&gt;</span>
<a href="#l62.46"></a><span id="l62.46" class="difflineminus">-            &lt;spacer flex=&quot;1&quot;/&gt;</span>
<a href="#l62.47"></a><span id="l62.47" class="difflineminus">-          &lt;/vbox&gt;</span>
<a href="#l62.48"></a><span id="l62.48" class="difflineminus">-          &lt;vbox&gt;</span>
<a href="#l62.49"></a><span id="l62.49" class="difflineminus">-            &lt;command id=&quot;PhotoCmd&quot; oncommand=&quot;updatePhoto();&quot;/&gt;</span>
<a href="#l62.50"></a><span id="l62.50" class="difflineminus">-            &lt;spacer flex=&quot;1&quot;/&gt;</span>
<a href="#l62.51"></a><span id="l62.51" class="difflineminus">-            &lt;groupbox flex=&quot;1&quot;&gt;</span>
<a href="#l62.52"></a><span id="l62.52" class="difflineminus">-              &lt;caption label=&quot;&amp;PhotoDesc.label;&quot;/&gt;</span>
<a href="#l62.53"></a><span id="l62.53" class="difflineminus">-              &lt;radiogroup id=&quot;PhotoType&quot;&gt;</span>
<a href="#l62.54"></a><span id="l62.54" class="difflineminus">-                &lt;radio id=&quot;generic&quot; label=&quot;&amp;GenericPhoto.label;&quot;</span>
<a href="#l62.55"></a><span id="l62.55" class="difflineminus">-                       command=&quot;PhotoCmd&quot;</span>
<a href="#l62.56"></a><span id="l62.56" class="difflineminus">-                       accesskey=&quot;&amp;GenericPhoto.accesskey;&quot;</span>
<a href="#l62.57"></a><span id="l62.57" class="difflineminus">-                       selected=&quot;true&quot;/&gt;</span>
<a href="#l62.58"></a><span id="l62.58" class="difflineminus">-                &lt;hbox class=&quot;indent&quot;&gt;</span>
<a href="#l62.59"></a><span id="l62.59" class="difflineminus">-                  &lt;menulist id=&quot;GenericPhotoList&quot;</span>
<a href="#l62.60"></a><span id="l62.60" class="difflineminus">-                            oncommand=&quot;updatePhoto('generic');&quot;&gt;</span>
<a href="#l62.61"></a><span id="l62.61" class="difflineminus">-                    &lt;menupopup&gt;</span>
<a href="#l62.62"></a><span id="l62.62" class="difflineminus">-                      &lt;menuitem label=&quot;&amp;DefaultPhoto.label;&quot; selected=&quot;true&quot;</span>
<a href="#l62.63"></a><span id="l62.63" class="difflineminus">-                                value=&quot;chrome://messenger/skin/addressbook/icons/contact-generic.png&quot;</span>
<a href="#l62.64"></a><span id="l62.64" class="difflineminus">-                                image=&quot;chrome://messenger/skin/addressbook/icons/contact-generic-tiny.png&quot;/&gt;</span>
<a href="#l62.65"></a><span id="l62.65" class="difflineminus">-                    &lt;/menupopup&gt;</span>
<a href="#l62.66"></a><span id="l62.66" class="difflineminus">-                  &lt;/menulist&gt;</span>
<a href="#l62.67"></a><span id="l62.67" class="difflineminus">-                &lt;/hbox&gt;</span>
<a href="#l62.68"></a><span id="l62.68" class="difflineminus">-                &lt;radio id=&quot;file&quot; label=&quot;&amp;PhotoFile.label;&quot;</span>
<a href="#l62.69"></a><span id="l62.69" class="difflineminus">-                       command=&quot;PhotoCmd&quot;</span>
<a href="#l62.70"></a><span id="l62.70" class="difflineminus">-                       accesskey=&quot;&amp;PhotoFile.accesskey;&quot;/&gt;</span>
<a href="#l62.71"></a><span id="l62.71" class="difflineminus">-                &lt;hbox class=&quot;indent&quot;&gt;</span>
<a href="#l62.72"></a><span id="l62.72" class="difflineminus">-                  &lt;filefield id=&quot;PhotoFile&quot; maxlength=&quot;255&quot; flex=&quot;1&quot;</span>
<a href="#l62.73"></a><span id="l62.73" class="difflineminus">-                             disabled=&quot;true&quot;</span>
<a href="#l62.74"></a><span id="l62.74" class="difflineminus">-                             style=&quot;-moz-margin-start:2px;&quot;/&gt;</span>
<a href="#l62.75"></a><span id="l62.75" class="difflineminus">-                  &lt;button oncommand=&quot;browsePhoto();&quot; id=&quot;BrowsePhoto&quot;</span>
<a href="#l62.76"></a><span id="l62.76" class="difflineminus">-                          label=&quot;&amp;BrowsePhoto.label;&quot;</span>
<a href="#l62.77"></a><span id="l62.77" class="difflineminus">-                          accesskey=&quot;&amp;BrowsePhoto.accesskey;&quot;/&gt;</span>
<a href="#l62.78"></a><span id="l62.78" class="difflineminus">-                &lt;/hbox&gt;</span>
<a href="#l62.79"></a><span id="l62.79" class="difflineminus">-                &lt;radio id=&quot;web&quot; label=&quot;&amp;PhotoURL.label;&quot;</span>
<a href="#l62.80"></a><span id="l62.80" class="difflineminus">-                       command=&quot;PhotoCmd&quot;</span>
<a href="#l62.81"></a><span id="l62.81" class="difflineminus">-                       accesskey=&quot;&amp;PhotoURL.accesskey;&quot;/&gt;</span>
<a href="#l62.82"></a><span id="l62.82" class="difflineminus">-                &lt;hbox class=&quot;indent&quot;&gt;</span>
<a href="#l62.83"></a><span id="l62.83" class="difflineminus">-                  &lt;textbox id=&quot;PhotoURI&quot; maxlength=&quot;255&quot; style=&quot;width: 45ch;&quot;</span>
<a href="#l62.84"></a><span id="l62.84" class="difflineminus">-                           emptytext=&quot;&amp;PhotoURL.emptytext;&quot;</span>
<a href="#l62.85"></a><span id="l62.85" class="difflineminus">-                           class=&quot;AddressCardEditWidth&quot;/&gt;</span>
<a href="#l62.86"></a><span id="l62.86" class="difflineminus">-                  &lt;button oncommand=&quot;updatePhoto('web');&quot; id=&quot;UpdatePhoto&quot;</span>
<a href="#l62.87"></a><span id="l62.87" class="difflineminus">-                          label=&quot;&amp;UpdatePhoto.label;&quot;</span>
<a href="#l62.88"></a><span id="l62.88" class="difflineminus">-                          accesskey=&quot;&amp;UpdatePhoto.accesskey;&quot;/&gt;</span>
<a href="#l62.89"></a><span id="l62.89" class="difflineminus">-                &lt;/hbox&gt;</span>
<a href="#l62.90"></a><span id="l62.90" class="difflineminus">-              &lt;/radiogroup&gt;</span>
<a href="#l62.91"></a><span id="l62.91" class="difflineminus">-            &lt;/groupbox&gt;</span>
<a href="#l62.92"></a><span id="l62.92" class="difflineminus">-            &lt;spacer flex=&quot;1&quot;/&gt;</span>
<a href="#l62.93"></a><span id="l62.93" class="difflineminus">-          &lt;/vbox&gt;</span>
<a href="#l62.94"></a><span id="l62.94" class="difflineminus">-        &lt;/hbox&gt;</span>
<a href="#l62.95"></a><span id="l62.95" class="difflineminus">-      &lt;/vbox&gt;</span>
<a href="#l62.96"></a><span id="l62.96" class="difflineplus">+            &lt;radio value=&quot;web&quot; label=&quot;&amp;PhotoURL.label;&quot;</span>
<a href="#l62.97"></a><span id="l62.97" class="difflineplus">+                   accesskey=&quot;&amp;PhotoURL.accesskey;&quot;/&gt;</span>
<a href="#l62.98"></a><span id="l62.98" class="difflineplus">+            &lt;hbox class=&quot;indent&quot;&gt;</span>
<a href="#l62.99"></a><span id="l62.99" class="difflineplus">+              &lt;textbox id=&quot;PhotoURI&quot; maxlength=&quot;255&quot; flex=&quot;1&quot;</span>
<a href="#l62.100"></a><span id="l62.100" class="difflineplus">+                       emptytext=&quot;&amp;PhotoURL.emptytext;&quot;/&gt;</span>
<a href="#l62.101"></a><span id="l62.101" class="difflineplus">+              &lt;button oncommand=&quot;updatePhoto('web');&quot; id=&quot;UpdatePhoto&quot;</span>
<a href="#l62.102"></a><span id="l62.102" class="difflineplus">+                      label=&quot;&amp;UpdatePhoto.label;&quot;</span>
<a href="#l62.103"></a><span id="l62.103" class="difflineplus">+                      accesskey=&quot;&amp;UpdatePhoto.accesskey;&quot;/&gt;</span>
<a href="#l62.104"></a><span id="l62.104" class="difflineplus">+            &lt;/hbox&gt;</span>
<a href="#l62.105"></a><span id="l62.105" class="difflineplus">+          &lt;/radiogroup&gt;</span>
<a href="#l62.106"></a><span id="l62.106" class="difflineplus">+        &lt;/groupbox&gt;</span>
<a href="#l62.107"></a><span id="l62.107" class="difflineplus">+      &lt;/hbox&gt;</span>
<a href="#l62.108"></a><span id="l62.108">     &lt;/tabpanels&gt;</span>
<a href="#l62.109"></a><span id="l62.109">   &lt;/tabbox&gt;</span>
<a href="#l62.110"></a><span id="l62.110"> &lt;/vbox&gt;</span>
<a href="#l62.111"></a><span id="l62.111"> &lt;/overlay&gt;</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l63.1"></a><span id="l63.1" class="difflineminus">--- a/mailnews/addrbook/src/nsAbManager.cpp</span>
<a href="#l63.2"></a><span id="l63.2" class="difflineplus">+++ b/mailnews/addrbook/src/nsAbManager.cpp</span>
<a href="#l63.3"></a><span id="l63.3" class="difflineat">@@ -725,17 +725,17 @@ nsAbManager::ExportDirectoryToDelimitedT</span>
<a href="#l63.4"></a><span id="l63.4">                 newValue.AppendLiteral(&quot;\&quot;&quot;);</span>
<a href="#l63.5"></a><span id="l63.5">               }</span>
<a href="#l63.6"></a><span id="l63.6"> </span>
<a href="#l63.7"></a><span id="l63.7">               rv = nsMsgI18NConvertFromUnicode(nsMsgI18NFileSystemCharset(),</span>
<a href="#l63.8"></a><span id="l63.8">                                                newValue, valueCStr);</span>
<a href="#l63.9"></a><span id="l63.9">               NS_ENSURE_SUCCESS(rv,rv);</span>
<a href="#l63.10"></a><span id="l63.10"> </span>
<a href="#l63.11"></a><span id="l63.11">               if (NS_FAILED(rv)) {</span>
<a href="#l63.12"></a><span id="l63.12" class="difflineminus">-                NS_ASSERTION(0, &quot;failed to convert string to system charset.  use LDIF&quot;);</span>
<a href="#l63.13"></a><span id="l63.13" class="difflineplus">+                NS_ERROR(&quot;failed to convert string to system charset.  use LDIF&quot;);</span>
<a href="#l63.14"></a><span id="l63.14">                 valueCStr = &quot;?&quot;;</span>
<a href="#l63.15"></a><span id="l63.15">               }</span>
<a href="#l63.16"></a><span id="l63.16"> </span>
<a href="#l63.17"></a><span id="l63.17">               length = valueCStr.Length();</span>
<a href="#l63.18"></a><span id="l63.18">               if (length) {</span>
<a href="#l63.19"></a><span id="l63.19">                 rv = outputStream-&gt;Write(valueCStr.get(), length, &amp;writeCount);</span>
<a href="#l63.20"></a><span id="l63.20">                 NS_ENSURE_SUCCESS(rv,rv);</span>
<a href="#l63.21"></a><span id="l63.21">                 if (length != writeCount)</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l64.1"></a><span id="l64.1" class="difflineminus">--- a/mailnews/base/content/junkCommands.js</span>
<a href="#l64.2"></a><span id="l64.2" class="difflineplus">+++ b/mailnews/base/content/junkCommands.js</span>
<a href="#l64.3"></a><span id="l64.3" class="difflineat">@@ -39,17 +39,21 @@</span>
<a href="#l64.4"></a><span id="l64.4">  /* functions use for junk processing commands</span>
<a href="#l64.5"></a><span id="l64.5">   *</span>
<a href="#l64.6"></a><span id="l64.6">   * TODO: These functions make the false assumption that a view only contains</span>
<a href="#l64.7"></a><span id="l64.7">   *       a single folder. This is not true for XF saved searches.</span>
<a href="#l64.8"></a><span id="l64.8">   *</span>
<a href="#l64.9"></a><span id="l64.9">   * globals prerequisites used:</span>
<a href="#l64.10"></a><span id="l64.10">   *</span>
<a href="#l64.11"></a><span id="l64.11">   *   window.MsgStatusFeedback</span>
<a href="#l64.12"></a><span id="l64.12" class="difflineminus">-  *   GetSelectedIndices(view)</span>
<a href="#l64.13"></a><span id="l64.13" class="difflineplus">+  *</span>
<a href="#l64.14"></a><span id="l64.14" class="difflineplus">+  *   One of:</span>
<a href="#l64.15"></a><span id="l64.15" class="difflineplus">+  *     GetSelectedIndices(view) (in suite)</span>
<a href="#l64.16"></a><span id="l64.16" class="difflineplus">+  *     gFolderDisplay (in mail)</span>
<a href="#l64.17"></a><span id="l64.17" class="difflineplus">+  *</span>
<a href="#l64.18"></a><span id="l64.18">   *   messenger</span>
<a href="#l64.19"></a><span id="l64.19">   *   gMessengerBundle</span>
<a href="#l64.20"></a><span id="l64.20">   *   gDBView</span>
<a href="#l64.21"></a><span id="l64.21">   *   either gMsgFolderSelected or gFolderDisplay</span>
<a href="#l64.22"></a><span id="l64.22">   *   MsgJunkMailInfo(aCheckFirstUse)</span>
<a href="#l64.23"></a><span id="l64.23">   *   SetNextMessageAfterDelete()</span>
<a href="#l64.24"></a><span id="l64.24">   *   pref</span>
<a href="#l64.25"></a><span id="l64.25">   *   msgWindow</span>
<a href="#l64.26"></a><span id="l64.26" class="difflineat">@@ -231,16 +235,18 @@ MessageClassifier.prototype =</span>
<a href="#l64.27"></a><span id="l64.27">    *        URI of classified message</span>
<a href="#l64.28"></a><span id="l64.28">    * @param aClassification</span>
<a href="#l64.29"></a><span id="l64.29">    *        Junk classification (0: UNCLASSIFIED, 1: GOOD, 2: JUNK)</span>
<a href="#l64.30"></a><span id="l64.30">    * @param aJunkPercent</span>
<a href="#l64.31"></a><span id="l64.31">    *        0 - 100 indicator of junk likelihood, with 100 meaning probably junk</span>
<a href="#l64.32"></a><span id="l64.32">    */</span>
<a href="#l64.33"></a><span id="l64.33">   onMessageClassified: function(aClassifiedMsgURI, aClassification, aJunkPercent)</span>
<a href="#l64.34"></a><span id="l64.34">   {</span>
<a href="#l64.35"></a><span id="l64.35" class="difflineplus">+    if (!aClassifiedMsgURI)</span>
<a href="#l64.36"></a><span id="l64.36" class="difflineplus">+      return; // ignore end of batch</span>
<a href="#l64.37"></a><span id="l64.37">     var nsIJunkMailPlugin = Components.interfaces.nsIJunkMailPlugin;</span>
<a href="#l64.38"></a><span id="l64.38">     var score = (aClassification == nsIJunkMailPlugin.JUNK) ?</span>
<a href="#l64.39"></a><span id="l64.39">       nsIJunkMailPlugin.IS_SPAM_SCORE : nsIJunkMailPlugin.IS_HAM_SCORE;</span>
<a href="#l64.40"></a><span id="l64.40">     const statusDisplayInterval = 1000; // milliseconds between status updates</span>
<a href="#l64.41"></a><span id="l64.41"> </span>
<a href="#l64.42"></a><span id="l64.42">     // set these props via the db (instead of the message header</span>
<a href="#l64.43"></a><span id="l64.43">     // directly) so that the nsMsgDBView knows to update the UI</span>
<a href="#l64.44"></a><span id="l64.44">     //</span>
<a href="#l64.45"></a><span id="l64.45" class="difflineat">@@ -316,17 +322,20 @@ function processFolderForJunk(aAll)</span>
<a href="#l64.46"></a><span id="l64.46">     gDBView.doCommand(nsMsgViewCommandType.expandAll);</span>
<a href="#l64.47"></a><span id="l64.47">     var treeView = gDBView.QueryInterface(Components.interfaces.nsITreeView);</span>
<a href="#l64.48"></a><span id="l64.48">     var count = treeView.rowCount;</span>
<a href="#l64.49"></a><span id="l64.49">     if (!count)</span>
<a href="#l64.50"></a><span id="l64.50">       return;</span>
<a href="#l64.51"></a><span id="l64.51">   }</span>
<a href="#l64.52"></a><span id="l64.52">   else</span>
<a href="#l64.53"></a><span id="l64.53">   {</span>
<a href="#l64.54"></a><span id="l64.54" class="difflineminus">-    var indices = GetSelectedIndices(gDBView);</span>
<a href="#l64.55"></a><span id="l64.55" class="difflineplus">+    // suite uses GetSelectedIndices, mail uses gFolderDisplay.selectedMessages</span>
<a href="#l64.56"></a><span id="l64.56" class="difflineplus">+    var indices = typeof GetSelectedIndices != &quot;undefined&quot; ?</span>
<a href="#l64.57"></a><span id="l64.57" class="difflineplus">+                    GetSelectedIndices(gDBView) :</span>
<a href="#l64.58"></a><span id="l64.58" class="difflineplus">+                    gFolderDisplay.selectedIndices;</span>
<a href="#l64.59"></a><span id="l64.59">     if (!indices || !indices.length)</span>
<a href="#l64.60"></a><span id="l64.60">       return;</span>
<a href="#l64.61"></a><span id="l64.61">   }</span>
<a href="#l64.62"></a><span id="l64.62">   var totalMessages = aAll ? count : indices.length;</span>
<a href="#l64.63"></a><span id="l64.63"> </span>
<a href="#l64.64"></a><span id="l64.64">   // retrieve server and its spam settings via the header of an arbitrary message</span>
<a href="#l64.65"></a><span id="l64.65">   for (var i = 0; i &lt; totalMessages; i++)</span>
<a href="#l64.66"></a><span id="l64.66">   {</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l65.1"></a><span id="l65.1" class="difflineminus">--- a/mailnews/base/content/virtualFolderProperties.js</span>
<a href="#l65.2"></a><span id="l65.2" class="difflineplus">+++ b/mailnews/base/content/virtualFolderProperties.js</span>
<a href="#l65.3"></a><span id="l65.3" class="difflineat">@@ -93,16 +93,18 @@ function onLoad()</span>
<a href="#l65.4"></a><span id="l65.4">       document.getElementById(&quot;name&quot;).value = arguments.newFolderName;</span>
<a href="#l65.5"></a><span id="l65.5">     if (arguments.searchFolderURIs)</span>
<a href="#l65.6"></a><span id="l65.6">       gSearchFolderURIs = arguments.searchFolderURIs;</span>
<a href="#l65.7"></a><span id="l65.7"> </span>
<a href="#l65.8"></a><span id="l65.8">     setupSearchRows(gSearchTermSession.searchTerms);</span>
<a href="#l65.9"></a><span id="l65.9">     doEnabling(); // we only need to disable/enable the OK button for new virtual folders</span>
<a href="#l65.10"></a><span id="l65.10">   }</span>
<a href="#l65.11"></a><span id="l65.11"> </span>
<a href="#l65.12"></a><span id="l65.12" class="difflineplus">+  if (typeof arguments.searchOnline != &quot;undefined&quot;)</span>
<a href="#l65.13"></a><span id="l65.13" class="difflineplus">+    document.getElementById('searchOnline').checked = arguments.searchOnline;</span>
<a href="#l65.14"></a><span id="l65.14">   updateOnlineSearchState();</span>
<a href="#l65.15"></a><span id="l65.15">   doSetOKCancel(onOK, onCancel);</span>
<a href="#l65.16"></a><span id="l65.16"> }</span>
<a href="#l65.17"></a><span id="l65.17"> </span>
<a href="#l65.18"></a><span id="l65.18"> function setupSearchRows(aSearchTerms)</span>
<a href="#l65.19"></a><span id="l65.19"> {</span>
<a href="#l65.20"></a><span id="l65.20">   if (aSearchTerms &amp;&amp; aSearchTerms.Count() &gt; 0)</span>
<a href="#l65.21"></a><span id="l65.21">     initializeSearchRows(nsMsgSearchScope.offlineMail, aSearchTerms); // load the search terms for the folder</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l66.1"></a><span id="l66.1" class="difflineminus">--- a/mailnews/base/prefs/content/am-identities-list.js</span>
<a href="#l66.2"></a><span id="l66.2" class="difflineplus">+++ b/mailnews/base/prefs/content/am-identities-list.js</span>
<a href="#l66.3"></a><span id="l66.3" class="difflineat">@@ -90,17 +90,17 @@ function refreshIdentityList()</span>
<a href="#l66.4"></a><span id="l66.4"> </span>
<a href="#l66.5"></a><span id="l66.5"> // opens the identity editor dialog</span>
<a href="#l66.6"></a><span id="l66.6"> // identity: pass in the identity (if any) to load in the dialog</span>
<a href="#l66.7"></a><span id="l66.7"> function openIdentityEditor(identity)</span>
<a href="#l66.8"></a><span id="l66.8"> {</span>
<a href="#l66.9"></a><span id="l66.9">   var result = false; </span>
<a href="#l66.10"></a><span id="l66.10">   var args = { identity: identity, account: gAccount, result: result };</span>
<a href="#l66.11"></a><span id="l66.11"> </span>
<a href="#l66.12"></a><span id="l66.12" class="difflineminus">-  window.openDialog('am-identity-edit.xul', '', 'modal,titlebar,chrome', args);</span>
<a href="#l66.13"></a><span id="l66.13" class="difflineplus">+  window.openDialog(&quot;am-identity-edit.xul&quot;, &quot;&quot;, &quot;chrome,modal,resizable=no,centerscreen&quot;, args);</span>
<a href="#l66.14"></a><span id="l66.14"> </span>
<a href="#l66.15"></a><span id="l66.15">   var selectedItemIndex = gIdentityListBox.selectedIndex;</span>
<a href="#l66.16"></a><span id="l66.16"> </span>
<a href="#l66.17"></a><span id="l66.17">   if (args.result)</span>
<a href="#l66.18"></a><span id="l66.18">   {</span>
<a href="#l66.19"></a><span id="l66.19">     refreshIdentityList();   </span>
<a href="#l66.20"></a><span id="l66.20">     gIdentityListBox.selectedIndex = selectedItemIndex;</span>
<a href="#l66.21"></a><span id="l66.21">   }</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l67.1"></a><span id="l67.1" class="difflineminus">--- a/mailnews/base/prefs/content/am-identity-edit.xul</span>
<a href="#l67.2"></a><span id="l67.2" class="difflineplus">+++ b/mailnews/base/prefs/content/am-identity-edit.xul</span>
<a href="#l67.3"></a><span id="l67.3" class="difflineat">@@ -1,13 +1,9 @@</span>
<a href="#l67.4"></a><span id="l67.4"> &lt;?xml version=&quot;1.0&quot;?&gt;</span>
<a href="#l67.5"></a><span id="l67.5" class="difflineminus">-</span>
<a href="#l67.6"></a><span id="l67.6" class="difflineminus">-&lt;?xml-stylesheet href=&quot;chrome://messenger/skin/messenger.css&quot; type=&quot;text/css&quot;?&gt;</span>
<a href="#l67.7"></a><span id="l67.7" class="difflineminus">-&lt;?xml-stylesheet href=&quot;chrome://messenger/skin/accountManage.css&quot; type=&quot;text/css&quot;?&gt;</span>
<a href="#l67.8"></a><span id="l67.8" class="difflineminus">-</span>
<a href="#l67.9"></a><span id="l67.9"> &lt;!-- ***** BEGIN LICENSE BLOCK *****</span>
<a href="#l67.10"></a><span id="l67.10">  Version: MPL 1.1/GPL 2.0/LGPL 2.1</span>
<a href="#l67.11"></a><span id="l67.11"> </span>
<a href="#l67.12"></a><span id="l67.12">  The contents of this file are subject to the Mozilla Public License Version</span>
<a href="#l67.13"></a><span id="l67.13">  1.1 (the &quot;License&quot;); you may not use this file except in compliance with</span>
<a href="#l67.14"></a><span id="l67.14">  the License. You may obtain a copy of the License at</span>
<a href="#l67.15"></a><span id="l67.15">  http://www.mozilla.org/MPL/</span>
<a href="#l67.16"></a><span id="l67.16"> </span>
<a href="#l67.17"></a><span id="l67.17" class="difflineat">@@ -17,17 +13,17 @@</span>
<a href="#l67.18"></a><span id="l67.18">  License.</span>
<a href="#l67.19"></a><span id="l67.19"> </span>
<a href="#l67.20"></a><span id="l67.20">  The Original Code is Mozilla Mail Code.</span>
<a href="#l67.21"></a><span id="l67.21"> </span>
<a href="#l67.22"></a><span id="l67.22">  The Initial Developer of the Original Code is</span>
<a href="#l67.23"></a><span id="l67.23">  David Bienvenu.</span>
<a href="#l67.24"></a><span id="l67.24">  Portions created by the Initial Developer are Copyright (C) 2004</span>
<a href="#l67.25"></a><span id="l67.25">  the Initial Developer. All Rights Reserved.</span>
<a href="#l67.26"></a><span id="l67.26" class="difflineminus">- </span>
<a href="#l67.27"></a><span id="l67.27" class="difflineplus">+</span>
<a href="#l67.28"></a><span id="l67.28">  Contributor(s):</span>
<a href="#l67.29"></a><span id="l67.29">    Scott MacGregor &lt;mscott@mozilla.org&gt;</span>
<a href="#l67.30"></a><span id="l67.30"> </span>
<a href="#l67.31"></a><span id="l67.31">  Alternatively, the contents of this file may be used under the terms of</span>
<a href="#l67.32"></a><span id="l67.32">  either of the GNU General Public License Version 2 or later (the &quot;GPL&quot;),</span>
<a href="#l67.33"></a><span id="l67.33">  or the GNU Lesser General Public License Version 2.1 or later (the &quot;LGPL&quot;),</span>
<a href="#l67.34"></a><span id="l67.34">  in which case the provisions of the GPL or the LGPL are applicable instead</span>
<a href="#l67.35"></a><span id="l67.35">  of those above. If you wish to allow use of your version of this file only</span>
<a href="#l67.36"></a><span id="l67.36" class="difflineat">@@ -35,32 +31,35 @@</span>
<a href="#l67.37"></a><span id="l67.37">  use your version of this file under the terms of the MPL, indicate your</span>
<a href="#l67.38"></a><span id="l67.38">  decision by deleting the provisions above and replace them with the notice</span>
<a href="#l67.39"></a><span id="l67.39">  and other provisions required by the GPL or the LGPL. If you do not delete</span>
<a href="#l67.40"></a><span id="l67.40">  the provisions above, a recipient may use your version of this file under</span>
<a href="#l67.41"></a><span id="l67.41">  the terms of any one of the MPL, the GPL or the LGPL.</span>
<a href="#l67.42"></a><span id="l67.42"> </span>
<a href="#l67.43"></a><span id="l67.43">  ***** END LICENSE BLOCK ***** --&gt;</span>
<a href="#l67.44"></a><span id="l67.44"> </span>
<a href="#l67.45"></a><span id="l67.45" class="difflineplus">+&lt;?xml-stylesheet href=&quot;chrome://messenger/skin/messenger.css&quot; type=&quot;text/css&quot;?&gt;</span>
<a href="#l67.46"></a><span id="l67.46" class="difflineplus">+&lt;?xml-stylesheet href=&quot;chrome://messenger/skin/accountManage.css&quot; type=&quot;text/css&quot;?&gt;</span>
<a href="#l67.47"></a><span id="l67.47" class="difflineplus">+</span>
<a href="#l67.48"></a><span id="l67.48"> &lt;?xul-overlay href=&quot;chrome://messenger/content/am-copiesOverlay.xul&quot;?&gt;</span>
<a href="#l67.49"></a><span id="l67.49"> &lt;?xul-overlay href=&quot;chrome://messenger/content/am-addressingOverlay.xul&quot;?&gt;</span>
<a href="#l67.50"></a><span id="l67.50"> </span>
<a href="#l67.51"></a><span id="l67.51"> &lt;!DOCTYPE dialog [</span>
<a href="#l67.52"></a><span id="l67.52"> &lt;!ENTITY % identityEditDTD SYSTEM &quot;chrome://messenger/locale/am-identity-edit.dtd&quot; &gt;</span>
<a href="#l67.53"></a><span id="l67.53"> %identityEditDTD;</span>
<a href="#l67.54"></a><span id="l67.54"> &lt;!ENTITY % identityDTD SYSTEM &quot;chrome://messenger/locale/am-main.dtd&quot; &gt;</span>
<a href="#l67.55"></a><span id="l67.55"> %identityDTD;</span>
<a href="#l67.56"></a><span id="l67.56" class="difflineminus">-]&gt;  </span>
<a href="#l67.57"></a><span id="l67.57" class="difflineplus">+]&gt;</span>
<a href="#l67.58"></a><span id="l67.58"> </span>
<a href="#l67.59"></a><span id="l67.59"> &lt;dialog title=&quot;&amp;identityTitle.label;&quot;</span>
<a href="#l67.60"></a><span id="l67.60" class="difflineminus">-  xmlns:rdf=&quot;http://www.w3.org/1999/02/22-rdf-syntax-ns#&quot;</span>
<a href="#l67.61"></a><span id="l67.61" class="difflineminus">-  xmlns=&quot;http://www.mozilla.org/keymaster/gatekeeper/there.is.only.xul&quot;</span>
<a href="#l67.62"></a><span id="l67.62" class="difflineminus">-  onload=&quot;onLoadIdentityProperties();&quot;</span>
<a href="#l67.63"></a><span id="l67.63" class="difflineminus">-  ondialogaccept=&quot;return onOk();&quot;</span>
<a href="#l67.64"></a><span id="l67.64" class="difflineminus">-  style=&quot;width: 35em;&quot;&gt;</span>
<a href="#l67.65"></a><span id="l67.65" class="difflineplus">+        xmlns:rdf=&quot;http://www.w3.org/1999/02/22-rdf-syntax-ns#&quot;</span>
<a href="#l67.66"></a><span id="l67.66" class="difflineplus">+        xmlns=&quot;http://www.mozilla.org/keymaster/gatekeeper/there.is.only.xul&quot;</span>
<a href="#l67.67"></a><span id="l67.67" class="difflineplus">+        onload=&quot;onLoadIdentityProperties();&quot;</span>
<a href="#l67.68"></a><span id="l67.68" class="difflineplus">+        ondialogaccept=&quot;return onOk();&quot;</span>
<a href="#l67.69"></a><span id="l67.69" class="difflineplus">+        style=&quot;&amp;identityDialog.style;&quot;&gt;</span>
<a href="#l67.70"></a><span id="l67.70"> </span>
<a href="#l67.71"></a><span id="l67.71">   &lt;stringbundle id=&quot;bundle_prefs&quot; src=&quot;chrome://messenger/locale/prefs.properties&quot;/&gt;</span>
<a href="#l67.72"></a><span id="l67.72">   &lt;stringbundle id=&quot;bundle_messenger&quot; src=&quot;chrome://messenger/locale/messenger.properties&quot;/&gt;</span>
<a href="#l67.73"></a><span id="l67.73"> </span>
<a href="#l67.74"></a><span id="l67.74">   &lt;script type=&quot;application/x-javascript&quot; src=&quot;chrome://messenger/content/am-prefs.js&quot;/&gt;</span>
<a href="#l67.75"></a><span id="l67.75">   &lt;script type=&quot;application/x-javascript&quot; src=&quot;am-identity-edit.js&quot;/&gt;</span>
<a href="#l67.76"></a><span id="l67.76">   &lt;script type=&quot;application/x-javascript&quot;&gt;</span>
<a href="#l67.77"></a><span id="l67.77">   &lt;![CDATA[</span>
<a href="#l67.78"></a><span id="l67.78" class="difflineat">@@ -154,17 +153,17 @@</span>
<a href="#l67.79"></a><span id="l67.79">             &lt;menupopup id=&quot;smtpPopup&quot;&gt;</span>
<a href="#l67.80"></a><span id="l67.80">               &lt;menuitem value=&quot;&quot; label=&quot;&amp;smtpDefaultServer.label;&quot; id=&quot;useDefaultItem&quot;/&gt;</span>
<a href="#l67.81"></a><span id="l67.81">               &lt;menuseparator/&gt;</span>
<a href="#l67.82"></a><span id="l67.82">               &lt;!-- list will be inserted here --&gt;</span>
<a href="#l67.83"></a><span id="l67.83">             &lt;/menupopup&gt;</span>
<a href="#l67.84"></a><span id="l67.84">           &lt;/menulist&gt;</span>
<a href="#l67.85"></a><span id="l67.85">         &lt;/hbox&gt;</span>
<a href="#l67.86"></a><span id="l67.86">       &lt;/vbox&gt;</span>
<a href="#l67.87"></a><span id="l67.87" class="difflineminus">-      </span>
<a href="#l67.88"></a><span id="l67.88" class="difflineplus">+</span>
<a href="#l67.89"></a><span id="l67.89">       &lt;!-- Copies &amp; Folders Tab --&gt; </span>
<a href="#l67.90"></a><span id="l67.90">       &lt;vbox flex=&quot;1&quot; name=&quot;copiesAndFolders&quot; id=&quot;copiesAndFolders&quot;/&gt;</span>
<a href="#l67.91"></a><span id="l67.91"> </span>
<a href="#l67.92"></a><span id="l67.92">       &lt;!-- Composition &amp; Addressing Tab --&gt; </span>
<a href="#l67.93"></a><span id="l67.93">       &lt;vbox flex=&quot;1&quot; name=&quot;composeAddressing&quot; id=&quot;compositionAndAddressing&quot;/&gt;</span>
<a href="#l67.94"></a><span id="l67.94"> </span>
<a href="#l67.95"></a><span id="l67.95">     &lt;/tabpanels&gt; </span>
<a href="#l67.96"></a><span id="l67.96">   &lt;/tabbox&gt;</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l68.1"></a><span id="l68.1" class="difflineminus">--- a/mailnews/base/prefs/content/am-main.js</span>
<a href="#l68.2"></a><span id="l68.2" class="difflineplus">+++ b/mailnews/base/prefs/content/am-main.js</span>
<a href="#l68.3"></a><span id="l68.3" class="difflineat">@@ -73,16 +73,16 @@ function manageIdentities()</span>
<a href="#l68.4"></a><span id="l68.4"> </span>
<a href="#l68.5"></a><span id="l68.5">   var args = { account: account, accountName: accountName, result: false };</span>
<a href="#l68.6"></a><span id="l68.6"> </span>
<a href="#l68.7"></a><span id="l68.7">   // save the current identity settings so they show up correctly</span>
<a href="#l68.8"></a><span id="l68.8">   // if the user just changed them in the manage identities dialog</span>
<a href="#l68.9"></a><span id="l68.9">   var identity = account.defaultIdentity;</span>
<a href="#l68.10"></a><span id="l68.10">   saveIdentitySettings(identity);</span>
<a href="#l68.11"></a><span id="l68.11"> </span>
<a href="#l68.12"></a><span id="l68.12" class="difflineminus">-  window.openDialog('am-identities-list.xul', 'identity', 'modal,titlebar,chrome', args);</span>
<a href="#l68.13"></a><span id="l68.13" class="difflineplus">+  window.openDialog(&quot;am-identities-list.xul&quot;, &quot;&quot;, &quot;chrome,modal,resizable=no,centerscreen&quot;, args);</span>
<a href="#l68.14"></a><span id="l68.14"> </span>
<a href="#l68.15"></a><span id="l68.15">   if (args.result) {</span>
<a href="#l68.16"></a><span id="l68.16">     // now re-initialize the default identity settings in case they changed</span>
<a href="#l68.17"></a><span id="l68.17">     identity = account.defaultIdentity; // refetch the default identity in case it changed</span>
<a href="#l68.18"></a><span id="l68.18">     initIdentityValues(identity);</span>
<a href="#l68.19"></a><span id="l68.19">   }</span>
<a href="#l68.20"></a><span id="l68.20"> }</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l69.1"></a><span id="l69.1" class="difflineminus">--- a/mailnews/base/public/nsIMsgIncomingServer.idl</span>
<a href="#l69.2"></a><span id="l69.2" class="difflineplus">+++ b/mailnews/base/public/nsIMsgIncomingServer.idl</span>
<a href="#l69.3"></a><span id="l69.3" class="difflineat">@@ -54,17 +54,17 @@ interface nsILocalFile;</span>
<a href="#l69.4"></a><span id="l69.4"> interface nsIURI;</span>
<a href="#l69.5"></a><span id="l69.5"> </span>
<a href="#l69.6"></a><span id="l69.6"> /*</span>
<a href="#l69.7"></a><span id="l69.7">  * Interface for incoming mail/news host</span>
<a href="#l69.8"></a><span id="l69.8">  * this is the base interface for all mail server types (imap, pop, nntp, etc)</span>
<a href="#l69.9"></a><span id="l69.9">  * often you will want to add extra interfaces that give you server-specific</span>
<a href="#l69.10"></a><span id="l69.10">  * attributes and methods.</span>
<a href="#l69.11"></a><span id="l69.11">  */</span>
<a href="#l69.12"></a><span id="l69.12" class="difflineminus">-[scriptable, uuid(20B4A762-10F5-4ce7-99CC-F07C10236E20)]</span>
<a href="#l69.13"></a><span id="l69.13" class="difflineplus">+[scriptable, uuid(cca9b826-24d8-4b76-b229-b8b12f1ecbd5)]</span>
<a href="#l69.14"></a><span id="l69.14"> interface nsIMsgIncomingServer : nsISupports {</span>
<a href="#l69.15"></a><span id="l69.15"> </span>
<a href="#l69.16"></a><span id="l69.16">   /**</span>
<a href="#l69.17"></a><span id="l69.17">    * internal pref key - guaranteed to be unique across all servers</span>
<a href="#l69.18"></a><span id="l69.18">    */</span>
<a href="#l69.19"></a><span id="l69.19">   attribute ACString key;</span>
<a href="#l69.20"></a><span id="l69.20"> </span>
<a href="#l69.21"></a><span id="l69.21">   /**</span>
<a href="#l69.22"></a><span id="l69.22" class="difflineat">@@ -118,18 +118,34 @@ interface nsIMsgIncomingServer : nsISupp</span>
<a href="#l69.23"></a><span id="l69.23">   readonly attribute ACString localStoreType;</span>
<a href="#l69.24"></a><span id="l69.24"> </span>
<a href="#l69.25"></a><span id="l69.25">   // Perform specific tasks (reset flags, remove files, etc) for account user/server name changes.</span>
<a href="#l69.26"></a><span id="l69.26">   void onUserOrHostNameChanged(in ACString oldName, in ACString newName);</span>
<a href="#l69.27"></a><span id="l69.27">   </span>
<a href="#l69.28"></a><span id="l69.28">   /* cleartext version of the password */</span>
<a href="#l69.29"></a><span id="l69.29">   attribute ACString password;</span>
<a href="#l69.30"></a><span id="l69.30"> </span>
<a href="#l69.31"></a><span id="l69.31" class="difflineminus">-  /* prompt the user for a password */</span>
<a href="#l69.32"></a><span id="l69.32" class="difflineminus">-  ACString getPasswordWithUI(in AString aPromptString, in AString aPromptTitle, in nsIMsgWindow aMsgWindow, out boolean okayValue);</span>
<a href="#l69.33"></a><span id="l69.33" class="difflineplus">+  /**</span>
<a href="#l69.34"></a><span id="l69.34" class="difflineplus">+   * Attempts to get the password first from the password manager, if that</span>
<a href="#l69.35"></a><span id="l69.35" class="difflineplus">+   * fails it will attempt to get it from the user if aMsgWindow is supplied.</span>
<a href="#l69.36"></a><span id="l69.36" class="difflineplus">+   *</span>
<a href="#l69.37"></a><span id="l69.37" class="difflineplus">+   * @param aPromptString  The text of the prompt if the user is prompted for</span>
<a href="#l69.38"></a><span id="l69.38" class="difflineplus">+   *                       password.</span>
<a href="#l69.39"></a><span id="l69.39" class="difflineplus">+   * @param aPromptTitle   The title of the prompt if the user is prompted.</span>
<a href="#l69.40"></a><span id="l69.40" class="difflineplus">+   * @param aMsgWindow     A message window to associate the prompt with.</span>
<a href="#l69.41"></a><span id="l69.41" class="difflineplus">+   * @return               The obtained password. Could be an empty password.</span>
<a href="#l69.42"></a><span id="l69.42" class="difflineplus">+   *</span>
<a href="#l69.43"></a><span id="l69.43" class="difflineplus">+   * @exception NS_ERROR_FAILURE  The password could not be obtained.</span>
<a href="#l69.44"></a><span id="l69.44" class="difflineplus">+   *</span>
<a href="#l69.45"></a><span id="l69.45" class="difflineplus">+   * @note NS_MSG_PASSWORD_PROMPT_CANCELLED is a success code that is returned</span>
<a href="#l69.46"></a><span id="l69.46" class="difflineplus">+   *       if the prompt was presented to the user but the user cancelled the</span>
<a href="#l69.47"></a><span id="l69.47" class="difflineplus">+   *       prompt.</span>
<a href="#l69.48"></a><span id="l69.48" class="difflineplus">+   */</span>
<a href="#l69.49"></a><span id="l69.49" class="difflineplus">+  ACString getPasswordWithUI(in AString aPromptString, in AString aPromptTitle,</span>
<a href="#l69.50"></a><span id="l69.50" class="difflineplus">+                             in nsIMsgWindow aMsgWindow);</span>
<a href="#l69.51"></a><span id="l69.51"> </span>
<a href="#l69.52"></a><span id="l69.52">   /* forget the password in memory and in single signon database */</span>
<a href="#l69.53"></a><span id="l69.53">   void forgetPassword();</span>
<a href="#l69.54"></a><span id="l69.54"> </span>
<a href="#l69.55"></a><span id="l69.55">   /* forget the password in memory which is cached for the session */</span>
<a href="#l69.56"></a><span id="l69.56">   void forgetSessionPassword();</span>
<a href="#l69.57"></a><span id="l69.57"> </span>
<a href="#l69.58"></a><span id="l69.58">   /* should we download whole messages when biff goes off? */</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l70.1"></a><span id="l70.1" class="difflineminus">--- a/mailnews/base/search/public/nsMsgSearchAdapter.h</span>
<a href="#l70.2"></a><span id="l70.2" class="difflineplus">+++ b/mailnews/base/search/public/nsMsgSearchAdapter.h</span>
<a href="#l70.3"></a><span id="l70.3" class="difflineat">@@ -197,33 +197,41 @@ protected:</span>
<a href="#l70.4"></a><span id="l70.4">   // object makes cleanup of these tables (at shutdown-time) automagic.</span>
<a href="#l70.5"></a><span id="l70.5"> </span>
<a href="#l70.6"></a><span id="l70.6">   nsCOMPtr&lt;nsIMsgSearchValidityTable&gt; m_offlineMailTable;</span>
<a href="#l70.7"></a><span id="l70.7">   nsCOMPtr&lt;nsIMsgSearchValidityTable&gt; m_offlineMailFilterTable;</span>
<a href="#l70.8"></a><span id="l70.8">   nsCOMPtr&lt;nsIMsgSearchValidityTable&gt; m_onlineMailTable;</span>
<a href="#l70.9"></a><span id="l70.9">   nsCOMPtr&lt;nsIMsgSearchValidityTable&gt; m_onlineMailFilterTable;</span>
<a href="#l70.10"></a><span id="l70.10">   nsCOMPtr&lt;nsIMsgSearchValidityTable&gt; m_onlineManualFilterTable;</span>
<a href="#l70.11"></a><span id="l70.11"> </span>
<a href="#l70.12"></a><span id="l70.12" class="difflineminus">-  nsCOMPtr&lt;nsIMsgSearchValidityTable&gt; m_newsTable;</span>
<a href="#l70.13"></a><span id="l70.13" class="difflineminus">-  nsCOMPtr&lt;nsIMsgSearchValidityTable&gt; m_localNewsTable; // used for local news searching or offline news searching...</span>
<a href="#l70.14"></a><span id="l70.14" class="difflineplus">+  nsCOMPtr&lt;nsIMsgSearchValidityTable&gt; m_newsTable;      // online news</span>
<a href="#l70.15"></a><span id="l70.15" class="difflineplus">+</span>
<a href="#l70.16"></a><span id="l70.16" class="difflineplus">+  // Local news tables, used for local news searching or offline.</span>
<a href="#l70.17"></a><span id="l70.17" class="difflineplus">+  nsCOMPtr&lt;nsIMsgSearchValidityTable&gt; m_localNewsTable;         // base table</span>
<a href="#l70.18"></a><span id="l70.18" class="difflineplus">+  nsCOMPtr&lt;nsIMsgSearchValidityTable&gt; m_localNewsJunkTable;     // base + junk</span>
<a href="#l70.19"></a><span id="l70.19" class="difflineplus">+  nsCOMPtr&lt;nsIMsgSearchValidityTable&gt; m_localNewsBodyTable;     // base + body</span>
<a href="#l70.20"></a><span id="l70.20" class="difflineplus">+  nsCOMPtr&lt;nsIMsgSearchValidityTable&gt; m_localNewsJunkBodyTable; // base + junk + body</span>
<a href="#l70.21"></a><span id="l70.21">   nsCOMPtr&lt;nsIMsgSearchValidityTable&gt; m_ldapTable;</span>
<a href="#l70.22"></a><span id="l70.22">   nsCOMPtr&lt;nsIMsgSearchValidityTable&gt; m_ldapAndTable;</span>
<a href="#l70.23"></a><span id="l70.23">   nsCOMPtr&lt;nsIMsgSearchValidityTable&gt; m_localABTable;</span>
<a href="#l70.24"></a><span id="l70.24">   nsCOMPtr&lt;nsIMsgSearchValidityTable&gt; m_localABAndTable;</span>
<a href="#l70.25"></a><span id="l70.25">   nsCOMPtr&lt;nsIMsgSearchValidityTable&gt; m_newsFilterTable;</span>
<a href="#l70.26"></a><span id="l70.26"> </span>
<a href="#l70.27"></a><span id="l70.27">   nsresult NewTable (nsIMsgSearchValidityTable **);</span>
<a href="#l70.28"></a><span id="l70.28"> </span>
<a href="#l70.29"></a><span id="l70.29">   nsresult InitOfflineMailTable();</span>
<a href="#l70.30"></a><span id="l70.30">   nsresult InitOfflineMailFilterTable();</span>
<a href="#l70.31"></a><span id="l70.31">   nsresult InitOnlineMailTable();</span>
<a href="#l70.32"></a><span id="l70.32">   nsresult InitOnlineMailFilterTable();</span>
<a href="#l70.33"></a><span id="l70.33">   nsresult InitOnlineManualFilterTable();</span>
<a href="#l70.34"></a><span id="l70.34">   nsresult InitNewsTable();</span>
<a href="#l70.35"></a><span id="l70.35">   nsresult InitLocalNewsTable();</span>
<a href="#l70.36"></a><span id="l70.36" class="difflineplus">+  nsresult InitLocalNewsJunkTable();</span>
<a href="#l70.37"></a><span id="l70.37" class="difflineplus">+  nsresult InitLocalNewsBodyTable();</span>
<a href="#l70.38"></a><span id="l70.38" class="difflineplus">+  nsresult InitLocalNewsJunkBodyTable();</span>
<a href="#l70.39"></a><span id="l70.39">   nsresult InitNewsFilterTable();</span>
<a href="#l70.40"></a><span id="l70.40"> </span>
<a href="#l70.41"></a><span id="l70.41">   //set the custom headers in the table, changes whenever &quot;mailnews.customHeaders&quot; pref changes.</span>
<a href="#l70.42"></a><span id="l70.42">   nsresult SetOtherHeadersInTable(nsIMsgSearchValidityTable *table, const char *customHeaders);</span>
<a href="#l70.43"></a><span id="l70.43"> </span>
<a href="#l70.44"></a><span id="l70.44">   nsresult InitLdapTable();</span>
<a href="#l70.45"></a><span id="l70.45">   nsresult InitLdapAndTable();</span>
<a href="#l70.46"></a><span id="l70.46">   nsresult InitLocalABTable();</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l71.1"></a><span id="l71.1" class="difflineminus">--- a/mailnews/base/search/public/nsMsgSearchCore.idl</span>
<a href="#l71.2"></a><span id="l71.2" class="difflineplus">+++ b/mailnews/base/search/public/nsMsgSearchCore.idl</span>
<a href="#l71.3"></a><span id="l71.3" class="difflineat">@@ -48,27 +48,34 @@ interface nsIMsgDBHdr;</span>
<a href="#l71.4"></a><span id="l71.4"> </span>
<a href="#l71.5"></a><span id="l71.5"> [scriptable, uuid(5fe70a74-304e-11d3-9be1-00a0c900d445)]</span>
<a href="#l71.6"></a><span id="l71.6"> </span>
<a href="#l71.7"></a><span id="l71.7"> interface nsMsgSearchScope {</span>
<a href="#l71.8"></a><span id="l71.8">   const nsMsgSearchScopeValue offlineMail = 0;</span>
<a href="#l71.9"></a><span id="l71.9">   const nsMsgSearchScopeValue offlineMailFilter = 1;</span>
<a href="#l71.10"></a><span id="l71.10">   const nsMsgSearchScopeValue onlineMail = 2;</span>
<a href="#l71.11"></a><span id="l71.11">   const nsMsgSearchScopeValue onlineMailFilter = 3;</span>
<a href="#l71.12"></a><span id="l71.12" class="difflineplus">+  /// offline news, base table, no body or junk</span>
<a href="#l71.13"></a><span id="l71.13">   const nsMsgSearchScopeValue localNews = 4;</span>
<a href="#l71.14"></a><span id="l71.14">   const nsMsgSearchScopeValue news = 5;</span>
<a href="#l71.15"></a><span id="l71.15">   const nsMsgSearchScopeValue newsEx = 6;</span>
<a href="#l71.16"></a><span id="l71.16">   const nsMsgSearchScopeValue LDAP = 7;</span>
<a href="#l71.17"></a><span id="l71.17">   const nsMsgSearchScopeValue LocalAB = 8;</span>
<a href="#l71.18"></a><span id="l71.18">   const nsMsgSearchScopeValue allSearchableGroups = 9;</span>
<a href="#l71.19"></a><span id="l71.19">   const nsMsgSearchScopeValue newsFilter = 10;</span>
<a href="#l71.20"></a><span id="l71.20">   const nsMsgSearchScopeValue LocalABAnd = 11;</span>
<a href="#l71.21"></a><span id="l71.21">   const nsMsgSearchScopeValue LDAPAnd = 12;</span>
<a href="#l71.22"></a><span id="l71.22">   // IMAP and NEWS, searched using local headers</span>
<a href="#l71.23"></a><span id="l71.23">   const nsMsgSearchScopeValue onlineManual = 13;</span>
<a href="#l71.24"></a><span id="l71.24" class="difflineplus">+  /// local news + junk</span>
<a href="#l71.25"></a><span id="l71.25" class="difflineplus">+  const nsMsgSearchScopeValue localNewsJunk = 14;</span>
<a href="#l71.26"></a><span id="l71.26" class="difflineplus">+  /// local news + body</span>
<a href="#l71.27"></a><span id="l71.27" class="difflineplus">+  const nsMsgSearchScopeValue localNewsBody = 15;</span>
<a href="#l71.28"></a><span id="l71.28" class="difflineplus">+  /// local news + junk + body</span>
<a href="#l71.29"></a><span id="l71.29" class="difflineplus">+  const nsMsgSearchScopeValue localNewsJunkBody = 16;</span>
<a href="#l71.30"></a><span id="l71.30"> };</span>
<a href="#l71.31"></a><span id="l71.31"> </span>
<a href="#l71.32"></a><span id="l71.32"> typedef long nsMsgSearchAttribValue;</span>
<a href="#l71.33"></a><span id="l71.33"> </span>
<a href="#l71.34"></a><span id="l71.34"> /**</span>
<a href="#l71.35"></a><span id="l71.35">  * Definitions of search attribute types. The numerical order</span>
<a href="#l71.36"></a><span id="l71.36">  * from here will also be used to determine the order that the</span>
<a href="#l71.37"></a><span id="l71.37">  * attributes display in the filter editor.</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l72.1"></a><span id="l72.1" class="difflineminus">--- a/mailnews/base/search/src/nsMsgLocalSearch.cpp</span>
<a href="#l72.2"></a><span id="l72.2" class="difflineplus">+++ b/mailnews/base/search/src/nsMsgLocalSearch.cpp</span>
<a href="#l72.3"></a><span id="l72.3" class="difflineat">@@ -873,81 +873,173 @@ nsresult nsMsgSearchOfflineNews::OpenSum</span>
<a href="#l72.4"></a><span id="l72.4">   return err;</span>
<a href="#l72.5"></a><span id="l72.5"> }</span>
<a href="#l72.6"></a><span id="l72.6"> </span>
<a href="#l72.7"></a><span id="l72.7"> nsresult nsMsgSearchOfflineNews::ValidateTerms ()</span>
<a href="#l72.8"></a><span id="l72.8"> {</span>
<a href="#l72.9"></a><span id="l72.9">   return nsMsgSearchOfflineMail::ValidateTerms ();</span>
<a href="#l72.10"></a><span id="l72.10"> }</span>
<a href="#l72.11"></a><span id="l72.11"> </span>
<a href="#l72.12"></a><span id="l72.12" class="difflineplus">+// local helper functions to set subsets of the validity table</span>
<a href="#l72.13"></a><span id="l72.13"> </span>
<a href="#l72.14"></a><span id="l72.14" class="difflineminus">-//-----------------------------------------------------------------------------</span>
<a href="#l72.15"></a><span id="l72.15" class="difflineplus">+nsresult SetJunk(nsIMsgSearchValidityTable* aTable)</span>
<a href="#l72.16"></a><span id="l72.16" class="difflineplus">+{</span>
<a href="#l72.17"></a><span id="l72.17" class="difflineplus">+  NS_ENSURE_ARG_POINTER(aTable);</span>
<a href="#l72.18"></a><span id="l72.18" class="difflineplus">+</span>
<a href="#l72.19"></a><span id="l72.19" class="difflineplus">+  aTable-&gt;SetAvailable(nsMsgSearchAttrib::JunkStatus, nsMsgSearchOp::Is, 1);</span>
<a href="#l72.20"></a><span id="l72.20" class="difflineplus">+  aTable-&gt;SetEnabled(nsMsgSearchAttrib::JunkStatus, nsMsgSearchOp::Is, 1);</span>
<a href="#l72.21"></a><span id="l72.21" class="difflineplus">+  aTable-&gt;SetAvailable(nsMsgSearchAttrib::JunkStatus, nsMsgSearchOp::Isnt, 1);</span>
<a href="#l72.22"></a><span id="l72.22" class="difflineplus">+  aTable-&gt;SetEnabled(nsMsgSearchAttrib::JunkStatus, nsMsgSearchOp::Isnt, 1);</span>
<a href="#l72.23"></a><span id="l72.23" class="difflineplus">+</span>
<a href="#l72.24"></a><span id="l72.24" class="difflineplus">+  aTable-&gt;SetAvailable(nsMsgSearchAttrib::JunkPercent, nsMsgSearchOp::IsGreaterThan, 1);</span>
<a href="#l72.25"></a><span id="l72.25" class="difflineplus">+  aTable-&gt;SetEnabled(nsMsgSearchAttrib::JunkPercent, nsMsgSearchOp::IsGreaterThan, 1);</span>
<a href="#l72.26"></a><span id="l72.26" class="difflineplus">+  aTable-&gt;SetAvailable(nsMsgSearchAttrib::JunkPercent, nsMsgSearchOp::IsLessThan, 1);</span>
<a href="#l72.27"></a><span id="l72.27" class="difflineplus">+  aTable-&gt;SetEnabled(nsMsgSearchAttrib::JunkPercent, nsMsgSearchOp::IsLessThan, 1);</span>
<a href="#l72.28"></a><span id="l72.28" class="difflineplus">+  aTable-&gt;SetAvailable(nsMsgSearchAttrib::JunkPercent, nsMsgSearchOp::Is, 1);</span>
<a href="#l72.29"></a><span id="l72.29" class="difflineplus">+  aTable-&gt;SetEnabled(nsMsgSearchAttrib::JunkPercent, nsMsgSearchOp::Is, 1);</span>
<a href="#l72.30"></a><span id="l72.30" class="difflineplus">+</span>
<a href="#l72.31"></a><span id="l72.31" class="difflineplus">+  aTable-&gt;SetAvailable(nsMsgSearchAttrib::JunkScoreOrigin, nsMsgSearchOp::Is, 1);</span>
<a href="#l72.32"></a><span id="l72.32" class="difflineplus">+  aTable-&gt;SetEnabled(nsMsgSearchAttrib::JunkScoreOrigin, nsMsgSearchOp::Is, 1);</span>
<a href="#l72.33"></a><span id="l72.33" class="difflineplus">+  aTable-&gt;SetAvailable(nsMsgSearchAttrib::JunkScoreOrigin, nsMsgSearchOp::Isnt, 1);</span>
<a href="#l72.34"></a><span id="l72.34" class="difflineplus">+  aTable-&gt;SetEnabled(nsMsgSearchAttrib::JunkScoreOrigin, nsMsgSearchOp::Isnt, 1);</span>
<a href="#l72.35"></a><span id="l72.35" class="difflineplus">+</span>
<a href="#l72.36"></a><span id="l72.36" class="difflineplus">+  return NS_OK;</span>
<a href="#l72.37"></a><span id="l72.37" class="difflineplus">+}</span>
<a href="#l72.38"></a><span id="l72.38" class="difflineplus">+</span>
<a href="#l72.39"></a><span id="l72.39" class="difflineplus">+nsresult SetBody(nsIMsgSearchValidityTable* aTable)</span>
<a href="#l72.40"></a><span id="l72.40" class="difflineplus">+{</span>
<a href="#l72.41"></a><span id="l72.41" class="difflineplus">+  NS_ENSURE_ARG_POINTER(aTable);</span>
<a href="#l72.42"></a><span id="l72.42" class="difflineplus">+  aTable-&gt;SetAvailable (nsMsgSearchAttrib::Body, nsMsgSearchOp::Contains, 1);</span>
<a href="#l72.43"></a><span id="l72.43" class="difflineplus">+  aTable-&gt;SetEnabled   (nsMsgSearchAttrib::Body, nsMsgSearchOp::Contains, 1);</span>
<a href="#l72.44"></a><span id="l72.44" class="difflineplus">+  aTable-&gt;SetAvailable (nsMsgSearchAttrib::Body, nsMsgSearchOp::DoesntContain, 1);</span>
<a href="#l72.45"></a><span id="l72.45" class="difflineplus">+  aTable-&gt;SetEnabled   (nsMsgSearchAttrib::Body, nsMsgSearchOp::DoesntContain, 1);</span>
<a href="#l72.46"></a><span id="l72.46" class="difflineplus">+  aTable-&gt;SetAvailable (nsMsgSearchAttrib::Body, nsMsgSearchOp::Is, 1);</span>
<a href="#l72.47"></a><span id="l72.47" class="difflineplus">+  aTable-&gt;SetEnabled   (nsMsgSearchAttrib::Body, nsMsgSearchOp::Is, 1);</span>
<a href="#l72.48"></a><span id="l72.48" class="difflineplus">+  aTable-&gt;SetAvailable (nsMsgSearchAttrib::Body, nsMsgSearchOp::Isnt, 1);</span>
<a href="#l72.49"></a><span id="l72.49" class="difflineplus">+  aTable-&gt;SetEnabled   (nsMsgSearchAttrib::Body, nsMsgSearchOp::Isnt, 1);</span>
<a href="#l72.50"></a><span id="l72.50" class="difflineplus">+</span>
<a href="#l72.51"></a><span id="l72.51" class="difflineplus">+  return NS_OK;</span>
<a href="#l72.52"></a><span id="l72.52" class="difflineplus">+}</span>
<a href="#l72.53"></a><span id="l72.53" class="difflineplus">+</span>
<a href="#l72.54"></a><span id="l72.54" class="difflineplus">+// set the base validity table values for local news</span>
<a href="#l72.55"></a><span id="l72.55" class="difflineplus">+nsresult SetLocalNews(nsIMsgSearchValidityTable* aTable)</span>
<a href="#l72.56"></a><span id="l72.56" class="difflineplus">+{</span>
<a href="#l72.57"></a><span id="l72.57" class="difflineplus">+  NS_ENSURE_ARG_POINTER(aTable);</span>
<a href="#l72.58"></a><span id="l72.58" class="difflineplus">+</span>
<a href="#l72.59"></a><span id="l72.59" class="difflineplus">+  aTable-&gt;SetAvailable (nsMsgSearchAttrib::Sender, nsMsgSearchOp::Contains, 1);</span>
<a href="#l72.60"></a><span id="l72.60" class="difflineplus">+  aTable-&gt;SetEnabled   (nsMsgSearchAttrib::Sender, nsMsgSearchOp::Contains, 1);</span>
<a href="#l72.61"></a><span id="l72.61" class="difflineplus">+  aTable-&gt;SetAvailable (nsMsgSearchAttrib::Sender, nsMsgSearchOp::DoesntContain, 1);</span>
<a href="#l72.62"></a><span id="l72.62" class="difflineplus">+  aTable-&gt;SetEnabled   (nsMsgSearchAttrib::Sender, nsMsgSearchOp::DoesntContain, 1);</span>
<a href="#l72.63"></a><span id="l72.63" class="difflineplus">+  aTable-&gt;SetAvailable (nsMsgSearchAttrib::Sender, nsMsgSearchOp::Is, 1);</span>
<a href="#l72.64"></a><span id="l72.64" class="difflineplus">+  aTable-&gt;SetEnabled   (nsMsgSearchAttrib::Sender, nsMsgSearchOp::Is, 1);</span>
<a href="#l72.65"></a><span id="l72.65" class="difflineplus">+  aTable-&gt;SetEnabled   (nsMsgSearchAttrib::Sender, nsMsgSearchOp::Isnt, 1);</span>
<a href="#l72.66"></a><span id="l72.66" class="difflineplus">+  aTable-&gt;SetAvailable (nsMsgSearchAttrib::Sender, nsMsgSearchOp::Isnt, 1);</span>
<a href="#l72.67"></a><span id="l72.67" class="difflineplus">+  aTable-&gt;SetAvailable (nsMsgSearchAttrib::Sender, nsMsgSearchOp::BeginsWith, 1);</span>
<a href="#l72.68"></a><span id="l72.68" class="difflineplus">+  aTable-&gt;SetEnabled   (nsMsgSearchAttrib::Sender, nsMsgSearchOp::BeginsWith, 1);</span>
<a href="#l72.69"></a><span id="l72.69" class="difflineplus">+  aTable-&gt;SetAvailable (nsMsgSearchAttrib::Sender, nsMsgSearchOp::EndsWith, 1);</span>
<a href="#l72.70"></a><span id="l72.70" class="difflineplus">+  aTable-&gt;SetEnabled   (nsMsgSearchAttrib::Sender, nsMsgSearchOp::EndsWith, 1);</span>
<a href="#l72.71"></a><span id="l72.71" class="difflineplus">+  aTable-&gt;SetAvailable (nsMsgSearchAttrib::Sender, nsMsgSearchOp::IsInAB, 1);</span>
<a href="#l72.72"></a><span id="l72.72" class="difflineplus">+  aTable-&gt;SetEnabled   (nsMsgSearchAttrib::Sender, nsMsgSearchOp::IsInAB, 1);</span>
<a href="#l72.73"></a><span id="l72.73" class="difflineplus">+  aTable-&gt;SetAvailable (nsMsgSearchAttrib::Sender, nsMsgSearchOp::IsntInAB, 1);</span>
<a href="#l72.74"></a><span id="l72.74" class="difflineplus">+  aTable-&gt;SetEnabled   (nsMsgSearchAttrib::Sender, nsMsgSearchOp::IsntInAB, 1);</span>
<a href="#l72.75"></a><span id="l72.75" class="difflineplus">+</span>
<a href="#l72.76"></a><span id="l72.76" class="difflineplus">+  aTable-&gt;SetAvailable (nsMsgSearchAttrib::Subject, nsMsgSearchOp::Contains, 1);</span>
<a href="#l72.77"></a><span id="l72.77" class="difflineplus">+  aTable-&gt;SetEnabled   (nsMsgSearchAttrib::Subject, nsMsgSearchOp::Contains, 1);</span>
<a href="#l72.78"></a><span id="l72.78" class="difflineplus">+  aTable-&gt;SetAvailable (nsMsgSearchAttrib::Subject, nsMsgSearchOp::DoesntContain, 1);</span>
<a href="#l72.79"></a><span id="l72.79" class="difflineplus">+  aTable-&gt;SetEnabled   (nsMsgSearchAttrib::Subject, nsMsgSearchOp::DoesntContain, 1);</span>
<a href="#l72.80"></a><span id="l72.80" class="difflineplus">+  aTable-&gt;SetAvailable (nsMsgSearchAttrib::Subject, nsMsgSearchOp::Is, 1);</span>
<a href="#l72.81"></a><span id="l72.81" class="difflineplus">+  aTable-&gt;SetEnabled   (nsMsgSearchAttrib::Subject, nsMsgSearchOp::Is, 1);</span>
<a href="#l72.82"></a><span id="l72.82" class="difflineplus">+  aTable-&gt;SetAvailable (nsMsgSearchAttrib::Subject, nsMsgSearchOp::Isnt, 1);</span>
<a href="#l72.83"></a><span id="l72.83" class="difflineplus">+  aTable-&gt;SetEnabled   (nsMsgSearchAttrib::Subject, nsMsgSearchOp::Isnt, 1);</span>
<a href="#l72.84"></a><span id="l72.84" class="difflineplus">+  aTable-&gt;SetAvailable (nsMsgSearchAttrib::Subject, nsMsgSearchOp::BeginsWith, 1);</span>
<a href="#l72.85"></a><span id="l72.85" class="difflineplus">+  aTable-&gt;SetEnabled   (nsMsgSearchAttrib::Subject, nsMsgSearchOp::BeginsWith, 1);</span>
<a href="#l72.86"></a><span id="l72.86" class="difflineplus">+  aTable-&gt;SetAvailable (nsMsgSearchAttrib::Subject, nsMsgSearchOp::EndsWith, 1);</span>
<a href="#l72.87"></a><span id="l72.87" class="difflineplus">+  aTable-&gt;SetEnabled   (nsMsgSearchAttrib::Subject, nsMsgSearchOp::EndsWith, 1);</span>
<a href="#l72.88"></a><span id="l72.88" class="difflineplus">+</span>
<a href="#l72.89"></a><span id="l72.89" class="difflineplus">+  aTable-&gt;SetAvailable (nsMsgSearchAttrib::Date, nsMsgSearchOp::IsBefore, 1);</span>
<a href="#l72.90"></a><span id="l72.90" class="difflineplus">+  aTable-&gt;SetEnabled   (nsMsgSearchAttrib::Date, nsMsgSearchOp::IsBefore, 1);</span>
<a href="#l72.91"></a><span id="l72.91" class="difflineplus">+  aTable-&gt;SetAvailable (nsMsgSearchAttrib::Date, nsMsgSearchOp::IsAfter, 1);</span>
<a href="#l72.92"></a><span id="l72.92" class="difflineplus">+  aTable-&gt;SetEnabled   (nsMsgSearchAttrib::Date, nsMsgSearchOp::IsAfter, 1);</span>
<a href="#l72.93"></a><span id="l72.93" class="difflineplus">+  aTable-&gt;SetAvailable (nsMsgSearchAttrib::Date, nsMsgSearchOp::Is, 1);</span>
<a href="#l72.94"></a><span id="l72.94" class="difflineplus">+  aTable-&gt;SetEnabled   (nsMsgSearchAttrib::Date, nsMsgSearchOp::Is, 1);</span>
<a href="#l72.95"></a><span id="l72.95" class="difflineplus">+  aTable-&gt;SetAvailable (nsMsgSearchAttrib::Date, nsMsgSearchOp::Isnt, 1);</span>
<a href="#l72.96"></a><span id="l72.96" class="difflineplus">+  aTable-&gt;SetEnabled   (nsMsgSearchAttrib::Date, nsMsgSearchOp::Isnt, 1);</span>
<a href="#l72.97"></a><span id="l72.97" class="difflineplus">+</span>
<a href="#l72.98"></a><span id="l72.98" class="difflineplus">+  aTable-&gt;SetAvailable (nsMsgSearchAttrib::AgeInDays, nsMsgSearchOp::IsGreaterThan, 1);</span>
<a href="#l72.99"></a><span id="l72.99" class="difflineplus">+  aTable-&gt;SetEnabled   (nsMsgSearchAttrib::AgeInDays, nsMsgSearchOp::IsGreaterThan, 1);</span>
<a href="#l72.100"></a><span id="l72.100" class="difflineplus">+  aTable-&gt;SetAvailable (nsMsgSearchAttrib::AgeInDays, nsMsgSearchOp::IsLessThan,  1);</span>
<a href="#l72.101"></a><span id="l72.101" class="difflineplus">+  aTable-&gt;SetEnabled   (nsMsgSearchAttrib::AgeInDays, nsMsgSearchOp::IsLessThan, 1);</span>
<a href="#l72.102"></a><span id="l72.102" class="difflineplus">+  aTable-&gt;SetAvailable (nsMsgSearchAttrib::AgeInDays, nsMsgSearchOp::Is,  1);</span>
<a href="#l72.103"></a><span id="l72.103" class="difflineplus">+  aTable-&gt;SetEnabled   (nsMsgSearchAttrib::AgeInDays, nsMsgSearchOp::Is, 1);</span>
<a href="#l72.104"></a><span id="l72.104" class="difflineplus">+</span>
<a href="#l72.105"></a><span id="l72.105" class="difflineplus">+  aTable-&gt;SetAvailable (nsMsgSearchAttrib::MsgStatus, nsMsgSearchOp::Is, 1);</span>
<a href="#l72.106"></a><span id="l72.106" class="difflineplus">+  aTable-&gt;SetEnabled   (nsMsgSearchAttrib::MsgStatus, nsMsgSearchOp::Is, 1);</span>
<a href="#l72.107"></a><span id="l72.107" class="difflineplus">+  aTable-&gt;SetAvailable (nsMsgSearchAttrib::MsgStatus, nsMsgSearchOp::Isnt, 1);</span>
<a href="#l72.108"></a><span id="l72.108" class="difflineplus">+  aTable-&gt;SetEnabled   (nsMsgSearchAttrib::MsgStatus, nsMsgSearchOp::Isnt, 1);</span>
<a href="#l72.109"></a><span id="l72.109" class="difflineplus">+</span>
<a href="#l72.110"></a><span id="l72.110" class="difflineplus">+  aTable-&gt;SetAvailable (nsMsgSearchAttrib::Keywords, nsMsgSearchOp::Contains, 1);</span>
<a href="#l72.111"></a><span id="l72.111" class="difflineplus">+  aTable-&gt;SetEnabled   (nsMsgSearchAttrib::Keywords, nsMsgSearchOp::Contains, 1);</span>
<a href="#l72.112"></a><span id="l72.112" class="difflineplus">+  aTable-&gt;SetAvailable (nsMsgSearchAttrib::Keywords, nsMsgSearchOp::DoesntContain, 1);</span>
<a href="#l72.113"></a><span id="l72.113" class="difflineplus">+  aTable-&gt;SetEnabled   (nsMsgSearchAttrib::Keywords, nsMsgSearchOp::DoesntContain, 1);</span>
<a href="#l72.114"></a><span id="l72.114" class="difflineplus">+  aTable-&gt;SetAvailable (nsMsgSearchAttrib::Keywords, nsMsgSearchOp::Is, 1);</span>
<a href="#l72.115"></a><span id="l72.115" class="difflineplus">+  aTable-&gt;SetEnabled   (nsMsgSearchAttrib::Keywords, nsMsgSearchOp::Is, 1);</span>
<a href="#l72.116"></a><span id="l72.116" class="difflineplus">+  aTable-&gt;SetAvailable (nsMsgSearchAttrib::Keywords, nsMsgSearchOp::Isnt, 1);</span>
<a href="#l72.117"></a><span id="l72.117" class="difflineplus">+  aTable-&gt;SetEnabled   (nsMsgSearchAttrib::Keywords, nsMsgSearchOp::Isnt, 1);</span>
<a href="#l72.118"></a><span id="l72.118" class="difflineplus">+  aTable-&gt;SetAvailable (nsMsgSearchAttrib::Keywords, nsMsgSearchOp::IsEmpty, 1);</span>
<a href="#l72.119"></a><span id="l72.119" class="difflineplus">+  aTable-&gt;SetEnabled   (nsMsgSearchAttrib::Keywords, nsMsgSearchOp::IsEmpty, 1);</span>
<a href="#l72.120"></a><span id="l72.120" class="difflineplus">+  aTable-&gt;SetAvailable (nsMsgSearchAttrib::Keywords, nsMsgSearchOp::IsntEmpty, 1);</span>
<a href="#l72.121"></a><span id="l72.121" class="difflineplus">+  aTable-&gt;SetEnabled   (nsMsgSearchAttrib::Keywords, nsMsgSearchOp::IsntEmpty, 1);</span>
<a href="#l72.122"></a><span id="l72.122" class="difflineplus">+</span>
<a href="#l72.123"></a><span id="l72.123" class="difflineplus">+  aTable-&gt;SetAvailable (nsMsgSearchAttrib::OtherHeader, nsMsgSearchOp::Contains, 1);</span>
<a href="#l72.124"></a><span id="l72.124" class="difflineplus">+  aTable-&gt;SetEnabled   (nsMsgSearchAttrib::OtherHeader, nsMsgSearchOp::Contains, 1);</span>
<a href="#l72.125"></a><span id="l72.125" class="difflineplus">+  aTable-&gt;SetAvailable (nsMsgSearchAttrib::OtherHeader, nsMsgSearchOp::DoesntContain, 1);</span>
<a href="#l72.126"></a><span id="l72.126" class="difflineplus">+  aTable-&gt;SetEnabled   (nsMsgSearchAttrib::OtherHeader, nsMsgSearchOp::DoesntContain, 1);</span>
<a href="#l72.127"></a><span id="l72.127" class="difflineplus">+  aTable-&gt;SetAvailable (nsMsgSearchAttrib::OtherHeader, nsMsgSearchOp::Is, 1);</span>
<a href="#l72.128"></a><span id="l72.128" class="difflineplus">+  aTable-&gt;SetEnabled   (nsMsgSearchAttrib::OtherHeader, nsMsgSearchOp::Is, 1);</span>
<a href="#l72.129"></a><span id="l72.129" class="difflineplus">+  aTable-&gt;SetAvailable (nsMsgSearchAttrib::OtherHeader, nsMsgSearchOp::Isnt, 1);</span>
<a href="#l72.130"></a><span id="l72.130" class="difflineplus">+  aTable-&gt;SetEnabled   (nsMsgSearchAttrib::OtherHeader, nsMsgSearchOp::Isnt, 1);</span>
<a href="#l72.131"></a><span id="l72.131" class="difflineplus">+  aTable-&gt;SetAvailable (nsMsgSearchAttrib::OtherHeader, nsMsgSearchOp::BeginsWith, 1);</span>
<a href="#l72.132"></a><span id="l72.132" class="difflineplus">+  aTable-&gt;SetEnabled   (nsMsgSearchAttrib::OtherHeader, nsMsgSearchOp::BeginsWith, 1);</span>
<a href="#l72.133"></a><span id="l72.133" class="difflineplus">+  aTable-&gt;SetAvailable (nsMsgSearchAttrib::OtherHeader, nsMsgSearchOp::EndsWith, 1);</span>
<a href="#l72.134"></a><span id="l72.134" class="difflineplus">+  aTable-&gt;SetEnabled   (nsMsgSearchAttrib::OtherHeader, nsMsgSearchOp::EndsWith, 1);</span>
<a href="#l72.135"></a><span id="l72.135" class="difflineplus">+  return NS_OK;</span>
<a href="#l72.136"></a><span id="l72.136" class="difflineplus">+</span>
<a href="#l72.137"></a><span id="l72.137" class="difflineplus">+}</span>
<a href="#l72.138"></a><span id="l72.138" class="difflineplus">+</span>
<a href="#l72.139"></a><span id="l72.139"> nsresult nsMsgSearchValidityManager::InitLocalNewsTable()</span>
<a href="#l72.140"></a><span id="l72.140"> {</span>
<a href="#l72.141"></a><span id="l72.141" class="difflineminus">-  NS_ASSERTION (nsnull == m_localNewsTable, &quot;already have local news validty table&quot;);</span>
<a href="#l72.142"></a><span id="l72.142" class="difflineminus">-  nsresult err = NewTable (getter_AddRefs(m_localNewsTable));</span>
<a href="#l72.143"></a><span id="l72.143" class="difflineminus">-</span>
<a href="#l72.144"></a><span id="l72.144" class="difflineminus">-  if (NS_SUCCEEDED(err))</span>
<a href="#l72.145"></a><span id="l72.145" class="difflineminus">-  {</span>
<a href="#l72.146"></a><span id="l72.146" class="difflineminus">-    m_localNewsTable-&gt;SetAvailable (nsMsgSearchAttrib::Sender, nsMsgSearchOp::Contains, 1);</span>
<a href="#l72.147"></a><span id="l72.147" class="difflineminus">-    m_localNewsTable-&gt;SetEnabled   (nsMsgSearchAttrib::Sender, nsMsgSearchOp::Contains, 1);</span>
<a href="#l72.148"></a><span id="l72.148" class="difflineminus">-    m_localNewsTable-&gt;SetAvailable (nsMsgSearchAttrib::Sender, nsMsgSearchOp::Is, 1);</span>
<a href="#l72.149"></a><span id="l72.149" class="difflineminus">-    m_localNewsTable-&gt;SetEnabled   (nsMsgSearchAttrib::Sender, nsMsgSearchOp::Is, 1);</span>
<a href="#l72.150"></a><span id="l72.150" class="difflineminus">-    m_localNewsTable-&gt;SetAvailable (nsMsgSearchAttrib::Sender, nsMsgSearchOp::BeginsWith, 1);</span>
<a href="#l72.151"></a><span id="l72.151" class="difflineminus">-    m_localNewsTable-&gt;SetEnabled   (nsMsgSearchAttrib::Sender, nsMsgSearchOp::BeginsWith, 1);</span>
<a href="#l72.152"></a><span id="l72.152" class="difflineminus">-    m_localNewsTable-&gt;SetAvailable (nsMsgSearchAttrib::Sender, nsMsgSearchOp::EndsWith, 1);</span>
<a href="#l72.153"></a><span id="l72.153" class="difflineminus">-    m_localNewsTable-&gt;SetEnabled   (nsMsgSearchAttrib::Sender, nsMsgSearchOp::EndsWith, 1);</span>
<a href="#l72.154"></a><span id="l72.154" class="difflineminus">-</span>
<a href="#l72.155"></a><span id="l72.155" class="difflineminus">-    m_localNewsTable-&gt;SetAvailable (nsMsgSearchAttrib::Subject, nsMsgSearchOp::Contains, 1);</span>
<a href="#l72.156"></a><span id="l72.156" class="difflineminus">-    m_localNewsTable-&gt;SetEnabled   (nsMsgSearchAttrib::Subject, nsMsgSearchOp::Contains, 1);</span>
<a href="#l72.157"></a><span id="l72.157" class="difflineminus">-    m_localNewsTable-&gt;SetAvailable (nsMsgSearchAttrib::Subject, nsMsgSearchOp::Is, 1);</span>
<a href="#l72.158"></a><span id="l72.158" class="difflineminus">-    m_localNewsTable-&gt;SetEnabled   (nsMsgSearchAttrib::Subject, nsMsgSearchOp::Is, 1);</span>
<a href="#l72.159"></a><span id="l72.159" class="difflineminus">-    m_localNewsTable-&gt;SetAvailable (nsMsgSearchAttrib::Subject, nsMsgSearchOp::BeginsWith, 1);</span>
<a href="#l72.160"></a><span id="l72.160" class="difflineminus">-    m_localNewsTable-&gt;SetEnabled   (nsMsgSearchAttrib::Subject, nsMsgSearchOp::BeginsWith, 1);</span>
<a href="#l72.161"></a><span id="l72.161" class="difflineminus">-    m_localNewsTable-&gt;SetAvailable (nsMsgSearchAttrib::Subject, nsMsgSearchOp::EndsWith, 1);</span>
<a href="#l72.162"></a><span id="l72.162" class="difflineminus">-    m_localNewsTable-&gt;SetEnabled   (nsMsgSearchAttrib::Subject, nsMsgSearchOp::EndsWith, 1);</span>
<a href="#l72.163"></a><span id="l72.163" class="difflineminus">-</span>
<a href="#l72.164"></a><span id="l72.164" class="difflineminus">-    m_localNewsTable-&gt;SetAvailable (nsMsgSearchAttrib::Body, nsMsgSearchOp::Contains, 1);</span>
<a href="#l72.165"></a><span id="l72.165" class="difflineminus">-    m_localNewsTable-&gt;SetEnabled   (nsMsgSearchAttrib::Body, nsMsgSearchOp::Contains, 1);</span>
<a href="#l72.166"></a><span id="l72.166" class="difflineminus">-    m_localNewsTable-&gt;SetAvailable (nsMsgSearchAttrib::Body, nsMsgSearchOp::DoesntContain, 1);</span>
<a href="#l72.167"></a><span id="l72.167" class="difflineminus">-    m_localNewsTable-&gt;SetEnabled   (nsMsgSearchAttrib::Body, nsMsgSearchOp::DoesntContain, 1);</span>
<a href="#l72.168"></a><span id="l72.168" class="difflineminus">-    m_localNewsTable-&gt;SetAvailable (nsMsgSearchAttrib::Body, nsMsgSearchOp::Is, 1);</span>
<a href="#l72.169"></a><span id="l72.169" class="difflineminus">-    m_localNewsTable-&gt;SetEnabled   (nsMsgSearchAttrib::Body, nsMsgSearchOp::Is, 1);</span>
<a href="#l72.170"></a><span id="l72.170" class="difflineminus">-    m_localNewsTable-&gt;SetAvailable (nsMsgSearchAttrib::Body, nsMsgSearchOp::Isnt, 1);</span>
<a href="#l72.171"></a><span id="l72.171" class="difflineminus">-    m_localNewsTable-&gt;SetEnabled   (nsMsgSearchAttrib::Body, nsMsgSearchOp::Isnt, 1);</span>
<a href="#l72.172"></a><span id="l72.172" class="difflineminus">-</span>
<a href="#l72.173"></a><span id="l72.173" class="difflineplus">+  NS_ASSERTION (nsnull == m_localNewsTable, &quot;already have local news validity table&quot;);</span>
<a href="#l72.174"></a><span id="l72.174" class="difflineplus">+  nsresult rv = NewTable(getter_AddRefs(m_localNewsTable));</span>
<a href="#l72.175"></a><span id="l72.175" class="difflineplus">+  NS_ENSURE_SUCCESS(rv, rv);</span>
<a href="#l72.176"></a><span id="l72.176" class="difflineplus">+  return SetLocalNews(m_localNewsTable);</span>
<a href="#l72.177"></a><span id="l72.177" class="difflineplus">+}</span>
<a href="#l72.178"></a><span id="l72.178"> </span>
<a href="#l72.179"></a><span id="l72.179" class="difflineminus">-    m_localNewsTable-&gt;SetEnabled   (nsMsgSearchAttrib::Date, nsMsgSearchOp::IsBefore, 1);</span>
<a href="#l72.180"></a><span id="l72.180" class="difflineminus">-    m_localNewsTable-&gt;SetAvailable (nsMsgSearchAttrib::Date, nsMsgSearchOp::IsAfter, 1);</span>
<a href="#l72.181"></a><span id="l72.181" class="difflineminus">-    m_localNewsTable-&gt;SetEnabled   (nsMsgSearchAttrib::Date, nsMsgSearchOp::IsAfter, 1);</span>
<a href="#l72.182"></a><span id="l72.182" class="difflineminus">-    m_localNewsTable-&gt;SetAvailable (nsMsgSearchAttrib::Date, nsMsgSearchOp::Is, 1);</span>
<a href="#l72.183"></a><span id="l72.183" class="difflineminus">-    m_localNewsTable-&gt;SetEnabled   (nsMsgSearchAttrib::Date, nsMsgSearchOp::Is, 1);</span>
<a href="#l72.184"></a><span id="l72.184" class="difflineminus">-    m_localNewsTable-&gt;SetAvailable (nsMsgSearchAttrib::Date, nsMsgSearchOp::Isnt, 1);</span>
<a href="#l72.185"></a><span id="l72.185" class="difflineminus">-    m_localNewsTable-&gt;SetEnabled   (nsMsgSearchAttrib::Date, nsMsgSearchOp::Isnt, 1);</span>
<a href="#l72.186"></a><span id="l72.186" class="difflineminus">-</span>
<a href="#l72.187"></a><span id="l72.187" class="difflineminus">-    m_localNewsTable-&gt;SetAvailable (nsMsgSearchAttrib::AgeInDays, nsMsgSearchOp::IsGreaterThan, 1);</span>
<a href="#l72.188"></a><span id="l72.188" class="difflineminus">-    m_localNewsTable-&gt;SetEnabled   (nsMsgSearchAttrib::AgeInDays, nsMsgSearchOp::IsGreaterThan, 1);</span>
<a href="#l72.189"></a><span id="l72.189" class="difflineminus">-    m_localNewsTable-&gt;SetAvailable (nsMsgSearchAttrib::AgeInDays, nsMsgSearchOp::IsLessThan,  1);</span>
<a href="#l72.190"></a><span id="l72.190" class="difflineminus">-    m_localNewsTable-&gt;SetEnabled   (nsMsgSearchAttrib::AgeInDays, nsMsgSearchOp::IsLessThan, 1);</span>
<a href="#l72.191"></a><span id="l72.191" class="difflineminus">-    m_localNewsTable-&gt;SetAvailable (nsMsgSearchAttrib::AgeInDays, nsMsgSearchOp::Is,  1);</span>
<a href="#l72.192"></a><span id="l72.192" class="difflineminus">-    m_localNewsTable-&gt;SetEnabled   (nsMsgSearchAttrib::AgeInDays, nsMsgSearchOp::Is, 1);</span>
<a href="#l72.193"></a><span id="l72.193" class="difflineminus">-</span>
<a href="#l72.194"></a><span id="l72.194" class="difflineminus">-    m_localNewsTable-&gt;SetAvailable (nsMsgSearchAttrib::MsgStatus, nsMsgSearchOp::Is, 1);</span>
<a href="#l72.195"></a><span id="l72.195" class="difflineminus">-    m_localNewsTable-&gt;SetEnabled   (nsMsgSearchAttrib::MsgStatus, nsMsgSearchOp::Is, 1);</span>
<a href="#l72.196"></a><span id="l72.196" class="difflineminus">-    m_localNewsTable-&gt;SetAvailable (nsMsgSearchAttrib::MsgStatus, nsMsgSearchOp::Isnt, 1);</span>
<a href="#l72.197"></a><span id="l72.197" class="difflineminus">-    m_localNewsTable-&gt;SetEnabled   (nsMsgSearchAttrib::MsgStatus, nsMsgSearchOp::Isnt, 1);</span>
<a href="#l72.198"></a><span id="l72.198" class="difflineminus">-</span>
<a href="#l72.199"></a><span id="l72.199" class="difflineminus">-    m_localNewsTable-&gt;SetAvailable (nsMsgSearchAttrib::OtherHeader, nsMsgSearchOp::Contains, 1);</span>
<a href="#l72.200"></a><span id="l72.200" class="difflineminus">-    m_localNewsTable-&gt;SetEnabled   (nsMsgSearchAttrib::OtherHeader, nsMsgSearchOp::Contains, 1);</span>
<a href="#l72.201"></a><span id="l72.201" class="difflineminus">-    m_localNewsTable-&gt;SetAvailable (nsMsgSearchAttrib::OtherHeader, nsMsgSearchOp::Is, 1);</span>
<a href="#l72.202"></a><span id="l72.202" class="difflineminus">-    m_localNewsTable-&gt;SetEnabled   (nsMsgSearchAttrib::OtherHeader, nsMsgSearchOp::Is, 1);</span>
<a href="#l72.203"></a><span id="l72.203" class="difflineminus">-    m_localNewsTable-&gt;SetAvailable (nsMsgSearchAttrib::OtherHeader, nsMsgSearchOp::BeginsWith, 1);</span>
<a href="#l72.204"></a><span id="l72.204" class="difflineminus">-    m_localNewsTable-&gt;SetEnabled   (nsMsgSearchAttrib::OtherHeader, nsMsgSearchOp::BeginsWith, 1);</span>
<a href="#l72.205"></a><span id="l72.205" class="difflineminus">-    m_localNewsTable-&gt;SetAvailable (nsMsgSearchAttrib::OtherHeader, nsMsgSearchOp::EndsWith, 1);</span>
<a href="#l72.206"></a><span id="l72.206" class="difflineminus">-    m_localNewsTable-&gt;SetEnabled   (nsMsgSearchAttrib::OtherHeader, nsMsgSearchOp::EndsWith, 1);</span>
<a href="#l72.207"></a><span id="l72.207" class="difflineminus">-</span>
<a href="#l72.208"></a><span id="l72.208" class="difflineminus">-</span>
<a href="#l72.209"></a><span id="l72.209" class="difflineminus">-  }</span>
<a href="#l72.210"></a><span id="l72.210" class="difflineminus">-</span>
<a href="#l72.211"></a><span id="l72.211" class="difflineminus">-  return err;</span>
<a href="#l72.212"></a><span id="l72.212" class="difflineplus">+nsresult nsMsgSearchValidityManager::InitLocalNewsBodyTable()</span>
<a href="#l72.213"></a><span id="l72.213" class="difflineplus">+{</span>
<a href="#l72.214"></a><span id="l72.214" class="difflineplus">+  NS_ASSERTION (nsnull == m_localNewsBodyTable, &quot;already have local news+body validity table&quot;);</span>
<a href="#l72.215"></a><span id="l72.215" class="difflineplus">+  nsresult rv = NewTable(getter_AddRefs(m_localNewsBodyTable));</span>
<a href="#l72.216"></a><span id="l72.216" class="difflineplus">+  NS_ENSURE_SUCCESS(rv, rv);</span>
<a href="#l72.217"></a><span id="l72.217" class="difflineplus">+  rv = SetLocalNews(m_localNewsBodyTable);</span>
<a href="#l72.218"></a><span id="l72.218" class="difflineplus">+  NS_ENSURE_SUCCESS(rv, rv);</span>
<a href="#l72.219"></a><span id="l72.219" class="difflineplus">+  return SetBody(m_localNewsBodyTable);</span>
<a href="#l72.220"></a><span id="l72.220"> }</span>
<a href="#l72.221"></a><span id="l72.221"> </span>
<a href="#l72.222"></a><span id="l72.222" class="difflineplus">+nsresult nsMsgSearchValidityManager::InitLocalNewsJunkTable()</span>
<a href="#l72.223"></a><span id="l72.223" class="difflineplus">+{</span>
<a href="#l72.224"></a><span id="l72.224" class="difflineplus">+  NS_ASSERTION (nsnull == m_localNewsJunkTable, &quot;already have local news+junk validity table&quot;);</span>
<a href="#l72.225"></a><span id="l72.225" class="difflineplus">+  nsresult rv = NewTable(getter_AddRefs(m_localNewsJunkTable));</span>
<a href="#l72.226"></a><span id="l72.226" class="difflineplus">+  NS_ENSURE_SUCCESS(rv, rv);</span>
<a href="#l72.227"></a><span id="l72.227" class="difflineplus">+  rv = SetLocalNews(m_localNewsJunkTable);</span>
<a href="#l72.228"></a><span id="l72.228" class="difflineplus">+  NS_ENSURE_SUCCESS(rv, rv);</span>
<a href="#l72.229"></a><span id="l72.229" class="difflineplus">+  return SetJunk(m_localNewsJunkTable);</span>
<a href="#l72.230"></a><span id="l72.230" class="difflineplus">+}</span>
<a href="#l72.231"></a><span id="l72.231"> </span>
<a href="#l72.232"></a><span id="l72.232" class="difflineplus">+nsresult nsMsgSearchValidityManager::InitLocalNewsJunkBodyTable()</span>
<a href="#l72.233"></a><span id="l72.233" class="difflineplus">+{</span>
<a href="#l72.234"></a><span id="l72.234" class="difflineplus">+  NS_ASSERTION (nsnull == m_localNewsJunkBodyTable, &quot;already have local news+junk+body validity table&quot;);</span>
<a href="#l72.235"></a><span id="l72.235" class="difflineplus">+  nsresult rv = NewTable(getter_AddRefs(m_localNewsJunkBodyTable));</span>
<a href="#l72.236"></a><span id="l72.236" class="difflineplus">+  NS_ENSURE_SUCCESS(rv, rv);</span>
<a href="#l72.237"></a><span id="l72.237" class="difflineplus">+  rv = SetLocalNews(m_localNewsJunkBodyTable);</span>
<a href="#l72.238"></a><span id="l72.238" class="difflineplus">+  NS_ENSURE_SUCCESS(rv, rv);</span>
<a href="#l72.239"></a><span id="l72.239" class="difflineplus">+  rv = SetJunk(m_localNewsJunkBodyTable);</span>
<a href="#l72.240"></a><span id="l72.240" class="difflineplus">+  NS_ENSURE_SUCCESS(rv, rv);</span>
<a href="#l72.241"></a><span id="l72.241" class="difflineplus">+  return SetBody(m_localNewsJunkBodyTable);</span>
<a href="#l72.242"></a><span id="l72.242" class="difflineplus">+}</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l73.1"></a><span id="l73.1" class="difflineminus">--- a/mailnews/base/search/src/nsMsgSearchAdapter.cpp</span>
<a href="#l73.2"></a><span id="l73.2" class="difflineplus">+++ b/mailnews/base/search/src/nsMsgSearchAdapter.cpp</span>
<a href="#l73.3"></a><span id="l73.3" class="difflineat">@@ -1044,16 +1044,38 @@ NS_IMETHODIMP nsMsgSearchValidityManager</span>
<a href="#l73.4"></a><span id="l73.4">     break;</span>
<a href="#l73.5"></a><span id="l73.5">   case nsMsgSearchScope::localNews:</span>
<a href="#l73.6"></a><span id="l73.6">     if (!m_localNewsTable)</span>
<a href="#l73.7"></a><span id="l73.7">       rv = InitLocalNewsTable();</span>
<a href="#l73.8"></a><span id="l73.8">     if (m_localNewsTable)</span>
<a href="#l73.9"></a><span id="l73.9">       rv = SetOtherHeadersInTable(m_localNewsTable, customHeaders.get());</span>
<a href="#l73.10"></a><span id="l73.10">     *ppOutTable = m_localNewsTable;</span>
<a href="#l73.11"></a><span id="l73.11">     break;</span>
<a href="#l73.12"></a><span id="l73.12" class="difflineplus">+  case nsMsgSearchScope::localNewsJunk:</span>
<a href="#l73.13"></a><span id="l73.13" class="difflineplus">+    if (!m_localNewsJunkTable)</span>
<a href="#l73.14"></a><span id="l73.14" class="difflineplus">+      rv = InitLocalNewsJunkTable();</span>
<a href="#l73.15"></a><span id="l73.15" class="difflineplus">+    if (m_localNewsJunkTable)</span>
<a href="#l73.16"></a><span id="l73.16" class="difflineplus">+      rv = SetOtherHeadersInTable(m_localNewsJunkTable, customHeaders.get());</span>
<a href="#l73.17"></a><span id="l73.17" class="difflineplus">+    *ppOutTable = m_localNewsJunkTable;</span>
<a href="#l73.18"></a><span id="l73.18" class="difflineplus">+    break;</span>
<a href="#l73.19"></a><span id="l73.19" class="difflineplus">+  case nsMsgSearchScope::localNewsBody:</span>
<a href="#l73.20"></a><span id="l73.20" class="difflineplus">+    if (!m_localNewsBodyTable)</span>
<a href="#l73.21"></a><span id="l73.21" class="difflineplus">+      rv = InitLocalNewsBodyTable();</span>
<a href="#l73.22"></a><span id="l73.22" class="difflineplus">+    if (m_localNewsBodyTable)</span>
<a href="#l73.23"></a><span id="l73.23" class="difflineplus">+      rv = SetOtherHeadersInTable(m_localNewsBodyTable, customHeaders.get());</span>
<a href="#l73.24"></a><span id="l73.24" class="difflineplus">+    *ppOutTable = m_localNewsBodyTable;</span>
<a href="#l73.25"></a><span id="l73.25" class="difflineplus">+    break;</span>
<a href="#l73.26"></a><span id="l73.26" class="difflineplus">+  case nsMsgSearchScope::localNewsJunkBody:</span>
<a href="#l73.27"></a><span id="l73.27" class="difflineplus">+    if (!m_localNewsJunkBodyTable)</span>
<a href="#l73.28"></a><span id="l73.28" class="difflineplus">+      rv = InitLocalNewsJunkBodyTable();</span>
<a href="#l73.29"></a><span id="l73.29" class="difflineplus">+    if (m_localNewsJunkBodyTable)</span>
<a href="#l73.30"></a><span id="l73.30" class="difflineplus">+      rv = SetOtherHeadersInTable(m_localNewsJunkBodyTable, customHeaders.get());</span>
<a href="#l73.31"></a><span id="l73.31" class="difflineplus">+    *ppOutTable = m_localNewsJunkBodyTable;</span>
<a href="#l73.32"></a><span id="l73.32" class="difflineplus">+    break;</span>
<a href="#l73.33"></a><span id="l73.33" class="difflineplus">+</span>
<a href="#l73.34"></a><span id="l73.34">   case nsMsgSearchScope::onlineManual:</span>
<a href="#l73.35"></a><span id="l73.35">     if (!m_onlineManualFilterTable)</span>
<a href="#l73.36"></a><span id="l73.36">       rv = InitOnlineManualFilterTable();</span>
<a href="#l73.37"></a><span id="l73.37">     if (m_onlineManualFilterTable)</span>
<a href="#l73.38"></a><span id="l73.38">       rv = SetOtherHeadersInTable(m_onlineManualFilterTable, customHeaders.get());</span>
<a href="#l73.39"></a><span id="l73.39">     *ppOutTable = m_onlineManualFilterTable;</span>
<a href="#l73.40"></a><span id="l73.40">     break;</span>
<a href="#l73.41"></a><span id="l73.41">   case nsMsgSearchScope::LDAP:</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l74.1"></a><span id="l74.1" class="difflineminus">--- a/mailnews/base/search/src/nsMsgSearchTerm.cpp</span>
<a href="#l74.2"></a><span id="l74.2" class="difflineplus">+++ b/mailnews/base/search/src/nsMsgSearchTerm.cpp</span>
<a href="#l74.3"></a><span id="l74.3" class="difflineat">@@ -1941,31 +1941,35 @@ nsresult nsMsgSearchScopeTerm::Initializ</span>
<a href="#l74.4"></a><span id="l74.4">   nsresult err = NS_OK;</span>
<a href="#l74.5"></a><span id="l74.5"> </span>
<a href="#l74.6"></a><span id="l74.6">   switch (m_attribute)</span>
<a href="#l74.7"></a><span id="l74.7">   {</span>
<a href="#l74.8"></a><span id="l74.8">     case nsMsgSearchScope::onlineMail:</span>
<a href="#l74.9"></a><span id="l74.9">         m_adapter = new nsMsgSearchOnlineMail (this, termList);</span>
<a href="#l74.10"></a><span id="l74.10">       break;</span>
<a href="#l74.11"></a><span id="l74.11">     case nsMsgSearchScope::offlineMail:</span>
<a href="#l74.12"></a><span id="l74.12" class="difflineplus">+    case nsMsgSearchScope::onlineManual:</span>
<a href="#l74.13"></a><span id="l74.13">         m_adapter = new nsMsgSearchOfflineMail (this, termList);</span>
<a href="#l74.14"></a><span id="l74.14">       break;</span>
<a href="#l74.15"></a><span id="l74.15">     case nsMsgSearchScope::newsEx:</span>
<a href="#l74.16"></a><span id="l74.16">       NS_ASSERTION(PR_FALSE, &quot;not supporting newsEx yet&quot;);</span>
<a href="#l74.17"></a><span id="l74.17">       break;</span>
<a href="#l74.18"></a><span id="l74.18">     case nsMsgSearchScope::news:</span>
<a href="#l74.19"></a><span id="l74.19">           m_adapter = new nsMsgSearchNews (this, termList);</span>
<a href="#l74.20"></a><span id="l74.20">         break;</span>
<a href="#l74.21"></a><span id="l74.21">     case nsMsgSearchScope::allSearchableGroups:</span>
<a href="#l74.22"></a><span id="l74.22">       NS_ASSERTION(PR_FALSE, &quot;not supporting allSearchableGroups yet&quot;);</span>
<a href="#l74.23"></a><span id="l74.23">       break;</span>
<a href="#l74.24"></a><span id="l74.24">     case nsMsgSearchScope::LDAP:</span>
<a href="#l74.25"></a><span id="l74.25">       NS_ASSERTION(PR_FALSE, &quot;not supporting LDAP yet&quot;);</span>
<a href="#l74.26"></a><span id="l74.26">       break;</span>
<a href="#l74.27"></a><span id="l74.27">     case nsMsgSearchScope::localNews:</span>
<a href="#l74.28"></a><span id="l74.28" class="difflineplus">+    case nsMsgSearchScope::localNewsJunk:</span>
<a href="#l74.29"></a><span id="l74.29" class="difflineplus">+    case nsMsgSearchScope::localNewsBody:</span>
<a href="#l74.30"></a><span id="l74.30" class="difflineplus">+    case nsMsgSearchScope::localNewsJunkBody:</span>
<a href="#l74.31"></a><span id="l74.31">       m_adapter = new nsMsgSearchOfflineNews (this, termList);</span>
<a href="#l74.32"></a><span id="l74.32">       break;</span>
<a href="#l74.33"></a><span id="l74.33">     default:</span>
<a href="#l74.34"></a><span id="l74.34">       NS_ASSERTION(PR_FALSE, &quot;invalid scope&quot;);</span>
<a href="#l74.35"></a><span id="l74.35">       err = NS_ERROR_FAILURE;</span>
<a href="#l74.36"></a><span id="l74.36">   }</span>
<a href="#l74.37"></a><span id="l74.37"> </span>
<a href="#l74.38"></a><span id="l74.38">   if (m_adapter)</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l75.1"></a><span id="l75.1" class="difflineminus">--- a/mailnews/base/search/src/nsMsgSearchValue.cpp</span>
<a href="#l75.2"></a><span id="l75.2" class="difflineplus">+++ b/mailnews/base/search/src/nsMsgSearchValue.cpp</span>
<a href="#l75.3"></a><span id="l75.3" class="difflineat">@@ -133,15 +133,15 @@ nsMsgSearchValueImpl::ToString(nsAString</span>
<a href="#l75.4"></a><span id="l75.4">       nsAutoString tempInt;</span>
<a href="#l75.5"></a><span id="l75.5">       tempInt.AppendInt(mValue.attribute);</span>
<a href="#l75.6"></a><span id="l75.6">       </span>
<a href="#l75.7"></a><span id="l75.7">         aResult.AppendLiteral(&quot;type=&quot;);</span>
<a href="#l75.8"></a><span id="l75.8">         aResult.Append(tempInt);</span>
<a href="#l75.9"></a><span id="l75.9">     }</span>
<a href="#l75.10"></a><span id="l75.10">         break;</span>
<a href="#l75.11"></a><span id="l75.11">     default:</span>
<a href="#l75.12"></a><span id="l75.12" class="difflineminus">-        NS_ASSERTION(0, &quot;Unknown search value type&quot;);</span>
<a href="#l75.13"></a><span id="l75.13" class="difflineplus">+        NS_ERROR(&quot;Unknown search value type&quot;);</span>
<a href="#l75.14"></a><span id="l75.14">     }        </span>
<a href="#l75.15"></a><span id="l75.15"> </span>
<a href="#l75.16"></a><span id="l75.16">     aResult.AppendLiteral(&quot;]&quot;);</span>
<a href="#l75.17"></a><span id="l75.17"> </span>
<a href="#l75.18"></a><span id="l75.18">     return NS_OK;</span>
<a href="#l75.19"></a><span id="l75.19"> }</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l76.1"></a><span id="l76.1" class="difflineminus">--- a/mailnews/base/src/nsMsgDBView.cpp</span>
<a href="#l76.2"></a><span id="l76.2" class="difflineplus">+++ b/mailnews/base/src/nsMsgDBView.cpp</span>
<a href="#l76.3"></a><span id="l76.3" class="difflineat">@@ -164,16 +164,18 @@ nsMsgDBView::nsMsgDBView()</span>
<a href="#l76.4"></a><span id="l76.4">   mSuppressCommandUpdating = PR_FALSE;</span>
<a href="#l76.5"></a><span id="l76.5">   mSuppressChangeNotification = PR_FALSE;</span>
<a href="#l76.6"></a><span id="l76.6">   mSummarizeFailed = PR_FALSE;</span>
<a href="#l76.7"></a><span id="l76.7">   mSelectionSummarized = PR_FALSE;</span>
<a href="#l76.8"></a><span id="l76.8">   mGoForwardEnabled = PR_FALSE;</span>
<a href="#l76.9"></a><span id="l76.9">   mGoBackEnabled = PR_FALSE;</span>
<a href="#l76.10"></a><span id="l76.10"> </span>
<a href="#l76.11"></a><span id="l76.11">   mIsNews = PR_FALSE;</span>
<a href="#l76.12"></a><span id="l76.12" class="difflineplus">+  mIsRss = PR_FALSE;</span>
<a href="#l76.13"></a><span id="l76.13" class="difflineplus">+  mIsXFVirtual = PR_FALSE;</span>
<a href="#l76.14"></a><span id="l76.14">   mDeleteModel = nsMsgImapDeleteModels::MoveToTrash;</span>
<a href="#l76.15"></a><span id="l76.15">   m_deletingRows = PR_FALSE;</span>
<a href="#l76.16"></a><span id="l76.16">   mNumMessagesRemainingInBatch = 0;</span>
<a href="#l76.17"></a><span id="l76.17">   mShowSizeInLines = PR_FALSE;</span>
<a href="#l76.18"></a><span id="l76.18"> </span>
<a href="#l76.19"></a><span id="l76.19">   /* mCommandsNeedDisablingBecauseOfSelection - A boolean that tell us if we needed to disable commands because of what's selected.</span>
<a href="#l76.20"></a><span id="l76.20">     If we're offline w/o a downloaded msg selected, or a dummy message was selected.</span>
<a href="#l76.21"></a><span id="l76.21">   */</span>
<a href="#l76.22"></a><span id="l76.22" class="difflineat">@@ -1607,17 +1609,17 @@ NS_IMETHODIMP nsMsgDBView::GetCellValue(</span>
<a href="#l76.23"></a><span id="l76.23">       if (flags &amp; nsMsgMessageFlags::Attachment)</span>
<a href="#l76.24"></a><span id="l76.24">         aValue.Adopt(GetString(NS_LITERAL_STRING(&quot;messageHasAttachment&quot;).get()));</span>
<a href="#l76.25"></a><span id="l76.25">       break;</span>
<a href="#l76.26"></a><span id="l76.26">     case 'f': // flagged (starred) column</span>
<a href="#l76.27"></a><span id="l76.27">       if (flags &amp; nsMsgMessageFlags::Marked)</span>
<a href="#l76.28"></a><span id="l76.28">         aValue.Adopt(GetString(NS_LITERAL_STRING(&quot;messageHasFlag&quot;).get()));</span>
<a href="#l76.29"></a><span id="l76.29">       break;</span>
<a href="#l76.30"></a><span id="l76.30">     case 'j': // junk column</span>
<a href="#l76.31"></a><span id="l76.31" class="difflineminus">-      if (!mIsNews)</span>
<a href="#l76.32"></a><span id="l76.32" class="difflineplus">+      if (JunkControlsEnabled(aRow))</span>
<a href="#l76.33"></a><span id="l76.33">       {</span>
<a href="#l76.34"></a><span id="l76.34">         nsCString junkScoreStr;</span>
<a href="#l76.35"></a><span id="l76.35">         msgHdr-&gt;GetStringProperty(&quot;junkscore&quot;, getter_Copies(junkScoreStr));</span>
<a href="#l76.36"></a><span id="l76.36">         // Only need to assing a real value for junk, it's empty already</span>
<a href="#l76.37"></a><span id="l76.37">         // as it should be for non-junk.</span>
<a href="#l76.38"></a><span id="l76.38">         if (!junkScoreStr.IsEmpty() &amp;&amp;</span>
<a href="#l76.39"></a><span id="l76.39">             (junkScoreStr.ToInteger((PRInt32*)&amp;rv) == nsIJunkMailPlugin::IS_SPAM_SCORE))</span>
<a href="#l76.40"></a><span id="l76.40">           aValue.AssignLiteral(&quot;messageJunk&quot;);</span>
<a href="#l76.41"></a><span id="l76.41" class="difflineat">@@ -1981,17 +1983,17 @@ NS_IMETHODIMP nsMsgDBView::CycleCell(PRI</span>
<a href="#l76.42"></a><span id="l76.42">     // toggle the flagged status of the element at row.</span>
<a href="#l76.43"></a><span id="l76.43">     if (m_flags[row] &amp; nsMsgMessageFlags::Marked)</span>
<a href="#l76.44"></a><span id="l76.44">       ApplyCommandToIndices(nsMsgViewCommandType::unflagMessages, (nsMsgViewIndex *) &amp;row, 1);</span>
<a href="#l76.45"></a><span id="l76.45">     else</span>
<a href="#l76.46"></a><span id="l76.46">       ApplyCommandToIndices(nsMsgViewCommandType::flagMessages, (nsMsgViewIndex *) &amp;row, 1);</span>
<a href="#l76.47"></a><span id="l76.47">     break;</span>
<a href="#l76.48"></a><span id="l76.48">   case 'j': // junkStatus column</span>
<a href="#l76.49"></a><span id="l76.49">     {</span>
<a href="#l76.50"></a><span id="l76.50" class="difflineminus">-      if (mIsNews) // junk not supported for news yet.</span>
<a href="#l76.51"></a><span id="l76.51" class="difflineplus">+      if (!JunkControlsEnabled(row))</span>
<a href="#l76.52"></a><span id="l76.52">         return NS_OK;</span>
<a href="#l76.53"></a><span id="l76.53"> </span>
<a href="#l76.54"></a><span id="l76.54">       nsCOMPtr &lt;nsIMsgDBHdr&gt; msgHdr;</span>
<a href="#l76.55"></a><span id="l76.55"> </span>
<a href="#l76.56"></a><span id="l76.56">       nsresult rv = GetMsgHdrForViewIndex(row, getter_AddRefs(msgHdr));</span>
<a href="#l76.57"></a><span id="l76.57">       if (NS_SUCCEEDED(rv) &amp;&amp; msgHdr)</span>
<a href="#l76.58"></a><span id="l76.58">       {</span>
<a href="#l76.59"></a><span id="l76.59">         nsCString junkScoreStr;</span>
<a href="#l76.60"></a><span id="l76.60" class="difflineat">@@ -2068,18 +2070,30 @@ NS_IMETHODIMP nsMsgDBView::Open(nsIMsgFo</span>
<a href="#l76.61"></a><span id="l76.61">     // if yes, we'll show lines instead of size, and special icons in the thread pane</span>
<a href="#l76.62"></a><span id="l76.62">     nsCOMPtr &lt;nsIMsgIncomingServer&gt; server;</span>
<a href="#l76.63"></a><span id="l76.63">     rv = folder-&gt;GetServer(getter_AddRefs(server));</span>
<a href="#l76.64"></a><span id="l76.64">     NS_ENSURE_SUCCESS(rv,rv);</span>
<a href="#l76.65"></a><span id="l76.65">     nsCString type;</span>
<a href="#l76.66"></a><span id="l76.66">     rv = server-&gt;GetType(type);</span>
<a href="#l76.67"></a><span id="l76.67">     NS_ENSURE_SUCCESS(rv,rv);</span>
<a href="#l76.68"></a><span id="l76.68"> </span>
<a href="#l76.69"></a><span id="l76.69" class="difflineplus">+    // I'm not sure this is correct, because XF virtual folders with mixed news</span>
<a href="#l76.70"></a><span id="l76.70" class="difflineplus">+    // and mail can have this set.</span>
<a href="#l76.71"></a><span id="l76.71">     mIsNews = type.LowerCaseEqualsLiteral(&quot;nntp&quot;);</span>
<a href="#l76.72"></a><span id="l76.72"> </span>
<a href="#l76.73"></a><span id="l76.73" class="difflineplus">+    // Default to a virtual folder if folder not set, since synthetic search</span>
<a href="#l76.74"></a><span id="l76.74" class="difflineplus">+    // views may not have a folder.</span>
<a href="#l76.75"></a><span id="l76.75" class="difflineplus">+    PRUint32 folderFlags = nsMsgFolderFlags::Virtual;</span>
<a href="#l76.76"></a><span id="l76.76" class="difflineplus">+    if (folder)</span>
<a href="#l76.77"></a><span id="l76.77" class="difflineplus">+      folder-&gt;GetFlags(&amp;folderFlags);</span>
<a href="#l76.78"></a><span id="l76.78" class="difflineplus">+    mIsXFVirtual = folderFlags &amp; nsMsgFolderFlags::Virtual;</span>
<a href="#l76.79"></a><span id="l76.79" class="difflineplus">+</span>
<a href="#l76.80"></a><span id="l76.80" class="difflineplus">+    if (!mIsXFVirtual &amp;&amp; type.LowerCaseEqualsLiteral(&quot;rss&quot;))</span>
<a href="#l76.81"></a><span id="l76.81" class="difflineplus">+      mIsRss = PR_TRUE;</span>
<a href="#l76.82"></a><span id="l76.82" class="difflineplus">+</span>
<a href="#l76.83"></a><span id="l76.83">     if (type.IsEmpty())</span>
<a href="#l76.84"></a><span id="l76.84">       mMessageTypeAtom = nsnull;</span>
<a href="#l76.85"></a><span id="l76.85">     else  // special case nntp --&gt; news since we'll break themes if we try to be consistent</span>
<a href="#l76.86"></a><span id="l76.86">       mMessageTypeAtom = do_GetAtom(mIsNews ? &quot;news&quot; : type.get());</span>
<a href="#l76.87"></a><span id="l76.87"> </span>
<a href="#l76.88"></a><span id="l76.88">     GetImapDeleteModel(nsnull);</span>
<a href="#l76.89"></a><span id="l76.89"> </span>
<a href="#l76.90"></a><span id="l76.90">     if (mIsNews)</span>
<a href="#l76.91"></a><span id="l76.91" class="difflineat">@@ -2452,17 +2466,18 @@ NS_IMETHODIMP nsMsgDBView::GetCommandSta</span>
<a href="#l76.92"></a><span id="l76.92">   nsMsgViewIndexArray selection;</span>
<a href="#l76.93"></a><span id="l76.93">   GetSelectedIndices(selection);</span>
<a href="#l76.94"></a><span id="l76.94">   PRInt32 numIndices = selection.Length();</span>
<a href="#l76.95"></a><span id="l76.95">   nsMsgViewIndex *indices = selection.Elements();</span>
<a href="#l76.96"></a><span id="l76.96">   // if range count is non-zero, we have at least one item selected, so we have a selection</span>
<a href="#l76.97"></a><span id="l76.97">   if (mTreeSelection &amp;&amp; NS_SUCCEEDED(mTreeSelection-&gt;GetRangeCount(&amp;rangeCount)) &amp;&amp; rangeCount &gt; 0)</span>
<a href="#l76.98"></a><span id="l76.98">     haveSelection = NonDummyMsgSelected(indices, numIndices);</span>
<a href="#l76.99"></a><span id="l76.99">   else</span>
<a href="#l76.100"></a><span id="l76.100" class="difflineminus">-    haveSelection = PR_FALSE;</span>
<a href="#l76.101"></a><span id="l76.101" class="difflineplus">+  // If we don't have a tree selection we must be in stand alone mode.</span>
<a href="#l76.102"></a><span id="l76.102" class="difflineplus">+    haveSelection = m_currentlyDisplayedViewIndex != nsMsgViewIndex_None;</span>
<a href="#l76.103"></a><span id="l76.103"> </span>
<a href="#l76.104"></a><span id="l76.104">   switch (command)</span>
<a href="#l76.105"></a><span id="l76.105">   {</span>
<a href="#l76.106"></a><span id="l76.106">   case nsMsgViewCommandType::deleteMsg:</span>
<a href="#l76.107"></a><span id="l76.107">   case nsMsgViewCommandType::deleteNoTrash:</span>
<a href="#l76.108"></a><span id="l76.108">     {</span>
<a href="#l76.109"></a><span id="l76.109">       PRBool canDelete;</span>
<a href="#l76.110"></a><span id="l76.110">       // news folders can't delete (or move messages)</span>
<a href="#l76.111"></a><span id="l76.111" class="difflineat">@@ -2477,19 +2492,18 @@ NS_IMETHODIMP nsMsgDBView::GetCommandSta</span>
<a href="#l76.112"></a><span id="l76.112">     // disable if no messages</span>
<a href="#l76.113"></a><span id="l76.113">     // XXX todo, check that we have filters, and at least one is enabled</span>
<a href="#l76.114"></a><span id="l76.114">     *selectable_p = GetSize();</span>
<a href="#l76.115"></a><span id="l76.115">     if (*selectable_p)</span>
<a href="#l76.116"></a><span id="l76.116">       *selectable_p = ServerSupportsFilterAfterTheFact();</span>
<a href="#l76.117"></a><span id="l76.117">     break;</span>
<a href="#l76.118"></a><span id="l76.118">   case nsMsgViewCommandType::runJunkControls:</span>
<a href="#l76.119"></a><span id="l76.119">     // disable if no messages</span>
<a href="#l76.120"></a><span id="l76.120" class="difflineminus">-    // no JMC on news yet</span>
<a href="#l76.121"></a><span id="l76.121">     // XXX todo, check that we have JMC enabled?</span>
<a href="#l76.122"></a><span id="l76.122" class="difflineminus">-    *selectable_p = GetSize() &amp;&amp; !mIsNews;</span>
<a href="#l76.123"></a><span id="l76.123" class="difflineplus">+    *selectable_p = GetSize() &amp;&amp; JunkControlsEnabled(nsMsgViewIndex_None);</span>
<a href="#l76.124"></a><span id="l76.124">     break;</span>
<a href="#l76.125"></a><span id="l76.125">   case nsMsgViewCommandType::deleteJunk:</span>
<a href="#l76.126"></a><span id="l76.126">     {</span>
<a href="#l76.127"></a><span id="l76.127">       // disable if no messages, or if we can't delete (like news and certain imap folders)</span>
<a href="#l76.128"></a><span id="l76.128">       PRBool canDelete;</span>
<a href="#l76.129"></a><span id="l76.129">       *selectable_p = GetSize() &amp;&amp; (m_folder &amp;&amp; NS_SUCCEEDED(m_folder-&gt;GetCanDeleteMessages(&amp;canDelete)) &amp;&amp; canDelete);</span>
<a href="#l76.130"></a><span id="l76.130">     }</span>
<a href="#l76.131"></a><span id="l76.131">     break;</span>
<a href="#l76.132"></a><span id="l76.132" class="difflineat">@@ -2500,17 +2514,17 @@ NS_IMETHODIMP nsMsgDBView::GetCommandSta</span>
<a href="#l76.133"></a><span id="l76.133">   case nsMsgViewCommandType::unflagMessages:</span>
<a href="#l76.134"></a><span id="l76.134">   case nsMsgViewCommandType::toggleThreadWatched:</span>
<a href="#l76.135"></a><span id="l76.135">   case nsMsgViewCommandType::markThreadRead:</span>
<a href="#l76.136"></a><span id="l76.136">   case nsMsgViewCommandType::downloadSelectedForOffline:</span>
<a href="#l76.137"></a><span id="l76.137">     *selectable_p = haveSelection;</span>
<a href="#l76.138"></a><span id="l76.138">     break;</span>
<a href="#l76.139"></a><span id="l76.139">   case nsMsgViewCommandType::junk:</span>
<a href="#l76.140"></a><span id="l76.140">   case nsMsgViewCommandType::unjunk:</span>
<a href="#l76.141"></a><span id="l76.141" class="difflineminus">-    *selectable_p = haveSelection &amp;&amp; !mIsNews;  // no junk for news yet</span>
<a href="#l76.142"></a><span id="l76.142" class="difflineplus">+    *selectable_p = haveSelection &amp;&amp; JunkControlsEnabled(selection[0]);</span>
<a href="#l76.143"></a><span id="l76.143">     break;</span>
<a href="#l76.144"></a><span id="l76.144">   case nsMsgViewCommandType::cmdRequiringMsgBody:</span>
<a href="#l76.145"></a><span id="l76.145">     *selectable_p = haveSelection &amp;&amp; (!WeAreOffline() || OfflineMsgSelected(indices, numIndices));</span>
<a href="#l76.146"></a><span id="l76.146">     break;</span>
<a href="#l76.147"></a><span id="l76.147">   case nsMsgViewCommandType::downloadFlaggedForOffline:</span>
<a href="#l76.148"></a><span id="l76.148">   case nsMsgViewCommandType::markAllRead:</span>
<a href="#l76.149"></a><span id="l76.149">     *selectable_p = PR_TRUE;</span>
<a href="#l76.150"></a><span id="l76.150">     break;</span>
<a href="#l76.151"></a><span id="l76.151" class="difflineat">@@ -3759,17 +3773,17 @@ nsresult nsMsgDBView::GetLongField(nsIMs</span>
<a href="#l76.152"></a><span id="l76.152">       {</span>
<a href="#l76.153"></a><span id="l76.153">         NS_ASSERTION(PR_FALSE, &quot;should not be here (Sort Type: byCustom (Long), but no custom handler)&quot;);</span>
<a href="#l76.154"></a><span id="l76.154">         rv = NS_ERROR_UNEXPECTED;</span>
<a href="#l76.155"></a><span id="l76.155">       }</span>
<a href="#l76.156"></a><span id="l76.156">       break;</span>
<a href="#l76.157"></a><span id="l76.157">     case nsMsgViewSortType::byId:</span>
<a href="#l76.158"></a><span id="l76.158">         // handled by caller, since caller knows the key</span>
<a href="#l76.159"></a><span id="l76.159">     default:</span>
<a href="#l76.160"></a><span id="l76.160" class="difflineminus">-        NS_ASSERTION(0,&quot;should not be here&quot;);</span>
<a href="#l76.161"></a><span id="l76.161" class="difflineplus">+        NS_ERROR(&quot;should not be here&quot;);</span>
<a href="#l76.162"></a><span id="l76.162">         rv = NS_ERROR_UNEXPECTED;</span>
<a href="#l76.163"></a><span id="l76.163">         break;</span>
<a href="#l76.164"></a><span id="l76.164">     }</span>
<a href="#l76.165"></a><span id="l76.165"> </span>
<a href="#l76.166"></a><span id="l76.166">     NS_ENSURE_SUCCESS(rv,rv);</span>
<a href="#l76.167"></a><span id="l76.167">     return NS_OK;</span>
<a href="#l76.168"></a><span id="l76.168"> }</span>
<a href="#l76.169"></a><span id="l76.169"> </span>
<a href="#l76.170"></a><span id="l76.170" class="difflineat">@@ -4237,17 +4251,17 @@ NS_IMETHODIMP nsMsgDBView::Sort(nsMsgVie</span>
<a href="#l76.171"></a><span id="l76.171">     {</span>
<a href="#l76.172"></a><span id="l76.172">       case kCollationKey:</span>
<a href="#l76.173"></a><span id="l76.173">         NS_QuickSort(pPtrBase, numSoFar, sizeof(IdKey*), FnSortIdKey, &amp;qsPrivateData);</span>
<a href="#l76.174"></a><span id="l76.174">         break;</span>
<a href="#l76.175"></a><span id="l76.175">       case kU32:</span>
<a href="#l76.176"></a><span id="l76.176">         NS_QuickSort(pPtrBase, numSoFar, sizeof(IdKey*), FnSortIdUint32, &amp;qsPrivateData);</span>
<a href="#l76.177"></a><span id="l76.177">         break;</span>
<a href="#l76.178"></a><span id="l76.178">       default:</span>
<a href="#l76.179"></a><span id="l76.179" class="difflineminus">-        NS_ASSERTION(0, &quot;not supposed to get here&quot;);</span>
<a href="#l76.180"></a><span id="l76.180" class="difflineplus">+        NS_ERROR(&quot;not supposed to get here&quot;);</span>
<a href="#l76.181"></a><span id="l76.181">         break;</span>
<a href="#l76.182"></a><span id="l76.182">     }</span>
<a href="#l76.183"></a><span id="l76.183">   }</span>
<a href="#l76.184"></a><span id="l76.184"> </span>
<a href="#l76.185"></a><span id="l76.185">   // now put the IDs into the array in proper order</span>
<a href="#l76.186"></a><span id="l76.186">   for (PRUint32 i = 0; i &lt; numSoFar; i++)</span>
<a href="#l76.187"></a><span id="l76.187">   {</span>
<a href="#l76.188"></a><span id="l76.188">     m_keys[i] = pPtrBase[i]-&gt;id;</span>
<a href="#l76.189"></a><span id="l76.189" class="difflineat">@@ -5767,17 +5781,17 @@ NS_IMETHODIMP nsMsgDBView::SetSortType(n</span>
<a href="#l76.190"></a><span id="l76.190"> {</span>
<a href="#l76.191"></a><span id="l76.191">     m_sortType = aSortType;</span>
<a href="#l76.192"></a><span id="l76.192">     return NS_OK;</span>
<a href="#l76.193"></a><span id="l76.193"> }</span>
<a href="#l76.194"></a><span id="l76.194"> </span>
<a href="#l76.195"></a><span id="l76.195"> </span>
<a href="#l76.196"></a><span id="l76.196"> NS_IMETHODIMP nsMsgDBView::GetViewType(nsMsgViewTypeValue *aViewType)</span>
<a href="#l76.197"></a><span id="l76.197"> {</span>
<a href="#l76.198"></a><span id="l76.198" class="difflineminus">-    NS_ASSERTION(0,&quot;you should be overriding this\n&quot;);</span>
<a href="#l76.199"></a><span id="l76.199" class="difflineplus">+    NS_ERROR(&quot;you should be overriding this&quot;);</span>
<a href="#l76.200"></a><span id="l76.200">     return NS_ERROR_UNEXPECTED;</span>
<a href="#l76.201"></a><span id="l76.201"> }</span>
<a href="#l76.202"></a><span id="l76.202"> </span>
<a href="#l76.203"></a><span id="l76.203"> NS_IMETHODIMP nsMsgDBView::GetSecondarySortOrder(nsMsgViewSortOrderValue *aSortOrder)</span>
<a href="#l76.204"></a><span id="l76.204"> {</span>
<a href="#l76.205"></a><span id="l76.205">     NS_ENSURE_ARG_POINTER(aSortOrder);</span>
<a href="#l76.206"></a><span id="l76.206">     *aSortOrder = m_secondarySortOrder;</span>
<a href="#l76.207"></a><span id="l76.207">     return NS_OK;</span>
<a href="#l76.208"></a><span id="l76.208" class="difflineat">@@ -6178,17 +6192,17 @@ nsresult nsMsgDBView::NavigateFromPos(ns</span>
<a href="#l76.209"></a><span id="l76.209">             }</span>
<a href="#l76.210"></a><span id="l76.210">           }</span>
<a href="#l76.211"></a><span id="l76.211">           *pResultIndex = nsMsgViewIndex_None;</span>
<a href="#l76.212"></a><span id="l76.212">           *pResultKey = nsMsgKey_None;</span>
<a href="#l76.213"></a><span id="l76.213">           break;</span>
<a href="#l76.214"></a><span id="l76.214"> </span>
<a href="#l76.215"></a><span id="l76.215">         }</span>
<a href="#l76.216"></a><span id="l76.216">         default:</span>
<a href="#l76.217"></a><span id="l76.217" class="difflineminus">-            NS_ASSERTION(0, &quot;unsupported motion&quot;);</span>
<a href="#l76.218"></a><span id="l76.218" class="difflineplus">+            NS_ERROR(&quot;unsupported motion&quot;);</span>
<a href="#l76.219"></a><span id="l76.219">             break;</span>
<a href="#l76.220"></a><span id="l76.220">     }</span>
<a href="#l76.221"></a><span id="l76.221">     return NS_OK;</span>
<a href="#l76.222"></a><span id="l76.222"> }</span>
<a href="#l76.223"></a><span id="l76.223"> </span>
<a href="#l76.224"></a><span id="l76.224"> NS_IMETHODIMP nsMsgDBView::NavigateStatus(nsMsgNavigationTypeValue motion, PRBool *_retval)</span>
<a href="#l76.225"></a><span id="l76.225"> {</span>
<a href="#l76.226"></a><span id="l76.226">     NS_ENSURE_ARG_POINTER(_retval);</span>
<a href="#l76.227"></a><span id="l76.227" class="difflineat">@@ -6269,17 +6283,17 @@ NS_IMETHODIMP nsMsgDBView::NavigateStatu</span>
<a href="#l76.228"></a><span id="l76.228">             else</span>
<a href="#l76.229"></a><span id="l76.229">               desiredPos--; //? operator code didn't work for me</span>
<a href="#l76.230"></a><span id="l76.230">             enable = (desiredPos &gt;= 0 &amp;&amp; desiredPos &lt; (PRInt32) historyCount / 2);</span>
<a href="#l76.231"></a><span id="l76.231">           }</span>
<a href="#l76.232"></a><span id="l76.232">         }</span>
<a href="#l76.233"></a><span id="l76.233">           break;</span>
<a href="#l76.234"></a><span id="l76.234"> </span>
<a href="#l76.235"></a><span id="l76.235">         default:</span>
<a href="#l76.236"></a><span id="l76.236" class="difflineminus">-            NS_ASSERTION(0,&quot;unexpected&quot;);</span>
<a href="#l76.237"></a><span id="l76.237" class="difflineplus">+            NS_ERROR(&quot;unexpected&quot;);</span>
<a href="#l76.238"></a><span id="l76.238">             break;</span>
<a href="#l76.239"></a><span id="l76.239">     }</span>
<a href="#l76.240"></a><span id="l76.240"> </span>
<a href="#l76.241"></a><span id="l76.241">     *_retval = enable;</span>
<a href="#l76.242"></a><span id="l76.242">     return NS_OK;</span>
<a href="#l76.243"></a><span id="l76.243"> }</span>
<a href="#l76.244"></a><span id="l76.244"> </span>
<a href="#l76.245"></a><span id="l76.245"> // Note that these routines do NOT expand collapsed threads! This mimics the old behaviour,</span>
<a href="#l76.246"></a><span id="l76.246" class="difflineat">@@ -6338,17 +6352,17 @@ nsresult nsMsgDBView::FindPrevUnread(nsM</span>
<a href="#l76.247"></a><span id="l76.247">         *resultThreadId = nsMsgKey_None;</span>
<a href="#l76.248"></a><span id="l76.248"> </span>
<a href="#l76.249"></a><span id="l76.249">     for (; (int) curIndex &gt;= 0 &amp;&amp; (*pResultKey == nsMsgKey_None); curIndex--)</span>
<a href="#l76.250"></a><span id="l76.250">     {</span>
<a href="#l76.251"></a><span id="l76.251">         PRUint32 flags = m_flags[curIndex];</span>
<a href="#l76.252"></a><span id="l76.252"> </span>
<a href="#l76.253"></a><span id="l76.253">         if (curIndex != startIndex &amp;&amp; flags &amp; MSG_VIEW_FLAG_ISTHREAD &amp;&amp; flags &amp; nsMsgMessageFlags::Elided)</span>
<a href="#l76.254"></a><span id="l76.254">         {</span>
<a href="#l76.255"></a><span id="l76.255" class="difflineminus">-            NS_ASSERTION(0,&quot;fix this&quot;);</span>
<a href="#l76.256"></a><span id="l76.256" class="difflineplus">+            NS_ERROR(&quot;fix this&quot;);</span>
<a href="#l76.257"></a><span id="l76.257">             //nsMsgKey threadId = m_keys[curIndex];</span>
<a href="#l76.258"></a><span id="l76.258">             //rv = m_db-&gt;GetUnreadKeyInThread(threadId, pResultKey, resultThreadId);</span>
<a href="#l76.259"></a><span id="l76.259">             if (NS_SUCCEEDED(rv) &amp;&amp; (*pResultKey != nsMsgKey_None))</span>
<a href="#l76.260"></a><span id="l76.260">                 break;</span>
<a href="#l76.261"></a><span id="l76.261">         }</span>
<a href="#l76.262"></a><span id="l76.262">         if (!(flags &amp; (nsMsgMessageFlags::Read | MSG_VIEW_FLAG_DUMMY)) &amp;&amp; (curIndex != startIndex))</span>
<a href="#l76.263"></a><span id="l76.263">         {</span>
<a href="#l76.264"></a><span id="l76.264">             *pResultKey = m_keys[curIndex];</span>
<a href="#l76.265"></a><span id="l76.265" class="difflineat">@@ -7130,16 +7144,18 @@ nsresult nsMsgDBView::CopyDBView(nsMsgDB</span>
<a href="#l76.266"></a><span id="l76.266">   aNewMsgDBView-&gt;m_viewFlags = m_viewFlags;</span>
<a href="#l76.267"></a><span id="l76.267">   aNewMsgDBView-&gt;m_sortOrder = m_sortOrder;</span>
<a href="#l76.268"></a><span id="l76.268">   aNewMsgDBView-&gt;m_sortType = m_sortType;</span>
<a href="#l76.269"></a><span id="l76.269">   aNewMsgDBView-&gt;m_db = m_db;</span>
<a href="#l76.270"></a><span id="l76.270">   aNewMsgDBView-&gt;mDateFormatter = mDateFormatter;</span>
<a href="#l76.271"></a><span id="l76.271">   if (m_db)</span>
<a href="#l76.272"></a><span id="l76.272">     aNewMsgDBView-&gt;m_db-&gt;AddListener(aNewMsgDBView);</span>
<a href="#l76.273"></a><span id="l76.273">   aNewMsgDBView-&gt;mIsNews = mIsNews;</span>
<a href="#l76.274"></a><span id="l76.274" class="difflineplus">+  aNewMsgDBView-&gt;mIsRss = mIsRss;</span>
<a href="#l76.275"></a><span id="l76.275" class="difflineplus">+  aNewMsgDBView-&gt;mIsXFVirtual = mIsXFVirtual;</span>
<a href="#l76.276"></a><span id="l76.276">   aNewMsgDBView-&gt;mShowSizeInLines = mShowSizeInLines;</span>
<a href="#l76.277"></a><span id="l76.277">   aNewMsgDBView-&gt;mHeaderParser = mHeaderParser;</span>
<a href="#l76.278"></a><span id="l76.278">   aNewMsgDBView-&gt;mDeleteModel = mDeleteModel;</span>
<a href="#l76.279"></a><span id="l76.279">   aNewMsgDBView-&gt;m_flags = m_flags;</span>
<a href="#l76.280"></a><span id="l76.280">   aNewMsgDBView-&gt;m_levels = m_levels;</span>
<a href="#l76.281"></a><span id="l76.281">   aNewMsgDBView-&gt;m_keys = m_keys;</span>
<a href="#l76.282"></a><span id="l76.282"> </span>
<a href="#l76.283"></a><span id="l76.283">   aNewMsgDBView-&gt;m_customColumnHandlerIDs = m_customColumnHandlerIDs;</span>
<a href="#l76.284"></a><span id="l76.284" class="difflineat">@@ -7292,8 +7308,51 @@ NS_IMETHODIMP nsMsgDBView::nsMsgViewHdrE</span>
<a href="#l76.285"></a><span id="l76.285">   return NS_OK;</span>
<a href="#l76.286"></a><span id="l76.286"> }</span>
<a href="#l76.287"></a><span id="l76.287"> </span>
<a href="#l76.288"></a><span id="l76.288"> nsresult nsMsgDBView::GetViewEnumerator(nsISimpleEnumerator **enumerator)</span>
<a href="#l76.289"></a><span id="l76.289"> {</span>
<a href="#l76.290"></a><span id="l76.290">   NS_IF_ADDREF(*enumerator = new nsMsgViewHdrEnumerator(this));</span>
<a href="#l76.291"></a><span id="l76.291">   return (*enumerator) ? NS_OK : NS_ERROR_OUT_OF_MEMORY;</span>
<a href="#l76.292"></a><span id="l76.292"> }</span>
<a href="#l76.293"></a><span id="l76.293" class="difflineplus">+</span>
<a href="#l76.294"></a><span id="l76.294" class="difflineplus">+/**</span>
<a href="#l76.295"></a><span id="l76.295" class="difflineplus">+ * Determine whether junk commands should be enabled on this view.</span>
<a href="#l76.296"></a><span id="l76.296" class="difflineplus">+ * Junk commands are always enabled for mail. For nntp and rss, they</span>
<a href="#l76.297"></a><span id="l76.297" class="difflineplus">+ * may be selectively enabled using an inherited folder property.</span>
<a href="#l76.298"></a><span id="l76.298" class="difflineplus">+ *</span>
<a href="#l76.299"></a><span id="l76.299" class="difflineplus">+ * @param  aViewIndex  view index of the message to check</span>
<a href="#l76.300"></a><span id="l76.300" class="difflineplus">+ * @return             PR_TRUE if junk controls should be enabled</span>
<a href="#l76.301"></a><span id="l76.301" class="difflineplus">+ */</span>
<a href="#l76.302"></a><span id="l76.302" class="difflineplus">+PRBool nsMsgDBView::JunkControlsEnabled(nsMsgViewIndex aViewIndex)</span>
<a href="#l76.303"></a><span id="l76.303" class="difflineplus">+{</span>
<a href="#l76.304"></a><span id="l76.304" class="difflineplus">+  // For normal mail, junk commands are always enabled.</span>
<a href="#l76.305"></a><span id="l76.305" class="difflineplus">+  if (!(mIsNews || mIsRss || mIsXFVirtual))</span>
<a href="#l76.306"></a><span id="l76.306" class="difflineplus">+    return PR_TRUE;</span>
<a href="#l76.307"></a><span id="l76.307" class="difflineplus">+</span>
<a href="#l76.308"></a><span id="l76.308" class="difflineplus">+  // we need to check per message or folder</span>
<a href="#l76.309"></a><span id="l76.309" class="difflineplus">+  nsCOMPtr &lt;nsIMsgFolder&gt; folder = m_folder;</span>
<a href="#l76.310"></a><span id="l76.310" class="difflineplus">+  if (!folder &amp;&amp; aViewIndex != nsMsgViewIndex_None)</span>
<a href="#l76.311"></a><span id="l76.311" class="difflineplus">+    GetFolderForViewIndex(aViewIndex, getter_AddRefs(folder));</span>
<a href="#l76.312"></a><span id="l76.312" class="difflineplus">+  if (folder)</span>
<a href="#l76.313"></a><span id="l76.313" class="difflineplus">+  {</span>
<a href="#l76.314"></a><span id="l76.314" class="difflineplus">+    // Check if this is a mail message in search folders.</span>
<a href="#l76.315"></a><span id="l76.315" class="difflineplus">+    if (mIsXFVirtual)</span>
<a href="#l76.316"></a><span id="l76.316" class="difflineplus">+    {</span>
<a href="#l76.317"></a><span id="l76.317" class="difflineplus">+      nsCOMPtr &lt;nsIMsgIncomingServer&gt; server;</span>
<a href="#l76.318"></a><span id="l76.318" class="difflineplus">+      folder-&gt;GetServer(getter_AddRefs(server));</span>
<a href="#l76.319"></a><span id="l76.319" class="difflineplus">+      nsCAutoString type;</span>
<a href="#l76.320"></a><span id="l76.320" class="difflineplus">+      if (server)</span>
<a href="#l76.321"></a><span id="l76.321" class="difflineplus">+        server-&gt;GetType(type);</span>
<a href="#l76.322"></a><span id="l76.322" class="difflineplus">+      if (!(type.LowerCaseEqualsLiteral(&quot;nntp&quot;) || type.LowerCaseEqualsLiteral(&quot;rss&quot;)))</span>
<a href="#l76.323"></a><span id="l76.323" class="difflineplus">+        return PR_TRUE;</span>
<a href="#l76.324"></a><span id="l76.324" class="difflineplus">+    }</span>
<a href="#l76.325"></a><span id="l76.325" class="difflineplus">+</span>
<a href="#l76.326"></a><span id="l76.326" class="difflineplus">+    // For rss and news, check the inherited folder property.</span>
<a href="#l76.327"></a><span id="l76.327" class="difflineplus">+    nsCAutoString junkEnableOverride;</span>
<a href="#l76.328"></a><span id="l76.328" class="difflineplus">+    folder-&gt;GetInheritedStringProperty(&quot;dobayes.mailnews@mozilla.org#junk&quot;,</span>
<a href="#l76.329"></a><span id="l76.329" class="difflineplus">+                                       junkEnableOverride);</span>
<a href="#l76.330"></a><span id="l76.330" class="difflineplus">+    if (junkEnableOverride.EqualsLiteral(&quot;true&quot;))</span>
<a href="#l76.331"></a><span id="l76.331" class="difflineplus">+      return PR_TRUE;</span>
<a href="#l76.332"></a><span id="l76.332" class="difflineplus">+  }</span>
<a href="#l76.333"></a><span id="l76.333" class="difflineplus">+</span>
<a href="#l76.334"></a><span id="l76.334" class="difflineplus">+  return PR_FALSE;</span>
<a href="#l76.335"></a><span id="l76.335" class="difflineplus">+}</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l77.1"></a><span id="l77.1" class="difflineminus">--- a/mailnews/base/src/nsMsgDBView.h</span>
<a href="#l77.2"></a><span id="l77.2" class="difflineplus">+++ b/mailnews/base/src/nsMsgDBView.h</span>
<a href="#l77.3"></a><span id="l77.3" class="difflineat">@@ -374,16 +374,18 @@ protected:</span>
<a href="#l77.4"></a><span id="l77.4">   virtual void OnHeaderAddedOrDeleted() {}	</span>
<a href="#l77.5"></a><span id="l77.5">   nsresult ToggleWatched( nsMsgViewIndex* indices,	PRInt32 numIndices);</span>
<a href="#l77.6"></a><span id="l77.6">   nsresult SetThreadWatched(nsIMsgThread *thread, nsMsgViewIndex index, PRBool watched);</span>
<a href="#l77.7"></a><span id="l77.7">   nsresult SetThreadIgnored(nsIMsgThread *thread, nsMsgViewIndex threadIndex, PRBool ignored);</span>
<a href="#l77.8"></a><span id="l77.8">   nsresult SetSubthreadKilled(nsIMsgDBHdr *header, nsMsgViewIndex msgIndex, PRBool ignored);</span>
<a href="#l77.9"></a><span id="l77.9">   nsresult DownloadForOffline(nsIMsgWindow *window, nsMsgViewIndex *indices, PRInt32 numIndices);</span>
<a href="#l77.10"></a><span id="l77.10">   nsresult DownloadFlaggedForOffline(nsIMsgWindow *window);</span>
<a href="#l77.11"></a><span id="l77.11">   nsMsgViewIndex	GetThreadFromMsgIndex(nsMsgViewIndex index, nsIMsgThread **threadHdr);</span>
<a href="#l77.12"></a><span id="l77.12" class="difflineplus">+  /// Should junk commands be enabled for the current message in the view?</span>
<a href="#l77.13"></a><span id="l77.13" class="difflineplus">+  PRBool JunkControlsEnabled(nsMsgViewIndex aViewIndex);</span>
<a href="#l77.14"></a><span id="l77.14"> </span>
<a href="#l77.15"></a><span id="l77.15">   // for sorting</span>
<a href="#l77.16"></a><span id="l77.16">   nsresult GetFieldTypeAndLenForSort(nsMsgViewSortTypeValue sortType, PRUint16 *pMaxLen, eFieldType *pFieldType);</span>
<a href="#l77.17"></a><span id="l77.17">   nsresult GetCollationKey(nsIMsgDBHdr *msgHdr, nsMsgViewSortTypeValue sortType, PRUint8 **result, </span>
<a href="#l77.18"></a><span id="l77.18">                           PRUint32 *len, nsIMsgCustomColumnHandler* colHandler = nsnull);</span>
<a href="#l77.19"></a><span id="l77.19">   nsresult GetLongField(nsIMsgDBHdr *msgHdr, nsMsgViewSortTypeValue sortType, PRUint32 *result, </span>
<a href="#l77.20"></a><span id="l77.20">                           nsIMsgCustomColumnHandler* colHandler = nsnull);</span>
<a href="#l77.21"></a><span id="l77.21">   static int FnSortIdKey(const void *pItem1, const void *pItem2, void *privateData);</span>
<a href="#l77.22"></a><span id="l77.22" class="difflineat">@@ -440,17 +442,22 @@ protected:</span>
<a href="#l77.23"></a><span id="l77.23">   nsMsgViewIndex          m_currentlyDisplayedViewIndex;</span>
<a href="#l77.24"></a><span id="l77.24">   // if we're deleting messages, we want to hold off loading messages on selection changed until the delete is done</span>
<a href="#l77.25"></a><span id="l77.25">   // and we want to batch notifications.</span>
<a href="#l77.26"></a><span id="l77.26">   PRPackedBool m_deletingRows;</span>
<a href="#l77.27"></a><span id="l77.27">   // for certain special folders </span>
<a href="#l77.28"></a><span id="l77.28">   // and decendents of those folders</span>
<a href="#l77.29"></a><span id="l77.29">   // (like the &quot;Sent&quot; folder, &quot;Sent/Old Sent&quot;)</span>
<a href="#l77.30"></a><span id="l77.30">   // the Sender column really shows recipients.</span>
<a href="#l77.31"></a><span id="l77.31" class="difflineplus">+</span>
<a href="#l77.32"></a><span id="l77.32" class="difflineplus">+  // Server types for this view's folder</span>
<a href="#l77.33"></a><span id="l77.33">   PRPackedBool mIsNews;             // we have special icons for news</span>
<a href="#l77.34"></a><span id="l77.34" class="difflineplus">+  PRPackedBool mIsRss;              // rss affects enabling of junk commands</span>
<a href="#l77.35"></a><span id="l77.35" class="difflineplus">+  PRPackedBool mIsXFVirtual;        // a virtual folder with multiple folders</span>
<a href="#l77.36"></a><span id="l77.36" class="difflineplus">+</span>
<a href="#l77.37"></a><span id="l77.37">   PRPackedBool mShowSizeInLines;    // for news we show lines instead of size when true</span>
<a href="#l77.38"></a><span id="l77.38">   PRPackedBool m_sortValid;</span>
<a href="#l77.39"></a><span id="l77.39">   PRPackedBool mSelectionSummarized;</span>
<a href="#l77.40"></a><span id="l77.40">   // we asked the front end to summarize the selection and it did not.</span>
<a href="#l77.41"></a><span id="l77.41">   PRPackedBool mSummarizeFailed;</span>
<a href="#l77.42"></a><span id="l77.42">   PRUint8      m_saveRestoreSelectionDepth;</span>
<a href="#l77.43"></a><span id="l77.43"> </span>
<a href="#l77.44"></a><span id="l77.44">   nsCOMPtr &lt;nsIMsgDatabase&gt; m_db;</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l78.1"></a><span id="l78.1" class="difflineminus">--- a/mailnews/base/src/nsMsgMailSession.cpp</span>
<a href="#l78.2"></a><span id="l78.2" class="difflineplus">+++ b/mailnews/base/src/nsMsgMailSession.cpp</span>
<a href="#l78.3"></a><span id="l78.3" class="difflineat">@@ -391,18 +391,19 @@ NS_IMETHODIMP nsMsgMailSession::AddMsgWi</span>
<a href="#l78.4"></a><span id="l78.4">   return NS_OK;</span>
<a href="#l78.5"></a><span id="l78.5"> }</span>
<a href="#l78.6"></a><span id="l78.6"> </span>
<a href="#l78.7"></a><span id="l78.7"> NS_IMETHODIMP nsMsgMailSession::RemoveMsgWindow(nsIMsgWindow *msgWindow)</span>
<a href="#l78.8"></a><span id="l78.8"> {</span>
<a href="#l78.9"></a><span id="l78.9">   mWindows.RemoveObject(msgWindow);</span>
<a href="#l78.10"></a><span id="l78.10">   // Mac keeps a hidden window open so the app doesn't shut down when</span>
<a href="#l78.11"></a><span id="l78.11">   // the last window is closed. So don't shutdown the account manager in that</span>
<a href="#l78.12"></a><span id="l78.12" class="difflineminus">-  // case.</span>
<a href="#l78.13"></a><span id="l78.13" class="difflineminus">-#ifndef XP_MACOSX</span>
<a href="#l78.14"></a><span id="l78.14" class="difflineplus">+  // case. Similarly, for suite, we don't want to disable mailnews when the</span>
<a href="#l78.15"></a><span id="l78.15" class="difflineplus">+  // last mail window is closed.</span>
<a href="#l78.16"></a><span id="l78.16" class="difflineplus">+#if !defined(XP_MACOSX) &amp;&amp; !defined(MOZ_SUITE)</span>
<a href="#l78.17"></a><span id="l78.17">   if (!mWindows.Count())</span>
<a href="#l78.18"></a><span id="l78.18">   {</span>
<a href="#l78.19"></a><span id="l78.19">     nsresult rv;</span>
<a href="#l78.20"></a><span id="l78.20">     nsCOMPtr&lt;nsIMsgAccountManager&gt; accountManager = </span>
<a href="#l78.21"></a><span id="l78.21">       do_GetService(NS_MSGACCOUNTMANAGER_CONTRACTID, &amp;rv);</span>
<a href="#l78.22"></a><span id="l78.22">     if (NS_FAILED(rv))</span>
<a href="#l78.23"></a><span id="l78.23">       return rv;</span>
<a href="#l78.24"></a><span id="l78.24">     accountManager-&gt;CleanupOnExit();</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l79.1"></a><span id="l79.1" class="difflineminus">--- a/mailnews/base/src/searchSpec.js</span>
<a href="#l79.2"></a><span id="l79.2" class="difflineplus">+++ b/mailnews/base/src/searchSpec.js</span>
<a href="#l79.3"></a><span id="l79.3" class="difflineat">@@ -375,52 +375,64 @@ SearchSpec.prototype = {</span>
<a href="#l79.4"></a><span id="l79.4">     //  MatchHdr.</span>
<a href="#l79.5"></a><span id="l79.5">     if (this.owner.isSynthetic) {</span>
<a href="#l79.6"></a><span id="l79.6">       // We don't want to pass in a folder, and we don't want to use the</span>
<a href="#l79.7"></a><span id="l79.7">       //  allSearchableGroups scope, so we cheat and use AddDirectoryScopeTerm.</span>
<a href="#l79.8"></a><span id="l79.8">       session.addDirectoryScopeTerm(nsMsgSearchScope.offlineMail);</span>
<a href="#l79.9"></a><span id="l79.9">       return;</span>
<a href="#l79.10"></a><span id="l79.10">     }</span>
<a href="#l79.11"></a><span id="l79.11"> </span>
<a href="#l79.12"></a><span id="l79.12" class="difflineminus">-    // We are filtering if we have mail view terms or user terms.  When</span>
<a href="#l79.13"></a><span id="l79.13" class="difflineminus">-    //  filtering, we bias towards offline search.  The only time we would use</span>
<a href="#l79.14"></a><span id="l79.14" class="difflineminus">-    //  an online search when filtering is if one of the constraints uses the</span>
<a href="#l79.15"></a><span id="l79.15" class="difflineminus">-    //  body attribute and the folder is not marked for offline access.</span>
<a href="#l79.16"></a><span id="l79.16" class="difflineminus">-    // We are not filtering if we only have virtual folder terms, in which case</span>
<a href="#l79.17"></a><span id="l79.17" class="difflineminus">-    //  we honor the onlineSearch attribute.  This means that we use the</span>
<a href="#l79.18"></a><span id="l79.18" class="difflineminus">-    //  folder's server's searchScope if the folder is not explicitly marked</span>
<a href="#l79.19"></a><span id="l79.19" class="difflineminus">-    //  offline.</span>
<a href="#l79.20"></a><span id="l79.20" class="difflineminus">-    // For further discussion on this choice of logic, please read from:</span>
<a href="#l79.21"></a><span id="l79.21" class="difflineminus">-    //  https://bugzilla.mozilla.org/show_bug.cgi?id=474701#c73</span>
<a href="#l79.22"></a><span id="l79.22" class="difflineminus">-    let filtering = this._virtualFolderTerms == null &amp;&amp;</span>
<a href="#l79.23"></a><span id="l79.23" class="difflineminus">-                    this._viewTerms == null;</span>
<a href="#l79.24"></a><span id="l79.24" class="difflineminus">-</span>
<a href="#l79.25"></a><span id="l79.25">     let ioService = Cc[&quot;@mozilla.org/network/io-service;1&quot;]</span>
<a href="#l79.26"></a><span id="l79.26">                       .getService(Ci.nsIIOService);</span>
<a href="#l79.27"></a><span id="l79.27" class="difflineplus">+    let validityManager = Cc['@mozilla.org/mail/search/validityManager;1']</span>
<a href="#l79.28"></a><span id="l79.28" class="difflineplus">+                            .getService(Ci.nsIMsgSearchValidityManager);</span>
<a href="#l79.29"></a><span id="l79.29">     for each (let [, folder] in Iterator(this.owner._underlyingFolders)) {</span>
<a href="#l79.30"></a><span id="l79.30">       // we do not need to check isServer here because _underlyingFolders</span>
<a href="#l79.31"></a><span id="l79.31">       //  filtered it out when it was initialized.</span>
<a href="#l79.32"></a><span id="l79.32"> </span>
<a href="#l79.33"></a><span id="l79.33">       let scope;</span>
<a href="#l79.34"></a><span id="l79.34" class="difflineminus">-      let folderIsOffline = (folder instanceof nsIMsgLocalMailFolder) ||</span>
<a href="#l79.35"></a><span id="l79.35" class="difflineminus">-                            (folder.flags &amp; nsMsgFolderFlags.Offline) ||</span>
<a href="#l79.36"></a><span id="l79.36" class="difflineminus">-                            ioService.offline;</span>
<a href="#l79.37"></a><span id="l79.37" class="difflineminus">-      // To restate the above logic into simpler rules, the scope is definitely</span>
<a href="#l79.38"></a><span id="l79.38" class="difflineminus">-      //  offline if:</span>
<a href="#l79.39"></a><span id="l79.39" class="difflineminus">-      // - Folders available offline always use offline search.</span>
<a href="#l79.40"></a><span id="l79.40" class="difflineminus">-      // - If we are filtering and don't have a body term, use offline search.</span>
<a href="#l79.41"></a><span id="l79.41" class="difflineminus">-      // - If we are not filtering and our virtual folder is not marked for</span>
<a href="#l79.42"></a><span id="l79.42" class="difflineminus">-      //   onlineSearch.</span>
<a href="#l79.43"></a><span id="l79.43" class="difflineminus">-      if (folderIsOffline ||</span>
<a href="#l79.44"></a><span id="l79.44" class="difflineminus">-          (filtering &amp;&amp; !haveBodyTerm) ||</span>
<a href="#l79.45"></a><span id="l79.45" class="difflineminus">-          (!filtering &amp;&amp; !this.onlineSearch))</span>
<a href="#l79.46"></a><span id="l79.46" class="difflineminus">-        scope = nsMsgSearchScope.offlineMail;</span>
<a href="#l79.47"></a><span id="l79.47" class="difflineminus">-      // Otherwise, it's up to the folder's sever's searchScope.</span>
<a href="#l79.48"></a><span id="l79.48" class="difflineminus">-      else</span>
<a href="#l79.49"></a><span id="l79.49" class="difflineminus">-        scope = folder.server.searchScope;</span>
<a href="#l79.50"></a><span id="l79.50" class="difflineplus">+      let serverScope = folder.server.searchScope;</span>
<a href="#l79.51"></a><span id="l79.51" class="difflineplus">+      // If we're offline, or this is a local folder, or there's no separate</span>
<a href="#l79.52"></a><span id="l79.52" class="difflineplus">+      //  online scope, use server scope.</span>
<a href="#l79.53"></a><span id="l79.53" class="difflineplus">+      if (ioService.offline || (serverScope == nsMsgSearchScope.offlineMail) ||</span>
<a href="#l79.54"></a><span id="l79.54" class="difflineplus">+                               (folder instanceof nsIMsgLocalMailFolder))</span>
<a href="#l79.55"></a><span id="l79.55" class="difflineplus">+        scope = serverScope;</span>
<a href="#l79.56"></a><span id="l79.56" class="difflineplus">+      else {</span>
<a href="#l79.57"></a><span id="l79.57" class="difflineplus">+        // we need to test the validity in online and offline tables</span>
<a href="#l79.58"></a><span id="l79.58" class="difflineplus">+        let onlineValidityTable = validityManager.getTable(serverScope);</span>
<a href="#l79.59"></a><span id="l79.59" class="difflineplus">+</span>
<a href="#l79.60"></a><span id="l79.60" class="difflineplus">+        let offlineScope;</span>
<a href="#l79.61"></a><span id="l79.61" class="difflineplus">+        if (folder.flags &amp; nsMsgFolderFlags.Offline)</span>
<a href="#l79.62"></a><span id="l79.62" class="difflineplus">+          offlineScope = nsMsgSearchScope.offlineMail;</span>
<a href="#l79.63"></a><span id="l79.63" class="difflineplus">+        else</span>
<a href="#l79.64"></a><span id="l79.64" class="difflineplus">+          // The onlineManual table is used for local search when there is no</span>
<a href="#l79.65"></a><span id="l79.65" class="difflineplus">+          //  body available.</span>
<a href="#l79.66"></a><span id="l79.66" class="difflineplus">+          offlineScope = nsMsgSearchScope.onlineManual;</span>
<a href="#l79.67"></a><span id="l79.67" class="difflineplus">+</span>
<a href="#l79.68"></a><span id="l79.68" class="difflineplus">+        let offlineValidityTable = validityManager.getTable(offlineScope);</span>
<a href="#l79.69"></a><span id="l79.69" class="difflineplus">+        let offlineAvailable = true;</span>
<a href="#l79.70"></a><span id="l79.70" class="difflineplus">+        let onlineAvailable = true;</span>
<a href="#l79.71"></a><span id="l79.71" class="difflineplus">+        for each (let term in fixIterator(session.searchTerms,</span>
<a href="#l79.72"></a><span id="l79.72" class="difflineplus">+                                          nsIMsgSearchTerm)) {</span>
<a href="#l79.73"></a><span id="l79.73" class="difflineplus">+          if (!term.matchAll) {</span>
<a href="#l79.74"></a><span id="l79.74" class="difflineplus">+            if (!offlineValidityTable.getAvailable(term.attrib, term.op))</span>
<a href="#l79.75"></a><span id="l79.75" class="difflineplus">+              offlineAvailable = false;</span>
<a href="#l79.76"></a><span id="l79.76" class="difflineplus">+            if (!onlineValidityTable.getAvailable(term.attrib, term.op))</span>
<a href="#l79.77"></a><span id="l79.77" class="difflineplus">+              onlineAvailable = false;</span>
<a href="#l79.78"></a><span id="l79.78" class="difflineplus">+          }</span>
<a href="#l79.79"></a><span id="l79.79" class="difflineplus">+        }</span>
<a href="#l79.80"></a><span id="l79.80" class="difflineplus">+        // If both scopes work, honor the onlineSearch request</span>
<a href="#l79.81"></a><span id="l79.81" class="difflineplus">+        if (onlineAvailable &amp;&amp; offlineAvailable)</span>
<a href="#l79.82"></a><span id="l79.82" class="difflineplus">+          scope = this.onlineSearch ? serverScope : offlineScope;</span>
<a href="#l79.83"></a><span id="l79.83" class="difflineplus">+        // If only one works, use it. Otherwise, default to offline</span>
<a href="#l79.84"></a><span id="l79.84" class="difflineplus">+        else if (onlineAvailable)</span>
<a href="#l79.85"></a><span id="l79.85" class="difflineplus">+          scope = serverScope;</span>
<a href="#l79.86"></a><span id="l79.86" class="difflineplus">+        else</span>
<a href="#l79.87"></a><span id="l79.87" class="difflineplus">+          scope = offlineScope;</span>
<a href="#l79.88"></a><span id="l79.88" class="difflineplus">+      }</span>
<a href="#l79.89"></a><span id="l79.89">       session.addScopeTerm(scope, folder);</span>
<a href="#l79.90"></a><span id="l79.90">     }</span>
<a href="#l79.91"></a><span id="l79.91">   },</span>
<a href="#l79.92"></a><span id="l79.92"> </span>
<a href="#l79.93"></a><span id="l79.93">   prettyStringOfSearchTerms: function(aSearchTerms) {</span>
<a href="#l79.94"></a><span id="l79.94">     if (aSearchTerms == null)</span>
<a href="#l79.95"></a><span id="l79.95">       return '      (none)\n';</span>
<a href="#l79.96"></a><span id="l79.96"> </span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l80.1"></a><span id="l80.1" class="difflineminus">--- a/mailnews/base/util/nsMsgI18N.cpp</span>
<a href="#l80.2"></a><span id="l80.2" class="difflineplus">+++ b/mailnews/base/util/nsMsgI18N.cpp</span>
<a href="#l80.3"></a><span id="l80.3" class="difflineat">@@ -335,17 +335,17 @@ nsMsgI18NParseMetaCharset(nsILocalFile* </span>
<a href="#l80.4"></a><span id="l80.4"> { </span>
<a href="#l80.5"></a><span id="l80.5">   static char charset[nsIMimeConverter::MAX_CHARSET_NAME_LENGTH+1];</span>
<a href="#l80.6"></a><span id="l80.6"> </span>
<a href="#l80.7"></a><span id="l80.7">   *charset = '\0'; </span>
<a href="#l80.8"></a><span id="l80.8"> </span>
<a href="#l80.9"></a><span id="l80.9">   PRBool isDirectory = PR_FALSE;</span>
<a href="#l80.10"></a><span id="l80.10">   file-&gt;IsDirectory(&amp;isDirectory);</span>
<a href="#l80.11"></a><span id="l80.11">   if (isDirectory) {</span>
<a href="#l80.12"></a><span id="l80.12" class="difflineminus">-    NS_ASSERTION(0,&quot;file is a directory&quot;);</span>
<a href="#l80.13"></a><span id="l80.13" class="difflineplus">+    NS_ERROR(&quot;file is a directory&quot;);</span>
<a href="#l80.14"></a><span id="l80.14">     return charset; </span>
<a href="#l80.15"></a><span id="l80.15">   }</span>
<a href="#l80.16"></a><span id="l80.16"> </span>
<a href="#l80.17"></a><span id="l80.17">   nsresult rv;</span>
<a href="#l80.18"></a><span id="l80.18">   nsCOMPtr &lt;nsIFileInputStream&gt; fileStream = do_CreateInstance(NS_LOCALFILEINPUTSTREAM_CONTRACTID, &amp;rv);</span>
<a href="#l80.19"></a><span id="l80.19">   NS_ENSURE_SUCCESS(rv, charset);</span>
<a href="#l80.20"></a><span id="l80.20">   </span>
<a href="#l80.21"></a><span id="l80.21">   rv = fileStream-&gt;Init(file, PR_RDONLY, 0664, PR_FALSE);</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l81.1"></a><span id="l81.1" class="difflineminus">--- a/mailnews/base/util/nsMsgIncomingServer.cpp</span>
<a href="#l81.2"></a><span id="l81.2" class="difflineplus">+++ b/mailnews/base/util/nsMsgIncomingServer.cpp</span>
<a href="#l81.3"></a><span id="l81.3" class="difflineat">@@ -756,21 +756,19 @@ void nsMsgIncomingServer::GetPasswordWit</span>
<a href="#l81.4"></a><span id="l81.4">     NS_FREE_XPCOM_ISUPPORTS_POINTER_ARRAY(numLogins, logins);</span>
<a href="#l81.5"></a><span id="l81.5">   }</span>
<a href="#l81.6"></a><span id="l81.6"> }</span>
<a href="#l81.7"></a><span id="l81.7"> </span>
<a href="#l81.8"></a><span id="l81.8"> NS_IMETHODIMP</span>
<a href="#l81.9"></a><span id="l81.9"> nsMsgIncomingServer::GetPasswordWithUI(const nsAString&amp; aPromptMessage, const</span>
<a href="#l81.10"></a><span id="l81.10">                                        nsAString&amp; aPromptTitle,</span>
<a href="#l81.11"></a><span id="l81.11">                                        nsIMsgWindow* aMsgWindow,</span>
<a href="#l81.12"></a><span id="l81.12" class="difflineminus">-                                       PRBool *okayValue,</span>
<a href="#l81.13"></a><span id="l81.13">                                        nsACString&amp; aPassword)</span>
<a href="#l81.14"></a><span id="l81.14"> {</span>
<a href="#l81.15"></a><span id="l81.15">   nsresult rv = NS_OK;</span>
<a href="#l81.16"></a><span id="l81.16" class="difflineminus">-  NS_ENSURE_ARG_POINTER(okayValue);</span>
<a href="#l81.17"></a><span id="l81.17"> </span>
<a href="#l81.18"></a><span id="l81.18">   if (m_password.IsEmpty())</span>
<a href="#l81.19"></a><span id="l81.19">   {</span>
<a href="#l81.20"></a><span id="l81.20">     // let's see if we have the password in the password manager and</span>
<a href="#l81.21"></a><span id="l81.21">     // can avoid this prompting thing. This makes it easier to get embedders</span>
<a href="#l81.22"></a><span id="l81.22">     // to get up and running w/o a password prompting UI.</span>
<a href="#l81.23"></a><span id="l81.23">     GetPasswordWithoutUI();</span>
<a href="#l81.24"></a><span id="l81.24">   }</span>
<a href="#l81.25"></a><span id="l81.25" class="difflineat">@@ -813,26 +811,27 @@ nsMsgIncomingServer::GetPasswordWithUI(c</span>
<a href="#l81.26"></a><span id="l81.26"> </span>
<a href="#l81.27"></a><span id="l81.27">       // we pass in the previously used password, if any, into PromptPassword</span>
<a href="#l81.28"></a><span id="l81.28">       // so that it will appear as ******. This means we can't use an nsString</span>
<a href="#l81.29"></a><span id="l81.29">       // and getter_Copies.</span>
<a href="#l81.30"></a><span id="l81.30">       PRUnichar *uniPassword = nsnull;</span>
<a href="#l81.31"></a><span id="l81.31">       if (!aPassword.IsEmpty())</span>
<a href="#l81.32"></a><span id="l81.32">         uniPassword = ToNewUnicode(NS_ConvertASCIItoUTF16(aPassword));</span>
<a href="#l81.33"></a><span id="l81.33"> </span>
<a href="#l81.34"></a><span id="l81.34" class="difflineplus">+      PRBool okayValue = PR_TRUE;</span>
<a href="#l81.35"></a><span id="l81.35">       rv = dialog-&gt;PromptPassword(PromiseFlatString(aPromptTitle).get(),</span>
<a href="#l81.36"></a><span id="l81.36">                                   PromiseFlatString(aPromptMessage).get(),</span>
<a href="#l81.37"></a><span id="l81.37">                                   NS_ConvertASCIItoUTF16(serverUri).get(),</span>
<a href="#l81.38"></a><span id="l81.38">                                   nsIAuthPrompt::SAVE_PASSWORD_PERMANENTLY,</span>
<a href="#l81.39"></a><span id="l81.39" class="difflineminus">-                                  &amp;uniPassword, okayValue);</span>
<a href="#l81.40"></a><span id="l81.40" class="difflineplus">+                                  &amp;uniPassword, &amp;okayValue);</span>
<a href="#l81.41"></a><span id="l81.41">       nsAutoString uniPasswordAdopted;</span>
<a href="#l81.42"></a><span id="l81.42">       uniPasswordAdopted.Adopt(uniPassword);</span>
<a href="#l81.43"></a><span id="l81.43">       NS_ENSURE_SUCCESS(rv, rv);</span>
<a href="#l81.44"></a><span id="l81.44"> </span>
<a href="#l81.45"></a><span id="l81.45" class="difflineminus">-      if (!*okayValue) // if the user pressed cancel, just return an empty string;</span>
<a href="#l81.46"></a><span id="l81.46" class="difflineplus">+      if (!okayValue) // if the user pressed cancel, just return an empty string;</span>
<a href="#l81.47"></a><span id="l81.47">       {</span>
<a href="#l81.48"></a><span id="l81.48">         aPassword.Truncate();</span>
<a href="#l81.49"></a><span id="l81.49">         return NS_MSG_PASSWORD_PROMPT_CANCELLED;</span>
<a href="#l81.50"></a><span id="l81.50">       }</span>
<a href="#l81.51"></a><span id="l81.51"> </span>
<a href="#l81.52"></a><span id="l81.52">       // we got a password back...so remember it</span>
<a href="#l81.53"></a><span id="l81.53">       rv = SetPassword(NS_LossyConvertUTF16toASCII(uniPasswordAdopted));</span>
<a href="#l81.54"></a><span id="l81.54">       NS_ENSURE_SUCCESS(rv, rv);</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l82.1"></a><span id="l82.1" class="difflineminus">--- a/mailnews/compose/content/askSendFormat.js</span>
<a href="#l82.2"></a><span id="l82.2" class="difflineplus">+++ b/mailnews/compose/content/askSendFormat.js</span>
<a href="#l82.3"></a><span id="l82.3" class="difflineat">@@ -18,173 +18,78 @@</span>
<a href="#l82.4"></a><span id="l82.4">  * Portions created by the Initial Developer are Copyright (C) 2000</span>
<a href="#l82.5"></a><span id="l82.5">  * the Initial Developer. All Rights Reserved.</span>
<a href="#l82.6"></a><span id="l82.6">  *</span>
<a href="#l82.7"></a><span id="l82.7">  * Contributor(s):</span>
<a href="#l82.8"></a><span id="l82.8">  *   Jean-Francois Ducarroz &lt;ducarroz@netscape.com&gt;</span>
<a href="#l82.9"></a><span id="l82.9">  *   Ben Bucksch &lt;mozilla.BenB@bucksch.org&gt;</span>
<a href="#l82.10"></a><span id="l82.10">  *   Ian Neal &lt;bugzilla@arlen.demon.co.uk&gt;</span>
<a href="#l82.11"></a><span id="l82.11">  *   iga Sancin &lt;bisi@pikslar.com&gt;</span>
<a href="#l82.12"></a><span id="l82.12" class="difflineplus">+ *   Magnus Melin &lt;mkmelin+mozilla@iki.fi&gt;</span>
<a href="#l82.13"></a><span id="l82.13">  *</span>
<a href="#l82.14"></a><span id="l82.14">  * Alternatively, the contents of this file may be used under the terms of</span>
<a href="#l82.15"></a><span id="l82.15">  * either of the GNU General Public License Version 2 or later (the &quot;GPL&quot;),</span>
<a href="#l82.16"></a><span id="l82.16">  * or the GNU Lesser General Public License Version 2.1 or later (the &quot;LGPL&quot;),</span>
<a href="#l82.17"></a><span id="l82.17">  * in which case the provisions of the GPL or the LGPL are applicable instead</span>
<a href="#l82.18"></a><span id="l82.18">  * of those above. If you wish to allow use of your version of this file only</span>
<a href="#l82.19"></a><span id="l82.19">  * under the terms of either the GPL or the LGPL, and not to allow others to</span>
<a href="#l82.20"></a><span id="l82.20">  * use your version of this file under the terms of the MPL, indicate your</span>
<a href="#l82.21"></a><span id="l82.21">  * decision by deleting the provisions above and replace them with the notice</span>
<a href="#l82.22"></a><span id="l82.22">  * and other provisions required by the GPL or the LGPL. If you do not delete</span>
<a href="#l82.23"></a><span id="l82.23">  * the provisions above, a recipient may use your version of this file under</span>
<a href="#l82.24"></a><span id="l82.24">  * the terms of any one of the MPL, the GPL or the LGPL.</span>
<a href="#l82.25"></a><span id="l82.25">  *</span>
<a href="#l82.26"></a><span id="l82.26">  * ***** END LICENSE BLOCK ***** */</span>
<a href="#l82.27"></a><span id="l82.27"> </span>
<a href="#l82.28"></a><span id="l82.28" class="difflineminus">-var msgCompSendFormat = Components.interfaces.nsIMsgCompSendFormat;</span>
<a href="#l82.29"></a><span id="l82.29" class="difflineminus">-var msgCompConvertible = Components.interfaces.nsIMsgCompConvertible;</span>
<a href="#l82.30"></a><span id="l82.30" class="difflineminus">-var param = null;</span>
<a href="#l82.31"></a><span id="l82.31" class="difflineminus">-</span>
<a href="#l82.32"></a><span id="l82.32" class="difflineminus">-/* There are 3 preferences that let you customize the behavior of this dialog</span>
<a href="#l82.33"></a><span id="l82.33" class="difflineminus">-</span>
<a href="#l82.34"></a><span id="l82.34" class="difflineminus">-1. pref(&quot;mail.asksendformat.default&quot;, 1); //1=plaintext, 2=html, 3=both</span>
<a href="#l82.35"></a><span id="l82.35" class="difflineminus">-   This defines the default action selected when the dialog opens. It can be overwritten by the preference</span>
<a href="#l82.36"></a><span id="l82.36" class="difflineminus">-   mail.asksendformat.recommended_as_default</span>
<a href="#l82.37"></a><span id="l82.37" class="difflineminus">-</span>
<a href="#l82.38"></a><span id="l82.38" class="difflineminus">-</span>
<a href="#l82.39"></a><span id="l82.39" class="difflineminus">-2. pref(&quot;mail.asksendformat.recommended_as_default&quot;, true);</span>
<a href="#l82.40"></a><span id="l82.40" class="difflineminus">-   If you set this preference to true and we have a recommended action, this action will be selected by default.</span>
<a href="#l82.41"></a><span id="l82.41" class="difflineminus">-   In this case, we ignore the preference mail.asksendformat.default</span>
<a href="#l82.42"></a><span id="l82.42" class="difflineminus">-</span>
<a href="#l82.43"></a><span id="l82.43" class="difflineminus">-</span>
<a href="#l82.44"></a><span id="l82.44" class="difflineminus">-3. pref(&quot;mail.asksendformat.display_recommendation&quot;, true);</span>
<a href="#l82.45"></a><span id="l82.45" class="difflineminus">-   When this preference is set to false, the recommended action label will not be displayed next to the action</span>
<a href="#l82.46"></a><span id="l82.46" class="difflineminus">-   radio button. However, the default action might change to the recommended one if the preference</span>
<a href="#l82.47"></a><span id="l82.47" class="difflineminus">-   mail.asksendformat.recommended_as_default is set.</span>
<a href="#l82.48"></a><span id="l82.48" class="difflineminus">-*/</span>
<a href="#l82.49"></a><span id="l82.49" class="difflineminus">-</span>
<a href="#l82.50"></a><span id="l82.50" class="difflineminus">-var defaultAction = msgCompSendFormat.PlainText;</span>
<a href="#l82.51"></a><span id="l82.51" class="difflineminus">-var recommended_as_default = true;</span>
<a href="#l82.52"></a><span id="l82.52" class="difflineminus">-var display_recommendation = true;</span>
<a href="#l82.53"></a><span id="l82.53" class="difflineminus">-var useDefault = false;</span>
<a href="#l82.54"></a><span id="l82.54" class="difflineplus">+var gParam = null;</span>
<a href="#l82.55"></a><span id="l82.55"> </span>
<a href="#l82.56"></a><span id="l82.56" class="difflineminus">-var prefs = Components.classes[&quot;@mozilla.org/preferences-service;1&quot;].getService();</span>
<a href="#l82.57"></a><span id="l82.57" class="difflineminus">-if (prefs)</span>
<a href="#l82.58"></a><span id="l82.58" class="difflineminus">-{</span>
<a href="#l82.59"></a><span id="l82.59" class="difflineminus">-  prefs = prefs.QueryInterface(Components.interfaces.nsIPrefBranch);</span>
<a href="#l82.60"></a><span id="l82.60" class="difflineminus">-  if (prefs)</span>
<a href="#l82.61"></a><span id="l82.61" class="difflineminus">-  {</span>
<a href="#l82.62"></a><span id="l82.62" class="difflineminus">-    try</span>
<a href="#l82.63"></a><span id="l82.63" class="difflineminus">-    {</span>
<a href="#l82.64"></a><span id="l82.64" class="difflineminus">-      defaultAction = prefs.getIntPref(&quot;mail.asksendformat.default&quot;);</span>
<a href="#l82.65"></a><span id="l82.65" class="difflineminus">-      useDefault = true;</span>
<a href="#l82.66"></a><span id="l82.66" class="difflineminus">-    }</span>
<a href="#l82.67"></a><span id="l82.67" class="difflineminus">-    catch (ex) {}</span>
<a href="#l82.68"></a><span id="l82.68" class="difflineminus">-</span>
<a href="#l82.69"></a><span id="l82.69" class="difflineminus">-    try</span>
<a href="#l82.70"></a><span id="l82.70" class="difflineminus">-    {</span>
<a href="#l82.71"></a><span id="l82.71" class="difflineminus">-      recommended_as_default = prefs.getBoolPref(&quot;mail.asksendformat.recommended_as_default&quot;);</span>
<a href="#l82.72"></a><span id="l82.72" class="difflineminus">-    }</span>
<a href="#l82.73"></a><span id="l82.73" class="difflineminus">-    catch (ex) {}</span>
<a href="#l82.74"></a><span id="l82.74" class="difflineminus">-</span>
<a href="#l82.75"></a><span id="l82.75" class="difflineminus">-    try</span>
<a href="#l82.76"></a><span id="l82.76" class="difflineminus">-    {</span>
<a href="#l82.77"></a><span id="l82.77" class="difflineminus">-      display_recommendation = prefs.getBoolPref(&quot;mail.asksendformat.display_recommendation&quot;);</span>
<a href="#l82.78"></a><span id="l82.78" class="difflineminus">-    }</span>
<a href="#l82.79"></a><span id="l82.79" class="difflineminus">-    catch (ex) {}</span>
<a href="#l82.80"></a><span id="l82.80" class="difflineminus">-  }</span>
<a href="#l82.81"></a><span id="l82.81" class="difflineminus">-}</span>
<a href="#l82.82"></a><span id="l82.82" class="difflineminus">-</span>
<a href="#l82.83"></a><span id="l82.83" class="difflineplus">+/**</span>
<a href="#l82.84"></a><span id="l82.84" class="difflineplus">+ * This dialog should be opened with arguments like e.g.</span>
<a href="#l82.85"></a><span id="l82.85" class="difflineplus">+ * {action: nsIMsgCompSendFormat.AskUser, convertible: nsIMsgCompConvertible.Yes}</span>
<a href="#l82.86"></a><span id="l82.86" class="difflineplus">+ */</span>
<a href="#l82.87"></a><span id="l82.87"> function Startup()</span>
<a href="#l82.88"></a><span id="l82.88"> {</span>
<a href="#l82.89"></a><span id="l82.89" class="difflineminus">-  if (window.arguments &amp;&amp; window.arguments[0])</span>
<a href="#l82.90"></a><span id="l82.90" class="difflineminus">-  {</span>
<a href="#l82.91"></a><span id="l82.91" class="difflineminus">-    var askSendFormatStringBundle = document.getElementById(&quot;askSendFormatStringBundle&quot;);</span>
<a href="#l82.92"></a><span id="l82.92" class="difflineminus">-    param = window.arguments[0];</span>
<a href="#l82.93"></a><span id="l82.93" class="difflineminus">-    // If the user hits the close box, we will abort.</span>
<a href="#l82.94"></a><span id="l82.94" class="difflineminus">-    param.abort = true;</span>
<a href="#l82.95"></a><span id="l82.95" class="difflineminus">-    if (param.action)</span>
<a href="#l82.96"></a><span id="l82.96" class="difflineminus">-    {</span>
<a href="#l82.97"></a><span id="l82.97" class="difflineminus">-      // Set the question label</span>
<a href="#l82.98"></a><span id="l82.98" class="difflineminus">-      var mailSendFormatExplanation = document.getElementById(&quot;mailSendFormatExplanation&quot;);</span>
<a href="#l82.99"></a><span id="l82.99" class="difflineminus">-      var icon = document.getElementById(&quot;convertDefault&quot;);</span>
<a href="#l82.100"></a><span id="l82.100" class="difflineminus">-      switch (param.convertible)</span>
<a href="#l82.101"></a><span id="l82.101" class="difflineminus">-      {</span>
<a href="#l82.102"></a><span id="l82.102" class="difflineminus">-        case msgCompConvertible.Plain:</span>
<a href="#l82.103"></a><span id="l82.103" class="difflineminus">-          // We shouldn't be here at all</span>
<a href="#l82.104"></a><span id="l82.104" class="difflineminus">-          mailSendFormatExplanation.textContent = askSendFormatStringBundle.getString(&quot;convertibleYes&quot;);</span>
<a href="#l82.105"></a><span id="l82.105" class="difflineminus">-          // No icon</span>
<a href="#l82.106"></a><span id="l82.106" class="difflineminus">-          break;</span>
<a href="#l82.107"></a><span id="l82.107" class="difflineminus">-        case msgCompConvertible.Yes:</span>
<a href="#l82.108"></a><span id="l82.108" class="difflineminus">-          mailSendFormatExplanation.textContent = askSendFormatStringBundle.getString(&quot;convertibleYes&quot;);</span>
<a href="#l82.109"></a><span id="l82.109" class="difflineminus">-          icon.setAttribute(&quot;id&quot;, &quot;convertYes&quot;);</span>
<a href="#l82.110"></a><span id="l82.110" class="difflineminus">-          break;</span>
<a href="#l82.111"></a><span id="l82.111" class="difflineminus">-        case msgCompConvertible.Altering:</span>
<a href="#l82.112"></a><span id="l82.112" class="difflineminus">-          mailSendFormatExplanation.textContent = askSendFormatStringBundle.getString(&quot;convertibleAltering&quot;);</span>
<a href="#l82.113"></a><span id="l82.113" class="difflineminus">-          icon.setAttribute(&quot;id&quot;, &quot;convertAltering&quot;);</span>
<a href="#l82.114"></a><span id="l82.114" class="difflineminus">-          break;</span>
<a href="#l82.115"></a><span id="l82.115" class="difflineminus">-        case msgCompConvertible.No:</span>
<a href="#l82.116"></a><span id="l82.116" class="difflineminus">-          mailSendFormatExplanation.textContent = askSendFormatStringBundle.getString(&quot;convertibleNo&quot;);</span>
<a href="#l82.117"></a><span id="l82.117" class="difflineminus">-          icon.setAttribute(&quot;id&quot;, &quot;convertNo&quot;);</span>
<a href="#l82.118"></a><span id="l82.118" class="difflineminus">-          break;</span>
<a href="#l82.119"></a><span id="l82.119" class="difflineminus">-      }</span>
<a href="#l82.120"></a><span id="l82.120" class="difflineplus">+  gParam = window.arguments[0];</span>
<a href="#l82.121"></a><span id="l82.121" class="difflineplus">+</span>
<a href="#l82.122"></a><span id="l82.122" class="difflineplus">+  const msgCompSendFormat = Components.interfaces.nsIMsgCompSendFormat;</span>
<a href="#l82.123"></a><span id="l82.123" class="difflineplus">+  const msgCompConvertible = Components.interfaces.nsIMsgCompConvertible;</span>
<a href="#l82.124"></a><span id="l82.124" class="difflineplus">+</span>
<a href="#l82.125"></a><span id="l82.125" class="difflineplus">+  var bundle = document.getElementById(&quot;askSendFormatStringBundle&quot;);</span>
<a href="#l82.126"></a><span id="l82.126" class="difflineplus">+</span>
<a href="#l82.127"></a><span id="l82.127" class="difflineplus">+  // If the user hits the close box, we will abort.</span>
<a href="#l82.128"></a><span id="l82.128" class="difflineplus">+  gParam.abort = true;</span>
<a href="#l82.129"></a><span id="l82.129" class="difflineplus">+</span>
<a href="#l82.130"></a><span id="l82.130" class="difflineplus">+  // Set the question label</span>
<a href="#l82.131"></a><span id="l82.131" class="difflineplus">+  var mailSendFormatExplanation = document.getElementById(&quot;mailSendFormatExplanation&quot;);</span>
<a href="#l82.132"></a><span id="l82.132" class="difflineplus">+  var icon = document.getElementById(&quot;convertDefault&quot;);</span>
<a href="#l82.133"></a><span id="l82.133"> </span>
<a href="#l82.134"></a><span id="l82.134" class="difflineminus">-      // Set the default radio array value and recommendation</span>
<a href="#l82.135"></a><span id="l82.135" class="difflineminus">-      var group = document.getElementById(&quot;mailDefaultHTMLAction&quot;);</span>
<a href="#l82.136"></a><span id="l82.136" class="difflineminus">-      var radio;</span>
<a href="#l82.137"></a><span id="l82.137" class="difflineminus">-      var radioButtons = group.getElementsByTagName(&quot;radio&quot;);</span>
<a href="#l82.138"></a><span id="l82.138" class="difflineminus">-      var haveRecommendation = false;</span>
<a href="#l82.139"></a><span id="l82.139" class="difflineminus">-      var format = (useDefault) ? defaultAction : param.action;</span>
<a href="#l82.140"></a><span id="l82.140" class="difflineplus">+  switch (gParam.convertible)</span>
<a href="#l82.141"></a><span id="l82.141" class="difflineplus">+  {</span>
<a href="#l82.142"></a><span id="l82.142" class="difflineplus">+    case msgCompConvertible.Altering:</span>
<a href="#l82.143"></a><span id="l82.143" class="difflineplus">+      mailSendFormatExplanation.textContent = bundle.getString(&quot;convertibleAltering&quot;);</span>
<a href="#l82.144"></a><span id="l82.144" class="difflineplus">+      icon.className = &quot;question-icon&quot;;</span>
<a href="#l82.145"></a><span id="l82.145" class="difflineplus">+      break;</span>
<a href="#l82.146"></a><span id="l82.146" class="difflineplus">+    case msgCompConvertible.No:</span>
<a href="#l82.147"></a><span id="l82.147" class="difflineplus">+      mailSendFormatExplanation.textContent = bundle.getString(&quot;convertibleNo&quot;);</span>
<a href="#l82.148"></a><span id="l82.148" class="difflineplus">+      icon.className = &quot;alert-icon&quot;;</span>
<a href="#l82.149"></a><span id="l82.149" class="difflineplus">+      break;</span>
<a href="#l82.150"></a><span id="l82.150" class="difflineplus">+    default: // msgCompConvertible.Yes</span>
<a href="#l82.151"></a><span id="l82.151" class="difflineplus">+      mailSendFormatExplanation.textContent = bundle.getString(&quot;convertibleYes&quot;);</span>
<a href="#l82.152"></a><span id="l82.152" class="difflineplus">+      // XXX change this to use class message-icon once bug 512173 is fixed</span>
<a href="#l82.153"></a><span id="l82.153" class="difflineplus">+      icon.className = &quot;question-icon&quot;;</span>
<a href="#l82.154"></a><span id="l82.154" class="difflineplus">+      break;</span>
<a href="#l82.155"></a><span id="l82.155" class="difflineplus">+  }</span>
<a href="#l82.156"></a><span id="l82.156"> </span>
<a href="#l82.157"></a><span id="l82.157" class="difflineminus">-      switch (format)</span>
<a href="#l82.158"></a><span id="l82.158" class="difflineminus">-      {</span>
<a href="#l82.159"></a><span id="l82.159" class="difflineminus">-        case msgCompSendFormat.AskUser:</span>
<a href="#l82.160"></a><span id="l82.160" class="difflineminus">-          // haveRecommendation = false;</span>
<a href="#l82.161"></a><span id="l82.161" class="difflineminus">-          break;</span>
<a href="#l82.162"></a><span id="l82.162" class="difflineminus">-        case msgCompSendFormat.PlainText:</span>
<a href="#l82.163"></a><span id="l82.163" class="difflineminus">-          radio = radioButtons[1];</span>
<a href="#l82.164"></a><span id="l82.164" class="difflineminus">-          haveRecommendation = true;</span>
<a href="#l82.165"></a><span id="l82.165" class="difflineminus">-          break;</span>
<a href="#l82.166"></a><span id="l82.166" class="difflineminus">-        case msgCompSendFormat.Both:</span>
<a href="#l82.167"></a><span id="l82.167" class="difflineminus">-          radio = radioButtons[0];</span>
<a href="#l82.168"></a><span id="l82.168" class="difflineminus">-          haveRecommendation = true;</span>
<a href="#l82.169"></a><span id="l82.169" class="difflineminus">-          break;</span>
<a href="#l82.170"></a><span id="l82.170" class="difflineminus">-        case msgCompSendFormat.HTML:</span>
<a href="#l82.171"></a><span id="l82.171" class="difflineminus">-          radio = radioButtons[2];</span>
<a href="#l82.172"></a><span id="l82.172" class="difflineminus">-          haveRecommendation = true;</span>
<a href="#l82.173"></a><span id="l82.173" class="difflineminus">-          break;</span>
<a href="#l82.174"></a><span id="l82.174" class="difflineminus">-      }</span>
<a href="#l82.175"></a><span id="l82.175" class="difflineminus">-</span>
<a href="#l82.176"></a><span id="l82.176" class="difflineminus">-      if (haveRecommendation)</span>
<a href="#l82.177"></a><span id="l82.177" class="difflineminus">-      {</span>
<a href="#l82.178"></a><span id="l82.178" class="difflineminus">-        if (display_recommendation)</span>
<a href="#l82.179"></a><span id="l82.179" class="difflineminus">-          radio.label += &quot; &quot; + askSendFormatStringBundle.getString(&quot;recommended&quot;);</span>
<a href="#l82.180"></a><span id="l82.180" class="difflineminus">-</span>
<a href="#l82.181"></a><span id="l82.181" class="difflineminus">-        if (recommended_as_default)</span>
<a href="#l82.182"></a><span id="l82.182" class="difflineminus">-          group.value = format;</span>
<a href="#l82.183"></a><span id="l82.183" class="difflineminus">-      }</span>
<a href="#l82.184"></a><span id="l82.184" class="difflineminus">-</span>
<a href="#l82.185"></a><span id="l82.185" class="difflineminus">-      if (!haveRecommendation || !recommended_as_default)</span>
<a href="#l82.186"></a><span id="l82.186" class="difflineminus">-        group.value = defaultAction;</span>
<a href="#l82.187"></a><span id="l82.187" class="difflineminus">-    }</span>
<a href="#l82.188"></a><span id="l82.188" class="difflineminus">-  }</span>
<a href="#l82.189"></a><span id="l82.189" class="difflineminus">-  else </span>
<a href="#l82.190"></a><span id="l82.190" class="difflineplus">+  // Set the default radio array value and recommendation.</span>
<a href="#l82.191"></a><span id="l82.191" class="difflineplus">+  var group = document.getElementById(&quot;mailDefaultHTMLAction&quot;);</span>
<a href="#l82.192"></a><span id="l82.192" class="difflineplus">+  if (gParam.action != msgCompSendFormat.AskUser)</span>
<a href="#l82.193"></a><span id="l82.193">   {</span>
<a href="#l82.194"></a><span id="l82.194" class="difflineminus">-    dump(&quot;error, no return object registered\n&quot;);</span>
<a href="#l82.195"></a><span id="l82.195" class="difflineplus">+    group.value = gParam.action;</span>
<a href="#l82.196"></a><span id="l82.196" class="difflineplus">+    group.selectedItem.label += &quot; &quot; + bundle.getString(&quot;recommended&quot;);</span>
<a href="#l82.197"></a><span id="l82.197">   }</span>
<a href="#l82.198"></a><span id="l82.198"> }</span>
<a href="#l82.199"></a><span id="l82.199"> </span>
<a href="#l82.200"></a><span id="l82.200"> function Send()</span>
<a href="#l82.201"></a><span id="l82.201"> {</span>
<a href="#l82.202"></a><span id="l82.202" class="difflineminus">-  if (param)</span>
<a href="#l82.203"></a><span id="l82.203" class="difflineminus">-  {</span>
<a href="#l82.204"></a><span id="l82.204" class="difflineminus">-    // param.action should be an integer for when it is returned to MsgComposeCommands.js</span>
<a href="#l82.205"></a><span id="l82.205" class="difflineminus">-    param.action = parseInt(document.getElementById(&quot;mailDefaultHTMLAction&quot;).value);</span>
<a href="#l82.206"></a><span id="l82.206" class="difflineminus">-    param.abort = false;</span>
<a href="#l82.207"></a><span id="l82.207" class="difflineminus">-  }</span>
<a href="#l82.208"></a><span id="l82.208" class="difflineminus">-  return true;</span>
<a href="#l82.209"></a><span id="l82.209" class="difflineplus">+  // gParam.action should be an integer for when it is returned to MsgComposeCommands.js</span>
<a href="#l82.210"></a><span id="l82.210" class="difflineplus">+  gParam.action = parseInt(document.getElementById(&quot;mailDefaultHTMLAction&quot;).value);</span>
<a href="#l82.211"></a><span id="l82.211" class="difflineplus">+  gParam.abort = false;</span>
<a href="#l82.212"></a><span id="l82.212"> }</span>
<a href="#l82.213"></a><span id="l82.213" class="difflineminus">-</span>
<a href="#l82.214"></a><span id="l82.214" class="difflineminus">-function Cancel()</span>
<a href="#l82.215"></a><span id="l82.215" class="difflineminus">-{</span>
<a href="#l82.216"></a><span id="l82.216" class="difflineminus">-  if (param)</span>
<a href="#l82.217"></a><span id="l82.217" class="difflineminus">-    param.abort = true;</span>
<a href="#l82.218"></a><span id="l82.218" class="difflineminus">-  return true;</span>
<a href="#l82.219"></a><span id="l82.219" class="difflineminus">-}</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l83.1"></a><span id="l83.1" class="difflineminus">--- a/mailnews/compose/content/askSendFormat.xul</span>
<a href="#l83.2"></a><span id="l83.2" class="difflineplus">+++ b/mailnews/compose/content/askSendFormat.xul</span>
<a href="#l83.3"></a><span id="l83.3" class="difflineat">@@ -34,29 +34,29 @@</span>
<a href="#l83.4"></a><span id="l83.4">    - use your version of this file under the terms of the MPL, indicate your</span>
<a href="#l83.5"></a><span id="l83.5">    - decision by deleting the provisions above and replace them with the notice</span>
<a href="#l83.6"></a><span id="l83.6">    - and other provisions required by the GPL or the LGPL. If you do not delete</span>
<a href="#l83.7"></a><span id="l83.7">    - the provisions above, a recipient may use your version of this file under</span>
<a href="#l83.8"></a><span id="l83.8">    - the terms of any one of the MPL, the GPL or the LGPL.</span>
<a href="#l83.9"></a><span id="l83.9">    -</span>
<a href="#l83.10"></a><span id="l83.10">    - ***** END LICENSE BLOCK ***** --&gt;</span>
<a href="#l83.11"></a><span id="l83.11"> </span>
<a href="#l83.12"></a><span id="l83.12" class="difflineminus">-&lt;?xml-stylesheet href=&quot;chrome://messenger/skin/dialogs.css&quot; type=&quot;text/css&quot;?&gt;</span>
<a href="#l83.13"></a><span id="l83.13" class="difflineplus">+&lt;?xml-stylesheet href=&quot;chrome://global/skin/global.css&quot; type=&quot;text/css&quot;?&gt;</span>
<a href="#l83.14"></a><span id="l83.14"> </span>
<a href="#l83.15"></a><span id="l83.15"> &lt;!DOCTYPE dialog SYSTEM &quot;chrome://messenger/locale/messengercompose/askSendFormat.dtd&quot;&gt;</span>
<a href="#l83.16"></a><span id="l83.16"> </span>
<a href="#l83.17"></a><span id="l83.17"> &lt;dialog id=&quot;askSendFormat&quot;</span>
<a href="#l83.18"></a><span id="l83.18">         title=&quot;&amp;windowTitle.label;&quot;</span>
<a href="#l83.19"></a><span id="l83.19">         xmlns=&quot;http://www.mozilla.org/keymaster/gatekeeper/there.is.only.xul&quot;</span>
<a href="#l83.20"></a><span id="l83.20">         buttonpack=&quot;center&quot;</span>
<a href="#l83.21"></a><span id="l83.21">         onload=&quot;Startup();&quot;</span>
<a href="#l83.22"></a><span id="l83.22" class="difflineminus">-        ondialogaccept=&quot;return Send();&quot;</span>
<a href="#l83.23"></a><span id="l83.23" class="difflineminus">-        ondialogcancel=&quot;return Cancel();&quot;</span>
<a href="#l83.24"></a><span id="l83.24" class="difflineplus">+        ondialogaccept=&quot;Send();&quot;</span>
<a href="#l83.25"></a><span id="l83.25">         buttonlabelaccept=&quot;&amp;send.label;&quot;</span>
<a href="#l83.26"></a><span id="l83.26" class="difflineminus">-        buttonaccesskeyaccept=&quot;&amp;send.accesskey;&quot;&gt;</span>
<a href="#l83.27"></a><span id="l83.27" class="difflineplus">+        buttonaccesskeyaccept=&quot;&amp;send.accesskey;&quot;</span>
<a href="#l83.28"></a><span id="l83.28" class="difflineplus">+        style=&quot;width: 75ch;&quot;&gt;</span>
<a href="#l83.29"></a><span id="l83.29"> </span>
<a href="#l83.30"></a><span id="l83.30">   &lt;script type=&quot;application/javascript&quot;</span>
<a href="#l83.31"></a><span id="l83.31">           src=&quot;chrome://messenger/content/messengercompose/askSendFormat.js&quot;/&gt;</span>
<a href="#l83.32"></a><span id="l83.32"> </span>
<a href="#l83.33"></a><span id="l83.33">   &lt;stringbundle id=&quot;askSendFormatStringBundle&quot;</span>
<a href="#l83.34"></a><span id="l83.34">                 src=&quot;chrome://messenger/locale/messengercompose/askSendFormat.properties&quot;/&gt;</span>
<a href="#l83.35"></a><span id="l83.35"> </span>
<a href="#l83.36"></a><span id="l83.36">     &lt;separator class=&quot;thin&quot;/&gt;</span>
<a href="#l83.37"></a><span id="l83.37" class="difflineat">@@ -68,14 +68,15 @@</span>
<a href="#l83.38"></a><span id="l83.38">       &lt;separator orient=&quot;vertical&quot;/&gt;</span>
<a href="#l83.39"></a><span id="l83.39">       &lt;vbox flex=&quot;1&quot;&gt;</span>
<a href="#l83.40"></a><span id="l83.40">         &lt;description&gt;&amp;recipient.label;&lt;/description&gt;</span>
<a href="#l83.41"></a><span id="l83.41">         &lt;description id=&quot;mailSendFormatExplanation&quot;/&gt;</span>
<a href="#l83.42"></a><span id="l83.42">         &lt;description&gt;&amp;question.label;&lt;/description&gt;</span>
<a href="#l83.43"></a><span id="l83.43">         &lt;separator/&gt;</span>
<a href="#l83.44"></a><span id="l83.44">         &lt;radiogroup id=&quot;mailDefaultHTMLAction&quot;&gt;</span>
<a href="#l83.45"></a><span id="l83.45">           &lt;radio value=&quot;3&quot; label=&quot;&amp;plainTextAndHtml.label;&quot; accesskey=&quot;&amp;plainTextAndHtml.accesskey;&quot;/&gt;</span>
<a href="#l83.46"></a><span id="l83.46" class="difflineminus">-          &lt;radio value=&quot;1&quot; label=&quot;&amp;plainTextOnly.label;&quot; accesskey=&quot;&amp;plainTextOnly.accesskey;&quot;/&gt;</span>
<a href="#l83.47"></a><span id="l83.47" class="difflineplus">+          &lt;radio value=&quot;1&quot; selected=&quot;true&quot;</span>
<a href="#l83.48"></a><span id="l83.48" class="difflineplus">+                 label=&quot;&amp;plainTextOnly.label;&quot; accesskey=&quot;&amp;plainTextOnly.accesskey;&quot;/&gt;</span>
<a href="#l83.49"></a><span id="l83.49">           &lt;radio value=&quot;2&quot; label=&quot;&amp;htmlOnly.label;&quot; accesskey=&quot;&amp;htmlOnly.accesskey;&quot;/&gt;</span>
<a href="#l83.50"></a><span id="l83.50">         &lt;/radiogroup&gt;</span>
<a href="#l83.51"></a><span id="l83.51">       &lt;/vbox&gt;</span>
<a href="#l83.52"></a><span id="l83.52">     &lt;/hbox&gt;</span>
<a href="#l83.53"></a><span id="l83.53"> &lt;/dialog&gt;</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l84.1"></a><span id="l84.1" class="difflineminus">--- a/mailnews/compose/src/nsMsgCompFields.cpp</span>
<a href="#l84.2"></a><span id="l84.2" class="difflineplus">+++ b/mailnews/compose/src/nsMsgCompFields.cpp</span>
<a href="#l84.3"></a><span id="l84.3" class="difflineat">@@ -243,17 +243,17 @@ NS_IMETHODIMP nsMsgCompFields::SetSubjec</span>
<a href="#l84.4"></a><span id="l84.4"> </span>
<a href="#l84.5"></a><span id="l84.5"> NS_IMETHODIMP nsMsgCompFields::GetSubject(nsAString &amp;_retval)</span>
<a href="#l84.6"></a><span id="l84.6"> {</span>
<a href="#l84.7"></a><span id="l84.7">   return GetUnicodeHeader(MSG_SUBJECT_HEADER_ID, _retval);</span>
<a href="#l84.8"></a><span id="l84.8"> }</span>
<a href="#l84.9"></a><span id="l84.9"> </span>
<a href="#l84.10"></a><span id="l84.10"> NS_IMETHODIMP nsMsgCompFields::SetTemporaryFiles(const char *value)</span>
<a href="#l84.11"></a><span id="l84.11"> {</span>
<a href="#l84.12"></a><span id="l84.12" class="difflineminus">-  NS_ASSERTION(0, &quot;nsMsgCompFields::SetTemporaryFiles is not supported anymore, please use nsMsgCompFields::AddAttachment&quot;);</span>
<a href="#l84.13"></a><span id="l84.13" class="difflineplus">+  NS_ERROR(&quot;nsMsgCompFields::SetTemporaryFiles is not supported anymore, please use nsMsgCompFields::AddAttachment&quot;);</span>
<a href="#l84.14"></a><span id="l84.14">   return SetAsciiHeader(MSG_TEMPORARY_FILES_HEADER_ID, value);</span>
<a href="#l84.15"></a><span id="l84.15"> }</span>
<a href="#l84.16"></a><span id="l84.16"> </span>
<a href="#l84.17"></a><span id="l84.17"> NS_IMETHODIMP nsMsgCompFields::GetTemporaryFiles(char **_retval)</span>
<a href="#l84.18"></a><span id="l84.18"> {</span>
<a href="#l84.19"></a><span id="l84.19">   *_retval = strdup(GetAsciiHeader(MSG_TEMPORARY_FILES_HEADER_ID));</span>
<a href="#l84.20"></a><span id="l84.20">   return *_retval ? NS_OK : NS_ERROR_OUT_OF_MEMORY;</span>
<a href="#l84.21"></a><span id="l84.21"> }</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l85.1"></a><span id="l85.1" class="difflineminus">--- a/mailnews/compose/src/nsMsgCompFields.h</span>
<a href="#l85.2"></a><span id="l85.2" class="difflineplus">+++ b/mailnews/compose/src/nsMsgCompFields.h</span>
<a href="#l85.3"></a><span id="l85.3" class="difflineat">@@ -146,22 +146,22 @@ public:</span>
<a href="#l85.4"></a><span id="l85.4"> </span>
<a href="#l85.5"></a><span id="l85.5">   nsresult SetFollowupTo(const char *aValue) {return SetAsciiHeader(MSG_FOLLOWUP_TO_HEADER_ID, aValue);}</span>
<a href="#l85.6"></a><span id="l85.6">   const char* GetFollowupTo() {return GetAsciiHeader(MSG_FOLLOWUP_TO_HEADER_ID);}</span>
<a href="#l85.7"></a><span id="l85.7"> </span>
<a href="#l85.8"></a><span id="l85.8">   nsresult SetSubject(const char *value) {return SetAsciiHeader(MSG_SUBJECT_HEADER_ID, value);}</span>
<a href="#l85.9"></a><span id="l85.9">   const char* GetSubject() {return GetAsciiHeader(MSG_SUBJECT_HEADER_ID);}</span>
<a href="#l85.10"></a><span id="l85.10"> </span>
<a href="#l85.11"></a><span id="l85.11">   const char* GetAttachments() {</span>
<a href="#l85.12"></a><span id="l85.12" class="difflineminus">-    NS_ASSERTION(0, &quot;nsMsgCompFields::GetAttachments is not supported anymore, please use nsMsgCompFields::GetAttachmentsArray&quot;);</span>
<a href="#l85.13"></a><span id="l85.13" class="difflineplus">+    NS_ERROR(&quot;nsMsgCompFields::GetAttachments is not supported anymore, please use nsMsgCompFields::GetAttachmentsArray&quot;);</span>
<a href="#l85.14"></a><span id="l85.14">     return GetAsciiHeader(MSG_ATTACHMENTS_HEADER_ID);</span>
<a href="#l85.15"></a><span id="l85.15">     }</span>
<a href="#l85.16"></a><span id="l85.16"> </span>
<a href="#l85.17"></a><span id="l85.17">   const char* GetTemporaryFiles() {</span>
<a href="#l85.18"></a><span id="l85.18" class="difflineminus">-    NS_ASSERTION(0, &quot;nsMsgCompFields::GetTemporaryFiles is not supported anymore, please use nsMsgCompFields::GetAttachmentsArray&quot;);</span>
<a href="#l85.19"></a><span id="l85.19" class="difflineplus">+    NS_ERROR(&quot;nsMsgCompFields::GetTemporaryFiles is not supported anymore, please use nsMsgCompFields::GetAttachmentsArray&quot;);</span>
<a href="#l85.20"></a><span id="l85.20">     return GetAsciiHeader(MSG_TEMPORARY_FILES_HEADER_ID);</span>
<a href="#l85.21"></a><span id="l85.21">     }</span>
<a href="#l85.22"></a><span id="l85.22"> </span>
<a href="#l85.23"></a><span id="l85.23">   nsresult SetOrganization(const char *value) {return SetAsciiHeader(MSG_ORGANIZATION_HEADER_ID, value);}</span>
<a href="#l85.24"></a><span id="l85.24">   const char* GetOrganization() {return GetAsciiHeader(MSG_ORGANIZATION_HEADER_ID);}</span>
<a href="#l85.25"></a><span id="l85.25"> </span>
<a href="#l85.26"></a><span id="l85.26">   const char* GetReferences() {return GetAsciiHeader(MSG_REFERENCES_HEADER_ID);}</span>
<a href="#l85.27"></a><span id="l85.27"> </span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l86.1"></a><span id="l86.1" class="difflineminus">--- a/mailnews/compose/src/nsMsgCompose.cpp</span>
<a href="#l86.2"></a><span id="l86.2" class="difflineplus">+++ b/mailnews/compose/src/nsMsgCompose.cpp</span>
<a href="#l86.3"></a><span id="l86.3" class="difflineat">@@ -3832,17 +3832,17 @@ nsMsgCompose::LoadDataFromFile(nsILocalF</span>
<a href="#l86.4"></a><span id="l86.4">   PRInt32       readSize;</span>
<a href="#l86.5"></a><span id="l86.5">   PRUint32       nGot;</span>
<a href="#l86.6"></a><span id="l86.6">   char          *readBuf;</span>
<a href="#l86.7"></a><span id="l86.7">   char          *ptr;</span>
<a href="#l86.8"></a><span id="l86.8"> </span>
<a href="#l86.9"></a><span id="l86.9">   PRBool isDirectory = PR_FALSE;</span>
<a href="#l86.10"></a><span id="l86.10">   file-&gt;IsDirectory(&amp;isDirectory);</span>
<a href="#l86.11"></a><span id="l86.11">   if (isDirectory) {</span>
<a href="#l86.12"></a><span id="l86.12" class="difflineminus">-    NS_ASSERTION(0,&quot;file is a directory&quot;);</span>
<a href="#l86.13"></a><span id="l86.13" class="difflineplus">+    NS_ERROR(&quot;file is a directory&quot;);</span>
<a href="#l86.14"></a><span id="l86.14">     return NS_MSG_ERROR_READING_FILE;</span>
<a href="#l86.15"></a><span id="l86.15">   }</span>
<a href="#l86.16"></a><span id="l86.16"> </span>
<a href="#l86.17"></a><span id="l86.17"> </span>
<a href="#l86.18"></a><span id="l86.18">   nsCOMPtr &lt;nsIInputStream&gt; inputFile;</span>
<a href="#l86.19"></a><span id="l86.19">   nsresult rv = NS_NewLocalFileInputStream(getter_AddRefs(inputFile), file);</span>
<a href="#l86.20"></a><span id="l86.20">   if (NS_FAILED(rv))</span>
<a href="#l86.21"></a><span id="l86.21">     return NS_MSG_ERROR_READING_FILE;</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l87.1"></a><span id="l87.1" class="difflineminus">--- a/mailnews/compose/src/nsMsgSend.cpp</span>
<a href="#l87.2"></a><span id="l87.2" class="difflineplus">+++ b/mailnews/compose/src/nsMsgSend.cpp</span>
<a href="#l87.3"></a><span id="l87.3" class="difflineat">@@ -3657,17 +3657,17 @@ nsMsgComposeAndSend::DeliverFileAsMail()</span>
<a href="#l87.4"></a><span id="l87.4">     // &quot;prefers&quot; attribute in the ab.</span>
<a href="#l87.5"></a><span id="l87.5">     // see bug #245520 for more details</span>
<a href="#l87.6"></a><span id="l87.6">     // sendFormat = nsIAbPreferMailFormat::plaintext;</span>
<a href="#l87.7"></a><span id="l87.7">     sendFormat = nsIAbPreferMailFormat::unknown;</span>
<a href="#l87.8"></a><span id="l87.8">   }</span>
<a href="#l87.9"></a><span id="l87.9">   else if (!forcePlainText)</span>
<a href="#l87.10"></a><span id="l87.10">     sendFormat = nsIAbPreferMailFormat::html;</span>
<a href="#l87.11"></a><span id="l87.11">   else</span>
<a href="#l87.12"></a><span id="l87.12" class="difflineminus">-    NS_ASSERTION(0,&quot;unknown send format, should not happen&quot;);</span>
<a href="#l87.13"></a><span id="l87.13" class="difflineplus">+    NS_ERROR(&quot;unknown send format, should not happen&quot;);</span>
<a href="#l87.14"></a><span id="l87.14"> #endif</span>
<a href="#l87.15"></a><span id="l87.15"> </span>
<a href="#l87.16"></a><span id="l87.16">   PL_strcpy (buf, &quot;&quot;);</span>
<a href="#l87.17"></a><span id="l87.17">   buf2 = buf + PL_strlen (buf);</span>
<a href="#l87.18"></a><span id="l87.18">   if (mCompFields-&gt;GetTo() &amp;&amp; *mCompFields-&gt;GetTo())</span>
<a href="#l87.19"></a><span id="l87.19">   {</span>
<a href="#l87.20"></a><span id="l87.20">     PL_strcat (buf2, mCompFields-&gt;GetTo());</span>
<a href="#l87.21"></a><span id="l87.21">     if (addressCollector)</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l88.1"></a><span id="l88.1" class="difflineminus">--- a/mailnews/db/msgdb/src/nsImapMailDatabase.cpp</span>
<a href="#l88.2"></a><span id="l88.2" class="difflineplus">+++ b/mailnews/db/msgdb/src/nsImapMailDatabase.cpp</span>
<a href="#l88.3"></a><span id="l88.3" class="difflineat">@@ -131,17 +131,17 @@ NS_IMETHODIMP nsImapMailDatabase::ForceC</span>
<a href="#l88.4"></a><span id="l88.4"> </span>
<a href="#l88.5"></a><span id="l88.5"> NS_IMETHODIMP nsImapMailDatabase::GetFolderStream(nsIOutputStream **aFileStream)</span>
<a href="#l88.6"></a><span id="l88.6"> {</span>
<a href="#l88.7"></a><span id="l88.7">   return NS_ERROR_NOT_IMPLEMENTED;</span>
<a href="#l88.8"></a><span id="l88.8"> }</span>
<a href="#l88.9"></a><span id="l88.9"> </span>
<a href="#l88.10"></a><span id="l88.10"> NS_IMETHODIMP nsImapMailDatabase::SetFolderStream(nsIOutputStream *aFileStream)</span>
<a href="#l88.11"></a><span id="l88.11"> {</span>
<a href="#l88.12"></a><span id="l88.12" class="difflineminus">-  NS_ASSERTION(0, &quot;Trying to set folderStream, not implemented&quot;);</span>
<a href="#l88.13"></a><span id="l88.13" class="difflineplus">+  NS_ERROR(&quot;Trying to set folderStream, not implemented&quot;);</span>
<a href="#l88.14"></a><span id="l88.14">   return NS_ERROR_NOT_IMPLEMENTED;</span>
<a href="#l88.15"></a><span id="l88.15"> }</span>
<a href="#l88.16"></a><span id="l88.16"> </span>
<a href="#l88.17"></a><span id="l88.17"> nsresult nsImapMailDatabase::GetAllPendingHdrsTable()</span>
<a href="#l88.18"></a><span id="l88.18"> {</span>
<a href="#l88.19"></a><span id="l88.19">   nsresult rv = NS_OK;</span>
<a href="#l88.20"></a><span id="l88.20">   if (!m_mdbAllPendingHdrsTable)</span>
<a href="#l88.21"></a><span id="l88.21">     rv = GetTableCreateIfMissing(kPendingHdrsScope, kPendingHdrsTableKind, getter_AddRefs(m_mdbAllPendingHdrsTable),</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l89.1"></a><span id="l89.1" class="difflineminus">--- a/mailnews/db/msgdb/src/nsMsgDatabase.cpp</span>
<a href="#l89.2"></a><span id="l89.2" class="difflineplus">+++ b/mailnews/db/msgdb/src/nsMsgDatabase.cpp</span>
<a href="#l89.3"></a><span id="l89.3" class="difflineat">@@ -5343,17 +5343,17 @@ NS_IMETHODIMP nsMsgDatabase::ResetHdrCac</span>
<a href="#l89.4"></a><span id="l89.4"> </span>
<a href="#l89.5"></a><span id="l89.5"> NS_IMETHODIMP nsMsgDatabase::GetFolderStream(nsIOutputStream **aFileStream)</span>
<a href="#l89.6"></a><span id="l89.6"> {</span>
<a href="#l89.7"></a><span id="l89.7">   return NS_ERROR_NOT_IMPLEMENTED;</span>
<a href="#l89.8"></a><span id="l89.8"> }</span>
<a href="#l89.9"></a><span id="l89.9"> </span>
<a href="#l89.10"></a><span id="l89.10"> NS_IMETHODIMP nsMsgDatabase::SetFolderStream(nsIOutputStream *aFileStream)</span>
<a href="#l89.11"></a><span id="l89.11"> {</span>
<a href="#l89.12"></a><span id="l89.12" class="difflineminus">-  NS_ASSERTION(0, &quot;Trying to set the folderStream, not implemented&quot;);</span>
<a href="#l89.13"></a><span id="l89.13" class="difflineplus">+  NS_ERROR(&quot;Trying to set the folderStream, not implemented&quot;);</span>
<a href="#l89.14"></a><span id="l89.14">   return NS_ERROR_NOT_IMPLEMENTED;</span>
<a href="#l89.15"></a><span id="l89.15"> }</span>
<a href="#l89.16"></a><span id="l89.16"> </span>
<a href="#l89.17"></a><span id="l89.17"> /**</span>
<a href="#l89.18"></a><span id="l89.18">   void getNewList(out unsigned long count, [array, size_is(count)] out long newKeys);</span>
<a href="#l89.19"></a><span id="l89.19">  */</span>
<a href="#l89.20"></a><span id="l89.20"> NS_IMETHODIMP</span>
<a href="#l89.21"></a><span id="l89.21"> nsMsgDatabase::GetNewList(PRUint32 *aCount, PRUint32 **aNewKeys)</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l90.1"></a><span id="l90.1" class="difflineminus">--- a/mailnews/extensions/smime/content/msgCompSMIMEOverlay.js</span>
<a href="#l90.2"></a><span id="l90.2" class="difflineplus">+++ b/mailnews/extensions/smime/content/msgCompSMIMEOverlay.js</span>
<a href="#l90.3"></a><span id="l90.3" class="difflineat">@@ -42,42 +42,32 @@ const gSMimeCompFieldsContractID = &quot;@moz</span>
<a href="#l90.4"></a><span id="l90.4"> const gSMimeContractID = &quot;@mozilla.org/messenger-smime/smimejshelper;1&quot;;</span>
<a href="#l90.5"></a><span id="l90.5"> const gISMimeJSHelper = Components.interfaces.nsISMimeJSHelper;</span>
<a href="#l90.6"></a><span id="l90.6"> var gNextSecurityButtonCommand = &quot;&quot;;</span>
<a href="#l90.7"></a><span id="l90.7"> var gBundle;</span>
<a href="#l90.8"></a><span id="l90.8"> var gBrandBundle;</span>
<a href="#l90.9"></a><span id="l90.9"> var gSMFields;</span>
<a href="#l90.10"></a><span id="l90.10"> var gEncryptedURIService = null;</span>
<a href="#l90.11"></a><span id="l90.11"> </span>
<a href="#l90.12"></a><span id="l90.12" class="difflineminus">-</span>
<a href="#l90.13"></a><span id="l90.13"> function onComposerClose()</span>
<a href="#l90.14"></a><span id="l90.14"> {</span>
<a href="#l90.15"></a><span id="l90.15">   gSMFields = null;</span>
<a href="#l90.16"></a><span id="l90.16">   setNoEncryptionUI();</span>
<a href="#l90.17"></a><span id="l90.17">   setNoSignatureUI();</span>
<a href="#l90.18"></a><span id="l90.18"> </span>
<a href="#l90.19"></a><span id="l90.19" class="difflineminus">-  if (!gMsgCompose)</span>
<a href="#l90.20"></a><span id="l90.20" class="difflineminus">-    return;</span>
<a href="#l90.21"></a><span id="l90.21" class="difflineminus">-</span>
<a href="#l90.22"></a><span id="l90.22" class="difflineminus">-  if (!gMsgCompose.compFields)</span>
<a href="#l90.23"></a><span id="l90.23" class="difflineplus">+  if (!gMsgCompose || !gMsgCompose.compFields)</span>
<a href="#l90.24"></a><span id="l90.24">     return;</span>
<a href="#l90.25"></a><span id="l90.25"> </span>
<a href="#l90.26"></a><span id="l90.26">   gMsgCompose.compFields.securityInfo = null;</span>
<a href="#l90.27"></a><span id="l90.27"> }</span>
<a href="#l90.28"></a><span id="l90.28"> </span>
<a href="#l90.29"></a><span id="l90.29"> function onComposerReOpen()</span>
<a href="#l90.30"></a><span id="l90.30"> {</span>
<a href="#l90.31"></a><span id="l90.31" class="difflineminus">-  // are we already set up?</span>
<a href="#l90.32"></a><span id="l90.32" class="difflineminus">-  if (gSMFields)</span>
<a href="#l90.33"></a><span id="l90.33" class="difflineminus">-    return;</span>
<a href="#l90.34"></a><span id="l90.34" class="difflineminus">-</span>
<a href="#l90.35"></a><span id="l90.35" class="difflineminus">-  if (!gMsgCompose)</span>
<a href="#l90.36"></a><span id="l90.36" class="difflineminus">-    return;</span>
<a href="#l90.37"></a><span id="l90.37" class="difflineminus">-</span>
<a href="#l90.38"></a><span id="l90.38" class="difflineminus">-  if (!gMsgCompose.compFields)</span>
<a href="#l90.39"></a><span id="l90.39" class="difflineplus">+  // Are we already set up ? Or are the required fields missing ?</span>
<a href="#l90.40"></a><span id="l90.40" class="difflineplus">+  if (gSMFields || !gMsgCompose || !gMsgCompose.compFields)</span>
<a href="#l90.41"></a><span id="l90.41">     return;</span>
<a href="#l90.42"></a><span id="l90.42"> </span>
<a href="#l90.43"></a><span id="l90.43">   gMsgCompose.compFields.securityInfo = null;</span>
<a href="#l90.44"></a><span id="l90.44"> </span>
<a href="#l90.45"></a><span id="l90.45">   gSMFields = Components.classes[gSMimeCompFieldsContractID].createInstance(gISMimeCompFields);</span>
<a href="#l90.46"></a><span id="l90.46">   if (gSMFields)</span>
<a href="#l90.47"></a><span id="l90.47">   {</span>
<a href="#l90.48"></a><span id="l90.48">     gMsgCompose.compFields.securityInfo = gSMFields;</span>
<a href="#l90.49"></a><span id="l90.49" class="difflineat">@@ -93,67 +83,79 @@ function onComposerReOpen()</span>
<a href="#l90.50"></a><span id="l90.50">       if (gEncryptedURIService.isEncrypted(gMsgCompose.originalMsgURI))</span>
<a href="#l90.51"></a><span id="l90.51">       {</span>
<a href="#l90.52"></a><span id="l90.52">         // Override encryption setting if original is known as encrypted.</span>
<a href="#l90.53"></a><span id="l90.53">         gSMFields.requireEncryptMessage = true;</span>
<a href="#l90.54"></a><span id="l90.54">       }</span>
<a href="#l90.55"></a><span id="l90.55">     }</span>
<a href="#l90.56"></a><span id="l90.56"> </span>
<a href="#l90.57"></a><span id="l90.57">     if (gSMFields.requireEncryptMessage)</span>
<a href="#l90.58"></a><span id="l90.58" class="difflineminus">-    {</span>
<a href="#l90.59"></a><span id="l90.59">       setEncryptionUI();</span>
<a href="#l90.60"></a><span id="l90.60" class="difflineminus">-    }</span>
<a href="#l90.61"></a><span id="l90.61">     else</span>
<a href="#l90.62"></a><span id="l90.62" class="difflineminus">-    {</span>
<a href="#l90.63"></a><span id="l90.63">       setNoEncryptionUI();</span>
<a href="#l90.64"></a><span id="l90.64" class="difflineminus">-    }</span>
<a href="#l90.65"></a><span id="l90.65"> </span>
<a href="#l90.66"></a><span id="l90.66">     if (gSMFields.signMessage)</span>
<a href="#l90.67"></a><span id="l90.67" class="difflineminus">-    {</span>
<a href="#l90.68"></a><span id="l90.68">       setSignatureUI();</span>
<a href="#l90.69"></a><span id="l90.69" class="difflineminus">-    }</span>
<a href="#l90.70"></a><span id="l90.70">     else</span>
<a href="#l90.71"></a><span id="l90.71" class="difflineminus">-    {</span>
<a href="#l90.72"></a><span id="l90.72">       setNoSignatureUI();</span>
<a href="#l90.73"></a><span id="l90.73" class="difflineminus">-    }</span>
<a href="#l90.74"></a><span id="l90.74">   }</span>
<a href="#l90.75"></a><span id="l90.75"> }</span>
<a href="#l90.76"></a><span id="l90.76"> </span>
<a href="#l90.77"></a><span id="l90.77" class="difflineplus">+addEventListener(&quot;load&quot;, smimeComposeOnLoad, false);</span>
<a href="#l90.78"></a><span id="l90.78"> </span>
<a href="#l90.79"></a><span id="l90.79"> // this function gets called multiple times,</span>
<a href="#l90.80"></a><span id="l90.80"> // but only on first open, not on composer recycling</span>
<a href="#l90.81"></a><span id="l90.81"> function smimeComposeOnLoad()</span>
<a href="#l90.82"></a><span id="l90.82"> {</span>
<a href="#l90.83"></a><span id="l90.83" class="difflineplus">+  removeEventListener(&quot;load&quot;, smimeComposeOnLoad, false);</span>
<a href="#l90.84"></a><span id="l90.84" class="difflineplus">+</span>
<a href="#l90.85"></a><span id="l90.85">   if (!gEncryptedURIService)</span>
<a href="#l90.86"></a><span id="l90.86" class="difflineminus">-  {</span>
<a href="#l90.87"></a><span id="l90.87">     gEncryptedURIService = </span>
<a href="#l90.88"></a><span id="l90.88">       Components.classes[&quot;@mozilla.org/messenger-smime/smime-encrypted-uris-service;1&quot;]</span>
<a href="#l90.89"></a><span id="l90.89">       .getService(Components.interfaces.nsIEncryptedSMIMEURIsService);</span>
<a href="#l90.90"></a><span id="l90.90" class="difflineminus">-  }</span>
<a href="#l90.91"></a><span id="l90.91"> </span>
<a href="#l90.92"></a><span id="l90.92">   onComposerReOpen();</span>
<a href="#l90.93"></a><span id="l90.93" class="difflineplus">+</span>
<a href="#l90.94"></a><span id="l90.94" class="difflineplus">+  top.controllers.appendController(SecurityController);</span>
<a href="#l90.95"></a><span id="l90.95" class="difflineplus">+</span>
<a href="#l90.96"></a><span id="l90.96" class="difflineplus">+  addEventListener(&quot;compose-from-changed&quot;, onComposerFromChanged, true);</span>
<a href="#l90.97"></a><span id="l90.97" class="difflineplus">+  addEventListener(&quot;compose-send-message&quot;, onComposerSendMessage, true);</span>
<a href="#l90.98"></a><span id="l90.98" class="difflineplus">+  addEventListener(&quot;compose-window-close&quot;, onComposerClose, true);</span>
<a href="#l90.99"></a><span id="l90.99" class="difflineplus">+  addEventListener(&quot;compose-window-reopen&quot;, onComposerReOpen, true);</span>
<a href="#l90.100"></a><span id="l90.100" class="difflineplus">+</span>
<a href="#l90.101"></a><span id="l90.101" class="difflineplus">+  addEventListener(&quot;unload&quot;, smimeComposeOnUnload, false);</span>
<a href="#l90.102"></a><span id="l90.102" class="difflineplus">+}</span>
<a href="#l90.103"></a><span id="l90.103" class="difflineplus">+</span>
<a href="#l90.104"></a><span id="l90.104" class="difflineplus">+function smimeComposeOnUnload()</span>
<a href="#l90.105"></a><span id="l90.105" class="difflineplus">+{</span>
<a href="#l90.106"></a><span id="l90.106" class="difflineplus">+  removeEventListener(&quot;unload&quot;, smimeComposeOnUnload, false);</span>
<a href="#l90.107"></a><span id="l90.107" class="difflineplus">+</span>
<a href="#l90.108"></a><span id="l90.108" class="difflineplus">+  removeEventListener(&quot;compose-from-changed&quot;, onComposerFromChanged, true);</span>
<a href="#l90.109"></a><span id="l90.109" class="difflineplus">+  removeEventListener(&quot;compose-send-message&quot;, onComposerSendMessage, true);</span>
<a href="#l90.110"></a><span id="l90.110" class="difflineplus">+  removeEventListener(&quot;compose-window-close&quot;, onComposerClose, true);</span>
<a href="#l90.111"></a><span id="l90.111" class="difflineplus">+  removeEventListener(&quot;compose-window-reopen&quot;, onComposerReOpen, true);</span>
<a href="#l90.112"></a><span id="l90.112" class="difflineplus">+</span>
<a href="#l90.113"></a><span id="l90.113" class="difflineplus">+  top.controllers.removeController(SecurityController);</span>
<a href="#l90.114"></a><span id="l90.114"> }</span>
<a href="#l90.115"></a><span id="l90.115"> </span>
<a href="#l90.116"></a><span id="l90.116"> function setupBundles()</span>
<a href="#l90.117"></a><span id="l90.117"> {</span>
<a href="#l90.118"></a><span id="l90.118" class="difflineminus">-  if (gBundle &amp;&amp; gBrandBundle)</span>
<a href="#l90.119"></a><span id="l90.119" class="difflineplus">+  if (gBundle)</span>
<a href="#l90.120"></a><span id="l90.120">     return;</span>
<a href="#l90.121"></a><span id="l90.121" class="difflineminus">-  </span>
<a href="#l90.122"></a><span id="l90.122" class="difflineminus">-  if (!gBundle) {</span>
<a href="#l90.123"></a><span id="l90.123" class="difflineminus">-    gBundle = document.getElementById(&quot;bundle_comp_smime&quot;);</span>
<a href="#l90.124"></a><span id="l90.124" class="difflineminus">-    gBrandBundle = document.getElementById(&quot;bundle_brand&quot;);</span>
<a href="#l90.125"></a><span id="l90.125" class="difflineminus">-  }</span>
<a href="#l90.126"></a><span id="l90.126" class="difflineplus">+</span>
<a href="#l90.127"></a><span id="l90.127" class="difflineplus">+  gBundle = document.getElementById(&quot;bundle_comp_smime&quot;);</span>
<a href="#l90.128"></a><span id="l90.128" class="difflineplus">+  gBrandBundle = document.getElementById(&quot;bundle_brand&quot;);</span>
<a href="#l90.129"></a><span id="l90.129"> }</span>
<a href="#l90.130"></a><span id="l90.130"> </span>
<a href="#l90.131"></a><span id="l90.131"> function showNeedSetupInfo()</span>
<a href="#l90.132"></a><span id="l90.132"> {</span>
<a href="#l90.133"></a><span id="l90.133">   var ifps = Components.interfaces.nsIPromptService;</span>
<a href="#l90.134"></a><span id="l90.134"> </span>
<a href="#l90.135"></a><span id="l90.135" class="difflineminus">-  var promptService = Components.classes[&quot;@mozilla.org/embedcomp/prompt-service;1&quot;].getService();</span>
<a href="#l90.136"></a><span id="l90.136" class="difflineminus">-  promptService = promptService.QueryInterface(ifps);</span>
<a href="#l90.137"></a><span id="l90.137" class="difflineplus">+  let promptService = Components.classes[&quot;@mozilla.org/embedcomp/prompt-service;1&quot;]</span>
<a href="#l90.138"></a><span id="l90.138" class="difflineplus">+                                .getService(ifps);</span>
<a href="#l90.139"></a><span id="l90.139">   setupBundles();</span>
<a href="#l90.140"></a><span id="l90.140"> </span>
<a href="#l90.141"></a><span id="l90.141">   if (promptService &amp;&amp; gBundle &amp;&amp; gBrandBundle) {</span>
<a href="#l90.142"></a><span id="l90.142">     var dummy = new Object;</span>
<a href="#l90.143"></a><span id="l90.143">     var buttonPressed =</span>
<a href="#l90.144"></a><span id="l90.144">     promptService.confirmEx(window,</span>
<a href="#l90.145"></a><span id="l90.145">       gBrandBundle.getString(&quot;brandShortName&quot;),</span>
<a href="#l90.146"></a><span id="l90.146">       gBundle.getString(&quot;NeedSetup&quot;), </span>
<a href="#l90.147"></a><span id="l90.147" class="difflineat">@@ -255,17 +257,16 @@ function doSecurityButton()</span>
<a href="#l90.148"></a><span id="l90.148">     </span>
<a href="#l90.149"></a><span id="l90.149">     case &quot;signMessage&quot;:</span>
<a href="#l90.150"></a><span id="l90.150">       signMessage();</span>
<a href="#l90.151"></a><span id="l90.151">       break;</span>
<a href="#l90.152"></a><span id="l90.152">     </span>
<a href="#l90.153"></a><span id="l90.153">     case &quot;show&quot;:</span>
<a href="#l90.154"></a><span id="l90.154">     default:</span>
<a href="#l90.155"></a><span id="l90.155">       showMessageComposeSecurityStatus();</span>
<a href="#l90.156"></a><span id="l90.156" class="difflineminus">-      break;</span>
<a href="#l90.157"></a><span id="l90.157">   }</span>
<a href="#l90.158"></a><span id="l90.158"> }</span>
<a href="#l90.159"></a><span id="l90.159"> </span>
<a href="#l90.160"></a><span id="l90.160"> function setNoSignatureUI()</span>
<a href="#l90.161"></a><span id="l90.161"> {</span>
<a href="#l90.162"></a><span id="l90.162">   top.document.getElementById(&quot;securityStatus&quot;).removeAttribute(&quot;signing&quot;);</span>
<a href="#l90.163"></a><span id="l90.163">   top.document.getElementById(&quot;signing-status&quot;).collapsed = true;</span>
<a href="#l90.164"></a><span id="l90.164"> }</span>
<a href="#l90.165"></a><span id="l90.165" class="difflineat">@@ -315,47 +316,43 @@ var SecurityController =</span>
<a href="#l90.166"></a><span id="l90.166">   {</span>
<a href="#l90.167"></a><span id="l90.167">     switch ( command )</span>
<a href="#l90.168"></a><span id="l90.168">     {</span>
<a href="#l90.169"></a><span id="l90.169">       case &quot;cmd_viewSecurityStatus&quot;:</span>
<a href="#l90.170"></a><span id="l90.170">         return true;</span>
<a href="#l90.171"></a><span id="l90.171">       </span>
<a href="#l90.172"></a><span id="l90.172">       default:</span>
<a href="#l90.173"></a><span id="l90.173">         return false;</span>
<a href="#l90.174"></a><span id="l90.174" class="difflineminus">-     }</span>
<a href="#l90.175"></a><span id="l90.175" class="difflineplus">+    }</span>
<a href="#l90.176"></a><span id="l90.176">   },</span>
<a href="#l90.177"></a><span id="l90.177"> </span>
<a href="#l90.178"></a><span id="l90.178">   isCommandEnabled: function(command)</span>
<a href="#l90.179"></a><span id="l90.179">   {</span>
<a href="#l90.180"></a><span id="l90.180">     switch ( command )</span>
<a href="#l90.181"></a><span id="l90.181">     {</span>
<a href="#l90.182"></a><span id="l90.182">       case &quot;cmd_viewSecurityStatus&quot;:</span>
<a href="#l90.183"></a><span id="l90.183" class="difflineminus">-      {</span>
<a href="#l90.184"></a><span id="l90.184">         return true;</span>
<a href="#l90.185"></a><span id="l90.185" class="difflineminus">-      }</span>
<a href="#l90.186"></a><span id="l90.186"> </span>
<a href="#l90.187"></a><span id="l90.187">       default:</span>
<a href="#l90.188"></a><span id="l90.188">         return false;</span>
<a href="#l90.189"></a><span id="l90.189">     }</span>
<a href="#l90.190"></a><span id="l90.190" class="difflineminus">-    return false;</span>
<a href="#l90.191"></a><span id="l90.191">   }</span>
<a href="#l90.192"></a><span id="l90.192"> };</span>
<a href="#l90.193"></a><span id="l90.193"> </span>
<a href="#l90.194"></a><span id="l90.194"> function onComposerSendMessage()</span>
<a href="#l90.195"></a><span id="l90.195"> {</span>
<a href="#l90.196"></a><span id="l90.196" class="difflineplus">+  let missingCount = new Object();</span>
<a href="#l90.197"></a><span id="l90.197" class="difflineplus">+  let emailAddresses = new Object();</span>
<a href="#l90.198"></a><span id="l90.198" class="difflineplus">+</span>
<a href="#l90.199"></a><span id="l90.199">   try {</span>
<a href="#l90.200"></a><span id="l90.200">     if (!gMsgCompose.compFields.securityInfo.requireEncryptMessage) {</span>
<a href="#l90.201"></a><span id="l90.201">       return;</span>
<a href="#l90.202"></a><span id="l90.202">     }</span>
<a href="#l90.203"></a><span id="l90.203"> </span>
<a href="#l90.204"></a><span id="l90.204">     var helper = Components.classes[gSMimeContractID].createInstance(gISMimeJSHelper);</span>
<a href="#l90.205"></a><span id="l90.205" class="difflineminus">-</span>
<a href="#l90.206"></a><span id="l90.206" class="difflineminus">-    var emailAddresses = new Object();</span>
<a href="#l90.207"></a><span id="l90.207" class="difflineminus">-    var missingCount = new Object();</span>
<a href="#l90.208"></a><span id="l90.208" class="difflineminus">-</span>
<a href="#l90.209"></a><span id="l90.209">     helper.getNoCertAddresses(</span>
<a href="#l90.210"></a><span id="l90.210">       gMsgCompose.compFields,</span>
<a href="#l90.211"></a><span id="l90.211">       missingCount,</span>
<a href="#l90.212"></a><span id="l90.212">       emailAddresses);</span>
<a href="#l90.213"></a><span id="l90.213">   }</span>
<a href="#l90.214"></a><span id="l90.214">   catch (e)</span>
<a href="#l90.215"></a><span id="l90.215">   {</span>
<a href="#l90.216"></a><span id="l90.216">     return;</span>
<a href="#l90.217"></a><span id="l90.217" class="difflineat">@@ -371,30 +368,27 @@ function onComposerSendMessage()</span>
<a href="#l90.218"></a><span id="l90.218">     // Does the current identity override the global preference?</span>
<a href="#l90.219"></a><span id="l90.219">     if (gCurrentIdentity.overrideGlobalPref)</span>
<a href="#l90.220"></a><span id="l90.220">       autocompleteDirectory = gCurrentIdentity.directoryServer;</span>
<a href="#l90.221"></a><span id="l90.221">     else</span>
<a href="#l90.222"></a><span id="l90.222">     {</span>
<a href="#l90.223"></a><span id="l90.223">       // Try the global one</span>
<a href="#l90.224"></a><span id="l90.224">       var prefs = Components.classes[&quot;@mozilla.org/preferences-service;1&quot;]</span>
<a href="#l90.225"></a><span id="l90.225">                             .getService(Components.interfaces.nsIPrefBranch);</span>
<a href="#l90.226"></a><span id="l90.226" class="difflineminus">-</span>
<a href="#l90.227"></a><span id="l90.227">       if (prefs.getBoolPref(&quot;ldap_2.autoComplete.useDirectory&quot;))</span>
<a href="#l90.228"></a><span id="l90.228">         autocompleteDirectory =</span>
<a href="#l90.229"></a><span id="l90.229">           prefs.getCharPref(&quot;ldap_2.autoComplete.directoryServer&quot;);</span>
<a href="#l90.230"></a><span id="l90.230">     }</span>
<a href="#l90.231"></a><span id="l90.231"> </span>
<a href="#l90.232"></a><span id="l90.232">     if (autocompleteDirectory)</span>
<a href="#l90.233"></a><span id="l90.233" class="difflineminus">-    {</span>
<a href="#l90.234"></a><span id="l90.234">       window.openDialog('chrome://messenger-smime/content/certFetchingStatus.xul',</span>
<a href="#l90.235"></a><span id="l90.235">                         '',</span>
<a href="#l90.236"></a><span id="l90.236">                         'chrome,resizable=1,modal=1,dialog=1', </span>
<a href="#l90.237"></a><span id="l90.237">                         autocompleteDirectory,</span>
<a href="#l90.238"></a><span id="l90.238">                         emailAddresses.value);</span>
<a href="#l90.239"></a><span id="l90.239" class="difflineminus">-    }</span>
<a href="#l90.240"></a><span id="l90.240">   }</span>
<a href="#l90.241"></a><span id="l90.241"> }</span>
<a href="#l90.242"></a><span id="l90.242"> </span>
<a href="#l90.243"></a><span id="l90.243"> function onComposerFromChanged()</span>
<a href="#l90.244"></a><span id="l90.244"> {</span>
<a href="#l90.245"></a><span id="l90.245">   if (!gSMFields)</span>
<a href="#l90.246"></a><span id="l90.246">     return;</span>
<a href="#l90.247"></a><span id="l90.247"> </span>
<a href="#l90.248"></a><span id="l90.248" class="difflineat">@@ -422,14 +416,8 @@ function onComposerFromChanged()</span>
<a href="#l90.249"></a><span id="l90.249">     </span>
<a href="#l90.250"></a><span id="l90.250">     if (!signMessage)</span>
<a href="#l90.251"></a><span id="l90.251">     {</span>
<a href="#l90.252"></a><span id="l90.252">       gSMFields.signMessage = false;</span>
<a href="#l90.253"></a><span id="l90.253">       setNoSignatureUI();</span>
<a href="#l90.254"></a><span id="l90.254">     }</span>
<a href="#l90.255"></a><span id="l90.255">   }</span>
<a href="#l90.256"></a><span id="l90.256"> }</span>
<a href="#l90.257"></a><span id="l90.257" class="difflineminus">-</span>
<a href="#l90.258"></a><span id="l90.258" class="difflineminus">-top.controllers.appendController(SecurityController);</span>
<a href="#l90.259"></a><span id="l90.259" class="difflineminus">-addEventListener('compose-window-close', onComposerClose, true);</span>
<a href="#l90.260"></a><span id="l90.260" class="difflineminus">-addEventListener('compose-window-reopen', onComposerReOpen, true);</span>
<a href="#l90.261"></a><span id="l90.261" class="difflineminus">-addEventListener('compose-send-message', onComposerSendMessage, true);</span>
<a href="#l90.262"></a><span id="l90.262" class="difflineminus">-addEventListener('compose-from-changed', onComposerFromChanged, true);</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l91.1"></a><span id="l91.1" class="difflineminus">--- a/mailnews/extensions/smime/content/msgCompSMIMEOverlay.xul</span>
<a href="#l91.2"></a><span id="l91.2" class="difflineplus">+++ b/mailnews/extensions/smime/content/msgCompSMIMEOverlay.xul</span>
<a href="#l91.3"></a><span id="l91.3" class="difflineat">@@ -40,20 +40,17 @@</span>
<a href="#l91.4"></a><span id="l91.4"> </span>
<a href="#l91.5"></a><span id="l91.5"> </span>
<a href="#l91.6"></a><span id="l91.6"> &lt;?xml-stylesheet href=&quot;chrome://messenger/skin/smime/msgCompSMIMEOverlay.css&quot; type=&quot;text/css&quot;?&gt; </span>
<a href="#l91.7"></a><span id="l91.7"> </span>
<a href="#l91.8"></a><span id="l91.8"> &lt;!DOCTYPE overlay SYSTEM &quot;chrome://messenger-smime/locale/msgCompSMIMEOverlay.dtd&quot;&gt;</span>
<a href="#l91.9"></a><span id="l91.9"> </span>
<a href="#l91.10"></a><span id="l91.10"> &lt;overlay xmlns=&quot;http://www.mozilla.org/keymaster/gatekeeper/there.is.only.xul&quot;&gt;</span>
<a href="#l91.11"></a><span id="l91.11"> </span>
<a href="#l91.12"></a><span id="l91.12" class="difflineminus">-  &lt;script type=&quot;application/x-javascript&quot; src=&quot;chrome://messenger-smime/content/msgCompSMIMEOverlay.js&quot;/&gt;</span>
<a href="#l91.13"></a><span id="l91.13" class="difflineminus">-  &lt;script type=&quot;application/x-javascript&quot;&gt;&lt;![CDATA[</span>
<a href="#l91.14"></a><span id="l91.14" class="difflineminus">-    window.addEventListener(&quot;load&quot;, smimeComposeOnLoad, true);</span>
<a href="#l91.15"></a><span id="l91.15" class="difflineminus">-  ]]&gt;&lt;/script&gt;</span>
<a href="#l91.16"></a><span id="l91.16" class="difflineplus">+  &lt;script type=&quot;application/javascript&quot; src=&quot;chrome://messenger-smime/content/msgCompSMIMEOverlay.js&quot;/&gt;</span>
<a href="#l91.17"></a><span id="l91.17"> </span>
<a href="#l91.18"></a><span id="l91.18">   &lt;window id=&quot;msgcomposeWindow&quot;&gt;</span>
<a href="#l91.19"></a><span id="l91.19">     &lt;broadcaster id=&quot;securityStatus&quot; crypto=&quot;&quot; signing=&quot;&quot;/&gt;</span>
<a href="#l91.20"></a><span id="l91.20">     &lt;observes element=&quot;securityStatus&quot; attribute=&quot;crypto&quot; /&gt;</span>
<a href="#l91.21"></a><span id="l91.21">     &lt;observes element=&quot;securityStatus&quot; attribute=&quot;signing&quot; /&gt;</span>
<a href="#l91.22"></a><span id="l91.22">     &lt;stringbundle id=&quot;bundle_comp_smime&quot; src=&quot;chrome://messenger-smime/locale/msgCompSMIMEOverlay.properties&quot;/&gt;</span>
<a href="#l91.23"></a><span id="l91.23">     &lt;stringbundle id=&quot;bundle_brand&quot; src=&quot;chrome://branding/locale/brand.properties&quot;/&gt;</span>
<a href="#l91.24"></a><span id="l91.24">   &lt;/window&gt;</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l92.1"></a><span id="l92.1" class="difflineminus">--- a/mailnews/extensions/smime/content/msgReadSMIMEOverlay.js</span>
<a href="#l92.2"></a><span id="l92.2" class="difflineplus">+++ b/mailnews/extensions/smime/content/msgReadSMIMEOverlay.js</span>
<a href="#l92.3"></a><span id="l92.3" class="difflineat">@@ -40,33 +40,47 @@ var gSignatureStatus = -1;</span>
<a href="#l92.4"></a><span id="l92.4"> var gSignerCert = null;</span>
<a href="#l92.5"></a><span id="l92.5"> var gEncryptionCert = null;</span>
<a href="#l92.6"></a><span id="l92.6"> var gBundle;</span>
<a href="#l92.7"></a><span id="l92.7"> var gBrandBundle;</span>
<a href="#l92.8"></a><span id="l92.8"> </span>
<a href="#l92.9"></a><span id="l92.9"> const nsPKIParamBlock    = &quot;@mozilla.org/security/pkiparamblock;1&quot;;</span>
<a href="#l92.10"></a><span id="l92.10"> const nsIPKIParamBlock    = Components.interfaces.nsIPKIParamBlock;</span>
<a href="#l92.11"></a><span id="l92.11"> </span>
<a href="#l92.12"></a><span id="l92.12" class="difflineplus">+addEventListener(&quot;load&quot;, smimeReadOnLoad, false);</span>
<a href="#l92.13"></a><span id="l92.13" class="difflineplus">+</span>
<a href="#l92.14"></a><span id="l92.14" class="difflineplus">+function smimeReadOnLoad()</span>
<a href="#l92.15"></a><span id="l92.15" class="difflineplus">+{</span>
<a href="#l92.16"></a><span id="l92.16" class="difflineplus">+  removeEventListener(&quot;load&quot;, smimeReadOnLoad, false);</span>
<a href="#l92.17"></a><span id="l92.17" class="difflineplus">+</span>
<a href="#l92.18"></a><span id="l92.18" class="difflineplus">+  top.controllers.appendController(SecurityController);</span>
<a href="#l92.19"></a><span id="l92.19" class="difflineplus">+</span>
<a href="#l92.20"></a><span id="l92.20" class="difflineplus">+  addEventListener(&quot;unload&quot;, smimeReadOnUnload, false);</span>
<a href="#l92.21"></a><span id="l92.21" class="difflineplus">+}</span>
<a href="#l92.22"></a><span id="l92.22" class="difflineplus">+</span>
<a href="#l92.23"></a><span id="l92.23" class="difflineplus">+function smimeReadOnUnload()</span>
<a href="#l92.24"></a><span id="l92.24" class="difflineplus">+{</span>
<a href="#l92.25"></a><span id="l92.25" class="difflineplus">+  removeEventListener(&quot;unload&quot;, smimeReadOnUnload, false);</span>
<a href="#l92.26"></a><span id="l92.26" class="difflineplus">+</span>
<a href="#l92.27"></a><span id="l92.27" class="difflineplus">+  top.controllers.removeController(SecurityController);</span>
<a href="#l92.28"></a><span id="l92.28" class="difflineplus">+}</span>
<a href="#l92.29"></a><span id="l92.29" class="difflineplus">+</span>
<a href="#l92.30"></a><span id="l92.30"> function setupBundles()</span>
<a href="#l92.31"></a><span id="l92.31"> {</span>
<a href="#l92.32"></a><span id="l92.32" class="difflineminus">-  if (gBundle &amp;&amp; gBrandBundle)</span>
<a href="#l92.33"></a><span id="l92.33" class="difflineplus">+  if (gBundle)</span>
<a href="#l92.34"></a><span id="l92.34">     return;</span>
<a href="#l92.35"></a><span id="l92.35"> </span>
<a href="#l92.36"></a><span id="l92.36" class="difflineminus">-  if (!gBundle) {</span>
<a href="#l92.37"></a><span id="l92.37" class="difflineminus">-    gBundle = document.getElementById(&quot;bundle_read_smime&quot;);</span>
<a href="#l92.38"></a><span id="l92.38" class="difflineminus">-    gBrandBundle = document.getElementById(&quot;bundle_brand&quot;);</span>
<a href="#l92.39"></a><span id="l92.39" class="difflineminus">-  }</span>
<a href="#l92.40"></a><span id="l92.40" class="difflineplus">+  gBundle = document.getElementById(&quot;bundle_read_smime&quot;);</span>
<a href="#l92.41"></a><span id="l92.41" class="difflineplus">+  gBrandBundle = document.getElementById(&quot;bundle_brand&quot;);</span>
<a href="#l92.42"></a><span id="l92.42"> }</span>
<a href="#l92.43"></a><span id="l92.43"> </span>
<a href="#l92.44"></a><span id="l92.44"> function showImapSignatureUnknown()</span>
<a href="#l92.45"></a><span id="l92.45"> {</span>
<a href="#l92.46"></a><span id="l92.46" class="difflineminus">-  var ifps = Components.interfaces.nsIPromptService;</span>
<a href="#l92.47"></a><span id="l92.47" class="difflineminus">-</span>
<a href="#l92.48"></a><span id="l92.48" class="difflineminus">-  var promptService = Components.classes[&quot;@mozilla.org/embedcomp/prompt-service;1&quot;].getService();</span>
<a href="#l92.49"></a><span id="l92.49" class="difflineminus">-  promptService = promptService.QueryInterface(ifps);</span>
<a href="#l92.50"></a><span id="l92.50" class="difflineplus">+  let promptService = Components.classes[&quot;@mozilla.org/embedcomp/prompt-service;1&quot;]</span>
<a href="#l92.51"></a><span id="l92.51" class="difflineplus">+                                .getService(Components.interfaces.nsIPromptService);</span>
<a href="#l92.52"></a><span id="l92.52">   setupBundles();</span>
<a href="#l92.53"></a><span id="l92.53"> </span>
<a href="#l92.54"></a><span id="l92.54">   if (promptService &amp;&amp; gBundle &amp;&amp; gBrandBundle) {</span>
<a href="#l92.55"></a><span id="l92.55">     if (promptService.confirm(window,</span>
<a href="#l92.56"></a><span id="l92.56">           gBrandBundle.getString(&quot;brandShortName&quot;),</span>
<a href="#l92.57"></a><span id="l92.57">           gBundle.getString(&quot;ImapOnDemand&quot;))) {</span>
<a href="#l92.58"></a><span id="l92.58">       gDBView.reloadMessageWithAllParts();</span>
<a href="#l92.59"></a><span id="l92.59">     }</span>
<a href="#l92.60"></a><span id="l92.60" class="difflineat">@@ -105,43 +119,38 @@ var SecurityController =</span>
<a href="#l92.61"></a><span id="l92.61">   {</span>
<a href="#l92.62"></a><span id="l92.62">     switch ( command )</span>
<a href="#l92.63"></a><span id="l92.63">     {</span>
<a href="#l92.64"></a><span id="l92.64">       case &quot;cmd_viewSecurityStatus&quot;:</span>
<a href="#l92.65"></a><span id="l92.65">         return true;</span>
<a href="#l92.66"></a><span id="l92.66"> </span>
<a href="#l92.67"></a><span id="l92.67">       default:</span>
<a href="#l92.68"></a><span id="l92.68">         return false;</span>
<a href="#l92.69"></a><span id="l92.69" class="difflineminus">-     }</span>
<a href="#l92.70"></a><span id="l92.70" class="difflineplus">+    }</span>
<a href="#l92.71"></a><span id="l92.71">   },</span>
<a href="#l92.72"></a><span id="l92.72"> </span>
<a href="#l92.73"></a><span id="l92.73">   isCommandEnabled: function(command)</span>
<a href="#l92.74"></a><span id="l92.74">   {</span>
<a href="#l92.75"></a><span id="l92.75">     switch ( command )</span>
<a href="#l92.76"></a><span id="l92.76">     {</span>
<a href="#l92.77"></a><span id="l92.77">       case &quot;cmd_viewSecurityStatus&quot;:</span>
<a href="#l92.78"></a><span id="l92.78" class="difflineminus">-      {</span>
<a href="#l92.79"></a><span id="l92.79">         if (document.documentElement.getAttribute('windowtype') == &quot;mail:messageWindow&quot;)</span>
<a href="#l92.80"></a><span id="l92.80">         {</span>
<a href="#l92.81"></a><span id="l92.81">           return (GetNumSelectedMessages() &gt; 0);</span>
<a href="#l92.82"></a><span id="l92.82">         }</span>
<a href="#l92.83"></a><span id="l92.83">         else</span>
<a href="#l92.84"></a><span id="l92.84">         {</span>
<a href="#l92.85"></a><span id="l92.85">           if (GetNumSelectedMessages() &gt; 0 &amp;&amp; gDBView)</span>
<a href="#l92.86"></a><span id="l92.86">           {</span>
<a href="#l92.87"></a><span id="l92.87">             var enabled = new Object();</span>
<a href="#l92.88"></a><span id="l92.88">             enabled.value = false;</span>
<a href="#l92.89"></a><span id="l92.89">             var checkStatus = new Object();</span>
<a href="#l92.90"></a><span id="l92.90">             gDBView.getCommandStatus(nsMsgViewCommandType.cmdRequiringMsgBody, enabled, checkStatus);</span>
<a href="#l92.91"></a><span id="l92.91">             return enabled.value;</span>
<a href="#l92.92"></a><span id="l92.92">           }</span>
<a href="#l92.93"></a><span id="l92.93">         }</span>
<a href="#l92.94"></a><span id="l92.94" class="difflineminus">-        return false;</span>
<a href="#l92.95"></a><span id="l92.95" class="difflineminus">-      }</span>
<a href="#l92.96"></a><span id="l92.96" class="difflineplus">+        // else: fall through.</span>
<a href="#l92.97"></a><span id="l92.97"> </span>
<a href="#l92.98"></a><span id="l92.98">       default:</span>
<a href="#l92.99"></a><span id="l92.99">         return false;</span>
<a href="#l92.100"></a><span id="l92.100">     }</span>
<a href="#l92.101"></a><span id="l92.101" class="difflineminus">-    return false;</span>
<a href="#l92.102"></a><span id="l92.102">   }</span>
<a href="#l92.103"></a><span id="l92.103"> };</span>
<a href="#l92.104"></a><span id="l92.104" class="difflineminus">-</span>
<a href="#l92.105"></a><span id="l92.105" class="difflineminus">-top.controllers.appendController(SecurityController);</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l93.1"></a><span id="l93.1" class="difflineminus">--- a/mailnews/imap/src/nsImapIncomingServer.cpp</span>
<a href="#l93.2"></a><span id="l93.2" class="difflineplus">+++ b/mailnews/imap/src/nsImapIncomingServer.cpp</span>
<a href="#l93.3"></a><span id="l93.3" class="difflineat">@@ -2141,32 +2141,29 @@ NS_IMETHODIMP nsImapIncomingServer::Forg</span>
<a href="#l93.4"></a><span id="l93.4"> </span>
<a href="#l93.5"></a><span id="l93.5"> </span>
<a href="#l93.6"></a><span id="l93.6"> NS_IMETHODIMP nsImapIncomingServer::PromptForPassword(nsACString&amp; aPassword,</span>
<a href="#l93.7"></a><span id="l93.7">                                                       nsIMsgWindow * aMsgWindow)</span>
<a href="#l93.8"></a><span id="l93.8"> {</span>
<a href="#l93.9"></a><span id="l93.9">   nsString passwordTitle;</span>
<a href="#l93.10"></a><span id="l93.10">   IMAPGetStringByID(IMAP_ENTER_PASSWORD_PROMPT_TITLE, getter_Copies(passwordTitle));</span>
<a href="#l93.11"></a><span id="l93.11">   nsCString promptValue;</span>
<a href="#l93.12"></a><span id="l93.12" class="difflineminus">-  PRBool okayValue;</span>
<a href="#l93.13"></a><span id="l93.13">   GetRealUsername(promptValue);</span>
<a href="#l93.14"></a><span id="l93.14"> </span>
<a href="#l93.15"></a><span id="l93.15">   nsCString hostName;</span>
<a href="#l93.16"></a><span id="l93.16">   GetRealHostName(hostName);</span>
<a href="#l93.17"></a><span id="l93.17">   promptValue.Append('@');</span>
<a href="#l93.18"></a><span id="l93.18">   promptValue.Append(hostName);</span>
<a href="#l93.19"></a><span id="l93.19"> </span>
<a href="#l93.20"></a><span id="l93.20">   nsString passwordText;</span>
<a href="#l93.21"></a><span id="l93.21">   nsresult rv = GetFormattedStringFromID(NS_ConvertASCIItoUTF16(promptValue),</span>
<a href="#l93.22"></a><span id="l93.22">                                          IMAP_ENTER_PASSWORD_PROMPT,</span>
<a href="#l93.23"></a><span id="l93.23">                                          passwordText);</span>
<a href="#l93.24"></a><span id="l93.24">   NS_ENSURE_SUCCESS(rv,rv);</span>
<a href="#l93.25"></a><span id="l93.25" class="difflineminus">-  rv =  GetPasswordWithUI(passwordText, passwordTitle, aMsgWindow,</span>
<a href="#l93.26"></a><span id="l93.26" class="difflineminus">-                          &amp;okayValue, aPassword);</span>
<a href="#l93.27"></a><span id="l93.27" class="difflineminus">-  return (okayValue) ? rv : NS_MSG_PASSWORD_PROMPT_CANCELLED;</span>
<a href="#l93.28"></a><span id="l93.28" class="difflineplus">+  return GetPasswordWithUI(passwordText, passwordTitle, aMsgWindow, aPassword);</span>
<a href="#l93.29"></a><span id="l93.29"> }</span>
<a href="#l93.30"></a><span id="l93.30"> </span>
<a href="#l93.31"></a><span id="l93.31"> // for the nsIImapServerSink interface</span>
<a href="#l93.32"></a><span id="l93.32"> NS_IMETHODIMP  nsImapIncomingServer::SetCapability(PRUint32 capability)</span>
<a href="#l93.33"></a><span id="l93.33"> {</span>
<a href="#l93.34"></a><span id="l93.34">   m_capability = capability;</span>
<a href="#l93.35"></a><span id="l93.35">   SetCapabilityPref(capability);</span>
<a href="#l93.36"></a><span id="l93.36">   return NS_OK;</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l94.1"></a><span id="l94.1" class="difflineminus">--- a/mailnews/imap/src/nsImapMailFolder.cpp</span>
<a href="#l94.2"></a><span id="l94.2" class="difflineplus">+++ b/mailnews/imap/src/nsImapMailFolder.cpp</span>
<a href="#l94.3"></a><span id="l94.3" class="difflineat">@@ -1758,17 +1758,17 @@ NS_IMETHODIMP nsImapMailFolder::RenameLo</span>
<a href="#l94.4"></a><span id="l94.4">       return dirFile-&gt;MoveToNative(nsnull, newNameStr);      // in case of rename operation leaf names will differ</span>
<a href="#l94.5"></a><span id="l94.5"> </span>
<a href="#l94.6"></a><span id="l94.6">     parentPathFile-&gt;AppendNative(newNameStr);    //only for move we need to progress further in case the parent differs</span>
<a href="#l94.7"></a><span id="l94.7">     PRBool isDirectory = PR_FALSE;</span>
<a href="#l94.8"></a><span id="l94.8">     parentPathFile-&gt;IsDirectory(&amp;isDirectory);</span>
<a href="#l94.9"></a><span id="l94.9">     if (!isDirectory)</span>
<a href="#l94.10"></a><span id="l94.10">       parentPathFile-&gt;Create(nsIFile::DIRECTORY_TYPE, 0700);</span>
<a href="#l94.11"></a><span id="l94.11">     else</span>
<a href="#l94.12"></a><span id="l94.12" class="difflineminus">-      NS_ASSERTION(0,&quot;Directory already exists.&quot;);</span>
<a href="#l94.13"></a><span id="l94.13" class="difflineplus">+      NS_ERROR(&quot;Directory already exists.&quot;);</span>
<a href="#l94.14"></a><span id="l94.14">     rv = RecursiveCopy(dirFile, parentPathFile);</span>
<a href="#l94.15"></a><span id="l94.15">     NS_ENSURE_SUCCESS(rv,rv);</span>
<a href="#l94.16"></a><span id="l94.16">     dirFile-&gt;Remove(PR_TRUE);                         // moving folders</span>
<a href="#l94.17"></a><span id="l94.17">   }</span>
<a href="#l94.18"></a><span id="l94.18">   return rv;</span>
<a href="#l94.19"></a><span id="l94.19"> }</span>
<a href="#l94.20"></a><span id="l94.20"> </span>
<a href="#l94.21"></a><span id="l94.21"> NS_IMETHODIMP nsImapMailFolder::GetPrettyName(nsAString&amp; prettyName)</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l95.1"></a><span id="l95.1" class="difflineminus">--- a/mailnews/imap/src/nsImapProtocol.cpp</span>
<a href="#l95.2"></a><span id="l95.2" class="difflineplus">+++ b/mailnews/imap/src/nsImapProtocol.cpp</span>
<a href="#l95.3"></a><span id="l95.3" class="difflineat">@@ -6968,19 +6968,25 @@ void nsImapProtocol::DiscoverMailboxList</span>
<a href="#l95.4"></a><span id="l95.4">   PRBool usingSubscription = PR_FALSE;</span>
<a href="#l95.5"></a><span id="l95.5"> </span>
<a href="#l95.6"></a><span id="l95.6">   m_hostSessionList-&gt;GetHostIsUsingSubscription(GetImapServerKey(), usingSubscription);</span>
<a href="#l95.7"></a><span id="l95.7">   // should we check a pref here, to be able to turn off XList?</span>
<a href="#l95.8"></a><span id="l95.8">   PRBool hasXLIST = GetServerStateParser().GetCapabilityFlag() &amp; kHasXListCapability;</span>
<a href="#l95.9"></a><span id="l95.9">   if (hasXLIST &amp;&amp; usingSubscription)</span>
<a href="#l95.10"></a><span id="l95.10">   {</span>
<a href="#l95.11"></a><span id="l95.11">     m_hierarchyNameState = kXListing;</span>
<a href="#l95.12"></a><span id="l95.12" class="difflineminus">-    // We use &quot;%.%&quot; since gmail special folders are unlikely</span>
<a href="#l95.13"></a><span id="l95.13" class="difflineplus">+    nsCAutoString pattern(&quot;%&quot;);</span>
<a href="#l95.14"></a><span id="l95.14" class="difflineplus">+    List(&quot;%&quot;, PR_TRUE, PR_TRUE);</span>
<a href="#l95.15"></a><span id="l95.15" class="difflineplus">+    // We list the first and second levels since special folders are unlikely</span>
<a href="#l95.16"></a><span id="l95.16">     // to be more than 2 levels deep.</span>
<a href="#l95.17"></a><span id="l95.17" class="difflineminus">-    List(&quot;%.%&quot;, PR_TRUE, PR_TRUE);</span>
<a href="#l95.18"></a><span id="l95.18" class="difflineplus">+    char separator = 0;</span>
<a href="#l95.19"></a><span id="l95.19" class="difflineplus">+    m_runningUrl-&gt;GetOnlineSubDirSeparator(&amp;separator);</span>
<a href="#l95.20"></a><span id="l95.20" class="difflineplus">+    pattern.Append(separator);</span>
<a href="#l95.21"></a><span id="l95.21" class="difflineplus">+    pattern += '%';</span>
<a href="#l95.22"></a><span id="l95.22" class="difflineplus">+    List(pattern.get(), PR_TRUE, PR_TRUE);</span>
<a href="#l95.23"></a><span id="l95.23">   }</span>
<a href="#l95.24"></a><span id="l95.24"> </span>
<a href="#l95.25"></a><span id="l95.25">   SetMailboxDiscoveryStatus(eContinue);</span>
<a href="#l95.26"></a><span id="l95.26">   if (GetServerStateParser().ServerHasACLCapability())</span>
<a href="#l95.27"></a><span id="l95.27">     m_hierarchyNameState = kListingForInfoAndDiscovery;</span>
<a href="#l95.28"></a><span id="l95.28">   else</span>
<a href="#l95.29"></a><span id="l95.29">     m_hierarchyNameState = kNoOperationInProgress;</span>
<a href="#l95.30"></a><span id="l95.30"> </span>
<a href="#l95.31"></a><span id="l95.31" class="difflineat">@@ -7927,18 +7933,20 @@ nsresult nsImapProtocol::GetPassword(nsC</span>
<a href="#l95.32"></a><span id="l95.32">   {</span>
<a href="#l95.33"></a><span id="l95.33">     nsCOMPtr&lt;nsIMsgWindow&gt; msgWindow;</span>
<a href="#l95.34"></a><span id="l95.34"> </span>
<a href="#l95.35"></a><span id="l95.35">     GetMsgWindow(getter_AddRefs(msgWindow));</span>
<a href="#l95.36"></a><span id="l95.36">     // need to copy password, because in the case of Cancel,</span>
<a href="#l95.37"></a><span id="l95.37">     // GetPasswordWithUI will truncate the password.</span>
<a href="#l95.38"></a><span id="l95.38">     nsCString pwd = m_lastPasswordSent;</span>
<a href="#l95.39"></a><span id="l95.39">     nsresult rv = m_imapServerSink-&gt;PromptForPassword(pwd, msgWindow);</span>
<a href="#l95.40"></a><span id="l95.40" class="difflineminus">-    if (rv == NS_MSG_PASSWORD_PROMPT_CANCELLED)</span>
<a href="#l95.41"></a><span id="l95.41" class="difflineplus">+</span>
<a href="#l95.42"></a><span id="l95.42" class="difflineplus">+    if (NS_FAILED(rv) || rv == NS_MSG_PASSWORD_PROMPT_CANCELLED)</span>
<a href="#l95.43"></a><span id="l95.43">       return NS_ERROR_ABORT;</span>
<a href="#l95.44"></a><span id="l95.44" class="difflineplus">+</span>
<a href="#l95.45"></a><span id="l95.45">     password.Assign(pwd);</span>
<a href="#l95.46"></a><span id="l95.46">   }</span>
<a href="#l95.47"></a><span id="l95.47">   m_lastPasswordSent = password;</span>
<a href="#l95.48"></a><span id="l95.48">   return NS_OK;</span>
<a href="#l95.49"></a><span id="l95.49"> }</span>
<a href="#l95.50"></a><span id="l95.50"> </span>
<a href="#l95.51"></a><span id="l95.51"> PRBool nsImapProtocol::TryToLogon()</span>
<a href="#l95.52"></a><span id="l95.52"> {</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l96.1"></a><span id="l96.1" class="difflineminus">--- a/mailnews/imap/src/nsImapService.cpp</span>
<a href="#l96.2"></a><span id="l96.2" class="difflineplus">+++ b/mailnews/imap/src/nsImapService.cpp</span>
<a href="#l96.3"></a><span id="l96.3" class="difflineat">@@ -693,17 +693,17 @@ nsresult nsImapService::FetchMimePart(ns</span>
<a href="#l96.4"></a><span id="l96.4">         rv = aChannel-&gt;AsyncOpen(aStreamListener, aCtxt);</span>
<a href="#l96.5"></a><span id="l96.5">       }</span>
<a href="#l96.6"></a><span id="l96.6">       else // do what we used to do before</span>
<a href="#l96.7"></a><span id="l96.7">       {</span>
<a href="#l96.8"></a><span id="l96.8">         // I'd like to get rid of this code as I believe that we always get a docshell</span>
<a href="#l96.9"></a><span id="l96.9">         // or stream listener passed into us in this method but i'm not sure yet...</span>
<a href="#l96.10"></a><span id="l96.10">         // I'm going to use an assert for now to figure out if this is ever getting called</span>
<a href="#l96.11"></a><span id="l96.11"> #if defined(DEBUG_mscott) || defined(DEBUG_bienvenu)</span>
<a href="#l96.12"></a><span id="l96.12" class="difflineminus">-        NS_ASSERTION(0, &quot;oops...someone still is reaching this part of the code&quot;);</span>
<a href="#l96.13"></a><span id="l96.13" class="difflineplus">+        NS_ERROR(&quot;oops...someone still is reaching this part of the code&quot;);</span>
<a href="#l96.14"></a><span id="l96.14"> #endif</span>
<a href="#l96.15"></a><span id="l96.15">         rv = GetImapConnectionAndLoadUrl(NS_GetCurrentThread(), aImapUrl,</span>
<a href="#l96.16"></a><span id="l96.16">                                          aDisplayConsumer, aURL);</span>
<a href="#l96.17"></a><span id="l96.17">       }</span>
<a href="#l96.18"></a><span id="l96.18">     }</span>
<a href="#l96.19"></a><span id="l96.19">   }</span>
<a href="#l96.20"></a><span id="l96.20">   return rv;</span>
<a href="#l96.21"></a><span id="l96.21"> }</span>
<a href="#l96.22"></a><span id="l96.22" class="difflineat">@@ -1132,17 +1132,17 @@ nsresult nsImapService::GetMessageFromUr</span>
<a href="#l96.23"></a><span id="l96.23">       rv = channel-&gt;AsyncOpen(streamListener, aCtxt);</span>
<a href="#l96.24"></a><span id="l96.24">     }</span>
<a href="#l96.25"></a><span id="l96.25">     else // do what we used to do before</span>
<a href="#l96.26"></a><span id="l96.26">     {</span>
<a href="#l96.27"></a><span id="l96.27">       // I'd like to get rid of this code as I believe that we always get a docshell</span>
<a href="#l96.28"></a><span id="l96.28">       // or stream listener passed into us in this method but i'm not sure yet...</span>
<a href="#l96.29"></a><span id="l96.29">       // I'm going to use an assert for now to figure out if this is ever getting called</span>
<a href="#l96.30"></a><span id="l96.30"> #if defined(DEBUG_mscott) || defined(DEBUG_bienvenu)</span>
<a href="#l96.31"></a><span id="l96.31" class="difflineminus">-      NS_ASSERTION(0, &quot;oops...someone still is reaching this part of the code&quot;);</span>
<a href="#l96.32"></a><span id="l96.32" class="difflineplus">+      NS_ERROR(&quot;oops...someone still is reaching this part of the code&quot;);</span>
<a href="#l96.33"></a><span id="l96.33"> #endif</span>
<a href="#l96.34"></a><span id="l96.34">       rv = GetImapConnectionAndLoadUrl(NS_GetCurrentThread(), aImapUrl,</span>
<a href="#l96.35"></a><span id="l96.35">                                        aDisplayConsumer, aURL);</span>
<a href="#l96.36"></a><span id="l96.36">     }</span>
<a href="#l96.37"></a><span id="l96.37">   }</span>
<a href="#l96.38"></a><span id="l96.38">   return rv;</span>
<a href="#l96.39"></a><span id="l96.39"> }</span>
<a href="#l96.40"></a><span id="l96.40"> </span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l97.1"></a><span id="l97.1" class="difflineminus">--- a/mailnews/local/src/nsLocalMailFolder.cpp</span>
<a href="#l97.2"></a><span id="l97.2" class="difflineplus">+++ b/mailnews/local/src/nsLocalMailFolder.cpp</span>
<a href="#l97.3"></a><span id="l97.3" class="difflineat">@@ -1653,17 +1653,17 @@ nsMsgLocalMailFolder::CopyMessages(nsIMs</span>
<a href="#l97.4"></a><span id="l97.4">                                    nsIMsgCopyServiceListener* listener,</span>
<a href="#l97.5"></a><span id="l97.5">                                    PRBool isFolder, PRBool allowUndo)</span>
<a href="#l97.6"></a><span id="l97.6"> {</span>
<a href="#l97.7"></a><span id="l97.7">   nsCOMPtr&lt;nsISupports&gt; srcSupport = do_QueryInterface(srcFolder);</span>
<a href="#l97.8"></a><span id="l97.8">   PRBool isServer;</span>
<a href="#l97.9"></a><span id="l97.9">   nsresult rv = GetIsServer(&amp;isServer);</span>
<a href="#l97.10"></a><span id="l97.10">   if (NS_SUCCEEDED(rv) &amp;&amp; isServer)</span>
<a href="#l97.11"></a><span id="l97.11">   {</span>
<a href="#l97.12"></a><span id="l97.12" class="difflineminus">-    NS_ASSERTION(0, &quot;Destination is the root folder. Cannot move/copy here&quot;);</span>
<a href="#l97.13"></a><span id="l97.13" class="difflineplus">+    NS_ERROR(&quot;Destination is the root folder. Cannot move/copy here&quot;);</span>
<a href="#l97.14"></a><span id="l97.14">     if (isMove)</span>
<a href="#l97.15"></a><span id="l97.15">       srcFolder-&gt;NotifyFolderEvent(mDeleteOrMoveMsgFailedAtom);</span>
<a href="#l97.16"></a><span id="l97.16">     return OnCopyCompleted(srcSupport, PR_FALSE);</span>
<a href="#l97.17"></a><span id="l97.17">   }</span>
<a href="#l97.18"></a><span id="l97.18"> </span>
<a href="#l97.19"></a><span id="l97.19">   if (!(mFlags &amp; (nsMsgFolderFlags::Trash|nsMsgFolderFlags::Junk)))</span>
<a href="#l97.20"></a><span id="l97.20">     SetMRUTime();</span>
<a href="#l97.21"></a><span id="l97.21"> </span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l98.1"></a><span id="l98.1" class="difflineminus">--- a/mailnews/local/src/nsPop3Protocol.cpp</span>
<a href="#l98.2"></a><span id="l98.2" class="difflineplus">+++ b/mailnews/local/src/nsPop3Protocol.cpp</span>
<a href="#l98.3"></a><span id="l98.3" class="difflineat">@@ -658,17 +658,17 @@ void nsPop3Protocol::UpdateProgressPerce</span>
<a href="#l98.4"></a><span id="l98.4"> // do not pass in an escaped string</span>
<a href="#l98.5"></a><span id="l98.5"> void nsPop3Protocol::SetUsername(const char* name)</span>
<a href="#l98.6"></a><span id="l98.6"> {</span>
<a href="#l98.7"></a><span id="l98.7">   NS_ASSERTION(name, &quot;no name specified!&quot;);</span>
<a href="#l98.8"></a><span id="l98.8">     if (name)</span>
<a href="#l98.9"></a><span id="l98.9">       m_username = name;</span>
<a href="#l98.10"></a><span id="l98.10"> }</span>
<a href="#l98.11"></a><span id="l98.11"> </span>
<a href="#l98.12"></a><span id="l98.12" class="difflineminus">-nsresult nsPop3Protocol::GetPassword(nsCString&amp; aPassword, PRBool *okayValue)</span>
<a href="#l98.13"></a><span id="l98.13" class="difflineplus">+nsresult nsPop3Protocol::GetPassword(nsCString&amp; aPassword)</span>
<a href="#l98.14"></a><span id="l98.14"> {</span>
<a href="#l98.15"></a><span id="l98.15">   nsresult rv = NS_OK;</span>
<a href="#l98.16"></a><span id="l98.16">   nsCOMPtr&lt;nsIMsgIncomingServer&gt; server = do_QueryInterface(m_pop3Server);</span>
<a href="#l98.17"></a><span id="l98.17"> </span>
<a href="#l98.18"></a><span id="l98.18">   if (server)</span>
<a href="#l98.19"></a><span id="l98.19">   {</span>
<a href="#l98.20"></a><span id="l98.20">     PRBool isAuthenticated;</span>
<a href="#l98.21"></a><span id="l98.21">     m_nsIPop3Sink-&gt;GetUserAuthenticated(&amp;isAuthenticated);</span>
<a href="#l98.22"></a><span id="l98.22" class="difflineat">@@ -758,17 +758,17 @@ nsresult nsPop3Protocol::GetPassword(nsC</span>
<a href="#l98.23"></a><span id="l98.23">     nsString passwordTitle;</span>
<a href="#l98.24"></a><span id="l98.24">     mLocalBundle-&gt;GetStringFromName(</span>
<a href="#l98.25"></a><span id="l98.25">       NS_LITERAL_STRING(&quot;pop3EnterPasswordPromptTitle&quot;).get(),</span>
<a href="#l98.26"></a><span id="l98.26">       getter_Copies(passwordTitle));</span>
<a href="#l98.27"></a><span id="l98.27"> </span>
<a href="#l98.28"></a><span id="l98.28">     // Now go and get the password.</span>
<a href="#l98.29"></a><span id="l98.29">     if (!passwordPrompt.IsEmpty() &amp;&amp; !passwordTitle.IsEmpty())</span>
<a href="#l98.30"></a><span id="l98.30">       rv = server-&gt;GetPasswordWithUI(passwordPrompt, passwordTitle,</span>
<a href="#l98.31"></a><span id="l98.31" class="difflineminus">-                                     msgWindow, okayValue, aPassword);</span>
<a href="#l98.32"></a><span id="l98.32" class="difflineplus">+                                     msgWindow, aPassword);</span>
<a href="#l98.33"></a><span id="l98.33">     ClearFlag(POP3_PASSWORD_FAILED|POP3_AUTH_FAILURE);</span>
<a href="#l98.34"></a><span id="l98.34"> </span>
<a href="#l98.35"></a><span id="l98.35">     // If it failed, then user pressed the cancel button (or some other</span>
<a href="#l98.36"></a><span id="l98.36">     // failure).</span>
<a href="#l98.37"></a><span id="l98.37">     if (NS_FAILED(rv))</span>
<a href="#l98.38"></a><span id="l98.38">       m_pop3ConData-&gt;next_state = POP3_ERROR_DONE;</span>
<a href="#l98.39"></a><span id="l98.39">   }</span>
<a href="#l98.40"></a><span id="l98.40">   else</span>
<a href="#l98.41"></a><span id="l98.41" class="difflineat">@@ -1755,19 +1755,18 @@ PRInt32 nsPop3Protocol::AuthGSSAPIRespon</span>
<a href="#l98.42"></a><span id="l98.42"> }</span>
<a href="#l98.43"></a><span id="l98.43"> </span>
<a href="#l98.44"></a><span id="l98.44"> PRInt32 nsPop3Protocol::SendUsername()</span>
<a href="#l98.45"></a><span id="l98.45"> {</span>
<a href="#l98.46"></a><span id="l98.46">     if(m_username.IsEmpty())</span>
<a href="#l98.47"></a><span id="l98.47">       return(Error(POP3_USERNAME_UNDEFINED));</span>
<a href="#l98.48"></a><span id="l98.48"> </span>
<a href="#l98.49"></a><span id="l98.49">     nsCString password;</span>
<a href="#l98.50"></a><span id="l98.50" class="difflineminus">-    PRBool okayValue = PR_TRUE;</span>
<a href="#l98.51"></a><span id="l98.51" class="difflineminus">-    nsresult rv = GetPassword(password, &amp;okayValue);</span>
<a href="#l98.52"></a><span id="l98.52" class="difflineminus">-    if (NS_SUCCEEDED(rv) &amp;&amp; !okayValue)</span>
<a href="#l98.53"></a><span id="l98.53" class="difflineplus">+    nsresult rv = GetPassword(password);</span>
<a href="#l98.54"></a><span id="l98.54" class="difflineplus">+    if (NS_SUCCEEDED(rv) &amp;&amp; rv == NS_MSG_PASSWORD_PROMPT_CANCELLED)</span>
<a href="#l98.55"></a><span id="l98.55">     {</span>
<a href="#l98.56"></a><span id="l98.56">       // user has canceled the password prompt</span>
<a href="#l98.57"></a><span id="l98.57">       m_pop3ConData-&gt;next_state = POP3_ERROR_DONE;</span>
<a href="#l98.58"></a><span id="l98.58">       return NS_ERROR_ABORT;</span>
<a href="#l98.59"></a><span id="l98.59">     }</span>
<a href="#l98.60"></a><span id="l98.60">     else if (NS_FAILED(rv) || password.IsEmpty())</span>
<a href="#l98.61"></a><span id="l98.61">       return Error(POP3_PASSWORD_UNDEFINED);</span>
<a href="#l98.62"></a><span id="l98.62"> </span>
<a href="#l98.63"></a><span id="l98.63" class="difflineat">@@ -1806,19 +1805,18 @@ PRInt32 nsPop3Protocol::SendUsername()</span>
<a href="#l98.64"></a><span id="l98.64"> }</span>
<a href="#l98.65"></a><span id="l98.65"> </span>
<a href="#l98.66"></a><span id="l98.66"> PRInt32 nsPop3Protocol::SendPassword()</span>
<a href="#l98.67"></a><span id="l98.67"> {</span>
<a href="#l98.68"></a><span id="l98.68">     if (m_username.IsEmpty())</span>
<a href="#l98.69"></a><span id="l98.69">         return(Error(POP3_USERNAME_UNDEFINED));</span>
<a href="#l98.70"></a><span id="l98.70"> </span>
<a href="#l98.71"></a><span id="l98.71">     nsCString password;</span>
<a href="#l98.72"></a><span id="l98.72" class="difflineminus">-    PRBool okayValue = PR_TRUE;</span>
<a href="#l98.73"></a><span id="l98.73" class="difflineminus">-    nsresult rv = GetPassword(password, &amp;okayValue);</span>
<a href="#l98.74"></a><span id="l98.74" class="difflineminus">-    if (NS_SUCCEEDED(rv) &amp;&amp; !okayValue)</span>
<a href="#l98.75"></a><span id="l98.75" class="difflineplus">+    nsresult rv = GetPassword(password);</span>
<a href="#l98.76"></a><span id="l98.76" class="difflineplus">+    if (NS_SUCCEEDED(rv) &amp;&amp; rv == NS_MSG_PASSWORD_PROMPT_CANCELLED)</span>
<a href="#l98.77"></a><span id="l98.77">     {</span>
<a href="#l98.78"></a><span id="l98.78">         // user has canceled the password prompt</span>
<a href="#l98.79"></a><span id="l98.79">         m_pop3ConData-&gt;next_state = POP3_ERROR_DONE;</span>
<a href="#l98.80"></a><span id="l98.80">         return NS_ERROR_ABORT;</span>
<a href="#l98.81"></a><span id="l98.81">     }</span>
<a href="#l98.82"></a><span id="l98.82">     else if (NS_FAILED(rv) || password.IsEmpty())</span>
<a href="#l98.83"></a><span id="l98.83">     {</span>
<a href="#l98.84"></a><span id="l98.84">       return Error(POP3_PASSWORD_UNDEFINED);</span>
<a href="#l98.85"></a><span id="l98.85" class="difflineat">@@ -3438,18 +3436,17 @@ nsresult nsPop3Protocol::ProcessProtocol</span>
<a href="#l98.86"></a><span id="l98.86">     a connection to the pop server open; this saves us from</span>
<a href="#l98.87"></a><span id="l98.87">     having to worry about the server timing out on us while</span>
<a href="#l98.88"></a><span id="l98.88">       we wait for user input. */</span>
<a href="#l98.89"></a><span id="l98.89">       {</span>
<a href="#l98.90"></a><span id="l98.90">       /* If we're just checking for new mail (biff) then don't</span>
<a href="#l98.91"></a><span id="l98.91">       prompt the user for a password; just tell him we don't</span>
<a href="#l98.92"></a><span id="l98.92">         know whether he has new mail. */</span>
<a href="#l98.93"></a><span id="l98.93">         nsCString password;</span>
<a href="#l98.94"></a><span id="l98.94" class="difflineminus">-        PRBool okayValue;</span>
<a href="#l98.95"></a><span id="l98.95" class="difflineminus">-        GetPassword(password, &amp;okayValue);</span>
<a href="#l98.96"></a><span id="l98.96" class="difflineplus">+        GetPassword(password);</span>
<a href="#l98.97"></a><span id="l98.97">         const char * pwd = password.get();</span>
<a href="#l98.98"></a><span id="l98.98">         if (password.IsEmpty() || m_username.IsEmpty())</span>
<a href="#l98.99"></a><span id="l98.99">         {</span>
<a href="#l98.100"></a><span id="l98.100">           status = MK_POP3_PASSWORD_UNDEFINED;</span>
<a href="#l98.101"></a><span id="l98.101">           m_pop3ConData-&gt;biffstate = nsIMsgFolder::nsMsgBiffState_Unknown;</span>
<a href="#l98.102"></a><span id="l98.102">           m_nsIPop3Sink-&gt;SetBiffStateAndUpdateFE(m_pop3ConData-&gt;biffstate, 0, PR_FALSE);</span>
<a href="#l98.103"></a><span id="l98.103"> </span>
<a href="#l98.104"></a><span id="l98.104">           /* update old style biff */</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l99.1"></a><span id="l99.1" class="difflineminus">--- a/mailnews/local/src/nsPop3Protocol.h</span>
<a href="#l99.2"></a><span id="l99.2" class="difflineplus">+++ b/mailnews/local/src/nsPop3Protocol.h</span>
<a href="#l99.3"></a><span id="l99.3" class="difflineat">@@ -276,17 +276,17 @@ public:</span>
<a href="#l99.4"></a><span id="l99.4">   NS_DECL_NSIPOP3PROTOCOL</span>
<a href="#l99.5"></a><span id="l99.5"> </span>
<a href="#l99.6"></a><span id="l99.6">   nsresult Initialize(nsIURI * aURL);</span>
<a href="#l99.7"></a><span id="l99.7">   virtual nsresult LoadUrl(nsIURI *aURL, nsISupports * aConsumer = nsnull);</span>
<a href="#l99.8"></a><span id="l99.8"> </span>
<a href="#l99.9"></a><span id="l99.9">   const char* GetUsername() { return m_username.get(); }</span>
<a href="#l99.10"></a><span id="l99.10">   void SetUsername(const char* name);</span>
<a href="#l99.11"></a><span id="l99.11"> </span>
<a href="#l99.12"></a><span id="l99.12" class="difflineminus">-  nsresult GetPassword(nsCString&amp; aPassword, PRBool *okayValue);</span>
<a href="#l99.13"></a><span id="l99.13" class="difflineplus">+  nsresult GetPassword(nsCString&amp; aPassword);</span>
<a href="#l99.14"></a><span id="l99.14"> </span>
<a href="#l99.15"></a><span id="l99.15">   NS_IMETHOD OnTransportStatus(nsITransport *transport, nsresult status, PRUint64 progress, PRUint64 progressMax);</span>
<a href="#l99.16"></a><span id="l99.16">   NS_IMETHOD OnStopRequest(nsIRequest *request, nsISupports * aContext, nsresult aStatus);</span>
<a href="#l99.17"></a><span id="l99.17">   NS_IMETHOD Cancel(nsresult status);</span>
<a href="#l99.18"></a><span id="l99.18"> </span>
<a href="#l99.19"></a><span id="l99.19">   static void MarkMsgInHashTable(PLHashTable *hashTable, const Pop3UidlEntry *uidl,</span>
<a href="#l99.20"></a><span id="l99.20">                                   PRBool *changed);</span>
<a href="#l99.21"></a><span id="l99.21"> </span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l100.1"></a><span id="l100.1" class="difflineminus">--- a/mailnews/local/src/nsRssService.cpp</span>
<a href="#l100.2"></a><span id="l100.2" class="difflineplus">+++ b/mailnews/local/src/nsRssService.cpp</span>
<a href="#l100.3"></a><span id="l100.3" class="difflineat">@@ -73,35 +73,31 @@ NS_IMETHODIMP nsRssService::GetDefaultLo</span>
<a href="#l100.4"></a><span id="l100.4">    </span>
<a href="#l100.5"></a><span id="l100.5">     NS_IF_ADDREF(*aDefaultLocalPath = localFile);</span>
<a href="#l100.6"></a><span id="l100.6">     return NS_OK;</span>
<a href="#l100.7"></a><span id="l100.7"> </span>
<a href="#l100.8"></a><span id="l100.8"> }</span>
<a href="#l100.9"></a><span id="l100.9"> </span>
<a href="#l100.10"></a><span id="l100.10"> NS_IMETHODIMP nsRssService::SetDefaultLocalPath(nsILocalFile * aDefaultLocalPath)</span>
<a href="#l100.11"></a><span id="l100.11"> {</span>
<a href="#l100.12"></a><span id="l100.12" class="difflineminus">-    NS_ASSERTION(0,&quot;foo&quot;);</span>
<a href="#l100.13"></a><span id="l100.13">     return NS_ERROR_NOT_IMPLEMENTED;</span>
<a href="#l100.14"></a><span id="l100.14"> }</span>
<a href="#l100.15"></a><span id="l100.15"> </span>
<a href="#l100.16"></a><span id="l100.16"> NS_IMETHODIMP nsRssService::GetServerIID(nsIID * *aServerIID)</span>
<a href="#l100.17"></a><span id="l100.17"> {</span>
<a href="#l100.18"></a><span id="l100.18" class="difflineminus">-    NS_ASSERTION(0,&quot;foo&quot;);</span>
<a href="#l100.19"></a><span id="l100.19">     return NS_ERROR_NOT_IMPLEMENTED;</span>
<a href="#l100.20"></a><span id="l100.20"> }</span>
<a href="#l100.21"></a><span id="l100.21"> </span>
<a href="#l100.22"></a><span id="l100.22"> NS_IMETHODIMP nsRssService::GetRequiresUsername(PRBool *aRequiresUsername)</span>
<a href="#l100.23"></a><span id="l100.23"> {</span>
<a href="#l100.24"></a><span id="l100.24" class="difflineminus">-    NS_ASSERTION(0,&quot;foo&quot;);</span>
<a href="#l100.25"></a><span id="l100.25">     return NS_ERROR_NOT_IMPLEMENTED;</span>
<a href="#l100.26"></a><span id="l100.26"> }</span>
<a href="#l100.27"></a><span id="l100.27"> </span>
<a href="#l100.28"></a><span id="l100.28"> NS_IMETHODIMP nsRssService::GetPreflightPrettyNameWithEmailAddress(PRBool *aPreflightPrettyNameWithEmailAddress)</span>
<a href="#l100.29"></a><span id="l100.29"> {</span>
<a href="#l100.30"></a><span id="l100.30" class="difflineminus">-    NS_ASSERTION(0,&quot;foo&quot;);</span>
<a href="#l100.31"></a><span id="l100.31">     return NS_ERROR_NOT_IMPLEMENTED;</span>
<a href="#l100.32"></a><span id="l100.32"> }</span>
<a href="#l100.33"></a><span id="l100.33"> </span>
<a href="#l100.34"></a><span id="l100.34"> NS_IMETHODIMP nsRssService::GetCanDelete(PRBool *aCanDelete)</span>
<a href="#l100.35"></a><span id="l100.35"> {</span>
<a href="#l100.36"></a><span id="l100.36">     NS_ENSURE_ARG_POINTER(aCanDelete);</span>
<a href="#l100.37"></a><span id="l100.37">     *aCanDelete = PR_TRUE;</span>
<a href="#l100.38"></a><span id="l100.38">     return NS_OK;</span>
<a href="#l100.39"></a><span id="l100.39" class="difflineat">@@ -153,11 +149,10 @@ NS_IMETHODIMP nsRssService::GetShowCompo</span>
<a href="#l100.40"></a><span id="l100.40"> {</span>
<a href="#l100.41"></a><span id="l100.41">     NS_ENSURE_ARG_POINTER(aShowComposeMsgLink);</span>
<a href="#l100.42"></a><span id="l100.42">     *aShowComposeMsgLink = PR_FALSE;    </span>
<a href="#l100.43"></a><span id="l100.43">     return NS_OK;</span>
<a href="#l100.44"></a><span id="l100.44"> }</span>
<a href="#l100.45"></a><span id="l100.45"> </span>
<a href="#l100.46"></a><span id="l100.46"> NS_IMETHODIMP nsRssService::GetSpecialFoldersDeletionAllowed(PRBool *aSpecialFoldersDeletionAllowed)</span>
<a href="#l100.47"></a><span id="l100.47"> {</span>
<a href="#l100.48"></a><span id="l100.48" class="difflineminus">-    NS_ASSERTION(0,&quot;foo&quot;);</span>
<a href="#l100.49"></a><span id="l100.49">     return NS_ERROR_NOT_IMPLEMENTED;</span>
<a href="#l100.50"></a><span id="l100.50"> }</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l101.1"></a><span id="l101.1" class="difflineminus">--- a/mailnews/mime/src/mimecryp.cpp</span>
<a href="#l101.2"></a><span id="l101.2" class="difflineplus">+++ b/mailnews/mime/src/mimecryp.cpp</span>
<a href="#l101.3"></a><span id="l101.3" class="difflineat">@@ -173,18 +173,17 @@ MimeEncrypted_parse_buffer (const char *</span>
<a href="#l101.4"></a><span id="l101.4">                                    size,</span>
<a href="#l101.5"></a><span id="l101.5">                                    obj);</span>
<a href="#l101.6"></a><span id="l101.6"> }</span>
<a href="#l101.7"></a><span id="l101.7"> </span>
<a href="#l101.8"></a><span id="l101.8"> </span>
<a href="#l101.9"></a><span id="l101.9"> static int</span>
<a href="#l101.10"></a><span id="l101.10"> MimeEncrypted_parse_line (const char *line, PRInt32 length, MimeObject *obj)</span>
<a href="#l101.11"></a><span id="l101.11"> {</span>
<a href="#l101.12"></a><span id="l101.12" class="difflineminus">-  NS_ASSERTION(0, &quot;1.2 &lt;mscott@netscape.com&gt; 01 Nov 2001 17:59&quot;);</span>
<a href="#l101.13"></a><span id="l101.13" class="difflineminus">-  /* This method shouldn't ever be called. */</span>
<a href="#l101.14"></a><span id="l101.14" class="difflineplus">+  NS_ERROR(&quot;This method shouldn't ever be called.&quot;);</span>
<a href="#l101.15"></a><span id="l101.15">   return -1;</span>
<a href="#l101.16"></a><span id="l101.16"> }</span>
<a href="#l101.17"></a><span id="l101.17"> </span>
<a href="#l101.18"></a><span id="l101.18"> static int</span>
<a href="#l101.19"></a><span id="l101.19"> MimeEncrypted_parse_decoded_buffer (const char *buffer, PRInt32 size, MimeObject *obj)</span>
<a href="#l101.20"></a><span id="l101.20"> {</span>
<a href="#l101.21"></a><span id="l101.21">   MimeEncrypted *enc = (MimeEncrypted *) obj;</span>
<a href="#l101.22"></a><span id="l101.22">   return</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l102.1"></a><span id="l102.1" class="difflineminus">--- a/mailnews/mime/src/mimeenc.cpp</span>
<a href="#l102.2"></a><span id="l102.2" class="difflineplus">+++ b/mailnews/mime/src/mimeenc.cpp</span>
<a href="#l102.3"></a><span id="l102.3" class="difflineat">@@ -216,33 +216,35 @@ mime_decode_base64_token (const char *in</span>
<a href="#l102.4"></a><span id="l102.4">     unsigned char c = 0;</span>
<a href="#l102.5"></a><span id="l102.5">     if (in[j] &gt;= 'A' &amp;&amp; in[j] &lt;= 'Z')     c = in[j] - 'A';</span>
<a href="#l102.6"></a><span id="l102.6">     else if (in[j] &gt;= 'a' &amp;&amp; in[j] &lt;= 'z') c = in[j] - ('a' - 26);</span>
<a href="#l102.7"></a><span id="l102.7">     else if (in[j] &gt;= '0' &amp;&amp; in[j] &lt;= '9') c = in[j] - ('0' - 52);</span>
<a href="#l102.8"></a><span id="l102.8">     else if (in[j] == '+')         c = 62;</span>
<a href="#l102.9"></a><span id="l102.9">     else if (in[j] == '/')         c = 63;</span>
<a href="#l102.10"></a><span id="l102.10">     else if (in[j] == '=')         c = 0, eq_count++;</span>
<a href="#l102.11"></a><span id="l102.11">     else</span>
<a href="#l102.12"></a><span id="l102.12" class="difflineminus">-    NS_ASSERTION(0, &quot;1.1 &lt;rhp@netscape.com&gt; 19 Mar 1999 12:00&quot;);</span>
<a href="#l102.13"></a><span id="l102.13" class="difflineplus">+    NS_ERROR(&quot;Invalid character&quot;);</span>
<a href="#l102.14"></a><span id="l102.14">     num = (num &lt;&lt; 6) | c;</span>
<a href="#l102.15"></a><span id="l102.15">   }</span>
<a href="#l102.16"></a><span id="l102.16"> </span>
<a href="#l102.17"></a><span id="l102.17">   *out++ = (char) (num &gt;&gt; 16);</span>
<a href="#l102.18"></a><span id="l102.18">   *out++ = (char) ((num &gt;&gt; 8) &amp; 0xFF);</span>
<a href="#l102.19"></a><span id="l102.19">   *out++ = (char) (num &amp; 0xFF);</span>
<a href="#l102.20"></a><span id="l102.20"> </span>
<a href="#l102.21"></a><span id="l102.21">   if (eq_count == 0)</span>
<a href="#l102.22"></a><span id="l102.22">   return 3;        /* No &quot;=&quot; padding means 4 bytes mapped to 3. */</span>
<a href="#l102.23"></a><span id="l102.23">   else if (eq_count == 1)</span>
<a href="#l102.24"></a><span id="l102.24">   return 2;        /* &quot;xxx=&quot; means 3 bytes mapped to 2. */</span>
<a href="#l102.25"></a><span id="l102.25">   else if (eq_count == 2)</span>
<a href="#l102.26"></a><span id="l102.26">   return 1;        /* &quot;xx==&quot; means 2 bytes mapped to 1. */</span>
<a href="#l102.27"></a><span id="l102.27">   else</span>
<a href="#l102.28"></a><span id="l102.28" class="difflineminus">-  {            /* &quot;x===&quot; can't happen, because &quot;x&quot; would then */</span>
<a href="#l102.29"></a><span id="l102.29" class="difflineminus">-    NS_ASSERTION(0, &quot;1.1 &lt;rhp@netscape.com&gt; 19 Mar 1999 12:00&quot;);      /* be encoding only 6 bits, not the min of 8. */</span>
<a href="#l102.30"></a><span id="l102.30" class="difflineplus">+  {</span>
<a href="#l102.31"></a><span id="l102.31" class="difflineplus">+    // &quot;x===&quot; can't happen, because &quot;x&quot; would then be encoding only</span>
<a href="#l102.32"></a><span id="l102.32" class="difflineplus">+    // 6 bits, not the min of 8.</span>
<a href="#l102.33"></a><span id="l102.33" class="difflineplus">+    NS_ERROR(&quot;Count is 6 bits, should be at least 8&quot;);</span>
<a href="#l102.34"></a><span id="l102.34">     return 1;</span>
<a href="#l102.35"></a><span id="l102.35">   }</span>
<a href="#l102.36"></a><span id="l102.36"> }</span>
<a href="#l102.37"></a><span id="l102.37"> </span>
<a href="#l102.38"></a><span id="l102.38"> </span>
<a href="#l102.39"></a><span id="l102.39"> static int</span>
<a href="#l102.40"></a><span id="l102.40"> mime_decode_base64_buffer (MimeDecoderData *data,</span>
<a href="#l102.41"></a><span id="l102.41">                const char *buffer, PRInt32 length)</span>
<a href="#l102.42"></a><span id="l102.42" class="difflineat">@@ -836,17 +838,17 @@ MimeDecoderWrite (MimeDecoderData *data,</span>
<a href="#l102.43"></a><span id="l102.43">     return mime_decode_base64_buffer (data, buffer, size);</span>
<a href="#l102.44"></a><span id="l102.44">   case mime_QuotedPrintable:</span>
<a href="#l102.45"></a><span id="l102.45">     return mime_decode_qp_buffer (data, buffer, size);</span>
<a href="#l102.46"></a><span id="l102.46">   case mime_uuencode:</span>
<a href="#l102.47"></a><span id="l102.47">     return mime_decode_uue_buffer (data, buffer, size);</span>
<a href="#l102.48"></a><span id="l102.48">   case mime_yencode:</span>
<a href="#l102.49"></a><span id="l102.49">     return mime_decode_yenc_buffer (data, buffer, size);</span>
<a href="#l102.50"></a><span id="l102.50">   default:</span>
<a href="#l102.51"></a><span id="l102.51" class="difflineminus">-    NS_ASSERTION(0, &quot;1.1 &lt;rhp@netscape.com&gt; 19 Mar 1999 12:00&quot;);</span>
<a href="#l102.52"></a><span id="l102.52" class="difflineplus">+    NS_ERROR(&quot;Invalid decoding&quot;);</span>
<a href="#l102.53"></a><span id="l102.53">     return -1;</span>
<a href="#l102.54"></a><span id="l102.54">   }</span>
<a href="#l102.55"></a><span id="l102.55"> }</span>
<a href="#l102.56"></a><span id="l102.56"> </span>
<a href="#l102.57"></a><span id="l102.57"> </span>
<a href="#l102.58"></a><span id="l102.58"> </span>
<a href="#l102.59"></a><span id="l102.59"> /* ================== Encoders.</span>
<a href="#l102.60"></a><span id="l102.60">  */</span>
<a href="#l102.61"></a><span id="l102.61" class="difflineat">@@ -883,17 +885,17 @@ mime_encode_base64_buffer (MimeEncoderDa</span>
<a href="#l102.62"></a><span id="l102.62">   char *out = out_buffer;</span>
<a href="#l102.63"></a><span id="l102.63">   PRUint32 i = 0, n = 0;</span>
<a href="#l102.64"></a><span id="l102.64">   PRUint32 off;</span>
<a href="#l102.65"></a><span id="l102.65"> </span>
<a href="#l102.66"></a><span id="l102.66">   if (size == 0)</span>
<a href="#l102.67"></a><span id="l102.67">   return 0;</span>
<a href="#l102.68"></a><span id="l102.68">   else if (size &lt; 0)</span>
<a href="#l102.69"></a><span id="l102.69">   {</span>
<a href="#l102.70"></a><span id="l102.70" class="difflineminus">-    NS_ASSERTION(0, &quot;1.1 &lt;rhp@netscape.com&gt; 19 Mar 1999 12:00&quot;);</span>
<a href="#l102.71"></a><span id="l102.71" class="difflineplus">+    NS_ERROR(&quot;Size is less than 0&quot;);</span>
<a href="#l102.72"></a><span id="l102.72">     return -1;</span>
<a href="#l102.73"></a><span id="l102.73">   }</span>
<a href="#l102.74"></a><span id="l102.74"> </span>
<a href="#l102.75"></a><span id="l102.75"> </span>
<a href="#l102.76"></a><span id="l102.76">   /* If this input buffer is too small, wait until next time. */</span>
<a href="#l102.77"></a><span id="l102.77">   if (size &lt; (3 - data-&gt;in_buffer_count))</span>
<a href="#l102.78"></a><span id="l102.78">   {</span>
<a href="#l102.79"></a><span id="l102.79">     NS_ASSERTION(size &lt; 3 &amp;&amp; size &gt; 0, &quot;1.1 &lt;rhp@netscape.com&gt; 19 Mar 1999 12:00&quot;);</span>
<a href="#l102.80"></a><span id="l102.80" class="difflineat">@@ -1221,12 +1223,12 @@ MimeEncoderWrite (MimeEncoderData *data,</span>
<a href="#l102.81"></a><span id="l102.81">   if (!data) return -1;</span>
<a href="#l102.82"></a><span id="l102.82">   switch(data-&gt;encoding)</span>
<a href="#l102.83"></a><span id="l102.83">   {</span>
<a href="#l102.84"></a><span id="l102.84">   case mime_Base64:</span>
<a href="#l102.85"></a><span id="l102.85">     return mime_encode_base64_buffer (data, buffer, size);</span>
<a href="#l102.86"></a><span id="l102.86">   case mime_QuotedPrintable:</span>
<a href="#l102.87"></a><span id="l102.87">     return mime_encode_qp_buffer (data, buffer, size);</span>
<a href="#l102.88"></a><span id="l102.88">   default:</span>
<a href="#l102.89"></a><span id="l102.89" class="difflineminus">-    NS_ASSERTION(0, &quot;1.1 &lt;rhp@netscape.com&gt; 19 Mar 1999 12:00&quot;);</span>
<a href="#l102.90"></a><span id="l102.90" class="difflineplus">+    NS_ERROR(&quot;Invalid encoding&quot;);</span>
<a href="#l102.91"></a><span id="l102.91">     return -1;</span>
<a href="#l102.92"></a><span id="l102.92">   }</span>
<a href="#l102.93"></a><span id="l102.93"> }</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l103.1"></a><span id="l103.1" class="difflineminus">--- a/mailnews/mime/src/mimeeobj.cpp</span>
<a href="#l103.2"></a><span id="l103.2" class="difflineplus">+++ b/mailnews/mime/src/mimeeobj.cpp</span>
<a href="#l103.3"></a><span id="l103.3" class="difflineat">@@ -245,30 +245,28 @@ MimeExternalObject_parse_decoded_buffer </span>
<a href="#l103.4"></a><span id="l103.4">    because, unlike most children of MimeLeaf, we do not want to line-</span>
<a href="#l103.5"></a><span id="l103.5">    buffer the decoded data -- we want to simply pass it along to the</span>
<a href="#l103.6"></a><span id="l103.6">    backend, without going through our `parse_line' method.</span>
<a href="#l103.7"></a><span id="l103.7">    */</span>
<a href="#l103.8"></a><span id="l103.8">   if (!obj-&gt;output_p ||</span>
<a href="#l103.9"></a><span id="l103.9">     !obj-&gt;options ||</span>
<a href="#l103.10"></a><span id="l103.10">     obj-&gt;options-&gt;write_html_p)</span>
<a href="#l103.11"></a><span id="l103.11">   {</span>
<a href="#l103.12"></a><span id="l103.12" class="difflineminus">-    NS_ASSERTION(0, &quot;1.1 &lt;rhp@netscape.com&gt; 19 Mar 1999 12:00&quot;);</span>
<a href="#l103.13"></a><span id="l103.13" class="difflineplus">+    NS_ERROR(&quot;MimeObject is missing some data&quot;);</span>
<a href="#l103.14"></a><span id="l103.14">     return -1;</span>
<a href="#l103.15"></a><span id="l103.15">   }</span>
<a href="#l103.16"></a><span id="l103.16"> </span>
<a href="#l103.17"></a><span id="l103.17">   return MimeObject_write(obj, buf, size, PR_TRUE);</span>
<a href="#l103.18"></a><span id="l103.18"> }</span>
<a href="#l103.19"></a><span id="l103.19"> </span>
<a href="#l103.20"></a><span id="l103.20"> </span>
<a href="#l103.21"></a><span id="l103.21"> static int</span>
<a href="#l103.22"></a><span id="l103.22"> MimeExternalObject_parse_line (const char *line, PRInt32 length, MimeObject *obj)</span>
<a href="#l103.23"></a><span id="l103.23"> {</span>
<a href="#l103.24"></a><span id="l103.24" class="difflineminus">-  /* This method should never be called (externals do no line buffering).</span>
<a href="#l103.25"></a><span id="l103.25" class="difflineminus">-   */</span>
<a href="#l103.26"></a><span id="l103.26" class="difflineminus">-  NS_ASSERTION(0, &quot;1.1 &lt;rhp@netscape.com&gt; 19 Mar 1999 12:00&quot;);</span>
<a href="#l103.27"></a><span id="l103.27" class="difflineplus">+  NS_ERROR(&quot;This method should never be called (externals do no line buffering).&quot;);</span>
<a href="#l103.28"></a><span id="l103.28">   return -1;</span>
<a href="#l103.29"></a><span id="l103.29"> }</span>
<a href="#l103.30"></a><span id="l103.30"> </span>
<a href="#l103.31"></a><span id="l103.31"> static PRBool</span>
<a href="#l103.32"></a><span id="l103.32"> MimeExternalObject_displayable_inline_p (MimeObjectClass *clazz,</span>
<a href="#l103.33"></a><span id="l103.33">                      MimeHeaders *hdrs)</span>
<a href="#l103.34"></a><span id="l103.34"> {</span>
<a href="#l103.35"></a><span id="l103.35">   return PR_FALSE;</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l104.1"></a><span id="l104.1" class="difflineminus">--- a/mailnews/mime/src/mimei.cpp</span>
<a href="#l104.2"></a><span id="l104.2" class="difflineplus">+++ b/mailnews/mime/src/mimei.cpp</span>
<a href="#l104.3"></a><span id="l104.3" class="difflineat">@@ -1107,17 +1107,17 @@ mime_part_address(MimeObject *obj)</span>
<a href="#l104.4"></a><span id="l104.4">     for (i = 0; i &lt; cont-&gt;nchildren; i++)</span>
<a href="#l104.5"></a><span id="l104.5">     if (cont-&gt;children[i] == obj)</span>
<a href="#l104.6"></a><span id="l104.6">       {</span>
<a href="#l104.7"></a><span id="l104.7">       j = i+1;</span>
<a href="#l104.8"></a><span id="l104.8">       break;</span>
<a href="#l104.9"></a><span id="l104.9">       }</span>
<a href="#l104.10"></a><span id="l104.10">     if (j == -1)</span>
<a href="#l104.11"></a><span id="l104.11">     {</span>
<a href="#l104.12"></a><span id="l104.12" class="difflineminus">-      NS_ASSERTION(0, &quot;1.1 &lt;rhp@netscape.com&gt; 19 Mar 1999 12:00&quot;);</span>
<a href="#l104.13"></a><span id="l104.13" class="difflineplus">+      NS_ERROR(&quot;No children under MeimContainer&quot;);</span>
<a href="#l104.14"></a><span id="l104.14">       return 0;</span>
<a href="#l104.15"></a><span id="l104.15">     }</span>
<a href="#l104.16"></a><span id="l104.16"> </span>
<a href="#l104.17"></a><span id="l104.17">     PR_snprintf(buf, sizeof(buf), &quot;%ld&quot;, j);</span>
<a href="#l104.18"></a><span id="l104.18">     if (obj-&gt;parent-&gt;parent)</span>
<a href="#l104.19"></a><span id="l104.19">     {</span>
<a href="#l104.20"></a><span id="l104.20">       higher = mime_part_address(obj-&gt;parent);</span>
<a href="#l104.21"></a><span id="l104.21">       if (!higher) return 0;  /* MIME_OUT_OF_MEMORY */</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l105.1"></a><span id="l105.1" class="difflineminus">--- a/mailnews/mime/src/mimeiimg.cpp</span>
<a href="#l105.2"></a><span id="l105.2" class="difflineplus">+++ b/mailnews/mime/src/mimeiimg.cpp</span>
<a href="#l105.3"></a><span id="l105.3" class="difflineat">@@ -267,13 +267,11 @@ MimeInlineImage_parse_decoded_buffer (co</span>
<a href="#l105.4"></a><span id="l105.4"> </span>
<a href="#l105.5"></a><span id="l105.5">   return status;</span>
<a href="#l105.6"></a><span id="l105.6"> }</span>
<a href="#l105.7"></a><span id="l105.7"> </span>
<a href="#l105.8"></a><span id="l105.8"> </span>
<a href="#l105.9"></a><span id="l105.9"> static int</span>
<a href="#l105.10"></a><span id="l105.10"> MimeInlineImage_parse_line (const char *line, PRInt32 length, MimeObject *obj)</span>
<a href="#l105.11"></a><span id="l105.11"> {</span>
<a href="#l105.12"></a><span id="l105.12" class="difflineminus">-  /* This method should never be called (inline images do no line buffering).</span>
<a href="#l105.13"></a><span id="l105.13" class="difflineminus">-   */</span>
<a href="#l105.14"></a><span id="l105.14" class="difflineminus">-  NS_ASSERTION(0, &quot;1.1 &lt;rhp@netscape.com&gt; 19 Mar 1999 12:00&quot;);</span>
<a href="#l105.15"></a><span id="l105.15" class="difflineplus">+  NS_ERROR(&quot;This method should never be called (inline images do no line buffering).&quot;);</span>
<a href="#l105.16"></a><span id="l105.16">   return -1;</span>
<a href="#l105.17"></a><span id="l105.17"> }</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l106.1"></a><span id="l106.1" class="difflineminus">--- a/mailnews/mime/src/mimeleaf.cpp</span>
<a href="#l106.2"></a><span id="l106.2" class="difflineplus">+++ b/mailnews/mime/src/mimeleaf.cpp</span>
<a href="#l106.3"></a><span id="l106.3" class="difflineat">@@ -175,18 +175,17 @@ MimeLeaf_parse_buffer (const char *buffe</span>
<a href="#l106.4"></a><span id="l106.4">   else</span>
<a href="#l106.5"></a><span id="l106.5">   return ((MimeLeafClass *)obj-&gt;clazz)-&gt;parse_decoded_buffer (buffer, size,</span>
<a href="#l106.6"></a><span id="l106.6">                                 obj);</span>
<a href="#l106.7"></a><span id="l106.7"> }</span>
<a href="#l106.8"></a><span id="l106.8"> </span>
<a href="#l106.9"></a><span id="l106.9"> static int</span>
<a href="#l106.10"></a><span id="l106.10"> MimeLeaf_parse_line (const char *line, PRInt32 length, MimeObject *obj)</span>
<a href="#l106.11"></a><span id="l106.11"> {</span>
<a href="#l106.12"></a><span id="l106.12" class="difflineminus">-  NS_ASSERTION(0, &quot;1.1 &lt;rhp@netscape.com&gt; 19 Mar 1999 12:00&quot;);</span>
<a href="#l106.13"></a><span id="l106.13" class="difflineminus">-  /* This method shouldn't ever be called. */</span>
<a href="#l106.14"></a><span id="l106.14" class="difflineplus">+  NS_ERROR(&quot;MimeLeaf_parse_line shouldn't ever be called.&quot;);</span>
<a href="#l106.15"></a><span id="l106.15">   return -1;</span>
<a href="#l106.16"></a><span id="l106.16"> }</span>
<a href="#l106.17"></a><span id="l106.17"> </span>
<a href="#l106.18"></a><span id="l106.18"> </span>
<a href="#l106.19"></a><span id="l106.19"> static int</span>
<a href="#l106.20"></a><span id="l106.20"> MimeLeaf_close_decoder (MimeObject *obj)</span>
<a href="#l106.21"></a><span id="l106.21"> {</span>
<a href="#l106.22"></a><span id="l106.22">   MimeLeaf *leaf = (MimeLeaf *) obj;</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l107.1"></a><span id="l107.1" class="difflineminus">--- a/mailnews/mime/src/mimeobj.cpp</span>
<a href="#l107.2"></a><span id="l107.2" class="difflineplus">+++ b/mailnews/mime/src/mimeobj.cpp</span>
<a href="#l107.3"></a><span id="l107.3" class="difflineat">@@ -273,18 +273,17 @@ MimeObject_parse_buffer (const char *buf</span>
<a href="#l107.4"></a><span id="l107.4">               /* This cast is to turn void into MimeObject */</span>
<a href="#l107.5"></a><span id="l107.5">               obj-&gt;clazz-&gt;parse_line),</span>
<a href="#l107.6"></a><span id="l107.6">              obj);</span>
<a href="#l107.7"></a><span id="l107.7"> }</span>
<a href="#l107.8"></a><span id="l107.8"> </span>
<a href="#l107.9"></a><span id="l107.9"> static int</span>
<a href="#l107.10"></a><span id="l107.10"> MimeObject_parse_line (const char *line, PRInt32 length, MimeObject *obj)</span>
<a href="#l107.11"></a><span id="l107.11"> {</span>
<a href="#l107.12"></a><span id="l107.12" class="difflineminus">-  /* This method should never be called. */</span>
<a href="#l107.13"></a><span id="l107.13" class="difflineminus">-  NS_ASSERTION(0, &quot;shouldn't call this method&quot;);</span>
<a href="#l107.14"></a><span id="l107.14" class="difflineplus">+  NS_ERROR(&quot;shouldn't call this method&quot;);</span>
<a href="#l107.15"></a><span id="l107.15">   return -1;</span>
<a href="#l107.16"></a><span id="l107.16"> }</span>
<a href="#l107.17"></a><span id="l107.17"> </span>
<a href="#l107.18"></a><span id="l107.18"> static int</span>
<a href="#l107.19"></a><span id="l107.19"> MimeObject_parse_eof (MimeObject *obj, PRBool abort_p)</span>
<a href="#l107.20"></a><span id="l107.20"> {</span>
<a href="#l107.21"></a><span id="l107.21">   if (obj-&gt;closed_p) return 0;</span>
<a href="#l107.22"></a><span id="l107.22">   NS_ASSERTION(!obj-&gt;parsed_p, &quot;obj already parsed&quot;);</span>
<a href="#l107.23"></a><span id="l107.23" class="difflineat">@@ -329,17 +328,17 @@ MimeObject_parse_end (MimeObject *obj, P</span>
<a href="#l107.24"></a><span id="l107.24"> </span>
<a href="#l107.25"></a><span id="l107.25">   obj-&gt;parsed_p = PR_TRUE;</span>
<a href="#l107.26"></a><span id="l107.26">   return 0;</span>
<a href="#l107.27"></a><span id="l107.27"> }</span>
<a href="#l107.28"></a><span id="l107.28"> </span>
<a href="#l107.29"></a><span id="l107.29"> static PRBool</span>
<a href="#l107.30"></a><span id="l107.30"> MimeObject_displayable_inline_p (MimeObjectClass *clazz, MimeHeaders *hdrs)</span>
<a href="#l107.31"></a><span id="l107.31"> {</span>
<a href="#l107.32"></a><span id="l107.32" class="difflineminus">-  NS_ASSERTION(0, &quot;shouldn't call this method&quot;);  /* This method should never be called. */</span>
<a href="#l107.33"></a><span id="l107.33" class="difflineplus">+  NS_ERROR(&quot;shouldn't call this method&quot;);</span>
<a href="#l107.34"></a><span id="l107.34">   return PR_FALSE;</span>
<a href="#l107.35"></a><span id="l107.35"> }</span>
<a href="#l107.36"></a><span id="l107.36"> </span>
<a href="#l107.37"></a><span id="l107.37"> #if defined(DEBUG) &amp;&amp; defined(XP_UNIX)</span>
<a href="#l107.38"></a><span id="l107.38"> static int</span>
<a href="#l107.39"></a><span id="l107.39"> MimeObject_debug_print (MimeObject *obj, PRFileDesc *stream, PRInt32 depth)</span>
<a href="#l107.40"></a><span id="l107.40"> {</span>
<a href="#l107.41"></a><span id="l107.41">   int i;</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l108.1"></a><span id="l108.1" class="difflineminus">--- a/mailnews/mime/src/nsStreamConverter.cpp</span>
<a href="#l108.2"></a><span id="l108.2" class="difflineplus">+++ b/mailnews/mime/src/nsStreamConverter.cpp</span>
<a href="#l108.3"></a><span id="l108.3" class="difflineat">@@ -613,17 +613,17 @@ NS_IMETHODIMP nsStreamConverter::Init(ns</span>
<a href="#l108.4"></a><span id="l108.4">       mOutputFormat = &quot;text/html&quot;;</span>
<a href="#l108.5"></a><span id="l108.5">       break;</span>
<a href="#l108.6"></a><span id="l108.6"> </span>
<a href="#l108.7"></a><span id="l108.7">     case nsMimeOutput::nsMimeMessageFilterSniffer: // output all displayable part as raw</span>
<a href="#l108.8"></a><span id="l108.8">       mOutputFormat = &quot;text/html&quot;;</span>
<a href="#l108.9"></a><span id="l108.9">       break;</span>
<a href="#l108.10"></a><span id="l108.10"> </span>
<a href="#l108.11"></a><span id="l108.11">     default:</span>
<a href="#l108.12"></a><span id="l108.12" class="difflineminus">-      NS_ASSERTION(0, &quot;this means I made a mistake in my assumptions&quot;);</span>
<a href="#l108.13"></a><span id="l108.13" class="difflineplus">+      NS_ERROR(&quot;this means I made a mistake in my assumptions&quot;);</span>
<a href="#l108.14"></a><span id="l108.14">   }</span>
<a href="#l108.15"></a><span id="l108.15"> </span>
<a href="#l108.16"></a><span id="l108.16"> </span>
<a href="#l108.17"></a><span id="l108.17">   // the following output channel stream is used to fake the content type for people who later</span>
<a href="#l108.18"></a><span id="l108.18">   // call into us..</span>
<a href="#l108.19"></a><span id="l108.19">   nsCString contentTypeToUse;</span>
<a href="#l108.20"></a><span id="l108.20">   GetContentType(getter_Copies(contentTypeToUse));</span>
<a href="#l108.21"></a><span id="l108.21">   // mscott --&gt; my theory is that we don't need this fake outgoing channel. Let's use the</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l109.1"></a><span id="l109.1" class="difflineminus">--- a/mailnews/news/src/nsNNTPNewsgroupList.cpp</span>
<a href="#l109.2"></a><span id="l109.2" class="difflineplus">+++ b/mailnews/news/src/nsNNTPNewsgroupList.cpp</span>
<a href="#l109.3"></a><span id="l109.3" class="difflineat">@@ -758,17 +758,17 @@ NS_IMETHODIMP nsNNTPNewsgroupList::Apply</span>
<a href="#l109.4"></a><span id="l109.4">         messageArray-&gt;AppendElement(m_newMsgHdr, PR_FALSE);</span>
<a href="#l109.5"></a><span id="l109.5"> </span>
<a href="#l109.6"></a><span id="l109.6">         customAction-&gt;Apply(messageArray, value, nsnull,</span>
<a href="#l109.7"></a><span id="l109.7">                             nsMsgFilterType::NewsRule, aMsgWindow);</span>
<a href="#l109.8"></a><span id="l109.8">       }</span>
<a href="#l109.9"></a><span id="l109.9">       break;</span>
<a href="#l109.10"></a><span id="l109.10"> </span>
<a href="#l109.11"></a><span id="l109.11">       default:</span>
<a href="#l109.12"></a><span id="l109.12" class="difflineminus">-        NS_ASSERTION(0, &quot;unexpected action&quot;);</span>
<a href="#l109.13"></a><span id="l109.13" class="difflineplus">+        NS_ERROR(&quot;unexpected action&quot;);</span>
<a href="#l109.14"></a><span id="l109.14">         break;</span>
<a href="#l109.15"></a><span id="l109.15">       }</span>
<a href="#l109.16"></a><span id="l109.16"> </span>
<a href="#l109.17"></a><span id="l109.17">       if (loggingEnabled)</span>
<a href="#l109.18"></a><span id="l109.18">         (void) aFilter-&gt;LogRuleHit(filterAction, m_newMsgHdr);</span>
<a href="#l109.19"></a><span id="l109.19">     }</span>
<a href="#l109.20"></a><span id="l109.20">   }</span>
<a href="#l109.21"></a><span id="l109.21">   return NS_OK;</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l110.1"></a><span id="l110.1" class="difflineminus">--- a/mailnews/news/src/nsNNTPProtocol.cpp</span>
<a href="#l110.2"></a><span id="l110.2" class="difflineplus">+++ b/mailnews/news/src/nsNNTPProtocol.cpp</span>
<a href="#l110.3"></a><span id="l110.3" class="difflineat">@@ -1971,17 +1971,17 @@ PRInt32 nsNNTPProtocol::SendListSubscrip</span>
<a href="#l110.4"></a><span id="l110.4">     SetFlag(NNTP_PAUSE_FOR_READ);</span>
<a href="#l110.5"></a><span id="l110.5">     return 0;</span>
<a href="#l110.6"></a><span id="l110.6">   }</span>
<a href="#l110.7"></a><span id="l110.7">   if (!line)</span>
<a href="#l110.8"></a><span id="l110.8">     return status;  /* no line yet */</span>
<a href="#l110.9"></a><span id="l110.9"> </span>
<a href="#l110.10"></a><span id="l110.10">   if ('.' != line[0])</span>
<a href="#l110.11"></a><span id="l110.11">   {</span>
<a href="#l110.12"></a><span id="l110.12" class="difflineminus">-        NS_ASSERTION(0,&quot;fix me&quot;);</span>
<a href="#l110.13"></a><span id="l110.13" class="difflineplus">+        NS_ERROR(&quot;fix me&quot;);</span>
<a href="#l110.14"></a><span id="l110.14"> #if 0</span>
<a href="#l110.15"></a><span id="l110.15">     char *url = PR_smprintf (&quot;%s//%s/%s&quot;, NEWS_SCHEME, m_hostName, line);</span>
<a href="#l110.16"></a><span id="l110.16">     if (url)</span>
<a href="#l110.17"></a><span id="l110.17">       MSG_AddSubscribedNewsgroup (cd-&gt;pane, url);</span>
<a href="#l110.18"></a><span id="l110.18"> #endif</span>
<a href="#l110.19"></a><span id="l110.19">   }</span>
<a href="#l110.20"></a><span id="l110.20">   else</span>
<a href="#l110.21"></a><span id="l110.21">   {</span>
<a href="#l110.22"></a><span id="l110.22" class="difflineat">@@ -2853,17 +2853,17 @@ PRInt32 nsNNTPProtocol::AuthorizationRes</span>
<a href="#l110.23"></a><span id="l110.23">   }</span>
<a href="#l110.24"></a><span id="l110.24">   else</span>
<a href="#l110.25"></a><span id="l110.25">   {</span>
<a href="#l110.26"></a><span id="l110.26">     /* login failed */</span>
<a href="#l110.27"></a><span id="l110.27">     HandleAuthenticationFailure();</span>
<a href="#l110.28"></a><span id="l110.28">     return(MK_NNTP_AUTH_FAILED);</span>
<a href="#l110.29"></a><span id="l110.29">   }</span>
<a href="#l110.30"></a><span id="l110.30"> </span>
<a href="#l110.31"></a><span id="l110.31" class="difflineminus">-  NS_ASSERTION(0,&quot;should never get here&quot;);</span>
<a href="#l110.32"></a><span id="l110.32" class="difflineplus">+  NS_ERROR(&quot;should never get here&quot;);</span>
<a href="#l110.33"></a><span id="l110.33">   return(-1);</span>
<a href="#l110.34"></a><span id="l110.34"> </span>
<a href="#l110.35"></a><span id="l110.35"> }</span>
<a href="#l110.36"></a><span id="l110.36"> </span>
<a href="#l110.37"></a><span id="l110.37"> PRInt32 nsNNTPProtocol::PasswordResponse()</span>
<a href="#l110.38"></a><span id="l110.38"> {</span>
<a href="#l110.39"></a><span id="l110.39">   if (MK_NNTP_RESPONSE_AUTHINFO_OK == m_responseCode ||</span>
<a href="#l110.40"></a><span id="l110.40">     MK_NNTP_RESPONSE_AUTHINFO_SIMPLE_OK == m_responseCode)</span>
<a href="#l110.41"></a><span id="l110.41" class="difflineat">@@ -2896,17 +2896,17 @@ PRInt32 nsNNTPProtocol::PasswordResponse</span>
<a href="#l110.42"></a><span id="l110.42">     return(0);</span>
<a href="#l110.43"></a><span id="l110.43">   }</span>
<a href="#l110.44"></a><span id="l110.44">   else</span>
<a href="#l110.45"></a><span id="l110.45">   {</span>
<a href="#l110.46"></a><span id="l110.46">     HandleAuthenticationFailure();</span>
<a href="#l110.47"></a><span id="l110.47">     return(MK_NNTP_AUTH_FAILED);</span>
<a href="#l110.48"></a><span id="l110.48">   }</span>
<a href="#l110.49"></a><span id="l110.49"> </span>
<a href="#l110.50"></a><span id="l110.50" class="difflineminus">-  NS_ASSERTION(0,&quot;should never get here&quot;);</span>
<a href="#l110.51"></a><span id="l110.51" class="difflineplus">+  NS_ERROR(&quot;should never get here&quot;);</span>
<a href="#l110.52"></a><span id="l110.52">   return(-1);</span>
<a href="#l110.53"></a><span id="l110.53"> }</span>
<a href="#l110.54"></a><span id="l110.54"> </span>
<a href="#l110.55"></a><span id="l110.55"> PRInt32 nsNNTPProtocol::DisplayNewsgroups()</span>
<a href="#l110.56"></a><span id="l110.56"> {</span>
<a href="#l110.57"></a><span id="l110.57">   m_nextState = NEWS_DONE;</span>
<a href="#l110.58"></a><span id="l110.58">   ClearFlag(NNTP_PAUSE_FOR_READ);</span>
<a href="#l110.59"></a><span id="l110.59"> </span>
<a href="#l110.60"></a><span id="l110.60" class="difflineat">@@ -4857,17 +4857,17 @@ PRInt32 nsNNTPProtocol::SendListGroupRes</span>
<a href="#l110.61"></a><span id="l110.61">   }</span>
<a href="#l110.62"></a><span id="l110.62">   PR_FREEIF(line);</span>
<a href="#l110.63"></a><span id="l110.63">   return 0;</span>
<a href="#l110.64"></a><span id="l110.64"> }</span>
<a href="#l110.65"></a><span id="l110.65"> </span>
<a href="#l110.66"></a><span id="l110.66"> </span>
<a href="#l110.67"></a><span id="l110.67"> PRInt32 nsNNTPProtocol::Search()</span>
<a href="#l110.68"></a><span id="l110.68"> {</span>
<a href="#l110.69"></a><span id="l110.69" class="difflineminus">-  NS_ASSERTION(0,&quot;Search not implemented&quot;);</span>
<a href="#l110.70"></a><span id="l110.70" class="difflineplus">+  NS_ERROR(&quot;Search not implemented&quot;);</span>
<a href="#l110.71"></a><span id="l110.71">   return 0;</span>
<a href="#l110.72"></a><span id="l110.72"> }</span>
<a href="#l110.73"></a><span id="l110.73"> </span>
<a href="#l110.74"></a><span id="l110.74"> PRInt32 nsNNTPProtocol::SearchResponse()</span>
<a href="#l110.75"></a><span id="l110.75"> {</span>
<a href="#l110.76"></a><span id="l110.76">   if (MK_NNTP_RESPONSE_TYPE(m_responseCode) == MK_NNTP_RESPONSE_TYPE_OK)</span>
<a href="#l110.77"></a><span id="l110.77">     m_nextState = NNTP_SEARCH_RESULTS;</span>
<a href="#l110.78"></a><span id="l110.78">   else</span>
<a href="#l110.79"></a><span id="l110.79" class="difflineat">@@ -4941,17 +4941,17 @@ PRInt32 nsNNTPProtocol::SetupForTransfer</span>
<a href="#l110.80"></a><span id="l110.80">     if (PL_strstr(ce-&gt;URL_s-&gt;address, &quot;PROFILE NEW&quot;))</span>
<a href="#l110.81"></a><span id="l110.81">       m_nextState = NNTP_PROFILE_ADD;</span>
<a href="#l110.82"></a><span id="l110.82">     else</span>
<a href="#l110.83"></a><span id="l110.83">       m_nextState = NNTP_PROFILE_DELETE;</span>
<a href="#l110.84"></a><span id="l110.84">   }</span>
<a href="#l110.85"></a><span id="l110.85"> #endif</span>
<a href="#l110.86"></a><span id="l110.86">   else</span>
<a href="#l110.87"></a><span id="l110.87">   {</span>
<a href="#l110.88"></a><span id="l110.88" class="difflineminus">-    NS_ASSERTION(0, &quot;unexpected&quot;);</span>
<a href="#l110.89"></a><span id="l110.89" class="difflineplus">+    NS_ERROR(&quot;unexpected&quot;);</span>
<a href="#l110.90"></a><span id="l110.90">     return -1;</span>
<a href="#l110.91"></a><span id="l110.91">   }</span>
<a href="#l110.92"></a><span id="l110.92"> </span>
<a href="#l110.93"></a><span id="l110.93">   return(0); /* good */</span>
<a href="#l110.94"></a><span id="l110.94"> }</span>
<a href="#l110.95"></a><span id="l110.95"> </span>
<a href="#l110.96"></a><span id="l110.96"> /////////////////////////////////////////////////////////////////////////////////////////////////////////</span>
<a href="#l110.97"></a><span id="l110.97"> // The following method is used for processing the news state machine.</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l111.1"></a><span id="l111.1" class="difflineminus">--- a/mailnews/news/src/nsNewsFolder.cpp</span>
<a href="#l111.2"></a><span id="l111.2" class="difflineplus">+++ b/mailnews/news/src/nsNewsFolder.cpp</span>
<a href="#l111.3"></a><span id="l111.3" class="difflineat">@@ -241,17 +241,16 @@ nsMsgNewsFolder::AddNewsgroup(const nsAC</span>
<a href="#l111.4"></a><span id="l111.4">   mSubFolders.AppendObject(folder);</span>
<a href="#l111.5"></a><span id="l111.5">   folder-&gt;SetParent(this);</span>
<a href="#l111.6"></a><span id="l111.6">   folder.swap(*child);</span>
<a href="#l111.7"></a><span id="l111.7">   return rv;</span>
<a href="#l111.8"></a><span id="l111.8"> }</span>
<a href="#l111.9"></a><span id="l111.9"> </span>
<a href="#l111.10"></a><span id="l111.10"> nsresult nsMsgNewsFolder::ParseFolder(nsILocalFile *path)</span>
<a href="#l111.11"></a><span id="l111.11"> {</span>
<a href="#l111.12"></a><span id="l111.12" class="difflineminus">-  NS_ASSERTION(0,&quot;ParseFolder not implemented&quot;);</span>
<a href="#l111.13"></a><span id="l111.13">   return NS_ERROR_NOT_IMPLEMENTED;</span>
<a href="#l111.14"></a><span id="l111.14"> }</span>
<a href="#l111.15"></a><span id="l111.15"> </span>
<a href="#l111.16"></a><span id="l111.16"> nsresult</span>
<a href="#l111.17"></a><span id="l111.17"> nsMsgNewsFolder::AddDirectorySeparator(nsILocalFile *path)</span>
<a href="#l111.18"></a><span id="l111.18"> {</span>
<a href="#l111.19"></a><span id="l111.19">   // don't concat the full separator with .sbd</span>
<a href="#l111.20"></a><span id="l111.20">   return (mURI.Equals(kNewsRootURI)) ?</span>
<a href="#l111.21"></a><span id="l111.21" class="difflineat">@@ -565,17 +564,16 @@ NS_IMETHODIMP nsMsgNewsFolder::Delete()</span>
<a href="#l111.22"></a><span id="l111.22">   rv = nntpServer-&gt;RemoveNewsgroup(name);</span>
<a href="#l111.23"></a><span id="l111.23">   NS_ENSURE_SUCCESS(rv,rv);</span>
<a href="#l111.24"></a><span id="l111.24"> </span>
<a href="#l111.25"></a><span id="l111.25">   return SetNewsrcHasChanged(PR_TRUE);</span>
<a href="#l111.26"></a><span id="l111.26"> }</span>
<a href="#l111.27"></a><span id="l111.27"> </span>
<a href="#l111.28"></a><span id="l111.28"> NS_IMETHODIMP nsMsgNewsFolder::Rename(const nsAString&amp; newName, nsIMsgWindow *msgWindow)</span>
<a href="#l111.29"></a><span id="l111.29"> {</span>
<a href="#l111.30"></a><span id="l111.30" class="difflineminus">-  NS_ASSERTION(0,&quot;Rename not implemented&quot;);</span>
<a href="#l111.31"></a><span id="l111.31">   return NS_ERROR_NOT_IMPLEMENTED;</span>
<a href="#l111.32"></a><span id="l111.32"> }</span>
<a href="#l111.33"></a><span id="l111.33"> </span>
<a href="#l111.34"></a><span id="l111.34"> NS_IMETHODIMP nsMsgNewsFolder::GetAbbreviatedName(nsAString&amp; aAbbreviatedName)</span>
<a href="#l111.35"></a><span id="l111.35"> {</span>
<a href="#l111.36"></a><span id="l111.36">   nsresult rv;</span>
<a href="#l111.37"></a><span id="l111.37"> </span>
<a href="#l111.38"></a><span id="l111.38">   rv = nsMsgDBFolder::GetPrettyName(aAbbreviatedName);</span>
<a href="#l111.39"></a><span id="l111.39" class="difflineat">@@ -756,29 +754,26 @@ NS_IMETHODIMP nsMsgNewsFolder::GetExpung</span>
<a href="#l111.40"></a><span id="l111.40"> {</span>
<a href="#l111.41"></a><span id="l111.41">   NS_ENSURE_ARG_POINTER(count);</span>
<a href="#l111.42"></a><span id="l111.42">   *count = mExpungedBytes;</span>
<a href="#l111.43"></a><span id="l111.43">   return NS_OK;</span>
<a href="#l111.44"></a><span id="l111.44"> }</span>
<a href="#l111.45"></a><span id="l111.45"> </span>
<a href="#l111.46"></a><span id="l111.46"> NS_IMETHODIMP nsMsgNewsFolder::GetDeletable(PRBool *deletable)</span>
<a href="#l111.47"></a><span id="l111.47"> {</span>
<a href="#l111.48"></a><span id="l111.48" class="difflineminus">-  //  NS_ASSERTION(0,&quot;GetDeletable() not implemented&quot;);</span>
<a href="#l111.49"></a><span id="l111.49">   return NS_ERROR_NOT_IMPLEMENTED;</span>
<a href="#l111.50"></a><span id="l111.50"> }</span>
<a href="#l111.51"></a><span id="l111.51"> </span>
<a href="#l111.52"></a><span id="l111.52"> NS_IMETHODIMP nsMsgNewsFolder::GetRequiresCleanup(PRBool *requiresCleanup)</span>
<a href="#l111.53"></a><span id="l111.53"> {</span>
<a href="#l111.54"></a><span id="l111.54" class="difflineminus">-  //  NS_ASSERTION(0,&quot;GetRequiresCleanup not implemented&quot;);</span>
<a href="#l111.55"></a><span id="l111.55">   return NS_ERROR_NOT_IMPLEMENTED;</span>
<a href="#l111.56"></a><span id="l111.56"> }</span>
<a href="#l111.57"></a><span id="l111.57"> </span>
<a href="#l111.58"></a><span id="l111.58"> NS_IMETHODIMP nsMsgNewsFolder::GetSizeOnDisk(PRUint32 *size)</span>
<a href="#l111.59"></a><span id="l111.59"> {</span>
<a href="#l111.60"></a><span id="l111.60" class="difflineminus">-  //  NS_ASSERTION(0, &quot;GetSizeOnDisk not implemented&quot;);</span>
<a href="#l111.61"></a><span id="l111.61">   return NS_ERROR_NOT_IMPLEMENTED;</span>
<a href="#l111.62"></a><span id="l111.62"> }</span>
<a href="#l111.63"></a><span id="l111.63"> </span>
<a href="#l111.64"></a><span id="l111.64"> /* this is news, so remember that DeleteMessage is really CANCEL. */</span>
<a href="#l111.65"></a><span id="l111.65"> NS_IMETHODIMP</span>
<a href="#l111.66"></a><span id="l111.66"> nsMsgNewsFolder::DeleteMessages(nsIArray *messages, nsIMsgWindow *aMsgWindow,</span>
<a href="#l111.67"></a><span id="l111.67">                                 PRBool deleteStorage, PRBool isMove,</span>
<a href="#l111.68"></a><span id="l111.68">                                 nsIMsgCopyServiceListener* listener, PRBool allowUndo)</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l112.1"></a><span id="l112.1" class="difflineminus">--- a/mailnews/news/src/nsNntpIncomingServer.cpp</span>
<a href="#l112.2"></a><span id="l112.2" class="difflineplus">+++ b/mailnews/news/src/nsNntpIncomingServer.cpp</span>
<a href="#l112.3"></a><span id="l112.3" class="difflineat">@@ -1496,31 +1496,28 @@ nsNntpIncomingServer::ForgetPassword()</span>
<a href="#l112.4"></a><span id="l112.4">     }</span>
<a href="#l112.5"></a><span id="l112.5"> </span>
<a href="#l112.6"></a><span id="l112.6">     return return_rv;</span>
<a href="#l112.7"></a><span id="l112.7"> }</span>
<a href="#l112.8"></a><span id="l112.8"> </span>
<a href="#l112.9"></a><span id="l112.9"> NS_IMETHODIMP</span>
<a href="#l112.10"></a><span id="l112.10"> nsNntpIncomingServer::GetSupportsExtensions(PRBool *aSupportsExtensions)</span>
<a href="#l112.11"></a><span id="l112.11"> {</span>
<a href="#l112.12"></a><span id="l112.12" class="difflineminus">-  NS_ASSERTION(0,&quot;not implemented&quot;);</span>
<a href="#l112.13"></a><span id="l112.13">   return NS_ERROR_NOT_IMPLEMENTED;</span>
<a href="#l112.14"></a><span id="l112.14"> }</span>
<a href="#l112.15"></a><span id="l112.15"> </span>
<a href="#l112.16"></a><span id="l112.16"> NS_IMETHODIMP</span>
<a href="#l112.17"></a><span id="l112.17"> nsNntpIncomingServer::SetSupportsExtensions(PRBool aSupportsExtensions)</span>
<a href="#l112.18"></a><span id="l112.18"> {</span>
<a href="#l112.19"></a><span id="l112.19" class="difflineminus">-  NS_ASSERTION(0,&quot;not implemented&quot;);</span>
<a href="#l112.20"></a><span id="l112.20">   return NS_ERROR_NOT_IMPLEMENTED;</span>
<a href="#l112.21"></a><span id="l112.21"> }</span>
<a href="#l112.22"></a><span id="l112.22"> </span>
<a href="#l112.23"></a><span id="l112.23"> NS_IMETHODIMP</span>
<a href="#l112.24"></a><span id="l112.24"> nsNntpIncomingServer::AddExtension(const char *extension)</span>
<a href="#l112.25"></a><span id="l112.25"> {</span>
<a href="#l112.26"></a><span id="l112.26" class="difflineminus">-  NS_ASSERTION(0,&quot;not implemented&quot;);</span>
<a href="#l112.27"></a><span id="l112.27">   return NS_ERROR_NOT_IMPLEMENTED;</span>
<a href="#l112.28"></a><span id="l112.28"> }</span>
<a href="#l112.29"></a><span id="l112.29"> </span>
<a href="#l112.30"></a><span id="l112.30"> NS_IMETHODIMP</span>
<a href="#l112.31"></a><span id="l112.31"> nsNntpIncomingServer::QueryExtension(const char *extension, PRBool *result)</span>
<a href="#l112.32"></a><span id="l112.32"> {</span>
<a href="#l112.33"></a><span id="l112.33"> #ifdef DEBUG_seth</span>
<a href="#l112.34"></a><span id="l112.34">   printf(&quot;no extension support yet\n&quot;);</span>
<a href="#l112.35"></a><span id="l112.35" class="difflineat">@@ -1548,59 +1545,52 @@ nsNntpIncomingServer::GetLastUpdatedTime</span>
<a href="#l112.36"></a><span id="l112.36"> {</span>
<a href="#l112.37"></a><span id="l112.37">   *aLastUpdatedTime = mLastUpdatedTime;</span>
<a href="#l112.38"></a><span id="l112.38">   return NS_OK;</span>
<a href="#l112.39"></a><span id="l112.39"> }</span>
<a href="#l112.40"></a><span id="l112.40"> </span>
<a href="#l112.41"></a><span id="l112.41"> NS_IMETHODIMP</span>
<a href="#l112.42"></a><span id="l112.42"> nsNntpIncomingServer::SetLastUpdatedTime(PRUint32 aLastUpdatedTime)</span>
<a href="#l112.43"></a><span id="l112.43"> {</span>
<a href="#l112.44"></a><span id="l112.44" class="difflineminus">-  NS_ASSERTION(0,&quot;not implemented&quot;);</span>
<a href="#l112.45"></a><span id="l112.45">   return NS_ERROR_NOT_IMPLEMENTED;</span>
<a href="#l112.46"></a><span id="l112.46"> }</span>
<a href="#l112.47"></a><span id="l112.47"> </span>
<a href="#l112.48"></a><span id="l112.48"> NS_IMETHODIMP</span>
<a href="#l112.49"></a><span id="l112.49"> nsNntpIncomingServer::AddPropertyForGet(const char *name, const char *value)</span>
<a href="#l112.50"></a><span id="l112.50"> {</span>
<a href="#l112.51"></a><span id="l112.51" class="difflineminus">-  NS_ASSERTION(0,&quot;not implemented&quot;);</span>
<a href="#l112.52"></a><span id="l112.52">   return NS_ERROR_NOT_IMPLEMENTED;</span>
<a href="#l112.53"></a><span id="l112.53"> }</span>
<a href="#l112.54"></a><span id="l112.54"> </span>
<a href="#l112.55"></a><span id="l112.55"> NS_IMETHODIMP</span>
<a href="#l112.56"></a><span id="l112.56"> nsNntpIncomingServer::QueryPropertyForGet(const char *name, char **value)</span>
<a href="#l112.57"></a><span id="l112.57"> {</span>
<a href="#l112.58"></a><span id="l112.58" class="difflineminus">-  NS_ASSERTION(0,&quot;not implemented&quot;);</span>
<a href="#l112.59"></a><span id="l112.59">   return NS_ERROR_NOT_IMPLEMENTED;</span>
<a href="#l112.60"></a><span id="l112.60"> }</span>
<a href="#l112.61"></a><span id="l112.61"> </span>
<a href="#l112.62"></a><span id="l112.62"> NS_IMETHODIMP</span>
<a href="#l112.63"></a><span id="l112.63"> nsNntpIncomingServer::AddSearchableGroup(const nsAString &amp;name)</span>
<a href="#l112.64"></a><span id="l112.64"> {</span>
<a href="#l112.65"></a><span id="l112.65" class="difflineminus">-  NS_ASSERTION(0,&quot;not implemented&quot;);</span>
<a href="#l112.66"></a><span id="l112.66">   return NS_ERROR_NOT_IMPLEMENTED;</span>
<a href="#l112.67"></a><span id="l112.67"> }</span>
<a href="#l112.68"></a><span id="l112.68"> </span>
<a href="#l112.69"></a><span id="l112.69"> NS_IMETHODIMP</span>
<a href="#l112.70"></a><span id="l112.70"> nsNntpIncomingServer::QuerySearchableGroup(const nsAString &amp;name, PRBool *result)</span>
<a href="#l112.71"></a><span id="l112.71"> {</span>
<a href="#l112.72"></a><span id="l112.72" class="difflineminus">-  NS_ASSERTION(0,&quot;not implemented&quot;);</span>
<a href="#l112.73"></a><span id="l112.73">   return NS_ERROR_NOT_IMPLEMENTED;</span>
<a href="#l112.74"></a><span id="l112.74"> }</span>
<a href="#l112.75"></a><span id="l112.75"> </span>
<a href="#l112.76"></a><span id="l112.76"> NS_IMETHODIMP</span>
<a href="#l112.77"></a><span id="l112.77"> nsNntpIncomingServer::AddSearchableHeader(const char *name)</span>
<a href="#l112.78"></a><span id="l112.78"> {</span>
<a href="#l112.79"></a><span id="l112.79" class="difflineminus">-  NS_ASSERTION(0,&quot;not implemented&quot;);</span>
<a href="#l112.80"></a><span id="l112.80">   return NS_ERROR_NOT_IMPLEMENTED;</span>
<a href="#l112.81"></a><span id="l112.81"> }</span>
<a href="#l112.82"></a><span id="l112.82"> </span>
<a href="#l112.83"></a><span id="l112.83"> NS_IMETHODIMP</span>
<a href="#l112.84"></a><span id="l112.84"> nsNntpIncomingServer::QuerySearchableHeader(const char *name, PRBool *result)</span>
<a href="#l112.85"></a><span id="l112.85"> {</span>
<a href="#l112.86"></a><span id="l112.86" class="difflineminus">-  NS_ASSERTION(0,&quot;not implemented&quot;);</span>
<a href="#l112.87"></a><span id="l112.87">   return NS_ERROR_NOT_IMPLEMENTED;</span>
<a href="#l112.88"></a><span id="l112.88"> }</span>
<a href="#l112.89"></a><span id="l112.89"> </span>
<a href="#l112.90"></a><span id="l112.90"> NS_IMETHODIMP</span>
<a href="#l112.91"></a><span id="l112.91"> nsNntpIncomingServer::FindGroup(const nsACString &amp;name, nsIMsgNewsFolder **result)</span>
<a href="#l112.92"></a><span id="l112.92"> {</span>
<a href="#l112.93"></a><span id="l112.93">   NS_ENSURE_ARG_POINTER(result);</span>
<a href="#l112.94"></a><span id="l112.94"> </span>
<a href="#l112.95"></a><span id="l112.95" class="difflineat">@@ -1620,25 +1610,23 @@ nsNntpIncomingServer::FindGroup(const ns</span>
<a href="#l112.96"></a><span id="l112.96">   NS_ENSURE_SUCCESS(rv,rv);</span>
<a href="#l112.97"></a><span id="l112.97">   if (!*result) return NS_ERROR_FAILURE;</span>
<a href="#l112.98"></a><span id="l112.98">   return NS_OK;</span>
<a href="#l112.99"></a><span id="l112.99"> }</span>
<a href="#l112.100"></a><span id="l112.100"> </span>
<a href="#l112.101"></a><span id="l112.101"> NS_IMETHODIMP</span>
<a href="#l112.102"></a><span id="l112.102"> nsNntpIncomingServer::GetFirstGroupNeedingExtraInfo(nsACString &amp;result)</span>
<a href="#l112.103"></a><span id="l112.103"> {</span>
<a href="#l112.104"></a><span id="l112.104" class="difflineminus">-  NS_ASSERTION(0,&quot;not implemented&quot;);</span>
<a href="#l112.105"></a><span id="l112.105">   return NS_ERROR_NOT_IMPLEMENTED;</span>
<a href="#l112.106"></a><span id="l112.106"> }</span>
<a href="#l112.107"></a><span id="l112.107"> </span>
<a href="#l112.108"></a><span id="l112.108"> NS_IMETHODIMP</span>
<a href="#l112.109"></a><span id="l112.109"> nsNntpIncomingServer::SetGroupNeedsExtraInfo(const nsACString &amp;name,</span>
<a href="#l112.110"></a><span id="l112.110">                                              PRBool needsExtraInfo)</span>
<a href="#l112.111"></a><span id="l112.111"> {</span>
<a href="#l112.112"></a><span id="l112.112" class="difflineminus">-  NS_ASSERTION(0,&quot;not implemented&quot;);</span>
<a href="#l112.113"></a><span id="l112.113">   return NS_ERROR_NOT_IMPLEMENTED;</span>
<a href="#l112.114"></a><span id="l112.114"> }</span>
<a href="#l112.115"></a><span id="l112.115"> </span>
<a href="#l112.116"></a><span id="l112.116"> </span>
<a href="#l112.117"></a><span id="l112.117"> NS_IMETHODIMP</span>
<a href="#l112.118"></a><span id="l112.118"> nsNntpIncomingServer::GroupNotFound(nsIMsgWindow *aMsgWindow,</span>
<a href="#l112.119"></a><span id="l112.119">                                     const nsAString &amp;aName, PRBool aOpening)</span>
<a href="#l112.120"></a><span id="l112.120"> {</span>
<a href="#l112.121"></a><span id="l112.121" class="difflineat">@@ -1689,17 +1677,16 @@ nsNntpIncomingServer::GroupNotFound(nsIM</span>
<a href="#l112.122"></a><span id="l112.122"> </span>
<a href="#l112.123"></a><span id="l112.123">   return rv;</span>
<a href="#l112.124"></a><span id="l112.124"> }</span>
<a href="#l112.125"></a><span id="l112.125"> </span>
<a href="#l112.126"></a><span id="l112.126"> NS_IMETHODIMP</span>
<a href="#l112.127"></a><span id="l112.127"> nsNntpIncomingServer::SetPrettyNameForGroup(const nsAString &amp;name,</span>
<a href="#l112.128"></a><span id="l112.128">                                             const nsAString &amp;prettyName)</span>
<a href="#l112.129"></a><span id="l112.129"> {</span>
<a href="#l112.130"></a><span id="l112.130" class="difflineminus">-  NS_ASSERTION(0,&quot;not implemented&quot;);</span>
<a href="#l112.131"></a><span id="l112.131">   return NS_ERROR_NOT_IMPLEMENTED;</span>
<a href="#l112.132"></a><span id="l112.132"> }</span>
<a href="#l112.133"></a><span id="l112.133"> </span>
<a href="#l112.134"></a><span id="l112.134"> NS_IMETHODIMP</span>
<a href="#l112.135"></a><span id="l112.135"> nsNntpIncomingServer::GetCanSearchMessages(PRBool *canSearchMessages)</span>
<a href="#l112.136"></a><span id="l112.136"> {</span>
<a href="#l112.137"></a><span id="l112.137">     NS_ENSURE_ARG_POINTER(canSearchMessages);</span>
<a href="#l112.138"></a><span id="l112.138">     *canSearchMessages = PR_TRUE;</span>
<a href="#l112.139"></a><span id="l112.139" class="difflineat">@@ -2125,17 +2112,19 @@ nsNntpIncomingServer::GetFilterScope(nsM</span>
<a href="#l112.140"></a><span id="l112.140"> }</span>
<a href="#l112.141"></a><span id="l112.141"> </span>
<a href="#l112.142"></a><span id="l112.142"> NS_IMETHODIMP</span>
<a href="#l112.143"></a><span id="l112.143"> nsNntpIncomingServer::GetSearchScope(nsMsgSearchScopeValue *searchScope)</span>
<a href="#l112.144"></a><span id="l112.144"> {</span>
<a href="#l112.145"></a><span id="l112.145">    NS_ENSURE_ARG_POINTER(searchScope);</span>
<a href="#l112.146"></a><span id="l112.146"> </span>
<a href="#l112.147"></a><span id="l112.147">    if (WeAreOffline()) {</span>
<a href="#l112.148"></a><span id="l112.148" class="difflineminus">-     *searchScope = nsMsgSearchScope::localNews;</span>
<a href="#l112.149"></a><span id="l112.149" class="difflineplus">+     // This value is set to the localNewsBody scope to be compatible with</span>
<a href="#l112.150"></a><span id="l112.150" class="difflineplus">+     // the legacy default value.</span>
<a href="#l112.151"></a><span id="l112.151" class="difflineplus">+     *searchScope = nsMsgSearchScope::localNewsBody;</span>
<a href="#l112.152"></a><span id="l112.152">    }</span>
<a href="#l112.153"></a><span id="l112.153">    else {</span>
<a href="#l112.154"></a><span id="l112.154">      *searchScope = nsMsgSearchScope::news;</span>
<a href="#l112.155"></a><span id="l112.155">    }</span>
<a href="#l112.156"></a><span id="l112.156">    return NS_OK;</span>
<a href="#l112.157"></a><span id="l112.157"> }</span>
<a href="#l112.158"></a><span id="l112.158"> </span>
<a href="#l112.159"></a><span id="l112.159"> NS_IMETHODIMP</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l113.1"></a><span id="l113.1" class="difflineminus">--- a/mailnews/news/src/nsNntpService.cpp</span>
<a href="#l113.2"></a><span id="l113.2" class="difflineplus">+++ b/mailnews/news/src/nsNntpService.cpp</span>
<a href="#l113.3"></a><span id="l113.3" class="difflineat">@@ -1297,17 +1297,17 @@ NS_IMETHODIMP nsNntpService::GetNewNews(</span>
<a href="#l113.4"></a><span id="l113.4"> </span>
<a href="#l113.5"></a><span id="l113.5">     rv = RunNewsUrl(aUrl, aMsgWindow, nsnull);</span>
<a href="#l113.6"></a><span id="l113.6"> </span>
<a href="#l113.7"></a><span id="l113.7">     if (_retval)</span>
<a href="#l113.8"></a><span id="l113.8">       NS_IF_ADDREF(*_retval = aUrl);</span>
<a href="#l113.9"></a><span id="l113.9">   }</span>
<a href="#l113.10"></a><span id="l113.10">   else</span>
<a href="#l113.11"></a><span id="l113.11">   {</span>
<a href="#l113.12"></a><span id="l113.12" class="difflineminus">-    NS_ASSERTION(0,&quot;not a news:/ url&quot;);</span>
<a href="#l113.13"></a><span id="l113.13" class="difflineplus">+    NS_ERROR(&quot;not a news:/ url&quot;);</span>
<a href="#l113.14"></a><span id="l113.14">     rv = NS_ERROR_FAILURE;</span>
<a href="#l113.15"></a><span id="l113.15">   }</span>
<a href="#l113.16"></a><span id="l113.16"> </span>
<a href="#l113.17"></a><span id="l113.17"> </span>
<a href="#l113.18"></a><span id="l113.18">   NS_UNLOCK_INSTANCE();</span>
<a href="#l113.19"></a><span id="l113.19">   return rv;</span>
<a href="#l113.20"></a><span id="l113.20"> }</span>
<a href="#l113.21"></a><span id="l113.21"> </span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l114.1"></a><span id="l114.1" class="difflineminus">--- a/suite/common/bookmarks/bookmarks.js</span>
<a href="#l114.2"></a><span id="l114.2" class="difflineplus">+++ b/suite/common/bookmarks/bookmarks.js</span>
<a href="#l114.3"></a><span id="l114.3" class="difflineat">@@ -1232,17 +1232,17 @@ var BookmarksUtils = {</span>
<a href="#l114.4"></a><span id="l114.4">       return isValid;</span>
<a href="#l114.5"></a><span id="l114.5">     }</span>
<a href="#l114.6"></a><span id="l114.6">     return aSelection.isValid;</span>
<a href="#l114.7"></a><span id="l114.7">   },</span>
<a href="#l114.8"></a><span id="l114.8"> </span>
<a href="#l114.9"></a><span id="l114.9">   isSelectionValidForDeletion: function (aSelection)</span>
<a href="#l114.10"></a><span id="l114.10">   {</span>
<a href="#l114.11"></a><span id="l114.11">     var isValid = new Array(aSelection.length);</span>
<a href="#l114.12"></a><span id="l114.12" class="difflineminus">-    for (i=0; i&lt;aSelection.length; ++i) {</span>
<a href="#l114.13"></a><span id="l114.13" class="difflineplus">+    for (var i=0; i&lt;aSelection.length; ++i) {</span>
<a href="#l114.14"></a><span id="l114.14">       if (!aSelection.isValid[i] || aSelection.isImmutable[i] || </span>
<a href="#l114.15"></a><span id="l114.15">           !aSelection.parent [i])</span>
<a href="#l114.16"></a><span id="l114.16">         isValid[i] = false;</span>
<a href="#l114.17"></a><span id="l114.17">       else</span>
<a href="#l114.18"></a><span id="l114.18">         isValid[i] = true;</span>
<a href="#l114.19"></a><span id="l114.19">     }</span>
<a href="#l114.20"></a><span id="l114.20">     return isValid;</span>
<a href="#l114.21"></a><span id="l114.21">   },</span>
<a href="#l114.22"></a><span id="l114.22" class="difflineat">@@ -1374,31 +1374,34 @@ var BookmarksUtils = {</span>
<a href="#l114.23"></a><span id="l114.23">     txmgr.endBatch();</span>
<a href="#l114.24"></a><span id="l114.24">     BookmarksUtils.notifyBookmarksChanged();</span>
<a href="#l114.25"></a><span id="l114.25">     BookmarksUtils.flushDataSource();</span>
<a href="#l114.26"></a><span id="l114.26">     return true;</span>
<a href="#l114.27"></a><span id="l114.27">   },</span>
<a href="#l114.28"></a><span id="l114.28"> </span>
<a href="#l114.29"></a><span id="l114.29">   moveSelection: function (aAction, aSelection, aTarget)</span>
<a href="#l114.30"></a><span id="l114.30">   {</span>
<a href="#l114.31"></a><span id="l114.31" class="difflineplus">+    var canDelete = BookmarksUtils.isSelectionValidForDeletion(aSelection);</span>
<a href="#l114.32"></a><span id="l114.32">     var isValid = BookmarksUtils.isSelectionValidForInsertion(aSelection, aTarget, aAction);</span>
<a href="#l114.33"></a><span id="l114.33">     if (SOUND &amp;&amp; !BookmarksUtils.all(isValid))</span>
<a href="#l114.34"></a><span id="l114.34">       SOUND.beep();</span>
<a href="#l114.35"></a><span id="l114.35">     if (!BookmarksUtils.any(isValid))</span>
<a href="#l114.36"></a><span id="l114.36">       return false;</span>
<a href="#l114.37"></a><span id="l114.37"> </span>
<a href="#l114.38"></a><span id="l114.38">     var txmgr = BMSVC.transactionManager;</span>
<a href="#l114.39"></a><span id="l114.39">     txmgr.beginBatch();</span>
<a href="#l114.40"></a><span id="l114.40">     var index = aTarget.index;</span>
<a href="#l114.41"></a><span id="l114.41">     for (var i = 0; i &lt; aSelection.length; ++i) {</span>
<a href="#l114.42"></a><span id="l114.42" class="difflineminus">-      if (isValid[i]) {</span>
<a href="#l114.43"></a><span id="l114.43" class="difflineplus">+      if (canDelete[i]) {</span>
<a href="#l114.44"></a><span id="l114.44">         RDFC.Init(BMDS, aSelection.parent[i]);</span>
<a href="#l114.45"></a><span id="l114.45">         var deleteIndex = RDFC.IndexOf(aSelection.item[i]);</span>
<a href="#l114.46"></a><span id="l114.46">         var deleteTxn = BMSVC.createTransaction(aSelection.parent[i], aSelection.item[i], deleteIndex, true);</span>
<a href="#l114.47"></a><span id="l114.47">         txmgr.doTransaction(deleteTxn);</span>
<a href="#l114.48"></a><span id="l114.48" class="difflineplus">+      }</span>
<a href="#l114.49"></a><span id="l114.49" class="difflineplus">+      if (isValid[i]) {</span>
<a href="#l114.50"></a><span id="l114.50">         var insertTxn = BMSVC.createTransaction(aTarget.parent, aSelection.item[i], index++, false);</span>
<a href="#l114.51"></a><span id="l114.51">         txmgr.doTransaction(insertTxn);</span>
<a href="#l114.52"></a><span id="l114.52">       }</span>
<a href="#l114.53"></a><span id="l114.53">     }</span>
<a href="#l114.54"></a><span id="l114.54">     txmgr.endBatch();</span>
<a href="#l114.55"></a><span id="l114.55">     BookmarksUtils.flushDataSource();</span>
<a href="#l114.56"></a><span id="l114.56">     return true;</span>
<a href="#l114.57"></a><span id="l114.57">   }, </span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l115.1"></a><span id="l115.1" class="difflineminus">--- a/suite/common/pref/pref-applications.js</span>
<a href="#l115.2"></a><span id="l115.2" class="difflineplus">+++ b/suite/common/pref/pref-applications.js</span>
<a href="#l115.3"></a><span id="l115.3" class="difflineat">@@ -1765,21 +1765,23 @@ var gApplicationsPane = {</span>
<a href="#l115.4"></a><span id="l115.4">     // value, then fall back to the generic application icon.</span>
<a href="#l115.5"></a><span id="l115.5">     return null;</span>
<a href="#l115.6"></a><span id="l115.6">   },</span>
<a href="#l115.7"></a><span id="l115.7"> </span>
<a href="#l115.8"></a><span id="l115.8">   _getIconURLForHandlerApp: function(aHandlerApp) {</span>
<a href="#l115.9"></a><span id="l115.9">     if (aHandlerApp instanceof nsILocalHandlerApp)</span>
<a href="#l115.10"></a><span id="l115.10">       return this._getIconURLForFile(aHandlerApp.executable);</span>
<a href="#l115.11"></a><span id="l115.11"> </span>
<a href="#l115.12"></a><span id="l115.12" class="difflineminus">-    if (aHandlerApp instanceof nsIWebHandlerApp)</span>
<a href="#l115.13"></a><span id="l115.13" class="difflineminus">-      return this._getIconURLForWebApp(aHandlerApp.uriTemplate);</span>
<a href="#l115.14"></a><span id="l115.14" class="difflineplus">+    if (prefSvc.getBoolPref(&quot;browser.chrome.favicons&quot;)) { // q.v. Bug 514671</span>
<a href="#l115.15"></a><span id="l115.15" class="difflineplus">+      if (aHandlerApp instanceof nsIWebHandlerApp)</span>
<a href="#l115.16"></a><span id="l115.16" class="difflineplus">+        return this._getIconURLForWebApp(aHandlerApp.uriTemplate);</span>
<a href="#l115.17"></a><span id="l115.17"> </span>
<a href="#l115.18"></a><span id="l115.18" class="difflineminus">-    if (aHandlerApp instanceof nsIWebContentHandlerInfo)</span>
<a href="#l115.19"></a><span id="l115.19" class="difflineminus">-      return this._getIconURLForWebApp(aHandlerApp.uri)</span>
<a href="#l115.20"></a><span id="l115.20" class="difflineplus">+      if (aHandlerApp instanceof nsIWebContentHandlerInfo)</span>
<a href="#l115.21"></a><span id="l115.21" class="difflineplus">+        return this._getIconURLForWebApp(aHandlerApp.uri)</span>
<a href="#l115.22"></a><span id="l115.22" class="difflineplus">+    }</span>
<a href="#l115.23"></a><span id="l115.23"> </span>
<a href="#l115.24"></a><span id="l115.24">     // We know nothing about other kinds of handler apps.</span>
<a href="#l115.25"></a><span id="l115.25">     return &quot;&quot;;</span>
<a href="#l115.26"></a><span id="l115.26">   },</span>
<a href="#l115.27"></a><span id="l115.27"> </span>
<a href="#l115.28"></a><span id="l115.28">   _getIconURLForFile: function(aFile) {</span>
<a href="#l115.29"></a><span id="l115.29">     var fph = ioSvc.getProtocolHandler(&quot;file&quot;)</span>
<a href="#l115.30"></a><span id="l115.30">                    .QueryInterface(Components.interfaces.nsIFileProtocolHandler);</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l116.1"></a><span id="l116.1" class="difflineminus">--- a/suite/common/pref/pref-scripts.js</span>
<a href="#l116.2"></a><span id="l116.2" class="difflineplus">+++ b/suite/common/pref/pref-scripts.js</span>
<a href="#l116.3"></a><span id="l116.3" class="difflineat">@@ -17,17 +17,17 @@</span>
<a href="#l116.4"></a><span id="l116.4">  * The Original Code is Mozilla.org Code.</span>
<a href="#l116.5"></a><span id="l116.5">  *</span>
<a href="#l116.6"></a><span id="l116.6">  * The Initial Developer of the Original Code is</span>
<a href="#l116.7"></a><span id="l116.7">  * Doron Rosenberg.</span>
<a href="#l116.8"></a><span id="l116.8">  * Portions created by the Initial Developer are Copyright (C) 2001</span>
<a href="#l116.9"></a><span id="l116.9">  * the Initial Developer. All Rights Reserved.</span>
<a href="#l116.10"></a><span id="l116.10">  *</span>
<a href="#l116.11"></a><span id="l116.11">  * Contributor(s):</span>
<a href="#l116.12"></a><span id="l116.12" class="difflineminus">- *   Jonas Jrgensen &lt;jonasj@jonasj.dk&gt;</span>
<a href="#l116.13"></a><span id="l116.13" class="difflineplus">+ *   Jonas Jrgensen &lt;jonasj@jonasj.dk&gt;</span>
<a href="#l116.14"></a><span id="l116.14">  *</span>
<a href="#l116.15"></a><span id="l116.15">  * Alternatively, the contents of this file may be used under the terms of</span>
<a href="#l116.16"></a><span id="l116.16">  * either of the GNU General Public License Version 2 or later (the &quot;GPL&quot;),</span>
<a href="#l116.17"></a><span id="l116.17">  * or the GNU Lesser General Public License Version 2.1 or later (the &quot;LGPL&quot;),</span>
<a href="#l116.18"></a><span id="l116.18">  * in which case the provisions of the GPL or the LGPL are applicable instead</span>
<a href="#l116.19"></a><span id="l116.19">  * of those above. If you wish to allow use of your version of this file only</span>
<a href="#l116.20"></a><span id="l116.20">  * under the terms of either the GPL or the LGPL, and not to allow others to</span>
<a href="#l116.21"></a><span id="l116.21">  * use your version of this file under the terms of the MPL, indicate your</span>
<a href="#l116.22"></a><span id="l116.22" class="difflineat">@@ -51,23 +51,15 @@ function changeDisabledState(state) {</span>
<a href="#l116.23"></a><span id="l116.23">   setDisableState(&quot;allowImageSrcChange&quot;, state);</span>
<a href="#l116.24"></a><span id="l116.24">   setDisableState(&quot;allowWindowStatusChange&quot;, state);</span>
<a href="#l116.25"></a><span id="l116.25">   setDisableState(&quot;allowWindowFlip&quot;, state);</span>
<a href="#l116.26"></a><span id="l116.26">   setDisableState(&quot;allowHideStatusBar&quot;, state);</span>
<a href="#l116.27"></a><span id="l116.27">   setDisableState(&quot;allowContextmenuDisable&quot;, state);</span>
<a href="#l116.28"></a><span id="l116.28"> }</span>
<a href="#l116.29"></a><span id="l116.29"> </span>
<a href="#l116.30"></a><span id="l116.30"> function javascriptEnabledChange() {</span>
<a href="#l116.31"></a><span id="l116.31" class="difflineminus">-  // If javascript.allow.mailnews is overlayed (mailnews is installed),</span>
<a href="#l116.32"></a><span id="l116.32" class="difflineminus">-  // then if javascript.allow.mailnews and javascript.enabled are false,</span>
<a href="#l116.33"></a><span id="l116.33" class="difflineminus">-  // we disable the tree items. If javascript.allow.mailnews is not</span>
<a href="#l116.34"></a><span id="l116.34" class="difflineminus">-  // available, we only take javascript.enabled in consideration.</span>
<a href="#l116.35"></a><span id="l116.35" class="difflineminus">-</span>
<a href="#l116.36"></a><span id="l116.36">   var javascriptDisabled = !document.getElementById('javascript.enabled').value;</span>
<a href="#l116.37"></a><span id="l116.37" class="difflineminus">-  var javascriptAllowMailNews = document.getElementById('javascript.allow.mailnews');</span>
<a href="#l116.38"></a><span id="l116.38" class="difflineminus">-  if (javascriptDisabled &amp;&amp; javascriptAllowMailNews)</span>
<a href="#l116.39"></a><span id="l116.39" class="difflineminus">-    javascriptDisabled = !javascriptAllowMailNews.value;</span>
<a href="#l116.40"></a><span id="l116.40">   changeDisabledState(javascriptDisabled);</span>
<a href="#l116.41"></a><span id="l116.41"> }</span>
<a href="#l116.42"></a><span id="l116.42"> </span>
<a href="#l116.43"></a><span id="l116.43"> function Startup() {</span>
<a href="#l116.44"></a><span id="l116.44">   javascriptEnabledChange();</span>
<a href="#l116.45"></a><span id="l116.45"> }</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l117.1"></a><span id="l117.1" class="difflineminus">--- a/suite/common/src/nsSuiteGlue.js</span>
<a href="#l117.2"></a><span id="l117.2" class="difflineplus">+++ b/suite/common/src/nsSuiteGlue.js</span>
<a href="#l117.3"></a><span id="l117.3" class="difflineat">@@ -191,17 +191,17 @@ SuiteGlue.prototype = {</span>
<a href="#l117.4"></a><span id="l117.4">       else</span>
<a href="#l117.5"></a><span id="l117.5">         showPrompt = prefBranch.getBoolPref(&quot;browser.tabs.warnOnClose&quot;);</span>
<a href="#l117.6"></a><span id="l117.6">     } catch (ex) {}</span>
<a href="#l117.7"></a><span id="l117.7"> </span>
<a href="#l117.8"></a><span id="l117.8">     var buttonChoice = 0;</span>
<a href="#l117.9"></a><span id="l117.9">     if (showPrompt) {</span>
<a href="#l117.10"></a><span id="l117.10">       var bundleService = Components.classes[&quot;@mozilla.org/intl/stringbundle;1&quot;].</span>
<a href="#l117.11"></a><span id="l117.11">                           getService(Components.interfaces.nsIStringBundleService);</span>
<a href="#l117.12"></a><span id="l117.12" class="difflineminus">-      var quitBundle = bundleService.createBundle(&quot;chrome://browser/locale/quitDialog.properties&quot;);</span>
<a href="#l117.13"></a><span id="l117.13" class="difflineplus">+      var quitBundle = bundleService.createBundle(&quot;chrome://communicator/locale/quitDialog.properties&quot;);</span>
<a href="#l117.14"></a><span id="l117.14">       var brandBundle = bundleService.createBundle(&quot;chrome://branding/locale/brand.properties&quot;);</span>
<a href="#l117.15"></a><span id="l117.15"> </span>
<a href="#l117.16"></a><span id="l117.16">       var appName = brandBundle.GetStringFromName(&quot;brandShortName&quot;);</span>
<a href="#l117.17"></a><span id="l117.17">       var quitDialogTitle = quitBundle.formatStringFromName(aQuitType + &quot;DialogTitle&quot;,</span>
<a href="#l117.18"></a><span id="l117.18">                                                               [appName], 1);</span>
<a href="#l117.19"></a><span id="l117.19"> </span>
<a href="#l117.20"></a><span id="l117.20">       var message;</span>
<a href="#l117.21"></a><span id="l117.21">       if (aQuitType == &quot;restart&quot;)</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l118.1"></a><span id="l118.1">new file mode 100644</span>
<a href="#l118.2"></a><span id="l118.2" class="difflineminus">--- /dev/null</span>
<a href="#l118.3"></a><span id="l118.3" class="difflineplus">+++ b/suite/locales/en-US/chrome/common/quitDialog.properties</span>
<a href="#l118.4"></a><span id="l118.4" class="difflineat">@@ -0,0 +1,11 @@</span>
<a href="#l118.5"></a><span id="l118.5" class="difflineplus">+quitDialogTitle=Quit %S</span>
<a href="#l118.6"></a><span id="l118.6" class="difflineplus">+restartDialogTitle=Restart %S</span>
<a href="#l118.7"></a><span id="l118.7" class="difflineplus">+</span>
<a href="#l118.8"></a><span id="l118.8" class="difflineplus">+quitTitle=&amp;Quit</span>
<a href="#l118.9"></a><span id="l118.9" class="difflineplus">+restartTitle=&amp;Restart</span>
<a href="#l118.10"></a><span id="l118.10" class="difflineplus">+cancelTitle=&amp;Cancel</span>
<a href="#l118.11"></a><span id="l118.11" class="difflineplus">+saveTitle=&amp;Save and Quit</span>
<a href="#l118.12"></a><span id="l118.12" class="difflineplus">+neverAsk=Do not ask next time</span>
<a href="#l118.13"></a><span id="l118.13" class="difflineplus">+message=Do you want %S to save your tabs and windows for the next time it starts?</span>
<a href="#l118.14"></a><span id="l118.14" class="difflineplus">+messageNoWindows=Do you want %S to save your tabs for the next time it starts?</span>
<a href="#l118.15"></a><span id="l118.15" class="difflineplus">+messageRestart=%S will try to restore your tabs and windows when it restarts.</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l119.1"></a><span id="l119.1" class="difflineminus">--- a/suite/locales/en-US/chrome/mailnews/pref/am-identity-edit.dtd</span>
<a href="#l119.2"></a><span id="l119.2" class="difflineplus">+++ b/suite/locales/en-US/chrome/mailnews/pref/am-identity-edit.dtd</span>
<a href="#l119.3"></a><span id="l119.3" class="difflineat">@@ -1,6 +1,7 @@</span>
<a href="#l119.4"></a><span id="l119.4" class="difflineplus">+&lt;!ENTITY identityDialog.style &quot;width: 67ch;&quot;&gt;</span>
<a href="#l119.5"></a><span id="l119.5"> &lt;!ENTITY identityTitle.label &quot;Identity Settings&quot;&gt;</span>
<a href="#l119.6"></a><span id="l119.6"> &lt;!ENTITY identityListDesc.label &quot;Configure the settings for this identity:&quot;&gt;</span>
<a href="#l119.7"></a><span id="l119.7"> </span>
<a href="#l119.8"></a><span id="l119.8"> &lt;!ENTITY settingsTab.label       &quot;Settings&quot;&gt;</span>
<a href="#l119.9"></a><span id="l119.9"> &lt;!ENTITY copiesFoldersTab.label &quot;Copies &amp;amp; Folders&quot;&gt;</span>
<a href="#l119.10"></a><span id="l119.10"> &lt;!ENTITY addressingTab.label    &quot;Composition &amp;amp; Addressing&quot;&gt;</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l120.1"></a><span id="l120.1" class="difflineminus">--- a/suite/locales/en-US/chrome/mailnews/pref/mailPrefsOverlay.dtd</span>
<a href="#l120.2"></a><span id="l120.2" class="difflineplus">+++ b/suite/locales/en-US/chrome/mailnews/pref/mailPrefsOverlay.dtd</span>
<a href="#l120.3"></a><span id="l120.3" class="difflineat">@@ -1,11 +1,9 @@</span>
<a href="#l120.4"></a><span id="l120.4"> &lt;!-- These are added to the Advanced - Scripts &amp; Plugins panel --&gt;</span>
<a href="#l120.5"></a><span id="l120.5" class="difflineminus">-&lt;!ENTITY enbJsCheckMailNews.label         &quot;Mail &amp;amp; Newsgroups&quot;&gt;</span>
<a href="#l120.6"></a><span id="l120.6" class="difflineminus">-&lt;!ENTITY enbJsCheckMailNews.accesskey     &quot;M&quot;&gt;</span>
<a href="#l120.7"></a><span id="l120.7"> &lt;!ENTITY enbPluginCheckMailNews.label     &quot;Mail &amp;amp; Newsgroups&quot;&gt;</span>
<a href="#l120.8"></a><span id="l120.8"> &lt;!ENTITY enbPluginCheckMailNews.accesskey &quot;a&quot;&gt;</span>
<a href="#l120.9"></a><span id="l120.9"> </span>
<a href="#l120.10"></a><span id="l120.10"> &lt;!-- These are added to the Window menu --&gt;</span>
<a href="#l120.11"></a><span id="l120.11"> &lt;!ENTITY mail.label                       &quot;Mail &amp;amp; Newsgroups&quot;&gt;</span>
<a href="#l120.12"></a><span id="l120.12"> &lt;!ENTITY mail.accesskey                   &quot;M&quot;&gt;</span>
<a href="#l120.13"></a><span id="l120.13"> &lt;!ENTITY addressbook.label                &quot;Address Book&quot;&gt;</span>
<a href="#l120.14"></a><span id="l120.14"> &lt;!ENTITY addressbook.accesskey            &quot;A&quot;&gt;</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l121.1"></a><span id="l121.1" class="difflineminus">--- a/suite/locales/jar.mn</span>
<a href="#l121.2"></a><span id="l121.2" class="difflineplus">+++ b/suite/locales/jar.mn</span>
<a href="#l121.3"></a><span id="l121.3" class="difflineat">@@ -26,16 +26,17 @@</span>
<a href="#l121.4"></a><span id="l121.4">   locale/@AB_CD@/communicator/defaultClientDialog.dtd                       (%chrome/common/defaultClientDialog.dtd)</span>
<a href="#l121.5"></a><span id="l121.5">   locale/@AB_CD@/communicator/feeds/subscribe.dtd                           (%chrome/common/feeds/subscribe.dtd)</span>
<a href="#l121.6"></a><span id="l121.6">   locale/@AB_CD@/communicator/feeds/subscribe.properties                    (%chrome/common/feeds/subscribe.properties)</span>
<a href="#l121.7"></a><span id="l121.7">   locale/@AB_CD@/communicator/notification.properties                       (%chrome/common/notification.properties)</span>
<a href="#l121.8"></a><span id="l121.8">   locale/@AB_CD@/communicator/openLocation.dtd                              (%chrome/common/openLocation.dtd)</span>
<a href="#l121.9"></a><span id="l121.9">   locale/@AB_CD@/communicator/openLocation.properties                       (%chrome/common/openLocation.properties)</span>
<a href="#l121.10"></a><span id="l121.10">   locale/@AB_CD@/communicator/passwordManager.dtd                           (%chrome/common/passwordManager.dtd)</span>
<a href="#l121.11"></a><span id="l121.11">   locale/@AB_CD@/communicator/printPreview.dtd                              (%chrome/common/printPreview.dtd)</span>
<a href="#l121.12"></a><span id="l121.12" class="difflineplus">+  locale/@AB_CD@/communicator/quitDialog.properties                         (%chrome/common/quitDialog.properties)</span>
<a href="#l121.13"></a><span id="l121.13">   locale/@AB_CD@/communicator/shellservice.properties                       (%chrome/common/shellservice.properties)</span>
<a href="#l121.14"></a><span id="l121.14">   locale/@AB_CD@/communicator/sanitize.dtd                                  (%chrome/common/sanitize.dtd)</span>
<a href="#l121.15"></a><span id="l121.15">   locale/@AB_CD@/communicator/tasksOverlay.dtd                              (%chrome/common/tasksOverlay.dtd)</span>
<a href="#l121.16"></a><span id="l121.16">   locale/@AB_CD@/communicator/typeaheadfind.properties                      (%chrome/common/typeaheadfind.properties)</span>
<a href="#l121.17"></a><span id="l121.17">   locale/@AB_CD@/communicator/utilityOverlay.dtd                            (%chrome/common/utilityOverlay.dtd)</span>
<a href="#l121.18"></a><span id="l121.18">   locale/@AB_CD@/communicator/utilityOverlay.properties                     (%chrome/common/utilityOverlay.properties)</span>
<a href="#l121.19"></a><span id="l121.19">   locale/@AB_CD@/communicator/viewZoomOverlay.dtd                           (%chrome/common/viewZoomOverlay.dtd)</span>
<a href="#l121.20"></a><span id="l121.20">   locale/@AB_CD@/communicator/viewZoomOverlay.properties                    (%chrome/common/viewZoomOverlay.properties)</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l122.1"></a><span id="l122.1" class="difflineminus">--- a/suite/mailnews/addrbook/abCardOverlay.js</span>
<a href="#l122.2"></a><span id="l122.2" class="difflineplus">+++ b/suite/mailnews/addrbook/abCardOverlay.js</span>
<a href="#l122.3"></a><span id="l122.3" class="difflineat">@@ -88,17 +88,17 @@ const kVcardFields =</span>
<a href="#l122.4"></a><span id="l122.4">           // Other &gt; Notes</span>
<a href="#l122.5"></a><span id="l122.5">          [&quot;Notes&quot;, &quot;Notes&quot;]];</span>
<a href="#l122.6"></a><span id="l122.6"> </span>
<a href="#l122.7"></a><span id="l122.7"> const kDefaultYear = 2000;</span>
<a href="#l122.8"></a><span id="l122.8"> var gEditCard;</span>
<a href="#l122.9"></a><span id="l122.9"> var gOnSaveListeners = new Array();</span>
<a href="#l122.10"></a><span id="l122.10"> var gOkCallback = null;</span>
<a href="#l122.11"></a><span id="l122.11"> var gHideABPicker = false;</span>
<a href="#l122.12"></a><span id="l122.12" class="difflineminus">-var originalPhotoURI = &quot;&quot;;</span>
<a href="#l122.13"></a><span id="l122.13" class="difflineplus">+var gOriginalPhotoURI = &quot;&quot;;</span>
<a href="#l122.14"></a><span id="l122.14"> </span>
<a href="#l122.15"></a><span id="l122.15"> function OnLoadNewCard()</span>
<a href="#l122.16"></a><span id="l122.16"> {</span>
<a href="#l122.17"></a><span id="l122.17">   InitEditCard();</span>
<a href="#l122.18"></a><span id="l122.18"> </span>
<a href="#l122.19"></a><span id="l122.19">   gEditCard.card =</span>
<a href="#l122.20"></a><span id="l122.20">     ((&quot;arguments&quot; in window) &amp;&amp; (window.arguments.length &gt; 0) &amp;&amp;</span>
<a href="#l122.21"></a><span id="l122.21">      (window.arguments[0] instanceof Components.interfaces.nsIAbCard))</span>
<a href="#l122.22"></a><span id="l122.22" class="difflineat">@@ -274,34 +274,33 @@ function OnLoadEditCard()</span>
<a href="#l122.23"></a><span id="l122.23">   if (&quot;arguments&quot; in window &amp;&amp; window.arguments[0])</span>
<a href="#l122.24"></a><span id="l122.24">   {</span>
<a href="#l122.25"></a><span id="l122.25">     if (&quot;abURI&quot; in window.arguments[0]) {</span>
<a href="#l122.26"></a><span id="l122.26">       var abURI = window.arguments[0].abURI;</span>
<a href="#l122.27"></a><span id="l122.27">       var directory = GetDirectoryFromURI(abURI);</span>
<a href="#l122.28"></a><span id="l122.28"> </span>
<a href="#l122.29"></a><span id="l122.29">       if (directory.readOnly) </span>
<a href="#l122.30"></a><span id="l122.30">       {</span>
<a href="#l122.31"></a><span id="l122.31" class="difflineminus">-        // Disable the photo field and buttons</span>
<a href="#l122.32"></a><span id="l122.32" class="difflineminus">-        document.getElementById(&quot;generic&quot;).disabled          = true;</span>
<a href="#l122.33"></a><span id="l122.33" class="difflineminus">-        document.getElementById(&quot;GenericPhotoList&quot;).disabled = true;</span>
<a href="#l122.34"></a><span id="l122.34" class="difflineminus">-        document.getElementById(&quot;file&quot;).disabled             = true;</span>
<a href="#l122.35"></a><span id="l122.35" class="difflineminus">-        document.getElementById(&quot;web&quot;).disabled              = true;</span>
<a href="#l122.36"></a><span id="l122.36" class="difflineminus">-        document.getElementById(&quot;PhotoURI&quot;).readOnly         = true;</span>
<a href="#l122.37"></a><span id="l122.37" class="difflineminus">-        document.getElementById(&quot;PhotoURI&quot;).emptyText        = &quot;&quot;;</span>
<a href="#l122.38"></a><span id="l122.38" class="difflineminus">-        document.getElementById(&quot;BrowsePhoto&quot;).disabled      = true;</span>
<a href="#l122.39"></a><span id="l122.39" class="difflineminus">-        document.getElementById(&quot;UpdatePhoto&quot;).disabled      = true;</span>
<a href="#l122.40"></a><span id="l122.40">         // Set all the editable vcard fields to read only</span>
<a href="#l122.41"></a><span id="l122.41">         for (var i = kVcardFields.length; i-- &gt; 0; )</span>
<a href="#l122.42"></a><span id="l122.42">           document.getElementById(kVcardFields[i][0]).readOnly = true;</span>
<a href="#l122.43"></a><span id="l122.43"> </span>
<a href="#l122.44"></a><span id="l122.44">         // the birthday fields</span>
<a href="#l122.45"></a><span id="l122.45">         document.getElementById(&quot;Birthday&quot;).readOnly = true;</span>
<a href="#l122.46"></a><span id="l122.46">         document.getElementById(&quot;BirthYear&quot;).readOnly = true;</span>
<a href="#l122.47"></a><span id="l122.47">         document.getElementById(&quot;Age&quot;).readOnly = true;</span>
<a href="#l122.48"></a><span id="l122.48"> </span>
<a href="#l122.49"></a><span id="l122.49" class="difflineplus">+        // the photo field and buttons</span>
<a href="#l122.50"></a><span id="l122.50" class="difflineplus">+        document.getElementById(&quot;PhotoType&quot;).disabled        = true;</span>
<a href="#l122.51"></a><span id="l122.51" class="difflineplus">+        document.getElementById(&quot;GenericPhotoList&quot;).disabled = true;</span>
<a href="#l122.52"></a><span id="l122.52" class="difflineplus">+        document.getElementById(&quot;PhotoURI&quot;).disabled         = true;</span>
<a href="#l122.53"></a><span id="l122.53" class="difflineplus">+        document.getElementById(&quot;PhotoURI&quot;).emptyText        = &quot;&quot;;</span>
<a href="#l122.54"></a><span id="l122.54" class="difflineplus">+        document.getElementById(&quot;BrowsePhoto&quot;).disabled      = true;</span>
<a href="#l122.55"></a><span id="l122.55" class="difflineplus">+        document.getElementById(&quot;UpdatePhoto&quot;).disabled      = true;</span>
<a href="#l122.56"></a><span id="l122.56" class="difflineplus">+</span>
<a href="#l122.57"></a><span id="l122.57">         // And the phonetic fields</span>
<a href="#l122.58"></a><span id="l122.58">         document.getElementById(kPhoneticFields[0]).readOnly = true;</span>
<a href="#l122.59"></a><span id="l122.59">         document.getElementById(kPhoneticFields[3]).readOnly = true;</span>
<a href="#l122.60"></a><span id="l122.60"> </span>
<a href="#l122.61"></a><span id="l122.61">         // Also disable the mail format popup and allow remote content items.</span>
<a href="#l122.62"></a><span id="l122.62">         document.getElementById(&quot;PreferMailFormatPopup&quot;).disabled = true;</span>
<a href="#l122.63"></a><span id="l122.63">         document.getElementById(&quot;allowRemoteContent&quot;).disabled = true;</span>
<a href="#l122.64"></a><span id="l122.64"> </span>
<a href="#l122.65"></a><span id="l122.65" class="difflineat">@@ -479,44 +478,42 @@ function GetCardValues(cardproperty, doc</span>
<a href="#l122.66"></a><span id="l122.66">     doc.getElementById(&quot;PhoneticFirstName&quot;).value = cardproperty.getProperty(&quot;PhoneticFirstName&quot;, &quot;&quot;);</span>
<a href="#l122.67"></a><span id="l122.67">     doc.getElementById(&quot;PhoneticLastName&quot;).value = cardproperty.getProperty(&quot;PhoneticLastName&quot;, &quot;&quot;);</span>
<a href="#l122.68"></a><span id="l122.68">   }</span>
<a href="#l122.69"></a><span id="l122.69">   catch (ex) {}</span>
<a href="#l122.70"></a><span id="l122.70"> </span>
<a href="#l122.71"></a><span id="l122.71">   // Store the original photo URI and update the photo</span>
<a href="#l122.72"></a><span id="l122.72">   // Select the type if there is a valid value stored for that type, otherwise</span>
<a href="#l122.73"></a><span id="l122.73">   // select the generic photo</span>
<a href="#l122.74"></a><span id="l122.74" class="difflineminus">-  var type = cardproperty.getProperty(&quot;PhotoType&quot;, &quot;&quot;);</span>
<a href="#l122.75"></a><span id="l122.75" class="difflineminus">-  document.getElementById(&quot;PhotoType&quot;).selectedItem =</span>
<a href="#l122.76"></a><span id="l122.76" class="difflineminus">-    document.getElementById(type ? type : &quot;generic&quot;);</span>
<a href="#l122.77"></a><span id="l122.77" class="difflineminus">-  if (type == &quot;file&quot;) {</span>
<a href="#l122.78"></a><span id="l122.78" class="difflineminus">-    originalPhotoURI = getPhotoURI(cardproperty.getProperty(&quot;PhotoName&quot;, &quot;&quot;));</span>
<a href="#l122.79"></a><span id="l122.79" class="difflineminus">-    var file = Components.classes[&quot;@mozilla.org/network/io-service;1&quot;]</span>
<a href="#l122.80"></a><span id="l122.80" class="difflineminus">-                         .getService(Components.interfaces.nsIIOService)</span>
<a href="#l122.81"></a><span id="l122.81" class="difflineminus">-                         .newURI(originalPhotoURI, null, null)</span>
<a href="#l122.82"></a><span id="l122.82" class="difflineminus">-                         .QueryInterface(Components.interfaces.nsIFileURL)</span>
<a href="#l122.83"></a><span id="l122.83" class="difflineminus">-                         .file;</span>
<a href="#l122.84"></a><span id="l122.84" class="difflineminus">-    if (file) {</span>
<a href="#l122.85"></a><span id="l122.85" class="difflineminus">-      document.getElementById(&quot;PhotoFile&quot;).file = file;</span>
<a href="#l122.86"></a><span id="l122.86" class="difflineminus">-      updatePhoto(&quot;file&quot;);</span>
<a href="#l122.87"></a><span id="l122.87" class="difflineminus">-    }</span>
<a href="#l122.88"></a><span id="l122.88" class="difflineminus">-    else</span>
<a href="#l122.89"></a><span id="l122.89" class="difflineplus">+  gOriginalPhotoURI = cardproperty.getProperty(&quot;PhotoURI&quot;, &quot;&quot;);</span>
<a href="#l122.90"></a><span id="l122.90" class="difflineplus">+  switch (cardproperty.getProperty(&quot;PhotoType&quot;, &quot;&quot;)) {</span>
<a href="#l122.91"></a><span id="l122.91" class="difflineplus">+    case &quot;file&quot;:</span>
<a href="#l122.92"></a><span id="l122.92" class="difflineplus">+      try {</span>
<a href="#l122.93"></a><span id="l122.93" class="difflineplus">+        var file = Components.classes[&quot;@mozilla.org/network/io-service;1&quot;]</span>
<a href="#l122.94"></a><span id="l122.94" class="difflineplus">+                             .getService(Components.interfaces.nsIIOService)</span>
<a href="#l122.95"></a><span id="l122.95" class="difflineplus">+                             .newURI(gOriginalPhotoURI, null, null)</span>
<a href="#l122.96"></a><span id="l122.96" class="difflineplus">+                             .QueryInterface(Components.interfaces.nsIFileURL)</span>
<a href="#l122.97"></a><span id="l122.97" class="difflineplus">+                             .file;</span>
<a href="#l122.98"></a><span id="l122.98" class="difflineplus">+      } catch (e) {}</span>
<a href="#l122.99"></a><span id="l122.99" class="difflineplus">+      if (file) {</span>
<a href="#l122.100"></a><span id="l122.100" class="difflineplus">+        document.getElementById(&quot;PhotoFile&quot;).file = file;</span>
<a href="#l122.101"></a><span id="l122.101" class="difflineplus">+        updatePhoto(&quot;file&quot;);</span>
<a href="#l122.102"></a><span id="l122.102" class="difflineplus">+      }</span>
<a href="#l122.103"></a><span id="l122.103" class="difflineplus">+      else</span>
<a href="#l122.104"></a><span id="l122.104" class="difflineplus">+        updatePhoto(&quot;generic&quot;);</span>
<a href="#l122.105"></a><span id="l122.105" class="difflineplus">+      break;</span>
<a href="#l122.106"></a><span id="l122.106" class="difflineplus">+    case &quot;web&quot;:</span>
<a href="#l122.107"></a><span id="l122.107" class="difflineplus">+      document.getElementById(&quot;PhotoURI&quot;).value = gOriginalPhotoURI;</span>
<a href="#l122.108"></a><span id="l122.108" class="difflineplus">+      updatePhoto(&quot;web&quot;);</span>
<a href="#l122.109"></a><span id="l122.109" class="difflineplus">+      break;</span>
<a href="#l122.110"></a><span id="l122.110" class="difflineplus">+    default:</span>
<a href="#l122.111"></a><span id="l122.111" class="difflineplus">+      if (gOriginalPhotoURI)</span>
<a href="#l122.112"></a><span id="l122.112" class="difflineplus">+        document.getElementById(&quot;GenericPhotoList&quot;).value = gOriginalPhotoURI;</span>
<a href="#l122.113"></a><span id="l122.113">       updatePhoto(&quot;generic&quot;);</span>
<a href="#l122.114"></a><span id="l122.114">   }</span>
<a href="#l122.115"></a><span id="l122.115" class="difflineminus">-  else if (type == &quot;web&quot;) {</span>
<a href="#l122.116"></a><span id="l122.116" class="difflineminus">-    originalPhotoURI = getPhotoURI(cardproperty.getProperty(&quot;PhotoName&quot;, &quot;&quot;));</span>
<a href="#l122.117"></a><span id="l122.117" class="difflineminus">-    document.getElementById(&quot;PhotoURI&quot;).value = originalPhotoURI;</span>
<a href="#l122.118"></a><span id="l122.118" class="difflineminus">-    updatePhoto(&quot;web&quot;);</span>
<a href="#l122.119"></a><span id="l122.119" class="difflineminus">-  }</span>
<a href="#l122.120"></a><span id="l122.120" class="difflineminus">-  else {</span>
<a href="#l122.121"></a><span id="l122.121" class="difflineminus">-    originalPhotoURI = cardproperty.getProperty(&quot;PhotoURI&quot;, &quot;&quot;);</span>
<a href="#l122.122"></a><span id="l122.122" class="difflineminus">-    if (originalPhotoURI)</span>
<a href="#l122.123"></a><span id="l122.123" class="difflineminus">-      document.getElementById(&quot;GenericPhotoList&quot;).value = originalPhotoURI;</span>
<a href="#l122.124"></a><span id="l122.124" class="difflineminus">-    updatePhoto(&quot;generic&quot;);</span>
<a href="#l122.125"></a><span id="l122.125" class="difflineminus">-  }</span>
<a href="#l122.126"></a><span id="l122.126"> }</span>
<a href="#l122.127"></a><span id="l122.127"> </span>
<a href="#l122.128"></a><span id="l122.128"> // when the ab card dialog is being loaded to show a vCard,</span>
<a href="#l122.129"></a><span id="l122.129"> // hide the fields which aren't supported</span>
<a href="#l122.130"></a><span id="l122.130"> // by vCard so the user does not try to edit them.</span>
<a href="#l122.131"></a><span id="l122.131"> function HideNonVcardFields()</span>
<a href="#l122.132"></a><span id="l122.132"> {</span>
<a href="#l122.133"></a><span id="l122.133">   document.getElementById(&quot;homeTabButton&quot;).hidden = true;</span>
<a href="#l122.134"></a><span id="l122.134" class="difflineat">@@ -564,41 +561,46 @@ function CheckAndSetCardValues(cardprope</span>
<a href="#l122.135"></a><span id="l122.135"> </span>
<a href="#l122.136"></a><span id="l122.136">   // set phonetic fields if exist</span>
<a href="#l122.137"></a><span id="l122.137">   try {</span>
<a href="#l122.138"></a><span id="l122.138">     cardproperty.setProperty(&quot;PhoneticFirstName&quot;, doc.getElementById(&quot;PhoneticFirstName&quot;).value);</span>
<a href="#l122.139"></a><span id="l122.139">     cardproperty.setProperty(&quot;PhoneticLastName&quot;, doc.getElementById(&quot;PhoneticLastName&quot;).value);</span>
<a href="#l122.140"></a><span id="l122.140">   }</span>
<a href="#l122.141"></a><span id="l122.141">   catch (ex) {}</span>
<a href="#l122.142"></a><span id="l122.142"> </span>
<a href="#l122.143"></a><span id="l122.143" class="difflineminus">-  var type = document.getElementById(&quot;PhotoType&quot;).selectedItem.id;</span>
<a href="#l122.144"></a><span id="l122.144" class="difflineminus">-  var photoURI = originalPhotoURI;</span>
<a href="#l122.145"></a><span id="l122.145" class="difflineplus">+  var type = document.getElementById(&quot;PhotoType&quot;).value;</span>
<a href="#l122.146"></a><span id="l122.146" class="difflineplus">+  var photoURI = gOriginalPhotoURI;</span>
<a href="#l122.147"></a><span id="l122.147">   if (type == &quot;file&quot; &amp;&amp; document.getElementById(&quot;PhotoFile&quot;).file)</span>
<a href="#l122.148"></a><span id="l122.148" class="difflineminus">-    photoURI = &quot;file://&quot; + document.getElementById(&quot;PhotoFile&quot;).file.path;</span>
<a href="#l122.149"></a><span id="l122.149" class="difflineplus">+    photoURI = Components.classes[&quot;@mozilla.org/network/io-service;1&quot;]</span>
<a href="#l122.150"></a><span id="l122.150" class="difflineplus">+                         .getService(Components.interfaces.nsIIOService)</span>
<a href="#l122.151"></a><span id="l122.151" class="difflineplus">+                         .newFileURI(document.getElementById(&quot;PhotoFile&quot;).file)</span>
<a href="#l122.152"></a><span id="l122.152" class="difflineplus">+                         .spec;</span>
<a href="#l122.153"></a><span id="l122.153">   else if (type == &quot;web&quot; &amp;&amp; document.getElementById(&quot;PhotoURI&quot;).value)</span>
<a href="#l122.154"></a><span id="l122.154">     photoURI = document.getElementById(&quot;PhotoURI&quot;).value;</span>
<a href="#l122.155"></a><span id="l122.155">   else {</span>
<a href="#l122.156"></a><span id="l122.156">     type = &quot;generic&quot;;</span>
<a href="#l122.157"></a><span id="l122.157">     photoURI = document.getElementById(&quot;GenericPhotoList&quot;).value;</span>
<a href="#l122.158"></a><span id="l122.158">   }</span>
<a href="#l122.159"></a><span id="l122.159" class="difflineminus">-  if (photoURI != originalPhotoURI) {</span>
<a href="#l122.160"></a><span id="l122.160" class="difflineplus">+  cardproperty.setProperty(&quot;PhotoType&quot;, type);</span>
<a href="#l122.161"></a><span id="l122.161" class="difflineplus">+  if (photoURI != gOriginalPhotoURI) {</span>
<a href="#l122.162"></a><span id="l122.162">     // Store the original URI</span>
<a href="#l122.163"></a><span id="l122.163">     cardproperty.setProperty(&quot;PhotoURI&quot;, photoURI);</span>
<a href="#l122.164"></a><span id="l122.164" class="difflineminus">-    // Remove the original, if any</span>
<a href="#l122.165"></a><span id="l122.165" class="difflineminus">-    removePhoto(cardproperty.getProperty(&quot;PhotoName&quot;, null));</span>
<a href="#l122.166"></a><span id="l122.166">     // Save the photo if it isn't one of the generic photos</span>
<a href="#l122.167"></a><span id="l122.167" class="difflineminus">-    if (type != &quot;generic&quot;) {</span>
<a href="#l122.168"></a><span id="l122.168" class="difflineminus">-      cardproperty.setProperty(&quot;PhotoType&quot;, &quot;file&quot;);</span>
<a href="#l122.169"></a><span id="l122.169" class="difflineplus">+    if (type == &quot;generic&quot;) {</span>
<a href="#l122.170"></a><span id="l122.170" class="difflineplus">+      // Remove the original, if any</span>
<a href="#l122.171"></a><span id="l122.171" class="difflineplus">+      removePhoto(cardproperty.getProperty(&quot;PhotoName&quot;, null));</span>
<a href="#l122.172"></a><span id="l122.172" class="difflineplus">+    } else {</span>
<a href="#l122.173"></a><span id="l122.173">       // Save the new file and store its URI as PhotoName </span>
<a href="#l122.174"></a><span id="l122.174">       var file = savePhoto(photoURI);</span>
<a href="#l122.175"></a><span id="l122.175" class="difflineminus">-      if (file)</span>
<a href="#l122.176"></a><span id="l122.176" class="difflineplus">+      if (file) {</span>
<a href="#l122.177"></a><span id="l122.177" class="difflineplus">+        // Remove the original, if any</span>
<a href="#l122.178"></a><span id="l122.178" class="difflineplus">+        removePhoto(cardproperty.getProperty(&quot;PhotoName&quot;, null));</span>
<a href="#l122.179"></a><span id="l122.179">         cardproperty.setProperty(&quot;PhotoName&quot;, file.leafName);</span>
<a href="#l122.180"></a><span id="l122.180" class="difflineplus">+      }</span>
<a href="#l122.181"></a><span id="l122.181">     }</span>
<a href="#l122.182"></a><span id="l122.182" class="difflineminus">-    else</span>
<a href="#l122.183"></a><span id="l122.183" class="difflineminus">-      cardproperty.setProperty(&quot;PhotoType&quot;, &quot;generic&quot;);</span>
<a href="#l122.184"></a><span id="l122.184">   }</span>
<a href="#l122.185"></a><span id="l122.185"> </span>
<a href="#l122.186"></a><span id="l122.186">   return true;</span>
<a href="#l122.187"></a><span id="l122.187"> }</span>
<a href="#l122.188"></a><span id="l122.188"> </span>
<a href="#l122.189"></a><span id="l122.189"> function CleanUpWebPage(webPage)</span>
<a href="#l122.190"></a><span id="l122.190"> {</span>
<a href="#l122.191"></a><span id="l122.191">   // no :// yet so we should add something</span>
<a href="#l122.192"></a><span id="l122.192" class="difflineat">@@ -898,35 +900,38 @@ function modifyDatepicker(aDatepicker) {</span>
<a href="#l122.193"></a><span id="l122.193">  * Updates the photo by setting the src attribute of the photo element.</span>
<a href="#l122.194"></a><span id="l122.194">  *</span>
<a href="#l122.195"></a><span id="l122.195">  * @param aType Optional. The type of photo (web, file, or generic).</span>
<a href="#l122.196"></a><span id="l122.196">  *              If supplied the corresponding radio button will be selected.</span>
<a href="#l122.197"></a><span id="l122.197">  *              If not supplied the type will be determined by the currently</span>
<a href="#l122.198"></a><span id="l122.198">  *              selected type.</span>
<a href="#l122.199"></a><span id="l122.199">  */</span>
<a href="#l122.200"></a><span id="l122.200"> function updatePhoto(aType) {</span>
<a href="#l122.201"></a><span id="l122.201" class="difflineminus">-  if (aType) {</span>
<a href="#l122.202"></a><span id="l122.202" class="difflineplus">+  if (aType)</span>
<a href="#l122.203"></a><span id="l122.203">     // Select the type's radio button</span>
<a href="#l122.204"></a><span id="l122.204" class="difflineminus">-    document.getElementById(&quot;PhotoType&quot;).selectedItem =</span>
<a href="#l122.205"></a><span id="l122.205" class="difflineminus">-      document.getElementById(aType);</span>
<a href="#l122.206"></a><span id="l122.206" class="difflineminus">-  }</span>
<a href="#l122.207"></a><span id="l122.207" class="difflineplus">+    document.getElementById(&quot;PhotoType&quot;).value = aType;</span>
<a href="#l122.208"></a><span id="l122.208">   else</span>
<a href="#l122.209"></a><span id="l122.209" class="difflineminus">-    aType = document.getElementById(&quot;PhotoType&quot;).selectedItem.id;</span>
<a href="#l122.210"></a><span id="l122.210" class="difflineplus">+    aType = document.getElementById(&quot;PhotoType&quot;).value;</span>
<a href="#l122.211"></a><span id="l122.211"> </span>
<a href="#l122.212"></a><span id="l122.212">   var value;</span>
<a href="#l122.213"></a><span id="l122.213" class="difflineminus">-  if (aType == &quot;file&quot;) {</span>
<a href="#l122.214"></a><span id="l122.214" class="difflineminus">-    var file = document.getElementById(&quot;PhotoFile&quot;).file;</span>
<a href="#l122.215"></a><span id="l122.215" class="difflineminus">-    value = file ? &quot;file://&quot; + file.path : &quot;&quot;;</span>
<a href="#l122.216"></a><span id="l122.216" class="difflineplus">+  switch (aType) {</span>
<a href="#l122.217"></a><span id="l122.217" class="difflineplus">+    case &quot;file&quot;:</span>
<a href="#l122.218"></a><span id="l122.218" class="difflineplus">+      var file = document.getElementById(&quot;PhotoFile&quot;).file;</span>
<a href="#l122.219"></a><span id="l122.219" class="difflineplus">+      value = file ? Components.classes[&quot;@mozilla.org/network/io-service;1&quot;]</span>
<a href="#l122.220"></a><span id="l122.220" class="difflineplus">+                               .getService(Components.interfaces.nsIIOService)</span>
<a href="#l122.221"></a><span id="l122.221" class="difflineplus">+                               .newFileURI(file)</span>
<a href="#l122.222"></a><span id="l122.222" class="difflineplus">+                               .spec : &quot;&quot;;</span>
<a href="#l122.223"></a><span id="l122.223" class="difflineplus">+      break;</span>
<a href="#l122.224"></a><span id="l122.224" class="difflineplus">+    case &quot;web&quot;:</span>
<a href="#l122.225"></a><span id="l122.225" class="difflineplus">+      value = document.getElementById(&quot;PhotoURI&quot;).value;</span>
<a href="#l122.226"></a><span id="l122.226" class="difflineplus">+      break;</span>
<a href="#l122.227"></a><span id="l122.227" class="difflineplus">+    default:</span>
<a href="#l122.228"></a><span id="l122.228" class="difflineplus">+      value = document.getElementById(&quot;GenericPhotoList&quot;).value;</span>
<a href="#l122.229"></a><span id="l122.229">   }</span>
<a href="#l122.230"></a><span id="l122.230" class="difflineminus">-  else if (aType == &quot;web&quot;)</span>
<a href="#l122.231"></a><span id="l122.231" class="difflineminus">-    value = document.getElementById(&quot;PhotoURI&quot;).value;</span>
<a href="#l122.232"></a><span id="l122.232" class="difflineminus">-  else</span>
<a href="#l122.233"></a><span id="l122.233" class="difflineminus">-    value = document.getElementById(&quot;GenericPhotoList&quot;).value;</span>
<a href="#l122.234"></a><span id="l122.234" class="difflineminus">-  document.getElementById(&quot;photo&quot;).setAttribute(&quot;src&quot;, value ? value</span>
<a href="#l122.235"></a><span id="l122.235" class="difflineminus">-                                                             : defaultPhotoURI);</span>
<a href="#l122.236"></a><span id="l122.236" class="difflineplus">+  document.getElementById(&quot;photo&quot;).setAttribute(&quot;src&quot;, value || defaultPhotoURI);</span>
<a href="#l122.237"></a><span id="l122.237"> }</span>
<a href="#l122.238"></a><span id="l122.238"> </span>
<a href="#l122.239"></a><span id="l122.239"> /**</span>
<a href="#l122.240"></a><span id="l122.240">  * Removes the photo file at the given path, if present.</span>
<a href="#l122.241"></a><span id="l122.241">  *</span>
<a href="#l122.242"></a><span id="l122.242">  * @param aName The name of the photo to remove from the Photos directory.</span>
<a href="#l122.243"></a><span id="l122.243">  *</span>
<a href="#l122.244"></a><span id="l122.244">  * @return true if the file was deleted.</span>
<a href="#l122.245"></a><span id="l122.245" class="difflineat">@@ -934,27 +939,20 @@ function updatePhoto(aType) {</span>
<a href="#l122.246"></a><span id="l122.246"> function removePhoto(aName) {</span>
<a href="#l122.247"></a><span id="l122.247">   if (!aName)</span>
<a href="#l122.248"></a><span id="l122.248">     return false;</span>
<a href="#l122.249"></a><span id="l122.249">   // Get the directory with all the photos</span>
<a href="#l122.250"></a><span id="l122.250">   var file = getPhotosDir();</span>
<a href="#l122.251"></a><span id="l122.251">   // Get the photo (throws an exception for invalid names)</span>
<a href="#l122.252"></a><span id="l122.252">   try {</span>
<a href="#l122.253"></a><span id="l122.253">     file.append(aName);</span>
<a href="#l122.254"></a><span id="l122.254" class="difflineminus">-  }</span>
<a href="#l122.255"></a><span id="l122.255" class="difflineminus">-  catch (e) {</span>
<a href="#l122.256"></a><span id="l122.256" class="difflineminus">-    return false;</span>
<a href="#l122.257"></a><span id="l122.257" class="difflineplus">+    file.remove(false);</span>
<a href="#l122.258"></a><span id="l122.258" class="difflineplus">+    return true;</span>
<a href="#l122.259"></a><span id="l122.259">   }</span>
<a href="#l122.260"></a><span id="l122.260" class="difflineminus">-  if (file.exists()) {</span>
<a href="#l122.261"></a><span id="l122.261" class="difflineminus">-    try {</span>
<a href="#l122.262"></a><span id="l122.262" class="difflineminus">-      file.remove(false);</span>
<a href="#l122.263"></a><span id="l122.263" class="difflineminus">-      return true;</span>
<a href="#l122.264"></a><span id="l122.264" class="difflineminus">-    }</span>
<a href="#l122.265"></a><span id="l122.265" class="difflineminus">-    catch (e) {}</span>
<a href="#l122.266"></a><span id="l122.266" class="difflineminus">-  }</span>
<a href="#l122.267"></a><span id="l122.267" class="difflineplus">+  catch (e) {}</span>
<a href="#l122.268"></a><span id="l122.268">   return false;</span>
<a href="#l122.269"></a><span id="l122.269"> }</span>
<a href="#l122.270"></a><span id="l122.270"> </span>
<a href="#l122.271"></a><span id="l122.271"> /**</span>
<a href="#l122.272"></a><span id="l122.272">  * Opens a file picker with image filters to look for a contact photo.</span>
<a href="#l122.273"></a><span id="l122.273">  * If the user selects a file and clicks OK then the PhotoURI textbox is set</span>
<a href="#l122.274"></a><span id="l122.274">  * with a file URI pointing to that file and updatePhoto is called.</span>
<a href="#l122.275"></a><span id="l122.275">  *</span>
<a href="#l122.276"></a><span id="l122.276" class="difflineat">@@ -962,18 +960,18 @@ function removePhoto(aName) {</span>
<a href="#l122.277"></a><span id="l122.277">  */</span>
<a href="#l122.278"></a><span id="l122.278"> function browsePhoto() {</span>
<a href="#l122.279"></a><span id="l122.279">   var nsIFilePicker = Components.interfaces.nsIFilePicker;</span>
<a href="#l122.280"></a><span id="l122.280">   var fp = Components.classes[&quot;@mozilla.org/filepicker;1&quot;]</span>
<a href="#l122.281"></a><span id="l122.281"> 	                   .createInstance(nsIFilePicker);</span>
<a href="#l122.282"></a><span id="l122.282">   fp.init(window, gAddressBookBundle.getString(&quot;browsePhoto&quot;), nsIFilePicker.modeOpen);</span>
<a href="#l122.283"></a><span id="l122.283">   </span>
<a href="#l122.284"></a><span id="l122.284">   // Add All Files &amp; Image Files filters and select the latter</span>
<a href="#l122.285"></a><span id="l122.285" class="difflineminus">-  fp.appendFilters(nsIFilePicker.filterAll | nsIFilePicker.filterImages);</span>
<a href="#l122.286"></a><span id="l122.286" class="difflineminus">-  fp.filterIndex = 1;</span>
<a href="#l122.287"></a><span id="l122.287" class="difflineplus">+  fp.appendFilters(nsIFilePicker.filterImages);</span>
<a href="#l122.288"></a><span id="l122.288" class="difflineplus">+  fp.appendFilters(nsIFilePicker.filterAll);</span>
<a href="#l122.289"></a><span id="l122.289"> </span>
<a href="#l122.290"></a><span id="l122.290">   if (fp.show() == nsIFilePicker.returnOK) {</span>
<a href="#l122.291"></a><span id="l122.291">     document.getElementById(&quot;PhotoFile&quot;).file = fp.file;</span>
<a href="#l122.292"></a><span id="l122.292">     updatePhoto(&quot;file&quot;);</span>
<a href="#l122.293"></a><span id="l122.293">     return true;</span>
<a href="#l122.294"></a><span id="l122.294">   }</span>
<a href="#l122.295"></a><span id="l122.295">   return false;</span>
<a href="#l122.296"></a><span id="l122.296"> }</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l123.1"></a><span id="l123.1" class="difflineminus">--- a/suite/mailnews/addrbook/abCommon.js</span>
<a href="#l123.2"></a><span id="l123.2" class="difflineplus">+++ b/suite/mailnews/addrbook/abCommon.js</span>
<a href="#l123.3"></a><span id="l123.3" class="difflineat">@@ -729,68 +729,56 @@ function savePhoto(aUri) {</span>
<a href="#l123.4"></a><span id="l123.4"> </span>
<a href="#l123.5"></a><span id="l123.5">   // Create a channel from the URI and open it as an input stream</span>
<a href="#l123.6"></a><span id="l123.6">   var ios = Components.classes[&quot;@mozilla.org/network/io-service;1&quot;]</span>
<a href="#l123.7"></a><span id="l123.7">                       .getService(Components.interfaces.nsIIOService);</span>
<a href="#l123.8"></a><span id="l123.8">   var channel = ios.newChannelFromURI(ios.newURI(aUri, null, null));</span>
<a href="#l123.9"></a><span id="l123.9">   var istream = channel.open();</span>
<a href="#l123.10"></a><span id="l123.10"> </span>
<a href="#l123.11"></a><span id="l123.11">   // Get the photo file</span>
<a href="#l123.12"></a><span id="l123.12" class="difflineminus">-  file.append(makePhotoFilename(file.path, findPhotoExt(aUri, channel)));</span>
<a href="#l123.13"></a><span id="l123.13" class="difflineplus">+  file = makePhotoFile(file, findPhotoExt(channel));</span>
<a href="#l123.14"></a><span id="l123.14"> </span>
<a href="#l123.15"></a><span id="l123.15">   return saveStreamToFile(istream, file);</span>
<a href="#l123.16"></a><span id="l123.16"> }</span>
<a href="#l123.17"></a><span id="l123.17"> </span>
<a href="#l123.18"></a><span id="l123.18"> /**</span>
<a href="#l123.19"></a><span id="l123.19">  * Finds the file extension of the photo identified by the URI, if possible.</span>
<a href="#l123.20"></a><span id="l123.20">  * This function can be overridden (with a copy of the original) for URIs that</span>
<a href="#l123.21"></a><span id="l123.21">  * do not identify the extension or when the Content-Type response header is</span>
<a href="#l123.22"></a><span id="l123.22">  * either not set or isn't 'image/png', 'image/jpeg', or 'image/gif'.</span>
<a href="#l123.23"></a><span id="l123.23">  * The original function can be called if the URI does not match.</span>
<a href="#l123.24"></a><span id="l123.24">  *</span>
<a href="#l123.25"></a><span id="l123.25">  * @param aUri The URI of the photo.</span>
<a href="#l123.26"></a><span id="l123.26">  * @param aChannel The opened channel for the URI.</span>
<a href="#l123.27"></a><span id="l123.27">  *</span>
<a href="#l123.28"></a><span id="l123.28">  * @return The extension of the file, if any, including the period.</span>
<a href="#l123.29"></a><span id="l123.29">  */</span>
<a href="#l123.30"></a><span id="l123.30" class="difflineminus">-function findPhotoExt(aUri, aChannel) {</span>
<a href="#l123.31"></a><span id="l123.31" class="difflineminus">-  if (aChannel) {</span>
<a href="#l123.32"></a><span id="l123.32" class="difflineminus">-    try {</span>
<a href="#l123.33"></a><span id="l123.33" class="difflineminus">-      aChannel.QueryInterface(Components.interfaces.nsIHttpChannel);</span>
<a href="#l123.34"></a><span id="l123.34" class="difflineminus">-      var header = aChannel.getResponseHeader(&quot;Content-Type&quot;);</span>
<a href="#l123.35"></a><span id="l123.35" class="difflineminus">-      var type   = header ? header.split(&quot;;&quot;)[0] : &quot;&quot;;</span>
<a href="#l123.36"></a><span id="l123.36" class="difflineminus">-      switch (type.toLowerCase()) {</span>
<a href="#l123.37"></a><span id="l123.37" class="difflineminus">-        case &quot;image/png&quot;:</span>
<a href="#l123.38"></a><span id="l123.38" class="difflineminus">-          return &quot;.png&quot;;</span>
<a href="#l123.39"></a><span id="l123.39" class="difflineminus">-        case &quot;image/jpeg&quot;:</span>
<a href="#l123.40"></a><span id="l123.40" class="difflineminus">-          return &quot;.jpg&quot;;</span>
<a href="#l123.41"></a><span id="l123.41" class="difflineminus">-        case &quot;image/gif&quot;:</span>
<a href="#l123.42"></a><span id="l123.42" class="difflineminus">-          return &quot;.gif&quot;;</span>
<a href="#l123.43"></a><span id="l123.43" class="difflineminus">-      }</span>
<a href="#l123.44"></a><span id="l123.44" class="difflineminus">-    } catch (e) {}</span>
<a href="#l123.45"></a><span id="l123.45" class="difflineminus">-  }</span>
<a href="#l123.46"></a><span id="l123.46" class="difflineminus">-</span>
<a href="#l123.47"></a><span id="l123.47" class="difflineminus">-  var index = aUri ? aUri.lastIndexOf(&quot;.&quot;) : -1;</span>
<a href="#l123.48"></a><span id="l123.48" class="difflineminus">-  if (index == -1)</span>
<a href="#l123.49"></a><span id="l123.49" class="difflineminus">-    return &quot;&quot;;</span>
<a href="#l123.50"></a><span id="l123.50" class="difflineminus">-   return aUri.substring(index);</span>
<a href="#l123.51"></a><span id="l123.51" class="difflineplus">+function findPhotoExt(aChannel) {</span>
<a href="#l123.52"></a><span id="l123.52" class="difflineplus">+  var mimeSvc = Components.classes[&quot;@mozilla.org/mime;1&quot;]</span>
<a href="#l123.53"></a><span id="l123.53" class="difflineplus">+                          .getService(Components.interfaces.nsIMIMEService);</span>
<a href="#l123.54"></a><span id="l123.54" class="difflineplus">+  var ext = &quot;&quot;;</span>
<a href="#l123.55"></a><span id="l123.55" class="difflineplus">+  var uri = aChannel.URI;</span>
<a href="#l123.56"></a><span id="l123.56" class="difflineplus">+  if (uri instanceof Components.interfaces.nsIURL)</span>
<a href="#l123.57"></a><span id="l123.57" class="difflineplus">+    ext = uri.fileExtension;</span>
<a href="#l123.58"></a><span id="l123.58" class="difflineplus">+  try {</span>
<a href="#l123.59"></a><span id="l123.59" class="difflineplus">+    return mimeSvc.getPrimaryExtension(aChannel.contentType, ext);</span>
<a href="#l123.60"></a><span id="l123.60" class="difflineplus">+  } catch (e) {}</span>
<a href="#l123.61"></a><span id="l123.61" class="difflineplus">+  return ext;</span>
<a href="#l123.62"></a><span id="l123.62"> }</span>
<a href="#l123.63"></a><span id="l123.63"> </span>
<a href="#l123.64"></a><span id="l123.64"> /**</span>
<a href="#l123.65"></a><span id="l123.65">  * Generates a unique filename to be used for a local copy of a contact's photo.</span>
<a href="#l123.66"></a><span id="l123.66">  *</span>
<a href="#l123.67"></a><span id="l123.67">  * @param aPath      The path to the folder in which the photo will be saved.</span>
<a href="#l123.68"></a><span id="l123.68">  * @param aExtension The file extension of the photo.</span>
<a href="#l123.69"></a><span id="l123.69">  *</span>
<a href="#l123.70"></a><span id="l123.70">  * @return A unique filename in the given path.</span>
<a href="#l123.71"></a><span id="l123.71">  */</span>
<a href="#l123.72"></a><span id="l123.72" class="difflineminus">-function makePhotoFilename(aPath, aExtension) {</span>
<a href="#l123.73"></a><span id="l123.73" class="difflineplus">+function makePhotoFile(aDir, aExtension) {</span>
<a href="#l123.74"></a><span id="l123.74">   var filename, newFile;</span>
<a href="#l123.75"></a><span id="l123.75">   // Find a random filename for the photo that doesn't exist yet</span>
<a href="#l123.76"></a><span id="l123.76">   do {</span>
<a href="#l123.77"></a><span id="l123.77" class="difflineminus">-    filename = new String(Math.random()).replace(&quot;0.&quot;, &quot;&quot;) + aExtension;</span>
<a href="#l123.78"></a><span id="l123.78" class="difflineminus">-    newFile = Components.classes[&quot;@mozilla.org/file/local;1&quot;]</span>
<a href="#l123.79"></a><span id="l123.79" class="difflineminus">-                        .createInstance(Components.interfaces.nsILocalFile);</span>
<a href="#l123.80"></a><span id="l123.80" class="difflineminus">-    newFile.initWithPath(aPath);</span>
<a href="#l123.81"></a><span id="l123.81" class="difflineplus">+    filename = new String(Math.random()).replace(&quot;0.&quot;, &quot;&quot;) + &quot;.&quot; + aExtension;</span>
<a href="#l123.82"></a><span id="l123.82" class="difflineplus">+    newFile = aDir.clone();</span>
<a href="#l123.83"></a><span id="l123.83">     newFile.append(filename);</span>
<a href="#l123.84"></a><span id="l123.84">   } while (newFile.exists());</span>
<a href="#l123.85"></a><span id="l123.85" class="difflineminus">-  return filename;</span>
<a href="#l123.86"></a><span id="l123.86" class="difflineplus">+  return newFile;</span>
<a href="#l123.87"></a><span id="l123.87"> }</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l124.1"></a><span id="l124.1" class="difflineminus">--- a/suite/mailnews/mail3PaneWindowCommands.js</span>
<a href="#l124.2"></a><span id="l124.2" class="difflineplus">+++ b/suite/mailnews/mail3PaneWindowCommands.js</span>
<a href="#l124.3"></a><span id="l124.3" class="difflineat">@@ -180,16 +180,17 @@ var DefaultController =</span>
<a href="#l124.4"></a><span id="l124.4">       case &quot;button_goForward&quot;:</span>
<a href="#l124.5"></a><span id="l124.5">       case &quot;cmd_goForward&quot;:</span>
<a href="#l124.6"></a><span id="l124.6">       case &quot;cmd_goStartPage&quot;:</span>
<a href="#l124.7"></a><span id="l124.7"> 			case &quot;cmd_viewAllMsgs&quot;:</span>
<a href="#l124.8"></a><span id="l124.8"> 			case &quot;cmd_viewUnreadMsgs&quot;:</span>
<a href="#l124.9"></a><span id="l124.9">       case &quot;cmd_viewThreadsWithUnread&quot;:</span>
<a href="#l124.10"></a><span id="l124.10">       case &quot;cmd_viewWatchedThreadsWithUnread&quot;:</span>
<a href="#l124.11"></a><span id="l124.11">       case &quot;cmd_viewIgnoredThreads&quot;:</span>
<a href="#l124.12"></a><span id="l124.12" class="difflineplus">+      case &quot;cmd_stop&quot;:</span>
<a href="#l124.13"></a><span id="l124.13">       case &quot;cmd_undo&quot;:</span>
<a href="#l124.14"></a><span id="l124.14">       case &quot;cmd_redo&quot;:</span>
<a href="#l124.15"></a><span id="l124.15"> 			case &quot;cmd_expandAllThreads&quot;:</span>
<a href="#l124.16"></a><span id="l124.16"> 			case &quot;cmd_collapseAllThreads&quot;:</span>
<a href="#l124.17"></a><span id="l124.17"> 			case &quot;cmd_renameFolder&quot;:</span>
<a href="#l124.18"></a><span id="l124.18"> 			case &quot;cmd_sendUnsentMsgs&quot;:</span>
<a href="#l124.19"></a><span id="l124.19"> 			case &quot;cmd_openMessage&quot;:</span>
<a href="#l124.20"></a><span id="l124.20">       case &quot;button_print&quot;:</span>
<a href="#l124.21"></a><span id="l124.21" class="difflineat">@@ -341,21 +342,30 @@ var DefaultController =</span>
<a href="#l124.22"></a><span id="l124.22">         return true;</span>
<a href="#l124.23"></a><span id="l124.23">       case &quot;cmd_markAsFlagged&quot;:</span>
<a href="#l124.24"></a><span id="l124.24">       case &quot;button_file&quot;:</span>
<a href="#l124.25"></a><span id="l124.25">       case &quot;cmd_file&quot;:</span>
<a href="#l124.26"></a><span id="l124.26">       case &quot;cmd_archive&quot;:</span>
<a href="#l124.27"></a><span id="l124.27">         return (GetNumSelectedMessages() &gt; 0);</span>
<a href="#l124.28"></a><span id="l124.28">       case &quot;cmd_markAsJunk&quot;:</span>
<a href="#l124.29"></a><span id="l124.29">       case &quot;cmd_markAsNotJunk&quot;:</span>
<a href="#l124.30"></a><span id="l124.30" class="difflineminus">-        // can't do news on junk yet.</span>
<a href="#l124.31"></a><span id="l124.31" class="difflineminus">-        return (GetNumSelectedMessages() &gt; 0 &amp;&amp; !isNewsURI(GetFirstSelectedMessage()));</span>
<a href="#l124.32"></a><span id="l124.32" class="difflineplus">+        if (gDBView)</span>
<a href="#l124.33"></a><span id="l124.33" class="difflineplus">+          gDBView.getCommandStatus(nsMsgViewCommandType.junk, enabled, checkStatus);</span>
<a href="#l124.34"></a><span id="l124.34" class="difflineplus">+        return enabled.value;</span>
<a href="#l124.35"></a><span id="l124.35">       case &quot;cmd_recalculateJunkScore&quot;:</span>
<a href="#l124.36"></a><span id="l124.36" class="difflineminus">-        if (GetNumSelectedMessages() &gt; 0)</span>
<a href="#l124.37"></a><span id="l124.37" class="difflineplus">+        // We're going to take a conservative position here, because we really</span>
<a href="#l124.38"></a><span id="l124.38" class="difflineplus">+        // don't want people running junk controls on folders that are not</span>
<a href="#l124.39"></a><span id="l124.39" class="difflineplus">+        // enabled for junk. The junk type picks up possible dummy message headers,</span>
<a href="#l124.40"></a><span id="l124.40" class="difflineplus">+        // while the runJunkControls will prevent running on XF virtual folders.</span>
<a href="#l124.41"></a><span id="l124.41" class="difflineplus">+        if (gDBView)</span>
<a href="#l124.42"></a><span id="l124.42" class="difflineplus">+        {</span>
<a href="#l124.43"></a><span id="l124.43">           gDBView.getCommandStatus(nsMsgViewCommandType.runJunkControls, enabled, checkStatus);</span>
<a href="#l124.44"></a><span id="l124.44" class="difflineplus">+          if (enabled.value)</span>
<a href="#l124.45"></a><span id="l124.45" class="difflineplus">+            gDBView.getCommandStatus(nsMsgViewCommandType.junk, enabled, checkStatus);</span>
<a href="#l124.46"></a><span id="l124.46" class="difflineplus">+        }</span>
<a href="#l124.47"></a><span id="l124.47">         return enabled.value;</span>
<a href="#l124.48"></a><span id="l124.48">       case &quot;cmd_markAsShowRemote&quot;:</span>
<a href="#l124.49"></a><span id="l124.49">         return (GetNumSelectedMessages() &gt; 0 &amp;&amp; checkMsgHdrPropertyIsNot(&quot;remoteContentPolicy&quot;, kAllowRemoteContent));</span>
<a href="#l124.50"></a><span id="l124.50">       case &quot;cmd_markAsNotPhish&quot;:</span>
<a href="#l124.51"></a><span id="l124.51">         return (GetNumSelectedMessages() &gt; 0 &amp;&amp; checkMsgHdrPropertyIsNot(&quot;notAPhishMessage&quot;, kNotAPhishMessage));</span>
<a href="#l124.52"></a><span id="l124.52">       case &quot;cmd_displayMsgFilters&quot;:</span>
<a href="#l124.53"></a><span id="l124.53">         let mgr = Components.classes[&quot;@mozilla.org/messenger/account-manager;1&quot;]</span>
<a href="#l124.54"></a><span id="l124.54">                             .getService(Components.interfaces.nsIMsgAccountManager);</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l125.1"></a><span id="l125.1" class="difflineminus">--- a/suite/mailnews/messageWindow.js</span>
<a href="#l125.2"></a><span id="l125.2" class="difflineplus">+++ b/suite/mailnews/messageWindow.js</span>
<a href="#l125.3"></a><span id="l125.3" class="difflineat">@@ -296,16 +296,47 @@ function OnLoadMessageWindow()</span>
<a href="#l125.4"></a><span id="l125.4">   var mailToolbox = getMailToolbox();</span>
<a href="#l125.5"></a><span id="l125.5">   mailToolbox.customizeInit = MailToolboxCustomizeInit;</span>
<a href="#l125.6"></a><span id="l125.6">   mailToolbox.customizeDone = MailToolboxCustomizeDone;</span>
<a href="#l125.7"></a><span id="l125.7">   mailToolbox.customizeChange = MailToolboxCustomizeChange;</span>
<a href="#l125.8"></a><span id="l125.8"> </span>
<a href="#l125.9"></a><span id="l125.9">   setTimeout(OnLoadMessageWindowDelayed, 0, loadCustomMessage);</span>
<a href="#l125.10"></a><span id="l125.10"> </span>
<a href="#l125.11"></a><span id="l125.11">   SetupCommandUpdateHandlers();</span>
<a href="#l125.12"></a><span id="l125.12" class="difflineplus">+</span>
<a href="#l125.13"></a><span id="l125.13" class="difflineplus">+  window.addEventListener(&quot;AppCommand&quot;, HandleAppCommandEvent, true);</span>
<a href="#l125.14"></a><span id="l125.14" class="difflineplus">+}</span>
<a href="#l125.15"></a><span id="l125.15" class="difflineplus">+</span>
<a href="#l125.16"></a><span id="l125.16" class="difflineplus">+function HandleAppCommandEvent(evt)</span>
<a href="#l125.17"></a><span id="l125.17" class="difflineplus">+{</span>
<a href="#l125.18"></a><span id="l125.18" class="difflineplus">+  evt.stopPropagation();</span>
<a href="#l125.19"></a><span id="l125.19" class="difflineplus">+  switch (evt.command)</span>
<a href="#l125.20"></a><span id="l125.20" class="difflineplus">+  {</span>
<a href="#l125.21"></a><span id="l125.21" class="difflineplus">+    case &quot;Back&quot;:</span>
<a href="#l125.22"></a><span id="l125.22" class="difflineplus">+      goDoCommand('cmd_goBack');</span>
<a href="#l125.23"></a><span id="l125.23" class="difflineplus">+      break;</span>
<a href="#l125.24"></a><span id="l125.24" class="difflineplus">+    case &quot;Forward&quot;:</span>
<a href="#l125.25"></a><span id="l125.25" class="difflineplus">+      goDoCommand('cmd_goForward');</span>
<a href="#l125.26"></a><span id="l125.26" class="difflineplus">+      break;</span>
<a href="#l125.27"></a><span id="l125.27" class="difflineplus">+    case &quot;Stop&quot;:</span>
<a href="#l125.28"></a><span id="l125.28" class="difflineplus">+      goDoCommand('cmd_stop');</span>
<a href="#l125.29"></a><span id="l125.29" class="difflineplus">+      break;</span>
<a href="#l125.30"></a><span id="l125.30" class="difflineplus">+    case &quot;Search&quot;:</span>
<a href="#l125.31"></a><span id="l125.31" class="difflineplus">+      goDoCommand('cmd_search');</span>
<a href="#l125.32"></a><span id="l125.32" class="difflineplus">+      break;</span>
<a href="#l125.33"></a><span id="l125.33" class="difflineplus">+    case &quot;Bookmarks&quot;:</span>
<a href="#l125.34"></a><span id="l125.34" class="difflineplus">+      toAddressBook();</span>
<a href="#l125.35"></a><span id="l125.35" class="difflineplus">+      break;</span>
<a href="#l125.36"></a><span id="l125.36" class="difflineplus">+    case &quot;Reload&quot;:</span>
<a href="#l125.37"></a><span id="l125.37" class="difflineplus">+      goDoCommand('cmd_reload');</span>
<a href="#l125.38"></a><span id="l125.38" class="difflineplus">+      break;</span>
<a href="#l125.39"></a><span id="l125.39" class="difflineplus">+    case &quot;Home&quot;:</span>
<a href="#l125.40"></a><span id="l125.40" class="difflineplus">+    default:</span>
<a href="#l125.41"></a><span id="l125.41" class="difflineplus">+      break;</span>
<a href="#l125.42"></a><span id="l125.42" class="difflineplus">+  }</span>
<a href="#l125.43"></a><span id="l125.43"> }</span>
<a href="#l125.44"></a><span id="l125.44"> </span>
<a href="#l125.45"></a><span id="l125.45"> function OnLoadMessageWindowDelayed(loadCustomMessage)</span>
<a href="#l125.46"></a><span id="l125.46"> {</span>
<a href="#l125.47"></a><span id="l125.47">   gDBView.suppressMsgDisplay = false;</span>
<a href="#l125.48"></a><span id="l125.48">   if (loadCustomMessage)</span>
<a href="#l125.49"></a><span id="l125.49">     gDBView.loadMessageByUrl(gCurrentMessageUri);</span>
<a href="#l125.50"></a><span id="l125.50">   else</span>
<a href="#l125.51"></a><span id="l125.51" class="difflineat">@@ -391,16 +422,18 @@ function extractMsgKeyFromURI()</span>
<a href="#l125.52"></a><span id="l125.52">   var msgHdr = messenger.msgHdrFromURI(gCurrentMessageUri);</span>
<a href="#l125.53"></a><span id="l125.53">   if (msgHdr)</span>
<a href="#l125.54"></a><span id="l125.54">     msgKey = msgHdr.messageKey;</span>
<a href="#l125.55"></a><span id="l125.55">   return msgKey;</span>
<a href="#l125.56"></a><span id="l125.56"> }</span>
<a href="#l125.57"></a><span id="l125.57"> </span>
<a href="#l125.58"></a><span id="l125.58"> function OnUnloadMessageWindow()</span>
<a href="#l125.59"></a><span id="l125.59"> {</span>
<a href="#l125.60"></a><span id="l125.60" class="difflineplus">+  window.removeEventListener(&quot;AppCommand&quot;, HandleAppCommandEvent, true);</span>
<a href="#l125.61"></a><span id="l125.61" class="difflineplus">+</span>
<a href="#l125.62"></a><span id="l125.62">   UnloadCommandUpdateHandlers();</span>
<a href="#l125.63"></a><span id="l125.63"> </span>
<a href="#l125.64"></a><span id="l125.64">   // FIX ME - later we will be able to use onunload from the overlay</span>
<a href="#l125.65"></a><span id="l125.65">   OnUnloadMsgHeaderPane();</span>
<a href="#l125.66"></a><span id="l125.66"> </span>
<a href="#l125.67"></a><span id="l125.67">   OnMailWindowUnload();</span>
<a href="#l125.68"></a><span id="l125.68"> }</span>
<a href="#l125.69"></a><span id="l125.69"> </span>
<a href="#l125.70"></a><span id="l125.70" class="difflineat">@@ -556,16 +589,17 @@ function ReloadMessage()</span>
<a href="#l125.71"></a><span id="l125.71"> // MessageWindowController object (handles commands when one of the trees does not have focus)</span>
<a href="#l125.72"></a><span id="l125.72"> var MessageWindowController =</span>
<a href="#l125.73"></a><span id="l125.73"> {</span>
<a href="#l125.74"></a><span id="l125.74">   supportsCommand: function(command)</span>
<a href="#l125.75"></a><span id="l125.75">   {</span>
<a href="#l125.76"></a><span id="l125.76">     switch (command)</span>
<a href="#l125.77"></a><span id="l125.77">     {</span>
<a href="#l125.78"></a><span id="l125.78">       case &quot;cmd_delete&quot;:</span>
<a href="#l125.79"></a><span id="l125.79" class="difflineplus">+      case &quot;cmd_stop&quot;:</span>
<a href="#l125.80"></a><span id="l125.80">       case &quot;cmd_undo&quot;:</span>
<a href="#l125.81"></a><span id="l125.81">       case &quot;cmd_redo&quot;:</span>
<a href="#l125.82"></a><span id="l125.82">       case &quot;cmd_killThread&quot;:</span>
<a href="#l125.83"></a><span id="l125.83">       case &quot;cmd_killSubthread&quot;:</span>
<a href="#l125.84"></a><span id="l125.84">       case &quot;cmd_watchThread&quot;:</span>
<a href="#l125.85"></a><span id="l125.85">       case &quot;button_delete&quot;:</span>
<a href="#l125.86"></a><span id="l125.86">       case &quot;button_shiftDelete&quot;:</span>
<a href="#l125.87"></a><span id="l125.87">       case &quot;button_junk&quot;:</span>
<a href="#l125.88"></a><span id="l125.88" class="difflineat">@@ -641,16 +675,19 @@ var MessageWindowController =</span>
<a href="#l125.89"></a><span id="l125.89">       default:</span>
<a href="#l125.90"></a><span id="l125.90">         return false;</span>
<a href="#l125.91"></a><span id="l125.91">     }</span>
<a href="#l125.92"></a><span id="l125.92">   },</span>
<a href="#l125.93"></a><span id="l125.93"> </span>
<a href="#l125.94"></a><span id="l125.94"> 	isCommandEnabled: function(command)</span>
<a href="#l125.95"></a><span id="l125.95"> 	{</span>
<a href="#l125.96"></a><span id="l125.96">     var loadedFolder;</span>
<a href="#l125.97"></a><span id="l125.97" class="difflineplus">+    var enabled = new Object();</span>
<a href="#l125.98"></a><span id="l125.98" class="difflineplus">+    enabled.value = false;</span>
<a href="#l125.99"></a><span id="l125.99" class="difflineplus">+    var checkStatus = new Object();</span>
<a href="#l125.100"></a><span id="l125.100"> </span>
<a href="#l125.101"></a><span id="l125.101"> 		switch (command)</span>
<a href="#l125.102"></a><span id="l125.102"> 		{</span>
<a href="#l125.103"></a><span id="l125.103">       case &quot;cmd_createFilterFromPopup&quot;:</span>
<a href="#l125.104"></a><span id="l125.104">       case &quot;cmd_createFilterFromMenu&quot;:</span>
<a href="#l125.105"></a><span id="l125.105">         loadedFolder = GetLoadedMsgFolder();</span>
<a href="#l125.106"></a><span id="l125.106">         return (loadedFolder &amp;&amp; loadedFolder.server.canHaveFilters);</span>
<a href="#l125.107"></a><span id="l125.107">       case &quot;cmd_delete&quot;:</span>
<a href="#l125.108"></a><span id="l125.108" class="difflineat">@@ -664,19 +701,23 @@ var MessageWindowController =</span>
<a href="#l125.109"></a><span id="l125.109">       case &quot;button_shiftDelete&quot;:</span>
<a href="#l125.110"></a><span id="l125.110">         loadedFolder = GetLoadedMsgFolder();</span>
<a href="#l125.111"></a><span id="l125.111">         return gCurrentMessageUri &amp;&amp; loadedFolder &amp;&amp; (loadedFolder.canDeleteMessages || isNewsURI(gCurrentFolderUri));</span>
<a href="#l125.112"></a><span id="l125.112">       case &quot;button_junk&quot;:</span>
<a href="#l125.113"></a><span id="l125.113">         UpdateJunkToolbarButton();</span>
<a href="#l125.114"></a><span id="l125.114">         // fall through</span>
<a href="#l125.115"></a><span id="l125.115">       case &quot;cmd_markAsJunk&quot;:</span>
<a href="#l125.116"></a><span id="l125.116"> 			case &quot;cmd_markAsNotJunk&quot;:</span>
<a href="#l125.117"></a><span id="l125.117" class="difflineplus">+        if (gDBView)</span>
<a href="#l125.118"></a><span id="l125.118" class="difflineplus">+          gDBView.getCommandStatus(nsMsgViewCommandType.junk, enabled, checkStatus);</span>
<a href="#l125.119"></a><span id="l125.119" class="difflineplus">+        return enabled.value;</span>
<a href="#l125.120"></a><span id="l125.120">       case &quot;cmd_recalculateJunkScore&quot;:</span>
<a href="#l125.121"></a><span id="l125.121" class="difflineminus">-        // can't do junk on news yet</span>
<a href="#l125.122"></a><span id="l125.122" class="difflineminus">-        return (!isNewsURI(gCurrentFolderUri));</span>
<a href="#l125.123"></a><span id="l125.123" class="difflineplus">+        if (GetNumSelectedMessages() &gt; 0 &amp;&amp; gDBView)</span>
<a href="#l125.124"></a><span id="l125.124" class="difflineplus">+          gDBView.getCommandStatus(nsMsgViewCommandType.runJunkControls, enabled, checkStatus);</span>
<a href="#l125.125"></a><span id="l125.125" class="difflineplus">+        return enabled.value;</span>
<a href="#l125.126"></a><span id="l125.126"> 			case &quot;cmd_reply&quot;:</span>
<a href="#l125.127"></a><span id="l125.127"> 			case &quot;button_reply&quot;:</span>
<a href="#l125.128"></a><span id="l125.128"> 			case &quot;cmd_replySender&quot;:</span>
<a href="#l125.129"></a><span id="l125.129"> 			case &quot;cmd_replyGroup&quot;:</span>
<a href="#l125.130"></a><span id="l125.130"> 			case &quot;cmd_replyall&quot;:</span>
<a href="#l125.131"></a><span id="l125.131"> 			case &quot;button_replyall&quot;:</span>
<a href="#l125.132"></a><span id="l125.132">       case &quot;cmd_replySenderAndGroup&quot;:</span>
<a href="#l125.133"></a><span id="l125.133">       case &quot;cmd_replyAllRecipients&quot;:</span>
<a href="#l125.134"></a><span id="l125.134" class="difflineat">@@ -739,16 +780,18 @@ var MessageWindowController =</span>
<a href="#l125.135"></a><span id="l125.135">       case &quot;button_goBack&quot;:</span>
<a href="#l125.136"></a><span id="l125.136">         return gDBView &amp;&amp; gDBView.navigateStatus(nsMsgNavigationType.back);</span>
<a href="#l125.137"></a><span id="l125.137">       case &quot;cmd_goForward&quot;:</span>
<a href="#l125.138"></a><span id="l125.138">       case &quot;button_goForward&quot;:</span>
<a href="#l125.139"></a><span id="l125.139">         return gDBView &amp;&amp; gDBView.navigateStatus(nsMsgNavigationType.forward);</span>
<a href="#l125.140"></a><span id="l125.140">       case &quot;cmd_search&quot;:</span>
<a href="#l125.141"></a><span id="l125.141">         loadedFolder = GetLoadedMsgFolder();</span>
<a href="#l125.142"></a><span id="l125.142">         return (loadedFolder &amp;&amp; loadedFolder.server.canSearchMessages);</span>
<a href="#l125.143"></a><span id="l125.143" class="difflineplus">+      case &quot;cmd_stop&quot;:</span>
<a href="#l125.144"></a><span id="l125.144" class="difflineplus">+        return true;</span>
<a href="#l125.145"></a><span id="l125.145">       case &quot;cmd_undo&quot;:</span>
<a href="#l125.146"></a><span id="l125.146">       case &quot;cmd_redo&quot;:</span>
<a href="#l125.147"></a><span id="l125.147">         return SetupUndoRedoCommand(command);</span>
<a href="#l125.148"></a><span id="l125.148">       case &quot;cmd_applyFilters&quot;:</span>
<a href="#l125.149"></a><span id="l125.149">       case &quot;cmd_runJunkControls&quot;:</span>
<a href="#l125.150"></a><span id="l125.150">       case &quot;cmd_deleteJunk&quot;:</span>
<a href="#l125.151"></a><span id="l125.151">         return false;</span>
<a href="#l125.152"></a><span id="l125.152"> 			default:</span>
<a href="#l125.153"></a><span id="l125.153" class="difflineat">@@ -827,16 +870,19 @@ var MessageWindowController =</span>
<a href="#l125.154"></a><span id="l125.154">         break;</span>
<a href="#l125.155"></a><span id="l125.155">       case &quot;cmd_shiftDelete&quot;:</span>
<a href="#l125.156"></a><span id="l125.156">       case &quot;button_shiftDelete&quot;:</span>
<a href="#l125.157"></a><span id="l125.157">         MsgDeleteMessage(true);</span>
<a href="#l125.158"></a><span id="l125.158">         break;</span>
<a href="#l125.159"></a><span id="l125.159">       case &quot;button_junk&quot;:</span>
<a href="#l125.160"></a><span id="l125.160">         MsgJunk();</span>
<a href="#l125.161"></a><span id="l125.161">         break;</span>
<a href="#l125.162"></a><span id="l125.162" class="difflineplus">+      case &quot;cmd_stop&quot;:</span>
<a href="#l125.163"></a><span id="l125.163" class="difflineplus">+        MsgStop();</span>
<a href="#l125.164"></a><span id="l125.164" class="difflineplus">+        break;</span>
<a href="#l125.165"></a><span id="l125.165">       case &quot;cmd_printSetup&quot;:</span>
<a href="#l125.166"></a><span id="l125.166">         PrintUtils.showPageSetup();</span>
<a href="#l125.167"></a><span id="l125.167">         break;</span>
<a href="#l125.168"></a><span id="l125.168"> 			case &quot;cmd_print&quot;:</span>
<a href="#l125.169"></a><span id="l125.169"> 				PrintEnginePrint();</span>
<a href="#l125.170"></a><span id="l125.170"> 				break;</span>
<a href="#l125.171"></a><span id="l125.171"> 			case &quot;cmd_printpreview&quot;:</span>
<a href="#l125.172"></a><span id="l125.172"> 				PrintEnginePrintPreview();</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l126.1"></a><span id="l126.1" class="difflineminus">--- a/suite/mailnews/msgMail3PaneWindow.js</span>
<a href="#l126.2"></a><span id="l126.2" class="difflineplus">+++ b/suite/mailnews/msgMail3PaneWindow.js</span>
<a href="#l126.3"></a><span id="l126.3" class="difflineat">@@ -764,21 +764,55 @@ function OnLoadMessenger()</span>
<a href="#l126.4"></a><span id="l126.4">   //Set focus to the Thread Pane the first time the window is opened.</span>
<a href="#l126.5"></a><span id="l126.5">   SetFocusThreadPane();</span>
<a href="#l126.6"></a><span id="l126.6"> </span>
<a href="#l126.7"></a><span id="l126.7">   // Before and after callbacks for the customizeToolbar code</span>
<a href="#l126.8"></a><span id="l126.8">   var mailToolbox = getMailToolbox();</span>
<a href="#l126.9"></a><span id="l126.9">   mailToolbox.customizeInit = MailToolboxCustomizeInit;</span>
<a href="#l126.10"></a><span id="l126.10">   mailToolbox.customizeDone = MailToolboxCustomizeDone;</span>
<a href="#l126.11"></a><span id="l126.11">   mailToolbox.customizeChange = MailToolboxCustomizeChange;</span>
<a href="#l126.12"></a><span id="l126.12" class="difflineplus">+</span>
<a href="#l126.13"></a><span id="l126.13" class="difflineplus">+  window.addEventListener(&quot;AppCommand&quot;, HandleAppCommandEvent, true);</span>
<a href="#l126.14"></a><span id="l126.14" class="difflineplus">+}</span>
<a href="#l126.15"></a><span id="l126.15" class="difflineplus">+</span>
<a href="#l126.16"></a><span id="l126.16" class="difflineplus">+function HandleAppCommandEvent(evt)</span>
<a href="#l126.17"></a><span id="l126.17" class="difflineplus">+{</span>
<a href="#l126.18"></a><span id="l126.18" class="difflineplus">+  evt.stopPropagation();</span>
<a href="#l126.19"></a><span id="l126.19" class="difflineplus">+  switch (evt.command)</span>
<a href="#l126.20"></a><span id="l126.20" class="difflineplus">+  {</span>
<a href="#l126.21"></a><span id="l126.21" class="difflineplus">+    case &quot;Back&quot;:</span>
<a href="#l126.22"></a><span id="l126.22" class="difflineplus">+      goDoCommand('cmd_goBack');</span>
<a href="#l126.23"></a><span id="l126.23" class="difflineplus">+      break;</span>
<a href="#l126.24"></a><span id="l126.24" class="difflineplus">+    case &quot;Forward&quot;:</span>
<a href="#l126.25"></a><span id="l126.25" class="difflineplus">+      goDoCommand('cmd_goForward');</span>
<a href="#l126.26"></a><span id="l126.26" class="difflineplus">+      break;</span>
<a href="#l126.27"></a><span id="l126.27" class="difflineplus">+    case &quot;Stop&quot;:</span>
<a href="#l126.28"></a><span id="l126.28" class="difflineplus">+      goDoCommand('cmd_stop');</span>
<a href="#l126.29"></a><span id="l126.29" class="difflineplus">+      break;</span>
<a href="#l126.30"></a><span id="l126.30" class="difflineplus">+    case &quot;Search&quot;:</span>
<a href="#l126.31"></a><span id="l126.31" class="difflineplus">+      goDoCommand('cmd_search');</span>
<a href="#l126.32"></a><span id="l126.32" class="difflineplus">+      break;</span>
<a href="#l126.33"></a><span id="l126.33" class="difflineplus">+    case &quot;Bookmarks&quot;:</span>
<a href="#l126.34"></a><span id="l126.34" class="difflineplus">+      toAddressBook();</span>
<a href="#l126.35"></a><span id="l126.35" class="difflineplus">+      break;</span>
<a href="#l126.36"></a><span id="l126.36" class="difflineplus">+    case &quot;Reload&quot;:</span>
<a href="#l126.37"></a><span id="l126.37" class="difflineplus">+      goDoCommand('cmd_reload');</span>
<a href="#l126.38"></a><span id="l126.38" class="difflineplus">+      break;</span>
<a href="#l126.39"></a><span id="l126.39" class="difflineplus">+    case &quot;Home&quot;:</span>
<a href="#l126.40"></a><span id="l126.40" class="difflineplus">+      goDoCommand('cmd_goStartPage');</span>
<a href="#l126.41"></a><span id="l126.41" class="difflineplus">+      break;</span>
<a href="#l126.42"></a><span id="l126.42" class="difflineplus">+    default:</span>
<a href="#l126.43"></a><span id="l126.43" class="difflineplus">+      break;</span>
<a href="#l126.44"></a><span id="l126.44" class="difflineplus">+  }</span>
<a href="#l126.45"></a><span id="l126.45"> }</span>
<a href="#l126.46"></a><span id="l126.46"> </span>
<a href="#l126.47"></a><span id="l126.47"> function OnUnloadMessenger()</span>
<a href="#l126.48"></a><span id="l126.48"> {</span>
<a href="#l126.49"></a><span id="l126.49">   pref.removeObserver(&quot;mail.pane_config.dynamic&quot;, MailPaneConfigObserver, false);</span>
<a href="#l126.50"></a><span id="l126.50" class="difflineplus">+  window.removeEventListener(&quot;AppCommand&quot;, HandleAppCommandEvent, true);</span>
<a href="#l126.51"></a><span id="l126.51"> </span>
<a href="#l126.52"></a><span id="l126.52">   OnLeavingFolder(gMsgFolderSelected);  // mark all read in current folder</span>
<a href="#l126.53"></a><span id="l126.53">   accountManager.removeIncomingServerListener(gThreePaneIncomingServerListener);</span>
<a href="#l126.54"></a><span id="l126.54">   GetTabMail().closeTabs();</span>
<a href="#l126.55"></a><span id="l126.55"> </span>
<a href="#l126.56"></a><span id="l126.56">   // FIX ME - later we will be able to use onload from the overlay</span>
<a href="#l126.57"></a><span id="l126.57">   OnUnloadMsgHeaderPane();</span>
<a href="#l126.58"></a><span id="l126.58">   UnloadPanes();</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l127.1"></a><span id="l127.1" class="difflineminus">--- a/suite/mailnews/prefs/mailPrefsOverlay.xul</span>
<a href="#l127.2"></a><span id="l127.2" class="difflineplus">+++ b/suite/mailnews/prefs/mailPrefsOverlay.xul</span>
<a href="#l127.3"></a><span id="l127.3" class="difflineat">@@ -12,32 +12,20 @@</span>
<a href="#l127.4"></a><span id="l127.4">     &lt;preference id=&quot;general.startup.mail&quot;</span>
<a href="#l127.5"></a><span id="l127.5">                 name=&quot;general.startup.mail&quot;</span>
<a href="#l127.6"></a><span id="l127.6">                 type=&quot;bool&quot;/&gt;</span>
<a href="#l127.7"></a><span id="l127.7">     &lt;preference id=&quot;general.startup.addressbook&quot;</span>
<a href="#l127.8"></a><span id="l127.8">                 name=&quot;general.startup.addressbook&quot;</span>
<a href="#l127.9"></a><span id="l127.9">                 type=&quot;bool&quot;/&gt;</span>
<a href="#l127.10"></a><span id="l127.10">   &lt;/preferences&gt;</span>
<a href="#l127.11"></a><span id="l127.11">   &lt;preferences id=&quot;scripts_preferences&quot;&gt;</span>
<a href="#l127.12"></a><span id="l127.12" class="difflineminus">-    &lt;preference id=&quot;javascript.allow.mailnews&quot;</span>
<a href="#l127.13"></a><span id="l127.13" class="difflineminus">-                name=&quot;javascript.allow.mailnews&quot;</span>
<a href="#l127.14"></a><span id="l127.14" class="difflineminus">-                type=&quot;bool&quot;</span>
<a href="#l127.15"></a><span id="l127.15" class="difflineminus">-                onchange=&quot;javascriptEnabledChange();&quot;/&gt;</span>
<a href="#l127.16"></a><span id="l127.16">     &lt;preference id=&quot;mailnews.message_display.allow.plugins&quot;</span>
<a href="#l127.17"></a><span id="l127.17">                 name=&quot;mailnews.message_display.allow.plugins&quot;</span>
<a href="#l127.18"></a><span id="l127.18">                 type=&quot;bool&quot;/&gt;</span>
<a href="#l127.19"></a><span id="l127.19">   &lt;/preferences&gt;</span>
<a href="#l127.20"></a><span id="l127.20" class="difflineminus">-  &lt;!-- javascript toggle for mail/news --&gt;</span>
<a href="#l127.21"></a><span id="l127.21" class="difflineminus">-  &lt;groupbox id=&quot;javascriptPreferences&quot;&gt;</span>
<a href="#l127.22"></a><span id="l127.22" class="difflineminus">-    &lt;checkbox id=&quot;javascriptAllowMailNews&quot;</span>
<a href="#l127.23"></a><span id="l127.23" class="difflineminus">-              insertafter=&quot;javascriptAllowNavigator&quot;</span>
<a href="#l127.24"></a><span id="l127.24" class="difflineminus">-              label=&quot;&amp;enbJsCheckMailNews.label;&quot;</span>
<a href="#l127.25"></a><span id="l127.25" class="difflineminus">-              accesskey=&quot;&amp;enbJsCheckMailNews.accesskey;&quot;</span>
<a href="#l127.26"></a><span id="l127.26" class="difflineminus">-              preference=&quot;javascript.allow.mailnews&quot;/&gt;</span>
<a href="#l127.27"></a><span id="l127.27" class="difflineminus">-  &lt;/groupbox&gt;</span>
<a href="#l127.28"></a><span id="l127.28">   &lt;!-- plugin toggle for mail/news --&gt;</span>
<a href="#l127.29"></a><span id="l127.29">   &lt;groupbox id=&quot;pluginPreferences&quot; hidden=&quot;false&quot;&gt;</span>
<a href="#l127.30"></a><span id="l127.30">     &lt;checkbox id=&quot;pluginAllowMailNews&quot;</span>
<a href="#l127.31"></a><span id="l127.31">               label=&quot;&amp;enbPluginCheckMailNews.label;&quot;</span>
<a href="#l127.32"></a><span id="l127.32">               accesskey=&quot;&amp;enbPluginCheckMailNews.accesskey;&quot;</span>
<a href="#l127.33"></a><span id="l127.33">               preference=&quot;mailnews.message_display.allow.plugins&quot;/&gt;</span>
<a href="#l127.34"></a><span id="l127.34">   &lt;/groupbox&gt;</span>
<a href="#l127.35"></a><span id="l127.35"> </span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l128.1"></a><span id="l128.1" class="difflineminus">--- a/suite/profile/migration/src/nsSeamonkeyProfileMigrator.cpp</span>
<a href="#l128.2"></a><span id="l128.2" class="difflineplus">+++ b/suite/profile/migration/src/nsSeamonkeyProfileMigrator.cpp</span>
<a href="#l128.3"></a><span id="l128.3" class="difflineat">@@ -334,17 +334,16 @@ nsSeamonkeyProfileMigrator::PrefTransfor</span>
<a href="#l128.4"></a><span id="l128.4"> </span>
<a href="#l128.5"></a><span id="l128.5">   MAKESAMETYPEPREFTRANSFORM(&quot;image.animation_mode&quot;,                    String),</span>
<a href="#l128.6"></a><span id="l128.6"> </span>
<a href="#l128.7"></a><span id="l128.7">   MAKESAMETYPEPREFTRANSFORM(&quot;intl.accept_charsets&quot;,                    String),</span>
<a href="#l128.8"></a><span id="l128.8">   MAKESAMETYPEPREFTRANSFORM(&quot;intl.accept_languages&quot;,                   String),</span>
<a href="#l128.9"></a><span id="l128.9">   MAKESAMETYPEPREFTRANSFORM(&quot;intl.charset.default&quot;,                    String),</span>
<a href="#l128.10"></a><span id="l128.10">   MAKESAMETYPEPREFTRANSFORM(&quot;intl.charsetmenu.browser.static&quot;,         String),</span>
<a href="#l128.11"></a><span id="l128.11"> </span>
<a href="#l128.12"></a><span id="l128.12" class="difflineminus">-  MAKESAMETYPEPREFTRANSFORM(&quot;javascript.allow.mailnews&quot;,               Bool),</span>
<a href="#l128.13"></a><span id="l128.13">   MAKESAMETYPEPREFTRANSFORM(&quot;javascript.enabled&quot;,                      Bool),</span>
<a href="#l128.14"></a><span id="l128.14">   MAKESAMETYPEPREFTRANSFORM(&quot;javascript.options.relimit&quot;,              Bool),</span>
<a href="#l128.15"></a><span id="l128.15">   MAKESAMETYPEPREFTRANSFORM(&quot;javascript.options.showInConsole&quot;,        Bool),</span>
<a href="#l128.16"></a><span id="l128.16">   MAKESAMETYPEPREFTRANSFORM(&quot;javascript.options.strict&quot;,               Bool),</span>
<a href="#l128.17"></a><span id="l128.17"> </span>
<a href="#l128.18"></a><span id="l128.18">   MAKESAMETYPEPREFTRANSFORM(&quot;keyword.URL&quot;,                             String),</span>
<a href="#l128.19"></a><span id="l128.19">   MAKESAMETYPEPREFTRANSFORM(&quot;keyword.enabled&quot;,                         Bool),</span>
<a href="#l128.20"></a><span id="l128.20"> </span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l129.1"></a><span id="l129.1" class="difflineminus">--- a/suite/profile/migration/src/nsThunderbirdProfileMigrator.cpp</span>
<a href="#l129.2"></a><span id="l129.2" class="difflineplus">+++ b/suite/profile/migration/src/nsThunderbirdProfileMigrator.cpp</span>
<a href="#l129.3"></a><span id="l129.3" class="difflineat">@@ -311,17 +311,16 @@ nsThunderbirdProfileMigrator::PrefTransf</span>
<a href="#l129.4"></a><span id="l129.4">   MAKESAMETYPEPREFTRANSFORM(&quot;extensions.spellcheck.inline.max-misspellings&quot;,Int),</span>
<a href="#l129.5"></a><span id="l129.5"> </span>
<a href="#l129.6"></a><span id="l129.6">   MAKESAMETYPEPREFTRANSFORM(&quot;general.warnOnAboutConfig&quot;,               Bool),</span>
<a href="#l129.7"></a><span id="l129.7"> </span>
<a href="#l129.8"></a><span id="l129.8">   MAKESAMETYPEPREFTRANSFORM(&quot;intl.accept_charsets&quot;,                    String),</span>
<a href="#l129.9"></a><span id="l129.9">   MAKESAMETYPEPREFTRANSFORM(&quot;intl.accept_languages&quot;,                   String),</span>
<a href="#l129.10"></a><span id="l129.10">   MAKESAMETYPEPREFTRANSFORM(&quot;intl.charset.default&quot;,                    String),</span>
<a href="#l129.11"></a><span id="l129.11"> </span>
<a href="#l129.12"></a><span id="l129.12" class="difflineminus">-  MAKESAMETYPEPREFTRANSFORM(&quot;javascript.allow.mailnews&quot;,               Bool),</span>
<a href="#l129.13"></a><span id="l129.13">   MAKESAMETYPEPREFTRANSFORM(&quot;javascript.enabled&quot;,                      Bool),</span>
<a href="#l129.14"></a><span id="l129.14">   MAKESAMETYPEPREFTRANSFORM(&quot;javascript.options.relimit&quot;,              Bool),</span>
<a href="#l129.15"></a><span id="l129.15">   MAKESAMETYPEPREFTRANSFORM(&quot;javascript.options.showInConsole&quot;,        Bool),</span>
<a href="#l129.16"></a><span id="l129.16">   MAKESAMETYPEPREFTRANSFORM(&quot;javascript.options.strict&quot;,               Bool),</span>
<a href="#l129.17"></a><span id="l129.17"> </span>
<a href="#l129.18"></a><span id="l129.18">   MAKESAMETYPEPREFTRANSFORM(&quot;layout.spellcheckDefault&quot;,                Int),</span>
<a href="#l129.19"></a><span id="l129.19"> </span>
<a href="#l129.20"></a><span id="l129.20">   MAKESAMETYPEPREFTRANSFORM(&quot;mail.accountmanager.accounts&quot;,            String),</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l130.1"></a><span id="l130.1" class="difflineminus">--- a/suite/themes/classic/messenger/dialogs.css</span>
<a href="#l130.2"></a><span id="l130.2" class="difflineplus">+++ b/suite/themes/classic/messenger/dialogs.css</span>
<a href="#l130.3"></a><span id="l130.3" class="difflineat">@@ -63,31 +63,8 @@ menu.push[open=&quot;true&quot;] {</span>
<a href="#l130.4"></a><span id="l130.4"> }</span>
<a href="#l130.5"></a><span id="l130.5"> </span>
<a href="#l130.6"></a><span id="l130.6"> menu.push[disabled=&quot;true&quot;],</span>
<a href="#l130.7"></a><span id="l130.7"> menu.push[disabled=&quot;true&quot;]:hover,</span>
<a href="#l130.8"></a><span id="l130.8"> menu.push[disabled=&quot;true&quot;]:hover:active {</span>
<a href="#l130.9"></a><span id="l130.9">   color: GrayText;</span>
<a href="#l130.10"></a><span id="l130.10"> }</span>
<a href="#l130.11"></a><span id="l130.11"> </span>
<a href="#l130.12"></a><span id="l130.12" class="difflineminus">-/* ::::: askSendFormat.xul ::::: */</span>
<a href="#l130.13"></a><span id="l130.13" class="difflineminus">-</span>
<a href="#l130.14"></a><span id="l130.14" class="difflineminus">-#askSendFormat {</span>
<a href="#l130.15"></a><span id="l130.15" class="difflineminus">-  width: 40em;</span>
<a href="#l130.16"></a><span id="l130.16" class="difflineminus">-}</span>
<a href="#l130.17"></a><span id="l130.17" class="difflineminus">-</span>
<a href="#l130.18"></a><span id="l130.18" class="difflineminus">-#askImageBox {</span>
<a href="#l130.19"></a><span id="l130.19" class="difflineminus">- -moz-box-align: start;</span>
<a href="#l130.20"></a><span id="l130.20" class="difflineminus">-}</span>
<a href="#l130.21"></a><span id="l130.21" class="difflineminus">-</span>
<a href="#l130.22"></a><span id="l130.22" class="difflineminus">-#convertYes,</span>
<a href="#l130.23"></a><span id="l130.23" class="difflineminus">-#convertAltering {</span>
<a href="#l130.24"></a><span id="l130.24" class="difflineminus">-  list-style-image:url(&quot;chrome://global/skin/icons/alert-question.gif&quot;);</span>
<a href="#l130.25"></a><span id="l130.25" class="difflineminus">-}</span>
<a href="#l130.26"></a><span id="l130.26" class="difflineminus">-</span>
<a href="#l130.27"></a><span id="l130.27" class="difflineminus">-#convertNo {</span>
<a href="#l130.28"></a><span id="l130.28" class="difflineminus">-  list-style-image:url(&quot;chrome://global/skin/icons/alert-exclam.gif&quot;);</span>
<a href="#l130.29"></a><span id="l130.29" class="difflineminus">-}</span>
<a href="#l130.30"></a><span id="l130.30" class="difflineminus">-</span>
<a href="#l130.31"></a><span id="l130.31" class="difflineminus">-/* Workaround for bug 50217. Please remove this rule, when this bug is fixed. */</span>
<a href="#l130.32"></a><span id="l130.32" class="difflineminus">-#convertDefault {</span>
<a href="#l130.33"></a><span id="l130.33" class="difflineminus">-  list-style-image:url(&quot;chrome://global/skin/icons/alert-question.gif&quot;);</span>
<a href="#l130.34"></a><span id="l130.34" class="difflineminus">-}</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l131.1"></a><span id="l131.1" class="difflineminus">--- a/suite/themes/classic/messenger/primaryToolbar.css</span>
<a href="#l131.2"></a><span id="l131.2" class="difflineplus">+++ b/suite/themes/classic/messenger/primaryToolbar.css</span>
<a href="#l131.3"></a><span id="l131.3" class="difflineat">@@ -284,102 +284,108 @@ toolbarpaletteitem &gt; #button-delete {</span>
<a href="#l131.4"></a><span id="l131.4"> }</span>
<a href="#l131.5"></a><span id="l131.5"> </span>
<a href="#l131.6"></a><span id="l131.6"> #button-stop[disabled=&quot;true&quot;] {</span>
<a href="#l131.7"></a><span id="l131.7">   -moz-image-region: rect(30px 119px 59px 90px) !important;</span>
<a href="#l131.8"></a><span id="l131.8"> }</span>
<a href="#l131.9"></a><span id="l131.9"> </span>
<a href="#l131.10"></a><span id="l131.10"> /* ::::: small primary toolbar buttons ::::: */</span>
<a href="#l131.11"></a><span id="l131.11"> </span>
<a href="#l131.12"></a><span id="l131.12" class="difflineminus">-toolbar[iconsize=&quot;small&quot;] &gt; #button-getmsg {</span>
<a href="#l131.13"></a><span id="l131.13" class="difflineplus">+toolbar[iconsize=&quot;small&quot;] &gt; #button-getmsg,</span>
<a href="#l131.14"></a><span id="l131.14" class="difflineplus">+toolbar[iconsize=&quot;small&quot;] &gt; toolbarpaletteitem &gt; #button-getmsg {</span>
<a href="#l131.15"></a><span id="l131.15">   list-style-image: url(&quot;chrome://messenger/skin/icons/messengericons-small.png&quot;);</span>
<a href="#l131.16"></a><span id="l131.16">   -moz-image-region: rect(60px 19px 79px 0);</span>
<a href="#l131.17"></a><span id="l131.17"> }</span>
<a href="#l131.18"></a><span id="l131.18"> </span>
<a href="#l131.19"></a><span id="l131.19"> toolbar[iconsize=&quot;small&quot;] &gt; #button-getmsg:hover {</span>
<a href="#l131.20"></a><span id="l131.20">   -moz-image-region: rect(60px 39px 79px 20px);</span>
<a href="#l131.21"></a><span id="l131.21"> }</span>
<a href="#l131.22"></a><span id="l131.22"> </span>
<a href="#l131.23"></a><span id="l131.23"> toolbar[iconsize=&quot;small&quot;] &gt; #button-getmsg:hover:active {</span>
<a href="#l131.24"></a><span id="l131.24">   -moz-image-region: rect(60px 59px 79px 40px);</span>
<a href="#l131.25"></a><span id="l131.25"> }</span>
<a href="#l131.26"></a><span id="l131.26"> </span>
<a href="#l131.27"></a><span id="l131.27"> toolbar[iconsize=&quot;small&quot;] &gt; #button-getmsg[disabled] {</span>
<a href="#l131.28"></a><span id="l131.28">   -moz-image-region: rect(60px 79px 79px 60px) !important;</span>
<a href="#l131.29"></a><span id="l131.29"> }</span>
<a href="#l131.30"></a><span id="l131.30"> </span>
<a href="#l131.31"></a><span id="l131.31" class="difflineminus">-toolbar[iconsize=&quot;small&quot;] &gt; #button-newmsg {</span>
<a href="#l131.32"></a><span id="l131.32" class="difflineplus">+toolbar[iconsize=&quot;small&quot;] &gt; #button-newmsg,</span>
<a href="#l131.33"></a><span id="l131.33" class="difflineplus">+toolbar[iconsize=&quot;small&quot;] &gt; toolbarpaletteitem &gt; #button-newmsg {</span>
<a href="#l131.34"></a><span id="l131.34">   list-style-image: url(&quot;chrome://messenger/skin/icons/messengericons-small.png&quot;);</span>
<a href="#l131.35"></a><span id="l131.35">   -moz-image-region: rect(100px 19px 119px 0);</span>
<a href="#l131.36"></a><span id="l131.36"> }</span>
<a href="#l131.37"></a><span id="l131.37"> </span>
<a href="#l131.38"></a><span id="l131.38"> toolbar[iconsize=&quot;small&quot;] &gt; #button-newmsg:hover {</span>
<a href="#l131.39"></a><span id="l131.39">   -moz-image-region: rect(100px 39px 119px 20px);</span>
<a href="#l131.40"></a><span id="l131.40"> }</span>
<a href="#l131.41"></a><span id="l131.41"> </span>
<a href="#l131.42"></a><span id="l131.42"> toolbar[iconsize=&quot;small&quot;] &gt; #button-newmsg:hover:active {</span>
<a href="#l131.43"></a><span id="l131.43">   -moz-image-region: rect(100px 59px 119px 40px);</span>
<a href="#l131.44"></a><span id="l131.44"> }</span>
<a href="#l131.45"></a><span id="l131.45"> </span>
<a href="#l131.46"></a><span id="l131.46"> toolbar[iconsize=&quot;small&quot;] &gt; #button-newmsg[disabled] {</span>
<a href="#l131.47"></a><span id="l131.47">   -moz-image-region: rect(100px 79px 119px 60px) !important;</span>
<a href="#l131.48"></a><span id="l131.48"> }</span>
<a href="#l131.49"></a><span id="l131.49"> </span>
<a href="#l131.50"></a><span id="l131.50" class="difflineminus">-toolbar[iconsize=&quot;small&quot;] &gt; #button-reply {</span>
<a href="#l131.51"></a><span id="l131.51" class="difflineplus">+toolbar[iconsize=&quot;small&quot;] &gt; #button-reply,</span>
<a href="#l131.52"></a><span id="l131.52" class="difflineplus">+toolbar[iconsize=&quot;small&quot;] &gt; toolbarpaletteitem &gt; #button-reply {</span>
<a href="#l131.53"></a><span id="l131.53">   list-style-image: url(&quot;chrome://messenger/skin/icons/messengericons-small.png&quot;);</span>
<a href="#l131.54"></a><span id="l131.54">   -moz-image-region: rect(140px 19px 159px 0);</span>
<a href="#l131.55"></a><span id="l131.55"> }</span>
<a href="#l131.56"></a><span id="l131.56"> </span>
<a href="#l131.57"></a><span id="l131.57"> toolbar[iconsize=&quot;small&quot;] &gt; #button-reply:hover {</span>
<a href="#l131.58"></a><span id="l131.58">   -moz-image-region: rect(140px 39px 159px 20px);</span>
<a href="#l131.59"></a><span id="l131.59"> }</span>
<a href="#l131.60"></a><span id="l131.60"> </span>
<a href="#l131.61"></a><span id="l131.61"> toolbar[iconsize=&quot;small&quot;] &gt; #button-reply:hover:active {</span>
<a href="#l131.62"></a><span id="l131.62">   -moz-image-region: rect(140px 59px 159px 40px);</span>
<a href="#l131.63"></a><span id="l131.63"> }</span>
<a href="#l131.64"></a><span id="l131.64"> </span>
<a href="#l131.65"></a><span id="l131.65"> toolbar[iconsize=&quot;small&quot;] &gt; #button-reply[disabled] {</span>
<a href="#l131.66"></a><span id="l131.66">   -moz-image-region: rect(140px 79px 159px 60px) !important;</span>
<a href="#l131.67"></a><span id="l131.67"> }</span>
<a href="#l131.68"></a><span id="l131.68"> </span>
<a href="#l131.69"></a><span id="l131.69" class="difflineminus">-toolbar[iconsize=&quot;small&quot;] &gt; #button-replyall {</span>
<a href="#l131.70"></a><span id="l131.70" class="difflineplus">+toolbar[iconsize=&quot;small&quot;] &gt; #button-replyall,</span>
<a href="#l131.71"></a><span id="l131.71" class="difflineplus">+toolbar[iconsize=&quot;small&quot;] &gt; toolbarpaletteitem &gt; #button-replyall {</span>
<a href="#l131.72"></a><span id="l131.72">   list-style-image: url(&quot;chrome://messenger/skin/icons/messengericons-small.png&quot;);</span>
<a href="#l131.73"></a><span id="l131.73">   -moz-image-region: rect(160px 19px 179px 0);</span>
<a href="#l131.74"></a><span id="l131.74"> }</span>
<a href="#l131.75"></a><span id="l131.75"> </span>
<a href="#l131.76"></a><span id="l131.76"> toolbar[iconsize=&quot;small&quot;] &gt; #button-replyall:hover {</span>
<a href="#l131.77"></a><span id="l131.77">   -moz-image-region: rect(160px 39px 179px 20px);</span>
<a href="#l131.78"></a><span id="l131.78"> }</span>
<a href="#l131.79"></a><span id="l131.79"> </span>
<a href="#l131.80"></a><span id="l131.80"> toolbar[iconsize=&quot;small&quot;] &gt; #button-replyall:hover:active {</span>
<a href="#l131.81"></a><span id="l131.81">   -moz-image-region: rect(160px 59px 179px 40px);</span>
<a href="#l131.82"></a><span id="l131.82"> }</span>
<a href="#l131.83"></a><span id="l131.83"> </span>
<a href="#l131.84"></a><span id="l131.84"> toolbar[iconsize=&quot;small&quot;] &gt; #button-replyall[disabled] {</span>
<a href="#l131.85"></a><span id="l131.85">   -moz-image-region: rect(160px 79px 179px 60px) !important;</span>
<a href="#l131.86"></a><span id="l131.86"> }</span>
<a href="#l131.87"></a><span id="l131.87"> </span>
<a href="#l131.88"></a><span id="l131.88" class="difflineminus">-toolbar[iconsize=&quot;small&quot;] &gt; #button-forward {</span>
<a href="#l131.89"></a><span id="l131.89" class="difflineplus">+toolbar[iconsize=&quot;small&quot;] &gt; #button-forward,</span>
<a href="#l131.90"></a><span id="l131.90" class="difflineplus">+toolbar[iconsize=&quot;small&quot;] &gt; toolbarpaletteitem &gt; #button-forward {</span>
<a href="#l131.91"></a><span id="l131.91">   list-style-image: url(&quot;chrome://messenger/skin/icons/messengericons-small.png&quot;);</span>
<a href="#l131.92"></a><span id="l131.92">   -moz-image-region: rect(40px 19px 59px 0);</span>
<a href="#l131.93"></a><span id="l131.93"> }</span>
<a href="#l131.94"></a><span id="l131.94"> </span>
<a href="#l131.95"></a><span id="l131.95"> toolbar[iconsize=&quot;small&quot;] &gt; #button-forward:hover {</span>
<a href="#l131.96"></a><span id="l131.96">   -moz-image-region: rect(40px 39px 59px 20px);</span>
<a href="#l131.97"></a><span id="l131.97"> }</span>
<a href="#l131.98"></a><span id="l131.98"> </span>
<a href="#l131.99"></a><span id="l131.99"> toolbar[iconsize=&quot;small&quot;] &gt; #button-forward:hover:active {</span>
<a href="#l131.100"></a><span id="l131.100">   -moz-image-region: rect(40px 59px 59px 40px);</span>
<a href="#l131.101"></a><span id="l131.101"> }</span>
<a href="#l131.102"></a><span id="l131.102"> </span>
<a href="#l131.103"></a><span id="l131.103"> toolbar[iconsize=&quot;small&quot;] &gt; #button-forward[disabled] {</span>
<a href="#l131.104"></a><span id="l131.104">   -moz-image-region: rect(40px 79px 59px 60px) !important;</span>
<a href="#l131.105"></a><span id="l131.105"> }</span>
<a href="#l131.106"></a><span id="l131.106"> </span>
<a href="#l131.107"></a><span id="l131.107" class="difflineminus">-toolbar[iconsize=&quot;small&quot;] &gt; #button-file {</span>
<a href="#l131.108"></a><span id="l131.108" class="difflineplus">+toolbar[iconsize=&quot;small&quot;] &gt; #button-file,</span>
<a href="#l131.109"></a><span id="l131.109" class="difflineplus">+toolbar[iconsize=&quot;small&quot;] &gt; toolbarpaletteitem &gt; #button-file {</span>
<a href="#l131.110"></a><span id="l131.110">   list-style-image: url(&quot;chrome://messenger/skin/icons/messengericons-small.png&quot;);</span>
<a href="#l131.111"></a><span id="l131.111">   -moz-image-region: rect(20px 19px 39px 0);</span>
<a href="#l131.112"></a><span id="l131.112"> }</span>
<a href="#l131.113"></a><span id="l131.113"> </span>
<a href="#l131.114"></a><span id="l131.114"> toolbar[iconsize=&quot;small&quot;] &gt; #button-file:hover {</span>
<a href="#l131.115"></a><span id="l131.115">   -moz-image-region: rect(20px 39px 39px 20px);</span>
<a href="#l131.116"></a><span id="l131.116"> }</span>
<a href="#l131.117"></a><span id="l131.117"> </span>
<a href="#l131.118"></a><span id="l131.118" class="difflineat">@@ -387,136 +393,146 @@ toolbar[iconsize=&quot;small&quot;] &gt; #button-file</span>
<a href="#l131.119"></a><span id="l131.119"> toolbar[iconsize=&quot;small&quot;] &gt; #button-file[open] {</span>
<a href="#l131.120"></a><span id="l131.120">   -moz-image-region: rect(20px 59px 39px 40px);</span>
<a href="#l131.121"></a><span id="l131.121"> } </span>
<a href="#l131.122"></a><span id="l131.122"> </span>
<a href="#l131.123"></a><span id="l131.123"> toolbar[iconsize=&quot;small&quot;] &gt; #button-file[disabled] {</span>
<a href="#l131.124"></a><span id="l131.124">   -moz-image-region: rect(20px 79px 39px 60px) !important;</span>
<a href="#l131.125"></a><span id="l131.125"> }</span>
<a href="#l131.126"></a><span id="l131.126"> </span>
<a href="#l131.127"></a><span id="l131.127" class="difflineminus">-toolbar[iconsize=&quot;small&quot;] &gt; #button-goback {</span>
<a href="#l131.128"></a><span id="l131.128" class="difflineplus">+toolbar[iconsize=&quot;small&quot;] &gt; #button-goback,</span>
<a href="#l131.129"></a><span id="l131.129" class="difflineplus">+toolbar[iconsize=&quot;small&quot;] &gt; toolbarpaletteitem &gt; #button-goback {</span>
<a href="#l131.130"></a><span id="l131.130">   list-style-image: url(&quot;chrome://communicator/skin/icons/communicatoricons-small.png&quot;);</span>
<a href="#l131.131"></a><span id="l131.131">   -moz-image-region: rect(40px 19px 59px 0);</span>
<a href="#l131.132"></a><span id="l131.132"> }</span>
<a href="#l131.133"></a><span id="l131.133"> </span>
<a href="#l131.134"></a><span id="l131.134"> toolbar[iconsize=&quot;small&quot;] &gt; #button-goback:hover {</span>
<a href="#l131.135"></a><span id="l131.135">   -moz-image-region: rect(40px 39px 59px 20px);</span>
<a href="#l131.136"></a><span id="l131.136"> }</span>
<a href="#l131.137"></a><span id="l131.137"> </span>
<a href="#l131.138"></a><span id="l131.138"> toolbar[iconsize=&quot;small&quot;] &gt; #button-goback:hover:active {</span>
<a href="#l131.139"></a><span id="l131.139">   -moz-image-region: rect(40px 59px 59px 40px);</span>
<a href="#l131.140"></a><span id="l131.140"> }</span>
<a href="#l131.141"></a><span id="l131.141"> </span>
<a href="#l131.142"></a><span id="l131.142"> toolbar[iconsize=&quot;small&quot;] &gt; #button-goback[disabled=&quot;true&quot;] {</span>
<a href="#l131.143"></a><span id="l131.143">   -moz-image-region: rect(40px 79px 59px 60px) !important;</span>
<a href="#l131.144"></a><span id="l131.144"> }</span>
<a href="#l131.145"></a><span id="l131.145"> </span>
<a href="#l131.146"></a><span id="l131.146" class="difflineminus">-toolbar[iconsize=&quot;small&quot;] &gt; #button-goforward {</span>
<a href="#l131.147"></a><span id="l131.147" class="difflineplus">+toolbar[iconsize=&quot;small&quot;] &gt; #button-goforward,</span>
<a href="#l131.148"></a><span id="l131.148" class="difflineplus">+toolbar[iconsize=&quot;small&quot;] &gt; toolbarpaletteitem &gt; #button-goforward {</span>
<a href="#l131.149"></a><span id="l131.149">   list-style-image: url(&quot;chrome://communicator/skin/icons/communicatoricons-small.png&quot;);</span>
<a href="#l131.150"></a><span id="l131.150">   -moz-image-region: rect(60px 19px 79px 0);</span>
<a href="#l131.151"></a><span id="l131.151"> }</span>
<a href="#l131.152"></a><span id="l131.152"> </span>
<a href="#l131.153"></a><span id="l131.153"> toolbar[iconsize=&quot;small&quot;] &gt; #button-goforward:hover {</span>
<a href="#l131.154"></a><span id="l131.154">   -moz-image-region: rect(60px 39px 79px 20px);</span>
<a href="#l131.155"></a><span id="l131.155"> }</span>
<a href="#l131.156"></a><span id="l131.156"> </span>
<a href="#l131.157"></a><span id="l131.157"> toolbar[iconsize=&quot;small&quot;] &gt; #button-goforward:hover:active {</span>
<a href="#l131.158"></a><span id="l131.158">   -moz-image-region: rect(60px 59px 79px 40px);</span>
<a href="#l131.159"></a><span id="l131.159"> }</span>
<a href="#l131.160"></a><span id="l131.160"> </span>
<a href="#l131.161"></a><span id="l131.161"> toolbar[iconsize=&quot;small&quot;] &gt; #button-goforward[disabled=&quot;true&quot;] {</span>
<a href="#l131.162"></a><span id="l131.162">   -moz-image-region: rect(60px 79px 79px 60px) !important;</span>
<a href="#l131.163"></a><span id="l131.163"> }</span>
<a href="#l131.164"></a><span id="l131.164"> </span>
<a href="#l131.165"></a><span id="l131.165" class="difflineminus">-toolbar[iconsize=&quot;small&quot;] &gt; #button-next {</span>
<a href="#l131.166"></a><span id="l131.166" class="difflineplus">+toolbar[iconsize=&quot;small&quot;] &gt; #button-next,</span>
<a href="#l131.167"></a><span id="l131.167" class="difflineplus">+toolbar[iconsize=&quot;small&quot;] &gt; toolbarpaletteitem &gt; #button-next {</span>
<a href="#l131.168"></a><span id="l131.168">   list-style-image: url(&quot;chrome://messenger/skin/icons/messengericons-small.png&quot;);</span>
<a href="#l131.169"></a><span id="l131.169">   -moz-image-region: rect(120px 19px 139px 0);</span>
<a href="#l131.170"></a><span id="l131.170"> }</span>
<a href="#l131.171"></a><span id="l131.171"> </span>
<a href="#l131.172"></a><span id="l131.172"> toolbar[iconsize=&quot;small&quot;] &gt; #button-next:hover {</span>
<a href="#l131.173"></a><span id="l131.173">   -moz-image-region: rect(120px 39px 139px 20px);</span>
<a href="#l131.174"></a><span id="l131.174"> }</span>
<a href="#l131.175"></a><span id="l131.175"> </span>
<a href="#l131.176"></a><span id="l131.176"> toolbar[iconsize=&quot;small&quot;] &gt; #button-next:hover:active {</span>
<a href="#l131.177"></a><span id="l131.177">   -moz-image-region: rect(120px 59px 139px 40px);</span>
<a href="#l131.178"></a><span id="l131.178"> }</span>
<a href="#l131.179"></a><span id="l131.179"> </span>
<a href="#l131.180"></a><span id="l131.180"> toolbar[iconsize=&quot;small&quot;] &gt; #button-next[disabled] {</span>
<a href="#l131.181"></a><span id="l131.181">   -moz-image-region: rect(120px 79px 139px 60px) !important;</span>
<a href="#l131.182"></a><span id="l131.182"> }</span>
<a href="#l131.183"></a><span id="l131.183"> </span>
<a href="#l131.184"></a><span id="l131.184" class="difflineminus">-toolbar[iconsize=&quot;small&quot;] &gt; #button-delete {</span>
<a href="#l131.185"></a><span id="l131.185" class="difflineplus">+toolbar[iconsize=&quot;small&quot;] &gt; #button-delete,</span>
<a href="#l131.186"></a><span id="l131.186" class="difflineplus">+toolbar[iconsize=&quot;small&quot;] &gt; toolbarpaletteitem &gt; #button-delete {</span>
<a href="#l131.187"></a><span id="l131.187">   list-style-image: url(&quot;chrome://messenger/skin/icons/messengericons-small.png&quot;);</span>
<a href="#l131.188"></a><span id="l131.188">   -moz-image-region: rect(0 19px 19px 0);</span>
<a href="#l131.189"></a><span id="l131.189"> }</span>
<a href="#l131.190"></a><span id="l131.190"> </span>
<a href="#l131.191"></a><span id="l131.191"> toolbar[iconsize=&quot;small&quot;] &gt; #button-delete:hover {</span>
<a href="#l131.192"></a><span id="l131.192">   -moz-image-region: rect(0 39px 19px 20px);</span>
<a href="#l131.193"></a><span id="l131.193"> }</span>
<a href="#l131.194"></a><span id="l131.194"> </span>
<a href="#l131.195"></a><span id="l131.195"> toolbar[iconsize=&quot;small&quot;] &gt; #button-delete:hover:active {</span>
<a href="#l131.196"></a><span id="l131.196">   -moz-image-region: rect(0 59px 19px 40px);</span>
<a href="#l131.197"></a><span id="l131.197"> }</span>
<a href="#l131.198"></a><span id="l131.198"> </span>
<a href="#l131.199"></a><span id="l131.199" class="difflineminus">-toolbar[iconsize=&quot;small&quot;] &gt; #button-delete[disabled] {</span>
<a href="#l131.200"></a><span id="l131.200" class="difflineplus">+toolbar[iconsize=&quot;small&quot;] &gt; #button-delete[disabled],</span>
<a href="#l131.201"></a><span id="l131.201" class="difflineplus">+toolbar[iconsize=&quot;small&quot;] &gt; toolbarpaletteitem &gt; #button-delete[disabled] {</span>
<a href="#l131.202"></a><span id="l131.202">   -moz-image-region: rect(0 79px 19px 60px) !important;</span>
<a href="#l131.203"></a><span id="l131.203"> }</span>
<a href="#l131.204"></a><span id="l131.204"> </span>
<a href="#l131.205"></a><span id="l131.205" class="difflineminus">-toolbar[iconsize=&quot;small&quot;] &gt; #button-mark {</span>
<a href="#l131.206"></a><span id="l131.206" class="difflineplus">+toolbar[iconsize=&quot;small&quot;] &gt; #button-mark,</span>
<a href="#l131.207"></a><span id="l131.207" class="difflineplus">+toolbar[iconsize=&quot;small&quot;] &gt; toolbarpaletteitem &gt; #button-mark {</span>
<a href="#l131.208"></a><span id="l131.208">   list-style-image: url(&quot;chrome://messenger/skin/icons/messengericons-small.png&quot;);</span>
<a href="#l131.209"></a><span id="l131.209">   -moz-image-region: rect(80px 19px 99px 0);</span>
<a href="#l131.210"></a><span id="l131.210"> }</span>
<a href="#l131.211"></a><span id="l131.211"> </span>
<a href="#l131.212"></a><span id="l131.212"> toolbar[iconsize=&quot;small&quot;] &gt; #button-mark:hover {</span>
<a href="#l131.213"></a><span id="l131.213">   -moz-image-region: rect(80px 39px 99px 20px);</span>
<a href="#l131.214"></a><span id="l131.214"> }</span>
<a href="#l131.215"></a><span id="l131.215"> </span>
<a href="#l131.216"></a><span id="l131.216"> toolbar[iconsize=&quot;small&quot;] &gt; #button-mark:hover:active {</span>
<a href="#l131.217"></a><span id="l131.217">   -moz-image-region: rect(80px 59px 99px 40px);</span>
<a href="#l131.218"></a><span id="l131.218"> }</span>
<a href="#l131.219"></a><span id="l131.219"> </span>
<a href="#l131.220"></a><span id="l131.220"> toolbar[iconsize=&quot;small&quot;] &gt; #button-mark[disabled] {</span>
<a href="#l131.221"></a><span id="l131.221">   -moz-image-region: rect(80px 79px 99px 60px) !important;</span>
<a href="#l131.222"></a><span id="l131.222"> }</span>
<a href="#l131.223"></a><span id="l131.223"> </span>
<a href="#l131.224"></a><span id="l131.224" class="difflineminus">-toolbar[iconsize=&quot;small&quot;] &gt; #button-junk {</span>
<a href="#l131.225"></a><span id="l131.225" class="difflineplus">+toolbar[iconsize=&quot;small&quot;] &gt; #button-junk,</span>
<a href="#l131.226"></a><span id="l131.226" class="difflineplus">+toolbar[iconsize=&quot;small&quot;] &gt; toolbarpaletteitem &gt; #button-junk {</span>
<a href="#l131.227"></a><span id="l131.227">   list-style-image: url(&quot;chrome://messenger/skin/icons/messengericons-small.png&quot;);</span>
<a href="#l131.228"></a><span id="l131.228">   -moz-image-region: rect(240px 19px 259px 0);</span>
<a href="#l131.229"></a><span id="l131.229"> }</span>
<a href="#l131.230"></a><span id="l131.230"> </span>
<a href="#l131.231"></a><span id="l131.231"> toolbar[iconsize=&quot;small&quot;] &gt; #button-junk:hover {</span>
<a href="#l131.232"></a><span id="l131.232">   -moz-image-region: rect(240px 39px 259px 20px);</span>
<a href="#l131.233"></a><span id="l131.233"> }</span>
<a href="#l131.234"></a><span id="l131.234"> </span>
<a href="#l131.235"></a><span id="l131.235"> toolbar[iconsize=&quot;small&quot;] &gt; #button-junk:hover:active {</span>
<a href="#l131.236"></a><span id="l131.236">   -moz-image-region: rect(240px 59px 259px 40px);</span>
<a href="#l131.237"></a><span id="l131.237"> }</span>
<a href="#l131.238"></a><span id="l131.238"> </span>
<a href="#l131.239"></a><span id="l131.239" class="difflineminus">-toolbar[iconsize=&quot;small&quot;] &gt; #button-junk[disabled=&quot;true&quot;] {</span>
<a href="#l131.240"></a><span id="l131.240" class="difflineplus">+toolbar[iconsize=&quot;small&quot;] &gt; #button-junk[disabled],</span>
<a href="#l131.241"></a><span id="l131.241" class="difflineplus">+toolbar[iconsize=&quot;small&quot;] &gt; toolbarpaletteitem &gt; #button-junk[disabled] {</span>
<a href="#l131.242"></a><span id="l131.242">   -moz-image-region: rect(240px 79px 259px 60px) !important;</span>
<a href="#l131.243"></a><span id="l131.243"> }</span>
<a href="#l131.244"></a><span id="l131.244"> </span>
<a href="#l131.245"></a><span id="l131.245" class="difflineminus">-toolbar[iconsize=&quot;small&quot;] &gt; #button-print {</span>
<a href="#l131.246"></a><span id="l131.246" class="difflineplus">+toolbar[iconsize=&quot;small&quot;] &gt; #button-print,</span>
<a href="#l131.247"></a><span id="l131.247" class="difflineplus">+toolbar[iconsize=&quot;small&quot;] &gt; toolbarpaletteitem &gt; #button-print {</span>
<a href="#l131.248"></a><span id="l131.248">   list-style-image: url(&quot;chrome://communicator/skin/icons/communicatoricons-small.png&quot;);</span>
<a href="#l131.249"></a><span id="l131.249">   -moz-image-region: rect(0 19px 19px 0);</span>
<a href="#l131.250"></a><span id="l131.250"> }</span>
<a href="#l131.251"></a><span id="l131.251"> </span>
<a href="#l131.252"></a><span id="l131.252"> toolbar[iconsize=&quot;small&quot;] &gt; #button-print:hover {</span>
<a href="#l131.253"></a><span id="l131.253">   -moz-image-region: rect(0 39px 19px 20px);</span>
<a href="#l131.254"></a><span id="l131.254"> }</span>
<a href="#l131.255"></a><span id="l131.255"> </span>
<a href="#l131.256"></a><span id="l131.256"> toolbar[iconsize=&quot;small&quot;] &gt; #button-print:hover:active {</span>
<a href="#l131.257"></a><span id="l131.257">   -moz-image-region: rect(0 59px 19px 40px);</span>
<a href="#l131.258"></a><span id="l131.258"> }</span>
<a href="#l131.259"></a><span id="l131.259"> </span>
<a href="#l131.260"></a><span id="l131.260"> toolbar[iconsize=&quot;small&quot;] &gt; #button-print[disabled] {</span>
<a href="#l131.261"></a><span id="l131.261">   -moz-image-region: rect(0 79px 19px 60px) !important;</span>
<a href="#l131.262"></a><span id="l131.262"> }</span>
<a href="#l131.263"></a><span id="l131.263"> </span>
<a href="#l131.264"></a><span id="l131.264" class="difflineminus">-toolbar[iconsize=&quot;small&quot;] &gt; #button-stop {</span>
<a href="#l131.265"></a><span id="l131.265" class="difflineplus">+toolbar[iconsize=&quot;small&quot;] &gt; #button-stop,</span>
<a href="#l131.266"></a><span id="l131.266" class="difflineplus">+toolbar[iconsize=&quot;small&quot;] &gt; toolbarpaletteitem &gt; #button-stop {</span>
<a href="#l131.267"></a><span id="l131.267">   list-style-image: url(&quot;chrome://communicator/skin/icons/communicatoricons-small.png&quot;);</span>
<a href="#l131.268"></a><span id="l131.268">   -moz-image-region: rect(20px 19px 39px 0);</span>
<a href="#l131.269"></a><span id="l131.269"> }</span>
<a href="#l131.270"></a><span id="l131.270"> </span>
<a href="#l131.271"></a><span id="l131.271"> toolbar[iconsize=&quot;small&quot;] &gt; #button-stop:hover {</span>
<a href="#l131.272"></a><span id="l131.272">   -moz-image-region: rect(20px 39px 39px 20px);</span>
<a href="#l131.273"></a><span id="l131.273"> }</span>
<a href="#l131.274"></a><span id="l131.274"> </span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l132.1"></a><span id="l132.1" class="difflineminus">--- a/suite/themes/modern/messenger/dialogs.css</span>
<a href="#l132.2"></a><span id="l132.2" class="difflineplus">+++ b/suite/themes/modern/messenger/dialogs.css</span>
<a href="#l132.3"></a><span id="l132.3" class="difflineat">@@ -90,33 +90,8 @@ treecell.importsampledata {</span>
<a href="#l132.4"></a><span id="l132.4"> </span>
<a href="#l132.5"></a><span id="l132.5"> #progressMeter {</span>
<a href="#l132.6"></a><span id="l132.6">   margin-top: 1em;</span>
<a href="#l132.7"></a><span id="l132.7">   margin-bottom: 2em;</span>
<a href="#l132.8"></a><span id="l132.8">   -moz-margin-start: 1em;</span>
<a href="#l132.9"></a><span id="l132.9">   -moz-margin-end: 2em;</span>
<a href="#l132.10"></a><span id="l132.10">   width: 26em;</span>
<a href="#l132.11"></a><span id="l132.11"> }</span>
<a href="#l132.12"></a><span id="l132.12" class="difflineminus">-</span>
<a href="#l132.13"></a><span id="l132.13" class="difflineminus">-/* ::::: askSendFormat.xul ::::: */</span>
<a href="#l132.14"></a><span id="l132.14" class="difflineminus">-</span>
<a href="#l132.15"></a><span id="l132.15" class="difflineminus">-#askSendFormat {</span>
<a href="#l132.16"></a><span id="l132.16" class="difflineminus">-  width: 40em;</span>
<a href="#l132.17"></a><span id="l132.17" class="difflineminus">-}</span>
<a href="#l132.18"></a><span id="l132.18" class="difflineminus">-</span>
<a href="#l132.19"></a><span id="l132.19" class="difflineminus">-#askImageBox {</span>
<a href="#l132.20"></a><span id="l132.20" class="difflineminus">-  -moz-box-align: start;</span>
<a href="#l132.21"></a><span id="l132.21" class="difflineminus">-}</span>
<a href="#l132.22"></a><span id="l132.22" class="difflineminus">-</span>
<a href="#l132.23"></a><span id="l132.23" class="difflineminus">-#convertYes,</span>
<a href="#l132.24"></a><span id="l132.24" class="difflineminus">-#convertAltering {</span>
<a href="#l132.25"></a><span id="l132.25" class="difflineminus">-  list-style-image: url(&quot;chrome://global/skin/icons/alert-question.gif&quot;);</span>
<a href="#l132.26"></a><span id="l132.26" class="difflineminus">-}</span>
<a href="#l132.27"></a><span id="l132.27" class="difflineminus">-</span>
<a href="#l132.28"></a><span id="l132.28" class="difflineminus">-#convertNo {</span>
<a href="#l132.29"></a><span id="l132.29" class="difflineminus">-  list-style-image: url(&quot;chrome://global/skin/icons/alert-exclam.gif&quot;);</span>
<a href="#l132.30"></a><span id="l132.30" class="difflineminus">-}</span>
<a href="#l132.31"></a><span id="l132.31" class="difflineminus">-</span>
<a href="#l132.32"></a><span id="l132.32" class="difflineminus">-/* Workaround for bug 50217. Please remove this rule, when this bug is fixed. */</span>
<a href="#l132.33"></a><span id="l132.33" class="difflineminus">-#convertDefault {</span>
<a href="#l132.34"></a><span id="l132.34" class="difflineminus">-  list-style-image: url(&quot;chrome://global/skin/icons/alert-question.gif&quot;);</span>
<a href="#l132.35"></a><span id="l132.35" class="difflineminus">-}</span>
<a href="#l132.36"></a><span id="l132.36" class="difflineminus">-</span></pre></div></div>

<div class="page_footer">
<div class="page_footer_text">comm-central</div>
<div class="page_footer_text" style="padding-left: 10px">Deployed from <a href="https://hg.mozilla.org/hgcustom/version-control-tools/rev/35f393d6769a">35f393d6769a</a> at 2020-07-16T17:23:43Z.</div>
<div class="rss_logo">
<a href="/comm-central/rss-log">RSS</a>
<a href="/comm-central/atom-log">Atom</a>
</div>
<br />

</div>
</body>
</html>

