<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en-US" lang="en-US">
<head>
<link rel="icon" href="/static/4b0de666d1a4/hgicon.png" type="image/png" />
<meta name="robots" content="index, nofollow"/>
<link rel="stylesheet" href="/static/4b0de666d1a4/style-gitweb.css" type="text/css" />

<style type="text/css">
div.feed {
  float: right;
}
a img {
  border-width: 0px;
}
div.log_link {
  width: 80px;
  background-color: white;
}

div.log_body {
  padding-left: 96px;
}
</style>
<script type="text/javascript" src="/static/4b0de666d1a4/mercurial.js"></script>

<meta property="og:image" content="/static/4b0de666d1a4/moz-logo-bw-rgb.svg"/>
<meta property="og:type" content="website"/>

<title>comm-central: changeset 26667:ebe4366fb0a3c4e6618fba322b8ce05ac32ead13</title>
<link rel="alternate" type="application/atom+xml"
   href="/comm-central/atom-log" title="Atom feed for comm-central"/>
<link rel="alternate" type="application/rss+xml"
   href="/comm-central/rss-log" title="RSS feed for comm-central"/>

<meta property="og:title" content="comm-central @ ebe4366fb0a3c4e6618fba322b8ce05ac32ead13" />
<meta property="og:url" content="/comm-central/rev/ebe4366fb0a3c4e6618fba322b8ce05ac32ead13" />
<meta property="og:description" content="Bug 1504416 - [de-xbl] Migrate calendar-list-tree bindings to custom elements. r=philipp" />

</head>
<body>

<div class="page_header">
<div class="logo">
    <a href="https://developer.mozilla.org/en/docs/Mercurial">
        <img src="/static/4b0de666d1a4/moz-logo-bw-rgb.svg" alt="mercurial" />
    </a>
</div>
<a href="/">Mercurial</a> &gt; <a href="/comm-central">comm-central</a>  / changeset / ebe4366fb0a3c4e6618fba322b8ce05ac32ead13 
</div>

<div class="page_nav">
<div>
<a href="/comm-central/summary">summary</a> |
<a href="/comm-central/shortlog/ebe4366fb0a3c4e6618fba322b8ce05ac32ead13">shortlog</a> |
<a href="/comm-central/log/ebe4366fb0a3c4e6618fba322b8ce05ac32ead13">changelog</a> |
<a href="/comm-central/pushloghtml">pushlog</a> |
<a href="/comm-central/graph/ebe4366fb0a3c4e6618fba322b8ce05ac32ead13">graph</a> |
<a href="/comm-central/tags">tags</a> |
<a href="/comm-central/bookmarks">bookmarks</a> |
<a href="/comm-central/branches">branches</a> |
<a href="/comm-central/file/ebe4366fb0a3c4e6618fba322b8ce05ac32ead13">files</a> |
changeset |
<a href="/comm-central/raw-rev/ebe4366fb0a3c4e6618fba322b8ce05ac32ead13">raw</a>  | <a href="/comm-central/archive/ebe4366fb0a3c4e6618fba322b8ce05ac32ead13.zip">zip</a>  |
<a href="/comm-central/help">help</a>
</div>

<div class="search">
<form id="searchform" action="/comm-central/log">

<input name="rev" type="text" value="" size="40" />
<div id="hint">Find changesets by keywords (author, files, the commit message), revision
number or hash, or <a href="/comm-central/help/revsets">revset expression</a>.</div>
</form>
</div>
</div>

<div class="title">
<a href="https://bugzilla.mozilla.org/show_bug.cgi?id=1504416">Bug 1504416</a> - [de-xbl] Migrate calendar-list-tree bindings to custom elements. r=philipp
<span class="logtags"></span>
</div>
<div class="title_text">
<table cellspacing="0">

<tr><td>author</td><td>&#80;&#97;&#117;&#108;&#32;&#77;&#111;&#114;&#114;&#105;&#115;&#32;&#60;&#112;&#97;&#117;&#108;&#64;&#112;&#97;&#117;&#108;&#119;&#109;&#111;&#114;&#114;&#105;&#115;&#46;&#99;&#111;&#109;&#62;</td></tr>
<tr><td></td><td class="date age">Mon, 20 May 2019 10:59:29 +0200</td></tr>

<tr>
 <td>changeset 26667</td>
 <td style="font-family:monospace"><a class="list" href="/comm-central/rev/ebe4366fb0a3c4e6618fba322b8ce05ac32ead13">ebe4366fb0a3c4e6618fba322b8ce05ac32ead13</a></td>
</tr>



<tr>
<td>parent 26666</td>
<td style="font-family:monospace">
<a class="list" href="/comm-central/rev/ed4e2f86397602bcd79b8b1c6475df0606cf0fbb">ed4e2f86397602bcd79b8b1c6475df0606cf0fbb</a>
</td>
</tr>

<tr>
<td>child 26668</td>
<td style="font-family:monospace">
<a class="list" href="/comm-central/rev/844558b1ed2ef5fab33556578e888fc7c4bab621">844558b1ed2ef5fab33556578e888fc7c4bab621</a>
</td>
</tr>
<tr><td>push id</td><td><a href="/comm-central/pushloghtml?changeset=ebe4366fb0a3c4e6618fba322b8ce05ac32ead13">15940</a></td></tr>
<tr><td>push user</td><td>mozilla@jorgk.com</td></tr>
<tr><td>push date</td><td class="date age">Mon, 20 May 2019 09:45:05 +0000</td></tr>

<tr><td>treeherder</td><td>comm-central@ae087d73b3ce [<a href="https://treeherder.mozilla.org/#/jobs?repo=comm-central&revision=ae087d73b3ce70604c356f6043cc8998243bf87f">default view</a>] [<a href="https://treeherder.mozilla.org/#/jobs?repo=comm-central&revision=ae087d73b3ce70604c356f6043cc8998243bf87f&filter-resultStatus=testfailed&filter-resultStatus=busted&filter-resultStatus=exception">failures only]</td></tr>
<tr><td>perfherder</td><td>[<a href="https://treeherder.mozilla.org/perf.html#/compare?originalProject=comm-central&originalRevision=ae087d73b3ce70604c356f6043cc8998243bf87f&newProject=comm-central&newRevision=ed4e2f86397602bcd79b8b1c6475df0606cf0fbb&framework=1" target="_blank">talos</a>] [<a href="https://treeherder.mozilla.org/perf.html#/compare?originalProject=comm-central&originalRevision=ae087d73b3ce70604c356f6043cc8998243bf87f&newProject=comm-central&newRevision=ed4e2f86397602bcd79b8b1c6475df0606cf0fbb&framework=2" target="_blank">build metrics</a>] [<a href="https://treeherder.mozilla.org/perf.html#/compare?originalProject=comm-central&originalRevision=ae087d73b3ce70604c356f6043cc8998243bf87f&newProject=comm-central&newRevision=ed4e2f86397602bcd79b8b1c6475df0606cf0fbb&framework=6" target="_blank">platform microbench</a>] (compared to previous push)</td></tr>
<tr><td>reviewers</td><td><a href="/comm-central/log?rev=reviewer%28philipp%29&revcount=50">philipp</a></td></tr>
<tr><td>bugs</td><td><a href="https://bugzilla.mozilla.org/show_bug.cgi?id=1504416">1504416</a></td></tr>




</table></div>

<div class="page_body description"><a href="https://bugzilla.mozilla.org/show_bug.cgi?id=1504416">Bug 1504416</a> - [de-xbl] Migrate calendar-list-tree bindings to custom elements. r=philipp</div>
<div class="list_head"></div>
<div class="title_text">
<table cellspacing="0">

<tr class="parity0">
<td><a class="list" href="/comm-central/diff/ebe4366fb0a3c4e6618fba322b8ce05ac32ead13/calendar/base/content/calendar-calendars-list.xul">calendar/base/content/calendar-calendars-list.xul</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/ebe4366fb0a3c4e6618fba322b8ce05ac32ead13/calendar/base/content/calendar-calendars-list.xul">file</a> |
<a href="/comm-central/annotate/ebe4366fb0a3c4e6618fba322b8ce05ac32ead13/calendar/base/content/calendar-calendars-list.xul">annotate</a> |
<a href="/comm-central/diff/ebe4366fb0a3c4e6618fba322b8ce05ac32ead13/calendar/base/content/calendar-calendars-list.xul">diff</a> |
<a href="/comm-central/comparison/ebe4366fb0a3c4e6618fba322b8ce05ac32ead13/calendar/base/content/calendar-calendars-list.xul">comparison</a> |
<a href="/comm-central/log/ebe4366fb0a3c4e6618fba322b8ce05ac32ead13/calendar/base/content/calendar-calendars-list.xul">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/ebe4366fb0a3c4e6618fba322b8ce05ac32ead13/calendar/base/content/calendar-management.js">calendar/base/content/calendar-management.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/ebe4366fb0a3c4e6618fba322b8ce05ac32ead13/calendar/base/content/calendar-management.js">file</a> |
<a href="/comm-central/annotate/ebe4366fb0a3c4e6618fba322b8ce05ac32ead13/calendar/base/content/calendar-management.js">annotate</a> |
<a href="/comm-central/diff/ebe4366fb0a3c4e6618fba322b8ce05ac32ead13/calendar/base/content/calendar-management.js">diff</a> |
<a href="/comm-central/comparison/ebe4366fb0a3c4e6618fba322b8ce05ac32ead13/calendar/base/content/calendar-management.js">comparison</a> |
<a href="/comm-central/log/ebe4366fb0a3c4e6618fba322b8ce05ac32ead13/calendar/base/content/calendar-management.js">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/ebe4366fb0a3c4e6618fba322b8ce05ac32ead13/calendar/base/content/dialogs/calendar-providerUninstall-dialog.xul">calendar/base/content/dialogs/calendar-providerUninstall-dialog.xul</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/ebe4366fb0a3c4e6618fba322b8ce05ac32ead13/calendar/base/content/dialogs/calendar-providerUninstall-dialog.xul">file</a> |
<a href="/comm-central/annotate/ebe4366fb0a3c4e6618fba322b8ce05ac32ead13/calendar/base/content/dialogs/calendar-providerUninstall-dialog.xul">annotate</a> |
<a href="/comm-central/diff/ebe4366fb0a3c4e6618fba322b8ce05ac32ead13/calendar/base/content/dialogs/calendar-providerUninstall-dialog.xul">diff</a> |
<a href="/comm-central/comparison/ebe4366fb0a3c4e6618fba322b8ce05ac32ead13/calendar/base/content/dialogs/calendar-providerUninstall-dialog.xul">comparison</a> |
<a href="/comm-central/log/ebe4366fb0a3c4e6618fba322b8ce05ac32ead13/calendar/base/content/dialogs/calendar-providerUninstall-dialog.xul">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/ebe4366fb0a3c4e6618fba322b8ce05ac32ead13/calendar/base/content/widgets/calendar-list-tree.js">calendar/base/content/widgets/calendar-list-tree.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/ebe4366fb0a3c4e6618fba322b8ce05ac32ead13/calendar/base/content/widgets/calendar-list-tree.js">file</a> |
<a href="/comm-central/annotate/ebe4366fb0a3c4e6618fba322b8ce05ac32ead13/calendar/base/content/widgets/calendar-list-tree.js">annotate</a> |
<a href="/comm-central/diff/ebe4366fb0a3c4e6618fba322b8ce05ac32ead13/calendar/base/content/widgets/calendar-list-tree.js">diff</a> |
<a href="/comm-central/comparison/ebe4366fb0a3c4e6618fba322b8ce05ac32ead13/calendar/base/content/widgets/calendar-list-tree.js">comparison</a> |
<a href="/comm-central/log/ebe4366fb0a3c4e6618fba322b8ce05ac32ead13/calendar/base/content/widgets/calendar-list-tree.js">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/ebe4366fb0a3c4e6618fba322b8ce05ac32ead13/calendar/base/content/widgets/calendar-list-tree.xml">calendar/base/content/widgets/calendar-list-tree.xml</a></td>
<td></td>
<td class="link">
file |
annotate |
<a href="/comm-central/diff/ebe4366fb0a3c4e6618fba322b8ce05ac32ead13/calendar/base/content/widgets/calendar-list-tree.xml">diff</a> |
<a href="/comm-central/comparison/ebe4366fb0a3c4e6618fba322b8ce05ac32ead13/calendar/base/content/widgets/calendar-list-tree.xml">comparison</a> |
<a href="/comm-central/log/ebe4366fb0a3c4e6618fba322b8ce05ac32ead13/calendar/base/content/widgets/calendar-list-tree.xml">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/ebe4366fb0a3c4e6618fba322b8ce05ac32ead13/calendar/base/content/widgets/calendar-widget-bindings.css">calendar/base/content/widgets/calendar-widget-bindings.css</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/ebe4366fb0a3c4e6618fba322b8ce05ac32ead13/calendar/base/content/widgets/calendar-widget-bindings.css">file</a> |
<a href="/comm-central/annotate/ebe4366fb0a3c4e6618fba322b8ce05ac32ead13/calendar/base/content/widgets/calendar-widget-bindings.css">annotate</a> |
<a href="/comm-central/diff/ebe4366fb0a3c4e6618fba322b8ce05ac32ead13/calendar/base/content/widgets/calendar-widget-bindings.css">diff</a> |
<a href="/comm-central/comparison/ebe4366fb0a3c4e6618fba322b8ce05ac32ead13/calendar/base/content/widgets/calendar-widget-bindings.css">comparison</a> |
<a href="/comm-central/log/ebe4366fb0a3c4e6618fba322b8ce05ac32ead13/calendar/base/content/widgets/calendar-widget-bindings.css">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/ebe4366fb0a3c4e6618fba322b8ce05ac32ead13/calendar/base/jar.mn">calendar/base/jar.mn</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/ebe4366fb0a3c4e6618fba322b8ce05ac32ead13/calendar/base/jar.mn">file</a> |
<a href="/comm-central/annotate/ebe4366fb0a3c4e6618fba322b8ce05ac32ead13/calendar/base/jar.mn">annotate</a> |
<a href="/comm-central/diff/ebe4366fb0a3c4e6618fba322b8ce05ac32ead13/calendar/base/jar.mn">diff</a> |
<a href="/comm-central/comparison/ebe4366fb0a3c4e6618fba322b8ce05ac32ead13/calendar/base/jar.mn">comparison</a> |
<a href="/comm-central/log/ebe4366fb0a3c4e6618fba322b8ce05ac32ead13/calendar/base/jar.mn">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/ebe4366fb0a3c4e6618fba322b8ce05ac32ead13/calendar/base/themes/common/calendar-management.css">calendar/base/themes/common/calendar-management.css</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/ebe4366fb0a3c4e6618fba322b8ce05ac32ead13/calendar/base/themes/common/calendar-management.css">file</a> |
<a href="/comm-central/annotate/ebe4366fb0a3c4e6618fba322b8ce05ac32ead13/calendar/base/themes/common/calendar-management.css">annotate</a> |
<a href="/comm-central/diff/ebe4366fb0a3c4e6618fba322b8ce05ac32ead13/calendar/base/themes/common/calendar-management.css">diff</a> |
<a href="/comm-central/comparison/ebe4366fb0a3c4e6618fba322b8ce05ac32ead13/calendar/base/themes/common/calendar-management.css">comparison</a> |
<a href="/comm-central/log/ebe4366fb0a3c4e6618fba322b8ce05ac32ead13/calendar/base/themes/common/calendar-management.css">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/ebe4366fb0a3c4e6618fba322b8ce05ac32ead13/calendar/base/themes/common/widgets/calendar-widgets.css">calendar/base/themes/common/widgets/calendar-widgets.css</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/ebe4366fb0a3c4e6618fba322b8ce05ac32ead13/calendar/base/themes/common/widgets/calendar-widgets.css">file</a> |
<a href="/comm-central/annotate/ebe4366fb0a3c4e6618fba322b8ce05ac32ead13/calendar/base/themes/common/widgets/calendar-widgets.css">annotate</a> |
<a href="/comm-central/diff/ebe4366fb0a3c4e6618fba322b8ce05ac32ead13/calendar/base/themes/common/widgets/calendar-widgets.css">diff</a> |
<a href="/comm-central/comparison/ebe4366fb0a3c4e6618fba322b8ce05ac32ead13/calendar/base/themes/common/widgets/calendar-widgets.css">comparison</a> |
<a href="/comm-central/log/ebe4366fb0a3c4e6618fba322b8ce05ac32ead13/calendar/base/themes/common/widgets/calendar-widgets.css">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/ebe4366fb0a3c4e6618fba322b8ce05ac32ead13/calendar/base/themes/linux/calendar-management.css">calendar/base/themes/linux/calendar-management.css</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/ebe4366fb0a3c4e6618fba322b8ce05ac32ead13/calendar/base/themes/linux/calendar-management.css">file</a> |
<a href="/comm-central/annotate/ebe4366fb0a3c4e6618fba322b8ce05ac32ead13/calendar/base/themes/linux/calendar-management.css">annotate</a> |
<a href="/comm-central/diff/ebe4366fb0a3c4e6618fba322b8ce05ac32ead13/calendar/base/themes/linux/calendar-management.css">diff</a> |
<a href="/comm-central/comparison/ebe4366fb0a3c4e6618fba322b8ce05ac32ead13/calendar/base/themes/linux/calendar-management.css">comparison</a> |
<a href="/comm-central/log/ebe4366fb0a3c4e6618fba322b8ce05ac32ead13/calendar/base/themes/linux/calendar-management.css">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/ebe4366fb0a3c4e6618fba322b8ce05ac32ead13/calendar/base/themes/osx/calendar-management.css">calendar/base/themes/osx/calendar-management.css</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/ebe4366fb0a3c4e6618fba322b8ce05ac32ead13/calendar/base/themes/osx/calendar-management.css">file</a> |
<a href="/comm-central/annotate/ebe4366fb0a3c4e6618fba322b8ce05ac32ead13/calendar/base/themes/osx/calendar-management.css">annotate</a> |
<a href="/comm-central/diff/ebe4366fb0a3c4e6618fba322b8ce05ac32ead13/calendar/base/themes/osx/calendar-management.css">diff</a> |
<a href="/comm-central/comparison/ebe4366fb0a3c4e6618fba322b8ce05ac32ead13/calendar/base/themes/osx/calendar-management.css">comparison</a> |
<a href="/comm-central/log/ebe4366fb0a3c4e6618fba322b8ce05ac32ead13/calendar/base/themes/osx/calendar-management.css">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/ebe4366fb0a3c4e6618fba322b8ce05ac32ead13/calendar/base/themes/windows/calendar-management.css">calendar/base/themes/windows/calendar-management.css</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/ebe4366fb0a3c4e6618fba322b8ce05ac32ead13/calendar/base/themes/windows/calendar-management.css">file</a> |
<a href="/comm-central/annotate/ebe4366fb0a3c4e6618fba322b8ce05ac32ead13/calendar/base/themes/windows/calendar-management.css">annotate</a> |
<a href="/comm-central/diff/ebe4366fb0a3c4e6618fba322b8ce05ac32ead13/calendar/base/themes/windows/calendar-management.css">diff</a> |
<a href="/comm-central/comparison/ebe4366fb0a3c4e6618fba322b8ce05ac32ead13/calendar/base/themes/windows/calendar-management.css">comparison</a> |
<a href="/comm-central/log/ebe4366fb0a3c4e6618fba322b8ce05ac32ead13/calendar/base/themes/windows/calendar-management.css">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/ebe4366fb0a3c4e6618fba322b8ce05ac32ead13/calendar/lightning/content/messenger-overlay-sidebar.xul">calendar/lightning/content/messenger-overlay-sidebar.xul</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/ebe4366fb0a3c4e6618fba322b8ce05ac32ead13/calendar/lightning/content/messenger-overlay-sidebar.xul">file</a> |
<a href="/comm-central/annotate/ebe4366fb0a3c4e6618fba322b8ce05ac32ead13/calendar/lightning/content/messenger-overlay-sidebar.xul">annotate</a> |
<a href="/comm-central/diff/ebe4366fb0a3c4e6618fba322b8ce05ac32ead13/calendar/lightning/content/messenger-overlay-sidebar.xul">diff</a> |
<a href="/comm-central/comparison/ebe4366fb0a3c4e6618fba322b8ce05ac32ead13/calendar/lightning/content/messenger-overlay-sidebar.xul">comparison</a> |
<a href="/comm-central/log/ebe4366fb0a3c4e6618fba322b8ce05ac32ead13/calendar/lightning/content/messenger-overlay-sidebar.xul">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/ebe4366fb0a3c4e6618fba322b8ce05ac32ead13/calendar/providers/gdata/content/gdata-bindings.css">calendar/providers/gdata/content/gdata-bindings.css</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/ebe4366fb0a3c4e6618fba322b8ce05ac32ead13/calendar/providers/gdata/content/gdata-bindings.css">file</a> |
<a href="/comm-central/annotate/ebe4366fb0a3c4e6618fba322b8ce05ac32ead13/calendar/providers/gdata/content/gdata-bindings.css">annotate</a> |
<a href="/comm-central/diff/ebe4366fb0a3c4e6618fba322b8ce05ac32ead13/calendar/providers/gdata/content/gdata-bindings.css">diff</a> |
<a href="/comm-central/comparison/ebe4366fb0a3c4e6618fba322b8ce05ac32ead13/calendar/providers/gdata/content/gdata-bindings.css">comparison</a> |
<a href="/comm-central/log/ebe4366fb0a3c4e6618fba322b8ce05ac32ead13/calendar/providers/gdata/content/gdata-bindings.css">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/ebe4366fb0a3c4e6618fba322b8ce05ac32ead13/calendar/providers/gdata/content/gdata-calendar-creation.xul">calendar/providers/gdata/content/gdata-calendar-creation.xul</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/ebe4366fb0a3c4e6618fba322b8ce05ac32ead13/calendar/providers/gdata/content/gdata-calendar-creation.xul">file</a> |
<a href="/comm-central/annotate/ebe4366fb0a3c4e6618fba322b8ce05ac32ead13/calendar/providers/gdata/content/gdata-calendar-creation.xul">annotate</a> |
<a href="/comm-central/diff/ebe4366fb0a3c4e6618fba322b8ce05ac32ead13/calendar/providers/gdata/content/gdata-calendar-creation.xul">diff</a> |
<a href="/comm-central/comparison/ebe4366fb0a3c4e6618fba322b8ce05ac32ead13/calendar/providers/gdata/content/gdata-calendar-creation.xul">comparison</a> |
<a href="/comm-central/log/ebe4366fb0a3c4e6618fba322b8ce05ac32ead13/calendar/providers/gdata/content/gdata-calendar-creation.xul">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/ebe4366fb0a3c4e6618fba322b8ce05ac32ead13/calendar/providers/gdata/content/gdata-list-tree.js">calendar/providers/gdata/content/gdata-list-tree.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/ebe4366fb0a3c4e6618fba322b8ce05ac32ead13/calendar/providers/gdata/content/gdata-list-tree.js">file</a> |
<a href="/comm-central/annotate/ebe4366fb0a3c4e6618fba322b8ce05ac32ead13/calendar/providers/gdata/content/gdata-list-tree.js">annotate</a> |
<a href="/comm-central/diff/ebe4366fb0a3c4e6618fba322b8ce05ac32ead13/calendar/providers/gdata/content/gdata-list-tree.js">diff</a> |
<a href="/comm-central/comparison/ebe4366fb0a3c4e6618fba322b8ce05ac32ead13/calendar/providers/gdata/content/gdata-list-tree.js">comparison</a> |
<a href="/comm-central/log/ebe4366fb0a3c4e6618fba322b8ce05ac32ead13/calendar/providers/gdata/content/gdata-list-tree.js">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/ebe4366fb0a3c4e6618fba322b8ce05ac32ead13/calendar/providers/gdata/content/gdata-list-tree.xml">calendar/providers/gdata/content/gdata-list-tree.xml</a></td>
<td></td>
<td class="link">
file |
annotate |
<a href="/comm-central/diff/ebe4366fb0a3c4e6618fba322b8ce05ac32ead13/calendar/providers/gdata/content/gdata-list-tree.xml">diff</a> |
<a href="/comm-central/comparison/ebe4366fb0a3c4e6618fba322b8ce05ac32ead13/calendar/providers/gdata/content/gdata-list-tree.xml">comparison</a> |
<a href="/comm-central/log/ebe4366fb0a3c4e6618fba322b8ce05ac32ead13/calendar/providers/gdata/content/gdata-list-tree.xml">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/ebe4366fb0a3c4e6618fba322b8ce05ac32ead13/calendar/providers/gdata/jar.mn">calendar/providers/gdata/jar.mn</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/ebe4366fb0a3c4e6618fba322b8ce05ac32ead13/calendar/providers/gdata/jar.mn">file</a> |
<a href="/comm-central/annotate/ebe4366fb0a3c4e6618fba322b8ce05ac32ead13/calendar/providers/gdata/jar.mn">annotate</a> |
<a href="/comm-central/diff/ebe4366fb0a3c4e6618fba322b8ce05ac32ead13/calendar/providers/gdata/jar.mn">diff</a> |
<a href="/comm-central/comparison/ebe4366fb0a3c4e6618fba322b8ce05ac32ead13/calendar/providers/gdata/jar.mn">comparison</a> |
<a href="/comm-central/log/ebe4366fb0a3c4e6618fba322b8ce05ac32ead13/calendar/providers/gdata/jar.mn">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/ebe4366fb0a3c4e6618fba322b8ce05ac32ead13/calendar/test/mozmill/shared-modules/test-calendar-utils.js">calendar/test/mozmill/shared-modules/test-calendar-utils.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/ebe4366fb0a3c4e6618fba322b8ce05ac32ead13/calendar/test/mozmill/shared-modules/test-calendar-utils.js">file</a> |
<a href="/comm-central/annotate/ebe4366fb0a3c4e6618fba322b8ce05ac32ead13/calendar/test/mozmill/shared-modules/test-calendar-utils.js">annotate</a> |
<a href="/comm-central/diff/ebe4366fb0a3c4e6618fba322b8ce05ac32ead13/calendar/test/mozmill/shared-modules/test-calendar-utils.js">diff</a> |
<a href="/comm-central/comparison/ebe4366fb0a3c4e6618fba322b8ce05ac32ead13/calendar/test/mozmill/shared-modules/test-calendar-utils.js">comparison</a> |
<a href="/comm-central/log/ebe4366fb0a3c4e6618fba322b8ce05ac32ead13/calendar/test/mozmill/shared-modules/test-calendar-utils.js">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/ebe4366fb0a3c4e6618fba322b8ce05ac32ead13/calendar/test/mozmill/testBasicFunctionality.js">calendar/test/mozmill/testBasicFunctionality.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/ebe4366fb0a3c4e6618fba322b8ce05ac32ead13/calendar/test/mozmill/testBasicFunctionality.js">file</a> |
<a href="/comm-central/annotate/ebe4366fb0a3c4e6618fba322b8ce05ac32ead13/calendar/test/mozmill/testBasicFunctionality.js">annotate</a> |
<a href="/comm-central/diff/ebe4366fb0a3c4e6618fba322b8ce05ac32ead13/calendar/test/mozmill/testBasicFunctionality.js">diff</a> |
<a href="/comm-central/comparison/ebe4366fb0a3c4e6618fba322b8ce05ac32ead13/calendar/test/mozmill/testBasicFunctionality.js">comparison</a> |
<a href="/comm-central/log/ebe4366fb0a3c4e6618fba322b8ce05ac32ead13/calendar/test/mozmill/testBasicFunctionality.js">revisions</a>
</td>
</tr>
</table></div>

<div class="page_body diffblocks"><div class="diffblock"><pre class="sourcelines">
<a href="#l1.1"></a><span id="l1.1" class="difflineminus">--- a/calendar/base/content/calendar-calendars-list.xul</span>
<a href="#l1.2"></a><span id="l1.2" class="difflineplus">+++ b/calendar/base/content/calendar-calendars-list.xul</span>
<a href="#l1.3"></a><span id="l1.3" class="difflineat">@@ -60,16 +60,15 @@</span>
<a href="#l1.4"></a><span id="l1.4">                 label=&quot;&amp;calendar.context.properties.label;&quot;</span>
<a href="#l1.5"></a><span id="l1.5">                 accesskey=&quot;&amp;calendar.context.properties.accesskey;&quot;</span>
<a href="#l1.6"></a><span id="l1.6">                 observes=&quot;calendar_edit_calendar_command&quot;/&gt;</span>
<a href="#l1.7"></a><span id="l1.7">     &lt;/menupopup&gt;</span>
<a href="#l1.8"></a><span id="l1.8">     &lt;tooltip id=&quot;calendar-list-tooltip&quot;</span>
<a href="#l1.9"></a><span id="l1.9">              onpopupshowing=&quot;return calendarListTooltipShowing(event)&quot;/&gt;</span>
<a href="#l1.10"></a><span id="l1.10">   &lt;/popupset&gt;</span>
<a href="#l1.11"></a><span id="l1.11"> </span>
<a href="#l1.12"></a><span id="l1.12" class="difflineminus">-  &lt;calendar-list-tree id=&quot;calendar-list-tree-widget&quot;</span>
<a href="#l1.13"></a><span id="l1.13" class="difflineminus">-                      type=&quot;full&quot;</span>
<a href="#l1.14"></a><span id="l1.14" class="difflineminus">-                      writable=&quot;true&quot;</span>
<a href="#l1.15"></a><span id="l1.15" class="difflineminus">-                      allowdrag=&quot;true&quot;</span>
<a href="#l1.16"></a><span id="l1.16" class="difflineminus">-                      onselect=&quot;document.commandDispatcher.updateCommands('calendar_commands')&quot;</span>
<a href="#l1.17"></a><span id="l1.17" class="difflineminus">-                      childtooltip=&quot;calendar-list-tooltip&quot;</span>
<a href="#l1.18"></a><span id="l1.18" class="difflineminus">-                      childcontext=&quot;list-calendars-context-menu&quot;/&gt;</span>
<a href="#l1.19"></a><span id="l1.19" class="difflineplus">+  &lt;tree is=&quot;calendar-list-tree-full&quot; id=&quot;calendar-list-tree-widget&quot;</span>
<a href="#l1.20"></a><span id="l1.20" class="difflineplus">+        writable=&quot;true&quot;</span>
<a href="#l1.21"></a><span id="l1.21" class="difflineplus">+        allowdrag=&quot;true&quot;</span>
<a href="#l1.22"></a><span id="l1.22" class="difflineplus">+        onselect=&quot;document.commandDispatcher.updateCommands('calendar_commands')&quot;</span>
<a href="#l1.23"></a><span id="l1.23" class="difflineplus">+        childtooltip=&quot;calendar-list-tooltip&quot;</span>
<a href="#l1.24"></a><span id="l1.24" class="difflineplus">+        childcontext=&quot;list-calendars-context-menu&quot;/&gt;</span>
<a href="#l1.25"></a><span id="l1.25"> &lt;/overlay&gt;</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l2.1"></a><span id="l2.1" class="difflineminus">--- a/calendar/base/content/calendar-management.js</span>
<a href="#l2.2"></a><span id="l2.2" class="difflineplus">+++ b/calendar/base/content/calendar-management.js</span>
<a href="#l2.3"></a><span id="l2.3" class="difflineat">@@ -202,17 +202,20 @@ function calendarListSetupContextMenu(ev</span>
<a href="#l2.4"></a><span id="l2.4">     let composite = cal.view.getCompositeCalendar(window);</span>
<a href="#l2.5"></a><span id="l2.5"> </span>
<a href="#l2.6"></a><span id="l2.6">     if (document.popupNode.localName == &quot;tree&quot;) {</span>
<a href="#l2.7"></a><span id="l2.7">         // Using VK_APPS to open the context menu will target the tree</span>
<a href="#l2.8"></a><span id="l2.8">         // itself. In that case we won't have a client point even for</span>
<a href="#l2.9"></a><span id="l2.9">         // opening the context menu. The &quot;target&quot; element should then be the</span>
<a href="#l2.10"></a><span id="l2.10">         // selected calendar.</span>
<a href="#l2.11"></a><span id="l2.11">         row.value = treeNode.tree.currentIndex;</span>
<a href="#l2.12"></a><span id="l2.12" class="difflineminus">-        col.value = treeNode.getColumn(&quot;calendarname-treecol&quot;);</span>
<a href="#l2.13"></a><span id="l2.13" class="difflineplus">+</span>
<a href="#l2.14"></a><span id="l2.14" class="difflineplus">+        col.value = treeNode.tree.columns.getColumnFor(</span>
<a href="#l2.15"></a><span id="l2.15" class="difflineplus">+            treeNode.querySelector(&quot;.calendarname-treecol&quot;));</span>
<a href="#l2.16"></a><span id="l2.16" class="difflineplus">+</span>
<a href="#l2.17"></a><span id="l2.17">         calendar = treeNode.getCalendar(row.value);</span>
<a href="#l2.18"></a><span id="l2.18">     } else {</span>
<a href="#l2.19"></a><span id="l2.19">         // Using the mouse, the context menu will open on the treechildren</span>
<a href="#l2.20"></a><span id="l2.20">         // element. Here we can use client points.</span>
<a href="#l2.21"></a><span id="l2.21">         calendar = treeNode.getCalendarFromEvent(event, col, row);</span>
<a href="#l2.22"></a><span id="l2.22">     }</span>
<a href="#l2.23"></a><span id="l2.23"> </span>
<a href="#l2.24"></a><span id="l2.24">     if (col.value &amp;&amp;</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l3.1"></a><span id="l3.1" class="difflineminus">--- a/calendar/base/content/dialogs/calendar-providerUninstall-dialog.xul</span>
<a href="#l3.2"></a><span id="l3.2" class="difflineplus">+++ b/calendar/base/content/dialogs/calendar-providerUninstall-dialog.xul</span>
<a href="#l3.3"></a><span id="l3.3" class="difflineat">@@ -15,21 +15,20 @@</span>
<a href="#l3.4"></a><span id="l3.4">         title=&quot;&amp;providerUninstall.title;&quot;</span>
<a href="#l3.5"></a><span id="l3.5">         windowtype=&quot;Calendar:ProviderUninstall&quot;</span>
<a href="#l3.6"></a><span id="l3.6">         height=&quot;320&quot;</span>
<a href="#l3.7"></a><span id="l3.7">         width=&quot;480&quot;</span>
<a href="#l3.8"></a><span id="l3.8">         onload=&quot;onLoad()&quot;</span>
<a href="#l3.9"></a><span id="l3.9">         buttonlabelaccept=&quot;&amp;providerUninstall.accept.label;&quot;</span>
<a href="#l3.10"></a><span id="l3.10">         buttonaccesskeyaccept=&quot;&amp;providerUninstall.accept.accesskey;&quot;&gt;</span>
<a href="#l3.11"></a><span id="l3.11"> </span>
<a href="#l3.12"></a><span id="l3.12" class="difflineplus">+  &lt;script src=&quot;chrome://calendar/content/widgets/calendar-list-tree.js&quot;/&gt;</span>
<a href="#l3.13"></a><span id="l3.13">   &lt;script src=&quot;chrome://calendar/content/calendar-providerUninstall-dialog.js&quot;/&gt;</span>
<a href="#l3.14"></a><span id="l3.14">   &lt;script src=&quot;chrome://calendar/content/calendar-ui-utils.js&quot;/&gt;</span>
<a href="#l3.15"></a><span id="l3.15"> </span>
<a href="#l3.16"></a><span id="l3.16">   &lt;description id=&quot;pre-name-description&quot;&gt;&amp;providerUninstall.preName.label;&lt;/description&gt;</span>
<a href="#l3.17"></a><span id="l3.17">   &lt;label id=&quot;provider-name-label&quot;/&gt;</span>
<a href="#l3.18"></a><span id="l3.18">   &lt;description id=&quot;post-name-description&quot;&gt;&amp;providerUninstall.postName.label;&lt;/description&gt;</span>
<a href="#l3.19"></a><span id="l3.19">   &lt;description id=&quot;reinstall-note-description&quot;&gt;&amp;providerUninstall.reinstallNote.label;&lt;/description&gt;</span>
<a href="#l3.20"></a><span id="l3.20"> </span>
<a href="#l3.21"></a><span id="l3.21" class="difflineminus">-  &lt;calendar-list-tree id=&quot;calendar-list-tree&quot;</span>
<a href="#l3.22"></a><span id="l3.22" class="difflineminus">-                      hidecolumnpicker=&quot;true&quot;</span>
<a href="#l3.23"></a><span id="l3.23" class="difflineminus">-                      disabledstate=&quot;ignore&quot;</span>
<a href="#l3.24"></a><span id="l3.24" class="difflineminus">-                      flex=&quot;1&quot;/&gt;</span>
<a href="#l3.25"></a><span id="l3.25" class="difflineplus">+  &lt;tree is=&quot;calendar-list-tree&quot; id=&quot;calendar-list-tree&quot;</span>
<a href="#l3.26"></a><span id="l3.26" class="difflineplus">+        disabledstate=&quot;ignore&quot;/&gt;</span>
<a href="#l3.27"></a><span id="l3.27"> &lt;/dialog&gt;</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l4.1"></a><span id="l4.1">rename from calendar/base/content/widgets/calendar-list-tree.xml</span>
<a href="#l4.2"></a><span id="l4.2">rename to calendar/base/content/widgets/calendar-list-tree.js</span>
<a href="#l4.3"></a><span id="l4.3" class="difflineminus">--- a/calendar/base/content/widgets/calendar-list-tree.xml</span>
<a href="#l4.4"></a><span id="l4.4" class="difflineplus">+++ b/calendar/base/content/widgets/calendar-list-tree.js</span>
<a href="#l4.5"></a><span id="l4.5" class="difflineat">@@ -1,1171 +1,1126 @@</span>
<a href="#l4.6"></a><span id="l4.6" class="difflineminus">-&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;</span>
<a href="#l4.7"></a><span id="l4.7" class="difflineminus">-&lt;!-- This Source Code Form is subject to the terms of the Mozilla Public</span>
<a href="#l4.8"></a><span id="l4.8" class="difflineminus">-   - License, v. 2.0. If a copy of the MPL was not distributed with this</span>
<a href="#l4.9"></a><span id="l4.9" class="difflineminus">-   - file, You can obtain one at http://mozilla.org/MPL/2.0/. --&gt;</span>
<a href="#l4.10"></a><span id="l4.10" class="difflineminus">-</span>
<a href="#l4.11"></a><span id="l4.11" class="difflineminus">-&lt;!-- import-globals-from ../calendar-common-sets.js --&gt;</span>
<a href="#l4.12"></a><span id="l4.12" class="difflineminus">-&lt;!-- import-globals-from ../calendar-views.js --&gt;</span>
<a href="#l4.13"></a><span id="l4.13" class="difflineminus">-</span>
<a href="#l4.14"></a><span id="l4.14" class="difflineminus">-&lt;!DOCTYPE bindings SYSTEM &quot;chrome://calendar/locale/calendar.dtd&quot;&gt;</span>
<a href="#l4.15"></a><span id="l4.15" class="difflineplus">+/* This Source Code Form is subject to the terms of the Mozilla Public</span>
<a href="#l4.16"></a><span id="l4.16" class="difflineplus">+ * License, v. 2.0. If a copy of the MPL was not distributed with this</span>
<a href="#l4.17"></a><span id="l4.17" class="difflineplus">+ * file, You can obtain one at http://mozilla.org/MPL/2.0/. */</span>
<a href="#l4.18"></a><span id="l4.18"> </span>
<a href="#l4.19"></a><span id="l4.19" class="difflineminus">-&lt;bindings id=&quot;calendar-list-tree-bindings&quot;</span>
<a href="#l4.20"></a><span id="l4.20" class="difflineminus">-          xmlns=&quot;http://www.mozilla.org/xbl&quot;</span>
<a href="#l4.21"></a><span id="l4.21" class="difflineminus">-          xmlns:xbl=&quot;http://www.mozilla.org/xbl&quot;</span>
<a href="#l4.22"></a><span id="l4.22" class="difflineminus">-          xmlns:xul=&quot;http://www.mozilla.org/keymaster/gatekeeper/there.is.only.xul&quot;&gt;</span>
<a href="#l4.23"></a><span id="l4.23" class="difflineminus">-  &lt;binding id=&quot;full-calendar-list-tree&quot; extends=&quot;#calendar-list-tree&quot;&gt;</span>
<a href="#l4.24"></a><span id="l4.24" class="difflineminus">-    &lt;!--</span>
<a href="#l4.25"></a><span id="l4.25" class="difflineminus">-      - This binding implements a full calendar list, that automatically adds</span>
<a href="#l4.26"></a><span id="l4.26" class="difflineminus">-      - and removes calendars when a calendar is registered or unregistered.</span>
<a href="#l4.27"></a><span id="l4.27" class="difflineminus">-      --&gt;</span>
<a href="#l4.28"></a><span id="l4.28" class="difflineminus">-    &lt;implementation&gt;</span>
<a href="#l4.29"></a><span id="l4.29" class="difflineminus">-      &lt;constructor&gt;&lt;![CDATA[</span>
<a href="#l4.30"></a><span id="l4.30" class="difflineminus">-          let calMgr = cal.getCalendarManager();</span>
<a href="#l4.31"></a><span id="l4.31" class="difflineminus">-          calMgr.addObserver(this.calMgrObserver);</span>
<a href="#l4.32"></a><span id="l4.32" class="difflineplus">+&quot;use strict&quot;;</span>
<a href="#l4.33"></a><span id="l4.33"> </span>
<a href="#l4.34"></a><span id="l4.34" class="difflineminus">-          this.dispatchEvent(new CustomEvent(&quot;bindingattached&quot;, { bubbles: false }));</span>
<a href="#l4.35"></a><span id="l4.35" class="difflineminus">-      ]]&gt;&lt;/constructor&gt;</span>
<a href="#l4.36"></a><span id="l4.36" class="difflineminus">-      &lt;destructor&gt;&lt;![CDATA[</span>
<a href="#l4.37"></a><span id="l4.37" class="difflineminus">-          let calMgr = cal.getCalendarManager();</span>
<a href="#l4.38"></a><span id="l4.38" class="difflineminus">-          calMgr.removeObserver(this.calMgrObserver);</span>
<a href="#l4.39"></a><span id="l4.39" class="difflineminus">-          this.calMgrObserver.listTree = null;</span>
<a href="#l4.40"></a><span id="l4.40" class="difflineminus">-      ]]&gt;&lt;/destructor&gt;</span>
<a href="#l4.41"></a><span id="l4.41" class="difflineplus">+/* import-globals-from ../calendar-common-sets.js */</span>
<a href="#l4.42"></a><span id="l4.42"> </span>
<a href="#l4.43"></a><span id="l4.43" class="difflineminus">-      &lt;field name=&quot;mAddingFromComposite&quot;&gt;false&lt;/field&gt;</span>
<a href="#l4.44"></a><span id="l4.44" class="difflineplus">+/* globals MozXULElement */</span>
<a href="#l4.45"></a><span id="l4.45"> </span>
<a href="#l4.46"></a><span id="l4.46" class="difflineminus">-      &lt;property name=&quot;compositeCalendar&quot;&gt;</span>
<a href="#l4.47"></a><span id="l4.47" class="difflineminus">-        &lt;getter&gt;&lt;![CDATA[</span>
<a href="#l4.48"></a><span id="l4.48" class="difflineminus">-            if (!this.mCompositeCalendar) {</span>
<a href="#l4.49"></a><span id="l4.49" class="difflineminus">-                throw Components.Exception(&quot;Calendar list has no composite calendar yet&quot;,</span>
<a href="#l4.50"></a><span id="l4.50" class="difflineminus">-                                           Cr.NS_ERROR_NOT_INITIALIZED);</span>
<a href="#l4.51"></a><span id="l4.51" class="difflineminus">-            }</span>
<a href="#l4.52"></a><span id="l4.52" class="difflineminus">-            return this.mCompositeCalendar;</span>
<a href="#l4.53"></a><span id="l4.53" class="difflineminus">-        ]]&gt;&lt;/getter&gt;</span>
<a href="#l4.54"></a><span id="l4.54" class="difflineminus">-        &lt;setter&gt;&lt;![CDATA[</span>
<a href="#l4.55"></a><span id="l4.55" class="difflineminus">-            this.mCompositeCalendar = val;</span>
<a href="#l4.56"></a><span id="l4.56" class="difflineminus">-            this.mCompositeCalendar.addObserver(this.compositeObserver);</span>
<a href="#l4.57"></a><span id="l4.57" class="difflineminus">-</span>
<a href="#l4.58"></a><span id="l4.58" class="difflineminus">-            // Now that we have a composite calendar, we can get all calendars</span>
<a href="#l4.59"></a><span id="l4.59" class="difflineminus">-            // from the calendar manager.</span>
<a href="#l4.60"></a><span id="l4.60" class="difflineminus">-            this.mAddingFromComposite = true;</span>
<a href="#l4.61"></a><span id="l4.61" class="difflineminus">-            let calendars = sortCalendarArray(cal.getCalendarManager().getCalendars({}));</span>
<a href="#l4.62"></a><span id="l4.62" class="difflineminus">-            calendars.forEach(this.addCalendar, this);</span>
<a href="#l4.63"></a><span id="l4.63" class="difflineminus">-            this.mAddingFromComposite = false;</span>
<a href="#l4.64"></a><span id="l4.64" class="difflineplus">+// Wrap in a block to prevent leaking to window scope.</span>
<a href="#l4.65"></a><span id="l4.65" class="difflineplus">+{</span>
<a href="#l4.66"></a><span id="l4.66" class="difflineplus">+    /**</span>
<a href="#l4.67"></a><span id="l4.67" class="difflineplus">+     * A basic calendar list tree, for displaying a list of calendars. For example, this custom</span>
<a href="#l4.68"></a><span id="l4.68" class="difflineplus">+     * element is typically used in the dialog that is shown when uninstalling a calendar provider</span>
<a href="#l4.69"></a><span id="l4.69" class="difflineplus">+     * such as the Google calendar provider. Other uses are implemented via subclasses.</span>
<a href="#l4.70"></a><span id="l4.70" class="difflineplus">+     *</span>
<a href="#l4.71"></a><span id="l4.71" class="difflineplus">+     * @extends MozTree</span>
<a href="#l4.72"></a><span id="l4.72" class="difflineplus">+     * @implements nsiTreeView</span>
<a href="#l4.73"></a><span id="l4.73" class="difflineplus">+     */</span>
<a href="#l4.74"></a><span id="l4.74" class="difflineplus">+    class CalendarListTree extends customElements.get(&quot;tree&quot;) {</span>
<a href="#l4.75"></a><span id="l4.75" class="difflineplus">+        // The mechanisms for inheriting attributes do not currently work in this case</span>
<a href="#l4.76"></a><span id="l4.76" class="difflineplus">+        // (see bug 1545824 and the manual inheritance code below). Keeping this here,</span>
<a href="#l4.77"></a><span id="l4.77" class="difflineplus">+        // commented out, for when those mechanisms work.</span>
<a href="#l4.78"></a><span id="l4.78" class="difflineplus">+        // static get inheritedAttributes() {</span>
<a href="#l4.79"></a><span id="l4.79" class="difflineplus">+        //     return {</span>
<a href="#l4.80"></a><span id="l4.80" class="difflineplus">+        //         // Include inherited attributes from MozTree super class,</span>
<a href="#l4.81"></a><span id="l4.81" class="difflineplus">+        //         // otherwise scrollbars are not hidden properly.</span>
<a href="#l4.82"></a><span id="l4.82" class="difflineplus">+        //         ...super.inheritedAttributes,</span>
<a href="#l4.83"></a><span id="l4.83" class="difflineplus">+        //         &quot;.treecols&quot;: &quot;hideheader&quot;,</span>
<a href="#l4.84"></a><span id="l4.84" class="difflineplus">+        //         &quot;.checkbox-treecol&quot;: &quot;cycler,hideheader&quot;,</span>
<a href="#l4.85"></a><span id="l4.85" class="difflineplus">+        //         &quot;.color-treecol&quot;: &quot;cycler,hideheader&quot;,</span>
<a href="#l4.86"></a><span id="l4.86" class="difflineplus">+        //         &quot;.calendarname-treecol&quot;: &quot;cycler,hideheader&quot;,</span>
<a href="#l4.87"></a><span id="l4.87" class="difflineplus">+        //         &quot;.status-treecol&quot;: &quot;cycler,hideheader&quot;,</span>
<a href="#l4.88"></a><span id="l4.88" class="difflineplus">+        //         &quot;.scrollbar-spacer&quot;: &quot;cycler,hideheader&quot;,</span>
<a href="#l4.89"></a><span id="l4.89" class="difflineplus">+        //         &quot;.treechildren&quot;: &quot;tooltip=childtooltip,context=childcontext&quot;,</span>
<a href="#l4.90"></a><span id="l4.90" class="difflineplus">+        //     };</span>
<a href="#l4.91"></a><span id="l4.91" class="difflineplus">+        // }</span>
<a href="#l4.92"></a><span id="l4.92"> </span>
<a href="#l4.93"></a><span id="l4.93" class="difflineminus">-            return val;</span>
<a href="#l4.94"></a><span id="l4.94" class="difflineminus">-        ]]&gt;&lt;/setter&gt;</span>
<a href="#l4.95"></a><span id="l4.95" class="difflineminus">-      &lt;/property&gt;</span>
<a href="#l4.96"></a><span id="l4.96" class="difflineplus">+        connectedCallback() {</span>
<a href="#l4.97"></a><span id="l4.97" class="difflineplus">+            if (this.delayConnectedCallback() || this.hasConnected) {</span>
<a href="#l4.98"></a><span id="l4.98" class="difflineplus">+                return;</span>
<a href="#l4.99"></a><span id="l4.99" class="difflineplus">+            }</span>
<a href="#l4.100"></a><span id="l4.100" class="difflineplus">+            this.hasConnected = true;</span>
<a href="#l4.101"></a><span id="l4.101"> </span>
<a href="#l4.102"></a><span id="l4.102" class="difflineminus">-      &lt;property name=&quot;calendars&quot;&gt;</span>
<a href="#l4.103"></a><span id="l4.103" class="difflineminus">-        &lt;getter&gt;&lt;![CDATA[</span>
<a href="#l4.104"></a><span id="l4.104" class="difflineminus">-            return this.mCalendarList;</span>
<a href="#l4.105"></a><span id="l4.105" class="difflineminus">-        ]]&gt;&lt;/getter&gt;</span>
<a href="#l4.106"></a><span id="l4.106" class="difflineminus">-        &lt;setter&gt;&lt;![CDATA[</span>
<a href="#l4.107"></a><span id="l4.107" class="difflineminus">-            // Setting calendars externally is not wanted. This is done internally</span>
<a href="#l4.108"></a><span id="l4.108" class="difflineminus">-            // in the compositeCalendar setter.</span>
<a href="#l4.109"></a><span id="l4.109" class="difflineminus">-            throw Components.Exception(&quot;Setting calendars on type='full' is not supported&quot;,</span>
<a href="#l4.110"></a><span id="l4.110" class="difflineminus">-                                       Cr.NS_ERROR_NOT_IMPLEMENTED);</span>
<a href="#l4.111"></a><span id="l4.111" class="difflineminus">-        ]]&gt;&lt;/setter&gt;</span>
<a href="#l4.112"></a><span id="l4.112" class="difflineminus">-      &lt;/property&gt;</span>
<a href="#l4.113"></a><span id="l4.113" class="difflineminus">-</span>
<a href="#l4.114"></a><span id="l4.114" class="difflineminus">-      &lt;field name=&quot;calMgrObserver&quot;&gt;&lt;![CDATA[</span>
<a href="#l4.115"></a><span id="l4.115" class="difflineminus">-        ({</span>
<a href="#l4.116"></a><span id="l4.116" class="difflineminus">-            listTree: this,</span>
<a href="#l4.117"></a><span id="l4.117" class="difflineminus">-            QueryInterface: ChromeUtils.generateQI([Ci.calICalendarManagerObserver]),</span>
<a href="#l4.118"></a><span id="l4.118" class="difflineplus">+            super.connectedCallback();</span>
<a href="#l4.119"></a><span id="l4.119"> </span>
<a href="#l4.120"></a><span id="l4.120" class="difflineminus">-            // calICalendarManagerObserver</span>
<a href="#l4.121"></a><span id="l4.121" class="difflineminus">-            onCalendarRegistered: function(aCalendar) {</span>
<a href="#l4.122"></a><span id="l4.122" class="difflineminus">-                this.listTree.addCalendar(aCalendar);</span>
<a href="#l4.123"></a><span id="l4.123" class="difflineminus">-                let composite = this.listTree.compositeCalendar;</span>
<a href="#l4.124"></a><span id="l4.124" class="difflineminus">-                let inComposite = aCalendar.getProperty(composite.prefPrefix +</span>
<a href="#l4.125"></a><span id="l4.125" class="difflineminus">-                                                        &quot;-in-composite&quot;);</span>
<a href="#l4.126"></a><span id="l4.126" class="difflineminus">-                if ((inComposite === null) || inComposite) {</span>
<a href="#l4.127"></a><span id="l4.127" class="difflineminus">-                    composite.addCalendar(aCalendar);</span>
<a href="#l4.128"></a><span id="l4.128" class="difflineminus">-                }</span>
<a href="#l4.129"></a><span id="l4.129" class="difflineminus">-            },</span>
<a href="#l4.130"></a><span id="l4.130" class="difflineminus">-</span>
<a href="#l4.131"></a><span id="l4.131" class="difflineminus">-            onCalendarUnregistering: function(aCalendar) {</span>
<a href="#l4.132"></a><span id="l4.132" class="difflineminus">-                this.listTree.removeCalendar(aCalendar);</span>
<a href="#l4.133"></a><span id="l4.133" class="difflineminus">-            },</span>
<a href="#l4.134"></a><span id="l4.134" class="difflineminus">-</span>
<a href="#l4.135"></a><span id="l4.135" class="difflineminus">-            onCalendarDeleting: function(aCalendar) {</span>
<a href="#l4.136"></a><span id="l4.136" class="difflineminus">-                // Now that the calendar is unregistered, update the commands to</span>
<a href="#l4.137"></a><span id="l4.137" class="difflineminus">-                // make sure that New Event/Task commands are correctly</span>
<a href="#l4.138"></a><span id="l4.138" class="difflineminus">-                // enabled/disabled.</span>
<a href="#l4.139"></a><span id="l4.139" class="difflineminus">-                document.commandDispatcher.updateCommands(&quot;calendar_commands&quot;);</span>
<a href="#l4.140"></a><span id="l4.140" class="difflineminus">-            }</span>
<a href="#l4.141"></a><span id="l4.141" class="difflineminus">-        })</span>
<a href="#l4.142"></a><span id="l4.142" class="difflineminus">-      ]]&gt;&lt;/field&gt;</span>
<a href="#l4.143"></a><span id="l4.143" class="difflineminus">-      &lt;field name=&quot;compositeObserver&quot;&gt;&lt;![CDATA[</span>
<a href="#l4.144"></a><span id="l4.144" class="difflineminus">-        ({</span>
<a href="#l4.145"></a><span id="l4.145" class="difflineminus">-            listTree: this,</span>
<a href="#l4.146"></a><span id="l4.146" class="difflineminus">-            QueryInterface: cal.generateQI([</span>
<a href="#l4.147"></a><span id="l4.147" class="difflineminus">-                Ci.calICompositeObserver,</span>
<a href="#l4.148"></a><span id="l4.148" class="difflineminus">-                Ci.calIObserver</span>
<a href="#l4.149"></a><span id="l4.149" class="difflineminus">-            ]),</span>
<a href="#l4.150"></a><span id="l4.150" class="difflineminus">-</span>
<a href="#l4.151"></a><span id="l4.151" class="difflineminus">-            // calICompositeObserver</span>
<a href="#l4.152"></a><span id="l4.152" class="difflineminus">-            onCalendarAdded: function(aCalendar) {</span>
<a href="#l4.153"></a><span id="l4.153" class="difflineminus">-                // Make sure the checkbox state is updated</span>
<a href="#l4.154"></a><span id="l4.154" class="difflineminus">-                this.listTree.updateCalendar(aCalendar);</span>
<a href="#l4.155"></a><span id="l4.155" class="difflineminus">-            },</span>
<a href="#l4.156"></a><span id="l4.156" class="difflineplus">+            // We set a `type` attribute on each treecol element so we can identify which is which,</span>
<a href="#l4.157"></a><span id="l4.157" class="difflineplus">+            // since we are not using ids (to avoid duplicate id problems).</span>
<a href="#l4.158"></a><span id="l4.158" class="difflineplus">+            this.appendChild(MozXULElement.parseXULToFragment(`</span>
<a href="#l4.159"></a><span id="l4.159" class="difflineplus">+                &lt;treecols class=&quot;treecols&quot;</span>
<a href="#l4.160"></a><span id="l4.160" class="difflineplus">+                          hideheader=&quot;true&quot;&gt;</span>
<a href="#l4.161"></a><span id="l4.161" class="difflineplus">+                  &lt;treecol class=&quot;checkbox-treecol&quot;</span>
<a href="#l4.162"></a><span id="l4.162" class="difflineplus">+                           type=&quot;checkbox-treecol&quot;</span>
<a href="#l4.163"></a><span id="l4.163" class="difflineplus">+                           hideheader=&quot;true&quot;</span>
<a href="#l4.164"></a><span id="l4.164" class="difflineplus">+                           cycler=&quot;true&quot;</span>
<a href="#l4.165"></a><span id="l4.165" class="difflineplus">+                           width=&quot;17&quot;/&gt;</span>
<a href="#l4.166"></a><span id="l4.166" class="difflineplus">+                  &lt;treecol class=&quot;color-treecol&quot;</span>
<a href="#l4.167"></a><span id="l4.167" class="difflineplus">+                           type=&quot;color-treecol&quot;</span>
<a href="#l4.168"></a><span id="l4.168" class="difflineplus">+                           hideheader=&quot;true&quot;</span>
<a href="#l4.169"></a><span id="l4.169" class="difflineplus">+                           width=&quot;16&quot;/&gt;</span>
<a href="#l4.170"></a><span id="l4.170" class="difflineplus">+                  &lt;treecol class=&quot;calendarname-treecol&quot;</span>
<a href="#l4.171"></a><span id="l4.171" class="difflineplus">+                           type=&quot;calendarname-treecol&quot;</span>
<a href="#l4.172"></a><span id="l4.172" class="difflineplus">+                           hideheader=&quot;true&quot;</span>
<a href="#l4.173"></a><span id="l4.173" class="difflineplus">+                           label=&quot;&amp;calendar.unifinder.tree.calendarname.label;&quot;</span>
<a href="#l4.174"></a><span id="l4.174" class="difflineplus">+                           flex=&quot;1&quot;/&gt;</span>
<a href="#l4.175"></a><span id="l4.175" class="difflineplus">+                  &lt;treecol class=&quot;status-treecol&quot;</span>
<a href="#l4.176"></a><span id="l4.176" class="difflineplus">+                           type=&quot;status-treecol&quot;</span>
<a href="#l4.177"></a><span id="l4.177" class="difflineplus">+                           hideheader=&quot;true&quot;</span>
<a href="#l4.178"></a><span id="l4.178" class="difflineplus">+                           width=&quot;18&quot;/&gt;</span>
<a href="#l4.179"></a><span id="l4.179" class="difflineplus">+                  &lt;treecol class=&quot;scrollbar-spacer&quot;</span>
<a href="#l4.180"></a><span id="l4.180" class="difflineplus">+                           type=&quot;scrollbar-spacer&quot;</span>
<a href="#l4.181"></a><span id="l4.181" class="difflineplus">+                           hideheader=&quot;true&quot;</span>
<a href="#l4.182"></a><span id="l4.182" class="difflineplus">+                           fixed=&quot;true&quot;&gt;</span>
<a href="#l4.183"></a><span id="l4.183" class="difflineplus">+                    &lt;!-- This treecol is a very elegant workaround to make sure the last column</span>
<a href="#l4.184"></a><span id="l4.184" class="difflineplus">+                         is not covered by the scrollbar in case of an overflow. This</span>
<a href="#l4.185"></a><span id="l4.185" class="difflineplus">+                         treecol needs to be here in the last position. --&gt;</span>
<a href="#l4.186"></a><span id="l4.186" class="difflineplus">+                    &lt;slider class=&quot;scrollbar-slider&quot;</span>
<a href="#l4.187"></a><span id="l4.187" class="difflineplus">+                            orient=&quot;vertical&quot;/&gt;</span>
<a href="#l4.188"></a><span id="l4.188" class="difflineplus">+                  &lt;/treecol&gt;</span>
<a href="#l4.189"></a><span id="l4.189" class="difflineplus">+                &lt;/treecols&gt;</span>
<a href="#l4.190"></a><span id="l4.190" class="difflineplus">+                &lt;treechildren class=&quot;treechildren&quot;/&gt;</span>
<a href="#l4.191"></a><span id="l4.191" class="difflineplus">+            `,</span>
<a href="#l4.192"></a><span id="l4.192" class="difflineplus">+                [&quot;chrome://calendar/locale/calendar.dtd&quot;]</span>
<a href="#l4.193"></a><span id="l4.193" class="difflineplus">+            ));</span>
<a href="#l4.194"></a><span id="l4.194"> </span>
<a href="#l4.195"></a><span id="l4.195" class="difflineminus">-            onCalendarRemoved: function(aCalendar) {</span>
<a href="#l4.196"></a><span id="l4.196" class="difflineminus">-                // Make sure the checkbox state is updated</span>
<a href="#l4.197"></a><span id="l4.197" class="difflineminus">-                this.listTree.updateCalendar(aCalendar);</span>
<a href="#l4.198"></a><span id="l4.198" class="difflineminus">-            },</span>
<a href="#l4.199"></a><span id="l4.199" class="difflineplus">+            // Set default attributes.</span>
<a href="#l4.200"></a><span id="l4.200"> </span>
<a href="#l4.201"></a><span id="l4.201" class="difflineminus">-            onDefaultCalendarChanged: function(aCalendar) {</span>
<a href="#l4.202"></a><span id="l4.202" class="difflineminus">-            },</span>
<a href="#l4.203"></a><span id="l4.203" class="difflineminus">-</span>
<a href="#l4.204"></a><span id="l4.204" class="difflineminus">-            // calIObserver</span>
<a href="#l4.205"></a><span id="l4.205" class="difflineminus">-            onStartBatch: function() { },</span>
<a href="#l4.206"></a><span id="l4.206" class="difflineminus">-            onEndBatch: function() { },</span>
<a href="#l4.207"></a><span id="l4.207" class="difflineminus">-            onLoad: function() { },</span>
<a href="#l4.208"></a><span id="l4.208" class="difflineplus">+            this.classList.add(&quot;calendar-list-tree&quot;);</span>
<a href="#l4.209"></a><span id="l4.209"> </span>
<a href="#l4.210"></a><span id="l4.210" class="difflineminus">-            onAddItem: function(aItem) {</span>
<a href="#l4.211"></a><span id="l4.211" class="difflineminus">-                if (aItem.calendar.type != &quot;caldav&quot;) {</span>
<a href="#l4.212"></a><span id="l4.212" class="difflineminus">-                    this.listTree.ensureCalendarVisible(aItem.calendar);</span>
<a href="#l4.213"></a><span id="l4.213" class="difflineminus">-                }</span>
<a href="#l4.214"></a><span id="l4.214" class="difflineminus">-            },</span>
<a href="#l4.215"></a><span id="l4.215" class="difflineminus">-            onModifyItem: function(aNewItem, aOldItem) {</span>
<a href="#l4.216"></a><span id="l4.216" class="difflineminus">-                if (aNewItem.calendar.type != &quot;caldav&quot;) {</span>
<a href="#l4.217"></a><span id="l4.217" class="difflineminus">-                    this.listTree.ensureCalendarVisible(aNewItem.calendar);</span>
<a href="#l4.218"></a><span id="l4.218" class="difflineminus">-                }</span>
<a href="#l4.219"></a><span id="l4.219" class="difflineminus">-            },</span>
<a href="#l4.220"></a><span id="l4.220" class="difflineminus">-            onDeleteItem: function(aDeletedItem) { },</span>
<a href="#l4.221"></a><span id="l4.221" class="difflineminus">-            onError: function(aCalendar, aErrNo, aMessage) { },</span>
<a href="#l4.222"></a><span id="l4.222" class="difflineplus">+            if (!this.hasAttribute(&quot;inherits&quot;)) {</span>
<a href="#l4.223"></a><span id="l4.223" class="difflineplus">+                this.setAttribute(&quot;inherits&quot;, &quot;hidecolumnpicker&quot;);</span>
<a href="#l4.224"></a><span id="l4.224" class="difflineplus">+            }</span>
<a href="#l4.225"></a><span id="l4.225" class="difflineplus">+            if (!this.hasAttribute(&quot;hidecolumnpicker&quot;)) {</span>
<a href="#l4.226"></a><span id="l4.226" class="difflineplus">+                this.setAttribute(&quot;hidecolumnpicker&quot;, &quot;true&quot;);</span>
<a href="#l4.227"></a><span id="l4.227" class="difflineplus">+            }</span>
<a href="#l4.228"></a><span id="l4.228" class="difflineplus">+            if (!this.hasAttribute(&quot;seltype&quot;)) {</span>
<a href="#l4.229"></a><span id="l4.229" class="difflineplus">+                this.setAttribute(&quot;seltype&quot;, &quot;single&quot;);</span>
<a href="#l4.230"></a><span id="l4.230" class="difflineplus">+            }</span>
<a href="#l4.231"></a><span id="l4.231" class="difflineplus">+            if (!this.hasAttribute(&quot;flex&quot;)) {</span>
<a href="#l4.232"></a><span id="l4.232" class="difflineplus">+                this.setAttribute(&quot;flex&quot;, &quot;1&quot;);</span>
<a href="#l4.233"></a><span id="l4.233" class="difflineplus">+            }</span>
<a href="#l4.234"></a><span id="l4.234"> </span>
<a href="#l4.235"></a><span id="l4.235" class="difflineminus">-            onPropertyChanged: function(aCalendar, aName, aValue, aOldValue) {</span>
<a href="#l4.236"></a><span id="l4.236" class="difflineminus">-                switch (aName) {</span>
<a href="#l4.237"></a><span id="l4.237" class="difflineminus">-                    case &quot;disabled&quot;:</span>
<a href="#l4.238"></a><span id="l4.238" class="difflineminus">-                    case &quot;readOnly&quot;:</span>
<a href="#l4.239"></a><span id="l4.239" class="difflineminus">-                        calendarUpdateNewItemsCommand();</span>
<a href="#l4.240"></a><span id="l4.240" class="difflineminus">-                        document.commandDispatcher.updateCommands(&quot;calendar_commands&quot;);</span>
<a href="#l4.241"></a><span id="l4.241" class="difflineminus">-                        break;</span>
<a href="#l4.242"></a><span id="l4.242" class="difflineminus">-                }</span>
<a href="#l4.243"></a><span id="l4.243" class="difflineminus">-            },</span>
<a href="#l4.244"></a><span id="l4.244" class="difflineplus">+            const treechildren = this.querySelector(&quot;.treechildren&quot;);</span>
<a href="#l4.245"></a><span id="l4.245"> </span>
<a href="#l4.246"></a><span id="l4.246" class="difflineminus">-            onPropertyDeleting: function(aCalendar, aName) {</span>
<a href="#l4.247"></a><span id="l4.247" class="difflineplus">+            // Manual attribute inheritance, instead of calling this.initializeAttributeInheritance.</span>
<a href="#l4.248"></a><span id="l4.248" class="difflineplus">+            // (Note that initializeAttributeInheritance is also called by super.connectedCallback.)</span>
<a href="#l4.249"></a><span id="l4.249" class="difflineplus">+            // Because the MozTree super class has a shadowDOM, the attribute inheritance</span>
<a href="#l4.250"></a><span id="l4.250" class="difflineplus">+            // mechanisms don't work, because the code tries to inherit from the shadowDOM</span>
<a href="#l4.251"></a><span id="l4.251" class="difflineplus">+            // (because it exists) and does not find the elements there. So we handle it manually.</span>
<a href="#l4.252"></a><span id="l4.252" class="difflineplus">+            if (this.hasAttribute(&quot;childtooltip&quot;)) {</span>
<a href="#l4.253"></a><span id="l4.253" class="difflineplus">+                treechildren.setAttribute(&quot;tooltip&quot;, this.getAttribute(&quot;childtooltip&quot;));</span>
<a href="#l4.254"></a><span id="l4.254" class="difflineplus">+            }</span>
<a href="#l4.255"></a><span id="l4.255" class="difflineplus">+            if (this.hasAttribute(&quot;childcontext&quot;)) {</span>
<a href="#l4.256"></a><span id="l4.256" class="difflineplus">+                treechildren.setAttribute(&quot;context&quot;, this.getAttribute(&quot;childcontext&quot;));</span>
<a href="#l4.257"></a><span id="l4.257">             }</span>
<a href="#l4.258"></a><span id="l4.258" class="difflineminus">-        })</span>
<a href="#l4.259"></a><span id="l4.259" class="difflineminus">-      ]]&gt;&lt;/field&gt;</span>
<a href="#l4.260"></a><span id="l4.260" class="difflineminus">-    &lt;/implementation&gt;</span>
<a href="#l4.261"></a><span id="l4.261" class="difflineminus">-    &lt;handlers&gt;</span>
<a href="#l4.262"></a><span id="l4.262" class="difflineminus">-      &lt;handler event=&quot;dblclick&quot;&gt;&lt;![CDATA[</span>
<a href="#l4.263"></a><span id="l4.263" class="difflineminus">-          let col = {};</span>
<a href="#l4.264"></a><span id="l4.264" class="difflineminus">-          let calendar = this.getCalendarFromEvent(event, col);</span>
<a href="#l4.265"></a><span id="l4.265" class="difflineminus">-          if (event.button != 0 ||</span>
<a href="#l4.266"></a><span id="l4.266" class="difflineminus">-              (col.value &amp;&amp; col.value.element &amp;&amp;</span>
<a href="#l4.267"></a><span id="l4.267" class="difflineminus">-               col.value.element.getAttribute(&quot;anonid&quot;) == &quot;checkbox-treecol&quot;)) {</span>
<a href="#l4.268"></a><span id="l4.268" class="difflineminus">-              // Only left clicks that are not on the checkbox column</span>
<a href="#l4.269"></a><span id="l4.269" class="difflineminus">-              return;</span>
<a href="#l4.270"></a><span id="l4.270" class="difflineminus">-          }</span>
<a href="#l4.271"></a><span id="l4.271" class="difflineminus">-          if (calendar) {</span>
<a href="#l4.272"></a><span id="l4.272" class="difflineminus">-              cal.window.openCalendarProperties(window, calendar);</span>
<a href="#l4.273"></a><span id="l4.273" class="difflineminus">-          } else {</span>
<a href="#l4.274"></a><span id="l4.274" class="difflineminus">-              cal.window.openCalendarWizard(window);</span>
<a href="#l4.275"></a><span id="l4.275" class="difflineminus">-          }</span>
<a href="#l4.276"></a><span id="l4.276" class="difflineminus">-      ]]&gt;&lt;/handler&gt;</span>
<a href="#l4.277"></a><span id="l4.277" class="difflineminus">-    &lt;/handlers&gt;</span>
<a href="#l4.278"></a><span id="l4.278" class="difflineminus">-  &lt;/binding&gt;</span>
<a href="#l4.279"></a><span id="l4.279" class="difflineplus">+</span>
<a href="#l4.280"></a><span id="l4.280" class="difflineplus">+            // Event Listeners</span>
<a href="#l4.281"></a><span id="l4.281" class="difflineplus">+</span>
<a href="#l4.282"></a><span id="l4.282" class="difflineplus">+            treechildren.addEventListener(&quot;dragstart&quot;, this.onDragStart.bind(this));</span>
<a href="#l4.283"></a><span id="l4.283" class="difflineplus">+            treechildren.addEventListener(&quot;overflow&quot;, this.displayScrollbarSpacer.bind(this, true));</span>
<a href="#l4.284"></a><span id="l4.284" class="difflineplus">+            treechildren.addEventListener(&quot;underflow&quot;, this.displayScrollbarSpacer.bind(this, false));</span>
<a href="#l4.285"></a><span id="l4.285" class="difflineplus">+</span>
<a href="#l4.286"></a><span id="l4.286" class="difflineplus">+            this.addEventListener(&quot;select&quot;, (event) =&gt; {</span>
<a href="#l4.287"></a><span id="l4.287" class="difflineplus">+                this.compositeCalendar.defaultCalendar = this.getCalendar(this.tree.currentIndex);</span>
<a href="#l4.288"></a><span id="l4.288" class="difflineplus">+            });</span>
<a href="#l4.289"></a><span id="l4.289" class="difflineplus">+</span>
<a href="#l4.290"></a><span id="l4.290" class="difflineplus">+            this.addEventListener(&quot;keypress&quot;, (event) =&gt; {</span>
<a href="#l4.291"></a><span id="l4.291" class="difflineplus">+                switch (event.key) {</span>
<a href="#l4.292"></a><span id="l4.292" class="difflineplus">+                    case &quot;Delete&quot;: {</span>
<a href="#l4.293"></a><span id="l4.293" class="difflineplus">+                        if (this.writable) {</span>
<a href="#l4.294"></a><span id="l4.294" class="difflineplus">+                            promptDeleteCalendar(this.compositeCalendar.defaultCalendar);</span>
<a href="#l4.295"></a><span id="l4.295" class="difflineplus">+                            event.preventDefault();</span>
<a href="#l4.296"></a><span id="l4.296" class="difflineplus">+                        }</span>
<a href="#l4.297"></a><span id="l4.297" class="difflineplus">+                        break;</span>
<a href="#l4.298"></a><span id="l4.298" class="difflineplus">+                    }</span>
<a href="#l4.299"></a><span id="l4.299" class="difflineplus">+                    case &quot; &quot;: {</span>
<a href="#l4.300"></a><span id="l4.300" class="difflineplus">+                        if (this.tree.currentIndex &gt; -1) {</span>
<a href="#l4.301"></a><span id="l4.301" class="difflineplus">+                            const col = this.tree.columns.getColumnFor(</span>
<a href="#l4.302"></a><span id="l4.302" class="difflineplus">+                                this.querySelector(&quot;.checkbox-treecol&quot;));</span>
<a href="#l4.303"></a><span id="l4.303"> </span>
<a href="#l4.304"></a><span id="l4.304" class="difflineminus">-  &lt;binding id=&quot;calendar-list-tree&quot;&gt;</span>
<a href="#l4.305"></a><span id="l4.305" class="difflineminus">-    &lt;content&gt;</span>
<a href="#l4.306"></a><span id="l4.306" class="difflineminus">-      &lt;xul:tree anonid=&quot;tree&quot;</span>
<a href="#l4.307"></a><span id="l4.307" class="difflineminus">-                xbl:inherits=&quot;hidecolumnpicker&quot;</span>
<a href="#l4.308"></a><span id="l4.308" class="difflineminus">-                hidecolumnpicker=&quot;true&quot;</span>
<a href="#l4.309"></a><span id="l4.309" class="difflineminus">-                seltype=&quot;single&quot;</span>
<a href="#l4.310"></a><span id="l4.310" class="difflineminus">-                flex=&quot;1&quot;&gt;</span>
<a href="#l4.311"></a><span id="l4.311" class="difflineminus">-        &lt;xul:treecols anonid=&quot;treecols&quot;</span>
<a href="#l4.312"></a><span id="l4.312" class="difflineminus">-                      xbl:inherits=&quot;hideheader&quot;</span>
<a href="#l4.313"></a><span id="l4.313" class="difflineminus">-                      hideheader=&quot;true&quot;&gt;</span>
<a href="#l4.314"></a><span id="l4.314" class="difflineminus">-          &lt;xul:treecol anonid=&quot;checkbox-treecol&quot;</span>
<a href="#l4.315"></a><span id="l4.315" class="difflineminus">-                       xbl:inherits=&quot;cycler,hideheader&quot;</span>
<a href="#l4.316"></a><span id="l4.316" class="difflineminus">-                       cycler=&quot;true&quot;</span>
<a href="#l4.317"></a><span id="l4.317" class="difflineminus">-                       hideheader=&quot;true&quot;</span>
<a href="#l4.318"></a><span id="l4.318" class="difflineminus">-                       width=&quot;17&quot;/&gt;</span>
<a href="#l4.319"></a><span id="l4.319" class="difflineminus">-          &lt;xul:treecol anonid=&quot;color-treecol&quot;</span>
<a href="#l4.320"></a><span id="l4.320" class="difflineminus">-                       xbl:inherits=&quot;cycler,hideheader&quot;</span>
<a href="#l4.321"></a><span id="l4.321" class="difflineminus">-                       hideheader=&quot;true&quot;</span>
<a href="#l4.322"></a><span id="l4.322" class="difflineminus">-                       width=&quot;16&quot;/&gt;</span>
<a href="#l4.323"></a><span id="l4.323" class="difflineminus">-          &lt;xul:treecol anonid=&quot;calendarname-treecol&quot;</span>
<a href="#l4.324"></a><span id="l4.324" class="difflineminus">-                       xbl:inherits=&quot;cycler,hideheader&quot;</span>
<a href="#l4.325"></a><span id="l4.325" class="difflineminus">-                       hideheader=&quot;true&quot;</span>
<a href="#l4.326"></a><span id="l4.326" class="difflineminus">-                       label=&quot;&amp;calendar.unifinder.tree.calendarname.label;&quot;</span>
<a href="#l4.327"></a><span id="l4.327" class="difflineminus">-                       flex=&quot;1&quot;/&gt;</span>
<a href="#l4.328"></a><span id="l4.328" class="difflineminus">-          &lt;xul:treecol anonid=&quot;status-treecol&quot;</span>
<a href="#l4.329"></a><span id="l4.329" class="difflineminus">-                       xbl:inherits=&quot;cycler,hideheader&quot;</span>
<a href="#l4.330"></a><span id="l4.330" class="difflineminus">-                       hideheader=&quot;true&quot;</span>
<a href="#l4.331"></a><span id="l4.331" class="difflineminus">-                       width=&quot;18&quot;/&gt;</span>
<a href="#l4.332"></a><span id="l4.332" class="difflineminus">-          &lt;children includes=&quot;treecol&quot;/&gt;</span>
<a href="#l4.333"></a><span id="l4.333" class="difflineminus">-          &lt;xul:treecol anonid=&quot;scrollbar-spacer&quot;</span>
<a href="#l4.334"></a><span id="l4.334" class="difflineminus">-                       xbl:inherits=&quot;cycler,hideheader&quot;</span>
<a href="#l4.335"></a><span id="l4.335" class="difflineminus">-                       fixed=&quot;true&quot;</span>
<a href="#l4.336"></a><span id="l4.336" class="difflineminus">-                       hideheader=&quot;true&quot;&gt;</span>
<a href="#l4.337"></a><span id="l4.337" class="difflineminus">-            &lt;!-- This is a very elegant workaround to make sure the last column</span>
<a href="#l4.338"></a><span id="l4.338" class="difflineminus">-                 is not covered by the scrollbar in case of an overflow. This</span>
<a href="#l4.339"></a><span id="l4.339" class="difflineminus">-                 treecol needs to be here last --&gt;</span>
<a href="#l4.340"></a><span id="l4.340" class="difflineminus">-            &lt;xul:slider anonid=&quot;scrollbar-slider&quot; orient=&quot;vertical&quot;/&gt;</span>
<a href="#l4.341"></a><span id="l4.341" class="difflineminus">-          &lt;/xul:treecol&gt;</span>
<a href="#l4.342"></a><span id="l4.342" class="difflineminus">-        &lt;/xul:treecols&gt;</span>
<a href="#l4.343"></a><span id="l4.343" class="difflineminus">-        &lt;xul:treechildren anonid=&quot;treechildren&quot;</span>
<a href="#l4.344"></a><span id="l4.344" class="difflineminus">-                          xbl:inherits=&quot;tooltip=childtooltip,context=childcontext&quot;</span>
<a href="#l4.345"></a><span id="l4.345" class="difflineminus">-                          tooltip=&quot;_child&quot;</span>
<a href="#l4.346"></a><span id="l4.346" class="difflineminus">-                          context=&quot;_child&quot;</span>
<a href="#l4.347"></a><span id="l4.347" class="difflineminus">-                          ondragstart=&quot;onDragStart(event);&quot;</span>
<a href="#l4.348"></a><span id="l4.348" class="difflineminus">-                          onoverflow=&quot;displayScrollbarSpacer(true)&quot;</span>
<a href="#l4.349"></a><span id="l4.349" class="difflineminus">-                          onunderflow=&quot;displayScrollbarSpacer(false)&quot;&gt;</span>
<a href="#l4.350"></a><span id="l4.350" class="difflineminus">-          &lt;children includes=&quot;tooltip|menupopup&quot;/&gt;</span>
<a href="#l4.351"></a><span id="l4.351" class="difflineminus">-        &lt;/xul:treechildren&gt;</span>
<a href="#l4.352"></a><span id="l4.352" class="difflineminus">-      &lt;/xul:tree&gt;</span>
<a href="#l4.353"></a><span id="l4.353" class="difflineminus">-    &lt;/content&gt;</span>
<a href="#l4.354"></a><span id="l4.354" class="difflineminus">-    &lt;implementation implements=&quot;nsITreeView&quot;&gt;</span>
<a href="#l4.355"></a><span id="l4.355" class="difflineplus">+                            this.cycleCell(this.tree.currentIndex, col);</span>
<a href="#l4.356"></a><span id="l4.356" class="difflineplus">+                            this.tree.invalidateRow(this.tree.currentIndex);</span>
<a href="#l4.357"></a><span id="l4.357" class="difflineplus">+                            event.preventDefault();</span>
<a href="#l4.358"></a><span id="l4.358" class="difflineplus">+                        }</span>
<a href="#l4.359"></a><span id="l4.359" class="difflineplus">+                        break;</span>
<a href="#l4.360"></a><span id="l4.360" class="difflineplus">+                    }</span>
<a href="#l4.361"></a><span id="l4.361" class="difflineplus">+                    case &quot;ArrowUp&quot;:</span>
<a href="#l4.362"></a><span id="l4.362" class="difflineplus">+                    case &quot;ArrowDown&quot;: {</span>
<a href="#l4.363"></a><span id="l4.363" class="difflineplus">+                        // This is for re-ordering the items when allowDrag=&quot;true&quot;. Changing the</span>
<a href="#l4.364"></a><span id="l4.364" class="difflineplus">+                        // currently selected item with up/down arrow keys is done by listeners in</span>
<a href="#l4.365"></a><span id="l4.365" class="difflineplus">+                        // the MozTree super class.</span>
<a href="#l4.366"></a><span id="l4.366" class="difflineplus">+                        if (!this.allowDrag) {</span>
<a href="#l4.367"></a><span id="l4.367" class="difflineplus">+                            return;</span>
<a href="#l4.368"></a><span id="l4.368" class="difflineplus">+                        }</span>
<a href="#l4.369"></a><span id="l4.369" class="difflineplus">+                        const index = this.tree.currentIndex;</span>
<a href="#l4.370"></a><span id="l4.370" class="difflineplus">+</span>
<a href="#l4.371"></a><span id="l4.371" class="difflineplus">+                        if ((event.key == &quot;ArrowUp&quot; &amp;&amp; index &lt; this.mCalendarList.length - 1) ||</span>
<a href="#l4.372"></a><span id="l4.372" class="difflineplus">+                            (event.key == &quot;ArrowDown&quot; &amp;&amp; index &gt; 0)) {</span>
<a href="#l4.373"></a><span id="l4.373" class="difflineplus">+                            // Note: this is counter-intuitive: up is -1, down is 1.</span>
<a href="#l4.374"></a><span id="l4.374" class="difflineplus">+                            const newIndex = index + (event.key == &quot;ArrowUp&quot; ? -1 : 1);</span>
<a href="#l4.375"></a><span id="l4.375" class="difflineplus">+</span>
<a href="#l4.376"></a><span id="l4.376" class="difflineplus">+                            this.mCalendarList.splice(newIndex, 0, this.mCalendarList.splice(index, 1)[0]);</span>
<a href="#l4.377"></a><span id="l4.377" class="difflineplus">+</span>
<a href="#l4.378"></a><span id="l4.378" class="difflineplus">+                            const [from, to] = event.key == &quot;ArrowUp&quot; ? [index, newIndex] : [newIndex, index];</span>
<a href="#l4.379"></a><span id="l4.379" class="difflineplus">+                            this.tree.invalidateRange(from, to);</span>
<a href="#l4.380"></a><span id="l4.380"> </span>
<a href="#l4.381"></a><span id="l4.381" class="difflineminus">-      &lt;field name=&quot;mCalendarList&quot;&gt;[]&lt;/field&gt;</span>
<a href="#l4.382"></a><span id="l4.382" class="difflineminus">-      &lt;field name=&quot;mCompositeCalendar&quot;&gt;null&lt;/field&gt;</span>
<a href="#l4.383"></a><span id="l4.383" class="difflineminus">-      &lt;field name=&quot;treebox&quot;&gt;null&lt;/field&gt;</span>
<a href="#l4.384"></a><span id="l4.384" class="difflineminus">-      &lt;field name=&quot;ruleCache&quot;&gt;null&lt;/field&gt;</span>
<a href="#l4.385"></a><span id="l4.385" class="difflineminus">-      &lt;field name=&quot;mCachedSheet&quot;&gt;null&lt;/field&gt;</span>
<a href="#l4.386"></a><span id="l4.386" class="difflineplus">+                            if (this.tree.view.selection.isSelected(index)) {</span>
<a href="#l4.387"></a><span id="l4.387" class="difflineplus">+                                this.tree.view.selection.toggleSelect(index);</span>
<a href="#l4.388"></a><span id="l4.388" class="difflineplus">+                                this.tree.view.selection.toggleSelect(newIndex);</span>
<a href="#l4.389"></a><span id="l4.389" class="difflineplus">+                            }</span>
<a href="#l4.390"></a><span id="l4.390" class="difflineplus">+                            if (this.tree.view.selection.currentIndex == index) {</span>
<a href="#l4.391"></a><span id="l4.391" class="difflineplus">+                                this.tree.view.selection.currentIndex = newIndex;</span>
<a href="#l4.392"></a><span id="l4.392" class="difflineplus">+                            }</span>
<a href="#l4.393"></a><span id="l4.393"> </span>
<a href="#l4.394"></a><span id="l4.394" class="difflineminus">-      &lt;field name=&quot;mCycleCalendarFlag&quot;&gt;null&lt;/field&gt;</span>
<a href="#l4.395"></a><span id="l4.395" class="difflineminus">-      &lt;field name=&quot;mCycleTimer&quot;&gt;null&lt;/field&gt;</span>
<a href="#l4.396"></a><span id="l4.396" class="difflineminus">-      &lt;field name=&quot;cycleDebounce&quot;&gt;200&lt;/field&gt;</span>
<a href="#l4.397"></a><span id="l4.397" class="difflineplus">+                            // Fire event.</span>
<a href="#l4.398"></a><span id="l4.398" class="difflineplus">+                            this.sortOrderChanged();</span>
<a href="#l4.399"></a><span id="l4.399" class="difflineplus">+                        }</span>
<a href="#l4.400"></a><span id="l4.400" class="difflineplus">+                        event.preventDefault();</span>
<a href="#l4.401"></a><span id="l4.401" class="difflineplus">+                        break;</span>
<a href="#l4.402"></a><span id="l4.402" class="difflineplus">+                    }</span>
<a href="#l4.403"></a><span id="l4.403" class="difflineplus">+                }</span>
<a href="#l4.404"></a><span id="l4.404" class="difflineplus">+            });</span>
<a href="#l4.405"></a><span id="l4.405" class="difflineplus">+</span>
<a href="#l4.406"></a><span id="l4.406" class="difflineplus">+            this.mCalendarList = [];</span>
<a href="#l4.407"></a><span id="l4.407" class="difflineplus">+            this.mCompositeCalendar = null;</span>
<a href="#l4.408"></a><span id="l4.408" class="difflineplus">+            this.tree = null;</span>
<a href="#l4.409"></a><span id="l4.409" class="difflineplus">+            this.ruleCache = {};</span>
<a href="#l4.410"></a><span id="l4.410" class="difflineplus">+            this.mCachedSheet = null;</span>
<a href="#l4.411"></a><span id="l4.411" class="difflineplus">+            this.mCycleCalendarFlag = {};</span>
<a href="#l4.412"></a><span id="l4.412" class="difflineplus">+            this.mCycleTimer = null;</span>
<a href="#l4.413"></a><span id="l4.413" class="difflineplus">+            this.cycleDebounce = 200;</span>
<a href="#l4.414"></a><span id="l4.414"> </span>
<a href="#l4.415"></a><span id="l4.415" class="difflineminus">-      &lt;constructor&gt;&lt;![CDATA[</span>
<a href="#l4.416"></a><span id="l4.416" class="difflineminus">-          customElements.upgrade(this.tree);</span>
<a href="#l4.417"></a><span id="l4.417" class="difflineminus">-          this.tree.view = this;</span>
<a href="#l4.418"></a><span id="l4.418" class="difflineminus">-          this.ruleCache = {};</span>
<a href="#l4.419"></a><span id="l4.419" class="difflineminus">-          this.mCycleCalendarFlag = {};</span>
<a href="#l4.420"></a><span id="l4.420" class="difflineminus">-      ]]&gt;&lt;/constructor&gt;</span>
<a href="#l4.421"></a><span id="l4.421" class="difflineminus">-      &lt;destructor&gt;&lt;![CDATA[</span>
<a href="#l4.422"></a><span id="l4.422" class="difflineminus">-          // Clean up the calendar manager observers. Do not use removeCalendar</span>
<a href="#l4.423"></a><span id="l4.423" class="difflineminus">-          // here since that will remove the calendar from the composite calendar.</span>
<a href="#l4.424"></a><span id="l4.424" class="difflineminus">-          for (let calendar of this.mCalendarList) {</span>
<a href="#l4.425"></a><span id="l4.425" class="difflineminus">-              calendar.removeObserver(this.calObserver);</span>
<a href="#l4.426"></a><span id="l4.426" class="difflineminus">-          }</span>
<a href="#l4.427"></a><span id="l4.427" class="difflineminus">-</span>
<a href="#l4.428"></a><span id="l4.428" class="difflineminus">-          this.tree.view = null;</span>
<a href="#l4.429"></a><span id="l4.429" class="difflineminus">-          this.calObserver.listTree = null;</span>
<a href="#l4.430"></a><span id="l4.430" class="difflineplus">+            // Set up the tree view (nsITreeView).</span>
<a href="#l4.431"></a><span id="l4.431" class="difflineplus">+            this.tree = this.closest(&quot;.calendar-list-tree&quot;);</span>
<a href="#l4.432"></a><span id="l4.432" class="difflineplus">+            this.tree.view = this.getCustomInterfaceCallback(Ci.nsITreeView);</span>
<a href="#l4.433"></a><span id="l4.433"> </span>
<a href="#l4.434"></a><span id="l4.434" class="difflineminus">-          if (this.mCompositeCalendar) {</span>
<a href="#l4.435"></a><span id="l4.435" class="difflineminus">-              this.mCompositeCalendar.removeObserver(this.compositeObserver);</span>
<a href="#l4.436"></a><span id="l4.436" class="difflineminus">-          }</span>
<a href="#l4.437"></a><span id="l4.437" class="difflineminus">-      ]]&gt;&lt;/destructor&gt;</span>
<a href="#l4.438"></a><span id="l4.438" class="difflineminus">-</span>
<a href="#l4.439"></a><span id="l4.439" class="difflineminus">-      &lt;field name=&quot;calObserver&quot;&gt;&lt;![CDATA[</span>
<a href="#l4.440"></a><span id="l4.440" class="difflineminus">-        ({</span>
<a href="#l4.441"></a><span id="l4.441" class="difflineminus">-            listTree: this,</span>
<a href="#l4.442"></a><span id="l4.442" class="difflineminus">-            QueryInterface: ChromeUtils.generateQI([Ci.calIObserver]),</span>
<a href="#l4.443"></a><span id="l4.443" class="difflineplus">+            /**</span>
<a href="#l4.444"></a><span id="l4.444" class="difflineplus">+             * Observer of changes to calendars. Each registered calendar uses this observer.</span>
<a href="#l4.445"></a><span id="l4.445" class="difflineplus">+             *</span>
<a href="#l4.446"></a><span id="l4.446" class="difflineplus">+             * @implements calIObserver</span>
<a href="#l4.447"></a><span id="l4.447" class="difflineplus">+             */</span>
<a href="#l4.448"></a><span id="l4.448" class="difflineplus">+            this.calObserver = {</span>
<a href="#l4.449"></a><span id="l4.449" class="difflineplus">+                listTree: this,</span>
<a href="#l4.450"></a><span id="l4.450" class="difflineplus">+                QueryInterface: ChromeUtils.generateQI([Ci.calIObserver]),</span>
<a href="#l4.451"></a><span id="l4.451"> </span>
<a href="#l4.452"></a><span id="l4.452" class="difflineminus">-            // calIObserver. Note that each registered calendar uses this observer</span>
<a href="#l4.453"></a><span id="l4.453" class="difflineminus">-            onStartBatch: function() { },</span>
<a href="#l4.454"></a><span id="l4.454" class="difflineminus">-            onEndBatch: function() { },</span>
<a href="#l4.455"></a><span id="l4.455" class="difflineminus">-            onLoad: function() { },</span>
<a href="#l4.456"></a><span id="l4.456" class="difflineplus">+                // calIObserver Methods</span>
<a href="#l4.457"></a><span id="l4.457"> </span>
<a href="#l4.458"></a><span id="l4.458" class="difflineminus">-            onAddItem: function(aItem) { },</span>
<a href="#l4.459"></a><span id="l4.459" class="difflineminus">-            onModifyItem: function(aNewItem, aOldItem) { },</span>
<a href="#l4.460"></a><span id="l4.460" class="difflineminus">-            onDeleteItem: function(aDeletedItem) { },</span>
<a href="#l4.461"></a><span id="l4.461" class="difflineminus">-            onError: function(aCalendar, aErrNo, aMessage) { },</span>
<a href="#l4.462"></a><span id="l4.462" class="difflineplus">+                onStartBatch() {},</span>
<a href="#l4.463"></a><span id="l4.463" class="difflineplus">+                onEndBatch() {},</span>
<a href="#l4.464"></a><span id="l4.464" class="difflineplus">+                onLoad() {},</span>
<a href="#l4.465"></a><span id="l4.465" class="difflineplus">+                onAddItem(item) {},</span>
<a href="#l4.466"></a><span id="l4.466" class="difflineplus">+                onModifyItem(newItem, oldItem) {},</span>
<a href="#l4.467"></a><span id="l4.467" class="difflineplus">+                onDeleteItem(deletedItem) {},</span>
<a href="#l4.468"></a><span id="l4.468" class="difflineplus">+                onError(calendar, errNo, message) {},</span>
<a href="#l4.469"></a><span id="l4.469"> </span>
<a href="#l4.470"></a><span id="l4.470" class="difflineminus">-            onPropertyChanged: function(aCalendar, aName, aValue, aOldValue) {</span>
<a href="#l4.471"></a><span id="l4.471" class="difflineminus">-                switch (aName) {</span>
<a href="#l4.472"></a><span id="l4.472" class="difflineminus">-                    case &quot;color&quot;:</span>
<a href="#l4.473"></a><span id="l4.473" class="difflineminus">-                        // TODO See other TODO in this file about updateStyleSheetForViews</span>
<a href="#l4.474"></a><span id="l4.474" class="difflineminus">-                        if (&quot;updateStyleSheetForViews&quot; in window) {</span>
<a href="#l4.475"></a><span id="l4.475" class="difflineminus">-                            updateStyleSheetForViews(aCalendar);</span>
<a href="#l4.476"></a><span id="l4.476" class="difflineminus">-                        }</span>
<a href="#l4.477"></a><span id="l4.477" class="difflineminus">-                        this.listTree.updateCalendarColor(aCalendar);</span>
<a href="#l4.478"></a><span id="l4.478" class="difflineminus">-                        // Fall through, update item in any case</span>
<a href="#l4.479"></a><span id="l4.479" class="difflineminus">-                    case &quot;name&quot;:</span>
<a href="#l4.480"></a><span id="l4.480" class="difflineminus">-                    case &quot;currentStatus&quot;:</span>
<a href="#l4.481"></a><span id="l4.481" class="difflineminus">-                    case &quot;readOnly&quot;:</span>
<a href="#l4.482"></a><span id="l4.482" class="difflineminus">-                    case &quot;disabled&quot;:</span>
<a href="#l4.483"></a><span id="l4.483" class="difflineminus">-                        this.listTree.updateCalendar(aCalendar);</span>
<a href="#l4.484"></a><span id="l4.484" class="difflineminus">-                        // Fall through, update commands in any cases.</span>
<a href="#l4.485"></a><span id="l4.485" class="difflineplus">+                onPropertyChanged: (calendar, name, value, oldValue) =&gt; {</span>
<a href="#l4.486"></a><span id="l4.486" class="difflineplus">+                    switch (name) {</span>
<a href="#l4.487"></a><span id="l4.487" class="difflineplus">+                        case &quot;color&quot;:</span>
<a href="#l4.488"></a><span id="l4.488" class="difflineplus">+                            // TODO See other TODO in this file about updateStyleSheetForViews</span>
<a href="#l4.489"></a><span id="l4.489" class="difflineplus">+                            if (&quot;updateStyleSheetForViews&quot; in window) {</span>
<a href="#l4.490"></a><span id="l4.490" class="difflineplus">+                                updateStyleSheetForViews(calendar);</span>
<a href="#l4.491"></a><span id="l4.491" class="difflineplus">+                            }</span>
<a href="#l4.492"></a><span id="l4.492" class="difflineplus">+                            this.listTree.updateCalendarColor(calendar);</span>
<a href="#l4.493"></a><span id="l4.493" class="difflineplus">+                            // Fall through, update item in any case</span>
<a href="#l4.494"></a><span id="l4.494" class="difflineplus">+                        case &quot;name&quot;:</span>
<a href="#l4.495"></a><span id="l4.495" class="difflineplus">+                        case &quot;currentStatus&quot;:</span>
<a href="#l4.496"></a><span id="l4.496" class="difflineplus">+                        case &quot;readOnly&quot;:</span>
<a href="#l4.497"></a><span id="l4.497" class="difflineplus">+                        case &quot;disabled&quot;:</span>
<a href="#l4.498"></a><span id="l4.498" class="difflineplus">+                            this.listTree.updateCalendar(calendar);</span>
<a href="#l4.499"></a><span id="l4.499" class="difflineplus">+                            // Fall through, update commands in any cases.</span>
<a href="#l4.500"></a><span id="l4.500" class="difflineplus">+                    }</span>
<a href="#l4.501"></a><span id="l4.501" class="difflineplus">+                },</span>
<a href="#l4.502"></a><span id="l4.502" class="difflineplus">+</span>
<a href="#l4.503"></a><span id="l4.503" class="difflineplus">+                onPropertyDeleting(calendar, name) {</span>
<a href="#l4.504"></a><span id="l4.504" class="difflineplus">+                    // Since the old value is not used directly in onPropertyChanged, but</span>
<a href="#l4.505"></a><span id="l4.505" class="difflineplus">+                    // should not be the same as the value, set it to a different value.</span>
<a href="#l4.506"></a><span id="l4.506" class="difflineplus">+                    this.onPropertyChanged(calendar, name, null, null);</span>
<a href="#l4.507"></a><span id="l4.507">                 }</span>
<a href="#l4.508"></a><span id="l4.508" class="difflineminus">-            },</span>
<a href="#l4.509"></a><span id="l4.509" class="difflineminus">-</span>
<a href="#l4.510"></a><span id="l4.510" class="difflineminus">-            onPropertyDeleting: function(aCalendar, aName) {</span>
<a href="#l4.511"></a><span id="l4.511" class="difflineminus">-                // Since the old value is not used directly in onPropertyChanged,</span>
<a href="#l4.512"></a><span id="l4.512" class="difflineminus">-                // but should not be the same as the value, set it to a different</span>
<a href="#l4.513"></a><span id="l4.513" class="difflineminus">-                // value.</span>
<a href="#l4.514"></a><span id="l4.514" class="difflineminus">-                this.onPropertyChanged(aCalendar, aName, null, null);</span>
<a href="#l4.515"></a><span id="l4.515" class="difflineminus">-            }</span>
<a href="#l4.516"></a><span id="l4.516" class="difflineminus">-        })</span>
<a href="#l4.517"></a><span id="l4.517" class="difflineminus">-      ]]&gt;&lt;/field&gt;</span>
<a href="#l4.518"></a><span id="l4.518" class="difflineplus">+            };</span>
<a href="#l4.519"></a><span id="l4.519"> </span>
<a href="#l4.520"></a><span id="l4.520" class="difflineminus">-      &lt;field name=&quot;compositeObserver&quot;&gt;&lt;![CDATA[</span>
<a href="#l4.521"></a><span id="l4.521" class="difflineminus">-        ({</span>
<a href="#l4.522"></a><span id="l4.522" class="difflineminus">-            listTree: this,</span>
<a href="#l4.523"></a><span id="l4.523" class="difflineminus">-            QueryInterface: ChromeUtils.generateQI([Ci.calICompositeObserver]),</span>
<a href="#l4.524"></a><span id="l4.524" class="difflineplus">+            /**</span>
<a href="#l4.525"></a><span id="l4.525" class="difflineplus">+             * Composite calendar observer.</span>
<a href="#l4.526"></a><span id="l4.526" class="difflineplus">+             *</span>
<a href="#l4.527"></a><span id="l4.527" class="difflineplus">+             * @implements calICompositeObserver</span>
<a href="#l4.528"></a><span id="l4.528" class="difflineplus">+             */</span>
<a href="#l4.529"></a><span id="l4.529" class="difflineplus">+            this.compositeObserver = {</span>
<a href="#l4.530"></a><span id="l4.530" class="difflineplus">+                listTree: this,</span>
<a href="#l4.531"></a><span id="l4.531" class="difflineplus">+                QueryInterface: ChromeUtils.generateQI([Ci.calICompositeObserver]),</span>
<a href="#l4.532"></a><span id="l4.532"> </span>
<a href="#l4.533"></a><span id="l4.533" class="difflineminus">-            // calICompositeObserver</span>
<a href="#l4.534"></a><span id="l4.534" class="difflineminus">-            onCalendarAdded: function(aCalendar) {</span>
<a href="#l4.535"></a><span id="l4.535" class="difflineminus">-                // Make sure the checkbox state is updated</span>
<a href="#l4.536"></a><span id="l4.536" class="difflineminus">-                this.listTree.updateCalendar(aCalendar);</span>
<a href="#l4.537"></a><span id="l4.537" class="difflineminus">-            },</span>
<a href="#l4.538"></a><span id="l4.538" class="difflineminus">-</span>
<a href="#l4.539"></a><span id="l4.539" class="difflineminus">-            onCalendarRemoved: function(aCalendar) {</span>
<a href="#l4.540"></a><span id="l4.540" class="difflineminus">-                // Make sure the checkbox state is updated</span>
<a href="#l4.541"></a><span id="l4.541" class="difflineminus">-                this.listTree.updateCalendar(aCalendar);</span>
<a href="#l4.542"></a><span id="l4.542" class="difflineminus">-            },</span>
<a href="#l4.543"></a><span id="l4.543" class="difflineplus">+                // calICompositeObserver Methods</span>
<a href="#l4.544"></a><span id="l4.544"> </span>
<a href="#l4.545"></a><span id="l4.545" class="difflineminus">-            onDefaultCalendarChanged: function(aCalendar) {</span>
<a href="#l4.546"></a><span id="l4.546" class="difflineminus">-            }</span>
<a href="#l4.547"></a><span id="l4.547" class="difflineminus">-        })</span>
<a href="#l4.548"></a><span id="l4.548" class="difflineminus">-      ]]&gt;&lt;/field&gt;</span>
<a href="#l4.549"></a><span id="l4.549" class="difflineplus">+                onCalendarAdded(calendar) {</span>
<a href="#l4.550"></a><span id="l4.550" class="difflineplus">+                    // Make sure the checkbox state is updated.</span>
<a href="#l4.551"></a><span id="l4.551" class="difflineplus">+                    this.listTree.updateCalendar(calendar);</span>
<a href="#l4.552"></a><span id="l4.552" class="difflineplus">+                },</span>
<a href="#l4.553"></a><span id="l4.553"> </span>
<a href="#l4.554"></a><span id="l4.554" class="difflineminus">-      &lt;property name=&quot;treechildren&quot;</span>
<a href="#l4.555"></a><span id="l4.555" class="difflineminus">-                readonly=&quot;true&quot;</span>
<a href="#l4.556"></a><span id="l4.556" class="difflineminus">-                onget=&quot;return document.getAnonymousElementByAttribute(this, 'anonid', 'treechildren')&quot;/&gt;</span>
<a href="#l4.557"></a><span id="l4.557" class="difflineminus">-      &lt;property name=&quot;tree&quot;</span>
<a href="#l4.558"></a><span id="l4.558" class="difflineminus">-                readonly=&quot;true&quot;</span>
<a href="#l4.559"></a><span id="l4.559" class="difflineminus">-                onget=&quot;return document.getAnonymousElementByAttribute(this, 'anonid', 'tree')&quot;/&gt;</span>
<a href="#l4.560"></a><span id="l4.560" class="difflineplus">+                onCalendarRemoved(calendar) {</span>
<a href="#l4.561"></a><span id="l4.561" class="difflineplus">+                    // Make sure the checkbox state is updated.</span>
<a href="#l4.562"></a><span id="l4.562" class="difflineplus">+                    this.listTree.updateCalendar(calendar);</span>
<a href="#l4.563"></a><span id="l4.563" class="difflineplus">+                },</span>
<a href="#l4.564"></a><span id="l4.564"> </span>
<a href="#l4.565"></a><span id="l4.565" class="difflineplus">+                onDefaultCalendarChanged(calendar) {},</span>
<a href="#l4.566"></a><span id="l4.566" class="difflineplus">+            };</span>
<a href="#l4.567"></a><span id="l4.567" class="difflineplus">+        }</span>
<a href="#l4.568"></a><span id="l4.568"> </span>
<a href="#l4.569"></a><span id="l4.569" class="difflineminus">-      &lt;property name=&quot;sheet&quot; readonly=&quot;true&quot;&gt;</span>
<a href="#l4.570"></a><span id="l4.570" class="difflineminus">-        &lt;getter&gt;&lt;![CDATA[</span>
<a href="#l4.571"></a><span id="l4.571" class="difflineplus">+        get sheet() {</span>
<a href="#l4.572"></a><span id="l4.572">             if (!this.mCachedSheet) {</span>
<a href="#l4.573"></a><span id="l4.573" class="difflineminus">-                for (let sheet of document.styleSheets) {</span>
<a href="#l4.574"></a><span id="l4.574" class="difflineplus">+                for (const sheet of document.styleSheets) {</span>
<a href="#l4.575"></a><span id="l4.575">                     if (sheet.href == &quot;chrome://calendar/skin/calendar-management.css&quot;) {</span>
<a href="#l4.576"></a><span id="l4.576">                         this.mCachedSheet = sheet;</span>
<a href="#l4.577"></a><span id="l4.577">                         break;</span>
<a href="#l4.578"></a><span id="l4.578">                     }</span>
<a href="#l4.579"></a><span id="l4.579">                 }</span>
<a href="#l4.580"></a><span id="l4.580">                 if (!this.mCachedSheet) {</span>
<a href="#l4.581"></a><span id="l4.581">                     cal.ERROR(&quot;Could not find calendar-management.css, needs to be added to &quot; +</span>
<a href="#l4.582"></a><span id="l4.582" class="difflineminus">-                              window.document.title + &quot;'s stylesheets&quot;);</span>
<a href="#l4.583"></a><span id="l4.583" class="difflineplus">+                        window.document.title + &quot;'s stylesheets&quot;);</span>
<a href="#l4.584"></a><span id="l4.584">                 }</span>
<a href="#l4.585"></a><span id="l4.585">             }</span>
<a href="#l4.586"></a><span id="l4.586" class="difflineminus">-</span>
<a href="#l4.587"></a><span id="l4.587">             return this.mCachedSheet;</span>
<a href="#l4.588"></a><span id="l4.588" class="difflineminus">-        ]]&gt;&lt;/getter&gt;</span>
<a href="#l4.589"></a><span id="l4.589" class="difflineminus">-      &lt;/property&gt;</span>
<a href="#l4.590"></a><span id="l4.590" class="difflineplus">+        }</span>
<a href="#l4.591"></a><span id="l4.591"> </span>
<a href="#l4.592"></a><span id="l4.592" class="difflineminus">-      &lt;property name=&quot;calendars&quot;&gt;</span>
<a href="#l4.593"></a><span id="l4.593" class="difflineminus">-        &lt;getter&gt;&lt;![CDATA[</span>
<a href="#l4.594"></a><span id="l4.594" class="difflineminus">-            return this.mCalendarList;</span>
<a href="#l4.595"></a><span id="l4.595" class="difflineminus">-        ]]&gt;&lt;/getter&gt;</span>
<a href="#l4.596"></a><span id="l4.596" class="difflineminus">-        &lt;setter&gt;&lt;![CDATA[</span>
<a href="#l4.597"></a><span id="l4.597" class="difflineminus">-            this.treebox.beginUpdateBatch();</span>
<a href="#l4.598"></a><span id="l4.598" class="difflineplus">+        set calendars(cals) {</span>
<a href="#l4.599"></a><span id="l4.599" class="difflineplus">+            this.tree.beginUpdateBatch();</span>
<a href="#l4.600"></a><span id="l4.600">             try {</span>
<a href="#l4.601"></a><span id="l4.601">                 this.clear();</span>
<a href="#l4.602"></a><span id="l4.602">                 this.mCalendarList = [];</span>
<a href="#l4.603"></a><span id="l4.603" class="difflineminus">-                for (let calendar of val) {</span>
<a href="#l4.604"></a><span id="l4.604" class="difflineminus">-                    this.addCalendar(calendar);</span>
<a href="#l4.605"></a><span id="l4.605" class="difflineminus">-                }</span>
<a href="#l4.606"></a><span id="l4.606" class="difflineplus">+                cals.forEach(calendar =&gt; this.addCalendar(calendar));</span>
<a href="#l4.607"></a><span id="l4.607">                 return this.mCalendarList;</span>
<a href="#l4.608"></a><span id="l4.608">             } finally {</span>
<a href="#l4.609"></a><span id="l4.609" class="difflineminus">-                this.treebox.endUpdateBatch();</span>
<a href="#l4.610"></a><span id="l4.610" class="difflineplus">+                this.tree.endUpdateBatch();</span>
<a href="#l4.611"></a><span id="l4.611">             }</span>
<a href="#l4.612"></a><span id="l4.612" class="difflineminus">-        ]]&gt;&lt;/setter&gt;</span>
<a href="#l4.613"></a><span id="l4.613" class="difflineminus">-      &lt;/property&gt;</span>
<a href="#l4.614"></a><span id="l4.614" class="difflineplus">+        }</span>
<a href="#l4.615"></a><span id="l4.615"> </span>
<a href="#l4.616"></a><span id="l4.616" class="difflineminus">-      &lt;property name=&quot;compositeCalendar&quot;&gt;</span>
<a href="#l4.617"></a><span id="l4.617" class="difflineminus">-        &lt;getter&gt;&lt;![CDATA[</span>
<a href="#l4.618"></a><span id="l4.618" class="difflineminus">-            if (!this.mCompositeCalendar) {</span>
<a href="#l4.619"></a><span id="l4.619" class="difflineminus">-                this.mCompositeCalendar = Cc[&quot;@mozilla.org/calendar/calendar;1?type=composite&quot;]</span>
<a href="#l4.620"></a><span id="l4.620" class="difflineminus">-                                            .createInstance(Ci.calICompositeCalendar);</span>
<a href="#l4.621"></a><span id="l4.621" class="difflineminus">-            }</span>
<a href="#l4.622"></a><span id="l4.622" class="difflineplus">+        get calendars() {</span>
<a href="#l4.623"></a><span id="l4.623" class="difflineplus">+            return this.mCalendarList;</span>
<a href="#l4.624"></a><span id="l4.624" class="difflineplus">+        }</span>
<a href="#l4.625"></a><span id="l4.625"> </span>
<a href="#l4.626"></a><span id="l4.626" class="difflineminus">-            return this.mCompositeCalendar;</span>
<a href="#l4.627"></a><span id="l4.627" class="difflineminus">-        ]]&gt;&lt;/getter&gt;</span>
<a href="#l4.628"></a><span id="l4.628" class="difflineminus">-        &lt;setter&gt;&lt;![CDATA[</span>
<a href="#l4.629"></a><span id="l4.629" class="difflineplus">+        set compositeCalendar(compositeCal) {</span>
<a href="#l4.630"></a><span id="l4.630">             if (this.mCompositeCalendar) {</span>
<a href="#l4.631"></a><span id="l4.631">                 throw Components.Exception(&quot;A composite calendar has already been set&quot;,</span>
<a href="#l4.632"></a><span id="l4.632" class="difflineminus">-                                           Cr.NS_ERROR_ALREADY_INITIALIZED);</span>
<a href="#l4.633"></a><span id="l4.633" class="difflineplus">+                    Cr.NS_ERROR_ALREADY_INITIALIZED);</span>
<a href="#l4.634"></a><span id="l4.634">             }</span>
<a href="#l4.635"></a><span id="l4.635" class="difflineminus">-            this.mCompositeCalendar = val;</span>
<a href="#l4.636"></a><span id="l4.636" class="difflineplus">+            this.mCompositeCalendar = compositeCal;</span>
<a href="#l4.637"></a><span id="l4.637">             this.mCompositeCalendar.addObserver(this.compositeObserver);</span>
<a href="#l4.638"></a><span id="l4.638" class="difflineminus">-            return val;</span>
<a href="#l4.639"></a><span id="l4.639" class="difflineminus">-        ]]&gt;&lt;/setter&gt;</span>
<a href="#l4.640"></a><span id="l4.640" class="difflineminus">-      &lt;/property&gt;</span>
<a href="#l4.641"></a><span id="l4.641" class="difflineplus">+</span>
<a href="#l4.642"></a><span id="l4.642" class="difflineplus">+            if (this.tree &amp;&amp; !this.calendarsAreLoaded) {</span>
<a href="#l4.643"></a><span id="l4.643" class="difflineplus">+                this.loadCalendars();</span>
<a href="#l4.644"></a><span id="l4.644" class="difflineplus">+            }</span>
<a href="#l4.645"></a><span id="l4.645" class="difflineplus">+            return compositeCal;</span>
<a href="#l4.646"></a><span id="l4.646" class="difflineplus">+        }</span>
<a href="#l4.647"></a><span id="l4.647" class="difflineplus">+</span>
<a href="#l4.648"></a><span id="l4.648" class="difflineplus">+        get compositeCalendar() {</span>
<a href="#l4.649"></a><span id="l4.649" class="difflineplus">+            if (!this.mCompositeCalendar) {</span>
<a href="#l4.650"></a><span id="l4.650" class="difflineplus">+                this.mCompositeCalendar = Cc[&quot;@mozilla.org/calendar/calendar;1?type=composite&quot;]</span>
<a href="#l4.651"></a><span id="l4.651" class="difflineplus">+                    .createInstance(Ci.calICompositeCalendar);</span>
<a href="#l4.652"></a><span id="l4.652" class="difflineplus">+            }</span>
<a href="#l4.653"></a><span id="l4.653" class="difflineplus">+            return this.mCompositeCalendar;</span>
<a href="#l4.654"></a><span id="l4.654" class="difflineplus">+        }</span>
<a href="#l4.655"></a><span id="l4.655" class="difflineplus">+</span>
<a href="#l4.656"></a><span id="l4.656" class="difflineplus">+        get sortOrder() {</span>
<a href="#l4.657"></a><span id="l4.657" class="difflineplus">+            return this.mCalendarList.map(calendar =&gt; calendar.id);</span>
<a href="#l4.658"></a><span id="l4.658" class="difflineplus">+        }</span>
<a href="#l4.659"></a><span id="l4.659" class="difflineplus">+</span>
<a href="#l4.660"></a><span id="l4.660" class="difflineplus">+        get selectedCalendars() {</span>
<a href="#l4.661"></a><span id="l4.661" class="difflineplus">+            return this.compositeCalendar.getCalendars({});</span>
<a href="#l4.662"></a><span id="l4.662" class="difflineplus">+        }</span>
<a href="#l4.663"></a><span id="l4.663" class="difflineplus">+</span>
<a href="#l4.664"></a><span id="l4.664" class="difflineplus">+        set allowDrag(val) {</span>
<a href="#l4.665"></a><span id="l4.665" class="difflineplus">+            return setBooleanAttribute(this, &quot;allowdrag&quot;, val);</span>
<a href="#l4.666"></a><span id="l4.666" class="difflineplus">+        }</span>
<a href="#l4.667"></a><span id="l4.667" class="difflineplus">+</span>
<a href="#l4.668"></a><span id="l4.668" class="difflineplus">+        get allowDrag() {</span>
<a href="#l4.669"></a><span id="l4.669" class="difflineplus">+            return (this.getAttribute(&quot;allowdrag&quot;) == &quot;true&quot;);</span>
<a href="#l4.670"></a><span id="l4.670" class="difflineplus">+        }</span>
<a href="#l4.671"></a><span id="l4.671" class="difflineplus">+</span>
<a href="#l4.672"></a><span id="l4.672" class="difflineplus">+        set writable(val) {</span>
<a href="#l4.673"></a><span id="l4.673" class="difflineplus">+            return setBooleanAttribute(this, &quot;writable&quot;, val);</span>
<a href="#l4.674"></a><span id="l4.674" class="difflineplus">+        }</span>
<a href="#l4.675"></a><span id="l4.675" class="difflineplus">+</span>
<a href="#l4.676"></a><span id="l4.676" class="difflineplus">+        get writable() {</span>
<a href="#l4.677"></a><span id="l4.677" class="difflineplus">+            return (this.getAttribute(&quot;writable&quot;) == &quot;true&quot;);</span>
<a href="#l4.678"></a><span id="l4.678" class="difflineplus">+        }</span>
<a href="#l4.679"></a><span id="l4.679" class="difflineplus">+</span>
<a href="#l4.680"></a><span id="l4.680" class="difflineplus">+        set disabledState(val) {</span>
<a href="#l4.681"></a><span id="l4.681" class="difflineplus">+            return this.setAttribute(&quot;disabledstate&quot;, val);</span>
<a href="#l4.682"></a><span id="l4.682" class="difflineplus">+        }</span>
<a href="#l4.683"></a><span id="l4.683"> </span>
<a href="#l4.684"></a><span id="l4.684" class="difflineminus">-      &lt;property name=&quot;sortOrder&quot;</span>
<a href="#l4.685"></a><span id="l4.685" class="difflineminus">-                readonly=&quot;true&quot;</span>
<a href="#l4.686"></a><span id="l4.686" class="difflineminus">-                onget=&quot;return this.mCalendarList.map(x =&gt; x.id);&quot;/&gt;</span>
<a href="#l4.687"></a><span id="l4.687" class="difflineminus">-      &lt;property name=&quot;selectedCalendars&quot;</span>
<a href="#l4.688"></a><span id="l4.688" class="difflineminus">-                readonly=&quot;true&quot;</span>
<a href="#l4.689"></a><span id="l4.689" class="difflineminus">-                onget=&quot;return this.compositeCalendar.getCalendars({});&quot;/&gt;</span>
<a href="#l4.690"></a><span id="l4.690" class="difflineminus">-      &lt;property name=&quot;allowDrag&quot;</span>
<a href="#l4.691"></a><span id="l4.691" class="difflineminus">-                onget=&quot;return (this.getAttribute('allowdrag') == 'true');&quot;</span>
<a href="#l4.692"></a><span id="l4.692" class="difflineminus">-                onset=&quot;return setBooleanAttribute(this, 'allowdrag', val);&quot;/&gt;</span>
<a href="#l4.693"></a><span id="l4.693" class="difflineminus">-      &lt;property name=&quot;writable&quot;</span>
<a href="#l4.694"></a><span id="l4.694" class="difflineminus">-                onget=&quot;return (this.getAttribute('writable') == 'true');&quot;</span>
<a href="#l4.695"></a><span id="l4.695" class="difflineminus">-                onset=&quot;return setBooleanAttribute(this, 'writable', val);&quot;/&gt;</span>
<a href="#l4.696"></a><span id="l4.696" class="difflineminus">-      &lt;property name=&quot;disabledState&quot;</span>
<a href="#l4.697"></a><span id="l4.697" class="difflineminus">-                onget=&quot;return this.getAttribute('disabledstate') || 'disabled';&quot;</span>
<a href="#l4.698"></a><span id="l4.698" class="difflineminus">-                onset=&quot;return this.setAttribute('disabledstate', val);&quot;/&gt;</span>
<a href="#l4.699"></a><span id="l4.699" class="difflineplus">+        get disabledState() {</span>
<a href="#l4.700"></a><span id="l4.700" class="difflineplus">+            return this.getAttribute(&quot;disabledstate&quot;) || &quot;disabled&quot;;</span>
<a href="#l4.701"></a><span id="l4.701" class="difflineplus">+        }</span>
<a href="#l4.702"></a><span id="l4.702" class="difflineplus">+</span>
<a href="#l4.703"></a><span id="l4.703" class="difflineplus">+        // rowCount is an nsITreeView property.</span>
<a href="#l4.704"></a><span id="l4.704" class="difflineplus">+        get rowCount() {</span>
<a href="#l4.705"></a><span id="l4.705" class="difflineplus">+            return this.mCalendarList.length;</span>
<a href="#l4.706"></a><span id="l4.706" class="difflineplus">+        }</span>
<a href="#l4.707"></a><span id="l4.707" class="difflineplus">+</span>
<a href="#l4.708"></a><span id="l4.708" class="difflineplus">+        /**</span>
<a href="#l4.709"></a><span id="l4.709" class="difflineplus">+         * Do the initial population of the list of calendars. Should be called only once.</span>
<a href="#l4.710"></a><span id="l4.710" class="difflineplus">+         * This is called from either setTree or from &quot;set compositeCalendar&quot; depending on the order</span>
<a href="#l4.711"></a><span id="l4.711" class="difflineplus">+         * in which they happen, because this.mCompositeCalendar has to be initialized and this.tree</span>
<a href="#l4.712"></a><span id="l4.712" class="difflineplus">+         * cannot be null. Presumably, the order is non-deterministic because</span>
<a href="#l4.713"></a><span id="l4.713" class="difflineplus">+         * &quot;set compositeCalendar&quot; is triggered by an event that is fired in connectedCallback,</span>
<a href="#l4.714"></a><span id="l4.714" class="difflineplus">+         * via calendar management code.</span>
<a href="#l4.715"></a><span id="l4.715" class="difflineplus">+         */</span>
<a href="#l4.716"></a><span id="l4.716" class="difflineplus">+        loadCalendars() {</span>
<a href="#l4.717"></a><span id="l4.717" class="difflineplus">+            this.mAddingFromComposite = true;</span>
<a href="#l4.718"></a><span id="l4.718" class="difflineplus">+</span>
<a href="#l4.719"></a><span id="l4.719" class="difflineplus">+            const calendars = sortCalendarArray(cal.getCalendarManager().getCalendars({}));</span>
<a href="#l4.720"></a><span id="l4.720" class="difflineplus">+            calendars.forEach(this.addCalendar, this);</span>
<a href="#l4.721"></a><span id="l4.721"> </span>
<a href="#l4.722"></a><span id="l4.722" class="difflineminus">-      &lt;method name=&quot;sortOrderChanged&quot;&gt;</span>
<a href="#l4.723"></a><span id="l4.723" class="difflineminus">-        &lt;body&gt;&lt;![CDATA[</span>
<a href="#l4.724"></a><span id="l4.724" class="difflineplus">+            this.calendarsAreLoaded = true;</span>
<a href="#l4.725"></a><span id="l4.725" class="difflineplus">+            this.mAddingFromComposite = false;</span>
<a href="#l4.726"></a><span id="l4.726" class="difflineplus">+        }</span>
<a href="#l4.727"></a><span id="l4.727" class="difflineplus">+</span>
<a href="#l4.728"></a><span id="l4.728" class="difflineplus">+        /**</span>
<a href="#l4.729"></a><span id="l4.729" class="difflineplus">+         * Event handler for a dragstart event, called when starting to drag a calendar row.</span>
<a href="#l4.730"></a><span id="l4.730" class="difflineplus">+         *</span>
<a href="#l4.731"></a><span id="l4.731" class="difflineplus">+         * @param {Event} event    A dragstart event.</span>
<a href="#l4.732"></a><span id="l4.732" class="difflineplus">+         */</span>
<a href="#l4.733"></a><span id="l4.733" class="difflineplus">+        onDragStart(event) {</span>
<a href="#l4.734"></a><span id="l4.734" class="difflineplus">+            const calendar = this.getCalendarFromEvent(event);</span>
<a href="#l4.735"></a><span id="l4.735" class="difflineplus">+            if (this.allowDrag &amp;&amp; event.dataTransfer) {</span>
<a href="#l4.736"></a><span id="l4.736" class="difflineplus">+                // Setting data starts a drag session, do this only if dragging</span>
<a href="#l4.737"></a><span id="l4.737" class="difflineplus">+                // is enabled for this custom element.</span>
<a href="#l4.738"></a><span id="l4.738" class="difflineplus">+                event.dataTransfer.setData(&quot;application/x-moz-calendarID&quot;, calendar.id);</span>
<a href="#l4.739"></a><span id="l4.739" class="difflineplus">+                event.dataTransfer.effectAllowed = &quot;move&quot;;</span>
<a href="#l4.740"></a><span id="l4.740" class="difflineplus">+            }</span>
<a href="#l4.741"></a><span id="l4.741" class="difflineplus">+        }</span>
<a href="#l4.742"></a><span id="l4.742" class="difflineplus">+</span>
<a href="#l4.743"></a><span id="l4.743" class="difflineplus">+        /**</span>
<a href="#l4.744"></a><span id="l4.744" class="difflineplus">+         * Fire a SortOrderChanged event containing the new sort order.</span>
<a href="#l4.745"></a><span id="l4.745" class="difflineplus">+         */</span>
<a href="#l4.746"></a><span id="l4.746" class="difflineplus">+        sortOrderChanged() {</span>
<a href="#l4.747"></a><span id="l4.747">             if (this.mAddingFromComposite) {</span>
<a href="#l4.748"></a><span id="l4.748">                 return;</span>
<a href="#l4.749"></a><span id="l4.749">             }</span>
<a href="#l4.750"></a><span id="l4.750" class="difflineminus">-            let event = document.createEvent(&quot;Events&quot;);</span>
<a href="#l4.751"></a><span id="l4.751" class="difflineminus">-            event.initEvent(&quot;SortOrderChanged&quot;, true, false);</span>
<a href="#l4.752"></a><span id="l4.752" class="difflineplus">+            const event = new Event(&quot;SortOrderChanged&quot;, { bubbles: true, cancelable: false });</span>
<a href="#l4.753"></a><span id="l4.753" class="difflineplus">+</span>
<a href="#l4.754"></a><span id="l4.754">             event.sortOrder = this.sortOrder;</span>
<a href="#l4.755"></a><span id="l4.755">             this.dispatchEvent(event);</span>
<a href="#l4.756"></a><span id="l4.756" class="difflineminus">-        ]]&gt;&lt;/body&gt;</span>
<a href="#l4.757"></a><span id="l4.757" class="difflineminus">-      &lt;/method&gt;</span>
<a href="#l4.758"></a><span id="l4.758" class="difflineminus">-      &lt;method name=&quot;displayScrollbarSpacer&quot;&gt;</span>
<a href="#l4.759"></a><span id="l4.759" class="difflineminus">-        &lt;parameter name=&quot;aShouldDisplay&quot;/&gt;</span>
<a href="#l4.760"></a><span id="l4.760" class="difflineminus">-        &lt;body&gt;&lt;![CDATA[</span>
<a href="#l4.761"></a><span id="l4.761" class="difflineminus">-            let spacer = document.getAnonymousElementByAttribute(this, &quot;anonid&quot;, &quot;scrollbar-spacer&quot;);</span>
<a href="#l4.762"></a><span id="l4.762" class="difflineminus">-            spacer.collapsed = !aShouldDisplay;</span>
<a href="#l4.763"></a><span id="l4.763" class="difflineminus">-        ]]&gt;&lt;/body&gt;</span>
<a href="#l4.764"></a><span id="l4.764" class="difflineminus">-      &lt;/method&gt;</span>
<a href="#l4.765"></a><span id="l4.765" class="difflineplus">+        }</span>
<a href="#l4.766"></a><span id="l4.766"> </span>
<a href="#l4.767"></a><span id="l4.767" class="difflineminus">-      &lt;method name=&quot;ensureCalendarVisible&quot;&gt;</span>
<a href="#l4.768"></a><span id="l4.768" class="difflineminus">-        &lt;parameter name=&quot;aCalendar&quot;/&gt;</span>
<a href="#l4.769"></a><span id="l4.769" class="difflineminus">-        &lt;body&gt;&lt;![CDATA[</span>
<a href="#l4.770"></a><span id="l4.770" class="difflineminus">-            this.compositeCalendar.addCalendar(aCalendar);</span>
<a href="#l4.771"></a><span id="l4.771" class="difflineminus">-        ]]&gt;&lt;/body&gt;</span>
<a href="#l4.772"></a><span id="l4.772" class="difflineminus">-      &lt;/method&gt;</span>
<a href="#l4.773"></a><span id="l4.773" class="difflineplus">+        /**</span>
<a href="#l4.774"></a><span id="l4.774" class="difflineplus">+         * Display or do not display the scrollbar spacer.</span>
<a href="#l4.775"></a><span id="l4.775" class="difflineplus">+         *</span>
<a href="#l4.776"></a><span id="l4.776" class="difflineplus">+         * @param {boolean} shouldDisplay</span>
<a href="#l4.777"></a><span id="l4.777" class="difflineplus">+         */</span>
<a href="#l4.778"></a><span id="l4.778" class="difflineplus">+        displayScrollbarSpacer(shouldDisplay) {</span>
<a href="#l4.779"></a><span id="l4.779" class="difflineplus">+            const spacer = this.querySelector(&quot;.scrollbar-spacer&quot;);</span>
<a href="#l4.780"></a><span id="l4.780" class="difflineplus">+            spacer.collapsed = !shouldDisplay;</span>
<a href="#l4.781"></a><span id="l4.781" class="difflineplus">+        }</span>
<a href="#l4.782"></a><span id="l4.782"> </span>
<a href="#l4.783"></a><span id="l4.783" class="difflineminus">-      &lt;method name=&quot;getColumn&quot;&gt;</span>
<a href="#l4.784"></a><span id="l4.784" class="difflineminus">-        &lt;parameter name=&quot;aAnonId&quot;/&gt;</span>
<a href="#l4.785"></a><span id="l4.785" class="difflineminus">-        &lt;body&gt;&lt;![CDATA[</span>
<a href="#l4.786"></a><span id="l4.786" class="difflineminus">-            let colElem = document.getAnonymousElementByAttribute(this, &quot;anonid&quot;, aAnonId);</span>
<a href="#l4.787"></a><span id="l4.787" class="difflineminus">-            return this.treebox.columns.getColumnFor(colElem);</span>
<a href="#l4.788"></a><span id="l4.788" class="difflineminus">-        ]]&gt;&lt;/body&gt;</span>
<a href="#l4.789"></a><span id="l4.789" class="difflineminus">-      &lt;/method&gt;</span>
<a href="#l4.790"></a><span id="l4.790" class="difflineplus">+        /**</span>
<a href="#l4.791"></a><span id="l4.791" class="difflineplus">+         * Add the passed calendar to the composite calendar to ensure that it is visible.</span>
<a href="#l4.792"></a><span id="l4.792" class="difflineplus">+         *</span>
<a href="#l4.793"></a><span id="l4.793" class="difflineplus">+         * @param {calICalendar} calendar    A calendar object.</span>
<a href="#l4.794"></a><span id="l4.794" class="difflineplus">+         */</span>
<a href="#l4.795"></a><span id="l4.795" class="difflineplus">+        ensureCalendarVisible(calendar) {</span>
<a href="#l4.796"></a><span id="l4.796" class="difflineplus">+            this.compositeCalendar.addCalendar(calendar);</span>
<a href="#l4.797"></a><span id="l4.797" class="difflineplus">+        }</span>
<a href="#l4.798"></a><span id="l4.798"> </span>
<a href="#l4.799"></a><span id="l4.799" class="difflineminus">-      &lt;method name=&quot;findIndexById&quot;&gt;</span>
<a href="#l4.800"></a><span id="l4.800" class="difflineminus">-        &lt;!--</span>
<a href="#l4.801"></a><span id="l4.801" class="difflineminus">-          - Find the array index of the calendar with the passed id.</span>
<a href="#l4.802"></a><span id="l4.802" class="difflineminus">-          -</span>
<a href="#l4.803"></a><span id="l4.803" class="difflineminus">-          - @param aId           The calendar id to find an index for.</span>
<a href="#l4.804"></a><span id="l4.804" class="difflineminus">-          - @return              The array index, or -1 if not found.</span>
<a href="#l4.805"></a><span id="l4.805" class="difflineminus">-          --&gt;</span>
<a href="#l4.806"></a><span id="l4.806" class="difflineminus">-        &lt;parameter name=&quot;aId&quot;/&gt;</span>
<a href="#l4.807"></a><span id="l4.807" class="difflineminus">-        &lt;body&gt;&lt;![CDATA[</span>
<a href="#l4.808"></a><span id="l4.808" class="difflineminus">-            for (let i = 0; i &lt; this.mCalendarList.length; i++) {</span>
<a href="#l4.809"></a><span id="l4.809" class="difflineminus">-                if (this.mCalendarList[i].id == aId) {</span>
<a href="#l4.810"></a><span id="l4.810" class="difflineminus">-                    return i;</span>
<a href="#l4.811"></a><span id="l4.811" class="difflineminus">-                }</span>
<a href="#l4.812"></a><span id="l4.812" class="difflineminus">-            }</span>
<a href="#l4.813"></a><span id="l4.813" class="difflineminus">-            return -1;</span>
<a href="#l4.814"></a><span id="l4.814" class="difflineminus">-        ]]&gt;&lt;/body&gt;</span>
<a href="#l4.815"></a><span id="l4.815" class="difflineminus">-      &lt;/method&gt;</span>
<a href="#l4.816"></a><span id="l4.816" class="difflineplus">+        /**</span>
<a href="#l4.817"></a><span id="l4.817" class="difflineplus">+         * Return the index of the calendar, with the given id, in the internal calendar list.</span>
<a href="#l4.818"></a><span id="l4.818" class="difflineplus">+         *</span>
<a href="#l4.819"></a><span id="l4.819" class="difflineplus">+         * @param {string} id    The id of a calendar.</span>
<a href="#l4.820"></a><span id="l4.820" class="difflineplus">+         * @return {number}      The index or -1 if not found.</span>
<a href="#l4.821"></a><span id="l4.821" class="difflineplus">+         */</span>
<a href="#l4.822"></a><span id="l4.822" class="difflineplus">+        findIndexById(id) {</span>
<a href="#l4.823"></a><span id="l4.823" class="difflineplus">+            return this.mCalendarList.findIndex(calendar =&gt; calendar.id == id);</span>
<a href="#l4.824"></a><span id="l4.824" class="difflineplus">+        }</span>
<a href="#l4.825"></a><span id="l4.825"> </span>
<a href="#l4.826"></a><span id="l4.826" class="difflineminus">-      &lt;method name=&quot;selectCalendarById&quot;&gt;</span>
<a href="#l4.827"></a><span id="l4.827" class="difflineminus">-        &lt;parameter name=&quot;aId&quot;/&gt;</span>
<a href="#l4.828"></a><span id="l4.828" class="difflineminus">-        &lt;body&gt;&lt;![CDATA[</span>
<a href="#l4.829"></a><span id="l4.829" class="difflineminus">-            let index = this.findIndexById(aId);</span>
<a href="#l4.830"></a><span id="l4.830" class="difflineplus">+        /**</span>
<a href="#l4.831"></a><span id="l4.831" class="difflineplus">+         * Select a calendar by its id.</span>
<a href="#l4.832"></a><span id="l4.832" class="difflineplus">+         *</span>
<a href="#l4.833"></a><span id="l4.833" class="difflineplus">+         * @param {string} id    The id of the calendar to select.</span>
<a href="#l4.834"></a><span id="l4.834" class="difflineplus">+         */</span>
<a href="#l4.835"></a><span id="l4.835" class="difflineplus">+        selectCalendarById(id) {</span>
<a href="#l4.836"></a><span id="l4.836" class="difflineplus">+            const index = this.findIndexById(id);</span>
<a href="#l4.837"></a><span id="l4.837">             this.tree.view.selection.select(index);</span>
<a href="#l4.838"></a><span id="l4.838" class="difflineminus">-        ]]&gt;&lt;/body&gt;</span>
<a href="#l4.839"></a><span id="l4.839" class="difflineminus">-      &lt;/method&gt;</span>
<a href="#l4.840"></a><span id="l4.840" class="difflineplus">+        }</span>
<a href="#l4.841"></a><span id="l4.841"> </span>
<a href="#l4.842"></a><span id="l4.842" class="difflineminus">-      &lt;method name=&quot;addCalendar&quot;&gt;</span>
<a href="#l4.843"></a><span id="l4.843" class="difflineminus">-        &lt;!--</span>
<a href="#l4.844"></a><span id="l4.844" class="difflineminus">-          - Add a calendar to the calendar list</span>
<a href="#l4.845"></a><span id="l4.845" class="difflineminus">-          -</span>
<a href="#l4.846"></a><span id="l4.846" class="difflineminus">-          - @param aCalendar     The calendar to add.</span>
<a href="#l4.847"></a><span id="l4.847" class="difflineminus">-          --&gt;</span>
<a href="#l4.848"></a><span id="l4.848" class="difflineminus">-        &lt;parameter name=&quot;aCalendar&quot;/&gt;</span>
<a href="#l4.849"></a><span id="l4.849" class="difflineminus">-        &lt;body&gt;&lt;![CDATA[</span>
<a href="#l4.850"></a><span id="l4.850" class="difflineminus">-            let composite = this.compositeCalendar;</span>
<a href="#l4.851"></a><span id="l4.851" class="difflineplus">+        /**</span>
<a href="#l4.852"></a><span id="l4.852" class="difflineplus">+         * Add a calendar to the tree.</span>
<a href="#l4.853"></a><span id="l4.853" class="difflineplus">+         *</span>
<a href="#l4.854"></a><span id="l4.854" class="difflineplus">+         * @param {calICalendar} calendar    The calendar object to add.</span>
<a href="#l4.855"></a><span id="l4.855" class="difflineplus">+         */</span>
<a href="#l4.856"></a><span id="l4.856" class="difflineplus">+        addCalendar(calendar) {</span>
<a href="#l4.857"></a><span id="l4.857" class="difflineplus">+            if (!this.tree) {</span>
<a href="#l4.858"></a><span id="l4.858" class="difflineplus">+                return;</span>
<a href="#l4.859"></a><span id="l4.859" class="difflineplus">+            }</span>
<a href="#l4.860"></a><span id="l4.860"> </span>
<a href="#l4.861"></a><span id="l4.861" class="difflineminus">-            let initialSortOrderPos = aCalendar.getProperty(&quot;initialSortOrderPos&quot;);</span>
<a href="#l4.862"></a><span id="l4.862" class="difflineplus">+            const composite = this.compositeCalendar;</span>
<a href="#l4.863"></a><span id="l4.863" class="difflineplus">+</span>
<a href="#l4.864"></a><span id="l4.864" class="difflineplus">+            const initialSortOrderPos = calendar.getProperty(&quot;initialSortOrderPos&quot;);</span>
<a href="#l4.865"></a><span id="l4.865">             if (initialSortOrderPos != null &amp;&amp; initialSortOrderPos &lt; this.mCalendarList.length) {</span>
<a href="#l4.866"></a><span id="l4.866">                 // Insert the calendar at the requested sort order position</span>
<a href="#l4.867"></a><span id="l4.867" class="difflineminus">-                // and then discard the property</span>
<a href="#l4.868"></a><span id="l4.868" class="difflineminus">-                this.mCalendarList.splice(initialSortOrderPos, 0, aCalendar);</span>
<a href="#l4.869"></a><span id="l4.869" class="difflineminus">-                aCalendar.deleteProperty(&quot;initialSortOrderPos&quot;);</span>
<a href="#l4.870"></a><span id="l4.870" class="difflineplus">+                // and then discard the property.</span>
<a href="#l4.871"></a><span id="l4.871" class="difflineplus">+                this.mCalendarList.splice(initialSortOrderPos, 0, calendar);</span>
<a href="#l4.872"></a><span id="l4.872" class="difflineplus">+                calendar.deleteProperty(&quot;initialSortOrderPos&quot;);</span>
<a href="#l4.873"></a><span id="l4.873">             } else {</span>
<a href="#l4.874"></a><span id="l4.874" class="difflineminus">-                this.mCalendarList.push(aCalendar);</span>
<a href="#l4.875"></a><span id="l4.875" class="difflineplus">+                this.mCalendarList.push(calendar);</span>
<a href="#l4.876"></a><span id="l4.876">             }</span>
<a href="#l4.877"></a><span id="l4.877" class="difflineminus">-            this.treebox.rowCountChanged(this.mCalendarList.length - 1, 1);</span>
<a href="#l4.878"></a><span id="l4.878" class="difflineplus">+</span>
<a href="#l4.879"></a><span id="l4.879" class="difflineplus">+            this.tree.rowCountChanged(this.mCalendarList.length - 1, 1);</span>
<a href="#l4.880"></a><span id="l4.880"> </span>
<a href="#l4.881"></a><span id="l4.881">             if (!composite.defaultCalendar ||</span>
<a href="#l4.882"></a><span id="l4.882" class="difflineminus">-                aCalendar.id == composite.defaultCalendar.id) {</span>
<a href="#l4.883"></a><span id="l4.883" class="difflineplus">+                calendar.id == composite.defaultCalendar.id) {</span>
<a href="#l4.884"></a><span id="l4.884">                 this.tree.view.selection.select(this.mCalendarList.length - 1);</span>
<a href="#l4.885"></a><span id="l4.885">             }</span>
<a href="#l4.886"></a><span id="l4.886"> </span>
<a href="#l4.887"></a><span id="l4.887" class="difflineminus">-            this.updateCalendarColor(aCalendar);</span>
<a href="#l4.888"></a><span id="l4.888" class="difflineplus">+            this.updateCalendarColor(calendar);</span>
<a href="#l4.889"></a><span id="l4.889"> </span>
<a href="#l4.890"></a><span id="l4.890" class="difflineminus">-            // TODO This should be done only once outside of this binding, but to</span>
<a href="#l4.891"></a><span id="l4.891" class="difflineminus">-            // do that right, we need to have an easy way to register an observer</span>
<a href="#l4.892"></a><span id="l4.892" class="difflineplus">+            // TODO This should be done only once outside of this custom element, but to</span>
<a href="#l4.893"></a><span id="l4.893" class="difflineplus">+            // do that right, we need to have an easy way to register an observer for</span>
<a href="#l4.894"></a><span id="l4.894">             // all calendar properties. This could be the calendar manager that</span>
<a href="#l4.895"></a><span id="l4.895">             // holds an observer on every calendar anyway, which would then use the</span>
<a href="#l4.896"></a><span id="l4.896">             // global observer service which clients can register with.</span>
<a href="#l4.897"></a><span id="l4.897">             if (&quot;updateStyleSheetForViews&quot; in window) {</span>
<a href="#l4.898"></a><span id="l4.898" class="difflineminus">-                updateStyleSheetForViews(aCalendar);</span>
<a href="#l4.899"></a><span id="l4.899" class="difflineplus">+                updateStyleSheetForViews(calendar);</span>
<a href="#l4.900"></a><span id="l4.900">             }</span>
<a href="#l4.901"></a><span id="l4.901"> </span>
<a href="#l4.902"></a><span id="l4.902">             // Watch the calendar for changes, i.e color.</span>
<a href="#l4.903"></a><span id="l4.903" class="difflineminus">-            aCalendar.addObserver(this.calObserver);</span>
<a href="#l4.904"></a><span id="l4.904" class="difflineplus">+            calendar.addObserver(this.calObserver);</span>
<a href="#l4.905"></a><span id="l4.905"> </span>
<a href="#l4.906"></a><span id="l4.906" class="difflineminus">-            // Adding a calendar causes the sortorder to be changed.</span>
<a href="#l4.907"></a><span id="l4.907" class="difflineplus">+            // Adding a calendar causes the sort order to be changed.</span>
<a href="#l4.908"></a><span id="l4.908">             this.sortOrderChanged();</span>
<a href="#l4.909"></a><span id="l4.909"> </span>
<a href="#l4.910"></a><span id="l4.910">             // Re-assign defaultCalendar, sometimes it is not the right one after</span>
<a href="#l4.911"></a><span id="l4.911" class="difflineminus">-            // remove &amp; add calendar.</span>
<a href="#l4.912"></a><span id="l4.912" class="difflineplus">+            // removing and adding a calendar.</span>
<a href="#l4.913"></a><span id="l4.913">             if (composite.defaultCalendar &amp;&amp; this.tree.currentIndex &gt; -1) {</span>
<a href="#l4.914"></a><span id="l4.914" class="difflineminus">-                let currentCal = this.getCalendar(this.tree.currentIndex);</span>
<a href="#l4.915"></a><span id="l4.915" class="difflineplus">+                const currentCal = this.getCalendar(this.tree.currentIndex);</span>
<a href="#l4.916"></a><span id="l4.916">                 if (composite.defaultCalendar.id != currentCal.id) {</span>
<a href="#l4.917"></a><span id="l4.917">                     composite.defaultCalendar = currentCal;</span>
<a href="#l4.918"></a><span id="l4.918">                 }</span>
<a href="#l4.919"></a><span id="l4.919">             }</span>
<a href="#l4.920"></a><span id="l4.920" class="difflineminus">-        ]]&gt;&lt;/body&gt;</span>
<a href="#l4.921"></a><span id="l4.921" class="difflineminus">-      &lt;/method&gt;</span>
<a href="#l4.922"></a><span id="l4.922" class="difflineplus">+        }</span>
<a href="#l4.923"></a><span id="l4.923"> </span>
<a href="#l4.924"></a><span id="l4.924" class="difflineminus">-      &lt;method name=&quot;removeCalendar&quot;&gt;</span>
<a href="#l4.925"></a><span id="l4.925" class="difflineminus">-        &lt;!--</span>
<a href="#l4.926"></a><span id="l4.926" class="difflineminus">-          - Remove a calendar from the calendar list</span>
<a href="#l4.927"></a><span id="l4.927" class="difflineminus">-          -</span>
<a href="#l4.928"></a><span id="l4.928" class="difflineminus">-          - @param aCalendar     The calendar to remove.</span>
<a href="#l4.929"></a><span id="l4.929" class="difflineminus">-          --&gt;</span>
<a href="#l4.930"></a><span id="l4.930" class="difflineminus">-        &lt;parameter name=&quot;aCalendar&quot;/&gt;</span>
<a href="#l4.931"></a><span id="l4.931" class="difflineminus">-        &lt;body&gt;&lt;![CDATA[</span>
<a href="#l4.932"></a><span id="l4.932" class="difflineminus">-            let index = this.findIndexById(aCalendar.id);</span>
<a href="#l4.933"></a><span id="l4.933" class="difflineplus">+        /**</span>
<a href="#l4.934"></a><span id="l4.934" class="difflineplus">+         * Remove a calendar from the tree.</span>
<a href="#l4.935"></a><span id="l4.935" class="difflineplus">+         *</span>
<a href="#l4.936"></a><span id="l4.936" class="difflineplus">+         * @param {calICalendar} calendar    The calendar object to remove.</span>
<a href="#l4.937"></a><span id="l4.937" class="difflineplus">+         */</span>
<a href="#l4.938"></a><span id="l4.938" class="difflineplus">+        removeCalendar(calendar) {</span>
<a href="#l4.939"></a><span id="l4.939" class="difflineplus">+            let index = this.findIndexById(calendar.id);</span>
<a href="#l4.940"></a><span id="l4.940">             if (index &lt; 0) {</span>
<a href="#l4.941"></a><span id="l4.941">                 return;</span>
<a href="#l4.942"></a><span id="l4.942">             }</span>
<a href="#l4.943"></a><span id="l4.943"> </span>
<a href="#l4.944"></a><span id="l4.944">             this.mCalendarList.splice(index, 1);</span>
<a href="#l4.945"></a><span id="l4.945" class="difflineminus">-            this.treebox.rowCountChanged(index, -1);</span>
<a href="#l4.946"></a><span id="l4.946" class="difflineplus">+            this.tree.rowCountChanged(index, -1);</span>
<a href="#l4.947"></a><span id="l4.947"> </span>
<a href="#l4.948"></a><span id="l4.948">             if (index == this.rowCount) {</span>
<a href="#l4.949"></a><span id="l4.949">                 index--;</span>
<a href="#l4.950"></a><span id="l4.950">             }</span>
<a href="#l4.951"></a><span id="l4.951"> </span>
<a href="#l4.952"></a><span id="l4.952">             this.tree.view.selection.select(index + 1);</span>
<a href="#l4.953"></a><span id="l4.953"> </span>
<a href="#l4.954"></a><span id="l4.954" class="difflineminus">-            aCalendar.removeObserver(this.calObserver);</span>
<a href="#l4.955"></a><span id="l4.955" class="difflineplus">+            calendar.removeObserver(this.calObserver);</span>
<a href="#l4.956"></a><span id="l4.956"> </span>
<a href="#l4.957"></a><span id="l4.957" class="difflineminus">-            // Make sure the calendar is removed from the composite calendar</span>
<a href="#l4.958"></a><span id="l4.958" class="difflineminus">-            this.compositeCalendar.removeCalendar(aCalendar);</span>
<a href="#l4.959"></a><span id="l4.959" class="difflineplus">+            // Make sure the calendar is removed from the composite calendar.</span>
<a href="#l4.960"></a><span id="l4.960" class="difflineplus">+            this.compositeCalendar.removeCalendar(calendar);</span>
<a href="#l4.961"></a><span id="l4.961"> </span>
<a href="#l4.962"></a><span id="l4.962">             // Remove the css style rule from the sheet.</span>
<a href="#l4.963"></a><span id="l4.963">             let sheet = this.sheet;</span>
<a href="#l4.964"></a><span id="l4.964">             for (let i = 0; i &lt; sheet.cssRules.length; i++) {</span>
<a href="#l4.965"></a><span id="l4.965" class="difflineminus">-                if (sheet.cssRules[i] == this.ruleCache[aCalendar.id][0] ||</span>
<a href="#l4.966"></a><span id="l4.966" class="difflineminus">-                    sheet.cssRules[i] == this.ruleCache[aCalendar.id][1]) {</span>
<a href="#l4.967"></a><span id="l4.967" class="difflineminus">-                    sheet.deleteRule(i);</span>
<a href="#l4.968"></a><span id="l4.968" class="difflineplus">+                if (sheet.cssRules[i] == this.ruleCache[calendar.id][0] ||</span>
<a href="#l4.969"></a><span id="l4.969" class="difflineplus">+                    sheet.cssRules[i] == this.ruleCache[calendar.id][1]) {</span>
<a href="#l4.970"></a><span id="l4.970" class="difflineplus">+                    this.sheet.deleteRule(i);</span>
<a href="#l4.971"></a><span id="l4.971">                 }</span>
<a href="#l4.972"></a><span id="l4.972">             }</span>
<a href="#l4.973"></a><span id="l4.973" class="difflineminus">-            delete this.ruleCache[aCalendar.id];</span>
<a href="#l4.974"></a><span id="l4.974" class="difflineplus">+            delete this.ruleCache[calendar.id];</span>
<a href="#l4.975"></a><span id="l4.975"> </span>
<a href="#l4.976"></a><span id="l4.976">             this.sortOrderChanged();</span>
<a href="#l4.977"></a><span id="l4.977" class="difflineminus">-        ]]&gt;&lt;/body&gt;</span>
<a href="#l4.978"></a><span id="l4.978" class="difflineminus">-      &lt;/method&gt;</span>
<a href="#l4.979"></a><span id="l4.979" class="difflineplus">+        }</span>
<a href="#l4.980"></a><span id="l4.980"> </span>
<a href="#l4.981"></a><span id="l4.981" class="difflineminus">-      &lt;method name=&quot;clear&quot;&gt;</span>
<a href="#l4.982"></a><span id="l4.982" class="difflineminus">-        &lt;body&gt;&lt;![CDATA[</span>
<a href="#l4.983"></a><span id="l4.983" class="difflineminus">-            this.treebox.beginUpdateBatch();</span>
<a href="#l4.984"></a><span id="l4.984" class="difflineplus">+        /**</span>
<a href="#l4.985"></a><span id="l4.985" class="difflineplus">+         * Remove all calendars from the tree.</span>
<a href="#l4.986"></a><span id="l4.986" class="difflineplus">+         */</span>
<a href="#l4.987"></a><span id="l4.987" class="difflineplus">+        clear() {</span>
<a href="#l4.988"></a><span id="l4.988" class="difflineplus">+            this.tree.beginUpdateBatch();</span>
<a href="#l4.989"></a><span id="l4.989">             try {</span>
<a href="#l4.990"></a><span id="l4.990">                 this.mCalendarList.forEach(this.removeCalendar, this);</span>
<a href="#l4.991"></a><span id="l4.991">             } finally {</span>
<a href="#l4.992"></a><span id="l4.992" class="difflineminus">-                this.treebox.endUpdateBatch();</span>
<a href="#l4.993"></a><span id="l4.993" class="difflineplus">+                this.tree.endUpdateBatch();</span>
<a href="#l4.994"></a><span id="l4.994">             }</span>
<a href="#l4.995"></a><span id="l4.995" class="difflineminus">-        ]]&gt;&lt;/body&gt;</span>
<a href="#l4.996"></a><span id="l4.996" class="difflineminus">-      &lt;/method&gt;</span>
<a href="#l4.997"></a><span id="l4.997" class="difflineplus">+        }</span>
<a href="#l4.998"></a><span id="l4.998"> </span>
<a href="#l4.999"></a><span id="l4.999" class="difflineminus">-      &lt;method name=&quot;updateCalendar&quot;&gt;</span>
<a href="#l4.1000"></a><span id="l4.1000" class="difflineminus">-        &lt;!--</span>
<a href="#l4.1001"></a><span id="l4.1001" class="difflineminus">-          - Update a calendar's tree row (to refresh the color and such)</span>
<a href="#l4.1002"></a><span id="l4.1002" class="difflineminus">-          -</span>
<a href="#l4.1003"></a><span id="l4.1003" class="difflineminus">-          - @param aCalendar     The calendar to update.</span>
<a href="#l4.1004"></a><span id="l4.1004" class="difflineminus">-          --&gt;</span>
<a href="#l4.1005"></a><span id="l4.1005" class="difflineminus">-        &lt;parameter name=&quot;aCalendar&quot;/&gt;</span>
<a href="#l4.1006"></a><span id="l4.1006" class="difflineminus">-        &lt;body&gt;&lt;![CDATA[</span>
<a href="#l4.1007"></a><span id="l4.1007" class="difflineminus">-            this.treebox.invalidateRow(this.findIndexById(aCalendar.id));</span>
<a href="#l4.1008"></a><span id="l4.1008" class="difflineminus">-        ]]&gt;&lt;/body&gt;</span>
<a href="#l4.1009"></a><span id="l4.1009" class="difflineminus">-      &lt;/method&gt;</span>
<a href="#l4.1010"></a><span id="l4.1010" class="difflineplus">+        /**</span>
<a href="#l4.1011"></a><span id="l4.1011" class="difflineplus">+         * Update a calendar's tree row (to refresh the color and such).</span>
<a href="#l4.1012"></a><span id="l4.1012" class="difflineplus">+         *</span>
<a href="#l4.1013"></a><span id="l4.1013" class="difflineplus">+         * @param {calICalendar} calendar    The calendar object to update.</span>
<a href="#l4.1014"></a><span id="l4.1014" class="difflineplus">+         */</span>
<a href="#l4.1015"></a><span id="l4.1015" class="difflineplus">+        updateCalendar(calendar) {</span>
<a href="#l4.1016"></a><span id="l4.1016" class="difflineplus">+            if (this.tree) {</span>
<a href="#l4.1017"></a><span id="l4.1017" class="difflineplus">+                this.tree.invalidateRow(this.findIndexById(calendar.id));</span>
<a href="#l4.1018"></a><span id="l4.1018" class="difflineplus">+            }</span>
<a href="#l4.1019"></a><span id="l4.1019" class="difflineplus">+        }</span>
<a href="#l4.1020"></a><span id="l4.1020"> </span>
<a href="#l4.1021"></a><span id="l4.1021" class="difflineminus">-      &lt;method name=&quot;updateCalendarColor&quot;&gt;</span>
<a href="#l4.1022"></a><span id="l4.1022" class="difflineminus">-        &lt;!--</span>
<a href="#l4.1023"></a><span id="l4.1023" class="difflineminus">-          - Update a calendar's color rules.</span>
<a href="#l4.1024"></a><span id="l4.1024" class="difflineminus">-          -</span>
<a href="#l4.1025"></a><span id="l4.1025" class="difflineminus">-          - @param aCalendar     The calendar to update.</span>
<a href="#l4.1026"></a><span id="l4.1026" class="difflineminus">-          --&gt;</span>
<a href="#l4.1027"></a><span id="l4.1027" class="difflineminus">-        &lt;parameter name=&quot;aCalendar&quot;/&gt;</span>
<a href="#l4.1028"></a><span id="l4.1028" class="difflineminus">-        &lt;body&gt;&lt;![CDATA[</span>
<a href="#l4.1029"></a><span id="l4.1029" class="difflineminus">-            let color = aCalendar.getProperty(&quot;color&quot;) || &quot;#a8c2e1&quot;;</span>
<a href="#l4.1030"></a><span id="l4.1030" class="difflineminus">-            let sheet = this.sheet;</span>
<a href="#l4.1031"></a><span id="l4.1031" class="difflineminus">-            if (!(aCalendar.id in this.ruleCache)) {</span>
<a href="#l4.1032"></a><span id="l4.1032" class="difflineminus">-                let ruleString = &quot;calendar-list-tree &gt; tree &gt; treechildren&quot; +</span>
<a href="#l4.1033"></a><span id="l4.1033" class="difflineminus">-                                 &quot;::-moz-tree-cell(color-treecol, id-&quot; +</span>
<a href="#l4.1034"></a><span id="l4.1034" class="difflineminus">-                                 aCalendar.id + &quot;) {}&quot;;</span>
<a href="#l4.1035"></a><span id="l4.1035" class="difflineplus">+        /**</span>
<a href="#l4.1036"></a><span id="l4.1036" class="difflineplus">+         * Update the color of a calendar in the tree (when its color has changed).</span>
<a href="#l4.1037"></a><span id="l4.1037" class="difflineplus">+         *</span>
<a href="#l4.1038"></a><span id="l4.1038" class="difflineplus">+         * @param {calICalendar} calendar    The calendar object to receive a color update.</span>
<a href="#l4.1039"></a><span id="l4.1039" class="difflineplus">+         */</span>
<a href="#l4.1040"></a><span id="l4.1040" class="difflineplus">+        updateCalendarColor(calendar) {</span>
<a href="#l4.1041"></a><span id="l4.1041" class="difflineplus">+            const color = calendar.getProperty(&quot;color&quot;) || &quot;#a8c2e1&quot;;</span>
<a href="#l4.1042"></a><span id="l4.1042" class="difflineplus">+            const sheet = this.sheet;</span>
<a href="#l4.1043"></a><span id="l4.1043" class="difflineplus">+            if (!(calendar.id in this.ruleCache)) {</span>
<a href="#l4.1044"></a><span id="l4.1044" class="difflineplus">+                const ruleString = &quot;.calendar-list-tree &gt; treechildren&quot; +</span>
<a href="#l4.1045"></a><span id="l4.1045" class="difflineplus">+                    &quot;::-moz-tree-cell(color-treecol, id-&quot; +</span>
<a href="#l4.1046"></a><span id="l4.1046" class="difflineplus">+                    calendar.id + &quot;) {}&quot;;</span>
<a href="#l4.1047"></a><span id="l4.1047"> </span>
<a href="#l4.1048"></a><span id="l4.1048" class="difflineminus">-                let disabledRuleString = &quot;calendar-list-tree &gt; tree &gt; treechildren&quot; +</span>
<a href="#l4.1049"></a><span id="l4.1049" class="difflineminus">-                                         &quot;::-moz-tree-cell(color-treecol, id-&quot; +</span>
<a href="#l4.1050"></a><span id="l4.1050" class="difflineminus">-                                         aCalendar.id + &quot;, disabled) {}&quot;;</span>
<a href="#l4.1051"></a><span id="l4.1051" class="difflineplus">+                const disabledRuleString = &quot;.calendar-list-tree &gt; treechildren&quot; +</span>
<a href="#l4.1052"></a><span id="l4.1052" class="difflineplus">+                    &quot;::-moz-tree-cell(color-treecol, id-&quot; +</span>
<a href="#l4.1053"></a><span id="l4.1053" class="difflineplus">+                    calendar.id + &quot;, disabled) {}&quot;;</span>
<a href="#l4.1054"></a><span id="l4.1054"> </span>
<a href="#l4.1055"></a><span id="l4.1055">                 try {</span>
<a href="#l4.1056"></a><span id="l4.1056" class="difflineminus">-                    let ruleIndex = sheet.insertRule(ruleString, sheet.cssRules.length);</span>
<a href="#l4.1057"></a><span id="l4.1057" class="difflineminus">-                    let disabledIndex = sheet.insertRule(disabledRuleString, sheet.cssRules.length);</span>
<a href="#l4.1058"></a><span id="l4.1058" class="difflineminus">-                    this.ruleCache[aCalendar.id] = [sheet.cssRules[ruleIndex], sheet.cssRules[disabledIndex]];</span>
<a href="#l4.1059"></a><span id="l4.1059" class="difflineplus">+                    const ruleIndex = sheet.insertRule(ruleString, sheet.cssRules.length);</span>
<a href="#l4.1060"></a><span id="l4.1060" class="difflineplus">+                    const disabledIndex = sheet.insertRule(disabledRuleString, sheet.cssRules.length);</span>
<a href="#l4.1061"></a><span id="l4.1061" class="difflineplus">+                    this.ruleCache[calendar.id] = [sheet.cssRules[ruleIndex], sheet.cssRules[disabledIndex]];</span>
<a href="#l4.1062"></a><span id="l4.1062">                 } catch (ex) {</span>
<a href="#l4.1063"></a><span id="l4.1063">                     sheet.ownerNode.addEventListener(&quot;load&quot;,</span>
<a href="#l4.1064"></a><span id="l4.1064" class="difflineminus">-                                                     () =&gt; this.updateCalendarColor(aCalendar),</span>
<a href="#l4.1065"></a><span id="l4.1065" class="difflineminus">-                                                     { once: true });</span>
<a href="#l4.1066"></a><span id="l4.1066" class="difflineplus">+                        () =&gt; this.updateCalendarColor(calendar), { once: true });</span>
<a href="#l4.1067"></a><span id="l4.1067">                     return;</span>
<a href="#l4.1068"></a><span id="l4.1068">                 }</span>
<a href="#l4.1069"></a><span id="l4.1069">             }</span>
<a href="#l4.1070"></a><span id="l4.1070"> </span>
<a href="#l4.1071"></a><span id="l4.1071" class="difflineminus">-            let [enabledRule, disabledRule] = this.ruleCache[aCalendar.id];</span>
<a href="#l4.1072"></a><span id="l4.1072" class="difflineplus">+            const [enabledRule, disabledRule] = this.ruleCache[calendar.id];</span>
<a href="#l4.1073"></a><span id="l4.1073">             enabledRule.style.backgroundColor = color;</span>
<a href="#l4.1074"></a><span id="l4.1074"> </span>
<a href="#l4.1075"></a><span id="l4.1075" class="difflineminus">-            let colorMatch = color.match(/#([0-9a-fA-F]{2})([0-9a-fA-F]{2})([0-9a-fA-F]{2})([0-9a-fA-F]{2})?/);</span>
<a href="#l4.1076"></a><span id="l4.1076" class="difflineplus">+            const colorMatch = color.match(/#([0-9a-fA-F]{2})([0-9a-fA-F]{2})([0-9a-fA-F]{2})([0-9a-fA-F]{2})?/);</span>
<a href="#l4.1077"></a><span id="l4.1077">             if (colorMatch &amp;&amp; this.disabledState == &quot;disabled&quot;) {</span>
<a href="#l4.1078"></a><span id="l4.1078" class="difflineminus">-                let gray = (</span>
<a href="#l4.1079"></a><span id="l4.1079" class="difflineplus">+                const gray = (</span>
<a href="#l4.1080"></a><span id="l4.1080">                     0.2126 * parseInt(colorMatch[1], 16) +</span>
<a href="#l4.1081"></a><span id="l4.1081">                     0.7152 * parseInt(colorMatch[2], 16) +</span>
<a href="#l4.1082"></a><span id="l4.1082">                     0.0722 * parseInt(colorMatch[3], 16)</span>
<a href="#l4.1083"></a><span id="l4.1083">                 );</span>
<a href="#l4.1084"></a><span id="l4.1084" class="difflineminus">-                let alpha = colorMatch[4] ? parseInt(colorMatch[4], 16) : 255;</span>
<a href="#l4.1085"></a><span id="l4.1085" class="difflineplus">+                const alpha = colorMatch[4] ? parseInt(colorMatch[4], 16) : 255;</span>
<a href="#l4.1086"></a><span id="l4.1086">                 disabledRule.style.backgroundColor = `rgba(${gray}, ${gray}, ${gray}, ${alpha})`;</span>
<a href="#l4.1087"></a><span id="l4.1087">             } else {</span>
<a href="#l4.1088"></a><span id="l4.1088">                 disabledRule.style.backgroundColor = color;</span>
<a href="#l4.1089"></a><span id="l4.1089">             }</span>
<a href="#l4.1090"></a><span id="l4.1090" class="difflineminus">-        ]]&gt;&lt;/body&gt;</span>
<a href="#l4.1091"></a><span id="l4.1091" class="difflineminus">-      &lt;/method&gt;</span>
<a href="#l4.1092"></a><span id="l4.1092" class="difflineplus">+        }</span>
<a href="#l4.1093"></a><span id="l4.1093"> </span>
<a href="#l4.1094"></a><span id="l4.1094" class="difflineminus">-      &lt;method name=&quot;getCalendarFromEvent&quot;&gt;</span>
<a href="#l4.1095"></a><span id="l4.1095" class="difflineminus">-        &lt;!--</span>
<a href="#l4.1096"></a><span id="l4.1096" class="difflineminus">-          - Get the calendar from the given DOM event. This can be a Mouse event or a</span>
<a href="#l4.1097"></a><span id="l4.1097" class="difflineminus">-          - keyboard event.</span>
<a href="#l4.1098"></a><span id="l4.1098" class="difflineminus">-          -</span>
<a href="#l4.1099"></a><span id="l4.1099" class="difflineminus">-          - @param event     The DOM event to check</span>
<a href="#l4.1100"></a><span id="l4.1100" class="difflineminus">-          - @param aCol      An out-object for the column id.</span>
<a href="#l4.1101"></a><span id="l4.1101" class="difflineminus">-          - @param aRow      An out-object for the row index.</span>
<a href="#l4.1102"></a><span id="l4.1102" class="difflineminus">-          --&gt;</span>
<a href="#l4.1103"></a><span id="l4.1103" class="difflineminus">-        &lt;parameter name=&quot;event&quot;/&gt;</span>
<a href="#l4.1104"></a><span id="l4.1104" class="difflineminus">-        &lt;parameter name=&quot;aCol&quot;/&gt;</span>
<a href="#l4.1105"></a><span id="l4.1105" class="difflineminus">-        &lt;parameter name=&quot;aRow&quot;/&gt;</span>
<a href="#l4.1106"></a><span id="l4.1106" class="difflineminus">-        &lt;body&gt;&lt;![CDATA[</span>
<a href="#l4.1107"></a><span id="l4.1107" class="difflineplus">+        /**</span>
<a href="#l4.1108"></a><span id="l4.1108" class="difflineplus">+         * Get a calendar asoociated with an event. If a row or column is passed as an argument,</span>
<a href="#l4.1109"></a><span id="l4.1109" class="difflineplus">+         * then it may be updated to the row and column derived from the event.</span>
<a href="#l4.1110"></a><span id="l4.1110" class="difflineplus">+         *</span>
<a href="#l4.1111"></a><span id="l4.1111" class="difflineplus">+         * @param {Event} event     An event.</span>
<a href="#l4.1112"></a><span id="l4.1112" class="difflineplus">+         * @param {Object} [col]    A column.</span>
<a href="#l4.1113"></a><span id="l4.1113" class="difflineplus">+         * @param {Object} [row]    A row.</span>
<a href="#l4.1114"></a><span id="l4.1114" class="difflineplus">+         * @return                  A calendar.</span>
<a href="#l4.1115"></a><span id="l4.1115" class="difflineplus">+         */</span>
<a href="#l4.1116"></a><span id="l4.1116" class="difflineplus">+        getCalendarFromEvent(event, col = {}, row = {}) {</span>
<a href="#l4.1117"></a><span id="l4.1117">             if (event.clientX &amp;&amp; event.clientY) {</span>
<a href="#l4.1118"></a><span id="l4.1118" class="difflineminus">-                // If we have a client point, get the row directly from the client</span>
<a href="#l4.1119"></a><span id="l4.1119" class="difflineminus">-                // point.</span>
<a href="#l4.1120"></a><span id="l4.1120" class="difflineminus">-                aRow = aRow || {};</span>
<a href="#l4.1121"></a><span id="l4.1121" class="difflineminus">-                aCol = aCol || {};</span>
<a href="#l4.1122"></a><span id="l4.1122" class="difflineminus">-                let { col, row } = this.treebox.getCellAt(event.clientX, event.clientY);</span>
<a href="#l4.1123"></a><span id="l4.1123" class="difflineminus">-                aCol.value = col;</span>
<a href="#l4.1124"></a><span id="l4.1124" class="difflineminus">-                aRow.value = row;</span>
<a href="#l4.1125"></a><span id="l4.1125" class="difflineplus">+                // If we have a client point, get the row directly from the client point.</span>
<a href="#l4.1126"></a><span id="l4.1126" class="difflineplus">+</span>
<a href="#l4.1127"></a><span id="l4.1127" class="difflineplus">+                const { col: cellCol, row: cellRow } = this.tree</span>
<a href="#l4.1128"></a><span id="l4.1128" class="difflineplus">+                    .getCellAt(event.clientX, event.clientY);</span>
<a href="#l4.1129"></a><span id="l4.1129" class="difflineplus">+</span>
<a href="#l4.1130"></a><span id="l4.1130" class="difflineplus">+                col.value = cellCol;</span>
<a href="#l4.1131"></a><span id="l4.1131" class="difflineplus">+                row.value = cellRow;</span>
<a href="#l4.1132"></a><span id="l4.1132">             } else if (document.popupNode &amp;&amp; document.popupNode.contextCalendar) {</span>
<a href="#l4.1133"></a><span id="l4.1133">                 // Otherwise, we can try to get the context calendar from the popupNode.</span>
<a href="#l4.1134"></a><span id="l4.1134">                 return document.popupNode.contextCalendar;</span>
<a href="#l4.1135"></a><span id="l4.1135">             }</span>
<a href="#l4.1136"></a><span id="l4.1136" class="difflineminus">-            return aRow &amp;&amp; aRow.value &gt; -1 &amp;&amp; this.mCalendarList[aRow.value];</span>
<a href="#l4.1137"></a><span id="l4.1137" class="difflineminus">-        ]]&gt;&lt;/body&gt;</span>
<a href="#l4.1138"></a><span id="l4.1138" class="difflineminus">-      &lt;/method&gt;</span>
<a href="#l4.1139"></a><span id="l4.1139" class="difflineplus">+            return row &amp;&amp; row.value &gt; -1 &amp;&amp; this.mCalendarList[row.value];</span>
<a href="#l4.1140"></a><span id="l4.1140" class="difflineplus">+        }</span>
<a href="#l4.1141"></a><span id="l4.1141"> </span>
<a href="#l4.1142"></a><span id="l4.1142" class="difflineminus">-      &lt;method name=&quot;getCalendar&quot;&gt;</span>
<a href="#l4.1143"></a><span id="l4.1143" class="difflineminus">-        &lt;!--</span>
<a href="#l4.1144"></a><span id="l4.1144" class="difflineminus">-          - Get the calendar from a certain index.</span>
<a href="#l4.1145"></a><span id="l4.1145" class="difflineminus">-          -</span>
<a href="#l4.1146"></a><span id="l4.1146" class="difflineminus">-          - @param aIndex     The index to get the calendar for.</span>
<a href="#l4.1147"></a><span id="l4.1147" class="difflineminus">-          --&gt;</span>
<a href="#l4.1148"></a><span id="l4.1148" class="difflineminus">-        &lt;parameter name=&quot;aIndex&quot;/&gt;</span>
<a href="#l4.1149"></a><span id="l4.1149" class="difflineminus">-        &lt;body&gt;&lt;![CDATA[</span>
<a href="#l4.1150"></a><span id="l4.1150" class="difflineminus">-            let index = Math.max(0, Math.min(this.mCalendarList.length - 1, aIndex));</span>
<a href="#l4.1151"></a><span id="l4.1151" class="difflineminus">-            return this.mCalendarList[index];</span>
<a href="#l4.1152"></a><span id="l4.1152" class="difflineminus">-        ]]&gt;&lt;/body&gt;</span>
<a href="#l4.1153"></a><span id="l4.1153" class="difflineminus">-      &lt;/method&gt;</span>
<a href="#l4.1154"></a><span id="l4.1154" class="difflineplus">+        /**</span>
<a href="#l4.1155"></a><span id="l4.1155" class="difflineplus">+         * Return a calendar for the given index.</span>
<a href="#l4.1156"></a><span id="l4.1156" class="difflineplus">+         *</span>
<a href="#l4.1157"></a><span id="l4.1157" class="difflineplus">+         * @param {number} index    An index.</span>
<a href="#l4.1158"></a><span id="l4.1158" class="difflineplus">+         * @return                  A calendar.</span>
<a href="#l4.1159"></a><span id="l4.1159" class="difflineplus">+         */</span>
<a href="#l4.1160"></a><span id="l4.1160" class="difflineplus">+        getCalendar(index) {</span>
<a href="#l4.1161"></a><span id="l4.1161" class="difflineplus">+            const validIndex = Math.max(0, Math.min(this.mCalendarList.length - 1, index));</span>
<a href="#l4.1162"></a><span id="l4.1162" class="difflineplus">+            return this.mCalendarList[validIndex];</span>
<a href="#l4.1163"></a><span id="l4.1163" class="difflineplus">+        }</span>
<a href="#l4.1164"></a><span id="l4.1164"> </span>
<a href="#l4.1165"></a><span id="l4.1165" class="difflineminus">-      &lt;!-- Implement nsITreeView --&gt;</span>
<a href="#l4.1166"></a><span id="l4.1166" class="difflineminus">-      &lt;property name=&quot;rowCount&quot;</span>
<a href="#l4.1167"></a><span id="l4.1167" class="difflineminus">-                readonly=&quot;true&quot;</span>
<a href="#l4.1168"></a><span id="l4.1168" class="difflineminus">-                onget=&quot;return this.mCalendarList.length&quot;/&gt;</span>
<a href="#l4.1169"></a><span id="l4.1169" class="difflineplus">+        // nsITreeView Methods and Related Methods</span>
<a href="#l4.1170"></a><span id="l4.1170"> </span>
<a href="#l4.1171"></a><span id="l4.1171" class="difflineminus">-      &lt;method name=&quot;getCellProperties&quot;&gt;</span>
<a href="#l4.1172"></a><span id="l4.1172" class="difflineminus">-        &lt;parameter name=&quot;aRow&quot;/&gt;</span>
<a href="#l4.1173"></a><span id="l4.1173" class="difflineminus">-        &lt;parameter name=&quot;aCol&quot;/&gt;</span>
<a href="#l4.1174"></a><span id="l4.1174" class="difflineminus">-        &lt;body&gt;&lt;![CDATA[</span>
<a href="#l4.1175"></a><span id="l4.1175" class="difflineplus">+        getCellProperties(row, col) {</span>
<a href="#l4.1176"></a><span id="l4.1176">             try {</span>
<a href="#l4.1177"></a><span id="l4.1177" class="difflineminus">-                let rowProps = this.getRowProperties(aRow);</span>
<a href="#l4.1178"></a><span id="l4.1178" class="difflineminus">-                let colProps = this.getColumnProperties(aCol);</span>
<a href="#l4.1179"></a><span id="l4.1179" class="difflineplus">+                const rowProps = this.getRowProperties(row);</span>
<a href="#l4.1180"></a><span id="l4.1180" class="difflineplus">+                const colProps = this.getColumnProperties(col);</span>
<a href="#l4.1181"></a><span id="l4.1181">                 return rowProps + (rowProps &amp;&amp; colProps ? &quot; &quot; : &quot;&quot;) + colProps;</span>
<a href="#l4.1182"></a><span id="l4.1182">             } catch (e) {</span>
<a href="#l4.1183"></a><span id="l4.1183" class="difflineminus">-                // It seems errors in these functions are not shown, do this</span>
<a href="#l4.1184"></a><span id="l4.1184" class="difflineminus">-                // explicitly.</span>
<a href="#l4.1185"></a><span id="l4.1185" class="difflineplus">+                // It seems errors in these functions are not shown, do this explicitly.</span>
<a href="#l4.1186"></a><span id="l4.1186">                 cal.ERROR(&quot;Error getting cell props: &quot; + e);</span>
<a href="#l4.1187"></a><span id="l4.1187">                 return &quot;&quot;;</span>
<a href="#l4.1188"></a><span id="l4.1188">             }</span>
<a href="#l4.1189"></a><span id="l4.1189" class="difflineminus">-        ]]&gt;&lt;/body&gt;</span>
<a href="#l4.1190"></a><span id="l4.1190" class="difflineminus">-      &lt;/method&gt;</span>
<a href="#l4.1191"></a><span id="l4.1191" class="difflineplus">+        }</span>
<a href="#l4.1192"></a><span id="l4.1192"> </span>
<a href="#l4.1193"></a><span id="l4.1193" class="difflineminus">-      &lt;method name=&quot;getRowProperties&quot;&gt;</span>
<a href="#l4.1194"></a><span id="l4.1194" class="difflineminus">-        &lt;parameter name=&quot;aRow&quot;/&gt;</span>
<a href="#l4.1195"></a><span id="l4.1195" class="difflineminus">-        &lt;body&gt;&lt;![CDATA[</span>
<a href="#l4.1196"></a><span id="l4.1196" class="difflineminus">-            let properties = [];</span>
<a href="#l4.1197"></a><span id="l4.1197" class="difflineminus">-            let calendar = this.getCalendar(aRow);</span>
<a href="#l4.1198"></a><span id="l4.1198" class="difflineminus">-            let composite = this.compositeCalendar;</span>
<a href="#l4.1199"></a><span id="l4.1199" class="difflineplus">+        getRowProperties(row) {</span>
<a href="#l4.1200"></a><span id="l4.1200" class="difflineplus">+            const properties = [];</span>
<a href="#l4.1201"></a><span id="l4.1201" class="difflineplus">+            const calendar = this.getCalendar(row);</span>
<a href="#l4.1202"></a><span id="l4.1202" class="difflineplus">+            const composite = this.compositeCalendar;</span>
<a href="#l4.1203"></a><span id="l4.1203"> </span>
<a href="#l4.1204"></a><span id="l4.1204" class="difflineminus">-            // Set up the calendar id</span>
<a href="#l4.1205"></a><span id="l4.1205" class="difflineplus">+            // Set up the calendar id.</span>
<a href="#l4.1206"></a><span id="l4.1206">             properties.push(&quot;id-&quot; + calendar.id);</span>
<a href="#l4.1207"></a><span id="l4.1207"> </span>
<a href="#l4.1208"></a><span id="l4.1208" class="difflineminus">-            // Get the calendar color</span>
<a href="#l4.1209"></a><span id="l4.1209" class="difflineminus">-            let color = (calendar.getProperty(&quot;color&quot;) || &quot;&quot;).substr(1);</span>
<a href="#l4.1210"></a><span id="l4.1210" class="difflineplus">+            // Get the calendar color.</span>
<a href="#l4.1211"></a><span id="l4.1211" class="difflineplus">+            const color = (calendar.getProperty(&quot;color&quot;) || &quot;&quot;).substr(1);</span>
<a href="#l4.1212"></a><span id="l4.1212"> </span>
<a href="#l4.1213"></a><span id="l4.1213" class="difflineminus">-            // Set up the calendar color (background)</span>
<a href="#l4.1214"></a><span id="l4.1214" class="difflineplus">+            // Set up the calendar color (background).</span>
<a href="#l4.1215"></a><span id="l4.1215">             properties.push(&quot;color-&quot; + (color || &quot;default&quot;));</span>
<a href="#l4.1216"></a><span id="l4.1216"> </span>
<a href="#l4.1217"></a><span id="l4.1217" class="difflineminus">-            // Set a property to get the contrasting text color (foreground)</span>
<a href="#l4.1218"></a><span id="l4.1218" class="difflineplus">+            // Set a property to get the contrasting text color (foreground).</span>
<a href="#l4.1219"></a><span id="l4.1219">             properties.push(cal.view.getContrastingTextColor(color || &quot;a8c2e1&quot;));</span>
<a href="#l4.1220"></a><span id="l4.1220"> </span>
<a href="#l4.1221"></a><span id="l4.1221" class="difflineminus">-            let currentStatus = calendar.getProperty(&quot;currentStatus&quot;);</span>
<a href="#l4.1222"></a><span id="l4.1222" class="difflineplus">+            const currentStatus = calendar.getProperty(&quot;currentStatus&quot;);</span>
<a href="#l4.1223"></a><span id="l4.1223">             if (!Components.isSuccessCode(currentStatus)) {</span>
<a href="#l4.1224"></a><span id="l4.1224">                 // 'readfailed' is supposed to &quot;win&quot; over 'readonly', meaning that</span>
<a href="#l4.1225"></a><span id="l4.1225">                 // if reading from a calendar fails there is no further need to also display</span>
<a href="#l4.1226"></a><span id="l4.1226" class="difflineminus">-                // information about 'readonly' status</span>
<a href="#l4.1227"></a><span id="l4.1227" class="difflineplus">+                // information about 'readonly' status.</span>
<a href="#l4.1228"></a><span id="l4.1228">                 properties.push(&quot;readfailed&quot;);</span>
<a href="#l4.1229"></a><span id="l4.1229">             } else if (calendar.readOnly) {</span>
<a href="#l4.1230"></a><span id="l4.1230">                 properties.push(&quot;readonly&quot;);</span>
<a href="#l4.1231"></a><span id="l4.1231">             }</span>
<a href="#l4.1232"></a><span id="l4.1232"> </span>
<a href="#l4.1233"></a><span id="l4.1233" class="difflineminus">-            // Set up the composite calendar status and disabled state</span>
<a href="#l4.1234"></a><span id="l4.1234" class="difflineplus">+            // Set up the composite calendar status and disabled state.</span>
<a href="#l4.1235"></a><span id="l4.1235" class="difflineplus">+            const isDisabled = calendar.getProperty(&quot;disabled&quot;);</span>
<a href="#l4.1236"></a><span id="l4.1236" class="difflineplus">+</span>
<a href="#l4.1237"></a><span id="l4.1237" class="difflineplus">+            const disabledState = !isDisabled || (isDisabled &amp;&amp; this.disabledState == &quot;ignore&quot;)</span>
<a href="#l4.1238"></a><span id="l4.1238" class="difflineplus">+                ? &quot;enabled&quot;</span>
<a href="#l4.1239"></a><span id="l4.1239" class="difflineplus">+                : &quot;disabled&quot;;</span>
<a href="#l4.1240"></a><span id="l4.1240" class="difflineplus">+</span>
<a href="#l4.1241"></a><span id="l4.1241">             let checkedState = composite.getCalendarById(calendar.id) ? &quot;checked&quot; : &quot;unchecked&quot;;</span>
<a href="#l4.1242"></a><span id="l4.1242" class="difflineminus">-            let isDisabled = calendar.getProperty(&quot;disabled&quot;);</span>
<a href="#l4.1243"></a><span id="l4.1243" class="difflineminus">-            let disabledState = isDisabled ? &quot;disabled&quot; : &quot;enabled&quot;;</span>
<a href="#l4.1244"></a><span id="l4.1244"> </span>
<a href="#l4.1245"></a><span id="l4.1245" class="difflineminus">-            if (isDisabled &amp;&amp; this.disabledState == &quot;ignore&quot;) {</span>
<a href="#l4.1246"></a><span id="l4.1246" class="difflineminus">-                disabledState = &quot;enabled&quot;;</span>
<a href="#l4.1247"></a><span id="l4.1247" class="difflineminus">-            } else if (isDisabled &amp;&amp; this.disabledState == &quot;checked&quot;) {</span>
<a href="#l4.1248"></a><span id="l4.1248" class="difflineplus">+            if (isDisabled &amp;&amp; this.disabledState == &quot;checked&quot;) {</span>
<a href="#l4.1249"></a><span id="l4.1249">                 checkedState = &quot;checked&quot;;</span>
<a href="#l4.1250"></a><span id="l4.1250">             } else if (isDisabled) {</span>
<a href="#l4.1251"></a><span id="l4.1251">                 checkedState = &quot;unchecked&quot;;</span>
<a href="#l4.1252"></a><span id="l4.1252">             }</span>
<a href="#l4.1253"></a><span id="l4.1253"> </span>
<a href="#l4.1254"></a><span id="l4.1254">             properties.push(disabledState, checkedState);</span>
<a href="#l4.1255"></a><span id="l4.1255"> </span>
<a href="#l4.1256"></a><span id="l4.1256">             return properties.join(&quot; &quot;);</span>
<a href="#l4.1257"></a><span id="l4.1257" class="difflineminus">-        ]]&gt;&lt;/body&gt;</span>
<a href="#l4.1258"></a><span id="l4.1258" class="difflineminus">-      &lt;/method&gt;</span>
<a href="#l4.1259"></a><span id="l4.1259" class="difflineplus">+        }</span>
<a href="#l4.1260"></a><span id="l4.1260"> </span>
<a href="#l4.1261"></a><span id="l4.1261" class="difflineminus">-      &lt;method name=&quot;getColumnProperties&quot;&gt;</span>
<a href="#l4.1262"></a><span id="l4.1262" class="difflineminus">-        &lt;parameter name=&quot;aCol&quot;/&gt;</span>
<a href="#l4.1263"></a><span id="l4.1263" class="difflineminus">-        &lt;body&gt;&lt;![CDATA[</span>
<a href="#l4.1264"></a><span id="l4.1264" class="difflineminus">-            // Workaround for anonymous treecols</span>
<a href="#l4.1265"></a><span id="l4.1265" class="difflineminus">-            return aCol.element.getAttribute(&quot;anonid&quot;);</span>
<a href="#l4.1266"></a><span id="l4.1266" class="difflineminus">-        ]]&gt;&lt;/body&gt;</span>
<a href="#l4.1267"></a><span id="l4.1267" class="difflineminus">-      &lt;/method&gt;</span>
<a href="#l4.1268"></a><span id="l4.1268" class="difflineminus">-</span>
<a href="#l4.1269"></a><span id="l4.1269" class="difflineminus">-      &lt;method name=&quot;isContainer&quot;&gt;</span>
<a href="#l4.1270"></a><span id="l4.1270" class="difflineminus">-        &lt;parameter name=&quot;aRow&quot;/&gt;</span>
<a href="#l4.1271"></a><span id="l4.1271" class="difflineminus">-        &lt;body&gt;&lt;![CDATA[</span>
<a href="#l4.1272"></a><span id="l4.1272" class="difflineminus">-            return false;</span>
<a href="#l4.1273"></a><span id="l4.1273" class="difflineminus">-        ]]&gt;&lt;/body&gt;</span>
<a href="#l4.1274"></a><span id="l4.1274" class="difflineminus">-      &lt;/method&gt;</span>
<a href="#l4.1275"></a><span id="l4.1275" class="difflineplus">+        getColumnProperties(col) {</span>
<a href="#l4.1276"></a><span id="l4.1276" class="difflineplus">+            return col.element.getAttribute(&quot;type&quot;);</span>
<a href="#l4.1277"></a><span id="l4.1277" class="difflineplus">+        }</span>
<a href="#l4.1278"></a><span id="l4.1278"> </span>
<a href="#l4.1279"></a><span id="l4.1279" class="difflineminus">-      &lt;method name=&quot;isContainerOpen&quot;&gt;</span>
<a href="#l4.1280"></a><span id="l4.1280" class="difflineminus">-        &lt;parameter name=&quot;aRow&quot;/&gt;</span>
<a href="#l4.1281"></a><span id="l4.1281" class="difflineminus">-        &lt;body&gt;&lt;![CDATA[</span>
<a href="#l4.1282"></a><span id="l4.1282" class="difflineplus">+        isContainer(row) {</span>
<a href="#l4.1283"></a><span id="l4.1283">             return false;</span>
<a href="#l4.1284"></a><span id="l4.1284" class="difflineminus">-        ]]&gt;&lt;/body&gt;</span>
<a href="#l4.1285"></a><span id="l4.1285" class="difflineminus">-      &lt;/method&gt;</span>
<a href="#l4.1286"></a><span id="l4.1286" class="difflineplus">+        }</span>
<a href="#l4.1287"></a><span id="l4.1287"> </span>
<a href="#l4.1288"></a><span id="l4.1288" class="difflineminus">-      &lt;method name=&quot;isContainerEmpty&quot;&gt;</span>
<a href="#l4.1289"></a><span id="l4.1289" class="difflineminus">-        &lt;parameter name=&quot;aRow&quot;/&gt;</span>
<a href="#l4.1290"></a><span id="l4.1290" class="difflineminus">-        &lt;body&gt;&lt;![CDATA[</span>
<a href="#l4.1291"></a><span id="l4.1291" class="difflineminus">-            return false;</span>
<a href="#l4.1292"></a><span id="l4.1292" class="difflineminus">-        ]]&gt;&lt;/body&gt;</span>
<a href="#l4.1293"></a><span id="l4.1293" class="difflineminus">-      &lt;/method&gt;</span>
<a href="#l4.1294"></a><span id="l4.1294" class="difflineminus">-</span>
<a href="#l4.1295"></a><span id="l4.1295" class="difflineminus">-      &lt;method name=&quot;isSeparator&quot;&gt;</span>
<a href="#l4.1296"></a><span id="l4.1296" class="difflineminus">-        &lt;parameter name=&quot;aRow&quot;/&gt;</span>
<a href="#l4.1297"></a><span id="l4.1297" class="difflineminus">-        &lt;body&gt;&lt;![CDATA[</span>
<a href="#l4.1298"></a><span id="l4.1298" class="difflineplus">+        isContainerOpen(row) {</span>
<a href="#l4.1299"></a><span id="l4.1299">             return false;</span>
<a href="#l4.1300"></a><span id="l4.1300" class="difflineminus">-        ]]&gt;&lt;/body&gt;</span>
<a href="#l4.1301"></a><span id="l4.1301" class="difflineminus">-      &lt;/method&gt;</span>
<a href="#l4.1302"></a><span id="l4.1302" class="difflineplus">+        }</span>
<a href="#l4.1303"></a><span id="l4.1303"> </span>
<a href="#l4.1304"></a><span id="l4.1304" class="difflineminus">-      &lt;method name=&quot;isSorted&quot;&gt;</span>
<a href="#l4.1305"></a><span id="l4.1305" class="difflineminus">-        &lt;parameter name=&quot;aRow&quot;/&gt;</span>
<a href="#l4.1306"></a><span id="l4.1306" class="difflineminus">-        &lt;body&gt;&lt;![CDATA[</span>
<a href="#l4.1307"></a><span id="l4.1307" class="difflineplus">+        isContainerEmpty(row) {</span>
<a href="#l4.1308"></a><span id="l4.1308">             return false;</span>
<a href="#l4.1309"></a><span id="l4.1309" class="difflineminus">-        ]]&gt;&lt;/body&gt;</span>
<a href="#l4.1310"></a><span id="l4.1310" class="difflineminus">-      &lt;/method&gt;</span>
<a href="#l4.1311"></a><span id="l4.1311" class="difflineplus">+        }</span>
<a href="#l4.1312"></a><span id="l4.1312"> </span>
<a href="#l4.1313"></a><span id="l4.1313" class="difflineminus">-      &lt;method name=&quot;onDragStart&quot;&gt;</span>
<a href="#l4.1314"></a><span id="l4.1314" class="difflineminus">-        &lt;!--</span>
<a href="#l4.1315"></a><span id="l4.1315" class="difflineminus">-          - Initiate a drag operation for the calendar list. Can be used in the</span>
<a href="#l4.1316"></a><span id="l4.1316" class="difflineminus">-          - dragstart handler.</span>
<a href="#l4.1317"></a><span id="l4.1317" class="difflineminus">-          -</span>
<a href="#l4.1318"></a><span id="l4.1318" class="difflineminus">-          - @param event     The DOM event containing drag information.</span>
<a href="#l4.1319"></a><span id="l4.1319" class="difflineminus">-          --&gt;</span>
<a href="#l4.1320"></a><span id="l4.1320" class="difflineminus">-        &lt;parameter name=&quot;event&quot;/&gt;</span>
<a href="#l4.1321"></a><span id="l4.1321" class="difflineminus">-        &lt;body&gt;&lt;![CDATA[</span>
<a href="#l4.1322"></a><span id="l4.1322" class="difflineminus">-            let calendar = this.getCalendarFromEvent(event);</span>
<a href="#l4.1323"></a><span id="l4.1323" class="difflineminus">-            if (this.allowDrag &amp;&amp; event.dataTransfer) {</span>
<a href="#l4.1324"></a><span id="l4.1324" class="difflineminus">-                // Setting data starts a drag session, do this only if dragging</span>
<a href="#l4.1325"></a><span id="l4.1325" class="difflineminus">-                // is enabled for this binding.</span>
<a href="#l4.1326"></a><span id="l4.1326" class="difflineminus">-                event.dataTransfer.setData(&quot;application/x-moz-calendarID&quot;, calendar.id);</span>
<a href="#l4.1327"></a><span id="l4.1327" class="difflineminus">-                event.dataTransfer.effectAllowed = &quot;move&quot;;</span>
<a href="#l4.1328"></a><span id="l4.1328" class="difflineminus">-            }</span>
<a href="#l4.1329"></a><span id="l4.1329" class="difflineminus">-        ]]&gt;&lt;/body&gt;</span>
<a href="#l4.1330"></a><span id="l4.1330" class="difflineminus">-      &lt;/method&gt;</span>
<a href="#l4.1331"></a><span id="l4.1331" class="difflineplus">+        isSeparator(row) {</span>
<a href="#l4.1332"></a><span id="l4.1332" class="difflineplus">+            return false;</span>
<a href="#l4.1333"></a><span id="l4.1333" class="difflineplus">+        }</span>
<a href="#l4.1334"></a><span id="l4.1334"> </span>
<a href="#l4.1335"></a><span id="l4.1335" class="difflineminus">-      &lt;method name=&quot;canDrop&quot;&gt;</span>
<a href="#l4.1336"></a><span id="l4.1336" class="difflineminus">-        &lt;parameter name=&quot;aRow&quot;/&gt;</span>
<a href="#l4.1337"></a><span id="l4.1337" class="difflineminus">-        &lt;parameter name=&quot;aOrientation&quot;/&gt;</span>
<a href="#l4.1338"></a><span id="l4.1338" class="difflineminus">-        &lt;body&gt;&lt;![CDATA[</span>
<a href="#l4.1339"></a><span id="l4.1339" class="difflineminus">-            let dragSession = cal.getDragService().getCurrentSession();</span>
<a href="#l4.1340"></a><span id="l4.1340" class="difflineminus">-            let dataTransfer = dragSession &amp;&amp; dragSession.dataTransfer;</span>
<a href="#l4.1341"></a><span id="l4.1341" class="difflineplus">+        isSorted(row) {</span>
<a href="#l4.1342"></a><span id="l4.1342" class="difflineplus">+            return false;</span>
<a href="#l4.1343"></a><span id="l4.1343" class="difflineplus">+        }</span>
<a href="#l4.1344"></a><span id="l4.1344" class="difflineplus">+</span>
<a href="#l4.1345"></a><span id="l4.1345" class="difflineplus">+        canDrop(row, orientation) {</span>
<a href="#l4.1346"></a><span id="l4.1346" class="difflineplus">+            const dragSession = cal.getDragService().getCurrentSession();</span>
<a href="#l4.1347"></a><span id="l4.1347" class="difflineplus">+            const dataTransfer = dragSession &amp;&amp; dragSession.dataTransfer;</span>
<a href="#l4.1348"></a><span id="l4.1348">             if (!this.allowDrag || !dataTransfer) {</span>
<a href="#l4.1349"></a><span id="l4.1349">                 // If dragging is not allowed or there is no data transfer then</span>
<a href="#l4.1350"></a><span id="l4.1350">                 // we can't drop (i.e dropping a file on the calendar list).</span>
<a href="#l4.1351"></a><span id="l4.1351">                 return false;</span>
<a href="#l4.1352"></a><span id="l4.1352">             }</span>
<a href="#l4.1353"></a><span id="l4.1353"> </span>
<a href="#l4.1354"></a><span id="l4.1354" class="difflineminus">-            let dragCalId = dataTransfer.getData(&quot;application/x-moz-calendarID&quot;);</span>
<a href="#l4.1355"></a><span id="l4.1355" class="difflineplus">+            const dragCalId = dataTransfer.getData(&quot;application/x-moz-calendarID&quot;);</span>
<a href="#l4.1356"></a><span id="l4.1356"> </span>
<a href="#l4.1357"></a><span id="l4.1357" class="difflineminus">-            return (aOrientation != Ci.nsITreeView.DROP_ON &amp;&amp;</span>
<a href="#l4.1358"></a><span id="l4.1358" class="difflineminus">-                    dragCalId != null);</span>
<a href="#l4.1359"></a><span id="l4.1359" class="difflineminus">-        ]]&gt;&lt;/body&gt;</span>
<a href="#l4.1360"></a><span id="l4.1360" class="difflineminus">-      &lt;/method&gt;</span>
<a href="#l4.1361"></a><span id="l4.1361" class="difflineplus">+            return (orientation != Ci.nsITreeView.DROP_ON &amp;&amp; dragCalId != null);</span>
<a href="#l4.1362"></a><span id="l4.1362" class="difflineplus">+        }</span>
<a href="#l4.1363"></a><span id="l4.1363"> </span>
<a href="#l4.1364"></a><span id="l4.1364" class="difflineminus">-      &lt;method name=&quot;drop&quot;&gt;</span>
<a href="#l4.1365"></a><span id="l4.1365" class="difflineminus">-        &lt;parameter name=&quot;aRow&quot;/&gt;</span>
<a href="#l4.1366"></a><span id="l4.1366" class="difflineminus">-        &lt;parameter name=&quot;aOrientation&quot;/&gt;</span>
<a href="#l4.1367"></a><span id="l4.1367" class="difflineminus">-        &lt;body&gt;&lt;![CDATA[</span>
<a href="#l4.1368"></a><span id="l4.1368" class="difflineminus">-            let dragSession = cal.getDragService().getCurrentSession();</span>
<a href="#l4.1369"></a><span id="l4.1369" class="difflineminus">-            let dataTransfer = dragSession.dataTransfer;</span>
<a href="#l4.1370"></a><span id="l4.1370" class="difflineminus">-            let dragCalId = dataTransfer &amp;&amp;</span>
<a href="#l4.1371"></a><span id="l4.1371" class="difflineminus">-                            dataTransfer.getData(&quot;application/x-moz-calendarID&quot;);</span>
<a href="#l4.1372"></a><span id="l4.1372" class="difflineplus">+        drop(row, orientation) {</span>
<a href="#l4.1373"></a><span id="l4.1373" class="difflineplus">+            const dragSession = cal.getDragService().getCurrentSession();</span>
<a href="#l4.1374"></a><span id="l4.1374" class="difflineplus">+            const dataTransfer = dragSession.dataTransfer;</span>
<a href="#l4.1375"></a><span id="l4.1375" class="difflineplus">+            const dragCalId = dataTransfer &amp;&amp; dataTransfer.getData(&quot;application/x-moz-calendarID&quot;);</span>
<a href="#l4.1376"></a><span id="l4.1376">             if (!this.allowDrag || !dataTransfer || !dragCalId) {</span>
<a href="#l4.1377"></a><span id="l4.1377">                 return false;</span>
<a href="#l4.1378"></a><span id="l4.1378">             }</span>
<a href="#l4.1379"></a><span id="l4.1379"> </span>
<a href="#l4.1380"></a><span id="l4.1380" class="difflineminus">-            let oldIndex = -1;</span>
<a href="#l4.1381"></a><span id="l4.1381" class="difflineminus">-            for (let i = 0; i &lt; this.mCalendarList.length; i++) {</span>
<a href="#l4.1382"></a><span id="l4.1382" class="difflineminus">-                if (this.mCalendarList[i].id == dragCalId) {</span>
<a href="#l4.1383"></a><span id="l4.1383" class="difflineminus">-                    oldIndex = i;</span>
<a href="#l4.1384"></a><span id="l4.1384" class="difflineminus">-                    break;</span>
<a href="#l4.1385"></a><span id="l4.1385" class="difflineminus">-                }</span>
<a href="#l4.1386"></a><span id="l4.1386" class="difflineminus">-            }</span>
<a href="#l4.1387"></a><span id="l4.1387" class="difflineplus">+            const oldIndex = this.mCalendarList.findIndex(calendar =&gt; calendar.id == dragCalId);</span>
<a href="#l4.1388"></a><span id="l4.1388" class="difflineplus">+</span>
<a href="#l4.1389"></a><span id="l4.1389">             if (oldIndex &lt; 0) {</span>
<a href="#l4.1390"></a><span id="l4.1390">                 return false;</span>
<a href="#l4.1391"></a><span id="l4.1391">             }</span>
<a href="#l4.1392"></a><span id="l4.1392"> </span>
<a href="#l4.1393"></a><span id="l4.1393">             // If no row is specified (-1), then assume append.</span>
<a href="#l4.1394"></a><span id="l4.1394" class="difflineminus">-            let row = (aRow &lt; 0 ? this.mCalendarList.length - 1 : aRow);</span>
<a href="#l4.1395"></a><span id="l4.1395" class="difflineminus">-            let targetIndex = row + Math.max(0, aOrientation);</span>
<a href="#l4.1396"></a><span id="l4.1396" class="difflineplus">+            const validRow = (row &lt; 0 ? this.mCalendarList.length - 1 : row);</span>
<a href="#l4.1397"></a><span id="l4.1397" class="difflineplus">+            const targetIndex = validRow + Math.max(0, orientation);</span>
<a href="#l4.1398"></a><span id="l4.1398"> </span>
<a href="#l4.1399"></a><span id="l4.1399">             // We don't need to move if the target row has the same index as the old</span>
<a href="#l4.1400"></a><span id="l4.1400">             // row. The same goes for dropping after the row before the old row or</span>
<a href="#l4.1401"></a><span id="l4.1401">             // before the row after the old row. Think about it :-)</span>
<a href="#l4.1402"></a><span id="l4.1402" class="difflineminus">-            if (aRow != oldIndex &amp;&amp; row + aOrientation != oldIndex) {</span>
<a href="#l4.1403"></a><span id="l4.1403" class="difflineplus">+            if (row != oldIndex &amp;&amp; validRow + orientation != oldIndex) {</span>
<a href="#l4.1404"></a><span id="l4.1404">                 // Add the new one, remove the old one.</span>
<a href="#l4.1405"></a><span id="l4.1405">                 this.mCalendarList.splice(targetIndex, 0, this.mCalendarList[oldIndex]);</span>
<a href="#l4.1406"></a><span id="l4.1406">                 this.mCalendarList.splice(oldIndex + (oldIndex &gt; targetIndex ? 1 : 0), 1);</span>
<a href="#l4.1407"></a><span id="l4.1407"> </span>
<a href="#l4.1408"></a><span id="l4.1408">                 // Invalidate the tree rows between the old item and the new one.</span>
<a href="#l4.1409"></a><span id="l4.1409">                 if (oldIndex &lt; targetIndex) {</span>
<a href="#l4.1410"></a><span id="l4.1410" class="difflineminus">-                    this.treebox.invalidateRange(oldIndex, targetIndex);</span>
<a href="#l4.1411"></a><span id="l4.1411" class="difflineplus">+                    this.tree.invalidateRange(oldIndex, targetIndex);</span>
<a href="#l4.1412"></a><span id="l4.1412">                 } else {</span>
<a href="#l4.1413"></a><span id="l4.1413" class="difflineminus">-                    this.treebox.invalidateRange(targetIndex, oldIndex);</span>
<a href="#l4.1414"></a><span id="l4.1414" class="difflineplus">+                    this.tree.invalidateRange(targetIndex, oldIndex);</span>
<a href="#l4.1415"></a><span id="l4.1415">                 }</span>
<a href="#l4.1416"></a><span id="l4.1416"> </span>
<a href="#l4.1417"></a><span id="l4.1417" class="difflineminus">-                // Fire event</span>
<a href="#l4.1418"></a><span id="l4.1418" class="difflineplus">+                // Fire event.</span>
<a href="#l4.1419"></a><span id="l4.1419">                 this.sortOrderChanged();</span>
<a href="#l4.1420"></a><span id="l4.1420">             }</span>
<a href="#l4.1421"></a><span id="l4.1421">             return true;</span>
<a href="#l4.1422"></a><span id="l4.1422" class="difflineminus">-        ]]&gt;&lt;/body&gt;</span>
<a href="#l4.1423"></a><span id="l4.1423" class="difflineminus">-      &lt;/method&gt;</span>
<a href="#l4.1424"></a><span id="l4.1424" class="difflineplus">+        }</span>
<a href="#l4.1425"></a><span id="l4.1425"> </span>
<a href="#l4.1426"></a><span id="l4.1426" class="difflineminus">-      &lt;method name=&quot;foreignDrop&quot;&gt;</span>
<a href="#l4.1427"></a><span id="l4.1427" class="difflineminus">-        &lt;!--</span>
<a href="#l4.1428"></a><span id="l4.1428" class="difflineminus">-          - This function can be used by other nodes to simulate dropping on the</span>
<a href="#l4.1429"></a><span id="l4.1429" class="difflineminus">-          - tree. This can be used for example on the tree header so that the row</span>
<a href="#l4.1430"></a><span id="l4.1430" class="difflineminus">-          - will be inserted before the first visible row. The event client</span>
<a href="#l4.1431"></a><span id="l4.1431" class="difflineminus">-          - coordinate are used to determine if the row should be dropped before the</span>
<a href="#l4.1432"></a><span id="l4.1432" class="difflineminus">-          - first row (above treechildren) or below the last visible row (below top</span>
<a href="#l4.1433"></a><span id="l4.1433" class="difflineminus">-          - of treechildren).</span>
<a href="#l4.1434"></a><span id="l4.1434" class="difflineminus">-          -</span>
<a href="#l4.1435"></a><span id="l4.1435" class="difflineminus">-          - @param event     The DOM drop event.</span>
<a href="#l4.1436"></a><span id="l4.1436" class="difflineminus">-          - @return          Boolean indicating if the drop succeeded.</span>
<a href="#l4.1437"></a><span id="l4.1437" class="difflineminus">-          -</span>
<a href="#l4.1438"></a><span id="l4.1438" class="difflineminus">-          --&gt;</span>
<a href="#l4.1439"></a><span id="l4.1439" class="difflineminus">-        &lt;parameter name=&quot;event&quot;/&gt;</span>
<a href="#l4.1440"></a><span id="l4.1440" class="difflineminus">-        &lt;body&gt;&lt;![CDATA[</span>
<a href="#l4.1441"></a><span id="l4.1441" class="difflineminus">-            let hasDropped;</span>
<a href="#l4.1442"></a><span id="l4.1442" class="difflineminus">-            if (event.clientY &lt; this.tree.getBoundingClientRect().y) {</span>
<a href="#l4.1443"></a><span id="l4.1443" class="difflineminus">-                hasDropped = this.drop(this.treebox.getFirstVisibleRow(), -1);</span>
<a href="#l4.1444"></a><span id="l4.1444" class="difflineminus">-            } else {</span>
<a href="#l4.1445"></a><span id="l4.1445" class="difflineminus">-                hasDropped = this.drop(this.treebox.getLastVisibleRow(), 1);</span>
<a href="#l4.1446"></a><span id="l4.1446" class="difflineminus">-            }</span>
<a href="#l4.1447"></a><span id="l4.1447" class="difflineplus">+        foreignDrop(event) {</span>
<a href="#l4.1448"></a><span id="l4.1448" class="difflineplus">+            const hasDropped = event.clientY &lt; this.tree.getBoundingClientRect().y</span>
<a href="#l4.1449"></a><span id="l4.1449" class="difflineplus">+                ? this.drop(this.tree.getFirstVisibleRow(), -1)</span>
<a href="#l4.1450"></a><span id="l4.1450" class="difflineplus">+                : this.drop(this.tree.getLastVisibleRow(), 1);</span>
<a href="#l4.1451"></a><span id="l4.1451" class="difflineplus">+</span>
<a href="#l4.1452"></a><span id="l4.1452">             if (hasDropped) {</span>
<a href="#l4.1453"></a><span id="l4.1453">                 event.preventDefault();</span>
<a href="#l4.1454"></a><span id="l4.1454">             }</span>
<a href="#l4.1455"></a><span id="l4.1455">             return hasDropped;</span>
<a href="#l4.1456"></a><span id="l4.1456" class="difflineminus">-        ]]&gt;&lt;/body&gt;</span>
<a href="#l4.1457"></a><span id="l4.1457" class="difflineminus">-      &lt;/method&gt;</span>
<a href="#l4.1458"></a><span id="l4.1458" class="difflineplus">+        }</span>
<a href="#l4.1459"></a><span id="l4.1459"> </span>
<a href="#l4.1460"></a><span id="l4.1460" class="difflineminus">-      &lt;method name=&quot;foreignCanDrop&quot;&gt;</span>
<a href="#l4.1461"></a><span id="l4.1461" class="difflineminus">-        &lt;!--</span>
<a href="#l4.1462"></a><span id="l4.1462" class="difflineminus">-          - Similar function to foreignCanDrop but for the dragenter event</span>
<a href="#l4.1463"></a><span id="l4.1463" class="difflineminus">-          - @see ::foreignDrop</span>
<a href="#l4.1464"></a><span id="l4.1464" class="difflineminus">-          --&gt;</span>
<a href="#l4.1465"></a><span id="l4.1465" class="difflineminus">-        &lt;parameter name=&quot;event&quot;/&gt;</span>
<a href="#l4.1466"></a><span id="l4.1466" class="difflineminus">-        &lt;body&gt;&lt;![CDATA[</span>
<a href="#l4.1467"></a><span id="l4.1467" class="difflineplus">+        foreignCanDrop(event) {</span>
<a href="#l4.1468"></a><span id="l4.1468">             // The dragenter/dragover events expect false to be returned when</span>
<a href="#l4.1469"></a><span id="l4.1469">             // dropping is allowed, therefore we return !canDrop.</span>
<a href="#l4.1470"></a><span id="l4.1470">             if (event.clientY &lt; this.tree.getBoundingClientRect().y) {</span>
<a href="#l4.1471"></a><span id="l4.1471" class="difflineminus">-                return !this.canDrop(this.treebox.getFirstVisibleRow(), -1);</span>
<a href="#l4.1472"></a><span id="l4.1472" class="difflineplus">+                return !this.canDrop(this.tree.getFirstVisibleRow(), -1);</span>
<a href="#l4.1473"></a><span id="l4.1473">             } else {</span>
<a href="#l4.1474"></a><span id="l4.1474" class="difflineminus">-                return !this.canDrop(this.treebox.getLastVisibleRow(), 1);</span>
<a href="#l4.1475"></a><span id="l4.1475" class="difflineplus">+                return !this.canDrop(this.tree.getLastVisibleRow(), 1);</span>
<a href="#l4.1476"></a><span id="l4.1476">             }</span>
<a href="#l4.1477"></a><span id="l4.1477" class="difflineminus">-        ]]&gt;&lt;/body&gt;</span>
<a href="#l4.1478"></a><span id="l4.1478" class="difflineminus">-      &lt;/method&gt;</span>
<a href="#l4.1479"></a><span id="l4.1479" class="difflineplus">+        }</span>
<a href="#l4.1480"></a><span id="l4.1480"> </span>
<a href="#l4.1481"></a><span id="l4.1481" class="difflineminus">-      &lt;method name=&quot;getParentIndex&quot;&gt;</span>
<a href="#l4.1482"></a><span id="l4.1482" class="difflineminus">-        &lt;parameter name=&quot;aRow&quot;/&gt;</span>
<a href="#l4.1483"></a><span id="l4.1483" class="difflineminus">-        &lt;body&gt;&lt;![CDATA[</span>
<a href="#l4.1484"></a><span id="l4.1484" class="difflineplus">+        getParentIndex(row) {</span>
<a href="#l4.1485"></a><span id="l4.1485">             return -1;</span>
<a href="#l4.1486"></a><span id="l4.1486" class="difflineminus">-        ]]&gt;&lt;/body&gt;</span>
<a href="#l4.1487"></a><span id="l4.1487" class="difflineminus">-      &lt;/method&gt;</span>
<a href="#l4.1488"></a><span id="l4.1488" class="difflineplus">+        }</span>
<a href="#l4.1489"></a><span id="l4.1489"> </span>
<a href="#l4.1490"></a><span id="l4.1490" class="difflineminus">-      &lt;method name=&quot;hasNextSibling&quot;&gt;</span>
<a href="#l4.1491"></a><span id="l4.1491" class="difflineminus">-        &lt;parameter name=&quot;aRow&quot;/&gt;</span>
<a href="#l4.1492"></a><span id="l4.1492" class="difflineminus">-        &lt;parameter name=&quot;aAfterIndex&quot;/&gt;</span>
<a href="#l4.1493"></a><span id="l4.1493" class="difflineminus">-        &lt;body&gt;&lt;![CDATA[</span>
<a href="#l4.1494"></a><span id="l4.1494" class="difflineminus">-        ]]&gt;&lt;/body&gt;</span>
<a href="#l4.1495"></a><span id="l4.1495" class="difflineminus">-      &lt;/method&gt;</span>
<a href="#l4.1496"></a><span id="l4.1496" class="difflineplus">+        hasNextSibling(row, afterIndex) {}</span>
<a href="#l4.1497"></a><span id="l4.1497"> </span>
<a href="#l4.1498"></a><span id="l4.1498" class="difflineminus">-      &lt;method name=&quot;getLevel&quot;&gt;</span>
<a href="#l4.1499"></a><span id="l4.1499" class="difflineminus">-        &lt;parameter name=&quot;aRow&quot;/&gt;</span>
<a href="#l4.1500"></a><span id="l4.1500" class="difflineminus">-        &lt;body&gt;&lt;![CDATA[</span>
<a href="#l4.1501"></a><span id="l4.1501" class="difflineplus">+        getLevel(row) {</span>
<a href="#l4.1502"></a><span id="l4.1502">             return 0;</span>
<a href="#l4.1503"></a><span id="l4.1503" class="difflineminus">-        ]]&gt;&lt;/body&gt;</span>
<a href="#l4.1504"></a><span id="l4.1504" class="difflineminus">-      &lt;/method&gt;</span>
<a href="#l4.1505"></a><span id="l4.1505" class="difflineplus">+        }</span>
<a href="#l4.1506"></a><span id="l4.1506" class="difflineplus">+</span>
<a href="#l4.1507"></a><span id="l4.1507" class="difflineplus">+        getImageSrc(row) {}</span>
<a href="#l4.1508"></a><span id="l4.1508"> </span>
<a href="#l4.1509"></a><span id="l4.1509" class="difflineminus">-      &lt;method name=&quot;getImageSrc&quot;&gt;</span>
<a href="#l4.1510"></a><span id="l4.1510" class="difflineminus">-        &lt;parameter name=&quot;aRow&quot;/&gt;</span>
<a href="#l4.1511"></a><span id="l4.1511" class="difflineminus">-        &lt;body&gt;&lt;![CDATA[</span>
<a href="#l4.1512"></a><span id="l4.1512" class="difflineminus">-        ]]&gt;&lt;/body&gt;</span>
<a href="#l4.1513"></a><span id="l4.1513" class="difflineminus">-      &lt;/method&gt;</span>
<a href="#l4.1514"></a><span id="l4.1514" class="difflineplus">+        getCellValue(row, col) {</span>
<a href="#l4.1515"></a><span id="l4.1515" class="difflineplus">+            const calendar = this.getCalendar(row);</span>
<a href="#l4.1516"></a><span id="l4.1516" class="difflineplus">+            const composite = this.compositeCalendar;</span>
<a href="#l4.1517"></a><span id="l4.1517"> </span>
<a href="#l4.1518"></a><span id="l4.1518" class="difflineminus">-      &lt;method name=&quot;getCellValue&quot;&gt;</span>
<a href="#l4.1519"></a><span id="l4.1519" class="difflineminus">-        &lt;parameter name=&quot;aRow&quot;/&gt;</span>
<a href="#l4.1520"></a><span id="l4.1520" class="difflineminus">-        &lt;parameter name=&quot;aCol&quot;/&gt;</span>
<a href="#l4.1521"></a><span id="l4.1521" class="difflineminus">-        &lt;body&gt;&lt;![CDATA[</span>
<a href="#l4.1522"></a><span id="l4.1522" class="difflineminus">-            let calendar = this.getCalendar(aRow);</span>
<a href="#l4.1523"></a><span id="l4.1523" class="difflineminus">-            let composite = this.compositeCalendar;</span>
<a href="#l4.1524"></a><span id="l4.1524" class="difflineminus">-</span>
<a href="#l4.1525"></a><span id="l4.1525" class="difflineminus">-            switch (aCol.element.getAttribute(&quot;anonid&quot;)) {</span>
<a href="#l4.1526"></a><span id="l4.1526" class="difflineplus">+            switch (col.element.getAttribute(&quot;type&quot;)) {</span>
<a href="#l4.1527"></a><span id="l4.1527">                 case &quot;checkbox-treecol&quot;:</span>
<a href="#l4.1528"></a><span id="l4.1528">                     return composite.getCalendarById(calendar.id) ? &quot;true&quot; : &quot;false&quot;;</span>
<a href="#l4.1529"></a><span id="l4.1529">                 case &quot;status-treecol&quot;:</span>
<a href="#l4.1530"></a><span id="l4.1530" class="difflineminus">-                    // The value of this cell shows the calendar readonly state</span>
<a href="#l4.1531"></a><span id="l4.1531" class="difflineplus">+                    // The value of this cell shows the calendar readonly state.</span>
<a href="#l4.1532"></a><span id="l4.1532">                     return (calendar.readOnly ? &quot;true&quot; : &quot;false&quot;);</span>
<a href="#l4.1533"></a><span id="l4.1533">             }</span>
<a href="#l4.1534"></a><span id="l4.1534">             return null;</span>
<a href="#l4.1535"></a><span id="l4.1535" class="difflineminus">-        ]]&gt;&lt;/body&gt;</span>
<a href="#l4.1536"></a><span id="l4.1536" class="difflineminus">-      &lt;/method&gt;</span>
<a href="#l4.1537"></a><span id="l4.1537" class="difflineplus">+        }</span>
<a href="#l4.1538"></a><span id="l4.1538"> </span>
<a href="#l4.1539"></a><span id="l4.1539" class="difflineminus">-      &lt;method name=&quot;getCellText&quot;&gt;</span>
<a href="#l4.1540"></a><span id="l4.1540" class="difflineminus">-        &lt;parameter name=&quot;aRow&quot;/&gt;</span>
<a href="#l4.1541"></a><span id="l4.1541" class="difflineminus">-        &lt;parameter name=&quot;aCol&quot;/&gt;</span>
<a href="#l4.1542"></a><span id="l4.1542" class="difflineminus">-        &lt;body&gt;&lt;![CDATA[</span>
<a href="#l4.1543"></a><span id="l4.1543" class="difflineminus">-            switch (aCol.element.getAttribute(&quot;anonid&quot;)) {</span>
<a href="#l4.1544"></a><span id="l4.1544" class="difflineplus">+        getCellText(row, col) {</span>
<a href="#l4.1545"></a><span id="l4.1545" class="difflineplus">+            switch (col.element.getAttribute(&quot;type&quot;)) {</span>
<a href="#l4.1546"></a><span id="l4.1546">                 case &quot;calendarname-treecol&quot;:</span>
<a href="#l4.1547"></a><span id="l4.1547" class="difflineminus">-                    return this.getCalendar(aRow).name;</span>
<a href="#l4.1548"></a><span id="l4.1548" class="difflineplus">+                    return this.getCalendar(row).name;</span>
<a href="#l4.1549"></a><span id="l4.1549">             }</span>
<a href="#l4.1550"></a><span id="l4.1550">             return &quot;&quot;;</span>
<a href="#l4.1551"></a><span id="l4.1551" class="difflineminus">-        ]]&gt;&lt;/body&gt;</span>
<a href="#l4.1552"></a><span id="l4.1552" class="difflineminus">-      &lt;/method&gt;</span>
<a href="#l4.1553"></a><span id="l4.1553" class="difflineplus">+        }</span>
<a href="#l4.1554"></a><span id="l4.1554"> </span>
<a href="#l4.1555"></a><span id="l4.1555" class="difflineminus">-      &lt;method name=&quot;setTree&quot;&gt;</span>
<a href="#l4.1556"></a><span id="l4.1556" class="difflineminus">-        &lt;parameter name=&quot;aTreeBox&quot;/&gt;</span>
<a href="#l4.1557"></a><span id="l4.1557" class="difflineminus">-        &lt;body&gt;&lt;![CDATA[</span>
<a href="#l4.1558"></a><span id="l4.1558" class="difflineminus">-            this.treebox = aTreeBox;</span>
<a href="#l4.1559"></a><span id="l4.1559" class="difflineminus">-        ]]&gt;&lt;/body&gt;</span>
<a href="#l4.1560"></a><span id="l4.1560" class="difflineminus">-      &lt;/method&gt;</span>
<a href="#l4.1561"></a><span id="l4.1561" class="difflineplus">+        /**</span>
<a href="#l4.1562"></a><span id="l4.1562" class="difflineplus">+         * Called to link the tree to the tree view. A null argument un-sets/un-links the tree.</span>
<a href="#l4.1563"></a><span id="l4.1563" class="difflineplus">+         * Performs initial load of calendars if needed and if possible.</span>
<a href="#l4.1564"></a><span id="l4.1564" class="difflineplus">+         *</span>
<a href="#l4.1565"></a><span id="l4.1565" class="difflineplus">+         * @param {?CalendarListTree} tree    A tree or null.</span>
<a href="#l4.1566"></a><span id="l4.1566" class="difflineplus">+         */</span>
<a href="#l4.1567"></a><span id="l4.1567" class="difflineplus">+        setTree(tree) {</span>
<a href="#l4.1568"></a><span id="l4.1568" class="difflineplus">+            this.tree = tree;</span>
<a href="#l4.1569"></a><span id="l4.1569"> </span>
<a href="#l4.1570"></a><span id="l4.1570" class="difflineminus">-      &lt;method name=&quot;toggleOpenState&quot;&gt;</span>
<a href="#l4.1571"></a><span id="l4.1571" class="difflineminus">-        &lt;parameter name=&quot;aRow&quot;/&gt;</span>
<a href="#l4.1572"></a><span id="l4.1572" class="difflineminus">-        &lt;body&gt;&lt;![CDATA[</span>
<a href="#l4.1573"></a><span id="l4.1573" class="difflineminus">-        ]]&gt;&lt;/body&gt;</span>
<a href="#l4.1574"></a><span id="l4.1574" class="difflineminus">-      &lt;/method&gt;</span>
<a href="#l4.1575"></a><span id="l4.1575" class="difflineplus">+            if (tree &amp;&amp; this.mCompositeCalendar &amp;&amp; !this.calendarsAreLoaded) {</span>
<a href="#l4.1576"></a><span id="l4.1576" class="difflineplus">+                this.loadCalendars();</span>
<a href="#l4.1577"></a><span id="l4.1577" class="difflineplus">+            }</span>
<a href="#l4.1578"></a><span id="l4.1578" class="difflineplus">+        }</span>
<a href="#l4.1579"></a><span id="l4.1579"> </span>
<a href="#l4.1580"></a><span id="l4.1580" class="difflineminus">-      &lt;method name=&quot;cycleHeader&quot;&gt;</span>
<a href="#l4.1581"></a><span id="l4.1581" class="difflineminus">-        &lt;parameter name=&quot;aCol&quot;/&gt;</span>
<a href="#l4.1582"></a><span id="l4.1582" class="difflineminus">-        &lt;body&gt;&lt;![CDATA[</span>
<a href="#l4.1583"></a><span id="l4.1583" class="difflineminus">-        ]]&gt;&lt;/body&gt;</span>
<a href="#l4.1584"></a><span id="l4.1584" class="difflineminus">-      &lt;/method&gt;</span>
<a href="#l4.1585"></a><span id="l4.1585" class="difflineplus">+        toggleOpenState(row) {}</span>
<a href="#l4.1586"></a><span id="l4.1586"> </span>
<a href="#l4.1587"></a><span id="l4.1587" class="difflineminus">-      &lt;method name=&quot;cycleCell&quot;&gt;</span>
<a href="#l4.1588"></a><span id="l4.1588" class="difflineminus">-        &lt;parameter name=&quot;aRow&quot;/&gt;</span>
<a href="#l4.1589"></a><span id="l4.1589" class="difflineminus">-        &lt;parameter name=&quot;aCol&quot;/&gt;</span>
<a href="#l4.1590"></a><span id="l4.1590" class="difflineminus">-        &lt;body&gt;&lt;![CDATA[</span>
<a href="#l4.1591"></a><span id="l4.1591" class="difflineminus">-            let calendar = this.getCalendar(aRow);</span>
<a href="#l4.1592"></a><span id="l4.1592" class="difflineplus">+        cycleHeader(col) {}</span>
<a href="#l4.1593"></a><span id="l4.1593" class="difflineplus">+</span>
<a href="#l4.1594"></a><span id="l4.1594" class="difflineplus">+        cycleCell(row, col) {</span>
<a href="#l4.1595"></a><span id="l4.1595" class="difflineplus">+            const calendar = this.getCalendar(row);</span>
<a href="#l4.1596"></a><span id="l4.1596">             if (this.disabledState != &quot;ignore&quot; &amp;&amp; calendar.getProperty(&quot;disabled&quot;)) {</span>
<a href="#l4.1597"></a><span id="l4.1597">                 return;</span>
<a href="#l4.1598"></a><span id="l4.1598">             }</span>
<a href="#l4.1599"></a><span id="l4.1599"> </span>
<a href="#l4.1600"></a><span id="l4.1600">             if (this.mCycleCalendarFlag[calendar.id]) {</span>
<a href="#l4.1601"></a><span id="l4.1601">                 delete this.mCycleCalendarFlag[calendar.id];</span>
<a href="#l4.1602"></a><span id="l4.1602">             } else {</span>
<a href="#l4.1603"></a><span id="l4.1603" class="difflineminus">-                this.mCycleCalendarFlag[calendar.id] = [calendar, aRow];</span>
<a href="#l4.1604"></a><span id="l4.1604" class="difflineplus">+                this.mCycleCalendarFlag[calendar.id] = [calendar, row];</span>
<a href="#l4.1605"></a><span id="l4.1605">             }</span>
<a href="#l4.1606"></a><span id="l4.1606"> </span>
<a href="#l4.1607"></a><span id="l4.1607">             if (this.cycleDebounce) {</span>
<a href="#l4.1608"></a><span id="l4.1608">                 if (this.mCycleTimer) {</span>
<a href="#l4.1609"></a><span id="l4.1609">                     clearTimeout(this.mCycleTimer);</span>
<a href="#l4.1610"></a><span id="l4.1610">                 }</span>
<a href="#l4.1611"></a><span id="l4.1611">                 this.mCycleTimer = setTimeout(this.cycleCellCommit.bind(this), 200);</span>
<a href="#l4.1612"></a><span id="l4.1612">             } else {</span>
<a href="#l4.1613"></a><span id="l4.1613">                 this.cycleCellCommit();</span>
<a href="#l4.1614"></a><span id="l4.1614">             }</span>
<a href="#l4.1615"></a><span id="l4.1615" class="difflineminus">-        ]]&gt;&lt;/body&gt;</span>
<a href="#l4.1616"></a><span id="l4.1616" class="difflineminus">-      &lt;/method&gt;</span>
<a href="#l4.1617"></a><span id="l4.1617" class="difflineplus">+        }</span>
<a href="#l4.1618"></a><span id="l4.1618"> </span>
<a href="#l4.1619"></a><span id="l4.1619" class="difflineminus">-      &lt;method name=&quot;cycleCellCommit&quot;&gt;</span>
<a href="#l4.1620"></a><span id="l4.1620" class="difflineminus">-        &lt;body&gt;&lt;![CDATA[</span>
<a href="#l4.1621"></a><span id="l4.1621" class="difflineminus">-            let composite = this.compositeCalendar;</span>
<a href="#l4.1622"></a><span id="l4.1622" class="difflineminus">-            this.treebox.beginUpdateBatch();</span>
<a href="#l4.1623"></a><span id="l4.1623" class="difflineplus">+        cycleCellCommit() {</span>
<a href="#l4.1624"></a><span id="l4.1624" class="difflineplus">+            const composite = this.compositeCalendar;</span>
<a href="#l4.1625"></a><span id="l4.1625" class="difflineplus">+            this.tree.beginUpdateBatch();</span>
<a href="#l4.1626"></a><span id="l4.1626">             composite.startBatch();</span>
<a href="#l4.1627"></a><span id="l4.1627">             try {</span>
<a href="#l4.1628"></a><span id="l4.1628" class="difflineminus">-                for (let [id, [calendar, row]] of Object.entries(this.mCycleCalendarFlag)) {</span>
<a href="#l4.1629"></a><span id="l4.1629" class="difflineplus">+                Object.entries(this.mCycleCalendarFlag).forEach(([id, [calendar, row]]) =&gt; {</span>
<a href="#l4.1630"></a><span id="l4.1630">                     if (composite.getCalendarById(id)) {</span>
<a href="#l4.1631"></a><span id="l4.1631">                         composite.removeCalendar(calendar);</span>
<a href="#l4.1632"></a><span id="l4.1632">                     } else {</span>
<a href="#l4.1633"></a><span id="l4.1633">                         composite.addCalendar(calendar);</span>
<a href="#l4.1634"></a><span id="l4.1634">                     }</span>
<a href="#l4.1635"></a><span id="l4.1635" class="difflineminus">-                    this.treebox.invalidateRow(row);</span>
<a href="#l4.1636"></a><span id="l4.1636" class="difflineminus">-                }</span>
<a href="#l4.1637"></a><span id="l4.1637" class="difflineplus">+                    this.tree.invalidateRow(row);</span>
<a href="#l4.1638"></a><span id="l4.1638" class="difflineplus">+                });</span>
<a href="#l4.1639"></a><span id="l4.1639">                 this.mCycleCalendarFlag = {};</span>
<a href="#l4.1640"></a><span id="l4.1640">             } finally {</span>
<a href="#l4.1641"></a><span id="l4.1641">                 composite.endBatch();</span>
<a href="#l4.1642"></a><span id="l4.1642" class="difflineminus">-                this.treebox.endUpdateBatch();</span>
<a href="#l4.1643"></a><span id="l4.1643" class="difflineplus">+                this.tree.endUpdateBatch();</span>
<a href="#l4.1644"></a><span id="l4.1644">             }</span>
<a href="#l4.1645"></a><span id="l4.1645" class="difflineminus">-        ]]&gt;&lt;/body&gt;</span>
<a href="#l4.1646"></a><span id="l4.1646" class="difflineminus">-      &lt;/method&gt;</span>
<a href="#l4.1647"></a><span id="l4.1647" class="difflineplus">+        }</span>
<a href="#l4.1648"></a><span id="l4.1648"> </span>
<a href="#l4.1649"></a><span id="l4.1649" class="difflineminus">-      &lt;method name=&quot;isEditable&quot;&gt;</span>
<a href="#l4.1650"></a><span id="l4.1650" class="difflineminus">-        &lt;parameter name=&quot;aRow&quot;/&gt;</span>
<a href="#l4.1651"></a><span id="l4.1651" class="difflineminus">-        &lt;parameter name=&quot;aCol&quot;/&gt;</span>
<a href="#l4.1652"></a><span id="l4.1652" class="difflineminus">-        &lt;body&gt;&lt;![CDATA[</span>
<a href="#l4.1653"></a><span id="l4.1653" class="difflineplus">+        isEditable(row, col) {</span>
<a href="#l4.1654"></a><span id="l4.1654">             return false;</span>
<a href="#l4.1655"></a><span id="l4.1655" class="difflineminus">-        ]]&gt;&lt;/body&gt;</span>
<a href="#l4.1656"></a><span id="l4.1656" class="difflineminus">-      &lt;/method&gt;</span>
<a href="#l4.1657"></a><span id="l4.1657" class="difflineplus">+        }</span>
<a href="#l4.1658"></a><span id="l4.1658"> </span>
<a href="#l4.1659"></a><span id="l4.1659" class="difflineminus">-      &lt;method name=&quot;setCellValue&quot;&gt;</span>
<a href="#l4.1660"></a><span id="l4.1660" class="difflineminus">-        &lt;parameter name=&quot;aRow&quot;/&gt;</span>
<a href="#l4.1661"></a><span id="l4.1661" class="difflineminus">-        &lt;parameter name=&quot;aCol&quot;/&gt;</span>
<a href="#l4.1662"></a><span id="l4.1662" class="difflineminus">-        &lt;parameter name=&quot;aValue&quot;/&gt;</span>
<a href="#l4.1663"></a><span id="l4.1663" class="difflineminus">-        &lt;body&gt;&lt;![CDATA[</span>
<a href="#l4.1664"></a><span id="l4.1664" class="difflineminus">-            let calendar = this.getCalendar(aRow);</span>
<a href="#l4.1665"></a><span id="l4.1665" class="difflineminus">-            let composite = this.compositeCalendar;</span>
<a href="#l4.1666"></a><span id="l4.1666" class="difflineplus">+        setCellValue(row, col, value) {</span>
<a href="#l4.1667"></a><span id="l4.1667" class="difflineplus">+            const calendar = this.getCalendar(row);</span>
<a href="#l4.1668"></a><span id="l4.1668" class="difflineplus">+            const composite = this.compositeCalendar;</span>
<a href="#l4.1669"></a><span id="l4.1669"> </span>
<a href="#l4.1670"></a><span id="l4.1670" class="difflineminus">-            switch (aCol.element.getAttribute(&quot;anonid&quot;)) {</span>
<a href="#l4.1671"></a><span id="l4.1671" class="difflineplus">+            switch (col.element.getAttribute(&quot;type&quot;)) {</span>
<a href="#l4.1672"></a><span id="l4.1672">                 case &quot;checkbox-treecol&quot;:</span>
<a href="#l4.1673"></a><span id="l4.1673" class="difflineminus">-                    if (aValue == &quot;true&quot;) {</span>
<a href="#l4.1674"></a><span id="l4.1674" class="difflineplus">+                    if (value == &quot;true&quot;) {</span>
<a href="#l4.1675"></a><span id="l4.1675">                         composite.addCalendar(calendar);</span>
<a href="#l4.1676"></a><span id="l4.1676">                     } else {</span>
<a href="#l4.1677"></a><span id="l4.1677">                         composite.removeCalendar(calendar);</span>
<a href="#l4.1678"></a><span id="l4.1678">                     }</span>
<a href="#l4.1679"></a><span id="l4.1679">                     break;</span>
<a href="#l4.1680"></a><span id="l4.1680">                 default:</span>
<a href="#l4.1681"></a><span id="l4.1681">                     return null;</span>
<a href="#l4.1682"></a><span id="l4.1682">             }</span>
<a href="#l4.1683"></a><span id="l4.1683" class="difflineminus">-            return aValue;</span>
<a href="#l4.1684"></a><span id="l4.1684" class="difflineminus">-        ]]&gt;&lt;/body&gt;</span>
<a href="#l4.1685"></a><span id="l4.1685" class="difflineminus">-      &lt;/method&gt;</span>
<a href="#l4.1686"></a><span id="l4.1686" class="difflineplus">+            return value;</span>
<a href="#l4.1687"></a><span id="l4.1687" class="difflineplus">+        }</span>
<a href="#l4.1688"></a><span id="l4.1688" class="difflineplus">+</span>
<a href="#l4.1689"></a><span id="l4.1689" class="difflineplus">+        setCellText(row, col, value) {}</span>
<a href="#l4.1690"></a><span id="l4.1690" class="difflineplus">+</span>
<a href="#l4.1691"></a><span id="l4.1691" class="difflineplus">+        performAction(action) {}</span>
<a href="#l4.1692"></a><span id="l4.1692" class="difflineplus">+</span>
<a href="#l4.1693"></a><span id="l4.1693" class="difflineplus">+        performActionOnRow(action, row) {}</span>
<a href="#l4.1694"></a><span id="l4.1694" class="difflineplus">+</span>
<a href="#l4.1695"></a><span id="l4.1695" class="difflineplus">+        performActionOnCell(action, row, col) {}</span>
<a href="#l4.1696"></a><span id="l4.1696"> </span>
<a href="#l4.1697"></a><span id="l4.1697" class="difflineminus">-      &lt;method name=&quot;setCellText&quot;&gt;</span>
<a href="#l4.1698"></a><span id="l4.1698" class="difflineminus">-        &lt;parameter name=&quot;aRow&quot;/&gt;</span>
<a href="#l4.1699"></a><span id="l4.1699" class="difflineminus">-        &lt;parameter name=&quot;aCol&quot;/&gt;</span>
<a href="#l4.1700"></a><span id="l4.1700" class="difflineminus">-        &lt;parameter name=&quot;aValue&quot;/&gt;</span>
<a href="#l4.1701"></a><span id="l4.1701" class="difflineminus">-        &lt;body&gt;&lt;![CDATA[</span>
<a href="#l4.1702"></a><span id="l4.1702" class="difflineminus">-        ]]&gt;&lt;/body&gt;</span>
<a href="#l4.1703"></a><span id="l4.1703" class="difflineminus">-      &lt;/method&gt;</span>
<a href="#l4.1704"></a><span id="l4.1704" class="difflineplus">+        // End nsITreeView Methods</span>
<a href="#l4.1705"></a><span id="l4.1705" class="difflineplus">+</span>
<a href="#l4.1706"></a><span id="l4.1706" class="difflineplus">+        disconnectedCallback() {</span>
<a href="#l4.1707"></a><span id="l4.1707" class="difflineplus">+            // Clean up the calendar manager observers. Do not use removeCalendar</span>
<a href="#l4.1708"></a><span id="l4.1708" class="difflineplus">+            // here since that will remove the calendar from the composite calendar.</span>
<a href="#l4.1709"></a><span id="l4.1709" class="difflineplus">+            for (const calendar of this.mCalendarList) {</span>
<a href="#l4.1710"></a><span id="l4.1710" class="difflineplus">+                calendar.removeObserver(this.calObserver);</span>
<a href="#l4.1711"></a><span id="l4.1711" class="difflineplus">+            }</span>
<a href="#l4.1712"></a><span id="l4.1712" class="difflineplus">+</span>
<a href="#l4.1713"></a><span id="l4.1713" class="difflineplus">+            this.tree.view = null;</span>
<a href="#l4.1714"></a><span id="l4.1714" class="difflineplus">+            this.calObserver.listTree = null;</span>
<a href="#l4.1715"></a><span id="l4.1715"> </span>
<a href="#l4.1716"></a><span id="l4.1716" class="difflineminus">-      &lt;method name=&quot;performAction&quot;&gt;</span>
<a href="#l4.1717"></a><span id="l4.1717" class="difflineminus">-        &lt;parameter name=&quot;aAction&quot;/&gt;</span>
<a href="#l4.1718"></a><span id="l4.1718" class="difflineminus">-        &lt;body&gt;&lt;![CDATA[</span>
<a href="#l4.1719"></a><span id="l4.1719" class="difflineminus">-        ]]&gt;&lt;/body&gt;</span>
<a href="#l4.1720"></a><span id="l4.1720" class="difflineminus">-      &lt;/method&gt;</span>
<a href="#l4.1721"></a><span id="l4.1721" class="difflineplus">+            if (this.mCompositeCalendar) {</span>
<a href="#l4.1722"></a><span id="l4.1722" class="difflineplus">+                this.mCompositeCalendar.removeObserver(this.compositeObserver);</span>
<a href="#l4.1723"></a><span id="l4.1723" class="difflineplus">+            }</span>
<a href="#l4.1724"></a><span id="l4.1724" class="difflineplus">+        }</span>
<a href="#l4.1725"></a><span id="l4.1725" class="difflineplus">+    }</span>
<a href="#l4.1726"></a><span id="l4.1726" class="difflineplus">+</span>
<a href="#l4.1727"></a><span id="l4.1727" class="difflineplus">+    MozXULElement.implementCustomInterface(CalendarListTree, [Ci.nsITreeView]);</span>
<a href="#l4.1728"></a><span id="l4.1728" class="difflineplus">+</span>
<a href="#l4.1729"></a><span id="l4.1729" class="difflineplus">+    customElements.define(&quot;calendar-list-tree&quot;, CalendarListTree, { &quot;extends&quot;: &quot;tree&quot; });</span>
<a href="#l4.1730"></a><span id="l4.1730" class="difflineplus">+</span>
<a href="#l4.1731"></a><span id="l4.1731"> </span>
<a href="#l4.1732"></a><span id="l4.1732" class="difflineminus">-      &lt;method name=&quot;performActionOnRow&quot;&gt;</span>
<a href="#l4.1733"></a><span id="l4.1733" class="difflineminus">-        &lt;parameter name=&quot;aAction&quot;/&gt;</span>
<a href="#l4.1734"></a><span id="l4.1734" class="difflineminus">-        &lt;parameter name=&quot;aRow&quot;/&gt;</span>
<a href="#l4.1735"></a><span id="l4.1735" class="difflineminus">-        &lt;body&gt;&lt;![CDATA[</span>
<a href="#l4.1736"></a><span id="l4.1736" class="difflineminus">-        ]]&gt;&lt;/body&gt;</span>
<a href="#l4.1737"></a><span id="l4.1737" class="difflineminus">-      &lt;/method&gt;</span>
<a href="#l4.1738"></a><span id="l4.1738" class="difflineplus">+    /**</span>
<a href="#l4.1739"></a><span id="l4.1739" class="difflineplus">+     * Implements a fully functional calendar list. For example, one that automatically adds and</span>
<a href="#l4.1740"></a><span id="l4.1740" class="difflineplus">+     * removes calendars when a calendar is registered or unregistered. Typically used for the</span>
<a href="#l4.1741"></a><span id="l4.1741" class="difflineplus">+     * main list of calendars in the sidebar on the left in the calendar and tasks views.</span>
<a href="#l4.1742"></a><span id="l4.1742" class="difflineplus">+     *</span>
<a href="#l4.1743"></a><span id="l4.1743" class="difflineplus">+     * @extends CalendarListTree</span>
<a href="#l4.1744"></a><span id="l4.1744" class="difflineplus">+     * @implements nsITreeView</span>
<a href="#l4.1745"></a><span id="l4.1745" class="difflineplus">+     */</span>
<a href="#l4.1746"></a><span id="l4.1746" class="difflineplus">+    class CalendarListTreeFull extends CalendarListTree {</span>
<a href="#l4.1747"></a><span id="l4.1747" class="difflineplus">+        connectedCallback() {</span>
<a href="#l4.1748"></a><span id="l4.1748" class="difflineplus">+            if (this.delayConnectedCallback() || this.hasConnected) {</span>
<a href="#l4.1749"></a><span id="l4.1749" class="difflineplus">+                return;</span>
<a href="#l4.1750"></a><span id="l4.1750" class="difflineplus">+            }</span>
<a href="#l4.1751"></a><span id="l4.1751" class="difflineplus">+            // this.hasConnected is set to true in super.connectedCallback.</span>
<a href="#l4.1752"></a><span id="l4.1752" class="difflineplus">+            super.connectedCallback();</span>
<a href="#l4.1753"></a><span id="l4.1753" class="difflineplus">+</span>
<a href="#l4.1754"></a><span id="l4.1754" class="difflineplus">+            this.mAddingFromComposite = false;</span>
<a href="#l4.1755"></a><span id="l4.1755"> </span>
<a href="#l4.1756"></a><span id="l4.1756" class="difflineminus">-      &lt;method name=&quot;performActionOnCell&quot;&gt;</span>
<a href="#l4.1757"></a><span id="l4.1757" class="difflineminus">-        &lt;parameter name=&quot;aAction&quot;/&gt;</span>
<a href="#l4.1758"></a><span id="l4.1758" class="difflineminus">-        &lt;parameter name=&quot;aRow&quot;/&gt;</span>
<a href="#l4.1759"></a><span id="l4.1759" class="difflineminus">-        &lt;parameter name=&quot;aCol&quot;/&gt;</span>
<a href="#l4.1760"></a><span id="l4.1760" class="difflineminus">-        &lt;body&gt;&lt;![CDATA[</span>
<a href="#l4.1761"></a><span id="l4.1761" class="difflineminus">-        ]]&gt;&lt;/body&gt;</span>
<a href="#l4.1762"></a><span id="l4.1762" class="difflineminus">-      &lt;/method&gt;</span>
<a href="#l4.1763"></a><span id="l4.1763" class="difflineminus">-    &lt;/implementation&gt;</span>
<a href="#l4.1764"></a><span id="l4.1764" class="difflineminus">-    &lt;handlers&gt;</span>
<a href="#l4.1765"></a><span id="l4.1765" class="difflineminus">-      &lt;handler event=&quot;select&quot;&gt;&lt;![CDATA[</span>
<a href="#l4.1766"></a><span id="l4.1766" class="difflineminus">-          this.compositeCalendar.defaultCalendar = this.getCalendar(this.tree.currentIndex);</span>
<a href="#l4.1767"></a><span id="l4.1767" class="difflineminus">-      ]]&gt;&lt;/handler&gt;</span>
<a href="#l4.1768"></a><span id="l4.1768" class="difflineplus">+            /**</span>
<a href="#l4.1769"></a><span id="l4.1769" class="difflineplus">+             * Calendar manager observer.</span>
<a href="#l4.1770"></a><span id="l4.1770" class="difflineplus">+             *</span>
<a href="#l4.1771"></a><span id="l4.1771" class="difflineplus">+             * @implements calICalendarManagerObserver</span>
<a href="#l4.1772"></a><span id="l4.1772" class="difflineplus">+             */</span>
<a href="#l4.1773"></a><span id="l4.1773" class="difflineplus">+            this.calMgrObserver = {</span>
<a href="#l4.1774"></a><span id="l4.1774" class="difflineplus">+                listTree: this,</span>
<a href="#l4.1775"></a><span id="l4.1775" class="difflineplus">+                QueryInterface: ChromeUtils.generateQI([Ci.calICalendarManagerObserver]),</span>
<a href="#l4.1776"></a><span id="l4.1776" class="difflineplus">+</span>
<a href="#l4.1777"></a><span id="l4.1777" class="difflineplus">+                // calICalendarManagerObserver Methods</span>
<a href="#l4.1778"></a><span id="l4.1778" class="difflineplus">+</span>
<a href="#l4.1779"></a><span id="l4.1779" class="difflineplus">+                onCalendarRegistered(calendar) {</span>
<a href="#l4.1780"></a><span id="l4.1780" class="difflineplus">+                    this.listTree.addCalendar(calendar);</span>
<a href="#l4.1781"></a><span id="l4.1781" class="difflineplus">+                    const composite = this.listTree.compositeCalendar;</span>
<a href="#l4.1782"></a><span id="l4.1782" class="difflineplus">+                    const inComposite = calendar.getProperty(composite.prefPrefix +</span>
<a href="#l4.1783"></a><span id="l4.1783" class="difflineplus">+                        &quot;-in-composite&quot;);</span>
<a href="#l4.1784"></a><span id="l4.1784" class="difflineplus">+</span>
<a href="#l4.1785"></a><span id="l4.1785" class="difflineplus">+                    if ((inComposite === null) || inComposite) {</span>
<a href="#l4.1786"></a><span id="l4.1786" class="difflineplus">+                        composite.addCalendar(calendar);</span>
<a href="#l4.1787"></a><span id="l4.1787" class="difflineplus">+                    }</span>
<a href="#l4.1788"></a><span id="l4.1788" class="difflineplus">+                },</span>
<a href="#l4.1789"></a><span id="l4.1789" class="difflineplus">+</span>
<a href="#l4.1790"></a><span id="l4.1790" class="difflineplus">+                onCalendarUnregistering(calendar) {</span>
<a href="#l4.1791"></a><span id="l4.1791" class="difflineplus">+                    this.listTree.removeCalendar(calendar);</span>
<a href="#l4.1792"></a><span id="l4.1792" class="difflineplus">+                },</span>
<a href="#l4.1793"></a><span id="l4.1793"> </span>
<a href="#l4.1794"></a><span id="l4.1794" class="difflineminus">-      &lt;handler event=&quot;keypress&quot; keycode=&quot;VK_DELETE&quot;&gt;&lt;![CDATA[</span>
<a href="#l4.1795"></a><span id="l4.1795" class="difflineminus">-          if (this.writable) {</span>
<a href="#l4.1796"></a><span id="l4.1796" class="difflineminus">-              promptDeleteCalendar(this.compositeCalendar.defaultCalendar);</span>
<a href="#l4.1797"></a><span id="l4.1797" class="difflineminus">-              event.preventDefault();</span>
<a href="#l4.1798"></a><span id="l4.1798" class="difflineminus">-          }</span>
<a href="#l4.1799"></a><span id="l4.1799" class="difflineminus">-      ]]&gt;&lt;/handler&gt;</span>
<a href="#l4.1800"></a><span id="l4.1800" class="difflineplus">+                onCalendarDeleting(calendar) {</span>
<a href="#l4.1801"></a><span id="l4.1801" class="difflineplus">+                    // Now that the calendar is unregistered, update the commands to make sure that</span>
<a href="#l4.1802"></a><span id="l4.1802" class="difflineplus">+                    // New Event/Task commands are correctly enabled/disabled.</span>
<a href="#l4.1803"></a><span id="l4.1803" class="difflineplus">+                    document.commandDispatcher.updateCommands(&quot;calendar_commands&quot;);</span>
<a href="#l4.1804"></a><span id="l4.1804" class="difflineplus">+                }</span>
<a href="#l4.1805"></a><span id="l4.1805" class="difflineplus">+            };</span>
<a href="#l4.1806"></a><span id="l4.1806"> </span>
<a href="#l4.1807"></a><span id="l4.1807" class="difflineminus">-      &lt;!-- use key=&quot; &quot; since keycode=&quot;VK_SPACE&quot; doesn't work --&gt;</span>
<a href="#l4.1808"></a><span id="l4.1808" class="difflineminus">-      &lt;handler event=&quot;keypress&quot; key=&quot; &quot;&gt;&lt;![CDATA[</span>
<a href="#l4.1809"></a><span id="l4.1809" class="difflineminus">-          if (this.tree.currentIndex &gt; -1) {</span>
<a href="#l4.1810"></a><span id="l4.1810" class="difflineminus">-              this.cycleCell(this.tree.currentIndex, this.getColumn(&quot;checkbox-treecol&quot;));</span>
<a href="#l4.1811"></a><span id="l4.1811" class="difflineminus">-              this.treebox.invalidateRow(this.tree.currentIndex);</span>
<a href="#l4.1812"></a><span id="l4.1812" class="difflineminus">-              event.preventDefault();</span>
<a href="#l4.1813"></a><span id="l4.1813" class="difflineminus">-          }</span>
<a href="#l4.1814"></a><span id="l4.1814" class="difflineminus">-      ]]&gt;&lt;/handler&gt;</span>
<a href="#l4.1815"></a><span id="l4.1815" class="difflineplus">+            /**</span>
<a href="#l4.1816"></a><span id="l4.1816" class="difflineplus">+             * Composite calendar observer.</span>
<a href="#l4.1817"></a><span id="l4.1817" class="difflineplus">+             *</span>
<a href="#l4.1818"></a><span id="l4.1818" class="difflineplus">+             * @implements nsICompositeObserver</span>
<a href="#l4.1819"></a><span id="l4.1819" class="difflineplus">+             * @implements calIObserver</span>
<a href="#l4.1820"></a><span id="l4.1820" class="difflineplus">+             */</span>
<a href="#l4.1821"></a><span id="l4.1821" class="difflineplus">+            this.compositeObserver = {</span>
<a href="#l4.1822"></a><span id="l4.1822" class="difflineplus">+                listTree: this,</span>
<a href="#l4.1823"></a><span id="l4.1823" class="difflineplus">+                QueryInterface: cal.generateQI([Ci.calICompositeObserver, Ci.calIObserver]),</span>
<a href="#l4.1824"></a><span id="l4.1824" class="difflineplus">+</span>
<a href="#l4.1825"></a><span id="l4.1825" class="difflineplus">+                // calICompositeObserver Methods</span>
<a href="#l4.1826"></a><span id="l4.1826" class="difflineplus">+</span>
<a href="#l4.1827"></a><span id="l4.1827" class="difflineplus">+                onCalendarAdded(calendar) {</span>
<a href="#l4.1828"></a><span id="l4.1828" class="difflineplus">+                    // Make sure the checkbox state is updated.</span>
<a href="#l4.1829"></a><span id="l4.1829" class="difflineplus">+                    this.listTree.updateCalendar(calendar);</span>
<a href="#l4.1830"></a><span id="l4.1830" class="difflineplus">+                },</span>
<a href="#l4.1831"></a><span id="l4.1831" class="difflineplus">+</span>
<a href="#l4.1832"></a><span id="l4.1832" class="difflineplus">+                onCalendarRemoved(calendar) {</span>
<a href="#l4.1833"></a><span id="l4.1833" class="difflineplus">+                    // Make sure the checkbox state is updated.</span>
<a href="#l4.1834"></a><span id="l4.1834" class="difflineplus">+                    this.listTree.updateCalendar(calendar);</span>
<a href="#l4.1835"></a><span id="l4.1835" class="difflineplus">+                },</span>
<a href="#l4.1836"></a><span id="l4.1836"> </span>
<a href="#l4.1837"></a><span id="l4.1837" class="difflineminus">-      &lt;handler event=&quot;keypress&quot; keycode=&quot;VK_DOWN&quot; modifiers=&quot;control&quot;&gt;&lt;![CDATA[</span>
<a href="#l4.1838"></a><span id="l4.1838" class="difflineminus">-          if (!this.allowDrag) {</span>
<a href="#l4.1839"></a><span id="l4.1839" class="difflineminus">-              return;</span>
<a href="#l4.1840"></a><span id="l4.1840" class="difflineminus">-          }</span>
<a href="#l4.1841"></a><span id="l4.1841" class="difflineplus">+                onDefaultCalendarChanged(calendar) {},</span>
<a href="#l4.1842"></a><span id="l4.1842" class="difflineplus">+</span>
<a href="#l4.1843"></a><span id="l4.1843" class="difflineplus">+                // calIObserver Methods</span>
<a href="#l4.1844"></a><span id="l4.1844" class="difflineplus">+</span>
<a href="#l4.1845"></a><span id="l4.1845" class="difflineplus">+                onStartBatch() {},</span>
<a href="#l4.1846"></a><span id="l4.1846" class="difflineplus">+                onEndBatch() {},</span>
<a href="#l4.1847"></a><span id="l4.1847" class="difflineplus">+                onLoad() {},</span>
<a href="#l4.1848"></a><span id="l4.1848"> </span>
<a href="#l4.1849"></a><span id="l4.1849" class="difflineminus">-          let idx = this.tree.currentIndex;</span>
<a href="#l4.1850"></a><span id="l4.1850" class="difflineminus">-</span>
<a href="#l4.1851"></a><span id="l4.1851" class="difflineminus">-          if (idx &lt; this.mCalendarList.length - 1) {</span>
<a href="#l4.1852"></a><span id="l4.1852" class="difflineminus">-              this.mCalendarList.splice(idx + 1, 0, this.mCalendarList.splice(idx, 1)[0]);</span>
<a href="#l4.1853"></a><span id="l4.1853" class="difflineminus">-              this.treebox.invalidateRange(idx, idx + 1);</span>
<a href="#l4.1854"></a><span id="l4.1854" class="difflineplus">+                onAddItem(item) {</span>
<a href="#l4.1855"></a><span id="l4.1855" class="difflineplus">+                    if (item.calendar.type != &quot;caldav&quot;) {</span>
<a href="#l4.1856"></a><span id="l4.1856" class="difflineplus">+                        this.listTree.ensureCalendarVisible(item.calendar);</span>
<a href="#l4.1857"></a><span id="l4.1857" class="difflineplus">+                    }</span>
<a href="#l4.1858"></a><span id="l4.1858" class="difflineplus">+                },</span>
<a href="#l4.1859"></a><span id="l4.1859" class="difflineplus">+                onModifyItem(newItem, oldItem) {</span>
<a href="#l4.1860"></a><span id="l4.1860" class="difflineplus">+                    if (newItem.calendar.type != &quot;caldav&quot;) {</span>
<a href="#l4.1861"></a><span id="l4.1861" class="difflineplus">+                        this.listTree.ensureCalendarVisible(newItem.calendar);</span>
<a href="#l4.1862"></a><span id="l4.1862" class="difflineplus">+                    }</span>
<a href="#l4.1863"></a><span id="l4.1863" class="difflineplus">+                },</span>
<a href="#l4.1864"></a><span id="l4.1864" class="difflineplus">+                onDeleteItem(deletedItem) {},</span>
<a href="#l4.1865"></a><span id="l4.1865" class="difflineplus">+                onError(calendar, errNo, message) {},</span>
<a href="#l4.1866"></a><span id="l4.1866"> </span>
<a href="#l4.1867"></a><span id="l4.1867" class="difflineminus">-              if (this.tree.view.selection.isSelected(idx)) {</span>
<a href="#l4.1868"></a><span id="l4.1868" class="difflineminus">-                  this.tree.view.selection.toggleSelect(idx);</span>
<a href="#l4.1869"></a><span id="l4.1869" class="difflineminus">-                  this.tree.view.selection.toggleSelect(idx + 1);</span>
<a href="#l4.1870"></a><span id="l4.1870" class="difflineminus">-              }</span>
<a href="#l4.1871"></a><span id="l4.1871" class="difflineminus">-              if (this.tree.view.selection.currentIndex == idx) {</span>
<a href="#l4.1872"></a><span id="l4.1872" class="difflineminus">-                  this.tree.view.selection.currentIndex = idx + 1;</span>
<a href="#l4.1873"></a><span id="l4.1873" class="difflineminus">-              }</span>
<a href="#l4.1874"></a><span id="l4.1874" class="difflineplus">+                onPropertyChanged(calendar, name, value, oldValue) {</span>
<a href="#l4.1875"></a><span id="l4.1875" class="difflineplus">+                    switch (name) {</span>
<a href="#l4.1876"></a><span id="l4.1876" class="difflineplus">+                        case &quot;disabled&quot;:</span>
<a href="#l4.1877"></a><span id="l4.1877" class="difflineplus">+                        case &quot;readOnly&quot;:</span>
<a href="#l4.1878"></a><span id="l4.1878" class="difflineplus">+                            calendarUpdateNewItemsCommand();</span>
<a href="#l4.1879"></a><span id="l4.1879" class="difflineplus">+                            document.commandDispatcher.updateCommands(&quot;calendar_commands&quot;);</span>
<a href="#l4.1880"></a><span id="l4.1880" class="difflineplus">+                            break;</span>
<a href="#l4.1881"></a><span id="l4.1881" class="difflineplus">+                    }</span>
<a href="#l4.1882"></a><span id="l4.1882" class="difflineplus">+                },</span>
<a href="#l4.1883"></a><span id="l4.1883" class="difflineplus">+</span>
<a href="#l4.1884"></a><span id="l4.1884" class="difflineplus">+                onPropertyDeleting(calendar, name) {}</span>
<a href="#l4.1885"></a><span id="l4.1885" class="difflineplus">+            };</span>
<a href="#l4.1886"></a><span id="l4.1886" class="difflineplus">+</span>
<a href="#l4.1887"></a><span id="l4.1887" class="difflineplus">+            const calMgr = cal.getCalendarManager();</span>
<a href="#l4.1888"></a><span id="l4.1888" class="difflineplus">+            calMgr.addObserver(this.calMgrObserver);</span>
<a href="#l4.1889"></a><span id="l4.1889"> </span>
<a href="#l4.1890"></a><span id="l4.1890" class="difflineminus">-              // Fire event</span>
<a href="#l4.1891"></a><span id="l4.1891" class="difflineminus">-              this.sortOrderChanged();</span>
<a href="#l4.1892"></a><span id="l4.1892" class="difflineminus">-          }</span>
<a href="#l4.1893"></a><span id="l4.1893" class="difflineminus">-          // Don't call the default &lt;key&gt; handler.</span>
<a href="#l4.1894"></a><span id="l4.1894" class="difflineminus">-          event.preventDefault();</span>
<a href="#l4.1895"></a><span id="l4.1895" class="difflineminus">-      ]]&gt;&lt;/handler&gt;</span>
<a href="#l4.1896"></a><span id="l4.1896" class="difflineplus">+            /**</span>
<a href="#l4.1897"></a><span id="l4.1897" class="difflineplus">+             * A double click on a calendar row opens a dialog to edit the calendar. (Unless it is</span>
<a href="#l4.1898"></a><span id="l4.1898" class="difflineplus">+             * on the checkbox column.) A double click elsewhere opens a dialog to create a new</span>
<a href="#l4.1899"></a><span id="l4.1899" class="difflineplus">+             * calendar.</span>
<a href="#l4.1900"></a><span id="l4.1900" class="difflineplus">+             */</span>
<a href="#l4.1901"></a><span id="l4.1901" class="difflineplus">+            this.addEventListener(&quot;dblclick&quot;, (event) =&gt; {</span>
<a href="#l4.1902"></a><span id="l4.1902" class="difflineplus">+                const col = {};</span>
<a href="#l4.1903"></a><span id="l4.1903" class="difflineplus">+                const calendar = this.getCalendarFromEvent(event, col);</span>
<a href="#l4.1904"></a><span id="l4.1904" class="difflineplus">+</span>
<a href="#l4.1905"></a><span id="l4.1905" class="difflineplus">+                // Return early if it is not a left click or a click on the checkbox column.</span>
<a href="#l4.1906"></a><span id="l4.1906" class="difflineplus">+                if (event.button != 0 ||</span>
<a href="#l4.1907"></a><span id="l4.1907" class="difflineplus">+                    (col.value &amp;&amp; col.value.element &amp;&amp;</span>
<a href="#l4.1908"></a><span id="l4.1908" class="difflineplus">+                    col.value.element.getAttribute(&quot;type&quot;) == &quot;checkbox-treecol&quot;)) {</span>
<a href="#l4.1909"></a><span id="l4.1909" class="difflineplus">+                    return;</span>
<a href="#l4.1910"></a><span id="l4.1910" class="difflineplus">+                }</span>
<a href="#l4.1911"></a><span id="l4.1911"> </span>
<a href="#l4.1912"></a><span id="l4.1912" class="difflineminus">-      &lt;handler event=&quot;keypress&quot; keycode=&quot;VK_UP&quot; modifiers=&quot;control&quot;&gt;&lt;![CDATA[</span>
<a href="#l4.1913"></a><span id="l4.1913" class="difflineminus">-          if (!this.allowDrag) {</span>
<a href="#l4.1914"></a><span id="l4.1914" class="difflineminus">-              return;</span>
<a href="#l4.1915"></a><span id="l4.1915" class="difflineminus">-          }</span>
<a href="#l4.1916"></a><span id="l4.1916" class="difflineplus">+                if (calendar) {</span>
<a href="#l4.1917"></a><span id="l4.1917" class="difflineplus">+                    cal.window.openCalendarProperties(window, calendar);</span>
<a href="#l4.1918"></a><span id="l4.1918" class="difflineplus">+                } else {</span>
<a href="#l4.1919"></a><span id="l4.1919" class="difflineplus">+                    cal.window.openCalendarWizard(window);</span>
<a href="#l4.1920"></a><span id="l4.1920" class="difflineplus">+                }</span>
<a href="#l4.1921"></a><span id="l4.1921" class="difflineplus">+            });</span>
<a href="#l4.1922"></a><span id="l4.1922" class="difflineplus">+</span>
<a href="#l4.1923"></a><span id="l4.1923" class="difflineplus">+            this.dispatchEvent(new CustomEvent(&quot;bindingattached&quot;, { bubbles: false }));</span>
<a href="#l4.1924"></a><span id="l4.1924" class="difflineplus">+        }</span>
<a href="#l4.1925"></a><span id="l4.1925"> </span>
<a href="#l4.1926"></a><span id="l4.1926" class="difflineminus">-          let idx = this.tree.currentIndex;</span>
<a href="#l4.1927"></a><span id="l4.1927" class="difflineminus">-          if (idx &gt; 0) {</span>
<a href="#l4.1928"></a><span id="l4.1928" class="difflineminus">-              this.mCalendarList.splice(idx - 1, 0, this.mCalendarList.splice(idx, 1)[0]);</span>
<a href="#l4.1929"></a><span id="l4.1929" class="difflineminus">-              this.treebox.invalidateRange(idx - 1, idx);</span>
<a href="#l4.1930"></a><span id="l4.1930" class="difflineplus">+        set compositeCalendar(val) {</span>
<a href="#l4.1931"></a><span id="l4.1931" class="difflineplus">+            this.mCompositeCalendar = val;</span>
<a href="#l4.1932"></a><span id="l4.1932" class="difflineplus">+            this.mCompositeCalendar.addObserver(this.compositeObserver);</span>
<a href="#l4.1933"></a><span id="l4.1933" class="difflineplus">+</span>
<a href="#l4.1934"></a><span id="l4.1934" class="difflineplus">+            // Now that we have a composite calendar, we can get all calendars</span>
<a href="#l4.1935"></a><span id="l4.1935" class="difflineplus">+            // from the calendar manager.</span>
<a href="#l4.1936"></a><span id="l4.1936" class="difflineplus">+</span>
<a href="#l4.1937"></a><span id="l4.1937" class="difflineplus">+            if (this.tree &amp;&amp; !this.calendarsAreLoaded) {</span>
<a href="#l4.1938"></a><span id="l4.1938" class="difflineplus">+                this.loadCalendars();</span>
<a href="#l4.1939"></a><span id="l4.1939" class="difflineplus">+            }</span>
<a href="#l4.1940"></a><span id="l4.1940" class="difflineplus">+            return val;</span>
<a href="#l4.1941"></a><span id="l4.1941" class="difflineplus">+        }</span>
<a href="#l4.1942"></a><span id="l4.1942"> </span>
<a href="#l4.1943"></a><span id="l4.1943" class="difflineminus">-              if (this.tree.view.selection.isSelected(idx)) {</span>
<a href="#l4.1944"></a><span id="l4.1944" class="difflineminus">-                  this.tree.view.selection.toggleSelect(idx);</span>
<a href="#l4.1945"></a><span id="l4.1945" class="difflineminus">-                  this.tree.view.selection.toggleSelect(idx - 1);</span>
<a href="#l4.1946"></a><span id="l4.1946" class="difflineminus">-              }</span>
<a href="#l4.1947"></a><span id="l4.1947" class="difflineminus">-              if (this.tree.view.selection.currentIndex == idx) {</span>
<a href="#l4.1948"></a><span id="l4.1948" class="difflineminus">-                  this.tree.view.selection.currentIndex = idx - 1;</span>
<a href="#l4.1949"></a><span id="l4.1949" class="difflineminus">-              }</span>
<a href="#l4.1950"></a><span id="l4.1950" class="difflineplus">+        get compositeCalendar() {</span>
<a href="#l4.1951"></a><span id="l4.1951" class="difflineplus">+            if (!this.mCompositeCalendar) {</span>
<a href="#l4.1952"></a><span id="l4.1952" class="difflineplus">+                throw Components.Exception(&quot;Calendar list has no composite calendar yet&quot;,</span>
<a href="#l4.1953"></a><span id="l4.1953" class="difflineplus">+                    Cr.NS_ERROR_NOT_INITIALIZED);</span>
<a href="#l4.1954"></a><span id="l4.1954" class="difflineplus">+            }</span>
<a href="#l4.1955"></a><span id="l4.1955" class="difflineplus">+            return this.mCompositeCalendar;</span>
<a href="#l4.1956"></a><span id="l4.1956" class="difflineplus">+        }</span>
<a href="#l4.1957"></a><span id="l4.1957" class="difflineplus">+</span>
<a href="#l4.1958"></a><span id="l4.1958" class="difflineplus">+        set calendars(val) {</span>
<a href="#l4.1959"></a><span id="l4.1959" class="difflineplus">+            // Setting calendars externally is not wanted. This is done internally</span>
<a href="#l4.1960"></a><span id="l4.1960" class="difflineplus">+            // in the compositeCalendar setter.</span>
<a href="#l4.1961"></a><span id="l4.1961" class="difflineplus">+            throw Components.Exception(</span>
<a href="#l4.1962"></a><span id="l4.1962" class="difflineplus">+                &quot;Setting calendars on calendar-list-tree-full is not supported&quot;,</span>
<a href="#l4.1963"></a><span id="l4.1963" class="difflineplus">+                Cr.NS_ERROR_NOT_IMPLEMENTED);</span>
<a href="#l4.1964"></a><span id="l4.1964" class="difflineplus">+        }</span>
<a href="#l4.1965"></a><span id="l4.1965"> </span>
<a href="#l4.1966"></a><span id="l4.1966" class="difflineminus">-              // Fire event</span>
<a href="#l4.1967"></a><span id="l4.1967" class="difflineminus">-              this.sortOrderChanged();</span>
<a href="#l4.1968"></a><span id="l4.1968" class="difflineminus">-          }</span>
<a href="#l4.1969"></a><span id="l4.1969" class="difflineminus">-          // Don't call the default &lt;key&gt; handler.</span>
<a href="#l4.1970"></a><span id="l4.1970" class="difflineminus">-          event.preventDefault();</span>
<a href="#l4.1971"></a><span id="l4.1971" class="difflineminus">-      ]]&gt;&lt;/handler&gt;</span>
<a href="#l4.1972"></a><span id="l4.1972" class="difflineminus">-    &lt;/handlers&gt;</span>
<a href="#l4.1973"></a><span id="l4.1973" class="difflineminus">-  &lt;/binding&gt;</span>
<a href="#l4.1974"></a><span id="l4.1974" class="difflineminus">-&lt;/bindings&gt;</span>
<a href="#l4.1975"></a><span id="l4.1975" class="difflineplus">+        get calendars() {</span>
<a href="#l4.1976"></a><span id="l4.1976" class="difflineplus">+            return this.mCalendarList;</span>
<a href="#l4.1977"></a><span id="l4.1977" class="difflineplus">+        }</span>
<a href="#l4.1978"></a><span id="l4.1978" class="difflineplus">+</span>
<a href="#l4.1979"></a><span id="l4.1979" class="difflineplus">+        disconnectedCallback() {</span>
<a href="#l4.1980"></a><span id="l4.1980" class="difflineplus">+            super.disconnectedCallback();</span>
<a href="#l4.1981"></a><span id="l4.1981" class="difflineplus">+</span>
<a href="#l4.1982"></a><span id="l4.1982" class="difflineplus">+            const calMgr = cal.getCalendarManager();</span>
<a href="#l4.1983"></a><span id="l4.1983" class="difflineplus">+            calMgr.removeObserver(this.calMgrObserver);</span>
<a href="#l4.1984"></a><span id="l4.1984" class="difflineplus">+            this.calMgrObserver.listTree = null;</span>
<a href="#l4.1985"></a><span id="l4.1985" class="difflineplus">+        }</span>
<a href="#l4.1986"></a><span id="l4.1986" class="difflineplus">+    }</span>
<a href="#l4.1987"></a><span id="l4.1987" class="difflineplus">+</span>
<a href="#l4.1988"></a><span id="l4.1988" class="difflineplus">+    customElements.define(&quot;calendar-list-tree-full&quot;, CalendarListTreeFull, { &quot;extends&quot;: &quot;tree&quot; });</span>
<a href="#l4.1989"></a><span id="l4.1989" class="difflineplus">+}</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l5.1"></a><span id="l5.1" class="difflineminus">--- a/calendar/base/content/widgets/calendar-widget-bindings.css</span>
<a href="#l5.2"></a><span id="l5.2" class="difflineplus">+++ b/calendar/base/content/widgets/calendar-widget-bindings.css</span>
<a href="#l5.3"></a><span id="l5.3" class="difflineat">@@ -27,16 +27,8 @@ minimonth {</span>
<a href="#l5.4"></a><span id="l5.4"> </span>
<a href="#l5.5"></a><span id="l5.5"> minimonth-header {</span>
<a href="#l5.6"></a><span id="l5.6">   -moz-binding: url(&quot;chrome://calendar/content/widgets/minimonth.xml#minimonth-header&quot;);</span>
<a href="#l5.7"></a><span id="l5.7"> }</span>
<a href="#l5.8"></a><span id="l5.8"> </span>
<a href="#l5.9"></a><span id="l5.9"> dragndropContainer {</span>
<a href="#l5.10"></a><span id="l5.10">    -moz-binding: url(chrome://calendar/content/widgets/calendar-widgets.xml#dragndropContainer);</span>
<a href="#l5.11"></a><span id="l5.11"> }</span>
<a href="#l5.12"></a><span id="l5.12" class="difflineminus">-</span>
<a href="#l5.13"></a><span id="l5.13" class="difflineminus">-calendar-list-tree {</span>
<a href="#l5.14"></a><span id="l5.14" class="difflineminus">-   -moz-binding: url(chrome://calendar/content/widgets/calendar-list-tree.xml#calendar-list-tree);</span>
<a href="#l5.15"></a><span id="l5.15" class="difflineminus">-}</span>
<a href="#l5.16"></a><span id="l5.16" class="difflineminus">-</span>
<a href="#l5.17"></a><span id="l5.17" class="difflineminus">-calendar-list-tree[type=&quot;full&quot;] {</span>
<a href="#l5.18"></a><span id="l5.18" class="difflineminus">-   -moz-binding: url(chrome://calendar/content/widgets/calendar-list-tree.xml#full-calendar-list-tree);</span>
<a href="#l5.19"></a><span id="l5.19" class="difflineminus">-}</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l6.1"></a><span id="l6.1" class="difflineminus">--- a/calendar/base/jar.mn</span>
<a href="#l6.2"></a><span id="l6.2" class="difflineplus">+++ b/calendar/base/jar.mn</span>
<a href="#l6.3"></a><span id="l6.3" class="difflineat">@@ -87,17 +87,17 @@ calendar.jar:</span>
<a href="#l6.4"></a><span id="l6.4">     content/calendar/preferences/categories.js             (content/preferences/categories.js)</span>
<a href="#l6.5"></a><span id="l6.5">     content/calendar/preferences/editCategory.xul          (content/preferences/editCategory.xul)</span>
<a href="#l6.6"></a><span id="l6.6">     content/calendar/preferences/editCategory.js           (content/preferences/editCategory.js)</span>
<a href="#l6.7"></a><span id="l6.7">     content/calendar/preferences/general.js                (content/preferences/general.js)</span>
<a href="#l6.8"></a><span id="l6.8">     content/calendar/preferences/views.js                  (content/preferences/views.js)</span>
<a href="#l6.9"></a><span id="l6.9">     content/calendar/widgets/minimonth.xml                 (content/widgets/minimonth.xml)</span>
<a href="#l6.10"></a><span id="l6.10">     content/calendar/widgets/calendar-alarm-widget.js      (content/widgets/calendar-alarm-widget.js)</span>
<a href="#l6.11"></a><span id="l6.11">     content/calendar/widgets/calendar-widgets.xml          (content/widgets/calendar-widgets.xml)</span>
<a href="#l6.12"></a><span id="l6.12" class="difflineminus">-    content/calendar/widgets/calendar-list-tree.xml        (content/widgets/calendar-list-tree.xml)</span>
<a href="#l6.13"></a><span id="l6.13" class="difflineplus">+    content/calendar/widgets/calendar-list-tree.js         (content/widgets/calendar-list-tree.js)</span>
<a href="#l6.14"></a><span id="l6.14">     content/calendar/calendar-subscriptions-list.xml       (content/widgets/calendar-subscriptions-list.xml)</span>
<a href="#l6.15"></a><span id="l6.15">     content/calendar/widgets/calendar-widget-bindings.css  (content/widgets/calendar-widget-bindings.css)</span>
<a href="#l6.16"></a><span id="l6.16">     content/calendar/calApplicationUtils.js                (src/calApplicationUtils.js)</span>
<a href="#l6.17"></a><span id="l6.17">     content/calendar/calFilter.js                          (src/calFilter.js)</span>
<a href="#l6.18"></a><span id="l6.18">     content/calendar/WindowsNTToZoneInfoTZId.properties    (src/WindowsNTToZoneInfoTZId.properties)</span>
<a href="#l6.19"></a><span id="l6.19"> % skin calendar classic/1.0 chrome/skin/linux/calendar/</span>
<a href="#l6.20"></a><span id="l6.20"> % skin calendar classic/1.0 chrome/skin/osx/calendar/ os=Darwin</span>
<a href="#l6.21"></a><span id="l6.21"> % skin calendar classic/1.0 chrome/skin/windows/calendar/ os=WINNT</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l7.1"></a><span id="l7.1" class="difflineminus">--- a/calendar/base/themes/common/calendar-management.css</span>
<a href="#l7.2"></a><span id="l7.2" class="difflineplus">+++ b/calendar/base/themes/common/calendar-management.css</span>
<a href="#l7.3"></a><span id="l7.3" class="difflineat">@@ -1,48 +1,48 @@</span>
<a href="#l7.4"></a><span id="l7.4"> /* This Source Code Form is subject to the terms of the Mozilla Public</span>
<a href="#l7.5"></a><span id="l7.5">  * License, v. 2.0. If a copy of the MPL was not distributed with this file,</span>
<a href="#l7.6"></a><span id="l7.6">  * You can obtain one at http://mozilla.org/MPL/2.0/. */</span>
<a href="#l7.7"></a><span id="l7.7"> </span>
<a href="#l7.8"></a><span id="l7.8" class="difflineminus">-calendar-list-tree &gt; tree &gt; treechildren::-moz-tree-cell(color-treecol, color-default) {</span>
<a href="#l7.9"></a><span id="l7.9" class="difflineplus">+.calendar-list-tree &gt; treechildren::-moz-tree-cell(color-treecol, color-default) {</span>
<a href="#l7.10"></a><span id="l7.10">     background-color: #a8c2e1;</span>
<a href="#l7.11"></a><span id="l7.11"> }</span>
<a href="#l7.12"></a><span id="l7.12"> </span>
<a href="#l7.13"></a><span id="l7.13" class="difflineminus">-calendar-list-tree &gt; tree &gt; treechildren::-moz-tree-cell(color-treecol) {</span>
<a href="#l7.14"></a><span id="l7.14" class="difflineplus">+.calendar-list-tree &gt; treechildren::-moz-tree-cell(color-treecol) {</span>
<a href="#l7.15"></a><span id="l7.15">     margin: 1px;</span>
<a href="#l7.16"></a><span id="l7.16"> }</span>
<a href="#l7.17"></a><span id="l7.17"> </span>
<a href="#l7.18"></a><span id="l7.18" class="difflineminus">-calendar-list-tree &gt; tree &gt; treechildren::-moz-tree-cell(calendarname-treecol) {</span>
<a href="#l7.19"></a><span id="l7.19" class="difflineplus">+.calendar-list-tree &gt; treechildren::-moz-tree-cell(calendarname-treecol) {</span>
<a href="#l7.20"></a><span id="l7.20">     margin-inline-start: 1px;</span>
<a href="#l7.21"></a><span id="l7.21"> }</span>
<a href="#l7.22"></a><span id="l7.22"> </span>
<a href="#l7.23"></a><span id="l7.23" class="difflineminus">-calendar-list-tree &gt; tree &gt; treechildren::-moz-tree-image(status-treecol, readonly) {</span>
<a href="#l7.24"></a><span id="l7.24" class="difflineplus">+.calendar-list-tree &gt; treechildren::-moz-tree-image(status-treecol, readonly) {</span>
<a href="#l7.25"></a><span id="l7.25">     list-style-image: url(chrome://calendar-common/skin/icons/locked.svg);</span>
<a href="#l7.26"></a><span id="l7.26"> }</span>
<a href="#l7.27"></a><span id="l7.27"> </span>
<a href="#l7.28"></a><span id="l7.28" class="difflineminus">-calendar-list-tree &gt; tree &gt; treechildren::-moz-tree-image(status-treecol, readfailed) {</span>
<a href="#l7.29"></a><span id="l7.29" class="difflineplus">+.calendar-list-tree &gt; treechildren::-moz-tree-image(status-treecol, readfailed) {</span>
<a href="#l7.30"></a><span id="l7.30">     list-style-image: url(chrome://calendar-common/skin/icons/warn.svg);</span>
<a href="#l7.31"></a><span id="l7.31"> }</span>
<a href="#l7.32"></a><span id="l7.32"> </span>
<a href="#l7.33"></a><span id="l7.33" class="difflineminus">-calendar-list-tree &gt; tree &gt; treechildren::-moz-tree-cell-text(disabled) {</span>
<a href="#l7.34"></a><span id="l7.34" class="difflineplus">+.calendar-list-tree &gt; treechildren::-moz-tree-cell-text(disabled) {</span>
<a href="#l7.35"></a><span id="l7.35">     color: GrayText;</span>
<a href="#l7.36"></a><span id="l7.36"> }</span>
<a href="#l7.37"></a><span id="l7.37"> </span>
<a href="#l7.38"></a><span id="l7.38" class="difflineminus">-calendar-list-tree &gt; tree {</span>
<a href="#l7.39"></a><span id="l7.39" class="difflineplus">+.calendar-list-tree {</span>
<a href="#l7.40"></a><span id="l7.40">     padding: 0;</span>
<a href="#l7.41"></a><span id="l7.41">     margin: 4px 0;</span>
<a href="#l7.42"></a><span id="l7.42">     -moz-appearance: none;</span>
<a href="#l7.43"></a><span id="l7.43"> }</span>
<a href="#l7.44"></a><span id="l7.44"> </span>
<a href="#l7.45"></a><span id="l7.45" class="difflineminus">-calendar-list-tree &gt; tree &gt; treecols &gt; treecol[hideheader=&quot;true&quot;],</span>
<a href="#l7.46"></a><span id="l7.46" class="difflineminus">-calendar-list-tree &gt; tree &gt; treecols &gt; treecol[hideheader=&quot;true&quot;] {</span>
<a href="#l7.47"></a><span id="l7.47" class="difflineplus">+.calendar-list-tree &gt; treecols &gt; treecol[hideheader=&quot;true&quot;],</span>
<a href="#l7.48"></a><span id="l7.48" class="difflineplus">+.calendar-list-tree &gt; treecols &gt; treecol[hideheader=&quot;true&quot;] {</span>
<a href="#l7.49"></a><span id="l7.49">     font-size: 0;</span>
<a href="#l7.50"></a><span id="l7.50">     border: none;</span>
<a href="#l7.51"></a><span id="l7.51">     padding: 0;</span>
<a href="#l7.52"></a><span id="l7.52">     max-height: 0;</span>
<a href="#l7.53"></a><span id="l7.53">     height: 0;</span>
<a href="#l7.54"></a><span id="l7.54"> }</span>
<a href="#l7.55"></a><span id="l7.55"> </span>
<a href="#l7.56"></a><span id="l7.56"> @media (-moz-overlay-scrollbars) {</span>
<a href="#l7.57"></a><span id="l7.57" class="difflineminus">-    calendar-list-tree &gt; tree &gt; treecols &gt; treecol[anonid=&quot;scrollbar-spacer&quot;] {</span>
<a href="#l7.58"></a><span id="l7.58" class="difflineplus">+    .calendar-list-tree &gt; treecols &gt; treecol.scrollbar-spacer {</span>
<a href="#l7.59"></a><span id="l7.59">       display: none;</span>
<a href="#l7.60"></a><span id="l7.60">     }</span>
<a href="#l7.61"></a><span id="l7.61"> }</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l8.1"></a><span id="l8.1" class="difflineminus">--- a/calendar/base/themes/common/widgets/calendar-widgets.css</span>
<a href="#l8.2"></a><span id="l8.2" class="difflineplus">+++ b/calendar/base/themes/common/widgets/calendar-widgets.css</span>
<a href="#l8.3"></a><span id="l8.3" class="difflineat">@@ -115,11 +115,11 @@ checkbox.treenode-checkbox &gt; .checkbox-l</span>
<a href="#l8.4"></a><span id="l8.4">     list-style-image: none;</span>
<a href="#l8.5"></a><span id="l8.5">     cursor:default;</span>
<a href="#l8.6"></a><span id="l8.6"> }</span>
<a href="#l8.7"></a><span id="l8.7"> </span>
<a href="#l8.8"></a><span id="l8.8"> .categories-textbox {</span>
<a href="#l8.9"></a><span id="l8.9">     -moz-appearance: textfield;</span>
<a href="#l8.10"></a><span id="l8.10"> }</span>
<a href="#l8.11"></a><span id="l8.11"> </span>
<a href="#l8.12"></a><span id="l8.12" class="difflineminus">-calendar-list-tree &gt; tree &gt; treecols {</span>
<a href="#l8.13"></a><span id="l8.13" class="difflineplus">+.calendar-list-tree &gt; treecols {</span>
<a href="#l8.14"></a><span id="l8.14">   padding-inline-start: 18px;</span>
<a href="#l8.15"></a><span id="l8.15"> }</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l9.1"></a><span id="l9.1" class="difflineminus">--- a/calendar/base/themes/linux/calendar-management.css</span>
<a href="#l9.2"></a><span id="l9.2" class="difflineplus">+++ b/calendar/base/themes/linux/calendar-management.css</span>
<a href="#l9.3"></a><span id="l9.3" class="difflineat">@@ -1,25 +1,25 @@</span>
<a href="#l9.4"></a><span id="l9.4"> /* This Source Code Form is subject to the terms of the Mozilla Public</span>
<a href="#l9.5"></a><span id="l9.5">  * License, v. 2.0. If a copy of the MPL was not distributed with this file,</span>
<a href="#l9.6"></a><span id="l9.6">  * You can obtain one at http://mozilla.org/MPL/2.0/. */</span>
<a href="#l9.7"></a><span id="l9.7"> </span>
<a href="#l9.8"></a><span id="l9.8"> @import url(chrome://calendar-common/skin/calendar-management.css);</span>
<a href="#l9.9"></a><span id="l9.9"> </span>
<a href="#l9.10"></a><span id="l9.10" class="difflineminus">-calendar-list-tree &gt; tree &gt; treechildren::-moz-tree-image(checkbox-treecol) {</span>
<a href="#l9.11"></a><span id="l9.11" class="difflineplus">+.calendar-list-tree &gt; treechildren::-moz-tree-image(checkbox-treecol) {</span>
<a href="#l9.12"></a><span id="l9.12">     list-style-image: url(chrome://calendar-common/skin/checkbox-images.png);</span>
<a href="#l9.13"></a><span id="l9.13"> }</span>
<a href="#l9.14"></a><span id="l9.14"> </span>
<a href="#l9.15"></a><span id="l9.15" class="difflineminus">-calendar-list-tree &gt; tree &gt; treechildren::-moz-tree-image(checkbox-treecol) {</span>
<a href="#l9.16"></a><span id="l9.16" class="difflineplus">+.calendar-list-tree &gt; treechildren::-moz-tree-image(checkbox-treecol) {</span>
<a href="#l9.17"></a><span id="l9.17">     -moz-image-region: rect(0 13px 13px 0);</span>
<a href="#l9.18"></a><span id="l9.18"> }</span>
<a href="#l9.19"></a><span id="l9.19"> </span>
<a href="#l9.20"></a><span id="l9.20" class="difflineminus">-calendar-list-tree &gt; tree &gt; treechildren::-moz-tree-image(checkbox-treecol, checked) {</span>
<a href="#l9.21"></a><span id="l9.21" class="difflineplus">+.calendar-list-tree &gt; treechildren::-moz-tree-image(checkbox-treecol, checked) {</span>
<a href="#l9.22"></a><span id="l9.22">     -moz-image-region: rect(0 26px 13px 13px);</span>
<a href="#l9.23"></a><span id="l9.23"> }</span>
<a href="#l9.24"></a><span id="l9.24"> </span>
<a href="#l9.25"></a><span id="l9.25" class="difflineminus">-calendar-list-tree &gt; tree &gt; treechildren::-moz-tree-image(checkbox-treecol, disabled) {</span>
<a href="#l9.26"></a><span id="l9.26" class="difflineplus">+.calendar-list-tree &gt; treechildren::-moz-tree-image(checkbox-treecol, disabled) {</span>
<a href="#l9.27"></a><span id="l9.27">     -moz-image-region: rect(0 39px 13px 26px);</span>
<a href="#l9.28"></a><span id="l9.28"> }</span>
<a href="#l9.29"></a><span id="l9.29"> </span>
<a href="#l9.30"></a><span id="l9.30" class="difflineminus">-calendar-list-tree &gt; tree &gt; treechildren::-moz-tree-image(checkbox-treecol, checked, disabled) {</span>
<a href="#l9.31"></a><span id="l9.31" class="difflineplus">+.calendar-list-tree &gt; treechildren::-moz-tree-image(checkbox-treecol, checked, disabled) {</span>
<a href="#l9.32"></a><span id="l9.32">     -moz-image-region: rect(0 52px 13px 39px);</span>
<a href="#l9.33"></a><span id="l9.33"> }</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l10.1"></a><span id="l10.1" class="difflineminus">--- a/calendar/base/themes/osx/calendar-management.css</span>
<a href="#l10.2"></a><span id="l10.2" class="difflineplus">+++ b/calendar/base/themes/osx/calendar-management.css</span>
<a href="#l10.3"></a><span id="l10.3" class="difflineat">@@ -1,45 +1,45 @@</span>
<a href="#l10.4"></a><span id="l10.4"> /* This Source Code Form is subject to the terms of the Mozilla Public</span>
<a href="#l10.5"></a><span id="l10.5">  * License, v. 2.0. If a copy of the MPL was not distributed with this file,</span>
<a href="#l10.6"></a><span id="l10.6">  * You can obtain one at http://mozilla.org/MPL/2.0/. */</span>
<a href="#l10.7"></a><span id="l10.7"> </span>
<a href="#l10.8"></a><span id="l10.8"> @import url(chrome://calendar-common/skin/calendar-management.css);</span>
<a href="#l10.9"></a><span id="l10.9"> </span>
<a href="#l10.10"></a><span id="l10.10" class="difflineminus">-calendar-list-tree &gt; tree &gt; treechildren::-moz-tree-image(checkbox-treecol) {</span>
<a href="#l10.11"></a><span id="l10.11" class="difflineplus">+.calendar-list-tree &gt; treechildren::-moz-tree-image(checkbox-treecol) {</span>
<a href="#l10.12"></a><span id="l10.12">     list-style-image: url(chrome://calendar/skin/checkbox-images.png);</span>
<a href="#l10.13"></a><span id="l10.13">     height: 16px;</span>
<a href="#l10.14"></a><span id="l10.14">     width: 16px;</span>
<a href="#l10.15"></a><span id="l10.15"> }</span>
<a href="#l10.16"></a><span id="l10.16"> </span>
<a href="#l10.17"></a><span id="l10.17"> @media (-moz-mac-graphite-theme) {</span>
<a href="#l10.18"></a><span id="l10.18" class="difflineminus">-    calendar-list-tree &gt; tree &gt; treechildren::-moz-tree-image(checkbox-treecol) {</span>
<a href="#l10.19"></a><span id="l10.19" class="difflineplus">+    .calendar-list-tree &gt; treechildren::-moz-tree-image(checkbox-treecol) {</span>
<a href="#l10.20"></a><span id="l10.20">         list-style-image: url(chrome://calendar/skin/checkbox-images-graphite.png);</span>
<a href="#l10.21"></a><span id="l10.21">     }</span>
<a href="#l10.22"></a><span id="l10.22"> }</span>
<a href="#l10.23"></a><span id="l10.23"> </span>
<a href="#l10.24"></a><span id="l10.24" class="difflineminus">-calendar-list-tree &gt; tree &gt; treechildren::-moz-tree-image(checkbox-treecol) {</span>
<a href="#l10.25"></a><span id="l10.25" class="difflineplus">+.calendar-list-tree &gt; treechildren::-moz-tree-image(checkbox-treecol) {</span>
<a href="#l10.26"></a><span id="l10.26">     -moz-image-region: rect(0 32px 32px 0);</span>
<a href="#l10.27"></a><span id="l10.27"> }</span>
<a href="#l10.28"></a><span id="l10.28"> </span>
<a href="#l10.29"></a><span id="l10.29" class="difflineminus">-calendar-list-tree &gt; tree &gt; treechildren::-moz-tree-image(checkbox-treecol, checked) {</span>
<a href="#l10.30"></a><span id="l10.30" class="difflineplus">+.calendar-list-tree &gt; treechildren::-moz-tree-image(checkbox-treecol, checked) {</span>
<a href="#l10.31"></a><span id="l10.31">     -moz-image-region: rect(0 64px 32px 32px);</span>
<a href="#l10.32"></a><span id="l10.32"> }</span>
<a href="#l10.33"></a><span id="l10.33"> </span>
<a href="#l10.34"></a><span id="l10.34" class="difflineminus">-calendar-list-tree &gt; tree &gt; treechildren::-moz-tree-image(checkbox-treecol, disabled) {</span>
<a href="#l10.35"></a><span id="l10.35" class="difflineplus">+.calendar-list-tree &gt; treechildren::-moz-tree-image(checkbox-treecol, disabled) {</span>
<a href="#l10.36"></a><span id="l10.36">     -moz-image-region: rect(0 96px 32px 64px);</span>
<a href="#l10.37"></a><span id="l10.37"> }</span>
<a href="#l10.38"></a><span id="l10.38"> </span>
<a href="#l10.39"></a><span id="l10.39" class="difflineminus">-calendar-list-tree &gt; tree &gt; treechildren::-moz-tree-image(checkbox-treecol, checked, disabled) {</span>
<a href="#l10.40"></a><span id="l10.40" class="difflineplus">+.calendar-list-tree &gt; treechildren::-moz-tree-image(checkbox-treecol, checked, disabled) {</span>
<a href="#l10.41"></a><span id="l10.41">     -moz-image-region: rect(0 128px 32px 96px);</span>
<a href="#l10.42"></a><span id="l10.42"> }</span>
<a href="#l10.43"></a><span id="l10.43"> </span>
<a href="#l10.44"></a><span id="l10.44" class="difflineminus">-calendar-list-tree &gt; tree &gt; treechildren::-moz-tree-cell(checkbox-treecol) {</span>
<a href="#l10.45"></a><span id="l10.45" class="difflineplus">+.calendar-list-tree &gt; treechildren::-moz-tree-cell(checkbox-treecol) {</span>
<a href="#l10.46"></a><span id="l10.46">     padding: 0;</span>
<a href="#l10.47"></a><span id="l10.47"> }</span>
<a href="#l10.48"></a><span id="l10.48"> </span>
<a href="#l10.49"></a><span id="l10.49" class="difflineminus">-calendar-list-tree &gt; tree &gt; treechildren::-moz-tree-image(status-treecol, readonly, selected, focus) {</span>
<a href="#l10.50"></a><span id="l10.50" class="difflineplus">+.calendar-list-tree &gt; treechildren::-moz-tree-image(status-treecol, readonly, selected, focus) {</span>
<a href="#l10.51"></a><span id="l10.51">     list-style-image: url(chrome://calendar/skin/locked-selected-mac.svg);</span>
<a href="#l10.52"></a><span id="l10.52"> }</span>
<a href="#l10.53"></a><span id="l10.53"> </span>
<a href="#l10.54"></a><span id="l10.54" class="difflineminus">-calendar-list-tree &gt; tree &gt; treechildren::-moz-tree-image(status-treecol, readfailed, selected, focus) {</span>
<a href="#l10.55"></a><span id="l10.55" class="difflineplus">+.calendar-list-tree &gt; treechildren::-moz-tree-image(status-treecol, readfailed, selected, focus) {</span>
<a href="#l10.56"></a><span id="l10.56">     list-style-image: url(chrome://calendar/skin/warn-selected-mac.svg);</span>
<a href="#l10.57"></a><span id="l10.57"> }</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l11.1"></a><span id="l11.1" class="difflineminus">--- a/calendar/base/themes/windows/calendar-management.css</span>
<a href="#l11.2"></a><span id="l11.2" class="difflineplus">+++ b/calendar/base/themes/windows/calendar-management.css</span>
<a href="#l11.3"></a><span id="l11.3" class="difflineat">@@ -1,25 +1,25 @@</span>
<a href="#l11.4"></a><span id="l11.4"> /* This Source Code Form is subject to the terms of the Mozilla Public</span>
<a href="#l11.5"></a><span id="l11.5">  * License, v. 2.0. If a copy of the MPL was not distributed with this file,</span>
<a href="#l11.6"></a><span id="l11.6">  * You can obtain one at http://mozilla.org/MPL/2.0/. */</span>
<a href="#l11.7"></a><span id="l11.7"> </span>
<a href="#l11.8"></a><span id="l11.8"> @import url(chrome://calendar-common/skin/calendar-management.css);</span>
<a href="#l11.9"></a><span id="l11.9"> </span>
<a href="#l11.10"></a><span id="l11.10" class="difflineminus">-calendar-list-tree &gt; tree &gt; treechildren::-moz-tree-image(checkbox-treecol) {</span>
<a href="#l11.11"></a><span id="l11.11" class="difflineplus">+.calendar-list-tree &gt; treechildren::-moz-tree-image(checkbox-treecol) {</span>
<a href="#l11.12"></a><span id="l11.12">     list-style-image: url(chrome://calendar-common/skin/checkbox-images.png);</span>
<a href="#l11.13"></a><span id="l11.13"> }</span>
<a href="#l11.14"></a><span id="l11.14"> </span>
<a href="#l11.15"></a><span id="l11.15" class="difflineminus">-calendar-list-tree &gt; tree &gt; treechildren::-moz-tree-image(checkbox-treecol) {</span>
<a href="#l11.16"></a><span id="l11.16" class="difflineplus">+.calendar-list-tree &gt; treechildren::-moz-tree-image(checkbox-treecol) {</span>
<a href="#l11.17"></a><span id="l11.17">     -moz-image-region: rect(0 13px 13px 0);</span>
<a href="#l11.18"></a><span id="l11.18"> }</span>
<a href="#l11.19"></a><span id="l11.19"> </span>
<a href="#l11.20"></a><span id="l11.20" class="difflineminus">-calendar-list-tree &gt; tree &gt; treechildren::-moz-tree-image(checkbox-treecol, checked) {</span>
<a href="#l11.21"></a><span id="l11.21" class="difflineplus">+.calendar-list-tree &gt; treechildren::-moz-tree-image(checkbox-treecol, checked) {</span>
<a href="#l11.22"></a><span id="l11.22">     -moz-image-region: rect(0 26px 13px 13px);</span>
<a href="#l11.23"></a><span id="l11.23"> }</span>
<a href="#l11.24"></a><span id="l11.24"> </span>
<a href="#l11.25"></a><span id="l11.25" class="difflineminus">-calendar-list-tree &gt; tree &gt; treechildren::-moz-tree-image(checkbox-treecol, disabled) {</span>
<a href="#l11.26"></a><span id="l11.26" class="difflineplus">+.calendar-list-tree &gt; treechildren::-moz-tree-image(checkbox-treecol, disabled) {</span>
<a href="#l11.27"></a><span id="l11.27">     -moz-image-region: rect(0 39px 13px 26px);</span>
<a href="#l11.28"></a><span id="l11.28"> }</span>
<a href="#l11.29"></a><span id="l11.29"> </span>
<a href="#l11.30"></a><span id="l11.30" class="difflineminus">-calendar-list-tree &gt; tree &gt; treechildren::-moz-tree-image(checkbox-treecol, checked, disabled) {</span>
<a href="#l11.31"></a><span id="l11.31" class="difflineplus">+.calendar-list-tree &gt; treechildren::-moz-tree-image(checkbox-treecol, checked, disabled) {</span>
<a href="#l11.32"></a><span id="l11.32">     -moz-image-region: rect(0 52px 13px 39px);</span>
<a href="#l11.33"></a><span id="l11.33"> }</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l12.1"></a><span id="l12.1" class="difflineminus">--- a/calendar/lightning/content/messenger-overlay-sidebar.xul</span>
<a href="#l12.2"></a><span id="l12.2" class="difflineplus">+++ b/calendar/lightning/content/messenger-overlay-sidebar.xul</span>
<a href="#l12.3"></a><span id="l12.3" class="difflineat">@@ -49,16 +49,17 @@</span>
<a href="#l12.4"></a><span id="l12.4">   &lt;script src=&quot;chrome://calendar/content/calendar-chrome-startup.js&quot;/&gt;</span>
<a href="#l12.5"></a><span id="l12.5">   &lt;script src=&quot;chrome://calendar/content/mouseoverPreviews.js&quot;/&gt;</span>
<a href="#l12.6"></a><span id="l12.6">   &lt;script src=&quot;chrome://calendar/content/calendar-views.js&quot;/&gt;</span>
<a href="#l12.7"></a><span id="l12.7">   &lt;script src=&quot;chrome://calendar/content/calendar-ui-utils.js&quot;/&gt;</span>
<a href="#l12.8"></a><span id="l12.8">   &lt;script src=&quot;chrome://calendar/content/calendar-creation.js&quot;/&gt;</span>
<a href="#l12.9"></a><span id="l12.9">   &lt;script src=&quot;chrome://calendar/content/calendar-dnd-listener.js&quot;/&gt;</span>
<a href="#l12.10"></a><span id="l12.10">   &lt;script src=&quot;chrome://calendar/content/calendar-statusbar.js&quot;/&gt;</span>
<a href="#l12.11"></a><span id="l12.11">   &lt;script src=&quot;chrome://global/content/nsDragAndDrop.js&quot;/&gt;</span>
<a href="#l12.12"></a><span id="l12.12" class="difflineplus">+  &lt;script src=&quot;chrome://calendar/content/widgets/calendar-list-tree.js&quot;/&gt;</span>
<a href="#l12.13"></a><span id="l12.13"> </span>
<a href="#l12.14"></a><span id="l12.14">   &lt;!-- NEEDED FOR TASK VIEW/LIST SUPPORT --&gt;</span>
<a href="#l12.15"></a><span id="l12.15">   &lt;script src=&quot;chrome://calendar/content/calendar-task-editing.js&quot;/&gt;</span>
<a href="#l12.16"></a><span id="l12.16"> </span>
<a href="#l12.17"></a><span id="l12.17">   &lt;script src=&quot;chrome://calendar/content/calendar-extract.js&quot;/&gt;</span>
<a href="#l12.18"></a><span id="l12.18"> </span>
<a href="#l12.19"></a><span id="l12.19">   &lt;script src=&quot;chrome://lightning/content/lightning-utils.js&quot;/&gt;</span>
<a href="#l12.20"></a><span id="l12.20">   &lt;script src=&quot;chrome://lightning/content/messenger-overlay-sidebar.js&quot;/&gt;</span>
<a href="#l12.21"></a><span id="l12.21" class="difflineat">@@ -178,19 +179,20 @@</span>
<a href="#l12.22"></a><span id="l12.22">                                class=&quot;treenode-checkbox&quot;</span>
<a href="#l12.23"></a><span id="l12.23">                                ondrop=&quot;return document.getElementById('calendar-list-tree-widget').foreignDrop(event)&quot;</span>
<a href="#l12.24"></a><span id="l12.24">                                ondragenter=&quot;return document.getElementById('calendar-list-tree-widget').foreignCanDrop(event)&quot;</span>
<a href="#l12.25"></a><span id="l12.25">                                ondragover=&quot;return document.getElementById('calendar-list-tree-widget').foreignCanDrop(event)&quot;</span>
<a href="#l12.26"></a><span id="l12.26">                                label=&quot;&amp;calendar.list.header.label;&quot;/&gt;</span>
<a href="#l12.27"></a><span id="l12.27">               &lt;modevbox id=&quot;calendar-listtree-pane&quot; flex=&quot;1&quot; mode=&quot;calendar,task&quot; broadcaster=&quot;modeBroadcaster&quot;</span>
<a href="#l12.28"></a><span id="l12.28">                         refcontrol=&quot;calendar-list-header&quot;&gt;</span>
<a href="#l12.29"></a><span id="l12.29"> </span>
<a href="#l12.30"></a><span id="l12.30" class="difflineminus">-                &lt;calendar-list-tree id=&quot;calendar-list-tree-widget&quot;</span>
<a href="#l12.31"></a><span id="l12.31" class="difflineminus">-                                    class=&quot;task-tree-subpane&quot;</span>
<a href="#l12.32"></a><span id="l12.32" class="difflineminus">-                                    flex=&quot;1&quot;/&gt;</span>
<a href="#l12.33"></a><span id="l12.33" class="difflineplus">+                &lt;tree is=&quot;calendar-list-tree-full&quot; id=&quot;calendar-list-tree-widget&quot;</span>
<a href="#l12.34"></a><span id="l12.34" class="difflineplus">+                      class=&quot;calendar-list-tree task-tree-subpane&quot;</span>
<a href="#l12.35"></a><span id="l12.35" class="difflineplus">+                      childtooltip=&quot;calendar-list-tooltip&quot;</span>
<a href="#l12.36"></a><span id="l12.36" class="difflineplus">+                      childcontext=&quot;list-calendars-context-menu&quot;/&gt;</span>
<a href="#l12.37"></a><span id="l12.37">               &lt;/modevbox&gt;</span>
<a href="#l12.38"></a><span id="l12.38">           &lt;/modevbox&gt;</span>
<a href="#l12.39"></a><span id="l12.39">           &lt;/vbox&gt;</span>
<a href="#l12.40"></a><span id="l12.40">         &lt;/vbox&gt;</span>
<a href="#l12.41"></a><span id="l12.41"> </span>
<a href="#l12.42"></a><span id="l12.42">         &lt;splitter id=&quot;calsidebar_splitter&quot;</span>
<a href="#l12.43"></a><span id="l12.43">                   collapse=&quot;before&quot;</span>
<a href="#l12.44"></a><span id="l12.44">                   persist=&quot;state&quot;</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l13.1"></a><span id="l13.1" class="difflineminus">--- a/calendar/providers/gdata/content/gdata-bindings.css</span>
<a href="#l13.2"></a><span id="l13.2" class="difflineplus">+++ b/calendar/providers/gdata/content/gdata-bindings.css</span>
<a href="#l13.3"></a><span id="l13.3" class="difflineat">@@ -1,22 +1,18 @@</span>
<a href="#l13.4"></a><span id="l13.4"> /* This Source Code Form is subject to the terms of the Mozilla Public</span>
<a href="#l13.5"></a><span id="l13.5">  * License, v. 2.0. If a copy of the MPL was not distributed with this</span>
<a href="#l13.6"></a><span id="l13.6">  * file, You can obtain one at http://mozilla.org/MPL/2.0/. */</span>
<a href="#l13.7"></a><span id="l13.7"> </span>
<a href="#l13.8"></a><span id="l13.8" class="difflineminus">-calendar-list-tree[type=&quot;gdata&quot;] {</span>
<a href="#l13.9"></a><span id="l13.9" class="difflineminus">-  -moz-binding: url(chrome://gdata-provider/content/gdata-list-tree.xml#gdata-list-tree);</span>
<a href="#l13.10"></a><span id="l13.10" class="difflineminus">-}</span>
<a href="#l13.11"></a><span id="l13.11" class="difflineminus">-</span>
<a href="#l13.12"></a><span id="l13.12" class="difflineminus">-calendar-list-tree &gt; tree &gt; treechildren::-moz-tree-image(checkbox-treecol, disabled) {</span>
<a href="#l13.13"></a><span id="l13.13" class="difflineplus">+.calendar-list-tree &gt; treechildren::-moz-tree-image(checkbox-treecol, disabled) {</span>
<a href="#l13.14"></a><span id="l13.14">     list-style-image: none !important;</span>
<a href="#l13.15"></a><span id="l13.15"> }</span>
<a href="#l13.16"></a><span id="l13.16"> </span>
<a href="#l13.17"></a><span id="l13.17" class="difflineminus">-calendar-list-tree &gt; tree &gt; treechildren::-moz-tree-cell(color-treecol, disabled) {</span>
<a href="#l13.18"></a><span id="l13.18" class="difflineplus">+.calendar-list-tree &gt; treechildren::-moz-tree-cell(color-treecol, disabled) {</span>
<a href="#l13.19"></a><span id="l13.19">     background-color: transparent !important;</span>
<a href="#l13.20"></a><span id="l13.20"> }</span>
<a href="#l13.21"></a><span id="l13.21"> </span>
<a href="#l13.22"></a><span id="l13.22" class="difflineminus">-calendar-list-tree &gt; tree &gt; treechildren::-moz-tree-image(status-treecol, readonly) {</span>
<a href="#l13.23"></a><span id="l13.23" class="difflineplus">+.calendar-list-tree &gt; treechildren::-moz-tree-image(status-treecol, readonly) {</span>
<a href="#l13.24"></a><span id="l13.24">     list-style-image: none;</span>
<a href="#l13.25"></a><span id="l13.25"> }</span>
<a href="#l13.26"></a><span id="l13.26" class="difflineminus">-calendar-list-tree &gt; tree &gt; treechildren::-moz-tree-cell-text(readonly) {</span>
<a href="#l13.27"></a><span id="l13.27" class="difflineplus">+.calendar-list-tree &gt; treechildren::-moz-tree-cell-text(readonly) {</span>
<a href="#l13.28"></a><span id="l13.28">     opacity: 0.4;</span>
<a href="#l13.29"></a><span id="l13.29"> }</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l14.1"></a><span id="l14.1" class="difflineminus">--- a/calendar/providers/gdata/content/gdata-calendar-creation.xul</span>
<a href="#l14.2"></a><span id="l14.2" class="difflineplus">+++ b/calendar/providers/gdata/content/gdata-calendar-creation.xul</span>
<a href="#l14.3"></a><span id="l14.3" class="difflineat">@@ -9,17 +9,21 @@</span>
<a href="#l14.4"></a><span id="l14.4"> ]&gt;</span>
<a href="#l14.5"></a><span id="l14.5"> </span>
<a href="#l14.6"></a><span id="l14.6"> &lt;?xml-stylesheet href=&quot;chrome://calendar/skin/calendar-management.css&quot; type=&quot;text/css&quot;?&gt;</span>
<a href="#l14.7"></a><span id="l14.7"> &lt;?xml-stylesheet href=&quot;chrome://calendar/content/widgets/calendar-widget-bindings.css&quot; type=&quot;text/css&quot;?&gt;</span>
<a href="#l14.8"></a><span id="l14.8"> &lt;?xml-stylesheet href=&quot;chrome://gdata-provider/skin/gdata-bindings.css&quot; type=&quot;text/css&quot;?&gt;</span>
<a href="#l14.9"></a><span id="l14.9"> </span>
<a href="#l14.10"></a><span id="l14.10"> &lt;overlay id=&quot;gdataCalendarCreation&quot;</span>
<a href="#l14.11"></a><span id="l14.11">          xmlns=&quot;http://www.mozilla.org/keymaster/gatekeeper/there.is.only.xul&quot; xmlns:html=&quot;http://www.w3.org/1999/xhtml&quot;&gt;</span>
<a href="#l14.12"></a><span id="l14.12" class="difflineplus">+</span>
<a href="#l14.13"></a><span id="l14.13" class="difflineplus">+  &lt;script src=&quot;chrome://gdata-provider/content/calendar-list-tree.js&quot;/&gt;</span>
<a href="#l14.14"></a><span id="l14.14" class="difflineplus">+  &lt;script src=&quot;chrome://gdata-provider/content/gdata-list-tree.js&quot;/&gt;</span>
<a href="#l14.15"></a><span id="l14.15">   &lt;script src=&quot;chrome://gdata-provider/content/gdata-calendar-creation.js&quot;/&gt;</span>
<a href="#l14.16"></a><span id="l14.16" class="difflineplus">+</span>
<a href="#l14.17"></a><span id="l14.17">   &lt;radiogroup id=&quot;calendar-format&quot;&gt;</span>
<a href="#l14.18"></a><span id="l14.18">     &lt;radio value=&quot;gdata&quot; label=&quot;&amp;gdata-provider.label;&quot;/&gt;</span>
<a href="#l14.19"></a><span id="l14.19">   &lt;/radiogroup&gt;</span>
<a href="#l14.20"></a><span id="l14.20"> </span>
<a href="#l14.21"></a><span id="l14.21">   &lt;wizard id=&quot;calendar-wizard&quot;&gt;</span>
<a href="#l14.22"></a><span id="l14.22">     &lt;description id=&quot;gdata-nextstep-description&quot; hidden=&quot;true&quot;&gt;&amp;gdata.wizard.nextstep.description;&lt;/description&gt;</span>
<a href="#l14.23"></a><span id="l14.23"> </span>
<a href="#l14.24"></a><span id="l14.24">     &lt;wizardpage id=&quot;gdata-session&quot;</span>
<a href="#l14.25"></a><span id="l14.25" class="difflineat">@@ -36,14 +40,14 @@</span>
<a href="#l14.26"></a><span id="l14.26">                    flex=&quot;1&quot;/&gt;</span>
<a href="#l14.27"></a><span id="l14.27">         &lt;/hbox&gt;</span>
<a href="#l14.28"></a><span id="l14.28">       &lt;/radiogroup&gt;</span>
<a href="#l14.29"></a><span id="l14.29">     &lt;/wizardpage&gt;</span>
<a href="#l14.30"></a><span id="l14.30">     &lt;wizardpage id=&quot;gdata-calendars&quot;</span>
<a href="#l14.31"></a><span id="l14.31">                 pageid=&quot;gdata-calendars&quot;</span>
<a href="#l14.32"></a><span id="l14.32">                 description=&quot;&amp;wizard.description;&quot;&gt;</span>
<a href="#l14.33"></a><span id="l14.33">       &lt;description&gt;&amp;gdata.wizard.calendars.description;&lt;/description&gt;</span>
<a href="#l14.34"></a><span id="l14.34" class="difflineminus">-      &lt;calendar-list-tree type=&quot;gdata&quot; id=&quot;calendar-list&quot; flex=&quot;1&quot;</span>
<a href="#l14.35"></a><span id="l14.35" class="difflineminus">-                          onselect=&quot;checkRequired();&quot; hideheader=&quot;true&quot;</span>
<a href="#l14.36"></a><span id="l14.36" class="difflineminus">-                          onclick=&quot;checkRequired()&quot;/&gt;</span>
<a href="#l14.37"></a><span id="l14.37" class="difflineplus">+      &lt;tree is=&quot;calendar-list-tree-gdata&quot; id=&quot;calendar-list&quot;</span>
<a href="#l14.38"></a><span id="l14.38" class="difflineplus">+            onselect=&quot;checkRequired();&quot;</span>
<a href="#l14.39"></a><span id="l14.39" class="difflineplus">+            onclick=&quot;checkRequired()&quot;/&gt;</span>
<a href="#l14.40"></a><span id="l14.40">     &lt;/wizardpage&gt;</span>
<a href="#l14.41"></a><span id="l14.41">   &lt;/wizard&gt;</span>
<a href="#l14.42"></a><span id="l14.42"> &lt;/overlay&gt;</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l15.1"></a><span id="l15.1">rename from calendar/providers/gdata/content/gdata-list-tree.xml</span>
<a href="#l15.2"></a><span id="l15.2">rename to calendar/providers/gdata/content/gdata-list-tree.js</span>
<a href="#l15.3"></a><span id="l15.3" class="difflineminus">--- a/calendar/providers/gdata/content/gdata-list-tree.xml</span>
<a href="#l15.4"></a><span id="l15.4" class="difflineplus">+++ b/calendar/providers/gdata/content/gdata-list-tree.js</span>
<a href="#l15.5"></a><span id="l15.5" class="difflineat">@@ -1,240 +1,153 @@</span>
<a href="#l15.6"></a><span id="l15.6" class="difflineminus">-&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;</span>
<a href="#l15.7"></a><span id="l15.7" class="difflineminus">-&lt;!-- This Source Code Form is subject to the terms of the Mozilla Public</span>
<a href="#l15.8"></a><span id="l15.8" class="difflineminus">-   - License, v. 2.0. If a copy of the MPL was not distributed with this</span>
<a href="#l15.9"></a><span id="l15.9" class="difflineminus">-   - file, You can obtain one at http://mozilla.org/MPL/2.0/. --&gt;</span>
<a href="#l15.10"></a><span id="l15.10" class="difflineminus">-</span>
<a href="#l15.11"></a><span id="l15.11" class="difflineminus">-&lt;!-- globals cal, Services --&gt;</span>
<a href="#l15.12"></a><span id="l15.12" class="difflineplus">+/* This Source Code Form is subject to the terms of the Mozilla Public</span>
<a href="#l15.13"></a><span id="l15.13" class="difflineplus">+ * License, v. 2.0. If a copy of the MPL was not distributed with this</span>
<a href="#l15.14"></a><span id="l15.14" class="difflineplus">+ * file, You can obtain one at http://mozilla.org/MPL/2.0/. */</span>
<a href="#l15.15"></a><span id="l15.15"> </span>
<a href="#l15.16"></a><span id="l15.16" class="difflineminus">-&lt;!DOCTYPE bindings SYSTEM &quot;chrome://calendar/locale/calendar.dtd&quot;&gt;</span>
<a href="#l15.17"></a><span id="l15.17" class="difflineplus">+&quot;use strict&quot;;</span>
<a href="#l15.18"></a><span id="l15.18"> </span>
<a href="#l15.19"></a><span id="l15.19" class="difflineminus">-&lt;bindings id=&quot;gdata-list-tree-bindings&quot;</span>
<a href="#l15.20"></a><span id="l15.20" class="difflineminus">-          xmlns=&quot;http://www.mozilla.org/xbl&quot;</span>
<a href="#l15.21"></a><span id="l15.21" class="difflineminus">-          xmlns:xbl=&quot;http://www.mozilla.org/xbl&quot;</span>
<a href="#l15.22"></a><span id="l15.22" class="difflineminus">-          xmlns:xul=&quot;http://www.mozilla.org/keymaster/gatekeeper/there.is.only.xul&quot;&gt;</span>
<a href="#l15.23"></a><span id="l15.23" class="difflineplus">+/* globals cal Services customElements MozXULElement */</span>
<a href="#l15.24"></a><span id="l15.24"> </span>
<a href="#l15.25"></a><span id="l15.25" class="difflineminus">-  &lt;binding id=&quot;gdata-list-tree&quot; extends=&quot;chrome://calendar/content/widgets/calendar-list-tree.xml#calendar-list-tree&quot;&gt;</span>
<a href="#l15.26"></a><span id="l15.26" class="difflineminus">-    &lt;content&gt;</span>
<a href="#l15.27"></a><span id="l15.27" class="difflineminus">-      &lt;xul:tree anonid=&quot;tree&quot;</span>
<a href="#l15.28"></a><span id="l15.28" class="difflineminus">-                xbl:inherits=&quot;hidecolumnpicker&quot;</span>
<a href="#l15.29"></a><span id="l15.29" class="difflineminus">-                hidecolumnpicker=&quot;true&quot;</span>
<a href="#l15.30"></a><span id="l15.30" class="difflineminus">-                seltype=&quot;single&quot;</span>
<a href="#l15.31"></a><span id="l15.31" class="difflineminus">-                flex=&quot;1&quot;&gt;</span>
<a href="#l15.32"></a><span id="l15.32" class="difflineminus">-        &lt;xul:treecols anonid=&quot;treecols&quot;</span>
<a href="#l15.33"></a><span id="l15.33" class="difflineminus">-                      xbl:inherits=&quot;hideheader&quot;</span>
<a href="#l15.34"></a><span id="l15.34" class="difflineminus">-                      hideheader=&quot;true&quot;&gt;</span>
<a href="#l15.35"></a><span id="l15.35" class="difflineminus">-          &lt;xul:treecol anonid=&quot;checkbox-treecol&quot;</span>
<a href="#l15.36"></a><span id="l15.36" class="difflineminus">-                       xbl:inherits=&quot;cycler,hideheader&quot;</span>
<a href="#l15.37"></a><span id="l15.37" class="difflineminus">-                       cycler=&quot;true&quot;</span>
<a href="#l15.38"></a><span id="l15.38" class="difflineminus">-                       hideheader=&quot;true&quot;</span>
<a href="#l15.39"></a><span id="l15.39" class="difflineminus">-                       width=&quot;17&quot;/&gt;</span>
<a href="#l15.40"></a><span id="l15.40" class="difflineminus">-          &lt;xul:treecol anonid=&quot;color-treecol&quot;</span>
<a href="#l15.41"></a><span id="l15.41" class="difflineminus">-                       xbl:inherits=&quot;cycler,hideheader&quot;</span>
<a href="#l15.42"></a><span id="l15.42" class="difflineminus">-                       hideheader=&quot;true&quot;</span>
<a href="#l15.43"></a><span id="l15.43" class="difflineminus">-                       width=&quot;16&quot;/&gt;</span>
<a href="#l15.44"></a><span id="l15.44" class="difflineminus">-          &lt;xul:treecol anonid=&quot;calendarname-treecol&quot;</span>
<a href="#l15.45"></a><span id="l15.45" class="difflineminus">-                       xbl:inherits=&quot;cycler,hideheader&quot;</span>
<a href="#l15.46"></a><span id="l15.46" class="difflineminus">-                       primary=&quot;true&quot;</span>
<a href="#l15.47"></a><span id="l15.47" class="difflineminus">-                       hideheader=&quot;true&quot;</span>
<a href="#l15.48"></a><span id="l15.48" class="difflineminus">-                       label=&quot;&amp;calendar.unifinder.tree.calendarname.label;&quot;</span>
<a href="#l15.49"></a><span id="l15.49" class="difflineminus">-                       flex=&quot;1&quot;/&gt;</span>
<a href="#l15.50"></a><span id="l15.50" class="difflineminus">-          &lt;xul:treecol anonid=&quot;status-treecol&quot;</span>
<a href="#l15.51"></a><span id="l15.51" class="difflineminus">-                       xbl:inherits=&quot;cycler,hideheader&quot;</span>
<a href="#l15.52"></a><span id="l15.52" class="difflineminus">-                       hideheader=&quot;true&quot;</span>
<a href="#l15.53"></a><span id="l15.53" class="difflineminus">-                       width=&quot;18&quot;/&gt;</span>
<a href="#l15.54"></a><span id="l15.54" class="difflineminus">-          &lt;children includes=&quot;treecol&quot;/&gt;</span>
<a href="#l15.55"></a><span id="l15.55" class="difflineminus">-          &lt;xul:treecol anonid=&quot;scrollbar-spacer&quot;</span>
<a href="#l15.56"></a><span id="l15.56" class="difflineminus">-                       xbl:inherits=&quot;cycler,hideheader&quot;</span>
<a href="#l15.57"></a><span id="l15.57" class="difflineminus">-                       fixed=&quot;true&quot;</span>
<a href="#l15.58"></a><span id="l15.58" class="difflineminus">-                       hideheader=&quot;true&quot;&gt;</span>
<a href="#l15.59"></a><span id="l15.59" class="difflineminus">-            &lt;!-- This is a very elegant workaround to make sure the last column</span>
<a href="#l15.60"></a><span id="l15.60" class="difflineminus">-                 is not covered by the scrollbar in case of an overflow. This</span>
<a href="#l15.61"></a><span id="l15.61" class="difflineminus">-                 treecol needs to be here last --&gt;</span>
<a href="#l15.62"></a><span id="l15.62" class="difflineminus">-            &lt;xul:slider anonid=&quot;scrollbar-slider&quot; orient=&quot;vertical&quot;/&gt;</span>
<a href="#l15.63"></a><span id="l15.63" class="difflineminus">-          &lt;/xul:treecol&gt;</span>
<a href="#l15.64"></a><span id="l15.64" class="difflineminus">-        &lt;/xul:treecols&gt;</span>
<a href="#l15.65"></a><span id="l15.65" class="difflineminus">-        &lt;xul:treechildren anonid=&quot;treechildren&quot;</span>
<a href="#l15.66"></a><span id="l15.66" class="difflineminus">-                          xbl:inherits=&quot;tooltip=childtooltip,context=childcontext&quot;</span>
<a href="#l15.67"></a><span id="l15.67" class="difflineminus">-                          tooltip=&quot;_child&quot;</span>
<a href="#l15.68"></a><span id="l15.68" class="difflineminus">-                          context=&quot;_child&quot;</span>
<a href="#l15.69"></a><span id="l15.69" class="difflineminus">-                          ondragstart=&quot;onDragStart(event);&quot;</span>
<a href="#l15.70"></a><span id="l15.70" class="difflineminus">-                          onoverflow=&quot;displayScrollbarSpacer(true)&quot;</span>
<a href="#l15.71"></a><span id="l15.71" class="difflineminus">-                          onunderflow=&quot;displayScrollbarSpacer(false)&quot;&gt;</span>
<a href="#l15.72"></a><span id="l15.72" class="difflineminus">-          &lt;children includes=&quot;tooltip|menupopup&quot;/&gt;</span>
<a href="#l15.73"></a><span id="l15.73" class="difflineminus">-        &lt;/xul:treechildren&gt;</span>
<a href="#l15.74"></a><span id="l15.74" class="difflineminus">-      &lt;/xul:tree&gt;</span>
<a href="#l15.75"></a><span id="l15.75" class="difflineminus">-    &lt;/content&gt;</span>
<a href="#l15.76"></a><span id="l15.76" class="difflineplus">+// Wrap in a block to prevent leaking to window scope.</span>
<a href="#l15.77"></a><span id="l15.77" class="difflineplus">+{</span>
<a href="#l15.78"></a><span id="l15.78" class="difflineplus">+    /**</span>
<a href="#l15.79"></a><span id="l15.79" class="difflineplus">+     * The calendar list used when adding a new calendar from a Google account. It appears in the</span>
<a href="#l15.80"></a><span id="l15.80" class="difflineplus">+     * new calendar dialog. The list of calendars is subdivided into &quot;Calendars&quot; and &quot;Task Lists&quot;.</span>
<a href="#l15.81"></a><span id="l15.81" class="difflineplus">+     * This is done by including &quot;mock&quot; calendar rows that are just header rows for the sections.</span>
<a href="#l15.82"></a><span id="l15.82" class="difflineplus">+     */</span>
<a href="#l15.83"></a><span id="l15.83" class="difflineplus">+    class CalendarListTreeGdata extends customElements.get(&quot;calendar-list-tree&quot;) {</span>
<a href="#l15.84"></a><span id="l15.84" class="difflineplus">+        connectedCallback() {</span>
<a href="#l15.85"></a><span id="l15.85" class="difflineplus">+            if (this.delayConnectedCallback() || this.hasConnected) {</span>
<a href="#l15.86"></a><span id="l15.86" class="difflineplus">+                return;</span>
<a href="#l15.87"></a><span id="l15.87" class="difflineplus">+            }</span>
<a href="#l15.88"></a><span id="l15.88" class="difflineplus">+            // this.hasConnected is set to true in super.connectedCallback.</span>
<a href="#l15.89"></a><span id="l15.89" class="difflineplus">+            super.connectedCallback();</span>
<a href="#l15.90"></a><span id="l15.90"> </span>
<a href="#l15.91"></a><span id="l15.91" class="difflineminus">-    &lt;implementation&gt;</span>
<a href="#l15.92"></a><span id="l15.92" class="difflineminus">-      &lt;constructor&gt;&lt;![CDATA[</span>
<a href="#l15.93"></a><span id="l15.93" class="difflineminus">-          this.tree.view = this;</span>
<a href="#l15.94"></a><span id="l15.94" class="difflineminus">-      ]]&gt;&lt;/constructor&gt;</span>
<a href="#l15.95"></a><span id="l15.95" class="difflineplus">+            this.mCalendarHeaderIndex = 0;</span>
<a href="#l15.96"></a><span id="l15.96" class="difflineplus">+            this.mTasksHeaderIndex = 0;</span>
<a href="#l15.97"></a><span id="l15.97" class="difflineplus">+        }</span>
<a href="#l15.98"></a><span id="l15.98"> </span>
<a href="#l15.99"></a><span id="l15.99" class="difflineminus">-      &lt;property name=&quot;mockCalendarHeader&quot; readonly=&quot;true&quot;&gt;</span>
<a href="#l15.100"></a><span id="l15.100" class="difflineminus">-        &lt;getter&gt;&lt;![CDATA[</span>
<a href="#l15.101"></a><span id="l15.101" class="difflineminus">-            let calmgr = cal.getCalendarManager();</span>
<a href="#l15.102"></a><span id="l15.102" class="difflineminus">-            let uri = &quot;dummy://calendar&quot;;</span>
<a href="#l15.103"></a><span id="l15.103" class="difflineminus">-            let mem = calmgr.createCalendar(&quot;memory&quot;, Services.io.newURI(uri));</span>
<a href="#l15.104"></a><span id="l15.104" class="difflineplus">+        get mockCalendarHeader() {</span>
<a href="#l15.105"></a><span id="l15.105" class="difflineplus">+            const calmgr = cal.getCalendarManager();</span>
<a href="#l15.106"></a><span id="l15.106" class="difflineplus">+            const uri = &quot;dummy://calendar&quot;;</span>
<a href="#l15.107"></a><span id="l15.107" class="difflineplus">+            const mem = calmgr.createCalendar(&quot;memory&quot;, Services.io.newURI(uri));</span>
<a href="#l15.108"></a><span id="l15.108">             mem.setProperty(&quot;disabled&quot;, true);</span>
<a href="#l15.109"></a><span id="l15.109">             mem.name = &quot;Calendars&quot;;</span>
<a href="#l15.110"></a><span id="l15.110">             mem.id = cal.getUUID();</span>
<a href="#l15.111"></a><span id="l15.111">             return mem;</span>
<a href="#l15.112"></a><span id="l15.112" class="difflineminus">-        ]]&gt;&lt;/getter&gt;</span>
<a href="#l15.113"></a><span id="l15.113" class="difflineminus">-      &lt;/property&gt;</span>
<a href="#l15.114"></a><span id="l15.114" class="difflineplus">+        }</span>
<a href="#l15.115"></a><span id="l15.115"> </span>
<a href="#l15.116"></a><span id="l15.116" class="difflineminus">-      &lt;property name=&quot;mockTaskHeader&quot; readonly=&quot;true&quot;&gt;</span>
<a href="#l15.117"></a><span id="l15.117" class="difflineminus">-        &lt;getter&gt;&lt;![CDATA[</span>
<a href="#l15.118"></a><span id="l15.118" class="difflineminus">-            let calmgr = cal.getCalendarManager();</span>
<a href="#l15.119"></a><span id="l15.119" class="difflineminus">-            let uri = &quot;dummy://tasks&quot;;</span>
<a href="#l15.120"></a><span id="l15.120" class="difflineminus">-            let mem = calmgr.createCalendar(&quot;memory&quot;, Services.io.newURI(uri));</span>
<a href="#l15.121"></a><span id="l15.121" class="difflineplus">+        get mockTaskHeader() {</span>
<a href="#l15.122"></a><span id="l15.122" class="difflineplus">+            const calmgr = cal.getCalendarManager();</span>
<a href="#l15.123"></a><span id="l15.123" class="difflineplus">+            const uri = &quot;dummy://tasks&quot;;</span>
<a href="#l15.124"></a><span id="l15.124" class="difflineplus">+            const mem = calmgr.createCalendar(&quot;memory&quot;, Services.io.newURI(uri));</span>
<a href="#l15.125"></a><span id="l15.125">             mem.setProperty(&quot;disabled&quot;, true);</span>
<a href="#l15.126"></a><span id="l15.126">             mem.name = &quot;Task Lists&quot;;</span>
<a href="#l15.127"></a><span id="l15.127">             mem.id = cal.getUUID();</span>
<a href="#l15.128"></a><span id="l15.128">             return mem;</span>
<a href="#l15.129"></a><span id="l15.129" class="difflineminus">-        ]]&gt;&lt;/getter&gt;</span>
<a href="#l15.130"></a><span id="l15.130" class="difflineminus">-      &lt;/property&gt;</span>
<a href="#l15.131"></a><span id="l15.131" class="difflineminus">-</span>
<a href="#l15.132"></a><span id="l15.132" class="difflineminus">-      &lt;field name=&quot;mCalendarHeaderIndex&quot;&gt;0&lt;/field&gt;</span>
<a href="#l15.133"></a><span id="l15.133" class="difflineminus">-      &lt;field name=&quot;mTasksHeaderIndex&quot;&gt;0&lt;/field&gt;</span>
<a href="#l15.134"></a><span id="l15.134" class="difflineminus">-</span>
<a href="#l15.135"></a><span id="l15.135" class="difflineminus">-      &lt;field name=&quot;QueryInterface&quot;&gt;ChromeUtils.generateQI([Ci.nsITreeView])&lt;/field&gt;</span>
<a href="#l15.136"></a><span id="l15.136" class="difflineplus">+        }</span>
<a href="#l15.137"></a><span id="l15.137"> </span>
<a href="#l15.138"></a><span id="l15.138" class="difflineminus">-      &lt;property name=&quot;calendars&quot;&gt;</span>
<a href="#l15.139"></a><span id="l15.139" class="difflineminus">-        &lt;getter&gt;&lt;![CDATA[</span>
<a href="#l15.140"></a><span id="l15.140" class="difflineminus">-            return this.mCalendarList;</span>
<a href="#l15.141"></a><span id="l15.141" class="difflineminus">-        ]]&gt;&lt;/getter&gt;</span>
<a href="#l15.142"></a><span id="l15.142" class="difflineminus">-        &lt;setter&gt;&lt;![CDATA[</span>
<a href="#l15.143"></a><span id="l15.143" class="difflineminus">-            for (let i = 0; i &lt; val.length; i++) {</span>
<a href="#l15.144"></a><span id="l15.144" class="difflineminus">-                let calendar = val[i];</span>
<a href="#l15.145"></a><span id="l15.145" class="difflineminus">-                let spec = calendar.uri.spec;</span>
<a href="#l15.146"></a><span id="l15.146" class="difflineplus">+        set calendars(calendars) {</span>
<a href="#l15.147"></a><span id="l15.147" class="difflineplus">+            calendars.forEach((calendar, index) =&gt; {</span>
<a href="#l15.148"></a><span id="l15.148" class="difflineplus">+                const spec = calendar.uri.spec;</span>
<a href="#l15.149"></a><span id="l15.149">                 if (calendar.type == &quot;memory&quot;) {</span>
<a href="#l15.150"></a><span id="l15.150">                     if (spec == &quot;dummy://calendar&quot;) {</span>
<a href="#l15.151"></a><span id="l15.151" class="difflineminus">-                        this.mCalendarHeaderIndex = i;</span>
<a href="#l15.152"></a><span id="l15.152" class="difflineplus">+                        this.mCalendarHeaderIndex = index;</span>
<a href="#l15.153"></a><span id="l15.153">                     } else if (spec == &quot;dummy://tasks&quot;) {</span>
<a href="#l15.154"></a><span id="l15.154" class="difflineminus">-                        this.mTasksHeaderIndex = i;</span>
<a href="#l15.155"></a><span id="l15.155" class="difflineplus">+                        this.mTasksHeaderIndex = index;</span>
<a href="#l15.156"></a><span id="l15.156">                     }</span>
<a href="#l15.157"></a><span id="l15.157">                 }</span>
<a href="#l15.158"></a><span id="l15.158">                 this.addCalendar(calendar);</span>
<a href="#l15.159"></a><span id="l15.159" class="difflineminus">-            }</span>
<a href="#l15.160"></a><span id="l15.160" class="difflineplus">+            });</span>
<a href="#l15.161"></a><span id="l15.161">             return this.mCalendarList;</span>
<a href="#l15.162"></a><span id="l15.162" class="difflineminus">-        ]]&gt;&lt;/setter&gt;</span>
<a href="#l15.163"></a><span id="l15.163" class="difflineminus">-      &lt;/property&gt;</span>
<a href="#l15.164"></a><span id="l15.164" class="difflineplus">+        }</span>
<a href="#l15.165"></a><span id="l15.165"> </span>
<a href="#l15.166"></a><span id="l15.166" class="difflineminus">-      &lt;method name=&quot;removeCalendar&quot;&gt;</span>
<a href="#l15.167"></a><span id="l15.167" class="difflineminus">-        &lt;parameter name=&quot;aCalendar&quot;/&gt;</span>
<a href="#l15.168"></a><span id="l15.168" class="difflineminus">-        &lt;body&gt;&lt;![CDATA[</span>
<a href="#l15.169"></a><span id="l15.169" class="difflineminus">-            let index = this.findIndexById(aCalendar.id);</span>
<a href="#l15.170"></a><span id="l15.170" class="difflineplus">+        get calendars() {</span>
<a href="#l15.171"></a><span id="l15.171" class="difflineplus">+            return this.mCalendarList;</span>
<a href="#l15.172"></a><span id="l15.172" class="difflineplus">+        }</span>
<a href="#l15.173"></a><span id="l15.173" class="difflineplus">+</span>
<a href="#l15.174"></a><span id="l15.174" class="difflineplus">+        removeCalendar(calendar) {</span>
<a href="#l15.175"></a><span id="l15.175" class="difflineplus">+            const index = this.findIndexById(calendar.id);</span>
<a href="#l15.176"></a><span id="l15.176">             if (index &lt; this.mCalendarHeaderIndex) {</span>
<a href="#l15.177"></a><span id="l15.177">                 this.mCalendarHeaderIndex--;</span>
<a href="#l15.178"></a><span id="l15.178">             }</span>
<a href="#l15.179"></a><span id="l15.179">             if (index &lt; this.mTasksHeaderIndex) {</span>
<a href="#l15.180"></a><span id="l15.180">                 this.mTasksHeaderIndex--;</span>
<a href="#l15.181"></a><span id="l15.181">             }</span>
<a href="#l15.182"></a><span id="l15.182" class="difflineminus">-            return this.__proto__.__proto__.removeCalendar.call(this, aCalendar);</span>
<a href="#l15.183"></a><span id="l15.183" class="difflineminus">-        ]]&gt;&lt;/body&gt;</span>
<a href="#l15.184"></a><span id="l15.184" class="difflineminus">-      &lt;/method&gt;</span>
<a href="#l15.185"></a><span id="l15.185" class="difflineplus">+            return this.__proto__.__proto__.removeCalendar.call(this, calendar);</span>
<a href="#l15.186"></a><span id="l15.186" class="difflineplus">+        }</span>
<a href="#l15.187"></a><span id="l15.187"> </span>
<a href="#l15.188"></a><span id="l15.188" class="difflineminus">-      &lt;method name=&quot;clear&quot;&gt;</span>
<a href="#l15.189"></a><span id="l15.189" class="difflineminus">-        &lt;body&gt;&lt;![CDATA[</span>
<a href="#l15.190"></a><span id="l15.190" class="difflineminus">-            let calendars = this.mCalendarList.concat([]);</span>
<a href="#l15.191"></a><span id="l15.191" class="difflineplus">+        clear() {</span>
<a href="#l15.192"></a><span id="l15.192" class="difflineplus">+            const calendars = this.mCalendarList.concat([]);</span>
<a href="#l15.193"></a><span id="l15.193">             calendars.forEach(this.removeCalendar, this);</span>
<a href="#l15.194"></a><span id="l15.194" class="difflineminus">-        ]]&gt;&lt;/body&gt;</span>
<a href="#l15.195"></a><span id="l15.195" class="difflineminus">-      &lt;/method&gt;</span>
<a href="#l15.196"></a><span id="l15.196" class="difflineplus">+        }</span>
<a href="#l15.197"></a><span id="l15.197"> </span>
<a href="#l15.198"></a><span id="l15.198" class="difflineminus">-      &lt;method name=&quot;getRowProperties&quot;&gt;</span>
<a href="#l15.199"></a><span id="l15.199" class="difflineminus">-        &lt;parameter name=&quot;aRow&quot;/&gt;</span>
<a href="#l15.200"></a><span id="l15.200" class="difflineminus">-        &lt;parameter name=&quot;aProps&quot;/&gt;</span>
<a href="#l15.201"></a><span id="l15.201" class="difflineminus">-        &lt;body&gt;&lt;![CDATA[</span>
<a href="#l15.202"></a><span id="l15.202" class="difflineminus">-            let props = this.__proto__.__proto__.getRowProperties.call(this, aRow, aProps);</span>
<a href="#l15.203"></a><span id="l15.203" class="difflineminus">-            let calendar = this.getCalendar(aRow);</span>
<a href="#l15.204"></a><span id="l15.204" class="difflineplus">+        getRowProperties(row, props) {</span>
<a href="#l15.205"></a><span id="l15.205" class="difflineplus">+            const calendar = this.getCalendar(row);</span>
<a href="#l15.206"></a><span id="l15.206" class="difflineplus">+            let rowProps = this.__proto__.__proto__.getRowProperties.call(this, row, props);</span>
<a href="#l15.207"></a><span id="l15.207"> </span>
<a href="#l15.208"></a><span id="l15.208">             if (calendar.readOnly) {</span>
<a href="#l15.209"></a><span id="l15.209" class="difflineminus">-                if (aProps) {</span>
<a href="#l15.210"></a><span id="l15.210" class="difflineminus">-                    // Compatibility with old tree props code</span>
<a href="#l15.211"></a><span id="l15.211" class="difflineminus">-                    aProps.AppendElement(cal.getAtomFromService(&quot;checked&quot;));</span>
<a href="#l15.212"></a><span id="l15.212" class="difflineplus">+                if (props) {</span>
<a href="#l15.213"></a><span id="l15.213" class="difflineplus">+                    // For compatibility with old tree props code.</span>
<a href="#l15.214"></a><span id="l15.214" class="difflineplus">+                    props.AppendElement(cal.getAtomFromService(&quot;checked&quot;));</span>
<a href="#l15.215"></a><span id="l15.215">                 } else {</span>
<a href="#l15.216"></a><span id="l15.216" class="difflineminus">-                    props += &quot; checked&quot;;</span>
<a href="#l15.217"></a><span id="l15.217" class="difflineplus">+                    rowProps += &quot; checked&quot;;</span>
<a href="#l15.218"></a><span id="l15.218">                 }</span>
<a href="#l15.219"></a><span id="l15.219">             }</span>
<a href="#l15.220"></a><span id="l15.220" class="difflineminus">-</span>
<a href="#l15.221"></a><span id="l15.221" class="difflineminus">-            return props;</span>
<a href="#l15.222"></a><span id="l15.222" class="difflineminus">-        ]]&gt;&lt;/body&gt;</span>
<a href="#l15.223"></a><span id="l15.223" class="difflineminus">-      &lt;/method&gt;</span>
<a href="#l15.224"></a><span id="l15.224" class="difflineplus">+            return rowProps;</span>
<a href="#l15.225"></a><span id="l15.225" class="difflineplus">+        }</span>
<a href="#l15.226"></a><span id="l15.226"> </span>
<a href="#l15.227"></a><span id="l15.227" class="difflineminus">-      &lt;method name=&quot;isContainerEmpty&quot;&gt;</span>
<a href="#l15.228"></a><span id="l15.228" class="difflineminus">-        &lt;parameter name=&quot;aRow&quot;/&gt;</span>
<a href="#l15.229"></a><span id="l15.229" class="difflineminus">-        &lt;body&gt;&lt;![CDATA[</span>
<a href="#l15.230"></a><span id="l15.230" class="difflineminus">-            return (aRow == this.mCalendarHeaderIndex &amp;&amp;</span>
<a href="#l15.231"></a><span id="l15.231" class="difflineminus">-                    aRow + 1 == this.mTasksHeaderIndex) ||</span>
<a href="#l15.232"></a><span id="l15.232" class="difflineminus">-                   (aRow == this.mTasksHeaderIndex &amp;&amp;</span>
<a href="#l15.233"></a><span id="l15.233" class="difflineminus">-                    aRow == this.mCalendarList.length);</span>
<a href="#l15.234"></a><span id="l15.234" class="difflineminus">-        ]]&gt;&lt;/body&gt;</span>
<a href="#l15.235"></a><span id="l15.235" class="difflineminus">-      &lt;/method&gt;</span>
<a href="#l15.236"></a><span id="l15.236" class="difflineplus">+        isContainerEmpty(row) {</span>
<a href="#l15.237"></a><span id="l15.237" class="difflineplus">+            return (row == this.mCalendarHeaderIndex &amp;&amp;</span>
<a href="#l15.238"></a><span id="l15.238" class="difflineplus">+                    row + 1 == this.mTasksHeaderIndex) ||</span>
<a href="#l15.239"></a><span id="l15.239" class="difflineplus">+                (row == this.mTasksHeaderIndex &amp;&amp;</span>
<a href="#l15.240"></a><span id="l15.240" class="difflineplus">+                    row == this.mCalendarList.length);</span>
<a href="#l15.241"></a><span id="l15.241" class="difflineplus">+        }</span>
<a href="#l15.242"></a><span id="l15.242"> </span>
<a href="#l15.243"></a><span id="l15.243" class="difflineminus">-      &lt;method name=&quot;isContainer&quot;&gt;</span>
<a href="#l15.244"></a><span id="l15.244" class="difflineminus">-        &lt;parameter name=&quot;aRow&quot;/&gt;</span>
<a href="#l15.245"></a><span id="l15.245" class="difflineminus">-        &lt;body&gt;&lt;![CDATA[</span>
<a href="#l15.246"></a><span id="l15.246" class="difflineminus">-            let calendar = this.getCalendar(aRow);</span>
<a href="#l15.247"></a><span id="l15.247" class="difflineplus">+        isContainer(row) {</span>
<a href="#l15.248"></a><span id="l15.248" class="difflineplus">+            const calendar = this.getCalendar(row);</span>
<a href="#l15.249"></a><span id="l15.249">             return (calendar.type == &quot;memory&quot; &amp;&amp; calendar.uri.schemeIs(&quot;dummy&quot;));</span>
<a href="#l15.250"></a><span id="l15.250" class="difflineminus">-        ]]&gt;&lt;/body&gt;</span>
<a href="#l15.251"></a><span id="l15.251" class="difflineminus">-      &lt;/method&gt;</span>
<a href="#l15.252"></a><span id="l15.252" class="difflineplus">+        }</span>
<a href="#l15.253"></a><span id="l15.253"> </span>
<a href="#l15.254"></a><span id="l15.254" class="difflineminus">-      &lt;method name=&quot;isContainerOpen&quot;&gt;</span>
<a href="#l15.255"></a><span id="l15.255" class="difflineminus">-        &lt;parameter name=&quot;aRow&quot;/&gt;</span>
<a href="#l15.256"></a><span id="l15.256" class="difflineminus">-        &lt;body&gt;&lt;![CDATA[</span>
<a href="#l15.257"></a><span id="l15.257" class="difflineplus">+        isContainerOpen(row) {</span>
<a href="#l15.258"></a><span id="l15.258">             return true;</span>
<a href="#l15.259"></a><span id="l15.259" class="difflineminus">-        ]]&gt;&lt;/body&gt;</span>
<a href="#l15.260"></a><span id="l15.260" class="difflineminus">-      &lt;/method&gt;</span>
<a href="#l15.261"></a><span id="l15.261" class="difflineplus">+        }</span>
<a href="#l15.262"></a><span id="l15.262"> </span>
<a href="#l15.263"></a><span id="l15.263" class="difflineminus">-      &lt;method name=&quot;getParentIndex&quot;&gt;</span>
<a href="#l15.264"></a><span id="l15.264" class="difflineminus">-        &lt;parameter name=&quot;aRow&quot;/&gt;</span>
<a href="#l15.265"></a><span id="l15.265" class="difflineminus">-        &lt;body&gt;&lt;![CDATA[</span>
<a href="#l15.266"></a><span id="l15.266" class="difflineminus">-            let calendar = this.getCalendar(aRow);</span>
<a href="#l15.267"></a><span id="l15.267" class="difflineplus">+        getParentIndex(row) {</span>
<a href="#l15.268"></a><span id="l15.268" class="difflineplus">+            const calendar = this.getCalendar(row);</span>
<a href="#l15.269"></a><span id="l15.269">             if (calendar.uri.path.includes(&quot;?calendar&quot;)) {</span>
<a href="#l15.270"></a><span id="l15.270">                 return this.mCalendarHeaderIndex;</span>
<a href="#l15.271"></a><span id="l15.271">             } else if (calendar.uri.path.includes(&quot;?tasks&quot;)) {</span>
<a href="#l15.272"></a><span id="l15.272">                 return this.mTasksHeaderIndex;</span>
<a href="#l15.273"></a><span id="l15.273">             } else {</span>
<a href="#l15.274"></a><span id="l15.274">                 return -1;</span>
<a href="#l15.275"></a><span id="l15.275">             }</span>
<a href="#l15.276"></a><span id="l15.276" class="difflineminus">-        ]]&gt;&lt;/body&gt;</span>
<a href="#l15.277"></a><span id="l15.277" class="difflineminus">-      &lt;/method&gt;</span>
<a href="#l15.278"></a><span id="l15.278" class="difflineplus">+        }</span>
<a href="#l15.279"></a><span id="l15.279"> </span>
<a href="#l15.280"></a><span id="l15.280" class="difflineminus">-      &lt;method name=&quot;hasNextSibling&quot;&gt;</span>
<a href="#l15.281"></a><span id="l15.281" class="difflineminus">-        &lt;parameter name=&quot;aRow&quot;/&gt;</span>
<a href="#l15.282"></a><span id="l15.282" class="difflineminus">-        &lt;parameter name=&quot;aAfterIndex&quot;/&gt;</span>
<a href="#l15.283"></a><span id="l15.283" class="difflineminus">-        &lt;body&gt;&lt;![CDATA[</span>
<a href="#l15.284"></a><span id="l15.284" class="difflineminus">-            if (aRow == this.mCalendarHeaderIndex) {</span>
<a href="#l15.285"></a><span id="l15.285" class="difflineminus">-                return aAfterIndex &lt; this.mTasksHeaderIndex;</span>
<a href="#l15.286"></a><span id="l15.286" class="difflineminus">-            } else if (aRow == this.mTasksHeaderIndex) {</span>
<a href="#l15.287"></a><span id="l15.287" class="difflineplus">+        hasNextSibling(row, afterIndex) {</span>
<a href="#l15.288"></a><span id="l15.288" class="difflineplus">+            if (row == this.mCalendarHeaderIndex) {</span>
<a href="#l15.289"></a><span id="l15.289" class="difflineplus">+                return afterIndex &lt; this.mTasksHeaderIndex;</span>
<a href="#l15.290"></a><span id="l15.290" class="difflineplus">+            } else if (row == this.mTasksHeaderIndex) {</span>
<a href="#l15.291"></a><span id="l15.291">                 return false;</span>
<a href="#l15.292"></a><span id="l15.292">             } else {</span>
<a href="#l15.293"></a><span id="l15.293" class="difflineminus">-                return aAfterIndex != this.mCalendarHeaderIndex - 1 &amp;&amp;</span>
<a href="#l15.294"></a><span id="l15.294" class="difflineminus">-                       aAfterIndex != this.mTasksHeaderIndex - 1;</span>
<a href="#l15.295"></a><span id="l15.295" class="difflineplus">+                return afterIndex != this.mCalendarHeaderIndex - 1 &amp;&amp;</span>
<a href="#l15.296"></a><span id="l15.296" class="difflineplus">+                    afterIndex != this.mTasksHeaderIndex - 1;</span>
<a href="#l15.297"></a><span id="l15.297">             }</span>
<a href="#l15.298"></a><span id="l15.298" class="difflineminus">-        ]]&gt;&lt;/body&gt;</span>
<a href="#l15.299"></a><span id="l15.299" class="difflineminus">-      &lt;/method&gt;</span>
<a href="#l15.300"></a><span id="l15.300" class="difflineplus">+        }</span>
<a href="#l15.301"></a><span id="l15.301"> </span>
<a href="#l15.302"></a><span id="l15.302" class="difflineminus">-      &lt;method name=&quot;cycleCell&quot;&gt;</span>
<a href="#l15.303"></a><span id="l15.303" class="difflineminus">-        &lt;parameter name=&quot;aRow&quot;/&gt;</span>
<a href="#l15.304"></a><span id="l15.304" class="difflineminus">-        &lt;parameter name=&quot;aCol&quot;/&gt;</span>
<a href="#l15.305"></a><span id="l15.305" class="difflineminus">-        &lt;body&gt;&lt;![CDATA[</span>
<a href="#l15.306"></a><span id="l15.306" class="difflineminus">-            let calendar = this.getCalendar(aRow);</span>
<a href="#l15.307"></a><span id="l15.307" class="difflineminus">-            let composite = this.compositeCalendar;</span>
<a href="#l15.308"></a><span id="l15.308" class="difflineplus">+        cycleCell(row, col) {</span>
<a href="#l15.309"></a><span id="l15.309" class="difflineplus">+            const calendar = this.getCalendar(row);</span>
<a href="#l15.310"></a><span id="l15.310" class="difflineplus">+            const composite = this.compositeCalendar;</span>
<a href="#l15.311"></a><span id="l15.311">             if (composite.getCalendarById(calendar.id)) {</span>
<a href="#l15.312"></a><span id="l15.312">                 composite.removeCalendar(calendar);</span>
<a href="#l15.313"></a><span id="l15.313">             } else {</span>
<a href="#l15.314"></a><span id="l15.314">                 composite.addCalendar(calendar);</span>
<a href="#l15.315"></a><span id="l15.315">             }</span>
<a href="#l15.316"></a><span id="l15.316" class="difflineminus">-            this.treebox.invalidateRow(aRow);</span>
<a href="#l15.317"></a><span id="l15.317" class="difflineminus">-        ]]&gt;&lt;/body&gt;</span>
<a href="#l15.318"></a><span id="l15.318" class="difflineminus">-      &lt;/method&gt;</span>
<a href="#l15.319"></a><span id="l15.319" class="difflineplus">+            this.tree.invalidateRow(row);</span>
<a href="#l15.320"></a><span id="l15.320" class="difflineplus">+        }</span>
<a href="#l15.321"></a><span id="l15.321"> </span>
<a href="#l15.322"></a><span id="l15.322" class="difflineminus">-      &lt;method name=&quot;getLevel&quot;&gt;</span>
<a href="#l15.323"></a><span id="l15.323" class="difflineminus">-        &lt;parameter name=&quot;aRow&quot;/&gt;</span>
<a href="#l15.324"></a><span id="l15.324" class="difflineminus">-        &lt;body&gt;&lt;![CDATA[</span>
<a href="#l15.325"></a><span id="l15.325" class="difflineminus">-            return this.isContainer(aRow) ? 0 : 1;</span>
<a href="#l15.326"></a><span id="l15.326" class="difflineminus">-        ]]&gt;&lt;/body&gt;</span>
<a href="#l15.327"></a><span id="l15.327" class="difflineminus">-      &lt;/method&gt;</span>
<a href="#l15.328"></a><span id="l15.328" class="difflineminus">-    &lt;/implementation&gt;</span>
<a href="#l15.329"></a><span id="l15.329" class="difflineminus">-  &lt;/binding&gt;</span>
<a href="#l15.330"></a><span id="l15.330" class="difflineminus">-&lt;/bindings&gt;</span>
<a href="#l15.331"></a><span id="l15.331" class="difflineplus">+        getLevel(row) {</span>
<a href="#l15.332"></a><span id="l15.332" class="difflineplus">+            return this.isContainer(row) ? 0 : 1;</span>
<a href="#l15.333"></a><span id="l15.333" class="difflineplus">+        }</span>
<a href="#l15.334"></a><span id="l15.334" class="difflineplus">+    }</span>
<a href="#l15.335"></a><span id="l15.335" class="difflineplus">+</span>
<a href="#l15.336"></a><span id="l15.336" class="difflineplus">+    customElements.define(&quot;calendar-list-tree-gdata&quot;, CalendarListTreeGdata, { &quot;extends&quot;: &quot;tree&quot; });</span>
<a href="#l15.337"></a><span id="l15.337" class="difflineplus">+}</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l16.1"></a><span id="l16.1" class="difflineminus">--- a/calendar/providers/gdata/jar.mn</span>
<a href="#l16.2"></a><span id="l16.2" class="difflineplus">+++ b/calendar/providers/gdata/jar.mn</span>
<a href="#l16.3"></a><span id="l16.3" class="difflineat">@@ -22,17 +22,18 @@ gdata-provider.jar:</span>
<a href="#l16.4"></a><span id="l16.4">     content/gdata-calendar-creation.xul          (content/gdata-calendar-creation.xul)</span>
<a href="#l16.5"></a><span id="l16.5">     content/gdata-calendar-creation.js           (content/gdata-calendar-creation.js)</span>
<a href="#l16.6"></a><span id="l16.6">     content/gdata-event-dialog.xul               (content/gdata-event-dialog.xul)</span>
<a href="#l16.7"></a><span id="l16.7">     content/gdata-event-dialog.js                (content/gdata-event-dialog.js)</span>
<a href="#l16.8"></a><span id="l16.8">     content/gdata-calendar-properties.xul        (content/gdata-calendar-properties.xul)</span>
<a href="#l16.9"></a><span id="l16.9">     content/gdata-calendar-properties.js         (content/gdata-calendar-properties.js)</span>
<a href="#l16.10"></a><span id="l16.10">     content/gdata-event-dialog-reminder.xul      (content/gdata-event-dialog-reminder.xul)</span>
<a href="#l16.11"></a><span id="l16.11">     content/gdata-event-dialog-reminder.js       (content/gdata-event-dialog-reminder.js)</span>
<a href="#l16.12"></a><span id="l16.12" class="difflineminus">-    content/gdata-list-tree.xml                  (content/gdata-list-tree.xml)</span>
<a href="#l16.13"></a><span id="l16.13" class="difflineplus">+    content/calendar-list-tree.js                (../../base/content/widgets/calendar-list-tree.js)</span>
<a href="#l16.14"></a><span id="l16.14" class="difflineplus">+    content/gdata-list-tree.js                   (content/gdata-list-tree.js)</span>
<a href="#l16.15"></a><span id="l16.15">     content/gdata-lightning-item-iframe.xul      (content/gdata-lightning-item-iframe.xul)</span>
<a href="#l16.16"></a><span id="l16.16">     content/gdata-lightning-item-iframe.js       (content/gdata-lightning-item-iframe.js)</span>
<a href="#l16.17"></a><span id="l16.17">     content/gdata-lightning-item-toolbar.xul     (content/gdata-lightning-item-toolbar.xul)</span>
<a href="#l16.18"></a><span id="l16.18">     content/gdata-migration.js                   (content/gdata-migration.js)</span>
<a href="#l16.19"></a><span id="l16.19">     content/gdata-migration-overlay.xul          (content/gdata-migration-overlay.xul)</span>
<a href="#l16.20"></a><span id="l16.20">     content/gdata-migration-wizard.xul           (content/gdata-migration-wizard.xul)</span>
<a href="#l16.21"></a><span id="l16.21">     content/gcal.png                             (content/gcal.png)</span>
<a href="#l16.22"></a><span id="l16.22"> % skin gdata-provider classic/1.0 %skin/</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l17.1"></a><span id="l17.1" class="difflineminus">--- a/calendar/test/mozmill/shared-modules/test-calendar-utils.js</span>
<a href="#l17.2"></a><span id="l17.2" class="difflineplus">+++ b/calendar/test/mozmill/shared-modules/test-calendar-utils.js</span>
<a href="#l17.3"></a><span id="l17.3" class="difflineat">@@ -46,18 +46,17 @@ var MINIMONTH = `</span>
<a href="#l17.4"></a><span id="l17.4">     ${CALENDAR_PANEL}/id(&quot;ltnSidebar&quot;)/id(&quot;minimonth-pane&quot;)/{&quot;align&quot;:&quot;center&quot;}/</span>
<a href="#l17.5"></a><span id="l17.5">     id(&quot;calMinimonthBox&quot;)/id(&quot;calMinimonth&quot;)</span>
<a href="#l17.6"></a><span id="l17.6"> `;</span>
<a href="#l17.7"></a><span id="l17.7"> var TODAY_BUTTON = `</span>
<a href="#l17.8"></a><span id="l17.8">     ${MINIMONTH}/anon({&quot;anonid&quot;:&quot;minimonth-header&quot;})/anon({&quot;anonid&quot;:&quot;today-button&quot;})</span>
<a href="#l17.9"></a><span id="l17.9"> `;</span>
<a href="#l17.10"></a><span id="l17.10"> var CALENDARLIST = `</span>
<a href="#l17.11"></a><span id="l17.11">     ${CALENDAR_PANEL}/id(&quot;ltnSidebar&quot;)/id(&quot;calendar-panel&quot;)/id(&quot;calendar-list-pane&quot;)/</span>
<a href="#l17.12"></a><span id="l17.12" class="difflineminus">-    id(&quot;calendar-listtree-pane&quot;)/id(&quot;calendar-list-tree-widget&quot;)/</span>
<a href="#l17.13"></a><span id="l17.13" class="difflineminus">-    anon({&quot;anonid&quot;:&quot;tree&quot;})/anon({&quot;anonid&quot;:&quot;treechildren&quot;})</span>
<a href="#l17.14"></a><span id="l17.14" class="difflineplus">+    id(&quot;calendar-listtree-pane&quot;)/id(&quot;calendar-list-tree-widget&quot;)/{&quot;class&quot;:&quot;treechildren&quot;}</span>
<a href="#l17.15"></a><span id="l17.15"> `;</span>
<a href="#l17.16"></a><span id="l17.16"> var TODAY_PANE = `</span>
<a href="#l17.17"></a><span id="l17.17">     /id(&quot;messengerWindow&quot;)/id(&quot;tabmail-container&quot;)/id(&quot;today-pane-panel&quot;)</span>
<a href="#l17.18"></a><span id="l17.18"> `;</span>
<a href="#l17.19"></a><span id="l17.19"> var AGENDA_LISTBOX = `</span>
<a href="#l17.20"></a><span id="l17.20">     ${TODAY_PANE}/{&quot;flex&quot;:&quot;1&quot;}/id(&quot;agenda-panel&quot;)/{&quot;flex&quot;:&quot;1&quot;}/id(&quot;agenda-listbox&quot;)</span>
<a href="#l17.21"></a><span id="l17.21"> `;</span>
<a href="#l17.22"></a><span id="l17.22"> </span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l18.1"></a><span id="l18.1" class="difflineminus">--- a/calendar/test/mozmill/testBasicFunctionality.js</span>
<a href="#l18.2"></a><span id="l18.2" class="difflineplus">+++ b/calendar/test/mozmill/testBasicFunctionality.js</span>
<a href="#l18.3"></a><span id="l18.3" class="difflineat">@@ -80,15 +80,15 @@ function testSmokeTest() {</span>
<a href="#l18.4"></a><span id="l18.4">     `));</span>
<a href="#l18.5"></a><span id="l18.5"> </span>
<a href="#l18.6"></a><span id="l18.6">     // Create test calendar.</span>
<a href="#l18.7"></a><span id="l18.7">     plan_for_modal_dialog(&quot;Calendar:NewCalendarWizard&quot;, (wizard) =&gt; {</span>
<a href="#l18.8"></a><span id="l18.8">         handleNewCalendarWizard(wizard, CALENDARNAME);</span>
<a href="#l18.9"></a><span id="l18.9">     });</span>
<a href="#l18.10"></a><span id="l18.10">     let calendarList = lookup(CALENDARLIST);</span>
<a href="#l18.11"></a><span id="l18.11">     // Double click on bottom left.</span>
<a href="#l18.12"></a><span id="l18.12" class="difflineminus">-    controller.doubleClick(calendarList, 0, calendarList.getNode().getBoundingClientRect().height);</span>
<a href="#l18.13"></a><span id="l18.13" class="difflineplus">+    controller.doubleClick(calendarList, 0, calendarList.getNode().height);</span>
<a href="#l18.14"></a><span id="l18.14">     wait_for_modal_dialog(&quot;Calendar:NewCalendarWizard&quot;, TIMEOUT_MODAL_DIALOG);</span>
<a href="#l18.15"></a><span id="l18.15"> }</span>
<a href="#l18.16"></a><span id="l18.16"> </span>
<a href="#l18.17"></a><span id="l18.17"> function teardownTest(module) {</span>
<a href="#l18.18"></a><span id="l18.18">     deleteCalendars(controller, CALENDARNAME);</span>
<a href="#l18.19"></a><span id="l18.19"> }</span></pre></div></div>

<div class="page_footer">
<div class="page_footer_text">comm-central</div>
<div class="page_footer_text" style="padding-left: 10px">Deployed from <a href="https://hg.mozilla.org/hgcustom/version-control-tools/rev/4b0de666d1a4">4b0de666d1a4</a> at 2020-07-30T19:32:33Z.</div>
<div class="rss_logo">
<a href="/comm-central/rss-log">RSS</a>
<a href="/comm-central/atom-log">Atom</a>
</div>
<br />

</div>
</body>
</html>

