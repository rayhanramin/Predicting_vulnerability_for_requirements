<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en-US" lang="en-US">
<head>
<link rel="icon" href="/static/35f393d6769a/hgicon.png" type="image/png" />
<meta name="robots" content="index, nofollow"/>
<link rel="stylesheet" href="/static/35f393d6769a/style-gitweb.css" type="text/css" />

<style type="text/css">
div.feed {
  float: right;
}
a img {
  border-width: 0px;
}
div.log_link {
  width: 80px;
  background-color: white;
}

div.log_body {
  padding-left: 96px;
}
</style>
<script type="text/javascript" src="/static/35f393d6769a/mercurial.js"></script>

<meta property="og:image" content="/static/35f393d6769a/moz-logo-bw-rgb.svg"/>
<meta property="og:type" content="website"/>

<title>comm-central: changeset 12232:0b0ff12d6f09c18c6c0ae7bf32f2561c9dada750</title>
<link rel="alternate" type="application/atom+xml"
   href="/comm-central/atom-log" title="Atom feed for comm-central"/>
<link rel="alternate" type="application/rss+xml"
   href="/comm-central/rss-log" title="RSS feed for comm-central"/>

<meta property="og:title" content="comm-central @ 0b0ff12d6f09c18c6c0ae7bf32f2561c9dada750" />
<meta property="og:url" content="/comm-central/rev/0b0ff12d6f09c18c6c0ae7bf32f2561c9dada750" />
<meta property="og:description" content="Bug 852690 - Remaining conversion to mailServices.js in /mail/ and /mailnews/: search. r=Standard8" />

</head>
<body>

<div class="page_header">
<div class="logo">
    <a href="https://developer.mozilla.org/en/docs/Mercurial">
        <img src="/static/35f393d6769a/moz-logo-bw-rgb.svg" alt="mercurial" />
    </a>
</div>
<a href="/">Mercurial</a> &gt; <a href="/comm-central">comm-central</a>  / changeset / 0b0ff12d6f09c18c6c0ae7bf32f2561c9dada750 
</div>

<div class="page_nav">
<div>
<a href="/comm-central/summary">summary</a> |
<a href="/comm-central/shortlog/0b0ff12d6f09c18c6c0ae7bf32f2561c9dada750">shortlog</a> |
<a href="/comm-central/log/0b0ff12d6f09c18c6c0ae7bf32f2561c9dada750">changelog</a> |
<a href="/comm-central/pushloghtml">pushlog</a> |
<a href="/comm-central/graph/0b0ff12d6f09c18c6c0ae7bf32f2561c9dada750">graph</a> |
<a href="/comm-central/tags">tags</a> |
<a href="/comm-central/bookmarks">bookmarks</a> |
<a href="/comm-central/branches">branches</a> |
<a href="/comm-central/file/0b0ff12d6f09c18c6c0ae7bf32f2561c9dada750">files</a> |
changeset |
<a href="/comm-central/raw-rev/0b0ff12d6f09c18c6c0ae7bf32f2561c9dada750">raw</a>  | <a href="/comm-central/archive/0b0ff12d6f09c18c6c0ae7bf32f2561c9dada750.zip">zip</a>  |
<a href="/comm-central/help">help</a>
</div>

<div class="search">
<form id="searchform" action="/comm-central/log">

<input name="rev" type="text" value="" size="40" />
<div id="hint">Find changesets by keywords (author, files, the commit message), revision
number or hash, or <a href="/comm-central/help/revsets">revset expression</a>.</div>
</form>
</div>
</div>

<div class="title">
<a href="https://bugzilla.mozilla.org/show_bug.cgi?id=852690">Bug 852690</a> - Remaining conversion to mailServices.js in /mail/ and /mailnews/: search. r=Standard8
<span class="logtags"></span>
</div>
<div class="title_text">
<table cellspacing="0">

<tr><td>author</td><td>&#83;&#101;&#98;&#97;&#115;&#116;&#105;&#97;&#110;&#32;&#72;&#101;&#110;&#103;&#115;&#116;&#32;&#60;&#97;&#114;&#99;&#104;&#97;&#101;&#111;&#112;&#116;&#101;&#114;&#121;&#120;&#64;&#99;&#111;&#111;&#108;&#101;&#45;&#102;&#105;&#108;&#101;&#115;&#46;&#100;&#101;&#62;</td></tr>
<tr><td></td><td class="date age">Fri, 29 Mar 2013 11:02:22 +0100</td></tr>

<tr>
 <td>changeset 12232</td>
 <td style="font-family:monospace"><a class="list" href="/comm-central/rev/0b0ff12d6f09c18c6c0ae7bf32f2561c9dada750">0b0ff12d6f09c18c6c0ae7bf32f2561c9dada750</a></td>
</tr>



<tr>
<td>parent 12231</td>
<td style="font-family:monospace">
<a class="list" href="/comm-central/rev/e650ba2dd55273a3ffd491ae678972bcbe564664">e650ba2dd55273a3ffd491ae678972bcbe564664</a>
</td>
</tr>

<tr>
<td>child 12233</td>
<td style="font-family:monospace">
<a class="list" href="/comm-central/rev/0e410a62d2d81576f3fe043548d65cd73ab8af03">0e410a62d2d81576f3fe043548d65cd73ab8af03</a>
</td>
</tr>
<tr><td>push id</td><td><a href="/comm-central/pushloghtml?changeset=0b0ff12d6f09c18c6c0ae7bf32f2561c9dada750">9052</a></td></tr>
<tr><td>push user</td><td>ryanvm@gmail.com</td></tr>
<tr><td>push date</td><td class="date age">Fri, 29 Mar 2013 18:51:13 +0000</td></tr>

<tr><td>treeherder</td><td>comm-central@0e410a62d2d8 [<a href="https://treeherder.mozilla.org/#/jobs?repo=comm-central&revision=0e410a62d2d81576f3fe043548d65cd73ab8af03">default view</a>] [<a href="https://treeherder.mozilla.org/#/jobs?repo=comm-central&revision=0e410a62d2d81576f3fe043548d65cd73ab8af03&filter-resultStatus=testfailed&filter-resultStatus=busted&filter-resultStatus=exception">failures only]</td></tr>
<tr><td>perfherder</td><td>[<a href="https://treeherder.mozilla.org/perf.html#/compare?originalProject=comm-central&originalRevision=0e410a62d2d81576f3fe043548d65cd73ab8af03&newProject=comm-central&newRevision=006a18264170c6b44c66df01a863303f605343bf&framework=1" target="_blank">talos</a>] [<a href="https://treeherder.mozilla.org/perf.html#/compare?originalProject=comm-central&originalRevision=0e410a62d2d81576f3fe043548d65cd73ab8af03&newProject=comm-central&newRevision=006a18264170c6b44c66df01a863303f605343bf&framework=2" target="_blank">build metrics</a>] [<a href="https://treeherder.mozilla.org/perf.html#/compare?originalProject=comm-central&originalRevision=0e410a62d2d81576f3fe043548d65cd73ab8af03&newProject=comm-central&newRevision=006a18264170c6b44c66df01a863303f605343bf&framework=6" target="_blank">platform microbench</a>] (compared to previous push)</td></tr>
<tr><td>reviewers</td><td><a href="/comm-central/log?rev=reviewer%28Standard8%29&revcount=50">Standard8</a></td></tr>
<tr><td>bugs</td><td><a href="https://bugzilla.mozilla.org/show_bug.cgi?id=852690">852690</a></td></tr>




</table></div>

<div class="page_body description"><a href="https://bugzilla.mozilla.org/show_bug.cgi?id=852690">Bug 852690</a> - Remaining conversion to mailServices.js in /mail/ and /mailnews/: search. r=Standard8</div>
<div class="list_head"></div>
<div class="title_text">
<table cellspacing="0">

<tr class="parity0">
<td><a class="list" href="/comm-central/diff/0b0ff12d6f09c18c6c0ae7bf32f2561c9dada750/mail/base/content/quickFilterBar.js">mail/base/content/quickFilterBar.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/0b0ff12d6f09c18c6c0ae7bf32f2561c9dada750/mail/base/content/quickFilterBar.js">file</a> |
<a href="/comm-central/annotate/0b0ff12d6f09c18c6c0ae7bf32f2561c9dada750/mail/base/content/quickFilterBar.js">annotate</a> |
<a href="/comm-central/diff/0b0ff12d6f09c18c6c0ae7bf32f2561c9dada750/mail/base/content/quickFilterBar.js">diff</a> |
<a href="/comm-central/comparison/0b0ff12d6f09c18c6c0ae7bf32f2561c9dada750/mail/base/content/quickFilterBar.js">comparison</a> |
<a href="/comm-central/log/0b0ff12d6f09c18c6c0ae7bf32f2561c9dada750/mail/base/content/quickFilterBar.js">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/0b0ff12d6f09c18c6c0ae7bf32f2561c9dada750/mail/base/modules/quickFilterManager.js">mail/base/modules/quickFilterManager.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/0b0ff12d6f09c18c6c0ae7bf32f2561c9dada750/mail/base/modules/quickFilterManager.js">file</a> |
<a href="/comm-central/annotate/0b0ff12d6f09c18c6c0ae7bf32f2561c9dada750/mail/base/modules/quickFilterManager.js">annotate</a> |
<a href="/comm-central/diff/0b0ff12d6f09c18c6c0ae7bf32f2561c9dada750/mail/base/modules/quickFilterManager.js">diff</a> |
<a href="/comm-central/comparison/0b0ff12d6f09c18c6c0ae7bf32f2561c9dada750/mail/base/modules/quickFilterManager.js">comparison</a> |
<a href="/comm-central/log/0b0ff12d6f09c18c6c0ae7bf32f2561c9dada750/mail/base/modules/quickFilterManager.js">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/0b0ff12d6f09c18c6c0ae7bf32f2561c9dada750/mail/base/modules/searchSpec.js">mail/base/modules/searchSpec.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/0b0ff12d6f09c18c6c0ae7bf32f2561c9dada750/mail/base/modules/searchSpec.js">file</a> |
<a href="/comm-central/annotate/0b0ff12d6f09c18c6c0ae7bf32f2561c9dada750/mail/base/modules/searchSpec.js">annotate</a> |
<a href="/comm-central/diff/0b0ff12d6f09c18c6c0ae7bf32f2561c9dada750/mail/base/modules/searchSpec.js">diff</a> |
<a href="/comm-central/comparison/0b0ff12d6f09c18c6c0ae7bf32f2561c9dada750/mail/base/modules/searchSpec.js">comparison</a> |
<a href="/comm-central/log/0b0ff12d6f09c18c6c0ae7bf32f2561c9dada750/mail/base/modules/searchSpec.js">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/0b0ff12d6f09c18c6c0ae7bf32f2561c9dada750/mail/base/test/unit/test_viewWrapper_virtualFolderCustomTerm.js">mail/base/test/unit/test_viewWrapper_virtualFolderCustomTerm.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/0b0ff12d6f09c18c6c0ae7bf32f2561c9dada750/mail/base/test/unit/test_viewWrapper_virtualFolderCustomTerm.js">file</a> |
<a href="/comm-central/annotate/0b0ff12d6f09c18c6c0ae7bf32f2561c9dada750/mail/base/test/unit/test_viewWrapper_virtualFolderCustomTerm.js">annotate</a> |
<a href="/comm-central/diff/0b0ff12d6f09c18c6c0ae7bf32f2561c9dada750/mail/base/test/unit/test_viewWrapper_virtualFolderCustomTerm.js">diff</a> |
<a href="/comm-central/comparison/0b0ff12d6f09c18c6c0ae7bf32f2561c9dada750/mail/base/test/unit/test_viewWrapper_virtualFolderCustomTerm.js">comparison</a> |
<a href="/comm-central/log/0b0ff12d6f09c18c6c0ae7bf32f2561c9dada750/mail/base/test/unit/test_viewWrapper_virtualFolderCustomTerm.js">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/0b0ff12d6f09c18c6c0ae7bf32f2561c9dada750/mail/components/search/content/searchCommon.js">mail/components/search/content/searchCommon.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/0b0ff12d6f09c18c6c0ae7bf32f2561c9dada750/mail/components/search/content/searchCommon.js">file</a> |
<a href="/comm-central/annotate/0b0ff12d6f09c18c6c0ae7bf32f2561c9dada750/mail/components/search/content/searchCommon.js">annotate</a> |
<a href="/comm-central/diff/0b0ff12d6f09c18c6c0ae7bf32f2561c9dada750/mail/components/search/content/searchCommon.js">diff</a> |
<a href="/comm-central/comparison/0b0ff12d6f09c18c6c0ae7bf32f2561c9dada750/mail/components/search/content/searchCommon.js">comparison</a> |
<a href="/comm-central/log/0b0ff12d6f09c18c6c0ae7bf32f2561c9dada750/mail/components/search/content/searchCommon.js">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/0b0ff12d6f09c18c6c0ae7bf32f2561c9dada750/mail/test/mozmill/folder-tree-modes/test-smart-folders.js">mail/test/mozmill/folder-tree-modes/test-smart-folders.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/0b0ff12d6f09c18c6c0ae7bf32f2561c9dada750/mail/test/mozmill/folder-tree-modes/test-smart-folders.js">file</a> |
<a href="/comm-central/annotate/0b0ff12d6f09c18c6c0ae7bf32f2561c9dada750/mail/test/mozmill/folder-tree-modes/test-smart-folders.js">annotate</a> |
<a href="/comm-central/diff/0b0ff12d6f09c18c6c0ae7bf32f2561c9dada750/mail/test/mozmill/folder-tree-modes/test-smart-folders.js">diff</a> |
<a href="/comm-central/comparison/0b0ff12d6f09c18c6c0ae7bf32f2561c9dada750/mail/test/mozmill/folder-tree-modes/test-smart-folders.js">comparison</a> |
<a href="/comm-central/log/0b0ff12d6f09c18c6c0ae7bf32f2561c9dada750/mail/test/mozmill/folder-tree-modes/test-smart-folders.js">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/0b0ff12d6f09c18c6c0ae7bf32f2561c9dada750/mail/test/mozmill/quick-filter-bar/test-filter-logic.js">mail/test/mozmill/quick-filter-bar/test-filter-logic.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/0b0ff12d6f09c18c6c0ae7bf32f2561c9dada750/mail/test/mozmill/quick-filter-bar/test-filter-logic.js">file</a> |
<a href="/comm-central/annotate/0b0ff12d6f09c18c6c0ae7bf32f2561c9dada750/mail/test/mozmill/quick-filter-bar/test-filter-logic.js">annotate</a> |
<a href="/comm-central/diff/0b0ff12d6f09c18c6c0ae7bf32f2561c9dada750/mail/test/mozmill/quick-filter-bar/test-filter-logic.js">diff</a> |
<a href="/comm-central/comparison/0b0ff12d6f09c18c6c0ae7bf32f2561c9dada750/mail/test/mozmill/quick-filter-bar/test-filter-logic.js">comparison</a> |
<a href="/comm-central/log/0b0ff12d6f09c18c6c0ae7bf32f2561c9dada750/mail/test/mozmill/quick-filter-bar/test-filter-logic.js">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/0b0ff12d6f09c18c6c0ae7bf32f2561c9dada750/mailnews/base/test/unit/test_loadVirtualFolders.js">mailnews/base/test/unit/test_loadVirtualFolders.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/0b0ff12d6f09c18c6c0ae7bf32f2561c9dada750/mailnews/base/test/unit/test_loadVirtualFolders.js">file</a> |
<a href="/comm-central/annotate/0b0ff12d6f09c18c6c0ae7bf32f2561c9dada750/mailnews/base/test/unit/test_loadVirtualFolders.js">annotate</a> |
<a href="/comm-central/diff/0b0ff12d6f09c18c6c0ae7bf32f2561c9dada750/mailnews/base/test/unit/test_loadVirtualFolders.js">diff</a> |
<a href="/comm-central/comparison/0b0ff12d6f09c18c6c0ae7bf32f2561c9dada750/mailnews/base/test/unit/test_loadVirtualFolders.js">comparison</a> |
<a href="/comm-central/log/0b0ff12d6f09c18c6c0ae7bf32f2561c9dada750/mailnews/base/test/unit/test_loadVirtualFolders.js">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/0b0ff12d6f09c18c6c0ae7bf32f2561c9dada750/mailnews/base/test/unit/test_search.js">mailnews/base/test/unit/test_search.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/0b0ff12d6f09c18c6c0ae7bf32f2561c9dada750/mailnews/base/test/unit/test_search.js">file</a> |
<a href="/comm-central/annotate/0b0ff12d6f09c18c6c0ae7bf32f2561c9dada750/mailnews/base/test/unit/test_search.js">annotate</a> |
<a href="/comm-central/diff/0b0ff12d6f09c18c6c0ae7bf32f2561c9dada750/mailnews/base/test/unit/test_search.js">diff</a> |
<a href="/comm-central/comparison/0b0ff12d6f09c18c6c0ae7bf32f2561c9dada750/mailnews/base/test/unit/test_search.js">comparison</a> |
<a href="/comm-central/log/0b0ff12d6f09c18c6c0ae7bf32f2561c9dada750/mailnews/base/test/unit/test_search.js">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/0b0ff12d6f09c18c6c0ae7bf32f2561c9dada750/mailnews/base/test/unit/test_searchBody.js">mailnews/base/test/unit/test_searchBody.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/0b0ff12d6f09c18c6c0ae7bf32f2561c9dada750/mailnews/base/test/unit/test_searchBody.js">file</a> |
<a href="/comm-central/annotate/0b0ff12d6f09c18c6c0ae7bf32f2561c9dada750/mailnews/base/test/unit/test_searchBody.js">annotate</a> |
<a href="/comm-central/diff/0b0ff12d6f09c18c6c0ae7bf32f2561c9dada750/mailnews/base/test/unit/test_searchBody.js">diff</a> |
<a href="/comm-central/comparison/0b0ff12d6f09c18c6c0ae7bf32f2561c9dada750/mailnews/base/test/unit/test_searchBody.js">comparison</a> |
<a href="/comm-central/log/0b0ff12d6f09c18c6c0ae7bf32f2561c9dada750/mailnews/base/test/unit/test_searchBody.js">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/0b0ff12d6f09c18c6c0ae7bf32f2561c9dada750/mailnews/base/test/unit/test_searchBoolean.js">mailnews/base/test/unit/test_searchBoolean.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/0b0ff12d6f09c18c6c0ae7bf32f2561c9dada750/mailnews/base/test/unit/test_searchBoolean.js">file</a> |
<a href="/comm-central/annotate/0b0ff12d6f09c18c6c0ae7bf32f2561c9dada750/mailnews/base/test/unit/test_searchBoolean.js">annotate</a> |
<a href="/comm-central/diff/0b0ff12d6f09c18c6c0ae7bf32f2561c9dada750/mailnews/base/test/unit/test_searchBoolean.js">diff</a> |
<a href="/comm-central/comparison/0b0ff12d6f09c18c6c0ae7bf32f2561c9dada750/mailnews/base/test/unit/test_searchBoolean.js">comparison</a> |
<a href="/comm-central/log/0b0ff12d6f09c18c6c0ae7bf32f2561c9dada750/mailnews/base/test/unit/test_searchBoolean.js">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/0b0ff12d6f09c18c6c0ae7bf32f2561c9dada750/mailnews/base/test/unit/test_searchChaining.js">mailnews/base/test/unit/test_searchChaining.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/0b0ff12d6f09c18c6c0ae7bf32f2561c9dada750/mailnews/base/test/unit/test_searchChaining.js">file</a> |
<a href="/comm-central/annotate/0b0ff12d6f09c18c6c0ae7bf32f2561c9dada750/mailnews/base/test/unit/test_searchChaining.js">annotate</a> |
<a href="/comm-central/diff/0b0ff12d6f09c18c6c0ae7bf32f2561c9dada750/mailnews/base/test/unit/test_searchChaining.js">diff</a> |
<a href="/comm-central/comparison/0b0ff12d6f09c18c6c0ae7bf32f2561c9dada750/mailnews/base/test/unit/test_searchChaining.js">comparison</a> |
<a href="/comm-central/log/0b0ff12d6f09c18c6c0ae7bf32f2561c9dada750/mailnews/base/test/unit/test_searchChaining.js">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/0b0ff12d6f09c18c6c0ae7bf32f2561c9dada750/mailnews/base/test/unit/test_searchCustomTerm.js">mailnews/base/test/unit/test_searchCustomTerm.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/0b0ff12d6f09c18c6c0ae7bf32f2561c9dada750/mailnews/base/test/unit/test_searchCustomTerm.js">file</a> |
<a href="/comm-central/annotate/0b0ff12d6f09c18c6c0ae7bf32f2561c9dada750/mailnews/base/test/unit/test_searchCustomTerm.js">annotate</a> |
<a href="/comm-central/diff/0b0ff12d6f09c18c6c0ae7bf32f2561c9dada750/mailnews/base/test/unit/test_searchCustomTerm.js">diff</a> |
<a href="/comm-central/comparison/0b0ff12d6f09c18c6c0ae7bf32f2561c9dada750/mailnews/base/test/unit/test_searchCustomTerm.js">comparison</a> |
<a href="/comm-central/log/0b0ff12d6f09c18c6c0ae7bf32f2561c9dada750/mailnews/base/test/unit/test_searchCustomTerm.js">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/0b0ff12d6f09c18c6c0ae7bf32f2561c9dada750/mailnews/base/test/unit/test_searchJunk.js">mailnews/base/test/unit/test_searchJunk.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/0b0ff12d6f09c18c6c0ae7bf32f2561c9dada750/mailnews/base/test/unit/test_searchJunk.js">file</a> |
<a href="/comm-central/annotate/0b0ff12d6f09c18c6c0ae7bf32f2561c9dada750/mailnews/base/test/unit/test_searchJunk.js">annotate</a> |
<a href="/comm-central/diff/0b0ff12d6f09c18c6c0ae7bf32f2561c9dada750/mailnews/base/test/unit/test_searchJunk.js">diff</a> |
<a href="/comm-central/comparison/0b0ff12d6f09c18c6c0ae7bf32f2561c9dada750/mailnews/base/test/unit/test_searchJunk.js">comparison</a> |
<a href="/comm-central/log/0b0ff12d6f09c18c6c0ae7bf32f2561c9dada750/mailnews/base/test/unit/test_searchJunk.js">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/0b0ff12d6f09c18c6c0ae7bf32f2561c9dada750/mailnews/base/test/unit/test_searchTag.js">mailnews/base/test/unit/test_searchTag.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/0b0ff12d6f09c18c6c0ae7bf32f2561c9dada750/mailnews/base/test/unit/test_searchTag.js">file</a> |
<a href="/comm-central/annotate/0b0ff12d6f09c18c6c0ae7bf32f2561c9dada750/mailnews/base/test/unit/test_searchTag.js">annotate</a> |
<a href="/comm-central/diff/0b0ff12d6f09c18c6c0ae7bf32f2561c9dada750/mailnews/base/test/unit/test_searchTag.js">diff</a> |
<a href="/comm-central/comparison/0b0ff12d6f09c18c6c0ae7bf32f2561c9dada750/mailnews/base/test/unit/test_searchTag.js">comparison</a> |
<a href="/comm-central/log/0b0ff12d6f09c18c6c0ae7bf32f2561c9dada750/mailnews/base/test/unit/test_searchTag.js">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/0b0ff12d6f09c18c6c0ae7bf32f2561c9dada750/mailnews/base/test/unit/test_searchUint32HdrProperty.js">mailnews/base/test/unit/test_searchUint32HdrProperty.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/0b0ff12d6f09c18c6c0ae7bf32f2561c9dada750/mailnews/base/test/unit/test_searchUint32HdrProperty.js">file</a> |
<a href="/comm-central/annotate/0b0ff12d6f09c18c6c0ae7bf32f2561c9dada750/mailnews/base/test/unit/test_searchUint32HdrProperty.js">annotate</a> |
<a href="/comm-central/diff/0b0ff12d6f09c18c6c0ae7bf32f2561c9dada750/mailnews/base/test/unit/test_searchUint32HdrProperty.js">diff</a> |
<a href="/comm-central/comparison/0b0ff12d6f09c18c6c0ae7bf32f2561c9dada750/mailnews/base/test/unit/test_searchUint32HdrProperty.js">comparison</a> |
<a href="/comm-central/log/0b0ff12d6f09c18c6c0ae7bf32f2561c9dada750/mailnews/base/test/unit/test_searchUint32HdrProperty.js">revisions</a>
</td>
</tr>
</table></div>

<div class="page_body diffblocks"><div class="diffblock"><pre class="sourcelines">
<a href="#l1.1"></a><span id="l1.1" class="difflineminus">--- a/mail/base/content/quickFilterBar.js</span>
<a href="#l1.2"></a><span id="l1.2" class="difflineplus">+++ b/mail/base/content/quickFilterBar.js</span>
<a href="#l1.3"></a><span id="l1.3" class="difflineat">@@ -1,20 +1,17 @@</span>
<a href="#l1.4"></a><span id="l1.4"> /* This Source Code Form is subject to the terms of the Mozilla Public</span>
<a href="#l1.5"></a><span id="l1.5">  * License, v. 2.0. If a copy of the MPL was not distributed with this</span>
<a href="#l1.6"></a><span id="l1.6">  * file, You can obtain one at http://mozilla.org/MPL/2.0/. */</span>
<a href="#l1.7"></a><span id="l1.7"> </span>
<a href="#l1.8"></a><span id="l1.8"> Components.utils.import(&quot;resource:///modules/iteratorUtils.jsm&quot;);</span>
<a href="#l1.9"></a><span id="l1.9"> Components.utils.import(&quot;resource:///modules/errUtils.js&quot;);</span>
<a href="#l1.10"></a><span id="l1.10" class="difflineminus">-</span>
<a href="#l1.11"></a><span id="l1.11" class="difflineplus">+Components.utils.import(&quot;resource:///modules/quickFilterManager.js&quot;);</span>
<a href="#l1.12"></a><span id="l1.12"> Components.utils.import(&quot;resource:///modules/searchSpec.js&quot;);</span>
<a href="#l1.13"></a><span id="l1.13"> </span>
<a href="#l1.14"></a><span id="l1.14" class="difflineminus">-Components.utils.import(&quot;resource:///modules/quickFilterManager.js&quot;);</span>
<a href="#l1.15"></a><span id="l1.15" class="difflineminus">-</span>
<a href="#l1.16"></a><span id="l1.16" class="difflineminus">-</span>
<a href="#l1.17"></a><span id="l1.17"> ////////////////////////////////////////////////////////////////////////////////</span>
<a href="#l1.18"></a><span id="l1.18"> //// Proper Code</span>
<a href="#l1.19"></a><span id="l1.19"> </span>
<a href="#l1.20"></a><span id="l1.20"> /**</span>
<a href="#l1.21"></a><span id="l1.21">  * There is only one message filter bar widget; the muxer deals with tab</span>
<a href="#l1.22"></a><span id="l1.22">  *  changes and directing modifications to and reflecting the state of the</span>
<a href="#l1.23"></a><span id="l1.23">  *  actual filterer objects.</span>
<a href="#l1.24"></a><span id="l1.24">  */</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l2.1"></a><span id="l2.1" class="difflineminus">--- a/mail/base/modules/quickFilterManager.js</span>
<a href="#l2.2"></a><span id="l2.2" class="difflineplus">+++ b/mail/base/modules/quickFilterManager.js</span>
<a href="#l2.3"></a><span id="l2.3" class="difflineat">@@ -7,19 +7,20 @@ const EXPORTED_SYMBOLS = [&quot;QuickFilterSt</span>
<a href="#l2.4"></a><span id="l2.4"> const Cc = Components.classes;</span>
<a href="#l2.5"></a><span id="l2.5"> const Ci = Components.interfaces;</span>
<a href="#l2.6"></a><span id="l2.6"> const Cr = Components.results;</span>
<a href="#l2.7"></a><span id="l2.7"> const Cu = Components.utils;</span>
<a href="#l2.8"></a><span id="l2.8"> </span>
<a href="#l2.9"></a><span id="l2.9"> Cu.import(&quot;resource://gre/modules/PluralForm.jsm&quot;);</span>
<a href="#l2.10"></a><span id="l2.10"> Cu.import(&quot;resource://gre/modules/Services.jsm&quot;);</span>
<a href="#l2.11"></a><span id="l2.11"> </span>
<a href="#l2.12"></a><span id="l2.12" class="difflineminus">-Cu.import(&quot;resource:///modules/searchSpec.js&quot;);</span>
<a href="#l2.13"></a><span id="l2.13"> Cu.import(&quot;resource:///modules/iteratorUtils.jsm&quot;);</span>
<a href="#l2.14"></a><span id="l2.14"> Cu.import(&quot;resource:///modules/errUtils.js&quot;);</span>
<a href="#l2.15"></a><span id="l2.15" class="difflineplus">+Cu.import(&quot;resource:///modules/mailServices.js&quot;);</span>
<a href="#l2.16"></a><span id="l2.16" class="difflineplus">+Cu.import(&quot;resource:///modules/searchSpec.js&quot;);</span>
<a href="#l2.17"></a><span id="l2.17"> </span>
<a href="#l2.18"></a><span id="l2.18"> const Application = Cc[&quot;@mozilla.org/steel/application;1&quot;]</span>
<a href="#l2.19"></a><span id="l2.19">                       .getService(Ci.steelIApplication);</span>
<a href="#l2.20"></a><span id="l2.20"> </span>
<a href="#l2.21"></a><span id="l2.21"> const nsMsgSearchAttrib = Components.interfaces.nsMsgSearchAttrib;</span>
<a href="#l2.22"></a><span id="l2.22"> const nsMsgMessageFlags = Components.interfaces.nsMsgMessageFlags;</span>
<a href="#l2.23"></a><span id="l2.23"> const nsMsgSearchOp = Components.interfaces.nsMsgSearchOp;</span>
<a href="#l2.24"></a><span id="l2.24"> </span>
<a href="#l2.25"></a><span id="l2.25" class="difflineat">@@ -583,19 +584,17 @@ QuickFilterManager.defineFilter({</span>
<a href="#l2.26"></a><span id="l2.26"> /**</span>
<a href="#l2.27"></a><span id="l2.27">  * true: sender must be in a local address book, false: sender must not be.</span>
<a href="#l2.28"></a><span id="l2.28">  */</span>
<a href="#l2.29"></a><span id="l2.29"> QuickFilterManager.defineFilter({</span>
<a href="#l2.30"></a><span id="l2.30">   name: &quot;addrBook&quot;,</span>
<a href="#l2.31"></a><span id="l2.31">   domId: &quot;qfb-inaddrbook&quot;,</span>
<a href="#l2.32"></a><span id="l2.32">   appendTerms: function(aTermCreator, aTerms, aFilterValue) {</span>
<a href="#l2.33"></a><span id="l2.33">     let term, value;</span>
<a href="#l2.34"></a><span id="l2.34" class="difflineminus">-    let enumerator = Components.classes[&quot;@mozilla.org/abmanager;1&quot;]</span>
<a href="#l2.35"></a><span id="l2.35" class="difflineminus">-                               .getService(Components.interfaces.nsIAbManager)</span>
<a href="#l2.36"></a><span id="l2.36" class="difflineminus">-                               .directories;</span>
<a href="#l2.37"></a><span id="l2.37" class="difflineplus">+    let enumerator = MailServices.ab.directories;</span>
<a href="#l2.38"></a><span id="l2.38">     let firstBook = true;</span>
<a href="#l2.39"></a><span id="l2.39">     term = null;</span>
<a href="#l2.40"></a><span id="l2.40">     while (enumerator.hasMoreElements()) {</span>
<a href="#l2.41"></a><span id="l2.41">       let addrbook = enumerator.getNext();</span>
<a href="#l2.42"></a><span id="l2.42">       if (addrbook instanceof Components.interfaces.nsIAbDirectory &amp;&amp;</span>
<a href="#l2.43"></a><span id="l2.43">           !addrbook.isRemote) {</span>
<a href="#l2.44"></a><span id="l2.44">         term = aTermCreator.createTerm();</span>
<a href="#l2.45"></a><span id="l2.45">         term.attrib = Components.interfaces.nsMsgSearchAttrib.Sender;</span>
<a href="#l2.46"></a><span id="l2.46" class="difflineat">@@ -758,21 +757,19 @@ let TagFacetingFilter = {</span>
<a href="#l2.47"></a><span id="l2.47">   onSearchDone: function(aCurState, aKeywordMap, aStatus) {</span>
<a href="#l2.48"></a><span id="l2.48">     // we are an async operation; if the user turned off the tag facet already,</span>
<a href="#l2.49"></a><span id="l2.49">     //  then leave that state intact...</span>
<a href="#l2.50"></a><span id="l2.50">     if (aCurState == null)</span>
<a href="#l2.51"></a><span id="l2.51">       return [null, false, false];</span>
<a href="#l2.52"></a><span id="l2.52"> </span>
<a href="#l2.53"></a><span id="l2.53">     // only propagate things that are actually tags though!</span>
<a href="#l2.54"></a><span id="l2.54">     let outKeyMap = {};</span>
<a href="#l2.55"></a><span id="l2.55" class="difflineminus">-    let tagService = Cc[&quot;@mozilla.org/messenger/tagservice;1&quot;]</span>
<a href="#l2.56"></a><span id="l2.56" class="difflineminus">-                       .getService(Ci.nsIMsgTagService);</span>
<a href="#l2.57"></a><span id="l2.57" class="difflineminus">-    let tags = tagService.getAllTags({});</span>
<a href="#l2.58"></a><span id="l2.58" class="difflineplus">+    let tags = MailServices.tags.getAllTags({});</span>
<a href="#l2.59"></a><span id="l2.59">     let tagCount = tags.length;</span>
<a href="#l2.60"></a><span id="l2.60" class="difflineminus">-    for (let iTag=0; iTag &lt; tagCount; iTag++) {</span>
<a href="#l2.61"></a><span id="l2.61" class="difflineplus">+    for (let iTag = 0; iTag &lt; tagCount; iTag++) {</span>
<a href="#l2.62"></a><span id="l2.62">       let tag = tags[iTag];</span>
<a href="#l2.63"></a><span id="l2.63"> </span>
<a href="#l2.64"></a><span id="l2.64">       if (tag.key in aKeywordMap)</span>
<a href="#l2.65"></a><span id="l2.65">         outKeyMap[tag.key] = aKeywordMap[tag.key];</span>
<a href="#l2.66"></a><span id="l2.66">     }</span>
<a href="#l2.67"></a><span id="l2.67"> </span>
<a href="#l2.68"></a><span id="l2.68">     return [outKeyMap, true, false];</span>
<a href="#l2.69"></a><span id="l2.69">   },</span>
<a href="#l2.70"></a><span id="l2.70" class="difflineat">@@ -849,21 +846,19 @@ let TagFacetingFilter = {</span>
<a href="#l2.71"></a><span id="l2.71"> </span>
<a href="#l2.72"></a><span id="l2.72">     // -- nuke existing exposed tags</span>
<a href="#l2.73"></a><span id="l2.73">     while (tagbar.lastChild)</span>
<a href="#l2.74"></a><span id="l2.74">       tagbar.removeChild(tagbar.lastChild);</span>
<a href="#l2.75"></a><span id="l2.75"> </span>
<a href="#l2.76"></a><span id="l2.76">     let addCount = 0;</span>
<a href="#l2.77"></a><span id="l2.77"> </span>
<a href="#l2.78"></a><span id="l2.78">     // -- create an element for each tag</span>
<a href="#l2.79"></a><span id="l2.79" class="difflineminus">-    let tagService = Components.classes[&quot;@mozilla.org/messenger/tagservice;1&quot;]</span>
<a href="#l2.80"></a><span id="l2.80" class="difflineminus">-                           .getService(Components.interfaces.nsIMsgTagService);</span>
<a href="#l2.81"></a><span id="l2.81" class="difflineminus">-    let tags = tagService.getAllTags({});</span>
<a href="#l2.82"></a><span id="l2.82" class="difflineplus">+    let tags = MailServices.tags.getAllTags({});</span>
<a href="#l2.83"></a><span id="l2.83">     let tagCount = tags.length;</span>
<a href="#l2.84"></a><span id="l2.84" class="difflineminus">-    for (let iTag=0; iTag &lt; tagCount; iTag++) {</span>
<a href="#l2.85"></a><span id="l2.85" class="difflineplus">+    for (let iTag = 0; iTag &lt; tagCount; iTag++) {</span>
<a href="#l2.86"></a><span id="l2.86">       let tag = tags[iTag];</span>
<a href="#l2.87"></a><span id="l2.87"> </span>
<a href="#l2.88"></a><span id="l2.88">       if (tag.key in keywordMap) {</span>
<a href="#l2.89"></a><span id="l2.89">         addCount++;</span>
<a href="#l2.90"></a><span id="l2.90"> </span>
<a href="#l2.91"></a><span id="l2.91">         // Keep in mind that the XBL does not get built for dynamically created</span>
<a href="#l2.92"></a><span id="l2.92">         //  elements such as these until they get displayed, which definitely</span>
<a href="#l2.93"></a><span id="l2.93">         //  means not before we append it into the tree.</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l3.1"></a><span id="l3.1" class="difflineminus">--- a/mail/base/modules/searchSpec.js</span>
<a href="#l3.2"></a><span id="l3.2" class="difflineplus">+++ b/mail/base/modules/searchSpec.js</span>
<a href="#l3.3"></a><span id="l3.3" class="difflineat">@@ -5,16 +5,17 @@</span>
<a href="#l3.4"></a><span id="l3.4"> const EXPORTED_SYMBOLS = ['SearchSpec'];</span>
<a href="#l3.5"></a><span id="l3.5"> </span>
<a href="#l3.6"></a><span id="l3.6"> const Cc = Components.classes;</span>
<a href="#l3.7"></a><span id="l3.7"> const Ci = Components.interfaces;</span>
<a href="#l3.8"></a><span id="l3.8"> const Cr = Components.results;</span>
<a href="#l3.9"></a><span id="l3.9"> const Cu = Components.utils;</span>
<a href="#l3.10"></a><span id="l3.10"> </span>
<a href="#l3.11"></a><span id="l3.11"> Cu.import(&quot;resource:///modules/iteratorUtils.jsm&quot;);</span>
<a href="#l3.12"></a><span id="l3.12" class="difflineplus">+Cu.import(&quot;resource:///modules/mailServices.js&quot;);</span>
<a href="#l3.13"></a><span id="l3.13"> Cu.import(&quot;resource://gre/modules/Services.jsm&quot;);</span>
<a href="#l3.14"></a><span id="l3.14"> </span>
<a href="#l3.15"></a><span id="l3.15"> const nsMsgSearchScope = Ci.nsMsgSearchScope;</span>
<a href="#l3.16"></a><span id="l3.16"> const nsIMsgSearchTerm = Ci.nsIMsgSearchTerm;</span>
<a href="#l3.17"></a><span id="l3.17"> const nsIMsgLocalMailFolder = Ci.nsIMsgLocalMailFolder;</span>
<a href="#l3.18"></a><span id="l3.18"> const nsMsgFolderFlags = Ci.nsMsgFolderFlags;</span>
<a href="#l3.19"></a><span id="l3.19"> const nsMsgSearchAttrib = Ci.nsMsgSearchAttrib;</span>
<a href="#l3.20"></a><span id="l3.20"> </span>
<a href="#l3.21"></a><span id="l3.21" class="difflineat">@@ -433,19 +434,17 @@ SearchSpec.prototype = {</span>
<a href="#l3.22"></a><span id="l3.22">         let offlineValidityTable = validityManager.getTable(offlineScope);</span>
<a href="#l3.23"></a><span id="l3.23">         let offlineAvailable = true;</span>
<a href="#l3.24"></a><span id="l3.24">         let onlineAvailable = true;</span>
<a href="#l3.25"></a><span id="l3.25">         for each (let term in fixIterator(session.searchTerms,</span>
<a href="#l3.26"></a><span id="l3.26">                                           nsIMsgSearchTerm)) {</span>
<a href="#l3.27"></a><span id="l3.27">           if (!term.matchAll) {</span>
<a href="#l3.28"></a><span id="l3.28">             // for custom terms, we need to getAvailable from the custom term</span>
<a href="#l3.29"></a><span id="l3.29">             if (term.attrib == Ci.nsMsgSearchAttrib.Custom) {</span>
<a href="#l3.30"></a><span id="l3.30" class="difflineminus">-              let filterService = Cc[&quot;@mozilla.org/messenger/services/filters;1&quot;]</span>
<a href="#l3.31"></a><span id="l3.31" class="difflineminus">-                                    .getService(Ci.nsIMsgFilterService);</span>
<a href="#l3.32"></a><span id="l3.32" class="difflineminus">-              let customTerm = filterService.getCustomTerm(term.customId);</span>
<a href="#l3.33"></a><span id="l3.33" class="difflineplus">+              let customTerm = MailServices.filters.getCustomTerm(term.customId);</span>
<a href="#l3.34"></a><span id="l3.34">               if (customTerm) {</span>
<a href="#l3.35"></a><span id="l3.35">                 offlineAvailable = customTerm.getAvailable(offlineScope, term.op);</span>
<a href="#l3.36"></a><span id="l3.36">                 onlineAvailable = customTerm.getAvailable(serverScope, term.op);</span>
<a href="#l3.37"></a><span id="l3.37">               }</span>
<a href="#l3.38"></a><span id="l3.38">               else // maybe an extension with a custom term was unloaded?</span>
<a href="#l3.39"></a><span id="l3.39">                 Cu.reportError(&quot;Custom search term &quot; + term.customId + &quot; missing&quot;);</span>
<a href="#l3.40"></a><span id="l3.40">             }</span>
<a href="#l3.41"></a><span id="l3.41">             else {</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l4.1"></a><span id="l4.1" class="difflineminus">--- a/mail/base/test/unit/test_viewWrapper_virtualFolderCustomTerm.js</span>
<a href="#l4.2"></a><span id="l4.2" class="difflineplus">+++ b/mail/base/test/unit/test_viewWrapper_virtualFolderCustomTerm.js</span>
<a href="#l4.3"></a><span id="l4.3" class="difflineat">@@ -11,16 +11,18 @@ load(&quot;../../../../mailnews/resources/log</span>
<a href="#l4.4"></a><span id="l4.4"> load(&quot;../../../../mailnews/resources/asyncTestUtils.js&quot;);</span>
<a href="#l4.5"></a><span id="l4.5"> </span>
<a href="#l4.6"></a><span id="l4.6"> load(&quot;../../../../mailnews/resources/messageGenerator.js&quot;);</span>
<a href="#l4.7"></a><span id="l4.7"> load(&quot;../../../../mailnews/resources/messageModifier.js&quot;);</span>
<a href="#l4.8"></a><span id="l4.8"> load(&quot;../../../../mailnews/resources/messageInjection.js&quot;);</span>
<a href="#l4.9"></a><span id="l4.9"> </span>
<a href="#l4.10"></a><span id="l4.10"> load(&quot;resources/viewWrapperTestUtils.js&quot;);</span>
<a href="#l4.11"></a><span id="l4.11"> </span>
<a href="#l4.12"></a><span id="l4.12" class="difflineplus">+Components.utils.import(&quot;resource:///modules/mailServices.js&quot;);</span>
<a href="#l4.13"></a><span id="l4.13" class="difflineplus">+</span>
<a href="#l4.14"></a><span id="l4.14"> initViewWrapperTestUtils({mode: &quot;imap&quot;, offline: false});</span>
<a href="#l4.15"></a><span id="l4.15"> </span>
<a href="#l4.16"></a><span id="l4.16"> /**</span>
<a href="#l4.17"></a><span id="l4.17">  * A custom search term, that just does Subject Contains</span>
<a href="#l4.18"></a><span id="l4.18">  */</span>
<a href="#l4.19"></a><span id="l4.19"> gCustomSearchTermSubject = {</span>
<a href="#l4.20"></a><span id="l4.20">   id: &quot;mailnews@mozilla.org#test&quot;,</span>
<a href="#l4.21"></a><span id="l4.21">   name: &quot;Test-mailbase Subject&quot;,</span>
<a href="#l4.22"></a><span id="l4.22" class="difflineat">@@ -35,19 +37,17 @@ gCustomSearchTermSubject = {</span>
<a href="#l4.23"></a><span id="l4.23">     return [Components.interfaces.nsMsgSearchOp.Contains];</span>
<a href="#l4.24"></a><span id="l4.24">   },</span>
<a href="#l4.25"></a><span id="l4.25">   match: function subject_match(aMsgHdr, aSearchValue, aSearchOp) {</span>
<a href="#l4.26"></a><span id="l4.26">     return (aMsgHdr.subject.contains(aSearchValue));</span>
<a href="#l4.27"></a><span id="l4.27">   },</span>
<a href="#l4.28"></a><span id="l4.28">   needsBody: false,</span>
<a href="#l4.29"></a><span id="l4.29"> };</span>
<a href="#l4.30"></a><span id="l4.30"> </span>
<a href="#l4.31"></a><span id="l4.31" class="difflineminus">-let filterService = Cc[&quot;@mozilla.org/messenger/services/filters;1&quot;]</span>
<a href="#l4.32"></a><span id="l4.32" class="difflineminus">-                      .getService(Ci.nsIMsgFilterService);</span>
<a href="#l4.33"></a><span id="l4.33" class="difflineminus">-filterService.addCustomTerm(gCustomSearchTermSubject);</span>
<a href="#l4.34"></a><span id="l4.34" class="difflineplus">+MailServices.filters.addCustomTerm(gCustomSearchTermSubject);</span>
<a href="#l4.35"></a><span id="l4.35"> </span>
<a href="#l4.36"></a><span id="l4.36"> /**</span>
<a href="#l4.37"></a><span id="l4.37">  * Make sure we open a virtual folder backed by a single underlying folder</span>
<a href="#l4.38"></a><span id="l4.38">  *  correctly, with a custom search term.</span>
<a href="#l4.39"></a><span id="l4.39">  */</span>
<a href="#l4.40"></a><span id="l4.40"> function test_virtual_folder_single_load_custom_pred() {</span>
<a href="#l4.41"></a><span id="l4.41">   let viewWrapper = make_view_wrapper();</span>
<a href="#l4.42"></a><span id="l4.42"> </span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l5.1"></a><span id="l5.1" class="difflineminus">--- a/mail/components/search/content/searchCommon.js</span>
<a href="#l5.2"></a><span id="l5.2" class="difflineplus">+++ b/mail/components/search/content/searchCommon.js</span>
<a href="#l5.3"></a><span id="l5.3" class="difflineat">@@ -17,16 +17,17 @@</span>
<a href="#l5.4"></a><span id="l5.4"> #endif</span>
<a href="#l5.5"></a><span id="l5.5"> </span>
<a href="#l5.6"></a><span id="l5.6"> const Cc = Components.classes;</span>
<a href="#l5.7"></a><span id="l5.7"> const Ci = Components.interfaces;</span>
<a href="#l5.8"></a><span id="l5.8"> const Cu = Components.utils;</span>
<a href="#l5.9"></a><span id="l5.9"> </span>
<a href="#l5.10"></a><span id="l5.10"> Cu.import(&quot;resource:///modules/gloda/log4moz.js&quot;);</span>
<a href="#l5.11"></a><span id="l5.11"> Cu.import(&quot;resource:///modules/iteratorUtils.jsm&quot;);</span>
<a href="#l5.12"></a><span id="l5.12" class="difflineplus">+Cu.import(&quot;resource:///modules/mailServices.js&quot;);</span>
<a href="#l5.13"></a><span id="l5.13"> Cu.import(&quot;resource:///modules/MailUtils.js&quot;);</span>
<a href="#l5.14"></a><span id="l5.14"> Cu.import(&quot;resource://gre/modules/Services.jsm&quot;);</span>
<a href="#l5.15"></a><span id="l5.15"> </span>
<a href="#l5.16"></a><span id="l5.16"> const PERM_DIRECTORY = parseInt(&quot;0755&quot;, 8);</span>
<a href="#l5.17"></a><span id="l5.17"> const PERM_FILE = parseInt(&quot;0644&quot;, 8);</span>
<a href="#l5.18"></a><span id="l5.18"> </span>
<a href="#l5.19"></a><span id="l5.19"> let SearchSupport =</span>
<a href="#l5.20"></a><span id="l5.20"> {</span>
<a href="#l5.21"></a><span id="l5.21" class="difflineat">@@ -191,70 +192,63 @@ let SearchSupport =</span>
<a href="#l5.22"></a><span id="l5.22">   {</span>
<a href="#l5.23"></a><span id="l5.23">     // Nothing to do if there's no change in state</span>
<a href="#l5.24"></a><span id="l5.24">     if (this._enabled == aEnable)</span>
<a href="#l5.25"></a><span id="l5.25">       return;</span>
<a href="#l5.26"></a><span id="l5.26"> </span>
<a href="#l5.27"></a><span id="l5.27">     this._log.info(&quot;Enabled status changing from &quot; + this._enabled + &quot; to &quot; +</span>
<a href="#l5.28"></a><span id="l5.28">                    aEnable);</span>
<a href="#l5.29"></a><span id="l5.29"> </span>
<a href="#l5.30"></a><span id="l5.30" class="difflineminus">-    let notificationService =</span>
<a href="#l5.31"></a><span id="l5.31" class="difflineminus">-      Cc[&quot;@mozilla.org/messenger/msgnotificationservice;1&quot;]</span>
<a href="#l5.32"></a><span id="l5.32" class="difflineminus">-        .getService(Ci.nsIMsgFolderNotificationService);</span>
<a href="#l5.33"></a><span id="l5.33" class="difflineminus">-</span>
<a href="#l5.34"></a><span id="l5.34">     this._removeObservers();</span>
<a href="#l5.35"></a><span id="l5.35"> </span>
<a href="#l5.36"></a><span id="l5.36">     if (aEnable)</span>
<a href="#l5.37"></a><span id="l5.37">     {</span>
<a href="#l5.38"></a><span id="l5.38">       // This stuff we always need to do</span>
<a href="#l5.39"></a><span id="l5.39" class="difflineminus">-      notificationService.addListener(this._msgFolderListener,</span>
<a href="#l5.40"></a><span id="l5.40" class="difflineminus">-        notificationService.msgAdded |</span>
<a href="#l5.41"></a><span id="l5.41" class="difflineminus">-        notificationService.msgsDeleted |</span>
<a href="#l5.42"></a><span id="l5.42" class="difflineminus">-        notificationService.msgsMoveCopyCompleted |</span>
<a href="#l5.43"></a><span id="l5.43" class="difflineplus">+      MailServices.mfn.addListener(this._msgFolderListener,</span>
<a href="#l5.44"></a><span id="l5.44" class="difflineplus">+        MailServices.mfn.msgAdded |</span>
<a href="#l5.45"></a><span id="l5.45" class="difflineplus">+        MailServices.mfn.msgsDeleted |</span>
<a href="#l5.46"></a><span id="l5.46" class="difflineplus">+        MailServices.mfn.msgsMoveCopyCompleted |</span>
<a href="#l5.47"></a><span id="l5.47">         // this code pre-dates msgsClassified</span>
<a href="#l5.48"></a><span id="l5.48">         // folderAdded intentionally omitted</span>
<a href="#l5.49"></a><span id="l5.49" class="difflineminus">-        notificationService.folderDeleted |</span>
<a href="#l5.50"></a><span id="l5.50" class="difflineminus">-        notificationService.folderMoveCopyCompleted |</span>
<a href="#l5.51"></a><span id="l5.51" class="difflineminus">-        notificationService.folderRenamed);</span>
<a href="#l5.52"></a><span id="l5.52" class="difflineplus">+        MailServices.mfn.folderDeleted |</span>
<a href="#l5.53"></a><span id="l5.53" class="difflineplus">+        MailServices.mfn.folderMoveCopyCompleted |</span>
<a href="#l5.54"></a><span id="l5.54" class="difflineplus">+        MailServices.mfn.folderRenamed);</span>
<a href="#l5.55"></a><span id="l5.55">         // itemEvent intentionally omitted</span>
<a href="#l5.56"></a><span id="l5.56">       Services.obs.addObserver(this, &quot;MsgMsgDisplayed&quot;, false);</span>
<a href="#l5.57"></a><span id="l5.57">       let idleService = Cc[&quot;@mozilla.org/widget/idleservice;1&quot;]</span>
<a href="#l5.58"></a><span id="l5.58">                           .getService(Ci.nsIIdleService);</span>
<a href="#l5.59"></a><span id="l5.59">       idleService.addIdleObserver(this, this._idleThresholdSecs);</span>
<a href="#l5.60"></a><span id="l5.60">     }</span>
<a href="#l5.61"></a><span id="l5.61">     else</span>
<a href="#l5.62"></a><span id="l5.62">       // We want to observe moves, deletes and renames in case we're disabled</span>
<a href="#l5.63"></a><span id="l5.63">       // If we don't, we'll have no idea the support files exist later</span>
<a href="#l5.64"></a><span id="l5.64" class="difflineminus">-      notificationService.addListener(this._msgFolderListener,</span>
<a href="#l5.65"></a><span id="l5.65" class="difflineminus">-        notificationService.msgsMoveCopyCompleted |</span>
<a href="#l5.66"></a><span id="l5.66" class="difflineminus">-        notificationService.msgsDeleted |</span>
<a href="#l5.67"></a><span id="l5.67" class="difflineplus">+      MailServices.mfn.addListener(this._msgFolderListener,</span>
<a href="#l5.68"></a><span id="l5.68" class="difflineplus">+        MailServices.mfn.msgsMoveCopyCompleted |</span>
<a href="#l5.69"></a><span id="l5.69" class="difflineplus">+        MailServices.mfn.msgsDeleted |</span>
<a href="#l5.70"></a><span id="l5.70">         // folderAdded intentionally omitted</span>
<a href="#l5.71"></a><span id="l5.71" class="difflineminus">-        notificationService.folderDeleted |</span>
<a href="#l5.72"></a><span id="l5.72" class="difflineminus">-        notificationService.folderMoveCopyCompleted |</span>
<a href="#l5.73"></a><span id="l5.73" class="difflineminus">-        notificationService.folderRenamed);</span>
<a href="#l5.74"></a><span id="l5.74" class="difflineplus">+        MailServices.mfn.folderDeleted |</span>
<a href="#l5.75"></a><span id="l5.75" class="difflineplus">+        MailServices.mfn.folderMoveCopyCompleted |</span>
<a href="#l5.76"></a><span id="l5.76" class="difflineplus">+        MailServices.mfn.folderRenamed);</span>
<a href="#l5.77"></a><span id="l5.77"> </span>
<a href="#l5.78"></a><span id="l5.78">     this._enabled = aEnable;</span>
<a href="#l5.79"></a><span id="l5.79">   },</span>
<a href="#l5.80"></a><span id="l5.80">   get enabled()</span>
<a href="#l5.81"></a><span id="l5.81">   {</span>
<a href="#l5.82"></a><span id="l5.82">     return this._enabled;</span>
<a href="#l5.83"></a><span id="l5.83">   },</span>
<a href="#l5.84"></a><span id="l5.84"> </span>
<a href="#l5.85"></a><span id="l5.85">   /**</span>
<a href="#l5.86"></a><span id="l5.86">    * Remove whatever observers are present. This is done while switching states</span>
<a href="#l5.87"></a><span id="l5.87">    */</span>
<a href="#l5.88"></a><span id="l5.88">   _removeObservers: function()</span>
<a href="#l5.89"></a><span id="l5.89">   {</span>
<a href="#l5.90"></a><span id="l5.90">     if (this.enabled === null)</span>
<a href="#l5.91"></a><span id="l5.91">       return;</span>
<a href="#l5.92"></a><span id="l5.92"> </span>
<a href="#l5.93"></a><span id="l5.93" class="difflineminus">-    let notificationService =</span>
<a href="#l5.94"></a><span id="l5.94" class="difflineminus">-      Cc[&quot;@mozilla.org/messenger/msgnotificationservice;1&quot;]</span>
<a href="#l5.95"></a><span id="l5.95" class="difflineminus">-        .getService(Ci.nsIMsgFolderNotificationService);</span>
<a href="#l5.96"></a><span id="l5.96" class="difflineminus">-    notificationService.removeListener(this._msgFolderListener);</span>
<a href="#l5.97"></a><span id="l5.97" class="difflineplus">+    MailServices.mfn.removeListener(this._msgFolderListener);</span>
<a href="#l5.98"></a><span id="l5.98"> </span>
<a href="#l5.99"></a><span id="l5.99">     if (this.enabled)</span>
<a href="#l5.100"></a><span id="l5.100">     {</span>
<a href="#l5.101"></a><span id="l5.101">       Services.obs.removeObserver(this, &quot;MsgMsgDisplayed&quot;, false);</span>
<a href="#l5.102"></a><span id="l5.102">       let idleService = Cc[&quot;@mozilla.org/widget/idleservice;1&quot;]</span>
<a href="#l5.103"></a><span id="l5.103">                           .getService(Ci.nsIIdleService);</span>
<a href="#l5.104"></a><span id="l5.104">       idleService.removeIdleObserver(this, this._idleThresholdSecs);</span>
<a href="#l5.105"></a><span id="l5.105"> </span>
<a href="#l5.106"></a><span id="l5.106" class="difflineat">@@ -303,19 +297,17 @@ let SearchSupport =</span>
<a href="#l5.107"></a><span id="l5.107">    * in such a folder, it'll yield return that folder, then set the</span>
<a href="#l5.108"></a><span id="l5.108">    * lastFolderIndexedUrl to the URI of that folder.</span>
<a href="#l5.109"></a><span id="l5.109">    *</span>
<a href="#l5.110"></a><span id="l5.110">    * It resets lastFolderIndexedUri to an empty string, then yield returns null</span>
<a href="#l5.111"></a><span id="l5.111">    * once iteration across all folders is complete.</span>
<a href="#l5.112"></a><span id="l5.112">    */</span>
<a href="#l5.113"></a><span id="l5.113">   _foldersToIndexGenerator: function search_find_next_folder()</span>
<a href="#l5.114"></a><span id="l5.114">   {</span>
<a href="#l5.115"></a><span id="l5.115" class="difflineminus">-    let accountManager = Cc[&quot;@mozilla.org/messenger/account-manager;1&quot;]</span>
<a href="#l5.116"></a><span id="l5.116" class="difflineminus">-                           .getService(Ci.nsIMsgAccountManager);</span>
<a href="#l5.117"></a><span id="l5.117" class="difflineminus">-    let servers = accountManager.allServers;</span>
<a href="#l5.118"></a><span id="l5.118" class="difflineplus">+    let servers = MailServices.accounts.allServers;</span>
<a href="#l5.119"></a><span id="l5.119"> </span>
<a href="#l5.120"></a><span id="l5.120">     // Stores whether we're after the last folder indexed or before that --</span>
<a href="#l5.121"></a><span id="l5.121">     // if the last folder indexed is empty, this needs to be true initially</span>
<a href="#l5.122"></a><span id="l5.122">     let afterLastFolderIndexed = (this._lastFolderIndexedUri.length == 0);</span>
<a href="#l5.123"></a><span id="l5.123"> </span>
<a href="#l5.124"></a><span id="l5.124">     for each (var server in fixIterator(servers, Ci.nsIMsgIncomingServer))</span>
<a href="#l5.125"></a><span id="l5.125">     {</span>
<a href="#l5.126"></a><span id="l5.126">       let allFolders = server.rootFolder.descendants;</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l6.1"></a><span id="l6.1" class="difflineminus">--- a/mail/test/mozmill/folder-tree-modes/test-smart-folders.js</span>
<a href="#l6.2"></a><span id="l6.2" class="difflineplus">+++ b/mail/test/mozmill/folder-tree-modes/test-smart-folders.js</span>
<a href="#l6.3"></a><span id="l6.3" class="difflineat">@@ -149,19 +149,17 @@ function test_select_folder_expands_coll</span>
<a href="#l6.4"></a><span id="l6.4"> function test_folder_flag_changes() {</span>
<a href="#l6.5"></a><span id="l6.5">   expand_folder(smartInboxFolder);</span>
<a href="#l6.6"></a><span id="l6.6">   // Now attempt to select the folder.</span>
<a href="#l6.7"></a><span id="l6.7">   mc.folderTreeView.selectFolder(inboxSubfolder);</span>
<a href="#l6.8"></a><span id="l6.8">   // Need to archive two messages in two different accounts in order to</span>
<a href="#l6.9"></a><span id="l6.9">   // create a smart Archives folder.</span>
<a href="#l6.10"></a><span id="l6.10">   select_click_row(0);</span>
<a href="#l6.11"></a><span id="l6.11">   archive_selected_messages();</span>
<a href="#l6.12"></a><span id="l6.12" class="difflineminus">-  let acctMgr = Cc[&quot;@mozilla.org/messenger/account-manager;1&quot;]</span>
<a href="#l6.13"></a><span id="l6.13" class="difflineminus">-                  .getService(Ci.nsIMsgAccountManager);</span>
<a href="#l6.14"></a><span id="l6.14" class="difflineminus">-  let pop3Server = acctMgr.FindServer(&quot;tinderbox&quot;, &quot;tinderbox&quot;, &quot;pop3&quot;);</span>
<a href="#l6.15"></a><span id="l6.15" class="difflineplus">+  let pop3Server = MailServices.accounts.FindServer(&quot;tinderbox&quot;, &quot;tinderbox&quot;, &quot;pop3&quot;);</span>
<a href="#l6.16"></a><span id="l6.16">   let pop3Inbox = pop3Server.rootFolder.getChildNamed(&quot;Inbox&quot;);</span>
<a href="#l6.17"></a><span id="l6.17">   make_new_sets_in_folder(pop3Inbox, [{count: 1}]);</span>
<a href="#l6.18"></a><span id="l6.18">   mc.folderTreeView.selectFolder(pop3Inbox);</span>
<a href="#l6.19"></a><span id="l6.19">   select_click_row(0);</span>
<a href="#l6.20"></a><span id="l6.20">   archive_selected_messages();</span>
<a href="#l6.21"></a><span id="l6.21"> </span>
<a href="#l6.22"></a><span id="l6.22">   smartArchiveFolder = get_smart_folder_named(&quot;Archives&quot;);</span>
<a href="#l6.23"></a><span id="l6.23">   let archiveScope = &quot;|&quot; + smartArchiveFolder.msgDatabase.dBFolderInfo</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l7.1"></a><span id="l7.1" class="difflineminus">--- a/mail/test/mozmill/quick-filter-bar/test-filter-logic.js</span>
<a href="#l7.2"></a><span id="l7.2" class="difflineplus">+++ b/mail/test/mozmill/quick-filter-bar/test-filter-logic.js</span>
<a href="#l7.3"></a><span id="l7.3" class="difflineat">@@ -88,19 +88,17 @@ function test_filter_attachments() {</span>
<a href="#l7.4"></a><span id="l7.4">  * Create a card for the given e-mail address, adding it to the first address</span>
<a href="#l7.5"></a><span id="l7.5">  * book we can find.</span>
<a href="#l7.6"></a><span id="l7.6">  */</span>
<a href="#l7.7"></a><span id="l7.7"> function add_email_to_address_book(aEmailAddr) {</span>
<a href="#l7.8"></a><span id="l7.8">   let card = Cc[&quot;@mozilla.org/addressbook/cardproperty;1&quot;]</span>
<a href="#l7.9"></a><span id="l7.9">                .createInstance(Ci.nsIAbCard);</span>
<a href="#l7.10"></a><span id="l7.10">   card.primaryEmail = aEmailAddr;</span>
<a href="#l7.11"></a><span id="l7.11"> </span>
<a href="#l7.12"></a><span id="l7.12" class="difflineminus">-  let enumerator = Cc[&quot;@mozilla.org/abmanager;1&quot;]</span>
<a href="#l7.13"></a><span id="l7.13" class="difflineminus">-                     .getService(Ci.nsIAbManager)</span>
<a href="#l7.14"></a><span id="l7.14" class="difflineminus">-                     .directories;</span>
<a href="#l7.15"></a><span id="l7.15" class="difflineplus">+  let enumerator = MailServices.ab.directories;</span>
<a href="#l7.16"></a><span id="l7.16">   while (enumerator.hasMoreElements()) {</span>
<a href="#l7.17"></a><span id="l7.17">     let addrbook = enumerator.getNext();</span>
<a href="#l7.18"></a><span id="l7.18">     if (addrbook instanceof Components.interfaces.nsIAbMDBDirectory &amp;&amp;</span>
<a href="#l7.19"></a><span id="l7.19">         addrbook instanceof Components.interfaces.nsIAbDirectory) {</span>
<a href="#l7.20"></a><span id="l7.20">       addrbook.addCard(card);</span>
<a href="#l7.21"></a><span id="l7.21">       return;</span>
<a href="#l7.22"></a><span id="l7.22">     }</span>
<a href="#l7.23"></a><span id="l7.23">   }</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l8.1"></a><span id="l8.1" class="difflineminus">--- a/mailnews/base/test/unit/test_loadVirtualFolders.js</span>
<a href="#l8.2"></a><span id="l8.2" class="difflineplus">+++ b/mailnews/base/test/unit/test_loadVirtualFolders.js</span>
<a href="#l8.3"></a><span id="l8.3" class="difflineat">@@ -1,17 +1,16 @@</span>
<a href="#l8.4"></a><span id="l8.4"> /* This Source Code Form is subject to the terms of the Mozilla Public</span>
<a href="#l8.5"></a><span id="l8.5">  * License, v. 2.0. If a copy of the MPL was not distributed with this</span>
<a href="#l8.6"></a><span id="l8.6">  * file, You can obtain one at http://mozilla.org/MPL/2.0/. */</span>
<a href="#l8.7"></a><span id="l8.7"> </span>
<a href="#l8.8"></a><span id="l8.8"> // Test loading of virtualFolders.dat, including verification of the search </span>
<a href="#l8.9"></a><span id="l8.9"> // scopes, i.e., folder uri's.</span>
<a href="#l8.10"></a><span id="l8.10"> </span>
<a href="#l8.11"></a><span id="l8.11" class="difflineminus">-const am = Components.classes[&quot;@mozilla.org/messenger/account-manager;1&quot;]</span>
<a href="#l8.12"></a><span id="l8.12" class="difflineminus">-                     .getService(Components.interfaces.nsIMsgAccountManager);</span>
<a href="#l8.13"></a><span id="l8.13" class="difflineplus">+Components.utils.import(&quot;resource:///modules/mailServices.js&quot;);</span>
<a href="#l8.14"></a><span id="l8.14"> </span>
<a href="#l8.15"></a><span id="l8.15"> // As currently written, this test will only work with Berkeley store.</span>
<a href="#l8.16"></a><span id="l8.16"> Services.prefs.setCharPref(&quot;mail.serverDefaultStoreContractID&quot;,</span>
<a href="#l8.17"></a><span id="l8.17">                            &quot;@mozilla.org/msgstore/berkeleystore;1&quot;);</span>
<a href="#l8.18"></a><span id="l8.18"> </span>
<a href="#l8.19"></a><span id="l8.19"> // main test</span>
<a href="#l8.20"></a><span id="l8.20"> </span>
<a href="#l8.21"></a><span id="l8.21"> function run_test()</span>
<a href="#l8.22"></a><span id="l8.22" class="difflineat">@@ -23,16 +22,16 @@ function run_test()</span>
<a href="#l8.23"></a><span id="l8.23">   let localMailDir = gProfileDir.clone();</span>
<a href="#l8.24"></a><span id="l8.24">   localMailDir.append(&quot;Mail&quot;);</span>
<a href="#l8.25"></a><span id="l8.25">   localMailDir.append(&quot;Local Folders&quot;);</span>
<a href="#l8.26"></a><span id="l8.26">   localMailDir.append(&quot;unread-local&quot;);</span>
<a href="#l8.27"></a><span id="l8.27">   localMailDir.create(Ci.nsIFile.NORMAL_FILE_TYPE, parseInt(&quot;0644&quot;, 8));</span>
<a href="#l8.28"></a><span id="l8.28">   localMailDir.leafName = &quot;invalidserver-local&quot;;</span>
<a href="#l8.29"></a><span id="l8.29">   localMailDir.create(Ci.nsIFile.NORMAL_FILE_TYPE, parseInt(&quot;0644&quot;, 8));</span>
<a href="#l8.30"></a><span id="l8.30"> </span>
<a href="#l8.31"></a><span id="l8.31" class="difflineminus">-  am.loadVirtualFolders();</span>
<a href="#l8.32"></a><span id="l8.32" class="difflineplus">+  MailServices.accounts.loadVirtualFolders();</span>
<a href="#l8.33"></a><span id="l8.33">   let unreadLocal = gLocalIncomingServer.rootMsgFolder.getChildNamed(&quot;unread-local&quot;);</span>
<a href="#l8.34"></a><span id="l8.34">   let searchScope = unreadLocal.msgDatabase.dBFolderInfo.getCharProperty(&quot;searchFolderUri&quot;);</span>
<a href="#l8.35"></a><span id="l8.35">   do_check_eq(searchScope, &quot;mailbox://nobody@Local%20Folders/Inbox|mailbox://nobody@Local%20Folders/Trash&quot;);</span>
<a href="#l8.36"></a><span id="l8.36">   let invalidServer = gLocalIncomingServer.rootMsgFolder.getChildNamed(&quot;invalidserver-local&quot;);</span>
<a href="#l8.37"></a><span id="l8.37">   let searchScope = invalidServer.msgDatabase.dBFolderInfo.getCharProperty(&quot;searchFolderUri&quot;);</span>
<a href="#l8.38"></a><span id="l8.38">   do_check_eq(searchScope, &quot;mailbox://nobody@Local%20Folders/Inbox&quot;);</span>
<a href="#l8.39"></a><span id="l8.39"> }</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l9.1"></a><span id="l9.1" class="difflineminus">--- a/mailnews/base/test/unit/test_search.js</span>
<a href="#l9.2"></a><span id="l9.2" class="difflineplus">+++ b/mailnews/base/test/unit/test_search.js</span>
<a href="#l9.3"></a><span id="l9.3" class="difflineat">@@ -5,18 +5,17 @@</span>
<a href="#l9.4"></a><span id="l9.4"> /*</span>
<a href="#l9.5"></a><span id="l9.5">  * Testing of general mail search features.</span>
<a href="#l9.6"></a><span id="l9.6">  *</span>
<a href="#l9.7"></a><span id="l9.7">  * This tests some search attributes not tested by other specific tests,</span>
<a href="#l9.8"></a><span id="l9.8">  * e.g., test_searchTag.js or test_searchJunk.js</span>
<a href="#l9.9"></a><span id="l9.9">  */</span>
<a href="#l9.10"></a><span id="l9.10"> load(&quot;../../../resources/searchTestUtils.js&quot;);</span>
<a href="#l9.11"></a><span id="l9.11"> </span>
<a href="#l9.12"></a><span id="l9.12" class="difflineminus">-const copyService = Cc[&quot;@mozilla.org/messenger/messagecopyservice;1&quot;]</span>
<a href="#l9.13"></a><span id="l9.13" class="difflineminus">-                      .getService(Ci.nsIMsgCopyService);</span>
<a href="#l9.14"></a><span id="l9.14" class="difflineplus">+Components.utils.import(&quot;resource:///modules/mailServices.js&quot;);</span>
<a href="#l9.15"></a><span id="l9.15"> </span>
<a href="#l9.16"></a><span id="l9.16"> const nsMsgSearchScope = Ci.nsMsgSearchScope;</span>
<a href="#l9.17"></a><span id="l9.17"> const nsMsgSearchAttrib = Ci.nsMsgSearchAttrib;</span>
<a href="#l9.18"></a><span id="l9.18"> const nsMsgSearchOp = Ci.nsMsgSearchOp;</span>
<a href="#l9.19"></a><span id="l9.19"> </span>
<a href="#l9.20"></a><span id="l9.20"> const Isnt = nsMsgSearchOp.Isnt;</span>
<a href="#l9.21"></a><span id="l9.21"> const Is = nsMsgSearchOp.Is;</span>
<a href="#l9.22"></a><span id="l9.22"> const IsEmpty = nsMsgSearchOp.IsEmpty;</span>
<a href="#l9.23"></a><span id="l9.23" class="difflineat">@@ -221,18 +220,18 @@ function run_test()</span>
<a href="#l9.24"></a><span id="l9.24"> </span>
<a href="#l9.25"></a><span id="l9.25">   // set value of headers we want parsed into the db</span>
<a href="#l9.26"></a><span id="l9.26">   Services.prefs.setCharPref(&quot;mailnews.customDBHeaders&quot;,</span>
<a href="#l9.27"></a><span id="l9.27">                              &quot;oneLiner twoLiner threeLiner noSpace withSpace&quot;);</span>
<a href="#l9.28"></a><span id="l9.28">   // Get a message into the local filestore. function testSearch() continues</span>
<a href="#l9.29"></a><span id="l9.29">   // the testing after the copy.</span>
<a href="#l9.30"></a><span id="l9.30">   var bugmail12 = do_get_file(&quot;../../../data/bugmail12&quot;);</span>
<a href="#l9.31"></a><span id="l9.31">   do_test_pending();</span>
<a href="#l9.32"></a><span id="l9.32" class="difflineminus">-  copyService.CopyFileMessage(bugmail12, gLocalInboxFolder, null, false, 0,</span>
<a href="#l9.33"></a><span id="l9.33" class="difflineminus">-                              &quot;&quot;, copyListener, null);</span>
<a href="#l9.34"></a><span id="l9.34" class="difflineplus">+  MailServices.copy.CopyFileMessage(bugmail12, gLocalInboxFolder, null, false, 0,</span>
<a href="#l9.35"></a><span id="l9.35" class="difflineplus">+                                    &quot;&quot;, copyListener, null);</span>
<a href="#l9.36"></a><span id="l9.36"> }</span>
<a href="#l9.37"></a><span id="l9.37"> </span>
<a href="#l9.38"></a><span id="l9.38"> // process each test from queue, calls itself upon completion of each search</span>
<a href="#l9.39"></a><span id="l9.39"> var testObject;</span>
<a href="#l9.40"></a><span id="l9.40"> function testSearch()</span>
<a href="#l9.41"></a><span id="l9.41"> {</span>
<a href="#l9.42"></a><span id="l9.42">   var test = Tests.shift();</span>
<a href="#l9.43"></a><span id="l9.43">   if (test &amp;&amp; test.dbHeader)</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l10.1"></a><span id="l10.1" class="difflineminus">--- a/mailnews/base/test/unit/test_searchBody.js</span>
<a href="#l10.2"></a><span id="l10.2" class="difflineplus">+++ b/mailnews/base/test/unit/test_searchBody.js</span>
<a href="#l10.3"></a><span id="l10.3" class="difflineat">@@ -2,18 +2,17 @@</span>
<a href="#l10.4"></a><span id="l10.4">  * License, v. 2.0. If a copy of the MPL was not distributed with this</span>
<a href="#l10.5"></a><span id="l10.5">  * file, You can obtain one at http://mozilla.org/MPL/2.0/. */</span>
<a href="#l10.6"></a><span id="l10.6"> </span>
<a href="#l10.7"></a><span id="l10.7"> /*</span>
<a href="#l10.8"></a><span id="l10.8">  * This tests various body search criteria.</span>
<a href="#l10.9"></a><span id="l10.9">  */</span>
<a href="#l10.10"></a><span id="l10.10"> load(&quot;../../../resources/searchTestUtils.js&quot;);</span>
<a href="#l10.11"></a><span id="l10.11"> </span>
<a href="#l10.12"></a><span id="l10.12" class="difflineminus">-const copyService = Cc[&quot;@mozilla.org/messenger/messagecopyservice;1&quot;]</span>
<a href="#l10.13"></a><span id="l10.13" class="difflineminus">-                      .getService(Ci.nsIMsgCopyService);</span>
<a href="#l10.14"></a><span id="l10.14" class="difflineplus">+Components.utils.import(&quot;resource:///modules/mailServices.js&quot;);</span>
<a href="#l10.15"></a><span id="l10.15"> </span>
<a href="#l10.16"></a><span id="l10.16"> const nsMsgSearchScope = Ci.nsMsgSearchScope;</span>
<a href="#l10.17"></a><span id="l10.17"> const nsMsgSearchAttrib = Ci.nsMsgSearchAttrib;</span>
<a href="#l10.18"></a><span id="l10.18"> const nsMsgSearchOp = Ci.nsMsgSearchOp;</span>
<a href="#l10.19"></a><span id="l10.19"> </span>
<a href="#l10.20"></a><span id="l10.20"> const Isnt = nsMsgSearchOp.Isnt;</span>
<a href="#l10.21"></a><span id="l10.21"> const Is = nsMsgSearchOp.Is;</span>
<a href="#l10.22"></a><span id="l10.22"> const IsEmpty = nsMsgSearchOp.IsEmpty;</span>
<a href="#l10.23"></a><span id="l10.23" class="difflineat">@@ -99,18 +98,18 @@ var copyListener =</span>
<a href="#l10.24"></a><span id="l10.24">   SetMessageKey: function(aKey) {},</span>
<a href="#l10.25"></a><span id="l10.25">   SetMessageId: function(aMessageId) {},</span>
<a href="#l10.26"></a><span id="l10.26">   OnStopCopy: function(aStatus) </span>
<a href="#l10.27"></a><span id="l10.27">   {</span>
<a href="#l10.28"></a><span id="l10.28">     var fileName = Files.shift();</span>
<a href="#l10.29"></a><span id="l10.29">     if (fileName)</span>
<a href="#l10.30"></a><span id="l10.30">     { </span>
<a href="#l10.31"></a><span id="l10.31">       var file = fixFile(do_get_file(fileName));</span>
<a href="#l10.32"></a><span id="l10.32" class="difflineminus">-      copyService.CopyFileMessage(file, gLocalInboxFolder, null, false, 0,</span>
<a href="#l10.33"></a><span id="l10.33" class="difflineminus">-                              &quot;&quot;, copyListener, null);</span>
<a href="#l10.34"></a><span id="l10.34" class="difflineplus">+      MailServices.copy.CopyFileMessage(file, gLocalInboxFolder, null, false, 0,</span>
<a href="#l10.35"></a><span id="l10.35" class="difflineplus">+                                        &quot;&quot;, copyListener, null);</span>
<a href="#l10.36"></a><span id="l10.36">     }</span>
<a href="#l10.37"></a><span id="l10.37">     else</span>
<a href="#l10.38"></a><span id="l10.38">       testBodySearch();</span>
<a href="#l10.39"></a><span id="l10.39">   }</span>
<a href="#l10.40"></a><span id="l10.40"> };</span>
<a href="#l10.41"></a><span id="l10.41"> </span>
<a href="#l10.42"></a><span id="l10.42"> function run_test()</span>
<a href="#l10.43"></a><span id="l10.43"> {</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l11.1"></a><span id="l11.1" class="difflineminus">--- a/mailnews/base/test/unit/test_searchBoolean.js</span>
<a href="#l11.2"></a><span id="l11.2" class="difflineplus">+++ b/mailnews/base/test/unit/test_searchBoolean.js</span>
<a href="#l11.3"></a><span id="l11.3" class="difflineat">@@ -1,18 +1,17 @@</span>
<a href="#l11.4"></a><span id="l11.4"> /* This Source Code Form is subject to the terms of the Mozilla Public</span>
<a href="#l11.5"></a><span id="l11.5">  * License, v. 2.0. If a copy of the MPL was not distributed with this</span>
<a href="#l11.6"></a><span id="l11.6">  * file, You can obtain one at http://mozilla.org/MPL/2.0/. */</span>
<a href="#l11.7"></a><span id="l11.7"> </span>
<a href="#l11.8"></a><span id="l11.8"> /*</span>
<a href="#l11.9"></a><span id="l11.9">  * Demonstrates and tests the use of grouped boolean expressions in search terms</span>
<a href="#l11.10"></a><span id="l11.10">  */</span>
<a href="#l11.11"></a><span id="l11.11">  </span>
<a href="#l11.12"></a><span id="l11.12" class="difflineminus">-const gCopyService = Cc[&quot;@mozilla.org/messenger/messagecopyservice;1&quot;]</span>
<a href="#l11.13"></a><span id="l11.13" class="difflineminus">-                      .getService(Ci.nsIMsgCopyService);</span>
<a href="#l11.14"></a><span id="l11.14" class="difflineplus">+Components.utils.import(&quot;resource:///modules/mailServices.js&quot;);</span>
<a href="#l11.15"></a><span id="l11.15"> </span>
<a href="#l11.16"></a><span id="l11.16"> const gSearchSession = Cc[&quot;@mozilla.org/messenger/searchSession;1&quot;]</span>
<a href="#l11.17"></a><span id="l11.17">                         .createInstance(Ci.nsIMsgSearchSession);</span>
<a href="#l11.18"></a><span id="l11.18"> </span>
<a href="#l11.19"></a><span id="l11.19"> let gHdr; // the message header for the one mailbox message</span>
<a href="#l11.20"></a><span id="l11.20"> </span>
<a href="#l11.21"></a><span id="l11.21"> var Tests =</span>
<a href="#l11.22"></a><span id="l11.22"> [</span>
<a href="#l11.23"></a><span id="l11.23" class="difflineat">@@ -157,18 +156,18 @@ function run_test()</span>
<a href="#l11.24"></a><span id="l11.24">     SetMessageId: function(aMessageId) {},</span>
<a href="#l11.25"></a><span id="l11.25">     OnStopCopy: function(aStatus) { testSearch();}</span>
<a href="#l11.26"></a><span id="l11.26">   };</span>
<a href="#l11.27"></a><span id="l11.27"> </span>
<a href="#l11.28"></a><span id="l11.28">   // Get a message into the local filestore. function testSearch() continues</span>
<a href="#l11.29"></a><span id="l11.29">   // the testing after the copy.</span>
<a href="#l11.30"></a><span id="l11.30">   var bugmail1 = do_get_file(&quot;../../../data/bugmail1&quot;);</span>
<a href="#l11.31"></a><span id="l11.31">   do_test_pending();</span>
<a href="#l11.32"></a><span id="l11.32" class="difflineminus">-  gCopyService.CopyFileMessage(bugmail1, gLocalInboxFolder, null, false, 0,</span>
<a href="#l11.33"></a><span id="l11.33" class="difflineminus">-                              &quot;&quot;, copyListener, null);</span>
<a href="#l11.34"></a><span id="l11.34" class="difflineplus">+  MailServices.copy.CopyFileMessage(bugmail1, gLocalInboxFolder, null, false, 0,</span>
<a href="#l11.35"></a><span id="l11.35" class="difflineplus">+                                    &quot;&quot;, copyListener, null);</span>
<a href="#l11.36"></a><span id="l11.36"> }</span>
<a href="#l11.37"></a><span id="l11.37"> </span>
<a href="#l11.38"></a><span id="l11.38"> let gTest = null;</span>
<a href="#l11.39"></a><span id="l11.39"> // process each test from queue, calls itself upon completion of each search</span>
<a href="#l11.40"></a><span id="l11.40"> function testSearch()</span>
<a href="#l11.41"></a><span id="l11.41"> {</span>
<a href="#l11.42"></a><span id="l11.42">   // tests the previous search</span>
<a href="#l11.43"></a><span id="l11.43">   if (gTest)</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l12.1"></a><span id="l12.1" class="difflineminus">--- a/mailnews/base/test/unit/test_searchChaining.js</span>
<a href="#l12.2"></a><span id="l12.2" class="difflineplus">+++ b/mailnews/base/test/unit/test_searchChaining.js</span>
<a href="#l12.3"></a><span id="l12.3" class="difflineat">@@ -5,16 +5,18 @@</span>
<a href="#l12.4"></a><span id="l12.4"> // Test of chaining of search scopes in a search session. In particular,</span>
<a href="#l12.5"></a><span id="l12.5"> //  Bug 541969 made us not search an imap folder if the search scope before it</span>
<a href="#l12.6"></a><span id="l12.6"> // there was an empty local folder.</span>
<a href="#l12.7"></a><span id="l12.7"> </span>
<a href="#l12.8"></a><span id="l12.8"> // main test</span>
<a href="#l12.9"></a><span id="l12.9"> </span>
<a href="#l12.10"></a><span id="l12.10"> load(&quot;../../../resources/messageGenerator.js&quot;);</span>
<a href="#l12.11"></a><span id="l12.11"> </span>
<a href="#l12.12"></a><span id="l12.12" class="difflineplus">+Components.utils.import(&quot;resource:///modules/mailServices.js&quot;);</span>
<a href="#l12.13"></a><span id="l12.13" class="difflineplus">+</span>
<a href="#l12.14"></a><span id="l12.14"> var gIMAPInbox;</span>
<a href="#l12.15"></a><span id="l12.15"> var gIMAPDaemon, gServer, gIMAPIncomingServer;</span>
<a href="#l12.16"></a><span id="l12.16"> </span>
<a href="#l12.17"></a><span id="l12.17"> function run_test()</span>
<a href="#l12.18"></a><span id="l12.18"> {</span>
<a href="#l12.19"></a><span id="l12.19">   // Pull in the IMAP fake server code</span>
<a href="#l12.20"></a><span id="l12.20">   load(&quot;../../../imap/test/unit/head_server.js&quot;);</span>
<a href="#l12.21"></a><span id="l12.21"> </span>
<a href="#l12.22"></a><span id="l12.22" class="difflineat">@@ -25,27 +27,25 @@ function run_test()</span>
<a href="#l12.23"></a><span id="l12.23">    */</span>
<a href="#l12.24"></a><span id="l12.24">   let IMAPDaemon = new imapDaemon();</span>
<a href="#l12.25"></a><span id="l12.25">   gServer = makeServer(IMAPDaemon, &quot;&quot;);</span>
<a href="#l12.26"></a><span id="l12.26">   IMAPDaemon.createMailbox(&quot;secondFolder&quot;, {subscribed : true});</span>
<a href="#l12.27"></a><span id="l12.27">   gIMAPIncomingServer = createLocalIMAPServer();</span>
<a href="#l12.28"></a><span id="l12.28">   gIMAPIncomingServer.maximumConnectionsNumber = 1;</span>
<a href="#l12.29"></a><span id="l12.29"> </span>
<a href="#l12.30"></a><span id="l12.30">   // We need an identity so that updateFolder doesn't fail</span>
<a href="#l12.31"></a><span id="l12.31" class="difflineminus">-  let acctMgr = Cc[&quot;@mozilla.org/messenger/account-manager;1&quot;]</span>
<a href="#l12.32"></a><span id="l12.32" class="difflineminus">-  .getService(Ci.nsIMsgAccountManager);</span>
<a href="#l12.33"></a><span id="l12.33" class="difflineminus">-  let localAccount = acctMgr.createAccount();</span>
<a href="#l12.34"></a><span id="l12.34" class="difflineminus">-  let identity = acctMgr.createIdentity();</span>
<a href="#l12.35"></a><span id="l12.35" class="difflineplus">+  let localAccount = MailServices.accounts.createAccount();</span>
<a href="#l12.36"></a><span id="l12.36" class="difflineplus">+  let identity = MailServices.accounts.createIdentity();</span>
<a href="#l12.37"></a><span id="l12.37">   localAccount.addIdentity(identity);</span>
<a href="#l12.38"></a><span id="l12.38">   localAccount.defaultIdentity = identity;</span>
<a href="#l12.39"></a><span id="l12.39">   localAccount.incomingServer = gLocalIncomingServer;</span>
<a href="#l12.40"></a><span id="l12.40" class="difflineminus">-  acctMgr.defaultAccount = localAccount;</span>
<a href="#l12.41"></a><span id="l12.41" class="difflineplus">+  MailServices.accounts.defaultAccount = localAccount;</span>
<a href="#l12.42"></a><span id="l12.42">   </span>
<a href="#l12.43"></a><span id="l12.43">   // Let's also have another account, using the same identity</span>
<a href="#l12.44"></a><span id="l12.44" class="difflineminus">-  let imapAccount = acctMgr.createAccount();</span>
<a href="#l12.45"></a><span id="l12.45" class="difflineplus">+  let imapAccount = MailServices.accounts.createAccount();</span>
<a href="#l12.46"></a><span id="l12.46">   imapAccount.addIdentity(identity);</span>
<a href="#l12.47"></a><span id="l12.47">   imapAccount.defaultIdentity = identity;</span>
<a href="#l12.48"></a><span id="l12.48">   imapAccount.incomingServer = gIMAPIncomingServer;</span>
<a href="#l12.49"></a><span id="l12.49">   </span>
<a href="#l12.50"></a><span id="l12.50">   // pref tuning: one connection only, turn off notifications</span>
<a href="#l12.51"></a><span id="l12.51">   Services.prefs.setBoolPref(&quot;mail.biff.play_sound&quot;, false);</span>
<a href="#l12.52"></a><span id="l12.52">   Services.prefs.setBoolPref(&quot;mail.biff.show_alert&quot;, false);</span>
<a href="#l12.53"></a><span id="l12.53">   Services.prefs.setBoolPref(&quot;mail.biff.show_tray_icon&quot;, false);</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l13.1"></a><span id="l13.1" class="difflineminus">--- a/mailnews/base/test/unit/test_searchCustomTerm.js</span>
<a href="#l13.2"></a><span id="l13.2" class="difflineplus">+++ b/mailnews/base/test/unit/test_searchCustomTerm.js</span>
<a href="#l13.3"></a><span id="l13.3" class="difflineat">@@ -3,18 +3,17 @@</span>
<a href="#l13.4"></a><span id="l13.4">  * file, You can obtain one at http://mozilla.org/MPL/2.0/. */</span>
<a href="#l13.5"></a><span id="l13.5"> </span>
<a href="#l13.6"></a><span id="l13.6"> /*</span>
<a href="#l13.7"></a><span id="l13.7">  * Testing of custom search features.</span>
<a href="#l13.8"></a><span id="l13.8">  *</span>
<a href="#l13.9"></a><span id="l13.9">  */</span>
<a href="#l13.10"></a><span id="l13.10"> load(&quot;../../../resources/searchTestUtils.js&quot;);</span>
<a href="#l13.11"></a><span id="l13.11"> </span>
<a href="#l13.12"></a><span id="l13.12" class="difflineminus">-const copyService = Cc[&quot;@mozilla.org/messenger/messagecopyservice;1&quot;]</span>
<a href="#l13.13"></a><span id="l13.13" class="difflineminus">-                      .getService(Ci.nsIMsgCopyService);</span>
<a href="#l13.14"></a><span id="l13.14" class="difflineplus">+Components.utils.import(&quot;resource:///modules/mailServices.js&quot;);</span>
<a href="#l13.15"></a><span id="l13.15"> </span>
<a href="#l13.16"></a><span id="l13.16"> const kCustomId = &quot;xpcomtest@mozilla.org#test&quot;;</span>
<a href="#l13.17"></a><span id="l13.17"> var gHdr;</span>
<a href="#l13.18"></a><span id="l13.18"> </span>
<a href="#l13.19"></a><span id="l13.19"> var Tests =</span>
<a href="#l13.20"></a><span id="l13.20"> [</span>
<a href="#l13.21"></a><span id="l13.21">   { setValue: &quot;iamgood&quot;,</span>
<a href="#l13.22"></a><span id="l13.22">     testValue: &quot;iamnotgood&quot;,</span>
<a href="#l13.23"></a><span id="l13.23" class="difflineat">@@ -56,36 +55,34 @@ var customTerm =</span>
<a href="#l13.24"></a><span id="l13.24">       }</span>
<a href="#l13.25"></a><span id="l13.25">       return false;</span>
<a href="#l13.26"></a><span id="l13.26">     }</span>
<a href="#l13.27"></a><span id="l13.27"> };</span>
<a href="#l13.28"></a><span id="l13.28"> </span>
<a href="#l13.29"></a><span id="l13.29"> function run_test()</span>
<a href="#l13.30"></a><span id="l13.30"> {</span>
<a href="#l13.31"></a><span id="l13.31">   loadLocalMailAccount();</span>
<a href="#l13.32"></a><span id="l13.32" class="difflineminus">-  let filterService = Cc[&quot;@mozilla.org/messenger/services/filters;1&quot;]</span>
<a href="#l13.33"></a><span id="l13.33" class="difflineminus">-                        .getService(Ci.nsIMsgFilterService);</span>
<a href="#l13.34"></a><span id="l13.34" class="difflineminus">-  filterService.addCustomTerm(customTerm);</span>
<a href="#l13.35"></a><span id="l13.35" class="difflineplus">+  MailServices.filters.addCustomTerm(customTerm);</span>
<a href="#l13.36"></a><span id="l13.36"> </span>
<a href="#l13.37"></a><span id="l13.37">   var copyListener = </span>
<a href="#l13.38"></a><span id="l13.38">   {</span>
<a href="#l13.39"></a><span id="l13.39">     OnStartCopy: function() {},</span>
<a href="#l13.40"></a><span id="l13.40">     OnProgress: function(aProgress, aProgressMax) {},</span>
<a href="#l13.41"></a><span id="l13.41">     SetMessageKey: function(aKey) { gHdr = gLocalInboxFolder.GetMessageHeader(aKey);},</span>
<a href="#l13.42"></a><span id="l13.42">     SetMessageId: function(aMessageId) {},</span>
<a href="#l13.43"></a><span id="l13.43">     OnStopCopy: function(aStatus) { doTest();}</span>
<a href="#l13.44"></a><span id="l13.44">   };</span>
<a href="#l13.45"></a><span id="l13.45"> </span>
<a href="#l13.46"></a><span id="l13.46">   // Get a message into the local filestore.</span>
<a href="#l13.47"></a><span id="l13.47">   // function testSearch() continues the testing after the copy.</span>
<a href="#l13.48"></a><span id="l13.48">   let bugmail1 = do_get_file(&quot;../../../data/bugmail1&quot;);</span>
<a href="#l13.49"></a><span id="l13.49">   do_test_pending();</span>
<a href="#l13.50"></a><span id="l13.50"> </span>
<a href="#l13.51"></a><span id="l13.51" class="difflineminus">-  copyService.CopyFileMessage(bugmail1, gLocalInboxFolder, null, false, 0,</span>
<a href="#l13.52"></a><span id="l13.52" class="difflineminus">-                              &quot;&quot;, copyListener, null);</span>
<a href="#l13.53"></a><span id="l13.53" class="difflineplus">+  MailServices.copy.CopyFileMessage(bugmail1, gLocalInboxFolder, null, false, 0,</span>
<a href="#l13.54"></a><span id="l13.54" class="difflineplus">+                                    &quot;&quot;, copyListener, null);</span>
<a href="#l13.55"></a><span id="l13.55"> }</span>
<a href="#l13.56"></a><span id="l13.56"> </span>
<a href="#l13.57"></a><span id="l13.57"> var testObject;</span>
<a href="#l13.58"></a><span id="l13.58"> </span>
<a href="#l13.59"></a><span id="l13.59"> function doTest()</span>
<a href="#l13.60"></a><span id="l13.60"> {</span>
<a href="#l13.61"></a><span id="l13.61">   let test = Tests.shift();</span>
<a href="#l13.62"></a><span id="l13.62">   if (test)</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l14.1"></a><span id="l14.1" class="difflineminus">--- a/mailnews/base/test/unit/test_searchJunk.js</span>
<a href="#l14.2"></a><span id="l14.2" class="difflineplus">+++ b/mailnews/base/test/unit/test_searchJunk.js</span>
<a href="#l14.3"></a><span id="l14.3" class="difflineat">@@ -1,18 +1,17 @@</span>
<a href="#l14.4"></a><span id="l14.4"> /* This Source Code Form is subject to the terms of the Mozilla Public</span>
<a href="#l14.5"></a><span id="l14.5">  * License, v. 2.0. If a copy of the MPL was not distributed with this</span>
<a href="#l14.6"></a><span id="l14.6">  * file, You can obtain one at http://mozilla.org/MPL/2.0/. */</span>
<a href="#l14.7"></a><span id="l14.7"> </span>
<a href="#l14.8"></a><span id="l14.8"> // Testing of search by junk percent and junk score origin</span>
<a href="#l14.9"></a><span id="l14.9"> </span>
<a href="#l14.10"></a><span id="l14.10"> load(&quot;../../../resources/searchTestUtils.js&quot;);</span>
<a href="#l14.11"></a><span id="l14.11"> </span>
<a href="#l14.12"></a><span id="l14.12" class="difflineminus">-const copyService = Cc[&quot;@mozilla.org/messenger/messagecopyservice;1&quot;]</span>
<a href="#l14.13"></a><span id="l14.13" class="difflineminus">-                      .getService(Ci.nsIMsgCopyService);</span>
<a href="#l14.14"></a><span id="l14.14" class="difflineplus">+Components.utils.import(&quot;resource:///modules/mailServices.js&quot;);</span>
<a href="#l14.15"></a><span id="l14.15"> </span>
<a href="#l14.16"></a><span id="l14.16"> const nsMsgSearchScope = Ci.nsMsgSearchScope;</span>
<a href="#l14.17"></a><span id="l14.17"> const nsMsgSearchAttrib = Ci.nsMsgSearchAttrib;</span>
<a href="#l14.18"></a><span id="l14.18"> const nsMsgSearchOp = Ci.nsMsgSearchOp;</span>
<a href="#l14.19"></a><span id="l14.19"> </span>
<a href="#l14.20"></a><span id="l14.20"> const IsGreaterThan = nsMsgSearchOp.IsGreaterThan;</span>
<a href="#l14.21"></a><span id="l14.21"> const IsLessThan = nsMsgSearchOp.IsLessThan;</span>
<a href="#l14.22"></a><span id="l14.22"> const Is = nsMsgSearchOp.Is;</span>
<a href="#l14.23"></a><span id="l14.23" class="difflineat">@@ -225,18 +224,18 @@ function run_test()</span>
<a href="#l14.24"></a><span id="l14.24">   testValidityTable(offlineMail, Is, JunkScoreOrigin, true);</span>
<a href="#l14.25"></a><span id="l14.25">   testValidityTable(offlineMail, Isnt, JunkScoreOrigin, true);</span>
<a href="#l14.26"></a><span id="l14.26">   testValidityTable(offlineMail, IsGreaterThan, JunkScoreOrigin, false);</span>
<a href="#l14.27"></a><span id="l14.27">   testValidityTable(offlineMail, IsLessThan, JunkScoreOrigin, false);</span>
<a href="#l14.28"></a><span id="l14.28"> </span>
<a href="#l14.29"></a><span id="l14.29">   // Get a message into the local filestore. function testJunkSearch() continues the testing after the copy.</span>
<a href="#l14.30"></a><span id="l14.30">   do_test_pending();</span>
<a href="#l14.31"></a><span id="l14.31">   var file = do_get_file(fileName);</span>
<a href="#l14.32"></a><span id="l14.32" class="difflineminus">-  copyService.CopyFileMessage(file, gLocalInboxFolder, null, false, 0,</span>
<a href="#l14.33"></a><span id="l14.33" class="difflineminus">-                              &quot;&quot;, copyListener, null);</span>
<a href="#l14.34"></a><span id="l14.34" class="difflineplus">+  MailServices.copy.CopyFileMessage(file, gLocalInboxFolder, null, false, 0,</span>
<a href="#l14.35"></a><span id="l14.35" class="difflineplus">+                                    &quot;&quot;, copyListener, null);</span>
<a href="#l14.36"></a><span id="l14.36">   return true;</span>
<a href="#l14.37"></a><span id="l14.37"> }</span>
<a href="#l14.38"></a><span id="l14.38"> </span>
<a href="#l14.39"></a><span id="l14.39"> var hdr;</span>
<a href="#l14.40"></a><span id="l14.40"> var copyListener = </span>
<a href="#l14.41"></a><span id="l14.41"> {</span>
<a href="#l14.42"></a><span id="l14.42">   OnStartCopy: function() {},</span>
<a href="#l14.43"></a><span id="l14.43">   OnProgress: function(aProgress, aProgressMax) {},</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l15.1"></a><span id="l15.1" class="difflineminus">--- a/mailnews/base/test/unit/test_searchTag.js</span>
<a href="#l15.2"></a><span id="l15.2" class="difflineplus">+++ b/mailnews/base/test/unit/test_searchTag.js</span>
<a href="#l15.3"></a><span id="l15.3" class="difflineat">@@ -6,20 +6,17 @@</span>
<a href="#l15.4"></a><span id="l15.4">  * Testing of tag search features.</span>
<a href="#l15.5"></a><span id="l15.5">  *</span>
<a href="#l15.6"></a><span id="l15.6">  * Specifically tests changes implemented in bug 217034</span>
<a href="#l15.7"></a><span id="l15.7">  * Does not do comprehensive testing.</span>
<a href="#l15.8"></a><span id="l15.8">  *</span>
<a href="#l15.9"></a><span id="l15.9">  */</span>
<a href="#l15.10"></a><span id="l15.10"> load(&quot;../../../resources/searchTestUtils.js&quot;);</span>
<a href="#l15.11"></a><span id="l15.11"> </span>
<a href="#l15.12"></a><span id="l15.12" class="difflineminus">-const tagService = Cc[&quot;@mozilla.org/messenger/tagservice;1&quot;]</span>
<a href="#l15.13"></a><span id="l15.13" class="difflineminus">-                     .getService(Ci.nsIMsgTagService);</span>
<a href="#l15.14"></a><span id="l15.14" class="difflineminus">-const copyService = Cc[&quot;@mozilla.org/messenger/messagecopyservice;1&quot;]</span>
<a href="#l15.15"></a><span id="l15.15" class="difflineminus">-                      .getService(Ci.nsIMsgCopyService);</span>
<a href="#l15.16"></a><span id="l15.16" class="difflineplus">+Components.utils.import(&quot;resource:///modules/mailServices.js&quot;);</span>
<a href="#l15.17"></a><span id="l15.17"> </span>
<a href="#l15.18"></a><span id="l15.18"> const nsMsgSearchScope = Ci.nsMsgSearchScope;</span>
<a href="#l15.19"></a><span id="l15.19"> const nsMsgSearchAttrib = Ci.nsMsgSearchAttrib;</span>
<a href="#l15.20"></a><span id="l15.20"> const nsMsgSearchOp = Ci.nsMsgSearchOp;</span>
<a href="#l15.21"></a><span id="l15.21"> </span>
<a href="#l15.22"></a><span id="l15.22"> const Isnt = nsMsgSearchOp.Isnt;</span>
<a href="#l15.23"></a><span id="l15.23"> const Is = nsMsgSearchOp.Is;</span>
<a href="#l15.24"></a><span id="l15.24"> const IsEmpty = nsMsgSearchOp.IsEmpty;</span>
<a href="#l15.25"></a><span id="l15.25" class="difflineat">@@ -328,38 +325,38 @@ function run_test()</span>
<a href="#l15.26"></a><span id="l15.26">   testValidityTable(news, DoesntContain, Keywords, false);</span>
<a href="#l15.27"></a><span id="l15.27">   testValidityTable(news, Is, Keywords, false);</span>
<a href="#l15.28"></a><span id="l15.28">   testValidityTable(news, Isnt, Keywords, false);</span>
<a href="#l15.29"></a><span id="l15.29">   testValidityTable(news, IsEmpty, Keywords, false);</span>
<a href="#l15.30"></a><span id="l15.30">   testValidityTable(news, IsntEmpty, Keywords, false);</span>
<a href="#l15.31"></a><span id="l15.31">   testValidityTable(news, IsBefore, Keywords, false);</span>
<a href="#l15.32"></a><span id="l15.32"> </span>
<a href="#l15.33"></a><span id="l15.33">   // delete any existing tags</span>
<a href="#l15.34"></a><span id="l15.34" class="difflineminus">-  var tagArray = tagService.getAllTags({});</span>
<a href="#l15.35"></a><span id="l15.35" class="difflineplus">+  let tagArray = MailServices.tags.getAllTags({});</span>
<a href="#l15.36"></a><span id="l15.36">   for (var i = 0; i &lt; tagArray.length; i++)</span>
<a href="#l15.37"></a><span id="l15.37" class="difflineminus">-    tagService.deleteKey(tagArray[i].key);</span>
<a href="#l15.38"></a><span id="l15.38" class="difflineplus">+    MailServices.tags.deleteKey(tagArray[i].key);</span>
<a href="#l15.39"></a><span id="l15.39"> </span>
<a href="#l15.40"></a><span id="l15.40">   // add as valid tags Tag1 and Tag4</span>
<a href="#l15.41"></a><span id="l15.41" class="difflineminus">-  tagService.addTagForKey(Tag1, Tag1, null, null);</span>
<a href="#l15.42"></a><span id="l15.42" class="difflineminus">-  tagService.addTagForKey(Tag4, Tag4, null, null);</span>
<a href="#l15.43"></a><span id="l15.43" class="difflineplus">+  MailServices.tags.addTagForKey(Tag1, Tag1, null, null);</span>
<a href="#l15.44"></a><span id="l15.44" class="difflineplus">+  MailServices.tags.addTagForKey(Tag4, Tag4, null, null);</span>
<a href="#l15.45"></a><span id="l15.45"> </span>
<a href="#l15.46"></a><span id="l15.46">   var copyListener = </span>
<a href="#l15.47"></a><span id="l15.47">   {</span>
<a href="#l15.48"></a><span id="l15.48">     OnStartCopy: function() {},</span>
<a href="#l15.49"></a><span id="l15.49">     OnProgress: function(aProgress, aProgressMax) {},</span>
<a href="#l15.50"></a><span id="l15.50">     SetMessageKey: function(aKey) { hdr = gLocalInboxFolder.GetMessageHeader(aKey);},</span>
<a href="#l15.51"></a><span id="l15.51">     SetMessageId: function(aMessageId) {},</span>
<a href="#l15.52"></a><span id="l15.52">     OnStopCopy: function(aStatus) { testKeywordSearch();}</span>
<a href="#l15.53"></a><span id="l15.53">   };</span>
<a href="#l15.54"></a><span id="l15.54"> </span>
<a href="#l15.55"></a><span id="l15.55">   // Get a message into the local filestore. function testKeywordSearch() continues the testing after the copy.</span>
<a href="#l15.56"></a><span id="l15.56">   var bugmail1 = do_get_file(&quot;../../../data/bugmail1&quot;);</span>
<a href="#l15.57"></a><span id="l15.57">   do_test_pending();</span>
<a href="#l15.58"></a><span id="l15.58" class="difflineminus">-  copyService.CopyFileMessage(bugmail1, gLocalInboxFolder, null, false, 0,</span>
<a href="#l15.59"></a><span id="l15.59" class="difflineminus">-                              &quot;&quot;, copyListener, null);</span>
<a href="#l15.60"></a><span id="l15.60" class="difflineplus">+  MailServices.copy.CopyFileMessage(bugmail1, gLocalInboxFolder, null, false, 0,</span>
<a href="#l15.61"></a><span id="l15.61" class="difflineplus">+                                    &quot;&quot;, copyListener, null);</span>
<a href="#l15.62"></a><span id="l15.62"> }</span>
<a href="#l15.63"></a><span id="l15.63"> </span>
<a href="#l15.64"></a><span id="l15.64"> // process each test from queue, calls itself upon completion of each search</span>
<a href="#l15.65"></a><span id="l15.65"> var testObject;</span>
<a href="#l15.66"></a><span id="l15.66"> function testKeywordSearch()</span>
<a href="#l15.67"></a><span id="l15.67"> {</span>
<a href="#l15.68"></a><span id="l15.68">   var test = Tests.shift();</span>
<a href="#l15.69"></a><span id="l15.69">   if (test)</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l16.1"></a><span id="l16.1" class="difflineminus">--- a/mailnews/base/test/unit/test_searchUint32HdrProperty.js</span>
<a href="#l16.2"></a><span id="l16.2" class="difflineplus">+++ b/mailnews/base/test/unit/test_searchUint32HdrProperty.js</span>
<a href="#l16.3"></a><span id="l16.3" class="difflineat">@@ -3,18 +3,17 @@</span>
<a href="#l16.4"></a><span id="l16.4">  * file, You can obtain one at http://mozilla.org/MPL/2.0/. */</span>
<a href="#l16.5"></a><span id="l16.5"> </span>
<a href="#l16.6"></a><span id="l16.6"> /*</span>
<a href="#l16.7"></a><span id="l16.7">  * Testing of Uint32HdrProperty search attribute. Adapted from test_search.js</span>
<a href="#l16.8"></a><span id="l16.8">  */</span>
<a href="#l16.9"></a><span id="l16.9">  </span>
<a href="#l16.10"></a><span id="l16.10"> load(&quot;../../../resources/searchTestUtils.js&quot;);</span>
<a href="#l16.11"></a><span id="l16.11"> </span>
<a href="#l16.12"></a><span id="l16.12" class="difflineminus">-const copyService = Cc[&quot;@mozilla.org/messenger/messagecopyservice;1&quot;]</span>
<a href="#l16.13"></a><span id="l16.13" class="difflineminus">-                      .getService(Ci.nsIMsgCopyService);</span>
<a href="#l16.14"></a><span id="l16.14" class="difflineplus">+Components.utils.import(&quot;resource:///modules/mailServices.js&quot;);</span>
<a href="#l16.15"></a><span id="l16.15"> </span>
<a href="#l16.16"></a><span id="l16.16"> const nsMsgSearchAttrib = Ci.nsMsgSearchAttrib;</span>
<a href="#l16.17"></a><span id="l16.17"> const nsMsgSearchOp = Ci.nsMsgSearchOp;</span>
<a href="#l16.18"></a><span id="l16.18"> </span>
<a href="#l16.19"></a><span id="l16.19"> const Isnt = nsMsgSearchOp.Isnt;</span>
<a href="#l16.20"></a><span id="l16.20"> const Is = nsMsgSearchOp.Is;</span>
<a href="#l16.21"></a><span id="l16.21"> const IsGreaterThan = nsMsgSearchOp.IsGreaterThan;</span>
<a href="#l16.22"></a><span id="l16.22"> const IsLessThan = nsMsgSearchOp.IsLessThan;</span>
<a href="#l16.23"></a><span id="l16.23" class="difflineat">@@ -84,18 +83,18 @@ function run_test()</span>
<a href="#l16.24"></a><span id="l16.24">     SetMessageId: function(aMessageId) {},</span>
<a href="#l16.25"></a><span id="l16.25">     OnStopCopy: function(aStatus) { testSearch();}</span>
<a href="#l16.26"></a><span id="l16.26">   };</span>
<a href="#l16.27"></a><span id="l16.27"> </span>
<a href="#l16.28"></a><span id="l16.28">   // Get a message into the local filestore. function testSearch() continues</span>
<a href="#l16.29"></a><span id="l16.29">   // the testing after the copy.</span>
<a href="#l16.30"></a><span id="l16.30">   var bugmail1 = do_get_file(&quot;../../../data/bugmail1&quot;);</span>
<a href="#l16.31"></a><span id="l16.31">   do_test_pending();</span>
<a href="#l16.32"></a><span id="l16.32" class="difflineminus">-  copyService.CopyFileMessage(bugmail1, gLocalInboxFolder, null, false, 0,</span>
<a href="#l16.33"></a><span id="l16.33" class="difflineminus">-                              &quot;&quot;, copyListener, null);</span>
<a href="#l16.34"></a><span id="l16.34" class="difflineplus">+  MailServices.copy.CopyFileMessage(bugmail1, gLocalInboxFolder, null, false, 0,</span>
<a href="#l16.35"></a><span id="l16.35" class="difflineplus">+                                    &quot;&quot;, copyListener, null);</span>
<a href="#l16.36"></a><span id="l16.36"> }</span>
<a href="#l16.37"></a><span id="l16.37"> </span>
<a href="#l16.38"></a><span id="l16.38"> // process each test from queue, calls itself upon completion of each search</span>
<a href="#l16.39"></a><span id="l16.39"> var testObject;</span>
<a href="#l16.40"></a><span id="l16.40"> function testSearch()</span>
<a href="#l16.41"></a><span id="l16.41"> {</span>
<a href="#l16.42"></a><span id="l16.42">   var test = Tests.shift();</span>
<a href="#l16.43"></a><span id="l16.43">   if (test)</span></pre></div></div>

<div class="page_footer">
<div class="page_footer_text">comm-central</div>
<div class="page_footer_text" style="padding-left: 10px">Deployed from <a href="https://hg.mozilla.org/hgcustom/version-control-tools/rev/35f393d6769a">35f393d6769a</a> at 2020-07-16T17:23:43Z.</div>
<div class="rss_logo">
<a href="/comm-central/rss-log">RSS</a>
<a href="/comm-central/atom-log">Atom</a>
</div>
<br />

</div>
</body>
</html>

