<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en-US" lang="en-US">
<head>
<link rel="icon" href="/static/35f393d6769a/hgicon.png" type="image/png" />
<meta name="robots" content="index, nofollow"/>
<link rel="stylesheet" href="/static/35f393d6769a/style-gitweb.css" type="text/css" />

<style type="text/css">
div.feed {
  float: right;
}
a img {
  border-width: 0px;
}
div.log_link {
  width: 80px;
  background-color: white;
}

div.log_body {
  padding-left: 96px;
}
</style>
<script type="text/javascript" src="/static/35f393d6769a/mercurial.js"></script>

<meta property="og:image" content="/static/35f393d6769a/moz-logo-bw-rgb.svg"/>
<meta property="og:type" content="website"/>

<title>comm-central: changeset 21183:541879fbcbe89ae7827850d6807e17ca95013eb2</title>
<link rel="alternate" type="application/atom+xml"
   href="/comm-central/atom-log" title="Atom feed for comm-central"/>
<link rel="alternate" type="application/rss+xml"
   href="/comm-central/rss-log" title="RSS feed for comm-central"/>

<meta property="og:title" content="comm-central @ 541879fbcbe89ae7827850d6807e17ca95013eb2" />
<meta property="og:url" content="/comm-central/rev/541879fbcbe89ae7827850d6807e17ca95013eb2" />
<meta property="og:description" content="Bug 1340755 - fix format specifiers in mailnews after bug 1060419. r=jorgk CLOSED TREE a=jorgk" />

</head>
<body>

<div class="page_header">
<div class="logo">
    <a href="https://developer.mozilla.org/en/docs/Mercurial">
        <img src="/static/35f393d6769a/moz-logo-bw-rgb.svg" alt="mercurial" />
    </a>
</div>
<a href="/">Mercurial</a> &gt; <a href="/comm-central">comm-central</a>  / changeset / 541879fbcbe89ae7827850d6807e17ca95013eb2 
</div>

<div class="page_nav">
<div>
<a href="/comm-central/summary">summary</a> |
<a href="/comm-central/shortlog/541879fbcbe89ae7827850d6807e17ca95013eb2">shortlog</a> |
<a href="/comm-central/log/541879fbcbe89ae7827850d6807e17ca95013eb2">changelog</a> |
<a href="/comm-central/pushloghtml">pushlog</a> |
<a href="/comm-central/graph/541879fbcbe89ae7827850d6807e17ca95013eb2">graph</a> |
<a href="/comm-central/tags">tags</a> |
<a href="/comm-central/bookmarks">bookmarks</a> |
<a href="/comm-central/branches">branches</a> |
<a href="/comm-central/file/541879fbcbe89ae7827850d6807e17ca95013eb2">files</a> |
changeset |
<a href="/comm-central/raw-rev/541879fbcbe89ae7827850d6807e17ca95013eb2">raw</a>  | <a href="/comm-central/archive/541879fbcbe89ae7827850d6807e17ca95013eb2.zip">zip</a>  |
<a href="/comm-central/help">help</a>
</div>

<div class="search">
<form id="searchform" action="/comm-central/log">

<input name="rev" type="text" value="" size="40" />
<div id="hint">Find changesets by keywords (author, files, the commit message), revision
number or hash, or <a href="/comm-central/help/revsets">revset expression</a>.</div>
</form>
</div>
</div>

<div class="title">
<a href="https://bugzilla.mozilla.org/show_bug.cgi?id=1340755">Bug 1340755</a> - fix format specifiers in mailnews after <a href="https://bugzilla.mozilla.org/show_bug.cgi?id=1060419">bug 1060419</a>. r=jorgk CLOSED TREE a=jorgk
<span class="logtags"></span>
</div>
<div class="title_text">
<table cellspacing="0">

<tr><td>author</td><td>&#97;&#99;&#101;&#109;&#97;&#110;&#32;&#60;&#97;&#99;&#101;&#108;&#105;&#115;&#116;&#115;&#64;&#97;&#116;&#108;&#97;&#115;&#46;&#115;&#107;&#62;</td></tr>
<tr><td></td><td class="date age">Sat, 18 Feb 2017 21:19:45 +0100</td></tr>

<tr>
 <td>changeset 21183</td>
 <td style="font-family:monospace"><a class="list" href="/comm-central/rev/541879fbcbe89ae7827850d6807e17ca95013eb2">541879fbcbe89ae7827850d6807e17ca95013eb2</a></td>
</tr>



<tr>
<td>parent 21182</td>
<td style="font-family:monospace">
<a class="list" href="/comm-central/rev/a0b08cd9413318c9df52e05f747ea42c64dc04fb">a0b08cd9413318c9df52e05f747ea42c64dc04fb</a>
</td>
</tr>

<tr>
<td>child 21184</td>
<td style="font-family:monospace">
<a class="list" href="/comm-central/rev/74c720dd3c6f0b71e0846f1df98fadf035cfc93a">74c720dd3c6f0b71e0846f1df98fadf035cfc93a</a>
</td>
</tr>
<tr><td>push id</td><td><a href="/comm-central/pushloghtml?changeset=541879fbcbe89ae7827850d6807e17ca95013eb2">12868</a></td></tr>
<tr><td>push user</td><td>acelists@atlas.sk</td></tr>
<tr><td>push date</td><td class="date age">Sat, 18 Feb 2017 20:20:17 +0000</td></tr>

<tr><td>treeherder</td><td>comm-central@541879fbcbe8 [<a href="https://treeherder.mozilla.org/#/jobs?repo=comm-central&revision=541879fbcbe89ae7827850d6807e17ca95013eb2">default view</a>] [<a href="https://treeherder.mozilla.org/#/jobs?repo=comm-central&revision=541879fbcbe89ae7827850d6807e17ca95013eb2&filter-resultStatus=testfailed&filter-resultStatus=busted&filter-resultStatus=exception">failures only]</td></tr>
<tr><td>perfherder</td><td>[<a href="https://treeherder.mozilla.org/perf.html#/compare?originalProject=comm-central&originalRevision=541879fbcbe89ae7827850d6807e17ca95013eb2&newProject=comm-central&newRevision=a0b08cd9413318c9df52e05f747ea42c64dc04fb&framework=1" target="_blank">talos</a>] [<a href="https://treeherder.mozilla.org/perf.html#/compare?originalProject=comm-central&originalRevision=541879fbcbe89ae7827850d6807e17ca95013eb2&newProject=comm-central&newRevision=a0b08cd9413318c9df52e05f747ea42c64dc04fb&framework=2" target="_blank">build metrics</a>] [<a href="https://treeherder.mozilla.org/perf.html#/compare?originalProject=comm-central&originalRevision=541879fbcbe89ae7827850d6807e17ca95013eb2&newProject=comm-central&newRevision=a0b08cd9413318c9df52e05f747ea42c64dc04fb&framework=6" target="_blank">platform microbench</a>] (compared to previous push)</td></tr>
<tr><td>reviewers</td><td><a href="/comm-central/log?rev=reviewer%28jorgk%29&revcount=50">jorgk</a>, <a href="/comm-central/log?rev=reviewer%28jorgk%29&revcount=50">jorgk</a></td></tr>
<tr><td>bugs</td><td><a href="https://bugzilla.mozilla.org/show_bug.cgi?id=1340755">1340755</a>, <a href="https://bugzilla.mozilla.org/show_bug.cgi?id=1060419">1060419</a></td></tr>




</table></div>

<div class="page_body description"><a href="https://bugzilla.mozilla.org/show_bug.cgi?id=1340755">Bug 1340755</a> - fix format specifiers in mailnews after <a href="https://bugzilla.mozilla.org/show_bug.cgi?id=1060419">bug 1060419</a>. r=jorgk CLOSED TREE a=jorgk</div>
<div class="list_head"></div>
<div class="title_text">
<table cellspacing="0">

<tr class="parity0">
<td><a class="list" href="/comm-central/diff/541879fbcbe89ae7827850d6807e17ca95013eb2/mailnews/base/src/nsMsgBiffManager.cpp">mailnews/base/src/nsMsgBiffManager.cpp</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/541879fbcbe89ae7827850d6807e17ca95013eb2/mailnews/base/src/nsMsgBiffManager.cpp">file</a> |
<a href="/comm-central/annotate/541879fbcbe89ae7827850d6807e17ca95013eb2/mailnews/base/src/nsMsgBiffManager.cpp">annotate</a> |
<a href="/comm-central/diff/541879fbcbe89ae7827850d6807e17ca95013eb2/mailnews/base/src/nsMsgBiffManager.cpp">diff</a> |
<a href="/comm-central/comparison/541879fbcbe89ae7827850d6807e17ca95013eb2/mailnews/base/src/nsMsgBiffManager.cpp">comparison</a> |
<a href="/comm-central/log/541879fbcbe89ae7827850d6807e17ca95013eb2/mailnews/base/src/nsMsgBiffManager.cpp">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/541879fbcbe89ae7827850d6807e17ca95013eb2/mailnews/base/src/nsMsgCopyService.cpp">mailnews/base/src/nsMsgCopyService.cpp</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/541879fbcbe89ae7827850d6807e17ca95013eb2/mailnews/base/src/nsMsgCopyService.cpp">file</a> |
<a href="/comm-central/annotate/541879fbcbe89ae7827850d6807e17ca95013eb2/mailnews/base/src/nsMsgCopyService.cpp">annotate</a> |
<a href="/comm-central/diff/541879fbcbe89ae7827850d6807e17ca95013eb2/mailnews/base/src/nsMsgCopyService.cpp">diff</a> |
<a href="/comm-central/comparison/541879fbcbe89ae7827850d6807e17ca95013eb2/mailnews/base/src/nsMsgCopyService.cpp">comparison</a> |
<a href="/comm-central/log/541879fbcbe89ae7827850d6807e17ca95013eb2/mailnews/base/src/nsMsgCopyService.cpp">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/541879fbcbe89ae7827850d6807e17ca95013eb2/mailnews/compose/src/nsSmtpProtocol.cpp">mailnews/compose/src/nsSmtpProtocol.cpp</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/541879fbcbe89ae7827850d6807e17ca95013eb2/mailnews/compose/src/nsSmtpProtocol.cpp">file</a> |
<a href="/comm-central/annotate/541879fbcbe89ae7827850d6807e17ca95013eb2/mailnews/compose/src/nsSmtpProtocol.cpp">annotate</a> |
<a href="/comm-central/diff/541879fbcbe89ae7827850d6807e17ca95013eb2/mailnews/compose/src/nsSmtpProtocol.cpp">diff</a> |
<a href="/comm-central/comparison/541879fbcbe89ae7827850d6807e17ca95013eb2/mailnews/compose/src/nsSmtpProtocol.cpp">comparison</a> |
<a href="/comm-central/log/541879fbcbe89ae7827850d6807e17ca95013eb2/mailnews/compose/src/nsSmtpProtocol.cpp">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/541879fbcbe89ae7827850d6807e17ca95013eb2/mailnews/db/msgdb/src/nsMsgDatabase.cpp">mailnews/db/msgdb/src/nsMsgDatabase.cpp</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/541879fbcbe89ae7827850d6807e17ca95013eb2/mailnews/db/msgdb/src/nsMsgDatabase.cpp">file</a> |
<a href="/comm-central/annotate/541879fbcbe89ae7827850d6807e17ca95013eb2/mailnews/db/msgdb/src/nsMsgDatabase.cpp">annotate</a> |
<a href="/comm-central/diff/541879fbcbe89ae7827850d6807e17ca95013eb2/mailnews/db/msgdb/src/nsMsgDatabase.cpp">diff</a> |
<a href="/comm-central/comparison/541879fbcbe89ae7827850d6807e17ca95013eb2/mailnews/db/msgdb/src/nsMsgDatabase.cpp">comparison</a> |
<a href="/comm-central/log/541879fbcbe89ae7827850d6807e17ca95013eb2/mailnews/db/msgdb/src/nsMsgDatabase.cpp">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/541879fbcbe89ae7827850d6807e17ca95013eb2/mailnews/imap/src/nsAutoSyncState.cpp">mailnews/imap/src/nsAutoSyncState.cpp</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/541879fbcbe89ae7827850d6807e17ca95013eb2/mailnews/imap/src/nsAutoSyncState.cpp">file</a> |
<a href="/comm-central/annotate/541879fbcbe89ae7827850d6807e17ca95013eb2/mailnews/imap/src/nsAutoSyncState.cpp">annotate</a> |
<a href="/comm-central/diff/541879fbcbe89ae7827850d6807e17ca95013eb2/mailnews/imap/src/nsAutoSyncState.cpp">diff</a> |
<a href="/comm-central/comparison/541879fbcbe89ae7827850d6807e17ca95013eb2/mailnews/imap/src/nsAutoSyncState.cpp">comparison</a> |
<a href="/comm-central/log/541879fbcbe89ae7827850d6807e17ca95013eb2/mailnews/imap/src/nsAutoSyncState.cpp">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/541879fbcbe89ae7827850d6807e17ca95013eb2/mailnews/imap/src/nsImapMailFolder.cpp">mailnews/imap/src/nsImapMailFolder.cpp</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/541879fbcbe89ae7827850d6807e17ca95013eb2/mailnews/imap/src/nsImapMailFolder.cpp">file</a> |
<a href="/comm-central/annotate/541879fbcbe89ae7827850d6807e17ca95013eb2/mailnews/imap/src/nsImapMailFolder.cpp">annotate</a> |
<a href="/comm-central/diff/541879fbcbe89ae7827850d6807e17ca95013eb2/mailnews/imap/src/nsImapMailFolder.cpp">diff</a> |
<a href="/comm-central/comparison/541879fbcbe89ae7827850d6807e17ca95013eb2/mailnews/imap/src/nsImapMailFolder.cpp">comparison</a> |
<a href="/comm-central/log/541879fbcbe89ae7827850d6807e17ca95013eb2/mailnews/imap/src/nsImapMailFolder.cpp">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/541879fbcbe89ae7827850d6807e17ca95013eb2/mailnews/imap/src/nsImapProtocol.cpp">mailnews/imap/src/nsImapProtocol.cpp</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/541879fbcbe89ae7827850d6807e17ca95013eb2/mailnews/imap/src/nsImapProtocol.cpp">file</a> |
<a href="/comm-central/annotate/541879fbcbe89ae7827850d6807e17ca95013eb2/mailnews/imap/src/nsImapProtocol.cpp">annotate</a> |
<a href="/comm-central/diff/541879fbcbe89ae7827850d6807e17ca95013eb2/mailnews/imap/src/nsImapProtocol.cpp">diff</a> |
<a href="/comm-central/comparison/541879fbcbe89ae7827850d6807e17ca95013eb2/mailnews/imap/src/nsImapProtocol.cpp">comparison</a> |
<a href="/comm-central/log/541879fbcbe89ae7827850d6807e17ca95013eb2/mailnews/imap/src/nsImapProtocol.cpp">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/541879fbcbe89ae7827850d6807e17ca95013eb2/mailnews/import/src/nsImportMail.cpp">mailnews/import/src/nsImportMail.cpp</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/541879fbcbe89ae7827850d6807e17ca95013eb2/mailnews/import/src/nsImportMail.cpp">file</a> |
<a href="/comm-central/annotate/541879fbcbe89ae7827850d6807e17ca95013eb2/mailnews/import/src/nsImportMail.cpp">annotate</a> |
<a href="/comm-central/diff/541879fbcbe89ae7827850d6807e17ca95013eb2/mailnews/import/src/nsImportMail.cpp">diff</a> |
<a href="/comm-central/comparison/541879fbcbe89ae7827850d6807e17ca95013eb2/mailnews/import/src/nsImportMail.cpp">comparison</a> |
<a href="/comm-central/log/541879fbcbe89ae7827850d6807e17ca95013eb2/mailnews/import/src/nsImportMail.cpp">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/541879fbcbe89ae7827850d6807e17ca95013eb2/mailnews/local/src/nsMovemailService.cpp">mailnews/local/src/nsMovemailService.cpp</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/541879fbcbe89ae7827850d6807e17ca95013eb2/mailnews/local/src/nsMovemailService.cpp">file</a> |
<a href="/comm-central/annotate/541879fbcbe89ae7827850d6807e17ca95013eb2/mailnews/local/src/nsMovemailService.cpp">annotate</a> |
<a href="/comm-central/diff/541879fbcbe89ae7827850d6807e17ca95013eb2/mailnews/local/src/nsMovemailService.cpp">diff</a> |
<a href="/comm-central/comparison/541879fbcbe89ae7827850d6807e17ca95013eb2/mailnews/local/src/nsMovemailService.cpp">comparison</a> |
<a href="/comm-central/log/541879fbcbe89ae7827850d6807e17ca95013eb2/mailnews/local/src/nsMovemailService.cpp">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/541879fbcbe89ae7827850d6807e17ca95013eb2/mailnews/local/src/nsPop3Protocol.cpp">mailnews/local/src/nsPop3Protocol.cpp</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/541879fbcbe89ae7827850d6807e17ca95013eb2/mailnews/local/src/nsPop3Protocol.cpp">file</a> |
<a href="/comm-central/annotate/541879fbcbe89ae7827850d6807e17ca95013eb2/mailnews/local/src/nsPop3Protocol.cpp">annotate</a> |
<a href="/comm-central/diff/541879fbcbe89ae7827850d6807e17ca95013eb2/mailnews/local/src/nsPop3Protocol.cpp">diff</a> |
<a href="/comm-central/comparison/541879fbcbe89ae7827850d6807e17ca95013eb2/mailnews/local/src/nsPop3Protocol.cpp">comparison</a> |
<a href="/comm-central/log/541879fbcbe89ae7827850d6807e17ca95013eb2/mailnews/local/src/nsPop3Protocol.cpp">revisions</a>
</td>
</tr>
</table></div>

<div class="page_body diffblocks"><div class="diffblock"><pre class="sourcelines">
<a href="#l1.1"></a><span id="l1.1" class="difflineminus">--- a/mailnews/base/src/nsMsgBiffManager.cpp</span>
<a href="#l1.2"></a><span id="l1.2" class="difflineplus">+++ b/mailnews/base/src/nsMsgBiffManager.cpp</span>
<a href="#l1.3"></a><span id="l1.3" class="difflineat">@@ -338,17 +338,17 @@ nsresult nsMsgBiffManager::PerformBiff()</span>
<a href="#l1.4"></a><span id="l1.4">       // new messages</span>
<a href="#l1.5"></a><span id="l1.5">       if (!serverBusy &amp;&amp;</span>
<a href="#l1.6"></a><span id="l1.6">           (!serverRequiresPassword || !passwordPromptRequired) &amp;&amp;</span>
<a href="#l1.7"></a><span id="l1.7">           targetFolderIndex == kNotFound)</span>
<a href="#l1.8"></a><span id="l1.8">       {</span>
<a href="#l1.9"></a><span id="l1.9">         nsCString serverKey;</span>
<a href="#l1.10"></a><span id="l1.10">         current.server-&gt;GetKey(serverKey);</span>
<a href="#l1.11"></a><span id="l1.11">         nsresult rv = current.server-&gt;PerformBiff(nullptr);</span>
<a href="#l1.12"></a><span id="l1.12" class="difflineminus">-        MOZ_LOG(MsgBiffLogModule, mozilla::LogLevel::Info, (&quot;biffing server %s rv = %x\n&quot;, serverKey.get(), rv));</span>
<a href="#l1.13"></a><span id="l1.13" class="difflineplus">+        MOZ_LOG(MsgBiffLogModule, mozilla::LogLevel::Info, (&quot;biffing server %s rv = %&quot; PRIx32 &quot;\n&quot;, serverKey.get(), static_cast&lt;uint32_t&gt;(rv)));</span>
<a href="#l1.14"></a><span id="l1.14">       }</span>
<a href="#l1.15"></a><span id="l1.15">       else</span>
<a href="#l1.16"></a><span id="l1.16">       {</span>
<a href="#l1.17"></a><span id="l1.17">         MOZ_LOG(MsgBiffLogModule, mozilla::LogLevel::Info, (&quot;not biffing server serverBusy = %d requirespassword = %d password prompt required = %d targetFolderIndex = %d\n&quot;,</span>
<a href="#l1.18"></a><span id="l1.18">           serverBusy, serverRequiresPassword, passwordPromptRequired, targetFolderIndex));</span>
<a href="#l1.19"></a><span id="l1.19">       }</span>
<a href="#l1.20"></a><span id="l1.20">       // if we didn't do this server because the destination server was already being</span>
<a href="#l1.21"></a><span id="l1.21">       // biffed into, leave this server in the biff array so it will fire next.</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l2.1"></a><span id="l2.1" class="difflineminus">--- a/mailnews/base/src/nsMsgCopyService.cpp</span>
<a href="#l2.2"></a><span id="l2.2" class="difflineplus">+++ b/mailnews/base/src/nsMsgCopyService.cpp</span>
<a href="#l2.3"></a><span id="l2.3" class="difflineat">@@ -157,17 +157,17 @@ void nsMsgCopyService::LogCopyRequest(co</span>
<a href="#l2.4"></a><span id="l2.4">     srcFolder-&gt;GetURI(srcFolderUri);</span>
<a href="#l2.5"></a><span id="l2.5">   aRequest-&gt;m_dstFolder-&gt;GetURI(destFolderUri);</span>
<a href="#l2.6"></a><span id="l2.6">   uint32_t numMsgs = 0;</span>
<a href="#l2.7"></a><span id="l2.7">   if (aRequest-&gt;m_requestType == nsCopyMessagesType &amp;&amp;</span>
<a href="#l2.8"></a><span id="l2.8">       aRequest-&gt;m_copySourceArray.Length() &gt; 0 &amp;&amp;</span>
<a href="#l2.9"></a><span id="l2.9">       aRequest-&gt;m_copySourceArray[0]-&gt;m_messageArray)</span>
<a href="#l2.10"></a><span id="l2.10">     aRequest-&gt;m_copySourceArray[0]-&gt;m_messageArray-&gt;GetLength(&amp;numMsgs);</span>
<a href="#l2.11"></a><span id="l2.11">   MOZ_LOG(gCopyServiceLog, mozilla::LogLevel::Info,</span>
<a href="#l2.12"></a><span id="l2.12" class="difflineminus">-         (&quot;request %lx %s - src %s dest %s numItems %d type=%d&quot;,</span>
<a href="#l2.13"></a><span id="l2.13" class="difflineplus">+         (&quot;request %p %s - src %s dest %s numItems %d type=%d&quot;,</span>
<a href="#l2.14"></a><span id="l2.14">          aRequest, logMsg, srcFolderUri.get(),</span>
<a href="#l2.15"></a><span id="l2.15">          destFolderUri.get(), numMsgs, aRequest-&gt;m_requestType));</span>
<a href="#l2.16"></a><span id="l2.16"> }</span>
<a href="#l2.17"></a><span id="l2.17"> </span>
<a href="#l2.18"></a><span id="l2.18"> nsresult</span>
<a href="#l2.19"></a><span id="l2.19"> nsMsgCopyService::ClearRequest(nsCopyRequest* aRequest, nsresult rv)</span>
<a href="#l2.20"></a><span id="l2.20"> {</span>
<a href="#l2.21"></a><span id="l2.21">   if (aRequest)</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l3.1"></a><span id="l3.1" class="difflineminus">--- a/mailnews/compose/src/nsSmtpProtocol.cpp</span>
<a href="#l3.2"></a><span id="l3.2" class="difflineplus">+++ b/mailnews/compose/src/nsSmtpProtocol.cpp</span>
<a href="#l3.3"></a><span id="l3.3" class="difflineat">@@ -530,26 +530,26 @@ NS_IMETHODIMP nsSmtpProtocol::OnStopRequ</span>
<a href="#l3.4"></a><span id="l3.4"> {</span>
<a href="#l3.5"></a><span id="l3.5">   bool connDroppedDuringAuth = NS_SUCCEEDED(aStatus) &amp;&amp; !m_sendDone &amp;&amp;</span>
<a href="#l3.6"></a><span id="l3.6">       (m_nextStateAfterResponse == SMTP_AUTH_LOGIN_STEP0_RESPONSE ||</span>
<a href="#l3.7"></a><span id="l3.7">        m_nextStateAfterResponse == SMTP_AUTH_LOGIN_RESPONSE);</span>
<a href="#l3.8"></a><span id="l3.8">   // ignore errors handling the QUIT command so fcc can continue.</span>
<a href="#l3.9"></a><span id="l3.9">   if (m_sendDone &amp;&amp; NS_FAILED(aStatus))</span>
<a href="#l3.10"></a><span id="l3.10">   {</span>
<a href="#l3.11"></a><span id="l3.11">     MOZ_LOG(SMTPLogModule, mozilla::LogLevel::Info,</span>
<a href="#l3.12"></a><span id="l3.12" class="difflineminus">-     (&quot;SMTP connection error quitting %lx, ignoring &quot;, aStatus));</span>
<a href="#l3.13"></a><span id="l3.13" class="difflineplus">+     (&quot;SMTP connection error quitting %&quot; PRIx32 &quot;, ignoring &quot;, static_cast&lt;uint32_t&gt;(aStatus)));</span>
<a href="#l3.14"></a><span id="l3.14">     aStatus = NS_OK;</span>
<a href="#l3.15"></a><span id="l3.15">   }</span>
<a href="#l3.16"></a><span id="l3.16">   if (NS_SUCCEEDED(aStatus) &amp;&amp; !m_sendDone) {</span>
<a href="#l3.17"></a><span id="l3.17">     // if we are getting OnStopRequest() with NS_OK,</span>
<a href="#l3.18"></a><span id="l3.18">     // but we haven't finished clean, that's spells trouble.</span>
<a href="#l3.19"></a><span id="l3.19">     // it means that the server has dropped us before we could send the whole mail</span>
<a href="#l3.20"></a><span id="l3.20">     // for example, see bug #200647</span>
<a href="#l3.21"></a><span id="l3.21">     MOZ_LOG(SMTPLogModule, mozilla::LogLevel::Info,</span>
<a href="#l3.22"></a><span id="l3.22" class="difflineminus">- (&quot;SMTP connection dropped after %ld total bytes read&quot;, m_totalAmountRead));</span>
<a href="#l3.23"></a><span id="l3.23" class="difflineplus">+ (&quot;SMTP connection dropped after %d total bytes read&quot;, m_totalAmountRead));</span>
<a href="#l3.24"></a><span id="l3.24">     if (!connDroppedDuringAuth)</span>
<a href="#l3.25"></a><span id="l3.25">       nsMsgAsyncWriteProtocol::OnStopRequest(nullptr, ctxt, NS_ERROR_NET_INTERRUPT);</span>
<a href="#l3.26"></a><span id="l3.26">   }</span>
<a href="#l3.27"></a><span id="l3.27">   else</span>
<a href="#l3.28"></a><span id="l3.28">     nsMsgAsyncWriteProtocol::OnStopRequest(nullptr, ctxt, aStatus);</span>
<a href="#l3.29"></a><span id="l3.29"> </span>
<a href="#l3.30"></a><span id="l3.30">   // okay, we've been told that the send is done and the connection is going away. So</span>
<a href="#l3.31"></a><span id="l3.31">   // we need to release all of our state</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l4.1"></a><span id="l4.1" class="difflineminus">--- a/mailnews/db/msgdb/src/nsMsgDatabase.cpp</span>
<a href="#l4.2"></a><span id="l4.2" class="difflineplus">+++ b/mailnews/db/msgdb/src/nsMsgDatabase.cpp</span>
<a href="#l4.3"></a><span id="l4.3" class="difflineat">@@ -38,16 +38,17 @@</span>
<a href="#l4.4"></a><span id="l4.4"> #include &quot;nsIPrefService.h&quot;</span>
<a href="#l4.5"></a><span id="l4.5"> #include &quot;nsIPrefBranch.h&quot;</span>
<a href="#l4.6"></a><span id="l4.6"> #include &quot;nsIMsgPluggableStore.h&quot;</span>
<a href="#l4.7"></a><span id="l4.7"> #include &quot;nsAlgorithm.h&quot;</span>
<a href="#l4.8"></a><span id="l4.8"> #include &quot;nsArrayEnumerator.h&quot;</span>
<a href="#l4.9"></a><span id="l4.9"> #include &quot;nsIMemoryReporter.h&quot;</span>
<a href="#l4.10"></a><span id="l4.10"> #include &quot;mozilla/mailnews/MimeHeaderParser.h&quot;</span>
<a href="#l4.11"></a><span id="l4.11"> #include &quot;mozilla/mailnews/Services.h&quot;</span>
<a href="#l4.12"></a><span id="l4.12" class="difflineplus">+#include &quot;mozilla/SizePrintfMacros.h&quot;</span>
<a href="#l4.13"></a><span id="l4.13"> #include &lt;algorithm&gt;</span>
<a href="#l4.14"></a><span id="l4.14"> </span>
<a href="#l4.15"></a><span id="l4.15"> using namespace mozilla::mailnews;</span>
<a href="#l4.16"></a><span id="l4.16"> using namespace mozilla;</span>
<a href="#l4.17"></a><span id="l4.17"> </span>
<a href="#l4.18"></a><span id="l4.18"> #if defined(DEBUG_sspitzer_) || defined(DEBUG_seth_)</span>
<a href="#l4.19"></a><span id="l4.19"> #define DEBUG_MSGKEYSET 1</span>
<a href="#l4.20"></a><span id="l4.20"> #endif</span>
<a href="#l4.21"></a><span id="l4.21" class="difflineat">@@ -963,22 +964,22 @@ void nsMsgDBService::AddToCache(nsMsgDat</span>
<a href="#l4.22"></a><span id="l4.22"> }</span>
<a href="#l4.23"></a><span id="l4.23"> </span>
<a href="#l4.24"></a><span id="l4.24"> /**</span>
<a href="#l4.25"></a><span id="l4.25">  * Log the open db's, and how many headers are in memory.</span>
<a href="#l4.26"></a><span id="l4.26">  */</span>
<a href="#l4.27"></a><span id="l4.27"> void nsMsgDBService::DumpCache()</span>
<a href="#l4.28"></a><span id="l4.28"> {</span>
<a href="#l4.29"></a><span id="l4.29">   nsMsgDatabase* db = nullptr;</span>
<a href="#l4.30"></a><span id="l4.30" class="difflineminus">-  MOZ_LOG(DBLog, LogLevel::Info, (&quot;%d open DB's\n&quot;, m_dbCache.Length()));</span>
<a href="#l4.31"></a><span id="l4.31" class="difflineplus">+  MOZ_LOG(DBLog, LogLevel::Info, (&quot;%&quot; PRIuSIZE &quot; open DBs\n&quot;, m_dbCache.Length()));</span>
<a href="#l4.32"></a><span id="l4.32">   for (uint32_t i = 0; i &lt; m_dbCache.Length(); i++)</span>
<a href="#l4.33"></a><span id="l4.33">   {</span>
<a href="#l4.34"></a><span id="l4.34">     db = m_dbCache.ElementAt(i);</span>
<a href="#l4.35"></a><span id="l4.35" class="difflineminus">-    MOZ_LOG(DBLog, LogLevel::Info, (&quot;%s - %ld hdrs in use\n&quot;,</span>
<a href="#l4.36"></a><span id="l4.36" class="difflineminus">-      (const char*)db-&gt;m_dbName.get(),</span>
<a href="#l4.37"></a><span id="l4.37" class="difflineplus">+    MOZ_LOG(DBLog, LogLevel::Info, (&quot;%s - %&quot; PRIu32 &quot; hdrs in use\n&quot;,</span>
<a href="#l4.38"></a><span id="l4.38" class="difflineplus">+      db-&gt;m_dbName.get(),</span>
<a href="#l4.39"></a><span id="l4.39">       db-&gt;m_headersInUse ? db-&gt;m_headersInUse-&gt;EntryCount() : 0));</span>
<a href="#l4.40"></a><span id="l4.40">   }</span>
<a href="#l4.41"></a><span id="l4.41"> }</span>
<a href="#l4.42"></a><span id="l4.42"> </span>
<a href="#l4.43"></a><span id="l4.43"> // Memory Reporting implementations</span>
<a href="#l4.44"></a><span id="l4.44"> </span>
<a href="#l4.45"></a><span id="l4.45"> size_t nsMsgDatabase::SizeOfExcludingThis(mozilla::MallocSizeOf aMallocSizeOf) const</span>
<a href="#l4.46"></a><span id="l4.46"> {</span>
<a href="#l4.47"></a><span id="l4.47" class="difflineat">@@ -1136,18 +1137,17 @@ nsMsgDatabase::~nsMsgDatabase()</span>
<a href="#l4.48"></a><span id="l4.48">   delete m_headersInUse;</span>
<a href="#l4.49"></a><span id="l4.49"> </span>
<a href="#l4.50"></a><span id="l4.50">   if (m_msgReferences)</span>
<a href="#l4.51"></a><span id="l4.51">   {</span>
<a href="#l4.52"></a><span id="l4.52">     delete m_msgReferences;</span>
<a href="#l4.53"></a><span id="l4.53">     m_msgReferences = nullptr;</span>
<a href="#l4.54"></a><span id="l4.54">   }</span>
<a href="#l4.55"></a><span id="l4.55"> </span>
<a href="#l4.56"></a><span id="l4.56" class="difflineminus">-  MOZ_LOG(DBLog, LogLevel::Info, (&quot;closing database    %s\n&quot;,</span>
<a href="#l4.57"></a><span id="l4.57" class="difflineminus">-    (const char*)m_dbName.get()));</span>
<a href="#l4.58"></a><span id="l4.58" class="difflineplus">+  MOZ_LOG(DBLog, LogLevel::Info, (&quot;closing database    %s\n&quot;, m_dbName.get()));</span>
<a href="#l4.59"></a><span id="l4.59"> </span>
<a href="#l4.60"></a><span id="l4.60">   nsCOMPtr&lt;nsIMsgDBService&gt; serv(do_GetService(NS_MSGDB_SERVICE_CONTRACTID));</span>
<a href="#l4.61"></a><span id="l4.61">   if (serv)</span>
<a href="#l4.62"></a><span id="l4.62">     static_cast&lt;nsMsgDBService*&gt;(serv.get())-&gt;RemoveFromCache(this);</span>
<a href="#l4.63"></a><span id="l4.63"> </span>
<a href="#l4.64"></a><span id="l4.64">   // if the db folder info refers to the mdb db, we must clear it because</span>
<a href="#l4.65"></a><span id="l4.65">   // the reference will be a dangling one soon.</span>
<a href="#l4.66"></a><span id="l4.66">   if (m_dbFolderInfo)</span>
<a href="#l4.67"></a><span id="l4.67" class="difflineat">@@ -1204,17 +1204,17 @@ nsresult nsMsgDatabase::OpenInternal(nsM</span>
<a href="#l4.68"></a><span id="l4.68"> </span>
<a href="#l4.69"></a><span id="l4.69">   MOZ_LOG(DBLog, LogLevel::Info, (&quot;nsMsgDatabase::Open(%s, %s, %p, %s)\n&quot;,</span>
<a href="#l4.70"></a><span id="l4.70">     (const char*)summaryFilePath.get(), aCreate ? &quot;TRUE&quot;:&quot;FALSE&quot;,</span>
<a href="#l4.71"></a><span id="l4.71">     this, aLeaveInvalidDB ? &quot;TRUE&quot;:&quot;FALSE&quot;));</span>
<a href="#l4.72"></a><span id="l4.72"> </span>
<a href="#l4.73"></a><span id="l4.73"> </span>
<a href="#l4.74"></a><span id="l4.74">   nsresult rv = OpenMDB(summaryFilePath.get(), aCreate, sync);</span>
<a href="#l4.75"></a><span id="l4.75">   if (NS_FAILED(rv))</span>
<a href="#l4.76"></a><span id="l4.76" class="difflineminus">-    MOZ_LOG(DBLog, LogLevel::Info, (&quot;error opening db %lx&quot;, rv));</span>
<a href="#l4.77"></a><span id="l4.77" class="difflineplus">+    MOZ_LOG(DBLog, LogLevel::Info, (&quot;error opening db %&quot; PRIx32, static_cast&lt;uint32_t&gt;(rv)));</span>
<a href="#l4.78"></a><span id="l4.78"> </span>
<a href="#l4.79"></a><span id="l4.79">   if (MOZ_LOG_TEST(DBLog, LogLevel::Debug))</span>
<a href="#l4.80"></a><span id="l4.80">     aDBService-&gt;DumpCache();</span>
<a href="#l4.81"></a><span id="l4.81"> </span>
<a href="#l4.82"></a><span id="l4.82">   if (rv == NS_ERROR_FILE_TARGET_DOES_NOT_EXIST)</span>
<a href="#l4.83"></a><span id="l4.83">     return rv;</span>
<a href="#l4.84"></a><span id="l4.84"> </span>
<a href="#l4.85"></a><span id="l4.85">   m_create = aCreate;</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l5.1"></a><span id="l5.1" class="difflineminus">--- a/mailnews/imap/src/nsAutoSyncState.cpp</span>
<a href="#l5.2"></a><span id="l5.2" class="difflineplus">+++ b/mailnews/imap/src/nsAutoSyncState.cpp</span>
<a href="#l5.3"></a><span id="l5.3" class="difflineat">@@ -10,16 +10,17 @@</span>
<a href="#l5.4"></a><span id="l5.4"> #include &quot;nsIMsgWindow.h&quot;</span>
<a href="#l5.5"></a><span id="l5.5"> #include &quot;nsIMsgMailSession.h&quot;</span>
<a href="#l5.6"></a><span id="l5.6"> #include &quot;nsMsgFolderFlags.h&quot;</span>
<a href="#l5.7"></a><span id="l5.7"> #include &quot;nsIAutoSyncManager.h&quot;</span>
<a href="#l5.8"></a><span id="l5.8"> #include &quot;nsIAutoSyncMsgStrategy.h&quot;</span>
<a href="#l5.9"></a><span id="l5.9"> #include &quot;nsServiceManagerUtils.h&quot;</span>
<a href="#l5.10"></a><span id="l5.10"> #include &quot;nsComponentManagerUtils.h&quot;</span>
<a href="#l5.11"></a><span id="l5.11"> #include &quot;mozilla/Logging.h&quot;</span>
<a href="#l5.12"></a><span id="l5.12" class="difflineplus">+#include &quot;mozilla/SizePrintfMacros.h&quot;</span>
<a href="#l5.13"></a><span id="l5.13"> </span>
<a href="#l5.14"></a><span id="l5.14"> using namespace mozilla;</span>
<a href="#l5.15"></a><span id="l5.15"> </span>
<a href="#l5.16"></a><span id="l5.16"> extern PRLogModuleInfo *gAutoSyncLog;</span>
<a href="#l5.17"></a><span id="l5.17"> </span>
<a href="#l5.18"></a><span id="l5.18"> MsgStrategyComparatorAdaptor::MsgStrategyComparatorAdaptor(nsIAutoSyncMsgStrategy* aStrategy, </span>
<a href="#l5.19"></a><span id="l5.19">   nsIMsgFolder *aFolder, nsIMsgDatabase *aDatabase) : mStrategy(aStrategy), mFolder(aFolder), </span>
<a href="#l5.20"></a><span id="l5.20">     mDatabase(aDatabase)</span>
<a href="#l5.21"></a><span id="l5.21" class="difflineat">@@ -361,17 +362,17 @@ NS_IMETHODIMP nsAutoSyncState::ProcessEx</span>
<a href="#l5.22"></a><span id="l5.22">     if (!hasMessageOffline)</span>
<a href="#l5.23"></a><span id="l5.23">       msgKeys.AppendElement(mExistingHeadersQ[mProcessPointer]);</span>
<a href="#l5.24"></a><span id="l5.24">   }</span>
<a href="#l5.25"></a><span id="l5.25">   if (!msgKeys.IsEmpty())</span>
<a href="#l5.26"></a><span id="l5.26">   {</span>
<a href="#l5.27"></a><span id="l5.27">     nsCString folderName;</span>
<a href="#l5.28"></a><span id="l5.28">     folder-&gt;GetURI(folderName);</span>
<a href="#l5.29"></a><span id="l5.29">     MOZ_LOG(gAutoSyncLog, LogLevel::Debug,</span>
<a href="#l5.30"></a><span id="l5.30" class="difflineminus">-          (&quot;%d messages will be added into the download q of folder %s\n&quot;,</span>
<a href="#l5.31"></a><span id="l5.31" class="difflineplus">+          (&quot;%&quot; PRIuSIZE &quot; messages will be added into the download q of folder %s\n&quot;,</span>
<a href="#l5.32"></a><span id="l5.32">             msgKeys.Length(), folderName.get()));</span>
<a href="#l5.33"></a><span id="l5.33"> </span>
<a href="#l5.34"></a><span id="l5.34">     rv = PlaceIntoDownloadQ(msgKeys);</span>
<a href="#l5.35"></a><span id="l5.35">     if (NS_FAILED(rv))</span>
<a href="#l5.36"></a><span id="l5.36">       mProcessPointer = lastIdx;</span>
<a href="#l5.37"></a><span id="l5.37">   }</span>
<a href="#l5.38"></a><span id="l5.38"> </span>
<a href="#l5.39"></a><span id="l5.39">   *aLeftToProcess = keyCount - mProcessPointer;</span>
<a href="#l5.40"></a><span id="l5.40" class="difflineat">@@ -445,20 +446,20 @@ NS_IMETHODIMP nsAutoSyncState::OnStopRun</span>
<a href="#l5.41"></a><span id="l5.41">     imapFolder-&gt;GetServerRecent(&amp;serverRecent);</span>
<a href="#l5.42"></a><span id="l5.42">     imapFolder-&gt;GetServerNextUID(&amp;serverNextUID);</span>
<a href="#l5.43"></a><span id="l5.43">     if (serverNextUID != mLastNextUID || serverTotal != mLastServerTotal ||</span>
<a href="#l5.44"></a><span id="l5.44">         serverUnseen != mLastServerUnseen || serverRecent != mLastServerRecent)</span>
<a href="#l5.45"></a><span id="l5.45">     {</span>
<a href="#l5.46"></a><span id="l5.46">       nsCString folderName;</span>
<a href="#l5.47"></a><span id="l5.47">       ownerFolder-&gt;GetURI(folderName);</span>
<a href="#l5.48"></a><span id="l5.48">       MOZ_LOG(gAutoSyncLog, LogLevel::Debug,</span>
<a href="#l5.49"></a><span id="l5.49" class="difflineminus">-             (&quot;folder %s status changed serverNextUID = %lx lastNextUID = %lx\n&quot;, folderName.get(),</span>
<a href="#l5.50"></a><span id="l5.50" class="difflineplus">+             (&quot;folder %s status changed serverNextUID = %x lastNextUID = %x\n&quot;, folderName.get(),</span>
<a href="#l5.51"></a><span id="l5.51">               serverNextUID, mLastNextUID));</span>
<a href="#l5.52"></a><span id="l5.52">       MOZ_LOG(gAutoSyncLog, LogLevel::Debug,</span>
<a href="#l5.53"></a><span id="l5.53" class="difflineminus">-             (&quot;serverTotal = %lx lastServerTotal = %lx serverRecent = %lx lastServerRecent = %lx\n&quot;,</span>
<a href="#l5.54"></a><span id="l5.54" class="difflineplus">+             (&quot;serverTotal = %x lastServerTotal = %x serverRecent = %x lastServerRecent = %x\n&quot;,</span>
<a href="#l5.55"></a><span id="l5.55">               serverTotal, mLastServerTotal, serverRecent, mLastServerRecent));</span>
<a href="#l5.56"></a><span id="l5.56">       SetServerCounts(serverTotal, serverRecent, serverUnseen, serverNextUID);</span>
<a href="#l5.57"></a><span id="l5.57">       SetState(nsAutoSyncState::stUpdateIssued);</span>
<a href="#l5.58"></a><span id="l5.58">       return imapFolder-&gt;UpdateFolderWithListener(nullptr, autoSyncMgrListener);</span>
<a href="#l5.59"></a><span id="l5.59">     }</span>
<a href="#l5.60"></a><span id="l5.60">     else</span>
<a href="#l5.61"></a><span id="l5.61">     {</span>
<a href="#l5.62"></a><span id="l5.62">       ownerFolder-&gt;SetMsgDatabase(nullptr);</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l6.1"></a><span id="l6.1" class="difflineminus">--- a/mailnews/imap/src/nsImapMailFolder.cpp</span>
<a href="#l6.2"></a><span id="l6.2" class="difflineplus">+++ b/mailnews/imap/src/nsImapMailFolder.cpp</span>
<a href="#l6.3"></a><span id="l6.3" class="difflineat">@@ -3227,61 +3227,61 @@ NS_IMETHODIMP nsImapMailFolder::BeginCop</span>
<a href="#l6.4"></a><span id="l6.4">   nsresult rv;</span>
<a href="#l6.5"></a><span id="l6.5">   if (m_copyState-&gt;m_tmpFile) // leftover file spec nuke it</span>
<a href="#l6.6"></a><span id="l6.6">   {</span>
<a href="#l6.7"></a><span id="l6.7">     rv = m_copyState-&gt;m_tmpFile-&gt;Remove(false);</span>
<a href="#l6.8"></a><span id="l6.8">     if (NS_FAILED(rv))</span>
<a href="#l6.9"></a><span id="l6.9">     {</span>
<a href="#l6.10"></a><span id="l6.10">       nsCString nativePath;</span>
<a href="#l6.11"></a><span id="l6.11">       m_copyState-&gt;m_tmpFile-&gt;GetNativePath(nativePath);</span>
<a href="#l6.12"></a><span id="l6.12" class="difflineminus">-      MOZ_LOG(IMAP, mozilla::LogLevel::Info, (&quot;couldn't remove prev temp file %s: %lx\n&quot;, nativePath.get(), rv));</span>
<a href="#l6.13"></a><span id="l6.13" class="difflineplus">+      MOZ_LOG(IMAP, mozilla::LogLevel::Info, (&quot;couldn't remove prev temp file %s: %&quot; PRIx32 &quot;\n&quot;, nativePath.get(), static_cast&lt;uint32_t&gt;(rv)));</span>
<a href="#l6.14"></a><span id="l6.14">     }</span>
<a href="#l6.15"></a><span id="l6.15">     m_copyState-&gt;m_tmpFile = nullptr;</span>
<a href="#l6.16"></a><span id="l6.16">   }</span>
<a href="#l6.17"></a><span id="l6.17">   if (message)</span>
<a href="#l6.18"></a><span id="l6.18">     m_copyState-&gt;m_message = do_QueryInterface(message, &amp;rv);</span>
<a href="#l6.19"></a><span id="l6.19"> </span>
<a href="#l6.20"></a><span id="l6.20">   rv = GetSpecialDirectoryWithFileName(NS_OS_TEMP_DIR,</span>
<a href="#l6.21"></a><span id="l6.21">                                        &quot;nscpmsg.txt&quot;,</span>
<a href="#l6.22"></a><span id="l6.22">                                         getter_AddRefs(m_copyState-&gt;m_tmpFile));</span>
<a href="#l6.23"></a><span id="l6.23">   if (NS_FAILED(rv))</span>
<a href="#l6.24"></a><span id="l6.24" class="difflineminus">-    MOZ_LOG(IMAP, mozilla::LogLevel::Info, (&quot;couldn't find nscpmsg.txt:%lx\n&quot;, rv));</span>
<a href="#l6.25"></a><span id="l6.25" class="difflineplus">+    MOZ_LOG(IMAP, mozilla::LogLevel::Info, (&quot;couldn't find nscpmsg.txt:%&quot; PRIx32 &quot;\n&quot;, static_cast&lt;uint32_t&gt;(rv)));</span>
<a href="#l6.26"></a><span id="l6.26">   NS_ENSURE_SUCCESS(rv, rv);</span>
<a href="#l6.27"></a><span id="l6.27"> </span>
<a href="#l6.28"></a><span id="l6.28">   // create a unique file, since multiple copies may be open on multiple folders</span>
<a href="#l6.29"></a><span id="l6.29">   rv = m_copyState-&gt;m_tmpFile-&gt;CreateUnique(nsIFile::NORMAL_FILE_TYPE, 00600);</span>
<a href="#l6.30"></a><span id="l6.30">   if (NS_FAILED(rv))</span>
<a href="#l6.31"></a><span id="l6.31">   {</span>
<a href="#l6.32"></a><span id="l6.32" class="difflineminus">-    MOZ_LOG(IMAP, mozilla::LogLevel::Info, (&quot;couldn't create temp nscpmsg.txt:%lx\n&quot;, rv));</span>
<a href="#l6.33"></a><span id="l6.33" class="difflineplus">+    MOZ_LOG(IMAP, mozilla::LogLevel::Info, (&quot;couldn't create temp nscpmsg.txt:%&quot; PRIx32 &quot;\n&quot;, static_cast&lt;uint32_t&gt;(rv)));</span>
<a href="#l6.34"></a><span id="l6.34">     // Last ditch attempt to create a temp file, because virus checker might</span>
<a href="#l6.35"></a><span id="l6.35">     // be locking the previous temp file, and CreateUnique fails if the file</span>
<a href="#l6.36"></a><span id="l6.36">     // is locked. Use the message key to make a unique name.</span>
<a href="#l6.37"></a><span id="l6.37">     if (message)</span>
<a href="#l6.38"></a><span id="l6.38">     {</span>
<a href="#l6.39"></a><span id="l6.39">       nsCString tmpFileName(&quot;nscpmsg-&quot;);</span>
<a href="#l6.40"></a><span id="l6.40">       nsMsgKey msgKey;</span>
<a href="#l6.41"></a><span id="l6.41">       message-&gt;GetMessageKey(&amp;msgKey);</span>
<a href="#l6.42"></a><span id="l6.42">       tmpFileName.AppendInt(msgKey);</span>
<a href="#l6.43"></a><span id="l6.43">       tmpFileName.Append(&quot;.txt&quot;);</span>
<a href="#l6.44"></a><span id="l6.44">       m_copyState-&gt;m_tmpFile-&gt;SetNativeLeafName(tmpFileName);</span>
<a href="#l6.45"></a><span id="l6.45">       rv = m_copyState-&gt;m_tmpFile-&gt;CreateUnique(nsIFile::NORMAL_FILE_TYPE, 00600);</span>
<a href="#l6.46"></a><span id="l6.46">       if (NS_FAILED(rv))</span>
<a href="#l6.47"></a><span id="l6.47">       {</span>
<a href="#l6.48"></a><span id="l6.48" class="difflineminus">-        MOZ_LOG(IMAP, mozilla::LogLevel::Info, (&quot;couldn't create temp nscpmsg.txt:%lx\n&quot;, rv));</span>
<a href="#l6.49"></a><span id="l6.49" class="difflineplus">+        MOZ_LOG(IMAP, mozilla::LogLevel::Info, (&quot;couldn't create temp nscpmsg.txt: %&quot; PRIx32 &quot;\n&quot;, static_cast&lt;uint32_t&gt;(rv)));</span>
<a href="#l6.50"></a><span id="l6.50">         OnCopyCompleted(m_copyState-&gt;m_srcSupport, rv);</span>
<a href="#l6.51"></a><span id="l6.51">         return rv;</span>
<a href="#l6.52"></a><span id="l6.52">       }</span>
<a href="#l6.53"></a><span id="l6.53">     }</span>
<a href="#l6.54"></a><span id="l6.54">   }</span>
<a href="#l6.55"></a><span id="l6.55"> </span>
<a href="#l6.56"></a><span id="l6.56">   nsCOMPtr&lt;nsIOutputStream&gt; fileOutputStream;</span>
<a href="#l6.57"></a><span id="l6.57">   rv = MsgNewBufferedFileOutputStream(getter_AddRefs(m_copyState-&gt;m_msgFileStream),</span>
<a href="#l6.58"></a><span id="l6.58">                                       m_copyState-&gt;m_tmpFile, -1, 00600);</span>
<a href="#l6.59"></a><span id="l6.59">   if (NS_FAILED(rv))</span>
<a href="#l6.60"></a><span id="l6.60" class="difflineminus">-    MOZ_LOG(IMAP, mozilla::LogLevel::Info, (&quot;couldn't create output file stream:%lx\n&quot;, rv));</span>
<a href="#l6.61"></a><span id="l6.61" class="difflineplus">+    MOZ_LOG(IMAP, mozilla::LogLevel::Info, (&quot;couldn't create output file stream: %&quot; PRIx32 &quot;\n&quot;, static_cast&lt;uint32_t&gt;(rv)));</span>
<a href="#l6.62"></a><span id="l6.62"> </span>
<a href="#l6.63"></a><span id="l6.63">   if (!m_copyState-&gt;m_dataBuffer)</span>
<a href="#l6.64"></a><span id="l6.64">     m_copyState-&gt;m_dataBuffer = (char*) PR_CALLOC(COPY_BUFFER_SIZE+1);</span>
<a href="#l6.65"></a><span id="l6.65">   NS_ENSURE_TRUE(m_copyState-&gt;m_dataBuffer, NS_ERROR_OUT_OF_MEMORY);</span>
<a href="#l6.66"></a><span id="l6.66">   m_copyState-&gt;m_dataBufferSize = COPY_BUFFER_SIZE;</span>
<a href="#l6.67"></a><span id="l6.67">   return NS_OK;</span>
<a href="#l6.68"></a><span id="l6.68"> }</span>
<a href="#l6.69"></a><span id="l6.69"> </span>
<a href="#l6.70"></a><span id="l6.70" class="difflineat">@@ -3369,17 +3369,17 @@ NS_IMETHODIMP nsImapMailFolder::CopyData</span>
<a href="#l6.71"></a><span id="l6.71"> // sICopyMessageListener methods, BeginCopy, CopyData, EndCopy, EndMove, StartMessage, EndMessage</span>
<a href="#l6.72"></a><span id="l6.72"> NS_IMETHODIMP nsImapMailFolder::CopyData(nsIInputStream *aIStream, int32_t aLength)</span>
<a href="#l6.73"></a><span id="l6.73"> {</span>
<a href="#l6.74"></a><span id="l6.74">   NS_ENSURE_TRUE(m_copyState &amp;&amp; m_copyState-&gt;m_msgFileStream &amp;&amp; m_copyState-&gt;m_dataBuffer, NS_ERROR_NULL_POINTER);</span>
<a href="#l6.75"></a><span id="l6.75">   nsresult rv = CopyDataToOutputStreamForAppend(aIStream, aLength,</span>
<a href="#l6.76"></a><span id="l6.76">                                                 m_copyState-&gt;m_msgFileStream);</span>
<a href="#l6.77"></a><span id="l6.77">   if (NS_FAILED(rv))</span>
<a href="#l6.78"></a><span id="l6.78">   {</span>
<a href="#l6.79"></a><span id="l6.79" class="difflineminus">-    MOZ_LOG(IMAP, mozilla::LogLevel::Info, (&quot;CopyData failed:%lx\n&quot;, rv));</span>
<a href="#l6.80"></a><span id="l6.80" class="difflineplus">+    MOZ_LOG(IMAP, mozilla::LogLevel::Info, (&quot;CopyData failed: %&quot; PRIx32 &quot;\n&quot;, static_cast&lt;uint32_t&gt;(rv)));</span>
<a href="#l6.81"></a><span id="l6.81">     OnCopyCompleted(m_copyState-&gt;m_srcSupport, rv);</span>
<a href="#l6.82"></a><span id="l6.82">   }</span>
<a href="#l6.83"></a><span id="l6.83">   return rv;</span>
<a href="#l6.84"></a><span id="l6.84"> }</span>
<a href="#l6.85"></a><span id="l6.85"> </span>
<a href="#l6.86"></a><span id="l6.86"> NS_IMETHODIMP nsImapMailFolder::EndCopy(bool copySucceeded)</span>
<a href="#l6.87"></a><span id="l6.87"> {</span>
<a href="#l6.88"></a><span id="l6.88">   nsresult rv = copySucceeded ? NS_OK : NS_ERROR_FAILURE;</span>
<a href="#l6.89"></a><span id="l6.89" class="difflineat">@@ -3401,17 +3401,17 @@ NS_IMETHODIMP nsImapMailFolder::EndCopy(</span>
<a href="#l6.90"></a><span id="l6.90">     rv = imapService-&gt;AppendMessageFromFile(m_copyState-&gt;m_tmpFile,</span>
<a href="#l6.91"></a><span id="l6.91">                                             this, EmptyCString(), true,</span>
<a href="#l6.92"></a><span id="l6.92">                                             m_copyState-&gt;m_selectedState,</span>
<a href="#l6.93"></a><span id="l6.93">                                             urlListener, nullptr,</span>
<a href="#l6.94"></a><span id="l6.94">                                             copySupport,</span>
<a href="#l6.95"></a><span id="l6.95">                                             m_copyState-&gt;m_msgWindow);</span>
<a href="#l6.96"></a><span id="l6.96">   }</span>
<a href="#l6.97"></a><span id="l6.97">   if (NS_FAILED(rv) || !copySucceeded)</span>
<a href="#l6.98"></a><span id="l6.98" class="difflineminus">-    MOZ_LOG(IMAP, mozilla::LogLevel::Info, (&quot;EndCopy failed:%lx\n&quot;, rv));</span>
<a href="#l6.99"></a><span id="l6.99" class="difflineplus">+    MOZ_LOG(IMAP, mozilla::LogLevel::Info, (&quot;EndCopy failed: %&quot; PRIx32 &quot;\n&quot;, static_cast&lt;uint32_t&gt;(rv)));</span>
<a href="#l6.100"></a><span id="l6.100">   return rv;</span>
<a href="#l6.101"></a><span id="l6.101"> }</span>
<a href="#l6.102"></a><span id="l6.102"> </span>
<a href="#l6.103"></a><span id="l6.103"> NS_IMETHODIMP nsImapMailFolder::EndMove(bool moveSucceeded)</span>
<a href="#l6.104"></a><span id="l6.104"> {</span>
<a href="#l6.105"></a><span id="l6.105">   return NS_OK;</span>
<a href="#l6.106"></a><span id="l6.106"> }</span>
<a href="#l6.107"></a><span id="l6.107"> // this is the beginning of the next message copied</span>
<a href="#l6.108"></a><span id="l6.108" class="difflineat">@@ -6775,40 +6775,40 @@ nsImapMailFolder::CopyNextStreamMessage(</span>
<a href="#l6.109"></a><span id="l6.109">   //if copy has failed it could be either user interrupted it or for some other reason</span>
<a href="#l6.110"></a><span id="l6.110">   //don't do any subsequent copies or delete src messages if it is move</span>
<a href="#l6.111"></a><span id="l6.111">   if (!copySucceeded)</span>
<a href="#l6.112"></a><span id="l6.112">     return NS_OK;</span>
<a href="#l6.113"></a><span id="l6.113">   nsresult rv;</span>
<a href="#l6.114"></a><span id="l6.114">   nsCOMPtr&lt;nsImapMailCopyState&gt; mailCopyState = do_QueryInterface(copyState, &amp;rv);</span>
<a href="#l6.115"></a><span id="l6.115">   if (NS_FAILED(rv))</span>
<a href="#l6.116"></a><span id="l6.116">   {</span>
<a href="#l6.117"></a><span id="l6.117" class="difflineminus">-    MOZ_LOG(IMAP, mozilla::LogLevel::Info, (&quot;QI copyState failed:%lx\n&quot;, rv));</span>
<a href="#l6.118"></a><span id="l6.118" class="difflineplus">+    MOZ_LOG(IMAP, mozilla::LogLevel::Info, (&quot;QI copyState failed: %&quot; PRIx32 &quot;\n&quot;, static_cast&lt;uint32_t&gt;(rv)));</span>
<a href="#l6.119"></a><span id="l6.119">     return rv; // this can fail...</span>
<a href="#l6.120"></a><span id="l6.120">   }</span>
<a href="#l6.121"></a><span id="l6.121"> </span>
<a href="#l6.122"></a><span id="l6.122">   if (!mailCopyState-&gt;m_streamCopy)</span>
<a href="#l6.123"></a><span id="l6.123">     return NS_OK;</span>
<a href="#l6.124"></a><span id="l6.124"> </span>
<a href="#l6.125"></a><span id="l6.125" class="difflineminus">-  MOZ_LOG(IMAP, mozilla::LogLevel::Info, (&quot;CopyNextStreamMessage: Copying %ld of %ld\n&quot;, mailCopyState-&gt;m_curIndex, mailCopyState-&gt;m_totalCount));</span>
<a href="#l6.126"></a><span id="l6.126" class="difflineplus">+  MOZ_LOG(IMAP, mozilla::LogLevel::Info, (&quot;CopyNextStreamMessage: Copying %u of %u\n&quot;, mailCopyState-&gt;m_curIndex, mailCopyState-&gt;m_totalCount));</span>
<a href="#l6.127"></a><span id="l6.127">   if (mailCopyState-&gt;m_curIndex &lt; mailCopyState-&gt;m_totalCount)</span>
<a href="#l6.128"></a><span id="l6.128">   {</span>
<a href="#l6.129"></a><span id="l6.129">     mailCopyState-&gt;m_message = do_QueryElementAt(mailCopyState-&gt;m_messages,</span>
<a href="#l6.130"></a><span id="l6.130">                                                  mailCopyState-&gt;m_curIndex,</span>
<a href="#l6.131"></a><span id="l6.131">                                                  &amp;rv);</span>
<a href="#l6.132"></a><span id="l6.132">     if (NS_SUCCEEDED(rv))</span>
<a href="#l6.133"></a><span id="l6.133">     {</span>
<a href="#l6.134"></a><span id="l6.134">       bool isRead;</span>
<a href="#l6.135"></a><span id="l6.135">       mailCopyState-&gt;m_message-&gt;GetIsRead(&amp;isRead);</span>
<a href="#l6.136"></a><span id="l6.136">       mailCopyState-&gt;m_unreadCount = (isRead) ? 0 : 1;</span>
<a href="#l6.137"></a><span id="l6.137">       rv = CopyStreamMessage(mailCopyState-&gt;m_message,</span>
<a href="#l6.138"></a><span id="l6.138">                              this, mailCopyState-&gt;m_msgWindow, mailCopyState-&gt;m_isMove);</span>
<a href="#l6.139"></a><span id="l6.139">     }</span>
<a href="#l6.140"></a><span id="l6.140">     else</span>
<a href="#l6.141"></a><span id="l6.141">     {</span>
<a href="#l6.142"></a><span id="l6.142" class="difflineminus">-      MOZ_LOG(IMAP, mozilla::LogLevel::Info, (&quot;QueryElementAt %ld failed:%lx\n&quot;, mailCopyState-&gt;m_curIndex, rv));</span>
<a href="#l6.143"></a><span id="l6.143" class="difflineplus">+      MOZ_LOG(IMAP, mozilla::LogLevel::Info, (&quot;QueryElementAt %u failed: %&quot; PRIx32 &quot;\n&quot;, mailCopyState-&gt;m_curIndex, static_cast&lt;uint32_t&gt;(rv)));</span>
<a href="#l6.144"></a><span id="l6.144">     }</span>
<a href="#l6.145"></a><span id="l6.145">   }</span>
<a href="#l6.146"></a><span id="l6.146">   else</span>
<a href="#l6.147"></a><span id="l6.147">   {</span>
<a href="#l6.148"></a><span id="l6.148">     // Notify of move/copy completion in case we have some source headers</span>
<a href="#l6.149"></a><span id="l6.149">     nsCOMPtr&lt;nsIMsgFolderNotificationService&gt; notifier(do_GetService(NS_MSGNOTIFICATIONSERVICE_CONTRACTID));</span>
<a href="#l6.150"></a><span id="l6.150">     if (notifier)</span>
<a href="#l6.151"></a><span id="l6.151">     {</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l7.1"></a><span id="l7.1" class="difflineminus">--- a/mailnews/imap/src/nsImapProtocol.cpp</span>
<a href="#l7.2"></a><span id="l7.2" class="difflineplus">+++ b/mailnews/imap/src/nsImapProtocol.cpp</span>
<a href="#l7.3"></a><span id="l7.3" class="difflineat">@@ -1319,17 +1319,17 @@ nsImapProtocol::PseudoInterruptMsgLoad(n</span>
<a href="#l7.4"></a><span id="l7.4">   printf(&quot;interrupt msg load : %s\n&quot;, (*interrupted) ? &quot;TRUE&quot; : &quot;FALSE&quot;);</span>
<a href="#l7.5"></a><span id="l7.5"> #endif</span>
<a href="#l7.6"></a><span id="l7.6">   return NS_OK;</span>
<a href="#l7.7"></a><span id="l7.7"> }</span>
<a href="#l7.8"></a><span id="l7.8"> </span>
<a href="#l7.9"></a><span id="l7.9"> void</span>
<a href="#l7.10"></a><span id="l7.10"> nsImapProtocol::ImapThreadMainLoop()</span>
<a href="#l7.11"></a><span id="l7.11"> {</span>
<a href="#l7.12"></a><span id="l7.12" class="difflineminus">-  MOZ_LOG(IMAP, LogLevel::Debug, (&quot;ImapThreadMainLoop entering [this=%x]\n&quot;, this));</span>
<a href="#l7.13"></a><span id="l7.13" class="difflineplus">+  MOZ_LOG(IMAP, LogLevel::Debug, (&quot;ImapThreadMainLoop entering [this=%p]\n&quot;, this));</span>
<a href="#l7.14"></a><span id="l7.14"> </span>
<a href="#l7.15"></a><span id="l7.15">   PRIntervalTime sleepTime = kImapSleepTime;</span>
<a href="#l7.16"></a><span id="l7.16">   while (!DeathSignalReceived())</span>
<a href="#l7.17"></a><span id="l7.17">   {</span>
<a href="#l7.18"></a><span id="l7.18">     nsresult rv = NS_OK;</span>
<a href="#l7.19"></a><span id="l7.19">     bool readyToRun;</span>
<a href="#l7.20"></a><span id="l7.20"> </span>
<a href="#l7.21"></a><span id="l7.21">     // wait for an URL to process...</span>
<a href="#l7.22"></a><span id="l7.22" class="difflineat">@@ -1407,17 +1407,17 @@ nsImapProtocol::ImapThreadMainLoop()</span>
<a href="#l7.23"></a><span id="l7.23"> #endif</span>
<a href="#l7.24"></a><span id="l7.24">     // This can happen if the UI thread closes cached connections in the</span>
<a href="#l7.25"></a><span id="l7.25">     // OnStopRunningUrl notification.</span>
<a href="#l7.26"></a><span id="l7.26">     if (m_threadShouldDie)</span>
<a href="#l7.27"></a><span id="l7.27">       TellThreadToDie();</span>
<a href="#l7.28"></a><span id="l7.28">   }</span>
<a href="#l7.29"></a><span id="l7.29">   m_imapThreadIsRunning = false;</span>
<a href="#l7.30"></a><span id="l7.30"> </span>
<a href="#l7.31"></a><span id="l7.31" class="difflineminus">-  MOZ_LOG(IMAP, LogLevel::Debug, (&quot;ImapThreadMainLoop leaving [this=%x]\n&quot;, this));</span>
<a href="#l7.32"></a><span id="l7.32" class="difflineplus">+  MOZ_LOG(IMAP, LogLevel::Debug, (&quot;ImapThreadMainLoop leaving [this=%p]\n&quot;, this));</span>
<a href="#l7.33"></a><span id="l7.33"> }</span>
<a href="#l7.34"></a><span id="l7.34"> </span>
<a href="#l7.35"></a><span id="l7.35"> void nsImapProtocol::HandleIdleResponses()</span>
<a href="#l7.36"></a><span id="l7.36"> {</span>
<a href="#l7.37"></a><span id="l7.37">   // int32_t oldRecent = GetServerStateParser().NumberOfRecentMessages();</span>
<a href="#l7.38"></a><span id="l7.38">   nsAutoCString commandBuffer(GetServerCommandTag());</span>
<a href="#l7.39"></a><span id="l7.39">   commandBuffer.Append(&quot; IDLE&quot; CRLF);</span>
<a href="#l7.40"></a><span id="l7.40"> </span>
<a href="#l7.41"></a><span id="l7.41" class="difflineat">@@ -1839,17 +1839,17 @@ bool nsImapProtocol::ProcessCurrentURL()</span>
<a href="#l7.42"></a><span id="l7.42">   if (imapMailFolderSink)</span>
<a href="#l7.43"></a><span id="l7.43">   {</span>
<a href="#l7.44"></a><span id="l7.44">     if (copyState)</span>
<a href="#l7.45"></a><span id="l7.45">     {</span>
<a href="#l7.46"></a><span id="l7.46">       rv = imapMailFolderSink-&gt;CopyNextStreamMessage(GetServerStateParser().LastCommandSuccessful() &amp;&amp;</span>
<a href="#l7.47"></a><span id="l7.47">                                                 NS_SUCCEEDED(GetConnectionStatus()),</span>
<a href="#l7.48"></a><span id="l7.48">                                                 copyState);</span>
<a href="#l7.49"></a><span id="l7.49">       if (NS_FAILED(rv))</span>
<a href="#l7.50"></a><span id="l7.50" class="difflineminus">-        MOZ_LOG(IMAP, LogLevel::Info, (&quot;CopyNextStreamMessage failed:%lx\n&quot;, rv));</span>
<a href="#l7.51"></a><span id="l7.51" class="difflineplus">+        MOZ_LOG(IMAP, LogLevel::Info, (&quot;CopyNextStreamMessage failed: %&quot; PRIx32 &quot;\n&quot;, static_cast&lt;uint32_t&gt;(rv)));</span>
<a href="#l7.52"></a><span id="l7.52"> </span>
<a href="#l7.53"></a><span id="l7.53">       NS_ReleaseOnMainThread(copyState.forget());</span>
<a href="#l7.54"></a><span id="l7.54">     }</span>
<a href="#l7.55"></a><span id="l7.55">     // we might need this to stick around for IDLE support</span>
<a href="#l7.56"></a><span id="l7.56">     m_imapMailFolderSink = imapMailFolderSink;</span>
<a href="#l7.57"></a><span id="l7.57">     imapMailFolderSink = nullptr;</span>
<a href="#l7.58"></a><span id="l7.58">   }</span>
<a href="#l7.59"></a><span id="l7.59">   else</span>
<a href="#l7.60"></a><span id="l7.60" class="difflineat">@@ -4465,35 +4465,35 @@ void nsImapProtocol::Log(const char *log</span>
<a href="#l7.61"></a><span id="l7.61">     {</span>
<a href="#l7.62"></a><span id="l7.62">       logDataToLog = logData;</span>
<a href="#l7.63"></a><span id="l7.63">       lastLineEnd = logDataLen;</span>
<a href="#l7.64"></a><span id="l7.64">     }</span>
<a href="#l7.65"></a><span id="l7.65">     switch (GetServerStateParser().GetIMAPstate())</span>
<a href="#l7.66"></a><span id="l7.66">     {</span>
<a href="#l7.67"></a><span id="l7.67">     case nsImapServerResponseParser::kFolderSelected:</span>
<a href="#l7.68"></a><span id="l7.68">       if (extraInfo)</span>
<a href="#l7.69"></a><span id="l7.69" class="difflineminus">-        MOZ_LOG(IMAP, LogLevel::Info, (&quot;%x:%s:%s-%s:%s:%s: %.400s&quot;, this, hostName.get(),</span>
<a href="#l7.70"></a><span id="l7.70" class="difflineplus">+        MOZ_LOG(IMAP, LogLevel::Info, (&quot;%p:%s:%s-%s:%s:%s: %.400s&quot;, this, hostName.get(),</span>
<a href="#l7.71"></a><span id="l7.71">                selectedStateName, GetServerStateParser().GetSelectedMailboxName(),</span>
<a href="#l7.72"></a><span id="l7.72">                logSubName, extraInfo, logDataToLog));</span>
<a href="#l7.73"></a><span id="l7.73">       else</span>
<a href="#l7.74"></a><span id="l7.74" class="difflineminus">-        MOZ_LOG(IMAP, LogLevel::Info, (&quot;%x:%s:%s-%s:%s: %.400s&quot;, this, hostName.get(),</span>
<a href="#l7.75"></a><span id="l7.75" class="difflineplus">+        MOZ_LOG(IMAP, LogLevel::Info, (&quot;%p:%s:%s-%s:%s: %.400s&quot;, this, hostName.get(),</span>
<a href="#l7.76"></a><span id="l7.76">                selectedStateName, GetServerStateParser().GetSelectedMailboxName(),</span>
<a href="#l7.77"></a><span id="l7.77">                logSubName, logDataToLog));</span>
<a href="#l7.78"></a><span id="l7.78">       break;</span>
<a href="#l7.79"></a><span id="l7.79">     case nsImapServerResponseParser::kNonAuthenticated:</span>
<a href="#l7.80"></a><span id="l7.80">     case nsImapServerResponseParser::kAuthenticated:</span>
<a href="#l7.81"></a><span id="l7.81">     {</span>
<a href="#l7.82"></a><span id="l7.82">       const char *stateName = (GetServerStateParser().GetIMAPstate() ==</span>
<a href="#l7.83"></a><span id="l7.83">                                nsImapServerResponseParser::kNonAuthenticated)</span>
<a href="#l7.84"></a><span id="l7.84">                                ? nonAuthStateName : authStateName;</span>
<a href="#l7.85"></a><span id="l7.85">       if (extraInfo)</span>
<a href="#l7.86"></a><span id="l7.86" class="difflineminus">-        MOZ_LOG(IMAP, LogLevel::Info, (&quot;%x:%s:%s:%s:%s: %.400s&quot;, this,</span>
<a href="#l7.87"></a><span id="l7.87" class="difflineplus">+        MOZ_LOG(IMAP, LogLevel::Info, (&quot;%p:%s:%s:%s:%s: %.400s&quot;, this,</span>
<a href="#l7.88"></a><span id="l7.88">                hostName.get(),stateName,logSubName,extraInfo,logDataToLog));</span>
<a href="#l7.89"></a><span id="l7.89">       else</span>
<a href="#l7.90"></a><span id="l7.90" class="difflineminus">-        MOZ_LOG(IMAP, LogLevel::Info, (&quot;%x:%s:%s:%s: %.400s&quot;,this,</span>
<a href="#l7.91"></a><span id="l7.91" class="difflineplus">+        MOZ_LOG(IMAP, LogLevel::Info, (&quot;%p:%s:%s:%s: %.400s&quot;, this,</span>
<a href="#l7.92"></a><span id="l7.92">                hostName.get(),stateName,logSubName,logDataToLog));</span>
<a href="#l7.93"></a><span id="l7.93">     }</span>
<a href="#l7.94"></a><span id="l7.94">     }</span>
<a href="#l7.95"></a><span id="l7.95"> </span>
<a href="#l7.96"></a><span id="l7.96">     // dump the rest of the string in &lt; 400 byte chunks</span>
<a href="#l7.97"></a><span id="l7.97">     while (logDataLen &gt; kLogDataChunkSize)</span>
<a href="#l7.98"></a><span id="l7.98">     {</span>
<a href="#l7.99"></a><span id="l7.99">       logDataLines.Cut(0, lastLineEnd + 2); // + 2 to account for the LF and the '\0' we added</span>
<a href="#l7.100"></a><span id="l7.100" class="difflineat">@@ -4744,17 +4744,17 @@ char* nsImapProtocol::CreateNewLineFromS</span>
<a href="#l7.101"></a><span id="l7.101">   // ui thread, which releases our ref to the input stream, and can</span>
<a href="#l7.102"></a><span id="l7.102">   // cause the pipe to get deleted before the monitor the read is</span>
<a href="#l7.103"></a><span id="l7.103">   // blocked on gets notified. When that happens, the imap thread</span>
<a href="#l7.104"></a><span id="l7.104">   // will stay blocked.</span>
<a href="#l7.105"></a><span id="l7.105">   nsCOMPtr &lt;nsIInputStream&gt; kungFuGrip = m_inputStream;</span>
<a href="#l7.106"></a><span id="l7.106">   do</span>
<a href="#l7.107"></a><span id="l7.107">   {</span>
<a href="#l7.108"></a><span id="l7.108">     newLine = m_inputStreamBuffer-&gt;ReadNextLine(m_inputStream, numBytesInLine, needMoreData, &amp;rv);</span>
<a href="#l7.109"></a><span id="l7.109" class="difflineminus">-    MOZ_LOG(IMAP, LogLevel::Debug, (&quot;ReadNextLine [stream=%x nb=%u needmore=%u]\n&quot;,</span>
<a href="#l7.110"></a><span id="l7.110" class="difflineplus">+    MOZ_LOG(IMAP, LogLevel::Debug, (&quot;ReadNextLine [stream=%p nb=%u needmore=%u]\n&quot;,</span>
<a href="#l7.111"></a><span id="l7.111">         m_inputStream.get(), numBytesInLine, needMoreData));</span>
<a href="#l7.112"></a><span id="l7.112"> </span>
<a href="#l7.113"></a><span id="l7.113">   } while (!newLine &amp;&amp; NS_SUCCEEDED(rv) &amp;&amp; !DeathSignalReceived()); // until we get the next line and haven't been interrupted</span>
<a href="#l7.114"></a><span id="l7.114"> </span>
<a href="#l7.115"></a><span id="l7.115">   kungFuGrip = nullptr;</span>
<a href="#l7.116"></a><span id="l7.116"> </span>
<a href="#l7.117"></a><span id="l7.117">   if (NS_FAILED(rv))</span>
<a href="#l7.118"></a><span id="l7.118">   {</span>
<a href="#l7.119"></a><span id="l7.119" class="difflineat">@@ -5621,24 +5621,27 @@ void nsImapProtocol::InitPrefAuthMethods</span>
<a href="#l7.120"></a><span id="l7.120">  * which is allowed by server and prefs and not marked failed.</span>
<a href="#l7.121"></a><span id="l7.121">  * The order of preference and trying of auth methods is encoded here.</span>
<a href="#l7.122"></a><span id="l7.122">  */</span>
<a href="#l7.123"></a><span id="l7.123"> nsresult nsImapProtocol::ChooseAuthMethod()</span>
<a href="#l7.124"></a><span id="l7.124"> {</span>
<a href="#l7.125"></a><span id="l7.125">   eIMAPCapabilityFlags serverCaps = GetServerStateParser().GetCapabilityFlag();</span>
<a href="#l7.126"></a><span id="l7.126">   eIMAPCapabilityFlags availCaps = serverCaps &amp; m_prefAuthMethods &amp; ~m_failedAuthMethods;</span>
<a href="#l7.127"></a><span id="l7.127"> </span>
<a href="#l7.128"></a><span id="l7.128" class="difflineminus">-  MOZ_LOG(IMAP, LogLevel::Debug, (&quot;IMAP auth: server caps 0x%llx, pref 0x%llx, failed 0x%llx, avail caps 0x%llx&quot;,</span>
<a href="#l7.129"></a><span id="l7.129" class="difflineplus">+  MOZ_LOG(IMAP, LogLevel::Debug, (&quot;IMAP auth: server caps 0x%&quot; PRIx64</span>
<a href="#l7.130"></a><span id="l7.130" class="difflineplus">+        &quot;, pref 0x%&quot; PRIx64 &quot;, failed 0x%&quot; PRIx64 &quot;, avail caps 0x%&quot; PRIx64,</span>
<a href="#l7.131"></a><span id="l7.131">         serverCaps, m_prefAuthMethods, m_failedAuthMethods, availCaps));</span>
<a href="#l7.132"></a><span id="l7.132" class="difflineminus">-  MOZ_LOG(IMAP, LogLevel::Debug, (&quot;(GSSAPI = 0x%llx, CRAM = 0x%llx, NTLM = 0x%llx, &quot;</span>
<a href="#l7.133"></a><span id="l7.133" class="difflineminus">-        &quot;MSN = 0x%llx, PLAIN = 0x%llx,\n  LOGIN = 0x%llx, old-style IMAP login = 0x%llx&quot;</span>
<a href="#l7.134"></a><span id="l7.134" class="difflineminus">-        &quot;, auth external IMAP login = 0x%llx, OAUTH2 = 0x%llx)&quot;,</span>
<a href="#l7.135"></a><span id="l7.135" class="difflineplus">+  MOZ_LOG(IMAP, LogLevel::Debug, (&quot;(GSSAPI = 0x%&quot; PRIx64 &quot;, CRAM = 0x%&quot; PRIx64</span>
<a href="#l7.136"></a><span id="l7.136" class="difflineplus">+        &quot;, NTLM = 0x%&quot; PRIx64 &quot;, MSN = 0x%&quot; PRIx64 &quot;, PLAIN = 0x%&quot; PRIx64</span>
<a href="#l7.137"></a><span id="l7.137" class="difflineplus">+        &quot;,\n  LOGIN = 0x%&quot; PRIx64 &quot;, old-style IMAP login = 0x%&quot; PRIx64</span>
<a href="#l7.138"></a><span id="l7.138" class="difflineplus">+        &quot;, auth external IMAP login = 0x%&quot; PRIx64 &quot;, OAUTH2 = 0x%&quot; PRIx64 &quot;)&quot;,</span>
<a href="#l7.139"></a><span id="l7.139">         kHasAuthGssApiCapability, kHasCRAMCapability, kHasAuthNTLMCapability,</span>
<a href="#l7.140"></a><span id="l7.140">         kHasAuthMSNCapability, kHasAuthPlainCapability, kHasAuthLoginCapability,</span>
<a href="#l7.141"></a><span id="l7.141" class="difflineminus">-        kHasAuthOldLoginCapability, kHasAuthExternalCapability, kHasXOAuth2Capability));</span>
<a href="#l7.142"></a><span id="l7.142" class="difflineplus">+        kHasAuthOldLoginCapability, kHasAuthExternalCapability,</span>
<a href="#l7.143"></a><span id="l7.143" class="difflineplus">+        kHasXOAuth2Capability));</span>
<a href="#l7.144"></a><span id="l7.144"> </span>
<a href="#l7.145"></a><span id="l7.145">   if (kHasAuthExternalCapability &amp; availCaps)</span>
<a href="#l7.146"></a><span id="l7.146">     m_currentAuthMethod = kHasAuthExternalCapability;</span>
<a href="#l7.147"></a><span id="l7.147">   else if (kHasAuthGssApiCapability &amp; availCaps)</span>
<a href="#l7.148"></a><span id="l7.148">     m_currentAuthMethod = kHasAuthGssApiCapability;</span>
<a href="#l7.149"></a><span id="l7.149">   else if (kHasCRAMCapability &amp; availCaps)</span>
<a href="#l7.150"></a><span id="l7.150">     m_currentAuthMethod = kHasCRAMCapability;</span>
<a href="#l7.151"></a><span id="l7.151">   else if (kHasAuthNTLMCapability &amp; availCaps)</span>
<a href="#l7.152"></a><span id="l7.152" class="difflineat">@@ -5654,23 +5657,23 @@ nsresult nsImapProtocol::ChooseAuthMetho</span>
<a href="#l7.153"></a><span id="l7.153">   else if (kHasAuthOldLoginCapability &amp; availCaps)</span>
<a href="#l7.154"></a><span id="l7.154">     m_currentAuthMethod = kHasAuthOldLoginCapability;</span>
<a href="#l7.155"></a><span id="l7.155">   else</span>
<a href="#l7.156"></a><span id="l7.156">   {</span>
<a href="#l7.157"></a><span id="l7.157">     MOZ_LOG(IMAP, LogLevel::Debug, (&quot;no remaining auth method&quot;));</span>
<a href="#l7.158"></a><span id="l7.158">     m_currentAuthMethod = kCapabilityUndefined;</span>
<a href="#l7.159"></a><span id="l7.159">     return NS_ERROR_FAILURE;</span>
<a href="#l7.160"></a><span id="l7.160">   }</span>
<a href="#l7.161"></a><span id="l7.161" class="difflineminus">-  MOZ_LOG(IMAP, LogLevel::Debug, (&quot;trying auth method 0x%llx&quot;, m_currentAuthMethod));</span>
<a href="#l7.162"></a><span id="l7.162" class="difflineplus">+  MOZ_LOG(IMAP, LogLevel::Debug, (&quot;trying auth method 0x%&quot; PRIx64, m_currentAuthMethod));</span>
<a href="#l7.163"></a><span id="l7.163">   return NS_OK;</span>
<a href="#l7.164"></a><span id="l7.164"> }</span>
<a href="#l7.165"></a><span id="l7.165"> </span>
<a href="#l7.166"></a><span id="l7.166"> void nsImapProtocol::MarkAuthMethodAsFailed(eIMAPCapabilityFlags failedAuthMethod)</span>
<a href="#l7.167"></a><span id="l7.167"> {</span>
<a href="#l7.168"></a><span id="l7.168" class="difflineminus">-  MOZ_LOG(IMAP, LogLevel::Debug, (&quot;marking auth method 0x%llx failed&quot;, failedAuthMethod));</span>
<a href="#l7.169"></a><span id="l7.169" class="difflineplus">+  MOZ_LOG(IMAP, LogLevel::Debug, (&quot;marking auth method 0x%&quot; PRIx64 &quot; failed&quot;, failedAuthMethod));</span>
<a href="#l7.170"></a><span id="l7.170">   m_failedAuthMethods |= failedAuthMethod;</span>
<a href="#l7.171"></a><span id="l7.171"> }</span>
<a href="#l7.172"></a><span id="l7.172"> </span>
<a href="#l7.173"></a><span id="l7.173"> /**</span>
<a href="#l7.174"></a><span id="l7.174">  * Start over, trying all auth methods again</span>
<a href="#l7.175"></a><span id="l7.175">  */</span>
<a href="#l7.176"></a><span id="l7.176"> void nsImapProtocol::ResetAuthMethods()</span>
<a href="#l7.177"></a><span id="l7.177"> {</span>
<a href="#l7.178"></a><span id="l7.178" class="difflineat">@@ -5682,26 +5685,26 @@ void nsImapProtocol::ResetAuthMethods()</span>
<a href="#l7.179"></a><span id="l7.179"> nsresult nsImapProtocol::AuthLogin(const char *userName, const nsCString &amp;password, eIMAPCapabilityFlag flag)</span>
<a href="#l7.180"></a><span id="l7.180"> {</span>
<a href="#l7.181"></a><span id="l7.181">   ProgressEventFunctionUsingName(&quot;imapStatusSendingAuthLogin&quot;);</span>
<a href="#l7.182"></a><span id="l7.182">   IncrementCommandTagNumber();</span>
<a href="#l7.183"></a><span id="l7.183"> </span>
<a href="#l7.184"></a><span id="l7.184">   char * currentCommand=nullptr;</span>
<a href="#l7.185"></a><span id="l7.185">   nsresult rv;</span>
<a href="#l7.186"></a><span id="l7.186"> </span>
<a href="#l7.187"></a><span id="l7.187" class="difflineminus">-  MOZ_LOG(IMAP, LogLevel::Debug, (&quot;IMAP: trying auth method 0x%llx&quot;, m_currentAuthMethod));</span>
<a href="#l7.188"></a><span id="l7.188" class="difflineplus">+  MOZ_LOG(IMAP, LogLevel::Debug, (&quot;IMAP: trying auth method 0x%&quot; PRIx64, m_currentAuthMethod));</span>
<a href="#l7.189"></a><span id="l7.189"> </span>
<a href="#l7.190"></a><span id="l7.190">   if (flag &amp; kHasAuthExternalCapability)</span>
<a href="#l7.191"></a><span id="l7.191">   {</span>
<a href="#l7.192"></a><span id="l7.192">       char *base64UserName = PL_Base64Encode(userName, strlen(userName), nullptr);</span>
<a href="#l7.193"></a><span id="l7.193">       nsAutoCString command (GetServerCommandTag());</span>
<a href="#l7.194"></a><span id="l7.194">       command.Append(&quot; authenticate EXTERNAL &quot; );</span>
<a href="#l7.195"></a><span id="l7.195">       command.Append(base64UserName);</span>
<a href="#l7.196"></a><span id="l7.196">       command.Append(CRLF);</span>
<a href="#l7.197"></a><span id="l7.197" class="difflineminus">-	  PR_Free(base64UserName);</span>
<a href="#l7.198"></a><span id="l7.198" class="difflineplus">+      PR_Free(base64UserName);</span>
<a href="#l7.199"></a><span id="l7.199">       rv = SendData(command.get());</span>
<a href="#l7.200"></a><span id="l7.200">       ParseIMAPandCheckForNewMail();</span>
<a href="#l7.201"></a><span id="l7.201">       nsImapServerResponseParser &amp;parser = GetServerStateParser();</span>
<a href="#l7.202"></a><span id="l7.202">       if (parser.LastCommandSuccessful())</span>
<a href="#l7.203"></a><span id="l7.203">         return NS_OK;</span>
<a href="#l7.204"></a><span id="l7.204">       parser.SetCapabilityFlag(parser.GetCapabilityFlag() &amp; ~kHasAuthExternalCapability);</span>
<a href="#l7.205"></a><span id="l7.205">   }</span>
<a href="#l7.206"></a><span id="l7.206">   else if (flag &amp; kHasCRAMCapability)</span>
<a href="#l7.207"></a><span id="l7.207" class="difflineat">@@ -9324,17 +9327,17 @@ nsresult nsImapMockChannel::ReadFromMemC</span>
<a href="#l7.208"></a><span id="l7.208">         msgUrl-&gt;GetMessageHeader(getter_AddRefs(msgHdr));</span>
<a href="#l7.209"></a><span id="l7.209">         if (msgHdr)</span>
<a href="#l7.210"></a><span id="l7.210">         {</span>
<a href="#l7.211"></a><span id="l7.211">           uint32_t messageSize;</span>
<a href="#l7.212"></a><span id="l7.212">           if (NS_SUCCEEDED(msgHdr-&gt;GetMessageSize(&amp;messageSize)) &amp;&amp;</span>
<a href="#l7.213"></a><span id="l7.213">               messageSize != entrySize)</span>
<a href="#l7.214"></a><span id="l7.214">           {</span>
<a href="#l7.215"></a><span id="l7.215">             MOZ_LOG(IMAP, LogLevel::Warning,</span>
<a href="#l7.216"></a><span id="l7.216" class="difflineminus">-                (&quot;ReadFromMemCache size mismatch for %s: message %d, cache %ld\n&quot;,</span>
<a href="#l7.217"></a><span id="l7.217" class="difflineplus">+                (&quot;ReadFromMemCache size mismatch for %s: message %&quot; PRIu32 &quot;, cache %&quot; PRIi64 &quot;\n&quot;,</span>
<a href="#l7.218"></a><span id="l7.218">                  entryKey.get(), messageSize, entrySize));</span>
<a href="#l7.219"></a><span id="l7.219">             shouldUseCacheEntry = false;</span>
<a href="#l7.220"></a><span id="l7.220">           }</span>
<a href="#l7.221"></a><span id="l7.221">         }</span>
<a href="#l7.222"></a><span id="l7.222">       }</span>
<a href="#l7.223"></a><span id="l7.223">     }</span>
<a href="#l7.224"></a><span id="l7.224">   }</span>
<a href="#l7.225"></a><span id="l7.225"> </span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l8.1"></a><span id="l8.1" class="difflineminus">--- a/mailnews/import/src/nsImportMail.cpp</span>
<a href="#l8.2"></a><span id="l8.2" class="difflineplus">+++ b/mailnews/import/src/nsImportMail.cpp</span>
<a href="#l8.3"></a><span id="l8.3" class="difflineat">@@ -766,27 +766,27 @@ ImportMailThread(void *stuff)</span>
<a href="#l8.4"></a><span id="l8.4">         // Make sure this new parent folder obj has the correct subfolder list so far.</span>
<a href="#l8.5"></a><span id="l8.5">         rv = ProxyGetSubFolders(curFolder);</span>
<a href="#l8.6"></a><span id="l8.6">       }</span>
<a href="#l8.7"></a><span id="l8.7">       else if (newDepth &lt; depth) {</span>
<a href="#l8.8"></a><span id="l8.8">         rv = NS_OK;</span>
<a href="#l8.9"></a><span id="l8.9">         while ((newDepth &lt; depth) &amp;&amp; NS_SUCCEEDED(rv)) {</span>
<a href="#l8.10"></a><span id="l8.10">           rv = curFolder-&gt;GetParent(getter_AddRefs(curFolder));</span>
<a href="#l8.11"></a><span id="l8.11">           if (NS_FAILED(rv)) {</span>
<a href="#l8.12"></a><span id="l8.12" class="difflineminus">-            IMPORT_LOG1(&quot;*** ImportMailThread: Failed to get the interface for parent folder '%s'.&quot;, lastName.get());</span>
<a href="#l8.13"></a><span id="l8.13" class="difflineplus">+            IMPORT_LOG1(&quot;*** ImportMailThread: Failed to get the interface for parent folder '%s'.&quot;, NS_ConvertUTF16toUTF8(lastName).get());</span>
<a href="#l8.14"></a><span id="l8.14">             nsImportGenericMail::ReportError(IMPORT_ERROR_MB_FINDCHILD,</span>
<a href="#l8.15"></a><span id="l8.15">                                              lastName.get(), &amp;error,</span>
<a href="#l8.16"></a><span id="l8.16">                                              pData-&gt;stringBundle);</span>
<a href="#l8.17"></a><span id="l8.17">             pData-&gt;fatalError = true;</span>
<a href="#l8.18"></a><span id="l8.18">             break;</span>
<a href="#l8.19"></a><span id="l8.19">           }</span>
<a href="#l8.20"></a><span id="l8.20">           depth--;</span>
<a href="#l8.21"></a><span id="l8.21">         }</span>
<a href="#l8.22"></a><span id="l8.22">         if (NS_FAILED(rv)) {</span>
<a href="#l8.23"></a><span id="l8.23" class="difflineminus">-          IMPORT_LOG1(&quot;*** ImportMailThread: Failed to get the proxy interface for parent folder '%s'.&quot;, lastName.get());</span>
<a href="#l8.24"></a><span id="l8.24" class="difflineplus">+          IMPORT_LOG1(&quot;*** ImportMailThread: Failed to get the proxy interface for parent folder '%s'.&quot;, NS_ConvertUTF16toUTF8(lastName).get());</span>
<a href="#l8.25"></a><span id="l8.25">           nsImportStringBundle::GetStringByID(IMPORT_ERROR_MB_NOPROXY,</span>
<a href="#l8.26"></a><span id="l8.26">                                               pData-&gt;stringBundle, error);</span>
<a href="#l8.27"></a><span id="l8.27">           pData-&gt;fatalError = true;</span>
<a href="#l8.28"></a><span id="l8.28">           break;</span>
<a href="#l8.29"></a><span id="l8.29">         }</span>
<a href="#l8.30"></a><span id="l8.30">       }</span>
<a href="#l8.31"></a><span id="l8.31">       depth = newDepth;</span>
<a href="#l8.32"></a><span id="l8.32">       pName = nullptr;</span>
<a href="#l8.33"></a><span id="l8.33" class="difflineat">@@ -817,17 +817,17 @@ ImportMailThread(void *stuff)</span>
<a href="#l8.34"></a><span id="l8.34">           lastName.Assign(subName);</span>
<a href="#l8.35"></a><span id="l8.35">       }</span>
<a href="#l8.36"></a><span id="l8.36"> </span>
<a href="#l8.37"></a><span id="l8.37">       IMPORT_LOG1(&quot;ImportMailThread: Creating new import folder '%s'.&quot;, NS_ConvertUTF16toUTF8(lastName).get());</span>
<a href="#l8.38"></a><span id="l8.38">       ProxyCreateSubfolder(curFolder, lastName); // this may fail if the folder already exists..that's ok</span>
<a href="#l8.39"></a><span id="l8.39"> </span>
<a href="#l8.40"></a><span id="l8.40">       rv = ProxyGetChildNamed(curFolder, lastName, getter_AddRefs(newFolder));</span>
<a href="#l8.41"></a><span id="l8.41">       if (NS_FAILED(rv)) {</span>
<a href="#l8.42"></a><span id="l8.42" class="difflineminus">-        IMPORT_LOG1(&quot;*** ImportMailThread: Failed to locate subfolder '%s' after it's been created.&quot;, lastName.get());</span>
<a href="#l8.43"></a><span id="l8.43" class="difflineplus">+        IMPORT_LOG1(&quot;*** ImportMailThread: Failed to locate subfolder '%s' after it's been created.&quot;, NS_ConvertUTF16toUTF8(lastName).get());</span>
<a href="#l8.44"></a><span id="l8.44">         nsImportGenericMail::ReportError(IMPORT_ERROR_MB_CREATE, lastName.get(),</span>
<a href="#l8.45"></a><span id="l8.45">                                          &amp;error, pData-&gt;stringBundle);</span>
<a href="#l8.46"></a><span id="l8.46">       }</span>
<a href="#l8.47"></a><span id="l8.47"> </span>
<a href="#l8.48"></a><span id="l8.48">       if (size &amp;&amp; import &amp;&amp; newFolder &amp;&amp; NS_SUCCEEDED(rv)) {</span>
<a href="#l8.49"></a><span id="l8.49">         bool fatalError = false;</span>
<a href="#l8.50"></a><span id="l8.50">         pData-&gt;currentSize = size;</span>
<a href="#l8.51"></a><span id="l8.51">         char16_t *pSuccess = nullptr;</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l9.1"></a><span id="l9.1" class="difflineminus">--- a/mailnews/local/src/nsMovemailService.cpp</span>
<a href="#l9.2"></a><span id="l9.2" class="difflineplus">+++ b/mailnews/local/src/nsMovemailService.cpp</span>
<a href="#l9.3"></a><span id="l9.3" class="difflineat">@@ -95,17 +95,17 @@ private:</span>
<a href="#l9.4"></a><span id="l9.4"> }</span>
<a href="#l9.5"></a><span id="l9.5"> </span>
<a href="#l9.6"></a><span id="l9.6"> nsMovemailService::nsMovemailService()</span>
<a href="#l9.7"></a><span id="l9.7"> {</span>
<a href="#l9.8"></a><span id="l9.8"> #if defined(PR_LOGGING)</span>
<a href="#l9.9"></a><span id="l9.9">   if (!gMovemailLog)</span>
<a href="#l9.10"></a><span id="l9.10">       gMovemailLog = PR_NewLogModule(&quot;Movemail&quot;);</span>
<a href="#l9.11"></a><span id="l9.11"> #endif</span>
<a href="#l9.12"></a><span id="l9.12" class="difflineminus">-  LOG((&quot;nsMovemailService created: 0x%x\n&quot;, this));</span>
<a href="#l9.13"></a><span id="l9.13" class="difflineplus">+  LOG((&quot;nsMovemailService created: 0x%p\n&quot;, this));</span>
<a href="#l9.14"></a><span id="l9.14"> }</span>
<a href="#l9.15"></a><span id="l9.15"> </span>
<a href="#l9.16"></a><span id="l9.16"> nsMovemailService::~nsMovemailService()</span>
<a href="#l9.17"></a><span id="l9.17"> {}</span>
<a href="#l9.18"></a><span id="l9.18"> </span>
<a href="#l9.19"></a><span id="l9.19"> </span>
<a href="#l9.20"></a><span id="l9.20"> NS_IMPL_ISUPPORTS(nsMovemailService,</span>
<a href="#l9.21"></a><span id="l9.21">                    nsIMovemailService,</span>
<a href="#l9.22"></a><span id="l9.22" class="difflineat">@@ -548,17 +548,17 @@ nsMovemailService::GetNewMail(nsIMsgWind</span>
<a href="#l9.23"></a><span id="l9.23">     outputStream-&gt;Close();</span>
<a href="#l9.24"></a><span id="l9.24">   }</span>
<a href="#l9.25"></a><span id="l9.25">   // Truncate the spool file as we parsed it successfully.</span>
<a href="#l9.26"></a><span id="l9.26">   rv = spoolFile-&gt;SetFileSize(0);</span>
<a href="#l9.27"></a><span id="l9.27">   if (NS_FAILED(rv)) {</span>
<a href="#l9.28"></a><span id="l9.28">     Error(&quot;movemailCantTruncateSpoolFile&quot;, spoolPathString, 1);</span>
<a href="#l9.29"></a><span id="l9.29">   }</span>
<a href="#l9.30"></a><span id="l9.30"> </span>
<a href="#l9.31"></a><span id="l9.31" class="difflineminus">-  LOG((&quot;GetNewMail returning rv=%d&quot;, rv));</span>
<a href="#l9.32"></a><span id="l9.32" class="difflineplus">+  LOG((&quot;GetNewMail returning rv=%&quot; PRIx32, static_cast&lt;uint32_t&gt;(rv)));</span>
<a href="#l9.33"></a><span id="l9.33">   return rv;</span>
<a href="#l9.34"></a><span id="l9.34"> }</span>
<a href="#l9.35"></a><span id="l9.35"> </span>
<a href="#l9.36"></a><span id="l9.36"> </span>
<a href="#l9.37"></a><span id="l9.37"> NS_IMETHODIMP</span>
<a href="#l9.38"></a><span id="l9.38"> nsMovemailService::SetDefaultLocalPath(nsIFile *aPath)</span>
<a href="#l9.39"></a><span id="l9.39"> {</span>
<a href="#l9.40"></a><span id="l9.40">   NS_ENSURE_ARG(aPath);</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l10.1"></a><span id="l10.1" class="difflineminus">--- a/mailnews/local/src/nsPop3Protocol.cpp</span>
<a href="#l10.2"></a><span id="l10.2" class="difflineplus">+++ b/mailnews/local/src/nsPop3Protocol.cpp</span>
<a href="#l10.3"></a><span id="l10.3" class="difflineat">@@ -1384,17 +1384,17 @@ int32_t nsPop3Protocol::Pop3SendData(con</span>
<a href="#l10.4"></a><span id="l10.4">   if (NS_SUCCEEDED(result))</span>
<a href="#l10.5"></a><span id="l10.5">   {</span>
<a href="#l10.6"></a><span id="l10.6">     m_pop3ConData-&gt;pause_for_read = true;</span>
<a href="#l10.7"></a><span id="l10.7">     m_pop3ConData-&gt;next_state = POP3_WAIT_FOR_RESPONSE;</span>
<a href="#l10.8"></a><span id="l10.8">     return 0;</span>
<a href="#l10.9"></a><span id="l10.9">   }</span>
<a href="#l10.10"></a><span id="l10.10"> </span>
<a href="#l10.11"></a><span id="l10.11">   m_pop3ConData-&gt;next_state = POP3_ERROR_DONE;</span>
<a href="#l10.12"></a><span id="l10.12" class="difflineminus">-  MOZ_LOG(POP3LOGMODULE, LogLevel::Info, (POP3LOG(&quot;Pop3SendData failed: %lx&quot;), result));</span>
<a href="#l10.13"></a><span id="l10.13" class="difflineplus">+  MOZ_LOG(POP3LOGMODULE, LogLevel::Info, (POP3LOG(&quot;Pop3SendData failed: %&quot; PRIx32), static_cast&lt;uint32_t&gt;(result)));</span>
<a href="#l10.14"></a><span id="l10.14">   return -1;</span>
<a href="#l10.15"></a><span id="l10.15"> }</span>
<a href="#l10.16"></a><span id="l10.16"> </span>
<a href="#l10.17"></a><span id="l10.17"> /*</span>
<a href="#l10.18"></a><span id="l10.18">  * POP3 AUTH extension</span>
<a href="#l10.19"></a><span id="l10.19">  */</span>
<a href="#l10.20"></a><span id="l10.20"> </span>
<a href="#l10.21"></a><span id="l10.21"> int32_t nsPop3Protocol::SendAuth()</span></pre></div></div>

<div class="page_footer">
<div class="page_footer_text">comm-central</div>
<div class="page_footer_text" style="padding-left: 10px">Deployed from <a href="https://hg.mozilla.org/hgcustom/version-control-tools/rev/35f393d6769a">35f393d6769a</a> at 2020-07-16T17:23:43Z.</div>
<div class="rss_logo">
<a href="/comm-central/rss-log">RSS</a>
<a href="/comm-central/atom-log">Atom</a>
</div>
<br />

</div>
</body>
</html>

