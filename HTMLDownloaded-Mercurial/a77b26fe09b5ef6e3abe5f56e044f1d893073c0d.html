<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en-US" lang="en-US">
<head>
<link rel="icon" href="/static/35f393d6769a/hgicon.png" type="image/png" />
<meta name="robots" content="index, nofollow"/>
<link rel="stylesheet" href="/static/35f393d6769a/style-gitweb.css" type="text/css" />

<style type="text/css">
div.feed {
  float: right;
}
a img {
  border-width: 0px;
}
div.log_link {
  width: 80px;
  background-color: white;
}

div.log_body {
  padding-left: 96px;
}
</style>
<script type="text/javascript" src="/static/35f393d6769a/mercurial.js"></script>

<meta property="og:image" content="/static/35f393d6769a/moz-logo-bw-rgb.svg"/>
<meta property="og:type" content="website"/>

<title>comm-central: changeset 15755:a77b26fe09b5ef6e3abe5f56e044f1d893073c0d</title>
<link rel="alternate" type="application/atom+xml"
   href="/comm-central/atom-log" title="Atom feed for comm-central"/>
<link rel="alternate" type="application/rss+xml"
   href="/comm-central/rss-log" title="RSS feed for comm-central"/>

<meta property="og:title" content="comm-central @ a77b26fe09b5ef6e3abe5f56e044f1d893073c0d" />
<meta property="og:url" content="/comm-central/rev/a77b26fe09b5ef6e3abe5f56e044f1d893073c0d" />
<meta property="og:description" content="Bug 973385 - Instantbird doesn't build on Linux, r=clokep." />

</head>
<body>

<div class="page_header">
<div class="logo">
    <a href="https://developer.mozilla.org/en/docs/Mercurial">
        <img src="/static/35f393d6769a/moz-logo-bw-rgb.svg" alt="mercurial" />
    </a>
</div>
<a href="/">Mercurial</a> &gt; <a href="/comm-central">comm-central</a>  / changeset / a77b26fe09b5ef6e3abe5f56e044f1d893073c0d 
</div>

<div class="page_nav">
<div>
<a href="/comm-central/summary">summary</a> |
<a href="/comm-central/shortlog/a77b26fe09b5ef6e3abe5f56e044f1d893073c0d">shortlog</a> |
<a href="/comm-central/log/a77b26fe09b5ef6e3abe5f56e044f1d893073c0d">changelog</a> |
<a href="/comm-central/pushloghtml">pushlog</a> |
<a href="/comm-central/graph/a77b26fe09b5ef6e3abe5f56e044f1d893073c0d">graph</a> |
<a href="/comm-central/tags">tags</a> |
<a href="/comm-central/bookmarks">bookmarks</a> |
<a href="/comm-central/branches">branches</a> |
<a href="/comm-central/file/a77b26fe09b5ef6e3abe5f56e044f1d893073c0d">files</a> |
changeset |
<a href="/comm-central/raw-rev/a77b26fe09b5ef6e3abe5f56e044f1d893073c0d">raw</a>  | <a href="/comm-central/archive/a77b26fe09b5ef6e3abe5f56e044f1d893073c0d.zip">zip</a>  |
<a href="/comm-central/help">help</a>
</div>

<div class="search">
<form id="searchform" action="/comm-central/log">

<input name="rev" type="text" value="" size="40" />
<div id="hint">Find changesets by keywords (author, files, the commit message), revision
number or hash, or <a href="/comm-central/help/revsets">revset expression</a>.</div>
</form>
</div>
</div>

<div class="title">
<a href="https://bugzilla.mozilla.org/show_bug.cgi?id=973385">Bug 973385</a> - Instantbird doesn't build on Linux, r=clokep.
<span class="logtags"></span>
</div>
<div class="title_text">
<table cellspacing="0">

<tr><td>author</td><td>&#70;&#108;&#111;&#114;&#105;&#97;&#110;&#32;&#81;&#117;&#232;&#122;&#101;&#32;&#60;&#102;&#108;&#111;&#114;&#105;&#97;&#110;&#64;&#113;&#117;&#101;&#122;&#101;&#46;&#110;&#101;&#116;&#62;</td></tr>
<tr><td></td><td class="date age">Tue, 18 Feb 2014 20:25:25 -0500</td></tr>

<tr>
 <td>changeset 15755</td>
 <td style="font-family:monospace"><a class="list" href="/comm-central/rev/a77b26fe09b5ef6e3abe5f56e044f1d893073c0d">a77b26fe09b5ef6e3abe5f56e044f1d893073c0d</a></td>
</tr>



<tr>
<td>parent 15754</td>
<td style="font-family:monospace">
<a class="list" href="/comm-central/rev/6589c23c8ea45238b1dc543933de4711c42bbbc9">6589c23c8ea45238b1dc543933de4711c42bbbc9</a>
</td>
</tr>

<tr>
<td>child 15756</td>
<td style="font-family:monospace">
<a class="list" href="/comm-central/rev/6872b20a400922d4f663b121fd1ce05a0cdea722">6872b20a400922d4f663b121fd1ce05a0cdea722</a>
</td>
</tr>
<tr><td>push id</td><td><a href="/comm-central/pushloghtml?changeset=a77b26fe09b5ef6e3abe5f56e044f1d893073c0d">9877</a></td></tr>
<tr><td>push user</td><td>clokep@gmail.com</td></tr>
<tr><td>push date</td><td class="date age">Wed, 19 Feb 2014 01:29:08 +0000</td></tr>

<tr><td>treeherder</td><td>comm-central@a77b26fe09b5 [<a href="https://treeherder.mozilla.org/#/jobs?repo=comm-central&revision=a77b26fe09b5ef6e3abe5f56e044f1d893073c0d">default view</a>] [<a href="https://treeherder.mozilla.org/#/jobs?repo=comm-central&revision=a77b26fe09b5ef6e3abe5f56e044f1d893073c0d&filter-resultStatus=testfailed&filter-resultStatus=busted&filter-resultStatus=exception">failures only]</td></tr>
<tr><td>perfherder</td><td>[<a href="https://treeherder.mozilla.org/perf.html#/compare?originalProject=comm-central&originalRevision=a77b26fe09b5ef6e3abe5f56e044f1d893073c0d&newProject=comm-central&newRevision=a77b26fe09b5ef6e3abe5f56e044f1d893073c0d&framework=1" target="_blank">talos</a>] [<a href="https://treeherder.mozilla.org/perf.html#/compare?originalProject=comm-central&originalRevision=a77b26fe09b5ef6e3abe5f56e044f1d893073c0d&newProject=comm-central&newRevision=a77b26fe09b5ef6e3abe5f56e044f1d893073c0d&framework=2" target="_blank">build metrics</a>] [<a href="https://treeherder.mozilla.org/perf.html#/compare?originalProject=comm-central&originalRevision=a77b26fe09b5ef6e3abe5f56e044f1d893073c0d&newProject=comm-central&newRevision=a77b26fe09b5ef6e3abe5f56e044f1d893073c0d&framework=6" target="_blank">platform microbench</a>] (compared to previous push)</td></tr>
<tr><td>reviewers</td><td><a href="/comm-central/log?rev=reviewer%28clokep%29&revcount=50">clokep</a></td></tr>
<tr><td>bugs</td><td><a href="https://bugzilla.mozilla.org/show_bug.cgi?id=973385">973385</a></td></tr>




</table></div>

<div class="page_body description"><a href="https://bugzilla.mozilla.org/show_bug.cgi?id=973385">Bug 973385</a> - Instantbird doesn't build on Linux, r=clokep.</div>
<div class="list_head"></div>
<div class="title_text">
<table cellspacing="0">

<tr class="parity0">
<td><a class="list" href="/comm-central/diff/a77b26fe09b5ef6e3abe5f56e044f1d893073c0d/im/app/Makefile.in">im/app/Makefile.in</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/a77b26fe09b5ef6e3abe5f56e044f1d893073c0d/im/app/Makefile.in">file</a> |
<a href="/comm-central/annotate/a77b26fe09b5ef6e3abe5f56e044f1d893073c0d/im/app/Makefile.in">annotate</a> |
<a href="/comm-central/diff/a77b26fe09b5ef6e3abe5f56e044f1d893073c0d/im/app/Makefile.in">diff</a> |
<a href="/comm-central/comparison/a77b26fe09b5ef6e3abe5f56e044f1d893073c0d/im/app/Makefile.in">comparison</a> |
<a href="/comm-central/log/a77b26fe09b5ef6e3abe5f56e044f1d893073c0d/im/app/Makefile.in">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/a77b26fe09b5ef6e3abe5f56e044f1d893073c0d/im/app/macbuild/Contents/Info.plist.in">im/app/macbuild/Contents/Info.plist.in</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/a77b26fe09b5ef6e3abe5f56e044f1d893073c0d/im/app/macbuild/Contents/Info.plist.in">file</a> |
<a href="/comm-central/annotate/a77b26fe09b5ef6e3abe5f56e044f1d893073c0d/im/app/macbuild/Contents/Info.plist.in">annotate</a> |
<a href="/comm-central/diff/a77b26fe09b5ef6e3abe5f56e044f1d893073c0d/im/app/macbuild/Contents/Info.plist.in">diff</a> |
<a href="/comm-central/comparison/a77b26fe09b5ef6e3abe5f56e044f1d893073c0d/im/app/macbuild/Contents/Info.plist.in">comparison</a> |
<a href="/comm-central/log/a77b26fe09b5ef6e3abe5f56e044f1d893073c0d/im/app/macbuild/Contents/Info.plist.in">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/a77b26fe09b5ef6e3abe5f56e044f1d893073c0d/im/app/nsMain.cpp">im/app/nsMain.cpp</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/a77b26fe09b5ef6e3abe5f56e044f1d893073c0d/im/app/nsMain.cpp">file</a> |
<a href="/comm-central/annotate/a77b26fe09b5ef6e3abe5f56e044f1d893073c0d/im/app/nsMain.cpp">annotate</a> |
<a href="/comm-central/diff/a77b26fe09b5ef6e3abe5f56e044f1d893073c0d/im/app/nsMain.cpp">diff</a> |
<a href="/comm-central/comparison/a77b26fe09b5ef6e3abe5f56e044f1d893073c0d/im/app/nsMain.cpp">comparison</a> |
<a href="/comm-central/log/a77b26fe09b5ef6e3abe5f56e044f1d893073c0d/im/app/nsMain.cpp">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/a77b26fe09b5ef6e3abe5f56e044f1d893073c0d/im/app/splash.rc">im/app/splash.rc</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/a77b26fe09b5ef6e3abe5f56e044f1d893073c0d/im/app/splash.rc">file</a> |
<a href="/comm-central/annotate/a77b26fe09b5ef6e3abe5f56e044f1d893073c0d/im/app/splash.rc">annotate</a> |
<a href="/comm-central/diff/a77b26fe09b5ef6e3abe5f56e044f1d893073c0d/im/app/splash.rc">diff</a> |
<a href="/comm-central/comparison/a77b26fe09b5ef6e3abe5f56e044f1d893073c0d/im/app/splash.rc">comparison</a> |
<a href="/comm-central/log/a77b26fe09b5ef6e3abe5f56e044f1d893073c0d/im/app/splash.rc">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/a77b26fe09b5ef6e3abe5f56e044f1d893073c0d/im/components/mintrayr/trayToolkit.cpp">im/components/mintrayr/trayToolkit.cpp</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/a77b26fe09b5ef6e3abe5f56e044f1d893073c0d/im/components/mintrayr/trayToolkit.cpp">file</a> |
<a href="/comm-central/annotate/a77b26fe09b5ef6e3abe5f56e044f1d893073c0d/im/components/mintrayr/trayToolkit.cpp">annotate</a> |
<a href="/comm-central/diff/a77b26fe09b5ef6e3abe5f56e044f1d893073c0d/im/components/mintrayr/trayToolkit.cpp">diff</a> |
<a href="/comm-central/comparison/a77b26fe09b5ef6e3abe5f56e044f1d893073c0d/im/components/mintrayr/trayToolkit.cpp">comparison</a> |
<a href="/comm-central/log/a77b26fe09b5ef6e3abe5f56e044f1d893073c0d/im/components/mintrayr/trayToolkit.cpp">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/a77b26fe09b5ef6e3abe5f56e044f1d893073c0d/im/installer/package-manifest.in">im/installer/package-manifest.in</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/a77b26fe09b5ef6e3abe5f56e044f1d893073c0d/im/installer/package-manifest.in">file</a> |
<a href="/comm-central/annotate/a77b26fe09b5ef6e3abe5f56e044f1d893073c0d/im/installer/package-manifest.in">annotate</a> |
<a href="/comm-central/diff/a77b26fe09b5ef6e3abe5f56e044f1d893073c0d/im/installer/package-manifest.in">diff</a> |
<a href="/comm-central/comparison/a77b26fe09b5ef6e3abe5f56e044f1d893073c0d/im/installer/package-manifest.in">comparison</a> |
<a href="/comm-central/log/a77b26fe09b5ef6e3abe5f56e044f1d893073c0d/im/installer/package-manifest.in">revisions</a>
</td>
</tr>
</table></div>

<div class="page_body diffblocks"><div class="diffblock"><pre class="sourcelines">
<a href="#l1.1"></a><span id="l1.1" class="difflineminus">--- a/im/app/Makefile.in</span>
<a href="#l1.2"></a><span id="l1.2" class="difflineplus">+++ b/im/app/Makefile.in</span>
<a href="#l1.3"></a><span id="l1.3" class="difflineat">@@ -11,77 +11,65 @@ include $(DEPTH)/config/autoconf.mk</span>
<a href="#l1.4"></a><span id="l1.4"> </span>
<a href="#l1.5"></a><span id="l1.5"> AB_CD = $(MOZ_UI_LOCALE)</span>
<a href="#l1.6"></a><span id="l1.6"> </span>
<a href="#l1.7"></a><span id="l1.7"> GRE_MILESTONE = $(shell $(PYTHON) $(MOZILLA_SRCDIR)/config/printconfigsetting.py $(LIBXUL_DIST)/bin/platform.ini Build Milestone)</span>
<a href="#l1.8"></a><span id="l1.8"> GRE_BUILDID = $(shell $(PYTHON) $(MOZILLA_SRCDIR)/config/printconfigsetting.py $(LIBXUL_DIST)/bin/platform.ini Build BuildID)</span>
<a href="#l1.9"></a><span id="l1.9"> </span>
<a href="#l1.10"></a><span id="l1.10"> LICENSE_TXT_FILE = $(topsrcdir)/im/LICENSE.txt</span>
<a href="#l1.11"></a><span id="l1.11"> </span>
<a href="#l1.12"></a><span id="l1.12" class="difflineminus">-DEFINES += \</span>
<a href="#l1.13"></a><span id="l1.13" class="difflineminus">-  -DINSTANTBIRD_ICO=\&quot;$(DIST)/branding/instantbird.ico\&quot; \</span>
<a href="#l1.14"></a><span id="l1.14" class="difflineminus">-  -DAB_CD=$(AB_CD) \</span>
<a href="#l1.15"></a><span id="l1.15" class="difflineminus">-  -DGRE_MILESTONE=$(GRE_MILESTONE) \</span>
<a href="#l1.16"></a><span id="l1.16" class="difflineminus">-  -DGRE_BUILDID=$(GRE_BUILDID) \</span>
<a href="#l1.17"></a><span id="l1.17" class="difflineminus">-   $(NULL)</span>
<a href="#l1.18"></a><span id="l1.18" class="difflineminus">-</span>
<a href="#l1.19"></a><span id="l1.19"> MOZ_SOURCE_STAMP = $(firstword $(shell hg -R $(topsrcdir) parent --template=&quot;{node|short}\n&quot; 2&gt;/dev/null))</span>
<a href="#l1.20"></a><span id="l1.20"> ifdef MOZ_SOURCE_STAMP</span>
<a href="#l1.21"></a><span id="l1.21"> DEFINES += -DMOZ_SOURCE_STAMP=&quot;$(MOZ_SOURCE_STAMP)&quot;</span>
<a href="#l1.22"></a><span id="l1.22"> endif</span>
<a href="#l1.23"></a><span id="l1.23"> </span>
<a href="#l1.24"></a><span id="l1.24"> SOURCE_REPO := $(shell hg -R $(topsrcdir) showconfig paths.default 2&gt;/dev/null | sed -e &quot;s/^ssh:/http:/&quot;)</span>
<a href="#l1.25"></a><span id="l1.25"> ifdef SOURCE_REPO</span>
<a href="#l1.26"></a><span id="l1.26"> DEFINES += -DMOZ_SOURCE_REPO=&quot;$(SOURCE_REPO)&quot;</span>
<a href="#l1.27"></a><span id="l1.27"> endif</span>
<a href="#l1.28"></a><span id="l1.28"> </span>
<a href="#l1.29"></a><span id="l1.29"> ifdef MOZILLA_OFFICIAL</span>
<a href="#l1.30"></a><span id="l1.30" class="difflineminus">-DEFINES += -DOFFICIAL_BUILD=1</span>
<a href="#l1.31"></a><span id="l1.31" class="difflineplus">+DEFINES += -DMOZILLA_OFFICIAL</span>
<a href="#l1.32"></a><span id="l1.32"> endif</span>
<a href="#l1.33"></a><span id="l1.33"> </span>
<a href="#l1.34"></a><span id="l1.34"> PREF_JS_EXPORTS = \</span>
<a href="#l1.35"></a><span id="l1.35">     $(srcdir)/profile/all-instantbird.js \</span>
<a href="#l1.36"></a><span id="l1.36">     $(srcdir)/profile/channel-prefs.js \</span>
<a href="#l1.37"></a><span id="l1.37">     $(NULL)</span>
<a href="#l1.38"></a><span id="l1.38"> </span>
<a href="#l1.39"></a><span id="l1.39" class="difflineminus">-ifneq (,$(filter OS2 WINNT,$(OS_ARCH)))</span>
<a href="#l1.40"></a><span id="l1.40" class="difflineminus">-STUBNAME = $(MOZ_APP_NAME)$(BIN_SUFFIX)</span>
<a href="#l1.41"></a><span id="l1.41" class="difflineplus">+DEFINES += \</span>
<a href="#l1.42"></a><span id="l1.42" class="difflineplus">+  -DAB_CD=$(AB_CD) \</span>
<a href="#l1.43"></a><span id="l1.43" class="difflineplus">+  -DAPP_VERSION=&quot;$(MOZ_APP_VERSION)&quot; \</span>
<a href="#l1.44"></a><span id="l1.44" class="difflineplus">+  -DINSTANTBIRD_ICO=\&quot;$(DIST)/branding/instantbird.ico\&quot; \</span>
<a href="#l1.45"></a><span id="l1.45" class="difflineplus">+  -DGRE_MILESTONE=$(GRE_MILESTONE) \</span>
<a href="#l1.46"></a><span id="l1.46" class="difflineplus">+  -DGRE_BUILDID=$(GRE_BUILDID) \</span>
<a href="#l1.47"></a><span id="l1.47" class="difflineplus">+   $(NULL)</span>
<a href="#l1.48"></a><span id="l1.48" class="difflineplus">+</span>
<a href="#l1.49"></a><span id="l1.49" class="difflineplus">+ifdef LIBXUL_SDK</span>
<a href="#l1.50"></a><span id="l1.50" class="difflineplus">+include $(topsrcdir)/config/rules.mk</span>
<a href="#l1.51"></a><span id="l1.51"> else</span>
<a href="#l1.52"></a><span id="l1.52" class="difflineminus">-STUBNAME = $(MOZ_APP_NAME)-bin$(BIN_SUFFIX)</span>
<a href="#l1.53"></a><span id="l1.53" class="difflineminus">-endif</span>
<a href="#l1.54"></a><span id="l1.54" class="difflineplus">+# Build a binary bootstrapping with XRE_main</span>
<a href="#l1.55"></a><span id="l1.55"> </span>
<a href="#l1.56"></a><span id="l1.56"> DIST_FILES = application.ini</span>
<a href="#l1.57"></a><span id="l1.57"> </span>
<a href="#l1.58"></a><span id="l1.58"> LOCAL_INCLUDES += \</span>
<a href="#l1.59"></a><span id="l1.59">   -I$(MOZILLA_SRCDIR)/toolkit/xre \</span>
<a href="#l1.60"></a><span id="l1.60">   -I$(MOZILLA_SRCDIR)/xpcom/base \</span>
<a href="#l1.61"></a><span id="l1.61" class="difflineplus">+  -I$(MOZILLA_SRCDIR)/xpcom/build \</span>
<a href="#l1.62"></a><span id="l1.62">   $(NULL)</span>
<a href="#l1.63"></a><span id="l1.63"> </span>
<a href="#l1.64"></a><span id="l1.64" class="difflineminus">-ifeq (cocoa,$(MOZ_WIDGET_TOOLKIT))</span>
<a href="#l1.65"></a><span id="l1.65" class="difflineminus">-LIBS += $(DIST)/bin/XUL</span>
<a href="#l1.66"></a><span id="l1.66" class="difflineminus">-endif</span>
<a href="#l1.67"></a><span id="l1.67" class="difflineminus">-</span>
<a href="#l1.68"></a><span id="l1.68" class="difflineminus">-ifeq (cocoa,$(MOZ_WIDGET_TOOLKIT))</span>
<a href="#l1.69"></a><span id="l1.69" class="difflineminus">-TK_LIBS := -framework Cocoa $(TK_LIBS)</span>
<a href="#l1.70"></a><span id="l1.70" class="difflineminus">-endif</span>
<a href="#l1.71"></a><span id="l1.71" class="difflineminus">-</span>
<a href="#l1.72"></a><span id="l1.72" class="difflineminus">-APP_XPCOM_LIBS = $(XPCOM_GLUE_LDOPTS)</span>
<a href="#l1.73"></a><span id="l1.73" class="difflineplus">+DEFINES += -DXPCOM_GLUE</span>
<a href="#l1.74"></a><span id="l1.74" class="difflineplus">+STL_FLAGS=</span>
<a href="#l1.75"></a><span id="l1.75"> </span>
<a href="#l1.76"></a><span id="l1.76"> LIBS += \</span>
<a href="#l1.77"></a><span id="l1.77" class="difflineminus">-	$(STATIC_COMPONENTS_LINKER_PATH) \</span>
<a href="#l1.78"></a><span id="l1.78" class="difflineminus">-	$(APP_XPCOM_LIBS) \</span>
<a href="#l1.79"></a><span id="l1.79" class="difflineminus">-	$(NSPR_LIBS) \</span>
<a href="#l1.80"></a><span id="l1.80" class="difflineplus">+	$(XPCOM_STANDALONE_GLUE_LDOPTS) \</span>
<a href="#l1.81"></a><span id="l1.81"> 	$(NULL)</span>
<a href="#l1.82"></a><span id="l1.82"> </span>
<a href="#l1.83"></a><span id="l1.83" class="difflineminus">-ifdef MOZ_JPROF</span>
<a href="#l1.84"></a><span id="l1.84" class="difflineminus">-LIBS += -ljprof</span>
<a href="#l1.85"></a><span id="l1.85" class="difflineminus">-endif</span>
<a href="#l1.86"></a><span id="l1.86" class="difflineminus">-</span>
<a href="#l1.87"></a><span id="l1.87" class="difflineminus">-ifdef MOZ_ENABLE_DBUS</span>
<a href="#l1.88"></a><span id="l1.88" class="difflineminus">-LIBS += $(MOZ_DBUS_GLIB_LIBS)</span>
<a href="#l1.89"></a><span id="l1.89" class="difflineplus">+ifdef MOZ_LINKER</span>
<a href="#l1.90"></a><span id="l1.90" class="difflineplus">+LIBS += $(MOZ_ZLIB_LIBS)</span>
<a href="#l1.91"></a><span id="l1.91"> endif</span>
<a href="#l1.92"></a><span id="l1.92"> </span>
<a href="#l1.93"></a><span id="l1.93"> ifndef MOZ_WINCONSOLE</span>
<a href="#l1.94"></a><span id="l1.94"> ifdef MOZ_DEBUG</span>
<a href="#l1.95"></a><span id="l1.95"> MOZ_WINCONSOLE = 1</span>
<a href="#l1.96"></a><span id="l1.96"> else</span>
<a href="#l1.97"></a><span id="l1.97"> MOZ_WINCONSOLE = 0</span>
<a href="#l1.98"></a><span id="l1.98"> endif</span>
<a href="#l1.99"></a><span id="l1.99" class="difflineat">@@ -94,20 +82,16 @@ NSDISTMODE = copy</span>
<a href="#l1.100"></a><span id="l1.100"> include $(topsrcdir)/config/config.mk</span>
<a href="#l1.101"></a><span id="l1.101"> </span>
<a href="#l1.102"></a><span id="l1.102"> ifdef _MSC_VER</span>
<a href="#l1.103"></a><span id="l1.103"> # Always enter a Windows program through wmain, whether or not we're</span>
<a href="#l1.104"></a><span id="l1.104"> # a console application.</span>
<a href="#l1.105"></a><span id="l1.105"> WIN32_EXE_LDFLAGS += -ENTRY:wmainCRTStartup</span>
<a href="#l1.106"></a><span id="l1.106"> endif</span>
<a href="#l1.107"></a><span id="l1.107"> </span>
<a href="#l1.108"></a><span id="l1.108" class="difflineminus">-ifdef NS_TRACE_MALLOC</span>
<a href="#l1.109"></a><span id="l1.109" class="difflineminus">-EXTRA_DSO_LIBS += tracemalloc</span>
<a href="#l1.110"></a><span id="l1.110" class="difflineminus">-endif</span>
<a href="#l1.111"></a><span id="l1.111" class="difflineminus">-</span>
<a href="#l1.112"></a><span id="l1.112"> ifeq ($(OS_ARCH),WINNT)</span>
<a href="#l1.113"></a><span id="l1.113"> # png to ico converter. The function takes 5 arguments, in order: source png</span>
<a href="#l1.114"></a><span id="l1.114"> # file, left, top, size, output ico file.</span>
<a href="#l1.115"></a><span id="l1.115"> png2ico = $(PYTHON) $(srcdir)/png2ico.py $(1) $(2) $(3) $(4) $(5)</span>
<a href="#l1.116"></a><span id="l1.116"> </span>
<a href="#l1.117"></a><span id="l1.117"> # Extract the icons we care about embedding into the EXE</span>
<a href="#l1.118"></a><span id="l1.118"> available-16.ico: $(topsrcdir)/chat/themes/available-16.png $(srcdir)/png2ico.py</span>
<a href="#l1.119"></a><span id="l1.119"> 	$(call png2ico,$(topsrcdir)/chat/themes/available-16.png,0,0,16,available-16.ico)</span>
<a href="#l1.120"></a><span id="l1.120" class="difflineat">@@ -116,79 +100,67 @@ away-16.ico: $(topsrcdir)/chat/themes/aw</span>
<a href="#l1.121"></a><span id="l1.121"> 	$(call png2ico,$(topsrcdir)/chat/themes/away-16.png,0,0,16,away-16.ico)</span>
<a href="#l1.122"></a><span id="l1.122"> </span>
<a href="#l1.123"></a><span id="l1.123"> offline-16.ico: $(topsrcdir)/chat/themes/offline-16.png $(srcdir)/png2ico.py</span>
<a href="#l1.124"></a><span id="l1.124"> 	$(call png2ico,$(topsrcdir)/chat/themes/offline-16.png,0,0,16,offline-16.ico)</span>
<a href="#l1.125"></a><span id="l1.125"> </span>
<a href="#l1.126"></a><span id="l1.126"> embedded-icons:: available-16.ico away-16.ico offline-16.ico</span>
<a href="#l1.127"></a><span id="l1.127"> GARBAGE += available-16.ico away-16.ico offline-16.ico</span>
<a href="#l1.128"></a><span id="l1.128"> </span>
<a href="#l1.129"></a><span id="l1.129" class="difflineminus">-OS_LIBS += $(call EXPAND_LIBNAME,comctl32 comdlg32 uuid shell32 ole32 oleaut32 version winspool)</span>
<a href="#l1.130"></a><span id="l1.130" class="difflineminus">-OS_LIBS += $(call EXPAND_LIBNAME,usp10 msimg32)</span>
<a href="#l1.131"></a><span id="l1.131" class="difflineminus">-endif</span>
<a href="#l1.132"></a><span id="l1.132" class="difflineminus">-</span>
<a href="#l1.133"></a><span id="l1.133" class="difflineminus">-ifeq ($(OS_ARCH),WINNT)</span>
<a href="#l1.134"></a><span id="l1.134"> RCINCLUDE = splash.rc</span>
<a href="#l1.135"></a><span id="l1.135" class="difflineplus">+# Rebuild instantbird.exe if the manifest changes - it's included by splash.rc.</span>
<a href="#l1.136"></a><span id="l1.136" class="difflineplus">+# (this dependency should really be just for instantbird.exe, not other targets)</span>
<a href="#l1.137"></a><span id="l1.137" class="difflineplus">+EXTRA_DEPS += $(PROGRAM).manifest</span>
<a href="#l1.138"></a><span id="l1.138"> ifndef GNU_CC</span>
<a href="#l1.139"></a><span id="l1.139"> RCFLAGS += -DMOZ_INSTANTBIRD -I$(srcdir)</span>
<a href="#l1.140"></a><span id="l1.140"> else</span>
<a href="#l1.141"></a><span id="l1.141"> RCFLAGS += -DMOZ_INSTANTBIRD --include-dir $(srcdir)</span>
<a href="#l1.142"></a><span id="l1.142"> endif</span>
<a href="#l1.143"></a><span id="l1.143"> endif</span>
<a href="#l1.144"></a><span id="l1.144"> </span>
<a href="#l1.145"></a><span id="l1.145"> ifeq ($(OS_ARCH),OS2)</span>
<a href="#l1.146"></a><span id="l1.146"> RESFILE=splashos2.res</span>
<a href="#l1.147"></a><span id="l1.147"> RCFLAGS += -DMOZ_INSTANTBIRD</span>
<a href="#l1.148"></a><span id="l1.148" class="difflineminus">-ifdef DEBUG</span>
<a href="#l1.149"></a><span id="l1.149" class="difflineminus">-RCFLAGS += -DDEBUG</span>
<a href="#l1.150"></a><span id="l1.150" class="difflineminus">-endif</span>
<a href="#l1.151"></a><span id="l1.151"> RCFLAGS += -DINSTANTBIRD_ICO=\&quot;$(DIST)/branding/instantbird.ico\&quot;</span>
<a href="#l1.152"></a><span id="l1.152"> endif</span>
<a href="#l1.153"></a><span id="l1.153"> </span>
<a href="#l1.154"></a><span id="l1.154" class="difflineminus">-LIBS += $(JEMALLOC_LIBS)</span>
<a href="#l1.155"></a><span id="l1.155" class="difflineminus">-</span>
<a href="#l1.156"></a><span id="l1.156"> include $(topsrcdir)/config/rules.mk</span>
<a href="#l1.157"></a><span id="l1.157"> </span>
<a href="#l1.158"></a><span id="l1.158" class="difflineminus">-ifdef MOZILLA_OFFICIAL</span>
<a href="#l1.159"></a><span id="l1.159" class="difflineminus">-DEFINES += -DMOZILLA_OFFICIAL</span>
<a href="#l1.160"></a><span id="l1.160" class="difflineminus">-endif</span>
<a href="#l1.161"></a><span id="l1.161" class="difflineminus">-</span>
<a href="#l1.162"></a><span id="l1.162" class="difflineminus">-APP_UA_NAME = $(shell echo $(MOZ_APP_DISPLAYNAME) | sed -e's/[^A-Za-z]//g')</span>
<a href="#l1.163"></a><span id="l1.163" class="difflineminus">-DEFINES += -DAPP_VERSION=&quot;$(MOZ_APP_VERSION)&quot; -DAPP_UA_NAME=&quot;$(APP_UA_NAME)&quot;</span>
<a href="#l1.164"></a><span id="l1.164" class="difflineminus">-</span>
<a href="#l1.165"></a><span id="l1.165" class="difflineminus">-ifeq (cocoa,$(MOZ_WIDGET_TOOLKIT))</span>
<a href="#l1.166"></a><span id="l1.166" class="difflineminus">-LIBS	+= -framework CoreAudio -framework AudioToolbox -framework AudioUnit -framework Carbon</span>
<a href="#l1.167"></a><span id="l1.167" class="difflineminus">-endif</span>
<a href="#l1.168"></a><span id="l1.168" class="difflineminus">-</span>
<a href="#l1.169"></a><span id="l1.169"> ifeq ($(OS_ARCH),WINNT)</span>
<a href="#l1.170"></a><span id="l1.170"> </span>
<a href="#l1.171"></a><span id="l1.171"> $(RESFILE): embedded-icons</span>
<a href="#l1.172"></a><span id="l1.172"> </span>
<a href="#l1.173"></a><span id="l1.173"> #</span>
<a href="#l1.174"></a><span id="l1.174"> # Control the default heap size.</span>
<a href="#l1.175"></a><span id="l1.175"> # This is the heap returned by GetProcessHeap().</span>
<a href="#l1.176"></a><span id="l1.176"> # As we use the CRT heap, the default size is too large and wastes VM.</span>
<a href="#l1.177"></a><span id="l1.177"> #</span>
<a href="#l1.178"></a><span id="l1.178"> # The default heap size is 1MB on Win32.</span>
<a href="#l1.179"></a><span id="l1.179"> # The heap will grow if need be.</span>
<a href="#l1.180"></a><span id="l1.180"> #</span>
<a href="#l1.181"></a><span id="l1.181"> # Set it to 256k.  See bug 127069.</span>
<a href="#l1.182"></a><span id="l1.182"> #</span>
<a href="#l1.183"></a><span id="l1.183"> ifndef GNU_CC</span>
<a href="#l1.184"></a><span id="l1.184"> LDFLAGS += /HEAP:0x40000</span>
<a href="#l1.185"></a><span id="l1.185" class="difflineplus">+ifeq ($(OS_TEST),x86_64)</span>
<a href="#l1.186"></a><span id="l1.186" class="difflineplus">+# set stack to 2MB on x64 build.  See bug 582910</span>
<a href="#l1.187"></a><span id="l1.187" class="difflineplus">+LDFLAGS += -STACK:2097152</span>
<a href="#l1.188"></a><span id="l1.188" class="difflineplus">+endif</span>
<a href="#l1.189"></a><span id="l1.189"> endif</span>
<a href="#l1.190"></a><span id="l1.190"> endif</span>
<a href="#l1.191"></a><span id="l1.191"> </span>
<a href="#l1.192"></a><span id="l1.192"> ifneq (,$(filter-out OS2 WINNT,$(OS_ARCH)))</span>
<a href="#l1.193"></a><span id="l1.193"> libs::</span>
<a href="#l1.194"></a><span id="l1.194"> 	cp -p $(MOZ_APP_NAME)$(BIN_SUFFIX) $(DIST)/bin/$(MOZ_APP_NAME)-bin$(BIN_SUFFIX)</span>
<a href="#l1.195"></a><span id="l1.195"> </span>
<a href="#l1.196"></a><span id="l1.196"> GARBAGE += $(addprefix $(DIST)/bin/defaults/pref/, all.js all-instantbird.js channel-prefs.js chat-prefs.js)</span>
<a href="#l1.197"></a><span id="l1.197"> endif # ! OS 2 or WinNT</span>
<a href="#l1.198"></a><span id="l1.198"> </span>
<a href="#l1.199"></a><span id="l1.199" class="difflineplus">+endif # LIBXUL_SDK</span>
<a href="#l1.200"></a><span id="l1.200" class="difflineplus">+</span>
<a href="#l1.201"></a><span id="l1.201"> ifneq (,$(filter windows gtk gtk2,$(MOZ_WIDGET_TOOLKIT)))</span>
<a href="#l1.202"></a><span id="l1.202"> ifneq (,$(filter windows,$(MOZ_WIDGET_TOOLKIT)))</span>
<a href="#l1.203"></a><span id="l1.203"> ICON_SUFFIX=.ico</span>
<a href="#l1.204"></a><span id="l1.204"> else</span>
<a href="#l1.205"></a><span id="l1.205"> ICON_SUFFIX=.png</span>
<a href="#l1.206"></a><span id="l1.206"> endif</span>
<a href="#l1.207"></a><span id="l1.207"> </span>
<a href="#l1.208"></a><span id="l1.208"> ifeq ($(MOZ_WIDGET_TOOLKIT),gtk2)</span>
<a href="#l1.209"></a><span id="l1.209" class="difflineat">@@ -224,27 +196,16 @@ libs:: $(addprefix $(DIST)/branding/,$(B</span>
<a href="#l1.210"></a><span id="l1.210"> endif</span>
<a href="#l1.211"></a><span id="l1.211"> </span>
<a href="#l1.212"></a><span id="l1.212"> ifeq ($(MOZ_WIDGET_TOOLKIT),gtk2)</span>
<a href="#l1.213"></a><span id="l1.213"> libs::</span>
<a href="#l1.214"></a><span id="l1.214"> 	$(INSTALL) $(DIST)/branding/default16.png $(DIST)/bin/chrome/icons/default</span>
<a href="#l1.215"></a><span id="l1.215"> endif</span>
<a href="#l1.216"></a><span id="l1.216"> </span>
<a href="#l1.217"></a><span id="l1.217"> ifneq (,$(filter-out WINNT Darwin,$(OS_ARCH)))</span>
<a href="#l1.218"></a><span id="l1.218" class="difflineminus">-$(MOZ_APP_NAME):: $(MOZILLA_DIR)/build/unix/mozilla.in $(GLOBAL_DEPS) $(DEPTH)/config/autoconf.mk</span>
<a href="#l1.219"></a><span id="l1.219" class="difflineminus">-	cat $&lt; | sed -e &quot;s|%MOZAPPDIR%|$(installdir)|&quot; \</span>
<a href="#l1.220"></a><span id="l1.220" class="difflineminus">-		-e &quot;s|%MOZ_APP_DISPLAYNAME%|$(MOZ_APP_DISPLAYNAME)|&quot; &gt; $@</span>
<a href="#l1.221"></a><span id="l1.221" class="difflineminus">-	chmod +x $@</span>
<a href="#l1.222"></a><span id="l1.222" class="difflineminus">-</span>
<a href="#l1.223"></a><span id="l1.223" class="difflineminus">-libs:: $(MOZ_APP_NAME)</span>
<a href="#l1.224"></a><span id="l1.224" class="difflineminus">-	$(INSTALL) $&lt; $(DIST)/bin</span>
<a href="#l1.225"></a><span id="l1.225" class="difflineminus">-</span>
<a href="#l1.226"></a><span id="l1.226" class="difflineminus">-install:: $(MOZ_APP_NAME)</span>
<a href="#l1.227"></a><span id="l1.227" class="difflineminus">-	$(SYSINSTALL) $&lt; $(DESTDIR)$(bindir)</span>
<a href="#l1.228"></a><span id="l1.228" class="difflineminus">-</span>
<a href="#l1.229"></a><span id="l1.229"> ifdef LIBXUL_SDK</span>
<a href="#l1.230"></a><span id="l1.230"> libs::</span>
<a href="#l1.231"></a><span id="l1.231"> 	cp $(LIBXUL_DIST)/bin/xulrunner-stub$(BIN_SUFFIX) $(DIST)/bin/$(STUBNAME)</span>
<a href="#l1.232"></a><span id="l1.232"> endif</span>
<a href="#l1.233"></a><span id="l1.233"> </span>
<a href="#l1.234"></a><span id="l1.234"> GARBAGE +=  $(MOZ_APP_NAME)</span>
<a href="#l1.235"></a><span id="l1.235"> GARBAGE += $(addprefix $(DIST)/bin/defaults/pref/, all.js all-instantbird.js channel-prefs.js)</span>
<a href="#l1.236"></a><span id="l1.236"> endif</span>
<a href="#l1.237"></a><span id="l1.237" class="difflineat">@@ -265,20 +226,16 @@ ifdef MOZ_SPLASHSCREEN</span>
<a href="#l1.238"></a><span id="l1.238"> ifeq ($(MOZ_WIDGET_TOOLKIT),windows)</span>
<a href="#l1.239"></a><span id="l1.239"> libs::</span>
<a href="#l1.240"></a><span id="l1.240"> 	if test -f $(DIST)/branding/splash.bmp; then \</span>
<a href="#l1.241"></a><span id="l1.241"> 	  $(INSTALL) $(IFLAGS1) $(DIST)/branding/splash.bmp $(DIST)/bin; \</span>
<a href="#l1.242"></a><span id="l1.242">         fi</span>
<a href="#l1.243"></a><span id="l1.243"> endif</span>
<a href="#l1.244"></a><span id="l1.244"> endif</span>
<a href="#l1.245"></a><span id="l1.245"> </span>
<a href="#l1.246"></a><span id="l1.246" class="difflineminus">-ifeq ($(MOZ_WIDGET_TOOLKIT),photon)</span>
<a href="#l1.247"></a><span id="l1.247" class="difflineminus">-LIBS += -lphexlib</span>
<a href="#l1.248"></a><span id="l1.248" class="difflineminus">-endif</span>
<a href="#l1.249"></a><span id="l1.249" class="difflineminus">-</span>
<a href="#l1.250"></a><span id="l1.250"> libs:: $(LICENSE_TXT_FILE)</span>
<a href="#l1.251"></a><span id="l1.251"> ifeq ($(OS_ARCH),WINNT)</span>
<a href="#l1.252"></a><span id="l1.252"> 	$(EXIT_ON_ERROR) \</span>
<a href="#l1.253"></a><span id="l1.253"> 	for file in $^; do \</span>
<a href="#l1.254"></a><span id="l1.254"> 	$(PERL) -pe 's/(?&lt;!\r)\n/\r\n/g;' &lt; $$file &gt; $(FINAL_TARGET)/`basename $$file`; \</span>
<a href="#l1.255"></a><span id="l1.255"> 	done</span>
<a href="#l1.256"></a><span id="l1.256"> else</span>
<a href="#l1.257"></a><span id="l1.257"> 	$(SYSINSTALL) $(IFLAGS1) $^ $(FINAL_TARGET)</span>
<a href="#l1.258"></a><span id="l1.258" class="difflineat">@@ -290,44 +247,75 @@ module.ver: module.ver.in $(DEPTH)/confi</span>
<a href="#l1.259"></a><span id="l1.259"> _RC_STRING += -SRCDIR .</span>
<a href="#l1.260"></a><span id="l1.260"> module.rc: module.ver</span>
<a href="#l1.261"></a><span id="l1.261"> </span>
<a href="#l1.262"></a><span id="l1.262"> GARBAGE += module.ver</span>
<a href="#l1.263"></a><span id="l1.263"> </span>
<a href="#l1.264"></a><span id="l1.264"> libs:: $(srcdir)/profile/prefs.js</span>
<a href="#l1.265"></a><span id="l1.265"> 	$(INSTALL) $(IFLAGS1) $^ $(DIST)/bin/defaults/profile</span>
<a href="#l1.266"></a><span id="l1.266"> </span>
<a href="#l1.267"></a><span id="l1.267" class="difflineplus">+ifdef ENABLE_TESTS</span>
<a href="#l1.268"></a><span id="l1.268"> # XXX This is a hack to ensure that we get the right xpcshell.ini for our tests.</span>
<a href="#l1.269"></a><span id="l1.269"> # mozilla-central does this in testing/xpcshell-tests which means that it is very</span>
<a href="#l1.270"></a><span id="l1.270"> # hard for anyone to specify anything else.</span>
<a href="#l1.271"></a><span id="l1.271"> libs::</span>
<a href="#l1.272"></a><span id="l1.272"> 	$(INSTALL) $(topsrcdir)/im/test/xpcshell.ini $(MOZDEPTH)/_tests/xpcshell</span>
<a href="#l1.273"></a><span id="l1.273"> 	cp $(topsrcdir)/im/test/xpcshell.ini $(MOZDEPTH)/_tests/xpcshell/all-test-dirs.list</span>
<a href="#l1.274"></a><span id="l1.274" class="difflineplus">+endif</span>
<a href="#l1.275"></a><span id="l1.275"> </span>
<a href="#l1.276"></a><span id="l1.276"> ifeq (cocoa,$(MOZ_WIDGET_TOOLKIT))</span>
<a href="#l1.277"></a><span id="l1.277"> </span>
<a href="#l1.278"></a><span id="l1.278" class="difflineminus">-AB := $(firstword $(subst -, ,$(AB_CD)))</span>
<a href="#l1.279"></a><span id="l1.279" class="difflineminus">-</span>
<a href="#l1.280"></a><span id="l1.280"> MAC_APP_NAME = $(MOZ_APP_DISPLAYNAME)</span>
<a href="#l1.281"></a><span id="l1.281"> </span>
<a href="#l1.282"></a><span id="l1.282"> ifdef MOZ_DEBUG</span>
<a href="#l1.283"></a><span id="l1.283"> MAC_APP_NAME := $(MAC_APP_NAME)Debug</span>
<a href="#l1.284"></a><span id="l1.284"> endif</span>
<a href="#l1.285"></a><span id="l1.285"> </span>
<a href="#l1.286"></a><span id="l1.286" class="difflineminus">-tools:: $(PROGRAM)</span>
<a href="#l1.287"></a><span id="l1.287" class="difflineminus">-	mkdir -p $(DIST)/$(MOZ_MACBUNDLE_NAME)/Contents/MacOS</span>
<a href="#l1.288"></a><span id="l1.288" class="difflineminus">-	rsync -a --exclude CVS --exclude &quot;*.in&quot; $(srcdir)/macbuild/Contents $(DIST)/$(MOZ_MACBUNDLE_NAME) --exclude English.lproj</span>
<a href="#l1.289"></a><span id="l1.289" class="difflineminus">-	mkdir -p $(DIST)/$(MOZ_MACBUNDLE_NAME)/Contents/Resources/$(AB).lproj</span>
<a href="#l1.290"></a><span id="l1.290" class="difflineminus">-	rsync -a --exclude CVS --exclude &quot;*.in&quot; $(srcdir)/macbuild/Contents/Resources/English.lproj/ $(DIST)/$(MOZ_MACBUNDLE_NAME)/Contents/Resources/$(AB).lproj</span>
<a href="#l1.291"></a><span id="l1.291" class="difflineplus">+AB_CD = $(MOZ_UI_LOCALE)</span>
<a href="#l1.292"></a><span id="l1.292" class="difflineplus">+</span>
<a href="#l1.293"></a><span id="l1.293" class="difflineplus">+AB := $(firstword $(subst -, ,$(AB_CD)))</span>
<a href="#l1.294"></a><span id="l1.294" class="difflineplus">+</span>
<a href="#l1.295"></a><span id="l1.295" class="difflineplus">+clean clobber repackage::</span>
<a href="#l1.296"></a><span id="l1.296" class="difflineplus">+	$(RM) -r $(DIST)/$(MOZ_MACBUNDLE_NAME)</span>
<a href="#l1.297"></a><span id="l1.297" class="difflineplus">+</span>
<a href="#l1.298"></a><span id="l1.298" class="difflineplus">+ifdef LIBXUL_SDK</span>
<a href="#l1.299"></a><span id="l1.299" class="difflineplus">+APPFILES = Resources</span>
<a href="#l1.300"></a><span id="l1.300" class="difflineplus">+else</span>
<a href="#l1.301"></a><span id="l1.301" class="difflineplus">+APPFILES = MacOS</span>
<a href="#l1.302"></a><span id="l1.302" class="difflineplus">+endif</span>
<a href="#l1.303"></a><span id="l1.303" class="difflineplus">+</span>
<a href="#l1.304"></a><span id="l1.304" class="difflineplus">+tools repackage:: $(PROGRAM)</span>
<a href="#l1.305"></a><span id="l1.305" class="difflineplus">+	$(MKDIR) -p $(DIST)/$(MOZ_MACBUNDLE_NAME)/Contents/MacOS</span>
<a href="#l1.306"></a><span id="l1.306" class="difflineplus">+	rsync -a --exclude &quot;*.in&quot; $(srcdir)/macbuild/Contents $(DIST)/$(MOZ_MACBUNDLE_NAME) --exclude English.lproj</span>
<a href="#l1.307"></a><span id="l1.307" class="difflineplus">+	$(MKDIR) -p $(DIST)/$(MOZ_MACBUNDLE_NAME)/Contents/Resources/$(AB).lproj</span>
<a href="#l1.308"></a><span id="l1.308" class="difflineplus">+	rsync -a --exclude &quot;*.in&quot; $(srcdir)/macbuild/Contents/Resources/English.lproj/ $(DIST)/$(MOZ_MACBUNDLE_NAME)/Contents/Resources/$(AB).lproj</span>
<a href="#l1.309"></a><span id="l1.309"> 	sed -e &quot;s/%APP_VERSION%/$(MOZ_APP_VERSION)/&quot; -e &quot;s/%MAC_APP_NAME%/$(MAC_APP_NAME)/&quot; $(srcdir)/macbuild/Contents/Info.plist.in &gt; $(DIST)/$(MOZ_MACBUNDLE_NAME)/Contents/Info.plist</span>
<a href="#l1.310"></a><span id="l1.310"> 	sed -e &quot;s/%MAC_APP_NAME%/$(MAC_APP_NAME)/&quot; $(srcdir)/macbuild/Contents/Resources/English.lproj/InfoPlist.strings.in | iconv -f UTF-8 -t UTF-16 &gt; $(DIST)/$(MOZ_MACBUNDLE_NAME)/Contents/Resources/$(AB).lproj/InfoPlist.strings</span>
<a href="#l1.311"></a><span id="l1.311" class="difflineminus">-	rsync -a $(DIST)/bin/ $(DIST)/$(MOZ_MACBUNDLE_NAME)/Contents/MacOS</span>
<a href="#l1.312"></a><span id="l1.312" class="difflineminus">-	rm -f $(DIST)/$(MOZ_MACBUNDLE_NAME)/Contents/MacOS/$(PROGRAM)</span>
<a href="#l1.313"></a><span id="l1.313" class="difflineplus">+	rsync -a $(DIST)/bin/ $(DIST)/$(MOZ_MACBUNDLE_NAME)/Contents/$(APPFILES)</span>
<a href="#l1.314"></a><span id="l1.314" class="difflineplus">+ifdef LIBXUL_SDK</span>
<a href="#l1.315"></a><span id="l1.315" class="difflineplus">+	cp $(LIBXUL_DIST)/bin/$(XR_STUB_NAME) $(DIST)/$(MOZ_MACBUNDLE_NAME)/Contents/MacOS/instantbird</span>
<a href="#l1.316"></a><span id="l1.316" class="difflineplus">+else</span>
<a href="#l1.317"></a><span id="l1.317" class="difflineplus">+	$(RM) $(DIST)/$(MOZ_MACBUNDLE_NAME)/Contents/MacOS/$(PROGRAM)</span>
<a href="#l1.318"></a><span id="l1.318"> 	rsync -aL $(PROGRAM) $(DIST)/$(MOZ_MACBUNDLE_NAME)/Contents/MacOS</span>
<a href="#l1.319"></a><span id="l1.319" class="difflineplus">+endif</span>
<a href="#l1.320"></a><span id="l1.320"> 	cp -RL $(DIST)/branding/instantbird.icns $(DIST)/$(MOZ_MACBUNDLE_NAME)/Contents/Resources/instantbird.icns</span>
<a href="#l1.321"></a><span id="l1.321"> 	printf APPLMOZM &gt; $(DIST)/$(MOZ_MACBUNDLE_NAME)/Contents/PkgInfo</span>
<a href="#l1.322"></a><span id="l1.322" class="difflineplus">+else</span>
<a href="#l1.323"></a><span id="l1.323" class="difflineplus">+ifdef LIBXUL_SDK</span>
<a href="#l1.324"></a><span id="l1.324" class="difflineplus">+libs::</span>
<a href="#l1.325"></a><span id="l1.325" class="difflineplus">+	cp $(LIBXUL_DIST)/bin/$(XULRUNNER_STUB_NAME)$(BIN_SUFFIX) $(DIST)/bin/instantbird$(BIN_SUFFIX)</span>
<a href="#l1.326"></a><span id="l1.326" class="difflineplus">+endif</span>
<a href="#l1.327"></a><span id="l1.327" class="difflineplus">+endif</span>
<a href="#l1.328"></a><span id="l1.328"> </span>
<a href="#l1.329"></a><span id="l1.329" class="difflineminus">-clean clobber::</span>
<a href="#l1.330"></a><span id="l1.330" class="difflineminus">-	rm -rf $(DIST)/$(MOZ_MACBUNDLE_NAME)</span>
<a href="#l1.331"></a><span id="l1.331" class="difflineminus">-endif</span>
<a href="#l1.332"></a><span id="l1.332" class="difflineplus">+ifdef LIBXUL_SDK</span>
<a href="#l1.333"></a><span id="l1.333" class="difflineplus">+ifndef SKIP_COPY_XULRUNNER</span>
<a href="#l1.334"></a><span id="l1.334" class="difflineplus">+libs::</span>
<a href="#l1.335"></a><span id="l1.335" class="difflineplus">+ifeq (cocoa,$(MOZ_WIDGET_TOOLKIT))</span>
<a href="#l1.336"></a><span id="l1.336" class="difflineplus">+	rsync -a --copy-unsafe-links $(LIBXUL_DIST)/XUL.framework $(DIST)/$(MOZ_MACBUNDLE_NAME)/Contents/Frameworks</span>
<a href="#l1.337"></a><span id="l1.337" class="difflineplus">+else</span>
<a href="#l1.338"></a><span id="l1.338" class="difflineplus">+	$(NSINSTALL) -D $(DIST)/bin/xulrunner</span>
<a href="#l1.339"></a><span id="l1.339" class="difflineplus">+	(cd $(LIBXUL_SDK)/bin &amp;&amp; tar $(TAR_CREATE_FLAGS) - .) | (cd $(DIST)/bin/xulrunner &amp;&amp; tar -xf -)</span>
<a href="#l1.340"></a><span id="l1.340" class="difflineplus">+endif # cocoa</span>
<a href="#l1.341"></a><span id="l1.341" class="difflineplus">+endif # SKIP_COPY_XULRUNNER</span>
<a href="#l1.342"></a><span id="l1.342" class="difflineplus">+endif # LIBXUL_SDK</span>
<a href="#l1.343"></a><span id="l1.343"> </span>
<a href="#l1.344"></a><span id="l1.344"> # Note that anything you do to dist/ down here isn't going to make it into the</span>
<a href="#l1.345"></a><span id="l1.345"> # Mac build, since it's already been copied over to the .app, above.</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l2.1"></a><span id="l2.1" class="difflineminus">--- a/im/app/macbuild/Contents/Info.plist.in</span>
<a href="#l2.2"></a><span id="l2.2" class="difflineplus">+++ b/im/app/macbuild/Contents/Info.plist.in</span>
<a href="#l2.3"></a><span id="l2.3" class="difflineat">@@ -1,16 +1,16 @@</span>
<a href="#l2.4"></a><span id="l2.4"> &lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;</span>
<a href="#l2.5"></a><span id="l2.5"> &lt;!DOCTYPE plist PUBLIC &quot;-//Apple Computer//DTD PLIST 1.0//EN&quot; &quot;http://www.apple.com/DTDs/PropertyList-1.0.dtd&quot;&gt;</span>
<a href="#l2.6"></a><span id="l2.6"> &lt;plist version=&quot;1.0&quot;&gt;</span>
<a href="#l2.7"></a><span id="l2.7"> &lt;dict&gt;</span>
<a href="#l2.8"></a><span id="l2.8"> 	&lt;key&gt;CFBundleDevelopmentRegion&lt;/key&gt;</span>
<a href="#l2.9"></a><span id="l2.9"> 	&lt;string&gt;English&lt;/string&gt;</span>
<a href="#l2.10"></a><span id="l2.10"> 	&lt;key&gt;CFBundleExecutable&lt;/key&gt;</span>
<a href="#l2.11"></a><span id="l2.11" class="difflineminus">-	&lt;string&gt;instantbird-bin&lt;/string&gt;</span>
<a href="#l2.12"></a><span id="l2.12" class="difflineplus">+	&lt;string&gt;instantbird&lt;/string&gt;</span>
<a href="#l2.13"></a><span id="l2.13"> 	&lt;key&gt;CFBundleGetInfoString&lt;/key&gt;</span>
<a href="#l2.14"></a><span id="l2.14"> 	&lt;string&gt;%MAC_APP_NAME% %APP_VERSION%, Â© 1998-2013 Contributors&lt;/string&gt;</span>
<a href="#l2.15"></a><span id="l2.15"> 	&lt;key&gt;CFBundleIconFile&lt;/key&gt;</span>
<a href="#l2.16"></a><span id="l2.16"> 	&lt;string&gt;instantbird&lt;/string&gt;</span>
<a href="#l2.17"></a><span id="l2.17"> 	&lt;key&gt;CFBundleIdentifier&lt;/key&gt;</span>
<a href="#l2.18"></a><span id="l2.18"> 	&lt;string&gt;org.instantbird&lt;/string&gt;</span>
<a href="#l2.19"></a><span id="l2.19"> 	&lt;key&gt;CFBundleInfoDictionaryVersion&lt;/key&gt;</span>
<a href="#l2.20"></a><span id="l2.20"> 	&lt;string&gt;6.0&lt;/string&gt;</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l3.1"></a><span id="l3.1" class="difflineminus">--- a/im/app/nsMain.cpp</span>
<a href="#l3.2"></a><span id="l3.2" class="difflineplus">+++ b/im/app/nsMain.cpp</span>
<a href="#l3.3"></a><span id="l3.3" class="difflineat">@@ -1,37 +1,53 @@</span>
<a href="#l3.4"></a><span id="l3.4"> /* -*- Mode: C++; tab-width: 2; indent-tabs-mode: nil; c-basic-offset: 2 -*- */</span>
<a href="#l3.5"></a><span id="l3.5"> /* This Source Code Form is subject to the terms of the Mozilla Public</span>
<a href="#l3.6"></a><span id="l3.6">  * License, v. 2.0. If a copy of the MPL was not distributed with this</span>
<a href="#l3.7"></a><span id="l3.7">  * file, You can obtain one at http://mozilla.org/MPL/2.0/. */</span>
<a href="#l3.8"></a><span id="l3.8"> </span>
<a href="#l3.9"></a><span id="l3.9" class="difflineplus">+#include &quot;nsXPCOMGlue.h&quot;</span>
<a href="#l3.10"></a><span id="l3.10"> #include &quot;nsXULAppAPI.h&quot;</span>
<a href="#l3.11"></a><span id="l3.11" class="difflineminus">-#ifdef XP_WIN</span>
<a href="#l3.12"></a><span id="l3.12" class="difflineplus">+#if defined(XP_WIN)</span>
<a href="#l3.13"></a><span id="l3.13"> #include &lt;windows.h&gt;</span>
<a href="#l3.14"></a><span id="l3.14"> #include &lt;stdlib.h&gt;</span>
<a href="#l3.15"></a><span id="l3.15" class="difflineplus">+#elif defined(XP_UNIX)</span>
<a href="#l3.16"></a><span id="l3.16" class="difflineplus">+#include &lt;sys/time.h&gt;</span>
<a href="#l3.17"></a><span id="l3.17" class="difflineplus">+#include &lt;sys/resource.h&gt;</span>
<a href="#l3.18"></a><span id="l3.18" class="difflineplus">+#endif</span>
<a href="#l3.19"></a><span id="l3.19" class="difflineplus">+</span>
<a href="#l3.20"></a><span id="l3.20" class="difflineplus">+#ifdef XP_MACOSX</span>
<a href="#l3.21"></a><span id="l3.21" class="difflineplus">+#include &quot;MacQuirks.h&quot;</span>
<a href="#l3.22"></a><span id="l3.22"> #endif</span>
<a href="#l3.23"></a><span id="l3.23"> </span>
<a href="#l3.24"></a><span id="l3.24"> #include &lt;stdio.h&gt;</span>
<a href="#l3.25"></a><span id="l3.25"> #include &lt;stdarg.h&gt;</span>
<a href="#l3.26"></a><span id="l3.26"> </span>
<a href="#l3.27"></a><span id="l3.27"> #include &quot;nsCOMPtr.h&quot;</span>
<a href="#l3.28"></a><span id="l3.28"> #include &quot;nsIFile.h&quot;</span>
<a href="#l3.29"></a><span id="l3.29"> #include &quot;nsStringGlue.h&quot;</span>
<a href="#l3.30"></a><span id="l3.30"> </span>
<a href="#l3.31"></a><span id="l3.31"> #ifdef XP_WIN</span>
<a href="#l3.32"></a><span id="l3.32" class="difflineplus">+// we want a wmain entry point</span>
<a href="#l3.33"></a><span id="l3.33"> #include &quot;nsWindowsWMain.cpp&quot;</span>
<a href="#l3.34"></a><span id="l3.34" class="difflineplus">+#define snprintf _snprintf</span>
<a href="#l3.35"></a><span id="l3.35" class="difflineplus">+#define strcasecmp _stricmp</span>
<a href="#l3.36"></a><span id="l3.36"> #endif</span>
<a href="#l3.37"></a><span id="l3.37" class="difflineplus">+#include &quot;BinaryPath.h&quot;</span>
<a href="#l3.38"></a><span id="l3.38" class="difflineplus">+</span>
<a href="#l3.39"></a><span id="l3.39" class="difflineplus">+#include &quot;nsXPCOMPrivate.h&quot; // for MAXPATHLEN and XPCOM_DLL</span>
<a href="#l3.40"></a><span id="l3.40" class="difflineplus">+</span>
<a href="#l3.41"></a><span id="l3.41" class="difflineplus">+#include &quot;mozilla/Telemetry.h&quot;</span>
<a href="#l3.42"></a><span id="l3.42"> </span>
<a href="#l3.43"></a><span id="l3.43"> static void Output(const char *fmt, ... )</span>
<a href="#l3.44"></a><span id="l3.44"> {</span>
<a href="#l3.45"></a><span id="l3.45">   va_list ap;</span>
<a href="#l3.46"></a><span id="l3.46">   va_start(ap, fmt);</span>
<a href="#l3.47"></a><span id="l3.47"> </span>
<a href="#l3.48"></a><span id="l3.48"> #if defined(XP_WIN) &amp;&amp; !MOZ_WINCONSOLE</span>
<a href="#l3.49"></a><span id="l3.49" class="difflineminus">-  PRUnichar msg[2048];</span>
<a href="#l3.50"></a><span id="l3.50" class="difflineplus">+  char16_t msg[2048];</span>
<a href="#l3.51"></a><span id="l3.51">   _vsnwprintf(msg, sizeof(msg)/sizeof(msg[0]), NS_ConvertUTF8toUTF16(fmt).get(), ap);</span>
<a href="#l3.52"></a><span id="l3.52">   MessageBoxW(NULL, msg, L&quot;XULRunner&quot;, MB_OK | MB_ICONERROR);</span>
<a href="#l3.53"></a><span id="l3.53"> #else</span>
<a href="#l3.54"></a><span id="l3.54">   vfprintf(stderr, fmt, ap);</span>
<a href="#l3.55"></a><span id="l3.55"> #endif</span>
<a href="#l3.56"></a><span id="l3.56"> </span>
<a href="#l3.57"></a><span id="l3.57">   va_end(ap);</span>
<a href="#l3.58"></a><span id="l3.58"> }</span>
<a href="#l3.59"></a><span id="l3.59" class="difflineat">@@ -41,31 +57,148 @@ static void Output(const char *fmt, ... </span>
<a href="#l3.60"></a><span id="l3.60">  */</span>
<a href="#l3.61"></a><span id="l3.61"> class ScopedLogging</span>
<a href="#l3.62"></a><span id="l3.62"> {</span>
<a href="#l3.63"></a><span id="l3.63"> public:</span>
<a href="#l3.64"></a><span id="l3.64">   ScopedLogging() { NS_LogInit(); }</span>
<a href="#l3.65"></a><span id="l3.65">   ~ScopedLogging() { NS_LogTerm(); }</span>
<a href="#l3.66"></a><span id="l3.66"> };</span>
<a href="#l3.67"></a><span id="l3.67"> </span>
<a href="#l3.68"></a><span id="l3.68" class="difflineminus">-int main(int argc, char* argv[])</span>
<a href="#l3.69"></a><span id="l3.69" class="difflineminus">-{</span>
<a href="#l3.70"></a><span id="l3.70" class="difflineminus">-  ScopedLogging log;</span>
<a href="#l3.71"></a><span id="l3.71" class="difflineplus">+XRE_GetFileFromPathType XRE_GetFileFromPath;</span>
<a href="#l3.72"></a><span id="l3.72" class="difflineplus">+XRE_CreateAppDataType XRE_CreateAppData;</span>
<a href="#l3.73"></a><span id="l3.73" class="difflineplus">+XRE_FreeAppDataType XRE_FreeAppData;</span>
<a href="#l3.74"></a><span id="l3.74" class="difflineplus">+#ifdef XRE_HAS_DLL_BLOCKLIST</span>
<a href="#l3.75"></a><span id="l3.75" class="difflineplus">+XRE_SetupDllBlocklistType XRE_SetupDllBlocklist;</span>
<a href="#l3.76"></a><span id="l3.76" class="difflineplus">+#endif</span>
<a href="#l3.77"></a><span id="l3.77" class="difflineplus">+XRE_TelemetryAccumulateType XRE_TelemetryAccumulate;</span>
<a href="#l3.78"></a><span id="l3.78" class="difflineplus">+XRE_mainType XRE_main;</span>
<a href="#l3.79"></a><span id="l3.79"> </span>
<a href="#l3.80"></a><span id="l3.80" class="difflineplus">+static const nsDynamicFunctionLoad kXULFuncs[] = {</span>
<a href="#l3.81"></a><span id="l3.81" class="difflineplus">+    { &quot;XRE_GetFileFromPath&quot;, (NSFuncPtr*) &amp;XRE_GetFileFromPath },</span>
<a href="#l3.82"></a><span id="l3.82" class="difflineplus">+    { &quot;XRE_CreateAppData&quot;, (NSFuncPtr*) &amp;XRE_CreateAppData },</span>
<a href="#l3.83"></a><span id="l3.83" class="difflineplus">+    { &quot;XRE_FreeAppData&quot;, (NSFuncPtr*) &amp;XRE_FreeAppData },</span>
<a href="#l3.84"></a><span id="l3.84" class="difflineplus">+#ifdef XRE_HAS_DLL_BLOCKLIST</span>
<a href="#l3.85"></a><span id="l3.85" class="difflineplus">+    { &quot;XRE_SetupDllBlocklist&quot;, (NSFuncPtr*) &amp;XRE_SetupDllBlocklist },</span>
<a href="#l3.86"></a><span id="l3.86" class="difflineplus">+#endif</span>
<a href="#l3.87"></a><span id="l3.87" class="difflineplus">+    { &quot;XRE_TelemetryAccumulate&quot;, (NSFuncPtr*) &amp;XRE_TelemetryAccumulate },</span>
<a href="#l3.88"></a><span id="l3.88" class="difflineplus">+    { &quot;XRE_main&quot;, (NSFuncPtr*) &amp;XRE_main },</span>
<a href="#l3.89"></a><span id="l3.89" class="difflineplus">+    { nullptr, nullptr }</span>
<a href="#l3.90"></a><span id="l3.90" class="difflineplus">+};</span>
<a href="#l3.91"></a><span id="l3.91" class="difflineplus">+</span>
<a href="#l3.92"></a><span id="l3.92" class="difflineplus">+static int do_main(const char *exePath, int argc, char* argv[])</span>
<a href="#l3.93"></a><span id="l3.93" class="difflineplus">+{</span>
<a href="#l3.94"></a><span id="l3.94">   nsCOMPtr&lt;nsIFile&gt; appini;</span>
<a href="#l3.95"></a><span id="l3.95" class="difflineminus">-  nsresult rv = XRE_GetBinaryPath(argv[0], getter_AddRefs(appini));</span>
<a href="#l3.96"></a><span id="l3.96" class="difflineplus">+#ifdef XP_WIN</span>
<a href="#l3.97"></a><span id="l3.97" class="difflineplus">+  // exePath comes from mozilla::BinaryPath::Get, which returns a UTF-8</span>
<a href="#l3.98"></a><span id="l3.98" class="difflineplus">+  // encoded path, so it is safe to convert it</span>
<a href="#l3.99"></a><span id="l3.99" class="difflineplus">+  nsresult rv = NS_NewLocalFile(NS_ConvertUTF8toUTF16(exePath), false,</span>
<a href="#l3.100"></a><span id="l3.100" class="difflineplus">+                                getter_AddRefs(appini));</span>
<a href="#l3.101"></a><span id="l3.101" class="difflineplus">+#else</span>
<a href="#l3.102"></a><span id="l3.102" class="difflineplus">+  nsresult rv = NS_NewNativeLocalFile(nsDependentCString(exePath), false,</span>
<a href="#l3.103"></a><span id="l3.103" class="difflineplus">+                                      getter_AddRefs(appini));</span>
<a href="#l3.104"></a><span id="l3.104" class="difflineplus">+#endif</span>
<a href="#l3.105"></a><span id="l3.105">   if (NS_FAILED(rv)) {</span>
<a href="#l3.106"></a><span id="l3.106" class="difflineminus">-    Output(&quot;Couldn't calculate the application directory.&quot;);</span>
<a href="#l3.107"></a><span id="l3.107">     return 255;</span>
<a href="#l3.108"></a><span id="l3.108">   }</span>
<a href="#l3.109"></a><span id="l3.109" class="difflineminus">-  appini-&gt;SetNativeLeafName(NS_LITERAL_CSTRING(&quot;application.ini&quot;));</span>
<a href="#l3.110"></a><span id="l3.110" class="difflineplus">+</span>
<a href="#l3.111"></a><span id="l3.111" class="difflineplus">+  appini-&gt;AppendNative(NS_LITERAL_CSTRING(&quot;application.ini&quot;));</span>
<a href="#l3.112"></a><span id="l3.112"> </span>
<a href="#l3.113"></a><span id="l3.113">   nsXREAppData *appData;</span>
<a href="#l3.114"></a><span id="l3.114">   rv = XRE_CreateAppData(appini, &amp;appData);</span>
<a href="#l3.115"></a><span id="l3.115">   if (NS_FAILED(rv)) {</span>
<a href="#l3.116"></a><span id="l3.116">     Output(&quot;Couldn't read application.ini&quot;);</span>
<a href="#l3.117"></a><span id="l3.117">     return 255;</span>
<a href="#l3.118"></a><span id="l3.118">   }</span>
<a href="#l3.119"></a><span id="l3.119"> </span>
<a href="#l3.120"></a><span id="l3.120">   int result = XRE_main(argc, argv, appData, 0);</span>
<a href="#l3.121"></a><span id="l3.121">   XRE_FreeAppData(appData);</span>
<a href="#l3.122"></a><span id="l3.122">   return result;</span>
<a href="#l3.123"></a><span id="l3.123"> }</span>
<a href="#l3.124"></a><span id="l3.124" class="difflineplus">+</span>
<a href="#l3.125"></a><span id="l3.125" class="difflineplus">+int main(int argc, char* argv[])</span>
<a href="#l3.126"></a><span id="l3.126" class="difflineplus">+{</span>
<a href="#l3.127"></a><span id="l3.127" class="difflineplus">+  char exePath[MAXPATHLEN];</span>
<a href="#l3.128"></a><span id="l3.128" class="difflineplus">+</span>
<a href="#l3.129"></a><span id="l3.129" class="difflineplus">+#ifdef XP_MACOSX</span>
<a href="#l3.130"></a><span id="l3.130" class="difflineplus">+  TriggerQuirks();</span>
<a href="#l3.131"></a><span id="l3.131" class="difflineplus">+#endif</span>
<a href="#l3.132"></a><span id="l3.132" class="difflineplus">+</span>
<a href="#l3.133"></a><span id="l3.133" class="difflineplus">+  nsresult rv = mozilla::BinaryPath::Get(argv[0], exePath);</span>
<a href="#l3.134"></a><span id="l3.134" class="difflineplus">+  if (NS_FAILED(rv)) {</span>
<a href="#l3.135"></a><span id="l3.135" class="difflineplus">+    Output(&quot;Couldn't calculate the application directory.\n&quot;);</span>
<a href="#l3.136"></a><span id="l3.136" class="difflineplus">+    return 255;</span>
<a href="#l3.137"></a><span id="l3.137" class="difflineplus">+  }</span>
<a href="#l3.138"></a><span id="l3.138" class="difflineplus">+</span>
<a href="#l3.139"></a><span id="l3.139" class="difflineplus">+  char *lastSlash = strrchr(exePath, XPCOM_FILE_PATH_SEPARATOR[0]);</span>
<a href="#l3.140"></a><span id="l3.140" class="difflineplus">+  if (!lastSlash || (size_t(lastSlash - exePath) &gt; MAXPATHLEN - sizeof(XPCOM_DLL) - 1))</span>
<a href="#l3.141"></a><span id="l3.141" class="difflineplus">+    return 255;</span>
<a href="#l3.142"></a><span id="l3.142" class="difflineplus">+</span>
<a href="#l3.143"></a><span id="l3.143" class="difflineplus">+  strcpy(++lastSlash, XPCOM_DLL);</span>
<a href="#l3.144"></a><span id="l3.144" class="difflineplus">+</span>
<a href="#l3.145"></a><span id="l3.145" class="difflineplus">+  int gotCounters;</span>
<a href="#l3.146"></a><span id="l3.146" class="difflineplus">+#if defined(XP_UNIX)</span>
<a href="#l3.147"></a><span id="l3.147" class="difflineplus">+  struct rusage initialRUsage;</span>
<a href="#l3.148"></a><span id="l3.148" class="difflineplus">+  gotCounters = !getrusage(RUSAGE_SELF, &amp;initialRUsage);</span>
<a href="#l3.149"></a><span id="l3.149" class="difflineplus">+#elif defined(XP_WIN)</span>
<a href="#l3.150"></a><span id="l3.150" class="difflineplus">+  // GetProcessIoCounters().ReadOperationCount seems to have little to</span>
<a href="#l3.151"></a><span id="l3.151" class="difflineplus">+  // do with actual read operations. It reports 0 or 1 at this stage</span>
<a href="#l3.152"></a><span id="l3.152" class="difflineplus">+  // in the program. Luckily 1 coincides with when prefetch is</span>
<a href="#l3.153"></a><span id="l3.153" class="difflineplus">+  // enabled. If Windows prefetch didn't happen we can do our own</span>
<a href="#l3.154"></a><span id="l3.154" class="difflineplus">+  // faster dll preloading.</span>
<a href="#l3.155"></a><span id="l3.155" class="difflineplus">+  IO_COUNTERS ioCounters;</span>
<a href="#l3.156"></a><span id="l3.156" class="difflineplus">+  gotCounters = GetProcessIoCounters(GetCurrentProcess(), &amp;ioCounters);</span>
<a href="#l3.157"></a><span id="l3.157" class="difflineplus">+  if (gotCounters &amp;&amp; !ioCounters.ReadOperationCount)</span>
<a href="#l3.158"></a><span id="l3.158" class="difflineplus">+#endif</span>
<a href="#l3.159"></a><span id="l3.159" class="difflineplus">+  {</span>
<a href="#l3.160"></a><span id="l3.160" class="difflineplus">+      XPCOMGlueEnablePreload();</span>
<a href="#l3.161"></a><span id="l3.161" class="difflineplus">+  }</span>
<a href="#l3.162"></a><span id="l3.162" class="difflineplus">+</span>
<a href="#l3.163"></a><span id="l3.163" class="difflineplus">+</span>
<a href="#l3.164"></a><span id="l3.164" class="difflineplus">+  rv = XPCOMGlueStartup(exePath);</span>
<a href="#l3.165"></a><span id="l3.165" class="difflineplus">+  if (NS_FAILED(rv)) {</span>
<a href="#l3.166"></a><span id="l3.166" class="difflineplus">+    Output(&quot;Couldn't load XPCOM.\n&quot;);</span>
<a href="#l3.167"></a><span id="l3.167" class="difflineplus">+    return 255;</span>
<a href="#l3.168"></a><span id="l3.168" class="difflineplus">+  }</span>
<a href="#l3.169"></a><span id="l3.169" class="difflineplus">+  // Reset exePath so that it is the directory name and not the xpcom dll name</span>
<a href="#l3.170"></a><span id="l3.170" class="difflineplus">+  *lastSlash = 0;</span>
<a href="#l3.171"></a><span id="l3.171" class="difflineplus">+</span>
<a href="#l3.172"></a><span id="l3.172" class="difflineplus">+  rv = XPCOMGlueLoadXULFunctions(kXULFuncs);</span>
<a href="#l3.173"></a><span id="l3.173" class="difflineplus">+  if (NS_FAILED(rv)) {</span>
<a href="#l3.174"></a><span id="l3.174" class="difflineplus">+    Output(&quot;Couldn't load XRE functions.\n&quot;);</span>
<a href="#l3.175"></a><span id="l3.175" class="difflineplus">+    return 255;</span>
<a href="#l3.176"></a><span id="l3.176" class="difflineplus">+  }</span>
<a href="#l3.177"></a><span id="l3.177" class="difflineplus">+</span>
<a href="#l3.178"></a><span id="l3.178" class="difflineplus">+#ifdef XRE_HAS_DLL_BLOCKLIST</span>
<a href="#l3.179"></a><span id="l3.179" class="difflineplus">+  XRE_SetupDllBlocklist();</span>
<a href="#l3.180"></a><span id="l3.180" class="difflineplus">+#endif</span>
<a href="#l3.181"></a><span id="l3.181" class="difflineplus">+</span>
<a href="#l3.182"></a><span id="l3.182" class="difflineplus">+  if (gotCounters) {</span>
<a href="#l3.183"></a><span id="l3.183" class="difflineplus">+#if defined(XP_WIN)</span>
<a href="#l3.184"></a><span id="l3.184" class="difflineplus">+    XRE_TelemetryAccumulate(mozilla::Telemetry::EARLY_GLUESTARTUP_READ_OPS,</span>
<a href="#l3.185"></a><span id="l3.185" class="difflineplus">+                            int(ioCounters.ReadOperationCount));</span>
<a href="#l3.186"></a><span id="l3.186" class="difflineplus">+    XRE_TelemetryAccumulate(mozilla::Telemetry::EARLY_GLUESTARTUP_READ_TRANSFER,</span>
<a href="#l3.187"></a><span id="l3.187" class="difflineplus">+                            int(ioCounters.ReadTransferCount / 1024));</span>
<a href="#l3.188"></a><span id="l3.188" class="difflineplus">+    IO_COUNTERS newIoCounters;</span>
<a href="#l3.189"></a><span id="l3.189" class="difflineplus">+    if (GetProcessIoCounters(GetCurrentProcess(), &amp;newIoCounters)) {</span>
<a href="#l3.190"></a><span id="l3.190" class="difflineplus">+      XRE_TelemetryAccumulate(mozilla::Telemetry::GLUESTARTUP_READ_OPS,</span>
<a href="#l3.191"></a><span id="l3.191" class="difflineplus">+                              int(newIoCounters.ReadOperationCount - ioCounters.ReadOperationCount));</span>
<a href="#l3.192"></a><span id="l3.192" class="difflineplus">+      XRE_TelemetryAccumulate(mozilla::Telemetry::GLUESTARTUP_READ_TRANSFER,</span>
<a href="#l3.193"></a><span id="l3.193" class="difflineplus">+                              int((newIoCounters.ReadTransferCount - ioCounters.ReadTransferCount) / 1024));</span>
<a href="#l3.194"></a><span id="l3.194" class="difflineplus">+    }</span>
<a href="#l3.195"></a><span id="l3.195" class="difflineplus">+#elif defined(XP_UNIX)</span>
<a href="#l3.196"></a><span id="l3.196" class="difflineplus">+    XRE_TelemetryAccumulate(mozilla::Telemetry::EARLY_GLUESTARTUP_HARD_FAULTS,</span>
<a href="#l3.197"></a><span id="l3.197" class="difflineplus">+                            int(initialRUsage.ru_majflt));</span>
<a href="#l3.198"></a><span id="l3.198" class="difflineplus">+    struct rusage newRUsage;</span>
<a href="#l3.199"></a><span id="l3.199" class="difflineplus">+    if (!getrusage(RUSAGE_SELF, &amp;newRUsage)) {</span>
<a href="#l3.200"></a><span id="l3.200" class="difflineplus">+      XRE_TelemetryAccumulate(mozilla::Telemetry::GLUESTARTUP_HARD_FAULTS,</span>
<a href="#l3.201"></a><span id="l3.201" class="difflineplus">+                              int(newRUsage.ru_majflt - initialRUsage.ru_majflt));</span>
<a href="#l3.202"></a><span id="l3.202" class="difflineplus">+    }</span>
<a href="#l3.203"></a><span id="l3.203" class="difflineplus">+#endif</span>
<a href="#l3.204"></a><span id="l3.204" class="difflineplus">+  }</span>
<a href="#l3.205"></a><span id="l3.205" class="difflineplus">+</span>
<a href="#l3.206"></a><span id="l3.206" class="difflineplus">+  int result;</span>
<a href="#l3.207"></a><span id="l3.207" class="difflineplus">+  {</span>
<a href="#l3.208"></a><span id="l3.208" class="difflineplus">+    ScopedLogging log;</span>
<a href="#l3.209"></a><span id="l3.209" class="difflineplus">+    result = do_main(exePath, argc, argv);</span>
<a href="#l3.210"></a><span id="l3.210" class="difflineplus">+  }</span>
<a href="#l3.211"></a><span id="l3.211" class="difflineplus">+</span>
<a href="#l3.212"></a><span id="l3.212" class="difflineplus">+  return result;</span>
<a href="#l3.213"></a><span id="l3.213" class="difflineplus">+}</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l4.1"></a><span id="l4.1" class="difflineminus">--- a/im/app/splash.rc</span>
<a href="#l4.2"></a><span id="l4.2" class="difflineplus">+++ b/im/app/splash.rc</span>
<a href="#l4.3"></a><span id="l4.3" class="difflineat">@@ -17,47 +17,10 @@ 1 24 &quot;instantbird.exe.manifest&quot;</span>
<a href="#l4.4"></a><span id="l4.4"> IDI_APPICON  ICON  INSTANTBIRD_ICO</span>
<a href="#l4.5"></a><span id="l4.5"> 2  ICON  &quot;available-16.ico&quot;</span>
<a href="#l4.6"></a><span id="l4.6"> 3  ICON  &quot;away-16.ico&quot;</span>
<a href="#l4.7"></a><span id="l4.7"> 4  ICON  &quot;offline-16.ico&quot;</span>
<a href="#l4.8"></a><span id="l4.8"> IDI_APPLICATION ICON INSTANTBIRD_ICO</span>
<a href="#l4.9"></a><span id="l4.9"> </span>
<a href="#l4.10"></a><span id="l4.10"> STRINGTABLE DISCARDABLE</span>
<a href="#l4.11"></a><span id="l4.11"> BEGIN</span>
<a href="#l4.12"></a><span id="l4.12" class="difflineminus">-#ifdef DEBUG</span>
<a href="#l4.13"></a><span id="l4.13" class="difflineminus">-    IDS_STARTMENU_APPNAME,              &quot;@MOZ_APP_DISPLAYNAME@ Debug&quot;</span>
<a href="#l4.14"></a><span id="l4.14" class="difflineminus">-#else</span>
<a href="#l4.15"></a><span id="l4.15">     IDS_STARTMENU_APPNAME,              &quot;@MOZ_APP_DISPLAYNAME@&quot;</span>
<a href="#l4.16"></a><span id="l4.16" class="difflineminus">-#endif</span>
<a href="#l4.17"></a><span id="l4.17"> END</span>
<a href="#l4.18"></a><span id="l4.18" class="difflineminus">-</span>
<a href="#l4.19"></a><span id="l4.19" class="difflineminus">-#ifdef MOZ_STATIC_BUILD</span>
<a href="#l4.20"></a><span id="l4.20" class="difflineminus">-</span>
<a href="#l4.21"></a><span id="l4.21" class="difflineminus">-// XXX This code is copied from resource.h and widget.rc.  It's a work-around</span>
<a href="#l4.22"></a><span id="l4.22" class="difflineminus">-// for the limitation that only one resource file can be used in an .exe.  We</span>
<a href="#l4.23"></a><span id="l4.23" class="difflineminus">-// should develop a method, for static builds only, to combine multiple .rc</span>
<a href="#l4.24"></a><span id="l4.24" class="difflineminus">-// files into a single .rc file, and then use that to build the single .res</span>
<a href="#l4.25"></a><span id="l4.25" class="difflineminus">-// file for the .exe.</span>
<a href="#l4.26"></a><span id="l4.26" class="difflineminus">-</span>
<a href="#l4.27"></a><span id="l4.27" class="difflineminus">-#define IDC_GRAB                        4101</span>
<a href="#l4.28"></a><span id="l4.28" class="difflineminus">-#define IDC_GRABBING                    4102</span>
<a href="#l4.29"></a><span id="l4.29" class="difflineminus">-#define IDC_CELL                        4103</span>
<a href="#l4.30"></a><span id="l4.30" class="difflineminus">-#define IDC_COPY                        4104</span>
<a href="#l4.31"></a><span id="l4.31" class="difflineminus">-#define IDC_ALIAS                       4105</span>
<a href="#l4.32"></a><span id="l4.32" class="difflineminus">-#define IDC_ZOOMIN                      4106</span>
<a href="#l4.33"></a><span id="l4.33" class="difflineminus">-#define IDC_ZOOMOUT                     4107</span>
<a href="#l4.34"></a><span id="l4.34" class="difflineminus">-#define IDC_COLRESIZE                   4108</span>
<a href="#l4.35"></a><span id="l4.35" class="difflineminus">-#define IDC_ROWRESIZE                   4109</span>
<a href="#l4.36"></a><span id="l4.36" class="difflineminus">-#define IDC_VERTICALTEXT                4110</span>
<a href="#l4.37"></a><span id="l4.37" class="difflineminus">-#define IDC_NONE                        4112</span>
<a href="#l4.38"></a><span id="l4.38" class="difflineminus">-</span>
<a href="#l4.39"></a><span id="l4.39" class="difflineminus">-IDC_GRAB                CURSOR  DISCARDABLE     &quot;../../mozilla/widget/src/build/res/grab.cur&quot;</span>
<a href="#l4.40"></a><span id="l4.40" class="difflineminus">-IDC_GRABBING            CURSOR  DISCARDABLE     &quot;../../mozilla/widget/src/build/res/grabbing.cur&quot;</span>
<a href="#l4.41"></a><span id="l4.41" class="difflineminus">-IDC_CELL                CURSOR  DISCARDABLE     &quot;../../mozilla/widget/src/build/res/cell.cur&quot;</span>
<a href="#l4.42"></a><span id="l4.42" class="difflineminus">-IDC_COPY                CURSOR  DISCARDABLE     &quot;../../mozilla/widget/src/build/res/copy.cur&quot;</span>
<a href="#l4.43"></a><span id="l4.43" class="difflineminus">-IDC_ALIAS               CURSOR  DISCARDABLE     &quot;../../mozilla/widget/src/build/res/aliasb.cur&quot;</span>
<a href="#l4.44"></a><span id="l4.44" class="difflineminus">-IDC_ZOOMIN              CURSOR  DISCARDABLE     &quot;../../mozilla/widget/src/build/res/zoom_in.cur&quot;</span>
<a href="#l4.45"></a><span id="l4.45" class="difflineminus">-IDC_ZOOMOUT             CURSOR  DISCARDABLE     &quot;../../mozilla/widget/src/build/res/zoom_out.cur&quot;</span>
<a href="#l4.46"></a><span id="l4.46" class="difflineminus">-IDC_COLRESIZE           CURSOR  DISCARDABLE     &quot;../../mozilla/widget/src/build/res/col_resize.cur&quot;</span>
<a href="#l4.47"></a><span id="l4.47" class="difflineminus">-IDC_ROWRESIZE           CURSOR  DISCARDABLE     &quot;../../mozilla/widget/src/build/res/row_resize.cur&quot;</span>
<a href="#l4.48"></a><span id="l4.48" class="difflineminus">-IDC_VERTICALTEXT        CURSOR  DISCARDABLE     &quot;../../mozilla/widget/src/build/res/vertical_text.cur&quot;</span>
<a href="#l4.49"></a><span id="l4.49" class="difflineminus">-IDC_NONE                CURSOR  DISCARDABLE     &quot;../../mozilla/widget/src/build/res/none.cur&quot;</span>
<a href="#l4.50"></a><span id="l4.50" class="difflineminus">-#endif</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l5.1"></a><span id="l5.1" class="difflineminus">--- a/im/components/mintrayr/trayToolkit.cpp</span>
<a href="#l5.2"></a><span id="l5.2" class="difflineplus">+++ b/im/components/mintrayr/trayToolkit.cpp</span>
<a href="#l5.3"></a><span id="l5.3" class="difflineat">@@ -419,17 +419,17 @@ void TrayServiceImpl::UnwatchAll() {</span>
<a href="#l5.4"></a><span id="l5.4">   mWatches.Clear();</span>
<a href="#l5.5"></a><span id="l5.5"> }</span>
<a href="#l5.6"></a><span id="l5.6"> </span>
<a href="#l5.7"></a><span id="l5.7"> void TrayServiceImpl::CloseIcon(trayITrayIcon *aIcon)</span>
<a href="#l5.8"></a><span id="l5.8"> {</span>
<a href="#l5.9"></a><span id="l5.9">   mIcons.RemoveObject(aIcon);</span>
<a href="#l5.10"></a><span id="l5.10"> }</span>
<a href="#l5.11"></a><span id="l5.11"> </span>
<a href="#l5.12"></a><span id="l5.12" class="difflineminus">-NS_IMETHODIMP TrayServiceImpl::Observe(nsISupports *, const char *aTopic, const PRUnichar *)</span>
<a href="#l5.13"></a><span id="l5.13" class="difflineplus">+NS_IMETHODIMP TrayServiceImpl::Observe(nsISupports *, const char *aTopic, const char16_t *)</span>
<a href="#l5.14"></a><span id="l5.14"> {</span>
<a href="#l5.15"></a><span id="l5.15">   if (strcasecmp(aTopic, &quot;xpcom-shutdown&quot;) == 0) {</span>
<a href="#l5.16"></a><span id="l5.16">     Destroy();</span>
<a href="#l5.17"></a><span id="l5.17"> </span>
<a href="#l5.18"></a><span id="l5.18">     nsresult rv;</span>
<a href="#l5.19"></a><span id="l5.19">     nsCOMPtr&lt;nsIObserverService&gt; obs(do_GetService(&quot;@mozilla.org/observer-service;1&quot;, &amp;rv));</span>
<a href="#l5.20"></a><span id="l5.20">     if (NS_SUCCEEDED(rv)) {</span>
<a href="#l5.21"></a><span id="l5.21">       obs-&gt;RemoveObserver(static_cast&lt;nsIObserver*&gt;(this), &quot;xpcom-shutdown&quot;);</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l6.1"></a><span id="l6.1" class="difflineminus">--- a/im/installer/package-manifest.in</span>
<a href="#l6.2"></a><span id="l6.2" class="difflineplus">+++ b/im/installer/package-manifest.in</span>
<a href="#l6.3"></a><span id="l6.3" class="difflineat">@@ -103,20 +103,18 @@</span>
<a href="#l6.4"></a><span id="l6.4"> ; Modules</span>
<a href="#l6.5"></a><span id="l6.5"> @BINPATH@/modules/*</span>
<a href="#l6.6"></a><span id="l6.6"> </span>
<a href="#l6.7"></a><span id="l6.7"> [instantbird]</span>
<a href="#l6.8"></a><span id="l6.8"> #ifndef XP_UNIX</span>
<a href="#l6.9"></a><span id="l6.9"> @BINPATH@/@MOZ_APP_NAME@.exe</span>
<a href="#l6.10"></a><span id="l6.10"> #else</span>
<a href="#l6.11"></a><span id="l6.11"> @BINPATH@/@MOZ_APP_NAME@-bin</span>
<a href="#l6.12"></a><span id="l6.12" class="difflineminus">-#ifndef XP_MACOSX</span>
<a href="#l6.13"></a><span id="l6.13"> @BINPATH@/@MOZ_APP_NAME@</span>
<a href="#l6.14"></a><span id="l6.14"> #endif</span>
<a href="#l6.15"></a><span id="l6.15" class="difflineminus">-#endif</span>
<a href="#l6.16"></a><span id="l6.16"> @BINPATH@/application.ini</span>
<a href="#l6.17"></a><span id="l6.17"> @BINPATH@/platform.ini</span>
<a href="#l6.18"></a><span id="l6.18"> #ifdef XP_OS2</span>
<a href="#l6.19"></a><span id="l6.19"> @BINPATH@/@DLL_PREFIX@mozsqlt3@DLL_SUFFIX@</span>
<a href="#l6.20"></a><span id="l6.20"> #else</span>
<a href="#l6.21"></a><span id="l6.21"> #ifndef MOZ_NATIVE_SQLITE</span>
<a href="#l6.22"></a><span id="l6.22"> @BINPATH@/@DLL_PREFIX@mozsqlite3@DLL_SUFFIX@</span>
<a href="#l6.23"></a><span id="l6.23"> #endif</span></pre></div></div>

<div class="page_footer">
<div class="page_footer_text">comm-central</div>
<div class="page_footer_text" style="padding-left: 10px">Deployed from <a href="https://hg.mozilla.org/hgcustom/version-control-tools/rev/35f393d6769a">35f393d6769a</a> at 2020-07-16T17:23:43Z.</div>
<div class="rss_logo">
<a href="/comm-central/rss-log">RSS</a>
<a href="/comm-central/atom-log">Atom</a>
</div>
<br />

</div>
</body>
</html>

