<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en-US" lang="en-US">
<head>
<link rel="icon" href="/static/4b0de666d1a4/hgicon.png" type="image/png" />
<meta name="robots" content="index, nofollow"/>
<link rel="stylesheet" href="/static/4b0de666d1a4/style-gitweb.css" type="text/css" />

<style type="text/css">
div.feed {
  float: right;
}
a img {
  border-width: 0px;
}
div.log_link {
  width: 80px;
  background-color: white;
}

div.log_body {
  padding-left: 96px;
}
</style>
<script type="text/javascript" src="/static/4b0de666d1a4/mercurial.js"></script>

<meta property="og:image" content="/static/4b0de666d1a4/moz-logo-bw-rgb.svg"/>
<meta property="og:type" content="website"/>

<title>comm-central: changeset 28648:fa0098e6b23f110a2d74b93745321ebcbeb85fbc</title>
<link rel="alternate" type="application/atom+xml"
   href="/comm-central/atom-log" title="Atom feed for comm-central"/>
<link rel="alternate" type="application/rss+xml"
   href="/comm-central/rss-log" title="RSS feed for comm-central"/>

<meta property="og:title" content="comm-central @ fa0098e6b23f110a2d74b93745321ebcbeb85fbc" />
<meta property="og:url" content="/comm-central/rev/fa0098e6b23f110a2d74b93745321ebcbeb85fbc" />
<meta property="og:description" content="Bug 1600955 - Port |Bug 501426 - make the open tabs in background pref be named mail.tabs.loadInBackground and allow overriding default for context/middle click with the shift key| to SeaMonkey. r=frg" />

</head>
<body>

<div class="page_header">
<div class="logo">
    <a href="https://developer.mozilla.org/en/docs/Mercurial">
        <img src="/static/4b0de666d1a4/moz-logo-bw-rgb.svg" alt="mercurial" />
    </a>
</div>
<a href="/">Mercurial</a> &gt; <a href="/comm-central">comm-central</a>  / changeset / fa0098e6b23f110a2d74b93745321ebcbeb85fbc 
</div>

<div class="page_nav">
<div>
<a href="/comm-central/summary">summary</a> |
<a href="/comm-central/shortlog/fa0098e6b23f110a2d74b93745321ebcbeb85fbc">shortlog</a> |
<a href="/comm-central/log/fa0098e6b23f110a2d74b93745321ebcbeb85fbc">changelog</a> |
<a href="/comm-central/pushloghtml">pushlog</a> |
<a href="/comm-central/graph/fa0098e6b23f110a2d74b93745321ebcbeb85fbc">graph</a> |
<a href="/comm-central/tags">tags</a> |
<a href="/comm-central/bookmarks">bookmarks</a> |
<a href="/comm-central/branches">branches</a> |
<a href="/comm-central/file/fa0098e6b23f110a2d74b93745321ebcbeb85fbc">files</a> |
changeset |
<a href="/comm-central/raw-rev/fa0098e6b23f110a2d74b93745321ebcbeb85fbc">raw</a>  | <a href="/comm-central/archive/fa0098e6b23f110a2d74b93745321ebcbeb85fbc.zip">zip</a>  |
<a href="/comm-central/help">help</a>
</div>

<div class="search">
<form id="searchform" action="/comm-central/log">

<input name="rev" type="text" value="" size="40" />
<div id="hint">Find changesets by keywords (author, files, the commit message), revision
number or hash, or <a href="/comm-central/help/revsets">revset expression</a>.</div>
</form>
</div>
</div>

<div class="title">
<a href="https://bugzilla.mozilla.org/show_bug.cgi?id=1600955">Bug 1600955</a> - Port |<a href="https://bugzilla.mozilla.org/show_bug.cgi?id=501426">Bug 501426</a> - make the open tabs in background pref be named mail.tabs.loadInBackground and allow overriding default for context/middle click with the shift key| to SeaMonkey. r=frg
<span class="logtags"></span>
</div>
<div class="title_text">
<table cellspacing="0">

<tr><td>author</td><td>&#73;&#97;&#110;&#32;&#78;&#101;&#97;&#108;&#32;&#60;&#105;&#97;&#110;&#110;&#95;&#99;&#118;&#115;&#64;&#98;&#108;&#117;&#101;&#121;&#111;&#110;&#100;&#101;&#114;&#46;&#99;&#111;&#46;&#117;&#107;&#62;</td></tr>
<tr><td></td><td class="date age">Sun, 05 Jan 2020 22:09:13 +0100</td></tr>

<tr>
 <td>changeset 28648</td>
 <td style="font-family:monospace"><a class="list" href="/comm-central/rev/fa0098e6b23f110a2d74b93745321ebcbeb85fbc">fa0098e6b23f110a2d74b93745321ebcbeb85fbc</a></td>
</tr>



<tr>
<td>parent 28647</td>
<td style="font-family:monospace">
<a class="list" href="/comm-central/rev/e5e31792c53c86ffaea936104d37438bdf28d579">e5e31792c53c86ffaea936104d37438bdf28d579</a>
</td>
</tr>

<tr>
<td>child 28649</td>
<td style="font-family:monospace">
<a class="list" href="/comm-central/rev/d56158f2a5925c00acbb3b0e84ec71b6747c9392">d56158f2a5925c00acbb3b0e84ec71b6747c9392</a>
</td>
</tr>
<tr><td>push id</td><td><a href="/comm-central/pushloghtml?changeset=fa0098e6b23f110a2d74b93745321ebcbeb85fbc">16984</a></td></tr>
<tr><td>push user</td><td>frgrahl@gmx.net</td></tr>
<tr><td>push date</td><td class="date age">Thu, 06 Feb 2020 01:45:44 +0000</td></tr>

<tr><td>treeherder</td><td>comm-central@63582aa9fdbe [<a href="https://treeherder.mozilla.org/#/jobs?repo=comm-central&revision=63582aa9fdbe7ee78c41b24986516152591d27c4">default view</a>] [<a href="https://treeherder.mozilla.org/#/jobs?repo=comm-central&revision=63582aa9fdbe7ee78c41b24986516152591d27c4&filter-resultStatus=testfailed&filter-resultStatus=busted&filter-resultStatus=exception">failures only]</td></tr>
<tr><td>perfherder</td><td>[<a href="https://treeherder.mozilla.org/perf.html#/compare?originalProject=comm-central&originalRevision=63582aa9fdbe7ee78c41b24986516152591d27c4&newProject=comm-central&newRevision=fa0098e6b23f110a2d74b93745321ebcbeb85fbc&framework=1" target="_blank">talos</a>] [<a href="https://treeherder.mozilla.org/perf.html#/compare?originalProject=comm-central&originalRevision=63582aa9fdbe7ee78c41b24986516152591d27c4&newProject=comm-central&newRevision=fa0098e6b23f110a2d74b93745321ebcbeb85fbc&framework=2" target="_blank">build metrics</a>] [<a href="https://treeherder.mozilla.org/perf.html#/compare?originalProject=comm-central&originalRevision=63582aa9fdbe7ee78c41b24986516152591d27c4&newProject=comm-central&newRevision=fa0098e6b23f110a2d74b93745321ebcbeb85fbc&framework=6" target="_blank">platform microbench</a>] (compared to previous push)</td></tr>
<tr><td>reviewers</td><td><a href="/comm-central/log?rev=reviewer%28frg%29&revcount=50">frg</a></td></tr>
<tr><td>bugs</td><td><a href="https://bugzilla.mozilla.org/show_bug.cgi?id=1600955">1600955</a>, <a href="https://bugzilla.mozilla.org/show_bug.cgi?id=501426">501426</a></td></tr>




</table></div>

<div class="page_body description"><a href="https://bugzilla.mozilla.org/show_bug.cgi?id=1600955">Bug 1600955</a> - Port |<a href="https://bugzilla.mozilla.org/show_bug.cgi?id=501426">Bug 501426</a> - make the open tabs in background pref be named mail.tabs.loadInBackground and allow overriding default for context/middle click with the shift key| to SeaMonkey. r=frg</div>
<div class="list_head"></div>
<div class="title_text">
<table cellspacing="0">

<tr class="parity0">
<td><a class="list" href="/comm-central/diff/fa0098e6b23f110a2d74b93745321ebcbeb85fbc/suite/app/profile/suite-prefs.js">suite/app/profile/suite-prefs.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/fa0098e6b23f110a2d74b93745321ebcbeb85fbc/suite/app/profile/suite-prefs.js">file</a> |
<a href="/comm-central/annotate/fa0098e6b23f110a2d74b93745321ebcbeb85fbc/suite/app/profile/suite-prefs.js">annotate</a> |
<a href="/comm-central/diff/fa0098e6b23f110a2d74b93745321ebcbeb85fbc/suite/app/profile/suite-prefs.js">diff</a> |
<a href="/comm-central/comparison/fa0098e6b23f110a2d74b93745321ebcbeb85fbc/suite/app/profile/suite-prefs.js">comparison</a> |
<a href="/comm-central/log/fa0098e6b23f110a2d74b93745321ebcbeb85fbc/suite/app/profile/suite-prefs.js">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/fa0098e6b23f110a2d74b93745321ebcbeb85fbc/suite/locales/en-US/chrome/common/help/mailnews_preferences.xhtml">suite/locales/en-US/chrome/common/help/mailnews_preferences.xhtml</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/fa0098e6b23f110a2d74b93745321ebcbeb85fbc/suite/locales/en-US/chrome/common/help/mailnews_preferences.xhtml">file</a> |
<a href="/comm-central/annotate/fa0098e6b23f110a2d74b93745321ebcbeb85fbc/suite/locales/en-US/chrome/common/help/mailnews_preferences.xhtml">annotate</a> |
<a href="/comm-central/diff/fa0098e6b23f110a2d74b93745321ebcbeb85fbc/suite/locales/en-US/chrome/common/help/mailnews_preferences.xhtml">diff</a> |
<a href="/comm-central/comparison/fa0098e6b23f110a2d74b93745321ebcbeb85fbc/suite/locales/en-US/chrome/common/help/mailnews_preferences.xhtml">comparison</a> |
<a href="/comm-central/log/fa0098e6b23f110a2d74b93745321ebcbeb85fbc/suite/locales/en-US/chrome/common/help/mailnews_preferences.xhtml">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/fa0098e6b23f110a2d74b93745321ebcbeb85fbc/suite/locales/en-US/chrome/mailnews/pref/pref-mailnews.dtd">suite/locales/en-US/chrome/mailnews/pref/pref-mailnews.dtd</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/fa0098e6b23f110a2d74b93745321ebcbeb85fbc/suite/locales/en-US/chrome/mailnews/pref/pref-mailnews.dtd">file</a> |
<a href="/comm-central/annotate/fa0098e6b23f110a2d74b93745321ebcbeb85fbc/suite/locales/en-US/chrome/mailnews/pref/pref-mailnews.dtd">annotate</a> |
<a href="/comm-central/diff/fa0098e6b23f110a2d74b93745321ebcbeb85fbc/suite/locales/en-US/chrome/mailnews/pref/pref-mailnews.dtd">diff</a> |
<a href="/comm-central/comparison/fa0098e6b23f110a2d74b93745321ebcbeb85fbc/suite/locales/en-US/chrome/mailnews/pref/pref-mailnews.dtd">comparison</a> |
<a href="/comm-central/log/fa0098e6b23f110a2d74b93745321ebcbeb85fbc/suite/locales/en-US/chrome/mailnews/pref/pref-mailnews.dtd">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/fa0098e6b23f110a2d74b93745321ebcbeb85fbc/suite/mailnews/components/prefs/content/pref-mailnews.xul">suite/mailnews/components/prefs/content/pref-mailnews.xul</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/fa0098e6b23f110a2d74b93745321ebcbeb85fbc/suite/mailnews/components/prefs/content/pref-mailnews.xul">file</a> |
<a href="/comm-central/annotate/fa0098e6b23f110a2d74b93745321ebcbeb85fbc/suite/mailnews/components/prefs/content/pref-mailnews.xul">annotate</a> |
<a href="/comm-central/diff/fa0098e6b23f110a2d74b93745321ebcbeb85fbc/suite/mailnews/components/prefs/content/pref-mailnews.xul">diff</a> |
<a href="/comm-central/comparison/fa0098e6b23f110a2d74b93745321ebcbeb85fbc/suite/mailnews/components/prefs/content/pref-mailnews.xul">comparison</a> |
<a href="/comm-central/log/fa0098e6b23f110a2d74b93745321ebcbeb85fbc/suite/mailnews/components/prefs/content/pref-mailnews.xul">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/fa0098e6b23f110a2d74b93745321ebcbeb85fbc/suite/mailnews/content/mailWindowOverlay.xul">suite/mailnews/content/mailWindowOverlay.xul</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/fa0098e6b23f110a2d74b93745321ebcbeb85fbc/suite/mailnews/content/mailWindowOverlay.xul">file</a> |
<a href="/comm-central/annotate/fa0098e6b23f110a2d74b93745321ebcbeb85fbc/suite/mailnews/content/mailWindowOverlay.xul">annotate</a> |
<a href="/comm-central/diff/fa0098e6b23f110a2d74b93745321ebcbeb85fbc/suite/mailnews/content/mailWindowOverlay.xul">diff</a> |
<a href="/comm-central/comparison/fa0098e6b23f110a2d74b93745321ebcbeb85fbc/suite/mailnews/content/mailWindowOverlay.xul">comparison</a> |
<a href="/comm-central/log/fa0098e6b23f110a2d74b93745321ebcbeb85fbc/suite/mailnews/content/mailWindowOverlay.xul">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/fa0098e6b23f110a2d74b93745321ebcbeb85fbc/suite/mailnews/content/msgMail3PaneWindow.js">suite/mailnews/content/msgMail3PaneWindow.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/fa0098e6b23f110a2d74b93745321ebcbeb85fbc/suite/mailnews/content/msgMail3PaneWindow.js">file</a> |
<a href="/comm-central/annotate/fa0098e6b23f110a2d74b93745321ebcbeb85fbc/suite/mailnews/content/msgMail3PaneWindow.js">annotate</a> |
<a href="/comm-central/diff/fa0098e6b23f110a2d74b93745321ebcbeb85fbc/suite/mailnews/content/msgMail3PaneWindow.js">diff</a> |
<a href="/comm-central/comparison/fa0098e6b23f110a2d74b93745321ebcbeb85fbc/suite/mailnews/content/msgMail3PaneWindow.js">comparison</a> |
<a href="/comm-central/log/fa0098e6b23f110a2d74b93745321ebcbeb85fbc/suite/mailnews/content/msgMail3PaneWindow.js">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/fa0098e6b23f110a2d74b93745321ebcbeb85fbc/suite/mailnews/content/tabmail.js">suite/mailnews/content/tabmail.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/fa0098e6b23f110a2d74b93745321ebcbeb85fbc/suite/mailnews/content/tabmail.js">file</a> |
<a href="/comm-central/annotate/fa0098e6b23f110a2d74b93745321ebcbeb85fbc/suite/mailnews/content/tabmail.js">annotate</a> |
<a href="/comm-central/diff/fa0098e6b23f110a2d74b93745321ebcbeb85fbc/suite/mailnews/content/tabmail.js">diff</a> |
<a href="/comm-central/comparison/fa0098e6b23f110a2d74b93745321ebcbeb85fbc/suite/mailnews/content/tabmail.js">comparison</a> |
<a href="/comm-central/log/fa0098e6b23f110a2d74b93745321ebcbeb85fbc/suite/mailnews/content/tabmail.js">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/fa0098e6b23f110a2d74b93745321ebcbeb85fbc/suite/mailnews/content/tabmail.xml">suite/mailnews/content/tabmail.xml</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/fa0098e6b23f110a2d74b93745321ebcbeb85fbc/suite/mailnews/content/tabmail.xml">file</a> |
<a href="/comm-central/annotate/fa0098e6b23f110a2d74b93745321ebcbeb85fbc/suite/mailnews/content/tabmail.xml">annotate</a> |
<a href="/comm-central/diff/fa0098e6b23f110a2d74b93745321ebcbeb85fbc/suite/mailnews/content/tabmail.xml">diff</a> |
<a href="/comm-central/comparison/fa0098e6b23f110a2d74b93745321ebcbeb85fbc/suite/mailnews/content/tabmail.xml">comparison</a> |
<a href="/comm-central/log/fa0098e6b23f110a2d74b93745321ebcbeb85fbc/suite/mailnews/content/tabmail.xml">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/fa0098e6b23f110a2d74b93745321ebcbeb85fbc/suite/mailnews/content/threadPane.js">suite/mailnews/content/threadPane.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/fa0098e6b23f110a2d74b93745321ebcbeb85fbc/suite/mailnews/content/threadPane.js">file</a> |
<a href="/comm-central/annotate/fa0098e6b23f110a2d74b93745321ebcbeb85fbc/suite/mailnews/content/threadPane.js">annotate</a> |
<a href="/comm-central/diff/fa0098e6b23f110a2d74b93745321ebcbeb85fbc/suite/mailnews/content/threadPane.js">diff</a> |
<a href="/comm-central/comparison/fa0098e6b23f110a2d74b93745321ebcbeb85fbc/suite/mailnews/content/threadPane.js">comparison</a> |
<a href="/comm-central/log/fa0098e6b23f110a2d74b93745321ebcbeb85fbc/suite/mailnews/content/threadPane.js">revisions</a>
</td>
</tr>
</table></div>

<div class="page_body diffblocks"><div class="diffblock"><pre class="sourcelines">
<a href="#l1.1"></a><span id="l1.1" class="difflineminus">--- a/suite/app/profile/suite-prefs.js</span>
<a href="#l1.2"></a><span id="l1.2" class="difflineplus">+++ b/suite/app/profile/suite-prefs.js</span>
<a href="#l1.3"></a><span id="l1.3" class="difflineat">@@ -354,16 +354,20 @@ pref(&quot;network.predictor.enabled&quot;, false)</span>
<a href="#l1.4"></a><span id="l1.4"> // To allow images to be inserted into a composition with an auth prompt, we</span>
<a href="#l1.5"></a><span id="l1.5"> // need the following two.</span>
<a href="#l1.6"></a><span id="l1.6"> pref(&quot;network.auth.subresource-img-cross-origin-http-auth-allow&quot;, true);</span>
<a href="#l1.7"></a><span id="l1.7"> // This pref is also needed for showing the caldav auth prompt.</span>
<a href="#l1.8"></a><span id="l1.8"> pref(&quot;network.auth.non-web-content-triggered-resources-http-auth-allow&quot;, true);</span>
<a href="#l1.9"></a><span id="l1.9"> </span>
<a href="#l1.10"></a><span id="l1.10"> pref(&quot;mail.biff.show_new_alert&quot;,     true);</span>
<a href="#l1.11"></a><span id="l1.11"> </span>
<a href="#l1.12"></a><span id="l1.12" class="difflineplus">+// If messages or folders are opened using the context menu or a middle click,</span>
<a href="#l1.13"></a><span id="l1.13" class="difflineplus">+// should we open them in the foreground or in the background?</span>
<a href="#l1.14"></a><span id="l1.14" class="difflineplus">+pref(&quot;mail.tabs.loadInBackground&quot;, true);</span>
<a href="#l1.15"></a><span id="l1.15" class="difflineplus">+</span>
<a href="#l1.16"></a><span id="l1.16"> pref(&quot;mailnews.ui.deleteMarksRead&quot;, true);</span>
<a href="#l1.17"></a><span id="l1.17"> pref(&quot;mailnews.ui.deleteAlwaysSelectedMessages&quot;, false);</span>
<a href="#l1.18"></a><span id="l1.18"> </span>
<a href="#l1.19"></a><span id="l1.19"> // The maximum amount of decoded image data we'll willingly keep around (we</span>
<a href="#l1.20"></a><span id="l1.20"> // might keep around more than this, but we'll try to get down to this value).</span>
<a href="#l1.21"></a><span id="l1.21"> // (This is intentionally on the high side; see bugs 746055 and 768015.)</span>
<a href="#l1.22"></a><span id="l1.22"> pref(&quot;image.mem.max_decoded_image_kb&quot;, 256000);</span>
<a href="#l1.23"></a><span id="l1.23"> </span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l2.1"></a><span id="l2.1" class="difflineminus">--- a/suite/locales/en-US/chrome/common/help/mailnews_preferences.xhtml</span>
<a href="#l2.2"></a><span id="l2.2" class="difflineplus">+++ b/suite/locales/en-US/chrome/common/help/mailnews_preferences.xhtml</span>
<a href="#l2.3"></a><span id="l2.3" class="difflineat">@@ -70,16 +70,19 @@</span>
<a href="#l2.4"></a><span id="l2.4">     before leaving a folder when you reenter a folder.&lt;/li&gt;</span>
<a href="#l2.5"></a><span id="l2.5">   &lt;li&gt;&lt;strong&gt;Preserve threading when sorting messages&lt;/strong&gt;: Select this</span>
<a href="#l2.6"></a><span id="l2.6">     option if you want &amp;brandShortName; to preserve the threaded message</span>
<a href="#l2.7"></a><span id="l2.7">     grouping</span>
<a href="#l2.8"></a><span id="l2.8">     &lt;a href=&quot;mailnews_using_mail.xhtml#sorting_and_threading_messages&quot;&gt;when</span>
<a href="#l2.9"></a><span id="l2.9">     sorting messages&lt;/a&gt;. If it is not selected, &amp;brandShortName; automatically</span>
<a href="#l2.10"></a><span id="l2.10">     displays the messages unthreaded when you sort them by clicking on the</span>
<a href="#l2.11"></a><span id="l2.11">     column headers.&lt;/li&gt;</span>
<a href="#l2.12"></a><span id="l2.12" class="difflineplus">+  &lt;li&gt;&lt;strong&gt;Switch to new tabs when opened&lt;/strong&gt;: Select this to make</span>
<a href="#l2.13"></a><span id="l2.13" class="difflineplus">+    &amp;brandShortName; switch to the new tab when opened using &lt;q&gt;Open in New</span>
<a href="#l2.14"></a><span id="l2.14" class="difflineplus">+    Tab&lt;/q&gt; or &lt;q&gt;Open Message in New Tab&lt;/q&gt; context menu options.&lt;/li&gt;</span>
<a href="#l2.15"></a><span id="l2.15">   &lt;li&gt;&lt;strong&gt;Only check for new mail after opening Mail &amp;amp;</span>
<a href="#l2.16"></a><span id="l2.16">     Newsgroups&lt;/strong&gt;: By default, &amp;brandShortName; checks for new messages</span>
<a href="#l2.17"></a><span id="l2.17">     even if only a browser window is open. Choose this option if you want to</span>
<a href="#l2.18"></a><span id="l2.18">     delay checking for new messages until after the Mail &amp;amp; Newsgroups window</span>
<a href="#l2.19"></a><span id="l2.19">     has been opened at least once (be it automatically &lt;a</span>
<a href="#l2.20"></a><span id="l2.20">     href=&quot;cs_nav_prefs_appearance.xhtml#appearance&quot;&gt;on startup&lt;/a&gt; or</span>
<a href="#l2.21"></a><span id="l2.21">     manually).&lt;/li&gt;</span>
<a href="#l2.22"></a><span id="l2.22">   &lt;li class=&quot;win&quot;&gt;&lt;strong&gt;Make &amp;brandShortName; the default application</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l3.1"></a><span id="l3.1" class="difflineminus">--- a/suite/locales/en-US/chrome/mailnews/pref/pref-mailnews.dtd</span>
<a href="#l3.2"></a><span id="l3.2" class="difflineplus">+++ b/suite/locales/en-US/chrome/mailnews/pref/pref-mailnews.dtd</span>
<a href="#l3.3"></a><span id="l3.3" class="difflineat">@@ -3,16 +3,18 @@</span>
<a href="#l3.4"></a><span id="l3.4">    - file, You can obtain one at http://mozilla.org/MPL/2.0/. --&gt;</span>
<a href="#l3.5"></a><span id="l3.5"> </span>
<a href="#l3.6"></a><span id="l3.6"> &lt;!ENTITY pref.mailnews.title              &quot;Mail &amp;amp; Newsgroups&quot;&gt;</span>
<a href="#l3.7"></a><span id="l3.7"> &lt;!ENTITY generalSettings.caption          &quot;General Settings&quot;&gt;</span>
<a href="#l3.8"></a><span id="l3.8"> &lt;!ENTITY confirmMove.label                &quot;Confirm when moving folders to the Trash&quot;&gt;</span>
<a href="#l3.9"></a><span id="l3.9"> &lt;!ENTITY confirmMove.accesskey            &quot;C&quot;&gt;</span>
<a href="#l3.10"></a><span id="l3.10"> &lt;!ENTITY preserveThreading.label          &quot;Preserve threading when sorting messages&quot;&gt;</span>
<a href="#l3.11"></a><span id="l3.11"> &lt;!ENTITY preserveThreading.accesskey      &quot;v&quot;&gt;</span>
<a href="#l3.12"></a><span id="l3.12" class="difflineplus">+&lt;!ENTITY loadInBackground.label           &quot;Switch to new tabs when opened&quot;&gt;</span>
<a href="#l3.13"></a><span id="l3.13" class="difflineplus">+&lt;!ENTITY loadInBackground.accesskey       &quot;t&quot;&gt;</span>
<a href="#l3.14"></a><span id="l3.14"> &lt;!ENTITY mailBiffOnNewWindow.label        &quot;Only check for new mail after opening Mail &amp;amp; Newsgroups&quot;&gt;</span>
<a href="#l3.15"></a><span id="l3.15"> &lt;!ENTITY mailBiffOnNewWindow.accesskey    &quot;O&quot;&gt;</span>
<a href="#l3.16"></a><span id="l3.16"> </span>
<a href="#l3.17"></a><span id="l3.17"> &lt;!ENTITY defaultMailSettings.description  &quot;Make &amp;brandShortName; the default application for:&quot;&gt;</span>
<a href="#l3.18"></a><span id="l3.18"> &lt;!ENTITY setDefaultMail.label             &quot;Mail&quot;&gt;</span>
<a href="#l3.19"></a><span id="l3.19"> &lt;!ENTITY setDefaultMail.accesskey         &quot;M&quot;&gt;</span>
<a href="#l3.20"></a><span id="l3.20"> &lt;!ENTITY setDefaultNews.label             &quot;News&quot;&gt;</span>
<a href="#l3.21"></a><span id="l3.21"> &lt;!ENTITY setDefaultNews.accesskey         &quot;N&quot;&gt;</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l4.1"></a><span id="l4.1" class="difflineminus">--- a/suite/mailnews/components/prefs/content/pref-mailnews.xul</span>
<a href="#l4.2"></a><span id="l4.2" class="difflineplus">+++ b/suite/mailnews/components/prefs/content/pref-mailnews.xul</span>
<a href="#l4.3"></a><span id="l4.3" class="difflineat">@@ -22,16 +22,19 @@</span>
<a href="#l4.4"></a><span id="l4.4">     &lt;preferences id=&quot;mailnews_preferences&quot;&gt;</span>
<a href="#l4.5"></a><span id="l4.5">       &lt;preference id=&quot;mailnews.confirm.moveFoldersToTrash&quot;</span>
<a href="#l4.6"></a><span id="l4.6">                   name=&quot;mailnews.confirm.moveFoldersToTrash&quot; type=&quot;bool&quot;/&gt;</span>
<a href="#l4.7"></a><span id="l4.7">       &lt;preference id=&quot;mailnews.remember_selected_message&quot;</span>
<a href="#l4.8"></a><span id="l4.8">                   name=&quot;mailnews.remember_selected_message&quot; type=&quot;bool&quot;/&gt;</span>
<a href="#l4.9"></a><span id="l4.9">       &lt;preference id=&quot;mailnews.thread_pane_column_unthreads&quot;</span>
<a href="#l4.10"></a><span id="l4.10">                   name=&quot;mailnews.thread_pane_column_unthreads&quot;</span>
<a href="#l4.11"></a><span id="l4.11">                   inverted=&quot;true&quot; type=&quot;bool&quot;/&gt;</span>
<a href="#l4.12"></a><span id="l4.12" class="difflineplus">+      &lt;preference id=&quot;mail.tabs.loadInBackground&quot;</span>
<a href="#l4.13"></a><span id="l4.13" class="difflineplus">+                  name=&quot;mail.tabs.loadInBackground&quot;</span>
<a href="#l4.14"></a><span id="l4.14" class="difflineplus">+                  inverted=&quot;true&quot; type=&quot;bool&quot;/&gt;</span>
<a href="#l4.15"></a><span id="l4.15">       &lt;preference id=&quot;mailnews.start_page.enabled&quot;</span>
<a href="#l4.16"></a><span id="l4.16">                   onchange=&quot;this.parentNode.parentNode.startPageCheck();&quot;</span>
<a href="#l4.17"></a><span id="l4.17">                   name=&quot;mailnews.start_page.enabled&quot; type=&quot;bool&quot;/&gt;</span>
<a href="#l4.18"></a><span id="l4.18">       &lt;preference id=&quot;mailnews.start_page.url&quot;</span>
<a href="#l4.19"></a><span id="l4.19">                   name=&quot;mailnews.start_page.url&quot; type=&quot;wstring&quot;/&gt;</span>
<a href="#l4.20"></a><span id="l4.20">       &lt;preference id=&quot;mail.biff.on_new_window&quot;</span>
<a href="#l4.21"></a><span id="l4.21">                   name=&quot;mail.biff.on_new_window&quot; inverted=&quot;true&quot; type=&quot;bool&quot;/&gt;</span>
<a href="#l4.22"></a><span id="l4.22">       &lt;preference id=&quot;network.protocol-handler.external.mailto&quot;</span>
<a href="#l4.23"></a><span id="l4.23" class="difflineat">@@ -72,16 +75,23 @@</span>
<a href="#l4.24"></a><span id="l4.24">       &lt;hbox align=&quot;center&quot;&gt;</span>
<a href="#l4.25"></a><span id="l4.25">         &lt;checkbox id=&quot;mailPreserveThreading&quot;</span>
<a href="#l4.26"></a><span id="l4.26">                   label=&quot;&amp;preserveThreading.label;&quot;</span>
<a href="#l4.27"></a><span id="l4.27">                   accesskey=&quot;&amp;preserveThreading.accesskey;&quot;</span>
<a href="#l4.28"></a><span id="l4.28">                   preference=&quot;mailnews.thread_pane_column_unthreads&quot;/&gt;</span>
<a href="#l4.29"></a><span id="l4.29">       &lt;/hbox&gt;</span>
<a href="#l4.30"></a><span id="l4.30"> </span>
<a href="#l4.31"></a><span id="l4.31">       &lt;hbox align=&quot;center&quot;&gt;</span>
<a href="#l4.32"></a><span id="l4.32" class="difflineplus">+        &lt;checkbox id=&quot;loadInBackground&quot;</span>
<a href="#l4.33"></a><span id="l4.33" class="difflineplus">+                  label=&quot;&amp;loadInBackground.label;&quot;</span>
<a href="#l4.34"></a><span id="l4.34" class="difflineplus">+                  accesskey=&quot;&amp;loadInBackground.accesskey;&quot;</span>
<a href="#l4.35"></a><span id="l4.35" class="difflineplus">+                  preference=&quot;mail.tabs.loadInBackground&quot;/&gt;</span>
<a href="#l4.36"></a><span id="l4.36" class="difflineplus">+      &lt;/hbox&gt;</span>
<a href="#l4.37"></a><span id="l4.37" class="difflineplus">+</span>
<a href="#l4.38"></a><span id="l4.38" class="difflineplus">+      &lt;hbox align=&quot;center&quot;&gt;</span>
<a href="#l4.39"></a><span id="l4.39">         &lt;checkbox id=&quot;mailBiffOnNewWindow&quot;</span>
<a href="#l4.40"></a><span id="l4.40">                   label=&quot;&amp;mailBiffOnNewWindow.label;&quot;</span>
<a href="#l4.41"></a><span id="l4.41">                   accesskey=&quot;&amp;mailBiffOnNewWindow.accesskey;&quot;</span>
<a href="#l4.42"></a><span id="l4.42">                   preference=&quot;mail.biff.on_new_window&quot;/&gt;</span>
<a href="#l4.43"></a><span id="l4.43">       &lt;/hbox&gt;</span>
<a href="#l4.44"></a><span id="l4.44"> </span>
<a href="#l4.45"></a><span id="l4.45">       &lt;vbox id=&quot;defaultMailPrefs&quot; hidden=&quot;true&quot;&gt;</span>
<a href="#l4.46"></a><span id="l4.46">         &lt;separator class=&quot;thin&quot;/&gt;</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l5.1"></a><span id="l5.1" class="difflineminus">--- a/suite/mailnews/content/mailWindowOverlay.xul</span>
<a href="#l5.2"></a><span id="l5.2" class="difflineplus">+++ b/suite/mailnews/content/mailWindowOverlay.xul</span>
<a href="#l5.3"></a><span id="l5.3" class="difflineat">@@ -397,17 +397,17 @@</span>
<a href="#l5.4"></a><span id="l5.4">          onpopuphiding=&quot;if (event.target == this) FolderPaneOnPopupHiding();&quot;&gt;</span>
<a href="#l5.5"></a><span id="l5.5">     &lt;menuitem id=&quot;folderPaneContext-getMessages&quot;</span>
<a href="#l5.6"></a><span id="l5.6">               label=&quot;&amp;folderContextGetMessages.label;&quot;</span>
<a href="#l5.7"></a><span id="l5.7">               accesskey=&quot;&amp;folderContextGetMessages.accesskey;&quot;</span>
<a href="#l5.8"></a><span id="l5.8">               oncommand=&quot;MsgGetMessage();&quot;/&gt;</span>
<a href="#l5.9"></a><span id="l5.9">     &lt;menuitem id=&quot;folderPaneContext-openNewTab&quot;</span>
<a href="#l5.10"></a><span id="l5.10">               label=&quot;&amp;folderContextOpenNewTab.label;&quot;</span>
<a href="#l5.11"></a><span id="l5.11">               accesskey=&quot;&amp;folderContextOpenNewTab.accesskey;&quot;</span>
<a href="#l5.12"></a><span id="l5.12" class="difflineminus">-              oncommand=&quot;MsgOpenNewTabForFolder();&quot;/&gt;</span>
<a href="#l5.13"></a><span id="l5.13" class="difflineplus">+              oncommand=&quot;FolderPaneContextMenuNewTab(event);&quot;/&gt;</span>
<a href="#l5.14"></a><span id="l5.14">     &lt;menuitem id=&quot;folderPaneContext-openNewWindow&quot;</span>
<a href="#l5.15"></a><span id="l5.15">               label=&quot;&amp;folderContextOpenNewWindow.label;&quot;</span>
<a href="#l5.16"></a><span id="l5.16">               accesskey=&quot;&amp;folderContextOpenNewWindow.accesskey;&quot;</span>
<a href="#l5.17"></a><span id="l5.17">               oncommand=&quot;MsgOpenNewWindowForFolder(null,-1);&quot;/&gt;</span>
<a href="#l5.18"></a><span id="l5.18">     &lt;menuitem id=&quot;folderPaneContext-searchMessages&quot;</span>
<a href="#l5.19"></a><span id="l5.19">               label=&quot;&amp;folderContextSearchMessages.label;&quot;</span>
<a href="#l5.20"></a><span id="l5.20">               accesskey=&quot;&amp;folderContextSearchMessages.accesskey;&quot;</span>
<a href="#l5.21"></a><span id="l5.21">               oncommand=&quot;gFolderTreeController.searchMessages();&quot;/&gt;</span>
<a href="#l5.22"></a><span id="l5.22" class="difflineat">@@ -494,17 +494,17 @@</span>
<a href="#l5.23"></a><span id="l5.23">     &lt;menuseparator id=&quot;mailContext-sep-link&quot;/&gt;</span>
<a href="#l5.24"></a><span id="l5.24">     &lt;menuitem id=&quot;context-selectall&quot;/&gt;</span>
<a href="#l5.25"></a><span id="l5.25">     &lt;menuitem id=&quot;context-copy&quot;/&gt;</span>
<a href="#l5.26"></a><span id="l5.26">     &lt;menuitem id=&quot;context-searchselect&quot;</span>
<a href="#l5.27"></a><span id="l5.27">               oncommand=&quot;MsgOpenSearch(gContextMenu.searchSelected(), event);&quot;/&gt;</span>
<a href="#l5.28"></a><span id="l5.28">     &lt;menuitem id=&quot;mailContext-openNewTab&quot;</span>
<a href="#l5.29"></a><span id="l5.29">               label=&quot;&amp;contextOpenNewTab.label;&quot;</span>
<a href="#l5.30"></a><span id="l5.30">               accesskey=&quot;&amp;contextOpenNewTab.accesskey;&quot;</span>
<a href="#l5.31"></a><span id="l5.31" class="difflineminus">-              oncommand=&quot;MsgOpenNewTabForMessage();&quot;/&gt;</span>
<a href="#l5.32"></a><span id="l5.32" class="difflineplus">+              oncommand=&quot;OpenMessageInNewTab(event);&quot;/&gt;</span>
<a href="#l5.33"></a><span id="l5.33">     &lt;menuitem id=&quot;mailContext-openNewWindow&quot;</span>
<a href="#l5.34"></a><span id="l5.34">               label=&quot;&amp;contextOpenNewWindow.label;&quot;</span>
<a href="#l5.35"></a><span id="l5.35">               accesskey=&quot;&amp;contextOpenNewWindow.accesskey;&quot;</span>
<a href="#l5.36"></a><span id="l5.36">               oncommand=&quot;MsgOpenNewWindowForMessage();&quot;/&gt;</span>
<a href="#l5.37"></a><span id="l5.37">     &lt;menuseparator id=&quot;mailContext-sep-open&quot;/&gt;</span>
<a href="#l5.38"></a><span id="l5.38">     &lt;menuitem id=&quot;mailContext-replySender&quot;</span>
<a href="#l5.39"></a><span id="l5.39">               label=&quot;&amp;contextReplySender.label;&quot;</span>
<a href="#l5.40"></a><span id="l5.40">               accesskey=&quot;&amp;contextReplySender.accesskey;&quot;</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l6.1"></a><span id="l6.1" class="difflineminus">--- a/suite/mailnews/content/msgMail3PaneWindow.js</span>
<a href="#l6.2"></a><span id="l6.2" class="difflineplus">+++ b/suite/mailnews/content/msgMail3PaneWindow.js</span>
<a href="#l6.3"></a><span id="l6.3" class="difflineat">@@ -1192,28 +1192,35 @@ function TreeOnMouseDown(event)</span>
<a href="#l6.4"></a><span id="l6.4">   gRightMouseButtonDown = event.button == kMouseButtonRight;</span>
<a href="#l6.5"></a><span id="l6.5">   if (!gRightMouseButtonDown)</span>
<a href="#l6.6"></a><span id="l6.6">     gRightMouseButtonDown = AllowOpenTabOnMiddleClick() &amp;&amp;</span>
<a href="#l6.7"></a><span id="l6.7">                             event.button == kMouseButtonMiddle;</span>
<a href="#l6.8"></a><span id="l6.8">   if (gRightMouseButtonDown)</span>
<a href="#l6.9"></a><span id="l6.9">     ChangeSelectionWithoutContentLoad(event, event.target.parentNode);</span>
<a href="#l6.10"></a><span id="l6.10"> }</span>
<a href="#l6.11"></a><span id="l6.11"> </span>
<a href="#l6.12"></a><span id="l6.12" class="difflineplus">+function FolderPaneContextMenuNewTab(event) {</span>
<a href="#l6.13"></a><span id="l6.13" class="difflineplus">+  var bgLoad = Services.prefs.getBoolPref(&quot;mail.tabs.loadInBackground&quot;);</span>
<a href="#l6.14"></a><span id="l6.14" class="difflineplus">+  if (event.shiftKey)</span>
<a href="#l6.15"></a><span id="l6.15" class="difflineplus">+    bgLoad = !bgLoad;</span>
<a href="#l6.16"></a><span id="l6.16" class="difflineplus">+  MsgOpenNewTabForFolder(bgLoad);</span>
<a href="#l6.17"></a><span id="l6.17" class="difflineplus">+}</span>
<a href="#l6.18"></a><span id="l6.18" class="difflineplus">+</span>
<a href="#l6.19"></a><span id="l6.19"> function FolderPaneOnClick(event)</span>
<a href="#l6.20"></a><span id="l6.20"> {</span>
<a href="#l6.21"></a><span id="l6.21">   // usually, we're only interested in tree content clicks, not scrollbars etc.</span>
<a href="#l6.22"></a><span id="l6.22">   if (event.originalTarget.localName != &quot;treechildren&quot;)</span>
<a href="#l6.23"></a><span id="l6.23">     return;</span>
<a href="#l6.24"></a><span id="l6.24"> </span>
<a href="#l6.25"></a><span id="l6.25">   // we may want to open the folder in a new tab on middle click</span>
<a href="#l6.26"></a><span id="l6.26">   if (event.button == kMouseButtonMiddle)</span>
<a href="#l6.27"></a><span id="l6.27">   {</span>
<a href="#l6.28"></a><span id="l6.28">     if (AllowOpenTabOnMiddleClick())</span>
<a href="#l6.29"></a><span id="l6.29">     {</span>
<a href="#l6.30"></a><span id="l6.30" class="difflineminus">-      MsgOpenNewTabForFolder();</span>
<a href="#l6.31"></a><span id="l6.31" class="difflineplus">+      FolderPaneContextMenuNewTab(event);</span>
<a href="#l6.32"></a><span id="l6.32">       RestoreSelectionWithoutContentLoad(GetFolderTree());</span>
<a href="#l6.33"></a><span id="l6.33">       return;</span>
<a href="#l6.34"></a><span id="l6.34">     }</span>
<a href="#l6.35"></a><span id="l6.35">   }</span>
<a href="#l6.36"></a><span id="l6.36"> </span>
<a href="#l6.37"></a><span id="l6.37">   // otherwise, we only care about left click events</span>
<a href="#l6.38"></a><span id="l6.38">   if (event.button != kMouseButtonLeft)</span>
<a href="#l6.39"></a><span id="l6.39">     return;</span>
<a href="#l6.40"></a><span id="l6.40" class="difflineat">@@ -1237,32 +1244,40 @@ function FolderPaneOnClick(event)</span>
<a href="#l6.41"></a><span id="l6.41"> }</span>
<a href="#l6.42"></a><span id="l6.42"> </span>
<a href="#l6.43"></a><span id="l6.43"> function FolderPaneDoubleClick(folderIndex, event)</span>
<a href="#l6.44"></a><span id="l6.44"> {</span>
<a href="#l6.45"></a><span id="l6.45">   // In tabmail land, lazyness is dead!</span>
<a href="#l6.46"></a><span id="l6.46">   // We either open the folder in a tab or a new window...</span>
<a href="#l6.47"></a><span id="l6.47">   if (AllowOpenTabOnDoubleClick())</span>
<a href="#l6.48"></a><span id="l6.48">   {</span>
<a href="#l6.49"></a><span id="l6.49" class="difflineminus">-    MsgOpenNewTabForFolder();</span>
<a href="#l6.50"></a><span id="l6.50" class="difflineplus">+    FolderPaneContextMenuNewTab(event);</span>
<a href="#l6.51"></a><span id="l6.51">   }</span>
<a href="#l6.52"></a><span id="l6.52">   else</span>
<a href="#l6.53"></a><span id="l6.53">   {</span>
<a href="#l6.54"></a><span id="l6.54">     let folderResource = GetFolderResource(GetFolderTree(), folderIndex);</span>
<a href="#l6.55"></a><span id="l6.55">     // Open a new msg window only if we are double clicking on</span>
<a href="#l6.56"></a><span id="l6.56">     // folders or newsgroups.</span>
<a href="#l6.57"></a><span id="l6.57">     MsgOpenNewWindowForFolder(folderResource.Value, nsMsgKey_None);</span>
<a href="#l6.58"></a><span id="l6.58">   }</span>
<a href="#l6.59"></a><span id="l6.59"> </span>
<a href="#l6.60"></a><span id="l6.60">   // Double-clicking should not toggle the open/close state of the folder.</span>
<a href="#l6.61"></a><span id="l6.61">   // This will happen if we don't prevent the event from bubbling to the</span>
<a href="#l6.62"></a><span id="l6.62">   // default handler in tree.xml.</span>
<a href="#l6.63"></a><span id="l6.63">   event.stopPropagation();</span>
<a href="#l6.64"></a><span id="l6.64"> }</span>
<a href="#l6.65"></a><span id="l6.65"> </span>
<a href="#l6.66"></a><span id="l6.66" class="difflineplus">+function OpenMessageInNewTab(event) {</span>
<a href="#l6.67"></a><span id="l6.67" class="difflineplus">+  var bgLoad = Services.prefs.getBoolPref(&quot;mail.tabs.loadInBackground&quot;);</span>
<a href="#l6.68"></a><span id="l6.68" class="difflineplus">+  if (event.shiftKey)</span>
<a href="#l6.69"></a><span id="l6.69" class="difflineplus">+    bgLoad = !bgLoad;</span>
<a href="#l6.70"></a><span id="l6.70" class="difflineplus">+</span>
<a href="#l6.71"></a><span id="l6.71" class="difflineplus">+  MsgOpenNewTabForMessage(bgLoad);</span>
<a href="#l6.72"></a><span id="l6.72" class="difflineplus">+}</span>
<a href="#l6.73"></a><span id="l6.73" class="difflineplus">+</span>
<a href="#l6.74"></a><span id="l6.74"> function ChangeSelection(tree, newIndex)</span>
<a href="#l6.75"></a><span id="l6.75"> {</span>
<a href="#l6.76"></a><span id="l6.76">     if(newIndex &gt;= 0)</span>
<a href="#l6.77"></a><span id="l6.77">     {</span>
<a href="#l6.78"></a><span id="l6.78">         tree.view.selection.select(newIndex);</span>
<a href="#l6.79"></a><span id="l6.79">         tree.treeBoxObject.ensureRowIsVisible(newIndex);</span>
<a href="#l6.80"></a><span id="l6.80">     }</span>
<a href="#l6.81"></a><span id="l6.81"> }</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l7.1"></a><span id="l7.1" class="difflineminus">--- a/suite/mailnews/content/tabmail.js</span>
<a href="#l7.2"></a><span id="l7.2" class="difflineplus">+++ b/suite/mailnews/content/tabmail.js</span>
<a href="#l7.3"></a><span id="l7.3" class="difflineat">@@ -32,21 +32,22 @@ var gMailNewsTabsType =</span>
<a href="#l7.4"></a><span id="l7.4">   modes:</span>
<a href="#l7.5"></a><span id="l7.5">   {</span>
<a href="#l7.6"></a><span id="l7.6">     &quot;3pane&quot;:</span>
<a href="#l7.7"></a><span id="l7.7">     {</span>
<a href="#l7.8"></a><span id="l7.8">       isDefault: true,</span>
<a href="#l7.9"></a><span id="l7.9">       type: &quot;3pane&quot;,</span>
<a href="#l7.10"></a><span id="l7.10"> </span>
<a href="#l7.11"></a><span id="l7.11">       // aTabInfo belongs to the newly created tab,</span>
<a href="#l7.12"></a><span id="l7.12" class="difflineminus">-      // aModeBits is a combination of kTabShow* layout bits (or null),</span>
<a href="#l7.13"></a><span id="l7.13" class="difflineminus">-      // aFolderURI designates the folder to select (or null)</span>
<a href="#l7.14"></a><span id="l7.14" class="difflineminus">-      // aMsgHdr designates the message to select (or null)</span>
<a href="#l7.15"></a><span id="l7.15" class="difflineminus">-      openTab: function(aTabInfo, aModeBits, aFolderURI, aMsgHdr)</span>
<a href="#l7.16"></a><span id="l7.16" class="difflineminus">-      {</span>
<a href="#l7.17"></a><span id="l7.17" class="difflineplus">+      // aArgs can contain:</span>
<a href="#l7.18"></a><span id="l7.18" class="difflineplus">+      // * modeBits is a combination of kTabShow* layout bits (or null),</span>
<a href="#l7.19"></a><span id="l7.19" class="difflineplus">+      // * folderURI designates the folder to select (or null)</span>
<a href="#l7.20"></a><span id="l7.20" class="difflineplus">+      // * msgHdr designates the message to select (or null)</span>
<a href="#l7.21"></a><span id="l7.21" class="difflineplus">+      openTab: function(aTabInfo, {modeBits: aModeBits, folderURI: aFolderURI,</span>
<a href="#l7.22"></a><span id="l7.22" class="difflineplus">+                                   msgHdr: aMsgHdr}) {</span>
<a href="#l7.23"></a><span id="l7.23">         // clone the current 3pane state before overriding parts of it</span>
<a href="#l7.24"></a><span id="l7.24">         this.saveTabState(aTabInfo);</span>
<a href="#l7.25"></a><span id="l7.25"> </span>
<a href="#l7.26"></a><span id="l7.26">         // aModeBits must have at least one bit set</span>
<a href="#l7.27"></a><span id="l7.27">         // if not, we just copy the current state</span>
<a href="#l7.28"></a><span id="l7.28">         let cloneMode = !aModeBits;</span>
<a href="#l7.29"></a><span id="l7.29">         if (cloneMode)</span>
<a href="#l7.30"></a><span id="l7.30">           aModeBits = this.getCurrentModeBits() || kTabModeFolder;</span>
<a href="#l7.31"></a><span id="l7.31" class="difflineat">@@ -520,34 +521,31 @@ var gMailNewsTabsType =</span>
<a href="#l7.32"></a><span id="l7.32"> //  tabmail support methods</span>
<a href="#l7.33"></a><span id="l7.33"> //</span>
<a href="#l7.34"></a><span id="l7.34"> </span>
<a href="#l7.35"></a><span id="l7.35"> function GetTabMail()</span>
<a href="#l7.36"></a><span id="l7.36"> {</span>
<a href="#l7.37"></a><span id="l7.37">   return document.getElementById(&quot;tabmail&quot;);</span>
<a href="#l7.38"></a><span id="l7.38"> }</span>
<a href="#l7.39"></a><span id="l7.39"> </span>
<a href="#l7.40"></a><span id="l7.40" class="difflineminus">-function MsgOpenNewTab(aType, aModeBits)</span>
<a href="#l7.41"></a><span id="l7.41" class="difflineminus">-{</span>
<a href="#l7.42"></a><span id="l7.42" class="difflineplus">+function MsgOpenNewTab(aType, aModeBits, aBackground) {</span>
<a href="#l7.43"></a><span id="l7.43">   // duplicate the current tab</span>
<a href="#l7.44"></a><span id="l7.44">   var tabmail = GetTabMail();</span>
<a href="#l7.45"></a><span id="l7.45">   if (tabmail)</span>
<a href="#l7.46"></a><span id="l7.46" class="difflineminus">-    tabmail.openTab(aType, aModeBits);</span>
<a href="#l7.47"></a><span id="l7.47" class="difflineplus">+    tabmail.openTab(aType, {modeBits: aModeBits, background: aBackground});</span>
<a href="#l7.48"></a><span id="l7.48"> }</span>
<a href="#l7.49"></a><span id="l7.49"> </span>
<a href="#l7.50"></a><span id="l7.50" class="difflineminus">-function MsgOpenNewTabForFolder()</span>
<a href="#l7.51"></a><span id="l7.51" class="difflineminus">-{</span>
<a href="#l7.52"></a><span id="l7.52" class="difflineplus">+function MsgOpenNewTabForFolder(aBackground) {</span>
<a href="#l7.53"></a><span id="l7.53">   // open current folder in full 3pane tab</span>
<a href="#l7.54"></a><span id="l7.54" class="difflineminus">-  MsgOpenNewTab(&quot;3pane&quot;, kTabModeFolder);</span>
<a href="#l7.55"></a><span id="l7.55" class="difflineplus">+  MsgOpenNewTab(&quot;3pane&quot;, kTabModeFolder, aBackground);</span>
<a href="#l7.56"></a><span id="l7.56"> }</span>
<a href="#l7.57"></a><span id="l7.57"> </span>
<a href="#l7.58"></a><span id="l7.58" class="difflineminus">-function MsgOpenNewTabForMessage()</span>
<a href="#l7.59"></a><span id="l7.59" class="difflineminus">-{</span>
<a href="#l7.60"></a><span id="l7.60" class="difflineplus">+function MsgOpenNewTabForMessage(aBackground) {</span>
<a href="#l7.61"></a><span id="l7.61">   // open current message in message tab</span>
<a href="#l7.62"></a><span id="l7.62" class="difflineminus">-  MsgOpenNewTab(&quot;3pane&quot;, kTabModeMessage);</span>
<a href="#l7.63"></a><span id="l7.63" class="difflineplus">+  MsgOpenNewTab(&quot;3pane&quot;, kTabModeMessage, aBackground);</span>
<a href="#l7.64"></a><span id="l7.64"> }</span>
<a href="#l7.65"></a><span id="l7.65"> </span>
<a href="#l7.66"></a><span id="l7.66"> // A Thunderbird compatibility function called from e.g. newsblog.</span>
<a href="#l7.67"></a><span id="l7.67"> // We ignore aHandlerRegExp as it is not needed by SeaMonkey.</span>
<a href="#l7.68"></a><span id="l7.68"> function openContentTab(aUrl, aWhere, aHandlerRegExp)</span>
<a href="#l7.69"></a><span id="l7.69"> {</span>
<a href="#l7.70"></a><span id="l7.70">   openUILinkIn(aUrl, aWhere);</span>
<a href="#l7.71"></a><span id="l7.71"> }</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l8.1"></a><span id="l8.1" class="difflineminus">--- a/suite/mailnews/content/tabmail.xml</span>
<a href="#l8.2"></a><span id="l8.2" class="difflineplus">+++ b/suite/mailnews/content/tabmail.xml</span>
<a href="#l8.3"></a><span id="l8.3" class="difflineat">@@ -32,19 +32,22 @@</span>
<a href="#l8.4"></a><span id="l8.4">     -</span>
<a href="#l8.5"></a><span id="l8.5">     - From a javascript perspective, there are three types of code that we</span>
<a href="#l8.6"></a><span id="l8.6">     -  expect to interact with:</span>
<a href="#l8.7"></a><span id="l8.7">     - 1) Code that wants to open new tabs.</span>
<a href="#l8.8"></a><span id="l8.8">     - 2) Code that wants to contribute one or more varieties of tabs.</span>
<a href="#l8.9"></a><span id="l8.9">     - 3) Code that wants to monitor to know when the active tab changes.</span>
<a href="#l8.10"></a><span id="l8.10">     -</span>
<a href="#l8.11"></a><span id="l8.11">     - Consumer code should use the following methods:</span>
<a href="#l8.12"></a><span id="l8.12" class="difflineminus">-    - * openTab(aTabModeName, arguments...): Open a tab of the given &quot;mode&quot;,</span>
<a href="#l8.13"></a><span id="l8.13" class="difflineminus">-    -   passing the provided arguments.  The tab type author should tell you</span>
<a href="#l8.14"></a><span id="l8.14" class="difflineminus">-    -   the modes they implement and the required/optional arguments.</span>
<a href="#l8.15"></a><span id="l8.15" class="difflineplus">+    - * openTab(aTabModeName, aArgs): Open a tab of the given &quot;mode&quot;,</span>
<a href="#l8.16"></a><span id="l8.16" class="difflineplus">+    -   passing the provided arguments as an object.  The tab type author</span>
<a href="#l8.17"></a><span id="l8.17" class="difflineplus">+    -   should tell you the modes they implement and the required/optional</span>
<a href="#l8.18"></a><span id="l8.18" class="difflineplus">+    -   arguments.</span>
<a href="#l8.19"></a><span id="l8.19" class="difflineplus">+    -   One of the arguments you can pass is &quot;background&quot;: if this is true,</span>
<a href="#l8.20"></a><span id="l8.20" class="difflineplus">+    -   the tab will be loaded in the background.</span>
<a href="#l8.21"></a><span id="l8.21">     - * setTabTitle([aOptionalTabInfo]): Tells us that the title of the current</span>
<a href="#l8.22"></a><span id="l8.22">     -   tab (if no argument is provided) or provided tab needs to be updated.</span>
<a href="#l8.23"></a><span id="l8.23">     -   This will result in a call to the tab mode's logic to update the title.</span>
<a href="#l8.24"></a><span id="l8.24">     -   In the event this is not for the current tab, the caller is responsible</span>
<a href="#l8.25"></a><span id="l8.25">     -   for ensuring that the underlying tab mode is capable of providing a tab</span>
<a href="#l8.26"></a><span id="l8.26">     -   title when it is in the background.</span>
<a href="#l8.27"></a><span id="l8.27">     - * removeCurrentTab(): Close the current tab.</span>
<a href="#l8.28"></a><span id="l8.28">     - * removeTab(aTabElement): Close the tab whose tabmail-tab bound</span>
<a href="#l8.29"></a><span id="l8.29" class="difflineat">@@ -88,32 +91,33 @@</span>
<a href="#l8.30"></a><span id="l8.30">     -     Generally, this would be the same as the mode name, but you can do as</span>
<a href="#l8.31"></a><span id="l8.31">     -     you please.</span>
<a href="#l8.32"></a><span id="l8.32">     - * isDefault: This should only be present and should be true for the tab</span>
<a href="#l8.33"></a><span id="l8.33">     -     mode that is the tab displayed automatically on startup.</span>
<a href="#l8.34"></a><span id="l8.34">     - * maxTabs: The maximum number of this mode that can be opened at a time.</span>
<a href="#l8.35"></a><span id="l8.35">     -     If this limit is reached, any additional calls to openTab for this</span>
<a href="#l8.36"></a><span id="l8.36">     -     mode will simply result in the first existing tab of this mode being</span>
<a href="#l8.37"></a><span id="l8.37">     -     displayed.</span>
<a href="#l8.38"></a><span id="l8.38" class="difflineminus">-    - * shouldSwitchTo(arguments...): Optional function. Called when</span>
<a href="#l8.39"></a><span id="l8.39" class="difflineminus">-    -     openTab is called on the top-level tabmail binding. It is used to</span>
<a href="#l8.40"></a><span id="l8.40" class="difflineminus">-    -     decide if the openTab function should switch to an existing tab or</span>
<a href="#l8.41"></a><span id="l8.41" class="difflineminus">-    -     actually open a new tab.</span>
<a href="#l8.42"></a><span id="l8.42" class="difflineplus">+    - * shouldSwitchTo(aArgs): Optional function. Called when openTab is called</span>
<a href="#l8.43"></a><span id="l8.43" class="difflineplus">+    -     on the top-level tabmail binding. It is used to decide if the openTab</span>
<a href="#l8.44"></a><span id="l8.44" class="difflineplus">+    -     function should switch to an existing tab or actually open a new tab.</span>
<a href="#l8.45"></a><span id="l8.45">     -     If the openTab function should switch to an existing tab, return the</span>
<a href="#l8.46"></a><span id="l8.46">     -     index of that tab; otherwise return -1.</span>
<a href="#l8.47"></a><span id="l8.47" class="difflineminus">-    - * openTab(aTabInfo, arguments...): Called when a tab of the given mode is</span>
<a href="#l8.48"></a><span id="l8.48" class="difflineminus">-    -     in the process of being opened.  aTabInfo will have its &quot;mode&quot;</span>
<a href="#l8.49"></a><span id="l8.49" class="difflineminus">-    -     attribute set to the mode definition of the tab mode being opened.</span>
<a href="#l8.50"></a><span id="l8.50" class="difflineminus">-    -     You should set the &quot;title&quot; attribute on it, and may set any other</span>
<a href="#l8.51"></a><span id="l8.51" class="difflineminus">-    -     attributes you wish for your own use in subsequent functions.  Note</span>
<a href="#l8.52"></a><span id="l8.52" class="difflineminus">-    -     that 'this' points to the tab type definition, not the mode definition</span>
<a href="#l8.53"></a><span id="l8.53" class="difflineminus">-    -     as you might expect.  This allows you to place common logic code on</span>
<a href="#l8.54"></a><span id="l8.54" class="difflineminus">-    -     the tab type for use by multiple modes and to defer to it.  Any</span>
<a href="#l8.55"></a><span id="l8.55" class="difflineminus">-    -     arguments provided to the caller of tabmail.openTab will be passed to</span>
<a href="#l8.56"></a><span id="l8.56" class="difflineminus">-    -     your function as well.</span>
<a href="#l8.57"></a><span id="l8.57" class="difflineplus">+    -     aArgs is a set of named parameters (the ones that are later passed to</span>
<a href="#l8.58"></a><span id="l8.58" class="difflineplus">+    -     openTab).</span>
<a href="#l8.59"></a><span id="l8.59" class="difflineplus">+    - * openTab(aTabInfo, aArgs): Called when a tab of the given mode is in the</span>
<a href="#l8.60"></a><span id="l8.60" class="difflineplus">+    -     process of being opened.  aTabInfo will have its &quot;mode&quot; attribute</span>
<a href="#l8.61"></a><span id="l8.61" class="difflineplus">+    -     set to the mode definition of the tab mode being opened. You should</span>
<a href="#l8.62"></a><span id="l8.62" class="difflineplus">+    -     set the &quot;title&quot; attribute on it, and may set any other attributes</span>
<a href="#l8.63"></a><span id="l8.63" class="difflineplus">+    -     you wish for your own use in subsequent functions.  Note that 'this'</span>
<a href="#l8.64"></a><span id="l8.64" class="difflineplus">+    -     points to the tab type definition, not the mode definition as you</span>
<a href="#l8.65"></a><span id="l8.65" class="difflineplus">+    -     might expect.  This allows you to place common logic code on the</span>
<a href="#l8.66"></a><span id="l8.66" class="difflineplus">+    -     tab type for use by multiple modes and to defer to it.  Any arguments</span>
<a href="#l8.67"></a><span id="l8.67" class="difflineplus">+    -     provided to the caller of tabmail.openTab will be passed to your</span>
<a href="#l8.68"></a><span id="l8.68" class="difflineplus">+    -     function as well, including background.</span>
<a href="#l8.69"></a><span id="l8.69">     - * canCloseTab(aTabInfo): Optional function.</span>
<a href="#l8.70"></a><span id="l8.70">     -     Return true (false) if the tab is (not) allowed to close.</span>
<a href="#l8.71"></a><span id="l8.71">     -     A tab's default permission is stored in aTabInfo.canClose.</span>
<a href="#l8.72"></a><span id="l8.72">     - * closeTab(aTabInfo): Called when aTabInfo is being closed.  The tab need</span>
<a href="#l8.73"></a><span id="l8.73">     -     not be currently displayed.  You are responsible for properly cleaning</span>
<a href="#l8.74"></a><span id="l8.74">     -     up any state you preserved in aTabInfo.</span>
<a href="#l8.75"></a><span id="l8.75">     - * saveTabState(aTabInfo): Called when aTabInfo is being switched away from</span>
<a href="#l8.76"></a><span id="l8.76">     -     so that you can preserve its state on aTabInfo.  This is primarily for</span>
<a href="#l8.77"></a><span id="l8.77" class="difflineat">@@ -357,49 +361,54 @@</span>
<a href="#l8.78"></a><span id="l8.78">               }</span>
<a href="#l8.79"></a><span id="l8.79">             }</span>
<a href="#l8.80"></a><span id="l8.80">           ]]&gt;</span>
<a href="#l8.81"></a><span id="l8.81">         &lt;/body&gt;</span>
<a href="#l8.82"></a><span id="l8.82">       &lt;/method&gt;</span>
<a href="#l8.83"></a><span id="l8.83"> </span>
<a href="#l8.84"></a><span id="l8.84">       &lt;method name=&quot;openTab&quot;&gt;</span>
<a href="#l8.85"></a><span id="l8.85">         &lt;parameter name=&quot;aTabModeName&quot;/&gt;</span>
<a href="#l8.86"></a><span id="l8.86" class="difflineminus">-        &lt;!-- parameter name=&quot;aMoreParameters...&quot;/--&gt;</span>
<a href="#l8.87"></a><span id="l8.87" class="difflineplus">+        &lt;parameter name=&quot;aArgs&quot;/&gt;</span>
<a href="#l8.88"></a><span id="l8.88">         &lt;body&gt;</span>
<a href="#l8.89"></a><span id="l8.89">           &lt;![CDATA[</span>
<a href="#l8.90"></a><span id="l8.90">             if (!aTabModeName)</span>
<a href="#l8.91"></a><span id="l8.91">               aTabModeName = this.currentTabInfo.mode.type;</span>
<a href="#l8.92"></a><span id="l8.92"> </span>
<a href="#l8.93"></a><span id="l8.93">             let tabMode = this.tabModes[aTabModeName];</span>
<a href="#l8.94"></a><span id="l8.94">             // if we are already at our limit for this mode, show an existing one</span>
<a href="#l8.95"></a><span id="l8.95">             if (tabMode.tabs.length == tabMode.maxTabs)</span>
<a href="#l8.96"></a><span id="l8.96">             {</span>
<a href="#l8.97"></a><span id="l8.97">               // show the first tab of this mode</span>
<a href="#l8.98"></a><span id="l8.98">               this.tabContainer.selectedIndex = this.tabInfo.indexOf(tabMode.tabs[0]);</span>
<a href="#l8.99"></a><span id="l8.99">               return;</span>
<a href="#l8.100"></a><span id="l8.100">             }</span>
<a href="#l8.101"></a><span id="l8.101"> </span>
<a href="#l8.102"></a><span id="l8.102" class="difflineplus">+            // Do this so that we don't generate strict warnings.</span>
<a href="#l8.103"></a><span id="l8.103" class="difflineplus">+            let background = (&quot;background&quot; in aArgs) &amp;&amp; aArgs.background;</span>
<a href="#l8.104"></a><span id="l8.104" class="difflineplus">+</span>
<a href="#l8.105"></a><span id="l8.105">             // If the mode wants us to, we should switch to an existing tab</span>
<a href="#l8.106"></a><span id="l8.106" class="difflineminus">-            // rather than open a new one.</span>
<a href="#l8.107"></a><span id="l8.107" class="difflineplus">+            // rather than open a new one. We shouldn't switch to the tab if</span>
<a href="#l8.108"></a><span id="l8.108" class="difflineplus">+            // we're opening it in the background, though.</span>
<a href="#l8.109"></a><span id="l8.109">             let shouldSwitchToFunc = tabMode.shouldSwitchTo ||</span>
<a href="#l8.110"></a><span id="l8.110">                                      tabMode.tabType.shouldSwitchTo;</span>
<a href="#l8.111"></a><span id="l8.111"> </span>
<a href="#l8.112"></a><span id="l8.112">             if (shouldSwitchToFunc)</span>
<a href="#l8.113"></a><span id="l8.113">             {</span>
<a href="#l8.114"></a><span id="l8.114" class="difflineminus">-              let args = Array.prototype.slice.call(arguments, 1);</span>
<a href="#l8.115"></a><span id="l8.115" class="difflineminus">-              let tabIndex = shouldSwitchToFunc.apply(tabMode.tabType, args);</span>
<a href="#l8.116"></a><span id="l8.116" class="difflineplus">+              let tabIndex = shouldSwitchToFunc.apply(tabMode.tabType, [aArgs]);</span>
<a href="#l8.117"></a><span id="l8.117">               if (tabIndex &gt;= 0)</span>
<a href="#l8.118"></a><span id="l8.118">               {</span>
<a href="#l8.119"></a><span id="l8.119" class="difflineminus">-                this.selectTabByIndex(tabIndex);</span>
<a href="#l8.120"></a><span id="l8.120" class="difflineplus">+                if (!background)</span>
<a href="#l8.121"></a><span id="l8.121" class="difflineplus">+                  this.selectTabByIndex(tabIndex);</span>
<a href="#l8.122"></a><span id="l8.122">                 return;</span>
<a href="#l8.123"></a><span id="l8.123">               }</span>
<a href="#l8.124"></a><span id="l8.124">             }</span>
<a href="#l8.125"></a><span id="l8.125"> </span>
<a href="#l8.126"></a><span id="l8.126" class="difflineminus">-            // we need to save the state before it gets corrupted</span>
<a href="#l8.127"></a><span id="l8.127" class="difflineminus">-            this.saveCurrentTabState();</span>
<a href="#l8.128"></a><span id="l8.128" class="difflineplus">+            if (!background)</span>
<a href="#l8.129"></a><span id="l8.129" class="difflineplus">+              // we need to save the state before it gets corrupted</span>
<a href="#l8.130"></a><span id="l8.130" class="difflineplus">+              this.saveCurrentTabState();</span>
<a href="#l8.131"></a><span id="l8.131"> </span>
<a href="#l8.132"></a><span id="l8.132">             let tabInfo = {mode: tabMode, canClose: true};</span>
<a href="#l8.133"></a><span id="l8.133">             tabMode.tabs.push(tabInfo);</span>
<a href="#l8.134"></a><span id="l8.134"> </span>
<a href="#l8.135"></a><span id="l8.135">             let t = document.createElementNS(</span>
<a href="#l8.136"></a><span id="l8.136">               &quot;http://www.mozilla.org/keymaster/gatekeeper/there.is.only.xul&quot;,</span>
<a href="#l8.137"></a><span id="l8.137">               &quot;tab&quot;);</span>
<a href="#l8.138"></a><span id="l8.138">             t.setAttribute(&quot;crop&quot;, &quot;end&quot;);</span>
<a href="#l8.139"></a><span id="l8.139" class="difflineat">@@ -417,29 +426,28 @@</span>
<a href="#l8.140"></a><span id="l8.140">             {</span>
<a href="#l8.141"></a><span id="l8.141">               this.mStripVisible = true;</span>
<a href="#l8.142"></a><span id="l8.142">               this.tabContainer._updateCloseButtons();</span>
<a href="#l8.143"></a><span id="l8.143">             }</span>
<a href="#l8.144"></a><span id="l8.144"> </span>
<a href="#l8.145"></a><span id="l8.145">             let oldPanel = this.panelContainer.selectedPanel;</span>
<a href="#l8.146"></a><span id="l8.146"> </span>
<a href="#l8.147"></a><span id="l8.147">             // Open new tabs in the background?</span>
<a href="#l8.148"></a><span id="l8.148" class="difflineminus">-            let switchToNewTab = !this.mPrefs.getBoolPref(&quot;browser.tabs.loadInBackground&quot;);</span>
<a href="#l8.149"></a><span id="l8.149" class="difflineminus">-            tabInfo.switchToNewTab = switchToNewTab;</span>
<a href="#l8.150"></a><span id="l8.150" class="difflineplus">+            tabInfo.switchToNewTab = !background;</span>
<a href="#l8.151"></a><span id="l8.151"> </span>
<a href="#l8.152"></a><span id="l8.152">             // the order of the following statements is important</span>
<a href="#l8.153"></a><span id="l8.153">             let oldTabInfo = this.currentTabInfo;</span>
<a href="#l8.154"></a><span id="l8.154">             this.tabInfo[this.tabContainer.childNodes.length - 1] = tabInfo;</span>
<a href="#l8.155"></a><span id="l8.155"> </span>
<a href="#l8.156"></a><span id="l8.156" class="difflineminus">-            if (switchToNewTab)</span>
<a href="#l8.157"></a><span id="l8.157" class="difflineminus">-            {</span>
<a href="#l8.158"></a><span id="l8.158" class="difflineplus">+            if (!background) {</span>
<a href="#l8.159"></a><span id="l8.159">               this.currentTabInfo = tabInfo;</span>
<a href="#l8.160"></a><span id="l8.160">               // this has a side effect of calling updateCurrentTab, but our</span>
<a href="#l8.161"></a><span id="l8.161">               // setting currentTabInfo above will cause it to take no action.</span>
<a href="#l8.162"></a><span id="l8.162" class="difflineminus">-              this.tabContainer.selectedIndex = this.tabContainer.childNodes.length - 1;</span>
<a href="#l8.163"></a><span id="l8.163" class="difflineplus">+              this.tabContainer.selectedIndex =</span>
<a href="#l8.164"></a><span id="l8.164" class="difflineplus">+                this.tabContainer.childNodes.length - 1;</span>
<a href="#l8.165"></a><span id="l8.165">             }</span>
<a href="#l8.166"></a><span id="l8.166">             // make sure we are on the right panel</span>
<a href="#l8.167"></a><span id="l8.167">             let selectedPanel;</span>
<a href="#l8.168"></a><span id="l8.168">             if (tabInfo.mode.tabType.perTabPanel)</span>
<a href="#l8.169"></a><span id="l8.169">             {</span>
<a href="#l8.170"></a><span id="l8.170">               // should we create the element for them, or will they do it?</span>
<a href="#l8.171"></a><span id="l8.171">               if (typeof(tabInfo.mode.tabType.perTabPanel) == &quot;string&quot;)</span>
<a href="#l8.172"></a><span id="l8.172">               {</span>
<a href="#l8.173"></a><span id="l8.173" class="difflineat">@@ -453,45 +461,41 @@</span>
<a href="#l8.174"></a><span id="l8.174">               }</span>
<a href="#l8.175"></a><span id="l8.175">               this.panelContainer.appendChild(tabInfo.panel);</span>
<a href="#l8.176"></a><span id="l8.176">               selectedPanel = tabInfo.panel;</span>
<a href="#l8.177"></a><span id="l8.177">             }</span>
<a href="#l8.178"></a><span id="l8.178">             else</span>
<a href="#l8.179"></a><span id="l8.179">             {</span>
<a href="#l8.180"></a><span id="l8.180">               selectedPanel = tabInfo.mode.tabType.panel;</span>
<a href="#l8.181"></a><span id="l8.181">             }</span>
<a href="#l8.182"></a><span id="l8.182" class="difflineminus">-            if (switchToNewTab)</span>
<a href="#l8.183"></a><span id="l8.183" class="difflineplus">+            if (!background)</span>
<a href="#l8.184"></a><span id="l8.184">               this.panelContainer.selectedPanel = selectedPanel;</span>
<a href="#l8.185"></a><span id="l8.185"> </span>
<a href="#l8.186"></a><span id="l8.186">             oldPanel.removeAttribute(&quot;selected&quot;);</span>
<a href="#l8.187"></a><span id="l8.187">             this.panelContainer.selectedPanel.setAttribute(&quot;selected&quot;, &quot;true&quot;);</span>
<a href="#l8.188"></a><span id="l8.188"> </span>
<a href="#l8.189"></a><span id="l8.189">             let tabOpenFunc = tabInfo.mode.openTab ||</span>
<a href="#l8.190"></a><span id="l8.190">                               tabInfo.mode.tabType.openTab;</span>
<a href="#l8.191"></a><span id="l8.191" class="difflineminus">-            let args = [tabInfo].concat(Array.prototype.slice.call(arguments, 1));</span>
<a href="#l8.192"></a><span id="l8.192">             if (tabOpenFunc)</span>
<a href="#l8.193"></a><span id="l8.193" class="difflineminus">-              tabOpenFunc.apply(tabInfo.mode.tabType, args);</span>
<a href="#l8.194"></a><span id="l8.194" class="difflineplus">+              tabOpenFunc.apply(tabInfo.mode.tabType, [tabInfo, aArgs]);</span>
<a href="#l8.195"></a><span id="l8.195"> </span>
<a href="#l8.196"></a><span id="l8.196" class="difflineminus">-            if (!switchToNewTab)</span>
<a href="#l8.197"></a><span id="l8.197" class="difflineminus">-            {</span>
<a href="#l8.198"></a><span id="l8.198" class="difflineplus">+            if (background) {</span>
<a href="#l8.199"></a><span id="l8.199">               // if the new tab isn't made current,</span>
<a href="#l8.200"></a><span id="l8.200">               // its title won't change automatically</span>
<a href="#l8.201"></a><span id="l8.201">               this.setTabTitle(tabInfo);</span>
<a href="#l8.202"></a><span id="l8.202">             }</span>
<a href="#l8.203"></a><span id="l8.203"> </span>
<a href="#l8.204"></a><span id="l8.204" class="difflineminus">-            if (this.tabMonitors.length)</span>
<a href="#l8.205"></a><span id="l8.205" class="difflineminus">-            {</span>
<a href="#l8.206"></a><span id="l8.206" class="difflineminus">-              if (switchToNewTab)</span>
<a href="#l8.207"></a><span id="l8.207" class="difflineminus">-                for (let tabMonitor of this.tabMonitors)</span>
<a href="#l8.208"></a><span id="l8.208" class="difflineminus">-                  tabMonitor.onTabSwitched(tabInfo, oldTabInfo);</span>
<a href="#l8.209"></a><span id="l8.209" class="difflineplus">+            if (!background &amp;&amp; this.tabMonitors.length) {</span>
<a href="#l8.210"></a><span id="l8.210" class="difflineplus">+              for (let tabMonitor of this.tabMonitors)</span>
<a href="#l8.211"></a><span id="l8.211" class="difflineplus">+                tabMonitor.onTabSwitched(tabInfo, oldTabInfo);</span>
<a href="#l8.212"></a><span id="l8.212">             }</span>
<a href="#l8.213"></a><span id="l8.213"> </span>
<a href="#l8.214"></a><span id="l8.214">             t.setAttribute(&quot;label&quot;, tabInfo.title);</span>
<a href="#l8.215"></a><span id="l8.215" class="difflineminus">-            if (switchToNewTab)</span>
<a href="#l8.216"></a><span id="l8.216" class="difflineminus">-            {</span>
<a href="#l8.217"></a><span id="l8.217" class="difflineplus">+</span>
<a href="#l8.218"></a><span id="l8.218" class="difflineplus">+            if (!background) {</span>
<a href="#l8.219"></a><span id="l8.219">               let docTitle = tabInfo.title;</span>
<a href="#l8.220"></a><span id="l8.220">               if (AppConstants.platform != &quot;macosx&quot;) {</span>
<a href="#l8.221"></a><span id="l8.221">                 docTitle += &quot; - &quot; + gBrandBundle.getString(&quot;brandFullName&quot;);</span>
<a href="#l8.222"></a><span id="l8.222">               }</span>
<a href="#l8.223"></a><span id="l8.223">               document.title = docTitle;</span>
<a href="#l8.224"></a><span id="l8.224"> </span>
<a href="#l8.225"></a><span id="l8.225">               // Update the toolbar status - we don't need to do menus as they</span>
<a href="#l8.226"></a><span id="l8.226">               // do themselves when we open them.</span>
<a href="#l8.227"></a><span id="l8.227" class="difflineat">@@ -1473,17 +1477,17 @@</span>
<a href="#l8.228"></a><span id="l8.228">           let bindingParent = document.getBindingParent(this);</span>
<a href="#l8.229"></a><span id="l8.229">           if (bindingParent)</span>
<a href="#l8.230"></a><span id="l8.230">           {</span>
<a href="#l8.231"></a><span id="l8.231">             let tabmail = document.getBindingParent(bindingParent);</span>
<a href="#l8.232"></a><span id="l8.232">             if (bindingParent.localName == &quot;tabs&quot;)</span>
<a href="#l8.233"></a><span id="l8.233">             {</span>
<a href="#l8.234"></a><span id="l8.234">               // new-tab-button only appears in the tabstrip</span>
<a href="#l8.235"></a><span id="l8.235">               // duplicate the current tab</span>
<a href="#l8.236"></a><span id="l8.236" class="difflineminus">-              tabmail.openTab();</span>
<a href="#l8.237"></a><span id="l8.237" class="difflineplus">+              tabmail.openTab(&quot;&quot;, {});</span>
<a href="#l8.238"></a><span id="l8.238">             }</span>
<a href="#l8.239"></a><span id="l8.239">           }</span>
<a href="#l8.240"></a><span id="l8.240">         ]]&gt;</span>
<a href="#l8.241"></a><span id="l8.241">       &lt;/handler&gt;</span>
<a href="#l8.242"></a><span id="l8.242">       &lt;handler event=&quot;dblclick&quot; button=&quot;0&quot; phase=&quot;capturing&quot;&gt;</span>
<a href="#l8.243"></a><span id="l8.243">         &lt;![CDATA[</span>
<a href="#l8.244"></a><span id="l8.244">           event.stopPropagation();</span>
<a href="#l8.245"></a><span id="l8.245">         ]]&gt;</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l9.1"></a><span id="l9.1" class="difflineminus">--- a/suite/mailnews/content/threadPane.js</span>
<a href="#l9.2"></a><span id="l9.2" class="difflineplus">+++ b/suite/mailnews/content/threadPane.js</span>
<a href="#l9.3"></a><span id="l9.3" class="difflineat">@@ -14,17 +14,17 @@ function ThreadPaneOnClick(event)</span>
<a href="#l9.4"></a><span id="l9.4">   // we may want to open the message in a new tab on middle click</span>
<a href="#l9.5"></a><span id="l9.5">   if (event.button == kMouseButtonMiddle)</span>
<a href="#l9.6"></a><span id="l9.6">   {</span>
<a href="#l9.7"></a><span id="l9.7">     if (t.localName == &quot;treechildren&quot; &amp;&amp; AllowOpenTabOnMiddleClick())</span>
<a href="#l9.8"></a><span id="l9.8">     {</span>
<a href="#l9.9"></a><span id="l9.9">       // we don't allow new tabs in the search dialog</span>
<a href="#l9.10"></a><span id="l9.10">       if (document.documentElement.id != &quot;searchMailWindow&quot;)</span>
<a href="#l9.11"></a><span id="l9.11">       {</span>
<a href="#l9.12"></a><span id="l9.12" class="difflineminus">-        MsgOpenNewTabForMessage();</span>
<a href="#l9.13"></a><span id="l9.13" class="difflineplus">+        OpenMessageInNewTab(event);</span>
<a href="#l9.14"></a><span id="l9.14">         RestoreSelectionWithoutContentLoad(GetThreadTree());</span>
<a href="#l9.15"></a><span id="l9.15">       }</span>
<a href="#l9.16"></a><span id="l9.16">       return;</span>
<a href="#l9.17"></a><span id="l9.17">     }</span>
<a href="#l9.18"></a><span id="l9.18">   }</span>
<a href="#l9.19"></a><span id="l9.19"> </span>
<a href="#l9.20"></a><span id="l9.20">   // otherwise, we only care about left click events</span>
<a href="#l9.21"></a><span id="l9.21">   if (event.button != kMouseButtonLeft)</span>
<a href="#l9.22"></a><span id="l9.22" class="difflineat">@@ -46,17 +46,17 @@ function ThreadPaneOnClick(event)</span>
<a href="#l9.23"></a><span id="l9.23">     var cell = tree.treeBoxObject.getCellAt(event.clientX, event.clientY);</span>
<a href="#l9.24"></a><span id="l9.24">     if (cell.row == -1)</span>
<a href="#l9.25"></a><span id="l9.25">       return;</span>
<a href="#l9.26"></a><span id="l9.26"> </span>
<a href="#l9.27"></a><span id="l9.27">     // If the cell is in a &quot;cycler&quot; column or if the user double clicked on the</span>
<a href="#l9.28"></a><span id="l9.28">     // twisty, don't open the message in a new window.</span>
<a href="#l9.29"></a><span id="l9.29">     if (event.detail == 2 &amp;&amp; !cell.col.cycler &amp;&amp; (cell.childElt != &quot;twisty&quot;))</span>
<a href="#l9.30"></a><span id="l9.30">     {</span>
<a href="#l9.31"></a><span id="l9.31" class="difflineminus">-      ThreadPaneDoubleClick();</span>
<a href="#l9.32"></a><span id="l9.32" class="difflineplus">+      ThreadPaneDoubleClick(event);</span>
<a href="#l9.33"></a><span id="l9.33">       // Double clicking should not toggle the open/close state of the thread.</span>
<a href="#l9.34"></a><span id="l9.34">       // This will happen if we don't prevent the event from bubbling to the</span>
<a href="#l9.35"></a><span id="l9.35">       // default handler in tree.xml.</span>
<a href="#l9.36"></a><span id="l9.36">       event.stopPropagation();</span>
<a href="#l9.37"></a><span id="l9.37">     }</span>
<a href="#l9.38"></a><span id="l9.38">     else if (cell.col.id == &quot;junkStatusCol&quot;)</span>
<a href="#l9.39"></a><span id="l9.39">     {</span>
<a href="#l9.40"></a><span id="l9.40">       MsgJunkMailInfo(true);</span>
<a href="#l9.41"></a><span id="l9.41" class="difflineat">@@ -173,45 +173,44 @@ function HandleColumnClick(columnID)</span>
<a href="#l9.42"></a><span id="l9.42">       MsgReverseSortThreadPane();</span>
<a href="#l9.43"></a><span id="l9.43">     }</span>
<a href="#l9.44"></a><span id="l9.44">     else {</span>
<a href="#l9.45"></a><span id="l9.45">       MsgSortThreadPane(sortType);</span>
<a href="#l9.46"></a><span id="l9.46">     }</span>
<a href="#l9.47"></a><span id="l9.47">   }</span>
<a href="#l9.48"></a><span id="l9.48"> }</span>
<a href="#l9.49"></a><span id="l9.49"> </span>
<a href="#l9.50"></a><span id="l9.50" class="difflineminus">-function ThreadPaneDoubleClick()</span>
<a href="#l9.51"></a><span id="l9.51" class="difflineminus">-{</span>
<a href="#l9.52"></a><span id="l9.52" class="difflineplus">+function ThreadPaneDoubleClick(event) {</span>
<a href="#l9.53"></a><span id="l9.53">   const nsMsgFolderFlags = Ci.nsMsgFolderFlags;</span>
<a href="#l9.54"></a><span id="l9.54">   if (IsSpecialFolderSelected(nsMsgFolderFlags.Drafts, true))</span>
<a href="#l9.55"></a><span id="l9.55">   {</span>
<a href="#l9.56"></a><span id="l9.56">     MsgComposeDraftMessage();</span>
<a href="#l9.57"></a><span id="l9.57">   }</span>
<a href="#l9.58"></a><span id="l9.58">   else if(IsSpecialFolderSelected(nsMsgFolderFlags.Templates, true))</span>
<a href="#l9.59"></a><span id="l9.59">   {</span>
<a href="#l9.60"></a><span id="l9.60">     ComposeMsgByType(Ci.nsIMsgCompType.Template, null,</span>
<a href="#l9.61"></a><span id="l9.61">                      Ci.nsIMsgCompFormat.Default);</span>
<a href="#l9.62"></a><span id="l9.62">   }</span>
<a href="#l9.63"></a><span id="l9.63">   else if (AllowOpenTabOnDoubleClick() &amp;&amp;</span>
<a href="#l9.64"></a><span id="l9.64">            document.documentElement.id != &quot;searchMailWindow&quot;)</span>
<a href="#l9.65"></a><span id="l9.65">   {        // we don't allow new tabs in the search dialog</span>
<a href="#l9.66"></a><span id="l9.66">     // open the message in a new tab on double click</span>
<a href="#l9.67"></a><span id="l9.67" class="difflineminus">-    MsgOpenNewTabForMessage();</span>
<a href="#l9.68"></a><span id="l9.68" class="difflineplus">+    OpenMessageInNewTab(event);</span>
<a href="#l9.69"></a><span id="l9.69">     RestoreSelectionWithoutContentLoad(GetThreadTree());</span>
<a href="#l9.70"></a><span id="l9.70">   }</span>
<a href="#l9.71"></a><span id="l9.71">   else</span>
<a href="#l9.72"></a><span id="l9.72">   {</span>
<a href="#l9.73"></a><span id="l9.73">     MsgOpenSelectedMessages();</span>
<a href="#l9.74"></a><span id="l9.74">   }</span>
<a href="#l9.75"></a><span id="l9.75"> }</span>
<a href="#l9.76"></a><span id="l9.76"> </span>
<a href="#l9.77"></a><span id="l9.77"> function ThreadPaneKeyPress(event)</span>
<a href="#l9.78"></a><span id="l9.78"> {</span>
<a href="#l9.79"></a><span id="l9.79">   if (event.keyCode == KeyEvent.DOM_VK_RETURN)</span>
<a href="#l9.80"></a><span id="l9.80" class="difflineminus">-    ThreadPaneDoubleClick();</span>
<a href="#l9.81"></a><span id="l9.81" class="difflineplus">+    ThreadPaneDoubleClick(event);</span>
<a href="#l9.82"></a><span id="l9.82"> }</span>
<a href="#l9.83"></a><span id="l9.83"> </span>
<a href="#l9.84"></a><span id="l9.84"> function MsgSortByThread()</span>
<a href="#l9.85"></a><span id="l9.85"> {</span>
<a href="#l9.86"></a><span id="l9.86">   var dbview = GetDBView();</span>
<a href="#l9.87"></a><span id="l9.87">   dbview.viewFlags |= nsMsgViewFlagsType.kThreadedDisplay;</span>
<a href="#l9.88"></a><span id="l9.88">   dbview.viewFlags &amp;= ~nsMsgViewFlagsType.kGroupBySort;</span>
<a href="#l9.89"></a><span id="l9.89">   MsgSortThreadPane('byDate');</span></pre></div></div>

<div class="page_footer">
<div class="page_footer_text">comm-central</div>
<div class="page_footer_text" style="padding-left: 10px">Deployed from <a href="https://hg.mozilla.org/hgcustom/version-control-tools/rev/4b0de666d1a4">4b0de666d1a4</a> at 2020-07-30T19:32:31Z.</div>
<div class="rss_logo">
<a href="/comm-central/rss-log">RSS</a>
<a href="/comm-central/atom-log">Atom</a>
</div>
<br />

</div>
</body>
</html>

