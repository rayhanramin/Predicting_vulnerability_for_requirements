<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en-US" lang="en-US">
<head>
<link rel="icon" href="/static/35f393d6769a/hgicon.png" type="image/png" />
<meta name="robots" content="index, nofollow"/>
<link rel="stylesheet" href="/static/35f393d6769a/style-gitweb.css" type="text/css" />

<style type="text/css">
div.feed {
  float: right;
}
a img {
  border-width: 0px;
}
div.log_link {
  width: 80px;
  background-color: white;
}

div.log_body {
  padding-left: 96px;
}
</style>
<script type="text/javascript" src="/static/35f393d6769a/mercurial.js"></script>

<meta property="og:image" content="/static/35f393d6769a/moz-logo-bw-rgb.svg"/>
<meta property="og:type" content="website"/>

<title>comm-central: changeset 20697:d2c25fee0909d3f8122a97688e390915961029f2</title>
<link rel="alternate" type="application/atom+xml"
   href="/comm-central/atom-log" title="Atom feed for comm-central"/>
<link rel="alternate" type="application/rss+xml"
   href="/comm-central/rss-log" title="RSS feed for comm-central"/>

<meta property="og:title" content="comm-central @ d2c25fee0909d3f8122a97688e390915961029f2" />
<meta property="og:url" content="/comm-central/rev/d2c25fee0909d3f8122a97688e390915961029f2" />
<meta property="og:description" content="Bug 318495 - Add possibility to create an identity label that will be appended 'name &lt;email&gt;' on display. ui-r=Paenglab, r=mkmelin, r=IanN, a=IanN" />

</head>
<body>

<div class="page_header">
<div class="logo">
    <a href="https://developer.mozilla.org/en/docs/Mercurial">
        <img src="/static/35f393d6769a/moz-logo-bw-rgb.svg" alt="mercurial" />
    </a>
</div>
<a href="/">Mercurial</a> &gt; <a href="/comm-central">comm-central</a>  / changeset / d2c25fee0909d3f8122a97688e390915961029f2 
</div>

<div class="page_nav">
<div>
<a href="/comm-central/summary">summary</a> |
<a href="/comm-central/shortlog/d2c25fee0909d3f8122a97688e390915961029f2">shortlog</a> |
<a href="/comm-central/log/d2c25fee0909d3f8122a97688e390915961029f2">changelog</a> |
<a href="/comm-central/pushloghtml">pushlog</a> |
<a href="/comm-central/graph/d2c25fee0909d3f8122a97688e390915961029f2">graph</a> |
<a href="/comm-central/tags">tags</a> |
<a href="/comm-central/bookmarks">bookmarks</a> |
<a href="/comm-central/branches">branches</a> |
<a href="/comm-central/file/d2c25fee0909d3f8122a97688e390915961029f2">files</a> |
changeset |
<a href="/comm-central/raw-rev/d2c25fee0909d3f8122a97688e390915961029f2">raw</a>  | <a href="/comm-central/archive/d2c25fee0909d3f8122a97688e390915961029f2.zip">zip</a>  |
<a href="/comm-central/help">help</a>
</div>

<div class="search">
<form id="searchform" action="/comm-central/log">

<input name="rev" type="text" value="" size="40" />
<div id="hint">Find changesets by keywords (author, files, the commit message), revision
number or hash, or <a href="/comm-central/help/revsets">revset expression</a>.</div>
</form>
</div>
</div>

<div class="title">
<a href="https://bugzilla.mozilla.org/show_bug.cgi?id=318495">Bug 318495</a> - Add possibility to create an identity label that will be appended 'name &lt;email&gt;' on display. ui-r=Paenglab, r=mkmelin, r=IanN, a=IanN
<span class="logtags"></span>
</div>
<div class="title_text">
<table cellspacing="0">

<tr><td>author</td><td>&#97;&#99;&#101;&#109;&#97;&#110;&#32;&#60;&#97;&#99;&#101;&#108;&#105;&#115;&#116;&#115;&#64;&#97;&#116;&#108;&#97;&#115;&#46;&#115;&#107;&#62;</td></tr>
<tr><td></td><td class="date age">Mon, 14 Nov 2016 00:21:21 +0100</td></tr>

<tr>
 <td>changeset 20697</td>
 <td style="font-family:monospace"><a class="list" href="/comm-central/rev/d2c25fee0909d3f8122a97688e390915961029f2">d2c25fee0909d3f8122a97688e390915961029f2</a></td>
</tr>



<tr>
<td>parent 20696</td>
<td style="font-family:monospace">
<a class="list" href="/comm-central/rev/8898cabfdac3e4744a8aeca8b82bc879f701dbde">8898cabfdac3e4744a8aeca8b82bc879f701dbde</a>
</td>
</tr>

<tr>
<td>child 20698</td>
<td style="font-family:monospace">
<a class="list" href="/comm-central/rev/9d31ee8ebb34089fe82ca05e8d0c24a5cacdf1f6">9d31ee8ebb34089fe82ca05e8d0c24a5cacdf1f6</a>
</td>
</tr>
<tr><td>push id</td><td><a href="/comm-central/pushloghtml?changeset=d2c25fee0909d3f8122a97688e390915961029f2">12525</a></td></tr>
<tr><td>push user</td><td>acelists@atlas.sk</td></tr>
<tr><td>push date</td><td class="date age">Sun, 13 Nov 2016 23:23:00 +0000</td></tr>

<tr><td>treeherder</td><td>comm-central@26d7f9ff1aba [<a href="https://treeherder.mozilla.org/#/jobs?repo=comm-central&revision=26d7f9ff1aba6d7b0ac94e5c87b78dd66b245e99">default view</a>] [<a href="https://treeherder.mozilla.org/#/jobs?repo=comm-central&revision=26d7f9ff1aba6d7b0ac94e5c87b78dd66b245e99&filter-resultStatus=testfailed&filter-resultStatus=busted&filter-resultStatus=exception">failures only]</td></tr>
<tr><td>perfherder</td><td>[<a href="https://treeherder.mozilla.org/perf.html#/compare?originalProject=comm-central&originalRevision=26d7f9ff1aba6d7b0ac94e5c87b78dd66b245e99&newProject=comm-central&newRevision=d2c25fee0909d3f8122a97688e390915961029f2&framework=1" target="_blank">talos</a>] [<a href="https://treeherder.mozilla.org/perf.html#/compare?originalProject=comm-central&originalRevision=26d7f9ff1aba6d7b0ac94e5c87b78dd66b245e99&newProject=comm-central&newRevision=d2c25fee0909d3f8122a97688e390915961029f2&framework=2" target="_blank">build metrics</a>] [<a href="https://treeherder.mozilla.org/perf.html#/compare?originalProject=comm-central&originalRevision=26d7f9ff1aba6d7b0ac94e5c87b78dd66b245e99&newProject=comm-central&newRevision=d2c25fee0909d3f8122a97688e390915961029f2&framework=6" target="_blank">platform microbench</a>] (compared to previous push)</td></tr>
<tr><td>reviewers</td><td><a href="/comm-central/log?rev=reviewer%28Paenglab%29&revcount=50">Paenglab</a>, <a href="/comm-central/log?rev=reviewer%28mkmelin%29&revcount=50">mkmelin</a>, <a href="/comm-central/log?rev=reviewer%28IanN%29&revcount=50">IanN</a>, <a href="/comm-central/log?rev=reviewer%28IanN%29&revcount=50">IanN</a></td></tr>
<tr><td>bugs</td><td><a href="https://bugzilla.mozilla.org/show_bug.cgi?id=318495">318495</a></td></tr>




</table></div>

<div class="page_body description"><a href="https://bugzilla.mozilla.org/show_bug.cgi?id=318495">Bug 318495</a> - Add possibility to create an identity label that will be appended 'name &lt;email&gt;' on display. ui-r=Paenglab, r=mkmelin, r=IanN, a=IanN</div>
<div class="list_head"></div>
<div class="title_text">
<table cellspacing="0">

<tr class="parity0">
<td><a class="list" href="/comm-central/diff/d2c25fee0909d3f8122a97688e390915961029f2/mail/components/compose/content/MsgComposeCommands.js">mail/components/compose/content/MsgComposeCommands.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/d2c25fee0909d3f8122a97688e390915961029f2/mail/components/compose/content/MsgComposeCommands.js">file</a> |
<a href="/comm-central/annotate/d2c25fee0909d3f8122a97688e390915961029f2/mail/components/compose/content/MsgComposeCommands.js">annotate</a> |
<a href="/comm-central/diff/d2c25fee0909d3f8122a97688e390915961029f2/mail/components/compose/content/MsgComposeCommands.js">diff</a> |
<a href="/comm-central/comparison/d2c25fee0909d3f8122a97688e390915961029f2/mail/components/compose/content/MsgComposeCommands.js">comparison</a> |
<a href="/comm-central/log/d2c25fee0909d3f8122a97688e390915961029f2/mail/components/compose/content/MsgComposeCommands.js">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/d2c25fee0909d3f8122a97688e390915961029f2/mail/components/compose/content/addressingWidgetOverlay.js">mail/components/compose/content/addressingWidgetOverlay.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/d2c25fee0909d3f8122a97688e390915961029f2/mail/components/compose/content/addressingWidgetOverlay.js">file</a> |
<a href="/comm-central/annotate/d2c25fee0909d3f8122a97688e390915961029f2/mail/components/compose/content/addressingWidgetOverlay.js">annotate</a> |
<a href="/comm-central/diff/d2c25fee0909d3f8122a97688e390915961029f2/mail/components/compose/content/addressingWidgetOverlay.js">diff</a> |
<a href="/comm-central/comparison/d2c25fee0909d3f8122a97688e390915961029f2/mail/components/compose/content/addressingWidgetOverlay.js">comparison</a> |
<a href="/comm-central/log/d2c25fee0909d3f8122a97688e390915961029f2/mail/components/compose/content/addressingWidgetOverlay.js">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/d2c25fee0909d3f8122a97688e390915961029f2/mail/locales/en-US/chrome/messenger/am-identity-edit.dtd">mail/locales/en-US/chrome/messenger/am-identity-edit.dtd</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/d2c25fee0909d3f8122a97688e390915961029f2/mail/locales/en-US/chrome/messenger/am-identity-edit.dtd">file</a> |
<a href="/comm-central/annotate/d2c25fee0909d3f8122a97688e390915961029f2/mail/locales/en-US/chrome/messenger/am-identity-edit.dtd">annotate</a> |
<a href="/comm-central/diff/d2c25fee0909d3f8122a97688e390915961029f2/mail/locales/en-US/chrome/messenger/am-identity-edit.dtd">diff</a> |
<a href="/comm-central/comparison/d2c25fee0909d3f8122a97688e390915961029f2/mail/locales/en-US/chrome/messenger/am-identity-edit.dtd">comparison</a> |
<a href="/comm-central/log/d2c25fee0909d3f8122a97688e390915961029f2/mail/locales/en-US/chrome/messenger/am-identity-edit.dtd">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/d2c25fee0909d3f8122a97688e390915961029f2/mail/test/mozmill/composition/test-newmsg-compose-identity.js">mail/test/mozmill/composition/test-newmsg-compose-identity.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/d2c25fee0909d3f8122a97688e390915961029f2/mail/test/mozmill/composition/test-newmsg-compose-identity.js">file</a> |
<a href="/comm-central/annotate/d2c25fee0909d3f8122a97688e390915961029f2/mail/test/mozmill/composition/test-newmsg-compose-identity.js">annotate</a> |
<a href="/comm-central/diff/d2c25fee0909d3f8122a97688e390915961029f2/mail/test/mozmill/composition/test-newmsg-compose-identity.js">diff</a> |
<a href="/comm-central/comparison/d2c25fee0909d3f8122a97688e390915961029f2/mail/test/mozmill/composition/test-newmsg-compose-identity.js">comparison</a> |
<a href="/comm-central/log/d2c25fee0909d3f8122a97688e390915961029f2/mail/test/mozmill/composition/test-newmsg-compose-identity.js">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/d2c25fee0909d3f8122a97688e390915961029f2/mailnews/base/prefs/content/am-identity-edit.js">mailnews/base/prefs/content/am-identity-edit.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/d2c25fee0909d3f8122a97688e390915961029f2/mailnews/base/prefs/content/am-identity-edit.js">file</a> |
<a href="/comm-central/annotate/d2c25fee0909d3f8122a97688e390915961029f2/mailnews/base/prefs/content/am-identity-edit.js">annotate</a> |
<a href="/comm-central/diff/d2c25fee0909d3f8122a97688e390915961029f2/mailnews/base/prefs/content/am-identity-edit.js">diff</a> |
<a href="/comm-central/comparison/d2c25fee0909d3f8122a97688e390915961029f2/mailnews/base/prefs/content/am-identity-edit.js">comparison</a> |
<a href="/comm-central/log/d2c25fee0909d3f8122a97688e390915961029f2/mailnews/base/prefs/content/am-identity-edit.js">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/d2c25fee0909d3f8122a97688e390915961029f2/mailnews/base/prefs/content/am-identity-edit.xul">mailnews/base/prefs/content/am-identity-edit.xul</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/d2c25fee0909d3f8122a97688e390915961029f2/mailnews/base/prefs/content/am-identity-edit.xul">file</a> |
<a href="/comm-central/annotate/d2c25fee0909d3f8122a97688e390915961029f2/mailnews/base/prefs/content/am-identity-edit.xul">annotate</a> |
<a href="/comm-central/diff/d2c25fee0909d3f8122a97688e390915961029f2/mailnews/base/prefs/content/am-identity-edit.xul">diff</a> |
<a href="/comm-central/comparison/d2c25fee0909d3f8122a97688e390915961029f2/mailnews/base/prefs/content/am-identity-edit.xul">comparison</a> |
<a href="/comm-central/log/d2c25fee0909d3f8122a97688e390915961029f2/mailnews/base/prefs/content/am-identity-edit.xul">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/d2c25fee0909d3f8122a97688e390915961029f2/mailnews/base/public/nsIMsgIdentity.idl">mailnews/base/public/nsIMsgIdentity.idl</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/d2c25fee0909d3f8122a97688e390915961029f2/mailnews/base/public/nsIMsgIdentity.idl">file</a> |
<a href="/comm-central/annotate/d2c25fee0909d3f8122a97688e390915961029f2/mailnews/base/public/nsIMsgIdentity.idl">annotate</a> |
<a href="/comm-central/diff/d2c25fee0909d3f8122a97688e390915961029f2/mailnews/base/public/nsIMsgIdentity.idl">diff</a> |
<a href="/comm-central/comparison/d2c25fee0909d3f8122a97688e390915961029f2/mailnews/base/public/nsIMsgIdentity.idl">comparison</a> |
<a href="/comm-central/log/d2c25fee0909d3f8122a97688e390915961029f2/mailnews/base/public/nsIMsgIdentity.idl">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/d2c25fee0909d3f8122a97688e390915961029f2/mailnews/base/util/nsMsgIdentity.cpp">mailnews/base/util/nsMsgIdentity.cpp</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/d2c25fee0909d3f8122a97688e390915961029f2/mailnews/base/util/nsMsgIdentity.cpp">file</a> |
<a href="/comm-central/annotate/d2c25fee0909d3f8122a97688e390915961029f2/mailnews/base/util/nsMsgIdentity.cpp">annotate</a> |
<a href="/comm-central/diff/d2c25fee0909d3f8122a97688e390915961029f2/mailnews/base/util/nsMsgIdentity.cpp">diff</a> |
<a href="/comm-central/comparison/d2c25fee0909d3f8122a97688e390915961029f2/mailnews/base/util/nsMsgIdentity.cpp">comparison</a> |
<a href="/comm-central/log/d2c25fee0909d3f8122a97688e390915961029f2/mailnews/base/util/nsMsgIdentity.cpp">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/d2c25fee0909d3f8122a97688e390915961029f2/mailnews/import/becky/src/nsBeckySettings.cpp">mailnews/import/becky/src/nsBeckySettings.cpp</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/d2c25fee0909d3f8122a97688e390915961029f2/mailnews/import/becky/src/nsBeckySettings.cpp">file</a> |
<a href="/comm-central/annotate/d2c25fee0909d3f8122a97688e390915961029f2/mailnews/import/becky/src/nsBeckySettings.cpp">annotate</a> |
<a href="/comm-central/diff/d2c25fee0909d3f8122a97688e390915961029f2/mailnews/import/becky/src/nsBeckySettings.cpp">diff</a> |
<a href="/comm-central/comparison/d2c25fee0909d3f8122a97688e390915961029f2/mailnews/import/becky/src/nsBeckySettings.cpp">comparison</a> |
<a href="/comm-central/log/d2c25fee0909d3f8122a97688e390915961029f2/mailnews/import/becky/src/nsBeckySettings.cpp">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/d2c25fee0909d3f8122a97688e390915961029f2/mailnews/import/oexpress/nsOESettings.cpp">mailnews/import/oexpress/nsOESettings.cpp</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/d2c25fee0909d3f8122a97688e390915961029f2/mailnews/import/oexpress/nsOESettings.cpp">file</a> |
<a href="/comm-central/annotate/d2c25fee0909d3f8122a97688e390915961029f2/mailnews/import/oexpress/nsOESettings.cpp">annotate</a> |
<a href="/comm-central/diff/d2c25fee0909d3f8122a97688e390915961029f2/mailnews/import/oexpress/nsOESettings.cpp">diff</a> |
<a href="/comm-central/comparison/d2c25fee0909d3f8122a97688e390915961029f2/mailnews/import/oexpress/nsOESettings.cpp">comparison</a> |
<a href="/comm-central/log/d2c25fee0909d3f8122a97688e390915961029f2/mailnews/import/oexpress/nsOESettings.cpp">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/d2c25fee0909d3f8122a97688e390915961029f2/mailnews/import/outlook/src/nsOutlookCompose.cpp">mailnews/import/outlook/src/nsOutlookCompose.cpp</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/d2c25fee0909d3f8122a97688e390915961029f2/mailnews/import/outlook/src/nsOutlookCompose.cpp">file</a> |
<a href="/comm-central/annotate/d2c25fee0909d3f8122a97688e390915961029f2/mailnews/import/outlook/src/nsOutlookCompose.cpp">annotate</a> |
<a href="/comm-central/diff/d2c25fee0909d3f8122a97688e390915961029f2/mailnews/import/outlook/src/nsOutlookCompose.cpp">diff</a> |
<a href="/comm-central/comparison/d2c25fee0909d3f8122a97688e390915961029f2/mailnews/import/outlook/src/nsOutlookCompose.cpp">comparison</a> |
<a href="/comm-central/log/d2c25fee0909d3f8122a97688e390915961029f2/mailnews/import/outlook/src/nsOutlookCompose.cpp">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/d2c25fee0909d3f8122a97688e390915961029f2/mailnews/import/outlook/src/nsOutlookSettings.cpp">mailnews/import/outlook/src/nsOutlookSettings.cpp</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/d2c25fee0909d3f8122a97688e390915961029f2/mailnews/import/outlook/src/nsOutlookSettings.cpp">file</a> |
<a href="/comm-central/annotate/d2c25fee0909d3f8122a97688e390915961029f2/mailnews/import/outlook/src/nsOutlookSettings.cpp">annotate</a> |
<a href="/comm-central/diff/d2c25fee0909d3f8122a97688e390915961029f2/mailnews/import/outlook/src/nsOutlookSettings.cpp">diff</a> |
<a href="/comm-central/comparison/d2c25fee0909d3f8122a97688e390915961029f2/mailnews/import/outlook/src/nsOutlookSettings.cpp">comparison</a> |
<a href="/comm-central/log/d2c25fee0909d3f8122a97688e390915961029f2/mailnews/import/outlook/src/nsOutlookSettings.cpp">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/d2c25fee0909d3f8122a97688e390915961029f2/mailnews/import/winlivemail/nsWMSettings.cpp">mailnews/import/winlivemail/nsWMSettings.cpp</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/d2c25fee0909d3f8122a97688e390915961029f2/mailnews/import/winlivemail/nsWMSettings.cpp">file</a> |
<a href="/comm-central/annotate/d2c25fee0909d3f8122a97688e390915961029f2/mailnews/import/winlivemail/nsWMSettings.cpp">annotate</a> |
<a href="/comm-central/diff/d2c25fee0909d3f8122a97688e390915961029f2/mailnews/import/winlivemail/nsWMSettings.cpp">diff</a> |
<a href="/comm-central/comparison/d2c25fee0909d3f8122a97688e390915961029f2/mailnews/import/winlivemail/nsWMSettings.cpp">comparison</a> |
<a href="/comm-central/log/d2c25fee0909d3f8122a97688e390915961029f2/mailnews/import/winlivemail/nsWMSettings.cpp">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/d2c25fee0909d3f8122a97688e390915961029f2/suite/locales/en-US/chrome/mailnews/pref/am-identity-edit.dtd">suite/locales/en-US/chrome/mailnews/pref/am-identity-edit.dtd</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/d2c25fee0909d3f8122a97688e390915961029f2/suite/locales/en-US/chrome/mailnews/pref/am-identity-edit.dtd">file</a> |
<a href="/comm-central/annotate/d2c25fee0909d3f8122a97688e390915961029f2/suite/locales/en-US/chrome/mailnews/pref/am-identity-edit.dtd">annotate</a> |
<a href="/comm-central/diff/d2c25fee0909d3f8122a97688e390915961029f2/suite/locales/en-US/chrome/mailnews/pref/am-identity-edit.dtd">diff</a> |
<a href="/comm-central/comparison/d2c25fee0909d3f8122a97688e390915961029f2/suite/locales/en-US/chrome/mailnews/pref/am-identity-edit.dtd">comparison</a> |
<a href="/comm-central/log/d2c25fee0909d3f8122a97688e390915961029f2/suite/locales/en-US/chrome/mailnews/pref/am-identity-edit.dtd">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/d2c25fee0909d3f8122a97688e390915961029f2/suite/mailnews/compose/MsgComposeCommands.js">suite/mailnews/compose/MsgComposeCommands.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/d2c25fee0909d3f8122a97688e390915961029f2/suite/mailnews/compose/MsgComposeCommands.js">file</a> |
<a href="/comm-central/annotate/d2c25fee0909d3f8122a97688e390915961029f2/suite/mailnews/compose/MsgComposeCommands.js">annotate</a> |
<a href="/comm-central/diff/d2c25fee0909d3f8122a97688e390915961029f2/suite/mailnews/compose/MsgComposeCommands.js">diff</a> |
<a href="/comm-central/comparison/d2c25fee0909d3f8122a97688e390915961029f2/suite/mailnews/compose/MsgComposeCommands.js">comparison</a> |
<a href="/comm-central/log/d2c25fee0909d3f8122a97688e390915961029f2/suite/mailnews/compose/MsgComposeCommands.js">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/d2c25fee0909d3f8122a97688e390915961029f2/suite/mailnews/compose/addressingWidgetOverlay.js">suite/mailnews/compose/addressingWidgetOverlay.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/d2c25fee0909d3f8122a97688e390915961029f2/suite/mailnews/compose/addressingWidgetOverlay.js">file</a> |
<a href="/comm-central/annotate/d2c25fee0909d3f8122a97688e390915961029f2/suite/mailnews/compose/addressingWidgetOverlay.js">annotate</a> |
<a href="/comm-central/diff/d2c25fee0909d3f8122a97688e390915961029f2/suite/mailnews/compose/addressingWidgetOverlay.js">diff</a> |
<a href="/comm-central/comparison/d2c25fee0909d3f8122a97688e390915961029f2/suite/mailnews/compose/addressingWidgetOverlay.js">comparison</a> |
<a href="/comm-central/log/d2c25fee0909d3f8122a97688e390915961029f2/suite/mailnews/compose/addressingWidgetOverlay.js">revisions</a>
</td>
</tr>
</table></div>

<div class="page_body diffblocks"><div class="diffblock"><pre class="sourcelines">
<a href="#l1.1"></a><span id="l1.1" class="difflineminus">--- a/mail/components/compose/content/MsgComposeCommands.js</span>
<a href="#l1.2"></a><span id="l1.2" class="difflineplus">+++ b/mail/components/compose/content/MsgComposeCommands.js</span>
<a href="#l1.3"></a><span id="l1.3" class="difflineat">@@ -2497,19 +2497,19 @@ function ComposeStartup(aParams)</span>
<a href="#l1.4"></a><span id="l1.4">         gBodyFromArgs = true;</span>
<a href="#l1.5"></a><span id="l1.5">         composeFields.body = args.body;</span>
<a href="#l1.6"></a><span id="l1.6">       }</span>
<a href="#l1.7"></a><span id="l1.7">     }</span>
<a href="#l1.8"></a><span id="l1.8">   }</span>
<a href="#l1.9"></a><span id="l1.9"> </span>
<a href="#l1.10"></a><span id="l1.10">   gComposeType = params.type;</span>
<a href="#l1.11"></a><span id="l1.11"> </span>
<a href="#l1.12"></a><span id="l1.12" class="difflineminus">-  // &quot; &lt;&gt;&quot; is an empty identity, and most likely not valid</span>
<a href="#l1.13"></a><span id="l1.13" class="difflineminus">-  if (!params.identity || params.identity.identityName == &quot; &lt;&gt;&quot;) {</span>
<a href="#l1.14"></a><span id="l1.14" class="difflineminus">-    // no pre selected identity, so use the default account</span>
<a href="#l1.15"></a><span id="l1.15" class="difflineplus">+  // An identity with no email is likely not valid.</span>
<a href="#l1.16"></a><span id="l1.16" class="difflineplus">+  if (!params.identity || !params.identity.email) {</span>
<a href="#l1.17"></a><span id="l1.17" class="difflineplus">+    // No pre-selected identity, so use the default account.</span>
<a href="#l1.18"></a><span id="l1.18">     let identities = MailServices.accounts.defaultAccount.identities;</span>
<a href="#l1.19"></a><span id="l1.19">     if (identities.length == 0)</span>
<a href="#l1.20"></a><span id="l1.20">       identities = MailServices.accounts.allIdentities;</span>
<a href="#l1.21"></a><span id="l1.21">     params.identity = identities.queryElementAt(0, Components.interfaces.nsIMsgIdentity);</span>
<a href="#l1.22"></a><span id="l1.22">   }</span>
<a href="#l1.23"></a><span id="l1.23"> </span>
<a href="#l1.24"></a><span id="l1.24">   identityList.selectedItem =</span>
<a href="#l1.25"></a><span id="l1.25">     identityList.getElementsByAttribute(&quot;identitykey&quot;, params.identity.key)[0];</span>
<a href="#l1.26"></a><span id="l1.26" class="difflineat">@@ -3658,20 +3658,18 @@ function FillIdentityList(menulist)</span>
<a href="#l1.27"></a><span id="l1.27">         menulist.menupopup.appendChild(separator);</span>
<a href="#l1.28"></a><span id="l1.28">       }</span>
<a href="#l1.29"></a><span id="l1.29">       accountHadSeparator = needSeparator;</span>
<a href="#l1.30"></a><span id="l1.30">     }</span>
<a href="#l1.31"></a><span id="l1.31">     firstAccountWithIdentities = false;</span>
<a href="#l1.32"></a><span id="l1.32"> </span>
<a href="#l1.33"></a><span id="l1.33">     for (let i = 0; i &lt; identities.length; i++) {</span>
<a href="#l1.34"></a><span id="l1.34">       let identity = identities[i];</span>
<a href="#l1.35"></a><span id="l1.35" class="difflineminus">-      let address = MailServices.headerParser.makeMailboxObject(</span>
<a href="#l1.36"></a><span id="l1.36" class="difflineminus">-        identity.fullName, identity.email).toString();</span>
<a href="#l1.37"></a><span id="l1.37">       let item = menulist.appendItem(identity.identityName,</span>
<a href="#l1.38"></a><span id="l1.38" class="difflineminus">-                                     address,</span>
<a href="#l1.39"></a><span id="l1.39" class="difflineplus">+                                     identity.fullAddress,</span>
<a href="#l1.40"></a><span id="l1.40">                                      account.incomingServer.prettyName);</span>
<a href="#l1.41"></a><span id="l1.41">       item.setAttribute(&quot;identitykey&quot;, identity.key);</span>
<a href="#l1.42"></a><span id="l1.42">       item.setAttribute(&quot;accountkey&quot;, account.key);</span>
<a href="#l1.43"></a><span id="l1.43">       if (i == 0) {</span>
<a href="#l1.44"></a><span id="l1.44">         // Mark the first identity as default.</span>
<a href="#l1.45"></a><span id="l1.45">         item.setAttribute(&quot;default&quot;, &quot;true&quot;);</span>
<a href="#l1.46"></a><span id="l1.46">       }</span>
<a href="#l1.47"></a><span id="l1.47">     }</span>
<a href="#l1.48"></a><span id="l1.48" class="difflineat">@@ -4521,17 +4519,20 @@ function LoadIdentity(startup)</span>
<a href="#l1.49"></a><span id="l1.49">           event.initEvent('compose-from-changed', false, true);</span>
<a href="#l1.50"></a><span id="l1.50">           document.getElementById(&quot;msgcomposeWindow&quot;).dispatchEvent(event);</span>
<a href="#l1.51"></a><span id="l1.51">         }</span>
<a href="#l1.52"></a><span id="l1.52"> </span>
<a href="#l1.53"></a><span id="l1.53">       if (!startup) {</span>
<a href="#l1.54"></a><span id="l1.54">           if (getPref(&quot;mail.autoComplete.highlightNonMatches&quot;))</span>
<a href="#l1.55"></a><span id="l1.55">             document.getElementById('addressCol2#1').highlightNonMatches = true;</span>
<a href="#l1.56"></a><span id="l1.56"> </span>
<a href="#l1.57"></a><span id="l1.57" class="difflineminus">-          addRecipientsToIgnoreList(gCurrentIdentity.identityName);  // only do this if we aren't starting up....it gets done as part of startup already</span>
<a href="#l1.58"></a><span id="l1.58" class="difflineplus">+          // Only do this if we aren't starting up...</span>
<a href="#l1.59"></a><span id="l1.59" class="difflineplus">+          // It gets done as part of startup already.</span>
<a href="#l1.60"></a><span id="l1.60" class="difflineplus">+          addRecipientsToIgnoreList(gCurrentIdentity.fullAddress);</span>
<a href="#l1.61"></a><span id="l1.61" class="difflineplus">+</span>
<a href="#l1.62"></a><span id="l1.62">           // If the From field is editable, reset the address from the identity.</span>
<a href="#l1.63"></a><span id="l1.63">           if (identityElement.editable)</span>
<a href="#l1.64"></a><span id="l1.64">           {</span>
<a href="#l1.65"></a><span id="l1.65">             identityElement.value = identityElement.selectedItem.value;</span>
<a href="#l1.66"></a><span id="l1.66">             identityElement.inputField.placeholder = getComposeBundle().getFormattedString(&quot;msgIdentityPlaceholder&quot;, [identityElement.selectedItem.value]);</span>
<a href="#l1.67"></a><span id="l1.67">           }</span>
<a href="#l1.68"></a><span id="l1.68">       }</span>
<a href="#l1.69"></a><span id="l1.69">     }</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l2.1"></a><span id="l2.1" class="difflineminus">--- a/mail/components/compose/content/addressingWidgetOverlay.js</span>
<a href="#l2.2"></a><span id="l2.2" class="difflineplus">+++ b/mail/components/compose/content/addressingWidgetOverlay.js</span>
<a href="#l2.3"></a><span id="l2.3" class="difflineat">@@ -231,18 +231,19 @@ function CompFields2Recipients(msgCompFi</span>
<a href="#l2.4"></a><span id="l2.4">       awSetInputAndPopup(msgFollowupTo, &quot;addr_followup&quot;, newListBoxNode, templateNode);</span>
<a href="#l2.5"></a><span id="l2.5"> </span>
<a href="#l2.6"></a><span id="l2.6">     // If it's a new message, we need to add an extra empty recipient.</span>
<a href="#l2.7"></a><span id="l2.7">     if (!havePrimaryRecipient)</span>
<a href="#l2.8"></a><span id="l2.8">       _awSetInputAndPopup(&quot;&quot;, &quot;addr_to&quot;, newListBoxNode, templateNode);</span>
<a href="#l2.9"></a><span id="l2.9">     awFitDummyRows(2);</span>
<a href="#l2.10"></a><span id="l2.10"> </span>
<a href="#l2.11"></a><span id="l2.11">     // CompFields2Recipients is called whenever a user replies or edits an existing message. We want to</span>
<a href="#l2.12"></a><span id="l2.12" class="difflineminus">-    // add all of the recipients for this message to the ignore list for spell check</span>
<a href="#l2.13"></a><span id="l2.13" class="difflineminus">-    addRecipientsToIgnoreList((gCurrentIdentity ? gCurrentIdentity.identityName + ', ' : '') + msgTo + ', ' + msgCC + ', ' + msgBCC);</span>
<a href="#l2.14"></a><span id="l2.14" class="difflineplus">+    // add all of the non-empty recipients for this message to the ignore list for spell check</span>
<a href="#l2.15"></a><span id="l2.15" class="difflineplus">+    let currentAddress = gCurrentIdentity ? gCurrentIdentity.fullAddress : &quot;&quot;;</span>
<a href="#l2.16"></a><span id="l2.16" class="difflineplus">+    addRecipientsToIgnoreList([currentAddress,msgTo,msgCC,msgBCC].filter(adr =&gt; adr).join(&quot;, &quot;));</span>
<a href="#l2.17"></a><span id="l2.17">   }</span>
<a href="#l2.18"></a><span id="l2.18"> }</span>
<a href="#l2.19"></a><span id="l2.19"> </span>
<a href="#l2.20"></a><span id="l2.20"> function awSetInputAndPopupId(inputElem, popupElem, rowNumber)</span>
<a href="#l2.21"></a><span id="l2.21"> {</span>
<a href="#l2.22"></a><span id="l2.22">   popupElem.id = &quot;addressCol1#&quot; + rowNumber;</span>
<a href="#l2.23"></a><span id="l2.23">   inputElem.id = &quot;addressCol2#&quot; + rowNumber;</span>
<a href="#l2.24"></a><span id="l2.24">   inputElem.setAttribute(&quot;aria-labelledby&quot;, popupElem.id);</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l3.1"></a><span id="l3.1" class="difflineminus">--- a/mail/locales/en-US/chrome/messenger/am-identity-edit.dtd</span>
<a href="#l3.2"></a><span id="l3.2" class="difflineplus">+++ b/mail/locales/en-US/chrome/messenger/am-identity-edit.dtd</span>
<a href="#l3.3"></a><span id="l3.3" class="difflineat">@@ -6,8 +6,13 @@</span>
<a href="#l3.4"></a><span id="l3.4">      equal to the value of accountManager.size entity minus the value</span>
<a href="#l3.5"></a><span id="l3.5">      of accountTree.width entity. --&gt;</span>
<a href="#l3.6"></a><span id="l3.6"> &lt;!ENTITY identityDialog.style &quot;min-width: 75ch;&quot;&gt;</span>
<a href="#l3.7"></a><span id="l3.7"> &lt;!ENTITY identityListDesc.label &quot;Configure the settings for this identity:&quot;&gt;</span>
<a href="#l3.8"></a><span id="l3.8"> </span>
<a href="#l3.9"></a><span id="l3.9"> &lt;!ENTITY settingsTab.label       &quot;Settings&quot;&gt;</span>
<a href="#l3.10"></a><span id="l3.10"> &lt;!ENTITY copiesFoldersTab.label &quot;Copies &amp;amp; Folders&quot;&gt;</span>
<a href="#l3.11"></a><span id="l3.11"> &lt;!ENTITY addressingTab.label    &quot;Composition &amp;amp; Addressing&quot;&gt;</span>
<a href="#l3.12"></a><span id="l3.12" class="difflineplus">+</span>
<a href="#l3.13"></a><span id="l3.13" class="difflineplus">+&lt;!ENTITY publicData.label        &quot;Public Data&quot;&gt;</span>
<a href="#l3.14"></a><span id="l3.14" class="difflineplus">+&lt;!ENTITY privateData.label       &quot;Private Data&quot;&gt;</span>
<a href="#l3.15"></a><span id="l3.15" class="difflineplus">+&lt;!ENTITY identityAlias.label     &quot;Identity Label:&quot;&gt;</span>
<a href="#l3.16"></a><span id="l3.16" class="difflineplus">+&lt;!ENTITY identityAlias.accesskey &quot;b&quot;&gt;</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l4.1"></a><span id="l4.1" class="difflineminus">--- a/mail/test/mozmill/composition/test-newmsg-compose-identity.js</span>
<a href="#l4.2"></a><span id="l4.2" class="difflineplus">+++ b/mail/test/mozmill/composition/test-newmsg-compose-identity.js</span>
<a href="#l4.3"></a><span id="l4.3" class="difflineat">@@ -20,16 +20,21 @@ var gDrafts;</span>
<a href="#l4.4"></a><span id="l4.4"> var account;</span>
<a href="#l4.5"></a><span id="l4.5"> </span>
<a href="#l4.6"></a><span id="l4.6"> var identityKey1;</span>
<a href="#l4.7"></a><span id="l4.7"> var identity1Email = &quot;x@example.invalid&quot;;</span>
<a href="#l4.8"></a><span id="l4.8"> var identityKey2;</span>
<a href="#l4.9"></a><span id="l4.9"> var identity2Email = &quot;y@example.invalid&quot;;</span>
<a href="#l4.10"></a><span id="l4.10"> var identity2Name = &quot;User Y&quot;;</span>
<a href="#l4.11"></a><span id="l4.11"> var identity2From = identity2Name + &quot; &lt;&quot; + identity2Email + &quot;&gt;&quot;;</span>
<a href="#l4.12"></a><span id="l4.12" class="difflineplus">+var identityKey3;</span>
<a href="#l4.13"></a><span id="l4.13" class="difflineplus">+var identity3Email = &quot;z@example.invalid&quot;;</span>
<a href="#l4.14"></a><span id="l4.14" class="difflineplus">+var identity3Name = &quot;User Z&quot;;</span>
<a href="#l4.15"></a><span id="l4.15" class="difflineplus">+var identity3Label = &quot;Label Z&quot;;</span>
<a href="#l4.16"></a><span id="l4.16" class="difflineplus">+var identityKey4;</span>
<a href="#l4.17"></a><span id="l4.17"> </span>
<a href="#l4.18"></a><span id="l4.18"> function setupModule(module) {</span>
<a href="#l4.19"></a><span id="l4.19">   for (let lib of MODULE_REQUIRES) {</span>
<a href="#l4.20"></a><span id="l4.20">     collector.getModule(lib).installInto(module);</span>
<a href="#l4.21"></a><span id="l4.21">   }</span>
<a href="#l4.22"></a><span id="l4.22"> </span>
<a href="#l4.23"></a><span id="l4.23">   // Now set up an account with some identities.</span>
<a href="#l4.24"></a><span id="l4.24">   let acctMgr = MailServices.accounts;</span>
<a href="#l4.25"></a><span id="l4.25" class="difflineat">@@ -43,16 +48,28 @@ function setupModule(module) {</span>
<a href="#l4.26"></a><span id="l4.26">   identityKey1 = identity1.key;</span>
<a href="#l4.27"></a><span id="l4.27"> </span>
<a href="#l4.28"></a><span id="l4.28">   let identity2 = acctMgr.createIdentity();</span>
<a href="#l4.29"></a><span id="l4.29">   identity2.email = identity2Email;</span>
<a href="#l4.30"></a><span id="l4.30">   identity2.fullName = identity2Name;</span>
<a href="#l4.31"></a><span id="l4.31">   account.addIdentity(identity2);</span>
<a href="#l4.32"></a><span id="l4.32">   identityKey2 = identity2.key;</span>
<a href="#l4.33"></a><span id="l4.33"> </span>
<a href="#l4.34"></a><span id="l4.34" class="difflineplus">+  let identity3 = acctMgr.createIdentity();</span>
<a href="#l4.35"></a><span id="l4.35" class="difflineplus">+  identity3.email = identity3Email;</span>
<a href="#l4.36"></a><span id="l4.36" class="difflineplus">+  identity3.fullName = identity3Name;</span>
<a href="#l4.37"></a><span id="l4.37" class="difflineplus">+  identity3.label = identity3Label;</span>
<a href="#l4.38"></a><span id="l4.38" class="difflineplus">+  account.addIdentity(identity3);</span>
<a href="#l4.39"></a><span id="l4.39" class="difflineplus">+  identityKey3 = identity3.key;</span>
<a href="#l4.40"></a><span id="l4.40" class="difflineplus">+</span>
<a href="#l4.41"></a><span id="l4.41" class="difflineplus">+  // Identity with no data.</span>
<a href="#l4.42"></a><span id="l4.42" class="difflineplus">+  let identity4 = acctMgr.createIdentity();</span>
<a href="#l4.43"></a><span id="l4.43" class="difflineplus">+  account.addIdentity(identity4);</span>
<a href="#l4.44"></a><span id="l4.44" class="difflineplus">+  identityKey4 = identity4.key;</span>
<a href="#l4.45"></a><span id="l4.45" class="difflineplus">+</span>
<a href="#l4.46"></a><span id="l4.46">   gInbox = account.incomingServer.rootFolder</span>
<a href="#l4.47"></a><span id="l4.47">                   .getFolderWithFlags(Ci.nsMsgFolderFlags.Inbox);</span>
<a href="#l4.48"></a><span id="l4.48">   gDrafts = get_special_folder(Ci.nsMsgFolderFlags.Drafts, true);</span>
<a href="#l4.49"></a><span id="l4.49"> }</span>
<a href="#l4.50"></a><span id="l4.50"> </span>
<a href="#l4.51"></a><span id="l4.51"> /**</span>
<a href="#l4.52"></a><span id="l4.52">  * Helper to check that a suitable From identity was set up in the given</span>
<a href="#l4.53"></a><span id="l4.53">  * composer window.</span>
<a href="#l4.54"></a><span id="l4.54" class="difflineat">@@ -93,17 +110,17 @@ function test_compose_from_composer() {</span>
<a href="#l4.55"></a><span id="l4.55">   // Compose a new message from the compose window.</span>
<a href="#l4.56"></a><span id="l4.56">   plan_for_new_window(&quot;msgcompose&quot;);</span>
<a href="#l4.57"></a><span id="l4.57">   mainCompWin.keypress(null, &quot;n&quot;, {shiftKey: false, accelKey: true});</span>
<a href="#l4.58"></a><span id="l4.58">   let newCompWin = wait_for_compose_window();</span>
<a href="#l4.59"></a><span id="l4.59">   checkCompIdentity(newCompWin, account.defaultIdentity.key);</span>
<a href="#l4.60"></a><span id="l4.60">   close_compose_window(newCompWin);</span>
<a href="#l4.61"></a><span id="l4.61"> </span>
<a href="#l4.62"></a><span id="l4.62">   // Switch to identity2 in the main compose window, new compose windows</span>
<a href="#l4.63"></a><span id="l4.63" class="difflineminus">-  // starting from here should use the same identiy as its &quot;parent&quot;.</span>
<a href="#l4.64"></a><span id="l4.64" class="difflineplus">+  // starting from here should use the same identity as its &quot;parent&quot;.</span>
<a href="#l4.65"></a><span id="l4.65">   let identityList = mainCompWin.e(&quot;msgIdentity&quot;);</span>
<a href="#l4.66"></a><span id="l4.66">   identityList.selectedIndex++;</span>
<a href="#l4.67"></a><span id="l4.67">   mainCompWin.click_menus_in_sequence(mainCompWin.e(&quot;msgIdentityPopup&quot;),</span>
<a href="#l4.68"></a><span id="l4.68">                                       [ { identitykey: identityKey2 } ]);</span>
<a href="#l4.69"></a><span id="l4.69">   checkCompIdentity(mainCompWin, identityKey2);</span>
<a href="#l4.70"></a><span id="l4.70"> </span>
<a href="#l4.71"></a><span id="l4.71">   // Compose a second new message from the compose window.</span>
<a href="#l4.72"></a><span id="l4.72">   plan_for_new_window(&quot;msgcompose&quot;);</span>
<a href="#l4.73"></a><span id="l4.73" class="difflineat">@@ -120,17 +137,17 @@ function test_compose_from_composer() {</span>
<a href="#l4.74"></a><span id="l4.74">  * Bug 87987</span>
<a href="#l4.75"></a><span id="l4.75">  * Test editing the identity email/name for the current composition.</span>
<a href="#l4.76"></a><span id="l4.76">  */</span>
<a href="#l4.77"></a><span id="l4.77"> function test_editing_identity() {</span>
<a href="#l4.78"></a><span id="l4.78">   Services.prefs.setBoolPref(&quot;mail.compose.warned_about_customize_from&quot;, true);</span>
<a href="#l4.79"></a><span id="l4.79">   be_in_folder(gInbox);</span>
<a href="#l4.80"></a><span id="l4.80"> </span>
<a href="#l4.81"></a><span id="l4.81">   let compWin = open_compose_new_mail();</span>
<a href="#l4.82"></a><span id="l4.82" class="difflineminus">-  checkCompIdentity(compWin, account.defaultIdentity.key, &quot; &lt;&quot; + identity1Email + &quot;&gt;&quot;);</span>
<a href="#l4.83"></a><span id="l4.83" class="difflineplus">+  checkCompIdentity(compWin, account.defaultIdentity.key, identity1Email);</span>
<a href="#l4.84"></a><span id="l4.84"> </span>
<a href="#l4.85"></a><span id="l4.85">   // Input custom identity data into the From field.</span>
<a href="#l4.86"></a><span id="l4.86">   let customName = &quot;custom&quot;;</span>
<a href="#l4.87"></a><span id="l4.87">   let customEmail = &quot;custom@edited.invalid&quot;;</span>
<a href="#l4.88"></a><span id="l4.88">   let identityCustom = customName + &quot; &lt;&quot; + customEmail + &quot;&gt;&quot;;</span>
<a href="#l4.89"></a><span id="l4.89"> </span>
<a href="#l4.90"></a><span id="l4.90">   compWin.click_menus_in_sequence(compWin.e(&quot;msgIdentityPopup&quot;),</span>
<a href="#l4.91"></a><span id="l4.91">                                   [ { command: &quot;cmd_customizeFromAddress&quot; } ]);</span>
<a href="#l4.92"></a><span id="l4.92" class="difflineat">@@ -158,15 +175,58 @@ function test_editing_identity() {</span>
<a href="#l4.93"></a><span id="l4.93">   let curMessage = select_click_row(0);</span>
<a href="#l4.94"></a><span id="l4.94">   assert_equals(curMessage.author, identityCustom);</span>
<a href="#l4.95"></a><span id="l4.95">   // Remove the saved draft.</span>
<a href="#l4.96"></a><span id="l4.96">   press_delete(mc);</span>
<a href="#l4.97"></a><span id="l4.97">   */</span>
<a href="#l4.98"></a><span id="l4.98">   Services.prefs.setBoolPref(&quot;mail.compose.warned_about_customize_from&quot;, false);</span>
<a href="#l4.99"></a><span id="l4.99"> }</span>
<a href="#l4.100"></a><span id="l4.100"> </span>
<a href="#l4.101"></a><span id="l4.101" class="difflineplus">+/**</span>
<a href="#l4.102"></a><span id="l4.102" class="difflineplus">+ * Bug 318495</span>
<a href="#l4.103"></a><span id="l4.103" class="difflineplus">+ * Test how an identity displays and behaves in the compose window.</span>
<a href="#l4.104"></a><span id="l4.104" class="difflineplus">+ */</span>
<a href="#l4.105"></a><span id="l4.105" class="difflineplus">+function test_display_of_identities() {</span>
<a href="#l4.106"></a><span id="l4.106" class="difflineplus">+  be_in_folder(gInbox);</span>
<a href="#l4.107"></a><span id="l4.107" class="difflineplus">+</span>
<a href="#l4.108"></a><span id="l4.108" class="difflineplus">+  let cwc = open_compose_new_mail();</span>
<a href="#l4.109"></a><span id="l4.109" class="difflineplus">+  checkCompIdentity(cwc, account.defaultIdentity.key, identity1Email);</span>
<a href="#l4.110"></a><span id="l4.110" class="difflineplus">+</span>
<a href="#l4.111"></a><span id="l4.111" class="difflineplus">+  cwc.click(cwc.eid(&quot;msgIdentity&quot;));</span>
<a href="#l4.112"></a><span id="l4.112" class="difflineplus">+  cwc.click_menus_in_sequence(cwc.e(&quot;msgIdentityPopup&quot;),</span>
<a href="#l4.113"></a><span id="l4.113" class="difflineplus">+                              [ { identitykey: identityKey2 } ]);</span>
<a href="#l4.114"></a><span id="l4.114" class="difflineplus">+  checkCompIdentity(cwc, identityKey2, identity2From, identity2From);</span>
<a href="#l4.115"></a><span id="l4.115" class="difflineplus">+</span>
<a href="#l4.116"></a><span id="l4.116" class="difflineplus">+  cwc.click(cwc.eid(&quot;msgIdentity&quot;));</span>
<a href="#l4.117"></a><span id="l4.117" class="difflineplus">+  cwc.click_menus_in_sequence(cwc.e(&quot;msgIdentityPopup&quot;),</span>
<a href="#l4.118"></a><span id="l4.118" class="difflineplus">+                              [ { identitykey: identityKey4 } ]);</span>
<a href="#l4.119"></a><span id="l4.119" class="difflineplus">+  checkCompIdentity(cwc, identityKey4, &quot;[nsIMsgIdentity: &quot; + identityKey4 + &quot;]&quot;);</span>
<a href="#l4.120"></a><span id="l4.120" class="difflineplus">+</span>
<a href="#l4.121"></a><span id="l4.121" class="difflineplus">+  cwc.click(cwc.eid(&quot;msgIdentity&quot;));</span>
<a href="#l4.122"></a><span id="l4.122" class="difflineplus">+  cwc.click_menus_in_sequence(cwc.e(&quot;msgIdentityPopup&quot;),</span>
<a href="#l4.123"></a><span id="l4.123" class="difflineplus">+                              [ { identitykey: identityKey3 } ]);</span>
<a href="#l4.124"></a><span id="l4.124" class="difflineplus">+  let identity3From = identity3Name + &quot; &lt;&quot; + identity3Email + &quot;&gt;&quot;;</span>
<a href="#l4.125"></a><span id="l4.125" class="difflineplus">+  checkCompIdentity(cwc, identityKey3,</span>
<a href="#l4.126"></a><span id="l4.126" class="difflineplus">+                    identity3From + &quot; (&quot; + identity3Label + &quot;)&quot;,</span>
<a href="#l4.127"></a><span id="l4.127" class="difflineplus">+                    identity3From);</span>
<a href="#l4.128"></a><span id="l4.128" class="difflineplus">+</span>
<a href="#l4.129"></a><span id="l4.129" class="difflineplus">+  // Bug 1152045, check that the email address from the selected identity</span>
<a href="#l4.130"></a><span id="l4.130" class="difflineplus">+  // is properly used for the From field in the created message.</span>
<a href="#l4.131"></a><span id="l4.131" class="difflineplus">+  cwc.window.SaveAsDraft();</span>
<a href="#l4.132"></a><span id="l4.132" class="difflineplus">+  close_compose_window(cwc);</span>
<a href="#l4.133"></a><span id="l4.133" class="difflineplus">+</span>
<a href="#l4.134"></a><span id="l4.134" class="difflineplus">+  be_in_folder(gDrafts);</span>
<a href="#l4.135"></a><span id="l4.135" class="difflineplus">+  let curMessage = select_click_row(0);</span>
<a href="#l4.136"></a><span id="l4.136" class="difflineplus">+  assert_equals(curMessage.author, identity3From);</span>
<a href="#l4.137"></a><span id="l4.137" class="difflineplus">+  // Remove the saved draft.</span>
<a href="#l4.138"></a><span id="l4.138" class="difflineplus">+  press_delete(mc);</span>
<a href="#l4.139"></a><span id="l4.139" class="difflineplus">+}</span>
<a href="#l4.140"></a><span id="l4.140" class="difflineplus">+</span>
<a href="#l4.141"></a><span id="l4.141"> function teardownModule(module) {</span>
<a href="#l4.142"></a><span id="l4.142">   account.removeIdentity(MailServices.accounts.getIdentity(identityKey1));</span>
<a href="#l4.143"></a><span id="l4.143" class="difflineplus">+  account.removeIdentity(MailServices.accounts.getIdentity(identityKey2));</span>
<a href="#l4.144"></a><span id="l4.144" class="difflineplus">+  account.removeIdentity(MailServices.accounts.getIdentity(identityKey3));</span>
<a href="#l4.145"></a><span id="l4.145" class="difflineplus">+</span>
<a href="#l4.146"></a><span id="l4.146">   // The last identity of an account can't be removed so clear all its prefs</span>
<a href="#l4.147"></a><span id="l4.147">   // which effectively destroys it.</span>
<a href="#l4.148"></a><span id="l4.148" class="difflineminus">-  MailServices.accounts.getIdentity(identityKey2).clearAllValues();</span>
<a href="#l4.149"></a><span id="l4.149" class="difflineplus">+  MailServices.accounts.getIdentity(identityKey4).clearAllValues();</span>
<a href="#l4.150"></a><span id="l4.150">   MailServices.accounts.removeAccount(account);</span>
<a href="#l4.151"></a><span id="l4.151"> }</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l5.1"></a><span id="l5.1" class="difflineminus">--- a/mailnews/base/prefs/content/am-identity-edit.js</span>
<a href="#l5.2"></a><span id="l5.2" class="difflineplus">+++ b/mailnews/base/prefs/content/am-identity-edit.js</span>
<a href="#l5.3"></a><span id="l5.3" class="difflineat">@@ -64,16 +64,21 @@ function initIdentityValues(identity)</span>
<a href="#l5.4"></a><span id="l5.4">     document.getElementById('identity.htmlSigFormat').checked = identity.htmlSigFormat;</span>
<a href="#l5.5"></a><span id="l5.5"> </span>
<a href="#l5.6"></a><span id="l5.6">     if (identity.signature)</span>
<a href="#l5.7"></a><span id="l5.7">       document.getElementById('identity.signature').value = identity.signature.path;</span>
<a href="#l5.8"></a><span id="l5.8"> </span>
<a href="#l5.9"></a><span id="l5.9">     document.getElementById('identity.attachVCard').checked = identity.attachVCard;</span>
<a href="#l5.10"></a><span id="l5.10">     document.getElementById('identity.escapedVCard').value = identity.escapedVCard;</span>
<a href="#l5.11"></a><span id="l5.11">     initSmtpServer(identity.smtpServerKey);</span>
<a href="#l5.12"></a><span id="l5.12" class="difflineplus">+</span>
<a href="#l5.13"></a><span id="l5.13" class="difflineplus">+    // This field does not exist for the default identity shown in the am-main.xul pane.</span>
<a href="#l5.14"></a><span id="l5.14" class="difflineplus">+    let idLabel = document.getElementById(&quot;identity.label&quot;);</span>
<a href="#l5.15"></a><span id="l5.15" class="difflineplus">+    if (idLabel)</span>
<a href="#l5.16"></a><span id="l5.16" class="difflineplus">+      idLabel.value = identity.label;</span>
<a href="#l5.17"></a><span id="l5.17">   }</span>
<a href="#l5.18"></a><span id="l5.18">   else</span>
<a href="#l5.19"></a><span id="l5.19">   {</span>
<a href="#l5.20"></a><span id="l5.20">     // We're adding an identity, use the best default we have.</span>
<a href="#l5.21"></a><span id="l5.21">     initSmtpServer(gAccount.defaultIdentity.smtpServerKey);</span>
<a href="#l5.22"></a><span id="l5.22">   }</span>
<a href="#l5.23"></a><span id="l5.23"> </span>
<a href="#l5.24"></a><span id="l5.24">   setupSignatureItems();</span>
<a href="#l5.25"></a><span id="l5.25" class="difflineat">@@ -182,16 +187,19 @@ function validEmailAddress()</span>
<a href="#l5.26"></a><span id="l5.26"> </span>
<a href="#l5.27"></a><span id="l5.27">   return true;</span>
<a href="#l5.28"></a><span id="l5.28"> }</span>
<a href="#l5.29"></a><span id="l5.29"> </span>
<a href="#l5.30"></a><span id="l5.30"> function saveIdentitySettings(identity)</span>
<a href="#l5.31"></a><span id="l5.31"> {</span>
<a href="#l5.32"></a><span id="l5.32">   if (identity)</span>
<a href="#l5.33"></a><span id="l5.33">   {</span>
<a href="#l5.34"></a><span id="l5.34" class="difflineplus">+    let idLabel = document.getElementById('identity.label');</span>
<a href="#l5.35"></a><span id="l5.35" class="difflineplus">+    if (idLabel)</span>
<a href="#l5.36"></a><span id="l5.36" class="difflineplus">+      identity.label = idLabel.value;</span>
<a href="#l5.37"></a><span id="l5.37">     identity.fullName = document.getElementById('identity.fullName').value;</span>
<a href="#l5.38"></a><span id="l5.38">     identity.email = document.getElementById('identity.email').value;</span>
<a href="#l5.39"></a><span id="l5.39">     identity.replyTo = document.getElementById('identity.replyTo').value;</span>
<a href="#l5.40"></a><span id="l5.40">     identity.organization = document.getElementById('identity.organization').value;</span>
<a href="#l5.41"></a><span id="l5.41">     identity.attachSignature = document.getElementById('identity.attachSignature').checked;</span>
<a href="#l5.42"></a><span id="l5.42">     identity.htmlSigText = document.getElementById('identity.htmlSigText').value;</span>
<a href="#l5.43"></a><span id="l5.43">     identity.htmlSigFormat = document.getElementById('identity.htmlSigFormat').checked;</span>
<a href="#l5.44"></a><span id="l5.44"> </span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l6.1"></a><span id="l6.1" class="difflineminus">--- a/mailnews/base/prefs/content/am-identity-edit.xul</span>
<a href="#l6.2"></a><span id="l6.2" class="difflineplus">+++ b/mailnews/base/prefs/content/am-identity-edit.xul</span>
<a href="#l6.3"></a><span id="l6.3" class="difflineat">@@ -43,16 +43,19 @@</span>
<a href="#l6.4"></a><span id="l6.4">       &lt;tab label=&quot;&amp;settingsTab.label;&quot;/&gt;</span>
<a href="#l6.5"></a><span id="l6.5">       &lt;tab label=&quot;&amp;copiesFoldersTab.label;&quot;/&gt;</span>
<a href="#l6.6"></a><span id="l6.6">       &lt;tab label=&quot;&amp;addressingTab.label;&quot;/&gt;</span>
<a href="#l6.7"></a><span id="l6.7">     &lt;/tabs&gt;</span>
<a href="#l6.8"></a><span id="l6.8"> </span>
<a href="#l6.9"></a><span id="l6.9">     &lt;tabpanels id=&quot;identityTabsPanels&quot; flex=&quot;1&quot;&gt;</span>
<a href="#l6.10"></a><span id="l6.10">       &lt;!-- Identity Settings Tab --&gt;</span>
<a href="#l6.11"></a><span id="l6.11">       &lt;vbox flex=&quot;1&quot; name=&quot;settings&quot;&gt;</span>
<a href="#l6.12"></a><span id="l6.12" class="difflineplus">+        &lt;groupbox&gt;</span>
<a href="#l6.13"></a><span id="l6.13" class="difflineplus">+          &lt;caption label=&quot;&amp;publicData.label;&quot;/&gt;</span>
<a href="#l6.14"></a><span id="l6.14" class="difflineplus">+</span>
<a href="#l6.15"></a><span id="l6.15">         &lt;grid&gt;</span>
<a href="#l6.16"></a><span id="l6.16">           &lt;columns&gt;</span>
<a href="#l6.17"></a><span id="l6.17">             &lt;column/&gt;</span>
<a href="#l6.18"></a><span id="l6.18">             &lt;column flex=&quot;1&quot;/&gt;</span>
<a href="#l6.19"></a><span id="l6.19">           &lt;/columns&gt;</span>
<a href="#l6.20"></a><span id="l6.20">           &lt;rows&gt;</span>
<a href="#l6.21"></a><span id="l6.21">             &lt;row align=&quot;center&quot;&gt;</span>
<a href="#l6.22"></a><span id="l6.22">               &lt;label value=&quot;&amp;name.label;&quot; control=&quot;identity.fullName&quot; accesskey=&quot;&amp;name.accesskey;&quot;/&gt;</span>
<a href="#l6.23"></a><span id="l6.23" class="difflineat">@@ -102,29 +105,45 @@</span>
<a href="#l6.24"></a><span id="l6.24">         &lt;hbox align=&quot;center&quot;&gt;</span>
<a href="#l6.25"></a><span id="l6.25">           &lt;checkbox id=&quot;identity.attachVCard&quot; label=&quot;&amp;attachVCard.label;&quot; flex=&quot;1&quot;</span>
<a href="#l6.26"></a><span id="l6.26">                     accesskey=&quot;&amp;attachVCard.accesskey;&quot;/&gt;</span>
<a href="#l6.27"></a><span id="l6.27">           &lt;button class=&quot;push&quot; name=&quot;editVCard&quot; label=&quot;&amp;editVCard.label;&quot;</span>
<a href="#l6.28"></a><span id="l6.28">                   accesskey=&quot;&amp;editVCard.accesskey;&quot;</span>
<a href="#l6.29"></a><span id="l6.29">                   oncommand=&quot;editVCard()&quot;/&gt;</span>
<a href="#l6.30"></a><span id="l6.30">           &lt;label hidden=&quot;true&quot; id=&quot;identity.escapedVCard&quot;/&gt;</span>
<a href="#l6.31"></a><span id="l6.31">         &lt;/hbox&gt;</span>
<a href="#l6.32"></a><span id="l6.32" class="difflineplus">+        &lt;/groupbox&gt;</span>
<a href="#l6.33"></a><span id="l6.33"> </span>
<a href="#l6.34"></a><span id="l6.34" class="difflineminus">-        &lt;separator class=&quot;thin&quot;/&gt;</span>
<a href="#l6.35"></a><span id="l6.35" class="difflineminus">-        &lt;hbox align=&quot;center&quot;&gt;</span>
<a href="#l6.36"></a><span id="l6.36" class="difflineminus">-          &lt;label value=&quot;&amp;smtpName.label;&quot; control=&quot;identity.smtpServerKey&quot;</span>
<a href="#l6.37"></a><span id="l6.37" class="difflineminus">-                 accesskey=&quot;&amp;smtpName.accesskey;&quot;/&gt;</span>
<a href="#l6.38"></a><span id="l6.38" class="difflineminus">-          &lt;menulist id=&quot;identity.smtpServerKey&quot; flex=&quot;1&quot;&gt;</span>
<a href="#l6.39"></a><span id="l6.39" class="difflineminus">-            &lt;menupopup id=&quot;smtpPopup&quot;&gt;</span>
<a href="#l6.40"></a><span id="l6.40" class="difflineminus">-              &lt;menuitem value=&quot;&quot; label=&quot;&amp;smtpDefaultServer.label;&quot; id=&quot;useDefaultItem&quot;/&gt;</span>
<a href="#l6.41"></a><span id="l6.41" class="difflineminus">-              &lt;menuseparator/&gt;</span>
<a href="#l6.42"></a><span id="l6.42" class="difflineminus">-              &lt;!-- list will be inserted here --&gt;</span>
<a href="#l6.43"></a><span id="l6.43" class="difflineminus">-            &lt;/menupopup&gt;</span>
<a href="#l6.44"></a><span id="l6.44" class="difflineminus">-          &lt;/menulist&gt;</span>
<a href="#l6.45"></a><span id="l6.45" class="difflineminus">-        &lt;/hbox&gt;</span>
<a href="#l6.46"></a><span id="l6.46" class="difflineplus">+        &lt;groupbox&gt;</span>
<a href="#l6.47"></a><span id="l6.47" class="difflineplus">+          &lt;caption label=&quot;&amp;privateData.label;&quot;/&gt;</span>
<a href="#l6.48"></a><span id="l6.48" class="difflineplus">+</span>
<a href="#l6.49"></a><span id="l6.49" class="difflineplus">+          &lt;hbox align=&quot;center&quot;&gt;</span>
<a href="#l6.50"></a><span id="l6.50" class="difflineplus">+            &lt;label value=&quot;&amp;smtpName.label;&quot;</span>
<a href="#l6.51"></a><span id="l6.51" class="difflineplus">+                   control=&quot;identity.smtpServerKey&quot;</span>
<a href="#l6.52"></a><span id="l6.52" class="difflineplus">+                   accesskey=&quot;&amp;smtpName.accesskey;&quot;/&gt;</span>
<a href="#l6.53"></a><span id="l6.53" class="difflineplus">+            &lt;menulist id=&quot;identity.smtpServerKey&quot; flex=&quot;1&quot;&gt;</span>
<a href="#l6.54"></a><span id="l6.54" class="difflineplus">+              &lt;menupopup id=&quot;smtpPopup&quot;&gt;</span>
<a href="#l6.55"></a><span id="l6.55" class="difflineplus">+                &lt;menuitem value=&quot;&quot;</span>
<a href="#l6.56"></a><span id="l6.56" class="difflineplus">+                          label=&quot;&amp;smtpDefaultServer.label;&quot;</span>
<a href="#l6.57"></a><span id="l6.57" class="difflineplus">+                          id=&quot;useDefaultItem&quot;/&gt;</span>
<a href="#l6.58"></a><span id="l6.58" class="difflineplus">+                &lt;menuseparator/&gt;</span>
<a href="#l6.59"></a><span id="l6.59" class="difflineplus">+                &lt;!-- list will be inserted here --&gt;</span>
<a href="#l6.60"></a><span id="l6.60" class="difflineplus">+              &lt;/menupopup&gt;</span>
<a href="#l6.61"></a><span id="l6.61" class="difflineplus">+            &lt;/menulist&gt;</span>
<a href="#l6.62"></a><span id="l6.62" class="difflineplus">+          &lt;/hbox&gt;</span>
<a href="#l6.63"></a><span id="l6.63" class="difflineplus">+</span>
<a href="#l6.64"></a><span id="l6.64" class="difflineplus">+          &lt;separator class=&quot;thin&quot;/&gt;</span>
<a href="#l6.65"></a><span id="l6.65" class="difflineplus">+</span>
<a href="#l6.66"></a><span id="l6.66" class="difflineplus">+          &lt;hbox align=&quot;center&quot;&gt;</span>
<a href="#l6.67"></a><span id="l6.67" class="difflineplus">+            &lt;label value=&quot;&amp;identityAlias.label;&quot;</span>
<a href="#l6.68"></a><span id="l6.68" class="difflineplus">+                   accesskey=&quot;&amp;identityAlias.accesskey;&quot;</span>
<a href="#l6.69"></a><span id="l6.69" class="difflineplus">+                   control=&quot;identity.label&quot;/&gt;</span>
<a href="#l6.70"></a><span id="l6.70" class="difflineplus">+            &lt;textbox id=&quot;identity.label&quot; flex=&quot;1&quot;/&gt;</span>
<a href="#l6.71"></a><span id="l6.71" class="difflineplus">+          &lt;/hbox&gt;</span>
<a href="#l6.72"></a><span id="l6.72" class="difflineplus">+        &lt;/groupbox&gt;</span>
<a href="#l6.73"></a><span id="l6.73"> </span>
<a href="#l6.74"></a><span id="l6.74">         &lt;spacer flex=&quot;1&quot;/&gt;</span>
<a href="#l6.75"></a><span id="l6.75">       &lt;/vbox&gt;</span>
<a href="#l6.76"></a><span id="l6.76"> </span>
<a href="#l6.77"></a><span id="l6.77">       &lt;!-- Copies &amp; Folders Tab --&gt;</span>
<a href="#l6.78"></a><span id="l6.78">       &lt;vbox flex=&quot;1&quot; name=&quot;copiesAndFolders&quot; id=&quot;copiesAndFolders&quot;/&gt;</span>
<a href="#l6.79"></a><span id="l6.79"> </span>
<a href="#l6.80"></a><span id="l6.80">       &lt;!-- Composition &amp; Addressing Tab --&gt;</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l7.1"></a><span id="l7.1" class="difflineminus">--- a/mailnews/base/public/nsIMsgIdentity.idl</span>
<a href="#l7.2"></a><span id="l7.2" class="difflineplus">+++ b/mailnews/base/public/nsIMsgIdentity.idl</span>
<a href="#l7.3"></a><span id="l7.3" class="difflineat">@@ -7,40 +7,51 @@</span>
<a href="#l7.4"></a><span id="l7.4"> #include &quot;nsIFile.idl&quot;</span>
<a href="#l7.5"></a><span id="l7.5"> </span>
<a href="#l7.6"></a><span id="l7.6"> /**</span>
<a href="#l7.7"></a><span id="l7.7">  * This interface contains all the personal outgoing mail information</span>
<a href="#l7.8"></a><span id="l7.8">  * for a given person.</span>
<a href="#l7.9"></a><span id="l7.9">  * Each identity is identified by a key, which is the &lt;id&gt; string in</span>
<a href="#l7.10"></a><span id="l7.10">  * the identity preferences, such as in mail.identity.&lt;id&gt;.replyTo.</span>
<a href="#l7.11"></a><span id="l7.11">  */</span>
<a href="#l7.12"></a><span id="l7.12" class="difflineminus">-[scriptable, uuid(4a769f39-f8c2-41e6-962a-175a33107578)]</span>
<a href="#l7.13"></a><span id="l7.13" class="difflineplus">+[scriptable, uuid(9dede9a0-f6fc-4afc-8fc9-a6af52414b3d)]</span>
<a href="#l7.14"></a><span id="l7.14"> interface nsIMsgIdentity : nsISupports {</span>
<a href="#l7.15"></a><span id="l7.15">   /**</span>
<a href="#l7.16"></a><span id="l7.16">    * Internal preferences ID.</span>
<a href="#l7.17"></a><span id="l7.17">    */</span>
<a href="#l7.18"></a><span id="l7.18">   attribute ACString key;</span>
<a href="#l7.19"></a><span id="l7.19"> </span>
<a href="#l7.20"></a><span id="l7.20">   /**</span>
<a href="#l7.21"></a><span id="l7.21" class="difflineminus">-   * Overriding display name for this identity. If this pref is not set</span>
<a href="#l7.22"></a><span id="l7.22" class="difflineminus">-   * then this will return some composed string from the fullname and email.</span>
<a href="#l7.23"></a><span id="l7.23" class="difflineplus">+   * Label describing this identity. May be empty.</span>
<a href="#l7.24"></a><span id="l7.24">    */</span>
<a href="#l7.25"></a><span id="l7.25" class="difflineminus">-  attribute AString identityName;</span>
<a href="#l7.26"></a><span id="l7.26" class="difflineplus">+  attribute AString label;</span>
<a href="#l7.27"></a><span id="l7.27" class="difflineplus">+</span>
<a href="#l7.28"></a><span id="l7.28" class="difflineplus">+  /**</span>
<a href="#l7.29"></a><span id="l7.29" class="difflineplus">+   * Pretty display name to identify this specific identity. Will return a</span>
<a href="#l7.30"></a><span id="l7.30" class="difflineplus">+   * composed string like &quot;fullname &lt;email&gt; (label)&quot;.</span>
<a href="#l7.31"></a><span id="l7.31" class="difflineplus">+   */</span>
<a href="#l7.32"></a><span id="l7.32" class="difflineplus">+  readonly attribute AString identityName;</span>
<a href="#l7.33"></a><span id="l7.33"> </span>
<a href="#l7.34"></a><span id="l7.34">   /**</span>
<a href="#l7.35"></a><span id="l7.35">    * User's full name, i.e. John Doe.</span>
<a href="#l7.36"></a><span id="l7.36">    */</span>
<a href="#l7.37"></a><span id="l7.37">   attribute AString fullName;</span>
<a href="#l7.38"></a><span id="l7.38"> </span>
<a href="#l7.39"></a><span id="l7.39">   /**</span>
<a href="#l7.40"></a><span id="l7.40">    * User's e-mail address, i.e. john@doe.com.</span>
<a href="#l7.41"></a><span id="l7.41">    */</span>
<a href="#l7.42"></a><span id="l7.42">   attribute ACString email;</span>
<a href="#l7.43"></a><span id="l7.43"> </span>
<a href="#l7.44"></a><span id="l7.44">   /**</span>
<a href="#l7.45"></a><span id="l7.45" class="difflineplus">+   * Formats fullName and email into the proper string to use as sender:</span>
<a href="#l7.46"></a><span id="l7.46" class="difflineplus">+   * name &lt;email&gt;</span>
<a href="#l7.47"></a><span id="l7.47" class="difflineplus">+   */</span>
<a href="#l7.48"></a><span id="l7.48" class="difflineplus">+  readonly attribute AString fullAddress;</span>
<a href="#l7.49"></a><span id="l7.49" class="difflineplus">+</span>
<a href="#l7.50"></a><span id="l7.50" class="difflineplus">+  /**</span>
<a href="#l7.51"></a><span id="l7.51">    * Optional replyTo address, i.e. johnNOSPAM@doe.com.</span>
<a href="#l7.52"></a><span id="l7.52">    */</span>
<a href="#l7.53"></a><span id="l7.53">   attribute AUTF8String replyTo;</span>
<a href="#l7.54"></a><span id="l7.54"> </span>
<a href="#l7.55"></a><span id="l7.55">   /**</span>
<a href="#l7.56"></a><span id="l7.56">    * Optional organization.</span>
<a href="#l7.57"></a><span id="l7.57">    */</span>
<a href="#l7.58"></a><span id="l7.58">   attribute AString organization;</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l8.1"></a><span id="l8.1" class="difflineminus">--- a/mailnews/base/util/nsMsgIdentity.cpp</span>
<a href="#l8.2"></a><span id="l8.2" class="difflineplus">+++ b/mailnews/base/util/nsMsgIdentity.cpp</span>
<a href="#l8.3"></a><span id="l8.3" class="difflineat">@@ -10,16 +10,17 @@</span>
<a href="#l8.4"></a><span id="l8.4"> #include &quot;nsMsgCompCID.h&quot;</span>
<a href="#l8.5"></a><span id="l8.5"> #include &quot;nsIRDFService.h&quot;</span>
<a href="#l8.6"></a><span id="l8.6"> #include &quot;nsIRDFResource.h&quot;</span>
<a href="#l8.7"></a><span id="l8.7"> #include &quot;nsRDFCID.h&quot;</span>
<a href="#l8.8"></a><span id="l8.8"> #include &quot;nsMsgFolderFlags.h&quot;</span>
<a href="#l8.9"></a><span id="l8.9"> #include &quot;nsIMsgFolder.h&quot;</span>
<a href="#l8.10"></a><span id="l8.10"> #include &quot;nsIMsgIncomingServer.h&quot;</span>
<a href="#l8.11"></a><span id="l8.11"> #include &quot;nsIMsgAccountManager.h&quot;</span>
<a href="#l8.12"></a><span id="l8.12" class="difflineplus">+#include &quot;mozilla/mailnews/MimeHeaderParser.h&quot;</span>
<a href="#l8.13"></a><span id="l8.13"> #include &quot;nsMsgBaseCID.h&quot;</span>
<a href="#l8.14"></a><span id="l8.14"> #include &quot;prprf.h&quot;</span>
<a href="#l8.15"></a><span id="l8.15"> #include &quot;nsISupportsPrimitives.h&quot;</span>
<a href="#l8.16"></a><span id="l8.16"> #include &quot;nsMsgUtils.h&quot;</span>
<a href="#l8.17"></a><span id="l8.17"> #include &quot;nsServiceManagerUtils.h&quot;</span>
<a href="#l8.18"></a><span id="l8.18"> #include &quot;nsComponentManagerUtils.h&quot;</span>
<a href="#l8.19"></a><span id="l8.19"> #include &quot;nsArrayUtils.h&quot;</span>
<a href="#l8.20"></a><span id="l8.20"> </span>
<a href="#l8.21"></a><span id="l8.21" class="difflineat">@@ -61,39 +62,55 @@ nsMsgIdentity::SetKey(const nsACString&amp; </span>
<a href="#l8.22"></a><span id="l8.22"> </span>
<a href="#l8.23"></a><span id="l8.23">   rv = prefs-&gt;GetBranch(&quot;mail.identity.default.&quot;, getter_AddRefs(mDefPrefBranch));</span>
<a href="#l8.24"></a><span id="l8.24">   return rv;</span>
<a href="#l8.25"></a><span id="l8.25"> }</span>
<a href="#l8.26"></a><span id="l8.26"> </span>
<a href="#l8.27"></a><span id="l8.27"> nsresult</span>
<a href="#l8.28"></a><span id="l8.28"> nsMsgIdentity::GetIdentityName(nsAString&amp; idName)</span>
<a href="#l8.29"></a><span id="l8.29"> {</span>
<a href="#l8.30"></a><span id="l8.30" class="difflineminus">-  nsresult rv = GetUnicharAttribute(&quot;identityName&quot;, idName);</span>
<a href="#l8.31"></a><span id="l8.31" class="difflineminus">-  if (NS_FAILED(rv)) return rv;</span>
<a href="#l8.32"></a><span id="l8.32" class="difflineminus">-</span>
<a href="#l8.33"></a><span id="l8.33" class="difflineminus">-  if (idName.IsEmpty()) {</span>
<a href="#l8.34"></a><span id="l8.34" class="difflineminus">-    nsString fullName;</span>
<a href="#l8.35"></a><span id="l8.35" class="difflineminus">-    rv = GetFullName(fullName);</span>
<a href="#l8.36"></a><span id="l8.36" class="difflineminus">-    if (NS_FAILED(rv)) return rv;</span>
<a href="#l8.37"></a><span id="l8.37" class="difflineplus">+  idName.AssignLiteral(&quot;&quot;);</span>
<a href="#l8.38"></a><span id="l8.38" class="difflineplus">+  // Try to use &quot;fullname &lt;email&gt;&quot; as the name.</span>
<a href="#l8.39"></a><span id="l8.39" class="difflineplus">+  nsresult rv = GetFullAddress(idName);</span>
<a href="#l8.40"></a><span id="l8.40" class="difflineplus">+  NS_ENSURE_SUCCESS(rv, rv);</span>
<a href="#l8.41"></a><span id="l8.41"> </span>
<a href="#l8.42"></a><span id="l8.42" class="difflineminus">-    nsCString email;</span>
<a href="#l8.43"></a><span id="l8.43" class="difflineminus">-    rv = GetEmail(email);</span>
<a href="#l8.44"></a><span id="l8.44" class="difflineminus">-    if (NS_FAILED(rv)) return rv;</span>
<a href="#l8.45"></a><span id="l8.45" class="difflineminus">-</span>
<a href="#l8.46"></a><span id="l8.46" class="difflineminus">-    idName.Assign(fullName);</span>
<a href="#l8.47"></a><span id="l8.47" class="difflineminus">-    idName.AppendLiteral(&quot; &lt;&quot;);</span>
<a href="#l8.48"></a><span id="l8.48" class="difflineminus">-    idName.Append(NS_ConvertASCIItoUTF16(email));</span>
<a href="#l8.49"></a><span id="l8.49" class="difflineminus">-    idName.AppendLiteral(&quot;&gt;&quot;);</span>
<a href="#l8.50"></a><span id="l8.50" class="difflineplus">+  // If a non-empty label exists, append it.</span>
<a href="#l8.51"></a><span id="l8.51" class="difflineplus">+  nsString label;</span>
<a href="#l8.52"></a><span id="l8.52" class="difflineplus">+  rv = GetLabel(label);</span>
<a href="#l8.53"></a><span id="l8.53" class="difflineplus">+  if (NS_SUCCEEDED(rv) &amp;&amp; !label.IsEmpty())</span>
<a href="#l8.54"></a><span id="l8.54" class="difflineplus">+  { // TODO: this should be localizable</span>
<a href="#l8.55"></a><span id="l8.55" class="difflineplus">+    idName.AppendLiteral(&quot; (&quot;);</span>
<a href="#l8.56"></a><span id="l8.56" class="difflineplus">+    idName.Append(label);</span>
<a href="#l8.57"></a><span id="l8.57" class="difflineplus">+    idName.AppendLiteral(&quot;)&quot;);</span>
<a href="#l8.58"></a><span id="l8.58">   }</span>
<a href="#l8.59"></a><span id="l8.59"> </span>
<a href="#l8.60"></a><span id="l8.60" class="difflineminus">-  return rv;</span>
<a href="#l8.61"></a><span id="l8.61" class="difflineplus">+  if (!idName.IsEmpty())</span>
<a href="#l8.62"></a><span id="l8.62" class="difflineplus">+    return NS_OK;</span>
<a href="#l8.63"></a><span id="l8.63" class="difflineplus">+</span>
<a href="#l8.64"></a><span id="l8.64" class="difflineplus">+  // If we still found nothing to use, use our key.</span>
<a href="#l8.65"></a><span id="l8.65" class="difflineplus">+  return ToString(idName);</span>
<a href="#l8.66"></a><span id="l8.66"> }</span>
<a href="#l8.67"></a><span id="l8.67"> </span>
<a href="#l8.68"></a><span id="l8.68" class="difflineminus">-nsresult nsMsgIdentity::SetIdentityName(const nsAString&amp; idName) {</span>
<a href="#l8.69"></a><span id="l8.69" class="difflineminus">-  return SetUnicharAttribute(&quot;identityName&quot;, idName);</span>
<a href="#l8.70"></a><span id="l8.70" class="difflineplus">+nsresult</span>
<a href="#l8.71"></a><span id="l8.71" class="difflineplus">+nsMsgIdentity::GetFullAddress(nsAString&amp; fullAddress)</span>
<a href="#l8.72"></a><span id="l8.72" class="difflineplus">+{</span>
<a href="#l8.73"></a><span id="l8.73" class="difflineplus">+  nsAutoString fullName;</span>
<a href="#l8.74"></a><span id="l8.74" class="difflineplus">+  nsresult rv = GetFullName(fullName);</span>
<a href="#l8.75"></a><span id="l8.75" class="difflineplus">+  NS_ENSURE_SUCCESS(rv, rv);</span>
<a href="#l8.76"></a><span id="l8.76" class="difflineplus">+</span>
<a href="#l8.77"></a><span id="l8.77" class="difflineplus">+  nsAutoCString email;</span>
<a href="#l8.78"></a><span id="l8.78" class="difflineplus">+  rv = GetEmail(email);</span>
<a href="#l8.79"></a><span id="l8.79" class="difflineplus">+  NS_ENSURE_SUCCESS(rv, rv);</span>
<a href="#l8.80"></a><span id="l8.80" class="difflineplus">+</span>
<a href="#l8.81"></a><span id="l8.81" class="difflineplus">+  if (fullName.IsEmpty() &amp;&amp; email.IsEmpty())</span>
<a href="#l8.82"></a><span id="l8.82" class="difflineplus">+    fullAddress.Truncate();</span>
<a href="#l8.83"></a><span id="l8.83" class="difflineplus">+  else</span>
<a href="#l8.84"></a><span id="l8.84" class="difflineplus">+    mozilla::mailnews::MakeMimeAddress(fullName, NS_ConvertASCIItoUTF16(email), fullAddress);</span>
<a href="#l8.85"></a><span id="l8.85" class="difflineplus">+</span>
<a href="#l8.86"></a><span id="l8.86" class="difflineplus">+  return NS_OK;</span>
<a href="#l8.87"></a><span id="l8.87"> }</span>
<a href="#l8.88"></a><span id="l8.88"> </span>
<a href="#l8.89"></a><span id="l8.89"> NS_IMETHODIMP</span>
<a href="#l8.90"></a><span id="l8.90"> nsMsgIdentity::ToString(nsAString&amp; aResult)</span>
<a href="#l8.91"></a><span id="l8.91"> {</span>
<a href="#l8.92"></a><span id="l8.92">   aResult.AssignLiteral(&quot;[nsIMsgIdentity: &quot;);</span>
<a href="#l8.93"></a><span id="l8.93">   aResult.Append(NS_ConvertASCIItoUTF16(mKey));</span>
<a href="#l8.94"></a><span id="l8.94">   aResult.AppendLiteral(&quot;]&quot;);</span>
<a href="#l8.95"></a><span id="l8.95" class="difflineat">@@ -132,16 +149,17 @@ nsMsgIdentity::ClearAllValues()</span>
<a href="#l8.96"></a><span id="l8.96"> </span>
<a href="#l8.97"></a><span id="l8.97">   return mPrefBranch-&gt;DeleteBranch(&quot;&quot;);</span>
<a href="#l8.98"></a><span id="l8.98"> }</span>
<a href="#l8.99"></a><span id="l8.99"> </span>
<a href="#l8.100"></a><span id="l8.100"> NS_IMPL_IDPREF_STR(EscapedVCard, &quot;escapedVCard&quot;)</span>
<a href="#l8.101"></a><span id="l8.101"> NS_IMPL_IDPREF_STR(SmtpServerKey, &quot;smtpServer&quot;)</span>
<a href="#l8.102"></a><span id="l8.102"> NS_IMPL_IDPREF_WSTR(FullName, &quot;fullName&quot;)</span>
<a href="#l8.103"></a><span id="l8.103"> NS_IMPL_IDPREF_STR(Email, &quot;useremail&quot;)</span>
<a href="#l8.104"></a><span id="l8.104" class="difflineplus">+NS_IMPL_IDPREF_WSTR(Label, &quot;label&quot;)</span>
<a href="#l8.105"></a><span id="l8.105"> NS_IMPL_IDPREF_STR(ReplyTo, &quot;reply_to&quot;)</span>
<a href="#l8.106"></a><span id="l8.106"> NS_IMPL_IDPREF_WSTR(Organization, &quot;organization&quot;)</span>
<a href="#l8.107"></a><span id="l8.107"> NS_IMPL_IDPREF_BOOL(ComposeHtml, &quot;compose_html&quot;)</span>
<a href="#l8.108"></a><span id="l8.108"> NS_IMPL_IDPREF_BOOL(AttachVCard, &quot;attach_vcard&quot;)</span>
<a href="#l8.109"></a><span id="l8.109"> NS_IMPL_IDPREF_BOOL(AttachSignature, &quot;attach_signature&quot;)</span>
<a href="#l8.110"></a><span id="l8.110"> NS_IMPL_IDPREF_WSTR(HtmlSigText, &quot;htmlSigText&quot;)</span>
<a href="#l8.111"></a><span id="l8.111"> NS_IMPL_IDPREF_BOOL(HtmlSigFormat, &quot;htmlSigFormat&quot;)</span>
<a href="#l8.112"></a><span id="l8.112"> </span>
<a href="#l8.113"></a><span id="l8.113" class="difflineat">@@ -565,16 +583,17 @@ NS_IMETHODIMP nsMsgIdentity::GetIntAttri</span>
<a href="#l8.114"></a><span id="l8.114"> </span>
<a href="#l8.115"></a><span id="l8.115"> NS_IMETHODIMP</span>
<a href="#l8.116"></a><span id="l8.116"> nsMsgIdentity::Copy(nsIMsgIdentity *identity)</span>
<a href="#l8.117"></a><span id="l8.117"> {</span>
<a href="#l8.118"></a><span id="l8.118">     NS_ENSURE_ARG_POINTER(identity);</span>
<a href="#l8.119"></a><span id="l8.119"> </span>
<a href="#l8.120"></a><span id="l8.120">     COPY_IDENTITY_BOOL_VALUE(identity,GetComposeHtml,SetComposeHtml)</span>
<a href="#l8.121"></a><span id="l8.121">     COPY_IDENTITY_STR_VALUE(identity,GetEmail,SetEmail)</span>
<a href="#l8.122"></a><span id="l8.122" class="difflineplus">+    COPY_IDENTITY_WSTR_VALUE(identity,GetLabel,SetLabel)</span>
<a href="#l8.123"></a><span id="l8.123">     COPY_IDENTITY_STR_VALUE(identity,GetReplyTo,SetReplyTo)</span>
<a href="#l8.124"></a><span id="l8.124">     COPY_IDENTITY_WSTR_VALUE(identity,GetFullName,SetFullName)</span>
<a href="#l8.125"></a><span id="l8.125">     COPY_IDENTITY_WSTR_VALUE(identity,GetOrganization,SetOrganization)</span>
<a href="#l8.126"></a><span id="l8.126">     COPY_IDENTITY_STR_VALUE(identity,GetDraftFolder,SetDraftFolder)</span>
<a href="#l8.127"></a><span id="l8.127">     COPY_IDENTITY_STR_VALUE(identity,GetArchiveFolder,SetArchiveFolder)</span>
<a href="#l8.128"></a><span id="l8.128">     COPY_IDENTITY_STR_VALUE(identity,GetFccFolder,SetFccFolder)</span>
<a href="#l8.129"></a><span id="l8.129">     COPY_IDENTITY_BOOL_VALUE(identity,GetFccReplyFollowsParent,</span>
<a href="#l8.130"></a><span id="l8.130">                              SetFccReplyFollowsParent)</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l9.1"></a><span id="l9.1" class="difflineminus">--- a/mailnews/import/becky/src/nsBeckySettings.cpp</span>
<a href="#l9.2"></a><span id="l9.2" class="difflineplus">+++ b/mailnews/import/becky/src/nsBeckySettings.cpp</span>
<a href="#l9.3"></a><span id="l9.3" class="difflineat">@@ -370,17 +370,17 @@ nsBeckySettings::CreateIdentity(nsIMsgId</span>
<a href="#l9.4"></a><span id="l9.4">   nsCOMPtr&lt;nsIMsgAccountManager&gt; accountManager =</span>
<a href="#l9.5"></a><span id="l9.5">     do_GetService(NS_MSGACCOUNTMANAGER_CONTRACTID, &amp;rv);</span>
<a href="#l9.6"></a><span id="l9.6">   NS_ENSURE_SUCCESS(rv, rv);</span>
<a href="#l9.7"></a><span id="l9.7"> </span>
<a href="#l9.8"></a><span id="l9.8">   nsCOMPtr&lt;nsIMsgIdentity&gt; identity;</span>
<a href="#l9.9"></a><span id="l9.9">   rv = accountManager-&gt;CreateIdentity(getter_AddRefs(identity));</span>
<a href="#l9.10"></a><span id="l9.10">   NS_ENSURE_SUCCESS(rv, rv);</span>
<a href="#l9.11"></a><span id="l9.11"> </span>
<a href="#l9.12"></a><span id="l9.12" class="difflineminus">-  identity-&gt;SetIdentityName(NS_ConvertUTF8toUTF16(identityName));</span>
<a href="#l9.13"></a><span id="l9.13" class="difflineplus">+  identity-&gt;SetLabel(NS_ConvertUTF8toUTF16(identityName));</span>
<a href="#l9.14"></a><span id="l9.14">   identity-&gt;SetFullName(NS_ConvertUTF8toUTF16(fullName));</span>
<a href="#l9.15"></a><span id="l9.15">   identity-&gt;SetEmail(email);</span>
<a href="#l9.16"></a><span id="l9.16">   if (!bccAddress.IsEmpty()) {</span>
<a href="#l9.17"></a><span id="l9.17">     identity-&gt;SetDoBcc(true);</span>
<a href="#l9.18"></a><span id="l9.18">     identity-&gt;SetDoBccList(bccAddress);</span>
<a href="#l9.19"></a><span id="l9.19">   }</span>
<a href="#l9.20"></a><span id="l9.20"> </span>
<a href="#l9.21"></a><span id="l9.21">   identity.forget(aIdentity);</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l10.1"></a><span id="l10.1" class="difflineminus">--- a/mailnews/import/oexpress/nsOESettings.cpp</span>
<a href="#l10.2"></a><span id="l10.2" class="difflineplus">+++ b/mailnews/import/oexpress/nsOESettings.cpp</span>
<a href="#l10.3"></a><span id="l10.3" class="difflineat">@@ -763,18 +763,16 @@ void OESettings::SetIdentities(nsIMsgAcc</span>
<a href="#l10.4"></a><span id="l10.4">                              orgName);</span>
<a href="#l10.5"></a><span id="l10.5"> </span>
<a href="#l10.6"></a><span id="l10.6">   nsCOMPtr&lt;nsIMsgIdentity&gt; id;</span>
<a href="#l10.7"></a><span id="l10.7">   rv = aMgr-&gt;CreateIdentity(getter_AddRefs(id));</span>
<a href="#l10.8"></a><span id="l10.8">   if (NS_FAILED(rv))</span>
<a href="#l10.9"></a><span id="l10.9">     return;</span>
<a href="#l10.10"></a><span id="l10.10"> </span>
<a href="#l10.11"></a><span id="l10.11">   id-&gt;SetFullName(name);</span>
<a href="#l10.12"></a><span id="l10.12" class="difflineminus">-  //BUG 470587. Don't set this: id-&gt;SetIdentityName(fullName);</span>
<a href="#l10.13"></a><span id="l10.13" class="difflineminus">-</span>
<a href="#l10.14"></a><span id="l10.14">   id-&gt;SetOrganization(orgName);</span>
<a href="#l10.15"></a><span id="l10.15"> </span>
<a href="#l10.16"></a><span id="l10.16">   nsAutoCString nativeEmail;</span>
<a href="#l10.17"></a><span id="l10.17">   NS_CopyUnicodeToNative(email, nativeEmail);</span>
<a href="#l10.18"></a><span id="l10.18">   id-&gt;SetEmail(nativeEmail);</span>
<a href="#l10.19"></a><span id="l10.19">   if (!reply.IsEmpty()) {</span>
<a href="#l10.20"></a><span id="l10.20">     nsAutoCString nativeReply;</span>
<a href="#l10.21"></a><span id="l10.21">     NS_CopyUnicodeToNative(reply, nativeReply);</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l11.1"></a><span id="l11.1" class="difflineminus">--- a/mailnews/import/outlook/src/nsOutlookCompose.cpp</span>
<a href="#l11.2"></a><span id="l11.2" class="difflineplus">+++ b/mailnews/import/outlook/src/nsOutlookCompose.cpp</span>
<a href="#l11.3"></a><span id="l11.3" class="difflineat">@@ -219,18 +219,17 @@ nsresult nsOutlookCompose::CreateIdentit</span>
<a href="#l11.4"></a><span id="l11.4">   nsCOMPtr&lt;nsIMsgAccountManager&gt; accMgr =</span>
<a href="#l11.5"></a><span id="l11.5">     do_GetService(NS_MSGACCOUNTMANAGER_CONTRACTID, &amp;rv);</span>
<a href="#l11.6"></a><span id="l11.6">   NS_ENSURE_SUCCESS(rv, rv);</span>
<a href="#l11.7"></a><span id="l11.7">   rv = accMgr-&gt;CreateIdentity(&amp;m_pIdentity);</span>
<a href="#l11.8"></a><span id="l11.8">   nsString name;</span>
<a href="#l11.9"></a><span id="l11.9">   name.AssignLiteral(&quot;Import Identity&quot;);</span>
<a href="#l11.10"></a><span id="l11.10">   if (m_pIdentity) {</span>
<a href="#l11.11"></a><span id="l11.11">     m_pIdentity-&gt;SetFullName(name);</span>
<a href="#l11.12"></a><span id="l11.12" class="difflineminus">-    m_pIdentity-&gt;SetIdentityName(name);</span>
<a href="#l11.13"></a><span id="l11.13" class="difflineminus">-    m_pIdentity-&gt;SetEmail(NS_LITERAL_CSTRING(&quot;import@import.service&quot;));</span>
<a href="#l11.14"></a><span id="l11.14" class="difflineplus">+    m_pIdentity-&gt;SetEmail(NS_LITERAL_CSTRING(&quot;import@service.invalid&quot;));</span>
<a href="#l11.15"></a><span id="l11.15">   }</span>
<a href="#l11.16"></a><span id="l11.16">   return rv;</span>
<a href="#l11.17"></a><span id="l11.17"> }</span>
<a href="#l11.18"></a><span id="l11.18"> </span>
<a href="#l11.19"></a><span id="l11.19"> void nsOutlookCompose::ReleaseIdentity()</span>
<a href="#l11.20"></a><span id="l11.20"> {</span>
<a href="#l11.21"></a><span id="l11.21">   NS_IF_RELEASE(m_pIdentity);</span>
<a href="#l11.22"></a><span id="l11.22"> }</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l12.1"></a><span id="l12.1" class="difflineminus">--- a/mailnews/import/outlook/src/nsOutlookSettings.cpp</span>
<a href="#l12.2"></a><span id="l12.2" class="difflineplus">+++ b/mailnews/import/outlook/src/nsOutlookSettings.cpp</span>
<a href="#l12.3"></a><span id="l12.3" class="difflineat">@@ -475,17 +475,16 @@ void OutlookSettings::SetIdentities(nsIM</span>
<a href="#l12.4"></a><span id="l12.4">   nsresult rv;</span>
<a href="#l12.5"></a><span id="l12.5">   nsCOMPtr&lt;nsIMsgIdentity&gt;  id;</span>
<a href="#l12.6"></a><span id="l12.6">   if (!email.IsEmpty() &amp;&amp; !name.IsEmpty() &amp;&amp; !server.IsEmpty()) {</span>
<a href="#l12.7"></a><span id="l12.7">     // The default identity, nor any other identities matched,</span>
<a href="#l12.8"></a><span id="l12.8">     // create a new one and add it to the account.</span>
<a href="#l12.9"></a><span id="l12.9">     rv = aMgr-&gt;CreateIdentity(getter_AddRefs(id));</span>
<a href="#l12.10"></a><span id="l12.10">     if (id) {</span>
<a href="#l12.11"></a><span id="l12.11">       id-&gt;SetFullName(name);</span>
<a href="#l12.12"></a><span id="l12.12" class="difflineminus">-      id-&gt;SetIdentityName(name);</span>
<a href="#l12.13"></a><span id="l12.13">       id-&gt;SetOrganization(orgName);</span>
<a href="#l12.14"></a><span id="l12.14"> </span>
<a href="#l12.15"></a><span id="l12.15">       nsAutoCString nativeEmail;</span>
<a href="#l12.16"></a><span id="l12.16">       NS_CopyUnicodeToNative(email, nativeEmail);</span>
<a href="#l12.17"></a><span id="l12.17">       id-&gt;SetEmail(nativeEmail);</span>
<a href="#l12.18"></a><span id="l12.18">       if (!reply.IsEmpty()) {</span>
<a href="#l12.19"></a><span id="l12.19">         nsAutoCString nativeReply;</span>
<a href="#l12.20"></a><span id="l12.20">         NS_CopyUnicodeToNative(reply, nativeReply);</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l13.1"></a><span id="l13.1" class="difflineminus">--- a/mailnews/import/winlivemail/nsWMSettings.cpp</span>
<a href="#l13.2"></a><span id="l13.2" class="difflineplus">+++ b/mailnews/import/winlivemail/nsWMSettings.cpp</span>
<a href="#l13.3"></a><span id="l13.3" class="difflineat">@@ -602,17 +602,16 @@ bool WMSettings::DoNNTPServer(nsIMsgAcco</span>
<a href="#l13.4"></a><span id="l13.4">   return result;</span>
<a href="#l13.5"></a><span id="l13.5"> }</span>
<a href="#l13.6"></a><span id="l13.6"> </span>
<a href="#l13.7"></a><span id="l13.7"> void WMSettings::SetIdentities(nsIMsgAccountManager *pMgr, nsIMsgAccount *pAcc,</span>
<a href="#l13.8"></a><span id="l13.8">                                nsIDOMDocument *xmlDoc, nsAutoString &amp;inUserName,</span>
<a href="#l13.9"></a><span id="l13.9">                                int32_t authMethodIncoming, bool isNNTP)</span>
<a href="#l13.10"></a><span id="l13.10"> {</span>
<a href="#l13.11"></a><span id="l13.11">   // Get the relevant information for an identity</span>
<a href="#l13.12"></a><span id="l13.12" class="difflineminus">-  // BUG 470587. Don't set this: id-&gt;SetIdentityName(fullName);</span>
<a href="#l13.13"></a><span id="l13.13">   nsresult rv;</span>
<a href="#l13.14"></a><span id="l13.14">   nsAutoString value;</span>
<a href="#l13.15"></a><span id="l13.15"> </span>
<a href="#l13.16"></a><span id="l13.16">   nsCOMPtr&lt;nsIMsgIdentity&gt; id;</span>
<a href="#l13.17"></a><span id="l13.17">   rv = pMgr-&gt;CreateIdentity(getter_AddRefs(id));</span>
<a href="#l13.18"></a><span id="l13.18">   if (id) {</span>
<a href="#l13.19"></a><span id="l13.19">     IMPORT_LOG0(&quot;Created identity and added to the account\n&quot;);</span>
<a href="#l13.20"></a><span id="l13.20">     if (NS_SUCCEEDED(nsWMUtils::GetValueForTag(xmlDoc,</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l14.1"></a><span id="l14.1" class="difflineminus">--- a/suite/locales/en-US/chrome/mailnews/pref/am-identity-edit.dtd</span>
<a href="#l14.2"></a><span id="l14.2" class="difflineplus">+++ b/suite/locales/en-US/chrome/mailnews/pref/am-identity-edit.dtd</span>
<a href="#l14.3"></a><span id="l14.3" class="difflineat">@@ -6,8 +6,13 @@</span>
<a href="#l14.4"></a><span id="l14.4">      equal to the value of accountManager.size entity minus the value</span>
<a href="#l14.5"></a><span id="l14.5">      of accountTree.width entity. --&gt;</span>
<a href="#l14.6"></a><span id="l14.6"> &lt;!ENTITY identityDialog.style &quot;min-width: 75ch;&quot;&gt;</span>
<a href="#l14.7"></a><span id="l14.7"> &lt;!ENTITY identityListDesc.label &quot;Configure the settings for this identity:&quot;&gt;</span>
<a href="#l14.8"></a><span id="l14.8"> </span>
<a href="#l14.9"></a><span id="l14.9"> &lt;!ENTITY settingsTab.label       &quot;Settings&quot;&gt;</span>
<a href="#l14.10"></a><span id="l14.10"> &lt;!ENTITY copiesFoldersTab.label &quot;Copies &amp;amp; Folders&quot;&gt;</span>
<a href="#l14.11"></a><span id="l14.11"> &lt;!ENTITY addressingTab.label    &quot;Composition &amp;amp; Addressing&quot;&gt;</span>
<a href="#l14.12"></a><span id="l14.12" class="difflineplus">+</span>
<a href="#l14.13"></a><span id="l14.13" class="difflineplus">+&lt;!ENTITY publicData.label        &quot;Public Data&quot;&gt;</span>
<a href="#l14.14"></a><span id="l14.14" class="difflineplus">+&lt;!ENTITY privateData.label       &quot;Private Data&quot;&gt;</span>
<a href="#l14.15"></a><span id="l14.15" class="difflineplus">+&lt;!ENTITY identityAlias.label     &quot;Identity Label:&quot;&gt;</span>
<a href="#l14.16"></a><span id="l14.16" class="difflineplus">+&lt;!ENTITY identityAlias.accesskey &quot;b&quot;&gt;</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l15.1"></a><span id="l15.1" class="difflineminus">--- a/suite/mailnews/compose/MsgComposeCommands.js</span>
<a href="#l15.2"></a><span id="l15.2" class="difflineplus">+++ b/suite/mailnews/compose/MsgComposeCommands.js</span>
<a href="#l15.3"></a><span id="l15.3" class="difflineat">@@ -1105,18 +1105,18 @@ function ComposeStartup(aParams)</span>
<a href="#l15.4"></a><span id="l15.4">         composeFields.newshost = args.newshost;</span>
<a href="#l15.5"></a><span id="l15.5">       if (args.body)</span>
<a href="#l15.6"></a><span id="l15.6">          composeFields.body = args.body;</span>
<a href="#l15.7"></a><span id="l15.7">     }</span>
<a href="#l15.8"></a><span id="l15.8">   }</span>
<a href="#l15.9"></a><span id="l15.9"> </span>
<a href="#l15.10"></a><span id="l15.10">   gComposeType = params.type;</span>
<a href="#l15.11"></a><span id="l15.11"> </span>
<a href="#l15.12"></a><span id="l15.12" class="difflineminus">-  // &quot; &lt;&gt;&quot; is an empty identity, and most likely not valid</span>
<a href="#l15.13"></a><span id="l15.13" class="difflineminus">-  if (!params.identity || params.identity.identityName == &quot; &lt;&gt;&quot;) {</span>
<a href="#l15.14"></a><span id="l15.14" class="difflineplus">+  // An identity with no email is likely not valid.</span>
<a href="#l15.15"></a><span id="l15.15" class="difflineplus">+  if (!params.identity || !params.identity.email) {</span>
<a href="#l15.16"></a><span id="l15.16">     // no pre selected identity, so use the default account</span>
<a href="#l15.17"></a><span id="l15.17">     var identities = gAccountManager.defaultAccount.identities;</span>
<a href="#l15.18"></a><span id="l15.18">     if (identities.length == 0)</span>
<a href="#l15.19"></a><span id="l15.19">       identities = gAccountManager.allIdentities;</span>
<a href="#l15.20"></a><span id="l15.20">     params.identity = identities.queryElementAt(0, Components.interfaces.nsIMsgIdentity);</span>
<a href="#l15.21"></a><span id="l15.21">   }</span>
<a href="#l15.22"></a><span id="l15.22"> </span>
<a href="#l15.23"></a><span id="l15.23">   identityList.selectedItem =</span>
<a href="#l15.24"></a><span id="l15.24" class="difflineat">@@ -2056,21 +2056,18 @@ function FillIdentityList(menulist)</span>
<a href="#l15.25"></a><span id="l15.25">                                          Components.interfaces.nsIMsgIdentity));</span>
<a href="#l15.26"></a><span id="l15.26"> </span>
<a href="#l15.27"></a><span id="l15.27">     if (identities.length == 0)</span>
<a href="#l15.28"></a><span id="l15.28">       continue;</span>
<a href="#l15.29"></a><span id="l15.29"> </span>
<a href="#l15.30"></a><span id="l15.30">     for (let i = 0; i &lt; identities.length; i++)</span>
<a href="#l15.31"></a><span id="l15.31">     {</span>
<a href="#l15.32"></a><span id="l15.32">       let identity = identities[i];</span>
<a href="#l15.33"></a><span id="l15.33" class="difflineminus">-      let address = MailServices.headerParser</span>
<a href="#l15.34"></a><span id="l15.34" class="difflineminus">-                                .makeMailboxObject(identity.fullName,</span>
<a href="#l15.35"></a><span id="l15.35" class="difflineminus">-                                                   identity.email).toString();</span>
<a href="#l15.36"></a><span id="l15.36">       let item = menulist.appendItem(identity.identityName,</span>
<a href="#l15.37"></a><span id="l15.37" class="difflineminus">-                                     address,</span>
<a href="#l15.38"></a><span id="l15.38" class="difflineplus">+                                     identity.fullAddress,</span>
<a href="#l15.39"></a><span id="l15.39">                                      account.incomingServer.prettyName);</span>
<a href="#l15.40"></a><span id="l15.40">       item.setAttribute(&quot;identitykey&quot;, identity.key);</span>
<a href="#l15.41"></a><span id="l15.41">       item.setAttribute(&quot;accountkey&quot;, account.key);</span>
<a href="#l15.42"></a><span id="l15.42">       if (i == 0)</span>
<a href="#l15.43"></a><span id="l15.43">       {</span>
<a href="#l15.44"></a><span id="l15.44">         // Mark the first identity as default.</span>
<a href="#l15.45"></a><span id="l15.45">         item.setAttribute(&quot;default&quot;, &quot;true&quot;);</span>
<a href="#l15.46"></a><span id="l15.46">       }</span>
<a href="#l15.47"></a><span id="l15.47" class="difflineat">@@ -2670,18 +2667,19 @@ function LoadIdentity(startup)</span>
<a href="#l15.48"></a><span id="l15.48">           event.initEvent('compose-from-changed', false, true);</span>
<a href="#l15.49"></a><span id="l15.49">           document.getElementById(&quot;msgcomposeWindow&quot;).dispatchEvent(event);</span>
<a href="#l15.50"></a><span id="l15.50">         }</span>
<a href="#l15.51"></a><span id="l15.51"> </span>
<a href="#l15.52"></a><span id="l15.52">       if (!startup) {</span>
<a href="#l15.53"></a><span id="l15.53">           if (getPref(&quot;mail.autoComplete.highlightNonMatches&quot;))</span>
<a href="#l15.54"></a><span id="l15.54">             document.getElementById('addressCol2#1').highlightNonMatches = true;</span>
<a href="#l15.55"></a><span id="l15.55"> </span>
<a href="#l15.56"></a><span id="l15.56" class="difflineminus">-          // only do this if we aren't starting up....it gets done as part of startup already</span>
<a href="#l15.57"></a><span id="l15.57" class="difflineminus">-          addRecipientsToIgnoreList(gCurrentIdentity.identityName);</span>
<a href="#l15.58"></a><span id="l15.58" class="difflineplus">+          // Only do this if we aren't starting up...</span>
<a href="#l15.59"></a><span id="l15.59" class="difflineplus">+          // It gets done as part of startup already.</span>
<a href="#l15.60"></a><span id="l15.60" class="difflineplus">+          addRecipientsToIgnoreList(gCurrentIdentity.fullAddress);</span>
<a href="#l15.61"></a><span id="l15.61">       }</span>
<a href="#l15.62"></a><span id="l15.62">     }</span>
<a href="#l15.63"></a><span id="l15.63"> }</span>
<a href="#l15.64"></a><span id="l15.64"> </span>
<a href="#l15.65"></a><span id="l15.65"> function setupAutocomplete()</span>
<a href="#l15.66"></a><span id="l15.66"> {</span>
<a href="#l15.67"></a><span id="l15.67">   var autoCompleteWidget = document.getElementById(&quot;addressCol2#1&quot;);</span>
<a href="#l15.68"></a><span id="l15.68"> </span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l16.1"></a><span id="l16.1" class="difflineminus">--- a/suite/mailnews/compose/addressingWidgetOverlay.js</span>
<a href="#l16.2"></a><span id="l16.2" class="difflineplus">+++ b/suite/mailnews/compose/addressingWidgetOverlay.js</span>
<a href="#l16.3"></a><span id="l16.3" class="difflineat">@@ -203,17 +203,18 @@ function CompFields2Recipients(msgCompFi</span>
<a href="#l16.4"></a><span id="l16.4"> </span>
<a href="#l16.5"></a><span id="l16.5">     // If it's a new message, we need to add an extra empty recipient.</span>
<a href="#l16.6"></a><span id="l16.6">     if (!havePrimaryRecipient)</span>
<a href="#l16.7"></a><span id="l16.7">       _awSetInputAndPopup(&quot;&quot;, &quot;addr_to&quot;, newListBoxNode, templateNode);</span>
<a href="#l16.8"></a><span id="l16.8">     awFitDummyRows(2);</span>
<a href="#l16.9"></a><span id="l16.9"> </span>
<a href="#l16.10"></a><span id="l16.10">     // CompFields2Recipients is called whenever a user replies or edits an existing message.</span>
<a href="#l16.11"></a><span id="l16.11">     // We want to add all of the recipients for this message to the ignore list for spell check</span>
<a href="#l16.12"></a><span id="l16.12" class="difflineminus">-    addRecipientsToIgnoreList((gCurrentIdentity ? gCurrentIdentity.identityName + ', ' : '') + msgTo + ', ' + msgCC + ', ' + msgBCC);</span>
<a href="#l16.13"></a><span id="l16.13" class="difflineplus">+    let currentAddress = gCurrentIdentity ? gCurrentIdentity.fullAddress : &quot;&quot;;</span>
<a href="#l16.14"></a><span id="l16.14" class="difflineplus">+    addRecipientsToIgnoreList([currentAddress,msgTo,msgCC,msgBCC].filter(adr =&gt; adr).join(&quot;, &quot;));</span>
<a href="#l16.15"></a><span id="l16.15">   }</span>
<a href="#l16.16"></a><span id="l16.16"> }</span>
<a href="#l16.17"></a><span id="l16.17"> </span>
<a href="#l16.18"></a><span id="l16.18"> function awSetInputAndPopupId(inputElem, popupElem, rowNumber)</span>
<a href="#l16.19"></a><span id="l16.19"> {</span>
<a href="#l16.20"></a><span id="l16.20">   popupElem.id = &quot;addressCol1#&quot; + rowNumber;</span>
<a href="#l16.21"></a><span id="l16.21">   inputElem.id = &quot;addressCol2#&quot; + rowNumber;</span>
<a href="#l16.22"></a><span id="l16.22">   inputElem.setAttribute(&quot;aria-labelledby&quot;, popupElem.id);</span></pre></div></div>

<div class="page_footer">
<div class="page_footer_text">comm-central</div>
<div class="page_footer_text" style="padding-left: 10px">Deployed from <a href="https://hg.mozilla.org/hgcustom/version-control-tools/rev/35f393d6769a">35f393d6769a</a> at 2020-07-16T17:23:43Z.</div>
<div class="rss_logo">
<a href="/comm-central/rss-log">RSS</a>
<a href="/comm-central/atom-log">Atom</a>
</div>
<br />

</div>
</body>
</html>

