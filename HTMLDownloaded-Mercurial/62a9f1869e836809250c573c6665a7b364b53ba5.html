<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en-US" lang="en-US">
<head>
<link rel="icon" href="/static/35f393d6769a/hgicon.png" type="image/png" />
<meta name="robots" content="index, nofollow"/>
<link rel="stylesheet" href="/static/35f393d6769a/style-gitweb.css" type="text/css" />

<style type="text/css">
div.feed {
  float: right;
}
a img {
  border-width: 0px;
}
div.log_link {
  width: 80px;
  background-color: white;
}

div.log_body {
  padding-left: 96px;
}
</style>
<script type="text/javascript" src="/static/35f393d6769a/mercurial.js"></script>

<meta property="og:image" content="/static/35f393d6769a/moz-logo-bw-rgb.svg"/>
<meta property="og:type" content="website"/>

<title>comm-central: changeset 2235:62a9f1869e836809250c573c6665a7b364b53ba5</title>
<link rel="alternate" type="application/atom+xml"
   href="/comm-central/atom-log" title="Atom feed for comm-central"/>
<link rel="alternate" type="application/rss+xml"
   href="/comm-central/rss-log" title="RSS feed for comm-central"/>

<meta property="og:title" content="comm-central @ 62a9f1869e836809250c573c6665a7b364b53ba5" />
<meta property="og:url" content="/comm-central/rev/62a9f1869e836809250c573c6665a7b364b53ba5" />
<meta property="og:description" content="Bug 483593 Tidy up case-insensitive comments in nsAbMDBDirectory::CardForEmailAddress and extend unit test for insensitive options. r/sr=bienvenu" />

</head>
<body>

<div class="page_header">
<div class="logo">
    <a href="https://developer.mozilla.org/en/docs/Mercurial">
        <img src="/static/35f393d6769a/moz-logo-bw-rgb.svg" alt="mercurial" />
    </a>
</div>
<a href="/">Mercurial</a> &gt; <a href="/comm-central">comm-central</a>  / changeset / 62a9f1869e836809250c573c6665a7b364b53ba5 
</div>

<div class="page_nav">
<div>
<a href="/comm-central/summary">summary</a> |
<a href="/comm-central/shortlog/62a9f1869e836809250c573c6665a7b364b53ba5">shortlog</a> |
<a href="/comm-central/log/62a9f1869e836809250c573c6665a7b364b53ba5">changelog</a> |
<a href="/comm-central/pushloghtml">pushlog</a> |
<a href="/comm-central/graph/62a9f1869e836809250c573c6665a7b364b53ba5">graph</a> |
<a href="/comm-central/tags">tags</a> |
<a href="/comm-central/bookmarks">bookmarks</a> |
<a href="/comm-central/branches">branches</a> |
<a href="/comm-central/file/62a9f1869e836809250c573c6665a7b364b53ba5">files</a> |
changeset |
<a href="/comm-central/raw-rev/62a9f1869e836809250c573c6665a7b364b53ba5">raw</a>  | <a href="/comm-central/archive/62a9f1869e836809250c573c6665a7b364b53ba5.zip">zip</a>  |
<a href="/comm-central/help">help</a>
</div>

<div class="search">
<form id="searchform" action="/comm-central/log">

<input name="rev" type="text" value="" size="40" />
<div id="hint">Find changesets by keywords (author, files, the commit message), revision
number or hash, or <a href="/comm-central/help/revsets">revset expression</a>.</div>
</form>
</div>
</div>

<div class="title">
<a href="https://bugzilla.mozilla.org/show_bug.cgi?id=483593">Bug 483593</a> Tidy up case-insensitive comments in nsAbMDBDirectory::CardForEmailAddress and extend unit test for insensitive options. r/sr=bienvenu
<span class="logtags"></span>
</div>
<div class="title_text">
<table cellspacing="0">

<tr><td>author</td><td>&#77;&#97;&#114;&#107;&#32;&#66;&#97;&#110;&#110;&#101;&#114;&#32;&#60;&#98;&#117;&#103;&#122;&#105;&#108;&#108;&#97;&#64;&#115;&#116;&#97;&#110;&#100;&#97;&#114;&#100;&#56;&#46;&#112;&#108;&#117;&#115;&#46;&#99;&#111;&#109;&#62;</td></tr>
<tr><td></td><td class="date age">Wed, 18 Mar 2009 07:19:20 +0000</td></tr>

<tr>
 <td>changeset 2235</td>
 <td style="font-family:monospace"><a class="list" href="/comm-central/rev/62a9f1869e836809250c573c6665a7b364b53ba5">62a9f1869e836809250c573c6665a7b364b53ba5</a></td>
</tr>



<tr>
<td>parent 2234</td>
<td style="font-family:monospace">
<a class="list" href="/comm-central/rev/5cb4e78cb2710c0e653d61c489e8517e5d7ad6f2">5cb4e78cb2710c0e653d61c489e8517e5d7ad6f2</a>
</td>
</tr>

<tr>
<td>child 2236</td>
<td style="font-family:monospace">
<a class="list" href="/comm-central/rev/314a95d2259148da448da215444487338d2df6dd">314a95d2259148da448da215444487338d2df6dd</a>
</td>
</tr>
<tr><td>push id</td><td><a href="/comm-central/pushloghtml?changeset=62a9f1869e836809250c573c6665a7b364b53ba5">1807</a></td></tr>
<tr><td>push user</td><td>bugzilla@standard8.plus.com</td></tr>
<tr><td>push date</td><td class="date age">Wed, 18 Mar 2009 07:20:09 +0000</td></tr>

<tr><td>treeherder</td><td>comm-central@62a9f1869e83 [<a href="https://treeherder.mozilla.org/#/jobs?repo=comm-central&revision=62a9f1869e836809250c573c6665a7b364b53ba5">default view</a>] [<a href="https://treeherder.mozilla.org/#/jobs?repo=comm-central&revision=62a9f1869e836809250c573c6665a7b364b53ba5&filter-resultStatus=testfailed&filter-resultStatus=busted&filter-resultStatus=exception">failures only]</td></tr>
<tr><td>perfherder</td><td>[<a href="https://treeherder.mozilla.org/perf.html#/compare?originalProject=comm-central&originalRevision=62a9f1869e836809250c573c6665a7b364b53ba5&newProject=comm-central&newRevision=5cb4e78cb2710c0e653d61c489e8517e5d7ad6f2&framework=1" target="_blank">talos</a>] [<a href="https://treeherder.mozilla.org/perf.html#/compare?originalProject=comm-central&originalRevision=62a9f1869e836809250c573c6665a7b364b53ba5&newProject=comm-central&newRevision=5cb4e78cb2710c0e653d61c489e8517e5d7ad6f2&framework=2" target="_blank">build metrics</a>] [<a href="https://treeherder.mozilla.org/perf.html#/compare?originalProject=comm-central&originalRevision=62a9f1869e836809250c573c6665a7b364b53ba5&newProject=comm-central&newRevision=5cb4e78cb2710c0e653d61c489e8517e5d7ad6f2&framework=6" target="_blank">platform microbench</a>] (compared to previous push)</td></tr>

<tr><td>bugs</td><td><a href="https://bugzilla.mozilla.org/show_bug.cgi?id=483593">483593</a></td></tr>




</table></div>

<div class="page_body description"><a href="https://bugzilla.mozilla.org/show_bug.cgi?id=483593">Bug 483593</a> Tidy up case-insensitive comments in nsAbMDBDirectory::CardForEmailAddress and extend unit test for insensitive options. r/sr=bienvenu</div>
<div class="list_head"></div>
<div class="title_text">
<table cellspacing="0">

<tr class="parity0">
<td><a class="list" href="/comm-central/diff/62a9f1869e836809250c573c6665a7b364b53ba5/mailnews/addrbook/public/nsIAbCollection.idl">mailnews/addrbook/public/nsIAbCollection.idl</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/62a9f1869e836809250c573c6665a7b364b53ba5/mailnews/addrbook/public/nsIAbCollection.idl">file</a> |
<a href="/comm-central/annotate/62a9f1869e836809250c573c6665a7b364b53ba5/mailnews/addrbook/public/nsIAbCollection.idl">annotate</a> |
<a href="/comm-central/diff/62a9f1869e836809250c573c6665a7b364b53ba5/mailnews/addrbook/public/nsIAbCollection.idl">diff</a> |
<a href="/comm-central/comparison/62a9f1869e836809250c573c6665a7b364b53ba5/mailnews/addrbook/public/nsIAbCollection.idl">comparison</a> |
<a href="/comm-central/log/62a9f1869e836809250c573c6665a7b364b53ba5/mailnews/addrbook/public/nsIAbCollection.idl">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/62a9f1869e836809250c573c6665a7b364b53ba5/mailnews/addrbook/src/nsAbMDBDirectory.cpp">mailnews/addrbook/src/nsAbMDBDirectory.cpp</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/62a9f1869e836809250c573c6665a7b364b53ba5/mailnews/addrbook/src/nsAbMDBDirectory.cpp">file</a> |
<a href="/comm-central/annotate/62a9f1869e836809250c573c6665a7b364b53ba5/mailnews/addrbook/src/nsAbMDBDirectory.cpp">annotate</a> |
<a href="/comm-central/diff/62a9f1869e836809250c573c6665a7b364b53ba5/mailnews/addrbook/src/nsAbMDBDirectory.cpp">diff</a> |
<a href="/comm-central/comparison/62a9f1869e836809250c573c6665a7b364b53ba5/mailnews/addrbook/src/nsAbMDBDirectory.cpp">comparison</a> |
<a href="/comm-central/log/62a9f1869e836809250c573c6665a7b364b53ba5/mailnews/addrbook/src/nsAbMDBDirectory.cpp">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/62a9f1869e836809250c573c6665a7b364b53ba5/mailnews/addrbook/test/unit/data/cardForEmail.mab">mailnews/addrbook/test/unit/data/cardForEmail.mab</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/62a9f1869e836809250c573c6665a7b364b53ba5/mailnews/addrbook/test/unit/data/cardForEmail.mab">file</a> |
<a href="/comm-central/annotate/62a9f1869e836809250c573c6665a7b364b53ba5/mailnews/addrbook/test/unit/data/cardForEmail.mab">annotate</a> |
<a href="/comm-central/diff/62a9f1869e836809250c573c6665a7b364b53ba5/mailnews/addrbook/test/unit/data/cardForEmail.mab">diff</a> |
<a href="/comm-central/comparison/62a9f1869e836809250c573c6665a7b364b53ba5/mailnews/addrbook/test/unit/data/cardForEmail.mab">comparison</a> |
<a href="/comm-central/log/62a9f1869e836809250c573c6665a7b364b53ba5/mailnews/addrbook/test/unit/data/cardForEmail.mab">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/62a9f1869e836809250c573c6665a7b364b53ba5/mailnews/addrbook/test/unit/test_cardForEmail.js">mailnews/addrbook/test/unit/test_cardForEmail.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/62a9f1869e836809250c573c6665a7b364b53ba5/mailnews/addrbook/test/unit/test_cardForEmail.js">file</a> |
<a href="/comm-central/annotate/62a9f1869e836809250c573c6665a7b364b53ba5/mailnews/addrbook/test/unit/test_cardForEmail.js">annotate</a> |
<a href="/comm-central/diff/62a9f1869e836809250c573c6665a7b364b53ba5/mailnews/addrbook/test/unit/test_cardForEmail.js">diff</a> |
<a href="/comm-central/comparison/62a9f1869e836809250c573c6665a7b364b53ba5/mailnews/addrbook/test/unit/test_cardForEmail.js">comparison</a> |
<a href="/comm-central/log/62a9f1869e836809250c573c6665a7b364b53ba5/mailnews/addrbook/test/unit/test_cardForEmail.js">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/62a9f1869e836809250c573c6665a7b364b53ba5/mailnews/addrbook/test/unit/test_nsIAbCard.js">mailnews/addrbook/test/unit/test_nsIAbCard.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/62a9f1869e836809250c573c6665a7b364b53ba5/mailnews/addrbook/test/unit/test_nsIAbCard.js">file</a> |
<a href="/comm-central/annotate/62a9f1869e836809250c573c6665a7b364b53ba5/mailnews/addrbook/test/unit/test_nsIAbCard.js">annotate</a> |
<a href="/comm-central/diff/62a9f1869e836809250c573c6665a7b364b53ba5/mailnews/addrbook/test/unit/test_nsIAbCard.js">diff</a> |
<a href="/comm-central/comparison/62a9f1869e836809250c573c6665a7b364b53ba5/mailnews/addrbook/test/unit/test_nsIAbCard.js">comparison</a> |
<a href="/comm-central/log/62a9f1869e836809250c573c6665a7b364b53ba5/mailnews/addrbook/test/unit/test_nsIAbCard.js">revisions</a>
</td>
</tr>
</table></div>

<div class="page_body diffblocks"><div class="diffblock"><pre class="sourcelines">
<a href="#l1.1"></a><span id="l1.1" class="difflineminus">--- a/mailnews/addrbook/public/nsIAbCollection.idl</span>
<a href="#l1.2"></a><span id="l1.2" class="difflineplus">+++ b/mailnews/addrbook/public/nsIAbCollection.idl</span>
<a href="#l1.3"></a><span id="l1.3" class="difflineat">@@ -66,16 +66,18 @@ interface nsIAbCollection : nsIAbItem {</span>
<a href="#l1.4"></a><span id="l1.4">   readonly attribute boolean isSecure;</span>
<a href="#l1.5"></a><span id="l1.5"> </span>
<a href="#l1.6"></a><span id="l1.6">   /** </span>
<a href="#l1.7"></a><span id="l1.7">    * Returns an address book card for the specified email address if found.</span>
<a href="#l1.8"></a><span id="l1.8">    *</span>
<a href="#l1.9"></a><span id="l1.9">    * If there are multiple cards with the given email address, this method will</span>
<a href="#l1.10"></a><span id="l1.10">    * return one of these cards in an implementation-defined manner.</span>
<a href="#l1.11"></a><span id="l1.11">    *</span>
<a href="#l1.12"></a><span id="l1.12" class="difflineplus">+   * Matching is performed in a case-insensitive manner.</span>
<a href="#l1.13"></a><span id="l1.13" class="difflineplus">+   *</span>
<a href="#l1.14"></a><span id="l1.14">    * This method performs a synchronous operation. If the collection cannot do</span>
<a href="#l1.15"></a><span id="l1.15">    * the search in such a manner, then it should throw NS_ERROR_NOT_IMPLEMENTED.</span>
<a href="#l1.16"></a><span id="l1.16">    *</span>
<a href="#l1.17"></a><span id="l1.17">    * @param  emailAddress The email address to find in any of the email address</span>
<a href="#l1.18"></a><span id="l1.18">    *                      fields. If emailAddress is empty, the database won't</span>
<a href="#l1.19"></a><span id="l1.19">    *                      be searched and the function will return as if no card</span>
<a href="#l1.20"></a><span id="l1.20">    *                      was found.</span>
<a href="#l1.21"></a><span id="l1.21">    * @return              An nsIAbCard if one was found, else returns NULL.</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l2.1"></a><span id="l2.1" class="difflineminus">--- a/mailnews/addrbook/src/nsAbMDBDirectory.cpp</span>
<a href="#l2.2"></a><span id="l2.2" class="difflineplus">+++ b/mailnews/addrbook/src/nsAbMDBDirectory.cpp</span>
<a href="#l2.3"></a><span id="l2.3" class="difflineat">@@ -58,16 +58,17 @@</span>
<a href="#l2.4"></a><span id="l2.4"> #include &quot;prprf.h&quot;</span>
<a href="#l2.5"></a><span id="l2.5"> #include &quot;nsIPrefService.h&quot;</span>
<a href="#l2.6"></a><span id="l2.6"> #include &quot;nsAppDirectoryServiceDefs.h&quot;</span>
<a href="#l2.7"></a><span id="l2.7"> #include &quot;nsDirectoryServiceUtils.h&quot;</span>
<a href="#l2.8"></a><span id="l2.8"> #include &quot;nsILocalFile.h&quot;</span>
<a href="#l2.9"></a><span id="l2.9"> #include &quot;nsComponentManagerUtils.h&quot;</span>
<a href="#l2.10"></a><span id="l2.10"> #include &quot;nsMemory.h&quot;</span>
<a href="#l2.11"></a><span id="l2.11"> #include &quot;nsArrayUtils.h&quot;</span>
<a href="#l2.12"></a><span id="l2.12" class="difflineplus">+#include &quot;nsUnicharUtils.h&quot;</span>
<a href="#l2.13"></a><span id="l2.13"> </span>
<a href="#l2.14"></a><span id="l2.14"> nsAbMDBDirectory::nsAbMDBDirectory(void):</span>
<a href="#l2.15"></a><span id="l2.15">      nsAbDirectoryRDFResource(),</span>
<a href="#l2.16"></a><span id="l2.16">      mPerformingQuery(PR_FALSE)</span>
<a href="#l2.17"></a><span id="l2.17"> {</span>
<a href="#l2.18"></a><span id="l2.18">   mSearchCache.Init();</span>
<a href="#l2.19"></a><span id="l2.19"> }</span>
<a href="#l2.20"></a><span id="l2.20"> </span>
<a href="#l2.21"></a><span id="l2.21" class="difflineat">@@ -1048,27 +1049,29 @@ NS_IMETHODIMP nsAbMDBDirectory::CardForE</span>
<a href="#l2.22"></a><span id="l2.22">     rv = GetAbDatabase();</span>
<a href="#l2.23"></a><span id="l2.23">   if (rv == NS_ERROR_FILE_NOT_FOUND)</span>
<a href="#l2.24"></a><span id="l2.24">   {</span>
<a href="#l2.25"></a><span id="l2.25">     // If file wasn't found, the card cannot exist.</span>
<a href="#l2.26"></a><span id="l2.26">     return NS_OK;</span>
<a href="#l2.27"></a><span id="l2.27">   }</span>
<a href="#l2.28"></a><span id="l2.28">   NS_ENSURE_SUCCESS(rv, rv);</span>
<a href="#l2.29"></a><span id="l2.29"> </span>
<a href="#l2.30"></a><span id="l2.30" class="difflineminus">-  mDatabase-&gt;GetCardFromAttribute(this, kLowerPriEmailColumn /* see #196777 */, aEmailAddress, PR_TRUE /* caseInsensitive, see bug #191798 */, aAbCard);</span>
<a href="#l2.31"></a><span id="l2.31" class="difflineminus">-  if (!*aAbCard) </span>
<a href="#l2.32"></a><span id="l2.32" class="difflineminus">-  {</span>
<a href="#l2.33"></a><span id="l2.33" class="difflineminus">-    // fix for bug #187239</span>
<a href="#l2.34"></a><span id="l2.34" class="difflineminus">-    // didn't find it as the primary email?  try again, with k2ndEmailColumn (&quot;Additional Email&quot;)</span>
<a href="#l2.35"></a><span id="l2.35" class="difflineminus">-    // </span>
<a href="#l2.36"></a><span id="l2.36" class="difflineminus">-    // TODO bug #198731</span>
<a href="#l2.37"></a><span id="l2.37" class="difflineminus">-    // unlike the kPriEmailColumn, we don't have kLower2ndEmailColumn</span>
<a href="#l2.38"></a><span id="l2.38" class="difflineminus">-    // so we will still suffer from bug #196777 for &quot;additional emails&quot;</span>
<a href="#l2.39"></a><span id="l2.39" class="difflineminus">-    mDatabase-&gt;GetCardFromAttribute(this, k2ndEmailProperty, aEmailAddress, PR_TRUE /* caseInsensitive, see bug #191798 */, aAbCard);</span>
<a href="#l2.40"></a><span id="l2.40" class="difflineminus">-  }</span>
<a href="#l2.41"></a><span id="l2.41" class="difflineplus">+  // Convert Email to lower case in UTF-16 format. This correctly lower-cases</span>
<a href="#l2.42"></a><span id="l2.42" class="difflineplus">+  // it and doing this change means that we can use a hash lookup in the</span>
<a href="#l2.43"></a><span id="l2.43" class="difflineplus">+  // database rather than searching and comparing each line individually.</span>
<a href="#l2.44"></a><span id="l2.44" class="difflineplus">+  NS_ConvertUTF8toUTF16 lowerEmail(aEmailAddress);</span>
<a href="#l2.45"></a><span id="l2.45" class="difflineplus">+  ToLowerCase(lowerEmail);</span>
<a href="#l2.46"></a><span id="l2.46" class="difflineplus">+</span>
<a href="#l2.47"></a><span id="l2.47" class="difflineplus">+  mDatabase-&gt;GetCardFromAttribute(this, kLowerPriEmailColumn, NS_ConvertUTF16toUTF8(lowerEmail),</span>
<a href="#l2.48"></a><span id="l2.48" class="difflineplus">+                                  PR_FALSE, aAbCard);</span>
<a href="#l2.49"></a><span id="l2.49" class="difflineplus">+  if (!*aAbCard)</span>
<a href="#l2.50"></a><span id="l2.50" class="difflineplus">+    // We don't have a lower case second email column, so we have to search</span>
<a href="#l2.51"></a><span id="l2.51" class="difflineplus">+    // case-sensitively here.</span>
<a href="#l2.52"></a><span id="l2.52" class="difflineplus">+    mDatabase-&gt;GetCardFromAttribute(this, k2ndEmailProperty, aEmailAddress,</span>
<a href="#l2.53"></a><span id="l2.53" class="difflineplus">+                                    PR_TRUE, aAbCard);</span>
<a href="#l2.54"></a><span id="l2.54"> </span>
<a href="#l2.55"></a><span id="l2.55">   return NS_OK;</span>
<a href="#l2.56"></a><span id="l2.56"> }</span>
<a href="#l2.57"></a><span id="l2.57"> </span>
<a href="#l2.58"></a><span id="l2.58"> NS_IMETHODIMP nsAbMDBDirectory::GetCardFromProperty(const char *aProperty,</span>
<a href="#l2.59"></a><span id="l2.59">                                                     const nsACString &amp;aValue,</span>
<a href="#l2.60"></a><span id="l2.60">                                                     PRBool caseSensitive,</span>
<a href="#l2.61"></a><span id="l2.61">                                                     nsIAbCard **result)</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l3.1"></a><span id="l3.1" class="difflineminus">--- a/mailnews/addrbook/test/unit/data/cardForEmail.mab</span>
<a href="#l3.2"></a><span id="l3.2" class="difflineplus">+++ b/mailnews/addrbook/test/unit/data/cardForEmail.mab</span>
<a href="#l3.3"></a><span id="l3.3" class="difflineat">@@ -1,64 +1,61 @@</span>
<a href="#l3.4"></a><span id="l3.4"> // &lt;!-- &lt;mdb:mork:z v=&quot;1.4&quot;/&gt; --&gt;</span>
<a href="#l3.5"></a><span id="l3.5"> &lt; &lt;(a=c)&gt; // (f=iso-8859-1)</span>
<a href="#l3.6"></a><span id="l3.6" class="difflineminus">-  (B8=Custom4)(B9=Notes)(BA=LastModifiedDate)(BB=RecordKey)</span>
<a href="#l3.7"></a><span id="l3.7" class="difflineminus">-  (BC=AddrCharSet)(BD=LastRecordKey)(BE=ns:addrbk:db:table:kind:pab)</span>
<a href="#l3.8"></a><span id="l3.8" class="difflineminus">-  (BF=ListName)(C0=ListNickName)(C1=ListDescription)</span>
<a href="#l3.9"></a><span id="l3.9" class="difflineminus">-  (C2=ListTotalAddresses)(C3=LowercaseListName)</span>
<a href="#l3.10"></a><span id="l3.10" class="difflineminus">-  (C4=ns:addrbk:db:table:kind:deleted)</span>
<a href="#l3.11"></a><span id="l3.11" class="difflineplus">+  (B8=LastModifiedDate)(B9=RecordKey)(BA=AddrCharSet)(BB=LastRecordKey)</span>
<a href="#l3.12"></a><span id="l3.12" class="difflineplus">+  (BC=ns:addrbk:db:table:kind:pab)(BD=ListName)(BE=ListNickName)</span>
<a href="#l3.13"></a><span id="l3.13" class="difflineplus">+  (BF=ListDescription)(C0=ListTotalAddresses)(C1=LowercaseListName)</span>
<a href="#l3.14"></a><span id="l3.14" class="difflineplus">+  (C2=ns:addrbk:db:table:kind:deleted)</span>
<a href="#l3.15"></a><span id="l3.15">   (80=ns:addrbk:db:row:scope:card:all)</span>
<a href="#l3.16"></a><span id="l3.16">   (81=ns:addrbk:db:row:scope:list:all)</span>
<a href="#l3.17"></a><span id="l3.17">   (82=ns:addrbk:db:row:scope:data:all)(83=FirstName)(84=LastName)</span>
<a href="#l3.18"></a><span id="l3.18">   (85=PhoneticFirstName)(86=PhoneticLastName)(87=DisplayName)</span>
<a href="#l3.19"></a><span id="l3.19">   (88=NickName)(89=PrimaryEmail)(8A=LowercasePrimaryEmail)</span>
<a href="#l3.20"></a><span id="l3.20">   (8B=SecondEmail)(8C=PreferMailFormat)(8D=PopularityIndex)</span>
<a href="#l3.21"></a><span id="l3.21">   (8E=AllowRemoteContent)(8F=WorkPhone)(90=HomePhone)(91=FaxNumber)</span>
<a href="#l3.22"></a><span id="l3.22">   (92=PagerNumber)(93=CellularNumber)(94=WorkPhoneType)(95=HomePhoneType)</span>
<a href="#l3.23"></a><span id="l3.23">   (96=FaxNumberType)(97=PagerNumberType)(98=CellularNumberType)</span>
<a href="#l3.24"></a><span id="l3.24">   (99=HomeAddress)(9A=HomeAddress2)(9B=HomeCity)(9C=HomeState)</span>
<a href="#l3.25"></a><span id="l3.25">   (9D=HomeZipCode)(9E=HomeCountry)(9F=WorkAddress)(A0=WorkAddress2)</span>
<a href="#l3.26"></a><span id="l3.26">   (A1=WorkCity)(A2=WorkState)(A3=WorkZipCode)(A4=WorkCountry)</span>
<a href="#l3.27"></a><span id="l3.27">   (A5=JobTitle)(A6=Department)(A7=Company)(A8=_AimScreenName)</span>
<a href="#l3.28"></a><span id="l3.28">   (A9=AnniversaryYear)(AA=AnniversaryMonth)(AB=AnniversaryDay)</span>
<a href="#l3.29"></a><span id="l3.29" class="difflineminus">-  (AC=SpouseName)(AD=FamilyName)(AE=DefaultAddress)(AF=Category)</span>
<a href="#l3.30"></a><span id="l3.30" class="difflineminus">-  (B0=WebPage1)(B1=WebPage2)(B2=BirthYear)(B3=BirthMonth)(B4=BirthDay)</span>
<a href="#l3.31"></a><span id="l3.31" class="difflineminus">-  (B5=Custom1)(B6=Custom2)(B7=Custom3)&gt;</span>
<a href="#l3.32"></a><span id="l3.32" class="difflineplus">+  (AC=SpouseName)(AD=FamilyName)(AE=WebPage1)(AF=WebPage2)(B0=BirthYear)</span>
<a href="#l3.33"></a><span id="l3.33" class="difflineplus">+  (B1=BirthMonth)(B2=BirthDay)(B3=Custom1)(B4=Custom2)(B5=Custom3)</span>
<a href="#l3.34"></a><span id="l3.34" class="difflineplus">+  (B6=Custom4)(B7=Notes)&gt;</span>
<a href="#l3.35"></a><span id="l3.35"> </span>
<a href="#l3.36"></a><span id="l3.36"> &lt;(80=0)&gt;</span>
<a href="#l3.37"></a><span id="l3.37" class="difflineminus">-{1:^80 {(k^BE:c)(s=9)} </span>
<a href="#l3.38"></a><span id="l3.38" class="difflineminus">-  [1:^82(^BD=0)]}</span>
<a href="#l3.39"></a><span id="l3.39" class="difflineplus">+{1:^80 {(k^BC:c)(s=9)} </span>
<a href="#l3.40"></a><span id="l3.40" class="difflineplus">+  [1:^82(^BB=0)]}</span>
<a href="#l3.41"></a><span id="l3.41"> </span>
<a href="#l3.42"></a><span id="l3.42"> @$${1{@</span>
<a href="#l3.43"></a><span id="l3.43" class="difflineplus">+&lt; &lt;(a=c)&gt; // (f=iso-8859-1)</span>
<a href="#l3.44"></a><span id="l3.44" class="difflineplus">+  (C3=DbRowID)&gt;</span>
<a href="#l3.45"></a><span id="l3.45"> </span>
<a href="#l3.46"></a><span id="l3.46" class="difflineminus">-&lt;(85=1)(81=Empty)(82=Email)(83=)(84=Empty Email)&gt;</span>
<a href="#l3.47"></a><span id="l3.47" class="difflineminus">-{-1:^80 {(k^BE:c)(s=9)} </span>
<a href="#l3.48"></a><span id="l3.48" class="difflineminus">-  [1:^82(^BD=1)]</span>
<a href="#l3.49"></a><span id="l3.49" class="difflineminus">-  [-1(^83^81)(^84^82)(^85=)(^86=)(^87^84)(^88=)(^8B=)(^8C=0)(^8D=0)</span>
<a href="#l3.50"></a><span id="l3.50" class="difflineminus">-    (^8E=0)(^8F=)(^90=)(^91=)(^92=)(^93=)(^94=)(^95=)(^96=)(^97=)(^98=)</span>
<a href="#l3.51"></a><span id="l3.51" class="difflineminus">-    (^99=)(^9A=)(^9B=)(^9C=)(^9D=)(^9E=)(^9F=)(^A0=)(^A1=)(^A2=)(^A3=)</span>
<a href="#l3.52"></a><span id="l3.52" class="difflineminus">-    (^A4=)(^A5=)(^A6=)(^A7=)(^A8=)(^A9=)(^AA=)(^AB=)(^AC=)(^AD=)(^AE=)</span>
<a href="#l3.53"></a><span id="l3.53" class="difflineminus">-    (^AF=)(^B0=)(^B1=)(^B2=)(^B3=)(^B4=)(^B5=)(^B6=)(^B7=)(^B8=)(^B9=)</span>
<a href="#l3.54"></a><span id="l3.54" class="difflineminus">-    (^BA=0)(^BB=1)]}</span>
<a href="#l3.55"></a><span id="l3.55" class="difflineplus">+&lt;(82=1)(81=Email)(83=Empty Email)(84=Empty)(85=)&gt;</span>
<a href="#l3.56"></a><span id="l3.56" class="difflineplus">+{-1:^80 {(k^BC:c)(s=9)} </span>
<a href="#l3.57"></a><span id="l3.57" class="difflineplus">+  [1:^82(^BB=1)]</span>
<a href="#l3.58"></a><span id="l3.58" class="difflineplus">+  [-1(^84^81)(^C3=1)(^87^83)(^8E=0)(^8D=0)(^83^84)(^8C=0)(^B8=0)(^B9=1)</span>
<a href="#l3.59"></a><span id="l3.59" class="difflineplus">+    (^89=)(^8A=)]}</span>
<a href="#l3.60"></a><span id="l3.60"> @$$}1}@</span>
<a href="#l3.61"></a><span id="l3.61"> </span>
<a href="#l3.62"></a><span id="l3.62"> @$${2{@</span>
<a href="#l3.63"></a><span id="l3.63"> </span>
<a href="#l3.64"></a><span id="l3.64" class="difflineminus">-&lt;(A9=2)(86=FirstName1)(87=LastName1)(88=DisplayName1)(89=NickName1)</span>
<a href="#l3.65"></a><span id="l3.65" class="difflineminus">-  (8A=PrimaryEmail1@test.invalid)(8B=primaryemail1@test.invalid)(8C</span>
<a href="#l3.66"></a><span id="l3.66" class="difflineminus">-    =SecondEmail1@test.invalid)(8D=WorkPhone1)(8E=HomePhone1)(8F</span>
<a href="#l3.67"></a><span id="l3.67" class="difflineminus">-    =FaxNumber1)(90=PagerNumber1)(91=CellularNumber1)(92=HomeAddress11)</span>
<a href="#l3.68"></a><span id="l3.68" class="difflineminus">-  (93=HomeAddress21)(94=HomeCity1)(95=HomeState1)(96=HomeZipCode1)(97</span>
<a href="#l3.69"></a><span id="l3.69" class="difflineminus">-    =HomeCountry1)(98=WorkAddress1)(99=WorkAddress21)(9A=WorkCity1)</span>
<a href="#l3.70"></a><span id="l3.70" class="difflineminus">-  (9B=WorkState1)(9C=WorkZipCode1)(9D=WorkCountry1)(9E=JobTitle1)(9F</span>
<a href="#l3.71"></a><span id="l3.71" class="difflineminus">-    =Department1)(A0=Organization1)(A1=ScreenName1)(A2=http://WebPage21)</span>
<a href="#l3.72"></a><span id="l3.72" class="difflineminus">-  (A3=http://WebPage11)(A4=Custom11)(A5=Custom21)(A6=Custom31)(A7=Custom41)</span>
<a href="#l3.73"></a><span id="l3.73" class="difflineminus">-  (A8=Notes1)&gt;</span>
<a href="#l3.74"></a><span id="l3.74" class="difflineminus">-{-1:^80 {(k^BE:c)(s=9)} </span>
<a href="#l3.75"></a><span id="l3.75" class="difflineminus">-  [1:^82(^BD=2)]1 </span>
<a href="#l3.76"></a><span id="l3.76" class="difflineminus">-  [-2(^83^86)(^84^87)(^85=)(^86=)(^87^88)(^88^89)(^89^8A)(^8A^8B)(^8B^8C)</span>
<a href="#l3.77"></a><span id="l3.77" class="difflineminus">-    (^8C=0)(^8D=0)(^8E=0)(^8F^8D)(^90^8E)(^91^8F)(^92^90)(^93^91)(^94=)</span>
<a href="#l3.78"></a><span id="l3.78" class="difflineminus">-    (^95=)(^96=)(^97=)(^98=)(^99^92)(^9A^93)(^9B^94)(^9C^95)(^9D^96)</span>
<a href="#l3.79"></a><span id="l3.79" class="difflineminus">-    (^9E^97)(^9F^98)(^A0^99)(^A1^9A)(^A2^9B)(^A3^9C)(^A4^9D)(^A5^9E)</span>
<a href="#l3.80"></a><span id="l3.80" class="difflineminus">-    (^A6^9F)(^A7^A0)(^A8^A1)(^A9=)(^AA=)(^AB=)(^AC=)(^AD=)(^AE=)(^AF=)</span>
<a href="#l3.81"></a><span id="l3.81" class="difflineminus">-    (^B0^A2)(^B1^A3)(^B2=)(^B3=)(^B4=)(^B5^A4)(^B6^A5)(^B7^A6)(^B8^A7)</span>
<a href="#l3.82"></a><span id="l3.82" class="difflineminus">-    (^B9^A8)(^BA=0)(^BB=2)]}</span>
<a href="#l3.83"></a><span id="l3.83" class="difflineplus">+&lt;(89=2)(86=LastName1)(87=Custom41)(88=1237281794)(8A=http://WebPage11)</span>
<a href="#l3.84"></a><span id="l3.84" class="difflineplus">+  (8B=NickName1)(8C=DisplayName1)(8D=WorkZipCode1)(8E=ScreenName1)(8F</span>
<a href="#l3.85"></a><span id="l3.85" class="difflineplus">+    =WorkAddress1)(90=HomeCountry1)(91=WorkPhone1)(92</span>
<a href="#l3.86"></a><span id="l3.86" class="difflineplus">+    =PrimaryEmail1@test.invalid)(93=HomeAddress11)(94</span>
<a href="#l3.87"></a><span id="l3.87" class="difflineplus">+    =primaryemail1@test.invalid)(95=WorkCity1)(96</span>
<a href="#l3.88"></a><span id="l3.88" class="difflineplus">+    =SecondEmail1$C3$90@test.invalid)(97=HomeZipCode1)(98=Custom31)</span>
<a href="#l3.89"></a><span id="l3.89" class="difflineplus">+  (99=FaxNumber1)(9A=Custom11)(9B=HomePhone1)(9C=FirstName1)(9D=HomeCity1)</span>
<a href="#l3.90"></a><span id="l3.90" class="difflineplus">+  (9E=PagerNumber1)(9F=CellularNumber1)(A0=WorkAddress21)(A1=WorkState1)</span>
<a href="#l3.91"></a><span id="l3.91" class="difflineplus">+  (A2=HomeAddress21)(A3=http://WebPage21)(A4=Notes1)(A5=Custom21)(A6</span>
<a href="#l3.92"></a><span id="l3.92" class="difflineplus">+    =Department1)(A7=WorkCountry1)(A8=HomeState1)(A9=JobTitle1)(AA</span>
<a href="#l3.93"></a><span id="l3.93" class="difflineplus">+    =Organization1)&gt;</span>
<a href="#l3.94"></a><span id="l3.94" class="difflineplus">+{-1:^80 {(k^BC:c)(s=9)} </span>
<a href="#l3.95"></a><span id="l3.95" class="difflineplus">+  [1:^82(^BB=2)]1 </span>
<a href="#l3.96"></a><span id="l3.96" class="difflineplus">+  [-2(^B0=)(^84^86)(^B6^87)(^8D=0)(^B8^88)(^B9=2)(^AF^8A)(^88^8B)(^87^8C)</span>
<a href="#l3.97"></a><span id="l3.97" class="difflineplus">+    (^A3^8D)(^A8^8E)(^85=)(^9F^8F)(^9E^90)(^8F^91)(^89^92)(^99^93)(^8A^94)</span>
<a href="#l3.98"></a><span id="l3.98" class="difflineplus">+    (^A1^95)(^8E=1)(^8B^96)(^9D^97)(^B5^98)(^91^99)(^B3^9A)(^90^9B)</span>
<a href="#l3.99"></a><span id="l3.99" class="difflineplus">+    (^83^9C)(^9B^9D)(^92^9E)(^93^9F)(^8C=0)(^A0^A0)(^A2^A1)(^B2=)(^9A^A2)</span>
<a href="#l3.100"></a><span id="l3.100" class="difflineplus">+    (^AE^A3)(^B7^A4)(^B4^A5)(^A6^A6)(^A4^A7)(^86=)(^9C^A8)(^C3=2)(^A5^A9)</span>
<a href="#l3.101"></a><span id="l3.101" class="difflineplus">+    (^A7^AA)(^B1=)]}</span>
<a href="#l3.102"></a><span id="l3.102"> @$$}2}@</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l4.1"></a><span id="l4.1" class="difflineminus">--- a/mailnews/addrbook/test/unit/test_cardForEmail.js</span>
<a href="#l4.2"></a><span id="l4.2" class="difflineplus">+++ b/mailnews/addrbook/test/unit/test_cardForEmail.js</span>
<a href="#l4.3"></a><span id="l4.3" class="difflineat">@@ -10,16 +10,17 @@</span>
<a href="#l4.4"></a><span id="l4.4"> </span>
<a href="#l4.5"></a><span id="l4.5"> function check_correct_card(card) {</span>
<a href="#l4.6"></a><span id="l4.6">   do_check_neq(card, null);</span>
<a href="#l4.7"></a><span id="l4.7"> </span>
<a href="#l4.8"></a><span id="l4.8">   do_check_eq(card.firstName, &quot;FirstName1&quot;);</span>
<a href="#l4.9"></a><span id="l4.9">   do_check_eq(card.lastName, &quot;LastName1&quot;);</span>
<a href="#l4.10"></a><span id="l4.10">   do_check_eq(card.displayName, &quot;DisplayName1&quot;);</span>
<a href="#l4.11"></a><span id="l4.11">   do_check_eq(card.primaryEmail, &quot;PrimaryEmail1@test.invalid&quot;);</span>
<a href="#l4.12"></a><span id="l4.12" class="difflineplus">+  do_check_eq(card.getProperty(&quot;SecondEmail&quot;, &quot;BAD&quot;), &quot;SecondEmail1\u00D0@test.invalid&quot;);</span>
<a href="#l4.13"></a><span id="l4.13"> }</span>
<a href="#l4.14"></a><span id="l4.14"> </span>
<a href="#l4.15"></a><span id="l4.15"> function run_test() {</span>
<a href="#l4.16"></a><span id="l4.16">   // Test setup - copy the data file into place</span>
<a href="#l4.17"></a><span id="l4.17">   var testAB = do_get_file(&quot;../mailnews/addrbook/test/unit/data/cardForEmail.mab&quot;);</span>
<a href="#l4.18"></a><span id="l4.18"> </span>
<a href="#l4.19"></a><span id="l4.19">   // Copy the file to the profile directory for a PAB</span>
<a href="#l4.20"></a><span id="l4.20">   testAB.copyTo(gProfileDir, kPABData.fileName);</span>
<a href="#l4.21"></a><span id="l4.21" class="difflineat">@@ -42,16 +43,31 @@ function run_test() {</span>
<a href="#l4.22"></a><span id="l4.22">   do_check_true(AB.cardForEmailAddress(&quot;nocard@this.email.invalid&quot;) == null);</span>
<a href="#l4.23"></a><span id="l4.23"> </span>
<a href="#l4.24"></a><span id="l4.24">   // Test - Check that we match this email and some of the fields</span>
<a href="#l4.25"></a><span id="l4.25">   // of the card are correct.</span>
<a href="#l4.26"></a><span id="l4.26">   var card = AB.cardForEmailAddress(&quot;PrimaryEmail1@test.invalid&quot;);</span>
<a href="#l4.27"></a><span id="l4.27"> </span>
<a href="#l4.28"></a><span id="l4.28">   check_correct_card(card);</span>
<a href="#l4.29"></a><span id="l4.29"> </span>
<a href="#l4.30"></a><span id="l4.30" class="difflineplus">+  // Test - Check that we match with the primary email with insensitive case.</span>
<a href="#l4.31"></a><span id="l4.31" class="difflineplus">+  card = AB.cardForEmailAddress(&quot;pRimaryemAIL1@teST.invalid&quot;);</span>
<a href="#l4.32"></a><span id="l4.32" class="difflineplus">+</span>
<a href="#l4.33"></a><span id="l4.33" class="difflineplus">+  check_correct_card(card);</span>
<a href="#l4.34"></a><span id="l4.34" class="difflineplus">+</span>
<a href="#l4.35"></a><span id="l4.35" class="difflineplus">+  // Test - Check that we match with the second email.</span>
<a href="#l4.36"></a><span id="l4.36" class="difflineplus">+  card = AB.cardForEmailAddress(&quot;SecondEmail1\u00D0@test.invalid&quot;);</span>
<a href="#l4.37"></a><span id="l4.37" class="difflineplus">+</span>
<a href="#l4.38"></a><span id="l4.38" class="difflineplus">+  check_correct_card(card);</span>
<a href="#l4.39"></a><span id="l4.39" class="difflineplus">+</span>
<a href="#l4.40"></a><span id="l4.40" class="difflineplus">+  // Test - Check that we match with the second email with insensitive case.</span>
<a href="#l4.41"></a><span id="l4.41" class="difflineplus">+  card = AB.cardForEmailAddress(&quot;SECondEMail1\u00D0@TEST.inValid&quot;);</span>
<a href="#l4.42"></a><span id="l4.42" class="difflineplus">+</span>
<a href="#l4.43"></a><span id="l4.43" class="difflineplus">+  check_correct_card(card);</span>
<a href="#l4.44"></a><span id="l4.44" class="difflineplus">+</span>
<a href="#l4.45"></a><span id="l4.45">   // Check getCardFromProperty returns null correctly for non-extant properties</span>
<a href="#l4.46"></a><span id="l4.46">   do_check_eq(AB.getCardFromProperty(&quot;JobTitle&quot;, &quot;&quot;, false), null);</span>
<a href="#l4.47"></a><span id="l4.47">   do_check_eq(AB.getCardFromProperty(&quot;JobTitle&quot;, &quot;JobTitle&quot;, false), null);</span>
<a href="#l4.48"></a><span id="l4.48"> </span>
<a href="#l4.49"></a><span id="l4.49">   // Check case-insensitive searching works</span>
<a href="#l4.50"></a><span id="l4.50">   card = AB.getCardFromProperty(&quot;JobTitle&quot;, &quot;JobTitle1&quot;, true);</span>
<a href="#l4.51"></a><span id="l4.51">   check_correct_card(card);</span>
<a href="#l4.52"></a><span id="l4.52">   card = AB.getCardFromProperty(&quot;JobTitle&quot;, &quot;JobTitle1&quot;, false);</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l5.1"></a><span id="l5.1" class="difflineminus">--- a/mailnews/addrbook/test/unit/test_nsIAbCard.js</span>
<a href="#l5.2"></a><span id="l5.2" class="difflineplus">+++ b/mailnews/addrbook/test/unit/test_nsIAbCard.js</span>
<a href="#l5.3"></a><span id="l5.3" class="difflineat">@@ -41,17 +41,17 @@ function run_test() {</span>
<a href="#l5.4"></a><span id="l5.4">   // Test - VCard.</span>
<a href="#l5.5"></a><span id="l5.5"> </span>
<a href="#l5.6"></a><span id="l5.6">   do_check_eq(fullCard.translateTo(&quot;vcard&quot;),</span>
<a href="#l5.7"></a><span id="l5.7">               &quot;begin%3Avcard%0D%0Afn%3ADisplayName1%0D%0An%3ALastName1%3BFirstName1%0D%0Aorg%3AOrganization1%3BDepartment1%0D%0Aadr%3AWorkAddress21%3B%3BWorkAddress1%3BWorkCity1%3BWorkState1%3BWorkZipCode1%3BWorkCountry1%0D%0Aemail%3Binternet%3APrimaryEmail1%40test.invalid%0D%0Atitle%3AJobTitle1%0D%0Atel%3Bwork%3AWorkPhone1%0D%0Atel%3Bfax%3AFaxNumber1%0D%0Atel%3Bpager%3APagerNumber1%0D%0Atel%3Bhome%3AHomePhone1%0D%0Atel%3Bcell%3ACellularNumber1%0D%0Anote%3ANotes1%0D%0Aurl%3Ahttp%3A//WebPage21%0D%0Aversion%3A2.1%0D%0Aend%3Avcard%0D%0A%0D%0A&quot;);</span>
<a href="#l5.8"></a><span id="l5.8"> </span>
<a href="#l5.9"></a><span id="l5.9">   // Test - XML</span>
<a href="#l5.10"></a><span id="l5.10"> </span>
<a href="#l5.11"></a><span id="l5.11">   do_check_eq(fullCard.translateTo(&quot;xml&quot;),</span>
<a href="#l5.12"></a><span id="l5.12" class="difflineminus">-              &quot;&lt;GeneratedName&gt;\nDisplayName1&lt;/GeneratedName&gt;\n&lt;table&gt;&lt;tr&gt;&lt;td&gt;&lt;section&gt;&lt;labelrow&gt;&lt;label&gt;Display Name: &lt;/label&gt;&lt;DisplayName&gt;DisplayName1&lt;/DisplayName&gt;&lt;/labelrow&gt;&lt;labelrow&gt;&lt;label&gt;Nickname: &lt;/label&gt;&lt;NickName&gt;NickName1&lt;/NickName&gt;&lt;/labelrow&gt;&lt;PrimaryEmail&gt;PrimaryEmail1@test.invalid&lt;/PrimaryEmail&gt;&lt;SecondEmail&gt;SecondEmail1@test.invalid&lt;/SecondEmail&gt;&lt;labelrow&gt;&lt;label&gt;Screen Name: &lt;/label&gt;&lt;_AimScreenName&gt;ScreenName1&lt;/_AimScreenName&gt;&lt;/labelrow&gt;&lt;/section&gt;&lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;td&gt;&lt;section&gt;&lt;sectiontitle&gt;Phone&lt;/sectiontitle&gt;&lt;labelrow&gt;&lt;label&gt;Work: &lt;/label&gt;&lt;WorkPhone&gt;WorkPhone1&lt;/WorkPhone&gt;&lt;/labelrow&gt;&lt;labelrow&gt;&lt;label&gt;Home: &lt;/label&gt;&lt;HomePhone&gt;HomePhone1&lt;/HomePhone&gt;&lt;/labelrow&gt;&lt;labelrow&gt;&lt;label&gt;Fax: &lt;/label&gt;&lt;FaxNumber&gt;FaxNumber1&lt;/FaxNumber&gt;&lt;/labelrow&gt;&lt;labelrow&gt;&lt;label&gt;Pager: &lt;/label&gt;&lt;PagerNumber&gt;PagerNumber1&lt;/PagerNumber&gt;&lt;/labelrow&gt;&lt;labelrow&gt;&lt;label&gt;Mobile: &lt;/label&gt;&lt;CellularNumber&gt;CellularNumber1&lt;/CellularNumber&gt;&lt;/labelrow&gt;&lt;/section&gt;&lt;section&gt;&lt;sectiontitle&gt;Other&lt;/sectiontitle&gt;&lt;labelrow&gt;&lt;label&gt;Custom 1: &lt;/label&gt;&lt;Custom1&gt;Custom11&lt;/Custom1&gt;&lt;/labelrow&gt;&lt;labelrow&gt;&lt;label&gt;Custom 2: &lt;/label&gt;&lt;Custom2&gt;Custom21&lt;/Custom2&gt;&lt;/labelrow&gt;&lt;labelrow&gt;&lt;label&gt;Custom 3: &lt;/label&gt;&lt;Custom3&gt;Custom31&lt;/Custom3&gt;&lt;/labelrow&gt;&lt;labelrow&gt;&lt;label&gt;Custom 4: &lt;/label&gt;&lt;Custom4&gt;Custom41&lt;/Custom4&gt;&lt;/labelrow&gt;&lt;Notes&gt;Notes1&lt;/Notes&gt;&lt;/section&gt;&lt;/td&gt;&lt;td&gt;&lt;section&gt;&lt;sectiontitle&gt;Home&lt;/sectiontitle&gt;&lt;HomeAddress&gt;HomeAddress11&lt;/HomeAddress&gt;&lt;HomeAddress2&gt;HomeAddress21&lt;/HomeAddress2&gt;&lt;HomeCity&gt;HomeCity1&lt;/HomeCity&gt;, &lt;HomeState&gt;HomeState1&lt;/HomeState&gt; &lt;HomeZipCode&gt;HomeZipCode1&lt;/HomeZipCode&gt;&lt;HomeCountry&gt;HomeCountry1&lt;/HomeCountry&gt;&lt;WebPage2&gt;http://WebPage11&lt;/WebPage2&gt;&lt;/section&gt;&lt;section&gt;&lt;sectiontitle&gt;Work&lt;/sectiontitle&gt;&lt;JobTitle&gt;JobTitle1&lt;/JobTitle&gt;&lt;Department&gt;Department1&lt;/Department&gt;&lt;Company&gt;Organization1&lt;/Company&gt;&lt;WorkAddress&gt;WorkAddress1&lt;/WorkAddress&gt;&lt;WorkAddress2&gt;WorkAddress21&lt;/WorkAddress2&gt;&lt;WorkCity&gt;WorkCity1&lt;/WorkCity&gt;, &lt;WorkState&gt;WorkState1&lt;/WorkState&gt; &lt;WorkZipCode&gt;WorkZipCode1&lt;/WorkZipCode&gt;&lt;WorkCountry&gt;WorkCountry1&lt;/WorkCountry&gt;&lt;WebPage1&gt;http://WebPage21&lt;/WebPage1&gt;&lt;/section&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&quot;);</span>
<a href="#l5.13"></a><span id="l5.13" class="difflineplus">+              &quot;&lt;GeneratedName&gt;\nDisplayName1&lt;/GeneratedName&gt;\n&lt;table&gt;&lt;tr&gt;&lt;td&gt;&lt;section&gt;&lt;labelrow&gt;&lt;label&gt;Display Name: &lt;/label&gt;&lt;DisplayName&gt;DisplayName1&lt;/DisplayName&gt;&lt;/labelrow&gt;&lt;labelrow&gt;&lt;label&gt;Nickname: &lt;/label&gt;&lt;NickName&gt;NickName1&lt;/NickName&gt;&lt;/labelrow&gt;&lt;PrimaryEmail&gt;PrimaryEmail1@test.invalid&lt;/PrimaryEmail&gt;&lt;SecondEmail&gt;SecondEmail1\u00D0@test.invalid&lt;/SecondEmail&gt;&lt;labelrow&gt;&lt;label&gt;Screen Name: &lt;/label&gt;&lt;_AimScreenName&gt;ScreenName1&lt;/_AimScreenName&gt;&lt;/labelrow&gt;&lt;/section&gt;&lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;td&gt;&lt;section&gt;&lt;sectiontitle&gt;Phone&lt;/sectiontitle&gt;&lt;labelrow&gt;&lt;label&gt;Work: &lt;/label&gt;&lt;WorkPhone&gt;WorkPhone1&lt;/WorkPhone&gt;&lt;/labelrow&gt;&lt;labelrow&gt;&lt;label&gt;Home: &lt;/label&gt;&lt;HomePhone&gt;HomePhone1&lt;/HomePhone&gt;&lt;/labelrow&gt;&lt;labelrow&gt;&lt;label&gt;Fax: &lt;/label&gt;&lt;FaxNumber&gt;FaxNumber1&lt;/FaxNumber&gt;&lt;/labelrow&gt;&lt;labelrow&gt;&lt;label&gt;Pager: &lt;/label&gt;&lt;PagerNumber&gt;PagerNumber1&lt;/PagerNumber&gt;&lt;/labelrow&gt;&lt;labelrow&gt;&lt;label&gt;Mobile: &lt;/label&gt;&lt;CellularNumber&gt;CellularNumber1&lt;/CellularNumber&gt;&lt;/labelrow&gt;&lt;/section&gt;&lt;section&gt;&lt;sectiontitle&gt;Other&lt;/sectiontitle&gt;&lt;labelrow&gt;&lt;label&gt;Custom 1: &lt;/label&gt;&lt;Custom1&gt;Custom11&lt;/Custom1&gt;&lt;/labelrow&gt;&lt;labelrow&gt;&lt;label&gt;Custom 2: &lt;/label&gt;&lt;Custom2&gt;Custom21&lt;/Custom2&gt;&lt;/labelrow&gt;&lt;labelrow&gt;&lt;label&gt;Custom 3: &lt;/label&gt;&lt;Custom3&gt;Custom31&lt;/Custom3&gt;&lt;/labelrow&gt;&lt;labelrow&gt;&lt;label&gt;Custom 4: &lt;/label&gt;&lt;Custom4&gt;Custom41&lt;/Custom4&gt;&lt;/labelrow&gt;&lt;Notes&gt;Notes1&lt;/Notes&gt;&lt;/section&gt;&lt;/td&gt;&lt;td&gt;&lt;section&gt;&lt;sectiontitle&gt;Home&lt;/sectiontitle&gt;&lt;HomeAddress&gt;HomeAddress11&lt;/HomeAddress&gt;&lt;HomeAddress2&gt;HomeAddress21&lt;/HomeAddress2&gt;&lt;HomeCity&gt;HomeCity1&lt;/HomeCity&gt;, &lt;HomeState&gt;HomeState1&lt;/HomeState&gt; &lt;HomeZipCode&gt;HomeZipCode1&lt;/HomeZipCode&gt;&lt;HomeCountry&gt;HomeCountry1&lt;/HomeCountry&gt;&lt;WebPage2&gt;http://WebPage11&lt;/WebPage2&gt;&lt;/section&gt;&lt;section&gt;&lt;sectiontitle&gt;Work&lt;/sectiontitle&gt;&lt;JobTitle&gt;JobTitle1&lt;/JobTitle&gt;&lt;Department&gt;Department1&lt;/Department&gt;&lt;Company&gt;Organization1&lt;/Company&gt;&lt;WorkAddress&gt;WorkAddress1&lt;/WorkAddress&gt;&lt;WorkAddress2&gt;WorkAddress21&lt;/WorkAddress2&gt;&lt;WorkCity&gt;WorkCity1&lt;/WorkCity&gt;, &lt;WorkState&gt;WorkState1&lt;/WorkState&gt; &lt;WorkZipCode&gt;WorkZipCode1&lt;/WorkZipCode&gt;&lt;WorkCountry&gt;WorkCountry1&lt;/WorkCountry&gt;&lt;WebPage1&gt;http://WebPage21&lt;/WebPage1&gt;&lt;/section&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&quot;);</span>
<a href="#l5.14"></a><span id="l5.14"> </span>
<a href="#l5.15"></a><span id="l5.15">   // Test - base 64</span>
<a href="#l5.16"></a><span id="l5.16"> </span>
<a href="#l5.17"></a><span id="l5.17">   // btoa is only available for xpcom components or via window.btoa, so we</span>
<a href="#l5.18"></a><span id="l5.18">   // can't use it here.</span>
<a href="#l5.19"></a><span id="l5.19">   do_check_eq(fullCard.translateTo(&quot;base64xml&quot;),</span>
<a href="#l5.20"></a><span id="l5.20" class="difflineminus">-              &quot;PD94bWwgdmVyc2lvbj0iMS4wIj8+Cjw/eG1sLXN0eWxlc2hlZXQgdHlwZT0idGV4dC9jc3MiIGhyZWY9ImNocm9tZTovL21lc3NhZ2Vib2R5L2NvbnRlbnQvYWRkcmVzc2Jvb2svcHJpbnQuY3NzIj8+CjxkaXJlY3Rvcnk+Cjx0aXRsZSB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMTk5OS94aHRtbCI+QWRkcmVzcyBCb29rPC90aXRsZT4KPEdlbmVyYXRlZE5hbWU+CkRpc3BsYXlOYW1lMTwvR2VuZXJhdGVkTmFtZT4KPHRhYmxlPjx0cj48dGQ+PHNlY3Rpb24+PGxhYmVscm93PjxsYWJlbD5EaXNwbGF5IE5hbWU6IDwvbGFiZWw+PERpc3BsYXlOYW1lPkRpc3BsYXlOYW1lMTwvRGlzcGxheU5hbWU+PC9sYWJlbHJvdz48bGFiZWxyb3c+PGxhYmVsPk5pY2tuYW1lOiA8L2xhYmVsPjxOaWNrTmFtZT5OaWNrTmFtZTE8L05pY2tOYW1lPjwvbGFiZWxyb3c+PFByaW1hcnlFbWFpbD5QcmltYXJ5RW1haWwxQHRlc3QuaW52YWxpZDwvUHJpbWFyeUVtYWlsPjxTZWNvbmRFbWFpbD5TZWNvbmRFbWFpbDFAdGVzdC5pbnZhbGlkPC9TZWNvbmRFbWFpbD48bGFiZWxyb3c+PGxhYmVsPlNjcmVlbiBOYW1lOiA8L2xhYmVsPjxfQWltU2NyZWVuTmFtZT5TY3JlZW5OYW1lMTwvX0FpbVNjcmVlbk5hbWU+PC9sYWJlbHJvdz48L3NlY3Rpb24+PC90ZD48L3RyPjx0cj48dGQ+PHNlY3Rpb24+PHNlY3Rpb250aXRsZT5QaG9uZTwvc2VjdGlvbnRpdGxlPjxsYWJlbHJvdz48bGFiZWw+V29yazogPC9sYWJlbD48V29ya1Bob25lPldvcmtQaG9uZTE8L1dvcmtQaG9uZT48L2xhYmVscm93PjxsYWJlbHJvdz48bGFiZWw+SG9tZTogPC9sYWJlbD48SG9tZVBob25lPkhvbWVQaG9uZTE8L0hvbWVQaG9uZT48L2xhYmVscm93PjxsYWJlbHJvdz48bGFiZWw+RmF4OiA8L2xhYmVsPjxGYXhOdW1iZXI+RmF4TnVtYmVyMTwvRmF4TnVtYmVyPjwvbGFiZWxyb3c+PGxhYmVscm93PjxsYWJlbD5QYWdlcjogPC9sYWJlbD48UGFnZXJOdW1iZXI+UGFnZXJOdW1iZXIxPC9QYWdlck51bWJlcj48L2xhYmVscm93PjxsYWJlbHJvdz48bGFiZWw+TW9iaWxlOiA8L2xhYmVsPjxDZWxsdWxhck51bWJlcj5DZWxsdWxhck51bWJlcjE8L0NlbGx1bGFyTnVtYmVyPjwvbGFiZWxyb3c+PC9zZWN0aW9uPjxzZWN0aW9uPjxzZWN0aW9udGl0bGU+T3RoZXI8L3NlY3Rpb250aXRsZT48bGFiZWxyb3c+PGxhYmVsPkN1c3RvbSAxOiA8L2xhYmVsPjxDdXN0b20xPkN1c3RvbTExPC9DdXN0b20xPjwvbGFiZWxyb3c+PGxhYmVscm93PjxsYWJlbD5DdXN0b20gMjogPC9sYWJlbD48Q3VzdG9tMj5DdXN0b20yMTwvQ3VzdG9tMj48L2xhYmVscm93PjxsYWJlbHJvdz48bGFiZWw+Q3VzdG9tIDM6IDwvbGFiZWw+PEN1c3RvbTM+Q3VzdG9tMzE8L0N1c3RvbTM+PC9sYWJlbHJvdz48bGFiZWxyb3c+PGxhYmVsPkN1c3RvbSA0OiA8L2xhYmVsPjxDdXN0b200PkN1c3RvbTQxPC9DdXN0b200PjwvbGFiZWxyb3c+PE5vdGVzPk5vdGVzMTwvTm90ZXM+PC9zZWN0aW9uPjwvdGQ+PHRkPjxzZWN0aW9uPjxzZWN0aW9udGl0bGU+SG9tZTwvc2VjdGlvbnRpdGxlPjxIb21lQWRkcmVzcz5Ib21lQWRkcmVzczExPC9Ib21lQWRkcmVzcz48SG9tZUFkZHJlc3MyPkhvbWVBZGRyZXNzMjE8L0hvbWVBZGRyZXNzMj48SG9tZUNpdHk+SG9tZUNpdHkxPC9Ib21lQ2l0eT4sIDxIb21lU3RhdGU+SG9tZVN0YXRlMTwvSG9tZVN0YXRlPiA8SG9tZVppcENvZGU+SG9tZVppcENvZGUxPC9Ib21lWmlwQ29kZT48SG9tZUNvdW50cnk+SG9tZUNvdW50cnkxPC9Ib21lQ291bnRyeT48V2ViUGFnZTI+aHR0cDovL1dlYlBhZ2UxMTwvV2ViUGFnZTI+PC9zZWN0aW9uPjxzZWN0aW9uPjxzZWN0aW9udGl0bGU+V29yazwvc2VjdGlvbnRpdGxlPjxKb2JUaXRsZT5Kb2JUaXRsZTE8L0pvYlRpdGxlPjxEZXBhcnRtZW50PkRlcGFydG1lbnQxPC9EZXBhcnRtZW50PjxDb21wYW55Pk9yZ2FuaXphdGlvbjE8L0NvbXBhbnk+PFdvcmtBZGRyZXNzPldvcmtBZGRyZXNzMTwvV29ya0FkZHJlc3M+PFdvcmtBZGRyZXNzMj5Xb3JrQWRkcmVzczIxPC9Xb3JrQWRkcmVzczI+PFdvcmtDaXR5PldvcmtDaXR5MTwvV29ya0NpdHk+LCA8V29ya1N0YXRlPldvcmtTdGF0ZTE8L1dvcmtTdGF0ZT4gPFdvcmtaaXBDb2RlPldvcmtaaXBDb2RlMTwvV29ya1ppcENvZGU+PFdvcmtDb3VudHJ5PldvcmtDb3VudHJ5MTwvV29ya0NvdW50cnk+PFdlYlBhZ2UxPmh0dHA6Ly9XZWJQYWdlMjE8L1dlYlBhZ2UxPjwvc2VjdGlvbj48L3RkPjwvdHI+PC90YWJsZT48L2RpcmVjdG9yeT4K&quot;);</span>
<a href="#l5.21"></a><span id="l5.21" class="difflineplus">+              &quot;PD94bWwgdmVyc2lvbj0iMS4wIj8+Cjw/eG1sLXN0eWxlc2hlZXQgdHlwZT0idGV4dC9jc3MiIGhyZWY9ImNocm9tZTovL21lc3NhZ2Vib2R5L2NvbnRlbnQvYWRkcmVzc2Jvb2svcHJpbnQuY3NzIj8+CjxkaXJlY3Rvcnk+Cjx0aXRsZSB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMTk5OS94aHRtbCI+QWRkcmVzcyBCb29rPC90aXRsZT4KPEdlbmVyYXRlZE5hbWU+CkRpc3BsYXlOYW1lMTwvR2VuZXJhdGVkTmFtZT4KPHRhYmxlPjx0cj48dGQ+PHNlY3Rpb24+PGxhYmVscm93PjxsYWJlbD5EaXNwbGF5IE5hbWU6IDwvbGFiZWw+PERpc3BsYXlOYW1lPkRpc3BsYXlOYW1lMTwvRGlzcGxheU5hbWU+PC9sYWJlbHJvdz48bGFiZWxyb3c+PGxhYmVsPk5pY2tuYW1lOiA8L2xhYmVsPjxOaWNrTmFtZT5OaWNrTmFtZTE8L05pY2tOYW1lPjwvbGFiZWxyb3c+PFByaW1hcnlFbWFpbD5QcmltYXJ5RW1haWwxQHRlc3QuaW52YWxpZDwvUHJpbWFyeUVtYWlsPjxTZWNvbmRFbWFpbD5TZWNvbmRFbWFpbDHDkEB0ZXN0LmludmFsaWQ8L1NlY29uZEVtYWlsPjxsYWJlbHJvdz48bGFiZWw+U2NyZWVuIE5hbWU6IDwvbGFiZWw+PF9BaW1TY3JlZW5OYW1lPlNjcmVlbk5hbWUxPC9fQWltU2NyZWVuTmFtZT48L2xhYmVscm93Pjwvc2VjdGlvbj48L3RkPjwvdHI+PHRyPjx0ZD48c2VjdGlvbj48c2VjdGlvbnRpdGxlPlBob25lPC9zZWN0aW9udGl0bGU+PGxhYmVscm93PjxsYWJlbD5Xb3JrOiA8L2xhYmVsPjxXb3JrUGhvbmU+V29ya1Bob25lMTwvV29ya1Bob25lPjwvbGFiZWxyb3c+PGxhYmVscm93PjxsYWJlbD5Ib21lOiA8L2xhYmVsPjxIb21lUGhvbmU+SG9tZVBob25lMTwvSG9tZVBob25lPjwvbGFiZWxyb3c+PGxhYmVscm93PjxsYWJlbD5GYXg6IDwvbGFiZWw+PEZheE51bWJlcj5GYXhOdW1iZXIxPC9GYXhOdW1iZXI+PC9sYWJlbHJvdz48bGFiZWxyb3c+PGxhYmVsPlBhZ2VyOiA8L2xhYmVsPjxQYWdlck51bWJlcj5QYWdlck51bWJlcjE8L1BhZ2VyTnVtYmVyPjwvbGFiZWxyb3c+PGxhYmVscm93PjxsYWJlbD5Nb2JpbGU6IDwvbGFiZWw+PENlbGx1bGFyTnVtYmVyPkNlbGx1bGFyTnVtYmVyMTwvQ2VsbHVsYXJOdW1iZXI+PC9sYWJlbHJvdz48L3NlY3Rpb24+PHNlY3Rpb24+PHNlY3Rpb250aXRsZT5PdGhlcjwvc2VjdGlvbnRpdGxlPjxsYWJlbHJvdz48bGFiZWw+Q3VzdG9tIDE6IDwvbGFiZWw+PEN1c3RvbTE+Q3VzdG9tMTE8L0N1c3RvbTE+PC9sYWJlbHJvdz48bGFiZWxyb3c+PGxhYmVsPkN1c3RvbSAyOiA8L2xhYmVsPjxDdXN0b20yPkN1c3RvbTIxPC9DdXN0b20yPjwvbGFiZWxyb3c+PGxhYmVscm93PjxsYWJlbD5DdXN0b20gMzogPC9sYWJlbD48Q3VzdG9tMz5DdXN0b20zMTwvQ3VzdG9tMz48L2xhYmVscm93PjxsYWJlbHJvdz48bGFiZWw+Q3VzdG9tIDQ6IDwvbGFiZWw+PEN1c3RvbTQ+Q3VzdG9tNDE8L0N1c3RvbTQ+PC9sYWJlbHJvdz48Tm90ZXM+Tm90ZXMxPC9Ob3Rlcz48L3NlY3Rpb24+PC90ZD48dGQ+PHNlY3Rpb24+PHNlY3Rpb250aXRsZT5Ib21lPC9zZWN0aW9udGl0bGU+PEhvbWVBZGRyZXNzPkhvbWVBZGRyZXNzMTE8L0hvbWVBZGRyZXNzPjxIb21lQWRkcmVzczI+SG9tZUFkZHJlc3MyMTwvSG9tZUFkZHJlc3MyPjxIb21lQ2l0eT5Ib21lQ2l0eTE8L0hvbWVDaXR5PiwgPEhvbWVTdGF0ZT5Ib21lU3RhdGUxPC9Ib21lU3RhdGU+IDxIb21lWmlwQ29kZT5Ib21lWmlwQ29kZTE8L0hvbWVaaXBDb2RlPjxIb21lQ291bnRyeT5Ib21lQ291bnRyeTE8L0hvbWVDb3VudHJ5PjxXZWJQYWdlMj5odHRwOi8vV2ViUGFnZTExPC9XZWJQYWdlMj48L3NlY3Rpb24+PHNlY3Rpb24+PHNlY3Rpb250aXRsZT5Xb3JrPC9zZWN0aW9udGl0bGU+PEpvYlRpdGxlPkpvYlRpdGxlMTwvSm9iVGl0bGU+PERlcGFydG1lbnQ+RGVwYXJ0bWVudDE8L0RlcGFydG1lbnQ+PENvbXBhbnk+T3JnYW5pemF0aW9uMTwvQ29tcGFueT48V29ya0FkZHJlc3M+V29ya0FkZHJlc3MxPC9Xb3JrQWRkcmVzcz48V29ya0FkZHJlc3MyPldvcmtBZGRyZXNzMjE8L1dvcmtBZGRyZXNzMj48V29ya0NpdHk+V29ya0NpdHkxPC9Xb3JrQ2l0eT4sIDxXb3JrU3RhdGU+V29ya1N0YXRlMTwvV29ya1N0YXRlPiA8V29ya1ppcENvZGU+V29ya1ppcENvZGUxPC9Xb3JrWmlwQ29kZT48V29ya0NvdW50cnk+V29ya0NvdW50cnkxPC9Xb3JrQ291bnRyeT48V2ViUGFnZTE+aHR0cDovL1dlYlBhZ2UyMTwvV2ViUGFnZTE+PC9zZWN0aW9uPjwvdGQ+PC90cj48L3RhYmxlPjwvZGlyZWN0b3J5Pgo=&quot;);</span>
<a href="#l5.22"></a><span id="l5.22"> }</span></pre></div></div>

<div class="page_footer">
<div class="page_footer_text">comm-central</div>
<div class="page_footer_text" style="padding-left: 10px">Deployed from <a href="https://hg.mozilla.org/hgcustom/version-control-tools/rev/35f393d6769a">35f393d6769a</a> at 2020-07-16T17:23:43Z.</div>
<div class="rss_logo">
<a href="/comm-central/rss-log">RSS</a>
<a href="/comm-central/atom-log">Atom</a>
</div>
<br />

</div>
</body>
</html>

