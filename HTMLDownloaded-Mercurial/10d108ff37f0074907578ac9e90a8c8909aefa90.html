<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en-US" lang="en-US">
<head>
<link rel="icon" href="/static/35f393d6769a/hgicon.png" type="image/png" />
<meta name="robots" content="index, nofollow"/>
<link rel="stylesheet" href="/static/35f393d6769a/style-gitweb.css" type="text/css" />

<style type="text/css">
div.feed {
  float: right;
}
a img {
  border-width: 0px;
}
div.log_link {
  width: 80px;
  background-color: white;
}

div.log_body {
  padding-left: 96px;
}
</style>
<script type="text/javascript" src="/static/35f393d6769a/mercurial.js"></script>

<meta property="og:image" content="/static/35f393d6769a/moz-logo-bw-rgb.svg"/>
<meta property="og:type" content="website"/>

<title>comm-central: changeset 4353:10d108ff37f0074907578ac9e90a8c8909aefa90</title>
<link rel="alternate" type="application/atom+xml"
   href="/comm-central/atom-log" title="Atom feed for comm-central"/>
<link rel="alternate" type="application/rss+xml"
   href="/comm-central/rss-log" title="RSS feed for comm-central"/>

<meta property="og:title" content="comm-central @ 10d108ff37f0074907578ac9e90a8c8909aefa90" />
<meta property="og:url" content="/comm-central/rev/10d108ff37f0074907578ac9e90a8c8909aefa90" />
<meta property="og:description" content="Fix broken a11y labels in message header pane (bug 518337), r=Standard8" />

</head>
<body>

<div class="page_header">
<div class="logo">
    <a href="https://developer.mozilla.org/en/docs/Mercurial">
        <img src="/static/35f393d6769a/moz-logo-bw-rgb.svg" alt="mercurial" />
    </a>
</div>
<a href="/">Mercurial</a> &gt; <a href="/comm-central">comm-central</a>  / changeset / 10d108ff37f0074907578ac9e90a8c8909aefa90 
</div>

<div class="page_nav">
<div>
<a href="/comm-central/summary">summary</a> |
<a href="/comm-central/shortlog/10d108ff37f0074907578ac9e90a8c8909aefa90">shortlog</a> |
<a href="/comm-central/log/10d108ff37f0074907578ac9e90a8c8909aefa90">changelog</a> |
<a href="/comm-central/pushloghtml">pushlog</a> |
<a href="/comm-central/graph/10d108ff37f0074907578ac9e90a8c8909aefa90">graph</a> |
<a href="/comm-central/tags">tags</a> |
<a href="/comm-central/bookmarks">bookmarks</a> |
<a href="/comm-central/branches">branches</a> |
<a href="/comm-central/file/10d108ff37f0074907578ac9e90a8c8909aefa90">files</a> |
changeset |
<a href="/comm-central/raw-rev/10d108ff37f0074907578ac9e90a8c8909aefa90">raw</a>  | <a href="/comm-central/archive/10d108ff37f0074907578ac9e90a8c8909aefa90.zip">zip</a>  |
<a href="/comm-central/help">help</a>
</div>

<div class="search">
<form id="searchform" action="/comm-central/log">

<input name="rev" type="text" value="" size="40" />
<div id="hint">Find changesets by keywords (author, files, the commit message), revision
number or hash, or <a href="/comm-central/help/revsets">revset expression</a>.</div>
</form>
</div>
</div>

<div class="title">
Fix broken a11y labels in message header pane (<a href="https://bugzilla.mozilla.org/show_bug.cgi?id=518337">bug 518337</a>), r=Standard8
<span class="logtags"></span>
</div>
<div class="title_text">
<table cellspacing="0">

<tr><td>author</td><td>&#68;&#97;&#110;&#32;&#77;&#111;&#115;&#101;&#100;&#97;&#108;&#101;&#32;&#60;&#100;&#109;&#111;&#115;&#101;&#64;&#109;&#111;&#122;&#105;&#108;&#108;&#97;&#46;&#111;&#114;&#103;&#62;</td></tr>
<tr><td></td><td class="date age">Tue, 10 Nov 2009 10:43:30 -0800</td></tr>

<tr>
 <td>changeset 4353</td>
 <td style="font-family:monospace"><a class="list" href="/comm-central/rev/10d108ff37f0074907578ac9e90a8c8909aefa90">10d108ff37f0074907578ac9e90a8c8909aefa90</a></td>
</tr>



<tr>
<td>parent 4352</td>
<td style="font-family:monospace">
<a class="list" href="/comm-central/rev/588b16a4afb2080216f454275072ed9fa1a3d79f">588b16a4afb2080216f454275072ed9fa1a3d79f</a>
</td>
</tr>

<tr>
<td>child 4354</td>
<td style="font-family:monospace">
<a class="list" href="/comm-central/rev/6e6860f5b85c1e284e477d467292b3b62d0c850a">6e6860f5b85c1e284e477d467292b3b62d0c850a</a>
</td>
</tr>
<tr><td>push id</td><td><a href="/comm-central/pushloghtml?changeset=10d108ff37f0074907578ac9e90a8c8909aefa90">3403</a></td></tr>
<tr><td>push user</td><td>dmosedale@mozilla.com</td></tr>
<tr><td>push date</td><td class="date age">Tue, 10 Nov 2009 20:47:57 +0000</td></tr>

<tr><td>treeherder</td><td>comm-central@10d108ff37f0 [<a href="https://treeherder.mozilla.org/#/jobs?repo=comm-central&revision=10d108ff37f0074907578ac9e90a8c8909aefa90">default view</a>] [<a href="https://treeherder.mozilla.org/#/jobs?repo=comm-central&revision=10d108ff37f0074907578ac9e90a8c8909aefa90&filter-resultStatus=testfailed&filter-resultStatus=busted&filter-resultStatus=exception">failures only]</td></tr>
<tr><td>perfherder</td><td>[<a href="https://treeherder.mozilla.org/perf.html#/compare?originalProject=comm-central&originalRevision=10d108ff37f0074907578ac9e90a8c8909aefa90&newProject=comm-central&newRevision=10d108ff37f0074907578ac9e90a8c8909aefa90&framework=1" target="_blank">talos</a>] [<a href="https://treeherder.mozilla.org/perf.html#/compare?originalProject=comm-central&originalRevision=10d108ff37f0074907578ac9e90a8c8909aefa90&newProject=comm-central&newRevision=10d108ff37f0074907578ac9e90a8c8909aefa90&framework=2" target="_blank">build metrics</a>] [<a href="https://treeherder.mozilla.org/perf.html#/compare?originalProject=comm-central&originalRevision=10d108ff37f0074907578ac9e90a8c8909aefa90&newProject=comm-central&newRevision=10d108ff37f0074907578ac9e90a8c8909aefa90&framework=6" target="_blank">platform microbench</a>] (compared to previous push)</td></tr>
<tr><td>reviewers</td><td><a href="/comm-central/log?rev=reviewer%28Standard8%29&revcount=50">Standard8</a></td></tr>
<tr><td>bugs</td><td><a href="https://bugzilla.mozilla.org/show_bug.cgi?id=518337">518337</a></td></tr>




</table></div>

<div class="page_body description">Fix broken a11y labels in message header pane (<a href="https://bugzilla.mozilla.org/show_bug.cgi?id=518337">bug 518337</a>), r=Standard8</div>
<div class="list_head"></div>
<div class="title_text">
<table cellspacing="0">

<tr class="parity0">
<td><a class="list" href="/comm-central/diff/10d108ff37f0074907578ac9e90a8c8909aefa90/mail/base/content/mailWidgets.xml">mail/base/content/mailWidgets.xml</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/10d108ff37f0074907578ac9e90a8c8909aefa90/mail/base/content/mailWidgets.xml">file</a> |
<a href="/comm-central/annotate/10d108ff37f0074907578ac9e90a8c8909aefa90/mail/base/content/mailWidgets.xml">annotate</a> |
<a href="/comm-central/diff/10d108ff37f0074907578ac9e90a8c8909aefa90/mail/base/content/mailWidgets.xml">diff</a> |
<a href="/comm-central/comparison/10d108ff37f0074907578ac9e90a8c8909aefa90/mail/base/content/mailWidgets.xml">comparison</a> |
<a href="/comm-central/log/10d108ff37f0074907578ac9e90a8c8909aefa90/mail/base/content/mailWidgets.xml">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/10d108ff37f0074907578ac9e90a8c8909aefa90/mail/base/content/msgHdrViewOverlay.xul">mail/base/content/msgHdrViewOverlay.xul</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/10d108ff37f0074907578ac9e90a8c8909aefa90/mail/base/content/msgHdrViewOverlay.xul">file</a> |
<a href="/comm-central/annotate/10d108ff37f0074907578ac9e90a8c8909aefa90/mail/base/content/msgHdrViewOverlay.xul">annotate</a> |
<a href="/comm-central/diff/10d108ff37f0074907578ac9e90a8c8909aefa90/mail/base/content/msgHdrViewOverlay.xul">diff</a> |
<a href="/comm-central/comparison/10d108ff37f0074907578ac9e90a8c8909aefa90/mail/base/content/msgHdrViewOverlay.xul">comparison</a> |
<a href="/comm-central/log/10d108ff37f0074907578ac9e90a8c8909aefa90/mail/base/content/msgHdrViewOverlay.xul">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/10d108ff37f0074907578ac9e90a8c8909aefa90/mail/test/mozmill/message-header/test-message-header.js">mail/test/mozmill/message-header/test-message-header.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/10d108ff37f0074907578ac9e90a8c8909aefa90/mail/test/mozmill/message-header/test-message-header.js">file</a> |
<a href="/comm-central/annotate/10d108ff37f0074907578ac9e90a8c8909aefa90/mail/test/mozmill/message-header/test-message-header.js">annotate</a> |
<a href="/comm-central/diff/10d108ff37f0074907578ac9e90a8c8909aefa90/mail/test/mozmill/message-header/test-message-header.js">diff</a> |
<a href="/comm-central/comparison/10d108ff37f0074907578ac9e90a8c8909aefa90/mail/test/mozmill/message-header/test-message-header.js">comparison</a> |
<a href="/comm-central/log/10d108ff37f0074907578ac9e90a8c8909aefa90/mail/test/mozmill/message-header/test-message-header.js">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/10d108ff37f0074907578ac9e90a8c8909aefa90/mail/test/mozmill/shared-modules/test-folder-display-helpers.js">mail/test/mozmill/shared-modules/test-folder-display-helpers.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/10d108ff37f0074907578ac9e90a8c8909aefa90/mail/test/mozmill/shared-modules/test-folder-display-helpers.js">file</a> |
<a href="/comm-central/annotate/10d108ff37f0074907578ac9e90a8c8909aefa90/mail/test/mozmill/shared-modules/test-folder-display-helpers.js">annotate</a> |
<a href="/comm-central/diff/10d108ff37f0074907578ac9e90a8c8909aefa90/mail/test/mozmill/shared-modules/test-folder-display-helpers.js">diff</a> |
<a href="/comm-central/comparison/10d108ff37f0074907578ac9e90a8c8909aefa90/mail/test/mozmill/shared-modules/test-folder-display-helpers.js">comparison</a> |
<a href="/comm-central/log/10d108ff37f0074907578ac9e90a8c8909aefa90/mail/test/mozmill/shared-modules/test-folder-display-helpers.js">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/10d108ff37f0074907578ac9e90a8c8909aefa90/mail/test/mozmill/shared-modules/test-window-helpers.js">mail/test/mozmill/shared-modules/test-window-helpers.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/10d108ff37f0074907578ac9e90a8c8909aefa90/mail/test/mozmill/shared-modules/test-window-helpers.js">file</a> |
<a href="/comm-central/annotate/10d108ff37f0074907578ac9e90a8c8909aefa90/mail/test/mozmill/shared-modules/test-window-helpers.js">annotate</a> |
<a href="/comm-central/diff/10d108ff37f0074907578ac9e90a8c8909aefa90/mail/test/mozmill/shared-modules/test-window-helpers.js">diff</a> |
<a href="/comm-central/comparison/10d108ff37f0074907578ac9e90a8c8909aefa90/mail/test/mozmill/shared-modules/test-window-helpers.js">comparison</a> |
<a href="/comm-central/log/10d108ff37f0074907578ac9e90a8c8909aefa90/mail/test/mozmill/shared-modules/test-window-helpers.js">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/10d108ff37f0074907578ac9e90a8c8909aefa90/mailnews/test/resources/messageInjection.js">mailnews/test/resources/messageInjection.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/10d108ff37f0074907578ac9e90a8c8909aefa90/mailnews/test/resources/messageInjection.js">file</a> |
<a href="/comm-central/annotate/10d108ff37f0074907578ac9e90a8c8909aefa90/mailnews/test/resources/messageInjection.js">annotate</a> |
<a href="/comm-central/diff/10d108ff37f0074907578ac9e90a8c8909aefa90/mailnews/test/resources/messageInjection.js">diff</a> |
<a href="/comm-central/comparison/10d108ff37f0074907578ac9e90a8c8909aefa90/mailnews/test/resources/messageInjection.js">comparison</a> |
<a href="/comm-central/log/10d108ff37f0074907578ac9e90a8c8909aefa90/mailnews/test/resources/messageInjection.js">revisions</a>
</td>
</tr>
</table></div>

<div class="page_body diffblocks"><div class="diffblock"><pre class="sourcelines">
<a href="#l1.1"></a><span id="l1.1" class="difflineminus">--- a/mail/base/content/mailWidgets.xml</span>
<a href="#l1.2"></a><span id="l1.2" class="difflineplus">+++ b/mail/base/content/mailWidgets.xml</span>
<a href="#l1.3"></a><span id="l1.3" class="difflineat">@@ -175,31 +175,54 @@</span>
<a href="#l1.4"></a><span id="l1.4">     &lt;/implementation&gt;</span>
<a href="#l1.5"></a><span id="l1.5">   &lt;/binding&gt;</span>
<a href="#l1.6"></a><span id="l1.6"> </span>
<a href="#l1.7"></a><span id="l1.7">   &lt;!-- mail-headerfield: presents standard text header name &amp; value pairs. Don't use this for email addresses.</span>
<a href="#l1.8"></a><span id="l1.8">        use headerValue to set the header value. --&gt;</span>
<a href="#l1.9"></a><span id="l1.9">   &lt;binding id=&quot;mail-headerfield&quot;&gt;</span>
<a href="#l1.10"></a><span id="l1.10">     &lt;content&gt;</span>
<a href="#l1.11"></a><span id="l1.11">       &lt;xul:description class=&quot;headerValue&quot; anonid=&quot;headerValue&quot;</span>
<a href="#l1.12"></a><span id="l1.12" class="difflineminus">-                       flex=&quot;1&quot; readonly=&quot;true&quot; context=&quot;copyPopup&quot;/&gt;</span>
<a href="#l1.13"></a><span id="l1.13" class="difflineplus">+                       flex=&quot;1&quot; readonly=&quot;true&quot; context=&quot;copyPopup&quot;</span>
<a href="#l1.14"></a><span id="l1.14" class="difflineplus">+                       role=&quot;textbox&quot; aria-readonly=&quot;true&quot;/&gt;</span>
<a href="#l1.15"></a><span id="l1.15">     &lt;/content&gt;</span>
<a href="#l1.16"></a><span id="l1.16"> </span>
<a href="#l1.17"></a><span id="l1.17">     &lt;implementation&gt;</span>
<a href="#l1.18"></a><span id="l1.18" class="difflineminus">-      &lt;property name=&quot;headerValue&quot; onset=&quot;return document.getAnonymousElementByAttribute(this, 'anonid', 'headerValue').textContent = val;&quot;/&gt;</span>
<a href="#l1.19"></a><span id="l1.19" class="difflineplus">+      &lt;property name=&quot;headerValue&quot;&gt;</span>
<a href="#l1.20"></a><span id="l1.20" class="difflineplus">+        &lt;setter&gt;</span>
<a href="#l1.21"></a><span id="l1.21" class="difflineplus">+          &lt;![CDATA[</span>
<a href="#l1.22"></a><span id="l1.22" class="difflineplus">+          let valueNode = document.getAnonymousElementByAttribute(this,</span>
<a href="#l1.23"></a><span id="l1.23" class="difflineplus">+                                                                  &quot;anonid&quot;,</span>
<a href="#l1.24"></a><span id="l1.24" class="difflineplus">+                                                                  &quot;headerValue&quot;);</span>
<a href="#l1.25"></a><span id="l1.25" class="difflineplus">+</span>
<a href="#l1.26"></a><span id="l1.26" class="difflineplus">+          // Since the control attribute points to the &lt;mail-headerfield&gt;</span>
<a href="#l1.27"></a><span id="l1.27" class="difflineplus">+          // element rather than the XUL &lt;textbox&gt;, screen readers don't know to</span>
<a href="#l1.28"></a><span id="l1.28" class="difflineplus">+          // automagically prepend the label when reading the textbox, so we</span>
<a href="#l1.29"></a><span id="l1.29" class="difflineplus">+          // force this.  Furthermore, at least on Mac, there is no</span>
<a href="#l1.30"></a><span id="l1.30" class="difflineplus">+          // JS labelElement property at all, so we skip this.  We get away</span>
<a href="#l1.31"></a><span id="l1.31" class="difflineplus">+          // with it because there's no screen reader support on the Mac.</span>
<a href="#l1.32"></a><span id="l1.32" class="difflineplus">+          if (&quot;labelElement&quot; in this) {</span>
<a href="#l1.33"></a><span id="l1.33" class="difflineplus">+            let ariaLabel = this.labelElement.value.slice(0,-1) + &quot;: &quot; + val;</span>
<a href="#l1.34"></a><span id="l1.34" class="difflineplus">+            valueNode.setAttribute(&quot;aria-label&quot;, ariaLabel);</span>
<a href="#l1.35"></a><span id="l1.35" class="difflineplus">+          }</span>
<a href="#l1.36"></a><span id="l1.36" class="difflineplus">+</span>
<a href="#l1.37"></a><span id="l1.37" class="difflineplus">+          return valueNode.textContent = val;</span>
<a href="#l1.38"></a><span id="l1.38" class="difflineplus">+          ]]&gt;</span>
<a href="#l1.39"></a><span id="l1.39" class="difflineplus">+        &lt;/setter&gt;</span>
<a href="#l1.40"></a><span id="l1.40" class="difflineplus">+      &lt;/property&gt;</span>
<a href="#l1.41"></a><span id="l1.41">     &lt;/implementation&gt;</span>
<a href="#l1.42"></a><span id="l1.42">   &lt;/binding&gt;</span>
<a href="#l1.43"></a><span id="l1.43"> </span>
<a href="#l1.44"></a><span id="l1.44">   &lt;binding id=&quot;mail-urlfield&quot; extends=&quot;chrome://messenger/content/mailWidgets.xml#mail-headerfield&quot;&gt;</span>
<a href="#l1.45"></a><span id="l1.45">     &lt;content&gt;</span>
<a href="#l1.46"></a><span id="l1.46">       &lt;xul:description</span>
<a href="#l1.47"></a><span id="l1.47">                  onclick=&quot;if (event.button != 2)</span>
<a href="#l1.48"></a><span id="l1.48">                             openUILink(event.target.textContent, event);&quot;</span>
<a href="#l1.49"></a><span id="l1.49">                  class=&quot;headerValue text-link headerValueUrl&quot;</span>
<a href="#l1.50"></a><span id="l1.50" class="difflineminus">-                 anonid=&quot;headerValue&quot; flex=&quot;1&quot; readonly=&quot;true&quot; context=&quot;copyUrlPopup&quot;/&gt;</span>
<a href="#l1.51"></a><span id="l1.51" class="difflineplus">+                 anonid=&quot;headerValue&quot; flex=&quot;1&quot; readonly=&quot;true&quot;</span>
<a href="#l1.52"></a><span id="l1.52" class="difflineplus">+                 role=&quot;textbox&quot; aria-readonly=&quot;true&quot; context=&quot;copyUrlPopup&quot;/&gt;</span>
<a href="#l1.53"></a><span id="l1.53">     &lt;/content&gt;</span>
<a href="#l1.54"></a><span id="l1.54">   &lt;/binding&gt;</span>
<a href="#l1.55"></a><span id="l1.55"> </span>
<a href="#l1.56"></a><span id="l1.56">   &lt;binding id=&quot;mail-emailheaderfield&quot;&gt;</span>
<a href="#l1.57"></a><span id="l1.57">     &lt;content&gt;</span>
<a href="#l1.58"></a><span id="l1.58">       &lt;xul:mail-emailaddress class=&quot;headerValue&quot; containsEmail=&quot;true&quot;</span>
<a href="#l1.59"></a><span id="l1.59">                              anonid=&quot;emailAddressNode&quot;/&gt;</span>
<a href="#l1.60"></a><span id="l1.60">     &lt;/content&gt;</span>
<a href="#l1.61"></a><span id="l1.61" class="difflineat">@@ -250,21 +273,28 @@</span>
<a href="#l1.62"></a><span id="l1.62">         &lt;body&gt;</span>
<a href="#l1.63"></a><span id="l1.63">           &lt;![CDATA[</span>
<a href="#l1.64"></a><span id="l1.64">             aEmailNode.setAttribute(&quot;label&quot;, aAddress.fullAddress || aAddress.displayName);</span>
<a href="#l1.65"></a><span id="l1.65">             aEmailNode.removeAttribute(&quot;tooltiptext&quot;);</span>
<a href="#l1.66"></a><span id="l1.66">             aEmailNode.setAttribute(&quot;emailAddress&quot;, aAddress.emailAddress);</span>
<a href="#l1.67"></a><span id="l1.67">             aEmailNode.setAttribute(&quot;fullAddress&quot;, aAddress.fullAddress);</span>
<a href="#l1.68"></a><span id="l1.68">             aEmailNode.setAttribute(&quot;displayName&quot;, aAddress.displayName);</span>
<a href="#l1.69"></a><span id="l1.69"> </span>
<a href="#l1.70"></a><span id="l1.70" class="difflineminus">-            // Add aria-label with header field type and header field content</span>
<a href="#l1.71"></a><span id="l1.71" class="difflineminus">-            // for better accessibility.</span>
<a href="#l1.72"></a><span id="l1.72" class="difflineminus">-            var ariaLabel = this.getAttribute(&quot;label&quot;) + &quot;: &quot; +</span>
<a href="#l1.73"></a><span id="l1.73" class="difflineminus">-                            aEmailNode.getAttribute(&quot;label&quot;);</span>
<a href="#l1.74"></a><span id="l1.74" class="difflineminus">-            aEmailNode.setAttribute(&quot;aria-label&quot;, ariaLabel);</span>
<a href="#l1.75"></a><span id="l1.75" class="difflineplus">+            // Since the control attribute points to the</span>
<a href="#l1.76"></a><span id="l1.76" class="difflineplus">+            // &lt;mail-multi-emailHeaderField&gt; element rather than the XUL</span>
<a href="#l1.77"></a><span id="l1.77" class="difflineplus">+            // &lt;mail-emailaddress&gt;, screen readers don't know to automagically</span>
<a href="#l1.78"></a><span id="l1.78" class="difflineplus">+            // prepend the label when reading the tag, so we force this.</span>
<a href="#l1.79"></a><span id="l1.79" class="difflineplus">+            // Furthermore, at least on Mac, there is no JS labelElement</span>
<a href="#l1.80"></a><span id="l1.80" class="difflineplus">+            // property at all, so we skip in that case.  We get away with it</span>
<a href="#l1.81"></a><span id="l1.81" class="difflineplus">+            // because there's no screen reader support on the Mac.</span>
<a href="#l1.82"></a><span id="l1.82" class="difflineplus">+            if (&quot;labelElement&quot; in this) {</span>
<a href="#l1.83"></a><span id="l1.83" class="difflineplus">+                let ariaLabel = this.labelElement.value.slice(0, -1) + &quot;: &quot; +</span>
<a href="#l1.84"></a><span id="l1.84" class="difflineplus">+                                aAddress.fullAddress || aAddress.displayName;</span>
<a href="#l1.85"></a><span id="l1.85" class="difflineplus">+                aEmailNode.setAttribute(&quot;aria-label&quot;, ariaLabel);</span>
<a href="#l1.86"></a><span id="l1.86" class="difflineplus">+            }</span>
<a href="#l1.87"></a><span id="l1.87"> </span>
<a href="#l1.88"></a><span id="l1.88">             try</span>
<a href="#l1.89"></a><span id="l1.89">             {</span>
<a href="#l1.90"></a><span id="l1.90">               if (&quot;AddExtraAddressProcessing&quot; in top)</span>
<a href="#l1.91"></a><span id="l1.91">                 AddExtraAddressProcessing(aAddress.emailAddress, aEmailNode);</span>
<a href="#l1.92"></a><span id="l1.92">             }</span>
<a href="#l1.93"></a><span id="l1.93">             catch(ex)</span>
<a href="#l1.94"></a><span id="l1.94">             {</span>
<a href="#l1.95"></a><span id="l1.95" class="difflineat">@@ -495,17 +525,17 @@</span>
<a href="#l1.96"></a><span id="l1.96">     &lt;/content&gt;</span>
<a href="#l1.97"></a><span id="l1.97">   &lt;/binding&gt;</span>
<a href="#l1.98"></a><span id="l1.98"> </span>
<a href="#l1.99"></a><span id="l1.99">   &lt;binding id=&quot;mail-emailaddress&quot;&gt;</span>
<a href="#l1.100"></a><span id="l1.100">     &lt;content&gt;</span>
<a href="#l1.101"></a><span id="l1.101">       &lt;xul:description anonid=&quot;emailValue&quot; class=&quot;emailDisplayButton&quot;</span>
<a href="#l1.102"></a><span id="l1.102">                        xbl:inherits=&quot;hascard,aria-label&quot;</span>
<a href="#l1.103"></a><span id="l1.103">                        context=&quot;emailAddressPopup&quot; popup=&quot;emailAddressPopup&quot;</span>
<a href="#l1.104"></a><span id="l1.104" class="difflineminus">-                       flex=&quot;1&quot;&gt;</span>
<a href="#l1.105"></a><span id="l1.105" class="difflineplus">+                       flex=&quot;1&quot; role=&quot;textbox&quot; aria-readonly=&quot;true&quot;&gt;</span>
<a href="#l1.106"></a><span id="l1.106">         &lt;xul:label class=&quot;emaillabel&quot; anonid=&quot;emaillabel&quot;</span>
<a href="#l1.107"></a><span id="l1.107">                    xbl:inherits=&quot;value=label,crop&quot;/&gt;</span>
<a href="#l1.108"></a><span id="l1.108">         &lt;xul:image class=&quot;emailStar&quot; anonid=&quot;emailStar&quot;</span>
<a href="#l1.109"></a><span id="l1.109">                    context=&quot;emailAddressPopup&quot;</span>
<a href="#l1.110"></a><span id="l1.110">                    onmousedown=&quot;event.preventDefault();&quot;</span>
<a href="#l1.111"></a><span id="l1.111">                    onclick=&quot;onClickEmailStar(event, this.parentNode.parentNode);&quot;</span>
<a href="#l1.112"></a><span id="l1.112">                    xbl:inherits=&quot;hascard,tooltiptext=tooltipstar&quot;/&gt;</span>
<a href="#l1.113"></a><span id="l1.113">       &lt;/xul:description&gt;</span>
<a href="#l1.114"></a><span id="l1.114" class="difflineat">@@ -528,20 +558,20 @@</span>
<a href="#l1.115"></a><span id="l1.115">     &lt;/implementation&gt;</span>
<a href="#l1.116"></a><span id="l1.116">   &lt;/binding&gt;</span>
<a href="#l1.117"></a><span id="l1.117"> </span>
<a href="#l1.118"></a><span id="l1.118">   &lt;!-- a single newsgroup as displayed in the message header with a drop-down</span>
<a href="#l1.119"></a><span id="l1.119">        menu for various actions --&gt;</span>
<a href="#l1.120"></a><span id="l1.120">   &lt;binding id=&quot;mail-newsgroup&quot;&gt;</span>
<a href="#l1.121"></a><span id="l1.121">     &lt;content&gt;</span>
<a href="#l1.122"></a><span id="l1.122">       &lt;xul:description anonid=&quot;newsgroupValue&quot; class=&quot;emailDisplayButton&quot;</span>
<a href="#l1.123"></a><span id="l1.123" class="difflineminus">-                       xbl:inherits=&quot;aria-label&quot;</span>
<a href="#l1.124"></a><span id="l1.124">                        context=&quot;newsgroupPopup&quot; popup=&quot;newsgroupPopup&quot;</span>
<a href="#l1.125"></a><span id="l1.125">                        flex=&quot;1&quot;&gt;</span>
<a href="#l1.126"></a><span id="l1.126">         &lt;xul:label class=&quot;newsgrouplabel&quot; anonid=&quot;newsgrouplabel&quot;</span>
<a href="#l1.127"></a><span id="l1.127" class="difflineplus">+                   role=&quot;textbox&quot; aria-readonly=&quot;true&quot;</span>
<a href="#l1.128"></a><span id="l1.128">                    xbl:inherits=&quot;value=label,crop&quot;/&gt;</span>
<a href="#l1.129"></a><span id="l1.129">       &lt;/xul:description&gt;</span>
<a href="#l1.130"></a><span id="l1.130">     &lt;/content&gt;</span>
<a href="#l1.131"></a><span id="l1.131"> </span>
<a href="#l1.132"></a><span id="l1.132">     &lt;implementation&gt;</span>
<a href="#l1.133"></a><span id="l1.133">       &lt;property name=&quot;label&quot;      onset=&quot;this.getPart('newsgroupValue').setAttribute('label',val); return val;&quot;</span>
<a href="#l1.134"></a><span id="l1.134">                                   onget=&quot;return this.getPart('newsgroupValue').getAttribute('label');&quot;/&gt;</span>
<a href="#l1.135"></a><span id="l1.135">     &lt;/implementation&gt;</span>
<a href="#l1.136"></a><span id="l1.136" class="difflineat">@@ -585,16 +615,33 @@</span>
<a href="#l1.137"></a><span id="l1.137">               textNode.setAttribute(&quot;value&quot;, &quot;,&quot;);</span>
<a href="#l1.138"></a><span id="l1.138">               textNode.setAttribute(&quot;class&quot;, &quot;newsgroupSeparator&quot;);</span>
<a href="#l1.139"></a><span id="l1.139">               this.newsgroups.appendChild(textNode);</span>
<a href="#l1.140"></a><span id="l1.140">             }</span>
<a href="#l1.141"></a><span id="l1.141"> </span>
<a href="#l1.142"></a><span id="l1.142">             let itemInDocument = this.newsgroups.appendChild(newNode);</span>
<a href="#l1.143"></a><span id="l1.143">             itemInDocument.setAttribute(&quot;label&quot;, this.mNewsgroups[i]);</span>
<a href="#l1.144"></a><span id="l1.144">             itemInDocument.setAttribute(&quot;newsgroup&quot;, this.mNewsgroups[i]);</span>
<a href="#l1.145"></a><span id="l1.145" class="difflineplus">+</span>
<a href="#l1.146"></a><span id="l1.146" class="difflineplus">+            // Since the control attribute points to the &lt;newsgroups&gt;</span>
<a href="#l1.147"></a><span id="l1.147" class="difflineplus">+            // element rather than the XUL &lt;label&gt;, screen</span>
<a href="#l1.148"></a><span id="l1.148" class="difflineplus">+            // readers don't know to automagically prepend the label when</span>
<a href="#l1.149"></a><span id="l1.149" class="difflineplus">+            // reading the tag, so we force this.  Furthermore, at least on</span>
<a href="#l1.150"></a><span id="l1.150" class="difflineplus">+            // Mac, there is no JS labelElement property at all, so we</span>
<a href="#l1.151"></a><span id="l1.151" class="difflineplus">+            // skip in that case.  We get away with it because there's no</span>
<a href="#l1.152"></a><span id="l1.152" class="difflineplus">+            // screen reader support on the Mac.</span>
<a href="#l1.153"></a><span id="l1.153" class="difflineplus">+            if (&quot;labelElement&quot; in this) {</span>
<a href="#l1.154"></a><span id="l1.154" class="difflineplus">+                let ariaLabel = this.labelElement.value.slice(0, -1) + &quot;: &quot; +</span>
<a href="#l1.155"></a><span id="l1.155" class="difflineplus">+                                this.mNewsgroups[i];</span>
<a href="#l1.156"></a><span id="l1.156" class="difflineplus">+                let contentElement =</span>
<a href="#l1.157"></a><span id="l1.157" class="difflineplus">+                  document.getAnonymousElementByAttribute(itemInDocument,</span>
<a href="#l1.158"></a><span id="l1.158" class="difflineplus">+                                                          &quot;anonid&quot;,</span>
<a href="#l1.159"></a><span id="l1.159" class="difflineplus">+                                                          &quot;newsgrouplabel&quot;);</span>
<a href="#l1.160"></a><span id="l1.160" class="difflineplus">+                contentElement.setAttribute(&quot;aria-label&quot;, ariaLabel);</span>
<a href="#l1.161"></a><span id="l1.161" class="difflineplus">+            }</span>
<a href="#l1.162"></a><span id="l1.162">           }</span>
<a href="#l1.163"></a><span id="l1.163">         ]]&gt;&lt;/body&gt;</span>
<a href="#l1.164"></a><span id="l1.164">       &lt;/method&gt;</span>
<a href="#l1.165"></a><span id="l1.165"> </span>
<a href="#l1.166"></a><span id="l1.166">       &lt;!-- clear the current view and internal list of newsgroups --&gt;</span>
<a href="#l1.167"></a><span id="l1.167">       &lt;method name=&quot;clearHeaderValues&quot;&gt;</span>
<a href="#l1.168"></a><span id="l1.168">         &lt;body&gt;&lt;![CDATA[</span>
<a href="#l1.169"></a><span id="l1.169">           this.mNewsgroups = new Array;</span>
<a href="#l1.170"></a><span id="l1.170" class="difflineat">@@ -805,16 +852,30 @@</span>
<a href="#l1.171"></a><span id="l1.171">               } catch (ex) { continue; }</span>
<a href="#l1.172"></a><span id="l1.172"> </span>
<a href="#l1.173"></a><span id="l1.173">               var color = tagService.getColorForKey(tagsArray[index]);</span>
<a href="#l1.174"></a><span id="l1.174"> </span>
<a href="#l1.175"></a><span id="l1.175">               // now create a label for the tag name, and set the color</span>
<a href="#l1.176"></a><span id="l1.176">               var label = document.createElement(&quot;label&quot;);</span>
<a href="#l1.177"></a><span id="l1.177">               label.setAttribute('value', tagName);</span>
<a href="#l1.178"></a><span id="l1.178">               label.className = &quot;tagvalue blc-&quot; + color.substr(1);</span>
<a href="#l1.179"></a><span id="l1.179" class="difflineplus">+</span>
<a href="#l1.180"></a><span id="l1.180" class="difflineplus">+              // Since the control attribute points to the</span>
<a href="#l1.181"></a><span id="l1.181" class="difflineplus">+              // &lt;mail-headerfield-tags&gt; rather than the XUL &lt;label&gt;, screen</span>
<a href="#l1.182"></a><span id="l1.182" class="difflineplus">+              // readers don't know to automagically prepend the label when</span>
<a href="#l1.183"></a><span id="l1.183" class="difflineplus">+              // reading the tag, so we force this.  Furthermore, at least on</span>
<a href="#l1.184"></a><span id="l1.184" class="difflineplus">+              // Mac, there is no JS labelElement property at all, so we</span>
<a href="#l1.185"></a><span id="l1.185" class="difflineplus">+              // skip in that case.  We get away with it because there's no</span>
<a href="#l1.186"></a><span id="l1.186" class="difflineplus">+              // screen reader support on the Mac.</span>
<a href="#l1.187"></a><span id="l1.187" class="difflineplus">+              if (&quot;labelElement&quot; in this) {</span>
<a href="#l1.188"></a><span id="l1.188" class="difflineplus">+                let ariaLabel = this.labelElement.value.slice(0, -1) + &quot;: &quot;</span>
<a href="#l1.189"></a><span id="l1.189" class="difflineplus">+                                + tagName;</span>
<a href="#l1.190"></a><span id="l1.190" class="difflineplus">+                label.setAttribute(&quot;aria-label&quot;, ariaLabel);</span>
<a href="#l1.191"></a><span id="l1.191" class="difflineplus">+              }</span>
<a href="#l1.192"></a><span id="l1.192" class="difflineplus">+</span>
<a href="#l1.193"></a><span id="l1.193">               headerValueNode.appendChild(label);</span>
<a href="#l1.194"></a><span id="l1.194">             }</span>
<a href="#l1.195"></a><span id="l1.195">         ]]&gt;</span>
<a href="#l1.196"></a><span id="l1.196">         &lt;/body&gt;</span>
<a href="#l1.197"></a><span id="l1.197">       &lt;/method&gt;</span>
<a href="#l1.198"></a><span id="l1.198">     &lt;/implementation&gt;</span>
<a href="#l1.199"></a><span id="l1.199">   &lt;/binding&gt;</span>
<a href="#l1.200"></a><span id="l1.200"> </span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l2.1"></a><span id="l2.1" class="difflineminus">--- a/mail/base/content/msgHdrViewOverlay.xul</span>
<a href="#l2.2"></a><span id="l2.2" class="difflineplus">+++ b/mail/base/content/msgHdrViewOverlay.xul</span>
<a href="#l2.3"></a><span id="l2.3" class="difflineat">@@ -289,18 +289,17 @@</span>
<a href="#l2.4"></a><span id="l2.4">                        value=&quot;&amp;subjectField2.label;&quot;</span>
<a href="#l2.5"></a><span id="l2.5">                        control=&quot;expandedsubjectBox&quot;/&gt;</span>
<a href="#l2.6"></a><span id="l2.6">                 &lt;mail-headerfield id=&quot;expandedsubjectBox&quot; flex=&quot;1&quot;/&gt;</span>
<a href="#l2.7"></a><span id="l2.7">               &lt;/row&gt;</span>
<a href="#l2.8"></a><span id="l2.8">               &lt;row id=&quot;expandedorganizationRow&quot; collapsed=&quot;true&quot;&gt;</span>
<a href="#l2.9"></a><span id="l2.9">                 &lt;label id=&quot;expandedorganizationLabel&quot; class=&quot;headerName&quot;</span>
<a href="#l2.10"></a><span id="l2.10">                        value=&quot;&amp;organizationField2.label;&quot;</span>
<a href="#l2.11"></a><span id="l2.11">                        control=&quot;expandedorganizationBox&quot;/&gt;</span>
<a href="#l2.12"></a><span id="l2.12" class="difflineminus">-                &lt;mail-headerfield id=&quot;expandedorganizationBox&quot;</span>
<a href="#l2.13"></a><span id="l2.13" class="difflineminus">-                                  label=&quot;&amp;organizationField2.label;&quot;/&gt;</span>
<a href="#l2.14"></a><span id="l2.14" class="difflineplus">+                &lt;mail-headerfield id=&quot;expandedorganizationBox&quot;/&gt;</span>
<a href="#l2.15"></a><span id="l2.15">               &lt;/row&gt;</span>
<a href="#l2.16"></a><span id="l2.16">               &lt;row id=&quot;expandedsenderRow&quot; collapsed=&quot;true&quot;&gt;</span>
<a href="#l2.17"></a><span id="l2.17">                 &lt;label id=&quot;expandedsenderLabel&quot; class=&quot;headerName&quot;</span>
<a href="#l2.18"></a><span id="l2.18">                        value=&quot;&amp;senderField2.label;&quot; control=&quot;expandedsenderBox&quot;/&gt;</span>
<a href="#l2.19"></a><span id="l2.19">                 &lt;mail-emailheaderfield id=&quot;expandedsenderBox&quot;/&gt;</span>
<a href="#l2.20"></a><span id="l2.20">               &lt;/row&gt;</span>
<a href="#l2.21"></a><span id="l2.21">               &lt;row id=&quot;expandedreply-toRow&quot; collapsed=&quot;true&quot;&gt;</span>
<a href="#l2.22"></a><span id="l2.22">                 &lt;label id=&quot;expandedreply-toLabel&quot; class=&quot;headerName&quot;</span>
<a href="#l2.23"></a><span id="l2.23" class="difflineat">@@ -377,17 +376,18 @@</span>
<a href="#l2.24"></a><span id="l2.24">                 &lt;mail-headerfield id=&quot;expandeduser-agentBox&quot; flex=&quot;1&quot;/&gt;</span>
<a href="#l2.25"></a><span id="l2.25">               &lt;/row&gt;</span>
<a href="#l2.26"></a><span id="l2.26">             &lt;/rows&gt;</span>
<a href="#l2.27"></a><span id="l2.27">           &lt;/grid&gt;</span>
<a href="#l2.28"></a><span id="l2.28"> </span>
<a href="#l2.29"></a><span id="l2.29">           &lt;!-- perhaps this should be a customizable toolbar too --&gt;</span>
<a href="#l2.30"></a><span id="l2.30">           &lt;vbox id=&quot;otherActionsBox&quot; align=&quot;end&quot;&gt;</span>
<a href="#l2.31"></a><span id="l2.31">             &lt;hbox id=&quot;dateValueBox&quot; align=&quot;top&quot; flex=&quot;1&quot;&gt;  &lt;!--For extensions--&gt;</span>
<a href="#l2.32"></a><span id="l2.32" class="difflineminus">-              &lt;label id=&quot;dateLabel&quot; class=&quot;dateLabel&quot; flex=&quot;1&quot;/&gt;</span>
<a href="#l2.33"></a><span id="l2.33" class="difflineplus">+              &lt;label id=&quot;dateLabel&quot; class=&quot;dateLabel&quot; flex=&quot;1&quot; role=&quot;textbox&quot;</span>
<a href="#l2.34"></a><span id="l2.34" class="difflineplus">+                     aria-readonly=&quot;true&quot;/&gt;</span>
<a href="#l2.35"></a><span id="l2.35">             &lt;/hbox&gt;</span>
<a href="#l2.36"></a><span id="l2.36">             &lt;button type=&quot;menu&quot; id=&quot;otherActionsButton&quot;</span>
<a href="#l2.37"></a><span id="l2.37">                     label=&quot;&amp;otherActionsButton.label;&quot;</span>
<a href="#l2.38"></a><span id="l2.38">                     class=&quot;msgHeaderView-button msgHeaderView-flat-button&quot;&gt;</span>
<a href="#l2.39"></a><span id="l2.39">               &lt;menupopup id=&quot;otherActionsPopup&quot;</span>
<a href="#l2.40"></a><span id="l2.40">                          onpopupshowing=&quot;onShowOtherActionsPopup();&quot;&gt;</span>
<a href="#l2.41"></a><span id="l2.41">                 &lt;menuitem id=&quot;otherActionsShowConversation&quot;</span>
<a href="#l2.42"></a><span id="l2.42">                           label=&quot;&amp;otherActionsShowConversation.label;&quot;</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l3.1"></a><span id="l3.1" class="difflineminus">--- a/mail/test/mozmill/message-header/test-message-header.js</span>
<a href="#l3.2"></a><span id="l3.2" class="difflineplus">+++ b/mail/test/mozmill/message-header/test-message-header.js</span>
<a href="#l3.3"></a><span id="l3.3" class="difflineat">@@ -15,16 +15,17 @@</span>
<a href="#l3.4"></a><span id="l3.4">  *</span>
<a href="#l3.5"></a><span id="l3.5">  * The Initial Developer of the Original Code is</span>
<a href="#l3.6"></a><span id="l3.6">  * Mozilla Messaging, Inc.</span>
<a href="#l3.7"></a><span id="l3.7">  * Portions created by the Initial Developer are Copyright (C) 2009</span>
<a href="#l3.8"></a><span id="l3.8">  * the Initial Developer. All Rights Reserved.</span>
<a href="#l3.9"></a><span id="l3.9">  *</span>
<a href="#l3.10"></a><span id="l3.10">  * Contributor(s):</span>
<a href="#l3.11"></a><span id="l3.11">  *   Blake Winton &lt;bwinton@latte.ca&gt;</span>
<a href="#l3.12"></a><span id="l3.12" class="difflineplus">+ *   Dan Mosedale &lt;dmose@mozillamessaging.com&gt;</span>
<a href="#l3.13"></a><span id="l3.13">  *</span>
<a href="#l3.14"></a><span id="l3.14">  * Alternatively, the contents of this file may be used under the terms of</span>
<a href="#l3.15"></a><span id="l3.15">  * either the GNU General Public License Version 2 or later (the &quot;GPL&quot;), or</span>
<a href="#l3.16"></a><span id="l3.16">  * the GNU Lesser General Public License Version 2.1 or later (the &quot;LGPL&quot;),</span>
<a href="#l3.17"></a><span id="l3.17">  * in which case the provisions of the GPL or the LGPL are applicable instead</span>
<a href="#l3.18"></a><span id="l3.18">  * of those above. If you wish to allow use of your version of this file only</span>
<a href="#l3.19"></a><span id="l3.19">  * under the terms of either the GPL or the LGPL, and not to allow others to</span>
<a href="#l3.20"></a><span id="l3.20">  * use your version of this file under the terms of the MPL, indicate your</span>
<a href="#l3.21"></a><span id="l3.21" class="difflineat">@@ -39,44 +40,45 @@</span>
<a href="#l3.22"></a><span id="l3.22">  * Test that we can add a tag to a message without messing up the header.</span>
<a href="#l3.23"></a><span id="l3.23">  */</span>
<a href="#l3.24"></a><span id="l3.24"> var MODULE_NAME = 'test-message-header';</span>
<a href="#l3.25"></a><span id="l3.25"> </span>
<a href="#l3.26"></a><span id="l3.26"> var RELATIVE_ROOT = '../shared-modules';</span>
<a href="#l3.27"></a><span id="l3.27"> var MODULE_REQUIRES = ['folder-display-helpers', 'window-helpers'];</span>
<a href="#l3.28"></a><span id="l3.28"> </span>
<a href="#l3.29"></a><span id="l3.29"> var folder;</span>
<a href="#l3.30"></a><span id="l3.30" class="difflineminus">-var msg1;</span>
<a href="#l3.31"></a><span id="l3.31"> </span>
<a href="#l3.32"></a><span id="l3.32"> function setupModule(module) {</span>
<a href="#l3.33"></a><span id="l3.33">   let fdh = collector.getModule('folder-display-helpers');</span>
<a href="#l3.34"></a><span id="l3.34">   fdh.installInto(module);</span>
<a href="#l3.35"></a><span id="l3.35">   let wh = collector.getModule('window-helpers');</span>
<a href="#l3.36"></a><span id="l3.36">   wh.installInto(module);</span>
<a href="#l3.37"></a><span id="l3.37"> </span>
<a href="#l3.38"></a><span id="l3.38">   folder = create_folder(&quot;MessageWindowA&quot;);</span>
<a href="#l3.39"></a><span id="l3.39" class="difflineminus">-  // create a message to display in the folder</span>
<a href="#l3.40"></a><span id="l3.40" class="difflineminus">-  msg1 = create_thread(1);</span>
<a href="#l3.41"></a><span id="l3.41" class="difflineminus">-  add_sets_to_folders([folder], [msg1]);</span>
<a href="#l3.42"></a><span id="l3.42" class="difflineminus">-  baseFolder = create_folder(&quot;MailViewA&quot;);</span>
<a href="#l3.43"></a><span id="l3.43" class="difflineminus">-  folder.msgDatabase.dBFolderInfo.viewFlags = Ci.nsMsgViewFlagsType.kThreadedDisplay;</span>
<a href="#l3.44"></a><span id="l3.44" class="difflineplus">+</span>
<a href="#l3.45"></a><span id="l3.45" class="difflineplus">+  // create a message that has the interesting headers that commonly</span>
<a href="#l3.46"></a><span id="l3.46" class="difflineplus">+  // show up in the message header pane for testing</span>
<a href="#l3.47"></a><span id="l3.47" class="difflineplus">+  let msg = create_message({cc: [[&quot;John Doe&quot;, &quot;john.doe@momo.invalid&quot;]],</span>
<a href="#l3.48"></a><span id="l3.48" class="difflineplus">+                            clobberHeaders: {</span>
<a href="#l3.49"></a><span id="l3.49" class="difflineplus">+                              &quot;Newsgroups&quot;: &quot;alt.test&quot;,</span>
<a href="#l3.50"></a><span id="l3.50" class="difflineplus">+                              &quot;Reply-To&quot;: &quot;J. Doe &lt;j.doe@momo.invalid&gt;&quot;,</span>
<a href="#l3.51"></a><span id="l3.51" class="difflineplus">+                              &quot;Content-Base&quot;: &quot;http://example.com/&quot;,</span>
<a href="#l3.52"></a><span id="l3.52" class="difflineplus">+                              &quot;Bcc&quot;: &quot;Richard Roe &lt;richard.roe@momo.invalid&gt;&quot;</span>
<a href="#l3.53"></a><span id="l3.53" class="difflineplus">+                            }});</span>
<a href="#l3.54"></a><span id="l3.54" class="difflineplus">+</span>
<a href="#l3.55"></a><span id="l3.55" class="difflineplus">+  add_message_to_folder(folder, msg);</span>
<a href="#l3.56"></a><span id="l3.56"> }</span>
<a href="#l3.57"></a><span id="l3.57"> </span>
<a href="#l3.58"></a><span id="l3.58" class="difflineminus">-/** The message window controller. */</span>
<a href="#l3.59"></a><span id="l3.59" class="difflineminus">-var msgc;</span>
<a href="#l3.60"></a><span id="l3.60" class="difflineminus">-</span>
<a href="#l3.61"></a><span id="l3.61"> function test_add_tag_with_really_long_label() {</span>
<a href="#l3.62"></a><span id="l3.62">   be_in_folder(folder);</span>
<a href="#l3.63"></a><span id="l3.63"> </span>
<a href="#l3.64"></a><span id="l3.64" class="difflineminus">-  // select the first message</span>
<a href="#l3.65"></a><span id="l3.65" class="difflineplus">+  // select the first message, which will display it</span>
<a href="#l3.66"></a><span id="l3.66">   let curMessage = select_click_row(0);</span>
<a href="#l3.67"></a><span id="l3.67"> </span>
<a href="#l3.68"></a><span id="l3.68" class="difflineminus">-  // display it</span>
<a href="#l3.69"></a><span id="l3.69" class="difflineminus">-  msgc = open_selected_message_in_new_window();</span>
<a href="#l3.70"></a><span id="l3.70" class="difflineminus">-  assert_selected_and_displayed(msgc, curMessage);</span>
<a href="#l3.71"></a><span id="l3.71" class="difflineplus">+  assert_selected_and_displayed(mc, curMessage);</span>
<a href="#l3.72"></a><span id="l3.72"> </span>
<a href="#l3.73"></a><span id="l3.73">   let topColumn = mc.eid(&quot;expandedHeadersNameColumn&quot;).node;</span>
<a href="#l3.74"></a><span id="l3.74">   let bottomColumn = mc.eid(&quot;expandedHeaders2NameColumn&quot;).node;</span>
<a href="#l3.75"></a><span id="l3.75"> </span>
<a href="#l3.76"></a><span id="l3.76">   if (topColumn.clientWidth != bottomColumn.clientWidth)</span>
<a href="#l3.77"></a><span id="l3.77">     throw new Error(&quot;Header columns have different widths!  &quot; +</span>
<a href="#l3.78"></a><span id="l3.78">                     topColumn.clientWidth + &quot; != &quot; + bottomColumn.clientWidth);</span>
<a href="#l3.79"></a><span id="l3.79">   let defaultWidth = topColumn.clientWidth;</span>
<a href="#l3.80"></a><span id="l3.80" class="difflineat">@@ -93,22 +95,164 @@ function test_add_tag_with_really_long_l</span>
<a href="#l3.81"></a><span id="l3.81">   }</span>
<a href="#l3.82"></a><span id="l3.82">   if (topColumn.clientWidth != defaultWidth) {</span>
<a href="#l3.83"></a><span id="l3.83">     tagsLabel.value = oldTagsValue;</span>
<a href="#l3.84"></a><span id="l3.84">     throw new Error(&quot;Header columns changed width!  &quot; +</span>
<a href="#l3.85"></a><span id="l3.85">                     topColumn.clientWidth + &quot; != &quot; + defaultWidth);</span>
<a href="#l3.86"></a><span id="l3.86">   }</span>
<a href="#l3.87"></a><span id="l3.87"> </span>
<a href="#l3.88"></a><span id="l3.88">   // Add the first tag, and make sure that the label are the same length.</span>
<a href="#l3.89"></a><span id="l3.89" class="difflineminus">-  msgc.keypress(mc.eid(&quot;expandedHeadersNameColumn&quot;), &quot;1&quot;, {});</span>
<a href="#l3.90"></a><span id="l3.90" class="difflineplus">+  mc.keypress(mc.eid(&quot;expandedHeadersNameColumn&quot;), &quot;1&quot;, {});</span>
<a href="#l3.91"></a><span id="l3.91"> </span>
<a href="#l3.92"></a><span id="l3.92">   if (topColumn.clientWidth != bottomColumn.clientWidth) {</span>
<a href="#l3.93"></a><span id="l3.93">     tagsLabel.value = oldTagsValue;</span>
<a href="#l3.94"></a><span id="l3.94">     throw new Error(&quot;Header columns have different widths!  &quot; +</span>
<a href="#l3.95"></a><span id="l3.95">                     topColumn.clientWidth + &quot; != &quot; + bottomColumn.clientWidth);</span>
<a href="#l3.96"></a><span id="l3.96">   }</span>
<a href="#l3.97"></a><span id="l3.97">   if (topColumn.clientWidth == defaultWidth) {</span>
<a href="#l3.98"></a><span id="l3.98">     tagsLabel.value = oldTagsValue;</span>
<a href="#l3.99"></a><span id="l3.99">     throw new Error(&quot;Header columns didn't change width!  &quot; +</span>
<a href="#l3.100"></a><span id="l3.100">                     topColumn.clientWidth + &quot; != &quot; + defaultWidth);</span>
<a href="#l3.101"></a><span id="l3.101">   }</span>
<a href="#l3.102"></a><span id="l3.102"> </span>
<a href="#l3.103"></a><span id="l3.103" class="difflineplus">+  // Remove the tag and put it back so that the a11y label gets regenerated</span>
<a href="#l3.104"></a><span id="l3.104" class="difflineplus">+  // with the normal value rather than &quot;taaaaaaaags&quot;</span>
<a href="#l3.105"></a><span id="l3.105" class="difflineplus">+  tagsLabel.value = oldTagsValue;</span>
<a href="#l3.106"></a><span id="l3.106" class="difflineplus">+  mc.keypress(mc.eid(&quot;expandedHeadersNameColumn&quot;), &quot;1&quot;, {});</span>
<a href="#l3.107"></a><span id="l3.107" class="difflineplus">+  mc.keypress(mc.eid(&quot;expandedHeadersNameColumn&quot;), &quot;1&quot;, {});</span>
<a href="#l3.108"></a><span id="l3.108"> }</span>
<a href="#l3.109"></a><span id="l3.109" class="difflineplus">+</span>
<a href="#l3.110"></a><span id="l3.110" class="difflineplus">+/**</span>
<a href="#l3.111"></a><span id="l3.111" class="difflineplus">+ * @param headerName used for pretty-printing in exceptions</span>
<a href="#l3.112"></a><span id="l3.112" class="difflineplus">+ * @param headerValueElement code to be eval()ed returning the DOM element</span>
<a href="#l3.113"></a><span id="l3.113" class="difflineplus">+ *        with the data.</span>
<a href="#l3.114"></a><span id="l3.114" class="difflineplus">+ * @param expectedName code to be eval()ed returning the expected value of</span>
<a href="#l3.115"></a><span id="l3.115" class="difflineplus">+ *                     nsIAccessible.name for the DOM element in question</span>
<a href="#l3.116"></a><span id="l3.116" class="difflineplus">+ * @param expectedFinalRole the expected value for nsIAccessible.finalRole</span>
<a href="#l3.117"></a><span id="l3.117" class="difflineplus">+ */</span>
<a href="#l3.118"></a><span id="l3.118" class="difflineplus">+let headersToTest = [</span>
<a href="#l3.119"></a><span id="l3.119" class="difflineplus">+{</span>
<a href="#l3.120"></a><span id="l3.120" class="difflineplus">+  headerName: &quot;Subject&quot;,</span>
<a href="#l3.121"></a><span id="l3.121" class="difflineplus">+  headerValueElement: &quot;mc.a('expandedsubjectBox', {class: 'headerValue'})&quot;,</span>
<a href="#l3.122"></a><span id="l3.122" class="difflineplus">+  expectedName: &quot;mc.e('expandedsubjectLabel').value.slice(0,-1) + ': ' + &quot; +</span>
<a href="#l3.123"></a><span id="l3.123" class="difflineplus">+                &quot;headerValueElement.textContent&quot;,</span>
<a href="#l3.124"></a><span id="l3.124" class="difflineplus">+  expectedFinalRole: Ci.nsIAccessibleRole.ROLE_ENTRY</span>
<a href="#l3.125"></a><span id="l3.125" class="difflineplus">+},</span>
<a href="#l3.126"></a><span id="l3.126" class="difflineplus">+{</span>
<a href="#l3.127"></a><span id="l3.127" class="difflineplus">+  headerName: &quot;Content-Base&quot;,</span>
<a href="#l3.128"></a><span id="l3.128" class="difflineplus">+  headerValueElement: &quot;mc.a('expandedcontent-baseBox', {class: 'headerValue text-link headerValueUrl'})&quot;,</span>
<a href="#l3.129"></a><span id="l3.129" class="difflineplus">+  expectedName: &quot;mc.e('expandedcontent-baseLabel').value.slice(0,-1) + ': ' + &quot; +</span>
<a href="#l3.130"></a><span id="l3.130" class="difflineplus">+                &quot;headerValueElement.textContent&quot;,</span>
<a href="#l3.131"></a><span id="l3.131" class="difflineplus">+  expectedFinalRole: Ci.nsIAccessibleRole.ROLE_ENTRY</span>
<a href="#l3.132"></a><span id="l3.132" class="difflineplus">+},</span>
<a href="#l3.133"></a><span id="l3.133" class="difflineplus">+{</span>
<a href="#l3.134"></a><span id="l3.134" class="difflineplus">+  headerName: &quot;From&quot;,</span>
<a href="#l3.135"></a><span id="l3.135" class="difflineplus">+  headerValueElement: &quot;mc.window.document.getAnonymousElementByAttribute(&quot; + </span>
<a href="#l3.136"></a><span id="l3.136" class="difflineplus">+                      &quot;mc.a('expandedfromBox', {tagName: 'mail-emailaddress'}),&quot; +</span>
<a href="#l3.137"></a><span id="l3.137" class="difflineplus">+                      &quot;'class', 'emailDisplayButton')&quot;,</span>
<a href="#l3.138"></a><span id="l3.138" class="difflineplus">+  expectedName: &quot;mc.e('expandedfromLabel').value.slice(0,-1) + ': ' + &quot; +</span>
<a href="#l3.139"></a><span id="l3.139" class="difflineplus">+                &quot;headerValueElement.parentNode.getAttribute('fullAddress')&quot;,</span>
<a href="#l3.140"></a><span id="l3.140" class="difflineplus">+  expectedFinalRole: Ci.nsIAccessibleRole.ROLE_ENTRY</span>
<a href="#l3.141"></a><span id="l3.141" class="difflineplus">+},</span>
<a href="#l3.142"></a><span id="l3.142" class="difflineplus">+{</span>
<a href="#l3.143"></a><span id="l3.143" class="difflineplus">+  headerName: &quot;To&quot;,</span>
<a href="#l3.144"></a><span id="l3.144" class="difflineplus">+  headerValueElement: &quot;mc.window.document.getAnonymousElementByAttribute(&quot; +</span>
<a href="#l3.145"></a><span id="l3.145" class="difflineplus">+                      &quot;mc.a('expandedtoBox', {tagName: 'mail-emailaddress'}),&quot; +</span>
<a href="#l3.146"></a><span id="l3.146" class="difflineplus">+                      &quot;'class', 'emailDisplayButton')&quot;,</span>
<a href="#l3.147"></a><span id="l3.147" class="difflineplus">+  expectedName: &quot;mc.e('expandedtoLabel').value.slice(0,-1) + ': ' + &quot; + </span>
<a href="#l3.148"></a><span id="l3.148" class="difflineplus">+                &quot;headerValueElement.parentNode.getAttribute('fullAddress')&quot;,</span>
<a href="#l3.149"></a><span id="l3.149" class="difflineplus">+  expectedFinalRole: Ci.nsIAccessibleRole.ROLE_ENTRY</span>
<a href="#l3.150"></a><span id="l3.150" class="difflineplus">+},</span>
<a href="#l3.151"></a><span id="l3.151" class="difflineplus">+{</span>
<a href="#l3.152"></a><span id="l3.152" class="difflineplus">+  headerName: &quot;Cc&quot;,</span>
<a href="#l3.153"></a><span id="l3.153" class="difflineplus">+  headerValueElement: &quot;mc.window.document.getAnonymousElementByAttribute(&quot; +</span>
<a href="#l3.154"></a><span id="l3.154" class="difflineplus">+                      &quot;mc.a('expandedccBox', {tagName: 'mail-emailaddress'}),&quot; +</span>
<a href="#l3.155"></a><span id="l3.155" class="difflineplus">+                      &quot;'class', 'emailDisplayButton')&quot;,</span>
<a href="#l3.156"></a><span id="l3.156" class="difflineplus">+  expectedName: &quot;mc.e('expandedccLabel').value.slice(0,-1) + ': ' + &quot; +</span>
<a href="#l3.157"></a><span id="l3.157" class="difflineplus">+                &quot;headerValueElement.parentNode.getAttribute('fullAddress')&quot;,</span>
<a href="#l3.158"></a><span id="l3.158" class="difflineplus">+  expectedFinalRole: Ci.nsIAccessibleRole.ROLE_ENTRY</span>
<a href="#l3.159"></a><span id="l3.159" class="difflineplus">+},</span>
<a href="#l3.160"></a><span id="l3.160" class="difflineplus">+{</span>
<a href="#l3.161"></a><span id="l3.161" class="difflineplus">+  headerName: &quot;Bcc&quot;,</span>
<a href="#l3.162"></a><span id="l3.162" class="difflineplus">+  headerValueElement: &quot;mc.window.document.getAnonymousElementByAttribute(&quot; +</span>
<a href="#l3.163"></a><span id="l3.163" class="difflineplus">+                      &quot;mc.a('expandedbccBox', {tagName: 'mail-emailaddress'}),&quot; +</span>
<a href="#l3.164"></a><span id="l3.164" class="difflineplus">+                      &quot;'class', 'emailDisplayButton')&quot;,</span>
<a href="#l3.165"></a><span id="l3.165" class="difflineplus">+  expectedName: &quot;mc.e('expandedbccLabel').value.slice(0,-1) + ': ' + &quot; +</span>
<a href="#l3.166"></a><span id="l3.166" class="difflineplus">+                &quot;headerValueElement.parentNode.getAttribute('fullAddress')&quot;,</span>
<a href="#l3.167"></a><span id="l3.167" class="difflineplus">+  expectedFinalRole: Ci.nsIAccessibleRole.ROLE_ENTRY</span>
<a href="#l3.168"></a><span id="l3.168" class="difflineplus">+},</span>
<a href="#l3.169"></a><span id="l3.169" class="difflineplus">+{</span>
<a href="#l3.170"></a><span id="l3.170" class="difflineplus">+  headerName: &quot;Reply-To&quot;,</span>
<a href="#l3.171"></a><span id="l3.171" class="difflineplus">+  headerValueElement: &quot;mc.window.document.getAnonymousElementByAttribute(&quot; +</span>
<a href="#l3.172"></a><span id="l3.172" class="difflineplus">+                      &quot;mc.a('expandedreply-toBox', {tagName: 'mail-emailaddress'}),&quot; +</span>
<a href="#l3.173"></a><span id="l3.173" class="difflineplus">+                      &quot;'class', 'emailDisplayButton')&quot;,</span>
<a href="#l3.174"></a><span id="l3.174" class="difflineplus">+  expectedName: &quot;mc.e('expandedreply-toLabel').value.slice(0,-1) + ': ' + &quot; +</span>
<a href="#l3.175"></a><span id="l3.175" class="difflineplus">+                &quot;headerValueElement.parentNode.getAttribute('fullAddress')&quot;,</span>
<a href="#l3.176"></a><span id="l3.176" class="difflineplus">+  expectedFinalRole: Ci.nsIAccessibleRole.ROLE_ENTRY</span>
<a href="#l3.177"></a><span id="l3.177" class="difflineplus">+},</span>
<a href="#l3.178"></a><span id="l3.178" class="difflineplus">+{</span>
<a href="#l3.179"></a><span id="l3.179" class="difflineplus">+  headerName: &quot;Newsgroups&quot;,</span>
<a href="#l3.180"></a><span id="l3.180" class="difflineplus">+  headerValueElement: &quot;mc.window.document.getAnonymousElementByAttribute(&quot; +</span>
<a href="#l3.181"></a><span id="l3.181" class="difflineplus">+                      &quot;mc.a('expandednewsgroupsBox', {tagName: 'mail-newsgroup'}),&quot; +</span>
<a href="#l3.182"></a><span id="l3.182" class="difflineplus">+                      &quot;'class', 'newsgrouplabel')&quot;,</span>
<a href="#l3.183"></a><span id="l3.183" class="difflineplus">+  expectedName: &quot;mc.e('expandednewsgroupsLabel').value.slice(0,-1) + ': ' + &quot; +</span>
<a href="#l3.184"></a><span id="l3.184" class="difflineplus">+                &quot;headerValueElement.parentNode.parentNode.getAttribute('newsgroup')&quot;,</span>
<a href="#l3.185"></a><span id="l3.185" class="difflineplus">+  expectedFinalRole: Ci.nsIAccessibleRole.ROLE_ENTRY</span>
<a href="#l3.186"></a><span id="l3.186" class="difflineplus">+},</span>
<a href="#l3.187"></a><span id="l3.187" class="difflineplus">+{</span>
<a href="#l3.188"></a><span id="l3.188" class="difflineplus">+  headerName: &quot;Tags&quot;,</span>
<a href="#l3.189"></a><span id="l3.189" class="difflineplus">+  headerValueElement: &quot;mc.a('expandedtagsBox', {class: 'tagvalue blc-FF0000'})&quot;,</span>
<a href="#l3.190"></a><span id="l3.190" class="difflineplus">+  expectedName: &quot;mc.e('expandedtagsLabel').value.slice(0,-1) + ': ' + &quot; +</span>
<a href="#l3.191"></a><span id="l3.191" class="difflineplus">+                &quot;headerValueElement.getAttribute('value')&quot;,</span>
<a href="#l3.192"></a><span id="l3.192" class="difflineplus">+  expectedFinalRole: Ci.nsIAccessibleRole.ROLE_LABEL</span>
<a href="#l3.193"></a><span id="l3.193" class="difflineplus">+}</span>
<a href="#l3.194"></a><span id="l3.194" class="difflineplus">+];</span>
<a href="#l3.195"></a><span id="l3.195" class="difflineplus">+</span>
<a href="#l3.196"></a><span id="l3.196" class="difflineplus">+// used to get the accessible object for a DOM node</span>
<a href="#l3.197"></a><span id="l3.197" class="difflineplus">+let gAccRetrieval = Cc[&quot;@mozilla.org/accessibleRetrieval;1&quot;].</span>
<a href="#l3.198"></a><span id="l3.198" class="difflineplus">+                    getService(Ci.nsIAccessibleRetrieval);</span>
<a href="#l3.199"></a><span id="l3.199" class="difflineplus">+</span>
<a href="#l3.200"></a><span id="l3.200" class="difflineplus">+/**</span>
<a href="#l3.201"></a><span id="l3.201" class="difflineplus">+ * Use the information from aHeaderInfo to verify that screenreaders will</span>
<a href="#l3.202"></a><span id="l3.202" class="difflineplus">+ * do the right thing with the given message header.</span>
<a href="#l3.203"></a><span id="l3.203" class="difflineplus">+ *</span>
<a href="#l3.204"></a><span id="l3.204" class="difflineplus">+ * @param {Object} aHeaderInfo  Information about how to do the verification;</span>
<a href="#l3.205"></a><span id="l3.205" class="difflineplus">+ *                              See the comments above the headersToTest array</span>
<a href="#l3.206"></a><span id="l3.206" class="difflineplus">+ *                              for details.</span>
<a href="#l3.207"></a><span id="l3.207" class="difflineplus">+ */</span>
<a href="#l3.208"></a><span id="l3.208" class="difflineplus">+function verify_header_a11y(aHeaderInfo) {</span>
<a href="#l3.209"></a><span id="l3.209" class="difflineplus">+</span>
<a href="#l3.210"></a><span id="l3.210" class="difflineplus">+  let headerValueElement = eval(aHeaderInfo.headerValueElement);</span>
<a href="#l3.211"></a><span id="l3.211" class="difflineplus">+</span>
<a href="#l3.212"></a><span id="l3.212" class="difflineplus">+  let headerAccessible = gAccRetrieval.getAccessibleFor(headerValueElement);</span>
<a href="#l3.213"></a><span id="l3.213" class="difflineplus">+  if (headerAccessible.finalRole != aHeaderInfo.expectedFinalRole) {</span>
<a href="#l3.214"></a><span id="l3.214" class="difflineplus">+    throw new Error(&quot;finalRole for &quot; + aHeaderInfo.headerName + &quot; was &quot; +</span>
<a href="#l3.215"></a><span id="l3.215" class="difflineplus">+                    headerAccessible.finalRole + &quot;; should have been &quot; +</span>
<a href="#l3.216"></a><span id="l3.216" class="difflineplus">+                    aHeaderInfo.expectedFinalRole);</span>
<a href="#l3.217"></a><span id="l3.217" class="difflineplus">+  }</span>
<a href="#l3.218"></a><span id="l3.218" class="difflineplus">+</span>
<a href="#l3.219"></a><span id="l3.219" class="difflineplus">+  let expectedName = eval(aHeaderInfo.expectedName);</span>
<a href="#l3.220"></a><span id="l3.220" class="difflineplus">+  if (headerAccessible.name != expectedName) {</span>
<a href="#l3.221"></a><span id="l3.221" class="difflineplus">+    throw new Error(&quot;headerAccessible.name for &quot; + aHeaderInfo.headerName +</span>
<a href="#l3.222"></a><span id="l3.222" class="difflineplus">+                    &quot; was '&quot; + headerAccessible.name + &quot;'; expected '&quot; +</span>
<a href="#l3.223"></a><span id="l3.223" class="difflineplus">+                    expectedName + &quot;'&quot;);</span>
<a href="#l3.224"></a><span id="l3.224" class="difflineplus">+  }</span>
<a href="#l3.225"></a><span id="l3.225" class="difflineplus">+}</span>
<a href="#l3.226"></a><span id="l3.226" class="difflineplus">+</span>
<a href="#l3.227"></a><span id="l3.227" class="difflineplus">+/**</span>
<a href="#l3.228"></a><span id="l3.228" class="difflineplus">+ * Test the accessibility attributes of the various message headers.</span>
<a href="#l3.229"></a><span id="l3.229" class="difflineplus">+ */</span>
<a href="#l3.230"></a><span id="l3.230" class="difflineplus">+function test_a11y_attrs() {</span>
<a href="#l3.231"></a><span id="l3.231" class="difflineplus">+  // skip this test on platforms that don't support accessibility</span>
<a href="#l3.232"></a><span id="l3.232" class="difflineplus">+  if (!(&quot;nsIAccessibleRole&quot; in Components.interfaces))</span>
<a href="#l3.233"></a><span id="l3.233" class="difflineplus">+    return;</span>
<a href="#l3.234"></a><span id="l3.234" class="difflineplus">+</span>
<a href="#l3.235"></a><span id="l3.235" class="difflineplus">+  be_in_folder(folder);</span>
<a href="#l3.236"></a><span id="l3.236" class="difflineplus">+</span>
<a href="#l3.237"></a><span id="l3.237" class="difflineplus">+  // select and open the first message</span>
<a href="#l3.238"></a><span id="l3.238" class="difflineplus">+  let curMessage = select_click_row(0);</span>
<a href="#l3.239"></a><span id="l3.239" class="difflineplus">+</span>
<a href="#l3.240"></a><span id="l3.240" class="difflineplus">+  // make sure it loads</span>
<a href="#l3.241"></a><span id="l3.241" class="difflineplus">+  wait_for_message_display_completion(mc);</span>
<a href="#l3.242"></a><span id="l3.242" class="difflineplus">+  assert_selected_and_displayed(mc, curMessage);</span>
<a href="#l3.243"></a><span id="l3.243" class="difflineplus">+</span>
<a href="#l3.244"></a><span id="l3.244" class="difflineplus">+  headersToTest.forEach(verify_header_a11y);</span>
<a href="#l3.245"></a><span id="l3.245" class="difflineplus">+}</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l4.1"></a><span id="l4.1" class="difflineminus">--- a/mail/test/mozmill/shared-modules/test-folder-display-helpers.js</span>
<a href="#l4.2"></a><span id="l4.2" class="difflineplus">+++ b/mail/test/mozmill/shared-modules/test-folder-display-helpers.js</span>
<a href="#l4.3"></a><span id="l4.3" class="difflineat">@@ -238,16 +238,39 @@ function create_virtual_folder() {</span>
<a href="#l4.4"></a><span id="l4.4">  * Create a thread with the specified number of messages in it.</span>
<a href="#l4.5"></a><span id="l4.5">  */</span>
<a href="#l4.6"></a><span id="l4.6"> function create_thread(aCount) {</span>
<a href="#l4.7"></a><span id="l4.7">   return new testHelperModule.SyntheticMessageSet(</span>
<a href="#l4.8"></a><span id="l4.8">     testHelperModule.gMessageScenarioFactory.directReply(aCount));</span>
<a href="#l4.9"></a><span id="l4.9"> }</span>
<a href="#l4.10"></a><span id="l4.10"> </span>
<a href="#l4.11"></a><span id="l4.11"> /**</span>
<a href="#l4.12"></a><span id="l4.12" class="difflineplus">+ * Create and return a SyntheticMessage object.</span>
<a href="#l4.13"></a><span id="l4.13" class="difflineplus">+ *</span>
<a href="#l4.14"></a><span id="l4.14" class="difflineplus">+ * @param {Object} aArgs An arguments object to be passed to</span>
<a href="#l4.15"></a><span id="l4.15" class="difflineplus">+ *                       MessageGenerator.makeMessage()</span>
<a href="#l4.16"></a><span id="l4.16" class="difflineplus">+ */</span>
<a href="#l4.17"></a><span id="l4.17" class="difflineplus">+ function create_message(aArgs) {</span>
<a href="#l4.18"></a><span id="l4.18" class="difflineplus">+  return msgGen.makeMessage(aArgs);</span>
<a href="#l4.19"></a><span id="l4.19" class="difflineplus">+}</span>
<a href="#l4.20"></a><span id="l4.20" class="difflineplus">+</span>
<a href="#l4.21"></a><span id="l4.21" class="difflineplus">+/**</span>
<a href="#l4.22"></a><span id="l4.22" class="difflineplus">+ * Add a SyntheticMessage to a folder.</span>
<a href="#l4.23"></a><span id="l4.23" class="difflineplus">+ *</span>
<a href="#l4.24"></a><span id="l4.24" class="difflineplus">+ * @param {SyntheticMessage} aMsg</span>
<a href="#l4.25"></a><span id="l4.25" class="difflineplus">+ * @param {Object} aFolder</span>
<a href="#l4.26"></a><span id="l4.26" class="difflineplus">+ */</span>
<a href="#l4.27"></a><span id="l4.27" class="difflineplus">+function add_message_to_folder(aFolder, aMsg) {</span>
<a href="#l4.28"></a><span id="l4.28" class="difflineplus">+  // should presumably use async_run here, but since setupAccountStuff is</span>
<a href="#l4.29"></a><span id="l4.29" class="difflineplus">+  // using a local store, it should be safe to assume synchronicity</span>
<a href="#l4.30"></a><span id="l4.30" class="difflineplus">+  add_sets_to_folders([aFolder],</span>
<a href="#l4.31"></a><span id="l4.31" class="difflineplus">+                      [new testHelperModule.SyntheticMessageSet([aMsg])]); </span>
<a href="#l4.32"></a><span id="l4.32" class="difflineplus">+}</span>
<a href="#l4.33"></a><span id="l4.33" class="difflineplus">+</span>
<a href="#l4.34"></a><span id="l4.34" class="difflineplus">+/**</span>
<a href="#l4.35"></a><span id="l4.35">  * Make sure we are entering the folder from not having been in the folder.  We</span>
<a href="#l4.36"></a><span id="l4.36">  *  will leave the folder and come back if we have to.</span>
<a href="#l4.37"></a><span id="l4.37">  */</span>
<a href="#l4.38"></a><span id="l4.38"> function enter_folder(aFolder) {</span>
<a href="#l4.39"></a><span id="l4.39">   // Drain the event queue prior to doing any work.  It's possible that there's</span>
<a href="#l4.40"></a><span id="l4.40">   //  a pending setTimeout(0) that needs to get fired.</span>
<a href="#l4.41"></a><span id="l4.41">   controller.sleep(0);</span>
<a href="#l4.42"></a><span id="l4.42">   // if we're already selected, go back to the root...</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l5.1"></a><span id="l5.1" class="difflineminus">--- a/mail/test/mozmill/shared-modules/test-window-helpers.js</span>
<a href="#l5.2"></a><span id="l5.2" class="difflineplus">+++ b/mail/test/mozmill/shared-modules/test-window-helpers.js</span>
<a href="#l5.3"></a><span id="l5.3" class="difflineat">@@ -585,17 +585,17 @@ var AugmentEverybodyWith = {</span>
<a href="#l5.4"></a><span id="l5.4">      *  are not doing what you want.  For example, jerks that don't focus right.</span>
<a href="#l5.5"></a><span id="l5.5">      *</span>
<a href="#l5.6"></a><span id="l5.6">      * Examples:</span>
<a href="#l5.7"></a><span id="l5.7">      *  // by class of the node</span>
<a href="#l5.8"></a><span id="l5.8">      *  a(&quot;searchVal0&quot;, {class: &quot;search-value-textbox&quot;});</span>
<a href="#l5.9"></a><span id="l5.9">      *  // when the thing is vaguely deck-like</span>
<a href="#l5.10"></a><span id="l5.10">      *  a(&quot;searchVal0&quot;, {crazyDeck: 0});</span>
<a href="#l5.11"></a><span id="l5.11">      *  // when you want the first descendent with the given tagName</span>
<a href="#l5.12"></a><span id="l5.12" class="difflineminus">-     *  a(&quot;threadTree&quot;, {tagName: treechildren})</span>
<a href="#l5.13"></a><span id="l5.13" class="difflineplus">+     *  a(&quot;threadTree&quot;, {tagName: &quot;treechildren&quot;})</span>
<a href="#l5.14"></a><span id="l5.14">      *</span>
<a href="#l5.15"></a><span id="l5.15">      * @return the anonymous element determined by the query found in the</span>
<a href="#l5.16"></a><span id="l5.16">      *  anonymous sub-tree of the element with the given id.</span>
<a href="#l5.17"></a><span id="l5.17">      */</span>
<a href="#l5.18"></a><span id="l5.18">     a: function _get_anon_element_by_id_and_query(aId, aQuery) {</span>
<a href="#l5.19"></a><span id="l5.19">       let realElem = this.window.document.getElementById(aId);</span>
<a href="#l5.20"></a><span id="l5.20">       if (aQuery[&quot;class&quot;]) {</span>
<a href="#l5.21"></a><span id="l5.21">         return this.window.document.getAnonymousElementByAttribute(</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l6.1"></a><span id="l6.1" class="difflineminus">--- a/mailnews/test/resources/messageInjection.js</span>
<a href="#l6.2"></a><span id="l6.2" class="difflineplus">+++ b/mailnews/test/resources/messageInjection.js</span>
<a href="#l6.3"></a><span id="l6.3" class="difflineat">@@ -617,19 +617,20 @@ let _imapNewMessagesWorkaround = {</span>
<a href="#l6.4"></a><span id="l6.4">  *  folder 1: [a A d D G]</span>
<a href="#l6.5"></a><span id="l6.5">  *  folder 2: [b B e E H]</span>
<a href="#l6.6"></a><span id="l6.6">  *  folder 3: [c C f F]</span>
<a href="#l6.7"></a><span id="l6.7">  *</span>
<a href="#l6.8"></a><span id="l6.8">  * @param aMsgFolders An nsIMsgLocalMailFolder to add the message sets to or a</span>
<a href="#l6.9"></a><span id="l6.9">  *     list of them.</span>
<a href="#l6.10"></a><span id="l6.10">  * @param aMessageSets A list of SyntheticMessageSets.</span>
<a href="#l6.11"></a><span id="l6.11">  *</span>
<a href="#l6.12"></a><span id="l6.12" class="difflineminus">- * @return true if we were able to do the injection synchronously, false if we</span>
<a href="#l6.13"></a><span id="l6.13" class="difflineminus">- *     kicked off an asynchronous process and we will call |async_driver| when</span>
<a href="#l6.14"></a><span id="l6.14" class="difflineminus">- *     we are done.  This is consistent with  asyncTestUtils support.</span>
<a href="#l6.15"></a><span id="l6.15" class="difflineplus">+ * @return true if we were able to do the injection synchronously (e.g. for</span>
<a href="#l6.16"></a><span id="l6.16" class="difflineplus">+ *     a localstore account), false if we kicked off an asynchronous process</span>
<a href="#l6.17"></a><span id="l6.17" class="difflineplus">+ *     (e.g. for an imap account) and we will call |async_driver| when</span>
<a href="#l6.18"></a><span id="l6.18" class="difflineplus">+ *     we are done.  This is consistent with asyncTestUtils support.</span>
<a href="#l6.19"></a><span id="l6.19">  */</span>
<a href="#l6.20"></a><span id="l6.20"> function add_sets_to_folders(aMsgFolders, aMessageSets) {</span>
<a href="#l6.21"></a><span id="l6.21">   if ((typeof(aMsgFolders) == &quot;string&quot;) || !('length' in aMsgFolders))</span>
<a href="#l6.22"></a><span id="l6.22">     aMsgFolders = [aMsgFolders];</span>
<a href="#l6.23"></a><span id="l6.23"> </span>
<a href="#l6.24"></a><span id="l6.24">   let mis = _messageInjectionSetup;</span>
<a href="#l6.25"></a><span id="l6.25"> </span>
<a href="#l6.26"></a><span id="l6.26">   let iterFolders, folderList;</span></pre></div></div>

<div class="page_footer">
<div class="page_footer_text">comm-central</div>
<div class="page_footer_text" style="padding-left: 10px">Deployed from <a href="https://hg.mozilla.org/hgcustom/version-control-tools/rev/35f393d6769a">35f393d6769a</a> at 2020-07-16T17:23:43Z.</div>
<div class="rss_logo">
<a href="/comm-central/rss-log">RSS</a>
<a href="/comm-central/atom-log">Atom</a>
</div>
<br />

</div>
</body>
</html>

