<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en-US" lang="en-US">
<head>
<link rel="icon" href="/static/4b0de666d1a4/hgicon.png" type="image/png" />
<meta name="robots" content="index, nofollow"/>
<link rel="stylesheet" href="/static/4b0de666d1a4/style-gitweb.css" type="text/css" />

<style type="text/css">
div.feed {
  float: right;
}
a img {
  border-width: 0px;
}
div.log_link {
  width: 80px;
  background-color: white;
}

div.log_body {
  padding-left: 96px;
}
</style>
<script type="text/javascript" src="/static/4b0de666d1a4/mercurial.js"></script>

<meta property="og:image" content="/static/4b0de666d1a4/moz-logo-bw-rgb.svg"/>
<meta property="og:type" content="website"/>

<title>comm-central: changeset 24674:0cac668a566b3f8bbfda07a76506b279d50215ec</title>
<link rel="alternate" type="application/atom+xml"
   href="/comm-central/atom-log" title="Atom feed for comm-central"/>
<link rel="alternate" type="application/rss+xml"
   href="/comm-central/rss-log" title="RSS feed for comm-central"/>

<meta property="og:title" content="comm-central @ 0cac668a566b3f8bbfda07a76506b279d50215ec" />
<meta property="og:url" content="/comm-central/rev/0cac668a566b3f8bbfda07a76506b279d50215ec" />
<meta property="og:description" content="Bug 1478572 - Turn on ESLint in mail/components/preferences (automatic changes). r=aceman" />

</head>
<body>

<div class="page_header">
<div class="logo">
    <a href="https://developer.mozilla.org/en/docs/Mercurial">
        <img src="/static/4b0de666d1a4/moz-logo-bw-rgb.svg" alt="mercurial" />
    </a>
</div>
<a href="/">Mercurial</a> &gt; <a href="/comm-central">comm-central</a>  / changeset / 0cac668a566b3f8bbfda07a76506b279d50215ec 
</div>

<div class="page_nav">
<div>
<a href="/comm-central/summary">summary</a> |
<a href="/comm-central/shortlog/0cac668a566b3f8bbfda07a76506b279d50215ec">shortlog</a> |
<a href="/comm-central/log/0cac668a566b3f8bbfda07a76506b279d50215ec">changelog</a> |
<a href="/comm-central/pushloghtml">pushlog</a> |
<a href="/comm-central/graph/0cac668a566b3f8bbfda07a76506b279d50215ec">graph</a> |
<a href="/comm-central/tags">tags</a> |
<a href="/comm-central/bookmarks">bookmarks</a> |
<a href="/comm-central/branches">branches</a> |
<a href="/comm-central/file/0cac668a566b3f8bbfda07a76506b279d50215ec">files</a> |
changeset |
<a href="/comm-central/raw-rev/0cac668a566b3f8bbfda07a76506b279d50215ec">raw</a>  | <a href="/comm-central/archive/0cac668a566b3f8bbfda07a76506b279d50215ec.zip">zip</a>  |
<a href="/comm-central/help">help</a>
</div>

<div class="search">
<form id="searchform" action="/comm-central/log">

<input name="rev" type="text" value="" size="40" />
<div id="hint">Find changesets by keywords (author, files, the commit message), revision
number or hash, or <a href="/comm-central/help/revsets">revset expression</a>.</div>
</form>
</div>
</div>

<div class="title">
<a href="https://bugzilla.mozilla.org/show_bug.cgi?id=1478572">Bug 1478572</a> - Turn on ESLint in mail/components/preferences (automatic changes). r=aceman
<span class="logtags"></span>
</div>
<div class="title_text">
<table cellspacing="0">

<tr><td>author</td><td>&#71;&#101;&#111;&#102;&#102;&#32;&#76;&#97;&#110;&#107;&#111;&#119;&#32;&#60;&#103;&#101;&#111;&#102;&#102;&#64;&#100;&#97;&#114;&#107;&#116;&#114;&#111;&#106;&#97;&#110;&#46;&#110;&#101;&#116;&#62;</td></tr>
<tr><td></td><td class="date age">Mon, 03 Sep 2018 17:23:00 +1200</td></tr>

<tr>
 <td>changeset 24674</td>
 <td style="font-family:monospace"><a class="list" href="/comm-central/rev/0cac668a566b3f8bbfda07a76506b279d50215ec">0cac668a566b3f8bbfda07a76506b279d50215ec</a></td>
</tr>



<tr>
<td>parent 24673</td>
<td style="font-family:monospace">
<a class="list" href="/comm-central/rev/a86f6197340ca93718eed554ae3c9a5417f4899a">a86f6197340ca93718eed554ae3c9a5417f4899a</a>
</td>
</tr>

<tr>
<td>child 24675</td>
<td style="font-family:monospace">
<a class="list" href="/comm-central/rev/2a29ee0adb310b54a6a2df72034953fed8f2b043">2a29ee0adb310b54a6a2df72034953fed8f2b043</a>
</td>
</tr>
<tr><td>push id</td><td><a href="/comm-central/pushloghtml?changeset=0cac668a566b3f8bbfda07a76506b279d50215ec">14846</a></td></tr>
<tr><td>push user</td><td>mozilla@jorgk.com</td></tr>
<tr><td>push date</td><td class="date age">Fri, 07 Sep 2018 08:28:21 +0000</td></tr>

<tr><td>treeherder</td><td>comm-central@2a29ee0adb31 [<a href="https://treeherder.mozilla.org/#/jobs?repo=comm-central&revision=2a29ee0adb310b54a6a2df72034953fed8f2b043">default view</a>] [<a href="https://treeherder.mozilla.org/#/jobs?repo=comm-central&revision=2a29ee0adb310b54a6a2df72034953fed8f2b043&filter-resultStatus=testfailed&filter-resultStatus=busted&filter-resultStatus=exception">failures only]</td></tr>
<tr><td>perfherder</td><td>[<a href="https://treeherder.mozilla.org/perf.html#/compare?originalProject=comm-central&originalRevision=2a29ee0adb310b54a6a2df72034953fed8f2b043&newProject=comm-central&newRevision=0cac668a566b3f8bbfda07a76506b279d50215ec&framework=1" target="_blank">talos</a>] [<a href="https://treeherder.mozilla.org/perf.html#/compare?originalProject=comm-central&originalRevision=2a29ee0adb310b54a6a2df72034953fed8f2b043&newProject=comm-central&newRevision=0cac668a566b3f8bbfda07a76506b279d50215ec&framework=2" target="_blank">build metrics</a>] [<a href="https://treeherder.mozilla.org/perf.html#/compare?originalProject=comm-central&originalRevision=2a29ee0adb310b54a6a2df72034953fed8f2b043&newProject=comm-central&newRevision=0cac668a566b3f8bbfda07a76506b279d50215ec&framework=6" target="_blank">platform microbench</a>] (compared to previous push)</td></tr>
<tr><td>reviewers</td><td><a href="/comm-central/log?rev=reviewer%28aceman%29&revcount=50">aceman</a></td></tr>
<tr><td>bugs</td><td><a href="https://bugzilla.mozilla.org/show_bug.cgi?id=1478572">1478572</a></td></tr>




</table></div>

<div class="page_body description"><a href="https://bugzilla.mozilla.org/show_bug.cgi?id=1478572">Bug 1478572</a> - Turn on ESLint in mail/components/preferences (automatic changes). r=aceman</div>
<div class="list_head"></div>
<div class="title_text">
<table cellspacing="0">

<tr class="parity0">
<td><a class="list" href="/comm-central/diff/0cac668a566b3f8bbfda07a76506b279d50215ec/.eslintignore">.eslintignore</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/0cac668a566b3f8bbfda07a76506b279d50215ec/.eslintignore">file</a> |
<a href="/comm-central/annotate/0cac668a566b3f8bbfda07a76506b279d50215ec/.eslintignore">annotate</a> |
<a href="/comm-central/diff/0cac668a566b3f8bbfda07a76506b279d50215ec/.eslintignore">diff</a> |
<a href="/comm-central/comparison/0cac668a566b3f8bbfda07a76506b279d50215ec/.eslintignore">comparison</a> |
<a href="/comm-central/log/0cac668a566b3f8bbfda07a76506b279d50215ec/.eslintignore">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/0cac668a566b3f8bbfda07a76506b279d50215ec/mail/components/preferences/actionsshared.js">mail/components/preferences/actionsshared.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/0cac668a566b3f8bbfda07a76506b279d50215ec/mail/components/preferences/actionsshared.js">file</a> |
<a href="/comm-central/annotate/0cac668a566b3f8bbfda07a76506b279d50215ec/mail/components/preferences/actionsshared.js">annotate</a> |
<a href="/comm-central/diff/0cac668a566b3f8bbfda07a76506b279d50215ec/mail/components/preferences/actionsshared.js">diff</a> |
<a href="/comm-central/comparison/0cac668a566b3f8bbfda07a76506b279d50215ec/mail/components/preferences/actionsshared.js">comparison</a> |
<a href="/comm-central/log/0cac668a566b3f8bbfda07a76506b279d50215ec/mail/components/preferences/actionsshared.js">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/0cac668a566b3f8bbfda07a76506b279d50215ec/mail/components/preferences/advanced.js">mail/components/preferences/advanced.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/0cac668a566b3f8bbfda07a76506b279d50215ec/mail/components/preferences/advanced.js">file</a> |
<a href="/comm-central/annotate/0cac668a566b3f8bbfda07a76506b279d50215ec/mail/components/preferences/advanced.js">annotate</a> |
<a href="/comm-central/diff/0cac668a566b3f8bbfda07a76506b279d50215ec/mail/components/preferences/advanced.js">diff</a> |
<a href="/comm-central/comparison/0cac668a566b3f8bbfda07a76506b279d50215ec/mail/components/preferences/advanced.js">comparison</a> |
<a href="/comm-central/log/0cac668a566b3f8bbfda07a76506b279d50215ec/mail/components/preferences/advanced.js">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/0cac668a566b3f8bbfda07a76506b279d50215ec/mail/components/preferences/applicationManager.js">mail/components/preferences/applicationManager.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/0cac668a566b3f8bbfda07a76506b279d50215ec/mail/components/preferences/applicationManager.js">file</a> |
<a href="/comm-central/annotate/0cac668a566b3f8bbfda07a76506b279d50215ec/mail/components/preferences/applicationManager.js">annotate</a> |
<a href="/comm-central/diff/0cac668a566b3f8bbfda07a76506b279d50215ec/mail/components/preferences/applicationManager.js">diff</a> |
<a href="/comm-central/comparison/0cac668a566b3f8bbfda07a76506b279d50215ec/mail/components/preferences/applicationManager.js">comparison</a> |
<a href="/comm-central/log/0cac668a566b3f8bbfda07a76506b279d50215ec/mail/components/preferences/applicationManager.js">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/0cac668a566b3f8bbfda07a76506b279d50215ec/mail/components/preferences/applications.js">mail/components/preferences/applications.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/0cac668a566b3f8bbfda07a76506b279d50215ec/mail/components/preferences/applications.js">file</a> |
<a href="/comm-central/annotate/0cac668a566b3f8bbfda07a76506b279d50215ec/mail/components/preferences/applications.js">annotate</a> |
<a href="/comm-central/diff/0cac668a566b3f8bbfda07a76506b279d50215ec/mail/components/preferences/applications.js">diff</a> |
<a href="/comm-central/comparison/0cac668a566b3f8bbfda07a76506b279d50215ec/mail/components/preferences/applications.js">comparison</a> |
<a href="/comm-central/log/0cac668a566b3f8bbfda07a76506b279d50215ec/mail/components/preferences/applications.js">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/0cac668a566b3f8bbfda07a76506b279d50215ec/mail/components/preferences/attachmentReminder.js">mail/components/preferences/attachmentReminder.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/0cac668a566b3f8bbfda07a76506b279d50215ec/mail/components/preferences/attachmentReminder.js">file</a> |
<a href="/comm-central/annotate/0cac668a566b3f8bbfda07a76506b279d50215ec/mail/components/preferences/attachmentReminder.js">annotate</a> |
<a href="/comm-central/diff/0cac668a566b3f8bbfda07a76506b279d50215ec/mail/components/preferences/attachmentReminder.js">diff</a> |
<a href="/comm-central/comparison/0cac668a566b3f8bbfda07a76506b279d50215ec/mail/components/preferences/attachmentReminder.js">comparison</a> |
<a href="/comm-central/log/0cac668a566b3f8bbfda07a76506b279d50215ec/mail/components/preferences/attachmentReminder.js">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/0cac668a566b3f8bbfda07a76506b279d50215ec/mail/components/preferences/chat.js">mail/components/preferences/chat.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/0cac668a566b3f8bbfda07a76506b279d50215ec/mail/components/preferences/chat.js">file</a> |
<a href="/comm-central/annotate/0cac668a566b3f8bbfda07a76506b279d50215ec/mail/components/preferences/chat.js">annotate</a> |
<a href="/comm-central/diff/0cac668a566b3f8bbfda07a76506b279d50215ec/mail/components/preferences/chat.js">diff</a> |
<a href="/comm-central/comparison/0cac668a566b3f8bbfda07a76506b279d50215ec/mail/components/preferences/chat.js">comparison</a> |
<a href="/comm-central/log/0cac668a566b3f8bbfda07a76506b279d50215ec/mail/components/preferences/chat.js">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/0cac668a566b3f8bbfda07a76506b279d50215ec/mail/components/preferences/compose.js">mail/components/preferences/compose.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/0cac668a566b3f8bbfda07a76506b279d50215ec/mail/components/preferences/compose.js">file</a> |
<a href="/comm-central/annotate/0cac668a566b3f8bbfda07a76506b279d50215ec/mail/components/preferences/compose.js">annotate</a> |
<a href="/comm-central/diff/0cac668a566b3f8bbfda07a76506b279d50215ec/mail/components/preferences/compose.js">diff</a> |
<a href="/comm-central/comparison/0cac668a566b3f8bbfda07a76506b279d50215ec/mail/components/preferences/compose.js">comparison</a> |
<a href="/comm-central/log/0cac668a566b3f8bbfda07a76506b279d50215ec/mail/components/preferences/compose.js">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/0cac668a566b3f8bbfda07a76506b279d50215ec/mail/components/preferences/connection.js">mail/components/preferences/connection.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/0cac668a566b3f8bbfda07a76506b279d50215ec/mail/components/preferences/connection.js">file</a> |
<a href="/comm-central/annotate/0cac668a566b3f8bbfda07a76506b279d50215ec/mail/components/preferences/connection.js">annotate</a> |
<a href="/comm-central/diff/0cac668a566b3f8bbfda07a76506b279d50215ec/mail/components/preferences/connection.js">diff</a> |
<a href="/comm-central/comparison/0cac668a566b3f8bbfda07a76506b279d50215ec/mail/components/preferences/connection.js">comparison</a> |
<a href="/comm-central/log/0cac668a566b3f8bbfda07a76506b279d50215ec/mail/components/preferences/connection.js">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/0cac668a566b3f8bbfda07a76506b279d50215ec/mail/components/preferences/cookies.js">mail/components/preferences/cookies.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/0cac668a566b3f8bbfda07a76506b279d50215ec/mail/components/preferences/cookies.js">file</a> |
<a href="/comm-central/annotate/0cac668a566b3f8bbfda07a76506b279d50215ec/mail/components/preferences/cookies.js">annotate</a> |
<a href="/comm-central/diff/0cac668a566b3f8bbfda07a76506b279d50215ec/mail/components/preferences/cookies.js">diff</a> |
<a href="/comm-central/comparison/0cac668a566b3f8bbfda07a76506b279d50215ec/mail/components/preferences/cookies.js">comparison</a> |
<a href="/comm-central/log/0cac668a566b3f8bbfda07a76506b279d50215ec/mail/components/preferences/cookies.js">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/0cac668a566b3f8bbfda07a76506b279d50215ec/mail/components/preferences/display.js">mail/components/preferences/display.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/0cac668a566b3f8bbfda07a76506b279d50215ec/mail/components/preferences/display.js">file</a> |
<a href="/comm-central/annotate/0cac668a566b3f8bbfda07a76506b279d50215ec/mail/components/preferences/display.js">annotate</a> |
<a href="/comm-central/diff/0cac668a566b3f8bbfda07a76506b279d50215ec/mail/components/preferences/display.js">diff</a> |
<a href="/comm-central/comparison/0cac668a566b3f8bbfda07a76506b279d50215ec/mail/components/preferences/display.js">comparison</a> |
<a href="/comm-central/log/0cac668a566b3f8bbfda07a76506b279d50215ec/mail/components/preferences/display.js">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/0cac668a566b3f8bbfda07a76506b279d50215ec/mail/components/preferences/downloads.js">mail/components/preferences/downloads.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/0cac668a566b3f8bbfda07a76506b279d50215ec/mail/components/preferences/downloads.js">file</a> |
<a href="/comm-central/annotate/0cac668a566b3f8bbfda07a76506b279d50215ec/mail/components/preferences/downloads.js">annotate</a> |
<a href="/comm-central/diff/0cac668a566b3f8bbfda07a76506b279d50215ec/mail/components/preferences/downloads.js">diff</a> |
<a href="/comm-central/comparison/0cac668a566b3f8bbfda07a76506b279d50215ec/mail/components/preferences/downloads.js">comparison</a> |
<a href="/comm-central/log/0cac668a566b3f8bbfda07a76506b279d50215ec/mail/components/preferences/downloads.js">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/0cac668a566b3f8bbfda07a76506b279d50215ec/mail/components/preferences/fonts.js">mail/components/preferences/fonts.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/0cac668a566b3f8bbfda07a76506b279d50215ec/mail/components/preferences/fonts.js">file</a> |
<a href="/comm-central/annotate/0cac668a566b3f8bbfda07a76506b279d50215ec/mail/components/preferences/fonts.js">annotate</a> |
<a href="/comm-central/diff/0cac668a566b3f8bbfda07a76506b279d50215ec/mail/components/preferences/fonts.js">diff</a> |
<a href="/comm-central/comparison/0cac668a566b3f8bbfda07a76506b279d50215ec/mail/components/preferences/fonts.js">comparison</a> |
<a href="/comm-central/log/0cac668a566b3f8bbfda07a76506b279d50215ec/mail/components/preferences/fonts.js">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/0cac668a566b3f8bbfda07a76506b279d50215ec/mail/components/preferences/general.js">mail/components/preferences/general.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/0cac668a566b3f8bbfda07a76506b279d50215ec/mail/components/preferences/general.js">file</a> |
<a href="/comm-central/annotate/0cac668a566b3f8bbfda07a76506b279d50215ec/mail/components/preferences/general.js">annotate</a> |
<a href="/comm-central/diff/0cac668a566b3f8bbfda07a76506b279d50215ec/mail/components/preferences/general.js">diff</a> |
<a href="/comm-central/comparison/0cac668a566b3f8bbfda07a76506b279d50215ec/mail/components/preferences/general.js">comparison</a> |
<a href="/comm-central/log/0cac668a566b3f8bbfda07a76506b279d50215ec/mail/components/preferences/general.js">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/0cac668a566b3f8bbfda07a76506b279d50215ec/mail/components/preferences/messagestyle.js">mail/components/preferences/messagestyle.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/0cac668a566b3f8bbfda07a76506b279d50215ec/mail/components/preferences/messagestyle.js">file</a> |
<a href="/comm-central/annotate/0cac668a566b3f8bbfda07a76506b279d50215ec/mail/components/preferences/messagestyle.js">annotate</a> |
<a href="/comm-central/diff/0cac668a566b3f8bbfda07a76506b279d50215ec/mail/components/preferences/messagestyle.js">diff</a> |
<a href="/comm-central/comparison/0cac668a566b3f8bbfda07a76506b279d50215ec/mail/components/preferences/messagestyle.js">comparison</a> |
<a href="/comm-central/log/0cac668a566b3f8bbfda07a76506b279d50215ec/mail/components/preferences/messagestyle.js">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/0cac668a566b3f8bbfda07a76506b279d50215ec/mail/components/preferences/offline.js">mail/components/preferences/offline.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/0cac668a566b3f8bbfda07a76506b279d50215ec/mail/components/preferences/offline.js">file</a> |
<a href="/comm-central/annotate/0cac668a566b3f8bbfda07a76506b279d50215ec/mail/components/preferences/offline.js">annotate</a> |
<a href="/comm-central/diff/0cac668a566b3f8bbfda07a76506b279d50215ec/mail/components/preferences/offline.js">diff</a> |
<a href="/comm-central/comparison/0cac668a566b3f8bbfda07a76506b279d50215ec/mail/components/preferences/offline.js">comparison</a> |
<a href="/comm-central/log/0cac668a566b3f8bbfda07a76506b279d50215ec/mail/components/preferences/offline.js">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/0cac668a566b3f8bbfda07a76506b279d50215ec/mail/components/preferences/permissions.js">mail/components/preferences/permissions.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/0cac668a566b3f8bbfda07a76506b279d50215ec/mail/components/preferences/permissions.js">file</a> |
<a href="/comm-central/annotate/0cac668a566b3f8bbfda07a76506b279d50215ec/mail/components/preferences/permissions.js">annotate</a> |
<a href="/comm-central/diff/0cac668a566b3f8bbfda07a76506b279d50215ec/mail/components/preferences/permissions.js">diff</a> |
<a href="/comm-central/comparison/0cac668a566b3f8bbfda07a76506b279d50215ec/mail/components/preferences/permissions.js">comparison</a> |
<a href="/comm-central/log/0cac668a566b3f8bbfda07a76506b279d50215ec/mail/components/preferences/permissions.js">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/0cac668a566b3f8bbfda07a76506b279d50215ec/mail/components/preferences/preferences.js">mail/components/preferences/preferences.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/0cac668a566b3f8bbfda07a76506b279d50215ec/mail/components/preferences/preferences.js">file</a> |
<a href="/comm-central/annotate/0cac668a566b3f8bbfda07a76506b279d50215ec/mail/components/preferences/preferences.js">annotate</a> |
<a href="/comm-central/diff/0cac668a566b3f8bbfda07a76506b279d50215ec/mail/components/preferences/preferences.js">diff</a> |
<a href="/comm-central/comparison/0cac668a566b3f8bbfda07a76506b279d50215ec/mail/components/preferences/preferences.js">comparison</a> |
<a href="/comm-central/log/0cac668a566b3f8bbfda07a76506b279d50215ec/mail/components/preferences/preferences.js">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/0cac668a566b3f8bbfda07a76506b279d50215ec/mail/components/preferences/preferencesTab.js">mail/components/preferences/preferencesTab.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/0cac668a566b3f8bbfda07a76506b279d50215ec/mail/components/preferences/preferencesTab.js">file</a> |
<a href="/comm-central/annotate/0cac668a566b3f8bbfda07a76506b279d50215ec/mail/components/preferences/preferencesTab.js">annotate</a> |
<a href="/comm-central/diff/0cac668a566b3f8bbfda07a76506b279d50215ec/mail/components/preferences/preferencesTab.js">diff</a> |
<a href="/comm-central/comparison/0cac668a566b3f8bbfda07a76506b279d50215ec/mail/components/preferences/preferencesTab.js">comparison</a> |
<a href="/comm-central/log/0cac668a566b3f8bbfda07a76506b279d50215ec/mail/components/preferences/preferencesTab.js">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/0cac668a566b3f8bbfda07a76506b279d50215ec/mail/components/preferences/privacy.js">mail/components/preferences/privacy.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/0cac668a566b3f8bbfda07a76506b279d50215ec/mail/components/preferences/privacy.js">file</a> |
<a href="/comm-central/annotate/0cac668a566b3f8bbfda07a76506b279d50215ec/mail/components/preferences/privacy.js">annotate</a> |
<a href="/comm-central/diff/0cac668a566b3f8bbfda07a76506b279d50215ec/mail/components/preferences/privacy.js">diff</a> |
<a href="/comm-central/comparison/0cac668a566b3f8bbfda07a76506b279d50215ec/mail/components/preferences/privacy.js">comparison</a> |
<a href="/comm-central/log/0cac668a566b3f8bbfda07a76506b279d50215ec/mail/components/preferences/privacy.js">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/0cac668a566b3f8bbfda07a76506b279d50215ec/mail/components/preferences/security.js">mail/components/preferences/security.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/0cac668a566b3f8bbfda07a76506b279d50215ec/mail/components/preferences/security.js">file</a> |
<a href="/comm-central/annotate/0cac668a566b3f8bbfda07a76506b279d50215ec/mail/components/preferences/security.js">annotate</a> |
<a href="/comm-central/diff/0cac668a566b3f8bbfda07a76506b279d50215ec/mail/components/preferences/security.js">diff</a> |
<a href="/comm-central/comparison/0cac668a566b3f8bbfda07a76506b279d50215ec/mail/components/preferences/security.js">comparison</a> |
<a href="/comm-central/log/0cac668a566b3f8bbfda07a76506b279d50215ec/mail/components/preferences/security.js">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/0cac668a566b3f8bbfda07a76506b279d50215ec/mail/components/preferences/sendoptions.js">mail/components/preferences/sendoptions.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/0cac668a566b3f8bbfda07a76506b279d50215ec/mail/components/preferences/sendoptions.js">file</a> |
<a href="/comm-central/annotate/0cac668a566b3f8bbfda07a76506b279d50215ec/mail/components/preferences/sendoptions.js">annotate</a> |
<a href="/comm-central/diff/0cac668a566b3f8bbfda07a76506b279d50215ec/mail/components/preferences/sendoptions.js">diff</a> |
<a href="/comm-central/comparison/0cac668a566b3f8bbfda07a76506b279d50215ec/mail/components/preferences/sendoptions.js">comparison</a> |
<a href="/comm-central/log/0cac668a566b3f8bbfda07a76506b279d50215ec/mail/components/preferences/sendoptions.js">revisions</a>
</td>
</tr>
</table></div>

<div class="page_body diffblocks"><div class="diffblock"><pre class="sourcelines">
<a href="#l1.1"></a><span id="l1.1" class="difflineminus">--- a/.eslintignore</span>
<a href="#l1.2"></a><span id="l1.2" class="difflineplus">+++ b/.eslintignore</span>
<a href="#l1.3"></a><span id="l1.3" class="difflineat">@@ -61,16 +61,17 @@ mail/themes/**</span>
<a href="#l1.4"></a><span id="l1.4"> # mail/components exclusions</span>
<a href="#l1.5"></a><span id="l1.5"> mail/components/*</span>
<a href="#l1.6"></a><span id="l1.6"> !mail/components/about-support</span>
<a href="#l1.7"></a><span id="l1.7"> !mail/components/accountcreation</span>
<a href="#l1.8"></a><span id="l1.8"> !mail/components/addrbook</span>
<a href="#l1.9"></a><span id="l1.9"> !mail/components/devtools</span>
<a href="#l1.10"></a><span id="l1.10"> !mail/components/downloads</span>
<a href="#l1.11"></a><span id="l1.11"> !mail/components/extensions</span>
<a href="#l1.12"></a><span id="l1.12" class="difflineplus">+!mail/components/preferences</span>
<a href="#l1.13"></a><span id="l1.13"> </span>
<a href="#l1.14"></a><span id="l1.14"> # calendar/ exclusions</span>
<a href="#l1.15"></a><span id="l1.15"> </span>
<a href="#l1.16"></a><span id="l1.16"> # prefs files</span>
<a href="#l1.17"></a><span id="l1.17"> calendar/lightning/content/lightning.js</span>
<a href="#l1.18"></a><span id="l1.18"> </span>
<a href="#l1.19"></a><span id="l1.19"> # third party library</span>
<a href="#l1.20"></a><span id="l1.20"> calendar/base/modules/ical.js</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l2.1"></a><span id="l2.1" class="difflineminus">--- a/mail/components/preferences/actionsshared.js</span>
<a href="#l2.2"></a><span id="l2.2" class="difflineplus">+++ b/mail/components/preferences/actionsshared.js</span>
<a href="#l2.3"></a><span id="l2.3" class="difflineat">@@ -3,29 +3,28 @@</span>
<a href="#l2.4"></a><span id="l2.4">  * License, v. 2.0. If a copy of the MPL was not distributed with this</span>
<a href="#l2.5"></a><span id="l2.5">  * file, You can obtain one at http://mozilla.org/MPL/2.0/. */</span>
<a href="#l2.6"></a><span id="l2.6"> </span>
<a href="#l2.7"></a><span id="l2.7"> var FILEACTION_SAVE_TO_DISK     = 1;</span>
<a href="#l2.8"></a><span id="l2.8"> var FILEACTION_OPEN_INTERNALLY  = 2;</span>
<a href="#l2.9"></a><span id="l2.9"> var FILEACTION_OPEN_DEFAULT     = 3;</span>
<a href="#l2.10"></a><span id="l2.10"> var FILEACTION_OPEN_CUSTOM      = 4;</span>
<a href="#l2.11"></a><span id="l2.11"> var FILEACTION_OPEN_PLUGIN      = 5;</span>
<a href="#l2.12"></a><span id="l2.12" class="difflineminus">-function FileAction ()</span>
<a href="#l2.13"></a><span id="l2.13" class="difflineminus">-{</span>
<a href="#l2.14"></a><span id="l2.14" class="difflineplus">+function FileAction() {</span>
<a href="#l2.15"></a><span id="l2.15"> }</span>
<a href="#l2.16"></a><span id="l2.16"> FileAction.prototype = {</span>
<a href="#l2.17"></a><span id="l2.17" class="difflineminus">-  type        : &quot;&quot;,</span>
<a href="#l2.18"></a><span id="l2.18" class="difflineminus">-  extension   : &quot;&quot;,</span>
<a href="#l2.19"></a><span id="l2.19" class="difflineplus">+  type: &quot;&quot;,</span>
<a href="#l2.20"></a><span id="l2.20" class="difflineplus">+  extension: &quot;&quot;,</span>
<a href="#l2.21"></a><span id="l2.21">   hasExtension: true,</span>
<a href="#l2.22"></a><span id="l2.22" class="difflineminus">-  editable    : true,</span>
<a href="#l2.23"></a><span id="l2.23" class="difflineminus">-  smallIcon   : &quot;&quot;,</span>
<a href="#l2.24"></a><span id="l2.24" class="difflineminus">-  bigIcon     : &quot;&quot;,</span>
<a href="#l2.25"></a><span id="l2.25" class="difflineminus">-  typeName    : &quot;&quot;,</span>
<a href="#l2.26"></a><span id="l2.26" class="difflineminus">-  action      : &quot;&quot;,</span>
<a href="#l2.27"></a><span id="l2.27" class="difflineminus">-  mimeInfo    : null,</span>
<a href="#l2.28"></a><span id="l2.28" class="difflineminus">-  customHandler       : &quot;&quot;,</span>
<a href="#l2.29"></a><span id="l2.29" class="difflineminus">-  handleMode          : false,</span>
<a href="#l2.30"></a><span id="l2.30" class="difflineminus">-  pluginAvailable     : false,</span>
<a href="#l2.31"></a><span id="l2.31" class="difflineminus">-  pluginEnabled       : false,</span>
<a href="#l2.32"></a><span id="l2.32" class="difflineminus">-  handledOnlyByPlugin : false</span>
<a href="#l2.33"></a><span id="l2.33" class="difflineplus">+  editable: true,</span>
<a href="#l2.34"></a><span id="l2.34" class="difflineplus">+  smallIcon: &quot;&quot;,</span>
<a href="#l2.35"></a><span id="l2.35" class="difflineplus">+  bigIcon: &quot;&quot;,</span>
<a href="#l2.36"></a><span id="l2.36" class="difflineplus">+  typeName: &quot;&quot;,</span>
<a href="#l2.37"></a><span id="l2.37" class="difflineplus">+  action: &quot;&quot;,</span>
<a href="#l2.38"></a><span id="l2.38" class="difflineplus">+  mimeInfo: null,</span>
<a href="#l2.39"></a><span id="l2.39" class="difflineplus">+  customHandler: &quot;&quot;,</span>
<a href="#l2.40"></a><span id="l2.40" class="difflineplus">+  handleMode: false,</span>
<a href="#l2.41"></a><span id="l2.41" class="difflineplus">+  pluginAvailable: false,</span>
<a href="#l2.42"></a><span id="l2.42" class="difflineplus">+  pluginEnabled: false,</span>
<a href="#l2.43"></a><span id="l2.43" class="difflineplus">+  handledOnlyByPlugin: false,</span>
<a href="#l2.44"></a><span id="l2.44"> };</span>
<a href="#l2.45"></a><span id="l2.45"> </span>
<a href="#l2.46"></a><span id="l2.46"> </span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l3.1"></a><span id="l3.1" class="difflineminus">--- a/mail/components/preferences/advanced.js</span>
<a href="#l3.2"></a><span id="l3.2" class="difflineplus">+++ b/mail/components/preferences/advanced.js</span>
<a href="#l3.3"></a><span id="l3.3" class="difflineat">@@ -13,29 +13,27 @@ ChromeUtils.import(&quot;resource://gre/modul</span>
<a href="#l3.4"></a><span id="l3.4"> </span>
<a href="#l3.5"></a><span id="l3.5"> var gAdvancedPane = {</span>
<a href="#l3.6"></a><span id="l3.6">   mPane: null,</span>
<a href="#l3.7"></a><span id="l3.7">   mInitialized: false,</span>
<a href="#l3.8"></a><span id="l3.8">   mShellServiceWorking: false,</span>
<a href="#l3.9"></a><span id="l3.9">   mBundle: null,</span>
<a href="#l3.10"></a><span id="l3.10">   requestingLocales: null,</span>
<a href="#l3.11"></a><span id="l3.11"> </span>
<a href="#l3.12"></a><span id="l3.12" class="difflineminus">-  init: function ()</span>
<a href="#l3.13"></a><span id="l3.13" class="difflineminus">-  {</span>
<a href="#l3.14"></a><span id="l3.14" class="difflineplus">+  init() {</span>
<a href="#l3.15"></a><span id="l3.15">     this.mPane = document.getElementById(&quot;paneAdvanced&quot;);</span>
<a href="#l3.16"></a><span id="l3.16">     this.updateCompactOptions();</span>
<a href="#l3.17"></a><span id="l3.17">     this.mBundle = document.getElementById(&quot;bundlePreferences&quot;);</span>
<a href="#l3.18"></a><span id="l3.18">     this.formatLocaleSetLabels();</span>
<a href="#l3.19"></a><span id="l3.19"> </span>
<a href="#l3.20"></a><span id="l3.20">     if (Services.prefs.getBoolPref(&quot;intl.multilingual.enabled&quot;)) {</span>
<a href="#l3.21"></a><span id="l3.21">       this.initMessengerLocale();</span>
<a href="#l3.22"></a><span id="l3.22">     }</span>
<a href="#l3.23"></a><span id="l3.23"> </span>
<a href="#l3.24"></a><span id="l3.24" class="difflineminus">-    if (!((&quot;arguments&quot; in window) &amp;&amp; window.arguments[1]))</span>
<a href="#l3.25"></a><span id="l3.25" class="difflineminus">-    {</span>
<a href="#l3.26"></a><span id="l3.26" class="difflineplus">+    if (!((&quot;arguments&quot; in window) &amp;&amp; window.arguments[1])) {</span>
<a href="#l3.27"></a><span id="l3.27">       // If no tab was specified, select the last used tab.</span>
<a href="#l3.28"></a><span id="l3.28">       let preference = document.getElementById(&quot;mail.preferences.advanced.selectedTabIndex&quot;);</span>
<a href="#l3.29"></a><span id="l3.29">       if (preference.value)</span>
<a href="#l3.30"></a><span id="l3.30">         document.getElementById(&quot;advancedPrefs&quot;).selectedIndex = preference.value;</span>
<a href="#l3.31"></a><span id="l3.31">     }</span>
<a href="#l3.32"></a><span id="l3.32">     if (AppConstants.MOZ_UPDATER)</span>
<a href="#l3.33"></a><span id="l3.33">       this.updateReadPrefs();</span>
<a href="#l3.34"></a><span id="l3.34"> </span>
<a href="#l3.35"></a><span id="l3.35" class="difflineat">@@ -50,34 +48,28 @@ var gAdvancedPane = {</span>
<a href="#l3.36"></a><span id="l3.36">       this.initSubmitCrashes();</span>
<a href="#l3.37"></a><span id="l3.37">     this.initTelemetry();</span>
<a href="#l3.38"></a><span id="l3.38">     this.updateActualCacheSize();</span>
<a href="#l3.39"></a><span id="l3.39"> </span>
<a href="#l3.40"></a><span id="l3.40">     // Search integration -- check whether we should hide or disable integration</span>
<a href="#l3.41"></a><span id="l3.41">     let hideSearchUI = false;</span>
<a href="#l3.42"></a><span id="l3.42">     let disableSearchUI = false;</span>
<a href="#l3.43"></a><span id="l3.43">     ChromeUtils.import(&quot;resource:///modules/SearchIntegration.js&quot;);</span>
<a href="#l3.44"></a><span id="l3.44" class="difflineminus">-    if (SearchIntegration)</span>
<a href="#l3.45"></a><span id="l3.45" class="difflineminus">-    {</span>
<a href="#l3.46"></a><span id="l3.46" class="difflineplus">+    if (SearchIntegration) {</span>
<a href="#l3.47"></a><span id="l3.47">       if (SearchIntegration.osVersionTooLow)</span>
<a href="#l3.48"></a><span id="l3.48">         hideSearchUI = true;</span>
<a href="#l3.49"></a><span id="l3.49">       else if (SearchIntegration.osComponentsNotRunning)</span>
<a href="#l3.50"></a><span id="l3.50">         disableSearchUI = true;</span>
<a href="#l3.51"></a><span id="l3.51" class="difflineminus">-    }</span>
<a href="#l3.52"></a><span id="l3.52" class="difflineminus">-    else</span>
<a href="#l3.53"></a><span id="l3.53" class="difflineminus">-    {</span>
<a href="#l3.54"></a><span id="l3.54" class="difflineplus">+    } else {</span>
<a href="#l3.55"></a><span id="l3.55">       hideSearchUI = true;</span>
<a href="#l3.56"></a><span id="l3.56">     }</span>
<a href="#l3.57"></a><span id="l3.57"> </span>
<a href="#l3.58"></a><span id="l3.58" class="difflineminus">-    if (hideSearchUI)</span>
<a href="#l3.59"></a><span id="l3.59" class="difflineminus">-    {</span>
<a href="#l3.60"></a><span id="l3.60" class="difflineplus">+    if (hideSearchUI) {</span>
<a href="#l3.61"></a><span id="l3.61">       document.getElementById(&quot;searchIntegrationContainer&quot;).hidden = true;</span>
<a href="#l3.62"></a><span id="l3.62" class="difflineminus">-    }</span>
<a href="#l3.63"></a><span id="l3.63" class="difflineminus">-    else if (disableSearchUI)</span>
<a href="#l3.64"></a><span id="l3.64" class="difflineminus">-    {</span>
<a href="#l3.65"></a><span id="l3.65" class="difflineplus">+    } else if (disableSearchUI) {</span>
<a href="#l3.66"></a><span id="l3.66">       let searchCheckbox = document.getElementById(&quot;searchIntegration&quot;);</span>
<a href="#l3.67"></a><span id="l3.67">       searchCheckbox.checked = false;</span>
<a href="#l3.68"></a><span id="l3.68">       document.getElementById(&quot;searchintegration.enable&quot;).disabled = true;</span>
<a href="#l3.69"></a><span id="l3.69">     }</span>
<a href="#l3.70"></a><span id="l3.70"> </span>
<a href="#l3.71"></a><span id="l3.71">     // If the shell service is not working, disable the &quot;Check now&quot; button</span>
<a href="#l3.72"></a><span id="l3.72">     // and &quot;perform check at startup&quot; checkbox.</span>
<a href="#l3.73"></a><span id="l3.73">     try {</span>
<a href="#l3.74"></a><span id="l3.74" class="difflineat">@@ -91,17 +83,17 @@ var gAdvancedPane = {</span>
<a href="#l3.75"></a><span id="l3.75">         document.getElementById(&quot;alwaysCheckDefault&quot;).checked = false;</span>
<a href="#l3.76"></a><span id="l3.76">       }</span>
<a href="#l3.77"></a><span id="l3.77">       if (document.getElementById(&quot;checkDefaultButton&quot;))</span>
<a href="#l3.78"></a><span id="l3.78">         document.getElementById(&quot;checkDefaultButton&quot;).disabled = true;</span>
<a href="#l3.79"></a><span id="l3.79">       this.mShellServiceWorking = false;</span>
<a href="#l3.80"></a><span id="l3.80">     }</span>
<a href="#l3.81"></a><span id="l3.81"> </span>
<a href="#l3.82"></a><span id="l3.82">     if (AppConstants.MOZ_UPDATER) {</span>
<a href="#l3.83"></a><span id="l3.83" class="difflineminus">-      let distroId = Services.prefs.getCharPref(&quot;distribution.id&quot; , &quot;&quot;);</span>
<a href="#l3.84"></a><span id="l3.84" class="difflineplus">+      let distroId = Services.prefs.getCharPref(&quot;distribution.id&quot;, &quot;&quot;);</span>
<a href="#l3.85"></a><span id="l3.85">       if (distroId) {</span>
<a href="#l3.86"></a><span id="l3.86">         let distroVersion = Services.prefs.getCharPref(&quot;distribution.version&quot;);</span>
<a href="#l3.87"></a><span id="l3.87"> </span>
<a href="#l3.88"></a><span id="l3.88">         let distroIdField = document.getElementById(&quot;distributionId&quot;);</span>
<a href="#l3.89"></a><span id="l3.89">         distroIdField.value = distroId + &quot; - &quot; + distroVersion;</span>
<a href="#l3.90"></a><span id="l3.90">         distroIdField.style.display = &quot;block&quot;;</span>
<a href="#l3.91"></a><span id="l3.91"> </span>
<a href="#l3.92"></a><span id="l3.92">         let distroAbout = Services.prefs.getStringPref(&quot;distribution.about&quot;, &quot;&quot;);</span>
<a href="#l3.93"></a><span id="l3.93" class="difflineat">@@ -147,174 +139,161 @@ var gAdvancedPane = {</span>
<a href="#l3.94"></a><span id="l3.94">       }</span>
<a href="#l3.95"></a><span id="l3.95"> </span>
<a href="#l3.96"></a><span id="l3.96">       gAppUpdater = new appUpdater();</span>
<a href="#l3.97"></a><span id="l3.97">     }</span>
<a href="#l3.98"></a><span id="l3.98"> </span>
<a href="#l3.99"></a><span id="l3.99">     this.mInitialized = true;</span>
<a href="#l3.100"></a><span id="l3.100">   },</span>
<a href="#l3.101"></a><span id="l3.101"> </span>
<a href="#l3.102"></a><span id="l3.102" class="difflineminus">-  tabSelectionChanged: function ()</span>
<a href="#l3.103"></a><span id="l3.103" class="difflineminus">-  {</span>
<a href="#l3.104"></a><span id="l3.104" class="difflineminus">-    if (this.mInitialized)</span>
<a href="#l3.105"></a><span id="l3.105" class="difflineminus">-    {</span>
<a href="#l3.106"></a><span id="l3.106" class="difflineplus">+  tabSelectionChanged() {</span>
<a href="#l3.107"></a><span id="l3.107" class="difflineplus">+    if (this.mInitialized) {</span>
<a href="#l3.108"></a><span id="l3.108">       document.getElementById(&quot;mail.preferences.advanced.selectedTabIndex&quot;)</span>
<a href="#l3.109"></a><span id="l3.109">               .valueFromPreferences = document.getElementById(&quot;advancedPrefs&quot;).selectedIndex;</span>
<a href="#l3.110"></a><span id="l3.110">     }</span>
<a href="#l3.111"></a><span id="l3.111">   },</span>
<a href="#l3.112"></a><span id="l3.112"> </span>
<a href="#l3.113"></a><span id="l3.113">   /**</span>
<a href="#l3.114"></a><span id="l3.114">    * Checks whether Thunderbird is currently registered with the operating</span>
<a href="#l3.115"></a><span id="l3.115">    * system as the default app for mail, rss and news.  If Thunderbird is not</span>
<a href="#l3.116"></a><span id="l3.116">    * currently the default app, the user is given the option of making it the</span>
<a href="#l3.117"></a><span id="l3.117">    * default for each type; otherwise, the user is informed that Thunderbird is</span>
<a href="#l3.118"></a><span id="l3.118">    * already the default.</span>
<a href="#l3.119"></a><span id="l3.119">    */</span>
<a href="#l3.120"></a><span id="l3.120" class="difflineminus">-  checkDefaultNow: function (aAppType)</span>
<a href="#l3.121"></a><span id="l3.121" class="difflineminus">-  {</span>
<a href="#l3.122"></a><span id="l3.122" class="difflineplus">+  checkDefaultNow(aAppType) {</span>
<a href="#l3.123"></a><span id="l3.123">     if (!this.mShellServiceWorking)</span>
<a href="#l3.124"></a><span id="l3.124">       return;</span>
<a href="#l3.125"></a><span id="l3.125"> </span>
<a href="#l3.126"></a><span id="l3.126">     // otherwise, bring up the default client dialog</span>
<a href="#l3.127"></a><span id="l3.127">     gSubDialog.open(&quot;chrome://messenger/content/systemIntegrationDialog.xul&quot;,</span>
<a href="#l3.128"></a><span id="l3.128">                     &quot;resizable=no&quot;, &quot;calledFromPrefs&quot;);</span>
<a href="#l3.129"></a><span id="l3.129">   },</span>
<a href="#l3.130"></a><span id="l3.130"> </span>
<a href="#l3.131"></a><span id="l3.131" class="difflineminus">-  showConfigEdit: function()</span>
<a href="#l3.132"></a><span id="l3.132" class="difflineminus">-  {</span>
<a href="#l3.133"></a><span id="l3.133" class="difflineplus">+  showConfigEdit() {</span>
<a href="#l3.134"></a><span id="l3.134">     gSubDialog.open(&quot;chrome://global/content/config.xul&quot;);</span>
<a href="#l3.135"></a><span id="l3.135">   },</span>
<a href="#l3.136"></a><span id="l3.136"> </span>
<a href="#l3.137"></a><span id="l3.137">   /**</span>
<a href="#l3.138"></a><span id="l3.138">    * Set the default store contract ID.</span>
<a href="#l3.139"></a><span id="l3.139">    */</span>
<a href="#l3.140"></a><span id="l3.140" class="difflineminus">-  updateDefaultStore: function(storeID)</span>
<a href="#l3.141"></a><span id="l3.141" class="difflineminus">-  {</span>
<a href="#l3.142"></a><span id="l3.142" class="difflineplus">+  updateDefaultStore(storeID) {</span>
<a href="#l3.143"></a><span id="l3.143">     Services.prefs.setCharPref(&quot;mail.serverDefaultStoreContractID&quot;, storeID);</span>
<a href="#l3.144"></a><span id="l3.144">   },</span>
<a href="#l3.145"></a><span id="l3.145"> </span>
<a href="#l3.146"></a><span id="l3.146">   // NETWORK TAB</span>
<a href="#l3.147"></a><span id="l3.147"> </span>
<a href="#l3.148"></a><span id="l3.148">   /*</span>
<a href="#l3.149"></a><span id="l3.149">    * Preferences:</span>
<a href="#l3.150"></a><span id="l3.150">    *</span>
<a href="#l3.151"></a><span id="l3.151">    * browser.cache.disk.capacity</span>
<a href="#l3.152"></a><span id="l3.152">    * - the size of the browser cache in KB</span>
<a href="#l3.153"></a><span id="l3.153">    */</span>
<a href="#l3.154"></a><span id="l3.154"> </span>
<a href="#l3.155"></a><span id="l3.155">   // Retrieves the amount of space currently used by disk cache</span>
<a href="#l3.156"></a><span id="l3.156" class="difflineminus">-  updateActualCacheSize: function()</span>
<a href="#l3.157"></a><span id="l3.157" class="difflineminus">-  {</span>
<a href="#l3.158"></a><span id="l3.158" class="difflineplus">+  updateActualCacheSize() {</span>
<a href="#l3.159"></a><span id="l3.159">     let actualSizeLabel = document.getElementById(&quot;actualDiskCacheSize&quot;);</span>
<a href="#l3.160"></a><span id="l3.160">     let prefStrBundle = document.getElementById(&quot;bundlePreferences&quot;);</span>
<a href="#l3.161"></a><span id="l3.161"> </span>
<a href="#l3.162"></a><span id="l3.162">     // Needs to root the observer since cache service keeps only a weak reference.</span>
<a href="#l3.163"></a><span id="l3.163">     this.observer = {</span>
<a href="#l3.164"></a><span id="l3.164" class="difflineminus">-      onNetworkCacheDiskConsumption: function(consumption) {</span>
<a href="#l3.165"></a><span id="l3.165" class="difflineplus">+      onNetworkCacheDiskConsumption(consumption) {</span>
<a href="#l3.166"></a><span id="l3.166">         let size = DownloadUtils.convertByteUnits(consumption);</span>
<a href="#l3.167"></a><span id="l3.167">         // The XBL binding for the string bundle may have been destroyed if</span>
<a href="#l3.168"></a><span id="l3.168">         // the page was closed before this callback was executed.</span>
<a href="#l3.169"></a><span id="l3.169">         if (!prefStrBundle.getFormattedString) {</span>
<a href="#l3.170"></a><span id="l3.170">           return;</span>
<a href="#l3.171"></a><span id="l3.171">         }</span>
<a href="#l3.172"></a><span id="l3.172">         actualSizeLabel.value = prefStrBundle.getFormattedString(&quot;actualDiskCacheSize&quot;, size);</span>
<a href="#l3.173"></a><span id="l3.173">       },</span>
<a href="#l3.174"></a><span id="l3.174"> </span>
<a href="#l3.175"></a><span id="l3.175">       QueryInterface: ChromeUtils.generateQI([</span>
<a href="#l3.176"></a><span id="l3.176">         Ci.nsICacheStorageConsumptionObserver,</span>
<a href="#l3.177"></a><span id="l3.177" class="difflineminus">-        Ci.nsISupportsWeakReference</span>
<a href="#l3.178"></a><span id="l3.178" class="difflineminus">-      ])</span>
<a href="#l3.179"></a><span id="l3.179" class="difflineplus">+        Ci.nsISupportsWeakReference,</span>
<a href="#l3.180"></a><span id="l3.180" class="difflineplus">+      ]),</span>
<a href="#l3.181"></a><span id="l3.181">     };</span>
<a href="#l3.182"></a><span id="l3.182"> </span>
<a href="#l3.183"></a><span id="l3.183">     actualSizeLabel.value = prefStrBundle.getString(&quot;actualDiskCacheSizeCalculated&quot;);</span>
<a href="#l3.184"></a><span id="l3.184"> </span>
<a href="#l3.185"></a><span id="l3.185">     try {</span>
<a href="#l3.186"></a><span id="l3.186">       let cacheService =</span>
<a href="#l3.187"></a><span id="l3.187">         Cc[&quot;@mozilla.org/netwerk/cache-storage-service;1&quot;]</span>
<a href="#l3.188"></a><span id="l3.188">           .getService(Ci.nsICacheStorageService);</span>
<a href="#l3.189"></a><span id="l3.189">       cacheService.asyncGetDiskConsumption(this.observer);</span>
<a href="#l3.190"></a><span id="l3.190">     } catch (e) {}</span>
<a href="#l3.191"></a><span id="l3.191">   },</span>
<a href="#l3.192"></a><span id="l3.192"> </span>
<a href="#l3.193"></a><span id="l3.193" class="difflineminus">-  updateCacheSizeUI: function (smartSizeEnabled)</span>
<a href="#l3.194"></a><span id="l3.194" class="difflineminus">-  {</span>
<a href="#l3.195"></a><span id="l3.195" class="difflineplus">+  updateCacheSizeUI(smartSizeEnabled) {</span>
<a href="#l3.196"></a><span id="l3.196">     document.getElementById(&quot;useCacheBefore&quot;).disabled = smartSizeEnabled;</span>
<a href="#l3.197"></a><span id="l3.197">     document.getElementById(&quot;cacheSize&quot;).disabled = smartSizeEnabled;</span>
<a href="#l3.198"></a><span id="l3.198">     document.getElementById(&quot;useCacheAfter&quot;).disabled = smartSizeEnabled;</span>
<a href="#l3.199"></a><span id="l3.199">   },</span>
<a href="#l3.200"></a><span id="l3.200"> </span>
<a href="#l3.201"></a><span id="l3.201" class="difflineminus">-  readSmartSizeEnabled: function ()</span>
<a href="#l3.202"></a><span id="l3.202" class="difflineminus">-  {</span>
<a href="#l3.203"></a><span id="l3.203" class="difflineplus">+  readSmartSizeEnabled() {</span>
<a href="#l3.204"></a><span id="l3.204">     // The smart_size.enabled preference element is inverted=&quot;true&quot;, so its</span>
<a href="#l3.205"></a><span id="l3.205">     // value is the opposite of the actual pref value</span>
<a href="#l3.206"></a><span id="l3.206">     var disabled = document.getElementById(&quot;browser.cache.disk.smart_size.enabled&quot;).value;</span>
<a href="#l3.207"></a><span id="l3.207">     this.updateCacheSizeUI(!disabled);</span>
<a href="#l3.208"></a><span id="l3.208">   },</span>
<a href="#l3.209"></a><span id="l3.209"> </span>
<a href="#l3.210"></a><span id="l3.210">   /**</span>
<a href="#l3.211"></a><span id="l3.211">    * Converts the cache size from units of KB to units of MB and returns that</span>
<a href="#l3.212"></a><span id="l3.212">    * value.</span>
<a href="#l3.213"></a><span id="l3.213">    */</span>
<a href="#l3.214"></a><span id="l3.214" class="difflineminus">-  readCacheSize: function ()</span>
<a href="#l3.215"></a><span id="l3.215" class="difflineminus">-  {</span>
<a href="#l3.216"></a><span id="l3.216" class="difflineplus">+  readCacheSize() {</span>
<a href="#l3.217"></a><span id="l3.217">     var preference = document.getElementById(&quot;browser.cache.disk.capacity&quot;);</span>
<a href="#l3.218"></a><span id="l3.218">     return preference.value / 1024;</span>
<a href="#l3.219"></a><span id="l3.219">   },</span>
<a href="#l3.220"></a><span id="l3.220"> </span>
<a href="#l3.221"></a><span id="l3.221">   /**</span>
<a href="#l3.222"></a><span id="l3.222">    * Converts the cache size as specified in UI (in MB) to KB and returns that</span>
<a href="#l3.223"></a><span id="l3.223">    * value.</span>
<a href="#l3.224"></a><span id="l3.224">    */</span>
<a href="#l3.225"></a><span id="l3.225" class="difflineminus">-  writeCacheSize: function ()</span>
<a href="#l3.226"></a><span id="l3.226" class="difflineminus">-  {</span>
<a href="#l3.227"></a><span id="l3.227" class="difflineplus">+  writeCacheSize() {</span>
<a href="#l3.228"></a><span id="l3.228">     var cacheSize = document.getElementById(&quot;cacheSize&quot;);</span>
<a href="#l3.229"></a><span id="l3.229">     var intValue = parseInt(cacheSize.value, 10);</span>
<a href="#l3.230"></a><span id="l3.230">     return isNaN(intValue) ? 0 : intValue * 1024;</span>
<a href="#l3.231"></a><span id="l3.231">   },</span>
<a href="#l3.232"></a><span id="l3.232"> </span>
<a href="#l3.233"></a><span id="l3.233">   /**</span>
<a href="#l3.234"></a><span id="l3.234">    * Clears the cache.</span>
<a href="#l3.235"></a><span id="l3.235">    */</span>
<a href="#l3.236"></a><span id="l3.236" class="difflineminus">-  clearCache: function ()</span>
<a href="#l3.237"></a><span id="l3.237" class="difflineminus">-  {</span>
<a href="#l3.238"></a><span id="l3.238" class="difflineplus">+  clearCache() {</span>
<a href="#l3.239"></a><span id="l3.239">     try {</span>
<a href="#l3.240"></a><span id="l3.240">       let cache = Cc[&quot;@mozilla.org/netwerk/cache-storage-service;1&quot;]</span>
<a href="#l3.241"></a><span id="l3.241">                     .getService(Ci.nsICacheStorageService);</span>
<a href="#l3.242"></a><span id="l3.242">       cache.clear();</span>
<a href="#l3.243"></a><span id="l3.243">     } catch (ex) {}</span>
<a href="#l3.244"></a><span id="l3.244">     this.updateActualCacheSize();</span>
<a href="#l3.245"></a><span id="l3.245">   },</span>
<a href="#l3.246"></a><span id="l3.246"> </span>
<a href="#l3.247"></a><span id="l3.247" class="difflineminus">-  updateButtons: function (aButtonID, aPreferenceID)</span>
<a href="#l3.248"></a><span id="l3.248" class="difflineminus">-  {</span>
<a href="#l3.249"></a><span id="l3.249" class="difflineplus">+  updateButtons(aButtonID, aPreferenceID) {</span>
<a href="#l3.250"></a><span id="l3.250">     var button = document.getElementById(aButtonID);</span>
<a href="#l3.251"></a><span id="l3.251">     var preference = document.getElementById(aPreferenceID);</span>
<a href="#l3.252"></a><span id="l3.252">     // This is actually before the value changes, so the value is not as you expect.</span>
<a href="#l3.253"></a><span id="l3.253">     button.disabled = preference.value == true;</span>
<a href="#l3.254"></a><span id="l3.254">     return undefined;</span>
<a href="#l3.255"></a><span id="l3.255">   },</span>
<a href="#l3.256"></a><span id="l3.256"> </span>
<a href="#l3.257"></a><span id="l3.257"> /**</span>
<a href="#l3.258"></a><span id="l3.258">  * Selects the item of the radiogroup based on the pref values and locked</span>
<a href="#l3.259"></a><span id="l3.259">  * states.</span>
<a href="#l3.260"></a><span id="l3.260">  *</span>
<a href="#l3.261"></a><span id="l3.261">  * UI state matrix for update preference conditions</span>
<a href="#l3.262"></a><span id="l3.262">  *</span>
<a href="#l3.263"></a><span id="l3.263">  * UI Components:                              Preferences</span>
<a href="#l3.264"></a><span id="l3.264">  * Radiogroup                                  i   = app.update.auto</span>
<a href="#l3.265"></a><span id="l3.265">  */</span>
<a href="#l3.266"></a><span id="l3.266" class="difflineminus">-updateReadPrefs: function ()</span>
<a href="#l3.267"></a><span id="l3.267" class="difflineminus">-{</span>
<a href="#l3.268"></a><span id="l3.268" class="difflineplus">+updateReadPrefs() {</span>
<a href="#l3.269"></a><span id="l3.269">   var autoPref = document.getElementById(&quot;app.update.auto&quot;);</span>
<a href="#l3.270"></a><span id="l3.270">   var radiogroup = document.getElementById(&quot;updateRadioGroup&quot;);</span>
<a href="#l3.271"></a><span id="l3.271"> </span>
<a href="#l3.272"></a><span id="l3.272">   if (autoPref.value)</span>
<a href="#l3.273"></a><span id="l3.273" class="difflineminus">-    radiogroup.value=&quot;auto&quot;;      // Automatically install updates</span>
<a href="#l3.274"></a><span id="l3.274" class="difflineplus">+    radiogroup.value = &quot;auto&quot;;      // Automatically install updates</span>
<a href="#l3.275"></a><span id="l3.275">   else</span>
<a href="#l3.276"></a><span id="l3.276" class="difflineminus">-    radiogroup.value=&quot;checkOnly&quot;; // Check, but let me choose</span>
<a href="#l3.277"></a><span id="l3.277" class="difflineplus">+    radiogroup.value = &quot;checkOnly&quot;; // Check, but let me choose</span>
<a href="#l3.278"></a><span id="l3.278"> </span>
<a href="#l3.279"></a><span id="l3.279">   var canCheck = Cc[&quot;@mozilla.org/updates/update-service;1&quot;].</span>
<a href="#l3.280"></a><span id="l3.280">                    getService(Ci.nsIApplicationUpdateService).</span>
<a href="#l3.281"></a><span id="l3.281">                    canCheckForUpdates;</span>
<a href="#l3.282"></a><span id="l3.282"> </span>
<a href="#l3.283"></a><span id="l3.283">   // canCheck is false if the binary platform or OS version is not known.</span>
<a href="#l3.284"></a><span id="l3.284">   // A locked pref is sufficient to disable the radiogroup.</span>
<a href="#l3.285"></a><span id="l3.285">   radiogroup.disabled = !canCheck || autoPref.locked;</span>
<a href="#l3.286"></a><span id="l3.286" class="difflineat">@@ -326,140 +305,128 @@ updateReadPrefs: function ()</span>
<a href="#l3.287"></a><span id="l3.287">     try {</span>
<a href="#l3.288"></a><span id="l3.288">       let wrk = Cc[&quot;@mozilla.org/windows-registry-key;1&quot;]</span>
<a href="#l3.289"></a><span id="l3.289">                   .createInstance(Ci.nsIWindowsRegKey);</span>
<a href="#l3.290"></a><span id="l3.290">       wrk.open(wrk.ROOT_KEY_LOCAL_MACHINE,</span>
<a href="#l3.291"></a><span id="l3.291">                &quot;SOFTWARE\\Mozilla\\MaintenanceService&quot;,</span>
<a href="#l3.292"></a><span id="l3.292">                wrk.ACCESS_READ | wrk.WOW64_64);</span>
<a href="#l3.293"></a><span id="l3.293">       installed = wrk.readIntValue(&quot;Installed&quot;);</span>
<a href="#l3.294"></a><span id="l3.294">       wrk.close();</span>
<a href="#l3.295"></a><span id="l3.295" class="difflineminus">-    } catch(e) { }</span>
<a href="#l3.296"></a><span id="l3.296" class="difflineplus">+    } catch (e) { }</span>
<a href="#l3.297"></a><span id="l3.297">     if (installed != 1) {</span>
<a href="#l3.298"></a><span id="l3.298">       document.getElementById(&quot;useService&quot;).hidden = true;</span>
<a href="#l3.299"></a><span id="l3.299">     }</span>
<a href="#l3.300"></a><span id="l3.300">   }</span>
<a href="#l3.301"></a><span id="l3.301"> },</span>
<a href="#l3.302"></a><span id="l3.302"> </span>
<a href="#l3.303"></a><span id="l3.303"> /**</span>
<a href="#l3.304"></a><span id="l3.304">  * Sets the pref values based on the selected item of the radiogroup.</span>
<a href="#l3.305"></a><span id="l3.305">  */</span>
<a href="#l3.306"></a><span id="l3.306" class="difflineminus">-updateWritePrefs: function ()</span>
<a href="#l3.307"></a><span id="l3.307" class="difflineminus">-{</span>
<a href="#l3.308"></a><span id="l3.308" class="difflineplus">+updateWritePrefs() {</span>
<a href="#l3.309"></a><span id="l3.309">   var autoPref = document.getElementById(&quot;app.update.auto&quot;);</span>
<a href="#l3.310"></a><span id="l3.310">   var radiogroup = document.getElementById(&quot;updateRadioGroup&quot;);</span>
<a href="#l3.311"></a><span id="l3.311">   switch (radiogroup.value) {</span>
<a href="#l3.312"></a><span id="l3.312">     case &quot;auto&quot;:      // Automatically install updates</span>
<a href="#l3.313"></a><span id="l3.313">       autoPref.value = true;</span>
<a href="#l3.314"></a><span id="l3.314">       break;</span>
<a href="#l3.315"></a><span id="l3.315">     case &quot;checkOnly&quot;: // Check, but but let me choose</span>
<a href="#l3.316"></a><span id="l3.316">       autoPref.value = false;</span>
<a href="#l3.317"></a><span id="l3.317">       break;</span>
<a href="#l3.318"></a><span id="l3.318">   }</span>
<a href="#l3.319"></a><span id="l3.319"> },</span>
<a href="#l3.320"></a><span id="l3.320"> </span>
<a href="#l3.321"></a><span id="l3.321" class="difflineminus">-  showUpdates: function ()</span>
<a href="#l3.322"></a><span id="l3.322" class="difflineminus">-  {</span>
<a href="#l3.323"></a><span id="l3.323" class="difflineplus">+  showUpdates() {</span>
<a href="#l3.324"></a><span id="l3.324">     gSubDialog.open(&quot;chrome://mozapps/content/update/history.xul&quot;);</span>
<a href="#l3.325"></a><span id="l3.325">   },</span>
<a href="#l3.326"></a><span id="l3.326"> </span>
<a href="#l3.327"></a><span id="l3.327" class="difflineminus">-  updateCompactOptions: function(aCompactEnabled)</span>
<a href="#l3.328"></a><span id="l3.328" class="difflineminus">-  {</span>
<a href="#l3.329"></a><span id="l3.329" class="difflineplus">+  updateCompactOptions(aCompactEnabled) {</span>
<a href="#l3.330"></a><span id="l3.330">     document.getElementById(&quot;offlineCompactFolderMin&quot;).disabled =</span>
<a href="#l3.331"></a><span id="l3.331">       !document.getElementById(&quot;offlineCompactFolder&quot;).checked ||</span>
<a href="#l3.332"></a><span id="l3.332">       document.getElementById(&quot;mail.purge_threshhold_mb&quot;).locked;</span>
<a href="#l3.333"></a><span id="l3.333">   },</span>
<a href="#l3.334"></a><span id="l3.334"> </span>
<a href="#l3.335"></a><span id="l3.335" class="difflineminus">-  updateSubmitCrashReports: function(aChecked)</span>
<a href="#l3.336"></a><span id="l3.336" class="difflineminus">-  {</span>
<a href="#l3.337"></a><span id="l3.337" class="difflineplus">+  updateSubmitCrashReports(aChecked) {</span>
<a href="#l3.338"></a><span id="l3.338">     Cc[&quot;@mozilla.org/toolkit/crash-reporter;1&quot;]</span>
<a href="#l3.339"></a><span id="l3.339">       .getService(Ci.nsICrashReporter)</span>
<a href="#l3.340"></a><span id="l3.340">       .submitReports = aChecked;</span>
<a href="#l3.341"></a><span id="l3.341">   },</span>
<a href="#l3.342"></a><span id="l3.342">   /**</span>
<a href="#l3.343"></a><span id="l3.343">    * Display the return receipts configuration dialog.</span>
<a href="#l3.344"></a><span id="l3.344">    */</span>
<a href="#l3.345"></a><span id="l3.345" class="difflineminus">-  showReturnReceipts: function()</span>
<a href="#l3.346"></a><span id="l3.346" class="difflineminus">-  {</span>
<a href="#l3.347"></a><span id="l3.347" class="difflineplus">+  showReturnReceipts() {</span>
<a href="#l3.348"></a><span id="l3.348">     gSubDialog.open(&quot;chrome://messenger/content/preferences/receipts.xul&quot;,</span>
<a href="#l3.349"></a><span id="l3.349">                     &quot;resizable=no&quot;);</span>
<a href="#l3.350"></a><span id="l3.350">   },</span>
<a href="#l3.351"></a><span id="l3.351"> </span>
<a href="#l3.352"></a><span id="l3.352">   /**</span>
<a href="#l3.353"></a><span id="l3.353">    * Display the the connection settings dialog.</span>
<a href="#l3.354"></a><span id="l3.354">    */</span>
<a href="#l3.355"></a><span id="l3.355" class="difflineminus">-  showConnections: function ()</span>
<a href="#l3.356"></a><span id="l3.356" class="difflineminus">-  {</span>
<a href="#l3.357"></a><span id="l3.357" class="difflineplus">+  showConnections() {</span>
<a href="#l3.358"></a><span id="l3.358">     gSubDialog.open(&quot;chrome://messenger/content/preferences/connection.xul&quot;,</span>
<a href="#l3.359"></a><span id="l3.359">                     &quot;resizable=no&quot;);</span>
<a href="#l3.360"></a><span id="l3.360">   },</span>
<a href="#l3.361"></a><span id="l3.361"> </span>
<a href="#l3.362"></a><span id="l3.362">   /**</span>
<a href="#l3.363"></a><span id="l3.363">    * Display the the offline settings dialog.</span>
<a href="#l3.364"></a><span id="l3.364">    */</span>
<a href="#l3.365"></a><span id="l3.365" class="difflineminus">-  showOffline: function()</span>
<a href="#l3.366"></a><span id="l3.366" class="difflineminus">-  {</span>
<a href="#l3.367"></a><span id="l3.367" class="difflineplus">+  showOffline() {</span>
<a href="#l3.368"></a><span id="l3.368">     gSubDialog.open(&quot;chrome://messenger/content/preferences/offline.xul&quot;,</span>
<a href="#l3.369"></a><span id="l3.369">                     &quot;resizable=no&quot;);</span>
<a href="#l3.370"></a><span id="l3.370">   },</span>
<a href="#l3.371"></a><span id="l3.371"> </span>
<a href="#l3.372"></a><span id="l3.372">   /**</span>
<a href="#l3.373"></a><span id="l3.373">    * Display the user's certificates and associated options.</span>
<a href="#l3.374"></a><span id="l3.374">    */</span>
<a href="#l3.375"></a><span id="l3.375" class="difflineminus">-  showCertificates: function ()</span>
<a href="#l3.376"></a><span id="l3.376" class="difflineminus">-  {</span>
<a href="#l3.377"></a><span id="l3.377" class="difflineplus">+  showCertificates() {</span>
<a href="#l3.378"></a><span id="l3.378">     gSubDialog.open(&quot;chrome://pippki/content/certManager.xul&quot;);</span>
<a href="#l3.379"></a><span id="l3.379">   },</span>
<a href="#l3.380"></a><span id="l3.380"> </span>
<a href="#l3.381"></a><span id="l3.381">   /**</span>
<a href="#l3.382"></a><span id="l3.382">    * security.OCSP.enabled is an integer value for legacy reasons.</span>
<a href="#l3.383"></a><span id="l3.383">    * A value of 1 means OCSP is enabled. Any other value means it is disabled.</span>
<a href="#l3.384"></a><span id="l3.384">    */</span>
<a href="#l3.385"></a><span id="l3.385" class="difflineminus">-  readEnableOCSP: function ()</span>
<a href="#l3.386"></a><span id="l3.386" class="difflineminus">-  {</span>
<a href="#l3.387"></a><span id="l3.387" class="difflineplus">+  readEnableOCSP() {</span>
<a href="#l3.388"></a><span id="l3.388">     var preference = document.getElementById(&quot;security.OCSP.enabled&quot;);</span>
<a href="#l3.389"></a><span id="l3.389">     // This is the case if the preference is the default value.</span>
<a href="#l3.390"></a><span id="l3.390">     if (preference.value === undefined) {</span>
<a href="#l3.391"></a><span id="l3.391">       return true;</span>
<a href="#l3.392"></a><span id="l3.392">     }</span>
<a href="#l3.393"></a><span id="l3.393">     return preference.value == 1;</span>
<a href="#l3.394"></a><span id="l3.394">   },</span>
<a href="#l3.395"></a><span id="l3.395"> </span>
<a href="#l3.396"></a><span id="l3.396">   /**</span>
<a href="#l3.397"></a><span id="l3.397">    * See documentation for readEnableOCSP.</span>
<a href="#l3.398"></a><span id="l3.398">    */</span>
<a href="#l3.399"></a><span id="l3.399" class="difflineminus">-  writeEnableOCSP: function ()</span>
<a href="#l3.400"></a><span id="l3.400" class="difflineminus">-  {</span>
<a href="#l3.401"></a><span id="l3.401" class="difflineplus">+  writeEnableOCSP() {</span>
<a href="#l3.402"></a><span id="l3.402">     var checkbox = document.getElementById(&quot;enableOCSP&quot;);</span>
<a href="#l3.403"></a><span id="l3.403">     return checkbox.checked ? 1 : 0;</span>
<a href="#l3.404"></a><span id="l3.404">   },</span>
<a href="#l3.405"></a><span id="l3.405"> </span>
<a href="#l3.406"></a><span id="l3.406">   /**</span>
<a href="#l3.407"></a><span id="l3.407">    * Display a dialog from which the user can manage his security devices.</span>
<a href="#l3.408"></a><span id="l3.408">    */</span>
<a href="#l3.409"></a><span id="l3.409" class="difflineminus">-  showSecurityDevices: function ()</span>
<a href="#l3.410"></a><span id="l3.410" class="difflineminus">-  {</span>
<a href="#l3.411"></a><span id="l3.411" class="difflineplus">+  showSecurityDevices() {</span>
<a href="#l3.412"></a><span id="l3.412">     gSubDialog.open(&quot;chrome://pippki/content/device_manager.xul&quot;);</span>
<a href="#l3.413"></a><span id="l3.413">   },</span>
<a href="#l3.414"></a><span id="l3.414"> </span>
<a href="#l3.415"></a><span id="l3.415">   /**</span>
<a href="#l3.416"></a><span id="l3.416">    * When the user toggles the layers.acceleration.disabled pref,</span>
<a href="#l3.417"></a><span id="l3.417">    * sync its new value to the gfx.direct2d.disabled pref too.</span>
<a href="#l3.418"></a><span id="l3.418">    */</span>
<a href="#l3.419"></a><span id="l3.419" class="difflineminus">-  updateHardwareAcceleration: function(aVal)</span>
<a href="#l3.420"></a><span id="l3.420" class="difflineminus">-  {</span>
<a href="#l3.421"></a><span id="l3.421" class="difflineplus">+  updateHardwareAcceleration(aVal) {</span>
<a href="#l3.422"></a><span id="l3.422">     if (AppConstants.platforms == &quot;win&quot;)</span>
<a href="#l3.423"></a><span id="l3.423">       Services.prefs.setBoolPref(&quot;gfx.direct2d.disabled&quot;, !aVal);</span>
<a href="#l3.424"></a><span id="l3.424">   },</span>
<a href="#l3.425"></a><span id="l3.425"> </span>
<a href="#l3.426"></a><span id="l3.426">   // DATA CHOICES TAB</span>
<a href="#l3.427"></a><span id="l3.427"> </span>
<a href="#l3.428"></a><span id="l3.428">   /**</span>
<a href="#l3.429"></a><span id="l3.429">    * Open a text link.</span>
<a href="#l3.430"></a><span id="l3.430">    */</span>
<a href="#l3.431"></a><span id="l3.431" class="difflineminus">-  openTextLink: function (evt) {</span>
<a href="#l3.432"></a><span id="l3.432" class="difflineplus">+  openTextLink(evt) {</span>
<a href="#l3.433"></a><span id="l3.433">     // Opening links behind a modal dialog is poor form. Work around flawed</span>
<a href="#l3.434"></a><span id="l3.434">     // text-link handling by opening in browser if we'd instead get a content</span>
<a href="#l3.435"></a><span id="l3.435">     // tab behind the modal options dialog.</span>
<a href="#l3.436"></a><span id="l3.436">     if (Services.prefs.getBoolPref(&quot;browser.preferences.instantApply&quot;)) {</span>
<a href="#l3.437"></a><span id="l3.437">       return true; // Yes, open the link in a content tab.</span>
<a href="#l3.438"></a><span id="l3.438">     }</span>
<a href="#l3.439"></a><span id="l3.439">     var url = evt.target.getAttribute(&quot;href&quot;);</span>
<a href="#l3.440"></a><span id="l3.440">     var messenger = Cc[&quot;@mozilla.org/messenger;1&quot;]</span>
<a href="#l3.441"></a><span id="l3.441" class="difflineat">@@ -467,64 +434,61 @@ updateWritePrefs: function ()</span>
<a href="#l3.442"></a><span id="l3.442">     messenger.launchExternalURL(url);</span>
<a href="#l3.443"></a><span id="l3.443">     evt.preventDefault();</span>
<a href="#l3.444"></a><span id="l3.444">     return false;</span>
<a href="#l3.445"></a><span id="l3.445">   },</span>
<a href="#l3.446"></a><span id="l3.446"> </span>
<a href="#l3.447"></a><span id="l3.447">   /**</span>
<a href="#l3.448"></a><span id="l3.448">    * Set up or hide the Learn More links for various data collection options</span>
<a href="#l3.449"></a><span id="l3.449">    */</span>
<a href="#l3.450"></a><span id="l3.450" class="difflineminus">-  _setupLearnMoreLink: function (pref, element) {</span>
<a href="#l3.451"></a><span id="l3.451" class="difflineplus">+  _setupLearnMoreLink(pref, element) {</span>
<a href="#l3.452"></a><span id="l3.452">     // set up the Learn More link with the correct URL</span>
<a href="#l3.453"></a><span id="l3.453">     let url = Services.prefs.getCharPref(pref);</span>
<a href="#l3.454"></a><span id="l3.454">     let el = document.getElementById(element);</span>
<a href="#l3.455"></a><span id="l3.455"> </span>
<a href="#l3.456"></a><span id="l3.456">     if (url) {</span>
<a href="#l3.457"></a><span id="l3.457">       el.setAttribute(&quot;href&quot;, url);</span>
<a href="#l3.458"></a><span id="l3.458">     } else {</span>
<a href="#l3.459"></a><span id="l3.459">       el.setAttribute(&quot;hidden&quot;, &quot;true&quot;);</span>
<a href="#l3.460"></a><span id="l3.460">     }</span>
<a href="#l3.461"></a><span id="l3.461">   },</span>
<a href="#l3.462"></a><span id="l3.462"> </span>
<a href="#l3.463"></a><span id="l3.463" class="difflineminus">-  initSubmitCrashes: function ()</span>
<a href="#l3.464"></a><span id="l3.464" class="difflineminus">-  {</span>
<a href="#l3.465"></a><span id="l3.465" class="difflineplus">+  initSubmitCrashes() {</span>
<a href="#l3.466"></a><span id="l3.466">     var checkbox = document.getElementById(&quot;submitCrashesBox&quot;);</span>
<a href="#l3.467"></a><span id="l3.467">     try {</span>
<a href="#l3.468"></a><span id="l3.468">       var cr = Cc[&quot;@mozilla.org/toolkit/crash-reporter;1&quot;].</span>
<a href="#l3.469"></a><span id="l3.469">                getService(Ci.nsICrashReporter);</span>
<a href="#l3.470"></a><span id="l3.470">       checkbox.checked = cr.submitReports;</span>
<a href="#l3.471"></a><span id="l3.471">     } catch (e) {</span>
<a href="#l3.472"></a><span id="l3.472">       checkbox.style.display = &quot;none&quot;;</span>
<a href="#l3.473"></a><span id="l3.473">     }</span>
<a href="#l3.474"></a><span id="l3.474">     this._setupLearnMoreLink(&quot;toolkit.crashreporter.infoURL&quot;, &quot;crashReporterLearnMore&quot;);</span>
<a href="#l3.475"></a><span id="l3.475">   },</span>
<a href="#l3.476"></a><span id="l3.476"> </span>
<a href="#l3.477"></a><span id="l3.477" class="difflineminus">-  updateSubmitCrashes: function ()</span>
<a href="#l3.478"></a><span id="l3.478" class="difflineminus">-  {</span>
<a href="#l3.479"></a><span id="l3.479" class="difflineplus">+  updateSubmitCrashes() {</span>
<a href="#l3.480"></a><span id="l3.480">     var checkbox = document.getElementById(&quot;submitCrashesBox&quot;);</span>
<a href="#l3.481"></a><span id="l3.481">     try {</span>
<a href="#l3.482"></a><span id="l3.482">       var cr = Cc[&quot;@mozilla.org/toolkit/crash-reporter;1&quot;].</span>
<a href="#l3.483"></a><span id="l3.483">                getService(Ci.nsICrashReporter);</span>
<a href="#l3.484"></a><span id="l3.484">       cr.submitReports = checkbox.checked;</span>
<a href="#l3.485"></a><span id="l3.485">     } catch (e) { }</span>
<a href="#l3.486"></a><span id="l3.486">   },</span>
<a href="#l3.487"></a><span id="l3.487"> </span>
<a href="#l3.488"></a><span id="l3.488"> </span>
<a href="#l3.489"></a><span id="l3.489">   /**</span>
<a href="#l3.490"></a><span id="l3.490">    * The preference/checkbox is configured in XUL.</span>
<a href="#l3.491"></a><span id="l3.491">    *</span>
<a href="#l3.492"></a><span id="l3.492">    * In all cases, set up the Learn More link sanely</span>
<a href="#l3.493"></a><span id="l3.493">    */</span>
<a href="#l3.494"></a><span id="l3.494" class="difflineminus">-  initTelemetry: function ()</span>
<a href="#l3.495"></a><span id="l3.495" class="difflineminus">-  {</span>
<a href="#l3.496"></a><span id="l3.496" class="difflineplus">+  initTelemetry() {</span>
<a href="#l3.497"></a><span id="l3.497">     if (AppConstants.MOZ_TELEMETRY_REPORTING)</span>
<a href="#l3.498"></a><span id="l3.498">       this._setupLearnMoreLink(&quot;toolkit.telemetry.infoURL&quot;, &quot;telemetryLearnMore&quot;);</span>
<a href="#l3.499"></a><span id="l3.499">   },</span>
<a href="#l3.500"></a><span id="l3.500"> </span>
<a href="#l3.501"></a><span id="l3.501" class="difflineminus">-  formatLocaleSetLabels: function() {</span>
<a href="#l3.502"></a><span id="l3.502" class="difflineplus">+  formatLocaleSetLabels() {</span>
<a href="#l3.503"></a><span id="l3.503">     const localeService =</span>
<a href="#l3.504"></a><span id="l3.504">       Cc[&quot;@mozilla.org/intl/localeservice;1&quot;]</span>
<a href="#l3.505"></a><span id="l3.505">         .getService(Ci.mozILocaleService);</span>
<a href="#l3.506"></a><span id="l3.506">     const osprefs =</span>
<a href="#l3.507"></a><span id="l3.507">       Cc[&quot;@mozilla.org/intl/ospreferences;1&quot;]</span>
<a href="#l3.508"></a><span id="l3.508">         .getService(Ci.mozIOSPreferences);</span>
<a href="#l3.509"></a><span id="l3.509">     let appLocale = localeService.getAppLocalesAsBCP47()[0];</span>
<a href="#l3.510"></a><span id="l3.510">     let rsLocale = osprefs.getRegionalPrefsLocales()[0];</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l4.1"></a><span id="l4.1" class="difflineminus">--- a/mail/components/preferences/applicationManager.js</span>
<a href="#l4.2"></a><span id="l4.2" class="difflineplus">+++ b/mail/components/preferences/applicationManager.js</span>
<a href="#l4.3"></a><span id="l4.3" class="difflineat">@@ -64,18 +64,17 @@ var gAppManagerDialog = {</span>
<a href="#l4.4"></a><span id="l4.4">   remove: function appManager_remove() {</span>
<a href="#l4.5"></a><span id="l4.5">     var list = document.getElementById(&quot;appList&quot;);</span>
<a href="#l4.6"></a><span id="l4.6">     this._removed.push(list.selectedItem.app);</span>
<a href="#l4.7"></a><span id="l4.7">     var index = list.selectedIndex;</span>
<a href="#l4.8"></a><span id="l4.8">     list.selectedItem.remove();</span>
<a href="#l4.9"></a><span id="l4.9">     if (list.getRowCount() == 0) {</span>
<a href="#l4.10"></a><span id="l4.10">       // The list is now empty, make the bottom part disappear</span>
<a href="#l4.11"></a><span id="l4.11">       document.getElementById(&quot;appDetails&quot;).hidden = true;</span>
<a href="#l4.12"></a><span id="l4.12" class="difflineminus">-    }</span>
<a href="#l4.13"></a><span id="l4.13" class="difflineminus">-    else {</span>
<a href="#l4.14"></a><span id="l4.14" class="difflineplus">+    } else {</span>
<a href="#l4.15"></a><span id="l4.15">       // Select the item at the same index, if we removed the last</span>
<a href="#l4.16"></a><span id="l4.16">       // item of the list, select the previous item</span>
<a href="#l4.17"></a><span id="l4.17">       if (index == list.getRowCount())</span>
<a href="#l4.18"></a><span id="l4.18">         --index;</span>
<a href="#l4.19"></a><span id="l4.19">       list.selectedIndex = index;</span>
<a href="#l4.20"></a><span id="l4.20">     }</span>
<a href="#l4.21"></a><span id="l4.21">   },</span>
<a href="#l4.22"></a><span id="l4.22"> </span>
<a href="#l4.23"></a><span id="l4.23" class="difflineat">@@ -94,10 +93,10 @@ var gAppManagerDialog = {</span>
<a href="#l4.24"></a><span id="l4.24">       address = app.uriTemplate;</span>
<a href="#l4.25"></a><span id="l4.25">     else if (app instanceof Ci.nsIWebContentHandlerInfo)</span>
<a href="#l4.26"></a><span id="l4.26">       address = app.uri;</span>
<a href="#l4.27"></a><span id="l4.27">     document.getElementById(&quot;appLocation&quot;).value = address;</span>
<a href="#l4.28"></a><span id="l4.28">     var bundle = document.getElementById(&quot;appManagerBundle&quot;);</span>
<a href="#l4.29"></a><span id="l4.29">     var appType = (app instanceof Ci.nsILocalHandlerApp) ?</span>
<a href="#l4.30"></a><span id="l4.30">                     &quot;descriptionLocalApp&quot; : &quot;descriptionWebApp&quot;;</span>
<a href="#l4.31"></a><span id="l4.31">     document.getElementById(&quot;appType&quot;).value = bundle.getString(appType);</span>
<a href="#l4.32"></a><span id="l4.32" class="difflineminus">-  }</span>
<a href="#l4.33"></a><span id="l4.33" class="difflineplus">+  },</span>
<a href="#l4.34"></a><span id="l4.34"> };</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l5.1"></a><span id="l5.1" class="difflineminus">--- a/mail/components/preferences/applications.js</span>
<a href="#l5.2"></a><span id="l5.2" class="difflineplus">+++ b/mail/components/preferences/applications.js</span>
<a href="#l5.3"></a><span id="l5.3" class="difflineat">@@ -1,14 +1,14 @@</span>
<a href="#l5.4"></a><span id="l5.4"> /* -*- Mode: Java; tab-width: 2; indent-tabs-mode: nil; c-basic-offset: 2 -*-</span>
<a href="#l5.5"></a><span id="l5.5">  * This Source Code Form is subject to the terms of the Mozilla Public</span>
<a href="#l5.6"></a><span id="l5.6">  * License, v. 2.0. If a copy of the MPL was not distributed with this</span>
<a href="#l5.7"></a><span id="l5.7">  * file, You can obtain one at http://mozilla.org/MPL/2.0/. */</span>
<a href="#l5.8"></a><span id="l5.8"> </span>
<a href="#l5.9"></a><span id="l5.9" class="difflineminus">-//****************************************************************************//</span>
<a href="#l5.10"></a><span id="l5.10" class="difflineplus">+//* ***************************************************************************//</span>
<a href="#l5.11"></a><span id="l5.11"> // Constants &amp; Enumeration Values</span>
<a href="#l5.12"></a><span id="l5.12"> </span>
<a href="#l5.13"></a><span id="l5.13"> var PREF_DISABLED_PLUGIN_TYPES = &quot;plugin.disable_full_page_plugin_for_types&quot;;</span>
<a href="#l5.14"></a><span id="l5.14"> </span>
<a href="#l5.15"></a><span id="l5.15"> // Preferences that affect which entries to show in the list.</span>
<a href="#l5.16"></a><span id="l5.16"> var PREF_SHOW_PLUGINS_IN_LIST = &quot;browser.download.show_plugins_in_list&quot;;</span>
<a href="#l5.17"></a><span id="l5.17"> var PREF_HIDE_PLUGINS_WITHOUT_EXTENSIONS =</span>
<a href="#l5.18"></a><span id="l5.18">   &quot;browser.download.hide_plugins_without_extensions&quot;;</span>
<a href="#l5.19"></a><span id="l5.19" class="difflineat">@@ -24,36 +24,33 @@ var kActionUsePlugin = 5;</span>
<a href="#l5.20"></a><span id="l5.20"> var APP_ICON_ATTR_NAME = &quot;appHandlerIcon&quot;;</span>
<a href="#l5.21"></a><span id="l5.21"> </span>
<a href="#l5.22"></a><span id="l5.22"> // CloudFile account tools used by gCloudFileTab.</span>
<a href="#l5.23"></a><span id="l5.23"> ChromeUtils.import(&quot;resource:///modules/cloudFileAccounts.js&quot;);</span>
<a href="#l5.24"></a><span id="l5.24"> ChromeUtils.import(&quot;resource://gre/modules/Services.jsm&quot;);</span>
<a href="#l5.25"></a><span id="l5.25"> ChromeUtils.import(&quot;resource://gre/modules/XPCOMUtils.jsm&quot;);</span>
<a href="#l5.26"></a><span id="l5.26"> ChromeUtils.import(&quot;resource://gre/modules/AppConstants.jsm&quot;);</span>
<a href="#l5.27"></a><span id="l5.27"> </span>
<a href="#l5.28"></a><span id="l5.28" class="difflineminus">-//****************************************************************************//</span>
<a href="#l5.29"></a><span id="l5.29" class="difflineplus">+//* ***************************************************************************//</span>
<a href="#l5.30"></a><span id="l5.30"> // Utilities</span>
<a href="#l5.31"></a><span id="l5.31"> </span>
<a href="#l5.32"></a><span id="l5.32"> function getDisplayNameForFile(aFile) {</span>
<a href="#l5.33"></a><span id="l5.33">   if (AppConstants.platform == &quot;win&quot;) {</span>
<a href="#l5.34"></a><span id="l5.34">     if (aFile instanceof Ci.nsILocalFileWin) {</span>
<a href="#l5.35"></a><span id="l5.35">       try {</span>
<a href="#l5.36"></a><span id="l5.36">         return aFile.getVersionInfoField(&quot;FileDescription&quot;);</span>
<a href="#l5.37"></a><span id="l5.37" class="difflineminus">-      }</span>
<a href="#l5.38"></a><span id="l5.38" class="difflineminus">-      catch(ex) {</span>
<a href="#l5.39"></a><span id="l5.39" class="difflineplus">+      } catch (ex) {</span>
<a href="#l5.40"></a><span id="l5.40">         // fall through to the file name</span>
<a href="#l5.41"></a><span id="l5.41">       }</span>
<a href="#l5.42"></a><span id="l5.42">     }</span>
<a href="#l5.43"></a><span id="l5.43" class="difflineminus">-  }</span>
<a href="#l5.44"></a><span id="l5.44" class="difflineminus">-  else if (AppConstants.platform == &quot;macosx&quot;) {</span>
<a href="#l5.45"></a><span id="l5.45" class="difflineplus">+  } else if (AppConstants.platform == &quot;macosx&quot;) {</span>
<a href="#l5.46"></a><span id="l5.46">     if (aFile instanceof Ci.nsILocalFileMac) {</span>
<a href="#l5.47"></a><span id="l5.47">       try {</span>
<a href="#l5.48"></a><span id="l5.48">         return aFile.bundleDisplayName;</span>
<a href="#l5.49"></a><span id="l5.49" class="difflineminus">-      }</span>
<a href="#l5.50"></a><span id="l5.50" class="difflineminus">-      catch(ex) {</span>
<a href="#l5.51"></a><span id="l5.51" class="difflineplus">+      } catch (ex) {</span>
<a href="#l5.52"></a><span id="l5.52">         // fall through to the file name</span>
<a href="#l5.53"></a><span id="l5.53">       }</span>
<a href="#l5.54"></a><span id="l5.54">     }</span>
<a href="#l5.55"></a><span id="l5.55">   }</span>
<a href="#l5.56"></a><span id="l5.56"> </span>
<a href="#l5.57"></a><span id="l5.57">   return aFile.leafName;</span>
<a href="#l5.58"></a><span id="l5.58"> }</span>
<a href="#l5.59"></a><span id="l5.59"> </span>
<a href="#l5.60"></a><span id="l5.60" class="difflineat">@@ -76,26 +73,26 @@ function getLocalHandlerApp(aFile) {</span>
<a href="#l5.61"></a><span id="l5.61"> function ArrayEnumerator(aItems) {</span>
<a href="#l5.62"></a><span id="l5.62">   this._index = 0;</span>
<a href="#l5.63"></a><span id="l5.63">   this._contents = aItems;</span>
<a href="#l5.64"></a><span id="l5.64"> }</span>
<a href="#l5.65"></a><span id="l5.65"> </span>
<a href="#l5.66"></a><span id="l5.66"> ArrayEnumerator.prototype = {</span>
<a href="#l5.67"></a><span id="l5.67">   _index: 0,</span>
<a href="#l5.68"></a><span id="l5.68"> </span>
<a href="#l5.69"></a><span id="l5.69" class="difflineminus">-  hasMoreElements: function() {</span>
<a href="#l5.70"></a><span id="l5.70" class="difflineplus">+  hasMoreElements() {</span>
<a href="#l5.71"></a><span id="l5.71">     return this._index &lt; this._contents.length;</span>
<a href="#l5.72"></a><span id="l5.72">   },</span>
<a href="#l5.73"></a><span id="l5.73"> </span>
<a href="#l5.74"></a><span id="l5.74" class="difflineminus">-  getNext: function() {</span>
<a href="#l5.75"></a><span id="l5.75" class="difflineplus">+  getNext() {</span>
<a href="#l5.76"></a><span id="l5.76">     return this._contents[this._index++];</span>
<a href="#l5.77"></a><span id="l5.77" class="difflineminus">-  }</span>
<a href="#l5.78"></a><span id="l5.78" class="difflineplus">+  },</span>
<a href="#l5.79"></a><span id="l5.79"> };</span>
<a href="#l5.80"></a><span id="l5.80"> </span>
<a href="#l5.81"></a><span id="l5.81" class="difflineminus">-//****************************************************************************//</span>
<a href="#l5.82"></a><span id="l5.82" class="difflineplus">+//* ***************************************************************************//</span>
<a href="#l5.83"></a><span id="l5.83"> // HandlerInfoWrapper</span>
<a href="#l5.84"></a><span id="l5.84"> </span>
<a href="#l5.85"></a><span id="l5.85"> /**</span>
<a href="#l5.86"></a><span id="l5.86">  * This object wraps nsIHandlerInfo with some additional functionality</span>
<a href="#l5.87"></a><span id="l5.87">  * the Applications prefpane needs to display and allow modification of</span>
<a href="#l5.88"></a><span id="l5.88">  * the list of handled types.</span>
<a href="#l5.89"></a><span id="l5.89">  *</span>
<a href="#l5.90"></a><span id="l5.90">  * We create an instance of this wrapper for each entry we might display</span>
<a href="#l5.91"></a><span id="l5.91" class="difflineat">@@ -114,26 +111,26 @@ function HandlerInfoWrapper(aType, aHand</span>
<a href="#l5.92"></a><span id="l5.92"> }</span>
<a href="#l5.93"></a><span id="l5.93"> </span>
<a href="#l5.94"></a><span id="l5.94"> HandlerInfoWrapper.prototype = {</span>
<a href="#l5.95"></a><span id="l5.95">   // The wrapped nsIHandlerInfo object.  In general, this object is private,</span>
<a href="#l5.96"></a><span id="l5.96">   // but there are a couple cases where callers access it directly for things</span>
<a href="#l5.97"></a><span id="l5.97">   // we haven't (yet?) implemented, so we make it a public property.</span>
<a href="#l5.98"></a><span id="l5.98">   wrappedHandlerInfo: null,</span>
<a href="#l5.99"></a><span id="l5.99"> </span>
<a href="#l5.100"></a><span id="l5.100" class="difflineminus">-  //**************************************************************************//</span>
<a href="#l5.101"></a><span id="l5.101" class="difflineplus">+  //* *************************************************************************//</span>
<a href="#l5.102"></a><span id="l5.102">   // Convenience Utils</span>
<a href="#l5.103"></a><span id="l5.103"> </span>
<a href="#l5.104"></a><span id="l5.104">   _handlerSvc: Cc[&quot;@mozilla.org/uriloader/handler-service;1&quot;]</span>
<a href="#l5.105"></a><span id="l5.105">                  .getService(Ci.nsIHandlerService),</span>
<a href="#l5.106"></a><span id="l5.106"> </span>
<a href="#l5.107"></a><span id="l5.107">   _categoryMgr: Cc[&quot;@mozilla.org/categorymanager;1&quot;]</span>
<a href="#l5.108"></a><span id="l5.108">                   .getService(Ci.nsICategoryManager),</span>
<a href="#l5.109"></a><span id="l5.109"> </span>
<a href="#l5.110"></a><span id="l5.110" class="difflineminus">-  //**************************************************************************//</span>
<a href="#l5.111"></a><span id="l5.111" class="difflineplus">+  //* *************************************************************************//</span>
<a href="#l5.112"></a><span id="l5.112">   // nsIHandlerInfo</span>
<a href="#l5.113"></a><span id="l5.113"> </span>
<a href="#l5.114"></a><span id="l5.114">   // The MIME type or protocol scheme.</span>
<a href="#l5.115"></a><span id="l5.115">   _type: null,</span>
<a href="#l5.116"></a><span id="l5.116">   get type() {</span>
<a href="#l5.117"></a><span id="l5.117">     return this._type;</span>
<a href="#l5.118"></a><span id="l5.118">   },</span>
<a href="#l5.119"></a><span id="l5.119"> </span>
<a href="#l5.120"></a><span id="l5.120" class="difflineat">@@ -153,32 +150,32 @@ HandlerInfoWrapper.prototype = {</span>
<a href="#l5.121"></a><span id="l5.121">     return this.wrappedHandlerInfo.preferredApplicationHandler;</span>
<a href="#l5.122"></a><span id="l5.122">   },</span>
<a href="#l5.123"></a><span id="l5.123"> </span>
<a href="#l5.124"></a><span id="l5.124">   set preferredApplicationHandler(aNewValue) {</span>
<a href="#l5.125"></a><span id="l5.125">     this.wrappedHandlerInfo.preferredApplicationHandler = aNewValue;</span>
<a href="#l5.126"></a><span id="l5.126"> </span>
<a href="#l5.127"></a><span id="l5.127">     // Make sure the preferred handler is in the set of possible handlers.</span>
<a href="#l5.128"></a><span id="l5.128">     if (aNewValue)</span>
<a href="#l5.129"></a><span id="l5.129" class="difflineminus">-      this.addPossibleApplicationHandler(aNewValue)</span>
<a href="#l5.130"></a><span id="l5.130" class="difflineplus">+      this.addPossibleApplicationHandler(aNewValue);</span>
<a href="#l5.131"></a><span id="l5.131">   },</span>
<a href="#l5.132"></a><span id="l5.132"> </span>
<a href="#l5.133"></a><span id="l5.133">   get possibleApplicationHandlers() {</span>
<a href="#l5.134"></a><span id="l5.134">     return this.wrappedHandlerInfo.possibleApplicationHandlers;</span>
<a href="#l5.135"></a><span id="l5.135">   },</span>
<a href="#l5.136"></a><span id="l5.136"> </span>
<a href="#l5.137"></a><span id="l5.137" class="difflineminus">-  addPossibleApplicationHandler: function(aNewHandler) {</span>
<a href="#l5.138"></a><span id="l5.138" class="difflineplus">+  addPossibleApplicationHandler(aNewHandler) {</span>
<a href="#l5.139"></a><span id="l5.139">     try {</span>
<a href="#l5.140"></a><span id="l5.140">       if (this.possibleApplicationHandlers.indexOf(0, aNewHandler) != -1)</span>
<a href="#l5.141"></a><span id="l5.141">         return;</span>
<a href="#l5.142"></a><span id="l5.142">     } catch (e) { }</span>
<a href="#l5.143"></a><span id="l5.143">     this.possibleApplicationHandlers.appendElement(aNewHandler);</span>
<a href="#l5.144"></a><span id="l5.144">   },</span>
<a href="#l5.145"></a><span id="l5.145"> </span>
<a href="#l5.146"></a><span id="l5.146" class="difflineminus">-  removePossibleApplicationHandler: function(aHandler) {</span>
<a href="#l5.147"></a><span id="l5.147" class="difflineplus">+  removePossibleApplicationHandler(aHandler) {</span>
<a href="#l5.148"></a><span id="l5.148">     var defaultApp = this.preferredApplicationHandler;</span>
<a href="#l5.149"></a><span id="l5.149">     if (defaultApp &amp;&amp; aHandler.equals(defaultApp)) {</span>
<a href="#l5.150"></a><span id="l5.150">       // If the app we remove was the default app, we must make sure</span>
<a href="#l5.151"></a><span id="l5.151">       // it won't be used anymore</span>
<a href="#l5.152"></a><span id="l5.152">       this.alwaysAskBeforeHandling = true;</span>
<a href="#l5.153"></a><span id="l5.153">       this.preferredApplicationHandler = null;</span>
<a href="#l5.154"></a><span id="l5.154">     }</span>
<a href="#l5.155"></a><span id="l5.155"> </span>
<a href="#l5.156"></a><span id="l5.156" class="difflineat">@@ -208,18 +205,17 @@ HandlerInfoWrapper.prototype = {</span>
<a href="#l5.157"></a><span id="l5.157">     // Note: &quot;save to disk&quot; is an invalid value for protocol info objects,</span>
<a href="#l5.158"></a><span id="l5.158">     // but the alwaysAskBeforeHandling getter will detect that situation</span>
<a href="#l5.159"></a><span id="l5.159">     // and always return true in that case to override this invalid value.</span>
<a href="#l5.160"></a><span id="l5.160">     if (this.wrappedHandlerInfo.preferredAction ==</span>
<a href="#l5.161"></a><span id="l5.161">           Ci.nsIHandlerInfo.useHelperApp &amp;&amp;</span>
<a href="#l5.162"></a><span id="l5.162">         !gApplicationsPane.isValidHandlerApp(this.preferredApplicationHandler)) {</span>
<a href="#l5.163"></a><span id="l5.163">       if (this.wrappedHandlerInfo.hasDefaultHandler)</span>
<a href="#l5.164"></a><span id="l5.164">         return Ci.nsIHandlerInfo.useSystemDefault;</span>
<a href="#l5.165"></a><span id="l5.165" class="difflineminus">-      else</span>
<a href="#l5.166"></a><span id="l5.166" class="difflineminus">-        return Ci.nsIHandlerInfo.saveToDisk;</span>
<a href="#l5.167"></a><span id="l5.167" class="difflineplus">+      return Ci.nsIHandlerInfo.saveToDisk;</span>
<a href="#l5.168"></a><span id="l5.168">     }</span>
<a href="#l5.169"></a><span id="l5.169"> </span>
<a href="#l5.170"></a><span id="l5.170">     return this.wrappedHandlerInfo.preferredAction;</span>
<a href="#l5.171"></a><span id="l5.171">   },</span>
<a href="#l5.172"></a><span id="l5.172"> </span>
<a href="#l5.173"></a><span id="l5.173">   set preferredAction(aNewValue) {</span>
<a href="#l5.174"></a><span id="l5.174">     // We don't modify the preferred action if the new action is to use a plugin</span>
<a href="#l5.175"></a><span id="l5.175">     // because handler info objects don't understand our custom &quot;use plugin&quot;</span>
<a href="#l5.176"></a><span id="l5.176" class="difflineat">@@ -252,36 +248,36 @@ HandlerInfoWrapper.prototype = {</span>
<a href="#l5.177"></a><span id="l5.177">     return this.wrappedHandlerInfo.alwaysAskBeforeHandling;</span>
<a href="#l5.178"></a><span id="l5.178">   },</span>
<a href="#l5.179"></a><span id="l5.179"> </span>
<a href="#l5.180"></a><span id="l5.180">   set alwaysAskBeforeHandling(aNewValue) {</span>
<a href="#l5.181"></a><span id="l5.181">     this.wrappedHandlerInfo.alwaysAskBeforeHandling = aNewValue;</span>
<a href="#l5.182"></a><span id="l5.182">   },</span>
<a href="#l5.183"></a><span id="l5.183"> </span>
<a href="#l5.184"></a><span id="l5.184"> </span>
<a href="#l5.185"></a><span id="l5.185" class="difflineminus">-  //**************************************************************************//</span>
<a href="#l5.186"></a><span id="l5.186" class="difflineplus">+  //* *************************************************************************//</span>
<a href="#l5.187"></a><span id="l5.187">   // nsIMIMEInfo</span>
<a href="#l5.188"></a><span id="l5.188"> </span>
<a href="#l5.189"></a><span id="l5.189">   // The primary file extension associated with this type, if any.</span>
<a href="#l5.190"></a><span id="l5.190">   //</span>
<a href="#l5.191"></a><span id="l5.191">   // XXX Plugin objects contain an array of MimeType objects with &quot;suffixes&quot;</span>
<a href="#l5.192"></a><span id="l5.192">   // properties; if this object has an associated plugin, shouldn't we check</span>
<a href="#l5.193"></a><span id="l5.193">   // those properties for an extension?</span>
<a href="#l5.194"></a><span id="l5.194">   get primaryExtension() {</span>
<a href="#l5.195"></a><span id="l5.195">     try {</span>
<a href="#l5.196"></a><span id="l5.196">       if (this.wrappedHandlerInfo instanceof Ci.nsIMIMEInfo &amp;&amp;</span>
<a href="#l5.197"></a><span id="l5.197">           this.wrappedHandlerInfo.primaryExtension)</span>
<a href="#l5.198"></a><span id="l5.198">         return this.wrappedHandlerInfo.primaryExtension;</span>
<a href="#l5.199"></a><span id="l5.199" class="difflineminus">-    } catch(ex) {}</span>
<a href="#l5.200"></a><span id="l5.200" class="difflineplus">+    } catch (ex) {}</span>
<a href="#l5.201"></a><span id="l5.201"> </span>
<a href="#l5.202"></a><span id="l5.202">     return null;</span>
<a href="#l5.203"></a><span id="l5.203">   },</span>
<a href="#l5.204"></a><span id="l5.204"> </span>
<a href="#l5.205"></a><span id="l5.205"> </span>
<a href="#l5.206"></a><span id="l5.206" class="difflineminus">-  //**************************************************************************//</span>
<a href="#l5.207"></a><span id="l5.207" class="difflineplus">+  //* *************************************************************************//</span>
<a href="#l5.208"></a><span id="l5.208">   // Plugin Handling</span>
<a href="#l5.209"></a><span id="l5.209"> </span>
<a href="#l5.210"></a><span id="l5.210">   // A plugin that can handle this type, if any.</span>
<a href="#l5.211"></a><span id="l5.211">   //</span>
<a href="#l5.212"></a><span id="l5.212">   // Note: just because we have one doesn't mean it *will* handle the type.</span>
<a href="#l5.213"></a><span id="l5.213">   // That depends on whether or not the type is in the list of types for which</span>
<a href="#l5.214"></a><span id="l5.214">   // plugin handling is disabled.</span>
<a href="#l5.215"></a><span id="l5.215">   plugin: null,</span>
<a href="#l5.216"></a><span id="l5.216" class="difflineat">@@ -299,43 +295,43 @@ HandlerInfoWrapper.prototype = {</span>
<a href="#l5.217"></a><span id="l5.217">   // check for the presence of a user-configured record to determine whether</span>
<a href="#l5.218"></a><span id="l5.218">   // or not this type is only handled by a plugin.  Filed as bug 395142.</span>
<a href="#l5.219"></a><span id="l5.219">   handledOnlyByPlugin: undefined,</span>
<a href="#l5.220"></a><span id="l5.220"> </span>
<a href="#l5.221"></a><span id="l5.221">   get isDisabledPluginType() {</span>
<a href="#l5.222"></a><span id="l5.222">     return this._getDisabledPluginTypes().includes(this.type);</span>
<a href="#l5.223"></a><span id="l5.223">   },</span>
<a href="#l5.224"></a><span id="l5.224"> </span>
<a href="#l5.225"></a><span id="l5.225" class="difflineminus">-  _getDisabledPluginTypes: function() {</span>
<a href="#l5.226"></a><span id="l5.226" class="difflineplus">+  _getDisabledPluginTypes() {</span>
<a href="#l5.227"></a><span id="l5.227">     var types = &quot;&quot;;</span>
<a href="#l5.228"></a><span id="l5.228"> </span>
<a href="#l5.229"></a><span id="l5.229">     if (Services.prefs.prefHasUserValue(PREF_DISABLED_PLUGIN_TYPES))</span>
<a href="#l5.230"></a><span id="l5.230">       types = Services.prefs.getCharPref(PREF_DISABLED_PLUGIN_TYPES);</span>
<a href="#l5.231"></a><span id="l5.231"> </span>
<a href="#l5.232"></a><span id="l5.232">     // Only split if the string isn't empty so we don't end up with an array</span>
<a href="#l5.233"></a><span id="l5.233">     // containing a single empty string.</span>
<a href="#l5.234"></a><span id="l5.234">     return types ? types.split(&quot;,&quot;) : [];</span>
<a href="#l5.235"></a><span id="l5.235">   },</span>
<a href="#l5.236"></a><span id="l5.236"> </span>
<a href="#l5.237"></a><span id="l5.237" class="difflineminus">-  disablePluginType: function() {</span>
<a href="#l5.238"></a><span id="l5.238" class="difflineplus">+  disablePluginType() {</span>
<a href="#l5.239"></a><span id="l5.239">     var disabledPluginTypes = this._getDisabledPluginTypes();</span>
<a href="#l5.240"></a><span id="l5.240"> </span>
<a href="#l5.241"></a><span id="l5.241">     if (!disabledPluginTypes.includes(this.type))</span>
<a href="#l5.242"></a><span id="l5.242">       disabledPluginTypes.push(this.type);</span>
<a href="#l5.243"></a><span id="l5.243"> </span>
<a href="#l5.244"></a><span id="l5.244">     Services.prefs.setCharPref(PREF_DISABLED_PLUGIN_TYPES,</span>
<a href="#l5.245"></a><span id="l5.245">                                disabledPluginTypes.join(&quot;,&quot;));</span>
<a href="#l5.246"></a><span id="l5.246"> </span>
<a href="#l5.247"></a><span id="l5.247">     // Update the category manager so existing browser windows update.</span>
<a href="#l5.248"></a><span id="l5.248">     this._categoryMgr.deleteCategoryEntry(&quot;Gecko-Content-Viewers&quot;,</span>
<a href="#l5.249"></a><span id="l5.249">                                           this.type,</span>
<a href="#l5.250"></a><span id="l5.250">                                           false);</span>
<a href="#l5.251"></a><span id="l5.251">   },</span>
<a href="#l5.252"></a><span id="l5.252"> </span>
<a href="#l5.253"></a><span id="l5.253" class="difflineminus">-  enablePluginType: function() {</span>
<a href="#l5.254"></a><span id="l5.254" class="difflineplus">+  enablePluginType() {</span>
<a href="#l5.255"></a><span id="l5.255">     var disabledPluginTypes = this._getDisabledPluginTypes();</span>
<a href="#l5.256"></a><span id="l5.256"> </span>
<a href="#l5.257"></a><span id="l5.257">     var type = this.type;</span>
<a href="#l5.258"></a><span id="l5.258">     disabledPluginTypes = disabledPluginTypes.filter(v =&gt; v != type);</span>
<a href="#l5.259"></a><span id="l5.259"> </span>
<a href="#l5.260"></a><span id="l5.260">     Services.prefs.setCharPref(PREF_DISABLED_PLUGIN_TYPES,</span>
<a href="#l5.261"></a><span id="l5.261">                                disabledPluginTypes.join(&quot;,&quot;));</span>
<a href="#l5.262"></a><span id="l5.262"> </span>
<a href="#l5.263"></a><span id="l5.263" class="difflineat">@@ -344,59 +340,59 @@ HandlerInfoWrapper.prototype = {</span>
<a href="#l5.264"></a><span id="l5.264">       addCategoryEntry(&quot;Gecko-Content-Viewers&quot;,</span>
<a href="#l5.265"></a><span id="l5.265">                        this.type,</span>
<a href="#l5.266"></a><span id="l5.266">                        &quot;@mozilla.org/content/plugin/document-loader-factory;1&quot;,</span>
<a href="#l5.267"></a><span id="l5.267">                        false,</span>
<a href="#l5.268"></a><span id="l5.268">                        true);</span>
<a href="#l5.269"></a><span id="l5.269">   },</span>
<a href="#l5.270"></a><span id="l5.270"> </span>
<a href="#l5.271"></a><span id="l5.271"> </span>
<a href="#l5.272"></a><span id="l5.272" class="difflineminus">-  //**************************************************************************//</span>
<a href="#l5.273"></a><span id="l5.273" class="difflineplus">+  //* *************************************************************************//</span>
<a href="#l5.274"></a><span id="l5.274">   // Storage</span>
<a href="#l5.275"></a><span id="l5.275"> </span>
<a href="#l5.276"></a><span id="l5.276" class="difflineminus">-  store: function() {</span>
<a href="#l5.277"></a><span id="l5.277" class="difflineplus">+  store() {</span>
<a href="#l5.278"></a><span id="l5.278">     this._handlerSvc.store(this.wrappedHandlerInfo);</span>
<a href="#l5.279"></a><span id="l5.279">   },</span>
<a href="#l5.280"></a><span id="l5.280"> </span>
<a href="#l5.281"></a><span id="l5.281" class="difflineminus">-  remove: function() {</span>
<a href="#l5.282"></a><span id="l5.282" class="difflineplus">+  remove() {</span>
<a href="#l5.283"></a><span id="l5.283">     this._handlerSvc.remove(this.wrappedHandlerInfo);</span>
<a href="#l5.284"></a><span id="l5.284">   },</span>
<a href="#l5.285"></a><span id="l5.285"> </span>
<a href="#l5.286"></a><span id="l5.286"> </span>
<a href="#l5.287"></a><span id="l5.287" class="difflineminus">-  //**************************************************************************//</span>
<a href="#l5.288"></a><span id="l5.288" class="difflineplus">+  //* *************************************************************************//</span>
<a href="#l5.289"></a><span id="l5.289">   // Icons</span>
<a href="#l5.290"></a><span id="l5.290"> </span>
<a href="#l5.291"></a><span id="l5.291">   get smallIcon() {</span>
<a href="#l5.292"></a><span id="l5.292">     return this._getIcon(16);</span>
<a href="#l5.293"></a><span id="l5.293">   },</span>
<a href="#l5.294"></a><span id="l5.294"> </span>
<a href="#l5.295"></a><span id="l5.295">   get largeIcon() {</span>
<a href="#l5.296"></a><span id="l5.296">     return this._getIcon(32);</span>
<a href="#l5.297"></a><span id="l5.297">   },</span>
<a href="#l5.298"></a><span id="l5.298"> </span>
<a href="#l5.299"></a><span id="l5.299" class="difflineminus">-  _getIcon: function(aSize) {</span>
<a href="#l5.300"></a><span id="l5.300" class="difflineplus">+  _getIcon(aSize) {</span>
<a href="#l5.301"></a><span id="l5.301">     if (this.primaryExtension)</span>
<a href="#l5.302"></a><span id="l5.302">       return &quot;moz-icon://goat.&quot; + this.primaryExtension + &quot;?size=&quot; + aSize;</span>
<a href="#l5.303"></a><span id="l5.303"> </span>
<a href="#l5.304"></a><span id="l5.304">     if (this.wrappedHandlerInfo instanceof Ci.nsIMIMEInfo)</span>
<a href="#l5.305"></a><span id="l5.305">       return &quot;moz-icon://goat?size=&quot; + aSize + &quot;&amp;contentType=&quot; + this.type;</span>
<a href="#l5.306"></a><span id="l5.306"> </span>
<a href="#l5.307"></a><span id="l5.307">     // FIXME: consider returning some generic icon when we can't get a URL for</span>
<a href="#l5.308"></a><span id="l5.308">     // one (for example in the case of protocol schemes).  Filed as bug 395141.</span>
<a href="#l5.309"></a><span id="l5.309">     return null;</span>
<a href="#l5.310"></a><span id="l5.310" class="difflineminus">-  }</span>
<a href="#l5.311"></a><span id="l5.311" class="difflineplus">+  },</span>
<a href="#l5.312"></a><span id="l5.312"> };</span>
<a href="#l5.313"></a><span id="l5.313"> </span>
<a href="#l5.314"></a><span id="l5.314"> var gApplicationsTabController = {</span>
<a href="#l5.315"></a><span id="l5.315">   mInitialized: false,</span>
<a href="#l5.316"></a><span id="l5.316">   // We default to displaying the Outgoing tab, which is the tab at index 1</span>
<a href="#l5.317"></a><span id="l5.317">   // of the attachmentPrefs tabs.</span>
<a href="#l5.318"></a><span id="l5.318">   mDefaultIndex: 1,</span>
<a href="#l5.319"></a><span id="l5.319"> </span>
<a href="#l5.320"></a><span id="l5.320" class="difflineminus">-  init: function() {</span>
<a href="#l5.321"></a><span id="l5.321" class="difflineplus">+  init() {</span>
<a href="#l5.322"></a><span id="l5.322">     if (this.mInitialized)</span>
<a href="#l5.323"></a><span id="l5.323">       return;</span>
<a href="#l5.324"></a><span id="l5.324"> </span>
<a href="#l5.325"></a><span id="l5.325">     gApplicationsPane.init();</span>
<a href="#l5.326"></a><span id="l5.326"> </span>
<a href="#l5.327"></a><span id="l5.327">     let tabbox = document.getElementById(&quot;attachmentPrefs&quot;);</span>
<a href="#l5.328"></a><span id="l5.328"> </span>
<a href="#l5.329"></a><span id="l5.329">     // If BigFiles is disabled, hide the &quot;Outgoing&quot; tab, and the tab</span>
<a href="#l5.330"></a><span id="l5.330" class="difflineat">@@ -417,80 +413,80 @@ var gApplicationsTabController = {</span>
<a href="#l5.331"></a><span id="l5.331">       // If no tab was specified, select the last used tab.</span>
<a href="#l5.332"></a><span id="l5.332">       let preference = document.getElementById(&quot;mail.preferences.applications.selectedTabIndex&quot;);</span>
<a href="#l5.333"></a><span id="l5.333">       tabbox.selectedIndex = preference.value != null ? preference.value : this.mDefaultIndex;</span>
<a href="#l5.334"></a><span id="l5.334">     }</span>
<a href="#l5.335"></a><span id="l5.335"> </span>
<a href="#l5.336"></a><span id="l5.336">     this.mInitialized = true;</span>
<a href="#l5.337"></a><span id="l5.337">   },</span>
<a href="#l5.338"></a><span id="l5.338"> </span>
<a href="#l5.339"></a><span id="l5.339" class="difflineminus">-  tabSelectionChanged: function() {</span>
<a href="#l5.340"></a><span id="l5.340" class="difflineplus">+  tabSelectionChanged() {</span>
<a href="#l5.341"></a><span id="l5.341">     if (this.mInitialized)</span>
<a href="#l5.342"></a><span id="l5.342">       document.getElementById(&quot;mail.preferences.applications.selectedTabIndex&quot;)</span>
<a href="#l5.343"></a><span id="l5.343">               .valueFromPreferences = document.getElementById(&quot;attachmentPrefs&quot;)</span>
<a href="#l5.344"></a><span id="l5.344">               .selectedIndex;</span>
<a href="#l5.345"></a><span id="l5.345">   },</span>
<a href="#l5.346"></a><span id="l5.346"> </span>
<a href="#l5.347"></a><span id="l5.347" class="difflineminus">-}</span>
<a href="#l5.348"></a><span id="l5.348" class="difflineplus">+};</span>
<a href="#l5.349"></a><span id="l5.349"> </span>
<a href="#l5.350"></a><span id="l5.350"> var gCloudFileController = {</span>
<a href="#l5.351"></a><span id="l5.351">   commands: {</span>
<a href="#l5.352"></a><span id="l5.352">     cmd_addCloudfileAccount: {</span>
<a href="#l5.353"></a><span id="l5.353" class="difflineminus">-      isEnabled: function() {</span>
<a href="#l5.354"></a><span id="l5.354" class="difflineplus">+      isEnabled() {</span>
<a href="#l5.355"></a><span id="l5.355">         return true;</span>
<a href="#l5.356"></a><span id="l5.356">       },</span>
<a href="#l5.357"></a><span id="l5.357" class="difflineminus">-      doCommand: function() {</span>
<a href="#l5.358"></a><span id="l5.358" class="difflineplus">+      doCommand() {</span>
<a href="#l5.359"></a><span id="l5.359">         gCloudFileTab.addCloudFileAccount();</span>
<a href="#l5.360"></a><span id="l5.360">       },</span>
<a href="#l5.361"></a><span id="l5.361">     },</span>
<a href="#l5.362"></a><span id="l5.362"> </span>
<a href="#l5.363"></a><span id="l5.363">     cmd_removeCloudfileAccount: {</span>
<a href="#l5.364"></a><span id="l5.364" class="difflineminus">-      isEnabled: function() {</span>
<a href="#l5.365"></a><span id="l5.365" class="difflineplus">+      isEnabled() {</span>
<a href="#l5.366"></a><span id="l5.366">         let listbox = document.getElementById(&quot;cloudFileView&quot;);</span>
<a href="#l5.367"></a><span id="l5.367">         return listbox.selectedCount &gt; 0;</span>
<a href="#l5.368"></a><span id="l5.368">       },</span>
<a href="#l5.369"></a><span id="l5.369" class="difflineminus">-      doCommand: function() {</span>
<a href="#l5.370"></a><span id="l5.370" class="difflineplus">+      doCommand() {</span>
<a href="#l5.371"></a><span id="l5.371">         gCloudFileTab.removeCloudFileAccount();</span>
<a href="#l5.372"></a><span id="l5.372">       },</span>
<a href="#l5.373"></a><span id="l5.373">     },</span>
<a href="#l5.374"></a><span id="l5.374"> </span>
<a href="#l5.375"></a><span id="l5.375">     cmd_reauthCloudfileAccount: {</span>
<a href="#l5.376"></a><span id="l5.376" class="difflineminus">-      isEnabled: function() {</span>
<a href="#l5.377"></a><span id="l5.377" class="difflineplus">+      isEnabled() {</span>
<a href="#l5.378"></a><span id="l5.378">         return true;</span>
<a href="#l5.379"></a><span id="l5.379">       },</span>
<a href="#l5.380"></a><span id="l5.380" class="difflineminus">-      doCommand: function() {</span>
<a href="#l5.381"></a><span id="l5.381" class="difflineplus">+      doCommand() {</span>
<a href="#l5.382"></a><span id="l5.382">         gCloudFileTab.authSelected();</span>
<a href="#l5.383"></a><span id="l5.383">       },</span>
<a href="#l5.384"></a><span id="l5.384">     },</span>
<a href="#l5.385"></a><span id="l5.385"> </span>
<a href="#l5.386"></a><span id="l5.386">   },</span>
<a href="#l5.387"></a><span id="l5.387"> </span>
<a href="#l5.388"></a><span id="l5.388" class="difflineminus">-  supportsCommand: function(aCommand) {</span>
<a href="#l5.389"></a><span id="l5.389" class="difflineplus">+  supportsCommand(aCommand) {</span>
<a href="#l5.390"></a><span id="l5.390">     return (aCommand in this.commands);</span>
<a href="#l5.391"></a><span id="l5.391">   },</span>
<a href="#l5.392"></a><span id="l5.392"> </span>
<a href="#l5.393"></a><span id="l5.393" class="difflineminus">-  isCommandEnabled: function(aCommand) {</span>
<a href="#l5.394"></a><span id="l5.394" class="difflineplus">+  isCommandEnabled(aCommand) {</span>
<a href="#l5.395"></a><span id="l5.395">     if (!this.supportsCommand(aCommand))</span>
<a href="#l5.396"></a><span id="l5.396">       return false;</span>
<a href="#l5.397"></a><span id="l5.397">     return this.commands[aCommand].isEnabled();</span>
<a href="#l5.398"></a><span id="l5.398">   },</span>
<a href="#l5.399"></a><span id="l5.399"> </span>
<a href="#l5.400"></a><span id="l5.400" class="difflineminus">-  doCommand: function(aCommand) {</span>
<a href="#l5.401"></a><span id="l5.401" class="difflineplus">+  doCommand(aCommand) {</span>
<a href="#l5.402"></a><span id="l5.402">     if (!this.supportsCommand(aCommand))</span>
<a href="#l5.403"></a><span id="l5.403">       return;</span>
<a href="#l5.404"></a><span id="l5.404"> </span>
<a href="#l5.405"></a><span id="l5.405">     let cmd = this.commands[aCommand];</span>
<a href="#l5.406"></a><span id="l5.406"> </span>
<a href="#l5.407"></a><span id="l5.407">     if (!cmd.isEnabled())</span>
<a href="#l5.408"></a><span id="l5.408">       return;</span>
<a href="#l5.409"></a><span id="l5.409"> </span>
<a href="#l5.410"></a><span id="l5.410">     cmd.doCommand();</span>
<a href="#l5.411"></a><span id="l5.411">   },</span>
<a href="#l5.412"></a><span id="l5.412" class="difflineminus">-  onEvent: function(event) {},</span>
<a href="#l5.413"></a><span id="l5.413" class="difflineminus">-}</span>
<a href="#l5.414"></a><span id="l5.414" class="difflineplus">+  onEvent(event) {},</span>
<a href="#l5.415"></a><span id="l5.415" class="difflineplus">+};</span>
<a href="#l5.416"></a><span id="l5.416"> </span>
<a href="#l5.417"></a><span id="l5.417"> function CommandUpdate_CloudFile() {</span>
<a href="#l5.418"></a><span id="l5.418">   goUpdateCommand(&quot;cmd_removeCloudfileAccount&quot;);</span>
<a href="#l5.419"></a><span id="l5.419">   goUpdateCommand(&quot;cmd_addCloudfileAccount&quot;);</span>
<a href="#l5.420"></a><span id="l5.420"> }</span>
<a href="#l5.421"></a><span id="l5.421"> </span>
<a href="#l5.422"></a><span id="l5.422"> var gCloudFileTab = {</span>
<a href="#l5.423"></a><span id="l5.423">   _initialized: false,</span>
<a href="#l5.424"></a><span id="l5.424" class="difflineat">@@ -504,17 +500,17 @@ var gCloudFileTab = {</span>
<a href="#l5.425"></a><span id="l5.425">   _loadingPanel: null,</span>
<a href="#l5.426"></a><span id="l5.426">   _authErrorPanel: null,</span>
<a href="#l5.427"></a><span id="l5.427"> </span>
<a href="#l5.428"></a><span id="l5.428">   get _strings() {</span>
<a href="#l5.429"></a><span id="l5.429">     return Services.strings</span>
<a href="#l5.430"></a><span id="l5.430">                    .createBundle(&quot;chrome://messenger/locale/preferences/applications.properties&quot;);</span>
<a href="#l5.431"></a><span id="l5.431">   },</span>
<a href="#l5.432"></a><span id="l5.432"> </span>
<a href="#l5.433"></a><span id="l5.433" class="difflineminus">-  init: function() {</span>
<a href="#l5.434"></a><span id="l5.434" class="difflineplus">+  init() {</span>
<a href="#l5.435"></a><span id="l5.435">     if (this._initialized)</span>
<a href="#l5.436"></a><span id="l5.436">       return;</span>
<a href="#l5.437"></a><span id="l5.437"> </span>
<a href="#l5.438"></a><span id="l5.438">     this._list = document.getElementById(&quot;cloudFileView&quot;);</span>
<a href="#l5.439"></a><span id="l5.439">     this._settingsDeck = document.getElementById(&quot;cloudFileSettingsDeck&quot;);</span>
<a href="#l5.440"></a><span id="l5.440">     this._defaultPanel = document.getElementById(&quot;cloudFileDefaultPanel&quot;);</span>
<a href="#l5.441"></a><span id="l5.441">     this._settingsPanelWrap = document.getElementById(&quot;cloudFileSettingsWrapper&quot;);</span>
<a href="#l5.442"></a><span id="l5.442">     this._loadingPanel = document.getElementById(&quot;cloudFileLoadingPanel&quot;);</span>
<a href="#l5.443"></a><span id="l5.443" class="difflineat">@@ -608,28 +604,28 @@ var gCloudFileTab = {</span>
<a href="#l5.444"></a><span id="l5.444">     }</span>
<a href="#l5.445"></a><span id="l5.445">   },</span>
<a href="#l5.446"></a><span id="l5.446"> </span>
<a href="#l5.447"></a><span id="l5.447">   requestUserInfoForItem: function CFT_requestUserInfoForItem(aItem, aWithUI) {</span>
<a href="#l5.448"></a><span id="l5.448">     let accountKey = aItem.value;</span>
<a href="#l5.449"></a><span id="l5.449">     let account = cloudFileAccounts.getAccount(accountKey);</span>
<a href="#l5.450"></a><span id="l5.450"> </span>
<a href="#l5.451"></a><span id="l5.451">     let observer = {</span>
<a href="#l5.452"></a><span id="l5.452" class="difflineminus">-      onStopRequest: function(aRequest, aContext, aStatusCode) {</span>
<a href="#l5.453"></a><span id="l5.453" class="difflineplus">+      onStopRequest(aRequest, aContext, aStatusCode) {</span>
<a href="#l5.454"></a><span id="l5.454">         gCloudFileTab._accountCache[accountKey].result = aStatusCode;</span>
<a href="#l5.455"></a><span id="l5.455">         gCloudFileTab.onUserInfoRequestDone(accountKey);</span>
<a href="#l5.456"></a><span id="l5.456">       },</span>
<a href="#l5.457"></a><span id="l5.457" class="difflineminus">-      onStartRequest: function(aRequest, aContext) {</span>
<a href="#l5.458"></a><span id="l5.458" class="difflineplus">+      onStartRequest(aRequest, aContext) {</span>
<a href="#l5.459"></a><span id="l5.459">         aItem.setAttribute(&quot;state&quot;, &quot;connecting&quot;);</span>
<a href="#l5.460"></a><span id="l5.460">       },</span>
<a href="#l5.461"></a><span id="l5.461">     };</span>
<a href="#l5.462"></a><span id="l5.462"> </span>
<a href="#l5.463"></a><span id="l5.463" class="difflineminus">-    let accountInfo = {account: account,</span>
<a href="#l5.464"></a><span id="l5.464" class="difflineplus">+    let accountInfo = {account,</span>
<a href="#l5.465"></a><span id="l5.465">                        listItem: aItem,</span>
<a href="#l5.466"></a><span id="l5.466" class="difflineminus">-                       result: Cr.NS_ERROR_NOT_AVAILABLE}</span>
<a href="#l5.467"></a><span id="l5.467" class="difflineplus">+                       result: Cr.NS_ERROR_NOT_AVAILABLE};</span>
<a href="#l5.468"></a><span id="l5.468"> </span>
<a href="#l5.469"></a><span id="l5.469">     this._accountCache[accountKey] = accountInfo;</span>
<a href="#l5.470"></a><span id="l5.470"> </span>
<a href="#l5.471"></a><span id="l5.471">     this._settingsDeck.selectedPanel = this._loadingPanel;</span>
<a href="#l5.472"></a><span id="l5.472">     account.refreshUserInfo(aWithUI, observer);</span>
<a href="#l5.473"></a><span id="l5.473">   },</span>
<a href="#l5.474"></a><span id="l5.474"> </span>
<a href="#l5.475"></a><span id="l5.475">   onUserInfoRequestDone: function CFT_onUserInfoRequestDone(aAccountKey) {</span>
<a href="#l5.476"></a><span id="l5.476" class="difflineat">@@ -681,27 +677,25 @@ var gCloudFileTab = {</span>
<a href="#l5.477"></a><span id="l5.477">     let account = this._accountCache[aAccountKey].account;</span>
<a href="#l5.478"></a><span id="l5.478">     let result = this._accountCache[aAccountKey].result;</span>
<a href="#l5.479"></a><span id="l5.479"> </span>
<a href="#l5.480"></a><span id="l5.480">     if (result == Cr.NS_ERROR_NOT_AVAILABLE)</span>
<a href="#l5.481"></a><span id="l5.481">       this._settingsDeck.selectedPanel = this._loadingPanel;</span>
<a href="#l5.482"></a><span id="l5.482">     else if (result == Cr.NS_OK) {</span>
<a href="#l5.483"></a><span id="l5.483">       this._settingsDeck.selectedPanel = this._settingsPanelWrap;</span>
<a href="#l5.484"></a><span id="l5.484">       this._showAccountManagement(account);</span>
<a href="#l5.485"></a><span id="l5.485" class="difflineminus">-    }</span>
<a href="#l5.486"></a><span id="l5.486" class="difflineminus">-    else if (result == Ci.nsIMsgCloudFileProvider.authErr) {</span>
<a href="#l5.487"></a><span id="l5.487" class="difflineplus">+    } else if (result == Ci.nsIMsgCloudFileProvider.authErr) {</span>
<a href="#l5.488"></a><span id="l5.488">       this._settingsDeck.selectedPanel = this._authErrorPanel;</span>
<a href="#l5.489"></a><span id="l5.489" class="difflineminus">-    }</span>
<a href="#l5.490"></a><span id="l5.490" class="difflineminus">-    else {</span>
<a href="#l5.491"></a><span id="l5.491" class="difflineplus">+    } else {</span>
<a href="#l5.492"></a><span id="l5.492">       Cu.reportError(&quot;Unexpected connection error.&quot;);</span>
<a href="#l5.493"></a><span id="l5.493">     }</span>
<a href="#l5.494"></a><span id="l5.494">   },</span>
<a href="#l5.495"></a><span id="l5.495"> </span>
<a href="#l5.496"></a><span id="l5.496">   _showAccountManagement: function CFT__showAccountManagement(aProvider) {</span>
<a href="#l5.497"></a><span id="l5.497" class="difflineminus">-    let iframe = document.createElement('iframe');</span>
<a href="#l5.498"></a><span id="l5.498" class="difflineplus">+    let iframe = document.createElement(&quot;iframe&quot;);</span>
<a href="#l5.499"></a><span id="l5.499"> </span>
<a href="#l5.500"></a><span id="l5.500">     iframe.setAttribute(&quot;src&quot;, aProvider.managementURL);</span>
<a href="#l5.501"></a><span id="l5.501">     iframe.setAttribute(&quot;flex&quot;, &quot;1&quot;);</span>
<a href="#l5.502"></a><span id="l5.502"> </span>
<a href="#l5.503"></a><span id="l5.503">     // If we have a past iframe, we replace it. Else append</span>
<a href="#l5.504"></a><span id="l5.504">     // to the wrapper.</span>
<a href="#l5.505"></a><span id="l5.505">     if (this._settings)</span>
<a href="#l5.506"></a><span id="l5.506">       this._settings.remove();</span>
<a href="#l5.507"></a><span id="l5.507" class="difflineat">@@ -711,17 +705,17 @@ var gCloudFileTab = {</span>
<a href="#l5.508"></a><span id="l5.508"> </span>
<a href="#l5.509"></a><span id="l5.509">     // When the iframe loads, populate it with the provider.</span>
<a href="#l5.510"></a><span id="l5.510">     this._settings.contentWindow.addEventListener(&quot;load&quot;,</span>
<a href="#l5.511"></a><span id="l5.511">       function loadProvider() {</span>
<a href="#l5.512"></a><span id="l5.512">         try {</span>
<a href="#l5.513"></a><span id="l5.513">           iframe.contentWindow</span>
<a href="#l5.514"></a><span id="l5.514">                 .wrappedJSObject</span>
<a href="#l5.515"></a><span id="l5.515">                 .onLoadProvider(aProvider);</span>
<a href="#l5.516"></a><span id="l5.516" class="difflineminus">-        } catch(e) {</span>
<a href="#l5.517"></a><span id="l5.517" class="difflineplus">+        } catch (e) {</span>
<a href="#l5.518"></a><span id="l5.518">           Cu.reportError(e);</span>
<a href="#l5.519"></a><span id="l5.519">         }</span>
<a href="#l5.520"></a><span id="l5.520">       }, {capture: false, once: true});</span>
<a href="#l5.521"></a><span id="l5.521"> </span>
<a href="#l5.522"></a><span id="l5.522">     // When the iframe (or any subcontent) fires the DOMContentLoaded event,</span>
<a href="#l5.523"></a><span id="l5.523">     // attach the _onClickLink handler to any anchor elements that we can find.</span>
<a href="#l5.524"></a><span id="l5.524">     this._settings.contentWindow.addEventListener(&quot;DOMContentLoaded&quot;,</span>
<a href="#l5.525"></a><span id="l5.525">       function addClickListeners(e) {</span>
<a href="#l5.526"></a><span id="l5.526" class="difflineat">@@ -802,20 +796,20 @@ var gCloudFileTab = {</span>
<a href="#l5.527"></a><span id="l5.527">   },</span>
<a href="#l5.528"></a><span id="l5.528"> </span>
<a href="#l5.529"></a><span id="l5.529">   updateThreshold: function CFT_updateThreshold() {</span>
<a href="#l5.530"></a><span id="l5.530">     document.getElementById(&quot;cloudFileThreshold&quot;).disabled =</span>
<a href="#l5.531"></a><span id="l5.531">     !document.getElementById(&quot;enableThreshold&quot;).checked;</span>
<a href="#l5.532"></a><span id="l5.532">   },</span>
<a href="#l5.533"></a><span id="l5.533"> </span>
<a href="#l5.534"></a><span id="l5.534">   QueryInterface: ChromeUtils.generateQI([&quot;nsIObserver&quot;,</span>
<a href="#l5.535"></a><span id="l5.535" class="difflineminus">-                                          &quot;nsISupportsWeakReference&quot;])</span>
<a href="#l5.536"></a><span id="l5.536" class="difflineminus">-}</span>
<a href="#l5.537"></a><span id="l5.537" class="difflineplus">+                                          &quot;nsISupportsWeakReference&quot;]),</span>
<a href="#l5.538"></a><span id="l5.538" class="difflineplus">+};</span>
<a href="#l5.539"></a><span id="l5.539"> </span>
<a href="#l5.540"></a><span id="l5.540" class="difflineminus">-//****************************************************************************//</span>
<a href="#l5.541"></a><span id="l5.541" class="difflineplus">+//* ***************************************************************************//</span>
<a href="#l5.542"></a><span id="l5.542"> // Prefpane Controller</span>
<a href="#l5.543"></a><span id="l5.543"> </span>
<a href="#l5.544"></a><span id="l5.544"> var gApplicationsPane = {</span>
<a href="#l5.545"></a><span id="l5.545">   // The set of types the app knows how to handle.  A hash of HandlerInfoWrapper</span>
<a href="#l5.546"></a><span id="l5.546">   // objects, indexed by type.</span>
<a href="#l5.547"></a><span id="l5.547">   _handledTypes: {},</span>
<a href="#l5.548"></a><span id="l5.548"> </span>
<a href="#l5.549"></a><span id="l5.549">   // The list of types we can show, sorted by the sort column/direction.</span>
<a href="#l5.550"></a><span id="l5.550" class="difflineat">@@ -829,38 +823,38 @@ var gApplicationsPane = {</span>
<a href="#l5.551"></a><span id="l5.551"> </span>
<a href="#l5.552"></a><span id="l5.552">   // A count of the number of times each visible type description appears.</span>
<a href="#l5.553"></a><span id="l5.553">   // We use these counts to determine whether or not to annotate descriptions</span>
<a href="#l5.554"></a><span id="l5.554">   // with their types to distinguish duplicate descriptions from each other.</span>
<a href="#l5.555"></a><span id="l5.555">   // A hash of integer counts, indexed by string description.</span>
<a href="#l5.556"></a><span id="l5.556">   _visibleTypeDescriptionCount: new Map(),</span>
<a href="#l5.557"></a><span id="l5.557"> </span>
<a href="#l5.558"></a><span id="l5.558"> </span>
<a href="#l5.559"></a><span id="l5.559" class="difflineminus">-  //**************************************************************************//</span>
<a href="#l5.560"></a><span id="l5.560" class="difflineplus">+  //* *************************************************************************//</span>
<a href="#l5.561"></a><span id="l5.561">   // Convenience &amp; Performance Shortcuts</span>
<a href="#l5.562"></a><span id="l5.562"> </span>
<a href="#l5.563"></a><span id="l5.563">   // These get defined by init().</span>
<a href="#l5.564"></a><span id="l5.564" class="difflineminus">-  _brandShortName : null,</span>
<a href="#l5.565"></a><span id="l5.565" class="difflineminus">-  _prefsBundle    : null,</span>
<a href="#l5.566"></a><span id="l5.566" class="difflineminus">-  _list           : null,</span>
<a href="#l5.567"></a><span id="l5.567" class="difflineminus">-  _filter         : null,</span>
<a href="#l5.568"></a><span id="l5.568" class="difflineplus">+  _brandShortName: null,</span>
<a href="#l5.569"></a><span id="l5.569" class="difflineplus">+  _prefsBundle: null,</span>
<a href="#l5.570"></a><span id="l5.570" class="difflineplus">+  _list: null,</span>
<a href="#l5.571"></a><span id="l5.571" class="difflineplus">+  _filter: null,</span>
<a href="#l5.572"></a><span id="l5.572"> </span>
<a href="#l5.573"></a><span id="l5.573" class="difflineminus">-  _mimeSvc      : Cc[&quot;@mozilla.org/mime;1&quot;]</span>
<a href="#l5.574"></a><span id="l5.574" class="difflineplus">+  _mimeSvc: Cc[&quot;@mozilla.org/mime;1&quot;]</span>
<a href="#l5.575"></a><span id="l5.575">                     .getService(Ci.nsIMIMEService),</span>
<a href="#l5.576"></a><span id="l5.576"> </span>
<a href="#l5.577"></a><span id="l5.577" class="difflineminus">-  _helperAppSvc : Cc[&quot;@mozilla.org/uriloader/external-helper-app-service;1&quot;]</span>
<a href="#l5.578"></a><span id="l5.578" class="difflineplus">+  _helperAppSvc: Cc[&quot;@mozilla.org/uriloader/external-helper-app-service;1&quot;]</span>
<a href="#l5.579"></a><span id="l5.579">                     .getService(Ci.nsIExternalHelperAppService),</span>
<a href="#l5.580"></a><span id="l5.580"> </span>
<a href="#l5.581"></a><span id="l5.581" class="difflineminus">-  _handlerSvc   : Cc[&quot;@mozilla.org/uriloader/handler-service;1&quot;]</span>
<a href="#l5.582"></a><span id="l5.582" class="difflineplus">+  _handlerSvc: Cc[&quot;@mozilla.org/uriloader/handler-service;1&quot;]</span>
<a href="#l5.583"></a><span id="l5.583">                     .getService(Ci.nsIHandlerService),</span>
<a href="#l5.584"></a><span id="l5.584"> </span>
<a href="#l5.585"></a><span id="l5.585" class="difflineminus">-  //**************************************************************************//</span>
<a href="#l5.586"></a><span id="l5.586" class="difflineplus">+  //* *************************************************************************//</span>
<a href="#l5.587"></a><span id="l5.587">   // Initialization &amp; Destruction</span>
<a href="#l5.588"></a><span id="l5.588"> </span>
<a href="#l5.589"></a><span id="l5.589" class="difflineminus">-  init: function() {</span>
<a href="#l5.590"></a><span id="l5.590" class="difflineplus">+  init() {</span>
<a href="#l5.591"></a><span id="l5.591">     // Initialize shortcuts to some commonly accessed elements &amp; values.</span>
<a href="#l5.592"></a><span id="l5.592">     this._brandShortName =</span>
<a href="#l5.593"></a><span id="l5.593">       document.getElementById(&quot;bundleBrand&quot;).getString(&quot;brandShortName&quot;);</span>
<a href="#l5.594"></a><span id="l5.594">     this._prefsBundle = document.getElementById(&quot;bundlePreferences&quot;);</span>
<a href="#l5.595"></a><span id="l5.595">     this._list = document.getElementById(&quot;handlersView&quot;);</span>
<a href="#l5.596"></a><span id="l5.596">     this._filter = document.getElementById(&quot;filter&quot;);</span>
<a href="#l5.597"></a><span id="l5.597"> </span>
<a href="#l5.598"></a><span id="l5.598">     // Observe preferences that influence what we display so we can rebuild</span>
<a href="#l5.599"></a><span id="l5.599" class="difflineat">@@ -869,17 +863,17 @@ var gApplicationsPane = {</span>
<a href="#l5.600"></a><span id="l5.600">     Services.prefs.addObserver(PREF_HIDE_PLUGINS_WITHOUT_EXTENSIONS, this);</span>
<a href="#l5.601"></a><span id="l5.601"> </span>
<a href="#l5.602"></a><span id="l5.602">     // Listen for window unload so we can remove our preference observers.</span>
<a href="#l5.603"></a><span id="l5.603">     window.addEventListener(&quot;unload&quot;, this, {capture: false, once: true});</span>
<a href="#l5.604"></a><span id="l5.604"> </span>
<a href="#l5.605"></a><span id="l5.605">     // Figure out how we should be sorting the list.  We persist sort settings</span>
<a href="#l5.606"></a><span id="l5.606">     // across sessions, so we can't assume the default sort column/direction.</span>
<a href="#l5.607"></a><span id="l5.607">     // XXX should we be using the XUL sort service instead?</span>
<a href="#l5.608"></a><span id="l5.608" class="difflineminus">-    this._sortColumn = document.getElementById(&quot;typeColumn&quot;)</span>
<a href="#l5.609"></a><span id="l5.609" class="difflineplus">+    this._sortColumn = document.getElementById(&quot;typeColumn&quot;);</span>
<a href="#l5.610"></a><span id="l5.610">     if (document.getElementById(&quot;actionColumn&quot;).hasAttribute(&quot;sortDirection&quot;)) {</span>
<a href="#l5.611"></a><span id="l5.611">       this._sortColumn = document.getElementById(&quot;actionColumn&quot;);</span>
<a href="#l5.612"></a><span id="l5.612">       // The typeColumn element always has a sortDirection attribute,</span>
<a href="#l5.613"></a><span id="l5.613">       // either because it was persisted or because the default value</span>
<a href="#l5.614"></a><span id="l5.614">       // from the xul file was used.  If we are sorting on the other</span>
<a href="#l5.615"></a><span id="l5.615">       // column, we should remove it.</span>
<a href="#l5.616"></a><span id="l5.616">       document.getElementById(&quot;typeColumn&quot;).removeAttribute(&quot;sortDirection&quot;);</span>
<a href="#l5.617"></a><span id="l5.617">     }</span>
<a href="#l5.618"></a><span id="l5.618" class="difflineat">@@ -893,35 +887,35 @@ var gApplicationsPane = {</span>
<a href="#l5.619"></a><span id="l5.619">     var _delayedPaneLoad = function(self) {</span>
<a href="#l5.620"></a><span id="l5.620">       self._loadData();</span>
<a href="#l5.621"></a><span id="l5.621">       self._rebuildVisibleTypes();</span>
<a href="#l5.622"></a><span id="l5.622">       self._sortVisibleTypes();</span>
<a href="#l5.623"></a><span id="l5.623">       self.rebuildView();</span>
<a href="#l5.624"></a><span id="l5.624"> </span>
<a href="#l5.625"></a><span id="l5.625">       // Notify observers that the UI is now ready</span>
<a href="#l5.626"></a><span id="l5.626">       Services.obs.notifyObservers(window, &quot;app-handler-pane-loaded&quot;);</span>
<a href="#l5.627"></a><span id="l5.627" class="difflineminus">-    }</span>
<a href="#l5.628"></a><span id="l5.628" class="difflineplus">+    };</span>
<a href="#l5.629"></a><span id="l5.629">     setTimeout(_delayedPaneLoad, 0, this);</span>
<a href="#l5.630"></a><span id="l5.630">   },</span>
<a href="#l5.631"></a><span id="l5.631"> </span>
<a href="#l5.632"></a><span id="l5.632" class="difflineminus">-  destroy: function() {</span>
<a href="#l5.633"></a><span id="l5.633" class="difflineplus">+  destroy() {</span>
<a href="#l5.634"></a><span id="l5.634">     Services.prefs.removeObserver(PREF_SHOW_PLUGINS_IN_LIST, this);</span>
<a href="#l5.635"></a><span id="l5.635">     Services.prefs.removeObserver(PREF_HIDE_PLUGINS_WITHOUT_EXTENSIONS, this);</span>
<a href="#l5.636"></a><span id="l5.636">   },</span>
<a href="#l5.637"></a><span id="l5.637"> </span>
<a href="#l5.638"></a><span id="l5.638"> </span>
<a href="#l5.639"></a><span id="l5.639" class="difflineminus">-  //**************************************************************************//</span>
<a href="#l5.640"></a><span id="l5.640" class="difflineplus">+  //* *************************************************************************//</span>
<a href="#l5.641"></a><span id="l5.641">   // nsISupports</span>
<a href="#l5.642"></a><span id="l5.642"> </span>
<a href="#l5.643"></a><span id="l5.643">   QueryInterface: ChromeUtils.generateQI([&quot;nsIObserver&quot;]),</span>
<a href="#l5.644"></a><span id="l5.644"> </span>
<a href="#l5.645"></a><span id="l5.645" class="difflineminus">-  //**************************************************************************//</span>
<a href="#l5.646"></a><span id="l5.646" class="difflineplus">+  //* *************************************************************************//</span>
<a href="#l5.647"></a><span id="l5.647">   // nsIObserver</span>
<a href="#l5.648"></a><span id="l5.648"> </span>
<a href="#l5.649"></a><span id="l5.649" class="difflineminus">-  observe: function (aSubject, aTopic, aData) {</span>
<a href="#l5.650"></a><span id="l5.650" class="difflineplus">+  observe(aSubject, aTopic, aData) {</span>
<a href="#l5.651"></a><span id="l5.651">     // Rebuild the list when there are changes to preferences that influence</span>
<a href="#l5.652"></a><span id="l5.652">     // whether or not to show certain entries in the list.</span>
<a href="#l5.653"></a><span id="l5.653">     if (aTopic == &quot;nsPref:changed&quot; &amp;&amp; !this._storingAction) {</span>
<a href="#l5.654"></a><span id="l5.654">       // These two prefs alter the list of visible types, so we have to rebuild</span>
<a href="#l5.655"></a><span id="l5.655">       // that list when they change.</span>
<a href="#l5.656"></a><span id="l5.656">       if (aData == PREF_SHOW_PLUGINS_IN_LIST ||</span>
<a href="#l5.657"></a><span id="l5.657">           aData == PREF_HIDE_PLUGINS_WITHOUT_EXTENSIONS) {</span>
<a href="#l5.658"></a><span id="l5.658">         this._rebuildVisibleTypes();</span>
<a href="#l5.659"></a><span id="l5.659" class="difflineat">@@ -930,29 +924,29 @@ var gApplicationsPane = {</span>
<a href="#l5.660"></a><span id="l5.660"> </span>
<a href="#l5.661"></a><span id="l5.661">       // All the prefs we observe can affect what we display, so we rebuild</span>
<a href="#l5.662"></a><span id="l5.662">       // the view when any of them changes.</span>
<a href="#l5.663"></a><span id="l5.663">       this.rebuildView();</span>
<a href="#l5.664"></a><span id="l5.664">     }</span>
<a href="#l5.665"></a><span id="l5.665">   },</span>
<a href="#l5.666"></a><span id="l5.666"> </span>
<a href="#l5.667"></a><span id="l5.667"> </span>
<a href="#l5.668"></a><span id="l5.668" class="difflineminus">-  //**************************************************************************//</span>
<a href="#l5.669"></a><span id="l5.669" class="difflineplus">+  //* *************************************************************************//</span>
<a href="#l5.670"></a><span id="l5.670">   // EventListener</span>
<a href="#l5.671"></a><span id="l5.671"> </span>
<a href="#l5.672"></a><span id="l5.672" class="difflineminus">-  handleEvent: function(aEvent) {</span>
<a href="#l5.673"></a><span id="l5.673" class="difflineplus">+  handleEvent(aEvent) {</span>
<a href="#l5.674"></a><span id="l5.674">     if (aEvent.type == &quot;unload&quot;)</span>
<a href="#l5.675"></a><span id="l5.675">       this.destroy();</span>
<a href="#l5.676"></a><span id="l5.676">   },</span>
<a href="#l5.677"></a><span id="l5.677"> </span>
<a href="#l5.678"></a><span id="l5.678"> </span>
<a href="#l5.679"></a><span id="l5.679" class="difflineminus">-  //**************************************************************************//</span>
<a href="#l5.680"></a><span id="l5.680" class="difflineplus">+  //* *************************************************************************//</span>
<a href="#l5.681"></a><span id="l5.681">   // Composed Model Construction</span>
<a href="#l5.682"></a><span id="l5.682"> </span>
<a href="#l5.683"></a><span id="l5.683" class="difflineminus">-  _loadData: function() {</span>
<a href="#l5.684"></a><span id="l5.684" class="difflineplus">+  _loadData() {</span>
<a href="#l5.685"></a><span id="l5.685">     this._loadPluginHandlers();</span>
<a href="#l5.686"></a><span id="l5.686">     this._loadApplicationHandlers();</span>
<a href="#l5.687"></a><span id="l5.687">   },</span>
<a href="#l5.688"></a><span id="l5.688"> </span>
<a href="#l5.689"></a><span id="l5.689">   /**</span>
<a href="#l5.690"></a><span id="l5.690">    * Load the set of handlers defined by plugins.</span>
<a href="#l5.691"></a><span id="l5.691">    *</span>
<a href="#l5.692"></a><span id="l5.692">    * Note: if there's more than one plugin for a given MIME type, we assume</span>
<a href="#l5.693"></a><span id="l5.693" class="difflineat">@@ -967,17 +961,17 @@ var gApplicationsPane = {</span>
<a href="#l5.694"></a><span id="l5.694">    *</span>
<a href="#l5.695"></a><span id="l5.695">    * I'll also note that my reading of nsPluginTag::RegisterWithCategoryManager</span>
<a href="#l5.696"></a><span id="l5.696">    * suggests that enabledPlugin is only determined during registration</span>
<a href="#l5.697"></a><span id="l5.697">    * and does not get updated when plugin.disable_full_page_plugin_for_types</span>
<a href="#l5.698"></a><span id="l5.698">    * changes (unless modification of that preference spawns reregistration).</span>
<a href="#l5.699"></a><span id="l5.699">    * So even if we could use enabledPlugin to get the plugin that would be used,</span>
<a href="#l5.700"></a><span id="l5.700">    * we'd still need to check the pref ourselves to find out if it's enabled.</span>
<a href="#l5.701"></a><span id="l5.701">    */</span>
<a href="#l5.702"></a><span id="l5.702" class="difflineminus">-  _loadPluginHandlers: function() {</span>
<a href="#l5.703"></a><span id="l5.703" class="difflineplus">+  _loadPluginHandlers() {</span>
<a href="#l5.704"></a><span id="l5.704">     for (let i = 0; i &lt; navigator.plugins.length; ++i) {</span>
<a href="#l5.705"></a><span id="l5.705">       let plugin = navigator.plugins[i];</span>
<a href="#l5.706"></a><span id="l5.706">       for (let j = 0; j &lt; plugin.length; ++j) {</span>
<a href="#l5.707"></a><span id="l5.707">         let type = plugin[j].type;</span>
<a href="#l5.708"></a><span id="l5.708"> </span>
<a href="#l5.709"></a><span id="l5.709">         let handlerInfoWrapper;</span>
<a href="#l5.710"></a><span id="l5.710">         if (type in this._handledTypes)</span>
<a href="#l5.711"></a><span id="l5.711">           handlerInfoWrapper = this._handledTypes[type];</span>
<a href="#l5.712"></a><span id="l5.712" class="difflineat">@@ -992,40 +986,39 @@ var gApplicationsPane = {</span>
<a href="#l5.713"></a><span id="l5.713">         handlerInfoWrapper.plugin = plugin;</span>
<a href="#l5.714"></a><span id="l5.714">       }</span>
<a href="#l5.715"></a><span id="l5.715">     }</span>
<a href="#l5.716"></a><span id="l5.716">   },</span>
<a href="#l5.717"></a><span id="l5.717"> </span>
<a href="#l5.718"></a><span id="l5.718">   /**</span>
<a href="#l5.719"></a><span id="l5.719">    * Load the set of handlers defined by the application datastore.</span>
<a href="#l5.720"></a><span id="l5.720">    */</span>
<a href="#l5.721"></a><span id="l5.721" class="difflineminus">-  _loadApplicationHandlers: function() {</span>
<a href="#l5.722"></a><span id="l5.722" class="difflineplus">+  _loadApplicationHandlers() {</span>
<a href="#l5.723"></a><span id="l5.723">     var wrappedHandlerInfos = this._handlerSvc.enumerate();</span>
<a href="#l5.724"></a><span id="l5.724">     while (wrappedHandlerInfos.hasMoreElements()) {</span>
<a href="#l5.725"></a><span id="l5.725">       let wrappedHandlerInfo =</span>
<a href="#l5.726"></a><span id="l5.726">         wrappedHandlerInfos.getNext().QueryInterface(Ci.nsIHandlerInfo);</span>
<a href="#l5.727"></a><span id="l5.727">       let type = wrappedHandlerInfo.type;</span>
<a href="#l5.728"></a><span id="l5.728"> </span>
<a href="#l5.729"></a><span id="l5.729">       let handlerInfoWrapper;</span>
<a href="#l5.730"></a><span id="l5.730">       if (type in this._handledTypes) {</span>
<a href="#l5.731"></a><span id="l5.731">         handlerInfoWrapper = this._handledTypes[type];</span>
<a href="#l5.732"></a><span id="l5.732" class="difflineminus">-      }</span>
<a href="#l5.733"></a><span id="l5.733" class="difflineminus">-      else {</span>
<a href="#l5.734"></a><span id="l5.734" class="difflineplus">+      } else {</span>
<a href="#l5.735"></a><span id="l5.735">         handlerInfoWrapper = new HandlerInfoWrapper(type, wrappedHandlerInfo);</span>
<a href="#l5.736"></a><span id="l5.736">         this._handledTypes[type] = handlerInfoWrapper;</span>
<a href="#l5.737"></a><span id="l5.737">       }</span>
<a href="#l5.738"></a><span id="l5.738"> </span>
<a href="#l5.739"></a><span id="l5.739">       handlerInfoWrapper.handledOnlyByPlugin = false;</span>
<a href="#l5.740"></a><span id="l5.740">     }</span>
<a href="#l5.741"></a><span id="l5.741">   },</span>
<a href="#l5.742"></a><span id="l5.742"> </span>
<a href="#l5.743"></a><span id="l5.743" class="difflineminus">-  //**************************************************************************//</span>
<a href="#l5.744"></a><span id="l5.744" class="difflineplus">+  //* *************************************************************************//</span>
<a href="#l5.745"></a><span id="l5.745">   // View Construction</span>
<a href="#l5.746"></a><span id="l5.746"> </span>
<a href="#l5.747"></a><span id="l5.747" class="difflineminus">-  _rebuildVisibleTypes: function() {</span>
<a href="#l5.748"></a><span id="l5.748" class="difflineplus">+  _rebuildVisibleTypes() {</span>
<a href="#l5.749"></a><span id="l5.749">     // Reset the list of visible types and the visible type description counts.</span>
<a href="#l5.750"></a><span id="l5.750">     this._visibleTypes.length = 0;</span>
<a href="#l5.751"></a><span id="l5.751">     this._visibleTypeDescriptionCount.clear();</span>
<a href="#l5.752"></a><span id="l5.752"> </span>
<a href="#l5.753"></a><span id="l5.753">     // Get the preferences that help determine what types to show.</span>
<a href="#l5.754"></a><span id="l5.754">     var showPlugins = Services.prefs.getBoolPref(PREF_SHOW_PLUGINS_IN_LIST);</span>
<a href="#l5.755"></a><span id="l5.755">     var hidePluginsWithoutExtensions =</span>
<a href="#l5.756"></a><span id="l5.756">       Services.prefs.getBoolPref(PREF_HIDE_PLUGINS_WITHOUT_EXTENSIONS);</span>
<a href="#l5.757"></a><span id="l5.757" class="difflineat">@@ -1053,17 +1046,17 @@ var gApplicationsPane = {</span>
<a href="#l5.758"></a><span id="l5.758">       this._visibleTypes.push(handlerInfo);</span>
<a href="#l5.759"></a><span id="l5.759"> </span>
<a href="#l5.760"></a><span id="l5.760">       let descCount = this._visibleTypeDescriptionCount.has(handlerInfo.description) ?</span>
<a href="#l5.761"></a><span id="l5.761">         (this._visibleTypeDescriptionCount.get(handlerInfo.description) + 1) : 1;</span>
<a href="#l5.762"></a><span id="l5.762">       this._visibleTypeDescriptionCount.set(handlerInfo.description, descCount);</span>
<a href="#l5.763"></a><span id="l5.763">     }</span>
<a href="#l5.764"></a><span id="l5.764">   },</span>
<a href="#l5.765"></a><span id="l5.765"> </span>
<a href="#l5.766"></a><span id="l5.766" class="difflineminus">-  rebuildView: function() {</span>
<a href="#l5.767"></a><span id="l5.767" class="difflineplus">+  rebuildView() {</span>
<a href="#l5.768"></a><span id="l5.768">     // Clear the list of entries.</span>
<a href="#l5.769"></a><span id="l5.769">     while (this._list.childNodes.length &gt; 1)</span>
<a href="#l5.770"></a><span id="l5.770">       this._list.lastChild.remove();</span>
<a href="#l5.771"></a><span id="l5.771">     var visibleTypes = this._visibleTypes;</span>
<a href="#l5.772"></a><span id="l5.772"> </span>
<a href="#l5.773"></a><span id="l5.773">     // If the user is filtering the list, then only show matching types.</span>
<a href="#l5.774"></a><span id="l5.774">     if (this._filter.value)</span>
<a href="#l5.775"></a><span id="l5.775">       visibleTypes = visibleTypes.filter(this._matchesFilter, this);</span>
<a href="#l5.776"></a><span id="l5.776" class="difflineat">@@ -1085,55 +1078,55 @@ var gApplicationsPane = {</span>
<a href="#l5.777"></a><span id="l5.777">       }</span>
<a href="#l5.778"></a><span id="l5.778"> </span>
<a href="#l5.779"></a><span id="l5.779">       this._list.appendChild(item);</span>
<a href="#l5.780"></a><span id="l5.780">     }</span>
<a href="#l5.781"></a><span id="l5.781"> </span>
<a href="#l5.782"></a><span id="l5.782">     this._selectLastSelectedType();</span>
<a href="#l5.783"></a><span id="l5.783">   },</span>
<a href="#l5.784"></a><span id="l5.784"> </span>
<a href="#l5.785"></a><span id="l5.785" class="difflineminus">-  _matchesFilter: function(aType) {</span>
<a href="#l5.786"></a><span id="l5.786" class="difflineplus">+  _matchesFilter(aType) {</span>
<a href="#l5.787"></a><span id="l5.787">     var filterValue = this._filter.value.toLowerCase();</span>
<a href="#l5.788"></a><span id="l5.788">     return this._describeType(aType).toLowerCase().includes(filterValue) ||</span>
<a href="#l5.789"></a><span id="l5.789">            this._describePreferredAction(aType).toLowerCase().includes(filterValue);</span>
<a href="#l5.790"></a><span id="l5.790">   },</span>
<a href="#l5.791"></a><span id="l5.791"> </span>
<a href="#l5.792"></a><span id="l5.792">   /**</span>
<a href="#l5.793"></a><span id="l5.793">    * Describe, in a human-readable fashion, the type represented by the given</span>
<a href="#l5.794"></a><span id="l5.794">    * handler info object.  Normally this is just the description provided by</span>
<a href="#l5.795"></a><span id="l5.795">    * the info object, but if more than one object presents the same description,</span>
<a href="#l5.796"></a><span id="l5.796">    * then we annotate the duplicate descriptions with the type itself to help</span>
<a href="#l5.797"></a><span id="l5.797">    * users distinguish between those types.</span>
<a href="#l5.798"></a><span id="l5.798">    *</span>
<a href="#l5.799"></a><span id="l5.799">    * @param aHandlerInfo {nsIHandlerInfo} the type being described</span>
<a href="#l5.800"></a><span id="l5.800">    * @return {string} a description of the type</span>
<a href="#l5.801"></a><span id="l5.801">    */</span>
<a href="#l5.802"></a><span id="l5.802" class="difflineminus">-  _describeType: function(aHandlerInfo) {</span>
<a href="#l5.803"></a><span id="l5.803" class="difflineplus">+  _describeType(aHandlerInfo) {</span>
<a href="#l5.804"></a><span id="l5.804">     let details = this._typeDetails(aHandlerInfo);</span>
<a href="#l5.805"></a><span id="l5.805"> </span>
<a href="#l5.806"></a><span id="l5.806">     if (details)</span>
<a href="#l5.807"></a><span id="l5.807">       return this._prefsBundle.getFormattedString(&quot;typeDescriptionWithDetails&quot;,</span>
<a href="#l5.808"></a><span id="l5.808">                                                   [aHandlerInfo.description,</span>
<a href="#l5.809"></a><span id="l5.809">                                                    details]);</span>
<a href="#l5.810"></a><span id="l5.810">     return aHandlerInfo.description;</span>
<a href="#l5.811"></a><span id="l5.811">   },</span>
<a href="#l5.812"></a><span id="l5.812"> </span>
<a href="#l5.813"></a><span id="l5.813">   /**</span>
<a href="#l5.814"></a><span id="l5.814">    * Get the details for the type represented by the given handler info</span>
<a href="#l5.815"></a><span id="l5.815">    * object.</span>
<a href="#l5.816"></a><span id="l5.816">    *</span>
<a href="#l5.817"></a><span id="l5.817">    * @param aHandlerInfo {nsIHandlerInfo} the type to get the extensions for.</span>
<a href="#l5.818"></a><span id="l5.818">    * @return {string} the extensions for the type</span>
<a href="#l5.819"></a><span id="l5.819">    */</span>
<a href="#l5.820"></a><span id="l5.820" class="difflineminus">-  _typeDetails: function(aHandlerInfo) {</span>
<a href="#l5.821"></a><span id="l5.821" class="difflineplus">+  _typeDetails(aHandlerInfo) {</span>
<a href="#l5.822"></a><span id="l5.822">     let exts = [];</span>
<a href="#l5.823"></a><span id="l5.823">     if (aHandlerInfo.wrappedHandlerInfo instanceof Ci.nsIMIMEInfo) {</span>
<a href="#l5.824"></a><span id="l5.824">       let extIter = aHandlerInfo.wrappedHandlerInfo.getFileExtensions();</span>
<a href="#l5.825"></a><span id="l5.825" class="difflineminus">-      while(extIter.hasMore()) {</span>
<a href="#l5.826"></a><span id="l5.826" class="difflineminus">-        let ext = &quot;.&quot;+extIter.getNext();</span>
<a href="#l5.827"></a><span id="l5.827" class="difflineplus">+      while (extIter.hasMore()) {</span>
<a href="#l5.828"></a><span id="l5.828" class="difflineplus">+        let ext = &quot;.&quot; + extIter.getNext();</span>
<a href="#l5.829"></a><span id="l5.829">         if (!exts.includes(ext))</span>
<a href="#l5.830"></a><span id="l5.830">           exts.push(ext);</span>
<a href="#l5.831"></a><span id="l5.831">       }</span>
<a href="#l5.832"></a><span id="l5.832">     }</span>
<a href="#l5.833"></a><span id="l5.833">     exts.sort();</span>
<a href="#l5.834"></a><span id="l5.834">     exts = exts.join(&quot;, &quot;);</span>
<a href="#l5.835"></a><span id="l5.835">     if (this._visibleTypeDescriptionCount.has(aHandlerInfo.description)) {</span>
<a href="#l5.836"></a><span id="l5.836">       if (exts)</span>
<a href="#l5.837"></a><span id="l5.837" class="difflineat">@@ -1155,17 +1148,17 @@ var gApplicationsPane = {</span>
<a href="#l5.838"></a><span id="l5.838">    * XXX Should this be part of the HandlerInfoWrapper interface?  It would</span>
<a href="#l5.839"></a><span id="l5.839">    * violate the separation of model and view, but it might make more sense</span>
<a href="#l5.840"></a><span id="l5.840">    * nonetheless (f.e. it would make sortTypes easier).</span>
<a href="#l5.841"></a><span id="l5.841">    *</span>
<a href="#l5.842"></a><span id="l5.842">    * @param aHandlerInfo {nsIHandlerInfo} the type whose preferred action</span>
<a href="#l5.843"></a><span id="l5.843">    *                                      is being described</span>
<a href="#l5.844"></a><span id="l5.844">    * @return {string} a description of the action</span>
<a href="#l5.845"></a><span id="l5.845">    */</span>
<a href="#l5.846"></a><span id="l5.846" class="difflineminus">-  _describePreferredAction: function(aHandlerInfo) {</span>
<a href="#l5.847"></a><span id="l5.847" class="difflineplus">+  _describePreferredAction(aHandlerInfo) {</span>
<a href="#l5.848"></a><span id="l5.848">     // alwaysAskBeforeHandling overrides the preferred action, so if that flag</span>
<a href="#l5.849"></a><span id="l5.849">     // is set, then describe that behavior instead.  For most types, this is</span>
<a href="#l5.850"></a><span id="l5.850">     // the &quot;alwaysAsk&quot; string, but for the feed type we show something special.</span>
<a href="#l5.851"></a><span id="l5.851">     if (aHandlerInfo.alwaysAskBeforeHandling)</span>
<a href="#l5.852"></a><span id="l5.852">         return this._prefsBundle.getString(&quot;alwaysAsk&quot;);</span>
<a href="#l5.853"></a><span id="l5.853"> </span>
<a href="#l5.854"></a><span id="l5.854">     switch (aHandlerInfo.preferredAction) {</span>
<a href="#l5.855"></a><span id="l5.855">       case Ci.nsIHandlerInfo.saveToDisk:</span>
<a href="#l5.856"></a><span id="l5.856" class="difflineat">@@ -1204,17 +1197,17 @@ var gApplicationsPane = {</span>
<a href="#l5.857"></a><span id="l5.857">                                                      this._brandShortName]);</span>
<a href="#l5.858"></a><span id="l5.858">       default:</span>
<a href="#l5.859"></a><span id="l5.859">         // Hopefully this never happens.</span>
<a href="#l5.860"></a><span id="l5.860">         Cu.reportError(&quot;No description for action &quot; + aHandlerInfo.preferredAction + &quot; found!&quot;);</span>
<a href="#l5.861"></a><span id="l5.861">         return &quot;&quot;;</span>
<a href="#l5.862"></a><span id="l5.862">     }</span>
<a href="#l5.863"></a><span id="l5.863">   },</span>
<a href="#l5.864"></a><span id="l5.864"> </span>
<a href="#l5.865"></a><span id="l5.865" class="difflineminus">-  _selectLastSelectedType: function() {</span>
<a href="#l5.866"></a><span id="l5.866" class="difflineplus">+  _selectLastSelectedType() {</span>
<a href="#l5.867"></a><span id="l5.867">     // If the list is disabled by the pref.downloads.disable_button.edit_actions</span>
<a href="#l5.868"></a><span id="l5.868">     // preference being locked, then don't select the type, as that would cause</span>
<a href="#l5.869"></a><span id="l5.869">     // it to appear selected, with a different background and an actions menu</span>
<a href="#l5.870"></a><span id="l5.870">     // that makes it seem like you can choose an action for the type.</span>
<a href="#l5.871"></a><span id="l5.871">     if (this._list.disabled)</span>
<a href="#l5.872"></a><span id="l5.872">       return;</span>
<a href="#l5.873"></a><span id="l5.873"> </span>
<a href="#l5.874"></a><span id="l5.874">     var lastSelectedType = this._list.getAttribute(&quot;lastSelectedType&quot;);</span>
<a href="#l5.875"></a><span id="l5.875" class="difflineat">@@ -1228,33 +1221,33 @@ var gApplicationsPane = {</span>
<a href="#l5.876"></a><span id="l5.876">     this._list.selectedItem = item;</span>
<a href="#l5.877"></a><span id="l5.877">   },</span>
<a href="#l5.878"></a><span id="l5.878"> </span>
<a href="#l5.879"></a><span id="l5.879">   /**</span>
<a href="#l5.880"></a><span id="l5.880">    * Whether or not the given handler app is valid.</span>
<a href="#l5.881"></a><span id="l5.881">    * @param aHandlerApp {nsIHandlerApp} the handler app in question</span>
<a href="#l5.882"></a><span id="l5.882">    * @return {boolean} whether or not it's valid</span>
<a href="#l5.883"></a><span id="l5.883">    */</span>
<a href="#l5.884"></a><span id="l5.884" class="difflineminus">-  isValidHandlerApp: function(aHandlerApp) {</span>
<a href="#l5.885"></a><span id="l5.885" class="difflineplus">+  isValidHandlerApp(aHandlerApp) {</span>
<a href="#l5.886"></a><span id="l5.886">     if (!aHandlerApp)</span>
<a href="#l5.887"></a><span id="l5.887">       return false;</span>
<a href="#l5.888"></a><span id="l5.888"> </span>
<a href="#l5.889"></a><span id="l5.889">     if (aHandlerApp instanceof Ci.nsILocalHandlerApp)</span>
<a href="#l5.890"></a><span id="l5.890">       return this._isValidHandlerExecutable(aHandlerApp.executable);</span>
<a href="#l5.891"></a><span id="l5.891"> </span>
<a href="#l5.892"></a><span id="l5.892">     if (aHandlerApp instanceof Ci.nsIWebHandlerApp)</span>
<a href="#l5.893"></a><span id="l5.893">       return aHandlerApp.uriTemplate;</span>
<a href="#l5.894"></a><span id="l5.894"> </span>
<a href="#l5.895"></a><span id="l5.895">     if (aHandlerApp instanceof Ci.nsIWebContentHandlerInfo)</span>
<a href="#l5.896"></a><span id="l5.896">       return aHandlerApp.uri;</span>
<a href="#l5.897"></a><span id="l5.897"> </span>
<a href="#l5.898"></a><span id="l5.898">     return false;</span>
<a href="#l5.899"></a><span id="l5.899">   },</span>
<a href="#l5.900"></a><span id="l5.900"> </span>
<a href="#l5.901"></a><span id="l5.901" class="difflineminus">-  _isValidHandlerExecutable: function(aExecutable) {</span>
<a href="#l5.902"></a><span id="l5.902" class="difflineplus">+  _isValidHandlerExecutable(aExecutable) {</span>
<a href="#l5.903"></a><span id="l5.903">     let isExecutable = aExecutable &amp;&amp;</span>
<a href="#l5.904"></a><span id="l5.904">                        aExecutable.exists() &amp;&amp;</span>
<a href="#l5.905"></a><span id="l5.905">                        aExecutable.isExecutable();</span>
<a href="#l5.906"></a><span id="l5.906"> // XXXben - we need to compare this with the running instance executable</span>
<a href="#l5.907"></a><span id="l5.907"> //          just don't know how to do that via script...</span>
<a href="#l5.908"></a><span id="l5.908"> // XXXmano TBD: can probably add this to nsIShellService</span>
<a href="#l5.909"></a><span id="l5.909">     if (AppConstants.platform == &quot;win&quot;)</span>
<a href="#l5.910"></a><span id="l5.910">       return isExecutable &amp;&amp; (aExecutable.leafName != (AppConstants.MOZ_APP_NAME + &quot;.exe&quot;));</span>
<a href="#l5.911"></a><span id="l5.911" class="difflineat">@@ -1264,17 +1257,17 @@ var gApplicationsPane = {</span>
<a href="#l5.912"></a><span id="l5.912"> </span>
<a href="#l5.913"></a><span id="l5.913">     return isExecutable &amp;&amp; (aExecutable.leafName != (AppConstants.MOZ_APP_NAME + &quot;-bin&quot;));</span>
<a href="#l5.914"></a><span id="l5.914">   },</span>
<a href="#l5.915"></a><span id="l5.915"> </span>
<a href="#l5.916"></a><span id="l5.916">   /**</span>
<a href="#l5.917"></a><span id="l5.917">    * Rebuild the actions menu for the selected entry.  Gets called by</span>
<a href="#l5.918"></a><span id="l5.918">    * the richlistitem constructor when an entry in the list gets selected.</span>
<a href="#l5.919"></a><span id="l5.919">    */</span>
<a href="#l5.920"></a><span id="l5.920" class="difflineminus">-  rebuildActionsMenu: function() {</span>
<a href="#l5.921"></a><span id="l5.921" class="difflineplus">+  rebuildActionsMenu() {</span>
<a href="#l5.922"></a><span id="l5.922">     var typeItem = this._list.selectedItem;</span>
<a href="#l5.923"></a><span id="l5.923"> </span>
<a href="#l5.924"></a><span id="l5.924">     if (!typeItem)</span>
<a href="#l5.925"></a><span id="l5.925">       return;</span>
<a href="#l5.926"></a><span id="l5.926"> </span>
<a href="#l5.927"></a><span id="l5.927">     var handlerInfo = this._handledTypes[typeItem.type];</span>
<a href="#l5.928"></a><span id="l5.928">     var menu =</span>
<a href="#l5.929"></a><span id="l5.929">       document.getAnonymousElementByAttribute(typeItem, &quot;class&quot;, &quot;actionsMenu&quot;);</span>
<a href="#l5.930"></a><span id="l5.930" class="difflineat">@@ -1374,18 +1367,17 @@ var gApplicationsPane = {</span>
<a href="#l5.931"></a><span id="l5.931">       // would be meaningless so we special case executables.</span>
<a href="#l5.932"></a><span id="l5.932">       var executableType = Cc[&quot;@mozilla.org/mime;1&quot;]</span>
<a href="#l5.933"></a><span id="l5.933">                              .getService(Ci.nsIMIMEService)</span>
<a href="#l5.934"></a><span id="l5.934">                              .getTypeFromExtension(&quot;exe&quot;);</span>
<a href="#l5.935"></a><span id="l5.935">       if (handlerInfo.type == executableType)</span>
<a href="#l5.936"></a><span id="l5.936">         createItem = false;</span>
<a href="#l5.937"></a><span id="l5.937">     }</span>
<a href="#l5.938"></a><span id="l5.938"> </span>
<a href="#l5.939"></a><span id="l5.939" class="difflineminus">-    if (createItem)</span>
<a href="#l5.940"></a><span id="l5.940" class="difflineminus">-    {</span>
<a href="#l5.941"></a><span id="l5.941" class="difflineplus">+    if (createItem) {</span>
<a href="#l5.942"></a><span id="l5.942">       let menuItem = document.createElement(&quot;menuitem&quot;);</span>
<a href="#l5.943"></a><span id="l5.943">       menuItem.setAttribute(&quot;oncommand&quot;, &quot;gApplicationsPane.chooseApp(event)&quot;);</span>
<a href="#l5.944"></a><span id="l5.944">       let label = this._prefsBundle.getString(&quot;useOtherApp&quot;);</span>
<a href="#l5.945"></a><span id="l5.945">       menuItem.setAttribute(&quot;label&quot;, label);</span>
<a href="#l5.946"></a><span id="l5.946">       menuItem.setAttribute(&quot;tooltiptext&quot;, label);</span>
<a href="#l5.947"></a><span id="l5.947">       menuPopup.appendChild(menuItem);</span>
<a href="#l5.948"></a><span id="l5.948">     }</span>
<a href="#l5.949"></a><span id="l5.949"> </span>
<a href="#l5.950"></a><span id="l5.950" class="difflineat">@@ -1433,25 +1425,25 @@ var gApplicationsPane = {</span>
<a href="#l5.951"></a><span id="l5.951">     }</span>
<a href="#l5.952"></a><span id="l5.952">     // menu.selectedItem may be null if the preferredAction is</span>
<a href="#l5.953"></a><span id="l5.953">     // useSystemDefault, but handlerInfo.hasDefaultHandler returns false.</span>
<a href="#l5.954"></a><span id="l5.954">     // For now, we'll just use the askMenuItem to avoid ugly exceptions.</span>
<a href="#l5.955"></a><span id="l5.955">     menu.previousSelectedItem = menu.selectedItem || askMenuItem;</span>
<a href="#l5.956"></a><span id="l5.956">   },</span>
<a href="#l5.957"></a><span id="l5.957"> </span>
<a href="#l5.958"></a><span id="l5.958"> </span>
<a href="#l5.959"></a><span id="l5.959" class="difflineminus">-  //**************************************************************************//</span>
<a href="#l5.960"></a><span id="l5.960" class="difflineplus">+  //* *************************************************************************//</span>
<a href="#l5.961"></a><span id="l5.961">   // Sorting &amp; Filtering</span>
<a href="#l5.962"></a><span id="l5.962"> </span>
<a href="#l5.963"></a><span id="l5.963">   _sortColumn: null,</span>
<a href="#l5.964"></a><span id="l5.964"> </span>
<a href="#l5.965"></a><span id="l5.965">   /**</span>
<a href="#l5.966"></a><span id="l5.966">    * Sort the list when the user clicks on a column header.</span>
<a href="#l5.967"></a><span id="l5.967">    */</span>
<a href="#l5.968"></a><span id="l5.968" class="difflineminus">-  sort: function (event) {</span>
<a href="#l5.969"></a><span id="l5.969" class="difflineplus">+  sort(event) {</span>
<a href="#l5.970"></a><span id="l5.970">     var column = event.target;</span>
<a href="#l5.971"></a><span id="l5.971"> </span>
<a href="#l5.972"></a><span id="l5.972">     // If the user clicked on a new sort column, remove the direction indicator</span>
<a href="#l5.973"></a><span id="l5.973">     // from the old column.</span>
<a href="#l5.974"></a><span id="l5.974">     if (this._sortColumn &amp;&amp; this._sortColumn != column)</span>
<a href="#l5.975"></a><span id="l5.975">       this._sortColumn.removeAttribute(&quot;sortDirection&quot;);</span>
<a href="#l5.976"></a><span id="l5.976"> </span>
<a href="#l5.977"></a><span id="l5.977">     this._sortColumn = column;</span>
<a href="#l5.978"></a><span id="l5.978" class="difflineat">@@ -1464,17 +1456,17 @@ var gApplicationsPane = {</span>
<a href="#l5.979"></a><span id="l5.979"> </span>
<a href="#l5.980"></a><span id="l5.980">     this._sortVisibleTypes();</span>
<a href="#l5.981"></a><span id="l5.981">     this.rebuildView();</span>
<a href="#l5.982"></a><span id="l5.982">   },</span>
<a href="#l5.983"></a><span id="l5.983"> </span>
<a href="#l5.984"></a><span id="l5.984">   /**</span>
<a href="#l5.985"></a><span id="l5.985">    * Sort the list of visible types by the current sort column/direction.</span>
<a href="#l5.986"></a><span id="l5.986">    */</span>
<a href="#l5.987"></a><span id="l5.987" class="difflineminus">-  _sortVisibleTypes: function() {</span>
<a href="#l5.988"></a><span id="l5.988" class="difflineplus">+  _sortVisibleTypes() {</span>
<a href="#l5.989"></a><span id="l5.989">     if (!this._sortColumn)</span>
<a href="#l5.990"></a><span id="l5.990">       return;</span>
<a href="#l5.991"></a><span id="l5.991"> </span>
<a href="#l5.992"></a><span id="l5.992">     var t = this;</span>
<a href="#l5.993"></a><span id="l5.993"> </span>
<a href="#l5.994"></a><span id="l5.994">     function sortByType(a, b) {</span>
<a href="#l5.995"></a><span id="l5.995">       return t._describeType(a).toLowerCase()</span>
<a href="#l5.996"></a><span id="l5.996">               .localeCompare(t._describeType(b).toLowerCase());</span>
<a href="#l5.997"></a><span id="l5.997" class="difflineat">@@ -1493,47 +1485,45 @@ var gApplicationsPane = {</span>
<a href="#l5.998"></a><span id="l5.998">         this._visibleTypes.sort(sortByAction);</span>
<a href="#l5.999"></a><span id="l5.999">         break;</span>
<a href="#l5.1000"></a><span id="l5.1000">     }</span>
<a href="#l5.1001"></a><span id="l5.1001"> </span>
<a href="#l5.1002"></a><span id="l5.1002">     if (this._sortColumn.getAttribute(&quot;sortDirection&quot;) == &quot;descending&quot;)</span>
<a href="#l5.1003"></a><span id="l5.1003">       this._visibleTypes.reverse();</span>
<a href="#l5.1004"></a><span id="l5.1004">   },</span>
<a href="#l5.1005"></a><span id="l5.1005"> </span>
<a href="#l5.1006"></a><span id="l5.1006" class="difflineminus">-  focusFilterBox: function() {</span>
<a href="#l5.1007"></a><span id="l5.1007" class="difflineplus">+  focusFilterBox() {</span>
<a href="#l5.1008"></a><span id="l5.1008">     this._filter.focus();</span>
<a href="#l5.1009"></a><span id="l5.1009">     this._filter.select();</span>
<a href="#l5.1010"></a><span id="l5.1010">   },</span>
<a href="#l5.1011"></a><span id="l5.1011"> </span>
<a href="#l5.1012"></a><span id="l5.1012" class="difflineminus">-  //**************************************************************************//</span>
<a href="#l5.1013"></a><span id="l5.1013" class="difflineplus">+  //* *************************************************************************//</span>
<a href="#l5.1014"></a><span id="l5.1014">   // Changes</span>
<a href="#l5.1015"></a><span id="l5.1015"> </span>
<a href="#l5.1016"></a><span id="l5.1016" class="difflineminus">-  onSelectAction: function(aActionItem) {</span>
<a href="#l5.1017"></a><span id="l5.1017" class="difflineplus">+  onSelectAction(aActionItem) {</span>
<a href="#l5.1018"></a><span id="l5.1018">     this._storingAction = true;</span>
<a href="#l5.1019"></a><span id="l5.1019"> </span>
<a href="#l5.1020"></a><span id="l5.1020">     let typeItem = this._list.selectedItem;</span>
<a href="#l5.1021"></a><span id="l5.1021">     let menu = document.getAnonymousElementByAttribute(typeItem, &quot;class&quot;,</span>
<a href="#l5.1022"></a><span id="l5.1022">                                                        &quot;actionsMenu&quot;);</span>
<a href="#l5.1023"></a><span id="l5.1023">     menu.previousSelectedItem = aActionItem;</span>
<a href="#l5.1024"></a><span id="l5.1024">     try {</span>
<a href="#l5.1025"></a><span id="l5.1025">       this._storeAction(aActionItem);</span>
<a href="#l5.1026"></a><span id="l5.1026" class="difflineminus">-    }</span>
<a href="#l5.1027"></a><span id="l5.1027" class="difflineminus">-    finally {</span>
<a href="#l5.1028"></a><span id="l5.1028" class="difflineplus">+    } finally {</span>
<a href="#l5.1029"></a><span id="l5.1029">       this._storingAction = false;</span>
<a href="#l5.1030"></a><span id="l5.1030">     }</span>
<a href="#l5.1031"></a><span id="l5.1031">   },</span>
<a href="#l5.1032"></a><span id="l5.1032"> </span>
<a href="#l5.1033"></a><span id="l5.1033" class="difflineminus">-  _storeAction: function(aActionItem) {</span>
<a href="#l5.1034"></a><span id="l5.1034" class="difflineplus">+  _storeAction(aActionItem) {</span>
<a href="#l5.1035"></a><span id="l5.1035">     var typeItem = this._list.selectedItem;</span>
<a href="#l5.1036"></a><span id="l5.1036">     var handlerInfo = this._handledTypes[typeItem.type];</span>
<a href="#l5.1037"></a><span id="l5.1037"> </span>
<a href="#l5.1038"></a><span id="l5.1038">     if (aActionItem.hasAttribute(&quot;alwaysAsk&quot;)) {</span>
<a href="#l5.1039"></a><span id="l5.1039">       handlerInfo.alwaysAskBeforeHandling = true;</span>
<a href="#l5.1040"></a><span id="l5.1040" class="difflineminus">-    }</span>
<a href="#l5.1041"></a><span id="l5.1041" class="difflineminus">-    else if (aActionItem.hasAttribute(&quot;action&quot;)) {</span>
<a href="#l5.1042"></a><span id="l5.1042" class="difflineplus">+    } else if (aActionItem.hasAttribute(&quot;action&quot;)) {</span>
<a href="#l5.1043"></a><span id="l5.1043">       let action = parseInt(aActionItem.getAttribute(&quot;action&quot;));</span>
<a href="#l5.1044"></a><span id="l5.1044"> </span>
<a href="#l5.1045"></a><span id="l5.1045">       // Set the plugin state if we're enabling or disabling a plugin.</span>
<a href="#l5.1046"></a><span id="l5.1046">       if (action == kActionUsePlugin)</span>
<a href="#l5.1047"></a><span id="l5.1047">         handlerInfo.enablePluginType();</span>
<a href="#l5.1048"></a><span id="l5.1048">       else if (handlerInfo.plugin &amp;&amp; !handlerInfo.isDisabledPluginType)</span>
<a href="#l5.1049"></a><span id="l5.1049">         handlerInfo.disablePluginType();</span>
<a href="#l5.1050"></a><span id="l5.1050"> </span>
<a href="#l5.1051"></a><span id="l5.1051" class="difflineat">@@ -1563,17 +1553,17 @@ var gApplicationsPane = {</span>
<a href="#l5.1052"></a><span id="l5.1052">     typeItem.setAttribute(&quot;actionDescription&quot;,</span>
<a href="#l5.1053"></a><span id="l5.1053">                           this._describePreferredAction(handlerInfo));</span>
<a href="#l5.1054"></a><span id="l5.1054">     if (!this._setIconClassForPreferredAction(handlerInfo, typeItem)) {</span>
<a href="#l5.1055"></a><span id="l5.1055">       typeItem.setAttribute(&quot;actionIcon&quot;,</span>
<a href="#l5.1056"></a><span id="l5.1056">                             this._getIconURLForPreferredAction(handlerInfo));</span>
<a href="#l5.1057"></a><span id="l5.1057">     }</span>
<a href="#l5.1058"></a><span id="l5.1058">   },</span>
<a href="#l5.1059"></a><span id="l5.1059"> </span>
<a href="#l5.1060"></a><span id="l5.1060" class="difflineminus">-  manageApp: function(aEvent) {</span>
<a href="#l5.1061"></a><span id="l5.1061" class="difflineplus">+  manageApp(aEvent) {</span>
<a href="#l5.1062"></a><span id="l5.1062">     // Don't let the normal &quot;on select action&quot; handler get this event,</span>
<a href="#l5.1063"></a><span id="l5.1063">     // as we handle it specially ourselves.</span>
<a href="#l5.1064"></a><span id="l5.1064">     aEvent.stopPropagation();</span>
<a href="#l5.1065"></a><span id="l5.1065"> </span>
<a href="#l5.1066"></a><span id="l5.1066">     var typeItem = this._list.selectedItem;</span>
<a href="#l5.1067"></a><span id="l5.1067">     var handlerInfo = this._handledTypes[typeItem.type];</span>
<a href="#l5.1068"></a><span id="l5.1068"> </span>
<a href="#l5.1069"></a><span id="l5.1069">     let closingCallback = () =&gt; {</span>
<a href="#l5.1070"></a><span id="l5.1070" class="difflineat">@@ -1590,17 +1580,17 @@ var gApplicationsPane = {</span>
<a href="#l5.1071"></a><span id="l5.1071">       }</span>
<a href="#l5.1072"></a><span id="l5.1072">     };</span>
<a href="#l5.1073"></a><span id="l5.1073"> </span>
<a href="#l5.1074"></a><span id="l5.1074">     gSubDialog.open(</span>
<a href="#l5.1075"></a><span id="l5.1075">       &quot;chrome://messenger/content/preferences/applicationManager.xul&quot;,</span>
<a href="#l5.1076"></a><span id="l5.1076">       &quot;resizable=no&quot;, handlerInfo, closingCallback);</span>
<a href="#l5.1077"></a><span id="l5.1077">   },</span>
<a href="#l5.1078"></a><span id="l5.1078"> </span>
<a href="#l5.1079"></a><span id="l5.1079" class="difflineminus">-  chooseApp: function(aEvent) {</span>
<a href="#l5.1080"></a><span id="l5.1080" class="difflineplus">+  chooseApp(aEvent) {</span>
<a href="#l5.1081"></a><span id="l5.1081">     // Don't let the normal &quot;on select action&quot; handler get this event,</span>
<a href="#l5.1082"></a><span id="l5.1082">     // as we handle it specially ourselves.</span>
<a href="#l5.1083"></a><span id="l5.1083">     aEvent.stopPropagation();</span>
<a href="#l5.1084"></a><span id="l5.1084"> </span>
<a href="#l5.1085"></a><span id="l5.1085">     var handlerApp;</span>
<a href="#l5.1086"></a><span id="l5.1086">     let onSelectionDone = function() {</span>
<a href="#l5.1087"></a><span id="l5.1087">       // Rebuild the actions menu whether the user picked an app or canceled.</span>
<a href="#l5.1088"></a><span id="l5.1088">       // If they picked an app, we want to add the app to the menu and select it.</span>
<a href="#l5.1089"></a><span id="l5.1089" class="difflineat">@@ -1673,55 +1663,55 @@ var gApplicationsPane = {</span>
<a href="#l5.1090"></a><span id="l5.1090">         }</span>
<a href="#l5.1091"></a><span id="l5.1091">         onSelectionDone();</span>
<a href="#l5.1092"></a><span id="l5.1092">       });</span>
<a href="#l5.1093"></a><span id="l5.1093">     }</span>
<a href="#l5.1094"></a><span id="l5.1094">   },</span>
<a href="#l5.1095"></a><span id="l5.1095"> </span>
<a href="#l5.1096"></a><span id="l5.1096">   // Mark which item in the list was last selected so we can reselect it</span>
<a href="#l5.1097"></a><span id="l5.1097">   // when we rebuild the list or when the user returns to the prefpane.</span>
<a href="#l5.1098"></a><span id="l5.1098" class="difflineminus">-  onSelectionChanged: function() {</span>
<a href="#l5.1099"></a><span id="l5.1099" class="difflineplus">+  onSelectionChanged() {</span>
<a href="#l5.1100"></a><span id="l5.1100">     if (this._list.selectedItem)</span>
<a href="#l5.1101"></a><span id="l5.1101">       this._list.setAttribute(&quot;lastSelectedType&quot;,</span>
<a href="#l5.1102"></a><span id="l5.1102">                               this._list.selectedItem.getAttribute(&quot;type&quot;));</span>
<a href="#l5.1103"></a><span id="l5.1103">   },</span>
<a href="#l5.1104"></a><span id="l5.1104"> </span>
<a href="#l5.1105"></a><span id="l5.1105" class="difflineminus">-  confirmDelete: function(aEvent) {</span>
<a href="#l5.1106"></a><span id="l5.1106" class="difflineplus">+  confirmDelete(aEvent) {</span>
<a href="#l5.1107"></a><span id="l5.1107">     aEvent.stopPropagation();</span>
<a href="#l5.1108"></a><span id="l5.1108">     if (Services.prompt.confirm(null,</span>
<a href="#l5.1109"></a><span id="l5.1109">                                 this._prefsBundle.getString(&quot;confirmDeleteTitle&quot;),</span>
<a href="#l5.1110"></a><span id="l5.1110">                                 this._prefsBundle.getString(&quot;confirmDeleteText&quot;)))</span>
<a href="#l5.1111"></a><span id="l5.1111">       this.onDelete(aEvent);</span>
<a href="#l5.1112"></a><span id="l5.1112">     else {</span>
<a href="#l5.1113"></a><span id="l5.1113">       // They hit cancel, so return them to the previously selected item.</span>
<a href="#l5.1114"></a><span id="l5.1114">       let typeItem = this._list.selectedItem;</span>
<a href="#l5.1115"></a><span id="l5.1115">       let menu = document.getAnonymousElementByAttribute(this._list.selectedItem,</span>
<a href="#l5.1116"></a><span id="l5.1116">                                                          &quot;class&quot;, &quot;actionsMenu&quot;);</span>
<a href="#l5.1117"></a><span id="l5.1117">       menu.selectedItem = menu.previousSelectedItem;</span>
<a href="#l5.1118"></a><span id="l5.1118">     }</span>
<a href="#l5.1119"></a><span id="l5.1119">   },</span>
<a href="#l5.1120"></a><span id="l5.1120"> </span>
<a href="#l5.1121"></a><span id="l5.1121" class="difflineminus">-  onDelete: function(aEvent) {</span>
<a href="#l5.1122"></a><span id="l5.1122" class="difflineplus">+  onDelete(aEvent) {</span>
<a href="#l5.1123"></a><span id="l5.1123">     // We want to delete if either the request came from the confirmDelete</span>
<a href="#l5.1124"></a><span id="l5.1124">     // method (which is the only thing that populates the aEvent parameter),</span>
<a href="#l5.1125"></a><span id="l5.1125">     // or we've hit the delete/backspace key while the list has focus.</span>
<a href="#l5.1126"></a><span id="l5.1126">     if ((aEvent || document.commandDispatcher.focusedElement == this._list) &amp;&amp;</span>
<a href="#l5.1127"></a><span id="l5.1127">         this._list.selectedIndex != -1) {</span>
<a href="#l5.1128"></a><span id="l5.1128">       let typeItem = this._list.getItemAtIndex(this._list.selectedIndex);</span>
<a href="#l5.1129"></a><span id="l5.1129">       let handlerInfo = this._handledTypes[typeItem.type];</span>
<a href="#l5.1130"></a><span id="l5.1130">       let index = this._visibleTypes.indexOf(handlerInfo);</span>
<a href="#l5.1131"></a><span id="l5.1131">       if (index != -1)</span>
<a href="#l5.1132"></a><span id="l5.1132">         this._visibleTypes.splice(index, 1);</span>
<a href="#l5.1133"></a><span id="l5.1133">       handlerInfo.remove();</span>
<a href="#l5.1134"></a><span id="l5.1134">       delete this._handledTypes[typeItem.type];</span>
<a href="#l5.1135"></a><span id="l5.1135">       typeItem.remove();</span>
<a href="#l5.1136"></a><span id="l5.1136">     }</span>
<a href="#l5.1137"></a><span id="l5.1137">   },</span>
<a href="#l5.1138"></a><span id="l5.1138"> </span>
<a href="#l5.1139"></a><span id="l5.1139" class="difflineminus">-  _setIconClassForPreferredAction: function(aHandlerInfo, aElement) {</span>
<a href="#l5.1140"></a><span id="l5.1140" class="difflineplus">+  _setIconClassForPreferredAction(aHandlerInfo, aElement) {</span>
<a href="#l5.1141"></a><span id="l5.1141">     // If this returns true, the attribute that CSS sniffs for was set to something</span>
<a href="#l5.1142"></a><span id="l5.1142">     // so you shouldn't manually set an icon URI.</span>
<a href="#l5.1143"></a><span id="l5.1143">     // This removes the existing actionIcon attribute if any, even if returning false.</span>
<a href="#l5.1144"></a><span id="l5.1144">     aElement.removeAttribute(&quot;actionIcon&quot;);</span>
<a href="#l5.1145"></a><span id="l5.1145"> </span>
<a href="#l5.1146"></a><span id="l5.1146">     if (aHandlerInfo.alwaysAskBeforeHandling) {</span>
<a href="#l5.1147"></a><span id="l5.1147">       aElement.setAttribute(APP_ICON_ATTR_NAME, &quot;ask&quot;);</span>
<a href="#l5.1148"></a><span id="l5.1148">       return true;</span>
<a href="#l5.1149"></a><span id="l5.1149" class="difflineat">@@ -1738,85 +1728,84 @@ var gApplicationsPane = {</span>
<a href="#l5.1150"></a><span id="l5.1150">       case kActionUsePlugin:</span>
<a href="#l5.1151"></a><span id="l5.1151">         aElement.setAttribute(APP_ICON_ATTR_NAME, &quot;plugin&quot;);</span>
<a href="#l5.1152"></a><span id="l5.1152">         return true;</span>
<a href="#l5.1153"></a><span id="l5.1153">     }</span>
<a href="#l5.1154"></a><span id="l5.1154">     aElement.removeAttribute(APP_ICON_ATTR_NAME);</span>
<a href="#l5.1155"></a><span id="l5.1155">     return false;</span>
<a href="#l5.1156"></a><span id="l5.1156">   },</span>
<a href="#l5.1157"></a><span id="l5.1157"> </span>
<a href="#l5.1158"></a><span id="l5.1158" class="difflineminus">-  _getIconURLForPreferredAction: function(aHandlerInfo) {</span>
<a href="#l5.1159"></a><span id="l5.1159" class="difflineplus">+  _getIconURLForPreferredAction(aHandlerInfo) {</span>
<a href="#l5.1160"></a><span id="l5.1160">     switch (aHandlerInfo.preferredAction) {</span>
<a href="#l5.1161"></a><span id="l5.1161">       case Ci.nsIHandlerInfo.useSystemDefault:</span>
<a href="#l5.1162"></a><span id="l5.1162">         return this._getIconURLForSystemDefault(aHandlerInfo);</span>
<a href="#l5.1163"></a><span id="l5.1163"> </span>
<a href="#l5.1164"></a><span id="l5.1164">       case Ci.nsIHandlerInfo.useHelperApp:</span>
<a href="#l5.1165"></a><span id="l5.1165">         let preferredApp = aHandlerInfo.preferredApplicationHandler;</span>
<a href="#l5.1166"></a><span id="l5.1166">         if (this.isValidHandlerApp(preferredApp))</span>
<a href="#l5.1167"></a><span id="l5.1167">           return this._getIconURLForHandlerApp(preferredApp);</span>
<a href="#l5.1168"></a><span id="l5.1168">     }</span>
<a href="#l5.1169"></a><span id="l5.1169">     // This should never happen, but if preferredAction is set to some weird</span>
<a href="#l5.1170"></a><span id="l5.1170">     // value, then fall back to the generic application icon.</span>
<a href="#l5.1171"></a><span id="l5.1171">     return ICON_URL_APP;</span>
<a href="#l5.1172"></a><span id="l5.1172">   },</span>
<a href="#l5.1173"></a><span id="l5.1173"> </span>
<a href="#l5.1174"></a><span id="l5.1174" class="difflineminus">-  _getIconURLForHandlerApp: function(aHandlerApp) {</span>
<a href="#l5.1175"></a><span id="l5.1175" class="difflineplus">+  _getIconURLForHandlerApp(aHandlerApp) {</span>
<a href="#l5.1176"></a><span id="l5.1176">     if (aHandlerApp instanceof Ci.nsILocalHandlerApp)</span>
<a href="#l5.1177"></a><span id="l5.1177">       return this._getIconURLForFile(aHandlerApp.executable);</span>
<a href="#l5.1178"></a><span id="l5.1178"> </span>
<a href="#l5.1179"></a><span id="l5.1179">     if (aHandlerApp instanceof Ci.nsIWebHandlerApp)</span>
<a href="#l5.1180"></a><span id="l5.1180">       return this._getIconURLForWebApp(aHandlerApp.uriTemplate);</span>
<a href="#l5.1181"></a><span id="l5.1181"> </span>
<a href="#l5.1182"></a><span id="l5.1182">     if (aHandlerApp instanceof Ci.nsIWebContentHandlerInfo)</span>
<a href="#l5.1183"></a><span id="l5.1183" class="difflineminus">-      return this._getIconURLForWebApp(aHandlerApp.uri)</span>
<a href="#l5.1184"></a><span id="l5.1184" class="difflineplus">+      return this._getIconURLForWebApp(aHandlerApp.uri);</span>
<a href="#l5.1185"></a><span id="l5.1185"> </span>
<a href="#l5.1186"></a><span id="l5.1186">     // We know nothing about other kinds of handler apps.</span>
<a href="#l5.1187"></a><span id="l5.1187">     return &quot;&quot;;</span>
<a href="#l5.1188"></a><span id="l5.1188">   },</span>
<a href="#l5.1189"></a><span id="l5.1189"> </span>
<a href="#l5.1190"></a><span id="l5.1190" class="difflineminus">-  _getIconURLForFile: function(aFile) {</span>
<a href="#l5.1191"></a><span id="l5.1191" class="difflineplus">+  _getIconURLForFile(aFile) {</span>
<a href="#l5.1192"></a><span id="l5.1192">     let urlSpec = Services.io.getProtocolHandler(&quot;file&quot;)</span>
<a href="#l5.1193"></a><span id="l5.1193">       .QueryInterface(Ci.nsIFileProtocolHandler)</span>
<a href="#l5.1194"></a><span id="l5.1194">       .getURLSpecFromFile(aFile);</span>
<a href="#l5.1195"></a><span id="l5.1195"> </span>
<a href="#l5.1196"></a><span id="l5.1196">     return &quot;moz-icon://&quot; + urlSpec + &quot;?size=16&quot;;</span>
<a href="#l5.1197"></a><span id="l5.1197">   },</span>
<a href="#l5.1198"></a><span id="l5.1198"> </span>
<a href="#l5.1199"></a><span id="l5.1199" class="difflineminus">-  _getIconURLForWebApp: function(aWebAppURITemplate) {</span>
<a href="#l5.1200"></a><span id="l5.1200" class="difflineplus">+  _getIconURLForWebApp(aWebAppURITemplate) {</span>
<a href="#l5.1201"></a><span id="l5.1201">     var uri = Services.io.newURI(aWebAppURITemplate);</span>
<a href="#l5.1202"></a><span id="l5.1202"> </span>
<a href="#l5.1203"></a><span id="l5.1203">     // Unfortunately we can't use the favicon service to get the favicon,</span>
<a href="#l5.1204"></a><span id="l5.1204">     // because the service looks in the annotations table for a record with</span>
<a href="#l5.1205"></a><span id="l5.1205">     // the exact URL we give it, and users won't have such records for URLs</span>
<a href="#l5.1206"></a><span id="l5.1206">     // they don't visit, and users won't visit the web app's URL template,</span>
<a href="#l5.1207"></a><span id="l5.1207">     // they'll only visit URLs derived from that template (i.e. with %s</span>
<a href="#l5.1208"></a><span id="l5.1208">     // in the template replaced by the URL of the content being handled).</span>
<a href="#l5.1209"></a><span id="l5.1209"> </span>
<a href="#l5.1210"></a><span id="l5.1210">     if (/^https?/.test(uri.scheme))</span>
<a href="#l5.1211"></a><span id="l5.1211">       return uri.prePath + &quot;/favicon.ico&quot;;</span>
<a href="#l5.1212"></a><span id="l5.1212"> </span>
<a href="#l5.1213"></a><span id="l5.1213">     return /^https?/.test(uri.scheme) ? uri.resolve(&quot;/favicon.ico&quot;) : &quot;&quot;;</span>
<a href="#l5.1214"></a><span id="l5.1214">   },</span>
<a href="#l5.1215"></a><span id="l5.1215"> </span>
<a href="#l5.1216"></a><span id="l5.1216" class="difflineminus">-  _getIconURLForSystemDefault: function(aHandlerInfo) {</span>
<a href="#l5.1217"></a><span id="l5.1217" class="difflineplus">+  _getIconURLForSystemDefault(aHandlerInfo) {</span>
<a href="#l5.1218"></a><span id="l5.1218">     // Handler info objects for MIME types on some OSes implement a property bag</span>
<a href="#l5.1219"></a><span id="l5.1219">     // interface from which we can get an icon for the default app, so if we're</span>
<a href="#l5.1220"></a><span id="l5.1220">     // dealing with a MIME type on one of those OSes, then try to get the icon.</span>
<a href="#l5.1221"></a><span id="l5.1221">     if (&quot;wrappedHandlerInfo&quot; in aHandlerInfo) {</span>
<a href="#l5.1222"></a><span id="l5.1222">       let wrappedHandlerInfo = aHandlerInfo.wrappedHandlerInfo;</span>
<a href="#l5.1223"></a><span id="l5.1223"> </span>
<a href="#l5.1224"></a><span id="l5.1224">       if (wrappedHandlerInfo instanceof Ci.nsIMIMEInfo &amp;&amp;</span>
<a href="#l5.1225"></a><span id="l5.1225">           wrappedHandlerInfo instanceof Ci.nsIPropertyBag) {</span>
<a href="#l5.1226"></a><span id="l5.1226">         try {</span>
<a href="#l5.1227"></a><span id="l5.1227">           let url = wrappedHandlerInfo.getProperty(&quot;defaultApplicationIconURL&quot;);</span>
<a href="#l5.1228"></a><span id="l5.1228">           if (url)</span>
<a href="#l5.1229"></a><span id="l5.1229">             return url + &quot;?size=16&quot;;</span>
<a href="#l5.1230"></a><span id="l5.1230" class="difflineminus">-        }</span>
<a href="#l5.1231"></a><span id="l5.1231" class="difflineminus">-        catch(ex) { }</span>
<a href="#l5.1232"></a><span id="l5.1232" class="difflineplus">+        } catch (ex) { }</span>
<a href="#l5.1233"></a><span id="l5.1233">       }</span>
<a href="#l5.1234"></a><span id="l5.1234">     }</span>
<a href="#l5.1235"></a><span id="l5.1235"> </span>
<a href="#l5.1236"></a><span id="l5.1236">     // If this isn't a MIME type object on an OS that supports retrieving</span>
<a href="#l5.1237"></a><span id="l5.1237">     // the icon, or if we couldn't retrieve the icon for some other reason,</span>
<a href="#l5.1238"></a><span id="l5.1238">     // then use a generic icon.</span>
<a href="#l5.1239"></a><span id="l5.1239">     return ICON_URL_APP;</span>
<a href="#l5.1240"></a><span id="l5.1240" class="difflineminus">-  }</span>
<a href="#l5.1241"></a><span id="l5.1241" class="difflineplus">+  },</span>
<a href="#l5.1242"></a><span id="l5.1242"> };</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l6.1"></a><span id="l6.1" class="difflineminus">--- a/mail/components/preferences/attachmentReminder.js</span>
<a href="#l6.2"></a><span id="l6.2" class="difflineplus">+++ b/mail/components/preferences/attachmentReminder.js</span>
<a href="#l6.3"></a><span id="l6.3" class="difflineat">@@ -4,83 +4,76 @@</span>
<a href="#l6.4"></a><span id="l6.4">  * file, You can obtain one at http://mozilla.org/MPL/2.0/. */</span>
<a href="#l6.5"></a><span id="l6.5"> </span>
<a href="#l6.6"></a><span id="l6.6"> ChromeUtils.import(&quot;resource://gre/modules/Services.jsm&quot;);</span>
<a href="#l6.7"></a><span id="l6.7"> </span>
<a href="#l6.8"></a><span id="l6.8"> var gAttachmentReminderOptionsDialog = {</span>
<a href="#l6.9"></a><span id="l6.9">   keywordListBox: null,</span>
<a href="#l6.10"></a><span id="l6.10">   bundle: null,</span>
<a href="#l6.11"></a><span id="l6.11"> </span>
<a href="#l6.12"></a><span id="l6.12" class="difflineminus">-  init: function()</span>
<a href="#l6.13"></a><span id="l6.13" class="difflineminus">-  {</span>
<a href="#l6.14"></a><span id="l6.14" class="difflineplus">+  init() {</span>
<a href="#l6.15"></a><span id="l6.15">     this.keywordListBox = document.getElementById(&quot;keywordList&quot;);</span>
<a href="#l6.16"></a><span id="l6.16">     this.bundle = document.getElementById(&quot;bundlePreferences&quot;);</span>
<a href="#l6.17"></a><span id="l6.17">     this.buildKeywordList();</span>
<a href="#l6.18"></a><span id="l6.18">   },</span>
<a href="#l6.19"></a><span id="l6.19"> </span>
<a href="#l6.20"></a><span id="l6.20" class="difflineminus">-  buildKeywordList: function()</span>
<a href="#l6.21"></a><span id="l6.21" class="difflineminus">-  {</span>
<a href="#l6.22"></a><span id="l6.22" class="difflineplus">+  buildKeywordList() {</span>
<a href="#l6.23"></a><span id="l6.23">     var keywordsInCsv = Services.prefs</span>
<a href="#l6.24"></a><span id="l6.24">       .getComplexValue(&quot;mail.compose.attachment_reminder_keywords&quot;,</span>
<a href="#l6.25"></a><span id="l6.25">                        Ci.nsIPrefLocalizedString);</span>
<a href="#l6.26"></a><span id="l6.26">     if (!keywordsInCsv)</span>
<a href="#l6.27"></a><span id="l6.27">       return;</span>
<a href="#l6.28"></a><span id="l6.28">     var keywordsInCsv = keywordsInCsv.data;</span>
<a href="#l6.29"></a><span id="l6.29">     var keywordsInArr = keywordsInCsv.split(&quot;,&quot;);</span>
<a href="#l6.30"></a><span id="l6.30" class="difflineminus">-    for (var i = 0; i &lt; keywordsInArr.length; i++)</span>
<a href="#l6.31"></a><span id="l6.31" class="difflineminus">-    {</span>
<a href="#l6.32"></a><span id="l6.32" class="difflineplus">+    for (var i = 0; i &lt; keywordsInArr.length; i++) {</span>
<a href="#l6.33"></a><span id="l6.33">       if (keywordsInArr[i])</span>
<a href="#l6.34"></a><span id="l6.34">         this.keywordListBox.appendItem(keywordsInArr[i], keywordsInArr[i]);</span>
<a href="#l6.35"></a><span id="l6.35">     }</span>
<a href="#l6.36"></a><span id="l6.36">     if (keywordsInArr.length)</span>
<a href="#l6.37"></a><span id="l6.37">       this.keywordListBox.selectedIndex = 0;</span>
<a href="#l6.38"></a><span id="l6.38">   },</span>
<a href="#l6.39"></a><span id="l6.39"> </span>
<a href="#l6.40"></a><span id="l6.40" class="difflineminus">-  addKeyword: function()</span>
<a href="#l6.41"></a><span id="l6.41" class="difflineminus">-  {</span>
<a href="#l6.42"></a><span id="l6.42" class="difflineplus">+  addKeyword() {</span>
<a href="#l6.43"></a><span id="l6.43">     var input = {value: &quot;&quot;}; // Default to empty.</span>
<a href="#l6.44"></a><span id="l6.44">     var ok = Services.prompt.prompt(window,</span>
<a href="#l6.45"></a><span id="l6.45">                                     this.bundle.getString(&quot;attachmentReminderNewDialogTitle&quot;),</span>
<a href="#l6.46"></a><span id="l6.46">                                     this.bundle.getString(&quot;attachmentReminderNewText&quot;),</span>
<a href="#l6.47"></a><span id="l6.47" class="difflineminus">-                                    input, null, {value:0});</span>
<a href="#l6.48"></a><span id="l6.48" class="difflineplus">+                                    input, null, {value: 0});</span>
<a href="#l6.49"></a><span id="l6.49">     if (ok &amp;&amp; input.value) {</span>
<a href="#l6.50"></a><span id="l6.50">       let newKey = this.keywordListBox.appendItem(input.value, input.value);</span>
<a href="#l6.51"></a><span id="l6.51">       this.keywordListBox.ensureElementIsVisible(newKey);</span>
<a href="#l6.52"></a><span id="l6.52">       this.keywordListBox.selectItem(newKey);</span>
<a href="#l6.53"></a><span id="l6.53">     }</span>
<a href="#l6.54"></a><span id="l6.54">   },</span>
<a href="#l6.55"></a><span id="l6.55"> </span>
<a href="#l6.56"></a><span id="l6.56" class="difflineminus">-  editKeyword: function()</span>
<a href="#l6.57"></a><span id="l6.57" class="difflineminus">-  {</span>
<a href="#l6.58"></a><span id="l6.58" class="difflineplus">+  editKeyword() {</span>
<a href="#l6.59"></a><span id="l6.59">     if (this.keywordListBox.selectedIndex &lt; 0)</span>
<a href="#l6.60"></a><span id="l6.60">       return;</span>
<a href="#l6.61"></a><span id="l6.61">     var keywordToEdit = this.keywordListBox.selectedItem;</span>
<a href="#l6.62"></a><span id="l6.62">     var input = {value: keywordToEdit.getAttribute(&quot;value&quot;)};</span>
<a href="#l6.63"></a><span id="l6.63">     var ok = Services.prompt.prompt(window,</span>
<a href="#l6.64"></a><span id="l6.64">                                     this.bundle.getString(&quot;attachmentReminderEditDialogTitle&quot;),</span>
<a href="#l6.65"></a><span id="l6.65">                                     this.bundle.getString(&quot;attachmentReminderEditText&quot;),</span>
<a href="#l6.66"></a><span id="l6.66" class="difflineminus">-                                    input, null, {value:0});</span>
<a href="#l6.67"></a><span id="l6.67" class="difflineplus">+                                    input, null, {value: 0});</span>
<a href="#l6.68"></a><span id="l6.68">     if (ok &amp;&amp; input.value) {</span>
<a href="#l6.69"></a><span id="l6.69">       this.keywordListBox.selectedItem.value = input.value;</span>
<a href="#l6.70"></a><span id="l6.70">       this.keywordListBox.selectedItem.label = input.value;</span>
<a href="#l6.71"></a><span id="l6.71">     }</span>
<a href="#l6.72"></a><span id="l6.72">   },</span>
<a href="#l6.73"></a><span id="l6.73"> </span>
<a href="#l6.74"></a><span id="l6.74" class="difflineminus">-  removeKeyword: function()</span>
<a href="#l6.75"></a><span id="l6.75" class="difflineminus">-  {</span>
<a href="#l6.76"></a><span id="l6.76" class="difflineplus">+  removeKeyword() {</span>
<a href="#l6.77"></a><span id="l6.77">     if (this.keywordListBox.selectedIndex &lt; 0)</span>
<a href="#l6.78"></a><span id="l6.78">       return;</span>
<a href="#l6.79"></a><span id="l6.79">     this.keywordListBox.selectedItem.remove();</span>
<a href="#l6.80"></a><span id="l6.80">   },</span>
<a href="#l6.81"></a><span id="l6.81"> </span>
<a href="#l6.82"></a><span id="l6.82" class="difflineminus">-  saveKeywords: function()</span>
<a href="#l6.83"></a><span id="l6.83" class="difflineminus">-  {</span>
<a href="#l6.84"></a><span id="l6.84" class="difflineplus">+  saveKeywords() {</span>
<a href="#l6.85"></a><span id="l6.85">     var keywordList = &quot;&quot;;</span>
<a href="#l6.86"></a><span id="l6.86">     for (var i = 0; i &lt; this.keywordListBox.getRowCount(); i++) {</span>
<a href="#l6.87"></a><span id="l6.87">       keywordList += this.keywordListBox.getItemAtIndex(i).getAttribute(&quot;value&quot;);</span>
<a href="#l6.88"></a><span id="l6.88">       if (i != this.keywordListBox.getRowCount() - 1)</span>
<a href="#l6.89"></a><span id="l6.89">         keywordList += &quot;,&quot;;</span>
<a href="#l6.90"></a><span id="l6.90">     }</span>
<a href="#l6.91"></a><span id="l6.91"> </span>
<a href="#l6.92"></a><span id="l6.92">     Services.prefs.setStringPref(&quot;mail.compose.attachment_reminder_keywords&quot;,</span>
<a href="#l6.93"></a><span id="l6.93">                                  keywordList);</span>
<a href="#l6.94"></a><span id="l6.94" class="difflineminus">-  }</span>
<a href="#l6.95"></a><span id="l6.95" class="difflineplus">+  },</span>
<a href="#l6.96"></a><span id="l6.96"> };</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l7.1"></a><span id="l7.1" class="difflineminus">--- a/mail/components/preferences/chat.js</span>
<a href="#l7.2"></a><span id="l7.2" class="difflineplus">+++ b/mail/components/preferences/chat.js</span>
<a href="#l7.3"></a><span id="l7.3" class="difflineat">@@ -1,65 +1,56 @@</span>
<a href="#l7.4"></a><span id="l7.4"> /* This Source Code Form is subject to the terms of the Mozilla Public</span>
<a href="#l7.5"></a><span id="l7.5">  * License, v. 2.0. If a copy of the MPL was not distributed with this</span>
<a href="#l7.6"></a><span id="l7.6">  * file, You can obtain one at http://mozilla.org/MPL/2.0/. */</span>
<a href="#l7.7"></a><span id="l7.7"> </span>
<a href="#l7.8"></a><span id="l7.8"> var gChatPane = {</span>
<a href="#l7.9"></a><span id="l7.9" class="difflineminus">-  init: function ()</span>
<a href="#l7.10"></a><span id="l7.10" class="difflineminus">-  {</span>
<a href="#l7.11"></a><span id="l7.11" class="difflineplus">+  init() {</span>
<a href="#l7.12"></a><span id="l7.12">     previewObserver.load();</span>
<a href="#l7.13"></a><span id="l7.13">     this.updateDisabledState();</span>
<a href="#l7.14"></a><span id="l7.14">     this.updatePlaySound();</span>
<a href="#l7.15"></a><span id="l7.15">   },</span>
<a href="#l7.16"></a><span id="l7.16"> </span>
<a href="#l7.17"></a><span id="l7.17" class="difflineminus">-  updateDisabledState: function ()</span>
<a href="#l7.18"></a><span id="l7.18" class="difflineminus">-  {</span>
<a href="#l7.19"></a><span id="l7.19" class="difflineplus">+  updateDisabledState() {</span>
<a href="#l7.20"></a><span id="l7.20">     let broadcaster = document.getElementById(&quot;idleReportingEnabled&quot;);</span>
<a href="#l7.21"></a><span id="l7.21">     if (document.getElementById(&quot;messenger.status.reportIdle&quot;).value) {</span>
<a href="#l7.22"></a><span id="l7.22">       broadcaster.removeAttribute(&quot;disabled&quot;);</span>
<a href="#l7.23"></a><span id="l7.23">       this.updateMessageDisabledState();</span>
<a href="#l7.24"></a><span id="l7.24" class="difflineminus">-    }</span>
<a href="#l7.25"></a><span id="l7.25" class="difflineminus">-    else</span>
<a href="#l7.26"></a><span id="l7.26" class="difflineplus">+    } else</span>
<a href="#l7.27"></a><span id="l7.27">       broadcaster.setAttribute(&quot;disabled&quot;, &quot;true&quot;);</span>
<a href="#l7.28"></a><span id="l7.28">   },</span>
<a href="#l7.29"></a><span id="l7.29"> </span>
<a href="#l7.30"></a><span id="l7.30" class="difflineminus">-  updateMessageDisabledState: function ()</span>
<a href="#l7.31"></a><span id="l7.31" class="difflineminus">-  {</span>
<a href="#l7.32"></a><span id="l7.32" class="difflineplus">+  updateMessageDisabledState() {</span>
<a href="#l7.33"></a><span id="l7.33">     let textbox = document.getElementById(&quot;defaultIdleAwayMessage&quot;);</span>
<a href="#l7.34"></a><span id="l7.34">     if (document.getElementById(&quot;messenger.status.awayWhenIdle&quot;).value)</span>
<a href="#l7.35"></a><span id="l7.35">       textbox.removeAttribute(&quot;disabled&quot;);</span>
<a href="#l7.36"></a><span id="l7.36">     else</span>
<a href="#l7.37"></a><span id="l7.37">       textbox.setAttribute(&quot;disabled&quot;, &quot;true&quot;);</span>
<a href="#l7.38"></a><span id="l7.38">   },</span>
<a href="#l7.39"></a><span id="l7.39"> </span>
<a href="#l7.40"></a><span id="l7.40" class="difflineminus">-  convertURLToLocalFile: function(aFileURL)</span>
<a href="#l7.41"></a><span id="l7.41" class="difflineminus">-  {</span>
<a href="#l7.42"></a><span id="l7.42" class="difflineplus">+  convertURLToLocalFile(aFileURL) {</span>
<a href="#l7.43"></a><span id="l7.43">     // convert the file url into a nsIFile</span>
<a href="#l7.44"></a><span id="l7.44" class="difflineminus">-    if (aFileURL)</span>
<a href="#l7.45"></a><span id="l7.45" class="difflineminus">-    {</span>
<a href="#l7.46"></a><span id="l7.46" class="difflineplus">+    if (aFileURL) {</span>
<a href="#l7.47"></a><span id="l7.47">       return Services.io.getProtocolHandler(&quot;file&quot;)</span>
<a href="#l7.48"></a><span id="l7.48">                         .QueryInterface(Ci.nsIFileProtocolHandler)</span>
<a href="#l7.49"></a><span id="l7.49">                         .getFileFromURLSpec(aFileURL);</span>
<a href="#l7.50"></a><span id="l7.50">     }</span>
<a href="#l7.51"></a><span id="l7.51">     return null;</span>
<a href="#l7.52"></a><span id="l7.52">   },</span>
<a href="#l7.53"></a><span id="l7.53"> </span>
<a href="#l7.54"></a><span id="l7.54" class="difflineminus">-  readSoundLocation: function()</span>
<a href="#l7.55"></a><span id="l7.55" class="difflineminus">-  {</span>
<a href="#l7.56"></a><span id="l7.56" class="difflineplus">+  readSoundLocation() {</span>
<a href="#l7.57"></a><span id="l7.57">     let chatSoundUrlLocation = document.getElementById(&quot;chatSoundUrlLocation&quot;);</span>
<a href="#l7.58"></a><span id="l7.58">     chatSoundUrlLocation.value = document.getElementById(&quot;mail.chat.play_sound.url&quot;).value;</span>
<a href="#l7.59"></a><span id="l7.59" class="difflineminus">-    if (chatSoundUrlLocation.value)</span>
<a href="#l7.60"></a><span id="l7.60" class="difflineminus">-    {</span>
<a href="#l7.61"></a><span id="l7.61" class="difflineplus">+    if (chatSoundUrlLocation.value) {</span>
<a href="#l7.62"></a><span id="l7.62">       chatSoundUrlLocation.label = this.convertURLToLocalFile(chatSoundUrlLocation.value).leafName;</span>
<a href="#l7.63"></a><span id="l7.63">       chatSoundUrlLocation.style.backgroundImage = &quot;url(moz-icon://&quot; + chatSoundUrlLocation.label + &quot;?size=16)&quot;;</span>
<a href="#l7.64"></a><span id="l7.64">     }</span>
<a href="#l7.65"></a><span id="l7.65">   },</span>
<a href="#l7.66"></a><span id="l7.66"> </span>
<a href="#l7.67"></a><span id="l7.67" class="difflineminus">-  previewSound: function ()</span>
<a href="#l7.68"></a><span id="l7.68" class="difflineminus">-  {</span>
<a href="#l7.69"></a><span id="l7.69" class="difflineplus">+  previewSound() {</span>
<a href="#l7.70"></a><span id="l7.70">     let sound = Cc[&quot;@mozilla.org/sound;1&quot;].createInstance(Ci.nsISound);</span>
<a href="#l7.71"></a><span id="l7.71"> </span>
<a href="#l7.72"></a><span id="l7.72">     let soundLocation = document.getElementById(&quot;chatSoundType&quot;).value == 1 ?</span>
<a href="#l7.73"></a><span id="l7.73">                         document.getElementById(&quot;chatSoundUrlLocation&quot;).value :</span>
<a href="#l7.74"></a><span id="l7.74">                         &quot;&quot;;</span>
<a href="#l7.75"></a><span id="l7.75"> </span>
<a href="#l7.76"></a><span id="l7.76">     // This should be in sync with the code in nsStatusBarBiffManager::PlayBiffSound.</span>
<a href="#l7.77"></a><span id="l7.77">     if (!soundLocation.startsWith(&quot;file://&quot;)) {</span>
<a href="#l7.78"></a><span id="l7.78" class="difflineat">@@ -67,18 +58,17 @@ var gChatPane = {</span>
<a href="#l7.79"></a><span id="l7.79">         sound.beep();</span>
<a href="#l7.80"></a><span id="l7.80">       else</span>
<a href="#l7.81"></a><span id="l7.81">         sound.playEventSound(Ci.nsISound.EVENT_NEW_MAIL_RECEIVED);</span>
<a href="#l7.82"></a><span id="l7.82">     } else {</span>
<a href="#l7.83"></a><span id="l7.83">       sound.play(Services.io.newURI(soundLocation));</span>
<a href="#l7.84"></a><span id="l7.84">     }</span>
<a href="#l7.85"></a><span id="l7.85">   },</span>
<a href="#l7.86"></a><span id="l7.86"> </span>
<a href="#l7.87"></a><span id="l7.87" class="difflineminus">-  browseForSoundFile: function ()</span>
<a href="#l7.88"></a><span id="l7.88" class="difflineminus">-  {</span>
<a href="#l7.89"></a><span id="l7.89" class="difflineplus">+  browseForSoundFile() {</span>
<a href="#l7.90"></a><span id="l7.90">     const nsIFilePicker = Ci.nsIFilePicker;</span>
<a href="#l7.91"></a><span id="l7.91">     let fp = Cc[&quot;@mozilla.org/filepicker;1&quot;].createInstance(nsIFilePicker);</span>
<a href="#l7.92"></a><span id="l7.92"> </span>
<a href="#l7.93"></a><span id="l7.93">     // If we already have a sound file, then use the path for that sound file</span>
<a href="#l7.94"></a><span id="l7.94">     // as the initial path in the dialog.</span>
<a href="#l7.95"></a><span id="l7.95">     let localFile = this.convertURLToLocalFile(</span>
<a href="#l7.96"></a><span id="l7.96">       document.getElementById(&quot;chatSoundUrlLocation&quot;).value);</span>
<a href="#l7.97"></a><span id="l7.97">     if (localFile)</span>
<a href="#l7.98"></a><span id="l7.98" class="difflineat">@@ -105,21 +95,20 @@ var gChatPane = {</span>
<a href="#l7.99"></a><span id="l7.99"> </span>
<a href="#l7.100"></a><span id="l7.100">       // convert the nsIFile into a nsIFile url</span>
<a href="#l7.101"></a><span id="l7.101">       document.getElementById(&quot;mail.chat.play_sound.url&quot;).value = fp.fileURL.spec;</span>
<a href="#l7.102"></a><span id="l7.102">       this.readSoundLocation(); // XXX We shouldn't have to be doing this by hand</span>
<a href="#l7.103"></a><span id="l7.103">       this.updatePlaySound();</span>
<a href="#l7.104"></a><span id="l7.104">     });</span>
<a href="#l7.105"></a><span id="l7.105">   },</span>
<a href="#l7.106"></a><span id="l7.106"> </span>
<a href="#l7.107"></a><span id="l7.107" class="difflineminus">-  updatePlaySound: function()</span>
<a href="#l7.108"></a><span id="l7.108" class="difflineminus">-  {</span>
<a href="#l7.109"></a><span id="l7.109" class="difflineplus">+  updatePlaySound() {</span>
<a href="#l7.110"></a><span id="l7.110">     // update the sound type radio buttons based on the state of the play sound checkbox</span>
<a href="#l7.111"></a><span id="l7.111">     let soundsDisabled = !document.getElementById(&quot;chatNotification&quot;).checked;</span>
<a href="#l7.112"></a><span id="l7.112">     let soundTypeEl = document.getElementById(&quot;chatSoundType&quot;);</span>
<a href="#l7.113"></a><span id="l7.113">     let chatSoundUrlLocation = document.getElementById(&quot;chatSoundUrlLocation&quot;).value;</span>
<a href="#l7.114"></a><span id="l7.114">     soundTypeEl.disabled = soundsDisabled;</span>
<a href="#l7.115"></a><span id="l7.115">     document.getElementById(&quot;chatSoundUrlLocation&quot;).disabled =</span>
<a href="#l7.116"></a><span id="l7.116">       soundsDisabled || (soundTypeEl.value != 1);</span>
<a href="#l7.117"></a><span id="l7.117">     document.getElementById(&quot;playChatSound&quot;).disabled =</span>
<a href="#l7.118"></a><span id="l7.118">       soundsDisabled || (!chatSoundUrlLocation &amp;&amp; soundTypeEl.value != 0);</span>
<a href="#l7.119"></a><span id="l7.119" class="difflineminus">-  }</span>
<a href="#l7.120"></a><span id="l7.120" class="difflineplus">+  },</span>
<a href="#l7.121"></a><span id="l7.121"> };</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l8.1"></a><span id="l8.1" class="difflineminus">--- a/mail/components/preferences/compose.js</span>
<a href="#l8.2"></a><span id="l8.2" class="difflineplus">+++ b/mail/components/preferences/compose.js</span>
<a href="#l8.3"></a><span id="l8.3" class="difflineat">@@ -3,20 +3,19 @@</span>
<a href="#l8.4"></a><span id="l8.4">  * License, v. 2.0. If a copy of the MPL was not distributed with this</span>
<a href="#l8.5"></a><span id="l8.5">  * file, You can obtain one at http://mozilla.org/MPL/2.0/. */</span>
<a href="#l8.6"></a><span id="l8.6"> </span>
<a href="#l8.7"></a><span id="l8.7"> ChromeUtils.import(&quot;resource://gre/modules/InlineSpellChecker.jsm&quot;);</span>
<a href="#l8.8"></a><span id="l8.8"> </span>
<a href="#l8.9"></a><span id="l8.9"> var gComposePane = {</span>
<a href="#l8.10"></a><span id="l8.10">   mInitialized: false,</span>
<a href="#l8.11"></a><span id="l8.11">   mSpellChecker: null,</span>
<a href="#l8.12"></a><span id="l8.12" class="difflineminus">-  mDictCount : 0,</span>
<a href="#l8.13"></a><span id="l8.13" class="difflineplus">+  mDictCount: 0,</span>
<a href="#l8.14"></a><span id="l8.14"> </span>
<a href="#l8.15"></a><span id="l8.15" class="difflineminus">-  init: function ()</span>
<a href="#l8.16"></a><span id="l8.16" class="difflineminus">-  {</span>
<a href="#l8.17"></a><span id="l8.17" class="difflineplus">+  init() {</span>
<a href="#l8.18"></a><span id="l8.18">     this.enableAutocomplete();</span>
<a href="#l8.19"></a><span id="l8.19"> </span>
<a href="#l8.20"></a><span id="l8.20">     this.initLanguageMenu();</span>
<a href="#l8.21"></a><span id="l8.21"> </span>
<a href="#l8.22"></a><span id="l8.22">     this.populateFonts();</span>
<a href="#l8.23"></a><span id="l8.23"> </span>
<a href="#l8.24"></a><span id="l8.24">     this.updateAutosave();</span>
<a href="#l8.25"></a><span id="l8.25"> </span>
<a href="#l8.26"></a><span id="l8.26" class="difflineat">@@ -31,76 +30,66 @@ var gComposePane = {</span>
<a href="#l8.27"></a><span id="l8.27">       let preference = document.getElementById(&quot;mail.preferences.compose.selectedTabIndex&quot;);</span>
<a href="#l8.28"></a><span id="l8.28">       if (preference.value)</span>
<a href="#l8.29"></a><span id="l8.29">         document.getElementById(&quot;composePrefs&quot;).selectedIndex = preference.value;</span>
<a href="#l8.30"></a><span id="l8.30">     }</span>
<a href="#l8.31"></a><span id="l8.31"> </span>
<a href="#l8.32"></a><span id="l8.32">     this.mInitialized = true;</span>
<a href="#l8.33"></a><span id="l8.33">   },</span>
<a href="#l8.34"></a><span id="l8.34"> </span>
<a href="#l8.35"></a><span id="l8.35" class="difflineminus">-  tabSelectionChanged: function ()</span>
<a href="#l8.36"></a><span id="l8.36" class="difflineminus">-  {</span>
<a href="#l8.37"></a><span id="l8.37" class="difflineminus">-    if (this.mInitialized)</span>
<a href="#l8.38"></a><span id="l8.38" class="difflineminus">-    {</span>
<a href="#l8.39"></a><span id="l8.39" class="difflineplus">+  tabSelectionChanged() {</span>
<a href="#l8.40"></a><span id="l8.40" class="difflineplus">+    if (this.mInitialized) {</span>
<a href="#l8.41"></a><span id="l8.41">       var preference = document.getElementById(&quot;mail.preferences.compose.selectedTabIndex&quot;);</span>
<a href="#l8.42"></a><span id="l8.42">       preference.valueFromPreferences = document.getElementById(&quot;composePrefs&quot;).selectedIndex;</span>
<a href="#l8.43"></a><span id="l8.43">     }</span>
<a href="#l8.44"></a><span id="l8.44">   },</span>
<a href="#l8.45"></a><span id="l8.45"> </span>
<a href="#l8.46"></a><span id="l8.46" class="difflineminus">-  sendOptionsDialog: function()</span>
<a href="#l8.47"></a><span id="l8.47" class="difflineminus">-  {</span>
<a href="#l8.48"></a><span id="l8.48" class="difflineplus">+  sendOptionsDialog() {</span>
<a href="#l8.49"></a><span id="l8.49">     gSubDialog.open(&quot;chrome://messenger/content/preferences/sendoptions.xul&quot;);</span>
<a href="#l8.50"></a><span id="l8.50">   },</span>
<a href="#l8.51"></a><span id="l8.51"> </span>
<a href="#l8.52"></a><span id="l8.52" class="difflineminus">-  attachmentReminderOptionsDialog: function()</span>
<a href="#l8.53"></a><span id="l8.53" class="difflineminus">-  {</span>
<a href="#l8.54"></a><span id="l8.54" class="difflineplus">+  attachmentReminderOptionsDialog() {</span>
<a href="#l8.55"></a><span id="l8.55">     gSubDialog.open(&quot;chrome://messenger/content/preferences/attachmentReminder.xul&quot;,</span>
<a href="#l8.56"></a><span id="l8.56">                     &quot;resizable=no&quot;);</span>
<a href="#l8.57"></a><span id="l8.57">   },</span>
<a href="#l8.58"></a><span id="l8.58"> </span>
<a href="#l8.59"></a><span id="l8.59" class="difflineminus">-  updateAutosave: function()</span>
<a href="#l8.60"></a><span id="l8.60" class="difflineminus">-  {</span>
<a href="#l8.61"></a><span id="l8.61" class="difflineplus">+  updateAutosave() {</span>
<a href="#l8.62"></a><span id="l8.62">     this.enableElement(document.getElementById(&quot;autoSaveInterval&quot;),</span>
<a href="#l8.63"></a><span id="l8.63">       document.getElementById(&quot;autoSave&quot;).checked);</span>
<a href="#l8.64"></a><span id="l8.64">   },</span>
<a href="#l8.65"></a><span id="l8.65"> </span>
<a href="#l8.66"></a><span id="l8.66" class="difflineminus">-  updateAttachmentCheck: function()</span>
<a href="#l8.67"></a><span id="l8.67" class="difflineminus">-  {</span>
<a href="#l8.68"></a><span id="l8.68" class="difflineplus">+  updateAttachmentCheck() {</span>
<a href="#l8.69"></a><span id="l8.69">     this.enableElement(document.getElementById(&quot;attachment_reminder_button&quot;),</span>
<a href="#l8.70"></a><span id="l8.70">       document.getElementById(&quot;attachment_reminder_label&quot;).checked);</span>
<a href="#l8.71"></a><span id="l8.71">   },</span>
<a href="#l8.72"></a><span id="l8.72"> </span>
<a href="#l8.73"></a><span id="l8.73" class="difflineminus">-  updateEmailCollection: function()</span>
<a href="#l8.74"></a><span id="l8.74" class="difflineminus">-  {</span>
<a href="#l8.75"></a><span id="l8.75" class="difflineplus">+  updateEmailCollection() {</span>
<a href="#l8.76"></a><span id="l8.76">     this.enableElement(document.getElementById(&quot;localDirectoriesList&quot;),</span>
<a href="#l8.77"></a><span id="l8.77">       document.getElementById(&quot;emailCollectionOutgoing&quot;).checked);</span>
<a href="#l8.78"></a><span id="l8.78">   },</span>
<a href="#l8.79"></a><span id="l8.79"> </span>
<a href="#l8.80"></a><span id="l8.80" class="difflineminus">-  enableElement: function(aElement, aEnable)</span>
<a href="#l8.81"></a><span id="l8.81" class="difflineminus">-  {</span>
<a href="#l8.82"></a><span id="l8.82" class="difflineplus">+  enableElement(aElement, aEnable) {</span>
<a href="#l8.83"></a><span id="l8.83">     let pref = aElement.getAttribute(&quot;preference&quot;);</span>
<a href="#l8.84"></a><span id="l8.84">     let prefIsLocked = pref ? document.getElementById(pref).locked : false;</span>
<a href="#l8.85"></a><span id="l8.85">     aElement.disabled = !aEnable || prefIsLocked;</span>
<a href="#l8.86"></a><span id="l8.86">   },</span>
<a href="#l8.87"></a><span id="l8.87"> </span>
<a href="#l8.88"></a><span id="l8.88" class="difflineminus">-  enableAutocomplete: function()</span>
<a href="#l8.89"></a><span id="l8.89" class="difflineminus">-  {</span>
<a href="#l8.90"></a><span id="l8.90" class="difflineplus">+  enableAutocomplete() {</span>
<a href="#l8.91"></a><span id="l8.91">     var acLDAPPref = document.getElementById(&quot;ldap_2.autoComplete.useDirectory&quot;)</span>
<a href="#l8.92"></a><span id="l8.92">                              .value;</span>
<a href="#l8.93"></a><span id="l8.93"> </span>
<a href="#l8.94"></a><span id="l8.94">     this.enableElement(document.getElementById(&quot;directoriesList&quot;), acLDAPPref);</span>
<a href="#l8.95"></a><span id="l8.95">     this.enableElement(document.getElementById(&quot;editButton&quot;), acLDAPPref);</span>
<a href="#l8.96"></a><span id="l8.96">   },</span>
<a href="#l8.97"></a><span id="l8.97"> </span>
<a href="#l8.98"></a><span id="l8.98" class="difflineminus">-  editDirectories: function()</span>
<a href="#l8.99"></a><span id="l8.99" class="difflineminus">-  {</span>
<a href="#l8.100"></a><span id="l8.100" class="difflineplus">+  editDirectories() {</span>
<a href="#l8.101"></a><span id="l8.101">     gSubDialog.open(&quot;chrome://messenger/content/addressbook/pref-editdirectories.xul&quot;);</span>
<a href="#l8.102"></a><span id="l8.102">   },</span>
<a href="#l8.103"></a><span id="l8.103"> </span>
<a href="#l8.104"></a><span id="l8.104" class="difflineminus">-  initAbDefaultStartupDir: function() {</span>
<a href="#l8.105"></a><span id="l8.105" class="difflineplus">+  initAbDefaultStartupDir() {</span>
<a href="#l8.106"></a><span id="l8.106">     if (!this.startupDirListener.inited)</span>
<a href="#l8.107"></a><span id="l8.107">       this.startupDirListener.load();</span>
<a href="#l8.108"></a><span id="l8.108"> </span>
<a href="#l8.109"></a><span id="l8.109">     let dirList = document.getElementById(&quot;defaultStartupDirList&quot;);</span>
<a href="#l8.110"></a><span id="l8.110">     if (Services.prefs.getBoolPref(&quot;mail.addr_book.view.startupURIisDefault&quot;)) {</span>
<a href="#l8.111"></a><span id="l8.111">       // Some directory is the default.</span>
<a href="#l8.112"></a><span id="l8.112">       let startupURI = Services.prefs.getCharPref(&quot;mail.addr_book.view.startupURI&quot;);</span>
<a href="#l8.113"></a><span id="l8.113">       let dirItem = dirList.menupopup.querySelector('[value=&quot;' + startupURI + '&quot;]');</span>
<a href="#l8.114"></a><span id="l8.114" class="difflineat">@@ -112,32 +101,31 @@ var gComposePane = {</span>
<a href="#l8.115"></a><span id="l8.115">       else</span>
<a href="#l8.116"></a><span id="l8.116">         dirList.value = &quot;&quot;;</span>
<a href="#l8.117"></a><span id="l8.117">     } else {</span>
<a href="#l8.118"></a><span id="l8.118">       // Choose item meaning there is no default startup directory any more.</span>
<a href="#l8.119"></a><span id="l8.119">       dirList.value = &quot;&quot;;</span>
<a href="#l8.120"></a><span id="l8.120">     }</span>
<a href="#l8.121"></a><span id="l8.121">   },</span>
<a href="#l8.122"></a><span id="l8.122"> </span>
<a href="#l8.123"></a><span id="l8.123" class="difflineminus">-  setDefaultStartupDir: function(aDirURI) {</span>
<a href="#l8.124"></a><span id="l8.124" class="difflineplus">+  setDefaultStartupDir(aDirURI) {</span>
<a href="#l8.125"></a><span id="l8.125">     if (aDirURI) {</span>
<a href="#l8.126"></a><span id="l8.126">       // Some AB directory was selected. Set prefs to make this directory</span>
<a href="#l8.127"></a><span id="l8.127">       // the default view when starting up the main AB.</span>
<a href="#l8.128"></a><span id="l8.128">       Services.prefs.setCharPref(&quot;mail.addr_book.view.startupURI&quot;, aDirURI);</span>
<a href="#l8.129"></a><span id="l8.129">       Services.prefs.setBoolPref(&quot;mail.addr_book.view.startupURIisDefault&quot;, true);</span>
<a href="#l8.130"></a><span id="l8.130">     } else {</span>
<a href="#l8.131"></a><span id="l8.131">       // Set pref that there's no default startup view directory any more.</span>
<a href="#l8.132"></a><span id="l8.132">       Services.prefs.setBoolPref(&quot;mail.addr_book.view.startupURIisDefault&quot;, false);</span>
<a href="#l8.133"></a><span id="l8.133">     }</span>
<a href="#l8.134"></a><span id="l8.134">   },</span>
<a href="#l8.135"></a><span id="l8.135"> </span>
<a href="#l8.136"></a><span id="l8.136" class="difflineminus">-  initLanguageMenu: function ()</span>
<a href="#l8.137"></a><span id="l8.137" class="difflineminus">-  {</span>
<a href="#l8.138"></a><span id="l8.138" class="difflineplus">+  initLanguageMenu() {</span>
<a href="#l8.139"></a><span id="l8.139">     var languageMenuList = document.getElementById(&quot;languageMenuList&quot;);</span>
<a href="#l8.140"></a><span id="l8.140" class="difflineminus">-    this.mSpellChecker = Cc['@mozilla.org/spellchecker/engine;1'].getService(Ci.mozISpellCheckingEngine);</span>
<a href="#l8.141"></a><span id="l8.141" class="difflineplus">+    this.mSpellChecker = Cc[&quot;@mozilla.org/spellchecker/engine;1&quot;].getService(Ci.mozISpellCheckingEngine);</span>
<a href="#l8.142"></a><span id="l8.142">     var o1 = {};</span>
<a href="#l8.143"></a><span id="l8.143">     var o2 = {};</span>
<a href="#l8.144"></a><span id="l8.144"> </span>
<a href="#l8.145"></a><span id="l8.145">     // Get the list of dictionaries from</span>
<a href="#l8.146"></a><span id="l8.146">     // the spellchecker.</span>
<a href="#l8.147"></a><span id="l8.147"> </span>
<a href="#l8.148"></a><span id="l8.148">     this.mSpellChecker.getDictionaryList(o1, o2);</span>
<a href="#l8.149"></a><span id="l8.149"> </span>
<a href="#l8.150"></a><span id="l8.150" class="difflineat">@@ -162,77 +150,72 @@ var gComposePane = {</span>
<a href="#l8.151"></a><span id="l8.151"> </span>
<a href="#l8.152"></a><span id="l8.152">     // append the dictionaries to the menu list...</span>
<a href="#l8.153"></a><span id="l8.153">     for (var i = 0; i &lt; count; i++)</span>
<a href="#l8.154"></a><span id="l8.154">       languageMenuList.appendItem(sortedList[i].label, sortedList[i].id);</span>
<a href="#l8.155"></a><span id="l8.155"> </span>
<a href="#l8.156"></a><span id="l8.156">     languageMenuList.setInitialSelection();</span>
<a href="#l8.157"></a><span id="l8.157">   },</span>
<a href="#l8.158"></a><span id="l8.158"> </span>
<a href="#l8.159"></a><span id="l8.159" class="difflineminus">-  populateFonts: function()</span>
<a href="#l8.160"></a><span id="l8.160" class="difflineminus">-  {</span>
<a href="#l8.161"></a><span id="l8.161" class="difflineplus">+  populateFonts() {</span>
<a href="#l8.162"></a><span id="l8.162">     var fontsList = document.getElementById(&quot;FontSelect&quot;);</span>
<a href="#l8.163"></a><span id="l8.163" class="difflineminus">-    try</span>
<a href="#l8.164"></a><span id="l8.164" class="difflineminus">-    {</span>
<a href="#l8.165"></a><span id="l8.165" class="difflineplus">+    try {</span>
<a href="#l8.166"></a><span id="l8.166">       var enumerator = Cc[&quot;@mozilla.org/gfx/fontenumerator;1&quot;]</span>
<a href="#l8.167"></a><span id="l8.167">                          .getService(Ci.nsIFontEnumerator);</span>
<a href="#l8.168"></a><span id="l8.168" class="difflineminus">-      var localFontCount = { value: 0 }</span>
<a href="#l8.169"></a><span id="l8.169" class="difflineplus">+      var localFontCount = { value: 0 };</span>
<a href="#l8.170"></a><span id="l8.170">       var localFonts = enumerator.EnumerateAllFonts(localFontCount);</span>
<a href="#l8.171"></a><span id="l8.171" class="difflineminus">-      for (var i = 0; i &lt; localFonts.length; ++i)</span>
<a href="#l8.172"></a><span id="l8.172" class="difflineminus">-      {</span>
<a href="#l8.173"></a><span id="l8.173" class="difflineplus">+      for (var i = 0; i &lt; localFonts.length; ++i) {</span>
<a href="#l8.174"></a><span id="l8.174">         // Remove Linux system generic fonts that collide with CSS generic fonts.</span>
<a href="#l8.175"></a><span id="l8.175">         if (localFonts[i] != &quot;&quot; &amp;&amp; localFonts[i] != &quot;serif&quot; &amp;&amp;</span>
<a href="#l8.176"></a><span id="l8.176">             localFonts[i] != &quot;sans-serif&quot; &amp;&amp; localFonts[i] != &quot;monospace&quot;)</span>
<a href="#l8.177"></a><span id="l8.177">           fontsList.appendItem(localFonts[i], localFonts[i]);</span>
<a href="#l8.178"></a><span id="l8.178">       }</span>
<a href="#l8.179"></a><span id="l8.179" class="difflineminus">-    }</span>
<a href="#l8.180"></a><span id="l8.180" class="difflineminus">-    catch(e) { }</span>
<a href="#l8.181"></a><span id="l8.181" class="difflineplus">+    } catch (e) { }</span>
<a href="#l8.182"></a><span id="l8.182">     // Choose the item after the list is completely generated.</span>
<a href="#l8.183"></a><span id="l8.183">     var preference = document.getElementById(fontsList.getAttribute(&quot;preference&quot;));</span>
<a href="#l8.184"></a><span id="l8.184">     fontsList.value = preference.value;</span>
<a href="#l8.185"></a><span id="l8.185">   },</span>
<a href="#l8.186"></a><span id="l8.186"> </span>
<a href="#l8.187"></a><span id="l8.187" class="difflineminus">-   restoreHTMLDefaults: function()</span>
<a href="#l8.188"></a><span id="l8.188" class="difflineminus">-   {</span>
<a href="#l8.189"></a><span id="l8.189" class="difflineplus">+   restoreHTMLDefaults() {</span>
<a href="#l8.190"></a><span id="l8.190">      // reset throws an exception if the pref value is already the default so</span>
<a href="#l8.191"></a><span id="l8.191">      // work around that with some try/catch exception handling</span>
<a href="#l8.192"></a><span id="l8.192">      try {</span>
<a href="#l8.193"></a><span id="l8.193" class="difflineminus">-       document.getElementById('msgcompose.font_face').reset();</span>
<a href="#l8.194"></a><span id="l8.194" class="difflineplus">+       document.getElementById(&quot;msgcompose.font_face&quot;).reset();</span>
<a href="#l8.195"></a><span id="l8.195">      } catch (ex) {}</span>
<a href="#l8.196"></a><span id="l8.196"> </span>
<a href="#l8.197"></a><span id="l8.197">      try {</span>
<a href="#l8.198"></a><span id="l8.198" class="difflineminus">-       document.getElementById('msgcompose.font_size').reset();</span>
<a href="#l8.199"></a><span id="l8.199" class="difflineplus">+       document.getElementById(&quot;msgcompose.font_size&quot;).reset();</span>
<a href="#l8.200"></a><span id="l8.200">      } catch (ex) {}</span>
<a href="#l8.201"></a><span id="l8.201"> </span>
<a href="#l8.202"></a><span id="l8.202">      try {</span>
<a href="#l8.203"></a><span id="l8.203" class="difflineminus">-       document.getElementById('msgcompose.text_color').reset();</span>
<a href="#l8.204"></a><span id="l8.204" class="difflineplus">+       document.getElementById(&quot;msgcompose.text_color&quot;).reset();</span>
<a href="#l8.205"></a><span id="l8.205">      } catch (ex) {}</span>
<a href="#l8.206"></a><span id="l8.206"> </span>
<a href="#l8.207"></a><span id="l8.207">      try {</span>
<a href="#l8.208"></a><span id="l8.208" class="difflineminus">-       document.getElementById('msgcompose.background_color').reset();</span>
<a href="#l8.209"></a><span id="l8.209" class="difflineplus">+       document.getElementById(&quot;msgcompose.background_color&quot;).reset();</span>
<a href="#l8.210"></a><span id="l8.210">      } catch (ex) {}</span>
<a href="#l8.211"></a><span id="l8.211">   },</span>
<a href="#l8.212"></a><span id="l8.212"> </span>
<a href="#l8.213"></a><span id="l8.213">   startupDirListener: {</span>
<a href="#l8.214"></a><span id="l8.214">     inited: false,</span>
<a href="#l8.215"></a><span id="l8.215">     domain: &quot;mail.addr_book.view.startupURI&quot;,</span>
<a href="#l8.216"></a><span id="l8.216" class="difflineminus">-    observe: function(subject, topic, prefName) {</span>
<a href="#l8.217"></a><span id="l8.217" class="difflineplus">+    observe(subject, topic, prefName) {</span>
<a href="#l8.218"></a><span id="l8.218">       if (topic != &quot;nsPref:changed&quot;)</span>
<a href="#l8.219"></a><span id="l8.219">         return;</span>
<a href="#l8.220"></a><span id="l8.220"> </span>
<a href="#l8.221"></a><span id="l8.221">       // If the default startup directory prefs have changed,</span>
<a href="#l8.222"></a><span id="l8.222">       // reinitialize the default startup dir picker to show the new value.</span>
<a href="#l8.223"></a><span id="l8.223">       gComposePane.initAbDefaultStartupDir();</span>
<a href="#l8.224"></a><span id="l8.224">     },</span>
<a href="#l8.225"></a><span id="l8.225" class="difflineminus">-    load: function() {</span>
<a href="#l8.226"></a><span id="l8.226" class="difflineplus">+    load() {</span>
<a href="#l8.227"></a><span id="l8.227">       // Observe changes of our prefs.</span>
<a href="#l8.228"></a><span id="l8.228">       Services.prefs.addObserver(this.domain, this);</span>
<a href="#l8.229"></a><span id="l8.229">       // Unload the pref observer when preferences window is closed.</span>
<a href="#l8.230"></a><span id="l8.230">       window.addEventListener(&quot;unload&quot;, this.unload, true);</span>
<a href="#l8.231"></a><span id="l8.231">       this.inited = true;</span>
<a href="#l8.232"></a><span id="l8.232">     },</span>
<a href="#l8.233"></a><span id="l8.233"> </span>
<a href="#l8.234"></a><span id="l8.234" class="difflineminus">-    unload: function(event) {</span>
<a href="#l8.235"></a><span id="l8.235" class="difflineplus">+    unload(event) {</span>
<a href="#l8.236"></a><span id="l8.236">       Services.prefs.removeObserver(gComposePane.startupDirListener.domain,</span>
<a href="#l8.237"></a><span id="l8.237">                                     gComposePane.startupDirListener);</span>
<a href="#l8.238"></a><span id="l8.238" class="difflineminus">-    }</span>
<a href="#l8.239"></a><span id="l8.239" class="difflineminus">-  }</span>
<a href="#l8.240"></a><span id="l8.240" class="difflineplus">+    },</span>
<a href="#l8.241"></a><span id="l8.241" class="difflineplus">+  },</span>
<a href="#l8.242"></a><span id="l8.242"> };</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l9.1"></a><span id="l9.1" class="difflineminus">--- a/mail/components/preferences/connection.js</span>
<a href="#l9.2"></a><span id="l9.2" class="difflineplus">+++ b/mail/components/preferences/connection.js</span>
<a href="#l9.3"></a><span id="l9.3" class="difflineat">@@ -1,18 +1,17 @@</span>
<a href="#l9.4"></a><span id="l9.4"> /* -*- Mode: Javascript; tab-width: 2; indent-tabs-mode: nil; c-basic-offset: 2 -*-</span>
<a href="#l9.5"></a><span id="l9.5">  * This Source Code Form is subject to the terms of the Mozilla Public</span>
<a href="#l9.6"></a><span id="l9.6">  * License, v. 2.0. If a copy of the MPL was not distributed with this</span>
<a href="#l9.7"></a><span id="l9.7">  * file, You can obtain one at http://mozilla.org/MPL/2.0/. */</span>
<a href="#l9.8"></a><span id="l9.8"> </span>
<a href="#l9.9"></a><span id="l9.9"> ChromeUtils.import(&quot;resource://gre/modules/Services.jsm&quot;);</span>
<a href="#l9.10"></a><span id="l9.10"> </span>
<a href="#l9.11"></a><span id="l9.11"> var gConnectionsDialog = {</span>
<a href="#l9.12"></a><span id="l9.12" class="difflineminus">-  beforeAccept: function ()</span>
<a href="#l9.13"></a><span id="l9.13" class="difflineminus">-  {</span>
<a href="#l9.14"></a><span id="l9.14" class="difflineplus">+  beforeAccept() {</span>
<a href="#l9.15"></a><span id="l9.15">     var proxyTypePref = document.getElementById(&quot;network.proxy.type&quot;);</span>
<a href="#l9.16"></a><span id="l9.16">     if (proxyTypePref.value == 2) {</span>
<a href="#l9.17"></a><span id="l9.17">       this.doAutoconfigURLFixup();</span>
<a href="#l9.18"></a><span id="l9.18">       return true;</span>
<a href="#l9.19"></a><span id="l9.19">     }</span>
<a href="#l9.20"></a><span id="l9.20"> </span>
<a href="#l9.21"></a><span id="l9.21">     if (proxyTypePref.value != 1)</span>
<a href="#l9.22"></a><span id="l9.22">       return true;</span>
<a href="#l9.23"></a><span id="l9.23" class="difflineat">@@ -30,29 +29,27 @@ var gConnectionsDialog = {</span>
<a href="#l9.24"></a><span id="l9.24">         backupServerURLPref.value = proxyServerURLPref.value;</span>
<a href="#l9.25"></a><span id="l9.25">         backupPortPref.value = proxyPortPref.value;</span>
<a href="#l9.26"></a><span id="l9.26">         proxyServerURLPref.value = httpProxyURLPref.value;</span>
<a href="#l9.27"></a><span id="l9.27">         proxyPortPref.value = httpProxyPortPref.value;</span>
<a href="#l9.28"></a><span id="l9.28">       }</span>
<a href="#l9.29"></a><span id="l9.29">     }</span>
<a href="#l9.30"></a><span id="l9.30"> </span>
<a href="#l9.31"></a><span id="l9.31">     var noProxiesPref = document.getElementById(&quot;network.proxy.no_proxies_on&quot;);</span>
<a href="#l9.32"></a><span id="l9.32" class="difflineminus">-    noProxiesPref.value = noProxiesPref.value.replace(/[;]/g,',');</span>
<a href="#l9.33"></a><span id="l9.33" class="difflineplus">+    noProxiesPref.value = noProxiesPref.value.replace(/[;]/g, &quot;,&quot;);</span>
<a href="#l9.34"></a><span id="l9.34"> </span>
<a href="#l9.35"></a><span id="l9.35">     return true;</span>
<a href="#l9.36"></a><span id="l9.36">   },</span>
<a href="#l9.37"></a><span id="l9.37"> </span>
<a href="#l9.38"></a><span id="l9.38" class="difflineminus">-  checkForSystemProxy: function ()</span>
<a href="#l9.39"></a><span id="l9.39" class="difflineminus">-  {</span>
<a href="#l9.40"></a><span id="l9.40" class="difflineplus">+  checkForSystemProxy() {</span>
<a href="#l9.41"></a><span id="l9.41">     if (&quot;@mozilla.org/system-proxy-settings;1&quot; in Cc)</span>
<a href="#l9.42"></a><span id="l9.42">       document.getElementById(&quot;systemPref&quot;).removeAttribute(&quot;hidden&quot;);</span>
<a href="#l9.43"></a><span id="l9.43">   },</span>
<a href="#l9.44"></a><span id="l9.44"> </span>
<a href="#l9.45"></a><span id="l9.45" class="difflineminus">-  proxyTypeChanged: function ()</span>
<a href="#l9.46"></a><span id="l9.46" class="difflineminus">-  {</span>
<a href="#l9.47"></a><span id="l9.47" class="difflineplus">+  proxyTypeChanged() {</span>
<a href="#l9.48"></a><span id="l9.48">     var proxyTypePref = document.getElementById(&quot;network.proxy.type&quot;);</span>
<a href="#l9.49"></a><span id="l9.49"> </span>
<a href="#l9.50"></a><span id="l9.50">     // Update http</span>
<a href="#l9.51"></a><span id="l9.51">     var httpProxyURLPref = document.getElementById(&quot;network.proxy.http&quot;);</span>
<a href="#l9.52"></a><span id="l9.52">     httpProxyURLPref.disabled = proxyTypePref.value != 1;</span>
<a href="#l9.53"></a><span id="l9.53">     var httpProxyPortPref = document.getElementById(&quot;network.proxy.http_port&quot;);</span>
<a href="#l9.54"></a><span id="l9.54">     httpProxyPortPref.disabled = proxyTypePref.value != 1;</span>
<a href="#l9.55"></a><span id="l9.55"> </span>
<a href="#l9.56"></a><span id="l9.56" class="difflineat">@@ -66,18 +63,17 @@ var gConnectionsDialog = {</span>
<a href="#l9.57"></a><span id="l9.57">     noProxiesPref.disabled = proxyTypePref.value != 1;</span>
<a href="#l9.58"></a><span id="l9.58"> </span>
<a href="#l9.59"></a><span id="l9.59">     var autoconfigURLPref = document.getElementById(&quot;network.proxy.autoconfig_url&quot;);</span>
<a href="#l9.60"></a><span id="l9.60">     autoconfigURLPref.disabled = proxyTypePref.value != 2;</span>
<a href="#l9.61"></a><span id="l9.61"> </span>
<a href="#l9.62"></a><span id="l9.62">     this.updateReloadButton();</span>
<a href="#l9.63"></a><span id="l9.63">   },</span>
<a href="#l9.64"></a><span id="l9.64"> </span>
<a href="#l9.65"></a><span id="l9.65" class="difflineminus">-  updateReloadButton: function ()</span>
<a href="#l9.66"></a><span id="l9.66" class="difflineminus">-  {</span>
<a href="#l9.67"></a><span id="l9.67" class="difflineplus">+  updateReloadButton() {</span>
<a href="#l9.68"></a><span id="l9.68">     // Disable the &quot;Reload PAC&quot; button if the selected proxy type is not PAC or</span>
<a href="#l9.69"></a><span id="l9.69">     // if the current value of the PAC textbox does not match the value stored</span>
<a href="#l9.70"></a><span id="l9.70">     // in prefs.  Likewise, disable the reload button if PAC is not configured</span>
<a href="#l9.71"></a><span id="l9.71">     // in prefs.</span>
<a href="#l9.72"></a><span id="l9.72"> </span>
<a href="#l9.73"></a><span id="l9.73">     var typedURL = document.getElementById(&quot;networkProxyAutoconfigURL&quot;).value;</span>
<a href="#l9.74"></a><span id="l9.74">     var proxyTypeCur = document.getElementById(&quot;network.proxy.type&quot;).value;</span>
<a href="#l9.75"></a><span id="l9.75"> </span>
<a href="#l9.76"></a><span id="l9.76" class="difflineat">@@ -85,24 +81,22 @@ var gConnectionsDialog = {</span>
<a href="#l9.77"></a><span id="l9.77">     var proxyType = Services.prefs.getIntPref(&quot;network.proxy.type&quot;);</span>
<a href="#l9.78"></a><span id="l9.78"> </span>
<a href="#l9.79"></a><span id="l9.79">     var disableReloadPref =</span>
<a href="#l9.80"></a><span id="l9.80">         document.getElementById(&quot;pref.advanced.proxies.disable_button.reload&quot;);</span>
<a href="#l9.81"></a><span id="l9.81">     disableReloadPref.disabled =</span>
<a href="#l9.82"></a><span id="l9.82">         (proxyTypeCur != 2 || proxyType != 2 || typedURL != pacURL);</span>
<a href="#l9.83"></a><span id="l9.83">   },</span>
<a href="#l9.84"></a><span id="l9.84"> </span>
<a href="#l9.85"></a><span id="l9.85" class="difflineminus">-  readProxyType: function ()</span>
<a href="#l9.86"></a><span id="l9.86" class="difflineminus">-  {</span>
<a href="#l9.87"></a><span id="l9.87" class="difflineplus">+  readProxyType() {</span>
<a href="#l9.88"></a><span id="l9.88">     this.proxyTypeChanged();</span>
<a href="#l9.89"></a><span id="l9.89">     return undefined;</span>
<a href="#l9.90"></a><span id="l9.90">   },</span>
<a href="#l9.91"></a><span id="l9.91"> </span>
<a href="#l9.92"></a><span id="l9.92" class="difflineminus">-  updateProtocolPrefs: function ()</span>
<a href="#l9.93"></a><span id="l9.93" class="difflineminus">-  {</span>
<a href="#l9.94"></a><span id="l9.94" class="difflineplus">+  updateProtocolPrefs() {</span>
<a href="#l9.95"></a><span id="l9.95">     var proxyTypePref = document.getElementById(&quot;network.proxy.type&quot;);</span>
<a href="#l9.96"></a><span id="l9.96">     var shareProxiesPref = document.getElementById(&quot;network.proxy.share_proxy_settings&quot;);</span>
<a href="#l9.97"></a><span id="l9.97">     var proxyPrefs = [&quot;ssl&quot;, &quot;socks&quot;];</span>
<a href="#l9.98"></a><span id="l9.98">     for (var i = 0; i &lt; proxyPrefs.length; ++i) {</span>
<a href="#l9.99"></a><span id="l9.99">       var proxyServerURLPref = document.getElementById(&quot;network.proxy.&quot; + proxyPrefs[i]);</span>
<a href="#l9.100"></a><span id="l9.100">       var proxyPortPref = document.getElementById(&quot;network.proxy.&quot; + proxyPrefs[i] + &quot;_port&quot;);</span>
<a href="#l9.101"></a><span id="l9.101"> </span>
<a href="#l9.102"></a><span id="l9.102">       // Restore previous per-proxy custom settings, if present.</span>
<a href="#l9.103"></a><span id="l9.103" class="difflineat">@@ -125,53 +119,48 @@ var gConnectionsDialog = {</span>
<a href="#l9.104"></a><span id="l9.104">       proxyPortPref.disabled = proxyServerURLPref.disabled;</span>
<a href="#l9.105"></a><span id="l9.105">     }</span>
<a href="#l9.106"></a><span id="l9.106">     var socksVersionPref = document.getElementById(&quot;network.proxy.socks_version&quot;);</span>
<a href="#l9.107"></a><span id="l9.107">     socksVersionPref.disabled = proxyTypePref.value != 1 || shareProxiesPref.value;</span>
<a href="#l9.108"></a><span id="l9.108"> </span>
<a href="#l9.109"></a><span id="l9.109">     return undefined;</span>
<a href="#l9.110"></a><span id="l9.110">   },</span>
<a href="#l9.111"></a><span id="l9.111"> </span>
<a href="#l9.112"></a><span id="l9.112" class="difflineminus">-  readProxyProtocolPref: function (aProtocol, aIsPort)</span>
<a href="#l9.113"></a><span id="l9.113" class="difflineminus">-  {</span>
<a href="#l9.114"></a><span id="l9.114" class="difflineplus">+  readProxyProtocolPref(aProtocol, aIsPort) {</span>
<a href="#l9.115"></a><span id="l9.115">     var shareProxiesPref = document.getElementById(&quot;network.proxy.share_proxy_settings&quot;);</span>
<a href="#l9.116"></a><span id="l9.116">     if (shareProxiesPref.value) {</span>
<a href="#l9.117"></a><span id="l9.117">       var pref = document.getElementById(&quot;network.proxy.http&quot; + (aIsPort ? &quot;_port&quot; : &quot;&quot;));</span>
<a href="#l9.118"></a><span id="l9.118">       return pref.value;</span>
<a href="#l9.119"></a><span id="l9.119">     }</span>
<a href="#l9.120"></a><span id="l9.120"> </span>
<a href="#l9.121"></a><span id="l9.121">     var backupPref = document.getElementById(&quot;network.proxy.backup.&quot; + aProtocol + (aIsPort ? &quot;_port&quot; : &quot;&quot;));</span>
<a href="#l9.122"></a><span id="l9.122">     return backupPref.hasUserValue ? backupPref.value : undefined;</span>
<a href="#l9.123"></a><span id="l9.123">   },</span>
<a href="#l9.124"></a><span id="l9.124"> </span>
<a href="#l9.125"></a><span id="l9.125" class="difflineminus">-  reloadPAC: function ()</span>
<a href="#l9.126"></a><span id="l9.126" class="difflineminus">-  {</span>
<a href="#l9.127"></a><span id="l9.127" class="difflineplus">+  reloadPAC() {</span>
<a href="#l9.128"></a><span id="l9.128">     Cc[&quot;@mozilla.org/network/protocol-proxy-service;1&quot;].</span>
<a href="#l9.129"></a><span id="l9.129">         getService().reloadPAC();</span>
<a href="#l9.130"></a><span id="l9.130">   },</span>
<a href="#l9.131"></a><span id="l9.131"> </span>
<a href="#l9.132"></a><span id="l9.132" class="difflineminus">-  doAutoconfigURLFixup: function ()</span>
<a href="#l9.133"></a><span id="l9.133" class="difflineminus">-  {</span>
<a href="#l9.134"></a><span id="l9.134" class="difflineplus">+  doAutoconfigURLFixup() {</span>
<a href="#l9.135"></a><span id="l9.135">     var autoURL = document.getElementById(&quot;networkProxyAutoconfigURL&quot;);</span>
<a href="#l9.136"></a><span id="l9.136">     var autoURLPref = document.getElementById(&quot;network.proxy.autoconfig_url&quot;);</span>
<a href="#l9.137"></a><span id="l9.137">     try {</span>
<a href="#l9.138"></a><span id="l9.138">       autoURLPref.value = autoURL.value = Services.uriFixup.createFixupURI(autoURL.value, 0).spec;</span>
<a href="#l9.139"></a><span id="l9.139" class="difflineminus">-    } catch(ex) {}</span>
<a href="#l9.140"></a><span id="l9.140" class="difflineplus">+    } catch (ex) {}</span>
<a href="#l9.141"></a><span id="l9.141">   },</span>
<a href="#l9.142"></a><span id="l9.142"> </span>
<a href="#l9.143"></a><span id="l9.143" class="difflineminus">-  readHTTPProxyServer: function ()</span>
<a href="#l9.144"></a><span id="l9.144" class="difflineminus">-  {</span>
<a href="#l9.145"></a><span id="l9.145" class="difflineplus">+  readHTTPProxyServer() {</span>
<a href="#l9.146"></a><span id="l9.146">     var shareProxiesPref = document.getElementById(&quot;network.proxy.share_proxy_settings&quot;);</span>
<a href="#l9.147"></a><span id="l9.147">     if (shareProxiesPref.value)</span>
<a href="#l9.148"></a><span id="l9.148">       this.updateProtocolPrefs();</span>
<a href="#l9.149"></a><span id="l9.149">     return undefined;</span>
<a href="#l9.150"></a><span id="l9.150">   },</span>
<a href="#l9.151"></a><span id="l9.151"> </span>
<a href="#l9.152"></a><span id="l9.152" class="difflineminus">-  readHTTPProxyPort: function ()</span>
<a href="#l9.153"></a><span id="l9.153" class="difflineminus">-  {</span>
<a href="#l9.154"></a><span id="l9.154" class="difflineplus">+  readHTTPProxyPort() {</span>
<a href="#l9.155"></a><span id="l9.155">     var shareProxiesPref = document.getElementById(&quot;network.proxy.share_proxy_settings&quot;);</span>
<a href="#l9.156"></a><span id="l9.156">     if (shareProxiesPref.value)</span>
<a href="#l9.157"></a><span id="l9.157">       this.updateProtocolPrefs();</span>
<a href="#l9.158"></a><span id="l9.158">     return undefined;</span>
<a href="#l9.159"></a><span id="l9.159">   },</span>
<a href="#l9.160"></a><span id="l9.160"> </span>
<a href="#l9.161"></a><span id="l9.161">   isDnsOverHttpsEnabled() {</span>
<a href="#l9.162"></a><span id="l9.162">     // values outside 1:4 are considered falsey/disabled in this context</span>
<a href="#l9.163"></a><span id="l9.163" class="difflineat">@@ -196,10 +185,10 @@ var gConnectionsDialog = {</span>
<a href="#l9.164"></a><span id="l9.164">   },</span>
<a href="#l9.165"></a><span id="l9.165"> </span>
<a href="#l9.166"></a><span id="l9.166">   writeDnsOverHttpsUri() {</span>
<a href="#l9.167"></a><span id="l9.167">     // called to update pref with user input</span>
<a href="#l9.168"></a><span id="l9.168">     let input = document.getElementById(&quot;networkDnsOverHttpsUrl&quot;);</span>
<a href="#l9.169"></a><span id="l9.169">     let uriString = input.value.trim();</span>
<a href="#l9.170"></a><span id="l9.170">     // turn an empty string into `undefined` to clear the pref back to the default</span>
<a href="#l9.171"></a><span id="l9.171">     return uriString.length ? uriString : undefined;</span>
<a href="#l9.172"></a><span id="l9.172" class="difflineminus">-  }</span>
<a href="#l9.173"></a><span id="l9.173" class="difflineplus">+  },</span>
<a href="#l9.174"></a><span id="l9.174"> };</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l10.1"></a><span id="l10.1" class="difflineminus">--- a/mail/components/preferences/cookies.js</span>
<a href="#l10.2"></a><span id="l10.2" class="difflineplus">+++ b/mail/components/preferences/cookies.js</span>
<a href="#l10.3"></a><span id="l10.3" class="difflineat">@@ -4,112 +4,100 @@</span>
<a href="#l10.4"></a><span id="l10.4">  * file, You can obtain one at http://mozilla.org/MPL/2.0/. */</span>
<a href="#l10.5"></a><span id="l10.5"> </span>
<a href="#l10.6"></a><span id="l10.6"> ChromeUtils.import(&quot;resource://gre/modules/Services.jsm&quot;);</span>
<a href="#l10.7"></a><span id="l10.7"> ChromeUtils.import(&quot;resource://gre/modules/PluralForm.jsm&quot;);</span>
<a href="#l10.8"></a><span id="l10.8"> </span>
<a href="#l10.9"></a><span id="l10.9"> var nsICookie = Ci.nsICookie;</span>
<a href="#l10.10"></a><span id="l10.10"> </span>
<a href="#l10.11"></a><span id="l10.11"> var gCookiesWindow = {</span>
<a href="#l10.12"></a><span id="l10.12" class="difflineminus">-  _hosts            : {},</span>
<a href="#l10.13"></a><span id="l10.13" class="difflineminus">-  _hostOrder        : [],</span>
<a href="#l10.14"></a><span id="l10.14" class="difflineminus">-  _tree             : null,</span>
<a href="#l10.15"></a><span id="l10.15" class="difflineminus">-  _bundle           : null,</span>
<a href="#l10.16"></a><span id="l10.16" class="difflineplus">+  _hosts: {},</span>
<a href="#l10.17"></a><span id="l10.17" class="difflineplus">+  _hostOrder: [],</span>
<a href="#l10.18"></a><span id="l10.18" class="difflineplus">+  _tree: null,</span>
<a href="#l10.19"></a><span id="l10.19" class="difflineplus">+  _bundle: null,</span>
<a href="#l10.20"></a><span id="l10.20"> </span>
<a href="#l10.21"></a><span id="l10.21" class="difflineminus">-  init: function ()</span>
<a href="#l10.22"></a><span id="l10.22" class="difflineminus">-  {</span>
<a href="#l10.23"></a><span id="l10.23" class="difflineplus">+  init() {</span>
<a href="#l10.24"></a><span id="l10.24">     Services.obs.addObserver(this, &quot;cookie-changed&quot;);</span>
<a href="#l10.25"></a><span id="l10.25">     Services.obs.addObserver(this, &quot;perm-changed&quot;);</span>
<a href="#l10.26"></a><span id="l10.26"> </span>
<a href="#l10.27"></a><span id="l10.27">     this._bundle = document.getElementById(&quot;bundlePreferences&quot;);</span>
<a href="#l10.28"></a><span id="l10.28">     this._tree = document.getElementById(&quot;cookiesList&quot;);</span>
<a href="#l10.29"></a><span id="l10.29"> </span>
<a href="#l10.30"></a><span id="l10.30">     this._populateList(true);</span>
<a href="#l10.31"></a><span id="l10.31"> </span>
<a href="#l10.32"></a><span id="l10.32">     document.getElementById(&quot;filter&quot;).focus();</span>
<a href="#l10.33"></a><span id="l10.33"> </span>
<a href="#l10.34"></a><span id="l10.34">     if (!Services.prefs.getBoolPref(&quot;privacy.userContext.enabled&quot;)) {</span>
<a href="#l10.35"></a><span id="l10.35">       document.getElementById(&quot;userContextRow&quot;).hidden = true;</span>
<a href="#l10.36"></a><span id="l10.36">     }</span>
<a href="#l10.37"></a><span id="l10.37">   },</span>
<a href="#l10.38"></a><span id="l10.38"> </span>
<a href="#l10.39"></a><span id="l10.39" class="difflineminus">-  uninit: function ()</span>
<a href="#l10.40"></a><span id="l10.40" class="difflineminus">-  {</span>
<a href="#l10.41"></a><span id="l10.41" class="difflineplus">+  uninit() {</span>
<a href="#l10.42"></a><span id="l10.42">     Services.obs.removeObserver(this, &quot;cookie-changed&quot;);</span>
<a href="#l10.43"></a><span id="l10.43">     Services.obs.removeObserver(this, &quot;perm-changed&quot;);</span>
<a href="#l10.44"></a><span id="l10.44">   },</span>
<a href="#l10.45"></a><span id="l10.45"> </span>
<a href="#l10.46"></a><span id="l10.46" class="difflineminus">-  _populateList: function (aInitialLoad)</span>
<a href="#l10.47"></a><span id="l10.47" class="difflineminus">-  {</span>
<a href="#l10.48"></a><span id="l10.48" class="difflineplus">+  _populateList(aInitialLoad) {</span>
<a href="#l10.49"></a><span id="l10.49">     this._loadCookies();</span>
<a href="#l10.50"></a><span id="l10.50">     this._tree.treeBoxObject.view = this._view;</span>
<a href="#l10.51"></a><span id="l10.51">     if (aInitialLoad)</span>
<a href="#l10.52"></a><span id="l10.52">       this.sort(&quot;rawHost&quot;);</span>
<a href="#l10.53"></a><span id="l10.53">     if (this._view.rowCount &gt; 0)</span>
<a href="#l10.54"></a><span id="l10.54">       this._tree.view.selection.select(0);</span>
<a href="#l10.55"></a><span id="l10.55"> </span>
<a href="#l10.56"></a><span id="l10.56">     if (aInitialLoad) {</span>
<a href="#l10.57"></a><span id="l10.57">       if ((&quot;arguments&quot; in window) &amp;&amp; window.arguments[2] &amp;&amp;</span>
<a href="#l10.58"></a><span id="l10.58" class="difflineminus">-          window.arguments[2].filterString)</span>
<a href="#l10.59"></a><span id="l10.59" class="difflineminus">-      {</span>
<a href="#l10.60"></a><span id="l10.60" class="difflineplus">+          window.arguments[2].filterString) {</span>
<a href="#l10.61"></a><span id="l10.61">         this.setFilter(window.arguments[2].filterString);</span>
<a href="#l10.62"></a><span id="l10.62">       }</span>
<a href="#l10.63"></a><span id="l10.63" class="difflineminus">-    }</span>
<a href="#l10.64"></a><span id="l10.64" class="difflineminus">-    else {</span>
<a href="#l10.65"></a><span id="l10.65" class="difflineminus">-      if (document.getElementById(&quot;filter&quot;).value != &quot;&quot;)</span>
<a href="#l10.66"></a><span id="l10.66" class="difflineplus">+    } else if (document.getElementById(&quot;filter&quot;).value != &quot;&quot;)</span>
<a href="#l10.67"></a><span id="l10.67">         this.filter();</span>
<a href="#l10.68"></a><span id="l10.68" class="difflineminus">-    }</span>
<a href="#l10.69"></a><span id="l10.69"> </span>
<a href="#l10.70"></a><span id="l10.70">     this._saveState();</span>
<a href="#l10.71"></a><span id="l10.71">   },</span>
<a href="#l10.72"></a><span id="l10.72"> </span>
<a href="#l10.73"></a><span id="l10.73" class="difflineminus">-  _cookieEquals: function (aCookieA, aCookieB, aStrippedHost)</span>
<a href="#l10.74"></a><span id="l10.74" class="difflineminus">-  {</span>
<a href="#l10.75"></a><span id="l10.75" class="difflineplus">+  _cookieEquals(aCookieA, aCookieB, aStrippedHost) {</span>
<a href="#l10.76"></a><span id="l10.76">     return aCookieA.rawHost == aStrippedHost &amp;&amp;</span>
<a href="#l10.77"></a><span id="l10.77">            aCookieA.name == aCookieB.name &amp;&amp;</span>
<a href="#l10.78"></a><span id="l10.78">            aCookieA.path == aCookieB.path &amp;&amp;</span>
<a href="#l10.79"></a><span id="l10.79">            !ChromeUtils.compareOriginAttributes(aCookieA.originAttributes,</span>
<a href="#l10.80"></a><span id="l10.80">                                                 aCookieB.originAttributes);</span>
<a href="#l10.81"></a><span id="l10.81">   },</span>
<a href="#l10.82"></a><span id="l10.82"> </span>
<a href="#l10.83"></a><span id="l10.83" class="difflineminus">-  observe: function (aCookie, aTopic, aData)</span>
<a href="#l10.84"></a><span id="l10.84" class="difflineminus">-  {</span>
<a href="#l10.85"></a><span id="l10.85" class="difflineplus">+  observe(aCookie, aTopic, aData) {</span>
<a href="#l10.86"></a><span id="l10.86">     if (aTopic != &quot;cookie-changed&quot;)</span>
<a href="#l10.87"></a><span id="l10.87">       return;</span>
<a href="#l10.88"></a><span id="l10.88"> </span>
<a href="#l10.89"></a><span id="l10.89">     if (aCookie instanceof Ci.nsICookie) {</span>
<a href="#l10.90"></a><span id="l10.90">       var strippedHost = this._makeStrippedHost(aCookie.host);</span>
<a href="#l10.91"></a><span id="l10.91">       if (aData == &quot;changed&quot;)</span>
<a href="#l10.92"></a><span id="l10.92">         this._handleCookieChanged(aCookie, strippedHost);</span>
<a href="#l10.93"></a><span id="l10.93">       else if (aData == &quot;added&quot;)</span>
<a href="#l10.94"></a><span id="l10.94">         this._handleCookieAdded(aCookie, strippedHost);</span>
<a href="#l10.95"></a><span id="l10.95" class="difflineminus">-    }</span>
<a href="#l10.96"></a><span id="l10.96" class="difflineminus">-    else if (aData == &quot;cleared&quot;) {</span>
<a href="#l10.97"></a><span id="l10.97" class="difflineplus">+    } else if (aData == &quot;cleared&quot;) {</span>
<a href="#l10.98"></a><span id="l10.98">       this._hosts = {};</span>
<a href="#l10.99"></a><span id="l10.99">       this._hostOrder = [];</span>
<a href="#l10.100"></a><span id="l10.100"> </span>
<a href="#l10.101"></a><span id="l10.101">       var oldRowCount = this._view._rowCount;</span>
<a href="#l10.102"></a><span id="l10.102">       this._view._rowCount = 0;</span>
<a href="#l10.103"></a><span id="l10.103">       this._tree.treeBoxObject.rowCountChanged(0, -oldRowCount);</span>
<a href="#l10.104"></a><span id="l10.104">       this._view.selection.clearSelection();</span>
<a href="#l10.105"></a><span id="l10.105" class="difflineminus">-    }</span>
<a href="#l10.106"></a><span id="l10.106" class="difflineminus">-    else if (aData == &quot;reload&quot;) {</span>
<a href="#l10.107"></a><span id="l10.107" class="difflineplus">+    } else if (aData == &quot;reload&quot;) {</span>
<a href="#l10.108"></a><span id="l10.108">       // first, clear any existing entries</span>
<a href="#l10.109"></a><span id="l10.109">       this.observe(aCookie, aTopic, &quot;cleared&quot;);</span>
<a href="#l10.110"></a><span id="l10.110"> </span>
<a href="#l10.111"></a><span id="l10.111">       // then, reload the list</span>
<a href="#l10.112"></a><span id="l10.112">       this._populateList(false);</span>
<a href="#l10.113"></a><span id="l10.113">     }</span>
<a href="#l10.114"></a><span id="l10.114"> </span>
<a href="#l10.115"></a><span id="l10.115">     // We don't yet handle aData == &quot;deleted&quot; - it's a less common case</span>
<a href="#l10.116"></a><span id="l10.116">     // and is rather complicated as selection tracking is difficult</span>
<a href="#l10.117"></a><span id="l10.117">   },</span>
<a href="#l10.118"></a><span id="l10.118"> </span>
<a href="#l10.119"></a><span id="l10.119" class="difflineminus">-  _handleCookieChanged: function (changedCookie, strippedHost)</span>
<a href="#l10.120"></a><span id="l10.120" class="difflineminus">-  {</span>
<a href="#l10.121"></a><span id="l10.121" class="difflineplus">+  _handleCookieChanged(changedCookie, strippedHost) {</span>
<a href="#l10.122"></a><span id="l10.122">     var rowIndex = 0;</span>
<a href="#l10.123"></a><span id="l10.123">     var cookieItem = null;</span>
<a href="#l10.124"></a><span id="l10.124">     if (!this._view._filtered) {</span>
<a href="#l10.125"></a><span id="l10.125">       for (var i = 0; i &lt; this._hostOrder.length; ++i) { // (var host in this._hosts) {</span>
<a href="#l10.126"></a><span id="l10.126">         ++rowIndex;</span>
<a href="#l10.127"></a><span id="l10.127">         var hostItem = this._hosts[this._hostOrder[i]]; // var hostItem = this._hosts[host];</span>
<a href="#l10.128"></a><span id="l10.128">         if (this._hostOrder[i] == strippedHost) { // host == strippedHost) {</span>
<a href="#l10.129"></a><span id="l10.129">           // Host matches, look for the cookie within this Host collection</span>
<a href="#l10.130"></a><span id="l10.130" class="difflineat">@@ -121,22 +109,20 @@ var gCookiesWindow = {</span>
<a href="#l10.131"></a><span id="l10.131">               currCookie.value    = changedCookie.value;</span>
<a href="#l10.132"></a><span id="l10.132">               currCookie.isSecure = changedCookie.isSecure;</span>
<a href="#l10.133"></a><span id="l10.133">               currCookie.isDomain = changedCookie.isDomain;</span>
<a href="#l10.134"></a><span id="l10.134">               currCookie.expires  = changedCookie.expires;</span>
<a href="#l10.135"></a><span id="l10.135">               cookieItem = currCookie;</span>
<a href="#l10.136"></a><span id="l10.136">               break;</span>
<a href="#l10.137"></a><span id="l10.137">             }</span>
<a href="#l10.138"></a><span id="l10.138">           }</span>
<a href="#l10.139"></a><span id="l10.139" class="difflineminus">-        }</span>
<a href="#l10.140"></a><span id="l10.140" class="difflineminus">-        else if (hostItem.open)</span>
<a href="#l10.141"></a><span id="l10.141" class="difflineplus">+        } else if (hostItem.open)</span>
<a href="#l10.142"></a><span id="l10.142">           rowIndex += hostItem.cookies.length;</span>
<a href="#l10.143"></a><span id="l10.143">       }</span>
<a href="#l10.144"></a><span id="l10.144" class="difflineminus">-    }</span>
<a href="#l10.145"></a><span id="l10.145" class="difflineminus">-    else {</span>
<a href="#l10.146"></a><span id="l10.146" class="difflineplus">+    } else {</span>
<a href="#l10.147"></a><span id="l10.147">       // Just walk the filter list to find the item. It doesn't matter that</span>
<a href="#l10.148"></a><span id="l10.148">       // we don't update the main Host collection when we do this, because</span>
<a href="#l10.149"></a><span id="l10.149">       // when the filter is reset the Host collection is rebuilt anyway.</span>
<a href="#l10.150"></a><span id="l10.150">       for (rowIndex = 0; rowIndex &lt; this._view._filterSet.length; ++rowIndex) {</span>
<a href="#l10.151"></a><span id="l10.151">         currCookie = this._view._filterSet[rowIndex];</span>
<a href="#l10.152"></a><span id="l10.152">         if (this._cookieEquals(currCookie, changedCookie, strippedHost)) {</span>
<a href="#l10.153"></a><span id="l10.153">           currCookie.value    = changedCookie.value;</span>
<a href="#l10.154"></a><span id="l10.154">           currCookie.isSecure = changedCookie.isSecure;</span>
<a href="#l10.155"></a><span id="l10.155" class="difflineat">@@ -150,29 +136,27 @@ var gCookiesWindow = {</span>
<a href="#l10.156"></a><span id="l10.156"> </span>
<a href="#l10.157"></a><span id="l10.157">     // Make sure the tree display is up to date...</span>
<a href="#l10.158"></a><span id="l10.158">     this._tree.treeBoxObject.invalidateRow(rowIndex);</span>
<a href="#l10.159"></a><span id="l10.159">     // ... and if the cookie is selected, update the displayed metadata too</span>
<a href="#l10.160"></a><span id="l10.160">     if (cookieItem != null &amp;&amp; this._view.selection.currentIndex == rowIndex)</span>
<a href="#l10.161"></a><span id="l10.161">       this._updateCookieData(cookieItem);</span>
<a href="#l10.162"></a><span id="l10.162">   },</span>
<a href="#l10.163"></a><span id="l10.163"> </span>
<a href="#l10.164"></a><span id="l10.164" class="difflineminus">-  _handleCookieAdded: function (changedCookie, strippedHost)</span>
<a href="#l10.165"></a><span id="l10.165" class="difflineminus">-  {</span>
<a href="#l10.166"></a><span id="l10.166" class="difflineplus">+  _handleCookieAdded(changedCookie, strippedHost) {</span>
<a href="#l10.167"></a><span id="l10.167">     var rowCountImpact = 0;</span>
<a href="#l10.168"></a><span id="l10.168">     var addedHost = { value: 0 };</span>
<a href="#l10.169"></a><span id="l10.169">     this._addCookie(strippedHost, changedCookie, addedHost);</span>
<a href="#l10.170"></a><span id="l10.170">     if (!this._view._filtered) {</span>
<a href="#l10.171"></a><span id="l10.171">       // The Host collection for this cookie already exists, and it's not open,</span>
<a href="#l10.172"></a><span id="l10.172">       // so don't increment the rowCountImpact becaues the user is not going to</span>
<a href="#l10.173"></a><span id="l10.173">       // see the additional rows as they're hidden.</span>
<a href="#l10.174"></a><span id="l10.174">       if (addedHost.value || this._hosts[strippedHost].open)</span>
<a href="#l10.175"></a><span id="l10.175">         ++rowCountImpact;</span>
<a href="#l10.176"></a><span id="l10.176" class="difflineminus">-    }</span>
<a href="#l10.177"></a><span id="l10.177" class="difflineminus">-    else {</span>
<a href="#l10.178"></a><span id="l10.178" class="difflineplus">+    } else {</span>
<a href="#l10.179"></a><span id="l10.179">       // We're in search mode, and the cookie being added matches</span>
<a href="#l10.180"></a><span id="l10.180">       // the search condition, so add it to the list.</span>
<a href="#l10.181"></a><span id="l10.181">       var c = this._makeCookieObject(strippedHost, changedCookie);</span>
<a href="#l10.182"></a><span id="l10.182">       if (this._cookieMatchesFilter(c)) {</span>
<a href="#l10.183"></a><span id="l10.183">         this._view._filterSet.push(this._makeCookieObject(strippedHost, changedCookie));</span>
<a href="#l10.184"></a><span id="l10.184">         ++rowCountImpact;</span>
<a href="#l10.185"></a><span id="l10.185">       }</span>
<a href="#l10.186"></a><span id="l10.186">     }</span>
<a href="#l10.187"></a><span id="l10.187" class="difflineat">@@ -181,86 +165,81 @@ var gCookiesWindow = {</span>
<a href="#l10.188"></a><span id="l10.188">     var oldRowCount = this._rowCount;</span>
<a href="#l10.189"></a><span id="l10.189">     this._view._rowCount += rowCountImpact;</span>
<a href="#l10.190"></a><span id="l10.190">     this._tree.treeBoxObject.rowCountChanged(oldRowCount - 1, rowCountImpact);</span>
<a href="#l10.191"></a><span id="l10.191"> </span>
<a href="#l10.192"></a><span id="l10.192">     document.getElementById(&quot;removeAllCookies&quot;).disabled = this._view._filtered;</span>
<a href="#l10.193"></a><span id="l10.193">   },</span>
<a href="#l10.194"></a><span id="l10.194"> </span>
<a href="#l10.195"></a><span id="l10.195">   _view: {</span>
<a href="#l10.196"></a><span id="l10.196" class="difflineminus">-    _filtered   : false,</span>
<a href="#l10.197"></a><span id="l10.197" class="difflineminus">-    _filterSet  : [],</span>
<a href="#l10.198"></a><span id="l10.198" class="difflineplus">+    _filtered: false,</span>
<a href="#l10.199"></a><span id="l10.199" class="difflineplus">+    _filterSet: [],</span>
<a href="#l10.200"></a><span id="l10.200">     _filterValue: &quot;&quot;,</span>
<a href="#l10.201"></a><span id="l10.201" class="difflineminus">-    _rowCount   : 0,</span>
<a href="#l10.202"></a><span id="l10.202" class="difflineminus">-    _cacheValid : 0,</span>
<a href="#l10.203"></a><span id="l10.203" class="difflineminus">-    _cacheItems : [],</span>
<a href="#l10.204"></a><span id="l10.204" class="difflineminus">-    get rowCount()</span>
<a href="#l10.205"></a><span id="l10.205" class="difflineminus">-    {</span>
<a href="#l10.206"></a><span id="l10.206" class="difflineplus">+    _rowCount: 0,</span>
<a href="#l10.207"></a><span id="l10.207" class="difflineplus">+    _cacheValid: 0,</span>
<a href="#l10.208"></a><span id="l10.208" class="difflineplus">+    _cacheItems: [],</span>
<a href="#l10.209"></a><span id="l10.209" class="difflineplus">+    get rowCount() {</span>
<a href="#l10.210"></a><span id="l10.210">       return this._rowCount;</span>
<a href="#l10.211"></a><span id="l10.211">     },</span>
<a href="#l10.212"></a><span id="l10.212"> </span>
<a href="#l10.213"></a><span id="l10.213" class="difflineminus">-    _getItemAtIndex: function (aIndex)</span>
<a href="#l10.214"></a><span id="l10.214" class="difflineminus">-    {</span>
<a href="#l10.215"></a><span id="l10.215" class="difflineplus">+    _getItemAtIndex(aIndex) {</span>
<a href="#l10.216"></a><span id="l10.216">       if (this._filtered)</span>
<a href="#l10.217"></a><span id="l10.217">         return this._filterSet[aIndex];</span>
<a href="#l10.218"></a><span id="l10.218"> </span>
<a href="#l10.219"></a><span id="l10.219">       var start = 0;</span>
<a href="#l10.220"></a><span id="l10.220">       var count = 0, hostIndex = 0;</span>
<a href="#l10.221"></a><span id="l10.221"> </span>
<a href="#l10.222"></a><span id="l10.222">       var cacheIndex = Math.min(this._cacheValid, aIndex);</span>
<a href="#l10.223"></a><span id="l10.223">       if (cacheIndex &gt; 0) {</span>
<a href="#l10.224"></a><span id="l10.224">         var cacheItem = this._cacheItems[cacheIndex];</span>
<a href="#l10.225"></a><span id="l10.225" class="difflineminus">-        start = cacheItem['start'];</span>
<a href="#l10.226"></a><span id="l10.226" class="difflineminus">-        count = hostIndex = cacheItem['count'];</span>
<a href="#l10.227"></a><span id="l10.227" class="difflineplus">+        start = cacheItem.start;</span>
<a href="#l10.228"></a><span id="l10.228" class="difflineplus">+        count = hostIndex = cacheItem.count;</span>
<a href="#l10.229"></a><span id="l10.229">       }</span>
<a href="#l10.230"></a><span id="l10.230"> </span>
<a href="#l10.231"></a><span id="l10.231">       for (var i = start; i &lt; gCookiesWindow._hostOrder.length; ++i) { // var host in gCookiesWindow._hosts) {</span>
<a href="#l10.232"></a><span id="l10.232">         var currHost = gCookiesWindow._hosts[gCookiesWindow._hostOrder[i]]; // gCookiesWindow._hosts[host];</span>
<a href="#l10.233"></a><span id="l10.233">         if (!currHost) continue;</span>
<a href="#l10.234"></a><span id="l10.234">         if (count == aIndex)</span>
<a href="#l10.235"></a><span id="l10.235">           return currHost;</span>
<a href="#l10.236"></a><span id="l10.236">         hostIndex = count;</span>
<a href="#l10.237"></a><span id="l10.237"> </span>
<a href="#l10.238"></a><span id="l10.238" class="difflineminus">-        var cacheEntry = { 'start' : i, 'count' : count };</span>
<a href="#l10.239"></a><span id="l10.239" class="difflineplus">+        var cacheEntry = { &quot;start&quot;: i, &quot;count&quot;: count };</span>
<a href="#l10.240"></a><span id="l10.240">         var cacheStart = count;</span>
<a href="#l10.241"></a><span id="l10.241"> </span>
<a href="#l10.242"></a><span id="l10.242">         if (currHost.open) {</span>
<a href="#l10.243"></a><span id="l10.243">           if (count &lt; aIndex &amp;&amp; aIndex &lt;= (count + currHost.cookies.length)) {</span>
<a href="#l10.244"></a><span id="l10.244">             // We are looking for an entry within this host's children,</span>
<a href="#l10.245"></a><span id="l10.245">             // enumerate them looking for the index.</span>
<a href="#l10.246"></a><span id="l10.246">             ++count;</span>
<a href="#l10.247"></a><span id="l10.247">             for (var i = 0; i &lt; currHost.cookies.length; ++i) {</span>
<a href="#l10.248"></a><span id="l10.248">               if (count == aIndex) {</span>
<a href="#l10.249"></a><span id="l10.249">                 var cookie = currHost.cookies[i];</span>
<a href="#l10.250"></a><span id="l10.250">                 cookie.parentIndex = hostIndex;</span>
<a href="#l10.251"></a><span id="l10.251">                 return cookie;</span>
<a href="#l10.252"></a><span id="l10.252">               }</span>
<a href="#l10.253"></a><span id="l10.253">               ++count;</span>
<a href="#l10.254"></a><span id="l10.254">             }</span>
<a href="#l10.255"></a><span id="l10.255" class="difflineminus">-          }</span>
<a href="#l10.256"></a><span id="l10.256" class="difflineminus">-          else {</span>
<a href="#l10.257"></a><span id="l10.257" class="difflineplus">+          } else {</span>
<a href="#l10.258"></a><span id="l10.258">             // A host entry was open, but we weren't looking for an index</span>
<a href="#l10.259"></a><span id="l10.259">             // within that host entry's children, so skip forward over the</span>
<a href="#l10.260"></a><span id="l10.260">             // entry's children. We need to add one to increment for the</span>
<a href="#l10.261"></a><span id="l10.261">             // host value too.</span>
<a href="#l10.262"></a><span id="l10.262">             count += currHost.cookies.length + 1;</span>
<a href="#l10.263"></a><span id="l10.263">           }</span>
<a href="#l10.264"></a><span id="l10.264" class="difflineminus">-        }</span>
<a href="#l10.265"></a><span id="l10.265" class="difflineminus">-        else</span>
<a href="#l10.266"></a><span id="l10.266" class="difflineplus">+        } else</span>
<a href="#l10.267"></a><span id="l10.267">           ++count;</span>
<a href="#l10.268"></a><span id="l10.268"> </span>
<a href="#l10.269"></a><span id="l10.269">         for (var j = cacheStart; j &lt; count; j++)</span>
<a href="#l10.270"></a><span id="l10.270">           this._cacheItems[j] = cacheEntry;</span>
<a href="#l10.271"></a><span id="l10.271">         this._cacheValid = count - 1;</span>
<a href="#l10.272"></a><span id="l10.272">       }</span>
<a href="#l10.273"></a><span id="l10.273">       return null;</span>
<a href="#l10.274"></a><span id="l10.274">     },</span>
<a href="#l10.275"></a><span id="l10.275"> </span>
<a href="#l10.276"></a><span id="l10.276" class="difflineminus">-    _removeItemAtIndex: function (aIndex, aCount)</span>
<a href="#l10.277"></a><span id="l10.277" class="difflineminus">-    {</span>
<a href="#l10.278"></a><span id="l10.278" class="difflineplus">+    _removeItemAtIndex(aIndex, aCount) {</span>
<a href="#l10.279"></a><span id="l10.279">       var removeCount = aCount === undefined ? 1 : aCount;</span>
<a href="#l10.280"></a><span id="l10.280">       if (this._filtered) {</span>
<a href="#l10.281"></a><span id="l10.281">         // remove the cookies from the unfiltered set so that they</span>
<a href="#l10.282"></a><span id="l10.282">         // don't reappear when the filter is changed. See bug 410863.</span>
<a href="#l10.283"></a><span id="l10.283">         for (var i = aIndex; i &lt; aIndex + removeCount; ++i) {</span>
<a href="#l10.284"></a><span id="l10.284">           var item = this._filterSet[i];</span>
<a href="#l10.285"></a><span id="l10.285">           var parent = gCookiesWindow._hosts[item.rawHost];</span>
<a href="#l10.286"></a><span id="l10.286">           for (var j = 0; j &lt; parent.cookies.length; ++j) {</span>
<a href="#l10.287"></a><span id="l10.287" class="difflineat">@@ -289,93 +268,83 @@ var gCookiesWindow = {</span>
<a href="#l10.288"></a><span id="l10.288">               !ChromeUtils.compareOriginAttributes(item.originAttributes,</span>
<a href="#l10.289"></a><span id="l10.289">                                                    cookie.originAttributes)) {</span>
<a href="#l10.290"></a><span id="l10.290">             parent.cookies.splice(i, removeCount);</span>
<a href="#l10.291"></a><span id="l10.291">           }</span>
<a href="#l10.292"></a><span id="l10.292">         }</span>
<a href="#l10.293"></a><span id="l10.293">       }</span>
<a href="#l10.294"></a><span id="l10.294">     },</span>
<a href="#l10.295"></a><span id="l10.295"> </span>
<a href="#l10.296"></a><span id="l10.296" class="difflineminus">-    _invalidateCache: function (aIndex)</span>
<a href="#l10.297"></a><span id="l10.297" class="difflineminus">-    {</span>
<a href="#l10.298"></a><span id="l10.298" class="difflineplus">+    _invalidateCache(aIndex) {</span>
<a href="#l10.299"></a><span id="l10.299">       this._cacheValid = Math.min(this._cacheValid, aIndex);</span>
<a href="#l10.300"></a><span id="l10.300">     },</span>
<a href="#l10.301"></a><span id="l10.301"> </span>
<a href="#l10.302"></a><span id="l10.302" class="difflineminus">-    getCellText: function (aIndex, aColumn)</span>
<a href="#l10.303"></a><span id="l10.303" class="difflineminus">-    {</span>
<a href="#l10.304"></a><span id="l10.304" class="difflineplus">+    getCellText(aIndex, aColumn) {</span>
<a href="#l10.305"></a><span id="l10.305">       if (!this._filtered) {</span>
<a href="#l10.306"></a><span id="l10.306">         var item = this._getItemAtIndex(aIndex);</span>
<a href="#l10.307"></a><span id="l10.307">         if (!item)</span>
<a href="#l10.308"></a><span id="l10.308">           return &quot;&quot;;</span>
<a href="#l10.309"></a><span id="l10.309">         if (aColumn.id == &quot;domainCol&quot;)</span>
<a href="#l10.310"></a><span id="l10.310">           return item.rawHost;</span>
<a href="#l10.311"></a><span id="l10.311">         else if (aColumn.id == &quot;nameCol&quot;)</span>
<a href="#l10.312"></a><span id="l10.312">           return (&quot;name&quot; in item) ? item.name : &quot;&quot;;</span>
<a href="#l10.313"></a><span id="l10.313" class="difflineminus">-      }</span>
<a href="#l10.314"></a><span id="l10.314" class="difflineminus">-      else {</span>
<a href="#l10.315"></a><span id="l10.315" class="difflineminus">-        if (aColumn.id == &quot;domainCol&quot;)</span>
<a href="#l10.316"></a><span id="l10.316" class="difflineplus">+      } else if (aColumn.id == &quot;domainCol&quot;)</span>
<a href="#l10.317"></a><span id="l10.317">           return this._filterSet[aIndex].rawHost;</span>
<a href="#l10.318"></a><span id="l10.318">         else if (aColumn.id == &quot;nameCol&quot;)</span>
<a href="#l10.319"></a><span id="l10.319">           return (&quot;name&quot; in this._filterSet[aIndex]) ? this._filterSet[aIndex].name : &quot;&quot;;</span>
<a href="#l10.320"></a><span id="l10.320" class="difflineminus">-      }</span>
<a href="#l10.321"></a><span id="l10.321">       return &quot;&quot;;</span>
<a href="#l10.322"></a><span id="l10.322">     },</span>
<a href="#l10.323"></a><span id="l10.323"> </span>
<a href="#l10.324"></a><span id="l10.324">     _selection: null,</span>
<a href="#l10.325"></a><span id="l10.325" class="difflineminus">-    get selection () { return this._selection; },</span>
<a href="#l10.326"></a><span id="l10.326" class="difflineminus">-    set selection (val) { this._selection = val; return val; },</span>
<a href="#l10.327"></a><span id="l10.327" class="difflineminus">-    getRowProperties: function (aRow) { return &quot;&quot;; },</span>
<a href="#l10.328"></a><span id="l10.328" class="difflineminus">-    getCellProperties: function (aRow, aColumn) { return &quot;&quot;; },</span>
<a href="#l10.329"></a><span id="l10.329" class="difflineminus">-    getColumnProperties: function (aColumn) { return &quot;&quot;; },</span>
<a href="#l10.330"></a><span id="l10.330" class="difflineminus">-    isContainer: function (aIndex)</span>
<a href="#l10.331"></a><span id="l10.331" class="difflineminus">-    {</span>
<a href="#l10.332"></a><span id="l10.332" class="difflineplus">+    get selection() { return this._selection; },</span>
<a href="#l10.333"></a><span id="l10.333" class="difflineplus">+    set selection(val) { this._selection = val; return val; },</span>
<a href="#l10.334"></a><span id="l10.334" class="difflineplus">+    getRowProperties(aRow) { return &quot;&quot;; },</span>
<a href="#l10.335"></a><span id="l10.335" class="difflineplus">+    getCellProperties(aRow, aColumn) { return &quot;&quot;; },</span>
<a href="#l10.336"></a><span id="l10.336" class="difflineplus">+    getColumnProperties(aColumn) { return &quot;&quot;; },</span>
<a href="#l10.337"></a><span id="l10.337" class="difflineplus">+    isContainer(aIndex) {</span>
<a href="#l10.338"></a><span id="l10.338">       if (!this._filtered) {</span>
<a href="#l10.339"></a><span id="l10.339">         var item = this._getItemAtIndex(aIndex);</span>
<a href="#l10.340"></a><span id="l10.340">         if (!item) return false;</span>
<a href="#l10.341"></a><span id="l10.341">         return item.container;</span>
<a href="#l10.342"></a><span id="l10.342">       }</span>
<a href="#l10.343"></a><span id="l10.343">       return false;</span>
<a href="#l10.344"></a><span id="l10.344">     },</span>
<a href="#l10.345"></a><span id="l10.345" class="difflineminus">-    isContainerOpen: function (aIndex)</span>
<a href="#l10.346"></a><span id="l10.346" class="difflineminus">-    {</span>
<a href="#l10.347"></a><span id="l10.347" class="difflineplus">+    isContainerOpen(aIndex) {</span>
<a href="#l10.348"></a><span id="l10.348">       if (!this._filtered) {</span>
<a href="#l10.349"></a><span id="l10.349">         var item = this._getItemAtIndex(aIndex);</span>
<a href="#l10.350"></a><span id="l10.350">         if (!item) return false;</span>
<a href="#l10.351"></a><span id="l10.351">         return item.open;</span>
<a href="#l10.352"></a><span id="l10.352">       }</span>
<a href="#l10.353"></a><span id="l10.353">       return false;</span>
<a href="#l10.354"></a><span id="l10.354">     },</span>
<a href="#l10.355"></a><span id="l10.355" class="difflineminus">-    isContainerEmpty: function (aIndex)</span>
<a href="#l10.356"></a><span id="l10.356" class="difflineminus">-    {</span>
<a href="#l10.357"></a><span id="l10.357" class="difflineplus">+    isContainerEmpty(aIndex) {</span>
<a href="#l10.358"></a><span id="l10.358">       if (!this._filtered) {</span>
<a href="#l10.359"></a><span id="l10.359">         var item = this._getItemAtIndex(aIndex);</span>
<a href="#l10.360"></a><span id="l10.360">         if (!item) return false;</span>
<a href="#l10.361"></a><span id="l10.361">         return item.cookies.length == 0;</span>
<a href="#l10.362"></a><span id="l10.362">       }</span>
<a href="#l10.363"></a><span id="l10.363">       return false;</span>
<a href="#l10.364"></a><span id="l10.364">     },</span>
<a href="#l10.365"></a><span id="l10.365" class="difflineminus">-    isSeparator: function (aIndex) { return false; },</span>
<a href="#l10.366"></a><span id="l10.366" class="difflineminus">-    isSorted: function (aIndex) { return false; },</span>
<a href="#l10.367"></a><span id="l10.367" class="difflineminus">-    canDrop: function (aIndex, aOrientation) { return false; },</span>
<a href="#l10.368"></a><span id="l10.368" class="difflineminus">-    drop: function (aIndex, aOrientation) {},</span>
<a href="#l10.369"></a><span id="l10.369" class="difflineminus">-    getParentIndex: function (aIndex)</span>
<a href="#l10.370"></a><span id="l10.370" class="difflineminus">-    {</span>
<a href="#l10.371"></a><span id="l10.371" class="difflineplus">+    isSeparator(aIndex) { return false; },</span>
<a href="#l10.372"></a><span id="l10.372" class="difflineplus">+    isSorted(aIndex) { return false; },</span>
<a href="#l10.373"></a><span id="l10.373" class="difflineplus">+    canDrop(aIndex, aOrientation) { return false; },</span>
<a href="#l10.374"></a><span id="l10.374" class="difflineplus">+    drop(aIndex, aOrientation) {},</span>
<a href="#l10.375"></a><span id="l10.375" class="difflineplus">+    getParentIndex(aIndex) {</span>
<a href="#l10.376"></a><span id="l10.376">       if (!this._filtered) {</span>
<a href="#l10.377"></a><span id="l10.377">         var item = this._getItemAtIndex(aIndex);</span>
<a href="#l10.378"></a><span id="l10.378">         // If an item has no parent index (i.e. it is at the top level) this</span>
<a href="#l10.379"></a><span id="l10.379">         // function MUST return -1 otherwise we will go into an infinite loop.</span>
<a href="#l10.380"></a><span id="l10.380">         // Containers are always top level items in the cookies tree, so make</span>
<a href="#l10.381"></a><span id="l10.381">         // sure to return the appropriate value here.</span>
<a href="#l10.382"></a><span id="l10.382">         if (!item || item.container) return -1;</span>
<a href="#l10.383"></a><span id="l10.383">         return item.parentIndex;</span>
<a href="#l10.384"></a><span id="l10.384">       }</span>
<a href="#l10.385"></a><span id="l10.385">       return -1;</span>
<a href="#l10.386"></a><span id="l10.386">     },</span>
<a href="#l10.387"></a><span id="l10.387" class="difflineminus">-    hasNextSibling: function (aParentIndex, aIndex)</span>
<a href="#l10.388"></a><span id="l10.388" class="difflineminus">-    {</span>
<a href="#l10.389"></a><span id="l10.389" class="difflineplus">+    hasNextSibling(aParentIndex, aIndex) {</span>
<a href="#l10.390"></a><span id="l10.390">       if (!this._filtered) {</span>
<a href="#l10.391"></a><span id="l10.391">         // |aParentIndex| appears to be bogus, but we can get the real</span>
<a href="#l10.392"></a><span id="l10.392">         // parent index by getting the entry for |aIndex| and reading the</span>
<a href="#l10.393"></a><span id="l10.393">         // parentIndex field.</span>
<a href="#l10.394"></a><span id="l10.394">         // The index of the last item in this host collection is the</span>
<a href="#l10.395"></a><span id="l10.395">         // index of the parent + the size of the host collection, and</span>
<a href="#l10.396"></a><span id="l10.396">         // aIndex has a next sibling if it is less than this value.</span>
<a href="#l10.397"></a><span id="l10.397">         var item = this._getItemAtIndex(aIndex);</span>
<a href="#l10.398"></a><span id="l10.398" class="difflineat">@@ -383,189 +352,174 @@ var gCookiesWindow = {</span>
<a href="#l10.399"></a><span id="l10.399">           if (item.container) {</span>
<a href="#l10.400"></a><span id="l10.400">             for (var i = aIndex + 1; i &lt; this.rowCount; ++i) {</span>
<a href="#l10.401"></a><span id="l10.401">               var subsequent = this._getItemAtIndex(i);</span>
<a href="#l10.402"></a><span id="l10.402">               if (subsequent.container)</span>
<a href="#l10.403"></a><span id="l10.403">                 return true;</span>
<a href="#l10.404"></a><span id="l10.404">             }</span>
<a href="#l10.405"></a><span id="l10.405">             return false;</span>
<a href="#l10.406"></a><span id="l10.406">           }</span>
<a href="#l10.407"></a><span id="l10.407" class="difflineminus">-          else {</span>
<a href="#l10.408"></a><span id="l10.408">             var parent = this._getItemAtIndex(item.parentIndex);</span>
<a href="#l10.409"></a><span id="l10.409">             if (parent &amp;&amp; parent.container)</span>
<a href="#l10.410"></a><span id="l10.410">               return aIndex &lt; item.parentIndex + parent.cookies.length;</span>
<a href="#l10.411"></a><span id="l10.411" class="difflineminus">-          }</span>
<a href="#l10.412"></a><span id="l10.412" class="difflineplus">+</span>
<a href="#l10.413"></a><span id="l10.413">         }</span>
<a href="#l10.414"></a><span id="l10.414">       }</span>
<a href="#l10.415"></a><span id="l10.415">       return aIndex &lt; this.rowCount - 1;</span>
<a href="#l10.416"></a><span id="l10.416">     },</span>
<a href="#l10.417"></a><span id="l10.417" class="difflineminus">-    hasPreviousSibling: function (aIndex)</span>
<a href="#l10.418"></a><span id="l10.418" class="difflineminus">-    {</span>
<a href="#l10.419"></a><span id="l10.419" class="difflineplus">+    hasPreviousSibling(aIndex) {</span>
<a href="#l10.420"></a><span id="l10.420">       if (!this._filtered) {</span>
<a href="#l10.421"></a><span id="l10.421">         var item = this._getItemAtIndex(aIndex);</span>
<a href="#l10.422"></a><span id="l10.422">         if (!item) return false;</span>
<a href="#l10.423"></a><span id="l10.423">         var parent = this._getItemAtIndex(item.parentIndex);</span>
<a href="#l10.424"></a><span id="l10.424">         if (parent &amp;&amp; parent.container)</span>
<a href="#l10.425"></a><span id="l10.425">           return aIndex &gt; item.parentIndex + 1;</span>
<a href="#l10.426"></a><span id="l10.426">       }</span>
<a href="#l10.427"></a><span id="l10.427">       return aIndex &gt; 0;</span>
<a href="#l10.428"></a><span id="l10.428">     },</span>
<a href="#l10.429"></a><span id="l10.429" class="difflineminus">-    getLevel: function (aIndex)</span>
<a href="#l10.430"></a><span id="l10.430" class="difflineminus">-    {</span>
<a href="#l10.431"></a><span id="l10.431" class="difflineplus">+    getLevel(aIndex) {</span>
<a href="#l10.432"></a><span id="l10.432">       if (!this._filtered) {</span>
<a href="#l10.433"></a><span id="l10.433">         var item = this._getItemAtIndex(aIndex);</span>
<a href="#l10.434"></a><span id="l10.434">         if (!item) return 0;</span>
<a href="#l10.435"></a><span id="l10.435">         return item.level;</span>
<a href="#l10.436"></a><span id="l10.436">       }</span>
<a href="#l10.437"></a><span id="l10.437">       return 0;</span>
<a href="#l10.438"></a><span id="l10.438">     },</span>
<a href="#l10.439"></a><span id="l10.439" class="difflineminus">-    getImageSrc: function (aIndex, aColumn) {},</span>
<a href="#l10.440"></a><span id="l10.440" class="difflineminus">-    getProgressMode: function (aIndex, aColumn) {},</span>
<a href="#l10.441"></a><span id="l10.441" class="difflineminus">-    getCellValue: function (aIndex, aColumn) {},</span>
<a href="#l10.442"></a><span id="l10.442" class="difflineminus">-    setTree: function (aTree) {},</span>
<a href="#l10.443"></a><span id="l10.443" class="difflineminus">-    toggleOpenState: function (aIndex)</span>
<a href="#l10.444"></a><span id="l10.444" class="difflineminus">-    {</span>
<a href="#l10.445"></a><span id="l10.445" class="difflineplus">+    getImageSrc(aIndex, aColumn) {},</span>
<a href="#l10.446"></a><span id="l10.446" class="difflineplus">+    getProgressMode(aIndex, aColumn) {},</span>
<a href="#l10.447"></a><span id="l10.447" class="difflineplus">+    getCellValue(aIndex, aColumn) {},</span>
<a href="#l10.448"></a><span id="l10.448" class="difflineplus">+    setTree(aTree) {},</span>
<a href="#l10.449"></a><span id="l10.449" class="difflineplus">+    toggleOpenState(aIndex) {</span>
<a href="#l10.450"></a><span id="l10.450">       if (!this._filtered) {</span>
<a href="#l10.451"></a><span id="l10.451">         var item = this._getItemAtIndex(aIndex);</span>
<a href="#l10.452"></a><span id="l10.452">         if (!item) return;</span>
<a href="#l10.453"></a><span id="l10.453">         this._invalidateCache(aIndex);</span>
<a href="#l10.454"></a><span id="l10.454">         var multiplier = item.open ? -1 : 1;</span>
<a href="#l10.455"></a><span id="l10.455">         var delta = multiplier * item.cookies.length;</span>
<a href="#l10.456"></a><span id="l10.456">         this._rowCount += delta;</span>
<a href="#l10.457"></a><span id="l10.457">         item.open = !item.open;</span>
<a href="#l10.458"></a><span id="l10.458">         gCookiesWindow._tree.treeBoxObject.rowCountChanged(aIndex + 1, delta);</span>
<a href="#l10.459"></a><span id="l10.459">         gCookiesWindow._tree.treeBoxObject.invalidateRow(aIndex);</span>
<a href="#l10.460"></a><span id="l10.460">       }</span>
<a href="#l10.461"></a><span id="l10.461">     },</span>
<a href="#l10.462"></a><span id="l10.462" class="difflineminus">-    cycleHeader: function (aColumn) {},</span>
<a href="#l10.463"></a><span id="l10.463" class="difflineminus">-    selectionChanged: function () {},</span>
<a href="#l10.464"></a><span id="l10.464" class="difflineminus">-    cycleCell: function (aIndex, aColumn) {},</span>
<a href="#l10.465"></a><span id="l10.465" class="difflineminus">-    isEditable: function (aIndex, aColumn)</span>
<a href="#l10.466"></a><span id="l10.466" class="difflineminus">-    {</span>
<a href="#l10.467"></a><span id="l10.467" class="difflineplus">+    cycleHeader(aColumn) {},</span>
<a href="#l10.468"></a><span id="l10.468" class="difflineplus">+    selectionChanged() {},</span>
<a href="#l10.469"></a><span id="l10.469" class="difflineplus">+    cycleCell(aIndex, aColumn) {},</span>
<a href="#l10.470"></a><span id="l10.470" class="difflineplus">+    isEditable(aIndex, aColumn) {</span>
<a href="#l10.471"></a><span id="l10.471" class="difflineplus">+      return false;</span>
<a href="#l10.472"></a><span id="l10.472" class="difflineplus">+    },</span>
<a href="#l10.473"></a><span id="l10.473" class="difflineplus">+    isSelectable(aIndex, aColumn) {</span>
<a href="#l10.474"></a><span id="l10.474">       return false;</span>
<a href="#l10.475"></a><span id="l10.475">     },</span>
<a href="#l10.476"></a><span id="l10.476" class="difflineminus">-    isSelectable: function (aIndex, aColumn)</span>
<a href="#l10.477"></a><span id="l10.477" class="difflineminus">-    {</span>
<a href="#l10.478"></a><span id="l10.478" class="difflineminus">-      return false;</span>
<a href="#l10.479"></a><span id="l10.479" class="difflineminus">-    },</span>
<a href="#l10.480"></a><span id="l10.480" class="difflineminus">-    setCellValue: function (aIndex, aColumn, aValue) {},</span>
<a href="#l10.481"></a><span id="l10.481" class="difflineminus">-    setCellText: function (aIndex, aColumn, aValue) {},</span>
<a href="#l10.482"></a><span id="l10.482" class="difflineminus">-    performAction: function (aAction) {},</span>
<a href="#l10.483"></a><span id="l10.483" class="difflineminus">-    performActionOnRow: function (aAction, aIndex) {},</span>
<a href="#l10.484"></a><span id="l10.484" class="difflineminus">-    performActionOnCell: function (aAction, aindex, aColumn) {}</span>
<a href="#l10.485"></a><span id="l10.485" class="difflineplus">+    setCellValue(aIndex, aColumn, aValue) {},</span>
<a href="#l10.486"></a><span id="l10.486" class="difflineplus">+    setCellText(aIndex, aColumn, aValue) {},</span>
<a href="#l10.487"></a><span id="l10.487" class="difflineplus">+    performAction(aAction) {},</span>
<a href="#l10.488"></a><span id="l10.488" class="difflineplus">+    performActionOnRow(aAction, aIndex) {},</span>
<a href="#l10.489"></a><span id="l10.489" class="difflineplus">+    performActionOnCell(aAction, aindex, aColumn) {},</span>
<a href="#l10.490"></a><span id="l10.490">   },</span>
<a href="#l10.491"></a><span id="l10.491"> </span>
<a href="#l10.492"></a><span id="l10.492" class="difflineminus">-  _makeStrippedHost: function (aHost)</span>
<a href="#l10.493"></a><span id="l10.493" class="difflineminus">-  {</span>
<a href="#l10.494"></a><span id="l10.494" class="difflineplus">+  _makeStrippedHost(aHost) {</span>
<a href="#l10.495"></a><span id="l10.495">     let formattedHost = aHost.startsWith(&quot;.&quot;) ? aHost.substring(1, aHost.length) : aHost;</span>
<a href="#l10.496"></a><span id="l10.496">     return formattedHost.startsWith(&quot;www.&quot;) ? formattedHost.substring(4, formattedHost.length) : formattedHost;</span>
<a href="#l10.497"></a><span id="l10.497">   },</span>
<a href="#l10.498"></a><span id="l10.498"> </span>
<a href="#l10.499"></a><span id="l10.499" class="difflineminus">-  _addCookie: function (aStrippedHost, aCookie, aHostCount)</span>
<a href="#l10.500"></a><span id="l10.500" class="difflineminus">-  {</span>
<a href="#l10.501"></a><span id="l10.501" class="difflineplus">+  _addCookie(aStrippedHost, aCookie, aHostCount) {</span>
<a href="#l10.502"></a><span id="l10.502">     if (!(aStrippedHost in this._hosts) || !this._hosts[aStrippedHost]) {</span>
<a href="#l10.503"></a><span id="l10.503" class="difflineminus">-      this._hosts[aStrippedHost] = { cookies   : [],</span>
<a href="#l10.504"></a><span id="l10.504" class="difflineminus">-                                     rawHost   : aStrippedHost,</span>
<a href="#l10.505"></a><span id="l10.505" class="difflineminus">-                                     level     : 0,</span>
<a href="#l10.506"></a><span id="l10.506" class="difflineminus">-                                     open      : false,</span>
<a href="#l10.507"></a><span id="l10.507" class="difflineminus">-                                     container : true };</span>
<a href="#l10.508"></a><span id="l10.508" class="difflineplus">+      this._hosts[aStrippedHost] = { cookies: [],</span>
<a href="#l10.509"></a><span id="l10.509" class="difflineplus">+                                     rawHost: aStrippedHost,</span>
<a href="#l10.510"></a><span id="l10.510" class="difflineplus">+                                     level: 0,</span>
<a href="#l10.511"></a><span id="l10.511" class="difflineplus">+                                     open: false,</span>
<a href="#l10.512"></a><span id="l10.512" class="difflineplus">+                                     container: true };</span>
<a href="#l10.513"></a><span id="l10.513">       this._hostOrder.push(aStrippedHost);</span>
<a href="#l10.514"></a><span id="l10.514">       ++aHostCount.value;</span>
<a href="#l10.515"></a><span id="l10.515">     }</span>
<a href="#l10.516"></a><span id="l10.516"> </span>
<a href="#l10.517"></a><span id="l10.517">     var c = this._makeCookieObject(aStrippedHost, aCookie);</span>
<a href="#l10.518"></a><span id="l10.518">     this._hosts[aStrippedHost].cookies.push(c);</span>
<a href="#l10.519"></a><span id="l10.519">   },</span>
<a href="#l10.520"></a><span id="l10.520"> </span>
<a href="#l10.521"></a><span id="l10.521" class="difflineminus">-  _makeCookieObject: function (aStrippedHost, aCookie)</span>
<a href="#l10.522"></a><span id="l10.522" class="difflineminus">-  {</span>
<a href="#l10.523"></a><span id="l10.523" class="difflineplus">+  _makeCookieObject(aStrippedHost, aCookie) {</span>
<a href="#l10.524"></a><span id="l10.524">     let host = aCookie.host;</span>
<a href="#l10.525"></a><span id="l10.525">     let formattedHost = host.startsWith(&quot;.&quot;) ? host.substring(1) : host;</span>
<a href="#l10.526"></a><span id="l10.526" class="difflineminus">-    let c = { name            : aCookie.name,</span>
<a href="#l10.527"></a><span id="l10.527" class="difflineminus">-              value           : aCookie.value,</span>
<a href="#l10.528"></a><span id="l10.528" class="difflineminus">-              isDomain        : aCookie.isDomain,</span>
<a href="#l10.529"></a><span id="l10.529" class="difflineminus">-              host            : aCookie.host,</span>
<a href="#l10.530"></a><span id="l10.530" class="difflineminus">-              rawHost         : aStrippedHost,</span>
<a href="#l10.531"></a><span id="l10.531" class="difflineminus">-              path            : aCookie.path,</span>
<a href="#l10.532"></a><span id="l10.532" class="difflineminus">-              isSecure        : aCookie.isSecure,</span>
<a href="#l10.533"></a><span id="l10.533" class="difflineminus">-              expires         : aCookie.expires,</span>
<a href="#l10.534"></a><span id="l10.534" class="difflineminus">-              level           : 1,</span>
<a href="#l10.535"></a><span id="l10.535" class="difflineminus">-              container       : false,</span>
<a href="#l10.536"></a><span id="l10.536" class="difflineplus">+    let c = { name: aCookie.name,</span>
<a href="#l10.537"></a><span id="l10.537" class="difflineplus">+              value: aCookie.value,</span>
<a href="#l10.538"></a><span id="l10.538" class="difflineplus">+              isDomain: aCookie.isDomain,</span>
<a href="#l10.539"></a><span id="l10.539" class="difflineplus">+              host: aCookie.host,</span>
<a href="#l10.540"></a><span id="l10.540" class="difflineplus">+              rawHost: aStrippedHost,</span>
<a href="#l10.541"></a><span id="l10.541" class="difflineplus">+              path: aCookie.path,</span>
<a href="#l10.542"></a><span id="l10.542" class="difflineplus">+              isSecure: aCookie.isSecure,</span>
<a href="#l10.543"></a><span id="l10.543" class="difflineplus">+              expires: aCookie.expires,</span>
<a href="#l10.544"></a><span id="l10.544" class="difflineplus">+              level: 1,</span>
<a href="#l10.545"></a><span id="l10.545" class="difflineplus">+              container: false,</span>
<a href="#l10.546"></a><span id="l10.546">               originAttributes: aCookie.originAttributes };</span>
<a href="#l10.547"></a><span id="l10.547">     return c;</span>
<a href="#l10.548"></a><span id="l10.548">   },</span>
<a href="#l10.549"></a><span id="l10.549"> </span>
<a href="#l10.550"></a><span id="l10.550" class="difflineminus">-  _loadCookies: function ()</span>
<a href="#l10.551"></a><span id="l10.551" class="difflineminus">-  {</span>
<a href="#l10.552"></a><span id="l10.552" class="difflineplus">+  _loadCookies() {</span>
<a href="#l10.553"></a><span id="l10.553">     var e = Services.cookies.enumerator;</span>
<a href="#l10.554"></a><span id="l10.554">     var hostCount = { value: 0 };</span>
<a href="#l10.555"></a><span id="l10.555">     this._hosts = {};</span>
<a href="#l10.556"></a><span id="l10.556">     this._hostOrder = [];</span>
<a href="#l10.557"></a><span id="l10.557">     while (e.hasMoreElements()) {</span>
<a href="#l10.558"></a><span id="l10.558">       var cookie = e.getNext();</span>
<a href="#l10.559"></a><span id="l10.559">       if (cookie &amp;&amp; cookie instanceof Ci.nsICookie) {</span>
<a href="#l10.560"></a><span id="l10.560">         var strippedHost = this._makeStrippedHost(cookie.host);</span>
<a href="#l10.561"></a><span id="l10.561">         this._addCookie(strippedHost, cookie, hostCount);</span>
<a href="#l10.562"></a><span id="l10.562" class="difflineminus">-      }</span>
<a href="#l10.563"></a><span id="l10.563" class="difflineminus">-      else</span>
<a href="#l10.564"></a><span id="l10.564" class="difflineplus">+      } else</span>
<a href="#l10.565"></a><span id="l10.565">         break;</span>
<a href="#l10.566"></a><span id="l10.566">     }</span>
<a href="#l10.567"></a><span id="l10.567">     this._view._rowCount = hostCount.value;</span>
<a href="#l10.568"></a><span id="l10.568">   },</span>
<a href="#l10.569"></a><span id="l10.569"> </span>
<a href="#l10.570"></a><span id="l10.570" class="difflineminus">-  formatExpiresString: function (aExpires)</span>
<a href="#l10.571"></a><span id="l10.571" class="difflineminus">-  {</span>
<a href="#l10.572"></a><span id="l10.572" class="difflineplus">+  formatExpiresString(aExpires) {</span>
<a href="#l10.573"></a><span id="l10.573">     if (aExpires) {</span>
<a href="#l10.574"></a><span id="l10.574">       var date = new Date(1000 * aExpires);</span>
<a href="#l10.575"></a><span id="l10.575">       const dateTimeFormatter = new Services.intl.DateTimeFormat(undefined, {</span>
<a href="#l10.576"></a><span id="l10.576" class="difflineminus">-              dateStyle: &quot;long&quot;, timeStyle: &quot;long&quot;</span>
<a href="#l10.577"></a><span id="l10.577" class="difflineplus">+              dateStyle: &quot;long&quot;, timeStyle: &quot;long&quot;,</span>
<a href="#l10.578"></a><span id="l10.578">       });</span>
<a href="#l10.579"></a><span id="l10.579">       return dateTimeFormatter.format(date);</span>
<a href="#l10.580"></a><span id="l10.580">     }</span>
<a href="#l10.581"></a><span id="l10.581">     return this._bundle.getString(&quot;expireAtEndOfSession&quot;);</span>
<a href="#l10.582"></a><span id="l10.582">   },</span>
<a href="#l10.583"></a><span id="l10.583"> </span>
<a href="#l10.584"></a><span id="l10.584" class="difflineminus">-  _getUserContextString: function(aUserContextId) {</span>
<a href="#l10.585"></a><span id="l10.585" class="difflineplus">+  _getUserContextString(aUserContextId) {</span>
<a href="#l10.586"></a><span id="l10.586">     // Thunderbird ignores the context for now.</span>
<a href="#l10.587"></a><span id="l10.587">     return this._bundle.getString(&quot;defaultUserContextLabel&quot;);</span>
<a href="#l10.588"></a><span id="l10.588">   },</span>
<a href="#l10.589"></a><span id="l10.589"> </span>
<a href="#l10.590"></a><span id="l10.590" class="difflineminus">-  _updateCookieData: function (aItem)</span>
<a href="#l10.591"></a><span id="l10.591" class="difflineminus">-  {</span>
<a href="#l10.592"></a><span id="l10.592" class="difflineplus">+  _updateCookieData(aItem) {</span>
<a href="#l10.593"></a><span id="l10.593">     var seln = this._view.selection;</span>
<a href="#l10.594"></a><span id="l10.594">     var ids = [&quot;name&quot;, &quot;value&quot;, &quot;host&quot;, &quot;path&quot;, &quot;isSecure&quot;, &quot;expires&quot;, &quot;userContext&quot;];</span>
<a href="#l10.595"></a><span id="l10.595">     var properties;</span>
<a href="#l10.596"></a><span id="l10.596"> </span>
<a href="#l10.597"></a><span id="l10.597">     if (aItem &amp;&amp; !aItem.container &amp;&amp; seln.count &gt; 0) {</span>
<a href="#l10.598"></a><span id="l10.598">       properties = { name: aItem.name, value: aItem.value, host: aItem.host,</span>
<a href="#l10.599"></a><span id="l10.599">                      path: aItem.path, expires: this.formatExpiresString(aItem.expires),</span>
<a href="#l10.600"></a><span id="l10.600">                      isDomain: aItem.isDomain ? this._bundle.getString(&quot;domainColon&quot;)</span>
<a href="#l10.601"></a><span id="l10.601">                                               : this._bundle.getString(&quot;hostColon&quot;),</span>
<a href="#l10.602"></a><span id="l10.602">                      isSecure: aItem.isSecure ? this._bundle.getString(&quot;forSecureOnly&quot;)</span>
<a href="#l10.603"></a><span id="l10.603">                                               : this._bundle.getString(&quot;forAnyConnection&quot;),</span>
<a href="#l10.604"></a><span id="l10.604">                      userContext: this._getUserContextString(aItem.originAttributes.userContextId) };</span>
<a href="#l10.605"></a><span id="l10.605">       for (var i = 0; i &lt; ids.length; ++i) {</span>
<a href="#l10.606"></a><span id="l10.606">         document.getElementById(ids[i]).disabled = false;</span>
<a href="#l10.607"></a><span id="l10.607">       }</span>
<a href="#l10.608"></a><span id="l10.608" class="difflineminus">-    }</span>
<a href="#l10.609"></a><span id="l10.609" class="difflineminus">-    else {</span>
<a href="#l10.610"></a><span id="l10.610" class="difflineplus">+    } else {</span>
<a href="#l10.611"></a><span id="l10.611">       var noneSelected = this._bundle.getString(&quot;noCookieSelected&quot;);</span>
<a href="#l10.612"></a><span id="l10.612">       properties = { name: noneSelected, value: noneSelected, host: noneSelected,</span>
<a href="#l10.613"></a><span id="l10.613">                      path: noneSelected, expires: noneSelected,</span>
<a href="#l10.614"></a><span id="l10.614">                      isSecure: noneSelected, userContext: noneSelected };</span>
<a href="#l10.615"></a><span id="l10.615">       for (i = 0; i &lt; ids.length; ++i) {</span>
<a href="#l10.616"></a><span id="l10.616">         document.getElementById(ids[i]).disabled = true;</span>
<a href="#l10.617"></a><span id="l10.617">       }</span>
<a href="#l10.618"></a><span id="l10.618">     }</span>
<a href="#l10.619"></a><span id="l10.619">     for (var property in properties)</span>
<a href="#l10.620"></a><span id="l10.620">       document.getElementById(property).value = properties[property];</span>
<a href="#l10.621"></a><span id="l10.621">   },</span>
<a href="#l10.622"></a><span id="l10.622"> </span>
<a href="#l10.623"></a><span id="l10.623" class="difflineminus">-  onCookieSelected: function ()</span>
<a href="#l10.624"></a><span id="l10.624" class="difflineminus">-  {</span>
<a href="#l10.625"></a><span id="l10.625" class="difflineplus">+  onCookieSelected() {</span>
<a href="#l10.626"></a><span id="l10.626">     var item;</span>
<a href="#l10.627"></a><span id="l10.627">     var seln = this._tree.view.selection;</span>
<a href="#l10.628"></a><span id="l10.628">     if (!this._view._filtered)</span>
<a href="#l10.629"></a><span id="l10.629">       item = this._view._getItemAtIndex(seln.currentIndex);</span>
<a href="#l10.630"></a><span id="l10.630">     else</span>
<a href="#l10.631"></a><span id="l10.631">       item = this._view._filterSet[seln.currentIndex];</span>
<a href="#l10.632"></a><span id="l10.632"> </span>
<a href="#l10.633"></a><span id="l10.633">     this._updateCookieData(item);</span>
<a href="#l10.634"></a><span id="l10.634" class="difflineat">@@ -592,18 +546,17 @@ var gCookiesWindow = {</span>
<a href="#l10.635"></a><span id="l10.635">     let removeSelectedCookies = document.getElementById(&quot;removeSelectedCookies&quot;);</span>
<a href="#l10.636"></a><span id="l10.636">     removeSelectedCookies.label = PluralForm.get(selectedCookieCount, buttonLabel)</span>
<a href="#l10.637"></a><span id="l10.637">                                             .replace(&quot;#1&quot;, selectedCookieCount);</span>
<a href="#l10.638"></a><span id="l10.638"> </span>
<a href="#l10.639"></a><span id="l10.639">     removeSelectedCookies.disabled = !(seln.count &gt; 0);</span>
<a href="#l10.640"></a><span id="l10.640">     document.getElementById(&quot;removeAllCookies&quot;).disabled = this._view._filtered;</span>
<a href="#l10.641"></a><span id="l10.641">   },</span>
<a href="#l10.642"></a><span id="l10.642"> </span>
<a href="#l10.643"></a><span id="l10.643" class="difflineminus">-  deleteCookie: function ()</span>
<a href="#l10.644"></a><span id="l10.644" class="difflineminus">-  {</span>
<a href="#l10.645"></a><span id="l10.645" class="difflineplus">+  deleteCookie() {</span>
<a href="#l10.646"></a><span id="l10.646">     // Selection Notes</span>
<a href="#l10.647"></a><span id="l10.647">     // - Selection always moves to *NEXT* adjacent item unless item</span>
<a href="#l10.648"></a><span id="l10.648">     //   is last child at a given level in which case it moves to *PREVIOUS*</span>
<a href="#l10.649"></a><span id="l10.649">     //   item</span>
<a href="#l10.650"></a><span id="l10.650">     //</span>
<a href="#l10.651"></a><span id="l10.651">     // Selection Cases (Somewhat Complicated)</span>
<a href="#l10.652"></a><span id="l10.652">     //</span>
<a href="#l10.653"></a><span id="l10.653">     // 1) Single cookie selected, host has single child</span>
<a href="#l10.654"></a><span id="l10.654" class="difflineat">@@ -661,43 +614,40 @@ var gCookiesWindow = {</span>
<a href="#l10.655"></a><span id="l10.655">       var invalidateRow = -1;</span>
<a href="#l10.656"></a><span id="l10.656">       var item = this._view._getItemAtIndex(ci);</span>
<a href="#l10.657"></a><span id="l10.657">       if (item.container) {</span>
<a href="#l10.658"></a><span id="l10.658">         rowCountImpact -= (item.open ? item.cookies.length : 0) + 1;</span>
<a href="#l10.659"></a><span id="l10.659">         deleteItems = deleteItems.concat(item.cookies);</span>
<a href="#l10.660"></a><span id="l10.660">         if (!this._view.hasNextSibling(-1, ci))</span>
<a href="#l10.661"></a><span id="l10.661">           --nextSelected;</span>
<a href="#l10.662"></a><span id="l10.662">         this._view._removeItemAtIndex(ci);</span>
<a href="#l10.663"></a><span id="l10.663" class="difflineminus">-      }</span>
<a href="#l10.664"></a><span id="l10.664" class="difflineminus">-      else {</span>
<a href="#l10.665"></a><span id="l10.665" class="difflineplus">+      } else {</span>
<a href="#l10.666"></a><span id="l10.666">         var parent = this._view._getItemAtIndex(item.parentIndex);</span>
<a href="#l10.667"></a><span id="l10.667">         --rowCountImpact;</span>
<a href="#l10.668"></a><span id="l10.668">         if (parent.cookies.length == 1) {</span>
<a href="#l10.669"></a><span id="l10.669">           --rowCountImpact;</span>
<a href="#l10.670"></a><span id="l10.670">           deleteItems.push(item);</span>
<a href="#l10.671"></a><span id="l10.671">           if (!this._view.hasNextSibling(-1, ci))</span>
<a href="#l10.672"></a><span id="l10.672">             --nextSelected;</span>
<a href="#l10.673"></a><span id="l10.673">           if (!this._view.hasNextSibling(-1, item.parentIndex))</span>
<a href="#l10.674"></a><span id="l10.674">             --nextSelected;</span>
<a href="#l10.675"></a><span id="l10.675">           this._view._removeItemAtIndex(item.parentIndex);</span>
<a href="#l10.676"></a><span id="l10.676">           invalidateRow = item.parentIndex;</span>
<a href="#l10.677"></a><span id="l10.677" class="difflineminus">-        }</span>
<a href="#l10.678"></a><span id="l10.678" class="difflineminus">-        else {</span>
<a href="#l10.679"></a><span id="l10.679" class="difflineplus">+        } else {</span>
<a href="#l10.680"></a><span id="l10.680">           deleteItems.push(item);</span>
<a href="#l10.681"></a><span id="l10.681">           if (!this._view.hasNextSibling(-1, ci))</span>
<a href="#l10.682"></a><span id="l10.682">             --nextSelected;</span>
<a href="#l10.683"></a><span id="l10.683">           this._view._removeItemAtIndex(ci);</span>
<a href="#l10.684"></a><span id="l10.684">         }</span>
<a href="#l10.685"></a><span id="l10.685">       }</span>
<a href="#l10.686"></a><span id="l10.686">       this._view._rowCount += rowCountImpact;</span>
<a href="#l10.687"></a><span id="l10.687">       tbo.rowCountChanged(ci, rowCountImpact);</span>
<a href="#l10.688"></a><span id="l10.688">       if (invalidateRow != -1)</span>
<a href="#l10.689"></a><span id="l10.689">         tbo.invalidateRow(invalidateRow);</span>
<a href="#l10.690"></a><span id="l10.690" class="difflineminus">-    }</span>
<a href="#l10.691"></a><span id="l10.691" class="difflineminus">-    else {</span>
<a href="#l10.692"></a><span id="l10.692" class="difflineplus">+    } else {</span>
<a href="#l10.693"></a><span id="l10.693">       var rangeCount = seln.getRangeCount();</span>
<a href="#l10.694"></a><span id="l10.694">       for (var i = 0; i &lt; rangeCount; ++i) {</span>
<a href="#l10.695"></a><span id="l10.695">         var min = {}; var max = {};</span>
<a href="#l10.696"></a><span id="l10.696">         seln.getRangeAt(i, min, max);</span>
<a href="#l10.697"></a><span id="l10.697">         nextSelected = min.value;</span>
<a href="#l10.698"></a><span id="l10.698">         for (var j = min.value; j &lt;= max.value; ++j) {</span>
<a href="#l10.699"></a><span id="l10.699">           deleteItems.push(this._view._getItemAtIndex(j));</span>
<a href="#l10.700"></a><span id="l10.700">           if (!this._view.hasNextSibling(-1, max.value))</span>
<a href="#l10.701"></a><span id="l10.701" class="difflineat">@@ -724,48 +674,43 @@ var gCookiesWindow = {</span>
<a href="#l10.702"></a><span id="l10.702">     if (nextSelected &lt; 0)</span>
<a href="#l10.703"></a><span id="l10.703">       seln.clearSelection();</span>
<a href="#l10.704"></a><span id="l10.704">     else {</span>
<a href="#l10.705"></a><span id="l10.705">       seln.select(nextSelected);</span>
<a href="#l10.706"></a><span id="l10.706">       this._tree.focus();</span>
<a href="#l10.707"></a><span id="l10.707">     }</span>
<a href="#l10.708"></a><span id="l10.708">   },</span>
<a href="#l10.709"></a><span id="l10.709"> </span>
<a href="#l10.710"></a><span id="l10.710" class="difflineminus">-  deleteAllCookies: function ()</span>
<a href="#l10.711"></a><span id="l10.711" class="difflineminus">-  {</span>
<a href="#l10.712"></a><span id="l10.712" class="difflineplus">+  deleteAllCookies() {</span>
<a href="#l10.713"></a><span id="l10.713">     Services.cookies.removeAll();</span>
<a href="#l10.714"></a><span id="l10.714">     this._tree.focus();</span>
<a href="#l10.715"></a><span id="l10.715">   },</span>
<a href="#l10.716"></a><span id="l10.716"> </span>
<a href="#l10.717"></a><span id="l10.717" class="difflineminus">-  onCookieKeyPress: function (aEvent)</span>
<a href="#l10.718"></a><span id="l10.718" class="difflineminus">-  {</span>
<a href="#l10.719"></a><span id="l10.719" class="difflineplus">+  onCookieKeyPress(aEvent) {</span>
<a href="#l10.720"></a><span id="l10.720">     if (aEvent.keyCode == 46)</span>
<a href="#l10.721"></a><span id="l10.721">       this.deleteCookie();</span>
<a href="#l10.722"></a><span id="l10.722">   },</span>
<a href="#l10.723"></a><span id="l10.723"> </span>
<a href="#l10.724"></a><span id="l10.724" class="difflineminus">-  _lastSortProperty : &quot;&quot;,</span>
<a href="#l10.725"></a><span id="l10.725" class="difflineplus">+  _lastSortProperty: &quot;&quot;,</span>
<a href="#l10.726"></a><span id="l10.726">   _lastSortAscending: false,</span>
<a href="#l10.727"></a><span id="l10.727" class="difflineminus">-  sort: function (aProperty)</span>
<a href="#l10.728"></a><span id="l10.728" class="difflineminus">-  {</span>
<a href="#l10.729"></a><span id="l10.729" class="difflineplus">+  sort(aProperty) {</span>
<a href="#l10.730"></a><span id="l10.730">     var ascending = (aProperty == this._lastSortProperty) ? !this._lastSortAscending : true;</span>
<a href="#l10.731"></a><span id="l10.731"> </span>
<a href="#l10.732"></a><span id="l10.732" class="difflineminus">-    function sortByHost(a, b)</span>
<a href="#l10.733"></a><span id="l10.733" class="difflineminus">-    {</span>
<a href="#l10.734"></a><span id="l10.734" class="difflineplus">+    function sortByHost(a, b) {</span>
<a href="#l10.735"></a><span id="l10.735">       return a.toLowerCase().localeCompare(b.toLowerCase());</span>
<a href="#l10.736"></a><span id="l10.736">     }</span>
<a href="#l10.737"></a><span id="l10.737"> </span>
<a href="#l10.738"></a><span id="l10.738">     // Sort the Non-Filtered Host Collections</span>
<a href="#l10.739"></a><span id="l10.739">     if (aProperty == &quot;rawHost&quot;) {</span>
<a href="#l10.740"></a><span id="l10.740">       this._hostOrder.sort(sortByHost);</span>
<a href="#l10.741"></a><span id="l10.741">       if (!ascending)</span>
<a href="#l10.742"></a><span id="l10.742">         this._hostOrder.reverse();</span>
<a href="#l10.743"></a><span id="l10.743">     }</span>
<a href="#l10.744"></a><span id="l10.744"> </span>
<a href="#l10.745"></a><span id="l10.745" class="difflineminus">-    function sortByProperty(a, b)</span>
<a href="#l10.746"></a><span id="l10.746" class="difflineminus">-    {</span>
<a href="#l10.747"></a><span id="l10.747" class="difflineplus">+    function sortByProperty(a, b) {</span>
<a href="#l10.748"></a><span id="l10.748">       return a[aProperty].toLowerCase().localeCompare(b[aProperty].toLowerCase());</span>
<a href="#l10.749"></a><span id="l10.749">     }</span>
<a href="#l10.750"></a><span id="l10.750">     for (var host in this._hosts) {</span>
<a href="#l10.751"></a><span id="l10.751">       var cookies = this._hosts[host].cookies;</span>
<a href="#l10.752"></a><span id="l10.752">       cookies.sort(sortByProperty);</span>
<a href="#l10.753"></a><span id="l10.753">       if (!ascending)</span>
<a href="#l10.754"></a><span id="l10.754">         cookies.reverse();</span>
<a href="#l10.755"></a><span id="l10.755">     }</span>
<a href="#l10.756"></a><span id="l10.756" class="difflineat">@@ -781,18 +726,17 @@ var gCookiesWindow = {</span>
<a href="#l10.757"></a><span id="l10.757">     this._view.selection.select(0);</span>
<a href="#l10.758"></a><span id="l10.758">     this._tree.treeBoxObject.invalidate();</span>
<a href="#l10.759"></a><span id="l10.759">     this._tree.treeBoxObject.ensureRowIsVisible(0);</span>
<a href="#l10.760"></a><span id="l10.760"> </span>
<a href="#l10.761"></a><span id="l10.761">     this._lastSortAscending = ascending;</span>
<a href="#l10.762"></a><span id="l10.762">     this._lastSortProperty = aProperty;</span>
<a href="#l10.763"></a><span id="l10.763">   },</span>
<a href="#l10.764"></a><span id="l10.764"> </span>
<a href="#l10.765"></a><span id="l10.765" class="difflineminus">-  clearFilter: function ()</span>
<a href="#l10.766"></a><span id="l10.766" class="difflineminus">-  {</span>
<a href="#l10.767"></a><span id="l10.767" class="difflineplus">+  clearFilter() {</span>
<a href="#l10.768"></a><span id="l10.768">     // Revert to single-select in the tree</span>
<a href="#l10.769"></a><span id="l10.769">     this._tree.setAttribute(&quot;seltype&quot;, &quot;single&quot;);</span>
<a href="#l10.770"></a><span id="l10.770"> </span>
<a href="#l10.771"></a><span id="l10.771">     // Clear the Tree Display</span>
<a href="#l10.772"></a><span id="l10.772">     this._view._filtered = false;</span>
<a href="#l10.773"></a><span id="l10.773">     this._view._rowCount = 0;</span>
<a href="#l10.774"></a><span id="l10.774">     this._tree.treeBoxObject.rowCountChanged(0, -this._view._filterSet.length);</span>
<a href="#l10.775"></a><span id="l10.775">     this._view._filterSet = [];</span>
<a href="#l10.776"></a><span id="l10.776" class="difflineat">@@ -801,18 +745,17 @@ var gCookiesWindow = {</span>
<a href="#l10.777"></a><span id="l10.777">     this._loadCookies();</span>
<a href="#l10.778"></a><span id="l10.778">     this._tree.treeBoxObject.view = this._view;</span>
<a href="#l10.779"></a><span id="l10.779"> </span>
<a href="#l10.780"></a><span id="l10.780">     // Restore sort order</span>
<a href="#l10.781"></a><span id="l10.781">     var sortby = this._lastSortProperty;</span>
<a href="#l10.782"></a><span id="l10.782">     if (sortby == &quot;&quot;) {</span>
<a href="#l10.783"></a><span id="l10.783">       this._lastSortAscending = false;</span>
<a href="#l10.784"></a><span id="l10.784">       this.sort(&quot;rawHost&quot;);</span>
<a href="#l10.785"></a><span id="l10.785" class="difflineminus">-    }</span>
<a href="#l10.786"></a><span id="l10.786" class="difflineminus">-    else {</span>
<a href="#l10.787"></a><span id="l10.787" class="difflineplus">+    } else {</span>
<a href="#l10.788"></a><span id="l10.788">       this._lastSortAscending = !this._lastSortAscending;</span>
<a href="#l10.789"></a><span id="l10.789">       this.sort(sortby);</span>
<a href="#l10.790"></a><span id="l10.790">     }</span>
<a href="#l10.791"></a><span id="l10.791"> </span>
<a href="#l10.792"></a><span id="l10.792">     // Restore open state</span>
<a href="#l10.793"></a><span id="l10.793">     for (var i = 0; i &lt; this._openIndices.length; ++i)</span>
<a href="#l10.794"></a><span id="l10.794">       this._view.toggleOpenState(this._openIndices[i]);</span>
<a href="#l10.795"></a><span id="l10.795">     this._openIndices = [];</span>
<a href="#l10.796"></a><span id="l10.796" class="difflineat">@@ -823,43 +766,40 @@ var gCookiesWindow = {</span>
<a href="#l10.797"></a><span id="l10.797">       var range = this._lastSelectedRanges[i];</span>
<a href="#l10.798"></a><span id="l10.798">       this._view.selection.rangedSelect(range.min, range.max, true);</span>
<a href="#l10.799"></a><span id="l10.799">     }</span>
<a href="#l10.800"></a><span id="l10.800">     this._lastSelectedRanges = [];</span>
<a href="#l10.801"></a><span id="l10.801"> </span>
<a href="#l10.802"></a><span id="l10.802">     document.getElementById(&quot;cookiesIntro&quot;).value = this._bundle.getString(&quot;cookiesAll&quot;);</span>
<a href="#l10.803"></a><span id="l10.803">   },</span>
<a href="#l10.804"></a><span id="l10.804"> </span>
<a href="#l10.805"></a><span id="l10.805" class="difflineminus">-  _cookieMatchesFilter: function (aCookie)</span>
<a href="#l10.806"></a><span id="l10.806" class="difflineminus">-  {</span>
<a href="#l10.807"></a><span id="l10.807" class="difflineplus">+  _cookieMatchesFilter(aCookie) {</span>
<a href="#l10.808"></a><span id="l10.808">     return aCookie.rawHost.includes(this._view._filterValue) ||</span>
<a href="#l10.809"></a><span id="l10.809">            aCookie.name.includes(this._view._filterValue) ||</span>
<a href="#l10.810"></a><span id="l10.810">            aCookie.value.includes(this._view._filterValue);</span>
<a href="#l10.811"></a><span id="l10.811">   },</span>
<a href="#l10.812"></a><span id="l10.812"> </span>
<a href="#l10.813"></a><span id="l10.813" class="difflineminus">-  _filterCookies: function (aFilterValue)</span>
<a href="#l10.814"></a><span id="l10.814" class="difflineminus">-  {</span>
<a href="#l10.815"></a><span id="l10.815" class="difflineplus">+  _filterCookies(aFilterValue) {</span>
<a href="#l10.816"></a><span id="l10.816">     this._view._filterValue = aFilterValue;</span>
<a href="#l10.817"></a><span id="l10.817">     var cookies = [];</span>
<a href="#l10.818"></a><span id="l10.818" class="difflineminus">-    for (var i = 0; i &lt; gCookiesWindow._hostOrder.length; ++i) { //var host in gCookiesWindow._hosts) {</span>
<a href="#l10.819"></a><span id="l10.819" class="difflineplus">+    for (var i = 0; i &lt; gCookiesWindow._hostOrder.length; ++i) { // var host in gCookiesWindow._hosts) {</span>
<a href="#l10.820"></a><span id="l10.820">       var currHost = gCookiesWindow._hosts[gCookiesWindow._hostOrder[i]]; // gCookiesWindow._hosts[host];</span>
<a href="#l10.821"></a><span id="l10.821">       if (!currHost) continue;</span>
<a href="#l10.822"></a><span id="l10.822">       for (var j = 0; j &lt; currHost.cookies.length; ++j) {</span>
<a href="#l10.823"></a><span id="l10.823">         var cookie = currHost.cookies[j];</span>
<a href="#l10.824"></a><span id="l10.824">         if (this._cookieMatchesFilter(cookie))</span>
<a href="#l10.825"></a><span id="l10.825">           cookies.push(cookie);</span>
<a href="#l10.826"></a><span id="l10.826">       }</span>
<a href="#l10.827"></a><span id="l10.827">     }</span>
<a href="#l10.828"></a><span id="l10.828">     return cookies;</span>
<a href="#l10.829"></a><span id="l10.829">   },</span>
<a href="#l10.830"></a><span id="l10.830"> </span>
<a href="#l10.831"></a><span id="l10.831">   _lastSelectedRanges: [],</span>
<a href="#l10.832"></a><span id="l10.832">   _openIndices: [],</span>
<a href="#l10.833"></a><span id="l10.833" class="difflineminus">-  _saveState: function ()</span>
<a href="#l10.834"></a><span id="l10.834" class="difflineminus">-  {</span>
<a href="#l10.835"></a><span id="l10.835" class="difflineplus">+  _saveState() {</span>
<a href="#l10.836"></a><span id="l10.836">     // Save selection</span>
<a href="#l10.837"></a><span id="l10.837">     var seln = this._view.selection;</span>
<a href="#l10.838"></a><span id="l10.838">     this._lastSelectedRanges = [];</span>
<a href="#l10.839"></a><span id="l10.839">     var rangeCount = seln.getRangeCount();</span>
<a href="#l10.840"></a><span id="l10.840">     for (var i = 0; i &lt; rangeCount; ++i) {</span>
<a href="#l10.841"></a><span id="l10.841">       var min = {}; var max = {};</span>
<a href="#l10.842"></a><span id="l10.842">       seln.getRangeAt(i, min, max);</span>
<a href="#l10.843"></a><span id="l10.843">       this._lastSelectedRanges.push({ min: min.value, max: max.value });</span>
<a href="#l10.844"></a><span id="l10.844" class="difflineat">@@ -869,18 +809,17 @@ var gCookiesWindow = {</span>
<a href="#l10.845"></a><span id="l10.845">     this._openIndices = [];</span>
<a href="#l10.846"></a><span id="l10.846">     for (i = 0; i &lt; this._view.rowCount; ++i) {</span>
<a href="#l10.847"></a><span id="l10.847">       var item = this._view._getItemAtIndex(i);</span>
<a href="#l10.848"></a><span id="l10.848">       if (item &amp;&amp; item.container &amp;&amp; item.open)</span>
<a href="#l10.849"></a><span id="l10.849">         this._openIndices.push(i);</span>
<a href="#l10.850"></a><span id="l10.850">     }</span>
<a href="#l10.851"></a><span id="l10.851">   },</span>
<a href="#l10.852"></a><span id="l10.852"> </span>
<a href="#l10.853"></a><span id="l10.853" class="difflineminus">-  filter: function ()</span>
<a href="#l10.854"></a><span id="l10.854" class="difflineminus">-  {</span>
<a href="#l10.855"></a><span id="l10.855" class="difflineplus">+  filter() {</span>
<a href="#l10.856"></a><span id="l10.856">     var filter = document.getElementById(&quot;filter&quot;).value;</span>
<a href="#l10.857"></a><span id="l10.857">     if (filter == &quot;&quot;) {</span>
<a href="#l10.858"></a><span id="l10.858">       gCookiesWindow.clearFilter();</span>
<a href="#l10.859"></a><span id="l10.859">       return;</span>
<a href="#l10.860"></a><span id="l10.860">     }</span>
<a href="#l10.861"></a><span id="l10.861">     var view = gCookiesWindow._view;</span>
<a href="#l10.862"></a><span id="l10.862">     view._filterSet = gCookiesWindow._filterCookies(filter);</span>
<a href="#l10.863"></a><span id="l10.863">     if (!view._filtered) {</span>
<a href="#l10.864"></a><span id="l10.864" class="difflineat">@@ -902,20 +841,19 @@ var gCookiesWindow = {</span>
<a href="#l10.865"></a><span id="l10.865"> </span>
<a href="#l10.866"></a><span id="l10.866">     // if the view is not empty then select the first item</span>
<a href="#l10.867"></a><span id="l10.867">     if (view.rowCount &gt; 0)</span>
<a href="#l10.868"></a><span id="l10.868">       view.selection.select(0);</span>
<a href="#l10.869"></a><span id="l10.869"> </span>
<a href="#l10.870"></a><span id="l10.870">     document.getElementById(&quot;cookiesIntro&quot;).value = gCookiesWindow._bundle.getString(&quot;cookiesFiltered&quot;);</span>
<a href="#l10.871"></a><span id="l10.871">   },</span>
<a href="#l10.872"></a><span id="l10.872"> </span>
<a href="#l10.873"></a><span id="l10.873" class="difflineminus">-  setFilter: function (aFilterString) {</span>
<a href="#l10.874"></a><span id="l10.874" class="difflineplus">+  setFilter(aFilterString) {</span>
<a href="#l10.875"></a><span id="l10.875">     document.getElementById(&quot;filter&quot;).value = aFilterString;</span>
<a href="#l10.876"></a><span id="l10.876">     this.filter();</span>
<a href="#l10.877"></a><span id="l10.877">   },</span>
<a href="#l10.878"></a><span id="l10.878"> </span>
<a href="#l10.879"></a><span id="l10.879" class="difflineminus">-  focusFilterBox: function ()</span>
<a href="#l10.880"></a><span id="l10.880" class="difflineminus">-  {</span>
<a href="#l10.881"></a><span id="l10.881" class="difflineplus">+  focusFilterBox() {</span>
<a href="#l10.882"></a><span id="l10.882">     var filter = document.getElementById(&quot;filter&quot;);</span>
<a href="#l10.883"></a><span id="l10.883">     filter.focus();</span>
<a href="#l10.884"></a><span id="l10.884">     filter.select();</span>
<a href="#l10.885"></a><span id="l10.885" class="difflineminus">-  }</span>
<a href="#l10.886"></a><span id="l10.886" class="difflineplus">+  },</span>
<a href="#l10.887"></a><span id="l10.887"> };</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l11.1"></a><span id="l11.1" class="difflineminus">--- a/mail/components/preferences/display.js</span>
<a href="#l11.2"></a><span id="l11.2" class="difflineplus">+++ b/mail/components/preferences/display.js</span>
<a href="#l11.3"></a><span id="l11.3" class="difflineat">@@ -2,18 +2,17 @@</span>
<a href="#l11.4"></a><span id="l11.4"> /* This Source Code Form is subject to the terms of the Mozilla Public</span>
<a href="#l11.5"></a><span id="l11.5">  * License, v. 2.0. If a copy of the MPL was not distributed with this</span>
<a href="#l11.6"></a><span id="l11.6">  * file, You can obtain one at http://mozilla.org/MPL/2.0/. */</span>
<a href="#l11.7"></a><span id="l11.7"> </span>
<a href="#l11.8"></a><span id="l11.8"> var gDisplayPane = {</span>
<a href="#l11.9"></a><span id="l11.9">   mInitialized: false,</span>
<a href="#l11.10"></a><span id="l11.10">   mTagListBox:  null,</span>
<a href="#l11.11"></a><span id="l11.11"> </span>
<a href="#l11.12"></a><span id="l11.12" class="difflineminus">-  init: function ()</span>
<a href="#l11.13"></a><span id="l11.13" class="difflineminus">-  {</span>
<a href="#l11.14"></a><span id="l11.14" class="difflineplus">+  init() {</span>
<a href="#l11.15"></a><span id="l11.15">     if (!((&quot;arguments&quot; in window) &amp;&amp; window.arguments[1])) {</span>
<a href="#l11.16"></a><span id="l11.16">       // If no tab was specified, select the last used tab.</span>
<a href="#l11.17"></a><span id="l11.17">       let preference = document.getElementById(&quot;mail.preferences.display.selectedTabIndex&quot;);</span>
<a href="#l11.18"></a><span id="l11.18">       if (preference.value)</span>
<a href="#l11.19"></a><span id="l11.19">         document.getElementById(&quot;displayPrefs&quot;).selectedIndex = preference.value;</span>
<a href="#l11.20"></a><span id="l11.20">     }</span>
<a href="#l11.21"></a><span id="l11.21">     this._rebuildFonts();</span>
<a href="#l11.22"></a><span id="l11.22">     this.updateMarkAsReadOptions(document.getElementById(&quot;automaticallyMarkAsRead&quot;).checked);</span>
<a href="#l11.23"></a><span id="l11.23" class="difflineat">@@ -33,18 +32,17 @@ var gDisplayPane = {</span>
<a href="#l11.24"></a><span id="l11.24">     this.buildTagList();</span>
<a href="#l11.25"></a><span id="l11.25">   },</span>
<a href="#l11.26"></a><span id="l11.26"> </span>
<a href="#l11.27"></a><span id="l11.27">   // FONTS</span>
<a href="#l11.28"></a><span id="l11.28"> </span>
<a href="#l11.29"></a><span id="l11.29">   /**</span>
<a href="#l11.30"></a><span id="l11.30">    * Populates the default font list in UI.</span>
<a href="#l11.31"></a><span id="l11.31">    */</span>
<a href="#l11.32"></a><span id="l11.32" class="difflineminus">-  _rebuildFonts: function ()</span>
<a href="#l11.33"></a><span id="l11.33" class="difflineminus">-  {</span>
<a href="#l11.34"></a><span id="l11.34" class="difflineplus">+  _rebuildFonts() {</span>
<a href="#l11.35"></a><span id="l11.35">     var langGroupPref = document.getElementById(&quot;font.language.group&quot;);</span>
<a href="#l11.36"></a><span id="l11.36">     var isSerif = this._readDefaultFontTypeForLanguage(langGroupPref.value) == &quot;serif&quot;;</span>
<a href="#l11.37"></a><span id="l11.37">     this._selectDefaultLanguageGroup(langGroupPref.value, isSerif);</span>
<a href="#l11.38"></a><span id="l11.38">   },</span>
<a href="#l11.39"></a><span id="l11.39"> </span>
<a href="#l11.40"></a><span id="l11.40">   /**</span>
<a href="#l11.41"></a><span id="l11.41">    * Select the default language group.</span>
<a href="#l11.42"></a><span id="l11.42">    */</span>
<a href="#l11.43"></a><span id="l11.43" class="difflineat">@@ -114,18 +112,17 @@ var gDisplayPane = {</span>
<a href="#l11.44"></a><span id="l11.44">       }</span>
<a href="#l11.45"></a><span id="l11.45">     })().catch(Cu.reportError);</span>
<a href="#l11.46"></a><span id="l11.46">   },</span>
<a href="#l11.47"></a><span id="l11.47"> </span>
<a href="#l11.48"></a><span id="l11.48">   /**</span>
<a href="#l11.49"></a><span id="l11.49">    * Returns the type of the current default font for the language denoted by</span>
<a href="#l11.50"></a><span id="l11.50">    * aLanguageGroup.</span>
<a href="#l11.51"></a><span id="l11.51">    */</span>
<a href="#l11.52"></a><span id="l11.52" class="difflineminus">-  _readDefaultFontTypeForLanguage: function (aLanguageGroup)</span>
<a href="#l11.53"></a><span id="l11.53" class="difflineminus">-  {</span>
<a href="#l11.54"></a><span id="l11.54" class="difflineplus">+  _readDefaultFontTypeForLanguage(aLanguageGroup) {</span>
<a href="#l11.55"></a><span id="l11.55">     const kDefaultFontType = &quot;font.default.%LANG%&quot;;</span>
<a href="#l11.56"></a><span id="l11.56">     var defaultFontTypePref = kDefaultFontType.replace(/%LANG%/, aLanguageGroup);</span>
<a href="#l11.57"></a><span id="l11.57">     var preference = document.getElementById(defaultFontTypePref);</span>
<a href="#l11.58"></a><span id="l11.58">     if (!preference) {</span>
<a href="#l11.59"></a><span id="l11.59">       preference = document.createElementNS(&quot;http://www.mozilla.org/keymaster/gatekeeper/there.is.only.xul&quot;, &quot;preference&quot;);</span>
<a href="#l11.60"></a><span id="l11.60">       preference.id = defaultFontTypePref;</span>
<a href="#l11.61"></a><span id="l11.61">       preference.type = &quot;string&quot;;</span>
<a href="#l11.62"></a><span id="l11.62">       preference.name = defaultFontTypePref;</span>
<a href="#l11.63"></a><span id="l11.63" class="difflineat">@@ -137,18 +134,17 @@ var gDisplayPane = {</span>
<a href="#l11.64"></a><span id="l11.64"> </span>
<a href="#l11.65"></a><span id="l11.65">   /**</span>
<a href="#l11.66"></a><span id="l11.66">    * Determine the appropriate value to select for defaultFont, for the</span>
<a href="#l11.67"></a><span id="l11.67">    * following cases:</span>
<a href="#l11.68"></a><span id="l11.68">    * - there is no setting</span>
<a href="#l11.69"></a><span id="l11.69">    * - the font selected by the user is no longer present (e.g. deleted from</span>
<a href="#l11.70"></a><span id="l11.70">    *   fonts folder)</span>
<a href="#l11.71"></a><span id="l11.71">    */</span>
<a href="#l11.72"></a><span id="l11.72" class="difflineminus">-  readFontSelection: function gDisplayPane_readFontSelection()</span>
<a href="#l11.73"></a><span id="l11.73" class="difflineminus">-  {</span>
<a href="#l11.74"></a><span id="l11.74" class="difflineplus">+  readFontSelection: function gDisplayPane_readFontSelection() {</span>
<a href="#l11.75"></a><span id="l11.75">     let element = document.getElementById(&quot;defaultFont&quot;);</span>
<a href="#l11.76"></a><span id="l11.76">     let preference = document.getElementById(element.getAttribute(&quot;preference&quot;));</span>
<a href="#l11.77"></a><span id="l11.77">     if (preference.value) {</span>
<a href="#l11.78"></a><span id="l11.78">       let fontItem = element.querySelector('[value=&quot;' + preference.value + '&quot;]');</span>
<a href="#l11.79"></a><span id="l11.79"> </span>
<a href="#l11.80"></a><span id="l11.80">       // There is a setting that actually is in the list. Respect it.</span>
<a href="#l11.81"></a><span id="l11.81">       if (fontItem)</span>
<a href="#l11.82"></a><span id="l11.82">         return undefined;</span>
<a href="#l11.83"></a><span id="l11.83" class="difflineat">@@ -167,98 +163,86 @@ var gDisplayPane = {</span>
<a href="#l11.84"></a><span id="l11.84">     for (let fontName of fontNames) {</span>
<a href="#l11.85"></a><span id="l11.85">       let fontItem = element.querySelector('[value=&quot;' + fontName.trim() + '&quot;]');</span>
<a href="#l11.86"></a><span id="l11.86">       if (fontItem)</span>
<a href="#l11.87"></a><span id="l11.87">         return fontItem.getAttribute(&quot;value&quot;);</span>
<a href="#l11.88"></a><span id="l11.88">     }</span>
<a href="#l11.89"></a><span id="l11.89">     return defaultValue;</span>
<a href="#l11.90"></a><span id="l11.90">   },</span>
<a href="#l11.91"></a><span id="l11.91"> </span>
<a href="#l11.92"></a><span id="l11.92" class="difflineminus">-  tabSelectionChanged: function ()</span>
<a href="#l11.93"></a><span id="l11.93" class="difflineminus">-  {</span>
<a href="#l11.94"></a><span id="l11.94" class="difflineplus">+  tabSelectionChanged() {</span>
<a href="#l11.95"></a><span id="l11.95">     if (this.mInitialized)</span>
<a href="#l11.96"></a><span id="l11.96">       document.getElementById(&quot;mail.preferences.display.selectedTabIndex&quot;)</span>
<a href="#l11.97"></a><span id="l11.97">               .valueFromPreferences = document.getElementById(&quot;displayPrefs&quot;).selectedIndex;</span>
<a href="#l11.98"></a><span id="l11.98">   },</span>
<a href="#l11.99"></a><span id="l11.99"> </span>
<a href="#l11.100"></a><span id="l11.100">   /**</span>
<a href="#l11.101"></a><span id="l11.101">    * Displays the fonts dialog, where web page font names and sizes can be</span>
<a href="#l11.102"></a><span id="l11.102">    * configured.</span>
<a href="#l11.103"></a><span id="l11.103">    */</span>
<a href="#l11.104"></a><span id="l11.104" class="difflineminus">-  configureFonts: function ()</span>
<a href="#l11.105"></a><span id="l11.105" class="difflineminus">-  {</span>
<a href="#l11.106"></a><span id="l11.106" class="difflineplus">+  configureFonts() {</span>
<a href="#l11.107"></a><span id="l11.107">     gSubDialog.open(&quot;chrome://messenger/content/preferences/fonts.xul&quot;);</span>
<a href="#l11.108"></a><span id="l11.108">   },</span>
<a href="#l11.109"></a><span id="l11.109"> </span>
<a href="#l11.110"></a><span id="l11.110">   /**</span>
<a href="#l11.111"></a><span id="l11.111">    * Displays the colors dialog, where default web page/link/etc. colors can be</span>
<a href="#l11.112"></a><span id="l11.112">    * configured.</span>
<a href="#l11.113"></a><span id="l11.113">    */</span>
<a href="#l11.114"></a><span id="l11.114" class="difflineminus">-  configureColors: function ()</span>
<a href="#l11.115"></a><span id="l11.115" class="difflineminus">-  {</span>
<a href="#l11.116"></a><span id="l11.116" class="difflineplus">+  configureColors() {</span>
<a href="#l11.117"></a><span id="l11.117">     gSubDialog.open(&quot;chrome://messenger/content/preferences/colors.xul&quot;,</span>
<a href="#l11.118"></a><span id="l11.118">                     &quot;resizable=no&quot;);</span>
<a href="#l11.119"></a><span id="l11.119">   },</span>
<a href="#l11.120"></a><span id="l11.120"> </span>
<a href="#l11.121"></a><span id="l11.121"> </span>
<a href="#l11.122"></a><span id="l11.122">   // appends the tag to the tag list box</span>
<a href="#l11.123"></a><span id="l11.123" class="difflineminus">-  appendTagItem: function(aTagName, aKey, aColor)</span>
<a href="#l11.124"></a><span id="l11.124" class="difflineminus">-  {</span>
<a href="#l11.125"></a><span id="l11.125" class="difflineplus">+  appendTagItem(aTagName, aKey, aColor) {</span>
<a href="#l11.126"></a><span id="l11.126">     let item = this.mTagListBox.appendItem(aTagName, aKey);</span>
<a href="#l11.127"></a><span id="l11.127">     item.style.color = aColor;</span>
<a href="#l11.128"></a><span id="l11.128">     return item;</span>
<a href="#l11.129"></a><span id="l11.129">   },</span>
<a href="#l11.130"></a><span id="l11.130"> </span>
<a href="#l11.131"></a><span id="l11.131" class="difflineminus">-  buildTagList: function()</span>
<a href="#l11.132"></a><span id="l11.132" class="difflineminus">-  {</span>
<a href="#l11.133"></a><span id="l11.133" class="difflineplus">+  buildTagList() {</span>
<a href="#l11.134"></a><span id="l11.134">     let tagArray = MailServices.tags.getAllTags({});</span>
<a href="#l11.135"></a><span id="l11.135" class="difflineminus">-    for (let i = 0; i &lt; tagArray.length; ++i)</span>
<a href="#l11.136"></a><span id="l11.136" class="difflineminus">-    {</span>
<a href="#l11.137"></a><span id="l11.137" class="difflineplus">+    for (let i = 0; i &lt; tagArray.length; ++i) {</span>
<a href="#l11.138"></a><span id="l11.138">       let taginfo = tagArray[i];</span>
<a href="#l11.139"></a><span id="l11.139">       this.appendTagItem(taginfo.tag, taginfo.key, taginfo.color);</span>
<a href="#l11.140"></a><span id="l11.140">     }</span>
<a href="#l11.141"></a><span id="l11.141">   },</span>
<a href="#l11.142"></a><span id="l11.142"> </span>
<a href="#l11.143"></a><span id="l11.143" class="difflineminus">-  removeTag: function()</span>
<a href="#l11.144"></a><span id="l11.144" class="difflineminus">-  {</span>
<a href="#l11.145"></a><span id="l11.145" class="difflineplus">+  removeTag() {</span>
<a href="#l11.146"></a><span id="l11.146">     var index = this.mTagListBox.selectedIndex;</span>
<a href="#l11.147"></a><span id="l11.147" class="difflineminus">-    if (index &gt;= 0)</span>
<a href="#l11.148"></a><span id="l11.148" class="difflineminus">-    {</span>
<a href="#l11.149"></a><span id="l11.149" class="difflineplus">+    if (index &gt;= 0) {</span>
<a href="#l11.150"></a><span id="l11.150">       var itemToRemove = this.mTagListBox.getItemAtIndex(index);</span>
<a href="#l11.151"></a><span id="l11.151">       MailServices.tags.deleteKey(itemToRemove.getAttribute(&quot;value&quot;));</span>
<a href="#l11.152"></a><span id="l11.152">       itemToRemove.remove();</span>
<a href="#l11.153"></a><span id="l11.153">       var numItemsInListBox = this.mTagListBox.getRowCount();</span>
<a href="#l11.154"></a><span id="l11.154">       this.mTagListBox.selectedIndex = index &lt; numItemsInListBox ? index : numItemsInListBox - 1;</span>
<a href="#l11.155"></a><span id="l11.155">     }</span>
<a href="#l11.156"></a><span id="l11.156">   },</span>
<a href="#l11.157"></a><span id="l11.157"> </span>
<a href="#l11.158"></a><span id="l11.158">   /**</span>
<a href="#l11.159"></a><span id="l11.159">    * Open the edit tag dialog</span>
<a href="#l11.160"></a><span id="l11.160">    */</span>
<a href="#l11.161"></a><span id="l11.161" class="difflineminus">-  editTag: function()</span>
<a href="#l11.162"></a><span id="l11.162" class="difflineminus">-  {</span>
<a href="#l11.163"></a><span id="l11.163" class="difflineplus">+  editTag() {</span>
<a href="#l11.164"></a><span id="l11.164">     var index = this.mTagListBox.selectedIndex;</span>
<a href="#l11.165"></a><span id="l11.165" class="difflineminus">-    if (index &gt;= 0)</span>
<a href="#l11.166"></a><span id="l11.166" class="difflineminus">-    {</span>
<a href="#l11.167"></a><span id="l11.167" class="difflineplus">+    if (index &gt;= 0) {</span>
<a href="#l11.168"></a><span id="l11.168">       var tagElToEdit = this.mTagListBox.getItemAtIndex(index);</span>
<a href="#l11.169"></a><span id="l11.169">       var args = {result: &quot;&quot;, keyToEdit: tagElToEdit.getAttribute(&quot;value&quot;), okCallback: editTagCallback};</span>
<a href="#l11.170"></a><span id="l11.170">       let dialog = gSubDialog.open(&quot;chrome://messenger/content/newTagDialog.xul&quot;,</span>
<a href="#l11.171"></a><span id="l11.171">                                    &quot;resizable=no&quot;, args);</span>
<a href="#l11.172"></a><span id="l11.172">     }</span>
<a href="#l11.173"></a><span id="l11.173">   },</span>
<a href="#l11.174"></a><span id="l11.174"> </span>
<a href="#l11.175"></a><span id="l11.175" class="difflineminus">-  addTag: function()</span>
<a href="#l11.176"></a><span id="l11.176" class="difflineminus">-  {</span>
<a href="#l11.177"></a><span id="l11.177" class="difflineplus">+  addTag() {</span>
<a href="#l11.178"></a><span id="l11.178">     var args = {result: &quot;&quot;, okCallback: addTagCallback};</span>
<a href="#l11.179"></a><span id="l11.179">     let dialog = gSubDialog.open(&quot;chrome://messenger/content/newTagDialog.xul&quot;,</span>
<a href="#l11.180"></a><span id="l11.180">                                  &quot;resizable=no&quot;, args);</span>
<a href="#l11.181"></a><span id="l11.181">   },</span>
<a href="#l11.182"></a><span id="l11.182"> </span>
<a href="#l11.183"></a><span id="l11.183" class="difflineminus">-  onSelect: function()</span>
<a href="#l11.184"></a><span id="l11.184" class="difflineminus">-  {</span>
<a href="#l11.185"></a><span id="l11.185" class="difflineplus">+  onSelect() {</span>
<a href="#l11.186"></a><span id="l11.186">     let btnEdit = document.getElementById(&quot;editTagButton&quot;);</span>
<a href="#l11.187"></a><span id="l11.187">     let listBox = document.getElementById(&quot;tagList&quot;);</span>
<a href="#l11.188"></a><span id="l11.188"> </span>
<a href="#l11.189"></a><span id="l11.189">     if (listBox.selectedCount &gt; 0)</span>
<a href="#l11.190"></a><span id="l11.190">       btnEdit.disabled = false;</span>
<a href="#l11.191"></a><span id="l11.191">     else</span>
<a href="#l11.192"></a><span id="l11.192">       btnEdit.disabled = true;</span>
<a href="#l11.193"></a><span id="l11.193"> </span>
<a href="#l11.194"></a><span id="l11.194" class="difflineat">@@ -266,62 +250,57 @@ var gDisplayPane = {</span>
<a href="#l11.195"></a><span id="l11.195">   },</span>
<a href="#l11.196"></a><span id="l11.196"> </span>
<a href="#l11.197"></a><span id="l11.197">   /**</span>
<a href="#l11.198"></a><span id="l11.198">    * Enable/disable the options of automatic marking as read depending on the</span>
<a href="#l11.199"></a><span id="l11.199">    * state of the automatic marking feature.</span>
<a href="#l11.200"></a><span id="l11.200">    *</span>
<a href="#l11.201"></a><span id="l11.201">    * @param aEnableRadioGroup  Boolean value indicating whether the feature is enabled.</span>
<a href="#l11.202"></a><span id="l11.202">    */</span>
<a href="#l11.203"></a><span id="l11.203" class="difflineminus">-  updateMarkAsReadOptions: function(aEnableRadioGroup)</span>
<a href="#l11.204"></a><span id="l11.204" class="difflineminus">-  {</span>
<a href="#l11.205"></a><span id="l11.205" class="difflineplus">+  updateMarkAsReadOptions(aEnableRadioGroup) {</span>
<a href="#l11.206"></a><span id="l11.206">     let autoMarkAsPref = document.getElementById(&quot;mailnews.mark_message_read.delay&quot;);</span>
<a href="#l11.207"></a><span id="l11.207">     let autoMarkDisabled = !aEnableRadioGroup || autoMarkAsPref.locked;</span>
<a href="#l11.208"></a><span id="l11.208">     document.getElementById(&quot;markAsReadAutoPreferences&quot;).disabled = autoMarkDisabled;</span>
<a href="#l11.209"></a><span id="l11.209">     document.getElementById(&quot;secondsLabel&quot;).disabled = autoMarkDisabled;</span>
<a href="#l11.210"></a><span id="l11.210">     this.updateMarkAsReadTextbox();</span>
<a href="#l11.211"></a><span id="l11.211">   },</span>
<a href="#l11.212"></a><span id="l11.212"> </span>
<a href="#l11.213"></a><span id="l11.213">   /**</span>
<a href="#l11.214"></a><span id="l11.214">    * Automatically enable/disable delay textbox depending on state of the</span>
<a href="#l11.215"></a><span id="l11.215">    * Mark As Read On Delay feature.</span>
<a href="#l11.216"></a><span id="l11.216">    *</span>
<a href="#l11.217"></a><span id="l11.217">    * @param aFocusTextBox  Boolean value whether Mark As Read On Delay</span>
<a href="#l11.218"></a><span id="l11.218">    *                       option was selected and the textbox should be focused.</span>
<a href="#l11.219"></a><span id="l11.219">    */</span>
<a href="#l11.220"></a><span id="l11.220" class="difflineminus">-  updateMarkAsReadTextbox: function(aFocusTextBox)</span>
<a href="#l11.221"></a><span id="l11.221" class="difflineminus">-  {</span>
<a href="#l11.222"></a><span id="l11.222" class="difflineplus">+  updateMarkAsReadTextbox(aFocusTextBox) {</span>
<a href="#l11.223"></a><span id="l11.223">     let globalCheckbox = document.getElementById(&quot;automaticallyMarkAsRead&quot;);</span>
<a href="#l11.224"></a><span id="l11.224">     let delayRadioOption = document.getElementById(&quot;markAsReadAfterDelay&quot;);</span>
<a href="#l11.225"></a><span id="l11.225">     let delayTextbox = document.getElementById(&quot;markAsReadDelay&quot;);</span>
<a href="#l11.226"></a><span id="l11.226">     let intervalPref = document.getElementById(&quot;mailnews.mark_message_read.delay.interval&quot;);</span>
<a href="#l11.227"></a><span id="l11.227">     delayTextbox.disabled = !globalCheckbox.checked ||</span>
<a href="#l11.228"></a><span id="l11.228">                             !delayRadioOption.selected || intervalPref.locked;</span>
<a href="#l11.229"></a><span id="l11.229">     if (!delayTextbox.disabled &amp;&amp; aFocusTextBox)</span>
<a href="#l11.230"></a><span id="l11.230">       delayTextbox.focus();</span>
<a href="#l11.231"></a><span id="l11.231" class="difflineminus">-  }</span>
<a href="#l11.232"></a><span id="l11.232" class="difflineplus">+  },</span>
<a href="#l11.233"></a><span id="l11.233"> };</span>
<a href="#l11.234"></a><span id="l11.234"> </span>
<a href="#l11.235"></a><span id="l11.235" class="difflineminus">-function addTagCallback(aName, aColor)</span>
<a href="#l11.236"></a><span id="l11.236" class="difflineminus">-{</span>
<a href="#l11.237"></a><span id="l11.237" class="difflineplus">+function addTagCallback(aName, aColor) {</span>
<a href="#l11.238"></a><span id="l11.238">   MailServices.tags.addTag(aName, aColor, &quot;&quot;);</span>
<a href="#l11.239"></a><span id="l11.239"> </span>
<a href="#l11.240"></a><span id="l11.240">   var item = gDisplayPane.appendTagItem(aName, MailServices.tags.getKeyForTag(aName), aColor);</span>
<a href="#l11.241"></a><span id="l11.241">   var tagListBox = document.getElementById(&quot;tagList&quot;);</span>
<a href="#l11.242"></a><span id="l11.242">   tagListBox.ensureElementIsVisible(item);</span>
<a href="#l11.243"></a><span id="l11.243">   tagListBox.selectItem(item);</span>
<a href="#l11.244"></a><span id="l11.244">   tagListBox.focus();</span>
<a href="#l11.245"></a><span id="l11.245"> }</span>
<a href="#l11.246"></a><span id="l11.246"> </span>
<a href="#l11.247"></a><span id="l11.247" class="difflineminus">-function editTagCallback()</span>
<a href="#l11.248"></a><span id="l11.248" class="difflineminus">-{</span>
<a href="#l11.249"></a><span id="l11.249" class="difflineplus">+function editTagCallback() {</span>
<a href="#l11.250"></a><span id="l11.250">   // update the values of the selected item</span>
<a href="#l11.251"></a><span id="l11.251">   var tagListEl = document.getElementById(&quot;tagList&quot;);</span>
<a href="#l11.252"></a><span id="l11.252">   var index = tagListEl.selectedIndex;</span>
<a href="#l11.253"></a><span id="l11.253" class="difflineminus">-  if (index &gt;= 0)</span>
<a href="#l11.254"></a><span id="l11.254" class="difflineminus">-  {</span>
<a href="#l11.255"></a><span id="l11.255" class="difflineplus">+  if (index &gt;= 0) {</span>
<a href="#l11.256"></a><span id="l11.256">     var tagElToEdit = tagListEl.getItemAtIndex(index);</span>
<a href="#l11.257"></a><span id="l11.257">     var key = tagElToEdit.getAttribute(&quot;value&quot;);</span>
<a href="#l11.258"></a><span id="l11.258">     // update the color and label elements</span>
<a href="#l11.259"></a><span id="l11.259">     tagElToEdit.setAttribute(&quot;label&quot;, MailServices.tags.getTagForKey(key));</span>
<a href="#l11.260"></a><span id="l11.260">     tagElToEdit.style.color = MailServices.tags.getColorForKey(key);</span>
<a href="#l11.261"></a><span id="l11.261">   }</span>
<a href="#l11.262"></a><span id="l11.262"> }</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l12.1"></a><span id="l12.1" class="difflineminus">--- a/mail/components/preferences/downloads.js</span>
<a href="#l12.2"></a><span id="l12.2" class="difflineplus">+++ b/mail/components/preferences/downloads.js</span>
<a href="#l12.3"></a><span id="l12.3" class="difflineat">@@ -1,16 +1,15 @@</span>
<a href="#l12.4"></a><span id="l12.4"> /* -*- Mode: Java; tab-width: 2; indent-tabs-mode: nil; c-basic-offset: 2 -*-</span>
<a href="#l12.5"></a><span id="l12.5">  * This Source Code Form is subject to the terms of the Mozilla Public</span>
<a href="#l12.6"></a><span id="l12.6">  * License, v. 2.0. If a copy of the MPL was not distributed with this</span>
<a href="#l12.7"></a><span id="l12.7">  * file, You can obtain one at http://mozilla.org/MPL/2.0/. */</span>
<a href="#l12.8"></a><span id="l12.8"> </span>
<a href="#l12.9"></a><span id="l12.9"> var gDownloadDirSection = {</span>
<a href="#l12.10"></a><span id="l12.10" class="difflineminus">-  chooseFolder: function ()</span>
<a href="#l12.11"></a><span id="l12.11" class="difflineminus">-  {</span>
<a href="#l12.12"></a><span id="l12.12" class="difflineplus">+  chooseFolder() {</span>
<a href="#l12.13"></a><span id="l12.13">     const nsIFilePicker = Ci.nsIFilePicker;</span>
<a href="#l12.14"></a><span id="l12.14">     var fp = Cc[&quot;@mozilla.org/filepicker;1&quot;]</span>
<a href="#l12.15"></a><span id="l12.15">                .createInstance(nsIFilePicker);</span>
<a href="#l12.16"></a><span id="l12.16">     var bundlePreferences = document.getElementById(&quot;bundlePreferences&quot;);</span>
<a href="#l12.17"></a><span id="l12.17">     var title = bundlePreferences.getString(&quot;chooseAttachmentsFolderTitle&quot;);</span>
<a href="#l12.18"></a><span id="l12.18">     fp.init(window, title, nsIFilePicker.modeGetFolder);</span>
<a href="#l12.19"></a><span id="l12.19"> </span>
<a href="#l12.20"></a><span id="l12.20">     const nsIFile = Ci.nsIFile;</span>
<a href="#l12.21"></a><span id="l12.21" class="difflineat">@@ -26,77 +25,71 @@ var gDownloadDirSection = {</span>
<a href="#l12.22"></a><span id="l12.22">       let file = fp.file.QueryInterface(nsIFile);</span>
<a href="#l12.23"></a><span id="l12.23">       let currentDirPref = document.getElementById(&quot;browser.download.downloadDir&quot;);</span>
<a href="#l12.24"></a><span id="l12.24">       customDirPref.value = currentDirPref.value = file;</span>
<a href="#l12.25"></a><span id="l12.25">       let folderListPref = document.getElementById(&quot;browser.download.folderList&quot;);</span>
<a href="#l12.26"></a><span id="l12.26">       folderListPref.value = this._fileToIndex(file);</span>
<a href="#l12.27"></a><span id="l12.27">     });</span>
<a href="#l12.28"></a><span id="l12.28">   },</span>
<a href="#l12.29"></a><span id="l12.29"> </span>
<a href="#l12.30"></a><span id="l12.30" class="difflineminus">-  onReadUseDownloadDir: function ()</span>
<a href="#l12.31"></a><span id="l12.31" class="difflineminus">-  {</span>
<a href="#l12.32"></a><span id="l12.32" class="difflineplus">+  onReadUseDownloadDir() {</span>
<a href="#l12.33"></a><span id="l12.33">     this.readDownloadDirPref();</span>
<a href="#l12.34"></a><span id="l12.34">     var downloadFolder = document.getElementById(&quot;downloadFolder&quot;);</span>
<a href="#l12.35"></a><span id="l12.35">     var chooseFolder = document.getElementById(&quot;chooseFolder&quot;);</span>
<a href="#l12.36"></a><span id="l12.36">     var preference = document.getElementById(&quot;browser.download.useDownloadDir&quot;);</span>
<a href="#l12.37"></a><span id="l12.37">     downloadFolder.disabled = !preference.value;</span>
<a href="#l12.38"></a><span id="l12.38">     chooseFolder.disabled = !preference.value;</span>
<a href="#l12.39"></a><span id="l12.39">     return undefined;</span>
<a href="#l12.40"></a><span id="l12.40">   },</span>
<a href="#l12.41"></a><span id="l12.41"> </span>
<a href="#l12.42"></a><span id="l12.42" class="difflineminus">-  _fileToIndex: function (aFile)</span>
<a href="#l12.43"></a><span id="l12.43" class="difflineminus">-  {</span>
<a href="#l12.44"></a><span id="l12.44" class="difflineplus">+  _fileToIndex(aFile) {</span>
<a href="#l12.45"></a><span id="l12.45">     if (!aFile || aFile.equals(this._getDownloadsFolder(&quot;Desktop&quot;)))</span>
<a href="#l12.46"></a><span id="l12.46">       return 0;</span>
<a href="#l12.47"></a><span id="l12.47">     else if (aFile.equals(this._getDownloadsFolder(&quot;Downloads&quot;)))</span>
<a href="#l12.48"></a><span id="l12.48">       return 1;</span>
<a href="#l12.49"></a><span id="l12.49">     return 2;</span>
<a href="#l12.50"></a><span id="l12.50">   },</span>
<a href="#l12.51"></a><span id="l12.51"> </span>
<a href="#l12.52"></a><span id="l12.52" class="difflineminus">-  _indexToFile: function (aIndex)</span>
<a href="#l12.53"></a><span id="l12.53" class="difflineminus">-  {</span>
<a href="#l12.54"></a><span id="l12.54" class="difflineplus">+  _indexToFile(aIndex) {</span>
<a href="#l12.55"></a><span id="l12.55">     switch (aIndex) {</span>
<a href="#l12.56"></a><span id="l12.56">     case 0:</span>
<a href="#l12.57"></a><span id="l12.57">       return this._getDownloadsFolder(&quot;Desktop&quot;);</span>
<a href="#l12.58"></a><span id="l12.58">     case 1:</span>
<a href="#l12.59"></a><span id="l12.59">       return this._getDownloadsFolder(&quot;Downloads&quot;);</span>
<a href="#l12.60"></a><span id="l12.60">     }</span>
<a href="#l12.61"></a><span id="l12.61">     var customDirPref = document.getElementById(&quot;browser.download.dir&quot;);</span>
<a href="#l12.62"></a><span id="l12.62">     return customDirPref.value;</span>
<a href="#l12.63"></a><span id="l12.63">   },</span>
<a href="#l12.64"></a><span id="l12.64"> </span>
<a href="#l12.65"></a><span id="l12.65" class="difflineminus">-  _getSpecialFolderKey: function (aFolderType)</span>
<a href="#l12.66"></a><span id="l12.66" class="difflineminus">-  {</span>
<a href="#l12.67"></a><span id="l12.67" class="difflineplus">+  _getSpecialFolderKey(aFolderType) {</span>
<a href="#l12.68"></a><span id="l12.68">     if (aFolderType == &quot;Desktop&quot;)</span>
<a href="#l12.69"></a><span id="l12.69">       return &quot;Desk&quot;;</span>
<a href="#l12.70"></a><span id="l12.70"> </span>
<a href="#l12.71"></a><span id="l12.71">     if (aFolderType != &quot;Downloads&quot;)</span>
<a href="#l12.72"></a><span id="l12.72">       throw &quot;ASSERTION FAILED: folder type should be 'Desktop' or 'Downloads'&quot;;</span>
<a href="#l12.73"></a><span id="l12.73"> </span>
<a href="#l12.74"></a><span id="l12.74">     if (AppConstants.platform == &quot;win&quot;)</span>
<a href="#l12.75"></a><span id="l12.75">       return &quot;Pers&quot;;</span>
<a href="#l12.76"></a><span id="l12.76"> </span>
<a href="#l12.77"></a><span id="l12.77">     if (AppConstants.platform == &quot;macosx&quot;)</span>
<a href="#l12.78"></a><span id="l12.78">       return &quot;UsrDocs&quot;;</span>
<a href="#l12.79"></a><span id="l12.79"> </span>
<a href="#l12.80"></a><span id="l12.80">     return &quot;Home&quot;;</span>
<a href="#l12.81"></a><span id="l12.81">   },</span>
<a href="#l12.82"></a><span id="l12.82"> </span>
<a href="#l12.83"></a><span id="l12.83" class="difflineminus">-  _getDownloadsFolder: function (aFolder)</span>
<a href="#l12.84"></a><span id="l12.84" class="difflineminus">-  {</span>
<a href="#l12.85"></a><span id="l12.85" class="difflineplus">+  _getDownloadsFolder(aFolder) {</span>
<a href="#l12.86"></a><span id="l12.86">     let dir = Services.dirsvc.get(this._getSpecialFolderKey(aFolder),</span>
<a href="#l12.87"></a><span id="l12.87">                                   Ci.nsIFile);</span>
<a href="#l12.88"></a><span id="l12.88">     if (aFolder != &quot;Desktop&quot;)</span>
<a href="#l12.89"></a><span id="l12.89">       dir.append(&quot;My Downloads&quot;);</span>
<a href="#l12.90"></a><span id="l12.90"> </span>
<a href="#l12.91"></a><span id="l12.91">     return dir;</span>
<a href="#l12.92"></a><span id="l12.92">   },</span>
<a href="#l12.93"></a><span id="l12.93"> </span>
<a href="#l12.94"></a><span id="l12.94" class="difflineminus">-  readDownloadDirPref: function ()</span>
<a href="#l12.95"></a><span id="l12.95" class="difflineminus">-  {</span>
<a href="#l12.96"></a><span id="l12.96" class="difflineplus">+  readDownloadDirPref() {</span>
<a href="#l12.97"></a><span id="l12.97">     var folderListPref = document.getElementById(&quot;browser.download.folderList&quot;);</span>
<a href="#l12.98"></a><span id="l12.98">     var bundlePreferences = document.getElementById(&quot;bundlePreferences&quot;);</span>
<a href="#l12.99"></a><span id="l12.99">     var downloadFolder = document.getElementById(&quot;downloadFolder&quot;);</span>
<a href="#l12.100"></a><span id="l12.100"> </span>
<a href="#l12.101"></a><span id="l12.101">     var customDirPref = document.getElementById(&quot;browser.download.dir&quot;);</span>
<a href="#l12.102"></a><span id="l12.102">     var customIndex = customDirPref.value ? this._fileToIndex(customDirPref.value) : 0;</span>
<a href="#l12.103"></a><span id="l12.103">     if (customIndex == 0)</span>
<a href="#l12.104"></a><span id="l12.104">       downloadFolder.value = bundlePreferences.getString(&quot;desktopFolderName&quot;);</span>
<a href="#l12.105"></a><span id="l12.105" class="difflineat">@@ -111,14 +104,13 @@ var gDownloadDirSection = {</span>
<a href="#l12.106"></a><span id="l12.106">       .QueryInterface(Ci.nsIFileProtocolHandler)</span>
<a href="#l12.107"></a><span id="l12.107">       .getURLSpecFromFile(downloadDir);</span>
<a href="#l12.108"></a><span id="l12.108"> </span>
<a href="#l12.109"></a><span id="l12.109">     downloadFolder.style.backgroundImage = &quot;url(moz-icon://&quot; + urlSpec + &quot;?size=16)&quot;;</span>
<a href="#l12.110"></a><span id="l12.110"> </span>
<a href="#l12.111"></a><span id="l12.111">     return undefined;</span>
<a href="#l12.112"></a><span id="l12.112">   },</span>
<a href="#l12.113"></a><span id="l12.113"> </span>
<a href="#l12.114"></a><span id="l12.114" class="difflineminus">-  writeFolderList: function ()</span>
<a href="#l12.115"></a><span id="l12.115" class="difflineminus">-  {</span>
<a href="#l12.116"></a><span id="l12.116" class="difflineplus">+  writeFolderList() {</span>
<a href="#l12.117"></a><span id="l12.117">     var currentDirPref = document.getElementById(&quot;browser.download.downloadDir&quot;);</span>
<a href="#l12.118"></a><span id="l12.118">     return this._fileToIndex(currentDirPref.value);</span>
<a href="#l12.119"></a><span id="l12.119" class="difflineminus">-  }</span>
<a href="#l12.120"></a><span id="l12.120" class="difflineplus">+  },</span>
<a href="#l12.121"></a><span id="l12.121"> };</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l13.1"></a><span id="l13.1" class="difflineminus">--- a/mail/components/preferences/fonts.js</span>
<a href="#l13.2"></a><span id="l13.2" class="difflineplus">+++ b/mail/components/preferences/fonts.js</span>
<a href="#l13.3"></a><span id="l13.3" class="difflineat">@@ -67,54 +67,48 @@ var gFontsDialog = {</span>
<a href="#l13.4"></a><span id="l13.4">           await FontBuilder.buildFontList(aLanguageGroup, prefs[i].fonttype, element);</span>
<a href="#l13.5"></a><span id="l13.5">         preference.setElementValue(element);</span>
<a href="#l13.6"></a><span id="l13.6">       }</span>
<a href="#l13.7"></a><span id="l13.7">     }</span>
<a href="#l13.8"></a><span id="l13.8">    })()</span>
<a href="#l13.9"></a><span id="l13.9">     .catch(Cu.reportError);</span>
<a href="#l13.10"></a><span id="l13.10">   },</span>
<a href="#l13.11"></a><span id="l13.11"> </span>
<a href="#l13.12"></a><span id="l13.12" class="difflineminus">-  readFontLanguageGroup()</span>
<a href="#l13.13"></a><span id="l13.13" class="difflineminus">-  {</span>
<a href="#l13.14"></a><span id="l13.14" class="difflineplus">+  readFontLanguageGroup() {</span>
<a href="#l13.15"></a><span id="l13.15">     var languagePref = Preferences.get(&quot;font.language.group&quot;);</span>
<a href="#l13.16"></a><span id="l13.16">     this._selectLanguageGroup(languagePref.value);</span>
<a href="#l13.17"></a><span id="l13.17">     return undefined;</span>
<a href="#l13.18"></a><span id="l13.18">   },</span>
<a href="#l13.19"></a><span id="l13.19"> </span>
<a href="#l13.20"></a><span id="l13.20" class="difflineminus">-  readUseDocumentFonts: function ()</span>
<a href="#l13.21"></a><span id="l13.21" class="difflineminus">-  {</span>
<a href="#l13.22"></a><span id="l13.22" class="difflineplus">+  readUseDocumentFonts() {</span>
<a href="#l13.23"></a><span id="l13.23">     var preference = Preferences.get(&quot;browser.display.use_document_fonts&quot;);</span>
<a href="#l13.24"></a><span id="l13.24">     return preference.value == 1;</span>
<a href="#l13.25"></a><span id="l13.25">   },</span>
<a href="#l13.26"></a><span id="l13.26"> </span>
<a href="#l13.27"></a><span id="l13.27" class="difflineminus">-  writeUseDocumentFonts: function ()</span>
<a href="#l13.28"></a><span id="l13.28" class="difflineminus">-  {</span>
<a href="#l13.29"></a><span id="l13.29" class="difflineplus">+  writeUseDocumentFonts() {</span>
<a href="#l13.30"></a><span id="l13.30">     var useDocumentFonts = document.getElementById(&quot;useDocumentFonts&quot;);</span>
<a href="#l13.31"></a><span id="l13.31">     return useDocumentFonts.checked ? 1 : 0;</span>
<a href="#l13.32"></a><span id="l13.32">   },</span>
<a href="#l13.33"></a><span id="l13.33"> </span>
<a href="#l13.34"></a><span id="l13.34" class="difflineminus">-  readFixedWidthForPlainText: function ()</span>
<a href="#l13.35"></a><span id="l13.35" class="difflineminus">-  {</span>
<a href="#l13.36"></a><span id="l13.36" class="difflineplus">+  readFixedWidthForPlainText() {</span>
<a href="#l13.37"></a><span id="l13.37">     var preference = Preferences.get(&quot;mail.fixed_width_messages&quot;);</span>
<a href="#l13.38"></a><span id="l13.38">     return preference.value == 1;</span>
<a href="#l13.39"></a><span id="l13.39">   },</span>
<a href="#l13.40"></a><span id="l13.40"> </span>
<a href="#l13.41"></a><span id="l13.41" class="difflineminus">-  writeFixedWidthForPlainText: function ()</span>
<a href="#l13.42"></a><span id="l13.42" class="difflineminus">-  {</span>
<a href="#l13.43"></a><span id="l13.43" class="difflineplus">+  writeFixedWidthForPlainText() {</span>
<a href="#l13.44"></a><span id="l13.44">     var mailFixedWidthMessages = document.getElementById(&quot;mailFixedWidthMessages&quot;);</span>
<a href="#l13.45"></a><span id="l13.45">     return mailFixedWidthMessages.checked;</span>
<a href="#l13.46"></a><span id="l13.46">   },</span>
<a href="#l13.47"></a><span id="l13.47"> </span>
<a href="#l13.48"></a><span id="l13.48">   /**</span>
<a href="#l13.49"></a><span id="l13.49">    * Both mailnews.send_default_charset and mailnews.view_default_charset</span>
<a href="#l13.50"></a><span id="l13.50">    * are nsIPrefLocalizedString. Its default value is different depending</span>
<a href="#l13.51"></a><span id="l13.51">    * on the user locale (see bug 48842).</span>
<a href="#l13.52"></a><span id="l13.52">    */</span>
<a href="#l13.53"></a><span id="l13.53" class="difflineminus">-  ondialogaccept: function()</span>
<a href="#l13.54"></a><span id="l13.54" class="difflineminus">-  {</span>
<a href="#l13.55"></a><span id="l13.55" class="difflineplus">+  ondialogaccept() {</span>
<a href="#l13.56"></a><span id="l13.56">     var sendCharsetStr = Services.prefs.getComplexValue(</span>
<a href="#l13.57"></a><span id="l13.57">       &quot;mailnews.send_default_charset&quot;, Ci.nsIPrefLocalizedString).data;</span>
<a href="#l13.58"></a><span id="l13.58"> </span>
<a href="#l13.59"></a><span id="l13.59">     var viewCharsetStr = Services.prefs.getComplexValue(</span>
<a href="#l13.60"></a><span id="l13.60">       &quot;mailnews.view_default_charset&quot;, Ci.nsIPrefLocalizedString).data;</span>
<a href="#l13.61"></a><span id="l13.61"> </span>
<a href="#l13.62"></a><span id="l13.62">     var defaultPrefs = Services.prefs.getDefaultBranch(&quot;mailnews.&quot;);</span>
<a href="#l13.63"></a><span id="l13.63"> </span>
<a href="#l13.64"></a><span id="l13.64" class="difflineat">@@ -124,10 +118,10 @@ var gFontsDialog = {</span>
<a href="#l13.65"></a><span id="l13.65">           &quot;send_default_charset&quot;, Ci.nsIPrefLocalizedString).data)</span>
<a href="#l13.66"></a><span id="l13.66">       Services.prefs.clearUserPref(&quot;mailnews.send_default_charset&quot;);</span>
<a href="#l13.67"></a><span id="l13.67"> </span>
<a href="#l13.68"></a><span id="l13.68">     if (viewCharsetStr === defaultPrefs.getComplexValue(</span>
<a href="#l13.69"></a><span id="l13.69">           &quot;view_default_charset&quot;, Ci.nsIPrefLocalizedString).data)</span>
<a href="#l13.70"></a><span id="l13.70">       Services.prefs.clearUserPref(&quot;mailnews.view_default_charset&quot;);</span>
<a href="#l13.71"></a><span id="l13.71"> </span>
<a href="#l13.72"></a><span id="l13.72">     return true;</span>
<a href="#l13.73"></a><span id="l13.73" class="difflineminus">-  }</span>
<a href="#l13.74"></a><span id="l13.74" class="difflineplus">+  },</span>
<a href="#l13.75"></a><span id="l13.75"> };</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l14.1"></a><span id="l14.1" class="difflineminus">--- a/mail/components/preferences/general.js</span>
<a href="#l14.2"></a><span id="l14.2" class="difflineplus">+++ b/mail/components/preferences/general.js</span>
<a href="#l14.3"></a><span id="l14.3" class="difflineat">@@ -2,124 +2,111 @@</span>
<a href="#l14.4"></a><span id="l14.4">  * This Source Code Form is subject to the terms of the Mozilla Public</span>
<a href="#l14.5"></a><span id="l14.5">  * License, v. 2.0. If a copy of the MPL was not distributed with this</span>
<a href="#l14.6"></a><span id="l14.6">  * file, You can obtain one at http://mozilla.org/MPL/2.0/. */</span>
<a href="#l14.7"></a><span id="l14.7"> </span>
<a href="#l14.8"></a><span id="l14.8"> var gGeneralPane = {</span>
<a href="#l14.9"></a><span id="l14.9">   mPane: null,</span>
<a href="#l14.10"></a><span id="l14.10">   mStartPageUrl: &quot;&quot;,</span>
<a href="#l14.11"></a><span id="l14.11"> </span>
<a href="#l14.12"></a><span id="l14.12" class="difflineminus">-  init: function ()</span>
<a href="#l14.13"></a><span id="l14.13" class="difflineminus">-  {</span>
<a href="#l14.14"></a><span id="l14.14" class="difflineplus">+  init() {</span>
<a href="#l14.15"></a><span id="l14.15">     this.mPane = document.getElementById(&quot;paneGeneral&quot;);</span>
<a href="#l14.16"></a><span id="l14.16"> </span>
<a href="#l14.17"></a><span id="l14.17">     this.updateStartPage();</span>
<a href="#l14.18"></a><span id="l14.18">     this.updatePlaySound();</span>
<a href="#l14.19"></a><span id="l14.19">     this.updateCustomizeAlert();</span>
<a href="#l14.20"></a><span id="l14.20">     this.updateWebSearch();</span>
<a href="#l14.21"></a><span id="l14.21">   },</span>
<a href="#l14.22"></a><span id="l14.22"> </span>
<a href="#l14.23"></a><span id="l14.23">   /**</span>
<a href="#l14.24"></a><span id="l14.24">    * Restores the default start page as the user's start page</span>
<a href="#l14.25"></a><span id="l14.25">    */</span>
<a href="#l14.26"></a><span id="l14.26" class="difflineminus">-  restoreDefaultStartPage: function()</span>
<a href="#l14.27"></a><span id="l14.27" class="difflineminus">-  {</span>
<a href="#l14.28"></a><span id="l14.28" class="difflineplus">+  restoreDefaultStartPage() {</span>
<a href="#l14.29"></a><span id="l14.29">     var startPage = document.getElementById(&quot;mailnews.start_page.url&quot;);</span>
<a href="#l14.30"></a><span id="l14.30">     startPage.value = startPage.defaultValue;</span>
<a href="#l14.31"></a><span id="l14.31">   },</span>
<a href="#l14.32"></a><span id="l14.32"> </span>
<a href="#l14.33"></a><span id="l14.33">   /**</span>
<a href="#l14.34"></a><span id="l14.34">    * Returns a formatted url corresponding to the value of mailnews.start_page.url</span>
<a href="#l14.35"></a><span id="l14.35">    * Stores the original value of mailnews.start_page.url</span>
<a href="#l14.36"></a><span id="l14.36">    */</span>
<a href="#l14.37"></a><span id="l14.37" class="difflineminus">-  readStartPageUrl: function()</span>
<a href="#l14.38"></a><span id="l14.38" class="difflineminus">-  {</span>
<a href="#l14.39"></a><span id="l14.39" class="difflineplus">+  readStartPageUrl() {</span>
<a href="#l14.40"></a><span id="l14.40">     var pref = document.getElementById(&quot;mailnews.start_page.url&quot;);</span>
<a href="#l14.41"></a><span id="l14.41">     this.mStartPageUrl = pref.value;</span>
<a href="#l14.42"></a><span id="l14.42">     return Services.urlFormatter.formatURL(this.mStartPageUrl);</span>
<a href="#l14.43"></a><span id="l14.43">   },</span>
<a href="#l14.44"></a><span id="l14.44"> </span>
<a href="#l14.45"></a><span id="l14.45">   /**</span>
<a href="#l14.46"></a><span id="l14.46">    * Returns the value of the mailnews start page url represented by the UI.</span>
<a href="#l14.47"></a><span id="l14.47">    * If the url matches the formatted version of our stored value, then</span>
<a href="#l14.48"></a><span id="l14.48">    * return the unformatted url.</span>
<a href="#l14.49"></a><span id="l14.49">    */</span>
<a href="#l14.50"></a><span id="l14.50" class="difflineminus">-  writeStartPageUrl: function()</span>
<a href="#l14.51"></a><span id="l14.51" class="difflineminus">-  {</span>
<a href="#l14.52"></a><span id="l14.52" class="difflineminus">-    var startPage = document.getElementById('mailnewsStartPageUrl');</span>
<a href="#l14.53"></a><span id="l14.53" class="difflineplus">+  writeStartPageUrl() {</span>
<a href="#l14.54"></a><span id="l14.54" class="difflineplus">+    var startPage = document.getElementById(&quot;mailnewsStartPageUrl&quot;);</span>
<a href="#l14.55"></a><span id="l14.55">     return Services.urlFormatter.formatURL(this.mStartPageUrl) == startPage.value ? this.mStartPageUrl : startPage.value;</span>
<a href="#l14.56"></a><span id="l14.56">   },</span>
<a href="#l14.57"></a><span id="l14.57"> </span>
<a href="#l14.58"></a><span id="l14.58" class="difflineminus">-  customizeMailAlert: function()</span>
<a href="#l14.59"></a><span id="l14.59" class="difflineminus">-  {</span>
<a href="#l14.60"></a><span id="l14.60" class="difflineplus">+  customizeMailAlert() {</span>
<a href="#l14.61"></a><span id="l14.61">     gSubDialog.open(&quot;chrome://messenger/content/preferences/notifications.xul&quot;,</span>
<a href="#l14.62"></a><span id="l14.62">                     &quot;resizable=no&quot;);</span>
<a href="#l14.63"></a><span id="l14.63">   },</span>
<a href="#l14.64"></a><span id="l14.64"> </span>
<a href="#l14.65"></a><span id="l14.65" class="difflineminus">-  configureDockOptions: function()</span>
<a href="#l14.66"></a><span id="l14.66" class="difflineminus">-  {</span>
<a href="#l14.67"></a><span id="l14.67" class="difflineplus">+  configureDockOptions() {</span>
<a href="#l14.68"></a><span id="l14.68">     gSubDialog.open(&quot;chrome://messenger/content/preferences/dockoptions.xul&quot;,</span>
<a href="#l14.69"></a><span id="l14.69">                     &quot;resizable=no&quot;);</span>
<a href="#l14.70"></a><span id="l14.70">   },</span>
<a href="#l14.71"></a><span id="l14.71"> </span>
<a href="#l14.72"></a><span id="l14.72" class="difflineminus">-  convertURLToLocalFile: function(aFileURL)</span>
<a href="#l14.73"></a><span id="l14.73" class="difflineminus">-  {</span>
<a href="#l14.74"></a><span id="l14.74" class="difflineplus">+  convertURLToLocalFile(aFileURL) {</span>
<a href="#l14.75"></a><span id="l14.75">     // convert the file url into a nsIFile</span>
<a href="#l14.76"></a><span id="l14.76" class="difflineminus">-    if (aFileURL)</span>
<a href="#l14.77"></a><span id="l14.77" class="difflineminus">-    {</span>
<a href="#l14.78"></a><span id="l14.78" class="difflineplus">+    if (aFileURL) {</span>
<a href="#l14.79"></a><span id="l14.79">       return Services.io</span>
<a href="#l14.80"></a><span id="l14.80">                      .getProtocolHandler(&quot;file&quot;)</span>
<a href="#l14.81"></a><span id="l14.81">                      .QueryInterface(Ci.nsIFileProtocolHandler)</span>
<a href="#l14.82"></a><span id="l14.82">                      .getFileFromURLSpec(aFileURL);</span>
<a href="#l14.83"></a><span id="l14.83">     }</span>
<a href="#l14.84"></a><span id="l14.84" class="difflineminus">-    else</span>
<a href="#l14.85"></a><span id="l14.85" class="difflineminus">-      return null;</span>
<a href="#l14.86"></a><span id="l14.86" class="difflineplus">+    return null;</span>
<a href="#l14.87"></a><span id="l14.87">   },</span>
<a href="#l14.88"></a><span id="l14.88"> </span>
<a href="#l14.89"></a><span id="l14.89" class="difflineminus">-  readSoundLocation: function()</span>
<a href="#l14.90"></a><span id="l14.90" class="difflineminus">-  {</span>
<a href="#l14.91"></a><span id="l14.91" class="difflineplus">+  readSoundLocation() {</span>
<a href="#l14.92"></a><span id="l14.92">     var soundUrlLocation = document.getElementById(&quot;soundUrlLocation&quot;);</span>
<a href="#l14.93"></a><span id="l14.93">     soundUrlLocation.value = document.getElementById(&quot;mail.biff.play_sound.url&quot;).value;</span>
<a href="#l14.94"></a><span id="l14.94" class="difflineminus">-    if (soundUrlLocation.value)</span>
<a href="#l14.95"></a><span id="l14.95" class="difflineminus">-    {</span>
<a href="#l14.96"></a><span id="l14.96" class="difflineplus">+    if (soundUrlLocation.value) {</span>
<a href="#l14.97"></a><span id="l14.97">       soundUrlLocation.label = this.convertURLToLocalFile(soundUrlLocation.value).leafName;</span>
<a href="#l14.98"></a><span id="l14.98">       soundUrlLocation.style.backgroundImage = &quot;url(moz-icon://&quot; + soundUrlLocation.label + &quot;?size=16)&quot;;</span>
<a href="#l14.99"></a><span id="l14.99">     }</span>
<a href="#l14.100"></a><span id="l14.100">     return undefined;</span>
<a href="#l14.101"></a><span id="l14.101">   },</span>
<a href="#l14.102"></a><span id="l14.102"> </span>
<a href="#l14.103"></a><span id="l14.103" class="difflineminus">-  previewSound: function ()</span>
<a href="#l14.104"></a><span id="l14.104" class="difflineminus">-  {</span>
<a href="#l14.105"></a><span id="l14.105" class="difflineplus">+  previewSound() {</span>
<a href="#l14.106"></a><span id="l14.106">     let sound = Cc[&quot;@mozilla.org/sound;1&quot;]</span>
<a href="#l14.107"></a><span id="l14.107">                   .createInstance(Ci.nsISound);</span>
<a href="#l14.108"></a><span id="l14.108"> </span>
<a href="#l14.109"></a><span id="l14.109">     let soundLocation;</span>
<a href="#l14.110"></a><span id="l14.110">     // soundType radio-group isn't used for macOS so it is not in the XUL file</span>
<a href="#l14.111"></a><span id="l14.111">     // for the platform.</span>
<a href="#l14.112"></a><span id="l14.112">     soundLocation = (AppConstants.platform == &quot;macosx&quot; ||</span>
<a href="#l14.113"></a><span id="l14.113" class="difflineminus">-                     document.getElementById('soundType').value == 1) ?</span>
<a href="#l14.114"></a><span id="l14.114" class="difflineminus">-                       document.getElementById('soundUrlLocation').value : &quot;&quot;;</span>
<a href="#l14.115"></a><span id="l14.115" class="difflineplus">+                     document.getElementById(&quot;soundType&quot;).value == 1) ?</span>
<a href="#l14.116"></a><span id="l14.116" class="difflineplus">+                       document.getElementById(&quot;soundUrlLocation&quot;).value : &quot;&quot;;</span>
<a href="#l14.117"></a><span id="l14.117"> </span>
<a href="#l14.118"></a><span id="l14.118">     if (!soundLocation.includes(&quot;file://&quot;)) {</span>
<a href="#l14.119"></a><span id="l14.119">       // User has not set any custom sound file to be played</span>
<a href="#l14.120"></a><span id="l14.120">       sound.playEventSound(Ci.nsISound.EVENT_NEW_MAIL_RECEIVED);</span>
<a href="#l14.121"></a><span id="l14.121">     } else {</span>
<a href="#l14.122"></a><span id="l14.122">       // User has set a custom audio file to be played along the alert.</span>
<a href="#l14.123"></a><span id="l14.123">       sound.play(Services.io.newURI(soundLocation));</span>
<a href="#l14.124"></a><span id="l14.124">     }</span>
<a href="#l14.125"></a><span id="l14.125">   },</span>
<a href="#l14.126"></a><span id="l14.126"> </span>
<a href="#l14.127"></a><span id="l14.127" class="difflineminus">-  browseForSoundFile: function ()</span>
<a href="#l14.128"></a><span id="l14.128" class="difflineminus">-  {</span>
<a href="#l14.129"></a><span id="l14.129" class="difflineplus">+  browseForSoundFile() {</span>
<a href="#l14.130"></a><span id="l14.130">     const nsIFilePicker = Ci.nsIFilePicker;</span>
<a href="#l14.131"></a><span id="l14.131">     var fp = Cc[&quot;@mozilla.org/filepicker;1&quot;].createInstance(nsIFilePicker);</span>
<a href="#l14.132"></a><span id="l14.132"> </span>
<a href="#l14.133"></a><span id="l14.133">     // if we already have a sound file, then use the path for that sound file</span>
<a href="#l14.134"></a><span id="l14.134">     // as the initial path in the dialog.</span>
<a href="#l14.135"></a><span id="l14.135" class="difflineminus">-    var localFile = this.convertURLToLocalFile(document.getElementById('soundUrlLocation').value);</span>
<a href="#l14.136"></a><span id="l14.136" class="difflineplus">+    var localFile = this.convertURLToLocalFile(document.getElementById(&quot;soundUrlLocation&quot;).value);</span>
<a href="#l14.137"></a><span id="l14.137">     if (localFile)</span>
<a href="#l14.138"></a><span id="l14.138">       fp.displayDirectory = localFile.parent;</span>
<a href="#l14.139"></a><span id="l14.139"> </span>
<a href="#l14.140"></a><span id="l14.140">     // XXX todo, persist the last sound directory and pass it in</span>
<a href="#l14.141"></a><span id="l14.141">     fp.init(window, document.getElementById(&quot;bundlePreferences&quot;).getString(&quot;soundFilePickerTitle&quot;), nsIFilePicker.modeOpen);</span>
<a href="#l14.142"></a><span id="l14.142"> </span>
<a href="#l14.143"></a><span id="l14.143">     // On Mac, allow AIFF and CAF files too</span>
<a href="#l14.144"></a><span id="l14.144">     var bundlePrefs = document.getElementById(&quot;bundlePreferences&quot;);</span>
<a href="#l14.145"></a><span id="l14.145" class="difflineat">@@ -137,77 +124,74 @@ var gGeneralPane = {</span>
<a href="#l14.146"></a><span id="l14.146">       }</span>
<a href="#l14.147"></a><span id="l14.147">       // convert the nsIFile into a nsIFile url</span>
<a href="#l14.148"></a><span id="l14.148">       document.getElementById(&quot;mail.biff.play_sound.url&quot;).value = fp.fileURL.spec;</span>
<a href="#l14.149"></a><span id="l14.149">       this.readSoundLocation(); // XXX We shouldn't have to be doing this by hand</span>
<a href="#l14.150"></a><span id="l14.150">       this.updatePlaySound();</span>
<a href="#l14.151"></a><span id="l14.151">     });</span>
<a href="#l14.152"></a><span id="l14.152">   },</span>
<a href="#l14.153"></a><span id="l14.153"> </span>
<a href="#l14.154"></a><span id="l14.154" class="difflineminus">-  updatePlaySound: function()</span>
<a href="#l14.155"></a><span id="l14.155" class="difflineminus">-  {</span>
<a href="#l14.156"></a><span id="l14.156" class="difflineplus">+  updatePlaySound() {</span>
<a href="#l14.157"></a><span id="l14.157">     // Update the sound type radio buttons based on the state of the</span>
<a href="#l14.158"></a><span id="l14.158">     // play sound checkbox.</span>
<a href="#l14.159"></a><span id="l14.159" class="difflineminus">-    var soundsDisabled = !document.getElementById('newMailNotification').checked;</span>
<a href="#l14.160"></a><span id="l14.160" class="difflineminus">-    var soundUrlLocation = document.getElementById('soundUrlLocation').value;</span>
<a href="#l14.161"></a><span id="l14.161" class="difflineplus">+    var soundsDisabled = !document.getElementById(&quot;newMailNotification&quot;).checked;</span>
<a href="#l14.162"></a><span id="l14.162" class="difflineplus">+    var soundUrlLocation = document.getElementById(&quot;soundUrlLocation&quot;).value;</span>
<a href="#l14.163"></a><span id="l14.163"> </span>
<a href="#l14.164"></a><span id="l14.164">     // The UI is different on OS X as the user can only choose between letting</span>
<a href="#l14.165"></a><span id="l14.165">     // the system play a default sound or setting a custom one. Therefore,</span>
<a href="#l14.166"></a><span id="l14.166">     // &quot;soundTypeEl&quot; does not exist on OS X.</span>
<a href="#l14.167"></a><span id="l14.167">     if (AppConstants.platform != &quot;macosx&quot;) {</span>
<a href="#l14.168"></a><span id="l14.168" class="difflineminus">-      var soundTypeEl = document.getElementById('soundType');</span>
<a href="#l14.169"></a><span id="l14.169" class="difflineplus">+      var soundTypeEl = document.getElementById(&quot;soundType&quot;);</span>
<a href="#l14.170"></a><span id="l14.170">       soundTypeEl.disabled = soundsDisabled;</span>
<a href="#l14.171"></a><span id="l14.171">       document.getElementById(&quot;soundUrlLocation&quot;).disabled =</span>
<a href="#l14.172"></a><span id="l14.172">         soundsDisabled || soundTypeEl.value != 1;</span>
<a href="#l14.173"></a><span id="l14.173" class="difflineminus">-      document.getElementById('playSound').disabled =</span>
<a href="#l14.174"></a><span id="l14.174" class="difflineplus">+      document.getElementById(&quot;playSound&quot;).disabled =</span>
<a href="#l14.175"></a><span id="l14.175">         soundsDisabled || (!soundUrlLocation &amp;&amp; soundTypeEl.value != 0);</span>
<a href="#l14.176"></a><span id="l14.176">     } else {</span>
<a href="#l14.177"></a><span id="l14.177">       // On OS X, if there is no selected custom sound then default one will</span>
<a href="#l14.178"></a><span id="l14.178">       // be played. We keep consistency by disabling the &quot;Play sound&quot; checkbox</span>
<a href="#l14.179"></a><span id="l14.179">       // if the user hasn't selected a custom sound file yet.</span>
<a href="#l14.180"></a><span id="l14.180" class="difflineminus">-      document.getElementById('newMailNotification').disabled = !soundUrlLocation;</span>
<a href="#l14.181"></a><span id="l14.181" class="difflineminus">-      document.getElementById('playSound').disabled = !soundUrlLocation;</span>
<a href="#l14.182"></a><span id="l14.182" class="difflineplus">+      document.getElementById(&quot;newMailNotification&quot;).disabled = !soundUrlLocation;</span>
<a href="#l14.183"></a><span id="l14.183" class="difflineplus">+      document.getElementById(&quot;playSound&quot;).disabled = !soundUrlLocation;</span>
<a href="#l14.184"></a><span id="l14.184">       // The sound type radiogroup is hidden, but we have to keep the</span>
<a href="#l14.185"></a><span id="l14.185">       // play_sound.type pref set appropriately.</span>
<a href="#l14.186"></a><span id="l14.186">       document.getElementById(&quot;mail.biff.play_sound.type&quot;).value =</span>
<a href="#l14.187"></a><span id="l14.187">         (!soundsDisabled &amp;&amp; soundUrlLocation) ? 1 : 0;</span>
<a href="#l14.188"></a><span id="l14.188">     }</span>
<a href="#l14.189"></a><span id="l14.189">   },</span>
<a href="#l14.190"></a><span id="l14.190"> </span>
<a href="#l14.191"></a><span id="l14.191" class="difflineminus">-  updateStartPage: function()</span>
<a href="#l14.192"></a><span id="l14.192" class="difflineminus">-  {</span>
<a href="#l14.193"></a><span id="l14.193" class="difflineplus">+  updateStartPage() {</span>
<a href="#l14.194"></a><span id="l14.194">     document.getElementById(&quot;mailnewsStartPageUrl&quot;).disabled =</span>
<a href="#l14.195"></a><span id="l14.195">       !document.getElementById(&quot;mailnewsStartPageEnabled&quot;).checked;</span>
<a href="#l14.196"></a><span id="l14.196">   },</span>
<a href="#l14.197"></a><span id="l14.197"> </span>
<a href="#l14.198"></a><span id="l14.198" class="difflineminus">-  updateCustomizeAlert: function()</span>
<a href="#l14.199"></a><span id="l14.199" class="difflineminus">-  {</span>
<a href="#l14.200"></a><span id="l14.200" class="difflineplus">+  updateCustomizeAlert() {</span>
<a href="#l14.201"></a><span id="l14.201">     // The button does not exist on all platforms.</span>
<a href="#l14.202"></a><span id="l14.202">     let customizeAlertButton = document.getElementById(&quot;customizeMailAlert&quot;);</span>
<a href="#l14.203"></a><span id="l14.203">     if (customizeAlertButton) {</span>
<a href="#l14.204"></a><span id="l14.204">       customizeAlertButton.disabled =</span>
<a href="#l14.205"></a><span id="l14.205">         !document.getElementById(&quot;newMailNotificationAlert&quot;).checked;</span>
<a href="#l14.206"></a><span id="l14.206">     }</span>
<a href="#l14.207"></a><span id="l14.207">   },</span>
<a href="#l14.208"></a><span id="l14.208"> </span>
<a href="#l14.209"></a><span id="l14.209" class="difflineminus">-  updateWebSearch: function() {</span>
<a href="#l14.210"></a><span id="l14.210" class="difflineplus">+  updateWebSearch() {</span>
<a href="#l14.211"></a><span id="l14.211">     Services.search.init({</span>
<a href="#l14.212"></a><span id="l14.212" class="difflineminus">-      onInitComplete: function() {</span>
<a href="#l14.213"></a><span id="l14.213" class="difflineplus">+      onInitComplete() {</span>
<a href="#l14.214"></a><span id="l14.214">         let engineList = document.getElementById(&quot;defaultWebSearch&quot;);</span>
<a href="#l14.215"></a><span id="l14.215">         for (let engine of Services.search.getVisibleEngines()) {</span>
<a href="#l14.216"></a><span id="l14.216">           let item = engineList.appendItem(engine.name);</span>
<a href="#l14.217"></a><span id="l14.217">           item.engine = engine;</span>
<a href="#l14.218"></a><span id="l14.218">           item.className = &quot;menuitem-iconic&quot;;</span>
<a href="#l14.219"></a><span id="l14.219">           item.setAttribute(</span>
<a href="#l14.220"></a><span id="l14.220">             &quot;image&quot;, engine.iconURI ? engine.iconURI.spec :</span>
<a href="#l14.221"></a><span id="l14.221">                      &quot;resource://gre-resources/broken-image.png&quot;</span>
<a href="#l14.222"></a><span id="l14.222">           );</span>
<a href="#l14.223"></a><span id="l14.223">           if (engine == Services.search.currentEngine)</span>
<a href="#l14.224"></a><span id="l14.224">             engineList.selectedItem = item;</span>
<a href="#l14.225"></a><span id="l14.225">         }</span>
<a href="#l14.226"></a><span id="l14.226"> </span>
<a href="#l14.227"></a><span id="l14.227">         engineList.addEventListener(&quot;command&quot;, function() {</span>
<a href="#l14.228"></a><span id="l14.228">           Services.search.currentEngine = engineList.selectedItem.engine;</span>
<a href="#l14.229"></a><span id="l14.229">         });</span>
<a href="#l14.230"></a><span id="l14.230" class="difflineminus">-      }</span>
<a href="#l14.231"></a><span id="l14.231" class="difflineplus">+      },</span>
<a href="#l14.232"></a><span id="l14.232">     });</span>
<a href="#l14.233"></a><span id="l14.233">   },</span>
<a href="#l14.234"></a><span id="l14.234"> };</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l15.1"></a><span id="l15.1" class="difflineminus">--- a/mail/components/preferences/messagestyle.js</span>
<a href="#l15.2"></a><span id="l15.2" class="difflineplus">+++ b/mail/components/preferences/messagestyle.js</span>
<a href="#l15.3"></a><span id="l15.3" class="difflineat">@@ -12,101 +12,100 @@ function Conversation(aName) {</span>
<a href="#l15.4"></a><span id="l15.4">   let now = new Date();</span>
<a href="#l15.5"></a><span id="l15.5">   this._date = new Date(now.getFullYear(), now.getMonth(), now.getDate(),</span>
<a href="#l15.6"></a><span id="l15.6">                         10, 42, 22) * 1000;</span>
<a href="#l15.7"></a><span id="l15.7"> }</span>
<a href="#l15.8"></a><span id="l15.8"> Conversation.prototype = {</span>
<a href="#l15.9"></a><span id="l15.9">   __proto__: jsProtoHelper.GenericConvIMPrototype,</span>
<a href="#l15.10"></a><span id="l15.10">   account: {protocol: {name: &quot;Fake Protocol&quot;},</span>
<a href="#l15.11"></a><span id="l15.11">             alias: &quot;&quot;, name: &quot;Fake Account&quot;,</span>
<a href="#l15.12"></a><span id="l15.12" class="difflineminus">-            statusInfo: Services.core.globalUserStatus}</span>
<a href="#l15.13"></a><span id="l15.13" class="difflineplus">+            statusInfo: Services.core.globalUserStatus},</span>
<a href="#l15.14"></a><span id="l15.14"> };</span>
<a href="#l15.15"></a><span id="l15.15"> </span>
<a href="#l15.16"></a><span id="l15.16"> function Message(aWho, aMessage, aObject) {</span>
<a href="#l15.17"></a><span id="l15.17">   this._init(aWho, aMessage, aObject);</span>
<a href="#l15.18"></a><span id="l15.18"> }</span>
<a href="#l15.19"></a><span id="l15.19"> Message.prototype = {</span>
<a href="#l15.20"></a><span id="l15.20">   __proto__: jsProtoHelper.GenericMessagePrototype,</span>
<a href="#l15.21"></a><span id="l15.21" class="difflineminus">-  get displayMessage() { return this.originalMessage; }</span>
<a href="#l15.22"></a><span id="l15.22" class="difflineplus">+  get displayMessage() { return this.originalMessage; },</span>
<a href="#l15.23"></a><span id="l15.23"> };</span>
<a href="#l15.24"></a><span id="l15.24"> </span>
<a href="#l15.25"></a><span id="l15.25"> // Message style tooltips use this.</span>
<a href="#l15.26"></a><span id="l15.26"> function getBrowser() { return document.getElementById(&quot;previewbrowser&quot;); }</span>
<a href="#l15.27"></a><span id="l15.27"> </span>
<a href="#l15.28"></a><span id="l15.28"> var previewObserver = {</span>
<a href="#l15.29"></a><span id="l15.29">   _loaded: false,</span>
<a href="#l15.30"></a><span id="l15.30" class="difflineminus">-  load: function() {</span>
<a href="#l15.31"></a><span id="l15.31" class="difflineplus">+  load() {</span>
<a href="#l15.32"></a><span id="l15.32">     let makeDate = function(aDateString) {</span>
<a href="#l15.33"></a><span id="l15.33">       let array = aDateString.split(&quot;:&quot;);</span>
<a href="#l15.34"></a><span id="l15.34">       let now = new Date();</span>
<a href="#l15.35"></a><span id="l15.35">       return (new Date(now.getFullYear(), now.getMonth(), now.getDate(),</span>
<a href="#l15.36"></a><span id="l15.36">                        array[0], array[1], array[2])) / 1000;</span>
<a href="#l15.37"></a><span id="l15.37">     };</span>
<a href="#l15.38"></a><span id="l15.38">     let bundle = document.getElementById(&quot;themesBundle&quot;);</span>
<a href="#l15.39"></a><span id="l15.39">     let msg = {};</span>
<a href="#l15.40"></a><span id="l15.40">     [&quot;nick1&quot;, &quot;buddy1&quot;, &quot;nick2&quot;, &quot;buddy2&quot;,</span>
<a href="#l15.41"></a><span id="l15.41">      &quot;message1&quot;, &quot;message2&quot;, &quot;message3&quot;].forEach(function(aText) {</span>
<a href="#l15.42"></a><span id="l15.42">       msg[aText] = bundle.getString(aText);</span>
<a href="#l15.43"></a><span id="l15.43">     });</span>
<a href="#l15.44"></a><span id="l15.44">     let conv = new Conversation(msg.nick2);</span>
<a href="#l15.45"></a><span id="l15.45">     conv.messages = [</span>
<a href="#l15.46"></a><span id="l15.46">       new Message(msg.buddy1, msg.message1, {outgoing: true, _alias: msg.nick1, time: makeDate(&quot;10:42:22&quot;), _conversation: conv}),</span>
<a href="#l15.47"></a><span id="l15.47">       new Message(msg.buddy1, msg.message2, {outgoing: true, _alias: msg.nick1, time: makeDate(&quot;10:42:25&quot;), _conversation: conv}),</span>
<a href="#l15.48"></a><span id="l15.48" class="difflineminus">-      new Message(msg.buddy2, msg.message3, {incoming: true, _alias: msg.nick2, time: makeDate(&quot;10:43:01&quot;), _conversation: conv})</span>
<a href="#l15.49"></a><span id="l15.49" class="difflineplus">+      new Message(msg.buddy2, msg.message3, {incoming: true, _alias: msg.nick2, time: makeDate(&quot;10:43:01&quot;), _conversation: conv}),</span>
<a href="#l15.50"></a><span id="l15.50">     ];</span>
<a href="#l15.51"></a><span id="l15.51">     previewObserver.conv = conv;</span>
<a href="#l15.52"></a><span id="l15.52"> </span>
<a href="#l15.53"></a><span id="l15.53">     let themeName = document.getElementById(&quot;messagestyle-themename&quot;);</span>
<a href="#l15.54"></a><span id="l15.54">     if (themeName.value &amp;&amp; !themeName.selectedItem)</span>
<a href="#l15.55"></a><span id="l15.55">       themeName.value = themeName.value;</span>
<a href="#l15.56"></a><span id="l15.56">     previewObserver.browser = document.getElementById(&quot;previewbrowser&quot;);</span>
<a href="#l15.57"></a><span id="l15.57">     document.getElementById(&quot;showHeaderCheckbox&quot;)</span>
<a href="#l15.58"></a><span id="l15.58">             .addEventListener(&quot;CheckboxStateChange&quot;,</span>
<a href="#l15.59"></a><span id="l15.59">                               previewObserver.showHeaderChanged);</span>
<a href="#l15.60"></a><span id="l15.60">     previewObserver.displayTheme(themeName.value);</span>
<a href="#l15.61"></a><span id="l15.61">     this._loaded = true;</span>
<a href="#l15.62"></a><span id="l15.62">   },</span>
<a href="#l15.63"></a><span id="l15.63"> </span>
<a href="#l15.64"></a><span id="l15.64" class="difflineminus">-  showHeaderChanged: function() {</span>
<a href="#l15.65"></a><span id="l15.65" class="difflineplus">+  showHeaderChanged() {</span>
<a href="#l15.66"></a><span id="l15.66">     if (!previewObserver._loaded)</span>
<a href="#l15.67"></a><span id="l15.67">       return;</span>
<a href="#l15.68"></a><span id="l15.68"> </span>
<a href="#l15.69"></a><span id="l15.69">     previewObserver.theme.showHeader = this.checked;</span>
<a href="#l15.70"></a><span id="l15.70">     previewObserver.reloadPreview();</span>
<a href="#l15.71"></a><span id="l15.71">   },</span>
<a href="#l15.72"></a><span id="l15.72"> </span>
<a href="#l15.73"></a><span id="l15.73" class="difflineminus">-  currentThemeChanged: function() {</span>
<a href="#l15.74"></a><span id="l15.74" class="difflineplus">+  currentThemeChanged() {</span>
<a href="#l15.75"></a><span id="l15.75">     if (!this._loaded)</span>
<a href="#l15.76"></a><span id="l15.76">       return;</span>
<a href="#l15.77"></a><span id="l15.77"> </span>
<a href="#l15.78"></a><span id="l15.78">     let currentTheme = document.getElementById(&quot;messagestyle-themename&quot;).value;</span>
<a href="#l15.79"></a><span id="l15.79">     if (!currentTheme)</span>
<a href="#l15.80"></a><span id="l15.80">       return;</span>
<a href="#l15.81"></a><span id="l15.81"> </span>
<a href="#l15.82"></a><span id="l15.82">     this.displayTheme(currentTheme);</span>
<a href="#l15.83"></a><span id="l15.83">   },</span>
<a href="#l15.84"></a><span id="l15.84"> </span>
<a href="#l15.85"></a><span id="l15.85">   _ignoreVariantChange: false,</span>
<a href="#l15.86"></a><span id="l15.86" class="difflineminus">-  currentVariantChanged: function() {</span>
<a href="#l15.87"></a><span id="l15.87" class="difflineplus">+  currentVariantChanged() {</span>
<a href="#l15.88"></a><span id="l15.88">     if (!this._loaded || this._ignoreVariantChange)</span>
<a href="#l15.89"></a><span id="l15.89">       return;</span>
<a href="#l15.90"></a><span id="l15.90"> </span>
<a href="#l15.91"></a><span id="l15.91">     let variant = document.getElementById(&quot;themevariant&quot;).value;</span>
<a href="#l15.92"></a><span id="l15.92">     if (!variant)</span>
<a href="#l15.93"></a><span id="l15.93">       return;</span>
<a href="#l15.94"></a><span id="l15.94"> </span>
<a href="#l15.95"></a><span id="l15.95">     this.theme.variant = variant;</span>
<a href="#l15.96"></a><span id="l15.96">     this.reloadPreview();</span>
<a href="#l15.97"></a><span id="l15.97">   },</span>
<a href="#l15.98"></a><span id="l15.98"> </span>
<a href="#l15.99"></a><span id="l15.99" class="difflineminus">-  displayTheme: function(aTheme) {</span>
<a href="#l15.100"></a><span id="l15.100" class="difflineplus">+  displayTheme(aTheme) {</span>
<a href="#l15.101"></a><span id="l15.101">     try {</span>
<a href="#l15.102"></a><span id="l15.102">       this.theme = getThemeByName(aTheme);</span>
<a href="#l15.103"></a><span id="l15.103" class="difflineminus">-    }</span>
<a href="#l15.104"></a><span id="l15.104" class="difflineminus">-    catch(e) {</span>
<a href="#l15.105"></a><span id="l15.105" class="difflineplus">+    } catch (e) {</span>
<a href="#l15.106"></a><span id="l15.106">       document.getElementById(&quot;previewDeck&quot;).selectedIndex = 0;</span>
<a href="#l15.107"></a><span id="l15.107">       return;</span>
<a href="#l15.108"></a><span id="l15.108">     }</span>
<a href="#l15.109"></a><span id="l15.109"> </span>
<a href="#l15.110"></a><span id="l15.110">     let menulist = document.getElementById(&quot;themevariant&quot;);</span>
<a href="#l15.111"></a><span id="l15.111">     if (menulist.firstChild)</span>
<a href="#l15.112"></a><span id="l15.112">       menulist.firstChild.remove();</span>
<a href="#l15.113"></a><span id="l15.113">     let popup = menulist.appendChild(document.createElement(&quot;menupopup&quot;));</span>
<a href="#l15.114"></a><span id="l15.114" class="difflineat">@@ -155,23 +154,23 @@ var previewObserver = {</span>
<a href="#l15.115"></a><span id="l15.115"> </span>
<a href="#l15.116"></a><span id="l15.116">     document.getElementById(&quot;showHeaderCheckbox&quot;).disabled =</span>
<a href="#l15.117"></a><span id="l15.117">       !this.theme.html.hasOwnProperty(&quot;header&quot;);</span>
<a href="#l15.118"></a><span id="l15.118"> </span>
<a href="#l15.119"></a><span id="l15.119">     this.reloadPreview();</span>
<a href="#l15.120"></a><span id="l15.120">     document.getElementById(&quot;previewDeck&quot;).selectedIndex = 1;</span>
<a href="#l15.121"></a><span id="l15.121">   },</span>
<a href="#l15.122"></a><span id="l15.122"> </span>
<a href="#l15.123"></a><span id="l15.123" class="difflineminus">-  reloadPreview: function() {</span>
<a href="#l15.124"></a><span id="l15.124" class="difflineplus">+  reloadPreview() {</span>
<a href="#l15.125"></a><span id="l15.125">     this.browser.init(this.conv);</span>
<a href="#l15.126"></a><span id="l15.126">     this.browser._theme = this.theme;</span>
<a href="#l15.127"></a><span id="l15.127">     Services.obs.addObserver(this, &quot;conversation-loaded&quot;);</span>
<a href="#l15.128"></a><span id="l15.128">   },</span>
<a href="#l15.129"></a><span id="l15.129"> </span>
<a href="#l15.130"></a><span id="l15.130" class="difflineminus">-  observe: function(aSubject, aTopic, aData) {</span>
<a href="#l15.131"></a><span id="l15.131" class="difflineplus">+  observe(aSubject, aTopic, aData) {</span>
<a href="#l15.132"></a><span id="l15.132">     if (aTopic != &quot;conversation-loaded&quot; || aSubject != this.browser)</span>
<a href="#l15.133"></a><span id="l15.133">       return;</span>
<a href="#l15.134"></a><span id="l15.134"> </span>
<a href="#l15.135"></a><span id="l15.135">     // We want to avoid the convbrowser trying to scroll to the last</span>
<a href="#l15.136"></a><span id="l15.136">     // added message, as that causes the entire pref pane to jump up</span>
<a href="#l15.137"></a><span id="l15.137">     // (bug 1179943). Therefore, we override the method convbrowser</span>
<a href="#l15.138"></a><span id="l15.138">     // uses to determine if it should scroll, as well as its</span>
<a href="#l15.139"></a><span id="l15.139">     // mirror in the contentWindow (that messagestyle JS can call).</span>
<a href="#l15.140"></a><span id="l15.140" class="difflineat">@@ -181,10 +180,10 @@ var previewObserver = {</span>
<a href="#l15.141"></a><span id="l15.141">     // Display all queued messages. Use a timeout so that message text</span>
<a href="#l15.142"></a><span id="l15.142">     // modifiers can be added with observers for this notification.</span>
<a href="#l15.143"></a><span id="l15.143">     setTimeout(function() {</span>
<a href="#l15.144"></a><span id="l15.144">       for (let message of previewObserver.conv.messages)</span>
<a href="#l15.145"></a><span id="l15.145">         aSubject.appendMessage(message, false);</span>
<a href="#l15.146"></a><span id="l15.146">     }, 0);</span>
<a href="#l15.147"></a><span id="l15.147"> </span>
<a href="#l15.148"></a><span id="l15.148">     Services.obs.removeObserver(this, &quot;conversation-loaded&quot;);</span>
<a href="#l15.149"></a><span id="l15.149" class="difflineminus">-  }</span>
<a href="#l15.150"></a><span id="l15.150" class="difflineplus">+  },</span>
<a href="#l15.151"></a><span id="l15.151"> };</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l16.1"></a><span id="l16.1" class="difflineminus">--- a/mail/components/preferences/offline.js</span>
<a href="#l16.2"></a><span id="l16.2" class="difflineplus">+++ b/mail/components/preferences/offline.js</span>
<a href="#l16.3"></a><span id="l16.3" class="difflineat">@@ -1,21 +1,19 @@</span>
<a href="#l16.4"></a><span id="l16.4"> /* This Source Code Form is subject to the terms of the Mozilla Public</span>
<a href="#l16.5"></a><span id="l16.5">  * License, v. 2.0. If a copy of the MPL was not distributed with this</span>
<a href="#l16.6"></a><span id="l16.6">  * file, You can obtain one at http://mozilla.org/MPL/2.0/. */</span>
<a href="#l16.7"></a><span id="l16.7"> </span>
<a href="#l16.8"></a><span id="l16.8"> var kAutomatic         = 4;</span>
<a href="#l16.9"></a><span id="l16.9"> var kRememberLastState = 0;</span>
<a href="#l16.10"></a><span id="l16.10"> </span>
<a href="#l16.11"></a><span id="l16.11"> var gOfflineDialog = {</span>
<a href="#l16.12"></a><span id="l16.12" class="difflineminus">-  dialogSetup: function() {</span>
<a href="#l16.13"></a><span id="l16.13" class="difflineplus">+  dialogSetup() {</span>
<a href="#l16.14"></a><span id="l16.14">     let offlineAutoDetection = document.getElementById(&quot;offline.autoDetect&quot;);</span>
<a href="#l16.15"></a><span id="l16.15">     let offlineStartupStatePref = document.getElementById(&quot;offline.startup_state&quot;);</span>
<a href="#l16.16"></a><span id="l16.16"> </span>
<a href="#l16.17"></a><span id="l16.17">     offlineStartupStatePref.disabled = offlineAutoDetection.value;</span>
<a href="#l16.18"></a><span id="l16.18">     if (offlineStartupStatePref.disabled) {</span>
<a href="#l16.19"></a><span id="l16.19">       offlineStartupStatePref.value = kAutomatic;</span>
<a href="#l16.20"></a><span id="l16.20" class="difflineminus">-    } else {</span>
<a href="#l16.21"></a><span id="l16.21" class="difflineminus">-      if (offlineStartupStatePref.value == kAutomatic)</span>
<a href="#l16.22"></a><span id="l16.22" class="difflineplus">+    } else if (offlineStartupStatePref.value == kAutomatic)</span>
<a href="#l16.23"></a><span id="l16.23">         offlineStartupStatePref.value = kRememberLastState;</span>
<a href="#l16.24"></a><span id="l16.24" class="difflineminus">-    }</span>
<a href="#l16.25"></a><span id="l16.25" class="difflineminus">-  }</span>
<a href="#l16.26"></a><span id="l16.26" class="difflineplus">+  },</span>
<a href="#l16.27"></a><span id="l16.27"> };</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l17.1"></a><span id="l17.1" class="difflineminus">--- a/mail/components/preferences/permissions.js</span>
<a href="#l17.2"></a><span id="l17.2" class="difflineplus">+++ b/mail/components/preferences/permissions.js</span>
<a href="#l17.3"></a><span id="l17.3" class="difflineat">@@ -11,68 +11,64 @@ var nsICookiePermission = Ci.nsICookiePe</span>
<a href="#l17.4"></a><span id="l17.4"> var NOTIFICATION_FLUSH_PERMISSIONS = &quot;flush-pending-permissions&quot;;</span>
<a href="#l17.5"></a><span id="l17.5"> </span>
<a href="#l17.6"></a><span id="l17.6"> /**</span>
<a href="#l17.7"></a><span id="l17.7">  * Magic URI base used so the permission manager can store</span>
<a href="#l17.8"></a><span id="l17.8">  * remote content permissions for a given email address.</span>
<a href="#l17.9"></a><span id="l17.9">  */</span>
<a href="#l17.10"></a><span id="l17.10"> var MAILURI_BASE = &quot;chrome://messenger/content/email=&quot;;</span>
<a href="#l17.11"></a><span id="l17.11"> </span>
<a href="#l17.12"></a><span id="l17.12" class="difflineminus">-function Permission(principal, type, capability)</span>
<a href="#l17.13"></a><span id="l17.13" class="difflineminus">-{</span>
<a href="#l17.14"></a><span id="l17.14" class="difflineplus">+function Permission(principal, type, capability) {</span>
<a href="#l17.15"></a><span id="l17.15">   this.principal = principal;</span>
<a href="#l17.16"></a><span id="l17.16">   this.origin = principal.origin;</span>
<a href="#l17.17"></a><span id="l17.17">   this.type = type;</span>
<a href="#l17.18"></a><span id="l17.18">   this.capability = capability;</span>
<a href="#l17.19"></a><span id="l17.19"> }</span>
<a href="#l17.20"></a><span id="l17.20"> </span>
<a href="#l17.21"></a><span id="l17.21"> var gPermissionManager = {</span>
<a href="#l17.22"></a><span id="l17.22" class="difflineminus">-  _type                 : &quot;&quot;,</span>
<a href="#l17.23"></a><span id="l17.23" class="difflineminus">-  _permissions          : [],</span>
<a href="#l17.24"></a><span id="l17.24" class="difflineminus">-  _permissionsToAdd     : new Map(),</span>
<a href="#l17.25"></a><span id="l17.25" class="difflineminus">-  _permissionsToDelete  : new Map(),</span>
<a href="#l17.26"></a><span id="l17.26" class="difflineminus">-  _bundle               : null,</span>
<a href="#l17.27"></a><span id="l17.27" class="difflineminus">-  _tree                 : null,</span>
<a href="#l17.28"></a><span id="l17.28" class="difflineminus">-  _observerRemoved      : false,</span>
<a href="#l17.29"></a><span id="l17.29" class="difflineplus">+  _type: &quot;&quot;,</span>
<a href="#l17.30"></a><span id="l17.30" class="difflineplus">+  _permissions: [],</span>
<a href="#l17.31"></a><span id="l17.31" class="difflineplus">+  _permissionsToAdd: new Map(),</span>
<a href="#l17.32"></a><span id="l17.32" class="difflineplus">+  _permissionsToDelete: new Map(),</span>
<a href="#l17.33"></a><span id="l17.33" class="difflineplus">+  _bundle: null,</span>
<a href="#l17.34"></a><span id="l17.34" class="difflineplus">+  _tree: null,</span>
<a href="#l17.35"></a><span id="l17.35" class="difflineplus">+  _observerRemoved: false,</span>
<a href="#l17.36"></a><span id="l17.36"> </span>
<a href="#l17.37"></a><span id="l17.37">   _view: {</span>
<a href="#l17.38"></a><span id="l17.38">     _rowCount: 0,</span>
<a href="#l17.39"></a><span id="l17.39" class="difflineminus">-    get rowCount()</span>
<a href="#l17.40"></a><span id="l17.40" class="difflineminus">-    {</span>
<a href="#l17.41"></a><span id="l17.41" class="difflineplus">+    get rowCount() {</span>
<a href="#l17.42"></a><span id="l17.42">       return this._rowCount;</span>
<a href="#l17.43"></a><span id="l17.43">     },</span>
<a href="#l17.44"></a><span id="l17.44" class="difflineminus">-    getCellText: function (aRow, aColumn)</span>
<a href="#l17.45"></a><span id="l17.45" class="difflineminus">-    {</span>
<a href="#l17.46"></a><span id="l17.46" class="difflineplus">+    getCellText(aRow, aColumn) {</span>
<a href="#l17.47"></a><span id="l17.47">       if (aColumn.id == &quot;siteCol&quot;)</span>
<a href="#l17.48"></a><span id="l17.48">         return gPermissionManager._permissions[aRow].origin</span>
<a href="#l17.49"></a><span id="l17.49">           .replace(MAILURI_BASE, &quot;&quot;);</span>
<a href="#l17.50"></a><span id="l17.50">       else if (aColumn.id == &quot;statusCol&quot;)</span>
<a href="#l17.51"></a><span id="l17.51">         return gPermissionManager._permissions[aRow].capability;</span>
<a href="#l17.52"></a><span id="l17.52">       return &quot;&quot;;</span>
<a href="#l17.53"></a><span id="l17.53">     },</span>
<a href="#l17.54"></a><span id="l17.54"> </span>
<a href="#l17.55"></a><span id="l17.55" class="difflineminus">-    isSeparator: function(aIndex) { return false; },</span>
<a href="#l17.56"></a><span id="l17.56" class="difflineminus">-    isSorted: function() { return false; },</span>
<a href="#l17.57"></a><span id="l17.57" class="difflineminus">-    isContainer: function(aIndex) { return false; },</span>
<a href="#l17.58"></a><span id="l17.58" class="difflineminus">-    setTree: function(aTree){},</span>
<a href="#l17.59"></a><span id="l17.59" class="difflineminus">-    getImageSrc: function(aRow, aColumn) {},</span>
<a href="#l17.60"></a><span id="l17.60" class="difflineminus">-    getProgressMode: function(aRow, aColumn) {},</span>
<a href="#l17.61"></a><span id="l17.61" class="difflineminus">-    getCellValue: function(aRow, aColumn) {},</span>
<a href="#l17.62"></a><span id="l17.62" class="difflineminus">-    cycleHeader: function(column) {},</span>
<a href="#l17.63"></a><span id="l17.63" class="difflineminus">-    getRowProperties: function(row){ return &quot;&quot;; },</span>
<a href="#l17.64"></a><span id="l17.64" class="difflineminus">-    getColumnProperties: function(column){ return &quot;&quot;; },</span>
<a href="#l17.65"></a><span id="l17.65" class="difflineminus">-    getCellProperties: function(row,column){</span>
<a href="#l17.66"></a><span id="l17.66" class="difflineplus">+    isSeparator(aIndex) { return false; },</span>
<a href="#l17.67"></a><span id="l17.67" class="difflineplus">+    isSorted() { return false; },</span>
<a href="#l17.68"></a><span id="l17.68" class="difflineplus">+    isContainer(aIndex) { return false; },</span>
<a href="#l17.69"></a><span id="l17.69" class="difflineplus">+    setTree(aTree) {},</span>
<a href="#l17.70"></a><span id="l17.70" class="difflineplus">+    getImageSrc(aRow, aColumn) {},</span>
<a href="#l17.71"></a><span id="l17.71" class="difflineplus">+    getProgressMode(aRow, aColumn) {},</span>
<a href="#l17.72"></a><span id="l17.72" class="difflineplus">+    getCellValue(aRow, aColumn) {},</span>
<a href="#l17.73"></a><span id="l17.73" class="difflineplus">+    cycleHeader(column) {},</span>
<a href="#l17.74"></a><span id="l17.74" class="difflineplus">+    getRowProperties(row) { return &quot;&quot;; },</span>
<a href="#l17.75"></a><span id="l17.75" class="difflineplus">+    getColumnProperties(column) { return &quot;&quot;; },</span>
<a href="#l17.76"></a><span id="l17.76" class="difflineplus">+    getCellProperties(row, column) {</span>
<a href="#l17.77"></a><span id="l17.77">       if (column.element.getAttribute(&quot;id&quot;) == &quot;siteCol&quot;)</span>
<a href="#l17.78"></a><span id="l17.78">         return &quot;ltr&quot;;</span>
<a href="#l17.79"></a><span id="l17.79">       return &quot;&quot;;</span>
<a href="#l17.80"></a><span id="l17.80" class="difflineminus">-    }</span>
<a href="#l17.81"></a><span id="l17.81" class="difflineplus">+    },</span>
<a href="#l17.82"></a><span id="l17.82">   },</span>
<a href="#l17.83"></a><span id="l17.83"> </span>
<a href="#l17.84"></a><span id="l17.84" class="difflineminus">-  _getCapabilityString: function (aCapability)</span>
<a href="#l17.85"></a><span id="l17.85" class="difflineminus">-  {</span>
<a href="#l17.86"></a><span id="l17.86" class="difflineplus">+  _getCapabilityString(aCapability) {</span>
<a href="#l17.87"></a><span id="l17.87">     var stringKey = null;</span>
<a href="#l17.88"></a><span id="l17.88">     switch (aCapability) {</span>
<a href="#l17.89"></a><span id="l17.89">     case nsIPermissionManager.ALLOW_ACTION:</span>
<a href="#l17.90"></a><span id="l17.90">       stringKey = &quot;can&quot;;</span>
<a href="#l17.91"></a><span id="l17.91">       break;</span>
<a href="#l17.92"></a><span id="l17.92">     case nsIPermissionManager.DENY_ACTION:</span>
<a href="#l17.93"></a><span id="l17.93">       stringKey = &quot;cannot&quot;;</span>
<a href="#l17.94"></a><span id="l17.94">       break;</span>
<a href="#l17.95"></a><span id="l17.95" class="difflineat">@@ -81,18 +77,17 @@ var gPermissionManager = {</span>
<a href="#l17.96"></a><span id="l17.96">       break;</span>
<a href="#l17.97"></a><span id="l17.97">     case nsICookiePermission.ACCESS_SESSION:</span>
<a href="#l17.98"></a><span id="l17.98">       stringKey = &quot;canSession&quot;;</span>
<a href="#l17.99"></a><span id="l17.99">       break;</span>
<a href="#l17.100"></a><span id="l17.100">     }</span>
<a href="#l17.101"></a><span id="l17.101">     return this._bundle.getString(stringKey);</span>
<a href="#l17.102"></a><span id="l17.102">   },</span>
<a href="#l17.103"></a><span id="l17.103"> </span>
<a href="#l17.104"></a><span id="l17.104" class="difflineminus">-  addPermission: function (aCapability)</span>
<a href="#l17.105"></a><span id="l17.105" class="difflineminus">-  {</span>
<a href="#l17.106"></a><span id="l17.106" class="difflineplus">+  addPermission(aCapability) {</span>
<a href="#l17.107"></a><span id="l17.107">     var textbox = document.getElementById(&quot;url&quot;);</span>
<a href="#l17.108"></a><span id="l17.108">     var input_url = textbox.value.trim();</span>
<a href="#l17.109"></a><span id="l17.109">     let principal;</span>
<a href="#l17.110"></a><span id="l17.110">     try {</span>
<a href="#l17.111"></a><span id="l17.111">       // The origin accessor on the principal object will throw if the</span>
<a href="#l17.112"></a><span id="l17.112">       // principal doesn't have a canonical origin representation. This will</span>
<a href="#l17.113"></a><span id="l17.113">       // help catch cases where the URI parser parsed something like</span>
<a href="#l17.114"></a><span id="l17.114">       // `localhost:8080` as having the scheme `localhost`, rather than being</span>
<a href="#l17.115"></a><span id="l17.115" class="difflineat">@@ -100,25 +95,25 @@ var gPermissionManager = {</span>
<a href="#l17.116"></a><span id="l17.116">       // permission manager for storage, so this won't prevent any valid</span>
<a href="#l17.117"></a><span id="l17.117">       // permissions from being entered by the user.</span>
<a href="#l17.118"></a><span id="l17.118">       let uri;</span>
<a href="#l17.119"></a><span id="l17.119">       try {</span>
<a href="#l17.120"></a><span id="l17.120">         uri = Services.io.newURI(input_url);</span>
<a href="#l17.121"></a><span id="l17.121">         principal = Services.scriptSecurityManager.createCodebasePrincipal(uri, {});</span>
<a href="#l17.122"></a><span id="l17.122">         // If we have ended up with an unknown scheme, the following will throw.</span>
<a href="#l17.123"></a><span id="l17.123">         principal.origin;</span>
<a href="#l17.124"></a><span id="l17.124" class="difflineminus">-      } catch(ex) {</span>
<a href="#l17.125"></a><span id="l17.125" class="difflineplus">+      } catch (ex) {</span>
<a href="#l17.126"></a><span id="l17.126">         let scheme = (this._type != &quot;image&quot; || !input_url.includes(&quot;@&quot;)) ?</span>
<a href="#l17.127"></a><span id="l17.127">           &quot;http://&quot; : MAILURI_BASE;</span>
<a href="#l17.128"></a><span id="l17.128">         uri = Services.io.newURI(scheme + input_url);</span>
<a href="#l17.129"></a><span id="l17.129">         principal = Services.scriptSecurityManager.createCodebasePrincipal(uri, {});</span>
<a href="#l17.130"></a><span id="l17.130">         // If we have ended up with an unknown scheme, the following will throw.</span>
<a href="#l17.131"></a><span id="l17.131">         principal.origin;</span>
<a href="#l17.132"></a><span id="l17.132">       }</span>
<a href="#l17.133"></a><span id="l17.133" class="difflineminus">-    } catch(ex) {</span>
<a href="#l17.134"></a><span id="l17.134" class="difflineplus">+    } catch (ex) {</span>
<a href="#l17.135"></a><span id="l17.135">       var message = this._bundle.getString(&quot;invalidURI&quot;);</span>
<a href="#l17.136"></a><span id="l17.136">       var title = this._bundle.getString(&quot;invalidURITitle&quot;);</span>
<a href="#l17.137"></a><span id="l17.137">       Services.prompt.alert(window, title, message);</span>
<a href="#l17.138"></a><span id="l17.138">       return;</span>
<a href="#l17.139"></a><span id="l17.139">     }</span>
<a href="#l17.140"></a><span id="l17.140"> </span>
<a href="#l17.141"></a><span id="l17.141">     var capabilityString = this._getCapabilityString(aCapability);</span>
<a href="#l17.142"></a><span id="l17.142"> </span>
<a href="#l17.143"></a><span id="l17.143" class="difflineat">@@ -132,108 +127,98 @@ var gPermissionManager = {</span>
<a href="#l17.144"></a><span id="l17.144">         capabilityExists = this._permissions[i].capability == capabilityString;</span>
<a href="#l17.145"></a><span id="l17.145">         if (!capabilityExists) {</span>
<a href="#l17.146"></a><span id="l17.146">           this._permissions[i].capability = capabilityString;</span>
<a href="#l17.147"></a><span id="l17.147">         }</span>
<a href="#l17.148"></a><span id="l17.148">         break;</span>
<a href="#l17.149"></a><span id="l17.149">       }</span>
<a href="#l17.150"></a><span id="l17.150">     }</span>
<a href="#l17.151"></a><span id="l17.151"> </span>
<a href="#l17.152"></a><span id="l17.152" class="difflineminus">-    let permissionParams = {principal: principal, type: this._type, capability: aCapability};</span>
<a href="#l17.153"></a><span id="l17.153" class="difflineplus">+    let permissionParams = {principal, type: this._type, capability: aCapability};</span>
<a href="#l17.154"></a><span id="l17.154">     if (!permissionExists) {</span>
<a href="#l17.155"></a><span id="l17.155">       this._permissionsToAdd.set(principal.origin, permissionParams);</span>
<a href="#l17.156"></a><span id="l17.156">       this._addPermission(permissionParams);</span>
<a href="#l17.157"></a><span id="l17.157" class="difflineminus">-    }</span>
<a href="#l17.158"></a><span id="l17.158" class="difflineminus">-    else if (!capabilityExists) {</span>
<a href="#l17.159"></a><span id="l17.159" class="difflineplus">+    } else if (!capabilityExists) {</span>
<a href="#l17.160"></a><span id="l17.160">       this._permissionsToAdd.set(principal.origin, permissionParams);</span>
<a href="#l17.161"></a><span id="l17.161">       this._handleCapabilityChange();</span>
<a href="#l17.162"></a><span id="l17.162">     }</span>
<a href="#l17.163"></a><span id="l17.163"> </span>
<a href="#l17.164"></a><span id="l17.164">     textbox.value = &quot;&quot;;</span>
<a href="#l17.165"></a><span id="l17.165">     textbox.focus();</span>
<a href="#l17.166"></a><span id="l17.166"> </span>
<a href="#l17.167"></a><span id="l17.167">     // covers a case where the site exists already, so the buttons don't disable</span>
<a href="#l17.168"></a><span id="l17.168">     this.onHostInput(textbox);</span>
<a href="#l17.169"></a><span id="l17.169"> </span>
<a href="#l17.170"></a><span id="l17.170">     // enable &quot;remove all&quot; button as needed</span>
<a href="#l17.171"></a><span id="l17.171">     document.getElementById(&quot;removeAllPermissions&quot;).disabled = this._permissions.length == 0;</span>
<a href="#l17.172"></a><span id="l17.172">   },</span>
<a href="#l17.173"></a><span id="l17.173"> </span>
<a href="#l17.174"></a><span id="l17.174" class="difflineminus">-  _removePermission: function(aPermission)</span>
<a href="#l17.175"></a><span id="l17.175" class="difflineminus">-  {</span>
<a href="#l17.176"></a><span id="l17.176" class="difflineplus">+  _removePermission(aPermission) {</span>
<a href="#l17.177"></a><span id="l17.177">     this._removePermissionFromList(aPermission.principal);</span>
<a href="#l17.178"></a><span id="l17.178"> </span>
<a href="#l17.179"></a><span id="l17.179">     // If this permission was added during this session, let's remove</span>
<a href="#l17.180"></a><span id="l17.180">     // it from the pending adds list to prevent calls to the</span>
<a href="#l17.181"></a><span id="l17.181">     // permission manager.</span>
<a href="#l17.182"></a><span id="l17.182">     let isNewPermission = this._permissionsToAdd.delete(aPermission.principal.origin);</span>
<a href="#l17.183"></a><span id="l17.183"> </span>
<a href="#l17.184"></a><span id="l17.184">     if (!isNewPermission) {</span>
<a href="#l17.185"></a><span id="l17.185">       this._permissionsToDelete.set(aPermission.principal.origin, aPermission);</span>
<a href="#l17.186"></a><span id="l17.186">     }</span>
<a href="#l17.187"></a><span id="l17.187"> </span>
<a href="#l17.188"></a><span id="l17.188">   },</span>
<a href="#l17.189"></a><span id="l17.189"> </span>
<a href="#l17.190"></a><span id="l17.190" class="difflineminus">-  _handleCapabilityChange: function ()</span>
<a href="#l17.191"></a><span id="l17.191" class="difflineminus">-  {</span>
<a href="#l17.192"></a><span id="l17.192" class="difflineplus">+  _handleCapabilityChange() {</span>
<a href="#l17.193"></a><span id="l17.193">     // Re-do the sort, if the status changed from Block to Allow</span>
<a href="#l17.194"></a><span id="l17.194">     // or vice versa, since if we're sorted on status, we may no</span>
<a href="#l17.195"></a><span id="l17.195">     // longer be in order.</span>
<a href="#l17.196"></a><span id="l17.196">     if (this._lastPermissionSortColumn == &quot;statusCol&quot;) {</span>
<a href="#l17.197"></a><span id="l17.197">       this._resortPermissions();</span>
<a href="#l17.198"></a><span id="l17.198">     }</span>
<a href="#l17.199"></a><span id="l17.199">     this._tree.treeBoxObject.invalidate();</span>
<a href="#l17.200"></a><span id="l17.200">   },</span>
<a href="#l17.201"></a><span id="l17.201"> </span>
<a href="#l17.202"></a><span id="l17.202" class="difflineminus">-  _addPermission: function(aPermission)</span>
<a href="#l17.203"></a><span id="l17.203" class="difflineminus">-  {</span>
<a href="#l17.204"></a><span id="l17.204" class="difflineplus">+  _addPermission(aPermission) {</span>
<a href="#l17.205"></a><span id="l17.205">     this._addPermissionToList(aPermission);</span>
<a href="#l17.206"></a><span id="l17.206">     ++this._view._rowCount;</span>
<a href="#l17.207"></a><span id="l17.207">     this._tree.treeBoxObject.rowCountChanged(this._view.rowCount - 1, 1);</span>
<a href="#l17.208"></a><span id="l17.208">     // Re-do the sort, since we inserted this new item at the end.</span>
<a href="#l17.209"></a><span id="l17.209">     this._resortPermissions();</span>
<a href="#l17.210"></a><span id="l17.210">   },</span>
<a href="#l17.211"></a><span id="l17.211"> </span>
<a href="#l17.212"></a><span id="l17.212" class="difflineminus">-  _resortPermissions: function()</span>
<a href="#l17.213"></a><span id="l17.213" class="difflineminus">-  {</span>
<a href="#l17.214"></a><span id="l17.214" class="difflineplus">+  _resortPermissions() {</span>
<a href="#l17.215"></a><span id="l17.215">     gTreeUtils.sort(this._tree, this._view, this._permissions,</span>
<a href="#l17.216"></a><span id="l17.216">                     this._lastPermissionSortColumn,</span>
<a href="#l17.217"></a><span id="l17.217">                     this._permissionsComparator,</span>
<a href="#l17.218"></a><span id="l17.218">                     this._lastPermissionSortColumn,</span>
<a href="#l17.219"></a><span id="l17.219">                     !this._lastPermissionSortAscending); // keep sort direction</span>
<a href="#l17.220"></a><span id="l17.220">   },</span>
<a href="#l17.221"></a><span id="l17.221"> </span>
<a href="#l17.222"></a><span id="l17.222" class="difflineminus">-  onHostInput: function (aSiteField)</span>
<a href="#l17.223"></a><span id="l17.223" class="difflineminus">-  {</span>
<a href="#l17.224"></a><span id="l17.224" class="difflineplus">+  onHostInput(aSiteField) {</span>
<a href="#l17.225"></a><span id="l17.225">     document.getElementById(&quot;btnSession&quot;).disabled = !aSiteField.value;</span>
<a href="#l17.226"></a><span id="l17.226">     document.getElementById(&quot;btnBlock&quot;).disabled = !aSiteField.value;</span>
<a href="#l17.227"></a><span id="l17.227">     document.getElementById(&quot;btnAllow&quot;).disabled = !aSiteField.value;</span>
<a href="#l17.228"></a><span id="l17.228">   },</span>
<a href="#l17.229"></a><span id="l17.229"> </span>
<a href="#l17.230"></a><span id="l17.230" class="difflineminus">-  onWindowKeyPress: function (aEvent)</span>
<a href="#l17.231"></a><span id="l17.231" class="difflineminus">-  {</span>
<a href="#l17.232"></a><span id="l17.232" class="difflineplus">+  onWindowKeyPress(aEvent) {</span>
<a href="#l17.233"></a><span id="l17.233">     if (aEvent.keyCode == KeyEvent.DOM_VK_ESCAPE)</span>
<a href="#l17.234"></a><span id="l17.234">       window.close();</span>
<a href="#l17.235"></a><span id="l17.235">   },</span>
<a href="#l17.236"></a><span id="l17.236"> </span>
<a href="#l17.237"></a><span id="l17.237" class="difflineminus">-  onHostKeyPress: function (aEvent)</span>
<a href="#l17.238"></a><span id="l17.238" class="difflineminus">-  {</span>
<a href="#l17.239"></a><span id="l17.239" class="difflineplus">+  onHostKeyPress(aEvent) {</span>
<a href="#l17.240"></a><span id="l17.240">     if (aEvent.keyCode == KeyEvent.DOM_VK_RETURN)</span>
<a href="#l17.241"></a><span id="l17.241">       document.getElementById(&quot;btnAllow&quot;).click();</span>
<a href="#l17.242"></a><span id="l17.242">   },</span>
<a href="#l17.243"></a><span id="l17.243"> </span>
<a href="#l17.244"></a><span id="l17.244" class="difflineminus">-  onLoad: function ()</span>
<a href="#l17.245"></a><span id="l17.245" class="difflineminus">-  {</span>
<a href="#l17.246"></a><span id="l17.246" class="difflineplus">+  onLoad() {</span>
<a href="#l17.247"></a><span id="l17.247">     this._bundle = document.getElementById(&quot;bundlePreferences&quot;);</span>
<a href="#l17.248"></a><span id="l17.248">     var params = window.arguments[0];</span>
<a href="#l17.249"></a><span id="l17.249">     this.init(params);</span>
<a href="#l17.250"></a><span id="l17.250">   },</span>
<a href="#l17.251"></a><span id="l17.251"> </span>
<a href="#l17.252"></a><span id="l17.252" class="difflineminus">-  init: function (aParams)</span>
<a href="#l17.253"></a><span id="l17.253" class="difflineminus">-  {</span>
<a href="#l17.254"></a><span id="l17.254" class="difflineplus">+  init(aParams) {</span>
<a href="#l17.255"></a><span id="l17.255">     if (this._type) {</span>
<a href="#l17.256"></a><span id="l17.256">       // reusing an open dialog, clear the old observer</span>
<a href="#l17.257"></a><span id="l17.257">       this.uninit();</span>
<a href="#l17.258"></a><span id="l17.258">     }</span>
<a href="#l17.259"></a><span id="l17.259"> </span>
<a href="#l17.260"></a><span id="l17.260">     this._type = aParams.permissionType;</span>
<a href="#l17.261"></a><span id="l17.261">     this._manageCapability = aParams.manageCapability;</span>
<a href="#l17.262"></a><span id="l17.262"> </span>
<a href="#l17.263"></a><span id="l17.263" class="difflineat">@@ -276,136 +261,124 @@ var gPermissionManager = {</span>
<a href="#l17.264"></a><span id="l17.264">     Services.obs.notifyObservers(null, NOTIFICATION_FLUSH_PERMISSIONS, this._type);</span>
<a href="#l17.265"></a><span id="l17.265">     Services.obs.addObserver(this, &quot;perm-changed&quot;);</span>
<a href="#l17.266"></a><span id="l17.266"> </span>
<a href="#l17.267"></a><span id="l17.267">     this._loadPermissions();</span>
<a href="#l17.268"></a><span id="l17.268"> </span>
<a href="#l17.269"></a><span id="l17.269">     urlField.focus();</span>
<a href="#l17.270"></a><span id="l17.270">   },</span>
<a href="#l17.271"></a><span id="l17.271"> </span>
<a href="#l17.272"></a><span id="l17.272" class="difflineminus">-  uninit: function ()</span>
<a href="#l17.273"></a><span id="l17.273" class="difflineminus">-  {</span>
<a href="#l17.274"></a><span id="l17.274" class="difflineplus">+  uninit() {</span>
<a href="#l17.275"></a><span id="l17.275">     if (!this._observerRemoved) {</span>
<a href="#l17.276"></a><span id="l17.276">       Services.obs.removeObserver(this, &quot;perm-changed&quot;);</span>
<a href="#l17.277"></a><span id="l17.277"> </span>
<a href="#l17.278"></a><span id="l17.278">       this._observerRemoved = true;</span>
<a href="#l17.279"></a><span id="l17.279">     }</span>
<a href="#l17.280"></a><span id="l17.280">   },</span>
<a href="#l17.281"></a><span id="l17.281"> </span>
<a href="#l17.282"></a><span id="l17.282" class="difflineminus">-  observe: function (aSubject, aTopic, aData)</span>
<a href="#l17.283"></a><span id="l17.283" class="difflineminus">-  {</span>
<a href="#l17.284"></a><span id="l17.284" class="difflineplus">+  observe(aSubject, aTopic, aData) {</span>
<a href="#l17.285"></a><span id="l17.285">     if (aTopic == &quot;perm-changed&quot;) {</span>
<a href="#l17.286"></a><span id="l17.286">       var permission = aSubject.QueryInterface(Ci.nsIPermission);</span>
<a href="#l17.287"></a><span id="l17.287"> </span>
<a href="#l17.288"></a><span id="l17.288">       // Ignore unrelated permission types.</span>
<a href="#l17.289"></a><span id="l17.289">       if (permission.type != this._type)</span>
<a href="#l17.290"></a><span id="l17.290">         return;</span>
<a href="#l17.291"></a><span id="l17.291"> </span>
<a href="#l17.292"></a><span id="l17.292">       if (aData == &quot;added&quot;) {</span>
<a href="#l17.293"></a><span id="l17.293">         this._addPermission(permission);</span>
<a href="#l17.294"></a><span id="l17.294" class="difflineminus">-      }</span>
<a href="#l17.295"></a><span id="l17.295" class="difflineminus">-      else if (aData == &quot;changed&quot;) {</span>
<a href="#l17.296"></a><span id="l17.296" class="difflineplus">+      } else if (aData == &quot;changed&quot;) {</span>
<a href="#l17.297"></a><span id="l17.297">         for (var i = 0; i &lt; this._permissions.length; ++i) {</span>
<a href="#l17.298"></a><span id="l17.298">           if (permission.matches(this._permissions[i].principal, true)) {</span>
<a href="#l17.299"></a><span id="l17.299">             this._permissions[i].capability = this._getCapabilityString(permission.capability);</span>
<a href="#l17.300"></a><span id="l17.300">             break;</span>
<a href="#l17.301"></a><span id="l17.301">           }</span>
<a href="#l17.302"></a><span id="l17.302">         }</span>
<a href="#l17.303"></a><span id="l17.303">         this._handleCapabilityChange();</span>
<a href="#l17.304"></a><span id="l17.304" class="difflineminus">-      }</span>
<a href="#l17.305"></a><span id="l17.305" class="difflineminus">-      else if (aData == &quot;deleted&quot;) {</span>
<a href="#l17.306"></a><span id="l17.306" class="difflineplus">+      } else if (aData == &quot;deleted&quot;) {</span>
<a href="#l17.307"></a><span id="l17.307">         this._removePermissionFromList(permission);</span>
<a href="#l17.308"></a><span id="l17.308">       }</span>
<a href="#l17.309"></a><span id="l17.309">     }</span>
<a href="#l17.310"></a><span id="l17.310">   },</span>
<a href="#l17.311"></a><span id="l17.311"> </span>
<a href="#l17.312"></a><span id="l17.312" class="difflineminus">-  onPermissionSelected: function ()</span>
<a href="#l17.313"></a><span id="l17.313" class="difflineminus">-  {</span>
<a href="#l17.314"></a><span id="l17.314" class="difflineplus">+  onPermissionSelected() {</span>
<a href="#l17.315"></a><span id="l17.315">     var hasSelection = this._tree.view.selection.count &gt; 0;</span>
<a href="#l17.316"></a><span id="l17.316">     var hasRows = this._tree.view.rowCount &gt; 0;</span>
<a href="#l17.317"></a><span id="l17.317">     document.getElementById(&quot;removePermission&quot;).disabled = !hasRows || !hasSelection;</span>
<a href="#l17.318"></a><span id="l17.318">     document.getElementById(&quot;removeAllPermissions&quot;).disabled = !hasRows;</span>
<a href="#l17.319"></a><span id="l17.319">   },</span>
<a href="#l17.320"></a><span id="l17.320"> </span>
<a href="#l17.321"></a><span id="l17.321" class="difflineminus">-  onPermissionDeleted: function ()</span>
<a href="#l17.322"></a><span id="l17.322" class="difflineminus">-  {</span>
<a href="#l17.323"></a><span id="l17.323" class="difflineplus">+  onPermissionDeleted() {</span>
<a href="#l17.324"></a><span id="l17.324">     if (!this._view.rowCount)</span>
<a href="#l17.325"></a><span id="l17.325">       return;</span>
<a href="#l17.326"></a><span id="l17.326">     var removedPermissions = [];</span>
<a href="#l17.327"></a><span id="l17.327">     gTreeUtils.deleteSelectedItems(this._tree, this._view, this._permissions, removedPermissions);</span>
<a href="#l17.328"></a><span id="l17.328">     for (var i = 0; i &lt; removedPermissions.length; ++i) {</span>
<a href="#l17.329"></a><span id="l17.329">       var p = removedPermissions[i];</span>
<a href="#l17.330"></a><span id="l17.330">       this._removePermission(p);</span>
<a href="#l17.331"></a><span id="l17.331">     }</span>
<a href="#l17.332"></a><span id="l17.332">     document.getElementById(&quot;removePermission&quot;).disabled = !this._permissions.length;</span>
<a href="#l17.333"></a><span id="l17.333">     document.getElementById(&quot;removeAllPermissions&quot;).disabled = !this._permissions.length;</span>
<a href="#l17.334"></a><span id="l17.334">   },</span>
<a href="#l17.335"></a><span id="l17.335"> </span>
<a href="#l17.336"></a><span id="l17.336" class="difflineminus">-  onAllPermissionsDeleted: function ()</span>
<a href="#l17.337"></a><span id="l17.337" class="difflineminus">-  {</span>
<a href="#l17.338"></a><span id="l17.338" class="difflineplus">+  onAllPermissionsDeleted() {</span>
<a href="#l17.339"></a><span id="l17.339">     if (!this._view.rowCount)</span>
<a href="#l17.340"></a><span id="l17.340">       return;</span>
<a href="#l17.341"></a><span id="l17.341">     var removedPermissions = [];</span>
<a href="#l17.342"></a><span id="l17.342">     gTreeUtils.deleteAll(this._tree, this._view, this._permissions, removedPermissions);</span>
<a href="#l17.343"></a><span id="l17.343">     for (var i = 0; i &lt; removedPermissions.length; ++i) {</span>
<a href="#l17.344"></a><span id="l17.344">       var p = removedPermissions[i];</span>
<a href="#l17.345"></a><span id="l17.345">       this._removePermission(p);</span>
<a href="#l17.346"></a><span id="l17.346">     }</span>
<a href="#l17.347"></a><span id="l17.347">     document.getElementById(&quot;removePermission&quot;).disabled = true;</span>
<a href="#l17.348"></a><span id="l17.348">     document.getElementById(&quot;removeAllPermissions&quot;).disabled = true;</span>
<a href="#l17.349"></a><span id="l17.349">   },</span>
<a href="#l17.350"></a><span id="l17.350"> </span>
<a href="#l17.351"></a><span id="l17.351" class="difflineminus">-  onPermissionKeyPress: function (aEvent)</span>
<a href="#l17.352"></a><span id="l17.352" class="difflineminus">-  {</span>
<a href="#l17.353"></a><span id="l17.353" class="difflineplus">+  onPermissionKeyPress(aEvent) {</span>
<a href="#l17.354"></a><span id="l17.354">     if (aEvent.keyCode == KeyEvent.DOM_VK_DELETE ||</span>
<a href="#l17.355"></a><span id="l17.355">         ((AppConstants.platform == &quot;macosx&quot;) &amp;&amp;</span>
<a href="#l17.356"></a><span id="l17.356">          aEvent.keyCode == KeyEvent.DOM_VK_BACK_SPACE))</span>
<a href="#l17.357"></a><span id="l17.357">       this.onPermissionDeleted();</span>
<a href="#l17.358"></a><span id="l17.358">   },</span>
<a href="#l17.359"></a><span id="l17.359"> </span>
<a href="#l17.360"></a><span id="l17.360">   _lastPermissionSortColumn: &quot;&quot;,</span>
<a href="#l17.361"></a><span id="l17.361">   _lastPermissionSortAscending: false,</span>
<a href="#l17.362"></a><span id="l17.362" class="difflineminus">-  _permissionsComparator : function (a, b)</span>
<a href="#l17.363"></a><span id="l17.363" class="difflineminus">-  {</span>
<a href="#l17.364"></a><span id="l17.364" class="difflineplus">+  _permissionsComparator(a, b) {</span>
<a href="#l17.365"></a><span id="l17.365">     return a.toLowerCase().localeCompare(b.toLowerCase());</span>
<a href="#l17.366"></a><span id="l17.366">   },</span>
<a href="#l17.367"></a><span id="l17.367"> </span>
<a href="#l17.368"></a><span id="l17.368"> </span>
<a href="#l17.369"></a><span id="l17.369" class="difflineminus">-  onPermissionSort: function (aColumn)</span>
<a href="#l17.370"></a><span id="l17.370" class="difflineminus">-  {</span>
<a href="#l17.371"></a><span id="l17.371" class="difflineplus">+  onPermissionSort(aColumn) {</span>
<a href="#l17.372"></a><span id="l17.372">     this._lastPermissionSortAscending = gTreeUtils.sort(this._tree,</span>
<a href="#l17.373"></a><span id="l17.373">                                                         this._view,</span>
<a href="#l17.374"></a><span id="l17.374">                                                         this._permissions,</span>
<a href="#l17.375"></a><span id="l17.375">                                                         aColumn,</span>
<a href="#l17.376"></a><span id="l17.376">                                                         this._permissionsComparator,</span>
<a href="#l17.377"></a><span id="l17.377">                                                         this._lastPermissionSortColumn,</span>
<a href="#l17.378"></a><span id="l17.378">                                                         this._lastPermissionSortAscending);</span>
<a href="#l17.379"></a><span id="l17.379">     this._lastPermissionSortColumn = aColumn;</span>
<a href="#l17.380"></a><span id="l17.380">   },</span>
<a href="#l17.381"></a><span id="l17.381"> </span>
<a href="#l17.382"></a><span id="l17.382" class="difflineminus">-  onApplyChanges: function()</span>
<a href="#l17.383"></a><span id="l17.383" class="difflineminus">-  {</span>
<a href="#l17.384"></a><span id="l17.384" class="difflineplus">+  onApplyChanges() {</span>
<a href="#l17.385"></a><span id="l17.385">     // Stop observing permission changes since we are about</span>
<a href="#l17.386"></a><span id="l17.386">     // to write out the pending adds/deletes and don't need</span>
<a href="#l17.387"></a><span id="l17.387">     // to update the UI</span>
<a href="#l17.388"></a><span id="l17.388">     this.uninit();</span>
<a href="#l17.389"></a><span id="l17.389"> </span>
<a href="#l17.390"></a><span id="l17.390">     for (let permissionParams of this._permissionsToAdd.values()) {</span>
<a href="#l17.391"></a><span id="l17.391">       Services.perms.addFromPrincipal(permissionParams.principal, permissionParams.type, permissionParams.capability);</span>
<a href="#l17.392"></a><span id="l17.392">     }</span>
<a href="#l17.393"></a><span id="l17.393"> </span>
<a href="#l17.394"></a><span id="l17.394">     for (let p of this._permissionsToDelete.values()) {</span>
<a href="#l17.395"></a><span id="l17.395">       Services.perms.removeFromPrincipal(p.principal, p.type);</span>
<a href="#l17.396"></a><span id="l17.396">     }</span>
<a href="#l17.397"></a><span id="l17.397"> </span>
<a href="#l17.398"></a><span id="l17.398">     window.close();</span>
<a href="#l17.399"></a><span id="l17.399">   },</span>
<a href="#l17.400"></a><span id="l17.400"> </span>
<a href="#l17.401"></a><span id="l17.401" class="difflineminus">-  _loadPermissions: function ()</span>
<a href="#l17.402"></a><span id="l17.402" class="difflineminus">-  {</span>
<a href="#l17.403"></a><span id="l17.403" class="difflineplus">+  _loadPermissions() {</span>
<a href="#l17.404"></a><span id="l17.404">     this._tree = document.getElementById(&quot;permissionsTree&quot;);</span>
<a href="#l17.405"></a><span id="l17.405">     this._permissions = [];</span>
<a href="#l17.406"></a><span id="l17.406"> </span>
<a href="#l17.407"></a><span id="l17.407">     // load permissions into a table</span>
<a href="#l17.408"></a><span id="l17.408">     var count = 0;</span>
<a href="#l17.409"></a><span id="l17.409">     var enumerator = Services.perms.enumerator;</span>
<a href="#l17.410"></a><span id="l17.410">     while (enumerator.hasMoreElements()) {</span>
<a href="#l17.411"></a><span id="l17.411">       var nextPermission = enumerator.getNext().QueryInterface(Ci.nsIPermission);</span>
<a href="#l17.412"></a><span id="l17.412" class="difflineat">@@ -417,53 +390,48 @@ var gPermissionManager = {</span>
<a href="#l17.413"></a><span id="l17.413">     // sort and display the table</span>
<a href="#l17.414"></a><span id="l17.414">     this._tree.view = this._view;</span>
<a href="#l17.415"></a><span id="l17.415">     this.onPermissionSort(&quot;origin&quot;);</span>
<a href="#l17.416"></a><span id="l17.416"> </span>
<a href="#l17.417"></a><span id="l17.417">     // disable &quot;remove all&quot; button if there are none</span>
<a href="#l17.418"></a><span id="l17.418">     document.getElementById(&quot;removeAllPermissions&quot;).disabled = this._permissions.length == 0;</span>
<a href="#l17.419"></a><span id="l17.419">   },</span>
<a href="#l17.420"></a><span id="l17.420"> </span>
<a href="#l17.421"></a><span id="l17.421" class="difflineminus">-  _addPermissionToList: function (aPermission)</span>
<a href="#l17.422"></a><span id="l17.422" class="difflineminus">-  {</span>
<a href="#l17.423"></a><span id="l17.423" class="difflineplus">+  _addPermissionToList(aPermission) {</span>
<a href="#l17.424"></a><span id="l17.424"> </span>
<a href="#l17.425"></a><span id="l17.425">     if (aPermission.type == this._type &amp;&amp;</span>
<a href="#l17.426"></a><span id="l17.426">         (!this._manageCapability ||</span>
<a href="#l17.427"></a><span id="l17.427">          (aPermission.capability == this._manageCapability))) {</span>
<a href="#l17.428"></a><span id="l17.428"> </span>
<a href="#l17.429"></a><span id="l17.429">       var principal = aPermission.principal;</span>
<a href="#l17.430"></a><span id="l17.430">       var capabilityString = this._getCapabilityString(aPermission.capability);</span>
<a href="#l17.431"></a><span id="l17.431">       var p = new Permission(principal,</span>
<a href="#l17.432"></a><span id="l17.432">                              aPermission.type,</span>
<a href="#l17.433"></a><span id="l17.433">                              capabilityString);</span>
<a href="#l17.434"></a><span id="l17.434">       this._permissions.push(p);</span>
<a href="#l17.435"></a><span id="l17.435">     }</span>
<a href="#l17.436"></a><span id="l17.436">   },</span>
<a href="#l17.437"></a><span id="l17.437"> </span>
<a href="#l17.438"></a><span id="l17.438" class="difflineminus">-  _removePermissionFromList: function (aPrincipal)</span>
<a href="#l17.439"></a><span id="l17.439" class="difflineminus">-  {</span>
<a href="#l17.440"></a><span id="l17.440" class="difflineplus">+  _removePermissionFromList(aPrincipal) {</span>
<a href="#l17.441"></a><span id="l17.441">     for (let i = 0; i &lt; this._permissions.length; ++i) {</span>
<a href="#l17.442"></a><span id="l17.442">       // Thunderbird compares origins, not principals here.</span>
<a href="#l17.443"></a><span id="l17.443">       if (this._permissions[i].principal.origin == aPrincipal.origin) {</span>
<a href="#l17.444"></a><span id="l17.444">         this._permissions.splice(i, 1);</span>
<a href="#l17.445"></a><span id="l17.445">         this._view._rowCount--;</span>
<a href="#l17.446"></a><span id="l17.446">         this._tree.treeBoxObject.rowCountChanged(this._view.rowCount - 1, -1);</span>
<a href="#l17.447"></a><span id="l17.447">         this._tree.treeBoxObject.invalidate();</span>
<a href="#l17.448"></a><span id="l17.448">         break;</span>
<a href="#l17.449"></a><span id="l17.449">       }</span>
<a href="#l17.450"></a><span id="l17.450">     }</span>
<a href="#l17.451"></a><span id="l17.451">   },</span>
<a href="#l17.452"></a><span id="l17.452"> </span>
<a href="#l17.453"></a><span id="l17.453" class="difflineminus">-  setOrigin: function (aOrigin)</span>
<a href="#l17.454"></a><span id="l17.454" class="difflineminus">-  {</span>
<a href="#l17.455"></a><span id="l17.455" class="difflineplus">+  setOrigin(aOrigin) {</span>
<a href="#l17.456"></a><span id="l17.456">     document.getElementById(&quot;url&quot;).value = aOrigin;</span>
<a href="#l17.457"></a><span id="l17.457" class="difflineminus">-  }</span>
<a href="#l17.458"></a><span id="l17.458" class="difflineplus">+  },</span>
<a href="#l17.459"></a><span id="l17.459"> };</span>
<a href="#l17.460"></a><span id="l17.460"> </span>
<a href="#l17.461"></a><span id="l17.461" class="difflineminus">-function setOrigin(aOrigin)</span>
<a href="#l17.462"></a><span id="l17.462" class="difflineminus">-{</span>
<a href="#l17.463"></a><span id="l17.463" class="difflineplus">+function setOrigin(aOrigin) {</span>
<a href="#l17.464"></a><span id="l17.464">   gPermissionManager.setOrigin(aOrigin);</span>
<a href="#l17.465"></a><span id="l17.465"> }</span>
<a href="#l17.466"></a><span id="l17.466"> </span>
<a href="#l17.467"></a><span id="l17.467" class="difflineminus">-function initWithParams(aParams)</span>
<a href="#l17.468"></a><span id="l17.468" class="difflineminus">-{</span>
<a href="#l17.469"></a><span id="l17.469" class="difflineplus">+function initWithParams(aParams) {</span>
<a href="#l17.470"></a><span id="l17.470">   gPermissionManager.init(aParams);</span>
<a href="#l17.471"></a><span id="l17.471"> }</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l18.1"></a><span id="l18.1" class="difflineminus">--- a/mail/components/preferences/preferences.js</span>
<a href="#l18.2"></a><span id="l18.2" class="difflineplus">+++ b/mail/components/preferences/preferences.js</span>
<a href="#l18.3"></a><span id="l18.3" class="difflineat">@@ -1,17 +1,17 @@</span>
<a href="#l18.4"></a><span id="l18.4"> /* This Source Code Form is subject to the terms of the Mozilla Public</span>
<a href="#l18.5"></a><span id="l18.5">  * License, v. 2.0. If a copy of the MPL was not distributed with this file,</span>
<a href="#l18.6"></a><span id="l18.6">  * You can obtain one at http://mozilla.org/MPL/2.0/. */</span>
<a href="#l18.7"></a><span id="l18.7"> </span>
<a href="#l18.8"></a><span id="l18.8"> ChromeUtils.import(&quot;resource://gre/modules/Services.jsm&quot;);</span>
<a href="#l18.9"></a><span id="l18.9"> ChromeUtils.import(&quot;resource://gre/modules/AppConstants.jsm&quot;);</span>
<a href="#l18.10"></a><span id="l18.10"> ChromeUtils.import(&quot;resource:///modules/MailServices.jsm&quot;);</span>
<a href="#l18.11"></a><span id="l18.11"> </span>
<a href="#l18.12"></a><span id="l18.12" class="difflineminus">-window.addEventListener(&quot;load&quot;, function () {</span>
<a href="#l18.13"></a><span id="l18.13" class="difflineplus">+window.addEventListener(&quot;load&quot;, function() {</span>
<a href="#l18.14"></a><span id="l18.14">   let prefWindow = document.getElementById(&quot;MailPreferences&quot;);</span>
<a href="#l18.15"></a><span id="l18.15">   if (!Services.prefs.getBoolPref(&quot;mail.chat.enabled&quot;)) {</span>
<a href="#l18.16"></a><span id="l18.16">     let radio =</span>
<a href="#l18.17"></a><span id="l18.17">       document.getAnonymousElementByAttribute(prefWindow, &quot;pane&quot;, &quot;paneChat&quot;);</span>
<a href="#l18.18"></a><span id="l18.18">     if (radio.selected)</span>
<a href="#l18.19"></a><span id="l18.19">       prefWindow.showPane(document.getElementById(&quot;paneGeneral&quot;));</span>
<a href="#l18.20"></a><span id="l18.20">     radio.hidden = true;</span>
<a href="#l18.21"></a><span id="l18.21">   }</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l19.1"></a><span id="l19.1" class="difflineminus">--- a/mail/components/preferences/preferencesTab.js</span>
<a href="#l19.2"></a><span id="l19.2" class="difflineplus">+++ b/mail/components/preferences/preferencesTab.js</span>
<a href="#l19.3"></a><span id="l19.3" class="difflineat">@@ -25,40 +25,40 @@ var preferencesTabType = {</span>
<a href="#l19.4"></a><span id="l19.4">     delete this.loadingTabString;</span>
<a href="#l19.5"></a><span id="l19.5">     return this.loadingTabString = document.getElementById(&quot;bundle_messenger&quot;)</span>
<a href="#l19.6"></a><span id="l19.6">                                            .getString(&quot;loadingTab&quot;);</span>
<a href="#l19.7"></a><span id="l19.7">   },</span>
<a href="#l19.8"></a><span id="l19.8"> </span>
<a href="#l19.9"></a><span id="l19.9">   modes: {</span>
<a href="#l19.10"></a><span id="l19.10">     preferencesTab: {</span>
<a href="#l19.11"></a><span id="l19.11">       type: &quot;preferencesTab&quot;,</span>
<a href="#l19.12"></a><span id="l19.12" class="difflineminus">-    }</span>
<a href="#l19.13"></a><span id="l19.13" class="difflineplus">+    },</span>
<a href="#l19.14"></a><span id="l19.14">   },</span>
<a href="#l19.15"></a><span id="l19.15"> </span>
<a href="#l19.16"></a><span id="l19.16" class="difflineminus">-  initialize: function() {</span>
<a href="#l19.17"></a><span id="l19.17" class="difflineplus">+  initialize() {</span>
<a href="#l19.18"></a><span id="l19.18">     let tabmail = document.getElementById(&quot;tabmail&quot;);</span>
<a href="#l19.19"></a><span id="l19.19">     tabmail.registerTabType(this);</span>
<a href="#l19.20"></a><span id="l19.20">   },</span>
<a href="#l19.21"></a><span id="l19.21"> </span>
<a href="#l19.22"></a><span id="l19.22">   shouldSwitchTo: function shouldSwitchTo(aArgs) {</span>
<a href="#l19.23"></a><span id="l19.23">     if (!gPrefTab) {</span>
<a href="#l19.24"></a><span id="l19.24">       return -1;</span>
<a href="#l19.25"></a><span id="l19.25">     }</span>
<a href="#l19.26"></a><span id="l19.26">     let prefWindow = gPrefTab.browser.contentDocument.getElementById(&quot;MailPreferences&quot;);</span>
<a href="#l19.27"></a><span id="l19.27">     gPrefTab.browser.contentWindow.selectPaneAndTab(prefWindow, aArgs.paneID, aArgs.tabID, aArgs.otherArgs);</span>
<a href="#l19.28"></a><span id="l19.28">     return document.getElementById(&quot;tabmail&quot;).tabInfo.indexOf(gPrefTab);</span>
<a href="#l19.29"></a><span id="l19.29">   },</span>
<a href="#l19.30"></a><span id="l19.30"> </span>
<a href="#l19.31"></a><span id="l19.31" class="difflineminus">-  closeTab: function(aTab) {</span>
<a href="#l19.32"></a><span id="l19.32" class="difflineplus">+  closeTab(aTab) {</span>
<a href="#l19.33"></a><span id="l19.33">     gPrefTab = null;</span>
<a href="#l19.34"></a><span id="l19.34">   },</span>
<a href="#l19.35"></a><span id="l19.35"> </span>
<a href="#l19.36"></a><span id="l19.36">   openTab: function onTabOpened(aTab, aArgs) {</span>
<a href="#l19.37"></a><span id="l19.37" class="difflineminus">-    if (!&quot;contentPage&quot; in aArgs) {</span>
<a href="#l19.38"></a><span id="l19.38" class="difflineminus">-      throw(&quot;contentPage must be specified&quot;);</span>
<a href="#l19.39"></a><span id="l19.39" class="difflineplus">+    if (!(&quot;contentPage&quot; in aArgs)) {</span>
<a href="#l19.40"></a><span id="l19.40" class="difflineplus">+      throw (&quot;contentPage must be specified&quot;);</span>
<a href="#l19.41"></a><span id="l19.41">     }</span>
<a href="#l19.42"></a><span id="l19.42"> </span>
<a href="#l19.43"></a><span id="l19.43">     // First clone the page and set up the basics.</span>
<a href="#l19.44"></a><span id="l19.44">     let clone = document.getElementById(&quot;preferencesTab&quot;).firstChild</span>
<a href="#l19.45"></a><span id="l19.45">                         .cloneNode(true);</span>
<a href="#l19.46"></a><span id="l19.46"> </span>
<a href="#l19.47"></a><span id="l19.47">     clone.setAttribute(&quot;id&quot;, &quot;preferencesTab&quot; + this.lastBrowserId);</span>
<a href="#l19.48"></a><span id="l19.48">     clone.setAttribute(&quot;collapsed&quot;, false);</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l20.1"></a><span id="l20.1" class="difflineminus">--- a/mail/components/preferences/privacy.js</span>
<a href="#l20.2"></a><span id="l20.2" class="difflineplus">+++ b/mail/components/preferences/privacy.js</span>
<a href="#l20.3"></a><span id="l20.3" class="difflineat">@@ -1,37 +1,34 @@</span>
<a href="#l20.4"></a><span id="l20.4"> /* -*- Mode: JavaScript; tab-width: 2; indent-tabs-mode: nil; c-basic-offset: 2 -*-</span>
<a href="#l20.5"></a><span id="l20.5">  * This Source Code Form is subject to the terms of the Mozilla Public</span>
<a href="#l20.6"></a><span id="l20.6">  * License, v. 2.0. If a copy of the MPL was not distributed with this</span>
<a href="#l20.7"></a><span id="l20.7">  * file, You can obtain one at http://mozilla.org/MPL/2.0/. */</span>
<a href="#l20.8"></a><span id="l20.8"> </span>
<a href="#l20.9"></a><span id="l20.9"> var gPrivacyPane = {</span>
<a href="#l20.10"></a><span id="l20.10"> </span>
<a href="#l20.11"></a><span id="l20.11" class="difflineminus">-  init: function()</span>
<a href="#l20.12"></a><span id="l20.12" class="difflineminus">-  {</span>
<a href="#l20.13"></a><span id="l20.13" class="difflineplus">+  init() {</span>
<a href="#l20.14"></a><span id="l20.14">   },</span>
<a href="#l20.15"></a><span id="l20.15"> </span>
<a href="#l20.16"></a><span id="l20.16">   /**</span>
<a href="#l20.17"></a><span id="l20.17">    * Reload the current message after a preference affecting the view</span>
<a href="#l20.18"></a><span id="l20.18">    * has been changed and we are in instantApply mode.</span>
<a href="#l20.19"></a><span id="l20.19">    */</span>
<a href="#l20.20"></a><span id="l20.20" class="difflineminus">-  reloadMessageInOpener: function()</span>
<a href="#l20.21"></a><span id="l20.21" class="difflineminus">-  {</span>
<a href="#l20.22"></a><span id="l20.22" class="difflineplus">+  reloadMessageInOpener() {</span>
<a href="#l20.23"></a><span id="l20.23">     if (Services.prefs.getBoolPref(&quot;browser.preferences.instantApply&quot;) &amp;&amp;</span>
<a href="#l20.24"></a><span id="l20.24">         window.opener &amp;&amp; typeof(window.opener.ReloadMessage) == &quot;function&quot;)</span>
<a href="#l20.25"></a><span id="l20.25">       window.opener.ReloadMessage();</span>
<a href="#l20.26"></a><span id="l20.26">   },</span>
<a href="#l20.27"></a><span id="l20.27"> </span>
<a href="#l20.28"></a><span id="l20.28">   /**</span>
<a href="#l20.29"></a><span id="l20.29">    * Reads the network.cookie.cookieBehavior preference value and</span>
<a href="#l20.30"></a><span id="l20.30">    * enables/disables the rest of the cookie UI accordingly, returning true</span>
<a href="#l20.31"></a><span id="l20.31">    * if cookies are enabled.</span>
<a href="#l20.32"></a><span id="l20.32">    */</span>
<a href="#l20.33"></a><span id="l20.33" class="difflineminus">-  readAcceptCookies: function()</span>
<a href="#l20.34"></a><span id="l20.34" class="difflineminus">-  {</span>
<a href="#l20.35"></a><span id="l20.35" class="difflineplus">+  readAcceptCookies() {</span>
<a href="#l20.36"></a><span id="l20.36">     let pref = document.getElementById(&quot;network.cookie.cookieBehavior&quot;);</span>
<a href="#l20.37"></a><span id="l20.37">     let acceptThirdPartyLabel = document.getElementById(&quot;acceptThirdPartyLabel&quot;);</span>
<a href="#l20.38"></a><span id="l20.38">     let acceptThirdPartyMenu = document.getElementById(&quot;acceptThirdPartyMenu&quot;);</span>
<a href="#l20.39"></a><span id="l20.39">     let keepUntil = document.getElementById(&quot;keepUntil&quot;);</span>
<a href="#l20.40"></a><span id="l20.40">     let menu = document.getElementById(&quot;keepCookiesUntil&quot;);</span>
<a href="#l20.41"></a><span id="l20.41"> </span>
<a href="#l20.42"></a><span id="l20.42">     // enable the rest of the UI for anything other than &quot;disable all cookies&quot;</span>
<a href="#l20.43"></a><span id="l20.43">     let acceptCookies = (pref.value != 2);</span>
<a href="#l20.44"></a><span id="l20.44" class="difflineat">@@ -43,100 +40,92 @@ var gPrivacyPane = {</span>
<a href="#l20.45"></a><span id="l20.45">   },</span>
<a href="#l20.46"></a><span id="l20.46"> </span>
<a href="#l20.47"></a><span id="l20.47">   /**</span>
<a href="#l20.48"></a><span id="l20.48">    * Enables/disables the &quot;keep until&quot; label and menulist in response to the</span>
<a href="#l20.49"></a><span id="l20.49">    * &quot;accept cookies&quot; checkbox being checked or unchecked.</span>
<a href="#l20.50"></a><span id="l20.50">    * @return 0 if cookies are accepted, 2 if they are not;</span>
<a href="#l20.51"></a><span id="l20.51">    *         the value network.cookie.cookieBehavior should get</span>
<a href="#l20.52"></a><span id="l20.52">    */</span>
<a href="#l20.53"></a><span id="l20.53" class="difflineminus">-  writeAcceptCookies: function()</span>
<a href="#l20.54"></a><span id="l20.54" class="difflineminus">-  {</span>
<a href="#l20.55"></a><span id="l20.55" class="difflineplus">+  writeAcceptCookies() {</span>
<a href="#l20.56"></a><span id="l20.56">     let accept = document.getElementById(&quot;acceptCookies&quot;);</span>
<a href="#l20.57"></a><span id="l20.57">     let acceptThirdPartyMenu = document.getElementById(&quot;acceptThirdPartyMenu&quot;);</span>
<a href="#l20.58"></a><span id="l20.58">     // if we're enabling cookies, automatically select 'accept third party always'</span>
<a href="#l20.59"></a><span id="l20.59">     if (accept.checked)</span>
<a href="#l20.60"></a><span id="l20.60">       acceptThirdPartyMenu.selectedIndex = 0;</span>
<a href="#l20.61"></a><span id="l20.61"> </span>
<a href="#l20.62"></a><span id="l20.62">     return accept.checked ? 0 : 2;</span>
<a href="#l20.63"></a><span id="l20.63">   },</span>
<a href="#l20.64"></a><span id="l20.64"> </span>
<a href="#l20.65"></a><span id="l20.65">   /**</span>
<a href="#l20.66"></a><span id="l20.66">    * Displays fine-grained, per-site preferences for cookies.</span>
<a href="#l20.67"></a><span id="l20.67">    */</span>
<a href="#l20.68"></a><span id="l20.68" class="difflineminus">-  showCookieExceptions: function()</span>
<a href="#l20.69"></a><span id="l20.69" class="difflineminus">-  {</span>
<a href="#l20.70"></a><span id="l20.70" class="difflineplus">+  showCookieExceptions() {</span>
<a href="#l20.71"></a><span id="l20.71">     let bundle = document.getElementById(&quot;bundlePreferences&quot;);</span>
<a href="#l20.72"></a><span id="l20.72" class="difflineminus">-    let params = { blockVisible   : true,</span>
<a href="#l20.73"></a><span id="l20.73" class="difflineminus">-                   sessionVisible : true,</span>
<a href="#l20.74"></a><span id="l20.74" class="difflineminus">-                   allowVisible   : true,</span>
<a href="#l20.75"></a><span id="l20.75" class="difflineminus">-                   prefilledHost  : &quot;&quot;,</span>
<a href="#l20.76"></a><span id="l20.76" class="difflineminus">-                   permissionType : &quot;cookie&quot;,</span>
<a href="#l20.77"></a><span id="l20.77" class="difflineminus">-                   windowTitle    : bundle.getString(&quot;cookiepermissionstitle&quot;),</span>
<a href="#l20.78"></a><span id="l20.78" class="difflineminus">-                   introText      : bundle.getString(&quot;cookiepermissionstext&quot;) };</span>
<a href="#l20.79"></a><span id="l20.79" class="difflineplus">+    let params = { blockVisible: true,</span>
<a href="#l20.80"></a><span id="l20.80" class="difflineplus">+                   sessionVisible: true,</span>
<a href="#l20.81"></a><span id="l20.81" class="difflineplus">+                   allowVisible: true,</span>
<a href="#l20.82"></a><span id="l20.82" class="difflineplus">+                   prefilledHost: &quot;&quot;,</span>
<a href="#l20.83"></a><span id="l20.83" class="difflineplus">+                   permissionType: &quot;cookie&quot;,</span>
<a href="#l20.84"></a><span id="l20.84" class="difflineplus">+                   windowTitle: bundle.getString(&quot;cookiepermissionstitle&quot;),</span>
<a href="#l20.85"></a><span id="l20.85" class="difflineplus">+                   introText: bundle.getString(&quot;cookiepermissionstext&quot;) };</span>
<a href="#l20.86"></a><span id="l20.86">     gSubDialog.open(&quot;chrome://messenger/content/preferences/permissions.xul&quot;,</span>
<a href="#l20.87"></a><span id="l20.87">                     null, params);</span>
<a href="#l20.88"></a><span id="l20.88">   },</span>
<a href="#l20.89"></a><span id="l20.89"> </span>
<a href="#l20.90"></a><span id="l20.90">   /**</span>
<a href="#l20.91"></a><span id="l20.91">    * Displays all the user's cookies in a dialog.</span>
<a href="#l20.92"></a><span id="l20.92">    */</span>
<a href="#l20.93"></a><span id="l20.93" class="difflineminus">-  showCookies: function(aCategory)</span>
<a href="#l20.94"></a><span id="l20.94" class="difflineminus">-  {</span>
<a href="#l20.95"></a><span id="l20.95" class="difflineplus">+  showCookies(aCategory) {</span>
<a href="#l20.96"></a><span id="l20.96">     gSubDialog.open(&quot;chrome://messenger/content/preferences/cookies.xul&quot;);</span>
<a href="#l20.97"></a><span id="l20.97">   },</span>
<a href="#l20.98"></a><span id="l20.98"> </span>
<a href="#l20.99"></a><span id="l20.99">   /**</span>
<a href="#l20.100"></a><span id="l20.100">    * Converts between network.cookie.cookieBehavior and the third-party cookie UI</span>
<a href="#l20.101"></a><span id="l20.101">    */</span>
<a href="#l20.102"></a><span id="l20.102" class="difflineminus">-  readAcceptThirdPartyCookies: function()</span>
<a href="#l20.103"></a><span id="l20.103" class="difflineminus">-  {</span>
<a href="#l20.104"></a><span id="l20.104" class="difflineplus">+  readAcceptThirdPartyCookies() {</span>
<a href="#l20.105"></a><span id="l20.105">     let pref = document.getElementById(&quot;network.cookie.cookieBehavior&quot;);</span>
<a href="#l20.106"></a><span id="l20.106" class="difflineminus">-    switch (pref.value)</span>
<a href="#l20.107"></a><span id="l20.107" class="difflineminus">-    {</span>
<a href="#l20.108"></a><span id="l20.108" class="difflineplus">+    switch (pref.value) {</span>
<a href="#l20.109"></a><span id="l20.109">       case 0:</span>
<a href="#l20.110"></a><span id="l20.110">         return &quot;always&quot;;</span>
<a href="#l20.111"></a><span id="l20.111">       case 1:</span>
<a href="#l20.112"></a><span id="l20.112">         return &quot;never&quot;;</span>
<a href="#l20.113"></a><span id="l20.113">       case 2:</span>
<a href="#l20.114"></a><span id="l20.114">         return &quot;never&quot;;</span>
<a href="#l20.115"></a><span id="l20.115">       case 3:</span>
<a href="#l20.116"></a><span id="l20.116">         return &quot;visited&quot;;</span>
<a href="#l20.117"></a><span id="l20.117">       default:</span>
<a href="#l20.118"></a><span id="l20.118">         return undefined;</span>
<a href="#l20.119"></a><span id="l20.119">     }</span>
<a href="#l20.120"></a><span id="l20.120">   },</span>
<a href="#l20.121"></a><span id="l20.121"> </span>
<a href="#l20.122"></a><span id="l20.122" class="difflineminus">-  writeAcceptThirdPartyCookies: function()</span>
<a href="#l20.123"></a><span id="l20.123" class="difflineminus">-  {</span>
<a href="#l20.124"></a><span id="l20.124" class="difflineplus">+  writeAcceptThirdPartyCookies() {</span>
<a href="#l20.125"></a><span id="l20.125">     let accept = document.getElementById(&quot;acceptThirdPartyMenu&quot;).selectedItem;</span>
<a href="#l20.126"></a><span id="l20.126" class="difflineminus">-    switch (accept.value)</span>
<a href="#l20.127"></a><span id="l20.127" class="difflineminus">-    {</span>
<a href="#l20.128"></a><span id="l20.128" class="difflineplus">+    switch (accept.value) {</span>
<a href="#l20.129"></a><span id="l20.129">       case &quot;always&quot;:</span>
<a href="#l20.130"></a><span id="l20.130">         return 0;</span>
<a href="#l20.131"></a><span id="l20.131">       case &quot;visited&quot;:</span>
<a href="#l20.132"></a><span id="l20.132">         return 3;</span>
<a href="#l20.133"></a><span id="l20.133">       case &quot;never&quot;:</span>
<a href="#l20.134"></a><span id="l20.134">         return 1;</span>
<a href="#l20.135"></a><span id="l20.135">       default:</span>
<a href="#l20.136"></a><span id="l20.136">         return undefined;</span>
<a href="#l20.137"></a><span id="l20.137">     }</span>
<a href="#l20.138"></a><span id="l20.138">   },</span>
<a href="#l20.139"></a><span id="l20.139"> </span>
<a href="#l20.140"></a><span id="l20.140">   /**</span>
<a href="#l20.141"></a><span id="l20.141">    * Displays fine-grained, per-site preferences for remote content.</span>
<a href="#l20.142"></a><span id="l20.142">    * We use the &quot;image&quot; type for that, but it can also be stylesheets or</span>
<a href="#l20.143"></a><span id="l20.143">    * iframes.</span>
<a href="#l20.144"></a><span id="l20.144">    */</span>
<a href="#l20.145"></a><span id="l20.145" class="difflineminus">-  showRemoteContentExceptions: function()</span>
<a href="#l20.146"></a><span id="l20.146" class="difflineminus">-  {</span>
<a href="#l20.147"></a><span id="l20.147" class="difflineplus">+  showRemoteContentExceptions() {</span>
<a href="#l20.148"></a><span id="l20.148">     let bundle = document.getElementById(&quot;bundlePreferences&quot;);</span>
<a href="#l20.149"></a><span id="l20.149" class="difflineminus">-    let params = { blockVisible   : true,</span>
<a href="#l20.150"></a><span id="l20.150" class="difflineminus">-                   sessionVisible : false,</span>
<a href="#l20.151"></a><span id="l20.151" class="difflineminus">-                   allowVisible   : true,</span>
<a href="#l20.152"></a><span id="l20.152" class="difflineminus">-                   prefilledHost  : &quot;&quot;,</span>
<a href="#l20.153"></a><span id="l20.153" class="difflineminus">-                   permissionType : &quot;image&quot;,</span>
<a href="#l20.154"></a><span id="l20.154" class="difflineminus">-                   windowTitle    : bundle.getString(&quot;imagepermissionstitle&quot;),</span>
<a href="#l20.155"></a><span id="l20.155" class="difflineminus">-                   introText      : bundle.getString(&quot;imagepermissionstext&quot;) };</span>
<a href="#l20.156"></a><span id="l20.156" class="difflineplus">+    let params = { blockVisible: true,</span>
<a href="#l20.157"></a><span id="l20.157" class="difflineplus">+                   sessionVisible: false,</span>
<a href="#l20.158"></a><span id="l20.158" class="difflineplus">+                   allowVisible: true,</span>
<a href="#l20.159"></a><span id="l20.159" class="difflineplus">+                   prefilledHost: &quot;&quot;,</span>
<a href="#l20.160"></a><span id="l20.160" class="difflineplus">+                   permissionType: &quot;image&quot;,</span>
<a href="#l20.161"></a><span id="l20.161" class="difflineplus">+                   windowTitle: bundle.getString(&quot;imagepermissionstitle&quot;),</span>
<a href="#l20.162"></a><span id="l20.162" class="difflineplus">+                   introText: bundle.getString(&quot;imagepermissionstext&quot;) };</span>
<a href="#l20.163"></a><span id="l20.163">     gSubDialog.open(&quot;chrome://messenger/content/preferences/permissions.xul&quot;,</span>
<a href="#l20.164"></a><span id="l20.164">                     null, params);</span>
<a href="#l20.165"></a><span id="l20.165">   },</span>
<a href="#l20.166"></a><span id="l20.166"> };</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l21.1"></a><span id="l21.1" class="difflineminus">--- a/mail/components/preferences/security.js</span>
<a href="#l21.2"></a><span id="l21.2" class="difflineplus">+++ b/mail/components/preferences/security.js</span>
<a href="#l21.3"></a><span id="l21.3" class="difflineat">@@ -4,62 +4,56 @@</span>
<a href="#l21.4"></a><span id="l21.4">  * file, You can obtain one at http://mozilla.org/MPL/2.0/. */</span>
<a href="#l21.5"></a><span id="l21.5"> </span>
<a href="#l21.6"></a><span id="l21.6"> ChromeUtils.defineModuleGetter(this, &quot;LoginHelper&quot;, &quot;resource://gre/modules/LoginHelper.jsm&quot;);</span>
<a href="#l21.7"></a><span id="l21.7"> </span>
<a href="#l21.8"></a><span id="l21.8"> var gSecurityPane = {</span>
<a href="#l21.9"></a><span id="l21.9">   mPane: null,</span>
<a href="#l21.10"></a><span id="l21.10">   mInitialized: false,</span>
<a href="#l21.11"></a><span id="l21.11"> </span>
<a href="#l21.12"></a><span id="l21.12" class="difflineminus">-  init: function ()</span>
<a href="#l21.13"></a><span id="l21.13" class="difflineminus">-  {</span>
<a href="#l21.14"></a><span id="l21.14" class="difflineplus">+  init() {</span>
<a href="#l21.15"></a><span id="l21.15">     this.mPane = document.getElementById(&quot;paneSecurity&quot;);</span>
<a href="#l21.16"></a><span id="l21.16"> </span>
<a href="#l21.17"></a><span id="l21.17" class="difflineminus">-    this.updateManualMarkMode(document.getElementById('manualMark').checked);</span>
<a href="#l21.18"></a><span id="l21.18" class="difflineminus">-    this.updateJunkLogButton(document.getElementById('enableJunkLogging').checked);</span>
<a href="#l21.19"></a><span id="l21.19" class="difflineplus">+    this.updateManualMarkMode(document.getElementById(&quot;manualMark&quot;).checked);</span>
<a href="#l21.20"></a><span id="l21.20" class="difflineplus">+    this.updateJunkLogButton(document.getElementById(&quot;enableJunkLogging&quot;).checked);</span>
<a href="#l21.21"></a><span id="l21.21"> </span>
<a href="#l21.22"></a><span id="l21.22">     this._initMasterPasswordUI();</span>
<a href="#l21.23"></a><span id="l21.23"> </span>
<a href="#l21.24"></a><span id="l21.24">     // update the checkbox for downloading phishing url tables</span>
<a href="#l21.25"></a><span id="l21.25">     // this.updateDownloadedPhishingListState();</span>
<a href="#l21.26"></a><span id="l21.26"> </span>
<a href="#l21.27"></a><span id="l21.27">     if (!((&quot;arguments&quot; in window) &amp;&amp; window.arguments[1])) {</span>
<a href="#l21.28"></a><span id="l21.28">       // If no tab was specified, select the last used tab.</span>
<a href="#l21.29"></a><span id="l21.29">       let preference = document.getElementById(&quot;mail.preferences.security.selectedTabIndex&quot;);</span>
<a href="#l21.30"></a><span id="l21.30">       if (preference.value)</span>
<a href="#l21.31"></a><span id="l21.31">         document.getElementById(&quot;securityPrefs&quot;).selectedIndex = preference.value;</span>
<a href="#l21.32"></a><span id="l21.32">     }</span>
<a href="#l21.33"></a><span id="l21.33"> </span>
<a href="#l21.34"></a><span id="l21.34">     this.mInitialized = true;</span>
<a href="#l21.35"></a><span id="l21.35">   },</span>
<a href="#l21.36"></a><span id="l21.36"> </span>
<a href="#l21.37"></a><span id="l21.37" class="difflineminus">-  tabSelectionChanged: function ()</span>
<a href="#l21.38"></a><span id="l21.38" class="difflineminus">-  {</span>
<a href="#l21.39"></a><span id="l21.39" class="difflineplus">+  tabSelectionChanged() {</span>
<a href="#l21.40"></a><span id="l21.40">     if (this.mInitialized)</span>
<a href="#l21.41"></a><span id="l21.41">       document.getElementById(&quot;mail.preferences.security.selectedTabIndex&quot;)</span>
<a href="#l21.42"></a><span id="l21.42">               .valueFromPreferences = document.getElementById(&quot;securityPrefs&quot;).selectedIndex;</span>
<a href="#l21.43"></a><span id="l21.43">   },</span>
<a href="#l21.44"></a><span id="l21.44"> </span>
<a href="#l21.45"></a><span id="l21.45" class="difflineminus">-  updateManualMarkMode: function(aEnableRadioGroup)</span>
<a href="#l21.46"></a><span id="l21.46" class="difflineminus">-  {</span>
<a href="#l21.47"></a><span id="l21.47" class="difflineminus">-    document.getElementById('manualMarkMode').disabled = !aEnableRadioGroup;</span>
<a href="#l21.48"></a><span id="l21.48" class="difflineplus">+  updateManualMarkMode(aEnableRadioGroup) {</span>
<a href="#l21.49"></a><span id="l21.49" class="difflineplus">+    document.getElementById(&quot;manualMarkMode&quot;).disabled = !aEnableRadioGroup;</span>
<a href="#l21.50"></a><span id="l21.50">   },</span>
<a href="#l21.51"></a><span id="l21.51"> </span>
<a href="#l21.52"></a><span id="l21.52" class="difflineminus">-  updateJunkLogButton: function(aEnableButton)</span>
<a href="#l21.53"></a><span id="l21.53" class="difflineminus">-  {</span>
<a href="#l21.54"></a><span id="l21.54" class="difflineminus">-    document.getElementById('openJunkLogButton').disabled = !aEnableButton;</span>
<a href="#l21.55"></a><span id="l21.55" class="difflineplus">+  updateJunkLogButton(aEnableButton) {</span>
<a href="#l21.56"></a><span id="l21.56" class="difflineplus">+    document.getElementById(&quot;openJunkLogButton&quot;).disabled = !aEnableButton;</span>
<a href="#l21.57"></a><span id="l21.57">   },</span>
<a href="#l21.58"></a><span id="l21.58"> </span>
<a href="#l21.59"></a><span id="l21.59" class="difflineminus">-  openJunkLog: function()</span>
<a href="#l21.60"></a><span id="l21.60" class="difflineminus">-  {</span>
<a href="#l21.61"></a><span id="l21.61" class="difflineplus">+  openJunkLog() {</span>
<a href="#l21.62"></a><span id="l21.62">     gSubDialog.open(&quot;chrome://messenger/content/junkLog.xul&quot;);</span>
<a href="#l21.63"></a><span id="l21.63">   },</span>
<a href="#l21.64"></a><span id="l21.64"> </span>
<a href="#l21.65"></a><span id="l21.65" class="difflineminus">-  resetTrainingData: function()</span>
<a href="#l21.66"></a><span id="l21.66" class="difflineminus">-  {</span>
<a href="#l21.67"></a><span id="l21.67" class="difflineplus">+  resetTrainingData() {</span>
<a href="#l21.68"></a><span id="l21.68">     // make sure the user really wants to do this</span>
<a href="#l21.69"></a><span id="l21.69">     var bundle = document.getElementById(&quot;bundlePreferences&quot;);</span>
<a href="#l21.70"></a><span id="l21.70">     var title = bundle.getString(&quot;confirmResetJunkTrainingTitle&quot;);</span>
<a href="#l21.71"></a><span id="l21.71">     var text = bundle.getString(&quot;confirmResetJunkTrainingText&quot;);</span>
<a href="#l21.72"></a><span id="l21.72"> </span>
<a href="#l21.73"></a><span id="l21.73">     // if the user says no, then just fall out</span>
<a href="#l21.74"></a><span id="l21.74">     if (!Services.prompt.confirm(window, title, text))</span>
<a href="#l21.75"></a><span id="l21.75">       return;</span>
<a href="#l21.76"></a><span id="l21.76" class="difflineat">@@ -68,45 +62,42 @@ var gSecurityPane = {</span>
<a href="#l21.77"></a><span id="l21.77">     MailServices.junk.resetTrainingData();</span>
<a href="#l21.78"></a><span id="l21.78">   },</span>
<a href="#l21.79"></a><span id="l21.79"> </span>
<a href="#l21.80"></a><span id="l21.80"> </span>
<a href="#l21.81"></a><span id="l21.81">   /**</span>
<a href="#l21.82"></a><span id="l21.82">    * Reload the current message after a preference affecting the view</span>
<a href="#l21.83"></a><span id="l21.83">    * has been changed and we are in instantApply mode.</span>
<a href="#l21.84"></a><span id="l21.84">    */</span>
<a href="#l21.85"></a><span id="l21.85" class="difflineminus">-  reloadMessageInOpener: function()</span>
<a href="#l21.86"></a><span id="l21.86" class="difflineminus">-  {</span>
<a href="#l21.87"></a><span id="l21.87" class="difflineminus">-    if(Services.prefs.getBoolPref(&quot;browser.preferences.instantApply&quot;) &amp;&amp;</span>
<a href="#l21.88"></a><span id="l21.88" class="difflineplus">+  reloadMessageInOpener() {</span>
<a href="#l21.89"></a><span id="l21.89" class="difflineplus">+    if (Services.prefs.getBoolPref(&quot;browser.preferences.instantApply&quot;) &amp;&amp;</span>
<a href="#l21.90"></a><span id="l21.90">        window.opener &amp;&amp; typeof(window.opener.ReloadMessage) == &quot;function&quot;)</span>
<a href="#l21.91"></a><span id="l21.91">       window.opener.ReloadMessage();</span>
<a href="#l21.92"></a><span id="l21.92">   },</span>
<a href="#l21.93"></a><span id="l21.93"> </span>
<a href="#l21.94"></a><span id="l21.94">   /**</span>
<a href="#l21.95"></a><span id="l21.95">    * Initializes master password UI: the &quot;use master password&quot; checkbox, selects</span>
<a href="#l21.96"></a><span id="l21.96">    * the master password button to show, and enables/disables it as necessary.</span>
<a href="#l21.97"></a><span id="l21.97">    * The master password is controlled by various bits of NSS functionality,</span>
<a href="#l21.98"></a><span id="l21.98">    * so the UI for it can't be controlled by the normal preference bindings.</span>
<a href="#l21.99"></a><span id="l21.99">    */</span>
<a href="#l21.100"></a><span id="l21.100" class="difflineminus">-  _initMasterPasswordUI: function ()</span>
<a href="#l21.101"></a><span id="l21.101" class="difflineminus">-  {</span>
<a href="#l21.102"></a><span id="l21.102" class="difflineplus">+  _initMasterPasswordUI() {</span>
<a href="#l21.103"></a><span id="l21.103">     var noMP = !LoginHelper.isMasterPasswordSet();</span>
<a href="#l21.104"></a><span id="l21.104"> </span>
<a href="#l21.105"></a><span id="l21.105">     document.getElementById(&quot;changeMasterPassword&quot;).disabled = noMP;</span>
<a href="#l21.106"></a><span id="l21.106"> </span>
<a href="#l21.107"></a><span id="l21.107">     document.getElementById(&quot;useMasterPassword&quot;).checked = !noMP;</span>
<a href="#l21.108"></a><span id="l21.108">   },</span>
<a href="#l21.109"></a><span id="l21.109"> </span>
<a href="#l21.110"></a><span id="l21.110">   /**</span>
<a href="#l21.111"></a><span id="l21.111">    * Enables/disables the master password button depending on the state of the</span>
<a href="#l21.112"></a><span id="l21.112">    * &quot;use master password&quot; checkbox, and prompts for master password removal</span>
<a href="#l21.113"></a><span id="l21.113">    * if one is set.</span>
<a href="#l21.114"></a><span id="l21.114">    */</span>
<a href="#l21.115"></a><span id="l21.115" class="difflineminus">-  updateMasterPasswordButton: function ()</span>
<a href="#l21.116"></a><span id="l21.116" class="difflineminus">-  {</span>
<a href="#l21.117"></a><span id="l21.117" class="difflineplus">+  updateMasterPasswordButton() {</span>
<a href="#l21.118"></a><span id="l21.118">     var checkbox = document.getElementById(&quot;useMasterPassword&quot;);</span>
<a href="#l21.119"></a><span id="l21.119">     var button = document.getElementById(&quot;changeMasterPassword&quot;);</span>
<a href="#l21.120"></a><span id="l21.120">     button.disabled = !checkbox.checked;</span>
<a href="#l21.121"></a><span id="l21.121"> </span>
<a href="#l21.122"></a><span id="l21.122">     // unchecking the checkbox should try to immediately remove the master</span>
<a href="#l21.123"></a><span id="l21.123">     // password, because it's impossible to non-destructively remove the master</span>
<a href="#l21.124"></a><span id="l21.124">     // password used to encrypt all the passwords without providing it (by</span>
<a href="#l21.125"></a><span id="l21.125">     // design), and it would be extremely odd to pop up that dialog when the</span>
<a href="#l21.126"></a><span id="l21.126" class="difflineat">@@ -119,49 +110,44 @@ var gSecurityPane = {</span>
<a href="#l21.127"></a><span id="l21.127">     this._initMasterPasswordUI();</span>
<a href="#l21.128"></a><span id="l21.128">   },</span>
<a href="#l21.129"></a><span id="l21.129"> </span>
<a href="#l21.130"></a><span id="l21.130">   /**</span>
<a href="#l21.131"></a><span id="l21.131">    * Displays the &quot;remove master password&quot; dialog to allow the user to remove</span>
<a href="#l21.132"></a><span id="l21.132">    * the current master password.  When the dialog is dismissed, master password</span>
<a href="#l21.133"></a><span id="l21.133">    * UI is automatically updated.</span>
<a href="#l21.134"></a><span id="l21.134">    */</span>
<a href="#l21.135"></a><span id="l21.135" class="difflineminus">-  _removeMasterPassword: function ()</span>
<a href="#l21.136"></a><span id="l21.136" class="difflineminus">-  {</span>
<a href="#l21.137"></a><span id="l21.137" class="difflineplus">+  _removeMasterPassword() {</span>
<a href="#l21.138"></a><span id="l21.138">     var secmodDB = Cc[&quot;@mozilla.org/security/pkcs11moduledb;1&quot;].</span>
<a href="#l21.139"></a><span id="l21.139">                    getService(Ci.nsIPKCS11ModuleDB);</span>
<a href="#l21.140"></a><span id="l21.140">     if (secmodDB.isFIPSEnabled) {</span>
<a href="#l21.141"></a><span id="l21.141">       let bundle = document.getElementById(&quot;bundleMasterPwPreferences&quot;);</span>
<a href="#l21.142"></a><span id="l21.142">       Services.prompt.alert(window,</span>
<a href="#l21.143"></a><span id="l21.143">                             bundle.getString(&quot;pw_change_failed_title&quot;),</span>
<a href="#l21.144"></a><span id="l21.144">                             bundle.getString(&quot;pw_change2empty_in_fips_mode&quot;));</span>
<a href="#l21.145"></a><span id="l21.145" class="difflineminus">-    }</span>
<a href="#l21.146"></a><span id="l21.146" class="difflineminus">-    else {</span>
<a href="#l21.147"></a><span id="l21.147" class="difflineplus">+    } else {</span>
<a href="#l21.148"></a><span id="l21.148">       gSubDialog.open(&quot;chrome://mozapps/content/preferences/removemp.xul&quot;,</span>
<a href="#l21.149"></a><span id="l21.149">                       null, null, this._initMasterPasswordUI.bind(this));</span>
<a href="#l21.150"></a><span id="l21.150">     }</span>
<a href="#l21.151"></a><span id="l21.151">     this._initMasterPasswordUI();</span>
<a href="#l21.152"></a><span id="l21.152">   },</span>
<a href="#l21.153"></a><span id="l21.153"> </span>
<a href="#l21.154"></a><span id="l21.154">   /**</span>
<a href="#l21.155"></a><span id="l21.155">    * Displays a dialog in which the master password may be changed.</span>
<a href="#l21.156"></a><span id="l21.156">    */</span>
<a href="#l21.157"></a><span id="l21.157" class="difflineminus">-  changeMasterPassword: function ()</span>
<a href="#l21.158"></a><span id="l21.158" class="difflineminus">-  {</span>
<a href="#l21.159"></a><span id="l21.159" class="difflineplus">+  changeMasterPassword() {</span>
<a href="#l21.160"></a><span id="l21.160">     gSubDialog.open(&quot;chrome://mozapps/content/preferences/changemp.xul&quot;,</span>
<a href="#l21.161"></a><span id="l21.161">                     null, null, this._initMasterPasswordUI.bind(this));</span>
<a href="#l21.162"></a><span id="l21.162">   },</span>
<a href="#l21.163"></a><span id="l21.163"> </span>
<a href="#l21.164"></a><span id="l21.164">   /**</span>
<a href="#l21.165"></a><span id="l21.165">    * Shows the sites where the user has saved passwords and the associated</span>
<a href="#l21.166"></a><span id="l21.166">    * login information.</span>
<a href="#l21.167"></a><span id="l21.167">    */</span>
<a href="#l21.168"></a><span id="l21.168" class="difflineminus">-  showPasswords: function ()</span>
<a href="#l21.169"></a><span id="l21.169" class="difflineminus">-  {</span>
<a href="#l21.170"></a><span id="l21.170" class="difflineplus">+  showPasswords() {</span>
<a href="#l21.171"></a><span id="l21.171">     gSubDialog.open(&quot;chrome://passwordmgr/content/passwordManager.xul&quot;);</span>
<a href="#l21.172"></a><span id="l21.172">   },</span>
<a href="#l21.173"></a><span id="l21.173"> </span>
<a href="#l21.174"></a><span id="l21.174" class="difflineminus">-  updateDownloadedPhishingListState: function()</span>
<a href="#l21.175"></a><span id="l21.175" class="difflineminus">-  {</span>
<a href="#l21.176"></a><span id="l21.176" class="difflineminus">-    document.getElementById('useDownloadedList').disabled = !document.getElementById('enablePhishingDetector').checked;</span>
<a href="#l21.177"></a><span id="l21.177" class="difflineplus">+  updateDownloadedPhishingListState() {</span>
<a href="#l21.178"></a><span id="l21.178" class="difflineplus">+    document.getElementById(&quot;useDownloadedList&quot;).disabled = !document.getElementById(&quot;enablePhishingDetector&quot;).checked;</span>
<a href="#l21.179"></a><span id="l21.179">   },</span>
<a href="#l21.180"></a><span id="l21.180"> </span>
<a href="#l21.181"></a><span id="l21.181"> };</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l22.1"></a><span id="l22.1" class="difflineminus">--- a/mail/components/preferences/sendoptions.js</span>
<a href="#l22.2"></a><span id="l22.2" class="difflineplus">+++ b/mail/components/preferences/sendoptions.js</span>
<a href="#l22.3"></a><span id="l22.3" class="difflineat">@@ -5,111 +5,99 @@</span>
<a href="#l22.4"></a><span id="l22.4"> </span>
<a href="#l22.5"></a><span id="l22.5"> ChromeUtils.import(&quot;resource://gre/modules/Services.jsm&quot;);</span>
<a href="#l22.6"></a><span id="l22.6"> </span>
<a href="#l22.7"></a><span id="l22.7"> var gSendOptionsDialog = {</span>
<a href="#l22.8"></a><span id="l22.8">   mPrefsBundle: null,</span>
<a href="#l22.9"></a><span id="l22.9">   mHTMLListBox: null,</span>
<a href="#l22.10"></a><span id="l22.10">   mPlainTextListBox: null,</span>
<a href="#l22.11"></a><span id="l22.11"> </span>
<a href="#l22.12"></a><span id="l22.12" class="difflineminus">-  init: function ()</span>
<a href="#l22.13"></a><span id="l22.13" class="difflineminus">-  {</span>
<a href="#l22.14"></a><span id="l22.14" class="difflineminus">-    this.mPrefsBundle = document.getElementById('bundlePreferences');</span>
<a href="#l22.15"></a><span id="l22.15" class="difflineminus">-    this.mHTMLListBox = document.getElementById('html_domains');</span>
<a href="#l22.16"></a><span id="l22.16" class="difflineminus">-    this.mPlainTextListBox = document.getElementById('plaintext_domains');</span>
<a href="#l22.17"></a><span id="l22.17" class="difflineplus">+  init() {</span>
<a href="#l22.18"></a><span id="l22.18" class="difflineplus">+    this.mPrefsBundle = document.getElementById(&quot;bundlePreferences&quot;);</span>
<a href="#l22.19"></a><span id="l22.19" class="difflineplus">+    this.mHTMLListBox = document.getElementById(&quot;html_domains&quot;);</span>
<a href="#l22.20"></a><span id="l22.20" class="difflineplus">+    this.mPlainTextListBox = document.getElementById(&quot;plaintext_domains&quot;);</span>
<a href="#l22.21"></a><span id="l22.21"> </span>
<a href="#l22.22"></a><span id="l22.22" class="difflineminus">-    var htmlDomainPrefString = document.getElementById('mailnews.html_domains').value;</span>
<a href="#l22.23"></a><span id="l22.23" class="difflineminus">-    this.loadDomains(document.getElementById('mailnews.html_domains').value,</span>
<a href="#l22.24"></a><span id="l22.24" class="difflineplus">+    var htmlDomainPrefString = document.getElementById(&quot;mailnews.html_domains&quot;).value;</span>
<a href="#l22.25"></a><span id="l22.25" class="difflineplus">+    this.loadDomains(document.getElementById(&quot;mailnews.html_domains&quot;).value,</span>
<a href="#l22.26"></a><span id="l22.26">                      this.mHTMLListBox);</span>
<a href="#l22.27"></a><span id="l22.27" class="difflineminus">-    this.loadDomains(document.getElementById('mailnews.plaintext_domains').value,</span>
<a href="#l22.28"></a><span id="l22.28" class="difflineplus">+    this.loadDomains(document.getElementById(&quot;mailnews.plaintext_domains&quot;).value,</span>
<a href="#l22.29"></a><span id="l22.29">                      this.mPlainTextListBox);</span>
<a href="#l22.30"></a><span id="l22.30">   },</span>
<a href="#l22.31"></a><span id="l22.31"> </span>
<a href="#l22.32"></a><span id="l22.32" class="difflineminus">-  saveDomainPref: function(aHTML)</span>
<a href="#l22.33"></a><span id="l22.33" class="difflineminus">-  {</span>
<a href="#l22.34"></a><span id="l22.34" class="difflineplus">+  saveDomainPref(aHTML) {</span>
<a href="#l22.35"></a><span id="l22.35">     var listbox = aHTML ? this.mHTMLListBox : this.mPlainTextListBox;</span>
<a href="#l22.36"></a><span id="l22.36">     var num_domains = 0;</span>
<a href="#l22.37"></a><span id="l22.37">     var pref_string = &quot;&quot;;</span>
<a href="#l22.38"></a><span id="l22.38"> </span>
<a href="#l22.39"></a><span id="l22.39" class="difflineminus">-    for (var item = listbox.firstChild; item != null; item = item.nextSibling)</span>
<a href="#l22.40"></a><span id="l22.40" class="difflineminus">-    {</span>
<a href="#l22.41"></a><span id="l22.41" class="difflineplus">+    for (var item = listbox.firstChild; item != null; item = item.nextSibling) {</span>
<a href="#l22.42"></a><span id="l22.42">       var domainid = item.firstChild.getAttribute(&quot;value&quot;);</span>
<a href="#l22.43"></a><span id="l22.43" class="difflineminus">-      if (domainid.length &gt; 1)</span>
<a href="#l22.44"></a><span id="l22.44" class="difflineminus">-      {</span>
<a href="#l22.45"></a><span id="l22.45" class="difflineplus">+      if (domainid.length &gt; 1) {</span>
<a href="#l22.46"></a><span id="l22.46">         num_domains++;</span>
<a href="#l22.47"></a><span id="l22.47"> </span>
<a href="#l22.48"></a><span id="l22.48">         // Separate &gt;1 domains by commas.</span>
<a href="#l22.49"></a><span id="l22.49">         if (num_domains &gt; 1)</span>
<a href="#l22.50"></a><span id="l22.50">           pref_string = pref_string + &quot;,&quot; + domainid;</span>
<a href="#l22.51"></a><span id="l22.51">         else</span>
<a href="#l22.52"></a><span id="l22.52">           pref_string = domainid;</span>
<a href="#l22.53"></a><span id="l22.53">       }</span>
<a href="#l22.54"></a><span id="l22.54">     }</span>
<a href="#l22.55"></a><span id="l22.55"> </span>
<a href="#l22.56"></a><span id="l22.56">     return pref_string;</span>
<a href="#l22.57"></a><span id="l22.57">   },</span>
<a href="#l22.58"></a><span id="l22.58"> </span>
<a href="#l22.59"></a><span id="l22.59" class="difflineminus">-  loadDomains: function (aPrefString, aListBox)</span>
<a href="#l22.60"></a><span id="l22.60" class="difflineminus">-  {</span>
<a href="#l22.61"></a><span id="l22.61" class="difflineminus">-    var arrayOfPrefs = aPrefString.split(',');</span>
<a href="#l22.62"></a><span id="l22.62" class="difflineplus">+  loadDomains(aPrefString, aListBox) {</span>
<a href="#l22.63"></a><span id="l22.63" class="difflineplus">+    var arrayOfPrefs = aPrefString.split(&quot;,&quot;);</span>
<a href="#l22.64"></a><span id="l22.64">     if (arrayOfPrefs)</span>
<a href="#l22.65"></a><span id="l22.65" class="difflineminus">-      for (var i = 0; i &lt; arrayOfPrefs.length; i++)</span>
<a href="#l22.66"></a><span id="l22.66" class="difflineminus">-      {</span>
<a href="#l22.67"></a><span id="l22.67" class="difflineminus">-        var str = arrayOfPrefs[i].replace(/ /g,&quot;&quot;);</span>
<a href="#l22.68"></a><span id="l22.68" class="difflineplus">+      for (var i = 0; i &lt; arrayOfPrefs.length; i++) {</span>
<a href="#l22.69"></a><span id="l22.69" class="difflineplus">+        var str = arrayOfPrefs[i].replace(/ /g, &quot;&quot;);</span>
<a href="#l22.70"></a><span id="l22.70">         if (str)</span>
<a href="#l22.71"></a><span id="l22.71">           this.addItemToDomainList(aListBox, str);</span>
<a href="#l22.72"></a><span id="l22.72">       }</span>
<a href="#l22.73"></a><span id="l22.73">   },</span>
<a href="#l22.74"></a><span id="l22.74"> </span>
<a href="#l22.75"></a><span id="l22.75" class="difflineminus">-  removeDomains: function(aHTML)</span>
<a href="#l22.76"></a><span id="l22.76" class="difflineminus">-  {</span>
<a href="#l22.77"></a><span id="l22.77" class="difflineplus">+  removeDomains(aHTML) {</span>
<a href="#l22.78"></a><span id="l22.78">     let listbox = aHTML ? this.mHTMLListBox : this.mPlainTextListBox;</span>
<a href="#l22.79"></a><span id="l22.79"> </span>
<a href="#l22.80"></a><span id="l22.80">     let selectedCount = listbox.selectedItems.length;</span>
<a href="#l22.81"></a><span id="l22.81">     for (let i = selectedCount - 1; i &gt;= 0; i--)</span>
<a href="#l22.82"></a><span id="l22.82">       listbox.selectedItems[i].remove();</span>
<a href="#l22.83"></a><span id="l22.83"> </span>
<a href="#l22.84"></a><span id="l22.84" class="difflineminus">-    document.getElementById('SendOptionsDialogPane').userChangedValue(listbox);</span>
<a href="#l22.85"></a><span id="l22.85" class="difflineplus">+    document.getElementById(&quot;SendOptionsDialogPane&quot;).userChangedValue(listbox);</span>
<a href="#l22.86"></a><span id="l22.86">   },</span>
<a href="#l22.87"></a><span id="l22.87"> </span>
<a href="#l22.88"></a><span id="l22.88" class="difflineminus">-  addDomain: function (aHTML)</span>
<a href="#l22.89"></a><span id="l22.89" class="difflineminus">-  {</span>
<a href="#l22.90"></a><span id="l22.90" class="difflineplus">+  addDomain(aHTML) {</span>
<a href="#l22.91"></a><span id="l22.91">     var listbox = aHTML ? this.mHTMLListBox : this.mPlainTextListBox;</span>
<a href="#l22.92"></a><span id="l22.92"> </span>
<a href="#l22.93"></a><span id="l22.93">     var domainName;</span>
<a href="#l22.94"></a><span id="l22.94" class="difflineminus">-    var result = {value:null};</span>
<a href="#l22.95"></a><span id="l22.95" class="difflineminus">-    if (Services.prompt.prompt(window, this.mPrefsBundle.getString(listbox.id + 'AddDomainTitle'),</span>
<a href="#l22.96"></a><span id="l22.96" class="difflineminus">-                               this.mPrefsBundle.getString(listbox.id + 'AddDomain'), result, null, {value:0}))</span>
<a href="#l22.97"></a><span id="l22.97" class="difflineminus">-      domainName = result.value.replace(/ /g,&quot;&quot;);</span>
<a href="#l22.98"></a><span id="l22.98" class="difflineplus">+    var result = {value: null};</span>
<a href="#l22.99"></a><span id="l22.99" class="difflineplus">+    if (Services.prompt.prompt(window, this.mPrefsBundle.getString(listbox.id + &quot;AddDomainTitle&quot;),</span>
<a href="#l22.100"></a><span id="l22.100" class="difflineplus">+                               this.mPrefsBundle.getString(listbox.id + &quot;AddDomain&quot;), result, null, {value: 0}))</span>
<a href="#l22.101"></a><span id="l22.101" class="difflineplus">+      domainName = result.value.replace(/ /g, &quot;&quot;);</span>
<a href="#l22.102"></a><span id="l22.102"> </span>
<a href="#l22.103"></a><span id="l22.103" class="difflineminus">-    if (domainName &amp;&amp; !this.domainAlreadyPresent(domainName))</span>
<a href="#l22.104"></a><span id="l22.104" class="difflineminus">-    {</span>
<a href="#l22.105"></a><span id="l22.105" class="difflineplus">+    if (domainName &amp;&amp; !this.domainAlreadyPresent(domainName)) {</span>
<a href="#l22.106"></a><span id="l22.106">       this.addItemToDomainList(listbox, domainName);</span>
<a href="#l22.107"></a><span id="l22.107" class="difflineminus">-      document.getElementById('SendOptionsDialogPane').userChangedValue(listbox);</span>
<a href="#l22.108"></a><span id="l22.108" class="difflineplus">+      document.getElementById(&quot;SendOptionsDialogPane&quot;).userChangedValue(listbox);</span>
<a href="#l22.109"></a><span id="l22.109">     }</span>
<a href="#l22.110"></a><span id="l22.110"> </span>
<a href="#l22.111"></a><span id="l22.111">   },</span>
<a href="#l22.112"></a><span id="l22.112"> </span>
<a href="#l22.113"></a><span id="l22.113" class="difflineminus">-  domainAlreadyPresent: function(aDomainName)</span>
<a href="#l22.114"></a><span id="l22.114" class="difflineminus">-  {</span>
<a href="#l22.115"></a><span id="l22.115" class="difflineplus">+  domainAlreadyPresent(aDomainName) {</span>
<a href="#l22.116"></a><span id="l22.116">     let matchingDomains = this.mHTMLListBox.querySelectorAll('[value=&quot;' + aDomainName + '&quot;]');</span>
<a href="#l22.117"></a><span id="l22.117"> </span>
<a href="#l22.118"></a><span id="l22.118">     if (!matchingDomains.length)</span>
<a href="#l22.119"></a><span id="l22.119">       matchingDomains = this.mPlainTextListBox.querySelectorAll('[value=&quot;' + aDomainName + '&quot;]');</span>
<a href="#l22.120"></a><span id="l22.120"> </span>
<a href="#l22.121"></a><span id="l22.121" class="difflineminus">-    if (matchingDomains.length)</span>
<a href="#l22.122"></a><span id="l22.122" class="difflineminus">-    {</span>
<a href="#l22.123"></a><span id="l22.123" class="difflineminus">-      Services.prompt.alert(window, this.mPrefsBundle.getString('domainNameErrorTitle'),</span>
<a href="#l22.124"></a><span id="l22.124" class="difflineplus">+    if (matchingDomains.length) {</span>
<a href="#l22.125"></a><span id="l22.125" class="difflineplus">+      Services.prompt.alert(window, this.mPrefsBundle.getString(&quot;domainNameErrorTitle&quot;),</span>
<a href="#l22.126"></a><span id="l22.126">                             this.mPrefsBundle.getFormattedString(&quot;domainDuplicationError&quot;, [aDomainName]));</span>
<a href="#l22.127"></a><span id="l22.127">     }</span>
<a href="#l22.128"></a><span id="l22.128"> </span>
<a href="#l22.129"></a><span id="l22.129">     return matchingDomains.length;</span>
<a href="#l22.130"></a><span id="l22.130">   },</span>
<a href="#l22.131"></a><span id="l22.131"> </span>
<a href="#l22.132"></a><span id="l22.132" class="difflineminus">-  addItemToDomainList: function (aListBox, aDomainTitle)</span>
<a href="#l22.133"></a><span id="l22.133" class="difflineminus">-  {</span>
<a href="#l22.134"></a><span id="l22.134" class="difflineplus">+  addItemToDomainList(aListBox, aDomainTitle) {</span>
<a href="#l22.135"></a><span id="l22.135">     let label = document.createElement(&quot;label&quot;);</span>
<a href="#l22.136"></a><span id="l22.136">     label.setAttribute(&quot;value&quot;, aDomainTitle);</span>
<a href="#l22.137"></a><span id="l22.137">     let item = document.createElement(&quot;richlistitem&quot;);</span>
<a href="#l22.138"></a><span id="l22.138">     item.appendChild(label);</span>
<a href="#l22.139"></a><span id="l22.139">     aListBox.appendChild(item);</span>
<a href="#l22.140"></a><span id="l22.140" class="difflineminus">-  }</span>
<a href="#l22.141"></a><span id="l22.141" class="difflineplus">+  },</span>
<a href="#l22.142"></a><span id="l22.142"> };</span></pre></div></div>

<div class="page_footer">
<div class="page_footer_text">comm-central</div>
<div class="page_footer_text" style="padding-left: 10px">Deployed from <a href="https://hg.mozilla.org/hgcustom/version-control-tools/rev/4b0de666d1a4">4b0de666d1a4</a> at 2020-07-30T19:32:32Z.</div>
<div class="rss_logo">
<a href="/comm-central/rss-log">RSS</a>
<a href="/comm-central/atom-log">Atom</a>
</div>
<br />

</div>
</body>
</html>

