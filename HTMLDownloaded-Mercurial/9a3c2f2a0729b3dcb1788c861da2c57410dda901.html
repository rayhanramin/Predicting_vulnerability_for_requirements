<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en-US" lang="en-US">
<head>
<link rel="icon" href="/static/35f393d6769a/hgicon.png" type="image/png" />
<meta name="robots" content="index, nofollow"/>
<link rel="stylesheet" href="/static/35f393d6769a/style-gitweb.css" type="text/css" />

<style type="text/css">
div.feed {
  float: right;
}
a img {
  border-width: 0px;
}
div.log_link {
  width: 80px;
  background-color: white;
}

div.log_body {
  padding-left: 96px;
}
</style>
<script type="text/javascript" src="/static/35f393d6769a/mercurial.js"></script>

<meta property="og:image" content="/static/35f393d6769a/moz-logo-bw-rgb.svg"/>
<meta property="og:type" content="website"/>

<title>comm-central: changeset 12430:9a3c2f2a0729b3dcb1788c861da2c57410dda901</title>
<link rel="alternate" type="application/atom+xml"
   href="/comm-central/atom-log" title="Atom feed for comm-central"/>
<link rel="alternate" type="application/rss+xml"
   href="/comm-central/rss-log" title="RSS feed for comm-central"/>

<meta property="og:title" content="comm-central @ 9a3c2f2a0729b3dcb1788c861da2c57410dda901" />
<meta property="og:url" content="/comm-central/rev/9a3c2f2a0729b3dcb1788c861da2c57410dda901" />
<meta property="og:description" content="Fix bug 868721 - Replace doQueryInterface with XPCOMUtils.generateQI. r=mmecca" />

</head>
<body>

<div class="page_header">
<div class="logo">
    <a href="https://developer.mozilla.org/en/docs/Mercurial">
        <img src="/static/35f393d6769a/moz-logo-bw-rgb.svg" alt="mercurial" />
    </a>
</div>
<a href="/">Mercurial</a> &gt; <a href="/comm-central">comm-central</a>  / changeset / 9a3c2f2a0729b3dcb1788c861da2c57410dda901 
</div>

<div class="page_nav">
<div>
<a href="/comm-central/summary">summary</a> |
<a href="/comm-central/shortlog/9a3c2f2a0729b3dcb1788c861da2c57410dda901">shortlog</a> |
<a href="/comm-central/log/9a3c2f2a0729b3dcb1788c861da2c57410dda901">changelog</a> |
<a href="/comm-central/pushloghtml">pushlog</a> |
<a href="/comm-central/graph/9a3c2f2a0729b3dcb1788c861da2c57410dda901">graph</a> |
<a href="/comm-central/tags">tags</a> |
<a href="/comm-central/bookmarks">bookmarks</a> |
<a href="/comm-central/branches">branches</a> |
<a href="/comm-central/file/9a3c2f2a0729b3dcb1788c861da2c57410dda901">files</a> |
changeset |
<a href="/comm-central/raw-rev/9a3c2f2a0729b3dcb1788c861da2c57410dda901">raw</a>  | <a href="/comm-central/archive/9a3c2f2a0729b3dcb1788c861da2c57410dda901.zip">zip</a>  |
<a href="/comm-central/help">help</a>
</div>

<div class="search">
<form id="searchform" action="/comm-central/log">

<input name="rev" type="text" value="" size="40" />
<div id="hint">Find changesets by keywords (author, files, the commit message), revision
number or hash, or <a href="/comm-central/help/revsets">revset expression</a>.</div>
</form>
</div>
</div>

<div class="title">
Fix <a href="https://bugzilla.mozilla.org/show_bug.cgi?id=868721">bug 868721</a> - Replace doQueryInterface with XPCOMUtils.generateQI. r=mmecca
<span class="logtags"></span>
</div>
<div class="title_text">
<table cellspacing="0">

<tr><td>author</td><td>&#80;&#104;&#105;&#108;&#105;&#112;&#112;&#32;&#75;&#101;&#119;&#105;&#115;&#99;&#104;&#32;&#60;&#109;&#111;&#122;&#105;&#108;&#108;&#97;&#64;&#107;&#101;&#119;&#105;&#115;&#46;&#99;&#104;&#62;</td></tr>
<tr><td></td><td class="date age">Mon, 06 May 2013 21:37:07 +0200</td></tr>

<tr>
 <td>changeset 12430</td>
 <td style="font-family:monospace"><a class="list" href="/comm-central/rev/9a3c2f2a0729b3dcb1788c861da2c57410dda901">9a3c2f2a0729b3dcb1788c861da2c57410dda901</a></td>
</tr>



<tr>
<td>parent 12429</td>
<td style="font-family:monospace">
<a class="list" href="/comm-central/rev/3ca1770cc64312e83d1020cbe47357076665dc95">3ca1770cc64312e83d1020cbe47357076665dc95</a>
</td>
</tr>

<tr>
<td>child 12431</td>
<td style="font-family:monospace">
<a class="list" href="/comm-central/rev/c948fbc5b33ce9a5c0a17c29bda8fdf8800fabd5">c948fbc5b33ce9a5c0a17c29bda8fdf8800fabd5</a>
</td>
</tr>
<tr><td>push id</td><td><a href="/comm-central/pushloghtml?changeset=9a3c2f2a0729b3dcb1788c861da2c57410dda901">9168</a></td></tr>
<tr><td>push user</td><td>mozilla@kewis.ch</td></tr>
<tr><td>push date</td><td class="date age">Sun, 12 May 2013 10:22:20 +0000</td></tr>

<tr><td>treeherder</td><td>comm-central@c5b0682b53eb [<a href="https://treeherder.mozilla.org/#/jobs?repo=comm-central&revision=c5b0682b53ebe7d14c04cf11b7612db76e93e92f">default view</a>] [<a href="https://treeherder.mozilla.org/#/jobs?repo=comm-central&revision=c5b0682b53ebe7d14c04cf11b7612db76e93e92f&filter-resultStatus=testfailed&filter-resultStatus=busted&filter-resultStatus=exception">failures only]</td></tr>
<tr><td>perfherder</td><td>[<a href="https://treeherder.mozilla.org/perf.html#/compare?originalProject=comm-central&originalRevision=c5b0682b53ebe7d14c04cf11b7612db76e93e92f&newProject=comm-central&newRevision=3ca1770cc64312e83d1020cbe47357076665dc95&framework=1" target="_blank">talos</a>] [<a href="https://treeherder.mozilla.org/perf.html#/compare?originalProject=comm-central&originalRevision=c5b0682b53ebe7d14c04cf11b7612db76e93e92f&newProject=comm-central&newRevision=3ca1770cc64312e83d1020cbe47357076665dc95&framework=2" target="_blank">build metrics</a>] [<a href="https://treeherder.mozilla.org/perf.html#/compare?originalProject=comm-central&originalRevision=c5b0682b53ebe7d14c04cf11b7612db76e93e92f&newProject=comm-central&newRevision=3ca1770cc64312e83d1020cbe47357076665dc95&framework=6" target="_blank">platform microbench</a>] (compared to previous push)</td></tr>
<tr><td>reviewers</td><td><a href="/comm-central/log?rev=reviewer%28mmecca%29&revcount=50">mmecca</a></td></tr>
<tr><td>bugs</td><td><a href="https://bugzilla.mozilla.org/show_bug.cgi?id=868721">868721</a></td></tr>




</table></div>

<div class="page_body description">Fix <a href="https://bugzilla.mozilla.org/show_bug.cgi?id=868721">bug 868721</a> - Replace doQueryInterface with XPCOMUtils.generateQI. r=mmecca</div>
<div class="list_head"></div>
<div class="title_text">
<table cellspacing="0">

<tr class="parity0">
<td><a class="list" href="/comm-central/diff/9a3c2f2a0729b3dcb1788c861da2c57410dda901/calendar/base/content/calendar-base-view.xml">calendar/base/content/calendar-base-view.xml</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/9a3c2f2a0729b3dcb1788c861da2c57410dda901/calendar/base/content/calendar-base-view.xml">file</a> |
<a href="/comm-central/annotate/9a3c2f2a0729b3dcb1788c861da2c57410dda901/calendar/base/content/calendar-base-view.xml">annotate</a> |
<a href="/comm-central/diff/9a3c2f2a0729b3dcb1788c861da2c57410dda901/calendar/base/content/calendar-base-view.xml">diff</a> |
<a href="/comm-central/comparison/9a3c2f2a0729b3dcb1788c861da2c57410dda901/calendar/base/content/calendar-base-view.xml">comparison</a> |
<a href="/comm-central/log/9a3c2f2a0729b3dcb1788c861da2c57410dda901/calendar/base/content/calendar-base-view.xml">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/9a3c2f2a0729b3dcb1788c861da2c57410dda901/calendar/base/content/calendar-dnd-listener.js">calendar/base/content/calendar-dnd-listener.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/9a3c2f2a0729b3dcb1788c861da2c57410dda901/calendar/base/content/calendar-dnd-listener.js">file</a> |
<a href="/comm-central/annotate/9a3c2f2a0729b3dcb1788c861da2c57410dda901/calendar/base/content/calendar-dnd-listener.js">annotate</a> |
<a href="/comm-central/diff/9a3c2f2a0729b3dcb1788c861da2c57410dda901/calendar/base/content/calendar-dnd-listener.js">diff</a> |
<a href="/comm-central/comparison/9a3c2f2a0729b3dcb1788c861da2c57410dda901/calendar/base/content/calendar-dnd-listener.js">comparison</a> |
<a href="/comm-central/log/9a3c2f2a0729b3dcb1788c861da2c57410dda901/calendar/base/content/calendar-dnd-listener.js">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/9a3c2f2a0729b3dcb1788c861da2c57410dda901/calendar/base/content/calendar-management.js">calendar/base/content/calendar-management.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/9a3c2f2a0729b3dcb1788c861da2c57410dda901/calendar/base/content/calendar-management.js">file</a> |
<a href="/comm-central/annotate/9a3c2f2a0729b3dcb1788c861da2c57410dda901/calendar/base/content/calendar-management.js">annotate</a> |
<a href="/comm-central/diff/9a3c2f2a0729b3dcb1788c861da2c57410dda901/calendar/base/content/calendar-management.js">diff</a> |
<a href="/comm-central/comparison/9a3c2f2a0729b3dcb1788c861da2c57410dda901/calendar/base/content/calendar-management.js">comparison</a> |
<a href="/comm-central/log/9a3c2f2a0729b3dcb1788c861da2c57410dda901/calendar/base/content/calendar-management.js">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/9a3c2f2a0729b3dcb1788c861da2c57410dda901/calendar/base/content/calendar-statusbar.js">calendar/base/content/calendar-statusbar.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/9a3c2f2a0729b3dcb1788c861da2c57410dda901/calendar/base/content/calendar-statusbar.js">file</a> |
<a href="/comm-central/annotate/9a3c2f2a0729b3dcb1788c861da2c57410dda901/calendar/base/content/calendar-statusbar.js">annotate</a> |
<a href="/comm-central/diff/9a3c2f2a0729b3dcb1788c861da2c57410dda901/calendar/base/content/calendar-statusbar.js">diff</a> |
<a href="/comm-central/comparison/9a3c2f2a0729b3dcb1788c861da2c57410dda901/calendar/base/content/calendar-statusbar.js">comparison</a> |
<a href="/comm-central/log/9a3c2f2a0729b3dcb1788c861da2c57410dda901/calendar/base/content/calendar-statusbar.js">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/9a3c2f2a0729b3dcb1788c861da2c57410dda901/calendar/base/content/calendar-task-editing.js">calendar/base/content/calendar-task-editing.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/9a3c2f2a0729b3dcb1788c861da2c57410dda901/calendar/base/content/calendar-task-editing.js">file</a> |
<a href="/comm-central/annotate/9a3c2f2a0729b3dcb1788c861da2c57410dda901/calendar/base/content/calendar-task-editing.js">annotate</a> |
<a href="/comm-central/diff/9a3c2f2a0729b3dcb1788c861da2c57410dda901/calendar/base/content/calendar-task-editing.js">diff</a> |
<a href="/comm-central/comparison/9a3c2f2a0729b3dcb1788c861da2c57410dda901/calendar/base/content/calendar-task-editing.js">comparison</a> |
<a href="/comm-central/log/9a3c2f2a0729b3dcb1788c861da2c57410dda901/calendar/base/content/calendar-task-editing.js">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/9a3c2f2a0729b3dcb1788c861da2c57410dda901/calendar/base/content/calendar-task-tree.xml">calendar/base/content/calendar-task-tree.xml</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/9a3c2f2a0729b3dcb1788c861da2c57410dda901/calendar/base/content/calendar-task-tree.xml">file</a> |
<a href="/comm-central/annotate/9a3c2f2a0729b3dcb1788c861da2c57410dda901/calendar/base/content/calendar-task-tree.xml">annotate</a> |
<a href="/comm-central/diff/9a3c2f2a0729b3dcb1788c861da2c57410dda901/calendar/base/content/calendar-task-tree.xml">diff</a> |
<a href="/comm-central/comparison/9a3c2f2a0729b3dcb1788c861da2c57410dda901/calendar/base/content/calendar-task-tree.xml">comparison</a> |
<a href="/comm-central/log/9a3c2f2a0729b3dcb1788c861da2c57410dda901/calendar/base/content/calendar-task-tree.xml">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/9a3c2f2a0729b3dcb1788c861da2c57410dda901/calendar/base/content/calendar-unifinder.js">calendar/base/content/calendar-unifinder.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/9a3c2f2a0729b3dcb1788c861da2c57410dda901/calendar/base/content/calendar-unifinder.js">file</a> |
<a href="/comm-central/annotate/9a3c2f2a0729b3dcb1788c861da2c57410dda901/calendar/base/content/calendar-unifinder.js">annotate</a> |
<a href="/comm-central/diff/9a3c2f2a0729b3dcb1788c861da2c57410dda901/calendar/base/content/calendar-unifinder.js">diff</a> |
<a href="/comm-central/comparison/9a3c2f2a0729b3dcb1788c861da2c57410dda901/calendar/base/content/calendar-unifinder.js">comparison</a> |
<a href="/comm-central/log/9a3c2f2a0729b3dcb1788c861da2c57410dda901/calendar/base/content/calendar-unifinder.js">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/9a3c2f2a0729b3dcb1788c861da2c57410dda901/calendar/base/content/calendar-views.js">calendar/base/content/calendar-views.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/9a3c2f2a0729b3dcb1788c861da2c57410dda901/calendar/base/content/calendar-views.js">file</a> |
<a href="/comm-central/annotate/9a3c2f2a0729b3dcb1788c861da2c57410dda901/calendar/base/content/calendar-views.js">annotate</a> |
<a href="/comm-central/diff/9a3c2f2a0729b3dcb1788c861da2c57410dda901/calendar/base/content/calendar-views.js">diff</a> |
<a href="/comm-central/comparison/9a3c2f2a0729b3dcb1788c861da2c57410dda901/calendar/base/content/calendar-views.js">comparison</a> |
<a href="/comm-central/log/9a3c2f2a0729b3dcb1788c861da2c57410dda901/calendar/base/content/calendar-views.js">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/9a3c2f2a0729b3dcb1788c861da2c57410dda901/calendar/base/modules/calProviderUtils.jsm">calendar/base/modules/calProviderUtils.jsm</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/9a3c2f2a0729b3dcb1788c861da2c57410dda901/calendar/base/modules/calProviderUtils.jsm">file</a> |
<a href="/comm-central/annotate/9a3c2f2a0729b3dcb1788c861da2c57410dda901/calendar/base/modules/calProviderUtils.jsm">annotate</a> |
<a href="/comm-central/diff/9a3c2f2a0729b3dcb1788c861da2c57410dda901/calendar/base/modules/calProviderUtils.jsm">diff</a> |
<a href="/comm-central/comparison/9a3c2f2a0729b3dcb1788c861da2c57410dda901/calendar/base/modules/calProviderUtils.jsm">comparison</a> |
<a href="/comm-central/log/9a3c2f2a0729b3dcb1788c861da2c57410dda901/calendar/base/modules/calProviderUtils.jsm">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/9a3c2f2a0729b3dcb1788c861da2c57410dda901/calendar/base/src/calAlarm.js">calendar/base/src/calAlarm.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/9a3c2f2a0729b3dcb1788c861da2c57410dda901/calendar/base/src/calAlarm.js">file</a> |
<a href="/comm-central/annotate/9a3c2f2a0729b3dcb1788c861da2c57410dda901/calendar/base/src/calAlarm.js">annotate</a> |
<a href="/comm-central/diff/9a3c2f2a0729b3dcb1788c861da2c57410dda901/calendar/base/src/calAlarm.js">diff</a> |
<a href="/comm-central/comparison/9a3c2f2a0729b3dcb1788c861da2c57410dda901/calendar/base/src/calAlarm.js">comparison</a> |
<a href="/comm-central/log/9a3c2f2a0729b3dcb1788c861da2c57410dda901/calendar/base/src/calAlarm.js">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/9a3c2f2a0729b3dcb1788c861da2c57410dda901/calendar/base/src/calAlarmMonitor.js">calendar/base/src/calAlarmMonitor.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/9a3c2f2a0729b3dcb1788c861da2c57410dda901/calendar/base/src/calAlarmMonitor.js">file</a> |
<a href="/comm-central/annotate/9a3c2f2a0729b3dcb1788c861da2c57410dda901/calendar/base/src/calAlarmMonitor.js">annotate</a> |
<a href="/comm-central/diff/9a3c2f2a0729b3dcb1788c861da2c57410dda901/calendar/base/src/calAlarmMonitor.js">diff</a> |
<a href="/comm-central/comparison/9a3c2f2a0729b3dcb1788c861da2c57410dda901/calendar/base/src/calAlarmMonitor.js">comparison</a> |
<a href="/comm-central/log/9a3c2f2a0729b3dcb1788c861da2c57410dda901/calendar/base/src/calAlarmMonitor.js">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/9a3c2f2a0729b3dcb1788c861da2c57410dda901/calendar/base/src/calAlarmService.js">calendar/base/src/calAlarmService.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/9a3c2f2a0729b3dcb1788c861da2c57410dda901/calendar/base/src/calAlarmService.js">file</a> |
<a href="/comm-central/annotate/9a3c2f2a0729b3dcb1788c861da2c57410dda901/calendar/base/src/calAlarmService.js">annotate</a> |
<a href="/comm-central/diff/9a3c2f2a0729b3dcb1788c861da2c57410dda901/calendar/base/src/calAlarmService.js">diff</a> |
<a href="/comm-central/comparison/9a3c2f2a0729b3dcb1788c861da2c57410dda901/calendar/base/src/calAlarmService.js">comparison</a> |
<a href="/comm-central/log/9a3c2f2a0729b3dcb1788c861da2c57410dda901/calendar/base/src/calAlarmService.js">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/9a3c2f2a0729b3dcb1788c861da2c57410dda901/calendar/base/src/calAttachment.js">calendar/base/src/calAttachment.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/9a3c2f2a0729b3dcb1788c861da2c57410dda901/calendar/base/src/calAttachment.js">file</a> |
<a href="/comm-central/annotate/9a3c2f2a0729b3dcb1788c861da2c57410dda901/calendar/base/src/calAttachment.js">annotate</a> |
<a href="/comm-central/diff/9a3c2f2a0729b3dcb1788c861da2c57410dda901/calendar/base/src/calAttachment.js">diff</a> |
<a href="/comm-central/comparison/9a3c2f2a0729b3dcb1788c861da2c57410dda901/calendar/base/src/calAttachment.js">comparison</a> |
<a href="/comm-central/log/9a3c2f2a0729b3dcb1788c861da2c57410dda901/calendar/base/src/calAttachment.js">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/9a3c2f2a0729b3dcb1788c861da2c57410dda901/calendar/base/src/calAttendee.js">calendar/base/src/calAttendee.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/9a3c2f2a0729b3dcb1788c861da2c57410dda901/calendar/base/src/calAttendee.js">file</a> |
<a href="/comm-central/annotate/9a3c2f2a0729b3dcb1788c861da2c57410dda901/calendar/base/src/calAttendee.js">annotate</a> |
<a href="/comm-central/diff/9a3c2f2a0729b3dcb1788c861da2c57410dda901/calendar/base/src/calAttendee.js">diff</a> |
<a href="/comm-central/comparison/9a3c2f2a0729b3dcb1788c861da2c57410dda901/calendar/base/src/calAttendee.js">comparison</a> |
<a href="/comm-central/log/9a3c2f2a0729b3dcb1788c861da2c57410dda901/calendar/base/src/calAttendee.js">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/9a3c2f2a0729b3dcb1788c861da2c57410dda901/calendar/base/src/calCachedCalendar.js">calendar/base/src/calCachedCalendar.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/9a3c2f2a0729b3dcb1788c861da2c57410dda901/calendar/base/src/calCachedCalendar.js">file</a> |
<a href="/comm-central/annotate/9a3c2f2a0729b3dcb1788c861da2c57410dda901/calendar/base/src/calCachedCalendar.js">annotate</a> |
<a href="/comm-central/diff/9a3c2f2a0729b3dcb1788c861da2c57410dda901/calendar/base/src/calCachedCalendar.js">diff</a> |
<a href="/comm-central/comparison/9a3c2f2a0729b3dcb1788c861da2c57410dda901/calendar/base/src/calCachedCalendar.js">comparison</a> |
<a href="/comm-central/log/9a3c2f2a0729b3dcb1788c861da2c57410dda901/calendar/base/src/calCachedCalendar.js">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/9a3c2f2a0729b3dcb1788c861da2c57410dda901/calendar/base/src/calCalendarManager.js">calendar/base/src/calCalendarManager.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/9a3c2f2a0729b3dcb1788c861da2c57410dda901/calendar/base/src/calCalendarManager.js">file</a> |
<a href="/comm-central/annotate/9a3c2f2a0729b3dcb1788c861da2c57410dda901/calendar/base/src/calCalendarManager.js">annotate</a> |
<a href="/comm-central/diff/9a3c2f2a0729b3dcb1788c861da2c57410dda901/calendar/base/src/calCalendarManager.js">diff</a> |
<a href="/comm-central/comparison/9a3c2f2a0729b3dcb1788c861da2c57410dda901/calendar/base/src/calCalendarManager.js">comparison</a> |
<a href="/comm-central/log/9a3c2f2a0729b3dcb1788c861da2c57410dda901/calendar/base/src/calCalendarManager.js">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/9a3c2f2a0729b3dcb1788c861da2c57410dda901/calendar/base/src/calCalendarSearchService.js">calendar/base/src/calCalendarSearchService.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/9a3c2f2a0729b3dcb1788c861da2c57410dda901/calendar/base/src/calCalendarSearchService.js">file</a> |
<a href="/comm-central/annotate/9a3c2f2a0729b3dcb1788c861da2c57410dda901/calendar/base/src/calCalendarSearchService.js">annotate</a> |
<a href="/comm-central/diff/9a3c2f2a0729b3dcb1788c861da2c57410dda901/calendar/base/src/calCalendarSearchService.js">diff</a> |
<a href="/comm-central/comparison/9a3c2f2a0729b3dcb1788c861da2c57410dda901/calendar/base/src/calCalendarSearchService.js">comparison</a> |
<a href="/comm-central/log/9a3c2f2a0729b3dcb1788c861da2c57410dda901/calendar/base/src/calCalendarSearchService.js">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/9a3c2f2a0729b3dcb1788c861da2c57410dda901/calendar/base/src/calDateTimeFormatter.js">calendar/base/src/calDateTimeFormatter.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/9a3c2f2a0729b3dcb1788c861da2c57410dda901/calendar/base/src/calDateTimeFormatter.js">file</a> |
<a href="/comm-central/annotate/9a3c2f2a0729b3dcb1788c861da2c57410dda901/calendar/base/src/calDateTimeFormatter.js">annotate</a> |
<a href="/comm-central/diff/9a3c2f2a0729b3dcb1788c861da2c57410dda901/calendar/base/src/calDateTimeFormatter.js">diff</a> |
<a href="/comm-central/comparison/9a3c2f2a0729b3dcb1788c861da2c57410dda901/calendar/base/src/calDateTimeFormatter.js">comparison</a> |
<a href="/comm-central/log/9a3c2f2a0729b3dcb1788c861da2c57410dda901/calendar/base/src/calDateTimeFormatter.js">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/9a3c2f2a0729b3dcb1788c861da2c57410dda901/calendar/base/src/calDefaultACLManager.js">calendar/base/src/calDefaultACLManager.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/9a3c2f2a0729b3dcb1788c861da2c57410dda901/calendar/base/src/calDefaultACLManager.js">file</a> |
<a href="/comm-central/annotate/9a3c2f2a0729b3dcb1788c861da2c57410dda901/calendar/base/src/calDefaultACLManager.js">annotate</a> |
<a href="/comm-central/diff/9a3c2f2a0729b3dcb1788c861da2c57410dda901/calendar/base/src/calDefaultACLManager.js">diff</a> |
<a href="/comm-central/comparison/9a3c2f2a0729b3dcb1788c861da2c57410dda901/calendar/base/src/calDefaultACLManager.js">comparison</a> |
<a href="/comm-central/log/9a3c2f2a0729b3dcb1788c861da2c57410dda901/calendar/base/src/calDefaultACLManager.js">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/9a3c2f2a0729b3dcb1788c861da2c57410dda901/calendar/base/src/calDeletedItems.js">calendar/base/src/calDeletedItems.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/9a3c2f2a0729b3dcb1788c861da2c57410dda901/calendar/base/src/calDeletedItems.js">file</a> |
<a href="/comm-central/annotate/9a3c2f2a0729b3dcb1788c861da2c57410dda901/calendar/base/src/calDeletedItems.js">annotate</a> |
<a href="/comm-central/diff/9a3c2f2a0729b3dcb1788c861da2c57410dda901/calendar/base/src/calDeletedItems.js">diff</a> |
<a href="/comm-central/comparison/9a3c2f2a0729b3dcb1788c861da2c57410dda901/calendar/base/src/calDeletedItems.js">comparison</a> |
<a href="/comm-central/log/9a3c2f2a0729b3dcb1788c861da2c57410dda901/calendar/base/src/calDeletedItems.js">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/9a3c2f2a0729b3dcb1788c861da2c57410dda901/calendar/base/src/calEvent.js">calendar/base/src/calEvent.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/9a3c2f2a0729b3dcb1788c861da2c57410dda901/calendar/base/src/calEvent.js">file</a> |
<a href="/comm-central/annotate/9a3c2f2a0729b3dcb1788c861da2c57410dda901/calendar/base/src/calEvent.js">annotate</a> |
<a href="/comm-central/diff/9a3c2f2a0729b3dcb1788c861da2c57410dda901/calendar/base/src/calEvent.js">diff</a> |
<a href="/comm-central/comparison/9a3c2f2a0729b3dcb1788c861da2c57410dda901/calendar/base/src/calEvent.js">comparison</a> |
<a href="/comm-central/log/9a3c2f2a0729b3dcb1788c861da2c57410dda901/calendar/base/src/calEvent.js">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/9a3c2f2a0729b3dcb1788c861da2c57410dda901/calendar/base/src/calFreeBusyService.js">calendar/base/src/calFreeBusyService.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/9a3c2f2a0729b3dcb1788c861da2c57410dda901/calendar/base/src/calFreeBusyService.js">file</a> |
<a href="/comm-central/annotate/9a3c2f2a0729b3dcb1788c861da2c57410dda901/calendar/base/src/calFreeBusyService.js">annotate</a> |
<a href="/comm-central/diff/9a3c2f2a0729b3dcb1788c861da2c57410dda901/calendar/base/src/calFreeBusyService.js">diff</a> |
<a href="/comm-central/comparison/9a3c2f2a0729b3dcb1788c861da2c57410dda901/calendar/base/src/calFreeBusyService.js">comparison</a> |
<a href="/comm-central/log/9a3c2f2a0729b3dcb1788c861da2c57410dda901/calendar/base/src/calFreeBusyService.js">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/9a3c2f2a0729b3dcb1788c861da2c57410dda901/calendar/base/src/calIcsParser.js">calendar/base/src/calIcsParser.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/9a3c2f2a0729b3dcb1788c861da2c57410dda901/calendar/base/src/calIcsParser.js">file</a> |
<a href="/comm-central/annotate/9a3c2f2a0729b3dcb1788c861da2c57410dda901/calendar/base/src/calIcsParser.js">annotate</a> |
<a href="/comm-central/diff/9a3c2f2a0729b3dcb1788c861da2c57410dda901/calendar/base/src/calIcsParser.js">diff</a> |
<a href="/comm-central/comparison/9a3c2f2a0729b3dcb1788c861da2c57410dda901/calendar/base/src/calIcsParser.js">comparison</a> |
<a href="/comm-central/log/9a3c2f2a0729b3dcb1788c861da2c57410dda901/calendar/base/src/calIcsParser.js">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/9a3c2f2a0729b3dcb1788c861da2c57410dda901/calendar/base/src/calIcsSerializer.js">calendar/base/src/calIcsSerializer.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/9a3c2f2a0729b3dcb1788c861da2c57410dda901/calendar/base/src/calIcsSerializer.js">file</a> |
<a href="/comm-central/annotate/9a3c2f2a0729b3dcb1788c861da2c57410dda901/calendar/base/src/calIcsSerializer.js">annotate</a> |
<a href="/comm-central/diff/9a3c2f2a0729b3dcb1788c861da2c57410dda901/calendar/base/src/calIcsSerializer.js">diff</a> |
<a href="/comm-central/comparison/9a3c2f2a0729b3dcb1788c861da2c57410dda901/calendar/base/src/calIcsSerializer.js">comparison</a> |
<a href="/comm-central/log/9a3c2f2a0729b3dcb1788c861da2c57410dda901/calendar/base/src/calIcsSerializer.js">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/9a3c2f2a0729b3dcb1788c861da2c57410dda901/calendar/base/src/calItemBase.js">calendar/base/src/calItemBase.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/9a3c2f2a0729b3dcb1788c861da2c57410dda901/calendar/base/src/calItemBase.js">file</a> |
<a href="/comm-central/annotate/9a3c2f2a0729b3dcb1788c861da2c57410dda901/calendar/base/src/calItemBase.js">annotate</a> |
<a href="/comm-central/diff/9a3c2f2a0729b3dcb1788c861da2c57410dda901/calendar/base/src/calItemBase.js">diff</a> |
<a href="/comm-central/comparison/9a3c2f2a0729b3dcb1788c861da2c57410dda901/calendar/base/src/calItemBase.js">comparison</a> |
<a href="/comm-central/log/9a3c2f2a0729b3dcb1788c861da2c57410dda901/calendar/base/src/calItemBase.js">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/9a3c2f2a0729b3dcb1788c861da2c57410dda901/calendar/base/src/calItipItem.js">calendar/base/src/calItipItem.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/9a3c2f2a0729b3dcb1788c861da2c57410dda901/calendar/base/src/calItipItem.js">file</a> |
<a href="/comm-central/annotate/9a3c2f2a0729b3dcb1788c861da2c57410dda901/calendar/base/src/calItipItem.js">annotate</a> |
<a href="/comm-central/diff/9a3c2f2a0729b3dcb1788c861da2c57410dda901/calendar/base/src/calItipItem.js">diff</a> |
<a href="/comm-central/comparison/9a3c2f2a0729b3dcb1788c861da2c57410dda901/calendar/base/src/calItipItem.js">comparison</a> |
<a href="/comm-central/log/9a3c2f2a0729b3dcb1788c861da2c57410dda901/calendar/base/src/calItipItem.js">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/9a3c2f2a0729b3dcb1788c861da2c57410dda901/calendar/base/src/calProtocolHandler.js">calendar/base/src/calProtocolHandler.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/9a3c2f2a0729b3dcb1788c861da2c57410dda901/calendar/base/src/calProtocolHandler.js">file</a> |
<a href="/comm-central/annotate/9a3c2f2a0729b3dcb1788c861da2c57410dda901/calendar/base/src/calProtocolHandler.js">annotate</a> |
<a href="/comm-central/diff/9a3c2f2a0729b3dcb1788c861da2c57410dda901/calendar/base/src/calProtocolHandler.js">diff</a> |
<a href="/comm-central/comparison/9a3c2f2a0729b3dcb1788c861da2c57410dda901/calendar/base/src/calProtocolHandler.js">comparison</a> |
<a href="/comm-central/log/9a3c2f2a0729b3dcb1788c861da2c57410dda901/calendar/base/src/calProtocolHandler.js">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/9a3c2f2a0729b3dcb1788c861da2c57410dda901/calendar/base/src/calRecurrenceDate.js">calendar/base/src/calRecurrenceDate.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/9a3c2f2a0729b3dcb1788c861da2c57410dda901/calendar/base/src/calRecurrenceDate.js">file</a> |
<a href="/comm-central/annotate/9a3c2f2a0729b3dcb1788c861da2c57410dda901/calendar/base/src/calRecurrenceDate.js">annotate</a> |
<a href="/comm-central/diff/9a3c2f2a0729b3dcb1788c861da2c57410dda901/calendar/base/src/calRecurrenceDate.js">diff</a> |
<a href="/comm-central/comparison/9a3c2f2a0729b3dcb1788c861da2c57410dda901/calendar/base/src/calRecurrenceDate.js">comparison</a> |
<a href="/comm-central/log/9a3c2f2a0729b3dcb1788c861da2c57410dda901/calendar/base/src/calRecurrenceDate.js">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/9a3c2f2a0729b3dcb1788c861da2c57410dda901/calendar/base/src/calRecurrenceInfo.js">calendar/base/src/calRecurrenceInfo.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/9a3c2f2a0729b3dcb1788c861da2c57410dda901/calendar/base/src/calRecurrenceInfo.js">file</a> |
<a href="/comm-central/annotate/9a3c2f2a0729b3dcb1788c861da2c57410dda901/calendar/base/src/calRecurrenceInfo.js">annotate</a> |
<a href="/comm-central/diff/9a3c2f2a0729b3dcb1788c861da2c57410dda901/calendar/base/src/calRecurrenceInfo.js">diff</a> |
<a href="/comm-central/comparison/9a3c2f2a0729b3dcb1788c861da2c57410dda901/calendar/base/src/calRecurrenceInfo.js">comparison</a> |
<a href="/comm-central/log/9a3c2f2a0729b3dcb1788c861da2c57410dda901/calendar/base/src/calRecurrenceInfo.js">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/9a3c2f2a0729b3dcb1788c861da2c57410dda901/calendar/base/src/calRelation.js">calendar/base/src/calRelation.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/9a3c2f2a0729b3dcb1788c861da2c57410dda901/calendar/base/src/calRelation.js">file</a> |
<a href="/comm-central/annotate/9a3c2f2a0729b3dcb1788c861da2c57410dda901/calendar/base/src/calRelation.js">annotate</a> |
<a href="/comm-central/diff/9a3c2f2a0729b3dcb1788c861da2c57410dda901/calendar/base/src/calRelation.js">diff</a> |
<a href="/comm-central/comparison/9a3c2f2a0729b3dcb1788c861da2c57410dda901/calendar/base/src/calRelation.js">comparison</a> |
<a href="/comm-central/log/9a3c2f2a0729b3dcb1788c861da2c57410dda901/calendar/base/src/calRelation.js">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/9a3c2f2a0729b3dcb1788c861da2c57410dda901/calendar/base/src/calTimezoneService.js">calendar/base/src/calTimezoneService.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/9a3c2f2a0729b3dcb1788c861da2c57410dda901/calendar/base/src/calTimezoneService.js">file</a> |
<a href="/comm-central/annotate/9a3c2f2a0729b3dcb1788c861da2c57410dda901/calendar/base/src/calTimezoneService.js">annotate</a> |
<a href="/comm-central/diff/9a3c2f2a0729b3dcb1788c861da2c57410dda901/calendar/base/src/calTimezoneService.js">diff</a> |
<a href="/comm-central/comparison/9a3c2f2a0729b3dcb1788c861da2c57410dda901/calendar/base/src/calTimezoneService.js">comparison</a> |
<a href="/comm-central/log/9a3c2f2a0729b3dcb1788c861da2c57410dda901/calendar/base/src/calTimezoneService.js">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/9a3c2f2a0729b3dcb1788c861da2c57410dda901/calendar/base/src/calTodo.js">calendar/base/src/calTodo.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/9a3c2f2a0729b3dcb1788c861da2c57410dda901/calendar/base/src/calTodo.js">file</a> |
<a href="/comm-central/annotate/9a3c2f2a0729b3dcb1788c861da2c57410dda901/calendar/base/src/calTodo.js">annotate</a> |
<a href="/comm-central/diff/9a3c2f2a0729b3dcb1788c861da2c57410dda901/calendar/base/src/calTodo.js">diff</a> |
<a href="/comm-central/comparison/9a3c2f2a0729b3dcb1788c861da2c57410dda901/calendar/base/src/calTodo.js">comparison</a> |
<a href="/comm-central/log/9a3c2f2a0729b3dcb1788c861da2c57410dda901/calendar/base/src/calTodo.js">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/9a3c2f2a0729b3dcb1788c861da2c57410dda901/calendar/base/src/calTransactionManager.js">calendar/base/src/calTransactionManager.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/9a3c2f2a0729b3dcb1788c861da2c57410dda901/calendar/base/src/calTransactionManager.js">file</a> |
<a href="/comm-central/annotate/9a3c2f2a0729b3dcb1788c861da2c57410dda901/calendar/base/src/calTransactionManager.js">annotate</a> |
<a href="/comm-central/diff/9a3c2f2a0729b3dcb1788c861da2c57410dda901/calendar/base/src/calTransactionManager.js">diff</a> |
<a href="/comm-central/comparison/9a3c2f2a0729b3dcb1788c861da2c57410dda901/calendar/base/src/calTransactionManager.js">comparison</a> |
<a href="/comm-central/log/9a3c2f2a0729b3dcb1788c861da2c57410dda901/calendar/base/src/calTransactionManager.js">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/9a3c2f2a0729b3dcb1788c861da2c57410dda901/calendar/base/src/calUtils.js">calendar/base/src/calUtils.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/9a3c2f2a0729b3dcb1788c861da2c57410dda901/calendar/base/src/calUtils.js">file</a> |
<a href="/comm-central/annotate/9a3c2f2a0729b3dcb1788c861da2c57410dda901/calendar/base/src/calUtils.js">annotate</a> |
<a href="/comm-central/diff/9a3c2f2a0729b3dcb1788c861da2c57410dda901/calendar/base/src/calUtils.js">diff</a> |
<a href="/comm-central/comparison/9a3c2f2a0729b3dcb1788c861da2c57410dda901/calendar/base/src/calUtils.js">comparison</a> |
<a href="/comm-central/log/9a3c2f2a0729b3dcb1788c861da2c57410dda901/calendar/base/src/calUtils.js">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/9a3c2f2a0729b3dcb1788c861da2c57410dda901/calendar/base/src/calWeekInfoService.js">calendar/base/src/calWeekInfoService.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/9a3c2f2a0729b3dcb1788c861da2c57410dda901/calendar/base/src/calWeekInfoService.js">file</a> |
<a href="/comm-central/annotate/9a3c2f2a0729b3dcb1788c861da2c57410dda901/calendar/base/src/calWeekInfoService.js">annotate</a> |
<a href="/comm-central/diff/9a3c2f2a0729b3dcb1788c861da2c57410dda901/calendar/base/src/calWeekInfoService.js">diff</a> |
<a href="/comm-central/comparison/9a3c2f2a0729b3dcb1788c861da2c57410dda901/calendar/base/src/calWeekInfoService.js">comparison</a> |
<a href="/comm-central/log/9a3c2f2a0729b3dcb1788c861da2c57410dda901/calendar/base/src/calWeekInfoService.js">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/9a3c2f2a0729b3dcb1788c861da2c57410dda901/calendar/import-export/calHtmlExport.js">calendar/import-export/calHtmlExport.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/9a3c2f2a0729b3dcb1788c861da2c57410dda901/calendar/import-export/calHtmlExport.js">file</a> |
<a href="/comm-central/annotate/9a3c2f2a0729b3dcb1788c861da2c57410dda901/calendar/import-export/calHtmlExport.js">annotate</a> |
<a href="/comm-central/diff/9a3c2f2a0729b3dcb1788c861da2c57410dda901/calendar/import-export/calHtmlExport.js">diff</a> |
<a href="/comm-central/comparison/9a3c2f2a0729b3dcb1788c861da2c57410dda901/calendar/import-export/calHtmlExport.js">comparison</a> |
<a href="/comm-central/log/9a3c2f2a0729b3dcb1788c861da2c57410dda901/calendar/import-export/calHtmlExport.js">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/9a3c2f2a0729b3dcb1788c861da2c57410dda901/calendar/import-export/calIcsImportExport.js">calendar/import-export/calIcsImportExport.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/9a3c2f2a0729b3dcb1788c861da2c57410dda901/calendar/import-export/calIcsImportExport.js">file</a> |
<a href="/comm-central/annotate/9a3c2f2a0729b3dcb1788c861da2c57410dda901/calendar/import-export/calIcsImportExport.js">annotate</a> |
<a href="/comm-central/diff/9a3c2f2a0729b3dcb1788c861da2c57410dda901/calendar/import-export/calIcsImportExport.js">diff</a> |
<a href="/comm-central/comparison/9a3c2f2a0729b3dcb1788c861da2c57410dda901/calendar/import-export/calIcsImportExport.js">comparison</a> |
<a href="/comm-central/log/9a3c2f2a0729b3dcb1788c861da2c57410dda901/calendar/import-export/calIcsImportExport.js">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/9a3c2f2a0729b3dcb1788c861da2c57410dda901/calendar/import-export/calListFormatter.js">calendar/import-export/calListFormatter.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/9a3c2f2a0729b3dcb1788c861da2c57410dda901/calendar/import-export/calListFormatter.js">file</a> |
<a href="/comm-central/annotate/9a3c2f2a0729b3dcb1788c861da2c57410dda901/calendar/import-export/calListFormatter.js">annotate</a> |
<a href="/comm-central/diff/9a3c2f2a0729b3dcb1788c861da2c57410dda901/calendar/import-export/calListFormatter.js">diff</a> |
<a href="/comm-central/comparison/9a3c2f2a0729b3dcb1788c861da2c57410dda901/calendar/import-export/calListFormatter.js">comparison</a> |
<a href="/comm-central/log/9a3c2f2a0729b3dcb1788c861da2c57410dda901/calendar/import-export/calListFormatter.js">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/9a3c2f2a0729b3dcb1788c861da2c57410dda901/calendar/import-export/calMonthGridPrinter.js">calendar/import-export/calMonthGridPrinter.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/9a3c2f2a0729b3dcb1788c861da2c57410dda901/calendar/import-export/calMonthGridPrinter.js">file</a> |
<a href="/comm-central/annotate/9a3c2f2a0729b3dcb1788c861da2c57410dda901/calendar/import-export/calMonthGridPrinter.js">annotate</a> |
<a href="/comm-central/diff/9a3c2f2a0729b3dcb1788c861da2c57410dda901/calendar/import-export/calMonthGridPrinter.js">diff</a> |
<a href="/comm-central/comparison/9a3c2f2a0729b3dcb1788c861da2c57410dda901/calendar/import-export/calMonthGridPrinter.js">comparison</a> |
<a href="/comm-central/log/9a3c2f2a0729b3dcb1788c861da2c57410dda901/calendar/import-export/calMonthGridPrinter.js">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/9a3c2f2a0729b3dcb1788c861da2c57410dda901/calendar/import-export/calOutlookCSVImportExport.js">calendar/import-export/calOutlookCSVImportExport.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/9a3c2f2a0729b3dcb1788c861da2c57410dda901/calendar/import-export/calOutlookCSVImportExport.js">file</a> |
<a href="/comm-central/annotate/9a3c2f2a0729b3dcb1788c861da2c57410dda901/calendar/import-export/calOutlookCSVImportExport.js">annotate</a> |
<a href="/comm-central/diff/9a3c2f2a0729b3dcb1788c861da2c57410dda901/calendar/import-export/calOutlookCSVImportExport.js">diff</a> |
<a href="/comm-central/comparison/9a3c2f2a0729b3dcb1788c861da2c57410dda901/calendar/import-export/calOutlookCSVImportExport.js">comparison</a> |
<a href="/comm-central/log/9a3c2f2a0729b3dcb1788c861da2c57410dda901/calendar/import-export/calOutlookCSVImportExport.js">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/9a3c2f2a0729b3dcb1788c861da2c57410dda901/calendar/import-export/calWeekPrinter.js">calendar/import-export/calWeekPrinter.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/9a3c2f2a0729b3dcb1788c861da2c57410dda901/calendar/import-export/calWeekPrinter.js">file</a> |
<a href="/comm-central/annotate/9a3c2f2a0729b3dcb1788c861da2c57410dda901/calendar/import-export/calWeekPrinter.js">annotate</a> |
<a href="/comm-central/diff/9a3c2f2a0729b3dcb1788c861da2c57410dda901/calendar/import-export/calWeekPrinter.js">diff</a> |
<a href="/comm-central/comparison/9a3c2f2a0729b3dcb1788c861da2c57410dda901/calendar/import-export/calWeekPrinter.js">comparison</a> |
<a href="/comm-central/log/9a3c2f2a0729b3dcb1788c861da2c57410dda901/calendar/import-export/calWeekPrinter.js">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/9a3c2f2a0729b3dcb1788c861da2c57410dda901/calendar/itip/calItipEmailTransport.js">calendar/itip/calItipEmailTransport.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/9a3c2f2a0729b3dcb1788c861da2c57410dda901/calendar/itip/calItipEmailTransport.js">file</a> |
<a href="/comm-central/annotate/9a3c2f2a0729b3dcb1788c861da2c57410dda901/calendar/itip/calItipEmailTransport.js">annotate</a> |
<a href="/comm-central/diff/9a3c2f2a0729b3dcb1788c861da2c57410dda901/calendar/itip/calItipEmailTransport.js">diff</a> |
<a href="/comm-central/comparison/9a3c2f2a0729b3dcb1788c861da2c57410dda901/calendar/itip/calItipEmailTransport.js">comparison</a> |
<a href="/comm-central/log/9a3c2f2a0729b3dcb1788c861da2c57410dda901/calendar/itip/calItipEmailTransport.js">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/9a3c2f2a0729b3dcb1788c861da2c57410dda901/calendar/lightning/components/calItipProtocolHandler.js">calendar/lightning/components/calItipProtocolHandler.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/9a3c2f2a0729b3dcb1788c861da2c57410dda901/calendar/lightning/components/calItipProtocolHandler.js">file</a> |
<a href="/comm-central/annotate/9a3c2f2a0729b3dcb1788c861da2c57410dda901/calendar/lightning/components/calItipProtocolHandler.js">annotate</a> |
<a href="/comm-central/diff/9a3c2f2a0729b3dcb1788c861da2c57410dda901/calendar/lightning/components/calItipProtocolHandler.js">diff</a> |
<a href="/comm-central/comparison/9a3c2f2a0729b3dcb1788c861da2c57410dda901/calendar/lightning/components/calItipProtocolHandler.js">comparison</a> |
<a href="/comm-central/log/9a3c2f2a0729b3dcb1788c861da2c57410dda901/calendar/lightning/components/calItipProtocolHandler.js">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/9a3c2f2a0729b3dcb1788c861da2c57410dda901/calendar/lightning/components/lightningTextCalendarConverter.js">calendar/lightning/components/lightningTextCalendarConverter.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/9a3c2f2a0729b3dcb1788c861da2c57410dda901/calendar/lightning/components/lightningTextCalendarConverter.js">file</a> |
<a href="/comm-central/annotate/9a3c2f2a0729b3dcb1788c861da2c57410dda901/calendar/lightning/components/lightningTextCalendarConverter.js">annotate</a> |
<a href="/comm-central/diff/9a3c2f2a0729b3dcb1788c861da2c57410dda901/calendar/lightning/components/lightningTextCalendarConverter.js">diff</a> |
<a href="/comm-central/comparison/9a3c2f2a0729b3dcb1788c861da2c57410dda901/calendar/lightning/components/lightningTextCalendarConverter.js">comparison</a> |
<a href="/comm-central/log/9a3c2f2a0729b3dcb1788c861da2c57410dda901/calendar/lightning/components/lightningTextCalendarConverter.js">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/9a3c2f2a0729b3dcb1788c861da2c57410dda901/calendar/providers/caldav/calDavCalendar.js">calendar/providers/caldav/calDavCalendar.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/9a3c2f2a0729b3dcb1788c861da2c57410dda901/calendar/providers/caldav/calDavCalendar.js">file</a> |
<a href="/comm-central/annotate/9a3c2f2a0729b3dcb1788c861da2c57410dda901/calendar/providers/caldav/calDavCalendar.js">annotate</a> |
<a href="/comm-central/diff/9a3c2f2a0729b3dcb1788c861da2c57410dda901/calendar/providers/caldav/calDavCalendar.js">diff</a> |
<a href="/comm-central/comparison/9a3c2f2a0729b3dcb1788c861da2c57410dda901/calendar/providers/caldav/calDavCalendar.js">comparison</a> |
<a href="/comm-central/log/9a3c2f2a0729b3dcb1788c861da2c57410dda901/calendar/providers/caldav/calDavCalendar.js">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/9a3c2f2a0729b3dcb1788c861da2c57410dda901/calendar/providers/caldav/calDavRequestHandlers.js">calendar/providers/caldav/calDavRequestHandlers.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/9a3c2f2a0729b3dcb1788c861da2c57410dda901/calendar/providers/caldav/calDavRequestHandlers.js">file</a> |
<a href="/comm-central/annotate/9a3c2f2a0729b3dcb1788c861da2c57410dda901/calendar/providers/caldav/calDavRequestHandlers.js">annotate</a> |
<a href="/comm-central/diff/9a3c2f2a0729b3dcb1788c861da2c57410dda901/calendar/providers/caldav/calDavRequestHandlers.js">diff</a> |
<a href="/comm-central/comparison/9a3c2f2a0729b3dcb1788c861da2c57410dda901/calendar/providers/caldav/calDavRequestHandlers.js">comparison</a> |
<a href="/comm-central/log/9a3c2f2a0729b3dcb1788c861da2c57410dda901/calendar/providers/caldav/calDavRequestHandlers.js">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/9a3c2f2a0729b3dcb1788c861da2c57410dda901/calendar/providers/composite/calCompositeCalendar.js">calendar/providers/composite/calCompositeCalendar.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/9a3c2f2a0729b3dcb1788c861da2c57410dda901/calendar/providers/composite/calCompositeCalendar.js">file</a> |
<a href="/comm-central/annotate/9a3c2f2a0729b3dcb1788c861da2c57410dda901/calendar/providers/composite/calCompositeCalendar.js">annotate</a> |
<a href="/comm-central/diff/9a3c2f2a0729b3dcb1788c861da2c57410dda901/calendar/providers/composite/calCompositeCalendar.js">diff</a> |
<a href="/comm-central/comparison/9a3c2f2a0729b3dcb1788c861da2c57410dda901/calendar/providers/composite/calCompositeCalendar.js">comparison</a> |
<a href="/comm-central/log/9a3c2f2a0729b3dcb1788c861da2c57410dda901/calendar/providers/composite/calCompositeCalendar.js">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/9a3c2f2a0729b3dcb1788c861da2c57410dda901/calendar/providers/gdata/components/calGoogleCalendar.js">calendar/providers/gdata/components/calGoogleCalendar.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/9a3c2f2a0729b3dcb1788c861da2c57410dda901/calendar/providers/gdata/components/calGoogleCalendar.js">file</a> |
<a href="/comm-central/annotate/9a3c2f2a0729b3dcb1788c861da2c57410dda901/calendar/providers/gdata/components/calGoogleCalendar.js">annotate</a> |
<a href="/comm-central/diff/9a3c2f2a0729b3dcb1788c861da2c57410dda901/calendar/providers/gdata/components/calGoogleCalendar.js">diff</a> |
<a href="/comm-central/comparison/9a3c2f2a0729b3dcb1788c861da2c57410dda901/calendar/providers/gdata/components/calGoogleCalendar.js">comparison</a> |
<a href="/comm-central/log/9a3c2f2a0729b3dcb1788c861da2c57410dda901/calendar/providers/gdata/components/calGoogleCalendar.js">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/9a3c2f2a0729b3dcb1788c861da2c57410dda901/calendar/providers/gdata/components/calGoogleRequest.js">calendar/providers/gdata/components/calGoogleRequest.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/9a3c2f2a0729b3dcb1788c861da2c57410dda901/calendar/providers/gdata/components/calGoogleRequest.js">file</a> |
<a href="/comm-central/annotate/9a3c2f2a0729b3dcb1788c861da2c57410dda901/calendar/providers/gdata/components/calGoogleRequest.js">annotate</a> |
<a href="/comm-central/diff/9a3c2f2a0729b3dcb1788c861da2c57410dda901/calendar/providers/gdata/components/calGoogleRequest.js">diff</a> |
<a href="/comm-central/comparison/9a3c2f2a0729b3dcb1788c861da2c57410dda901/calendar/providers/gdata/components/calGoogleRequest.js">comparison</a> |
<a href="/comm-central/log/9a3c2f2a0729b3dcb1788c861da2c57410dda901/calendar/providers/gdata/components/calGoogleRequest.js">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/9a3c2f2a0729b3dcb1788c861da2c57410dda901/calendar/providers/gdata/components/calGoogleSession.js">calendar/providers/gdata/components/calGoogleSession.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/9a3c2f2a0729b3dcb1788c861da2c57410dda901/calendar/providers/gdata/components/calGoogleSession.js">file</a> |
<a href="/comm-central/annotate/9a3c2f2a0729b3dcb1788c861da2c57410dda901/calendar/providers/gdata/components/calGoogleSession.js">annotate</a> |
<a href="/comm-central/diff/9a3c2f2a0729b3dcb1788c861da2c57410dda901/calendar/providers/gdata/components/calGoogleSession.js">diff</a> |
<a href="/comm-central/comparison/9a3c2f2a0729b3dcb1788c861da2c57410dda901/calendar/providers/gdata/components/calGoogleSession.js">comparison</a> |
<a href="/comm-central/log/9a3c2f2a0729b3dcb1788c861da2c57410dda901/calendar/providers/gdata/components/calGoogleSession.js">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/9a3c2f2a0729b3dcb1788c861da2c57410dda901/calendar/providers/ics/calICSCalendar.js">calendar/providers/ics/calICSCalendar.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/9a3c2f2a0729b3dcb1788c861da2c57410dda901/calendar/providers/ics/calICSCalendar.js">file</a> |
<a href="/comm-central/annotate/9a3c2f2a0729b3dcb1788c861da2c57410dda901/calendar/providers/ics/calICSCalendar.js">annotate</a> |
<a href="/comm-central/diff/9a3c2f2a0729b3dcb1788c861da2c57410dda901/calendar/providers/ics/calICSCalendar.js">diff</a> |
<a href="/comm-central/comparison/9a3c2f2a0729b3dcb1788c861da2c57410dda901/calendar/providers/ics/calICSCalendar.js">comparison</a> |
<a href="/comm-central/log/9a3c2f2a0729b3dcb1788c861da2c57410dda901/calendar/providers/ics/calICSCalendar.js">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/9a3c2f2a0729b3dcb1788c861da2c57410dda901/calendar/providers/memory/calMemoryCalendar.js">calendar/providers/memory/calMemoryCalendar.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/9a3c2f2a0729b3dcb1788c861da2c57410dda901/calendar/providers/memory/calMemoryCalendar.js">file</a> |
<a href="/comm-central/annotate/9a3c2f2a0729b3dcb1788c861da2c57410dda901/calendar/providers/memory/calMemoryCalendar.js">annotate</a> |
<a href="/comm-central/diff/9a3c2f2a0729b3dcb1788c861da2c57410dda901/calendar/providers/memory/calMemoryCalendar.js">diff</a> |
<a href="/comm-central/comparison/9a3c2f2a0729b3dcb1788c861da2c57410dda901/calendar/providers/memory/calMemoryCalendar.js">comparison</a> |
<a href="/comm-central/log/9a3c2f2a0729b3dcb1788c861da2c57410dda901/calendar/providers/memory/calMemoryCalendar.js">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/9a3c2f2a0729b3dcb1788c861da2c57410dda901/calendar/providers/storage/calStorageCalendar.js">calendar/providers/storage/calStorageCalendar.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/9a3c2f2a0729b3dcb1788c861da2c57410dda901/calendar/providers/storage/calStorageCalendar.js">file</a> |
<a href="/comm-central/annotate/9a3c2f2a0729b3dcb1788c861da2c57410dda901/calendar/providers/storage/calStorageCalendar.js">annotate</a> |
<a href="/comm-central/diff/9a3c2f2a0729b3dcb1788c861da2c57410dda901/calendar/providers/storage/calStorageCalendar.js">diff</a> |
<a href="/comm-central/comparison/9a3c2f2a0729b3dcb1788c861da2c57410dda901/calendar/providers/storage/calStorageCalendar.js">comparison</a> |
<a href="/comm-central/log/9a3c2f2a0729b3dcb1788c861da2c57410dda901/calendar/providers/storage/calStorageCalendar.js">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/9a3c2f2a0729b3dcb1788c861da2c57410dda901/calendar/providers/wcap/calWcapCalendar.js">calendar/providers/wcap/calWcapCalendar.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/9a3c2f2a0729b3dcb1788c861da2c57410dda901/calendar/providers/wcap/calWcapCalendar.js">file</a> |
<a href="/comm-central/annotate/9a3c2f2a0729b3dcb1788c861da2c57410dda901/calendar/providers/wcap/calWcapCalendar.js">annotate</a> |
<a href="/comm-central/diff/9a3c2f2a0729b3dcb1788c861da2c57410dda901/calendar/providers/wcap/calWcapCalendar.js">diff</a> |
<a href="/comm-central/comparison/9a3c2f2a0729b3dcb1788c861da2c57410dda901/calendar/providers/wcap/calWcapCalendar.js">comparison</a> |
<a href="/comm-central/log/9a3c2f2a0729b3dcb1788c861da2c57410dda901/calendar/providers/wcap/calWcapCalendar.js">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/9a3c2f2a0729b3dcb1788c861da2c57410dda901/calendar/providers/wcap/calWcapRequest.js">calendar/providers/wcap/calWcapRequest.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/9a3c2f2a0729b3dcb1788c861da2c57410dda901/calendar/providers/wcap/calWcapRequest.js">file</a> |
<a href="/comm-central/annotate/9a3c2f2a0729b3dcb1788c861da2c57410dda901/calendar/providers/wcap/calWcapRequest.js">annotate</a> |
<a href="/comm-central/diff/9a3c2f2a0729b3dcb1788c861da2c57410dda901/calendar/providers/wcap/calWcapRequest.js">diff</a> |
<a href="/comm-central/comparison/9a3c2f2a0729b3dcb1788c861da2c57410dda901/calendar/providers/wcap/calWcapRequest.js">comparison</a> |
<a href="/comm-central/log/9a3c2f2a0729b3dcb1788c861da2c57410dda901/calendar/providers/wcap/calWcapRequest.js">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/9a3c2f2a0729b3dcb1788c861da2c57410dda901/calendar/providers/wcap/calWcapSession.js">calendar/providers/wcap/calWcapSession.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/9a3c2f2a0729b3dcb1788c861da2c57410dda901/calendar/providers/wcap/calWcapSession.js">file</a> |
<a href="/comm-central/annotate/9a3c2f2a0729b3dcb1788c861da2c57410dda901/calendar/providers/wcap/calWcapSession.js">annotate</a> |
<a href="/comm-central/diff/9a3c2f2a0729b3dcb1788c861da2c57410dda901/calendar/providers/wcap/calWcapSession.js">diff</a> |
<a href="/comm-central/comparison/9a3c2f2a0729b3dcb1788c861da2c57410dda901/calendar/providers/wcap/calWcapSession.js">comparison</a> |
<a href="/comm-central/log/9a3c2f2a0729b3dcb1788c861da2c57410dda901/calendar/providers/wcap/calWcapSession.js">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/9a3c2f2a0729b3dcb1788c861da2c57410dda901/calendar/resources/content/calendarService.js">calendar/resources/content/calendarService.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/9a3c2f2a0729b3dcb1788c861da2c57410dda901/calendar/resources/content/calendarService.js">file</a> |
<a href="/comm-central/annotate/9a3c2f2a0729b3dcb1788c861da2c57410dda901/calendar/resources/content/calendarService.js">annotate</a> |
<a href="/comm-central/diff/9a3c2f2a0729b3dcb1788c861da2c57410dda901/calendar/resources/content/calendarService.js">diff</a> |
<a href="/comm-central/comparison/9a3c2f2a0729b3dcb1788c861da2c57410dda901/calendar/resources/content/calendarService.js">comparison</a> |
<a href="/comm-central/log/9a3c2f2a0729b3dcb1788c861da2c57410dda901/calendar/resources/content/calendarService.js">revisions</a>
</td>
</tr>
</table></div>

<div class="page_body diffblocks"><div class="diffblock"><pre class="sourcelines">
<a href="#l1.1"></a><span id="l1.1" class="difflineminus">--- a/calendar/base/content/calendar-base-view.xml</span>
<a href="#l1.2"></a><span id="l1.2" class="difflineplus">+++ b/calendar/base/content/calendar-base-view.xml</span>
<a href="#l1.3"></a><span id="l1.3" class="difflineat">@@ -79,23 +79,21 @@</span>
<a href="#l1.4"></a><span id="l1.4">               }</span>
<a href="#l1.5"></a><span id="l1.5">           }</span>
<a href="#l1.6"></a><span id="l1.6">       })</span>
<a href="#l1.7"></a><span id="l1.7">       ]]&gt;&lt;/field&gt;</span>
<a href="#l1.8"></a><span id="l1.8"> </span>
<a href="#l1.9"></a><span id="l1.9">       &lt;field name=&quot;mObserver&quot;&gt;&lt;![CDATA[</span>
<a href="#l1.10"></a><span id="l1.10">         // the calIObserver, calICompositeObserver, and calIAlarmServiceObserver</span>
<a href="#l1.11"></a><span id="l1.11">         ({</span>
<a href="#l1.12"></a><span id="l1.12" class="difflineminus">-            QueryInterface: function QueryInterface(aIID) {</span>
<a href="#l1.13"></a><span id="l1.13" class="difflineminus">-                return cal.doQueryInterface(this, null, aIID,</span>
<a href="#l1.14"></a><span id="l1.14" class="difflineminus">-                                    [Components.interfaces.calIObserver,</span>
<a href="#l1.15"></a><span id="l1.15" class="difflineminus">-                                     Components.interfaces.calIAlarmServiceObserver,</span>
<a href="#l1.16"></a><span id="l1.16" class="difflineminus">-                                     Components.interfaces.calICompositeObserver,</span>
<a href="#l1.17"></a><span id="l1.17" class="difflineminus">-                                     Components.interfaces.nsISupports]);</span>
<a href="#l1.18"></a><span id="l1.18" class="difflineminus">-            },</span>
<a href="#l1.19"></a><span id="l1.19" class="difflineplus">+            QueryInterface: XPCOMUtils.generateQI([</span>
<a href="#l1.20"></a><span id="l1.20" class="difflineplus">+                Components.interfaces.calIObserver,</span>
<a href="#l1.21"></a><span id="l1.21" class="difflineplus">+                Components.interfaces.calIAlarmServiceObserver,</span>
<a href="#l1.22"></a><span id="l1.22" class="difflineplus">+                Components.interfaces.calICompositeObserver</span>
<a href="#l1.23"></a><span id="l1.23" class="difflineplus">+            ]),</span>
<a href="#l1.24"></a><span id="l1.24"> </span>
<a href="#l1.25"></a><span id="l1.25">             calView: this,</span>
<a href="#l1.26"></a><span id="l1.26"> </span>
<a href="#l1.27"></a><span id="l1.27">             onStartBatch: function onStartBatch() {</span>
<a href="#l1.28"></a><span id="l1.28">             },</span>
<a href="#l1.29"></a><span id="l1.29">             onEndBatch: function onEndBatch() {</span>
<a href="#l1.30"></a><span id="l1.30">             },</span>
<a href="#l1.31"></a><span id="l1.31"> </span>
<a href="#l1.32"></a><span id="l1.32" class="difflineat">@@ -247,16 +245,17 @@</span>
<a href="#l1.33"></a><span id="l1.33">             function onDefaultCalendarChanged(aNewDefaultCalendar) {</span>
<a href="#l1.34"></a><span id="l1.34">                 // don't care, for now</span>
<a href="#l1.35"></a><span id="l1.35">             }</span>
<a href="#l1.36"></a><span id="l1.36">         })</span>
<a href="#l1.37"></a><span id="l1.37">       ]]&gt;&lt;/field&gt;</span>
<a href="#l1.38"></a><span id="l1.38"> </span>
<a href="#l1.39"></a><span id="l1.39">       &lt;constructor&gt;&lt;![CDATA[</span>
<a href="#l1.40"></a><span id="l1.40">         Components.utils.import(&quot;resource://gre/modules/Services.jsm&quot;);</span>
<a href="#l1.41"></a><span id="l1.41" class="difflineplus">+        Components.utils.import(&quot;resource://gre/modules/XPCOMUtils.jsm&quot;);</span>
<a href="#l1.42"></a><span id="l1.42"> </span>
<a href="#l1.43"></a><span id="l1.43">         const kWorkdaysCommand = &quot;calendar_toggle_workdays_only_command&quot;;</span>
<a href="#l1.44"></a><span id="l1.44">         const kTasksInViewCommand = &quot;calendar_toggle_tasks_in_view_command&quot;;</span>
<a href="#l1.45"></a><span id="l1.45">         const kShowCompleted = &quot;calendar_toggle_show_completed_in_view_command&quot;;</span>
<a href="#l1.46"></a><span id="l1.46">         const kOrientation = &quot;calendar_toggle_orientation_command&quot;;</span>
<a href="#l1.47"></a><span id="l1.47"> </span>
<a href="#l1.48"></a><span id="l1.48">         this.workdaysOnly = (document.getElementById(kWorkdaysCommand)</span>
<a href="#l1.49"></a><span id="l1.49">                                 .getAttribute(&quot;checked&quot;) == &quot;true&quot;);</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l2.1"></a><span id="l2.1" class="difflineminus">--- a/calendar/base/content/calendar-dnd-listener.js</span>
<a href="#l2.2"></a><span id="l2.2" class="difflineplus">+++ b/calendar/base/content/calendar-dnd-listener.js</span>
<a href="#l2.3"></a><span id="l2.3" class="difflineat">@@ -1,15 +1,16 @@</span>
<a href="#l2.4"></a><span id="l2.4"> /* This Source Code Form is subject to the terms of the Mozilla Public</span>
<a href="#l2.5"></a><span id="l2.5">  * License, v. 2.0. If a copy of the MPL was not distributed with this</span>
<a href="#l2.6"></a><span id="l2.6">  * file, You can obtain one at http://mozilla.org/MPL/2.0/. */</span>
<a href="#l2.7"></a><span id="l2.7"> </span>
<a href="#l2.8"></a><span id="l2.8"> Components.utils.import(&quot;resource://calendar/modules/calUtils.jsm&quot;);</span>
<a href="#l2.9"></a><span id="l2.9"> Components.utils.import(&quot;resource://calendar/modules/calAlarmUtils.jsm&quot;);</span>
<a href="#l2.10"></a><span id="l2.10"> Components.utils.import(&quot;resource://gre/modules/Services.jsm&quot;);</span>
<a href="#l2.11"></a><span id="l2.11" class="difflineplus">+Components.utils.import(&quot;resource://gre/modules/XPCOMUtils.jsm&quot;);</span>
<a href="#l2.12"></a><span id="l2.12"> </span>
<a href="#l2.13"></a><span id="l2.13"> var itemConversion = {</span>
<a href="#l2.14"></a><span id="l2.14"> </span>
<a href="#l2.15"></a><span id="l2.15">     /**</span>
<a href="#l2.16"></a><span id="l2.16">      * Converts an email message to a calendar item.</span>
<a href="#l2.17"></a><span id="l2.17">      *</span>
<a href="#l2.18"></a><span id="l2.18">      * @param aItem     The target calIItemBase.</span>
<a href="#l2.19"></a><span id="l2.19">      * @param aMessage  The nsIMsgHdr to convert from.</span>
<a href="#l2.20"></a><span id="l2.20" class="difflineat">@@ -554,21 +555,19 @@ calTaskButtonDNDObserver.prototype = {</span>
<a href="#l2.21"></a><span id="l2.21">  */</span>
<a href="#l2.22"></a><span id="l2.22"> function invokeEventDragSession(aItem, aXULBox) {</span>
<a href="#l2.23"></a><span id="l2.23">     let transfer = Components.classes[&quot;@mozilla.org/widget/transferable;1&quot;]</span>
<a href="#l2.24"></a><span id="l2.24">                    .createInstance(Components.interfaces.nsITransferable);</span>
<a href="#l2.25"></a><span id="l2.25">     transfer.init(null);</span>
<a href="#l2.26"></a><span id="l2.26">     transfer.addDataFlavor(&quot;text/calendar&quot;);</span>
<a href="#l2.27"></a><span id="l2.27"> </span>
<a href="#l2.28"></a><span id="l2.28">     let flavourProvider = {</span>
<a href="#l2.29"></a><span id="l2.29" class="difflineminus">-        QueryInterface: function(aIID) {</span>
<a href="#l2.30"></a><span id="l2.30" class="difflineminus">-            return doQueryInterface(aXULBox, null, aIID, [Components.interfaces.nsIFlavorDataProvider]);</span>
<a href="#l2.31"></a><span id="l2.31" class="difflineminus">-        },</span>
<a href="#l2.32"></a><span id="l2.32" class="difflineplus">+        QueryInterface: XPCOMUtils.generateQI([Components.interfaces.nsIFlavorDataProvider]),</span>
<a href="#l2.33"></a><span id="l2.33" class="difflineplus">+</span>
<a href="#l2.34"></a><span id="l2.34">         item: aItem,</span>
<a href="#l2.35"></a><span id="l2.35" class="difflineminus">-</span>
<a href="#l2.36"></a><span id="l2.36">         getFlavorData: function(aInTransferable, aInFlavor, aOutData, aOutDataLen) {</span>
<a href="#l2.37"></a><span id="l2.37">             if ((aInFlavor == &quot;application/vnd.x-moz-cal-event&quot;) ||</span>
<a href="#l2.38"></a><span id="l2.38">                 (aInFlavor == &quot;application/vnd.x-moz-cal-task&quot;)) {</span>
<a href="#l2.39"></a><span id="l2.39">                 aOutData.value = aItem;</span>
<a href="#l2.40"></a><span id="l2.40">                 aOutDataLen.value = 1;</span>
<a href="#l2.41"></a><span id="l2.41">             } else {</span>
<a href="#l2.42"></a><span id="l2.42">                 ASSERT(false, &quot;error:&quot; + aInFlavor);</span>
<a href="#l2.43"></a><span id="l2.43">             }</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l3.1"></a><span id="l3.1" class="difflineminus">--- a/calendar/base/content/calendar-management.js</span>
<a href="#l3.2"></a><span id="l3.2" class="difflineplus">+++ b/calendar/base/content/calendar-management.js</span>
<a href="#l3.3"></a><span id="l3.3" class="difflineat">@@ -244,21 +244,17 @@ function openCalendarSubscriptionsDialog</span>
<a href="#l3.4"></a><span id="l3.4">                       &quot;_blank&quot;,</span>
<a href="#l3.5"></a><span id="l3.5">                       &quot;chrome,titlebar,modal,resizable&quot;);</span>
<a href="#l3.6"></a><span id="l3.6"> }</span>
<a href="#l3.7"></a><span id="l3.7"> </span>
<a href="#l3.8"></a><span id="l3.8"> /**</span>
<a href="#l3.9"></a><span id="l3.9">  * Calendar Offline Manager</span>
<a href="#l3.10"></a><span id="l3.10">  */</span>
<a href="#l3.11"></a><span id="l3.11"> var calendarOfflineManager = {</span>
<a href="#l3.12"></a><span id="l3.12" class="difflineminus">-    QueryInterface: function cOM_QueryInterface(aIID) {</span>
<a href="#l3.13"></a><span id="l3.13" class="difflineminus">-        return cal.doQueryInterface(this, null, aIID,</span>
<a href="#l3.14"></a><span id="l3.14" class="difflineminus">-                                    [Components.interfaces.nsIObserver,</span>
<a href="#l3.15"></a><span id="l3.15" class="difflineminus">-                                     Components.interfaces.nsISupports]);</span>
<a href="#l3.16"></a><span id="l3.16" class="difflineminus">-    },</span>
<a href="#l3.17"></a><span id="l3.17" class="difflineplus">+    QueryInterface: XPCOMUtils.generateQI([Components.interfaces.nsIObserver]),</span>
<a href="#l3.18"></a><span id="l3.18"> </span>
<a href="#l3.19"></a><span id="l3.19">     init: function cOM_init() {</span>
<a href="#l3.20"></a><span id="l3.20">         if (this.initialized) {</span>
<a href="#l3.21"></a><span id="l3.21">             throw Components.results.NS_ERROR_ALREADY_INITIALIZED;</span>
<a href="#l3.22"></a><span id="l3.22">         }</span>
<a href="#l3.23"></a><span id="l3.23">         Services.obs.addObserver(this, &quot;network:offline-status-changed&quot;, false);</span>
<a href="#l3.24"></a><span id="l3.24"> </span>
<a href="#l3.25"></a><span id="l3.25">         this.updateOfflineUI(!this.isOnline());</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l4.1"></a><span id="l4.1" class="difflineminus">--- a/calendar/base/content/calendar-statusbar.js</span>
<a href="#l4.2"></a><span id="l4.2" class="difflineplus">+++ b/calendar/base/content/calendar-statusbar.js</span>
<a href="#l4.3"></a><span id="l4.3" class="difflineat">@@ -1,12 +1,14 @@</span>
<a href="#l4.4"></a><span id="l4.4"> /* This Source Code Form is subject to the terms of the Mozilla Public</span>
<a href="#l4.5"></a><span id="l4.5">  * License, v. 2.0. If a copy of the MPL was not distributed with this</span>
<a href="#l4.6"></a><span id="l4.6">  * file, You can obtain one at http://mozilla.org/MPL/2.0/. */</span>
<a href="#l4.7"></a><span id="l4.7"> </span>
<a href="#l4.8"></a><span id="l4.8" class="difflineplus">+Components.utils.import(&quot;resource://gre/modules/XPCOMUtils.jsm&quot;);</span>
<a href="#l4.9"></a><span id="l4.9" class="difflineplus">+</span>
<a href="#l4.10"></a><span id="l4.10"> /**</span>
<a href="#l4.11"></a><span id="l4.11">  * This code might change soon if we support Thunderbird's activity manager.</span>
<a href="#l4.12"></a><span id="l4.12">  * NOTE: The naming &quot;Meteors&quot; is historical.</span>
<a href="#l4.13"></a><span id="l4.13">  */</span>
<a href="#l4.14"></a><span id="l4.14">  var gCalendarStatusFeedback = {</span>
<a href="#l4.15"></a><span id="l4.15">      mCalendarStep: 0,</span>
<a href="#l4.16"></a><span id="l4.16">      mCalendarCount: 0,</span>
<a href="#l4.17"></a><span id="l4.17">      mWindow: null,</span>
<a href="#l4.18"></a><span id="l4.18" class="difflineat">@@ -14,19 +16,17 @@</span>
<a href="#l4.19"></a><span id="l4.19">      mStatusBar: null,</span>
<a href="#l4.20"></a><span id="l4.20">      mStatusProgressPanel: null,</span>
<a href="#l4.21"></a><span id="l4.21">      mThrobber: null,</span>
<a href="#l4.22"></a><span id="l4.22">      mProgressMode: Components.interfaces.calIStatusObserver.NO_PROGRESS,</span>
<a href="#l4.23"></a><span id="l4.23">      mCurIndex: 0,</span>
<a href="#l4.24"></a><span id="l4.24">      mInitialized: false,</span>
<a href="#l4.25"></a><span id="l4.25">      mCalendars: {},</span>
<a href="#l4.26"></a><span id="l4.26"> </span>
<a href="#l4.27"></a><span id="l4.27" class="difflineminus">-    QueryInterface: function cStObs_QueryInterface(aIID) {</span>
<a href="#l4.28"></a><span id="l4.28" class="difflineminus">-        return doQueryInterface(this, null, aIID, [Components.interfaces.calIStatusObserver])</span>
<a href="#l4.29"></a><span id="l4.29" class="difflineminus">-    },</span>
<a href="#l4.30"></a><span id="l4.30" class="difflineplus">+    QueryInterface: XPCOMUtils.generateQI([Components.interfaces.calIStatusObserver]),</span>
<a href="#l4.31"></a><span id="l4.31"> </span>
<a href="#l4.32"></a><span id="l4.32">      initialize: function cStObs_initialize(aWindow) {</span>
<a href="#l4.33"></a><span id="l4.33">         if (!this.mInitialized) {</span>
<a href="#l4.34"></a><span id="l4.34">             this.mWindow = aWindow;</span>
<a href="#l4.35"></a><span id="l4.35">             this.mStatusText = this.mWindow.document.getElementById(&quot;statusText&quot;);</span>
<a href="#l4.36"></a><span id="l4.36">             this.mStatusBar = this.mWindow.document.getElementById(&quot;statusbar-icon&quot;);</span>
<a href="#l4.37"></a><span id="l4.37">             this.mStatusProgressPanel = this.mWindow.document.getElementById(&quot;statusbar-progresspanel&quot;);</span>
<a href="#l4.38"></a><span id="l4.38">             this.mThrobber = this.mWindow.document.getElementById(&quot;navigator-throbber&quot;);</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l5.1"></a><span id="l5.1" class="difflineminus">--- a/calendar/base/content/calendar-task-editing.js</span>
<a href="#l5.2"></a><span id="l5.2" class="difflineplus">+++ b/calendar/base/content/calendar-task-editing.js</span>
<a href="#l5.3"></a><span id="l5.3" class="difflineat">@@ -1,13 +1,14 @@</span>
<a href="#l5.4"></a><span id="l5.4"> /* This Source Code Form is subject to the terms of the Mozilla Public</span>
<a href="#l5.5"></a><span id="l5.5">  * License, v. 2.0. If a copy of the MPL was not distributed with this</span>
<a href="#l5.6"></a><span id="l5.6">  * file, You can obtain one at http://mozilla.org/MPL/2.0/. */</span>
<a href="#l5.7"></a><span id="l5.7"> </span>
<a href="#l5.8"></a><span id="l5.8"> Components.utils.import(&quot;resource://calendar/modules/calAlarmUtils.jsm&quot;);</span>
<a href="#l5.9"></a><span id="l5.9" class="difflineplus">+Components.utils.import(&quot;resource://gre/modules/XPCOMUtils.jsm&quot;);</span>
<a href="#l5.10"></a><span id="l5.10"> </span>
<a href="#l5.11"></a><span id="l5.11"> /**</span>
<a href="#l5.12"></a><span id="l5.12">  * Used by the &quot;quick add&quot; feature for tasks, for example in the task view or</span>
<a href="#l5.13"></a><span id="l5.13">  * the uniinder-todo.</span>
<a href="#l5.14"></a><span id="l5.14">  *</span>
<a href="#l5.15"></a><span id="l5.15">  * NOTE: many of the following methods are called without taskEdit being the</span>
<a href="#l5.16"></a><span id="l5.16">  * |this| object.</span>
<a href="#l5.17"></a><span id="l5.17">  */</span>
<a href="#l5.18"></a><span id="l5.18" class="difflineat">@@ -162,20 +163,17 @@ var taskEdit = {</span>
<a href="#l5.19"></a><span id="l5.19"> </span>
<a href="#l5.20"></a><span id="l5.20">     /**</span>
<a href="#l5.21"></a><span id="l5.21">      * Observer to watch for readonly, disabled and capability changes of the</span>
<a href="#l5.22"></a><span id="l5.22">      * observed calendar.</span>
<a href="#l5.23"></a><span id="l5.23">      *</span>
<a href="#l5.24"></a><span id="l5.24">      * @see calIObserver</span>
<a href="#l5.25"></a><span id="l5.25">      */</span>
<a href="#l5.26"></a><span id="l5.26">     calendarObserver: {</span>
<a href="#l5.27"></a><span id="l5.27" class="difflineminus">-        QueryInterface: function tE_calObs_QueryInterface(aIID) {</span>
<a href="#l5.28"></a><span id="l5.28" class="difflineminus">-            return doQueryInterface(this, null, aIID,</span>
<a href="#l5.29"></a><span id="l5.29" class="difflineminus">-                                    [Components.interfaces.calIObserver]);</span>
<a href="#l5.30"></a><span id="l5.30" class="difflineminus">-        },</span>
<a href="#l5.31"></a><span id="l5.31" class="difflineplus">+        QueryInterface: XPCOMUtils.generateQI([Components.interfaces.calIObserver]),</span>
<a href="#l5.32"></a><span id="l5.32"> </span>
<a href="#l5.33"></a><span id="l5.33">         // calIObserver:</span>
<a href="#l5.34"></a><span id="l5.34">         onStartBatch: function() {},</span>
<a href="#l5.35"></a><span id="l5.35">         onEndBatch: function() {},</span>
<a href="#l5.36"></a><span id="l5.36">         onLoad: function(aCalendar) {},</span>
<a href="#l5.37"></a><span id="l5.37">         onAddItem: function(aItem) {},</span>
<a href="#l5.38"></a><span id="l5.38">         onModifyItem: function(aNewItem, aOldItem) {},</span>
<a href="#l5.39"></a><span id="l5.39">         onDeleteItem: function(aDeletedItem) {},</span>
<a href="#l5.40"></a><span id="l5.40" class="difflineat">@@ -212,21 +210,20 @@ var taskEdit = {</span>
<a href="#l5.41"></a><span id="l5.41">     /**</span>
<a href="#l5.42"></a><span id="l5.42">      * Observer to watch for changes to the selected calendar.</span>
<a href="#l5.43"></a><span id="l5.43">      *</span>
<a href="#l5.44"></a><span id="l5.44">      * XXX I think we don't need to implement calIObserver here.</span>
<a href="#l5.45"></a><span id="l5.45">      *</span>
<a href="#l5.46"></a><span id="l5.46">      * @see calICompositeObserver</span>
<a href="#l5.47"></a><span id="l5.47">      */</span>
<a href="#l5.48"></a><span id="l5.48">     compositeObserver: {</span>
<a href="#l5.49"></a><span id="l5.49" class="difflineminus">-        QueryInterface: function tE_compObs_QueryInterface(aIID) {</span>
<a href="#l5.50"></a><span id="l5.50" class="difflineminus">-            return doQueryInterface(this, null, aIID,</span>
<a href="#l5.51"></a><span id="l5.51" class="difflineminus">-                                    [Components.interfaces.calIObserver,</span>
<a href="#l5.52"></a><span id="l5.52" class="difflineminus">-                                     Components.interfaces.calICompositeObserver]);</span>
<a href="#l5.53"></a><span id="l5.53" class="difflineminus">-        },</span>
<a href="#l5.54"></a><span id="l5.54" class="difflineplus">+        QueryInterface: XPCOMUtils.generateQI([</span>
<a href="#l5.55"></a><span id="l5.55" class="difflineplus">+            Components.interfaces.calIObserver,</span>
<a href="#l5.56"></a><span id="l5.56" class="difflineplus">+            Components.interfaces.calICompositeObserver</span>
<a href="#l5.57"></a><span id="l5.57" class="difflineplus">+        ]),</span>
<a href="#l5.58"></a><span id="l5.58"> </span>
<a href="#l5.59"></a><span id="l5.59">         // calIObserver:</span>
<a href="#l5.60"></a><span id="l5.60">         onStartBatch: function() {},</span>
<a href="#l5.61"></a><span id="l5.61">         onEndBatch: function() {},</span>
<a href="#l5.62"></a><span id="l5.62">         onLoad: function(aCalendar) {},</span>
<a href="#l5.63"></a><span id="l5.63">         onAddItem: function(aItem) {},</span>
<a href="#l5.64"></a><span id="l5.64">         onModifyItem: function(aNewItem, aOldItem) {},</span>
<a href="#l5.65"></a><span id="l5.65">         onDeleteItem: function(aDeletedItem) {},</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l6.1"></a><span id="l6.1" class="difflineminus">--- a/calendar/base/content/calendar-task-tree.xml</span>
<a href="#l6.2"></a><span id="l6.2" class="difflineplus">+++ b/calendar/base/content/calendar-task-tree.xml</span>
<a href="#l6.3"></a><span id="l6.3" class="difflineat">@@ -112,16 +112,17 @@</span>
<a href="#l6.4"></a><span id="l6.4">       &lt;/xul:tree&gt;</span>
<a href="#l6.5"></a><span id="l6.5">     &lt;/content&gt;</span>
<a href="#l6.6"></a><span id="l6.6"> </span>
<a href="#l6.7"></a><span id="l6.7">     &lt;implementation implements=&quot;nsIObserver&quot;&gt;</span>
<a href="#l6.8"></a><span id="l6.8">       &lt;constructor&gt;&lt;![CDATA[</span>
<a href="#l6.9"></a><span id="l6.9">         Components.utils.import(&quot;resource://gre/modules/PluralForm.jsm&quot;);</span>
<a href="#l6.10"></a><span id="l6.10">         Components.utils.import(&quot;resource://gre/modules/Services.jsm&quot;);</span>
<a href="#l6.11"></a><span id="l6.11">         Components.utils.import(&quot;resource://calendar/modules/calItemUtils.jsm&quot;);</span>
<a href="#l6.12"></a><span id="l6.12" class="difflineplus">+        Components.utils.import(&quot;resource://gre/modules/XPCOMUtils.jsm&quot;);</span>
<a href="#l6.13"></a><span id="l6.13">         let self = this;</span>
<a href="#l6.14"></a><span id="l6.14"> </span>
<a href="#l6.15"></a><span id="l6.15">         // set up the tree filter</span>
<a href="#l6.16"></a><span id="l6.16">         this.mFilter = new calFilter();</span>
<a href="#l6.17"></a><span id="l6.17"> </span>
<a href="#l6.18"></a><span id="l6.18">         // set up the custom tree view</span>
<a href="#l6.19"></a><span id="l6.19">         let tree = document.getAnonymousElementByAttribute(this, &quot;anonid&quot;, &quot;calendar-task-tree&quot;);</span>
<a href="#l6.20"></a><span id="l6.20">         this.mTreeView.tree = tree;</span>
<a href="#l6.21"></a><span id="l6.21" class="difflineat">@@ -815,23 +816,22 @@</span>
<a href="#l6.22"></a><span id="l6.22">       &lt;!--</span>
<a href="#l6.23"></a><span id="l6.23">         Observer for the calendar event data source. This keeps the unifinder</span>
<a href="#l6.24"></a><span id="l6.24">         display up to date when the calendar event data is changed</span>
<a href="#l6.25"></a><span id="l6.25">         --&gt;</span>
<a href="#l6.26"></a><span id="l6.26">       &lt;field name=&quot;mTaskTreeObserver&quot;&gt;&lt;![CDATA[</span>
<a href="#l6.27"></a><span id="l6.27">       ({</span>
<a href="#l6.28"></a><span id="l6.28">           binding: this,</span>
<a href="#l6.29"></a><span id="l6.29"> </span>
<a href="#l6.30"></a><span id="l6.30" class="difflineminus">-          QueryInterface: function tTO_QueryInterface(aIID) {</span>
<a href="#l6.31"></a><span id="l6.31" class="difflineminus">-              return doQueryInterface(this, null, aIID,</span>
<a href="#l6.32"></a><span id="l6.32" class="difflineminus">-                                      [Components.interfaces.calICompositeObserver,</span>
<a href="#l6.33"></a><span id="l6.33" class="difflineminus">-                                       Components.interfaces.calIObserver]);</span>
<a href="#l6.34"></a><span id="l6.34" class="difflineminus">-          },</span>
<a href="#l6.35"></a><span id="l6.35" class="difflineplus">+          QueryInterface: XPCOMUtils.generateQI([</span>
<a href="#l6.36"></a><span id="l6.36" class="difflineplus">+              Components.interfaces.calICompositeObserver,</span>
<a href="#l6.37"></a><span id="l6.37" class="difflineplus">+              Components.interfaces.calIObserver</span>
<a href="#l6.38"></a><span id="l6.38" class="difflineplus">+          ]),</span>
<a href="#l6.39"></a><span id="l6.39"> </span>
<a href="#l6.40"></a><span id="l6.40" class="difflineminus">-         /**</span>
<a href="#l6.41"></a><span id="l6.41" class="difflineplus">+          /**</span>
<a href="#l6.42"></a><span id="l6.42">            * calIObserver methods and properties</span>
<a href="#l6.43"></a><span id="l6.43">            */</span>
<a href="#l6.44"></a><span id="l6.44">           onStartBatch: function tTO_onStartBatch() {</span>
<a href="#l6.45"></a><span id="l6.45">           },</span>
<a href="#l6.46"></a><span id="l6.46"> </span>
<a href="#l6.47"></a><span id="l6.47">           onEndBatch: function tTO_onEndBatch() {</span>
<a href="#l6.48"></a><span id="l6.48">           },</span>
<a href="#l6.49"></a><span id="l6.49"> </span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l7.1"></a><span id="l7.1" class="difflineminus">--- a/calendar/base/content/calendar-unifinder.js</span>
<a href="#l7.2"></a><span id="l7.2" class="difflineplus">+++ b/calendar/base/content/calendar-unifinder.js</span>
<a href="#l7.3"></a><span id="l7.3" class="difflineat">@@ -47,25 +47,21 @@ function getCurrentUnifinderFilter() {</span>
<a href="#l7.4"></a><span id="l7.4"> /**</span>
<a href="#l7.5"></a><span id="l7.5">  * Observer for the calendar event data source. This keeps the unifinder</span>
<a href="#l7.6"></a><span id="l7.6">  * display up to date when the calendar event data is changed</span>
<a href="#l7.7"></a><span id="l7.7">  *</span>
<a href="#l7.8"></a><span id="l7.8">  * @see calIObserver</span>
<a href="#l7.9"></a><span id="l7.9">  * @see calICompositeObserver</span>
<a href="#l7.10"></a><span id="l7.10">  */</span>
<a href="#l7.11"></a><span id="l7.11"> var unifinderObserver = {</span>
<a href="#l7.12"></a><span id="l7.12" class="difflineminus">-</span>
<a href="#l7.13"></a><span id="l7.13" class="difflineminus">-    QueryInterface: function uO_QueryInterface (aIID) {</span>
<a href="#l7.14"></a><span id="l7.14" class="difflineminus">-        return cal.doQueryInterface(this,</span>
<a href="#l7.15"></a><span id="l7.15" class="difflineminus">-                                    null, // this singleton has no prototype</span>
<a href="#l7.16"></a><span id="l7.16" class="difflineminus">-                                    aIID,</span>
<a href="#l7.17"></a><span id="l7.17" class="difflineminus">-                                    [Components.interfaces.calICompositeObserver,</span>
<a href="#l7.18"></a><span id="l7.18" class="difflineminus">-                                     Components.interfaces.nsIObserver,</span>
<a href="#l7.19"></a><span id="l7.19" class="difflineminus">-                                     Components.interfaces.calIObserver]);</span>
<a href="#l7.20"></a><span id="l7.20" class="difflineminus">-    },</span>
<a href="#l7.21"></a><span id="l7.21" class="difflineplus">+    QueryInterface: XPCOMUtils.generateQI([</span>
<a href="#l7.22"></a><span id="l7.22" class="difflineplus">+        Components.interfaces.calICompositeObserver,</span>
<a href="#l7.23"></a><span id="l7.23" class="difflineplus">+        Components.interfaces.nsIObserver,</span>
<a href="#l7.24"></a><span id="l7.24" class="difflineplus">+        Components.interfaces.calIObserver</span>
<a href="#l7.25"></a><span id="l7.25" class="difflineplus">+    ]),</span>
<a href="#l7.26"></a><span id="l7.26"> </span>
<a href="#l7.27"></a><span id="l7.27">     // calIObserver:</span>
<a href="#l7.28"></a><span id="l7.28">     onStartBatch: function uO_onStartBatch() {</span>
<a href="#l7.29"></a><span id="l7.29">     },</span>
<a href="#l7.30"></a><span id="l7.30"> </span>
<a href="#l7.31"></a><span id="l7.31">     onEndBatch: function uO_onEndBatch() {</span>
<a href="#l7.32"></a><span id="l7.32">         refreshEventTree();</span>
<a href="#l7.33"></a><span id="l7.33">     },</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l8.1"></a><span id="l8.1" class="difflineminus">--- a/calendar/base/content/calendar-views.js</span>
<a href="#l8.2"></a><span id="l8.2" class="difflineplus">+++ b/calendar/base/content/calendar-views.js</span>
<a href="#l8.3"></a><span id="l8.3" class="difflineat">@@ -1,15 +1,16 @@</span>
<a href="#l8.4"></a><span id="l8.4"> /* This Source Code Form is subject to the terms of the Mozilla Public</span>
<a href="#l8.5"></a><span id="l8.5">  * License, v. 2.0. If a copy of the MPL was not distributed with this</span>
<a href="#l8.6"></a><span id="l8.6">  * file, You can obtain one at http://mozilla.org/MPL/2.0/. */</span>
<a href="#l8.7"></a><span id="l8.7"> </span>
<a href="#l8.8"></a><span id="l8.8"> Components.utils.import(&quot;resource://calendar/modules/calUtils.jsm&quot;);</span>
<a href="#l8.9"></a><span id="l8.9"> Components.utils.import(&quot;resource://calendar/modules/calAlarmUtils.jsm&quot;);</span>
<a href="#l8.10"></a><span id="l8.10"> Components.utils.import(&quot;resource://gre/modules/Services.jsm&quot;);</span>
<a href="#l8.11"></a><span id="l8.11" class="difflineplus">+Components.utils.import(&quot;resource://gre/modules/XPCOMUtils.jsm&quot;);</span>
<a href="#l8.12"></a><span id="l8.12"> </span>
<a href="#l8.13"></a><span id="l8.13"> /**</span>
<a href="#l8.14"></a><span id="l8.14">  * Controller for the views</span>
<a href="#l8.15"></a><span id="l8.15">  * @see calIcalendarViewController</span>
<a href="#l8.16"></a><span id="l8.16">  */</span>
<a href="#l8.17"></a><span id="l8.17"> var calendarViewController = {</span>
<a href="#l8.18"></a><span id="l8.18">     QueryInterface: function(aIID) {</span>
<a href="#l8.19"></a><span id="l8.19">         if (!aIID.equals(Components.interfaces.calICalendarViewController) &amp;&amp;</span>
<a href="#l8.20"></a><span id="l8.20" class="difflineat">@@ -482,22 +483,17 @@ function updateStyleSheetForViews(aCalen</span>
<a href="#l8.21"></a><span id="l8.21">  * colors.</span>
<a href="#l8.22"></a><span id="l8.22">  *</span>
<a href="#l8.23"></a><span id="l8.23">  * Note we need to keep the categoryPrefBranch variable outside of</span>
<a href="#l8.24"></a><span id="l8.24">  * initCategories since branch observers only live as long as the branch object</span>
<a href="#l8.25"></a><span id="l8.25">  * is alive, and out of categoryManagement to avoid cyclic references.</span>
<a href="#l8.26"></a><span id="l8.26">  */</span>
<a href="#l8.27"></a><span id="l8.27"> var categoryPrefBranch;</span>
<a href="#l8.28"></a><span id="l8.28"> var categoryManagement = {</span>
<a href="#l8.29"></a><span id="l8.29" class="difflineminus">-    QueryInterface: function cM_QueryInterface(aIID) {</span>
<a href="#l8.30"></a><span id="l8.30" class="difflineminus">-        return cal.doQueryInterface(this,</span>
<a href="#l8.31"></a><span id="l8.31" class="difflineminus">-                                    categoryManagement.__proto__,</span>
<a href="#l8.32"></a><span id="l8.32" class="difflineminus">-                                    aIID,</span>
<a href="#l8.33"></a><span id="l8.33" class="difflineminus">-                                    [Components.interfaces.nsIObserver]);</span>
<a href="#l8.34"></a><span id="l8.34" class="difflineminus">-    },</span>
<a href="#l8.35"></a><span id="l8.35" class="difflineplus">+    QueryInterface: XPCOMUtils.generateQI([Components.interfaces.nsIObserver]),</span>
<a href="#l8.36"></a><span id="l8.36"> </span>
<a href="#l8.37"></a><span id="l8.37">     initCategories: function cM_initCategories() {</span>
<a href="#l8.38"></a><span id="l8.38">       categoryPrefBranch = Services.prefs.getBranch(&quot;calendar.category.color.&quot;);</span>
<a href="#l8.39"></a><span id="l8.39">       let categories = categoryPrefBranch.getChildList(&quot;&quot;);</span>
<a href="#l8.40"></a><span id="l8.40"> </span>
<a href="#l8.41"></a><span id="l8.41">       // Fix illegally formatted category prefs.</span>
<a href="#l8.42"></a><span id="l8.42">       for (let i in categories) {</span>
<a href="#l8.43"></a><span id="l8.43">           let category = categories[i];</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l9.1"></a><span id="l9.1" class="difflineminus">--- a/calendar/base/modules/calProviderUtils.jsm</span>
<a href="#l9.2"></a><span id="l9.2" class="difflineplus">+++ b/calendar/base/modules/calProviderUtils.jsm</span>
<a href="#l9.3"></a><span id="l9.3" class="difflineat">@@ -139,21 +139,17 @@ cal.InterfaceRequestor_getInterface = fu</span>
<a href="#l9.4"></a><span id="l9.4"> /**</span>
<a href="#l9.5"></a><span id="l9.5">  * Bad Certificate Handler for Network Requests. Shows the Network Exception</span>
<a href="#l9.6"></a><span id="l9.6">  * Dialog if a certificate Problem occurs.</span>
<a href="#l9.7"></a><span id="l9.7">  */</span>
<a href="#l9.8"></a><span id="l9.8"> cal.BadCertHandler = function calBadCertHandler(thisProvider) {</span>
<a href="#l9.9"></a><span id="l9.9">     this.thisProvider = thisProvider;</span>
<a href="#l9.10"></a><span id="l9.10"> };</span>
<a href="#l9.11"></a><span id="l9.11"> cal.BadCertHandler.prototype = {</span>
<a href="#l9.12"></a><span id="l9.12" class="difflineminus">-    QueryInterface: function cBCL_QueryInterface(aIID) {</span>
<a href="#l9.13"></a><span id="l9.13" class="difflineminus">-        return cal.doQueryInterface(this, cal.BadCertListener.prototype, aIID,</span>
<a href="#l9.14"></a><span id="l9.14" class="difflineminus">-                                    [Components.interfaces.nsISupports,</span>
<a href="#l9.15"></a><span id="l9.15" class="difflineminus">-                                     Components.interfaces.nsIBadCertListener2]);</span>
<a href="#l9.16"></a><span id="l9.16" class="difflineminus">-    },</span>
<a href="#l9.17"></a><span id="l9.17" class="difflineplus">+    QueryInterface: XPCOMUtils.generateQI([Components.interfaces.nsIBadCertListener2]),</span>
<a href="#l9.18"></a><span id="l9.18"> </span>
<a href="#l9.19"></a><span id="l9.19">     notifyCertProblem: function cBCL_notifyCertProblem(socketInfo, status, targetSite) {</span>
<a href="#l9.20"></a><span id="l9.20">         if (!status) {</span>
<a href="#l9.21"></a><span id="l9.21">             return true;</span>
<a href="#l9.22"></a><span id="l9.22">         }</span>
<a href="#l9.23"></a><span id="l9.23"> </span>
<a href="#l9.24"></a><span id="l9.24">         // Unfortunately we can't pass js objects using the window watcher, so</span>
<a href="#l9.25"></a><span id="l9.25">         // we'll just take the first available calendar window. We also need to</span>
<a href="#l9.26"></a><span id="l9.26" class="difflineat">@@ -221,23 +217,17 @@ cal.FreeBusyInterval = function calFreeB</span>
<a href="#l9.27"></a><span id="l9.27">     this.interval = Components.classes[&quot;@mozilla.org/calendar/period;1&quot;]</span>
<a href="#l9.28"></a><span id="l9.28">                               .createInstance(Components.interfaces.calIPeriod);</span>
<a href="#l9.29"></a><span id="l9.29">     this.interval.start = aStart;</span>
<a href="#l9.30"></a><span id="l9.30">     this.interval.end = aEnd;</span>
<a href="#l9.31"></a><span id="l9.31"> </span>
<a href="#l9.32"></a><span id="l9.32">     this.freeBusyType = aFreeBusyType || Components.interfaces.calIFreeBusyInterval.UNKNOWN;</span>
<a href="#l9.33"></a><span id="l9.33"> };</span>
<a href="#l9.34"></a><span id="l9.34"> cal.FreeBusyInterval.prototype = {</span>
<a href="#l9.35"></a><span id="l9.35" class="difflineminus">-    QueryInterface: function cFBI_QueryInterface(aIID) {</span>
<a href="#l9.36"></a><span id="l9.36" class="difflineminus">-        return doQueryInterface(this,</span>
<a href="#l9.37"></a><span id="l9.37" class="difflineminus">-                                cal.FreeBusyInterval.prototype,</span>
<a href="#l9.38"></a><span id="l9.38" class="difflineminus">-                                aIID,</span>
<a href="#l9.39"></a><span id="l9.39" class="difflineminus">-                                [Components.interfaces.calIFreeBusyInterval]);</span>
<a href="#l9.40"></a><span id="l9.40" class="difflineminus">-    },</span>
<a href="#l9.41"></a><span id="l9.41" class="difflineminus">-</span>
<a href="#l9.42"></a><span id="l9.42" class="difflineplus">+    QueryInterface: XPCOMUtils.generateQI([Components.interfaces.calIFreeBusyInterval]),</span>
<a href="#l9.43"></a><span id="l9.43">     calId: null,</span>
<a href="#l9.44"></a><span id="l9.44">     interval: null,</span>
<a href="#l9.45"></a><span id="l9.45">     freeBusyType: Components.interfaces.calIFreeBusyInterval.UNKNOWN</span>
<a href="#l9.46"></a><span id="l9.46"> };</span>
<a href="#l9.47"></a><span id="l9.47"> </span>
<a href="#l9.48"></a><span id="l9.48"> /**</span>
<a href="#l9.49"></a><span id="l9.49">  * Gets the iTIP/iMIP transport if the passed calendar has configured email.</span>
<a href="#l9.50"></a><span id="l9.50">  */</span>
<a href="#l9.51"></a><span id="l9.51" class="difflineat">@@ -518,22 +508,20 @@ cal.ProviderBase.mTransientProperties = </span>
<a href="#l9.52"></a><span id="l9.52">     &quot;itip.transport&quot;: true,</span>
<a href="#l9.53"></a><span id="l9.53">     &quot;imip.identity&quot;: true,</span>
<a href="#l9.54"></a><span id="l9.54">     &quot;imip.account&quot;: true,</span>
<a href="#l9.55"></a><span id="l9.55">     &quot;imip.identity.disabled&quot;: true,</span>
<a href="#l9.56"></a><span id="l9.56">     &quot;organizerId&quot;: true,</span>
<a href="#l9.57"></a><span id="l9.57">     &quot;organizerCN&quot;: true</span>
<a href="#l9.58"></a><span id="l9.58"> };</span>
<a href="#l9.59"></a><span id="l9.59"> cal.ProviderBase.prototype = {</span>
<a href="#l9.60"></a><span id="l9.60" class="difflineminus">-    QueryInterface: function cPB_QueryInterface(aIID) {</span>
<a href="#l9.61"></a><span id="l9.61" class="difflineminus">-        return cal.doQueryInterface(this, cal.ProviderBase.prototype, aIID,</span>
<a href="#l9.62"></a><span id="l9.62" class="difflineminus">-                                    [Components.interfaces.nsISupports,</span>
<a href="#l9.63"></a><span id="l9.63" class="difflineminus">-                                     Components.interfaces.calICalendar,</span>
<a href="#l9.64"></a><span id="l9.64" class="difflineminus">-                                     Components.interfaces.calISchedulingSupport]);</span>
<a href="#l9.65"></a><span id="l9.65" class="difflineminus">-    },</span>
<a href="#l9.66"></a><span id="l9.66" class="difflineplus">+    QueryInterface: XPCOMUtils.generateQI([</span>
<a href="#l9.67"></a><span id="l9.67" class="difflineplus">+        Components.interfaces.calICalendar,</span>
<a href="#l9.68"></a><span id="l9.68" class="difflineplus">+        Components.interfaces.calISchedulingSupport</span>
<a href="#l9.69"></a><span id="l9.69" class="difflineplus">+    ]),</span>
<a href="#l9.70"></a><span id="l9.70"> </span>
<a href="#l9.71"></a><span id="l9.71">     mID: null,</span>
<a href="#l9.72"></a><span id="l9.72">     mUri: null,</span>
<a href="#l9.73"></a><span id="l9.73">     mACLEntry: null,</span>
<a href="#l9.74"></a><span id="l9.74">     mObservers: null,</span>
<a href="#l9.75"></a><span id="l9.75">     mProperties: null,</span>
<a href="#l9.76"></a><span id="l9.76"> </span>
<a href="#l9.77"></a><span id="l9.77">     initProviderBase: function cPB_initProviderBase() {</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l10.1"></a><span id="l10.1" class="difflineminus">--- a/calendar/base/src/calAlarm.js</span>
<a href="#l10.2"></a><span id="l10.2" class="difflineplus">+++ b/calendar/base/src/calAlarm.js</span>
<a href="#l10.3"></a><span id="l10.3" class="difflineat">@@ -1,27 +1,30 @@</span>
<a href="#l10.4"></a><span id="l10.4"> /* This Source Code Form is subject to the terms of the Mozilla Public</span>
<a href="#l10.5"></a><span id="l10.5">  * License, v. 2.0. If a copy of the MPL was not distributed with this</span>
<a href="#l10.6"></a><span id="l10.6">  * file, You can obtain one at http://mozilla.org/MPL/2.0/. */</span>
<a href="#l10.7"></a><span id="l10.7"> </span>
<a href="#l10.8"></a><span id="l10.8"> Components.utils.import(&quot;resource://gre/modules/PluralForm.jsm&quot;);</span>
<a href="#l10.9"></a><span id="l10.9"> Components.utils.import(&quot;resource://calendar/modules/calUtils.jsm&quot;);</span>
<a href="#l10.10"></a><span id="l10.10" class="difflineplus">+Components.utils.import(&quot;resource://gre/modules/XPCOMUtils.jsm&quot;);</span>
<a href="#l10.11"></a><span id="l10.11"> </span>
<a href="#l10.12"></a><span id="l10.12"> const ALARM_RELATED_ABSOLUTE = Components.interfaces.calIAlarm.ALARM_RELATED_ABSOLUTE;</span>
<a href="#l10.13"></a><span id="l10.13"> const ALARM_RELATED_START = Components.interfaces.calIAlarm.ALARM_RELATED_START;</span>
<a href="#l10.14"></a><span id="l10.14"> const ALARM_RELATED_END = Components.interfaces.calIAlarm.ALARM_RELATED_END;</span>
<a href="#l10.15"></a><span id="l10.15"> </span>
<a href="#l10.16"></a><span id="l10.16"> function calAlarm() {</span>
<a href="#l10.17"></a><span id="l10.17">     this.wrappedJSObject = this;</span>
<a href="#l10.18"></a><span id="l10.18">     this.mProperties = new calPropertyBag();</span>
<a href="#l10.19"></a><span id="l10.19">     this.mPropertyParams = {};</span>
<a href="#l10.20"></a><span id="l10.20">     this.mAttendees = [];</span>
<a href="#l10.21"></a><span id="l10.21">     this.mAttachments = [];</span>
<a href="#l10.22"></a><span id="l10.22"> }</span>
<a href="#l10.23"></a><span id="l10.23"> </span>
<a href="#l10.24"></a><span id="l10.24" class="difflineplus">+const calAlarmClassID = Components.ID(&quot;{b8db7c7f-c168-4e11-becb-f26c1c4f5f8f}&quot;);</span>
<a href="#l10.25"></a><span id="l10.25" class="difflineplus">+const calAlarmInterfaces = [Components.interfaces.calIAlarm];</span>
<a href="#l10.26"></a><span id="l10.26"> calAlarm.prototype = {</span>
<a href="#l10.27"></a><span id="l10.27"> </span>
<a href="#l10.28"></a><span id="l10.28">     mProperties: null,</span>
<a href="#l10.29"></a><span id="l10.29">     mPropertyParams: null,</span>
<a href="#l10.30"></a><span id="l10.30">     mAction: null,</span>
<a href="#l10.31"></a><span id="l10.31">     mAbsoluteDate: null,</span>
<a href="#l10.32"></a><span id="l10.32">     mOffset: null,</span>
<a href="#l10.33"></a><span id="l10.33">     mDuration: null,</span>
<a href="#l10.34"></a><span id="l10.34" class="difflineat">@@ -29,39 +32,24 @@ calAlarm.prototype = {</span>
<a href="#l10.35"></a><span id="l10.35">     mAttachments: null,</span>
<a href="#l10.36"></a><span id="l10.36">     mSummary: null,</span>
<a href="#l10.37"></a><span id="l10.37">     mDescription: null,</span>
<a href="#l10.38"></a><span id="l10.38">     mLastAck: null,</span>
<a href="#l10.39"></a><span id="l10.39">     mImmutable: false,</span>
<a href="#l10.40"></a><span id="l10.40">     mRelated: 0,</span>
<a href="#l10.41"></a><span id="l10.41">     mRepeat: 0,</span>
<a href="#l10.42"></a><span id="l10.42"> </span>
<a href="#l10.43"></a><span id="l10.43" class="difflineminus">-    QueryInterface: function cA_QueryInterface(aIID) {</span>
<a href="#l10.44"></a><span id="l10.44" class="difflineminus">-        return cal.doQueryInterface(this, calAlarm.prototype, aIID, null, this);</span>
<a href="#l10.45"></a><span id="l10.45" class="difflineminus">-    },</span>
<a href="#l10.46"></a><span id="l10.46" class="difflineminus">-</span>
<a href="#l10.47"></a><span id="l10.47" class="difflineminus">-    /**</span>
<a href="#l10.48"></a><span id="l10.48" class="difflineminus">-     * nsIClassInfo</span>
<a href="#l10.49"></a><span id="l10.49" class="difflineminus">-     */</span>
<a href="#l10.50"></a><span id="l10.50" class="difflineminus">-    getInterfaces: function cA_getInterfaces(aCount) {</span>
<a href="#l10.51"></a><span id="l10.51" class="difflineminus">-        let interfaces = [Components.interfaces.calIAlarm,</span>
<a href="#l10.52"></a><span id="l10.52" class="difflineminus">-                            Components.interfaces.nsISupports,</span>
<a href="#l10.53"></a><span id="l10.53" class="difflineminus">-                            Components.interfaces.nsIClassInfo];</span>
<a href="#l10.54"></a><span id="l10.54" class="difflineminus">-</span>
<a href="#l10.55"></a><span id="l10.55" class="difflineminus">-        aCount.value = interfaces.length;</span>
<a href="#l10.56"></a><span id="l10.56" class="difflineminus">-        return interfaces;</span>
<a href="#l10.57"></a><span id="l10.57" class="difflineminus">-    },</span>
<a href="#l10.58"></a><span id="l10.58" class="difflineminus">-    getHelperForLanguage: function cA_getHelperForLanguage(aLang) {</span>
<a href="#l10.59"></a><span id="l10.59" class="difflineminus">-        return null;</span>
<a href="#l10.60"></a><span id="l10.60" class="difflineminus">-    },</span>
<a href="#l10.61"></a><span id="l10.61" class="difflineminus">-    contractID: &quot;@mozilla.org/calendar/alarm;1&quot;,</span>
<a href="#l10.62"></a><span id="l10.62" class="difflineminus">-    classDescription: &quot;Describes a VALARM&quot;,</span>
<a href="#l10.63"></a><span id="l10.63" class="difflineminus">-    classID: Components.ID(&quot;{b8db7c7f-c168-4e11-becb-f26c1c4f5f8f}&quot;),</span>
<a href="#l10.64"></a><span id="l10.64" class="difflineminus">-    implementationLanguage: Components.interfaces.nsIProgrammingLanguage.JAVASCRIPT,</span>
<a href="#l10.65"></a><span id="l10.65" class="difflineminus">-    flags: 0,</span>
<a href="#l10.66"></a><span id="l10.66" class="difflineplus">+    classID: calAlarmClassID,</span>
<a href="#l10.67"></a><span id="l10.67" class="difflineplus">+    QueryInterface: XPCOMUtils.generateQI(calAlarmInterfaces),</span>
<a href="#l10.68"></a><span id="l10.68" class="difflineplus">+    classInfo: XPCOMUtils.generateCI({</span>
<a href="#l10.69"></a><span id="l10.69" class="difflineplus">+        classID: calAlarmClassID,</span>
<a href="#l10.70"></a><span id="l10.70" class="difflineplus">+        contractID: &quot;@mozilla.org/calendar/alarm;1&quot;,</span>
<a href="#l10.71"></a><span id="l10.71" class="difflineplus">+        classDescription: &quot;Describes a VALARM&quot;,</span>
<a href="#l10.72"></a><span id="l10.72" class="difflineplus">+        interfaces: calAlarmInterfaces</span>
<a href="#l10.73"></a><span id="l10.73" class="difflineplus">+    }),</span>
<a href="#l10.74"></a><span id="l10.74"> </span>
<a href="#l10.75"></a><span id="l10.75">     /**</span>
<a href="#l10.76"></a><span id="l10.76">      * calIAlarm</span>
<a href="#l10.77"></a><span id="l10.77">      */</span>
<a href="#l10.78"></a><span id="l10.78"> </span>
<a href="#l10.79"></a><span id="l10.79">     ensureMutable: function cA_ensureMutable() {</span>
<a href="#l10.80"></a><span id="l10.80">         if (this.mImmutable) {</span>
<a href="#l10.81"></a><span id="l10.81">             throw Components.results.NS_ERROR_OBJECT_IS_IMMUTABLE;</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l11.1"></a><span id="l11.1" class="difflineminus">--- a/calendar/base/src/calAlarmMonitor.js</span>
<a href="#l11.2"></a><span id="l11.2" class="difflineplus">+++ b/calendar/base/src/calAlarmMonitor.js</span>
<a href="#l11.3"></a><span id="l11.3" class="difflineat">@@ -1,14 +1,15 @@</span>
<a href="#l11.4"></a><span id="l11.4"> /* This Source Code Form is subject to the terms of the Mozilla Public</span>
<a href="#l11.5"></a><span id="l11.5">  * License, v. 2.0. If a copy of the MPL was not distributed with this</span>
<a href="#l11.6"></a><span id="l11.6">  * file, You can obtain one at http://mozilla.org/MPL/2.0/. */</span>
<a href="#l11.7"></a><span id="l11.7"> </span>
<a href="#l11.8"></a><span id="l11.8"> Components.utils.import(&quot;resource://calendar/modules/calUtils.jsm&quot;);</span>
<a href="#l11.9"></a><span id="l11.9"> Components.utils.import(&quot;resource://gre/modules/Services.jsm&quot;);</span>
<a href="#l11.10"></a><span id="l11.10" class="difflineplus">+Components.utils.import(&quot;resource://gre/modules/XPCOMUtils.jsm&quot;);</span>
<a href="#l11.11"></a><span id="l11.11"> </span>
<a href="#l11.12"></a><span id="l11.12"> function peekAlarmWindow() {</span>
<a href="#l11.13"></a><span id="l11.13">     return Services.wm.getMostRecentWindow(&quot;Calendar:AlarmWindow&quot;);</span>
<a href="#l11.14"></a><span id="l11.14"> }</span>
<a href="#l11.15"></a><span id="l11.15"> </span>
<a href="#l11.16"></a><span id="l11.16"> /**</span>
<a href="#l11.17"></a><span id="l11.17">  * The alarm monitor takes care of playing the alarm sound and opening one copy</span>
<a href="#l11.18"></a><span id="l11.18">  * of the calendar-alarm-dialog. Both depend on their respective prefs to be</span>
<a href="#l11.19"></a><span id="l11.19" class="difflineat">@@ -17,54 +18,41 @@ function peekAlarmWindow() {</span>
<a href="#l11.20"></a><span id="l11.20"> function calAlarmMonitor() {</span>
<a href="#l11.21"></a><span id="l11.21">     this.wrappedJSObject = this;</span>
<a href="#l11.22"></a><span id="l11.22">     this.mAlarms = [];</span>
<a href="#l11.23"></a><span id="l11.23"> </span>
<a href="#l11.24"></a><span id="l11.24">     this.mSound = Components.classes[&quot;@mozilla.org/sound;1&quot;]</span>
<a href="#l11.25"></a><span id="l11.25">                             .createInstance(Components.interfaces.nsISound);</span>
<a href="#l11.26"></a><span id="l11.26"> }</span>
<a href="#l11.27"></a><span id="l11.27"> </span>
<a href="#l11.28"></a><span id="l11.28" class="difflineplus">+const calAlarmMonitorClassID = Components.ID(&quot;{4b7ae030-ed79-11d9-8cd6-0800200c9a66}&quot;);</span>
<a href="#l11.29"></a><span id="l11.29" class="difflineplus">+const calAlarmMonitorInterfaces = [</span>
<a href="#l11.30"></a><span id="l11.30" class="difflineplus">+    Components.interfaces.nsIObserver,</span>
<a href="#l11.31"></a><span id="l11.31" class="difflineplus">+    Components.interfaces.calIAlarmServiceObserver</span>
<a href="#l11.32"></a><span id="l11.32" class="difflineplus">+];</span>
<a href="#l11.33"></a><span id="l11.33"> calAlarmMonitor.prototype = {</span>
<a href="#l11.34"></a><span id="l11.34">     mAlarms: null,</span>
<a href="#l11.35"></a><span id="l11.35"> </span>
<a href="#l11.36"></a><span id="l11.36">     // This is a work-around for the fact that there is a delay between when</span>
<a href="#l11.37"></a><span id="l11.37">     // we call openWindow and when it appears via getMostRecentWindow.  If an</span>
<a href="#l11.38"></a><span id="l11.38">     // alarm is fired in that time-frame, it will actually end up in another window.</span>
<a href="#l11.39"></a><span id="l11.39">     mWindowOpening: null,</span>
<a href="#l11.40"></a><span id="l11.40"> </span>
<a href="#l11.41"></a><span id="l11.41">     // nsISound instance used for playing all sounds</span>
<a href="#l11.42"></a><span id="l11.42">     mSound: null,</span>
<a href="#l11.43"></a><span id="l11.43"> </span>
<a href="#l11.44"></a><span id="l11.44" class="difflineminus">-    QueryInterface: function cAM_QueryInterface(aIID) {</span>
<a href="#l11.45"></a><span id="l11.45" class="difflineminus">-        return cal.doQueryInterface(this, calAlarmMonitor.prototype, aIID, null, this);</span>
<a href="#l11.46"></a><span id="l11.46" class="difflineminus">-    },</span>
<a href="#l11.47"></a><span id="l11.47" class="difflineminus">-</span>
<a href="#l11.48"></a><span id="l11.48" class="difflineminus">-    /**</span>
<a href="#l11.49"></a><span id="l11.49" class="difflineminus">-     * nsIClassInfo</span>
<a href="#l11.50"></a><span id="l11.50" class="difflineminus">-     */</span>
<a href="#l11.51"></a><span id="l11.51" class="difflineminus">-    getInterfaces: function cAM_getInterfaces(aCount) {</span>
<a href="#l11.52"></a><span id="l11.52" class="difflineminus">-        let ifaces = [</span>
<a href="#l11.53"></a><span id="l11.53" class="difflineminus">-            Components.interfaces.nsISupports,</span>
<a href="#l11.54"></a><span id="l11.54" class="difflineminus">-            Components.interfaces.nsIObserver,</span>
<a href="#l11.55"></a><span id="l11.55" class="difflineminus">-            Components.interfaces.nsIClassInfo,</span>
<a href="#l11.56"></a><span id="l11.56" class="difflineminus">-            Components.interfaces.calIAlarmServiceObserver</span>
<a href="#l11.57"></a><span id="l11.57" class="difflineminus">-        ];</span>
<a href="#l11.58"></a><span id="l11.58" class="difflineminus">-        aCount.value = ifaces.length;</span>
<a href="#l11.59"></a><span id="l11.59" class="difflineminus">-        return ifaces;</span>
<a href="#l11.60"></a><span id="l11.60" class="difflineminus">-    },</span>
<a href="#l11.61"></a><span id="l11.61" class="difflineminus">-</span>
<a href="#l11.62"></a><span id="l11.62" class="difflineminus">-    getHelperForLanguage: function cAM_getHelperForLanguage(aLanguage) {</span>
<a href="#l11.63"></a><span id="l11.63" class="difflineminus">-        return null;</span>
<a href="#l11.64"></a><span id="l11.64" class="difflineminus">-    },</span>
<a href="#l11.65"></a><span id="l11.65" class="difflineminus">-</span>
<a href="#l11.66"></a><span id="l11.66" class="difflineminus">-    contractID: &quot;@mozilla.org/calendar/alarm-monitor;1&quot;,</span>
<a href="#l11.67"></a><span id="l11.67" class="difflineminus">-    classDescription: &quot;Calendar Alarm Monitor&quot;,</span>
<a href="#l11.68"></a><span id="l11.68" class="difflineminus">-    classID: Components.ID(&quot;{4b7ae030-ed79-11d9-8cd6-0800200c9a66}&quot;),</span>
<a href="#l11.69"></a><span id="l11.69" class="difflineminus">-    implementationLanguage: Components.interfaces.nsIProgrammingLanguage.JAVASCRIPT,</span>
<a href="#l11.70"></a><span id="l11.70" class="difflineminus">-    flags: Components.interfaces.nsIClassInfo.SINGLETON,</span>
<a href="#l11.71"></a><span id="l11.71" class="difflineplus">+    classID: calAlarmMonitorClassID,</span>
<a href="#l11.72"></a><span id="l11.72" class="difflineplus">+    QueryInterface: XPCOMUtils.generateQI(calAlarmMonitorInterfaces),</span>
<a href="#l11.73"></a><span id="l11.73" class="difflineplus">+    classInfo: XPCOMUtils.generateCI({</span>
<a href="#l11.74"></a><span id="l11.74" class="difflineplus">+        contractID: &quot;@mozilla.org/calendar/alarm-monitor;1&quot;,</span>
<a href="#l11.75"></a><span id="l11.75" class="difflineplus">+        classDescription: &quot;Calendar Alarm Monitor&quot;,</span>
<a href="#l11.76"></a><span id="l11.76" class="difflineplus">+        classID: calAlarmMonitorClassID,</span>
<a href="#l11.77"></a><span id="l11.77" class="difflineplus">+        interfaces: calAlarmMonitorInterfaces,</span>
<a href="#l11.78"></a><span id="l11.78" class="difflineplus">+        flags: Components.interfaces.nsIClassInfo.SINGLETON</span>
<a href="#l11.79"></a><span id="l11.79" class="difflineplus">+    }),</span>
<a href="#l11.80"></a><span id="l11.80"> </span>
<a href="#l11.81"></a><span id="l11.81">     /**</span>
<a href="#l11.82"></a><span id="l11.82">      * nsIObserver</span>
<a href="#l11.83"></a><span id="l11.83">      */</span>
<a href="#l11.84"></a><span id="l11.84">     observe: function cAM_observe(aSubject, aTopic, aData) {</span>
<a href="#l11.85"></a><span id="l11.85">         let alarmService = Components.classes[&quot;@mozilla.org/calendar/alarm-service;1&quot;]</span>
<a href="#l11.86"></a><span id="l11.86">                                      .getService(Components.interfaces.calIAlarmService);</span>
<a href="#l11.87"></a><span id="l11.87">         switch (aTopic) {</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l12.1"></a><span id="l12.1" class="difflineminus">--- a/calendar/base/src/calAlarmService.js</span>
<a href="#l12.2"></a><span id="l12.2" class="difflineplus">+++ b/calendar/base/src/calAlarmService.js</span>
<a href="#l12.3"></a><span id="l12.3" class="difflineat">@@ -125,52 +125,39 @@ function calAlarmService() {</span>
<a href="#l12.4"></a><span id="l12.4">             // there may still be dangling items (-&gt; alarm dialog),</span>
<a href="#l12.5"></a><span id="l12.5">             // dismissing those alarms may write data...</span>
<a href="#l12.6"></a><span id="l12.6">             this.alarmService.unobserveCalendar(aCalendar);</span>
<a href="#l12.7"></a><span id="l12.7">         },</span>
<a href="#l12.8"></a><span id="l12.8">         onCalendarDeleting: function(aCalendar) {}</span>
<a href="#l12.9"></a><span id="l12.9">     };</span>
<a href="#l12.10"></a><span id="l12.10"> }</span>
<a href="#l12.11"></a><span id="l12.11"> </span>
<a href="#l12.12"></a><span id="l12.12" class="difflineplus">+const calAlarmServiceClassID = Components.ID(&quot;{7a9200dd-6a64-4fff-a798-c5802186e2cc}&quot;);</span>
<a href="#l12.13"></a><span id="l12.13" class="difflineplus">+const calAlarmServiceInterfaces = [</span>
<a href="#l12.14"></a><span id="l12.14" class="difflineplus">+    Components.interfaces.calIAlarmService,</span>
<a href="#l12.15"></a><span id="l12.15" class="difflineplus">+    Components.interfaces.nsIObserver</span>
<a href="#l12.16"></a><span id="l12.16" class="difflineplus">+];</span>
<a href="#l12.17"></a><span id="l12.17"> calAlarmService.prototype = {</span>
<a href="#l12.18"></a><span id="l12.18">     mRangeStart: null,</span>
<a href="#l12.19"></a><span id="l12.19">     mRangeEnd: null,</span>
<a href="#l12.20"></a><span id="l12.20">     mUpdateTimer: null,</span>
<a href="#l12.21"></a><span id="l12.21">     mStarted: false,</span>
<a href="#l12.22"></a><span id="l12.22">     mTimerMap: null,</span>
<a href="#l12.23"></a><span id="l12.23">     mObservers: null,</span>
<a href="#l12.24"></a><span id="l12.24">     mTimezone: null,</span>
<a href="#l12.25"></a><span id="l12.25"> </span>
<a href="#l12.26"></a><span id="l12.26" class="difflineminus">-    getInterfaces: function cAS_getInterfaces(aCount) {</span>
<a href="#l12.27"></a><span id="l12.27" class="difflineminus">-        let ifaces = [</span>
<a href="#l12.28"></a><span id="l12.28" class="difflineminus">-            Components.interfaces.nsISupports,</span>
<a href="#l12.29"></a><span id="l12.29" class="difflineminus">-            Components.interfaces.calIAlarmService,</span>
<a href="#l12.30"></a><span id="l12.30" class="difflineminus">-            Components.interfaces.nsIObserver,</span>
<a href="#l12.31"></a><span id="l12.31" class="difflineminus">-            Components.interfaces.nsIClassInfo</span>
<a href="#l12.32"></a><span id="l12.32" class="difflineminus">-        ];</span>
<a href="#l12.33"></a><span id="l12.33" class="difflineminus">-        aCount.value = ifaces.length;</span>
<a href="#l12.34"></a><span id="l12.34" class="difflineminus">-        return ifaces;</span>
<a href="#l12.35"></a><span id="l12.35" class="difflineminus">-    },</span>
<a href="#l12.36"></a><span id="l12.36" class="difflineminus">-</span>
<a href="#l12.37"></a><span id="l12.37" class="difflineminus">-    getHelperForLanguage: function cAS_getHelperForLanguage(language) {</span>
<a href="#l12.38"></a><span id="l12.38" class="difflineminus">-        return null;</span>
<a href="#l12.39"></a><span id="l12.39" class="difflineminus">-    },</span>
<a href="#l12.40"></a><span id="l12.40" class="difflineminus">-</span>
<a href="#l12.41"></a><span id="l12.41" class="difflineminus">-    /**</span>
<a href="#l12.42"></a><span id="l12.42" class="difflineminus">-     * nsIClassInfo</span>
<a href="#l12.43"></a><span id="l12.43" class="difflineminus">-     */</span>
<a href="#l12.44"></a><span id="l12.44" class="difflineminus">-    contractID: &quot;@mozilla.org/calendar/alarm-service;1&quot;,</span>
<a href="#l12.45"></a><span id="l12.45" class="difflineminus">-    classDescription: &quot;Calendar Alarm Service&quot;,</span>
<a href="#l12.46"></a><span id="l12.46" class="difflineminus">-    classID: Components.ID(&quot;{7a9200dd-6a64-4fff-a798-c5802186e2cc}&quot;),</span>
<a href="#l12.47"></a><span id="l12.47" class="difflineminus">-    implementationLanguage: Components.interfaces.nsIProgrammingLanguage.JAVASCRIPT,</span>
<a href="#l12.48"></a><span id="l12.48" class="difflineminus">-    flags: Components.interfaces.nsIClassInfo.SINGLETON,</span>
<a href="#l12.49"></a><span id="l12.49" class="difflineminus">-</span>
<a href="#l12.50"></a><span id="l12.50" class="difflineminus">-    QueryInterface: function cAS_QueryInterface(aIID) {</span>
<a href="#l12.51"></a><span id="l12.51" class="difflineminus">-        return doQueryInterface(this, calAlarmService.prototype, aIID, null, this);</span>
<a href="#l12.52"></a><span id="l12.52" class="difflineminus">-    },</span>
<a href="#l12.53"></a><span id="l12.53" class="difflineplus">+    classID: calAlarmServiceClassID,</span>
<a href="#l12.54"></a><span id="l12.54" class="difflineplus">+    QueryInterface: XPCOMUtils.generateQI(calAlarmServiceInterfaces),</span>
<a href="#l12.55"></a><span id="l12.55" class="difflineplus">+    classInfo: XPCOMUtils.generateCI({</span>
<a href="#l12.56"></a><span id="l12.56" class="difflineplus">+        classID: calAlarmServiceClassID,</span>
<a href="#l12.57"></a><span id="l12.57" class="difflineplus">+        contractID: &quot;@mozilla.org/calendar/alarm-service;1&quot;,</span>
<a href="#l12.58"></a><span id="l12.58" class="difflineplus">+        classDescription: &quot;Calendar Alarm Service&quot;,</span>
<a href="#l12.59"></a><span id="l12.59" class="difflineplus">+        interfaces: calAlarmServiceInterfaces,</span>
<a href="#l12.60"></a><span id="l12.60" class="difflineplus">+        flags: Components.interfaces.nsIClassInfo.SINGLETON</span>
<a href="#l12.61"></a><span id="l12.61" class="difflineplus">+    }),</span>
<a href="#l12.62"></a><span id="l12.62"> </span>
<a href="#l12.63"></a><span id="l12.63">     /**</span>
<a href="#l12.64"></a><span id="l12.64">      * nsIObserver</span>
<a href="#l12.65"></a><span id="l12.65">      */</span>
<a href="#l12.66"></a><span id="l12.66">     observe: function cAS_observe(aSubject, aTopic, aData) {</span>
<a href="#l12.67"></a><span id="l12.67">         // This will also be called on app-startup, but nothing is done yet, to</span>
<a href="#l12.68"></a><span id="l12.68">         // prevent unwanted dialogs etc. See bug 325476 and 413296</span>
<a href="#l12.69"></a><span id="l12.69">         if (aTopic == &quot;profile-after-change&quot; || aTopic == &quot;wake_notification&quot;) {</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l13.1"></a><span id="l13.1" class="difflineminus">--- a/calendar/base/src/calAttachment.js</span>
<a href="#l13.2"></a><span id="l13.2" class="difflineplus">+++ b/calendar/base/src/calAttachment.js</span>
<a href="#l13.3"></a><span id="l13.3" class="difflineat">@@ -1,59 +1,38 @@</span>
<a href="#l13.4"></a><span id="l13.4"> /* This Source Code Form is subject to the terms of the Mozilla Public</span>
<a href="#l13.5"></a><span id="l13.5">  * License, v. 2.0. If a copy of the MPL was not distributed with this</span>
<a href="#l13.6"></a><span id="l13.6">  * file, You can obtain one at http://mozilla.org/MPL/2.0/. */</span>
<a href="#l13.7"></a><span id="l13.7"> </span>
<a href="#l13.8"></a><span id="l13.8"> Components.utils.import(&quot;resource://calendar/modules/calUtils.jsm&quot;);</span>
<a href="#l13.9"></a><span id="l13.9"> Components.utils.import(&quot;resource://calendar/modules/calIteratorUtils.jsm&quot;);</span>
<a href="#l13.10"></a><span id="l13.10" class="difflineplus">+Components.utils.import(&quot;resource://gre/modules/XPCOMUtils.jsm&quot;);</span>
<a href="#l13.11"></a><span id="l13.11"> </span>
<a href="#l13.12"></a><span id="l13.12"> //</span>
<a href="#l13.13"></a><span id="l13.13"> // calAttachment.js</span>
<a href="#l13.14"></a><span id="l13.14"> //</span>
<a href="#l13.15"></a><span id="l13.15"> function calAttachment() {</span>
<a href="#l13.16"></a><span id="l13.16">     this.wrappedJSObject = this;</span>
<a href="#l13.17"></a><span id="l13.17">     this.mProperties = new cal.calPropertyBag();</span>
<a href="#l13.18"></a><span id="l13.18"> }</span>
<a href="#l13.19"></a><span id="l13.19"> </span>
<a href="#l13.20"></a><span id="l13.20" class="difflineplus">+const calAttachmentClassID = Components.ID(&quot;{5f76b352-ab75-4c2b-82c9-9206dbbf8571}&quot;);</span>
<a href="#l13.21"></a><span id="l13.21" class="difflineplus">+const calAttachmentInterfaces = [Components.interfaces.calIAttachment];</span>
<a href="#l13.22"></a><span id="l13.22"> calAttachment.prototype = {</span>
<a href="#l13.23"></a><span id="l13.23">     mData: null,</span>
<a href="#l13.24"></a><span id="l13.24">     mHashId: null,</span>
<a href="#l13.25"></a><span id="l13.25"> </span>
<a href="#l13.26"></a><span id="l13.26" class="difflineminus">-    QueryInterface: function (aIID) {</span>
<a href="#l13.27"></a><span id="l13.27" class="difflineminus">-        return cal.doQueryInterface(this,</span>
<a href="#l13.28"></a><span id="l13.28" class="difflineminus">-                                    calAttachment.prototype,</span>
<a href="#l13.29"></a><span id="l13.29" class="difflineminus">-                                    aIID,</span>
<a href="#l13.30"></a><span id="l13.30" class="difflineminus">-                                    null,</span>
<a href="#l13.31"></a><span id="l13.31" class="difflineminus">-                                    this);</span>
<a href="#l13.32"></a><span id="l13.32" class="difflineminus">-    },</span>
<a href="#l13.33"></a><span id="l13.33" class="difflineminus">-</span>
<a href="#l13.34"></a><span id="l13.34" class="difflineminus">-    /**</span>
<a href="#l13.35"></a><span id="l13.35" class="difflineminus">-     * nsIClassInfo</span>
<a href="#l13.36"></a><span id="l13.36" class="difflineminus">-     */</span>
<a href="#l13.37"></a><span id="l13.37" class="difflineminus">-</span>
<a href="#l13.38"></a><span id="l13.38" class="difflineminus">-    getInterfaces: function cA_getInterfaces(aCount) {</span>
<a href="#l13.39"></a><span id="l13.39" class="difflineminus">-        var ifaces = [</span>
<a href="#l13.40"></a><span id="l13.40" class="difflineminus">-            Components.interfaces.nsISupports,</span>
<a href="#l13.41"></a><span id="l13.41" class="difflineminus">-            Components.interfaces.calIAttachment,</span>
<a href="#l13.42"></a><span id="l13.42" class="difflineminus">-            Components.interfaces.nsIClassInfo</span>
<a href="#l13.43"></a><span id="l13.43" class="difflineminus">-        ];</span>
<a href="#l13.44"></a><span id="l13.44" class="difflineminus">-        aCount.value = ifaces.length;</span>
<a href="#l13.45"></a><span id="l13.45" class="difflineminus">-        return ifaces;</span>
<a href="#l13.46"></a><span id="l13.46" class="difflineminus">-    },</span>
<a href="#l13.47"></a><span id="l13.47" class="difflineminus">-</span>
<a href="#l13.48"></a><span id="l13.48" class="difflineminus">-    getHelperForLanguage: function cA_getHelperForLanguage(language) {</span>
<a href="#l13.49"></a><span id="l13.49" class="difflineminus">-        return null;</span>
<a href="#l13.50"></a><span id="l13.50" class="difflineminus">-    },</span>
<a href="#l13.51"></a><span id="l13.51" class="difflineminus">-</span>
<a href="#l13.52"></a><span id="l13.52" class="difflineminus">-    contractID: &quot;@mozilla.org/calendar/attachment;1&quot;,</span>
<a href="#l13.53"></a><span id="l13.53" class="difflineminus">-    classDescription: &quot;Calendar Item Attachment&quot;,</span>
<a href="#l13.54"></a><span id="l13.54" class="difflineminus">-    classID: Components.ID(&quot;{5f76b352-ab75-4c2b-82c9-9206dbbf8571}&quot;),</span>
<a href="#l13.55"></a><span id="l13.55" class="difflineminus">-    implementationLanguage: Components.interfaces.nsIProgrammingLanguage.JAVASCRIPT,</span>
<a href="#l13.56"></a><span id="l13.56" class="difflineminus">-    flags: 0,</span>
<a href="#l13.57"></a><span id="l13.57" class="difflineminus">-</span>
<a href="#l13.58"></a><span id="l13.58" class="difflineplus">+    classID: calAttachmentClassID,</span>
<a href="#l13.59"></a><span id="l13.59" class="difflineplus">+    QueryInterface: XPCOMUtils.generateQI(calAttachmentInterfaces),</span>
<a href="#l13.60"></a><span id="l13.60" class="difflineplus">+    classInfo: XPCOMUtils.generateCI({</span>
<a href="#l13.61"></a><span id="l13.61" class="difflineplus">+        classID: calAttachmentClassID,</span>
<a href="#l13.62"></a><span id="l13.62" class="difflineplus">+        contractID: &quot;@mozilla.org/calendar/attachment;1&quot;,</span>
<a href="#l13.63"></a><span id="l13.63" class="difflineplus">+        classDescription: &quot;Calendar Item Attachment&quot;,</span>
<a href="#l13.64"></a><span id="l13.64" class="difflineplus">+        interfaces: calAttachmentInterfaces</span>
<a href="#l13.65"></a><span id="l13.65" class="difflineplus">+    }),</span>
<a href="#l13.66"></a><span id="l13.66"> </span>
<a href="#l13.67"></a><span id="l13.67">     get hashId() {</span>
<a href="#l13.68"></a><span id="l13.68">         if (!this.mHashId) {</span>
<a href="#l13.69"></a><span id="l13.69">             let ch = Components.classes[&quot;@mozilla.org/security/hash;1&quot;]</span>
<a href="#l13.70"></a><span id="l13.70">                                .createInstance(Components.interfaces.nsICryptoHash);</span>
<a href="#l13.71"></a><span id="l13.71"> </span>
<a href="#l13.72"></a><span id="l13.72">             let converter = Components.classes[&quot;@mozilla.org/intl/scriptableunicodeconverter&quot;]</span>
<a href="#l13.73"></a><span id="l13.73">                                       .createInstance(Components.interfaces.nsIScriptableUnicodeConverter);</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l14.1"></a><span id="l14.1" class="difflineminus">--- a/calendar/base/src/calAttendee.js</span>
<a href="#l14.2"></a><span id="l14.2" class="difflineplus">+++ b/calendar/base/src/calAttendee.js</span>
<a href="#l14.3"></a><span id="l14.3" class="difflineat">@@ -1,43 +1,31 @@</span>
<a href="#l14.4"></a><span id="l14.4"> /* This Source Code Form is subject to the terms of the Mozilla Public</span>
<a href="#l14.5"></a><span id="l14.5">  * License, v. 2.0. If a copy of the MPL was not distributed with this file,</span>
<a href="#l14.6"></a><span id="l14.6">  * You can obtain one at http://mozilla.org/MPL/2.0/. */</span>
<a href="#l14.7"></a><span id="l14.7"> </span>
<a href="#l14.8"></a><span id="l14.8"> Components.utils.import(&quot;resource://calendar/modules/calIteratorUtils.jsm&quot;);</span>
<a href="#l14.9"></a><span id="l14.9" class="difflineplus">+Components.utils.import(&quot;resource://gre/modules/XPCOMUtils.jsm&quot;);</span>
<a href="#l14.10"></a><span id="l14.10"> </span>
<a href="#l14.11"></a><span id="l14.11"> function calAttendee() {</span>
<a href="#l14.12"></a><span id="l14.12">     this.wrappedJSObject = this;</span>
<a href="#l14.13"></a><span id="l14.13">     this.mProperties = new calPropertyBag();</span>
<a href="#l14.14"></a><span id="l14.14"> }</span>
<a href="#l14.15"></a><span id="l14.15"> </span>
<a href="#l14.16"></a><span id="l14.16" class="difflineplus">+const calAttendeeClassID = Components.ID(&quot;{5c8dcaa3-170c-4a73-8142-d531156f664d}&quot;);</span>
<a href="#l14.17"></a><span id="l14.17" class="difflineplus">+const calAttendeeInterfaces = [Components.interfaces.calIAttendee];</span>
<a href="#l14.18"></a><span id="l14.18"> calAttendee.prototype = {</span>
<a href="#l14.19"></a><span id="l14.19" class="difflineminus">-    getInterfaces: function (count) {</span>
<a href="#l14.20"></a><span id="l14.20" class="difflineminus">-        var ifaces = [</span>
<a href="#l14.21"></a><span id="l14.21" class="difflineminus">-            Components.interfaces.nsISupports,</span>
<a href="#l14.22"></a><span id="l14.22" class="difflineminus">-            Components.interfaces.calIAttendee,</span>
<a href="#l14.23"></a><span id="l14.23" class="difflineminus">-            Components.interfaces.nsIClassInfo</span>
<a href="#l14.24"></a><span id="l14.24" class="difflineminus">-        ];</span>
<a href="#l14.25"></a><span id="l14.25" class="difflineminus">-        count.value = ifaces.length;</span>
<a href="#l14.26"></a><span id="l14.26" class="difflineminus">-        return ifaces;</span>
<a href="#l14.27"></a><span id="l14.27" class="difflineminus">-    },</span>
<a href="#l14.28"></a><span id="l14.28" class="difflineminus">-</span>
<a href="#l14.29"></a><span id="l14.29" class="difflineminus">-    getHelperForLanguage: function (language) {</span>
<a href="#l14.30"></a><span id="l14.30" class="difflineminus">-        return null;</span>
<a href="#l14.31"></a><span id="l14.31" class="difflineminus">-    },</span>
<a href="#l14.32"></a><span id="l14.32" class="difflineminus">-</span>
<a href="#l14.33"></a><span id="l14.33" class="difflineminus">-    contractID: &quot;@mozilla.org/calendar/attendee;1&quot;,</span>
<a href="#l14.34"></a><span id="l14.34" class="difflineminus">-    classDescription: &quot;Calendar Attendee&quot;,</span>
<a href="#l14.35"></a><span id="l14.35" class="difflineminus">-    classID: Components.ID(&quot;{5c8dcaa3-170c-4a73-8142-d531156f664d}&quot;),</span>
<a href="#l14.36"></a><span id="l14.36" class="difflineminus">-    implementationLanguage: Components.interfaces.nsIProgrammingLanguage.JAVASCRIPT,</span>
<a href="#l14.37"></a><span id="l14.37" class="difflineminus">-    flags: 0,</span>
<a href="#l14.38"></a><span id="l14.38" class="difflineminus">-</span>
<a href="#l14.39"></a><span id="l14.39" class="difflineminus">-    QueryInterface: function (aIID) {</span>
<a href="#l14.40"></a><span id="l14.40" class="difflineminus">-        return cal.doQueryInterface(this, calAttendee.prototype, aIID, null, this);</span>
<a href="#l14.41"></a><span id="l14.41" class="difflineminus">-    },</span>
<a href="#l14.42"></a><span id="l14.42" class="difflineplus">+    classID: calAttendeeClassID,</span>
<a href="#l14.43"></a><span id="l14.43" class="difflineplus">+    QueryInterface: XPCOMUtils.generateQI(calAttendeeInterfaces),</span>
<a href="#l14.44"></a><span id="l14.44" class="difflineplus">+    classInfo: XPCOMUtils.generateCI({</span>
<a href="#l14.45"></a><span id="l14.45" class="difflineplus">+        classID: calAttendeeClassID,</span>
<a href="#l14.46"></a><span id="l14.46" class="difflineplus">+        contractID: &quot;@mozilla.org/calendar/attendee;1&quot;,</span>
<a href="#l14.47"></a><span id="l14.47" class="difflineplus">+        classDescription: &quot;Calendar Attendee&quot;,</span>
<a href="#l14.48"></a><span id="l14.48" class="difflineplus">+        interfaces: calAttendeeInterfaces</span>
<a href="#l14.49"></a><span id="l14.49" class="difflineplus">+    }),</span>
<a href="#l14.50"></a><span id="l14.50"> </span>
<a href="#l14.51"></a><span id="l14.51">     mImmutable: false,</span>
<a href="#l14.52"></a><span id="l14.52">     get isMutable() { return !this.mImmutable; },</span>
<a href="#l14.53"></a><span id="l14.53"> </span>
<a href="#l14.54"></a><span id="l14.54">     modify: function() {</span>
<a href="#l14.55"></a><span id="l14.55">         if (this.mImmutable) {</span>
<a href="#l14.56"></a><span id="l14.56">             throw Components.results.NS_ERROR_OBJECT_IS_IMMUTABLE;</span>
<a href="#l14.57"></a><span id="l14.57">         }</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l15.1"></a><span id="l15.1" class="difflineminus">--- a/calendar/base/src/calCachedCalendar.js</span>
<a href="#l15.2"></a><span id="l15.2" class="difflineplus">+++ b/calendar/base/src/calCachedCalendar.js</span>
<a href="#l15.3"></a><span id="l15.3" class="difflineat">@@ -1,14 +1,15 @@</span>
<a href="#l15.4"></a><span id="l15.4"> /* This Source Code Form is subject to the terms of the Mozilla Public</span>
<a href="#l15.5"></a><span id="l15.5">  * License, v. 2.0. If a copy of the MPL was not distributed with this</span>
<a href="#l15.6"></a><span id="l15.6">  * file, You can obtain one at http://mozilla.org/MPL/2.0/. */</span>
<a href="#l15.7"></a><span id="l15.7"> </span>
<a href="#l15.8"></a><span id="l15.8"> Components.utils.import(&quot;resource://calendar/modules/calProviderUtils.jsm&quot;);</span>
<a href="#l15.9"></a><span id="l15.9"> Components.utils.import(&quot;resource://gre/modules/Services.jsm&quot;);</span>
<a href="#l15.10"></a><span id="l15.10" class="difflineplus">+Components.utils.import(&quot;resource://gre/modules/XPCOMUtils.jsm&quot;);</span>
<a href="#l15.11"></a><span id="l15.11"> </span>
<a href="#l15.12"></a><span id="l15.12"> const calICalendar = Components.interfaces.calICalendar;</span>
<a href="#l15.13"></a><span id="l15.13"> const cICL = Components.interfaces.calIChangeLog;</span>
<a href="#l15.14"></a><span id="l15.14"> const cIOL = Components.interfaces.calIOperationListener;</span>
<a href="#l15.15"></a><span id="l15.15"> </span>
<a href="#l15.16"></a><span id="l15.16"> let gNoOpListener = {</span>
<a href="#l15.17"></a><span id="l15.17">     onGetResult: function(calendar, status, itemType, detail, count, items) {</span>
<a href="#l15.18"></a><span id="l15.18">     },</span>
<a href="#l15.19"></a><span id="l15.19" class="difflineat">@@ -124,25 +125,26 @@ function calCachedCalendar(uncachedCalen</span>
<a href="#l15.20"></a><span id="l15.20">     if (this.supportsChangeLog) {</span>
<a href="#l15.21"></a><span id="l15.21">         uncachedCalendar.offlineStorage = this.mCachedCalendar;</span>
<a href="#l15.22"></a><span id="l15.22">     }</span>
<a href="#l15.23"></a><span id="l15.23">     this.offlineCachedItems = {};</span>
<a href="#l15.24"></a><span id="l15.24">     this.offlineCachedItemFlags = {};</span>
<a href="#l15.25"></a><span id="l15.25"> }</span>
<a href="#l15.26"></a><span id="l15.26"> calCachedCalendar.prototype = {</span>
<a href="#l15.27"></a><span id="l15.27">     QueryInterface: function cCC_QueryInterface(aIID) {</span>
<a href="#l15.28"></a><span id="l15.28" class="difflineminus">-        if (aIID.equals(Components.interfaces.calISchedulingSupport)) {</span>
<a href="#l15.29"></a><span id="l15.29" class="difflineplus">+        if (aIID.equals(Components.interfaces.calISchedulingSupport) &amp;&amp;</span>
<a href="#l15.30"></a><span id="l15.30" class="difflineplus">+            this.mUncachedCalendar.QueryInterface(aIID)) {</span>
<a href="#l15.31"></a><span id="l15.31">             // check whether uncached calendar supports it:</span>
<a href="#l15.32"></a><span id="l15.32" class="difflineminus">-            if (this.mUncachedCalendar.QueryInterface(aIID)) {</span>
<a href="#l15.33"></a><span id="l15.33" class="difflineminus">-                return this;</span>
<a href="#l15.34"></a><span id="l15.34" class="difflineminus">-            }</span>
<a href="#l15.35"></a><span id="l15.35" class="difflineplus">+            return this;</span>
<a href="#l15.36"></a><span id="l15.36" class="difflineplus">+        } else if (aIID.equals(Components.interfaces.calICalendar) ||</span>
<a href="#l15.37"></a><span id="l15.37" class="difflineplus">+                   aIID.equals(Components.interfaces.nsISupports)) {</span>
<a href="#l15.38"></a><span id="l15.38" class="difflineplus">+            return this;</span>
<a href="#l15.39"></a><span id="l15.39" class="difflineplus">+        } else {</span>
<a href="#l15.40"></a><span id="l15.40" class="difflineplus">+            throw Components.results.NS_ERROR_NO_INTERFACE;</span>
<a href="#l15.41"></a><span id="l15.41">         }</span>
<a href="#l15.42"></a><span id="l15.42" class="difflineminus">-        return cal.doQueryInterface(this, calCachedCalendar.prototype, aIID,</span>
<a href="#l15.43"></a><span id="l15.43" class="difflineminus">-                                    [Components.interfaces.calICalendar,</span>
<a href="#l15.44"></a><span id="l15.44" class="difflineminus">-                                     Components.interfaces.nsISupports]);</span>
<a href="#l15.45"></a><span id="l15.45">     },</span>
<a href="#l15.46"></a><span id="l15.46"> </span>
<a href="#l15.47"></a><span id="l15.47">     mCachedCalendar: null,</span>
<a href="#l15.48"></a><span id="l15.48">     mCachedObserver: null,</span>
<a href="#l15.49"></a><span id="l15.49">     mUncachedCalendar: null,</span>
<a href="#l15.50"></a><span id="l15.50">     mObservers: null,</span>
<a href="#l15.51"></a><span id="l15.51">     mSuperCalendar: null,</span>
<a href="#l15.52"></a><span id="l15.52">     offlineCachedItems: null,</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l16.1"></a><span id="l16.1" class="difflineminus">--- a/calendar/base/src/calCalendarManager.js</span>
<a href="#l16.2"></a><span id="l16.2" class="difflineplus">+++ b/calendar/base/src/calCalendarManager.js</span>
<a href="#l16.3"></a><span id="l16.3" class="difflineat">@@ -11,47 +11,36 @@ const REGISTRY_BRANCH = &quot;calendar.regist</span>
<a href="#l16.4"></a><span id="l16.4"> const DB_SCHEMA_VERSION = 10;</span>
<a href="#l16.5"></a><span id="l16.5"> </span>
<a href="#l16.6"></a><span id="l16.6"> function calCalendarManager() {</span>
<a href="#l16.7"></a><span id="l16.7">     this.wrappedJSObject = this;</span>
<a href="#l16.8"></a><span id="l16.8">     this.mObservers = new calListenerBag(Components.interfaces.calICalendarManagerObserver);</span>
<a href="#l16.9"></a><span id="l16.9">     this.mCalendarObservers = new calListenerBag(Components.interfaces.calIObserver);</span>
<a href="#l16.10"></a><span id="l16.10"> }</span>
<a href="#l16.11"></a><span id="l16.11"> </span>
<a href="#l16.12"></a><span id="l16.12" class="difflineplus">+const calCalendarManagerClassID = Components.ID(&quot;{f42585e7-e736-4600-985d-9624c1c51992}&quot;);</span>
<a href="#l16.13"></a><span id="l16.13" class="difflineplus">+const calCalendarManagerInterfaces = [</span>
<a href="#l16.14"></a><span id="l16.14" class="difflineplus">+    Components.interfaces.calICalendarManager,</span>
<a href="#l16.15"></a><span id="l16.15" class="difflineplus">+    Components.interfaces.calIStartupService,</span>
<a href="#l16.16"></a><span id="l16.16" class="difflineplus">+    Components.interfaces.nsIObserver,</span>
<a href="#l16.17"></a><span id="l16.17" class="difflineplus">+];</span>
<a href="#l16.18"></a><span id="l16.18"> calCalendarManager.prototype = {</span>
<a href="#l16.19"></a><span id="l16.19" class="difflineminus">-    classID: Components.ID(&quot;{f42585e7-e736-4600-985d-9624c1c51992}&quot;),</span>
<a href="#l16.20"></a><span id="l16.20" class="difflineminus">-    QueryInterface: XPCOMUtils.generateQI([</span>
<a href="#l16.21"></a><span id="l16.21" class="difflineminus">-        Components.interfaces.calICalendarManager,</span>
<a href="#l16.22"></a><span id="l16.22" class="difflineminus">-        Components.interfaces.calIStartupService,</span>
<a href="#l16.23"></a><span id="l16.23" class="difflineminus">-        Components.interfaces.nsIObserver,</span>
<a href="#l16.24"></a><span id="l16.24" class="difflineminus">-    ]),</span>
<a href="#l16.25"></a><span id="l16.25" class="difflineminus">-</span>
<a href="#l16.26"></a><span id="l16.26" class="difflineplus">+    classID: calCalendarManagerClassID,</span>
<a href="#l16.27"></a><span id="l16.27" class="difflineplus">+    QueryInterface: XPCOMUtils.generateQI(calCalendarManagerInterfaces),</span>
<a href="#l16.28"></a><span id="l16.28">     classInfo: XPCOMUtils.generateCI({</span>
<a href="#l16.29"></a><span id="l16.29" class="difflineminus">-        classID: Components.ID(&quot;{f42585e7-e736-4600-985d-9624c1c51992}&quot;),</span>
<a href="#l16.30"></a><span id="l16.30" class="difflineplus">+        classID: calCalendarManagerClassID,</span>
<a href="#l16.31"></a><span id="l16.31">         contractID: &quot;@mozilla.org/calendar/manager;1&quot;,</span>
<a href="#l16.32"></a><span id="l16.32">         classDescription: &quot;Calendar Manager&quot;,</span>
<a href="#l16.33"></a><span id="l16.33" class="difflineminus">-        interfaces: [</span>
<a href="#l16.34"></a><span id="l16.34" class="difflineminus">-            Components.interfaces.calICalendarManager,</span>
<a href="#l16.35"></a><span id="l16.35" class="difflineminus">-            Components.interfaces.calIStartupService,</span>
<a href="#l16.36"></a><span id="l16.36" class="difflineminus">-            Components.interfaces.nsIObserver,</span>
<a href="#l16.37"></a><span id="l16.37" class="difflineminus">-        ],</span>
<a href="#l16.38"></a><span id="l16.38" class="difflineplus">+        interfaces: calCalendarManagerInterfaces,</span>
<a href="#l16.39"></a><span id="l16.39">         flags: Components.interfaces.nsIClassInfo.SINGLETON</span>
<a href="#l16.40"></a><span id="l16.40">     }),</span>
<a href="#l16.41"></a><span id="l16.41"> </span>
<a href="#l16.42"></a><span id="l16.42" class="difflineminus">-    get networkCalendarCount() {</span>
<a href="#l16.43"></a><span id="l16.43" class="difflineminus">-        return this.mNetworkCalendarCount;</span>
<a href="#l16.44"></a><span id="l16.44" class="difflineminus">-    },</span>
<a href="#l16.45"></a><span id="l16.45" class="difflineminus">-</span>
<a href="#l16.46"></a><span id="l16.46" class="difflineminus">-    get readOnlyCalendarCount() {</span>
<a href="#l16.47"></a><span id="l16.47" class="difflineminus">-        return this.mReadonlyCalendarCount;</span>
<a href="#l16.48"></a><span id="l16.48" class="difflineminus">-    },</span>
<a href="#l16.49"></a><span id="l16.49" class="difflineminus">-</span>
<a href="#l16.50"></a><span id="l16.50" class="difflineminus">-    get calendarCount() {</span>
<a href="#l16.51"></a><span id="l16.51" class="difflineminus">-        return this.mCalendarCount;</span>
<a href="#l16.52"></a><span id="l16.52" class="difflineminus">-    },</span>
<a href="#l16.53"></a><span id="l16.53" class="difflineplus">+    get networkCalendarCount() this.mNetworkCalendarCount,</span>
<a href="#l16.54"></a><span id="l16.54" class="difflineplus">+    get readOnlyCalendarCount() this.mReadonlyCalendarCount,</span>
<a href="#l16.55"></a><span id="l16.55" class="difflineplus">+    get calendarCount() this.mCalendarCount,</span>
<a href="#l16.56"></a><span id="l16.56"> </span>
<a href="#l16.57"></a><span id="l16.57">     // calIStartupService:</span>
<a href="#l16.58"></a><span id="l16.58">     startup: function ccm_startup(aCompleteListener) {</span>
<a href="#l16.59"></a><span id="l16.59">         AddonManager.addAddonListener(gCalendarManagerAddonListener);</span>
<a href="#l16.60"></a><span id="l16.60">         this.checkAndMigrateDB();</span>
<a href="#l16.61"></a><span id="l16.61">         this.mCache = null;</span>
<a href="#l16.62"></a><span id="l16.62">         this.mCalObservers = null;</span>
<a href="#l16.63"></a><span id="l16.63">         this.mRefreshTimer = {};</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l17.1"></a><span id="l17.1" class="difflineminus">--- a/calendar/base/src/calCalendarSearchService.js</span>
<a href="#l17.2"></a><span id="l17.2" class="difflineplus">+++ b/calendar/base/src/calCalendarSearchService.js</span>
<a href="#l17.3"></a><span id="l17.3" class="difflineat">@@ -43,40 +43,33 @@ calCalendarSearchListener.prototype = {</span>
<a href="#l17.4"></a><span id="l17.4">         }</span>
<a href="#l17.5"></a><span id="l17.5">     }</span>
<a href="#l17.6"></a><span id="l17.6"> };</span>
<a href="#l17.7"></a><span id="l17.7"> </span>
<a href="#l17.8"></a><span id="l17.8"> function calCalendarSearchService() {</span>
<a href="#l17.9"></a><span id="l17.9">     this.wrappedJSObject = this;</span>
<a href="#l17.10"></a><span id="l17.10">     this.mProviders = new calInterfaceBag(Components.interfaces.calICalendarSearchProvider);</span>
<a href="#l17.11"></a><span id="l17.11"> }</span>
<a href="#l17.12"></a><span id="l17.12" class="difflineplus">+const calCalendarSearchServiceClassID = Components.ID(&quot;{f5f743cd-8997-428e-bc1b-644e73f61203}&quot;);</span>
<a href="#l17.13"></a><span id="l17.13" class="difflineplus">+const calCalendarSearchServiceInterfaces = [</span>
<a href="#l17.14"></a><span id="l17.14" class="difflineplus">+    Components.interfaces.calICalendarSearchProvider,</span>
<a href="#l17.15"></a><span id="l17.15" class="difflineplus">+    Components.interfaces.calICalendarSearchService</span>
<a href="#l17.16"></a><span id="l17.16" class="difflineplus">+];</span>
<a href="#l17.17"></a><span id="l17.17"> calCalendarSearchService.prototype = {</span>
<a href="#l17.18"></a><span id="l17.18">     mProviders: null,</span>
<a href="#l17.19"></a><span id="l17.19"> </span>
<a href="#l17.20"></a><span id="l17.20" class="difflineminus">-    QueryInterface: function calCalendarSearchService_QueryInterface(aIID) {</span>
<a href="#l17.21"></a><span id="l17.21" class="difflineminus">-        return doQueryInterface(this, calCalendarSearchService.prototype, aIID, null, this);</span>
<a href="#l17.22"></a><span id="l17.22" class="difflineminus">-    },</span>
<a href="#l17.23"></a><span id="l17.23" class="difflineminus">-</span>
<a href="#l17.24"></a><span id="l17.24" class="difflineminus">-    // nsIClassInfo:</span>
<a href="#l17.25"></a><span id="l17.25" class="difflineminus">-    getInterfaces: function calCalendarSearchService_getInterfaces(count) {</span>
<a href="#l17.26"></a><span id="l17.26" class="difflineminus">-        const ifaces = [Components.interfaces.nsISupports,</span>
<a href="#l17.27"></a><span id="l17.27" class="difflineminus">-                        Components.interfaces.calICalendarSearchProvider,</span>
<a href="#l17.28"></a><span id="l17.28" class="difflineminus">-                        Components.interfaces.calICalendarSearchService,</span>
<a href="#l17.29"></a><span id="l17.29" class="difflineminus">-                        Components.interfaces.nsIClassInfo];</span>
<a href="#l17.30"></a><span id="l17.30" class="difflineminus">-        count.value = ifaces.length;</span>
<a href="#l17.31"></a><span id="l17.31" class="difflineminus">-        return ifaces;</span>
<a href="#l17.32"></a><span id="l17.32" class="difflineminus">-    },</span>
<a href="#l17.33"></a><span id="l17.33" class="difflineminus">-    getHelperForLanguage: function calCalendarSearchService_getHelperForLanguage(language) {</span>
<a href="#l17.34"></a><span id="l17.34" class="difflineminus">-        return null;</span>
<a href="#l17.35"></a><span id="l17.35" class="difflineminus">-    },</span>
<a href="#l17.36"></a><span id="l17.36" class="difflineminus">-    contractID: &quot;@mozilla.org/calendar/calendarsearch-service;1&quot;,</span>
<a href="#l17.37"></a><span id="l17.37" class="difflineminus">-    classDescription: &quot;Calendar Search Service&quot;,</span>
<a href="#l17.38"></a><span id="l17.38" class="difflineminus">-    classID: Components.ID(&quot;{f5f743cd-8997-428e-bc1b-644e73f61203}&quot;),</span>
<a href="#l17.39"></a><span id="l17.39" class="difflineminus">-    implementationLanguage: Components.interfaces.nsIProgrammingLanguage.JAVASCRIPT,</span>
<a href="#l17.40"></a><span id="l17.40" class="difflineminus">-    flags: Components.interfaces.nsIClassInfo.SINGLETON,</span>
<a href="#l17.41"></a><span id="l17.41" class="difflineplus">+    classID: calCalendarSearchServiceClassID,</span>
<a href="#l17.42"></a><span id="l17.42" class="difflineplus">+    QueryInterface: XPCOMUtils.generateQI(calCalendarSearchServiceInterfaces),</span>
<a href="#l17.43"></a><span id="l17.43" class="difflineplus">+    classInfo: XPCOMUtils.generateCI({</span>
<a href="#l17.44"></a><span id="l17.44" class="difflineplus">+        classID: calCalendarSearchServiceClassID,</span>
<a href="#l17.45"></a><span id="l17.45" class="difflineplus">+        contractID: &quot;@mozilla.org/calendar/calendarsearch-service;1&quot;,</span>
<a href="#l17.46"></a><span id="l17.46" class="difflineplus">+        classDescription: &quot;Calendar Search Service&quot;,</span>
<a href="#l17.47"></a><span id="l17.47" class="difflineplus">+        interfaces: calCalendarSearchServiceInterfaces,</span>
<a href="#l17.48"></a><span id="l17.48" class="difflineplus">+        flags: Components.interfaces.nsIClassInfo.SINGLETON</span>
<a href="#l17.49"></a><span id="l17.49" class="difflineplus">+    }),</span>
<a href="#l17.50"></a><span id="l17.50"> </span>
<a href="#l17.51"></a><span id="l17.51">     // calICalendarSearchProvider:</span>
<a href="#l17.52"></a><span id="l17.52">     searchForCalendars: function calCalendarSearchService_searchForCalendars(aString,</span>
<a href="#l17.53"></a><span id="l17.53">                                                                              aHints,</span>
<a href="#l17.54"></a><span id="l17.54">                                                                              aMaxResults,</span>
<a href="#l17.55"></a><span id="l17.55">                                                                              aListener) {</span>
<a href="#l17.56"></a><span id="l17.56">         var groupListener = new calCalendarSearchListener(this.mProviders.size, aListener);</span>
<a href="#l17.57"></a><span id="l17.57">         function searchForCalendars_(provider) {</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l18.1"></a><span id="l18.1" class="difflineminus">--- a/calendar/base/src/calDateTimeFormatter.js</span>
<a href="#l18.2"></a><span id="l18.2" class="difflineplus">+++ b/calendar/base/src/calDateTimeFormatter.js</span>
<a href="#l18.3"></a><span id="l18.3" class="difflineat">@@ -1,17 +1,19 @@</span>
<a href="#l18.4"></a><span id="l18.4"> /* This Source Code Form is subject to the terms of the Mozilla Public</span>
<a href="#l18.5"></a><span id="l18.5">  * License, v. 2.0. If a copy of the MPL was not distributed with this</span>
<a href="#l18.6"></a><span id="l18.6">  * file, You can obtain one at http://mozilla.org/MPL/2.0/. */</span>
<a href="#l18.7"></a><span id="l18.7"> </span>
<a href="#l18.8"></a><span id="l18.8"> Components.utils.import(&quot;resource://gre/modules/Services.jsm&quot;);</span>
<a href="#l18.9"></a><span id="l18.9" class="difflineplus">+Components.utils.import(&quot;resource://gre/modules/XPCOMUtils.jsm&quot;);</span>
<a href="#l18.10"></a><span id="l18.10"> </span>
<a href="#l18.11"></a><span id="l18.11"> const nsIScriptableDateFormat = Components.interfaces.nsIScriptableDateFormat;</span>
<a href="#l18.12"></a><span id="l18.12"> </span>
<a href="#l18.13"></a><span id="l18.13"> function calDateTimeFormatter() {</span>
<a href="#l18.14"></a><span id="l18.14" class="difflineplus">+    this.wrappedJSObject = this;</span>
<a href="#l18.15"></a><span id="l18.15">     this.mDateStringBundle = Services.strings.createBundle(&quot;chrome://calendar/locale/dateFormat.properties&quot;);</span>
<a href="#l18.16"></a><span id="l18.16"> </span>
<a href="#l18.17"></a><span id="l18.17">     this.mDateService =</span>
<a href="#l18.18"></a><span id="l18.18">         Components.classes[&quot;@mozilla.org/intl/scriptabledateformat;1&quot;]</span>
<a href="#l18.19"></a><span id="l18.19">                   .getService(nsIScriptableDateFormat);</span>
<a href="#l18.20"></a><span id="l18.20"> </span>
<a href="#l18.21"></a><span id="l18.21">     // Do does the month or day come first in this locale?</span>
<a href="#l18.22"></a><span id="l18.22">     this.mMonthFirst = false;</span>
<a href="#l18.23"></a><span id="l18.23" class="difflineat">@@ -57,39 +59,27 @@ function calDateTimeFormatter() {</span>
<a href="#l18.24"></a><span id="l18.24">         if (longProbeString == null ||</span>
<a href="#l18.25"></a><span id="l18.25">             longProbeString.length &lt; 4 ||</span>
<a href="#l18.26"></a><span id="l18.26">             longProbeString == probeStringA)</span>
<a href="#l18.27"></a><span id="l18.27">            this.mUseLongDateService = false;</span>
<a href="#l18.28"></a><span id="l18.28">     } catch (e) {</span>
<a href="#l18.29"></a><span id="l18.29">         this.mUseLongDateService = false;</span>
<a href="#l18.30"></a><span id="l18.30">     }</span>
<a href="#l18.31"></a><span id="l18.31"> }</span>
<a href="#l18.32"></a><span id="l18.32" class="difflineminus">-</span>
<a href="#l18.33"></a><span id="l18.33" class="difflineplus">+const calDateTimeFormatterClassID = Components.ID(&quot;{4123da9a-f047-42da-a7d0-cc4175b9f36a}&quot;);</span>
<a href="#l18.34"></a><span id="l18.34" class="difflineplus">+const calDateTimeFormatterInterfaces = [Components.interfaces.calIDateTimeFormatter];</span>
<a href="#l18.35"></a><span id="l18.35"> calDateTimeFormatter.prototype = {</span>
<a href="#l18.36"></a><span id="l18.36" class="difflineminus">-    getInterfaces: function getInterfaces(aCount) {</span>
<a href="#l18.37"></a><span id="l18.37" class="difflineminus">-        const interfaces = [Components.interfaces.calIDateTimeFormatter,</span>
<a href="#l18.38"></a><span id="l18.38" class="difflineminus">-                            Components.interfaces.nsIClassInfo,</span>
<a href="#l18.39"></a><span id="l18.39" class="difflineminus">-                            Components.interfaces.nsISupports];</span>
<a href="#l18.40"></a><span id="l18.40" class="difflineminus">-</span>
<a href="#l18.41"></a><span id="l18.41" class="difflineminus">-        aCount.value = interfaces.length;</span>
<a href="#l18.42"></a><span id="l18.42" class="difflineminus">-        return interfaces;</span>
<a href="#l18.43"></a><span id="l18.43" class="difflineminus">-    },</span>
<a href="#l18.44"></a><span id="l18.44" class="difflineminus">-</span>
<a href="#l18.45"></a><span id="l18.45" class="difflineminus">-    getHelperForLanguage: function cA_getHelperForLanguage(aLang) {</span>
<a href="#l18.46"></a><span id="l18.46" class="difflineminus">-        return null;</span>
<a href="#l18.47"></a><span id="l18.47" class="difflineminus">-    },</span>
<a href="#l18.48"></a><span id="l18.48" class="difflineminus">-    contractID: &quot;@mozilla.org/calendar/datetime-formatter;1&quot;,</span>
<a href="#l18.49"></a><span id="l18.49" class="difflineminus">-    classDescription: &quot;Formats Dates and Times&quot;,</span>
<a href="#l18.50"></a><span id="l18.50" class="difflineminus">-    classID: Components.ID(&quot;{4123da9a-f047-42da-a7d0-cc4175b9f36a}&quot;),</span>
<a href="#l18.51"></a><span id="l18.51" class="difflineminus">-    implementationLanguage: Components.interfaces.nsIProgrammingLanguage.JAVASCRIPT,</span>
<a href="#l18.52"></a><span id="l18.52" class="difflineminus">-    flags: 0,</span>
<a href="#l18.53"></a><span id="l18.53" class="difflineminus">-</span>
<a href="#l18.54"></a><span id="l18.54" class="difflineminus">-    QueryInterface: function QueryInterface(aIID) {</span>
<a href="#l18.55"></a><span id="l18.55" class="difflineminus">-        return cal.doQueryInterface(this, calDateTimeFormatter.prototype, aIID, null, this);</span>
<a href="#l18.56"></a><span id="l18.56" class="difflineminus">-    },</span>
<a href="#l18.57"></a><span id="l18.57" class="difflineplus">+    classID: calDateTimeFormatterClassID,</span>
<a href="#l18.58"></a><span id="l18.58" class="difflineplus">+    QueryInterface: XPCOMUtils.generateQI(calDateTimeFormatterInterfaces),</span>
<a href="#l18.59"></a><span id="l18.59" class="difflineplus">+    classInfo: XPCOMUtils.generateCI({</span>
<a href="#l18.60"></a><span id="l18.60" class="difflineplus">+        classID: calDateTimeFormatterClassID,</span>
<a href="#l18.61"></a><span id="l18.61" class="difflineplus">+        contractID: &quot;@mozilla.org/calendar/datetime-formatter;1&quot;,</span>
<a href="#l18.62"></a><span id="l18.62" class="difflineplus">+        classDescription: &quot;Formats Dates and Times&quot;,</span>
<a href="#l18.63"></a><span id="l18.63" class="difflineplus">+        interfaces: calDateTimeFormatterInterfaces,</span>
<a href="#l18.64"></a><span id="l18.64" class="difflineplus">+    }),</span>
<a href="#l18.65"></a><span id="l18.65"> </span>
<a href="#l18.66"></a><span id="l18.66">     formatDate: function formatDate(aDate) {</span>
<a href="#l18.67"></a><span id="l18.67">         // Format the date using user's format preference (long or short)</span>
<a href="#l18.68"></a><span id="l18.68">         let format = cal.getPrefSafe(&quot;calendar.date.format&quot;, 0);</span>
<a href="#l18.69"></a><span id="l18.69">         return (format == 0 ? this.formatDateLong(aDate) : this.formatDateShort(aDate));</span>
<a href="#l18.70"></a><span id="l18.70">     },</span>
<a href="#l18.71"></a><span id="l18.71"> </span>
<a href="#l18.72"></a><span id="l18.72">     formatDateShort: function formatDateShort(aDate) {</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l19.1"></a><span id="l19.1" class="difflineminus">--- a/calendar/base/src/calDefaultACLManager.js</span>
<a href="#l19.2"></a><span id="l19.2" class="difflineplus">+++ b/calendar/base/src/calDefaultACLManager.js</span>
<a href="#l19.3"></a><span id="l19.3" class="difflineat">@@ -7,30 +7,30 @@ Components.utils.import(&quot;resource://gre/</span>
<a href="#l19.4"></a><span id="l19.4"> </span>
<a href="#l19.5"></a><span id="l19.5"> Components.utils.import(&quot;resource://calendar/modules/calUtils.jsm&quot;);</span>
<a href="#l19.6"></a><span id="l19.6"> </span>
<a href="#l19.7"></a><span id="l19.7"> /* calDefaultACLManager */</span>
<a href="#l19.8"></a><span id="l19.8"> function calDefaultACLManager() {</span>
<a href="#l19.9"></a><span id="l19.9">     this.mCalendarEntries = {};</span>
<a href="#l19.10"></a><span id="l19.10"> }</span>
<a href="#l19.11"></a><span id="l19.11"> </span>
<a href="#l19.12"></a><span id="l19.12" class="difflineplus">+const calDefaultACLManagerClassID = Components.ID(&quot;{7463258c-6ef3-40a2-89a9-bb349596e927}&quot;);</span>
<a href="#l19.13"></a><span id="l19.13" class="difflineplus">+const calDefaultACLManagerInterfaces = [Components.interfaces.calICalendarACLManager];</span>
<a href="#l19.14"></a><span id="l19.14"> calDefaultACLManager.prototype = {</span>
<a href="#l19.15"></a><span id="l19.15">     mCalendarEntries: null,</span>
<a href="#l19.16"></a><span id="l19.16"> </span>
<a href="#l19.17"></a><span id="l19.17" class="difflineminus">-    /* nsISupports */</span>
<a href="#l19.18"></a><span id="l19.18" class="difflineminus">-    classID: Components.ID(&quot;{7463258c-6ef3-40a2-89a9-bb349596e927}&quot;),</span>
<a href="#l19.19"></a><span id="l19.19" class="difflineminus">-    QueryInterface: XPCOMUtils.generateQI([Components.interfaces.calICalendarACLManager]),</span>
<a href="#l19.20"></a><span id="l19.20" class="difflineminus">-</span>
<a href="#l19.21"></a><span id="l19.21" class="difflineminus">-    /* nsIClassInfo */</span>
<a href="#l19.22"></a><span id="l19.22" class="difflineplus">+    /* nsISupports, nsIClassInfo */</span>
<a href="#l19.23"></a><span id="l19.23" class="difflineplus">+    classID: calDefaultACLManagerClassID,</span>
<a href="#l19.24"></a><span id="l19.24" class="difflineplus">+    QueryInterface: XPCOMUtils.generateQI(calDefaultACLManagerInterfaces),</span>
<a href="#l19.25"></a><span id="l19.25">     classInfo: XPCOMUtils.generateCI({</span>
<a href="#l19.26"></a><span id="l19.26" class="difflineminus">-        classID: Components.ID(&quot;{7463258c-6ef3-40a2-89a9-bb349596e927}&quot;),</span>
<a href="#l19.27"></a><span id="l19.27" class="difflineplus">+        classID: calDefaultACLManagerClassID,</span>
<a href="#l19.28"></a><span id="l19.28">         contractID: &quot;@mozilla.org/calendar/acl-manager;1?type=default&quot;,</span>
<a href="#l19.29"></a><span id="l19.29">         classDescription: &quot;Default Calendar ACL Provider&quot;,</span>
<a href="#l19.30"></a><span id="l19.30" class="difflineminus">-        interfaces: [Components.interfaces.calICalendarACLManager],</span>
<a href="#l19.31"></a><span id="l19.31" class="difflineminus">-        flags: Components.interfaces.nsIClassInfo.SINGLETON,</span>
<a href="#l19.32"></a><span id="l19.32" class="difflineplus">+        interfaces: calDefaultACLManagerInterfaces,</span>
<a href="#l19.33"></a><span id="l19.33" class="difflineplus">+        flags: Components.interfaces.nsIClassInfo.SINGLETON</span>
<a href="#l19.34"></a><span id="l19.34">     }),</span>
<a href="#l19.35"></a><span id="l19.35"> </span>
<a href="#l19.36"></a><span id="l19.36">     /* calICalendarACLManager */</span>
<a href="#l19.37"></a><span id="l19.37">     _getCalendarEntryCached: function cDACLM__getCalendarEntryCached(aCalendar) {</span>
<a href="#l19.38"></a><span id="l19.38">         let calUri = aCalendar.uri.spec;</span>
<a href="#l19.39"></a><span id="l19.39">         if (!(calUri in this.mCalendarEntries)) {</span>
<a href="#l19.40"></a><span id="l19.40">             this.mCalendarEntries[calUri] = new calDefaultCalendarACLEntry(this, aCalendar);</span>
<a href="#l19.41"></a><span id="l19.41">         }</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l20.1"></a><span id="l20.1" class="difflineminus">--- a/calendar/base/src/calDeletedItems.js</span>
<a href="#l20.2"></a><span id="l20.2" class="difflineplus">+++ b/calendar/base/src/calDeletedItems.js</span>
<a href="#l20.3"></a><span id="l20.3" class="difflineat">@@ -9,32 +9,35 @@ Components.utils.import(&quot;resource:///mod</span>
<a href="#l20.4"></a><span id="l20.4"> /**</span>
<a href="#l20.5"></a><span id="l20.5">  * Handles remembering deleted items.</span>
<a href="#l20.6"></a><span id="l20.6">  *</span>
<a href="#l20.7"></a><span id="l20.7">  * This is (currently) not a real trashcan. Only ids and time deleted is stored.</span>
<a href="#l20.8"></a><span id="l20.8">  * Note also that the code doesn't strictly check the calendar of the item,</span>
<a href="#l20.9"></a><span id="l20.9">  * except when a calendar id is passed to getDeletedDate.</span>
<a href="#l20.10"></a><span id="l20.10">  */</span>
<a href="#l20.11"></a><span id="l20.11"> function calDeletedItems() {</span>
<a href="#l20.12"></a><span id="l20.12" class="difflineplus">+    this.wrappedJSObject = this;</span>
<a href="#l20.13"></a><span id="l20.13"> }</span>
<a href="#l20.14"></a><span id="l20.14"> </span>
<a href="#l20.15"></a><span id="l20.15" class="difflineplus">+const calDeletedItemsClassID = Components.ID(&quot;{8e6799af-e7e9-4e6c-9a82-a2413e86d8c3}&quot;);</span>
<a href="#l20.16"></a><span id="l20.16" class="difflineplus">+const calDeletedItemsInterfaces = [</span>
<a href="#l20.17"></a><span id="l20.17" class="difflineplus">+    Components.interfaces.calIDeletedItems,</span>
<a href="#l20.18"></a><span id="l20.18" class="difflineplus">+    Components.interfaces.nsIObserver,</span>
<a href="#l20.19"></a><span id="l20.19" class="difflineplus">+    Components.interfaces.calIObserver</span>
<a href="#l20.20"></a><span id="l20.20" class="difflineplus">+];</span>
<a href="#l20.21"></a><span id="l20.21"> calDeletedItems.prototype = {</span>
<a href="#l20.22"></a><span id="l20.22"> </span>
<a href="#l20.23"></a><span id="l20.23" class="difflineminus">-    classID: Components.ID(&quot;{8e6799af-e7e9-4e6c-9a82-a2413e86d8c3}&quot;),</span>
<a href="#l20.24"></a><span id="l20.24" class="difflineminus">-    QueryInterface: XPCOMUtils.generateQI([Components.interfaces.calIDeletedItems,</span>
<a href="#l20.25"></a><span id="l20.25" class="difflineminus">-                                           Components.interfaces.nsIObserver,</span>
<a href="#l20.26"></a><span id="l20.26" class="difflineminus">-                                           Components.interfaces.calIObserver]),</span>
<a href="#l20.27"></a><span id="l20.27" class="difflineplus">+    classID: calDeletedItemsClassID,</span>
<a href="#l20.28"></a><span id="l20.28" class="difflineplus">+    QueryInterface: XPCOMUtils.generateQI(calDeletedItemsInterfaces),</span>
<a href="#l20.29"></a><span id="l20.29">     classInfo: XPCOMUtils.generateCI({</span>
<a href="#l20.30"></a><span id="l20.30" class="difflineminus">-        classID: Components.ID(&quot;{8e6799af-e7e9-4e6c-9a82-a2413e86d8c3}&quot;),</span>
<a href="#l20.31"></a><span id="l20.31" class="difflineplus">+        classID: calDeletedItemsClassID,</span>
<a href="#l20.32"></a><span id="l20.32">         contractID: &quot;@mozilla.org/calendar/deleted-items-manager;1&quot;,</span>
<a href="#l20.33"></a><span id="l20.33">         classDescription: &quot;Database containing information about deleted items&quot;,</span>
<a href="#l20.34"></a><span id="l20.34" class="difflineminus">-        interfaces: [Components.interfaces.calIDeletedItems,</span>
<a href="#l20.35"></a><span id="l20.35" class="difflineminus">-                     Components.interfaces.nsIObserver,</span>
<a href="#l20.36"></a><span id="l20.36" class="difflineminus">-                     Components.interfaces.calIObserver],</span>
<a href="#l20.37"></a><span id="l20.37" class="difflineminus">-        flags: Components.interfaces.nsIClassInfo.SINGLETON,</span>
<a href="#l20.38"></a><span id="l20.38" class="difflineplus">+        interfaces: calDeletedItemsInterfaces,</span>
<a href="#l20.39"></a><span id="l20.39" class="difflineplus">+        flags: Components.interfaces.nsIClassInfo.SINGLETON</span>
<a href="#l20.40"></a><span id="l20.40">     }),</span>
<a href="#l20.41"></a><span id="l20.41"> </span>
<a href="#l20.42"></a><span id="l20.42">     DB_SCHEMA_VERSION: 1,</span>
<a href="#l20.43"></a><span id="l20.43">     STALE_TIME: 30 * 24 * 60 * 60 / 1000, /* 30 days */</span>
<a href="#l20.44"></a><span id="l20.44"> </span>
<a href="#l20.45"></a><span id="l20.45">     flush: function flush() {</span>
<a href="#l20.46"></a><span id="l20.46">         this.ensureStatements();</span>
<a href="#l20.47"></a><span id="l20.47">         this.stmtFlush.params.stale_time = cal.now().nativeTime - this.STALE_TIME;</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l21.1"></a><span id="l21.1" class="difflineminus">--- a/calendar/base/src/calEvent.js</span>
<a href="#l21.2"></a><span id="l21.2" class="difflineplus">+++ b/calendar/base/src/calEvent.js</span>
<a href="#l21.3"></a><span id="l21.3" class="difflineat">@@ -1,55 +1,44 @@</span>
<a href="#l21.4"></a><span id="l21.4"> /* This Source Code Form is subject to the terms of the Mozilla Public</span>
<a href="#l21.5"></a><span id="l21.5">  * License, v. 2.0. If a copy of the MPL was not distributed with this</span>
<a href="#l21.6"></a><span id="l21.6">  * file, You can obtain one at http://mozilla.org/MPL/2.0/. */</span>
<a href="#l21.7"></a><span id="l21.7"> </span>
<a href="#l21.8"></a><span id="l21.8"> Components.utils.import(&quot;resource://calendar/modules/calUtils.jsm&quot;);</span>
<a href="#l21.9"></a><span id="l21.9" class="difflineplus">+Components.utils.import(&quot;resource://gre/modules/XPCOMUtils.jsm&quot;);</span>
<a href="#l21.10"></a><span id="l21.10"> </span>
<a href="#l21.11"></a><span id="l21.11"> //</span>
<a href="#l21.12"></a><span id="l21.12"> // constructor</span>
<a href="#l21.13"></a><span id="l21.13"> //</span>
<a href="#l21.14"></a><span id="l21.14"> function calEvent() {</span>
<a href="#l21.15"></a><span id="l21.15">     this.initItemBase();</span>
<a href="#l21.16"></a><span id="l21.16"> </span>
<a href="#l21.17"></a><span id="l21.17">     this.eventPromotedProps = {</span>
<a href="#l21.18"></a><span id="l21.18">         &quot;DTSTART&quot;: true,</span>
<a href="#l21.19"></a><span id="l21.19">         &quot;DTEND&quot;: true,</span>
<a href="#l21.20"></a><span id="l21.20">         __proto__: this.itemBasePromotedProps</span>
<a href="#l21.21"></a><span id="l21.21">     }</span>
<a href="#l21.22"></a><span id="l21.22"> }</span>
<a href="#l21.23"></a><span id="l21.23" class="difflineminus">-</span>
<a href="#l21.24"></a><span id="l21.24" class="difflineplus">+const calEventClassID = Components.ID(&quot;{974339d5-ab86-4491-aaaf-2b2ca177c12b}&quot;);</span>
<a href="#l21.25"></a><span id="l21.25" class="difflineplus">+const calEventInterfaces = [</span>
<a href="#l21.26"></a><span id="l21.26" class="difflineplus">+    Components.interfaces.calIItemBase,</span>
<a href="#l21.27"></a><span id="l21.27" class="difflineplus">+    Components.interfaces.calIEvent,</span>
<a href="#l21.28"></a><span id="l21.28" class="difflineplus">+    Components.interfaces.calIInternalShallowCopy</span>
<a href="#l21.29"></a><span id="l21.29" class="difflineplus">+];</span>
<a href="#l21.30"></a><span id="l21.30"> calEvent.prototype = {</span>
<a href="#l21.31"></a><span id="l21.31">     __proto__: calItemBase.prototype,</span>
<a href="#l21.32"></a><span id="l21.32"> </span>
<a href="#l21.33"></a><span id="l21.33" class="difflineminus">-    getInterfaces: function (count) {</span>
<a href="#l21.34"></a><span id="l21.34" class="difflineminus">-        var ifaces = [</span>
<a href="#l21.35"></a><span id="l21.35" class="difflineminus">-            Components.interfaces.nsISupports,</span>
<a href="#l21.36"></a><span id="l21.36" class="difflineminus">-            Components.interfaces.calIItemBase,</span>
<a href="#l21.37"></a><span id="l21.37" class="difflineminus">-            Components.interfaces.calIEvent,</span>
<a href="#l21.38"></a><span id="l21.38" class="difflineminus">-            Components.interfaces.calIInternalShallowCopy,</span>
<a href="#l21.39"></a><span id="l21.39" class="difflineminus">-            Components.interfaces.nsIClassInfo</span>
<a href="#l21.40"></a><span id="l21.40" class="difflineminus">-        ];</span>
<a href="#l21.41"></a><span id="l21.41" class="difflineminus">-        count.value = ifaces.length;</span>
<a href="#l21.42"></a><span id="l21.42" class="difflineminus">-        return ifaces;</span>
<a href="#l21.43"></a><span id="l21.43" class="difflineminus">-    },</span>
<a href="#l21.44"></a><span id="l21.44" class="difflineminus">-</span>
<a href="#l21.45"></a><span id="l21.45" class="difflineminus">-    getHelperForLanguage: function (language) {</span>
<a href="#l21.46"></a><span id="l21.46" class="difflineminus">-        return null;</span>
<a href="#l21.47"></a><span id="l21.47" class="difflineminus">-    },</span>
<a href="#l21.48"></a><span id="l21.48" class="difflineminus">-</span>
<a href="#l21.49"></a><span id="l21.49" class="difflineminus">-    contractID: &quot;@mozilla.org/calendar/event;1&quot;,</span>
<a href="#l21.50"></a><span id="l21.50" class="difflineminus">-    classDescription: &quot;Calendar Event&quot;,</span>
<a href="#l21.51"></a><span id="l21.51" class="difflineminus">-    classID: Components.ID(&quot;{974339d5-ab86-4491-aaaf-2b2ca177c12b}&quot;),</span>
<a href="#l21.52"></a><span id="l21.52" class="difflineminus">-    implementationLanguage: Components.interfaces.nsIProgrammingLanguage.JAVASCRIPT,</span>
<a href="#l21.53"></a><span id="l21.53" class="difflineminus">-    flags: 0,</span>
<a href="#l21.54"></a><span id="l21.54" class="difflineminus">-</span>
<a href="#l21.55"></a><span id="l21.55" class="difflineminus">-    QueryInterface: function (aIID) {</span>
<a href="#l21.56"></a><span id="l21.56" class="difflineminus">-        return cal.doQueryInterface(this, calEvent.prototype, aIID, null, this);</span>
<a href="#l21.57"></a><span id="l21.57" class="difflineminus">-    },</span>
<a href="#l21.58"></a><span id="l21.58" class="difflineplus">+    classID: calEventClassID,</span>
<a href="#l21.59"></a><span id="l21.59" class="difflineplus">+    QueryInterface: XPCOMUtils.generateQI(calEventInterfaces),</span>
<a href="#l21.60"></a><span id="l21.60" class="difflineplus">+    classInfo: XPCOMUtils.generateCI({</span>
<a href="#l21.61"></a><span id="l21.61" class="difflineplus">+        classID: calEventClassID,</span>
<a href="#l21.62"></a><span id="l21.62" class="difflineplus">+        contractID: &quot;@mozilla.org/calendar/event;1&quot;,</span>
<a href="#l21.63"></a><span id="l21.63" class="difflineplus">+        classDescription: &quot;Calendar Event&quot;,</span>
<a href="#l21.64"></a><span id="l21.64" class="difflineplus">+        interfaces: calEventInterfaces</span>
<a href="#l21.65"></a><span id="l21.65" class="difflineplus">+    }),</span>
<a href="#l21.66"></a><span id="l21.66"> </span>
<a href="#l21.67"></a><span id="l21.67">     cloneShallow: function (aNewParent) {</span>
<a href="#l21.68"></a><span id="l21.68">         let m = new calEvent();</span>
<a href="#l21.69"></a><span id="l21.69">         this.cloneItemBaseInto(m, aNewParent);</span>
<a href="#l21.70"></a><span id="l21.70">         return m;</span>
<a href="#l21.71"></a><span id="l21.71">     },</span>
<a href="#l21.72"></a><span id="l21.72"> </span>
<a href="#l21.73"></a><span id="l21.73">     createProxy: function calEvent_createProxy(aRecurrenceId) {</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l22.1"></a><span id="l22.1" class="difflineminus">--- a/calendar/base/src/calFreeBusyService.js</span>
<a href="#l22.2"></a><span id="l22.2" class="difflineplus">+++ b/calendar/base/src/calFreeBusyService.js</span>
<a href="#l22.3"></a><span id="l22.3" class="difflineat">@@ -1,27 +1,31 @@</span>
<a href="#l22.4"></a><span id="l22.4"> /* This Source Code Form is subject to the terms of the Mozilla Public</span>
<a href="#l22.5"></a><span id="l22.5">  * License, v. 2.0. If a copy of the MPL was not distributed with this</span>
<a href="#l22.6"></a><span id="l22.6">  * file, You can obtain one at http://mozilla.org/MPL/2.0/. */</span>
<a href="#l22.7"></a><span id="l22.7"> </span>
<a href="#l22.8"></a><span id="l22.8" class="difflineplus">+Components.utils.import(&quot;resource://gre/modules/XPCOMUtils.jsm&quot;);</span>
<a href="#l22.9"></a><span id="l22.9" class="difflineplus">+</span>
<a href="#l22.10"></a><span id="l22.10"> function calFreeBusyListener(numOperations, finalListener) {</span>
<a href="#l22.11"></a><span id="l22.11">     this.mFinalListener = finalListener;</span>
<a href="#l22.12"></a><span id="l22.12">     this.mNumOperations = numOperations;</span>
<a href="#l22.13"></a><span id="l22.13"> </span>
<a href="#l22.14"></a><span id="l22.14">     var this_ = this;</span>
<a href="#l22.15"></a><span id="l22.15">     function cancelFunc() { // operation group has been cancelled</span>
<a href="#l22.16"></a><span id="l22.16">         this_.notifyResult(null);</span>
<a href="#l22.17"></a><span id="l22.17">     }</span>
<a href="#l22.18"></a><span id="l22.18">     this.opGroup = new calOperationGroup(cancelFunc);</span>
<a href="#l22.19"></a><span id="l22.19"> }</span>
<a href="#l22.20"></a><span id="l22.20"> calFreeBusyListener.prototype = {</span>
<a href="#l22.21"></a><span id="l22.21">     mFinalListener: null,</span>
<a href="#l22.22"></a><span id="l22.22">     mNumOperations: 0,</span>
<a href="#l22.23"></a><span id="l22.23">     opGroup: null,</span>
<a href="#l22.24"></a><span id="l22.24"> </span>
<a href="#l22.25"></a><span id="l22.25" class="difflineplus">+    QueryInterface: XPCOMUtils.generateQI([Components.interfaces.calIGenericOperationListener]),</span>
<a href="#l22.26"></a><span id="l22.26" class="difflineplus">+</span>
<a href="#l22.27"></a><span id="l22.27">     notifyResult: function calFreeBusyListener_notifyResult(result) {</span>
<a href="#l22.28"></a><span id="l22.28">         var listener = this.mFinalListener</span>
<a href="#l22.29"></a><span id="l22.29">         if (listener) {</span>
<a href="#l22.30"></a><span id="l22.30">             if (!this.opGroup.isPending) {</span>
<a href="#l22.31"></a><span id="l22.31">                 this.mFinalListener = null;</span>
<a href="#l22.32"></a><span id="l22.32">             }</span>
<a href="#l22.33"></a><span id="l22.33">             listener.onResult(this.opGroup, result);</span>
<a href="#l22.34"></a><span id="l22.34">         }</span>
<a href="#l22.35"></a><span id="l22.35" class="difflineat">@@ -42,40 +46,33 @@ calFreeBusyListener.prototype = {</span>
<a href="#l22.36"></a><span id="l22.36">         }</span>
<a href="#l22.37"></a><span id="l22.37">     }</span>
<a href="#l22.38"></a><span id="l22.38"> };</span>
<a href="#l22.39"></a><span id="l22.39"> </span>
<a href="#l22.40"></a><span id="l22.40"> function calFreeBusyService() {</span>
<a href="#l22.41"></a><span id="l22.41">     this.wrappedJSObject = this;</span>
<a href="#l22.42"></a><span id="l22.42">     this.mProviders = new calInterfaceBag(Components.interfaces.calIFreeBusyProvider);</span>
<a href="#l22.43"></a><span id="l22.43"> }</span>
<a href="#l22.44"></a><span id="l22.44" class="difflineplus">+const calFreeBusyServiceClassID = Components.ID(&quot;{29c56cd5-d36e-453a-acde-0083bd4fe6d3}&quot;);</span>
<a href="#l22.45"></a><span id="l22.45" class="difflineplus">+const calFreeBusyServiceInterfaces = [</span>
<a href="#l22.46"></a><span id="l22.46" class="difflineplus">+    Components.interfaces.calIFreeBusyProvider,</span>
<a href="#l22.47"></a><span id="l22.47" class="difflineplus">+    Components.interfaces.calIFreeBusyService</span>
<a href="#l22.48"></a><span id="l22.48" class="difflineplus">+];</span>
<a href="#l22.49"></a><span id="l22.49"> calFreeBusyService.prototype = {</span>
<a href="#l22.50"></a><span id="l22.50">     mProviders: null,</span>
<a href="#l22.51"></a><span id="l22.51"> </span>
<a href="#l22.52"></a><span id="l22.52" class="difflineminus">-    QueryInterface: function calFreeBusyService_QueryInterface(aIID) {</span>
<a href="#l22.53"></a><span id="l22.53" class="difflineminus">-        return doQueryInterface(this, calFreeBusyService.prototype, aIID, null, this);</span>
<a href="#l22.54"></a><span id="l22.54" class="difflineminus">-    },</span>
<a href="#l22.55"></a><span id="l22.55" class="difflineminus">-</span>
<a href="#l22.56"></a><span id="l22.56" class="difflineminus">-    // nsIClassInfo:</span>
<a href="#l22.57"></a><span id="l22.57" class="difflineminus">-    getInterfaces: function calFreeBusyService_getInterfaces(count) {</span>
<a href="#l22.58"></a><span id="l22.58" class="difflineminus">-        const ifaces = [Components.interfaces.nsISupports,</span>
<a href="#l22.59"></a><span id="l22.59" class="difflineminus">-                        Components.interfaces.calIFreeBusyProvider,</span>
<a href="#l22.60"></a><span id="l22.60" class="difflineminus">-                        Components.interfaces.calIFreeBusyService,</span>
<a href="#l22.61"></a><span id="l22.61" class="difflineminus">-                        Components.interfaces.nsIClassInfo];</span>
<a href="#l22.62"></a><span id="l22.62" class="difflineminus">-        count.value = ifaces.length;</span>
<a href="#l22.63"></a><span id="l22.63" class="difflineminus">-        return ifaces;</span>
<a href="#l22.64"></a><span id="l22.64" class="difflineminus">-    },</span>
<a href="#l22.65"></a><span id="l22.65" class="difflineminus">-    getHelperForLanguage: function calFreeBusyService_getHelperForLanguage(language) {</span>
<a href="#l22.66"></a><span id="l22.66" class="difflineminus">-        return null;</span>
<a href="#l22.67"></a><span id="l22.67" class="difflineminus">-    },</span>
<a href="#l22.68"></a><span id="l22.68" class="difflineminus">-    contractID: &quot;@mozilla.org/calendar/freebusy-service;1&quot;,</span>
<a href="#l22.69"></a><span id="l22.69" class="difflineminus">-    classDescription: &quot;Calendar FreeBusy Service&quot;,</span>
<a href="#l22.70"></a><span id="l22.70" class="difflineminus">-    classID: Components.ID(&quot;{29c56cd5-d36e-453a-acde-0083bd4fe6d3}&quot;),</span>
<a href="#l22.71"></a><span id="l22.71" class="difflineminus">-    implementationLanguage: Components.interfaces.nsIProgrammingLanguage.JAVASCRIPT,</span>
<a href="#l22.72"></a><span id="l22.72" class="difflineminus">-    flags: Components.interfaces.nsIClassInfo.SINGLETON,</span>
<a href="#l22.73"></a><span id="l22.73" class="difflineplus">+    classID: calFreeBusyServiceClassID,</span>
<a href="#l22.74"></a><span id="l22.74" class="difflineplus">+    QueryInterface: XPCOMUtils.generateQI(calFreeBusyServiceInterfaces),</span>
<a href="#l22.75"></a><span id="l22.75" class="difflineplus">+    classInfo: XPCOMUtils.generateCI({</span>
<a href="#l22.76"></a><span id="l22.76" class="difflineplus">+        classID: calFreeBusyServiceClassID,</span>
<a href="#l22.77"></a><span id="l22.77" class="difflineplus">+        contractID: &quot;@mozilla.org/calendar/freebusy-service;1&quot;,</span>
<a href="#l22.78"></a><span id="l22.78" class="difflineplus">+        classDescription: &quot;Calendar FreeBusy Service&quot;,</span>
<a href="#l22.79"></a><span id="l22.79" class="difflineplus">+        interfaces: calFreeBusyServiceInterfaces,</span>
<a href="#l22.80"></a><span id="l22.80" class="difflineplus">+        flags: Components.interfaces.nsIClassInfo.SINGLETON</span>
<a href="#l22.81"></a><span id="l22.81" class="difflineplus">+    }),</span>
<a href="#l22.82"></a><span id="l22.82"> </span>
<a href="#l22.83"></a><span id="l22.83">     // calIFreeBusyProvider:</span>
<a href="#l22.84"></a><span id="l22.84">     getFreeBusyIntervals: function calFreeBusyService_getFreeBusyIntervals(aCalId,</span>
<a href="#l22.85"></a><span id="l22.85">                                                                            aRangeStart,</span>
<a href="#l22.86"></a><span id="l22.86">                                                                            aRangeEnd,</span>
<a href="#l22.87"></a><span id="l22.87">                                                                            aBusyTypes,</span>
<a href="#l22.88"></a><span id="l22.88">                                                                            aListener) {</span>
<a href="#l22.89"></a><span id="l22.89">         var groupListener = new calFreeBusyListener(this.mProviders.size, aListener);</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l23.1"></a><span id="l23.1" class="difflineminus">--- a/calendar/base/src/calIcsParser.js</span>
<a href="#l23.2"></a><span id="l23.2" class="difflineplus">+++ b/calendar/base/src/calIcsParser.js</span>
<a href="#l23.3"></a><span id="l23.3" class="difflineat">@@ -1,48 +1,35 @@</span>
<a href="#l23.4"></a><span id="l23.4"> /* This Source Code Form is subject to the terms of the Mozilla Public</span>
<a href="#l23.5"></a><span id="l23.5">  * License, v. 2.0. If a copy of the MPL was not distributed with this</span>
<a href="#l23.6"></a><span id="l23.6">  * file, You can obtain one at http://mozilla.org/MPL/2.0/. */</span>
<a href="#l23.7"></a><span id="l23.7"> </span>
<a href="#l23.8"></a><span id="l23.8"> Components.utils.import(&quot;resource://calendar/modules/calUtils.jsm&quot;);</span>
<a href="#l23.9"></a><span id="l23.9"> Components.utils.import(&quot;resource://calendar/modules/calIteratorUtils.jsm&quot;);</span>
<a href="#l23.10"></a><span id="l23.10" class="difflineplus">+Components.utils.import(&quot;resource://gre/modules/XPCOMUtils.jsm&quot;);</span>
<a href="#l23.11"></a><span id="l23.11"> </span>
<a href="#l23.12"></a><span id="l23.12"> function calIcsParser() {</span>
<a href="#l23.13"></a><span id="l23.13">     this.wrappedJSObject = this;</span>
<a href="#l23.14"></a><span id="l23.14">     this.mItems = new Array();</span>
<a href="#l23.15"></a><span id="l23.15">     this.mParentlessItems = new Array();</span>
<a href="#l23.16"></a><span id="l23.16">     this.mComponents = new Array();</span>
<a href="#l23.17"></a><span id="l23.17">     this.mProperties = new Array();</span>
<a href="#l23.18"></a><span id="l23.18"> }</span>
<a href="#l23.19"></a><span id="l23.19" class="difflineminus">-</span>
<a href="#l23.20"></a><span id="l23.20" class="difflineplus">+const calIcsParserClassID = Components.ID(&quot;{6fe88047-75b6-4874-80e8-5f5800f14984}&quot;);</span>
<a href="#l23.21"></a><span id="l23.21" class="difflineplus">+const calIcsParserInterfaces = [Components.interfaces.calIIcsParser];</span>
<a href="#l23.22"></a><span id="l23.22"> calIcsParser.prototype = {</span>
<a href="#l23.23"></a><span id="l23.23" class="difflineminus">-    contractID: &quot;@mozilla.org/calendar/ics-parser;1&quot;,</span>
<a href="#l23.24"></a><span id="l23.24" class="difflineminus">-    classDescription: &quot;Calendar ICS Parser&quot;,</span>
<a href="#l23.25"></a><span id="l23.25" class="difflineminus">-    classID: Components.ID(&quot;{6fe88047-75b6-4874-80e8-5f5800f14984}&quot;),</span>
<a href="#l23.26"></a><span id="l23.26" class="difflineminus">-</span>
<a href="#l23.27"></a><span id="l23.27" class="difflineminus">-    getInterfaces: function ip_getInterfaces (count) {</span>
<a href="#l23.28"></a><span id="l23.28" class="difflineminus">-        const ifaces = [</span>
<a href="#l23.29"></a><span id="l23.29" class="difflineminus">-            Components.interfaces.nsISupports,</span>
<a href="#l23.30"></a><span id="l23.30" class="difflineminus">-            Components.interfaces.calIIcsParser,</span>
<a href="#l23.31"></a><span id="l23.31" class="difflineminus">-            Components.interfaces.nsIClassInfo</span>
<a href="#l23.32"></a><span id="l23.32" class="difflineminus">-        ];</span>
<a href="#l23.33"></a><span id="l23.33" class="difflineminus">-        count.value = ifaces.length;</span>
<a href="#l23.34"></a><span id="l23.34" class="difflineminus">-        return ifaces;</span>
<a href="#l23.35"></a><span id="l23.35" class="difflineminus">-    },</span>
<a href="#l23.36"></a><span id="l23.36" class="difflineminus">-</span>
<a href="#l23.37"></a><span id="l23.37" class="difflineminus">-    getHelperForLanguage: function ip_getHelperForLanguage(language) {</span>
<a href="#l23.38"></a><span id="l23.38" class="difflineminus">-        return null;</span>
<a href="#l23.39"></a><span id="l23.39" class="difflineminus">-    },</span>
<a href="#l23.40"></a><span id="l23.40" class="difflineminus">-</span>
<a href="#l23.41"></a><span id="l23.41" class="difflineminus">-    implementationLanguage: Components.interfaces.nsIProgrammingLanguage.JAVASCRIPT,</span>
<a href="#l23.42"></a><span id="l23.42" class="difflineminus">-    flags: Components.interfaces.nsIClassInfo.THREADSAFE,</span>
<a href="#l23.43"></a><span id="l23.43" class="difflineminus">-</span>
<a href="#l23.44"></a><span id="l23.44" class="difflineminus">-    QueryInterface: function ip_QueryInterface(aIID) {</span>
<a href="#l23.45"></a><span id="l23.45" class="difflineminus">-        return cal.doQueryInterface(this, calIcsParser.prototype, aIID, null, this);</span>
<a href="#l23.46"></a><span id="l23.46" class="difflineminus">-    },</span>
<a href="#l23.47"></a><span id="l23.47" class="difflineplus">+    classID: calIcsParserClassID,</span>
<a href="#l23.48"></a><span id="l23.48" class="difflineplus">+    QueryInterface: XPCOMUtils.generateQI(calIcsParserInterfaces),</span>
<a href="#l23.49"></a><span id="l23.49" class="difflineplus">+    classInfo: XPCOMUtils.generateCI({</span>
<a href="#l23.50"></a><span id="l23.50" class="difflineplus">+        classID: calIcsParserClassID,</span>
<a href="#l23.51"></a><span id="l23.51" class="difflineplus">+        contractID: &quot;@mozilla.org/calendar/ics-parser;1&quot;,</span>
<a href="#l23.52"></a><span id="l23.52" class="difflineplus">+        classDescription: &quot;Calendar ICS Parser&quot;,</span>
<a href="#l23.53"></a><span id="l23.53" class="difflineplus">+        interfaces: calIcsParserInterfaces,</span>
<a href="#l23.54"></a><span id="l23.54" class="difflineplus">+        flags: Components.interfaces.nsIClassInfo.THREADSAFE</span>
<a href="#l23.55"></a><span id="l23.55" class="difflineplus">+    }),</span>
<a href="#l23.56"></a><span id="l23.56"> </span>
<a href="#l23.57"></a><span id="l23.57">     processIcalComponent: function ip_processIcalComponent(rootComp, aAsyncParsing) {</span>
<a href="#l23.58"></a><span id="l23.58">         let calComp;</span>
<a href="#l23.59"></a><span id="l23.59">         // libical returns the vcalendar component if there is just one vcalendar.</span>
<a href="#l23.60"></a><span id="l23.60">         // If there are multiple vcalendars, it returns an xroot component, with</span>
<a href="#l23.61"></a><span id="l23.61">         // vcalendar children. We need to handle both cases.</span>
<a href="#l23.62"></a><span id="l23.62">         if (rootComp) {</span>
<a href="#l23.63"></a><span id="l23.63">             if (rootComp.componentType == 'VCALENDAR') {</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l24.1"></a><span id="l24.1" class="difflineminus">--- a/calendar/base/src/calIcsSerializer.js</span>
<a href="#l24.2"></a><span id="l24.2" class="difflineplus">+++ b/calendar/base/src/calIcsSerializer.js</span>
<a href="#l24.3"></a><span id="l24.3" class="difflineat">@@ -6,39 +6,27 @@ Components.utils.import(&quot;resource://cale</span>
<a href="#l24.4"></a><span id="l24.4"> Components.utils.import(&quot;resource://calendar/modules/calIteratorUtils.jsm&quot;);</span>
<a href="#l24.5"></a><span id="l24.5"> </span>
<a href="#l24.6"></a><span id="l24.6"> function calIcsSerializer() {</span>
<a href="#l24.7"></a><span id="l24.7">     this.wrappedJSObject = this;</span>
<a href="#l24.8"></a><span id="l24.8">     this.mItems = [];</span>
<a href="#l24.9"></a><span id="l24.9">     this.mProperties = [];</span>
<a href="#l24.10"></a><span id="l24.10">     this.mComponents = [];</span>
<a href="#l24.11"></a><span id="l24.11"> }</span>
<a href="#l24.12"></a><span id="l24.12" class="difflineminus">-</span>
<a href="#l24.13"></a><span id="l24.13" class="difflineplus">+const calIcsSerializerClassID = Components.ID(&quot;{207a6682-8ff1-4203-9160-729ec28c8766}&quot;);</span>
<a href="#l24.14"></a><span id="l24.14" class="difflineplus">+const calIcsSerializerInterfaces = [Components.interfaces.calIIcsSerializer];</span>
<a href="#l24.15"></a><span id="l24.15"> calIcsSerializer.prototype = {</span>
<a href="#l24.16"></a><span id="l24.16" class="difflineminus">-    // nsIClassInfo:</span>
<a href="#l24.17"></a><span id="l24.17" class="difflineminus">-    classID: Components.ID(&quot;{207a6682-8ff1-4203-9160-729ec28c8766}&quot;),</span>
<a href="#l24.18"></a><span id="l24.18" class="difflineminus">-    contractID: &quot;@mozilla.org/calendar/ics-serializer;1&quot;,</span>
<a href="#l24.19"></a><span id="l24.19" class="difflineminus">-    classDescription: &quot;Calendar ICS Serializer&quot;,</span>
<a href="#l24.20"></a><span id="l24.20" class="difflineminus">-</span>
<a href="#l24.21"></a><span id="l24.21" class="difflineminus">-    getInterfaces: function getInterfaces(count) {</span>
<a href="#l24.22"></a><span id="l24.22" class="difflineminus">-        const ifaces = [Components.interfaces.calIIcsSerializer,</span>
<a href="#l24.23"></a><span id="l24.23" class="difflineminus">-                        Components.interfaces.nsIClassInfo,</span>
<a href="#l24.24"></a><span id="l24.24" class="difflineminus">-                        Components.interfaces.nsISupports];</span>
<a href="#l24.25"></a><span id="l24.25" class="difflineminus">-        count.value = ifaces.length;</span>
<a href="#l24.26"></a><span id="l24.26" class="difflineminus">-        return ifaces;</span>
<a href="#l24.27"></a><span id="l24.27" class="difflineminus">-    },</span>
<a href="#l24.28"></a><span id="l24.28" class="difflineminus">-    getHelperForLanguage: function getHelperForLanguage(language) {</span>
<a href="#l24.29"></a><span id="l24.29" class="difflineminus">-        return null;</span>
<a href="#l24.30"></a><span id="l24.30" class="difflineminus">-    },</span>
<a href="#l24.31"></a><span id="l24.31" class="difflineminus">-    implementationLanguage: Components.interfaces.nsIProgrammingLanguage.JAVASCRIPT,</span>
<a href="#l24.32"></a><span id="l24.32" class="difflineminus">-    flags: 0,</span>
<a href="#l24.33"></a><span id="l24.33" class="difflineminus">-</span>
<a href="#l24.34"></a><span id="l24.34" class="difflineminus">-    QueryInterface: function QueryInterface(aIID) {</span>
<a href="#l24.35"></a><span id="l24.35" class="difflineminus">-        return doQueryInterface(this, calIcsSerializer.prototype, aIID, null, this);</span>
<a href="#l24.36"></a><span id="l24.36" class="difflineminus">-    },</span>
<a href="#l24.37"></a><span id="l24.37" class="difflineplus">+    classID: calIcsSerializerClassID,</span>
<a href="#l24.38"></a><span id="l24.38" class="difflineplus">+    QueryInterface: XPCOMUtils.generateQI(calIcsSerializerInterfaces),</span>
<a href="#l24.39"></a><span id="l24.39" class="difflineplus">+    classInfo: XPCOMUtils.generateCI({</span>
<a href="#l24.40"></a><span id="l24.40" class="difflineplus">+        classID: calIcsSerializerClassID,</span>
<a href="#l24.41"></a><span id="l24.41" class="difflineplus">+        contractID: &quot;@mozilla.org/calendar/ics-serializer;1&quot;,</span>
<a href="#l24.42"></a><span id="l24.42" class="difflineplus">+        classDescription: &quot;Calendar ICS Serializer&quot;,</span>
<a href="#l24.43"></a><span id="l24.43" class="difflineplus">+        interfaces: calIcsSerializerInterfaces,</span>
<a href="#l24.44"></a><span id="l24.44" class="difflineplus">+    }),</span>
<a href="#l24.45"></a><span id="l24.45"> </span>
<a href="#l24.46"></a><span id="l24.46">     addItems: function is_addItems(aItems, aCount) {</span>
<a href="#l24.47"></a><span id="l24.47">         if (aCount &gt; 0) {</span>
<a href="#l24.48"></a><span id="l24.48">             this.mItems = this.mItems.concat(aItems);</span>
<a href="#l24.49"></a><span id="l24.49">         }</span>
<a href="#l24.50"></a><span id="l24.50">     },</span>
<a href="#l24.51"></a><span id="l24.51"> </span>
<a href="#l24.52"></a><span id="l24.52">     addProperty: function is_addProperty(aProperty) {</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l25.1"></a><span id="l25.1" class="difflineminus">--- a/calendar/base/src/calItemBase.js</span>
<a href="#l25.2"></a><span id="l25.2" class="difflineplus">+++ b/calendar/base/src/calItemBase.js</span>
<a href="#l25.3"></a><span id="l25.3" class="difflineat">@@ -1,14 +1,15 @@</span>
<a href="#l25.4"></a><span id="l25.4"> /* This Source Code Form is subject to the terms of the Mozilla Public</span>
<a href="#l25.5"></a><span id="l25.5">  * License, v. 2.0. If a copy of the MPL was not distributed with this</span>
<a href="#l25.6"></a><span id="l25.6">  * file, You can obtain one at http://mozilla.org/MPL/2.0/. */</span>
<a href="#l25.7"></a><span id="l25.7"> </span>
<a href="#l25.8"></a><span id="l25.8"> Components.utils.import(&quot;resource://calendar/modules/calUtils.jsm&quot;);</span>
<a href="#l25.9"></a><span id="l25.9"> Components.utils.import(&quot;resource://calendar/modules/calIteratorUtils.jsm&quot;);</span>
<a href="#l25.10"></a><span id="l25.10" class="difflineplus">+Components.utils.import(&quot;resource://gre/modules/XPCOMUtils.jsm&quot;);</span>
<a href="#l25.11"></a><span id="l25.11"> </span>
<a href="#l25.12"></a><span id="l25.12"> /**</span>
<a href="#l25.13"></a><span id="l25.13">  * calItemBase prototype definition</span>
<a href="#l25.14"></a><span id="l25.14">  *</span>
<a href="#l25.15"></a><span id="l25.15">  * @implements calIItemBase</span>
<a href="#l25.16"></a><span id="l25.16">  * @constructor</span>
<a href="#l25.17"></a><span id="l25.17">  */</span>
<a href="#l25.18"></a><span id="l25.18"> function calItemBase() {</span>
<a href="#l25.19"></a><span id="l25.19" class="difflineat">@@ -47,20 +48,17 @@ calItemBase.prototype = {</span>
<a href="#l25.20"></a><span id="l25.20">         this.mProperties = new calPropertyBag();</span>
<a href="#l25.21"></a><span id="l25.21">         this.mPropertyParams = {};</span>
<a href="#l25.22"></a><span id="l25.22">         this.mProperties.setProperty(&quot;CREATED&quot;, cal.jsDateToDateTime(new Date()));</span>
<a href="#l25.23"></a><span id="l25.23">     },</span>
<a href="#l25.24"></a><span id="l25.24"> </span>
<a href="#l25.25"></a><span id="l25.25">     /**</span>
<a href="#l25.26"></a><span id="l25.26">      * @see nsISupports</span>
<a href="#l25.27"></a><span id="l25.27">      */</span>
<a href="#l25.28"></a><span id="l25.28" class="difflineminus">-    QueryInterface: function cIB_QueryInterface(aIID) {</span>
<a href="#l25.29"></a><span id="l25.29" class="difflineminus">-        return doQueryInterface(this, calItemBase.prototype, aIID,</span>
<a href="#l25.30"></a><span id="l25.30" class="difflineminus">-                                [Components.interfaces.calIItemBase]);</span>
<a href="#l25.31"></a><span id="l25.31" class="difflineminus">-    },</span>
<a href="#l25.32"></a><span id="l25.32" class="difflineplus">+    QueryInterface: XPCOMUtils.generateQI([Components.interfaces.calIItemBase]),</span>
<a href="#l25.33"></a><span id="l25.33"> </span>
<a href="#l25.34"></a><span id="l25.34">     /**</span>
<a href="#l25.35"></a><span id="l25.35">      * @see calIItemBase</span>
<a href="#l25.36"></a><span id="l25.36">      */</span>
<a href="#l25.37"></a><span id="l25.37">     get aclEntry() {</span>
<a href="#l25.38"></a><span id="l25.38">         let aclEntry = this.mACLEntry;</span>
<a href="#l25.39"></a><span id="l25.39">         let aclManager = (this.calendar &amp;&amp; this.calendar.superCalendar.aclManager);</span>
<a href="#l25.40"></a><span id="l25.40"> </span>
<a href="#l25.41"></a><span id="l25.41" class="difflineat">@@ -489,19 +487,17 @@ calItemBase.prototype = {</span>
<a href="#l25.42"></a><span id="l25.42">             mParamNames: [ key for (key in parameters) ],</span>
<a href="#l25.43"></a><span id="l25.43">             hasMoreElements: function cIB_gPE_hasMoreElements() {</span>
<a href="#l25.44"></a><span id="l25.44">                 return (this.mParamNames.length &gt; 0);</span>
<a href="#l25.45"></a><span id="l25.45">             },</span>
<a href="#l25.46"></a><span id="l25.46"> </span>
<a href="#l25.47"></a><span id="l25.47">             getNext: function cIB_gPE_getNext() {</span>
<a href="#l25.48"></a><span id="l25.48">                 let paramName = this.mParamNames.pop()</span>
<a href="#l25.49"></a><span id="l25.49">                 return { // nsIProperty</span>
<a href="#l25.50"></a><span id="l25.50" class="difflineminus">-                    QueryInterface: function cIB_gPE_gN_QueryInterface(aIID) {</span>
<a href="#l25.51"></a><span id="l25.51" class="difflineminus">-                        return doQueryInterface(this, null, aIID, [Components.interfaces.nsIProperty]);</span>
<a href="#l25.52"></a><span id="l25.52" class="difflineminus">-                    },</span>
<a href="#l25.53"></a><span id="l25.53" class="difflineplus">+                    QueryInterface: XPCOMUtils.generateQI([Components.interfaces.nsIProperty]),</span>
<a href="#l25.54"></a><span id="l25.54">                     name: paramName,</span>
<a href="#l25.55"></a><span id="l25.55">                     value: parameters[paramName]</span>
<a href="#l25.56"></a><span id="l25.56">                 };</span>
<a href="#l25.57"></a><span id="l25.57">             }</span>
<a href="#l25.58"></a><span id="l25.58">         };</span>
<a href="#l25.59"></a><span id="l25.59">     },</span>
<a href="#l25.60"></a><span id="l25.60"> </span>
<a href="#l25.61"></a><span id="l25.61">     // void getAttendees(out PRUint32 count,</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l26.1"></a><span id="l26.1" class="difflineminus">--- a/calendar/base/src/calItipItem.js</span>
<a href="#l26.2"></a><span id="l26.2" class="difflineplus">+++ b/calendar/base/src/calItipItem.js</span>
<a href="#l26.3"></a><span id="l26.3" class="difflineat">@@ -1,51 +1,37 @@</span>
<a href="#l26.4"></a><span id="l26.4"> /* -*- Mode: javascript; tab-width: 20; indent-tabs-mode: nil; c-basic-offset: 4 -*- */</span>
<a href="#l26.5"></a><span id="l26.5"> /* This Source Code Form is subject to the terms of the Mozilla Public</span>
<a href="#l26.6"></a><span id="l26.6">  * License, v. 2.0. If a copy of the MPL was not distributed with this</span>
<a href="#l26.7"></a><span id="l26.7">  * file, You can obtain one at http://mozilla.org/MPL/2.0/. */</span>
<a href="#l26.8"></a><span id="l26.8"> </span>
<a href="#l26.9"></a><span id="l26.9"> Components.utils.import(&quot;resource://calendar/modules/calUtils.jsm&quot;);</span>
<a href="#l26.10"></a><span id="l26.10"> Components.utils.import(&quot;resource://calendar/modules/calIteratorUtils.jsm&quot;);</span>
<a href="#l26.11"></a><span id="l26.11" class="difflineplus">+Components.utils.import(&quot;resource://gre/modules/XPCOMUtils.jsm&quot;);</span>
<a href="#l26.12"></a><span id="l26.12"> </span>
<a href="#l26.13"></a><span id="l26.13"> /**</span>
<a href="#l26.14"></a><span id="l26.14">  * Constructor of calItipItem object</span>
<a href="#l26.15"></a><span id="l26.15">  */</span>
<a href="#l26.16"></a><span id="l26.16"> function calItipItem() {</span>
<a href="#l26.17"></a><span id="l26.17">     this.wrappedJSObject = this;</span>
<a href="#l26.18"></a><span id="l26.18">     this.mCurrentItemIndex = 0;</span>
<a href="#l26.19"></a><span id="l26.19"> }</span>
<a href="#l26.20"></a><span id="l26.20" class="difflineminus">-</span>
<a href="#l26.21"></a><span id="l26.21" class="difflineplus">+const calItipItemClassID = Components.ID(&quot;{f41392ab-dcad-4bad-818f-b3d1631c4d93}&quot;);</span>
<a href="#l26.22"></a><span id="l26.22" class="difflineplus">+const calItipItemInterfaces = [Components.interfaces.calIItipItem];</span>
<a href="#l26.23"></a><span id="l26.23"> calItipItem.prototype = {</span>
<a href="#l26.24"></a><span id="l26.24">     mIsInitialized: false,</span>
<a href="#l26.25"></a><span id="l26.25"> </span>
<a href="#l26.26"></a><span id="l26.26" class="difflineminus">-    // nsIClassInfo:</span>
<a href="#l26.27"></a><span id="l26.27" class="difflineminus">-    getInterfaces: function ciiGI(count) {</span>
<a href="#l26.28"></a><span id="l26.28" class="difflineminus">-        let ifaces = [</span>
<a href="#l26.29"></a><span id="l26.29" class="difflineminus">-            Components.interfaces.nsIClassInfo,</span>
<a href="#l26.30"></a><span id="l26.30" class="difflineminus">-            Components.interfaces.nsISupports,</span>
<a href="#l26.31"></a><span id="l26.31" class="difflineminus">-            Components.interfaces.calIItipItem</span>
<a href="#l26.32"></a><span id="l26.32" class="difflineminus">-        ];</span>
<a href="#l26.33"></a><span id="l26.33" class="difflineminus">-        count.value = ifaces.length;</span>
<a href="#l26.34"></a><span id="l26.34" class="difflineminus">-        return ifaces;</span>
<a href="#l26.35"></a><span id="l26.35" class="difflineminus">-    },</span>
<a href="#l26.36"></a><span id="l26.36" class="difflineminus">-</span>
<a href="#l26.37"></a><span id="l26.37" class="difflineminus">-    getHelperForLanguage: function ciiGHFL(aLanguage) {</span>
<a href="#l26.38"></a><span id="l26.38" class="difflineminus">-        return null;</span>
<a href="#l26.39"></a><span id="l26.39" class="difflineminus">-    },</span>
<a href="#l26.40"></a><span id="l26.40" class="difflineminus">-</span>
<a href="#l26.41"></a><span id="l26.41" class="difflineminus">-    contractID: &quot;@mozilla.org/calendar/itip-item;1&quot;,</span>
<a href="#l26.42"></a><span id="l26.42" class="difflineminus">-    classDescription: &quot;Calendar iTIP item&quot;,</span>
<a href="#l26.43"></a><span id="l26.43" class="difflineminus">-    classID: Components.ID(&quot;{f41392ab-dcad-4bad-818f-b3d1631c4d93}&quot;),</span>
<a href="#l26.44"></a><span id="l26.44" class="difflineminus">-    implementationLanguage: Components.interfaces.nsIProgrammingLanguage.JAVASCRIPT,</span>
<a href="#l26.45"></a><span id="l26.45" class="difflineminus">-    flags: 0,</span>
<a href="#l26.46"></a><span id="l26.46" class="difflineminus">-</span>
<a href="#l26.47"></a><span id="l26.47" class="difflineminus">-    QueryInterface: function ciiQI(aIID) {</span>
<a href="#l26.48"></a><span id="l26.48" class="difflineminus">-        return cal.doQueryInterface(this, calItipItem.prototype, aIID, null, this);</span>
<a href="#l26.49"></a><span id="l26.49" class="difflineminus">-    },</span>
<a href="#l26.50"></a><span id="l26.50" class="difflineplus">+    classID: calItipItemClassID,</span>
<a href="#l26.51"></a><span id="l26.51" class="difflineplus">+    QueryInterface: XPCOMUtils.generateQI(calItipItemInterfaces),</span>
<a href="#l26.52"></a><span id="l26.52" class="difflineplus">+    classInfo: XPCOMUtils.generateCI({</span>
<a href="#l26.53"></a><span id="l26.53" class="difflineplus">+        classID: calItipItemClassID,</span>
<a href="#l26.54"></a><span id="l26.54" class="difflineplus">+        contractID: &quot;@mozilla.org/calendar/itip-item;1&quot;,</span>
<a href="#l26.55"></a><span id="l26.55" class="difflineplus">+        classDescription: &quot;Calendar iTIP item&quot;,</span>
<a href="#l26.56"></a><span id="l26.56" class="difflineplus">+        interfaces: calItipItemInterfaces</span>
<a href="#l26.57"></a><span id="l26.57" class="difflineplus">+    }),</span>
<a href="#l26.58"></a><span id="l26.58"> </span>
<a href="#l26.59"></a><span id="l26.59">     mIsSend: false,</span>
<a href="#l26.60"></a><span id="l26.60">     get isSend() {</span>
<a href="#l26.61"></a><span id="l26.61">         return this.mIsSend;</span>
<a href="#l26.62"></a><span id="l26.62">     },</span>
<a href="#l26.63"></a><span id="l26.63">     set isSend(aValue) {</span>
<a href="#l26.64"></a><span id="l26.64">         return (this.mIsSend = aValue);</span>
<a href="#l26.65"></a><span id="l26.65">     },</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l27.1"></a><span id="l27.1" class="difflineminus">--- a/calendar/base/src/calProtocolHandler.js</span>
<a href="#l27.2"></a><span id="l27.2" class="difflineplus">+++ b/calendar/base/src/calProtocolHandler.js</span>
<a href="#l27.3"></a><span id="l27.3" class="difflineat">@@ -1,13 +1,14 @@</span>
<a href="#l27.4"></a><span id="l27.4"> /* This Source Code Form is subject to the terms of the Mozilla Public</span>
<a href="#l27.5"></a><span id="l27.5">  * License, v. 2.0. If a copy of the MPL was not distributed with this</span>
<a href="#l27.6"></a><span id="l27.6">  * file, You can obtain one at http://mozilla.org/MPL/2.0/. */</span>
<a href="#l27.7"></a><span id="l27.7"> </span>
<a href="#l27.8"></a><span id="l27.8"> Components.utils.import(&quot;resource://gre/modules/Services.jsm&quot;);</span>
<a href="#l27.9"></a><span id="l27.9" class="difflineplus">+Components.utils.import(&quot;resource://gre/modules/XPCOMUtils.jsm&quot;);</span>
<a href="#l27.10"></a><span id="l27.10"> </span>
<a href="#l27.11"></a><span id="l27.11"> /** Constructor for webcal: protocol handler */</span>
<a href="#l27.12"></a><span id="l27.12"> function calProtocolHandlerWebcal() {</span>
<a href="#l27.13"></a><span id="l27.13">     calProtocolHandler.call(this, &quot;webcal&quot;);</span>
<a href="#l27.14"></a><span id="l27.14"> }</span>
<a href="#l27.15"></a><span id="l27.15"> </span>
<a href="#l27.16"></a><span id="l27.16"> /** Constructor for webcals: protocl handler */</span>
<a href="#l27.17"></a><span id="l27.17"> function calProtocolHandlerWebcals() {</span>
<a href="#l27.18"></a><span id="l27.18" class="difflineat">@@ -17,46 +18,22 @@ function calProtocolHandlerWebcals() {</span>
<a href="#l27.19"></a><span id="l27.19"> /**</span>
<a href="#l27.20"></a><span id="l27.20">  * Generic webcal constructor</span>
<a href="#l27.21"></a><span id="l27.21">  *</span>
<a href="#l27.22"></a><span id="l27.22">  * @param scheme        The scheme to init for (webcal, webcals)</span>
<a href="#l27.23"></a><span id="l27.23">  */</span>
<a href="#l27.24"></a><span id="l27.24"> function calProtocolHandler(scheme) {</span>
<a href="#l27.25"></a><span id="l27.25">     this.scheme = scheme;</span>
<a href="#l27.26"></a><span id="l27.26">     this.mHttpProtocol = Services.io.getProtocolHandler(this.scheme == &quot;webcal&quot; ? &quot;http&quot; : &quot;https&quot;);</span>
<a href="#l27.27"></a><span id="l27.27" class="difflineplus">+    this.wrappedJSObject = this;</span>
<a href="#l27.28"></a><span id="l27.28"> }</span>
<a href="#l27.29"></a><span id="l27.29"> </span>
<a href="#l27.30"></a><span id="l27.30"> calProtocolHandler.prototype = {</span>
<a href="#l27.31"></a><span id="l27.31" class="difflineminus">-    getInterfaces: function cP_getInterfaces(aCount) {</span>
<a href="#l27.32"></a><span id="l27.32" class="difflineminus">-        const interfaces = [Components.interfaces.nsIProtocolHandler,</span>
<a href="#l27.33"></a><span id="l27.33" class="difflineminus">-                            Components.interfaces.nsIClassInfo,</span>
<a href="#l27.34"></a><span id="l27.34" class="difflineminus">-                            Components.interfaces.nsISupports];</span>
<a href="#l27.35"></a><span id="l27.35" class="difflineminus">-</span>
<a href="#l27.36"></a><span id="l27.36" class="difflineminus">-        aCount.value = interfaces.length;</span>
<a href="#l27.37"></a><span id="l27.37" class="difflineminus">-        return interfaces;</span>
<a href="#l27.38"></a><span id="l27.38" class="difflineminus">-    },</span>
<a href="#l27.39"></a><span id="l27.39" class="difflineminus">-    getHelperForLanguage: function cP_getHelperForLanguage(aLang) {</span>
<a href="#l27.40"></a><span id="l27.40" class="difflineminus">-        return null;</span>
<a href="#l27.41"></a><span id="l27.41" class="difflineminus">-    },</span>
<a href="#l27.42"></a><span id="l27.42" class="difflineminus">-    classDescription: &quot;Calendar webcal(s) protocal handler&quot;,</span>
<a href="#l27.43"></a><span id="l27.43" class="difflineminus">-    /* classID/contractID is filled in at the end of this file */</span>
<a href="#l27.44"></a><span id="l27.44" class="difflineminus">-    implementationLanguage: Components.interfaces.nsIProgrammingLanguage.JAVASCRIPT,</span>
<a href="#l27.45"></a><span id="l27.45" class="difflineminus">-    flags: 0,</span>
<a href="#l27.46"></a><span id="l27.46" class="difflineminus">-</span>
<a href="#l27.47"></a><span id="l27.47" class="difflineminus">-    QueryInterface: function cph_QueryInterface(aIID) {</span>
<a href="#l27.48"></a><span id="l27.48" class="difflineminus">-        return cal.doQueryInterface(this, calProtocolHandler.prototype, aIID, null, this);</span>
<a href="#l27.49"></a><span id="l27.49" class="difflineminus">-    },</span>
<a href="#l27.50"></a><span id="l27.50" class="difflineminus">-</span>
<a href="#l27.51"></a><span id="l27.51" class="difflineminus">-    get defaultPort() {</span>
<a href="#l27.52"></a><span id="l27.52" class="difflineminus">-        return this.mHttpProtocol.defaultPort;</span>
<a href="#l27.53"></a><span id="l27.53" class="difflineminus">-    },</span>
<a href="#l27.54"></a><span id="l27.54" class="difflineminus">-</span>
<a href="#l27.55"></a><span id="l27.55" class="difflineminus">-    get protocolFlags() {</span>
<a href="#l27.56"></a><span id="l27.56" class="difflineminus">-        return this.mHttpProtocol.protocolFlags;</span>
<a href="#l27.57"></a><span id="l27.57" class="difflineminus">-    },</span>
<a href="#l27.58"></a><span id="l27.58" class="difflineplus">+    get defaultPort() this.mHttpProtocol.defaultPort,</span>
<a href="#l27.59"></a><span id="l27.59" class="difflineplus">+    get protocolFlags() this.mHttpProtocol.protocolFlags,</span>
<a href="#l27.60"></a><span id="l27.60"> </span>
<a href="#l27.61"></a><span id="l27.61">     newURI: function cph_newURI(aSpec, anOriginalCharset, aBaseURI) {</span>
<a href="#l27.62"></a><span id="l27.62">         var uri = Components.classes[&quot;@mozilla.org/network/standard-url;1&quot;].</span>
<a href="#l27.63"></a><span id="l27.63">                              createInstance(Components.interfaces.nsIStandardURL);</span>
<a href="#l27.64"></a><span id="l27.64">         uri.init(Components.interfaces.nsIStandardURL.URLTYPE_STANDARD, </span>
<a href="#l27.65"></a><span id="l27.65">                  this.mHttpProtocol.defaultPort, aSpec, anOriginalCharset, aBaseURI);</span>
<a href="#l27.66"></a><span id="l27.66">         return uri;</span>
<a href="#l27.67"></a><span id="l27.67">     },</span>
<a href="#l27.68"></a><span id="l27.68" class="difflineat">@@ -67,25 +44,39 @@ calProtocolHandler.prototype = {</span>
<a href="#l27.69"></a><span id="l27.69">         var uri = aUri.clone();</span>
<a href="#l27.70"></a><span id="l27.70">         uri.scheme = this.mHttpProtocol.scheme;</span>
<a href="#l27.71"></a><span id="l27.71"> </span>
<a href="#l27.72"></a><span id="l27.72">         var channel = Services.io.newChannelFromURI(uri, null);</span>
<a href="#l27.73"></a><span id="l27.73">         channel.originalURI = aUri;</span>
<a href="#l27.74"></a><span id="l27.74">         return channel;</span>
<a href="#l27.75"></a><span id="l27.75">     },</span>
<a href="#l27.76"></a><span id="l27.76">     </span>
<a href="#l27.77"></a><span id="l27.77" class="difflineminus">-    allowPort: function cph_allowPort(aPort, aScheme) {</span>
<a href="#l27.78"></a><span id="l27.78" class="difflineminus">-        // We are not overriding any special ports</span>
<a href="#l27.79"></a><span id="l27.79" class="difflineminus">-        return false;</span>
<a href="#l27.80"></a><span id="l27.80" class="difflineminus">-    }</span>
<a href="#l27.81"></a><span id="l27.81" class="difflineplus">+    // We are not overriding any special ports</span>
<a href="#l27.82"></a><span id="l27.82" class="difflineplus">+    allowPort: function cph_allowPort(aPort, aScheme) false</span>
<a href="#l27.83"></a><span id="l27.83"> };</span>
<a href="#l27.84"></a><span id="l27.84"> </span>
<a href="#l27.85"></a><span id="l27.85" class="difflineplus">+const calProtocolHandlerWebcalClassID = Components.ID(&quot;{1153c73a-39be-46aa-9ba9-656d188865ca}&quot;);</span>
<a href="#l27.86"></a><span id="l27.86" class="difflineplus">+const calProtocolHandlerWebcalInterfaces = [Components.interfaces.nsIProtocolHandler];</span>
<a href="#l27.87"></a><span id="l27.87"> calProtocolHandlerWebcal.prototype = {</span>
<a href="#l27.88"></a><span id="l27.88">     __proto__: calProtocolHandler.prototype,</span>
<a href="#l27.89"></a><span id="l27.89" class="difflineminus">-    contractID: &quot;@mozilla.org/network/protocol;1?name=webcal&quot;,</span>
<a href="#l27.90"></a><span id="l27.90" class="difflineminus">-    classID: Components.ID(&quot;{1153c73a-39be-46aa-9ba9-656d188865ca}&quot;)</span>
<a href="#l27.91"></a><span id="l27.91" class="difflineplus">+    classID: calProtocolHandlerWebcalClassID,</span>
<a href="#l27.92"></a><span id="l27.92" class="difflineplus">+    QueryInterface: XPCOMUtils.generateQI(calProtocolHandlerWebcalInterfaces),</span>
<a href="#l27.93"></a><span id="l27.93" class="difflineplus">+    classInfo: XPCOMUtils.generateCI({</span>
<a href="#l27.94"></a><span id="l27.94" class="difflineplus">+        classID: calProtocolHandlerWebcalClassID,</span>
<a href="#l27.95"></a><span id="l27.95" class="difflineplus">+        contractID: &quot;@mozilla.org/network/protocol;1?name=webcal&quot;,</span>
<a href="#l27.96"></a><span id="l27.96" class="difflineplus">+        classDescription: &quot;Calendar webcal protocal handler&quot;,</span>
<a href="#l27.97"></a><span id="l27.97" class="difflineplus">+        interfaces: calProtocolHandlerWebcalInterfaces</span>
<a href="#l27.98"></a><span id="l27.98" class="difflineplus">+    }),</span>
<a href="#l27.99"></a><span id="l27.99"> };</span>
<a href="#l27.100"></a><span id="l27.100" class="difflineplus">+</span>
<a href="#l27.101"></a><span id="l27.101" class="difflineplus">+const calProtocolHandlerWebcalsClassID = Components.ID(&quot;{bdf71224-365d-4493-856a-a7e74026f766}&quot;);</span>
<a href="#l27.102"></a><span id="l27.102" class="difflineplus">+const calProtocolHandlerWebcalsInterfaces = [Components.interfaces.nsIProtocolHandler];</span>
<a href="#l27.103"></a><span id="l27.103"> calProtocolHandlerWebcals.prototype = {</span>
<a href="#l27.104"></a><span id="l27.104">     __proto__: calProtocolHandler.prototype,</span>
<a href="#l27.105"></a><span id="l27.105" class="difflineminus">-    contractID: &quot;@mozilla.org/network/protocol;1?name=webcals&quot;,</span>
<a href="#l27.106"></a><span id="l27.106" class="difflineminus">-    classID: Components.ID(&quot;{bdf71224-365d-4493-856a-a7e74026f766}&quot;)</span>
<a href="#l27.107"></a><span id="l27.107" class="difflineplus">+    classID: calProtocolHandlerWebcalsClassID,</span>
<a href="#l27.108"></a><span id="l27.108" class="difflineplus">+    QueryInterface: XPCOMUtils.generateQI(calProtocolHandlerWebcalsInterfaces),</span>
<a href="#l27.109"></a><span id="l27.109" class="difflineplus">+    classInfo: XPCOMUtils.generateCI({</span>
<a href="#l27.110"></a><span id="l27.110" class="difflineplus">+        classID: calProtocolHandlerWebcalsClassID,</span>
<a href="#l27.111"></a><span id="l27.111" class="difflineplus">+        contractID: &quot;@mozilla.org/network/protocol;1?name=webcals&quot;,</span>
<a href="#l27.112"></a><span id="l27.112" class="difflineplus">+        classDescription: &quot;Calendar webcals protocal handler&quot;,</span>
<a href="#l27.113"></a><span id="l27.113" class="difflineplus">+        interfaces: calProtocolHandlerWebcalsInterfaces</span>
<a href="#l27.114"></a><span id="l27.114" class="difflineplus">+    }),</span>
<a href="#l27.115"></a><span id="l27.115"> };</span>
<a href="#l27.116"></a><span id="l27.116" class="difflineminus">-</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l28.1"></a><span id="l28.1" class="difflineminus">--- a/calendar/base/src/calRecurrenceDate.js</span>
<a href="#l28.2"></a><span id="l28.2" class="difflineplus">+++ b/calendar/base/src/calRecurrenceDate.js</span>
<a href="#l28.3"></a><span id="l28.3" class="difflineat">@@ -1,31 +1,34 @@</span>
<a href="#l28.4"></a><span id="l28.4"> /* This Source Code Form is subject to the terms of the Mozilla Public</span>
<a href="#l28.5"></a><span id="l28.5">  * License, v. 2.0. If a copy of the MPL was not distributed with this</span>
<a href="#l28.6"></a><span id="l28.6">  * file, You can obtain one at http://mozilla.org/MPL/2.0/. */</span>
<a href="#l28.7"></a><span id="l28.7"> </span>
<a href="#l28.8"></a><span id="l28.8"> Components.utils.import(&quot;resource:///modules/XPCOMUtils.jsm&quot;);</span>
<a href="#l28.9"></a><span id="l28.9"> Components.utils.import(&quot;resource://calendar/modules/calUtils.jsm&quot;);</span>
<a href="#l28.10"></a><span id="l28.10"> </span>
<a href="#l28.11"></a><span id="l28.11"> function calRecurrenceDate() {</span>
<a href="#l28.12"></a><span id="l28.12" class="difflineplus">+    this.wrappedJSObject = this;</span>
<a href="#l28.13"></a><span id="l28.13"> }</span>
<a href="#l28.14"></a><span id="l28.14"> </span>
<a href="#l28.15"></a><span id="l28.15" class="difflineplus">+const calRecurrenceDateClassID = Components.ID(&quot;{806b6423-3aaa-4b26-afa3-de60563e9cec}&quot;);</span>
<a href="#l28.16"></a><span id="l28.16" class="difflineplus">+const calRecurrenceDateInterfaces = [Components.interfaces.calIRecurrenceDate];</span>
<a href="#l28.17"></a><span id="l28.17"> calRecurrenceDate.prototype = {</span>
<a href="#l28.18"></a><span id="l28.18">     isMutable: true,</span>
<a href="#l28.19"></a><span id="l28.19"> </span>
<a href="#l28.20"></a><span id="l28.20">     mIsNegative: false,</span>
<a href="#l28.21"></a><span id="l28.21">     mDate: null,</span>
<a href="#l28.22"></a><span id="l28.22"> </span>
<a href="#l28.23"></a><span id="l28.23" class="difflineminus">-    classID: Components.ID(&quot;{806b6423-3aaa-4b26-afa3-de60563e9cec}&quot;),</span>
<a href="#l28.24"></a><span id="l28.24" class="difflineminus">-    QueryInterface: XPCOMUtils.generateQI([Components.interfaces.calIRecurrenceDate]),</span>
<a href="#l28.25"></a><span id="l28.25" class="difflineplus">+    classID: calRecurrenceDateClassID,</span>
<a href="#l28.26"></a><span id="l28.26" class="difflineplus">+    QueryInterface: XPCOMUtils.generateQI(calRecurrenceDateInterfaces),</span>
<a href="#l28.27"></a><span id="l28.27">     classInfo: XPCOMUtils.generateCI({</span>
<a href="#l28.28"></a><span id="l28.28" class="difflineminus">-        classID: Components.ID(&quot;{806b6423-3aaa-4b26-afa3-de60563e9cec}&quot;),</span>
<a href="#l28.29"></a><span id="l28.29" class="difflineplus">+        classID: calRecurrenceDateClassID,</span>
<a href="#l28.30"></a><span id="l28.30">         contractID: &quot;@mozilla.org/calendar/recurrence-date;1&quot;,</span>
<a href="#l28.31"></a><span id="l28.31" class="difflineminus">-        classDescription: &quot;The Date of an occurrence of a recurring item&quot;,</span>
<a href="#l28.32"></a><span id="l28.32" class="difflineminus">-        interfaces: [Components.interfaces.calIRecurrenceDate],</span>
<a href="#l28.33"></a><span id="l28.33" class="difflineplus">+        classDescription: &quot;The date of an occurrence of a recurring item&quot;,</span>
<a href="#l28.34"></a><span id="l28.34" class="difflineplus">+        interfaces: calRecurrenceDateInterfaces</span>
<a href="#l28.35"></a><span id="l28.35">     }),</span>
<a href="#l28.36"></a><span id="l28.36">     makeImmutable: function makeImmutable() {</span>
<a href="#l28.37"></a><span id="l28.37">         this.isMutable = false;</span>
<a href="#l28.38"></a><span id="l28.38">     },</span>
<a href="#l28.39"></a><span id="l28.39"> </span>
<a href="#l28.40"></a><span id="l28.40">     ensureMutable: function ensureMutable() {</span>
<a href="#l28.41"></a><span id="l28.41">         if (!this.isMutable) {</span>
<a href="#l28.42"></a><span id="l28.42">             throw Components.results.NS_ERROR_OBJECT_IS_MUTABLE;</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l29.1"></a><span id="l29.1" class="difflineminus">--- a/calendar/base/src/calRecurrenceInfo.js</span>
<a href="#l29.2"></a><span id="l29.2" class="difflineplus">+++ b/calendar/base/src/calRecurrenceInfo.js</span>
<a href="#l29.3"></a><span id="l29.3" class="difflineat">@@ -1,13 +1,14 @@</span>
<a href="#l29.4"></a><span id="l29.4"> /* This Source Code Form is subject to the terms of the Mozilla Public</span>
<a href="#l29.5"></a><span id="l29.5">  * License, v. 2.0. If a copy of the MPL was not distributed with this</span>
<a href="#l29.6"></a><span id="l29.6">  * file, You can obtain one at http://mozilla.org/MPL/2.0/. */</span>
<a href="#l29.7"></a><span id="l29.7"> </span>
<a href="#l29.8"></a><span id="l29.8"> Components.utils.import(&quot;resource://calendar/modules/calUtils.jsm&quot;);</span>
<a href="#l29.9"></a><span id="l29.9" class="difflineplus">+Components.utils.import(&quot;resource://gre/modules/XPCOMUtils.jsm&quot;);</span>
<a href="#l29.10"></a><span id="l29.10"> </span>
<a href="#l29.11"></a><span id="l29.11"> function getRidKey(dt) {</span>
<a href="#l29.12"></a><span id="l29.12">     if (!dt) {</span>
<a href="#l29.13"></a><span id="l29.13">         return null;</span>
<a href="#l29.14"></a><span id="l29.14">     }</span>
<a href="#l29.15"></a><span id="l29.15">     var tz = dt.timezone;</span>
<a href="#l29.16"></a><span id="l29.16">     if (!tz.isUTC &amp;&amp; !tz.isFloating) {</span>
<a href="#l29.17"></a><span id="l29.17">         dt = dt.getInTimezone(UTC());</span>
<a href="#l29.18"></a><span id="l29.18" class="difflineat">@@ -17,47 +18,34 @@ function getRidKey(dt) {</span>
<a href="#l29.19"></a><span id="l29.19"> </span>
<a href="#l29.20"></a><span id="l29.20"> function calRecurrenceInfo() {</span>
<a href="#l29.21"></a><span id="l29.21">     this.mRecurrenceItems = [];</span>
<a href="#l29.22"></a><span id="l29.22">     this.mExceptionMap = {};</span>
<a href="#l29.23"></a><span id="l29.23"> </span>
<a href="#l29.24"></a><span id="l29.24">     this.wrappedJSObject = this;</span>
<a href="#l29.25"></a><span id="l29.25"> }</span>
<a href="#l29.26"></a><span id="l29.26"> </span>
<a href="#l29.27"></a><span id="l29.27" class="difflineplus">+const calRecurrenceInfoClassID = Components.ID(&quot;{04027036-5884-4a30-b4af-f2cad79f6edf}&quot;);</span>
<a href="#l29.28"></a><span id="l29.28" class="difflineplus">+const calRecurrenceInfoInterfaces = [Components.interfaces.calIRecurrenceInfo];</span>
<a href="#l29.29"></a><span id="l29.29"> calRecurrenceInfo.prototype = {</span>
<a href="#l29.30"></a><span id="l29.30">     mImmutable: false,</span>
<a href="#l29.31"></a><span id="l29.31">     mBaseItem: null,</span>
<a href="#l29.32"></a><span id="l29.32">     mRecurrenceItems: null,</span>
<a href="#l29.33"></a><span id="l29.33">     mPositiveRules: null,</span>
<a href="#l29.34"></a><span id="l29.34">     mNegativeRules: null,</span>
<a href="#l29.35"></a><span id="l29.35">     mExceptionMap: null,</span>
<a href="#l29.36"></a><span id="l29.36"> </span>
<a href="#l29.37"></a><span id="l29.37" class="difflineminus">-    QueryInterface: function cRI_QueryInterface(aIID) {</span>
<a href="#l29.38"></a><span id="l29.38" class="difflineminus">-        return doQueryInterface(this, calRecurrenceInfo.__proto__, aIID, null, this);</span>
<a href="#l29.39"></a><span id="l29.39" class="difflineminus">-    },</span>
<a href="#l29.40"></a><span id="l29.40" class="difflineminus">-</span>
<a href="#l29.41"></a><span id="l29.41" class="difflineminus">-    /**</span>
<a href="#l29.42"></a><span id="l29.42" class="difflineminus">-     * nsIClassInfo</span>
<a href="#l29.43"></a><span id="l29.43" class="difflineminus">-     */</span>
<a href="#l29.44"></a><span id="l29.44" class="difflineminus">-    getInterfaces: function cRI_getInterfaces(aCount) {</span>
<a href="#l29.45"></a><span id="l29.45" class="difflineminus">-        const interfaces = [Components.interfaces.nsISupports,</span>
<a href="#l29.46"></a><span id="l29.46" class="difflineminus">-                            Components.interfaces.calIRecurrenceInfo,</span>
<a href="#l29.47"></a><span id="l29.47" class="difflineminus">-                            Components.interfaces.nsIClassInfo];</span>
<a href="#l29.48"></a><span id="l29.48" class="difflineminus">-</span>
<a href="#l29.49"></a><span id="l29.49" class="difflineminus">-        aCount.value = interfaces.length;</span>
<a href="#l29.50"></a><span id="l29.50" class="difflineminus">-        return interfaces;</span>
<a href="#l29.51"></a><span id="l29.51" class="difflineminus">-    },</span>
<a href="#l29.52"></a><span id="l29.52" class="difflineminus">-    getHelperForLanguage: function cRI_getHelperForLanguage(aLang) {</span>
<a href="#l29.53"></a><span id="l29.53" class="difflineminus">-        return null;</span>
<a href="#l29.54"></a><span id="l29.54" class="difflineminus">-    },</span>
<a href="#l29.55"></a><span id="l29.55" class="difflineminus">-    contractID: &quot;@mozilla.org/calendar/recurrence-info;1&quot;,</span>
<a href="#l29.56"></a><span id="l29.56" class="difflineminus">-    classDescription: &quot;Calendar Recurrence Info&quot;,</span>
<a href="#l29.57"></a><span id="l29.57" class="difflineminus">-    classID: Components.ID(&quot;{04027036-5884-4a30-b4af-f2cad79f6edf}&quot;),</span>
<a href="#l29.58"></a><span id="l29.58" class="difflineminus">-    implementationLanguage: Components.interfaces.nsIProgrammingLanguage.JAVASCRIPT,</span>
<a href="#l29.59"></a><span id="l29.59" class="difflineminus">-    flags: 0,</span>
<a href="#l29.60"></a><span id="l29.60" class="difflineplus">+    classID: calRecurrenceInfoClassID,</span>
<a href="#l29.61"></a><span id="l29.61" class="difflineplus">+    QueryInterface: XPCOMUtils.generateQI(calRecurrenceInfoInterfaces),</span>
<a href="#l29.62"></a><span id="l29.62" class="difflineplus">+    classInfo: XPCOMUtils.generateCI({</span>
<a href="#l29.63"></a><span id="l29.63" class="difflineplus">+        classID: calRecurrenceInfoClassID,</span>
<a href="#l29.64"></a><span id="l29.64" class="difflineplus">+        contractID: &quot;@mozilla.org/calendar/recurrence-info;1&quot;,</span>
<a href="#l29.65"></a><span id="l29.65" class="difflineplus">+        classDescription: &quot;Calendar Recurrence Info&quot;,</span>
<a href="#l29.66"></a><span id="l29.66" class="difflineplus">+        interfaces: calRecurrenceInfoInterfaces,</span>
<a href="#l29.67"></a><span id="l29.67" class="difflineplus">+    }),</span>
<a href="#l29.68"></a><span id="l29.68"> </span>
<a href="#l29.69"></a><span id="l29.69">     /**</span>
<a href="#l29.70"></a><span id="l29.70">      * Helpers</span>
<a href="#l29.71"></a><span id="l29.71">      */</span>
<a href="#l29.72"></a><span id="l29.72">     ensureBaseItem: function cRI_ensureBaseItem() {</span>
<a href="#l29.73"></a><span id="l29.73">         if (!this.mBaseItem) {</span>
<a href="#l29.74"></a><span id="l29.74">             throw Components.results.NS_ERROR_NOT_INITIALIZED;</span>
<a href="#l29.75"></a><span id="l29.75">         }</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l30.1"></a><span id="l30.1" class="difflineminus">--- a/calendar/base/src/calRelation.js</span>
<a href="#l30.2"></a><span id="l30.2" class="difflineplus">+++ b/calendar/base/src/calRelation.js</span>
<a href="#l30.3"></a><span id="l30.3" class="difflineat">@@ -1,63 +1,40 @@</span>
<a href="#l30.4"></a><span id="l30.4"> /* This Source Code Form is subject to the terms of the Mozilla Public</span>
<a href="#l30.5"></a><span id="l30.5">  * License, v. 2.0. If a copy of the MPL was not distributed with this</span>
<a href="#l30.6"></a><span id="l30.6">  * file, You can obtain one at http://mozilla.org/MPL/2.0/. */</span>
<a href="#l30.7"></a><span id="l30.7"> </span>
<a href="#l30.8"></a><span id="l30.8"> Components.utils.import(&quot;resource://calendar/modules/calIteratorUtils.jsm&quot;);</span>
<a href="#l30.9"></a><span id="l30.9"> Components.utils.import(&quot;resource://calendar/modules/calUtils.jsm&quot;);</span>
<a href="#l30.10"></a><span id="l30.10" class="difflineplus">+Components.utils.import(&quot;resource://gre/modules/XPCOMUtils.jsm&quot;);</span>
<a href="#l30.11"></a><span id="l30.11"> </span>
<a href="#l30.12"></a><span id="l30.12"> /**</span>
<a href="#l30.13"></a><span id="l30.13">  * calRelation prototype definition</span>
<a href="#l30.14"></a><span id="l30.14">  *</span>
<a href="#l30.15"></a><span id="l30.15">  * @implements calIRelation</span>
<a href="#l30.16"></a><span id="l30.16">  * @constructor</span>
<a href="#l30.17"></a><span id="l30.17">  */</span>
<a href="#l30.18"></a><span id="l30.18"> function calRelation() {</span>
<a href="#l30.19"></a><span id="l30.19">     this.wrappedJSObject = this;</span>
<a href="#l30.20"></a><span id="l30.20">     this.mProperties = new calPropertyBag();</span>
<a href="#l30.21"></a><span id="l30.21"> }</span>
<a href="#l30.22"></a><span id="l30.22" class="difflineminus">-</span>
<a href="#l30.23"></a><span id="l30.23" class="difflineplus">+const calRelationClassID = Components.ID(&quot;{76810fae-abad-4019-917a-08e95d5bbd68}&quot;);</span>
<a href="#l30.24"></a><span id="l30.24" class="difflineplus">+const calRelationInterfaces = [Components.interfaces.calIRelation];</span>
<a href="#l30.25"></a><span id="l30.25"> calRelation.prototype = {</span>
<a href="#l30.26"></a><span id="l30.26">     mType: null,</span>
<a href="#l30.27"></a><span id="l30.27">     mId: null,</span>
<a href="#l30.28"></a><span id="l30.28"> </span>
<a href="#l30.29"></a><span id="l30.29" class="difflineminus">-    /**</span>
<a href="#l30.30"></a><span id="l30.30" class="difflineminus">-     * @see nsISupports</span>
<a href="#l30.31"></a><span id="l30.31" class="difflineminus">-     */</span>
<a href="#l30.32"></a><span id="l30.32" class="difflineminus">-    QueryInterface: function (aIID) {</span>
<a href="#l30.33"></a><span id="l30.33" class="difflineminus">-        return doQueryInterface(this,</span>
<a href="#l30.34"></a><span id="l30.34" class="difflineminus">-                                calRelation.prototype,</span>
<a href="#l30.35"></a><span id="l30.35" class="difflineminus">-                                aIID,</span>
<a href="#l30.36"></a><span id="l30.36" class="difflineminus">-                                null,</span>
<a href="#l30.37"></a><span id="l30.37" class="difflineminus">-                                this);</span>
<a href="#l30.38"></a><span id="l30.38" class="difflineminus">-    },</span>
<a href="#l30.39"></a><span id="l30.39" class="difflineminus">-</span>
<a href="#l30.40"></a><span id="l30.40" class="difflineminus">-    /**</span>
<a href="#l30.41"></a><span id="l30.41" class="difflineminus">-     * @see nsIClassInfo</span>
<a href="#l30.42"></a><span id="l30.42" class="difflineminus">-     */</span>
<a href="#l30.43"></a><span id="l30.43" class="difflineminus">-    getInterfaces: function cR_getInterfaces(aCount) {</span>
<a href="#l30.44"></a><span id="l30.44" class="difflineminus">-        let ifaces = [</span>
<a href="#l30.45"></a><span id="l30.45" class="difflineminus">-            Components.interfaces.nsISupports,</span>
<a href="#l30.46"></a><span id="l30.46" class="difflineminus">-            Components.interfaces.calIRelation,</span>
<a href="#l30.47"></a><span id="l30.47" class="difflineminus">-            Components.interfaces.nsIClassInfo</span>
<a href="#l30.48"></a><span id="l30.48" class="difflineminus">-        ];</span>
<a href="#l30.49"></a><span id="l30.49" class="difflineminus">-        aCount.value = ifaces.length;</span>
<a href="#l30.50"></a><span id="l30.50" class="difflineminus">-        return ifaces;</span>
<a href="#l30.51"></a><span id="l30.51" class="difflineminus">-    },</span>
<a href="#l30.52"></a><span id="l30.52" class="difflineminus">-</span>
<a href="#l30.53"></a><span id="l30.53" class="difflineminus">-    getHelperForLanguage: function cR_getHelperForLanguage(language) {</span>
<a href="#l30.54"></a><span id="l30.54" class="difflineminus">-        return null;</span>
<a href="#l30.55"></a><span id="l30.55" class="difflineminus">-    },</span>
<a href="#l30.56"></a><span id="l30.56" class="difflineminus">-</span>
<a href="#l30.57"></a><span id="l30.57" class="difflineminus">-    contractID: &quot;@mozilla.org/calendar/relation;1&quot;,</span>
<a href="#l30.58"></a><span id="l30.58" class="difflineminus">-    classDescription: &quot;Calendar Item Relation&quot;,</span>
<a href="#l30.59"></a><span id="l30.59" class="difflineminus">-    classID: Components.ID(&quot;{76810fae-abad-4019-917a-08e95d5bbd68}&quot;),</span>
<a href="#l30.60"></a><span id="l30.60" class="difflineminus">-    implementationLanguage: Components.interfaces.nsIProgrammingLanguage.JAVASCRIPT,</span>
<a href="#l30.61"></a><span id="l30.61" class="difflineminus">-    flags: 0,</span>
<a href="#l30.62"></a><span id="l30.62" class="difflineplus">+    classID: calRelationClassID,</span>
<a href="#l30.63"></a><span id="l30.63" class="difflineplus">+    QueryInterface: XPCOMUtils.generateQI(calRelationInterfaces),</span>
<a href="#l30.64"></a><span id="l30.64" class="difflineplus">+    classInfo: XPCOMUtils.generateCI({</span>
<a href="#l30.65"></a><span id="l30.65" class="difflineplus">+        classID: calRelationClassID,</span>
<a href="#l30.66"></a><span id="l30.66" class="difflineplus">+        contractID: &quot;@mozilla.org/calendar/relation;1&quot;,</span>
<a href="#l30.67"></a><span id="l30.67" class="difflineplus">+        classDescription: &quot;Calendar Item Relation&quot;,</span>
<a href="#l30.68"></a><span id="l30.68" class="difflineplus">+        interfaces: calRelationInterfaces</span>
<a href="#l30.69"></a><span id="l30.69" class="difflineplus">+    }),</span>
<a href="#l30.70"></a><span id="l30.70"> </span>
<a href="#l30.71"></a><span id="l30.71">     /**</span>
<a href="#l30.72"></a><span id="l30.72">      * @see calIRelation</span>
<a href="#l30.73"></a><span id="l30.73">      */</span>
<a href="#l30.74"></a><span id="l30.74"> </span>
<a href="#l30.75"></a><span id="l30.75">     get relType() {</span>
<a href="#l30.76"></a><span id="l30.76">         return this.mType;</span>
<a href="#l30.77"></a><span id="l30.77">     },</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l31.1"></a><span id="l31.1" class="difflineminus">--- a/calendar/base/src/calTimezoneService.js</span>
<a href="#l31.2"></a><span id="l31.2" class="difflineplus">+++ b/calendar/base/src/calTimezoneService.js</span>
<a href="#l31.3"></a><span id="l31.3" class="difflineat">@@ -15,22 +15,17 @@ function calIntrinsicTimezone(tzid, comp</span>
<a href="#l31.4"></a><span id="l31.4">     this.tzid = tzid;</span>
<a href="#l31.5"></a><span id="l31.5">     this.mComponent = component;</span>
<a href="#l31.6"></a><span id="l31.6">     this.isUTC = false;</span>
<a href="#l31.7"></a><span id="l31.7">     this.isFloating = false;</span>
<a href="#l31.8"></a><span id="l31.8">     this.latitude = latitude;</span>
<a href="#l31.9"></a><span id="l31.9">     this.longitude = longitude;</span>
<a href="#l31.10"></a><span id="l31.10"> }</span>
<a href="#l31.11"></a><span id="l31.11"> calIntrinsicTimezone.prototype = {</span>
<a href="#l31.12"></a><span id="l31.12" class="difflineminus">-    QueryInterface: function QueryInterface(aIID) {</span>
<a href="#l31.13"></a><span id="l31.13" class="difflineminus">-        return cal.doQueryInterface(this, calIntrinsicTimezone, aIID, [</span>
<a href="#l31.14"></a><span id="l31.14" class="difflineminus">-            Components.interfaces.calITimezone,</span>
<a href="#l31.15"></a><span id="l31.15" class="difflineminus">-            Components.interfaces.nsISupports</span>
<a href="#l31.16"></a><span id="l31.16" class="difflineminus">-        ]);</span>
<a href="#l31.17"></a><span id="l31.17" class="difflineminus">-    },</span>
<a href="#l31.18"></a><span id="l31.18" class="difflineplus">+    QueryInterface: XPCOMUtils.generateQI([Components.interfaces.calITimezone]),</span>
<a href="#l31.19"></a><span id="l31.19">     toString: function calIntrinsicTimezone_toString() {</span>
<a href="#l31.20"></a><span id="l31.20">         return (this.component ? this.component.toString() : this.tzid);</span>
<a href="#l31.21"></a><span id="l31.21">     },</span>
<a href="#l31.22"></a><span id="l31.22"> </span>
<a href="#l31.23"></a><span id="l31.23">     get icalComponent() {</span>
<a href="#l31.24"></a><span id="l31.24">         var comp = this.mComponent;</span>
<a href="#l31.25"></a><span id="l31.25">         if (comp &amp;&amp; (typeof(comp) == &quot;string&quot;)) {</span>
<a href="#l31.26"></a><span id="l31.26">             this.mComponent = cal.getIcsService().parseICS(&quot;BEGIN:VCALENDAR\r\n&quot; + comp + &quot;END:VCALENDAR\r\n&quot;, null)</span>
<a href="#l31.27"></a><span id="l31.27" class="difflineat">@@ -75,48 +70,40 @@ calStringEnumerator.prototype = {</span>
<a href="#l31.28"></a><span id="l31.28"> };</span>
<a href="#l31.29"></a><span id="l31.29"> </span>
<a href="#l31.30"></a><span id="l31.30"> function calTimezoneService() {</span>
<a href="#l31.31"></a><span id="l31.31">     this.wrappedJSObject = this;</span>
<a href="#l31.32"></a><span id="l31.32"> </span>
<a href="#l31.33"></a><span id="l31.33">     this.mTimezoneCache = {};</span>
<a href="#l31.34"></a><span id="l31.34">     this.mBlacklist = {};</span>
<a href="#l31.35"></a><span id="l31.35"> }</span>
<a href="#l31.36"></a><span id="l31.36" class="difflineplus">+const calTimezoneServiceClassID = Components.ID(&quot;{e736f2bd-7640-4715-ab35-887dc866c587}&quot;);</span>
<a href="#l31.37"></a><span id="l31.37" class="difflineplus">+const calTimezoneServiceInterfaces = [</span>
<a href="#l31.38"></a><span id="l31.38" class="difflineplus">+    Components.interfaces.calITimezoneService,</span>
<a href="#l31.39"></a><span id="l31.39" class="difflineplus">+    Components.interfaces.calITimezoneProvider,</span>
<a href="#l31.40"></a><span id="l31.40" class="difflineplus">+    Components.interfaces.calIStartupService</span>
<a href="#l31.41"></a><span id="l31.41" class="difflineplus">+];</span>
<a href="#l31.42"></a><span id="l31.42"> calTimezoneService.prototype = {</span>
<a href="#l31.43"></a><span id="l31.43">     mTimezoneCache: null,</span>
<a href="#l31.44"></a><span id="l31.44">     mBlacklist: null,</span>
<a href="#l31.45"></a><span id="l31.45">     mDefaultTimezone: null,</span>
<a href="#l31.46"></a><span id="l31.46">     mHasSetupObservers: false,</span>
<a href="#l31.47"></a><span id="l31.47">     mFloating: null,</span>
<a href="#l31.48"></a><span id="l31.48">     mUTC: null,</span>
<a href="#l31.49"></a><span id="l31.49">     mDb: null,</span>
<a href="#l31.50"></a><span id="l31.50"> </span>
<a href="#l31.51"></a><span id="l31.51" class="difflineminus">-</span>
<a href="#l31.52"></a><span id="l31.52" class="difflineminus">-    // nsIClassInfo:</span>
<a href="#l31.53"></a><span id="l31.53" class="difflineminus">-    getInterfaces: function calTimezoneService_getInterfaces(count) {</span>
<a href="#l31.54"></a><span id="l31.54" class="difflineminus">-        const ifaces = [Components.interfaces.calITimezoneService,</span>
<a href="#l31.55"></a><span id="l31.55" class="difflineminus">-                        Components.interfaces.calITimezoneProvider,</span>
<a href="#l31.56"></a><span id="l31.56" class="difflineminus">-                        Components.interfaces.calIStartupService,</span>
<a href="#l31.57"></a><span id="l31.57" class="difflineminus">-                        Components.interfaces.nsIClassInfo,</span>
<a href="#l31.58"></a><span id="l31.58" class="difflineminus">-                        Components.interfaces.nsISupports];</span>
<a href="#l31.59"></a><span id="l31.59" class="difflineminus">-        count.value = ifaces.length;</span>
<a href="#l31.60"></a><span id="l31.60" class="difflineminus">-        return ifaces;</span>
<a href="#l31.61"></a><span id="l31.61" class="difflineminus">-    },</span>
<a href="#l31.62"></a><span id="l31.62" class="difflineminus">-    classDescription: &quot;Calendar Timezone Service&quot;,</span>
<a href="#l31.63"></a><span id="l31.63" class="difflineminus">-    contractID: &quot;@mozilla.org/calendar/timezone-service;1&quot;,</span>
<a href="#l31.64"></a><span id="l31.64" class="difflineminus">-    classID: Components.ID(&quot;{e736f2bd-7640-4715-ab35-887dc866c587}&quot;),</span>
<a href="#l31.65"></a><span id="l31.65" class="difflineminus">-    getHelperForLanguage: function calTimezoneService_getHelperForLanguage(language) {</span>
<a href="#l31.66"></a><span id="l31.66" class="difflineminus">-        return null;</span>
<a href="#l31.67"></a><span id="l31.67" class="difflineminus">-    },</span>
<a href="#l31.68"></a><span id="l31.68" class="difflineminus">-    implementationLanguage: Components.interfaces.nsIProgrammingLanguage.JAVASCRIPT,</span>
<a href="#l31.69"></a><span id="l31.69" class="difflineminus">-    flags: Components.interfaces.nsIClassInfo.SINGLETON,</span>
<a href="#l31.70"></a><span id="l31.70" class="difflineminus">-</span>
<a href="#l31.71"></a><span id="l31.71" class="difflineminus">-    QueryInterface: function calTimezoneService_QueryInterface(aIID) {</span>
<a href="#l31.72"></a><span id="l31.72" class="difflineminus">-        return cal.doQueryInterface(this, calTimezoneService.prototype, aIID, null, this);</span>
<a href="#l31.73"></a><span id="l31.73" class="difflineminus">-    },</span>
<a href="#l31.74"></a><span id="l31.74" class="difflineplus">+    classID: calTimezoneServiceClassID,</span>
<a href="#l31.75"></a><span id="l31.75" class="difflineplus">+    QueryInterface: XPCOMUtils.generateQI(calTimezoneServiceInterfaces),</span>
<a href="#l31.76"></a><span id="l31.76" class="difflineplus">+    classInfo: XPCOMUtils.generateCI({</span>
<a href="#l31.77"></a><span id="l31.77" class="difflineplus">+        classID: calTimezoneServiceClassID,</span>
<a href="#l31.78"></a><span id="l31.78" class="difflineplus">+        contractID: &quot;@mozilla.org/calendar/timezone-service;1&quot;,</span>
<a href="#l31.79"></a><span id="l31.79" class="difflineplus">+        classDescription: &quot;Calendar Timezone Service&quot;,</span>
<a href="#l31.80"></a><span id="l31.80" class="difflineplus">+        interfaces: calTimezoneServiceInterfaces,</span>
<a href="#l31.81"></a><span id="l31.81" class="difflineplus">+        flags: Components.interfaces.nsIClassInfo.SINGLETON</span>
<a href="#l31.82"></a><span id="l31.82" class="difflineplus">+    }),</span>
<a href="#l31.83"></a><span id="l31.83"> </span>
<a href="#l31.84"></a><span id="l31.84">     // calIStartupService:</span>
<a href="#l31.85"></a><span id="l31.85">     startup: function startup(aCompleteListener) {</span>
<a href="#l31.86"></a><span id="l31.86">         this.ensureInitialized(aCompleteListener);</span>
<a href="#l31.87"></a><span id="l31.87">     },</span>
<a href="#l31.88"></a><span id="l31.88"> </span>
<a href="#l31.89"></a><span id="l31.89">     shutdown: function shutdown(aCompleteListener) {</span>
<a href="#l31.90"></a><span id="l31.90">         Services.prefs.removeObserver(&quot;calendar.timezone.local&quot;, this);</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l32.1"></a><span id="l32.1" class="difflineminus">--- a/calendar/base/src/calTodo.js</span>
<a href="#l32.2"></a><span id="l32.2" class="difflineplus">+++ b/calendar/base/src/calTodo.js</span>
<a href="#l32.3"></a><span id="l32.3" class="difflineat">@@ -1,57 +1,47 @@</span>
<a href="#l32.4"></a><span id="l32.4"> /* This Source Code Form is subject to the terms of the Mozilla Public</span>
<a href="#l32.5"></a><span id="l32.5">  * License, v. 2.0. If a copy of the MPL was not distributed with this</span>
<a href="#l32.6"></a><span id="l32.6">  * file, You can obtain one at http://mozilla.org/MPL/2.0/. */</span>
<a href="#l32.7"></a><span id="l32.7"> </span>
<a href="#l32.8"></a><span id="l32.8"> Components.utils.import(&quot;resource://calendar/modules/calUtils.jsm&quot;);</span>
<a href="#l32.9"></a><span id="l32.9" class="difflineplus">+Components.utils.import(&quot;resource://gre/modules/XPCOMUtils.jsm&quot;);</span>
<a href="#l32.10"></a><span id="l32.10"> </span>
<a href="#l32.11"></a><span id="l32.11"> //</span>
<a href="#l32.12"></a><span id="l32.12"> // constructor</span>
<a href="#l32.13"></a><span id="l32.13"> //</span>
<a href="#l32.14"></a><span id="l32.14"> function calTodo() {</span>
<a href="#l32.15"></a><span id="l32.15">     this.initItemBase();</span>
<a href="#l32.16"></a><span id="l32.16"> </span>
<a href="#l32.17"></a><span id="l32.17">     this.todoPromotedProps = {</span>
<a href="#l32.18"></a><span id="l32.18">         &quot;DTSTART&quot;: true,</span>
<a href="#l32.19"></a><span id="l32.19">         &quot;DTEND&quot;: true,</span>
<a href="#l32.20"></a><span id="l32.20">         &quot;DUE&quot;: true,</span>
<a href="#l32.21"></a><span id="l32.21">         &quot;COMPLETED&quot;: true,</span>
<a href="#l32.22"></a><span id="l32.22">         __proto__: this.itemBasePromotedProps</span>
<a href="#l32.23"></a><span id="l32.23">     };</span>
<a href="#l32.24"></a><span id="l32.24"> }</span>
<a href="#l32.25"></a><span id="l32.25"> </span>
<a href="#l32.26"></a><span id="l32.26" class="difflineplus">+const calTodoClassID = Components.ID(&quot;{7af51168-6abe-4a31-984d-6f8a3989212d}&quot;);</span>
<a href="#l32.27"></a><span id="l32.27" class="difflineplus">+const calTodoInterfaces = [</span>
<a href="#l32.28"></a><span id="l32.28" class="difflineplus">+    Components.interfaces.calIItemBase,</span>
<a href="#l32.29"></a><span id="l32.29" class="difflineplus">+    Components.interfaces.calITodo,</span>
<a href="#l32.30"></a><span id="l32.30" class="difflineplus">+    Components.interfaces.calIInternalShallowCopy</span>
<a href="#l32.31"></a><span id="l32.31" class="difflineplus">+];</span>
<a href="#l32.32"></a><span id="l32.32"> calTodo.prototype = {</span>
<a href="#l32.33"></a><span id="l32.33">     __proto__: calItemBase.prototype,</span>
<a href="#l32.34"></a><span id="l32.34"> </span>
<a href="#l32.35"></a><span id="l32.35" class="difflineminus">-    getInterfaces: function (count) {</span>
<a href="#l32.36"></a><span id="l32.36" class="difflineminus">-        var ifaces = [</span>
<a href="#l32.37"></a><span id="l32.37" class="difflineminus">-            Components.interfaces.nsISupports,</span>
<a href="#l32.38"></a><span id="l32.38" class="difflineminus">-            Components.interfaces.calIItemBase,</span>
<a href="#l32.39"></a><span id="l32.39" class="difflineminus">-            Components.interfaces.calITodo,</span>
<a href="#l32.40"></a><span id="l32.40" class="difflineminus">-            Components.interfaces.calIInternalShallowCopy,</span>
<a href="#l32.41"></a><span id="l32.41" class="difflineminus">-            Components.interfaces.nsIClassInfo</span>
<a href="#l32.42"></a><span id="l32.42" class="difflineminus">-        ];</span>
<a href="#l32.43"></a><span id="l32.43" class="difflineminus">-        count.value = ifaces.length;</span>
<a href="#l32.44"></a><span id="l32.44" class="difflineminus">-        return ifaces;</span>
<a href="#l32.45"></a><span id="l32.45" class="difflineminus">-    },</span>
<a href="#l32.46"></a><span id="l32.46" class="difflineminus">-</span>
<a href="#l32.47"></a><span id="l32.47" class="difflineminus">-    getHelperForLanguage: function (language) {</span>
<a href="#l32.48"></a><span id="l32.48" class="difflineminus">-        return null;</span>
<a href="#l32.49"></a><span id="l32.49" class="difflineminus">-    },</span>
<a href="#l32.50"></a><span id="l32.50" class="difflineminus">-</span>
<a href="#l32.51"></a><span id="l32.51" class="difflineminus">-    contractID: &quot;@mozilla.org/calendar/todo;1&quot;,</span>
<a href="#l32.52"></a><span id="l32.52" class="difflineminus">-    classDescription: &quot;Calendar Todo&quot;,</span>
<a href="#l32.53"></a><span id="l32.53" class="difflineminus">-    classID: Components.ID(&quot;{7af51168-6abe-4a31-984d-6f8a3989212d}&quot;),</span>
<a href="#l32.54"></a><span id="l32.54" class="difflineminus">-    implementationLanguage: Components.interfaces.nsIProgrammingLanguage.JAVASCRIPT,</span>
<a href="#l32.55"></a><span id="l32.55" class="difflineminus">-    flags: 0,</span>
<a href="#l32.56"></a><span id="l32.56" class="difflineminus">-</span>
<a href="#l32.57"></a><span id="l32.57" class="difflineminus">-    QueryInterface: function (aIID) {</span>
<a href="#l32.58"></a><span id="l32.58" class="difflineminus">-        return cal.doQueryInterface(this, calTodo.prototype, aIID, null, this);</span>
<a href="#l32.59"></a><span id="l32.59" class="difflineminus">-    },</span>
<a href="#l32.60"></a><span id="l32.60" class="difflineplus">+    classID: calTodoClassID,</span>
<a href="#l32.61"></a><span id="l32.61" class="difflineplus">+    QueryInterface: XPCOMUtils.generateQI(calTodoInterfaces),</span>
<a href="#l32.62"></a><span id="l32.62" class="difflineplus">+    classInfo: XPCOMUtils.generateCI({</span>
<a href="#l32.63"></a><span id="l32.63" class="difflineplus">+        classID: calTodoClassID,</span>
<a href="#l32.64"></a><span id="l32.64" class="difflineplus">+        contractID: &quot;@mozilla.org/calendar/todo;1&quot;,</span>
<a href="#l32.65"></a><span id="l32.65" class="difflineplus">+        classDescription: &quot;Calendar Todo&quot;,</span>
<a href="#l32.66"></a><span id="l32.66" class="difflineplus">+        interfaces: calTodoInterfaces,</span>
<a href="#l32.67"></a><span id="l32.67" class="difflineplus">+    }),</span>
<a href="#l32.68"></a><span id="l32.68"> </span>
<a href="#l32.69"></a><span id="l32.69">     cloneShallow: function (aNewParent) {</span>
<a href="#l32.70"></a><span id="l32.70">         let m = new calTodo();</span>
<a href="#l32.71"></a><span id="l32.71">         this.cloneItemBaseInto(m, aNewParent);</span>
<a href="#l32.72"></a><span id="l32.72">         return m;</span>
<a href="#l32.73"></a><span id="l32.73">     },</span>
<a href="#l32.74"></a><span id="l32.74"> </span>
<a href="#l32.75"></a><span id="l32.75">     createProxy: function calTodo_createProxy(aRecurrenceId) {</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l33.1"></a><span id="l33.1" class="difflineminus">--- a/calendar/base/src/calTransactionManager.js</span>
<a href="#l33.2"></a><span id="l33.2" class="difflineplus">+++ b/calendar/base/src/calTransactionManager.js</span>
<a href="#l33.3"></a><span id="l33.3" class="difflineat">@@ -1,47 +1,39 @@</span>
<a href="#l33.4"></a><span id="l33.4"> /* This Source Code Form is subject to the terms of the Mozilla Public</span>
<a href="#l33.5"></a><span id="l33.5">  * License, v. 2.0. If a copy of the MPL was not distributed with this</span>
<a href="#l33.6"></a><span id="l33.6">  * file, You can obtain one at http://mozilla.org/MPL/2.0/. */</span>
<a href="#l33.7"></a><span id="l33.7"> </span>
<a href="#l33.8"></a><span id="l33.8"> Components.utils.import(&quot;resource://calendar/modules/calItipUtils.jsm&quot;);</span>
<a href="#l33.9"></a><span id="l33.9" class="difflineplus">+Components.utils.import(&quot;resource://gre/modules/XPCOMUtils.jsm&quot;);</span>
<a href="#l33.10"></a><span id="l33.10"> </span>
<a href="#l33.11"></a><span id="l33.11"> function calTransactionManager() {</span>
<a href="#l33.12"></a><span id="l33.12" class="difflineplus">+    this.wrappedJSObject = this;</span>
<a href="#l33.13"></a><span id="l33.13">     if (!this.transactionManager) {</span>
<a href="#l33.14"></a><span id="l33.14">         this.transactionManager =</span>
<a href="#l33.15"></a><span id="l33.15">             Components.classes[&quot;@mozilla.org/transactionmanager;1&quot;]</span>
<a href="#l33.16"></a><span id="l33.16">                       .createInstance(Components.interfaces.nsITransactionManager);</span>
<a href="#l33.17"></a><span id="l33.17">     }</span>
<a href="#l33.18"></a><span id="l33.18"> }</span>
<a href="#l33.19"></a><span id="l33.19"> </span>
<a href="#l33.20"></a><span id="l33.20" class="difflineplus">+const calTransactionManagerClassID = Components.ID(&quot;{40a1ccf4-5f54-4815-b842-abf06f84dbfd}&quot;);</span>
<a href="#l33.21"></a><span id="l33.21" class="difflineplus">+const calTransactionManagerInterfaces = [Components.interfaces.calITransactionManager];</span>
<a href="#l33.22"></a><span id="l33.22"> calTransactionManager.prototype = {</span>
<a href="#l33.23"></a><span id="l33.23" class="difflineminus">-    // nsIClassInfo:</span>
<a href="#l33.24"></a><span id="l33.24" class="difflineminus">-    getInterfaces: function getInterfaces(count) {</span>
<a href="#l33.25"></a><span id="l33.25" class="difflineminus">-        const ifaces = [Components.interfaces.nsISupports,</span>
<a href="#l33.26"></a><span id="l33.26" class="difflineminus">-                        Components.interfaces.nsIClassInfo,</span>
<a href="#l33.27"></a><span id="l33.27" class="difflineminus">-                        Components.interfaces.calITransactionManager];</span>
<a href="#l33.28"></a><span id="l33.28" class="difflineminus">-        count.value = ifaces.length;</span>
<a href="#l33.29"></a><span id="l33.29" class="difflineminus">-        return ifaces;</span>
<a href="#l33.30"></a><span id="l33.30" class="difflineminus">-    },</span>
<a href="#l33.31"></a><span id="l33.31" class="difflineminus">-    classDescription: &quot;Calendar Transaction Manager&quot;,</span>
<a href="#l33.32"></a><span id="l33.32" class="difflineminus">-    contractID: &quot;mozilla.org/calendar/transactionmanager;1&quot;,</span>
<a href="#l33.33"></a><span id="l33.33" class="difflineminus">-    classID: Components.ID(&quot;{40a1ccf4-5f54-4815-b842-abf06f84dbfd}&quot;),</span>
<a href="#l33.34"></a><span id="l33.34"> </span>
<a href="#l33.35"></a><span id="l33.35" class="difflineminus">-    getHelperForLanguage: function getHelperForLanguage(language) {</span>
<a href="#l33.36"></a><span id="l33.36" class="difflineminus">-        return null;</span>
<a href="#l33.37"></a><span id="l33.37" class="difflineminus">-    },</span>
<a href="#l33.38"></a><span id="l33.38" class="difflineminus">-    implementationLanguage: Components.interfaces.nsIProgrammingLanguage.JAVASCRIPT,</span>
<a href="#l33.39"></a><span id="l33.39" class="difflineminus">-    flags: Components.interfaces.nsIClassInfo.SINGLETON,</span>
<a href="#l33.40"></a><span id="l33.40" class="difflineminus">-</span>
<a href="#l33.41"></a><span id="l33.41" class="difflineminus">-    QueryInterface: function cTM_QueryInterface(aIID) {</span>
<a href="#l33.42"></a><span id="l33.42" class="difflineminus">-        return cal.doQueryInterface(this, calTransactionManager.prototype, aIID, null, this);</span>
<a href="#l33.43"></a><span id="l33.43" class="difflineminus">-    },</span>
<a href="#l33.44"></a><span id="l33.44" class="difflineplus">+    classID: calTransactionManagerClassID,</span>
<a href="#l33.45"></a><span id="l33.45" class="difflineplus">+    QueryInterface: XPCOMUtils.generateQI(calTransactionManagerInterfaces),</span>
<a href="#l33.46"></a><span id="l33.46" class="difflineplus">+    classInfo: XPCOMUtils.generateCI({</span>
<a href="#l33.47"></a><span id="l33.47" class="difflineplus">+        classID: calTransactionManagerClassID,</span>
<a href="#l33.48"></a><span id="l33.48" class="difflineplus">+        classDescription: &quot;Calendar Transaction Manager&quot;,</span>
<a href="#l33.49"></a><span id="l33.49" class="difflineplus">+        contractID: &quot;mozilla.org/calendar/transactionmanager;1&quot;,</span>
<a href="#l33.50"></a><span id="l33.50" class="difflineplus">+        interfaces: calTransactionManagerInterfaces,</span>
<a href="#l33.51"></a><span id="l33.51" class="difflineplus">+        flags: Components.interfaces.nsIClassInfo.SINGLETON</span>
<a href="#l33.52"></a><span id="l33.52" class="difflineplus">+    }),</span>
<a href="#l33.53"></a><span id="l33.53"> </span>
<a href="#l33.54"></a><span id="l33.54">     transactionManager: null,</span>
<a href="#l33.55"></a><span id="l33.55" class="difflineminus">-</span>
<a href="#l33.56"></a><span id="l33.56">     createAndCommitTxn: function cTM_createAndCommitTxn(aAction,</span>
<a href="#l33.57"></a><span id="l33.57">                                                         aItem,</span>
<a href="#l33.58"></a><span id="l33.58">                                                         aCalendar,</span>
<a href="#l33.59"></a><span id="l33.59">                                                         aOldItem,</span>
<a href="#l33.60"></a><span id="l33.60">                                                         aListener) {</span>
<a href="#l33.61"></a><span id="l33.61">         var txn = new calTransaction(aAction,</span>
<a href="#l33.62"></a><span id="l33.62">                                      aItem,</span>
<a href="#l33.63"></a><span id="l33.63">                                      aCalendar,</span>
<a href="#l33.64"></a><span id="l33.64" class="difflineat">@@ -104,49 +96,39 @@ function calTransaction(aAction, aItem, </span>
<a href="#l33.65"></a><span id="l33.65">     this.wrappedJSObject = this;</span>
<a href="#l33.66"></a><span id="l33.66">     this.mAction = aAction;</span>
<a href="#l33.67"></a><span id="l33.67">     this.mItem = aItem;</span>
<a href="#l33.68"></a><span id="l33.68">     this.mCalendar = aCalendar;</span>
<a href="#l33.69"></a><span id="l33.69">     this.mOldItem = aOldItem;</span>
<a href="#l33.70"></a><span id="l33.70">     this.mListener = aListener;</span>
<a href="#l33.71"></a><span id="l33.71"> }</span>
<a href="#l33.72"></a><span id="l33.72"> </span>
<a href="#l33.73"></a><span id="l33.73" class="difflineplus">+const calTransactionClassID = Components.ID(&quot;{fcb54c82-2fb9-42cb-bf44-1e197a55e520}&quot;);</span>
<a href="#l33.74"></a><span id="l33.74" class="difflineplus">+const calTransactionInterfaces = [</span>
<a href="#l33.75"></a><span id="l33.75" class="difflineplus">+    Components.interfaces.nsITransaction,</span>
<a href="#l33.76"></a><span id="l33.76" class="difflineplus">+    Components.interfaces.calIOperationListener</span>
<a href="#l33.77"></a><span id="l33.77" class="difflineplus">+];</span>
<a href="#l33.78"></a><span id="l33.78"> calTransaction.prototype = {</span>
<a href="#l33.79"></a><span id="l33.79" class="difflineplus">+    classID: calTransactionClassID,</span>
<a href="#l33.80"></a><span id="l33.80" class="difflineplus">+    QueryInterface: XPCOMUtils.generateQI(calTransactionInterfaces),</span>
<a href="#l33.81"></a><span id="l33.81" class="difflineplus">+    classInfo: XPCOMUtils.generateCI({</span>
<a href="#l33.82"></a><span id="l33.82" class="difflineplus">+        classID: calTransactionClassID,</span>
<a href="#l33.83"></a><span id="l33.83" class="difflineplus">+        classDescription: &quot;Calendar Transaction&quot;,</span>
<a href="#l33.84"></a><span id="l33.84" class="difflineplus">+        contractID: &quot;mozilla.org/calendar/transaction;1&quot;,</span>
<a href="#l33.85"></a><span id="l33.85" class="difflineplus">+        interfaces: calTransactionInterfaces,</span>
<a href="#l33.86"></a><span id="l33.86" class="difflineplus">+    }),</span>
<a href="#l33.87"></a><span id="l33.87"> </span>
<a href="#l33.88"></a><span id="l33.88">     mAction: null,</span>
<a href="#l33.89"></a><span id="l33.89">     mCalendar: null,</span>
<a href="#l33.90"></a><span id="l33.90">     mItem: null,</span>
<a href="#l33.91"></a><span id="l33.91">     mOldItem: null,</span>
<a href="#l33.92"></a><span id="l33.92">     mOldCalendar: null,</span>
<a href="#l33.93"></a><span id="l33.93">     mListener: null,</span>
<a href="#l33.94"></a><span id="l33.94">     mIsDoTransaction: false,</span>
<a href="#l33.95"></a><span id="l33.95"> </span>
<a href="#l33.96"></a><span id="l33.96" class="difflineminus">-    // nsIClassInfo:</span>
<a href="#l33.97"></a><span id="l33.97" class="difflineminus">-    getInterfaces: function getInterfaces(count) {</span>
<a href="#l33.98"></a><span id="l33.98" class="difflineminus">-        const ifaces = [Components.interfaces.nsISupports,</span>
<a href="#l33.99"></a><span id="l33.99" class="difflineminus">-                        Components.interfaces.nsIClassInfo,</span>
<a href="#l33.100"></a><span id="l33.100" class="difflineminus">-                        Components.interfaces.nsITransaction,</span>
<a href="#l33.101"></a><span id="l33.101" class="difflineminus">-                        Components.interfaces.calIOperationListener];</span>
<a href="#l33.102"></a><span id="l33.102" class="difflineminus">-        count.value = ifaces.length;</span>
<a href="#l33.103"></a><span id="l33.103" class="difflineminus">-        return ifaces;</span>
<a href="#l33.104"></a><span id="l33.104" class="difflineminus">-    },</span>
<a href="#l33.105"></a><span id="l33.105" class="difflineminus">-    classDescription: &quot;Calendar Transaction&quot;,</span>
<a href="#l33.106"></a><span id="l33.106" class="difflineminus">-    contractID: &quot;mozilla.org/calendar/transaction;1&quot;,</span>
<a href="#l33.107"></a><span id="l33.107" class="difflineminus">-    classID: Components.ID(&quot;{fcb54c82-2fb9-42cb-bf44-1e197a55e520}&quot;),</span>
<a href="#l33.108"></a><span id="l33.108" class="difflineminus">-</span>
<a href="#l33.109"></a><span id="l33.109" class="difflineminus">-    getHelperForLanguage: function getHelperForLanguage(language) {</span>
<a href="#l33.110"></a><span id="l33.110" class="difflineminus">-        return null;</span>
<a href="#l33.111"></a><span id="l33.111" class="difflineminus">-    },</span>
<a href="#l33.112"></a><span id="l33.112" class="difflineminus">-    implementationLanguage: Components.interfaces.nsIProgrammingLanguage.JAVASCRIPT,</span>
<a href="#l33.113"></a><span id="l33.113" class="difflineminus">-    flags: 0,</span>
<a href="#l33.114"></a><span id="l33.114" class="difflineminus">-</span>
<a href="#l33.115"></a><span id="l33.115" class="difflineminus">-    QueryInterface: function cTM_QueryInterface(aIID) {</span>
<a href="#l33.116"></a><span id="l33.116" class="difflineminus">-        return cal.doQueryInterface(this, calTransaction.prototype, aIID, null, this);</span>
<a href="#l33.117"></a><span id="l33.117" class="difflineminus">-    },</span>
<a href="#l33.118"></a><span id="l33.118" class="difflineminus">-</span>
<a href="#l33.119"></a><span id="l33.119">     onOperationComplete: function cT_onOperationComplete(aCalendar,</span>
<a href="#l33.120"></a><span id="l33.120">                                                          aStatus,</span>
<a href="#l33.121"></a><span id="l33.121">                                                          aOperationType,</span>
<a href="#l33.122"></a><span id="l33.122">                                                          aId,</span>
<a href="#l33.123"></a><span id="l33.123">                                                          aDetail) {</span>
<a href="#l33.124"></a><span id="l33.124">         if (Components.isSuccessCode(aStatus)) {</span>
<a href="#l33.125"></a><span id="l33.125"> </span>
<a href="#l33.126"></a><span id="l33.126">             cal.itip.checkAndSend(aOperationType,</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l34.1"></a><span id="l34.1" class="difflineminus">--- a/calendar/base/src/calUtils.js</span>
<a href="#l34.2"></a><span id="l34.2" class="difflineplus">+++ b/calendar/base/src/calUtils.js</span>
<a href="#l34.3"></a><span id="l34.3" class="difflineat">@@ -3,16 +3,17 @@</span>
<a href="#l34.4"></a><span id="l34.4">  * file, You can obtain one at http://mozilla.org/MPL/2.0/. */</span>
<a href="#l34.5"></a><span id="l34.5"> </span>
<a href="#l34.6"></a><span id="l34.6"> /* This file contains commonly used functions in a centralized place so that</span>
<a href="#l34.7"></a><span id="l34.7">  * various components (and other js scopes) don't need to replicate them. Note</span>
<a href="#l34.8"></a><span id="l34.8">  * that loading this file twice in the same scope will throw errors.</span>
<a href="#l34.9"></a><span id="l34.9">  */</span>
<a href="#l34.10"></a><span id="l34.10"> </span>
<a href="#l34.11"></a><span id="l34.11"> Components.utils.import(&quot;resource:///modules/mailServices.js&quot;);</span>
<a href="#l34.12"></a><span id="l34.12" class="difflineplus">+Components.utils.import(&quot;resource://gre/modules/XPCOMUtils.jsm&quot;);</span>
<a href="#l34.13"></a><span id="l34.13"> Components.utils.import(&quot;resource://gre/modules/Services.jsm&quot;);</span>
<a href="#l34.14"></a><span id="l34.14"> </span>
<a href="#l34.15"></a><span id="l34.15"> function _calIcalCreator(cid, iid) {</span>
<a href="#l34.16"></a><span id="l34.16">     return function(icalString) {</span>
<a href="#l34.17"></a><span id="l34.17">         let thing = Components.classes[cid].createInstance(iid);</span>
<a href="#l34.18"></a><span id="l34.18">         if (icalString) {</span>
<a href="#l34.19"></a><span id="l34.19">             thing.icalString = icalString;</span>
<a href="#l34.20"></a><span id="l34.20">         }</span>
<a href="#l34.21"></a><span id="l34.21" class="difflineat">@@ -792,25 +793,33 @@ function compareArrays(aOne, aTwo, compa</span>
<a href="#l34.22"></a><span id="l34.22">     }</span>
<a href="#l34.23"></a><span id="l34.23">     return true;</span>
<a href="#l34.24"></a><span id="l34.24"> }</span>
<a href="#l34.25"></a><span id="l34.25"> </span>
<a href="#l34.26"></a><span id="l34.26"> /**</span>
<a href="#l34.27"></a><span id="l34.27">  * Takes care of all QueryInterface business, including calling the QI of any</span>
<a href="#l34.28"></a><span id="l34.28">  * existing parent prototypes.</span>
<a href="#l34.29"></a><span id="l34.29">  *</span>
<a href="#l34.30"></a><span id="l34.30" class="difflineplus">+ * @deprecated</span>
<a href="#l34.31"></a><span id="l34.31">  * @param aSelf         The object the QueryInterface is being made to</span>
<a href="#l34.32"></a><span id="l34.32">  * @param aProto        Caller's prototype object</span>
<a href="#l34.33"></a><span id="l34.33">  * @param aIID          The IID to check for</span>
<a href="#l34.34"></a><span id="l34.34">  * @param aList         (Optional if aClassInfo is specified) An array of</span>
<a href="#l34.35"></a><span id="l34.35">  *                        interfaces from Components.interfaces</span>
<a href="#l34.36"></a><span id="l34.36">  * @param aClassInfo    (Optional) an Object containing the class info for this</span>
<a href="#l34.37"></a><span id="l34.37">  *                        prototype.</span>
<a href="#l34.38"></a><span id="l34.38">  */</span>
<a href="#l34.39"></a><span id="l34.39"> function doQueryInterface(aSelf, aProto, aIID, aList, aClassInfo) {</span>
<a href="#l34.40"></a><span id="l34.40" class="difflineplus">+    if (!doQueryInterface.warningIssued) {</span>
<a href="#l34.41"></a><span id="l34.41" class="difflineplus">+        cal.WARN(&quot;Use of doQueryInterface() is deprecated and will be removed &quot; +</span>
<a href="#l34.42"></a><span id="l34.42" class="difflineplus">+                 &quot;with the next release. Use XPCOMUtils.generateQI() instead.\n&quot; +</span>
<a href="#l34.43"></a><span id="l34.43" class="difflineplus">+                 cal.STACK(10));</span>
<a href="#l34.44"></a><span id="l34.44" class="difflineplus">+        doQueryInterface.warningIssued = true;</span>
<a href="#l34.45"></a><span id="l34.45" class="difflineplus">+    }</span>
<a href="#l34.46"></a><span id="l34.46" class="difflineplus">+</span>
<a href="#l34.47"></a><span id="l34.47">     if (aClassInfo) {</span>
<a href="#l34.48"></a><span id="l34.48">         if (aIID.equals(Components.interfaces.nsIClassInfo)) {</span>
<a href="#l34.49"></a><span id="l34.49">             return aClassInfo;</span>
<a href="#l34.50"></a><span id="l34.50">         }</span>
<a href="#l34.51"></a><span id="l34.51">         if (!aList) {</span>
<a href="#l34.52"></a><span id="l34.52">             aList = aClassInfo.getInterfaces({});</span>
<a href="#l34.53"></a><span id="l34.53">         }</span>
<a href="#l34.54"></a><span id="l34.54">     }</span>
<a href="#l34.55"></a><span id="l34.55" class="difflineat">@@ -1638,19 +1647,17 @@ calPropertyBagEnumerator.prototype = {</span>
<a href="#l34.56"></a><span id="l34.56">     // nsISimpleEnumerator:</span>
<a href="#l34.57"></a><span id="l34.57">     getNext: function cpb_enum_getNext() {</span>
<a href="#l34.58"></a><span id="l34.58">         if (!this.hasMoreElements()) { // hasMoreElements is called by intention to skip yet deleted properties</span>
<a href="#l34.59"></a><span id="l34.59">             ASSERT(false, Components.results.NS_ERROR_UNEXPECTED);</span>
<a href="#l34.60"></a><span id="l34.60">             throw Components.results.NS_ERROR_UNEXPECTED;</span>
<a href="#l34.61"></a><span id="l34.61">         }</span>
<a href="#l34.62"></a><span id="l34.62">         var name = this.mKeys[this.mIndex++];</span>
<a href="#l34.63"></a><span id="l34.63">         return { // nsIProperty:</span>
<a href="#l34.64"></a><span id="l34.64" class="difflineminus">-            QueryInterface: function cpb_enum_prop_QueryInterface(aIID) {</span>
<a href="#l34.65"></a><span id="l34.65" class="difflineminus">-                return doQueryInterface(this, null, aIID, [Components.interfaces.nsIProperty]);</span>
<a href="#l34.66"></a><span id="l34.66" class="difflineminus">-            },</span>
<a href="#l34.67"></a><span id="l34.67" class="difflineplus">+            QueryInterface: XPCOMUtils.generateQI([Components.interfaces.nsIProperty]),</span>
<a href="#l34.68"></a><span id="l34.68">             name: name,</span>
<a href="#l34.69"></a><span id="l34.69">             value: this.mCurrentValue</span>
<a href="#l34.70"></a><span id="l34.70">         };</span>
<a href="#l34.71"></a><span id="l34.71">     },</span>
<a href="#l34.72"></a><span id="l34.72">     hasMoreElements: function cpb_enum_hasMoreElements() {</span>
<a href="#l34.73"></a><span id="l34.73">         while (this.mIndex &lt; this.mKeys.length) {</span>
<a href="#l34.74"></a><span id="l34.74">             this.mCurrentValue = this.mBag.mData[this.mKeys[this.mIndex]];</span>
<a href="#l34.75"></a><span id="l34.75">             if (this.mCurrentValue !== undefined) {</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l35.1"></a><span id="l35.1" class="difflineminus">--- a/calendar/base/src/calWeekInfoService.js</span>
<a href="#l35.2"></a><span id="l35.2" class="difflineplus">+++ b/calendar/base/src/calWeekInfoService.js</span>
<a href="#l35.3"></a><span id="l35.3" class="difflineat">@@ -1,35 +1,30 @@</span>
<a href="#l35.4"></a><span id="l35.4"> /* This Source Code Form is subject to the terms of the Mozilla Public</span>
<a href="#l35.5"></a><span id="l35.5">  * License, v. 2.0. If a copy of the MPL was not distributed with this</span>
<a href="#l35.6"></a><span id="l35.6">  * file, You can obtain one at http://mozilla.org/MPL/2.0/. */</span>
<a href="#l35.7"></a><span id="l35.7"> </span>
<a href="#l35.8"></a><span id="l35.8" class="difflineminus">-function calWeekInfoService() {</span>
<a href="#l35.9"></a><span id="l35.9" class="difflineminus">-}</span>
<a href="#l35.10"></a><span id="l35.10" class="difflineminus">-calWeekInfoService.prototype = {</span>
<a href="#l35.11"></a><span id="l35.11" class="difflineminus">-    QueryInterface: function QueryInterface(aIID) {</span>
<a href="#l35.12"></a><span id="l35.12" class="difflineminus">-        return doQueryInterface(this, calWeekInfoService.prototype, aIID, null, this);</span>
<a href="#l35.13"></a><span id="l35.13" class="difflineminus">-    },</span>
<a href="#l35.14"></a><span id="l35.14" class="difflineplus">+Components.utils.import(&quot;resource://gre/modules/XPCOMUtils.jsm&quot;);</span>
<a href="#l35.15"></a><span id="l35.15" class="difflineplus">+Components.utils.import(&quot;resource://calendar/modules/calUtils.jsm&quot;);</span>
<a href="#l35.16"></a><span id="l35.16"> </span>
<a href="#l35.17"></a><span id="l35.17" class="difflineminus">-    // nsIClassInfo:</span>
<a href="#l35.18"></a><span id="l35.18" class="difflineminus">-    getInterfaces: function(count) {</span>
<a href="#l35.19"></a><span id="l35.19" class="difflineminus">-        const ifaces = [Components.interfaces.nsISupports,</span>
<a href="#l35.20"></a><span id="l35.20" class="difflineminus">-                        Components.interfaces.calIWeekInfoService,</span>
<a href="#l35.21"></a><span id="l35.21" class="difflineminus">-                        Components.interfaces.nsIClassInfo];</span>
<a href="#l35.22"></a><span id="l35.22" class="difflineminus">-        count.value = ifaces.length;</span>
<a href="#l35.23"></a><span id="l35.23" class="difflineminus">-        return ifaces;</span>
<a href="#l35.24"></a><span id="l35.24" class="difflineminus">-    },</span>
<a href="#l35.25"></a><span id="l35.25" class="difflineminus">-    getHelperForLanguage: function(language) {</span>
<a href="#l35.26"></a><span id="l35.26" class="difflineminus">-        return null;</span>
<a href="#l35.27"></a><span id="l35.27" class="difflineminus">-    },</span>
<a href="#l35.28"></a><span id="l35.28" class="difflineminus">-    contractID: &quot;@mozilla.org/calendar/weekinfo-service;1&quot;,</span>
<a href="#l35.29"></a><span id="l35.29" class="difflineminus">-    classDescription: &quot;Calendar WeekInfo Service&quot;,</span>
<a href="#l35.30"></a><span id="l35.30" class="difflineminus">-    classID: Components.ID(&quot;{6877bbdd-f336-46f5-98ce-fe86d0285cc1}&quot;),</span>
<a href="#l35.31"></a><span id="l35.31" class="difflineminus">-    implementationLanguage: Components.interfaces.nsIProgrammingLanguage.JAVASCRIPT,</span>
<a href="#l35.32"></a><span id="l35.32" class="difflineminus">-    flags: Components.interfaces.nsIClassInfo.SINGLETON,</span>
<a href="#l35.33"></a><span id="l35.33" class="difflineplus">+function calWeekInfoService() {</span>
<a href="#l35.34"></a><span id="l35.34" class="difflineplus">+    this.wrappedJSObject = this;</span>
<a href="#l35.35"></a><span id="l35.35" class="difflineplus">+}</span>
<a href="#l35.36"></a><span id="l35.36" class="difflineplus">+const calWeekInfoServiceClassID = Components.ID(&quot;{6877bbdd-f336-46f5-98ce-fe86d0285cc1}&quot;);</span>
<a href="#l35.37"></a><span id="l35.37" class="difflineplus">+const calWeekInfoServiceInterfaces = [Components.interfaces.calIWeekInfoService];</span>
<a href="#l35.38"></a><span id="l35.38" class="difflineplus">+calWeekInfoService.prototype = {</span>
<a href="#l35.39"></a><span id="l35.39" class="difflineplus">+    classID: calWeekInfoServiceClassID,</span>
<a href="#l35.40"></a><span id="l35.40" class="difflineplus">+    QueryInterface: XPCOMUtils.generateQI(calWeekInfoServiceInterfaces),</span>
<a href="#l35.41"></a><span id="l35.41" class="difflineplus">+    classInfo: XPCOMUtils.generateCI({</span>
<a href="#l35.42"></a><span id="l35.42" class="difflineplus">+        classID: calWeekInfoServiceClassID,</span>
<a href="#l35.43"></a><span id="l35.43" class="difflineplus">+        contractID: &quot;@mozilla.org/calendar/weekinfo-service;1&quot;,</span>
<a href="#l35.44"></a><span id="l35.44" class="difflineplus">+        classDescription: &quot;Calendar WeekInfo Service&quot;,</span>
<a href="#l35.45"></a><span id="l35.45" class="difflineplus">+        interfaces: calWeekInfoServiceInterfaces,</span>
<a href="#l35.46"></a><span id="l35.46" class="difflineplus">+        flags: Components.interfaces.nsIClassInfo.SINGLETON</span>
<a href="#l35.47"></a><span id="l35.47" class="difflineplus">+    }),</span>
<a href="#l35.48"></a><span id="l35.48"> </span>
<a href="#l35.49"></a><span id="l35.49">     // calIWeekInfoService:</span>
<a href="#l35.50"></a><span id="l35.50">     getWeekTitle: function(aDateTime) {</span>
<a href="#l35.51"></a><span id="l35.51">         /**</span>
<a href="#l35.52"></a><span id="l35.52">          * This implementation is based on the ISO 8601 standard.  </span>
<a href="#l35.53"></a><span id="l35.53">          * ISO 8601 defines week one as the first week with at least 4</span>
<a href="#l35.54"></a><span id="l35.54">          * days, and defines Monday as the first day of the week.</span>
<a href="#l35.55"></a><span id="l35.55">          * Equivalently, the week one is the week with the first Thursday.</span>
<a href="#l35.56"></a><span id="l35.56" class="difflineat">@@ -55,17 +50,17 @@ calWeekInfoService.prototype = {</span>
<a href="#l35.57"></a><span id="l35.57">         // which may be part of first/last week in the other year.)</span>
<a href="#l35.58"></a><span id="l35.58">         // The Thursday of a week is the Thursday that follows the first day</span>
<a href="#l35.59"></a><span id="l35.59">         // of the week.</span>
<a href="#l35.60"></a><span id="l35.60">         // The week number of a day is the same as the week number of the first</span>
<a href="#l35.61"></a><span id="l35.61">         // day of the week. (This takes care of days near the start of the year,</span>
<a href="#l35.62"></a><span id="l35.62">         // which may be part of the week counted in the previous year.) So we</span>
<a href="#l35.63"></a><span id="l35.63">         // need the startWeekday.</span>
<a href="#l35.64"></a><span id="l35.64">         const SUNDAY = 0;</span>
<a href="#l35.65"></a><span id="l35.65" class="difflineminus">-        var startWeekday = getPrefSafe(&quot;calendar.week.start&quot;, SUNDAY); // default to monday per ISO8601 standard.</span>
<a href="#l35.66"></a><span id="l35.66" class="difflineplus">+        var startWeekday = cal.getPrefSafe(&quot;calendar.week.start&quot;, SUNDAY); // default to monday per ISO8601 standard.</span>
<a href="#l35.67"></a><span id="l35.67"> </span>
<a href="#l35.68"></a><span id="l35.68">         // The number of days since the start of the week.</span>
<a href="#l35.69"></a><span id="l35.69">         // Notice that the result of the substraction might be negative.</span>
<a href="#l35.70"></a><span id="l35.70">         // We correct for that by adding 7, and then using the remainder operator.</span>
<a href="#l35.71"></a><span id="l35.71">         var sinceStartOfWeek = (aDateTime.weekday - startWeekday + 7) % 7; </span>
<a href="#l35.72"></a><span id="l35.72"> </span>
<a href="#l35.73"></a><span id="l35.73">         // The number of days to Thursday is the difference between Thursday</span>
<a href="#l35.74"></a><span id="l35.74">         // and the start-day of the week (again corrected for negative values).</span>
<a href="#l35.75"></a><span id="l35.75" class="difflineat">@@ -96,17 +91,17 @@ calWeekInfoService.prototype = {</span>
<a href="#l35.76"></a><span id="l35.76">      * of the preference setting &quot;calendar.week.start&quot;</span>
<a href="#l35.77"></a><span id="l35.77">      *</span>
<a href="#l35.78"></a><span id="l35.78">      * @param aDate     a date time object</span>
<a href="#l35.79"></a><span id="l35.79">      * @return          a dateTime-object denoting the first day of the week</span>
<a href="#l35.80"></a><span id="l35.80">      */</span>
<a href="#l35.81"></a><span id="l35.81">     getStartOfWeek: function(aDate) {</span>
<a href="#l35.82"></a><span id="l35.82">         var date = aDate.clone();</span>
<a href="#l35.83"></a><span id="l35.83">         date.isDate = true;</span>
<a href="#l35.84"></a><span id="l35.84" class="difflineminus">-        var offset = (getPrefSafe(&quot;calendar.week.start&quot;, 0) - aDate.weekday);</span>
<a href="#l35.85"></a><span id="l35.85" class="difflineplus">+        var offset = (cal.getPrefSafe(&quot;calendar.week.start&quot;, 0) - aDate.weekday);</span>
<a href="#l35.86"></a><span id="l35.86">         if (offset &gt; 0) {</span>
<a href="#l35.87"></a><span id="l35.87">             date.day -= (7 - offset);</span>
<a href="#l35.88"></a><span id="l35.88">         } else {</span>
<a href="#l35.89"></a><span id="l35.89">             date.day += offset;</span>
<a href="#l35.90"></a><span id="l35.90">         }</span>
<a href="#l35.91"></a><span id="l35.91">         return date;</span>
<a href="#l35.92"></a><span id="l35.92">     },</span>
<a href="#l35.93"></a><span id="l35.93"> </span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l36.1"></a><span id="l36.1" class="difflineminus">--- a/calendar/import-export/calHtmlExport.js</span>
<a href="#l36.2"></a><span id="l36.2" class="difflineplus">+++ b/calendar/import-export/calHtmlExport.js</span>
<a href="#l36.3"></a><span id="l36.3" class="difflineat">@@ -6,27 +6,30 @@ Components.utils.import(&quot;resource://gre/</span>
<a href="#l36.4"></a><span id="l36.4"> </span>
<a href="#l36.5"></a><span id="l36.5"> Components.utils.import(&quot;resource://calendar/modules/calUtils.jsm&quot;);</span>
<a href="#l36.6"></a><span id="l36.6"> Components.utils.import(&quot;resource://calendar/modules/calXMLUtils.jsm&quot;);</span>
<a href="#l36.7"></a><span id="l36.7"> </span>
<a href="#l36.8"></a><span id="l36.8"> /**</span>
<a href="#l36.9"></a><span id="l36.9">  * HTML Export Plugin</span>
<a href="#l36.10"></a><span id="l36.10">  */</span>
<a href="#l36.11"></a><span id="l36.11"> function calHtmlExporter() {</span>
<a href="#l36.12"></a><span id="l36.12" class="difflineplus">+    this.wrappedJSObject = this;</span>
<a href="#l36.13"></a><span id="l36.13"> }</span>
<a href="#l36.14"></a><span id="l36.14"> </span>
<a href="#l36.15"></a><span id="l36.15" class="difflineplus">+const calHtmlExporterClassID = Components.ID(&quot;{72d9ab35-9b1b-442a-8cd0-ae49f00b159b}&quot;);</span>
<a href="#l36.16"></a><span id="l36.16" class="difflineplus">+const calHtmlExporterInterfaces = [Components.interfaces.calIExporter];</span>
<a href="#l36.17"></a><span id="l36.17"> calHtmlExporter.prototype = {</span>
<a href="#l36.18"></a><span id="l36.18" class="difflineminus">-    classID: Components.ID(&quot;{72d9ab35-9b1b-442a-8cd0-ae49f00b159b}&quot;),</span>
<a href="#l36.19"></a><span id="l36.19" class="difflineminus">-    QueryInterface: XPCOMUtils.generateQI([Components.interfaces.calIExporter]),</span>
<a href="#l36.20"></a><span id="l36.20" class="difflineplus">+    classID: calHtmlExporterClassID,</span>
<a href="#l36.21"></a><span id="l36.21" class="difflineplus">+    QueryInterface: XPCOMUtils.generateQI(calHtmlExporterInterfaces),</span>
<a href="#l36.22"></a><span id="l36.22"> </span>
<a href="#l36.23"></a><span id="l36.23">     classInfo: XPCOMUtils.generateCI({</span>
<a href="#l36.24"></a><span id="l36.24" class="difflineminus">-        classID: Components.ID(&quot;{72d9ab35-9b1b-442a-8cd0-ae49f00b159b}&quot;),</span>
<a href="#l36.25"></a><span id="l36.25" class="difflineplus">+        classID: calHtmlExporterClassID,</span>
<a href="#l36.26"></a><span id="l36.26">         contractID: &quot;@mozilla.org/calendar/export;1?type=html&quot;,</span>
<a href="#l36.27"></a><span id="l36.27">         classDescription: &quot;Calendar HTML Exporter&quot;,</span>
<a href="#l36.28"></a><span id="l36.28" class="difflineminus">-        interfaces: [Components.interfaces.calIExporter]</span>
<a href="#l36.29"></a><span id="l36.29" class="difflineplus">+        interfaces: calHtmlExporterInterfaces</span>
<a href="#l36.30"></a><span id="l36.30">     }),</span>
<a href="#l36.31"></a><span id="l36.31"> </span>
<a href="#l36.32"></a><span id="l36.32">     getFileTypes: function getFileTypes(aCount) {</span>
<a href="#l36.33"></a><span id="l36.33">         aCount.value = 1;</span>
<a href="#l36.34"></a><span id="l36.34">         let wildmat = '*.html; *.htm';</span>
<a href="#l36.35"></a><span id="l36.35">         let label = cal.calGetString(&quot;calendar&quot;, 'filterHtml', [wildmat]);</span>
<a href="#l36.36"></a><span id="l36.36">         return [{</span>
<a href="#l36.37"></a><span id="l36.37">             QueryInterface: XPCOMUtils.generateQI([Components.interfaces.calIFileType]),</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l37.1"></a><span id="l37.1" class="difflineminus">--- a/calendar/import-export/calIcsImportExport.js</span>
<a href="#l37.2"></a><span id="l37.2" class="difflineplus">+++ b/calendar/import-export/calIcsImportExport.js</span>
<a href="#l37.3"></a><span id="l37.3" class="difflineat">@@ -17,52 +17,57 @@ function getIcsFileTypes(aCount) {</span>
<a href="#l37.4"></a><span id="l37.4">         defaultExtension: 'ics',</span>
<a href="#l37.5"></a><span id="l37.5">         extensionFilter: '*.ics',</span>
<a href="#l37.6"></a><span id="l37.6">         description: cal.calGetString(&quot;calendar&quot;, 'filterIcs', ['*.ics'])</span>
<a href="#l37.7"></a><span id="l37.7">     }];</span>
<a href="#l37.8"></a><span id="l37.8"> }</span>
<a href="#l37.9"></a><span id="l37.9"> </span>
<a href="#l37.10"></a><span id="l37.10"> // Importer</span>
<a href="#l37.11"></a><span id="l37.11"> function calIcsImporter() {</span>
<a href="#l37.12"></a><span id="l37.12" class="difflineplus">+    this.wrappedJSObject = this;</span>
<a href="#l37.13"></a><span id="l37.13"> }</span>
<a href="#l37.14"></a><span id="l37.14"> </span>
<a href="#l37.15"></a><span id="l37.15" class="difflineplus">+const calIcsImporterClassID = Components.ID(&quot;{1e3e33dc-445a-49de-b2b6-15b2a050bb9d}&quot;);</span>
<a href="#l37.16"></a><span id="l37.16" class="difflineplus">+const calIcsImporterInterfaces = [Components.interfaces.calIImporter];</span>
<a href="#l37.17"></a><span id="l37.17"> calIcsImporter.prototype = {</span>
<a href="#l37.18"></a><span id="l37.18" class="difflineminus">-    classID: Components.ID(&quot;{1e3e33dc-445a-49de-b2b6-15b2a050bb9d}&quot;),</span>
<a href="#l37.19"></a><span id="l37.19" class="difflineminus">-    QueryInterface: XPCOMUtils.generateQI([Components.interfaces.calIImporter]),</span>
<a href="#l37.20"></a><span id="l37.20" class="difflineminus">-</span>
<a href="#l37.21"></a><span id="l37.21" class="difflineplus">+    classID: calIcsImporterClassID,</span>
<a href="#l37.22"></a><span id="l37.22" class="difflineplus">+    QueryInterface: XPCOMUtils.generateQI(calIcsImporterInterfaces),</span>
<a href="#l37.23"></a><span id="l37.23">     classInfo: XPCOMUtils.generateCI({</span>
<a href="#l37.24"></a><span id="l37.24" class="difflineminus">-        classID: Components.ID(&quot;{1e3e33dc-445a-49de-b2b6-15b2a050bb9d}&quot;),</span>
<a href="#l37.25"></a><span id="l37.25" class="difflineplus">+        classID: calIcsImporterClassID,</span>
<a href="#l37.26"></a><span id="l37.26">         contractID: &quot;@mozilla.org/calendar/import;1?type=ics&quot;,</span>
<a href="#l37.27"></a><span id="l37.27">         classDescription: &quot;Calendar ICS Importer&quot;,</span>
<a href="#l37.28"></a><span id="l37.28" class="difflineminus">-        interfaces: [Components.interfaces.calIImporter]</span>
<a href="#l37.29"></a><span id="l37.29" class="difflineplus">+        interfaces: calIcsImporterInterfaces</span>
<a href="#l37.30"></a><span id="l37.30">     }),</span>
<a href="#l37.31"></a><span id="l37.31"> </span>
<a href="#l37.32"></a><span id="l37.32">     getFileTypes: getIcsFileTypes,</span>
<a href="#l37.33"></a><span id="l37.33"> </span>
<a href="#l37.34"></a><span id="l37.34">     importFromStream: function importFromStream(aStream, aCount) {</span>
<a href="#l37.35"></a><span id="l37.35">         let parser = Components.classes[&quot;@mozilla.org/calendar/ics-parser;1&quot;]</span>
<a href="#l37.36"></a><span id="l37.36">                                .createInstance(Components.interfaces.calIIcsParser);</span>
<a href="#l37.37"></a><span id="l37.37">         parser.parseFromStream(aStream, null);</span>
<a href="#l37.38"></a><span id="l37.38">         return parser.getItems(aCount);</span>
<a href="#l37.39"></a><span id="l37.39">     }</span>
<a href="#l37.40"></a><span id="l37.40"> };</span>
<a href="#l37.41"></a><span id="l37.41"> </span>
<a href="#l37.42"></a><span id="l37.42"> // Exporter</span>
<a href="#l37.43"></a><span id="l37.43"> function calIcsExporter() {</span>
<a href="#l37.44"></a><span id="l37.44" class="difflineplus">+    this.wrappedJSObject = this;</span>
<a href="#l37.45"></a><span id="l37.45"> }</span>
<a href="#l37.46"></a><span id="l37.46"> </span>
<a href="#l37.47"></a><span id="l37.47" class="difflineplus">+const calIcsExporterClassID = Components.ID(&quot;{a6a524ce-adff-4a0f-bb7d-d1aaad4adc60}&quot;);</span>
<a href="#l37.48"></a><span id="l37.48" class="difflineplus">+const calIcsExporterInterfaces = [Components.interfaces.calIExporter];</span>
<a href="#l37.49"></a><span id="l37.49"> calIcsExporter.prototype = {</span>
<a href="#l37.50"></a><span id="l37.50" class="difflineminus">-    classID: Components.ID(&quot;{a6a524ce-adff-4a0f-bb7d-d1aaad4adc60}&quot;),</span>
<a href="#l37.51"></a><span id="l37.51" class="difflineminus">-    QueryInterface: XPCOMUtils.generateQI([Components.interfaces.calIExporter]),</span>
<a href="#l37.52"></a><span id="l37.52" class="difflineplus">+    classID: calIcsExporterClassID,</span>
<a href="#l37.53"></a><span id="l37.53" class="difflineplus">+    QueryInterface: XPCOMUtils.generateQI(calIcsExporterInterfaces);</span>
<a href="#l37.54"></a><span id="l37.54"> </span>
<a href="#l37.55"></a><span id="l37.55">     classInfo: XPCOMUtils.generateCI({</span>
<a href="#l37.56"></a><span id="l37.56" class="difflineminus">-        classID: Components.ID(&quot;{a6a524ce-adff-4a0f-bb7d-d1aaad4adc60}&quot;),</span>
<a href="#l37.57"></a><span id="l37.57" class="difflineplus">+        classID: calIcsExporterClassID,</span>
<a href="#l37.58"></a><span id="l37.58">         contractID: &quot;@mozilla.org/calendar/export;1?type=ics&quot;,</span>
<a href="#l37.59"></a><span id="l37.59">         classDescription: &quot;Calendar ICS Exporter&quot;,</span>
<a href="#l37.60"></a><span id="l37.60" class="difflineminus">-        interfaces: [Components.interfaces.calIExporter]</span>
<a href="#l37.61"></a><span id="l37.61" class="difflineplus">+        interfaces: calIcsExporterInterfaces</span>
<a href="#l37.62"></a><span id="l37.62">     }),</span>
<a href="#l37.63"></a><span id="l37.63"> </span>
<a href="#l37.64"></a><span id="l37.64">     getFileTypes: getIcsFileTypes,</span>
<a href="#l37.65"></a><span id="l37.65"> </span>
<a href="#l37.66"></a><span id="l37.66">     exportToStream: function exportToStream(aStream, aCount, aItems) {</span>
<a href="#l37.67"></a><span id="l37.67">         let serializer = Components.classes[&quot;@mozilla.org/calendar/ics-serializer;1&quot;]</span>
<a href="#l37.68"></a><span id="l37.68">                                    .createInstance(Components.interfaces.calIIcsSerializer);</span>
<a href="#l37.69"></a><span id="l37.69">         serializer.addItems(aItems, aItems.length);</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l38.1"></a><span id="l38.1" class="difflineminus">--- a/calendar/import-export/calListFormatter.js</span>
<a href="#l38.2"></a><span id="l38.2" class="difflineplus">+++ b/calendar/import-export/calListFormatter.js</span>
<a href="#l38.3"></a><span id="l38.3" class="difflineat">@@ -4,27 +4,30 @@</span>
<a href="#l38.4"></a><span id="l38.4"> </span>
<a href="#l38.5"></a><span id="l38.5"> Components.utils.import(&quot;resource://gre/modules/XPCOMUtils.jsm&quot;);</span>
<a href="#l38.6"></a><span id="l38.6"> Components.utils.import(&quot;resource://calendar/modules/calUtils.jsm&quot;);</span>
<a href="#l38.7"></a><span id="l38.7"> </span>
<a href="#l38.8"></a><span id="l38.8"> /**</span>
<a href="#l38.9"></a><span id="l38.9">  * A thin wrapper around the html list exporter for the list print format.</span>
<a href="#l38.10"></a><span id="l38.10">  */</span>
<a href="#l38.11"></a><span id="l38.11"> function calListFormatter() {</span>
<a href="#l38.12"></a><span id="l38.12" class="difflineplus">+    this.wrappedJSObject = this;</span>
<a href="#l38.13"></a><span id="l38.13"> }</span>
<a href="#l38.14"></a><span id="l38.14"> </span>
<a href="#l38.15"></a><span id="l38.15" class="difflineplus">+const calListFormatterClassID = Components.ID(&quot;{9ae04413-fee3-45b9-8bbb-1eb39a4cbd1b}&quot;);</span>
<a href="#l38.16"></a><span id="l38.16" class="difflineplus">+const calListFormatterInterfaces = [Components.interfaces.calIPrintFormatter];</span>
<a href="#l38.17"></a><span id="l38.17"> calListFormatter.prototype = {</span>
<a href="#l38.18"></a><span id="l38.18" class="difflineminus">-    classID: Components.ID(&quot;{9ae04413-fee3-45b9-8bbb-1eb39a4cbd1b}&quot;),</span>
<a href="#l38.19"></a><span id="l38.19" class="difflineminus">-    QueryInterface: XPCOMUtils.generateQI([Components.interfaces.calIPrintFormatter]),</span>
<a href="#l38.20"></a><span id="l38.20" class="difflineplus">+    classID: calListFormatterClassID,</span>
<a href="#l38.21"></a><span id="l38.21" class="difflineplus">+    QueryInterface: XPCOMUtils.generateQI(calListFormatterInterfaces),</span>
<a href="#l38.22"></a><span id="l38.22"> </span>
<a href="#l38.23"></a><span id="l38.23">     classInfo: XPCOMUtils.generateCI({</span>
<a href="#l38.24"></a><span id="l38.24" class="difflineminus">-        classID: Components.ID(&quot;{9ae04413-fee3-45b9-8bbb-1eb39a4cbd1b}&quot;),</span>
<a href="#l38.25"></a><span id="l38.25" class="difflineplus">+        classID: calListFormatterClassID,</span>
<a href="#l38.26"></a><span id="l38.26">         contractID: &quot;@mozilla.org/calendar/printformatter;1?type=list&quot;,</span>
<a href="#l38.27"></a><span id="l38.27">         classDescription: &quot;Calendar List Print Formatter&quot;,</span>
<a href="#l38.28"></a><span id="l38.28" class="difflineminus">-        interfaces: [Components.interfaces.calIPrintFormatter]</span>
<a href="#l38.29"></a><span id="l38.29" class="difflineplus">+        interfaces: calListFormatterInterfaces</span>
<a href="#l38.30"></a><span id="l38.30">     }),</span>
<a href="#l38.31"></a><span id="l38.31"> </span>
<a href="#l38.32"></a><span id="l38.32">     get name() cal.calGetString(&quot;calendar&quot;, &quot;formatListName&quot;),</span>
<a href="#l38.33"></a><span id="l38.33"> </span>
<a href="#l38.34"></a><span id="l38.34">     formatToHtml: function list_formatToHtml(aStream, aStart, aEnd, aCount, aItems, aTitle) {</span>
<a href="#l38.35"></a><span id="l38.35">         let htmlexporter = Components.classes[&quot;@mozilla.org/calendar/export;1?type=htmllist&quot;]</span>
<a href="#l38.36"></a><span id="l38.36">                                      .createInstance(Components.interfaces.calIExporter);</span>
<a href="#l38.37"></a><span id="l38.37">         htmlexporter.exportToStream(aStream, aCount, aItems, aTitle);</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l39.1"></a><span id="l39.1" class="difflineminus">--- a/calendar/import-export/calMonthGridPrinter.js</span>
<a href="#l39.2"></a><span id="l39.2" class="difflineplus">+++ b/calendar/import-export/calMonthGridPrinter.js</span>
<a href="#l39.3"></a><span id="l39.3" class="difflineat">@@ -7,27 +7,30 @@ Components.utils.import(&quot;resource://gre/</span>
<a href="#l39.4"></a><span id="l39.4"> Components.utils.import(&quot;resource://calendar/modules/calUtils.jsm&quot;);</span>
<a href="#l39.5"></a><span id="l39.5"> Components.utils.import(&quot;resource://calendar/modules/calXMLUtils.jsm&quot;);</span>
<a href="#l39.6"></a><span id="l39.6"> Components.utils.import(&quot;resource://calendar/modules/calPrintUtils.jsm&quot;);</span>
<a href="#l39.7"></a><span id="l39.7"> </span>
<a href="#l39.8"></a><span id="l39.8"> /**</span>
<a href="#l39.9"></a><span id="l39.9">  * Prints a rough month-grid of events/tasks</span>
<a href="#l39.10"></a><span id="l39.10">  */</span>
<a href="#l39.11"></a><span id="l39.11"> function calMonthPrinter() {</span>
<a href="#l39.12"></a><span id="l39.12" class="difflineplus">+    this.wrappedJSObject = this;</span>
<a href="#l39.13"></a><span id="l39.13"> }</span>
<a href="#l39.14"></a><span id="l39.14"> </span>
<a href="#l39.15"></a><span id="l39.15" class="difflineplus">+const calMonthPrinterClassID = Components.ID(&quot;{f42d5132-92c4-487b-b5c8-38bf292d74c1}&quot;);</span>
<a href="#l39.16"></a><span id="l39.16" class="difflineplus">+const calMonthPrinterInterfaces = [Components.interfaces.calIPrintFormatter];</span>
<a href="#l39.17"></a><span id="l39.17"> calMonthPrinter.prototype = {</span>
<a href="#l39.18"></a><span id="l39.18" class="difflineminus">-    classID: Components.ID(&quot;{f42d5132-92c4-487b-b5c8-38bf292d74c1}&quot;),</span>
<a href="#l39.19"></a><span id="l39.19" class="difflineminus">-    QueryInterface: XPCOMUtils.generateQI([Components.interfaces.calIPrintFormatter]),</span>
<a href="#l39.20"></a><span id="l39.20" class="difflineplus">+    classID: calMonthPrinterClassID,</span>
<a href="#l39.21"></a><span id="l39.21" class="difflineplus">+    QueryInterface: XPCOMUtils.generateQI(calMonthPrinterInterfaces),</span>
<a href="#l39.22"></a><span id="l39.22"> </span>
<a href="#l39.23"></a><span id="l39.23">     classInfo: XPCOMUtils.generateCI({</span>
<a href="#l39.24"></a><span id="l39.24" class="difflineminus">-        classID: Components.ID(&quot;{f42d5132-92c4-487b-b5c8-38bf292d74c1}&quot;),</span>
<a href="#l39.25"></a><span id="l39.25" class="difflineplus">+        classID: calMonthPrinterClassID,</span>
<a href="#l39.26"></a><span id="l39.26">         contractID: &quot;@mozilla.org/calendar/printformatter;1?type=monthgrid&quot;,</span>
<a href="#l39.27"></a><span id="l39.27">         classDescription: &quot;Calendar Month Grid Print Formatter&quot;,</span>
<a href="#l39.28"></a><span id="l39.28" class="difflineminus">-        interfaces: [Components.interfaces.calIPrintFormatter]</span>
<a href="#l39.29"></a><span id="l39.29" class="difflineplus">+        interfaces: calMonthPrinterInterfaces</span>
<a href="#l39.30"></a><span id="l39.30">     }),</span>
<a href="#l39.31"></a><span id="l39.31"> </span>
<a href="#l39.32"></a><span id="l39.32">     get name() cal.calGetString(&quot;calendar&quot;, &quot;monthPrinterName&quot;),</span>
<a href="#l39.33"></a><span id="l39.33"> </span>
<a href="#l39.34"></a><span id="l39.34">     formatToHtml: function monthPrint_format(aStream, aStart, aEnd, aCount, aItems, aTitle) {</span>
<a href="#l39.35"></a><span id="l39.35">         let document = cal.xml.parseFile(&quot;chrome://calendar/skin/printing/calMonthGridPrinter.html&quot;);</span>
<a href="#l39.36"></a><span id="l39.36"> </span>
<a href="#l39.37"></a><span id="l39.37">         // Set page title</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l40.1"></a><span id="l40.1" class="difflineminus">--- a/calendar/import-export/calOutlookCSVImportExport.js</span>
<a href="#l40.2"></a><span id="l40.2" class="difflineplus">+++ b/calendar/import-export/calOutlookCSVImportExport.js</span>
<a href="#l40.3"></a><span id="l40.3" class="difflineat">@@ -1,13 +1,14 @@</span>
<a href="#l40.4"></a><span id="l40.4"> /* This Source Code Form is subject to the terms of the Mozilla Public</span>
<a href="#l40.5"></a><span id="l40.5">  * License, v. 2.0. If a copy of the MPL was not distributed with this</span>
<a href="#l40.6"></a><span id="l40.6">  * file, You can obtain one at http://mozilla.org/MPL/2.0/. */</span>
<a href="#l40.7"></a><span id="l40.7"> </span>
<a href="#l40.8"></a><span id="l40.8"> Components.utils.import(&quot;resource://calendar/modules/calAlarmUtils.jsm&quot;);</span>
<a href="#l40.9"></a><span id="l40.9" class="difflineplus">+Components.utils.import(&quot;resource://gre/modules/XPCOMUtils.jsm&quot;);</span>
<a href="#l40.10"></a><span id="l40.10"> </span>
<a href="#l40.11"></a><span id="l40.11"> const localeEn = {</span>
<a href="#l40.12"></a><span id="l40.12">     headTitle       : &quot;Subject&quot;,</span>
<a href="#l40.13"></a><span id="l40.13">     headStartDate   : &quot;Start Date&quot;,</span>
<a href="#l40.14"></a><span id="l40.14">     headStartTime   : &quot;Start Time&quot;,</span>
<a href="#l40.15"></a><span id="l40.15">     headEndDate     : &quot;End Date&quot;,</span>
<a href="#l40.16"></a><span id="l40.16">     headEndTime     : &quot;End Time&quot;,</span>
<a href="#l40.17"></a><span id="l40.17">     headAllDayEvent : &quot;All day event&quot;,</span>
<a href="#l40.18"></a><span id="l40.18" class="difflineat">@@ -81,42 +82,29 @@ function getOutlookCsvFileTypes(aCount) </span>
<a href="#l40.19"></a><span id="l40.19">     let label = cal.calGetString(&quot;calendar&quot;, 'filterOutlookCsv', [wildmat]);</span>
<a href="#l40.20"></a><span id="l40.20">     return [{ defaultExtension: 'csv',</span>
<a href="#l40.21"></a><span id="l40.21">               extensionFilter: wildmat,</span>
<a href="#l40.22"></a><span id="l40.22">               description: label }];</span>
<a href="#l40.23"></a><span id="l40.23"> }</span>
<a href="#l40.24"></a><span id="l40.24"> </span>
<a href="#l40.25"></a><span id="l40.25"> // Importer</span>
<a href="#l40.26"></a><span id="l40.26"> function calOutlookCSVImporter() {</span>
<a href="#l40.27"></a><span id="l40.27" class="difflineplus">+    this.wrappedJSObject = this;</span>
<a href="#l40.28"></a><span id="l40.28"> }</span>
<a href="#l40.29"></a><span id="l40.29" class="difflineminus">-</span>
<a href="#l40.30"></a><span id="l40.30" class="difflineplus">+const calOutlookCSVImporterClassID = Components.ID(&quot;{64a5d17a-0497-48c5-b54f-72b15c9e9a14}&quot;);</span>
<a href="#l40.31"></a><span id="l40.31" class="difflineplus">+const calOutlookCSVImporterInterfaces = [Components.interfaces.calIImporter];</span>
<a href="#l40.32"></a><span id="l40.32"> calOutlookCSVImporter.prototype = {</span>
<a href="#l40.33"></a><span id="l40.33" class="difflineminus">-    getInterfaces: function (count) {</span>
<a href="#l40.34"></a><span id="l40.34" class="difflineminus">-        const ifaces = [</span>
<a href="#l40.35"></a><span id="l40.35" class="difflineminus">-            Components.interfaces.nsISupports,</span>
<a href="#l40.36"></a><span id="l40.36" class="difflineminus">-            Components.interfaces.nsIClassInfo,</span>
<a href="#l40.37"></a><span id="l40.37" class="difflineminus">-            Components.interfaces.calIImporter,</span>
<a href="#l40.38"></a><span id="l40.38" class="difflineminus">-        ];</span>
<a href="#l40.39"></a><span id="l40.39" class="difflineminus">-        count.value = ifaces.length;</span>
<a href="#l40.40"></a><span id="l40.40" class="difflineminus">-        return ifaces;</span>
<a href="#l40.41"></a><span id="l40.41" class="difflineminus">-    },</span>
<a href="#l40.42"></a><span id="l40.42" class="difflineminus">-</span>
<a href="#l40.43"></a><span id="l40.43" class="difflineminus">-    getHelperForLanguage: function (language) {</span>
<a href="#l40.44"></a><span id="l40.44" class="difflineminus">-        return null;</span>
<a href="#l40.45"></a><span id="l40.45" class="difflineminus">-    },</span>
<a href="#l40.46"></a><span id="l40.46" class="difflineminus">-</span>
<a href="#l40.47"></a><span id="l40.47" class="difflineminus">-    contractID: &quot;@mozilla.org/calendar/import;1?type=csv&quot;,</span>
<a href="#l40.48"></a><span id="l40.48" class="difflineminus">-    classDescription: &quot;Calendar Outlook CSV Importer&quot;,</span>
<a href="#l40.49"></a><span id="l40.49" class="difflineminus">-    classID: Components.ID(&quot;{64a5d17a-0497-48c5-b54f-72b15c9e9a14}&quot;),</span>
<a href="#l40.50"></a><span id="l40.50" class="difflineminus">-    implementationLanguage: Components.interfaces.nsIProgrammingLanguage.JAVASCRIPT,</span>
<a href="#l40.51"></a><span id="l40.51" class="difflineminus">-    flags: 0,</span>
<a href="#l40.52"></a><span id="l40.52" class="difflineminus">-</span>
<a href="#l40.53"></a><span id="l40.53" class="difflineminus">-    QueryInterface: function QueryInterface(aIID) {</span>
<a href="#l40.54"></a><span id="l40.54" class="difflineminus">-        return cal.doQueryInterface(this, calOutlookCSVImporter.prototype, aIID, null, this);</span>
<a href="#l40.55"></a><span id="l40.55" class="difflineminus">-    },</span>
<a href="#l40.56"></a><span id="l40.56" class="difflineplus">+    classID: calOutlookCSVImporterClassID,</span>
<a href="#l40.57"></a><span id="l40.57" class="difflineplus">+    QueryInterface: XPCOMUtils.generateQI(calOutlookCSVImporterInterfaces),</span>
<a href="#l40.58"></a><span id="l40.58" class="difflineplus">+    classInfo: XPCOMUtils.generateCI({</span>
<a href="#l40.59"></a><span id="l40.59" class="difflineplus">+        classID: calOutlookCSVImporterClassID,</span>
<a href="#l40.60"></a><span id="l40.60" class="difflineplus">+        contractID: &quot;@mozilla.org/calendar/import;1?type=csv&quot;,</span>
<a href="#l40.61"></a><span id="l40.61" class="difflineplus">+        classDescription: &quot;Calendar Outlook CSV Importer&quot;,</span>
<a href="#l40.62"></a><span id="l40.62" class="difflineplus">+        interfaces: calOutlookCSVImporterInterfaces</span>
<a href="#l40.63"></a><span id="l40.63" class="difflineplus">+    }),</span>
<a href="#l40.64"></a><span id="l40.64"> </span>
<a href="#l40.65"></a><span id="l40.65">     getFileTypes: getOutlookCsvFileTypes,</span>
<a href="#l40.66"></a><span id="l40.66"> </span>
<a href="#l40.67"></a><span id="l40.67">     /**</span>
<a href="#l40.68"></a><span id="l40.68">      * Takes a text block of Outlook-exported Comma Separated Values and tries to</span>
<a href="#l40.69"></a><span id="l40.69">      * parse that into individual events.</span>
<a href="#l40.70"></a><span id="l40.70">      *</span>
<a href="#l40.71"></a><span id="l40.71">      * First line is field names, all quoted with double quotes.  Field names are</span>
<a href="#l40.72"></a><span id="l40.72" class="difflineat">@@ -425,41 +413,27 @@ calOutlookCSVImporter.prototype = {</span>
<a href="#l40.73"></a><span id="l40.73">     parseTextField: function parseTextField(aTextField) {</span>
<a href="#l40.74"></a><span id="l40.74">         return aTextField ? aTextField.replace(/&quot;&quot;/g, &quot;\&quot;&quot;) : &quot;&quot;;</span>
<a href="#l40.75"></a><span id="l40.75">     }</span>
<a href="#l40.76"></a><span id="l40.76"> };</span>
<a href="#l40.77"></a><span id="l40.77"> </span>
<a href="#l40.78"></a><span id="l40.78"> // Exporter</span>
<a href="#l40.79"></a><span id="l40.79"> function calOutlookCSVExporter() {</span>
<a href="#l40.80"></a><span id="l40.80"> }</span>
<a href="#l40.81"></a><span id="l40.81" class="difflineminus">-</span>
<a href="#l40.82"></a><span id="l40.82" class="difflineplus">+const calOutlookCSVExporterClassID = Components.ID(&quot;{48e6d3a6-b41b-4052-9ed2-40b27800bd4b}&quot;);</span>
<a href="#l40.83"></a><span id="l40.83" class="difflineplus">+const calOutlookCSVExporterInterfaces = [Components.interfaces.calIExporter];</span>
<a href="#l40.84"></a><span id="l40.84"> calOutlookCSVExporter.prototype = {</span>
<a href="#l40.85"></a><span id="l40.85" class="difflineminus">-    getInterfaces: function (count) {</span>
<a href="#l40.86"></a><span id="l40.86" class="difflineminus">-        const ifaces = [</span>
<a href="#l40.87"></a><span id="l40.87" class="difflineminus">-            Components.interfaces.nsISupports,</span>
<a href="#l40.88"></a><span id="l40.88" class="difflineminus">-            Components.interfaces.nsIClassInfo,</span>
<a href="#l40.89"></a><span id="l40.89" class="difflineminus">-            Components.interfaces.calIExporter,</span>
<a href="#l40.90"></a><span id="l40.90" class="difflineminus">-        ];</span>
<a href="#l40.91"></a><span id="l40.91" class="difflineminus">-        count.value = ifaces.length;</span>
<a href="#l40.92"></a><span id="l40.92" class="difflineminus">-        return ifaces;</span>
<a href="#l40.93"></a><span id="l40.93" class="difflineminus">-    },</span>
<a href="#l40.94"></a><span id="l40.94" class="difflineminus">-</span>
<a href="#l40.95"></a><span id="l40.95" class="difflineminus">-    getHelperForLanguage: function (language) {</span>
<a href="#l40.96"></a><span id="l40.96" class="difflineminus">-        return null;</span>
<a href="#l40.97"></a><span id="l40.97" class="difflineminus">-    },</span>
<a href="#l40.98"></a><span id="l40.98" class="difflineminus">-</span>
<a href="#l40.99"></a><span id="l40.99" class="difflineminus">-    contractID: &quot;@mozilla.org/calendar/export;1?type=csv&quot;,</span>
<a href="#l40.100"></a><span id="l40.100" class="difflineminus">-    classDescription: &quot;Calendar Outlook CSV Exporter&quot;,</span>
<a href="#l40.101"></a><span id="l40.101" class="difflineminus">-    classID: Components.ID(&quot;{48e6d3a6-b41b-4052-9ed2-40b27800bd4b}&quot;),</span>
<a href="#l40.102"></a><span id="l40.102" class="difflineminus">-    implementationLanguage: Components.interfaces.nsIProgrammingLanguage.JAVASCRIPT,</span>
<a href="#l40.103"></a><span id="l40.103" class="difflineminus">-    flags: 0,</span>
<a href="#l40.104"></a><span id="l40.104" class="difflineminus">-</span>
<a href="#l40.105"></a><span id="l40.105" class="difflineminus">-    QueryInterface: function QueryInterface(aIID) {</span>
<a href="#l40.106"></a><span id="l40.106" class="difflineminus">-        return cal.doQueryInterface(this, calOutlookCSVExporter.prototype, aIID, null, this);</span>
<a href="#l40.107"></a><span id="l40.107" class="difflineminus">-    },</span>
<a href="#l40.108"></a><span id="l40.108" class="difflineplus">+    classID: calOutlookCSVExporterClassID,</span>
<a href="#l40.109"></a><span id="l40.109" class="difflineplus">+    QueryInterface: XPCOMUtils.generateQI(calOutlookCSVExporterInterfaces),</span>
<a href="#l40.110"></a><span id="l40.110" class="difflineplus">+    classInfo: XPCOMUtils.generateCI({</span>
<a href="#l40.111"></a><span id="l40.111" class="difflineplus">+        classID: calOutlookCSVExporterClassID,</span>
<a href="#l40.112"></a><span id="l40.112" class="difflineplus">+        contractID: &quot;@mozilla.org/calendar/export;1?type=csv&quot;,</span>
<a href="#l40.113"></a><span id="l40.113" class="difflineplus">+        classDescription: &quot;Calendar Outlook CSV Exporter&quot;,</span>
<a href="#l40.114"></a><span id="l40.114" class="difflineplus">+        interfaces: calOutlookCSVExporterInterfaces</span>
<a href="#l40.115"></a><span id="l40.115" class="difflineplus">+    }),</span>
<a href="#l40.116"></a><span id="l40.116"> </span>
<a href="#l40.117"></a><span id="l40.117">     getFileTypes: getOutlookCsvFileTypes,</span>
<a href="#l40.118"></a><span id="l40.118"> </span>
<a href="#l40.119"></a><span id="l40.119">     exportToStream: function csv_exportToStream(aStream, aCount, aItems) {</span>
<a href="#l40.120"></a><span id="l40.120">         // Helper functions</span>
<a href="#l40.121"></a><span id="l40.121">         function dateString(aDateTime) aDateTime.jsDate.toLocaleFormat(localeEn.dateFormat);</span>
<a href="#l40.122"></a><span id="l40.122">         function timeString(aDateTime) aDateTime.jsDate.toLocaleFormat(localeEn.timeFormat);</span>
<a href="#l40.123"></a><span id="l40.123">         function txtString(aString) aString || &quot;&quot;;</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l41.1"></a><span id="l41.1" class="difflineminus">--- a/calendar/import-export/calWeekPrinter.js</span>
<a href="#l41.2"></a><span id="l41.2" class="difflineplus">+++ b/calendar/import-export/calWeekPrinter.js</span>
<a href="#l41.3"></a><span id="l41.3" class="difflineat">@@ -7,27 +7,30 @@ Components.utils.import(&quot;resource://gre/</span>
<a href="#l41.4"></a><span id="l41.4"> Components.utils.import(&quot;resource://calendar/modules/calUtils.jsm&quot;);</span>
<a href="#l41.5"></a><span id="l41.5"> Components.utils.import(&quot;resource://calendar/modules/calXMLUtils.jsm&quot;);</span>
<a href="#l41.6"></a><span id="l41.6"> Components.utils.import(&quot;resource://calendar/modules/calPrintUtils.jsm&quot;);</span>
<a href="#l41.7"></a><span id="l41.7"> </span>
<a href="#l41.8"></a><span id="l41.8"> /**</span>
<a href="#l41.9"></a><span id="l41.9">  * Prints a two column view of a week of events, much like a paper day-planner</span>
<a href="#l41.10"></a><span id="l41.10">  */</span>
<a href="#l41.11"></a><span id="l41.11"> function calWeekPrinter() {</span>
<a href="#l41.12"></a><span id="l41.12" class="difflineplus">+    this.wrappedJSObject = this;</span>
<a href="#l41.13"></a><span id="l41.13"> }</span>
<a href="#l41.14"></a><span id="l41.14"> </span>
<a href="#l41.15"></a><span id="l41.15" class="difflineplus">+const calWeekPrinterClassID = Components.ID(&quot;{2d6ec97b-9109-4b92-89c5-d4b4806619ce}&quot;);</span>
<a href="#l41.16"></a><span id="l41.16" class="difflineplus">+const calWeekPrinterInterfaces = [Components.interfaces.calIPrintFormatter];</span>
<a href="#l41.17"></a><span id="l41.17"> calWeekPrinter.prototype = {</span>
<a href="#l41.18"></a><span id="l41.18" class="difflineminus">-    classID: Components.ID(&quot;{2d6ec97b-9109-4b92-89c5-d4b4806619ce}&quot;),</span>
<a href="#l41.19"></a><span id="l41.19" class="difflineminus">-    QueryInterface: XPCOMUtils.generateQI([Components.interfaces.calIPrintFormatter]),</span>
<a href="#l41.20"></a><span id="l41.20" class="difflineplus">+    classID: calWeekPrinterClassID,</span>
<a href="#l41.21"></a><span id="l41.21" class="difflineplus">+    QueryInterface: XPCOMUtils.generateQI(calWeekPrinterInterfaces),</span>
<a href="#l41.22"></a><span id="l41.22"> </span>
<a href="#l41.23"></a><span id="l41.23">     classInfo: XPCOMUtils.generateCI({</span>
<a href="#l41.24"></a><span id="l41.24" class="difflineminus">-        classID: Components.ID(&quot;{2d6ec97b-9109-4b92-89c5-d4b4806619ce}&quot;),</span>
<a href="#l41.25"></a><span id="l41.25" class="difflineplus">+        classID: calWeekPrinterClassID,</span>
<a href="#l41.26"></a><span id="l41.26">         contractID: &quot;@mozilla.org/calendar/printformatter;1?type=weekplan&quot;,</span>
<a href="#l41.27"></a><span id="l41.27">         classDescription: &quot;Calendar Week Print Formatter&quot;,</span>
<a href="#l41.28"></a><span id="l41.28" class="difflineminus">-        interfaces: [Components.interfaces.calIPrintFormatter]</span>
<a href="#l41.29"></a><span id="l41.29" class="difflineplus">+        interfaces: calWeekPrinterInterfaces</span>
<a href="#l41.30"></a><span id="l41.30">     }),</span>
<a href="#l41.31"></a><span id="l41.31"> </span>
<a href="#l41.32"></a><span id="l41.32">     get name() cal.calGetString(&quot;calendar&quot;, &quot;weekPrinterName&quot;),</span>
<a href="#l41.33"></a><span id="l41.33"> </span>
<a href="#l41.34"></a><span id="l41.34">     formatToHtml: function weekPrint_format(aStream, aStart, aEnd, aCount, aItems, aTitle) {</span>
<a href="#l41.35"></a><span id="l41.35">         let document = cal.xml.parseFile(&quot;chrome://calendar/skin/printing/calWeekPrinter.html&quot;);</span>
<a href="#l41.36"></a><span id="l41.36"> </span>
<a href="#l41.37"></a><span id="l41.37">         // Set page title</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l42.1"></a><span id="l42.1" class="difflineminus">--- a/calendar/itip/calItipEmailTransport.js</span>
<a href="#l42.2"></a><span id="l42.2" class="difflineplus">+++ b/calendar/itip/calItipEmailTransport.js</span>
<a href="#l42.3"></a><span id="l42.3" class="difflineat">@@ -16,59 +16,44 @@ function convertFromUnicode(aCharset, aS</span>
<a href="#l42.4"></a><span id="l42.4"> </span>
<a href="#l42.5"></a><span id="l42.5"> /**</span>
<a href="#l42.6"></a><span id="l42.6">  * Constructor of calItipEmailTransport object</span>
<a href="#l42.7"></a><span id="l42.7">  */</span>
<a href="#l42.8"></a><span id="l42.8"> function calItipEmailTransport() {</span>
<a href="#l42.9"></a><span id="l42.9">     this.wrappedJSObject = this;</span>
<a href="#l42.10"></a><span id="l42.10">     this._initEmailTransport();</span>
<a href="#l42.11"></a><span id="l42.11"> }</span>
<a href="#l42.12"></a><span id="l42.12" class="difflineminus">-</span>
<a href="#l42.13"></a><span id="l42.13" class="difflineplus">+const calItipEmailTransportClassID = Components.ID(&quot;{d4d7b59e-c9e0-4a7a-b5e8-5958f85515f0}&quot;);</span>
<a href="#l42.14"></a><span id="l42.14" class="difflineplus">+const calItipEmailTransportInterfaces = [Components.interfaces.calIItipTransport];</span>
<a href="#l42.15"></a><span id="l42.15"> calItipEmailTransport.prototype = {</span>
<a href="#l42.16"></a><span id="l42.16" class="difflineminus">-    classID: Components.ID(&quot;{d4d7b59e-c9e0-4a7a-b5e8-5958f85515f0}&quot;),</span>
<a href="#l42.17"></a><span id="l42.17" class="difflineminus">-    contractID: &quot;@mozilla.org/calendar/itip-transport;1?type=email&quot;,</span>
<a href="#l42.18"></a><span id="l42.18" class="difflineminus">-    classDescription: &quot;Calendar iTIP Email Transport&quot;,</span>
<a href="#l42.19"></a><span id="l42.19" class="difflineminus">-</span>
<a href="#l42.20"></a><span id="l42.20" class="difflineminus">-    getInterfaces: function getInterfaces(count) {</span>
<a href="#l42.21"></a><span id="l42.21" class="difflineminus">-        const ifaces = [Components.interfaces.calIItipTransport,</span>
<a href="#l42.22"></a><span id="l42.22" class="difflineminus">-                        Components.interfaces.nsIClassInfo,</span>
<a href="#l42.23"></a><span id="l42.23" class="difflineminus">-                        Components.interfaces.nsISupports];</span>
<a href="#l42.24"></a><span id="l42.24" class="difflineminus">-        count.value = ifaces.length;</span>
<a href="#l42.25"></a><span id="l42.25" class="difflineminus">-        return ifaces;</span>
<a href="#l42.26"></a><span id="l42.26" class="difflineminus">-    },</span>
<a href="#l42.27"></a><span id="l42.27" class="difflineminus">-    getHelperForLanguage: function getHelperForLanguage(language) {</span>
<a href="#l42.28"></a><span id="l42.28" class="difflineminus">-        return null;</span>
<a href="#l42.29"></a><span id="l42.29" class="difflineminus">-    },</span>
<a href="#l42.30"></a><span id="l42.30" class="difflineminus">-    implementationLanguage: Components.interfaces.nsIProgrammingLanguage.JAVASCRIPT,</span>
<a href="#l42.31"></a><span id="l42.31" class="difflineminus">-    flags: 0,</span>
<a href="#l42.32"></a><span id="l42.32" class="difflineminus">-</span>
<a href="#l42.33"></a><span id="l42.33" class="difflineminus">-    QueryInterface: function QueryInterface(aIID) {</span>
<a href="#l42.34"></a><span id="l42.34" class="difflineminus">-        return cal.doQueryInterface(this, calItipEmailTransport.prototype, aIID, null, this);</span>
<a href="#l42.35"></a><span id="l42.35" class="difflineminus">-    },</span>
<a href="#l42.36"></a><span id="l42.36" class="difflineplus">+    classID: calItipEmailTransportClassID,</span>
<a href="#l42.37"></a><span id="l42.37" class="difflineplus">+    QueryInterface: XPCOMUtils.generateQI(calItipEmailTransportInterfaces),</span>
<a href="#l42.38"></a><span id="l42.38" class="difflineplus">+    classInfo: XPCOMUtils.generateCI({</span>
<a href="#l42.39"></a><span id="l42.39" class="difflineplus">+        classID: calItipEmailTransportClassID,</span>
<a href="#l42.40"></a><span id="l42.40" class="difflineplus">+        contractID: &quot;@mozilla.org/calendar/itip-transport;1?type=email&quot;,</span>
<a href="#l42.41"></a><span id="l42.41" class="difflineplus">+        classDescription: &quot;Calendar iTIP Email Transport&quot;,</span>
<a href="#l42.42"></a><span id="l42.42" class="difflineplus">+        interfaces: calItipEmailTransportInterfaces,</span>
<a href="#l42.43"></a><span id="l42.43" class="difflineplus">+    }),</span>
<a href="#l42.44"></a><span id="l42.44"> </span>
<a href="#l42.45"></a><span id="l42.45">     mHasXpcomMail: false,</span>
<a href="#l42.46"></a><span id="l42.46">     mDefaultAccount: null,</span>
<a href="#l42.47"></a><span id="l42.47">     mDefaultIdentity: null,</span>
<a href="#l42.48"></a><span id="l42.48">     mDefaultSmtpServer: null,</span>
<a href="#l42.49"></a><span id="l42.49"> </span>
<a href="#l42.50"></a><span id="l42.50" class="difflineminus">-    get scheme() {</span>
<a href="#l42.51"></a><span id="l42.51" class="difflineminus">-        return &quot;mailto&quot;;</span>
<a href="#l42.52"></a><span id="l42.52" class="difflineminus">-    },</span>
<a href="#l42.53"></a><span id="l42.53" class="difflineplus">+    get scheme() &quot;mailto&quot;,</span>
<a href="#l42.54"></a><span id="l42.54" class="difflineplus">+    get type() &quot;email&quot;,</span>
<a href="#l42.55"></a><span id="l42.55"> </span>
<a href="#l42.56"></a><span id="l42.56">     mSenderAddress: null,</span>
<a href="#l42.57"></a><span id="l42.57">     get senderAddress() {</span>
<a href="#l42.58"></a><span id="l42.58">         return this.mSenderAddress;</span>
<a href="#l42.59"></a><span id="l42.59">     },</span>
<a href="#l42.60"></a><span id="l42.60">     set senderAddress(aValue) {</span>
<a href="#l42.61"></a><span id="l42.61">         return (this.mSenderAddress = aValue);</span>
<a href="#l42.62"></a><span id="l42.62">     },</span>
<a href="#l42.63"></a><span id="l42.63"> </span>
<a href="#l42.64"></a><span id="l42.64" class="difflineminus">-    get type() {</span>
<a href="#l42.65"></a><span id="l42.65" class="difflineminus">-        return &quot;email&quot;;</span>
<a href="#l42.66"></a><span id="l42.66" class="difflineminus">-    },</span>
<a href="#l42.67"></a><span id="l42.67"> </span>
<a href="#l42.68"></a><span id="l42.68">     sendItems: function cietSI(aCount, aRecipients, aItipItem) {</span>
<a href="#l42.69"></a><span id="l42.69">         if (this.mHasXpcomMail) {</span>
<a href="#l42.70"></a><span id="l42.70">             cal.LOG(&quot;sendItems: Sending Email...&quot;);</span>
<a href="#l42.71"></a><span id="l42.71"> </span>
<a href="#l42.72"></a><span id="l42.72">             let item = aItipItem.getItemList({})[0];</span>
<a href="#l42.73"></a><span id="l42.73"> </span>
<a href="#l42.74"></a><span id="l42.74">             // Get ourselves some default text - when we handle organizer properly</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l43.1"></a><span id="l43.1" class="difflineminus">--- a/calendar/lightning/components/calItipProtocolHandler.js</span>
<a href="#l43.2"></a><span id="l43.2" class="difflineplus">+++ b/calendar/lightning/components/calItipProtocolHandler.js</span>
<a href="#l43.3"></a><span id="l43.3" class="difflineat">@@ -1,55 +1,43 @@</span>
<a href="#l43.4"></a><span id="l43.4"> /* This Source Code Form is subject to the terms of the Mozilla Public</span>
<a href="#l43.5"></a><span id="l43.5">  * License, v. 2.0. If a copy of the MPL was not distributed with this</span>
<a href="#l43.6"></a><span id="l43.6">  * file, You can obtain one at http://mozilla.org/MPL/2.0/. */</span>
<a href="#l43.7"></a><span id="l43.7"> </span>
<a href="#l43.8"></a><span id="l43.8" class="difflineminus">-</span>
<a href="#l43.9"></a><span id="l43.9"> Components.utils.import(&quot;resource://gre/modules/XPCOMUtils.jsm&quot;);</span>
<a href="#l43.10"></a><span id="l43.10"> Components.utils.import(&quot;resource://calendar/modules/calUtils.jsm&quot;);</span>
<a href="#l43.11"></a><span id="l43.11"> </span>
<a href="#l43.12"></a><span id="l43.12"> const CI = Components.interfaces;</span>
<a href="#l43.13"></a><span id="l43.13"> </span>
<a href="#l43.14"></a><span id="l43.14"> const ITIP_HANDLER_MIMETYPE = &quot;application/x-itip-internal&quot;;</span>
<a href="#l43.15"></a><span id="l43.15"> const ITIP_HANDLER_PROTOCOL = &quot;moz-cal-handle-itip&quot;;</span>
<a href="#l43.16"></a><span id="l43.16"> </span>
<a href="#l43.17"></a><span id="l43.17"> </span>
<a href="#l43.18"></a><span id="l43.18" class="difflineminus">-function NYI()</span>
<a href="#l43.19"></a><span id="l43.19" class="difflineminus">-{</span>
<a href="#l43.20"></a><span id="l43.20" class="difflineplus">+function NYI() {</span>
<a href="#l43.21"></a><span id="l43.21">     throw Components.results.NS_ERROR_NOT_IMPLEMENTED;</span>
<a href="#l43.22"></a><span id="l43.22"> }</span>
<a href="#l43.23"></a><span id="l43.23"> </span>
<a href="#l43.24"></a><span id="l43.24" class="difflineminus">-function ItipChannel(URI)</span>
<a href="#l43.25"></a><span id="l43.25" class="difflineminus">-{</span>
<a href="#l43.26"></a><span id="l43.26" class="difflineplus">+function ItipChannel(URI) {</span>
<a href="#l43.27"></a><span id="l43.27">    this.URI = this.originalURI = URI;</span>
<a href="#l43.28"></a><span id="l43.28"> }</span>
<a href="#l43.29"></a><span id="l43.29" class="difflineminus">-</span>
<a href="#l43.30"></a><span id="l43.30" class="difflineplus">+const ItipChannelClassID = Components.ID(&quot;{643e0328-36f6-411d-a107-16238dff9cd7}&quot;);</span>
<a href="#l43.31"></a><span id="l43.31" class="difflineplus">+const ItipChannelInterfaces = [</span>
<a href="#l43.32"></a><span id="l43.32" class="difflineplus">+    Components.interfaces.nsIChannel,</span>
<a href="#l43.33"></a><span id="l43.33" class="difflineplus">+    Components.interfaces.nsIRequest</span>
<a href="#l43.34"></a><span id="l43.34" class="difflineplus">+];</span>
<a href="#l43.35"></a><span id="l43.35"> ItipChannel.prototype = {</span>
<a href="#l43.36"></a><span id="l43.36" class="difflineminus">-    classID: Components.ID(&quot;{643e0328-36f6-411d-a107-16238dff9cd7}&quot;),</span>
<a href="#l43.37"></a><span id="l43.37" class="difflineminus">-    contractID: &quot;@mozilla.org/calendar/itip-channel;1&quot;,</span>
<a href="#l43.38"></a><span id="l43.38" class="difflineminus">-    classDescription: &quot;Calendar Itip Channel&quot;,</span>
<a href="#l43.39"></a><span id="l43.39" class="difflineplus">+    classID: ItipChannelClassID,</span>
<a href="#l43.40"></a><span id="l43.40" class="difflineplus">+    QueryInterface: XPCOMUtils.generateQI(ItipChannelInterfaces),</span>
<a href="#l43.41"></a><span id="l43.41" class="difflineplus">+    classInfo: XPCOMUtils.generateCI({</span>
<a href="#l43.42"></a><span id="l43.42" class="difflineplus">+        classID: ItipChannelClassID,</span>
<a href="#l43.43"></a><span id="l43.43" class="difflineplus">+        contractID: &quot;@mozilla.org/calendar/itip-channel;1&quot;,</span>
<a href="#l43.44"></a><span id="l43.44" class="difflineplus">+        classDescription: &quot;Calendar Itip Channel&quot;,</span>
<a href="#l43.45"></a><span id="l43.45" class="difflineplus">+        interfaces: ItipChannelInterfaces,</span>
<a href="#l43.46"></a><span id="l43.46" class="difflineplus">+    }),</span>
<a href="#l43.47"></a><span id="l43.47"> </span>
<a href="#l43.48"></a><span id="l43.48" class="difflineminus">-    getInterfaces: function getInterfaces(count) {</span>
<a href="#l43.49"></a><span id="l43.49" class="difflineminus">-        const ifaces = [Components.interfaces.nsIChannel,</span>
<a href="#l43.50"></a><span id="l43.50" class="difflineminus">-                        Components.interfaces.nsIRequest,</span>
<a href="#l43.51"></a><span id="l43.51" class="difflineminus">-                        Components.interfaces.nsIClassInfo,</span>
<a href="#l43.52"></a><span id="l43.52" class="difflineminus">-                        Components.interfaces.nsISupports];</span>
<a href="#l43.53"></a><span id="l43.53" class="difflineminus">-        count.value = ifaces.length;</span>
<a href="#l43.54"></a><span id="l43.54" class="difflineminus">-        return ifaces;</span>
<a href="#l43.55"></a><span id="l43.55" class="difflineminus">-    },</span>
<a href="#l43.56"></a><span id="l43.56" class="difflineminus">-    getHelperForLanguage: function getHelperForLanguage(language) {</span>
<a href="#l43.57"></a><span id="l43.57" class="difflineminus">-        return null;</span>
<a href="#l43.58"></a><span id="l43.58" class="difflineminus">-    },</span>
<a href="#l43.59"></a><span id="l43.59" class="difflineminus">-    implementationLanguage: Components.interfaces.nsIProgrammingLanguage.JAVASCRIPT,</span>
<a href="#l43.60"></a><span id="l43.60" class="difflineminus">-    flags: 0,</span>
<a href="#l43.61"></a><span id="l43.61" class="difflineminus">-</span>
<a href="#l43.62"></a><span id="l43.62" class="difflineminus">-    QueryInterface: function QueryInterface(aIID) {</span>
<a href="#l43.63"></a><span id="l43.63" class="difflineminus">-        return cal.doQueryInterface(this, ItipChannel.prototype, aIID, null, this);</span>
<a href="#l43.64"></a><span id="l43.64" class="difflineminus">-    },</span>
<a href="#l43.65"></a><span id="l43.65" class="difflineminus">-    </span>
<a href="#l43.66"></a><span id="l43.66">     contentType: ITIP_HANDLER_MIMETYPE,</span>
<a href="#l43.67"></a><span id="l43.67">     loadAttributes: null,</span>
<a href="#l43.68"></a><span id="l43.68">     contentLength: 0,</span>
<a href="#l43.69"></a><span id="l43.69">     owner: null,</span>
<a href="#l43.70"></a><span id="l43.70">     loadGroup: null,</span>
<a href="#l43.71"></a><span id="l43.71">     notificationCallbacks: null,</span>
<a href="#l43.72"></a><span id="l43.72">     securityInfo: null,</span>
<a href="#l43.73"></a><span id="l43.73">     </span>
<a href="#l43.74"></a><span id="l43.74" class="difflineat">@@ -63,82 +51,64 @@ ItipChannel.prototype = {</span>
<a href="#l43.75"></a><span id="l43.75">     </span>
<a href="#l43.76"></a><span id="l43.76">     isPending: function () { return true; },</span>
<a href="#l43.77"></a><span id="l43.77">     status: Components.results.NS_OK,</span>
<a href="#l43.78"></a><span id="l43.78">     cancel: function (status) { this.status = status; },</span>
<a href="#l43.79"></a><span id="l43.79">     suspend: NYI,</span>
<a href="#l43.80"></a><span id="l43.80">     resume: NYI,</span>
<a href="#l43.81"></a><span id="l43.81"> };</span>
<a href="#l43.82"></a><span id="l43.82"> </span>
<a href="#l43.83"></a><span id="l43.83" class="difflineminus">-function ItipProtocolHandler() { }</span>
<a href="#l43.84"></a><span id="l43.84" class="difflineminus">-</span>
<a href="#l43.85"></a><span id="l43.85" class="difflineplus">+function ItipProtocolHandler() {</span>
<a href="#l43.86"></a><span id="l43.86" class="difflineplus">+    this.wrappedJSObject = this;</span>
<a href="#l43.87"></a><span id="l43.87" class="difflineplus">+}</span>
<a href="#l43.88"></a><span id="l43.88" class="difflineplus">+const ItipProtocolHandlerClassID = Components.ID(&quot;{6e957006-b4ce-11d9-b053-001124736B74}&quot;);</span>
<a href="#l43.89"></a><span id="l43.89" class="difflineplus">+const ItipProtocolHandlerInterfaces = [Components.interfaces.nsIProtocolHandler];</span>
<a href="#l43.90"></a><span id="l43.90"> ItipProtocolHandler.prototype = {</span>
<a href="#l43.91"></a><span id="l43.91" class="difflineminus">-    classID: Components.ID(&quot;{6e957006-b4ce-11d9-b053-001124736B74}&quot;),</span>
<a href="#l43.92"></a><span id="l43.92" class="difflineminus">-    contractID: &quot;@mozilla.org/network/protocol;1?name=&quot; + ITIP_HANDLER_PROTOCOL,</span>
<a href="#l43.93"></a><span id="l43.93" class="difflineminus">-    getInterfaces: function getInterfaces(count) {</span>
<a href="#l43.94"></a><span id="l43.94" class="difflineminus">-        const ifaces = [Components.interfaces.nsIProtocolHandler,</span>
<a href="#l43.95"></a><span id="l43.95" class="difflineminus">-                        Components.interfaces.nsIClassInfo,</span>
<a href="#l43.96"></a><span id="l43.96" class="difflineminus">-                        Components.interfaces.nsISupports];</span>
<a href="#l43.97"></a><span id="l43.97" class="difflineminus">-        count.value = ifaces.length;</span>
<a href="#l43.98"></a><span id="l43.98" class="difflineminus">-        return ifaces;</span>
<a href="#l43.99"></a><span id="l43.99" class="difflineminus">-    },</span>
<a href="#l43.100"></a><span id="l43.100" class="difflineminus">-    getHelperForLanguage: function getHelperForLanguage(language) {</span>
<a href="#l43.101"></a><span id="l43.101" class="difflineminus">-        return null;</span>
<a href="#l43.102"></a><span id="l43.102" class="difflineminus">-    },</span>
<a href="#l43.103"></a><span id="l43.103" class="difflineminus">-    implementationLanguage: Components.interfaces.nsIProgrammingLanguage.JAVASCRIPT,</span>
<a href="#l43.104"></a><span id="l43.104" class="difflineminus">-    flags: 0,</span>
<a href="#l43.105"></a><span id="l43.105" class="difflineplus">+    classID: ItipProtocolHandlerClassID,</span>
<a href="#l43.106"></a><span id="l43.106" class="difflineplus">+    QueryInterface: XPCOMUtils.generateQI(ItipProtocolHandlerInterfaces),</span>
<a href="#l43.107"></a><span id="l43.107" class="difflineplus">+    classInfo: XPCOMUtils.generateCI({</span>
<a href="#l43.108"></a><span id="l43.108" class="difflineplus">+        classID: ItipProtocolHandlerClassID,</span>
<a href="#l43.109"></a><span id="l43.109" class="difflineplus">+        contractID: &quot;@mozilla.org/network/protocol;1?name=&quot; + ITIP_HANDLER_PROTOCOL,</span>
<a href="#l43.110"></a><span id="l43.110" class="difflineplus">+        classDescription: &quot;iTIP Protocol Handler&quot;,</span>
<a href="#l43.111"></a><span id="l43.111" class="difflineplus">+        interfaces: ItipProtocolHandlerInterfaces</span>
<a href="#l43.112"></a><span id="l43.112" class="difflineplus">+    }),</span>
<a href="#l43.113"></a><span id="l43.113"> </span>
<a href="#l43.114"></a><span id="l43.114" class="difflineminus">-    QueryInterface: function QI(aIID) {</span>
<a href="#l43.115"></a><span id="l43.115" class="difflineminus">-        return cal.doQueryInterface(this, ItipProtocolHandler.prototype, aIID, null, this);</span>
<a href="#l43.116"></a><span id="l43.116" class="difflineminus">-    },</span>
<a href="#l43.117"></a><span id="l43.117" class="difflineminus">-    </span>
<a href="#l43.118"></a><span id="l43.118">     protocolFlags: CI.nsIProtocolHandler.URI_NORELATIVE | CI.nsIProtocolHandler.URI_DANGEROUS_TO_LOAD,</span>
<a href="#l43.119"></a><span id="l43.119" class="difflineminus">-    allowPort: function () { return false; },</span>
<a href="#l43.120"></a><span id="l43.120" class="difflineplus">+    allowPort: function () false,</span>
<a href="#l43.121"></a><span id="l43.121">     isSecure: false,</span>
<a href="#l43.122"></a><span id="l43.122" class="difflineminus">-    newURI: function (spec, charSet, baseURI)</span>
<a href="#l43.123"></a><span id="l43.123" class="difflineminus">-    {</span>
<a href="#l43.124"></a><span id="l43.124" class="difflineplus">+    newURI: function (spec, charSet, baseURI) {</span>
<a href="#l43.125"></a><span id="l43.125">         let cls = Components.classes[&quot;@mozilla.org/network/standard-url;1&quot;];</span>
<a href="#l43.126"></a><span id="l43.126">         let url = cls.createInstance(CI.nsIStandardURL);</span>
<a href="#l43.127"></a><span id="l43.127">         url.init(CI.nsIStandardURL.URLTYPE_STANDARD, 0, spec, charSet, baseURI);</span>
<a href="#l43.128"></a><span id="l43.128">         dump(&quot;Creating new URI for &quot; + spec + &quot;\n&quot;);</span>
<a href="#l43.129"></a><span id="l43.129">         return url.QueryInterface(CI.nsIURI);</span>
<a href="#l43.130"></a><span id="l43.130">     },</span>
<a href="#l43.131"></a><span id="l43.131">     </span>
<a href="#l43.132"></a><span id="l43.132">     newChannel: function (URI) {</span>
<a href="#l43.133"></a><span id="l43.133">         dump(&quot;Creating new ItipChannel for &quot; + URI + &quot;\n&quot;);</span>
<a href="#l43.134"></a><span id="l43.134">         return new ItipChannel(URI);</span>
<a href="#l43.135"></a><span id="l43.135">     },</span>
<a href="#l43.136"></a><span id="l43.136"> };</span>
<a href="#l43.137"></a><span id="l43.137"> </span>
<a href="#l43.138"></a><span id="l43.138" class="difflineminus">-function ItipContentHandler() { }</span>
<a href="#l43.139"></a><span id="l43.139" class="difflineminus">-</span>
<a href="#l43.140"></a><span id="l43.140" class="difflineplus">+function ItipContentHandler() {</span>
<a href="#l43.141"></a><span id="l43.141" class="difflineplus">+    this.wrappedJSObject = this;</span>
<a href="#l43.142"></a><span id="l43.142" class="difflineplus">+}</span>
<a href="#l43.143"></a><span id="l43.143" class="difflineplus">+const ItipContentHandlerClassID = Components.ID(&quot;{47c31f2b-b4de-11d9-bfe6-001124736B74}&quot;);</span>
<a href="#l43.144"></a><span id="l43.144" class="difflineplus">+const ItipContentHandlerInterfaces = [Components.interfaces.nsIContentHandler];</span>
<a href="#l43.145"></a><span id="l43.145"> ItipContentHandler.prototype = {</span>
<a href="#l43.146"></a><span id="l43.146" class="difflineminus">-    classID: Components.ID(&quot;{47c31f2b-b4de-11d9-bfe6-001124736B74}&quot;),</span>
<a href="#l43.147"></a><span id="l43.147" class="difflineminus">-    contractID: &quot;@mozilla.org/uriloader/content-handler;1?type=&quot; + ITIP_HANDLER_MIMETYPE,</span>
<a href="#l43.148"></a><span id="l43.148" class="difflineminus">-    classDescription: &quot;Lightning text/calendar content handler&quot;,</span>
<a href="#l43.149"></a><span id="l43.149" class="difflineplus">+    classID: ItipContentHandlerClassID,</span>
<a href="#l43.150"></a><span id="l43.150" class="difflineplus">+    QueryInterface: XPCOMUtils.generateQI(ItipContentHandlerInterfaces),</span>
<a href="#l43.151"></a><span id="l43.151" class="difflineplus">+    classInfo: XPCOMUtils.generateCI({</span>
<a href="#l43.152"></a><span id="l43.152" class="difflineplus">+        classID: ItipContentHandlerClassID,</span>
<a href="#l43.153"></a><span id="l43.153" class="difflineplus">+        contractID: &quot;@mozilla.org/uriloader/content-handler;1?type=&quot; + ITIP_HANDLER_MIMETYPE,</span>
<a href="#l43.154"></a><span id="l43.154" class="difflineplus">+        classDescription: &quot;Lightning text/calendar content handler&quot;,</span>
<a href="#l43.155"></a><span id="l43.155" class="difflineplus">+        interfaces: ItipContentHandlerInterfaces</span>
<a href="#l43.156"></a><span id="l43.156" class="difflineplus">+    }),</span>
<a href="#l43.157"></a><span id="l43.157"> </span>
<a href="#l43.158"></a><span id="l43.158" class="difflineminus">-    getInterfaces: function getInterfaces(count) {</span>
<a href="#l43.159"></a><span id="l43.159" class="difflineminus">-        const ifaces = [Components.interfaces.nsIContentHandler,</span>
<a href="#l43.160"></a><span id="l43.160" class="difflineminus">-                        Components.interfaces.nsIClassInfo,</span>
<a href="#l43.161"></a><span id="l43.161" class="difflineminus">-                        Components.interfaces.nsISupports];</span>
<a href="#l43.162"></a><span id="l43.162" class="difflineminus">-        count.value = ifaces.length;</span>
<a href="#l43.163"></a><span id="l43.163" class="difflineminus">-        return ifaces;</span>
<a href="#l43.164"></a><span id="l43.164" class="difflineminus">-    },</span>
<a href="#l43.165"></a><span id="l43.165" class="difflineminus">-    getHelperForLanguage: function getHelperForLanguage(language) {</span>
<a href="#l43.166"></a><span id="l43.166" class="difflineminus">-        return null;</span>
<a href="#l43.167"></a><span id="l43.167" class="difflineminus">-    },</span>
<a href="#l43.168"></a><span id="l43.168" class="difflineminus">-    implementationLanguage: Components.interfaces.nsIProgrammingLanguage.JAVASCRIPT,</span>
<a href="#l43.169"></a><span id="l43.169" class="difflineminus">-    flags: 0,</span>
<a href="#l43.170"></a><span id="l43.170" class="difflineminus">-</span>
<a href="#l43.171"></a><span id="l43.171" class="difflineminus">-    QueryInterface: function (aIID) {</span>
<a href="#l43.172"></a><span id="l43.172" class="difflineminus">-        return cal.doQueryInterface(this, ItipContentHandler.prototype, aIID, null, this);</span>
<a href="#l43.173"></a><span id="l43.173" class="difflineminus">-    },</span>
<a href="#l43.174"></a><span id="l43.174" class="difflineminus">-</span>
<a href="#l43.175"></a><span id="l43.175" class="difflineminus">-    handleContent: function (contentType, windowTarget, request)</span>
<a href="#l43.176"></a><span id="l43.176" class="difflineminus">-    {</span>
<a href="#l43.177"></a><span id="l43.177" class="difflineplus">+    handleContent: function (contentType, windowTarget, request) {</span>
<a href="#l43.178"></a><span id="l43.178">         let channel = request.QueryInterface(CI.nsIChannel);</span>
<a href="#l43.179"></a><span id="l43.179">         let uri = channel.URI.spec;</span>
<a href="#l43.180"></a><span id="l43.180">         if (uri.indexOf(ITIP_HANDLER_PROTOCOL + &quot;:&quot;) != 0) {</span>
<a href="#l43.181"></a><span id="l43.181">             cal.ERROR(&quot;Unexpected iTIP uri: &quot; + uri + &quot;\n&quot;);</span>
<a href="#l43.182"></a><span id="l43.182">             return Components.results.NS_ERROR_FAILURE;</span>
<a href="#l43.183"></a><span id="l43.183">         }</span>
<a href="#l43.184"></a><span id="l43.184">         // moz-cal-handle-itip:///?</span>
<a href="#l43.185"></a><span id="l43.185">         let paramString = uri.substring(ITIP_HANDLER_PROTOCOL.length + 4);</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l44.1"></a><span id="l44.1" class="difflineminus">--- a/calendar/lightning/components/lightningTextCalendarConverter.js</span>
<a href="#l44.2"></a><span id="l44.2" class="difflineplus">+++ b/calendar/lightning/components/lightningTextCalendarConverter.js</span>
<a href="#l44.3"></a><span id="l44.3" class="difflineat">@@ -4,28 +4,30 @@</span>
<a href="#l44.4"></a><span id="l44.4"> </span>
<a href="#l44.5"></a><span id="l44.5"> Components.utils.import(&quot;resource://gre/modules/XPCOMUtils.jsm&quot;);</span>
<a href="#l44.6"></a><span id="l44.6"> Components.utils.import(&quot;resource://gre/modules/Services.jsm&quot;);</span>
<a href="#l44.7"></a><span id="l44.7"> Components.utils.import(&quot;resource://calendar/modules/calUtils.jsm&quot;);</span>
<a href="#l44.8"></a><span id="l44.8"> Components.utils.import(&quot;resource://calendar/modules/calXMLUtils.jsm&quot;);</span>
<a href="#l44.9"></a><span id="l44.9"> Components.utils.import(&quot;resource://calendar/modules/calRecurrenceUtils.jsm&quot;);</span>
<a href="#l44.10"></a><span id="l44.10"> </span>
<a href="#l44.11"></a><span id="l44.11"> function ltnMimeConverter() {</span>
<a href="#l44.12"></a><span id="l44.12" class="difflineplus">+    this.wrappedJSObject = this;</span>
<a href="#l44.13"></a><span id="l44.13"> }</span>
<a href="#l44.14"></a><span id="l44.14"> </span>
<a href="#l44.15"></a><span id="l44.15" class="difflineplus">+const ltnMimeConverterClassID = Components.ID(&quot;{c70acb08-464e-4e55-899d-b2c84c5409fa}&quot;);</span>
<a href="#l44.16"></a><span id="l44.16" class="difflineplus">+const ltnMimeConverterInterfaces = [Components.interfaces.nsISimpleMimeConverter];</span>
<a href="#l44.17"></a><span id="l44.17"> ltnMimeConverter.prototype = {</span>
<a href="#l44.18"></a><span id="l44.18" class="difflineminus">-    classID: Components.ID(&quot;{c70acb08-464e-4e55-899d-b2c84c5409fa}&quot;),</span>
<a href="#l44.19"></a><span id="l44.19" class="difflineminus">-</span>
<a href="#l44.20"></a><span id="l44.20" class="difflineminus">-    QueryInterface: XPCOMUtils.generateQI([Components.interfaces.nsISimpleMimeConverter]),</span>
<a href="#l44.21"></a><span id="l44.21" class="difflineplus">+    classID: ltnMimeConverterClassID,</span>
<a href="#l44.22"></a><span id="l44.22" class="difflineplus">+    QueryInterface: XPCOMUtils.generateQI(ltnMimeConverterInterfaces),</span>
<a href="#l44.23"></a><span id="l44.23"> </span>
<a href="#l44.24"></a><span id="l44.24">     classInfo: XPCOMUtils.generateCI({</span>
<a href="#l44.25"></a><span id="l44.25" class="difflineminus">-        classID: Components.ID(&quot;{c70acb08-464e-4e55-899d-b2c84c5409fa}&quot;),</span>
<a href="#l44.26"></a><span id="l44.26" class="difflineplus">+        classID: ltnMimeConverterClassID,</span>
<a href="#l44.27"></a><span id="l44.27">         contractID: &quot;@mozilla.org/lightning/mime-converter;1&quot;,</span>
<a href="#l44.28"></a><span id="l44.28">         classDescription: &quot;Lightning text/calendar handler&quot;,</span>
<a href="#l44.29"></a><span id="l44.29" class="difflineminus">-        interfaces: [Components.interfaces.nsISimpleMimeConverter]</span>
<a href="#l44.30"></a><span id="l44.30" class="difflineplus">+        interfaces: ltnMimeConverterInterfaces</span>
<a href="#l44.31"></a><span id="l44.31">     }),</span>
<a href="#l44.32"></a><span id="l44.32"> </span>
<a href="#l44.33"></a><span id="l44.33">     /**</span>
<a href="#l44.34"></a><span id="l44.34">      * Append the text to node, converting contained URIs to &lt;a&gt; links.</span>
<a href="#l44.35"></a><span id="l44.35">      *</span>
<a href="#l44.36"></a><span id="l44.36">      * @param text      The text to convert.</span>
<a href="#l44.37"></a><span id="l44.37">      * @param node      The node to append the text to.</span>
<a href="#l44.38"></a><span id="l44.38">      */</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l45.1"></a><span id="l45.1" class="difflineminus">--- a/calendar/providers/caldav/calDavCalendar.js</span>
<a href="#l45.2"></a><span id="l45.2" class="difflineplus">+++ b/calendar/providers/caldav/calDavCalendar.js</span>
<a href="#l45.3"></a><span id="l45.3" class="difflineat">@@ -78,50 +78,38 @@ const calICalDavCalendar = Components.in</span>
<a href="#l45.4"></a><span id="l45.4"> const kDavResourceTypeNone = 0;</span>
<a href="#l45.5"></a><span id="l45.5"> const kDavResourceTypeCollection = 1;</span>
<a href="#l45.6"></a><span id="l45.6"> const kDavResourceTypeCalendar = 2;</span>
<a href="#l45.7"></a><span id="l45.7"> </span>
<a href="#l45.8"></a><span id="l45.8"> // used for etag checking</span>
<a href="#l45.9"></a><span id="l45.9"> const CALDAV_MODIFY_ITEM = &quot;modify&quot;;</span>
<a href="#l45.10"></a><span id="l45.10"> const CALDAV_DELETE_ITEM = &quot;delete&quot;;</span>
<a href="#l45.11"></a><span id="l45.11"> </span>
<a href="#l45.12"></a><span id="l45.12" class="difflineplus">+const calDavCalendarClassID = Components.ID(&quot;{a35fc6ea-3d92-11d9-89f9-00045ace3b8d}&quot;);</span>
<a href="#l45.13"></a><span id="l45.13" class="difflineplus">+const calDavCalendarInterfaces = [</span>
<a href="#l45.14"></a><span id="l45.14" class="difflineplus">+    Components.interfaces.calICalendarProvider,</span>
<a href="#l45.15"></a><span id="l45.15" class="difflineplus">+    Components.interfaces.nsIInterfaceRequestor,</span>
<a href="#l45.16"></a><span id="l45.16" class="difflineplus">+    Components.interfaces.calIFreeBusyProvider,</span>
<a href="#l45.17"></a><span id="l45.17" class="difflineplus">+    Components.interfaces.nsIChannelEventSink,</span>
<a href="#l45.18"></a><span id="l45.18" class="difflineplus">+    Components.interfaces.calIItipTransport,</span>
<a href="#l45.19"></a><span id="l45.19" class="difflineplus">+    Components.interfaces.calISchedulingSupport,</span>
<a href="#l45.20"></a><span id="l45.20" class="difflineplus">+    Components.interfaces.calICalendar,</span>
<a href="#l45.21"></a><span id="l45.21" class="difflineplus">+    Components.interfaces.calIChangeLog,</span>
<a href="#l45.22"></a><span id="l45.22" class="difflineplus">+    calICalDavCalendar,</span>
<a href="#l45.23"></a><span id="l45.23" class="difflineplus">+];</span>
<a href="#l45.24"></a><span id="l45.24"> calDavCalendar.prototype = {</span>
<a href="#l45.25"></a><span id="l45.25">     __proto__: cal.ProviderBase.prototype,</span>
<a href="#l45.26"></a><span id="l45.26" class="difflineminus">-</span>
<a href="#l45.27"></a><span id="l45.27" class="difflineminus">-    classID: Components.ID(&quot;{a35fc6ea-3d92-11d9-89f9-00045ace3b8d}&quot;),</span>
<a href="#l45.28"></a><span id="l45.28" class="difflineminus">-    contractID: &quot;@mozilla.org/calendar/calendar;1?type=caldav&quot;,</span>
<a href="#l45.29"></a><span id="l45.29" class="difflineminus">-    classDescription: &quot;Calendar CalDAV back-end&quot;,</span>
<a href="#l45.30"></a><span id="l45.30" class="difflineminus">-</span>
<a href="#l45.31"></a><span id="l45.31" class="difflineminus">-    getInterfaces: function getInterfaces(count) {</span>
<a href="#l45.32"></a><span id="l45.32" class="difflineminus">-        const ifaces = [Components.interfaces.calICalendarProvider,</span>
<a href="#l45.33"></a><span id="l45.33" class="difflineminus">-                        Components.interfaces.nsIInterfaceRequestor,</span>
<a href="#l45.34"></a><span id="l45.34" class="difflineminus">-                        Components.interfaces.calIFreeBusyProvider,</span>
<a href="#l45.35"></a><span id="l45.35" class="difflineminus">-                        Components.interfaces.nsIChannelEventSink,</span>
<a href="#l45.36"></a><span id="l45.36" class="difflineminus">-                        Components.interfaces.calIItipTransport,</span>
<a href="#l45.37"></a><span id="l45.37" class="difflineminus">-                        Components.interfaces.calISchedulingSupport,</span>
<a href="#l45.38"></a><span id="l45.38" class="difflineminus">-                        Components.interfaces.calICalendar,</span>
<a href="#l45.39"></a><span id="l45.39" class="difflineminus">-                        Components.interfaces.calIChangeLog,</span>
<a href="#l45.40"></a><span id="l45.40" class="difflineminus">-                        calICalDavCalendar,</span>
<a href="#l45.41"></a><span id="l45.41" class="difflineminus">-                        Components.interfaces.nsIClassInfo,</span>
<a href="#l45.42"></a><span id="l45.42" class="difflineminus">-                        Components.interfaces.nsISupports];</span>
<a href="#l45.43"></a><span id="l45.43" class="difflineminus">-        count.value = ifaces.length;</span>
<a href="#l45.44"></a><span id="l45.44" class="difflineminus">-        return ifaces;</span>
<a href="#l45.45"></a><span id="l45.45" class="difflineminus">-    },</span>
<a href="#l45.46"></a><span id="l45.46" class="difflineminus">-    getHelperForLanguage: function getHelperForLanguage(language) {</span>
<a href="#l45.47"></a><span id="l45.47" class="difflineminus">-        return null;</span>
<a href="#l45.48"></a><span id="l45.48" class="difflineminus">-    },</span>
<a href="#l45.49"></a><span id="l45.49" class="difflineminus">-    implementationLanguage: Components.interfaces.nsIProgrammingLanguage.JAVASCRIPT,</span>
<a href="#l45.50"></a><span id="l45.50" class="difflineminus">-    flags: 0,</span>
<a href="#l45.51"></a><span id="l45.51" class="difflineminus">-</span>
<a href="#l45.52"></a><span id="l45.52" class="difflineminus">-    //</span>
<a href="#l45.53"></a><span id="l45.53" class="difflineminus">-    // nsISupports interface</span>
<a href="#l45.54"></a><span id="l45.54" class="difflineminus">-    //</span>
<a href="#l45.55"></a><span id="l45.55" class="difflineminus">-    QueryInterface: function caldav_QueryInterface(aIID) {</span>
<a href="#l45.56"></a><span id="l45.56" class="difflineminus">-        return cal.doQueryInterface(this, calDavCalendar.prototype, aIID, null, this);</span>
<a href="#l45.57"></a><span id="l45.57" class="difflineminus">-    },</span>
<a href="#l45.58"></a><span id="l45.58" class="difflineplus">+    classID: calDavCalendarClassID,</span>
<a href="#l45.59"></a><span id="l45.59" class="difflineplus">+    QueryInterface: XPCOMUtils.generateQI(calDavCalendarInterfaces),</span>
<a href="#l45.60"></a><span id="l45.60" class="difflineplus">+    classInfo: XPCOMUtils.generateCI({</span>
<a href="#l45.61"></a><span id="l45.61" class="difflineplus">+        classID: calDavCalendarClassID,</span>
<a href="#l45.62"></a><span id="l45.62" class="difflineplus">+        contractID: &quot;@mozilla.org/calendar/calendar;1?type=caldav&quot;,</span>
<a href="#l45.63"></a><span id="l45.63" class="difflineplus">+        classDescription: &quot;Calendar CalDAV back-end&quot;,</span>
<a href="#l45.64"></a><span id="l45.64" class="difflineplus">+        interfaces: calDavCalendarInterfaces,</span>
<a href="#l45.65"></a><span id="l45.65" class="difflineplus">+    }),</span>
<a href="#l45.66"></a><span id="l45.66"> </span>
<a href="#l45.67"></a><span id="l45.67">     // An array of components that are supported by the server. The default is</span>
<a href="#l45.68"></a><span id="l45.68">     // to support VEVENT and VTODO, if queries for these components return a 4xx</span>
<a href="#l45.69"></a><span id="l45.69">     // error, then they will be removed from this array.</span>
<a href="#l45.70"></a><span id="l45.70">     mGenerallySupportedItemTypes: null,</span>
<a href="#l45.71"></a><span id="l45.71">     mSupportedItemTypes: null,</span>
<a href="#l45.72"></a><span id="l45.72">     suportedItemTypes: null,</span>
<a href="#l45.73"></a><span id="l45.73">     get supportedItemTypes() {</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l46.1"></a><span id="l46.1" class="difflineminus">--- a/calendar/providers/caldav/calDavRequestHandlers.js</span>
<a href="#l46.2"></a><span id="l46.2" class="difflineplus">+++ b/calendar/providers/caldav/calDavRequestHandlers.js</span>
<a href="#l46.3"></a><span id="l46.3" class="difflineat">@@ -1,14 +1,14 @@</span>
<a href="#l46.4"></a><span id="l46.4"> /* This Source Code Form is subject to the terms of the Mozilla Public</span>
<a href="#l46.5"></a><span id="l46.5">  * License, v. 2.0. If a copy of the MPL was not distributed with this</span>
<a href="#l46.6"></a><span id="l46.6">  * file, You can obtain one at http://mozilla.org/MPL/2.0/. */</span>
<a href="#l46.7"></a><span id="l46.7"> </span>
<a href="#l46.8"></a><span id="l46.8" class="difflineminus">-</span>
<a href="#l46.9"></a><span id="l46.9"> Components.utils.import(&quot;resource://calendar/modules/calUtils.jsm&quot;);</span>
<a href="#l46.10"></a><span id="l46.10" class="difflineplus">+Components.utils.import(&quot;resource://gre/modules/XPCOMUtils.jsm&quot;);</span>
<a href="#l46.11"></a><span id="l46.11"> </span>
<a href="#l46.12"></a><span id="l46.12"> /**</span>
<a href="#l46.13"></a><span id="l46.13">  * This is a handler for the etag request in calDavCalendar.js' getUpdatedItem.</span>
<a href="#l46.14"></a><span id="l46.14">  * It uses the SAX parser to incrementally parse the items and compose the</span>
<a href="#l46.15"></a><span id="l46.15">  * resulting multiget.</span>
<a href="#l46.16"></a><span id="l46.16">  *</span>
<a href="#l46.17"></a><span id="l46.17">  * @param aCalendar             The (unwrapped) calendar this request belongs to</span>
<a href="#l46.18"></a><span id="l46.18">  * @param aBaseUri              The URI requested (i.e inbox or collection)</span>
<a href="#l46.19"></a><span id="l46.19" class="difflineat">@@ -36,25 +36,22 @@ etagsHandler.prototype = {</span>
<a href="#l46.20"></a><span id="l46.20">     calendar: null,</span>
<a href="#l46.21"></a><span id="l46.21">     baseUri: null,</span>
<a href="#l46.22"></a><span id="l46.22">     changeLogListener: null,</span>
<a href="#l46.23"></a><span id="l46.23">     logXML: &quot;&quot;,</span>
<a href="#l46.24"></a><span id="l46.24"> </span>
<a href="#l46.25"></a><span id="l46.25">     itemsReported: null,</span>
<a href="#l46.26"></a><span id="l46.26">     itemsNeedFetching: null,</span>
<a href="#l46.27"></a><span id="l46.27"> </span>
<a href="#l46.28"></a><span id="l46.28" class="difflineminus">-    QueryInterface: function QueryInterface(aIID) {</span>
<a href="#l46.29"></a><span id="l46.29" class="difflineminus">-        return doQueryInterface(this,</span>
<a href="#l46.30"></a><span id="l46.30" class="difflineminus">-                                etagsHandler.prototype,</span>
<a href="#l46.31"></a><span id="l46.31" class="difflineminus">-                                aIID,</span>
<a href="#l46.32"></a><span id="l46.32" class="difflineminus">-                                [Components.interfaces.nsISAXContentHandler,</span>
<a href="#l46.33"></a><span id="l46.33" class="difflineminus">-                                 Components.interfaces.nsISAXErrorHandler,</span>
<a href="#l46.34"></a><span id="l46.34" class="difflineminus">-                                 Components.interfaces.nsIRequestObserver,</span>
<a href="#l46.35"></a><span id="l46.35" class="difflineminus">-                                 Components.interfaces.nsIStreamListener]);</span>
<a href="#l46.36"></a><span id="l46.36" class="difflineminus">-    },</span>
<a href="#l46.37"></a><span id="l46.37" class="difflineplus">+    QueryInterface: XPCOMUtils.generateQI([</span>
<a href="#l46.38"></a><span id="l46.38" class="difflineplus">+        Components.interfaces.nsISAXContentHandler,</span>
<a href="#l46.39"></a><span id="l46.39" class="difflineplus">+        Components.interfaces.nsISAXErrorHandler,</span>
<a href="#l46.40"></a><span id="l46.40" class="difflineplus">+        Components.interfaces.nsIRequestObserver,</span>
<a href="#l46.41"></a><span id="l46.41" class="difflineplus">+        Components.interfaces.nsIStreamListener</span>
<a href="#l46.42"></a><span id="l46.42" class="difflineplus">+    ]),</span>
<a href="#l46.43"></a><span id="l46.43"> </span>
<a href="#l46.44"></a><span id="l46.44">     /**</span>
<a href="#l46.45"></a><span id="l46.45">      * @see nsIStreamListener</span>
<a href="#l46.46"></a><span id="l46.46">      */</span>
<a href="#l46.47"></a><span id="l46.47">     onStartRequest: function eSL_onStartRequest(request, context) {</span>
<a href="#l46.48"></a><span id="l46.48">         let httpchannel = request.QueryInterface(Components.interfaces.nsIHttpChannel);</span>
<a href="#l46.49"></a><span id="l46.49"> </span>
<a href="#l46.50"></a><span id="l46.50">         let responseStatus;</span>
<a href="#l46.51"></a><span id="l46.51" class="difflineat">@@ -312,25 +309,22 @@ webDavSyncHandler.prototype = {</span>
<a href="#l46.52"></a><span id="l46.52">     changeLogListener: null,</span>
<a href="#l46.53"></a><span id="l46.53">     logXML: &quot;&quot;,</span>
<a href="#l46.54"></a><span id="l46.54">     isInPropStat : false,</span>
<a href="#l46.55"></a><span id="l46.55">     changeCount : 0,</span>
<a href="#l46.56"></a><span id="l46.56">     unhandledErrors : 0,</span>
<a href="#l46.57"></a><span id="l46.57">     itemsReported: null,</span>
<a href="#l46.58"></a><span id="l46.58">     itemsNeedFetching: null,</span>
<a href="#l46.59"></a><span id="l46.59"> </span>
<a href="#l46.60"></a><span id="l46.60" class="difflineminus">-    QueryInterface: function QueryInterface(aIID) {</span>
<a href="#l46.61"></a><span id="l46.61" class="difflineminus">-        return doQueryInterface(this,</span>
<a href="#l46.62"></a><span id="l46.62" class="difflineminus">-                                webDavSyncHandler.prototype,</span>
<a href="#l46.63"></a><span id="l46.63" class="difflineminus">-                                aIID,</span>
<a href="#l46.64"></a><span id="l46.64" class="difflineminus">-                                [Components.interfaces.nsISAXContentHandler,</span>
<a href="#l46.65"></a><span id="l46.65" class="difflineminus">-                                 Components.interfaces.nsISAXErrorHandler,</span>
<a href="#l46.66"></a><span id="l46.66" class="difflineminus">-                                 Components.interfaces.nsIRequestObserver,</span>
<a href="#l46.67"></a><span id="l46.67" class="difflineminus">-                                 Components.interfaces.nsIStreamListener]);</span>
<a href="#l46.68"></a><span id="l46.68" class="difflineminus">-    },</span>
<a href="#l46.69"></a><span id="l46.69" class="difflineplus">+    QueryInterface: XPCOMUtils.generateQI([</span>
<a href="#l46.70"></a><span id="l46.70" class="difflineplus">+        Components.interfaces.nsISAXContentHandler,</span>
<a href="#l46.71"></a><span id="l46.71" class="difflineplus">+        Components.interfaces.nsISAXErrorHandler,</span>
<a href="#l46.72"></a><span id="l46.72" class="difflineplus">+        Components.interfaces.nsIRequestObserver,</span>
<a href="#l46.73"></a><span id="l46.73" class="difflineplus">+        Components.interfaces.nsIStreamListener</span>
<a href="#l46.74"></a><span id="l46.74" class="difflineplus">+    ]),</span>
<a href="#l46.75"></a><span id="l46.75"> </span>
<a href="#l46.76"></a><span id="l46.76">     doWebDAVSync: function doWebDAVSync() {</span>
<a href="#l46.77"></a><span id="l46.77">         if (this.calendar.mDisabled) {</span>
<a href="#l46.78"></a><span id="l46.78">             // check if maybe our calendar has become available</span>
<a href="#l46.79"></a><span id="l46.79">             this.calendar.checkDavResourceType(this.changeLogListener);</span>
<a href="#l46.80"></a><span id="l46.80">             return;</span>
<a href="#l46.81"></a><span id="l46.81">         }</span>
<a href="#l46.82"></a><span id="l46.82"> </span>
<a href="#l46.83"></a><span id="l46.83" class="difflineat">@@ -653,25 +647,22 @@ multigetSyncHandler.prototype = {</span>
<a href="#l46.84"></a><span id="l46.84">     baseUri: null,</span>
<a href="#l46.85"></a><span id="l46.85">     newSyncToken: null,</span>
<a href="#l46.86"></a><span id="l46.86">     listener: null,</span>
<a href="#l46.87"></a><span id="l46.87">     changeLogListener: null,</span>
<a href="#l46.88"></a><span id="l46.88">     logXML: null,</span>
<a href="#l46.89"></a><span id="l46.89">     unhandledErrors : 0,</span>
<a href="#l46.90"></a><span id="l46.90">     itemsNeedFetching: null,</span>
<a href="#l46.91"></a><span id="l46.91"> </span>
<a href="#l46.92"></a><span id="l46.92" class="difflineminus">-    QueryInterface: function QueryInterface(aIID) {</span>
<a href="#l46.93"></a><span id="l46.93" class="difflineminus">-        return doQueryInterface(this,</span>
<a href="#l46.94"></a><span id="l46.94" class="difflineminus">-                                multigetSyncHandler.prototype,</span>
<a href="#l46.95"></a><span id="l46.95" class="difflineminus">-                                aIID,</span>
<a href="#l46.96"></a><span id="l46.96" class="difflineminus">-                                [Components.interfaces.nsISAXContentHandler,</span>
<a href="#l46.97"></a><span id="l46.97" class="difflineminus">-                                 Components.interfaces.nsISAXErrorHandler,</span>
<a href="#l46.98"></a><span id="l46.98" class="difflineminus">-                                 Components.interfaces.nsIRequestObserver,</span>
<a href="#l46.99"></a><span id="l46.99" class="difflineminus">-                                 Components.interfaces.nsIStreamListener]);</span>
<a href="#l46.100"></a><span id="l46.100" class="difflineminus">-    },</span>
<a href="#l46.101"></a><span id="l46.101" class="difflineplus">+    QueryInterface: XPCOMUtils.generateQI([</span>
<a href="#l46.102"></a><span id="l46.102" class="difflineplus">+        Components.interfaces.nsISAXContentHandler,</span>
<a href="#l46.103"></a><span id="l46.103" class="difflineplus">+        Components.interfaces.nsISAXErrorHandler,</span>
<a href="#l46.104"></a><span id="l46.104" class="difflineplus">+        Components.interfaces.nsIRequestObserver,</span>
<a href="#l46.105"></a><span id="l46.105" class="difflineplus">+        Components.interfaces.nsIStreamListener</span>
<a href="#l46.106"></a><span id="l46.106" class="difflineplus">+    ]),</span>
<a href="#l46.107"></a><span id="l46.107"> </span>
<a href="#l46.108"></a><span id="l46.108">     doMultiGet: function doMultiGet() {</span>
<a href="#l46.109"></a><span id="l46.109">         if (this.calendar.mDisabled) {</span>
<a href="#l46.110"></a><span id="l46.110">             // check if maybe our calendar has become available</span>
<a href="#l46.111"></a><span id="l46.111">             this.calendar.checkDavResourceType(this.changeLogListener);</span>
<a href="#l46.112"></a><span id="l46.112">             return;</span>
<a href="#l46.113"></a><span id="l46.113">         }</span>
<a href="#l46.114"></a><span id="l46.114"> </span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l47.1"></a><span id="l47.1" class="difflineminus">--- a/calendar/providers/composite/calCompositeCalendar.js</span>
<a href="#l47.2"></a><span id="l47.2" class="difflineplus">+++ b/calendar/providers/composite/calCompositeCalendar.js</span>
<a href="#l47.3"></a><span id="l47.3" class="difflineat">@@ -76,56 +76,42 @@ function calCompositeCalendar () {</span>
<a href="#l47.4"></a><span id="l47.4"> </span>
<a href="#l47.5"></a><span id="l47.5">     this.mCalendars = new Array();</span>
<a href="#l47.6"></a><span id="l47.6">     this.mCompositeObservers = new cal.ObserverBag(Components.interfaces.calICompositeObserver);</span>
<a href="#l47.7"></a><span id="l47.7">     this.mObservers = new cal.ObserverBag(Components.interfaces.calIObserver);</span>
<a href="#l47.8"></a><span id="l47.8">     this.mDefaultCalendar = null;</span>
<a href="#l47.9"></a><span id="l47.9">     this.mStatusObserver = null;</span>
<a href="#l47.10"></a><span id="l47.10"> }</span>
<a href="#l47.11"></a><span id="l47.11"> </span>
<a href="#l47.12"></a><span id="l47.12" class="difflineplus">+const calCompositeCalendarClassID = Components.ID(&quot;{aeff788d-63b0-4996-91fb-40a7654c6224}&quot;);</span>
<a href="#l47.13"></a><span id="l47.13" class="difflineplus">+const calCompositeCalendarInterfaces = [</span>
<a href="#l47.14"></a><span id="l47.14" class="difflineplus">+    Components.interfaces.calICalendarProvider,</span>
<a href="#l47.15"></a><span id="l47.15" class="difflineplus">+    Components.interfaces.calICalendar,</span>
<a href="#l47.16"></a><span id="l47.16" class="difflineplus">+    Components.interfaces.calICompositeCalendar,</span>
<a href="#l47.17"></a><span id="l47.17" class="difflineplus">+];</span>
<a href="#l47.18"></a><span id="l47.18"> calCompositeCalendar.prototype = {</span>
<a href="#l47.19"></a><span id="l47.19" class="difflineminus">-    classID: Components.ID(&quot;{aeff788d-63b0-4996-91fb-40a7654c6224}&quot;),</span>
<a href="#l47.20"></a><span id="l47.20" class="difflineminus">-    contractID: &quot;@mozilla.org/calendar/calendar;1?type=composite&quot;,</span>
<a href="#l47.21"></a><span id="l47.21" class="difflineminus">-    classDescription: &quot;Composite Calendar Provider&quot;,</span>
<a href="#l47.22"></a><span id="l47.22" class="difflineminus">-</span>
<a href="#l47.23"></a><span id="l47.23" class="difflineminus">-    getInterfaces: function getInterfaces(count) {</span>
<a href="#l47.24"></a><span id="l47.24" class="difflineminus">-        const ifaces = [Components.interfaces.calICalendarProvider,</span>
<a href="#l47.25"></a><span id="l47.25" class="difflineminus">-                        Components.interfaces.calICalendar,</span>
<a href="#l47.26"></a><span id="l47.26" class="difflineminus">-                        Components.interfaces.calICompositeCalendar,</span>
<a href="#l47.27"></a><span id="l47.27" class="difflineminus">-                        Components.interfaces.nsIClassInfo,</span>
<a href="#l47.28"></a><span id="l47.28" class="difflineminus">-                        Components.interfaces.nsISupports];</span>
<a href="#l47.29"></a><span id="l47.29" class="difflineminus">-        count.value = ifaces.length;</span>
<a href="#l47.30"></a><span id="l47.30" class="difflineminus">-        return ifaces;</span>
<a href="#l47.31"></a><span id="l47.31" class="difflineminus">-    },</span>
<a href="#l47.32"></a><span id="l47.32" class="difflineminus">-    getHelperForLanguage: function getHelperForLanguage(language) {</span>
<a href="#l47.33"></a><span id="l47.33" class="difflineminus">-        return null;</span>
<a href="#l47.34"></a><span id="l47.34" class="difflineminus">-    },</span>
<a href="#l47.35"></a><span id="l47.35" class="difflineminus">-    implementationLanguage: Components.interfaces.nsIProgrammingLanguage.JAVASCRIPT,</span>
<a href="#l47.36"></a><span id="l47.36" class="difflineminus">-    flags: 0,</span>
<a href="#l47.37"></a><span id="l47.37" class="difflineminus">-</span>
<a href="#l47.38"></a><span id="l47.38" class="difflineminus">-    QueryInterface: function (aIID) {</span>
<a href="#l47.39"></a><span id="l47.39" class="difflineminus">-        return cal.doQueryInterface(this, calCompositeCalendar.prototype, aIID, null, this);</span>
<a href="#l47.40"></a><span id="l47.40" class="difflineminus">-    },</span>
<a href="#l47.41"></a><span id="l47.41" class="difflineplus">+    classID: calCompositeCalendarClassID,</span>
<a href="#l47.42"></a><span id="l47.42" class="difflineplus">+    QueryInterface: XPCOMUtils.generateQI(calCompositeCalendarInterfaces),</span>
<a href="#l47.43"></a><span id="l47.43" class="difflineplus">+    classInfo: XPCOMUtils.generateCI({</span>
<a href="#l47.44"></a><span id="l47.44" class="difflineplus">+        classID: calCompositeCalendarClassID,</span>
<a href="#l47.45"></a><span id="l47.45" class="difflineplus">+        contractID: &quot;@mozilla.org/calendar/calendar;1?type=composite&quot;,</span>
<a href="#l47.46"></a><span id="l47.46" class="difflineplus">+        classDescription: &quot;Composite Calendar Provider&quot;,</span>
<a href="#l47.47"></a><span id="l47.47" class="difflineplus">+        interfaces: calCompositeCalendarInterfaces,</span>
<a href="#l47.48"></a><span id="l47.48" class="difflineplus">+    }),</span>
<a href="#l47.49"></a><span id="l47.49"> </span>
<a href="#l47.50"></a><span id="l47.50">     //</span>
<a href="#l47.51"></a><span id="l47.51">     // private members</span>
<a href="#l47.52"></a><span id="l47.52">     //</span>
<a href="#l47.53"></a><span id="l47.53">     mDefaultCalendar: null,</span>
<a href="#l47.54"></a><span id="l47.54"> </span>
<a href="#l47.55"></a><span id="l47.55" class="difflineminus">-</span>
<a href="#l47.56"></a><span id="l47.56">     //</span>
<a href="#l47.57"></a><span id="l47.57">     // calICalendarProvider interface</span>
<a href="#l47.58"></a><span id="l47.58">     //</span>
<a href="#l47.59"></a><span id="l47.59" class="difflineminus">-    get prefChromeOverlay() {</span>
<a href="#l47.60"></a><span id="l47.60" class="difflineminus">-        return null;</span>
<a href="#l47.61"></a><span id="l47.61" class="difflineminus">-    },</span>
<a href="#l47.62"></a><span id="l47.62" class="difflineminus">-</span>
<a href="#l47.63"></a><span id="l47.63" class="difflineminus">-    get displayName() {</span>
<a href="#l47.64"></a><span id="l47.64" class="difflineminus">-        return cal.calGetString(&quot;calendar&quot;, &quot;compositeName&quot;);</span>
<a href="#l47.65"></a><span id="l47.65" class="difflineminus">-    },</span>
<a href="#l47.66"></a><span id="l47.66" class="difflineplus">+    get prefChromeOverlay() null,</span>
<a href="#l47.67"></a><span id="l47.67" class="difflineplus">+    get displayName() cal.calGetString(&quot;calendar&quot;, &quot;compositeName&quot;),</span>
<a href="#l47.68"></a><span id="l47.68"> </span>
<a href="#l47.69"></a><span id="l47.69">     createCalendar: function comp_createCal() {</span>
<a href="#l47.70"></a><span id="l47.70">         throw NS_ERROR_NOT_IMPLEMENTED;</span>
<a href="#l47.71"></a><span id="l47.71">     },</span>
<a href="#l47.72"></a><span id="l47.72"> </span>
<a href="#l47.73"></a><span id="l47.73">     deleteCalendar: function comp_deleteCal(calendar, listener) {</span>
<a href="#l47.74"></a><span id="l47.74">         // You shouldn't be able to delete from the composite calendar.</span>
<a href="#l47.75"></a><span id="l47.75">         throw NS_ERROR_NOT_IMPLEMENTED;</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l48.1"></a><span id="l48.1" class="difflineminus">--- a/calendar/providers/gdata/components/calGoogleCalendar.js</span>
<a href="#l48.2"></a><span id="l48.2" class="difflineplus">+++ b/calendar/providers/gdata/components/calGoogleCalendar.js</span>
<a href="#l48.3"></a><span id="l48.3" class="difflineat">@@ -1,60 +1,47 @@</span>
<a href="#l48.4"></a><span id="l48.4"> /* This Source Code Form is subject to the terms of the Mozilla Public</span>
<a href="#l48.5"></a><span id="l48.5">  * License, v. 2.0. If a copy of the MPL was not distributed with this</span>
<a href="#l48.6"></a><span id="l48.6">  * file, You can obtain one at http://mozilla.org/MPL/2.0/. */</span>
<a href="#l48.7"></a><span id="l48.7"> </span>
<a href="#l48.8"></a><span id="l48.8"> Components.utils.import(&quot;resource://calendar/modules/calProviderUtils.jsm&quot;);</span>
<a href="#l48.9"></a><span id="l48.9"> Components.utils.import(&quot;resource://calendar/modules/calXMLUtils.jsm&quot;);</span>
<a href="#l48.10"></a><span id="l48.10"> Components.utils.import(&quot;resource://calendar/modules/calUtils.jsm&quot;);</span>
<a href="#l48.11"></a><span id="l48.11" class="difflineplus">+Components.utils.import(&quot;resource://gre/modules/XPCOMUtils.jsm&quot;);</span>
<a href="#l48.12"></a><span id="l48.12"> </span>
<a href="#l48.13"></a><span id="l48.13"> const cICL = Components.interfaces.calIChangeLog;</span>
<a href="#l48.14"></a><span id="l48.14"> </span>
<a href="#l48.15"></a><span id="l48.15"> /**</span>
<a href="#l48.16"></a><span id="l48.16">  * calGoogleCalendar</span>
<a href="#l48.17"></a><span id="l48.17">  * This Implements a calICalendar Object adapted to the Google Calendar</span>
<a href="#l48.18"></a><span id="l48.18">  * Provider.</span>
<a href="#l48.19"></a><span id="l48.19">  *</span>
<a href="#l48.20"></a><span id="l48.20">  * @class</span>
<a href="#l48.21"></a><span id="l48.21">  * @constructor</span>
<a href="#l48.22"></a><span id="l48.22">  */</span>
<a href="#l48.23"></a><span id="l48.23"> function calGoogleCalendar() {</span>
<a href="#l48.24"></a><span id="l48.24">     this.initProviderBase();</span>
<a href="#l48.25"></a><span id="l48.25"> }</span>
<a href="#l48.26"></a><span id="l48.26" class="difflineminus">-</span>
<a href="#l48.27"></a><span id="l48.27" class="difflineplus">+const calGoogleCalendarClassID = Components.ID(&quot;{d1a6e988-4b4d-45a5-ba46-43e501ea96e3}&quot;);</span>
<a href="#l48.28"></a><span id="l48.28" class="difflineplus">+const calGoogleCalendarInterfaces = [</span>
<a href="#l48.29"></a><span id="l48.29" class="difflineplus">+    Components.interfaces.calICalendar,</span>
<a href="#l48.30"></a><span id="l48.30" class="difflineplus">+    Components.interfaces.calIGoogleCalendar,</span>
<a href="#l48.31"></a><span id="l48.31" class="difflineplus">+    Components.interfaces.calISchedulingSupport,</span>
<a href="#l48.32"></a><span id="l48.32" class="difflineplus">+    Components.interfaces.calIChangeLog</span>
<a href="#l48.33"></a><span id="l48.33" class="difflineplus">+];</span>
<a href="#l48.34"></a><span id="l48.34"> calGoogleCalendar.prototype = {</span>
<a href="#l48.35"></a><span id="l48.35">     __proto__: cal.ProviderBase.prototype,</span>
<a href="#l48.36"></a><span id="l48.36" class="difflineminus">-</span>
<a href="#l48.37"></a><span id="l48.37" class="difflineminus">-    classDescription: &quot;Google Calendar Provider&quot;,</span>
<a href="#l48.38"></a><span id="l48.38" class="difflineminus">-    contractID: &quot;@mozilla.org/calendar/calendar;1?type=gdata&quot;,</span>
<a href="#l48.39"></a><span id="l48.39" class="difflineminus">-    classID:  Components.ID(&quot;{d1a6e988-4b4d-45a5-ba46-43e501ea96e3}&quot;),</span>
<a href="#l48.40"></a><span id="l48.40" class="difflineminus">-</span>
<a href="#l48.41"></a><span id="l48.41" class="difflineminus">-    getInterfaces: function cI_cGC_getInterfaces (count) {</span>
<a href="#l48.42"></a><span id="l48.42" class="difflineminus">-        let ifaces = [</span>
<a href="#l48.43"></a><span id="l48.43" class="difflineminus">-            Components.interfaces.nsISupports,</span>
<a href="#l48.44"></a><span id="l48.44" class="difflineminus">-            Components.interfaces.calICalendar,</span>
<a href="#l48.45"></a><span id="l48.45" class="difflineminus">-            Components.interfaces.calIGoogleCalendar,</span>
<a href="#l48.46"></a><span id="l48.46" class="difflineminus">-            Components.interfaces.calISchedulingSupport,</span>
<a href="#l48.47"></a><span id="l48.47" class="difflineminus">-            Components.interfaces.calIChangeLog,</span>
<a href="#l48.48"></a><span id="l48.48" class="difflineminus">-            Components.interfaces.nsIClassInfo</span>
<a href="#l48.49"></a><span id="l48.49" class="difflineminus">-        ];</span>
<a href="#l48.50"></a><span id="l48.50" class="difflineminus">-        count.value = ifaces.length;</span>
<a href="#l48.51"></a><span id="l48.51" class="difflineminus">-        return ifaces;</span>
<a href="#l48.52"></a><span id="l48.52" class="difflineminus">-    },</span>
<a href="#l48.53"></a><span id="l48.53" class="difflineminus">-</span>
<a href="#l48.54"></a><span id="l48.54" class="difflineminus">-    getHelperForLanguage: function cI_cGC_getHelperForLanguage(aLanguage) {</span>
<a href="#l48.55"></a><span id="l48.55" class="difflineminus">-        return null;</span>
<a href="#l48.56"></a><span id="l48.56" class="difflineminus">-    },</span>
<a href="#l48.57"></a><span id="l48.57" class="difflineminus">-</span>
<a href="#l48.58"></a><span id="l48.58" class="difflineminus">-    implementationLanguage: Components.interfaces.nsIProgrammingLanguage.JAVASCRIPT,</span>
<a href="#l48.59"></a><span id="l48.59" class="difflineminus">-    flags: 0,</span>
<a href="#l48.60"></a><span id="l48.60" class="difflineminus">-</span>
<a href="#l48.61"></a><span id="l48.61" class="difflineminus">-    QueryInterface: function cGS_QueryInterface(aIID) {</span>
<a href="#l48.62"></a><span id="l48.62" class="difflineminus">-        return cal.doQueryInterface(this, calGoogleCalendar.prototype, aIID, null, this);</span>
<a href="#l48.63"></a><span id="l48.63" class="difflineminus">-    },</span>
<a href="#l48.64"></a><span id="l48.64" class="difflineplus">+    classID: calGoogleCalendarClassID,</span>
<a href="#l48.65"></a><span id="l48.65" class="difflineplus">+    QueryInterface: XPCOMUtils.generateQI(calGoogleCalendarInterfaces),</span>
<a href="#l48.66"></a><span id="l48.66" class="difflineplus">+    classInfo: XPCOMUtils.generateCI({</span>
<a href="#l48.67"></a><span id="l48.67" class="difflineplus">+        classID: calGoogleCalendarClassID,</span>
<a href="#l48.68"></a><span id="l48.68" class="difflineplus">+        contractID: &quot;@mozilla.org/calendar/calendar;1?type=gdata&quot;,</span>
<a href="#l48.69"></a><span id="l48.69" class="difflineplus">+        classDescription: &quot;Google Calendar Provider&quot;,</span>
<a href="#l48.70"></a><span id="l48.70" class="difflineplus">+        interfaces: calGoogleCalendarInterfaces</span>
<a href="#l48.71"></a><span id="l48.71" class="difflineplus">+    }),</span>
<a href="#l48.72"></a><span id="l48.72"> </span>
<a href="#l48.73"></a><span id="l48.73">     /* Member Variables */</span>
<a href="#l48.74"></a><span id="l48.74">     mSession: null,</span>
<a href="#l48.75"></a><span id="l48.75">     mFullUri: null,</span>
<a href="#l48.76"></a><span id="l48.76">     mCalendarName: null,</span>
<a href="#l48.77"></a><span id="l48.77"> </span>
<a href="#l48.78"></a><span id="l48.78">     /*</span>
<a href="#l48.79"></a><span id="l48.79">      * Google Calendar Provider attributes</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l49.1"></a><span id="l49.1" class="difflineminus">--- a/calendar/providers/gdata/components/calGoogleRequest.js</span>
<a href="#l49.2"></a><span id="l49.2" class="difflineplus">+++ b/calendar/providers/gdata/components/calGoogleRequest.js</span>
<a href="#l49.3"></a><span id="l49.3" class="difflineat">@@ -1,28 +1,36 @@</span>
<a href="#l49.4"></a><span id="l49.4"> /* This Source Code Form is subject to the terms of the Mozilla Public</span>
<a href="#l49.5"></a><span id="l49.5">  * License, v. 2.0. If a copy of the MPL was not distributed with this</span>
<a href="#l49.6"></a><span id="l49.6">  * file, You can obtain one at http://mozilla.org/MPL/2.0/. */</span>
<a href="#l49.7"></a><span id="l49.7"> </span>
<a href="#l49.8"></a><span id="l49.8"> Components.utils.import(&quot;resource://calendar/modules/calUtils.jsm&quot;);</span>
<a href="#l49.9"></a><span id="l49.9"> Components.utils.import(&quot;resource://gre/modules/Services.jsm&quot;);</span>
<a href="#l49.10"></a><span id="l49.10" class="difflineplus">+Components.utils.import(&quot;resource://gre/modules/XPCOMUtils.jsm&quot;);</span>
<a href="#l49.11"></a><span id="l49.11"> </span>
<a href="#l49.12"></a><span id="l49.12"> /**</span>
<a href="#l49.13"></a><span id="l49.13">  * calGoogleRequest</span>
<a href="#l49.14"></a><span id="l49.14">  * This class represents a HTTP request sent to Google</span>
<a href="#l49.15"></a><span id="l49.15">  *</span>
<a href="#l49.16"></a><span id="l49.16">  * @constructor</span>
<a href="#l49.17"></a><span id="l49.17">  * @class</span>
<a href="#l49.18"></a><span id="l49.18">  */</span>
<a href="#l49.19"></a><span id="l49.19"> function calGoogleRequest(aSession) {</span>
<a href="#l49.20"></a><span id="l49.20">     this.mQueryParameters = new Array();</span>
<a href="#l49.21"></a><span id="l49.21">     this.mSession = aSession;</span>
<a href="#l49.22"></a><span id="l49.22">     this.wrappedJSObject = this;</span>
<a href="#l49.23"></a><span id="l49.23"> }</span>
<a href="#l49.24"></a><span id="l49.24" class="difflineminus">-</span>
<a href="#l49.25"></a><span id="l49.25" class="difflineplus">+const calGoogleRequestClassID = Components.ID(&quot;{53a3438a-21bc-4a0f-b813-77a8b4f19282}&quot;);</span>
<a href="#l49.26"></a><span id="l49.26" class="difflineplus">+const calGoogleRequestInterfaces = [</span>
<a href="#l49.27"></a><span id="l49.27" class="difflineplus">+    Components.interfaces.calIGoogleRequest,</span>
<a href="#l49.28"></a><span id="l49.28" class="difflineplus">+    Components.interfaces.calIOperation,</span>
<a href="#l49.29"></a><span id="l49.29" class="difflineplus">+    Components.interfaces.nsIStreamLoaderObserver,</span>
<a href="#l49.30"></a><span id="l49.30" class="difflineplus">+    Components.interfaces.nsIInterfaceRequestor,</span>
<a href="#l49.31"></a><span id="l49.31" class="difflineplus">+    Components.interfaces.nsIChannelEventSink</span>
<a href="#l49.32"></a><span id="l49.32" class="difflineplus">+];</span>
<a href="#l49.33"></a><span id="l49.33"> calGoogleRequest.prototype = {</span>
<a href="#l49.34"></a><span id="l49.34"> </span>
<a href="#l49.35"></a><span id="l49.35">     /* Members */</span>
<a href="#l49.36"></a><span id="l49.36">     mUploadContent: null,</span>
<a href="#l49.37"></a><span id="l49.37">     mUploadData: null,</span>
<a href="#l49.38"></a><span id="l49.38">     mSession: null,</span>
<a href="#l49.39"></a><span id="l49.39">     mExtraData: null,</span>
<a href="#l49.40"></a><span id="l49.40">     mQueryParameters: null,</span>
<a href="#l49.41"></a><span id="l49.41" class="difflineat">@@ -50,46 +58,24 @@ calGoogleRequest.prototype = {</span>
<a href="#l49.42"></a><span id="l49.42">     itemRangeEnd: null,</span>
<a href="#l49.43"></a><span id="l49.43">     itemFilter: null,</span>
<a href="#l49.44"></a><span id="l49.44">     itemId: null,</span>
<a href="#l49.45"></a><span id="l49.45">     calendar: null,</span>
<a href="#l49.46"></a><span id="l49.46">     newItem: null,</span>
<a href="#l49.47"></a><span id="l49.47">     oldItem: null,</span>
<a href="#l49.48"></a><span id="l49.48">     destinationCal: null,</span>
<a href="#l49.49"></a><span id="l49.49"> </span>
<a href="#l49.50"></a><span id="l49.50" class="difflineminus">-    /* nsIClassInfo */</span>
<a href="#l49.51"></a><span id="l49.51" class="difflineminus">-    getInterfaces: function cI_cGR_getInterfaces (aCount) {</span>
<a href="#l49.52"></a><span id="l49.52" class="difflineminus">-        let ifaces = [</span>
<a href="#l49.53"></a><span id="l49.53" class="difflineminus">-            Components.interfaces.nsISupports,</span>
<a href="#l49.54"></a><span id="l49.54" class="difflineminus">-            Components.interfaces.calIGoogleRequest,</span>
<a href="#l49.55"></a><span id="l49.55" class="difflineminus">-            Components.interfaces.calIOperation,</span>
<a href="#l49.56"></a><span id="l49.56" class="difflineminus">-            Components.interfaces.nsIStreamLoaderObserver,</span>
<a href="#l49.57"></a><span id="l49.57" class="difflineminus">-            Components.interfaces.nsIInterfaceRequestor,</span>
<a href="#l49.58"></a><span id="l49.58" class="difflineminus">-            Components.interfaces.nsIChannelEventSink,</span>
<a href="#l49.59"></a><span id="l49.59" class="difflineminus">-            Components.interfaces.nsIClassInfo</span>
<a href="#l49.60"></a><span id="l49.60" class="difflineminus">-        ];</span>
<a href="#l49.61"></a><span id="l49.61" class="difflineminus">-        aCount.value = ifaces.length;</span>
<a href="#l49.62"></a><span id="l49.62" class="difflineminus">-        return ifaces;</span>
<a href="#l49.63"></a><span id="l49.63" class="difflineminus">-    },</span>
<a href="#l49.64"></a><span id="l49.64" class="difflineminus">-</span>
<a href="#l49.65"></a><span id="l49.65" class="difflineminus">-    getHelperForLanguage: function cI_cGR_getHelperForLanguage(aLanguage) {</span>
<a href="#l49.66"></a><span id="l49.66" class="difflineminus">-        return null;</span>
<a href="#l49.67"></a><span id="l49.67" class="difflineminus">-    },</span>
<a href="#l49.68"></a><span id="l49.68" class="difflineminus">-</span>
<a href="#l49.69"></a><span id="l49.69" class="difflineminus">-    classDescription: &quot;Google Calendar Request&quot;,</span>
<a href="#l49.70"></a><span id="l49.70" class="difflineminus">-    contractID: &quot;@mozilla.org/calendar/providers/gdata/request;1&quot;,</span>
<a href="#l49.71"></a><span id="l49.71" class="difflineminus">-    classID:  Components.ID(&quot;{53a3438a-21bc-4a0f-b813-77a8b4f19282}&quot;),</span>
<a href="#l49.72"></a><span id="l49.72" class="difflineminus">-    implementationLanguage: Components.interfaces.nsIProgrammingLanguage.JAVASCRIPT,</span>
<a href="#l49.73"></a><span id="l49.73" class="difflineminus">-    constructor: &quot;calGoogleRequest&quot;,</span>
<a href="#l49.74"></a><span id="l49.74" class="difflineminus">-    flags: 0,</span>
<a href="#l49.75"></a><span id="l49.75" class="difflineminus">-</span>
<a href="#l49.76"></a><span id="l49.76" class="difflineminus">-    /* nsISupports */</span>
<a href="#l49.77"></a><span id="l49.77" class="difflineminus">-    QueryInterface: function cGR_QueryInterface(aIID) {</span>
<a href="#l49.78"></a><span id="l49.78" class="difflineminus">-        return cal.doQueryInterface(this, calGoogleRequest.prototype, aIID, null, this);</span>
<a href="#l49.79"></a><span id="l49.79" class="difflineminus">-    },</span>
<a href="#l49.80"></a><span id="l49.80" class="difflineplus">+    classID: calGoogleRequestClassID,</span>
<a href="#l49.81"></a><span id="l49.81" class="difflineplus">+    QueryInterface: XPCOMUtils.generateQI(calGoogleRequestInterfaces),</span>
<a href="#l49.82"></a><span id="l49.82" class="difflineplus">+    classInfo: XPCOMUtils.generateCI({</span>
<a href="#l49.83"></a><span id="l49.83" class="difflineplus">+        classID: calGoogleRequestClassID,</span>
<a href="#l49.84"></a><span id="l49.84" class="difflineplus">+        contractID: &quot;@mozilla.org/calendar/providers/gdata/request;1&quot;,</span>
<a href="#l49.85"></a><span id="l49.85" class="difflineplus">+        classDescription: &quot;Google Calendar Request&quot;,</span>
<a href="#l49.86"></a><span id="l49.86" class="difflineplus">+        interfaces: calGoogleRequestInterfaces</span>
<a href="#l49.87"></a><span id="l49.87" class="difflineplus">+    }),</span>
<a href="#l49.88"></a><span id="l49.88"> </span>
<a href="#l49.89"></a><span id="l49.89">     /**</span>
<a href="#l49.90"></a><span id="l49.90">      * Implement calIOperation</span>
<a href="#l49.91"></a><span id="l49.91">      */</span>
<a href="#l49.92"></a><span id="l49.92">     get isPending() {</span>
<a href="#l49.93"></a><span id="l49.93">         return (this.mLoader &amp;&amp; this.mLoader.request != null);</span>
<a href="#l49.94"></a><span id="l49.94">     },</span>
<a href="#l49.95"></a><span id="l49.95"> </span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l50.1"></a><span id="l50.1" class="difflineminus">--- a/calendar/providers/gdata/components/calGoogleSession.js</span>
<a href="#l50.2"></a><span id="l50.2" class="difflineplus">+++ b/calendar/providers/gdata/components/calGoogleSession.js</span>
<a href="#l50.3"></a><span id="l50.3" class="difflineat">@@ -1,52 +1,40 @@</span>
<a href="#l50.4"></a><span id="l50.4"> /* This Source Code Form is subject to the terms of the Mozilla Public</span>
<a href="#l50.5"></a><span id="l50.5">  * License, v. 2.0. If a copy of the MPL was not distributed with this</span>
<a href="#l50.6"></a><span id="l50.6">  * file, You can obtain one at http://mozilla.org/MPL/2.0/. */</span>
<a href="#l50.7"></a><span id="l50.7"> </span>
<a href="#l50.8"></a><span id="l50.8"> Components.utils.import(&quot;resource://calendar/modules/calUtils.jsm&quot;);</span>
<a href="#l50.9"></a><span id="l50.9"> Components.utils.import(&quot;resource://calendar/modules/calXMLUtils.jsm&quot;);</span>
<a href="#l50.10"></a><span id="l50.10"> Components.utils.import(&quot;resource://calendar/modules/calProviderUtils.jsm&quot;);</span>
<a href="#l50.11"></a><span id="l50.11"> Components.utils.import(&quot;resource://gre/modules/Services.jsm&quot;);</span>
<a href="#l50.12"></a><span id="l50.12" class="difflineplus">+Components.utils.import(&quot;resource://gre/modules/XPCOMUtils.jsm&quot;);</span>
<a href="#l50.13"></a><span id="l50.13"> </span>
<a href="#l50.14"></a><span id="l50.14"> // This constant is an arbitrary large number. It is used to tell google to get</span>
<a href="#l50.15"></a><span id="l50.15"> // many events, the exact number is not important.</span>
<a href="#l50.16"></a><span id="l50.16"> const kMANY_EVENTS = 0x7FFFFFFF;</span>
<a href="#l50.17"></a><span id="l50.17"> </span>
<a href="#l50.18"></a><span id="l50.18"> function calGoogleSessionManager() {</span>
<a href="#l50.19"></a><span id="l50.19">     this.wrappedJSObject = this;</span>
<a href="#l50.20"></a><span id="l50.20"> </span>
<a href="#l50.21"></a><span id="l50.21"> }</span>
<a href="#l50.22"></a><span id="l50.22" class="difflineminus">-</span>
<a href="#l50.23"></a><span id="l50.23" class="difflineplus">+const calGoogleSessionManagerClassID = Components.ID(&quot;{6a7ba1f0-f271-49b0-8e93-5ca33651b4af}&quot;);</span>
<a href="#l50.24"></a><span id="l50.24" class="difflineplus">+const calGoogleSessionManagerInterfaces = [Components.interfaces.calIGoogleSessionManager];</span>
<a href="#l50.25"></a><span id="l50.25"> calGoogleSessionManager.prototype = {</span>
<a href="#l50.26"></a><span id="l50.26">     mSessionMap: {},</span>
<a href="#l50.27"></a><span id="l50.27"> </span>
<a href="#l50.28"></a><span id="l50.28" class="difflineminus">-    getInterfaces: function cI_cGSM_getInterfaces (aCount) {</span>
<a href="#l50.29"></a><span id="l50.29" class="difflineminus">-        const ifaces = [</span>
<a href="#l50.30"></a><span id="l50.30" class="difflineminus">-            Components.interfaces.nsISupports,</span>
<a href="#l50.31"></a><span id="l50.31" class="difflineminus">-            Components.interfaces.calIGoogleSessionManager,</span>
<a href="#l50.32"></a><span id="l50.32" class="difflineminus">-            Components.interfaces.nsIClassInfo</span>
<a href="#l50.33"></a><span id="l50.33" class="difflineminus">-        ];</span>
<a href="#l50.34"></a><span id="l50.34" class="difflineminus">-        aCount.value = ifaces.length;</span>
<a href="#l50.35"></a><span id="l50.35" class="difflineminus">-        return ifaces;</span>
<a href="#l50.36"></a><span id="l50.36" class="difflineminus">-    },</span>
<a href="#l50.37"></a><span id="l50.37" class="difflineminus">-</span>
<a href="#l50.38"></a><span id="l50.38" class="difflineminus">-    getHelperForLanguage: function cI_cGSM_getHelperForLanguage(aLanguage) {</span>
<a href="#l50.39"></a><span id="l50.39" class="difflineminus">-        return null;</span>
<a href="#l50.40"></a><span id="l50.40" class="difflineminus">-    },</span>
<a href="#l50.41"></a><span id="l50.41" class="difflineminus">-</span>
<a href="#l50.42"></a><span id="l50.42" class="difflineminus">-    classDescription: &quot;Google Calendar Session Manager&quot;,</span>
<a href="#l50.43"></a><span id="l50.43" class="difflineminus">-    contractID: &quot;@mozilla.org/calendar/providers/gdata/session-manager;1&quot;,</span>
<a href="#l50.44"></a><span id="l50.44" class="difflineminus">-    classID:  Components.ID(&quot;{6a7ba1f0-f271-49b0-8e93-5ca33651b4af}&quot;),</span>
<a href="#l50.45"></a><span id="l50.45" class="difflineminus">-    implementationLanguage: Components.interfaces.nsIProgrammingLanguage.JAVASCRIPT,</span>
<a href="#l50.46"></a><span id="l50.46" class="difflineminus">-    flags: Components.interfaces.nsIClassInfo.SINGLETON,</span>
<a href="#l50.47"></a><span id="l50.47" class="difflineminus">-</span>
<a href="#l50.48"></a><span id="l50.48" class="difflineminus">-    QueryInterface: function cGSM_QueryInterface(aIID) {</span>
<a href="#l50.49"></a><span id="l50.49" class="difflineminus">-        return cal.doQueryInterface(this, calGoogleSessionManager.prototype, aIID, null, this);</span>
<a href="#l50.50"></a><span id="l50.50" class="difflineminus">-    },</span>
<a href="#l50.51"></a><span id="l50.51" class="difflineplus">+    classID: calGoogleSessionManagerClassID,</span>
<a href="#l50.52"></a><span id="l50.52" class="difflineplus">+    QueryInterface: XPCOMUtils.generateQI(calGoogleSessionManagerInterfaces),</span>
<a href="#l50.53"></a><span id="l50.53" class="difflineplus">+    classInfo: XPCOMUtils.generateCI({</span>
<a href="#l50.54"></a><span id="l50.54" class="difflineplus">+        classID: calGoogleSessionManagerClassID,</span>
<a href="#l50.55"></a><span id="l50.55" class="difflineplus">+        contractID: &quot;@mozilla.org/calendar/providers/gdata/session-manager;1&quot;,</span>
<a href="#l50.56"></a><span id="l50.56" class="difflineplus">+        classDescription: &quot;Google Calendar Session Manager&quot;,</span>
<a href="#l50.57"></a><span id="l50.57" class="difflineplus">+        interfaces: calGoogleSessionManagerInterfaces,</span>
<a href="#l50.58"></a><span id="l50.58" class="difflineplus">+        flags: Components.interfaces.nsIClassInfo.SINGLETON</span>
<a href="#l50.59"></a><span id="l50.59" class="difflineplus">+    }),</span>
<a href="#l50.60"></a><span id="l50.60"> </span>
<a href="#l50.61"></a><span id="l50.61">     /**</span>
<a href="#l50.62"></a><span id="l50.62">      * getSessionByUsername</span>
<a href="#l50.63"></a><span id="l50.63">      * Get a Session object for the specified username. If aCreate is false,</span>
<a href="#l50.64"></a><span id="l50.64">      * null will be returned if the session doesn't exist. Otherwise, the</span>
<a href="#l50.65"></a><span id="l50.65">      * session will be created.</span>
<a href="#l50.66"></a><span id="l50.66">      *</span>
<a href="#l50.67"></a><span id="l50.67">      * @param aUsername The username to get the session for</span>
<a href="#l50.68"></a><span id="l50.68" class="difflineat">@@ -85,40 +73,27 @@ calGoogleSessionManager.prototype = {</span>
<a href="#l50.69"></a><span id="l50.69"> function calGoogleSession(aUsername) {</span>
<a href="#l50.70"></a><span id="l50.70">     this.mItemQueue = new Array();</span>
<a href="#l50.71"></a><span id="l50.71">     this.mGoogleUser = aUsername;</span>
<a href="#l50.72"></a><span id="l50.72">     this.wrappedJSObject = this;</span>
<a href="#l50.73"></a><span id="l50.73"> </span>
<a href="#l50.74"></a><span id="l50.74">     // Register a freebusy provider for this session</span>
<a href="#l50.75"></a><span id="l50.75">     getFreeBusyService().addProvider(this);</span>
<a href="#l50.76"></a><span id="l50.76"> }</span>
<a href="#l50.77"></a><span id="l50.77" class="difflineminus">-</span>
<a href="#l50.78"></a><span id="l50.78" class="difflineplus">+const calGoogleSessionClassID = Components.ID(&quot;{652f6233-e03f-438a-bd3b-39877f68c0f4}&quot;);</span>
<a href="#l50.79"></a><span id="l50.79" class="difflineplus">+const calGoogleSessionInterfaces = [Components.interfaces.calIGoogleSession];</span>
<a href="#l50.80"></a><span id="l50.80"> calGoogleSession.prototype = {</span>
<a href="#l50.81"></a><span id="l50.81" class="difflineminus">-    classDescription: &quot;Google Calendar Session&quot;,</span>
<a href="#l50.82"></a><span id="l50.82" class="difflineminus">-    contractID: &quot;@mozilla.org/calendar/providers/gdata/session;1&quot;,</span>
<a href="#l50.83"></a><span id="l50.83" class="difflineminus">-    classID:  Components.ID(&quot;{652f6233-e03f-438a-bd3b-39877f68c0f4}&quot;),</span>
<a href="#l50.84"></a><span id="l50.84" class="difflineminus">-</span>
<a href="#l50.85"></a><span id="l50.85" class="difflineminus">-    getInterfaces: function cI_cGS_getInterfaces (aCount) {</span>
<a href="#l50.86"></a><span id="l50.86" class="difflineminus">-        let ifaces = [</span>
<a href="#l50.87"></a><span id="l50.87" class="difflineminus">-            Components.interfaces.nsISupports,</span>
<a href="#l50.88"></a><span id="l50.88" class="difflineminus">-            Components.interfaces.calIGoogleSession,</span>
<a href="#l50.89"></a><span id="l50.89" class="difflineminus">-            Components.interfaces.nsIClassInfo</span>
<a href="#l50.90"></a><span id="l50.90" class="difflineminus">-        ];</span>
<a href="#l50.91"></a><span id="l50.91" class="difflineminus">-        aCount.value = ifaces.length;</span>
<a href="#l50.92"></a><span id="l50.92" class="difflineminus">-        return ifaces;</span>
<a href="#l50.93"></a><span id="l50.93" class="difflineminus">-    },</span>
<a href="#l50.94"></a><span id="l50.94" class="difflineminus">-    getHelperForLanguage: function cI_cGS_getHelperForLanguage(aLanguage) {</span>
<a href="#l50.95"></a><span id="l50.95" class="difflineminus">-        return null;</span>
<a href="#l50.96"></a><span id="l50.96" class="difflineminus">-    },</span>
<a href="#l50.97"></a><span id="l50.97" class="difflineminus">-    implementationLanguage: Components.interfaces.nsIProgrammingLanguage.JAVASCRIPT,</span>
<a href="#l50.98"></a><span id="l50.98" class="difflineminus">-    flags: 0,</span>
<a href="#l50.99"></a><span id="l50.99" class="difflineminus">-</span>
<a href="#l50.100"></a><span id="l50.100" class="difflineminus">-    QueryInterface: function cGS_QueryInterface(aIID) {</span>
<a href="#l50.101"></a><span id="l50.101" class="difflineminus">-        return cal.doQueryInterface(this, calGoogleSession.prototype, aIID, null, this);</span>
<a href="#l50.102"></a><span id="l50.102" class="difflineminus">-    },</span>
<a href="#l50.103"></a><span id="l50.103" class="difflineplus">+    classID: calGoogleSessionClassID,</span>
<a href="#l50.104"></a><span id="l50.104" class="difflineplus">+    QueryInterface: XPCOMUtils.generateQI(calGoogleSessionInterfaces),</span>
<a href="#l50.105"></a><span id="l50.105" class="difflineplus">+    classInfo: XPCOMUtils.generateCI({</span>
<a href="#l50.106"></a><span id="l50.106" class="difflineplus">+        classID: calGoogleSessionClassID,</span>
<a href="#l50.107"></a><span id="l50.107" class="difflineplus">+        contractID: &quot;@mozilla.org/calendar/providers/gdata/session;1&quot;,</span>
<a href="#l50.108"></a><span id="l50.108" class="difflineplus">+        classDescription: &quot;Google Calendar Session&quot;,</span>
<a href="#l50.109"></a><span id="l50.109" class="difflineplus">+        interfaces: calGoogleSessionInterfaces</span>
<a href="#l50.110"></a><span id="l50.110" class="difflineplus">+    }),</span>
<a href="#l50.111"></a><span id="l50.111"> </span>
<a href="#l50.112"></a><span id="l50.112">     /* Member Variables */</span>
<a href="#l50.113"></a><span id="l50.113">     mGoogleUser: null,</span>
<a href="#l50.114"></a><span id="l50.114">     // This must be |undefined|, we need this variable to be tri-state.</span>
<a href="#l50.115"></a><span id="l50.115">     mGooglePass: undefined,</span>
<a href="#l50.116"></a><span id="l50.116">     mGoogleFullName: null,</span>
<a href="#l50.117"></a><span id="l50.117">     mAuthToken: null,</span>
<a href="#l50.118"></a><span id="l50.118">     mSessionID: null,</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l51.1"></a><span id="l51.1" class="difflineminus">--- a/calendar/providers/ics/calICSCalendar.js</span>
<a href="#l51.2"></a><span id="l51.2" class="difflineplus">+++ b/calendar/providers/ics/calICSCalendar.js</span>
<a href="#l51.3"></a><span id="l51.3" class="difflineat">@@ -42,50 +42,40 @@ function calICSCalendar() {</span>
<a href="#l51.4"></a><span id="l51.4">     this.initProviderBase();</span>
<a href="#l51.5"></a><span id="l51.5">     this.initICSCalendar();</span>
<a href="#l51.6"></a><span id="l51.6"> </span>
<a href="#l51.7"></a><span id="l51.7">     this.unmappedComponents = [];</span>
<a href="#l51.8"></a><span id="l51.8">     this.unmappedProperties = [];</span>
<a href="#l51.9"></a><span id="l51.9">     this.queue = new Array();</span>
<a href="#l51.10"></a><span id="l51.10">     this.mModificationActions = [];</span>
<a href="#l51.11"></a><span id="l51.11"> }</span>
<a href="#l51.12"></a><span id="l51.12" class="difflineminus">-</span>
<a href="#l51.13"></a><span id="l51.13" class="difflineplus">+const calICSCalendarClassID = Components.ID(&quot;{f8438bff-a3c9-4ed5-b23f-2663b5469abf}&quot;);</span>
<a href="#l51.14"></a><span id="l51.14" class="difflineplus">+const calICSCalendarInterfaces = [</span>
<a href="#l51.15"></a><span id="l51.15" class="difflineplus">+    Components.interfaces.calICalendarProvider,</span>
<a href="#l51.16"></a><span id="l51.16" class="difflineplus">+    Components.interfaces.calICalendar,</span>
<a href="#l51.17"></a><span id="l51.17" class="difflineplus">+    Components.interfaces.calISchedulingSupport,</span>
<a href="#l51.18"></a><span id="l51.18" class="difflineplus">+    Components.interfaces.nsIStreamListener,</span>
<a href="#l51.19"></a><span id="l51.19" class="difflineplus">+    Components.interfaces.nsIStreamLoaderObserver,</span>
<a href="#l51.20"></a><span id="l51.20" class="difflineplus">+    Components.interfaces.nsIChannelEventSink,</span>
<a href="#l51.21"></a><span id="l51.21" class="difflineplus">+    Components.interfaces.nsIInterfaceRequestor,</span>
<a href="#l51.22"></a><span id="l51.22" class="difflineplus">+];</span>
<a href="#l51.23"></a><span id="l51.23"> calICSCalendar.prototype = {</span>
<a href="#l51.24"></a><span id="l51.24">     __proto__: cal.ProviderBase.prototype,</span>
<a href="#l51.25"></a><span id="l51.25" class="difflineminus">-</span>
<a href="#l51.26"></a><span id="l51.26" class="difflineminus">-    classID: Components.ID(&quot;{f8438bff-a3c9-4ed5-b23f-2663b5469abf}&quot;),</span>
<a href="#l51.27"></a><span id="l51.27" class="difflineminus">-    contractID: &quot;@mozilla.org/calendar/calendar;1?type=ics&quot;,</span>
<a href="#l51.28"></a><span id="l51.28" class="difflineminus">-    classDescription: &quot;Calendar ICS provider&quot;,</span>
<a href="#l51.29"></a><span id="l51.29" class="difflineminus">-</span>
<a href="#l51.30"></a><span id="l51.30" class="difflineminus">-    getInterfaces: function getInterfaces(count) {</span>
<a href="#l51.31"></a><span id="l51.31" class="difflineminus">-        const ifaces = [Components.interfaces.calICalendarProvider,</span>
<a href="#l51.32"></a><span id="l51.32" class="difflineminus">-                        Components.interfaces.calICalendar,</span>
<a href="#l51.33"></a><span id="l51.33" class="difflineminus">-                        Components.interfaces.calISchedulingSupport,</span>
<a href="#l51.34"></a><span id="l51.34" class="difflineminus">-                        Components.interfaces.nsIStreamListener,</span>
<a href="#l51.35"></a><span id="l51.35" class="difflineminus">-                        Components.interfaces.nsIStreamLoaderObserver,</span>
<a href="#l51.36"></a><span id="l51.36" class="difflineminus">-                        Components.interfaces.nsIChannelEventSink,</span>
<a href="#l51.37"></a><span id="l51.37" class="difflineminus">-                        Components.interfaces.nsIInterfaceRequestor,</span>
<a href="#l51.38"></a><span id="l51.38" class="difflineminus">-                        Components.interfaces.nsIClassInfo,</span>
<a href="#l51.39"></a><span id="l51.39" class="difflineminus">-                        Components.interfaces.nsISupports];</span>
<a href="#l51.40"></a><span id="l51.40" class="difflineminus">-        count.value = ifaces.length;</span>
<a href="#l51.41"></a><span id="l51.41" class="difflineminus">-        return ifaces;</span>
<a href="#l51.42"></a><span id="l51.42" class="difflineminus">-    },</span>
<a href="#l51.43"></a><span id="l51.43" class="difflineminus">-    getHelperForLanguage: function getHelperForLanguage(language) {</span>
<a href="#l51.44"></a><span id="l51.44" class="difflineminus">-        return null;</span>
<a href="#l51.45"></a><span id="l51.45" class="difflineminus">-    },</span>
<a href="#l51.46"></a><span id="l51.46" class="difflineminus">-    implementationLanguage: Components.interfaces.nsIProgrammingLanguage.JAVASCRIPT,</span>
<a href="#l51.47"></a><span id="l51.47" class="difflineminus">-    flags: 0,</span>
<a href="#l51.48"></a><span id="l51.48" class="difflineplus">+    classID: calICSCalendarClassID,</span>
<a href="#l51.49"></a><span id="l51.49" class="difflineplus">+    QueryInterface: XPCOMUtils.generateQI(calICSCalendarInterfaces),</span>
<a href="#l51.50"></a><span id="l51.50" class="difflineplus">+    classInfo: XPCOMUtils.generateCI({</span>
<a href="#l51.51"></a><span id="l51.51" class="difflineplus">+        classID: calICSCalendarClassID,</span>
<a href="#l51.52"></a><span id="l51.52" class="difflineplus">+        contractID: &quot;@mozilla.org/calendar/calendar;1?type=ics&quot;,</span>
<a href="#l51.53"></a><span id="l51.53" class="difflineplus">+        classDescription: &quot;Calendar ICS provider&quot;,</span>
<a href="#l51.54"></a><span id="l51.54" class="difflineplus">+        interfaces: calICSCalendarInterfaces,</span>
<a href="#l51.55"></a><span id="l51.55" class="difflineplus">+    }),</span>
<a href="#l51.56"></a><span id="l51.56"> </span>
<a href="#l51.57"></a><span id="l51.57">     mObserver: null,</span>
<a href="#l51.58"></a><span id="l51.58">     locked: false,</span>
<a href="#l51.59"></a><span id="l51.59"> </span>
<a href="#l51.60"></a><span id="l51.60" class="difflineminus">-    QueryInterface: function (aIID) {</span>
<a href="#l51.61"></a><span id="l51.61" class="difflineminus">-        return cal.doQueryInterface(this, calICSCalendar.prototype, aIID, null, this);</span>
<a href="#l51.62"></a><span id="l51.62" class="difflineminus">-    },</span>
<a href="#l51.63"></a><span id="l51.63" class="difflineminus">-</span>
<a href="#l51.64"></a><span id="l51.64">     initICSCalendar: function() {</span>
<a href="#l51.65"></a><span id="l51.65">         this.mMemoryCalendar = Components.classes[&quot;@mozilla.org/calendar/calendar;1?type=memory&quot;]</span>
<a href="#l51.66"></a><span id="l51.66">                                          .createInstance(Components.interfaces.calICalendar);</span>
<a href="#l51.67"></a><span id="l51.67"> </span>
<a href="#l51.68"></a><span id="l51.68">         this.mMemoryCalendar.superCalendar = this;</span>
<a href="#l51.69"></a><span id="l51.69">         this.mObserver = new calICSObserver(this);</span>
<a href="#l51.70"></a><span id="l51.70">         this.mMemoryCalendar.addObserver(this.mObserver); // XXX Not removed</span>
<a href="#l51.71"></a><span id="l51.71">     },</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l52.1"></a><span id="l52.1" class="difflineminus">--- a/calendar/providers/memory/calMemoryCalendar.js</span>
<a href="#l52.2"></a><span id="l52.2" class="difflineplus">+++ b/calendar/providers/memory/calMemoryCalendar.js</span>
<a href="#l52.3"></a><span id="l52.3" class="difflineat">@@ -15,47 +15,34 @@ Components.utils.import(&quot;resource://cale</span>
<a href="#l52.4"></a><span id="l52.4"> const calCalendarManagerContractID = &quot;@mozilla.org/calendar/manager;1&quot;;</span>
<a href="#l52.5"></a><span id="l52.5"> const calICalendarManager = Components.interfaces.calICalendarManager;</span>
<a href="#l52.6"></a><span id="l52.6"> const cICL = Components.interfaces.calIChangeLog;</span>
<a href="#l52.7"></a><span id="l52.7"> </span>
<a href="#l52.8"></a><span id="l52.8"> function calMemoryCalendar() {</span>
<a href="#l52.9"></a><span id="l52.9">     this.initProviderBase();</span>
<a href="#l52.10"></a><span id="l52.10">     this.initMemoryCalendar();</span>
<a href="#l52.11"></a><span id="l52.11"> }</span>
<a href="#l52.12"></a><span id="l52.12" class="difflineminus">-</span>
<a href="#l52.13"></a><span id="l52.13" class="difflineplus">+const calMemoryCalendarClassID = Components.ID(&quot;{bda0dd7f-0a2f-4fcf-ba08-5517e6fbf133}&quot;);</span>
<a href="#l52.14"></a><span id="l52.14" class="difflineplus">+const calMemoryCalendarInterfaces = [</span>
<a href="#l52.15"></a><span id="l52.15" class="difflineplus">+    Components.interfaces.calICalendar,</span>
<a href="#l52.16"></a><span id="l52.16" class="difflineplus">+    Components.interfaces.calISchedulingSupport,</span>
<a href="#l52.17"></a><span id="l52.17" class="difflineplus">+    Components.interfaces.calIOfflineStorage,</span>
<a href="#l52.18"></a><span id="l52.18" class="difflineplus">+    Components.interfaces.calISyncWriteCalendar,</span>
<a href="#l52.19"></a><span id="l52.19" class="difflineplus">+    Components.interfaces.calICalendarProvider</span>
<a href="#l52.20"></a><span id="l52.20" class="difflineplus">+];</span>
<a href="#l52.21"></a><span id="l52.21"> calMemoryCalendar.prototype = {</span>
<a href="#l52.22"></a><span id="l52.22">     __proto__: cal.ProviderBase.prototype,</span>
<a href="#l52.23"></a><span id="l52.23" class="difflineminus">-</span>
<a href="#l52.24"></a><span id="l52.24" class="difflineminus">-    classID: Components.ID(&quot;{bda0dd7f-0a2f-4fcf-ba08-5517e6fbf133}&quot;),</span>
<a href="#l52.25"></a><span id="l52.25" class="difflineminus">-    contractID: &quot;@mozilla.org/calendar/calendar;1?type=memory&quot;,</span>
<a href="#l52.26"></a><span id="l52.26" class="difflineminus">-    classDescription: &quot;Calendar Memory Provider&quot;,</span>
<a href="#l52.27"></a><span id="l52.27" class="difflineminus">-</span>
<a href="#l52.28"></a><span id="l52.28" class="difflineminus">-    getInterfaces: function getInterfaces(count) {</span>
<a href="#l52.29"></a><span id="l52.29" class="difflineminus">-        const ifaces = [Components.interfaces.calICalendar,</span>
<a href="#l52.30"></a><span id="l52.30" class="difflineminus">-                        Components.interfaces.calISchedulingSupport,</span>
<a href="#l52.31"></a><span id="l52.31" class="difflineminus">-                        Components.interfaces.calIOfflineStorage,</span>
<a href="#l52.32"></a><span id="l52.32" class="difflineminus">-                        Components.interfaces.calISyncWriteCalendar,</span>
<a href="#l52.33"></a><span id="l52.33" class="difflineminus">-                        Components.interfaces.calICalendarProvider,</span>
<a href="#l52.34"></a><span id="l52.34" class="difflineminus">-                        Components.interfaces.nsIClassInfo,</span>
<a href="#l52.35"></a><span id="l52.35" class="difflineminus">-                        Components.interfaces.nsISupports];</span>
<a href="#l52.36"></a><span id="l52.36" class="difflineminus">-        count.value = ifaces.length;</span>
<a href="#l52.37"></a><span id="l52.37" class="difflineminus">-        return ifaces;</span>
<a href="#l52.38"></a><span id="l52.38" class="difflineminus">-    },</span>
<a href="#l52.39"></a><span id="l52.39" class="difflineminus">-    getHelperForLanguage: function getHelperForLanguage(language) {</span>
<a href="#l52.40"></a><span id="l52.40" class="difflineminus">-        return null;</span>
<a href="#l52.41"></a><span id="l52.41" class="difflineminus">-    },</span>
<a href="#l52.42"></a><span id="l52.42" class="difflineminus">-    implementationLanguage: Components.interfaces.nsIProgrammingLanguage.JAVASCRIPT,</span>
<a href="#l52.43"></a><span id="l52.43" class="difflineminus">-    flags: 0,</span>
<a href="#l52.44"></a><span id="l52.44" class="difflineminus">-</span>
<a href="#l52.45"></a><span id="l52.45" class="difflineminus">-    //</span>
<a href="#l52.46"></a><span id="l52.46" class="difflineminus">-    // nsISupports interface</span>
<a href="#l52.47"></a><span id="l52.47" class="difflineminus">-    // </span>
<a href="#l52.48"></a><span id="l52.48" class="difflineminus">-    QueryInterface: function (aIID) {</span>
<a href="#l52.49"></a><span id="l52.49" class="difflineminus">-        return cal.doQueryInterface(this, calMemoryCalendar.prototype, aIID, null, this);</span>
<a href="#l52.50"></a><span id="l52.50" class="difflineminus">-    },</span>
<a href="#l52.51"></a><span id="l52.51" class="difflineplus">+    classID: calMemoryCalendarClassID,</span>
<a href="#l52.52"></a><span id="l52.52" class="difflineplus">+    QueryInterface: XPCOMUtils.generateQI(calMemoryCalendarInterfaces),</span>
<a href="#l52.53"></a><span id="l52.53" class="difflineplus">+    classInfo: XPCOMUtils.generateCI({</span>
<a href="#l52.54"></a><span id="l52.54" class="difflineplus">+        classID: calMemoryCalendarClassID,</span>
<a href="#l52.55"></a><span id="l52.55" class="difflineplus">+        contractID: &quot;@mozilla.org/calendar/calendar;1?type=memory&quot;,</span>
<a href="#l52.56"></a><span id="l52.56" class="difflineplus">+        classDescription: &quot;Calendar Memory Provider&quot;,</span>
<a href="#l52.57"></a><span id="l52.57" class="difflineplus">+        interfaces: calMemoryCalendarInterfaces</span>
<a href="#l52.58"></a><span id="l52.58" class="difflineplus">+    }),</span>
<a href="#l52.59"></a><span id="l52.59"> </span>
<a href="#l52.60"></a><span id="l52.60">     mItems: null,</span>
<a href="#l52.61"></a><span id="l52.61">     mOfflineFlags: null,</span>
<a href="#l52.62"></a><span id="l52.62">     mObservers: null,</span>
<a href="#l52.63"></a><span id="l52.63">     mMetaData: null,</span>
<a href="#l52.64"></a><span id="l52.64"> </span>
<a href="#l52.65"></a><span id="l52.65">     initMemoryCalendar: function() {</span>
<a href="#l52.66"></a><span id="l52.66">         this.mObservers = new cal.ObserverBag(Components.interfaces.calIObserver);</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l53.1"></a><span id="l53.1" class="difflineminus">--- a/calendar/providers/storage/calStorageCalendar.js</span>
<a href="#l53.2"></a><span id="l53.2" class="difflineplus">+++ b/calendar/providers/storage/calStorageCalendar.js</span>
<a href="#l53.3"></a><span id="l53.3" class="difflineat">@@ -20,63 +20,46 @@ const cICL = Components.interfaces.calIC</span>
<a href="#l53.4"></a><span id="l53.4"> //</span>
<a href="#l53.5"></a><span id="l53.5"> </span>
<a href="#l53.6"></a><span id="l53.6"> function calStorageCalendar() {</span>
<a href="#l53.7"></a><span id="l53.7">     this.initProviderBase();</span>
<a href="#l53.8"></a><span id="l53.8">     this.mItemCache = {};</span>
<a href="#l53.9"></a><span id="l53.9">     this.mRecEventCache = {};</span>
<a href="#l53.10"></a><span id="l53.10">     this.mRecTodoCache = {};</span>
<a href="#l53.11"></a><span id="l53.11"> }</span>
<a href="#l53.12"></a><span id="l53.12" class="difflineminus">-</span>
<a href="#l53.13"></a><span id="l53.13" class="difflineplus">+const calStorageCalendarClassID = Components.ID(&quot;{b3eaa1c4-5dfe-4c0a-b62a-b3a514218461}&quot;);</span>
<a href="#l53.14"></a><span id="l53.14" class="difflineplus">+const calStorageCalendarInterfaces = [</span>
<a href="#l53.15"></a><span id="l53.15" class="difflineplus">+    Components.interfaces.calICalendar,</span>
<a href="#l53.16"></a><span id="l53.16" class="difflineplus">+    Components.interfaces.calICalendarProvider,</span>
<a href="#l53.17"></a><span id="l53.17" class="difflineplus">+    Components.interfaces.calIOfflineStorage,</span>
<a href="#l53.18"></a><span id="l53.18" class="difflineplus">+    Components.interfaces.calISchedulingSupport,</span>
<a href="#l53.19"></a><span id="l53.19" class="difflineplus">+    Components.interfaces.calISyncWriteCalendar,</span>
<a href="#l53.20"></a><span id="l53.20" class="difflineplus">+];</span>
<a href="#l53.21"></a><span id="l53.21"> calStorageCalendar.prototype = {</span>
<a href="#l53.22"></a><span id="l53.22">     __proto__: cal.ProviderBase.prototype,</span>
<a href="#l53.23"></a><span id="l53.23" class="difflineminus">-</span>
<a href="#l53.24"></a><span id="l53.24" class="difflineminus">-    //</span>
<a href="#l53.25"></a><span id="l53.25" class="difflineminus">-    // nsIClassInfo interface</span>
<a href="#l53.26"></a><span id="l53.26" class="difflineminus">-    //</span>
<a href="#l53.27"></a><span id="l53.27" class="difflineminus">-    classID: Components.ID(&quot;{b3eaa1c4-5dfe-4c0a-b62a-b3a514218461}&quot;),</span>
<a href="#l53.28"></a><span id="l53.28" class="difflineminus">-    contractID: &quot;@mozilla.org/calendar/calendar;1?type=storage&quot;,</span>
<a href="#l53.29"></a><span id="l53.29" class="difflineminus">-    classDescription: &quot;Calendar Storage Provider&quot;,</span>
<a href="#l53.30"></a><span id="l53.30" class="difflineminus">-    getInterfaces: function (count) {</span>
<a href="#l53.31"></a><span id="l53.31" class="difflineminus">-        let ifaces = [</span>
<a href="#l53.32"></a><span id="l53.32" class="difflineminus">-            Components.interfaces.nsISupports,</span>
<a href="#l53.33"></a><span id="l53.33" class="difflineminus">-            Components.interfaces.calICalendar,</span>
<a href="#l53.34"></a><span id="l53.34" class="difflineminus">-            Components.interfaces.calICalendarProvider,</span>
<a href="#l53.35"></a><span id="l53.35" class="difflineminus">-            Components.interfaces.calIOfflineStorage,</span>
<a href="#l53.36"></a><span id="l53.36" class="difflineminus">-            Components.interfaces.calISchedulingSupport,</span>
<a href="#l53.37"></a><span id="l53.37" class="difflineminus">-            Components.interfaces.calISyncWriteCalendar,</span>
<a href="#l53.38"></a><span id="l53.38" class="difflineminus">-            Components.interfaces.nsIClassInfo</span>
<a href="#l53.39"></a><span id="l53.39" class="difflineminus">-        ];</span>
<a href="#l53.40"></a><span id="l53.40" class="difflineminus">-        count.value = ifaces.length;</span>
<a href="#l53.41"></a><span id="l53.41" class="difflineminus">-        return ifaces;</span>
<a href="#l53.42"></a><span id="l53.42" class="difflineminus">-    },</span>
<a href="#l53.43"></a><span id="l53.43" class="difflineminus">-    getHelperForLanguage: function (language) {</span>
<a href="#l53.44"></a><span id="l53.44" class="difflineminus">-        return null;</span>
<a href="#l53.45"></a><span id="l53.45" class="difflineminus">-    },</span>
<a href="#l53.46"></a><span id="l53.46" class="difflineminus">-    implementationLanguage: Components.interfaces.nsIProgrammingLanguage.JAVASCRIPT,</span>
<a href="#l53.47"></a><span id="l53.47" class="difflineminus">-    flags: 0,</span>
<a href="#l53.48"></a><span id="l53.48" class="difflineplus">+    classID: calStorageCalendarClassID,</span>
<a href="#l53.49"></a><span id="l53.49" class="difflineplus">+    QueryInterface: XPCOMUtils.generateQI(calStorageCalendarInterfaces),</span>
<a href="#l53.50"></a><span id="l53.50" class="difflineplus">+    classInfo: XPCOMUtils.generateCI({</span>
<a href="#l53.51"></a><span id="l53.51" class="difflineplus">+        classID: calStorageCalendarClassID,</span>
<a href="#l53.52"></a><span id="l53.52" class="difflineplus">+        contractID: &quot;@mozilla.org/calendar/calendar;1?type=storage&quot;,</span>
<a href="#l53.53"></a><span id="l53.53" class="difflineplus">+        classDescription: &quot;Calendar Storage Provider&quot;,</span>
<a href="#l53.54"></a><span id="l53.54" class="difflineplus">+        interfaces: calStorageCalendarInterfaces</span>
<a href="#l53.55"></a><span id="l53.55" class="difflineplus">+    }),</span>
<a href="#l53.56"></a><span id="l53.56"> </span>
<a href="#l53.57"></a><span id="l53.57">     //</span>
<a href="#l53.58"></a><span id="l53.58">     // private members</span>
<a href="#l53.59"></a><span id="l53.59">     //</span>
<a href="#l53.60"></a><span id="l53.60">     mDB: null,</span>
<a href="#l53.61"></a><span id="l53.61">     mItemCache: null,</span>
<a href="#l53.62"></a><span id="l53.62">     mRecItemCacheInited: false,</span>
<a href="#l53.63"></a><span id="l53.63">     mRecEventCache: null,</span>
<a href="#l53.64"></a><span id="l53.64">     mRecTodoCache: null,</span>
<a href="#l53.65"></a><span id="l53.65">     mLastStatement: null,</span>
<a href="#l53.66"></a><span id="l53.66"> </span>
<a href="#l53.67"></a><span id="l53.67">     //</span>
<a href="#l53.68"></a><span id="l53.68" class="difflineminus">-    // nsISupports interface</span>
<a href="#l53.69"></a><span id="l53.69" class="difflineminus">-    //</span>
<a href="#l53.70"></a><span id="l53.70" class="difflineminus">-    QueryInterface: function (aIID) {</span>
<a href="#l53.71"></a><span id="l53.71" class="difflineminus">-        return cal.doQueryInterface(this, calStorageCalendar.prototype, aIID, null, this);</span>
<a href="#l53.72"></a><span id="l53.72" class="difflineminus">-    },</span>
<a href="#l53.73"></a><span id="l53.73" class="difflineminus">-</span>
<a href="#l53.74"></a><span id="l53.74" class="difflineminus">-    //</span>
<a href="#l53.75"></a><span id="l53.75">     // calICalendarProvider interface</span>
<a href="#l53.76"></a><span id="l53.76">     //</span>
<a href="#l53.77"></a><span id="l53.77">     get prefChromeOverlay() {</span>
<a href="#l53.78"></a><span id="l53.78">         return null;</span>
<a href="#l53.79"></a><span id="l53.79">     },</span>
<a href="#l53.80"></a><span id="l53.80"> </span>
<a href="#l53.81"></a><span id="l53.81">     get displayName() {</span>
<a href="#l53.82"></a><span id="l53.82">         return cal.calGetString(&quot;calendar&quot;, &quot;storageName&quot;);</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l54.1"></a><span id="l54.1" class="difflineminus">--- a/calendar/providers/wcap/calWcapCalendar.js</span>
<a href="#l54.2"></a><span id="l54.2" class="difflineplus">+++ b/calendar/providers/wcap/calWcapCalendar.js</span>
<a href="#l54.3"></a><span id="l54.3" class="difflineat">@@ -1,46 +1,38 @@</span>
<a href="#l54.4"></a><span id="l54.4"> /* This Source Code Form is subject to the terms of the Mozilla Public</span>
<a href="#l54.5"></a><span id="l54.5">  * License, v. 2.0. If a copy of the MPL was not distributed with this</span>
<a href="#l54.6"></a><span id="l54.6">  * file, You can obtain one at http://mozilla.org/MPL/2.0/. */</span>
<a href="#l54.7"></a><span id="l54.7"> </span>
<a href="#l54.8"></a><span id="l54.8"> Components.utils.import(&quot;resource://calendar/modules/calUtils.jsm&quot;);</span>
<a href="#l54.9"></a><span id="l54.9" class="difflineplus">+Components.utils.import(&quot;resource://gre/modules/XPCOMUtils.jsm&quot;);</span>
<a href="#l54.10"></a><span id="l54.10"> </span>
<a href="#l54.11"></a><span id="l54.11"> function calWcapCalendar(/*optional*/session, /*optional*/calProps) {</span>
<a href="#l54.12"></a><span id="l54.12">     this.initProviderBase();</span>
<a href="#l54.13"></a><span id="l54.13">     this.m_session = session;</span>
<a href="#l54.14"></a><span id="l54.14">     this.m_calProps = calProps;</span>
<a href="#l54.15"></a><span id="l54.15"> }</span>
<a href="#l54.16"></a><span id="l54.16" class="difflineplus">+const calWcapCalendarClassID = Components.ID(&quot;{cf4d93e5-af79-451a-95f3-109055b32ef0}&quot;);</span>
<a href="#l54.17"></a><span id="l54.17" class="difflineplus">+const calWcapCalendarInterfaces = [</span>
<a href="#l54.18"></a><span id="l54.18" class="difflineplus">+    calIWcapCalendar,</span>
<a href="#l54.19"></a><span id="l54.19" class="difflineplus">+    calICalendar,</span>
<a href="#l54.20"></a><span id="l54.20" class="difflineplus">+    Components.interfaces.calISchedulingSupport,</span>
<a href="#l54.21"></a><span id="l54.21" class="difflineplus">+    Components.interfaces.calIChangeLog,</span>
<a href="#l54.22"></a><span id="l54.22" class="difflineplus">+    Components.interfaces.calICalendarProvider,</span>
<a href="#l54.23"></a><span id="l54.23" class="difflineplus">+];</span>
<a href="#l54.24"></a><span id="l54.24"> calWcapCalendar.prototype = {</span>
<a href="#l54.25"></a><span id="l54.25">     __proto__: cal.ProviderBase.prototype,</span>
<a href="#l54.26"></a><span id="l54.26" class="difflineminus">-</span>
<a href="#l54.27"></a><span id="l54.27" class="difflineminus">-    getInterfaces: function ci_wcapCalendar_getInterfaces(count) {</span>
<a href="#l54.28"></a><span id="l54.28" class="difflineminus">-        const ifaces = [calIWcapCalendar,</span>
<a href="#l54.29"></a><span id="l54.29" class="difflineminus">-                        calICalendar,</span>
<a href="#l54.30"></a><span id="l54.30" class="difflineminus">-                        Components.interfaces.calISchedulingSupport,</span>
<a href="#l54.31"></a><span id="l54.31" class="difflineminus">-                        Components.interfaces.calIChangeLog,</span>
<a href="#l54.32"></a><span id="l54.32" class="difflineminus">-                        Components.interfaces.calICalendarProvider,</span>
<a href="#l54.33"></a><span id="l54.33" class="difflineminus">-                        Components.interfaces.nsIClassInfo,</span>
<a href="#l54.34"></a><span id="l54.34" class="difflineminus">-                        nsISupports];</span>
<a href="#l54.35"></a><span id="l54.35" class="difflineminus">-        count.value = ifaces.length;</span>
<a href="#l54.36"></a><span id="l54.36" class="difflineminus">-        return ifaces;</span>
<a href="#l54.37"></a><span id="l54.37" class="difflineminus">-    },</span>
<a href="#l54.38"></a><span id="l54.38" class="difflineminus">-    classDescription: &quot;Sun Java System Calendar Server WCAP Provider&quot;,</span>
<a href="#l54.39"></a><span id="l54.39" class="difflineminus">-    contractID: &quot;@mozilla.org/calendar/calendar;1?type=wcap&quot;,</span>
<a href="#l54.40"></a><span id="l54.40" class="difflineminus">-    classID: Components.ID(&quot;{cf4d93e5-af79-451a-95f3-109055b32ef0}&quot;),</span>
<a href="#l54.41"></a><span id="l54.41" class="difflineminus">-    getHelperForLanguage: function ci_wcapCalendar_getHelperForLanguage(language) {</span>
<a href="#l54.42"></a><span id="l54.42" class="difflineminus">-        return null;</span>
<a href="#l54.43"></a><span id="l54.43" class="difflineminus">-    },</span>
<a href="#l54.44"></a><span id="l54.44" class="difflineminus">-    implementationLanguage: Components.interfaces.nsIProgrammingLanguage.JAVASCRIPT,</span>
<a href="#l54.45"></a><span id="l54.45" class="difflineminus">-    flags: 0,</span>
<a href="#l54.46"></a><span id="l54.46" class="difflineminus">-</span>
<a href="#l54.47"></a><span id="l54.47" class="difflineminus">-    // nsISupports:</span>
<a href="#l54.48"></a><span id="l54.48" class="difflineminus">-    QueryInterface: function calWcapCalendar_QueryInterface(iid) {</span>
<a href="#l54.49"></a><span id="l54.49" class="difflineminus">-        return cal.doQueryInterface(this, calWcapCalendar.prototype, iid, null, this);</span>
<a href="#l54.50"></a><span id="l54.50" class="difflineminus">-    },</span>
<a href="#l54.51"></a><span id="l54.51" class="difflineplus">+    classID: calWcapCalendarClassID,</span>
<a href="#l54.52"></a><span id="l54.52" class="difflineplus">+    QueryInterface: XPCOMUtils.generateQI(calWcapCalendarInterfaces),</span>
<a href="#l54.53"></a><span id="l54.53" class="difflineplus">+    classInfo: XPCOMUtils.generateCI({</span>
<a href="#l54.54"></a><span id="l54.54" class="difflineplus">+        classID: calWcapCalendarClassID,</span>
<a href="#l54.55"></a><span id="l54.55" class="difflineplus">+        contractID: &quot;@mozilla.org/calendar/calendar;1?type=wcap&quot;,</span>
<a href="#l54.56"></a><span id="l54.56" class="difflineplus">+        classDescription: &quot;Sun Java System Calendar Server WCAP Provider&quot;,</span>
<a href="#l54.57"></a><span id="l54.57" class="difflineplus">+        interfaces: calWcapCalendarInterfaces</span>
<a href="#l54.58"></a><span id="l54.58" class="difflineplus">+    }),</span>
<a href="#l54.59"></a><span id="l54.59"> </span>
<a href="#l54.60"></a><span id="l54.60">     toString: function calWcapCalendar_toString() {</span>
<a href="#l54.61"></a><span id="l54.61">         var str = this.session.toString();</span>
<a href="#l54.62"></a><span id="l54.62">         if (this.m_calId) {</span>
<a href="#l54.63"></a><span id="l54.63">             str += (&quot;, calId=&quot; + this.calId);</span>
<a href="#l54.64"></a><span id="l54.64">         } else {</span>
<a href="#l54.65"></a><span id="l54.65">             str += &quot;, default calendar&quot;;</span>
<a href="#l54.66"></a><span id="l54.66">         }</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l55.1"></a><span id="l55.1" class="difflineminus">--- a/calendar/providers/wcap/calWcapRequest.js</span>
<a href="#l55.2"></a><span id="l55.2" class="difflineplus">+++ b/calendar/providers/wcap/calWcapRequest.js</span>
<a href="#l55.3"></a><span id="l55.3" class="difflineat">@@ -13,16 +13,17 @@</span>
<a href="#l55.4"></a><span id="l55.4">    whether the request has been successful and get its data.</span>
<a href="#l55.5"></a><span id="l55.5">    The request function itself may return either</span>
<a href="#l55.6"></a><span id="l55.6">    - a further calIOperation request object, i.e. an async continuation</span>
<a href="#l55.7"></a><span id="l55.7">    - some data (incl null/undefined) which is the result of the async function,</span>
<a href="#l55.8"></a><span id="l55.8">      indicating that there is no further continuation</span>
<a href="#l55.9"></a><span id="l55.9"> */</span>
<a href="#l55.10"></a><span id="l55.10"> </span>
<a href="#l55.11"></a><span id="l55.11"> Components.utils.import(&quot;resource://gre/modules/Services.jsm&quot;);</span>
<a href="#l55.12"></a><span id="l55.12" class="difflineplus">+Components.utils.import(&quot;resource://gre/modules/XPCOMUtils.jsm&quot;);</span>
<a href="#l55.13"></a><span id="l55.13"> </span>
<a href="#l55.14"></a><span id="l55.14"> function generateRequestId() {</span>
<a href="#l55.15"></a><span id="l55.15">     if (!generateRequestId.mRequestPrefix) {</span>
<a href="#l55.16"></a><span id="l55.16">         generateRequestId.mRequestPrefix = (cal.getUUID() + &quot;-&quot;);</span>
<a href="#l55.17"></a><span id="l55.17">         generateRequestId.mRequestId = 0;</span>
<a href="#l55.18"></a><span id="l55.18">     }</span>
<a href="#l55.19"></a><span id="l55.19">     ++generateRequestId.mRequestId;</span>
<a href="#l55.20"></a><span id="l55.20">     return (generateRequestId.mRequestPrefix + generateRequestId.mRequestId);</span>
<a href="#l55.21"></a><span id="l55.21" class="difflineat">@@ -186,45 +187,38 @@ calWcapRequest.prototype = {</span>
<a href="#l55.22"></a><span id="l55.22"> </span>
<a href="#l55.23"></a><span id="l55.23"> function calWcapNetworkRequest(url, respFunc, bLogging) {</span>
<a href="#l55.24"></a><span id="l55.24">     this.wrappedJSObject = this;</span>
<a href="#l55.25"></a><span id="l55.25">     this.m_id = generateRequestId();</span>
<a href="#l55.26"></a><span id="l55.26">     this.m_url = url;</span>
<a href="#l55.27"></a><span id="l55.27">     this.m_respFunc = respFunc;</span>
<a href="#l55.28"></a><span id="l55.28">     this.m_bLogging = (bLogging === undefined ? true : bLogging);</span>
<a href="#l55.29"></a><span id="l55.29"> }</span>
<a href="#l55.30"></a><span id="l55.30" class="difflineplus">+const calWcapNetworkRequestClassID = Components.ID(&quot;{e3c62b37-83cf-41ec-9872-0af9f952430a}&quot;);</span>
<a href="#l55.31"></a><span id="l55.31" class="difflineplus">+const calWcapNetworkRequestInterfaces = [</span>
<a href="#l55.32"></a><span id="l55.32" class="difflineplus">+    Components.interfaces.nsIUnicharStreamLoaderObserver,</span>
<a href="#l55.33"></a><span id="l55.33" class="difflineplus">+    Components.interfaces.nsIInterfaceRequestor,</span>
<a href="#l55.34"></a><span id="l55.34" class="difflineplus">+    Components.interfaces.nsIChannelEventSink,</span>
<a href="#l55.35"></a><span id="l55.35" class="difflineplus">+    Components.interfaces.calIOperation,</span>
<a href="#l55.36"></a><span id="l55.36" class="difflineplus">+];</span>
<a href="#l55.37"></a><span id="l55.37"> calWcapNetworkRequest.prototype = {</span>
<a href="#l55.38"></a><span id="l55.38">     m_id: 0,</span>
<a href="#l55.39"></a><span id="l55.39">     m_url: null,</span>
<a href="#l55.40"></a><span id="l55.40">     m_loader: null,</span>
<a href="#l55.41"></a><span id="l55.41">     m_respFunc: null,</span>
<a href="#l55.42"></a><span id="l55.42">     m_bLogging: false,</span>
<a href="#l55.43"></a><span id="l55.43"> </span>
<a href="#l55.44"></a><span id="l55.44" class="difflineminus">-    getInterfaces: function ci_wcapNetworkRequest_getInterfaces(count) {</span>
<a href="#l55.45"></a><span id="l55.45" class="difflineminus">-        const ifaces = [Components.interfaces.nsIUnicharStreamLoaderObserver,</span>
<a href="#l55.46"></a><span id="l55.46" class="difflineminus">-                        Components.interfaces.nsIInterfaceRequestor,</span>
<a href="#l55.47"></a><span id="l55.47" class="difflineminus">-                        Components.interfaces.nsIChannelEventSink,</span>
<a href="#l55.48"></a><span id="l55.48" class="difflineminus">-                        Components.interfaces.calIOperation,</span>
<a href="#l55.49"></a><span id="l55.49" class="difflineminus">-                        Components.interfaces.nsIClassInfo,</span>
<a href="#l55.50"></a><span id="l55.50" class="difflineminus">-                        nsISupports];</span>
<a href="#l55.51"></a><span id="l55.51" class="difflineminus">-        count.value = ifaces.length;</span>
<a href="#l55.52"></a><span id="l55.52" class="difflineminus">-        return ifaces;</span>
<a href="#l55.53"></a><span id="l55.53" class="difflineminus">-    },</span>
<a href="#l55.54"></a><span id="l55.54" class="difflineminus">-    classDescription: &quot;Sun Java System Calendar Server WCAP Network Request&quot;,</span>
<a href="#l55.55"></a><span id="l55.55" class="difflineminus">-    contractID: &quot;@mozilla.org/calendar/wcap/network-request;1&quot;,</span>
<a href="#l55.56"></a><span id="l55.56" class="difflineminus">-    classID: Components.ID(&quot;{e3c62b37-83cf-41ec-9872-0af9f952430a}&quot;),</span>
<a href="#l55.57"></a><span id="l55.57" class="difflineminus">-    getHelperForLanguage: function ci_wcapNetworkRequest_getHelperForLanguage(language) {</span>
<a href="#l55.58"></a><span id="l55.58" class="difflineminus">-        return null;</span>
<a href="#l55.59"></a><span id="l55.59" class="difflineminus">-    },</span>
<a href="#l55.60"></a><span id="l55.60" class="difflineminus">-    implementationLanguage: Components.interfaces.nsIProgrammingLanguage.JAVASCRIPT,</span>
<a href="#l55.61"></a><span id="l55.61" class="difflineminus">-    flags: 0,</span>
<a href="#l55.62"></a><span id="l55.62" class="difflineminus">-</span>
<a href="#l55.63"></a><span id="l55.63" class="difflineminus">-    QueryInterface: function calWcapNetworkRequest_QueryInterface(iid) {</span>
<a href="#l55.64"></a><span id="l55.64" class="difflineminus">-        return cal.doQueryInterface(this, calWcapNetworkRequest.prototype, iid, null, this);</span>
<a href="#l55.65"></a><span id="l55.65" class="difflineminus">-    },</span>
<a href="#l55.66"></a><span id="l55.66" class="difflineplus">+    classID: calWcapNetworkRequestClassID,</span>
<a href="#l55.67"></a><span id="l55.67" class="difflineplus">+    QueryInterface: XPCOMUtils.generateQI(calWcapNetworkRequestInterfaces),</span>
<a href="#l55.68"></a><span id="l55.68" class="difflineplus">+    classInfo: XPCOMUtils.generateCI({</span>
<a href="#l55.69"></a><span id="l55.69" class="difflineplus">+        classID: calWcapNetworkRequestClassID,</span>
<a href="#l55.70"></a><span id="l55.70" class="difflineplus">+        contractID: &quot;@mozilla.org/calendar/wcap/network-request;1&quot;,</span>
<a href="#l55.71"></a><span id="l55.71" class="difflineplus">+        classDescription: &quot;Sun Java System Calendar Server WCAP Network Request&quot;,</span>
<a href="#l55.72"></a><span id="l55.72" class="difflineplus">+        interfaces: calWcapNetworkRequestInterfaces</span>
<a href="#l55.73"></a><span id="l55.73" class="difflineplus">+    }),</span>
<a href="#l55.74"></a><span id="l55.74"> </span>
<a href="#l55.75"></a><span id="l55.75">     /**</span>
<a href="#l55.76"></a><span id="l55.76">      * @see nsIInterfaceRequestor</span>
<a href="#l55.77"></a><span id="l55.77">      * @see calProviderUtils.jsm</span>
<a href="#l55.78"></a><span id="l55.78">      */</span>
<a href="#l55.79"></a><span id="l55.79">     getInterface: cal.InterfaceRequestor_getInterface,</span>
<a href="#l55.80"></a><span id="l55.80"> </span>
<a href="#l55.81"></a><span id="l55.81">     /**</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l56.1"></a><span id="l56.1" class="difflineminus">--- a/calendar/providers/wcap/calWcapSession.js</span>
<a href="#l56.2"></a><span id="l56.2" class="difflineplus">+++ b/calendar/providers/wcap/calWcapSession.js</span>
<a href="#l56.3"></a><span id="l56.3" class="difflineat">@@ -1,15 +1,16 @@</span>
<a href="#l56.4"></a><span id="l56.4"> /* This Source Code Form is subject to the terms of the Mozilla Public</span>
<a href="#l56.5"></a><span id="l56.5">  * License, v. 2.0. If a copy of the MPL was not distributed with this</span>
<a href="#l56.6"></a><span id="l56.6">  * file, You can obtain one at http://mozilla.org/MPL/2.0/. */</span>
<a href="#l56.7"></a><span id="l56.7"> </span>
<a href="#l56.8"></a><span id="l56.8"> Components.utils.import(&quot;resource://calendar/modules/calUtils.jsm&quot;);</span>
<a href="#l56.9"></a><span id="l56.9"> Components.utils.import(&quot;resource://calendar/modules/calIteratorUtils.jsm&quot;);</span>
<a href="#l56.10"></a><span id="l56.10"> Components.utils.import(&quot;resource://gre/modules/Services.jsm&quot;);</span>
<a href="#l56.11"></a><span id="l56.11" class="difflineplus">+Components.utils.import(&quot;resource://gre/modules/XPCOMUtils.jsm&quot;);</span>
<a href="#l56.12"></a><span id="l56.12"> </span>
<a href="#l56.13"></a><span id="l56.13"> function calWcapTimezone(tzProvider, tzid_, component_) {</span>
<a href="#l56.14"></a><span id="l56.14">     this.wrappedJSObject = this;</span>
<a href="#l56.15"></a><span id="l56.15">     this.provider = tzProvider;</span>
<a href="#l56.16"></a><span id="l56.16">     this.icalComponent = component_;</span>
<a href="#l56.17"></a><span id="l56.17">     this.tzid = tzid_;</span>
<a href="#l56.18"></a><span id="l56.18">     this.isUTC = false;</span>
<a href="#l56.19"></a><span id="l56.19">     this.isFloating = false;</span>
<a href="#l56.20"></a><span id="l56.20" class="difflineat">@@ -95,41 +96,33 @@ function calWcapSession(contextId) {</span>
<a href="#l56.21"></a><span id="l56.21">     this.wrappedJSObject = this;</span>
<a href="#l56.22"></a><span id="l56.22">     this.m_contextId = contextId;</span>
<a href="#l56.23"></a><span id="l56.23">     this.m_loginQueue = [];</span>
<a href="#l56.24"></a><span id="l56.24"> </span>
<a href="#l56.25"></a><span id="l56.25">     // listen for shutdown, being logged out:</span>
<a href="#l56.26"></a><span id="l56.26">     Services.obs.addObserver(this, &quot;quit-application&quot;, false /* don't hold weakly */);</span>
<a href="#l56.27"></a><span id="l56.27">     cal.getCalendarManager().addObserver(this);</span>
<a href="#l56.28"></a><span id="l56.28"> }</span>
<a href="#l56.29"></a><span id="l56.29" class="difflineplus">+const calWcapSessionClassID = Components.ID(&quot;{cbf803fd-4469-4999-ae39-367af1c7b077}&quot;);</span>
<a href="#l56.30"></a><span id="l56.30" class="difflineplus">+const calWcapSessionInterfaces = [</span>
<a href="#l56.31"></a><span id="l56.31" class="difflineplus">+    calIWcapSession,</span>
<a href="#l56.32"></a><span id="l56.32" class="difflineplus">+    calIFreeBusyProvider,</span>
<a href="#l56.33"></a><span id="l56.33" class="difflineplus">+    calICalendarSearchProvider,</span>
<a href="#l56.34"></a><span id="l56.34" class="difflineplus">+    Components.interfaces.calITimezoneProvider,</span>
<a href="#l56.35"></a><span id="l56.35" class="difflineplus">+    Components.interfaces.calICalendarManagerObserver</span>
<a href="#l56.36"></a><span id="l56.36" class="difflineplus">+];</span>
<a href="#l56.37"></a><span id="l56.37"> calWcapSession.prototype = {</span>
<a href="#l56.38"></a><span id="l56.38" class="difflineminus">-    getInterfaces: function ci_wcapSession_getInterfaces(count) {</span>
<a href="#l56.39"></a><span id="l56.39" class="difflineminus">-        const ifaces = [calIWcapSession,</span>
<a href="#l56.40"></a><span id="l56.40" class="difflineminus">-                        calIFreeBusyProvider,</span>
<a href="#l56.41"></a><span id="l56.41" class="difflineminus">-                        calICalendarSearchProvider,</span>
<a href="#l56.42"></a><span id="l56.42" class="difflineminus">-                        Components.interfaces.calITimezoneProvider,</span>
<a href="#l56.43"></a><span id="l56.43" class="difflineminus">-                        Components.interfaces.calICalendarManagerObserver,</span>
<a href="#l56.44"></a><span id="l56.44" class="difflineminus">-                        Components.interfaces.nsIClassInfo,</span>
<a href="#l56.45"></a><span id="l56.45" class="difflineminus">-                        nsISupports];</span>
<a href="#l56.46"></a><span id="l56.46" class="difflineminus">-        count.value = ifaces.length;</span>
<a href="#l56.47"></a><span id="l56.47" class="difflineminus">-        return ifaces;</span>
<a href="#l56.48"></a><span id="l56.48" class="difflineminus">-    },</span>
<a href="#l56.49"></a><span id="l56.49" class="difflineminus">-    classDescription: &quot;Sun Java System Calendar Server WCAP Session&quot;,</span>
<a href="#l56.50"></a><span id="l56.50" class="difflineminus">-    contractID: &quot;@mozilla.org/calendar/wcap/session;1&quot;,</span>
<a href="#l56.51"></a><span id="l56.51" class="difflineminus">-    classID: Components.ID(&quot;{cbf803fd-4469-4999-ae39-367af1c7b077}&quot;),</span>
<a href="#l56.52"></a><span id="l56.52" class="difflineminus">-    getHelperForLanguage: function ci_wcapSession_getHelperForLanguage(language) {</span>
<a href="#l56.53"></a><span id="l56.53" class="difflineminus">-        return null;</span>
<a href="#l56.54"></a><span id="l56.54" class="difflineminus">-    },</span>
<a href="#l56.55"></a><span id="l56.55" class="difflineminus">-    implementationLanguage: Components.interfaces.nsIProgrammingLanguage.JAVASCRIPT,</span>
<a href="#l56.56"></a><span id="l56.56" class="difflineminus">-    flags: 0,</span>
<a href="#l56.57"></a><span id="l56.57" class="difflineminus">-</span>
<a href="#l56.58"></a><span id="l56.58" class="difflineminus">-    // nsISupports:</span>
<a href="#l56.59"></a><span id="l56.59" class="difflineminus">-    QueryInterface: function calWcapSession_QueryInterface(iid) {</span>
<a href="#l56.60"></a><span id="l56.60" class="difflineminus">-        return cal.doQueryInterface(this, calWcapSession.prototype, iid, null, this);</span>
<a href="#l56.61"></a><span id="l56.61" class="difflineminus">-    },</span>
<a href="#l56.62"></a><span id="l56.62" class="difflineplus">+    classID: calWcapSessionClassID,</span>
<a href="#l56.63"></a><span id="l56.63" class="difflineplus">+    QueryInterface: XPCOMUtils.generateQI(calWcapSessionInterfaces),</span>
<a href="#l56.64"></a><span id="l56.64" class="difflineplus">+    classInfo: XPCOMUtils.generateCI({</span>
<a href="#l56.65"></a><span id="l56.65" class="difflineplus">+        classID: calWcapSessionClassID,</span>
<a href="#l56.66"></a><span id="l56.66" class="difflineplus">+        contractID: &quot;@mozilla.org/calendar/wcap/session;1&quot;,</span>
<a href="#l56.67"></a><span id="l56.67" class="difflineplus">+        classDescription: &quot;Sun Java System Calendar Server WCAP Session&quot;,</span>
<a href="#l56.68"></a><span id="l56.68" class="difflineplus">+        interfaces: calWcapSessionInterfaces</span>
<a href="#l56.69"></a><span id="l56.69" class="difflineplus">+    }),</span>
<a href="#l56.70"></a><span id="l56.70"> </span>
<a href="#l56.71"></a><span id="l56.71">     toString: function calWcapSession_toString(msg) {</span>
<a href="#l56.72"></a><span id="l56.72">         let str = (&quot;context-id: &quot; + this.m_contextId + &quot;, uri: &quot; + (this.uri ? this.uri.spec : &quot;unknown&quot;));</span>
<a href="#l56.73"></a><span id="l56.73">         if (this.credentials.userId) {</span>
<a href="#l56.74"></a><span id="l56.74">             str += (&quot;, userId=&quot; + this.credentials.userId);</span>
<a href="#l56.75"></a><span id="l56.75">         }</span>
<a href="#l56.76"></a><span id="l56.76">         if (!this.m_sessionId) {</span>
<a href="#l56.77"></a><span id="l56.77">             str += (Services.io.offline ? &quot;, offline&quot; : &quot;, not logged in&quot;);</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l57.1"></a><span id="l57.1" class="difflineminus">--- a/calendar/resources/content/calendarService.js</span>
<a href="#l57.2"></a><span id="l57.2" class="difflineplus">+++ b/calendar/resources/content/calendarService.js</span>
<a href="#l57.3"></a><span id="l57.3" class="difflineat">@@ -15,43 +15,30 @@</span>
<a href="#l57.4"></a><span id="l57.4">  */</span>
<a href="#l57.5"></a><span id="l57.5"> </span>
<a href="#l57.6"></a><span id="l57.6"> Components.utils.import(&quot;resource://gre/modules/Services.jsm&quot;);</span>
<a href="#l57.7"></a><span id="l57.7"> Components.utils.import(&quot;resource://gre/modules/XPCOMUtils.jsm&quot;);</span>
<a href="#l57.8"></a><span id="l57.8"> Components.utils.import(&quot;resource://calendar/modules/calUtils.jsm&quot;);</span>
<a href="#l57.9"></a><span id="l57.9"> </span>
<a href="#l57.10"></a><span id="l57.10"> /* Command Line handler service */</span>
<a href="#l57.11"></a><span id="l57.11"> function CLineService() {</span>
<a href="#l57.12"></a><span id="l57.12" class="difflineplus">+    this.wrappedJSObject = this;</span>
<a href="#l57.13"></a><span id="l57.13"> }</span>
<a href="#l57.14"></a><span id="l57.14" class="difflineminus">-</span>
<a href="#l57.15"></a><span id="l57.15" class="difflineplus">+const CLineServiceClassID = Components.ID(&quot;{65ef4b0b-d116-4b93-bf8a-84525992bf27}&quot;);</span>
<a href="#l57.16"></a><span id="l57.16" class="difflineplus">+const CLineServiceInterfaces = [Components.interfaces.nsICommandLineHandler];</span>
<a href="#l57.17"></a><span id="l57.17"> CLineService.prototype = {</span>
<a href="#l57.18"></a><span id="l57.18" class="difflineminus">-    getInterfaces: function getInterfaces(aCount) {</span>
<a href="#l57.19"></a><span id="l57.19" class="difflineminus">-        const ifaces = [</span>
<a href="#l57.20"></a><span id="l57.20" class="difflineminus">-            Components.interfaces.nsISupports,</span>
<a href="#l57.21"></a><span id="l57.21" class="difflineminus">-            Components.interfaces.nsIClassInfo,</span>
<a href="#l57.22"></a><span id="l57.22" class="difflineminus">-            Components.interfaces.nsICommandLineHandler</span>
<a href="#l57.23"></a><span id="l57.23" class="difflineminus">-        ];</span>
<a href="#l57.24"></a><span id="l57.24" class="difflineminus">-</span>
<a href="#l57.25"></a><span id="l57.25" class="difflineminus">-        aCount.value = ifaces.length;</span>
<a href="#l57.26"></a><span id="l57.26" class="difflineminus">-        return ifaces;</span>
<a href="#l57.27"></a><span id="l57.27" class="difflineminus">-    },</span>
<a href="#l57.28"></a><span id="l57.28" class="difflineminus">-</span>
<a href="#l57.29"></a><span id="l57.29" class="difflineminus">-    getHelperForLanguage: function (language) {</span>
<a href="#l57.30"></a><span id="l57.30" class="difflineminus">-        return null;</span>
<a href="#l57.31"></a><span id="l57.31" class="difflineminus">-    },</span>
<a href="#l57.32"></a><span id="l57.32" class="difflineminus">-</span>
<a href="#l57.33"></a><span id="l57.33" class="difflineminus">-    contractID: &quot;@mozilla.org/commandlinehandler/general-startup;1?type=calendar&quot;,</span>
<a href="#l57.34"></a><span id="l57.34" class="difflineminus">-    classDescription: &quot;Calendar Commandline Handler&quot;,</span>
<a href="#l57.35"></a><span id="l57.35" class="difflineminus">-    classID: Components.ID(&quot;{65ef4b0b-d116-4b93-bf8a-84525992bf27}&quot;),</span>
<a href="#l57.36"></a><span id="l57.36" class="difflineminus">-    implementationLanguage: Components.interfaces.nsIProgrammingLanguage.JAVASCRIPT,</span>
<a href="#l57.37"></a><span id="l57.37" class="difflineminus">-    flags: Components.interfaces.nsIClassInfo.SINGLETON,</span>
<a href="#l57.38"></a><span id="l57.38" class="difflineminus">-</span>
<a href="#l57.39"></a><span id="l57.39" class="difflineminus">-    QueryInterface: function QueryInterface(aIID) {</span>
<a href="#l57.40"></a><span id="l57.40" class="difflineminus">-        return cal.doQueryInterface(this, CLineService.prototype, aIID, null, this);</span>
<a href="#l57.41"></a><span id="l57.41" class="difflineminus">-    },</span>
<a href="#l57.42"></a><span id="l57.42" class="difflineplus">+    classID: CLineServiceClassID,</span>
<a href="#l57.43"></a><span id="l57.43" class="difflineplus">+    QueryInterface: XPCOMUtils.generateQI(CLineServiceInterfaces),</span>
<a href="#l57.44"></a><span id="l57.44" class="difflineplus">+    classInfo: XPCOMUtils.generateCI({</span>
<a href="#l57.45"></a><span id="l57.45" class="difflineplus">+        classID: CLineServiceClassID,</span>
<a href="#l57.46"></a><span id="l57.46" class="difflineplus">+        contractID: &quot;@mozilla.org/commandlinehandler/general-startup;1?type=calendar&quot;,</span>
<a href="#l57.47"></a><span id="l57.47" class="difflineplus">+        classDescription: &quot;Calendar Commandline Handler&quot;,</span>
<a href="#l57.48"></a><span id="l57.48" class="difflineplus">+        interfaces: CLineServiceInterfaces,</span>
<a href="#l57.49"></a><span id="l57.49" class="difflineplus">+        flags: Components.interfaces.nsIClassInfo.SINGLETON</span>
<a href="#l57.50"></a><span id="l57.50" class="difflineplus">+    }),</span>
<a href="#l57.51"></a><span id="l57.51"> </span>
<a href="#l57.52"></a><span id="l57.52">     /* nsICommandLineHandler */</span>
<a href="#l57.53"></a><span id="l57.53">     handle : function service_handle(cmdLine) {</span>
<a href="#l57.54"></a><span id="l57.54">         if (!cmdLine.preventDefault) {</span>
<a href="#l57.55"></a><span id="l57.55">             // just pass all arguments on to the Sunbird window</span>
<a href="#l57.56"></a><span id="l57.56">             Services.ww.openWindow(null, &quot;chrome://sunbird/content/calendar.xul&quot;,</span>
<a href="#l57.57"></a><span id="l57.57">                                    &quot;_blank&quot;, &quot;chrome,dialog=no,all&quot;, cmdLine);</span>
<a href="#l57.58"></a><span id="l57.58">             cmdLine.preventDefault = true;</span>
<a href="#l57.59"></a><span id="l57.59" class="difflineat">@@ -60,42 +47,30 @@ CLineService.prototype = {</span>
<a href="#l57.60"></a><span id="l57.60"> </span>
<a href="#l57.61"></a><span id="l57.61">     helpInfo : &quot;  -subscribe or -url   Pass in a path pointing to a calendar\n&quot; +</span>
<a href="#l57.62"></a><span id="l57.62">                &quot;                       to subscribe to.\n&quot; +</span>
<a href="#l57.63"></a><span id="l57.63">                &quot;  -showdate            Pass in a value for a javascript date\n&quot; +</span>
<a href="#l57.64"></a><span id="l57.64">                &quot;                       to show this date on startup.\n&quot;</span>
<a href="#l57.65"></a><span id="l57.65"> };</span>
<a href="#l57.66"></a><span id="l57.66"> </span>
<a href="#l57.67"></a><span id="l57.67"> /* text/calendar content handler */</span>
<a href="#l57.68"></a><span id="l57.68" class="difflineminus">-function ICALContentHandler() {}</span>
<a href="#l57.69"></a><span id="l57.69" class="difflineminus">-</span>
<a href="#l57.70"></a><span id="l57.70" class="difflineplus">+function ICALContentHandler() {</span>
<a href="#l57.71"></a><span id="l57.71" class="difflineplus">+    this.wrappedJSObject = this;</span>
<a href="#l57.72"></a><span id="l57.72" class="difflineplus">+}</span>
<a href="#l57.73"></a><span id="l57.73" class="difflineplus">+const ICALContentHandlerClassID = Components.ID(&quot;{9ebf4c8a-7770-40a6-aeed-e1738129535a}&quot;);</span>
<a href="#l57.74"></a><span id="l57.74" class="difflineplus">+const ICALContentHandlerInterfaces = [Components.interfaces.nsIContentHandler];</span>
<a href="#l57.75"></a><span id="l57.75"> ICALContentHandler.prototype = {</span>
<a href="#l57.76"></a><span id="l57.76" class="difflineminus">-    getInterfaces: function getInterfaces(aCount) {</span>
<a href="#l57.77"></a><span id="l57.77" class="difflineminus">-        const ifaces = [</span>
<a href="#l57.78"></a><span id="l57.78" class="difflineminus">-            Components.interfaces.nsISupports,</span>
<a href="#l57.79"></a><span id="l57.79" class="difflineminus">-            Components.interfaces.nsIClassInfo,</span>
<a href="#l57.80"></a><span id="l57.80" class="difflineminus">-            Components.interfaces.nsIContentHandler</span>
<a href="#l57.81"></a><span id="l57.81" class="difflineminus">-        ];</span>
<a href="#l57.82"></a><span id="l57.82" class="difflineminus">-</span>
<a href="#l57.83"></a><span id="l57.83" class="difflineminus">-        aCount.value = ifaces.length;</span>
<a href="#l57.84"></a><span id="l57.84" class="difflineminus">-        return ifaces;</span>
<a href="#l57.85"></a><span id="l57.85" class="difflineminus">-    },</span>
<a href="#l57.86"></a><span id="l57.86" class="difflineminus">-</span>
<a href="#l57.87"></a><span id="l57.87" class="difflineminus">-    getHelperForLanguage: function (language) {</span>
<a href="#l57.88"></a><span id="l57.88" class="difflineminus">-        return null;</span>
<a href="#l57.89"></a><span id="l57.89" class="difflineminus">-    },</span>
<a href="#l57.90"></a><span id="l57.90" class="difflineminus">-</span>
<a href="#l57.91"></a><span id="l57.91" class="difflineminus">-    contractID: &quot;@mozilla.org/uriloader/content-handler;1?type=text/calendar&quot;,</span>
<a href="#l57.92"></a><span id="l57.92" class="difflineminus">-    classDescription: &quot;text/calendar Content Handler&quot;,</span>
<a href="#l57.93"></a><span id="l57.93" class="difflineminus">-    classID: Components.ID(&quot;{9ebf4c8a-7770-40a6-aeed-e1738129535a}&quot;),</span>
<a href="#l57.94"></a><span id="l57.94" class="difflineminus">-    implementationLanguage: Components.interfaces.nsIProgrammingLanguage.JAVASCRIPT,</span>
<a href="#l57.95"></a><span id="l57.95" class="difflineminus">-</span>
<a href="#l57.96"></a><span id="l57.96" class="difflineminus">-    QueryInterface: function QueryInterface(aIID) {</span>
<a href="#l57.97"></a><span id="l57.97" class="difflineminus">-        return cal.doQueryInterface(this, ICALContentHandler.prototype, aIID, null, this);</span>
<a href="#l57.98"></a><span id="l57.98" class="difflineminus">-    },</span>
<a href="#l57.99"></a><span id="l57.99" class="difflineplus">+    classID: ICALContentHandlerClassID,</span>
<a href="#l57.100"></a><span id="l57.100" class="difflineplus">+    QueryInterface: XPCOMUtils.generateQI(ICALContentHandlerInterfaces),</span>
<a href="#l57.101"></a><span id="l57.101" class="difflineplus">+    classInfo: XPCOMUtils.generateCI({</span>
<a href="#l57.102"></a><span id="l57.102" class="difflineplus">+        classID: ICALContentHandlerClassID,</span>
<a href="#l57.103"></a><span id="l57.103" class="difflineplus">+        contractID: &quot;@mozilla.org/uriloader/content-handler;1?type=text/calendar&quot;,</span>
<a href="#l57.104"></a><span id="l57.104" class="difflineplus">+        classDescription: &quot;text/calendar Content Handler&quot;,</span>
<a href="#l57.105"></a><span id="l57.105" class="difflineplus">+        interfaces: ICALContentHandlerInterfaces</span>
<a href="#l57.106"></a><span id="l57.106" class="difflineplus">+    }),</span>
<a href="#l57.107"></a><span id="l57.107"> </span>
<a href="#l57.108"></a><span id="l57.108">     handleContent: function handleContent(aContentType, aWindowTarget, aRequest) {</span>
<a href="#l57.109"></a><span id="l57.109">         let channel = aRequest.QueryInterface(Components.interfaces.nsIChannel);</span>
<a href="#l57.110"></a><span id="l57.110"> </span>
<a href="#l57.111"></a><span id="l57.111">         // Cancel the request ...</span>
<a href="#l57.112"></a><span id="l57.112">         let uri = channel.URI;</span>
<a href="#l57.113"></a><span id="l57.113">         const NS_BINDING_ABORTED = 0x804b0002 // from nsError.h</span>
<a href="#l57.114"></a><span id="l57.114">         aRequest.cancel(NS_BINDING_ABORTED);</span>
<a href="#l57.115"></a><span id="l57.115" class="difflineat">@@ -132,47 +107,34 @@ function NYI() {</span>
<a href="#l57.116"></a><span id="l57.116">     throw Components.results.NS_ERROR_NOT_IMPLEMENTED;</span>
<a href="#l57.117"></a><span id="l57.117"> }</span>
<a href="#l57.118"></a><span id="l57.118"> </span>
<a href="#l57.119"></a><span id="l57.119"> /* bogus webcal channel used by the ICALProtocolHandler */</span>
<a href="#l57.120"></a><span id="l57.120"> function BogusChannel(aURI) {</span>
<a href="#l57.121"></a><span id="l57.121">     this.URI = aURI;</span>
<a href="#l57.122"></a><span id="l57.122">     this.originalURI = aURI;</span>
<a href="#l57.123"></a><span id="l57.123"> }</span>
<a href="#l57.124"></a><span id="l57.124" class="difflineminus">-</span>
<a href="#l57.125"></a><span id="l57.125" class="difflineplus">+const BogusChannelClassID = Components.ID(&quot;{1e36ef5d-92d9-488f-ada6-9f15a1b57acf}&quot;);</span>
<a href="#l57.126"></a><span id="l57.126" class="difflineplus">+const BogusChannelInterfaces = [</span>
<a href="#l57.127"></a><span id="l57.127" class="difflineplus">+    Components.interfaces.nsIRequest,</span>
<a href="#l57.128"></a><span id="l57.128" class="difflineplus">+    Components.interfaces.nsIChannel</span>
<a href="#l57.129"></a><span id="l57.129" class="difflineplus">+];</span>
<a href="#l57.130"></a><span id="l57.130"> BogusChannel.prototype = {</span>
<a href="#l57.131"></a><span id="l57.131" class="difflineminus">-    getInterfaces: function getInterfaces(aCount) {</span>
<a href="#l57.132"></a><span id="l57.132" class="difflineminus">-        const ifaces = [</span>
<a href="#l57.133"></a><span id="l57.133" class="difflineminus">-            Components.interfaces.nsISupports,</span>
<a href="#l57.134"></a><span id="l57.134" class="difflineminus">-            Components.interfaces.nsIClassInfo,</span>
<a href="#l57.135"></a><span id="l57.135" class="difflineminus">-            Components.interfaces.nsIRequest,</span>
<a href="#l57.136"></a><span id="l57.136" class="difflineminus">-            Components.interfaces.nsIChannel</span>
<a href="#l57.137"></a><span id="l57.137" class="difflineminus">-        ];</span>
<a href="#l57.138"></a><span id="l57.138" class="difflineminus">-</span>
<a href="#l57.139"></a><span id="l57.139" class="difflineminus">-        aCount.value = ifaces.length;</span>
<a href="#l57.140"></a><span id="l57.140" class="difflineminus">-        return ifaces;</span>
<a href="#l57.141"></a><span id="l57.141" class="difflineminus">-    },</span>
<a href="#l57.142"></a><span id="l57.142" class="difflineminus">-</span>
<a href="#l57.143"></a><span id="l57.143" class="difflineminus">-    getHelperForLanguage: function (language) {</span>
<a href="#l57.144"></a><span id="l57.144" class="difflineminus">-        return null;</span>
<a href="#l57.145"></a><span id="l57.145" class="difflineminus">-    },</span>
<a href="#l57.146"></a><span id="l57.146" class="difflineminus">-</span>
<a href="#l57.147"></a><span id="l57.147" class="difflineminus">-    contractID: &quot;@mozilla.org/calendar/webcal-channel;1&quot;,</span>
<a href="#l57.148"></a><span id="l57.148" class="difflineminus">-    classDescription: &quot;webcal bogus channel&quot;,</span>
<a href="#l57.149"></a><span id="l57.149" class="difflineminus">-</span>
<a href="#l57.150"></a><span id="l57.150" class="difflineminus">-    classID: Components.ID(&quot;{1e36ef5d-92d9-488f-ada6-9f15a1b57acf}&quot;),</span>
<a href="#l57.151"></a><span id="l57.151" class="difflineminus">-    implementationLanguage: Components.interfaces.nsIProgrammingLanguage.JAVASCRIPT,</span>
<a href="#l57.152"></a><span id="l57.152" class="difflineplus">+    classID: BogusChannelClassID,</span>
<a href="#l57.153"></a><span id="l57.153" class="difflineplus">+    QueryInterface: XPCOMUtils.generateQI(BogusChannelInterfaces),</span>
<a href="#l57.154"></a><span id="l57.154" class="difflineplus">+    classInfo: XPCOMUtils.generateCI({</span>
<a href="#l57.155"></a><span id="l57.155" class="difflineplus">+        classID: BogusChannelClassID,</span>
<a href="#l57.156"></a><span id="l57.156" class="difflineplus">+        contractID: &quot;@mozilla.org/calendar/webcal-channel;1&quot;,</span>
<a href="#l57.157"></a><span id="l57.157" class="difflineplus">+        classDescription: &quot;webcal bogus channel&quot;,</span>
<a href="#l57.158"></a><span id="l57.158" class="difflineplus">+        interfaces: BogusChannelInterfaces</span>
<a href="#l57.159"></a><span id="l57.159" class="difflineplus">+    }),</span>
<a href="#l57.160"></a><span id="l57.160"> </span>
<a href="#l57.161"></a><span id="l57.161">     URI: null,</span>
<a href="#l57.162"></a><span id="l57.162">     originalURI: null,</span>
<a href="#l57.163"></a><span id="l57.163"> </span>
<a href="#l57.164"></a><span id="l57.164" class="difflineminus">-    QueryInterface: function QueryInterface(aIID) {</span>
<a href="#l57.165"></a><span id="l57.165" class="difflineminus">-        return cal.doQueryInterface(this, BogusChannel.prototype, aIID, null, this);</span>
<a href="#l57.166"></a><span id="l57.166" class="difflineminus">-    },</span>
<a href="#l57.167"></a><span id="l57.167" class="difflineminus">-</span>
<a href="#l57.168"></a><span id="l57.168">     /* nsIChannel */</span>
<a href="#l57.169"></a><span id="l57.169">     loadAttributes: null,</span>
<a href="#l57.170"></a><span id="l57.170">     contentType: &quot;text/calendar&quot;,</span>
<a href="#l57.171"></a><span id="l57.171">     contentLength: 0,</span>
<a href="#l57.172"></a><span id="l57.172">     owner: null,</span>
<a href="#l57.173"></a><span id="l57.173">     loadGroup: null,</span>
<a href="#l57.174"></a><span id="l57.174">     notificationCallbacks: null,</span>
<a href="#l57.175"></a><span id="l57.175">     securityInfo: null,</span></pre></div></div>

<div class="page_footer">
<div class="page_footer_text">comm-central</div>
<div class="page_footer_text" style="padding-left: 10px">Deployed from <a href="https://hg.mozilla.org/hgcustom/version-control-tools/rev/35f393d6769a">35f393d6769a</a> at 2020-07-16T17:23:43Z.</div>
<div class="rss_logo">
<a href="/comm-central/rss-log">RSS</a>
<a href="/comm-central/atom-log">Atom</a>
</div>
<br />

</div>
</body>
</html>

