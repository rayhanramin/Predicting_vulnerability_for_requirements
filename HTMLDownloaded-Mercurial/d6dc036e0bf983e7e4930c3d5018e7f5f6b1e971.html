<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en-US" lang="en-US">
<head>
<link rel="icon" href="/static/35f393d6769a/hgicon.png" type="image/png" />
<meta name="robots" content="index, nofollow"/>
<link rel="stylesheet" href="/static/35f393d6769a/style-gitweb.css" type="text/css" />

<style type="text/css">
div.feed {
  float: right;
}
a img {
  border-width: 0px;
}
div.log_link {
  width: 80px;
  background-color: white;
}

div.log_body {
  padding-left: 96px;
}
</style>
<script type="text/javascript" src="/static/35f393d6769a/mercurial.js"></script>

<meta property="og:image" content="/static/35f393d6769a/moz-logo-bw-rgb.svg"/>
<meta property="og:type" content="website"/>

<title>comm-central: changeset 17141:d6dc036e0bf983e7e4930c3d5018e7f5f6b1e971</title>
<link rel="alternate" type="application/atom+xml"
   href="/comm-central/atom-log" title="Atom feed for comm-central"/>
<link rel="alternate" type="application/rss+xml"
   href="/comm-central/rss-log" title="RSS feed for comm-central"/>

<meta property="og:title" content="comm-central @ d6dc036e0bf983e7e4930c3d5018e7f5f6b1e971" />
<meta property="og:url" content="/comm-central/rev/d6dc036e0bf983e7e4930c3d5018e7f5f6b1e971" />
<meta property="og:description" content="Bug 1073982 - Add context menu options to show a single calendar and show all calendars. r=philipp" />

</head>
<body>

<div class="page_header">
<div class="logo">
    <a href="https://developer.mozilla.org/en/docs/Mercurial">
        <img src="/static/35f393d6769a/moz-logo-bw-rgb.svg" alt="mercurial" />
    </a>
</div>
<a href="/">Mercurial</a> &gt; <a href="/comm-central">comm-central</a>  / changeset / d6dc036e0bf983e7e4930c3d5018e7f5f6b1e971 
</div>

<div class="page_nav">
<div>
<a href="/comm-central/summary">summary</a> |
<a href="/comm-central/shortlog/d6dc036e0bf983e7e4930c3d5018e7f5f6b1e971">shortlog</a> |
<a href="/comm-central/log/d6dc036e0bf983e7e4930c3d5018e7f5f6b1e971">changelog</a> |
<a href="/comm-central/pushloghtml">pushlog</a> |
<a href="/comm-central/graph/d6dc036e0bf983e7e4930c3d5018e7f5f6b1e971">graph</a> |
<a href="/comm-central/tags">tags</a> |
<a href="/comm-central/bookmarks">bookmarks</a> |
<a href="/comm-central/branches">branches</a> |
<a href="/comm-central/file/d6dc036e0bf983e7e4930c3d5018e7f5f6b1e971">files</a> |
changeset |
<a href="/comm-central/raw-rev/d6dc036e0bf983e7e4930c3d5018e7f5f6b1e971">raw</a>  | <a href="/comm-central/archive/d6dc036e0bf983e7e4930c3d5018e7f5f6b1e971.zip">zip</a>  |
<a href="/comm-central/help">help</a>
</div>

<div class="search">
<form id="searchform" action="/comm-central/log">

<input name="rev" type="text" value="" size="40" />
<div id="hint">Find changesets by keywords (author, files, the commit message), revision
number or hash, or <a href="/comm-central/help/revsets">revset expression</a>.</div>
</form>
</div>
</div>

<div class="title">
<a href="https://bugzilla.mozilla.org/show_bug.cgi?id=1073982">Bug 1073982</a> - Add context menu options to show a single calendar and show all calendars. r=philipp
<span class="logtags"></span>
</div>
<div class="title_text">
<table cellspacing="0">

<tr><td>author</td><td>&#77;&#97;&#116;&#116;&#104;&#101;&#119;&#32;&#77;&#101;&#99;&#99;&#97;&#32;&#60;&#109;&#97;&#116;&#116;&#104;&#101;&#119;&#46;&#109;&#101;&#99;&#99;&#97;&#64;&#103;&#109;&#97;&#105;&#108;&#46;&#99;&#111;&#109;&#62;</td></tr>
<tr><td></td><td class="date age">Sun, 23 Nov 2014 17:28:00 -0500</td></tr>

<tr>
 <td>changeset 17141</td>
 <td style="font-family:monospace"><a class="list" href="/comm-central/rev/d6dc036e0bf983e7e4930c3d5018e7f5f6b1e971">d6dc036e0bf983e7e4930c3d5018e7f5f6b1e971</a></td>
</tr>



<tr>
<td>parent 17140</td>
<td style="font-family:monospace">
<a class="list" href="/comm-central/rev/a228fcd7273165d9d8b7a4f51179e843e55f9d79">a228fcd7273165d9d8b7a4f51179e843e55f9d79</a>
</td>
</tr>

<tr>
<td>child 17142</td>
<td style="font-family:monospace">
<a class="list" href="/comm-central/rev/4ba87503bd41339a48b83b9f2b714509ba8afe86">4ba87503bd41339a48b83b9f2b714509ba8afe86</a>
</td>
</tr>
<tr><td>push id</td><td><a href="/comm-central/pushloghtml?changeset=d6dc036e0bf983e7e4930c3d5018e7f5f6b1e971">10608</a></td></tr>
<tr><td>push user</td><td>clokep@gmail.com</td></tr>
<tr><td>push date</td><td class="date age">Tue, 25 Nov 2014 14:15:15 +0000</td></tr>

<tr><td>treeherder</td><td>comm-central@4ba87503bd41 [<a href="https://treeherder.mozilla.org/#/jobs?repo=comm-central&revision=4ba87503bd41339a48b83b9f2b714509ba8afe86">default view</a>] [<a href="https://treeherder.mozilla.org/#/jobs?repo=comm-central&revision=4ba87503bd41339a48b83b9f2b714509ba8afe86&filter-resultStatus=testfailed&filter-resultStatus=busted&filter-resultStatus=exception">failures only]</td></tr>
<tr><td>perfherder</td><td>[<a href="https://treeherder.mozilla.org/perf.html#/compare?originalProject=comm-central&originalRevision=4ba87503bd41339a48b83b9f2b714509ba8afe86&newProject=comm-central&newRevision=6d2e86b2e14123fa455b44a62e80b78a033b405b&framework=1" target="_blank">talos</a>] [<a href="https://treeherder.mozilla.org/perf.html#/compare?originalProject=comm-central&originalRevision=4ba87503bd41339a48b83b9f2b714509ba8afe86&newProject=comm-central&newRevision=6d2e86b2e14123fa455b44a62e80b78a033b405b&framework=2" target="_blank">build metrics</a>] [<a href="https://treeherder.mozilla.org/perf.html#/compare?originalProject=comm-central&originalRevision=4ba87503bd41339a48b83b9f2b714509ba8afe86&newProject=comm-central&newRevision=6d2e86b2e14123fa455b44a62e80b78a033b405b&framework=6" target="_blank">platform microbench</a>] (compared to previous push)</td></tr>
<tr><td>reviewers</td><td><a href="/comm-central/log?rev=reviewer%28philipp%29&revcount=50">philipp</a></td></tr>
<tr><td>bugs</td><td><a href="https://bugzilla.mozilla.org/show_bug.cgi?id=1073982">1073982</a></td></tr>




</table></div>

<div class="page_body description"><a href="https://bugzilla.mozilla.org/show_bug.cgi?id=1073982">Bug 1073982</a> - Add context menu options to show a single calendar and show all calendars. r=philipp</div>
<div class="list_head"></div>
<div class="title_text">
<table cellspacing="0">

<tr class="parity0">
<td><a class="list" href="/comm-central/diff/d6dc036e0bf983e7e4930c3d5018e7f5f6b1e971/calendar/base/content/agenda-listbox.js">calendar/base/content/agenda-listbox.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/d6dc036e0bf983e7e4930c3d5018e7f5f6b1e971/calendar/base/content/agenda-listbox.js">file</a> |
<a href="/comm-central/annotate/d6dc036e0bf983e7e4930c3d5018e7f5f6b1e971/calendar/base/content/agenda-listbox.js">annotate</a> |
<a href="/comm-central/diff/d6dc036e0bf983e7e4930c3d5018e7f5f6b1e971/calendar/base/content/agenda-listbox.js">diff</a> |
<a href="/comm-central/comparison/d6dc036e0bf983e7e4930c3d5018e7f5f6b1e971/calendar/base/content/agenda-listbox.js">comparison</a> |
<a href="/comm-central/log/d6dc036e0bf983e7e4930c3d5018e7f5f6b1e971/calendar/base/content/agenda-listbox.js">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/d6dc036e0bf983e7e4930c3d5018e7f5f6b1e971/calendar/base/content/calendar-calendars-list.xul">calendar/base/content/calendar-calendars-list.xul</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/d6dc036e0bf983e7e4930c3d5018e7f5f6b1e971/calendar/base/content/calendar-calendars-list.xul">file</a> |
<a href="/comm-central/annotate/d6dc036e0bf983e7e4930c3d5018e7f5f6b1e971/calendar/base/content/calendar-calendars-list.xul">annotate</a> |
<a href="/comm-central/diff/d6dc036e0bf983e7e4930c3d5018e7f5f6b1e971/calendar/base/content/calendar-calendars-list.xul">diff</a> |
<a href="/comm-central/comparison/d6dc036e0bf983e7e4930c3d5018e7f5f6b1e971/calendar/base/content/calendar-calendars-list.xul">comparison</a> |
<a href="/comm-central/log/d6dc036e0bf983e7e4930c3d5018e7f5f6b1e971/calendar/base/content/calendar-calendars-list.xul">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/d6dc036e0bf983e7e4930c3d5018e7f5f6b1e971/calendar/base/content/calendar-management.js">calendar/base/content/calendar-management.js</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/d6dc036e0bf983e7e4930c3d5018e7f5f6b1e971/calendar/base/content/calendar-management.js">file</a> |
<a href="/comm-central/annotate/d6dc036e0bf983e7e4930c3d5018e7f5f6b1e971/calendar/base/content/calendar-management.js">annotate</a> |
<a href="/comm-central/diff/d6dc036e0bf983e7e4930c3d5018e7f5f6b1e971/calendar/base/content/calendar-management.js">diff</a> |
<a href="/comm-central/comparison/d6dc036e0bf983e7e4930c3d5018e7f5f6b1e971/calendar/base/content/calendar-management.js">comparison</a> |
<a href="/comm-central/log/d6dc036e0bf983e7e4930c3d5018e7f5f6b1e971/calendar/base/content/calendar-management.js">revisions</a>
</td>
</tr>
<tr class="parity1">
<td><a class="list" href="/comm-central/diff/d6dc036e0bf983e7e4930c3d5018e7f5f6b1e971/calendar/locales/en-US/chrome/calendar/calendar.dtd">calendar/locales/en-US/chrome/calendar/calendar.dtd</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/d6dc036e0bf983e7e4930c3d5018e7f5f6b1e971/calendar/locales/en-US/chrome/calendar/calendar.dtd">file</a> |
<a href="/comm-central/annotate/d6dc036e0bf983e7e4930c3d5018e7f5f6b1e971/calendar/locales/en-US/chrome/calendar/calendar.dtd">annotate</a> |
<a href="/comm-central/diff/d6dc036e0bf983e7e4930c3d5018e7f5f6b1e971/calendar/locales/en-US/chrome/calendar/calendar.dtd">diff</a> |
<a href="/comm-central/comparison/d6dc036e0bf983e7e4930c3d5018e7f5f6b1e971/calendar/locales/en-US/chrome/calendar/calendar.dtd">comparison</a> |
<a href="/comm-central/log/d6dc036e0bf983e7e4930c3d5018e7f5f6b1e971/calendar/locales/en-US/chrome/calendar/calendar.dtd">revisions</a>
</td>
</tr>
<tr class="parity0">
<td><a class="list" href="/comm-central/diff/d6dc036e0bf983e7e4930c3d5018e7f5f6b1e971/calendar/locales/en-US/chrome/calendar/calendar.properties">calendar/locales/en-US/chrome/calendar/calendar.properties</a></td>
<td></td>
<td class="link">
<a href="/comm-central/file/d6dc036e0bf983e7e4930c3d5018e7f5f6b1e971/calendar/locales/en-US/chrome/calendar/calendar.properties">file</a> |
<a href="/comm-central/annotate/d6dc036e0bf983e7e4930c3d5018e7f5f6b1e971/calendar/locales/en-US/chrome/calendar/calendar.properties">annotate</a> |
<a href="/comm-central/diff/d6dc036e0bf983e7e4930c3d5018e7f5f6b1e971/calendar/locales/en-US/chrome/calendar/calendar.properties">diff</a> |
<a href="/comm-central/comparison/d6dc036e0bf983e7e4930c3d5018e7f5f6b1e971/calendar/locales/en-US/chrome/calendar/calendar.properties">comparison</a> |
<a href="/comm-central/log/d6dc036e0bf983e7e4930c3d5018e7f5f6b1e971/calendar/locales/en-US/chrome/calendar/calendar.properties">revisions</a>
</td>
</tr>
</table></div>

<div class="page_body diffblocks"><div class="diffblock"><pre class="sourcelines">
<a href="#l1.1"></a><span id="l1.1" class="difflineminus">--- a/calendar/base/content/agenda-listbox.js</span>
<a href="#l1.2"></a><span id="l1.2" class="difflineplus">+++ b/calendar/base/content/agenda-listbox.js</span>
<a href="#l1.3"></a><span id="l1.3" class="difflineat">@@ -7,17 +7,17 @@ Components.utils.import(&quot;resource://gre/</span>
<a href="#l1.4"></a><span id="l1.4"> </span>
<a href="#l1.5"></a><span id="l1.5"> function Synthetic(aOpen, aDuration) {</span>
<a href="#l1.6"></a><span id="l1.6">     this.open = aOpen;</span>
<a href="#l1.7"></a><span id="l1.7">     this.duration = aDuration;</span>
<a href="#l1.8"></a><span id="l1.8"> }</span>
<a href="#l1.9"></a><span id="l1.9"> </span>
<a href="#l1.10"></a><span id="l1.10"> var agendaListbox = {</span>
<a href="#l1.11"></a><span id="l1.11">     agendaListboxControl: null,</span>
<a href="#l1.12"></a><span id="l1.12" class="difflineminus">-    pendingRefresh: null,</span>
<a href="#l1.13"></a><span id="l1.13" class="difflineplus">+    mPendingRefreshJobs: null,</span>
<a href="#l1.14"></a><span id="l1.14">     kDefaultTimezone: null,</span>
<a href="#l1.15"></a><span id="l1.15">     showsToday: false</span>
<a href="#l1.16"></a><span id="l1.16"> };</span>
<a href="#l1.17"></a><span id="l1.17"> </span>
<a href="#l1.18"></a><span id="l1.18"> /**</span>
<a href="#l1.19"></a><span id="l1.19">  * Initialize the agenda listbox, used on window load.</span>
<a href="#l1.20"></a><span id="l1.20">  */</span>
<a href="#l1.21"></a><span id="l1.21"> agendaListbox.init =</span>
<a href="#l1.22"></a><span id="l1.22" class="difflineat">@@ -28,16 +28,17 @@ function initAgendaListbox() {</span>
<a href="#l1.23"></a><span id="l1.23">     var showTomorrowHeader = (document.getElementById(&quot;tomorrow-header-hidden&quot;).getAttribute(&quot;checked&quot;) == &quot;true&quot;);</span>
<a href="#l1.24"></a><span id="l1.24">     var showSoonHeader = (document.getElementById(&quot;nextweek-header-hidden&quot;).getAttribute(&quot;checked&quot;) == &quot;true&quot;);</span>
<a href="#l1.25"></a><span id="l1.25">     this.today = new Synthetic(showTodayHeader, 1);</span>
<a href="#l1.26"></a><span id="l1.26">     this.addPeriodListItem(this.today, &quot;today-header&quot;);</span>
<a href="#l1.27"></a><span id="l1.27">     this.tomorrow = new Synthetic(showTomorrowHeader, 1);</span>
<a href="#l1.28"></a><span id="l1.28">     var soondays = Preferences.get(&quot;calendar.agendaListbox.soondays&quot;, 5);</span>
<a href="#l1.29"></a><span id="l1.29">     this.soon = new Synthetic(showSoonHeader, soondays);</span>
<a href="#l1.30"></a><span id="l1.30">     this.periods = [this.today, this.tomorrow, this.soon];</span>
<a href="#l1.31"></a><span id="l1.31" class="difflineplus">+    this.mPendingRefreshJobs = new Map();</span>
<a href="#l1.32"></a><span id="l1.32"> </span>
<a href="#l1.33"></a><span id="l1.33">     // Make sure the agenda listbox is unloaded</span>
<a href="#l1.34"></a><span id="l1.34">     var self = this;</span>
<a href="#l1.35"></a><span id="l1.35">     window.addEventListener(&quot;unload&quot;,</span>
<a href="#l1.36"></a><span id="l1.36">                             function unload_agendaListbox() {</span>
<a href="#l1.37"></a><span id="l1.37">                                 self.uninit();</span>
<a href="#l1.38"></a><span id="l1.38">                             },</span>
<a href="#l1.39"></a><span id="l1.39">                             false);</span>
<a href="#l1.40"></a><span id="l1.40" class="difflineat">@@ -598,45 +599,96 @@ function setupContextMenu(popup) {</span>
<a href="#l1.41"></a><span id="l1.41">  *</span>
<a href="#l1.42"></a><span id="l1.42">  * @param aStart        (optional) The start date for the item query.</span>
<a href="#l1.43"></a><span id="l1.43">  * @param aEnd          (optional) The end date for the item query.</span>
<a href="#l1.44"></a><span id="l1.44">  * @param aCalendar     (optional) If specified, the single calendar from</span>
<a href="#l1.45"></a><span id="l1.45">  *                                   which the refresh will occur.</span>
<a href="#l1.46"></a><span id="l1.46">  */</span>
<a href="#l1.47"></a><span id="l1.47"> agendaListbox.refreshCalendarQuery =</span>
<a href="#l1.48"></a><span id="l1.48"> function refreshCalendarQuery(aStart, aEnd, aCalendar) {</span>
<a href="#l1.49"></a><span id="l1.49" class="difflineminus">-    let pendingRefresh = cal.wrapInstance(this.pendingRefresh, Components.interfaces.calIOperation);</span>
<a href="#l1.50"></a><span id="l1.50" class="difflineminus">-    if (this.pendingRefresh) {</span>
<a href="#l1.51"></a><span id="l1.51" class="difflineminus">-        if (pendingRefresh) {</span>
<a href="#l1.52"></a><span id="l1.52" class="difflineminus">-            this.pendingRefresh = null;</span>
<a href="#l1.53"></a><span id="l1.53" class="difflineminus">-            pendingRefresh.cancel(null);</span>
<a href="#l1.54"></a><span id="l1.54" class="difflineminus">-        } else {</span>
<a href="#l1.55"></a><span id="l1.55" class="difflineminus">-            return;</span>
<a href="#l1.56"></a><span id="l1.56" class="difflineplus">+    let refreshJob = {</span>
<a href="#l1.57"></a><span id="l1.57" class="difflineplus">+        agendaListbox: this,</span>
<a href="#l1.58"></a><span id="l1.58" class="difflineplus">+        calendar: null,</span>
<a href="#l1.59"></a><span id="l1.59" class="difflineplus">+        calId: null,</span>
<a href="#l1.60"></a><span id="l1.60" class="difflineplus">+        operation: null,</span>
<a href="#l1.61"></a><span id="l1.61" class="difflineplus">+        cancelled: false,</span>
<a href="#l1.62"></a><span id="l1.62" class="difflineplus">+</span>
<a href="#l1.63"></a><span id="l1.63" class="difflineplus">+        onOperationComplete: function(aCalendar, aStatus, aOperationType, aId, aDateTime) {</span>
<a href="#l1.64"></a><span id="l1.64" class="difflineplus">+            if (this.agendaListbox.mPendingRefreshJobs.has(this.calId)) {</span>
<a href="#l1.65"></a><span id="l1.65" class="difflineplus">+                this.agendaListbox.mPendingRefreshJobs.delete(this.calId);</span>
<a href="#l1.66"></a><span id="l1.66" class="difflineplus">+            }</span>
<a href="#l1.67"></a><span id="l1.67" class="difflineplus">+</span>
<a href="#l1.68"></a><span id="l1.68" class="difflineplus">+            if (!this.cancelled) {</span>
<a href="#l1.69"></a><span id="l1.69" class="difflineplus">+                setCurrentEvent();</span>
<a href="#l1.70"></a><span id="l1.70" class="difflineplus">+            }</span>
<a href="#l1.71"></a><span id="l1.71" class="difflineplus">+        },</span>
<a href="#l1.72"></a><span id="l1.72" class="difflineplus">+</span>
<a href="#l1.73"></a><span id="l1.73" class="difflineplus">+        onGetResult: function(aCalendar, aStatus, aItemType, aDetail, aCount, aItems) {</span>
<a href="#l1.74"></a><span id="l1.74" class="difflineplus">+            if (this.cancelled || !Components.isSuccessCode(aStatus)) {</span>
<a href="#l1.75"></a><span id="l1.75" class="difflineplus">+                return;</span>
<a href="#l1.76"></a><span id="l1.76" class="difflineplus">+            }</span>
<a href="#l1.77"></a><span id="l1.77" class="difflineplus">+            for (let item of aItems) {</span>
<a href="#l1.78"></a><span id="l1.78" class="difflineplus">+                this.agendaListbox.addItem(item);</span>
<a href="#l1.79"></a><span id="l1.79" class="difflineplus">+            }</span>
<a href="#l1.80"></a><span id="l1.80" class="difflineplus">+        },</span>
<a href="#l1.81"></a><span id="l1.81" class="difflineplus">+</span>
<a href="#l1.82"></a><span id="l1.82" class="difflineplus">+        cancel: function() {</span>
<a href="#l1.83"></a><span id="l1.83" class="difflineplus">+            this.cancelled = true;</span>
<a href="#l1.84"></a><span id="l1.84" class="difflineplus">+            if (this.operation &amp;&amp; this.operation.isPending) {</span>
<a href="#l1.85"></a><span id="l1.85" class="difflineplus">+                this.operation.cancel();</span>
<a href="#l1.86"></a><span id="l1.86" class="difflineplus">+                this.operation = null;</span>
<a href="#l1.87"></a><span id="l1.87" class="difflineplus">+            }</span>
<a href="#l1.88"></a><span id="l1.88" class="difflineplus">+        },</span>
<a href="#l1.89"></a><span id="l1.89" class="difflineplus">+</span>
<a href="#l1.90"></a><span id="l1.90" class="difflineplus">+        execute: function(aStart, aEnd, aCalendar) {</span>
<a href="#l1.91"></a><span id="l1.91" class="difflineplus">+            if (!(aStart || aEnd || aCalendar)) {</span>
<a href="#l1.92"></a><span id="l1.92" class="difflineplus">+                this.agendaListbox.removeListItems();</span>
<a href="#l1.93"></a><span id="l1.93" class="difflineplus">+            }</span>
<a href="#l1.94"></a><span id="l1.94" class="difflineplus">+</span>
<a href="#l1.95"></a><span id="l1.95" class="difflineplus">+            if (!aCalendar) {</span>
<a href="#l1.96"></a><span id="l1.96" class="difflineplus">+                aCalendar = this.agendaListbox.calendar;</span>
<a href="#l1.97"></a><span id="l1.97" class="difflineplus">+            }</span>
<a href="#l1.98"></a><span id="l1.98" class="difflineplus">+            if (!aStart) {</span>
<a href="#l1.99"></a><span id="l1.99" class="difflineplus">+                aStart = this.agendaListbox.getStart();</span>
<a href="#l1.100"></a><span id="l1.100" class="difflineplus">+            }</span>
<a href="#l1.101"></a><span id="l1.101" class="difflineplus">+            if (!aEnd) {</span>
<a href="#l1.102"></a><span id="l1.102" class="difflineplus">+                aEnd = this.agendaListbox.getEnd();</span>
<a href="#l1.103"></a><span id="l1.103" class="difflineplus">+            }</span>
<a href="#l1.104"></a><span id="l1.104" class="difflineplus">+            if (!(aStart || aEnd || aCalendar)) {</span>
<a href="#l1.105"></a><span id="l1.105" class="difflineplus">+                return;</span>
<a href="#l1.106"></a><span id="l1.106" class="difflineplus">+            }</span>
<a href="#l1.107"></a><span id="l1.107" class="difflineplus">+</span>
<a href="#l1.108"></a><span id="l1.108" class="difflineplus">+            if (aCalendar.type == &quot;composite&quot;) {</span>
<a href="#l1.109"></a><span id="l1.109" class="difflineplus">+                // we're refreshing from the composite calendar, so we can cancel</span>
<a href="#l1.110"></a><span id="l1.110" class="difflineplus">+                // all other pending refresh jobs.</span>
<a href="#l1.111"></a><span id="l1.111" class="difflineplus">+                this.calId = &quot;composite&quot;;</span>
<a href="#l1.112"></a><span id="l1.112" class="difflineplus">+                for (let job of this.agendaListbox.mPendingRefreshJobs.values()) {</span>
<a href="#l1.113"></a><span id="l1.113" class="difflineplus">+                    job.cancel();</span>
<a href="#l1.114"></a><span id="l1.114" class="difflineplus">+                }</span>
<a href="#l1.115"></a><span id="l1.115" class="difflineplus">+                this.agendaListbox.mPendingRefreshJobs.clear();</span>
<a href="#l1.116"></a><span id="l1.116" class="difflineplus">+            } else {</span>
<a href="#l1.117"></a><span id="l1.117" class="difflineplus">+                this.calId = aCalendar.id;</span>
<a href="#l1.118"></a><span id="l1.118" class="difflineplus">+                if (this.agendaListbox.mPendingRefreshJobs.has(this.calId)) {</span>
<a href="#l1.119"></a><span id="l1.119" class="difflineplus">+                    this.agendaListbox.mPendingRefreshJobs.get(this.calId).cancel();</span>
<a href="#l1.120"></a><span id="l1.120" class="difflineplus">+                    this.agendaListbox.mPendingRefreshJobs.delete(this.calId);</span>
<a href="#l1.121"></a><span id="l1.121" class="difflineplus">+                }</span>
<a href="#l1.122"></a><span id="l1.122" class="difflineplus">+            }</span>
<a href="#l1.123"></a><span id="l1.123" class="difflineplus">+            this.calendar = aCalendar;</span>
<a href="#l1.124"></a><span id="l1.124" class="difflineplus">+</span>
<a href="#l1.125"></a><span id="l1.125" class="difflineplus">+            let filter = this.calendar.ITEM_FILTER_CLASS_OCCURRENCES |</span>
<a href="#l1.126"></a><span id="l1.126" class="difflineplus">+                         this.calendar.ITEM_FILTER_TYPE_EVENT;</span>
<a href="#l1.127"></a><span id="l1.127" class="difflineplus">+            let op = this.calendar.getItems(filter, 0, aStart, aEnd, this);</span>
<a href="#l1.128"></a><span id="l1.128" class="difflineplus">+            if (op &amp;&amp; op.isPending) {</span>
<a href="#l1.129"></a><span id="l1.129" class="difflineplus">+                this.operation = op;</span>
<a href="#l1.130"></a><span id="l1.130" class="difflineplus">+                this.agendaListbox.mPendingRefreshJobs.set(this.calId, this);</span>
<a href="#l1.131"></a><span id="l1.131" class="difflineplus">+            }</span>
<a href="#l1.132"></a><span id="l1.132">         }</span>
<a href="#l1.133"></a><span id="l1.133" class="difflineminus">-    }</span>
<a href="#l1.134"></a><span id="l1.134" class="difflineminus">-    if (!(aStart || aEnd || aCalendar)) {</span>
<a href="#l1.135"></a><span id="l1.135" class="difflineminus">-        this.removeListItems();</span>
<a href="#l1.136"></a><span id="l1.136" class="difflineminus">-    }</span>
<a href="#l1.137"></a><span id="l1.137" class="difflineminus">-    if (!aStart) {</span>
<a href="#l1.138"></a><span id="l1.138" class="difflineminus">-        aStart = this.getStart();</span>
<a href="#l1.139"></a><span id="l1.139" class="difflineminus">-    }</span>
<a href="#l1.140"></a><span id="l1.140" class="difflineminus">-    if (!aEnd) {</span>
<a href="#l1.141"></a><span id="l1.141" class="difflineminus">-        aEnd = this.getEnd();</span>
<a href="#l1.142"></a><span id="l1.142" class="difflineminus">-    }</span>
<a href="#l1.143"></a><span id="l1.143" class="difflineminus">-    if (aStart &amp;&amp; aEnd) {</span>
<a href="#l1.144"></a><span id="l1.144" class="difflineminus">-        var filter = this.calendar.ITEM_FILTER_CLASS_OCCURRENCES |</span>
<a href="#l1.145"></a><span id="l1.145" class="difflineminus">-                     this.calendar.ITEM_FILTER_TYPE_EVENT;</span>
<a href="#l1.146"></a><span id="l1.146" class="difflineminus">-        this.pendingRefresh = true;</span>
<a href="#l1.147"></a><span id="l1.147" class="difflineminus">-        let refreshCalendar = aCalendar || this.calendar;</span>
<a href="#l1.148"></a><span id="l1.148" class="difflineminus">-        pendingRefresh = refreshCalendar.getItems(filter, 0, aStart, aEnd,</span>
<a href="#l1.149"></a><span id="l1.149" class="difflineminus">-                                                  this.calendarOpListener);</span>
<a href="#l1.150"></a><span id="l1.150" class="difflineminus">-        if (pendingRefresh &amp;&amp; pendingRefresh.isPending) { // support for calIOperation</span>
<a href="#l1.151"></a><span id="l1.151" class="difflineminus">-            this.pendingRefresh = pendingRefresh;</span>
<a href="#l1.152"></a><span id="l1.152" class="difflineminus">-        }</span>
<a href="#l1.153"></a><span id="l1.153" class="difflineminus">-    }</span>
<a href="#l1.154"></a><span id="l1.154" class="difflineplus">+    };</span>
<a href="#l1.155"></a><span id="l1.155" class="difflineplus">+</span>
<a href="#l1.156"></a><span id="l1.156" class="difflineplus">+    refreshJob.execute(aStart, aEnd, aCalendar);</span>
<a href="#l1.157"></a><span id="l1.157"> };</span>
<a href="#l1.158"></a><span id="l1.158"> </span>
<a href="#l1.159"></a><span id="l1.159"> /**</span>
<a href="#l1.160"></a><span id="l1.160">  * Sets up the calendar for the agenda listbox.</span>
<a href="#l1.161"></a><span id="l1.161">  */</span>
<a href="#l1.162"></a><span id="l1.162"> agendaListbox.setupCalendar =</span>
<a href="#l1.163"></a><span id="l1.163"> function setupCalendar() {</span>
<a href="#l1.164"></a><span id="l1.164">     this.init();</span>
<a href="#l1.165"></a><span id="l1.165" class="difflineat">@@ -825,39 +877,16 @@ function getListItemByHashId(ahashId) {</span>
<a href="#l1.166"></a><span id="l1.166">  * The operation listener used for calendar queries.</span>
<a href="#l1.167"></a><span id="l1.167">  * Implements calIOperationListener.</span>
<a href="#l1.168"></a><span id="l1.168">  */</span>
<a href="#l1.169"></a><span id="l1.169"> agendaListbox.calendarOpListener = {</span>
<a href="#l1.170"></a><span id="l1.170">     agendaListbox : agendaListbox</span>
<a href="#l1.171"></a><span id="l1.171"> };</span>
<a href="#l1.172"></a><span id="l1.172"> </span>
<a href="#l1.173"></a><span id="l1.173"> /**</span>
<a href="#l1.174"></a><span id="l1.174" class="difflineminus">- * Called when all items have been retrieved from the calendar.</span>
<a href="#l1.175"></a><span id="l1.175" class="difflineminus">- * @see calIOperationListener</span>
<a href="#l1.176"></a><span id="l1.176" class="difflineminus">- */</span>
<a href="#l1.177"></a><span id="l1.177" class="difflineminus">-agendaListbox.calendarOpListener.onOperationComplete =</span>
<a href="#l1.178"></a><span id="l1.178" class="difflineminus">-function listener_onOperationComplete(calendar, status, optype, id,</span>
<a href="#l1.179"></a><span id="l1.179" class="difflineminus">-                                      detail) {</span>
<a href="#l1.180"></a><span id="l1.180" class="difflineminus">-    // signal that the current operation finished.</span>
<a href="#l1.181"></a><span id="l1.181" class="difflineminus">-    this.agendaListbox.pendingRefresh = null;</span>
<a href="#l1.182"></a><span id="l1.182" class="difflineminus">-    setCurrentEvent();</span>
<a href="#l1.183"></a><span id="l1.183" class="difflineminus">-};</span>
<a href="#l1.184"></a><span id="l1.184" class="difflineminus">-</span>
<a href="#l1.185"></a><span id="l1.185" class="difflineminus">-/**</span>
<a href="#l1.186"></a><span id="l1.186" class="difflineminus">- * Called when an item has been retrieved, adds all items to the agenda listbox.</span>
<a href="#l1.187"></a><span id="l1.187" class="difflineminus">- * @see calIOperationListener</span>
<a href="#l1.188"></a><span id="l1.188" class="difflineminus">- */</span>
<a href="#l1.189"></a><span id="l1.189" class="difflineminus">-agendaListbox.calendarOpListener.onGetResult =</span>
<a href="#l1.190"></a><span id="l1.190" class="difflineminus">-function listener_onGetResult(calendar, status, itemtype, detail, count, items) {</span>
<a href="#l1.191"></a><span id="l1.191" class="difflineminus">-    if (!Components.isSuccessCode(status))</span>
<a href="#l1.192"></a><span id="l1.192" class="difflineminus">-        return;</span>
<a href="#l1.193"></a><span id="l1.193" class="difflineminus">-    items.forEach(this.agendaListbox.addItem, this.agendaListbox);</span>
<a href="#l1.194"></a><span id="l1.194" class="difflineminus">-};</span>
<a href="#l1.195"></a><span id="l1.195" class="difflineminus">-</span>
<a href="#l1.196"></a><span id="l1.196" class="difflineminus">-/**</span>
<a href="#l1.197"></a><span id="l1.197">  * Calendar and composite observer, used to keep agenda listbox up to date.</span>
<a href="#l1.198"></a><span id="l1.198">  * @see calIObserver</span>
<a href="#l1.199"></a><span id="l1.199">  * @see calICompositeObserver</span>
<a href="#l1.200"></a><span id="l1.200">  */</span>
<a href="#l1.201"></a><span id="l1.201"> agendaListbox.calendarObserver = {</span>
<a href="#l1.202"></a><span id="l1.202">     agendaListbox: agendaListbox</span>
<a href="#l1.203"></a><span id="l1.203"> };</span>
<a href="#l1.204"></a><span id="l1.204"> </span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l2.1"></a><span id="l2.1" class="difflineminus">--- a/calendar/base/content/calendar-calendars-list.xul</span>
<a href="#l2.2"></a><span id="l2.2" class="difflineplus">+++ b/calendar/base/content/calendar-calendars-list.xul</span>
<a href="#l2.3"></a><span id="l2.3" class="difflineat">@@ -9,16 +9,27 @@</span>
<a href="#l2.4"></a><span id="l2.4"> &lt;!DOCTYPE overlay SYSTEM &quot;chrome://calendar/locale/calendar.dtd&quot;&gt;</span>
<a href="#l2.5"></a><span id="l2.5"> </span>
<a href="#l2.6"></a><span id="l2.6"> &lt;overlay id=&quot;calendar-list-overlay&quot;</span>
<a href="#l2.7"></a><span id="l2.7">          xmlns=&quot;http://www.mozilla.org/keymaster/gatekeeper/there.is.only.xul&quot;&gt;</span>
<a href="#l2.8"></a><span id="l2.8"> </span>
<a href="#l2.9"></a><span id="l2.9">   &lt;popupset id=&quot;calendar-popupset&quot;&gt;</span>
<a href="#l2.10"></a><span id="l2.10">     &lt;menupopup id=&quot;list-calendars-context-menu&quot;</span>
<a href="#l2.11"></a><span id="l2.11">                onpopupshowing=&quot;return calendarListSetupContextMenu(event);&quot;&gt;</span>
<a href="#l2.12"></a><span id="l2.12" class="difflineplus">+      &lt;menuitem id=&quot;list-calendars-context-togglevisible&quot;</span>
<a href="#l2.13"></a><span id="l2.13" class="difflineplus">+                accesskey=&quot;&amp;calendar.context.togglevisible.accesskey;&quot;</span>
<a href="#l2.14"></a><span id="l2.14" class="difflineplus">+                oncommand=&quot;toggleCalendarVisible(document.getElementById('list-calendars-context-menu').contextCalendar);&quot;/&gt;</span>
<a href="#l2.15"></a><span id="l2.15" class="difflineplus">+      &lt;menuitem id=&quot;list-calendars-context-showonly&quot;</span>
<a href="#l2.16"></a><span id="l2.16" class="difflineplus">+                accesskey=&quot;&amp;calendar.context.showonly.accesskey;&quot;</span>
<a href="#l2.17"></a><span id="l2.17" class="difflineplus">+                oncommand=&quot;showOnlyCalendar(document.getElementById('list-calendars-context-menu').contextCalendar);&quot;/&gt;</span>
<a href="#l2.18"></a><span id="l2.18" class="difflineplus">+      &lt;menuitem id=&quot;list-calendars-context-showall&quot;</span>
<a href="#l2.19"></a><span id="l2.19" class="difflineplus">+                label=&quot;&amp;calendar.context.showall.label;&quot;</span>
<a href="#l2.20"></a><span id="l2.20" class="difflineplus">+                accesskey=&quot;&amp;calendar.context.showall.accesskey;&quot;</span>
<a href="#l2.21"></a><span id="l2.21" class="difflineplus">+                oncommand=&quot;showAllCalendars();&quot;/&gt;</span>
<a href="#l2.22"></a><span id="l2.22" class="difflineplus">+      &lt;menuseparator id=&quot;list-calendars-context-showops-menuseparator&quot;/&gt;</span>
<a href="#l2.23"></a><span id="l2.23">       &lt;menuitem id=&quot;list-calendars-context-new&quot;</span>
<a href="#l2.24"></a><span id="l2.24">                 label=&quot;&amp;calendar.context.newserver.label;&quot;</span>
<a href="#l2.25"></a><span id="l2.25">                 accesskey=&quot;&amp;calendar.context.newserver.accesskey;&quot;</span>
<a href="#l2.26"></a><span id="l2.26">                 observes=&quot;calendar_new_calendar_command&quot;/&gt;</span>
<a href="#l2.27"></a><span id="l2.27">       &lt;menuitem id=&quot;list-calendars-context-find&quot;</span>
<a href="#l2.28"></a><span id="l2.28">                 label=&quot;&amp;calendar.context.findcalendar.label;&quot;</span>
<a href="#l2.29"></a><span id="l2.29">                 accesskey=&quot;&amp;calendar.context.findcalendar.accesskey;&quot;</span>
<a href="#l2.30"></a><span id="l2.30">                 oncommand=&quot;openCalendarSubscriptionsDialog();&quot;/&gt;</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l3.1"></a><span id="l3.1" class="difflineminus">--- a/calendar/base/content/calendar-management.js</span>
<a href="#l3.2"></a><span id="l3.2" class="difflineplus">+++ b/calendar/base/content/calendar-management.js</span>
<a href="#l3.3"></a><span id="l3.3" class="difflineat">@@ -137,16 +137,17 @@ function calendarListTooltipShowing(even</span>
<a href="#l3.4"></a><span id="l3.4">  * @return              Returns true if the context menu should be shown.</span>
<a href="#l3.5"></a><span id="l3.5">  */</span>
<a href="#l3.6"></a><span id="l3.6"> function calendarListSetupContextMenu(event) {</span>
<a href="#l3.7"></a><span id="l3.7">     let col = {};</span>
<a href="#l3.8"></a><span id="l3.8">     let row = {};</span>
<a href="#l3.9"></a><span id="l3.9">     let calendar;</span>
<a href="#l3.10"></a><span id="l3.10">     let calendars = getCalendarManager().getCalendars({});</span>
<a href="#l3.11"></a><span id="l3.11">     let treeNode = document.getElementById(&quot;calendar-list-tree-widget&quot;);</span>
<a href="#l3.12"></a><span id="l3.12" class="difflineplus">+    let composite = getCompositeCalendar();</span>
<a href="#l3.13"></a><span id="l3.13"> </span>
<a href="#l3.14"></a><span id="l3.14">     if (document.popupNode.localName == &quot;tree&quot;) {</span>
<a href="#l3.15"></a><span id="l3.15">         // Using VK_APPS to open the context menu will target the tree</span>
<a href="#l3.16"></a><span id="l3.16">         // itself. In that case we won't have a client point even for</span>
<a href="#l3.17"></a><span id="l3.17">         // opening the context menu. The &quot;target&quot; element should then be the</span>
<a href="#l3.18"></a><span id="l3.18">         // selected calendar.</span>
<a href="#l3.19"></a><span id="l3.19">         row.value =  treeNode.tree.currentIndex;</span>
<a href="#l3.20"></a><span id="l3.20">         col.value = treeNode.getColumn(&quot;calendarname-treecol&quot;);</span>
<a href="#l3.21"></a><span id="l3.21" class="difflineat">@@ -172,34 +173,99 @@ function calendarListSetupContextMenu(ev</span>
<a href="#l3.22"></a><span id="l3.22">     if (calendar) {</span>
<a href="#l3.23"></a><span id="l3.23">         enableElement(&quot;list-calendars-context-edit&quot;);</span>
<a href="#l3.24"></a><span id="l3.24">         enableElement(&quot;list-calendars-context-publish&quot;);</span>
<a href="#l3.25"></a><span id="l3.25">         // Only enable the delete calendars item if there is more than one</span>
<a href="#l3.26"></a><span id="l3.26">         // calendar. We don't want to have the last calendar deleted.</span>
<a href="#l3.27"></a><span id="l3.27">         if (calendars.length &gt; 1) {</span>
<a href="#l3.28"></a><span id="l3.28">             enableElement(&quot;list-calendars-context-delete&quot;);</span>
<a href="#l3.29"></a><span id="l3.29">         }</span>
<a href="#l3.30"></a><span id="l3.30" class="difflineplus">+</span>
<a href="#l3.31"></a><span id="l3.31" class="difflineplus">+        enableElement(&quot;list-calendars-context-togglevisible&quot;);</span>
<a href="#l3.32"></a><span id="l3.32" class="difflineplus">+        setElementValue(&quot;list-calendars-context-togglevisible&quot;, false, &quot;collapsed&quot;);</span>
<a href="#l3.33"></a><span id="l3.33" class="difflineplus">+        let stringName = composite.getCalendarById(calendar.id) ? &quot;hideCalendar&quot; : &quot;showCalendar&quot;;</span>
<a href="#l3.34"></a><span id="l3.34" class="difflineplus">+        setElementValue(&quot;list-calendars-context-togglevisible&quot;,</span>
<a href="#l3.35"></a><span id="l3.35" class="difflineplus">+                        cal.calGetString(&quot;calendar&quot;, stringName, [calendar.name]),</span>
<a href="#l3.36"></a><span id="l3.36" class="difflineplus">+                        &quot;label&quot;);</span>
<a href="#l3.37"></a><span id="l3.37" class="difflineplus">+        enableElement(&quot;list-calendars-context-showonly&quot;);</span>
<a href="#l3.38"></a><span id="l3.38" class="difflineplus">+        setElementValue(&quot;list-calendars-context-showonly&quot;, false, &quot;collapsed&quot;);</span>
<a href="#l3.39"></a><span id="l3.39" class="difflineplus">+        setElementValue(&quot;list-calendars-context-showonly&quot;,</span>
<a href="#l3.40"></a><span id="l3.40" class="difflineplus">+                        cal.calGetString(&quot;calendar&quot;, &quot;showOnlyCalendar&quot;, [calendar.name]),</span>
<a href="#l3.41"></a><span id="l3.41" class="difflineplus">+                        &quot;label&quot;);</span>
<a href="#l3.42"></a><span id="l3.42">     } else {</span>
<a href="#l3.43"></a><span id="l3.43">         disableElement(&quot;list-calendars-context-edit&quot;);</span>
<a href="#l3.44"></a><span id="l3.44">         disableElement(&quot;list-calendars-context-publish&quot;);</span>
<a href="#l3.45"></a><span id="l3.45">         disableElement(&quot;list-calendars-context-delete&quot;);</span>
<a href="#l3.46"></a><span id="l3.46" class="difflineplus">+        disableElement(&quot;list-calendars-context-togglevisible&quot;);</span>
<a href="#l3.47"></a><span id="l3.47" class="difflineplus">+        setElementValue(&quot;list-calendars-context-togglevisible&quot;, true, &quot;collapsed&quot;);</span>
<a href="#l3.48"></a><span id="l3.48" class="difflineplus">+        disableElement(&quot;list-calendars-context-showonly&quot;);</span>
<a href="#l3.49"></a><span id="l3.49" class="difflineplus">+        setElementValue(&quot;list-calendars-context-showonly&quot;, true, &quot;collapsed&quot;);</span>
<a href="#l3.50"></a><span id="l3.50">     }</span>
<a href="#l3.51"></a><span id="l3.51">     return true;</span>
<a href="#l3.52"></a><span id="l3.52"> }</span>
<a href="#l3.53"></a><span id="l3.53"> </span>
<a href="#l3.54"></a><span id="l3.54"> /**</span>
<a href="#l3.55"></a><span id="l3.55">  * Makes sure the passed calendar is visible to the user</span>
<a href="#l3.56"></a><span id="l3.56">  *</span>
<a href="#l3.57"></a><span id="l3.57">  * @param aCalendar   The calendar to make visible.</span>
<a href="#l3.58"></a><span id="l3.58">  */</span>
<a href="#l3.59"></a><span id="l3.59"> function ensureCalendarVisible(aCalendar) {</span>
<a href="#l3.60"></a><span id="l3.60">     // We use the main window's calendar list to ensure that the calendar is visible</span>
<a href="#l3.61"></a><span id="l3.61">     document.getElementById(&quot;calendar-list-tree-widget&quot;).ensureCalendarVisible(aCalendar);</span>
<a href="#l3.62"></a><span id="l3.62"> }</span>
<a href="#l3.63"></a><span id="l3.63"> </span>
<a href="#l3.64"></a><span id="l3.64" class="difflineplus">+/**</span>
<a href="#l3.65"></a><span id="l3.65" class="difflineplus">+ * Hides the specified calendar if it is visible, or shows it if it is hidden.</span>
<a href="#l3.66"></a><span id="l3.66" class="difflineplus">+ *</span>
<a href="#l3.67"></a><span id="l3.67" class="difflineplus">+ * @param aCalendar   The calendar to show or hide</span>
<a href="#l3.68"></a><span id="l3.68" class="difflineplus">+ */</span>
<a href="#l3.69"></a><span id="l3.69" class="difflineplus">+function toggleCalendarVisible(aCalendar) {</span>
<a href="#l3.70"></a><span id="l3.70" class="difflineplus">+    let composite = getCompositeCalendar();</span>
<a href="#l3.71"></a><span id="l3.71" class="difflineplus">+    if (composite.getCalendarById(aCalendar.id)) {</span>
<a href="#l3.72"></a><span id="l3.72" class="difflineplus">+        composite.removeCalendar(aCalendar);</span>
<a href="#l3.73"></a><span id="l3.73" class="difflineplus">+    } else {</span>
<a href="#l3.74"></a><span id="l3.74" class="difflineplus">+        composite.addCalendar(aCalendar);</span>
<a href="#l3.75"></a><span id="l3.75" class="difflineplus">+    }</span>
<a href="#l3.76"></a><span id="l3.76" class="difflineplus">+}</span>
<a href="#l3.77"></a><span id="l3.77" class="difflineplus">+</span>
<a href="#l3.78"></a><span id="l3.78" class="difflineplus">+/**</span>
<a href="#l3.79"></a><span id="l3.79" class="difflineplus">+ * Shows all hidden calendars.</span>
<a href="#l3.80"></a><span id="l3.80" class="difflineplus">+ */</span>
<a href="#l3.81"></a><span id="l3.81" class="difflineplus">+function showAllCalendars() {</span>
<a href="#l3.82"></a><span id="l3.82" class="difflineplus">+    let composite = getCompositeCalendar();</span>
<a href="#l3.83"></a><span id="l3.83" class="difflineplus">+    let cals = cal.getCalendarManager().getCalendars({});</span>
<a href="#l3.84"></a><span id="l3.84" class="difflineplus">+</span>
<a href="#l3.85"></a><span id="l3.85" class="difflineplus">+    composite.startBatch();</span>
<a href="#l3.86"></a><span id="l3.86" class="difflineplus">+    for (let calendar of cals) {</span>
<a href="#l3.87"></a><span id="l3.87" class="difflineplus">+        if (!composite.getCalendarById(calendar.id)) {</span>
<a href="#l3.88"></a><span id="l3.88" class="difflineplus">+            composite.addCalendar(calendar);</span>
<a href="#l3.89"></a><span id="l3.89" class="difflineplus">+        }</span>
<a href="#l3.90"></a><span id="l3.90" class="difflineplus">+    }</span>
<a href="#l3.91"></a><span id="l3.91" class="difflineplus">+    composite.endBatch();</span>
<a href="#l3.92"></a><span id="l3.92" class="difflineplus">+}</span>
<a href="#l3.93"></a><span id="l3.93" class="difflineplus">+</span>
<a href="#l3.94"></a><span id="l3.94" class="difflineplus">+/**</span>
<a href="#l3.95"></a><span id="l3.95" class="difflineplus">+ * Shows only the specified calendar, and hides all others.</span>
<a href="#l3.96"></a><span id="l3.96" class="difflineplus">+ *</span>
<a href="#l3.97"></a><span id="l3.97" class="difflineplus">+ * @param aCalendar   The calendar to show as the only visible calendar</span>
<a href="#l3.98"></a><span id="l3.98" class="difflineplus">+ */</span>
<a href="#l3.99"></a><span id="l3.99" class="difflineplus">+function showOnlyCalendar(aCalendar) {</span>
<a href="#l3.100"></a><span id="l3.100" class="difflineplus">+    let composite = getCompositeCalendar();</span>
<a href="#l3.101"></a><span id="l3.101" class="difflineplus">+    let cals = composite.getCalendars({}) || [];</span>
<a href="#l3.102"></a><span id="l3.102" class="difflineplus">+</span>
<a href="#l3.103"></a><span id="l3.103" class="difflineplus">+    composite.startBatch();</span>
<a href="#l3.104"></a><span id="l3.104" class="difflineplus">+    for (let calendar of cals) {</span>
<a href="#l3.105"></a><span id="l3.105" class="difflineplus">+        if (calendar.id != aCalendar.id) {</span>
<a href="#l3.106"></a><span id="l3.106" class="difflineplus">+            composite.removeCalendar(calendar);</span>
<a href="#l3.107"></a><span id="l3.107" class="difflineplus">+        }</span>
<a href="#l3.108"></a><span id="l3.108" class="difflineplus">+    }</span>
<a href="#l3.109"></a><span id="l3.109" class="difflineplus">+    composite.addCalendar(aCalendar);</span>
<a href="#l3.110"></a><span id="l3.110" class="difflineplus">+    composite.endBatch();</span>
<a href="#l3.111"></a><span id="l3.111" class="difflineplus">+}</span>
<a href="#l3.112"></a><span id="l3.112" class="difflineplus">+</span>
<a href="#l3.113"></a><span id="l3.113"> var compositeObserver = {</span>
<a href="#l3.114"></a><span id="l3.114">     QueryInterface: XPCOMUtils.generateQI([Components.interfaces.calIObserver,</span>
<a href="#l3.115"></a><span id="l3.115">                                            Components.interfaces.calICompositeObserver]),</span>
<a href="#l3.116"></a><span id="l3.116"> </span>
<a href="#l3.117"></a><span id="l3.117">     onStartBatch: function() {},</span>
<a href="#l3.118"></a><span id="l3.118">     onEndBatch: function () {},</span>
<a href="#l3.119"></a><span id="l3.119">     onAddItem: function() {},</span>
<a href="#l3.120"></a><span id="l3.120">     onModifyItem: function() {},</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l4.1"></a><span id="l4.1" class="difflineminus">--- a/calendar/locales/en-US/chrome/calendar/calendar.dtd</span>
<a href="#l4.2"></a><span id="l4.2" class="difflineplus">+++ b/calendar/locales/en-US/chrome/calendar/calendar.dtd</span>
<a href="#l4.3"></a><span id="l4.3" class="difflineat">@@ -238,16 +238,26 @@</span>
<a href="#l4.4"></a><span id="l4.4"> &lt;!ENTITY calendar.context.synccalendars.accesskey      &quot;S&quot;&gt;</span>
<a href="#l4.5"></a><span id="l4.5"> &lt;!ENTITY calendar.context.publish.label                &quot;Publish Calendar…&quot;&gt;</span>
<a href="#l4.6"></a><span id="l4.6"> &lt;!ENTITY calendar.context.publish.accesskey            &quot;b&quot;&gt;</span>
<a href="#l4.7"></a><span id="l4.7"> &lt;!ENTITY calendar.context.export.label                 &quot;Export Calendar…&quot;&gt;</span>
<a href="#l4.8"></a><span id="l4.8"> &lt;!ENTITY calendar.context.export.accesskey             &quot;E&quot;&gt;</span>
<a href="#l4.9"></a><span id="l4.9"> &lt;!ENTITY calendar.context.properties.label             &quot;Properties&quot;&gt;</span>
<a href="#l4.10"></a><span id="l4.10"> &lt;!ENTITY calendar.context.properties.accesskey         &quot;P&quot;&gt;</span>
<a href="#l4.11"></a><span id="l4.11"> </span>
<a href="#l4.12"></a><span id="l4.12" class="difflineplus">+&lt;!-- LOCALIZATION NOTE (calendar.context.togglevisible.accesskey)</span>
<a href="#l4.13"></a><span id="l4.13" class="difflineplus">+     This is the access key used for the showCalendar string --&gt;</span>
<a href="#l4.14"></a><span id="l4.14" class="difflineplus">+&lt;!ENTITY calendar.context.togglevisible.accesskey      &quot;H&quot;&gt;</span>
<a href="#l4.15"></a><span id="l4.15" class="difflineplus">+</span>
<a href="#l4.16"></a><span id="l4.16" class="difflineplus">+&lt;!-- LOCALIZATION NOTE (calendar.context.showonly.accesskey)</span>
<a href="#l4.17"></a><span id="l4.17" class="difflineplus">+     This is the access key used for the showOnlyCalendar string --&gt;</span>
<a href="#l4.18"></a><span id="l4.18" class="difflineplus">+&lt;!ENTITY calendar.context.showonly.accesskey           &quot;O&quot;&gt;</span>
<a href="#l4.19"></a><span id="l4.19" class="difflineplus">+&lt;!ENTITY calendar.context.showall.label                &quot;Show All Calendars&quot;&gt;</span>
<a href="#l4.20"></a><span id="l4.20" class="difflineplus">+&lt;!ENTITY calendar.context.showall.accesskey            &quot;A&quot;&gt;</span>
<a href="#l4.21"></a><span id="l4.21" class="difflineplus">+</span>
<a href="#l4.22"></a><span id="l4.22"> &lt;!ENTITY calendar.context.convertmenu.label              &quot;Convert To&quot;&gt;</span>
<a href="#l4.23"></a><span id="l4.23"> &lt;!ENTITY calendar.context.convertmenu.accesskey.mail     &quot;n&quot;&gt;</span>
<a href="#l4.24"></a><span id="l4.24"> &lt;!ENTITY calendar.context.convertmenu.accesskey.calendar &quot;v&quot;&gt;</span>
<a href="#l4.25"></a><span id="l4.25"> &lt;!ENTITY calendar.context.convertmenu.event.label        &quot;Event…&quot;&gt;</span>
<a href="#l4.26"></a><span id="l4.26"> &lt;!ENTITY calendar.context.convertmenu.event.accesskey    &quot;E&quot;&gt;</span>
<a href="#l4.27"></a><span id="l4.27"> &lt;!ENTITY calendar.context.convertmenu.message.label      &quot;Message…&quot;&gt;</span>
<a href="#l4.28"></a><span id="l4.28"> &lt;!ENTITY calendar.context.convertmenu.message.accesskey  &quot;M&quot;&gt;</span>
<a href="#l4.29"></a><span id="l4.29"> &lt;!ENTITY calendar.context.convertmenu.task.label         &quot;Task…&quot;&gt;</span></pre></div><div class="diffblock"><pre class="sourcelines">
<a href="#l5.1"></a><span id="l5.1" class="difflineminus">--- a/calendar/locales/en-US/chrome/calendar/calendar.properties</span>
<a href="#l5.2"></a><span id="l5.2" class="difflineplus">+++ b/calendar/locales/en-US/chrome/calendar/calendar.properties</span>
<a href="#l5.3"></a><span id="l5.3" class="difflineat">@@ -584,8 +584,17 @@ extractUsing=Using %1$S</span>
<a href="#l5.4"></a><span id="l5.4"> #    %2$S will be replaced with region like US in en-US</span>
<a href="#l5.5"></a><span id="l5.5"> extractUsingRegion=Using %1$S (%2$S)</span>
<a href="#l5.6"></a><span id="l5.6"> </span>
<a href="#l5.7"></a><span id="l5.7"> # LOCALIZATION NOTE (unit)</span>
<a href="#l5.8"></a><span id="l5.8"> # Used to determine the correct plural form of a unit</span>
<a href="#l5.9"></a><span id="l5.9"> unitMinutes=#1 minute;#1 minutes</span>
<a href="#l5.10"></a><span id="l5.10"> unitHours=#1 hour;#1 hours</span>
<a href="#l5.11"></a><span id="l5.11"> unitDays=#1 day;#1 days</span>
<a href="#l5.12"></a><span id="l5.12" class="difflineplus">+</span>
<a href="#l5.13"></a><span id="l5.13" class="difflineplus">+# LOCALIZATION NOTE (showCalendar)</span>
<a href="#l5.14"></a><span id="l5.14" class="difflineplus">+# Used in calendar list context menu</span>
<a href="#l5.15"></a><span id="l5.15" class="difflineplus">+#    %1$S will be replaced with the calendar name</span>
<a href="#l5.16"></a><span id="l5.16" class="difflineplus">+# uses the access key calendar.context.togglevisible.accesskey</span>
<a href="#l5.17"></a><span id="l5.17" class="difflineplus">+showCalendar=Show %1$S</span>
<a href="#l5.18"></a><span id="l5.18" class="difflineplus">+hideCalendar=Hide %1$S</span>
<a href="#l5.19"></a><span id="l5.19" class="difflineplus">+# uses the access key calendar.context.showonly.accesskey</span>
<a href="#l5.20"></a><span id="l5.20" class="difflineplus">+showOnlyCalendar=Show Only %1$S</span></pre></div></div>

<div class="page_footer">
<div class="page_footer_text">comm-central</div>
<div class="page_footer_text" style="padding-left: 10px">Deployed from <a href="https://hg.mozilla.org/hgcustom/version-control-tools/rev/35f393d6769a">35f393d6769a</a> at 2020-07-16T17:23:43Z.</div>
<div class="rss_logo">
<a href="/comm-central/rss-log">RSS</a>
<a href="/comm-central/atom-log">Atom</a>
</div>
<br />

</div>
</body>
</html>

